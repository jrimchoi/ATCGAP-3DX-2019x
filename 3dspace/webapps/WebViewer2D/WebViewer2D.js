define("DS/WebViewer2D/ViewerDoc",["UWA/Core","UWA/Class","DS/WebSystem/Environment"],function(d,a,b){var c={init:function(i){this.errorThumbnail="../3DPlayDocumentViewer/assets/images/I_3DSHARELoadFailed.png";this.status={failed:false,loaded:false};this.realSizeWidth=i.realSizeWidth;this.realSizeHeight=i.realSizeHeight;this.viewer=i.viewer;this.actionbarHeight=i.actionbarHeight;var e;var h;if(i.asset){h=i.asset.currentSrc||i.asset.baseURI||i.asset}if(typeof h==="string"&&""!==h){var g=h.split("/");e=g[g.length-1]}this.title=i.defaultTitle||e;this.thumbnail=null;var f={sheet:i.sheet};this.container=new d.Element("div",{data:f,"class":"viewer"}).inject(this.viewer)},loadAsset:function(e){if(e.asset!==this.asset){this.asset=e.asset}},_setThumbnail:function(e){this.thumbnail=e},getTitle:function(){return this.title},getCurrentScale:function(){return this.scale},getRealSizeHeight:function(){return this.realSizeHeight},getRealSizeWidth:function(){return this.realSizeWidth},getMargin:function(){return this.margin},getContainer:function(){return this.container},show:function(){this.container.style.top="0px"},hide:function(){this.container.style.top=this.viewer.offsetHeight+"px"},onMouseWheel:function(g){if(g.preventDefault){g.preventDefault()}var f=window.event||g;this.zoom(f,((f.wheelDelta||-f.detail)>0)?1.1:10/11,{x:f.clientX,y:f.clientY})},initMouseMoveZoom:function(e){this.currentZoom=100;this.initialY=e.clientY;this.minZoom=false;this.viewerCenter={x:this.container.offsetWidth/2,y:this.container.offsetHeight/2};this.currentScale=this.scale},onMouseMoveZoom:function(k){if(b.isSet("3DPlay.DisableViewerCanvas")){var j=(k.from&&k.from.length)?k.from[0].event:null;var h=100+((this.initialY-j.clientY)/2);if(h>0&&(this.minZoom===false||h>this.currentZoom)){this.zoom(j,(100/this.currentZoom),{x:this.viewerCenter.x,y:this.viewerCenter.y});this.currentZoom=h;this.zoom(j,this.currentZoom/100,{x:this.viewerCenter.x,y:this.viewerCenter.y});this.minZoom=this.scale<0.1}if(k.from&&k.from[0]&&k.from[0].event&&k.from[0].event.preventDefault){k.from[0].event.preventDefault()}else{return false}}else{if(k.from&&k.from[0]&&k.from[0].event&&k.from[0].event.preventDefault){k.from[0].event.preventDefault();var g=(k.from&&k.from.length)?k.from[0].event:null;var f=this.initialY-g.clientY;if(Math.abs(f)>this.viewer.offsetHeight/100&&Math.abs(f)<this.viewer.offsetHeight){var i=1+((f/this.viewer.offsetHeight)*10);var l=(this.currentScale*i)/this.scale;this.zoom(g,l,{x:this.viewerCenter.x,y:this.viewerCenter.y})}}}return this.scale},panStart:function(f,e){},pan:function(f,e){return true},panEnd:function(f,e){},onResize:function(){},fit:function(){},realSize:function(){},reframe:function(){},zoom:function(e,g,f){return true},focusOn:function(e,f){},getScreenShot:function(g){var j=this;var f=document.createElement("canvas");f.width=this.viewer.offsetWidth;f.height=this.viewer.offsetHeight;var i=f.getContext("2d");i.beginPath();i.rect(0,0,f.width,f.height);i.fillStyle="white";i.fill();var h=function(k){g.onFail(k)};var e=function(k,l){i.drawImage(k,Math.floor(l.clipX),Math.floor(l.clipY),Math.floor(l.clipWidth),Math.floor(l.clipHeight),Math.floor(l.pastingX),Math.floor(l.pastingY),Math.floor(l.pastingWidth),Math.floor(l.pastingHeight));if(b.isSet("ODT_3DPlay_Document2D")){require(["DS/CoreEvents/Events"],function(m){m.publish({event:b.get("ODT_3DPlay_Document2D")})})}else{g.onSuccess(f.toDataURL("image/png"))}};this.generateScreenshotOfDoc({onSuccess:e,onFail:h,width:f.width,height:f.height})},generateScreenshotOfDoc:function(e){},rotate:function(e){},getAnnotationDiv:function(){},loadFailed:function(e){this.status.failed=true;this.failureID=" failed "},getErrorID:function(){return this.failureID},dispose:function(){this.viewer.removeChild(this.container);this.container=this.viewer=null},setRealDimension:function(e){if(e){this.realSizeWidth=e.realSizeWidth;this.realSizeHeight=e.realSizeHeight}},};return a.extend(c)});define("DS/WebViewer2D/VideoControls",["UWA/Core","UWA/Class","DS/Controls/Timeline","DS/CoreEvents/Events","css!DS/WebViewer2D/VideoControls","DS/VisuEvents/EventsManager","DS/ApplicationFrame/CommandsManager"],function(g,b,f,e,d,a,c){return b.extend({init:function(h){this.viewer=h.container;var i=this.createControls(h);i.inject(h.container)},createControls:function(m){var v=this;var j=m.services;var l=m.container;var t=m.ctx;this.controlTab=new g.Element("div",{"class":"_3DPlay-VideoControlBar",styles:{"background-color":"#F2F5F7","z-index":2}});var A=m.frameWindow.getActionBar();A.onActionBarOpen(function(){v.controlTab.removeClassName("_3DPlay-VideoControlBar-Slide-Up");v.controlTab.addClassName("_3DPlay-VideoControlBar-Slide-Down")});A.onActionBarClose(function(){v.controlTab.addClassName("_3DPlay-VideoControlBar-Slide-Up");v.controlTab.removeClassName("_3DPlay-VideoControlBar-Slide-Down")});var q=new g.Element("div",{"class":"_3DPlay-VideoControlBar-ChildContainer"});var i=new g.Element("div",{id:"_3DPlay.Video.Timeline",styles:{margin:"-10px 50px"}});var y=new g.Element("div",{"class":"_3DPlay-VideoControlBar-ChildContainer",styles:{display:"inline-block"}});var r=j.getLength();var n=new f({minValue:0,maxValue:r,value:0,displayFunction:function(D){if(D){var C=new Date(D*1000).toUTCString().match(/(\d\d:\d\d:\d\d)/)[0];return C}return null},dynamicGaugeColor:false,eventsList:[{label:"",value:0},{label:"",value:r}],stepValue:0.01}).inject(i);var B=new g.Element("div",{styles:{position:"absolute","font-family":"3ds",left:"1%",width:"50px","text-align":"right"},content:new Date(j.getCurrentTime()*1000).toUTCString().match(/(\d\d:\d\d:\d\d)/)[0],}).inject(q);var u=new g.Element("div",{styles:{"font-family":"3ds",position:"absolute",right:"1%",width:"50px","text-align":"left"},content:new Date(j.getLength()*1000).toUTCString().match(/(\d\d:\d\d:\d\d)/)[0],}).inject(q);var p=new g.Element("a",{"class":"_3DPlay-VideoControls fonticon fonticon-2x fonticon-pause",events:{click:function(){if(j.isPaused()){j.playVideo()}else{j.pauseVideo()}}}}).inject(y);var h=new g.Element("a",{"class":"_3DPlay-VideoControls fonticon fonticon-2x fonticon-stop",events:{click:function(){j.stopVideo();p.setAttributes({"class":"fonticon fonticon-2x fonticon-play"})}}}).inject(y);var w=new g.Element("a",{"class":"_3DPlay-VideoControls fonticon fonticon-2x fonticon-fast-backward",events:{click:function(){j.rewindVideo()}}}).inject(y);var s=new g.Element("a",{"class":"_3DPlay-VideoControls fonticon fonticon-2x fonticon-fast-forward",events:{click:function(){j.fastForwardVideo()}}}).inject(y);var z=new g.Element("div",{styles:{display:"inline"}}).inject(y);var o=new g.Element("a",{"class":"_3DPlay-VideoControls fonticon fonticon-2x fonticon-sound",display:"inline",events:{click:function(){j.toggleAudio();if(j.getVolume()==0){o.setAttributes({"class":"_3DPlay-VideoControls fonticon fonticon-2x fonticon-mute"})}else{o.setAttributes({"class":"_3DPlay-VideoControls fonticon fonticon-2x fonticon-sound"})}}}}).inject(z);var k=new g.Element("div",{styles:{display:"inline-block",width:"200px"}}).inject(z);var x=new f({minValue:0,maxValue:100,value:100,dynamicGaugeColor:false,eventsList:[{label:"",value:0},{label:"",value:100}]}).inject(k);x.addEvent("change",function(){var C=x.getValue();if(C==0){o.setAttributes({"class":"_3DPlay-VideoControls fonticon fonticon-2x fonticon-mute"})}else{o.setAttributes({"class":"_3DPlay-VideoControls fonticon fonticon-2x fonticon-sound"})}j.setVolume(C/100)});n.addEvent("change",function(){var C=n.getValue();j.setCurrentTime(C);B.innerHTML=new Date(C*1000).toUTCString().match(/(\d\d:\d\d:\d\d)/)[0]});i.inject(q);q.inject(this.controlTab);y.inject(this.controlTab);this.setFadeAnimation(this.controlTab,this.viewer,"add");this._onClickCB=function(D){v._onClickPlayPauseEnabled=true;var C=c.getCommands(t);if((C&&C["2DDrawing"]&&C["2DDrawing"]._isRunning)||(C&&C.RemoveDrawing&&C.RemoveDrawing._isRunning)){v._onClickPlayPauseEnabled=false}if(v._onClickPlayPauseEnabled&&D.target==document.getElementsByClassName("outerSVG")[0]){if(j.isPaused()){j.playVideo()}else{j.pauseVideo()}}};this.viewer.addEventListener("click",this._onClickCB);this.videoTimeChangeToken=e.subscribe({event:"/WEBAPP/VIDEO/TIME_CHANGE"},function(C){n.setValue(C,false);B.innerHTML=new Date(j.getCurrentTime()*1000).toUTCString().match(/(\d\d:\d\d:\d\d)/)[0]});this.videoPlayingStateToken=e.subscribe({event:"/WEBAPP/VIDEO/VIDEO_PLAYING"},function(C){p.setAttributes({"class":"_3DPlay-VideoControls fonticon fonticon-2x fonticon-pause"})});this.videoPausedStateToken=e.subscribe({event:"/WEBAPP/VIDEO/VIDEO_PAUSED"},function(C){p.setAttributes({"class":"_3DPlay-VideoControls fonticon fonticon-2x fonticon-play"})});this.videoStoppedStateToken=e.subscribe({event:"/WEBAPP/VIDEO/VIDEO_STOPPED"},function(C){p.setAttributes({"class":"_3DPlay-VideoControls fonticon fonticon-2x fonticon-play"})});this._togglePlayPauseOnSpace=function(D){if(D&&D.from[0]&&D.from[0].event){var C=D&&D.from[0]&&D.from[0].event;if(C.keyCode===32){if(j.isPaused()){j.playVideo()}else{j.pauseVideo()}}}};a.addEvent(document,"onKeyDown",this._togglePlayPauseOnSpace);return this.controlTab},setFadeAnimation:function(m,i,l){var o=1;var j=true;var n=[];var r=function(u){if(u&&u.setAttributes){u.setStyles({opacity:o});if(u.children){var t=u.children;for(var s=0;s<t.length;s++){r(t[s])}}}};var p=function(){var s=setInterval(function(){if(o==0||j){clearInterval(s)}else{o-=0.1;r(m)}},50)};var q=function(){j=true;o=1;r(m);if(n.length>0){n.forEach(function(t){clearTimeout(t)})}var s=setTimeout(function(){j=false;p()},2000);n.push(s)};var k=function(){i.addEventListener("mousemove",q);q()};var h=function(){if(n.length>0){n.forEach(function(s){clearTimeout(s)});n.splice(0,n.length);i.removeEventListener("mousemove",q)}};if(l=="add"){i.addEventListener("mousemove",q);m.addEventListener("mouseenter",h);m.addEventListener("mouseleave",k);q()}else{if(l=="remove"){i.removeEventListener("mousemove",q);m.removeEventListener("mouseenter",h);m.removeEventListener("mouseleave",k)}}},destroyUI:function(){if(this.videoPlayingStateToken){e.unsubscribe(this.videoPlayingStateToken);this.videoPlayingStateToken=null}if(this.videoPausedStateToken){e.unsubscribe(this.videoPausedStateToken);this.videoPausedStateToken=null}if(this.videoStoppedStateToken){e.unsubscribe(this.videoStoppedStateToken);this.videoStoppedStateToken=null}if(this.videoTimeChangeToken){e.unsubscribe(this.videoTimeChangeToken);this.videoTimeChangeToken=null}this.setFadeAnimation(this.controlTab,this.viewer,"remove");a.removeEvent(this.viewer,"onKeyDown",this._togglePlayPauseOnSpace);var h=function(m,l){if(m.children){var k=m.children;for(var j=0;j<k.length;j++){h(k[j],m)}}else{l.removeChild(m)}};h(this.controlTab,this.viewer)}})});define("DS/WebViewer2D/CanvasShapes",["UWA/Class","DS/WebUtils/GeometryUtils","DS/WebUtils/Vector2"],function(c,h,b){function d(j){var k=j.settings;var i={id:Date.now(),type:j.shapeData.type,graphicalProp:{color:k.getColor(),thickness:k.getThickness()/j.scale},linkID:new Array(),data:{}};return i}function e(j){var k=j.shape.graphicalProp;var i=j.canvas.getContext("2d");if(j.lowLightMode){i.globalAlpha=0.8;i.strokeStyle="#D3D3D3";i.fillStyle="#D3D3D3"}else{i.strokeStyle=k.color;i.fillStyle=k.color;i.globalAlpha=1}i.lineCap="round";i.lineJoin="round";i.lineWidth=k.thickness*j.scale;return i}function f(j,l,m){var i=l.length;j.beginPath();j.moveTo(l[0].x,l[0].y);for(var k=1;k<i;++k){j.lineTo(l[k].x,l[k].y)}if(m){j.closePath()}j.stroke()}function g(o,n,j){if(j.indexOf(o)<0){j.push(o);var i=n[o];if(i){var k=i.linkID;for(var l=0;l<k.length;++l){var m=k[l];g(m.id,n,j)}}}return(j.length>0)?true:false}var a={createunknownOpen:function(j){var i=d(j);var k=j.shapeData;i.data={path:k};return i},drawunknownOpen:function(l){var p=l.shape;var j=e(l);var n=p.data.path;var o=[];var i=n.length;for(var m=0;m<i;++m){o.push({x:n[m].x*l.scale,y:n[m].y*l.scale})}f(j,o,false);var k=(o[0].x-o[i-1].x>=0)?o[0]:o[i-1];return{lastPosition:k}},isIntersectunknownOpen:function(i){var l=i.shape;var k=l.data.path;for(var j=0;j<k.length-1;++j){if(h._intersect(k[j],k[j+1],i.startPoint,i.endPoint)){return l.id}}return false},createline:function(j){var i=d(j);var l=j.shapeData;var k=[];k.push({x:l[0].x,y:l[0].y});k.push({x:l[l.length-1].x,y:l[l.length-1].y});i.data={path:k};return i},drawline:function(i){return a.drawunknownOpen(i)},isIntersectline:function(i){return a.isIntersectunknownOpen(i)},createarrowhead:function(x){var u=d(x);var w=x.shapeData.data.vertices;var p=x.shapeData.connectionData;if(p){var q=p.shape;var t=p.pointID;var l=p.pointEndID;var k=q.data.path;var s=function(B,A){var z=B.x-A.x;var C=B.y-A.y;return(Math.sqrt(z*z+C*C))};var m=0;for(var v=0;v<k.length-1;++v){m+=s(k[v+1],k[v])}m*=0.15;var j=s(w[1],w[0]);var i=s(w[1],w[2]);var r=(j>=i)?j:i;m=(r<=m)?r:m;var o=0.55;var n=new b(k[l].x-k[t].x,k[l].y-k[t].y);n=n.normalize();n.rotateAround({x:0,y:0},o);w[0].x=n.x*m+k[t].x;w[0].y=n.y*m+k[t].y;w[1].x=k[t].x;w[1].y=k[t].y;n.rotateAround({x:0,y:0},0-(2*o));w[2].x=n.x*m+k[t].x;w[2].y=n.y*m+k[t].y;q.linkID.push({id:u.id,pointID:t});u.linkID.push({id:q.id,pointID:1})}u.data={path:w};return u},drawarrowhead:function(j){var l=j.shape;var i=e(j);var k=[];k.push({x:l.data.path[0].x*j.scale,y:l.data.path[0].y*j.scale});k.push({x:l.data.path[1].x*j.scale,y:l.data.path[1].y*j.scale});k.push({x:l.data.path[2].x*j.scale,y:l.data.path[2].y*j.scale});f(i,k,false);return{lastPosition:{x:k[1].x,y:k[1].y}}},isIntersectarrowhead:function(i){return a.isIntersectunknownOpen(i)},createcircle:function(i){var k=d(i);var j=i.shapeData;k.data={radius:j.data.radius,centre:{x:j.data.centre.x,y:j.data.centre.y}};return k},drawcircle:function(k){var m=k.shape;var j=e(k);var i=m.data.centre.x*k.scale;var n=m.data.centre.y*k.scale;var l=m.data.radius*k.scale;j.beginPath();j.arc(i,n,l,0,2*Math.PI);j.stroke();return{lastPosition:{x:i,y:n}}},isIntersectcircle:function(q){var j=q.shape;var l=j.data.radius;var o=j.data.centre.x;var n=j.data.centre.y;var m=2*Math.PI/10;var k=[];for(var i=0;i<2*Math.PI;i+=m){k.push({x:o+l*Math.cos(i),y:n+l*Math.sin(i),})}for(var p=0;p<k.length-1;++p){if(h._intersect(k[p],k[p+1],q.startPoint,q.endPoint)){return j.id}}return false},createellipse:function(i){var k=i.shapeData;var j=d(i);j.data={radiusX:k.data.radius1,radiusY:k.data.radius2,centre:{x:k.data.centre.x,y:k.data.centre.y},angle:k.data.angle};return j},drawellipse:function(l){var m=l.shape;var k=e(l);var i=m.data.centre.x*l.scale;var p=m.data.centre.y*l.scale;var o=m.data.radiusX*l.scale;var n=m.data.radiusY*l.scale;var j=m.data.angle*Math.PI/180;k.save();k.beginPath();k.translate(i,p);k.rotate(j);k.translate(-o,-n);k.scale(o,n);k.arc(1,1,1,0,2*Math.PI);k.restore();k.stroke();return{lastPosition:{x:i,y:p}}},isIntersectellipse:function(q){var l=q.shape;var n=l.data.centre.x;var m=l.data.centre.y;var k=l.data.radiusX;var i=l.data.radiusY;var o=l.data.angle*Math.PI/180;var j=[];j.push(new b(n+k,m+i).rotateAround({x:n,y:m},o));j.push(new b(n-k,m+i).rotateAround({x:n,y:m},o));j.push(new b(n-k,m-i).rotateAround({x:n,y:m},o));j.push(new b(n+k,m-i).rotateAround({x:n,y:m},o));for(var p=0;p<j.length-1;++p){if(h._intersect(j[p],j[p+1],q.startPoint,q.endPoint)){return l.id}}return false},createpolygon:function(i){var l=i.shapeData;var j=d(i);j.data={};j.data.path=[];for(var k=0;k<l.data.vertices.length;++k){j.data.path.push({x:l.data.vertices[k].x,y:l.data.vertices[k].y,})}return j},drawpolygon:function(q){var m=q.shape;var j=e(q);var n=null;var l=null;var i=m.data.path;var p=[];var k=i.length;for(var o=0;o<k;++o){p.push({x:i[o].x*q.scale,y:i[o].y*q.scale});if(n==null||n<p[o].x){n=p[o].x}if(l==null||l>p[o].y){l=p[o].y}}f(j,p,true);return{lastPosition:{x:n,y:l}}},isIntersectpolygon:function(i){return a.isIntersectunknownOpen(i)},createrectangle:function(i){return a.createpolygon(i)},drawrectangle:function(i){return a.drawpolygon(i)},isIntersectrectangle:function(i){return a.isIntersectpolygon(i)},createsquare:function(i){return a.createpolygon(i)},drawsquare:function(i){return a.drawpolygon(i)},isIntersectsquare:function(i){return a.isIntersectpolygon(i)},createtriangle:function(i){return a.createpolygon(i)},drawtriangle:function(i){return a.drawpolygon(i)},isIntersecttriangle:function(i){return a.isIntersectpolygon(i)},createtext:function(i){var j=d(i);j.data=i.shapeData;return j},drawtext:function(q){var o=q.shape;var j=o.data;var n=1+(j.point.x)*q.scale;var m=j.point.y*q.scale;var k=e(q);var i=""+Math.ceil(j.fontSize*q.scale)+'px "3ds"';k.font=j.fontWeight+" "+i;for(var p=0;p<j.text.length;++p){var l=m+(j.offsetHeight-4)*q.scale*j.controlScale+p*j.offsetHeight*q.scale*j.controlScale;k.fillText(j.text[p],n,l)}return{lastPosition:{x:n,y:m}}},isIntersecttext:function(k){var i=k.shape.data.point.x;var o=k.shape.data.point.y;var j=k.shape.data.width;var m=k.shape.data.height;var n=[];n.push({x:i,y:o});n.push({x:i,y:o+m});n.push({x:i+j,y:o+m});n.push({x:i+j,y:o});for(var l=0;l<n.length-1;++l){if(h._intersect(n[l],n[l+1],k.startPoint,k.endPoint)){return k.shape.id}}return false}};return{createShapeFromJSON:function(i){},createShape:function(i){var j=a["create"+i.shapeData.type];if(!j){j=a.createunknownOpen}return j(i)},drawShape:function(i){var j=a["draw"+i.shape.type];if(!j){j=a.drawunknownOpen}return j(i)},isIntersectShape:function(j){var k=a["isIntersect"+j.shape.type];if(!k){k=a.isIntersectunknownOpen}var i=false;var l=k(j);if(l){i=new Array();g(l,j.shapeList,i)}return i}}});define("DS/WebViewer2D/ViewerHtml",["UWA/Core","DS/VisuEvents/EventsManager","WebappsUtils/WebappsUtils","DS/WebInfraUI/Touch"],function(d,a,c,b){return d.Class.extend({init:function(f){this._parent(f);this.viewer=f.viewer;this.status.failed=true;this.defaultZoomScale=1;this.currentZoomScale=1;this.minZoomScale=0.8;this.maxZoomScale=4;var e="TODO";this.frameWindow=f.frameWindow;this.container=this.frameWindow.getUIFrame();this.documentContainer=new d.Element("div",{styles:{height:"100vh",width:"100vw",padding:"0 5em",overflow:"auto","background-color":"#ffffff"}}).inject(this.container);this.document=new d.Element("div",{}).inject(this.documentContainer);this.document.innerHTML=f.asset.data;this.getTitle=function(){return e}},realSize:function(){this.currentZoomScale=this.defaultZoomScale;this.document.setStyle("font-size",this.currentZoomScale+"em")},enableTextSelection:function(){this.frameWindow.elements.container.removeClassName("wux-ui-disable-selection");this.container.removeClassName("wux-ui-disable-selection")},disableTextSelection:function(){this.frameWindow.elements.container.addClassName("wux-ui-disable-selection");this.container.addClassName("wux-ui-disable-selection")},startZoom:function(g){this._zoomGestureActive=true;if(g.gesture&&g.gesture.scale){this.zoom(g.gesture.scale)}else{if(!this._zoomGestureStartY){this._zoomGestureStartY=g.clientY||g.from[0].event.clientY}else{this._zoomGestureEndY=g.clientY||g.from[0].event.clientY;var f=this._zoomGestureEndY-this._zoomGestureStartY;var i=Math.abs(f)/2;if(f<0){i+=100}else{i=100-i}var h=i/100;this._zoomGestureStartY=this._zoomGestureEndY;this.zoom(h)}}},zoom:function(e){if(this._zoomGestureActive){this.currentZoomScale=Math.min(Math.max(this.minZoomScale,this.currentZoomScale*e),this.maxZoomScale);this.document.setStyle("font-size",this.currentZoomScale+"em")}},stopZoom:function(f){this._zoomGestureActive=undefined;this._zoomGestureStartY=undefined;this._zoomGestureEndY=undefined},showZoomCursor:function(e){if(e===true){var g=c.getWebappsAssetUrl("Visualization","")+"icons/";var f="url('"+g+"WebViewerZoom.png'), url('"+g+"WebViewerZoom.cur'), auto";this.container.setStyle("cursor",f)}else{this.container.setStyle("cursor","auto")}},enableDefaultZoomMouseGesture:function(){var e=this;this._rightMouseButtonDownToken=a.addEvent(this.container,"onRightMouseDown",function(f){e._rightMouseButtonDown=true;e.showZoomCursor(true)});this._rightMouseButtonUpToken=a.addEvent(this.container,"onRightMouseUp",function(f){e._rightMouseButtonDown=false;e.showZoomCursor(false);e.stopZoom(f)});this._mouseMoveToken=a.addEvent(this.container,"onMouseMove",function(f){if(e._rightMouseButtonDown){e.startZoom(f)}});this._pinchZoom=function(f){e.startZoom(f)};b(this.container).on("pinch",this._pinchZoom)},disableDefaultZoomMouseGesture:function(){if(this._rightMouseButtonDownToken){a.removeEventFromToken(this._rightMouseButtonDownToken);this._rightMouseButtonDownToken=undefined}if(this._rightMouseButtonUpToken){a.removeEventFromToken(this._rightMouseButtonUpToken);this._rightMouseButtonUpToken=undefined}if(this._mouseMoveToken){a.removeEventFromToken(this._mouseMoveToken);this._mouseMoveToken=undefined}b(this.container).off("pinch",this._pinchZoom)},getAnnotationDiv:function(){return this.document},getContainer:function(){return this.container},dispose:function(){}})});define("DS/WebViewer2D/ViewerError",["UWA/Core","DS/WebViewer2D/ViewerDoc"],function(b,a){return a.extend({init:function(d){this.viewer=d.viewer;this.status.failed=true;var f=d.asset.filename||d.asset;var e=f.split("/");var c=e[e.length-1];this.container=new b.Element("div",{data:d.data,"class":"viewer"}).inject(this.viewer);this.getErrorID=function(){return" error LoadFailed"};this.getTitle=function(){return c}}})});define("DS/WebViewer2D/ViewerVideo",["DS/WebViewer2D/ViewerDoc","DS/CoreEvents/Events","DS/WebSystem/DetectBrowser"],function(c,b,d){var a={init:function(h){var g=this;this._parent(h);this.video=h.video;this.viewer=h.viewer;this.typeOfDoc=h.typeOfDoc;this.svg=h.asset;this.container.appendChild(this.svg);this.svg=this.container.children[0].children[0]||this.container.childNodes[0].childNodes[0];var f=this._computeSVGDimensionsAndPosition(h.viewer,this.video);var e=0+","+0+","+f.width+","+f.height;this.svg.setAttribute("viewBox",e);this.onViewerResize=function(){var i=g._computeSVGDimensionsAndPosition(g.viewer,g.video);g.currentWidth=i.width;g.currentHeight=i.height;g.currentPosV=i.top;g.currentPosH=i.left;g.svg.style.left=i.left+"px";g.svg.style.top=i.top+"px";g.svg.setAttribute("height",i.height+"px");g.svg.setAttribute("width",i.width+"px");g.realSizeWidth=g.svg.width.baseVal.valueInSpecifiedUnits;g.realSizeHeight=g.svg.height.baseVal.valueInSpecifiedUnits;g.ratio=g.realSizeHeight/g.realSizeWidth;g.reframedWidth=-1;g.reframedHeight=-1};this.viewer.addEvent("resize",this.onViewerResize);this.onViewerResize();this.video.ontimeupdate=function(){b.publish({event:"/WEBAPP/VIDEO/TIME_CHANGE",data:g.video.currentTime});if(g.video.ended){g.stopVideo()}};this.rewindInterval=null;this.currentVolume=1},playVideo:function(){if(this.video){clearInterval(this.rewindInterval);this.video.playbackRate=1;this.video.play();b.publish({event:"/WEBAPP/VIDEO/VIDEO_PLAYING",data:{}})}},pauseVideo:function(){if(this.video){clearInterval(this.rewindInterval);this.video.pause();b.publish({event:"/WEBAPP/VIDEO/VIDEO_PAUSED",data:{}})}},stopVideo:function(){if(this.video){clearInterval(this.rewindInterval);this.video.currentTime=0;this.video.pause();b.publish({event:"/WEBAPP/VIDEO/VIDEO_STOPPED",data:{}})}},rewindVideo:function(){var e=this;if(e.video){clearInterval(e.rewindInterval);e.video.pause();e.rewindInterval=setInterval(function(){if(e.video.currentTime<=0){clearInterval(e.rewindInterval)}else{e.video.currentTime-=0.1}},100)}},fastForwardVideo:function(){if(this.video){clearInterval(this.rewindInterval);this.video.playbackRate=2}},getLength:function(){return this.video.duration},getCurrentTime:function(){return this.video.currentTime},setCurrentTime:function(e){this.video.currentTime=e},isPaused:function(){return this.video.paused},isStopped:function(){return(this.video.paused&&this.video.currentTime==0)},setVolume:function(e){this.video.volume=e;this.currentVolume=e},getVolume:function(){return this.video.volume},toggleAudio:function(){if(this.video.volume!=0){this.video.volume=0}else{this.video.volume=this.currentVolume}},getAnnotationDiv:function(){return this.container},takeSnapshot:function(){var f=document.createElement("canvas");f.height=this.video.videoHeight;f.width=this.video.videoWidth;f.top=0;f.left=0;var e=f.getContext("2d");e.drawImage(this.video,0,0,f.width,f.height);return f.toDataURL("image/png")},generateScreenshotOfDoc:function(o){var k=this;var n=d().browser.name;if(n=="ie"){return}else{var i=null;var m=k._computeSVGDimensionsAndPosition(k.viewer,k.video);var f=0+","+0+","+m.width+","+m.height;var q=function(r){if(!i){i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");i.setAttribute("version","1.1");i.setAttribute("height",k.currentHeight);i.setAttribute("width",k.currentWidth);i.setAttribute("viewBox",f)}i.appendChild(r)};var l=document.createElementNS("http://www.w3.org/2000/svg","image");l.setAttribute("height",k.currentHeight);l.setAttribute("width",k.currentWidth);var j=[];var h=document.getElementsByClassName("outerSVG")[0];var e=h.children||h.childNodes;var p=function(t){l.setAttributeNS("http://www.w3.org/1999/xlink","href",t);q(l);for(var x=0;x<e.length;x++){var v=e[x];if(v.getAttributeNS(null,"visibility")!=="hidden"){var y=v.cloneNode(true);q(y)}}var z=new XMLSerializer();var r=z.serializeToString(i);var s=new Blob([r],{type:"image/svg+xml;charset=utf-8"});var u=(self.URL||self.webkitURL||self).createObjectURL(s);var w=new Image();w.onload=function(){o.onSuccess(w,{clipX:0,clipY:0,clipWidth:k.realSizeWidth,clipHeight:k.realSizeHeight,pastingX:k.currentPosH,pastingY:k.currentPosV,pastingWidth:k.currentWidth,pastingHeight:k.currentHeight})};w.onerror=function(A){o.onFail(A)};w.src=u};var g=this.takeSnapshot();p(g)}},updateSVG:function(e){this.svg=e.childNodes[0].childNodes[0]},_computeSVGDimensionsAndPosition:function(l,j){var k=j.videoWidth/j.videoHeight;var i=l.clientWidth/l.clientHeight;var e=0;var f=0;var h=0;var g=0;if(i==k){e=l.clientWidth;f=l.clientHeight}else{if(i>k){f=l.clientHeight;e=(f*k);h=(l.clientWidth-e)/2;g=0}else{if(i<k){e=l.clientWidth;f=(e/k);h=0;g=(l.clientHeight-f)/2}}}return{height:f,left:h,top:g,width:e}},dispose:function(){this.viewer.removeEvent("resize",this.onViewerResize)}};return c.extend(a)});define("DS/WebViewer2D/ViewerCanvas",["UWA/Core","DS/WebViewer2D/ViewerDoc","DS/UIKIT/Spinner","DS/CoreEvents/Events","DS/WebViewer2D/CanvasShapes","WebappsUtils/WebappsUtils"],function(f,e,c,a,b,d){return e.extend({init:function(h){this._parent(h);this.thumbnail=h.thumbnail;this.title=h.title||h.defaultTitle;this.margin=h.margin||10;this.documentContainer=new f.Element("div",{styles:{position:"relative",display:"inline-block","vertical-align":"middle","background-color":"#ffffff","box-shadow":"darkgrey 2px 2px 10px 1px",overflow:"hidden",height:"calc(100% - 10px)","margin-top":"5px","margin-bottom":"5px"}}).inject(this.container);this.canvas=new f.Element("canvas",{id:"ViewerCanvas",styles:{"z-index":"2000","vertical-align":"top",display:"none",height:"100%"}});var i=document.createElement("div");i.setAttribute("class","PlayWeb-Splash");this.splashImage=document.createElement("img");this.baseUrl=d.getWebappsBaseUrl();if(this.baseUrl.charAt(this.baseUrl.length-1)!=="/"){this.baseUrl+="/"}this.splashImage.setAttribute("src",this.baseUrl+"3DPlayDocumentViewer/assets/images/sheet_loading.gif");this.splashImage.setAttribute("class","PlayWeb-SplashImage loading");i.appendChild(this.splashImage);var g=this;var j=function(k){if(k==="thumb"){g.splashImage.setAttribute("class","PlayWeb-SplashImage thumb");if(!g.thumbnail){k="loading"}else{g.splashImage.src=g.thumbnail;g.thumbnailImg=new Image();g.thumbnailImg.src=g.thumbnail}}if(k!=="thumb"){if(k==="loading"){g.splashImage.src=g.baseUrl+"3DPlayDocumentViewer/assets/images/sheet_loading.gif"}else{if(k==="failed"){g.splashImage.src=g.baseUrl+"3DPlayDocumentViewer/assets/images/sheet_failed.png"}}g.canvas.width=g.realSizeWidth*g.scale;g.canvas.height=g.realSizeHeight*g.scale;g.canvas.setStyle("display","");g.splashImage.setAttribute("class","PlayWeb-SplashImage ")}i.style.display=""};this.specialViews={hide:function(){i.style.display="none"},show:{loading:function(){j("loading")},failed:function(){j("failed")},thumbnail:function(){j("thumb")}}};this.documentContainer.appendChild(i);this.canvas.inject(this.documentContainer);this.shapeList={};this._isCentered=false},updateView:function(g){this.asset=g.asset;this.status=g.status;this.title=g.title;this.shapeList=g.annotations||{};this.scale=g.scale;this.useLOD=g.useLOD;if(this.status.loaded===false){this.specialViews.show.loading();if(g.doneCB){g.doneCB(true)}}else{if(this.status.failed===true){this.specialViews.show.failed();if(g.doneCB){g.doneCB(true)}}else{this.scaleAndRender(g.doneCB)}}},_scaleAndRender:function(){return false},scaleAndRender:function(h){var g=this;this._scaleAndRender({scale:this.scale||1,asset:this.asset,status:this.status,OnComplete:function(i){if(i!==true){g.canvas.setStyle("display","");g.specialViews.hide()}for(var j in g.shapeList){b.drawShape({shape:g.shapeList[j],canvas:g.canvas,scale:g.scale})}g=undefined;if(h){h()}}})},setScale:function(g){if(g!==this.scale){this.scale=g;var h=function(){a.publish({event:"3DPlay.2D.Zoom.Completed",data:{scale:this.scale}})}.bind(this);this.scaleAndRender(h)}},getScale:function(){return this.scale},getScreenShot:function(l){var z=(this.useLOD)?this.thumbnailImg:this.canvas;var m=(this.useLOD)?this.splashImage:this.canvas;var s=m.getBoundingClientRect();var g=s.top-l.viewerFrameBB.top;var h=s.left-l.viewerFrameBB.left;var x=s.right-l.viewerFrameBB.left;var r=s.bottom-l.viewerFrameBB.top;var t=l.containerBB.top-l.viewerFrameBB.top;var y=l.containerBB.bottom-l.viewerFrameBB.top;var q=l.containerBB.left-l.viewerFrameBB.left;var w=l.containerBB.right-l.viewerFrameBB.left;if(!(r<=t||g>=y||h>=w||x<=q)){var o,n,p,v,j,i,k,u;if(this.useLOD){o=(h>0)?0:Math.abs(h)*(this.thumbnailImg.width/s.width);n=(g>0)?0:Math.abs(g)*(this.thumbnailImg.height/s.height);p=this.thumbnailImg.width-o;v=this.thumbnailImg.height-n;j=(h>0)?h:0;i=(g>0)?g:0;k=(h>0)?s.width:s.width+h;u=(g>0)?s.height:s.height+g}else{if(h>q){o=0;j=h}else{o=Math.abs(h);j=0}if(g>t){n=0;i=g}else{n=Math.abs(g);i=0}if(h<l.containerBB.left){k=p=(x>w)?l.containerBB.width:s.width+h}else{k=p=(x<w)?s.width:w-h}if(g<t){u=v=(r>y)?l.containerBB.height:s.height+g}else{u=v=(r<y)?s.height:y-g}}l.context.shadowColor="darkgrey";l.context.shadowOffsetX=2;l.context.shadowOffsetY=2;l.context.shadowBlur=10;l.context.fillRect(j,i,k,u);l.context.drawImage(z,o,n,p,v,j,i,k,u)}},getAnnotationDiv:function(){return this.document},getContainer:function(){return this.container},getViewerPositionFromMouse:function(h){var i=this.documentContainer.getBoundingClientRect();var g=h.x-i.left;var j=h.y-i.top;if(g>0&&j>0&&g<this.currentWidth&&j<this.currentHeight){g=g/this.scale;j=j/this.scale;return{x:g,y:j}}return false},getMousePositionFromViewer:function(h){var g=h.x*this.scale;var i=h.y*this.scale;if(g>0&&i>0&&g<this.currentWidth&&i<this.currentHeight){g+=this.currentPosH;i+=this.currentPosV;return{x:g,y:i}}return false},getShapeList:function(){return this.shapeList},createShape:function(h){var g=b.createShape({shapeData:h.shapeData,scale:this.scale,settings:h.settings});this.shapeList[""+g.id]=g;return b.drawShape({shape:g,canvas:this.canvas,scale:this.scale})},reloadShape:function(g){this.shapeList[""+g.id]=g;return b.drawShape({shape:g,canvas:this.canvas,scale:this.scale})},getIntersectingShapes:function(g){var h=[];for(var j in this.shapeList){var i=b.isIntersectShape({shape:this.shapeList[j],startPoint:g.startPoint,endPoint:g.endPoint,shapeList:this.shapeList});if(i){h=h.concat(i)}}return h},drawShape:function(g){var i=g.idList;for(var h=0;h<i.length;++h){b.drawShape({shape:this.shapeList[""+i[h]],canvas:this.canvas,scale:this.scale,lowLightMode:g.lowLightMode})}},destroyShape:function(g){var i=g.idList;for(var h=0;h<i.length;++h){delete this.shapeList[""+i[h]]}},dispose:function(){this._parent();this.baseUrl=null;this.documentContainer=null;this.canvas=null},_setThumbnail:function(g){this._parent(g);if(this.useLOD){this.specialViews.show.thumbnail()}}})});define("DS/WebViewer2D/ViewerPDF",["UWA/Core","DS/WebViewer2D/ViewerCanvas"],function(b,a){return a.extend({init:function(c){this._parent(c);this._nextRender=null;this._isRenderInProgress=false},loadAsset:function(c){this._parent(c);this.asset=c.asset;this.useLOD=c.useLOD;var d=this;this._scaleAndRender({scale:1,OnComplete:function(e){if(d.canvas&&e!==true){d.canvas.setStyle("display","");d.specialViews.hide()}if(c.doneCB){c.doneCB(c.sheet)}}})},_scaleAndRender:function(f){if(this.asset.isEmpty){f.OnComplete(true);return true}var c=this.asset.getViewport(f.scale);this.currentHeight=c.height;this.currentWidth=c.width;this.scale=f.scale;if(this.useLOD){this._nextRender=null;if(this.thumbnail){this.specialViews.show.thumbnail()}else{this.specialViews.show.loading()}if(f.OnComplete){f.OnComplete(true)}}else{if(this._isRenderInProgress===false){this._isRenderInProgress=true;this.canvas.height=this.currentHeight;this.canvas.width=this.currentWidth;var g=this.canvas.getContext("2d");var e={canvasContext:g,viewport:c};var h=this;var d=this.asset.render(e);d.promise.then(function(){h._isRenderInProgress=false;if(h._nextRender){h._scaleAndRender(h._nextRender);h._nextRender=null}else{if(f.OnComplete&&h.useLOD&&h.thumbnail){h.specialViews.show.thumbnail();f.OnComplete(true)}else{if(f.OnComplete){f.OnComplete(false)}}}h=undefined})}else{var i=this.asset.getViewport(f.scale);this._nextRender=f}}return true},dispose:function(){}})});define("DS/WebViewer2D/ViewerImage",["UWA/Core","DS/WebViewer2D/ViewerDoc","DS/WebViewer2D/ViewerCanvas","DS/CoreEvents/Events","DS/WebSystem/Environment"],function(d,b,c,a){return c.extend({init:function(e){this._parent(e);this.margin=e.margin||10;this._isLODActive=false},loadAsset:function(e){this._parent(e);this.options=e;var f=this;this._scaleAndRender({scale:1,OnComplete:function(){a.publish({event:"3DPlay.2D.Zoom.Completed",data:{scale:f.scale}});if(e.doneCB){e.doneCB(e.sheet)}}})},_scaleAndRender:function(e){this.scale=e.scale;this.currentWidth=this.asset.width*this.scale;this.currentHeight=this.asset.height*this.scale;this.canvas.width=this.currentWidth;this.canvas.height=this.currentHeight;var f=this.canvas.getContext("2d");f.drawImage(this.asset,0,0,this.currentWidth,this.currentHeight);if(e.OnComplete){e.OnComplete()}return true},dispose:function(){}})});define("DS/WebViewer2D/ViewerSvg",["DS/WebViewer2D/ViewerDoc","DS/WebViewer2D/ViewerCanvas","DS/WebSystem/DetectBrowser","DS/CoreEvents/Events","DS/WebSystem/Environment","DS/WebSystem/Nls","WebappsUtils/WebappsUtils"],function(e,g,f,a,b,d,c){return g.extend({init:function(h){this._parent(h);this.margin=h.margin||10;this._isLODActive=false;this._nextRender=null;this._isRenderInProgress=false},loadAsset:function(j){var i="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(j.asset.asset)));this.asset=j.asset;this.status=j.status;this.useLOD=j.useLOD;var k=new Image();k.width=this.asset.width*5;k.height=this.asset.height*5;var h=this;k.onload=function(){h.asset.image=k;h._scaleAndRender({scale:1,isForThumb:true,OnComplete:function(){if(j.doneCB){if(f().browser.name==="ie"){j.doneCB(k,i)}else{j.doneCB(k,h.canvas.toDataURL("image/png"))}}}})};k.onerror=function(){this.specialViews.show.error()}.bind(this);k.src=i},_scaleAndRender:function(j){if(this.asset===undefined||this.asset===null||this.asset.image==undefined||this.asset.image==null){this._nextRender=null;this.specialViews.show.failed();options.OnComplete(true);return true}var h=this.asset.width*j.scale;var k=this.asset.height*j.scale;if(this.useLOD&&j.isForThumb!==true){this._nextRender=null;if(this.thumbnail){this.specialViews.show.thumbnail()}else{this.specialViews.show.loading()}if(j.OnComplete){j.OnComplete(true)}}else{this.canvas.width=h||this.container.offsetWidth;this.canvas.height=k||this.container.offsetHeight;if(this._isRenderInProgress===false){this._isRenderInProgress=true;var i=this.canvas.getContext("2d");if(this.asset.image){if(j.isForThumb===true){i.fillStyle="#FFFFFF";i.fillRect(0,0,h,k)}i.drawImage(this.asset.image,0,0,h,k)}else{console.error("No image: render skipped.")}this._isRenderInProgress=false;if(this._nextRender){this._scaleAndRender(this._nextRender);this._nextRender=null}else{if(j.OnComplete){j.OnComplete(false)}}}else{this._nextRender=j}}return true},dispose:function(){}})});