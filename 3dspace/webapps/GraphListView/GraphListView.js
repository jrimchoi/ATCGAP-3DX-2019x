define("DS/GraphListView/GraphListViewNodeEdgeViewsTemplate",["UWA/Core","DS/egraph/core","DS/egraph/utils","DS/egraph/views","DS/egraph/iact","css!DS/GraphListView/styles/GraphListViewNodeEdgeViewsTemplate"],function(i,g,a,c,e){var h;var d="Revision";var j="Derivation";var k=[];var p=[];var o=[];function b(){c.SVGEdgeView.call(this,"subway-edge-view")}a.inherit(b,c.SVGEdgeView);b.prototype.onmodifyDisplay=function(t,s,u){c.SVGEdgeView.prototype.onmodifyDisplay.apply(this,arguments);var r=this.display.elt,q;var q=t.data.color;if(q){r.style.stroke=q}if(t.selected){r.className.baseVal+=" selected"}else{r.className.baseVal=r.className.baseVal.replace(/\selected\b/g,"")}};function m(){c.HTMLNodeView.call(this)}a.inherit(m,c.HTMLNodeView);m.prototype.buildNodeElement=function n(r){if(!h){h=i.createElement("div",{"class":"subway-node-view",})}var q;q=i.extendElement(h.cloneNode(true));return q};m.prototype.onmodifyDisplay=function f(){c.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments);var t=this.display.elt;var s=arguments[0];var r=4;var q=s.actualWidth+r;if(s.selected){t.style.borderRadius=q/2+"px";t.style.width=q+"px";t.style.height=q+"px";t.style.left=s.actualLeft-(r/2)+"px";t.style.top=s.actualTop-(r/2)+"px"}else{q=q-r;t.style.borderRadius=q/2+"px";t.style.width=q+"px";t.style.height=q+"px";t.style.left=s.actualLeft+"px";t.style.top=s.actualTop+"px"}t.style.background=s.data.color};m.size=function(){return 16};m.getBorderThickness=function(){return 4};var l={radius:8,onupdate:function(M){var F=(M.swapConnectors)?M.cl2.c:M.cl1.c,E=(M.swapConnectors)?M.cl1.c:M.cl2.c,L=F.aleft,K=E.aleft,t=F.atop,s=E.atop,v=M.cl1.c.node.height,D=F.anormx,A=F.anormy,I=E.anormx,G=E.anormy,B=4*(Math.SQRT2-1)/3,u=this.radius,N=u*B,C,y,w,J,H,r,q,z,x;if(M.merge===true){if(L!==K){y=J=L;q=x=s;w=s-A*u;H=w+A*N;var I=(L-K)/Math.abs(L-K);z=L-I*u;r=z+I*N;C=[g.PathCmd.M,L,t,g.PathCmd.L,y,w,g.PathCmd.C,z,x,J,H,r,q,g.PathCmd.L,K,s]}}else{if(L===K){C=[g.PathCmd.M,L,t,g.PathCmd.L,K,s]}else{H=w=t;z=r=K;y=K-D*u;J=y+D*N;if(y<L){y=L}x=t-G*u;q=x+G*N;C=[g.PathCmd.M,L,t,g.PathCmd.L,y,w,g.PathCmd.C,z,x,J,H,r,q,g.PathCmd.L,K,s]}}M.set("path",C)}};return{NodeView:m,EdgeView:b,EdgeGeometry:l,branchDistance:function(){return 16}}});define("DS/GraphListView/ColumnManagerBase",["UWA/Core","UWA/Class","DS/LifecycleDAGUtils/ArrayFunctions","i18n!DS/GraphListView/assets/nls/ColumnsTitles"],function(d,a,c,b){return a.extend({_columns:undefined,init:function(f){var e=this;this._columns=[{text:"",dataIndex:"bi_color",width:10,isSortable:false,isDraggable:false,isEditable:false,alwaysOn:true},{text:b.colGraph,dataIndex:"__GRAPH__",width:150,style:{overflow:"scroll"},isSortable:true,isDraggable:false,isEditable:false,alwaysOn:true},{text:"",dataIndex:"selection",type:"selection",width:40,isSortable:false,isDraggable:false,isEditable:false,alwaysOn:true},(typeof f.onNodeDropdownMenu==="function"?{text:"",width:50,dataIndex:"__DROPDOWN__",isSortable:false,isDraggable:false,isEditable:false,alwaysOn:true,onCellRequest:function(h){if(!h.isHeader){h.cellView.getContent().setContent(d.createElement("div"),{html:'<span class="fonticon fonticon-2x fonticon-open-down"></span>',style:{width:"100%",height:"100%"},events:{mousedown:function(i){var j=h.cellView._cellInfos;f.onNodeDropdownMenu({cellInfos:j,event:i});j.manager.unsetActiveNode();j.manager.setActiveNode(j.nodeModel);i.preventDefault();i.stopPropagation()}}})}},}:{}),{text:b.colTitle,dataIndex:"tree",width:225,isSortable:true,isDraggable:false,isEditable:false,alwaysOn:true},];var g=this._columns.findIndex(function(h){return !h.dataIndex});g>0&&this._columns.splice(g,1)},getColumns:function(){return this._columns.slice()},setDefaultColumns:function(f,j){if(j===true){this._columns=f}else{var e=f.length;for(var h=0;h<e;h++){var g=this._columns.findIndex(function(i){return i.dataIndex===f[h].dataIndex});if(g>=0){this._columns[g]=d.extend(this._columns[g],f[h],true)}else{this._columns.push(f[h])}}}},addColumns:function(g){if(Array.isArray(g)&&g.length){for(var f=0,e=g.length;f<e;f++){this._columns.push(this._customizeColumnView(g[f]))}}},_customizeColumnView:function(e){var e=d.extend({text:undefined,dataIndex:undefined,width:"auto",isSortable:true,isDraggable:false,isEditable:false,isHidden:false},e);return e},removeColumns:function(g){if(Array.isArray(g)&&g.length){for(var f=0,e=g.length;f<e;f++){this._columns.splice(this._columns.findIndex(function(h){return g[f]===h.dataIndex}),1)}}},empty:function(){this.removeColumns(this._columns.reduce(function(f,h,g,i){if(!h.alwaysOn){f.push(h.dataIndex)}return f},[]))},showColumns:function(h){for(var g=0,e=h.length;g<e;g++){var f=this._columns.find(function(i){return i.dataIndex===h[g]});if(f){f.isHidden=false}}},hideColumns:function(h){for(var g=0,e=h.length;g<e;g++){var f=this._columns.find(function(i){return i.dataIndex===h[g]});if(f){f.isHidden=true}}}})});define("DS/GraphListView/SubwayGraph",["UWA/Core","DS/egraph/core","DS/egraph/utils","DS/egraph/views","DS/egraph/iact","DS/LifecycleDAGUtils/ArrayFunctions","css!DS/egraph/views.css","css!DS/egraph/views_default.css"],function(i,f,a,b,d,g){function e(o,m,k,r,l,j){function p(u,s){var t=new f.Connector();t.multiset(["cstr","attach"],f.BorderCstr[s],["cstr","offset"],m/2);u.appendConnector(t);return t}var q=new f.Node();q.data={};q.data.color=l;q.views.main=new this.options.nodeView();q.multiset("left",k,"top",r,"width",m,"height",m);q.data.cTop=p(q,"TOP");q.data.cBot=p(q,"BOTTOM");q.data.cRight=p(q,"RIGHT");q.data.cLeft=p(q,"LEFT");q.data.parentEdges=[];q.data.childEdges=[];if(j){q.data.data=j;j.__SUBWAYGRAPHNODE__=q;q.__MASTER__=j}q.customPropertyFlags={color:f.PropertyFlag.VIEW};o.addNode(q);return q}function c(m,p,o,l,n,j){var k;k=new f.Edge();k.set("geometry",this.options.edgeGeometry);k.views.main=new this.options.edgeView();m.addEdge(p,o,k);k.childNode=n;k.parentNode=l;n.data.parentEdges.push(k);l.data.childEdges.push(k);k.data={color:j};k.customPropertyFlags={color:f.PropertyFlag.VIEW};return k}var h={initGraph:function(){this._grMergeConnections=[];this._graph=new f.EGraph();this._graph.addView("main",new b.HTMLGraphView(this.options.graphContainer));var j=new d.StateMachine(this._graph,undefined,undefined,this._graph.views.main);j.rootState.onwheel=function(){}},_addNode:function(k,j,o,l){var m=this._graph,n=e.bind(this)(m,this.options.nodeSize,j,o,l||k.__BRANCH__.data.color,k)},_drawEdge:function(q,k,p){var s=this._graph,o=this._manager,u,m=k.__SUBWAYGRAPHNODE__,y=q.__SUBWAYGRAPHNODE__,x,n,w;if(m&&y){var v=o.getRowPosition(k.__LISTVIEWCOPY__._getRowID())>o.getRowPosition(q.__LISTVIEWCOPY__._getRowID());n=v?y.data.cBot:y.data.cTop;x=(q.__BRANCH__===k.__BRANCH__)?(v?m.data.cTop:m.data.cBot):m.data.cRight;var j=true,u;for(var r=0,l=y.data.parentEdges,t=l.length;r<t;r++){u=l[r];if(u.childNode===y&&u.parentNode===m){if(u.cl1.c===x&&u.cl2.c===n){j=false}else{this._removeEdge(u)}break}}if(j){c.bind(this)(s,x,n,m,y,p||q.__BRANCH__.data.color)}else{if(p&&p!==u.data.color){u.multiset(["data","color"],p)}}}},_drawHiddenNodeMerge:function(p){var z=this._graph,s=p.parent,m=p.child;if(s.__SUBWAYGRAPHNODE__&&m.__SUBWAYGRAPHNODE__){var B=s.__SUBWAYGRAPHNODE__,q=m.__SUBWAYGRAPHNODE__,w=this._manager,u=this.options.paddingLeft+this._model.getBranchID(p.mergeHiddenNode.__BRANCH__)*this.options.branchDistance,x=(B.top+q.top)/2,t=this._grMergeConnections.find(function(C){return C.masterMerge===p}),v=t?((t.grHiddenBranchMergeNode.actualLeft!==u||t.grHiddenBranchMergeNode.actualTop!==x&&t.grHiddenBranchMergeNode.multiset("left",u,"top",x)),t.grHiddenBranchMergeNode):e.bind(this)(z,this.options.nodeSize,u,x,"transparent",p.mergeHiddenNode),y=w.getRowPosition(s.__LISTVIEWCOPY__._getRowID())>w.getRowPosition(m.__LISTVIEWCOPY__._getRowID()),k=v.data[(y?"cBot":"cTop")],j=v.data[(y?"cTop":"cBot")],r=(!t)||(t.edges[0].cl2.c!==k&&t.edges[1].cl2.c!==j);if(r){if(t){while(t.edges.length){var A=t.edges.pop();this._removeEdge(A)}}var o=c.bind(this)(z,p.mergeLeft===true?B.data.cLeft:B.data.cRight,k,B,v,s.__BRANCH__.data.color),n=c.bind(this)(z,y?q.data.cBot:q.data.cTop,j,q,v,s.__BRANCH__.data.color),l=c.bind(this)(z,v.data.cBot,v.data.cTop,v,v,s.__BRANCH__.data.color);n.swapConnectors=o.hiddenNodeMergeEdge=n.hiddenNodeMergeEdge=n.merge=l.hiddenNodeMergeEdge=true;o.merge=o.swapConnectors=p.mergeLeft;if(!t){v.data.mergeHiddenNode=p.mergeHiddenNode;this._grMergeConnections.push({grHiddenBranchMergeNode:v,grParent:B,grChild:q,edges:[o,n,l],masterMerge:p})}else{t.edges=[o,n,l]}}}},_removeHiddenBranchMerge:function(j){this._removeNode(j.grHiddenBranchMergeNode)},_drawMergeEdge:function(n){var m=this._manager,p,t=n.parent,j=n.child,k=t.__SUBWAYGRAPHNODE__,u=j.__SUBWAYGRAPHNODE__;if(k&&u){var r=this._grMergeConnections.find(function(v){return v.masterMerge===n}),q=m.getRowPosition(k.__MASTER__.__LISTVIEWCOPY__._getRowID())>m.getRowPosition(u.__MASTER__.__LISTVIEWCOPY__._getRowID()),l=q?u.data.cBot:u.data.cTop,s=(n.mergeBetweenRoots===true)?(n.mergeLeft===true?k.data.cLeft:k.data.cRight):(q?s=k.data.cTop:s=k.data.cBot),o=(!r)||(r.edge.cl1.c!==s||r.edge.cl2.c!==l);if(o){r&&this._removeMerge(r);p=c.bind(this)(this._graph,s,l,k,u,n.custom_line_color||t.__BRANCH__.data.color);p.merge=true;if(n.mergeBetweenRoots===true){p.swapConnectors=n.mergeLeft}this._grMergeConnections.push({grParent:k,grChild:u,edge:p,masterMerge:n})}}},_removeEdge:function(l,k){var j;!k&&l.childNode&&(j=l.childNode.data.parentEdges.indexOf(l),j>=0)&&(l.childNode.data.parentEdges.splice(j,1),l.childNode=null);l.parentNode&&(j=l.parentNode.data.childEdges.indexOf(l),j>=0)&&(l.parentNode.data.childEdges.splice(j,1),l.parentNode=null);l.remove()},_removeMerge:function(j){this._grMergeConnections.splice(this._grMergeConnections.indexOf(j),1);if(j.grHiddenBranchMergeNode){this._removeHiddenBranchMerge(j)}else{this._removeEdge(j.edge)}},_removeNode:function(l){var m;if(l){while(m=l.data.parentEdges.pop(),m){if(m.merge===true&&m.hiddenNodeMergeEdge!==true){var j=this._grMergeConnections.findIndex(function(o){return o.edge===m});j>=0&&this._grMergeConnections.splice(j,1)}this._removeEdge(m,true)}m=l.data.childEdges.filter(function(o){return o.hiddenNodeMergeEdge===true});for(var k=0;k<m.length;k++){var n=this._grMergeConnections.splice(this._grMergeConnections.find(function(o){return o.mergeHiddenNode&&o.edges.indexOf(m[k])>=0}),1);n.length===1&&this._removeHiddenBranchMerge(n[0])}l.remove()}},_clearGraph:function(){var l=this._graph;var k;l.withLockedUpdate(function j(){for(var m=l.edges.first;m;m=k){k=m.next;m.remove()}for(var o=l.nodes.first;o;o=k){k=o.next;o.__MASTER__.__SUBWAYGRAPHNODE__=undefined;o.__MASTER__=undefined;o.remove()}});this._grMergeConnections=[]},_updateGraph:function(o){var j=(Array.isArray(this._model._nodeList)&&this._model._nodeList.length)?this._model._nodeList:this._model.getAllDescendants(),k=this._manager,p=k.options.defaultCellHeight,n=this._nodesRemoved,m=this;this._graph.withLockedUpdate(function q(){var z;while(z=n.pop(),z){this._removeNode(z.__MASTER__.__SUBWAYGRAPHNODE__)}var r=m._treeDoc.getRoots();var y=(p-this.options.nodeSize)/2;for(var G=r.length,F=G-1;F>=0;F--){if(r[F].__MASTER__){var w=r[F],A=w.__MASTER__,C=A.__SUBWAYGRAPHNODE__,s=w._getRowID(),I=k.getRowPosition(s),H=this._model.getBranchID(A.__BRANCH__),D=this.options.paddingLeft+(H?H:0)*this.options.branchDistance,E=I+y,u=A.options.grid.custom_node_color||A.__BRANCH__.data.color;if(!C){this._addNode(A,D,E,u)}else{if(C.actualLeft!==D||C.actualTop!==E){C.multiset("left",D,"top",E)}else{if((A.options.grid.custom_node_color&&C.data.color!==A.options.grid.custom_node_color)||!A.options.grid.custom_node_color&&C.data.color!==A.__BRANCH__.data.color){C.multiset(["data","color"],A.options.grid.custom_node_color||A.__BRANCH__.data.color)}}}}}for(G=j.length,F=0;F<G;F++){var t;if(Array.isArray(j[F].options.ancestors)&&j[F].options.ancestors.length){var v=j[F].options.ancestors.find(function(J){return J.semantic!=="I"});if(v&&v.custom_line_color){t=v.custom_line_color}else{t=j[F].__BRANCH__.data.color}}this._drawEdge(j[F],j[F].getParent(),t)}var B=g.intersectionDifference(this._model._mergeConnections,this._grMergeConnections,function(J,K){return K.masterMerge===J});var x=B[1].difference;x.forEach(function(J){this._removeMerge(J)},this);this._model._mergeConnections.forEach(function(J){if(J.mergeHiddenNode){this._drawHiddenNodeMerge(J)}else{this._drawMergeEdge(J)}},this);m.options.highlightNodesOnSelect&&m._updateGraphSelection()},this);var l=Math.max(this.options.paddingLeft+this._model._branchArray.length*this.options.branchDistance+this.options.nodeSize+this.options.paddingRight,this.options.minGraphColumnWidth);this.graphColumnWidth=(!isNaN(this.options.maxGraphColumnWidth)&&this.options.maxGraphColumnWidth>0)?this.graphColumnWidth=Math.min(l,this.options.maxGraphColumnWidth):l;k.prepareUpdateView();k.setColumnWidth("__GRAPH__",this.graphColumnWidth);this.options.graphContainer.setStyle("width",this.graphColumnWidth+"px");this.options.graphContainer.getElement(".egraph_views_domroot").setStyle("width",l+"px");k.pushUpdateView()},_updateGraphSelection:function(){var k=(Array.isArray(this._model._nodeList)&&this._model._nodeList.length)?this._model._nodeList:this._model.getAllDescendants(),n=this,j=this._model,l=this._manager,m=this._treeDoc.getRoots(),o=this._graph;this._graph.withLockedUpdate(function p(){for(var s=0,q=k.length;s<q;s+=1){if(k[s].__SUBWAYGRAPHNODE__){if(j.getXSO().isIn(k[s])){var r=k[s].__SUBWAYGRAPHNODE__;o.addToSelection(r);n.options.highlightParentEdgesOnNodeSelect&&r.data.parentEdges.forEach(function(t){o.addToSelection(t)})}else{if(o.isSelected(k[s].__SUBWAYGRAPHNODE__)){var r=k[s].__SUBWAYGRAPHNODE__;o.removeFromSelection(r);n.options.highlightParentEdgesOnNodeSelect&&r.data.parentEdges.forEach(function(t){o.isSelected(t)&&o.removeFromSelection(t)})}}}}})}};return h});define("DS/GraphListView/GraphListView",["UWA/Core","UWA/Class","DS/GraphListView/ColumnManagerBase","DS/GraphListView/SubwayGraph","DS/LifecycleDAGModel/DAGDocumentModel","DS/Tree/Tree","DS/GraphListView/GraphListViewNodeEdgeViewsTemplate","DS/LifecycleDAGUtils/ArrayFunctions","DS/Tree/TreeNodeModel","css!DS/GraphListView/styles/GraphListView"],function(f,b,h,k,a,g,i,c,e){function j(l){var m=l.clone();m.__MASTER__=l;l.__LISTVIEWCOPY__=m;return m}var d=g.extend({init:function(n){var l=this;n=n||{};this._listViewModelEventTokens={};this._listViewManagerEventTokens={};this._masterModelEventTokens={};this._isActivated=false;this._isPreparingColumns=0;n=f.extend({apiVersion:2,useAsyncPreExpand:true,enableTreeColumnEllipsisOverflow:true,enableKeyboardNavigation:true,resize:{columns:true,rows:false},show:{columnHeaders:true,rowHeaders:false},performances:{buildLinks:false,preloadPool:true,useRequestAnimationFrameRendering:false},selection:{cells:false},columnManager:new h(n),nodeView:i.NodeView,edgeView:i.EdgeView,edgeGeometry:i.EdgeGeometry,maxGraphColumnWidth:null,minGraphColumnWidth:60,paddingLeft:10,paddingRight:10,nodeSize:i.NodeView.size(),branchDistance:i.branchDistance(),ascending:false,isEditable:true,showScrollbarsOnHover:true},n,true);n.columns=n.columnManager.getColumns();n.columnManager._listView=this;this._parent(n);this.inject(n.container);this._treeDoc=this.getDocument();this._manager=this.getManager();this._nodesRemoved=[];var o=this.options.columnManager.getColumns();if(Array.isArray(o)){o.forEach(function(q){(q.customCellView&&q.customCellView.id&&q.customCellView.buildContent)&&l._manager.registerReusableCellContent(q.customCellView)})}this.elements.container.addClassName("subway-listview-listcontainer");var m=this.elements.container.getElement(".wux-datagrid");if(m){m.setStyle("height","inherit")}m=this.elements.container.getElement(".wux-layouts-gridengine");if(m){m.setStyle("height","inherit")}var p=f.createElement("div",{"class":"subway-graph-canvas",});this._manager.elements.poolContainerRel.appendChild(p);this.options.graphContainer=p;this.initGraph();this._manager.onColumnWidthUpdate(function(q){if(q.columnID===0){if(typeof q.width==="number"&&q.width!==l.graphColWidth){p.setStyle("width",q.width.toString()+"px");l.graphColWidth=q.width}}});this._model=this.options.model||new a();if(!(this._model instanceof a)){throw Error("SubwayListView=>ListView.SetModel: model must be instance of DAGDocumentModel")}},_addEventListeners:function(){this._addEvent("LISTVIEWMODEL","select",this.onSelectListView.bind(this));this._addEvent("LISTVIEWMODEL","unselect",this.onUnselectListView.bind(this));this._addEvent("MASTER","prepareAddDelete",this.prepareUpdateView.bind(this));this._addEvent("MASTER","pushAddDelete",this.pushUpdateViewAndUpdateGraph.bind(this));this._addEvent("MASTER","empty",this.empty.bind(this));this._addEvent("MASTER","select",this.onSelectMaster.bind(this));this._addEvent("MASTER","unselect",this.onUnselectMaster.bind(this));this._addEvent("MASTER","attributeChanged",this.onMasterNodeAttributeChanged.bind(this));this._addEvent("LISTVIEWMANAGER","sort",this.onSort.bind(this));this._addEvent("LISTVIEWMANAGER","dblClick",function(l){var m=l.nodeModel.__MASTER__;typeof this.options.onNodeDoubleClick==="function"&&this.options.onNodeDoubleClick(m)}.bind(this));this._isActivated=true},deactivate:function(){for(var l in this._listViewModelEventTokens){this._removeEvent("LISTVIEWMODEL",l)}for(var l in this._masterModelEventTokens){this._removeEvent("MASTER",l)}for(var l in this._listViewManagerEventTokens){this._removeEvent("LISTVIEWMANAGER",l)}this._isActivated=false},activate:function(){this.prepareUpdateView();this.updateNodes();this.pushUpdateViewAndUpdateGraph();this._addEventListeners()},getModel:function(){return this._model},empty:function(){this._treeDoc.empty();this._clearGraph()},updateNodes:function(){var t=this,n;var s=this._treeDoc;var m=this._manager;var o=(Array.isArray(this._model._nodeList)&&this._model._nodeList.length)?this._model._nodeList:this._model.getAllDescendants();if(typeof this.options.nodeSortFunction==="function"){o.sort(this.options.nodeSortFunction)}for(var p=0,r,l=s.getAllDescendants(),q=l.length;p<q;p+=1){(r=l[p],(!r.__MASTER__||o.indexOf(r.__MASTER__)<0))&&(t._nodesRemoved.push(s.removeRoot(r)))}for(var p=0,q=o.length,u=o[p];p<q;p+=1,u=o[p]){if(!u.__LISTVIEWCOPY__||u.__LISTVIEWCOPY__.__MASTER__!==u){this._addChild(u)}else{u.__LISTVIEWCOPY__.refreshNodeData(u)}if(u._isSelected===true&&!u.__LISTVIEWCOPY__.isSelected()){u.__LISTVIEWCOPY__.select()}else{if(!u._isSelected&&u.__LISTVIEWCOPY__.isSelected()){u.__LISTVIEWCOPY__.unselect()}}u.__LISTVIEWCOPY__.setAttribute("__filter__",u.getAttribute("__filter__"))}},_addChild:function(l){var o,m=this._treeDoc,n=this._model._nodeList;(n.indexOf(l)>=0)&&(!l.__LISTVIEWCOPY__)&&(o=j(l),m.addRoot(o))},addChildCallback:function(l){this._addChild(l.data.nodeModel)},_removeChild:function(l){var o=this._treeDoc;if(o.getRoots().length){var n=l.__LISTVIEWCOPY__;var p=l.getAllDescendants();this._nodesRemoved.push(o.removeRoot(n));for(var m=0;m<p.length;m++){this._nodesRemoved.push(o.removeRoot(p[m].__LISTVIEWCOPY__))}}},removeChildCallback:function(l){this._removeChild(l.data.nodeModel)},prepareUpdateView:function(l){this._manager.prepareUpdateView();this._treeDoc.prepareUpdate()},pushUpdateView:function(l){this._treeDoc.pushUpdate();this._manager.pushUpdateView();this._manager._giveFocus(true)},pushUpdateViewAndUpdateGraph:function(l){this.updateNodes();this.pushUpdateView();this._updateGraph()},onSelectListView:function(l){var m=l.data.nodeModel.__MASTER__;if(!this._model.getXSO().isIn(m)){m.select()}},onUnselectListView:function(l){var m=l.data.nodeModel.__MASTER__;if(this._model.getXSO().isIn(m)){m.unselect()}},onSelectMaster:function(l){var m=l.data.nodeModel;m.__LISTVIEWCOPY__&&(!this._treeDoc.getXSO().isIn(m.__LISTVIEWCOPY__))&&m.__LISTVIEWCOPY__.select();this.options.highlightNodesOnSelect&&this._updateGraphSelection()},onUnselectMaster:function(l){var m=l.data.nodeModel;if(this._treeDoc.getXSO().isIn(m.__LISTVIEWCOPY__)){m.__LISTVIEWCOPY__.unselect()}this.options.highlightNodesOnSelect&&this._updateGraphSelection()},_addEvent:function(l,m,n){switch(l){case"LISTVIEWMODEL":this._listViewModelEventTokens[m]=this._listViewModelEventTokens[m]||this._treeDoc.subscribe({event:m},n);break;case"LISTVIEWMANAGER":this._listViewManagerEventTokens[m]=this._listViewManagerEventTokens[m]||this._manager._modelEvents.subscribe({event:m},n);break;case"MASTER":this._masterModelEventTokens[m]=this._masterModelEventTokens[m]||this._model.subscribe({event:m},n);break}},_removeEvent:function(l,m){switch(l){case"LISTVIEWMODEL":this._listViewModelEventTokens[m]&&this._treeDoc.unsubscribe(this._listViewModelEventTokens[m],this._listViewModelEventTokens[m]=undefined);break;case"LISTVIEWMANAGER":this._listViewManagerEventTokens[m]&&this._manager._modelEvents.unsubscribe(this._listViewManagerEventTokens[m],this._listViewManagerEventTokens[m]=undefined);break;case"MASTER":this._masterModelEventTokens[m]&&this._model.unsubscribe(this._masterModelEventTokens[m],this._masterModelEventTokens[m]=undefined);break}},onMasterNodeAttributeChanged:function(l){var o,p;o=l.target;p=o.__LISTVIEWCOPY__;if(p){var m={};m[l.data.changedAttribute]=l.data.changedAttributeValue;if(typeof p.refreshNodeData==="function"){p.refreshNodeData(m)}else{p.setAttribute(l.data.changedAttribute,l.data.changedAttributeValue)}this._manager.updateRowView(p._getRowID())}},updateColumns:function(m){var o=(typeof m==="boolean")?m:true,q=this.options.columnManager,p=q.getColumns();o&&this.loadColumns(p);for(var n=0,l=p.length;n<l;n++){this._manager[(p[n].isHidden?"hideColumn":"showColumn")](p[n].dataIndex)}},getColumnManager:function(){return this.options.columnManager},prepareUpdateColumns:function(){this._isPreparingColumns++;this.prepareUpdateView()},pushUpdateColumns:function(){this._isPreparingColumns--;if(this._isPreparingColumns===0){this.updateColumns();this.pushUpdateView()}else{if(this._isPreparingColumns<0){this._isPreparingColumns===0}}},onSort:function(l){var n="__GRAPH__",m=this._manager;if((typeof this.options.graphSortingColumnID==="string"&&l.columnDataIndex===this.options.graphSortingColumnID)||(Array.isArray(this.options.graphSortingColumnID)&&this.options.graphSortingColumnID.indexOf(l.columnDataIndex)>=0)){this.options.ascending=(l.sortOrder==="asc");this._updateGraph();(m.isColumnHidden(n))&&(m.elements.poolContainerRel.getElement(".subway-graph-canvas").show(),m.showColumn(n))}else{(!m.isColumnHidden(n))&&(m.hideColumn(n),m.elements.poolContainerRel.getElement(".subway-graph-canvas").hide())}},cleanup:function(){this.deactivate();this.empty()},setFocus:function(l){if(l instanceof e){this._manager._setActiveAndScrollToNode(l.__LISTVIEWCOPY__)}},setRowHeight:function(l){var m=this._manager;if(!isNaN(l)&&l>0&&m.options.defaultCellHeight!==l){this.prepareUpdateView();m.options.defaultCellHeight=l;this.pushUpdateViewAndUpdateGraph()}}},k);return d});