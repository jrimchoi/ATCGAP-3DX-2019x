define("DS/VCXWebModifiables/VCXModifiableServer",["UWA/Class"],function(a){var b=a.extend({init:function(){this._HashTableModifiable={};this._maxID=0},unInitialize:function(){this._HashTableModifiable={};this._maxID=0},GetHashTable:function(){return this._HashTableModifiable},AddModifiable:function(d){var c=d.GetHashing();if(c){if(this._HashTableModifiable[c]){return}var e=parseInt(c,16);if(e){if(e>this._maxID){console.log("HASHING : update max ID, we should not go here anymore");this._maxID=e}}}else{c=(this._maxID+1).toString(16);d.SetHashing(c);this._maxID++}this._HashTableModifiable[c]=d},RemoveModifiable:function(c){delete this._HashTableModifiable[c]},GetModifiableFromHashing:function(d){var c=this._HashTableModifiable[d];if(typeof c==="undefined"){return null}return c}});return b});define("DS/VCXWebModifiables/VCXMetaPropertyManager",["DS/WebApplicationBase/W3AAManager",],function(b){var a=b.extend({init:function(){this._MetaPropertyDef={}},initialize:function(){},unInitialize:function(){this._MetaPropertyDef={}},AddMetaPropertyDef:function(d){var c=d.GetPropertyInfo().GetPropertyName();this._MetaPropertyDef[c]=d},GetMetaPropertyDef:function(c){return this._MetaPropertyDef[c]}});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXMetaPropertyManager"}});return a});define("DS/VCXWebModifiables/VCXModifiable",["UWA/Class","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueEnum"],function(c,i,g,f,k,j,b,h,d,a){var e=c.extend({init:function(){this._metaPropSet=null;this._scenarioManager=null;this._linkedPropertyManager=null;this._styleID=""},GetMetaProperties:function(l){if(this._metaPropSet){l.Merge(this._metaPropSet)}},Build:function(){var l=this.GetObject();if(l._experienceBase){if(l._experienceBase.getManager("VCXScenarioManager")){l._experienceBase.getManager("VCXScenarioManager").ModifiableServer.AddModifiable(this)}}},GetType:function(){return"VCXModifiable"},SetHashing:function(l){this._hashing=l},GetHashing:function(){return this._hashing},SetStyle:function(n){if(e.prototype.bInCriticalSectionOnChangePropertyStyle!==true){e.prototype.bInCriticalSectionOnChangePropertyStyle=true;if(this.GetObject().GetType()!=="VCXComponentStyle"){var l=this.GetObject();var m=l._experienceBase.getManager("VCXStylesManager");if(m){if(n!=this._styleID){console.log("stylesManager.UnSubscribe "+this._styleID);m.UnSubscribe(this,this._styleID);this._styleID=n;console.log("stylesManager.Subscribe "+this._styleID);m.Subscribe(this,this._styleID)}}else{this._styleID=""}e.prototype.bInCriticalSectionOnChangePropertyStyle=false;return true}e.prototype.bInCriticalSectionOnChangePropertyStyle=false}return false},OnChangeProperty:function(n,m){if(n==="Modifiable.StyleID"){var p=m.GetValue();return this.SetStyle(p)}else{if(n==="Modifiable.Style"){return true}else{if(n.slice(0,5)==="Meta."){if(this._metaPropSet===null){this._metaPropSet=new f()}var o=this._metaPropSet.GetProperty(n);if(o){o.SetPropertyValue(m.Clone());return true}else{var l=this.GetObject()._experienceBase.getManager("VCXMetaPropertyManager").GetMetaPropertyDef(n);if(l){var q=new i(l.GetPropertyInfo().Clone(),m.Clone());this._metaPropSet.AddOrModifyProperty(q);return true}else{console.log("VCXModifiable : MetaPropertyDef NOT found !");return false}}}}}return false},OnChangePropertiesEnd:function(){},GetInterpolator:function(l){return null},GetProperty:function(E){var w=null;if(E.slice(0,11)==="Modifiable."){if(E==="Modifiable.ID"){var n=new k();n.SetValue(this.GetObject().GetID());var u=new g(E,1,false,"VCXWebModifiables/VCXWebModifiables");u.SetGroupId("Group.Introspection");w=new i(u,n)}else{if(E==="Modifiable.Type"){var n=new k();n.SetValue(this.GetObject().GetType());var u=new g(E,1,false,"VCXWebModifiables/VCXWebModifiables");u.SetGroupId("Group.Introspection");w=new i(u,n)}else{if(E==="Modifiable.Hashing"){var n=new k();n.SetValue(this.GetHashing());var u=new g(E,1,false,"VCXWebModifiables/VCXWebModifiables");u.SetGroupId("Group.Introspection");w=new i(u,n)}else{if(E==="Modifiable.Level"){var B=-1;var o=this.GetObject();if(o.IsKindOf("VCXWebComponentOccurrence")&&!o.IsDressup){do{B++;var p=o.QueryInterface("VCXIModelNavigable");if(!p){break}var C=p.getParent();if(!C){break}o=C.GetObject()}while(o!==null)}var A=new j();A.SetValue(B);var u=new g(E,1,false,"VCXWebModifiables/VCXWebModifiables");u.SetGroupId("Group.Introspection");w=new i(u,A)}else{if(E==="Modifiable.HasChildren"){var q=false;var o=this.GetObject();if(o.IsKindOf("VCXWebComponentOccurrence")&&!o.IsDressup){var p=o.QueryInterface("VCXIModelNavigable");if(p){q=p.getChildren().length>0}}var r=new b();r.SetValue(q);var u=new g(E,1,false,"VCXWebModifiables/VCXWebModifiables");u.SetGroupId("Group.Introspection");w=new i(u,r)}else{if(E==="Modifiable.StyleID"){if(this.GetObject().GetType()!=="VCXComponentStyle"){var n=new k();n.SetValue(this._styleID);var u=new g(E,g.EBehaviorType.NotAnimable,true,"VCXWebModifiables/VCXWebModifiables");u.SetVisible(false);w=new i(u,n)}}else{if(E==="Modifiable.Style"){var x=this.GetObject().GetType();if(x!=="VCXComponentStyle"){var y=new a();var u=new d(E,g.EBehaviorType.Singleton,false,"VCXWebModifiables/VCXWebModifiables");var t=0;var D=this.GetObject();if(D._experienceBase){var z=D._experienceBase.getManager("VCXStylesManager");if(z){var s=0;u.AddOrModifyChoice(0,"No style");var F=z.stylesForType[x];if(F){for(var v=0;v<F.length;v++){var m=F[v];s=z._stylesIntegerID[m];u.AddOrModifyChoice(s,m);t++}if(this._styleID!=""){s=z._stylesIntegerID[this._styleID]}else{s=0}}y.SetValue(s)}}if(t===0){u.SetVisible(false)}w=new i(u,y)}}}}}}}}}else{if(E.slice(0,5)==="Meta."){if(this._metaPropSet){var l=this._metaPropSet.GetProperty(E);if(l){w=l.Clone()}}}}return w},GetProperties:function(m){var l=new f();this.GetMetaProperties(l);if(this.GetObject()._experienceBase.ModifiablesAdvancedProperties){l.AddOrModifyProperty(this.GetProperty("Modifiable.ID"));l.AddOrModifyProperty(this.GetProperty("Modifiable.Type"));l.AddOrModifyProperty(this.GetProperty("Modifiable.Hashing"));l.AddOrModifyProperty(this.GetProperty("Modifiable.Level"));l.AddOrModifyProperty(this.GetProperty("Modifiable.HasChildren"))}if(this.GetObject().GetType()!=="VCXComponentStyle"){l.AddOrModifyProperty(this.GetProperty("Modifiable.StyleID"));l.AddOrModifyProperty(this.GetProperty("Modifiable.Style"))}return l},RequestModification:function(m){var r=new f();if(m){if(m.GetPropertyInfo().GetPropertyName()==="Modifiable.Style"){var s=m.GetPropertyValue().GetValue();var p=this.GetObject();var n=p._experienceBase.getManager("VCXStylesManager");if(n){var l="";if(s===0){l=""}else{if(n._styles[s]){l=n._styles[s].GetID()}}var t=new k();t.SetValue(l);var q=new g("Modifiable.StyleID",g.EBehaviorType.NotAnimable,true,"VCXWebModifiables/VCXWebModifiables");var o=new i(q,t);r.AddOrModifyProperty(o)}}else{r.AddOrModifyProperty(m)}}return r},GetRequiredPropertiesForTransition:function(){return null},OnChangePropertyBegin:function(n,l){var m=this.GetObject();var o=this.GetHashing();if(!this._scenarioManager){this._scenarioManager=m._experienceBase.getManager("VCXScenarioManager")}this._scenarioManager.AddPropertyToRestoreSet(o,n);if(!this._linkedPropertyManager){this._linkedPropertyManager=m._experienceBase.getManager("VCXLinkedPropertyManager")}if(this._linkedPropertyManager){if(this._linkedPropertyManager.IsLinkedAndNotInFollow(m.GetID(),n)){return true}this._linkedPropertyManager.Follow(m.GetID(),n,l)}return false},IsLiving:function(){return true},_generateMapChoiceFromEnumAndId:function(p,m,n){var q={};var o=Array.isArray(n)&&n;for(var r in p){if(p.hasOwnProperty(r)){if(o&&o.includes(r)){continue}var l=m?m+".":"";q[p[r]]=l+r}}return q}});return e});define("DS/VCXWebModifiables/VCXIModifiable",["DS/WebComponentModeler/CATWebInterface"],function(b){var a=b.singleton({interfaceName:"VCXIModifiable",required:{SetHashing:function(c){},GetHashing:function(){},OnChangeProperty:function(d,c){},OnChangePropertiesEnd:function(){},GetInterpolator:function(c){},GetProperty:function(c){},GetProperties:function(c){},RequestModification:function(c){},GetRequiredPropertiesForTransition:function(){},IsLiving:function(){}},optional:{}});return a});define("DS/VCXWebModifiables/VCXLinkedPropertyManager",["DS/CoreEvents/Events","DS/WebApplicationBase/W3AAManager","DS/VCXWebProperties/VCXColor",],function(a,d,b){var c=d.extend({init:function(){this._links={};this._invertedlinks={};this._isInFollow=false},initialize:function(){},unInitialize:function(){this._links={};this._invertedlinks={};this._isInFollow=false},AddLink:function(m,j,i,n,f){var h=this._links[m];if(h){}else{this._links[m]=h={}}var k=h[j];if(k){}else{h[j]=k={}}var l=k[i];if(l){}else{k[i]=l={}}var e=l[n];if(e){}else{l[n]=e={}}l[n]=e=f;var g=this._invertedlinks[i];if(g){}else{this._invertedlinks[i]=g={}}g[n]=true;a.publish({event:"VCX_LINKS_ADDED"})},RemoveLink:function(l,i,h,m){var e;var g=this._links[l];if(g){var j=g[i];if(j){var k=j[h];if(k){e=k[m];if(typeof e!=="undefined"){delete k[m];var f=this._invertedlinks[h];if(f){if(f[m]){delete f[m]}}}}}}return e},RemoveLinks:function(e){for(var f=0;f<e.length;f++){this.RemoveLink(e[f].inID,e[f].inProp,e[f].outID,e[f].outProp)}a.publish({event:"VCX_LINKS_REMOVED"})},GetLinksFromPropertyName:function(p,o){var f=[];for(var n in this._links){if(this._links.hasOwnProperty(n)){var g=this._links[n];if(g){for(var k in g){if(g.hasOwnProperty(k)){var l=g[k];if(l){for(var h=0;h<o.length;h++){var j=o[h];if(l.hasOwnProperty(j)){var e=l[j];if(e.hasOwnProperty(p)){var m={inID:n,inProp:k,outID:j,outProp:p};f.push(m)}}}}}}}}}return f},IsLinkedAndNotInFollow:function(g,e){if(this._isInFollow===true){return false}var f=this._invertedlinks[g];if(f){if(f[e]){return true}}return false},Follow:function(m,v,z){var p=this._experienceBase.ComponentsMap;var e=this._isInFollow;this._isInFollow=true;var l=this._links[m];if(l){var h=l[v];if(h){for(var q in h){if(h.hasOwnProperty(q)){var y=p.GetComponentFromID(q);if(y){var u=y.QueryInterface("VCXIModifiable");if(u){var n=h[q];for(var j in n){if(n.hasOwnProperty(j)){var s=u.GetProperty(j);if(s){var i=s.GetPropertyValue().GetType();if(z.GetType()===i){u.OnChangeProperty(j,z)}else{if((z.GetType()==="VCXPropertyValueInt"||z.GetType()==="VCXPropertyValueFloat")&&(i==="VCXPropertyValueColor")){var w=z.GetValue();var f=100-((w*100)/100);var o,x,A;if(f<0){f=0}if(f>99){o=255;x=0}else{if(f<50){o=Math.floor(255*(f/50));x=255}else{o=255;x=Math.floor(255*((50-f%50)/50))}}A=0;var k=new b();k.SetRGBA(o/255,x/255,A/255,1);s.GetPropertyValue().SetValue(k);u.OnChangeProperty(j,s.GetPropertyValue())}else{var t=z.ToString();s.GetPropertyValue().FromString(t);u.OnChangeProperty(j,s.GetPropertyValue())}}u.OnChangePropertiesEnd()}}}}}}}}}this._isInFollow=e},UpdateProperties:function(){var f=this._experienceBase.ComponentsMap;for(var k in this._links){var i=f.GetComponentFromID(k);if(i){var j=i.QueryInterface("VCXIModifiable");if(j){if(this._links.hasOwnProperty(k)){var l=this._links[k];if(l){for(var h in l){var g=j.GetProperty(h);var e=g.GetPropertyValue();this.Follow(k,h,e)}}}}}}}});Object.defineProperty(c.prototype,"componentType",{enumerable:true,get:function(){return"VCXLinkedPropertyManager"}});return c});define("DS/VCXWebModifiables/VCXMetaPropertyDef",["UWA/Class",],function(b){var a=b.extend({init:function(d,c){this._propertyInfo=d;this._strType=c;this._strDefaultLabel=null},SetDefaultLabel:function(c){if(c){this._strDefaultLabel=c}},GetDefaultLabel:function(){return this._strDefaultLabel},SetPropertyInfo:function(c){this._propertyInfo=c},GetPropertyInfo:function(){return this._propertyInfo},SetType:function(c){this._strType=c},GetType:function(){return this._strType}});return a});define("DS/VCXWebModifiables/VCXModelChangeListener",["DS/WebApplicationBase/W3AAManager"],function(b){var a=b.extend({initialize:function(){this._changesFlag=~0},unInitialize:function(){},hasChanged:function(c,d){if(d){this._changesFlag|=c}return(this._changesFlag&c)},postUpdate:function(c){this._parent(c);this._changesFlag=0}});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXModelChangeListener"}});a.FChangeFlag={BomID:1<<0,Visibility:1<<1,DressupVisibility:1<<2,};return a});