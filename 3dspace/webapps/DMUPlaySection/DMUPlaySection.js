define("DS/DMUPlaySection/DMUSectionImport",["UWA/Class"],function(a){return a.extend({init:function(b){this.importData=function(d,c){if(d&&c&&b){c.fillObjectAttributes(b,d);c.registerForPostImport(b)}};this.afterImport=function(){if(b){b.buildNode();b.setInEdition(false)}}}})});define("DS/DMUPlaySection/DMUToolsSection",["DS/DMUMeasurable/DMUMathsVector3D","DS/Visualization/ThreeJS_DS","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUToolsMaths","DS/WebPolyPlanarSectionOper/WebPolyPlanarSectionOper"],function(e,b,a,f,d){var c={computeSectionCurvesUsingPolyPlanarOperator:function(i,g,h){var j=new d(i);if(j){return j.Run(g,h)}return{}},computeSectionPlaneReferencial:function(o,j){var h=new b.Vector3((j.max.x+j.min.x)/2,(j.max.y+j.min.y)/2,(j.max.z+j.min.z)/2);var k=a.getViewpointInfo(o.currentViewpoint);var n=e.dot(k.sight.toArray(),[1,0,0]);var m=e.dot(k.sight.toArray(),[0,1,0]);var l=e.dot(k.sight.toArray(),[0,0,1]);var i=Math.abs(n);var g=Math.abs(m);var q=Math.abs(l);var p=new b.Matrix4();if((!f.isLessOrEqual(i,g))&&(!f.isLessOrEqual(i,q))){if(!f.isLessOrEqual(n,0)){p.rotateY(Math.PI/2)}else{p.rotateY(-Math.PI/2)}}else{if(!f.isLessOrEqual(g,q)){if(f.isLessThan(m,0)){p.rotateX(Math.PI/2)}else{p.rotateX(-Math.PI/2)}}else{if(f.isLessThan(l,0)){p.rotateY(Math.PI)}}}p.setPosition(h);return p},checkLineIntersection:function(u,t){var k=u[0][0],j=u[0][1],o=u[1][0],n=u[1][1],h=t[0][0],g=t[0][1],m=t[1][0],l=t[1][1];var v={x:null,y:null,bIsOnLine1:false,bIsOnLine2:false};var i=((l-g)*(o-k))-((m-h)*(n-j));if(i===0){return v}var s=j-g;var r=k-h;var q=((m-h)*s)-((l-g)*r);var p=((o-k)*s)-((n-j)*r);s=q/i;r=p/i;v.x=k+(s*(o-k));v.y=j+(s*(n-j));if(s>0&&s<1){v.bIsOnLine1=true}if(r>0&&r<1){v.bIsOnLine2=true}return v},trimPolylines:function(v,m){var n=[];var h;if(m){h=[[[m.min.x,m.min.y],[m.max.x,m.min.y]],[[m.max.x,m.min.y],[m.max.x,m.max.y]],[[m.max.x,m.max.y],[m.min.x,m.max.y]],[[m.min.x,m.max.y],[m.min.x,m.min.y]]]}var p=false;var r=0,q=0,o=0,s,t,u,w;for(r=0;r<v.length;r++){t=v[r]._Vertices.length;var l=[];for(q=0;q<t;q++){u=new b.Vector2(v[r]._Vertices[q][0],v[r]._Vertices[q][1]);if(!m||(m&&m.containsPoint(u))){l.push([v[r]._Vertices[q][0],v[r]._Vertices[q][1],v[r]._Vertices[q][2]]);p=true}else{s=q;if(p){s=--q;p=false}var g=false;if(s<t-1){for(o=0;o<h.length;o++){w=c.checkLineIntersection(h[o],[[v[r]._Vertices[s][0],v[r]._Vertices[s][1]],[v[r]._Vertices[s+1][0],v[r]._Vertices[s+1][1]]]);if(w.bIsOnLine1&&w.bIsOnLine2){l.push([w.x,w.y,v[r]._Vertices[s][2]]);g=true}}}if(!g&&l.length>0){n.push(l);l=[]}}}if(l.length>0){n.push(l)}}return n}};return c});define("DS/DMUPlaySection/DMUSectionRuler",["UWA/Class","DS/DMUMeasurable/DMUManipulablePlane","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUToolsMaths","DS/Visualization/ThreeJS_DS","DS/Ruler/Ruler","DS/Ruler/AngularRuler"],function(b,a,h,g,e,c,d){var f=b.extend({init:function(r){this._parent();var B=r;var x=r._viewer;var k=r._frameWindow;var l,M,o,q,J,K,u=[],p=[],E=[],n,j,H,F=this;var v=function(Q,R){if(F._robot){var O=new e.Matrix4().makeRotationAxis(Q,R);O.multiply(new e.Matrix4().extractRotation(K));var N=new e.Vector3().getPositionFromMatrix(F._robot.getMatrix());var P=O.setPosition(N);F._robot.setMatrix(P)}},s=function(P){if(M&&P){var O=new e.Vector3().copy(P.axis);var N=M.direction.dot(O);var Q=g.isLessThan(N,0)?2*Math.PI-P.angle:P.angle;M.setValue(M.initValue+Q*180/Math.PI);M.refresh()}},A=function(Q){var S=new e.Matrix4().copy(J);var R=new e.Matrix4().setPosition(new e.Vector3().getPositionFromMatrix(K));var O=new e.Matrix4().getInverse(R).multiply(S);var P=new e.Matrix4().copy(Q).multiply(O);var N=new e.Matrix4().copy(R).multiply(P);B._CBSetGeometry({referential:N})},C=function(){l=new c(k,{offset:95,mainGrad:100,nbSecondaryGrads:9,displayUnit:true});p=[];var N=function(Q){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.TRANSLATION,evt:Q.event})){if(F._robot){F._robot.setVisibility(false)}B._CBManipulationInformation({action:a.ManipulationAction.BEGIN,type:a.ManipulationType.TRANSLATION,evt:Q.event})}};var O=function(S){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.TRANSLATION,evt:S.event})){var Q=B._getCenter();var T=B._CBGetGeometry();var R=T.referential;R.setPosition(Q.clone().add(S.translationVector));B._CBSetGeometry({referential:R});B._CBManipulationInformation({action:a.ManipulationAction.BEGIN,type:a.ManipulationType.TRANSLATION,evt:S.event})}};var P=function(Q){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.TRANSLATION,evt:Q.event})){if(F._robot){F._robot.setVisibility(true)}}B._CBManipulationInformation({action:a.ManipulationAction.END,type:a.ManipulationType.TRANSLATION,evt:Q.event})};p.push(l.subscribe("RulerManipulateBegin",function(Q){N(Q)}));p.push(l.subscribe("RulerManipulate",function(Q){O(Q)}));p.push(l.subscribe("RulerManipulateEnd",function(Q){P(Q)}));q=B._getCenter()},I=function(){var P=150;var O={radius:P,mainGrad:10,nbSecondaryGrads:4,displayUnit:true};M=new d(k,O);var Q=function(S){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.ROTATION,evt:S.event})){var T=B._CBGetGeometry();J=new e.Matrix4().copy(T.referential);if(F._robot){K=new e.Matrix4().copy(F._robot.getMatrix());F._robot.setVisibility(false)}B._CBManipulationInformation({action:a.ManipulationAction.BEGIN,type:a.ManipulationType.ROTATION,evt:S.event})}};var R=function(V){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.ROTATION,evt:V.event})){var S=V.direction.clone().dot(B._getUDirection());var U=V.direction.clone().dot(B._getVDirection());var W=g.areEqual(Math.abs(U),1,"float");var T;if(W){T=!g.isLessOrEqual(U,0)?V.diffAngle:-V.diffAngle;B._CBSetGeometry({referential:J.rotateY(T*Math.PI/180)})}else{T=!g.isLessOrEqual(S,0)?V.diffAngle:-V.diffAngle;B._CBSetGeometry({referential:J.rotateX(T*Math.PI/180)})}if(F._robot){v(V.direction,V.value*Math.PI/180)}B._CBManipulationInformation({action:a.ManipulationAction.BEGIN,type:a.ManipulationType.ROTATION,evt:V.event})}};var N=function(S){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.ROTATION,evt:S.event})){J=undefined;if(F._robot){F._robot.setVisibility(false)}}B._CBManipulationInformation({action:a.ManipulationAction.END,type:a.ManipulationType.ROTATION,evt:S.event})};u=[];u.push(M.subscribe("AngularRulerManipulateBegin",function(S){Q(S)}));u.push(M.subscribe("AngularRulerManipulate",function(S){R(S)}));u.push(M.subscribe("AngularRulerManipulateEnd",function(S){N(S)}))},G=function(O,N){if(M){var P=new e.Vector3().copy(O);M.direction=P.negate();M.setValue(0);M.initValue=M.value;M.origin=new e.Vector3().copy(B._getCenter());M.originVector=new e.Vector3().copy(N);M.display()}},z=function(P,N){if(M&&P){var O=(N?B._getVDirection():B._getUDirection());G(P.manipulator.axis,O)}},w=function(){if(F._robot){F._robot.setToNonGhostState()}},i=function(N){if(F._robot){[F._robot.arrowX,F._robot.arrowY,F._robot.arrowZ,F._robot.translationPlaneYZ,F._robot.translationPlaneXY,F._robot.translationPlaneXZ,F._robot.rotationArcYZ,F._robot.rotationArcXZ,F._robot.rotationArcXY].forEach(function(O){if(O&&O.manipulator&&O.manipulator!==N){O.setToGhostState()}});F._robot.robotHandle.setToGhostState()}},m=function(){var R=new e.Vector3().copy(B._getUDirection());var Q=new e.Vector3().copy(B._getVDirection());var P=new e.Vector3().copy(B._getNormal());var O=new e.Matrix4().makeBasis(R,Q,P.negate());var N=new e.Vector3().copy(B._getCenter());O.setPosition(N);return O},D=function(){if(F._robot){F._robot.setConnectionState(false);F._robot.setVisibility(false)}},y=function(){if(B._CBGetState()===a.State.INEDITION){if(F._robot){if(!n){F._robot.setVisibility(true);var O=h.buildPathElement(B);if(O){var N=F._robot.snapFilterCallback(O);if(N){F._robot.setConnectionState(true);F._robot.setTarget(N,m());j=N;n=true}}}else{F._robot.setMatrix(m())}}}else{if(n){D();n=false}}},t=function(){x.setRobot(true,{snapOnFace:false,showOnlyManipulated:false});F._robot=x.getRobot();F._robot.setDisplayScalingNodes(false);F._robot.setAddToCSO(false);F._robot.setAddToHSO(false);var Q=function(ab){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.TRANSLATION,evt:ab.event})){F.clearRulers();var ac=B._CBGetGeometry();J=new e.Matrix4().copy(ac.referential);K=F._robot.getMatrix();if(ab.eventChannel==="LineTranslationBegin"){l.initOrigin=new e.Vector3().getPositionFromMatrix(K);var Z=ab.manipulator.axis;var ad=new e.Vector3().getPositionFromMatrix(F._robot.getMatrix());var aa=new e.Vector3().copy(Z).multiplyScalar(new e.Vector3().copy(l.initOrigin).sub(ad).dot(Z));l.origin=new e.Vector3().copy(ad).add(aa);var Y=new e.Vector3().copy(l.initOrigin).sub(ad).dot(Z);var X=new e.Vector3().copy(ad).add(new e.Vector3().copy(Z).multiplyScalar(Y));l.setValue(X.distanceTo(ad)*(Y>0?-1:1));l.direction=Z;l.initValue=l.value;l.display()}i();B._CBManipulationInformation({action:a.ManipulationAction.BEGIN,type:a.ManipulationType.TRANSLATION,evt:ab.event})}};var O=function(Y){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.TRANSLATION,evt:Y.event})){var X=new e.Matrix4().makeTranslation(Y.translationVector.x,Y.translationVector.y,Y.translationVector.z);A(X);if(Y.eventChannel==="LineTranslationManipulation"){l.setValue(l.initValue+Y.translationVector.length()*(l.direction.dot(Y.translationVector)>0?1:-1));l.refresh()}B._CBManipulationInformation({action:a.ManipulationAction.DO,type:a.ManipulationType.TRANSLATION,evt:Y.event})}};var S=function(X){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.TRANSLATION,evt:X.event})){J=undefined;K=undefined;w()}B._CBManipulationInformation({action:a.ManipulationAction.END,type:a.ManipulationType.TRANSLATION,evt:X.event})};E=[];E.push(F._robot.subscribe("LineTranslationBegin",function(X){Q(X)}));E.push(F._robot.subscribe("LineTranslationManipulation",function(X){O(X)}));E.push(F._robot.subscribe("LineTranslationEnd",function(X){S(X)}));E.push(F._robot.subscribe("PlaneTranslationBegin",function(X){Q(X)}));E.push(F._robot.subscribe("PlaneTranslationManipulation",function(X){O(X)}));E.push(F._robot.subscribe("PlaneTranslationEnd",function(X){S(X)}));var U=function(ac){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.ROTATION,evt:ac.event})){F.clearRulers();var X=F._robot.getMatrix().elements;var Z=new e.Vector3().copy(ac.manipulator.axis);var ag=new e.Vector3(X[0],X[1],X[2]).normalize();var af=new e.Vector3(X[4],X[5],X[6]).normalize();var ae=new e.Vector3(X[8],X[9],X[10]).normalize();var ab=Math.round(ag.dot(Z)*100);var aa=Math.round(af.dot(Z)*100);var Y=ae;if(g.isZero(ab)){Y=ag}else{if(g.isZero(aa)){Y=af}}G(Z,Y);var ad=B._CBGetGeometry();J=new e.Matrix4().copy(ad.referential);K=F._robot.getMatrix();i();B._CBManipulationInformation({action:a.ManipulationAction.BEGIN,type:a.ManipulationType.ROTATION,evt:ac.event})}};var R=function(Y){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.ROTATION,evt:Y.event})){var X=new e.Matrix4().makeRotationAxis(Y.axis,Y.angle);A(X);s(Y);B._CBManipulationInformation({action:a.ManipulationAction.BEGIN,type:a.ManipulationType.ROTATION,evt:Y.event})}};var T=function(X){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.ROTATION,evt:X.event})){M.display();J=undefined;w()}B._CBManipulationInformation({action:a.ManipulationAction.END,type:a.ManipulationType.ROTATION,evt:X.event})};E.push(F._robot.subscribe("RotationBegin",function(X){U(X)}));E.push(F._robot.subscribe("RotationManipulation",function(X){R(X)}));E.push(F._robot.subscribe("RotationEnd",function(X){T(X)}));var W=function(X){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.TRANSLATION,evt:X.event})){F.clearRulers();i();B._setPlaneVisibility(false);B._CBManipulationInformation({action:a.ManipulationAction.BEGIN,type:a.ManipulationType.TRANSLATION,evt:X.event})}};var P=function(X){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.TRANSLATION,evt:X.event})){B._CBManipulationInformation({action:a.ManipulationAction.BEGIN,type:a.ManipulationType.TRANSLATION,evt:X.event})}};var N=function(ae){if(B._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.ROTATION})){w();B._setPlaneVisibility(true);var X=ae.intersection;var af=X.position&&X.path.length;if(af&&ae.intersection&&j&&H){var ai=B._CBGetGeometry();var ah=ai.referential;var Z=X.normal.negate();Z.normalize();var ab=new e.Vector3(1,0,0).projectOnPlane(Z);var ag=ab.length();var aa=new e.Vector3(0,1,0).projectOnPlane(Z);var ad=aa.length();var Y=new e.Vector3().crossVectors(new e.Vector3(0,0,1),Z);var ac=new e.Vector3(0,0,1).dot(Z);if(g.areEqual(Math.abs(ac),1,"float")){if(g.areEqual(ag,ad,"float")){ab.normalize();aa=new e.Vector3().crossVectors(Z,ab).normalize()}else{if(ag<ad){aa.normalize();ab=new e.Vector3().crossVectors(aa,Z).normalize()}else{ab.normalize();aa=new e.Vector3().crossVectors(Z,ab).normalize()}}}else{ab=Y.normalize();aa=new e.Vector3().crossVectors(Z,ab).normalize()}ah.makeBasis(ab,aa,Z);ah.setPosition(X.position.clone());B._CBSetGeometry({referential:ah});F._robot.setConnectionState(true);F._robot.setTarget(j,m())}else{F._robot.setConnectionState(true);F._robot.setTarget(j,m())}}B._CBManipulationInformation({action:a.ManipulationAction.END,type:a.ManipulationType.TRANSLATION,evt:ae.event})};E.push(F._robot.subscribe("ScreenPlaneTranslationBegin",function(X){W(X)}));E.push(F._robot.subscribe("ScreenPlaneTranslationManipulation",function(X){P(X)}));E.push(F._robot.subscribe("ScreenPlaneTranslationEnd",function(X){N(X)}));var V=function(Y){if(!Y){return null}H=null;var X=3;var Z=Y;var aa=false;while(Z.externalPath.length>X){if(!Z.externalPath[Z.externalPath.length-1]._ruler||!Z.externalPath[Z.externalPath.length-1]._ruler._robot){Z=Z.getParentOccurrencePath()}else{aa=true;break}}if(!aa){H=Z.getParentOccurrencePath()}return(aa?Z:null)};F._robot.setSnapFilterCallback(function(X){return V(X)});y()},L=function(){C();I();t()};this.clean=function(){var N=this;if(this._robot&&E&&E.length>0){E.forEach(function(O){N._robot.unsubscribe(O)});E=[]}if(l&&p&&p.length>0){p.forEach(function(O){l.unsubscribe(O)});p=[]}if(M&&u&&u.length>0){u.forEach(function(O){M.unsubscribe(O)});u=[]}this.clearRulers()};this.update=function(){if(l){l.setVisibleFlag(true)}if(M){M.setVisibleFlag(true)}y()};this.updateOnTranslationBegin=function(N){o=B._getCenter();this.clearAngularRuler();if(this._robot){K=new e.Matrix4().copy(this._robot.getMatrix())}i(N.manipulator);this._robot.setVisibility(false)};this.updateOnTranslation=function(Q){var N=function(T,R){if(l){var U=B._getCenter().clone();var S=new e.Vector3().copy(R).sub(U).dot(T);l.value=U.distanceTo(R)*(S>0?-1:1);l.direction=T;l.display()}};if(l){var P=Q.manipulator.axis;var O=q.clone();l.origin=o.clone().add(P.clone().multiplyScalar(O.clone().sub(o).dot(P)));N(P,O)}};this.updateOnTranslationEnd=function(){o=undefined;this._robot.setVisibility(true)};this.updateOnRotationBegin=function(N,O){this.clearLinearRuler();z(N,O);if(this._robot){K=new e.Matrix4().copy(this._robot.getMatrix())}i(N.manipulator);this._robot.setVisibility(false)};this.updateOnRotation=function(N){s(N);v(N.axis,N.angle)};this.updateOnRotationEnd=function(){w();this._robot.setVisibility(true)};this.clearRulers=function(){this.clearLinearRuler();this.clearAngularRuler()};this.clearLinearRuler=function(){if(l){l.clear();q=B._getCenter()}};this.clearAngularRuler=function(){if(M){M.clear()}};L();return this}});return f});define("DS/DMUPlaySection/DMUSectionNode3D",["DS/DMUBaseUI/DMUNode3D","DS/DMUBaseExperience/EXPUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUManipulablePlane","DS/DMUBaseExperience/DMUContextManager","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/DMUPlaySection/DMUSectionRuler","DS/Core/Events","DS/WebappsUtils/WebappsUtils","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUBaseExperience/EXP3DReviewWidgetSingleton","DS/Visualization/ClippingContext","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/CATRelatedData3DGrid/CATRelatedData3DGridView"],function(b,h,n,i,l,m,j,e,d,f,a,k,p,g,c){var o=b.extend({init:function(V){this._parent(V);var w=this;var au=V._typeApps!=="3dPlay"&&h.isEnvActivated("sectionruler",true);var L=false,am=false,U=false;var N;var B=new m.Plane();var ac=new m.Plane();var Y=new m.Plane();var q=new m.Plane();var I=new m.Plane();var ar=new m.Plane();var Q=new m.Plane();var ah,ae,aq,at,ao,D,H,s,x,Z,J,ab,an;var ai=[],T=[],aa=[];var ak;var ag;var v=false;var X=h.isEnvActivated("psection",true);var E=new m.Box3();this.setIcon(f.getWebappsAssetUrl("DMUBaseUI","icons/32/I_WebSection.png"));this.typeCBDMU="Section";var P=function(ax){if(ax){if(ax.setFrustumCulled){ax.setFrustumCulled(false)}if(ax.children){for(var aw=0;aw<ax.children.length;aw++){P(ax.children[aw])}}}};function G(az){var ay=V.getAttribute("fXDirSize");if(az==="Right"||az==="Left"){ay=V.getAttribute("fSliceOffset")}var aw=V.getAttribute("fYDirSize");if(az==="Top"||az==="Bottom"){aw=V.getAttribute("fSliceOffset")}var ax={referential:V._getPlanReferential(az),uSize:ay,vSize:aw,uStep:V.getAttribute("fXDirGridStep"),vStep:V.getAttribute("fYDirGridStep")};return ax}function ap(aw){if(aw){if(aw.uSize){V.setAttribute("fXDirSize",aw.uSize)}if(aw.vSize){V.setAttribute("fYDirSize",aw.vSize)}if(aw.uStep){V.setAttribute("fXDirGridStep",aw.uStep)}if(aw.vStep){V.setAttribute("fYDirGridStep",aw.vStep)}if(aw.referential){V.setAttribute("mPlaneReferential",aw.referential);V.modifyPlaneReferential(aw.referential)}}}function O(){var aw=i.State.STANDARD;if(V.isInEdition()){aw=i.State.INEDITION}return aw}function W(){return V.getAttribute("bVisible")}function r(){var aw={mode:i.DisplayMode.PLANE,fillColor:V.getAttribute("cFillStyleColor"),opacity:V.getAttribute("fOpacity")};if(V.getAttribute("sDisplayPlaneMode")==="Grid"){aw.mode=i.DisplayMode.GRID}return aw}function A(){var aw=h.allowManipulation({object:"Section",viewer:V._viewer});if(typeof aw==="boolean"){return !aw}var ay=h.checkIfCommandIsRunning(V._viewer);if(ay){var ax=h.getCurrentCommand(V._viewer);if(ax==="SelectiveSectionContextCmdHdr"){a.addInCSO(V,false);ay=false}}return ay}function F(ax){var aw=true;if(!(ax&&(ax.type===i.ManipulationType.TRANSLATION||ax.type===i.ManipulationType.ROTATION||ax.type===i.ManipulationType.RESIZE||ax.type===i.ManipulationType.CENTER))){return aw}switch(ax.action){case i.ManipulationAction.ENABLE:if(undefined===ag){ag=V.isReadOnly()||A()}aw=!ag;break;case i.ManipulationAction.BEGIN:if(!ag){if(ax.type===i.ManipulationType.CENTER){w.enableClipping(false);V._viewer.setSectionCapping(false)}V.beginManipulation()}break;case i.ManipulationAction.DO:if(!ag){V.doManipulation()}break;case i.ManipulationAction.END:if(!ag){if(ax.type===i.ManipulationType.CENTER){w.enableClipping(true);V._viewer.setSectionCapping(true)}V.endManipulation(ax.evt)}ag=undefined;break;default:break}return aw}function aj(ax){var aw=!V.isReadOnly();var ay=V.getAttribute("sPlaneBoxMode");if((ay==="SliceMode"||ay==="BoxMode")){aw=false}return new i({viewer:V._viewer,frameWindow:V._frmWindow,bTranslationManipulator:aw,bRotationManipulator:aw,bResizeManipulator:aw,bCenterManipulator:aw,sType:ax,RulerClass:(au?e:undefined),getState:O,getShowState:W,getGeometry:G,setGeometry:ap,getDisplayInformation:r,getManipulationInformation:F})}function K(aw){var ay=V.getAttribute("sPlaneBoxMode");var ax=V.getAttribute("sDisplayPlaneMode");if(ax!=="Grid"){if(aw==="Back"&&(ay==="SliceMode"||ay==="BoxMode")){if(!at){at=aj(aw);at.setName(V._nls._sectionplane);ae=new j();ae.setVisibilityInTree(false);w.addChild(ae);ae.addChild(at)}}if(ay==="BoxMode"){if(aw==="Top"){if(!Z){Z=aj(aw);Z.setName(V._nls._sectionplane);ao=new j();ao.setVisibilityInTree(false);w.addChild(ao);ao.addChild(Z)}}else{if(aw==="Bottom"){if(!J){J=aj(aw);J.setName(V._nls._sectionplane);D=new j();D.setVisibilityInTree(false);w.addChild(D);D.addChild(J)}}else{if(aw==="Right"){if(!ab){ab=aj(aw);ab.setName(V._nls._sectionplane);H=new j();H.setVisibilityInTree(false);w.addChild(H);H.addChild(ab)}}else{if(aw==="Left"){if(!an){an=aj(aw);an.setName(V._nls._sectionplane);s=new j();s.setVisibilityInTree(false);w.addChild(s);s.addChild(an)}}}}}}}}function ad(){var ax=V.getAttribute("fXDirSize");var aD=V.getAttribute("fYDirSize");var ay=0;var aC=V.getAttribute("sPlaneBoxMode");if((aC==="SliceMode"||aC==="BoxMode")){ay=V.getAttribute("fSliceOffset")}var aw=V.getAttribute("fXDirGridStep");var aA=V.getAttribute("fYDirGridStep");if(!aw){aw=ax/10}if(!aA){aA=aD/10}var az=V.getAttribute("iGridAbsoluteMode");var aB=l.getReviewContext({viewer:V._viewer});x=new c({window:V._frmWindow,viewer:V._viewer,context:aB,nbMaxLabel:300,stepRequiredX:aw,stepRequiredY:aA,stepRequiredZ:ay===0?0:aw,gridMatrix:new m.Matrix4().copy(V._getPlanReferential()),freeZoneDim:V._viewer.canvas.getBoundingClientRect(),id:"Section",owner:ah,isEditable:false,isLabelManipulable:false,isAbsoluteMode:az===1})}function R(){if(ah){return}ah=new j();ah.setVisibilityInTree(false);w.addChild(ah);var aw=V.getAttribute("sDisplayPlaneMode");if(aw!=="Grid"){aq=new aj();aq.setName(V._nls._sectionplane);ah.addChild(aq);K("Back");K("Top");K("Bottom");K("Right");K("Left")}else{ad()}w.addChild(V.getSectionCurveNode())}function af(ax){if(!ax){var aD=V._viewer.currentViewpoint.position.distanceTo(V._viewer.currentViewpoint.target);ax=7*V.getAttribute("fXDirSize")/aD}var aB=n.getRootReferences(V._viewer);var aw=new m.HatchingMeshMaterial({stripesDirection:new m.Vector2(1,1),spaceWidth:5,stripesWidth:ax,autoStripesColor:true});for(var ay=0;ay<aB.length;ay++){aB[ay].setSectionCappingMaterial(aw);v=true}var aA=n.getSceneRoot(V._viewer).children;var aC=aA.length;for(var az=0;az<aC;az++){if(aA[az].toBeSectionned){aA[az].setSectionCappingMaterial(aw);v=true}}}function al(){if(v){var az=n.getRootReferences(V._viewer);for(var aw=0;aw<az.length;aw++){az[aw].removeSectionCappingMaterial(B);v=false}var ay=n.getSceneRoot(V._viewer).children;var aA=ay.length;for(var ax=0;ax<aA;ax++){if(ay[ax].toBeSectionned){ay[ax].removeSectionCappingMaterial(B);v=false}}}}function t(){ai=[];T=[];var ay,aF,aA,ax;var aB=V.collectCutObjects(ay,aF,U);ay=aB.CutObjects;aF=aB.NoCutObjects;U=aB.bIsPartial;var aD=0,az=0;if(U){aD=V._bIsInShowSpace?ay.length:aF.length;for(az=0;az<aD;az++){aA=V._bIsInShowSpace?ay[az]:aF[az];if(aA){ax=n.getLastInstance(aA);ai.push(ax.getLastElement())}}}else{if(V._bIsInShowSpace){ai=n.getRootReferences(V._viewer);T=aF}else{aD=aF.length;for(az=0;az<aD;az++){aA=aF[az];if(aA){ax=n.getLastInstance(aA);ai.push(ax.getLastElement())}}}var aC=l.getContextViewer({viewer:V._viewer});if(aC.getController){var aE=aC.getController();if(aE&&aE.getLoadingBoxesBag){var aw=null;aw=aE.getLoadingBoxesBag();if(aw){ai.push(aw)}}}}}function av(ax){if(V._viewer._expClippingManager){var aw=V._getPlanReferential();if(V._sectionId===undefined){V._sectionId=V._viewer._expClippingManager.addPlane(aw,ax)}else{V._viewer._expClippingManager.updatePlane(V._sectionId,aw,ax)}}}function S(){var ay=true;var aA=l.getReviewContext({viewer:V._viewer});if(aA&&(!aA.isVisible()||(aA.getCurrentReview()&&!aA.getCurrentReview().isVisible()))){ay=false}var aC=V.getAttribute("sPlaneBoxMode");if(true===ay){var ax=new m.Matrix4().translate(new m.Vector3(0,0,0.1));if(aq){aq.setMatrix(ax)}if(at){at.setMatrix(ax)}if(Z){Z.setMatrix(ax)}if(J){J.setMatrix(ax)}if(ab){ab.setMatrix(ax)}if(an){an.setMatrix(ax)}ah.setMatrix(V._getPlanReferential());if((aC==="SliceMode"||aC==="BoxMode")&&ae){ae.setMatrix(V._getPlanReferential("Back"))}if(aC==="BoxMode"){if(ao){ao.setMatrix(V._getPlanReferential("Top"))}if(D){D.setMatrix(V._getPlanReferential("Bottom"))}if(H){H.setMatrix(V._getPlanReferential("Right"))}if(s){s.setMatrix(V._getPlanReferential("Left"))}}var aB=V.getAttribute("sSectionRender");var az=V.getAttribute("bVisible");if(L&&az&&N&&aB!==N&&N!=="NoCut"){V._viewer.removeClippingPlane(B);if(ac){V._viewer.removeClippingPlane(ac)}w.enableClipping(false);V._viewer.setSectionCapping(false);L=false}N=aB;if(aB==="CutOneSide"){if(!L&&az){L=true;V._viewer.addClippingPlane(B);if(aC==="SliceMode"){V._viewer.addClippingPlane(Y)}else{if(aC==="BoxMode"){V._viewer.addClippingPlane(q);V._viewer.addClippingPlane(I);V._viewer.addClippingPlane(Q);V._viewer.addClippingPlane(ar)}}w.enableClipping(true);V._viewer.setSectionCapping(true)}if(L&&!az){L=false;V._viewer.removeClippingPlane(B);if(aC==="SliceMode"){V._viewer.removeClippingPlane(Y)}else{if(aC==="BoxMode"){V._viewer.removeClippingPlane(q);V._viewer.removeClippingPlane(I);V._viewer.removeClippingPlane(Q);V._viewer.removeClippingPlane(ar)}}w.enableClipping(false);V._viewer.setSectionCapping(false)}if(L&&az&&!V._viewer.getSectionCapping()){V._viewer.setSectionCapping(L)}}if(aB==="OnlyContour"){if(!L&&az){L=true;var aw=new m.Matrix4().copy(V._getPlanReferential());ac.setFromNormalAndCoplanarPoint(new m.Vector3(0,0,1),new m.Vector3(0,0,0));ac.applyMatrix4(aw.rotateX(Math.PI));V._viewer.addClippingPlane(B);V._viewer.addClippingPlane(ac);w.enableClipping(true);V._viewer.setSectionCapping(false)}if(L&&!az){L=false;V._viewer.removeClippingPlane(B);V._viewer.removeClippingPlane(ac);w.enableClipping(false);V._viewer.setSectionCapping(false)}}av(L)}}function C(){var aw=V.getAttribute("bVisible");if(!V._bIsInShowSpace){aw=!aw}w.setVisibility(aw);if((am||(V.getAttribute("sDisplayPlaneMode")==="NoPlane"))&&aw){aw=!aw}if(aq){aq.setVisibility(aw);aq.setVisibilityFree(am)}if(at){at.setVisibility(aw);at.setVisibilityFree(am)}if(Z){Z.setVisibility(aw);Z.setVisibilityFree(am)}if(J){J.setVisibility(aw);J.setVisibilityFree(am)}if(ab){ab.setVisibility(aw);ab.setVisibilityFree(am)}if(an){an.setVisibility(aw);an.setVisibilityFree(am)}S();B.setFromNormalAndCoplanarPoint(new m.Vector3(0,0,1),new m.Vector3(0,0,0));B.applyMatrix4(V._getPlanReferential());if(V.getAttribute("sPlaneBoxMode")==="SliceMode"||V.getAttribute("sPlaneBoxMode")==="BoxMode"){Y.setFromNormalAndCoplanarPoint(new m.Vector3(0,0,1),new m.Vector3(0,0,0));Y.applyMatrix4(V._getPlanReferential("Back"))}if(V.getAttribute("sPlaneBoxMode")==="BoxMode"){if(q){q.setFromNormalAndCoplanarPoint(new m.Vector3(0,0,1),new m.Vector3(0,0,0));q.applyMatrix4(V._getPlanReferential("Top"))}if(I){I.setFromNormalAndCoplanarPoint(new m.Vector3(0,0,1),new m.Vector3(0,0,0));I.applyMatrix4(V._getPlanReferential("Bottom"))}if(ar){ar.setFromNormalAndCoplanarPoint(new m.Vector3(0,0,1),new m.Vector3(0,0,0));ar.applyMatrix4(V._getPlanReferential("Right"))}if(Q){Q.setFromNormalAndCoplanarPoint(new m.Vector3(0,0,1),new m.Vector3(0,0,0));Q.applyMatrix4(V._getPlanReferential("Left"))}}w.highlightIfNeeded()}function z(aw,ax){if(Array.isArray(aw)){for(var ay=0;ay<aw.length;ay++){z(aw[ay],ax)}}else{aw.enableClippingPlane(B,ax);if(V.getAttribute("sSectionRender")==="OnlyContour"){aw.enableClippingPlane(ac,ax)}else{var az=V.getAttribute("sPlaneBoxMode");if(az==="SliceMode"||az==="BoxMode"){aw.enableClippingPlane(Y,ax)}if(az==="BoxMode"){aw.enableClippingPlane(q,ax);aw.enableClippingPlane(I,ax);aw.enableClippingPlane(ar,ax);aw.enableClippingPlane(Q,ax)}}}}this.enableClipping=function(ay){var aA,aB;if(!w){return}if(aa){z(aa,false);if(ak){aB=V._viewer.getSceneGraphOverrideSetManager();aB.removeSceneGraphOverrideSet(ak);ak=null}}t();z(ai,ay);aa=ai;if(!U&&T.length>0){ak=new g(n.getRootBag(V._viewer));var ax=ak.createOverride(T);if(ax){var aw=new p();aw.setAntiPlanes([B]);ax.setClippingContext(aw);aB=V._viewer.getSceneGraphOverrideSetManager();aB.pushSceneGraphOverrideSet(ak)}}var az=n.getSceneRoot(V._viewer).children;for(aA=0;aA<az.length;aA++){if(az[aA].toBeSectionned){az[aA].enableClippingPlane(B,ay)}}};this.clean=function(){if(!w){return}var aw=n.getRootReferences(V._viewer);z(aw,false);z(aa,false);al();w.clearRulers();if(x&&ah){x.deleteGrids({owner:ah,fromStorage:true});x.setActiveState(false)}w=ah=aq=ak=x=null;L=false;am=false;U=false;ag=false;B=new m.Plane();ai.length=0;T.length=0;aa.length=0};this.resetClippingFlag=function(){L=false};function u(){x.setActiveState(true);var aw=V.getAttribute("fXDirSize");var az=V.getAttribute("fYDirSize");var ax=0;var ay=V.getAttribute("sPlaneBoxMode");if((ay==="SliceMode"||ay==="BoxMode")){ax=V.getAttribute("fSliceOffset")}if(E){E.set(new m.Vector3(-aw/2,-az/2,0),new m.Vector3(aw/2,az/2,ax))}x.drawGrids({specifications:[{BBox:E}]})}this.update=function(){if(!w){return}w.setName(V.getAttribute("sName"));if(aq){aq.update()}if(x&&ah){x.deleteGrids({owner:ah,fromStorage:true});x.setActiveState(false)}var ax=V.getAttribute("sDisplayPlaneMode");var aw=V.getAttribute("bVisible");if((ax==="Grid")&&x&&ah&&aw){u()}if(ax!=="Grid"){if(V.getAttribute("sPlaneBoxMode")==="SliceMode"||V.getAttribute("sPlaneBoxMode")==="BoxMode"){K("Back")}}if(V.getAttribute("bSectionCurvesVisible")&&V.isSectionCurveComputationNeeded()){V.computeCurves();if(V.isSecondaryViewerShow()){V.renderSecondaryViewer()}}C()};this.clearRulers=function(){if(aq){aq.clearRulers()}};this.manageLock=function(aw){if(w&&aw!==am&&V.getAttribute("bVisible")){am=aw;w.update()}};this.isLocked=function(){return am};this.isSectionEnabled=function(){return L};this.getSectionPlane=function(){return B};var M=false;this.onViewerEventCB=function(aw){if("true"===M&&aw.eventType==="@onViewpointChange"){var ax=aw.cameraEye.distanceTo(aw.cameraTarget);af(7*V.getAttribute("fXDirSize")/ax)}};if(X){var y=k.get();if(y){M=y.getValue("Hatching")}if("true"===M){af()}else{al()}}R();P(this);this.update()}});return o});define("DS/DMUPlaySection/DMUSection",["DS/DMUBaseReview/DMUOverloadableObject","DS/Visualization/Node3D","DS/DMUPlaySection/DMUToolsSection","DS/DMUControls/EXPTranslationSlider","DS/DMUControls/EXPColorPicker","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUMeshCreation","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseExperience/EXPNls","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUMathsVector3D","DS/DMUBaseCommands/EXPToolsWUX","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPControllerEvents","DS/DMUControls/EXPClippingManager","DS/DMUMarkupsController/DMUMarkupsController","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/DMUPlaySection/DMUSectionNode3D","DS/DMUPlaySection/DMUSectionImport","DS/DMUBaseUI/DMUInitialization"],function(b,p,c,u,r,g,t,a,n,i,k,j,m,x,f,o,l,e,y,w,v,s,h){var q=[{name:"cFillStyleColor",type:"Color",JSONname:"PropertiesSection.GraphicProperties.FillStyle.color",isOverloadable:true,defaultValue:new x.Color(3575492)},{name:"cLineStyleColor",type:"Color",JSONname:"PropertiesSection.GraphicProperties.LineStyle.color",isOverloadable:true},{name:"sLineStylePattern",type:"int",JSONname:"PropertiesSection.GraphicProperties.LineStyle.pattern",isOverloadable:true},{name:"fLineStyleThickness",type:"int",JSONname:"PropertiesSection.GraphicProperties.LineStyle.thickness",isOverloadable:true},{name:"bVisible",type:"bool",JSONname:"PropertiesSection.GraphicProperties.visible",defaultValue:true,isOverloadable:true},{name:"fOpacity",type:"float",JSONname:"PropertiesSection.GraphicProperties.FillStyle.opacity",isOverloadable:true,defaultValue:0.2},{name:"mPlaneReferential",type:"Matrix4",JSONname:"PropertiesSection.PlaneReferential",isOverloadable:true},{name:"fXDirSize",type:"float",JSONname:"PropertiesSection.XDirSize",isOverloadable:true},{name:"fYDirSize",type:"float",JSONname:"PropertiesSection.YDirSize",isOverloadable:true},{name:"sDisplayPlaneMode",type:"string",JSONname:"PropertiesSection.DisplayPlaneMode",isOverloadable:true,defaultValue:"Plane"},{name:"sDisplayContourMode",type:"string",JSONname:"PropertiesSection.DisplayContourMode",isOverloadable:true,defaultValue:"Contour"},{name:"sSectionRender",type:"string",JSONname:"PropertiesSection.SectionRender",isOverloadable:true,defaultValue:"CutOneSide"},{name:"bPartialClippingMode",type:"bool",JSONname:"PropertiesSection.PartialClippingMode",isOverloadable:true},{name:"sUpdateAndFreezeMode",type:"string",JSONname:"PropertiesSection.UpdateAndFreezeMode",isOverloadable:true,defaultValue:"Update"},{name:"fXDirGridStep",type:"float",JSONname:"PropertiesSection.XDirGridStep",isOverloadable:true},{name:"fYDirGridStep",type:"float",JSONname:"PropertiesSection.YDirGridStep",isOverloadable:true},{name:"sPlaneBoxMode",type:"string",JSONname:"PropertiesSection.PlaneBoxMode",isOverloadable:true,defaultValue:"NormalMode"},{name:"fSliceOffset",type:"float",JSONname:"PropertiesSection.SliceOffset",isOverloadable:true},{name:"vTranslationValue",type:"float",JSONname:"PropertiesSection.TranslationValue",isOverloadable:true,defaultValue:0},{name:"bSectionCurvesVisible",type:"bool",JSONname:"PropertiesSection.SectionCurvesVisible",defaultValue:true,isOverloadable:true},{name:"sTargetIds",type:"listStrings",JSONname:"targetIds",defaultValue:[]},{name:"iGridAbsoluteMode",type:"int",JSONname:"PropertiesSection.GridAbsoluteMode",defaultValue:1,isOverloadable:true}];var d=b.extend({init:function(C,D,R,K){this._parent(C,D,R);this._sExpType="DMUSection";this._parameters=this._parameters.concat(q);this.defineMembersFromParameters();this._sType="Section";this._typeApps=K;this._tokenModelEvent=[];var P=this;this._nSectionCurvesNode=new p();this._nSectionCurvesNode.getDMUType=function(){return P.GetType()};var L=1;var N=new p();var A=true;var M=new x.Matrix4().makeScale(10,0,0);var F=true;var O=false;var z=[];var X=[];var I=[];var E=[];var H=[];this._activeFlag=true;this.setActiveFlag=function(aa){P._activeFlag=aa;if(P._nNode&&(!aa||aa&&P.getAttribute("bVisible"))){P._nNode.enableClipping(aa)}if(!aa&&P._iViewerSecondaryWindow){P._iViewerSecondaryWindow.clear()}};function G(ab){var aa={};if(n.getProxy(ab)!==undefined){aa=n.getProxy(ab)}else{aa._sectioncurves=n.getNls("DMUBaseUI.CAT3DPlayProReview.sectioncurves");aa._sectionplane=n.getNls("DMUBaseUI.CAT3DPlayProReview.sectionplane");n.getProxy(ab,aa)}return aa}this._nls=G(this._sExpType);function J(){if(P._movegauge){var aa=g.getViewpointInfo(P._viewer.currentViewpoint);var ac=P.getNormal();var ab=ac.dot(aa.sight);var ad=Math.abs(ab);if(ad>0.97){L=ab>0?1:-1}P._movegauge.setVisibleFlag(ad>0.97)}}function Q(){P._vTranslationValue=50;if(P._movegauge){P._movegauge.clean()}P._movegauge=new u({frameWindow:P._frmWindow,initValue:a.getValue(P,"vTranslationValue"),onChangeCB:function(aa){if(a.getValue(P,"vTranslationValue")!==undefined){a.setValue(aa,P,"vTranslationValue")}}});J()}function U(){if(P._nSectionCurvesNode!==null){P._nSectionCurvesNode.removeChildren()}if(N!==null){N.removeChildren()}}function Y(){var ad;if((E.length>0)&&(H.length>0)){var ab=P.getAttribute("sLineStylePattern");var ac=P.getAttribute("fLineStyleThickness");var aa=t.createPolylines(E,H,ac,ab);ad=f.createMeshNode(aa);ad.name=P._nls._sectioncurves;ad.measurable=true;ad.setPickParent(true)}return ad}function Z(){var aa=Y();if(aa){N.add(aa)}E=[];H=[]}function W(aa){if(A||P.isSecondaryViewerShow()){var ac=Y();if(ac){var ab=new p();ab.name=P._nls._sectioncurves;ab.measurable=true;ab.setPickParent(true);ab.getDMUType=function(){return P.GetType()};ab.add(ac);if(aa){ab.setMatrix(aa)}P._nSectionCurvesNode.add(ab)}P._nSectionCurvesNode.setVisibility(P._bIsInShowSpace)}if(P.isSecondaryViewerShow()){Z()}}function V(ag,ab,af){E=[];H=[];var aa=ag.aAllPolygons.length;var ac=P.getAttribute("cLineStyleColor");for(var ad=0;ad<aa;ad++){var ae=c.trimPolylines(ag.aAllPolygons[ad]._Polylines,af);if(ae.length>0){E.push(ae);H.push(ac?ac:ag.aAllColors[ad])}}W(ab)}function T(aa){if(aa){P.setSectionCurveUpdateStatus(true);P.refreshNode()}else{P.setSectionCurveUpdateStatus(false)}}function B(){if(!I||I.length===0){I=[];var ab=P.getAttribute("sTargetIds");var ad=ab.length;if(ad>0){var aa;for(var ac=0;ac<ad;ac++){aa=P.getParent().getChildWithID(ab[ac]);I.push(aa.pathElement)}}}return I}var S=this.setInEdition;this.setInEdition=function(aa){if(aa){if(!P.isReadOnly()){Q();P.setLockUnlockCmdState(false)}}else{if(P._movegauge){P._movegauge.clean();P._movegauge=null}P.setLockUnlockCmdState()}S(aa)};this.buildNode=function(){if(!P._nNode){P._nNode=new v(P);P.addNodeInParentNode()}};this.computeCurves=function(){if((this.getAttribute("sPlaneBoxMode")==="BoxMode")&&!(this.getAttribute("sSectionRender")==="OnlyContour")){return}U();var ab=this.getAttribute("mPlaneReferential");var ad;if(this.getAttribute("sPlaneBoxMode")==="BoxMode"){ad=new x.Box2()}var aa=this.getAttribute("fXDirSize");var ac=this.getAttribute("fYDirSize");if(ad){ad.set(new x.Vector2(-aa/2,-ac/2),new x.Vector2(aa/2,ac/2))}if(F&&this.getAttribute("bVisible")&&(A||this.isSecondaryViewerShow())){ab=this.getAttribute("mPlaneReferential");this.collectCutObjects();V(c.computeSectionCurvesUsingPolyPlanarOperator(this._viewer,ab,this._bIsInShowSpace?z:X),ab,ad);M=ab.clone();if(F&&this.getAttribute("bVisible")&&(A||this.isSecondaryViewerShow())){if(this.getAttribute("sPlaneBoxMode")==="SliceMode"||this.getAttribute("sPlaneBoxMode")==="BoxMode"){ab=this._getPlanReferential("Back");V(c.computeSectionCurvesUsingPolyPlanarOperator(this._viewer,ab,this._bIsInShowSpace?z:X),ab,ad)}if(this.getAttribute("sPlaneBoxMode")==="BoxMode"){var ae=this.getAttribute("fSliceOffset");if(ad){ad.set(new x.Vector2(-aa/2,-ae/2),new x.Vector2(aa/2,ae/2))}ab=this._getPlanReferential("Top");V(c.computeSectionCurvesUsingPolyPlanarOperator(this._viewer,ab,this._bIsInShowSpace?z:X),ab,ad);ab=this._getPlanReferential("Bottom");V(c.computeSectionCurvesUsingPolyPlanarOperator(this._viewer,ab,this._bIsInShowSpace?z:X),ab,ad);if(ad){ad.set(new x.Vector3(-ae/2,-ac/2,0),new x.Vector3(ae/2,ac/2,0))}ab=this._getPlanReferential("Right");V(c.computeSectionCurvesUsingPolyPlanarOperator(this._viewer,ab,this._bIsInShowSpace?z:X),ab,ad);ab=this._getPlanReferential("Left");V(c.computeSectionCurvesUsingPolyPlanarOperator(this._viewer,ab,this._bIsInShowSpace?z:X),ab,ad)}}}};this._getPlanReferential=function(ab){var aa=new x.Matrix4().copy(this.getAttribute("mPlaneReferential"));if(ab){var ac=this.getAttribute("fSliceOffset");if(ab==="Back"){aa.rotateX(Math.PI);aa.translate(new x.Vector3(0,0,-ac))}else{if(ab==="Top"){aa.rotateX(-Math.PI/2);aa.translate(new x.Vector3(0,-ac/2,-this.getAttribute("fYDirSize")/2))}else{if(ab==="Bottom"){aa.rotateX(Math.PI/2);aa.translate(new x.Vector3(0,ac/2,-this.getAttribute("fYDirSize")/2))}else{if(ab==="Left"){aa.rotateY(Math.PI/2);aa.translate(new x.Vector3(-ac/2,0,-this.getAttribute("fXDirSize")/2))}else{if(ab==="Right"){aa.rotateY(-Math.PI/2);aa.translate(new x.Vector3(ac/2,0,-this.getAttribute("fXDirSize")/2))}}}}}}return aa};this.isSectionCurveComputationNeeded=function(){var ab=false;if(!this._bUpdateOnModelChange){var aa=this.getAttribute("mPlaneReferential");if(this.getAttribute("bVisible")&&(!j.areMatrixEqual(M.elements,aa.elements)||(this._bVisible!==this.getAttribute("bVisible")))){ab=true}}else{ab=this._bUpdateOnModelChange}return ab};this.isSecondaryViewerShow=function(){return this._iViewerSecondaryWindow&&this._iViewerSecondaryWindow.isShow()};this.beginManipulation=function(){O=true;if(!this.isSecondaryViewerShow()){F=false}if(!F){if(this._viewer.picking.primitive){this._viewer.setRenderMode("SectionLine",true)}}};this.doManipulation=function(aa){if(aa===undefined){T(false)}this._viewer.render()};this.endManipulation=function(aa){F=true;var ab={pathElement:i.buildPathElement(this._nNode)};if(!aa||(aa&&!aa.from[0].event.ctrlKey)){w.empty();w.add(ab)}else{if(w.isIn(ab)){w.remove(ab)}else{w.add(ab)}}T(true);O=false;if(this._viewer.picking.primitive){this._viewer.setRenderMode("SectionLine",false)}};this.setObjects=function(ao,ah){if(ao&&ao.length>0){if(!I){I=[]}var ab=ao.length;var an=this.getParent();for(var af=0;af<ab;af++){var al=an.getOccurenceOnPathElement(ao[af]);var ac=this.getAttribute("sTargetIds");var ai=ac.indexOf(al.id);if(ai>=0){var am=ac.slice(0,ai);var ak=ac.slice(ai+1);ac=am.concat(ak);var ae=I.slice(0,ai);var ad=I.slice(ai+1);I=ae.concat(ad)}else{ac.push(al.id);I.push(ao[af])}this.setAttribute("sTargetIds",ac)}if(!ah){var ag=i.computeBoundingBox(this._viewer,I);var aa=Math.max(ag.max.x-ag.min.x,ag.max.y-ag.min.y,ag.max.z-ag.min.z);var aj=c.computeSectionPlaneReferencial(this._viewer,ag);this._nNode.resetClippingFlag();this.setAttribute("fXDirSize",aa);this.setAttribute("fYDirSize",aa);this.modifyPlaneReferential(aj)}}};this.collectCutObjects=function(){if(z.length===0&&X.length===0){var ac=B();if(ac&&ac.length>0){var ab=ac.length;for(var aa=0;aa<ab;aa++){i.parseForLeafNodes(ac[aa],this._viewer,z,X)}}else{i.parseForLeafNodesOfScene(this._viewer,z,X)}}return{CutObjects:z,NoCutObjects:X,bIsPartial:I&&I.length>0}};this.onViewerEventCB=function(aa){if(this._nNode&&this._nNode.onViewerEventCB){this._nNode.onViewerEventCB(aa)}var ac=this;if(aa.eventType==="beginExplodeCmd"){ac.setAttribute("bVisible",false);var ab={pathElement:i.buildPathElement(this._nNode)};if(w.isIn(ab)){w.remove(ab)}else{ab={pathElement:i.buildPathElement(this._nSectionCurvesNode)};if(w.isIn(ab)){w.remove(ab)}}ac.refreshNode();ac._viewer.render()}else{if(aa.eventType==="endExplodeCmd"){ac.setAttribute("bVisible",true);ac.refreshNode();ac._viewer.render()}else{if(aa.eventType==="@onViewpointChange"){J()}}}};this.setSectionCurveUpdateStatus=function(aa){A=aa};this.refreshNode=function(){if(!P._activeFlag){return}z=[];X=[];if(this._nNode){this._nNode.update()}this._viewer.render()};this.setLockUnlockCmdState=function(aa){if(aa===undefined){aa=O?false:this._userLockUnlockState}if(this._viewer&&this._viewer._lockUnlockCmd){if(aa!==this._viewer._lockUnlockCmd.getState()){this._viewer._lockUnlockCmd.setState(aa)}}};this.manageLock=function(aa){if(this._nNode){this._nNode.manageLock(aa)}};this.manageGraphicsProperties=function(){var aa=this;if(this._colorPicker){this._colorPicker.setVisibleFlag(!this._colorPicker.getVisibleFlag())}else{this._colorPicker=new r({frameWindow:this._frmWindow,onDestroyCB:function(){aa._colorPicker=null}});this._colorPicker.build({displayColorSlider:true,displayOpacitySlider:true,defaultColor:a.getValue(aa,"cFillStyleColor"),onColorChangedCB:function(ab){a.setValue(a.colorToHex(ab.color),aa,"cFillStyleColor")},defaultOpacity:a.getValue(aa,"fOpacity"),onOpacityChangedCB:function(ab){if(a.getValue(aa,"fOpacity")){a.setValue(ab.opacity,aa,"fOpacity")}}})}};this.sectionToX=function(){this._nNode.clearRulers();this.modifyPlaneReferential(new x.Matrix4().rotateY(-Math.PI/2).setPosition(this.getCenter()));this._viewer.render()};this.sectionToY=function(){this._nNode.clearRulers();this.modifyPlaneReferential(new x.Matrix4().rotateX(Math.PI/2).setPosition(this.getCenter()));this._viewer.render()};this.sectionToZ=function(){this._nNode.clearRulers();this.modifyPlaneReferential(new x.Matrix4().rotateY(Math.PI).setPosition(this.getCenter()));this._viewer.render()};this.sectionFlip=function(){this._nNode.clearRulers();var aa=this.getAttribute("mPlaneReferential");var ab={attribute:"mPlaneReferential",value:aa.rotateX(Math.PI)};this.set(ab);this.refreshNode();this._viewer.render();J()};this.sectionViewpoint=function(){this._nNode.clearRulers();var an=this.getAttribute("mPlaneReferential");var ad=this.getAttribute("fXDirSize")*1.5;var af=an.decompose();var aq=af[0];var ak=af[1];var ai=new x.Vector3(1,0,0).applyQuaternion(ak);var aa=new x.Vector3(0,1,0).applyQuaternion(ak);var ae=new x.Vector3(0,0,1).applyQuaternion(ak);var ah=ai.dot(new x.Vector3(0,0,1));var ab=aa.dot(new x.Vector3(0,0,1));var ac=Math.abs(ah);var am=Math.abs(ab);var al=ai;if(k.isZero(ac)&&k.isZero(am)){var ap=g.getViewpointInfo(this._viewer.currentViewpoint);var ao=ai.dot(ap.sight);var ar=aa.dot(ap.sight);var ag=Math.abs(ao);var aj=Math.abs(ar);if(!k.isLessOrEqual(aj,ag)){al=aa.multiplyScalar((k.isLessThan(ar,0))?-1:1)}else{if(!k.isLessOrEqual(ag,aj)){al=ai.multiplyScalar((k.isLessThan(ao,0))?-1:1)}}}else{if(!k.isLessOrEqual(am,ac)){al=aa.multiplyScalar((k.isLessThan(ab,0))?-1:1)}else{if(!k.isLessOrEqual(ac,am)){al=ai.multiplyScalar((k.isLessThan(ah,0))?-1:1)}}}g.moveViewpoint(this._viewer,null,aq,ae,al,ad,400);this.refreshNode();this._viewer.render()};this.sectionCut=function(ab){this._nNode.clearRulers();var aa=ab;a.setValue(aa,this,"sSectionRender")};this.sectionGrid=function(){this._nNode.clearRulers();var aa;if(a.getValue(this,"sDisplayPlaneMode")==="Plane"){aa="Grid"}else{aa="Plane"}a.setValue(aa,this,"sDisplayPlaneMode")};this.sectionSlice=function(){this._nNode.clearRulers();var aa="SliceMode";a.setValue(aa,this,"sPlaneBoxMode");a.setValue(20,this,"fSliceOffset")};this.sectionCancel=function(){m.emptyCSO();this.remove();var ab=y.getReviewContext({viewer:this._viewer});var aa=ab?ab.getCurrentReview():null;if(aa&&!aa.getChildren("DMUMeasure").length&&!aa.getChildren("DMUSection").length){h.stopSwitchExperience({viewer:this._viewer})}this._viewer.render()};this.getTranslationValue=function(){this._bBox=i.computeBoundingBox(this._viewer,I);var aa=Math.max(this._bBox.max.x-this._bBox.min.x,this._bBox.max.y-this._bBox.min.y,this._bBox.max.z-this._bBox.min.z);var ab=new x.Vector3((this._bBox.max.x+this._bBox.min.x)/2,(this._bBox.max.y+this._bBox.min.y)/2,(this._bBox.max.z+this._bBox.min.z)/2);return(this.getCenter().sub(ab)).dot(this.getNormal())*2/aa*L};this.setTranslationValue=function(ae){if(!this._bBox){this._bBox=i.computeBoundingBox(this._viewer,I)}var aa=Math.max(this._bBox.max.x-this._bBox.min.x,this._bBox.max.y-this._bBox.min.y,this._bBox.max.z-this._bBox.min.z);var ad=this.getTranslationValue();var ac=this.getCenter().add(this.getNormal().multiplyScalar(aa*(ae-ad)/2*L));var ab=this.getAttribute("mPlaneReferential");ab.setPosition(ac);this.modifyPlaneReferential(ab);this._viewer.render()};this.modifyPlaneReferential=function(ab){if(ab){var aa=this.getAttribute("mPlaneReferential");var ac={attribute:"mPlaneReferential",value:aa.copy(ab)};this.set(ac);this._updateClippingManager(aa);this._nNode.update()}};this.getCenter=function(){var aa=this.getAttribute("mPlaneReferential");return new x.Vector3().getPositionFromMatrix(aa)};this.getNormal=function(){var aa=this.getAttribute("mPlaneReferential");var ab=aa.decompose();return new x.Vector3(0,0,1).applyQuaternion(ab[1])};this._updateClippingManager=function(aa){if(this._viewer._expClippingManager){this._viewer._expClippingManager.updatePlane(this._sectionId,aa,this._nNode.isSectionEnabled())}};this.renderSecondaryViewer=function(){if(this._iViewerSecondaryWindow){this._iViewerSecondaryWindow.render()}};this.getSectionCurvesFor2DViwer=function(){Z();return N};this.getSectionCurveNode=function(){return this._nSectionCurvesNode};this.GetType=function(){return"DMUSection"}},readJSON:function(B){if(B.attributes){var A=B.attributes.SS_PlanePosition;if(A){if(A.length===12){this._mPlaneReferential=new x.Matrix4(A[0],A[3],-A[6],A[9],A[1],A[4],-A[7],A[10],A[2],A[5],-A[8],A[11],0,0,0,1)}}var z=B.attributes.SS_SectionPlaneDim;if(z&&z.length===2){this._fXDirSize=z[0];this._fYDirSize=z[1]}this._bVisible=true}else{this._parent(B)}this.buildNode();this.setInEdition(false)},remove:function(){if(this._movegauge){this._movegauge.clean();this._movegauge=null}this.setActiveFlag(false);var B=e.giveDMUMarkupsController({context:this._viewer});if(B){B.unregisterMarker(this)}e.unreferenceDMUMarkupsController({context:this._viewer});var z=y.giveEventsController({viewer:this._viewer});if(z){for(var A=0;A<this._tokenModelEvent.length;A++){z.removeEvent(this._tokenModelEvent[A])}}this._tokenModelEvent=[];this._viewer.removeClippingPlane(this._nNode.getSectionPlane());this._nNode.clean();this._viewer.setSectionCapping(true);if(this._iViewerSecondaryWindow){this._iViewerSecondaryWindow.clear()}if(this._viewer._expClippingManager){this._viewer._expClippingManager.removePlane(this._sectionId)}this._parent()},initComponent:function(I){this._parent(I);var F=this;if(I){if(I.appType){this._typeApps=I.appType}if(I.modeType){this._sectionObjectMode=I.modeType}if(this._viewer){this._bIsInShowSpace=(0!==this._viewer.getVisibleSpace());if(this._viewer._expClippingManager===undefined){this._viewer._expClippingManager=new l({context:y.getContextViewer({reviewContext:y.getReviewContext({viewer:this._viewer})})})}var A=function(){F._bUpdateOnModelChange=true;F._nNode.resetClippingFlag();F.refreshNode();F._bUpdateOnModelChange=undefined};var B=function(){if(F.getAttribute("bVisible")){F.setAttribute("bVisible",false);F.refreshNode();F._bLineLayoutBegun=true}};var G=function(){if(F._bLineLayoutBegun){F.setAttribute("bVisible",true);A();F._bLineLayoutBegun=undefined}};var E=y.giveEventsController({viewer:this._viewer});if(E){var z;z=E.addEvent(o.Events.EXPRootModifiedEvent,A);this._tokenModelEvent.push(z);z=E.addEvent(o.Events.EXPMoveEvent,A);this._tokenModelEvent.push(z);z=E.addEvent(o.Events.EXPHideShowEvent,A);this._tokenModelEvent.push(z);z=E.addEvent(o.Events.EXPModelUpdatedEvent,A);this._tokenModelEvent.push(z);z=E.addEvent(o.Events.EXPLineLayoutComputationBeginEvent,B);this._tokenModelEvent.push(z);z=E.addEvent(o.Events.EXPLineLayoutComputationEndEvent,G);this._tokenModelEvent.push(z)}var C=e.getDMUMarkupsController({context:this._viewer});if(C){C.registerMarker(this)}}}if(y.getAuthoringFeatureTypes().indexOf("Section")!==-1){if(!this.ctxBarInitialized){this.ctxBarInitialized=true;var J="DS/DMUSection/DMUSectionContextualBar";require([J],function(M){var K=new M();F.getContextualCommandList=K.getContextualCommandList;F.getSharedContextualCommandList=K.getSharedContextualCommandList;F.getSharedHeaderTypes=K.getSharedHeaderTypes;K.register({frmWindow:F._frmWindow});var L=w.get().length===1?w.get()[0].pathElement.clone():null;if(L&&L.getLastElement(true).getDMUType&&(L.getLastElement(true)===F._nNode||L.getLastElement(true)===F._nSectionCurvesNode)){w.empty();w.add({pathElement:L})}})}var H="DS/DMUSection/DMUSectionExport";require([H],function(L){var K=new L(F);F.exportData=K.exportData})}var D=new s(F);this.importData=D.importData;this.afterImport=D.afterImport}});return d});