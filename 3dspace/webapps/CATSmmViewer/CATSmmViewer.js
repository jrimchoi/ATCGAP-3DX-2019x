define("DS/CATSmmViewer/HtmlDisplayer",["require","exports"],function(b,a){var c=(function(){function d(e,f){this.container=e;this.container.classList.add("syc-layer-html");this.options=f;this.container.innerHTML=f.client.config.resolveUrlInHtml(this.options.layer.representation)}d.prototype.render=function(e){};return d}());return c});define("DS/CATSmmViewer/Viewer",["require","exports","DS/CATSmmDraw/Geometry","DS/CATSmmDraw/ViewPoint"],function(d,b,g,a){d(["css!./Viewer.css"]);var c={"2d-canvas":"DS/CATSmmViewer/Canvas2dDisplayer","1d-html":"DS/CATSmmViewer/HtmlDisplayer"};var f={Vertical:"Vertical",Stacked:"Stacked"};var e=(function(){function h(i){this._eventTarget=document.createDocumentFragment();this.options=i;this.container=document.createElement("div");this.container.classList.add("syc-viewer");this._layersElt=document.createElement("div");switch(this._layoutType()){case f.Stacked:this._layersElt.classList.add("syc-vertical-layers");break;case f.Vertical:this._layersElt.classList.add("syc-stacked-layers");break}this.container.appendChild(this._layersElt)}h.prototype.render=function(){this._visibleBounds=[0,0,this.container.clientWidth,this.container.clientHeight];if(!this.viewPoint){var j=g.expandRectangle(this._visibleBounds.slice(),-10,-10);var n=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(var o=0,m=this.options.preview.layers;o<m.length;o++){var l=m[o];if(l&&l.bounds&&l.anchor.type==="absolute"){g.rectangleMergeWithRectangle(n,l.bounds)}}this.viewPoint=a.focusOnRectangle(j,n,g.Direction.CENTER,true,1)}if(!this.displayers){this._initLayers()}else{for(var k=0,i=this.displayers;k<i.length;k++){var l=i[k];if(l){l.render({viewPoint:this.viewPoint,visibleBounds:this._visibleBounds})}}}};h.prototype.addEventListener=function(j,k,i){this._eventTarget.addEventListener(j,k,i)};h.prototype.dispatchCustomEvent=function(j,k){var i=document.createEvent("CustomEvent");i.initCustomEvent(j,true,true,k);return this.dispatchEvent(i)};h.prototype.dispatchEvent=function(i){return this._eventTarget.dispatchEvent(i)};h.prototype.removeEventListener=function(j,k,i){this._eventTarget.addEventListener(j,k,i)};h.prototype._layoutType=function(){for(var k=0,j=this.options.preview.layers;k<j.length;k++){var i=j[k];if(i){switch(i.format){case"2d-canvas":return f.Stacked;case"1d-html":return f.Vertical}}}return f.Stacked};h.prototype._getDisplayerModule=function(j){if(this.options.displayerModules){var i=this.options.displayerModules[j.format];if(i){return i}}return c[j.format]};h.prototype._initLayers=function(){var m=this;this.displayers=new Array(this.options.preview.layers.length);var j=function(p){l.displayers[p]=null;var o=l.options.preview.layers[p];var n=document.createElement("div");n.classList.add("syc-layer");l._layersElt.appendChild(n);if(o){var q=l._getDisplayerModule(o);if(q){d([q],function(r){try{var i=new r(n,{name:p+"",preview:m.options.preview,layer:o,client:m.options.client});m.displayers[p]=i;i.render({viewPoint:m.viewPoint,visibleBounds:m._visibleBounds});m.dispatchCustomEvent("syc-layer-loaded",{displayer:i})}catch(s){console.error(s)}},function(i){return console.log(i)})}else{console.warn("Can't find a displayer for this layer: ",o)}}};var l=this;for(var k=0;k<this.options.preview.layers.length;k++){j(k)}};return h}());return e});define("DS/CATSmmViewer/Canvas2dDisplayer",["require","exports","DS/CATSmmDraw/ImageUtils","DS/CATSmmDraw/Geometry","DS/CATSmmDraw/ViewPoint"],function(require,exports,ImageUtils,Geometry,ViewPoint){var Canvas2dDisplayer=(function(){function Canvas2dDisplayer(container,options){this.container=container;this.container.classList.add("syc-layer-2d");this.options=options;this.canvas=document.createElement("canvas");this.container.appendChild(this.canvas);this.displayFunction=evalWithContext("function(c, imgFcn) {"+this.options.layer.representation+"\n}","layer-2d-"+this.options.name+"-"+this.options.preview.id+".js")}Canvas2dDisplayer.prototype.render=function(options){var _this=this;if(this.canvas.width!==options.visibleBounds[2]-options.visibleBounds[0]){this.canvas.width=options.visibleBounds[2]-options.visibleBounds[0]}if(this.canvas.height!==options.visibleBounds[3]-options.visibleBounds[1]){this.canvas.height=options.visibleBounds[3]-options.visibleBounds[1]}var gc=this.canvas.getContext("2d");if(gc){gc.clearRect(0,0,this.canvas.width,this.canvas.height);try{gc.save();var viewPoint=anchorViewPoint(this.options.layer.anchor,options.viewPoint,options.visibleBounds,[],this.options.layer.fixedScale);viewPoint.applyToGc(gc);gc.beginPath();this.displayFunction(gc,imgFctFactory(this.options.preview,gc,this.options.client.config,function(){return _this.render(options)}))}finally{gc.restore()}}else{console.warn("No support for canvas 2d!")}};return Canvas2dDisplayer}());function evalWithContext(script,scriptName){var require=window.require;return eval("("+script+")\n//# sourceURL="+scriptName)}function imgFctFactory(imageCache,currentGc,config,invalidateCallback){return function(imageId,x,y,hAlign,vAlign,width,height,scalingPolicy){try{if(imageCache.images===undefined){imageCache.images={}}var img_1=imageCache.images[imageId];if(img_1===undefined||img_1===null){img_1=new Image();img_1.completed=false;img_1.onload=function(){img_1.completed=true;invalidateCallback()};img_1.src=config.resolveUrl(imageId);var DATA_IMAGE_SCHEME="data:";img_1.completed=img_1.src!==undefined&&img_1.src!==null&&img_1.src.substr(0,DATA_IMAGE_SCHEME.length)===DATA_IMAGE_SCHEME;imageCache.images[imageId]=img_1}if(img_1.completed){ImageUtils.drawImage(currentGc,img_1,x,y,hAlign,vAlign,width,height,scalingPolicy)}}catch(e){console.warn(e.stack)}}}function anchorViewPoint(anchor,globalVP,visibleBounds,selection,fixedScale){if(!anchor){return globalVP}var viewPoint=new ViewPoint(1,0,0);switch(anchor.type){case"absolute":var anchorPoint=globalVP.transform(anchor.point);viewPoint.tx=anchorPoint[0];viewPoint.ty=anchorPoint[1];break;case"window":viewPoint.tx=visibleBounds[0]*(1-anchor.point[0])+visibleBounds[2]*anchor.point[0];viewPoint.ty=visibleBounds[1]*(1-anchor.point[1])+visibleBounds[3]*anchor.point[1];break;case"selection":if(selection.length>0){var selarea=selection[0];var selbounds=Geometry.rectangleMergeWithPoints([Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],selarea.location);var areaViewPoint=anchorViewPoint(selarea.layer.anchor,globalVP,visibleBounds,selection,selarea.layer.fixedScale);var anchorPoint_1=areaViewPoint.transform([selbounds[0]*(1-anchor.point[0])+selbounds[2]*anchor.point[0],selbounds[1]*(1-anchor.point[1])+selbounds[3]*anchor.point[1]]);viewPoint.tx=anchorPoint_1[0];viewPoint.ty=anchorPoint_1[1]}break}if(!fixedScale){viewPoint.scale=globalVP.scale}return viewPoint}return Canvas2dDisplayer});