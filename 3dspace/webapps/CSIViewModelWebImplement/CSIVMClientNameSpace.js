define("DS/CSIViewModelWebImplement/CSIVMClientNameSpace",["DS/CSIViewModelWebImplement/CSIVMClientObject","DS/CSIViewModelWebInternalTools/CSIVMStringMap"],function(c,a){function b(e,d){this.clear();this._uuid=e;this._model=d;this._errManager=d.getErrorManager()}b.prototype.delimiter="#";b.prototype.atomicDelimiter="/";b.prototype.clear=function(e){if(this._objects===undefined){this._objects=new a()}this._objects.clear();if(e===undefined){this._treeKeys=[]}else{var d=this._treeKeys.indexOf(e);if(d>=0){this._treeKeys.splice(d,1)}var f=e.getUUID();this._model.removeTreeKey(f)}};b.prototype.addTreeKey=function(d){this._treeKeys.push(d)};b.prototype.getTreeKey=function(d){return this._model.getTreeKey(d)};b.prototype.getAllTreeKeys=function(){var d=[];var f=this._treeKeys.length;d.length=f;var e=0;for(e=0;e<f;e++){d[e]=this._treeKeys[e]}return d};b.prototype.getTreeKeyFromViewType=function(e){var f;var d=undefined;for(f in this._treeKeys){d=this._treeKeys[f];if(d.getViewType()==e){return d}}return this._model.getTreeKeyFromViewType(e)};b.prototype.isNameSpaceOfTreeKey=function(d){return this._treeKeys.indexOf(d)};b.prototype.getRootObject=function(){var d=undefined;d=this._objects.findValue(function(e){return(e!==undefined&&e.isRoot())});return d};b.prototype.getObjects=function(d,f){var e=[];this._objects.forEachValue(function(g){if(g!==undefined&&g.getIdPattern()==d){e.push(g)}},f);return e};b.prototype.getObjectsFromCtx=function(d,f){var e=[];this._objects.forEachValue(function(g){if(g!==undefined&&g.getIdPattern()._idContext==d){e.push(g)}},f);return e};b.prototype.createObject=function(d,g){var f=undefined;var e=this._model.isAnExistingIdPattern(d);if(e){f=new c(this,g,d);this._objects.createValue(g,f)}return f};b.prototype.getOrCreateObject=function(e,g){var f=undefined;var d=this.getObjects(e,g);if(!d.length){f=this.createObject(e,g)}else{f=d[0]}return f};b.prototype.removeObject=function(e){if(e!==undefined){var f=e.getLocalId();this._objects.remove(f,e);var d=e.getDualObject();if(d!==undefined){var g=d.getDualObject();if(g===e){d.setDualObject()}}}};b.prototype.commit=function(e){this._errManager.addContext({name:"commit","arguments":arguments});this._objects.forEachValue(function(f){if(f!==undefined){f.preCommit(e)}});var d=[];this._objects.forEachValue(function(f){if(f!==undefined){if(f.isEmpty()){d.push(f)}else{f.commit(e)}}});d.forEach(function(f){this.removeObject(f)}.bind(this));this._errManager.cleanContext(arguments)};b.prototype.abort=function(d){this._errManager.addContext({name:"abort","arguments":arguments});this._objects.forEachValue(function(e){e.abort(d)});this._errManager.cleanContext(arguments)};b.prototype.buildGlobalId=function(k){this._errManager.addContext({name:"buildGlobalId","arguments":arguments});var q="";var m="";var l=k.length;var h=null;var d=null;var o=null;var f=false;var g=true;var p=true;for(var j=l-1;j>=0;j--){var e=k[j];var n=e.getIdPattern();h=n._idSpace;f=n._shared;o=n._idContext;m=o+this.delimiter+e.getLocalId();if(o&&h&&(o===d)){p=true}if(p){if(!g){m+=this.atomicDelimiter}g=false;m+=q;q=m}p=f;if(!p){d=h}}this._errManager.cleanContext(arguments);return q};b.prototype.decodeGlobalId=function(d){if(d.State===undefined){d.State=c.prototype.stateMode.Permanent}return this.decodeGlobalIdInternal(d)};b.prototype.decodeGlobalIdInternal=function(f){this._errManager.addContext({name:"decodeGlobalIdInternal","arguments":arguments});var x=f.Node;var C=f.Id;var n=f.State;var s=f.AuthorizePartialPath;var w=C.split(this.atomicDelimiter);var h=[];var E=null;var g=(x!=undefined)?x:this.getRootObject();h.push(g);for(var A=0;A<w.length&&h!==undefined;A++){var t=w[A];var v=undefined;var e=this.findNodesByIdentifier(t,n);var m=e.length;if(m==1){v=e[0]}else{if(m){for(var y=0;y<m&&v===undefined;y++){var d=e[y].getFirstParentsDefiningNameSpaceOfThis();var o=d.length;for(var z=0;z<o&&v===undefined;z++){if(h.indexOf(d[z])>=0){v=e[y]}}}}}if(v===undefined){h=undefined;break}var q=v.getAdditionalObjects();if(q!==undefined){var r=v;var B;var l;v=undefined;for(var z=-1;z<q.length&&v===undefined;z++){if(z===-1){B=r}else{B=q[z]}l=B.getAllParents(n);for(var y=0;y<l.length&&v===undefined;y++){if(l[y]===g){v=B}}}}var D=v;var u=[];while(v!==g){if(v===undefined){h=undefined;break}E=v.getAllParents(n);u.push(v);v=E[0];if(E.length>1){var p=E.indexOf(g);if(p===-1){console.warn("Impossible to create a full PathElement from the identifier.");if(s!==true){h=undefined}else{h.splice(0,1)}break}else{v=g}}}for(var z=u.length-1;z>=0&&h!==undefined;z--){h.push(u[z])}g=D}this._errManager.cleanContext(arguments);return h};b.prototype.decodeGlobalIdToViewObjects=function(l,h,d,e){this._errManager.addContext({name:"decodeGlobalIdToViewObjects","arguments":arguments});var j;var m=this.decodeGlobalId({Node:l,Id:d,State:e});var k=0;if(m!==undefined){j=[];var f=m.length;var g=null;for(k=0;(k<f)&&(j!=undefined);k++){g=m[k].getAssociatedViewElt(h);if(g==undefined){j=undefined}else{j.push(g)}}}this._errManager.cleanContext(arguments);return j};b.prototype.findNodesByIdentifier=function(h,g){var f=h.split(this.delimiter);var e=f[0];var d=f[1];return this.getObjectsFromCtx(e,d,g)};return b});