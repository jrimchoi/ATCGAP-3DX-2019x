/*! Copyright Dassault Systemes 2016 */
define("DS/WebRecordBase/TraceManager",["DS/WebRecordBase/Utils","DS/WebRecordBase/UIMessenger"],function(d,j){var h={};var k=1;var o="";var e="";var c={sendTraceMessage:function(){},sendTraceObject:function(){}};if(d.isActive()){require(["DS/WebRecordClient/Base/MessageManager"],function(i){c=i},function(){console.error("! DS/WebRecordClient/Base/MessageManager not found")})}function b(r,i,q){return c.sendTraceMessage(r,i,q)}function g(r,i,q){return c.sendTraceObject(r,i,q)}function f(s,i){if(i){for(var q in i){if(i.hasOwnProperty(q)){var r=i[q];if(typeof r==="undefined"){r="undefined"}else{if(typeof r==="object"){r=JSON.stringify(r)}}s=s.replace("{"+q+"}",r.toString())}}}return s}h.enabledStack=true;if(window.DSWebRecord){if(window.DSWebRecord.getenv("DSWEBREC_DBG_DISABLE_STACK")){h.enabledStack=false}}function n(q){if(!q){return""}var i=-1;var s="";var r=q.match(/\s*at\s+\S.+\s+\((\S+):(\d+):\d+\)/);if(r){s=r[1];i=r[2]}else{r=q.match(/\s*at\s+(\S+):(\d+):\d+/);if(r){s=r[1];i=r[2]}}if(i<0){return""}var t=s.split("/");return t[t.length-1]+":"+String(i)}function m(q){if(!h.enabledStack){return null}q=q||{};var u;try{u=3+(q.stackOffset||0);var s=Error("Fake Error");Error.stackTraceLimit=u+(q.depth||10);throw s}catch(t){var i=t.stack.split("\n");u=1;if(!q.all){while(u<i.length){var r=n(i[u]);if(r.indexOf("TraceManager")!==0){break}u++}u+=q.stackOffset||0}i=i.slice(u);if(q.fileAndLine){return n(i[0])}return i}}h.printExceptionStack=function(t,r){r=r||10;var q=t.stack.split("\n");h.info("EXCEPTION: "+q[0]);for(var s=1;s<q.length;s++){h.info(q[s]);if(s>=r){break}}};h.debugStack=function(){var q=m({all:true});for(var r=0;r<q.length;++r){console.log("TESTSTACK("+r+"): "+q[r])}};h.disableStack=function(){h.enabledStack=false};h.enableStack=function(){h.enabledStack=true};h.consoleTraceLevel=2;if(d.isActive()){h.consoleTraceLevel=1}if(window.DSWebRecord){if(window.DSWebRecord.getenv("DSWEBREC_DBG_CONSOLE")){h.consoleTraceLevel=0}}h.setLevel=function(i){h.consoleTraceLevel=i};h.getElemErrorId=function(i){var q=document.querySelector(i);if(!q.dataset.recErrorId){q.dataset.recErrorId="err_"+k++}return{elem:q.tagName.toLowerCase(),errId:k-1,css:q.tagName.toLowerCase()+"[data-rec-error-id='"+q.dataset.recErrorId+"']"}};h.debuginfra=function(q,i){h._debuginfra_(q,i)};h.debug=function(q,i){h._debug_(q,i)};h.info=function(q,i){h._info_(q,i)};h.log=function(q,i){h._log_(q,i)};h.warn=function(q,i){h._warn_(q,i)};h.errorInfo=function(q,i){h._errorInfo_(q,i)};h.error=function(r,i,q){h._error_(r,i,q)};h.fatal=function(r,i,q){h._fatal_(r,i,q)};h.stop=function(q,i){h._stop_(q,i)};var l={stop:{console:"stop",level:5},fatal:{console:"error",level:4},error:{console:"error",level:3},errorInfo:{console:"error",level:2},warn:{console:"warn",level:2},log:{console:"log",level:1},info:{console:"info",level:1},debug:{console:"debug",level:0},debuginfra:{console:"debug",level:-1}};Object.keys(l).forEach(function(i){h["_"+i+"_"]=function(r,C,z){var y;var w;if(o!==r&&e!==i){if(i==="errorInfo"){try{var A=r.split(": ");var D=A[1].split("\n");w=this.getElemErrorId(D[0]);y={msg:A[0],elem:w.elem,errId:w.errId,tooltip:D[1],type:"errorInfo",css:w.css}}catch(v){y={msg:r,type:"errorInfo"}}j.sendMessageToUI("updateErrorTable",y)}else{if(i==="error"){try{var x=r.split(": ");var B=x[1].split("\n");w=this.getElemErrorId(B[0]);y={msg:x[0],elem:w.elem,errId:w.errId,tooltip:B[1],type:"error",css:w.css}}catch(v){y={msg:r,type:"error"}}j.sendMessageToUI("updateErrorTable",y)}else{if(i==="warn"){try{var u=r.split(": ");var q=u[1].split("\n");w=this.getElemErrorId(q[0]);y={msg:u[0],elem:w.elem,errId:w.errId,tooltip:q[1],type:"warn",css:w.css}}catch(v){y={msg:r,type:"warn"}}j.sendMessageToUI("updateErrorTable",y)}}}e=i;o=r}else{e="";o=""}if(i!=="stop"){var t=m({fileAndLine:true});r=f(r,C);r="["+t+"] "+r;if(l[i].level>=h.consoleTraceLevel){console[l[i].console](r)}if(l[i].level<3){z=undefined}else{z=z||200}}var s;if(window.DSWebRecord){s=window.DSWebRecord.getenv("DSWEBREC_DBG_WEBRECORD")}if(i==="fatal"&&s){l[i]=l.debug}b(l[i].level,r,z)};h[i+"V"]=function(){var s=m({fileAndLine:true});var r="["+s+"]";var q=Array.prototype.slice.call(arguments);q.unshift(r);console[l[i].console].apply(console,q);q=q.map(JSON.stringify);var u=q.join(" ");var t;if(l[i].level>=3){t=200}g(l[i].level,u,t)}});var a={};var p={};h.enableTrace=function(i){p[i]=true;a[i]=true};h.disableTrace=function(i){if(i in a){delete a[i]}};h.usedTraces=function(){var r={enabled:[],disabled:[]};var t=Object.keys(p).sort();for(var q=0;q<t.length;q++){var s=t[q];if(s in a){r.enabled.push(s)}else{r.disabled.push(s)}}return r};h.trace=function(r,s,i){p[r]=true;if(!(r in a)){return}var q=m({fileAndLine:true});s=f(s,i);s="["+q+"] "+s;console.trace(s);b(0,s)};h.traceV=function(s){p[s]=true;if(!(s in a)){return}var r=m({fileAndLine:true});var q="["+r+"]";var i=Array.prototype.slice.call(arguments);i.unshift(q);console.trace.apply(console,i);var t=i.join(" ");g(0,t)};h.HTMLmessage=function(i,q){if(i){return f('<img class="bullet" src="assets/{t}.png"/><span class="{t}">{m}</span><br/>',{t:i,m:q})}return f('<span class="none">{m}</span><br/>',{m:q})};h.addStop=function(i){h.stopCB=i};h.callStop=function(){if(h.stopCB){h.stopCB()}};return h});