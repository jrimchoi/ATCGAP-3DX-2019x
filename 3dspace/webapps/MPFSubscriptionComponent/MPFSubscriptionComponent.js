define("DS/MPFSubscriptionComponent/SubscriptionRecapSection",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFSubscriptionModel/SubscriptionModel","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(g,f,c,b,a,e){var d;d=f.extend({className:"mpf-subscription-recap-section",setup:function(h){h||(h={});a.requiredOfPrototype(h.subscription,b,"options.subscription must be a SubscriptionModel");this._parent(h);this.subscription=h.subscription;this.activeSubscriptionContainer=this._createRecapLine(true,this.subscription.getActiveQuantity());this.stoppedSubscriptionContainer=this._createRecapLine(false,this.subscription.getStoppedQuantity())},render:function(){var i;var h;i=g.createElement("h5",{text:this.subscription.getLicensingScheme()==="YSC"?e.get("annual"):e.get("quarterly")});h=g.createElement("span",{"class":"mpf-end-subs",text:this.subscription.getEndDate()});this.container.setContent([i,h,this.activeSubscriptionContainer,this.stoppedSubscriptionContainer]);return this},_createRecapLine:function(i,k){var j=this;var h;h=new c({value:i?e.get("stop"):e.get("restart"),disabled:i?this.subscription.getActiveQuantity()===0:this.subscription.getStoppedQuantity()===0,events:{onClick:j._dispatchStopRestartEvent.bind(j,i)}});return g.createElement("div",{"class":i?"mpf-recap-line active":"mpf-recap-line not-renewed",html:[g.createElement("span",{"class":"mpf-num-subs",text:k}),g.createElement("span",{"class":"mpf-label-subs",text:i?e.get("activeSubs"):e.get("notRenewSubs")}),h]})},_dispatchStopRestartEvent:function(h){if(h){this.dispatchEvent("stop")}else{this.dispatchEvent("restart")}}});return d});define("DS/MPFSubscriptionComponent/ProductRecapSection",["UWA/Core","UWA/Class/View","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(d,c,b){var a;a=c.extend({className:"mpf-salesmodel-recap",setup:function(e){e||(e={});this._parent(e);this.totalSubscriptions=e.totalSubscriptions;this.salesModel=e.salesModel;this.displayName=e.displayName;this.displayNextPageChevron=e.displayNextPageChevron},render:function(){var g=[];var f;var h;var e;f=d.createElement("div",{"class":"mpf-active-number",text:this.totalSubscriptions});h=d.createElement("div",{"class":this.displayNextPageChevron?"mpf-label-active":"mpf-label-active large",text:this.displayName});Array.prototype.push.apply(g,[f,h]);if(this.displayNextPageChevron){e=d.createElement("div",{"class":"fonticon fonticon-chevron-right"});g.push(e);this.container.addClassName("mpf-active-div");this.container.addEvent("click",this._dispatchClickEvent.bind(this))}this.container.setContent(g);return this},_dispatchClickEvent:function(){this.dispatchEvent(this.salesModel)}});return a});define("DS/MPFSubscriptionComponent/OrderTab",["UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/ExportOrderFactory","DS/MPFModelFactory/InvoiceFactory","DS/MPFModelFactory/CartFactory","DS/MPFPersonModel/PersonModel","DS/MPFBuyer/BuyerType","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFilters","DS/MPFOrderListComponent/OrderListPage","DS/MPFOrderListComponent/3DExperienceServiceTile","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(c,j,f,k,l,g,i,n,e,b,d,h,o,m,p){var a;a=c.extend({className:"mpf-order-tab mpf-tab",setup:function(q){q||(q={});this._checkPrototypes(q);this._parent(q);this.me=q.me;this.exportOrderFactory=q.exportOrderFactory;this.invoiceFactory=q.invoiceFactory;this.cartFactory=q.cartFactory},render:function(){var q=this;f.mask(this.container);this._fetchCarts().then(function(){if(j.is(q.orderList)){q.orderList.destroy()}q.orderList=new o({carts:q.carts,me:q.me,buyerType:b.COMPANY,isSellerView:true,exportOrderFactory:q.exportOrderFactory,invoiceFactory:q.invoiceFactory,serviceViewFactory:q._serviceTileFactory,service:l.STORE,statusSelectorInitValue:h.STATE_ALL_FILTER});q.container.setContent(q.orderList.render())})["finally"](function(){f.unmask(q.container)});return this},_serviceTileFactory:function(q){return new m(q)},_fetchCarts:function(){var q={};this.carts=this.cartFactory.createCollection(n.Types.ME_V2);q.expand=[d.Expands.CART_ITEMS];q[h.FILTER_BY_STATE]=h.STATE_ALL_FILTER;q[h.FILTER_BY_TYPE]=h.TYPE_RENEWAL;return this.carts.fetchPromise(q)},_checkPrototypes:function(q){k.requiredOfPrototype(q.me,e,"options.me must be a PersonModel");k.requiredOfPrototype(q.cartFactory,n,"options.cartFactory must be a CartFactory");k.requiredOfPrototype(q.invoiceFactory,i,"options.invoiceFactory must be an InvoiceFactory");k.requiredOfPrototype(q.exportOrderFactory,g,"options.exportOrderFactory must be an ExportOrderFactory")},destroy:function(){this.me=null;this.exportOrderFactory=null;this.invoiceFactory=null;this.cartFactory=null;this._parent();this.container=null}});return a});define("DS/MPFSubscriptionComponent/SubscriptionResellerRecapPage",["UWA/Class/View","UWA/Core","DS/MPFProductModel/ProductModel","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(f,c,b,a,e){var d;d=f.extend({className:"mpf-reseller-subscription-recap",setup:function(g){g||(g={});a.requiredOfPrototype(this.model,b,"this.model must be a ProductModel");this._parent(g)},render:function(){this.container.setContent([this._createBackButton(),c.createElement("div",{text:e.get("Reseller"),"class":"mpf-reseller-label"}),c.createElement("div",{html:this._getTotalQuantityResellerSubscriptions()+"&nbsp;"+e.get("subscriptions"),"class":"mpf-number-reseller"}),c.createElement("div",{"class":"mpf-info-reseller",html:[c.createElement("span",{"class":"fonticon fonticon-info "}),c.createElement("div",{text:e.get("contactReseller")})]})]);return this},_getTotalQuantityResellerSubscriptions:function(){var g=0;this.model.getSubscriptions().forEach(function(h){if(h.getSalesModel()==="Reseller"){g+=1}});return g},_createBackButton:function(){var g=this;return c.createElement("span",{"class":"fonticon fonticon-chevron-left",events:{click:function(){g.dispatchEvent("onBack")}}})}});return d});define("DS/MPFSubscriptionComponent/OfferMarketingPage",["UWA/Class/View","UWA/Core","UWA/Utils/Client","DS/UIKIT/Input/Button","DS/UIKIT/Modal","DS/MPFOfferModel/3DExpOfferModel","DS/MPFUrl/UrlUtils","DS/MPFModalConfiguratorComponent/CheckoutLauncherFactory","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(a,h,f,j,c,b,d,i,g,k){var e;e=a.extend({className:"mpf-subscription-marketing",setup:function(l){l||(l={});g.requiredOfPrototype(l.offer,b,"options.offer must be a 3DExpOfferModel");this._parent(l);this.offer=l.offer;this.onlineInstanceId=l.onlineInstanceId;this.periodicitiesAlreadyPurchased=l.periodicitiesAlreadyPurchased;this.marketingModal=this._createMarketingModal();this.moreInfoButton=this._createMoreInfoButton();this.buyButton=this._createBuySubscriptionButton()},render:function(){var l;l=h.createElement("div",{"class":"mpf-subs-sections mpf-offer",html:h.createElement("div",{"class":"mpf-image"})});this.container.setContent([l,this.buyButton]);this.marketingModal.inject(document.body);return this},_createMoreInfoButton:function(){var l=this;return h.createElement("span",{"class":"fonticon fonticon-info",events:{click:function(){l.marketingModal.show()}}})},_createMarketingModal:function(){var m;var l;if(h.is(this.offer.getMarketingUrl())&&this.offer.getMarketingUrl()!==""){m=(new d(this.offer.getMarketingUrl())).addParameter("role",this.offer.getProductTrigram()).getUrl();l=h.createElement("iframe",{src:m})}else{l=h.createElement("div",{text:k.get("noOffer")})}return new c({className:"mpf-marketing-modal",closable:true,header:{tag:"h4",text:this.offer.getDisplayName()},body:l,footer:this._initFooterModal()})},_initFooterModal:function(){var l=this;return[this._createBuySubscriptionButton(),new j({value:k.get("cancel"),events:{onClick:function(){l.marketingModal.hide()}}})]},_createBuySubscriptionButton:function(){var m=this;var l;l=new j({className:"primary",value:k.get("buyNow"),events:{onClick:this._displayCheckout.bind(this)}});return h.createElement("div",{"class":"mpf-recap-buymore",html:[l,m.moreInfoButton]})},_displayCheckout:function(){var l;l=new i({service:"3DStore",platform:this.onlineInstanceId,product:this.offer.getProductTrigram(),productName:this.offer.getDisplayName(),periodicitiesAlreadyPurchased:this.periodicitiesAlreadyPurchased});this.marketingModal.hide();return l.whenReady().then(l.show.bind(l))}});return e});define("DS/MPFSubscriptionComponent/StopSubscriptionPage",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Number","DS/UIKIT/Input/Button","DS/MPFSubscriptionModel/SubscriptionModel","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(h,g,d,c,b,a,e){var f;f=h.extend({className:"mpf-manage-subscription",setup:function(i){i||(i={});a.requiredOfPrototype(i.subscription,b,"options.subscription must be a SubscriptionModel");this._parent(i);this.subscription=i.subscription;this.inputNumber=this._createInputNumber();this.stopButton=this._createStopButton();this.cancelButton=this._createCancelButton();this.backButton=this._createBackButton()},render:function(){var l;var k;var j;var i;l=g.createElement("div",{"class":"mpf-subscription-recap-title",html:[g.createElement("h5",{text:this.subscription.getLicensingScheme()==="YSC"?e.get("annual"):e.get("quarterly")}),g.createElement("span",{"class":"mpf-end-subs",text:this.subscription.getEndDate()})]});k=g.createElement("div",{"class":"mpf-info-subscriptions",html:[g.createElement("span",{"class":"mpf-num-subs",text:this.subscription.getActiveQuantity()}),"&nbsp;",e.get("subsActive")]});j=g.createElement("div",{"class":"mpf-quantity-subscriptions",text:e.get("selectQuantityToStop")});i=g.createElement("div",{"class":"mpf-button-subscriptions",html:[this.stopButton,this.cancelButton]});this.container.setContent([this.backButton,l,k,j,this.inputNumber,i]);return this},_createInputNumber:function(){return new d({placeholder:false,min:1,max:this.subscription.getActiveQuantity(),value:1,events:{onClick:this._disabledStopButton.bind(this)}})},_getQuantity:function(){return this.inputNumber.getValue()},_disabledStopButton:function(){this.stopButton.setDisabled(this._getQuantity()===0)},_createStopButton:function(){var i=this;return new c({value:e.get("stop"),className:"primary",disabled:false,events:{onClick:function(){var j;j={nbSubsToStop:i._getQuantity(),subscription:i.subscription};i.dispatchEvent("onNext",j)}}})},_createCancelButton:function(){return new c({value:e.get("cancel"),events:{onClick:this._dispatchOnBackEvent.bind(this)}})},_createBackButton:function(){return g.createElement("span",{"class":"fonticon fonticon-chevron-left",events:{click:this._dispatchOnBackEvent.bind(this)}})},_dispatchOnBackEvent:function(){this.dispatchEvent("onBack")}});return f});define("DS/MPFSubscriptionComponent/StopConfirmationSubscriptionPage",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/MPFSubscriptionModel/SubscriptionModel","DS/MPFModelFactory/SubscriptionFactory","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(h,g,e,d,a,c,f){var b;b=h.extend({className:"mpf-manage-subscription",setup:function(i){i||(i={});c.requiredOfPrototype(i.subscription,d,"options.subscription must be a SubscriptionModel");c.requiredOfPrototype(i.subscriptionFactory,a,"options.subscriptionFactory must be a SubscriptionFactory");this._parent(i);this.subscription=i.subscription;this.subscriptionFactory=i.subscriptionFactory;this.quantityToStop=i.quantityToStop;this.onlineInstanceId=i.onlineInstanceId;this.backButton=this._createBackButton();this.confirmButton=this._createConfirmButton();this.cancelButton=this._createCancelButton()},render:function(){var j;var i;j=g.createElement("div",{"class":"mpf-stop-subscriptions-confirmation",text:f.get("stopConfirmation")});i=g.createElement("div",{"class":"mpf-button-subscriptions",html:[this.confirmButton,this.cancelButton]});this.container.setContent([this.backButton,j,i]);return this},_stopSubscriptions:function(){var i=this;this.subscription.dataProxy=this.subscriptionFactory.getDataProxy("unsubscribe");this._dispatchOnDoubleBackEvent();return this.subscription.savePromise(null,{quantity:this.quantityToStop,onlineInstanceId:this.onlineInstanceId}).then(function(j){if(j.getCode()===10){i.dispatchEvent("OEDown",j)}else{i.dispatchEvent("stopSubsOK",j)}})["catch"](function(){i.dispatchEvent("stopSubsKO")})},_createConfirmButton:function(){return new e({value:f.get("confirm"),className:"primary",events:{onClick:this._stopSubscriptions.bind(this)}})},_createCancelButton:function(){return new e({value:f.get("cancel"),events:{onClick:this._dispatchOnBackEvent.bind(this)}})},_createBackButton:function(){return g.createElement("span",{"class":"fonticon fonticon-chevron-left",events:{click:this._dispatchOnBackEvent.bind(this)}})},_dispatchOnBackEvent:function(){this.dispatchEvent("onBack")},_dispatchOnDoubleBackEvent:function(){this.dispatchEvent("onDoubleBack")},destroy:function(){this.subscription=null;this.subscriptionFactory=null;this.quantityToStop=null;this.onlineInstanceId=null;this.backButton=null;this.confirmButton=null;this.cancelButton=null;this._parent();this.container=null}});return b});define("DS/MPFSubscriptionComponent/RestartSubscriptionPage",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Number","DS/UIKIT/Input/Button","DS/MPFSubscriptionModel/SubscriptionModel","DS/MPFModelFactory/SubscriptionFactory","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(b,d,f,h,g,c,e,i){var a;a=b.extend({className:"mpf-manage-subscription",setup:function(j){j||(j={});e.requiredOfPrototype(j.subscription,g,"options.subscription must be a SubscriptionModel");e.requiredOfPrototype(j.subscriptionFactory,c,"options.subscriptionFactory must be a SubscriptionFactory");this._parent(j);this.subscription=j.subscription;this.subscriptionFactory=j.subscriptionFactory;this.onlineInstanceId=j.onlineInstanceId;this.backButton=this._createBackButton();this.inputNumber=this._createInputNumber();this.restartButton=this._createRestartButton();this.cancelButton=this._createCancelButton()},render:function(){var m;var l;var k;var j;m=d.createElement("div",{"class":"mpf-subscription-recap-title",html:[d.createElement("h5",{text:this.subscription.getLicensingScheme()==="YSC"?i.get("annual"):i.get("quarterly")}),d.createElement("span",{"class":"mpf-end-subs",text:this.subscription.getEndDate()})]});l=d.createElement("div",{"class":"mpf-info-subscriptions",html:[d.createElement("span",{"class":"mpf-num-subs",text:this.subscription.getStoppedQuantity()}),"&nbsp;",i.get("subsNotRenewed")]});k=d.createElement("div",{"class":"mpf-quantity-subscriptions",text:i.get("selectQuantityToRestart")});j=d.createElement("div",{"class":"mpf-button-subscriptions",html:[this.restartButton,this.cancelButton]});this.container.setContent([this.backButton,m,l,k,this.inputNumber,j]);return this},_restartSubscriptions:function(){var j=this;this.subscription.dataProxy=this.subscriptionFactory.getDataProxy("resubscribe");this.dispatchEvent("onBack");return this.subscription.savePromise(null,{quantity:this._getQuantity(),onlineInstanceId:this.onlineInstanceId}).then(function(k){if(k.getCode()===10){j.dispatchEvent("OEDown",k)}else{j.dispatchEvent("restartsSubsOK",k)}})["catch"](function(){j.dispatchEvent("restartsSubsKO")})},_createRestartButton:function(){return new h({value:i.get("restart"),className:"primary",events:{onClick:this._restartSubscriptions.bind(this)}})},_createCancelButton:function(){return new h({value:i.get("cancel"),events:{onClick:this._dispatchOnBackEvent.bind(this)}})},_createInputNumber:function(){return new f({placeholder:false,min:1,max:this.subscription.getStoppedQuantity(),value:this.subscription.getStoppedQuantity(),events:{onClick:this._disabledRestartButton.bind(this)}})},_disabledRestartButton:function(){this.restartButton.setDisabled(this._getQuantity()===0)},_getQuantity:function(){return this.inputNumber.getValue()},_createBackButton:function(){return d.createElement("span",{"class":"fonticon fonticon-chevron-left",events:{click:this._dispatchOnBackEvent.bind(this)}})},_dispatchOnBackEvent:function(){this.dispatchEvent("onBack")},destroy:function(){this.subscription=null;this.subscriptionFactory=null;this.onlineInstanceId=null;this.backButton=null;this.inputNumber=null;this.restartButton=null;this.cancelButton=null;this._parent();this.container=null}});return a});define("DS/MPFSubscriptionComponent/SubscriptionOnlineRecapPage",["UWA/Class/View","UWA/Core","DS/UIKIT/Alert","DS/MPFSubscriptionComponent/RestartSubscriptionPage","DS/MPFSubscriptionComponent/StopSubscriptionPage","DS/MPFSubscriptionComponent/StopConfirmationSubscriptionPage","DS/MPFSubscriptionComponent/SubscriptionRecapSection","DS/MPFProductModel/ProductModel","DS/MPFSubscriptionModel/SubscriptionModel","DS/MPFModelFactory/SubscriptionFactory","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(e,j,b,c,a,g,l,f,k,d,i,m){var h;h=e.extend({className:"mpf-online-subscription-recap",setup:function(n){n||(n={});i.requiredOfPrototype(n.product,f,"options.product must be a ProductModel");i.requiredOfPrototype(n.subscriptionFactory,d,"options.subscriptionFactory must be a SubscriptionFactory");this._parent(n);this.product=n.product;this.subscriptionFactory=n.subscriptionFactory;this.onlineInstanceId=n.onlineInstanceId;this.subscriptions=this.product.getSubscriptions();this.sections=this._initSections();this.backButton=this._createBackButton()},render:function(){this.container.setContent([this.backButton,this.sections]);return this},_createBackButton:function(){var n=this;return j.createElement("span",{"class":"fonticon fonticon-chevron-left",events:{click:function(){n.dispatchEvent("onBack")}}})},_initSections:function(){var n=this;return this.subscriptions.map(function(o){var p;if(o.getSalesModel()===k.SalesModel.DIRECT_SALES){p=new l({subscription:o});n.listenTo(p,"restart",n._displayRestartSubscriptionPage.bind(n,o));n.listenTo(p,"stop",n._displayStopSubscriptionPage.bind(n,o));return p.render()}})},_displayRestartSubscriptionPage:function(o){var n=new c({subscription:o,subscriptionFactory:this.subscriptionFactory,onlineInstanceId:this.onlineInstanceId});this.listenTo(n,"onBack",this.render.bind(this));this.listenTo(n,"restartsSubsKO",this._displayAlertMessage.bind(this,"error",m.get("restartsSubsKO")));this.listenTo(n,"OEDown",this._displayAlertMessage.bind(this,"error",m.get("serviceUnavailable")));this.listenTo(n,"restartsSubsOK",this._refresh.bind(this,"success",m.get("restartsSubsOK")));this.container.setContent(n.render())},_displayStopSubscriptionPage:function(o){var n=new a({subscription:o});this.listenTo(n,"onBack",this.render.bind(this));this.listenTo(n,"onNext",this._displayStopConfirmationSubscriptionPage.bind(this,n));this.container.setContent(n.render())},_displayStopConfirmationSubscriptionPage:function(p,n){var q=this;var o=new g({subscription:n.subscription,quantityToStop:n.nbSubsToStop,subscriptionFactory:this.subscriptionFactory,onlineInstanceId:this.onlineInstanceId});this.listenTo(o,"onBack",function(){q.container.setContent(p.render())});this.listenTo(o,"onDoubleBack",this.render.bind(this));this.listenTo(o,"OEDown",this._displayAlertMessage.bind(this,"error",m.get("serviceUnavailable")));this.listenTo(o,"stopSubsKO",this._displayAlertMessage.bind(this,"error",m.get("stopSubsKO")));this.listenTo(o,"stopSubsOK",this._refresh.bind(this,"success",m.get("stopSubsOK")));this.container.setContent(o.render())},_refresh:function(n,o){this.sections=this._initSections();this.render();this._displayAlertMessage(n,o)},_displayAlertMessage:function(o,n){new b({icon:true,closable:true,visible:true,autoHide:true,fullWidth:true,className:o,messageClassName:o,messages:n}).inject(this.container,"top")}});return h});define("DS/MPFSubscriptionComponent/OfferManagementComponent",["UWA/Class/View","UWA/Core","DS/MPFSubscriptionComponent/OfferMarketingPage","DS/MPFOfferModel/3DExpOfferModel","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent","css!DS/MPFSubscriptionComponent/MPFSubscriptionComponent"],function(g,f,b,c,a,d){var e;e=g.extend({className:"mpf-subscription-management",setup:function(h){h=(h||{});a.requiredOfPrototype(h.offer,c,"options.offer must be a 3DExpOfferModel");this._parent(h);this.offer=h.offer;this.onlineInstanceId=h.onlineInstanceId;this.periodicitiesAlreadyPurchased=h.periodicitiesAlreadyPurchased;this.header=this._createHeader();this.circleHeader=this._createUserCircle();this.marketingPage=this._createMarketingPage()},render:function(){this.container.setContent([this.header,this.circleHeader,this.marketingPage.render()]);return this},_createMarketingPage:function(){return new b({offer:this.offer,onlineInstanceId:this.onlineInstanceId,periodicitiesAlreadyPurchased:this.periodicitiesAlreadyPurchased})},_createHeader:function(){return f.createElement("div",{"class":"mpf-recap-header",html:f.createElement("div",{text:this.offer.getDisplayName()})})},_createUserCircle:function(){return f.createElement("div",{"class":"mpf-circle-user fonticon fonticon-role"})}});return e});define("DS/MPFSubscriptionComponent/NotOnlineProductRecapPage",["UWA/Class/View","UWA/Core","DS/MPFProductModel/ProductModel","DS/MPFSubscriptionComponent/ProductRecapSection","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(g,d,c,e,b,f){var a;a=g.extend({className:"mpf-subscription-recap",setup:function(h){h||(h={});b.requiredOfPrototype(this.model,c,"this.model must be a ProductModel");this._parent(h)},render:function(){this.container.setContent(d.createElement("div",{"class":"mpf-subs-sections",html:new e({totalSubscriptions:this.model.getTotalQuantity(),displayName:this.model.getDisplayName(),displayNextPageChevron:false}).render()}));return this}});return a});define("DS/MPFSubscriptionComponent/SubscriptionRecapPage",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Modal","DS/MPFUrl/UrlUtils","DS/MPFSubscriptionComponent/ProductRecapSection","DS/MPFSubscriptionComponent/SubscriptionOnlineRecapPage","DS/MPFSubscriptionComponent/SubscriptionResellerRecapPage","DS/MPFSubscriptionModel/SubscriptionModel","DS/MPFProductModel/ProductModel","DS/MPFModalConfiguratorComponent/CheckoutLauncherFactory","DS/MPFModelFactory/SubscriptionFactory","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(b,k,n,c,d,i,f,g,m,e,l,a,j,o){var h;h=b.extend({className:"mpf-subscription-recap",setup:function(p){p=(p||{});j.requiredOfPrototype(p.product,e,"options.product must be a ProductModel");j.requiredOfPrototype(p.subscriptionFactory,a,"options.subscriptionFactory must be a SubscriptionFactory");this._parent(p);this.product=p.product;this.subscriptionFactory=p.subscriptionFactory;this.onlineInstanceId=p.onlineInstanceId;this.periodicitiesAlreadyPurchased=p.periodicitiesAlreadyPurchased;this.subscriptions=this.product.getSubscriptions();this.marketingModal=this._createMarketingModal();this.moreInfoButton=this._createMoreInfoButton();this.buyMoreButton=this._createBuyMoreSubscriptionButton();this.sections=this._createSections()},render:function(){var p=k.createElement("div",{"class":"mpf-subs-sections",html:this.sections});this.container.setContent([p,this.buyMoreButton]);this.marketingModal.inject(document.body);return this},_createSections:function(){var t=[];if(this._getSalesQuantity(m.SalesModel.RESELLER)!==0){var p=new i({totalSubscriptions:this._getSalesQuantity(m.SalesModel.RESELLER),displayName:o.get(m.SalesModel.RESELLER),salesModel:m.SalesModel.RESELLER,displayNextPageChevron:true});t.push(p.render());this.listenTo(p,m.SalesModel.RESELLER,this._displayResellerRecapPage.bind(this))}if(this._getSalesQuantity(m.SalesModel.DIRECT_SALES)!==0){var q=new i({totalSubscriptions:this._getSalesQuantity(m.SalesModel.DIRECT_SALES),displayName:o.get(m.SalesModel.DIRECT_SALES),salesModel:m.SalesModel.DIRECT_SALES,displayNextPageChevron:true});t.push(q.render());this.listenTo(q,m.SalesModel.DIRECT_SALES,this._displayOnlineRecapPage.bind(this))}if(this._getSalesQuantity(m.SalesModel.CATIA)!==0){var r=new i({totalSubscriptions:this._getSalesQuantity(m.SalesModel.CATIA),displayName:o.get(m.SalesModel.CATIA),salesModel:m.SalesModel.CATIA,displayNextPageChevron:false});t.push(r.render())}if(this._getSalesQuantity(m.SalesModel.SOLIDWORKS)!==0){var s=new i({totalSubscriptions:this._getSalesQuantity(m.SalesModel.SOLIDWORKS),displayName:o.get(m.SalesModel.SOLIDWORKS),salesModel:m.SalesModel.SOLIDWORKS,displayNextPageChevron:false});t.push(s.render())}return t},_displayOnlineRecapPage:function(){var p;p=new f({product:this.product,subscriptionFactory:this.subscriptionFactory,onlineInstanceId:this.onlineInstanceId});this.dispatchEvent("onNext");this.container.setContent(p.render());this.listenTo(p,"onBack",this._onBackHandler.bind(this))},_displayResellerRecapPage:function(){var p;p=new g({model:this.product});this.dispatchEvent("onNext");this.container.setContent(p.render());this.listenTo(p,"onBack",this._onBackHandler.bind(this))},_onBackHandler:function(){this.dispatchEvent("onBack");this.render()},_getSalesQuantity:function(p){var q=0;this.subscriptions.forEach(function(r){if(r.getSalesModel()===p){q+=(r.getActiveQuantity()+r.getStoppedQuantity())}});return q},_createMarketingModal:function(){var q;var p;if(k.is(this.product.getMarketingUrl())&&this.product.getMarketingUrl()!==""){q=(new d(this.product.getMarketingUrl())).addParameter("role",this.product.getProductTrigram()).getUrl();p=k.createElement("iframe",{src:q})}else{p=k.createElement("div",{text:o.get("noOffer")})}return new c({className:"mpf-marketing-modal",closable:true,header:{tag:"h4",text:this.product.getDisplayName()},body:p,footer:this._initFooterModal()})},_initFooterModal:function(){var p=this;var q;q=new n({value:o.get("cancel"),events:{onClick:function(){p.marketingModal.hide()}}});return[this._createBuyMoreSubscriptionButton(),q]},_createMoreInfoButton:function(){var p=this;return k.createElement("span",{"class":"fonticon fonticon-info",events:{click:function(){p.marketingModal.show()}}})},_createBuyMoreSubscriptionButton:function(){var p=this;return k.createElement("div",{"class":"mpf-recap-buymore",html:[new n({className:"primary",value:o.get("buyMore"),events:{onClick:function(){var q;q=new l({service:"3DStore",platform:p.onlineInstanceId,product:p.product.getProductTrigram(),productName:p.product.getDisplayName(),periodicitiesAlreadyPurchased:p.periodicitiesAlreadyPurchased});p.marketingModal.hide();q.whenReady().then(q.show.bind(q))}}}),p.moreInfoButton]})}});return h});define("DS/MPFSubscriptionComponent/SubscriptionManagementComponent",["UWA/Class/View","UWA/Core","DS/MPFSubscriptionComponent/SubscriptionRecapPage","DS/MPFSubscriptionComponent/NotOnlineProductRecapPage","DS/MPFProductModel/ProductModel","DS/MPFModelFactory/SubscriptionFactory","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent","css!DS/MPFSubscriptionComponent/MPFSubscriptionComponent"],function(a,f,d,h,c,b,g,i){var e;e=a.extend({className:"mpf-subscription-management",setup:function(j){j=(j||{});g.requiredOfPrototype(j.product,c,"options.product must be a ProductModel");g.requiredOfPrototype(j.subscriptionFactory,b,"options.subscriptionFactory must be a SubscriptionFactory");this._parent(j);this.product=j.product;this.subscriptionFactory=j.subscriptionFactory;this.onlineInstanceId=j.onlineInstanceId;this.periodicitiesAlreadyPurchased=j.periodicitiesAlreadyPurchased;this.header=this._createHeader();this.circleHeader=this._createUserCircle();this.idxPage=0;this.page=this._initPage();this.listenTo(this.page,"onNext",this.onNextPage.bind(this));this.listenTo(this.page,"onBack",this.onBackPage.bind(this))},render:function(){this.circleHeader.setContent(f.createElement("span",{text:this.product.getTotalQuantity()}));this.container.setContent([this.header,this.circleHeader,this.page.render()]);return this},_initPage:function(){if(f.is(this.product.getSubscriptions())){return new d({product:this.product,subscriptionFactory:this.subscriptionFactory,onlineInstanceId:this.onlineInstanceId,periodicitiesAlreadyPurchased:this.periodicitiesAlreadyPurchased})}else{return new h({model:this.product})}},onNextPage:function(){this.idxPage+=1;this._updateHeaderCSS(this.idxPage)},onBackPage:function(){this.idxPage-=1;this._updateHeaderCSS(this.idxPage)},_updateHeaderCSS:function(j){this.header.toggleClassName("up",j>0);this.circleHeader.toggleClassName("up",j>0)},_createUserCircle:function(){return f.createElement("div",{"class":"mpf-circle-user"})},_createHeader:function(){return f.createElement("div",{"class":"mpf-recap-header",html:f.createElement("div",{text:this.product.getDisplayName()})})}});return e});define("DS/MPFSubscriptionComponent/SubscriptionTab",["UWA/Class/View","DS/MPFSubscriptionComponent/SubscriptionManagementComponent","DS/MPFSubscriptionComponent/OfferManagementComponent","DS/MPFCatalogueModel/CatalogueModel","DS/MPFModelFactory/SubscriptionFactory","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(h,e,f,d,a,b,c){var g;g=h.extend({className:"mpf-subscription-tab",setup:function(i){i=(i||{});b.requiredOfPrototype(i.subscriptionFactory,a,"options.subscriptionFactory must be a SubscriptionFactory");b.requiredOfPrototype(i.catalogue,d,"options.catalogue must be a CatalogueModel");this._parent(i);this.onlineInstanceId=i.onlineInstanceId;this.catalogue=i.catalogue;this.subscriptionFactory=i.subscriptionFactory;this.periodicitiesAlreadyPurchased=this._getPeriodicitiesAlreadyPurchased()},render:function(){var i=[];Array.prototype.push.apply(i,this._getOfferComponents());Array.prototype.push.apply(i,this._getNotOnlineProductComponents());Array.prototype.push.apply(i,this._getProductComponents());this.container.setContent(i);this.dispatchEvent("onRender");return this},_getProductComponents:function(){var i=this;return this.catalogue.getProducts().map(function(j){var k;k=new e({product:j,subscriptionFactory:i.subscriptionFactory,onlineInstanceId:i.onlineInstanceId,periodicitiesAlreadyPurchased:i.periodicitiesAlreadyPurchased});return k.render()})},_getNotOnlineProductComponents:function(){var i=this;return this.catalogue.getNotOnlineProducts().map(function(j){var k;k=new e({model:j,subscriptionFactory:i.subscriptionFactory,onlineInstanceId:i.onlineInstanceId,periodicitiesAlreadyPurchased:i.periodicitiesAlreadyPurchased});return k.render()})},_getOfferComponents:function(){var i=this;return this.catalogue.getOffers().map(function(k){var j;j=new f({offer:k,onlineInstanceId:i.onlineInstanceId,periodicitiesAlreadyPurchased:i.periodicitiesAlreadyPurchased});return j.render()})},_getPeriodicitiesAlreadyPurchased:function(){var k;var l;var i;var j=[];k=this.catalogue.getProducts();k.forEach(function(m){l=m.getSubscriptions();l.forEach(function(n){var o;i=n.getLicensingScheme();o=j.indexOf(i)!==-1;if(!o){j.push(i)}})});return j},destroy:function(){this.onlineInstanceId=null;this.catalogue=null;this.subscriptionFactory=null;this.periodicitiesAlreadyPurchased=null;this._parent();this.container=null}});return g});define("DS/MPFSubscriptionComponent/SubscriptionWidgetComponent",["UWA/Class/View","UWA/Core","DS/UIKIT/Toggler","DS/UIKIT/Scroller","DS/MPFSubscriptionComponent/SubscriptionTab","DS/MPFSubscriptionComponent/OrderTab","DS/MPFModelFactory/SubscriptionFactory","DS/MPFPersonModel/PersonModel","DS/MPFCatalogueModel/CatalogueModel","DS/MPFServices/ObjectService","DS/MPFModelFactory/ExportOrderFactory","DS/MPFModelFactory/InvoiceFactory","DS/MPFModelFactory/CartFactory","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent"],function(d,m,h,c,f,a,e,g,b,l,i,j,n,o){var k;k=d.extend({className:"mpf-subscription-widget",setup:function(p){p||(p={});this._checkPrototypes(p);this._parent(p);this.onlineInstanceId=p.onlineInstanceId;this.me=p.me;this.catalogue=p.catalogue;this.subscriptionFactory=p.subscriptionFactory;this.exportOrderFactory=p.exportOrderFactory;this.invoiceFactory=p.invoiceFactory;this.cartFactory=p.cartFactory;this.currentTabContainer=this._createTabDisplayer();this.tabs=this._initTabs();this.navTab=this._initNavTab()},render:function(){this.container.setContent([this.navTab,this.currentTabContainer]);try{new c({element:this.currentTabContainer}).inject(this.container)}catch(p){console.warn(p)}return this},_initNavTab:function(){var r=this;var q;var s;var p;q=m.createElement("a",{"class":"tab-item",text:o.get("subscriptions")});s=m.createElement("a",{"class":"tab-item",text:o.get("myOrders")});p=m.createElement("nav",{"class":"tab",html:[q,s]});this.toggler=new h({container:p,events:{onToggle:r._displayTab.bind(r)}});return p},_displayTab:function(q,p,s){this.currentTabContainer.setContent(this.tabs[p].render());try{new c({element:this.currentTabContainer}).inject(this.container)}catch(r){console.warn(r)}},_initTabs:function(){var p=[];p.push(new f({catalogue:this.catalogue,subscriptionFactory:this.subscriptionFactory,onlineInstanceId:this.onlineInstanceId}));p.push(new a({me:this.me,exportOrderFactory:this.exportOrderFactory,invoiceFactory:this.invoiceFactory,cartFactory:this.cartFactory}));return p},_createTabDisplayer:function(){return m.createElement("div",{"class":"mpf-subscription-tab-container"})},_checkPrototypes:function(p){l.requiredOfPrototype(p.me,g,"options.me must be a PersonModel");l.requiredOfPrototype(p.cartFactory,n,"options.cartFactory must be a CartFactory");l.requiredOfPrototype(p.invoiceFactory,j,"options.invoiceFactory must be an InvoiceFactory");l.requiredOfPrototype(p.exportOrderFactory,i,"options.exportOrderFactory must be an ExportOrderFactory");l.requiredOfPrototype(p.catalogue,b,"options.catalogue must be a CatalogueModel");l.requiredOfPrototype(p.subscriptionFactory,e,"options.subscriptionFactory must be a SubscriptionFactory")},destroy:function(){this.onlineInstanceId=null;this.me=null;this.catalogue=null;this.subscriptionFactory=null;this.exportOrderFactory=null;this.invoiceFactory=null;this.cartFactory=null;this.currentTabContainer=null;this.tabs=null;this.navTab=null;this._parent();this.container=null}});return k});define("DS/MPFSubscriptionComponent/SubscriptionWidgetWrapper",["UWA/Core","UWA/Class/View","UWA/Promise","DS/UIKIT/Mask","DS/MPFDataProxy/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFSubscriptionComponent/SubscriptionWidgetComponent","DS/MPFPersonModel/MePersonDataProxy","DS/MPFDataProxy/AppsConnector","DS/MPFAppsPlatform/PublicPlatformsDataProxy","DS/MPFAppsPlatform/PlatformCollection","DS/MPFAppsPlatform/ServiceEnum","i18n!DS/MPFSubscriptionComponent/assets/nls/SubscriptionComponent","css!DS/UIKIT/UIKIT.css"],function(i,b,k,h,e,m,j,d,f,a,c,l,n){var g=b.extend({init:function(o){o=(o||{});this._parent(o);this.i3DXCompassPlatformServices=o.i3DXCompassPlatformServices;this.widget=o.widget;this.deferred=k.deferred();this.promise=this.deferred.promise},inject:function(){this.container.setContent(this.widgetComponent.render());this.deferred=k.deferred();this.promise=this.deferred.promise},whenReady:function(){this._getOnlineInstance();return this.promise},refresh:function(){var o=this;this.onlineInstanceId=this.widget.getPreference("x3dPlatformId").value;this.widget.setTitle(this.onlineInstanceId);h.mask(this.widget.body);this._fetchCatalogue().then(this._initWidgetComponent.bind(this)).then(this.inject.bind(this))["catch"](function(p){console.error(p);o.widget.setBody(p==="OEdown"?n.get("serviceUnavailable"):n.get("errorLoading"))})["finally"](function(){h.unmask(o.widget.body)})},_initWidget:function(o){this._setWidgetPreferences(this.platforms);this._initWidgetComponent();o.resolve()},_initWidgetComponent:function(o){this.widgetComponent=new j({onlineInstanceId:this.onlineInstanceId,me:this.me,catalogue:this.catalogue,subscriptionFactory:this.subscriptionFactory,exportOrderFactory:this.exportOrderFactory,invoiceFactory:this.invoiceFactory,cartFactory:this.cartFactory})},_fetchResources:function(o){var p=this;this._fetchMarketplaceConnector().then(this._initFactories.bind(this)).then(this._fetchMeAllowingCreation.bind(this)).then(this._fetchSubscriptionData.bind(this)).then(this._initWidget.bind(this,o))["catch"](function(q){console.error(q);p.widget.setBody(q==="OEdown"?n.get("serviceUnavailable"):n.get("errorLoading"));o.reject()})},_fetchSubscriptionData:function(){return Promise.all([this._fetchCatalogue(),this._fetchMe()])},_fetchMe:function(){this.me=this.personFactory.createModel("me");return this.me.fetchPromise()},_fetchMeAllowingCreation:function(){var o={};this.me=this.personFactory.createModel("me");o[d.Params.ALLOW_CREATION]=true;return this.me.fetchPromise(o)},_fetchCatalogue:function(){this.catalogue=this.catalogueFactory.createModel("catalogue");this.catalogue.onlineInstanceId=this.onlineInstanceId;return this.catalogue.fetchPromise().then(function(o){if(o.getCode()===10){return k.reject("OEdown")}else{return k.resolve(o)}})},_initFactories:function(o){var p=this;this.factories=m.getInstance(o);return k.all([this.factories.getFactory(m.Types.PERSON),this.factories.getFactory(m.Types.CATALOGUE),this.factories.getFactory(m.Types.CART),this.factories.getFactory(m.Types.SUBSCRIPTION),this.factories.getFactory(m.Types.EXPORT_ORDER),this.factories.getFactory(m.Types.INVOICE)]).then(function(q){p.personFactory=q[0];p.catalogueFactory=q[1];p.cartFactory=q[2];p.subscriptionFactory=q[3];p.exportOrderFactory=q[4];p.invoiceFactory=q[5]})},_getOnlineInstance:function(){var o=this;this.i3DXCompassPlatformServices.getAppInfo({appId:"X3DOPMR_AP",onComplete:function(q){var p=q.platformId;o.platforms={};if(q.platforms.length>1){o.platforms=q.platforms}if(o.widget&&o.widget.getValue("x3dPlatformId")){if(o.widget.getValue("x3dPlatformId")===q.platformId){p=q.platformId}else{if(o.platforms){p=(o.platforms.detect(function(r){return r.id===o.widget.getValue("x3dPlatformId")})).id}}}else{if(!p&&o.platforms){p=o.platforms[0].id}}o.onlineInstanceId=p;o._fetchResources(o.deferred)}})},_setWidgetPreferences:function(o){var p=[];if(o.length>0){o.forEach(function(q){p.push({label:q.name,value:q.id,id:q.id})})}else{p.push({label:this.onlineInstanceId,value:this.onlineInstanceId,id:this.onlineInstanceId})}this.widget.setTitle(this.onlineInstanceId);this.widget.addPreference({type:"list",id:"x3dPlatformId",name:"x3dPlatformId",defaultValue:this.onlineInstanceId,label:n.get("3DExperiencePlatform"),options:p})},_fetchMarketplaceConnector:function(){var s;var p;var r;var o;s=window.location.origin.replace("-ifwe","-apps");p=new f(s+"/enovia/resources/AppsMngt");r=new a(p);o=new c([],{dataProxy:r});function q(u){return u.services.get(l.MARKETPLACE.name)}function t(u){return u.filter(q).pop()}return o.fetchPromise().then(t).then(function(v){var u;var w;var x;u=v.services.get(l.MARKETPLACE.name);x=u.getUrl();x+="/resources";w=new e(x,v.id,{service:"3DStore"});return w})}});return g});