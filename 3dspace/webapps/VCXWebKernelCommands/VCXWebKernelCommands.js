define("DS/VCXWebKernelCommands/VCXCommand",["UWA/Class"],function(a){var b=a.extend({init:function(){this._bLinkedCmd=false;this._callback=null;this._parameter=null},SetCallback:function(d,c){this._callback=d;this._parameter=c},IsLinkedCmd:function(){return this._bLinkedCmd},SetLinkedCmd:function(c){this._bLinkedCmd=c},Do:function(){},Redo:function(){this.Do()},Undo:function(){this.Invert();this.Do();this.Invert()},Invert:function(){},SaveContext:function(){},IsMergeable:function(){return false}});return b});define("DS/VCXWebKernelCommands/VCXCommandManager",["DS/CoreEvents/Events","DS/WebApplicationBase/W3AAManager",],function(a,c){var b=c.extend({initialize:function(){this._stackCmd=[];this._stackCmdUndo=[];this._isUnDoRunning=false;this._isReDoRunning=false;this._isDoRunning=false;this._pushLevel=0;this._bTransaction=false;this._stackLevelOfTransaction=[];this._stackMaxSize=500},unInitialize:function(){this._stackCmd=[];this._stackCmdUndo=[];this._isUnDoRunning=false;this._isReDoRunning=false;this._isDoRunning=false;this._pushLevel=0;this._bTransaction=false;this._stackLevelOfTransaction=[];this._stackMaxSize=500},postInitialize:function(){},SetStackMaxSize:function(d){this._stackMaxSize=d},GetStackMaxSize:function(){return this._stackMaxSize},Do:function(d){if(this._pushLevel===0){this._isDoRunning=true}this._pushLevel++;d.Do();this._pushLevel--;if(this._pushLevel===0){this._isDoRunning=false}},Push:function(e){if(this._isUnDoRunning){return}if(this._isReDoRunning){return}if(this._isDoRunning){this.Do(e);return}if(this._pushLevel>0){e.SetLinkedCmd(true)}if(this._bTransaction){e=this.MergeTransaction(e)}this._stackCmdUndo=[];this._pushLevel++;var d=this._stackCmd.length;if(d===this._stackMaxSize){this._stackCmd.shift()}this._stackCmd.push(e);e.SaveContext();e.Do();this._pushLevel--;a.publish({event:"VCX_UNDOREDO_STACK_UPDATE"})},MergeTransaction:function(g){var d=g.GetType();if(!g.IsMergeable()){return g}var e=this._stackLevelOfTransaction.length;var k=this._stackLevelOfTransaction[e-1];var m=null;for(var j=this._stackCmd.length-1;j>=k;j--){var l=this._stackCmd[j];if(l){var h=l.IsLinkedCmd();if(!h){m=l;break}}}if(m){var f=m.GetType();if(f!==d){return g}}else{return g}this.Undo(true);g=m.Merge(g);return g},Undo:function(d){if(d){}else{if(this._bTransaction){return}}this._isUnDoRunning=true;var e=this._stackCmd.pop();while(e){if(e.IsLinkedCmd()){e.Undo();this._stackCmdUndo.push(e);e=this._stackCmd.pop()}else{break}}if(e){e.Undo();this._stackCmdUndo.push(e)}this._isUnDoRunning=false;if(this._bTransaction){}else{a.publish({event:"VCX_UNDOREDO_DONE"})}},Redo:function(){this._isReDoRunning=true;var d=this._stackCmdUndo.pop();if(d){this._stackCmd.push(d);d.Redo()}d=this._stackCmdUndo.pop();while(d){if(d.IsLinkedCmd()){d.Redo();this._stackCmd.push(d);d=this._stackCmdUndo.pop()}else{break}}if(d){this._stackCmdUndo.push(d)}this._isReDoRunning=false;a.publish({event:"VCX_UNDOREDO_DONE"})},Empty:function(){this._stackCmd=[];this._stackCmdUndo=[];a.publish({event:"VCX_UNDOREDO_STACK_UPDATE"})},StartTransaction:function(){this._bTransaction=true;this._stackLevelOfTransaction.push(this._stackCmd.length);a.publish({event:"VCX_STARTED_TRANSACTION"})},EndTransaction:function(h){var d=this._stackLevelOfTransaction.pop();if(this._stackLevelOfTransaction.length>0){return}if(typeof d!=="undefined"){}else{console.log("No index of start found here !");return}for(var e=d+1;e<this._stackCmd.length;e++){var g=this._stackCmd[e];g.SetLinkedCmd(true)}if(d<this._stackCmd.length){var j=this._stackCmd[d];if(j){var f="Transaction commands";if(h){f=h}j.GetTitle=function(){return f}}}this._bTransaction=false;a.publish({event:"VCX_END_TRANSACTION"})},});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXCommandManager"}});return b});define("DS/VCXWebKernelCommands/VCXCmdApplyScenario",["DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap"],function(c,b){var a=c.extend({init:function(d){this._parent();this._scenarioManager=d;this._propMapForUndo=new b();this._scenarioForDo=null;this._viewForUndo=null;this._bDoNotApplyVis=false;this._type="VCXCmdApplyScenario"},GetType:function(){return this._type},GetTitle:function(){return"Apply scenario"},ApplyScenario:function(f,e,d){this._scenarioForDo=f;if(e){this._bDoNotApplyVis=e}if(d){this._viewForUndo=d}},Do:function(){var e=this._scenarioManager._experienceBase.getManager("VCXVisuManager");if(e){e.CameraControlsViewpoint=true}this._scenarioManager.ApplyView(this._scenarioForDo,this._bDoNotApplyVis);if(e){e.CameraControlsViewpoint=false}if(this._scenarioForDo.GetZoomFitAll()){var d=this._scenarioManager._experienceBase.getManager("VCXContextManager");if(d){d.zoomFitAll()}}},SaveContext:function(){if(this._viewForUndo){}else{this._viewForUndo=this._scenarioManager.CaptureCurrentView()}},Redo:function(){this.Do()},Undo:function(){if(this._viewForUndo){var d=this._scenarioManager._experienceBase.getManager("VCXVisuManager");if(d){d.CameraControlsViewpoint=true}this._scenarioManager.ApplyView(this._viewForUndo);if(d){d.CameraControlsViewpoint=false}}}});return a});define("DS/VCXWebKernelCommands/VCXCmdChangeKeys",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebTracks/VCXKey","DS/VCXKeyFramer/VCXObjectAnimation","DS/VCXWebTracks/VCXTrack","DS/WebRBTree/WebRBIterator"],function(b,f,g,e,a,c){var d=f.extend({init:function(h){this._parent();this._scenarioManager=h;this._keysForDo=[];this._keysForUndo=[];this._bLockEvents=false;this._bLockUpdateProperties=false;this._bCloneValues=true;this._type="VCXCmdChangeKeys"},GetType:function(){return this._type},GetTitle:function(){return"Change keys"},Do:function(){var l={};l.setModifiablesTrackRemoved={};l.setModifiablesTrackModified={};for(var k=0;k<this._keysForDo.length;k++){var n=this._keysForDo[k];var h=n.scenario.GetObjectAnimation(n.modifiable.GetHashing());if(h){}else{if(n.value){h=new e();n.scenario.AddObjectAnimation(n.modifiable.GetHashing(),h)}}if(h){var j=h.GetTrack(n.propertyName);if(j){}else{if(n.value){j=new a();h.AddTrack(n.propertyName,j)}}if(j){l.setModifiablesTrackModified[n.modifiable.GetHashing()]=true;if(n.value){var m=new g();m.SetFrame(n.frame);if(this._bCloneValues){m.SetValue(n.value.Clone())}else{m.SetValue(n.value)}j.AddKey(m)}else{j.RemoveKey(n.frame);if(j.IsEmpty()){h.RemoveTrack(n.propertyName);l.setModifiablesTrackRemoved[n.modifiable.GetHashing()]=true;if(h.GetTrackNumber()===0){n.scenario.RemoveObjectAnimation(n.modifiable.GetHashing())}}}if(!this._bLockUpdateProperties){this._scenarioManager.UpdateProperty(n.modifiable.GetHashing(),n.propertyName)}}}}if(this._bLockEvents){}else{l.keysForDo=this._keysForDo;b.publish({event:"VCX_KEYS_CHANGED",data:l});b.publish({event:"VCX_PROPERTIES_CHANGED"})}},Invert:function(){var h=this._keysForDo;this._keysForDo=this._keysForUndo;this._keysForUndo=h},SaveContext:function(){for(var m=0;m<this._keysForDo.length;m++){var p=this._keysForDo[m];var j=null;var o=p.modifiable.GetHashing();if(o){j=p.scenario.GetObjectAnimation(p.modifiable.GetHashing())}else{console.log("VCXCmdChangeKey: hashing is empty !")}var n=null;if(j){var k=j.GetTrack(p.propertyName);if(k){var l=k.GetKey(p.frame);if(l){if(l.GetFrame()===p.frame){n=l.GetValue().Clone()}}}}var h={};h.scenario=p.scenario;h.modifiable=p.modifiable;h.propertyName=p.propertyName;h.frame=p.frame;h.value=n;this._keysForUndo.push(h)}},ChangeKey:function(h,i,k,l,m){if(h){var j={};j.scenario=h;j.modifiable=i;j.propertyName=k;j.frame=l;if(m){if(this._bCloneValues){j.value=m.Clone()}else{j.value=m}}this._keysForDo.push(j)}},MoveKey:function(p,k,m,j,l){if(k===null){return}var h=null;var n=p.GetObjectAnimation(k.GetHashing());if(n){var i=n.GetTrack(m);if(i){var o=i.GetKey(j);if(o){h=o.GetValue()}}}if(h){this.ChangeKey(p,k,m,j,null);this.ChangeKey(p,k,m,l,h)}},RemoveTracks:function(l,q,k){var n=l.GetObjectAnimation(q.GetHashing());if(n){}else{return}if(k&&k.length>0){}else{n.GetListTrackNames(k)}for(var j=0;j<k.length;j++){var p=k[j];var h=n.GetTrack(p);if(h){var r=h._treekeys;var m=new c(r);var o=m.next();while(o!==null){this.ChangeKey(l,q,p,o.GetFrame());o=m.next()}}}},SetLockEvents:function(h){this._bLockEvents=h},SetLockUpdateProperties:function(h){this._bLockUpdateProperties=h},SetCloneValues:function(h){this._bCloneValues=h}});return d});define("DS/VCXWebKernelCommands/VCXCmdChangeTimePos",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand"],function(a,c){var b=c.extend({init:function(d){this._parent();this._scenarioManager=d;this._timePosForUndo=-1;this._timePosForDo=-1;this._scenarioForDoUndo=null;this._bLockEvents=false;this._type="VCXCmdChangeTimePos";this._viewForUndo=null},GetType:function(){return this._type},GetTitle:function(){return"Change time position"},Do:function(){var f=false;var e=this._scenarioManager._experienceBase.getManager("VCXVisuManager");if(e){f=e.CameraControlsViewpoint;e.CameraControlsViewpoint=true}var h=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(this._scenarioForDoUndo);if(h){h.SetCurrentFrame(this._timePosForDo)}var g=this._scenarioManager._experienceBase.getManager("VCXCommandManager");this._scenarioManager.UpdateProperties();if(this._bLockEvents){}else{a.publish({event:"VCX_TIMEPOS_CHANGED",data:this._timePosForDo});a.publish({event:"VCX_PROPERTIES_CHANGED"});var d=this._scenarioManager._experienceBase.getManager("VCXExperience");if(d){d.SetVolatileNotSaved(false)}}if(e){e.CameraControlsViewpoint=f}},Undo:function(){var d=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(this._scenarioForDoUndo);d.SetCurrentFrame(this._timePosForUndo);this._scenarioManager.ApplyView(this._viewForUndo,true);if(this._bLockEvents){}else{a.publish({event:"VCX_TIMEPOS_CHANGED",data:this._timePosForUndo});a.publish({event:"VCX_PROPERTIES_CHANGED"})}},SaveContext:function(){this._timePosForUndo=this._scenarioManager.GetCurrentFrame();if(this._viewForUndo===null){this._viewForUndo=this._scenarioManager.CaptureCurrentView()}},ChangeTimePos:function(d,e){this._scenarioForDoUndo=this._scenarioManager.GetCurrentScenario();this._timePosForDo=d;if(e){this._timePosForUndo=e}},SetViewForUndo:function(d){this._viewForUndo=d},SetLockEvents:function(d){this._bLockEvents=d}});return b});define("DS/VCXWebKernelCommands/VCXCmdChangeModifiable",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap"],function(a,d,c){var b=d.extend({init:function(e){this._parent();this._scenarioManager=e;this._modTracks={};this._neutrals=new c();this._listModToAdd=[];this._listModToRemove=[];this._bLockEvents=false;this._type="VCXCmdChangeModifiable"},GetType:function(){return this._type},GetTitle:function(){return"Change modifiable"},RemoveModifiables:function(e){this._listModToRemove=this._listModToRemove.concat(e)},AddModifiables:function(e){this._listModToAdd=this._listModToAdd.concat(e)},Do:function(){var k=this._scenarioManager.ModifiableServer;var h=this._scenarioManager.GetScenarios();for(var f=0;f<this._listModToAdd.length;f++){var o=this._listModToAdd[f];var m=o.GetHashing();if(m){var g=this._modTracks[m];if(g){for(var e in g){if(g.hasOwnProperty(e)){var l=g[e];this._scenarioManager.AddObjectAnimation(this._listModToAdd[f],h[e],l)}}}}k.AddModifiable(o);var j=this._neutrals.GetPropertySet(o.GetHashing());if(j){this._scenarioManager.AddNeutrals(o,j)}}for(var n=0;n<this._listModToRemove.length;n++){var m=this._listModToRemove[n].GetHashing();var g=this._modTracks[m];if(g){for(var e in g){if(g.hasOwnProperty(e)){this._scenarioManager.RemoveObjectAnimation(m,h[e])}}}this._scenarioManager.RemoveModifiableFromRestoreSet(m);k.RemoveModifiable(m);this._scenarioManager.RemoveNeutrals(m)}if(this._bLockEvents){}else{a.publish({event:"VCX_MODIFIABLE_CHANGED",});a.publish({event:"VCX_KEYS_CHANGED"})}},Invert:function(){var e=this._listModToAdd;this._listModToAdd=this._listModToRemove;this._listModToRemove=e},SaveContext:function(){var j=this._scenarioManager.GetScenarios();for(var f=0;f<this._listModToRemove.length;f++){var e=false;var g={};var o=this._listModToRemove[f];var n=o.GetHashing();for(var m in j){if(j.hasOwnProperty(m)){var h=j[m];var k=h.GetObjectAnimation(n);if(k){g[m]=k;e=true}}}if(e){this._modTracks[n]=g}var l=this._scenarioManager.GetNeutrals(n);if(l){this._neutrals.AddOrModifyPropertySet(n,l)}}},SetLockEvents:function(e){this._bLockEvents=e}});return b});define("DS/VCXWebKernelCommands/VCXCmdGoToScenario",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeTimePos","DS/VCXWebKernelCommands/VCXCmdApplyScenario"],function(b,e,c,a){var d=e.extend({init:function(g,f){this._parent();this._scenarioManager=g;this._commandManager=f;this._bLockEvents=false;this._bSetActiveScenario=true;this._cmdApplyScenario=null;this._type="VCXCmdGoToScenario";this._viewForUndo=null},GetType:function(){return this._type},GetTitle:function(){return"Go to scenario"},GoToScenario:function(g,f){this._scenarioIdForDo=g;this._timePosForUndo=this._scenarioManager.GetCurrentFrame();var h=this._scenarioManager._Scenarios[g];if(f){this._viewForUndo=f}},Do:function(){if(this._bSetActiveScenario){this._scenarioManager.SetCurrentScenario(this._scenarioIdForDo);var f=0;var h=new c(this._scenarioManager);h.ChangeTimePos(f);h.SetLockEvents(this._bLockEvents);h.SetViewForUndo(this._viewForUndo);this._commandManager.Push(h);var i=this._scenarioManager._Scenarios[this._scenarioIdForDo];if(i){var g=new a(this._scenarioManager,this._commandManager);g.ApplyScenario(i,null,this._viewForUndo);this._commandManager.Push(g);if(this._bLockEvents){}else{b.publish({event:"VCX_CURRENT_SCENARIO_CHANGED",data:i})}}else{console.log("VCXCmdGoToScenario : scenario NOT found !")}}},SaveContext:function(){if(this._bSetActiveScenario){this._scenarioIdForUndo=this._scenarioManager.GetCurrentScenario();if(this._scenarioIdForUndo===""){console.log("No current scenario !!")}}},Redo:function(){if(this._bLockEvents){}else{if(this._bSetActiveScenario){this._scenarioManager.SetCurrentScenario(this._scenarioIdForDo);var f=this._scenarioManager._Scenarios[this._scenarioIdForDo];b.publish({event:"VCX_CURRENT_SCENARIO_CHANGED",data:f})}}},Undo:function(){if(this._bLockEvents){}else{if(this._bSetActiveScenario&&this._scenarioIdForUndo){this._scenarioManager.SetCurrentScenario(this._scenarioIdForUndo);var f=this._scenarioManager._Scenarios[this._scenarioIdForUndo];b.publish({event:"VCX_CURRENT_SCENARIO_CHANGED",data:f})}}},SetLockEvents:function(f){this._bLockEvents=f},SetActiveScenario:function(f){this._bSetActiveScenario=f},});return d});define("DS/VCXWebKernelCommands/VCXCmdChangeComponent",["DS/VCXWebKernelCommands/VCXCommand"],function(b){var a=b.extend({init:function(c,d){this._parent();this._commandManager=c;this._ComponentsMap=d;this._listCompToAdd=[];this._listCompToRemove=[];this._type="VCXCmdChangeComponent"},GetType:function(){return this._type},GetTitle:function(){return"Change component"},RemoveComponents:function(c){this._listCompToRemove=this._listCompToRemove.concat(c)},AddComponents:function(c){this._listCompToAdd=this._listCompToAdd.concat(c)},Do:function(){for(var d=0;d<this._listCompToAdd.length;d++){var c=this._listCompToAdd[d];if(c){this._ComponentsMap.AddComponent(c)}}for(var e=0;e<this._listCompToRemove.length;e++){var c=this._listCompToRemove[e];if(c){var f=this._listCompToRemove[e].GetID();this._ComponentsMap.RemoveComponent(f)}}},Invert:function(){var c=this._listCompToAdd;this._listCompToAdd=this._listCompToRemove;this._listCompToRemove=c}});return a});define("DS/VCXWebKernelCommands/VCXCmdChangeScenario",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeModifiable","DS/VCXWebKernelCommands/VCXCmdChangeComponent"],function(a,d,c,b){var e=d.extend({init:function(h,f,g){this._parent();this._scenarioManager=h;this._commandManager=f;this._ComponentsMap=g;this._scenariosToAdd=[];this._scenariosToRemove=[];this._bLockEvents=false;this._type="VCXCmdChangeScenario"},GetType:function(){return this._type},GetTitle:function(){return"Change scenario"},AddScenarios:function(f){this._scenariosToAdd=this._scenariosToAdd.concat(f)},RemoveScenarios:function(f){this._scenariosToRemove=this._scenariosToRemove.concat(f)},Do:function(){var i=this;var g=new c(this._scenarioManager);var f=new b(this._commandManager,this._ComponentsMap);this._scenariosToAdd.forEach(function(j){f.AddComponents(j);g.AddModifiables(j.QueryInterface("VCXIModifiable"))});this._scenariosToRemove.forEach(function(j){f.RemoveComponents(j);g.RemoveModifiables(j.QueryInterface("VCXIModifiable"))});this._commandManager.Push(f);this._commandManager.Push(g);this._scenariosToAdd.forEach(function(j){i._scenarioManager.AddScenario2(j)});this._scenariosToRemove.forEach(function(j){i._scenarioManager.RemoveScenario(j.GetID())});if(this._bLockEvents){}else{var h={arrayToAdd:this._scenariosToAdd,arrayToRemove:this._scenariosToRemove};a.publish({event:"VCX_SCENARIOS_CHANGED",data:h})}},Undo:function(){var g=this;this._scenariosToAdd.forEach(function(h){g._scenarioManager.RemoveScenario(h.GetID())});this._scenariosToRemove.forEach(function(h){g._scenarioManager.AddScenario2(h)});if(this._bLockEvents){}else{var f={arrayToAdd:this._scenariosToRemove,arrayToRemove:this._scenariosToAdd};a.publish({event:"VCX_SCENARIOS_CHANGED",data:f})}},Redo:function(){var g=this;this._scenariosToAdd.forEach(function(h){g._scenarioManager.AddScenario2(h)});this._scenariosToRemove.forEach(function(h){g._scenarioManager.RemoveScenario(h.GetID())});if(this._bLockEvents){}else{var f={arrayToAdd:this._scenariosToAdd,arrayToRemove:this._scenariosToRemove};a.publish({event:"VCX_SCENARIOS_CHANGED",data:f})}},SetLockEvents:function(f){this._bLockEvents=f}});return e});define("DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap"],function(a,d,c){var b=d.extend({init:function(){this._parent();this._propertyMap=new c();this._propertyMapOld=new c();this._mapModifiables={};this._bLockEvents=false;this._type="VCXCmdChangePropertiesVolatile"},GetType:function(){return this._type},GetTitle:function(){return"Change properties volatile"},ChangeProperties:function(e){for(var g in e._map){if(e._map.hasOwnProperty(g)){var i=this._mapModifiables[g];var f=e.GetPropertySet(g);for(var j in f._map){if(f._map.hasOwnProperty(j)){var h=f._map[j];i.OnChangeProperty(j,h.GetPropertyValue())}}i.OnChangePropertiesEnd()}}},Do:function(){this.ChangeProperties(this._propertyMap);var e=this;if(this._bLockEvents){}else{a.publish({event:"VCX_PROPERTIES_CHANGED",data:e._propertyMap})}if(this._callback){this._callback(this._parameter)}},Invert:function(){var e=this._propertyMap;this._propertyMap=this._propertyMapOld;this._propertyMapOld=e},SaveContext:function(){for(var f in this._propertyMap._map){if(this._propertyMap._map.hasOwnProperty(f)){var h=this._mapModifiables[f];var e=this._propertyMap.GetPropertySet(f);for(var i in e._map){if(e._map.hasOwnProperty(i)){var g=h.GetProperty(i);this._propertyMapOld.AddOrModifyProperty(f,g)}}}}},ChangeProperty:function(f,e){var g=f.GetHashing();this._mapModifiables[g]=f;this._propertyMap.AddOrModifyProperty(g,e.Clone())},SetLockEvents:function(e){this._bLockEvents=e}});return b});define("DS/VCXWebKernelCommands/VCXCmdChangePropertyMap",["DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet"],function(e,a,c,d){var b=e.extend({init:function(){this._parent();this._keysForDo=[];this._keysForUndo=[];this._type="VCXCmdChangePropertyMap"},GetType:function(){return this._type},GetTitle:function(){return"Change property map"},Do:function(){for(var g=0;g<this._keysForDo.length;g++){var h=this._keysForDo[g];var f=h.propertyMap.GetPropertySet(h.modifiable.GetHashing());if(f){}else{if(h.value){f=new d();h.propertyMap.AddOrModifyPropertySet(h.modifiable.GetHashing(),f)}}if(f){var j=f.GetProperty(h.propertyName);if(j){if(h.value){j.SetPropertyValue(h.value.Clone())}else{f.RemoveProperty(h.propertyName);if(f.GetPropertyNumber()===0){h.propertyMap.RemovePropertySet(h.modifiable.GetHashing())}}}else{var j=new a(new c(h.propertyName),h.value.Clone());h.propertyMap.AddOrModifyProperty(h.modifiable.GetHashing(),j)}}}},Invert:function(){var f=this._keysForDo;this._keysForDo=this._keysForUndo;this._keysForUndo=f},SaveContext:function(){for(var h=0;h<this._keysForDo.length;h++){var l=this._keysForDo[h];var k=null;var g=null;var j=l.modifiable.GetHashing();if(j){g=l.propertyMap.GetPropertySet(j)}else{console.log("VCXCmdChangePropertyMap: hashing is empty !")}if(g){var m=g.GetProperty(l.propertyName);if(m){k=m.GetPropertyValue().Clone()}}var f={};f.propertyMap=l.propertyMap;f.modifiable=l.modifiable;f.propertyName=l.propertyName;f.value=k;this._keysForUndo.push(f)}},ChangeProperty:function(i,f,h,j){var g={};g.propertyMap=i;g.modifiable=f;g.propertyName=h;if(j){g.value=j.Clone()}this._keysForDo.push(g)}});return b});define("DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties",["DS/VCXWebKernelCommands/VCXCmdChangePropertyMap"],function(b){var a=b.extend({init:function(c){this.neutrals=c._keyframer._Neutrals;this._parent();this._type="VCXCmdChangeNeutrals"},GetType:function(){return this._type},GetTitle:function(){return"Change neutral properties"},ChangeProperty:function(c,d,e){this._parent(this.neutrals,c,d,e)},CaptureNeutralProperties:function(d){var f=d.GetProperties();if(f){for(var e in f._map){if(f._map.hasOwnProperty(e)){var c=f.GetProperty(e);if(c){this.ChangeProperty(d,e,c.GetPropertyValue())}}}}}});return a});define("DS/VCXWebKernelCommands/VCXCmdChangeLinkedProperties",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties"],function(b,d,a){var c=d.extend({init:function(f,g,e){this._linkedPropertyManager=f;this._scenarioManager=g;this._commandManager=e;this._parent();this._linksToAdd=[];this._linksToRemove=[];this._type="VCXCmdChangeLinkedProperties"},GetType:function(){return this._type},GetTitle:function(){return"Modify properties links"},Do:function(){if(this._linksToRemove.length>0){for(var h=0;h<this._linksToRemove.length;h++){this._linksToRemove[h].converter=this._linkedPropertyManager.RemoveLink(this._linksToRemove[h].inID,this._linksToRemove[h].inProp,this._linksToRemove[h].outID,this._linksToRemove[h].outProp);var g=this._scenarioManager._keyframer._Neutrals;var f=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(this._linksToRemove[h].outID);var j=f.QueryInterface("VCXIModifiable");if(j){var e=g.GetProperty(j.GetHashing(),this._linksToRemove[h].outProp);if(e){var m=e.GetPropertyValue();j.OnChangeProperty(this._linksToRemove[h].outProp,m)}this._scenarioManager.UpdateProperties(j.GetHashing(),this._linksToRemove[h].outProp);j.OnChangePropertiesEnd()}}b.publish({event:"VCX_LINKS_REMOVED"})}if(this._linksToAdd.length>0){var k=new a(this._scenarioManager);var g=this._scenarioManager._keyframer._Neutrals;for(var h=0;h<this._linksToAdd.length;h++){this._linkedPropertyManager.AddLink(this._linksToAdd[h].inID,this._linksToAdd[h].inProp,this._linksToAdd[h].outID,this._linksToAdd[h].outProp,this._linksToAdd[h].converter);var f=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(this._linksToAdd[h].outID);if(f){var j=f.QueryInterface("VCXIModifiable");if(j){if(g.GetProperty(j.GetHashing(),this._linksToAdd[h].outProp)){}else{var l=j.GetProperty(this._linksToAdd[h].outProp);if(l){k.ChangeProperty(j,this._linksToAdd[h].outProp,l.GetPropertyValue())}}}}}this._commandManager.Push(k);b.publish({event:"VCX_LINKS_ADDED"})}this._linkedPropertyManager.UpdateProperties();b.publish({event:"VCX_PROPERTIES_CHANGED"})},Invert:function(){var e=this._linksToAdd;this._linksToAdd=this._linksToRemove;this._linksToRemove=e},AddLink:function(i,f,h,e,j){var g={inID:i,inProp:f,outID:h,outProp:e,converter:j};this._linksToAdd.push(g)},RemoveLink:function(i,f,h,e){var g={inID:i,inProp:f,outID:h,outProp:e};this._linksToRemove.push(g)},RemoveLinksFromPropertyName:function(f,g){var e=this._linkedPropertyManager.GetLinksFromPropertyName(f,g);this._linksToRemove=this._linksToRemove.concat(e)},RemoveLinks:function(e){this._linksToRemove=this._linksToRemove.concat(e)}});return c});define("DS/VCXWebKernelCommands/VCXCmdReplaceScenario",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebExperienceLoader/VCXExperienceSaverBase"],function(c,e,d,b,f){var a=e.extend({init:function(g){this._parent();this._scenarioManager=g;this._scenarioToModify=null;this._dataForDo={};this._dataForUndo={};this._bLockEvents=false;this._type="VCXCmdReplaceScenario"},GetType:function(){return this._type},GetTitle:function(){return"Replace scenario"},ReplaceScenario:function(i,g){this._scenarioToModify=i;var j=g.QueryInterface("VCXIModifiable");var h=this._scenarioManager.GetNeutrals(j.GetHashing());this._dataForDo.neutrals=h.Clone();this._dataForDo.scenario=g.Clone()},Do:function(){var p=this;var n=this._scenarioToModify.QueryInterface("VCXIModifiable");this._scenarioManager.RemoveNeutrals(n.GetHashing());this._scenarioManager.AddNeutrals(n,this._dataForDo.neutrals.Clone());this._dataForDo.scenario.Clone(this._scenarioToModify);var t=this._scenarioManager._experienceBase;var o=t.getManager("VCXCAT3DXModelManager");if(o&&!o.IsLocalMode()){var g=t.getManager("VCXDocManager").actorDocManager;var l=g.QueryInterface("VCXIModifiable");var k=new b(t.getManager("VCXScenarioManager"));k.CaptureNeutralProperties(l);k.Do();var r=this._scenarioToModify.GetID();var m=this._sequenceIDForAdd;var j=new f();var i=j._ScenarioToJson(t,this._scenarioToModify);var w=j._VisibilityToJson(this._scenarioToModify.GetVisibility(),t);i.visibility=w;var v=[];v.push(i);var u={};u.listScenarios=v;var h=JSON.stringify(u,null,4);var s={};s.neutrals=j._NeutralsToJson(t);var q=JSON.stringify(s,null,4);o.UpdateState(r,m,q,h)}if(this._bLockEvents){}else{c.publish({event:"VCX_SCENARIO_REPLACED",data:p._scenarioToModify})}},SaveContext:function(){var g=this._scenarioToModify.QueryInterface("VCXIModifiable");var h=this._scenarioManager.GetNeutrals(g.GetHashing());this._dataForUndo.neutrals=h.Clone();this._dataForUndo.scenario=this._scenarioToModify.Clone()},Invert:function(){var g=this._dataForDo;this._dataForDo=this._dataForUndo;this._dataForUndo=g},SetLockEvents:function(g){this._bLockEvents=g}});return a});define("DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey",["DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties"],function(f,e,d,c,a){var b=f.extend({init:function(g,i,h){this._parent();this._propertyMap=new e();this._scenarioManager=g;this._commandManager=i;this._bForceAutokey=h;this._bLockEvents=false;this._type="VCXCmdChangePropertiesAutokey"},GetType:function(){return this._type},GetTitle:function(){return"Change properties autokey"},Do:function(){var h=this._scenarioManager.GetCurrentFrame();var j=this._scenarioManager.GetAutoKey();var k=this._scenarioManager._keyframer._Neutrals;var o=this._scenarioManager.GetCurrentScenario();var m=this._scenarioManager._Scenarios[o];var g=new c(this._scenarioManager);var i=new d();var p=new a(this._scenarioManager);for(var r in this._propertyMap._map){if(this._propertyMap._map.hasOwnProperty(r)){var w=this._scenarioManager.ModifiableServer.GetModifiableFromHashing(r);var n=this._propertyMap.GetPropertySet(r);for(var l in n._map){if(n._map.hasOwnProperty(l)){var t=n._map[l];var q=t.GetPropertyInfo().GetBehaviorType();var v=t.GetPropertyInfo().IsPersistent();if(v){if(q===2){p.ChangeProperty(w,l,t.GetPropertyValue())}else{if(k.GetProperty(r,l)){}else{var s=w.GetProperty(l);if(s){p.ChangeProperty(w,l,s.GetPropertyValue())}}}}i.ChangeProperty(w,t);if(v&&(q!==2)&&(j||this._bForceAutokey)){var u=h;if(q===1){u=0}g.ChangeKey(m,w,l,u,t.GetPropertyValue())}}}}}if(this._bLockEvents){i.SetLockEvents(this._bLockEvents);g.SetLockEvents(this._bLockEvents)}this._commandManager.Push(i);this._commandManager.Push(g);this._commandManager.Push(p)},Redo:function(){},Undo:function(){},Invert:function(){},SaveContext:function(){},ChangeProperty:function(h,g){var i=h.GetHashing();if(i){}else{this._scenarioManager.ModifiableServer.AddModifiable(h);i=h.GetHashing()}this._propertyMap.AddOrModifyProperty(i,g.Clone())},ChangePropertiesFromMap:function(g){this._propertyMap=g.Clone()},Merge:function(h){if(h){}else{return}var i=new b(this._scenarioManager,this._commandManager);var j=this._propertyMap.Clone();var g=h._propertyMap;j.Merge(g);i.ChangePropertiesFromMap(j);return i},SetLockEvents:function(g){this._bLockEvents=g},IsMergeable:function(){return true}});return b});define("DS/VCXWebKernelCommands/VCXCmdChangeVisibility",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisibility/VCXIVisibility",],function(a,f,e,c,b){var d=f.extend({init:function(i,g,h){this._parent();this._scenarioManager=i;this._componentsMap=g;this._commandManager=h;this._propertyMap=new e();this._listChange=[];this._visibility=b.EVisState.Hidden;this._type="VCXCmdChangeVisibility"},GetType:function(){return this._type},GetTitle:function(){return"Change Visibility"},_switchListChangeVisibilityIfNeeded:function(h,j){var l=j;if(typeof j==="boolean"){console.warn("There shouldn't be a boolean in argument for this method. Use instead a Number, with 0 for hidden, 1 for visible.");l=j?b.EVisState.Visible:b.EVisState.Hidden}if(l===h){for(var g=0;g<this._listChange.length;++g){var i=this._listChange[g];if(i){var k=i.QueryInterface("VCXIVisibility");if(k){k.SetVisibility(h)}}}}},Do:function(){if(this._listChange.length===0){console.log("nothing to change visibility on");return}this._switchListChangeVisibilityIfNeeded(b.EVisState.Visible,this._visibility);this._switchListChangeVisibilityIfNeeded(b.EVisState.Hidden,this._visibility);if(this._scenarioManager.GetAutoKey()){this._scenarioManager.CaptureCurrentVisibility()}var i;for(var g=0;g<this._listChange.length;++g){var h=this._listChange[g];if(h&&!i){i=h._experienceBase.getManager("VCXContextManager");i.traverseGraphMustBePerformed=true;break}}if(!this._bLockEvents){a.publish({event:"VCX_VISIBILITY_CHANGED",data:{components:this._listChange.slice(),visibility:this._visibility}})}},Invert:function(){var g=(this._visibility===b.EVisState.Hidden);this._visibility=g?b.EVisState.Visible:b.EVisState.Hidden},SaveContext:function(){},ChangeVisibility:function(k,g){for(var j=0;j<k.length;j++){var h=k[j];if(h){var l=h.QueryInterface("VCXIVisibility");if(l){if(l.GetVisibility()!==g){this._listChange.push(h)}}}}this._visibility=g},SetLockEvents:function(g){this._bLockEvents=g}});return d});define("DS/VCXWebKernelCommands/VCXCmdPlayScenario",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdApplyScenario"],function(b,d,a){var c=d.extend({init:function(g,e,f){this._parent();this._scenarioManager=g;this._componentsMap=e;this._commandManager=f;this._scenarioToPlay=null;this._type="VCXCmdPlayScenario";this._startFrame=0;this._bLockEvents=false;this._playCurrent=false;this._bDoNotApplyVis=false;this._bIsBounce=false;this._bIsLoop=false;this._bIsReverse=false;this._speed=1},GetType:function(){return this._type},GetTitle:function(){return"Play Scenario"},PlayScenario:function(i,g,f,e,h,k,j){this._scenarioToPlay=i;if(typeof g!=="undefined"){this._startFrame=g}else{if(g===-1){this._startFrame=i.GetCurrentFrame()}}if(f){this._bDoNotApplyVis=f}if(typeof h!="undefined"){this._bIsBounce=h}if(typeof e!="undefined"){this._bIsLoop=e}if(typeof k!="undefined"){this._bIsReverse=k}if(typeof j!="undefined"){this._speed=Math.round(j)}},Do:function(){if(this._scenarioToPlay){}else{b.publish({event:"VCX_END_PLAY_SCENARIO"});return}var g=this;var e=this._scenarioManager.PlayScenario(this._scenarioToPlay,this._startFrame,this._bIsLoop,this._bIsBounce,this._bIsReverse,this._speed);if(e){this._scenarioToPlay.SetID(e)}var f=new a(this._scenarioManager,this._commandManager);f.ApplyScenario(this._scenarioToPlay,this._bDoNotApplyVis);this._commandManager.Do(f);this._playEndEvent=b.subscribe({event:"VCX_SCENARIO_PLAY_END_REACHED"},function(h){if(g._scenarioToPlay.GetID()===h){b.unsubscribe(g._playEndEvent);b.publish({event:"VCX_END_PLAY_SCENARIO",data:h});if(g._callback){g._callback(g._parameter);g._scenarioManager.SetCallback(null,null)}}})},StopPlayingScenario:function(){b.unsubscribe(this._playEndEvent);this._scenarioManager.StopPlayingScenario(this._scenarioToPlay.GetID());if(this._callback){this._callback(this._parameter);this._scenarioManager.SetCallback(null,null)}},Undo:function(){console.log("apply undo VCXCmdPlayScenario");this.StopPlayingScenario()},Redo:function(){this.Do()},SaveContext:function(){},SetLockEvents:function(e){this._bLockEvents=e}});return c});define("DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdPlayScenario","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXKeyFramer/VCXObjectAnimation","DS/VCXWebTracks/VCXTrack","DS/VCXWebTracks/VCXKey","DS/VCXWebTracks/VCXEasing","DS/VCXWebVisibility/VCXIVisibility",],function(b,e,a,c,g,k,l,i,f,h,d){var j=e.extend({init:function(o,m,n){this._parent();this._scenarioManager=o;this._componentsMap=m;this._commandManager=n;this._scenarioForDo=null;this._scenarioTransition=null;this._wuxEventScenarioPlayed=null;this._type="VCXCmdGoToScenarioWithInterpolation";this._bSetActiveScenario=true;this._bLockEvents=false},GetType:function(){return this._type},GetTitle:function(){return"Go To Scenario With Interpolation"},Do:function(){var m=this._scenarioTransition.GetMaxFrame();var o=this._scenarioManager.GetTransitionTime();if(!this._bLockEvents){b.publish({event:"VCX_BEGIN_TRANSITION",data:{maxframe:o/1000,scenario:this._scenarioForDo}})}var v=null;if(this._bSetActiveScenario){v=new a(this._scenarioManager,this._commandManager);v.GoToScenario(this._scenarioForDo.GetID(),this._viewForUndo);v.SetActiveScenario(this._bSetActiveScenario)}var s=this._scenarioManager._experienceBase.getManager("VCXVisuManager");if(s){s.setTransitionMode(true)}var q=this._scenarioManager.GetFPS();this._scenarioManager.SetFPS(50);if(o!=0){var n=m/(o/1000);this._scenarioManager.SetFPS(n)}var t=this._scenarioManager.GetInterFramesMax();this._scenarioManager.SetInterFramesMax(-1);var p=new c(this._scenarioManager,this._componentsMap,this._commandManager);p.PlayScenario(this._scenarioTransition);this._commandManager.Do(p);var r=this;var u=function(){r._scenarioManager.SetInterFramesMax(t);r._scenarioManager.SetFPS(q);b.unsubscribe(r._wuxEventScenarioPlayed);if(v){v.SetLinkedCmd(true);r._commandManager.Push(v)}if(!r._bLockEvents){b.publish({event:"VCX_END_TRANSITION"})}if(s){s.setTransitionMode(false)}if(r._callback){r._callback(r._parameter)}};this._wuxEventScenarioPlayed=b.subscribe({event:"VCX_END_PLAY_SCENARIO"},function(w){if(w==="VCX_Scenario_Transition"){u()}})},Undo:function(){},Redo:function(){},SaveContext:function(){this._viewForUndo=this._scenarioManager.CaptureCurrentView()},BuildTransitionTo:function(m){this._scenarioForDo=m;this._scenarioTransition=this.BuildScenarioForTransition(this._scenarioForDo);this._scenarioTransition.SetID("VCX_Scenario_Transition")},BuildScenarioForTransition:function(H){console.time("BuildScenarioForTransition");var L=this._scenarioManager._experienceBase;var N=L.Factory.BuildComponent("VCXScenario");N.SetPersistency(2);N.SetApplyNeutralAtGoToScenario(false);N.SetIsTransition(true);var z=new g();var q={propMapDiffNeutrals:z,};var ai=this._scenarioManager.CaptureCurrentView(q);var E=L.getManager("VCXVisuManager");if(E){E.CameraControlsViewpoint=true}d.lockVisibilityOpacity=true;this._scenarioManager.ApplyView(H);d.lockVisibilityOpacity=false;if(H.GetZoomFitAll()){var n=this._scenarioManager._experienceBase.getManager("VCXContextManager");if(n){n.zoomFitAll()}}if(E){E.CameraControlsViewpoint=false}var o=new g();this._scenarioManager.CaptureDiffOfNeutrals(o,true);for(var F in z._map){if(z._map.hasOwnProperty(F)){var m=this._scenarioManager.ModifiableServer.GetModifiableFromHashing(F);var ah=z.GetPropertySet(F);for(var ab in ah._map){if(ah._map.hasOwnProperty(ab)){var Q=o.GetProperty(F,ab);if(Q){continue}var r=m.GetProperty(ab);if(r){o.AddOrModifyProperty(F,r)}}}}}d.lockVisibilityOpacity=true;this._scenarioManager.ApplyView(ai);d.lockVisibilityOpacity=false;var O=N.GetVisibility();var y=false;var K=false;var aj=null;if(E){aj=E.getActiveViewport()}if(aj){var A=aj.QueryInterface("VCXIModifiable");var al=A.GetProperties(false);var af=o.GetPropertySet(A.GetHashing());if(af&&al){if(!al.IsEqualTo(af,{intersection:true})){K=true}}}for(var S in o._map){if(o._map.hasOwnProperty(S)){var I=this._scenarioManager.ModifiableServer.GetModifiableFromHashing(S);var aa=I.GetObject();var R=I.GetRequiredPropertiesForTransition();var T=o.GetPropertySet(S);for(var ab in T._map){if(T._map.hasOwnProperty(ab)){var M=I.GetProperty(ab);if(M){var ak=M.GetPropertyValue();var V=T.GetProperty(ab);var W=V.GetPropertyValue();if(!ak.IsEqualTo(W)||(R&&R.hasOwnProperty(ab))){if(ak._bUndefined===true){continue}var Z=N.GetObjectAnimation(S);if(Z){}else{Z=new l();if(typeof S==="undefined"){this._scenarioManager.ModifiableServer.AddModifiable(I);console.log("hashing is undefined")}N.AddObjectAnimation(S,Z)}var G=Z.GetTrack(ab);if(G){}else{G=new i();Z.AddTrack(ab,G)}if((aa.IsKindOf("VCXWebComponentCamera")||aa.IsKindOf("VCXComponentCamera")||aa.IsKindOf("VCXComponentViewport"))&&K){G.easing=h.easeInOutPower3;var C=new f();C.SetFrame(0);if(y){C.SetValue(W)}else{C.SetValue(ak)}G.AddKey(C);var B=new f();B.SetFrame(60);B.SetValue(W);G.AddKey(B)}else{var ac=ak.GetType();if((ac==="VCXPropertyValueLocation")||(ac==="VCXPropertyValueFrame")||(ac==="VCXPropertyValueFloat")||(ac==="VCXPropertyValuePoint2D")||(ac==="VCXPropertyValueVector")){G.easing=h.easeInOutPower3}var C=new f();C.SetFrame(0);C.SetValue(ak);var B=new f();B.SetValue(W);if(!aa.IsKindOf("VCXComponentCamera")){var Y=I.QueryInterface("VCXIVisibility");if(Y){var ae=Y.GetVisibility();if(ae===d.EVisState.Hidden){C.SetValue(W)}}}var x=H.GetVisibility();if(x){var p=x.IsVisibleWithParents(I.GetObject());var w=x.GetMode();var D=0;if(p===1||(p===-1&&w===2)||(p===-1&&w===0)||(p===0&&w===1)){D=1}if(D===0){B.SetValue(ak)}}if(K){var t=new f();t.SetFrame(60);t.SetValue(C.GetValue());G.AddKey(t);B.SetFrame(120)}else{B.SetFrame(60)}G.AddKey(B);G.AddKey(C)}}}}}}}var X="Actor.Visibility.Opacity";var v=H;if(v){var x=v.GetVisibility();if(x){var u=L.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence");var w=x.GetMode();for(var ad=0;ad<u.length;ad++){var ag=u[ad];if(ag){if(ag.QueryInterface("VCXIModelNavigable").getChildren().length!==0){continue}var J=1;var D=1;var Y=ag.QueryInterface("VCXIVisibility");if(Y){var ae=Y.GetVisibility();if(ae!==d.EVisState.Hidden){J=1}else{J=0}D=J;var p=x.IsVisibleWithParents(ag);if(w===0){if(p===1){D=1}else{if(p===0){D=0}}}else{if(w===1){if(p===1){D=1}else{D=0}}else{if(w===2){if(p===0){D=0}else{D=1}}}}if(J!==D){O.AddVisible(ag);var s=ag.QueryInterface("VCXIModifiable");if(s.GetHashing()){}else{this._scenarioManager.ModifiableServer.AddModifiable(s)}var G=new i();var Z=N.GetObjectAnimation(s.GetHashing());if(Z===null){Z=new l();N.AddObjectAnimation(s.GetHashing(),Z)}Z.AddTrack(X,G);var C=new f();C.SetFrame(0);var ak=new k();ak.SetValue(J);C.SetValue(ak);var t=new f();t.SetValue(C.GetValue());var B=new f();var W=new k();W.SetValue(D);B.SetValue(W);if(J===1&&D===0){if(K){t.SetFrame(60);B.SetFrame(75)}else{t.SetFrame(0);B.SetFrame(15)}}else{if(J===0&&D===1){if(K){t.SetFrame(105);B.SetFrame(120)}else{t.SetFrame(45);B.SetFrame(60)}}else{t.SetFrame(0);B.SetFrame(135)}}G.AddKey(C);G.AddKey(t);G.AddKey(B)}}}}var P=L.getManager("VCXDressupManager").getDressups();for(var U in P){if(P.hasOwnProperty(U)){var ag=P[U];if(ag){var J=1;var D=1;var Y=ag.QueryInterface("VCXIVisibility");if(Y){var ae=Y.GetVisibility();if(ae!==d.EVisState.Hidden){J=1}else{J=0}if(x.FindVisibleCollab(ag.GetID())>=0){D=1}else{if(v.GetApplyNeutralAtGoToScenario()||v.GetIsTransition()||J===0){D=0}}if(J!==0||D!==0){var s=ag.QueryInterface("VCXIModifiable");O.AddVisibleCollab(ag);var G=new i();var Z=N.GetObjectAnimation(s.GetHashing());if(Z===null){Z=new l();N.AddObjectAnimation(s.GetHashing(),Z)}Z.AddTrack(X,G);var C=new f();C.SetFrame(0);var ak=new k();ak.SetValue(J);C.SetValue(ak);var t=new f();t.SetValue(C.GetValue());var B=new f();var W=new k();W.SetValue(D);B.SetValue(W);if(J===1&&D===0){if(K){t.SetFrame(60);B.SetFrame(75)}else{t.SetFrame(0);B.SetFrame(15)}}else{if(J===0&&D===1){if(K){t.SetFrame(120);B.SetFrame(135)}else{t.SetFrame(60);B.SetFrame(75)}}else{t.SetFrame(0);B.SetFrame(135)}}G.AddKey(C);G.AddKey(t);G.AddKey(B)}}}}}}}console.timeEnd("BuildScenarioForTransition");return N},SetActiveScenario:function(m){this._bSetActiveScenario=m},SetLockEvents:function(m){this._bLockEvents=m}});return j});define("DS/VCXWebKernelCommands/VCXCmdChangePropertiesWithAnimation",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation",],function(a,f,e,c,b){var d=f.extend({init:function(i,g,h){this._parent();this._scenarioManager=i;this._componentsMap=g;this._commandManager=h;this._propertyMap=new e();this._scenarioTarget=null;this.easingFunctions={};this._bLockEvents=false;this._type="VCXCmdChangePropertiesWithAnimation"},GetType:function(){return this._type},GetTitle:function(){return"Change properties with animation"},Do:function(){var q=this._scenarioManager._experienceBase.getManager("VCXContextManager").getActiveCamera();if(q){var p=q.QueryInterface("VCXIViewpointController");if(p){p.fromViewpoint()}}var i={bIsPartialView:true};this._scenarioTarget=this._scenarioManager.CaptureCurrentView(i);this._scenarioTarget.SetPropertyMapAtFrame(this._propertyMap,0);var o=new b(this._scenarioManager,this._componentsMap,this._commandManager);o.SetActiveScenario(false);o.SetCallback(this._callback,this._parameter);o.SetLockEvents(this._bLockEvents);var s=o.BuildTransitionTo(this._scenarioTarget);if(s){var j=s._animations;for(var k in j){if(j.hasOwnProperty(k)){var r=j[k];if(r){for(var l in r._Tracks){if(r._Tracks.hasOwnProperty(l)){var g=r._Tracks[l];var h=this.easingFunctions[k];if(h){var n=h[l];if(n){g.easing=n}}}}}}}}var m=new c(this._scenarioManager,this._commandManager);m.ChangePropertiesFromMap(this._propertyMap);m.SetLockEvents(true);this._commandManager.Push(m);this._commandManager.Do(o)},Undo:function(){if(this._bLockEvents){}else{a.publish({event:"VCX_PROPERTIES_CHANGED"})}},Redo:function(){if(this._bLockEvents){}else{a.publish({event:"VCX_PROPERTIES_CHANGED"})}},SaveContext:function(){},ChangeProperty:function(i,h,l){var j=i.GetHashing();if(j){}else{this._scenarioManager.ModifiableServer.AddModifiable(i);j=i.GetHashing()}this._propertyMap.AddOrModifyProperty(j,h.Clone());if(l){var k=h.GetPropertyInfo().GetPropertyName();var g=this.easingFunctions[j];if(g){}else{g={};this.easingFunctions[j]=g}g[k]=l}},SetLockEvents:function(g){this._bLockEvents=g}});return d});