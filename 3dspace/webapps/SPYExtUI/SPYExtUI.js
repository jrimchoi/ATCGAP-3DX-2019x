/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/SPYExtUI/CATSimNavDataFrameViewXYChartUI",["UWA/Core","DS/CoreEvents/Events","DS/SPYUI/CATSimNavDataFrameViewCompUI","DS/SPY/CATSimNavDataHelper","DS/SPYD3js_external/SPYD3js","css!SPYExtUI/CATSimNavDataFrameViewXYChartUI.css","i18n!DS/SPYExtUI/assets/nls/CATSimNavDataFrameViewXYChartUI"],function(g,m,b,s,d,n,f){if(!Array.prototype.find){Array.prototype.find=function(t){if(this===null){throw new TypeError("Array.prototype.find called on null or undefined")}if(typeof t!=="function"){throw new TypeError("predicate must be a function")}var y=Object(this);var w=y.length>>>0;var u=arguments[1];var x;for(var v=0;v<w;v++){x=y[v];if(t.call(u,x,v,y)){return x}}return undefined}}var i=function(u,t){return typeof u==="number"&&isFinite(u)&&Math.floor(u)===u&&u<t};var e=function(v,t){var u=true;for(var w=0;w<v.length&&u;w++){u=i(v[w],t)}return u};var k=function(w,t){var v="";if(w&&w[t]){var u=w[t].getUnit();if(u&&u.length>0){v+=" "+u}}return v};var p=function(t){return k(t,"xAxis")};var o=function(t){return k(t,"yAxis")};var a=function(w,A){if(Math.round(A)-Math.round(w)>10){return 2}var E=function(G){return G.toString().replace(/e-?\d*/,"")};var v=function(G){return G.replace("-","").replace(".","").replace(",","").replace(/0+/,"").trim()};var t=E(A);var u=E(w);var B=v(t);var x=v(u);var F=B.length;var z=x.length;var D=Math.max(F,z);var y;if(F===z){y=parseInt(B)-parseInt(x)}else{var C=parseFloat(parseFloat(t).toFixed(D))-parseFloat(parseFloat(u).toFixed(D));y=parseInt(v(C.toFixed(D)))}return(y<Math.pow(10,D-2))?D-1:2};var h=function(D,w,y,z,A,t,u){var C=D.format(t);var v=isNaN(w)||undefined===y?D.format(u):D.format("."+w.toString()+y);var B;if(!isNaN(z)){var x=Math.pow(10,z);B=function(E){return v(E/x)}}else{B=A?C:v}return B};var j=6.2;var l="#000";var c=[25,-15];var r=[10,0];var q=b.extend({init:function(){this.svgContainer=null;this.xychartViewer=null;this.currentPositionCircle=null;this.currentProbingCircle=null;this.curveLegendLabel=null;this.curveLegendCurrentIdx=null;this.curveLegendCurrentPos=null;this.curveLegendCurrentValue=null;this.curveLegendSample=null;this.nbFrames=0;this.currentGroup=null;this.curveNodeGroups=null;this.curvePathes=null;this.pcsData={}},_getDataDisplay:function(){return this.implementation.getDataDisplay().spm.window.SPMUI.getActiveDD()},_getXFormatter:function(u,t,w,v){return h(u,t,"g",w,v,"d",".2g")},_getYFormatter:function(u,t,w,v){return h(u,t,"e",w,v,"d",".2e")},_getMarkerColor:function(t){return t.style.markerColor?t.style.markerColor:t.color},_getMarkerSize:function(t){return !isNaN(t.style.markerSize)?t.style.markerSize:1},_getMarkerRadius:function(t){var u=this._getMarkerSize(t);return(u*2).toString()+"px"},_findCurveForGroup:function(v){var w;var u=this.implementation.getCurves();var t=true;for(var x=0;x<u.length&&!w;x++){w=(u[x].rootName===v.rootName&&u[x].loadCaseName===v.loadCaseName)?u[x]:undefined;t=(t&&!u[x].rootName&&u[x].isCrossGroup)}if(!w&&t){w=u[0]}return w},_findLocalFrame:function(z,I,x,t){var A=NaN;if(z&&I&&!isNaN(x)){if(z.getGroups().length===0){A=x}else{var J=I.frameList;var C;var G;var w;for(var E=0;E<J.length;E++){if(J[E].globalIndex===x+1){w=E;if(J[E].isScaledPosition){for(var F=E;F<J.length;F++){if(!J[F].isScaledPosition){w=F}}}break}}if(!isNaN(w)){C=J[w].position;G=J[w].localIndex-1;if(!isNaN(C)){var y=z.getValues();var u=0,B=y.length-1;var D=0;if(t){u=t.start;B=t.end}for(var H=u;H<=B;H++){if(y[H].getPosition()===C&&(y[H].getGroupId()===I.id||y[H].getGroupId()===I.idNoMode)){A=D;break}D++}}else{if(!isNaN(G)){A=G}}}}}return A},_addAxisExponent:function(t){if(t&&!isNaN(t.exponent)){var v=t.scaleFunction(t.max);v+=c[t.dimension-1];var u=r[t.dimension-1].toString();var x=t.dimension===1?"translate ("+v.toString()+", "+u+")":"translate ("+u+", "+v.toString()+" )";var w=t.svg.append("g").attr("class","spy-data-chart-axis-exponent").attr("transform",x);w.append("text").style("fill",t.color).text("x 10");w.append("text").attr("class","spy-data-chart-axis-exponent-power").style("fill",t.color).text(t.exponent.toString())}},_addCurveLegend:function(u){var w=function(y,x){if(y){var z=y.append("rect").attr("curveIdx",x.curveIdx).attr("x",0).attr("y",!isNaN(x.mouseoverTopOffset)?x.mouseoverTopOffset:0).attr("width",x.width).attr("height",x.height).style("fill","green").style("opacity",0).on("mouseover",x.mouseover).on("mouseout",x.mouseout);if(x.tooltip){z.append("svg:title").text(x.tooltip)}}};var v=function(B,z,y){var A=z.append("g").attr("class",y.css).attr("transform","translate("+(!isNaN(y.leftOffset)?y.leftOffset:0)+","+(!isNaN(y.topOffset)?y.topOffset:0)+")");var x=A.append("text").style("fill",y.color).text(y.text);if(y.tooltip){x.append("svg:title").text(y.tooltip)}if(y.mouseover&&y.mouseout&&!isNaN(y.curveIdx)){w(A,y)}B.push(x)};var t=function(A,y,x){var z=y.append("g").attr("class",x.css).attr("transform","translate("+(!isNaN(x.leftOffset)?x.leftOffset:0)+","+(!isNaN(x.topOffset)?x.topOffset:0)+")");z.append("line").attr("x1",0).attr("y1",x.height/2).attr("x2",x.width).attr("y2",x.height/2).style("stroke",x.color).style("stroke-width",x.lineWidth).style("stroke-dasharray",x.lineStyle);z.append("svg:circle").attr("cx",x.width/2).attr("cy",x.height/2).attr("r",x.markerRadius).attr("fill",x.markerColor);w(z,x);A.push(z)};if(u.label){v(this.curveLegendLabel,this.xychartViewer,{color:u.color,css:u.label.css,leftOffset:u.label.leftOffset,topOffset:u.label.topOffset,text:u.label.text,tooltip:u.label.tooltip,width:u.label.width,height:u.label.height,curveIdx:u.label.curveIdx,mouseoverTopOffset:-1*u.label.height,mouseover:u.label.mouseover,mouseout:u.label.mouseout})}if(u.index){v(this.curveLegendCurrentIdx,this.xychartViewer,{color:u.color,css:u.index.css,leftOffset:u.index.leftOffset,topOffset:u.index.topOffset,text:u.index.text})}if(u.position){v(this.curveLegendCurrentPos,this.xychartViewer,{color:u.color,css:u.position.css,leftOffset:u.position.leftOffset,topOffset:u.position.topOffset,text:u.position.text})}v(this.curveLegendCurrentValue,this.xychartViewer,{color:u.color,css:u.value.css,leftOffset:u.value.leftOffset,topOffset:u.value.topOffset,text:u.value.text});if(u.sample){t(this.curveLegendSample,this.xychartViewer,{color:u.color,markerColor:u.markerColor,markerRadius:u.markerRadius,css:u.sample.css,leftOffset:u.sample.leftOffset,topOffset:u.sample.topOffset,width:u.sample.width,height:u.sample.height,lineStyle:u.sample.lineStyle,curveIdx:u.sample.curveIdx,mouseover:u.sample.mouseover,mouseout:u.sample.mouseout})}},_clearCurveLegendValues:function(){if(!this._curveLegendBackup){this._curveLegendBackup=[];for(var u=0;u<this.curves.length;u++){var t=this._curveLegendBackup[u]={};if(this.curveLegendCurrentIdx&&this.curveLegendCurrentIdx[u]){t.currentIdxText=this.curveLegendCurrentIdx[u].text();this.curveLegendCurrentIdx[u].text("")}if(this.curveLegendCurrentPos&&this.curveLegendCurrentPos[u]){t.currentPosText=this.curveLegendCurrentPos[u].text();this.curveLegendCurrentPos[u].text("")}if(this.curveLegendCurrentValue&&this.curveLegendCurrentValue[u]){t.currentValueText=this.curveLegendCurrentValue[u].text();this.curveLegendCurrentValue[u].text("")}}}},_restoreCurveLegend:function(){if(this._curveLegendBackup){for(var u=0;u<this.curves.length;u++){var t=this._curveLegendBackup[u];if(this.curveLegendCurrentIdx&&this.curveLegendCurrentIdx[u]){this.curveLegendCurrentIdx[u].text(t.currentIdxText)}if(this.curveLegendCurrentPos&&this.curveLegendCurrentPos[u]){this.curveLegendCurrentPos[u].text(t.currentPosText)}if(this.curveLegendCurrentValue&&this.curveLegendCurrentValue[u]){this.curveLegendCurrentValue[u].text(t.currentValueText)}}this._curveLegendBackup=undefined}},_updateCurveLegend:function(u,w,v,t){if(this.curveLegendCurrentIdx&&this.curveLegendCurrentPos&&this.curveLegendCurrentValue){if(this.curveLegendCurrentIdx[u]&&w){this.curveLegendCurrentIdx[u].text(w)}if(this.curveLegendCurrentPos[u]&&v){this.curveLegendCurrentPos[u].text(v)}if(this.curveLegendCurrentValue[u]&&t){this.curveLegendCurrentValue[u].text(t)}}},_keepLegendVisibleFor:function(t){for(var v=0;v<this.curves.length;v++){var u=(v===t)?"visible":"hidden";if(this.curveLegendLabel&&this.curveLegendLabel[v]){this.curveLegendLabel[v].attr("visibility",u)}if(this.curveLegendCurrentIdx&&this.curveLegendCurrentIdx[v]){this.curveLegendCurrentIdx[v].attr("visibility",u)}if(this.curveLegendCurrentPos&&this.curveLegendCurrentPos[v]){this.curveLegendCurrentPos[v].attr("visibility",u)}if(this.curveLegendCurrentValue&&this.curveLegendCurrentValue[v]){this.curveLegendCurrentValue[v].attr("visibility",u)}if(this.curveLegendSample&&this.curveLegendSample[v]){this.curveLegendSample[v].attr("visibility",u)}}},_keepProbingCircleVisibleFor:function(t){for(var v=0;v<this.currentProbingCircle.length;v++){var u=(v===t)?"visible":"hidden";this.currentProbingCircle[v].attr("visibility",u)}},_updateProbingCircle:function(u,t,v){if(this.currentProbingCircle&&u>=0&&u<this.currentProbingCircle.length){this.currentProbingCircle[u].attr("cx",t);this.currentProbingCircle[u].attr("cy",v);this.currentProbingCircle[u].attr("visibility","visible")}},_keepPositionCircleVisibleFor:function(t){for(var u=0;u<this.currentPositionCircle.length;u++){this.currentPositionCircle[u].attr("visibility","hidden")}if(t>=0&&t<this.currentPositionCircle.length){this.currentPositionCircle[t].attr("visibility","visible")}},_keepCurrentCurve:function(u){var t=function(w){var x=(w===u)?"visible":"hidden";return function(y){y.attr("visibility",x)}};for(var v=0;v<this.curveNodeGroups.length&&v<this.curvePathes.length;v++){this.curveNodeGroups[v].forEach(t(v));this.curvePathes[v].forEach(t(v))}},_updateGroupBlockTooltip:function(z,v,y,x){if(this._groupBlockTooltipText&&this._groupBlockTooltip&&this._groupBlockTooltipBg){var t=s.buildGroupName([z,v]);var w=t.length*j*1.15;if(y+w>=x){y=y-w/2;if(y<0){y=0}if(y+w>=x){y=y-w/2;if(y<0){y=0}}}var u=this._groupBlockTooltip.attr("defaultYPos");this._groupBlockTooltip.attr("transform","translate("+y+","+u+")");this._groupBlockTooltip.attr("visibility","visible");this._groupBlockTooltipText.text(t);this._groupBlockTooltipBg.attr("width",w)}},_hideGroupBlockTooltip:function(){if(this._groupBlockTooltip){this._groupBlockTooltip.attr("visibility","hidden")}},_highlightAxis:function(u){var t=(u!==undefined);this.curves.forEach(function(v){v.xAxisLayout.svg.classed("spy-data-chart-axis-dimmed",t);v.yAxisLayout.svg.classed("spy-data-chart-axis-dimmed",t)});if(u){u.forEach(function(v){v.xAxisLayout.svg.classed("spy-data-chart-axis-dimmed",false);v.yAxisLayout.svg.classed("spy-data-chart-axis-dimmed",false)})}},buildXYChart:function(ax,a2,cy){var bt=new Date;var bY=d;if(!bY){console.log(" 3DPlay for Simulation - d3 not defined : impossible to render XYChart");return}if(!ax){console.log(" 3DPlay for Simulation - XY component not defined");return}if(!a2){return}var H=ax.implementation.getMetadata();var bC=ax.implementation.getCurves();var cL=ax.implementation.getAxisList("x");var ay=ax.implementation.getAxisList("y");if(bC&&H&&cL&&ay&&cL.length>0&&ay.length>0){var K=bC.length<=10?10:20;var bw=bC.length<=10?bY.schemeCategory10:bY.schemeCategory20;this.curveLegendLabel=[];this.curveLegendCurrentIdx=[];this.curveLegendCurrentPos=[];this.curveLegendCurrentValue=[];this.curveLegendSample=[];this.currentPositionCircle=[];var aE=H.isBarChart;var Q=0.9;var aZ=340;var cl=aZ;if(!isNaN(cy)&&cy*Q>aZ){cl=Q*cy}var bR=cL.length>1||ay.length>1;var b8=3;var ae=6;var at=30;var t=20;var af=70;var cq=55;var aI=65;var b3={count:0},ap={count:0},x={count:0},ar={count:0};var aD=function(cO,cN){return function(cP){if(cP.getPosition()===cN){cO.count++}}};ay.forEach(aD(b3,"left"));ay.forEach(aD(ap,"right"));cL.forEach(aD(x,"top"));cL.forEach(aD(ar,"bottom"));var aS=30+x.count*at;var aJ=ar.count*at;if(ap.count===0&&b3.count===1&&!ay[0].getName()){af=cq}var aW=b3.count*af;var aT=30+ap.count*af;var M=cl-aW-aT;var a1=Math.round(M/58);var ct=5;var ao=2;var a5=2;var bc=20;var bb=7;var b1=10;var z=200;var bQ=15;var ab=20;var cg=0;var an=0;var bx=120;var ak=15;var bp=0;var ce=3;var y=15;var aa=(cl<=400);var X=aa?30:50;var cB=5;var b7=aa?0.18*cl:0.4*cl;b7=b7>250?250:b7;var aO=0.26*cl;aO=aO>130?130:aO;var bm=0.27*cl;bm=bm>130?130:bm;var aU=0;bp=65;if(!H.oneCurvePerGroup){aU+=y*bC.length;cg+=aU}else{cg=15}if(this.xychartViewer){this.xychartViewer.remove()}this.xychartViewer=bY.select(a2).append("svg");if(this.xychartViewer){this.xychartViewer.style("width",(M+aW+aT).toString()+"px");this.xychartViewer.style("height",(z+aU+aS+bp+aJ).toString()+"px");this.xychartViewer.append("rect").attr("class","spy-data-chart-background").attr("x",aW).attr("y",aS).attr("width",M).attr("height",z);this.curves=[];var bN,aA,cw,a8;var b5=true;var aH=true;var bI={};var bd;var bh=this;var ca=this._getDataDisplay();m.subscribe({event:ca.getSPM().getContext()+"/SPY/FRAME/ENABLESELECT"},function(){this._playFlag=false}.bind(this));var cs=undefined;if(ca&&ca.isAnimated()&&(H.animation==="true")){cs=ca.getComputedFramesByGroup()}var a4=function(cO,cQ){var cP;if(cO&&cQ){var cN=cO.find(function(cR){return cR.position===cQ});if(cN){cP=cN.globalIndex}}return cP};var U;var cu;var az;var S;var ah;var cK;var bo;var aB=bC[0].getValues().length-1;if(H.animation==="true"&&ca.isAnimated()){if(ca){cK=true===ca.isPartialAnimationMode();var bg=isNaN(this.initFrame)?ca.getTotalNumberOfFrames()-1:this.initFrame;bo=cK?ca.getAnimationScope(bg):ca.getDefaultAnimationScope(bg);aB=isNaN(this.initFrame)?bo.frames[bo.frames.length-1].globalIndex-1:this.initFrame;U=ca.getGroupForFrame(aB);if(U&&U.group){az=U.group.unit?" "+U.group.unit:"";S=U.group.rootName;ah=U.group.loadCaseName}cu=ca.getAnimationStructure().groupList}}this._displayPositionsOnX=(H.hasPositions&&az&&(!H.isCrossGroup||cK));if(cL.length>1){this._displayPositionsOnX=false}else{this._displayPositionsOnX=(cL[0].getName()||cL[0].getUnit())?false:this._displayPositionsOnX}this.curvesScope={};var aP=true;var b9=[];var bJ=function(cP){var cN=s.parseGroupIds(cP);var cQ=s.buildGroupIdNoMode(cN[0],cN[1]);var cO=s.buildGroupName(cN);b9.push({id:cP,idNoMode:cQ,rootName:cN[0],loadCaseName:!s.isModeSeparator(cN[1])?cN[1]:undefined,name:cO})};var ck=function(cN,cO){return(bo.groupIDs.indexOf(cN)>=0||bo.groupIDsNoMode.indexOf(cO)>=0)};var br=function(cN){if(bo&&!ck(cN.id,cN.idNoMode)){cN.isNotInCurrentAnimation=true}return(!cK||ck(cN.id,cN.idNoMode))};for(var R=0;R<bC.length;R++){var w=bC[R].getMetadata();aP=aP&&w.isBijective;bd={id:w.name?w.name.replace(/\s+/g,""):R.toString(),name:w.name,nameY:w.nameY,rootName:w.rootName,loadCaseName:w.loadCaseName,pieces:[],domainX:[],domainY:[],domainPosition:[],domainGroup:[],offset:bC[R].offset,style:bC[R].getCurveStyle(),xAxis:this.implementation.getAxis(bC[R].getAssignedAxisX()),yAxis:this.implementation.getAxis(bC[R].getAssignedAxisY()),isFilled:w.isFilled,isStacked:w.isStacked};bd.style.color=bd.style.color?bd.style.color:bw[R%K];bd.color=bd.style.color;bd.clipped=(bd.xAxis.hasFixedBounds()||bd.yAxis.hasFixedBounds());var T=-1;var N=bC[R].getGroups();b9=[];N.forEach(bJ);if(bo&&!H.oneCurvePerGroup){b9=b9.filter(br)}bI={};var aL=bC[R].getValues();this.curvesScope.end=0;var bE=false;var bu;var aq;var bW=-1;for(var bL=0;bL<aL.length;bL++){if(aL[bL]){if(H.oneCurvePerGroup||!cK||(cK&&bo&&ck(aL[bL].getGroupId(),aL[bL].getGroupId()))){var cG=this._displayPositionsOnX?aL[bL].getPosition():aL[bL].getX();var am=aL[bL].getY();var ch=true;if(bd.xAxis.getScale()==="log"){ch=(cG>0)}if(bd.yAxis.getScale()==="log"){ch=(am>0)}if(ch){if(!bE){bd.pieces.push([]);bW++;bu=bd.pieces[bW];aq=0}bd.domainX.push(cG);bd.domainY.push(am);var bl=aL[bL].getPosition();bd.domainPosition.push(bl);T++;var cn=aL[bL].getGroupId();bu.push({x:bd.domainX[T],y:bd.domainY[T],position:bl,group:cn,curveIdx:R,globalFrameIdx:cs?a4(cs.get(cn),bl):undefined,idx:aq,pieceIdx:bW});if(bI[cn]){bI[cn].count++}else{bI[cn]={count:1}}if(isNaN(this.curvesScope.start)){this.curvesScope.start=bL}this.curvesScope.end=bL}bE=ch}}}bd.xmin=Math.min.apply(null,bd.domainX);bd.xmax=Math.max.apply(null,bd.domainX);bd.ymin=Math.min.apply(null,bd.domainY);bd.ymax=Math.max.apply(null,bd.domainY);bN=!isNaN(bN)?(bd.xmin<bN?bN=bd.xmin:bN):bd.xmin;aA=!isNaN(aA)?(bd.xmax>aA?aA=bd.xmax:aA):bd.xmax;cw=!isNaN(cw)?(bd.ymin<cw?cw=bd.ymin:cw):bd.ymin;a8=!isNaN(a8)?(bd.ymax>a8?a8=bd.ymax:a8):bd.ymax;if(aH){aH=e(bd.domainX,1000);if(aH){a1=(a1>bd.domainX.length)?bd.domainX.length:a1}}if(b5){b5=e(bd.domainY,10000)}this.curves.push(bd)}this.xAxisLayout=[];this.yAxisLayout=[];var I=function(cO,cN){cN.min=cO.getFixedBounds().min;cN.max=cO.getFixedBounds().max;if(isNaN(cN.min)||isNaN(cN.max)){if(cN.assignedCurves.length>0){if(isNaN(cN.min)){cN.assignedCurves.forEach((function(cP){return function(cQ){cN.min=!isNaN(cN.min)?(cQ[cP]<cN.min?cN.min=cQ[cP]:cN.min):cQ[cP]}})(cO.getDimension()===2?"ymin":"xmin"))}if(isNaN(cN.max)){cN.assignedCurves.forEach((function(cP){return function(cQ){cN.max=!isNaN(cN.max)?(cQ[cP]>cN.max?cN.max=cQ[cP]:cN.max):cQ[cP]}})(cO.getDimension()===2?"ymax":"xmax"))}}}};var ac=function(cN){var cP=l;var cR=cP;if(cN.assignedCurves.length>=1){cR=cN.assignedCurves[0].color;var cO=true;for(var cQ=1;cQ<cN.assignedCurves.length&&cO;cQ++){cO=(cN.assignedCurves[cQ].color===cR)}cR=cO?cR:cP}return cR};var aQ=function(cN){var cO={dimension:cN.getDimension(),name:cN.getName(),unit:cN.getUnit(),position:cN.getPosition(),scale:cN.getScale(),assignedCurves:this.curves.filter(function(cQ){var cP=cN.getDimension()===2?cQ.yAxis.getId():cQ.xAxis.getId();return cP===cN.getId()}),color:cN.getColor(),tickNb:cN.getTickNb(),valueOfInterest:cN.getValueOfInterest(),precision:cN.getPrecision(),exponent:cN.getExponent()};cO.assignedCurves.forEach(function(cP){if(cN.getDimension()===2){cP.yAxisLayout=cO}else{cP.xAxisLayout=cO}});if(!cO.color){cO.color=this.curves.length>1?ac(cO):l}return cO}.bind(this);var cz,aF;var bj=0,ag=0,v=0,bD=0;cL.forEach(function(cO){var cN=aQ(cO);if(cN.position==="bottom"){cN.rank=ag++;cz=!cz?cN:cz}if(cN.position==="top"){cN.rank=bj++;aF=!aF?cN:aF}I(cO,cN);cN.scaleFunction=cN.scale==="log"?bY.scaleLog():bY.scaleLinear();cN.scaleFunction.domain([cN.min,cN.max]).range([aW,aW+M]);this.xAxisLayout.push(cN)}.bind(this));if(cz){cz.isMain=true}else{if(aF){aF.isMain=true}}var bn,aN;ay.forEach(function(cO){var cN=aQ(cO);if(cN.position==="left"){cN.rank=v++;bn=!bn?cN:bn}if(cN.position==="right"){cN.rank=bD++;aN=!aN?cN:aN}I(cO,cN);cN.scaleFunction=cN.scale==="log"?bY.scaleLog():bY.scaleLinear();cN.scaleFunction.domain([cN.min,cN.max]).range([aS+z,aS]);this.yAxisLayout.push(cN)}.bind(this));if(bn){bn.isMain=true}else{if(aN){aN.isMain=true}}if(aE){var cM=this.yAxisLayout[0].scaleFunction;var A=[];var cJ=[];var cj;var a9=function(cO,cN,cP){return function(cQ){cO[cP.name]=cQ[cN].y}};for(var bP=0;bP<b9.length;bP++){var cf=b9[bP];if(cf){var bk={groupId:cf.idNoMode,rootName:cf.rootName,loadCaseName:cf.loadCaseName};for(var bK=0;bK<this.curves.length;bK++){var bf=this.curves[bK];if(bf){bf.pieces.forEach(a9(bk,bP,bf));if(bP===0){cJ[bf.name]=bf.color}}}A.push(bk)}}var aw=bY.keys(A[0]).filter(function(cN){return(cN!=="groupId"&&cN!=="rootName"&&cN!=="loadCaseName")});A.forEach(function(cN){cN.values=aw.map(function(cO){return{name:cO,value:cN[cO],color:cJ[cO]}})});this.xAxisLayout[0].scaleFunction=bY.scaleBand().domain(A.map(function(cN){return cN.groupId})).range([aW,aW+M]).paddingInner(0.05);var be=this.xAxisLayout[0].scaleFunction;var ai=bY.scaleBand().domain(aw).range([0,be.bandwidth()]);var ad=bY.scaleLinear().domain([cw,a8]).range([0,z]);var cA=this.xychartViewer.selectAll(".bar").data(A).enter().append("g").attr("class","rect").attr("transform",function(cN){return"translate("+be(cN.groupId)+",0)"});cA.selectAll("rect").data(function(cN){return cN.values}).enter().append("rect").attr("width",ai.bandwidth()).attr("x",function(cN){return ai(cN.name)}).attr("y",function(cN){return cM(cN.value)}).attr("height",function(cN){return ad(cN.value)}).style("fill",function(cN){return cN.color});if(ao*A.length>M){var bZ=bY.line().x(function(cN){return be(cN.groupId)+ai(cN.name)}).y(function(cN){return cM(cN.value)});var cH=function(cN){return bZ(cN)};var b4=[];var bH;var a6=function(cN){b4.push({groupId:cN.groupId,name:bH.name,value:cN[bH.name]})};for(var bK=0;bK<this.curves.length;bK++){bH=this.curves[bK];b4=[];A.forEach(a6);this.xychartViewer.append("g").append("path").attr("class","spy-data-chart-line spy-data-chart-barchart-overviewline").datum(b4).attr("d",cH).style("stroke",bd.color)}}var F=function(cP){if(!this._playFlag){this._clearCurveLegendValues();for(var cN=0;cN<cP.values.length;cN++){var cO=cP.values[cN].value.toString()+o(this.curves[cN]);this._updateCurveLegend(cN,undefined,undefined,cO)}this._updateGroupBlockTooltip(cP.rootName,cP.loadCaseName,be(cP.groupId)+bb,cl)}}.bind(this);cA.on("mousemove",F);cA.on("mouseout",function(){if(!this._playFlag){this._restoreCurveLegend()}this._hideGroupBlockTooltip()}.bind(this))}this._currentXFormat=aH?bY.format("d"):bY.format(".3g");this._currentYFormat=b5?bY.format("d"):bY.format(".4e");this._percentFormat=function(cO){var cN=bY.format("."+cO.toString()+"f");return function(cP){return cN(cP)+" %"}};var al=function(cN){var cO=cN.name?cN.name:"";if(cN.unit&&cN.unit.length>0){if(cO.length>0){cO+=" ("+cN.unit+")"}else{cO=cN.unit}}return cO};var cc=aW+M/2;this.xAxisLayout.forEach(function(cR){var cP=cR.color;var cW=(cR.position==="top");var cY=cW?bY.axisTop:bY.axisBottom;var cQ=cR.rank;var cV=cW?aS-cQ*at:aS+z+cQ*at;var cO;var cZ;if(aE){cZ=function(c0){return s.buildGroupNameFromIds(c0)};var cN=-z;if(H.isCrossGroup&&b9.length>1){cZ="";cN=b9.length>=a1?0:cN}cO=cY().scale(cR.scaleFunction).tickSizeInner(cN).tickSizeOuter(0).tickFormat(cZ)}else{cZ=this._getXFormatter(bY,cR.precision,cR.exponent,aH);if(H.isCrossGroup&&b9.length>1){cZ=""}cO=cY().scale(cR.scaleFunction);if(cR.scale==="log"){var cS=cR.precision;var cX=isNaN(cS)?",.1s":",."+cS.toString()+"s";cO.ticks(!isNaN(cR.tickNb)?cR.tickNb:a1,cX).tickSizeInner(cR.isMain?-z:3).tickSizeOuter(0).tickPadding(b8)}else{cO.ticks(!isNaN(cR.tickNb)?cR.tickNb:a1).tickSizeInner(cR.isMain?-z:3).tickSizeOuter(0).tickPadding(b8).tickFormat(cZ)}}var cU=this._displayPositionsOnX?az:al(cR);cR.svg=this.xychartViewer.append("g").attr("class","spy-data-chart-axis spy-data-chart-axis-x").attr("isMain",cR.isMain===true).attr("transform","translate(0,"+String(cV)+")");cR.svg.call(cO);cR.svg.append("text").attr("class","spy-data-chart-axis-x-title").attr("x",cc).attr("y",cW?-t:t).text(cU);this._addAxisExponent(cR);if(!isNaN(cR.valueOfInterest)){var cT=cR.scaleFunction(cR.valueOfInterest);cR.svg.append("line").attr("class","spy-data-chart-voi-line").attr("x1",cT).attr("y1",0).attr("x2",cT).attr("y2",cW?z:-z).style("stroke",cP)}if(cP!=="#000"){cR.svg.selectAll("path").style("stroke",cP);cR.svg.selectAll("text").style("fill",cP);if(!cR.isMain){cR.svg.selectAll("line").style("stroke",cP)}}}.bind(this));var a3=aS+z/2;this.yAxisLayout.forEach(function(cQ){var cY=cQ.color;var cZ=(cQ.position==="right");var c1=cZ?bY.axisRight:bY.axisLeft;var cX=cQ.rank;var c0=cZ?aW+M+cX*af:aW-cX*af;var cO=c1().scale(cQ.scaleFunction);var cT=undefined;if(cQ.scale==="log"){var cU=cQ.precision;cT=isNaN(cU)?",.2e":",."+cU.toString()+"e"}if(!isNaN(cQ.tickNb)){cO.ticks(cQ.tickNb,cT)}var cW;if(cQ.scale==="percentage"){cW=this._percentFormat(0)}else{var cU=cQ.precision;if(isNaN(cU)){cU=a(cQ.min,cQ.max)}cW=this._getYFormatter(bY,cU,cQ.exponent,b5)}cO.tickSizeInner(cQ.isMain?-M:3).tickSizeOuter(0).tickPadding(ae);if(undefined===cT){cO.tickFormat(cW)}var cN=al(cQ);var cS=cZ?"90":"-90";var cV=cQ.name&&cQ.name.length>0;var cP=this.xychartViewer.append("g").attr("class","spy-data-chart-axis spy-data-chart-axis-y").attr("isMain",cQ.isMain===true).attr("transform","translate("+String(c0)+", 0)");cP.call(cO);if(cV){cP.append("text").attr("class","spy-data-chart-axis-y-title spy-data-chart-axis-y-title-withName").attr("transform","rotate("+cS+")").attr("x",cZ?a3:0-a3).attr("y",-aI).attr("dy",".71em").style("fill",cY).text(cN)}else{cP.append("text").attr("class","spy-data-chart-axis-y-title spy-data-chart-axis-y-title-noName").attr("x",-aI/2).attr("y",+6).attr("dy",".71em").style("fill",cY).text(cN)}cQ.svg=cP;this._addAxisExponent(cQ);if(!isNaN(cQ.valueOfInterest)){var cR=cQ.scaleFunction(cQ.valueOfInterest);cQ.svg.append("line").attr("class","spy-data-chart-voi-line").attr("x1",0).attr("y1",cR).attr("x2",cZ?-M:M).attr("y2",cR).style("stroke",cY)}if(cY!=="#000"){cQ.svg.selectAll("path").style("stroke",cY);cQ.svg.selectAll("text").style("fill",cY);if(!cQ.isMain){cQ.svg.selectAll("line").style("stroke",cY)}}}.bind(this));if(!aE){var bO=(H.isCrossGroup&&b9.length>1);var C=af;var bS=at;var aG=bO?0:bS;this.xychartViewer.append("rect").attr("class","spy-data-chart-backprobing").attr("x",aW-C).attr("y",aS-bS).attr("width",M+2*C).attr("height",z+bS+aG);var co=aP;var P=function(cN,cO){var cP=bh.curves[bh.currentCurveIndex].pieces[cO][cN];if(ca&&cP&&!isNaN(cP.globalFrameIdx)){m.publish({event:ca.getSPM().getContext()+"/SPY/FRAME/SELECT",data:cP.globalFrameIdx})}};var aK=function(cX,cR){var cN;var cO;cN=cX[cR];if(cN){var cW=H.oneCurvePerGroup?(cN.curveIdx===bh.currentCurveIndex):true;if(cW){var cV=p(bh.curves[cN.curveIdx]);var cT=o(bh.curves[cN.curveIdx]);var cU=undefined;var cQ=!isNaN(cN.position)&&az?"@ "+cN.position.toString()+az:undefined;if(!bh._displayPositionsOnX&&!H.isCrossGroup){cU=bh._currentXFormat(cN.x)+cV+", "}var cS;if(bh.curves[cN.curveIdx].yAxis.getScale()==="percentage"){cS=bh._percentFormat(2)(cN.y)}else{cS=bh._currentYFormat(cN.y)+cT}bh._updateCurveLegend(cN.curveIdx,cU,cQ,cS);cO=bh.curves[cN.curveIdx];bh._updateProbingCircle(cN.curveIdx,cO.xAxisLayout.scaleFunction(cN.x),cO.yAxisLayout.scaleFunction(cN.y))}}var cP;if(b9){cP=b9.find(function(cY){return cN&&cY.id===cN.group})}if(cP&&cO){bh._updateGroupBlockTooltip(cP.rootName,cP.loadCaseName,cO.xAxisLayout.scaleFunction(cN.x)+bb,cl)}};var cv=function(){if(!this._playFlag){this._restoreCurveLegend();this._keepProbingCircleVisibleFor(-1)}this._hideGroupBlockTooltip()}.bind(this);var b2,cF,L;var Y,B;var aX;if(co){var cb=bY.bisector(function(cN){return cN.x}).right;b2=function(){if(!bh._playFlag){var cN=bY.mouse(this);bh._clearCurveLegendValues();bh.curves.forEach(function(cP){var cO=cP.xAxisLayout.scaleFunction.invert(cN[0]);cP.pieces.forEach(function(cR){var cQ=cb(cR,cO);if(!isNaN(cQ)&&cQ>=0&&cQ<cR.length){aK(cR,cQ)}})})}};var bX=function(cO){if(!isNaN(bh.currentCurveIndex)){var cQ=bh.curves[bh.currentCurveIndex].xAxisLayout.scaleFunction.invert(cO[0]);var cP;var cN;for(var cS=0;cS<bh.curves[bh.currentCurveIndex].pieces.length;cS++){cP=cS;var cR=bh.curves[bh.currentCurveIndex].pieces[cS];cN=cb(cR,cQ);if(!isNaN(cN)&&cN>=0&&cN<cR.length){P(cN,cP);break}}}};cF=function(){if(!bY.event.defaultPrevented&&!bh._playFlag){var cN=bY.mouse(this);bX(cN)}};L=function(){if(!bh._playFlag){var cN=bY.mouse(this);bX(cN)}};aX=bY.drag().on("drag",L);this.xychartViewer.selectAll(".spy-data-chart-backprobing").on("mousemove",b2).on("mouseout",cv).on("click",cF).call(aX)}else{Y=function(cN){bh._clearCurveLegendValues();aK(bh.curves[cN.curveIdx].pieces[cN.pieceIdx],!isNaN(cN.globalFrameIdx)?cN.globalFrameIdx-1:cN.idx,cN.pieceIdx)};B=function(cN){P(!isNaN(cN.globalFrameIdx)?cN.globalFrameIdx-1:cN.idx,cN.pieceIdx)}}var aY=function(cN){return isNaN(cN.globalFrameIdx)?0:1};var W=function(cN){bh._highlightAxis([bh.curves[cN.curveIdx]])};var b6=function(cN){bh._highlightAxis()};var aC=function(cN){if(!bh._playFlag){W(cN);bh._clearCurveLegendValues();aK(bh.curves[cN.curveIdx].pieces[cN.pieceIdx],!isNaN(cN.globalFrameIdx)?cN.globalFrameIdx-1:cN.idx,cN.pieceIdx)}};this.curveNodeGroups=[];this.curvePathes=[];this.curves.forEach(function(cS){if(cS.clipped){var cR=cS.xAxisLayout.scaleFunction(cS.xAxisLayout.min);var c0=cS.yAxisLayout.scaleFunction(cS.yAxisLayout.max);var cP=cS.xAxisLayout.scaleFunction(cS.xAxisLayout.max);var cY=cS.yAxisLayout.scaleFunction(cS.yAxisLayout.min);this.xychartViewer.append("clipPath").attr("id",cS.id+"-clip").append("rect").attr("x",cR).attr("y",c0).attr("width",cP-cR).attr("height",cY-c0)}var cU=function(c3){return cS.xAxisLayout.scaleFunction(c3.x)};var cT=function(c3){return cS.yAxisLayout.scaleFunction(c3.y)};var c2=bY.line().x(cU).y(cT);var cQ=bY.area().x(function(c3){return cU(c3)}).y0(cS.yAxisLayout.scaleFunction(cS.yAxisLayout.min)).y1(function(c3){return cT(c3)});var cN=function(c3){return c2(c3)};var cO=function(c3){return cQ(c3)};var c1=[];var cX=[];this.curveNodeGroups.push(c1);this.curvePathes.push(cX);var cV=this._getMarkerColor(cS);var cW=this._getMarkerSize(cS);var cZ=this._getMarkerRadius(cS);cS.pieces.forEach(function(c5){if(cS.isFilled){var c3=this.xychartViewer.append("g").append("path").attr("class","spy-data-chart-fill").datum(c5).attr("d",cQ);c3.style("fill",cS.color);if(cS.clipped){c3.attr("clip-path","url(#"+cS.id+"-clip)")}c3.on("mousemove",b2);c3.on("click",cF);c3.call(aX)}var da=this.xychartViewer.append("g").attr("class","spy-data-chart-curve");var c9=da.append("path").attr("class","spy-data-chart-line").datum(c5).attr("d",cN).style("stroke",cS.color);if(cS.style.lineStyle){c9.style("stroke-dasharray",cS.style.lineStyle)}if(cS.style.lineWidth){c9.style("stroke-width",cS.style.lineWidth)}if(cS.clipped){c9.attr("clip-path","url(#"+cS.id+"-clip)")}var c6=da.selectAll("circle.node").data(c5).enter().append("g").attr("class","node");if(cW>0){var c8=c6;if(cS.style.markerPeriod>1){c8=c6.filter(function(dc,db){return db%cS.style.markerPeriod===0})}c8.append("svg:circle").attr("class","spy-data-chart-marker").attr("cx",cU).attr("cy",cT).attr("r",cZ).attr("fill",cV).attr("fill-opacity",aY);if(cS.clipped){c8.attr("clip-path","url(#"+cS.id+"-clip)")}}if(bR){var c4=c6.append("svg:circle").attr("cx",cU).attr("cy",cT).attr("r","15px").attr("fill",cS.color).attr("fill-opacity",0);c4.on("mouseover",aC);c4.on("mouseout",b6)}if(!co){var c7=c6.append("svg:circle").attr("cx",cU).attr("cy",cT).attr("r","10px").attr("fill",cS.color).attr("fill-opacity",0);c7.on("mouseover",Y);c7.on("mouseout",cv);c7.on("click",B);if(cS.clipped){c7.attr("clip-path","url(#"+cS.id+"-clip)")}}c1.push(c6);cX.push(c9)}.bind(this))}.bind(this));this.currentProbingCircle=[];for(var bK=0;bK<this.curves.length;bK++){var a0=this.xychartViewer.append("svg:circle").attr("class","spy-chart-mouse-circle").attr("r",(5+this._getMarkerSize(this.curves[bK])/2).toString()+"px").attr("stroke",this._getMarkerColor(this.curves[bK])).attr("visibility","hidden");if(this.curves[bK].clipped){a0.attr("clip-path","url(#"+this.curves[bK].id+"-clip)")}this.currentProbingCircle.push(a0)}}this.xychartViewer.append("g").attr("class","spy-data-chart-title").attr("transform","translate("+M+","+bQ+")").append("text").text(this._avoidNameDisplay?"":H.name);if(H.isCrossGroup&&b9.length>1){var J=[];var bB;var au=true;var O=true;var bs=0;var av=aW;for(var bP=0;bP<b9.length;bP++){bB=J[bP]={};bB.isNotInCurrentAnimation=b9[bP].isNotInCurrentAnimation;bB.id=b9[bP].id;bB.text=b9[bP].name;bB.rootName=b9[bP].rootName;bB.loadCaseName=b9[bP].loadCaseName;bB.groupSize=bI[b9[bP].id].count;bB.groupSpaceRequired=bB.text.length*j;if(aE){var bG=bP<b9.length-1?this.xAxisLayout[0].scaleFunction(b9[bP+1].id):(aW+M);bB.xGroupSeparator=bG;bB.groupSpaceAvailable=bG-av}else{bB.xGroupSeparator=this.xAxisLayout[0].scaleFunction(bs+bB.groupSize+0.5);bB.groupSpaceAvailable=bB.xGroupSeparator-av}bB.xGroupTitlePos=bB.xGroupSeparator-bB.groupSpaceAvailable/2;if(au&&(bB.groupSpaceRequired>bB.groupSpaceAvailable)){au=false}if(O&&bB.groupSpaceAvailable<ct){O=false}bs+=bB.groupSize;av=bB.xGroupSeparator}this._groupBlocks=[];var aR,bM;if(!au){this._groupBlockTooltip=this.xychartViewer.append("g").attr("class","spy-data-chart-group-block-tooltip").attr("defaultXPos",aW).attr("defaultYPos",aS+z+a5+b1+bc);this._groupBlockTooltipBg=this._groupBlockTooltip.append("rect").attr("x",0).attr("y",-14).attr("width",100).attr("height",18);this._groupBlockTooltipText=this._groupBlockTooltip.append("text").text("you should not see this").attr("transform","translate("+5+", 0)");this._groupBlockTooltip.attr("visibility","hidden");aR=function(){var cO=bY.event.currentTarget;var cN=bY.mouse(this);bh._updateGroupBlockTooltip(cO.getAttribute("rootName"),cO.getAttribute("loadCaseName"),cN[0]+bb,cl)};bM=function(){this._hideGroupBlockTooltip()}.bind(this)}var cp=aW;for(bP=0;bP<J.length;bP++){bB=J[bP];var cD=" spy-data-chart-group-block-in";if(bB.isNotInCurrentAnimation||!ca.isAnimated()){cD=" spy-data-chart-group-block-out"}else{if(U.group.id===bB.id||U.group.idNoMode===bB.id){cD=" spy-data-chart-group-block-current"}}var cE=this.xychartViewer.append("rect").attr("class","spy-data-chart-group-block"+cD).attr("id",bB.id).attr("rootName",bB.rootName).attr("loadCaseName",bB.loadCaseName).attr("x",cp).attr("y",aS+z+a5).attr("width",bB.groupSpaceAvailable).attr("height",b1);if(aR&&bM){cE.on("mousemove",aR);cE.on("mouseout",bM)}this._groupBlocks.push(cE);cp+=bB.groupSpaceAvailable;if(au){var D=String(aS+z+bQ+ab);var V="translate("+(bB.xGroupTitlePos-bB.groupSpaceRequired/2)+","+D+")";this.xychartViewer.append("g").attr("class","spy-data-chart-group").attr("transform",V).append("text").text(bB.text)}if(J.length>1&&bB.xGroupSeparator<=(aW+M)){if(!aE&&O){this.xychartViewer.append("line").attr("class","spy-data-chart-group-innerseparator").attr("x1",bB.xGroupSeparator).attr("y1",aS).attr("x2",bB.xGroupSeparator).attr("y2",aS+z).attr("stroke-dasharray","15,7")}this.xychartViewer.append("line").attr("class","spy-data-chart-group-outerseparator").attr("x1",bB.xGroupSeparator).attr("y1",aS+z).attr("x2",bB.xGroupSeparator).attr("y2",aS+z+b1+a5)}}}else{if(H.animation==="true"&&b9.length===1&&cu.length>1&&!cK){var bz=b9[0].name;if(bI[bz]){var E=String(aW+M/2-bz.length*j/2);var D=String(aS+z+bQ+ab);var bi="translate("+E+","+D+")";this.xychartViewer.append("g").attr("class","spy-data-chart-group").attr("transform",bi).append("text").text(bz)}}}var bF="spy-data-chart-value spy-data-chart-value-bold";var by=aS+z+bp;var cI=function(cO,cR){var cN=cO;var cQ=j*1.15;if(cO.length*cQ>=cR){var cS=3+cO.length-(cR/cQ);var cT=Math.floor((cO.length-cS)/2);var cP=Math.floor((cO.length+cS)/2);cN=cO.slice(0,cT)+"..."+cO.slice(cP,cO.length)}return cN};if(aE){var aM=function(cN){return cN.group===U.group.idNoMode};for(var bK=0;bK<this.curves.length;bK++){var aj=by+bK*y;var cC=this.curves[bK].pieces[0]?this.curves[bK].pieces[0].find(aM):undefined;var bU=o(this.curves[bK]);var bT=cC?cC.y.toString()+bU:"---";var b0=aO+bm;var bq=cI(this.curves[bK].name,b0);var u={color:this.curves[bK].color};var cx=0;if(this.curves[bK].name&&this.curves[bK].name.length>0){u.label={leftOffset:cx,topOffset:aj,text:bq,tooltip:this.curves[bK].name,css:"spy-data-chart-value",};cx+=b0}u.value={leftOffset:cx,topOffset:aj,text:bT,css:bF,};this._addCurveLegend(u)}}else{var a7=(H.animation==="true"&&ca.isAnimated());if(!isNaN(this.initFrame)&&!isNaN(this.currentCurveIndex)){bd=this.curves[this.currentCurveIndex]}if(isNaN(this.currentCurveIndex)){this.currentCurveIndex=this.curves.length-1}if(H.oneCurvePerGroup){this._keepCurrentCurve(this.currentCurveIndex)}var cm=function(cU,cP,cS,cR,cO){var cN=this._getMarkerColor(cU);var cT=!isNaN(cR)&&cR<cP.length&&cR<cS.length&&cR>=0;var cQ=this.xychartViewer.append("svg:circle").attr("class","spy-chart-current-point").attr("cx",cT?cU.xAxisLayout.scaleFunction(cP[cR]):0).attr("cy",cT?cU.yAxisLayout.scaleFunction(cS[cR]):0).attr("r","5px").attr("visibility",cT?"visible":"hidden").style("stroke",cN).style("fill",cN);if(cU.clipped){cQ.attr("clip-path","url(#"+cU.id+"-clip)")}this.currentPositionCircle.push(cQ)}.bind(this);var bA=function(){var cO=bY.event.currentTarget;if(cO){var cN=cO.getAttribute("curveIdx");if(!isNaN(cN)){bh._highlightAxis([bh.curves[cN]])}}};var Z=function(){bh._highlightAxis()};if(a7&&U){aB=this._findLocalFrame(this._findCurveForGroup(U.group),U.group,aB,this.curvesScope)}for(var bK=0;bK<this.curves.length;bK++){var bV=p(this.curves[bK]);var bU=o(this.curves[bK]);var cr=this.curves.length>1&&!H.oneCurvePerGroup;var ci=this.curves[bK].name&&this.curves[bK].name.length>0;var ba="";var G,bv,bT;if(a7){G=!isNaN(aB)&&!isNaN(this.curves[bK].domainPosition[aB])&&az;bv=G?"@ "+this.curves[bK].domainPosition[aB].toString()+az:undefined;ba=undefined;if(!this._displayPositionsOnX&&!H.isCrossGroup){ba=""+String(!isNaN(aB)?this._currentXFormat(this.curves[bK].domainX[aB]):"---")+bV+", "}if(this.curves[bK].yAxis.getScale()==="percentage"){bT=this._percentFormat(2)(this.curves[bK].domainY[aB])}else{bT=""+String(!isNaN(aB)?this._currentYFormat(this.curves[bK].domainY[aB]):"---")+bU}}var aj=by+(H.oneCurvePerGroup?0:bK)*y;var cx=0;var u={color:this.curves[bK].color,markerColor:this._getMarkerColor(this.curves[bK]),markerRadius:this._getMarkerRadius(this.curves[bK])};if(cr){u.sample={color:this.curves[bK].color,css:"spy-data-chart-legend-sample",leftOffset:cx,topOffset:ce+by+(bK-1)*y,width:X,height:y,lineWidth:this.curves[bK].style.lineWidth,lineStyle:this.curves[bK].style.lineStyle,curveIdx:bK,mouseover:bA,mouseout:Z};cx+=X+cB}if(ci){var b0=b7+(b7<=200&&ba===undefined?aO/2:0);var bq=cI(this.curves[bK].name,b0);u.label={leftOffset:cx,topOffset:aj,text:bq,tooltip:this.curves[bK].name,css:"spy-data-chart-value",curveIdx:bK,width:b0,height:y,mouseover:bA,mouseout:Z};cx+=b0}if(undefined!==ba){u.index={leftOffset:cx,topOffset:aj,text:ba,css:bF,};cx+=aO}u.value={leftOffset:cx,topOffset:aj,text:bT,css:bF,};cx+=bm;if(bv){u.position={leftOffset:cx,topOffset:aj,text:bv,css:bF,}}this._addCurveLegend(u);if(a7){cm(this.curves[bK],this.curves[bK].domainX,this.curves[bK].domainY,aB,this.curves[bK].color)}}if(H.oneCurvePerGroup){this._keepLegendVisibleFor(this.currentCurveIndex);this._keepPositionCircleVisibleFor(this.currentCurveIndex)}}var cd="hidden";if(aE){if(bo&&bo.hasModes&&!cK){cd=b9.find(function(cN){return cN.isNotInCurrentAnimation})?"hidden":"visible"}}else{if(cK){cd=b9.length>0?"visible":cd}}this.currentGroupLabel=this.xychartViewer.append("g").attr("class","spy-data-chart-value").attr("transform","translate("+an+","+(by+cg)+")").attr("visibility",cd).append("text").text(f.get("rootName"));this.currentGroupValue=this.xychartViewer.append("g").attr("class","spy-data-chart-value spy-data-chart-value-bold").attr("transform","translate("+bx+","+(by+cg)+")").attr("visibility",cd).append("text").style("fill",H.oneCurvePerGroup?bd.color:"black").text(S?S:"");if(ah){this.currentLoadCaseLabel=this.xychartViewer.append("g").attr("class","spy-data-chart-value").attr("transform","translate("+an+","+(by+cg+ak)+")").attr("visibility",cd).append("text").text(f.get("loadCaseName"));this.currentLoadCaseValue=this.xychartViewer.append("g").attr("class","spy-data-chart-value spy-data-chart-value-bold").attr("transform","translate("+bx+","+(by+cg+ak)+")").attr("visibility",cd).append("text").style("fill",H.oneCurvePerGroup?bd.color:"black").text(ah)}}}var aV=new Date;this.pcsData.totalBuildDuration=aV-bt},_buildFrame:function(u,t){if(!this.implementation||isNaN(u)){return}this._lastRequiredWidth=u;if(undefined!==t){this._visibility=t}if(this._visibility){this.buildXYChart(this,this.svgContainer,u)}},updateFrame:function(t,u){if(this.svgContainer){if(this._lastRequiredWidth!==t||!isNaN(u)){this._lastRequiredWidth=t;this.svgContainer.empty();if(!isNaN(u)){this.initFrame=u}if(this._visibility){this._buildFrame(t)}}}},buildFrame:function(v,u,z,x,w){this._avoidNameDisplay=w;this._lastRequiredWidth=v;var y=new g.Element("tr",{"class":"spy-infopane-content-table-chartrow"});var t=new g.Element("td",{"class":"spy-infopane-content-table-chartcell"}).inject(y);t.setAttributes({colSpan:"5"});this.svgContainer=new g.Element("div",{id:"xychartSvgContainer","class":"spy-chart-container"});this.svgContainer.inject(t);this._buildFrame(v,u);this.selectableWidget=this.svgContainer;if(z){z(y)}return y},syncFrameWithAnimation:function(y){var F=this.implementation.getMetadata();if(F.animation==="true"){var A=this._getDataDisplay();if(A){var t=A.getGroupForFrame(y);if(t&&this.curves){this.currentGroup=t.group;var H;if(this._groupBlocks){for(var G=0;G<this._groupBlocks.length;G++){if(!this._groupBlocks[G].classed("spy-data-chart-group-block-out")){H=this._groupBlocks[G].attr("id")===this.currentGroup.id||this._groupBlocks[G].attr("id")===this.currentGroup.idNoMode;this._groupBlocks[G].classed("spy-data-chart-group-block-current",H);this._groupBlocks[G].classed("spy-data-chart-group-block-in",!H)}}}if(!F.isBarChart){var x=function(O,J,I,L,K){if(J&&I&&L&&!isNaN(K)&&K<I.length&&K<L.length){var N=O.xAxisLayout.scaleFunction(I[K]);J.attr("cx",N);var M=O.yAxisLayout.scaleFunction(L[K]);J.attr("cy",M);J.attr("visibility","visible")}}.bind(this);var z;var w;var v;var E=t.group.unit?" "+t.group.unit:"";this._curveLegendBackup=undefined;var D=function(R,K,I,M,J){if(!isNaN(J)){if(F.oneCurvePerGroup){this._keepLegendVisibleFor(R);this._keepPositionCircleVisibleFor(R)}x(this.curves[R],this.currentPositionCircle[R],K,I,J);var Q=p(this.curves[R]);var O=o(this.curves[R]);var P=undefined;var L=M?(!isNaN(M[J])&&E?"@ "+M[J].toString()+E:""):undefined;if(!this._displayPositionsOnX&&!F.isCrossGroup){P=Q.length>0?""+this._currentXFormat(K[J])+Q+", ":undefined}var N;if(this.curves[R].yAxis.getScale()==="percentage"){N=this._percentFormat(2)(I[J])}else{N=""+this._currentYFormat(I[J])+O}this._updateCurveLegend(R,P,L,N)}}.bind(this);var C;if(this.curves.length===1&&!this.curves[0].rootName||F.oneCurvePerGroup){if(this.curves.length===1&&!this.curves[0].rootName){z=this.curves[0].domainX;v=this.curves[0].domainY;this.currentCurveIndex=0}else{if(F.oneCurvePerGroup){for(var u=0;u<this.curves.length&&!z;u++){if(this.curves[u].rootName===this.currentGroup.rootName&&this.curves[u].loadCaseName===this.currentGroup.loadCaseName){z=this.curves[u].domainX;v=this.curves[u].domainY;w=this.curves[u].domainPosition;this.currentCurveIndex=u}}}}C=this._findLocalFrame(this.implementation.getCurves()[this.currentCurveIndex],this.currentGroup,y,this.curvesScope);D(this.currentCurveIndex,z,v,w,C)}else{C=this._findLocalFrame(this._findCurveForGroup(this.currentGroup),this.currentGroup,y,this.curvesScope);for(var u=0;u<this.curves.length;u++){z=this.curves[u].domainX;v=this.curves[u].domainY;w=this.curves[u].domainPosition;D(u,z,v,w,C)}}if(F.oneCurvePerGroup){this._keepCurrentCurve(this.currentCurveIndex)}}else{var B=function(I){return(I.group===t.group.id||I.group===t.group.idNoMode)};this.curves.forEach(function(M){var K;var J=o(M);for(var L=0;L<M.pieces.length&&!K;L++){K=M.pieces[L].find(B);var I=K?K.y.toString()+J:"---";this._updateCurveLegend(L,undefined,undefined,I)}}.bind(this))}if(this.currentGroupValue){this.currentGroupValue.text(this.currentGroup.rootName)}if(this.currentLoadCaseValue&&this.currentGroup.loadCaseName){this.currentLoadCaseValue.text(this.currentGroup.loadCaseName)}}}}},initAnimation:function(t){if(this.implementation.animation==="true"){this._playFlag=true;var u=this._getDataDisplay();if(u){this.nbFrames=u.getTotalNumberOfFrames()}if(t){t()}}},animate:function(u,t){this._playFlag=t?!t.navigateMode:false;this.syncFrameWithAnimation(u);this.initFrame=u},onExpanderChange:function(t){this._visibility=t;if(t){this._buildFrame(this._lastRequiredWidth)}else{this.svgContainer.empty()}}});return g.namespace("DS/SPYExtUI/CATSimNavDataFrameViewXYChartUI",q)});