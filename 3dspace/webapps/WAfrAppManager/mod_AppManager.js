define("DS/WAfrAppManager/mod_AppManager",["UWA/Class/Promise","DS/WAfrUtils/Logger","i18n!DS/WAfrContainer/assets/nls/Notification"],function(d,c,e){var b=Object.create(null);var a=function(f){this._options=f};a.DEFAULT_COMPONENT_NAME="AFR_AppManager";a.prototype.setCurrentConfig=function(f){this._config=f};a.prototype.initialize=function(){this._executionContext=this.getExecutionContext();this._container=this._executionContext._container;var f=this._executionContext.getComponent(WAfrStandardComponentKey.ModelEvents);if(f){var g=this;["onWillLoadApp","onDidLoadApp","onDidFailToLoadApp"].forEach(function(h){f.subscribe({event:h},g[h].bind(g))})}return d.resolve()};a.prototype.onWillLoadApp=function(f){this._appId=f;this._sourceApp=this._executionContext.getSourceApp()};a.prototype.onDidLoadApp=function(){var h=this._executionContext.getSourceApp();var g=this._executionContext.getComponent(WAfrStandardComponentKey.NotificationManager);this._appId=h.getId();var f=this._sourceApp?this._sourceApp.getTitle()||this._container._view.getTitleHeader().appTitle||this._sourceApp.getId():null;var j=this._container._view.getValue("afrExecutionContexts");if(!j){throw new Error("The persisted contexts must not be undefined")}j[this._container._currentExecutionContext].currentappId=h.getId();this._container._view.setValue("afrCode",h.getIdCard().afrCode);this._container._view.setValue("afrExecutionContexts",j.slice());this._container._view.setValue("afrCurrentExecutionContextIdx",this._container._currentExecutionContext);this._container._view.setValue("afrAppId",h.getId());this._container._view.setValue("appId",h.getId());this._container._view.setBrand(h.options.brand);this._container.updateTitle({title:this._container.productTitle},h);this._container._view.setValue("title",h.getTitle()||this._container._view.getValue("title"));this._container._view.setValue("brand",h.getBrand()||this._container._view.getValue("brand"));var i=h.getTitle();var k={containerId:this._container.id,contextId:this._executionContext.getId(),targetApp:{options:h.options}};k.targetApp.options.appConfig.appId=h.getId();this._container.publish("onAppReady."+this._appId,k);var n="";var l={};if(f){n="WAfrTransitionSuccessful";l["0"]=i;l["1"]=f;var o=e.get(n+".message");var m=e.get(n+".title");if(l&&o){o=e.replace(o,l)}g&&g.notifySuccess({title:m,message:o})}this._appId=null;this._sourceApp=null};a.prototype.onDidFailToLoadApp=function(j){var m=this._executionContext.getComponent(WAfrStandardComponentKey.NotificationManager);var h=this._executionContext.getTargetApp()&&this._executionContext.getTargetApp().getTitle();var l={containerId:this._container.id,contextId:this._executionContext.getId()};var g="WAfrTransitionFailed";var f={0:h};if(h){f[1]=(j&&j.message)||"";var i=e.get(g+".message");i=e.replace(i,f);var k=e.get(g+".title");m&&m.notifyError({title:k,message:i})}if(j){c.severe("Error when loading configuration \n"+j.stack);l.error={name:j?j.name:"Error",message:j?j.message:""}}this._container.publish("onAppFail."+this._appId,l)};a.prototype.createExposedComponent=function(){return{launchApp:this.getExecutionContext()._container.launchApp.bind(this.getExecutionContext()._container)}};b.AppManager=a;return b});