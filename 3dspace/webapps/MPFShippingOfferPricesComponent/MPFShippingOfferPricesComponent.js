define("DS/MPFShippingOfferPricesComponent/ShippingPricesTableLine",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Text","DS/MPFOfferModel/ShippingOfferModel","DS/MPFServices/ObjectService","DS/MPFFiniteStateMachine/FiniteStateMachine","i18n!DS/MPFShippingOfferPricesComponent/assets/nls/ShippingOfferPricesComponent","css!DS/MPFShippingOfferPricesComponent/MPFShippingOfferPricesComponent"],function(f,a,d,j,g,e,k){var b={};var i={};var c=8;b.EDITION="edition";b.NO_EDITION="no_edition";b.DISABLED="disabled";i.WEIGHT=0;i.HOME_PRICE=1;i.EUROPE_PRICE=2;i.AFRICA_PRICE=3;i.ASIA_PRICE=4;i.MIDDLE_EAST_PRICE=5;i.NORTH_AMERICA_PRICE=6;i.SOUTH_AMERICA_PRICE=7;var h=a.extend({tagName:"tr",setup:function(l){g.requiredOfPrototype(l.shippingOffer,j,"options.shippingOffer must be a ShippingOfferModel");this._parent(l);this.shippingOffer=l.shippingOffer;this.rowIndex=l.rowIndex;this.locale=l.locale||"fr-FR";this.middleEastPriceElement=this._createMiddleEastPriceElement();this.africaPriceElement=this._createAfricaPriceElement();this.asiaPriceElement=this._createAsiaPriceElement();this.southAmericaPriceElement=this._createSouthAmericaPriceElement();this.northAmericaPriceElement=this._createNorthAmericaPriceElement();this.europePriceElement=this._createEuropePriceElement();this.homePriceElement=this._createHomePriceElement();this.kgWeightElement=this._createKgWeightElement()},render:function(){this.cells=[this.kgWeightElement,this.homePriceElement,this.europePriceElement,this.africaPriceElement,this.asiaPriceElement,this.middleEastPriceElement,this.northAmericaPriceElement,this.southAmericaPriceElement];this.container.setContent(this.cells);return this},_createKgWeightElement:function(){var l=f.createElement("td",{"class":"mpf-shipping-cell weight",text:this.shippingOffer.getWeightKG()});l.columnIndex=i.WEIGHT;return l},updateWeightElementUnitToKG:function(){this.kgWeightElement.setContent(this.shippingOffer.getWeightKG())},updateWeightElementUnitToLBS:function(){var l;var m;l=this.shippingOffer.getWeightKG()*2.20468;m=Math.round(l*2)/2;this.kgWeightElement.setContent(m)},_createHomePriceElement:function(){var m=this.shippingOffer.getHomePrice();var l=f.createElement("td",{"class":"mpf-shipping-cell home-price",html:[f.createElement("span",{"class":"fonticon fonticon-pencil"}),m<0?"":m.toFixed(2)]});l.columnIndex=i.HOME_PRICE;l.addEvent("click",this._setEditionMode.bind(this,l));l.stateMachine=this._createStateMachine();l.editionInput=new d({events:{onKeyDown:this._onKeyDownHandler.bind(this,l)}});l.editionInput.elements.input.onblur=this._onBlurHandler.bind(this,l,this.shippingOffer.getHomePrice,this.shippingOffer.setHomePrice);l.editionInput.elements.input.onkeyup=this._onKeyUp.bind(this,l);return l},_createMiddleEastPriceElement:function(){var l=this.shippingOffer.getMiddleEastPrice();var m=f.createElement("td",{"class":"mpf-shipping-cell middle-east-price",html:[f.createElement("span",{"class":"fonticon fonticon-pencil"}),l<0?"":l.toFixed(2)]});m.columnIndex=i.MIDDLE_EAST_PRICE;m.addEvent("click",this._setEditionMode.bind(this,m));m.stateMachine=this._createStateMachine();m.editionInput=new d({events:{onKeyDown:this._onKeyDownHandler.bind(this,m)}});m.editionInput.elements.input.onblur=this._onBlurHandler.bind(this,m,this.shippingOffer.getMiddleEastPrice,this.shippingOffer.setMiddleEastPrice);m.editionInput.elements.input.onkeyup=this._onKeyUp.bind(this,m);return m},_createEuropePriceElement:function(){var l=this.shippingOffer.getEuropePrice();var m=f.createElement("td",{"class":"mpf-shipping-cell europe-price",html:[f.createElement("span",{"class":"fonticon fonticon-pencil"}),l<0?"":l.toFixed(2)]});m.columnIndex=i.EUROPE_PRICE;m.addEvent("click",this._setEditionMode.bind(this,m));m.stateMachine=this._createStateMachine();m.editionInput=new d({events:{onKeyDown:this._onKeyDownHandler.bind(this,m)}});m.editionInput.elements.input.onblur=this._onBlurHandler.bind(this,m,this.shippingOffer.getEuropePrice,this.shippingOffer.setEuropePrice);m.editionInput.elements.input.onkeyup=this._onKeyUp.bind(this,m);return m},_createNorthAmericaPriceElement:function(){var l=this.shippingOffer.getNorthAmericaPrice();var m=f.createElement("td",{"class":"mpf-shipping-cell north-america-price",html:[f.createElement("span",{"class":"fonticon fonticon-pencil"}),l<0?"":l.toFixed(2)]});m.columnIndex=i.NORTH_AMERICA_PRICE;m.addEvent("click",this._setEditionMode.bind(this,m));m.stateMachine=this._createStateMachine();m.editionInput=new d({events:{onKeyDown:this._onKeyDownHandler.bind(this,m)}});m.editionInput.elements.input.onblur=this._onBlurHandler.bind(this,m,this.shippingOffer.getNorthAmericaPrice,this.shippingOffer.setNorthAmericaPrice);m.editionInput.elements.input.onkeyup=this._onKeyUp.bind(this,m);return m},_createSouthAmericaPriceElement:function(){var m=this.shippingOffer.getSouthAmericaPrice();var l=f.createElement("td",{"class":"mpf-shipping-cell south-america-price",html:[f.createElement("span",{"class":"fonticon fonticon-pencil"}),m<0?"":m.toFixed(2)]});l.columnIndex=i.SOUTH_AMERICA_PRICE;l.addEvent("click",this._setEditionMode.bind(this,l));l.stateMachine=this._createStateMachine();l.editionInput=new d({events:{onKeyDown:this._onKeyDownHandler.bind(this,l)}});l.editionInput.elements.input.onblur=this._onBlurHandler.bind(this,l,this.shippingOffer.getSouthAmericaPrice,this.shippingOffer.setSouthAmericaPrice);l.editionInput.elements.input.onkeyup=this._onKeyUp.bind(this,l);return l},_createAsiaPriceElement:function(){var m=this.shippingOffer.getAsiaPrice();var l=f.createElement("td",{"class":"mpf-shipping-cell asia-price",html:[f.createElement("span",{"class":"fonticon fonticon-pencil"}),m<0?"":m.toFixed(2)]});l.columnIndex=i.ASIA_PRICE;l.addEvent("click",this._setEditionMode.bind(this,l));l.stateMachine=this._createStateMachine();l.editionInput=new d({events:{onKeyDown:this._onKeyDownHandler.bind(this,l)}});l.editionInput.elements.input.onblur=this._onBlurHandler.bind(this,l,this.shippingOffer.getAsiaPrice,this.shippingOffer.setAsiaPrice);l.editionInput.elements.input.onkeyup=this._onKeyUp.bind(this,l);return l},_createAfricaPriceElement:function(){var l=this.shippingOffer.getAfricaPrice();var m=f.createElement("td",{"class":"mpf-shipping-cell africa-price",html:[f.createElement("span",{"class":"fonticon fonticon-pencil"}),l<0?"":l.toFixed(2)]});m.columnIndex=i.AFRICA_PRICE;m.addEvent("click",this._setEditionMode.bind(this,m));m.stateMachine=this._createStateMachine();m.editionInput=new d({events:{onKeyDown:this._onKeyDownHandler.bind(this,m)}});m.editionInput.elements.input.onblur=this._onBlurHandler.bind(this,m,this.shippingOffer.getAfricaPrice,this.shippingOffer.setAfricaPrice);m.editionInput.elements.input.onkeyup=this._onKeyUp.bind(this,m);return m},_saveCell:function(){var l=this;var m=this.shippingOffer.changedAttributes();if(m!==false){this.shippingOffer.savePromise(m,{patch:"true"})["catch"](function(){l.dispatchEvent("priceNotSaved")})}},enableElement:function(l){l.removeClassName("disabled");l.stateMachine.changeState(b.NO_EDITION)},disableElement:function(l){l.addClassName("disabled");l.stateMachine.changeState(b.DISABLED)},_createStateMachine:function(){return new e({state:b.NO_EDITION,states:[b.EDITION,b.NO_EDITION,b.DISABLED],transitions:[{from:b.EDITION,to:b.NO_EDITION},{from:b.NO_EDITION,to:b.EDITION},{from:b.DISABLED,to:b.NO_EDITION},{from:b.NO_EDITION,to:b.DISABLED}]})},_setEditionMode:function(l){var m;if(l.stateMachine.getState()===b.NO_EDITION){l.stateMachine.changeState(b.EDITION);l.addClassName("edition");m=l.getText();if(this._isNumber(m)){l.editionInput.setValue(m)}else{l.editionInput.setValue("")}l.setContent(l.editionInput);l.editionInput.setFocus()}},_onBlurHandler:function(m,l,o){var n;if(m.stateMachine.getState()===b.EDITION){m.stateMachine.changeState(b.NO_EDITION);m.removeClassName("edition");n=m.editionInput.getValue();if(n===""||!this._isNumber(n)){o.call(this.shippingOffer,-42);m.setContent([f.createElement("span",{"class":"fonticon fonticon-pencil"}),""])}else{n=this._restrictInputValue(n);m.setContent([f.createElement("span",{"class":"fonticon fonticon-pencil"}),n.toFixed(2)]);o.call(this.shippingOffer,n)}this._saveCell()}},_onKeyDownHandler:function(l,m){var n={};if(m.key==="Enter"||m.key==="ArrowDown"){l.editionInput.setFocus(false);n.rowIndex=this.rowIndex+1;n.columnIndex=l.columnIndex;this.dispatchEvent("changeCell",n)}else{if(m.key==="Tab"||m.key==="ArrowRight"){m.preventDefault();l.editionInput.setFocus(false);if(l.columnIndex+1===c){n.columnIndex=i.HOME_PRICE;n.rowIndex=this.rowIndex+1}else{n.rowIndex=this.rowIndex;n.columnIndex=l.columnIndex+1}this.dispatchEvent("changeCell",n)}else{if(m.key==="ArrowLeft"){l.editionInput.setFocus(false);if(l.columnIndex-1===i.WEIGHT){n.columnIndex=i.SOUTH_AMERICA_PRICE;n.rowIndex=this.rowIndex-1}else{n.rowIndex=this.rowIndex;n.columnIndex=l.columnIndex-1}n.direction="left";this.dispatchEvent("changeCell",n)}else{if(m.key==="ArrowUp"){l.editionInput.setFocus(false);n.rowIndex=this.rowIndex-1;n.columnIndex=l.columnIndex;this.dispatchEvent("changeCell",n)}}}}},_onKeyUp:function(n){var l;var m;l=n.editionInput.getValue();m=n.editionInput.elements.input;if(!this._isNumber(l)&&!m.hasClassName("error-validation")){m.addClassName("error-validation")}else{if(this._isNumber(l)&&m.hasClassName("error-validation")){m.removeClassName("error-validation")}}},focusCell:function(m,n){var l;if(m>0&&m<c){l=this.cells[m];if(l.stateMachine.getState()===b.NO_EDITION){this._setEditionMode(l)}else{if(l.stateMachine.getState()===b.DISABLED){if(n==="left"){if(m-1>0){this.focusCell(m-1,"left")}else{this.dispatchEvent("changeCell",{columnIndex:i.SOUTH_AMERICA_PRICE,rowIndex:this.rowIndex-1})}}else{if(m+1<c){this.focusCell(m+1)}else{this.dispatchEvent("changeCell",{columnIndex:i.HOME_PRICE,rowIndex:this.rowIndex+1})}}}}}},_isNumber:function(l){return !isNaN(l)},_restrictInputValue:function(m){var n;var l;n=Number(m);if(n<0){l=0}else{if(n>999.99){l=999.99}else{l=Number(n.toFixed(2))}}return l}});h.ElementStates=Object.freeze(b);return h});define("DS/MPFShippingOfferPricesComponent/ShippingPricesTable",["UWA/Core","UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/MPFOfferModel/ShippingOfferCollection","DS/MPFServices/ObjectService","DS/MPFShippingOfferPricesComponent/ShippingPricesTableLine","i18n!DS/MPFShippingOfferPricesComponent/assets/nls/ShippingOfferPricesComponent","css!DS/MPFShippingOfferPricesComponent/MPFShippingOfferPricesComponent"],function(c,b,a,e,d,k,f,h,j){var g={};g.HOME="domestic";g.EUROPE="europe";g.AFRICA="africa";g.ASIA="asia";g.MIDDLE_EAST="middleEast";g.NORTH_AMERICA="northAmerica";g.SOUTH_AMERICA="southAmerica";var i=b.extend({className:"mpf-shipping-prices-table table",tagName:"table",setup:function(l){f.requiredOfPrototype(l.shippingOffers,k,"options.shippingOffers must be a ShippingOfferCollection");this._parent(l);this.shippingOffers=l.shippingOffers;this.locale=l.locale||"fr-FR";this.kgOptionButton=this._createKgOptionButton();this.lbsOptionButton=this._createLbsOptionButton();this.header=this._createHeader();this.table=this._createTable()},render:function(){this.container.setContent([this.header,this.table]);return this},_createKgOptionButton:function(){var l=this;return new d({value:j.get("kg"),active:true,events:{onClick:function(){if(!this.isActive()){this.setActive();this.setFocus(false);l.lbsOptionButton.setActive(false);l._changeWeightUnit("kg")}}}})},_createLbsOptionButton:function(){var l=this;return new d({value:j.get("lbs"),events:{onClick:function(){if(!this.isActive()){this.setActive();this.setFocus(false);l.kgOptionButton.setActive(false);l._changeWeightUnit("lbs")}}}})},_changeWeightUnit:function(l){if(l==="kg"){this.tableLines.forEach(function(m){m.updateWeightElementUnitToKG()})}if(l==="lbs"){this.tableLines.forEach(function(m){m.updateWeightElementUnitToLBS()})}},_enableAreaPricing:function(l){if(l===g.HOME){this.tableLines.forEach(function(m){m.enableElement(m.homePriceElement)})}if(l===g.EUROPE){this.tableLines.forEach(function(m){m.enableElement(m.europePriceElement)})}if(l===g.AFRICA){this.tableLines.forEach(function(m){m.enableElement(m.africaPriceElement)})}if(l===g.ASIA){this.tableLines.forEach(function(m){m.enableElement(m.asiaPriceElement)})}if(l===g.MIDDLE_EAST){this.tableLines.forEach(function(m){m.enableElement(m.middleEastPriceElement)})}if(l===g.NORTH_AMERICA){this.tableLines.forEach(function(m){m.enableElement(m.northAmericaPriceElement)})}if(l===g.SOUTH_AMERICA){this.tableLines.forEach(function(m){m.enableElement(m.southAmericaPriceElement)})}},_disableAreaPricing:function(l){if(l===g.HOME){this.tableLines.forEach(function(m){m.disableElement(m.homePriceElement)})}if(l===g.EUROPE){this.tableLines.forEach(function(m){m.disableElement(m.europePriceElement)})}if(l===g.AFRICA){this.tableLines.forEach(function(m){m.disableElement(m.africaPriceElement)})}if(l===g.ASIA){this.tableLines.forEach(function(m){m.disableElement(m.asiaPriceElement)})}if(l===g.MIDDLE_EAST){this.tableLines.forEach(function(m){m.disableElement(m.middleEastPriceElement)})}if(l===g.NORTH_AMERICA){this.tableLines.forEach(function(m){m.disableElement(m.northAmericaPriceElement)})}if(l===g.SOUTH_AMERICA){this.tableLines.forEach(function(m){m.disableElement(m.southAmericaPriceElement)})}},_createTable:function(){var l;this.tableLines=this.shippingOffers.map(function(o,m){var n;n=new h({locale:this.locale,shippingOffer:o,rowIndex:m});this.listenTo(n,"changeCell",this._focusNewCell.bind(this));this.listenTo(n,"priceNotSaved",this._displayErrorAlert.bind(this));return n.render()},this);l=c.createElement("tbody",{html:this.tableLines});return l},_focusNewCell:function(l){if(l.rowIndex<this.tableLines.length&&l.rowIndex>=0){this.tableLines[l.rowIndex].focusCell(l.columnIndex,l.direction)}},_displayErrorAlert:function(l){new a({visible:true,messages:[{className:"error",message:j.get("errorOccured")}]}).inject(this.container.getParent(),"top")},_createHeader:function(){return c.createElement("thead",{html:c.createElement("tr",{html:[this._createWeightTile(),this._createTile("home-price",g.HOME),this._createTile("europe-price",g.EUROPE),this._createTile("africa-price",g.AFRICA),this._createTile("asia-price",g.ASIA),this._createTile("middle-east-price",g.MIDDLE_EAST),this._createTile("north-america-price",g.NORTH_AMERICA),this._createTile("south-america-price",g.SOUTH_AMERICA)]})})},_createTile:function(l,m){return c.createElement("th",{"class":l+" title",html:c.createElement("div",{"class":"th-container",html:[this._createLabel(m)]})})},_createWeightTile:function(){return c.createElement("th",{"class":"weight title",html:[j.get("upTo"),c.createElement("div",{html:[this.kgOptionButton,this.lbsOptionButton]})]})},_createSwitchInput:function(m){var l=this;return new e({type:"switch",value:"",checked:true,events:{onChange:function(){if(this.isChecked()){l._enableAreaPricing(m)}else{l._disableAreaPricing(m)}}}})},_createLabel:function(l){return c.createElement("div",{"class":"mpf-toggle-label",html:[j.get(l),"<br>",c.createElement("span",{text:"("+this.shippingOffers.first().getCurrency()+")"})]})},destroy:function(){this.shippingOffers=null;this.locale=null;this.kgOptionButton=null;this.lbsOptionButton=null;this.header=null;this.table=null;this.tableLines=null;this._parent();this.container=null}});i.Areas=Object.freeze(g);return i});define("DS/MPFShippingOfferPricesComponent/ShippingPricesTabsComponent",["UWA/Core","UWA/Class/View","DS/MPFOfferModel/ShippingOfferCollection","DS/MPFServices/ObjectService","DS/MPFShippingOfferPricesComponent/ShippingPricesTable","i18n!DS/MPFShippingOfferPricesComponent/assets/nls/ShippingOfferPricesComponent","css!DS/MPFShippingOfferPricesComponent/MPFShippingOfferPricesComponent"],function(g,f,a,b,c,d){var e=f.extend({className:"mpf-shipping-prices-tabs table-responsive",setup:function(h){b.requiredOfPrototype(h.standardShippingOffers,a,"options.standardShippingOffers must be a ShippingOfferCollection");this._parent(h);this.locale=h.locale||"fr-FR";this.standardShippingOffers=h.standardShippingOffers;this.shippingMatrix=this._createShippingMatrix()},render:function(){this.container.setContent(this.shippingMatrix.render());return this},_createShippingMatrix:function(){return new c({locale:this.locale,shippingOffers:this.standardShippingOffers})}});return e});