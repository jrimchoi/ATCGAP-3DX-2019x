define("DS/MPFStripeComponent/CardInputs",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","DS/UIKIT/Input/Text","i18n!DS/MPFStripeComponent/assets/nls/MPFStripeComponent"],function(f,b,g,h,d,j,i,c,e){var a=b.extend({className:"mpf-stripe-payment-form",setup:function(k){k||(k={});h.requiredOfPrototype(k.cart,d,"options.cart must be a CartModel");this.cart=k.cart;this.creditCardTokenMultiUse=k.creditCardTokenMultiUse;this.stripe=Stripe(k.apiKey);this.elements=this.stripe.elements();this.cardNameHolderInput=this._createCardNameHolderInput();this.cardNumberInput=this._createCardNumberInput();this.cardExpiryDateInput=this._createCardExpiryDateInput();this.cardVerificationCodeInput=this._createCardVerificationCodeInput();this.cardParams={}},render:function(){this.container.setContent([this.cardNameHolderInput,this._createCardInputsContainers()]);return this},mount:function(){this.cardNumberInput.mount("#mpf-stripe-card-number-element");this.cardExpiryDateInput.mount("#mpf-stripe-card-expiration-element");this.cardVerificationCodeInput.mount("#mpf-stripe-card-cvc-element")},proceedToPayment:function(){var l=this;var m;var o;var n={};var k;n.name=this.cardNameHolderInput.getElement("input").value;return this.stripe.createToken(this.cardNumberInput,n).then(function(p){if(p.token){k={currentState:d.STATUS.pendingPayment,payment_token:p.token.id};if(l.creditCardTokenMultiUse==="1"){k.CreditCardTokenMultiUse="1"}m=new i(i.Operations.modify,"/",k);o=new j();o.add(m);return l.cart.megaPatch(o)}else{return g.reject("errorStripeToken")}})},_createCardNameHolderInput:function(){var k=this;return f.createElement("div",{"class":"mpf-stripe-payment-card-holder",html:f.createElement("label",{html:[f.createElement("span",{text:e.get("cardHolder")}),new c({placeholder:e.get("cardHolder"),value:this.cart.get("OwnerData").FirstName+" "+this.cart.get("OwnerData").LastName,events:{onChange:function(){if(this.getValue().length===0){this.setClassName("invalid");k.container.getElement("#mpf-stripe-card-holder-errors").setText(e.get("cardHolderEmpty"));k.dispatchEvent("invalidField")}else{k.dispatchEvent("validField")}},onKeyDown:function(){this.setClassName("");k.container.getElement("#mpf-stripe-card-holder-errors").setText("")}}}),f.createElement("div",{id:"mpf-stripe-card-holder-errors"})]})})},_createCardNumberInput:function(){var l=this;var k=this.elements.create("cardNumber",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});k.addEventListener("change",function(m){if(m.error){l.container.getElement("#mpf-stripe-card-number-errors").setContent(m.error.message)}else{l.container.getElement("#mpf-stripe-card-number-errors").setContent("")}});return k},_createCardExpiryDateInput:function(){var l=this;var k=this.elements.create("cardExpiry",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});k.addEventListener("change",function(m){if(m.error){l.container.getElement("#mpf-stripe-card-expiration-errors").setContent(m.error.message)}else{l.container.getElement("#mpf-stripe-card-expiration-errors").setContent("")}});return k},_createCardVerificationCodeInput:function(){var k=this;var l=this.elements.create("cardCvc",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});l.addEventListener("change",function(m){if(m.error){k.container.getElement("#mpf-stripe-card-cvc-errors").setContent(m.error.message)}else{k.container.getElement("#mpf-stripe-card-cvc-errors").setContent("")}});return l},_createCardInputsContainers:function(){var k;var m;var l;k=f.createElement("div",{"class":"mpf-stripe-card-number-element-container",html:f.createElement("label",{html:[f.createElement("span",{text:e.get("cardNumber")}),f.createElement("div",{id:"mpf-stripe-card-number-element"}),f.createElement("div",{id:"mpf-stripe-card-number-errors"})]})});m=f.createElement("div",{"class":"mpf-stripe-card-expiration-element-container",html:f.createElement("label",{html:[f.createElement("span",{text:e.get("expiryDate")}),f.createElement("div",{id:"mpf-stripe-card-expiration-element"}),f.createElement("div",{id:"mpf-stripe-card-expiration-errors"})]})});l=f.createElement("div",{"class":"mpf-stripe-card-cvc-element-container",html:f.createElement("label",{html:[f.createElement("span",{text:"CVC"}),f.createElement("div",{id:"mpf-stripe-card-cvc-element"}),f.createElement("div",{id:"mpf-stripe-card-cvc-errors"})]})});return[k,m,l]}});return a});define("DS/MPFStripeComponent/CartInfoSection",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","i18n!DS/MPFStripeComponent/assets/nls/MPFStripeComponent"],function(f,e,b,c,a){var d=e.extend({className:"mpf-stripe-cart-section",setup:function(g){g||(g={});b.requiredOfPrototype(g.cart,c,"options.cart must be a CartModel");this.cart=g.cart;this.locale=g.locale||"fr-FR";this.merchantLine=this._createMerchantLine();this.orderNumberLine=this._createOrderNumberLine();this.amountLine=this._createOrderAmountLine()},render:function(){this.container.setContent([this.merchantLine,this.orderNumberLine,this.amountLine]);return this},_createMerchantLine:function(){return f.createElement("div",{html:[f.createElement("span",{"class":"mpf-stripe-label",text:a.get("merchant")}),f.createElement("span",{"class":"mpf-stripe-value",text:"3DMarketplace"})]})},_createOrderNumberLine:function(){return f.createElement("div",{html:[f.createElement("span",{"class":"mpf-stripe-label",text:a.get("order")}),f.createElement("span",{"class":"mpf-stripe-value",text:this.cart.getName()})]})},_createOrderAmountLine:function(){return f.createElement("div",{html:[f.createElement("span",{"class":"mpf-stripe-label",text:a.get("amount")}),f.createElement("span",{"class":"mpf-stripe-value",text:this.cart.getCurrency()+" "+this.cart.get("GrossAmountTotal").toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency(),currencyDisplay:"code"}).replace(this.cart.getCurrency(),"").trim()})]})}});return d});define("DS/MPFStripeComponent/StripePaymentPage",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFCartModel/CartModel","DS/MPFServices/ObjectService","DS/MPFStripeComponent/CartInfoSection","DS/MPFStripeComponent/CardInputs","i18n!DS/MPFStripeComponent/assets/nls/MPFStripeComponent"],function(g,b,h,e,c,i,j,a,f){var d=b.extend({className:"mpf-stripe-payment-page",setup:function(k){k||(k={});i.requiredOfPrototype(k.cart,c,"options.cart must be a CartModel");this.cart=k.cart;this.apiKey=k.apiKey;this.creditCardTokenMultiUse=k.creditCardTokenMultiUse;this.locale=k.locale||"fr-FR";this.cartInfoSection=this._createCartInfoSection();this.cardInputs=this._createCardInputs();this.paymentButton=this._createPaymentButton();this.listenTo(this.cardInputs,"invalidField",this.paymentButton.disable.bind(this.paymentButton));this.listenTo(this.cardInputs,"validField",this.paymentButton.enable.bind(this.paymentButton))},render:function(){var k=g.createElement("div",{"class":"mpf-stripe-payment-body",html:[this._createLogoContainer(),this.cartInfoSection.render(),this.cardInputs.render(),this.paymentButton]});this.container.setContent(k);return this},mountCardInputs:function(){this.cardInputs.mount()},_createCartInfoSection:function(){return new j({locale:this.locale,cart:this.cart})},_createCardInputs:function(){return new a({cart:this.cart,apiKey:this.apiKey,creditCardTokenMultiUse:this.creditCardTokenMultiUse})},_createPaymentButton:function(k){return new h({className:"primary",value:f.get("pay"),events:{onClick:this._proceedToPayment.bind(this)}})},_proceedToPayment:function(){var k=this;e.mask(this.container);this.cardInputs.proceedToPayment().then(function(){var l;e.unmask(k.container);l=window.location.origin+"/resources/static/paymentConfirmation.html?state=completed";window.location.href=l})["catch"](function(m){e.unmask(k.container);if(m!=="errorStripeToken"){var l;l=window.location.origin+"/resources/static/paymentConfirmation.html?state=declined";window.location.href=l}})},_createLogoContainer:function(){return g.createElement("div",{"class":"mpf-stripe-form-ds-logo"})}});return d});