define("DS/MPFModel/ModelValidator",["UWA/Core","UWA/Class","UWA/Class/Model","DS/MPFServices/ObjectService","DS/MPFError/BadArgumentError","DS/MPFConstraintModel/ConstraintModel","DS/MPFDataProxy/NoDataProxy"],function(g,b,f,d,a,c,e){var h;h=b.extend({init:function(i){d.requiredOfPrototype(i.model,f,"options.model must be a UWA/Model");this.model=i.model;this.keyAttribute=i.keyAttribute;var j=i.model.constraints&&i.model.constraints.size;if(j&&i.model.constraints.size()>0){if(this.keyAttribute||this.model.constraints.first().idAttribute){this.constraints=this.model.constraints}else{console.warn("No idAttribute for model found and no keyAttribute defined - constraints cannot be used!")}}this.validations={};if(i.validations){this._registerValidations(i.validations)}},validate:function(n){if(this.constraints){this._updateConstraints(n)}var r=[];if(g.is(n,"string")){this._validateAttribute(n,this.model.get(n),r)}else{if(Array.isArray(n)){for(var p=0;p<n.length;p++){if(g.is(n[p],"string")){this._validateAttribute(n[p],this.model.get(n[p]),r)}}}else{if(g.is(n,"object")){var q=Object.keys(n);for(var o=0;o<q.length;o++){this._validateAttribute(q[o],n[q[o]],r)}}else{var l=Object.keys(this.validations);for(var m=0;m<l.length;++m){this._validateAttribute(l[m],this.model.get(l[m]),r)}}}}if(r.length>0){return r}},_validateAttribute:function(k,o,p){var n=this.validations[k];if(Array.isArray(n)){for(var l=0;l<n.length;l++){var j=n[l];if(this._checkConditions(j.getConditions())){var m=g.is(o,"string")&&o.trim()==="";if(j.isRequired()&&(!g.is(o)||(j.isString()&&m))){p.push(this._getValidationError("required",j))}else{if(g.is(o)&&!m&&(!j.isCorrectType(o)||!j.patternIsFoundIn(o))){p.push(this._getValidationError("invalid",j))}}}}}},_checkConditions:function(l){for(var j=0;j<l.length;j++){var m=l[j];var k=Array.isArray(m)&&m.length>=2;if(k){if(m.length>2&&m[2]===true){if(this.model.get(m[0])===m[1]){return false}}else{if(this.model.get(m[0])!==m[1]){return false}}}}return true},_getValidationError:function(k,m){var i={field:m.getAttribute()};if(k==="required"){var l=m.getRequiredError();if(g.is(l)){i.message=l}else{console.warn('No "required" error message defined for attribute "'+i.field+'"!');i.message=i.field+" is required"}}else{if(k==="invalid"){var j=m.getInvalidError();if(g.is(j)){i.message=j}else{console.warn('No "invalid" error message defined for attribute "'+i.field+'"!');i.message=i.field+" is invalid"}}}return i},_updateConstraints:function(m){var n;var r=this.keyAttribute||this.constraints.first().idAttribute;if(g.is(m,"object")&&m[r]){n=this.constraints.get(m[r])?this.constraints.get(m[r]):this.constraints.get("DEFAULT")}else{if(this.model.has(r)){n=this.constraints.get(this.model.get(r))?this.constraints.get(this.model.get(r)):this.constraints.get("DEFAULT")}else{n=this.constraints.get("DEFAULT");console.warn("Model does not have the key attribute corresponding to the idAttribute defined in the constraints -> default used for validation")}}this._deleteReplaceableConstraints();if(g.is(n,"object")){var k=n.keys();var q=true;for(var o=0;o<k.length;o++){var s=k[o];var p=n.get(s);if(Array.isArray(p)){for(var l=0;l<p.length;l++){this._addConstraintModel(p[l],q)}}else{this._addConstraintModel(p,q)}}}},_deleteReplaceableConstraints:function(){var n=Object.keys(this.validations);for(var m=0;m<n.length;m++){var l=n[m];var o=this.validations[l];if(Array.isArray(o)&&o.length>0){for(var k=o.length-1;k>=0;k--){if(o[k].isReplaceable){o.splice(k,1)}}}}},_addConstraintModel:function(k,j){if(c.prototype.isPrototypeOf(k)){k.isReplaceable=j===true;var i=k.getAttribute();if(Array.isArray(this.validations[i])){this.validations[i].push(k)}else{this.validations[i]=[k]}}},_registerValidations:function(k){for(var j=0;j<k.length;j++){var l=k[j];if(g.is(l[c.Fields.ATTRIBUTE])){var m=new c(l,{dataProxy:e.getInstance()});this._addConstraintModel(m)}}}});return h});define("DS/MPFModel/CollectionFetchOptions",[],function(){var a=Object.freeze({START:"start",SIZE:"size",SEARCH:"search"});return a});define("DS/MPFModel/ModelChangeTracker",["UWA/Core","UWA/Class"],function(c,a){var b=a.extend({init:function(){this.changes={}},track:function(d){if(!(c.is(d,"object"))){throw new Error("change must be an object")}c.extend(this.changes,d)},getChanges:function(){return c.clone(this.changes)},isEmpty:function(){var d;for(d in this.changes){if(this.changes.hasOwnProperty(d)){return false}}return true},reset:function(){this.changes={}}});return b});define("DS/MPFModel/ModelCache",["UWA/Class"],function(b){var a=b.singleton({init:function(){this._cache={}},has:function(d){var c;var e;var f;c=false;e=typeof d;if((e==="string")||(e==="number")){f=d}else{if(e==="object"){f=d.id}}c=this._cache.hasOwnProperty(f);return c},add:function(e){var c;var d;var f;var g;c=false;f=e._type||"global";if(!(this._cache.hasOwnProperty(f))){this._cache[f]={}}d=this._cache[f];g=e.id;if(g){if(d.hasOwnProperty(g)){d[g].lastAccess=(new Date()).toISOString()}else{d[g]=this._createCacheEntry(e);c=true}}return c},get:function(e,f){var d;var c;e||(e="global");if(this._cache.hasOwnProperty(e)){c=this._cache[e];if(c.hasOwnProperty(f)){d=c[f].model}}return d},remove:function(e,f){var d;var c;e||(e="global");if(this._cache.hasOwnProperty(e)){c=this._cache[e];d=this.get(e,f);delete c[f]}return d},clear:function(){this._cache={}},_createCacheEntry:function(d){var e;var c;c=(new Date()).toISOString();e={created:c,lastAccess:c,model:d};return e}});return a});define("DS/MPFModel/MPFCollection",["UWA/Core","UWA/Promise","UWA/Class/Collection","DS/MPFError/BadArgumentError"],function(e,b,c,a){var d=c.extend({setup:function(g,f){if(!(e.is(f))){throw new Error("options object param is required")}if(!(e.is(f.dataProxy))){throw new Error("options.dataProxy param is required")}this._parent(g,f);this.dataProxy=f.dataProxy;this.modelDataProxy=f.modelDataProxy||f.dataProxy;this.parentResourceId=f.parentResourceId||null;this.cache=f.cache},sync:function(h,g,f){f=f||{};f.url=this.dataProxy.url(g,h,f);f.ajax=this.dataProxy.request.bind(this.dataProxy);return this._parent(h,g,f)},fetch:function(f){var g;f=f||{};f.dataProxy=this.dataProxy;g=f.onComplete;f.onComplete=function(k,j,i){var h;h=i&&i.responseHeaders&&i.responseHeaders["MP-Total-Model-Count"];if(h){this.totalModelCount=h}g(k,j,i)};return this._parent(f)},fetchPromise:function(g){var h=this;var f;f=b.deferred();g||(g={});g.onComplete=function(){f.resolve(h)};g.onFailure=f.reject;this.fetch(g);return f.promise},getTotalModelCount:function(){return this.totalModelCount},create:function(f,g){g=g||{};g.dataProxy=this.dataProxy;g.cache=this.cache;return this._parent(f,g)},setParentResourceId:function(f){if(f){this.parentResourceId=f}else{throw new a("resourceId must be defined")}},_prepareModel:function(h,g){var f;f=false;if(this.cache){f=this.cache.get(this.model._type,h.id)}if(!(f)){f=this._parent(h,g);this.cache&&this.cache.add(f)}return f}});return d});define("DS/MPFModel/MPFModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/MPFModel/ModelChangeTracker","DS/MPFUtils/MPFUtils","DS/MPFError/BadArgumentError"],function(e,g,b,d,f,i){var c;function h(j,o,n){var m;var k;var l;n=n===true;m={};for(k in j){if(j.hasOwnProperty(k)){l=o.get(k);if(l){m[l]=j[k]}else{if(n){m[k]=j[k]}}}}return m}function a(k){var j;var l;j={};for(l in k){if(k.hasOwnProperty(l)){if(k[l]!==null){j[l]=k[l]}}}return j}c=b.extend({init:function(j,k){if(!(e.is(k))){throw new Error("options object param is required")}if(!(e.is(k.dataProxy))){throw new Error("options.dataProxy param is required")}this.cache=k.cache;this.dataProxy=k.dataProxy;this.changeTracker=new d();return this._parent(j,k)},setup:function(j,k){var l=this;this._parent(j,k);this.mapper=k.mapper;this.parentResourceId=k.parentResourceId||null;this.listenTo(this,"onSync",function(){l.changeTracker.reset()})},sync:function(m,k,j){var l;j||(j={});l=j.dataProxy||this.dataProxy;j.url=l.url(k,m,j);j.ajax=l.request.bind(l);return this._parent(m,k,j)},fetch:function(l){var m=this;var j;var k;var n;l||(l={});if(this.cache&&(l.cache!==false)){k=this.cache.get(this.id);if(k){if(l&&typeof l.onComplete==="function"){l.onComplete(k,null,l)}}else{n=l.onComplete;l.onComplete=function(q,o,p){if(typeof n==="function"){m.cache.add(q,o,p);n(q)}};this._parent(l)}}else{this._parent(l)}return j},fetchPromise:function(k){var l=this;var j;j=g.deferred();k||(k={});k.onComplete=function(){j.resolve(l)};k.onFailure=j.reject;this.fetch(k);return j.promise},save:function(k,o,j){var m=this;var n;var l;if((!e.is(k))||(e.typeOf(k))==="object"){j=o}j=j||{};n=j.onComplete;j.onComplete=function(r,p,q){if(m.cache&&(q.cache!==false)){if(!(m.cache.has(r))){m.cache.add(r)}}if(n){n(r,p,q)}return m.dispatchEvent("onSave",{ok:true,model:r,message:"model succesfully saved"})};l=j.onFailure;j.onFailure=function(r,p,q){if(l){l(r,p,q)}return m.dispatchEvent("onSave",{ok:false,model:r,message:"unable to save model"})};if(!(e.is(o))){o=j}return this._parent(k,o,j)},savePromise:function(l,n,k){var m=this;var j;if((!e.is(l))||(e.typeOf(l))==="object"){k=n}j=g.deferred();k||(k={});k.onComplete=function(){j.resolve(m)};k.onFailure=function(q,o,p){j.reject({model:q,response:o,options:p})};if(!(e.is(n))){n=k}this.save(l,n,k);return j.promise},set:function(l,m,k){var j;if(e.is(l,"object")){j=l;k=m||{}}else{j={};j[l]=m;k||(k={})}this.changeTracker.track(j);return this._parent(j,k)},getPendingChanges:function(){return this.changeTracker.getChanges()},hasPendingChanges:function(){return !(this.changeTracker.isEmpty())},toJSON:function(l){var k;var j;j=this._parent(l);if(this.mapper){k=h(j,this.mapper,false)}else{k=this._parent(j)}k=a(k);return k},parse:function(k){var j;if(this.mapper){j=h(k,this.mapper.inverse(),true)}else{j=k}return j},clone:function(){return new this.constructor(this._attributes,{dataProxy:this.dataProxy,cache:this.cache,mapper:this.mapper})},setParentResourceId:function(j){if(j){this.parentResourceId=j}else{throw new i("resourceId must be defined")}},destroyPromise:function(k){var l=this;var j;j=g.deferred();k||(k={});k.onComplete=function(){j.resolve(l)};k.onFailure=j.reject;this.destroy(k);return j.promise},validate:f.doNothing});c.mapObjectKey=h;c.removeNullAttributes=a;return c});