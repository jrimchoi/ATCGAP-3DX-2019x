define("DS/RDFFoundation/FederatedSearchUtil",["UWA/Core","UWA/Class/Events","DS/WAFData/WAFData","DS/E6WCommonUI/PlatformManager"],function(e,b,a,c){"use strict";var d={_buildRequestData:function(h){var g=h.sources||[];var f=window.enoviaServer&&window.enoviaServer.user||window.dsUserLogin;return{label:h.label||"3dplan-"+f+"-"+Date.now(),locale:"en",with_synthesis:h.withSynthesis||Boolean(g&&g.indexOf("swym")!==-1),with_synthesis_attribute:h.withSynthesisAttribute||Boolean(g&&g.indexOf("swym")!==-1),select_predicate:h.selectPredicateArray,refine:h.refine,select_file:["icon","thumbnail_2d"],nresults:h.numResults||10,start:0,tenant:c.getTenant(),query:h.query,source:h.sources,specific_source_parameter:h.specific_source_parameter}},_buildRequest:function(f){var g={};g.method="POST";g.type="json";g.headers={"Content-Type":"application/json"};g.data=JSON.stringify(this._buildRequestData(f));g.onComplete=f.onComplete;g.onFailure=f.onFailure;return g},sendRequest:function(f){var g=c.getServiceUrl("3DSearch")+"/search";return a.authenticatedRequest(g,this._buildRequest(f))},filterSearchSources:function(g){d._validFederatedSearchSources=d._validFederatedSearchSources||{};var f=g.slice();var h=c.getServiceUrl("3DSearch");if(d._validFederatedSearchSources[h]){f=g.filter(function(i){return d._validFederatedSearchSources[h].indexOf(i)!==-1})}else{if(!d._gettingSources){d._gettingSources=true;a.authenticatedRequest(h+"/search/source",{onComplete:function(i){delete d._gettingSources;d._validFederatedSearchSources[h]=JSON.parse(i).source;d.eventDispatcher.dispatchEvent("onFederatedSearchSourcesLoaded")},onFailure:function(){delete d._gettingSources}})}}return f},hasLoadedFederatedSearchSources:function(){return d._validFederatedSearchSources},getFederatedQueryCriteria:function(h){var g=e.clone(h||{},false);var i;var f=g.criteria;if(g.fieldType==="person"){if(f.length!==1){throw new Error("Invalid search criteria for person field.")}else{i="personOrGroup:("+f[0]+")"}}else{if(f.length>1){i="("+f.join(" OR ")+")"}else{if(f.length===0||f[0].length===0){i=""}else{i=f[0]}}}return i}};d.eventDispatcher=new b();return d});define("DS/RDFFoundation/MaskUtils",["UWA/Core"],function(f){var i="model";var d="array";var j="collection";var g="string";var c={"dsplan:MVMask.Task.Property":{"dsplan:taskHasConstraint":j,"dsxplan:vocabularyType":g,"dsxplan:comment":g,"dsxplan:workscopeParent":i,"dsxplan:parentCommunity":i},"dsplan:MVMask.Task.CollaborativeTask.siblings":{"dsxplan:workscopeParent":i},"dsplan:MVMask.Task.Complex":{"dskern:owner":i,"dspol:modificationDate":g,"dspol:creationDate":g,"dsxplan:actualDeliverable":j,"dsxplan:actualEndDate":g,"dsxplan:actualStartDate":g,"dsxplan:durationIntervalMax":g,"dsxplan:durationIntervalMin":g,"dsxplan:endDateIntervalMax":g,"dsxplan:endDateIntervalMin":g,"dsxplan:estimatedDuration":g,"dsxplan:estimatedEndDate":g,"dsxplan:estimatedStartDate":g,"dsxplan:hasAssignee":j,"dsxplan:hasAttachment":j,"dsxplan:hasContentRepository":g,"dsxplan:hasMaturity":i,"dsxplan:hasScheduleError":j,"dsxplan:percentageCompletion":g,"dsxplan:requiresSkill.complex":j,"dsxplan:sequenceOrder":g,"dsxplan:startDateIntervalMax":g,"dsxplan:startDateIntervalMin":g,"dsxplan:userDefinedDates":g,"dsxplan:userDefinedEnd":g,"dsxplan:userDefinedStart":g},"dsplan:MVMask.ScheduleElements.Complex":{"dsxplan:actualEndDate":g,"dsplan:hasScheduleError":j,"dsxplan:hasScheduleError":j,"dsxplan:actualDate":g,"dsxplan:actualStartDate":g,"dsxplan:constraintType":g,"dsxplan:dateIntervalMax":g,"dsxplan:dateIntervalMin":g,"dsxplan:endDateIntervalMax":g,"dsxplan:endDateIntervalMin":g,"dsxplan:estimatedDate":g,"dsxplan:estimatedDuration":g,"dsxplan:estimatedEndDate":g,"dsxplan:estimatedStartDate":g,"dsxplan:from":j,"dsxplan:hasAssignee":j,"dsxplan:jsType":i,"dsxplan:lag":g,"dsxplan:startDateIntervalMax":g,"dsxplan:startDateIntervalMin":g,"dsxplan:to":j},"dsplan:MVMask.Task.CollaborativeTasks.Complex":{"dsxplan:comment":g},"dsplan:MVMask.WorkPackage.Complex":{"dspol:modificationDate":g,"dskern:owner":i,"dsplan:hasConstraint":j,"dsxplan:estimatedEndDate":g,"dsxplan:hasAssignee":j,"dsxplan:hasMilestone":j,"dsxplan:hasMilestoneVocabulary":d,"dsxplan:hasTask":j,"dsxplan:hasTaskVocabulary":d,"dsxplan:hasWorkContext":i,"dsxplan:hasWorkDecomposition":j,"dsxplan:invokeSolverAutomatically":g,"dsxplan:requiresSkill":j,"dsxplan:ScheduleUpdateStatus":g,"dsxplan:schedulingStrategy":g,"dsxplan:sequenceOrder":g,"dsxplan:startDateIntervalMin":g},"dsplan:MVMask.WorkPackage.Expanded":{"dsxplan:hasTask":j,"dsxplan:hasWorkDecomposition":j},"dsplan:MVMask.WorkPackage.CollaborativeTasks":{"dsxplan:hasTask":j,"dsxplan:hasThumbnail":g,"dsxplan:image":g,"dsxplan:jsType":i,"dsxplan:label":g},"dsplan:MVMask.WorkPackage.ScheduleView":{"dskern:owner":i,"dsplan:hasConstraint":j,"dsxplan:hasAssignee":j,"dsxplan:hasCommunity":i,"dsxplan:hasMilestoneVocabulary":d,"dsxplan:hasTaskVocabulary":d,"dsxplan:hasWorkContext":i,"dsxplan:sequenceOrder":g},"dsplan:MVMask.WorkPackage.MilestonesOnly":{"dsxplan:hasMilestone":j,"dsxplan:jsType.mask":i},"dsplan:MVMask.WorkPackage.Property":{"dsxplan:hasCommunity":i,"dsxplan:hasContentRepository":g,"dsxplan:estimatedEndDate":g,"dskern:owner":i,"dsxplan:hasWorkContext":i,"dsxplan:actualDeliverable":j,"dsxplan:hasAttachment":j,"dsxplan:schedulingStrategy":g,"dsxplan:invokeSolverAutomatically":g,"dsxplan:hasAssignee":j,"dsxplan:startDateIntervalMin":g,"dsxplan:usesCalendar":i,"dspol:modificationDate":g,"dsxplan:workDecompositionParent":i},"dsplan:MVMask.WorkPackage.Basic":{"dsxplan:jsType":i,"dsxplan:comment":g,"dsxplan:label":g,"dsxplan:hasMaturity":i,"dsxplan:hasThumbnail":g},"dsplan:MVMask.ScheduleElements.Basic":{"dsxplan:jsType":i},"dsplan:MVMask.Task.Basic":{"dsxplan:jsType":i,"dsxplan:label":g,"dsxplan:sequenceOrder":g},"dsplan:MVMask.Task.CollaborativeTask.Basic":{"dsxplan:hasMaturity":i,"dsxplan:estimatedEndDate":g},"dsplan:MVMask.WorkPackage.ContentView":{"dsxplan:hasContentRepository":g},"dsplan:MVMask.Access.Complex":{"dsxplan:jsType":i,"dsaccess:sharingResponsibility":g,"dskern:owner":i,"dskern:accessMask":g},"dsplan:MVMask.WorkPackage.CollaborativeTasks.Basic":{"dsxplan:jsType":i,"dsxplan:label":g,"dsxplan:image":g,"dsxplan:hasThumbnail":g},"dsplan:MVMask.TempConstraint.Complex":{"dsxplan:lag":g,"dsxplan:constraintType":g,"dsplan:hasScheduleError":i}};var e={"dsplan:MVMask.Task.Complex":["dsplan:MVMask.Task.Basic"],"dsplan:MVMask.Task.CollaborativeTask.Basic":["dsplan:MVMask.Task.Basic"],"dsplan:MVMask.Task.CollaborativeTasks.Complex":["dsplan:MVMask.Task.Basic","dsplan:MVMask.Task.Complex"],"dsplan:MVMask.Task.Property":["dsplan:MVMask.Task.Basic","dsplan:MVMask.Task.Complex"],"dsplan:MVMask.Task.CollaborativeTask.siblings":["dsplan:MVMask.Task.Basic"],"dsplan:MVMask.WorkPackage.Property":["dsplan:MVMask.WorkPackage.Basic"],"dsplan:MVMask.WorkPackage.Drop":["dsplan:MVMask.WorkPackage.Basic"],"dsplan:MVMask.WorkPackage.Complex":["dsplan:MVMask.WorkPackage.Basic"],"dsplan:MVMask.WorkPackage.Expanded":["dsplan:MVMask.WorkPackage.Basic","dsplan:MVMask.WorkPackage.ScheduleView"],"dsplan:MVMask.WorkPackage.Collapsed":["dsplan:MVMask.WorkPackage.Basic","dsplan:MVMask.WorkPackage.ScheduleView"],"dsplan:MVMask.WorkPackage.ContentView":["dsplan:MVMask.WorkPackage.Basic"],"dsplan:MVMask.WorkPackage.CollaborativeTasks":["dsplan:MVMask.WorkPackage.CollaborativeTasks.Basic"],"dsplan:MVMask.WorkPackage.CollaborativeTasks.all":["dsplan:MVMask.WorkPackage.CollaborativeTasks","dsplan:MVMask.WorkPackage.CollaborativeTasks.Basic"],"dsplan:MVMask.WorkPackage.CollaborativeTasks.owned":["dsplan:MVMask.WorkPackage.CollaborativeTasks.Basic"],"dsplan:MVMask.WorkPackage.CollaborativeTasks.assigned":["dsplan:MVMask.WorkPackage.CollaborativeTasks.Basic"],"dsplan:MVMask.ScheduleElements.Complex":["dsplan:MVMask.ScheduleElements.Basic"]};var a={};var h;function b(m){var l={};m&&m.forEach(function(n){l[n]=true});return l}function k(){function m(n){a[n]=b(e[n]);var o=e[n];o&&o.forEach(function(p){if(!a[p]){m(p)}f.merge(a[n],a[p])})}var l=Object.keys(e);l.forEach(function(n){!a[n]&&m(n)})}h={isSubMask:function(l,m){return m.some(function(n){if(l===n){return true}var o=a[n]&&a[n][l];return o})},addAttributeToMask:function(l,m,n){var o=h.addMask(l);o[m]=n},addMask:function(l){var m=c[l];if(!m){m=c[l]={}}return m},getMask:function(l){var n=f.clone(c[l]||{},false);var m=e[l];if(m){m.forEach(function(o){f.merge(n,c[o]||{})})}return n},getAllMasks:function(){return c},resetMaskContent:function(){c={}}};k();h.maskBreakdownArray=e;h.ARRAY_ATTR=d;h.COLLECTION_ATTR=j;h.MODEL_ATTR=i;h.STRING_ATTR=g;return h});define("DS/RDFFoundation/RDFUtils",["UWA/Core","UWA/Utils","UWA/Class","UWA/Class/Collection","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/RDFFoundation/FederatedSearchUtil","UWA/Class/Events","DS/E6WCommonUI/PlatformManager","UWA/Utils/Cookie","DS/E6WCommonUI/Search","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(i,f,w,F,c,h,e,t,s,D,l,k,u){var q="webapps",x="v0",p=1000*60*60*24,A=1000*60*60,E=1000*60,j=1000,o=/(-)?P(?:([0-9]+|NaN)D)?T?(?:([0-9]+|NaN)H)?(?:([0-9]+|NaN)M)?(?:([0-9.]+|NaN)S)?/,d;var m={"3dspace":"3DSpace",drive:"3DDrive",swym:"3DSwym",geovia:"geoservice"};var n=function(G){var H=u.get(G);return H};var v=function(K){var H={};var G=Object.keys(K);var J=G.length;for(var L=0;L<J;L++){var I=G[L];H[K[I]]=I}return H};function C(G,K,J){var I=i.clone(J||{});var N=[];var M=I.mask;delete I.mask;for(var H=0;H<K.length;H++){var L=d.getObjectForAdding(G,K[H],I);if(!L.id||(I.onlyIfNeeded&&M&&L.hasDataForMask(M))){continue}if(L._onRequest&&L._onCompleteRequest){L._onRequest()}L.completing=true;N.push(L)}return N}function g(J,H,I){var G=J.member||[];G.forEach(function(M){if(M.error===404||M.error===401){var L=d.getObjectById(M["@id"]);L&&I&&I(L)}else{var K=d.getExistingAndMerge(M,{animate:H});K&&K.addMask(M["@mask"])}})}var r=w.extend({init:function(){this.ajax=this.ajax.bind(this);this.requests=[]},ajax:function(I,H){var G=i.clone(H||{},false);G.url=I;this.requests.push(G)},addRequestsFromBatch:function(G){this.requests.push.apply(this.requests,G.requests)},_sendSingleRequest:function(Q,I,O){var G=O;var K=I;var N=Q;var M=(K.onComplete&&G.onComplete);var L=(K.onFailure&&G.onFailure);var P=O.waitOnInFlightRequests;if(M||L||P){K=i.clone(K,false);var J=K.onComplete;var H=K.onFailure;if(M){K.onComplete=function(){J&&J.apply(this,arguments);G.onComplete&&G.onComplete.apply(this,arguments)}}else{K.onComplete=J||G.onComplete}if(L){K.onFailure=function(){H&&H.apply(this,arguments);G.onFailure&&G.onFailure.apply(this,arguments)}}else{K.onFailure=H||G.onFailure}P&&(K.waitOnInFlightRequests=P)}return N(K.url,K)},sendBatch:function(H){var O=(H&&H.ajax)||d.request;var Q=this.requests;if(Q.length===0){H&&i.is(H.onComplete,"function")&&H.onComplete();return{cancel:function(){}}}var I=i.clone(H||{},false);if(Q.length===1){return this._sendSingleRequest(O,Q[0],I)}var S=f.getUUID();var J="batch_"+S;var K="changeset_"+S;var T="\r\n--"+J+"\r\nContent-Type: multipart/mixed;boundary="+K+"\r\n\r\n";var X=d.expandUrl("").length;var Y=Q.length;var U=1;for(var M=0;M<Y;M++){var G=Q[M];G.changeset=K;if(G.newTransaction&&M){T+="--"+K+"--\r\n";T+="--"+J+"\r\n";S=f.getUUID();K="changeset_"+S;T+="Content-Type: multipart/mixed;boundary="+K+"\r\n\r\n"}T+="--"+K+"\r\n";var N=G.id||U++;T+="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\nContent-ID: "+N+"\r\n\r\n";T+=G.method+" "+G.url.substring(X)+"\r\n";d.addNecessaryHeadersAndParams(G);if(G.headers){var V=Object.keys(G.headers);var L=V.length;for(var P=0;P<L;P++){var W=V[P];var R=G.headers[W];T+=W+": "+R+"\r\n"}}T+="\r\n";T+=(G.data||"")+"\r\n"}T+="--"+K+"--\r\n--"+J+"--";I.method="POST";I.data=T;I.headers={"Content-Type":"multipart/mixed;boundary="+J};I.url=d.expandUrl("batch");I.responseType="text";I.batchRequest=true;I.onComplete=function(ac){I.onServerResponseReceived&&I.onServerResponseReceived();var ag=d.parseBatchRequest(ac);var ah=ag.length;var af=0;var aj=Q.length;var ad;var ai=function(an,am){var al=this[am];var ak=al.data;if(Math.floor(al.status/100)===2){if(an.type==="json"){ak=JSON.parse(ak)}i.is(an.onComplete,"function")&&an.onComplete(ak,al.headers)}else{i.is(an.onFailure,"function")&&an.onFailure(al.data,al.headers)}};var aa;var Z=function(ak){if(typeof this.data==="string"){this.data={msg:this.data}}this.data["@code"]=this.status;i.is(ak.onFailure,"function")&&ak.onFailure(new Error('NetworkError: URL "'+ak.url+'" return ResponseCode with value "'+(this.status||0)+" "+(this.statusText||"")+'".'),this.data,this.headers)};for(var ab=0;ab<ah;ab++){aa=ag[ab];var ae=[];for(;af<aj;af++){ad=Q[af];if(ad.newTransaction&&af){ad.newTransaction=false;break}ae.push(ad)}if(i.is(aa,"array")){if(aa.length===ae.length){ae.forEach(ai,aa)}else{throw new Error("expecting "+ae.length+" response.  Got "+aa.length)}}else{ae.forEach(Z,aa)}}H&&i.is(H.onComplete,"function")&&H.onComplete(ac)};I.onFailure=function(){var aa=Q.length;for(var Z=0;Z<aa;Z++){var ab=Q[Z];i.is(ab.onFailure,"function")&&ab.onFailure.apply(this,arguments)}H&&i.is(H.onFailure,"function")&&H.onFailure.apply(this,arguments)};return O(I.url,I)}});var a={cancel:function(){var H=(this.options.queue||d);if(this.actualRequest){delete this.options.onComplete;this.actualRequest.cancel&&this.actualRequest.cancel()}else{var G=d._pendingRequests.indexOf(this);H._pendingRequests.splice(G,1)}},onComplete:function z(){var G=(this.options.queue||d);this.removeFromInFlightRequest();i.is(this._onComplete,"function")&&this._onComplete.apply(this,arguments);d.sendPendingRequests(G)},onFailure:function B(){var G=(this.options.queue||d);this.removeFromInFlightRequest();i.is(this._onFailure,"function")&&this._onFailure.apply(this,arguments);d.sendPendingRequests(G)},removeFromInFlightRequest:function(){var H=(this.options.queue||d);var G=H._inFlightRequests.indexOf(this);H._inFlightRequests.splice(G,1);if(H!==d){G=d._inFlightRequests.indexOf(this);d._inFlightRequests.splice(G,1)}}};d={MAX_CONCURRENT_REQUEST:20,_inFlightRequests:[],_pendingRequests:[],inverseMapping:v,sourceToServiceMap:m,serviceToSourceMap:v(m),serviceFromSource:function(G){return d.sourceToServiceMap[G]||G},sourceFromService:function(G){return d.serviceToSourceMap[G]||G},serviceArrayFromSourceArray:function(G){return G.map(d.serviceFromSource)},_computeTypeAheadEntryBasedOnFedSearchResult:function(M){var I=M.attributes;var L=I.length;var K={};for(var G=0;G<L;G++){var H=I[G];var J=H.value;switch(H.name){case"resourceid":K.value=J;break;case"preview_url":K.image=J;break;case"ds6w:type":case"ds6w:what/ds6w:type":K["ds6w:type"]=J;break;case"ds6w:label":K.label=J;break;case"sourceid":K.sourceId=J;break;default:}}return K},typeAheadCallback:function y(J,I,L,H){var G=t.filterSearchSources(J.searchSource);var K;if(window.widget.getValue("oldSearch")){K="("+I+"* OR "+I+")"}else{K=t.getFederatedQueryCriteria({criteria:[I],fieldType:J.type})}return t.sendRequest({selectPredicateArray:["ds6w:label","ds6w:type","ds6w:type_value","type_icon_url","preview_url"],sources:G,query:K,specific_source_parameter:k.computeSourceParameters(J),withSynthesisAttribute:Boolean(G&&G.indexOf("swym")!==-1),onComplete:function(R){var Q=(i.is(R,"string")?JSON.parse(R):R);var O=Q.results;var N=[];if(O){var M=O.length;for(var P=0;P<M;P++){var T=O[P];var S=d._computeTypeAheadEntryBasedOnFedSearchResult(T);N.push(S)}}L(N,H)}})},complete:function(S,R,W){var J=i.clone(W||{},false);var M=J.batchGenerator;var V=J.mask;var H=C(S,R,J);if(H.length===0){return}var P=function(X){X.forEach(function(Z){var Y=d.getObjectById(Z);Y._onCompleteRequest&&Y._onCompleteRequest();Y.completing=false})};var N=J.onComplete;var K=J.onFailure;var U=function(X,Y){g(Y,W.animate,K);P(X);N&&N(arguments)};var T=function(X){P(X);K&&K(arguments)};var Q=M?M.ajax:d.request;var I=H.map(function(X){return X.id});while(I.length){var O=I.splice(0,10);var L="classes/dslc:ItemVersion?$mask="+V;L+="&$where="+encodeURIComponent("?s WHERE { VALUES ?s {"+O.join(" ")+"} }");var G=d.expandUrl(L,"v1");Q(G,{onServerResponseReceived:W.onServerResponseReceived,method:"GET",type:"json",newTransaction:true,onComplete:U.bind(undefined,O),onFailure:T.bind(undefined,O)})}},subscribeToNotification:function(G){return e.subscribe("XApp.Magic.Update",G)},addNecessaryHeadersAndParams:function(H){H.headers||(H.headers={});if(H.method!=="GET"&&H.METHOD!=="OPTIONS"){H.headers["X-Requested-With"]="XMLHttpRequest"}if(H.method==="POST"){if(H.url.match(/\/invoke/)){H.headers["Content-Type"]="application/json";if(!H.data){H.data="[]"}}if(H.type!=="json"){H.headers.Accept="multipart/mixed,application/json"}}!H.headers["Accept-Language"]&&(H.headers["Accept-Language"]=window.widget&&window.widget.lang);var G=window.widget&&window.widget.getValue("overrideTenant");if(G){H.url=d.addQueryParam(H.url,"tenant","dstenant:"+G,true)}},hrefFromId:function(H){var G="/resources/";G+=H;return G},getObjectById:function(G){return d.objectMap[G]},resetObjectMap:function(){d.objectMap={}},addObjectToMap:function(H,G){d.objectMap[H]&&console.error("attempting to add object to an existing id");d.objectMap[H]=G},removeObjectFromMap:function(G){!d.objectMap[G]&&console.log("Removing object from map that wasn't there. Not an issue, just strange");delete d.objectMap[G]},getObjectForAdding:function(H,L,J){var I=i.clone(J||{},false);var K=d.getObjectById(L);if(!K&&H){var G=d.getTypeCollection(H,{create:true});K=d.createPlaceholder(L);if(I.attrs){i.merge(K,I.attrs);delete I.attrs}K=G.add(K,I)}if(I.mask){I.onlyIfNeeded=true;K.fetch(I)}return K},createPlaceholder:function(K,G,J,H){var I={"@id":K,"@href":d.hrefFromId(K),"@mask":G,"@type":J,_skeletonId:K};if(H&&H.forceDslc){I.forceDslc=true}return I},splitUri:function(H){var G;G=H.indexOf(":");return[H.substr(0,G),H.substr(G+1)]},getAssetUrl:function(G){var H,I;H=d.splitUri(G);I=H[0];if(I===q){G=h.getWebappsBaseUrl()+H[1]}return G},addQueryParam:function(H,G,J,I){if(i.is(J)){return H+(H.indexOf("?")===-1?"?":"&")+G+"="+(I?encodeURIComponent(J):J)}return H},addQueryParams:function(G,H){H.forEach(function(I){G=d.addQueryParam(G,I.name,I.value,I.encode)});return G},parseUrl:function(H){var G,I;G=f.parseUrl(H);I=G.query.length?f.parseQuery(G.query):{};return{path:G.path,mask:I.$mask,where:I.$where&&decodeURIComponent(I.$where)}},reconstructUrl:function(G){var H=G.path+(G.mask?"?$mask="+G.mask:"");H+=(G.mask&&G.where?"&":"");H+=(G.where?"$where="+G.where:"");return H},expandUrl:function(H,G){H=H.replace(/^\//,"");G=G||x;return D.getServiceUrl("3dplan")+"/"+G+"/"+H},request:function(H,N){var M;var I=i.clone(N||{},false);I.url=H;d.addNecessaryHeadersAndParams(I);var L=I.queue||d;M=c.authenticatedRequest;var J=Object.create(a);J.options=I;var O=L.MAX_CONCURRENT_REQUEST||d.MAX_CONCURRENT_REQUEST;if((L._inFlightRequests.length>=O)||(I.waitOnInFlightRequests&&d._inFlightRequests.length)){L._pendingRequests.push(J);return J}else{J._onComplete=I.onComplete;J._onFailure=I.onFailure;I.onComplete=J.onComplete.bind(J);L._inFlightRequests.push(J);if(L!==d){d._inFlightRequests.push(J)}var K;I.onFailure=function G(R,Q){var P=K&&K.xhr&&K.xhr.status;P&&i.is(Q,"object")&&(Q["@code"]=P);Q&&i.is(Q,"object")&&(Q.error=R);if((P===503||this.status===503)&&!J.alreadySentOnce){l.expire("SERVERID");l.expire("SOLVERID");J.alreadySentOnce=true;K=M(H,I)}else{J.onFailure.apply(J,arguments)}};K=M(I.url,I);return K}},createRequestQueue:function(){return{_inFlightRequests:[],_pendingRequests:[],MAX_CONCURRENT_REQUEST:3}},sendPendingRequests:function(G){var M=G||d;if(G&&!G._pendingRequests.length){M=d}if(!M._pendingRequests.length){return}var I=M._pendingRequests;var J=I.length;var K;var H=M.MAX_CONCURRENT_REQUEST||d.MAX_CONCURRENT_REQUEST;for(K=0;K<J&&M._inFlightRequests.length<H;K++){var L=I[K];d.request(L.options.url,L.options)}M._pendingRequests.splice(0,K)},getBatchGenerator:function(){return new r()},getExistingAndMerge:function(K,H){var G=i.clone(H||{},false);var J=d.getObjectById(K["@id"]);if(G.mergeIfSameETag){if(!J||J.get("@etag")!==K["@etag"]){J=undefined}}if(J){var I=K;I=J.parse(I);G.parse=true;J.set(I,G)}return J},getModelConstructor:function(P){var H;if(d.typeDictionary){if(d.typeDictionary.typeMap){var M=P["@type"]||P["dsxplan:jsType"];if(!M){var K=P["dsxplan:actualType"]||P["dsplan:actualType"];M=K&&K["@id"]}if(M){var O=d.typeDictionary.typeMap[M];return O&&O.type}}if(d.typeDictionary.mapping){var L=P["rdf:type"];var I=i.is(L,"array")?L:L&&L.member;var G={};if(I){I.forEach(function(Q){G[Q["@id"]]=Q})}else{if(P["@type"]){var J=P["@type"];G[J]=J}}var N;d.typeDictionary.mapping.some(function(R){var Q=G[R.key];if(Q){N=R.type;return true}return false});H=N}}return H},removeTypeCollection:function(G){var H;if(d.typeDictionary){if(d.typeDictionary.modelIndexes){var I=d.typeDictionary.modelIndexes.get(G);d.typeDictionary.modelIndexes["delete"](G);H=I}}return H},resetTypeCollection:function(G,H){if(d.typeDictionary){if(!d.typeDictionary.modelIndexes){d.typeDictionary.modelIndexes=new Map()}d.typeDictionary.modelIndexes.set(G,H)}},getTypeCollection:function(G,I){var J;if(d.typeDictionary){if(!d.typeDictionary.modelIndexes){d.typeDictionary.modelIndexes=new Map()}var H=d.typeDictionary.modelIndexes.get(G);if(!H&&I&&I.create){H=new d.ResultCollection(undefined,{model:G,"@href":"classes/"+G.prototype._uwaClassName,"@id":"typeCollection:"+G.prototype._uwaClassName});d.typeDictionary.modelIndexes.set(G,H)}J=H}return J},getModelByTypeAndId:function(G,J,H){var I=this.getTypeCollection(G,H);return I&&I.get(J,H)},_maskStrength:function(G){if(!G){return -1}if(d.typeDictionary&&d.typeDictionary.masksStrength){var H=d.typeDictionary.masksStrength[G];if(typeof H!=="undefined"){return H}}if(G==="dskern:Mask.Default"){return 0}if(G.match(/.*\.Basic$/)){return 1}if(G.match(/.*\.Simple$/)){return 2}if(G.match(/.*\.Collapsed$/)){return 6}if(G.match(/.*\.Expanded$/)){return 8}return G.match(/.*\.Complex$/)?10:1},compareMasks:function(H,G){if(d.typeDictionary&&!d.typeDictionary.masksStrength){}return d._maskStrength(H)-d._maskStrength(G)},xsDateTimeDurationToMilliseconds:function(J){var O=0,G,N,L,H,M,K=String(J),I=K.match(o);if(I){G=(I[1]==="-");N=parseInt(I[2]||0)*p;L=parseInt(I[3]||0)*A;H=parseInt(I[4]||0)*E;M=parseFloat(I[5]||0)*j;O=N+L+H+M;if(G){O=-O}}return O},millisecondsToXsDateTimeDuration:function(G){return(G<0?"-":"")+"PT"+Math.abs(G)/1000+"S"},handleContext:function(H){if(H){var G=H["@context"];G&&i.merge(d.typeDictionary.context,G)}},shortToLongURI:function(H){var G=d.splitUri(H);var J=d.typeDictionary.context[G[0]];var I=H;if(J){I="<"+J+G[1]+">"}else{if(G[0]==="uuid"){I="<"+H+">"}}return I},loadTypeList:function(P){var O=P;var G=O&&O.member;if(G){var H={};var R={};var I=G.length;var K;var S;var J=function(W){if(W.key===K){S=W;return true}return false};var M=function(X){var W=X.Name;if(W){if(S){H[W]=S}R[K].push(W)}};for(var Q=0;Q<I;Q++){var U=G[Q];K=U.Name;S=undefined;R[K]=[];d.typeDictionary.mapping.some(J);d.scanStructure(U,M)}d.typeDictionary.typeMap=H;d.typeDictionary.typeHierarchy=R}var T=d.typeDictionary.mapping;var N=T.length;for(var L=0;L<N;L++){var V=T[L];if(!d.typeDictionary.typeMap[V.key]){d.typeDictionary.typeMap[V.key]=V}}},scanStructure:function(J,S,P,Q){var K;if(i.is(J,"array")){var M=J.length;for(var G=0;G<M;G++){var N=J[G];if(d.scanStructure(N,S,J)==="STOP"){return"STOP"}}}else{if(i.is(J,"object")){var R=Object.keys(J);var I=R.length;for(var L=0;L<I;L++){var H=R[L];var O=J[H];if(H==="@context"||H==="rdf:type"){continue}if(i.is(O,"object")||i.is(O,"array")){if(d.scanStructure(O,S,J,H)==="STOP"){return"STOP"}}}return S(J,P,Q)}}return K},typeDictionary:{context:{}},DOUBLE_LINE:"\r\n\r\n",parseBatchRequest:function b(S){var J=S;var P=J.indexOf("\r\n",1);var R=J.substr(0,P);var I=J.split(R);var G=I.length;var O=[];O.boundary=R;var H=function(V){if(V.length){var W=V.match(/([^:]*):(.*)/);if(W){this[W[1]]=W[2]}}};var Q=function(Y){var aa=Y.trim().split(d.DOUBLE_LINE,2);var af=aa[0].split("\r\n");if(af.length>1){var V={};af.forEach(H,V);var ac=aa[1];var ab=ac.split("\r\n");var ad=ab.shift();var ag=ad.match(/(POST|GET|PATCH|DELETE|PUT)[ ]+(.*)/);var W=ad.match(/HTTP\/1\.1[ ]+([0-9]+)[ ]+(.*)/);var X=Y.substr(aa[0].length+d.DOUBLE_LINE.length*2+ac.length);var ae={data:X,partHeader:V};if(ag){ae.url=ag[2];ae.method=ag[1]}else{if(W){ae.status=parseInt(W[1],10);ae.statusText=W[2]}}V={};ab.map(H,V);ae.headers=V;return ae}var Z;return Z};for(var N=1;N<G-1;N++){var K=I[N];var M=K.match(/Content-Type:\s*multipart\/mixed;boundary=(.*)/);if(M){var L=M[1];var T=K.split("--"+L);T.pop();T.shift();var U=T.map(Q.bind(this));U.boundary=L;O.push(U)}else{O.push(Q.call(this,K))}}return O},getDictionaryBatch:function(H){var G=i.clone(H||{},false);var J=d.getBatchGenerator();G.ajax=J.ajax;var I=function(L){var K=n("E6WCommonUI.Alert.3DPlanServiceFail");if(window.widget&&window.widget.alerter){window.widget.alerter.add({message:K,className:"error"});window.widget.alerter.show()}return H&&L&&L.apply(this,arguments)};J.ajax(d.expandUrl("invoke/dsmf:xplan.xPlanVocabulary.getVocabulary"),{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify([]),onComplete:function(K){d.loadTypeList(K)},onFailure:I.bind(this,H&&H.onFailure),onTimeout:I.bind(this,H&&(H.onTimeout||H.onFailure)),type:"json"});return J},serverHasDSLC:function(){if(this.typeDictionary&&this.typeDictionary.typeHierarchy){return this.typeDictionary.typeHierarchy["dslc:ItemVersioningPolicy"]}return false},removeAllTypeCollections:function(){delete d.typeDictionary.modelIndexes},removeObjectFromIndex:function(I){var G=d.getObjectById(I);if(G){var H=d.getTypeCollection(G.constructor);H.remove(G);delete d.objectMap[I]}return G}};d.inverseMapping=v;return d});define("DS/RDFFoundation/Models/ResultModel",["UWA/Core","UWA/Utils","UWA/Class/Model","UWA/Class/Collection","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/MaskUtils","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(f,k,e,g,c,o,l,n){c.objectMap={};var a=e;var d,j;var i=Object.prototype.hasOwnProperty;j=f.is;var h=function(){var q=this.get("dsxplan:jsType")||this.get("@type")||this.get("dsxplan:actualType")||this.get("dsplan:actualType");if(q&&!f.is(q,"string")){q=q.id}return q};d={_mapDslcAttributes:function(r){if(r&&this.dslcMapping){var q=Object.keys(r);var u=q.length;for(var w=0;w<u;w++){var t=q[w];var s=this.dslcMapping[t];if(s){var v=r[t];delete r[t];r[s]=v}}}return r},isRDF:true,serviceHosting:"3dplan",idAttribute:"@id",_uwaClassName:"ResultModel",setCollection:function(q,t){var s=this;this._collections[q]=t;var r=this.getPropertyInverse(q);function u(w){var v;if(r.name&&!(w&&w.dontRegisterChange)){v=f.clone(w||{},false);f.merge(v,r);v.dontRegisterChange=true}return v}this.listenTo(t,{onAdd:function(x,y,w){var v=u(w);if(v){x._addToModelOrCollectionProperty(this,v)}this._registerChangedCollection(q,x,y,w)},onRemove:function(x,y,w){var v=u(w);if(v){x._removeFromModelOrCollectionProperty(s,v)}this._registerChangedCollection(q,x,y,w)},onReset:function(B,x){var w=u(x);if(w){var A={};x.previousModels.forEach(function(C){A[C.id]=C});B.forEach(function(C){if(A[C.id]){delete A[C.id]}else{C._addToModelOrCollectionProperty(s,w)}});var v=Object.keys(A);for(var z=0;z<v.length;z++){var y=A[v[z]];y._removeFromModelOrCollectionProperty(s,w)}}this._registerChangedCollection.bind(this,q)}})},hasViewAccess:function p(){return true},MAX_CONCURRENT_REQUEST:1,init:function(s,r){this._inFlightRequests=[];this._pendingRequests=[];if(s&&s.forceDslc){this._isDslc=true;delete s.forceDslc}this.fetching=0;this._models={};this._collections={};this._changedAttributesSinceLastSave={};if(this.isDSLC(s||{})){s=this._mapDslcAttributes(s)}var q=r||{};Object.defineProperty(this,"collectionConstructor",{get:this._getCollectionConstructor,set:function(u){this._collectionConstructor=u;return u}});if(!this._collectionConstructor){if(q.collectionConstructor){this.collectionConstructor=q.collectionConstructor}else{if(q.collection){this.collectionConstructor=q.collection.constructor}else{}}}var t=s&&s["@id"];if(t){if(c.getObjectById(t)){throw new Error("object existing try to get existing from resultmodel first")}c.addObjectToMap(t,this);if(!s["@href"]){s["@href"]=c.hrefFromId(t)}}return this._parent.apply(this,arguments)},_getCollectionConstructor:function(){return this._collectionConstructor||(this.collection&&this.collection.constructor)||c.ResultCollection},_registerChangedCollection:function(u,t,v,s){var q=v;var r=s;if(t instanceof g){q=t;r=v}if(!(r&&(r.parse||r.dontRegisterChange))&&!this.isPropertyVolatile(u)){this._changedAttributesSinceLastSave[u]=q}},_registerChangedAttributes:function(t,s){var q=t||this;var r=f.clone(s||{},false);if(!r.parse&&!r.dontRegisterChange){var v=q.changedAttributes();for(var u in v){if(i.call(v,u)&&!this.isPropertyVolatile(u)){this._registerChangedAttribute(u,v[u],s)}}}},_registerChangedAttribute:function(s,t,q){var r=this._changedAttributesSinceLastSave;if(r[s]===undefined||r[s]===null){r[s]=this.previous(s)}if(t instanceof d){this._models[s]=t}this._updateInverseProperty(s,t,q)},_updateInverseProperty:function(u,v,t){var q=this.getPropertyInverse(u);if(q.name){var s=f.clone(t||{},false);f.merge(s,q);s.dontRegisterChange=true;var r=this.previous(u);if(r){if(r["@id"]){r=c.getObjectById(r["@id"])}if(r instanceof d){r._removeFromModelOrCollectionProperty(this,s)}}if(v&&v instanceof d){v._addToModelOrCollectionProperty(this,s)}}},_removeFromModelOrCollectionProperty:function(r,q){if(q.isCollection){var s=this.getCollectionAttribute(q.name);s.remove(r,q)}else{this.unset(q.name,q)}},_addToModelOrCollectionProperty:function(r,q){if(q.isCollection){var s=this.getCollectionAttribute(q.name);s.add(r,q)}else{this.set(q.name,r,q)}},destroy:function(r){this.destroying=true;var q=f.clone(r||{},false);q.dontRegisterChange=true;var s=Array.prototype.slice.call(arguments,0);s[0]=q;this.stopListening();c.removeObjectFromMap(this.id);c.removeObjectFromMap(this.cid);this._parent.apply(this,s);this.removeEvents()},clone:function(){throw new Error("don't clone resultmodels please")},toJSON:function(A){var q=f.clone(A||{},false);var y=q.level===undefined?1:q.level;if(y<0){return{}}q.level=y-1;var v=q.ancestors;var x=v&&v[this.id];if(!v){q.ancestors=v={}}v[this.id]=true;var B=this._parent.apply(this,arguments);var z={};var w={};if(q.attributes){var t=q.attributes.length;for(var r=0;r<t;r++){var s=q.attributes[r];var u=B[s];u!==undefined&&(w[s]=u);z[s]=true}}else{w=B}if(!x){this._jsonChildren(w,this._models,y,z,q);this._jsonChildren(w,this._collections,y,z,q);if(A&&A.noSkeletonId){delete w._skeletonId}}if(this.isDSLC()&&this.dslcMapping){q.level=y;delete q.ancestors;q.isAnAncestor=x;this._jsonDSLC(w,q)}if(!this.hasViewAccess()){w.error="No Access";w.noAccessCharacter=n.get("E6WCommonUI.Error.NoAccess")+" "}return w},_jsonChildren:function(t,x,r,w,z){var y=Object.keys(x);var s=y.length;for(var v=0;v<s;v++){var q=y[v];if(r!==0){if(z.attributes&&!w[q]){continue}var u=x[q];if(u instanceof c.ResultCollection&&!u.length&&z.noEmptyCollection){continue}t[q]=u.toJSON(z)}else{delete t[q]}}},_jsonDSLC:function(t,A){if(A.dataForRendering){var y=A.isAnAncestor;var z=Object.keys(this.dslcMapping);var s=z.length;for(var v=0;v<s;v++){var q=z[v];if(A.attributes&&A.attributes.indexOf(q)===-1){continue}var w=this.get(q);var u=false;if(w!==undefined){if(!y){if(f.is(w,"array")){var r=[];for(var x=0;x<w.length;x++){if(w[x] instanceof d||w[x] instanceof c.ResultCollection){if(A.level!==0){r.push(w[x].toJSON(A))}else{u=true;break}}}w=r}if(w instanceof d||w instanceof c.ResultCollection){if(A.level!==0){w=w.toJSON(A)}else{u=true}}}if(u){delete t[q]}else{t[q]=w}}}}},getCollectionAttribute:function(r,s){var q=r;if(this.isDSLC()&&this.dslcMapping){q=this.dslcMapping[r]||q}var t=this.get(q);if(!t){t=this.addNewCollectionData(q,undefined,s)}return t},isNew:function(){if(this.forcedNew){return true}return this._parent.apply(this,arguments)},_syncCreateDSLC:function(s,v){var u=v.idToDuplicate?d.CLONE_ITEM_VERSION_URI:d.CREATE_ITEM_VERSION_URI;var r=v.mask||this.writeMask||this.getMask();var w=r?"?$mask="+r:"";v.url=c.expandUrl(u+w);var t=this.getParentPath();var q=v.idToDuplicate;if(q){v.data=JSON.stringify([v.attrs,q,t])}else{v.data=JSON.stringify([v.attrs,t])}v.method="POST"},syncCreate:function(C,D){var x=this;var E={};var w={};var A=function A(F){Object.keys(F).forEach(function(G){var H=E[G];H&&H.resetFlags()})};Object.keys(C).forEach(function(F){var I,H,G;I=C[F];if(I instanceof g){if(!I.length){return}E[F]=I;H=I.compactJson()}else{G=(I instanceof e)||Boolean(this._models[F]);if(G){H=I?I.compactJson():undefined}else{H=I}}w[F]=H},this);function t(G){var H=G.split("/");var F=H[H.length-1];return F}var r=t(this.getParentPath());var v=this.getPropertyThisIsInverseOf(r);if(v){delete w[v]}D.attrs=D.attrs=D.noStringify||this.isDSLC()||D.dslc?w:JSON.stringify(w);var B=[];var z=Object.keys(this._models);var y=Object.keys(this._collections);var u=D.onComplete;var q=D.onFailure;z.forEach(function(G){var F=this[G];if(F.isNew()){B.push(F)}},this._models);var s=function(F){if(F.isNew()){B.push(F)}};y.forEach(function(G){var F=this[G];F.forEach(s)},this._collections);D.onComplete=function(){A(x._collections);B.forEach(function(F){F.isNew()&&F.destroy()});if(u){u.apply(x,arguments)}};D.onFailure=function(){x.destroy({noServer:true,dontRegisterChange:true});if(q){q.apply(x,arguments)}};this.collection&&this.collection.removeAddedModel(this);if(this.isDSLC()||D.dslc){this._syncCreateDSLC(C,D)}},_syncPatchDSLC:function(q,s){var r;s.url=c.expandUrl(d.MODIFY_ITEM_VERSION_URI+"?$mask="+this.getMask());s.data=JSON.stringify([s.attrs,this.id]);s.method="POST";return r},_syncPatchHandleCollectionAttribute:function(t,v,r){var q=v._replaceOnSave;var u=[];var s;delete v._replaceOnSave;if(t==="rdf:type"&&v._added.length===1&&v.length===1&&(v._removed.length>0||q)){u.push({op:"replace",path:"/"+t,value:v._added[0].compactJson()})}else{v._added.forEach(function(w){u.push({op:"add",path:"/"+t+"/-",value:w.compactJson()})});v._removed.forEach(function(w){s=w["@value"];if(f.is(s)){if(f.is(s,"string")){s='"'+s+'"'}}else{s=w.id}u.push({op:"remove",path:"/"+t+"/{"+s+"}"})})}r[t]={_removed:v._removed,_added:v._added};v.resetFlags();return u},syncPatch:function(y,z){var q=[];var v={};var u=this._changedAttributesSinceLastSave;this._changedAttributesSinceLastSave={};var r={};var x=this;var w;Object.keys(u).forEach(function(B){var E,D,A,F,C;if(x.isPropertyVolatile(B)||(x.computedProperties&&x.computedProperties[B])){return}E=y[B];if(E instanceof g){q.push.apply(q,x._syncPatchHandleCollectionAttribute(B,E,r))}else{C=(E instanceof e)||Boolean(this._models[B]);A=u[B];if(j(A)&&!j(E)){F="remove"}else{if(!j(A)&&j(E)){F="add"}else{if((j(A)&&j(E))&&((C&&(A.id!==E.id))||(!C&&(A!==E)))){F="replace"}}}if(C){v[B]=E;D=E?E.compactJson():undefined}else{D=E}if(F){q.push({op:F,path:"/"+B,value:D})}}},this);if(!q.length){if(z&&z.onComplete){z.onComplete()}w={cancel:function(){}}}if(!w){z.attrs=z.noStringify||this.isDSLC()?q:JSON.stringify(q);var s=f.clone(z||{},false);var t=z.onFailure;z.onFailure=function(A){if(t){t(A)}this.dispatchEvent("onError",[this,A,s]);this.rollbackChanges(u,r,y)}.bind(this);z.url=this.url({mask:this.writeMask})}if(!w&&this.isDSLC()){w=this._syncPatchDSLC(y,z)}return w},rollbackChanges:function(s,t,q){var w=this;var v=s||this._changedAttributesSinceLastSave;var y=false;var A={};Object.keys(v).forEach(function(C){var D=w.get(C);var B=v[C];if(B!==D){A[C]=B;y=true}});if(y){this.set(A,{dontRegisterChange:true});var r=this._previousAttributes;this._previousAttributes=q;var x=Object.keys(A);for(var u=0;u<x.length;u++){var z=x[u];this._updateInverseProperty(z,A[z])}this._previousAttributes=r}Object.keys(t).forEach(function(B){var E=w.get(B);var D=t[B];var C=false;D._added&&D._added.forEach(function(F){E.remove(F,{dontRegisterChange:true});C=true});D._removed&&D._removed.forEach(function(F){E.add(F,{dontRegisterChange:true});C=true});if(C){w._fireRelationshipChangeEvents(B)}});this._changedAttributesSinceLastSave={}},_dontRollBackAndRetrySave:function(q,s){var r=this;f.extend(this._changedAttributesSinceLastSave,q);Object.keys(s).forEach(function(t){var v=r.get(t);var u=s[t];u._added&&u._added.forEach(function(w){v._registerAddedModel(w)});u._removed&&u._removed.forEach(function(w){v._registerRemovedModel(w)})});this.save()},_syncSetQueue:function(r,q){if(this instanceof d&&!q.queue){var s=this;if(r==="create"&&f.is(this.getParent,"function")){s=this.getParent()||this}q.queue=s}},sync:function(q,v,A){if(A&&A.noServer){if(A&&A.onComplete){A.onComplete()}return{cancel:function(){}}}var w=this;var r=f.clone(A||{},false);if(!r.ajax){r.ajax=c.request;this._syncSetQueue(q,r)}var y=f.extend(this.toJSON({noSkeletonId:true}),this._collections);y=f.extend(y,this._models);var x=Array.prototype.slice.call(arguments,0);x[2]=r;var t=A.onComplete;var s=A.onFailure;switch(q){case"create":this.syncCreate(y,r);break;case"update":case"patch":x[0]="patch";var u=this.syncPatch(y,r);if(u){return u}break;case"read":var z=this.mask;if(A&&A.mask&&!A.dontUpdateMask){this.mask=A.mask}this.completing=true;r.onComplete=function(){w.completing=false;if(t){t.apply(this,arguments)}};r.onFailure=function(){w.completing=false;w.mask=z;if(s){s.apply(this,arguments)}};break;case"delete":this.syncDelete(r);break;default:}r.id=this.id||this.cid;return this._parent.apply(this,x)},onTypeChange:function(){var q=c.getModelConstructor(this.toJSON())||d;if(!(this instanceof q)){c.removeObjectFromIndex(this.id);var r=new q(this.toJSON(),{parse:true,collectionConstructor:this.collectionConstructor});this.dispatchEvent("onReplace",[this,r])}},isDSLC:function(s){if(this._isDslc){return this._isDslc}var t=s?s["@type"]:d.prototype.get.call(this,"@type",{noDSLCMapping:true});var u;if(t&&c&&c.typeDictionary&&c.typeDictionary.typeHierarchy){var q=c.typeDictionary.typeHierarchy["dslc:ItemVersioningPolicy"];u=q&&q.indexOf(t)!==-1}else{if(!s){var w=this.get("dsxplan:jsType",{noDSLCMapping:true})||d.prototype.get.call(this,"dsxplan:actualType",{noDSLCMapping:true});u=Boolean(w);if(!u){var r=d.prototype.get.call(this,d.ACTUAL_TYPE_ATTR,{noDSLCMapping:true})||t;r=r&&(r.id||r);if(r){u=r==="dslc:ItemVersion";if(!u&&c&&c.typeDictionary&&c.typeDictionary.typeHierarchy){var v=c.typeDictionary.typeHierarchy["dslc:ItemVersion"];u=v&&v.indexOf(r)!==-1}}}}}this._isDslc=u;return u},setup:function(t,s){s=s||{};if(this.isDSLC()&&this.inverseDslcMapping){var u=this;var q=Object.keys(this.inverseDslcMapping);q.forEach(function(w){u.listenTo(u,"onChange:"+w,function(y,z,x){if(!x||!x.silent){y.dispatchEvent("onChange:"+this.inverseDslcMapping[w],arguments)}})})}if(!this.collection&&s.mask){this.mask=s.mask}if(this.isNew()){this.set("_skeletonId","temp:"+this.cid)}this.listenTo(this,"onChange",this._registerChangedAttributes);this.listenTo(this,"onChange:@href",this.onHRefChange);this.listenTo(this,"onChange:@id",this.onAtIdChange);this.listenTo(this,"onChange:rdf:type",this.onTypeChange);this.listenTo(this,"onChange:dsplan:actualType",this.onTypeChange);this.listenTo(this,"onChange:dsxplan:actualType",this.onTypeChange);this.listenTo(this,"onChange:dsxplan:jsType",this.onTypeChange);var v=c.getTypeCollection(this.constructor,{create:true});var r=f.clone(s,false);r.parse=false;if(r.fireTypeCollectionEvent){delete r.silent}if(v.get(this)){throw new Error("object existing try to get existing from rdfutils first!")}v&&v.add(this,r);if(!this.id){c.addObjectToMap(this.cid,this)}},url:function(t){var s;var r;if(this.isNew()){var u=this.collection.getUri({forNewObject:true});s=c.expandUrl(u);r=u.substr(0,"/resource".length)==="/resource"}else{s=c.expandUrl(this.get("@href"),"v1")}var q=t&&t.mask;if(!q){q=this.getMask();if(this.isNew()){if(r){q=this.parentMask||this.collection.getMask()}else{q=this.writeMask||q}}}return c.addQueryParam(s,"$mask",q)},_originalGet:function(){return e.prototype.get.apply(this,arguments)},get:function(r,q){var t=Array.prototype.slice.call(arguments,0);var s=r;if(!(q&&q.noDSLCMapping)&&this.isDSLC()&&this.dslcMapping){s=this.dslcMapping[s]||s}t[0]=s;if(s==="physicalId"){return this.id}return this._models[s]||this._collections[s]||this._parent.apply(this,t)},compactJson:function(){if(this.isNew()){return(this.toJSON({noSkeletonId:true,noEmptyCollection:true}))}var q={};q[this.idAttribute]=this.id;return q},parse:function(q,r){var v;if(!f.is(q,"object")){return{value:q}}var u=f.clone(q||{},false);if(q&&q["@href"]&&q["@href"].indexOf("/invoke/")===0){u=q.value}v=c.parseUrl(u["@href"]);c.handleContext(u);delete u["@context"];delete u["@code"];this.addMask(u["@mask"]);v.path&&(u["@href"]=v.path);if(!this.mask||c.compareMasks(this.getMask(),u["@mask"])<0){this.mask=u["@mask"]}var t=u["@mask"];t&&l.addMask(t);delete u["@mask"];var s=u["@id"];if(s){if(s.test(/[/?]/)){u._skeletonId=k.getCheckSum("_"+(s))}else{u._skeletonId=s}}if(u.image){u.image=c.getAssetUrl(u.image)}if(u["@id"]&&u["@id"]!==this.id){this.set("@id",u["@id"],{dontRegisterChange:true})}this._parseNestedModelsAndCollections(u,t,r);this._parsePruneModelsAndCollections(u,t,r);return u},_parseNestedModelsAndCollections:function(q,r){var t=q;var s=r;Object.keys(t).forEach(function(w){var y,A;y=t[w];if(j(y,"object")&&y["@id"]){if(y["@type"]==="Collection"){var u=true;var x;if(y.member&&y.member.length){x=y.member;u=!f.Array.detect(x,function(B){return !f.is(B,"string")})}if(u&&x){var z=f.clone(x,false);this.set(w,z,{dontRegisterChange:true});t[w]=z;l.addAttributeToMask(s,w,l.ARRAY_ATTR)}else{this.addNewCollectionData(w,y,{parse:true});if(y.member){l.addAttributeToMask(s,w,l.COLLECTION_ATTR)}}}else{A=this._models[w];if(A&&(A.id===y["@id"])){var v=A.parse(y);A.set(v,{dontRegisterChange:true,dontAdjustDates:true})}else{A=d.mergeOrCreateObject(y);this._models[w]=A}q[w]=A;s&&l.addAttributeToMask(s,w,l.MODEL_ATTR)}}},this)},_parsePruneModelsAndCollections:function m(F,u,t){var D=u;var q=F;if(D){var C=l.getMask(D);var y=Object.keys(C);var E=y.length;var w=function(I){return !I.isNew()};var s;var z=function(I){if(I.isNew()){s.push(I)}};for(var G=0;G<E;G++){var A=y[G];if(!q[A]){switch(C[A]){case l.COLLECTION_ATTR:var H=this.get(A,{noDSLCMapping:true});var v=f.clone(t||{},false);delete v.batchFetch;delete v.parse;v.dontRegisterChange=true;if(H){s=H._added.filter(w);H.forEach(z);var r=H.length;H.reset&&H.reset(s||[],v);if(r!==H.length){this._fireRelationshipChangeEvents(A,v);try{var B=this._attributes&&this._attributes[A];if(B){B.totalItems=H.length;B.member=H.pluck("@id").map(function(I){return{"@id":I}})}}catch(x){console.log(x)}}}break;case l.MODEL_ATTR:if(this._models[A]&&(!t||!t.silent)){this._fireRelationshipChangeEvents(A,t)}delete this._models[A];delete this._attributes[A];break;case l.STRING_ATTR:case l.ARRAY_ATTR:default:this.unset(A,{dontRegisterChange:true});break}}}}},removeObject:function(s,v,t){var r=s;if(this.isDSLC()&&this.dslcMapping){r=this.dslcMapping[r]||r}var q=this._collections[r];var u;if(q){if(f.is(v,"number")){u=q.at(v)}else{if(!(v instanceof e)){throw new Error("invalid object to remove "+v)}u=v}q.remove(v,t);this._fireRelationshipChangeEvents(r,t,t&&t.silentOnChange);if(t&&t.silent){this._registerChangedCollection(r,v,q,t);q._registerRemovedModel(v,q,t)}}else{u=this._models[r];if(u===v){this.unset(r,t);if(t&&t.silent){this._registerChangedAttributes()}}}},getMask:function(){return this.mask||(this.collection&&this.collection.getDetailsMask())},dataForRendering:function(r){var q=f.clone(r||{},false);q.dataForRendering=true;return this.toJSON(q)},_setDateAttribute:function(s,r,q){if(r instanceof Date){this.set(s,r.toISOString(),q)}else{if(f.is(r,"string")){this.set(s,r,q)}else{throw new Error(r+" is not a date object or a string. It was not saved for the model.")}}if(q&&q.silent){this._registerChangedAttributes()}},isOfType:function(q){var t=c.typeDictionary.typeMap;var s=this.get("dsxplan:jsType")||this.get("dsxplan:actualType")||this.get("dsplan:actualType");s=s.id||s;if(t&&s){var r=t[q];return r.key===s}return false},_fireRelationshipChangeEvents:function(t,s,r,u){if(!(s&&s.silent)){if(!u){this.dispatchEvent("onChange:"+t,[this,s]);if(s&&s.operation==="add"){this.dispatchEvent("onAdd:"+t,[this,s])}else{if(s&&s.operation==="remove"){this.dispatchEvent("onRemove:"+t,[this,s])}}}if(!r){var q=f.clone(s||{},false);q.relationshipChanged=t;this.dispatchEvent("onChange",[this,q])}}},addObjects:function(y,q,s,A){var t=q;if(this.isDSLC()&&this.dslcMapping){t=this.dslcMapping[q]||t}var x=[];var z=y.length;var u=this._collections[t];if(!u){u=this._createCollection(t,undefined,A)}for(var w=0;w<z;w++){var v=this.getObjectToBeAdded(y[w],A);x.push(u.add(v,A));if(A&&A.silent){u._registerAddedModel(v,u,A)}}if(x.length){var r;try{if(!this._changing){r=this._changed;this._changed={}}this._fireRelationshipChangeEvents(t,A,A&&A.silentOnChange);if(A&&A.silent){this._registerChangedCollection(t,u,A)}}finally{if(!this._changing){this._changed=r}}}return x},getObjectToBeAdded:function(s,u){var r;if(s instanceof d){r=s}else{if(f.is(s,"string")){r=c.getObjectById(s);if(!r){r=new d(c.createPlaceholder(s));r.fetch(u)}}else{if(s["@id"]&&s["@type"]){var t=f.clone(s,false);var q=c.getModelConstructor(s);t.mask=u.mask||q.prototype.mask||"dsplan:MVMask.Task.Basic";r=c.getObjectForAdding(q,s["@id"],t)}}}return r},addModelToAttributeWithCollection:function(u,t,s){var v=this._collections[u];var r=f.clone(s||{},false);var q;if(!v){r.parse=true;var w=this._jsonForCollectionForAttribute(u);if(t){w.member=[t]}v=this.addNewCollectionData(u,w,r);if(t){v.dispatchEvent("onAdd",[v.at(0),v])}q=v.first()}else{q=v.add(t,s)}return q},_jsonForCollectionForAttribute:function(r,q){return{"@href":this._computeCollectionId(r,q),"@id":this.get("@id")+"/"+r,"@type":"Collection","@mask":(q&&q.mask)||this.getMask()}},addNewCollectionData:function(y,r,z){var u=this._collections[y];if(u){var q=function(B,A){return B+"|"+A.id};var x=u.reduce(q,"");var w=u.state.totalRecords;u.update(r);var v=u.reduce(q,"");var t=u.state.totalRecords;if(v!==x||t!==w){this._fireRelationshipChangeEvents(y,z)}}else{var s=f.clone(z||{},false);s.parentModel=this;u=this._createCollection(y,r,s)}return u},_createCollection:function(y,q,z){var w=q;if(f.is(q,"array")){w=this._createCollection(y);w.member=q}var s=this.getCollectionConstructor(y);var r=f.clone(z||{},false);r["@href"]=this._computeCollectionId(y,r);var x=new s(w,r);var t=this.getPropertyInverse(y);if(t.name){for(var u=0;u<x.length;u++){var v=x.at(u);this._updateInverseProperty(y,v)}}this.setCollection(y,x);this.set(y,w,{dontRegisterChange:true});return x},getCollectionConstructor:function(q){var s=this.collectionConstructor;var t;if(this._relations){t=this._relations.detect(function(u){return u.key===q})}if(t){var r=t.relatedCollection;if(r){s=r}}return s},getChangedAttributesSinceLastSave:function(){return this._changedAttributesSinceLastSave?Object.keys(this._changedAttributesSinceLastSave):[]},_computeCollectionId:function(q){return this.get("@href")+"/"+q},onHRefChange:function(){var q=this;if(this._collections){Object.keys(this._collections).forEach(function(s){var t=q._collections[s];var r=q._computeCollectionId(s,{mask:t.getMask()});t.setUri(r)})}},onAtIdChange:function(){if(this.id){c.addObjectToMap(this.id,this)}else{c.addObjectToMap(this.cid,this)}var q=this.previousAttributes()["@id"];if(q){c.removeObjectFromMap(q)}else{if(this.id){c.removeObjectFromMap(this.cid)}}},setModel:function(w,r,z){var u=o.setHelper.apply(this,arguments);var x=f.clone(u.attrs||{},false);z=u.options;if(this.isDSLC()){if(x){x=this._mapDslcAttributes(x)}}var y=Object.keys(x);var s=y.length;for(var t=0;t<s;t++){var q=y[t];var v=x[q];if(this._models[q]!==v){this._previousAttributes||(this._previousAttributes=f.clone(this._attributes,false));this._previousAttributes[q]=this._models[q];this._models[q]=v}else{delete x[q]}}return a.prototype.set.call(this,x,z)},set:function(){var t=o.setHelper.apply(this,arguments);var s=f.clone(t.attrs||{},false);var r=t.options;if(this.isDSLC()){if(s){s=this._mapDslcAttributes(s)}}this._removeModelsForUndefinedValues(s);var q=this._setModelIfNeeded(s,r);return this._parent(s,r)&&q},_removeModelsForUndefinedValues:function(r){var q=Object.keys(r);for(var u=0;u<q.length;u++){var s=q[u];var t=r[s];if(t===undefined){delete this._models[s]}}},_setModelIfNeeded:function(x,z){var y=Object.keys(x);var r=y.length;var v={};var w=false;for(var s=0;s<r;s++){var q=y[s];var u=x[q];if(u instanceof d){v[q]=u;w=true}}var t=true;if(w){t=this.setModel(v,z)}return t},syncDelete:function(q){if((this.isVersion()&&this.isDSLC())||q.dslc){q.url=c.expandUrl(d.DELETE_ITEM_VERSION_URI);q.data=JSON.stringify([this.id]);q.method="POST";var r=q.onComplete;q.onComplete=function(u){var w=u.member;for(var v=0;v<w.length;v++){var s=w[v];var t=c.getObjectById(s);t&&t.destroy({noServer:true})}r.apply(this,arguments)}}this._handleDeleteFailure(q)},_handleDeleteFailure:function(t){var q=t.onFailure;var s=t.onComplete;this._collectionsRemovedFrom=[];var r=this;t.onFailure=function(){c.addObjectToMap(r.id,r);c.addObjectToMap(r.cid,r);r._collectionsRemovedFrom.forEach(function(u){u.add(r)});delete r._collectionsRemovedFrom;q&&q.apply(r,arguments)};t.onComplete=function(){delete r._collectionsRemovedFrom;s&&s.apply(r,arguments)}},onRemovedFromCollection:function(q){this._collectionsRemovedFrom&&this._collectionsRemovedFrom.push(q)},fetch:function(r){var q=f.clone(r||{},false);if(q.dontUpdateMask){q.url=this.url(r)}if(q.mask){if(q.onlyIfNeeded){if(this.hasDataForMask(q.mask)){q.onComplete&&q.onComplete();return{cancel:function(){}}}}}return this._parent(q)},isPropertyVolatile:function(r){var q=r==="@etag"||(this._propertyDictionary&&this._propertyDictionary[r]&&this._propertyDictionary[r].volatility);return q},getPropertyInverse:function(s){var q=this._propertyDictionary&&this._propertyDictionary[s]&&this._propertyDictionary[s].inverseProperty;var r=this._propertyDictionary&&this._propertyDictionary[s]&&this._propertyDictionary[s].inversePropertyIsCollection;return{name:q,isCollection:r}},getPropertyThisIsInverseOf:function(t){var r;if(this._propertyDictionary){var s=this;var q=Object.keys(this._propertyDictionary);q.some(function(u){if(s._propertyDictionary[u].inverseProperty===t){r=u}return r!==undefined})}return r},getParentPath:function(){return this.collection.getIdForCreateChildDSLC()},addMask:function(q){this._usedMasks=this._usedMasks||[];if(q){if(this._usedMasks.indexOf(q)===-1){this._usedMasks.push(q)}}},getMasks:function(){if(!this._usedMasks){this._usedMasks=[]}return this._usedMasks},hasDataForMask:function(q){return l.isSubMask(q,this.getMasks())},resetMasks:function(){this._usedMasks=[]},unset:function(q){var t=this._models[q];var s;if(t){s=this._previousAttributes[q];this._previousAttributes[q]=t;delete this._models[q]}var r=this._parent.apply(this,arguments);if(!r){this._models[q]=t;this._previousAttributes[q]=s}return r},getTagPrefix:function(){return""},getObjectType:h,getDragType:h,getTransferObject:function(s){var t=this.getDragType();var r=f.clone(s||{},false);var q=f.merge(r,{source:window.widget.getValue("appId")||"X3DCSMA_AP",envId:window.enoviaServer.tenant||window.widget.getValue("x3dPlatformId"),objectId:this.get("physicalId"),objectType:t,objectType_Internal:t,displayName:this.get("title"),serviceId:"3dplan",image:this.get("image")});return o.getTransferObject(q)},isVersion:function(){return false},hasChanged:function b(q){var r=q;if(this.isDSLC()&&this.dslcMapping){r=this.dslcMapping[q]||r}return this._parent(r)},hasFetchedAttribute:function(r){var q=this.isDSLC()&&(this.dslcMapping[r]||r);return this.getMasks().detect(function(s){var t=l.getMask(s);return t[q]})},processLiveUpdateCreation:function(t){var r=c.getObjectById(t["@parentId"]);if(!r){this.destroy({noServer:true});return}var s=r.getCollectionAttributeBasedOnModel(this);if(r.hasFetchedAttribute(s)){r.getCollectionAttribute(s).add(this,{dontRegisterChange:true});var q=this.liveUpdateCreateMask||"dsplan:MVMask.ScheduleElements.Basic";this.fetch({mask:q})}}};d=a.extend(d);d.RDF_TYPE="rdf:type";d.ACTUAL_TYPE_ATTR="dsplan:actualType";d.getObjectById=c.getObjectById;d.mergeOrCreateObject=function(s){var q=c.getModelConstructor(s);q=q||d;var r=c.getExistingAndMerge(s);r=r||new q(s,{parse:true,collectionConstructor:this.collectionConstructor});return r};Object.defineProperty(d.prototype,"tenant",{get:function(){return window.enoviaServer.tenant}});Object.defineProperty(d,"fakeEmptyCollection",{get:function(){var q=[];q.get=function(){};q.first=q.get;q.toArray=function(){return this};return q}});d.resetObjectMap=c.resetObjectMap;d.completingPropertyDefinition={get:function(){return this.fetching},set:function(q){if(q===false){this.fetching--;if(this.fetching<0){this.fetching=0;console.error("incorrect fetching count")}}else{this.fetching++}return this.fetching}};Object.defineProperty(d.prototype,"completing",d.completingPropertyDefinition);Object.defineProperty(d.prototype,"fedSearchIdQuery",{get:function(){if(this.id){return'uri:"'+c.shortToLongURI(this.id)+'"'}else{return undefined}}});d.MODIFY_ITEM_VERSION_URI="/invoke/dsxplan:modifyItemVersion";d.CREATE_ITEM_VERSION_URI="/invoke/dsxplan:createItemVersion";d.CLONE_ITEM_VERSION_URI="/invoke/dsxplan:cloneItemVersion";d.DELETE_ITEM_VERSION_URI="/invoke/dsxplan:deleteItemVersion";return d});define("DS/RDFFoundation/Models/ComponentProxyIndexModel",["UWA/Core","UWA/Class/Model","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil"],function(g,f,c,d,a){"use strict";var b=["ds6w:label","ds6w:type","type_icon_url","ds6w:docextension","preview_url"];var h={};b.forEach(function(l){h[l]=true});var i="ds6w:what/";var j=f.extend({_uwaClassName:"ComponentProxyIndexModel",idAttribute:"resourceid",defaults:{},init:function k(l,n){var m=Array.prototype.slice.call(arguments,0);if(l&&(l.results||l.attributes)&&!(n&&n.parse)){var q="";if(l.results){var o=l.results;if(o.length===1){q=o[0]}else{return this._parent.apply(this,m)}}this.collection=n&&n.collection;var p=this.parse(q);m[0]=p}return this._parent.apply(this,m)},sync:function(o,n,m){if(o!=="read"){throw new Error("component proxy index model don't support writing")}var l=g.clone(m||{},false);l.source=this.get("source");return j.requestFetch(n,l)},parse:function(n,t){var s={};if(n&&n.attributes){var o=n.attributes;var r=o.length;var p=(t&&t.selectPredicates)||h;for(var q=0;q<r;q++){var m=o[q];var l=m.name;if(l.substr(0,i.length)===i){l=l.substr(i.length)}if(p[l]){s[l]=m.value}}}return s}});j.prototype.dataForRendering=function(){return this.toJSON()};j.toBeFetched={};var e={cancel:function(){if(this.fetching){delete this._onComplete;delete this._onFailure}else{delete this.queue.toBeFetched[this.id]}},onComplete:function(){this._onComplete&&this._onComplete.apply(this,arguments)},onFailure:function(){this._onFailure&&this._onFailure.apply(this,arguments)}};j.TIMEOUT_LENGTH=97;j.idAttributeForFederatedSearch=function(l){var m="physicalid";if(l.source==="swym"){m="resourceid"}else{if(l.source==="geovia"){m="uri"}}return m};j.idAttributeForFederatedSearchResult="resourceid";j.selectPredicateArray=b;j.fetchProxies=function(){delete this.fetchTimeout;var n={idAttributeForFederatedSearch:this.idAttributeForFederatedSearch,selectPredicateArray:this.selectPredicateArray,idAttributeForFederatedSearchResult:this.idAttributeForFederatedSearchResult||this.idAttributeForFederatedSearch};var w=this.toBeFetched;this.toBeFetched={};var l=[];var v=Object.keys(w);var o=v.length;if(!o){return{cancel:function(){}}}var t=[];for(var q=0;q<o;q++){var m=v[q];var p=w[m];p.fetching=true;var u;if(g.is(n.idAttributeForFederatedSearch,"function")){u=n.idAttributeForFederatedSearch(p)}else{u=n.idAttributeForFederatedSearch}var s=u+':"'+m+'"';if(p.additionalQueryStatement){s="("+s+" AND "+p.additionalQueryStatement+")"}t.push(s);if(l.indexOf(p.source)===-1){l.push(p.source)}}t=t.join(" OR ");var r={query:t,numResults:o+10,sources:l,selectPredicateArray:this.selectPredicateArray,onComplete:function(D){var C=(g.is(D,"string")?JSON.parse(D):D);var I=C.results;var y;if(I){var J=I.length;var B=n.idAttributeForFederatedSearchResult.replace(/\[?([^\]]*)]?/,"$1");for(var M=0;M<J;M++){var A=I[M];var K=A.attributes;var H=K.length;for(var F=0;F<H;F++){var G=K[F];if(G.name===B){y=w[G.value];y&&y.onComplete(A);delete w[G.value];break}}}}var L=Object.keys(w);var z=L.length;for(var E=0;E<z;E++){var x=L[E];y=w[x];y&&y.onFailure("object not found")}},onFailure:function(z){var x=Object.keys(w);var B=x.length;for(var C=0;C<B;C++){var A=x[C];var y=w[A];y&&y.onFailure(z)}}};return a.sendRequest(r)};j.requestFetch=function(n,m){var l=g.clone(m||{},false);var p=l.queue||this;var o=p.toBeFetched[n.id];if(o){return o}o=Object.create(e);o.id=n.id;o.source=l.source||"3dspace";o._onComplete=l.onComplete;o._onFailure=l.onFailure;o.queue=p;o.additionalQueryStatement=l.additionalQueryStatement;p.toBeFetched[n.id]=o;if(!p.fetchTimeout){p.fetchTimeout=setTimeout(j.fetchProxies.bind(p),j.TIMEOUT_LENGTH)}return o};j.resetQueue=function(l){l.toBeFetched={};clearTimeout(l.fetchTimeout);delete l.fetchTimeout};return j});define("DS/RDFFoundation/Models/PersonRDFModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/ComponentProxyIndexModel"],function(f,d,c,h,i){var a=["ds6w:label","ds6w:type","type_icon_url","ds6w:docextension","preview_url","resourceid"];var e=require.toUrl("DS/XPlanApp/assets/img/defaultProfile.png");var g={};a.forEach(function(j){g[j]=true});var b=d.extend({_uwaClassName:"PersonRDFModel",parse:function(k){if(k&&k.attributes){var j=i.prototype.parse.call(this,k,{selectPredicates:g});j.physicalId=j.resourceid;return j}return this._parent.apply(this,arguments)},setup:function(){this.fetch();return this._parent.apply(this,arguments)},sync:function(q,m,l){var o=this;if(q!=="read"){return this._parent.apply(this,arguments)}var k=f.clone(l||{},false);k.queue=b;var j=this.id;var p=l.onComplete;k.onComplete=function(){o.completing=false;p&&p.apply(this,arguments);o.dispatchEvent("onFetchDone")};var n=l.onFailure;k.onFailure=function(){o.completing=false;n&&n.apply(this,arguments);o.dispatchEvent("onFetchDone")};k.additionalQueryStatement='[ds6w:type]:"pno:Person"';k.source="swym";if(!b.toBeFetched[j]){this.completing=true}return i.requestFetch({id:j},k)},get:function(k){var j=this.id&&c.splitUri(this.id)[1];switch(k){case"name":return this.get("dsplan:swymLogin")||this.id.replace("iam:","");case"image":return h.userPictureURL(j,"normal")||e;case"miniImage":return h.userPictureURL(j,"mini")||e;case"physicalId":return this._getPhysicalId();default:break}return this._parent.apply(this,arguments)},_getPhysicalId:function(){return this.id},toJSON:function(l){var k=l||{};var j=this._parent.apply(this,arguments);j.isRDF=true;j.firstname=this.get("firstname");j.lastname=this.get("lastname");j.physicalId=this.get("physicalId");j.name=this.get("name");j.image=this.get("image");if(!j.firstname&&!j.lastname&&(this.id==="dskern:Person.Guest"||this.id==="foaf:xPlanInfra"||this.id==="dskern:Person.Creator")){j.firstname=this.id.split(":")[1];j.fullName=j.firstname}else{j.fullName=j["ds6w:label"]||this.get("ds6w:label")}j.title=j.fullName;if(k.dataForRendering){j.type="pno:Person"}return j},getDragType:function(){return this.getObjectType()},getObjectType:function(){return"pno:Person"},getTransferObject:function(){return this._parent({objectId:this.get("physicalId"),displayName:this.fullName,serviceId:"3DSwym"})}});Object.defineProperty(b.prototype,"fullName",{get:function(){return this.get("ds6w:label")}});Object.defineProperty(b.prototype,"serviceHosting",{get:function(){return"3DSwym"}});Object.defineProperty(b.prototype,"physicalId",{get:function(){return this.get("physicalId")}});Object.defineProperty(b.prototype,"fedSearchIdQuery",{get:function(){return b.idAttributeForFederatedSearch+':"'+this.id+'"'}});b.toBeFetched={};b.idAttributeForFederatedSearch="resourceid";b.selectPredicateArray=a;return b});define("DS/RDFFoundation/Models/ComponentProxyModel",["UWA/Core","DS/RDFFoundation/Models/ComponentProxyIndexModel","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/Search","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(h,d,c,a,b,e){var g=function(i){return function(){var j=Array.prototype.slice.call(arguments,1);j[0]=this;return this.dispatchEvent("onChange"+(i?(":"+i):""),j)}};var f=c.extend({_uwaClassName:"ComponentProxyModel",writeMask:"dsplan:MVMask.ComponentProxy.Complex",setup:function(i,k){var j=h.clone(k||{},false);j.mask="dsplan:MVMask.ComponentProxy.Complex";var m=this._getProxyModelId(this.id);this.indexModel=new d({resourceid:m,tenant:this.get("dscom:Tenant"),source:this.sourceName});this.listenTo(this.indexModel,"onChange:ds6w:label",g("title"));this.listenTo(this.indexModel,"onChange:type_icon_url",g("image"));this.listenTo(this.indexModel,"onChange:ds6w:type",g("ds6w:type"));this.listenTo(this.indexModel,"onChange",g());var l=this;this.indexModel.fetch({onComplete:function(){},onFailure:function(o,n){if(n==="object not found"){l.indexModel._noAccess=true;l.dispatchEvent("onViewAccessChanged")}}});this._parent(i,j)},hasViewAccess:function(){return Boolean(this.forceAccess||this.indexModel&&!this.indexModel._noAccess)},_getProxyModelId:function(j){var i=("dscom:"+this.get("dscom:ServiceHosting")+"_").length;return decodeURI(j.substring(i))},get:function(j){var i=this._parent.apply(this,arguments);switch(j){case"title":return this.indexModel.get("ds6w:label")||i;case"physicalId":var k=this.indexModel.id||this._getProxyModelId(this.id);return k;case"image":return this.indexModel.get("preview_url")||this.indexModel.get("type_icon_url")||i;case"ds6w:type":case"type":return this["@type"]||this.indexModel.get("ds6w:type")||i;case"hasfiles":return this.get("type")==="Document"||(this.get("dscom:ServiceHosting")==="3DDrive"&&this.get("type")==="DriveFile");case"fileExtension":return this.indexModel.get("ds6w:docextension");default:}if(!i){i=this.indexModel&&this.indexModel.get(j)}return i},toJSON:function(j){var k=this._parent.apply(this,arguments);var i=k.error==="No Access"||!this.hasViewAccess()?e.get("E6WCommonUI.Error.NoAccess"):"";if(j&&j.dataForRendering){k.physicalId=this.get("physicalId");k.image=this.get("image");k.type=this.get("type");k.hasfiles=this.get("hasfiles");k.fileExtension=this.get("fileExtension");k.title=i+this.get("title")}else{k["ds6w:type"]=this.get("ds6w:type")}return k},syncCreate:function(j,m){m.noStringify=true;var k=this._parent.apply(this,arguments);var l="/invoke/dsxplan:createProxyModel";var i=this.writeMask||this.getMask();var o=i?"?$mask="+i:"";m.url=a.expandUrl(l+o);m.data=JSON.stringify([m.attrs]);m.method="POST";var n=m.onComplete;m.onComplete=function(r,q){var p=r;if(p["@href"]===l){p=p.value}return n.call(this,p,q)};return k},getParentPath:function(){return""},getTransferObject:function(){return this._parent({serviceId:this.serviceHosting,envId:this.tenant})},getObjectType:function(){return this.get("type")},getDragType:function(){return this.get("type")}});Object.defineProperty(f.prototype,"tenant",{get:function(){return this.get("dscom:Tenant")}});Object.defineProperty(f.prototype,"serviceHosting",{get:function(){return this.get("dscom:ServiceHosting")}});Object.defineProperty(f.prototype,"sourceName",{get:function(){return a.sourceFromService(this.serviceHosting)||""}});Object.defineProperty(f.prototype,"fedSearchIdQuery",{get:function(){if(b.isM1BasedSource(this.sourceName)){return this.get("physicalId")}else{if(this.sourceName==="geovia"){return'uri:"'+this.get("physicalId")+'"'}}return this.id}});f.computeURI=function(i){return"dscom:"+i.serviceId+"_"+encodeURI(i.id)};return f});define("DS/RDFFoundation/Models/DriveRepositoryProxyModel",["UWA/Core","DS/RDFFoundation/Models/ComponentProxyModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/PlatformManager"],function(g,f,a,c){var e="3DDrive";var b="dscom:"+e+"_";var d=f.extend({_uwaClassName:"DriveRepositoryProxyModel",init:function(h){var i=h&&h["@id"];if(i){h["dscom:ServiceHosting"]=e;h["dscom:Tenant"]=c.getTenant();a.addObjectToMap(b+i,this)}return this._parent.apply(this,arguments)},compactJson:function(){return this.id}});d.ID_PREFIX=b;return d});define("DS/RDFFoundation/Models/CategoryModel",["UWA/Core","UWA/Utils","UWA/Class/Model","DS/RDFFoundation/RDFUtils"],function(e,c,d,b){var a={_uwaClassName:"CategoryModel",defaults:{title:"",subtitle:""},_image:function(){var f;f=this.get("thumbnail");if(f){f=b.getAssetUrl(f)}return f},"onChange:thumbnail":function(){this.set("image",this._image())},parse:function(g){var i;i=b.parseUrl(g["@href"]);var f=i.path.match(/(?:\/resources\/|\/classes\/|\/invoke\/)(.*)/);g["@id"]=(f&&f[1])||g["@id"];if(!g.mask){var h=g["@mask"]||i.mask;h&&(g.mask=h)}g.where=i.where&&i.where;return g}};return d.extend(a)});define("DS/RDFFoundation/Models/RDFCloneModel",["UWA/Core","DS/E6WCommonUI/Models/CloneModel","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/ComponentProxyModel","DS/RDFFoundation/Models/PersonRDFModel","DS/E6WCommonUI/Models/DropValidator","DS/RDFFoundation/FederatedSearchUtil"],function(i,c,h,g,n,p,f,d,a){var k=c.extend({getObjectToBeAdded:function(u,x,t){var v;if(t.dropObj||t.detailedObject){v=n.getObjectDataFromDropSearchOrTypeAhead(t)}else{return g.getObjectById(x)}var r=v.type==="Person"||v.type==="pno:Person"||v.type==="People";if(r&&v.serviceId==="3DSpace"){this._findAndAddSwymPersonFrom3DSpaceId(v.id,u);return undefined}var w=g.getObjectById(v.id);var q,s;if(w){return w}else{if(v.serviceId!=="3dplan"){if(!r){v.id=p.computeURI(v);return k.getNewProxyModel(v)}else{q=f;s="dskern:MVMask.Person.Complex"}}else{q=g.getModelConstructor({"@type":v.type});s="dsplan:MVMask.Task.Basic"}}return g.getObjectForAdding(q,v.id,{mask:s})},_findAndAddSwymPersonFrom3DSpaceId:function(s,r){var q=this;this._swymPersonFetchCount++;a.sendRequest({selectPredicateArray:["name"],sources:["3dspace"],query:'physicalid:"'+s+'"',numResults:1,onComplete:function(v){var t=v.results[0].attributes;for(var u=0;u<t.length;u++){if(t[u].name==="name"){var w=q.addIndividualObjectAsModel(r,g.getObjectForAdding(f,"iam:"+t[u].value,{mask:"dskern:MVMask.Person.Complex"}));q._swymPersonFetchCount--;if(w.changedModificationPending){q.dispatchEvent("onChange:modificationsPending",[this]);q._fireRelationshipChangeEvents(r,{operation:"add",added:w.ret})}}}},onFailure:function(){q._swymPersonFetchCount--}})},buildBatchWithPreprocessedObjects:function(w){var x;var q=Object.keys(w);if(q.length){var t=this._options.onFailure;x=g.getBatchGenerator();for(var u=0;u<q.length;u++){var s=q[u];for(var r=0;r<w[s].length;r++){var v=w[s][r];if(v instanceof p===false){continue}delete v.collection;v.save(undefined,{ajax:x.ajax,newTransaction:true,onFailure:t})}}}return x},_isWaitingForSwymPersonFetch:function(){return this._swymPersonFetchCount&&this._swymPersonFetchCount!==0},save:function(s){if(this._isWaitingForSwymPersonFetch()){this.listenToOnce(this,"allSwymPersonsFetched",this.save.bind(this,s));return}var q=this._filterProxyObjectsFromLocalAttributesAndLocalRelatedData();var u=this.buildBatchWithPreprocessedObjects(q.proxyAttributes);var r=i.clone(s||{},false);if(u){r.changed=true;r.ajax=u.ajax;r.newTransaction=true;var t=r.onComplete;delete r.onComplete;this._saveSingleObjectOnlyFiles(r);this._parent(r);r=i.clone(r||{},false);r.onComplete=t;delete r.ajax;u.sendBatch(r)}else{this._saveSingleObjectOnlyFiles(r);this._parent(r)}},_saveSingleObjectOnlyFiles:function o(s){var t=this;var r=i.clone(s||{},false);var q=Object.keys(this.localAttributes);r.singleObjectOnly=true;q.forEach(function(v){var u=t.localAttributes[v];if(u&&u.operation==="single"){if(u.input instanceof window.File||u.input.FileName){t._addFile(v,u,r)}}})},_modelSave:function b(q){if(this._shouldWaitForSave()){this.model.set(q)}else{this._parent.apply(this,arguments)}},_shouldWaitForSave:function e(){return this.model&&this.model.isUploadingFiles&&this.model.isUploadingFiles()},_validateDroppedObject:function(r,q){var s=d.validateDroppedObject(r,q);if(s){n.displayError(s)}return s},_filterProxyObjectsFromLocalAttributesAndLocalRelatedData:function(){var q=Object.keys(this.localRelatedData);var t={};var r={};var s=this;q.forEach(function(w){var u=s.localRelatedData[w];for(var v=0;v<u.length>0;v++){var y;var x=u[v].value;if(x instanceof p){if(u[v].operation==="add"){y=t[w]||[];y.push(x);t[w]=y}}else{y=r[w]||[];y.push(u[v]);r[w]=y}}});q=Object.keys(this.localAttributes);q.forEach(function(v){var u=s.localAttributes[v];if(u instanceof p){t[v]=[u]}});return{proxyAttributes:t,nonProxyAttributes:r}},onFileUploadFailure:function l(q){this._parent.apply(this,arguments);this._saveIfNotWaitingForAsync(q)},onFileUploadComplete:function j(r,q){var t={id:q.id,title:q.title||q.dataelements.title,serviceId:q.serviceId||"3DSpace",tenant:window.enoviaServer.tenant,image:q.image||q.dataelements.image};var s=k.getNewProxyModel(t);s.forceAccess=true;if(r.singleObjectOnly){this._replaceObjectOnAttributeWithSingleModel(r.fieldName,s,r)}else{this.addIndividualObjectAsModel(r.fieldName,s)}s["@type"]=q.type;this._saveIfNotWaitingForAsync(r)},_saveIfNotWaitingForAsync:function(q){if(!this._shouldWaitForSave()){this.save(q)}},set:function(w,v,u){var t=i.clone(u||{},false);var s,r;var q=t.config&&t.config.singleObjectOnly;if(v.actualValue){v=v.actualValue}if(u&&u.isObject){t=i.clone(u||{},false);t.detailedObject=t.detailedObjects&&t.detailedObjects[0];v=this.getObjectToBeAdded(w,v,t)}if(q&&v instanceof FileList){s=v[0];r=new c.FileValue(s,t);v={operation:"single",input:s,value:r,isThumbnail:t&&t.config&&t.config.isThumbnail,dataForRendering:function(){return(this.value.toJSON())},get:function(x){return(this.value.get(x))}};Object.assign(v,v.dataForRendering())}return this._parent(w,v,u)},add:function(w,u,t){var s;var r=i.clone(t||{},false);var q=r.singleObjectOnly||(r.config&&r.config.singleObjectOnly);var v=this.get(w);if(v instanceof i.Class.Model||q){s=this._replaceObjectOnAttributeWithSingleModel.apply(this,arguments)}else{s=this._parent.apply(this,arguments)}return s},_replaceObjectOnAttributeWithSingleModel:function(v,t,s){var r=i.clone(s||{},false);r.isObject=!(t instanceof i.Class.Model)&&!(t instanceof FileList)&&!(t instanceof File);var q=!i.is(t,"string")?[t]:undefined;if(this.get(v)){this.remove(v,0,s);delete this.localRelatedData[v]}else{var u=this.localRelatedData[v];if(u&&u.length===1&&u[0].operation==="remove"){delete this.localRelatedData[v]}}this.set(v,t,r);return(q)},preprocessPersonObject:function(q){if(q.objectType==="pno:Person"){q.objectId="iam:"+g.splitUri(q.objectId)[1]}}});k.getNewProxyModel=function(q){var s="dscom:"+q.serviceId+"_";var t=q.id;if(q.id.indexOf(s)!==0){t=p.computeURI(q)}var r=g.getObjectForAdding(p,t,{attrs:{title:q.title,image:q.image,"dscom:ServiceHosting":q.serviceId,"dscom:Tenant":q.tenant,type:q.type,"@type":"dscom:ComponentProxy"}});r.forcedNew=true;return r};var m=0;Object.defineProperty(k.prototype,"_swymPersonFetchCount",{get:function(){return m},set:function(q){m=q;if(m===0){this.dispatchEvent("allSwymPersonsFetched")}}});return k});define("DS/RDFFoundation/Collections/CollectionTaggerHelper",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","DS/TagNavigatorProxy/TagNavigatorProxy"],function(g,a,f,e){var d=100;var b={federatedTaggerServiceRequest:function(l){if(this.length===0){return}var m=b.TAG_QUERY_MAX_LENGTH;var j=this.length/m;for(var k=0;k<j;k++){var n=(m*k);var h=m*(k+1);this._formQueryAndSendTaggerRequest(n,h,l)}},_formQueryAndSendTaggerRequest:function(o,m,j){var k=this;var l,n;m=Math.min(m,this.length);for(var h=o;h<m;h++){n=this.at(h).fedSearchIdQuery;if(!n){continue}if(l){l+=" OR "+n}else{l=n}}if(l){f.sendRequest({sources:["3dplan"],withSynthesisAttribute:true,query:l,numResults:m-o,onComplete:function(i){var p=i?i.results:[];k.convertTagDataToTnProxyFormat(p);j.onComplete&&j.onComplete()},onFailure:function(){j.onFailure&&j.onFailure()}})}},convertTagDataToTnProxyFormat:function(m){if(m&&m.length>0){var k=m.length;for(var h=0;h<k;h++){var i=this.getModelAndProcessedTaggerDataAttributes(m[h].attributes);var n=i.id;var l=i.tags;var j=this.get(n);if(!j){continue}j.tagsData=l}}},getModelAndProcessedTaggerDataAttributes:function(i){var k=[];var n;var l=i.length;for(var j=0;j<l;j++){var h=i[j];if(h.format==="ds6w_facet"){var m=h.value;if(h.type==="date"){m=this.getFormatedTagDate(m)}k.push({object:m,sixw:h.name,field:h.field,type:h.type})}else{if(h.name==="resourceid"){n=h.value}}}return{id:n,tags:k}},fetchModelAndAddTaggerData:function(s,o){var i=g.clone(o||{},false);var n=s.results;var j=[];if(n&&n.length>0){var r=n.length;if(!i.dontUpdateTaggerSummaryData){this.tagsSummaryData=s.facets}var k=[];for(var p=0;p<r;p++){var h=this.getModelAndProcessedTaggerDataAttributes(n[p].attributes);var q=h.id;var m=h.tags;var l=a.getObjectForAdding(i.ModelConstructor,q,i.attrs);j.push(q);k.push(l);l.tagsData=m}if(i.reset){this.reset(k)}else{this.add(k)}i.onlyIfNeeded=true;a.complete(i.ModelConstructor,j,i)}},getFormatedTagDate:function(k){var j=new Date(k);var o=j.getFullYear();var i=j.getMonth()+1;var n=j.getDate();var l=i<10?"0"+i:i;var h=n<10?"0"+n:n;return String(o)+"/"+l+"/"+h},federatedSearchAdvanceQueryRequest:function(h){var i=this;f.sendRequest({label:"3dplan-"+h.labelPrefix+window.enoviaServer.user+"-"+Date.now(),sources:["3dplan"],withSynthesis:true,withSynthesisAttribute:true,query:h.query,numResults:h.limit,refine:h.refineParam,order_field:"ds6w:modified",order_by:"desc",onComplete:function(j){h.onComplete&&h.onComplete(j)},onFailure:function(){if(i.checkSearchFailure(arguments)){h.onComplete&&h.onComplete({searchFailure:true})}else{h.onFailure&&h.onFailure()}}})},checkSearchFailure:function(h){var j=h[0].message;var i=h[1].error;if(j.indexOf("500")!==-1&&i.errorCode==="FS_GENERIC_ERROR"&&i.errorMessage==="Unknown source: 3dplan"){return true}return false},getTaggerData:function(){var h={};this.forEach(function(i){h[i.id]=i.tagsData||[]});return h},getFilterOnServerTaggerData:function(j){var i={tagsData:{},summaryData:[]};if(j){var h=this.get(j);i.tagsData[h.id]=h.tagsData||[]}else{this.forEach(function(k){i.tagsData[k.id]=k.tagsData||[]})}i.summaryData=this.tagsSummaryData||[];return i},getTNProxy:function(){var i=this.tnProxy;if(i){return i}else{var h={widgetId:window.enoviaServer.widgetId,filteringMode:e.filteringMode.FilteringOnServer,tenant:window.enoviaServer.tenant};i=e.createProxy(h);this.tnProxy=i;return i}},setTNProxy:function c(h){this.tnProxy=h}};b.TAG_QUERY_MAX_LENGTH=d;return b});define("DS/RDFFoundation/SecurityContextUtils",["UWA/Core","DS/Foundation/WidgetAPIs","DS/RDFFoundation/Models/DriveRepositoryProxyModel","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(h,a,c,b){var f="dsxplan:hasContentRepository";var d={};d.getDefaultSecurityContext=function(){var i;if(window.enoviaServer.space){return window.enoviaServer.space}var j=d.getSecurityContexts();if(j&&j.length){i=j[0].actualValue;j.some(function(k){if(k.isDefault){i=k.actualValue;return true}return false})}return i};d.getDefaultCollabSpace=function(){var i;var j=d.getSecurityContexts();j&&j.some(function(k){if(k.isDefault){i=k.displayValue;return true}return false});return i};d.getSecurityContexts=function(){return window.enoviaServer.securityContextsData};d.processSecurityContextData=function(i){var j=[];i.forEach(function(l){var m=l.name;var k=l.csName;j.push({actualValue:m,displayValue:k,isDefault:l.isDefault})});window.enoviaServer.securityContextsData=j};d.initSecurityContexts=function(){a.getSecurityContexts(d.processSecurityContextData)};d.getContentRepositories=function e(i){var k=[];var l=d.getSecurityContexts();if(l){k=d.getUsersContentRepositories();var j=i.get(f);j=h.is(j,"array")?j[0]:j;if(j&&!(j instanceof c)&&!d.hasAccessToContentRepository(j.id)){k.push({actualValue:i.get(f),displayValue:b.get("E6WCommonUI.Error.NoAccess")+i.get(f)})}}return k};d.getUsersContentRepositories=function(){var k=d.getSecurityContexts();var j=[];var i=Object.create(null);if(k){k.forEach(function(m){var l=m.displayValue;if(l&&!i[l]){j.push({actualValue:l,displayValue:l});i[l]=true}})}return j};d.hasAccessToContentRepository=function(i){return d.getUsersContentRepositories().some(function(j){return j.displayValue===i})};d.getContentRepositoryValuesForDetailDisplay=function g(j){var i=d.getContentRepositories.bind(undefined,j);h.merge(i,h.Class.Events.prototype);h.merge(i,h.Class.Listener.prototype);i.listenTo(j,"onChange:"+f,function(){i.dispatchEvent("onChange")});return i};return d});define("DS/RDFFoundation/Collections/ResultCollection",["UWA/Core","UWA/Utils","UWA/Class/Collection","UWA/Class/Model","DS/WebAppsFoundations/Collections/PageableCollection","DS/RDFFoundation/RDFUtils","DS/PlatformAPI/PlatformAPI","DS/RDFFoundation/Models/CategoryModel","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Collections/CollectionTaggerHelper"],function(d,h,e,c,g,a,j,f,b,i){var k={_uwaClassName:"ResultCollection",getId:function(){return this._modelKey.get("@id")},_syncSetQueue:Function.prototype,getTotalRecords:function(){var l=this.length;if(this.state){if((typeof this.state.totalRecords)!=="undefined"){l=this.state.totalRecords+this._added.length-this._removed.length;l+=this._unregisteredModelsAdded.length-this._unregisteredModelsRemoved.length}}return l},hasMoreItems:function(){return this.moreItems||this.length!==this.getTotalRecords()},defaultOptions:{mode:"data",state:{pageSize:20},queryParams:{pageSize:"$top",sortKey:"$orderby",directions:{"1":"desc","-1":"asc"}}},dataForRendering:function(l){var p=[];var o=this.length;for(var m=0;m<o;m++){var n=this.at(m);if(n){p.push(n.dataForRendering(l))}}return(p)},name:"rdf-result-collection",sync:function(){return b.prototype.sync.apply(this,arguments)},reset:function(m,l){if(l&&l.forceReplaceOnSave){this._replaceOnSave=true}return this._parent.apply(this,arguments)},init:function(){this.fetching=0;this._parent.apply(this,arguments)},setup:function(o,l){var m;l=l||{};this._defaultModel=l.defaultModel;m=l._modelKey;if(d.is(m)){this._modelKey=m}else{var n=(o&&o["@mask"])||l["@mask"];this._modelKey=new f({"@href":(o&&o["@href"])||l["@href"],"@id":(o&&o["@id"])||l["@id"],"@mask":n,mask:n,detailsMask:l.detailsMask},{parse:true})}this.resetFlags();this.initialized=Boolean(o&&o.member);this.listenTo(this,{onAdd:this._registerAddedModel,onRemove:this._registerRemovedModel,onReset:this._registerResetModels});this.listenTo(this,{onReplace:this._replaceModel});this._unregisteredModelsRemoved=[];this._unregisteredModelsAdded=[]},_replaceModel:function(n,m){var l=this.indexOf(n);if(l!==-1){this.remove(n);this.add(m,{at:l})}},removeAddedModel:function(l){var n=this._added.indexOf(l);var m;if(n!==-1){this._added.splice(n,1);m=l}return m},_registerAddedModel:function(m,p,l){if(!(l&&(l.parse||l.fromServer||l.dontRegisterChange))){var n=this._removed.indexOf(m);if(n!==-1){this._removed.splice(n,1)}else{var o=this._added.indexOf(m);if(o===-1){this._added.push(m)}}}else{if(l&&l.dontRegisterChange){this.addUnregisteredModel(m)}}},_registerRemovedModel:function(n,p,m){if(!(m&&(m.parse||m.fromServer||m.dontRegisterChange))){var l=this.removeAddedModel(n);if(!l){var o=this._removed.indexOf(n);if(o===-1){this._removed.push(n)}}}else{if(m&&m.dontRegisterChange){this.removeUnregisteredModel(n)}}},_registerResetModels:function(o,l){if(!(l&&(l.parse||l.fromServer||l.dontRegisterChange))){var n=l.previousModels;var m=this;n.forEach(function(p){m._registerRemovedModel(p,m,l)});this.forEach(function(p){m._registerAddedModel(p,m,l)})}},destroy:function(){this.stopListening();this._parent.apply(this,arguments);this.removeEvents()},set:function(p,l){var m=p;if((l&&(l.parse||l.fromServer))){var n=this.filter(function(q){return q.isNew()});var o;if(l.parse){a.handleContext(m);o=m.member}else{if(d.is(m.member,"array")){o=m}else{m=o=[m]}}o&&o.push.apply(o,n)}return this._parent(m,l)},fetch:function(u){var l,t,n,m;var q={cancel:function(){}};if(u&&u.dontFetch){return q}n=d.clone(u,false)||{};var s=n.idsToOpen;var o=!s||n.collectionAndIds;var r=o&&s&&s.length>0;var p=n.onComplete;n.onComplete=function(){!r&&p&&p.apply(this,arguments);r=false};if(s&&s.length){this.fetchModelsById(s,n);n.newTransaction=true}if(o){l=this._checkState(this.state);t=this.queryParams;m=this.getLink(n.to);if(!m){m=this.url();if(n.to==="first"&&l.pageSize){m=a.addQueryParam(m,t.pageSize,l.pageSize)}if(l.sortKey){m=a.addQueryParam(m,t.sortKey,l.sortKey+" "+t.directions[l.order],true)}}n.url=m;if(n.url.indexOf("/v0/invoke/")!==-1){n.method="POST"}n.remove=false;return e.prototype.fetch.call(this,n)}return q},fetchModelsById:function(q,n){var p=this;var m=d.clone(n||{},false);m.mask=m.mask||this.getDetailsMask();var r=q.filter(function(s){return !p.get(s)}).map(function(s){return b.getObjectById(s)||a.createPlaceholder(s,undefined,undefined,{forceDslc:true})});var o=n&&n.onFailure;this.add(r);var l=function(s){if(s instanceof d.Class.Model){p.remove(s)}else{var t=[];r.forEach(function(u){if(u instanceof d.Class.Model){t.push(u)}else{t.push(a.getObjectById(u["@id"]))}});p.remove(t)}d.is(o,"function")&&o.apply(undefined,arguments)};m.onFailure=l;a.complete(this.model,q,m)},getPage:function(m,l){l=l||{};l.to=m;return this.fetch(l)},sortBy:function(l,m){if(d.is(m,"string")){m=m.toLowerCase();if(m==="asc"){m=-1}else{if(m==="desc"){m=1}}}else{m=m||-1}if(m!==1&&m!==-1){throw new Error("direction should be 1, -1, asc or desc")}this.state.sortKey=l;this.state.order=m;this.links={};this.reset()},url:function(){var l=a.expandUrl(this.getUri());return a.addQueryParams(l,[{name:"$mask",value:this.getMask()},{name:"$where",value:this.getWhere(),encode:true}])},getLink:function(m){var l=this.links[m];if(l){l=a.expandUrl(l)}return l},getWhere:function(){return this._modelKey.get("where")},getMask:function(){return this._modelKey.get("mask")},getDetailsMask:function(){return this._modelKey.get("detailsMask")||this.getMask()},setDetailsMask:function(l){return this._modelKey.set("detailsMask",l)},getUri:function(){return this._modelKey.get("@href")},setUri:function(l){this._modelKey.set(f.prototype.parse({"@href":l}))},parseRecords:function(l){this.setUri(l["@href"]);return l.member||(l.value&&[l.value])},update:function(o){if(!o.member){this.setUri(o["@id"])}if(o.member){var n={};var l=o.member;var r=l.length;for(var m=0;m<r;m++){var q=l[m];n[q["@id"]]=q}var p=this.filter(function(s){return !s.isNew()&&!n[s.id]&&!s.keepWhenUpdating});this.remove(p);this.add(o,{parse:true,merge:true})}else{this.parse(o,{})}},parseResponseForStateUpdate:function(p,n,o){var m,l;l=p.view;if(l){m=this.links;m.first=l.first;m.prev=l.previous;m.next=l.next;m.last=l.last;m.current=l["@id"]}if(d.is(p.totalItems)){o.totalRecords=p.totalItems;delete this.moreItems}else{this.moreItems=p.moreItems}this._unregisteredModelsRemoved=[];this._unregisteredModelsAdded=[];return o},hasNextPage:function(){return !(this.links.current&&!this.links.next)},compactJson:function(){return this.reduce(function(l,m){if(!m._deleted){l.push(m.compactJson())}return l},[])},resetFlags:function(){this._added=[];this._removed=[]},model:function(o,n){var l=a.getModelConstructor(o,n)||(n&&n._defaultModel)||(n&&n.collection&&n.collection._defaultModel)||b;var m=a.getExistingAndMerge(o,n);if(m){m.collection=m.collection||(n&&n.collection);return m}return new l(o,n)},add:function(r,n){var m=d.clone(n||{},false);m.fireTypeCollectionEvent=!m.silent;m.silent=true;if(n&&n.merge){return this._parent(r,n)}var q=[];var p=this;var l=function(s){var u;if(s instanceof b){u=s}else{var t;if(p.model===k.prototype.model){t=b.prototype.idAttribute}else{t=p.model.prototype.idAttribute}u=s[t]}if(u&&!p.get(u)){q.push(u)}};if(r){if(d.is(r.forEach,"function")){r.forEach(l)}else{l(r)}}var o=this._parent(r,m);if(!n||!n.silent){if(o&&d.is(o.forEach,"function")){o.forEach(function(s){if(!s.id){q.push(s)}})}else{if(o&&!o.id&&q.indexOf(o)===-1){q.push(o)}}q.forEach(function(t){var s=p.get(t);p.dispatchEvent("onAdd",[s,p,n])})}return o},getIdForCreateChildDSLC:function(){var l=this.getUri();if(l.indexOf("/resources")===0){return this.getId()}else{return""}},_prepareModel:function(l){if(!(l instanceof c)){var m;m=a.getExistingAndMerge(l);if(m){var n=Array.prototype.slice.call(arguments,0);n[0]=m;return this._parent.apply(this,n)}}return this._parent.apply(this,arguments)},getTenant:function(){return window.enoviaServer.tenant||"OnPremise"},removeUnregisteredModel:function(l){if(this._unregisteredModelsRemoved.indexOf(l)===-1){this._unregisteredModelsRemoved.push(l)}},addUnregisteredModel:function(l){if(this._unregisteredModelsAdded.indexOf(l)===-1){this._unregisteredModelsAdded.push(l)}if(this._unregisteredModelsRemoved.indexOf(l)!==-1){var m=this._unregisteredModelsRemoved.indexOf(l);this._unregisteredModelsRemoved.splice(m,1)}},remove:function(n){n=Array.isArray(n)?n:[n];for(var m=0;m<n.length;m++){var l=n[m];if(l.destroying){l.onRemovedFromCollection(this)}}this._parent.apply(this,arguments)}};k.model.prototype.idAttribute=b.prototype.idAttribute;k=g.extend(k);k.implement(i);Object.defineProperty(k.prototype,"totalRecords",{get:k.prototype.getTotalRecords});Object.defineProperty(k.prototype,"completing",b.completingPropertyDefinition);a.ResultCollection=k;return k});define("DS/RDFFoundation/Collections/PersonCollection",["UWA/Core","UWA/Class/Events","UWA/Class/Listener","UWA/Class","UWA/Class/Collection","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/Models/PersonRDFModel"],function(h,b,g,c,f,e,d){var a=e.extend({_uwaClassName:"PersonCollection",model:d});return a});define("DS/RDFFoundation/Models/CollabspaceRepositoryModel",["UWA/Core","DS/RDFFoundation/SecurityContextUtils","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ResultModel","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(f,e,a,b,d){var c=b.extend({_uwaClassName:"CollabspaceRepositoryModel",idAttribute:"@id",get:function(h){var g=this._parent.apply(this,arguments);switch(h){case"physicalId":return this.id;case"image":return require.toUrl("W3DDrive/assets/Collab_Space_icon.png");case"title":if(!e.hasAccessToContentRepository(this.id)){return d.get("E6WCommonUI.Error.NoAccess")+this.id}return this.id;default:}return g},toJSON:function(){var g=this._parent.apply(this,arguments);g.title=this.get("title");g.image=this.get("image");return g},compactJson:function(){return this.id}});return c});define("DS/RDFFoundation/Models/CloneModelForRepository",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/RDFCloneModel","DS/RDFFoundation/Models/CollabspaceRepositoryModel","DS/RDFFoundation/Models/DriveRepositoryProxyModel"],function(g,a,b,d,c){var e="dsxplan:hasContentRepository";var f=b.extend({_uwaClassName:"CloneModelForRepository",save:function(i){var j=this.getUploadRepositoryIdAsOptionsObject();var h=g.clone(i||{},false);g.merge(h,j);this._parent(h)},dataForRendering:function(i){var k=this._parent.apply(this,arguments);var j=i&&i.attributes;if(!j||(j&&j.indexOf(e)!==-1)){var h=this.get(e);if(h){k[e]=h.toJSON({dataForRendering:true})}}else{delete k[e]}return k},getUploadRepositoryIdAsOptionsObject:function(){var j={};var i=this.get(e);if(i){var h=i.id;h.startsWith(c.ID_PREFIX)?j.driveFolderProxyId=h:j.collabspaceId=h}return j}});return f});