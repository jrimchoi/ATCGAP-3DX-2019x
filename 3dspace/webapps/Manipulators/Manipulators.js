define("DS/Manipulators/Manipulator",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Visualization/PathElement","DS/CoreEvents/ModelEvents","DS/VisuEvents/ScreenEvent"],function(a,h,e,f,d,g){var j=0;var i=0;var c=a.extend({init:function(k){this.viewer=k;this._uid=j++;this.active=true;this.hasPriority=false;this._pickingPriority=true;this._pickingInManip=false;this._selectionAllowed=false;this._prePickingDuringManip=true;this._preActivationDuringManip=true;this._pickingDuringManip=true;this._checkManipsWhenEnabled=false;this.links={};this.manipulatedPaths=[];this.preactivated={path:null,node:null};this._modelEvent=new d();return this},enable:function(){this.active=true},disable:function(){this.active=false},setExclusive:function(k){this.hasPriority=k},getPriority:function(){return this.hasPriority},getPickingPriority:function(){return this._pickingPriority},setPickingPriority:function(k){this._pickingPriority=k},setPickingInManipulation:function(k){console.log("setPickingInManipulation is DEPRECATED.");this._pickingInManip=k},getPickingInManipulation:function(){return this._pickingInManip},setSelectionAllowed:function(k){this._selectionAllowed=k},getSelectionAllowed:function(){return this._selectionAllowed},setPrePickingDuringManipulation:function(k){this._prePickingDuringManip=k},getPrePickingDuringManipulation:function(){return this._prePickingDuringManip},setPreActivationDuringManipulation:function(k){this._preActivationDuringManip=k},getPreActivationDuringManipulation:function(){return this._preActivationDuringManip},setPickingDuringManipulation:function(k){this._pickingDuringManip=k},getPickingDuringManipulation:function(){return this._pickingDuringManip},checkManipulatorsOnCreation:function(k){this._checkManipsWhenEnabled=k},getUID:function(){return this._uid},linkToNode:function(l){if(l.setIsManipulator){l.setIsManipulator(true)}else{l.isManipulator=true}var k=this._buildLink({node:l});this.activate(k);return k},linkToPath:function(l){l.getLastElement().setIsManipulator(true);var k=this._buildLink({path:l});this.activate(k);return k},_linkToViewer:function(){var k=this._buildLink({viewer:this.viewer});this.activate(k);return k},_buildLink:function(l){var k=i++;this.links[k]={path:l.path,node:l.node,viewer:l.viewer,states:{manipulateState:c.State.NONE,preActivateState:c.State.NONE}};return k},unlink:function(k){if(this.links[k]){var l=this.links[k];if(l.node){if(l.node.setIsManipulator){l.node.setIsManipulator(false)}else{l.node.isManipulator=false}}else{if(l.path){l.path.getLastElement().setIsManipulator(false)}}if(this.deactivate(k)){delete this.links[k];return true}}return false},activate:function(m){if(m===undefined){return false}var v=this.links[m];if(!v){return false}if(v.viewer){v.viewer._addManipulator(this,m)}else{var n=v.node?v.node:v.path;var l=[];var p={};if(n instanceof f){l=n._getRenderableOccurrences()}else{for(var r=0;r<n._occurrences.length;r++){var u=n._occurrences[r]._getRenderableOccurrences();for(var q=0;q<u.length;q++){l.push(u[q])}}}for(var t=0;t<l.length;t++){var o=l[t];if(o._manipulators===undefined){o._manipulators={}}o._manipulators[m]=this;var x=o._occurrence;if(x&&x.scene3js&&x.scene3js.viewer&&x.scene3js.viewer.manipulatorManager){p[x.scene3js.viewer.id]=x.scene3js.viewer}}if(this._checkManipsWhenEnabled&&(v.states.manipulateState===c.State.NONE)){for(var k in p){var s=p[k];var w=THREEDS.VisuEventsManager.getMouseEvents(-1,s.canvas);if(!w.length){continue}s.manipulatorManager._onMove({from:[w[0]],viewer:s},true)}}}return true},deactivate:function(o){if(o===undefined){return false}var q=this.links[o];if(!q){return false}if(q.viewer){q.viewer._removeManipulator(o)}else{var m=q.node?q.node:q.path;var r=[];if(m instanceof f){r=m._getRenderableOccurrences()}else{for(var n=0;n<m._occurrences.length;n++){var l=m._occurrences[n]._getRenderableOccurrences();for(k=0;k<l.length;k++){r.push(l[k])}}}for(var k=0;k<r.length;k++){var p=r[k];if(p._manipulators&&p._manipulators[o]){delete p._manipulators[o]}}}return true},BeginManipulate:function(l,q,k){if(this.hasPriority&&q.viewer&&q.viewer.currentViewpoint&&q.viewer.currentViewpoint.control){q.viewer.currentViewpoint.control._onStopManip(q)}if(l){if(l instanceof f){this.manipulatedPaths.push(l)}else{for(var o=0;o<l._occurrences.length;o++){var m=l._occurrences[o];var r=new f();r.setFromOccurrence(m);var s=r._getRenderableOccurrences();for(var n=0;n<s.length;n++){var p=new f();p.setFromOccurrence(s[n]._occurrence);this.manipulatedPaths.push(p)}}}}},Manipulate:function(l,k,m){},EndManipulate:function(l,k,m){this.manipulatedPaths=[]},HandleLongHold:function(l,k){return false},PrimaryPointerClick:function(l,k,m){},PrimaryPointerDoubleClick:function(l,k,m){},BeginPreactivate:function(l,k,m){},Preactivate:function(l,k,m){},EndPreactivate:function(l,k,m){},onBeginManipulate:function(k){return this._modelEvent.subscribe({event:"BeginManipulate"},k)},onManipulate:function(k){return this._modelEvent.subscribe({event:"Manipulate"},k)},onEndManipulate:function(k){return this._modelEvent.subscribe({event:"EndManipulate"},k)},onBeginPreactivate:function(k){return this._modelEvent.subscribe({event:"BeginPreactivate"},k)},onPreactivate:function(k){return this._modelEvent.subscribe({event:"Preactivate"},k)},onEndPreactivate:function(k){return this._modelEvent.subscribe({event:"EndPreactivate"},k)},onPrimaryPointerClick:function(k){return this._modelEvent.subscribe({event:"PrimaryPointerClick"},k)},onPrimaryPointerDoubleClick:function(k){return this._modelEvent.subscribe({event:"PrimaryPointerDoubleClick"},k)},subscribe:function(k,l){return this._modelEvent.subscribe({event:k},l)},unsubscribe:function(k){this._modelEvent.unsubscribe(k)},publish:function(k,l){return this._modelEvent.publish({event:k,data:l,context:this})},DEPRECATED_CONSTRUCTOR:function(k){if(k&&k[0] instanceof THREEDS.WebGLV6Viewer){if(b>0){b--;console.log("[Manipulators] DEPRECATED Manipulator construction: "+(new Error()).stack)}return true}return false}});var b=50;c.State={NONE:0,BEGIN:1,MOVE:2,END:3};return UWA.namespace("THREEDS/Nodes/Manipulator",c)});define("Manipulators/Manipulator",["DS/Manipulators/Manipulator","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Manipulators/Manipulator");return b});define("DS/Manipulators/TrapSelectionManipulator",["DS/Manipulators/Manipulator"],function(b){var a=b.extend({init:function(c,d){this._parent(c);this.extremities={xPix:0,x:0,yPix:0,y:0};this.originPoint=null;this.startTime=null;this.divTrap=this.setupDivTrap(c.divTrap);this.noCursorChange=true;this.isActive=true;this.advancedSelection=d?true:false;this.forwardSelect=false},setAdvanced:function(c){this.advancedSelection=c;if(!c){this.setupDivTrap(this.divTrap);this.forwardSelect=false}},BeginManipulate:function(d,c,e){this.viewer.setCursor("TrapSelection",100);this.originPoint=this.viewer.getMousePosition(c.from[0].getCurrentPosition(this.viewer.canvas));this.setExtremities(this.originPoint);this.startTime=Date.now();this.manipIndex=0},Manipulate:function(d,c,f){var e=this.viewer.getMousePosition(c.from[0].getCurrentPosition(this.viewer.canvas));this.setExtremities(this.originPoint,e);if(this.divTrap){this.divTrap.show();this.divTrap.setStyles({width:(this.extremities.pt.xPix-this.extremities.xPix)/(window.devicePixelRatio||1),height:(this.extremities.pt.yPix-this.extremities.yPix)/(window.devicePixelRatio||1),left:(this.extremities.xPix)/(window.devicePixelRatio||1),top:(this.extremities.yPix)/(window.devicePixelRatio||1),pointerEvents:"none"})}},EndManipulate:function(d,c,e){this.viewer.setCursor("Auto");if(this.extremities&&this.divTrap){this.divTrap.hide();this.divTrap.setStyles({width:"0px",height:"0px",left:"0px",top:"0px",pointerEvents:"none"});this.viewer._doPickingFromMouseEvent(c.from[0],this.viewer.currentViewpoint.control,this)}this.setExtremities(null)},HandleLongHold:function(d,c){return true},setupDivTrap:function(c){c.setStyles({position:"absolute",opacity:"0.8",pointerEvents:"none",border:"1px dashed black",backgroundColor:"transparent"});c.hide();return c},setExtremities:function(h,g){if(!h){this.extremities=null;return}if(!g){this.extremities=h;return}var e={};var d={};var c=true;if(h.xPix<g.xPix){c=true;e.xPix=h.xPix;e.x=h.x;d.xPix=g.xPix;d.x=g.x}else{c=false;e.xPix=g.xPix;e.x=g.x;d.xPix=h.xPix;d.x=h.x}if(h.yPix<g.yPix){e.yPix=h.yPix;e.y=h.y;d.yPix=g.yPix;d.y=g.y}else{e.yPix=g.yPix;e.y=g.y;d.yPix=h.yPix;d.y=h.y}this.extremities=e;this.extremities.pt=d;if(this.advancedSelection&&this.divTrap&&this.forwardSelect!==c){var f;if(c){f={border:"2px solid #f5c77e",backgroundColor:"rgba(245, 200, 125, 0.5)"}}else{f={border:"2px dashed #75cdf0",backgroundColor:"rgba(117, 205, 240, 0.5)"}}this.divTrap.setStyles(f);this.forwardSelect=c}},getExtremities:function(){return this.extremities}});return a});define("DS/Manipulators/HandlePointManipulator",["DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Manipulators/Manipulator"],function(d,b,c){var a=c.extend({init:function(){if(this.DEPRECATED_CONSTRUCTOR(arguments)){}this._parent();return this},BeginManipulate:function(g,e,h){this._parent(g,e,h);var f={viewer:e.viewer,eventChannel:"BeginManipulate",event:e,paths:this.manipulatedPaths,intersection:h,manipulator:this};this.publish("BeginManipulate",f)},Manipulate:function(g,e,h){this._parent(g,e,h);var f={viewer:e.viewer,eventChannel:"Manipulate",event:e,paths:this.manipulatedPaths,intersection:h,manipulator:this};this.publish("Manipulate",f)},EndManipulate:function(g,e,h){var f={viewer:e.viewer,eventChannel:"EndManipulate",event:e,paths:this.manipulatedPaths,intersection:h,manipulator:this};this.publish("EndManipulate",f);this._parent(g,e,h)},BeginPreactivate:function(f,e,h){var g={viewer:e.viewer,eventChannel:"BeginPreactivate",event:e,preactivated:this.preactivated,intersection:h,manipulator:this};this.publish("BeginPreactivate",g)},Preactivate:function(f,e,h){var g={viewer:e.viewer,eventChannel:"Preactivate",event:e,preactivated:this.preactivated,intersection:h,manipulator:this};this.publish("Preactivate",g)},EndPreactivate:function(f,e,h){var g={viewer:e.viewer,eventChannel:"EndPreactivate",event:e,preactivated:this.preactivated,intersection:h,manipulator:this};this.publish("EndPreactivate",g)},PrimaryPointerClick:function(f,e,h){var g={viewer:e.viewer,eventChannel:"PrimaryPointerClick",event:e,intersection:h,manipulator:this};this.publish("PrimaryPointerClick",g)},PrimaryPointerDoubleClick:function(f,e,h){var g={viewer:e.viewer,eventChannel:"PrimaryPointerDoubleClick",event:e,intersection:h,manipulator:this};this.publish("PrimaryPointerDoubleClick",g)}});return UWA.namespace("THREEDS/Manipulators/HandlePointManipulator",a)});define("Manipulators/HandlePointManipulator",["DS/Manipulators/HandlePointManipulator","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Manipulators/HandlePointManipulator");return b});define("DS/Manipulators/PlaneTranslationManipulator",["DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Manipulators/Manipulator","DS/Visualization/PathElement"],function(c,a,b,e){var d=b.extend({init:function(f){var g;if(this.DEPRECATED_CONSTRUCTOR(arguments)){g={axis:arguments[1]}}else{g=f||{}}this._parent();this.axis=g.axis;this.axis.normalize();this.projector=new c.Projector();return this},BeginManipulate:function(h,f,i){this._parent(h,f,i);this.initial3dIntersectionPoint=i.position;this.plane=new c.Plane().setFromNormalAndCoplanarPoint(this.axis,i.position);var g={viewer:f.viewer,eventChannel:"BeginManipulate",event:f,paths:this.manipulatedPaths,intersection:i,manipulator:this};this.publish("BeginManipulate",g)},Manipulate:function(l,g,m){this._parent(l,g,m);var h=new c.Vector2().copy(g.from[0].getCurrentPosition(g.viewer.canvas));var f=g.viewer.currentViewpoint.create3DRayFrom2DPoint(h);var k=f.intersectPlane(this.plane);var i=new c.Vector3().subVectors(k,this.initial3dIntersectionPoint);i.projectOnPlane(this.axis);var j={viewer:g.viewer,eventChannel:"Manipulate",event:g,paths:this.manipulatedPaths,translationVector:i,intersection:m,manipulator:this};this.publish("Manipulate",j)},EndManipulate:function(l,g,m){var h=new c.Vector2().copy(g.from[0].getCurrentPosition(g.viewer.canvas));var f=g.viewer.currentViewpoint.create3DRayFrom2DPoint(h);var k=f.intersectPlane(this.plane);var i=new c.Vector3().subVectors(k,this.initial3dIntersectionPoint);i.projectOnPlane(this.axis);var j={viewer:g.viewer,eventChannel:"EndManipulate",event:g,paths:this.manipulatedPaths,translationVector:i,intersection:m,manipulator:this};this.publish("EndManipulate",j);this._parent(l,g,m)},BeginPreactivate:function(g,f,i){var h={viewer:f.viewer,eventChannel:"BeginPreactivate",event:f,preactivated:this.preactivated,intersection:i,manipulator:this};this.publish("BeginPreactivate",h)},Preactivate:function(g,f,i){var h={viewer:f.viewer,eventChannel:"Preactivate",event:f,preactivated:this.preactivated,intersection:i,manipulator:this};this.publish("Preactivate",h)},EndPreactivate:function(g,f,i){var h={viewer:f.viewer,eventChannel:"EndPreactivate",event:f,preactivated:this.preactivated,intersection:i,manipulator:this};this.publish("EndPreactivate",h)},PrimaryPointerClick:function(g,f,i){var h={viewer:f.viewer,eventChannel:"PrimaryPointerClick",event:f,intersection:i,manipulator:this};this.publish("PrimaryPointerClick",h)},PrimaryPointerDoubleClick:function(g,f,i){var h={viewer:f.viewer,eventChannel:"PrimaryPointerDoubleClick",event:f,intersection:i,manipulator:this};this.publish("PrimaryPointerDoubleClick",h)}});return UWA.namespace("THREEDS/Nodes/PlaneTranslationManipulator",d)});define("Manipulators/PlaneTranslationManipulator",["DS/Manipulators/PlaneTranslationManipulator","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Manipulators/PlaneTranslationManipulator");return b});define("DS/Manipulators/ManipulatorManager",["UWA/Class","DS/CoreEvents/Events","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS","DS/Visualization/TrackballControls","DS/Manipulators/Manipulator"],function(a,c,e,j,g,b){var h=5;var k=function(l){if(h!==0){console.log("[Manipulator] Manipulate method does not define the intersection argument anymore.\nIf you really need the picking result, you have to explicitly call setPickingDuringManipulation(true) on your manipulator.\n"+l.stack);h--}};var f=function(l,m){this._path=null;this._position=null;this._normal=null;this._tangent=null;this._uv=null;this._ray=null;this.__viewer=l;this.__event=m};var i=function(l){k(new Error());if(!l._path&&l.__viewer&&l.__event){var o;if(!l.__event.gesture){o=l.__event.from[0]}else{var n=l.__event.gesture.getEvents();o=n[0]}var m=l.__viewer.getMousePosition(o.getCurrentPosition(l.__viewer.canvas));m.event=o;var p=l.__viewer.pick(m,"mesh",true);l._path=p.path;l._position=p.position;l._normal=p.normal;l._tangent=p.tangent;l._uv=p.uv;l._ray=p.ray}};Object.defineProperty(f.prototype,"path",{get:function(){i(this);return this._path}});Object.defineProperty(f.prototype,"position",{get:function(){i(this);return this._position}});Object.defineProperty(f.prototype,"normal",{get:function(){i(this);return this._normal}});Object.defineProperty(f.prototype,"tangent",{get:function(){i(this);return this._tangent}});Object.defineProperty(f.prototype,"uv",{get:function(){i(this);return this._uv}});Object.defineProperty(f.prototype,"ray",{get:function(){i(this);return this._ray}});var d=a.extend({init:function(l){this.viewer=l;this.enabled=true;this.preActivation=true;this.manipulatedManipulators={};this.hoveredManipulator=null;this._attachEvents()},getActivate:function(){return this.enabled},setActivate:function(l){this.enabled=l},setPreActivate:function(l){this.preActivation=l},isInManipulation:function(q,m){for(var n in this.manipulatedManipulators){var p=this.manipulatedManipulators[n];var l=p.links[n];if(q&&(!l||(l.states.manipulateState===b.State.END))){continue}var o=(!m&&!p.getPickingInManipulation())||(m&&!p.getPrePickingDuringManipulation());if(o){return true}}return false},isPreActivationDisabledOnManipulatedManipulators:function(){for(var m in this.manipulatedManipulators){var n=this.manipulatedManipulators[m];var l=n.links[m];if(!l||(l.states.manipulateState===b.State.END)){continue}if(!n.getPreActivationDuringManipulation()){return true}}return false},_attachEvents:function(){var l=this;this.onPrimaryPointerEventCB=function(m){l._resetManipulatedManipulators();m.viewer=l.viewer;l._onEdit.call(l,m,1)};e.addEvent(document,"onPrimaryPointerDownUnique",this.onPrimaryPointerEventCB);this.onLeftClickCB=function(m){m.viewer=l.viewer;l._resetManipulatedManipulators();l._onLeftClick.call(l,m)};e.addEvent(document,"onPrimaryPointerClick",this.onLeftClickCB);this.onLeftDoubleClickCB=function(m){m.viewer=l.viewer;l._resetManipulatedManipulators();l._onLeftDoubleClick.call(l,m)};e.addEvent(document,"onPrimaryPointerDoubleClick",this.onLeftDoubleClickCB);this.onEditCB=function(m){m.viewer=l.viewer;l._resetManipulatedManipulators();l._onEdit.call(l,m,0)};e.addEvent(document,"onEdit",this.onEditCB);this.onSmartEditCB=function(m){m.viewer=l.viewer;l._resetManipulatedManipulators();l._onEdit.call(l,m,2)};e.addEvent(document,"onSmartEdit",this.onSmartEditCB);this.onMouseMoveCB=function(m){m.viewer=l.viewer;l._onMove.call(l,m,true)};e.addEvent(document,"onMouseMove",this.onMouseMoveCB);this.onSwipeCB=function(m){m.viewer=l.viewer;l._onMove.call(l,m,false)};e.addEvent(this.viewer.div,"onSwipe",this.onSwipeCB);this.onLeftMouseUpCB=function(m){m.viewer=l.viewer;l._onRelease.call(l,m)};e.addEvent(document,"onLeftMouseUp",this.onLeftMouseUpCB);this.onReleaseCB=function(m){m.viewer=l.viewer;l._onRelease.call(l,m)};e.addEvent(document,"onRelease",this.onReleaseCB);this.onEditEvent=c.subscribe({event:"/VISU/onEdit"},function(m){m.viewer=l.viewer});this.onMouseMoveEvent=c.subscribe({event:"/VISU/onMouseMove"},function(m){m.viewer=l.viewer});this.onSwipeEvent=c.subscribe({event:"/VISU/onSwipe"},function(m){m.viewer=l.viewer});this.onLeftMouseUpEvent=c.subscribe({event:"/VISU/onLeftMouseUp"},function(m){m.viewer=l.viewer});this.onReleaseEvent=c.subscribe({event:"/VISU/onRelease"},function(m){m.viewer=l.viewer});this.onLongHoldCB=function(m){m.viewer=l.viewer;l._onLongHold.call(l,m)};e.addEvent(document,"onLongHold",this.onLongHoldCB)},_detachEvents:function(){e.removeEvent(document,"onPrimaryPointerDownUnique",this.onPrimaryPointerEventCB);e.removeEvent(document,"onPrimaryPointerClick",this.onLeftClickCB);e.removeEvent(document,"onPrimaryPointerDoubleClick",this.onLeftDoubleClickCB);e.removeEvent(document,"onLongHold",this.onLongHoldCB);e.removeEvent(document,"onEdit",this.onEditCB);e.removeEvent(document,"onMouseMove",this.onMouseMoveCB);e.removeEvent(this.viewer.div,"onSwipe",this.onSwipeCB);e.removeEvent(document,"onLeftMouseUp",this.onLeftMouseUpCB);e.removeEvent(document,"onRelease",this.onReleaseCB)},_addToManipulators:function(m,l){if(this.manipulatedManipulators[l]){return}this.manipulatedManipulators[l]=m},_resetManipulatedManipulators:function(){for(var l in this.manipulatedManipulators){var n=this.manipulatedManipulators[l];var m=n.links[l];if(!m||(m.states.manipulateState===b.State.END)){delete (this.manipulatedManipulators[l])}}},_applyToManipulatorsOverPointer:function(w,x,y,o){if(!this.viewer||!this.viewer.canvas){return}var t,m;var n;if(!w.gesture){n=w.from[0]}else{var l=w.gesture.getEvents();n=l[0]}t=this.viewer.getMousePosition(o?n.getStartPosition(this.viewer.canvas):n.getCurrentPosition(this.viewer.canvas));t.event=n;if(this.viewer.currentViewpoint!==null){var v=n.isInView([this.viewer.canvas,this.viewer.divCssElement]);if(v){m=this.viewer.pick(t,"mesh",true)}var q;var u;if(v&&m.path.length){var p=m.path[0]._getRenderableOccurrences(this.viewer);if(p.length!==1){return}var r=p[0];var s=false;if(r._manipulators){for(q in r._manipulators){var u=r._manipulators[q];if(u.active){s=true;x.call(this,u,q,m)}}if(s){return}}}if(v){for(q in this.viewer._manipulators){u=this.viewer._manipulators[q];if(u.active){x.call(this,u,q,m);return}}}if(y){y.call(this,m)}}},_applyToManipulatedManipulators:function(t,u,r){var m=null;var p;var n;if(!t.gesture){n=t.from[0]}else{var l=t.gesture.getEvents();n=l[0]}p=this.viewer.getMousePosition(n.getCurrentPosition(this.viewer.canvas));p.event=n;if(this.viewer.currentViewpoint!==null){var o;for(o in this.manipulatedManipulators){var q=this.manipulatedManipulators[o];var s=q.links[o];if(!s||(s.states.manipulateState===b.State.END)){continue}if(q.active){if(r||q.getPickingDuringManipulation()){m=this.viewer.pick(p,"mesh",true)}u.call(this,q,o,m)}}}},_onLeftClick:function(l){if(!this.enabled){return}this._applyToManipulatorsOverPointer(l,function(p,m,q){var n=p.links[m];if(!n){return}var o=n.states.manipulateState;if((o===b.State.NONE)||(o===b.State.END)){p.PrimaryPointerClick(n.path?n.path:n.node,l,q)}})},_onLeftDoubleClick:function(l){if(!this.enabled){return}this._applyToManipulatorsOverPointer(l,function(p,m,q){var n=p.links[m];if(!n){return}var o=n.states.manipulateState;if((o===b.State.NONE)||(o===b.State.END)){p.PrimaryPointerDoubleClick(n.path?n.path:n.node,l,q)}})},_onEdit:function(n,p){if(!this.enabled){return}var m=true;var l=false;var o=false;var q=false;this._applyToManipulatorsOverPointer(n,function(y,t,s){var w=null;if(this.viewer.currentViewpoint){w=this.viewer.currentViewpoint.control}var u=!y._selectionAllowed&&(p===1)&&y.hasPriority;var x=!y._selectionAllowed&&!p&&!y.hasPriority;var A=y._selectionAllowed&&(p===2);if(u||x||A){var z=y.links[t];if(!z){return}var r=z.states.manipulateState;if((r===b.State.NONE)||(r===b.State.END)){if(m){m=false;for(var v in this.manipulatedManipulators){l=true}}if(l){return}y.BeginManipulate(z.path?z.path:z.node,n,s);z.states.manipulateState=b.State.BEGIN;this._addToManipulators(y,t);if(!q&&!y.noCursorChange){this.viewer.setCursor("Grab");q=true}}}if(y._selectionAllowed&&(p===1)){w&&w._onStopManip(n)}if(!y._selectionAllowed&&(p===1)&&!y.hasPriority){if(w&&!o&&!w._showSpinnerOnHold){w._onEditEventBegin(n);o=true}}},null,(p===2))},_onMove:function(m,n){if(!this.enabled){return}var l=n&&this.viewer&&this.preActivation&&!this.isPreActivationDisabledOnManipulatedManipulators()&&(!this.viewer.pPicking.disableWhileMoving||(this.viewer.pPicking.disableWhileMoving&&this.viewer.currentViewpoint&&!this.viewer.currentViewpoint.isMoving()));if(l){this._applyToManipulatorsOverPointer(m,function(q,o,r){if(q.active){var p=q.links[o];if(!p){return}if(!this.hoveredManipulator){q.preactivated.path=r.path[0];q.BeginPreactivate(p.path?p.path:p.node,m,r);p.states.preActivateState=b.State.BEGIN;this.hoveredManipulator={token:o,manip:q}}else{if(o!==this.hoveredManipulator.token){this.lastLink=this.hoveredManipulator.manip.links[this.hoveredManipulator.token];if(this.lastLink){this.hoveredManipulator.manip.EndPreactivate(this.lastLink.path?this.lastLink.path:this.lastLink.node,m,r);this.lastLink.states.preActivateState=b.State.END}q.preactivated.path=r.path[0];q.BeginPreactivate(p.path?p.path:p.node,m,r);p.states.preActivateState=b.State.BEGIN;this.hoveredManipulator={token:o,manip:q}}else{p.states.preActivateState=b.State.MOVE;q.Preactivate(p.path?p.path:p.node,m,r)}}}},function(o){if(this.hoveredManipulator){this.lastLink=this.hoveredManipulator.manip.links[this.hoveredManipulator.token];if(this.lastLink){this.hoveredManipulator.manip.EndPreactivate(this.lastLink.path?this.lastLink.path:this.lastLink.node,m,o);this.lastLink.states.preActivateState=b.State.END}this.hoveredManipulator=null}})}this._applyToManipulatedManipulators(m,function(q,o,r){var p=q.links[o];if(!p){return}if((p.states.manipulateState===b.State.BEGIN)||(p.states.manipulateState===b.State.MOVE)){if(!r){r=new f(this.viewer,m)}q.Manipulate(p.path?p.path:p.node,m,r);p.states.manipulateState=b.State.MOVE}},false)},_onRelease:function(l){if(!this.enabled){return}this._applyToManipulatedManipulators(l,function(o,m,p){var n=o.links[m];if(!n){return}if((n.states.manipulateState===b.State.BEGIN)||(n.states.manipulateState===b.State.MOVE)){o.EndManipulate(n.path?n.path:n.node,l,p);n.states.manipulateState=b.State.END}},true)},_onLongHold:function(l){if(!this.enabled){return}this._applyToManipulatedManipulators(l,function(o,m){var n=o.links[m];if(!n){return}if((n.states.manipulateState===b.State.BEGIN)||(n.states.manipulateState===b.State.MOVE)){if(o.HandleLongHold(n.path?n.path:n.node,l)){n.states.manipulateState=b.State.END}}},false)}});return UWA.namespace("THREEDS/ManipulatorManager",d)});define("Manipulators/ManipulatorManager",["DS/Manipulators/ManipulatorManager","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Manipulators/ManipulatorManager");return b});define("DS/Manipulators/LineTranslationManipulator",["DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Manipulators/Manipulator"],function(d,a,c){var b=c.extend({init:function(e){var f;if(this.DEPRECATED_CONSTRUCTOR(arguments)){f={axis:arguments[1]}}else{f=e||{}}this._parent();this.axis=f.axis;this.axis.normalize();this.projector=new d.Projector();return this},BeginManipulate:function(g,e,h){this._parent(g,e,h);this.initialPositionProjected=e.from[0].getCurrentPosition(e.viewer.canvas);this.initial3dIntersectionPoint=h.position;this.initial3dIntersectionPointTranslated=new d.Vector3().copy(this.initial3dIntersectionPoint);this.initial3dIntersectionPointTranslated.add(this.axis);var f={viewer:e.viewer,eventChannel:"BeginManipulate",event:e,paths:this.manipulatedPaths,intersection:h,manipulator:this};this.publish("BeginManipulate",f)},Manipulate:function(k,f,l){this._parent(k,f,l);var g=new d.Vector2().copy(f.from[0].getCurrentPosition(f.viewer.canvas));var e=f.viewer.currentViewpoint.create3DRayFrom2DPoint(g);var j=e.computeShortestPointToLine(this.initial3dIntersectionPoint,this.initial3dIntersectionPointTranslated);var h=new d.Vector3().subVectors(j,this.initial3dIntersectionPoint);var i={viewer:f.viewer,eventChannel:"Manipulate",event:f,paths:this.manipulatedPaths,translationVector:h,intersection:l,manipulator:this};this.publish("Manipulate",i)},EndManipulate:function(k,f,l){var g=new d.Vector2().copy(f.from[0].getCurrentPosition(f.viewer.canvas));var e=f.viewer.currentViewpoint.create3DRayFrom2DPoint(g);var j=e.computeShortestPointToLine(this.initial3dIntersectionPoint,this.initial3dIntersectionPointTranslated);var h=new d.Vector3().subVectors(j,this.initial3dIntersectionPoint);var i={viewer:f.viewer,eventChannel:"EndManipulate",event:f,paths:this.manipulatedPaths,translationVector:h,intersection:l,manipulator:this};this.publish("EndManipulate",i);this._parent(k,f,l)},BeginPreactivate:function(f,e,h){var g={viewer:e.viewer,eventChannel:"BeginPreactivate",event:e,preactivated:this.preactivated,intersection:h,manipulator:this};this.publish("BeginPreactivate",g)},Preactivate:function(f,e,h){var g={viewer:e.viewer,eventChannel:"Preactivate",event:e,preactivated:this.preactivated,intersection:h,manipulator:this};this.publish("Preactivate",g)},EndPreactivate:function(f,e,h){var g={viewer:e.viewer,eventChannel:"EndPreactivate",event:e,preactivated:this.preactivated,intersection:h,manipulator:this};this.publish("EndPreactivate",g)},PrimaryPointerClick:function(f,e,h){var g={viewer:e.viewer,eventChannel:"PrimaryPointerClick",event:e,intersection:h,manipulator:this};this.publish("PrimaryPointerClick",g)},PrimaryPointerDoubleClick:function(f,e,h){var g={viewer:e.viewer,eventChannel:"PrimaryPointerDoubleClick",event:e,intersection:h,manipulator:this};this.publish("PrimaryPointerDoubleClick",g)}});return UWA.namespace("THREEDS/Nodes/LineTranslationManipulator",b)});define("Manipulators/LineTranslationManipulator",["DS/Manipulators/LineTranslationManipulator","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Manipulators/LineTranslationManipulator");return b});define("DS/Manipulators/PointHandle",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/HandlePointManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/SceneGraphFactory"],function(i,g,c,j,d,f,e,b,a,l,h){var k=g.extend({init:function(u){this._parent(u.name);this.sceneGraph=u.sceneGraph;this.size=u.size?u.size:20;this.fillColor=u.fillColor?u.fillColor:new i.Color("#FFFFFF");this.opacity=u.opacity?u.opacity:1;this._modelEvent=new a();this.isPreactivated=false;this.isManipulated=false;var v=u.noz!==undefined?u.noz:true;var o=this;var n=new j();var p={width:1,height:1,fill:true,fillColor:null,noEdge:true,layerNb:v?1:0};var s=n.createRectangle(p);var t=c.getWebappsAssetUrl("Robot","");var r=new i.ImageUtils.loadTexture(t+"models/textures/Point.png",undefined,null,null,i.ImageUtils.crossOriginPolicy);r.flipY=false;r.minFilter=i.LinearMipMapLinearFilter;this.pointMat=new i.MeshBasicMaterial({map:r,side:i.DoubleSide,transparent:true,alphaTest:0.05,enableClipPlanes:false,opacity:this.opacity});this.pointMat.force=true;var q=h.createMeshNode(s,this.pointMat);q.setShadow(false);q.setFrustumCulled(false);q.name="diskNode";q.excludeFromCSO(true);q.excludeFromHighlight(true,true);q.setMatrix(new i.Matrix4().setPosition(new i.Vector3(-0.5,-0.5,0)));this.diskNode=q;var m={position:this.position,name:"billBoard1",type:"Spherical"};this.billBoardNode=new d(m);this.billBoardNode.add(q);this.fixedSizeNode=new l({name:"fixedSizeNode3D",ratio:this.size});this.fixedSizeNode.add(this.billBoardNode);this.add(this.fixedSizeNode);this.sceneGraph.add(this);this.manipulator=new f();this.manipulator.setExclusive(true);this.manipToken=this.manipulator.linkToNode(this);this.manipulator.onBeginManipulate(function(w){o._modelEvent.publish({event:"BeginManipulate",data:w,context:this});o.pointMat.color=new i.Color("#1B6E9C");w.viewer.setCursor("-webkit-grabbing");o.isManipulated=true;o.fixedSizeNode.setRatio(1.2*o.size);w.viewer.render()});this.manipulator.onManipulate(function(w){o._modelEvent.publish({event:"Manipulate",data:w,context:this});w.viewer.setCursor("-webkit-grabbing")});this.manipulator.onEndManipulate(function(w){o._modelEvent.publish({event:"EndManipulate",data:w,context:this});if(!o.isPreactivated){w.viewer.setCursor("auto");o.pointMat.color=o.fillColor;o.fixedSizeNode.setRatio(o.size)}else{w.viewer.setCursor("pointer");o.pointMat.color=new i.Color("#A1D9ED")}o.isManipulated=false;w.viewer.render()});this.manipulator.onBeginPreactivate(function(w){o._modelEvent.publish({event:"BeginPreactivate",data:w,context:this});w.viewer.setCursor("pointer");o.isPreactivated=true;if(!o.isManipulated){o.pointMat.color=new i.Color("#A1D9ED")}o.fixedSizeNode.setRatio(1.2*o.size);w.viewer.render()});this.manipulator.onPreactivate(function(w){o._modelEvent.publish({event:"Preactivate",data:w,context:this})});this.manipulator.onEndPreactivate(function(w){o._modelEvent.publish({event:"EndPreactivate",data:w,context:this});w.viewer.setCursor("auto");o.isPreactivated=false;if(!o.isManipulated){o.pointMat.color=o.fillColor;o.fixedSizeNode.setRatio(o.size)}w.viewer.render()})},setSize:function(m){this.size=m;this.fixedSizeNode.setRatio(this.size)},setFillColor:function(m){this.fillColor=m;this.pointMat.color=this.fillColor},setOpacity:function(m){this.opacity=m;this.pointMat.opacity=this.opacity},subscribe:function(m,n){return this._modelEvent.subscribe({event:m},n)},unsubscribe:function(m){this._modelEvent.unsubscribe(m)},dispose:function(){if(this.manipulator){this.manipulator.unlink(this.manipToken);this.manipulator=null}this.sceneGraph.remove(this)}});return UWA.namespace("THREEDS/Nodes/PointHandle",k)});define("Manipulators/PointHandle",["DS/Manipulators/PointHandle","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Manipulators/PointHandle");return b});define("DS/Manipulators/RotationManipulator",["DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Manipulators/Manipulator"],function(d,a,c){var b=c.extend({init:function(e){var f;if(this.DEPRECATED_CONSTRUCTOR(arguments)){f={axis:arguments[1]}}else{f=e||{}}this._parent();this.axis=f.axis;this.axis.normalize();this.centerPosition=new d.Vector3();this.fromCenterToInitial=new d.Vector3();this.plane=new d.Plane();this.projector=new d.Projector();return this},BeginManipulate:function(g,e,h){this._parent(g,e,h);this.initial3dIntersectionPoint=h.position;this.plane.setFromNormalAndCoplanarPoint(this.axis,this.initial3dIntersectionPoint);this.fromCenterToInitial.subVectors(this.initial3dIntersectionPoint,this.centerPosition);this.fromCenterToInitial.projectOnPlane(this.axis);this.fromCenterToInitial.normalize();var f={viewer:e.viewer,eventChannel:"BeginManipulate",event:e,paths:this.manipulatedPaths,intersection:h,manipulator:this};this.publish("BeginManipulate",f)},Manipulate:function(o,m,e){this._parent(o,m,e);var i=new d.Vector2().copy(m.from[0].getCurrentPosition(m.viewer.canvas));var l=m.viewer.currentViewpoint.create3DRayFrom2DPoint(i);var k=l.intersectPlane(this.plane);var g=new d.Vector3().subVectors(k,this.centerPosition);g.projectOnPlane(this.axis);g.normalize();var f=new d.Vector3();f.crossVectors(this.fromCenterToInitial,g);f.normalize();var h=this.fromCenterToInitial.angleTo(g);var n=new d.Matrix4().makeRotationAxis(f,h);var j={viewer:m.viewer,eventChannel:"Manipulate",event:m,paths:this.manipulatedPaths,rotationMatrix:n,angle:h,axis:f,center:this.centerPosition,intersection:e,manipulator:this};this.publish("Manipulate",j)},EndManipulate:function(o,m,e){var i=new d.Vector2().copy(m.from[0].getCurrentPosition(m.viewer.canvas));var l=m.viewer.currentViewpoint.create3DRayFrom2DPoint(i);var k=l.intersectPlane(this.plane);var g=new d.Vector3().subVectors(k,this.centerPosition);g.projectOnPlane(this.axis);g.normalize();var f=new d.Vector3();f.crossVectors(this.fromCenterToInitial,g);f.normalize();var h=this.fromCenterToInitial.angleTo(g);var n=new d.Matrix4().makeRotationAxis(f,h);var j={viewer:m.viewer,eventChannel:"EndManipulate",event:m,paths:this.manipulatedPaths,rotationMatrix:n,angle:h,axis:f,center:this.centerPosition,intersection:e,manipulator:this};this.publish("EndManipulate",j);this._parent(o,m,e)},setCenter:function(e){this.centerPosition=e},setAxis:function(e){this.axis=e},BeginPreactivate:function(f,e,h){var g={viewer:e.viewer,eventChannel:"BeginPreactivate",event:e,preactivated:this.preactivated,intersection:h,manipulator:this};this.publish("BeginPreactivate",g)},Preactivate:function(f,e,h){var g={viewer:e.viewer,eventChannel:"Preactivate",event:e,preactivated:this.preactivated,intersection:h,manipulator:this};this.publish("Preactivate",g)},EndPreactivate:function(f,e,h){var g={viewer:e.viewer,eventChannel:"EndPreactivate",event:e,preactivated:this.preactivated,intersection:h,manipulator:this};this.publish("EndPreactivate",g)},PrimaryPointerClick:function(f,e,h){var g={viewer:e.viewer,eventChannel:"PrimaryPointerClick",event:e,intersection:h,manipulator:this};this.publish("PrimaryPointerClick",g)},PrimaryPointerDoubleClick:function(f,e,h){var g={viewer:e.viewer,eventChannel:"PrimaryPointerDoubleClick",event:e,intersection:h,manipulator:this};this.publish("PrimaryPointerDoubleClick",g)}});return UWA.namespace("THREEDS/Nodes/RotationManipulator",b)});define("Manipulators/RotationManipulator",["DS/Manipulators/RotationManipulator","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Manipulators/RotationManipulator");return b});define("DS/Manipulators/ScreenPlaneManipulator",["DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Manipulators/Manipulator","DS/Visualization/PathElement"],function(d,a,b,e){var c=b.extend({init:function(f){var g;if(this.DEPRECATED_CONSTRUCTOR(arguments)){g={cameraName:arguments[1]}}else{g=f||{}}this._parent();this.projector=new d.Projector();this.setCameraName(g.cameraName);return this},BeginManipulate:function(h,f,i){this._parent(h,f,i);this.initial3dIntersectionPoint=i.position;var g={viewer:f.viewer,eventChannel:"BeginManipulate",event:f,position:this.initial3dIntersectionPoint,paths:this.manipulatedPaths,intersection:i,manipulator:this};this.publish("BeginManipulate",g)},Manipulate:function(p,o,f){this._parent(p,o,f);var i=new d.Vector2().copy(o.from[0].getCurrentPosition(o.viewer.canvas));var n=o.viewer.currentViewpoint.create3DRayFrom2DPoint(i,o.viewer.currentViewpoint[this.cameraName]);var m=o.viewer.currentViewpoint[this.cameraName];var h=new d.Vector3().copy(m.getLookAt());var k=new d.Plane().setFromNormalAndCoplanarPoint(h.multiplyScalar(-1),this.initial3dIntersectionPoint);var l=n.intersectPlane(k);var g=new d.Vector3().subVectors(l,this.initial3dIntersectionPoint);var j={viewer:o.viewer,eventChannel:"Manipulate",event:o,paths:this.manipulatedPaths,translationVector:g,intersection:f,manipulator:this};this.publish("Manipulate",j)},EndManipulate:function(h,f,i){var g={viewer:f.viewer,eventChannel:"EndManipulate",event:f,paths:this.manipulatedPaths,intersection:i,manipulator:this};this.publish("EndManipulate",g);this._parent(h,f,i)},BeginPreactivate:function(g,f,i){var h={viewer:f.viewer,eventChannel:"BeginPreactivate",event:f,preactivated:this.preactivated,intersection:i,manipulator:this};this.publish("BeginPreactivate",h)},Preactivate:function(g,f,i){var h={viewer:f.viewer,eventChannel:"Preactivate",event:f,preactivated:this.preactivated,intersection:i,manipulator:this};this.publish("Preactivate",h)},EndPreactivate:function(g,f,i){var h={viewer:f.viewer,eventChannel:"EndPreactivate",event:f,preactivated:this.preactivated,intersection:i,manipulator:this};this.publish("EndPreactivate",h)},PrimaryPointerClick:function(g,f,i){var h={viewer:f.viewer,eventChannel:"PrimaryPointerClick",event:f,intersection:i,manipulator:this};this.publish("PrimaryPointerClick",h)},PrimaryPointerDoubleClick:function(g,f,i){var h={viewer:f.viewer,eventChannel:"PrimaryPointerDoubleClick",event:f,intersection:i,manipulator:this};this.publish("PrimaryPointerDoubleClick",h)},setCameraName:function(f){this.cameraName=f?f:"camera"}});return UWA.namespace("THREEDS/Nodes/ScreenPlaneManipulator",c)});define("Manipulators/ScreenPlaneManipulator",["DS/Manipulators/ScreenPlaneManipulator","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Manipulators/ScreenPlaneManipulator");return b});define("DS/Manipulators/ScalingManipulator",["DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Manipulators/Manipulator"],function(c,a,b){var d=b.extend({init:function(e){var f;if(this.DEPRECATED_CONSTRUCTOR(arguments)){f={axis:arguments[1]}}else{f=e||{}}this._parent();this.axis=f.axis;this.axis.normalize();this.centerPosition=new c.Vector3();this.offset=0;this.projector=new c.Projector();this.scalingFactor=1;return this},BeginManipulate:function(g,e,h){this._parent(g,e,h);this.initial3dIntersectionPoint=new c.Vector3().copy(h.position);this.lastProjectionPoint3D=this.initial3dIntersectionPoint;this.initial3dIntersectionPointTranslated=new c.Vector3().copy(this.initial3dIntersectionPoint);this.initial3dIntersectionPointTranslated.add(this.axis);this.offset=new c.Vector3().subVectors(this.initial3dIntersectionPoint,this.centerPosition).length();var f={viewer:e.viewer,eventChannel:"BeginManipulate",event:e,paths:this.manipulatedPaths,intersection:h,manipulator:this};this.publish("BeginManipulate",f)},Manipulate:function(m,k,e){this._parent(m,k,e);var g=new c.Vector2().copy(k.from[0].getCurrentPosition(k.viewer.canvas));var j=k.viewer.currentViewpoint.create3DRayFrom2DPoint(g);this.lastProjectionPoint3D=j.computeShortestPointToLine(this.initial3dIntersectionPoint,this.initial3dIntersectionPointTranslated);var f=new c.Vector3().subVectors(this.lastProjectionPoint3D,this.initial3dIntersectionPoint);f.projectOnVector(this.axis);var i=f.dot(this.axis);var l=new c.Matrix4();if(this.offset>0){this.scalingFactor=Math.max((this.offset+i)/this.offset,0.1);l.setPosition(new c.Vector3().copy(this.centerPosition)).scale(new c.Vector3(this.scalingFactor,this.scalingFactor,this.scalingFactor)).multiply(new c.Matrix4().setPosition(new c.Vector3().copy(this.centerPosition).multiplyScalar(-1)))}var h={viewer:k.viewer,eventChannel:"Manipulate",event:k,paths:this.manipulatedPaths,scalingMatrix:l,scalingFactor:this.scalingFactor,center:this.centerPosition,intersection:e,manipulator:this};this.publish("Manipulate",h)},EndManipulate:function(g,e,h){this.scalingFactor=1;var f={viewer:e.viewer,eventChannel:"EndManipulate",event:e,paths:this.manipulatedPaths,intersection:h,manipulator:this};this.publish("EndManipulate",f);this._parent(g,e,h)},BeginPreactivate:function(f,e,h){var g={viewer:e.viewer,eventChannel:"BeginPreactivate",event:e,preactivated:this.preactivated,intersection:h,manipulator:this};this.publish("BeginPreactivate",g)},Preactivate:function(f,e,h){var g={viewer:e.viewer,eventChannel:"Preactivate",event:e,preactivated:this.preactivated,intersection:h,manipulator:this};this.publish("Preactivate",g)},EndPreactivate:function(f,e,h){var g={viewer:e.viewer,eventChannel:"EndPreactivate",event:e,preactivated:this.preactivated,intersection:h,manipulator:this};this.publish("EndPreactivate",g)},PrimaryPointerClick:function(f,e,h){var g={viewer:e.viewer,eventChannel:"PrimaryPointerClick",event:e,intersection:h,manipulator:this};this.publish("PrimaryPointerClick",g)},PrimaryPointerDoubleClick:function(f,e,h){var g={viewer:e.viewer,eventChannel:"PrimaryPointerDoubleClick",event:e,intersection:h,manipulator:this};this.publish("PrimaryPointerDoubleClick",g)},setCenter:function(e){this.centerPosition=e},setAxis:function(e){this.axis=e}});return UWA.namespace("THREEDS/Nodes/ScalingManipulator",d)});define("Manipulators/ScalingManipulator",["DS/Manipulators/ScalingManipulator","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Manipulators/ScalingManipulator");return b});