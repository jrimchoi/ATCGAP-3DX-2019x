define("DS/Plugins/RenderPass",["DS/Visualization/ThreeJS_DS"],function(c){var b=1;var a=function(i,h,e,d,j,g,f){this.scene=i;this.lockScene=false;this.name=f;this.id="R"+(b++);this.forcePolygonOffset=c.PolygonOffsetForceStatus.DEFAULT;this.overrideMaterial=e;this.renderFaces=(d!==undefined)?d:null;this.renderLineMode=(j!==undefined&&j!==null)?(j||c.HideAllRenderLineMode):null;this.renderPoints=(g!==undefined)?g:null;this.renderPointMode=null;this.forceMaterialDoubleSide=false;this.oldRenderFaces=false;this.oldRenderLineMode=c.HideAllRenderLineMode;this.oldRenderPoints=false;this.oldRenderSurfacicPoints=false;this.needsSwap=false;this.order=0;this.renderPluginsPre=true;this.renderPluginsPost=true;this.oldRenderPluginsPre=true;this.oldRenderPluginsPost=true;this.disableColorWrite=false;this.disableDepthWrite=false;this.disableBackFaceCulling=false;this.disableClippingPlanes=false;this.enableStencilTest=false;this.enableStencilWrite=false;this.stencilOpFrontFaces="KEEP";this.stencilOpBackFaces="KEEP";this.stencilOpFrontFacesZFail="KEEP";this.stencilOpBackFacesZFail="KEEP";this.stencilFunc="ALWAYS";this.depthFunc=null;this.prevNormalDepthBuffer=null;this.prevColorBuffer=null;this.materialToUse=null;this.hideSurfacesAndUnclipedMeshes=false;this.cullFaceMode="back";this.disableBackFaceClipPlanes=false;this.renderCuttingElements=false;this.cuttingScene=null;this.isCustomPass=false;this.disableToneMapping=false;this.stencilRef=100;this.defaults={};this.cameraName="main";this.idString="main";this.info=new c.RenderInfo();this.customCamera=null;this.useRenderPriorityOpacity=false;this.isOITPass=false;this.dlsToDisable=[];this.composer=null;this.ignoreNoZ=false;this.disabledByDefault=false;this.order=0;this.isRobotPass=false;this.oldRenderPointMode=null;this.renderToScreen=false;this.renderSurfacicPoints=false;this.context=null;this.stateSortingResult=null;this.updateStateSortingResult=true;this.enableGSSOCache=false;this.forceMaterialMode=false};a.prototype={getDefaultState:function(){return{enabled:this.disabledByDefault?false:true,renderPlugins:false,renderToCanvas:false}},setStateSortingResult:function(d,e){this.stateSortingResult=d;this.updateStateSortingResult=e},getUsedStateSortingResult:function(d){return this.stateSortingResult||d._stateSortingResult},setForceMaterialMode:function(d){this.forceMaterialMode=d},setRenderPluginsPre:function(d){this.renderPluginsPre=d},setGSSOCache:function(d){this.enableGSSOCache=d},setRenderPluginsPost:function(d){this.renderPluginsPost=d},setMaterialToUse:function(d){this.materialToUse=d},setDisableColorWrite:function(d){this.disableColorWrite=d},setUseRenderPriorityOpacity:function(d){this.useRenderPriorityOpacity=d},setCustomCamera:function(d){this.customCamera=d},setDisableDepthWrite:function(d){this.disableDepthWrite=d},setDisableBackFaceCulling:function(d){this.disableBackFaceCulling=d},setForceMaterialDoubleSide:function(d){this.forceMaterialDoubleSide=d},setDisableClippingPlanes:function(d){this.disableClippingPlanes=d},setEnableStencilWrite:function(d){this.enableStencilWrite=d},setEnableStencilTest:function(d){this.enableStencilTest=d},setCameraName:function(d){this.cameraName=d},setStencilOps:function(e,d){this.stencilOpFrontFaces=e;this.stencilOpBackFaces=d;this.stencilOpFrontFacesZFail=e;this.stencilOpBackFacesZFail=d},setStencilOpsSeparate:function(g,d,f,e){this.stencilOpFrontFaces=g;this.stencilOpBackFaces=d;this.stencilOpFrontFacesZFail=f;this.stencilOpBackFacesZFail=e},setStencilFunc:function(d){this.stencilFunc=d},setCullFaceMode:function(d){this.cullFaceMode=d},setHideSurfacesAndUnclippedMeshes:function(d){this.hideSurfacesAndUnclipedMeshes=d},setDisableBackFaceClipPlanes:function(d){this.disableBackFaceClipPlanes=d},setCuttingScene:function(d){this.cuttingScene=d},setRenderCuttingElements:function(d){if(this.renderCuttingElements&&!d){this.setCuttingScene(null)}this.renderCuttingElements=d},setCustomPass:function(){this.isCustomPass=true},setDisableToneMapping:function(d){this.disableToneMapping=d},setDepthFunc:function(d){this.depthFunc=d},setScene:function(d){this.scene=d},setPreviousNormalDepthBuffer:function(d){this.prevNormalDepthBuffer=d},setPreviousColorBuffer:function(d){this.prevColorBuffer=d},setDLsToDisable:function(d){this.dlsToDisable=d.slice(0)},setDLsState:function(f,d,e){if(d&&d.length){d.forEach(function(g){f.forEach(function(h){if(h.name===g){h.active=e}})})}},activateAllDLs:function(e){for(var d=0;d<e.length;d++){e[d].active=true}},render:function(o,w,j,x,e,d,z,f,q,h){var r;var s=z[f];var g=o.context;this.scene.overrideMaterial=this.overrideMaterial;o.forcePolygonOffset=this.forcePolygonOffset;if(this.depthFunc){g.depthFunc(g[this.depthFunc])}g.stencilFunc(g[this.stencilFunc],this.stencilRef,255);g.stencilOpSeparate(g.FRONT,g.KEEP,g[this.stencilOpFrontFacesZFail],g[this.stencilOpFrontFaces]);g.stencilOpSeparate(g.BACK,g.KEEP,g[this.stencilOpBackFacesZFail],g[this.stencilOpBackFaces]);if(this.enableStencilTest){g.enable(g.STENCIL_TEST)}if(this.renderFaces!==null){this.oldRenderFaces=o.renderFaces;o.renderFaces=this.renderFaces}if(this.renderLineMode!==null){this.oldRenderLineMode=o.renderLineMode;o.renderLineMode=this.renderLineMode}if(this.forceMaterialDoubleSide){o.forceMaterialDoubleSide=true}if(this.renderPoints!==null){this.oldRenderPoints=o.renderPoints;o.renderPoints=this.renderPoints}if(this.renderPointMode!==null){this.oldRenderPointMode=o.renderPointMode;o.renderPointMode=this.renderPointMode}this.oldRenderPluginsPre=o.enableRenderPluginsPre;o.enableRenderPluginsPre=this.renderPluginsPre;this.oldRenderPluginsPost=o.enableRenderPluginsPost;o.enableRenderPluginsPost=this.renderPluginsPost;o.setFaceCulling(this.cullFaceMode=="back"?c.CullFaceBack:(this.cullFaceMode=="front"?c.CullFaceFront:c.CullFaceNone));if(this.disableBackFaceClipPlanes!=0){o.disableBackFaceClipPlanes=this.disableBackFaceClipPlanes}var p=o.clipPlanesEnabled;if(this.disableClippingPlanes){o.clipPlanesEnabled=false}if(this.disableColorWrite){o.setDisableColorWrite(true)}if(this.disableDepthWrite){o.setDisableDepthWrite(true)}if(this.enableStencilWrite){o.setEnableStencilWrite(true)}if(this.disableBackFaceCulling){o.setDisableBackFaceCulling(true)}var m=[];if(this.hideSurfacesAndUnclipedMeshes){this.scene.traverse(function(A){if(A instanceof c.Mesh&&A.visible){var i=A.material;if(i&&i.enableClipPlanes===false){m.push(A);A.visible=false}}})}var k=o.materialToUse;if(!c.MaterialHasPriority[k]&&this.materialToUse){o.materialToUse=this.materialToUse}if(this.cuttingScene){o.cuttingScene=this.cuttingScene}o.setCurrentPass(this);o.autoClearStencil=false;o.autoClearDepth=false;o.autoClear=false;var u=o.gammaInput;var t=o.gammaOutput;if(this.disableToneMapping){o.gammaInput=false;o.gammaOutput=false}var n=o.renderVolumesOnly;o.renderVolumesOnly=this.hideSurfacesAndUnclipedMeshes;this.prevNormalDepthBuffer&&o.setPreviousNormalDepthBuffer(this.prevNormalDepthBuffer);this.prevColorBuffer&&o.setPreviousColorBuffer(this.prevColorBuffer);if(this.useRenderPriorityOpacity&&o.materialToUse===c.MaterialToUse.originalMaterial){o.useRenderPriorityOpacity=true}var v,l;if(this.stateSortingResult!==null){v=this.stateSortingResult;l=this.updateStateSortingResult}else{v=o._stateSortingResult;l=true}var y;if(this.forceMaterialMode){y=o.materialMode;o.materialMode=true}this.setDLsState(v._displayLists,this.dlsToDisable,false);o.activateSplitScreenMode(!h&&j?false:true);if(h){o.render(this.scene,this.customCamera||s||this.composer.camera,undefined,undefined,undefined,v,l,this.enableGSSOCache&&d.enableGSSOCache)}else{o.render(this.scene,this.customCamera||s||this.composer.camera,j,false,false,v,l,this.enableGSSOCache&&d.enableGSSOCache)}if(this.forceMaterialMode){o.materialMode=y}this.activateAllDLs(v._displayLists);if(this.useRenderPriorityOpacity){o.useRenderPriorityOpacity=false}o.info.render.copyTo(this.info);o.renderVolumesOnly=n;o.gammaInput=u;o.gammaOutput=t;o.setCurrentPass(null);if(this.cuttingScene){o.cuttingScene=null}o.materialToUse=k;for(r=0;r<m.length;r++){m[r].visible=true}o.setDisableColorWrite(false);if(this.disableClippingPlanes){o.clipPlanesEnabled=p}if(this.disableBackFaceCulling){o.setDisableBackFaceCulling(false)}o.setDisableDepthWrite(false);o.setEnableStencilWrite(false);if(this.enableStencilTest){g.disable(g.STENCIL_TEST)}if(this.renderFaces!==null){o.renderFaces=this.oldRenderFaces}if(this.renderLineMode!==null){o.renderLineMode=this.oldRenderLineMode}if(this.renderPoints!==null){o.renderPoints=this.oldRenderPoints}if(this.renderPointMode!==null){o.renderPointMode=this.oldRenderPointMode}if(this.disableBackFaceClipPlanes!=0){o.disableBackFaceClipPlanes=0}o.enableRenderPluginsPre=this.oldRenderPluginsPre;o.enableRenderPluginsPost=this.oldRenderPluginsPost;o.forceMaterialDoubleSide=false;this.scene.overrideMaterial=null;g.stencilFunc(g.ALWAYS,0,255);g.stencilOp(g.KEEP,g.KEEP,g.KEEP);if(this.depthFunc){g.depthFunc(g.LEQUAL)}o.forcePolygonOffset=c.PolygonOffsetForceStatus.DEFAULT}};return a});define("Plugins/RenderPass",["DS/Plugins/RenderPass","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Plugins/RenderPass");return b});define("DS/Plugins/MaskPass",["DS/Visualization/ThreeJS_DS"],function(a){return null});define("Plugins/MaskPass",["DS/Plugins/MaskPass","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Plugins/MaskPass");return b});define("DS/Plugins/ClearMaskPass",["DS/Visualization/ThreeJS_DS"],function(a){return null});define("Plugins/ClearMaskPass",["DS/Plugins/ClearMaskPass","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Plugins/ClearMaskPass");return b});define("DS/Plugins/PluginPass",["DS/Visualization/ThreeJS_DS"],function(b){var a=function(g,d,c,e,f){this.scene=g;this.camera=d;this.name=c;this.cameraName="main";this.plugin=e;this.plugin.init(f);this.composer=null};a.prototype={getDefaultState:function(){return{enabled:false,renderPlugins:false}},setCameraName:function(c){this.cameraName=c},setScene:function(c){this.scene=c},render:function(h,j,e,i,g,k,c,l,f){var d=c[l];h.doRenderPlugins([this.plugin],this.scene,d,e)},dispose:function(){this.plugin.dispose()}};return a});define("Plugins/PluginPass",["DS/Plugins/PluginPass","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Plugins/PluginPass");return b});define("DS/Plugins/UserPass",["UWA/Class"],function(b){var c=0;var a=b.extend({init:function(d){this.id=c++;this.manager=d.manager;this.name=d.name;this.renderList=null||d.renderList;this.enabled=true;this._passes=[];this._inserted=false},enable:function(d){this.enabled=d?true:false;var e;for(e=0;e<this._passes.length;e++){this._passes[e].disabledByDefault=this.enabled?false:true}this.manager._getMainComposer().enableCustomPassNEW(this._passes)},_setupPasses:function(){var d;for(d=0;d<this._passes.length-1;d++){this._passes[d].userPass=this}}});return a});define("DS/Plugins/UserRenderList",["UWA/Class"],function(a){var c=0;var b=a.extend({init:function(d){this.name=d;this.id=c++},_getIdString:function(){return"_userIdString_"+this.id+(this.name?"_"+this.name:"")}});return b});define("DS/Plugins/ShaderPass",["DS/Visualization/ThreeJS_DS"],function(c){var a=1;var b=function(e,f,d){this.textureID=(f!==undefined)?f:"tDiffuse";this.uniforms=c.UniformsUtils.clone(e.uniforms);this.name=d;this.id="S"+(a++);this.defines={};if(e.defines){this.defines=e.defines}this.material=new c.ShaderMaterial({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,defines:this.defines});this.material.force=true;this.material.polygonOffset=true;this.material.polygonOffsetFactor=0;this.material.polygonOffsetUnits=0;this.renderToScreen=false;this.needsSwap=true;this.composer=null;this.requiredComposers=[];this.forceRenderTarget=null;this.order=0;this.isCustomPass=false;this.defaults={};this.linkedComposerContexts=[];this.idString="main";this.changeRenderTargetProperties=null;this.enableWarmStart=false;this.beforeRenderCB=null;this.afterRenderCB=null;this.requiredReadBuffer=null;this.isOITPass=false;this.composer=null;this.disabledByDefault=false;this.order=0;this.gammaCorrectionPass=false;this.isRobotPass=false};b.prototype={compileShader:function(d){d&&d.initMaterial(this.material,[],null,null,this.material.programManager.getProgramID(null));this.material._rendererId=d.context.contextId;this.material.needsUpdate=false},setForceRenderTarget:function(d){this.forceRenderTarget=d},addRequiredComposer:function(d){this.requiredComposers.push(d)},setCustomPass:function(){this.isCustomPass=true},getDefaultState:function(){return{enabled:this.disabledByDefault?false:true,renderToCanvas:false,isLastPass:false}},addLinkedEffectComposerContext:function(d){if(this.linkedComposerContexts.indexOf(d)<0){this.linkedComposerContexts.push(d);d.useCount++}},shareDepth:function(d,g,e){var f=d.composerContext.forceRenderTarget;if(!f){f=d.renderTargetPool.buildRenderTarget(d.composerContext.width,d.composerContext.height,"linear",null,e,true);f.generateMipmaps=false;d.composerContext.forceRenderTarget=f;this.uniforms[d.targetUniform].value=d.composerContext.forceRenderTarget;this.requiredReadBuffer=e}},render:function(l,p,h,o,k,q,d,r,j,f){if(!k&&this.uniforms[this.textureID]){this.uniforms[this.textureID].value=p}if(this.beforeRenderCB){this.beforeRenderCB(p)}var e;for(e=0;e<this.requiredComposers.length;e++){var g=this.requiredComposers[e];if(g.bShareDepth){this.shareDepth(g,l,p)}if(g.needsCameraUpdate){this.requiredComposers[e].composerContext.cameraName=q.cameraName}var m=g.getAllPasses();if(m.length>0&&m[0].uniforms!==undefined){var n=m[0].uniforms;if(n[this.textureID]!==undefined){n[this.textureID].value=p}}this.requiredComposers[e].render(undefined,undefined,d,j)}this.composer.quad.material=this.material;l.setCurrentPass(this);l.autoClearStencil=false;l.autoClearDepth=false;l.activateSplitScreenMode(h?false:true);l.setDisableDepthTest(true);if(this.forceRenderTarget!==null){h=this.forceRenderTarget}if(f){l.render(this.composer.shaderPassScene,this.composer.camera,undefined,undefined,undefined,l._stateSortingResult,true)}else{l.render(this.composer.shaderPassScene,this.composer.camera,h,false,undefined,l._stateSortingResult,true)}l.setDisableDepthTest(false);l.setCurrentPass(null);if(this.afterRenderCB){this.afterRenderCB()}}};return b});define("Plugins/ShaderPass",["DS/Plugins/ShaderPass","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Plugins/ShaderPass");return b});define("DS/Plugins/XMLV6SmartLoaderPassPlugin",["DS/VisuLoaders/XMLV6SmartLoaderPassPlugin"],function(a){return a});define("Plugins/XMLV6SmartLoaderPassPlugin",["DS/Plugins/XMLV6SmartLoaderPassPlugin","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Plugins/XMLV6SmartLoaderPassPlugin");return b});define("DS/Plugins/ClearPass",["DS/Visualization/ThreeJS_DS"],function(b){var a=1;var c=function(d){this.name=d;this.id="C"+(a++);this.clearColor=null;this.clearAlpha=1;this.oldClearColor=new b.Color();this.oldClearAlpha=1;this.clear=true;this.clearbColor=false;this.clearDepth=false;this.needsSwap=false;this.clearStencil=false;this.clearStencilValue=null;this.invertTarget=false;this.scene=null;this.idString=null;this.composer=null;this.order=0;this.disabledByDefault=false;this.isCustomPass=false;this.context=null;this.isRobotPass=false;this.defaults={clear:true,doClearDepth:false}};c.prototype={getDefaultState:function(){return{enabled:this.disabledByDefault?false:true,clear:this.defaults.clear,clearColor:this.clearColor,clearAlpha:this.clearAlpha,doClearDepth:this.defaults.doClearDepth,renderToCanvas:false}},setClearStencil:function(d){this.clearStencil=d},setClearDepth:function(d){this.clearDepth=d},setCustomPass:function(){this.isCustomPass=true},setScene:function(d){this.scene=d},render:function(k,h,m,l,j,n,d,o,i,g){if(this.idString&&this.scene&&this.scene.getNbWebGLObjects(this.idString)===0){return}var e=k.context;if(this.clearColor){this.oldClearColor.copy(k.getClearColor());this.oldClearAlpha=k.getClearAlpha();k.setClearColor(this.clearColor,this.clearAlpha)}if(this.clearStencilValue!==null){e.clearStencil(this.clearStencilValue)}else{e.clearStencil(100)}k.autoClear=false;k.autoClearColor=this.clear||this.clearbColor;k.autoClearDepth=this.clear||this.clearDepth;k.autoClearStencil=this.clear||this.clearStencil;k.setCurrentPass(this);var f=null;if(!g){f=this.invertTarget?h:m}k.setRenderTarget(f);var p;if(k.splitScreenMode){k.activateSplitScreenMode(f?false:true)}else{p=k.getScissorTest();k.enableScissorTest(false)}k.clear(this.clear||this.clearbColor,this.clear||this.clearDepth,this.clear||this.clearStencil);if(!k.splitScreenMode){k.enableScissorTest(p)}k.setCurrentPass(null)}};return c});define("Plugins/ClearPass",["DS/Plugins/ClearPass","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Plugins/ClearPass");return b});define("DS/Plugins/ComposerContext",["DS/Visualization/ThreeJS_DS"],function(g){var b=true;var d=1;var f=30;function c(h){if(!h&&f>0){console.warn("Rendering EffectComposer without specifying a result name");f--}}var e=30;var a=function(m,j,i,n){this.id=d++;if(m===undefined){var k=window.innerWidth||1,h=window.innerHeight||1,l={minFilter:g.LinearFilter,magFilter:g.LinearFilter,format:g.RGBFormat,stencilBuffer:false};m=new g.WebGLRenderTargetProperties(k,h,"uint")}this.renderTargetProperties=m;this.width=this.renderTargetProperties?this.renderTargetProperties.width:undefined;this.height=this.renderTargetProperties?this.renderTargetProperties.height:undefined;this.originalRenderTargetProperties=m;this.name=i;this.readBuffer=null;this.writeBuffer=null;this.renderResults={};this.usedBy=[];this.useCount=1;this.keepResult=false;this.forceRenderTarget=n;this.passes=[];this.passStates=[];this.composer=j;j.contexts.push(this);this.needsUpdate=true;this.cameras=[];this.updateStates();this.onEffectComposerChange=null;Object.defineProperty(this,"renderTarget2",{get:function(){if(e>0){console.warn("Accessing renderTarget2 deprecated property");e--}var o;for(o in this.renderResults){return this.renderResults[o]}return null}});this.beforeRenderCB=null;this.afterRenderCB=null;this.needRequiredReadBuffer=false;this.cameraName="";this.clearReadBuffer=0;this.noIdCheck=false;this.enableGSSOCache=false};a.prototype={getPassState:function(i){var h=this.passes.indexOf(i),j;if(h<0&&i){h=this.passes.length;this.passes.push(i);j=i.getDefaultState();j.pass=i;this.passStates[h]=j}return this.passStates[h]},updateStates:function(){var k=this.composer.getAllPasses();var h=[],j;for(j=0;j<k.length;j++){h.push(this.getPassState(k[j]))}this.passes=k;this.passStates=h;if(this.onEffectComposerChange){this.onEffectComposerChange(this)}},setBeforeRenderCB:function(h){this.beforeRenderCB=h},setAfterRenderCB:function(h){this.afterRenderCB=h},enablePass:function(i,h){if(i){var j=this.getPassState(i);j.enabled=h}},setAsLastPass:function(i,h){if(i){var j=this.getPassState(i);j.isLastPass=h}},enableRenderCuttingElementsPasses:function(h){var j=0,k;for(j=0;j<this.passes.length;j++){k=this.passes[j];if(k.renderCuttingElements&&!k.disabledByDefault){this.enablePass(k,h)}}},setPassClear:function(j,i,l,h){var k=this.getPassState(j);k.clear=i;if(typeof l!=="undefined"){k.clearColor=l}if(typeof h!=="undefined"){k.clearAlpha=h}},setPassRenderToCanvas:function(i,h){var j=this.getPassState(i);j.renderToCanvas=h},setPassClearDepth:function(i,h){var j=this.getPassState(i);j.doClearDepth=h},setRenderPlugins:function(i,h){var j=this.getPassState(i);j.renderPlugins=h},setCamera:function(i,h){var j=this.getPassState(i);j.camera=h},setCameraName:function(h){this.cameraName=h},setTransformCameraCB:function(h){this.transformCameraCB=h},clearReadBufferIfRequired:function(i,h){if(this.clearReadBuffer!==0){if(this.clearReadBuffer!==2){i.pushRenderTarget(this.readBuffer)}this.clearReadBuffer=0;this.readBuffer=null}},swapBuffers:function(k,h,i){var j=this.writeBuffer;this.writeBuffer=this.readBuffer;this.readBuffer=j;if(!this.readBuffer){this.acquireReadBuffer(k,h)}if(!this.writeBuffer&&i){this.acquireWriteBuffer(k,h)}},useWarmStart:function(j,h){var k=this.getPassState(j);var i=k.warmStart[h];if(this.readBuffer){renderTargetPool.pushRenderTarget(this.readBuffer);this.readBuffer=null}this.readBuffer=i;this.clearReadBuffer=2},saveReadRenderTargetForLatterWarmStart:function(j,l,i){var k=this.getPassState(j);if(!k.warmStart){k.warmStart={}}var h=k.warmStart[i];if(h){l.pushRenderTarget(h)}k.warmStart[i]=this.readBuffer;this.clearReadBuffer=2},changeRenderTargetProperties:function(i,j,h){this.clearReadBuffer=1;this.writeBuffer&&j.pushRenderTarget(this.writeBuffer,this);this.writeBuffer=null;i.width=this.width;i.height=this.height;this.renderTargetProperties=i;this.acquireWriteBuffer(j,h)},linkToShaderPassUniform:function(i,h){i.addLinkedEffectComposerContext(this);if(this.usedBy.indexOf(h)<0){this.usedBy.push(h)}},linkTo_internal:function(j,l,h){if(!this.noIdCheck){c(h)}j.value=this.renderResults[h];var k;for(k=0;k<this.usedBy.length;k++){if(this.usedBy[k]===j){return}}this.usedBy.push(j)},removeLinks:function(){this.usedBy=[]},updateLinks:function(h){if(!this.noIdCheck){c(h)}var j;for(j=0;j<this.usedBy.length;j++){this.usedBy[j].value=this.renderResults[h]}},restoreOriginalRenderTargetProperties:function(i,h){if(!i.areRenderTargetOptionsEqual(this.renderTargetProperties,this.originalRenderTargetProperties)){this.renderTargetProperties=this.originalRenderTargetProperties;if(this.renderResults[h]){i.pushRenderTarget(this.renderResults[h]);this.renderResults[h]=null}}},acquireWriteBuffer:function(i,h){if(!this.noIdCheck){c(h)}if(this.renderTargetProperties){if(this.renderResults[h]){this.writeBuffer=this.renderResults[h];this.renderResults[h]=null}else{if(!this.writeBuffer){this.writeBuffer=i.buildRenderTarget(this.renderTargetProperties.width,this.renderTargetProperties.height,this.renderTargetProperties.options||this.renderTargetProperties.optionsId,this)}}}},acquireReadBuffer:function(i,h){if(!this.noIdCheck){c(h)}if(this.renderTargetProperties){if(!this.readBuffer){this.readBuffer=i.buildRenderTarget(this.renderTargetProperties.width,this.renderTargetProperties.height,this.renderTargetProperties.options,this)}}},getResult:function(i,j){var h=this.renderResults[i];if(j){this.renderResults[i]=null}return h},selectResult:function(i,h){this.renderResults[h]=this.writeBuffer;this.writeBuffer=null;if(this.renderResults[h]){this.renderResults[h].useCount=this.useCount}if(this.writeBuffer){i.pushRenderTarget(this.writeBuffer,this);this.writeBuffer=null}if(this.readBuffer){i.pushRenderTarget(this.readBuffer,this);this.readBuffer=null}},releaseRenderTargets:function(j,i){var h=this.renderResults[i];if(!this.keepResult&&h){h.useCount--;if(h.useCount<=0){j.pushRenderTarget(h,this);this.renderResults[i]=null}}},setSize:function(l,h){var k,j,n;for(j=0;j<this.passStates.length;j++){if(n){if(n.warmStart){for(k in n.warmStart){n.warmStart[k].dispose()}n.warmStart=null}}var m=this.passes[j];if(m.requiredReadBuffer){m.requiredReadBuffer.dispose();m.requiredReadBuffer=null}}for(k in this.renderResults){if(this.renderResults[k]){this.renderResults[k].dispose()}}this.renderResults={};if(this.originalRenderTargetProperties){this.originalRenderTargetProperties.width=l;this.originalRenderTargetProperties.height=h}if(this.renderTargetProperties){this.renderTargetProperties.width=l;this.renderTargetProperties.height=h}if(this.forceRenderTarget){this.forceRenderTarget.dispose()}this.forceRenderTarget=null;if(this.readBuffer){this.readBuffer.dispose()}this.readBuffer=null;if(this.writeBuffer){this.writeBuffer.dispose()}this.writeBuffer=null;this.width=l;this.height=h},dispose:function(){this.setSize(0,0)},setGSSOCache:function(h){this.enableGSSOCache=h},setOnEffectComposerChangeCallback:function(h){this.onEffectComposerChange=h;if(h){h(this)}}};return a});define("Plugins/ComposerContext",["DS/Plugins/ComposerContext","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Plugins/ComposerContext");return b});define("DS/Plugins/CSSNodesPass",["DS/Visualization/ThreeJS_DS"],function(b){var a=function(d,c){this.scene=d;this.name=c;this.cameraName="main"};a.prototype={getDefaultState:function(){return{enabled:false,renderPlugins:false}},setScene:function(c){this.scene=c},render:function(h,j,e,i,g,k,c,l,f){var d=c[l];h.updateCSSNodes(this.scene,d)}};return a});define("DS/Plugins/EffectComposer",["DS/Visualization/ThreeJS_DS","DS/Plugins/ShaderPass","DS/Plugins/ComposerContext","DS/Plugins/ClearPass"],function(k,b,i,g){var d="-->";function j(n){var m=false;var l=n.slice(d.length);if(l.startsWith("(")&&l.endsWith(")")){l=l.slice(1,l.length-1);m=true}return{list:l,privateList:false}}function c(r,s){var m;var p="passes",o,q,t=false,n;var l=false;if(s){m=s.indexOf(r.name);if(m<0){throw new Error("unknown added pass")}else{for(o=m;o>=0&&!t;o--){q=s[o];if(q.startsWith(d)){n=j(q);p=n.list;l=n.privateList;t=true}}}}else{m=r.order}return{order:m,list:p,privateList:l}}function a(n,l,m){n.splice.apply(n,[l,0].concat(m))}var f=function(l){this.name=l;this.preCustomPasses=[];this.passes=[];this.postCustomPasses=[];this.privateList=false};f.prototype.addPass=function(p,o,l){if(this.passes.length&&(o!==undefined)){for(var m=0;m<this.passes.length;m++){var n=c(this.passes[m],l).order;if(o<n){this.passes.splice(m,0,p);return}}}this.passes.push(p)};var h=0;var e=function(p,o,s,t){this.renderer=p;this.renderTargetPool=s;this.orderedPassNames=t||null;this.id=h;h++;this.contexts=[];var n;this.passLists=[];if(t){var r,l,m,q;for(n=0;n<t.length;n++){r=t[n];if(r.startsWith(d)){m=j(r);l=m.list;var q=new f(l);q.privateList=m.privateList;this.passLists.push(q)}}}else{this.passLists.push(new f("passes"))}this.passListIndex={};for(n=0;n<this.passLists.length;n++){this.passListIndex[this.passLists[n].name]=n}this.preCustomPasses=[];this.postCustomPasses=[];this.prevNormalDepthBuffer=null;this.prevColorBuffer=null;this.camera=new k.OrthographicCamera(-1,1,1,-1,0,1);this.geometry=[k.createPlaneGeometryDS(2,2)];this.quad=new k.Mesh(this.geometry,null);this.quad.frustumCulled=false;this.quad.visibilityFree=true;this.shaderPassScene=new k.Scene();this.shaderPassScene.add(this.quad);this.renderScene=null;this.enabled=true;if(o){this.composerContext=new i(o,this)}else{this.composerContext=null}this.bShareDepth=false;this.needsCameraUpdate=false;this.targetUniform=null;this.keepResult=false};e.prototype={dispose:function(){this.quad.dispose()},getAllPasses:function(o){o=o||0;var m;var l=[],n;for(m=o;m<this.passLists.length;m++){n=this.passLists[m];if(n.preCustomPasses.length){l=l.concat(n.preCustomPasses)}l=l.concat(n.passes);if(n.postCustomPasses.length){l=l.concat(n.postCustomPasses)}}return l},setComposerContext:function(l){this.composerContext=l},updateComposerContexts:function(m){var l;for(l=0;l<this.contexts.length;l++){this.contexts[l].updateStates(m)}},swapBuffers:function(n,l,m){this.composerContext.swapBuffers(n,l,m)},addPass:function(m){var n=c(m,this.orderedPassNames);var l=n.order;var o=this.passLists[this.passListIndex[n.list]];o.addPass(m,l,this.orderedPassNames);m.composer=this;this.updateComposerContexts()},insertPass:function(m,l,n){n.splice(l,0,m);m.composer=this;this.updateComposerContexts()},enablePass:function(m,l){this.composerContext.enablePass(m,l)},linkToShaderPassUniform:function(n,m,l){this.composerContext.linkToShaderPassUniform(n,m,l)},removeLinks:function(){this.composerContext.removeLinks()},updateScene:function(p){this.renderScene=p;var m=this.getAllPasses();var o=m.length,n,l;for(l=0;l<o;l++){n=m[l];if(n.setScene&&!n.lockScene){n.setScene(p)}}},getRenderResult:function(l){return this.composerContext.renderResults[l]},findRequiredReabBuffer:function(o){if(!this.composerContext.needRequiredReadBuffer){return{forceWriteBufferIndex:-1,requiredReadBuffer:null}}var r=this.getAllPasses();var n=r.length;var q;var l=-1;var m=null;for(var p=o;p<n;p++){q=r[p];if(q&&q.requiredReadBuffer&&this.composerContext.getPassState(q).enabled){m=q.requiredReadBuffer;if(l===-1){l=o}break}if(q instanceof b&&this.composerContext.getPassState(q).enabled){l=p}}if(!m){l=-1}return{forceWriteBufferIndex:l,requiredReadBuffer:m}},render:function(B,A,D,v,p){if(!this.enabled){return}if(!this.composerContext.needsUpdate&&this.composerContext.keepResult){this.renderer.setRenderTarget(this.composerContext.renderResults[v]);return}this.composerContext.restoreOriginalRenderTargetProperties(this.renderTargetPool,v);this.composerContext.acquireWriteBuffer(this.renderTargetPool,v);if((A!==undefined)&&this.composerContext.writeBuffer){this.composerContext.writeBuffer.activeCubeFace=A}if(this.composerContext.beforeRenderCB){this.composerContext.beforeRenderCB(this.composerContext)}var r=this.getAllPasses();var l,o,y,t=r.length,C,x;var u=0;if(p){u=r.indexOf(p);if(u<0){return}this.composerContext.useWarmStart(p,v)}var w=false;var m=(u===0);var q=this.findRequiredReabBuffer(u);for(y=u;y<t;y++){var n=null;l=r[y];if(l.gammaCorrectionPass){w=true}C=this.composerContext.getPassState(l);if(l.clear!==undefined){l.clear=C.clear;l.clearColor=C.clearColor;l.clearAlpha=C.clearAlpha}if(l.setClearDepth){l.setClearDepth(C.doClearDepth)}if(l.setRenderPluginsPre){l.setRenderPluginsPre(C.renderPlugins)}if(l.setRenderPluginsPost){l.setRenderPluginsPost(C.renderPlugins)}if(C.cameraName){n=C.cameraName}else{if(this.composerContext.cameraName){n=this.composerContext.cameraName}else{n=l.cameraName}}if(C.isLastPass){break}if(!C.enabled){continue}var z=l.needsSwap&&u!==y&&!m;var s=y===q.forceWriteBufferIndex;if(s){this.composerContext.readBuffer=this.composerContext.writeBuffer;this.composerContext.writeBuffer=q.requiredReadBuffer}else{if(z){this.swapBuffers(this.renderTargetPool,v,!l.changeRenderTargetProperties)}}if(l.setPreviousColorBuffer){this.prevNormalDepthBuffer&&l.setPreviousNormalDepthBuffer(this.prevNormalDepthBuffer);this.prevColorBuffer&&l.setPreviousColorBuffer(this.prevColorBuffer)}if(l.changeRenderTargetProperties){this.composerContext.changeRenderTargetProperties(l.changeRenderTargetProperties,this.renderTargetPool,v)}if(l.enableWarmStart&&l!==p){this.composerContext.saveReadRenderTargetForLatterWarmStart(l,this.renderTargetPool,v)}if(l.setDisableToneMapping&&w){l.setDisableToneMapping(true)}if(!this.composerContext.forceRenderTarget){l.render(this.renderer,this.composerContext.readBuffer,this.composerContext.writeBuffer,B,m,this.composerContext,D,n,v,C.renderToCanvas)}else{l.render(this.renderer,this.composerContext.readBuffer,this.composerContext.forceRenderTarget,B,m,this.composerContext,D,n,v,C.renderToCanvas)}if(l.requiredReadBuffer){this.composerContext.clearReadBuffer=2}this.composerContext.clearReadBufferIfRequired(this.renderTargetPool,v);if(!(l instanceof g)){m=false}if(l.linkedComposerContexts){for(x=0;x<l.linkedComposerContexts.length;x++){l.linkedComposerContexts[x].releaseRenderTargets(this.renderTargetPool,v)}}}this.composerContext.selectResult(this.renderTargetPool,v);this.composerContext.releaseRenderTargets(this.renderTargetPool,v);this.composerContext.updateLinks(v);if(this.composerContext.afterRenderCB){this.composerContext.afterRenderCB(this.composerContext)}},setSize:function(m,l){if(this.composerContext){this.composerContext.setSize(m,l)}},setPreviousNormalDepthBuffer:function(l){this.prevNormalDepthBuffer=l},setPreviousColorBuffer:function(l){this.prevColorBuffer=l},insertCustomPassAfterPass:function(p,m){var q=this.passLists[this.passListIndex.main];var o=q.preCustomPasses;var l=q.postCustomPasses;var n;p.setCustomPass();if(m){n=o.indexOf(m);if(n>=0){o.splice(n+1,0,p)}else{n=l.indexOf(m);if(n>=0){l.splice(n+1,0,p)}else{throw new Error("Reference custom pass not found")}}}else{l.splice(0,0,p)}this.updateComposerContexts()},insertCustomPassBefore:function(p,m){var q=this.passLists[this.passListIndex.main];var o=q.preCustomPasses;var l=q.postCustomPasses;p.setCustomPass();var n;if(m){n=o.indexOf(m);if(n>=0){o.splice(n,0,p)}else{n=l.indexOf(m);if(n>=0){l.splice(n,0,p)}else{throw new Error("Reference custom pass not found")}}}else{o.push(p)}this.updateComposerContexts()},getPassList:function(l){return this.passLists[this.passListIndex[l]]},insertCustomPassBeforeNEW:function(q,m){if(!m){return false}if(!(q instanceof Array)){q=[q]}var p,o,s,n,r=false,l;if(typeof m==="string"||m instanceof String){s=this.getPassList(m);if(s.privateList){return false}a(s.preCustomPasses,s.preCustomPasses.length-1,q)}else{for(p=0;p<this.passLists.length&&!r;p++){s=this.passLists[p];l=[s.preCustomPasses,s.postCustomPasses];for(o=0;o<l.length&&!r;o++){n=l[o].indexOf(m);if(n>=0){a(l[o],n,q);r=true}}}if(!r){console.warn("ERROR: Reference custom pass not found");return false}}for(p=0;p<q.length;p++){q[p].context=this}this.updateComposerContexts();return true},insertCustomPassAfterNEW:function(q,m){if(!m){return false}if(!(q instanceof Array)){q=[q]}var p,o,s,n,r=false,l;if(typeof m==="string"||m instanceof String){s=this.getPassList(m);if(s.privateList){return false}a(s.postCustomPasses,0,q)}else{for(p=0;p<this.passLists.length&&!r;p++){s=this.passLists[p];l=[s.preCustomPasses,s.postCustomPasses];for(o=0;o<l.length&&!r;o++){n=l[o].indexOf(m);if(n>=0){a(l[o],n+1,q);r=true}}}if(!r){console.warn("ERROR: Reference custom pass not found");return false}}for(p=0;p<q.length;p++){q[p].context=this}this.updateComposerContexts();return true},removeCustomPassNEW:function(p){var o,n,m,q,r=p[0],s,l;for(o=0;o<this.passLists.length&&!q;o++){s=this.passLists[o];l=[s.preCustomPasses,s.postCustomPasses];for(n=0;n<l.length&&!q;n++){m=l[n].indexOf(r);if(m>=0){l[n].splice(m,p.length);q=true}}}this.updateComposerContexts()},enableCustomPassNEW:function(n){var m,o,l;for(m=0;m<n.length;m++){o=n[m];for(l=0;l<this.contexts.length;l++){this.contexts[l].enablePass(o,o.disabledByDefault?false:true)}}this.updateComposerContexts()},removePasses:function(p){var o,q,r,n,m,l;for(o=0;o<this.passLists.length&&!q;o++){r=this.passLists[o].passes;q=false;for(m=0;m<p.length;m++){n=r.indexOf(p[m]);if(n>=0){q=true;r[n]=null}}if(q){l=0;for(m=0;m<r.length;m++){if(r[m]){r[l]=r[m];l++}}r.length=l}}this.updateComposerContexts()},updateLinks:function(l){this.composerContext.updateLinks(l)},getPostEffectPasses:function(){var m="postEffects1";var o=this.passListIndex[m];var l=[];var n=0;for(n=o;n<this.passLists.length;n++){if(n>o){l=l.concat(this.passLists[n].preCustomPasses)}l=l.concat(this.passLists[n].passes);l=l.concat(this.passLists[n].postCustomPasses)}return l}};return e});define("Plugins/EffectComposer",["DS/Plugins/EffectComposer","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Plugins/EffectComposer");return b});define("DS/Plugins/UserSceneGraphPass",["DS/Plugins/UserPass","DS/Plugins/RenderPass"],function(a,c){function b(e){return e?true:false}"use strict";var d=a.extend({init:function(e){this._parent(e);this.mainPass=new c(null,null,null,null,null,null,"_UserSceneGraphPass_"+this.id+"_"+this.name);this.sectionCappingPass=new c(null,null,null,true,false,false,"passSectionCappingFrontFaces");this.sectionCappingPass.setRenderCuttingElements(true);this.sectionCappingPass.setEnableStencilTest(true);this.sectionCappingPass.setEnableStencilWrite(true);this.sectionCappingPass.setDisableColorWrite(true);this.sectionCappingPass.setDisableDepthWrite(true);this.sectionCappingPass.setStencilFunc("ALWAYS");this.sectionCappingPass.setStencilOps("INCR_WRAP","DECR_WRAP");this.sectionCappingPass.setDisableBackFaceCulling(true);this.sectionCappingPass.setHideSurfacesAndUnclippedMeshes(true);this.sectionCappingPass.setDisableBackFaceClipPlanes(+1);this.sectionCappingPass.setRenderPluginsPre(false);this.sectionCappingPass.setRenderPluginsPost(false);this.sectionCappingPass.ignoreNoZ=true;this._passes.push(this.mainPass);this._passes.push(this.sectionCappingPass)},setDisableColorWrite:function(e){this._passes[0].setDisableColorWrite(b(e))},setDisableDepthWrite:function(e){this._passes[0].setDisableDepthWrite(b(e))},setDisableBackFaceCulling:function(e){this._passes[0].setDisableBackFaceCulling(b(e))},setEnableStencilWrite:function(e){this._passes[0].setEnableStencilWrite(b(e))},setEnableStencilTest:function(e){this._passes[0].setEnableStencilTest(b(e))},setStencilOps:function(f,e){this._passes[0].setStencilOps(f,e)},setStencilOpsSeparate:function(h,e,g,f){this._passes[0].setStencilOpsSeparate(h,e,g,f)},setStencilFunc:function(e){this._passes[0].setStencilFunc(e)},setCullFaceMode:function(e){this._passes[0].setCullFaceMode(e)},setDepthFunc:function(e){this._passes[0].setDepthFunc(e)},});return d});define("DS/Plugins/UserClearPass",["DS/Plugins/UserPass","DS/Plugins/ClearPass"],function(a,d){function b(e){return e?true:false}"use strict";var c=a.extend({init:function(f){this._parent(f);var e=new d("_UserClearPass_"+this.id+"_"+this.name);e.defaults.clear=false;e.clear=false;this._passes.push(e)},setClearDepth:function(e){this._passes[0].defaults.doClearDepth=b(e)},setClearStencil:function(e,f){if(f!==undefined){this._passes[0].clearStencilValue=f}this._passes[0].clearStencil=e}});return c});define("DS/Plugins/UserRenderPass",["DS/Plugins/UserPass","DS/Plugins/RenderPass"],function(a,d){function c(e){return e?true:false}"use strict";var b=a.extend({init:function(f){this._parent(f);var e=new d(null,null,null,null,null,null,"_UserRenderPass_"+this.id+"_"+this.name);this._passes.push(e)},setDisableColorWrite:function(e){this._passes[0].setDisableColorWrite(c(e))},setDisableDepthWrite:function(e){this._passes[0].setDisableDepthWrite(c(e))},setDisableBackFaceCulling:function(e){this._passes[0].setDisableBackFaceCulling(c(e))},setEnableStencilWrite:function(e){this._passes[0].setEnableStencilWrite(c(e))},setEnableStencilTest:function(e){this._passes[0].setEnableStencilTest(c(e))},setStencilOps:function(f,e){this._passes[0].setStencilOps(f,e)},setStencilOpsSeparate:function(h,e,g,f){this._passes[0].setStencilOpsSeparate(h,e,g,f)},setStencilFunc:function(e){this._passes[0].setStencilFunc(e)},setCullFaceMode:function(e){this._passes[0].setCullFaceMode(e)},setDepthFunc:function(e){this._passes[0].setDepthFunc(e)},});return b});define("DS/Plugins/UserPassManager",["UWA/Class","DS/Plugins/UserRenderPass","DS/Plugins/UserClearPass","DS/Plugins/UserRenderList","DS/Plugins/UserPass","DS/Plugins/UserSceneGraphPass"],function(d,c,h,e,a,f){var b=d.extend({init:function(i){this.viewer=i;this._activeUserPasses=[];this._activeRenderLists=null;this._updateRenderLists()},createUserRenderPass:function(i,j){var k=new c({manager:this,name:i,renderList:j});if(j){this._setUserPassRenderList(k,j)}return k},createUserClearPass:function(i,k){var j=new h({manager:this,name:i,renderList:k});if(k){this._setUserPassRenderList(j,k)}return j},createUserSceneGraphPass:function(i,k){var j=new f({manager:this,name:i,renderList:k});if(k){this._setUserPassRenderList(j,k)}return j},getSystemPass:function(i){var j=g[i];return j||null},insertUserPassAfterPass:function(k,i){if(k._systemPass){console.warn("ERROR: Invalid arguments");return}if(k._inserted){console.warn("ERROR: Already inserted pass");return}var j;if(i instanceof a){j=i._passes[i._passes.length-1]}else{j=i._list}if(this._getMainComposer().insertCustomPassAfterNEW(k._passes,j)){k._inserted=true;this._activeUserPasses.push(k);this._updateRenderLists()}},insertUserPassBeforePass:function(k,i){if(k._systemPass){console.warn("ERROR: Invalid arguments");return}if(k._inserted){console.warn("ERROR: Already inserted pass");return}var j;if(i instanceof a){j=i._passes[0]}else{j=i._list}if(this._getMainComposer().insertCustomPassBeforeNEW(k._passes,j)){k._inserted=true;this._activeUserPasses.push(k);this._updateRenderLists()}},removeUserPass:function(j){var i=this._activeUserPasses.indexOf(j);if(i>=0){this._getMainComposer().removeCustomPassNEW(j._passes);this._activeUserPasses.splice(i,1);j._inserted=false;this._updateRenderLists()}},_setUserPassRenderList:function(l,k){var j;for(j=0;j<l._passes.length;j++){l._passes[j].idString=k._getIdString()}},_updateRenderLists:function(){var k,l;this._activeRenderLists=["main","noz","afterHighlightNoZ"];for(k=0;k<this._activeUserPasses.length;k++){l=this._activeUserPasses[k];if(l.renderList&&l.enabled){var j=l.renderList._getIdString();if(this._activeRenderLists.indexOf(j)<0){this._activeRenderLists.push(j)}}}},_getActiveRenderLists:function(){return this._activeRenderLists},_getMainComposer:function(){return this.viewer.renderer.mainComposer},_dispose:function(){this.viewer=null;this._activeUserPasses=null;this._activeRenderLists=null}});var g={infinitePlane:{_list:"infPlane",_systemPass:true},main:{_list:"main",_systemPass:true},noz:{_list:"noz",_systemPass:true},afterHighlightNoz:{_list:"afterHighlightNoz",_systemPass:true},robot:{_list:"robot",_systemPass:true},canvas2D:{_list:"noEffectCanvas2DPass",_systemPass:true}};return b});