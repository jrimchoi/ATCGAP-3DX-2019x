define("DS/RTUserPresenceAPI/RTUPavatar",["UWA/Class/View","DS/UIKIT/Tooltip"],function(a){return a.extend({tagName:"div",className:"RTUPavatar",render:function(){this.container.setContent([{tag:"img","class":"img-responsive img-rounded",src:this.model.get("avatarUrl"),alt:this.model.get("username")}]);return this},inject:function(b){this.container.inject(b);return this},destroy:function(){this.stopListening();this.model=null;this._parent()}})});define("DS/RTUserPresenceAPI/RTUPuser",["UWA/Class/Model"],function(a){return a.extend({defaults:{login:"noLogin",presence:"Offline",username:"username",noAvatar:false,avatarUrl:"./resources/en/1/webapps/InstantMessaging/assets/avatarDefault.png"}})});define("DS/RTUserPresenceAPI/RTUPbadge",["UWA/Class/View","DS/UIKIT/Tooltip"],function(c,b){const a={};a.offline="#d1d4d4";a.online="#57B847";a.busy="#EA4F37";a.away="#E87B00";return c.extend({tagName:"div",className:"RTUPbadge",render:function(){var d,f=(this.model.get("presence")||"Unknown").toLowerCase();var e=a[f]||a.offline;switch(f){case"away":d="fonticon-cancel";break;case"offline":d="";break;case"busy":d="fonticon-minus";break;case"online":d="fonticon-check";break;default:d="fonticon-3ds-why"}this.container.setContent([{tag:"span","class":"fonticon "+d,styles:{background:e}}]);this.container.getElement(".fonticon").addClassName=function(){};if(d=="fonticon-3ds-why"){this.hide()}else{this.show()}if(this.model.get("noAvatar")){this.container.addClassName("alone")}return this},setup:function(){this.listenTo(this.model,"onChange:presence",this.render)},inject:function(d){this.container.inject(d);return this},destroy:function(){this.stopListening();this.model=null;this._parent()}})});define("DS/RTUserPresenceAPI/RTUserPresenceAPI",["DS/PlatformAPI/PlatformAPI","UWA/Class/View","DS/RTUserPresenceAPI/RTUPuser","DS/RTUserPresenceAPI/RTUPbadge","DS/RTUserPresenceAPI/RTUPavatar","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","css!../RTUserPresenceAPI/RTUserPresenceAPI.css"],function(b,f,d,g,c,e){var a=true;return f.extend({tagName:"div",className:"RTUPAPI",setup:function(h){if(!h.tenantId){return console.error("RTUserPresenceAPI needs tenantId")}if(!h.login){return console.error("RTUserPresenceAPI needs login")}if(h.swymUrl||h.devEnv||h.noAvatar){return this._setup(h)}e.getServiceUrl({serviceName:"3DSwym",platformId:h.tenantId,onComplete:(function(i){return function(j){h.swymUrl=j;i._setup(h)}})(this),onFailure:function(i){console.error("RTUserPresenceAPI failed to retrieved 3DSwym url via i3DXCompassPlatformServices.getServiceUrl")}})},_setup:function(i){var h=new d({login:i.login,presence:"Unknown",noAvatar:i.noAvatar&&!a,username:i.username,avatarUrl:(i.devEnv&&!i.noAvatar)?"./assets/avatarDefault.png":i.swymUrl+"/api/user/getpicture/login/"+i.login+"/format"});this.user=h;this.tenant=i.tenantId;this.noAvatar=i.noAvatar;this.setupDone=true;b.subscribe(i.login,(function(j){return function(k){return j.platformListener(k)}})(this));b.subscribe("towidgetim.ds.com",(function(j){return function(k){if(k.evenement=="CONNECTED"){return j.getStatus(k)}}})(this));this.getStatus();if(!this.noAvatar){this.avatar=new c({model:h,id:"AvatarView-"+h.cid})}else{if(!a){this.container.addClassName("noAvatar")}}this.badge=new g({model:h,id:"BadgeView-"+h.cid});if(i.size){this.container.style.width=i.size;this.container.style.height=i.size;if(i.size=="80px"){this.container.addClassName("big")}}if(i.onclick){this.container.onclick=i.onclick;this.container.addClassName("clickable")}if(i.renderTo){this.render().inject(i.renderTo)}else{if(this.goRender){this.render()}}},platformListener:function(h){switch(h.action){case"setStatus":if(h.login===this.user.get("login")){this.user.set("presence",h.status)}break;case"logout":this.user.set("presence","Offline");break}},getStatus:function(){b.publish("im.ds.com",{login:this.user.get("login"),tenant:this.tenant,action:"getStatus"})},render:function(){this.container.setContent([]);if(this.setupDone){if(!this.noAvatar){this.avatar.render().inject(this.container)}this.badge.render().inject(this.container)}else{this.goRender=true}return this},inject:function(h){return this.container.inject(h)},destroy:function(){b.unsubscribe("towidgetim.ds.com");if(this.user){b.unsubscribe(this.user.get("login"))}this.stopListening();if(this.avatar){this.avatar.destroy()}if(this.badge){this.badge.destroy()}this.model=null;this._parent()}})});