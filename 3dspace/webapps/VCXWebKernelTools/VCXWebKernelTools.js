define("DS/VCXWebKernelTools/VCXMathTools",["UWA/Class","DS/Visualization/ThreeJS_DS",],function(a,b){var c=a.singleton({init:function(){}});c.getOFromMatrix=function(d){return new b.Vector3(d.elements[12],d.elements[13],d.elements[14])};c.getVxFromMatrix=function(d){return new b.Vector3(d.elements[0],d.elements[1],d.elements[2])};c.getVyFromMatrix=function(d){return new b.Vector3(d.elements[4],d.elements[5],d.elements[6])};c.getVzFromMatrix=function(d){return new b.Vector3(d.elements[8],d.elements[9],d.elements[10])};c.getMatrixFromOVxVy=function(e,h,g){var d=h.clone();var f=new b.Vector3().crossVectors(h,g).normalize();d.normalize();var i=new b.Vector3().crossVectors(f,d).normalize();var j=new b.Matrix4().makeBasis(d,i,f).setPosition(e);return j};c.getMatrixFromOVxVz=function(d,g,e){var f=new b.Vector3().crossVectors(e,g);return this.getMatrixFromOVxVy(d,g,f)};c.getMatrixFromOVyVz=function(d,f,e){var g=new b.Vector3().crossVectors(f,e);return this.getMatrixFromOVxVy(d,g,e)};c.getMatrixFromOVx=function(e,g){var d=g.clone().normalize();var f=new b.Vector3().crossVectors(new b.Vector3(0,0,1),d);if(f.lengthSq()<0.0001){f=new b.Vector3(0,1,0)}return this.getMatrixFromOVxVy(e,d,f)};c.getMatrixFromOVy=function(d,e){var g=e.clone().normalize();var f=new b.Vector3().crossVectors(g,new b.Vector3(0,0,1));if(f.lengthSq()<0.0001){f=new b.Vector3(1,0,0)}return this.getMatrixFromOVxVy(d,f,g)};c.getMatrixFromOVz=function(e,g){var f=g.clone().normalize();var h=new b.Vector3().crossVectors(new b.Vector3(0,0,1),f);var d;if(h.lengthSq()<0.0001){h=new b.Vector3(1,0,0)}return this.getMatrixFromOVxVz(e,h,f)};c.getNearestPointsBetween2Lines=function(p,o,n,l){var s={};var r=o.clone().normalize();var q=l.clone().normalize();if(Math.abs(r.dot(q))>0.99999){var g=((n.x-p.x)*r.x+(n.y-p.y)*r.y+(n.z-p.z)*r.z);s.p1=p.clone().add(r.clone().multiplyScalar(g));s.p2=n.clone()}else{var j=r.dot(q);var e=(1-j*j);if(e<0.00001){return null}var m=new b.Vector3().subVectors(n,p);var f=m.dot(r);var d=-m.dot(q);var i=(f+j*d)/e;var h=(d+j*i);s.p1=p.clone().add(r.clone().multiplyScalar(i));s.p2=n.clone().add(q.clone().multiplyScalar(h))}return s};c.getNearestDistanceBetween2Lines=function(f,h,e,g){var d=c.getNearestPointsBetween2Lines(f,h,e,g);d.d=d.p1.distanceTo(d.p2);return d};c.getNearestDistanceSquaredBetween2Lines=function(f,h,e,g){var d=c.getNearestPointsBetween2Lines(f,h,e,g);d.d=d.p1.distanceToSquared(d.p2);return d};c.IsMat1EqualsToMat2=function(g,f,d){if(!g&&!f){return true}if(g&&f){if(!d){d=0.00001}var e=0;for(e=0;e<16;e++){if(Math.abs(g.elements[e]-f.elements[e])>d){return false}}return true}return false};c.isLineIntersectCircle=function(g,f,e,j,h,n){var k=new b.Plane();k.setFromNormalAndCoplanarPoint(h,e);var l=k.intersectLine(new b.Line3(g,f));if(!l){return false}var m=j-n;var i=j+n;var d=l.distanceToSquared(e);return d>(m*m)&&d<(i*i)};c.getPointProjectionOnLine=function(d,h,f){var e=new b.Vector3().subVectors(f,d);var g=h;return new b.Vector3().addVectors(d,g.clone().multiplyScalar(e.dot(g)/g.dot(g)))},c.isLineIntersectPoint=function(d,j,i,e){var g=new b.Vector3().subVectors(i,d);var h=new b.Vector3().subVectors(j,d);var f=new b.Vector3().addVectors(d,h.clone().multiplyScalar(g.dot(h)/h.dot(h)));return f.distanceToSquared(i)<(e*e)},c.isOnPlane=function(f,h,g,e){var d=new b.Vector3().subVectors(f,h);return d.dot(g)<e?e:0.001},c.isOnCylinder=function(m,e,p,l,n,r){var i=new b.Vector3(p*0.5*n.x,p*0.5*n.y,p*0.5*n.z);var h=new b.Vector3(e.x-i.x,e.y-i.y,e.z-i.z);var g=new b.Vector3(e.x+i.x,e.y+i.y,e.z+i.z);var o=c.getPointProjectionOnLine(h,i,m);var f=new b.Vector3().subVectors(h,o);var d=new b.Vector3().subVectors(g,o);if(f.dot(d)>0){return false}var k=o.distanceToSquared(m);var q=l-r;var j=l+r;return k>(q*q)&&k<(j*j)},c.isOnCone=function(k,o,s,r,l,t){var g=o;var f=new b.Vector3(o.x+r*l.x,o.y+r*l.y,o.z+r*l.z);var q=c.getPointProjectionOnLine(g,l,k);var e=new b.Vector3().subVectors(g,q);var d=new b.Vector3().subVectors(f,q);var i=new b.Vector3().subVectors(g,k);if(e.dot(d)>0){return false}var j=k.distanceTo(q);var n=j/Math.tan(s);var p=q.distanceToSquared(o);var h=n-t;var m=n+t;return p>(h*h)&&p<(m*m)},c.isOnSphere=function(i,j,f,e){var g=i.distanceToSquared(j);var d=f-e;var h=f+e;return g>(d*d)&&g<(h*h)};return c});define("DS/VCXWebKernelTools/VCXEnums",["UWA/Class","DS/Visualization/ThreeJS_DS",],function(a,b){var c=a.singleton({init:function(){}});c.Color={White:new b.Color().setRGB(1,1,1),Black:new b.Color().setRGB(0,0,0),GreyDark:new b.Color().setRGB(0.1,0.1,0.1),Grey:new b.Color().setRGB(0.5,0.5,0.5),Gold:new b.Color().setRGB(1,0.766744,0.334458),Aluminium:new b.Color().setRGB(111/255,114/255,115/255),Satin:new b.Color().setRGB(235/255,129/255,177/255)};c.TextureMapping={None:0,Planar:1,Spherical:2,Cubic:3,CylindricalFinite:4,CylindricalInfinite:5};c.EnvironmentalId={None:0,Chromic:1,Metal:2,MetalBrushed:3,Plastic:4,Glass:5,GlassPlastic:6,ChromicWithColor:7,Gold:8,Unknown:9,Aluminium:10,Satin:11};c.PrimitiveType={None:0,Line:1,Disc:4,Square:5,Cube:6,Sphere:7,Cylinder:8,Cone:9};c.ERenderMode={Smooth:0,SmoothWithOutlines:1,Technical:2,FlatTechnical:3,Silhouette:4,Custom:11,};return c});define("DS/VCXWebKernelTools/VCXLogServices",["UWA/Class"],function(a){var b=a.singleton({});b._logs={};b.memoryLog=function(f,c,g){if(window._startApplicationTime===undefined){window._startApplicationTime=new Date().getTime()*0.001;if(window.performance.memory){console.log("[HEAP] WARNING : set this arg to chrome to see good values : --enable-precise-memory-info")}}var e={};var h="";if(window.performance.memory){if(window.gc){window.gc()}e.memory=window.performance.memory.usedJSHeapSize/1048576}e.time=new Date().getTime()*0.001;if(c){b._logs[f]=e}else{if(b._logs[f]){if(window.performance.memory){e.deltaMemory=e.memory-b._logs[f].memory}e.deltaTime=e.time-b._logs[f].time}else{console.warn("VCXLogServices can't find corresponding start");e.deltaMemory=e.memory}}var d=Math.floor(e.memory);if(window.performance.memory){h+="[HEAP] =\t"+d+"\tMo, "}var i=(e.time-window._startApplicationTime).toLocaleString(undefined,{maximumSignificantDigits:2,minimumSignificantDigits:2});h+="[TIME] =\t"+i+"\ts";if(c){h+=", ["+f+" START]"}else{h+=", ["+f+" END]";h+=", [DELTA HEAP] =\t"+Math.floor(e.deltaMemory)+"\tMo";h+=", [DELTA TIME] =\t"+e.deltaTime.toLocaleString(undefined,{maximumSignificantDigits:2,minimumSignificantDigits:2})+"\ts"}console.log(h);return{logName:f,time:i,heap:d}};return b});define("DS/VCXWebKernelTools/VCXMimeTypeServices",["UWA/Class"],function(a){var b=a.singleton({init:function(){this._mapTypes=null;this._mapTypesInv=null},InitMimeTypes:function(){this._mapTypes={};this._mapTypes[".txt"]="text/plain";this._mapTypes[".text"]="text/plain";this._mapTypes[".html"]="text/html";this._mapTypes[".htm"]="text/html";this._mapTypes[".gif"]="image/gif";this._mapTypes[".png"]="image/png";this._mapTypes[".jpeg"]="image/jpeg";this._mapTypes[".jpg"]="image/jpeg";this._mapTypes[".svg"]="image/svg+xml";this._mapTypes[".bmp"]="image/bitmap";this._mapTypes[".tiff"]="image/tiff";this._mapTypes[".tif"]="image/tiff";this._mapTypes[".tga"]="image/x-tga";this._mapTypes[".hdr"]="image/vnd.radiance";this._mapTypes[".doc"]="application/msword";this._mapTypes[".pdf"]="application/pdf";this._mapTypes[".zip"]="application/zip";this._mapTypes[".xml"]="application/xml";this._mapTypes[".xsl"]="application/xml";this._mapTypes[".json"]="application/json";this._mapTypes[".xls"]="application/vnd.ms-excel";this._mapTypes[".ppt"]="application/vnd.ms-powerpoint";this._mapTypes[".mpp"]="application/vnd.ms-project";this._mapTypes[".mpt"]="application/vnd.ms-project";this._mapTypes[".docx"]="application/vnd.openxmlformats-officedocument.wordprocessingml.document";this._mapTypes[".pptx"]="application/vnd.openxmlformats-officedocument.presentationml.presentation";this._mapTypes[".xlsx"]="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";this._mapTypes[".mp4a"]="audio/mp4";this._mapTypes[".mp3"]="audio/mpeg";this._mapTypes[".mpga"]="audio/mpeg";this._mapTypes[".ogg"]="audio/ogg";this._mapTypes[".wav"]="audio/x-wav";this._mapTypes[".mp4"]="video/mp4";this._mapTypes[".mpeg"]="video/mpeg";this._mapTypes[".webm"]="video/webm";this._mapTypes[".ogv"]="video/ogg";this._mapTypes[".avi"]="video/x-msvideo"},InitMimeTypesInv:function(){this._mapTypesInv={};this._mapTypesInv["text/plain"]=".txt";this._mapTypesInv["text/html"]=".html";this._mapTypesInv["image/gif"]=".gif";this._mapTypesInv["image/png"]=".png";this._mapTypesInv["image/jpeg"]=".jpeg";this._mapTypesInv["image/svg+xml"]=".svg";this._mapTypesInv["image/bitmap"]=".bmp";this._mapTypesInv["image/tiff"]=".tiff";this._mapTypesInv["image/x-tga"]=".tga";this._mapTypesInv["image/vnd.radiance"]=".hdr";this._mapTypesInv["application/msword"]=".doc";this._mapTypesInv["application/pdf"]=".pdf";this._mapTypesInv["application/zip"]=".zip";this._mapTypesInv["application/xml"]=".xml";this._mapTypesInv["application/json"]=".json";this._mapTypesInv["application/vnd.ms-excel"]=".xls";this._mapTypesInv["application/vnd.ms-powerpoint"]=".ppt";this._mapTypesInv["application/vnd.ms-project"]=".mpp";this._mapTypesInv["application/vnd.ms-project"]=".mpt";this._mapTypesInv["application/vnd.openxmlformats-officedocument.wordprocessingml.document"]=".docx";this._mapTypesInv["application/vnd.openxmlformats-officedocument.presentationml.presentation"]=".pptx";this._mapTypesInv["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]=".xlsx";this._mapTypesInv["audio/mp4"]=".mp4a";this._mapTypesInv["audio/mpeg"]=".mp3";this._mapTypesInv["audio/ogg"]=".ogg";this._mapTypesInv["audio/x-wav"]=".wav";this._mapTypesInv["video/mp4"]=".mp4";this._mapTypesInv["video/mpeg"]=".mpeg";this._mapTypesInv["video/webm"]=".webm";this._mapTypesInv["video/ogg"]=".ogv";this._mapTypesInv["video/x-msvideo"]=".avi"},GetMimeType:function(d){if(this._mapTypes){}else{this.InitMimeTypes()}var c="";if(d.lastIndexOf(".")>0){c=d.substr(d.lastIndexOf(".")).toLowerCase()}else{c=d}var e=this._mapTypes[c];if(e){}else{e="application/octet-stream"}return e},GetExtension:function(c){if(this._mapTypesInv){}else{this.InitMimeTypesInv()}var d=this._mapTypesInv[c];if(d){}else{console.log("Extension not found!")}return d}});return b});define("DS/VCXWebKernelTools/VCXMeshServices",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils","DS/VCXWebKernelTools/VCXEnums"],function(a,c,b,d,e){var f=a.singleton({init:function(){this.sharing=false;this.optimized=false;this._primitives=[null,null,null,null,null,null,null,null,null,null]},allocIndexationArray:function(h,g){if(!g){return new Uint32Array(h)}else{if(g<65536){return new Uint16Array(h)}else{return new Uint32Array(h)}}},getPrimitiveMeshNode:function(g){var h=null;switch(g){case e.PrimitiveType.Line:if(this._primitives[g]===null){this._primitives[g]=b.createLineNode({points:[new c.Vector3(0,0,0),new c.Vector3(0,0,1)]})}h=this._primitives[g];break;case e.PrimitiveType.Disc:if(this._primitives[g]===null){this._primitives[g]=b.createCircleNode({radius:1,segments:32,fill:true,startAngle:0,endAngle:2*Math.PI})}h=this._primitives[g];break;case e.PrimitiveType.Square:if(this._primitives[g]===null){this._primitives[g]=b.createRectangleNode({width:1,height:1,fill:true});var i=this._primitives[g].getMatrix();i.setPosition({x:-0.5,y:-0.5,z:0});this._primitives[g].setMatrix(i)}h=this._primitives[g];break;case e.PrimitiveType.Cube:if(this._primitives[g]===null){this._primitives[g]=b.createCuboidNode({cornerPoint:new c.Vector3(-0.5,-0.5,-0.5),firstAxis:new c.Vector3(1,0,0),secondAxis:new c.Vector3(0,1,0),thirdAxis:new c.Vector3(0,0,1)})}h=this._primitives[g];break;case e.PrimitiveType.Sphere:if(this._primitives[g]===null){this._primitives[g]=b.createSphereNode({radius:1})}h=this._primitives[g];break;case e.PrimitiveType.Cylinder:if(this._primitives[g]===null){this._primitives[g]=b.createCylinderNode({bottomCenterPoint:new c.Vector3(0,0,-1),topCenterPoint:new c.Vector3(0,0,1),radius:1})}h=this._primitives[g];break;case e.PrimitiveType.Cone:if(this._primitives[g]===null){this._primitives[g]=b.createConeNode({bottomCenterPoint:new c.Vector3(0,0,-1),topCenterPoint:new c.Vector3(0,0,1),bottomRadius:1,topRadius:0,})}h=this._primitives[g];break;default:h=null;break}return h},computeSmoothNormalsTrianglesSet:function(k,l){if(!k||!l){return null}if(l.length%3!==0){console.error("VCXMeshServices : Invalid data for mesh set node")}var w=new Float32Array(k.length);if(w.fill){w.fill(0,0,k.length)}var q=l.length/3;for(var m=0;m<q;++m){var r=3*l[3*m];var p=3*(l[3*m+1]);var o=3*(l[3*m+2]);var j={x:k[r],y:k[r+1],z:k[r+2]};var h={x:k[p],y:k[p+1],z:k[p+2]};var x={x:k[o],y:k[o+1],z:k[o+2]};var t={x:(h.x-j.x),y:(h.y-j.y),z:(h.z-j.z)};var s={x:(x.x-j.x),y:(x.y-j.y),z:(x.z-j.z)};var n={x:(t.y*s.z-t.z*s.y),y:(t.z*s.x-t.x*s.z),z:(t.x*s.y-t.y*s.x)};w[r]+=n.x;w[r+1]+=n.y;w[r+2]+=n.z;w[p]+=n.x;w[p+1]+=n.y;w[p+2]+=n.z;w[o]+=n.x;w[o+1]+=n.y;w[o+2]+=n.z}for(var m=0;m<k.length;m+=3){var n={x:w[m],y:w[m+1],z:w[m+2]};var g=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);w[m]=n.x/g;w[m+1]=n.y/g;w[m+2]=n.z/g}return w},computeSmoothNormalsStripSet:function(o,s,g){if(!o||!s){return null}var q=new Float32Array(o.length);if(q.fill){q.fill(0,0,o.length)}var B=0;var A=g.length;for(var z=0;z<A;++z){var x=g[z];for(var y=0;y<x-2;++y){var r=3*s[B+y];var p=3*(s[B+y+1]);var n=3*(s[B+y+2]);var k={x:o[r],y:o[r+1],z:o[r+2]};if((y&1)){var h={x:o[p],y:o[p+1],z:o[p+2]};var j={x:o[n],y:o[n+1],z:o[n+2]}}else{var j={x:o[p],y:o[p+1],z:o[p+2]};var h={x:o[n],y:o[n+1],z:o[n+2]}}var w={x:(j.x-k.x),y:(j.y-k.y),z:(j.z-k.z)};var t={x:(h.x-k.x),y:(h.y-k.y),z:(h.z-k.z)};var m={x:(w.y*t.z-w.z*t.y),y:(w.z*t.x-w.x*t.z),z:(w.x*t.y-w.y*t.x)};q[r]+=m.x;q[r+1]+=m.y;q[r+2]+=m.z;q[p]+=m.x;q[p+1]+=m.y;q[p+2]+=m.z;q[n]+=m.x;q[n+1]+=m.y;q[n+2]+=m.z}B+=x}if(o.length%3!==0){console.error("VCXMeshServices : Invalid data for mesh set node")}for(var y=0;y<o.length;y+=3){var m={x:q[y],y:q[y+1],z:q[y+2]};var l=Math.sqrt(m.x*m.x+m.y*m.y+m.z*m.z);q[y]=m.x/l;q[y+1]=m.y/l;q[y+2]=m.z/l}return q},buildIndexationFromStripSet:function(t,l,r,g,m){var p=null;switch(t){case d.ConnectivityTypeEnum.TRIANGLE_STRIP:var s=0;for(var h=0;h<l;++h){s+=g[h]-2}p=this.allocIndexationArray(3*s,m.length/3);var o=0;var n=0;for(var h=0;h<l;++h){var k=g[h];for(var j=0;j<k-2;++j){p[o++]=r[n+j];if(j&1){p[o++]=r[n+j+2];p[o++]=r[n+j+1]}else{p[o++]=r[n+j+1];p[o++]=r[n+j+2]}}n+=k}break;case d.ConnectivityTypeEnum.LINE_STRIP:var q=0;for(var h=0;h<l;++h){q+=g[h]-1}p=new Uint32Array(2*q);var o=0;var n=0;for(var h=0;h<l;++h){var k=g[h];for(var j=0;j<k-1;++j){p[o++]=r[n+j];p[o++]=r[n+j+1]}n+=k}break;default:console.warn("Unknown strip set, can't build indexation");break}return p},buildIndexedTriangleSet:function(P,n,k,g,j,O,p,x,K,C,D){if(n===null||k===null||j===null||O===null){console.error("VCXMeshServices : Invalid data for mesh node");return null}if(n.length%3!==0){console.error("VCXMeshServices : Invalid data for mesh set node");return null}var B=g?g.length/2:null;var S=j.length;var s=O.length;if(S!==s){console.error("VCXMeshServices : Invalid data for mesh node");return null}var J=(x===null)?new d.PrimitiveGroup():new d.PrimitiveGroup({fillGAS:new d.FillAttributes(x,(C?1:0))});if(this.sharing){J.sharing=true}if(this.optimized){J.optimized=true}var h=0;var o;var E=new d.Buffer({component:d.VertexComponentEnum.POSITION,dimension:3,data:n});J.addBuffer(o=h++,E);var z;var r=new d.Buffer({component:d.VertexComponentEnum.NORMAL,dimension:3,data:k});J.addBuffer(z=h++,r);var t;if(g&&3*g.length===2*n.length){var u=new d.Buffer({component:d.VertexComponentEnum.TEX_COORD_0,dimension:2,data:new Float32Array(B*3)});u.data[0]=g[0];var H=1;for(var L=1;L<g.length;L++){u.data[H++]=g[L];if(L%2){u.data[H++]=0}}J.addBuffer(t=h++,u)}var m;var A=null;if(j instanceof (Uint8Array)||j instanceof (Uint16Array)||j instanceof (Uint32Array)){A=j}else{console.warn("Buffer indexation should be Uint8Array, Uint16Array or Uint32Array");A=this.allocIndexationArray(j.length,n.length/3);for(var N=0;N<j.length;N++){A[N]=j[N]}}var M=new d.Buffer({indexBuffer:true,dimension:1,data:A});J.addBuffer(m=h++,M);var l;if(D){l=m}else{var w=null;if(O instanceof (Uint8Array)||O instanceof (Uint16Array)||O instanceof (Uint32Array)){w=O}else{console.warn("Buffer indexation should be Uint8Array, Uint16Array or Uint32Array");w=this.allocIndexationArray(O.length,k.length/3);for(var N=0;N<O.length;N++){w[N]=O[N]}}var y=new d.Buffer({indexBuffer:true,dimension:1,data:w});J.addBuffer(l=h++,y)}var q;if(D){q=m}else{if(p){var v=null;if(p instanceof (Uint8Array)||p instanceof (Uint16Array)||p instanceof (Uint32Array)){v=p}else{console.warn("Buffer indexation should be Uint8Array, Uint16Array or Uint32Array");v=this.allocIndexationArray(p.length,g.length/2);for(var N=0;N<p.length;N++){v[N]=p[N]}}var G=new d.Buffer({indexBuffer:true,dimension:1,data:p});J.addBuffer(q=h++,G)}}var F=new d.Primitive();F.nbIndices=j.length;F.connectivity=d.ConnectivityTypeEnum.TRIANGLES;var R=new d.VertexComponent();R.nbVertices=n.length;R.bufferId=o;R.indices=new d.IndexArray();R.indices.bufferId=m;R.indices.offset=0;F.addVertexComponent(R);var I=new d.VertexComponent();I.nbVertices=k.length;I.bufferId=z;I.indices=new d.IndexArray();I.indices.bufferId=l;I.indices.offset=0;F.addVertexComponent(I);if(g){var Q=new d.VertexComponent();Q.nbVertices=g.length;Q.bufferId=t;Q.indices=new d.IndexArray();Q.indices.bufferId=q;Q.indices.offset=0}J.addPrimitive(F);return b.createMeshNode(J,K,0,"mono")},buildMonoIndexedTriangleStripSet:function(E,w,y,o,n,h,k,v,H){if(w===null||y===null||n===null){console.error("VCXMeshServices : Invalid data for mesh node");return null}if(w.length%3!==0){console.error("VCXMeshServices : Invalid data for mesh set node");return null}var l=w.length/3;var s=(k===null)?new d.PrimitiveGroup():new d.PrimitiveGroup({fillGAS:new d.FillAttributes(k,(H?1:0))});if(this.sharing){s.sharing=true}if(this.optimized){s.optimized=true}var z=0;var x=new d.Buffer({component:d.VertexComponentEnum.POSITION,data:w});s.addBuffer(z,x);var p=1;var r=new d.Buffer({component:d.VertexComponentEnum.NORMAL,data:y});s.addBuffer(p,r);var g=2;if(o&&3*o.length===2*w.length){var u=new d.Buffer({component:d.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(l*3)});var q=0;u.data[0]=o[0];for(var D=0;D<o.length;D++){u.data[q++]=o[D];if(D%2){u.data[q++]=0}}s.addBuffer(g,u)}var j=3;var F=new d.Buffer({indexBuffer:true,data:n});s.addBuffer(j,F);var G=0;for(var C=0;C<E;C++){var B=new d.Primitive();B.nbIndices=h[C];B.connectivity=d.ConnectivityTypeEnum.TRIANGLE_STRIP;var t=new d.VertexComponent();t.nbVertices=h[C];t.bufferId=z;t.indices=new d.IndexArray();t.indices.bufferId=j;t.indices.offset=G;B.addVertexComponent(t);var A=new d.VertexComponent();A.nbVertices=h[C];A.bufferId=p;A.indices=new d.IndexArray();A.indices.bufferId=j;A.indices.offset=G;B.addVertexComponent(A);if(o){var m=new d.VertexComponent();m.nbVertices=h[C];m.bufferId=g;m.indices=new d.IndexArray();m.indices.bufferId=j;m.indices.offset=G;B.addVertexComponent(m)}s.addPrimitive(B);G+=h[C]}return(v===null)?b.createMeshNode(s):b.createMeshNode(s,v)},buildIndexedLineSet:function(l,g,p,q,s,o){var r=new d.PrimitiveGroup({lineGAS:new d.LineAttributes(p?p:new d.Color(1,1,1,1),q?q:1)});if(this.sharing){r.sharing=true}if(this.optimized){r.optimized=true}var h=new d.Primitive();h.nbIndices=g.length;h.connectivity=d.ConnectivityTypeEnum.LINES;h.geomType=s;var m=0;var k=new d.Buffer({component:d.VertexComponentEnum.POSITION,data:l});r.addBuffer(m,k);var j=1;var i=new d.Buffer({indexBuffer:true,data:g});r.addBuffer(j,i);var n=new d.VertexComponent();n.nbVertices=l.length;n.bufferId=m;n.indices=new d.IndexArray();n.indices.bufferId=j;n.indices.offset=0;h.addVertexComponent(n);r.addPrimitive(h);return(o===null)?b.createMeshNode(r):b.createMeshNode(r,o)},buildLineStripSet:function(o,g,h,s,t,v,r){if(o===null||g.length===null||h===null){console.error("VCXMeshServices : Invalid data for line set node");return null}var u=new d.PrimitiveGroup({lineGAS:new d.LineAttributes(s?s:new d.Color(1,1,1,1),t?t:1)});if(this.sharing){u.sharing=true}var p=0;var n=new d.Buffer({component:d.VertexComponentEnum.POSITION,data:o});u.addBuffer(p,n);var l=1;var k=new d.Buffer({indexBuffer:true,data:h});u.addBuffer(l,k);var m=0;for(var j=0;j<g.length;j++){var i=new d.Primitive();i.nbIndices=g[j];i.connectivity=d.ConnectivityTypeEnum.LINE_STRIP;i.geomType=v;var q=new d.VertexComponent();q.nbVertices=g[j];q.bufferId=p;q.indices=new d.IndexArray();q.indices.bufferId=l;q.indices.offset=m;i.addVertexComponent(q);u.addPrimitive(i);m+=g[j]}return(r===null)?b.createMeshNode(u):b.createMeshNode(u,r)},buildLine:function(h,o,k,g,m){if(h===null){console.error("VCXMeshServices : Invalid data for line set node");return null}if(h.length%3!==0){console.error("VCXMeshServices : Invalid data for line set node");return null}var n=h.length/3;var l=[];for(var j=0;j<n;j++){l[j]=j}return this.buildLineStripSet(h,[n],l,m,g)},buildPointSet:function(k,o,p,q,n){if(k===null||o===null){console.error("VCXMeshServices : Invalid data for point set node");return null}if(k.length%3!==0){console.error("VCXMeshServices : Invalid data for point set node");return null}var i=k.length/3;var t=new d.PrimitiveGroup({pointGAS:new d.PointAttributes(p?p:new d.Color(1,1,1,1),q?q:1)});if(this.sharing){t.sharing=true}var l=0;var j=new d.Buffer({component:d.VertexComponentEnum.POSITION,data:k});t.addBuffer(l,j);var h=1;var g=new d.Buffer({indexBuffer:true,data:o});t.addBuffer(h,g);for(var s=0;s<i;s++){var r=new d.Primitive();r.nbIndices=1;r.connectivity=d.ConnectivityTypeEnum.POINTS;var m=new d.VertexComponent();m.nbVertices=1;m.bufferId=l;m.indices=new d.IndexArray();m.indices.bufferId=h;m.indices.offset=s;r.addVertexComponent(m);t.addPrimitive(r)}return(n===null)?b.createMeshNode(t):b.createMeshNode(t,n)},buildPoint:function(k,l,h,j){var g=new Float32Array(3);g[0]=k[0];g[1]=k[1];g[2]=k[2];var i=new Uint8Array(1);i[0]=0;return this.buildPointSet(g,i,l,h,j)},buildIndexation:function(u,p,r,m){if(!u||!p||!r||!m){return null}var q=[];var n=0;var t=0;for(var l=0;l<p.length;l++){if(r[l]===f.IndexationType.TrianglesSet){var o=t+p[l];for(var s=t;s<o;s++){q[n++]=m[s]}}else{if(r[l]===f.IndexationType.TrianglesStripSet){var o=t+p[l]-2;var k=true;for(var s=t;s<o;s++){q[n++]=m[s];if(k){q[n++]=m[s+1];q[n++]=m[s+2];k=false}else{q[n++]=m[s+2];q[n++]=m[s+1];k=true}}}else{if(r[l]===f.IndexationType.FanSet){var o=t+p[l]-1;var h=m[t];for(var s=t+1;s<o;s++){q[n++]=h;q[n++]=m[s];q[n++]=m[s+1]}}}}t+=p[l]}var g=this.allocIndexationArray(q.length,u.length/3);for(var j=0;j<q.length;++j){g[j]=q[j]}return g},packIndexation:function(u,g){if(g===null||u===null||g.length===0){return null}var p=new Map();var r=this.allocIndexationArray(g.length,u.length/3);var w=0;for(var n=0;n<g.length;n++){if(w<g[n]){w=g[n]}var v=3*g[n];var B=u[v]+"_"+u[v+1]+"_"+u[v+2];var o=p.get(B);if(o!==undefined){r[n]=o}else{p.set(B,g[n]);r[n]=g[n]}}p=null;w=w+1;var s=this.allocIndexationArray(w,u.length/3);for(var A=0;A<w;++A){s[A]=false}for(var A=0;A<r.length;A++){s[r[A]]=true}var h=0;var z=new Map();for(var x=0;x<w;x++){if(s[x]){z.set(x,h++)}}var q=new Float32Array(3*z.size);h=0;for(var v=0;v<w;v++){if(s[v]){var m=3*v;q[h++]=u[m];q[h++]=u[m+1];q[h++]=u[m+2]}}s=null;var y=this.allocIndexationArray(r.length,u.length/3);for(var t=0;t<r.length;t++){var m=z.get(r[t]);y[t]=m}z=null;r=null;return{pIndexation:y,pCoord:q}},packIndexationUv:function(u,g){if(g===null||u===null||g.length===0){return null}var p=new Map();var r=[];var w=0;for(var n=0;n<g.length;n++){if(w<g[n]){w=g[n]}var v=2*g[n];var B=u[v]+"_"+u[v+1];var o=p.get(B);if(o!==undefined){r[n]=o}else{p.set(B,g[n]);r[n]=g[n]}}w=w+1;var s=[];for(var A=0;A<w;++A){s[A]=false}for(var A=0;A<r.length;A++){s[r[A]]=true}var h=0;var z=new Map();for(var x=0;x<w;x++){if(s[x]){z.set(x,h++)}}var q=[];h=0;for(var v=0;v<w;v++){if(s[v]){var m=2*v;q[h++]=u[m];q[h++]=u[m+1]}}var y=[];for(var t=0;t<r.length;t++){var m=z.get(r[t]);y[t]=m}return{pIndexation:y,pCoord:q}},packIndexationMono:function(z,w,p,g){if(g===null||z===null||g.length===0){return null}var t=new Map();var q=Math.max(Math.max(z.length/3,w.length/3),p?p.length/2:0);var v=this.allocIndexationArray(g.length,q);var C=0;for(var r=0;r<g.length;r++){if(C<g[r]){C=g[r]}var A=3*g[r];var H=z[A]+"_"+z[A+1]+"_"+z[A+2];if(w&&w.length){H+=w[A]+"_"+w[A+1]+"_"+w[A+2]}if(p&&p.length){var o=2*g[r];H+=p[o]+"_"+p[o+1]}var s=t.get(H);if(s!==undefined){v[r]=s}else{t.set(H,g[r]);v[r]=g[r]}}t=null;C=C+1;var x=this.allocIndexationArray(C,q);for(var G=0;G<C;++G){x[G]=false}for(var G=0;G<v.length;G++){x[v[G]]=true}var n=0;var F=new Map();for(var B=0;B<C;B++){if(x[B]){F.set(B,n++)}}var u=new Float32Array(3*F.size);var h=new Float32Array(w&&w.length?3*F.size:0);var E=new Float32Array(p&&p.length?3*F.size:0);var n=0;for(var A=0;A<C;A++){if(x[A]){var m=3*A;u[n++]=z[m];u[n++]=z[m+1];u[n++]=z[m+2]}}if(w&&w.length){n=0;for(var A=0;A<C;A++){if(x[A]){var m=3*A;h[n++]=w[m];h[n++]=w[m+1];h[n++]=w[m+2]}}}if(p&&p.length){n=0;for(var A=0;A<C;A++){if(x[A]){var m=2*A;E[n++]=p[m];E[n++]=p[m+1]}}}x=null;var D=this.allocIndexationArray(v.length,q);for(var y=0;y<v.length;y++){var m=F.get(v[y]);D[y]=m}t=null;v=null;return{pIndexation:D,pCoord:u,pNormals:h,pUv:E}},mergeGeosets:function(M){if(!M||M.length===0){return null}var p=null;if(M.length===1&&M[0]!==null){var ah=M[0];switch(ah.meshType){case d.ConnectivityTypeEnum.TRIANGLES:p=this.buildIndexedTriangleSet(ah.nTriangles,ah.vertexArray,ah.normalsArray,ah.uvArray,ah.vertexIndexArray,ah.normalsIndexArray,ah.uvIndexArray,ah.colorRGBA,ah.material,ah.isSolid,ah.uniqueIndexation);break;case d.ConnectivityTypeEnum.TRIANGLE_STRIP:if(ah.uniqueIndexation===true){p=this.buildMonoIndexedTriangleStripSet(ah.nStrips,ah.vertexArray,ah.normalsArray,ah.uvArray,ah.vertexIndexArray,ah.lengthsArray,ah.colorRGBA,ah.material,ah.isSolid)}break;case d.ConnectivityTypeEnum.LINES:p=this.buildIndexedLineSet(ah.vertexArray,ah.vertexIndexArray,ah.colorRGBA,ah.thickness,ah.edgeType,ah.material);break;case d.ConnectivityTypeEnum.LINE_STRIP:p=this.buildLineStripSet(ah.vertexArray,ah.lengthsArray,ah.vertexIndexArray,ah.colorRGBA,ah.thickness,ah.edgeType,ah.material);break;default:break}if(p){return p}}var i,h,g,ao,an,ak;i=h=g=ao=an=ak=0;for(var F=0;F<M.length;++F){var V=M[F];if(V.vertexArray){i+=V.vertexArray.length}if(V.normalsArray){h+=V.normalsArray.length}if(V.uvArray){g+=V.uvArray.length}if(V.vertexIndexArray){ao+=V.vertexIndexArray.length}if(V.normalsIndexArray){an+=V.normalsIndexArray.length}else{an+=V.vertexIndexArray.length}if(V.uvIndexArray){ak+=V.uvIndexArray.length}else{ak+=V.vertexIndexArray.length}}var t=new Float32Array(i);var ai=new Float32Array(h);var k=g?new Float32Array(g):null;var j=this.allocIndexationArray(ao,i/3);var U=this.allocIndexationArray(an,h/3);var o=g?this.allocIndexationArray(ak,g/2):null;var O=true;var u=true;var E,D,B,z,y,w;E=D=B=z=y=w=0;for(var F=0;F<M.length;++F){var V=M[F];var aj=E/3;var aa=D/3;var J=B/3;if(V.vertexArray){for(var ad=0;ad<V.vertexArray.length;++ad){t[E++]=V.vertexArray[ad]}}if(V.normalsArray){for(var ad=0;ad<V.normalsArray.length;++ad){ai[D++]=V.normalsArray[ad]}}if(V.uvArray&&k){for(var ad=0;ad<V.uvArray.length;++ad){k[B++]=V.uvArray[ad]}}if(V.vertexIndexArray!==null){for(var ad=0;ad<V.vertexIndexArray.length;++ad){j[z++]=V.vertexIndexArray[ad]+aj}}if(V.normalsIndexArray!==null){for(var af=0;af<V.normalsIndexArray.length;++af){U[y++]=V.normalsIndexArray[af]+aa}}else{for(var af=0;af<V.vertexIndexArray.length;++af){U[y++]=V.vertexIndexArray[af]+aa}}if(V.uvIndexArray!==null){for(var ae=0;ae<V.uvIndexArray.length;++ae){o[w++]=V.uvIndexArray[ae]+J}}else{if(o){for(var ae=0;ae<V.vertexIndexArray.length;++ae){o[w++]=V.vertexIndexArray[ae]+J}}}if(V.isSolid===false){O=false}if(V.uniqueIndexation===false){u=false}}if(u===true){var s=this.packIndexationMono(t,ai,k,j);j=s.pIndexation;t=s.pCoord;ai=s.pNormals;if(k){k=s.pUv}s=null;if(ai.length){U=j}if(k&&k.length){o=j}}else{var L=this.packIndexation(t,j);t=L.pCoord;j=L.pIndexation;L=null;if(U.length){var C=this.packIndexation(ai,U);ai=C.pCoord;U=C.pIndexation;C=null}if(o&&o.length&&k){var G=this.packIndexationUv(k,o);k=G.pCoord;o=G.pIndexation;G=null}}var P=0;var ab=new d.PrimitiveGroup();if(this.sharing){ab.sharing=true}if(this.optimized){ab.optimized=true}var l=0;ab.fillAttr=new d.FillAttributes();ab.fillAttr.solid=O?1:0;var r;var W=new d.Buffer({component:d.VertexComponentEnum.POSITION,dimension:3,data:t});ab.addBuffer(r=l++,W);var R;if(ai.length&&U.length){var A=new d.Buffer({component:d.VertexComponentEnum.NORMAL,dimension:3,data:ai});ab.addBuffer(R=l++,A)}var H;if(k&&k.length&&o.length){var I=new d.Buffer({component:d.VertexComponentEnum.TEX_COORD_0,dimension:2,data:new Float32Array(k.length*3/2)});var Y=0;I.data[0]=k[0];for(var ae=0;ae<k.length;ae++){I.data[Y++]=k[ae];if(ae%2){I.data[Y++]=0}}ab.addBuffer(H=l++,I)}var n;if(j.length>0){var v=new d.Buffer({indexBuffer:true,dimension:1,data:j});ab.addBuffer(n=l++,v)}var m;if(u){m=n}else{if(U.length>0){var S=new d.Buffer({indexBuffer:true,dimension:1,data:U});ab.addBuffer(m=l++,S)}}var x;if(u){x=n}else{if(o&&o.length>0){var q=new d.Buffer({indexBuffer:true,dimension:1,data:o});ab.addBuffer(x=l++,q)}}var T=0;var K=0;var ag=0;for(var F=0;F<M.length;++F){var V=M[F];switch(V.meshType){case d.ConnectivityTypeEnum.TRIANGLES:var X=(V.colorRGBA===null)?new d.Primitive():new d.Primitive({fillGAS:new d.FillAttributes(V.colorRGBA,O?1:0)});X.geomType="FACE";X.nbIndices=V.vertexIndexArray.length;X.connectivity=d.ConnectivityTypeEnum.TRIANGLES;var am=new d.VertexComponent();am.nbVertices=t.length;am.bufferId=r;am.indices=new d.IndexArray();am.indices.bufferId=n;am.indices.offset=T;X.addVertexComponent(am);if(ai.length){var Z=new d.VertexComponent();Z.nbVertices=ai.length;Z.bufferId=R;Z.indices=new d.IndexArray();Z.indices.bufferId=m;Z.indices.offset=K;X.addVertexComponent(Z)}if(k&&k.length){var al=new d.VertexComponent();al.nbVertices=k.length;al.bufferId=H;al.indices=new d.IndexArray();al.indices.bufferId=x;al.indices.offset=ag;X.addVertexComponent(al)}ab.addPrimitive(X);break;case d.ConnectivityTypeEnum.TRIANGLE_STRIP:var P=0;for(var N=0;N<V.lengthsArray.length;N++){var Q=(V.colorRGBA===null)?new d.Primitive():new d.Primitive({fillGAS:new d.FillAttributes(V.colorRGBA,O?1:0)});Q.geomType="FACE";Q.nbIndices=V.lengthsArray[N];Q.connectivity=d.ConnectivityTypeEnum.TRIANGLE_STRIP;var am=new d.VertexComponent();am.nbVertices=V.lengthsArray[N];am.bufferId=r;am.indices=new d.IndexArray();am.indices.bufferId=n;am.indices.offset=T+P;Q.addVertexComponent(am);if(V.normalsIndexArray!==null&&V.normalsIndexArray.length){var Z=new d.VertexComponent();Z.nbVertices=V.lengthsArray[N];Z.bufferId=R;Z.indices=new d.IndexArray();Z.indices.bufferId=m;Z.indices.offset=K+P;Q.addVertexComponent(Z)}if(V.uvIndexArray&&V.uvIndexArray.length){var al=new d.VertexComponent();al.nbVertices=V.lengthsArray[N];al.bufferId=H;al.indices=new d.IndexArray();al.indices.bufferId=x;al.indices.offset=ag+P;Q.addVertexComponent(al)}ab.addPrimitive(Q);P+=V.lengthsArray[N]}break;case d.ConnectivityTypeEnum.LINES:var ac=new d.Primitive({lineGAS:new d.LineAttributes(V.colorRGBA?V.colorRGBA:new d.Color(1,1,1,1),V.thickness?V.thickness:1)});ac.nbIndices=V.vertexIndexArray.length;ac.connectivity=d.ConnectivityTypeEnum.LINES;ac.geomType=V.edgeType;var am=new d.VertexComponent();am.nbVertices=t.length;am.bufferId=r;am.indices=new d.IndexArray();am.indices.bufferId=n;am.indices.offset=T;ac.addVertexComponent(am);ab.addPrimitive(ac);break;case d.ConnectivityTypeEnum.LINE_STRIP:var P=0;for(var N=0;N<V.lengthsArray.length;N++){var ac=new d.Primitive({lineGAS:new d.LineAttributes(V.colorRGBA?V.colorRGBA:new d.Color(1,1,1,1),V.thickness?V.thickness:1)});ac.nbIndices=V.lengthsArray[N];ac.connectivity=d.ConnectivityTypeEnum.LINE_STRIP;ac.geomType=V.edgeType;var am=new d.VertexComponent();am.nbVertices=V.lengthsArray[N];am.bufferId=r;am.indices=new d.IndexArray();am.indices.bufferId=n;am.indices.offset=T+P;ac.addVertexComponent(am);ab.addPrimitive(ac);P+=V.lengthsArray[N]}break;case d.ConnectivityTypeEnum.POINTS:console.log("Merge geosets error : Point geometry type - to be implemented");break;default:console.log("Merge geosets error : unknown geometry type");break}if(V.vertexIndexArray!==null){T+=V.vertexIndexArray.length}if(V.normalsIndexArray!==null){K+=V.normalsIndexArray.length}if(V.uvIndexArray){ag+=V.uvIndexArray.length}}if(u){return b.createMeshNode(ab,undefined,0,"mono")}return b.createMeshNode(ab)},});f.IndexationType={TrianglesSet:0,TrianglesStripSet:1,FanSet:2};return f});define("DS/VCXWebKernelTools/VCXFileServices",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/ZipJS/zip-fs","DS/VCXWebKernelTools/VCXMimeTypeServices"],function(b,f,d,c){var e=function(g){var h=g.substr(g.lastIndexOf("."));if(h){return c.GetMimeType(h)}};var a=b.singleton({init:function(){},ExtractFromArchiveData:function(o,k,j,h){var m=o.slice(0,3);var p=new Uint8Array(m);var q=null;if(p[0]===83&&p[1]===77&&p[2]===71){var s=o.byteLength;q=new DataView(o.slice(3,s))}else{q=new DataView(o)}var r=new Uint8Array(q.byteLength);for(var l=0;l<r.length;l++){r[l]=q.getUint8(l)}var g=new Blob([r],{type:"application/x-gzip"});var n=new d.fs.FS();d.workerScriptsPath=f.getWebappsBaseUrl()+"ZipJS/";n.importBlob(g,function(){var z=new Map();var x=[];if(h){for(var v=0;v<h.length;v++){var y=n.find(h[v]);if(UWA.is(y.name)){var t=y.name;t=t.toLowerCase();x.push(y)}}}else{for(var v=0;v<n.entries.length;v++){var y=n.entries[v];if(UWA.is(y.name)){var t=y.name;t=t.toLowerCase();x.push(y)}}}var A=0;var w=10;var u=function(){var D=function(G){var H=function(I){G=G.toLowerCase();z.set(G,I);if(A>w){console.log("Warning : nbWorkersRunning > nbWorkersMax")}A--;if(x.length>0){u()}else{if(A===0){k(z);k=null;j=null}else{if(A<0){console.log("Warning : nbWorkersRunning < 0");k(z);k=null;j=null}}}};return H};var C=[];if(A<2){for(var B=0;B<x.length;B++){if(A<w){var i=x[B].name;if(z.get(i.toLowerCase())){continue}var E="octet-binary";E=e(i);if(E==="octet-binary"){console.log("Warning : unknown resource file type")}A++;x[B].getBlob(E,D(i));C.push(x[B])}else{break}}}if(C.length>0){for(var F=0;F<C.length;F++){x.splice(x.indexOf(C[F]),1)}}};u()},function(i){j(i);k=null;j=null})},ExtractFromArchive:function(k,g,j,i){var h=new FileReader();h.onload=function(l){a.ExtractFromArchiveData(l.target.result,g,j,i)};h.readAsArrayBuffer(k)},BlobURLToBase64:function(h,g,k,i){var j=new XMLHttpRequest();j.open("GET",h,true);j.responseType="blob";j.addEventListener("error",function(l){k(null,i)});j.onload=function(m){if(this.status===200){var l=new FileReader();l.onload=function(){k(l.result,i)};l.readAsDataURL(this.response)}};j.send()},BlobURLToJSONText:function(g,l,k){var j=this;var i=k;var h=new XMLHttpRequest();h.open("GET",g,true);h.responseType="blob";h.onload=function(o){if(this.status===200){var n=this.response;var m=new FileReader();m.onload=function(){var p=m.result;var q=JSON.parse(p);if(i){l.call(i,q)}else{l(q)}};m.readAsText(n)}};h.send()},BlobURLToText:function(g,j){var i=this;var h=new XMLHttpRequest();h.open("GET",g,true);h.responseType="blob";h.onload=function(m){if(this.status===200){var l=this.response;var k=new FileReader();k.onload=function(){var n=k.result;j(n)};k.readAsText(l)}};h.send()},dataURLToBlob:function(j,g){if(j){}else{console.log("VCXFileServices: dataURL is empty.");return}var l=";base64,";if(j.indexOf(l)===-1){var m=j.split(",");var o=m[0].split(":")[1];var p=decodeURIComponent(m[1]);var h=new Blob([p],{type:o});h.name=g;return h}var m=j.split(l);var o=m[0].split(":")[1];var p=window.atob(m[1]);var q=p.length;var k=new Uint8Array(q);for(var n=0;n<q;++n){k[n]=p.charCodeAt(n)}var h=new Blob([k],{type:o});h.name=g;return h},dataURLToFile:function(h,g){if(h){}else{console.log("VCXFileServices: dataURL is empty.");return}var k=";base64,";if(h.indexOf(k)===-1){var l=h.split(",");var n=l[0].split(":")[1];var o=decodeURIComponent(l[1]);return new File([o],g,{type:n})}var l=h.split(k);var n=l[0].split(":")[1];var o=window.atob(l[1]);var p=o.length;var j=new Uint8Array(p);for(var m=0;m<p;++m){j[m]=o.charCodeAt(m)}return new File([j],{type:n})},BlobURLToBlob:function(h,g,l){console.log("BlobURLToBlob "+h);try{var k=this;var j=new XMLHttpRequest();j.addEventListener("error",function(m){var n=500+(Math.random()*500);console.log("BlobURLToBlob Error: "+h+" (retry in "+n+" ms)");window.setTimeout(function(){console.log("BlobURLToBlob retrying "+h);k.BlobURLToBlob(h,g,l)},n)});j.onreadystatechange=function(){if(this.readyState==4&&this.status==200){console.log("BlobURLToBlob ready : "+h)}};j.open("GET",h,true);j.responseType="blob";j.onload=function(n){console.log("BlobURLToBlob xhr.onload of "+h);if(this.status===200){var m=this.response;l(m)}else{console.log("BlobURLToBlob FAILED")}};j.send()}catch(i){console.error(i);console.log("BlobURLToBlob catch")}},BlobToFileVar:function(h,i){var g=new FileReader();g.onload=function(){var j=g.result;var k=JSON.parse(j);i(k)};g.readAsText(h)},stringToHex:function(h){var j="";for(var g=0;g<h.length;g++){var k=h.charCodeAt(g);j+=k.toString(16)+" "}return j},getImageSizeFromBlobUrl:function(k,g){var i=new Image();var j=document.createElement("canvas");var h=j.getContext("2d");i.src=k;h.drawImage(i,0,0);var l={width:0,height:0};i.onload=function(){l.width=this.width;l.height=this.height;g(l)};return l}});return a});define("DS/VCXWebKernelTools/VCXFileWriter",["UWA/Class","DS/VCXWebKernelTools/VCXFileServices"],function(c,a){var e=window.document;var b=window;var d=c.extend({init:function(){},getURL:function(){return b.URL||b.webkitURL||b},revoke:function(f){},saveBlobAs:function(f,h){var g=null;if(window.navigator.msSaveBlob!==undefined){window.navigator.msSaveBlob(f,h)}else{var j=e.createElementNS("http://www.w3.org/1999/xhtml","a");g=this.getURL().createObjectURL(f);j.href=g;j.download=h;var i=e.createEvent("MouseEvents");i.initMouseEvent("click",true,false,b,0,0,0,0,0,false,false,false,false,0,null);j.dispatchEvent(i)}this.revoke(g)},saveTextToFile:function(f,h){var g=new Blob([f],{type:"text/plain;charset=utf-8"});this.saveBlobAs(g,h)},saveAs:function(i,g,h){var f=a.dataURLToBlob(i);this.saveBlobAs(f,g)},BlobURLToBase64:function(f){var g=new XMLHttpRequest();g.open("GET",f,true);g.responseType="arraybuffer";g.onload=function(n){if(this.status===200){var l=new Uint8Array(this.response);var k=l.length;var h=new Array(k);while(k--){h[k]=String.fromCharCode(l[k])}var m=h.join("");var j=window.btoa(m);j="data:image/png;base64,"+j;return j}};g.send()}});return d});define("DS/VCXWebKernelTools/VCXXmlServices",["UWA/Class","DS/VCXWebKernelTools/VCXFileWriter"],function(a,b){var c=a.singleton({init:function(){},createXmlDoc:function(){var e="<root></root>";var f=new DOMParser();var d=f.parseFromString(e,"text/xml");return d},createXmlNode:function(h,d,e){var f=h.createElement(e);if(d===null){var g=h.getElementsByTagName("root");g[0].appendChild(f)}else{d.appendChild(f)}return f},addXmlNodeAttribute:function(e,d,f){e.setAttribute(d,f)},saveXmlDoc:function(e,g){var d='data:text/xml;charset=utf8,<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+e.documentElement.innerHTML;var f=new b();f.saveAs(d,g)}});return c});define("DS/VCXWebKernelTools/VCXPixelImageSvg",["UWA/Class","DS/VCXWebKernelTools/VCXFileServices","DS/VENWebCanvg/CanvgTools"],function(b,a,d){var c=b.extend({init:function(g,e,f){this.src=g;this._preferredWidthPx=e!==undefined?e:0;this._preferredHeightPx=f!==undefined?f:0},utf8ArrayToStr:function(l){var f,h,e,k;var j,g;f="";e=l.length;h=0;while(h<e){k=l[h++];switch(k>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:f+=String.fromCharCode(k);break;case 12:case 13:j=l[h++];f+=String.fromCharCode(((k&31)<<6)|(j&63));break;case 14:j=l[h++];g=l[h++];f+=String.fromCharCode(((k&15)<<12)|((j&63)<<6)|((g&63)<<0));break}}return f},setAreaToDraw:function(r,g,j,s){var f=r.search(/<svg/i);var o=f;for(var l=f;l<r.length;++l){if(r[l]===">"){o=l;break}}var p=r.substring(0,o);var q=' viewBox= "';q+=parseInt(s.x+1).toString();q+=" ";q+=parseInt(s.y+1).toString();q+=" ";q+=parseInt(s.width).toString();q+=" ";q+=parseInt(s.height).toString();q+='" ';var n=p.match(/(viewBox*)([\s=]*)([/"]*)([0-9.\s]*)([/"]*)/gi);if(n&&n.length){p=p.replace(n[0],q)}else{p+=q}var t=' width= "';t+=g.toString();t+='px" ';var e=p.match(/(width*)([\s=]*)([/"]*)([0-9a-z.\s]*)([/"]*)/gi);if(e&&e.length){p=p.replace(e[0],t)}else{p+=t}var h=' height= "';h+=j.toString();h+='px" ';var k=p.match(/(height*)([\s=]*)([/"]*)([0-9a-z.\s]*)([/"]*)/gi);if(k&&k.length){p=p.replace(k[0],h)}else{p+=h}p+=">";var m=r.substring(o+1,r.length);p+=m;return p},renderWithHtml2Canvas:function(g){var f=new Html2Canvas();var e=UWA.createElement("div");e.setHTML(g);e.inject(document.body);f.htmlToCanvas(e,{async:true},function(h){document.body.removeChild(e)})},renderWithCanvg:function(g){var f=new d();var e=document.createElement("canvas");f.svgToCanvas(g,e,{ignoreMouse:true,ignoreAnimation:true})},renderFromDataUrl:function(f,h){var g=this;var e=new FileReader();e.onload=function(o){var k=o.target.result;var n=new Uint8Array(k);var q=g.utf8ArrayToStr(n);var i=UWA.createElement("div");i.setHTML(q);i.inject(document.body);var j=i.children[0];var p=j.getBBox();var r="";if(g._preferredWidthPx&&g._preferredHeightPx){r=g.setAreaToDraw(q,Math.floor(g._preferredWidthPx),Math.floor(g._preferredHeightPx),p)}else{r=g.setAreaToDraw(q,Math.floor(p.width*5),Math.floor(p.height*5),p)}document.body.removeChild(i);i=null;var m=new Image();var l="data:image/svg+xml;charset=utf-8,"+r;m.onload=function(t){var u=document.createElement("canvas");u.width=m.width;u.height=m.height;var s=u.getContext("2d");s.drawImage(m,0,0);if(h!==undefined){h(u)}};m.onerror=function(s){var u=new d();var t=document.createElement("canvas");u.svgToCanvas(r,t,{ignoreMouse:true,ignoreAnimation:true});if(h!==undefined){h(t)}};m.src=l};e.readAsArrayBuffer(a.dataURLToBlob(f))},render:function(f){if(typeof this.src==="string"&&this.src.substring(0,4)==="blob"){var e=this;a.BlobURLToBase64(this.src,null,function(h,g){e.renderFromDataUrl(h,function(i){if(f!==undefined){f(i)}})})}else{if(typeof this.src==="string"&&this.src.substring(0,4)==="data"){this.renderFromDataUrl(this.src,function(g){if(f!==undefined){f(g)}})}}}});return c});define("DS/VCXWebKernelTools/VCXPixelImage",["UWA/Class","DS/VCXWebProperties/VCXColor","DS/VCXWebKernelTools/VCXFileWriter","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebKernelTools/VCXPixelImageSvg"],function(d,b,f,a,e){var c=d.extend({init:function(h,j,g,i){this._width=0;this._height=0;this._bufferRGBA=null;this._preferredWidth=0;this._preferredHeight=0;this._quality=0.8;if(h instanceof Uint8Array){this._width=j;this._height=g;this._bufferRGBA=new Uint8ClampedArray(h)}else{if(h instanceof ImageData){this._width=h.width;this._height=h.height;this._bufferRGBA=new Uint8ClampedArray(h.data)}else{this._width=0;this._height=0;this._bufferRGBA=null}}},setPreferredSize:function(g,i){this._preferredWidth=Math.floor(g);this._preferredHeight=Math.floor(i)},setQuality:function(g){if(g>=0&&g<=1){this._quality=g}},getBytes:function(){return this._bufferRGBA},getPixelWidth:function(){return this._width},getPixelHeight:function(){return this._height},getPixelRGBA:function(k,h){var g=4*(h*this._width+k);var l=this._bufferRGBA;if(!l){console.log("Warning : Empty image!")}return l?[l[g],l[g+1],l[g+2],l[g+3]]:[0,0,0,0]},isPowerOf2:function(g){return g&&!(g&(g-1))},getNearestPow2:function(g){return Math.pow(2,Math.round(Math.log(g)/Math.log(2)))},hasDimensionsPowerOf2:function(){return this.isPowerOf2(this._width)&&this.isPowerOf2(this._height)},clear:function(n,m,j,k){var h=4*this._width*this._height;for(var l=0;l<h;l+=4){this._bufferRGBA[l]=n;this._bufferRGBA[l+1]=m;this._bufferRGBA[l+2]=j;this._bufferRGBA[l+3]=k}},loadFromImageUsingCanvas:function(g){var j=document.createElement("canvas");j.width=g.width;j.height=g.height;var h=j.getContext("2d");h.drawImage(g,0,0);var i=h.getImageData(0,0,j.width,j.height);this._width=i.width;this._height=i.height;this._bufferRGBA=new Uint8ClampedArray(i.data)},loadFromImageDataUrl:function(h,l){var i=h.src;var j=i.split(",")[0].split(":")[1].split(";")[0];var k=this;switch(j){case"image/bitmap":k.loadBmpFromDataUrl(i,function(m){if(m!==true){k.loadFromImageUsingCanvas(h)}if(l!==undefined){l()}});break;case"image/svg+xml":var g=new e(i,k._preferredWidth,k._preferredHeight);g.render(function(n){k._width=n.width;k._height=n.height;var o=n.getContext("2d");var m=o.getImageData(0,0,n.width,n.height);k._bufferRGBA=new Uint8ClampedArray(m.data);k.removeAreaWithAlphaZero();if(l!==undefined){l()}});break;default:k.loadFromImageUsingCanvas(h);if(l!==undefined){l()}break}},loadFromImageBlobUrl:function(g,i){var h=this;a.BlobURLToBase64(g.src,null,function(j,k){var l=new Image();l.onload=function(){h.loadFromImageDataUrl(l,function(){if(i!==undefined){i()}})};l.src=j})},loadFrom:function(h,j){var g=new Image();var i=this;g.onload=function(k){if(typeof h==="string"&&h.substring(0,4)==="blob"){i.loadFromImageBlobUrl(g,function(){if(j!==undefined){j()}})}else{if(typeof h==="string"&&h.substring(0,4)==="data"){i.loadFromImageDataUrl(g,function(){if(j!==undefined){j()}})}}};g.onerror=function(k){console.error("Image could not be loaded from url: '"+h+"'");if(j!==undefined){j()}};if(h.substring(0,5)==="blob:"){a.BlobURLToBase64(h,null,function(k){var l=k.split(",")[0].split(":")[1].split(";")[0];if(l==="image/x-tga"){i.loadTgaFromDataUrl(k,function(){if(j!==undefined){j()}})}else{g.src=h}})}else{if(h.indexOf("data:image")===0){if(h.indexOf("image/x-tga")>=0){i.loadTgaFromDataUrl(base64,function(){if(j!==undefined){j()}})}else{g.src=h}}}},decodeRLEforTGA:function(p,n,q,l,u){var t,s,r,o,m;var k,h;var v=u*q;h=new Uint8ClampedArray(l);k=new Uint8ClampedArray(q);t=l-v;while(t>=0){for(var g=0;g<v;){s=p.getUint8(n++);r=(s&127)+1;if(s&128){for(o=0;o<q-1;++o){k[(q-2)-o]=p.getUint8(n++)}k[q-1]=p.getUint8(n++);for(o=0;o<r;++o){h.set(k,t);t+=q}}else{for(o=0;o<r;++o,t+=q){for(m=0;m<q-1;++m){h[t+(q-2)-m]=p.getUint8(n++)}h[t+q-1]=p.getUint8(n++)}}g+=r*q}t-=2*v}return h},checkHeaderTGA:function(g){if(g.imageType===0){throw new Error("No data within current TGA file")}if(g.bHasColorMap){if(g.colorMapLength>256||g.colorMapSize!==24||g.colorMapType!==1){throw new Error("Invalid colormap for indexed type")}}else{if(g.colorMapType){throw new Error("The image contains a color map but the imageType field tells it isn't needed.")}}if(g.width<=0||g.height<=0){throw new Error("Invalid image size: "+g.width+" per "+g.height+".")}if(g.pixelDepth%8!==0||g.pixelDepth>32||g.pixelDepth<8){throw new Error('Invalid pixel size of "'+g.pixelDepth+' bits per pixel"')}},loadTgaFromDataUrl:function(h,j){var g=new FileReader();var i=this;g.onload=function(w){var q=new DataView(w.target.result);var o={};o.fileheader={};o.fileheader.idLength=q.getUint8(0);o.fileheader.colorMapType=q.getUint8(1);o.fileheader.imageType=q.getUint8(2);o.fileheader.colorMapIndex=q.getUint16(3,true);o.fileheader.colorMapLength=q.getUint16(5,true);o.fileheader.colorMapDepth=q.getUint8(7);o.fileheader.offsetX=q.getUint16(8,true);o.fileheader.offsetY=q.getUint16(10,true);o.fileheader.width=q.getUint16(12,true);o.fileheader.height=q.getUint16(14,true);o.fileheader.pixelDepth=q.getUint8(16,true);o.fileheader.flags=q.getUint8(17,true);i.checkHeaderTGA(o.fileheader);i._width=o.fileheader.width;i._height=o.fileheader.height;var l=18+o.fileheader.idLength;var v=i._width*i._height;var s=o.fileheader.pixelDepth>>3;var m=v*s;i._bufferRGBA=new Uint8ClampedArray(m);o.fileheader.bHasEncoding=(o.fileheader.imageType===9||o.fileheader.imageType===10||o.fileheader.imageType===11);o.fileheader.bHasColorMap=(o.fileheader.imageType===1||o.fileheader.imageType===9);if(o.fileheader.bHasEncoding){i._bufferRGBA=i.decodeRLEforTGA(q,l,s,m,i._width)}else{var n=i._width*i._height;var u=n*o.fileheader.pixelDepth/8;var x=new Uint8Array(w.target.result,l,u);i._bufferRGBA=new Uint8ClampedArray(u);switch(o.fileheader.pixelDepth){case 8:var t=0;for(var r=0;r<n;++r){i._bufferRGBA[t++]=x[r];i._bufferRGBA[t++]=x[r];i._bufferRGBA[t++]=x[r];i._bufferRGBA[t++]=255}break;case 16:var t=0;for(var r=0;r<n;++r){var p=2*r;i._bufferRGBA[t++]=x[p];i._bufferRGBA[t++]=x[p];i._bufferRGBA[t++]=x[p];i._bufferRGBA[t++]=x[p+1]}break;case 24:var t=0;for(var r=0;r<n;++r){var p=3*r;i._bufferRGBA[t++]=x[p+2];i._bufferRGBA[t++]=x[p+1];i._bufferRGBA[t++]=x[p];i._bufferRGBA[t++]=255}break;case 32:for(var r=0;r<n;++r){var p=4*r;i._bufferRGBA[p]=x[p+2];i._bufferRGBA[p+1]=x[p+1];i._bufferRGBA[p+2]=x[p];i._bufferRGBA[p+3]=x[p+3]}break;default:break}i.rotate180()}j&&typeof j==="function"&&j()};g.readAsArrayBuffer(a.dataURLToBlob(h))},loadBmpFromDataUrl:function(h,j){var i=this;var g=new FileReader();g.onload=function(A){var m=new DataView(A.target.result);var u={};u.fileheader={};u.fileheader.bfType=m.getUint16(0,true);u.fileheader.bfSize=m.getUint32(2,true);u.fileheader.bfReserved1=m.getUint16(6,true);u.fileheader.bfReserved2=m.getUint16(8,true);u.fileheader.bfOffBits=m.getUint32(10,true);u.infoheader={};u.infoheader.biSize=m.getUint32(14,true);u.infoheader.biWidth=m.getUint32(18,true);u.infoheader.biHeight=m.getUint32(22,true);u.infoheader.biPlanes=m.getUint16(26,true);u.infoheader.biBitCount=m.getUint16(28,true);u.infoheader.biCompression=m.getUint32(30,true);u.infoheader.biSizeImage=m.getUint32(34,true);u.infoheader.biXPelsPerMeter=m.getUint32(38,true);u.infoheader.biYPelsPerMeter=m.getUint32(42,true);u.infoheader.biClrUsed=m.getUint32(46,true);u.infoheader.biClrImportant=m.getUint32(50,true);i._width=u.infoheader.biWidth;i._height=u.infoheader.biHeight;i._bufferRGBA=new Uint8ClampedArray(4*i._width*i._height);var l=u.fileheader.bfOffBits;var o=new Uint8ClampedArray(A.target.result,l);var z=u.infoheader.biBitCount/8;var k=Math.floor((u.infoheader.biBitCount*u.infoheader.biWidth+31)/32)*4;var v=i._width;var p=i._height;var n=false;if(u.infoheader.biCompression===0){switch(u.infoheader.biBitCount){case 24:for(var r=0;r<p;++r){for(var t=0;t<v;++t){var s=t*3+k*r;var q=((t+v*(p-r-1))*4);i._bufferRGBA[q]=o[s+2];i._bufferRGBA[q+1]=o[s+1];i._bufferRGBA[q+2]=o[s];i._bufferRGBA[q+3]=255}}n=true;break;case 32:for(var r=0;r<p;++r){for(var t=0;t<v;++t){var s=t*4+k*r;var q=(t+v*(p-r-1))*4;i._bufferRGBA[q]=o[s+2];i._bufferRGBA[q+1]=o[s+1];i._bufferRGBA[q+2]=o[s];i._bufferRGBA[q+3]=o[s+3]}}n=true;break;default:break}}if(j!==undefined){j(n)}};g.readAsArrayBuffer(a.dataURLToBlob(h))},toCanvas:function(){var h=document.createElement("canvas");h.width=this._width;h.height=this._height;var g=h.getContext("2d");var i=g.getImageData(0,0,h.width,h.height);i.data.set(this._bufferRGBA);g.putImageData(i,0,0,0,0,h.width,h.height);return h},fillCanvas:function(h){h.width=this._width;h.height=this._height;var g=h.getContext("2d");var i=g.getImageData(0,0,h.width,h.height);i.data.set(this._bufferRGBA);g.putImageData(i,0,0,0,0,h.width,h.height)},replaceKeyColorByOther:function(x,t,z){var B=new Uint8ClampedArray(this._width*this._height*4);var u=x.r*255;var A=x.g*255;var g=x.b*255;var h=x.a*255;var k=t.r*255;var n=t.g*255;var q=t.b*255;var r=t.a*255;var l=z?z.r*255:255;var o=z?z.g*255:255;var s=z?z.b*255:255;var v=z?z.a*255:255;for(var y=0;y<this._width;y++){for(var w=0;w<this._height;w++){var p=(w*this._width+y)*4;var m=3;if(Math.abs(this._bufferRGBA[p+0]-u)<m&&Math.abs(this._bufferRGBA[p+1]-A)<m&&Math.abs(this._bufferRGBA[p+2]-g)<m&&Math.abs(this._bufferRGBA[p+3]-h)<m){B[p+0]=k;B[p+1]=n;B[p+2]=q;B[p+3]=r}else{if(z){B[p+0]=l;B[p+1]=o;B[p+2]=s;B[p+3]=v}else{B[p+0]=this._bufferRGBA[p+0];B[p+1]=this._bufferRGBA[p+1];B[p+2]=this._bufferRGBA[p+2];B[p+3]=this._bufferRGBA[p+3]}}}}this._bufferRGBA=B},buildBorderHist:function(n){var m=0;var l=false;for(var k=0;k<this._width;k++){m=(0*this._width+k)*4;if(this._bufferRGBA[m+3]<255){l=true}var g=new b().FromRGBA(this._bufferRGBA[m+0]/255,this._bufferRGBA[m+1]/255,this._bufferRGBA[m+2]/255);var o=g.GetHex();if(n.hasOwnProperty(o)){n[o]++}else{n[o]=0}m=((this._height-1)*this._width+k)*4;if(this._bufferRGBA[m+3]<255){l=true}var g=new b().FromRGBA(this._bufferRGBA[m+0]/255,this._bufferRGBA[m+1]/255,this._bufferRGBA[m+2]/255);var o=g.GetHex();if(n.hasOwnProperty(o)){n[o]++}else{n[o]=0}}for(var h=1;h<this._height-1;h++){var m=(h*this._width+0)*4;if(this._bufferRGBA[m+3]<255){l=true}var g=new b().FromRGBA(this._bufferRGBA[m+0]/255,this._bufferRGBA[m+1]/255,this._bufferRGBA[m+2]/255);var o=g.GetHex();if(n.hasOwnProperty(o)){n[o]++}else{n[o]=0}var m=(h*this._width+(this._width-1))*4;if(this._bufferRGBA[m+3]<255){l=true}var g=new b().FromRGBA(this._bufferRGBA[m+0]/255,this._bufferRGBA[m+1]/255,this._bufferRGBA[m+2]/255);var o=g.GetHex();if(n.hasOwnProperty(o)){n[o]++}else{n[o]=1}}return l},toSubImage:function(l,t,u,p){var g=(l+u)<this._width?u:(this._width-l);var s=(t+p)<this._height?p:(this._height-t);var r=new Uint8ClampedArray(g*s*4);var q=0;for(var n=0;n<s;n++){var m=4*(l+((n+t)*this._width));for(var o=0;o<g;o++){r[q++]=this._bufferRGBA[m++];r[q++]=this._bufferRGBA[m++];r[q++]=this._bufferRGBA[m++];r[q++]=this._bufferRGBA[m++]}}this._width=g;this._height=s;this._bufferRGBA=r},getSubImage:function(l,u,v,q){var g=(l+v)<this._width?v:(this._width-l);var t=(u+q)<this._height?q:(this._height-u);var s=new Uint8ClampedArray(g*t*4);var r=0;for(var o=0;o<t;o++){var n=4*(l+((o+u)*this._width));for(var p=0;p<g;p++){s[r++]=this._bufferRGBA[n++];s[r++]=this._bufferRGBA[n++];s[r++]=this._bufferRGBA[n++];s[r++]=this._bufferRGBA[n++]}}var m=new c();m._width=g;m._height=t;m._bufferRGBA=s;return m},reDimension:function(g,r){var o=new Uint8ClampedArray(g*r*4);var q=this._width/g;var h=this._height/r;for(var k=0;k<r;k++){var n=h*k;for(var l=0;l<g;l++){var p=4*(g*Math.floor(k)+Math.floor(l));var m=4*(this._width*Math.floor(n)+Math.floor(q*l));o[p]=this._bufferRGBA[m];o[p+1]=this._bufferRGBA[m+1];o[p+2]=this._bufferRGBA[m+2];o[p+3]=this._bufferRGBA[m+3]}}this._width=g;this._height=r;this._bufferRGBA=o},innerBilinear:function(i,m,h,k,g,n){var l=1-g;var j=1-n;return(i*l*j+m*g*j+h*l*n+k*g*n)},reDimensionBilinear:function(C,h){var w,u;var v,l,k,n,B,z;var m,t,G,s,F;var p,o;var q,x,A,D;var E=C/this._width;var y=new Uint8ClampedArray(4*C*h);for(w=0;w<h;++w){v=w/E;l=Math.floor(v);k=(Math.ceil(v)>(this._height-1)?(this._height-1):Math.ceil(v));for(u=0;u<C;++u){n=u/E;B=Math.floor(n);z=(Math.ceil(n)>(this._width-1)?(this._width-1):Math.ceil(n));m=(u+C*w)*4;t=(B+this._width*l)*4;G=(z+this._width*l)*4;s=(B+this._width*k)*4;F=(z+this._width*k)*4;p=n-B;o=v-l;q=this.innerBilinear(this._bufferRGBA[t],this._bufferRGBA[G],this._bufferRGBA[s],this._bufferRGBA[F],p,o);y[m]=q;x=this.innerBilinear(this._bufferRGBA[t+1],this._bufferRGBA[G+1],this._bufferRGBA[s+1],this._bufferRGBA[F+1],p,o);y[m+1]=x;A=this.innerBilinear(this._bufferRGBA[t+2],this._bufferRGBA[G+2],this._bufferRGBA[s+2],this._bufferRGBA[F+2],p,o);y[m+2]=A;D=this.innerBilinear(this._bufferRGBA[t+3],this._bufferRGBA[G+3],this._bufferRGBA[s+3],this._bufferRGBA[F+3],p,o);y[m+3]=D}}this._bufferRGBA=y;this._width=C;this._height=h},TERP:function(i,h,g,k,j){return 0.5*(k-h+(2*h-5*g+4*k-j+(3*(g-k)+j-h)*i)*i)*i+g},BicubicInterpolation:function(g,m,h){var l,k,j,i;l=this.TERP(g,h[0][0],h[1][0],h[2][0],h[3][0]);k=this.TERP(g,h[0][1],h[1][1],h[2][1],h[3][1]);j=this.TERP(g,h[0][2],h[1][2],h[2][2],h[3][2]);i=this.TERP(g,h[0][3],h[1][3],h[2][3],h[3][3]);return this.TERP(m,l,k,j,i)},reDimensionBicubic:function(A,l){var s=this._bufferRGBA;var v,t;var r,q;var z,x;var g,I,F,C;var k,h,J,G;var n,B,H,E;var u,m,p,y;var o;var D=A/this._width;var w=new Uint8ClampedArray(4*A*l);for(v=0;v<l;++v){u=v/D;m=Math.floor(u);x=0;if(m<1){x=-1}else{if(m>this._height-3){x=m-(this._height-3)}}for(t=0;t<A;++t){p=t/D;y=Math.floor(p);z=0;if(y<1){z=-1}else{if(y>this._width-3){z=y-(this._width-3)}}I=((m)*this._width+y)*4;g=x<0?I:((m-1)*this._width+y)*4;F=x>1?I:((m+1)*this._width+y)*4;C=x>0?F:((m+2)*this._width+y)*4;h=0;k=z<0?h:-4;J=z>1?h:4;G=z>0?J:8;n=[[s[g+k],s[I+k],s[F+k],s[C+k]],[s[g+h],s[I+h],s[F+h],s[C+h]],[s[g+J],s[I+J],s[F+J],s[C+J]],[s[g+G],s[I+G],s[F+G],s[C+G]]];g++;I++;F++;C++;B=[[s[g+k],s[I+k],s[F+k],s[C+k]],[s[g+h],s[I+h],s[F+h],s[C+h]],[s[g+J],s[I+J],s[F+J],s[C+J]],[s[g+G],s[I+G],s[F+G],s[C+G]]];g++;I++;F++;C++;H=[[s[g+k],s[I+k],s[F+k],s[C+k]],[s[g+h],s[I+h],s[F+h],s[C+h]],[s[g+J],s[I+J],s[F+J],s[C+J]],[s[g+G],s[I+G],s[F+G],s[C+G]]];g++;I++;F++;C++;E=[[s[g+k],s[I+k],s[F+k],s[C+k]],[s[g+h],s[I+h],s[F+h],s[C+h]],[s[g+J],s[I+J],s[F+J],s[C+J]],[s[g+G],s[I+G],s[F+G],s[C+G]]];r=p-y;q=u-m;o=(t+A*v)*4;w[o]=this.BicubicInterpolation(r,q,n);w[o+1]=this.BicubicInterpolation(r,q,B);w[o+2]=this.BicubicInterpolation(r,q,H);w[o+3]=this.BicubicInterpolation(r,q,E)}}this._bufferRGBA=w;this._width=A;this._height=l},scale:function(i,j,g){var k=Math.floor(this._width*i);var h=Math.floor(this._height*j);switch(g){case 1:this.reDimensionBilinear(k,h);break;case 2:this.reDimensionBicubic(k,h);break;default:this.reDimension(k,h);break}},rotate180:function(){if(this._bufferRGBA===null){return}var n=new Uint8ClampedArray(this._bufferRGBA.length);var l=4*this._width;for(var k=0;k<this._height;k++){var g=l*k;var h=l*(this._height-k-1);for(var m=0;m<l;m++){n[h++]=this._bufferRGBA[g++]}}this._bufferRGBA=n},setPixelsOpacity:function(g){var j=4*this._width*this._height;for(var h=3;h<j;h+=4){this._bufferRGBA[h]=g}},removeAreaWithAlphaZero:function(){var i=0;for(var m=0;m<this._width;++m){var j=true;for(var k=0;k<this._height;++k){var g=this.getPixelRGBA(m,k);if(g[3]){i=m;j=false;break}}if(!j){break}}var h=this._width-1;for(var m=this._width-1;m>=0;--m){var j=true;for(var k=0;k<this._height;++k){var g=this.getPixelRGBA(m,k);if(g[3]){h=m;j=false;break}}if(!j){break}}var n=0;for(var k=0;k<this._height;++k){var o=true;for(var m=0;m<this._width;++m){var g=this.getPixelRGBA(m,k);if(g[3]){n=k;o=false;break}}if(!o){break}}var l=this._height-1;for(var k=this._height-1;k>=0;--k){var o=true;for(var m=0;m<this._width;++m){var g=this.getPixelRGBA(m,k);if(g[3]){l=k;o=false;break}}if(!o){break}}if(i>h){i=0;h=this._width-1}if(n>l){n=0;l=this._height-1}this.toSubImage(i,n,h,l)},buildFromDataUrl:function(h,g){if(typeof h!=="string"||h.substring(0,4)!=="blob"){g()}var j=this;var i=new Image();i.onload=function(){var l=document.createElement("canvas");l.width=this.width;l.height=this.height;var m=l.getContext("2d");m.drawImage(this,0,0);j._width=l.width;j._height=l.height;var k=m.getImageData(0,0,l.width,l.height);j._bufferRGBA=new Uint8ClampedArray(k.data);if(g!==undefined){g()}};i.src=h},toDataUrl:function(){var i=document.createElement("canvas");i.width=this._width;i.height=this._height;var h=i.getContext("2d");var g=h.getImageData(0,0,this._width,this._height);g.data.set(this._bufferRGBA);h.putImageData(g,0,0,0,0,i.width,i.height);return i.toDataURL("image/png")},toBlob:function(){return a.dataURLToBlob(this.toDataUrl())},saveAs:function(i){if(!i){return}var j=document.createElement("canvas");j.width=this._width;j.height=this._height;var h=j.getContext("2d");var g=h.getImageData(0,0,j.width,this._height);g.data.set(this._bufferRGBA);h.putImageData(g,0,0,0,0,j.width,j.height);var l=new f();var k="image/jpeg";var m=i.split(".")[1];switch(m){case"png":k="image/png";break;case"bmp":k="image/bitmap";break;case"tif":case"tiff":k="image/tiff";break;case"tga":k="image/x-tga";break;case"gif":k="image/gif";break;case"svg":k="image/svg+xml";break;case"hdr":k="image/vnd.radiance";break;default:break}l.saveAs(j.toDataURL(k,this._quality),i)},getCanvas:function(){var i=document.createElement("canvas");i.width=this._width;i.height=this._height;var h=i.getContext("2d");var g=h.getImageData(0,0,i.width,this._height);g.data.set(this._bufferRGBA);h.putImageData(g,0,0,0,0,i.width,i.height);return i}});return c});