define("DS/GEOWebSearchUI/ContextMenu",["UWA/Controls/Abstract"],function(b){var d={SiteVersion:"dsexploration:SiteVersion",GeologicalModelVersion:"dsgeology:GeologicModelVersion",CoordinateSystem:"dsgeospatial:CompoundSRS",TerrainVersion:"dsexploration:TerrainVersion"};var a={XMD:"GEOXMD_AP",XGDM:"GEOXGDM_AP"};var e={OpenInGeologyModeling:"OpenInGeologyModeling",ShowInGEODataExplorer:"ShowInGEODataExplorer",OpenInGEODataExplorer:"OpenInGEODataExplorer"};var c=b.extend({name:"GEOVIAAction",_compass_socket:null,_action_info:null,_role_check_promise:null,init:function(){},availableForTypes:function(){var f=[];if(true){f=[d.SiteVersion,d.GeologicalModelVersion,d.CoordinateSystem,d.TerrainVersion]}return f},getActionForObject:function(f,h){var g=this;require(["UWA/Class/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(j,k){if(UWA.is(f.sourceid,"string")&&f.sourceid.toLowerCase().indexOf("geovia")===0){if(!UWA.is(g._role_check_promise)){g._role_check_promise=new j(function(m,l){k.getGrantedRoles(function(o){if(UWA.is(o,"array")){for(var n=0;n<o.length;n++){if(o[n]&&(o[n].id==="GML"||o[n].id==="InternalDS")){m();return}}}l()})})}var i=function(){if(UWA.is(h)){var l=[];require(["DS/RuntimeView/NLSManager"],function(m){m.loadResource({resourceFile:"GEOWebSearchUI/ContextMenu"});m.onResourceLoaded({resourceFile:"GEOWebSearchUI/ContextMenu"},function(){switch(f["ds6w:type_value"]){case d.GeologicalModelVersion:l.push({title:this.getTitle({key:e.OpenInGeologyModeling}),icon:"level-down",id:"geovia_xmd_open",multisel:false,callback:g.launchCustoAction.bind(g)});l.push({title:this.getTitle({key:e.ShowInGEODataExplorer}),icon:"level-down",id:"geovia_xgdm_open",multisel:false,callback:g.launchCustoAction.bind(g)});break;case d.SiteVersion:l.push({title:this.getTitle({key:e.OpenInGEODataExplorer}),icon:"level-down",id:"geovia_xgdm_open",multisel:false,callback:g.launchCustoAction.bind(g)});break;case d.CoordinateSystem:l.push({title:this.getTitle({key:e.ShowInGEODataExplorer}),icon:"level-down",id:"geovia_xgdm_open",multisel:false,callback:g.launchCustoAction.bind(g)});break;case d.TerrainVersion:l.push({title:this.getTitle({key:e.ShowInGEODataExplorer}),icon:"level-down",id:"geovia_xgdm_open",multisel:false,callback:g.launchCustoAction.bind(g)});break}h.call(null,l)})})}};g._role_check_promise.then(i)}})},launchCustoAction:function(f){var g=this;require(["UWA/Utils/InterCom"],function(i){if(UWA.is(f)){var j="GEOVIAcompassSocket";if(g._compass_socket===null){g._compass_socket=new i.Socket(j);g._compass_socket.subscribeServer("com.ds.compass",window.parent)}var h=f.model.get("id");var k={protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:[{envId:f.model.get("tenant"),objectId:h,objectType:f.model.get("ds6w:type_value"),displayName:f.model.get("ds6w:label").replace(/&gt;/g,">").replace(/&lt;/g,"<"),serviceId:f.model.get("ds6w:where/ds6w:source/ds6w:dataSource_value")}]}};g._compass_socket.dispatchEvent("onSetX3DContent",k,j);var l;switch(f.action_id){case"geovia_xmd_open":l={appId:a.XMD};break;case"geovia_xgdm_open":l={appId:a.XGDM};break}g._compass_socket.dispatchEvent("onLaunchApp",l,j)}})}});return c});