define("DS/DMUBaseReview/DMUPreferences",["UWA/Class"],function(a){return a.extend({init:function(){this._parent();var b={};this.setPreference=function(c,d){b[c]=d};this.getPreference=function(c){if(b[c]){return b[c]}if(window.widget&&window.widget.hasPreference(c)){return window.widget.getValue(c)}return null}}})});define("DS/DMUBaseReview/DMULinksManagerExport",["UWA/Class"],function(a){return a.extend({init:function(b){this.exportData=function(c,d){if(c&&b){c.writeObjectAttributes(b,d);b.exportLinksManagerData(d)}}}})});define("DS/DMUBaseReview/DMUOccurrenceOverloaderImport",["UWA/Class"],function(a){return a.extend({init:function(b){this.importData=function(d,c){if(d&&c&&b){c.fillObjectAttributes(b,d)}}}})});define("DS/DMUBaseReview/DMUEnvironmentExport",["UWA/Class"],function(a){return a.extend({init:function(b){this.exportData=function(c,d){if(c&&b){c.writeObjectAttributes(b,d)}}}})});define("DS/DMUBaseReview/DMUOccurrenceOverloaderExport",["UWA/Class"],function(a){return a.extend({init:function(b){this.exportData=function(c,d){if(c&&b){c.writeObjectAttributes(b,d)}}}})});define("DS/DMUBaseReview/DMUReviewImport",["UWA/Class"],function(a){return a.extend({init:function(c){var b=false;this.importData=function(e,d){if(e&&d&&c){c.isImporting(true);d.fillObjectAttributes(c,e);if(c._expParent.getCurrentReview()){c._expParent.getCurrentReview().remove();c._expParent.addChild(c)}c._expParent._currentReview=c;c._createNode();c.addNodeInParentNode();if(c._expParent._persistenceManager){c._expParent._persistenceManager.register(c)}d.registerForPostImport(c)}};this.afterImport=function(){if(c){c.isImporting(false);var d=c.getReviewEnvironment();if(d){d.initializeViewpointModifCallback()}}}}})});define("DS/DMUBaseReview/DMUEnvironmentImport",["UWA/Class"],function(a){return a.extend({init:function(b){this.importData=function(d,c){if(d&&c&&b){c.fillObjectAttributes(b,d);b.getParent()._environment=b;c.registerForPostImport(b)}};this.afterImport=function(){if(b){b.refresh(0,true);b.applyCurrent2DSheet();b.applyLockUnlockSection()}}}})});define("DS/DMUBaseReview/DMUOverloadableObject",["DS/DMUBaseExperience/EXPObject","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseExperience/DMUContextManager","DS/Mesh/MeshUtils"],function(a,e,c,d){var b=[{name:"sType",type:"string",JSONname:"type"},{name:"sID",type:"string",JSONname:"id"},{name:"sUuid",type:"string",JSONname:"uuid"},{name:"sName",type:"string",JSONname:"Name"},{name:"sDescription",type:"string",JSONname:"Description"}];var f=a.extend({init:function(h,g){this._parent(h,g);this._sExpType="DMUOverloadableObject";this._parameters=b},initComponent:function(g){this._parent(g)},remove:function(){if(this._expParent){var j=this._expParent.getChildren("DMUSlide");for(var l=j.length-1;l>=0;l--){var g=j[l];if(g){var k=g.getOverloadForTarget(this);if(k){var h=g.getObjectOverloads().indexOf(k);g.getObjectOverloads().splice(h,1)}}}}this._parent()},getState:function(){var j={};var g=this._parameters.length;for(var h=0;h<g;h++){var k=this._parameters[h];if(k.isOverloadable){k=this._parameters[h];j[k.name]=e.cloneType(this.getAttribute(k.name),k.type)}}return j},setNominalState:function(j){var g=this._parameters.length;for(var h=0;h<g;h++){var k=this._parameters[h];if(k.isAstate!==false&&j[k.name]!==undefined&&k.isOverloadable){this["_"+k.name]=e.cloneType(j[k.name],k.type)}}this.refreshNode()},setCreationState:function(i){var g=i||{};this.setNominalState(g);var k=this.GetType()!=="DMUOccurrenceOverloader";var j=this.getCurrentSlide();if(j){var h=j.getOverloadForTarget(this);if((h===null)||(h===undefined)){if(k){g.bVisible=true;h={target:this,state:g}}else{h={target:this,state:{}}}j.getObjectOverloads().push(h)}else{h.state=this.getState();if(k){h.state.bVisible=true}}}if(k&&this.getCurrentSlide()){this._bVisible=false}this.makeDirty()},getNominalState:function(){var h={},j;for(var g=0;g<this._parameters.length;g++){j=this._parameters[g];if(j.isOverloadable){if(this.getNominalAttribute(j.name)!==undefined){h[j.name]=e.cloneType(this.getNominalAttribute(j.name),j.type)}}}return h},getNominalAttribute:function(g){return g&&this["_"+g]!==undefined?this["_"+g]:undefined},getStateForAnimation:function(k,l,j){var g={};for(var h=0;h<this._parameters.length;h++){var m=this._parameters[h];if(m.isOverloadable&&k[m.name]!==undefined&&k[m.name]!==null&&l[m.name]!==undefined&&l[m.name]!==null){g[m.name]=e.lerpType(k[m.name],l[m.name],j,m.type)}}return g},setAttribute:function(k,q){if(!this.isReadOnly()&&k){var j=true;var p=this.getCurrentSlide();if(p){var s=false;var h=p.getOverloadForTarget(this);if((h===null)||(h===undefined)){h={target:this,state:{}};s=true}if(h){var g=h.state;if(g){var o=h.state[k];if(o===undefined){var r=false;var l=this._parameters.length;for(var n=0;!r&&(n<l);n++){var m=this._parameters[n];if(m.name===k&&m.isOverloadable){g[k]=q;this.makeDirty();j=false;r=true}}if(r===true&&s===true&&p.addObjectOverload){p.addObjectOverload(h)}}if(o!==undefined){g[k]=q;this.makeDirty();j=false}}}}if(j){this._parent(k,q)}}},getAttribute:function(g){var i;if(g){var j=this.getCurrentSlide();if(j){var h=j.getOverloadForTarget(this);if(h&&h.state){i=h.state[g]}if(i===undefined&&g==="bVisible"&&this.GetType()!=="DMUOccurrenceOverloader"){i=false}}if(i===undefined){i=this.getNominalAttribute(g)}}return i},set:function(g){if(this.isReadOnly()===false){if(g){var k=this;var j=function(m){if(Array.isArray(m.attribute)){for(var l=0;l<m.attribute.length;l++){k.setAttribute(m.attribute[l],m.value[l])}}else{k.setAttribute(m.attribute,m.value)}};if(Array.isArray(g)){for(var h=0;h<g.length;h++){j(g[h])}}else{j(g)}}}},getCurrentSlide:function(){var g=c.getReviewContext({viewer:this._viewer});if(g&&g.getCurrentReview()){return g.getCurrentReview().getCurrentSlide()}return null},setReadOnly:function(g){this._parent(g);if(this._nNode){this._nNode.setPickable(g?d.NODRAWHL:d.PICKABLE)}},GetType:function(){return"DMUOverloadableObject"}});return f});define("DS/DMUBaseReview/DMUFactory",["UWA/Class","DS/DMUBaseExperience/DMUContextManager"],function(a,c){var b=a.singleton({init:function(){var d=[{name:"Compare3D",library:"DS/DMUPlayCompare/DMUCompare3D"},{name:"Slide",library:"DS/DMUPlaySlide/DMUSlide"},{name:"Marker3DCircle",library:"DS/DMUPlayMarker/DMUMarker3DCircle"},{name:"Marker2DCircle",library:"DS/DMUPlayMarker/DMUMarker2DCircle"},{name:"Marker2DEllipse",library:"DS/DMUPlayMarker/DMUMarker2DEllipse"},{name:"Marker2DArrow",library:"DS/DMUPlayMarker/DMUMarker2DArrow"},{name:"Marker3DArrow",library:"DS/DMUPlayMarker/DMUMarker3DArrow"},{name:"Marker3DRectangle",library:"DS/DMUPlayMarker/DMUMarker3DRectangle"},{name:"Marker2DRectangle",library:"DS/DMUPlayMarker/DMUMarker2DRectangle"},{name:"Marker2DPicture",library:"DS/DMUPlayMarker/DMUMarker2DPicture"},{name:"Marker3DPicture",library:"DS/DMUPlayMarker/DMUMarker3DPicture"},{name:"Marker2DText",library:"DS/DMUPlayMarker/DMUMarker2DText"},{name:"Marker3DText",library:"DS/DMUPlayMarker/DMUMarker3DText"},{name:"Marker3DPoint",library:"DS/DMUPlayMarker/DMUMarker3DPoint"},{name:"Marker2DPoint",library:"DS/DMUPlayMarker/DMUMarker2DPoint"},{name:"Marker2DPolyline",library:"DS/DMUPlayMarker/DMUMarker2DPolyline"},{name:"Marker3DPolyline",library:"DS/DMUPlayMarker/DMUMarker3DPolyline"},{name:"Marker2DLine",library:"DS/DMUPlayMarker/DMUMarker2DLine"},{name:"Marker3DLine",library:"DS/DMUPlayMarker/DMUMarker3DLine"},{name:"Marker2DHyperlink",library:"DS/DMUPlayMarker/DMUMarker2DHyperlink"},{name:"Marker3DHyperlink",library:"DS/DMUPlayMarker/DMUMarker3DHyperlink"},{name:"MeasureItem",library:"DS/DMUPlayMeasure/DMUMeasure"},{name:"MeasureBetween",library:"DS/DMUPlayMeasure/DMUMeasure"},{name:"MeasureThickness",library:"DS/DMUPlayMeasure/DMUMeasure"},{name:"Measure3PointsCircle",library:"DS/DMUPlayMeasure/DMUMeasure"},{name:"Measure3PointsAngle",library:"DS/DMUPlayMeasure/DMUMeasure"},{name:"Section",library:"DS/DMUPlaySection/DMUSection"},{name:"ExternalLinks",library:"DS/DMUBaseReview/DMULinksManager"},{name:"OccurrenceOverloader",library:"DS/DMUBaseReview/DMUOccurrenceOverloader"},{name:"Environment",library:"DS/DMUBaseReview/DMUEnvironment"},{name:"Review",library:"DS/DMUBaseReview/DMUReviewBasic"}];var e,f=0;function g(h,i){require([h.library],function(j){h.module=j;f++;if(f===d.length){i()}},function(){h.module=null;f++;if(f===d.length){i()}})}this.initFactory=function(i,j){e=i;if(f!==d.length){for(var h=0;h<d.length;h++){g(d[h],j)}}else{j()}};this.BuildComponent=function(i){if(f===d.length){for(var h=0;h<d.length;h++){if(i===d[h].name){if(d[h].module){return new d[h].module(e,c.getReviewContext({viewer:e}))}else{return null}}}}return null}},initFactory:function(){},BuildComponent:function(){}});return{initFactory:function(d,e){return b.initFactory(d,e)},BuildComponent:function(d){return b.BuildComponent(d)}}});define("DS/DMUBaseReview/DMUReviewExport",["UWA/Class"],function(a){return a.extend({init:function(b){this.exportData=function(c,d){if(c&&b){c.writeObjectAttributes(b,d)}}}})});define("DS/DMUBaseReview/DMULinksManagerImport",["UWA/Class"],function(a){return a.extend({init:function(b){this.importData=function(d,c){if(d&&c&&b){c.fillObjectAttributes(b,d);b.importLinksManagerData(d);c.registerForPostImport(b)}};this.afterImport=function(){if(b){b.completeData()}}}})});define("DS/DMUBaseReview/DMUEnvironment",["DS/DMUBaseReview/DMUOverloadableObject","DS/DMUBaseExperience/EXPToolsVisualization","DS/Visualization/ThreeJS_DS","DS/Core/Events","DS/DMUBaseExperience/EXPManagerSet","DS/DMUBaseReview/DMUEnvironmentImport"],function(h,a,f,e,g,d){var c=[{name:"vViewpointPosition",type:"Vector3",JSONname:"ViewpointProperty.Position",defaultValue:new f.Vector3(1000,1000,1000),isOverloadable:true},{name:"vViewpointSight",type:"Vector3",JSONname:"ViewpointProperty.Sight",defaultValue:new f.Vector3(-1,0,0),isOverloadable:true},{name:"vViewpointUp",type:"Vector3",JSONname:"ViewpointProperty.Up",defaultValue:new f.Vector3(0,1,0),isOverloadable:true},{name:"vViewpointRight",type:"Vector3",JSONname:"ViewpointProperty.Right",defaultValue:new f.Vector3(0,0,1),isOverloadable:true},{name:"fViewpointTargetDistance",type:"float",JSONname:"ViewpointProperty.targetDistance",defaultValue:3000,isOverloadable:true},{name:"fViewpointFieldOfView",type:"float",JSONname:"ViewpointProperty.fieldOfView",isOverloadable:true},{name:"iViewpointType",type:"int",JSONname:"ViewpointProperty.type",isOverloadable:true},{name:"bLockUnlockSection",type:"bool",JSONname:"SessionProperty.LockUnlockSection",isOverloadable:true,defaultValue:true},{name:"sFocusProperty",type:"listStrings",JSONname:"FocusProperty.targetId",isOverloadable:true}];var b=h.extend({init:function(k,p){this._parent(k,p);this._sExpType="DMUEnvironment";this._sType="Environment";this._parameters=this._parameters.concat(c);this.defineMembersFromParameters();var l=this,r=false,i,q,n;function o(s,u){for(var t=0;t<s.length;t++){if(s[t].toString().match(u)){return t}}return -1}this.initializeViewpointModifCallback=function(){if(i===undefined||i===null){i=e.subscribe({event:"/VISU/"},function(s){if(s.eventType==="@onViewpointEndMove"){if(r===false){l.captureViewpoint()}r=false}});q=e.subscribe({event:"/DMULOCKUNLOCKSECTION/"},function(){l.captureLockUnlockSection()});n=e.subscribe({event:"/DMUCHANGE2DSHEET/"},function(){l.captureCurrent2DSheet()});l.captureCurrent2DSheet();l.captureViewpoint()}};this.disableViewpointModifCallback=function(){e.unsubscribe(i);e.unsubscribe(q);e.unsubscribe(n);i=q=n=null};this.captureViewpoint=function(){if(!r&&!l.isReadOnly()){var s=a.getViewpointInfo(l._viewer.currentViewpoint);var t=l._viewer.currentViewpoint?l._viewer.currentViewpoint.getProjectionType():null;l.set({attribute:["vViewpointSight","vViewpointRight","vViewpointUp","vViewpointPosition","fViewpointTargetDistance","iViewpointType"],value:[s.sight,s.right,s.up,s.position,s.distance,t]})}};this.captureCurrent2DSheet=function(){if(!l.isReadOnly()){var w=g.getManager({name:"DMU2DSheetManager",context:l._frmWindow});if(w){var v=w.getCurrentSheet();if(v){var u=l.getAttribute("sFocusProperty");if(!u){u=[]}var t=/^Drw.+/;var s=o(u,t);if(s!==-1){u[s]=v}else{u.push(v)}l.set({attribute:"sFocusProperty",value:u});l.captureViewpoint()}}}};this.applyCurrent2DSheet=function(){var w=g.getManager({name:"DMU2DSheetManager",context:l._frmWindow});if(w){var u=l.getAttribute("sFocusProperty");if(u){var v=u.length;if(v>0){var t=/^Drw.+/;var s=o(u,t);if(s!==-1){w.setCurrentSheet({sheetID:u[s],cbOnSheetNotFound:function(){if(l.isReadOnly()===false){l.captureCurrent2DSheet()}}})}}}}};this.captureLockUnlockSection=function(){if(l._viewer._lockUnlockCmd&&!l.isReadOnly()){l.set({attribute:"bLockUnlockSection",value:l._viewer._lockUnlockCmd.getState()})}};this.applyLockUnlockSection=function(){if(l._viewer._lockUnlockCmd){l._viewer._lockUnlockCmd.setState(l.getAttribute("bLockUnlockSection"))}};this.setActiveFlag=function(s){if(!s&&l._viewer.currentViewpoint){this._viewer.currentViewpoint.setAngle(45)}};this.refresh=function(u,y){if(typeof y==="boolean"){r=y}var v=this.getAttribute("vViewpointPosition");var s=this.getAttribute("vViewpointSight");var t=this.getAttribute("fViewpointTargetDistance");var x=this.getAttribute("vViewpointUp");var w=this.getAttribute("iViewpointType");if(w!==undefined){this._viewer.currentViewpoint.setProjectionType(w)}var z=this.getAttribute("fViewpointFieldOfView");z=z!==undefined&&z!==null&&!isNaN(z)?z:45;this._viewer.currentViewpoint.setAngle(z);a.moveViewpoint(this._viewer,v,null,s,x,t,u===undefined?0:u)};var m="DS/DMUBaseReview/DMUEnvironmentExport";require([m],function(t){var s=new t(l);l.exportData=s.exportData});var j=new d(l);this.importData=j.importData;this.afterImport=j.afterImport},remove:function(){this.disableViewpointModifCallback();this._parent()},GetType:function(){return"DMUEnvironment"}});return b});define("DS/DMUBaseReview/DMULinksManager",["DS/DMUBaseExperience/EXPObject","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Visualization/PathElement","DS/DMUBaseReview/DMULinksManagerImport"],function(b,f,e,a){var d=[{name:"sType",type:"string",JSONname:"type",defaultValue:"ExternalLinks"}];var c=b.extend({init:function(j,g){this._parent(j,g);this._sExpType="DMULinksManager";this._parameters=d;this.defineMembersFromParameters();this._entities=[];this._occurrences=[];var h="DS/DMUBaseReview/DMULinksManagerExport",k=this;require([h],function(m){var l=new m(k);k.exportData=l.exportData});var i=new a(k);this.importData=i.importData;this.afterImport=i.afterImport},initComponent:function(g){this._parent(g)},getChildWithID:function(g){var h=null;this._occurrences.some(function(i){if(i&&(i.id===g)){h=i;return true}});if(!h){this._entities.some(function(i){if(i&&(i.id===g)){h=i;return true}})}if(h&&!h.pathElement){this.completeData()}return h},getOccurrence:function(w){var m;var s=f.cleanOccurrencePathElement(w);var t=[];var o=s.getLength();var n=true;for(var z=0;n&&(z<o);z++){var u=s.getElement(z);var h=f.getNodeID(u);var g=(u.name)?u.name:undefined;var q=null;this._entities.some(function(i){if(i&&((i.identifier&&(i.identifier===h))||(i.target&&(i.target===g)))){q=i;return true}});if(q){t.push(q.id)}else{n=false}}if(n){var p=t.length;var l=this._occurrences.length;var r=false;for(var x=0;!r&&(x<l);x++){var A=this._occurrences[x].path;var y=A.length;if(p===y){var B=true;for(var v=0;B&&(v<y);v++){B=(t[v]===A[v])}r=B;if(B){m=this._occurrences[x]}}}}return m},createOccurrence:function(m){var p=this.getOccurrence(m);var h=f.cleanOccurrencePathElement(m);if(!p){var q=[];var g=h.getLength();for(var l=0;l<g;l++){var j=h.getElement(l);var n=f.getNodeID(j);var o=(j.name)?j.name:undefined;var k=null;this._entities.some(function(i){if(i&&((i.identifier&&(i.identifier===n))||(i.target&&(i.target===o)))){k=i;return true}});if(!k){k={id:this.computeNewID(),identifier:n,target:o};this._entities.push(k)}q.push(k.id)}p={id:this.computeNewID(),path:q,pathElement:h};this._occurrences.push(p)}this._isDirty=1;return p},exportLinksManagerData:function(k){k.entities=[];var l=this._entities.length;for(var h=0;h<l;h++){var g=this._entities[h];k.entities.push({id:g.id,identifier:g.identifier,target:g.target})}k.occurrences=[];var j=this._occurrences.length;for(var h=0;h<j;h++){var m=this._occurrences[h];k.occurrences.push({id:m.id,path:m.path})}},importLinksManagerData:function(k){var l=k.entities.length;for(var h=0;h<l;h++){var g=k.entities[h];this._entities.push({id:g.id,identifier:g.identifier,target:g.target})}var j=k.occurrences.length;for(var h=0;h<j;h++){var m=k.occurrences[h];this._occurrences.push({id:m.id,path:m.path,pathElement:null})}},completeData:function(){var w=this.getParent()._viewer.getRootNode();var l=w.getChildByName("root-bag-web");if(!l){l=w.getChildByName("RootBag")}if(l){w=l}var n=this._occurrences.length;for(var t=0;t<n;t++){if(this._occurrences[t].path&&!this._occurrences[t].pathElement){var h=[];var p=w;h.push(p);var u=this._occurrences[t].path;var o=u.length;for(var s=0;p&&(s<o);s++){var r=null;this._entities.some(function(i){if(i&&(i.id===u[s])){r=i;return true}});if(r){var x=false;if(r.identifier){var m=p.getChildren();var v=m.length;for(var q=0;!x&&(q<v);q++){var g=m[q];if(f.getNodeID(g)){x=f.getNodeID(g)===r.identifier;if(x){p=g}}else{if(g&&g.persistentId){x=(g.persistentId===r.identifier);if(x){p=g}}}}}if(!x&&r.target){p=p.getChildByName(r.target);if(p){x=true}}if(x&&p){h.push(p)}}}if(o===(h.length-1)){this._occurrences[t].pathElement=new e(h)}}}},GetType:function(){return"DMULinksManager"}});return c});define("DS/DMUBaseReview/DMUOccurrenceOverloader",["DS/DMUBaseReview/DMUOverloadableObject","DS/Visualization/Node3D","DS/DMUBaseExperience/EXPUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/DMUContextManager","DS/CoreEvents/Events","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseReview/DMUOccurrenceOverloaderImport"],function(b,d,c,i,h,a,f,g){var e=[{name:"sTargetId",type:"string",JSONname:"targetId"},{name:"bVisible",type:"bool",JSONname:"PropertiesOccurrenceOverloader.GraphicProperties.visible",isOverloadable:true},{name:"cColor",type:"Color",JSONname:"PropertiesOccurrenceOverloader.GraphicProperties.color",isOverloadable:true},{name:"fOpacity",type:"float",JSONname:"PropertiesOccurrenceOverloader.GraphicProperties.opacity",isOverloadable:true},{name:"mPosition",type:"Matrix4",JSONname:"PropertiesOccurrenceOverloader.position",isOverloadable:true}];var j=b.extend({init:function(n,m){this._parent(n,m);this._sExpType="DMUOccurrenceOverloader";this._parameters=this._parameters.concat(e);this.defineMembersFromParameters();var k="DS/DMUBaseReview/DMUOccurrenceOverloaderExport",o=this;require([k],function(q){var p=new q(o);o.exportData=p.exportData});var l=new g(o);this.importData=l.importData;this.afterImport=l.afterImport},initComponent:function(k){this._parent(k);this._sType="OccurrenceOverloader";this._sID=this.computeNewID();this.setOccurrence(k.occurrence);this._nNode=new d(this._sName);this._nNode.getDMUType=function(){return"DMUOccurrenceOverloader"};this.addNodeInParentNode()},remove:function(){var k=h.getReviewContext({viewer:this._viewer});if(k){var l=k.getSceneGraphOverrideSet();if(l&&this._occurrence.pathElement){i.removeSceneGraphOverride(l,this._occurrence.pathElement)}}this._occurrence=null;this._material=null;this._parent()},completeData:function(){if(this.getParent().getLinksManager(false)){this.getParent().getLinksManager(false).completeData()}},setOccurrence:function(k){if(!this._occurrence&&k){this._occurrence=k;this._sTargetId=k.id}},getOccurrence:function(){return this._occurrence},isOverloading:function(k){if(!this._occurrence.pathElement){this.completeData()}return this._occurrence.pathElement?this._occurrence.pathElement.isEqual(k):false},isOverloadedInCurrentSlide:function(){if(!this._occurrence.pathElement){return false}var l=h.getReviewContext({viewer:this._viewer});if(!l||!l.getCurrentReview().getCurrentSlide()){return false}this._doNotRetrieveNominalAttr=true;var k=this.getAttribute("bVisible");if(k!==null&&k!==undefined){this._doNotRetrieveNominalAttr=false;return true}k=this.getAttribute("fOpacity");if(k!==null&&k!==undefined){this._doNotRetrieveNominalAttr=false;return true}k=this.getAttribute("cColor");if(k!==null&&k!==undefined){this._doNotRetrieveNominalAttr=false;return true}k=this.getAttribute("mPosition");if(k!==null&&k!==undefined){this._doNotRetrieveNominalAttr=false;return true}this._doNotRetrieveNominalAttr=false;return false},getNominalAttribute:function(l){var o;if(this._doNotRetrieveNominalAttr){return o}if(l==="bVisible"||l==="cColor"||l==="fOpacity"||l==="mPosition"){var p=h.getReviewContext({viewer:this._viewer});if(p){var q=p.getSceneGraphOverrideSet();if(q&&this._occurrence.pathElement){var m=i.getSceneGraphOverride(q,this._occurrence.pathElement);var k=this._viewer.getSceneGraphOverrideSetManager();var n=null;if(k&&m){if(l==="bVisible"){n=m.getVisibility();m.setVisibility(null);o=k.computeInheritedVisibility(this._occurrence.pathElement);if(n){m.setVisibility(n)}}else{if(l==="cColor"){n=m.getColor();m.setColor(null);o=k.computeInheritedColor(this._occurrence.pathElement);if(n){m.setColor(n)}}else{if(l==="fOpacity"){n=m.getOpacity();m.setOpacity(null);o=k.computeInheritedOpacity(this._occurrence.pathElement);if(n){m.setOpacity(n)}}else{if(l==="mPosition"){n=m.getPosition();m.setPosition(null);o=k.computeAppliedPosition(this._occurrence.pathElement);if(n){m.setPosition(n)}}}}}}}}return o}else{return this._parent(l)}},refreshNode:function(){if(!this._occurrence&&this._sTargetId){this.setOccurrence(this.getParent().getChildWithID(this._sTargetId))}if(this._occurrence&&!this._occurrence.pathElement){this.completeData()}if(this._occurrence&&this._occurrence.pathElement){var o=h.getReviewContext({viewer:this._viewer});if(o){var p=o.getSceneGraphOverrideSet();if(p){var m=i.getSceneGraphOverride(p,this._occurrence.pathElement);var n,l;if(m){n=this._savedVisibleFlag===undefined||this._savedVisibleFlag===null?true:this._savedVisibleFlag;var k=this.getAttribute("bVisible");l=k===undefined||k===null?true:k;m.setVisibility(k===undefined?null:k);k=this.getAttribute("fOpacity");m.setOpacity(k===undefined?null:k);k=this.getAttribute("cColor");m.setColor(k&&k.getHexString?"#"+k.getHexString():null,true);k=this.getAttribute("mPosition");m.setPosition(k===undefined?null:k);this._viewer.render()}if(n!==l){a.publish({event:"/"+h.getContextViewer({viewer:this._viewer}).getCommandContext()+(l?"/DMUSHOW/":"/DMUHIDE/"),data:{flag:l,occurrence:this}})}this._savedVisibleFlag=l}}}},GetType:function(){return"DMUOccurrenceOverloader"}});return j});define("DS/DMUBaseReview/DMUReviewBasic",["DS/DMUBaseExperience/EXPCollection","DS/DMUBaseExperience/EXPUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/WebappsUtils/WebappsUtils","DS/DMUBaseReview/DMUReviewImport","DS/DMUBaseReview/DMULinksManager","DS/DMUBaseReview/DMUOccurrenceOverloader","DS/DMUBaseReview/DMUEnvironment"],function(j,e,g,c,a,b,h,d){var f=[{name:"sType",type:"string",JSONname:"type"},{name:"sID",type:"string",JSONname:"id"},{name:"sName",type:"string",JSONname:"Name"},{name:"sDescription",type:"string",JSONname:"Description"},{name:"sCurrentSlideId",type:"string",JSONname:"CurrentSlideId"},{name:"sImageURL",type:"ImageURL",JSONname:"ImageURL"},{name:"dmuObjects",type:"listObjects",JSONname:"DMUObjects",defaultValue:[]},{name:"reviewEnvironment",type:"object",JSONname:"ReviewEnvironment",defaultValue:null}];var i=j.extend({init:function(p,o){this._parent(p,o);this._sExpType="DMUReview";this._sName="Review";this._sType="Review";this._sDescription="";this._parameters=f;this.defineMembersFromParameters();this._overloads={};this._sImageURL="";var q=this;var k;this._currentSlide=null;var l=false;this.setActiveFlag=function(r){if(r){for(var s=0;s<q._children.length;s++){if(q._children[s].setActiveFlag){q._children[s].setActiveFlag(r)}}if(k){k.activate();k=null}}else{if(q._currentSlide&&q._currentSlide.activate){k=q._currentSlide;k.deactivate()}for(var s=0;s<q._children.length;s++){if(q._children[s].setActiveFlag){q._children[s].setActiveFlag(r)}}}if(q._reviewEnvironment&&q._reviewEnvironment.setActiveFlag){q._reviewEnvironment.setActiveFlag(r)}};this.isImporting=function(r){if(typeof r==="boolean"){l=r}return l};var m="DS/DMUBaseReview/DMUReviewExport";require([m],function(s){var r=new s(q);q.exportData=r.exportData});var n=new a(q);this.importData=n.importData;this.afterImport=n.afterImport},addChild:function(k){this._parent(k);if(k._sExpType!=="DMUEnvironment"){this.set({attribute:"dmuObjects",value:k,mode:"addValue"})}},removeChild:function(k){this._parent(k);this._dmuObjects.splice(this._dmuObjects.indexOf(k),1)},_createNode:function(){if(!this._nNode){this._parent();this._nNode.name=this._sName}for(var k=0;k<this._children.length;k++){if(this._children[k]._nNode){this._nNode.add(this._children[k]._nNode)}}this.refreshNode()},setReadOnly:function(k){this._parent(k);for(var l=0;l<this._children.length;l++){this._children[l].setReadOnly(k)}if(this._expParent){this._expParent.onReviewReadOnlyFlagChanged()}},refreshNode:function(k){for(var l=0;l<this._children.length;l++){if(k&&k.doNotRefresh&&k.doNotRefresh.length&&k.doNotRefresh.indexOf(this._children[l].GetType())!==-1){continue}if(k&&k.refreshOnly){if(k.refreshOnly.length&&k.refreshOnly.indexOf(this._children[l].GetType())!==-1){this._children[l].refreshNode()}continue}this._children[l].refreshNode()}},getOverloadWithID:function(l){var k=null;var m=[this._overloads.EnvironmentOverloads,this._overloads.ContextOverloads,this._overloads.ObjectOverloads];m.some(function(n){n.some(function(o){if(o&&o.id===l){k=o;return true}});k=k!==null});return k},computeNewName:function(k){var o=1;var n;while(true){n=k+"."+o;var m=false;for(var l=0;!m&&l<this._children.length;l++){m=(this._children[l]._sName===n)}if(m){o++}else{break}}return n},getDMUObjectFromPathElement:function(t,u,v){var q=null;var n=false;var w=false;var p=t.getLength();for(w=0;!n&&(w<p);w++){n=(t.getElement(w,true)===this._nNode)}if(n){var r=t.getElement(w,true);for(var s=0;!q&&(s<this._children.length);s++){var o=this._children[s];if(o._nNode===r){q=o}}}else{if(!u){var m=t.getLastElement(true);if(m._bLastInstance){q=this.getOverloaderOnPathElement(t,v)}else{var l=t.clone();while(l&&!(g.isInstance(m))){l=l.getParentPath();if(l){m=l.getLastElement()}}if(l){q=this.getOverloaderOnPathElement(l,v);m._bLastInstance=true}else{var k=t.externalPath[0].name;if((k==="root-bag-web")||(k==="RootBag")){q=this.getOverloaderOnPathElement(t,v)}}}}}return q},getOccurenceOnPathElement:function(l,n){var m=(n===undefined)?true:n;var o;var k=this.getLinksManager(m);if(k){o=k.getOccurrence(l);if(!o&&m){o=k.createOccurrence(l)}}return o},getLinksManager:function(n){var k;var m=(n===undefined)?true:n;var l=this.getChildren("DMULinksManager");if(l.length===0){if(m){k=new b(this._viewer,this._expParent);k.initComponent({context:this})}}else{k=l[0]}return k},getOverloaderOnPathElement:function(k,p){var q;var o=(p===undefined)?true:p;var r=this.getOccurenceOnPathElement(k,o);if(r){var m=this.getChildren("DMUOccurrenceOverloader");var l=m.length;for(var n=0;!q&&(n<l);n++){if(m[n].isOverloading(r.pathElement)){q=m[n]}}if(!q&&o){q=new h(this._viewer,this._expParent);q.initComponent({context:this,occurrence:r});q.setAttribute("sName",this.computeNewName("DMUOccurrenceOverloader"))}}return q},remove:function(){this._parent();if(this._dmuObjects){this._dmuObjects.length=0}if(this._expParent){if(this._expParent._persistenceManager){this._expParent._persistenceManager.remove(this)}}},addOrModifyEnvironment:function(){var k=this._reviewEnvironment;if(!k){k=this.getEnvironment();if(!k){k=new d(this._viewer,this._expParent);k.initComponent({context:this,viewer:this._viewer});this._expParent._environment=k}}this.set({attribute:"reviewEnvironment",value:k});k.captureViewpoint();k.captureLockUnlockSection()},getReviewEnvironment:function(){return this._reviewEnvironment},getEnvironment:function(){var k=this.getReviewEnvironment();if(!k&&this._expParent){k=this._expParent.getEnvironment()}return k},setCurrentSlide:function(k){this._currentSlide=k;if(this._currentSlide){this.setAttribute("sCurrentSlideId",this._currentSlide._sID)}},getCurrentSlide:function(){return this._currentSlide},onAfterSlideRemoved:function(){var k=this.getChildren("DMUSlide");if(!k.length&&this._reviewEnvironment){this._reviewEnvironment.disableViewpointModifCallback()}},setImage:function(k){this.set({attribute:"sImageURL",value:k,makeDirty:false})},getImage:function(){return this.getAttribute("sImageURL")},GetType:function(){return"DMUReviewBasic"}});return i});define("DS/DMUBaseReview/DMUExperience",["DS/DMUBaseExperience/EXPCollection","DS/DMUBaseExperience/EXPControllerEvents","DS/DMUBaseExperience/EXPPersistenceManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseReview/DMUEnvironment","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseReview/DMUReviewBasic","DS/DMUBaseReview/DMUPreferences"],function(g,i,j,f,a,e,h,b){var d=[{name:"sExperiencePathRelativePath",type:"string",JSONname:"Experience.ExperiencePathRelativePath"},{name:"sExperiencePathPrefix",type:"string",JSONname:"Experience.ExperiencePathPrefix"},{name:"sExperienceClassPath",type:"string",JSONname:"Experience.ExperienceClassPath"}];var c=g.extend({init:function(k,o){this._frmWindow=k;this._viewer=k.getViewer();this._parent(this._viewer,null);this._sExpType="DMUExperience";this._currentReview=null;this._reviewPhysId=null;var p=this;var l=false;var m=new b();var n;this._parameters=d;this.defineMembersFromParameters();this._nextIDnumber=1;this._sID=o;this._persistenceManager=new j();this._sceneGraphOverrideSet=f.createSceneGraphOverrideSet(this._viewer);this.getDMUPreferenceRepository=function(){return m};this.initReviewContext=function(r,t,q){if(!p._nNode){p._createNode();if(r){n=r}p._reviewContextController=t;var s=function(){e.removeSwitchedReviewContext({viewer:p._viewer});e.removeReviewContext({viewer:p._viewer});e.removeSavedReviewContext({viewer:p._viewer})};p.eventToken=p._reviewContextController.addEvent(i.Events.EXPRootRemovedEvent,s);p.eventTokenAssetChanged=p._reviewContextController.addEvent(i.Events.EXPAssetChangedEvent,s);p.eventTokenExpDisposed=p._reviewContextController.addEvent(i.Events.EXPExperienceDisposed,s);p._currentReview=new h(p._viewer,p);p._currentReview.initComponent({context:p});if(p._persistenceManager){p._persistenceManager.register(p._currentReview)}p._currentReview._createNode();p._currentReview.addNodeInParentNode();p.setActiveFlag(true)}if(q){m=q}};this.isInitialized=function(){return p._nNode!==null&&p._nNode!==undefined};this.setActiveFlag=function(q){if(q!==l){l=q;if(l){if(p._currentReview){p._currentReview.refreshNode()}if(p._nNode){p._viewer.getRootNode().addChild(p._nNode)}if(p._currentReview){p._currentReview.setActiveFlag(true)}if(p._environment){p._environment.initializeViewpointModifCallback()}}else{if(n){n.clearUI(true)}if(p._currentReview){p._currentReview.setActiveFlag(false)}if(p._nNode){p._viewer.getRootNode().removeChild(p._nNode)}if(p._environment){p._environment.disableViewpointModifCallback()}}if(p._environment&&p._environment.setActiveFlag){p._environment.setActiveFlag(q)}}};this.getActiveFlag=function(){return l};this.makeDirty=function(){if(p._currentReview){p._currentReview._isDirty=1;p._currentReview.refreshNode({refreshOnly:["DMUSlide"]})}};this.onReviewReadOnlyFlagChanged=function(){if(p._currentReview){p._currentReview.refreshNode({refreshOnly:["DMUSlide"]})}};this.getUIManager=function(){return n};this.cleanDMUObject=function(){if(n){n.restoreCmds();n.remove();n=null}if(p._reviewContextController){if(p.eventToken){p._reviewContextController.removeEvent(p.eventToken);p.eventToken=undefined}if(p.eventTokenAssetChanged){p._reviewContextController.removeEvent(p.eventTokenAssetChanged);p.eventTokenAssetChanged=undefined}if(p.eventTokenExpDisposed){p._reviewContextController.removeEvent(p.eventTokenExpDisposed);p.eventTokenExpDisposed=undefined}e.unreferenceEventsController({context:p._viewer})}f.getSceneRoot(p._viewer).remove(p._nNode);f.removeSceneGraphOverrideSet(p._viewer,p._sceneGraphOverrideSet);if(p._persistenceManager){p._persistenceManager.clear()}p._nextIDnumber=p._persistenceManager=p._sceneGraphOverrideSet=p._nNode=null;p._currentReview=p._reviewPhysId=p._environment=null}},remove:function(){this.cleanDMUObject();this._parent()},computeNewID:function(){var k="",l=false;while(!l){k=""+this._nextIDnumber;var m=this.getChildWithID(k,true);if(!m){l=true}else{k="";this._nextIDnumber++}}return k},setReadOnly:function(k){this._parent(k);if(this._currentReview){this._currentReview.setReadOnly(k)}},_createNode:function(){if(!this._nNode){this._parent();this._nNode.name="Experience"}return this._nNode},checkCurrentReviewInSession:function(k){if(this._reviewPhysId&&this._reviewPhysId.reviewId&&k){return this._reviewPhysId.reviewId===k}return false},getPersistenceManager:function(){return this._persistenceManager},getSceneGraphOverrideSet:function(){return this._sceneGraphOverrideSet},getEnvironment:function(){return this._environment},getCurrentReview:function(){return this._currentReview},GetType:function(){return"DMUExperience"}});return c});