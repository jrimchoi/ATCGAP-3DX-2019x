define("DS/ENOFilterBIUX/FBISettings",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Data","DS/WebappsUtils/WebappsUtils","text!DS/ENOFilterBIUX/assets/FBISettings.json"],function(e,g,d,c,h,a,f){var i=function(j){var k=/(http|https):\/\//;return k.test(j)};var b=g.singleton(d,c,{options:{fbi_settings:{},},loadComplete:false,settings_loaded:[],onCompleteLoad:undefined,init:function(j){this.options=JSON.parse(f);this.debugMode=this.getDebugMode()},load:function(j){this.log("FBISettings load");if(this.settings_loaded.indexOf(j.url)){this.onCompleteLoad=j.onComplete;this._loadSettings(j.url);this.settings_loaded.push(j.url)}},urlSettings:function(k){if(e.is(k.debug_me)){this.options.FBI_settings.debug_mode=true}if(this.options.FBI_settings.debug_mode===true){this.debugMode=true}this.log("updateSettings from the URL done");for(var j in k){if(j==="debug_me"){this.log("Debug mode already taken into account")}else{var l=k[j];if(((typeof l!="undefined")&&(typeof l.valueOf()=="string"))&&l.length>0){if(l.toLowerCase()=="false"){l=false}else{if(l.toLowerCase()=="true"){l=true}}}this.options.FBI_settings[j]=l}}},initialize:function(j){this.options=UWA.extend(this.options,j,true);this.debugMode=this.getDebugMode()},setOption:function(j,k){this.options.fbi_settings[j]=k},serialize:function(){return JSON.stringify(this.options)},getDebugMode:function(){if(UWA.is(this.options)&&UWA.is(this.options.fbi_settings)&&this.options.fbi_settings.debug_mode){return true}else{return false}},getOption:function(j){if(UWA.is(this.options)){if(UWA.is(this.options.fbi_settings)&&UWA.is(this.options.fbi_settings[j])){return this.options.fbi_settings[j]}else{if(UWA.is(this.options.NGF_settings)&&UWA.is(this.options.NGF_settings[j])){return this.options.NGF_settings[j]}else{if(UWA.is(this.options[j])){return this.options[j]}}}}else{return undefined}},_loadSettings:function(k){var n=this;var p={};var j={timeout:50000,method:"GET",data:p,type:"json",headers:{Accept:"application/ds-json"},onComplete:function(s){n.log("FBISettings load settings onComplete");var q={},r={};if(e.is(s,"string")){q=JSON.parse(s)}else{q=s}if(q.error){n.log("Bad format for FBISettings")}else{n.initialize(q)}n.loadComplete=true;if(e.is(n.onCompleteLoad,"function")){n.onCompleteLoad.call(undefined,null)}n.log("Available FBI Settings:\n"+JSON.stringify(n.options))},onFailure:function(q){e.log("No settings found");if(e.is(n.onCompleteLoad,"function")){n.onCompleteLoad.call(undefined,null)}},onTimeout:function(q){n.log("No settings found timeout reach")}};try{if(!i(k)){var m="";m=a.getWebappsBaseUrl();var l=/\/$/;m=m.replace(l,"");this.log("Base URL "+m);if(!i(m)){this.log("The base URL is not a valid one (webapp context?)");m=""}k=m+k}this.log("Used URL "+k);h.request(k,j)}catch(o){this.log("Failure : "+o)}}});return b});define("DS/ENOFilterBIUX/FilterBIProxyController",["UWA/Class","UWA/Core"],function(c,b){var a=[];var d=c.singleton({WIDGETS_PRIORITIES:[],init:function(e){d.WIDGETS_PRIORITIES.push(0)},add:function(e){a.push(e)},addPriority:function(g){var e=d.WIDGETS_PRIORITIES.length;for(var f=0;f<e;f++){if(d.WIDGETS_PRIORITIES[f]!==g){d.WIDGETS_PRIORITIES.push(g);break}}},minPriority:function(){return Math.min.apply(null,d.WIDGETS_PRIORITIES)},removePriority:function(g){var e=d.WIDGETS_PRIORITIES.length;for(var f=0;f<e;f++){if(d.WIDGETS_PRIORITIES[f]===g){delete d.WIDGETS_PRIORITIES[f]}}},remove:function(e){var h=a.length;for(var g=h-1;g>=0;g--){var f=a[g];if(f.appId===e.appId&&f.widgetId===e.widgetId){a.splice(g,1);break}}if(1===a.length){a[0].setProxyAsMaster()}},synchronize:function(f,g,e){a.forEach(function(h){if(h.appId===f){g(e)}})}});return d});Number.isInteger=Number.isInteger||function(a){return typeof a==="number"&&isFinite(a)&&Math.floor(a)===a};define("DS/ENOFilterBIUX/FBIServices",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Promise","UWA/Date","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENOFilterBIUX/FBISettings","DS/i3DXSNDictionaryAPI/3DXSearchDictionaryAccess","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/UWPClientCode/I18n"],function(i,j,c,f,h,g,a,d,e,k,b){var l=j.singleton(c,{DEFAULT_LANG:"en",DICTIONARY_ACCESS_LEVEL:d.getOption("DictionaryAccessLevel"),_nodes:[],_groupedData:{},_tree:[],_fetchV2URL:null,_expandSynthesisURL:null,_tenantId:null,init:function(){},_setTree:function(m){this._tree=m},_setNodes:function(m){this._nodes=m},cleanAll:function(){this._groupedData={};this._tree=[];this._nodes=[]},getPlatformServices:function(n){var m=this;return new f(function(p,o){if(null===m._fetchV2URL){a.getPlatformServices({onComplete:function(r){m.setOption("str_platformServices",r);for(var q=0;q<r.length;q++){if(n===r[q].platformId){m._fetchV2URL=r[q]["3DSpace"]+"/cvservlet/fetch/v2";m._tenantId=n;p(m._fetchV2URL)}}},onFailure:function(q){o(q)}})}else{p(m._fetchV2URL)}})},getPlatformUrlAccordingToTenant:function(q){var o;var p=q?q:this._tenantId;var n=this.getOption("str_platformServices");for(var m=0;m<n.length;m++){if(p===n[m].platformId){o=n[m]}}return o},getRESTHeaders:function(){var m={Accept:"application/json","Content-Type":"application/json","Accept-Language":l.getLanguage().toLowerCase()};return m},getPlatformId:function(){var m=null;m=this.getPlatformUrlAccordingToTenant().platformId;return m},fetch:function(s,n,u){this._setTree(u);this._setNodes(n);var p=this,t=this._buildArrayPid(),o=1000,q=t.length/o,r=Number.isInteger(q)?q:parseInt(q)+1,m=[];return new f(function(w,v){l.getPlatformServices(p._tenantId).then(function(){var x=[];for(var y=0;y<r;y++){var z=[];m.push(p._executeFetch(t,x,z,(y*o),o))}}).then(function(x){return f.all(m).then(function(y){var C=null;if(y.length){var B={results:[]};for(var A=0;A<y.length;A++){if(y[A].results){for(var z=0;z<y[A].results.length;z++){B.results.push((y[A].results)[z])}}}C=p._parse(B)}else{C=p._parse(y[0])}w(C)})})})},_buildArrayPid:function(){var m=this._nodes,p=m.length,o=[];for(var n=0;n<p;n++){o[n]=m[n]}return o},_parse:function(q){var u=q.results,v=this,x={},w=[],o=[],y={};for(var z=0;z<u.length;z++){var s=u[z].attributes,p=v._getIdPathsForID(s[0].value);for(var t=1;t<s.length;t++){if(s[t].format!=="internal"){if(!x[s[t].name]){x[s[t].name]={}}if(s[t].format==="attribute"){if(!y[s[t].name]){y[s[t].name]=true;o.push({sixw:s[t].name,type:s[t].type.toLowerCase()})}}if(s[t].type==="date"){s[t].value=s[t].value.split("-").join("/").substr(0,10)}if(!x[s[t].name][s[t].value]){x[s[t].name][s[t].value]={};x[s[t].name][s[t].value].format=s[t].format;x[s[t].name][s[t].value].type=s[t].type;x[s[t].name][s[t].value].dispValue=s[t].dispValue||s[t].value;x[s[t].name][s[t].value].value=s[t].value||s[t].dispValue}for(var r=0;r<p.length;r++){x[s[t].name][s[t].value][p[r].id]={pathID:p[r].id,path:p[r].path}}}}}for(var n in x){if(x.hasOwnProperty(n)){for(var m in x[n]){if(x[n].hasOwnProperty(m)){if(x[n][m].format==="ds6w_facet"){w.push({object:x[n][m].value,sixw:n,count:v._getObjectSize(x[n][m]),type:x[n][m].type,dispValue:x[n][m].dispValue,})}}}}}i.extend(v._groupedData,x,true);return{response:q,grouped:x,summary:w,suggested:o,unfilteredStructure:v._groupedData}},_getObjectSize:function(o){var n=0,m;for(m in o){if(o.hasOwnProperty(m)&&!i.is(o[m],"string")&&-1===m.lastIndexOf("dispValue")&&-1===m.lastIndexOf("value")){n++}}return n},findColoredPaths:function(p,n){var o={},q={};if(n.type==="date"){q=p[n.predicate];for(var m in q){if(q.hasOwnProperty(m)){if(m.indexOf(n.object)!==-1){i.merge(o,q[m])}}}}else{if(Array.isArray(n.object)){o=p[n.predicate][this._buildValueForHierarchicalTags(n.object)]}else{o=p[n.predicate][n.object]}}return o},_buildValueForHierarchicalTags:function(n){var p=false;var q=n[n.length-1];if(n.length>1&&(q.contains("/"))){p=true;var m;for(var o=0;o<n.length-2;o++){m=n[o].concat(","+n[o+1])}if(m){q=m+","+q}q=q.replace(/\//g,",")}if(p){return q}else{return n}},_getIdPathsForID:function(n){var m=this;return this._tree.filter(function(o){var p=o.path;return n===m._nodes[p[p.length-1]]})},convertFromIndexToPID:function(t,s){var o=[],r="";for(var q=0;q<s.length;q++){for(var p=0;p<s[q].length;p++){r+=t[s[q][p]];if(p<s[q].length-1){r+="-"}}var n=false;if(o.lastIndexOf(r)>-1){for(var m=o.length-1;m>=0;m--){if(o[m].lastIndexOf(r+"_")>-1){r+="_"+(parseInt(o[m].substring((o[m].lastIndexOf("_")+1)))+1);n=true;break}}if(false===n){r+="_1"}}o.push(r);r=""}return o},convertFromPIDToIndexAsync:function(u,t,s,r){var v=[],w=[],x=[];function m(A,y,p,o,q){q=q||window;o=o||100;var n=0;function z(){var B=o;while(B--&&n<A.length){y.call(q,A[n],n,A);++n}if(n<A.length){setTimeout(z,1)}else{p.call(s,v)}}z()}m(t,function(o){if(o.lastIndexOf("-")>-1){w=o.split("-");for(var n=0;n<w.length;n++){if(w[n].lastIndexOf("_")>-1){w[n]=w[n].substr(0,w[n].indexOf("_"))}x.push(u.indexOf(w[n]))}w=[]}else{x.push(u.indexOf(o))}v.push(x);x=[]},r,25,this)},convertFromPIDToIndex:function(s,m){var r=[],q=[],p=[];for(var o=0;o<m.length;o++){if(m[o].lastIndexOf("-")>-1){q=m[o].split("-");for(var n=0;n<q.length;n++){if(q[n].lastIndexOf("_")>-1){q[n]=q[n].substr(0,q[n].indexOf("_"))}p.push(s.indexOf(q[n]))}q=[]}else{p.push(s.indexOf(m[o]))}r.push(p);p=[]}return r},splitListOfPID:function(m){var o=[];if(m.lastIndexOf("-")>-1){o=m.split("-");for(var n=0;n<o.length;n++){if(o[n].lastIndexOf("_")>-1){o[n]=o[n].substr(0,o[n].indexOf("_"))}}}else{if(m.lastIndexOf("_")>-1){m=m.substr(0,m.indexOf("_"))}o.push(m)}return o},getLanguage:function(){if(typeof widget!=="undefined"){return widget.lang}return b.getCurrentLanguage()},getNlsInfosForFacets:function(v){var s=this;var x=UWA.clone(v);var p={};for(var q=0;q<x.length;q++){var m=x[q];if(m.sixw){var u=i.is(m.object,"array")&&(m.object.length);if(u){x[q].dispValue=m.object.join("/")}else{var n=m.sixw.split("/");var t=n.length-1;if(!p[n[t]]){p[n[t]]=[]}p[n[t]].push(m.object)}}else{if(m.format==="ds6w_facet"){var o=i.is(m.value,"array")&&(m.value.length&&i.is(m.value[0],"array"));if(o){x[q].dispValue=m.value[0].join("/")}else{var r=m.name.split("/");var w=r.length-1;if(!p[r[w]]){p[r[w]]=[]}p[r[w]].push(m.value)}}}}return new f(function(A,z){var y;if(1===l.DICTIONARY_ACCESS_LEVEL){y=k}else{y=e}y.getNlsOfPropertiesValues(JSON.stringify(p),{tenantId:l.getPlatformId(),lang:l.getLanguage(),onComplete:function(C){for(var H in C){if(C.hasOwnProperty(H)){var B=C[H];for(var F=0;F<x.length;F++){var E=x[F].sixw||x[F].name;var G=E.lastIndexOf("/");if(-1!==E.indexOf(H,G)){var D=x[F].object||x[F].value;x[F].dispValue=B[D]||D}}}}A(x)},onFailure:function(){console.log("NLS types ...... Retrieve the Nls predefined types failed !");x.forEach(function(B){B.dispValue=B.object});A(x)}})})},_executeFetch:function(n,m,q,r,p){var o=this;return new f(function(t,s){g.authenticatedRequest(o._fetchV2URL,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({label:"NGF_ExecuteFetch",physicalid:n,tenant:o._tenantId,with_synthesis_attribute:true,nresults:p||1000,start:r||0,select_file:m||[],local:l.getLanguage().toLowerCase(),select_predicate:q||[]}),onComplete:function(v){var w=[];for(var u=0;u<v.results.length;u++){w.push(l.getNlsInfosForFacets(v.results[u].attributes))}return f.all(w).then(function(z){var y=[];y.results=[];for(var A=0;A<z.length;A++){var x={};x.attributes=z[A];y.results.push(x)}t(y)})},onFailure:function(u){s(u)}})})},getInfosFromIds:function(n,m){var o=this;return new f(function(s,r){var p=[];var q=["ds6w:label"];o.getPredicatesInfosFromIds(n,q,m).then(function(u){var y=u.length;for(var x=0;x<y;x++){var A={};A.id=u[x].id;A.thumbnail=u[x].thumbnail;A.icon=u[x].icon;A.label="";var z=[];for(var v=0;v<q.length;v++){for(var t=0;t<u[x].predicates.length;t++){var w=u[x].predicates[t];if(w.name.endsWith(q[v])){z.push(w.value)}}}if(z.length){A.label=z.toString().split(",").join(" ")}p.push(A)}s(p)})})},getPredicatesInfosFromIds:function(q,o,p){var r=this;var t=0;var n=q.length;var m=[];var s=[];if(UWA.is(p,"boolean")&&p===true){m=["icon","thumbnail_2d"];s=["preview_url","type_icon_url"]}return new f(function(v,u){r.getPlatformServices(r._tenantId).then(function(){r._executeFetch(q,m,o,t,n).then(function(D){var I=s.concat(o);var B=I.length;var G=[];var J=(D.results)?D.results.length:0;for(var A=0;A<J;A++){var y=D.results[A].attributes;var H=y.length;var F={};var z=[];for(var x=0;x<H;x++){var C=y[x];if("resourceid"===C.name){F.id=C.value}else{if("preview_url"===C.name){F.thumbnail=C.value}else{if("type_icon_url"===C.name){F.icon=C.value}else{for(var w=0;w<B;w++){var E=C.name;if(C.name.endsWith(I[w])){z.push(C);break}}}}}}if(F.id){F.predicates=z;G.push(F)}}v(G)},function(w){console.log(w);u([])})})})}});return l});Number.isInteger=Number.isInteger||function(a){return typeof a==="number"&&isFinite(a)&&Math.floor(a)===a};define("DS/ENOFilterBIUX/NGFServices",["UWA/Core","UWA/Class","UWA/Date","UWA/Class/Options","UWA/Class/Promise","DS/WAFData/WAFData","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/ENOFilterBIUX/assets/nls/ENOFilterBIUX"],function(i,j,h,c,f,g,k,d,a,b){var e=j.singleton(c,{CVQUERY_VERSIONS:["420.6.1"],CVQUERY_TYPE:"CVQuery",APP_EXPANDMODE:"expand",getGetFiltersFromIdsUrl:function(l){if(!i.is(k.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return k.getPlatformUrlAccordingToTenant(l)["3DSpace"]+"/resources/FilterBIAPI/Filter/getFiltersFromIds"},getGetFilterFromIdUrl:function(l){if(!i.is(k.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return k.getPlatformUrlAccordingToTenant(l)["3DSpace"]+"/resources/FilterBIAPI/Filter/getFilterFromId"},getExpandSynthesisUrl:function(l){if(!i.is(k.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return k.getPlatformUrlAccordingToTenant(l)["3DSpace"]+"/cvservlet/multiexpand"},getRetrieveFiltersUrl:function(l){var m;if(i.is(k.getOption("str_platformServices"),"array")){m=k.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/FilterBIAPI/Filter/retrieveFilters"}return m},getCompletedQueriesFromFilterIds:function(l,n){var m={};if(!m.success){m.success=[]}if(!m.failure){m.failure=[]}e.getAllDataFromFilterIds(that._dropedFilterIds,n).then(function(q){if(q.success){for(var p=0;p<q.success.length;p++){m.success.push(e.upgradeAndCompleteQuery(JSON.parse(q.success[p].filterCVQuery)))}}if(q.failure){for(var o=0;o<q.failure.length;o++){m.failure.push(q.failure[o])}}})},getAllDataFromFilterIds:function(l,r){var n=this,m={},o={},q=[];l=UWA.is(l,"array")?l:[l];var p=new f(function(t,s){g.authenticatedRequest(n.getGetFiltersFromIdsUrl(r),{headers:k.getRESTHeaders(),method:"POST",data:JSON.stringify(l),type:"json",proxy:"passport",onComplete:function(w){m={};if(w.success){m.success=[];o.success=[];for(var v=0;v<w.success.length;v++){var x=Object.keys(w.success[v]);for(var u=0;u<x.length;u++){if(!m.success[x[u]]){m.success[x[u]]=[]}n._upgradeFilterSpecification(w.success[v][x[u]]);w.success[v][x[u]].filterPhysicalId=x[u];m.success[x[u]].push(w.success[v][x[u]]);q[u]=m.success[x[u]][u]}o.success.push(q[v])}}else{o.failure=w.failure}t(o)},onFailure:function(u){t(u)}})});return p},getFilterDataFromFilterId:function(l,p){var o=this,n={};l=UWA.is(l,"array")?l:[l];var m=new f(function(r,q){e.getAllDataFromFilterIds(l,p).then(function(s){if(s.success){r(s)}if(s.failure){o.manageNlsDroppedErrorMessages(s);r(s)}})});return m},getFilterDataFromFilterNames:function(o){var l=this,m={};o=UWA.is(o,"array")?o:[o];var n=new f(function(q,p){g.authenticatedRequest(l.getRetrieveFiltersUrl(),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify(o),type:"json",proxy:"passport",onComplete:function(r){if(r.success){m.success=[];r.success.forEach(function(s){l._upgradeFilterSpecification(s);m.success.push(s)});q(m)}},onFailure:function(r){l.manageNlsDroppedErrorMessages(r);q(r)}})});return n},manageNlsDroppedErrorMessages:function(l){if(l.failure){for(var m=0;m<l.failure.length;m++){if(l.failure[m].filterName){l.failure[m].msg=l.failure[m].filterName+" : "+b.get(l.failure[m].msg)}else{l.failure[m].msg=b.get(l.failure[m].msg)}}}return l},expandWithSynthesis:function(o,n,l){var m=this;l=(l===undefined)?{"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"'}:l;return new f(function(v,u){var s={};s.union={};s.union.expand=[];for(var t=0;t<n.length;t++){s.union.expand[t]={root_physicalid:n[t],expand_iter:"-1",};var p=UWA.merge(s.union.expand[t],l);s.union.expand[t]=p}s.synthesis_mode=d.getOption("synthesis_mode");s.max_count_path="1";var r=new h();var q=i.Date.strftime(r,"%Y-%m-%dT%H:%M:%S%z");s.label="FilterBI_ExpandSynthesis_"+q;g.authenticatedRequest(e.getExpandSynthesisUrl(o),{headers:k.getRESTHeaders(),method:"POST",data:JSON.stringify(s),type:"json",proxy:"passport",timeout:d.getOption("timeoutExpandSynthesis"),onComplete:function(x){var w=x.facets||[];k.getNlsInfosForFacets(w).then(function(y){v(y)})},onFailure:function(w){u(w)}})})},filteredExpandWithSynthesis:function(o,l,m){var n=this;if(!m){m="expand"}return new f(function(x,y){var v={};if(!l||0===l.filteredRoots.length){x([])}else{if(1===l.filteredRoots.length){if("expand3d"===m){v=l.filteredRoots[0].objQuery.CVQuery3D?l.filteredRoots[0].objQuery.CVQuery3D:l.filteredRoots[0].objQuery.CVQuery}else{v=l.filteredRoots[0].objQuery.CVQuery?l.filteredRoots[0].objQuery.CVQuery:l.filteredRoots[0].objQuery.CVQuery3D}}else{var q,p;for(var u=0;u<l.filteredRoots.length;u++){var s="CVQuery";if("expand3d"===m){s="CVQuery3D"}q=e.getCombinationType(l.filteredRoots[u].objQuery[s]);if("union"===q){p=e.getQueryExpandType(l.filteredRoots[u].objQuery[s][q]);if(!v[q]){v[q]={}}if(!v[q][p]){v[q][p]=[]}for(var t=0;t<l.filteredRoots[u].objQuery[s][q][p].length;t++){v[q][p].push(l.filteredRoots[u].objQuery[s][q][p][t])}}else{console.log("NGFServices.filteredExpandWithSynthesis : not union case of filtered root : "+q)}}}}if(undefined===v){console.log("NGFServices.filteredExpandWithSynthesis KO : queryForExpandSynthesis undefined");x([])}v.max_count_path="1";v.synthesis_mode=d.getOption("synthesis_mode");var r=new h();var w=i.Date.strftime(r,"%Y-%m-%dT%H:%M:%S%z");v.label="FilterBI_FilteredExpandWithSynthesis_"+w;g.authenticatedRequest(e.getExpandSynthesisUrl(o),{headers:k.getRESTHeaders(),method:"POST",data:JSON.stringify(v),type:"json",proxy:"passport",timeout:d.getOption("timeoutExpandSynthesis"),onComplete:function(A){var z=A.facets||[];k.getNlsInfosForFacets(z).then(function(B){x(B)})},onFailure:function(z){y(z)}})})},upgradeAndCompleteQuery:function(t){var w={};var v=(t.CVQuery)?t.CVQuery:t;v=UWA.is(v,"string")?JSON.parse(v):v;var A=v.specVersion||undefined;if(e.isLastSpecificationVersion(A)){w.CVQuery=v;w.CVQuery.specVersion=A}else{var x=v;var o=e.CVQUERY_VERSIONS;var l=o.length;var r=o.indexOf(A);for(var s=r+1;s<l;s++){x=this._migrateCVQuery(x,o[s])}w.CVQuery=x;w.CVQuery.specVersion=e.getCurrentSpecificationVersion()}var n=e.getCombinationQuery(w.CVQuery);if(w.CVQuery&&n){w.CVQuery3D=UWA.clone(w.CVQuery);if(!n.expand3d){var p=e.getCombinationQuery(w.CVQuery3D);var y=e.getQueryExpand(p);p.expand3d=y;delete p.expand}}var m=e.getCombinationQuery(w.CVQuery3D);var z=e.getQueryExpand(m);for(var q=0;q<z.length;q++){if(z[q].sequence_filter){if("seq_cut"===z[q].sequence_filter[0].option[0]){z[q].sequence_filter[0].option=["seq_keep"]}}}var u=e.getCombinationType(w.CVQuery3D);w.CVQuery3D[u].expand3d=z;return w},_migrateCVQuery:function(l,n){var m={};switch(n){case e.CVQUERY_VERSIONS[0]:if(l.union){m=l}else{m=e.buildGlobalUnionCVQuery(l)}break;default:}return m},buildGlobalUnionCVQuery:function(m){var l={};l.union={};l.union.expand=[];l.union.expand[0]=m;if(m.root_physicalid){l.union.expand[0].root_path_physicalid=[[m.root_physicalid]];delete m.root_physicalid}return l},getCurrentSpecificationVersion:function(){var l=e.CVQUERY_VERSIONS.length-1;return e.CVQUERY_VERSIONS[l]},isLastSpecificationVersion:function(l){return(this.getCurrentSpecificationVersion()===l)?true:false},getCombinationQuery:function(l){return l.union||l.intersection||l.minus},getCVQueryType:function(m){var l;if(m.CVQuery){l="CVQuery"}else{if(m.CVQuery3D){l="CVQuery3D"}}return l},getCombinationType:function(m){var l;if(m.union){l="union"}else{if(m.intersection){l="intersection"}else{if(m.minus){l="minus"}}}return l},getQueryExpand:function(l){return l.expand||l.expand3d},getQueryExpandType:function(m){var l;if(m.expand){l="expand"}else{if(m.expand3d){l="expand3d"}}return l},setAppQueryParam:function(l){this._appQueryParam=l},getAppQueryParam:function(){return this._appQueryParam},setAppExpandMode:function(l){e.APP_EXPANDMODE=l;if("expand"===e.APP_EXPANDMODE){this.setQueryType("CVQuery")}else{if("expand3d"===e.APP_EXPANDMODE){this.setQueryType("CVQuery3D")}}},getAppExpandMode:function(){return e.APP_EXPANDMODE},setQueryType:function(l){e.CVQUERY_TYPE=l},getQueryType:function(){return e.CVQUERY_TYPE},isConfigAvailable:function(){var l;return new f(function(n,m){a.getPlatformServices({onComplete:function(o){l=1;n(l)},onFailure:function(o){m(o)}})})},buildEmptyQueryForRoot:function(l,p,n){var o={};o[p]={};o[p][n]=[];var m={};m.root_physicalid=l;o[p][n].push(m);return o},_upgradeFilterSpecification:function(o){var n={toFeedUI:{combinationOfSpecification:"union",keepChildren:true}};var q=o.filterUIComponents[0];if(i.is(q,"object")){var m=q.toFeedUI;if(m){if(!m.combinationOfSpecification){o.filterUIComponents.unshift(n)}}else{o.filterUIComponents=[n,{isActivated:"1",filterSpecificationName:b.get("defaultGroupName"),toFeedUI:o.filterUIComponents}]}}else{var l=b.get("defaultGroupName");var r=[n];for(var p=0;p<o.filterUIComponents.length;p++){r.push({isActivated:"1",filterSpecificationName:l,toFeedUI:o.filterUIComponents[p]})}o.filterUIComponents=r}if(undefined===o.filterCVQuery){o.filterCVQuery=o.filterDescription;o.filterDescription=q.filterDescription||"";o.filterDescription=("null"===o.filterDescription)?"":o.filterDescription;delete o.filterUIComponents[0].filterDescription}},getFilterSpecifications:function(l){return l.filterUIComponents}});return e});define("DS/ENOFilterBIUX/BIEngine",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/WAFData/WAFData","UWA/Class/Debug","WebappsUtils/WebappsUtils","DS/ENOFilterBIUX/FBIServices","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices",],function(g,h,e,f,d,b,i,a){var c=h.extend(d,{init:function(){this._biPredCriteriaMatchingBIPredLabel={};this._BISummary=[];this._colorMap={};this._BIColoredSubject=[];this._rulesData=[];this._BIMatchingSubjects={};this._intervals=[];this._BICusto=[];this._BICustoLabelColor=[];this._BICustoMatchingSubjects={};this._biCustoRulesURL=null;this._BICustoComputedSubjects={};return this},cleanAll:function(){this._BIMatchingSubjects={};this._fromBIPredLabelToAttribute={}},_getBIPredLabelToDisplay:function(k){var j=k;if(j.indexOf("/")>=0){j=j.slice(j.indexOf("/")+1,j.length)}return j},getBIRules:function(){var k=this;if(!sessionStorage.getItem("FBI_getBIRules")){new e(function(m,l){a.getPlatformServices({onComplete:function(n){k._biRulesURL=i.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/SNAPI/birule_services/birules";f.authenticatedRequest(k._biRulesURL,{headers:{Accept:"application/json"},method:"GET",type:"json",proxy:"passport",onComplete:function(o){k._parseBIRules(o);sessionStorage.setItem("FBI_getBIRules",JSON.stringify(o));m(o)},onFailure:function(o){console.log(o);l(o)}})},onFailure:function(n){l(n)}})})}else{var j=JSON.parse(sessionStorage.getItem("FBI_getBIRules"));return this._parseBIRules(j)}},parseCustoBIRule:function(o,m,l,p){var n=this;var j=[];m.forEach(function(q){n._BISummary.push({object:q.BILabel,sixw:o,dispValue:"",count:-1,type:"string"});if(!n._colorMap[o]){n._colorMap[o]=[]}n._colorMap[o].push({color:q.BIColor,object:q.BILabel,type:"string"});j.push({color:q.BIColor,label:q.BILabel,type:q.BIType});if(!n._BICustoLabelColor[q.BILabel]){n._BICustoLabelColor[q.BILabel]=[]}n._BICustoLabelColor[q.BILabel].color=q.BIColor});var k=n._getBIPredLabelToDisplay(o);if(!n._BICusto[k]){n._BICusto[k]=[]}n._BICusto[k]={label:k,biProgram:l,biFunction:p,info:j}},_parseBIRules:function(l){var k=l.birules;var j=this;if(null===k||undefined===k){return}k.forEach(function(m){var q=m.name;var s=[];var o=j._getBIPredLabelToDisplay(q);if(!j._biPredCriteriaMatchingBIPredLabel[o]){j._biPredCriteriaMatchingBIPredLabel[o]=[];j._biPredCriteriaMatchingBIPredLabel[o].push(m.bipredicates[0])}var p=JSON.parse(m.biexpression);if(p){for(var r in p){if(p.hasOwnProperty(r)){if("BITags"===r){j.parseCustoBIRule(q,p[r],p.biProgram,p.biFunction)}}}for(var n=0;n<p.length;n++){if(!p.BITags){j._BISummary.push({object:p[n].BILabel,sixw:q,dispValue:"",count:-1,type:"string"});if(!j._colorMap[q]){j._colorMap[q]=[]}j._colorMap[q].push({color:p[n].BIColor,object:p[n].BILabel,type:"string"});s.push({color:p[n].BIColor,label:p[n].BILabel,type:p[n].BIType,Cond:p[n].Cond})}}if(!j._rulesData[o]){j._rulesData[o]=[]}j._rulesData[o]={biPredCriteria:m.bipredicates[0],info:s}}})},_computeFilterfromWS:function(k,j){if(this._BICustoComputedSubjects){this._BICustoMatchingSubjects={};for(var m in j){if(j.hasOwnProperty(m)){var l=this._getBIPredLabelToDisplay(j[m].object);var n=this._biPredCriteriaMatchingBIPredLabel[k];if(this._BICustoComputedSubjects[n]){if(this._BICustoComputedSubjects[n][l]){if(!this._BICustoMatchingSubjects[n]){this._BICustoMatchingSubjects[n]={}}if(!this._BICustoMatchingSubjects[n][l]){this._BICustoMatchingSubjects[n][l]={}}this._BICustoMatchingSubjects[n][l]=this._BICustoComputedSubjects[n][l]}}}}}return this._BICustoMatchingSubjects},computeBIRule:function(n,m,j,l){var k=this._getBIPredLabelToDisplay(m);var o=this._biPredCriteriaMatchingBIPredLabel[k][0];this._BIColoredSubject=[];this._computeIntervals(k,l);this._getMatchingSubjects(o,n[o],this._intervals[k],j)},_getMatchingSubjects:function(t,q,s,j){this._BIMatchingSubjects={};for(var n in q){if(q.hasOwnProperty(n)){for(var p=0;p<s.length;p++){if(s[p].interval.match(n)){var u=Object.keys(q[n]);for(var o=0;o<u.length;o++){if(u[o]!=="format"&&u[o]!=="type"&&u[o]!=="dispValue"&&u[o]!=="value"){var v=[];var k=u[o];v.push(k);var r=i.convertFromPIDToIndex(j,v);this._BIColoredSubject.push({path:r[0],color:s[p].color});if(!this._BIMatchingSubjects[t]){this._BIMatchingSubjects[t]={}}if(!this._BIMatchingSubjects[t][n]){this._BIMatchingSubjects[t][n]={}}this._BIMatchingSubjects[t][n][k]=({pathID:k,interval:s[p],label:s[p].label})}}}}}}},_computeNumericIntervals:function(q,m,l,r,t){var v=function(){this.lowerBound=null;this.upperBound=null;this.lowerBoundInclusive=false;this.upperBoundInclusive=false};v.prototype.match=function(w){return(this.lowerBoundInclusive?w>=this.lowerBound:w>this.lowerBound)&&(this.upperBoundInclusive?w<=this.upperBound:w<this.upperBound)};var n=q.split(":");for(var u=0;u<n.length;u++){var k=new v();var s=n[u].trim();if(s.indexOf(",")>=0){var j=s.split(",");var p=j[0].trim();var o=j[1].trim();if(p.length>0){if(p.indexOf("[")===0){k.lowerBoundInclusive=true;p=p.substr(1)}else{if(p.indexOf("(")===0){p=p.substr(1)}}if(p.length>0){k.lowerBound=parseFloat(p)}else{k.lowerBound=Number.NEGATIVE_INFINITY}}if(o.indexOf("]")>=0){k.upperBoundInclusive=true;o=o.slice(0,-1)}else{if(o.indexOf(")")>=0){o=o.slice(0,-1)}}if(o.length>0){k.upperBound=parseFloat(o)}else{k.upperBound=Number.POSITIVE_INFINITY}}m.push({interval:k,cond:s,color:l,type:r,label:t})}},_computeRegexIntervals:function(q,o,l,p,n){var m=function(){this.regex=null};m.prototype.match=function(r){return this.regex.test(r)};var j=q;var k=new m();if(q.trim()){q=q.trim().split("@");k.regex=new RegExp(q[0],q[1])}o.push({interval:k,cond:j,color:l,type:p,label:n})},_computeDateIntervals:function(r,n,l,s,u){var x=function(){this.lowerBound=null;this.upperBound=null;this.lowerBoundInclusive=false;this.upperBoundInclusive=false};x.prototype.matchNumInterval=function(v,y){return(v.lowerBoundInclusive?y>=v.lowerBound:y>v.lowerBound)&&(v.upperBoundInclusive?y<=v.upperBound:y<v.upperBound)};x.prototype.match=function(z){var y=false;if(z.length>0){z=new Date(Date.parse(z));for(var v=0;v<n.length;v++){if(this.matchNumInterval(n[v].interval,z)){y=true;break}}}return y};var o=r.split(":");for(var m=0;m<o.length;m++){var k=new x();var t=o[m].trim();if(t.indexOf(",")>=0){var j=t.split(",");var q=j[0].trim();var p=j[1].trim();if(q.length>0){if(q.indexOf("[")===0){k.lowerBoundInclusive=true}if(q.indexOf("[")===0||q.indexOf("(")===0){q=q.substr(1)}if(q.length>0){k.lowerBound=new Date(Date.parse(q))}else{k.lowerBound=new Date(Date.UTC(0,0,0))}if(!k.lowerBoundInclusive){k.lowerBound.setDate(k.lowerBound.getDate()+1);k.lowerBoundInclusive=true}}if(p.indexOf("]")>=0){k.upperBoundInclusive=true}if(p.indexOf("]")>=0||p.indexOf(")")>=0){p=p.slice(0,-1)}if(p.length>0){k.upperBound=new Date(Date.parse(p))}else{k.upperBound=new Date(Date.UTC(10000,0,0))}if(k.upperBoundInclusive){k.upperBound.setDate(k.upperBound.getDate()+1);k.upperBoundInclusive=false}}else{if(t.indexOf("!")>=0){var w=new Date(Date.parse(t.substr(1)));k.lowerBound=new Date(Date.UTC(0,0,0));k.upperBound=w;k=new x();k.lowerBound=new Date(w);k.lowerBound.setDate(k.lowerBound.getDate()+1);k.lowerBoundInclusive=true;k.upperBound=new Date(Date.UTC(10000,0,0))}else{k.lowerBoundInclusive=true;k.lowerBound=new Date(Date.parse(t));k.upperBoundInclusive=false;k.upperBound=new Date(Date.parse(t));k.upperBound.setDate(k.lowerBound.getDate()+1)}}n.push({interval:k,cond:t,color:l,type:s,label:u})}},_computeStringIntervals:function(o,m,k,p,r){var s=function(){this.stringValue=null};s.prototype.match=function(t){return this.stringValue===t};var n=o.split(",");for(var l=0;l<n.length;l++){var j=new s();var q=n[l].trim();j.stringValue=q;m.push({interval:j,cond:q,color:k,type:p,label:r})}},_computeIntervals:function(n,m){if(this._rulesData[n]){this._intervals[n]=[];for(var l=0;l<m.length;l++){var p=m[l];for(var k=0;k<this._rulesData[n].info.length;k++){if(m==="all"||this._rulesData[n].info[k].label===p.object){var o=this._rulesData[n].info[k].type;switch(o.toLowerCase()){case"numeric":this._computeNumericIntervals(this._rulesData[n].info[k].Cond,this._intervals[n],this._rulesData[n].info[k].color,o,this._rulesData[n].info[k].label);break;case"regex":this._computeRegexIntervals(this._rulesData[n].info[k].Cond,this._intervals[n],this._rulesData[n].info[k].color,o,this._rulesData[n].info[k].label);break;case"date":this._computeDateIntervals(this._rulesData[n].info[k].Cond,this._intervals[n],this._rulesData[n].info[k].color,o,this._rulesData[n].info[k].label);break;case"string":this._computeStringIntervals(this._rulesData[n].info[k].Cond,this._intervals[n],this._rulesData[n].info[k].color,o,this._rulesData[n].info[k].label);break;default:console.log("BIEngine.computeBIRule - NON SUPPORTED TYPE");console.log(o);break}}}if(m==="all"){break}}}},});return c});Number.isInteger=Number.isInteger||function(a){return typeof a==="number"&&isFinite(a)&&Math.floor(a)===a};define("DS/ENOFilterBIUX/FBIProxyServices",["UWA/Core","UWA/Class","UWA/Class/Options","DS/ENOFilterBIUX/NGFServices","DS/ENOFilterBIUX/FBISettings"],function(c,e,d,f,b){var a=e.singleton(d,{completeCVQueryWithAppSpecs:function(g,u,t){var s=UWA.clone(g);var h=f.getCombinationQuery(s);if(u.volume_filter&&Object.keys(u.volume_filter).length){if(h&&h.expand3d){for(var r=0;r<h.expand3d.length;r++){if(h.expand3d[r].volume_filter){h.expand3d[r].volume_filter.and=UWA.extend(u.volume_filter,h.expand3d[r].volume_filter)}else{h.expand3d[r].volume_filter=UWA.clone(u.volume_filter)}if(t&&(u.volume_filter&&u.volume_filter.assemblyshape&&h.expand3d[r].config_filter)){h.expand3d[r].volume_filter.assemblyshape.config_filter=h.expand3d[r].config_filter}}}else{s.volume_filter=UWA.clone(u.volume_filter);if(t&&(s.config_filter&&s.volume_filter&&s.volume_filter.assemblyshape)){s.volume_filter.assemblyshape.config_filter=s.config_filter}}}if(u.find_in_context&&Object.keys(u.find_in_context).length){if(h&&h.expand){for(var q=0;q<h.expand.length;q++){h.expand[q].find_in_context=UWA.clone(u.find_in_context)}}else{if(h&&h.expand3d){for(var p=0;p<h.expand3d.length;p++){h.expand3d[p].find_in_context=UWA.clone(u.find_in_context)}}else{s.find_in_context=UWA.clone(u.find_in_context)}}}if(u.root_path_physicalid&&Object.keys(u.root_path_physicalid).length){if(h&&h.expand){for(var o=0;o<h.expand.length;o++){h.expand[o].root_path_physicalid=UWA.clone(u.root_path_physicalid)}}else{if(h&&h.expand3d){for(var n=0;n<h.expand3d.length;n++){h.expand3d[n].root_path_physicalid=UWA.clone(u.root_path_physicalid)}}else{s.root_path_physicalid=UWA.clone(u.root_path_physicalid)}}}return s},getCompletedQueriesFromFilterIds:function(g,h){return f.getCompletedQueriesFromFilterIds(g,h)},completeCVQueryWithAppParams:function(o,r,p){o.CVQuery=c.is(o.CVQuery,"string")?JSON.parse(o.CVQuery):o.CVQuery;o.CVQuery3D=c.is(o.CVQuery3D,"string")?JSON.parse(o.CVQuery3D):o.CVQuery3D;var g=f.getCombinationQuery(o.CVQuery);var i=f.getCombinationQuery(o.CVQuery3D);var s=f.getAppQueryParam();var t=(r===undefined)?{expand_iter:"-1"}:r;if(g){var q=f.getQueryExpand(g);var m=f.getQueryExpand(i);for(var n=0;n<q.length;n++){var u=c.merge(q[n],t);u=c.merge(q[n],s);q[n]=u}for(var l=0;l<q.length;l++){var h=c.merge(m[l],t);h=c.merge(m[l],s);m[l]=h}}else{o.CVQuery=c.merge(o.CVQuery,t);o.CVQuery=c.merge(o.CVQuery,s);o.CVQuery3D=c.merge(o.CVQuery3D,t);o.CVQuery3D=c.merge(o.CVQuery3D,s)}if(p){o.CVQuery.synthesis_mode=b.getOption("synthesis_mode");o.CVQuery3D.synthesis_mode=b.getOption("synthesis_mode")}return o},});return a});define("DS/ENOFilterBIUX/Abstract_FBIComponentProxy",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Controls/Toggle","DS/TagNavigatorProxy/TagNavigatorProxy","DS/ENOFilterBIUX/BIEngine","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/ENOFilterBIUX/FBIProxyServices","DS/ENOFilterBIUX/NGFServices","UWA/Promise","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOFilterBIUX/assets/nls/ENOFilterBIUX"],function(l,e,p,q,c,m,g,n,i,o,d,h,f,j,k,b){var a=e.extend(p,{init:function(r){var s=this;this.optionsToKeep=r;this._predicates=[];this._nodes=[];this._paths=[];this._tree=[];this._unFilteredPathIDs=[];this._unfilteredTree=[];this._filteredData={};this._colorizedData={};this._nodesIN=[];this._odtSummary=[];this._filterBIToKeep={};this._isFetchCustoDone=false;this._keepVolatileTags=[];this.volatileTags={};this._tenantId=this.optionsToKeep.tenant;o.getPlatformServices(this._tenantId);f.isConfigAvailable().then(function(t){s._configUsed=t});if(r.volumeFilterAvailable){sessionStorage.setItem("NGFilter_Volume_"+this.optionsToKeep.appId+"-"+this.optionsToKeep.widgetId,true)}this._expandIterParam=r.expandIterParam?r.expandIterParam:"-1";if(r.volumeFilterAvailable&&r.volumeAsMaster){f.setAppQueryParam(r.appQueryParam)}else{f.setAppQueryParam(r.appQueryParam)}k.subscribe("NGFilter.toggleProxyFocus",this._onToggleProxyFocus.bind(this));k.subscribe("NGFilter.updateTags",this._onUpdateTags.bind(this));k.subscribe("NGFilter_Volume",this._onFilterVolume.bind(this));k.subscribe("Frame3DXInfra.onPanelClose",this._onCloseFilterPanel.bind(this));k.subscribe("Frame3DXInfra.onPanelOpen",this._onOpenFilterPanel.bind(this));k.subscribe("Frame3DXInfra.ViewChange",this.viewChange.bind(this));this._expandSynthesisON=r.ExpandSynthesisON?true:false;this._arrayRootsInSession=[];this._nbRootsWithTags=0;this._applyNGFilterCount=0;this._currentTags={};this._appliedTags={};this._synthesis_priority=this.optionsToKeep.synthesis_priority;this._objFilteredRootsInSession={};this._objFilteredRootsInSession.filteredRoots=[]},destroy:function(){sessionStorage.removeItem("NGFilter_Volume_"+this.optionsToKeep.appId+"-"+this.optionsToKeep.widgetId);if(sessionStorage.getItem("FBI_droppedFilters")){sessionStorage.removeItem("FBI_droppedFilters")}this._cleanNGFSessionItems();this._parent()},_cleanNGFSessionItems:function(){for(var s=0;s<this._arrayRootsInSession.length;s++){var t="NGF_isUXBuilt_"+this._arrayRootsInSession[s];var r="NGF_tagMgtRunning_"+this._arrayRootsInSession[s];if(sessionStorage.getItem(t)){sessionStorage.removeItem(t)}if(sessionStorage.getItem(r)){sessionStorage.removeItem(r)}}},_onToggleProxyFocus:function(r){if(r&&this.myTagProxy&&this.optionsToKeep){var s=r.widgetId;if(this.optionsToKeep.widgetId===s){var t=r.focus||true;this.myTagProxy.toggleProxyFocus(t)}}},_onUpdateTags:function(r){if(r&&this.myTagProxy&&this.optionsToKeep){var s=r.widgetId;if(this.optionsToKeep.widgetId===s){var t=r.tags;if(t){this._taggerUpdatedFromFilter=true;this.myTagProxy.clearLocalFilter();this.myTagProxy.setLocalFilter(t)}else{this.unsetTags()}}}},updateTenant:function(r){this._tenantId=r;o.getPlatformServices(this._tenantId)},odtSetFilters:function(r){if(this.myTagProxy){this.myTagProxy.filters=r}},odtKeepActiveFilters:function(r){if(r){this._filterBIToKeep=r}},setTags:function(t,s,w){var v=this;var x="FilteringOnServer";if(null!==s&&undefined!==s){x="FilteringOnServer"}else{if(null!==t&&undefined!==t){x="WithFilteringServices"}}var u=v.optionsToKeep;var r={widgetId:u.widgetId,tenant:u.tenant,filteringMode:x,colorize:u.colorize,events:u.events,};if(!this.myTagProxy){this.myTagProxy=n.createProxy(r);if(this._setVolatilesSummariesAfterProxyCreation){this.setVolatileTags(this._setVolatilesSummariesAfterProxyCreation)}this.myTagProxy.addEvent("colorize",this.filterBIColorize.bind(this));this.myTagProxy.addEvent("unColorize",this.filterBIUnColorize.bind(this));this.myTagProxy.addEvent("onFilterChange",this.filterBIFilter.bind(this))}if(!this._expandSynthesisON){if(this.myTagProxy){this.myTagProxy.filters=this.myTagProxy.getCurrentFilter()}if(Object.keys(this.myTagProxy.filters).length){if(Object.keys(this.myTagProxy.filters.allfilters).length&&(0===o._getObjectSize(this._filterBIToKeep)||(this._filterBIToKeep&&this._filterBIToKeep.allfilters&&(Object.keys(this.myTagProxy.filters.allfilters).length>=Object.keys(this._filterBIToKeep.allfilters).length)))){if(this._currentlyDispatchingAVolatileFilterEvent===true){this._currentlyDispatchingAVolatileFilterEvent=false}else{this.filterBIFilter(this.myTagProxy.filters)}}}}if(x==="FilteringOnServer"){if(this.myTagProxy.filters){this._filterBIToKeep=this.myTagProxy.filters}if(l.is(s,"array")&&s.length){if(this._expandSynthesisON&&!s[0].dispValue){o.getNlsInfosForFacets(s).then(function(y){v.myTagProxy.setTags(t,y,w)})}else{this.myTagProxy.setTags(t,s,w)}}else{this.myTagProxy.setTags(null,[])}}else{console.log("FilterBIComponentProxy.setTags , non supported case")}},unsetTags:function(){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.unsetTags()}},filterBIColorize:function(r){},filterBIUnColorize:function(r){this.dispatchEvent("FilterBIUnColorizeEvent",r)},_cleanUnFilteredTree:function(r,t,s){if(s){if(r===t){return true}else{return false}}else{if(r.includes(t)){return true}else{return false}}},_cleanTree:function(r,t,s){if(s){if(r===t){return true}else{return false}}else{if(r.includes(t)){return true}else{return false}}},cleanProxy:function(){this._unfilteredTree=[];this._allNodes=[];this._unFilteredPathIDs=[];o.cleanAll();if(this._biEngine){this._biEngine.cleanAll()}this._currentNGFilter=""},filterBIFilter:function(s,r){},addSubjects:function(r){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.addSubjects(r)}},focusOnSubjects:function(r,s){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.focusOnSubjects(r,s)}},unfocus:function(){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.unfocus()}},toggleProxyFocus:function(r){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.toggleProxyFocus(r)}},getCurrentFilter:function(){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){return this.myTagProxy.getCurrentFilter()}},die:function(){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.die()}},activate:function(){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){return this.myTagProxy.activate()}},deactivate:function(){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){return this.myTagProxy.deactivate()}},setPredicates:function(r){this._predicates=r},setPathTags:function(r,s){},removeRoot:function(r){this._unFilteredPathIDs=this._unFilteredPathIDs.filter(function(t){if(t===r){return false}else{return true}});for(var s in this._unfilteredTree){if(this._unfilteredTree.hasOwnProperty(s)){if(this._unfilteredTree[s].id===r){delete this._unfilteredTree[s]}}}},emptyFilter:function(r){this._currentNGFilter=r;r.rootIds=this._arrayRootsInSession;this.dispatchEvent("ApplyNGFilter",r);this._cleanNGFSessionItems()},_keepRootsInSession:function(r){for(var s=0;s<r.length;s++){if(this._arrayRootsInSession.indexOf(r[s])<0){this._arrayRootsInSession.push(r[s])}}if(this._nbRootsWithTags){this._nbRootsWithTags=this._arrayRootsInSession.length}},_cleanRootsInSession:function(s){s=UWA.is(s,"array")?s:[s];this._cleanNGFSessionItems();for(var t=0;t<s.length;t++){var r=this._arrayRootsInSession.indexOf(s[t]);if(-1!==r){this._arrayRootsInSession.splice(r,1)}}if(this._nbRootsWithTags){this._nbRootsWithTags=this._arrayRootsInSession.length}},_cleanFilteredStructure:function(s){this._cleanNGFSessionItems();for(var r=0;r<this._objFilteredRootsInSession.filteredRoots.length;r++){if(this._objFilteredRootsInSession.filteredRoots[r].filterRootId===s){this._objFilteredRootsInSession.filteredRoots.splice(r,1);break}}},isRootFiltered:function(s){if(this._objFilteredRootsInSession.length){for(var r=0;r<this._objFilteredRootsInSession.length;r++){if(this._objFilteredRootsInSession[r].filterRootId===s){return true}}}return false},getCVQueryOfRootFiltered:function(s){if(this._objFilteredRootsInSession.length){for(var r=0;r<this._objFilteredRootsInSession.length;r++){if(this._objFilteredRootsInSession[r].filterRootId===s){return this._objFilteredRootsInSession[r].objQuery}}}return},_updateFilteredStructure:function(v,u){var r={};var t=0;if(!u){r.CVQuery={};r.CVQuery.union={};r.CVQuery.union.expand=[];r.CVQuery.union.expand[0]={};r.CVQuery.union.expand[0].root_path_physicalid=[[v]]}else{r=u}r=f.upgradeAndCompleteQuery(r);r=this.completeCVQueryWithAppParams(r,this.optionsToKeep.expandIterParam,this._expandSynthesisON);if(this._objFilteredRootsInSession.filteredRoots.length){for(var s=0;s<this._objFilteredRootsInSession.filteredRoots.length;s++){if(this._objFilteredRootsInSession.filteredRoots[s].filterRootId===v){t=1;this._objFilteredRootsInSession.filteredRoots[s].objQuery=r;break}}if(!t){this._objFilteredRootsInSession.filteredRoots.push({filterRootId:v,objQuery:r})}}else{this._objFilteredRootsInSession.filteredRoots.push({filterRootId:v,objQuery:r})}},onApplyNGFilter:function(r){},setNGFilterOptions:function(r){this._ngExpand=r.expandServices;this._ngAppId=r.appID;f.setAppExpandMode(this._ngExpand);k.subscribe("onApplyNGFilter",this.onApplyNGFilter.bind(this));if(sessionStorage.getItem("FBI_droppedFilters")){sessionStorage.removeItem("FBI_droppedFilters")}},resetNGFilterUI:function(s){var r=s.widgetId||"?";if(r===this.optionsToKeep.widgetId){s.appId=this.optionsToKeep.appId;s.rootIds=s.rootIds?s.rootIds:this._arrayRootsInSession;sessionStorage.removeItem("FBI_droppedFilters");this._cleanNGFSessionItems();k.publish("NGFilter.RemoveFilter",s)}else{console.log(" Invalid data for reset filter ( widgetId  = "+r+")")}},retrieveFiltersFromIds:function(v){var u=this;if(this._tenantId!==v.droppedEnvId){console.log("ERROR FilterBIComponentProxy : tenant has to be updated : newTenant = "+v.droppedEnvId+", previous tenant ="+this._tenantId);return}v.filtersIds=v.objectId?v.objectId:v.filterIds;v.filtersIds=UWA.is(v.filtersIds,"array")?v.filtersIds:[v.filtersIds];if(v.filtersIds.length>1){var t={success:[],failure:[{msg:b.get("multiFiltersDrop"),eventID:"warning"}]};this._callbackOnDrop=v.callback;this._applyFilterOnDrop(t)}else{for(var s=0;s<v.filterObjects.length;s++){var r=v.filterObjects[s];var w=r.objectId?r.objectId:v.filtersIds;o.getPlatformServices(this._tenantId).then(function(){f.getFilterDataFromFilterId(w,u._tenantId).then(function(x){if(x.success){u._fromBIFilterToNGFUX({rootID:x.success[0].rootPhysicalId,filterIds:w,filterNames:r.filterNames,NGFState:v.fromDropOnFilter?"dropOnFilter":"drop",})}else{if(!x.success){x.success=[]}u._callbackOnDrop=v.callback;u._applyFilterOnDrop(x)}})})}if(u._subscribe0){u._subscribe0.unsubscribe("NGFilter.ApplyDroppedFilters");u._subscribe0=undefined}u._callbackOnDrop=v.callback;u._subscribe0=k.subscribe("NGFilter.ApplyDroppedFilters",u._applyFilterOnDrop.bind(this))}},_fromBIFilterToNGFUX:function(s){var r=this;var t=s.rootID;o.getInfosFromIds([t],false).then(function(z){var w;for(var v=0;v<z.length;v++){if(t===z[v].id){w=z[v].label}}r._fromDropOnFilter=s.fromDropOnFilter;var u=r._computeFilterId(t);var x={appId:r.optionsToKeep.appId,widgetId:r.optionsToKeep.widgetId,widgetTenant:r._tenantId,rootAlias:w,appQueryParam:f.getAppQueryParam(),filterId:u,configUsed:r._configUsed,};var y=l.merge(s,x);k.publish("Frame3DXInfra.Update",{type:"Filter",display:"false",options:y})})},retrieveFilters:function(w){var v=this;if(w.filterObjects.length>1){var u={success:[],failure:[{msg:b.get("multiFiltersDrop"),eventID:"warning"}]};this._callbackOnDrop=w.callback;this._applyFilterOnDrop(u)}else{if(w.filterIds){w.droppedEnvId=w.filterObjects[0].envId;return this.retrieveFiltersFromIds(w)}for(var s=0;s<w.filterObjects.length;s++){if(w.filterObjects[0].objectId){w.droppedEnvId=w.filterObjects[0].envId;w.filterIds=w.filterObjects[0].objectId;return this.retrieveFiltersFromIds(w)}var r=w.filterObjects[s];var x=w.filterObjects[s].objectId?w.filterObjects[s].objectId:w.filterIds;var t=w.filterObjects[s].displayName;o.getPlatformServices(this._tenantId).then(function(){f.getFilterDataFromFilterNames(t).then(function(y){if(y.success){v._fromBIFilterToNGFUX({rootID:y.success[0].rootPhysicalId,filterIds:x,filterNames:t,NGFState:w.fromDropOnFilter?"dropOnFilter":"drop",})}if(y.failure){if(!y.success){y.success=[]}v._callbackOnDrop=w.callback;v._applyFilterOnDrop(y)}})})}if(v._subscribe0){v._subscribe0.unsubscribe("NGFilter.ApplyDroppedFilters");v._subscribe0=undefined}v._callbackOnDrop=w.callback;v._subscribe0=k.subscribe("NGFilter.ApplyDroppedFilters",v._applyFilterOnDrop.bind(this))}},_applyFilterOnDrop:function(x){if(this._callbackOnDrop){var t=x.success.length;for(var u=0;u<t;u++){if("tbd"===x.success[u].filter){x.success[u].filter=this.getCVQueryOfRootFiltered(x.success[u].rootId)}if(x.success[u].filter){if(this._expandSynthesisON){var w=f.getCVQueryType(x.success[u].filter);var v=f.getCombinationType(x.success[u].filter[w]);var r=f.getQueryExpandType(x.success[u].filter[w][v]);var y={};y[v]={};y[v][r]=[];for(var s=0;s<x.success[u].filter[w][v][r].length;s++){y[v][r].push(x.success[u].filter[w][v][r][s])}this._keepRootsInSession(x.success[u].filter.filterRootIds);if(!x.success[u].fromDropOnFilter){this._updateFilteredStructure(x.success[u].filter.filterRootIds[0],y);this._setTagsWithFilteredExpandSynthesis(this._objFilteredRootsInSession)}else{this._updateFilteredStructure(x.success[u].filter.filterRootIds[0])}}}sessionStorage.setItem("NGF_tagMgtRunning_"+x.success[u].filter.filterRootIds[0],false)}this._callbackOnDrop(x)}this._callbackOnDrop=undefined},cleanDroppedFilters:function(r){},setVolatileTags:function(w){var t=[],v=this;if(this.myTagProxy){if(w.summary){this._summary=this._summary.concat(w.summary);this._volatileTags=w.summary;this.myTagProxy.setTags(null,this._summary);for(var u=0;u<w.summary.length;u++){var r=w.summary[u].sixw;if(this._keepVolatileTags.indexOf(r)===-1){this._keepVolatileTags.push(r)}}}if(w.colorMap){for(var s in w.colorMap){if(w.colorMap.hasOwnProperty(s)){if(this._keepVolatileTags.indexOf(s)===-1){this._keepVolatileTags.push(s)}}}this.myTagProxy.setColorMap(w.colorMap)}delete this._setVolatilesSummariesAfterProxyCreation}else{this._setVolatilesSummariesAfterProxyCreation=w}},checkVolatileTags:function(v){var x,u,t,r={};r.isVolatileTag=false;t=this.volatileTags;if(v){for(var w in t){if(t.hasOwnProperty(w)){if(v[w]===undefined){delete this.volatileTags[w]}}}for(var s in v){if(v.hasOwnProperty(s)){if(this._keepVolatileTags.indexOf(s)>-1){x=s;u=v[x];if(this.volatileTags[x]){if(u.length===this.volatileTags[x].length){this.volatileTags[x]=u;r.isVolatileTag=true;r.predicateName=x;return r}}else{this.volatileTags[x]=u;r.isVolatileTag=true;r.predicateName=x;return r}}}}}else{this.volatileTags={};return r}return r},completeCVQueryWithAppSpecs:function(t,r,s){return h.completeCVQueryWithAppSpecs(t,r,s)},completeCVQueryWithAppParams:function(s,t,r){return h.completeCVQueryWithAppParams(s,t,r)},_onCloseFilterPanel:function(r){if("dataFilterPanel"===r.tag){if(this._fromDropOnFilter&&this._expandSynthesisON){this._setTagsWithFilteredExpandSynthesis(this._objFilteredRootsInSession)}this.dispatchEvent("NGFilter_CloseAbstract",r);for(var s=0;s<this._arrayRootsInSession.length;s++){sessionStorage.setItem("NGF_tagMgtRunning_"+this._arrayRootsInSession[s],false)}}},_onOpenFilterPanel:function(r){if("taggerCtn"===r.tag){if(this._fromDropOnFilter&&this._expandSynthesisON){this._setTagsWithFilteredExpandSynthesis(this._objFilteredRootsInSession)}this.dispatchEvent("NGFilter_CloseAbstract",r);for(var s=0;s<this._arrayRootsInSession.length;s++){sessionStorage.setItem("NGF_tagMgtRunning_"+this._arrayRootsInSession[s],false)}}},_computeFilterId:function(r){var s=this.optionsToKeep.appId+"_"+r;return s},_onFilterVolume:function(r){if(this.optionsToKeep.appId===r.appId&&this.optionsToKeep.volumeFilterAvailable){this.dispatchEvent("NGFilter_VolumeAbstract",r)}},setVolume:function(v){var w;var r=v.volume;if(r){var s=r.root_path_physicalid;if(s&&s.length){w=s[0][0];v.rootId=w;v.filterId=this._computeFilterId(w);var u=this;var t;if("proximity"===v.volume.type){t=v.volume.root_path_physicalid[0]}else{t=[w]}o.getInfosFromIds(t,true).then(function(C){var y=[];var B=t.length;var x=C.length;for(var A=0;A<B;A++){for(var z=0;z<x;z++){if(t[A]===C[z].id){y.push(C[z].label)}}}u._updateFilter(w,v,y)},function(x){u._updateFilter(w,v)})}}if(undefined===w){k.publish("NGFilter_CancelVolumeDefined",{})}},_updateFilter:function(x,v,s){v.volume.root_path_alias=s;if(v.id){var u=v.id.split("_");if(2<=u.length){var w=u[1].split("-");if(2<=w.length){v.specId=parseInt(w[0]);v.setId=parseInt(w[1])}}}var t=this._computeFilterId(x);var r={type:"Filter",options:{widgetTenant:this._tenantId,rootID:x,rootAlias:(s.length)?s[0]:undefined,appId:this.optionsToKeep.appId,widgetId:this.optionsToKeep.widgetId,filterId:t,configUsed:this._configUsed,appQueryParam:f.getAppQueryParam(),volumeUsed:true,filterToApply:{event:"NGFilter_VolumeDefined",data:v}}};k.publish("Frame3DXInfra.Update",r)},viewChange:function(s){if(this.optionsToKeep.widgetId===s.id){var r={type:s.type,appId:this.optionsToKeep.appId,widgetId:this.optionsToKeep.widgetId};k.publish("NGFilter_ViewChange",r)}},_onSubscribeRemoveWidget:function(r){k.publish("FBIProxy.RemoveWidget",r)},setProxyAsMaster:function(r){this.optionsToKeep.synthesis_priority=1},});return a});define("DS/ENOFilterBIUX/FilterBIComponentProxy",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Controls/Toggle","DS/TagNavigatorProxy/TagNavigatorProxy","DS/ENOFilterBIUX_ExSy/ExSy_FBIComponentProxy","DS/ENOFilterBIUX_Fetch/Fetch_FBIComponentProxy","DS/ENOFilterBIUX/BIEngine","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/ENOFilterBIUX/FBIProxyServices","DS/ENOFilterBIUX/NGFServices","UWA/Promise","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOFilterBIUX/assets/nls/ENOFilterBIUX"],function(n,o,g,d,i,j,q,h,p,r,m,f,c,l,k,b,a,e){var s=o.extend(g,{init:function(t){if(t.ExpandSynthesisON){this._biFilter=new p(t)}else{this._biFilter=new r(t)}this._biFilter.addEvent("FilterBIColorizeEvent",this.filterBIColorize.bind(this));this._biFilter.addEvent("FilterBIUnColorizeEvent",this.filterBIUnColorize.bind(this));this._biFilter.addEvent("FilterBIFilteringEvent",this.filterBIFilter.bind(this));this._biFilter.addEvent("ColorizeVolatileEvent",this.filterBIColorizeVolatile.bind(this));this._biFilter.addEvent("FilterVolatileEvent",this.filterBIFilterVolatile.bind(this));this._biFilter.addEvent("ApplyNGFilterAbstract",this.NGFApplyNGFilter.bind(this));this._biFilter.addEvent("NGFilter_VolumeAbstract",this.filterBIFilterVolume.bind(this));this._biFilter.addEvent("NGFilter_CloseAbstract",this.filterBICloseFilterPanel.bind(this));return this},cleanProxy:function(){this._biFilter.cleanProxy()},setPathTags:function(t,u){this._biFilter.setPathTags(t,u)},removeRoot:function(t){this._biFilter.removeRoot(t)},setVolume:function(t){this._biFilter.setVolume(t)},updateTenant:function(t){this._biFilter.updateTenant(t)},odtSetFilters:function(t){this._biFilter.odtSetFilters(t)},odtKeepActiveFilters:function(t){this._biFilter.odtKeepActiveFilters(t)},addFilterChangeListenerThruBI:function(t){this._biFilter.addFilterChangeListenerThruBI(t)},filterBIColorize:function(t){this.dispatchEvent("FilterBIColorize",t)},filterBIColorizeVolatile:function(t){this.dispatchEvent("ColorizeVolatile",t)},filterBIUnColorize:function(t){this.dispatchEvent("FilterBIUnColorize",t)},filterBIFilter:function(t){this.dispatchEvent("FilterBIFilteringEvent",t)},filterBIFilterVolatile:function(t){this.dispatchEvent("FilterVolatile",t)},NGFApplyNGFilter:function(t){this.dispatchEvent("ApplyNGFilter",t)},filterBIFilterVolume:function(t){this.dispatchEvent("NGFilter_Volume",t)},filterBICloseFilterPanel:function(t){this.dispatchEvent("NGFilter_Close",t)},viewChange:function(u){if(this.optionsToKeep.widgetId===u.id){var t={type:u.type,appId:this.optionsToKeep.appId,widgetId:this.optionsToKeep.widgetId};a.publish("NGFilter_ViewChange",t)}},_cleanUnFilteredTree:function(t,v,u){this._biFilter._cleanUnFilteredTree(t,v,u)},_cleanTree:function(t,v,u){this._biFilter._cleanTree(t,v,u)},setPredicates:function(t){this._predicates=t},addSubjects:function(t){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.addSubjects(t)}},destroy:function(){this._biFilter.destroy()},setTags:function(u,t,v){this._biFilter.setTags(u,t,v)},unsetTags:function(){this._biFilter.unsetTags()},focusOnSubjects:function(t,u){this._biFilter.focusOnSubjects(t,u)},unfocus:function(){this._biFilter.unfocus()},toggleProxyFocus:function(t){this._biFilter.toggleProxyFocus(t)},getCurrentFilter:function(){this._biFilter.getCurrentFilter()},die:function(){this._biFilter.die()},activate:function(){this._biFilter.activate()},deactivate:function(){this._biFilter.deactivate()},setVolatileTags:function(t){this._biFilter.setVolatileTags(t)},checkVolatileTags:function(t){this._biFilter.checkVolatileTags(t)},emptyFilter:function(t){this._biFilter.emptyFilter(t)},setNGFilterOptions:function(t){this._biFilter.setNGFilterOptions(t)},resetNGFilterUI:function(t){this._biFilter.resetNGFilterUI(t)},retrieveFiltersFromIds:function(t){this._biFilter.retrieveFiltersFromIds(t)},retrieveFilters:function(t){this._biFilter.retrieveFilters(t)},setTagsWithExpandSynthesis:function(u,t){this._biFilter.setTagsWithExpandSynthesis(u,t)},setSynthesisMode:function(t){this._biFilter.setSynthesisMode(t)},completeCVQueryWithAppSpecs:function(v,t,u){return l.completeCVQueryWithAppSpecs(v,t,u)},completeCVQueryWithAppParams:function(u,v,t){return l.completeCVQueryWithAppParams(u,v,t)},setProxyAsMaster:function(t){this._biFilter.setProxyAsMaster(t)}});return s});define("DS/ENOFilterBIUX/FilterComponent",["UWA/Core","UWA/Class","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/ENOFilterBIUX/FilterBIComponentProxy"],function(f,e,a,d,c){var b=e.extend({_tree:[],init:function(g){var i;this._nodesPath=g.nodesPath;this._widgetID=g.widgetID;this._fedSearchURL="https://vdevpril862dsy.ux.dsone.3ds.com/federated/search";this._groupedData={};var h=this;this._filterBIProxy=this._instanciateProxy();this._filterBIProxy.addEvent("FilterBIColorize",h.onTaggerColorization.bind(h));this._filterBIProxy.addEvent("FilterBIUnColorize",h.onTaggerUnColorization.bind(h));this._filterBIProxy.addEvent("FilterBIFilter",h.onTaggerFilter.bind(h));this._setPredicates(["ds6w:description"]);this._filterBIProxy.setPathTags(this._nodesPath)},_buildQuery:function(){var h=this._nodesPath.nodes.length;this._currentQuery="";for(var g=0;g<h;g++){this._currentQuery+='physicalid:"'+this._nodesPath.nodes[g]+'"';if(h!==g+1){this._currentQuery+=" OR "}}},fetch:function(){a.proxifiedRequest(this._fedSearchURL,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({query:this._currentQuery,order_by:"asc",order_field:"update",locale:"en",nresults:40,start:0,tenant:"OnPremise",select_predicate:["ds6w:created"],label:"FBIServices"}),onComplete:this._parse.bind(this),onFailure:function(g){console.log(g)}})},_parse:function(g){var i=g.results,k=g.facets,j=this,h=[];i.forEach(function(q){var m=q.attributes,p=[];for(var o=0;o<m.length;o++){if(m[o].format!=="internal"){if(!j._groupedData[m[o].name]){j._groupedData[m[o].name]={}}p=j._getIdPathsForID(m[0].value);if(j._groupedData[m[o].name][m[o].value]){for(var n=0;n<p.length;n++){j._groupedData[m[o].name][m[o].value].push(p[n].id)}}else{j._groupedData[m[o].name][m[o].value]=[];for(var l=0;l<p.length;l++){j._groupedData[m[o].name][m[o].value].push(p[l].id)}}}}})},_getIdPathsForID:function(h){var g=this;return this._tree.filter(function(i){var j=i.path;return h===g._nodesPath.nodes[j[j.length-1]]})},_instanciateProxy:function(){var g={widgetId:this._widgetID,tenant:"OnPremise",processingMode:"appProcessing",colorize:true,};return new c(g)},_setPredicates:function(g){this._filterBIProxy.setPredicates(g)},onTaggerColorization:function(g){console.log("RCIIIIIIIIIIIIIIIIIIIIII on FilterComponentjs.onTaggerColorization")},onTaggerUnColorization:function(g){console.log("RCIIIIIIIIIIIIIIIIIIIIII on FilterComponentjs.onTaggerUnColorization")},onTaggerFilter:function(g){console.log("RCIIIIIIIIIIIIIIIIIIIIII on FilterComponentjs.onTaggerFilter")},_findLastItems:function(n,h){var m=[],k={},g,l;for(var j=0;j<h.length;j++){l=h[j];g=l[l.length-1];if(k[g]){k[g].count+=1}else{k[g]={id:n[g],count:1}}}return},});return b});