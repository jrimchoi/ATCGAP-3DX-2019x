define("DS/HistoryExplorer/HistoryExplorerModel",["UWA/Controls/Abstract"],function(b){var a=b.extend({init:function(){this.nodes=[];this.connections={};this.currentNodeID={}},setCurrentNodeID:function(c){if(this.currentNodeID!==c){this.currentNodeID=c}},getCurrentNodeID:function(){return this.currentNodeID},setData:function(d){var c=JSON.parse(d);if(c.hasOwnProperty("nodes")){this.nodes=c.nodes}if(c.hasOwnProperty("connections")){this.connections=c.connections}},getNodes:function(){return this.nodes},getConnections:function(){return this.connections},removeNodes:function(c){if(!UWA.is(c,"array")){return}c.forEach(function(d){this.removeNode(d)},this)},removeNode:function(d){var c=0;for(;c<this.nodes.length;++c){if(this.nodes[c].id===d){this.nodes.splice(c,1);return}}},gotDataForThisObject:function(c){for(var d=0;d<this.nodes.length;++d){if(this.nodes[d].id===c.physicalid&&this.nodes[d].currentUntranslated===c.current){return true}}return false},getObjectTitle:function(c){for(var d=0;d<this.nodes.length;++d){if(this.nodes[d].id===c){return this.nodes[d].displayName}}},getObject:function(c){for(var d=0;d<this.nodes.length;++d){if(this.nodes[d].id===c){return this.nodes[d]}}return null},getCurrentObject:function(c){return this.getObject(this.getCurrentNodeID().id)}});return a});define("DS/HistoryExplorer/NodeView",["DS/etree/tree","DS/egraph/utils","DS/egraph/views","DS/egraph/core","UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Tooltip","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","WebappsUtils/WebappsUtils"],function(i,s,f,r,g,o,p,h,d){var t={};var c=document.createElement("div");c.innerHTML=['<div class="etree-basic-node">','  <img class="etree-basic-node-thumbnail" draggable="false"></img>','  <div class="etree-basic-node-name-history" draggable="false">','    <div class="etree-basic-node-name-history-name"></div>','    <div class="etree-basic-node-name-history-revision"></div>','    <div class="etree-basic-node-name-history-context"></div>',"  </div>",'  <div class="etree-basic-node-collapser" data-egraph-subelt="collapser"></div>','  <div class="etree-basic-node-status">','    <div class="etree-basic-node-publish-status">','      <div class="etree-basic-node-publish-status-type-not-published"></div>','      <div class="etree-basic-node-publish-status-check-off"></div>',"    </div>",'    <div class="etree-basic-node-duplicate-status-not-duplicated"></div>','    <div class="etree-basic-node-outofdate-status-revision-latest"></div>',"  </div>","</div>",'<div class="etree-basic-temp-node">',"</div>"].join("\n");var m=c.querySelector(".etree-basic-node");var q=c.querySelector(".etree-basic-temp-node");t.NodeView=function j(){f.HTMLNodeView.call(this)};s.inherit(t.NodeView,f.HTMLNodeView);t.NodeView.prototype.buildNodeElement=function e(u){var w=this;var v,z;var C,B,A;var x;var y=u.data.data.nodeID;v=UWA.createElement("div");v.className="etree-basic-node";v.setAttribute("data-rec-id",v.className+"_"+y);C=UWA.createElement("img",{draggable:"false"});C.className="etree-basic-node-thumbnail";C.setAttribute("data-rec-id",C.className+"_"+y);v.appendChild(C);C=UWA.createElement("div",{draggable:"false"});C.className="etree-basic-node-name-history";C.setAttribute("data-rec-id",C.className+"_"+y);v.appendChild(C);B=UWA.createElement("div");B.className="etree-basic-node-name-history-name";B.setAttribute("data-rec-id",B.className+"_"+y);C.appendChild(B);B=UWA.createElement("div");B.className="etree-basic-node-name-history-revision";B.setAttribute("data-rec-id",B.className+"_"+y);C.appendChild(B);B=UWA.createElement("div");B.className="etree-basic-node-name-history-context";B.setAttribute("data-rec-id",B.className+"_"+y);C.appendChild(B);B.onclick=function(E){var D=[{physicalid:v.data.nodeID,type:v.data.type,ev:E}];v.data.widget.dispatchEvent("onPickContext",D)};C=UWA.createElement("div",{"data-egraph-subelt":"collapser"});C.className="etree-basic-node-collapser";C.setAttribute("data-rec-id",C.className+"_"+y);v.appendChild(C);C=UWA.createElement("div");C.className="etree-basic-node-status";C.setAttribute("data-rec-id",C.className+"_"+y);v.appendChild(C);B=UWA.createElement("div");B.className="etree-basic-node-publish-status";B.setAttribute("data-rec-id",B.className+"_"+y);C.appendChild(B);x=new p({target:B,body:h.puplishTip,position:"bottom"});x.elements.body.style.zIndex="90000";x.elements.container.style.zIndex="90001";B.tooltip=x;A=UWA.createElement("div");A.className="etree-basic-node-publish-status-type-not-published";A.setAttribute("data-rec-id",A.className+"_"+y);B.appendChild(A);A=UWA.createElement("div");A.className="etree-basic-node-publish-status-check-off";A.setAttribute("data-rec-id",A.className+"_"+y);B.appendChild(A);B=UWA.createElement("div");B.className="etree-basic-node-duplicate-status-not-duplicated";B.setAttribute("data-rec-id",B.className+"_"+y);C.appendChild(B);x=new p({className:"mytooltip",target:B,body:h.notDuplicatedTip,position:"bottom"});x.elements.body.style.zIndex="90000";x.elements.container.style.zIndex="90001";B.tooltip=x;B=UWA.createElement("div");B.className="etree-basic-node-outofdate-status-revision-latest";B.setAttribute("data-rec-id",B.className+"_"+y);C.appendChild(B);x=new p({className:"mytooltip",target:B,body:h.latestRevisionTip,position:"bottom"});x.elements.body.style.zIndex="90000";x.elements.container.style.zIndex="90001";B.tooltip=x;if(u.data.data.isSelected){v.draggable=true}else{v.draggable=false}u.data.data.inCollapser=false;u.data.data.elt=v;v.data=u.data.data;return v};function l(u){return u+"history"}t.NodeView.prototype.onmodifyDisplay=function b(E,O){var v,A;f.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments);v=UWA.extendElement(this.display.elt);v.style.borderRadius="3px";v.style.cursor="";document.body.style.cursor="";var D=false;if(E.data.data.isAlternative==true){D=true}var K=false;if(E.data.data.isAlternativeBase==true){K=true}if(r.inPathSet(O,"data","data","title")){v.querySelector(".etree-basic-node-name-history-name").textContent=E.data.data.displayName;v.querySelector(".etree-basic-node-name-history-name").id=l(E.data.data.nodeID);v.querySelector(".etree-basic-node-name-history-name").style.cursor=""}if(r.inPathSet(O,"data","data","revision")){v.querySelector(".etree-basic-node-name-history-revision").textContent=E.data.data.revision}if(r.inPathSet(O,"data","data","thumbnail")){var J=E.data.data.thumbnail;var x;if(widget.uwaUrl!=null){x=widget.uwaUrl.substring(0,widget.uwaUrl.lastIndexOf("webapps")-1)}else{if(widget.body.baseURI!=null){x=widget.body.baseURI.substring(0,widget.body.baseURI.lastIndexOf("webapps")-1);if(x==""){x=d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/";J="I_VPMNavProduct108x144.png"}}}if(J!=null&&J.indexOf("http")==-1){J=x+J}v.querySelector(".etree-basic-node-thumbnail").src=J;v.querySelector(".etree-basic-node-thumbnail").style.cursor=""}if(r.inPathSet(O,"data","data","isSelected")){if(E.data.data.isSelected){if(K){v.style.border="3px solid rgb(255, 0, 0)"}else{if(D){v.style.border="3px solid rgb(255, 255, 0)"}else{v.style.border="3px solid rgb(54, 142, 196)"}}v.querySelector(".etree-basic-node-name-history").style.cursor="move";v.querySelector(".etree-basic-node-thumbnail").style.cursor="move";v.style.cursor="move";v.draggable=true}else{if(K){v.style.border="3px solid rgb(255, 0, 0)"}else{if(D){v.style.border="3px solid rgb(255, 255, 0)"}else{v.style.border="3px solid #E2E4E3"}}v.querySelector(".etree-basic-node-collapser").style.background="rgb(91, 93, 94)";v.draggable=false}}else{if(K){v.style.border="3px solid rgb(255, 0, 0)"}else{if(D){v.style.border="3px solid rgb(255, 255, 0)"}else{v.style.border="3px solid #E2E4E3"}}}if(r.inPathSet(O,"data","displayFlags")){if(E.data.displayFlags&i.DisplayFlags.DRAGGED){v.classList.add("dragged")}else{v.classList.remove("dragged")}}if(r.inPathSet(O,"data","data","highlighted")||r.inPathSet(O,"data","displayFlags")){if(E.data.data.highlighted&&!(E.data.displayFlags&i.DisplayFlags.DRAG_NODE)){v.classList.add("highlighted")}else{v.classList.remove("highlighted")}}if(r.inPathSet(O,"data","*children*")||r.inPathSet(O,"data","expanded")){A=v.querySelector(".etree-basic-node-collapser").classList;A.remove("expanded");A.remove("collapsed");if(E.data.first){var w=v.querySelector(".etree-basic-node-collapser");w.style.display="inline-block";if(E.data.expanded){A.add("expanded");var L=v.querySelector(".etree-basic-node-collapser.expanded")}else{A.add("collapsed");var L=v.querySelector(".etree-basic-node-collapser.collapsed")}}}function N(S,P,T){var Q=null;var U=P.length;for(var R=0;R<U;R++){Q=S.querySelector("."+P[R]);if(T==null){if(Q!=null){Q.style.visibility="hidden";break}}else{if(Q!=null){Q.className=Q.className.replace(P[R],T);Q.style.visibility="";if(T!="etree-basic-node-duplicate-status-not-duplicated"&&T!="etree-basic-node-outofdate-status-revision-latest"){Q.onclick=function(Z){Q.style.visibility="";Z.stopPropagation();var V=Q.offsetParent.offsetParent;var X=V.data.nodeID;var Y=Q.className;if(Q.tooltip){Q.tooltip.hide()}var W=[{physicalid:X,className:Y}];V.data.widget.dispatchEvent("onPickSymbol",W)}}break}}}return Q}var C=v.querySelector(".etree-basic-node-publish-status");if(C){if(E.data.data.current!=null){C.tooltip.elements.body.innerHTML=E.data.data.current}}var F=[];var z=[];F.push("etree-basic-node-publish-status-type-not-published");F.push("etree-basic-node-publish-status-type-published");z.push("etree-basic-node-publish-status-check-off");z.push("etree-basic-node-publish-status-check-on");if(r.inPathSet(O,"data","data","published_state")){if(E.data.data.ispublished==true){N(v,F,"etree-basic-node-publish-status-type-published");N(v,z,"etree-basic-node-publish-status-check-on")}else{if(E.data.data.ispublished==false){N(v,F,"etree-basic-node-publish-status-type-not-published");N(v,z,"etree-basic-node-publish-status-check-off")}else{N(v,F,null);N(v,z,null)}}}else{}var B=[];B.push("etree-basic-node-outofdate-status-revision-latest");B.push("etree-basic-node-outofdate-status-revision-not-latest");B.push("etree-basic-node-outofdate-status-revision-not-latest-published");if(r.inPathSet(O,"data","data","out_of_date")){var G=null;if(E.data.data.out_of_date=="latest"){G=N(v,B,"etree-basic-node-outofdate-status-revision-latest");if(G){G.tooltip.elements.body.innerHTML=h.latestRevisionTip}}else{if(E.data.data.out_of_date=="not_latest"){G=N(v,B,"etree-basic-node-outofdate-status-revision-not-latest");if(G){G.tooltip.elements.body.innerHTML=h.newerRevisionExistsTip}}else{if(E.data.data.out_of_date=="not_latest_published"){G=N(v,B,"etree-basic-node-outofdate-status-revision-not-latest-published");if(G){G.tooltip.elements.body.innerHTML=h.newerRevisionPublishedExistsTip}}else{G=N(v,B,null)}}}}else{}var y=[];y.push("etree-basic-node-duplicate-status-not-duplicated");y.push("etree-basic-node-duplicate-status-duplicated");y.push("etree-basic-node-duplicate-status-duplicated-newer-exists");y.push("etree-basic-node-duplicate-status-duplicated-newer-published-exists");if(r.inPathSet(O,"data","data","duplicate_criteria")){var G=null;if(E.data.data.duplicate_criteria=="not_duplicated"){G=N(v,y,"etree-basic-node-duplicate-status-not-duplicated");if(G){G.tooltip.elements.body.innerHTML=h.notDuplicatedTip}}else{if(E.data.data.duplicate_criteria=="duplicated"){G=N(v,y,"etree-basic-node-duplicate-status-duplicated");if(G){if(E.data.data.out_of_date){G.tooltip.elements.body.innerHTML=h.duplicatedFromLastestTip}else{G.tooltip.elements.body.innerHTML=h.duplicatedTip}}}else{if(E.data.data.duplicate_criteria=="duplicated_newer_exists"){G=N(v,y,"etree-basic-node-duplicate-status-duplicated-newer-exists");if(G){G.tooltip.elements.body.innerHTML=h.newerRevisionExists}}else{if(E.data.data.duplicate_criteria=="duplicated_newer_published_exists"){G=N(v,y,"etree-basic-node-duplicate-status-duplicated-newer-published-exists");if(G){G.tooltip.elements.body.innerHTML=h.newerPublishedRevisionExists}}else{N(v,y,null)}}}}}else{}if(E.data.document.historyConfig&&Array.isArray(E.data.document.historyConfig.historyConfig)){var u=E.data.document.historyConfig.historyConfig,I=u.length;for(var H=0;H<I;H++){var M=u[H];if((E.data.data[M.attribute]!=null&&M.value!=null&&E.data.data[M.attribute]===M.value)||(E.data.data[M.attribute]!=null&&M.value==null)&&M.node_color){v.setStyle("background-color",M.node_color);break}}}};t.GraphView=f.HTMLGraphView;t.TempEdgeView=function k(u){return new f.SVGEdgeView("etree-basic-temp-edge")};t.EdgeView=function n(u){f.SVGEdgeView.call(this,"etree-basic-tree-edge")};s.inherit(t.EdgeView,f.SVGEdgeView);t.EdgeView.prototype.onmodifyDisplay=function b(v,F,E){f.SVGEdgeView.prototype.onmodifyDisplay.apply(this,arguments);var w=UWA.extendElement(this.display.elt);var z=w.getTotalLength();w.svgimg.setAttribute("visiblity","hidden");w.svgimg.setAttribute("cursor","default");w.svgimg.onclick=null;var u=w.svgimg.getElementsByTagName("title")[0];if(u){w.svgimg.removeChild(u)}if(z>0){var C=d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/";if(v.cl2.c.node.data.data.conTypeHighlighted==true){w.style.stroke="rgb(18, 171, 222)";w.style.strokeWidth="6"}else{w.style.stroke="rgb(91, 93, 94)";w.style.strokeWidth=""}if(v.cl2.c.node.data.data.conType=="revision"){w.style.strokeDasharray="";w.svgimg.setAttributeNS("http://www.w3.org/1999/xlink","href",C+"I_MajorVersion.png")}else{if(v.cl2.c.node.data.data.conType=="minorRevision"){w.style.strokeDasharray="17,2";w.svgimg.setAttributeNS("http://www.w3.org/1999/xlink","href",C+"I_MinorVersion.png")}else{if(v.cl2.c.node.data.data.conType=="revisionFrom"){w.style.strokeDasharray="";w.svgimg.setAttributeNS("http://www.w3.org/1999/xlink","href",C+"I_NewVersionUsingDistantData.png");w.svgimg.setAttribute("cursor","pointer");var D=document.createElementNS("http://www.w3.org/2000/svg","title");D.textContent=h.newRevisionFromTip;w.svgimg.appendChild(D);w.svgimg.onclick=function(L){L.stopPropagation();var K=v.cl2.c.node.data.data.nodeID;var J=[{physicalid:K}];v.cl2.c.node.data.data.widget.dispatchEvent("onPickNewRevisionFrom",J)}}else{if(v.cl2.c.node.data.data.conType=="minorRevisionFrom"){w.style.strokeDasharray="17,2";w.svgimg.setAttributeNS("http://www.w3.org/1999/xlink","href",C+"I_NewMinorUsingDistantData.png")}else{if(v.cl2.c.node.data.data.conType=="evolution"){w.style.strokeDasharray="";w.svgimg.setAttributeNS("http://www.w3.org/1999/xlink","href",C+"I_Evolution.png")}else{if(v.cl2.c.node.data.data.conType=="duplicate"){w.style.strokeDasharray="";w.svgimg.setAttributeNS("http://www.w3.org/1999/xlink","href",C+"I_Duplicate.png")}}}}}}var I=w.getPointAtLength(z);w.svgimg.setAttribute("x",I.x+5);w.svgimg.setAttribute("y",I.y-25);w.svgimg.setAttribute("visiblity","visible");var H=function(O){var Q=E.container.getElements("path");if(O.getAttribute("d").split("C").length===2){var L=Q.filter(function(S){return S.getAttribute("d").split("C").length===3});var M=function(V){var T=V.getAttribute("d").split("C")[1].split("L");var S=T[0].trim().split(" ");S=S.slice(S.length-2,S.length).map(function(W){return Number(W.trim())});var U=T[1].trim().split(" ").map(function(W){return Number(W.trim())});return{begin:S,end:U}};if(L.length){var J=O.getAttribute("d").split("C")[0].split("M")[1].trim().split(" ").map(function(S){return Number(S.trim())});if(!Array.prototype.find){Array.prototype.find=function(S){if(this===null){throw new TypeError("Array.prototype.find called on null or undefined")}if(typeof S!=="function"){throw new TypeError("predicate must be a function")}var X=Object(this);var V=X.length>>>0;var T=arguments[1];var W;for(var U=0;U<V;U++){W=X[U];if(S.call(T,W,U,X)){return W}}return undefined}}var N=L.find(function(T){var S=M(T);return(J[1]===S.begin[1]&&J[1]===S.end[1]&&((J[0]>S.begin[0]&&J[0]<S.end[0])||(J[0]<S.begin[0]&&J[0]>S.end[0])))});if(N){var R=N.getAttribute("d");R=R.substring(0,R.lastIndexOf("C"));R=R.substring(0,R.lastIndexOf("L")+1)+J[0]+" "+J[1];R+="C"+O.getAttribute("d").split("C")[1];O.setAttributes({d:R});var K=O.getParent();if(K){var P=K.getParent();if(P){P.appendChild(K)}}}}}};H(UWA.extendElement(w));var A=v.cl1.c.node,y=v.cl2.c.node;if(y.data.document.historyConfig&&Array.isArray(y.data.document.historyConfig.historyConfig)){var G=y.data.document.historyConfig.historyConfig,z=G.length;for(var x=0;x<z;x++){var B=G[x];if((y.data.data[B.attribute]!=null&&B.value!=null&&y.data.data[B.attribute]===B.value)||(y.data.data[B.attribute]!=null&&B.value==null)&&B.line_color){w.setStyle("stroke",B.line_color);break}}}}};t.EdgeView.prototype.oncreateDisplay=function(x){var u;f.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments);var w=this.display.elt;var v=document.createElementNS("http://www.w3.org/2000/svg","image");v.setAttribute("height","20");v.setAttribute("width","20");w.svgimg=v;this.structure.root.appendChild(w.svgimg)};t.TempNodeView=function a(){f.HTMLNodeView.call(this)};s.inherit(t.TempNodeView,f.HTMLNodeView);t.TempNodeView.prototype.buildNodeElement=function e(w){var u,v;u=q.cloneNode(true);return u};return t});define("DS/HistoryExplorer/ExternalRefresh",["UWA/Core","UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","DS/LifecycleServices/ArrayFunctions","DS/LifecycleServices/LifecycleServicesSettings"],function(e,d,a,c,b){return d.extend({PADCommandProxy:null,tenant:null,init:function(f,g){this.views=[];this.views.push(this._revisonFamilyFacade(f));this.hostContainer=g;this.refreshSub=a.subscribe("Lifecycle.Modification",this._externalRefresh.bind(this));this._subscribeToPADEvents()},done:function(){if(this.refreshSub){this.refreshSub.unsubscribe();this.refreshSub=null}if(this.PADCommandProxy){this.PADCommandProxy.destroy();this.PADCommandProxy=null}},_subscribeToPADEvents:function(){var f=this;require(["DS/PADUtils/PADCommandProxy"],function(g){f.PADCommandProxy=g.create({events:{onRefresh:f._onPADEvent.bind(f)}})})},_onPADEvent:function(g){this._handlePADEventDeleted(g);if(e.is(g.authored.modified,"array")){if(g.authored.modified.length===1){var f=null;var j=false;if(e.is(g.authored.modified[0],"string")){f=g.authored.modified[0]}else{if(e.is(g.authored.modified[0].physicalid,"string")){if(e.is(g.authored.modified[0].key,"string")&&e.is(g.authored.modified[0].key==="ownerChanged")){j=true}f=g.authored.modified[0].physicalid}}if(!f){return}var i=this._getTenant();var h={physicalid:f,tenant:i};this._reloadHost(h.physicalid,h,j)}}},_handlePADEventDeleted:function(f){if(f.authored.deleted){this._handleDeletedForRefresh(f.authored.deleted)}},_revisonFamilyFacade:function(f){return{refresh:function(g){f.setObjects(g)},findObjects:function(g){return f.versionExplorer.getObjects().filter(function(h){return h.options.id===g})},getRelatedId:function(i){var h,g;g=f.versionExplorer.getObjects().find(function(j){return j.options.id!=i});if(g){h=g.options.id}return h}}},_isObjectLoaded:function(g){var f=false;this.views.forEach(function(h){if(h.findObjects(g).length>0){f=true}});return f},_reloadHost:function(i,h,j){var g=this._isObjectLoaded(i);if(g===true){if(j){var f=this._getRelatedId(h.physicalid);if(f){h.physicalid=f}}this.hostContainer.load(h)}},_getRelatedId:function(g){var f=null;this.views.forEach(function(h){if(!f){f=h.getRelatedId(g)}});return f?f.id:null},_handleDeletedForRefresh:function(f){var h=this;if(e.is(f,"array")){var i=null;f.some(function(j){var k=null;if(e.is(j,"string")){k=j}else{if(e.is(j.physicalid,"string")){k=j.physicalid}}if(k&&h._isObjectLoaded(k)){i=k;return true}return false});if(!i){return}var g=null;this.views.forEach(function(j){if(j.findObjects(i).length>0){var k=j.getRelatedId(i);if(k&&!g){var l=h._getTenant();g={physicalid:k,tenant:l}}}});if(g){this.hostContainer.load(g)}else{this.hostContainer.clear()}}},setTenant:function(f){this.tenant=f},_getTenant:function(){if(this.tenant){return this.tenant}var f=b.getTenant();if(!f){f=(typeof(widget)!=="undefined"&&widget)?widget.getValue("x3dPlatformId"):null}return f},_externalRefresh:function(k){var j=this;var f=null;var i=null;try{var g=JSON.parse(k);if(g!=null&&g.hasOwnProperty("Refresh")){var l=g.Refresh;if(l.created!=null&&l.created.length>0){i=l.created[0].sourceObjectId;f={physicalid:l.created[0].physicalid,tenant:g.tenant}}else{if(l.modified!=null&&l.modified.length>0){i=l.modified[0].physicalid;f={physicalid:l.modified[0].physicalid,tenant:g.tenant}}else{if(l.deleted!=null&&l.deleted.length>0){this._handleDeletedForRefresh(l.deleted)}}}}}catch(h){console.log(h)}if(f){this._reloadHost(i,f)}},})});define("DS/HistoryExplorer/HistoryDialog",["UWA/Core","UWA/Controls/Abstract","DS/LifecycleControls/CommandDialog","DS/LifecycleCmd/MessageMediator","DS/HistoryExplorer/ExternalRefresh","DS/LifecycleServices/LifecycleAlert","DS/HistoryMultiPanel/HistoryMultiPanel","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(f,g,h,i,a,d,j,e,c,b){return g.extend({displayNotification:function(k){d.displayNotification(k)},executeCmd:function(m,l,r){if(m.length>1){throw b.multipleSelection}this.addEvent("onComplete",function(s){r()});var o=this;var q=new h();var n=this._renderDialogContent();var p=q.create(n,{className:"History_modal",closeButton:true,title:b.history+" - "+m[0].displayName,buttonStyle:q.buttonStyle.none,resizable:true,persistId:"historyDialogId",maximizable:true,overlay:false,onClose:function(){o.historyMultiPanel.revisionFamily.cleanup();q.destroy();o._onComplete()},events:{onResizeFloating:function(){var t=p.elements.container.getSize();if(!o.historySizeInitialized){if(o.historySize){t=o.historySize;o.historySizeInitialized=true;p.setNewSize(t)}}o.historySize=t;o.historyMultiPanel.revisionFamily.onResize(t)}},},this);this.dialog=p;this._createHistoryUI(n);this._setObjects(m,false,false);var k={load:function(s){o.historyMultiPanel.setObjects([s],false,false)},clear:function(){p.destroy()}};this.externalRefresh=new a(this.historyMultiPanel.revisionFamily,k);if(this.externalRefresh&&m.length>0){this.externalRefresh.setTenant(m[0].tenant);c.setTenant(m[0].tenant)}p.inject(widget.body);this.dialog=p;r()},_onComplete:function(){if(this.externalRefresh){this.externalRefresh.done()}this.dispatchEvent("onComplete",{})},_setObjects:function(l,k,m){if(!m){if(l.length>0){c.setTenant(l[0].tenant)}this.historyMultiPanel.revisionFamily.setObjects(l)}if(this.externalRefresh&&l.length>0){this.externalRefresh.setTenant(l[0].tenant);c.setTenant(l[0].tenant)}},_createHistoryUI:function(l){var n=this;var k={wintop:false,};var m={setObjects:function(p,o,q){n._setObjects(p,o,q);n._reportSelection(p)},setTitleFromObject:function(o){n._setTitleFromObject(o)}};n.historyMultiPanel=new j(n,widget,n.dialog.elements.body,k,m);n.historyMultiPanel.inject(l)},_renderDialogContent:function(){var k=document.createElement("div");k.className="history_popup";return k},_setTitleFromObject:function(k){if(!k||!k.displayName){return}var l=b.history+" - "+k.displayName;if(k.revision!=null&&l.indexOf(" "+k.revision)<0){l+=" "+k.revision}this.dialog.setTitle(l)},_reportSelection:function(l){if(l.length>0){var k=l[0].physicalid;e.getSecurityContext(c.getTenant(),function(n){var m={objectId:k,envId:c.getTenant(),contextId:n};require(["DS/i3DXCompassServices/i3DXCompassPubSub"],function(o){o.publish("setObject",m)});require(["DS/WidgetServices/commandProxy/CommandProxy"],function(p){var o=[k];p.publishSelect({data:{paths:[o]}})})},function(m){console.log("reportSelection ",m)})}},})});define("DS/HistoryExplorer/HistoryExplorerController",["UWA/Core","UWA/Controls/Abstract","DS/HistoryExplorer/HistoryExplorerModel","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(h,g,f,c,d,a,e){var b=g.extend({tenant:null,init:function(){this.model=new f()},initTree:function(j){var i=this;c.getSecurityContextPromise(this.tenant).then(function(k){i.getRevisionHistory(j,k)})},getRevisionHistory:function(k,j){var i=this;if(this.model.gotDataForThisObject(k)){this.model.setCurrentNodeID({id:k.physicalid,displayName:k.displayName});i.dispatchEvent("onTreeInfoChanged",{reframeFlag:false,useHighlightedFrameFlag:false,useMarkedFrameFlag:false,isSelection:false});return}if(!k.hasOwnProperty("physicalid")){return}var l;c.getHistoryConfigPromise().then(function(m){l=m},function(){})["finally"](function(){var r="";if(typeof l==="object"&&l.historyConfig){r="&custAttribs=";for(var p=0,n=l.historyConfig,m=n.length;p<m;p++){var o=n[p];if(r.indexOf(h.Utils.encodeUrl(o.attribute))<0){r+=h.Utils.encodeUrl(o.attribute)+"~~~"}}}var q=d.get3DSpaceWSUrl(i.tenant,"/resources/lifecycle/history/links",null);a.authenticatedRequest(q,{method:"GET",type:"text",headers:d.getHeaders(j),timeout:600000,data:"physicalid="+k.physicalid+"&depth=100&height=100"+r,onComplete:function(s){i.model.setData(s);i.dispatchEvent("onTreeInfoChanged",{reframeFlag:true,useHighlightedFrameFlag:false,useMarkedFrameFlag:false,isSelection:true});i.dispatchEvent("onCompleteGetRevisionHistory")},onFailure:function(s,t){i.dispatchEvent("onError",c.parseWebServiceError(s,t))},ontimeout:function(){i.dispatchEvent("onError",e.connectionTimeout)}})})},setTenant:function(i){this.tenant=i}});return b});define("DS/HistoryExplorer/HistoryExplorer",["css!DS/Core/wux","css!DS/egraph/views","css!DS/HistoryExplorer/HistoryExplorer","UWA/Controls/Abstract","UWA/Utils/InterCom","WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandsManager","DS/HistoryExplorer/HistoryExplorerModel","DS/HistoryExplorer/HistoryExplorerController","DS/HistoryExplorer/NodeView","DS/LifecycleServices/EventHandler","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","DS/UIBehaviors/ContextualMenuManager","DS/LifecycleServices/Notification","DS/UIKIT/Mask","DS/Menu/Menu","DS/WebInWinHelper/WebInWinHelper","DS/etree/widget","DS/etree/tree","DS/egraph/utils","DS/egraph/core","DS/egraph/views","DS/etree/iact","DS/egraph/iact","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(l,j,r,w,o,h,b,n,d,c,p,z,a,f,v,C,k,q,g,u,B,y,m,A,s,t){var e=false;var x="PushItem";var i=w.extend({defaultOptions:{wintop:false,},WebToWinComSocket:null,ContextualMenuData:null,init:function(D){this._parent(D);this.originData=null},createUI:function(D){var F=this;this.parentWidget=D;this._disableDragAndDrop();this._buildSkeleton();this.contextMenuObject=null;var E=this.controller=new d({wintop:this.options.wintop,serverUrl:this.options.serverUrl});if(F.options.wintop==true){this.WebToWinComSocket=F.options.webToWinComSocket}this.model=this.controller.model;this.controller.addEvent("onError",function(G){C.unmask(F.elements.container);F.displayError(G);F.updateUI(false,false,false,false)});this.controller.addEvent("onTreeInfoChanged",function(G){C.unmask(F.elements.container);F._updateHistoryTree(G.reframeFlag,G.useHighlightedFrameFlag,G.useMarkedFrameFlag,G.isSelection)});this.controller.addEvent("onCompleteGetRevisionHistory",function(){var G=this.model.getCurrentObject();F.dispatchEvent("onDataUpdated",G)})},_disableDragAndDrop:function(){if(!this.parentWidget||this.options.wintop===true){return}if(typeof this.parentWidget.addEvent==="function"){this.parentWidget.addEvent("dragover",function(D){D=D||event;D.preventDefault()},false);this.parentWidget.addEvent("drop",function(D){D=D||event;D.preventDefault()},false)}},onSetCtxMenuForItem:function(D){var E=this;E.ContextualMenuData=q.parseContextualMenu(D);if(E.contextMenuObject!=null){if(!E.options.wintop){z.isOpenWithCATIAV5Available(function(F){E.doPickContext(E.contextMenuObject,F)})}else{E.doPickContext(E.contextMenuObject,undefined)}}},_buildSkeleton:function(){var D=UWA.createElement("div");this.elements.container=D;D.className="explore-globalDiv";D.setAttribute("data-rec-id",D.className);this.globalDiv=D;this.graph=UWA.createElement("div",{"class":"history-canvas","data-rec-id":"history-canvas",id:"history_canvas"}).inject(D);this._buildHistoryTree()},_isFolderType:function(D){if(D.indexOf("Workspace")>=0||D==="ENOCLG_LibraryReference"||D.indexOf("Folder")>=0){return true}return false},updateUI:function(G,F,E,D){this.controller.dispatchEvent("onTreeInfoChanged",{reframeFlag:G,useHighlightedFrameFlag:F,useMarkedFrameFlag:E,isSelection:D})},RootState:function(H){var D=H;var F=this;var J=function K(N,O){N.document.withLockedUpdate(function M(){switch(O){case A.SelectMode.REPLACE:case A.SelectMode.ADD:case A.SelectMode.TOUCH:if(!N.data.isSelected){N.data.isSelected=true;N.data.elt.style.cursor="wait";N.data.elt.ownerDocument.body.style.cursor="wait";N.data.elt.querySelector(".etree-basic-node-name-history").style.cursor="wait";N.data.elt.querySelector(".etree-basic-node-thumbnail").style.cursor="wait";var R=N.data.nodeID;var P=N.data.displayName;N.data.widget.model.setCurrentNodeID({id:R});N.data.widget.clearNotations();var Q={data:[{physicalid:R,displayName:P,tenant:D.controller.tenant}]};N.data.widget.dispatchEvent("onSelectedObject",Q)}break;case A.SelectMode.EMPTY:break}})};A.RootState.call(this);var I=function G(Q){var O;var S;switch(Q.device){case"touch":S=[Q.clientPos[0]+35,Q.clientPos[1]-18];break;default:S=[Q.clientPos[0]-30,Q.clientPos[1]-20]}D.contextMenuPos=S;if(Q.node){D.contextMenuObject={physicalid:Q.node.data.nodeID,type:Q.node.data.type,typeUntranslated:Q.node.data.typeUntranslated,XCADExtension_V_CADOrigin:D.model.nodes.find(function(T){return Q.node.data.nodeID===T.id}).XCADExtension_V_CADOrigin};if(D.options.wintop==true){var M=D.contextMenuObject.physicalid;var R=D.findTreeNode(M);var N=R.data.name;var P=[];P.push({physicalId:M,name:N});q.fetchContextFromSelection(D.WebToWinComSocket,P)}else{z.isOpenWithCATIAV5Available(function(T){D.doPickContext(D.contextMenuObject,T)})}}else{D.contextMenuObject=null;D.doPickContext(D.contextMenuObject,undefined)}};this.oncontext=I.bind(D);var E=function(N){N.document.withLockedUpdate(function M(){if(N.expanded){N.setExpanded(false)}else{N.setExpanded(true)}});N.document.withLockedUpdate(function O(){})};this.buttons={collapser:E,};this.movePredicate=function L(M){if(M.data.isSelected){return false}else{return false}};this.actions={select:J}},_buildHistoryTree:function(){var G=this;B.inherit(this.RootState,A.RootState);this.RootState.prototype.onwheel=function(N,K){var M,L,H,I;if(K.inside){var J=0.5*K.wheelDelta;M=N.graphView;L=B.incViewpointScale(M.vpt,J,K.graphPos,true);if(L[2]>0.05&&L[2]<10){M.setViewpoint(L,true)}return{consume:true}}else{return{}}};this.RootState.prototype.onmousedown=function D(K,J){var H;H=J.grElt;if(J.modifiers===0&&J.button===s.Buttons.LEFT&&H&&H.type===y.Type.NODE&&!J.subElt){if(J.dom.className!="etree-basic-node-outofdate-status-revision-not-latest-published"&&J.dom.className!="etree-basic-node-outofdate-status-revision-not-latest"&&J.dom.className!="etree-basic-node-outofdate-status-revision-latest"&&J.dom.className!="etree-basic-node-duplicate-status-duplicated-newer-published-exists"&&J.dom.className!="etree-basic-node-duplicate-status-duplicated-newer-exists"&&J.dom.className!="etree-basic-node-duplicate-status-duplicated"&&J.dom.className!="etree-basic-node-duplicate-status-not-duplicated"&&J.dom.className!="etree-basic-node-name-history-context"){if(J.dom.className=="etree-basic-node-publish-status"){if(J.dom.tooltip){J.dom.tooltip.hide()}}this.actions.select(J.grElt.data,A.SelectMode.REPLACE)}return{state:new s.EndDragOnLeftRelease(),consume:false}}var I=Array.prototype.slice.call(arguments)[0];return A.RootState.prototype.onmousedown.apply(this,arguments)};this.graph.addEventListener("dragstart",function E(L){var K=L.target;if(!K.classList.contains("etree-basic-node")){return}var I=K.grElt.data;if(!I.data.isSelected){return}var J=I.data.nodeID;var M={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:[{envId:z.getTenant(),serviceId:"3DSpace",contextId:"",objectId:J,objectType:I.data.typeUntranslated,displayName:I.data.name,session_object:false}]}};try{L.dataTransfer.setData("text/searchitems",JSON.stringify(M))}catch(H){L.dataTransfer.setData("Text",JSON.stringify(M))}});this.graph.addEventListener("dragend",function F(J){var H;if(!J.target.classList.contains("etree-basic-node")){return}var I=J.target.grElt.data;if(!I.data.isSelected){return}try{H=new MouseEvent("mouseup",J)}catch(J){H=document.createEvent("MouseEvents");H.initMouseEvent("mouseup",true,true,window,J.detail,J.screenX,J.screenY,J.clientX,J.clientY,J.ctrlKey,J.altKey,J.shiftKey,J.metaKey,J.button,null)}J.target.dispatchEvent(H)});this.widget=new g.EGraphTree(this.graph,{nodeWidth:150,nodeHeight:101,rowPadding:60,siblingPadding:30,nodeViewCtor:c.NodeView,edgeViewCtor:c.EdgeView,drawing:u.Drawing.LAYERED,edges:{type:"rounded-square",radius:7},rootState:new G.RootState(G)})},_updateHistoryTree:function(F,H,G,E){var D=this;a.getHistoryConfigPromise().then(function(I){D.widget.document.historyConfig=I},function(){D.widget.document.historyConfig=null})["finally"](function(){D.widget.document.withLockedUpdate(function K(){D.widget.document.clear();var L=D.loadNodes([D.widget.document],E);if(L!=null){D.widget.document.appendChild(L)}});if(F==true){D.widget.document.withLockedUpdate(function J(){try{D.reframe(H,G)}catch(L){console.log(L)}})}var I=D.model.getCurrentObject();D.dispatchEvent("ModelUpdated",I)})},showProperties:function(E){var D={_context:this.options.context,_selection:[{getID:function(){return E.id}}],getSecurityContext:function(){return this._context},getSelectedNodes:function(){return this._selection},displayNotification:function(){}};require(["DS/LifecycleControls/EditPropDialog"],function(G){var F=new G();F.launchProperties(D)})},getUniqueHtmlIdForNode:function(D){return D+"history"},updateObjectTitle:function(D,F){var E=document.getElementById(this.getUniqueHtmlIdForNode(D));if(E){E.textContent=F}},showCompare:function(H,G){var F=this;if(F.options.wintop==true){if(F.ContextualMenuData!=null){q.launchWinCompare(F.WebToWinComSocket,H,G)}}else{var J=[];if(null!==H){J.push({envId:"",serviceId:"",contextId:"",objectId:H.id,objectType:"",displayName:""})}if(null!==G){J.push({envId:"",serviceId:"",contextId:"",objectId:G.id,objectType:"",displayName:""})}if(J.length>0){var D={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:J}};var E=new o.Socket("compassPageSocket");E.subscribeServer("com.ds.compass",window.parent);E.dispatchEvent("onSetX3DContent",D,"compassPageSocket");E.addListener("launchApp",function(K){console.log("Response = "+JSON.stringify(K));this.response=K.response});var I={appId:"ENOCOMP_AP"};E.dispatchEvent("onLaunchApp",I,"compassPageSocket")}}},showAlternatives:function(D){this.highlightAlternatives(D);this.updateUI(false,false,false,false)},showDuplicates:function(D){this.highlightDuplicates(D);this.updateUI(false,false,false,false)},getMarkedObjectsBounds:function(G,F){var E=function(){this.xmin=NaN;this.xmax=NaN;this.ymin=NaN;this.ymax=NaN;this.xminObj=null;this.xmaxObj=null;this.yminObj=null;this.ymaxObj=null};E.prototype.update=function(L,H,K,J,I){if(H<this.xmin||isNaN(this.xmin)){this.xmin=H;this.xminObj=L}if(K>this.xmax||isNaN(this.xmax)){this.xmax=K;this.xmaxObj=L}if(J<this.ymin||isNaN(this.ymin)){this.ymin=J;this.yminObj=L}if(I>this.ymax||isNaN(this.ymax)){this.ymax=I;this.ymaxObj=L}};this.widget.document.getMarkedObjectsBounds=function D(O,N){var I,K,J;var L;var M;I=this.nodeWidth;K=this.nodeHeight;M=new E();for(L=this.first;L;L=L.dftNext(this,!L.expanded)){if((L.data.conTypeHighlighted&&O)||(L.data.conTypeMarked&&N)){J=L.height;if(J!==J){J=K}M.update(L,L.left,L.left+I,L.top,L.top+J);if(L.parent!=null){var H=L.parent;J=H.height;if(J!==J){J=K}M.update(H,H.left,H.left+I,H.top,H.top+J)}}}return M};return this.widget.document.getMarkedObjectsBounds(G,F)},onResize:function(){this.reframe(false,false)},reframe:function(I,Q){var J=this.widget.document.gr.views.main.vpt[2];var F;F=this.widget.document.getBounds();if(I||Q){var L=this.getMarkedObjectsBounds(I,Q);F.xmin=L.xmin;F.xmax=L.xmax;F.ymin=L.ymin;F.ymax=L.ymax;F.xminObj=L.xminObj;F.xmaxObj=L.xmaxObj;F.yminObj=L.yminObj;F.ymaxObj=L.ymaxObj}if(isNaN(F.ymax)||isNaN(F.xmax)){return}var E=this.parentWidget;if(E===undefined||E===null){return}var O=E.getBoundingClientRect();var R=this.widget.document.gr.views.main.container.getBoundingClientRect();var H=E.clientWidth;var K=O.bottom-R.top;this.widget.document.gr.views.main.container.setStyle("height",K+"px");var N=this.widget.document.gr.views.main.container.clientWidth;var S=this.widget.document.gr.views.main.container.clientHeight;F.ymax+=25;var P=F.ymax-F.ymin;var D=F.xmax-F.xmin;var G=(P/S);var M=[H,K];this.widget.document.gr.views.main.setViewpoint(B.reframeViewpoint(M,F,{padding:25*(1/G),horizontal:0,vertical:0,aliasing:0,}))},loadNodes:function(L,H){var G=this;var E=null;var D=this.selectAndFindNode(this.model.getCurrentNodeID().id);if(D!=null){var J=null;var K=null;var I=null;var F=this.findNodeByShortID(1);E=this.createTreeNode(F,true,-1,"",false,false);this.createTreeNodeChildren(E,F,null);if(H){this.CollapseNonInterestingAncestors(E,D)}}this.widget.document.vetoUpdateAnimation();return E},findNode:function(H){var E=this.controller.model.getNodes();var G=E.length;var D=null;for(var F=0;F<G;F++){if(E[F].id==H){D=E[F];break}}return D},selectAndFindNode:function(H){var E=this.controller.model.getNodes();var G=E.length;var D=null;for(var F=0;F<G;F++){if(E[F].id==H){D=E[F];D.isSelected=true}else{E[F].isSelected=false}}return D},findNodeByShortID:function(H){var E=this.controller.model.getNodes();var G=E.length;var D=null;for(var F=0;F<G;F++){if(E[F].nId==H){D=E[F];break}}return D},createTreeNodeChildren:function(L,F,G){var K=null;if(F!=null){var M=this.controller.model.getConnections();var D=M.length;for(var E=0;E<D;E++){if(M[E].src==F.nId){if(true){var H=this.findNodeByShortID(M[E].trg);if(H!=null){var J=(G!=null&&G.nId==M[E].trg);var I=this.createTreeNode(H,true,E,M[E].typ,M[E].highlighted,M[E].marked);if(I!=null){L.appendChild(I);if(J){K=I}else{this.createTreeNodeChildren(I,H,null)}}}}}}}return K},createTreeNode:function(M,N,L,F,D,E){var J=this;var G={name:M.displayName+" "+M.revision,displayName:M.displayName,thumbnail:M.thumbnail,useAsyncPreExpand:true,conId:L,conType:F,conTypeHighlighted:D,conTypeMarked:E,isAlternative:M.isAlternative,isAlternativeBase:M.isAlternativeBase,nodeID:M.id,type:M.type,typeUntranslated:M.typeUntranslated,inCollapser:false,widget:J,isSelected:M.isSelected,revision:M.revision,title:M.name,ispublished:M.ispublished,out_of_date:M.out_of_date,current:M.current,duplicate_criteria:M.duplicate_criteria};if(J.widget.document.historyConfig&&Array.isArray(J.widget.document.historyConfig.historyConfig)){for(var H=0,I=J.widget.document.historyConfig.historyConfig.length;H<I;H++){G[J.widget.document.historyConfig.historyConfig[H].attribute]=M[J.widget.document.historyConfig.historyConfig[H].attribute]}}var K=new u.Node(G);K.setExpanded(N);return K},displayError:function(D){v.displayError(this.context,D)},displayInfo:function(D){v.displayInfo(this.context,D)},setObjects:function(F){var E=this;if(F.length===0){this.displayError(t.noObject)}else{if(F.length===1){var D=F[0];if(D.hasOwnProperty("physicalid")&&D.physicalid===""){this.displayError(t.epmtyPhysicalId)}else{C.mask(E.elements.container,t.updatingMessage);this.controller.setTenant(D.tenant);this.controller.initTree(D);if(D.hasOwnProperty("displayName")&&D.displayName&&D.displayName.trim().length>0){this.model.setCurrentNodeID({id:D.physicalid,displayName:D.displayName})}else{this.model.setCurrentNodeID({id:D.physicalid})}}}else{this.displayError(t.multipleSelection)}}},CollapseNonInterestingAncestors:function(E,J){var G=E;var K;var D=null;for(K=G;K;K=K.dftNext(this.widget.document)){if(K.data.nodeID===J.id){D=K;break}}if(D===null){return}var H=D;var I=D.parent;if(I){for(var L=I;L!==null;L=L.parent){for(var F=L.first;F!==null;F=F.next){if(F!==H){F.setExpanded(false)}}H=L}}},highlightDuplicates:function(H){var D=this.widget.document.first;var J=D;if(J==null){return}var E=this.controller.model.getConnections();this.clearNotations();var F=false;var G=[];if(this.highlightDuplicatesRAll(J,G)==true){var E=this.controller.model.getConnections();while(G.length>0){var K=G.pop();K.setExpanded(true);if(K.data.conId>=0&&E[K.data.conId].typ=="duplicate"&&K!=J){var I=this.findNode(K.data.nodeID);I.isAlternative=true;F=true}E[K.data.conId].marked=true}}return F},highlightDuplicatesR:function(F,G){var D=false;for(var H=F.first;H!=null;H=H.next){var E=(H.data.conType=="duplicate");if(this.highlightDuplicatesR(H,G)==true||E){G.push(H);D=true}}return D},highlightDuplicatesRAll:function(F,G){var D=false;for(var H=F.first;H!=null;H=H.next){var E=(H.data.conType=="duplicate");if(E){G.push(H);D=true}if(this.highlightDuplicatesR(H,G)==true){G.push(H);D=true}}return D},highlightAlternatives:function(J){var G=this.widget.document.first;var K;var D=null;for(K=G;K;K=K.dftNext(this.widget.document)){if(K.data.nodeID==J.id){D=K;break}}if(D==null){return}var O=this.controller.model.getConnections();this.clearNotations();J.isAlternativeBase=true;var G=this.widget.document.first;var M=[];var H=null;for(var N=D;N.parent!=null;N=N.parent){var E=false;if(N==D){E=this.highlightOODPath(N,true,true);if(!E){E=this.highlightOODPath(N,false,true)}if(!E){E=(N.data.out_of_date=="latest");if(E){var L=this.findNode(N.data.nodeID);L.isAlternative=true}}}else{for(var F=N.first;F!=null;F=F.next){if(F!=H){if(F.data.conId>=0&&O[F.data.conId].typ=="duplicate"){var I=this.highlightOODPath(F,true,true);if(!I){I=this.highlightOODPath(F,false,true)}if(!I){I=(F.data.out_of_date=="latest");if(I){var L=this.findNode(F.data.nodeID);L.isAlternative=true}}if(I&&F.data.conId>=0){M.push(F.data.conId);E=true}}}}}if(E){while(M.length>0){O[M.pop()].marked=true}}if(N.data.conId>=0){M.push(N.data.conId)}H=N}},highlightOODPath:function(D,K,J){var E=false;var L=[];if(this.highlightOODPathR(D,K,L)===true){var M=this.controller.model.getConnections();if(J===true){if(L.length>0){var F=L[0];var I=this.findNode(F.data.nodeID);I.isAlternative=true}}while(L.length>0){var H=L.pop();H.setExpanded(true);var G=(H.data.conType==="revision"||H.data.conType==="revisionFrom");if(H.data.conId>=0&&G&&H!=D){E=true;if(J){M[H.data.conId].marked=true}else{M[H.data.conId].highlighted=true}}}}return E},highlightOODPathR:function(G,F,H){var D=false;for(var I=G.first;I!==null;I=I.next){var E=(I.data.conType=="duplicate");if(!E){D=(I.data.out_of_date=="latest")||(F&&(I.data.out_of_date=="not_latest"));if(F&&I.data.ispublished!==true){D=false}if(D){H.push(I);D=true;break}else{if(this.highlightOODPathR(I,F,H)===true){H.push(I);D=true;break}}}}return D},highlightDUPPath:function(J,E){var I=[];var D=false;for(var G=J;G.parent!=null;G=G.parent){G.setExpanded(true);var F=this.controller.model.getConnections();if(G.data.conId>=0&&F[G.data.conId].typ=="duplicate"&&G!=J){D=true;I.push(G);break}else{if(G.data.conId>=0){I.push(G)}}}var K=null;if(D){K=I[I.length-1];while(I.length>0){var H=I.pop();F[H.data.conId].highlighted=true}}else{if(I.length>0){K=I[0];F[K.data.conId].highlighted=true}}return K},clearNotations:function(){var G=this.controller.model.getConnections();var H=G.length;for(var F=0;F<H;F++){G[F].highlighted=false;G[F].marked=false}var D=this.controller.model.getNodes();var E=D.length;for(var F=0;F<E;F++){D[F].isAlternative=false;D[F].isAlternativeBase=false}},findTreeNode:function(D){var E=this.widget.document.first;var G;var F=null;for(G=E;G;G=G.dftNext(this.widget.document)){if(G.data.nodeID==D){F=G;break}}return F},onPickContext:function(G){var F=this;F.contextMenuPos=[G.ev.clientX,G.ev.clientY];F.contextMenuObject=G;if(F.options.wintop==true){var D=G.physicalid;var I=F.findTreeNode(D);var E=I.data.name;var H=[];H.push({physicalId:D,name:E});q.fetchContextFromSelection(F.WebToWinComSocket,H)}else{z.isOpenWithCATIAV5Available(function(J){UWA.extend(G,{XCADExtension_V_CADOrigin:F.model.nodes.find(function(K){return K.id===G.physicalid}).XCADExtension_V_CADOrigin});F.doPickContext(G,J)})}},doPickContext:function(ac,E){var G=this;var aa=this;var K=[];var Q;var Z=h.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/";var L=null;var M=0;if(ac){M=ac.physicalid;L=this.findTreeNode(M)}if(L){if(G.options.wintop==true){var U=L.document;if(G.options.wintop==true){var T=aa.ContextualMenuData[0];var V=aa.findNode(L.data.nodeID);q.onBuildWinContextMenu(aa.WebToWinComSocket,T,K,V)}if(L.data.isSelected==false){Q="url("+Z+"I_Compare.png)";var S="PushItem";var O=function W(){U.withLockedUpdate(function ad(){var ae=aa.findNode(L.data.nodeID);var af=aa.controller.model.getCurrentNodeID();aa.showCompare(af,ae)})};var D={callback:O,"this":aa};K.push({label:t.compare,title:t.compare,type:S,icon:Q,action:D,callback:O})}Q="url("+Z+"I_Duplicate.png)";if(!this._isFolderType(ac.type)){var S="PushItem";var O=function W(){U.withLockedUpdate(function ae(){var af=aa.findNode(L.data.nodeID);aa.showDuplicates(af)});U.withLockedUpdate(function ad(){aa.reframe(false,true)})};var D={callback:O,"this":aa};K.push({label:t.showDuplicates,title:t.showDuplicates,type:S,icon:Q,action:D,callback:O})}}else{var Y={node:null};var Z=h.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/";Y.node=L;var R=aa._buildContextualMenu(Y,E);K=aa._createMenuArray(L.data.type,R);var N=false;var H=[];var F=K.length;for(var J=0;J<F;J++){if((K[J].type==="SeparatorItem")||(K[J].type==="separator")){if(H.length===0||N===true){continue}H.push(K[J]);N=true}else{H.push(K[J]);N=false}}K=H}}var V;if(L){V=aa.findNode(L.data.nodeID)}else{V=aa.globalDiv;if(true){var Q="url("+Z+"I_Reframe.png)";var S="PushItem";var O=function W(){aa.reframe(false,false)};var D={callback:O,"this":aa};K.push({label:t.reframe,title:t.reframe,type:S,icon:Q,action:D,callback:O})}V=aa.globalDiv}if(G.options.wintop==true){var I=(window.location.search.indexOf("touch")>=0);var X=(window.location.search.indexOf("replace")>=0);var P={target:V,nodes:K};var ab={input:I?"touch":"mouse",position:{x:aa.contextMenuPos[0],y:aa.contextMenuPos[1]},submenu:(K.length==1)?"outside":(X?"replace":"auto")};k.show(K,ab)}else{var P={target:V,nodes:K};var ab={input:I?"touch":"mouse",position:{x:aa.contextMenuPos[0],y:aa.contextMenuPos[1]},submenu:(K.length==1)?"outside":(X?"replace":"auto")};if(e){k.show(K,ab)}else{f.show(P,aa.contextMenuPos)}}},onPickSymbol:function(E){var G=this;var H=this.model.getCurrentNodeID();var D=E.physicalid;var F=E.className;this.clearNotations();var J=this.findTreeNode(D);if(J==null){return}if(F=="etree-basic-node-outofdate-status-revision-not-latest-published"){this.highlightOODPath(J,true,false)}else{if(F=="etree-basic-node-outofdate-status-revision-not-latest"){this.highlightOODPath(J,false,false)}else{if(F=="etree-basic-node-outofdate-status-revision-latest"){}else{if(F=="etree-basic-node-duplicate-status-duplicated-newer-published-exists"){var I=this.highlightDUPPath(J,"duplicated");if(I!=null){this.highlightOODPath(I.parent,true,false)}}else{if(F=="etree-basic-node-duplicate-status-duplicated-newer-exists"){var I=this.highlightDUPPath(J,"duplicated");if(I!=null){this.highlightOODPath(I.parent,false,false)}}else{if(F=="etree-basic-node-duplicate-status-duplicated"){this.highlightDUPPath(J,"duplicated")}else{if(F=="tree-basic-node-duplicate-status-not-duplicated"){}}}}}}}this.updateUI(true,true,false,false)},onPickNewRevisionFrom:function(D){var E=this;this.clearNotations();var F=this.findTreeNode(D.physicalid);if(F==null){return}this.highlightNewRevFromPath(F);this.updateUI(true,true,false,false)},highlightNewRevFromPath:function(F){var H=this.findNode(F.data.nodeID);var Q=null;if(H!=null&&H.hasOwnProperty("revisedFrom")){Q=H.revisedFrom}if(Q!=null){var L=[];var O=false;for(var R=F;R.parent!=null;R=R.parent){R.setExpanded(true);L.push(R)}var P=[];var N=this.findTreeNode(Q);for(var E=N;E.parent!=null;E=E.parent){E.setExpanded(true);P.push(E)}var G=null;var M=false;if(P.length<L.length){var I=P;var D=L}else{var I=L;var D=P}for(var K=0;K<I.length;K++){G=I[K];for(var J=0;J<D.length;J++){if(G.data.nodeID==D[J].data.nodeID){M=true;break}}if(M){break}}var S=this.controller.model.getConnections();if(M){this.processNodeStackToHighlightNewRevFromPath(L,G,S);this.processNodeStackToHighlightNewRevFromPath(P,G,S)}}},processNodeStackToHighlightNewRevFromPath:function(D,E,F){var H=false;while(D.length>0){var G=D.pop();if(G.data.nodeID==E.data.nodeID){H=true;continue}if(H){F[G.data.conId].highlighted=true}}},_showOpenInCATIAMenu:function(D){try{if(D.options.wintop){return false}if(a.isInPSEditorWidget(D.options.context.widget)){return false}if(a.isInXCADEditorWidget(D.options.context.widget)){return true}if(a.isDECType(D.contextMenuObject.typeUntranslated)){return true}return false}catch(E){return true}},_displayOpenWithCATIAV5:function(D,F){try{if(D.options.wintop){return false}if(a.isInPSEditorWidget(D.options.context.widget)){return false}if(a.isInXCADEditorWidget(D.options.context.widget)){return false}if(a.isDECType(D.contextMenuObject.typeUntranslated)){return false}return true}catch(E){return false}},_buildContextualMenu:function(M,R){var J={};var E=true;var H=b.getCommand("HistoryHdr",g);if(H&&H.isEditMode===false){E=false}var G=this;var O=h.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/";G._isWidget=true;try{if(G.options.context.context.hasOwnProperty("dialog")){G._isWidget=false}}catch(I){}function K(S,T){var V=h.getWebappsBaseUrl();var U=T||"HistoryExplorer";return"url("+V+U+"/assets/icons/32/"+S+")"}J.Separator={type:(e?"SeparatorItem":"separator")};J.WhereUsed={label:t.whereUsed,icon:K("ENORIPE32.png","FolderEditor"),callback:function F(){M.node.document.withLockedUpdate(function S(){var U=require("DS/PADUtils/PADCommandProxy");var T=U.create();require(["DS/PADUtils/PADUtilsServices"],function(Z){var W=[];W.push({envId:"",serviceId:"",contextId:"",objectId:M.node.data.nodeID,objectType:M.node.data.type,displayName:M.node.data.displayName});var V={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:W}};var Y={attributes:{},paths:[],version:"1.1"};Y.attributes[M.node.data.nodeID]={label:M.node.data.displayName,type:M.node.data.type};Y.paths.push([M.node.data.nodeID]);var X=new o.Socket("compassPageSocket");X.subscribeServer("com.ds.compass",window.parent);X.dispatchEvent("onSetX3DContent",V,"compassPageSocket");X.addListener("launchApp",function(aa){T.select(Y);T.destroy();console.log("Response = "+JSON.stringify(aa))});X.dispatchEvent("onLaunchApp",{appId:"ENORIPE_AP"},"compassPageSocket")})})}};if(E===true){J.Delete={label:t.delete_,icon:K("I_Delete.png","LifecycleCmd"),callback:function(){M.node.document.withLockedUpdate(function(){G.showDelete([M.node.data])})}}}if(E===true){if(!G._isWidget){J.Maturity={label:t.maturity,icon:K("I_Maturity.png","LifecycleCmd"),callback:function(){M.node.document.withLockedUpdate(function(){G.showMaturity([M.node.data])})}}}}if(E===true){J.Duplicate={label:t.duplicate,icon:K("I_Duplicate.png","LifecycleCmd"),callback:function(){M.node.document.withLockedUpdate(function(){G.showDuplicate([M.node.data])})}}}if(E===true){J.Revise={label:t.newRevision,icon:K("I_Revise.png","LifecycleCmd"),callback:function(){M.node.document.withLockedUpdate(function(){G.showMajorVersion([M.node.data])})}}}if(E===true){z.hasPARRole(function(T){if(T==true){var S=b.getCommand("ReviseFromHdr",g);if(S&&S.isTypesSupported([M.node.data.typeUntranslated])){J.ReviseFrom={label:t.newRevisionFrom,icon:K("I_ReviseFrom.png","LifecycleCmd"),callback:function(){M.node.document.withLockedUpdate(function(){G.showReviseFrom([M.node.data])})}}}}})}if(this._showOpenInCATIAMenu(G)){J.OpenInCV5={label:t.openCATIA,icon:K("ENOV5MA_AP_AppIcon.png","FolderEditor"),callback:function Q(){M.node.document.withLockedUpdate(function S(){C.mask(G.parentWidget,t.openCATIALaunchMessage);require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],function(W,Y){var U={version:"1",structures:{references:[],connections:[],trees:{}}};U.structures.references.push({localid:"0",physicalid:M.node.data.nodeID,type:"CATProduct"});U.structures.trees["0"]={selected:true};var V={data:U,onComplete:function(Z){var ab=UWA.is(Z,"string")?JSON.parse(Z):Z;W.setStructure_4_open_in_cv5({completeselection:ab});var aa=new o.Socket("compassPageSocket");aa.subscribeServer("com.ds.compass",window.parent);aa.addListener("launchApp",function(ac){console.log("Response = "+JSON.stringify(ac));C.unmask(G.parentWidget)});aa.dispatchEvent("onLaunchApp",{appId:"ENOV5MA_AP"},"compassPageSocket")},onFailure:function(Z){console.error("PADWSAccess.completeselection",Z);C.unmask(G.parentWidget)},timeout:0};if(G._isWidget){console.log("isWidget true, initialize PADSettingsMgt and PADUtilsServices");var T=require("DS/PADUtils/PADSettingsMgt");T.set_app_context("enopad");W.app_initialization(function X(){Y.completeselection(V)})}else{Y.completeselection(V)}})})}}}if(this._displayOpenWithCATIAV5(G,R)){var L=this;var N=function(){a.getSecurityContext(z.getTenant(),function(T){M.node.document.withLockedUpdate(function S(){C.mask(L.elements.container,t.openCATIALaunchMessage);var U={objectId:G.contextMenuObject.physicalid,envId:z.getTenant(),contextId:T};require(["DS/i3DXCompassServices/i3DXCompassPubSub"],function(V){V.publish("setObject",U);var W=new o.Socket("compassPageSocket");W.subscribeServer("com.ds.compass",window.parent);W.addListener("launchApp",function(X){console.log("Response = "+JSON.stringify(X));C.unmask(L.elements.container)});W.dispatchEvent("onLaunchApp",{appId:"MAP-CATCDVEAP"},"compassPageSocket")})})})};var D={title:t.OpenWith,label:t.openCATIA,icon:K("ENOV5MA_AP_AppIcon.png","FolderEditor"),type:x,callback:N,submenu:[{type:x,title:t.OpenWithCV5,icon:"url("+h.getWebappsAssetUrl("ENXNav","icons/ENOV5MA_AP_AppIcon.png")+")",action:{"this":G,callback:N}}]};if(e){D.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-export",family:WUXManagedFontIcons.Font3DS,};D.icon=undefined}J.openWith=D}if(E===true){J.Properties={label:t.properties,icon:K("I_CATSSEditorDisplayProperties.png"),callback:function P(){M.node.document.withLockedUpdate(function S(){var T=G.findNode(M.node.data.nodeID);G.showProperties(T)})}}}if(M.node.data.isSelected===false&&require.defined("DS/CompareCmd/CompareCmd")){J.Compare={label:t.compare,icon:K("I_Compare.png"),callback:function P(){M.node.document.withLockedUpdate(function S(){var T=G.findNode(M.node.data.nodeID);var U=G.controller.model.getCurrentNodeID();G.showCompare(U,T)})}}}if(!this._isFolderType(M.node.data.type)){J.ShowDuplicates={label:t.showDuplicates,icon:K("I_Duplicate.png"),callback:function P(){var T=M.node.document;M.node.document.withLockedUpdate(function U(){var V=G.findNode(M.node.data.nodeID);G.showShowDuplicates(V)});T.withLockedUpdate(function S(){G.reframe(false,true)})}}}return J},_createMenuArray:function(F,G){function H(I){var J=G[I];return(!J||typeof J.type==="string")?J:UWA.extend(J,{title:J.label,type:x,action:{"this":this,callback:J.callback}})}function D(I){return I!==undefined}var E=[];if(this._isFolderType(F)){return["Properties","Separator","Delete","Separator","WhereUsed"].map(H).filter(D)}else{return["Properties","Compare","ShowDuplicates","Separator","Maturity","Revise","ReviseFrom","Delete","Duplicate","Separator","WhereUsed","OpenInCV5","openWith"].map(H).filter(D)}},showShowDuplicates:function(E){var D=this.highlightDuplicates(E);if(!D){this.displayInfo(t.noDupesFound);return}this.updateUI(false,false,false,false)},showDelete:function(D){var E=b.getCommand("DeleteHdr",g);E.execute(D)},showMaturity:function(D){var E=b.getCommand("MaturityHdr",g);E.execute(D)},showDuplicate:function(D){var E=b.getCommand("DuplicateHdr",g);E.execute(D)},showOpenInCatia:function(D){var E=this;C.mask(E.elements.container);require(["DS/PADUtils/PADUtilsServices"],function(F){F.open_app({appId:"ENOV5MA_AP"},function(){C.unmask(E.elements.container)})})},showMajorVersion:function(D){var E=b.getCommand("RevisionHdr",g);E.execute(D)},showReviseFrom:function(D){var E=b.getCommand("ReviseFromHdr",g);E.execute(D)},});return i});