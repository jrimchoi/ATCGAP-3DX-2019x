(function(b,a,c){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:true,showCoverageOnHover:true,zoomToBoundsOnClick:true,singleMarkerMode:false,disableClusteringAtZoom:null,removeOutsideVisibleBounds:true,animateAddingMarkers:false,spiderfyDistanceMultiplier:1,chunkedLoading:false,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(d){L.Util.setOptions(this,d);if(!this.options.iconCreateFunction){this.options.iconCreateFunction=this._defaultIconCreateFunction}this._featureGroup=L.featureGroup();this._featureGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this);this._nonPointGroup=L.featureGroup();this._nonPointGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this);this._inZoomAnimation=0;this._needsClustering=[];this._needsRemoving=[];this._currentShownBounds=null;this._queue=[]},addLayer:function(g){if(g instanceof L.LayerGroup){var h=[];for(var f in g._layers){h.push(g._layers[f])}return this.addLayers(h)}if(!g.getLatLng){this._nonPointGroup.addLayer(g);return this}if(!this._map){this._needsClustering.push(g);return this}if(this.hasLayer(g)){return this}if(this._unspiderfy){this._unspiderfy()}this._addLayer(g,this._maxZoom);var d=g,e=this._map.getZoom();if(g.__parent){while(d.__parent._zoom>=e){d=d.__parent}}if(this._currentShownBounds.contains(d.getLatLng())){if(this.options.animateAddingMarkers){this._animationAddLayer(g,d)}else{this._animationAddLayerNonAnimated(g,d)}}return this},removeLayer:function(e){if(e instanceof L.LayerGroup){var f=[];for(var d in e._layers){f.push(e._layers[d])}return this.removeLayers(f)}if(!e.getLatLng){this._nonPointGroup.removeLayer(e);return this}if(!this._map){if(!this._arraySplice(this._needsClustering,e)&&this.hasLayer(e)){this._needsRemoving.push(e)}return this}if(!e.__parent){return this}if(this._unspiderfy){this._unspiderfy();this._unspiderfyLayer(e)}this._removeLayer(e,true);if(this._featureGroup.hasLayer(e)){this._featureGroup.removeLayer(e);if(e.setOpacity){e.setOpacity(1)}}return this},addLayers:function(h){var d=this._featureGroup,n=this._nonPointGroup,q=this.options.chunkedLoading,o=this.options.chunkInterval,r=this.options.chunkProgress,p,k,g,f;if(this._map){var j=0,s=(new Date()).getTime();var e=L.bind(function(){var t=(new Date()).getTime();for(;j<h.length;j++){if(q&&j%200===0){var i=(new Date()).getTime()-t;if(i>o){break}}f=h[j];if(!f.getLatLng){n.addLayer(f);continue}if(this.hasLayer(f)){continue}this._addLayer(f,this._maxZoom);if(f.__parent){if(f.__parent.getChildCount()===2){var m=f.__parent.getAllChildMarkers(),l=m[0]===f?m[1]:m[0];d.removeLayer(l)}}}if(r){r(j,h.length,(new Date()).getTime()-s)}if(j===h.length){this._featureGroup.eachLayer(function(u){if(u instanceof L.MarkerCluster&&u._iconNeedsUpdate){u._updateIcon()}});this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)}else{setTimeout(e,this.options.chunkDelay)}},this);e()}else{p=[];for(k=0,g=h.length;k<g;k++){f=h[k];if(!f.getLatLng){n.addLayer(f);continue}if(this.hasLayer(f)){continue}p.push(f)}this._needsClustering=this._needsClustering.concat(p)}return this},removeLayers:function(h){var g,f,d,e=this._featureGroup,j=this._nonPointGroup;if(!this._map){for(g=0,f=h.length;g<f;g++){d=h[g];this._arraySplice(this._needsClustering,d);j.removeLayer(d)}return this}for(g=0,f=h.length;g<f;g++){d=h[g];if(!d.__parent){j.removeLayer(d);continue}this._removeLayer(d,true,true);if(e.hasLayer(d)){e.removeLayer(d);if(d.setOpacity){d.setOpacity(1)}}}this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds);e.eachLayer(function(i){if(i instanceof L.MarkerCluster){i._updateIcon()}});return this},clearLayers:function(){if(!this._map){this._needsClustering=[];delete this._gridClusters;delete this._gridUnclustered}if(this._noanimationUnspiderfy){this._noanimationUnspiderfy()}this._featureGroup.clearLayers();this._nonPointGroup.clearLayers();this.eachLayer(function(d){delete d.__parent});if(this._map){this._generateInitialClusters()}return this},getBounds:function(){var e=new L.LatLngBounds();if(this._topClusterLevel){e.extend(this._topClusterLevel._bounds)}for(var d=this._needsClustering.length-1;d>=0;d--){e.extend(this._needsClustering[d].getLatLng())}e.extend(this._nonPointGroup.getBounds());return e},eachLayer:function(g,e){var f=this._needsClustering.slice(),d;if(this._topClusterLevel){this._topClusterLevel.getAllChildMarkers(f)}for(d=f.length-1;d>=0;d--){g.call(e,f[d])}this._nonPointGroup.eachLayer(g,e)},getLayers:function(){var d=[];this.eachLayer(function(e){d.push(e)});return d},getLayer:function(e){var d=null;this.eachLayer(function(f){if(L.stamp(f)===e){d=f}});return d},hasLayer:function(e){if(!e){return false}var d,f=this._needsClustering;for(d=f.length-1;d>=0;d--){if(f[d]===e){return true}}f=this._needsRemoving;for(d=f.length-1;d>=0;d--){if(f[d]===e){return false}}return !!(e.__parent&&e.__parent._group===this)||this._nonPointGroup.hasLayer(e)},zoomToShowLayer:function(e,g){var f=function(){if((e._icon||e.__parent._icon)&&!this._inZoomAnimation){this._map.off("moveend",f,this);this.off("animationend",f,this);if(e._icon){g()}else{if(e.__parent._icon){var h=function(){this.off("spiderfied",h,this);g()};this.on("spiderfied",h,this);e.__parent.spiderfy()}}}};if(e._icon&&this._map.getBounds().contains(e.getLatLng())){g()}else{if(e.__parent._zoom<this._map.getZoom()){this._map.on("moveend",f,this);this._map.panTo(e.getLatLng())}else{var d=function(){this._map.off("movestart",d,this);d=null};this._map.on("movestart",d,this);this._map.on("moveend",f,this);this.on("animationend",f,this);e.__parent.zoomToBounds();if(d){f.call(this)}}}},onAdd:function(g){this._map=g;var f,d,e;if(!isFinite(this._map.getMaxZoom())){throw"Map has no maxZoom specified"}this._featureGroup.onAdd(g);this._nonPointGroup.onAdd(g);if(!this._gridClusters){this._generateInitialClusters()}for(f=0,d=this._needsRemoving.length;f<d;f++){e=this._needsRemoving[f];this._removeLayer(e,true)}this._needsRemoving=[];this._zoom=this._map.getZoom();this._currentShownBounds=this._getExpandedVisibleBounds();this._map.on("zoomend",this._zoomEnd,this);this._map.on("moveend",this._moveEnd,this);if(this._spiderfierOnAdd){this._spiderfierOnAdd()}this._bindEvents();d=this._needsClustering;this._needsClustering=[];this.addLayers(d)},onRemove:function(d){d.off("zoomend",this._zoomEnd,this);d.off("moveend",this._moveEnd,this);this._unbindEvents();this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","");if(this._spiderfierOnRemove){this._spiderfierOnRemove()}this._hideCoverage();this._featureGroup.onRemove(d);this._nonPointGroup.onRemove(d);this._featureGroup.clearLayers();this._map=null},getVisibleParent:function(d){var e=d;while(e&&!e._icon){e=e.__parent}return e||null},_arraySplice:function(e,f){for(var d=e.length-1;d>=0;d--){if(e[d]===f){e.splice(d,1);return true}}},_removeLayer:function(j,g,l){var h=this._gridClusters,f=this._gridUnclustered,d=this._featureGroup,e=this._map;if(g){for(var k=this._maxZoom;k>=0;k--){if(!f[k].removeObject(j,e.project(j.getLatLng(),k))){break}}}var m=j.__parent,i=m._markers,n;this._arraySplice(i,j);while(m){m._childCount--;if(m._zoom<0){break}else{if(g&&m._childCount<=1){n=m._markers[0]===j?m._markers[1]:m._markers[0];h[m._zoom].removeObject(m,e.project(m._cLatLng,m._zoom));f[m._zoom].addObject(n,e.project(n.getLatLng(),m._zoom));this._arraySplice(m.__parent._childClusters,m);m.__parent._markers.push(n);n.__parent=m.__parent;if(m._icon){d.removeLayer(m);if(!l){d.addLayer(n)}}}else{m._recalculateBounds();if(!l||!m._icon){m._updateIcon()}}}m=m.__parent}delete j.__parent},_isOrIsParent:function(e,d){while(d){if(e===d){return true}d=d.parentNode}return false},_propagateEvent:function(d){if(d.layer instanceof L.MarkerCluster){if(d.originalEvent&&this._isOrIsParent(d.layer._icon,d.originalEvent.relatedTarget)){return}d.type="cluster"+d.type}this.fire(d.type,d)},_defaultIconCreateFunction:function(d){var e=d.getChildCount();var f=" marker-cluster-";if(e<10){f+="small"}else{if(e<100){f+="medium"}else{f+="large"}}return new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+f,iconSize:new L.Point(40,40)})},_bindEvents:function(){var g=this._map,e=this.options.spiderfyOnMaxZoom,d=this.options.showCoverageOnHover,f=this.options.zoomToBoundsOnClick;if(e||f){this.on("clusterclick",this._zoomOrSpiderfy,this)}if(d){this.on("clustermouseover",this._showCoverage,this);this.on("clustermouseout",this._hideCoverage,this);g.on("zoomend",this._hideCoverage,this)}},_zoomOrSpiderfy:function(f){var d=this._map;if(d.getMaxZoom()===d.getZoom()){if(this.options.spiderfyOnMaxZoom){f.layer.spiderfy()}}else{if(this.options.zoomToBoundsOnClick){f.layer.zoomToBounds()}}if(f.originalEvent&&f.originalEvent.keyCode===13){d._container.focus()}},_showCoverage:function(f){var d=this._map;if(this._inZoomAnimation){return}if(this._shownPolygon){d.removeLayer(this._shownPolygon)}if(f.layer.getChildCount()>2&&f.layer!==this._spiderfied){this._shownPolygon=new L.Polygon(f.layer.getConvexHull(),this.options.polygonOptions);d.addLayer(this._shownPolygon)}},_hideCoverage:function(){if(this._shownPolygon){this._map.removeLayer(this._shownPolygon);this._shownPolygon=null}},_unbindEvents:function(){var e=this.options.spiderfyOnMaxZoom,d=this.options.showCoverageOnHover,g=this.options.zoomToBoundsOnClick,f=this._map;if(e||g){this.off("clusterclick",this._zoomOrSpiderfy,this)}if(d){this.off("clustermouseover",this._showCoverage,this);this.off("clustermouseout",this._hideCoverage,this);f.off("zoomend",this._hideCoverage,this)}},_zoomEnd:function(){if(!this._map){return}this._mergeSplitClusters();this._zoom=this._map._zoom;this._currentShownBounds=this._getExpandedVisibleBounds()},_moveEnd:function(){if(this._inZoomAnimation){return}var d=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,d);this._topClusterLevel._recursivelyAddChildrenToMap(null,this._map._zoom,d);this._currentShownBounds=d;return},_generateInitialClusters:function(){var e=this._map.getMaxZoom(),d=this.options.maxClusterRadius,f=d;if(typeof d!=="function"){f=function(){return d}}if(this.options.disableClusteringAtZoom){e=this.options.disableClusteringAtZoom-1}this._maxZoom=e;this._gridClusters={};this._gridUnclustered={};for(var g=e;g>=0;g--){this._gridClusters[g]=new L.DistanceGrid(f(g));this._gridUnclustered[g]=new L.DistanceGrid(f(g))}this._topClusterLevel=new L.MarkerCluster(this,-1)},_addLayer:function(h,m){var f=this._gridClusters,d=this._gridUnclustered,l,i;if(this.options.singleMarkerMode){h.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[h]}})}for(;m>=0;m--){l=this._map.project(h.getLatLng(),m);var e=f[m].getNearObject(l);if(e){e._addChild(h);h.__parent=e;return}e=d[m].getNearObject(l);if(e){var j=e.__parent;if(j){this._removeLayer(e,false)}var k=new L.MarkerCluster(this,m,e,h);f[m].addObject(k,this._map.project(k._cLatLng,m));e.__parent=k;h.__parent=k;var g=k;for(i=m-1;i>j._zoom;i--){g=new L.MarkerCluster(this,i,g);f[i].addObject(g,this._map.project(e.getLatLng(),i))}j._addChild(g);for(i=m;i>=0;i--){if(!d[i].removeObject(e,this._map.project(e.getLatLng(),i))){break}}return}d[m].addObject(h,l)}this._topClusterLevel._addChild(h);h.__parent=this._topClusterLevel;return},_enqueue:function(d){this._queue.push(d);if(!this._queueTimeout){this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300)}},_processQueue:function(){for(var d=0;d<this._queue.length;d++){this._queue[d].call(this)}this._queue.length=0;clearTimeout(this._queueTimeout);this._queueTimeout=null},_mergeSplitClusters:function(){this._processQueue();if(this._zoom<this._map._zoom&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())){this._animationStart();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds());this._animationZoomIn(this._zoom,this._map._zoom)}else{if(this._zoom>this._map._zoom){this._animationStart();this._animationZoomOut(this._zoom,this._map._zoom)}else{this._moveEnd()}}},_getExpandedVisibleBounds:function(){if(!this.options.removeOutsideVisibleBounds){return this._map.getBounds()}var i=this._map,e=i.getBounds(),d=e._southWest,h=e._northEast,g=L.Browser.mobile?0:Math.abs(d.lat-h.lat),f=L.Browser.mobile?0:Math.abs(d.lng-h.lng);return new L.LatLngBounds(new L.LatLng(d.lat-g,d.lng-f,true),new L.LatLng(h.lat+g,h.lng+f,true))},_animationAddLayerNonAnimated:function(d,e){if(e===d){this._featureGroup.addLayer(d)}else{if(e._childCount===2){e._addToMap();var f=e.getAllChildMarkers();this._featureGroup.removeLayer(f[0]);this._featureGroup.removeLayer(f[1])}else{e._updateIcon()}}}});L.MarkerClusterGroup.include(!L.DomUtil.TRANSITION?{_animationStart:function(){},_animationZoomIn:function(e,d){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,e);this._topClusterLevel._recursivelyAddChildrenToMap(null,d,this._getExpandedVisibleBounds());this.fire("animationend")},_animationZoomOut:function(e,d){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,e);this._topClusterLevel._recursivelyAddChildrenToMap(null,d,this._getExpandedVisibleBounds());this.fire("animationend")},_animationAddLayer:function(d,e){this._animationAddLayerNonAnimated(d,e)}}:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim";this._inZoomAnimation++},_animationEnd:function(){if(this._map){this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")}this._inZoomAnimation--;this.fire("animationend")},_animationZoomIn:function(h,f){var g=this._getExpandedVisibleBounds(),d=this._featureGroup,e;this._topClusterLevel._recursively(g,h,0,function(l){var j=l._latlng,k=l._markers,i;if(!g.contains(j)){j=null}if(l._isSingleParent()&&h+1===f){d.removeLayer(l);l._recursivelyAddChildrenToMap(null,f,g)}else{l.setOpacity(0);l._recursivelyAddChildrenToMap(j,f,g)}for(e=k.length-1;e>=0;e--){i=k[e];if(!g.contains(i._latlng)){d.removeLayer(i)}}});this._forceLayout();this._topClusterLevel._recursivelyBecomeVisible(g,f);d.eachLayer(function(i){if(!(i instanceof L.MarkerCluster)&&i._icon){i.setOpacity(1)}});this._topClusterLevel._recursively(g,h,f,function(i){i._recursivelyRestoreChildPositions(f)});this._enqueue(function(){this._topClusterLevel._recursively(g,h,0,function(i){d.removeLayer(i);i.setOpacity(1)});this._animationEnd()})},_animationZoomOut:function(e,d){this._animationZoomOutSingle(this._topClusterLevel,e-1,d);this._topClusterLevel._recursivelyAddChildrenToMap(null,d,this._getExpandedVisibleBounds());this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,e,this._getExpandedVisibleBounds())},_animationZoomOutSingle:function(d,h,e){var g=this._getExpandedVisibleBounds();d._recursivelyAnimateChildrenInAndAddSelfToMap(g,h+1,e);var f=this;this._forceLayout();d._recursivelyBecomeVisible(g,e);this._enqueue(function(){if(d._childCount===1){var i=d._markers[0];i.setLatLng(i.getLatLng());if(i.setOpacity){i.setOpacity(1)}}else{d._recursively(g,e,0,function(j){j._recursivelyRemoveChildrenFromMap(g,h+1)})}f._animationEnd()})},_animationAddLayer:function(e,g){var f=this,d=this._featureGroup;d.addLayer(e);if(g!==e){if(g._childCount>2){g._updateIcon();this._forceLayout();this._animationStart();e._setPos(this._map.latLngToLayerPoint(g.getLatLng()));e.setOpacity(0);this._enqueue(function(){d.removeLayer(e);e.setOpacity(1);f._animationEnd()})}else{this._forceLayout();f._animationStart();f._animationZoomOutSingle(g,this._map.getMaxZoom(),this._map.getZoom())}}},_forceLayout:function(){L.Util.falseFn(a.body.offsetWidth)}});L.markerClusterGroup=function(d){return new L.MarkerClusterGroup(d)};L.MarkerCluster=L.Marker.extend({initialize:function(g,f,e,d){L.Marker.prototype.initialize.call(this,e?(e._cLatLng||e.getLatLng()):new L.LatLng(0,0),{icon:this});this._group=g;this._zoom=f;this._markers=[];this._childClusters=[];this._childCount=0;this._iconNeedsUpdate=true;this._bounds=new L.LatLngBounds();if(e){this._addChild(e)}if(d){this._addChild(d)}},getAllChildMarkers:function(f){f=f||[];for(var e=this._childClusters.length-1;e>=0;e--){this._childClusters[e].getAllChildMarkers(f)}for(var d=this._markers.length-1;d>=0;d--){f.push(this._markers[d])}return f},getChildCount:function(){return this._childCount},zoomToBounds:function(){var g=this._childClusters.slice(),k=this._group._map,j=k.getBoundsZoom(this._bounds),f=this._zoom+1,h=k.getZoom(),e;while(g.length>0&&j>f){f++;var d=[];for(e=0;e<g.length;e++){d=d.concat(g[e]._childClusters)}g=d}if(j>f){this._group._map.setView(this._latlng,f)}else{if(j<=h){this._group._map.setView(this._latlng,h+1)}else{this._group._map.fitBounds(this._bounds)}}},getBounds:function(){var d=new L.LatLngBounds();d.extend(this._bounds);return d},_updateIcon:function(){this._iconNeedsUpdate=true;if(this._icon){this.setIcon(this)}},createIcon:function(){if(this._iconNeedsUpdate){this._iconObj=this._group.options.iconCreateFunction(this);this._iconNeedsUpdate=false}return this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(d,e){this._iconNeedsUpdate=true;this._expandBounds(d);if(d instanceof L.MarkerCluster){if(!e){this._childClusters.push(d);d.__parent=this}this._childCount+=d._childCount}else{if(!e){this._markers.push(d)}this._childCount++}if(this.__parent){this.__parent._addChild(d,true)}},_expandBounds:function(f){var g,e=f._wLatLng||f._latlng;if(f instanceof L.MarkerCluster){this._bounds.extend(f._bounds);g=f._childCount}else{this._bounds.extend(e);g=1}if(!this._cLatLng){this._cLatLng=f._cLatLng||e}var d=this._childCount+g;if(!this._wLatLng){this._latlng=this._wLatLng=new L.LatLng(e.lat,e.lng)}else{this._wLatLng.lat=(e.lat*g+this._wLatLng.lat*this._childCount)/d;this._wLatLng.lng=(e.lng*g+this._wLatLng.lng*this._childCount)/d}},_addToMap:function(d){if(d){this._backupLatlng=this._latlng;this.setLatLng(d)}this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(f,d,e){this._recursively(f,0,e-1,function(k){var j=k._markers,h,g;for(h=j.length-1;h>=0;h--){g=j[h];if(g._icon){g._setPos(d);g.setOpacity(0)}}},function(k){var i=k._childClusters,h,g;for(h=i.length-1;h>=0;h--){g=i[h];if(g._icon){g._setPos(d);g.setOpacity(0)}}})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(f,e,d){this._recursively(f,d,0,function(g){g._recursivelyAnimateChildrenIn(f,g._group._map.latLngToLayerPoint(g.getLatLng()).round(),e);if(g._isSingleParent()&&e-1===d){g.setOpacity(1);g._recursivelyRemoveChildrenFromMap(f,e)}else{g.setOpacity(0)}g._addToMap()})},_recursivelyBecomeVisible:function(d,e){this._recursively(d,0,e,null,function(f){f.setOpacity(1)})},_recursivelyAddChildrenToMap:function(d,f,e){this._recursively(e,-1,f,function(j){if(f===j._zoom){return}for(var h=j._markers.length-1;h>=0;h--){var g=j._markers[h];if(!e.contains(g._latlng)){continue}if(d){g._backupLatlng=g.getLatLng();g.setLatLng(d);if(g.setOpacity){g.setOpacity(0)}}j._group._featureGroup.addLayer(g)}},function(g){g._addToMap(d)})},_recursivelyRestoreChildPositions:function(h){for(var g=this._markers.length-1;g>=0;g--){var d=this._markers[g];if(d._backupLatlng){d.setLatLng(d._backupLatlng);delete d._backupLatlng}}if(h-1===this._zoom){for(var f=this._childClusters.length-1;f>=0;f--){this._childClusters[f]._restorePosition()}}else{for(var e=this._childClusters.length-1;e>=0;e--){this._childClusters[e]._recursivelyRestoreChildPositions(h)}}},_restorePosition:function(){if(this._backupLatlng){this.setLatLng(this._backupLatlng);delete this._backupLatlng}},_recursivelyRemoveChildrenFromMap:function(e,h,g){var d,f;this._recursively(e,-1,h-1,function(i){for(f=i._markers.length-1;f>=0;f--){d=i._markers[f];if(!g||!g.contains(d._latlng)){i._group._featureGroup.removeLayer(d);if(d.setOpacity){d.setOpacity(1)}}}},function(i){for(f=i._childClusters.length-1;f>=0;f--){d=i._childClusters[f];if(!g||!g.contains(d._latlng)){i._group._featureGroup.removeLayer(d);if(d.setOpacity){d.setOpacity(1)}}}})},_recursively:function(k,j,f,d,g){var h=this._childClusters,m=this._zoom,e,l;if(j>m){for(e=h.length-1;e>=0;e--){l=h[e];if(k.intersects(l._bounds)){l._recursively(k,j,f,d,g)}}}else{if(d){d(this)}if(g&&this._zoom===f){g(this)}if(f>m){for(e=h.length-1;e>=0;e--){l=h[e];if(k.intersects(l._bounds)){l._recursively(k,j,f,d,g)}}}}},_recalculateBounds:function(){var f=this._markers,e=this._childClusters,d;this._bounds=new L.LatLngBounds();delete this._wLatLng;for(d=f.length-1;d>=0;d--){this._expandBounds(f[d])}for(d=e.length-1;d>=0;d--){this._expandBounds(e[d])}},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.DistanceGrid=function(d){this._cellSize=d;this._sqCellSize=d*d;this._grid={};this._objectPoint={}};L.DistanceGrid.prototype={addObject:function(i,f){var e=this._getCoord(f.x),k=this._getCoord(f.y),h=this._grid,j=h[k]=h[k]||{},d=j[e]=j[e]||[],g=L.Util.stamp(i);this._objectPoint[g]=f;d.push(i)},updateObject:function(e,d){this.removeObject(e);this.addObject(e,d)},removeObject:function(e,k){var j=this._getCoord(k.x),h=this._getCoord(k.y),d=this._grid,m=d[h]=d[h]||{},l=m[j]=m[j]||[],f,g;delete this._objectPoint[L.Util.stamp(e)];for(f=0,g=l.length;f<g;f++){if(l[f]===e){l.splice(f,1);if(g===1){delete m[j]}return true}}},eachObject:function(n,e){var h,g,f,m,p,o,l,d=this._grid;for(h in d){p=d[h];for(g in p){o=p[g];for(f=0,m=o.length;f<m;f++){l=n.call(e,o[f]);if(l){f--;m--}}}}},getNearObject:function(q){var p=this._getCoord(q.x),o=this._getCoord(q.y),h,f,e,t,s,l,g,n,r=this._objectPoint,m=this._sqCellSize,d=null;for(h=o-1;h<=o+1;h++){t=this._grid[h];if(t){for(f=p-1;f<=p+1;f++){s=t[f];if(s){for(e=0,l=s.length;e<l;e++){g=s[e];n=this._sqDist(r[L.Util.stamp(g)],q);if(n<m){m=n;d=g}}}}}}return d},_getCoord:function(d){return Math.floor(d/this._cellSize)},_sqDist:function(g,f){var e=f.x-g.x,d=f.y-g.y;return e*e+d*d}};(function(){L.QuickHull={getDistant:function(f,g){var d=g[1].lat-g[0].lat,e=g[0].lng-g[1].lng;return(e*(f.lat-g[0].lat)+d*(f.lng-g[0].lng))},findMostDistantPointFromBaseLine:function(f,l){var j=0,e=null,h=[],g,k,m;for(g=l.length-1;g>=0;g--){k=l[g];m=this.getDistant(k,f);if(m>0){h.push(k)}else{continue}if(m>j){j=m;e=k}}return{maxPoint:e,newPoints:h}},buildConvexHull:function(d,g){var f=[],e=this.findMostDistantPointFromBaseLine(d,g);if(e.maxPoint){f=f.concat(this.buildConvexHull([d[0],e.maxPoint],e.newPoints));f=f.concat(this.buildConvexHull([e.maxPoint,d[1]],e.newPoints));return f}else{return[d[0]]}},getConvexHull:function(j){var k=false,l=false,d=null,h=null,e;for(e=j.length-1;e>=0;e--){var g=j[e];if(k===false||g.lat>k){d=g;k=g.lat}if(l===false||g.lat<l){h=g;l=g.lat}}var f=[].concat(this.buildConvexHull([h,d],j),this.buildConvexHull([d,h],j));return f}}}());L.MarkerCluster.include({getConvexHull:function(){var g=this.getAllChildMarkers(),e=[],f,d;for(d=g.length-1;d>=0;d--){f=g[d].getLatLng();e.push(f)}return L.QuickHull.getConvexHull(e)}});L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied===this||this._group._inZoomAnimation){return}var h=this.getAllChildMarkers(),g=this._group,f=g._map,d=f.latLngToLayerPoint(this._latlng),e;this._group._unspiderfy();this._group._spiderfied=this;if(h.length>=this._circleSpiralSwitchover){e=this._generatePointsSpiral(h.length,d)}else{d.y+=10;e=this._generatePointsCircle(h.length,d)}this._animationSpiderfy(h,e)},unspiderfy:function(d){if(this._group._inZoomAnimation){return}this._animationUnspiderfy(d);this._group._spiderfied=null},_generatePointsCircle:function(h,l){var d=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+h),j=d/this._2PI,g=this._2PI/h,f=[],e,k;f.length=h;for(e=h-1;e>=0;e--){k=this._circleStartAngle+e*g;f[e]=new L.Point(l.x+j*Math.cos(k),l.y+j*Math.sin(k))._round()}return f},_generatePointsSpiral:function(g,l){var h=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthStart,f=this._group.options.spiderfyDistanceMultiplier*this._spiralFootSeparation,j=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthFactor,k=0,e=[],d;e.length=g;for(d=g-1;d>=0;d--){k+=f/h+d*0.0005;e[d]=new L.Point(l.x+h*Math.cos(k),l.y+h*Math.sin(k))._round();h+=this._2PI*j/k}return e},_noanimationUnspiderfy:function(){var j=this._group,h=j._map,e=j._featureGroup,g=this.getAllChildMarkers(),d,f;this.setOpacity(1);for(f=g.length-1;f>=0;f--){d=g[f];e.removeLayer(d);if(d._preSpiderfyLatlng){d.setLatLng(d._preSpiderfyLatlng);delete d._preSpiderfyLatlng}if(d.setZIndexOffset){d.setZIndexOffset(0)}if(d._spiderLeg){h.removeLayer(d._spiderLeg);delete d._spiderLeg}}j._spiderfied=null}});L.MarkerCluster.include(!L.DomUtil.TRANSITION?{_animationSpiderfy:function(f,j){var l=this._group,e=l._map,d=l._featureGroup,h,g,n,k;for(h=f.length-1;h>=0;h--){k=e.layerPointToLatLng(j[h]);g=f[h];g._preSpiderfyLatlng=g._latlng;g.setLatLng(k);if(g.setZIndexOffset){g.setZIndexOffset(1000000)}d.addLayer(g);n=new L.Polyline([this._latlng,k],{weight:1.5,color:"#222"});e.addLayer(n);g._spiderLeg=n}this.setOpacity(0.3);l.fire("spiderfied")},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}:{SVG_ANIMATION:(function(){return a.createElementNS("http://www.w3.org/2000/svg","animate").toString().indexOf("SVGAnimate")>-1}()),_animationSpiderfy:function(j,o){var r=this,t=this._group,f=t._map,d=t._featureGroup,p=f.latLngToLayerPoint(this._latlng),n,h,s,q;for(n=j.length-1;n>=0;n--){h=j[n];if(h.setOpacity){h.setZIndexOffset(1000000);h.setOpacity(0);d.addLayer(h);h._setPos(p)}else{d.addLayer(h)}}t._forceLayout();t._animationStart();var e=L.Path.SVG?0:0.3,l=L.Path.SVG_NS;for(n=j.length-1;n>=0;n--){q=f.layerPointToLatLng(o[n]);h=j[n];h._preSpiderfyLatlng=h._latlng;h.setLatLng(q);if(h.setOpacity){h.setOpacity(1)}s=new L.Polyline([r._latlng,q],{weight:1.5,color:"#222",opacity:e});f.addLayer(s);h._spiderLeg=s;if(!L.Path.SVG||!this.SVG_ANIMATION){continue}var g=s._path.getTotalLength();s._path.setAttribute("stroke-dasharray",g+","+g);var k=a.createElementNS(l,"animate");k.setAttribute("attributeName","stroke-dashoffset");k.setAttribute("begin","indefinite");k.setAttribute("from",g);k.setAttribute("to",0);k.setAttribute("dur",0.25);s._path.appendChild(k);k.beginElement();k=a.createElementNS(l,"animate");k.setAttribute("attributeName","stroke-opacity");k.setAttribute("attributeName","stroke-opacity");k.setAttribute("begin","indefinite");k.setAttribute("from",0);k.setAttribute("to",0.5);k.setAttribute("dur",0.25);s._path.appendChild(k);k.beginElement()}r.setOpacity(0.3);if(L.Path.SVG){this._group._forceLayout();for(n=j.length-1;n>=0;n--){h=j[n]._spiderLeg;h.options.opacity=0.5;h._path.setAttribute("stroke-opacity",0.5)}}setTimeout(function(){t._animationEnd();t.fire("spiderfied")},200)},_animationUnspiderfy:function(o){var n=this._group,e=n._map,d=n._featureGroup,k=o?e._latLngToNewLayerPoint(this._latlng,o.zoom,o.center):e.latLngToLayerPoint(this._latlng),f=this.getAllChildMarkers(),j=L.Path.SVG&&this.SVG_ANIMATION,g,h,l;n._animationStart();this.setOpacity(1);for(h=f.length-1;h>=0;h--){g=f[h];if(!g._preSpiderfyLatlng){continue}g.setLatLng(g._preSpiderfyLatlng);delete g._preSpiderfyLatlng;if(g.setOpacity){g._setPos(k);g.setOpacity(0)}else{d.removeLayer(g)}if(j){l=g._spiderLeg._path.childNodes[0];l.setAttribute("to",l.getAttribute("from"));l.setAttribute("from",0);l.beginElement();l=g._spiderLeg._path.childNodes[1];l.setAttribute("from",0.5);l.setAttribute("to",0);l.setAttribute("stroke-opacity",0);l.beginElement();g._spiderLeg._path.setAttribute("stroke-opacity",0)}}setTimeout(function(){var i=0;for(h=f.length-1;h>=0;h--){g=f[h];if(g._spiderLeg){i++}}for(h=f.length-1;h>=0;h--){g=f[h];if(!g._spiderLeg){continue}if(g.setOpacity){g.setOpacity(1);g.setZIndexOffset(0)}if(i>1){d.removeLayer(g)}e.removeLayer(g._spiderLeg);delete g._spiderLeg}n._animationEnd()},200)}});L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this);if(this._map.options.zoomAnimation){this._map.on("zoomstart",this._unspiderfyZoomStart,this)}this._map.on("zoomend",this._noanimationUnspiderfy,this);if(L.Path.SVG&&!L.Browser.touch){this._map._initPathRoot()}},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this);this._map.off("zoomstart",this._unspiderfyZoomStart,this);this._map.off("zoomanim",this._unspiderfyZoomAnim,this);this._unspiderfy()},_unspiderfyZoomStart:function(){if(!this._map){return}this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(d){if(L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")){return}this._map.off("zoomanim",this._unspiderfyZoomAnim,this);this._unspiderfy(d)},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(d){if(this._spiderfied){this._spiderfied.unspiderfy(d)}},_noanimationUnspiderfy:function(){if(this._spiderfied){this._spiderfied._noanimationUnspiderfy()}},_unspiderfyLayer:function(d){if(d._spiderLeg){this._featureGroup.removeLayer(d);d.setOpacity(1);d.setZIndexOffset(0);this._map.removeLayer(d._spiderLeg);delete d._spiderLeg}}})}(window,document));