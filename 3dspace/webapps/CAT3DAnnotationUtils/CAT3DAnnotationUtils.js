/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils",["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/WebappsUtils/WebappsUtils"],function(c,d){var e;var a=d.getWebappsAssetUrl("CAT3DAnnotationUtils","icons/22/");var b={setLoadedAssetType:function(f){e=f},getLoadedAssetType:function(){return e},getNodeInfos:function(f){var g={};if(!f){return null}if(e==="3DXML"){g.name=f.name;if(b.isReference(f)){g.icon=a+"I_Reference.png"}if(b.isRepReference(f)){g.icon=a+"I_Part.png"}}return g},getNodeType:function(g){var f=c.getNodeType(g);if(f){return f}f=g.getType?g.getType():null;if(f){return f}f=g.productType;return f},getNodeID:function(g){if(e==="3DXML"){return g.persistentId}var f=c.getNodeID(g);if(undefined===f&&g.getID){f=g.getID()}return f},getRoots:function(i){if(e!=="3DXML"){return c.getRoots(i)}else{var h=i.getRootBagPath().getChildrenPathes();var f=[];for(var g=0;g<h.length;g++){f.push(h[g].getLastElement(true))}return f}},is3DLeaf:function(f){if(e!=="3DXML"){return c.is3DLeaf(f)}else{return b.isRepReference(f)}},isPLMNode:function(g){if(e!=="3DXML"){return c.isPLMNode(g)}else{var f=b.getNodeType(g);return f!==undefined&&f!==null&&f!==""}},isReference:function(g){if(!g){return undefined}if(e!=="3DXML"){var f=c.isReference(g);if(f){return f}f=g.isPLMReference&&typeof g.isPLMReference==="function"?g.isPLMReference():false;return f}else{return g.productType?(g.productType==="Reference3D"):false}},isRepReference:function(g){if(!g){return undefined}if(e!=="3DXML"){var f=c.isRepReference(g);if(f){return f}f=g.isPLMReference&&typeof g.isPLMRepReference==="function"?g.isPLMRepReference():false;return f}else{return g.productType?(g.productType==="ReferenceRep"):false}},isRepInstance:function(g){if(!g){return undefined}if(e!=="3DXML"){var f=c.isRepInstance(g);if(f){return f}f=g.isPLMReference&&typeof g.isPLMRepInstance==="function"?g.isPLMRepInstance():false;return f}else{return g.productType?(g.productType==="InstanceRep"):false}},isInstance:function(g){if(!g){return undefined}if(e!=="3DXML"){var f=c.isInstance(g);if(f){return f}f=g.isPLMReference&&typeof g.isPLMInstance==="function"?g.isPLMInstance():false;return f}else{return g.productType?(g.productType==="Instance3D"):false}}};return b});define("DS/CAT3DAnnotationUtils/CAT3DAnnotationUnits",["i18n!DS/CAT3DAnnotationUtils/assets/nls/CAT3DAnnotationUtils"],function(b){var a={convert:function(e,d){var g=d;switch(g.toLowerCase()){case"length":g="Length";break;case"area":g="Area";break;case"angle":g="Angle";break;case"volume":g="Volume";break}var c=window&&window.widget?window.widget.getValue(g):null;if(!c){c=a.Types[g].defaultValue}if(a[g]&&a[g][c]){var f=parseFloat((parseFloat(e)*a[g][c].ratio).toFixed(3));return f.toString()+" "+a[g][c].nls}return parseFloat(e).toString()+" "+a[g][c].nls},Types:{Length:{name:"Length",defaultValue:"mm"},Angle:{name:"Angle",defaultValue:"deg"},Volume:{name:"Volume",defaultValue:"mm3"},Area:{name:"Area",defaultValue:"mm2"}},Length:{mm:{name:"mm",nls:b.units.mm,ratio:Math.pow(10,3)},cm:{name:"cm",nls:b.units.cm,ratio:Math.pow(10,2)},m:{name:"m",nls:b.units.m,ratio:1},km:{name:"km",nls:b.units.km,ratio:Math.pow(10,-3)},inch:{name:"inch",nls:b.units.inch,ratio:Math.pow(10,3)/25.4},foot:{name:"foot",nls:b.units.foot,ratio:Math.pow(10,3)/304.8}},Angle:{deg:{name:"deg",nls:b.units.deg,ratio:180/Math.PI},rad:{name:"rad",nls:b.units.rad,ratio:1}},Volume:{mm3:{name:"mm3",nls:b.units.mm3,ratio:Math.pow(10,9)},cm3:{name:"cm3",nls:b.units.cm3,ratio:Math.pow(10,6)},m3:{name:"m3",nls:b.units.m3,ratio:1},km3:{name:"km3",nls:b.units.km3,ratio:Math.pow(10,-9)},inch3:{name:"inch3",nls:b.units.inch3,ratio:Math.pow(10,9)/16387.064},foot3:{name:"foot3",nls:b.units.foot3,ratio:Math.pow(10,9)/28316846.6}},Area:{mm2:{name:"mm2",nls:b.units.mm2,ratio:Math.pow(10,6)},cm2:{name:"cm2",nls:b.units.cm2,ratio:Math.pow(10,4)},m2:{name:"m2",nls:b.units.m2,ratio:1},km2:{name:"km2",nls:b.units.km2,ratio:Math.pow(10,-6)},inch2:{name:"inch2",nls:b.units.inch2,ratio:Math.pow(10,6)/645.16},foot2:{name:"foot2",nls:b.units.foot2,ratio:Math.pow(10,6)/92903.04}}};return Object.freeze(a)});define("DS/CAT3DAnnotationUtils/CAT3DAnnotationUtilsOptions",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Utils"],function(b,e,c,a){var d=e.singleton(c,{init:function(){var f={};if(window.annotUrlComplementForODT){f=a.parseQuery(window.annotUrlComplementForODT)}if(window.location.search!==""){b.extend(f,a.parseQuery(window.location.search));if(f.widgetDomain){b.extend(f,a.parseQuery(f.widgetDomain))}}var i={};var h=Object.keys(f);for(var g=0;g<h.length;g++){i[h[g]]=true}if("debug_me" in f){i.debug=true}if(window.debug===true){i.debug=true}if(window.CAT3DANN_FILTER_PANEL_VER1===true){i.CAT3DANN_FILTER_PANEL_VER1=true}if(window.CAT3DANN_ASSY_FILTERING===true){i.CAT3DANN_ASSY_FILTERING=true}if(window.testWkb===true){i.testWkb=true}if(parseFloat(window.CAT3DGRID_MAXLABEL)){i.CAT3DGRID_MAXLABEL=parseFloat(window.CAT3DGRID_MAXLABEL)}this.setOptions(i)}});return d});define("DS/CAT3DAnnotationUtils/CAT3DAnnotationStorageController",["UWA/Core","UWA/Controls/Abstract","DS/CoreEvents/ModelEvents","DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils"],function(e,d,c,b){var a=d.singleton({init:function(){var f=new c();this.subscribe=function(l,k){if(l&&k){return f.subscribe({event:l},k)}};this.unsubscribe=function(k){if(k){f.unsubscribe(k)}};this.saveA3EWidgetPref=function(o){if(!o||!o.pref||!(o.path||o.rootLog||o.id)){return}if(!window.widget){return}var k=window.widget.getValue(o.pref);k=k&&e.is(k,"string")?JSON.parse(k):undefined;if(!k){window.widget.addPreference({name:o.pref,type:"hidden"});k=[]}if(o.rootLog){window.widget.setValue(o.pref,JSON.stringify(o.rootLog));return}if(o.id){if(!k.some(function(q){return q===o.id})){k.push(o.id);window.widget.setValue(o.pref,JSON.stringify(k))}return}var p={idPath:g(o.path)};if(o.data){var n=Object.keys(o.data);for(var m=0;m<n.length;m++){p[n[m]]=o.data[n[m]]}}for(var l=k.length-1;l>=0;l--){if(j(k[l].idPath,p.idPath)){k.splice(l,1)}}k.push(p);window.widget.setValue(o.pref,JSON.stringify(k))};this.getA3EWidgetAnnotSetsLoadedPref=function(o){if(!o||!o.path){return}if(!window.widget){return}var k=window.widget.getValue("A3EAnnotSetsLoaded");k=k&&e.is(k,"string")?JSON.parse(k):undefined;if(!k){return}var l=[];var n=g(o.path);for(var m=0;m<k.length;m++){if(i(n,k[m].idPath)){var p=o.path.clone();h(p,k[m].idPath,n.length);l.push({path:p,visibility:k[m].visibility,ctxType:k[m].ctxType})}}return l};this.removeA3EWidgetPref=function(n){if(!n||!n.pref||!(n.path||n.id)){return}if(!window.widget){return}var k=window.widget.getValue(n.pref);k=k&&e.is(k,"string")?JSON.parse(k):undefined;if(!k){return}if(n.id){for(var l=k.length-1;l>=0;l--){if(k[l]===n.id){k.splice(l,1);window.widget.setValue(n.pref,JSON.stringify(k));if(k.length===0){window.widget.deleteValue(n.pref)}}}return}var m=g(n.path);for(var l=k.length-1;l>=0;l--){if(j(k[l].idPath,m)){k.splice(l,1);window.widget.setValue(n.pref,JSON.stringify(k));if(k.length===0){window.widget.deleteValue(n.pref)}}}};this.deleteA3EWidgetPref=function(k){if(!k||!k.pref){return}if(!window.widget){return}window.widget.deleteValue(k.pref)};var g=function(n){var k=[];var m=n.clone();while(m){var l=m.getLastElement(true);if(b.getNodeID(l)){k.unshift(b.getNodeID(l))}m=m.getParentPath()}return k};var i=function(m,k){if(m.length>k.length){return false}for(var l=0;l<m.length;l++){if(m[l]!==k[l]){return false}}return true};var h=function(l,k,n){if(k.length===n-1){return}var p=l.getChildrenPathes();for(var m=0;m<p.length;m++){var o=p[m].getLastElement(true);if(b.getNodeID(o)===k[n]){l.addElement(o);return h(l,k,n+1)}}};var j=function(m,k){if(!m||!k){return false}if(m.length!==k.length){return false}for(var l=0;l<m.length;l++){if(m[l]!==k[l]){return false}}return true};this.setPreference=function(n,m){if(!n){return}var k=localStorage.getItem(n),l=m;switch(n){case"3DAnnotSemStd":if(typeof l!=="string"){return}break;case"FavoriteContextLoadMode":if(l!=="0"&&l!=="1"&&l!=="2"){return}break;case"3DAnnotLoadARMPartsPref":if(typeof l!=="boolean"){return}break;case"3DAnnotDisplayCapturesPref":if(typeof l!=="boolean"){return}break;case"3DAnnotWhiteVectorAsBlack":if(typeof l!=="boolean"){return}break;case"3DAnnotUpdateThumbnailsPref":if(typeof l!=="boolean"){return}break;case"3DAnnotAttributesOrderedList":return;default:if(n.indexOf("3DAnnotSemAttr_")!==-1){if(typeof l!=="boolean"){return}}}if(k!==l){localStorage.setItem(n,l);f.publish({event:"onPreferenceModified",data:{preference:n,value:l},context:this})}};this.getPreference=function(m){if(!m){return}var l=localStorage.getItem(m);switch(m){case"3DAnnotSemStd":return l;case"FavoriteContextLoadMode":l=(l==="0"||l==="2")?l:"1";break;case"3DAnnotLoadARMPartsPref":l=(l==="true")?true:false;break;case"3DAnnotDisplayCapturesPref":l=(l==="true")?true:false;break;case"3DAnnotWhiteVectorAsBlack":l=(l==="false")?false:true;break;case"3DAnnotUpdateThumbnailsPref":l=(l==="false")?false:true;break;case"3DAnnotAttributesOrderedList":var k=l?JSON.parse(l):null;l=k&&e.is(k,"array")?k:["2","tolerances","hyperlinksAndComments","failureModes","navReq","0","1","3","4","5"];break;default:if(m.indexOf("3DAnnotSemAttr_")!==-1){l=(l==="false")?false:true}}return l}}});a.init();return a});