define("DS/egraph/utils",[],function(){var x={};function b(B,p,A){function z(E,F,C){var D;if(E){D=E[F]}switch(typeof D){case"undefined":return C;case B:if(p(D)){return D}}throw new Error("opts."+F+" should be undefined or "+A)}return z}x.finite_number_or_nan_opt=b("number",function n(p){return isFinite(p)||isNaN(p)});x.finite_number_opt=b("number",function n(p){return isFinite(p)},"a finite number");x.pos_nonzero_number_opt=b("number",function n(p){return isFinite(p)&&p>0},"a positive finite number");x.pos_number_opt=b("number",function n(p){return isFinite(p)&&p>=0},"a positive finite number");x.pos_integer_opt=b("number",function n(p){return isFinite(p)&&p>=0&&p===(p|0)},"a positive finite 32 bits integer number");x.string_opt=b("string",function n(){return true},"a string");x.obj_opt=b("object",function n(p){return p!==null},"an object (but not null)");x.function_opt=b("function",function n(){return true},"a function");x.pos_number_or_nan_arg=function m(p,z){if(typeof z!=="number"||(isFinite(z)?z<0:!isNaN(z))){throw new Error(p+" should be either NaN, 0 or a finite positive number")}};x.pos_number_arg=function j(p,z){if(typeof z!=="number"||!isFinite(z)||z<0){throw new Error(p+" should be a finite positive number or 0")}};x.clamp=function k(z,A,p){if(z<A){return A}if(z>p){return p}return z};x.distPt2HLine=function(z,C,B,p,A){if(z<B){return Math.abs(z-B)+Math.abs(C-A)}else{if(z>p){return Math.abs(z-p)+Math.abs(C-A)}else{if(isNaN(z)){return NaN}else{return Math.abs(C-A)}}}};x.distPt2VLine=function(p,C,B,A,z){return x.distPt2HLine(C,p,A,z,B)};x.addClass=function(C,B){var A=C.split(/ +/),z,p;for(z=0,p=A.length;z<p;++z){if(A[z]===B){return C}}if(A[p-1]===""){A[p-1]=B}else{A.push(B)}return A.join(" ")};x.removeClass=function(C,A){var z,B,p;z=C.split(/ +/);for(p=z.length,B=false;p-->0;){if(z[p]===A){B=true;z.splice(p,1)}}return B?z.join(" "):C};x.containsClass=function(B,A){var z=B.split(/ +/),p;for(p=z.length;p-->0;){if(z[p]===A){return true}}return false};x.classListAdd=function(p,z){if(p.classList){p.classList.add(z)}else{if(p instanceof SVGElement){p.className.baseVal=x.addClass(p.className.baseVal,z)}else{p.className=x.addClass(p.className,z)}}};x.classListRemove=function(p,z){if(p.classList){p.classList.remove(z)}else{if(p instanceof SVGElement){p.className.baseVal=x.removeClass(p.className.baseVal,z)}else{p.className=x.removeClass(p.className,z)}}};x.classListContains=function(p,z){if(p.classList){return p.classList.contains(z)}else{if(p instanceof SVGElement){return x.containsClass(p.className.baseVal,z)}else{return x.containsClass(p.className,z)}}};x.inherit=function(z,p){z.prototype=Object.create(p.prototype,{constructor:{value:z,enumerable:false}})};x.mix=function(B,A){var z;for(z in A){if(A.hasOwnProperty(z)){B[z]=A[z]}}};x.applyMixin=function(B,p){if(typeof B!=="function"||typeof p!=="function"){throw new Error("parameters must be constructors (i.e. functions)")}var z,A;z=p.prototype;A=B.prototype;Object.keys(z).forEach(function(C){Object.defineProperty(A,C,Object.getOwnPropertyDescriptor(z,C))})};x.closestSide=function(p,G,E){var D=[x.distPt2HLine(G,E,p.actualLeft,p.actualLeft+p.actualWidth,p.actualTop),x.distPt2HLine(G,E,p.actualLeft,p.actualLeft+p.actualWidth,p.actualTop+p.actualHeight),x.distPt2VLine(G,E,p.actualLeft,p.actualTop,p.actualTop+p.actualHeight),x.distPt2VLine(G,E,p.actualLeft+p.actualWidth,p.actualTop,p.actualTop+p.actualHeight)],A,I,B,z,C,H,F;A=D[0];I=0;for(B=1;B<4;++B){if(D[B]<A){A=D[B];I=B}}if(I<2){z=G-p.actualLeft;C=p.actualWidth}else{z=E-p.actualTop;C=p.actualHeight}if(I<2){H=z+p.actualLeft;if(I===0){F=p.actualTop}else{F=p.actualTop+p.actualHeight}}else{F=z+p.actualTop;if(I===2){H=p.actualLeft}else{H=p.actualLeft+p.actualWidth}}return{v:A,idx:I,offset:z,0:H,1:F}};x.isInNode=function(z,p,B,A){A=Number(A);return p>=z.actualLeft-A&&p<=z.actualLeft+z.actualWidth+A&&B>=z.actualTop-A&&B<=z.actualTop+z.actualHeight+A};x.areIntervalsOverlapping=function h(z,B,p,A){return A>=z&&p<=B};x.isIntervalIncluded=function g(z,B,p,A){return p<=z&&B<=A};x.areRectsOverlapping=function s(B,F,A,E,D,z,C,p){var G;if(B>A){G=B;B=A;A=G}if(F>E){G=F;F=E;E=G}if(D>C){G=D;D=C;C=G}if(z>p){G=z;z=p;p=G}return x.areIntervalsOverlapping(B,A,D,C)&&x.areIntervalsOverlapping(F,E,z,p)};x.isSegmentIntersectingRect=function c(H,F,E,D,z,I,p,G){function C(M){return(H*(D-M)-E*(F-M))/(D-F)}var L,B,A,K,J;if(H>E){H=-H;E=-E;z=-z;p=-p}if(F>D){F=-F;D=-D;I=-I;G=-G}if(z>p){L=z;z=p;p=L}if(I>G){L=I;I=G;G=L}if(H<z){B=-1}else{if(H>p){B=1}else{B=0}}if(F<I){A=-1}else{if(F>G){A=1}else{A=0}}if(E<z){K=-1}else{if(E>p){K=1}else{K=0}}if(D<I){J=-1}else{if(D>G){J=1}else{J=0}}if(B===1){return false}if(B===0){if(A===1){return false}if(A===0){return true}if(K===0){return J>=0}if(J===-1){return false}return C(I)<=p}if(B===-1){if(A===1){return false}if(A===0){if(J===0){return K>=0}if(K===-1){return false}return C(G)>=z}if(K===-1){return false}if(J===-1){return false}if(J===0){if(K===0){return true}return C(I)<=p}if(K===0){return C(G)>=z}if(C(I)>p||C(G)<z){return false}return true}};var y=Math.pow(2,-53);x.isBezierIntersectingRect=function o(H,F,af,ad,V,U,K,J,M,ak,L,ai,B){function Z(aE,aD,av,au,az,ay,aG,aF,ax,aB,aw){var aC,aA,ar,ao,aq,an,ap,am;if(!x.areRectsOverlapping(aE,aD,aG,aF,M,ak,L,ai)){return false}if(x.isRectIncluded(aE,aD,aG,aF,M,ak,L,ai)){return true}if(ax<=y||Math.abs(aE-aG)<=B&&Math.abs(aD-aF)<=B){return true}ar=aE;aq=0.5*(ar+av);aC=0.5*(av+az);az=0.5*(az+aG);ap=0.5*(aq+aC);av=0.5*(aC+az);aE=0.5*(ap+av);ao=aD;an=0.5*(ao+au);aA=0.5*(au+ay);ay=0.5*(ay+aF);am=0.5*(an+aA);au=0.5*(aA+ay);aD=0.5*(am+au);ax*=0.5;return Z(ar,ao,aq,an,ap,am,aE,aD,ax,aB,aw+1)||Z(aE,aD,av,au,az,ay,aG,aF,ax,ax+aB,aw+1)}function R(ap){var an,am,ao=1-ap;P=H;O=ao*P+ap*af;an=ao*af+ap*V;V=ao*V+ap*K;N=ao*O+ap*an;af=ao*an+ap*V;H=ao*N+ap*af;al=F;aj=ao*al+ap*ad;am=ao*ad+ap*U;U=ao*U+ap*J;ah=ao*aj+ap*am;ad=ao*am+ap*U;F=ao*ah+ap*ad}var I,G,D,C,X,aa,A,W,T,p,P,al,O,aj,N,ah,S,E,ab,Q,z,Y,ag,ae,ac;A=Math.min(H,af,V,K);W=Math.max(H,af,V,K);T=Math.min(F,ad,U,J);p=Math.max(F,ad,U,J);if(!x.areRectsOverlapping(A,T,W,p,M,ak,L,ai)){return false}if(B===undefined){B=0.5}S=af-H;E=V-af;ab=K-V;Q=ad-F;z=U-ad;Y=J-U;ae=S-E;ac=E*E-ab*S;ag=S-2*E+ab;I=(ae-Math.sqrt(ac))/ag;G=(ae+Math.sqrt(ac))/ag;ae=Q-z;ac=z*z-Y*Q;ag=Q-2*z+Y;D=(ae-Math.sqrt(ac))/ag;C=(ae+Math.sqrt(ac))/ag;if(G<I||isNaN(I)){X=G;G=I;I=X}if(D<G||isNaN(G)){X=D;D=G;if(X<I||isNaN(I)){G=I;I=X}else{G=X}}if(C<D||isNaN(D)){X=C;C=D;if(X<G||isNaN(G)){D=G;if(X<I||isNaN(I)){G=I;I=X}else{G=X}}else{D=X}}aa=0;if(I>0&&I<1){R((I-aa)/(1-aa));if(Z(P,al,O,aj,N,ah,H,F,I-aa,aa,0)){return true}aa=I}if(G>0&&G<1){R((G-aa)/(1-aa));if(Z(P,al,O,aj,N,ah,H,F,G-aa,aa,0)){return true}aa=G}if(D>0&&D<1){R((D-aa)/(1-aa));if(Z(P,al,O,aj,N,ah,H,F,D-aa,aa,0)){return true}aa=D}if(C>0&&C<1){R((C-aa)/(1-aa));if(Z(P,al,O,aj,N,ah,H,F,C-aa,aa,0)){return true}aa=C}return Z(H,F,af,ad,V,U,K,J,1-aa,aa,0)};x.isSegmentInRect=function w(A,p,E,C,B,F,z,D){return x.isRectIncluded(A,p,E,C,B,F,z,D)};function i(G,F,E,D,H){var B=1-H;var C=B*B;var A=B*C;var z=H*H;var p=H*z;return A*G+3*C*H*F+3*B*z*E+p*D}x.isBezierInRect=function l(R,Q,E,D,I,H,T,S,L,A,K,z){function C(U){if(U>0&&U<1){return C(i(R,E,I,T,U),i(Q,D,H,S,U),L,A,K,z)}else{return true}}var p,F,J,G,O,B,P,N,M;if(!x.isPointInRect(R,Q,L,A,K,z)||!x.isPointInRect(T,S,L,A,K,z)){return false}if(x.isPointInRect(E,D,L,A,K,z)&&x.isPointInRect(I,H,L,A,K,z)){return true}p=E-R;F=I-E;J=T-I;G=D-Q;O=H-D;B=S-H;N=p-F;M=F*F-J*p;P=p-2*F+J;if(!C((N-Math.sqrt(M))/P)){return false}if(!C((N+Math.sqrt(M))/P)){return false}N=G-O;M=O*O-B*G;P=G-2*O+B;if(!C((N-Math.sqrt(M))/P)){return false}if(!C((N+Math.sqrt(M))/P)){return false}return true};x.isRectIncluded=function r(B,F,A,E,D,z,C,p){var G;if(B>A){G=B;B=A;A=G}if(F>E){G=F;F=E;E=G}if(D>C){G=D;D=C;C=G}if(z>p){G=z;z=p;p=G}return x.isIntervalIncluded(B,A,D,C)&&x.isIntervalIncluded(F,E,z,p)};x.isPointInRect=function f(p,E,A,D,z,C){var B;if(A>z){B=A;A=z;z=B}if(D>C){B=D;D=C;C=B}return A<=p&&p<=z&&D<=E&&E<=C};x.nb2px=function(p,z){return p.toFixed(z)+"px"};var u={38:[38,97,109,112,59],60:[38,108,116,59],62:[38,103,116,59],39:[38,35,51,57,59],34:[38,113,117,111,116,59]};x.xmlQuote=function(H,z,C){var E,D,B,F,A,G,p;z=z||0;C=C!==undefined?Math.min(C,H.length):H.length;F=new Array(C-z);for(E=z,A=0;E<C;++E){G=H.charCodeAt(E);if(G<9||G>9&&G<10||G>10&&G<13||G>13&&G<32||G>55295&&G<57344||G>65533&&G<65536){F[A++]=65533;continue}p=u[G];if(p){for(D=0,B=p.length;D<B;++D){F[A++]=p[D]}}else{F[A++]=G}}return String.fromCharCode.apply(null,F)};x.reframeViewpoint=function e(M,E,I){function P(){if(I&&I.defaultVpt!==undefined){return I.defaultVpt}return[0,0,1]}function B(Z){return isFinite(Z)&&Z>=0}function H(Z){return typeof Z==="number"}function F(ae,ab,aa,Z,ad,ac){if(ae<0){return ac-ab*Math.min(aa,Z)}if(ae>0){return ad-ac-ab*Math.max(aa,Z)}return 0.5*(ad-ab*(aa+Z))}var K,C,U,p,V,A,O,z,R;var L,N,Q,T;var X,D;var G,S,J,Y,W;K=x.pos_number_opt(I,"padding",0);C=x.pos_nonzero_number_opt(I,"maxScale",Infinity);U=x.pos_nonzero_number_opt(I,"minScale",Number.MIN_VALUE);p=x.pos_number_opt(I,"minSize",1);V=x.finite_number_opt(I,"horizontal",0);A=x.finite_number_opt(I,"vertical",0);O=x.pos_integer_opt(I,"aliasing",undefined);if(C<U){throw new Error("opts.maxScale < opts.minScale")}if(!M||M.length!==2){throw new Error("size should be an array of length 2")}if(!B(M[0])||!B(M[1])){throw new Error("size must contain two finite positive numbers")}if(M[0]<p||M[1]<p){return P()}X=Math.min(K,0.5*(M[0]-p));D=Math.min(K,0.5*(M[1]-p));if(E instanceof x.BoundingRect){L=E.xmin;N=E.xmax;Q=E.ymin;T=E.ymax}else{if(!E||E.length!==4||(L=E[0],N=E[1],Q=E[2],T=E[3],!H(L)||!H(N)||!H(Q)||!H(T))){throw new Error("bounds should be an instance of BoundingRect or an array of 4 numbers")}}G=Math.abs(N-L);S=Math.abs(T-Q);if(!isFinite(G)||!isFinite(S)){return P()}if(U===C){J=U}else{J=Math.max(U,Math.min(C,(M[0]-2*X)/G,(M[1]-2*D)/S))}if(!isFinite(J)){return P()}Y=F(V,J,L,N,M[0],X);W=F(A,J,Q,T,M[1],D);if(O!==undefined){z=Math.pow(2,O);R=Math.pow(2,-O);Y=Math.round(z*Y)*R;W=Math.round(z*W)*R}return[Y,W,J]};x.changeViewpointScale=function(A,B,p,z){if(z){return[A[0]+(A[2]-B)*p[0],A[1]+(A[2]-B)*p[1],B]}else{return[p[0]-B*(p[0]-A[0])/A[2],p[1]-B*(p[1]-A[1])/A[2],B]}};x.calculateNewScale=function(B,C,p){var A=undefined,D=undefined,z=undefined,E=undefined;E=B*Math.pow(2,C);if(p){if(p[0]&&E<Math.abs(p[0])){z=p[0]}if(p[1]&&E>Math.abs(p[1])){z=p[1]}if(z){A=(1/p[2])*Math.log(Math.abs(z))/Math.log(2);if(A>=0){D=Math.floor(A)}else{D=Math.ceil(A)}E=Math.pow(2,p[2]*D)}}return E};x.incViewpointScale=function(C,B,z,A,p){var D=x.calculateNewScale(C[2],B,p);return x.changeViewpointScale(C,D,z,A)};x.relativeToElement=function t(z,p,A){var B;B=A.getBoundingClientRect();return[z-Math.floor(B.left),p-Math.floor(B.top)]};x.relativeToViewpoint=function v(A,z,C,B){var p;p=x.relativeToElement(A,z,C);p[0]-=B[0];p[1]-=B[1];p[0]/=B[2];p[1]/=B[2];return p};var d=/\?([^#]*)(#|)/;x.setQuery=function(A,I,H){I=encodeURIComponent(I);H=H!==undefined?encodeURIComponent(H):"";var p=d.exec(A);var F,J;if(!p){var G=A.indexOf("#");if(G===-1){F=A;J=""}else{F=A.substring(0,G);J=A.substring(G)}}else{F=A.substring(0,p.index);J=A.substring(p.index+p[0].length-p[2].length)}var B=p?p[1].split("&"):[];var z=I.length;var E,C;for(E=0,C=B.length;E<C;++E){var D=B[E];if(D.substring(0,z)===I&&(D.length===z||D.charAt(z)==="=")){break}}if(H.length){B[E]=I+"="+H}else{B[E]=I}return F+"?"+B.join("&")+J};x.getQuery=function(z,J){var p,B,A,F,D,E,H,G,C,I;J=J&&encodeURIComponent(J);p=d.exec(z);B=p?p[1].split("&"):[];if(J){A=J.length;for(F=0,D=B.length;F<D;++F){E=B[F];if(E.substring(0,A)===J&&(E.length===A||E.charAt(A)==="=")){return decodeURIComponent(E.substring(A+1))}}}else{H={};for(F=0,D=B.length;F<D;++F){E=B[F];G=E.indexOf("=");if(G!==-1){C=E.substring(0,G);I=E.substring(G+1)}else{C=E;I=""}H[decodeURIComponent(C)]=decodeURIComponent(I)}return H}};x.touchCompatRemoveChild=function(p,z){p.removeChild(z)};x.BoundingRect=function(){this.xmin=NaN;this.xmax=NaN;this.ymin=NaN;this.ymax=NaN;this.xminObj=null;this.xmaxObj=null;this.yminObj=null;this.ymaxObj=null};x.BoundingRect.prototype.isModifiedBy=function(C,B,z,A,p){if(B<this.xmin||z>this.xmax||A<this.ymin||p>this.ymax){return true}if((B>this.xmin&&this.xminObj===C)||(z<this.xmax&&this.xmaxObj===C)||(A>this.ymin&&this.yminObj===C)||(p<this.ymax&&this.ymaxObj===C)){return true}if((!isNaN(B)&&isNaN(this.xmin))||(!isNaN(z)&&isNaN(this.xmax))||(!isNaN(A)&&isNaN(this.ymin))||(!isNaN(p)&&isNaN(this.ymax))){return true}if((isNaN(B)&&this.xminObj===C)||(isNaN(z)&&this.xmaxObj===C)||(isNaN(A)&&this.yminObj===C)||(isNaN(p)&&this.ymaxObj===C)){return true}return false};x.BoundingRect.prototype.isValid=function(){return isFinite(this.xmin)&&isFinite(this.xmax)&&isFinite(this.ymin)&&isFinite(this.ymax)};x.BoundingRect.prototype.reset=function(){this.xmin=NaN;this.xmax=NaN;this.ymin=NaN;this.ymax=NaN;this.xminObj=null;this.xmaxObj=null;this.yminObj=null;this.ymaxObj=null};x.BoundingRect.prototype.update=function(C,B,z,A,p){if(B<this.xmin||isNaN(this.xmin)){this.xmin=B;this.xminObj=C}if(z>this.xmax||isNaN(this.xmax)){this.xmax=z;this.xmaxObj=C}if(A<this.ymin||isNaN(this.ymin)){this.ymin=A;this.yminObj=C}if(p>this.ymax||isNaN(this.ymax)){this.ymax=p;this.ymaxObj=C}};x.BoundingRect.prototype.toString=function(){var z;z=this;function p(B){var A;A=z[B];if(isNaN(A)){return String(A)}else{return String(A)+"("+z[B+"Obj"]+")"}}return"{ xmin: "+p("xmin")+", xmax: "+p("xmax")+", ymin: "+p("ymin")+", ymax: "+p("ymax")+" }"};var q=/[^A-Za-z](Trident|MSIE)[^A-Za-z]/i.test(navigator.userAgent);x.isIE=function(){return q};x.newNotImplError=function a(){return new Error("not implemented")};x.hasClass=function(z,p){var A=(" "+z.className+" ").replace(/[\n\t]/g," ").indexOf(" "+p+" ")>-1;return A};x.firstParentWithClass=function(A,z){var p=A;if(p){var B=(" "+p.className+" ").replace(/[\n\t]/g," ").indexOf(" "+z+" ")>-1;if(B){return p}else{return x.firstParentWithClass(p.parentNode,z)}}else{}};return x});define("egraph/utils",["DS/egraph/utils"],function mod(a){return a});define("DS/egraph/core",["DS/egraph/utils"],function(F){var G={};function L(){}function N(u){console.log(new Error(u).stack)}var m;(function(){function u(){m=O?N:L}var O=false;Object.defineProperty(G,"logDeprecatedAccesses",{get:function(){return O},set:function(P){O=Boolean(P);console.log("egraph/core.logDeprecatedAccesses "+(O?"enabled":"disabled"));u()},enumerable:true,configurable:false});u()}());function I(u,O){return function(){m("Use deprecated property: "+O);return u.apply(this,arguments)}}G.Observable=function(){};G.Observable.prototype.dispatch=function(O){var P,Q,u;if(typeof O.type!=="string"){throw new Error("No .type string property on the event")}O.target=this;if(this.listeners&&this.listeners.hasOwnProperty(O.type)){P=this.listeners[O.type];if(P.length>=1){for(Q=0,u=P.length;Q<u;++Q){P[Q].call(null,O)}}}};G.Observable.prototype.addListener=function(u,O){if(typeof O!=="function"){throw new Error("Listener must be a function")}if(!this.listeners){this.listeners={}}this.listeners[u]=(this.listeners.hasOwnProperty(u)&&this.listeners[u]||[]).concat(O)};G.Observable.prototype.removeListener=function(P,Q){var O,u;if(this.listeners){if(this.listeners.hasOwnProperty(P)){u=this.listeners[P];O=u.indexOf(Q);if(O!==-1){this.listeners[P]=u.slice(0,O).concat(u.slice(O+1));return true}}}return false};var M=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];G.fmtPath=function(V){var S,T,Q,R,u,U,P,O;Q=V.length;S=new Array(Q);for(T=0;T<Q;++T){U=V[T];P=null;for(R=0,u=U.length;R<u;++R){O=U.charCodeAt(R);if(O<32||O===37||O===127){if(!P){P=U.substring(0,R)}P+="%";P+=M[O>>>4];P+=M[O&15]}else{if(P){P+=String.fromCharCode(O)}}}S[T]=P?P:U}return S.join(".")};G.UpdatedNotif=function(O,u){this.path=O;this.oldValue=u};G.UpdatedNotif.prototype.type="updated";function g(u){Object.defineProperty(u.prototype,"name",{configurable:false,enumerable:true,get:I(function(){return G.fmtPath(this.path)},"name")})}g(G.UpdatedNotif);G.UpdatedNotif.prototype.object=null;G.UpdatedNotif.prototype.toString=function(){var u;u=this.object?this.object.toString():"null";return'{ type: "'+this.type+'", object: '+u+", path: "+G.fmtPath(this.path)+", oldValue: "+this.oldValue+" }"};G.RemovedNotif=function(O,P,u){this.path=O;this.child=P;this.oldNext=u};G.RemovedNotif.prototype.type="removed";G.RemovedNotif.prototype.object=null;g(G.RemovedNotif);G.RemovedNotif.prototype.toString=function(){var O,u,P;O=this.object?this.object.toString():"null";u=this.child?this.child.toString():"null";P=this.oldNext?this.oldNext.toString():"null";return'{ type: "'+this.type+'", object: '+O+", path: "+G.fmtPath(this.path)+", child: "+u+", oldNext: "+P+" }"};G.AddedNotif=function(O,P,u){this.path=O;this.child=P;this.next=u};G.AddedNotif.prototype.type="added";g(G.AddedNotif);G.AddedNotif.prototype.object=null;G.AddedNotif.prototype.toString=function(){var O,u,P;O=this.object?this.object.toString():"null";u=this.child?this.child.toString():"null";P=this.next?this.next.toString():"null";return'{ type: "'+this.type+'", object: '+O+", path: "+G.fmtPath(this.path)+", child: "+u+", next: "+P+" }"};G.MovedNotif=function(P,Q,u,O){this.path=P;this.child=Q;this.next=u;this.oldNext=O};G.MovedNotif.prototype.type="moved";g(G.MovedNotif);G.MovedNotif.prototype.object=null;G.MovedNotif.prototype.toString=function(){var O,u,Q,P;O=this.object?this.object.toString():"null";u=this.child?this.child.toString():"null";Q=this.next?this.next.toString():"null";P=this.oldNext?this.oldNext.toString():"null";return'{ type: "'+this.type+'", object: '+O+", path: "+G.fmtPath(this.path)+", child: "+u+", next: "+Q+", oldNext: "+P+" }"};(function(){var u=false;Object.defineProperty(G,"logInvalidAccesses",{get:function(){return u},set:function(O){u=Boolean(O);console.log("egraph/core.logInvalidAccesses "+(u?"enabled":"disabled"));G.Node=u?k:c;G.BorderCstr=u?a:H;G.Connector=u?o:y;G.Edge=u?n:h},enumerable:true,configurable:false})}());G.ObservableData=function(){};G.ObservableData.prototype.set=function(u,O){this.setPath([u],O)};G.ObservableData.prototype.setPath=function(U,R){var T,S,P,Q,u,O;u=U.length;S=this;for(Q=0;S&&Q<u-1;++Q){T=U[Q];S=S[T]}if(!S){throw new Error("Can't find "+T+" in interpretation of path "+G.fmtPath(U))}O=U[u-1];P=S[O];if(R!==P){p+=1;try{S[O]=R}finally{p-=1}this.notify(new G.UpdatedNotif(U,P))}};G.ObservableData.prototype.multiset=function(){var O,P,u;P=arguments.length;if(P&1){throw new Error("odd number of arguments")}G.ObservableData.lock();try{for(O=0;O<P;O+=2){u=arguments[O];if(typeof u==="string"){this.set(u,arguments[O+1])}else{this.setPath(u,arguments[O+1])}}}finally{G.ObservableData.unlock()}};var p=0;G.ObservableData.lockCount=0;G.ObservableData.postCallsCBs=null;G.ObservableData.addPostCallsCB=function(u){if(typeof u!=="function"){throw new Error("Callback must be a function")}if(!G.ObservableData.postCallsCBs){G.ObservableData.postCallsCBs=[]}G.ObservableData.postCallsCBs.push(u)};G.ObservableData.lock=function(){if(G.ObservableData.lockCount){++G.ObservableData.lockCount}else{G.ObservableData.lockCount=1}};G.ObservableData.unlock=function(){var Q,R,P,u,O;if(G.ObservableData.lockCount<=0){throw new Error("Illage State: extraneous unlock of object")}if(G.ObservableData.lockCount===1){try{while(G.ObservableData.pendingCalls){Q=G.ObservableData.pendingCalls;G.ObservableData.pendingCalls=null;u=Q.length;for(P=0;P<u;++P){Q[P].func.__pendingChanges__=null}for(P=0;P<u;++P){R=Q[P];R.func(R.arg)}}}finally{G.ObservableData.lockCount=0;while(G.ObservableData.postCallsCBs){O=G.ObservableData.postCallsCBs;G.ObservableData.postCallsCBs=null;for(P=0,u=O.length;P<u;++P){O[P]();if(G.ObservableData.lockCount){throw new Error("A change callback still holds a lock")}}}}}else{--G.ObservableData.lockCount}};G.ObservableData.prototype.notify=function(S){var O,u,Q,P,R;if(typeof S.type!=="string"){throw new Error("Illegal Argument: no type field in change notification")}S.object=this;P=this.dataListeners;if(P){if(G.ObservableData.lockCount){for(O=0,u=P.length;O<u;++O){R=P[O];if(!R.__pendingChanges__){if(!G.ObservableData.pendingCalls){G.ObservableData.pendingCalls=[]}R.__pendingChanges__=[];G.ObservableData.pendingCalls.push({func:R,arg:R.__pendingChanges__})}R.__pendingChanges__.push(S)}}else{G.ObservableData.lock();try{Q=[S];for(O=0,u=P.length;O<u;++O){P[O](Q)}}finally{G.ObservableData.unlock()}}}};G.ObservableData.prototype.addChangeListener=function(u){if(typeof u!=="function"){throw new Error("Listener must be a function")}this.dataListeners=(this.dataListeners||[]).concat(u)};G.ObservableData.prototype.removeChangeListener=function(O){var u;if(this.dataListeners){u=this.dataListeners.indexOf(O);if(u!==-1){this.dataListeners=this.dataListeners.slice(0,u).concat(this.dataListeners.slice(u+1));return true}}return false};G.inPathSet=function(P,O){var u,Q;Q=arguments.length;for(u=1;u<Q;++u){if(P===true){break}if(P.hasOwnProperty(arguments[u])){P=P[arguments[u]]}else{return false}}return Boolean(P)};G.Type={EGRAPH:0,NODE:1,GROUP:2,CONNECTOR:3,EDGE:4};G.Type2Str=["egraph","node","group","connector","edge"];G.Selectable=function(){this.nextSel=null;this.prevSel=null};Object.defineProperty(G.Selectable.prototype,"selected",{get:function(){return this.isSelected()},enumerable:true});G.Selectable.prototype.isSelected=function(){var u;u=this.getGraph();return u?u.isSelected(this):false};G.Element=function(){this.mark=undefined;this.hidden=false};G.Element.prototype.remove=function(u){throw utils.newNotImplError()};G.Element.prototype.getGraph=function(){throw utils.newNotImplError()};G.Element.prototype.getParent=function(){throw utils.newNotImplError()};G.MarksScope=function(){if(r){throw new Error("can't have two MarksScope opened at the same time!")}r=this;this.markedObjects=[]};var r=null;G.MarksScope.prototype.setMark=function(u,O){if(!u.hasOwnProperty("mark")){throw new Error("elt is not an Element")}if(O===undefined){throw new Error("new value can't be undefined")}if(u.mark===undefined){this.markedObjects.push(u)}u.mark=O;return O};G.MarksScope.prototype.dispose=function(){var O,u;if(r!==this){throw new Error("can't dispose a not opened scope!")}r=null;for(O=0,u=this.markedObjects.length;O<u;++O){this.markedObjects[O].mark=undefined}this.markedObjects.length=0};G.List=function(){this.first=null;this.last=null};G.List.prototype.addLast=function(u){u.prev=this.last;if(this.last){this.last.next=u}else{this.first=u}this.last=u;return u};G.List.prototype.remove=function(u){if(u.prev){u.prev.next=u.next}else{this.first=u.next}if(u.next){u.next.prev=u.prev}else{this.last=u.prev}u.prev=u.next=null};G.List.prototype.insertBefore=function(O,u){if(u===O){throw new Error("Can't insert an element before itself")}if(O.next||O.prev||this.first===O){this.remove(O)}if(!u){this.addLast(O)}else{if(u.prev){u.prev.next=O}else{this.first=O}O.prev=u.prev;u.prev=O;O.next=u}};G.SelectionList=function(){this.first=null;this.last=null};G.SelectionList.prototype.addLast=function(u){u.prevSel=this.last;if(this.last){this.last.nextSel=u}else{this.first=u}this.last=u;return u};G.SelectionList.prototype.remove=function(u){if(u.prevSel){u.prevSel.nextSel=u.nextSel}else{this.first=u.nextSel}if(u.nextSel){u.nextSel.prevSel=u.prevSel}else{this.last=u.prevSel}u.prevSel=u.nextSel=null};G.GraphView=function(){this.viewKey=undefined;this.gr=null};G.GraphView.prototype.oninit=function b(u,O){if(this.viewKey||this.gr){throw new Error("Can't initialize twice!")}this.viewKey=O;this.gr=u};G.GraphView.prototype.onupdate=function(u,O){};G.GraphView.prototype.rectanglePick=function f(O,Q,u,P,R){throw utils.newNotImplError()};G.PathCmd={M:0,L:1,C:2};function i(P,W,V,U,Q,O){function S(aa){var Z,ac,Y,ab,X;if(!aa.hasOwnProperty(R)){Z=Q?function(ad){aa[V]=-ad}:function(ad){aa[V]=ad};ac=Q?function(){return -aa[V]}:function(){return aa[V]};Y=O?function(ad){aa[U]=-ad}:function(ad){aa[U]=ad};ab=O?function(){return -aa[U]}:function(){return aa[U]};Z=I(Z,W);Y=I(Y,W);ac=I(ac,W);ab=I(ab,W);X=[];Object.defineProperties(X,{0:{set:Z,get:ac,enumerable:true,configurable:false},1:{set:Y,get:ab,enumerable:true,configurable:false}});Object.defineProperty(aa,R,{value:X,writable:false,enumerable:false,configurable:false})}return aa[R]}function u(){var X;X=S(this);return X}function T(Y){var aa,X,Z;Z=S(this);for(aa=0,X=Math.min(Y.length,2);aa<X;++aa){Z[aa]=Y[aa]}}var R;R="fake-vector:"+W;Object.defineProperty(P.prototype,W,{enumerable:true,configurable:false,get:I(u,W),set:I(T,W)})}function A(P,S){var R,Q,O,u;u=S.length;Q=P;for(O=0;Q&&O<u-1;++O){R=S[O];Q=Q[R]}if(!Q){throw new Error("Can't find "+R+" in interpretation of path "+G.fmtPath(S))}return Q}function C(W,u,V,Z){var W,X,P,T,Q;if((typeof W!=="object"||!W)&&typeof W!=="function"){throw new Error("prototype is not an object or is null")}if(typeof u!=="string"){throw new Error("p is not a string")}if(!Array.isArray(Z)||Z.some(function O(aa){return typeof aa!=="string"})||Z.length===0){throw new Error("path must be a non-empty array of strings")}if(typeof V==="undefined"){Q=function S(){return this}}else{if(typeof V==="object"&&V){Q=function Y(){return V}}else{if(typeof V==="function"){Q=V}else{throw new Error("dst is not undefined or a function or an non-null object")}}}T=Z[Z.length-1];X=I(function R(aa){A(Q.call(this),Z)[T]=aa},u);P=I(function U(){return A(Q.call(this),Z)[T]},u);Object.defineProperty(W,u,{enumerable:true,configurable:false,get:P,set:X})}G.makeRewriter=C;function j(Q,R){function O(T){var S;S=Q[T];Object.defineProperty(Q,T,{get:function(){return S},set:function(U){if(!p){N("Not authorized access")}S=U},enumerable:true,configurable:false})}var P,u;for(P=1,u=arguments.length;P<u;++P){O(arguments[P])}}function q(P,Q){function u(){P.apply(this,arguments);j.apply(undefined,[this].concat(O))}var O;O=Array.prototype.slice.call(arguments,1);u.prototype=P.prototype;return u}var z=[];G.PropertyFlag={VIEW:1,MODEL:2,RECURSIVE:4};G.Nodal=function(){this.gr=null;this.parent=null;this.next=null;this.prev=null;this.left=0;this.top=0;this.originLeft=NaN;this.originTop=NaN;this.actualLeft=NaN;this.actualTop=NaN;this.actualWidth=NaN;this.actualHeight=NaN;this.children=new G.List();this.childrenHidden=false};G.Nodal.prototype.internalRecursiveUpdate=function(){this.multiset("originLeft",this.parent.originLeft+this.left,"originTop",this.parent.originTop+this.top);this.updateCollapsedFlag()};G.Nodal.prototype.updateCollapsedFlag=function(){throw new Error("Not implemented!")};G.Nodal.prototype.getGraph=function(){return this.gr};G.Nodal.prototype.getParent=function(){return this.parent};G.Nodal.prototype.remove=function(u){if(this.parent){this.parent.removeNode(this,u)}};G.Nodal.prototype.bringToFront=function(){var u;for(u=this;u.parent;u=u.parent){u.parent.insertNodeBefore(u,null)}};G.Nodal.prototype.appendConnector=function(u){this.insertConnectorBefore(u,null)};G.Nodal.prototype.insertConnectorBefore=function(O,u){var P,Q;if(O.external){O=O.external}if(u&&u.external){u=u.external}if(this.__graph__){this.__graph__.registerNewElement(O);if(O.internal){this.__graph__.registerNewElement(O.internal)}}if(u&&u.node!==this){throw new Error("nextConnector not in node")}if(u===O){throw new Error("can't insert a connector before itself")}if(O.node){if(O.node!==this){throw new Error("connector already in an other node")}if(O.internal){if(O.next!==O.internal){throw new Error("invalid internal state")}Q=O.internal.next;this.children.remove(O.internal)}else{Q=O.next}this.children.remove(O);P=true}else{P=false}this.children.insertBefore(O,u);if(O.internal){this.children.insertBefore(O.internal,u)}O.node=this;if(O.internal){O.internal.node=this}G.ObservableData.lock();try{if(P){if(O.internal){this.notify(new G.MovedNotif(["children"],O.internal,null,Q))}this.notify(new G.MovedNotif(["children"],O,null,Q))}else{this.notify(new G.AddedNotif(["children"],O,null));if(O.internal){this.notify(new G.AddedNotif(["children"],O.internal,null))}}}finally{G.ObservableData.unlock()}};G.Nodal.prototype.removeConnector=function(R,P){function u(S){while(S.children.first){S.children.first.ref.remove(P)}if(O.gr){O.gr.removeFromSelection(S)}O.children.remove(S);S.node=null;O.notify(new G.RemovedNotif(["children"],S,Q))}var O,Q;O=this;if(R.external){R=R.external}if(R.node!==this){throw new Error("connector is not in this group")}G.ObservableData.lock();try{if(R.internal){if(R.next!==R.internal){throw new Error("illegal internal state")}Q=R.internal.next;u(R.internal)}else{Q=R.next}u(R)}finally{G.ObservableData.unlock()}};G.Node=function(u,O){G.Element.call(this);G.ObservableData.call(this);G.Nodal.call(this);G.Selectable.call(this);this.views={main:u||null};this.data=O||null;this.width=0;this.height=0};F.applyMixin(G.Node,G.Element);F.applyMixin(G.Node,G.ObservableData);F.applyMixin(G.Node,G.Nodal);F.applyMixin(G.Node,G.Selectable);var c=G.Node;var k=q(G.Node,"width","height","left","top");C(G.Node.prototype,"view",undefined,["views","main"]);i(G.Node,"pos","left","top");i(G.Node,"dim","width","height");z[G.Type.NODE]=Object.freeze({left:G.PropertyFlag.VIEW|G.PropertyFlag.MODEL|G.PropertyFlag.RECURSIVE,top:G.PropertyFlag.VIEW|G.PropertyFlag.MODEL|G.PropertyFlag.RECURSIVE,width:G.PropertyFlag.VIEW|G.PropertyFlag.MODEL,height:G.PropertyFlag.VIEW|G.PropertyFlag.MODEL,actualLeft:G.PropertyFlag.VIEW,actualTop:G.PropertyFlag.VIEW,actualWidth:G.PropertyFlag.VIEW,actualHeight:G.PropertyFlag.VIEW,hidden:G.PropertyFlag.VIEW,children:G.PropertyFlag.VIEW});G.Node.prototype.customPropertyFlags=null;G.Node.prototype.set=function(u,O){if(u==="pos"){G.ObservableData.lock();try{G.ObservableData.prototype.set.call(this,"left",O[0]);G.ObservableData.prototype.set.call(this,"top",O[1])}finally{G.ObservableData.unlock()}}else{if(u==="dim"){G.ObservableData.lock();try{G.ObservableData.prototype.set.call(this,"width",O[0]);G.ObservableData.prototype.set.call(this,"height",O[1])}finally{G.ObservableData.unlock()}}else{G.ObservableData.prototype.set.apply(this,arguments)}}};function l(u){return function(){var O;O=u;if(this.data&&typeof this.data.toString==="function"&&this.data.toString!==Object.prototype.toString){O+="<"+this.data.toString()+">"}return O}}G.Node.prototype.toString=l("Node");G.Node.prototype.type=G.Type.NODE;G.Node.prototype.internalUpdate=function(){this.multiset("actualLeft",this.originLeft,"actualTop",this.originTop,"actualWidth",this.width,"actualHeight",this.height)};G.Node.prototype.updateCollapsedFlag=function(){this.multiset("hidden",this.parent.childrenHidden,"childrenHidden",this.parent.childrenHidden)};G.Grouping=function(){this.nodes=new G.List()};G.Grouping.prototype.addNode=function(u){this.insertNodeBefore(u,null)};G.dftNext=function(u,P,O){if(!O&&P.nodes&&P.nodes.first){return P.nodes.first}else{while(P!==u&&!P.next){P=P.parent}return P!==u?P.next:null}};function v(u,Q){var P,O;for(P=Q;P;P=G.dftNext(Q,P)){u.registerNewElement(P);for(O=P.children.first;O;O=O.next){u.registerNewElement(O)}}}G.Grouping.prototype.insertNodeBefore=function(Q,u){var P,R,S,O;if(this.__graph__){v(this.__graph__,Q)}if(u&&u.parent!==this){throw new Error("nextNode not in this group/graph")}if(u===Q){throw new Error("can't insert a node before itself")}if(Q.parent&&Q.parent!==this){throw new Error("node in an other group/graph")}if(Q.parent){R=Q.next;this.nodes.remove(Q);P=true}else{P=false}this.nodes.insertBefore(Q,u);O=this.type===G.Type.GROUP?this.gr:this;for(S=Q;S;S=G.dftNext(Q,S)){S.gr=O}Q.parent=this;if(P){this.notify(new G.MovedNotif(["nodes"],Q,null,R))}else{this.notify(new G.AddedNotif(["nodes"],Q,null))}};G.applyActualGeometry=function(u){if(!u.gr){return}if(isNaN(u.actualLeft)||isNaN(u.actualTop)||isNaN(u.actualWidth)||isNaN(u.actualHeight)){return}G.ObservableData.lock();try{u.setOrigin(u.actualLeft,u.actualTop,true);u.multiset("width",u.actualWidth,"height",u.actualHeight)}finally{G.ObservableData.unlock()}};G.Grouping.prototype.removeNode=function(Q,P){var T,S,O,R,u;T=this.type===G.Type.GROUP;u=T?this.gr:this;if(Q.parent!==this){throw new Error("Node not in this group/graph")}G.ObservableData.lock();try{R=Q.next;this.nodes.remove(Q);for(S=Q;S;S=G.dftNext(Q,S)){if(u){u.removeFromSelection(S)}for(O=S.children.first;O;O=O.next){if(u){u.removeFromSelection(O)}while(O.children.first){u.removeEdge(O.children.first.ref,P)}}S.gr=null}Q.parent=null;this.notify(new G.RemovedNotif(["nodes"],Q,R));if(!this.nodes.first&&T&&P&&P.onemptygroup){P.onemptygroup.call(undefined,this)}}finally{G.ObservableData.unlock()}};G.Group=function(){G.Element.call(this);G.ObservableData.call(this);G.Nodal.call(this);G.Grouping.call(this);G.Selectable.call(this);this.views={};this.data=null;this.width=60;this.height=60;this.childrenBounds=new F.BoundingRect();this.geometry=null;this.collapsed=false};F.applyMixin(G.Group,G.Element);F.applyMixin(G.Group,G.ObservableData);F.applyMixin(G.Group,G.Nodal);F.applyMixin(G.Group,G.Grouping);F.applyMixin(G.Group,G.Selectable);z[G.Type.GROUP]=Object.freeze({left:G.PropertyFlag.VIEW|G.PropertyFlag.MODEL|G.PropertyFlag.RECURSIVE,top:G.PropertyFlag.VIEW|G.PropertyFlag.MODEL|G.PropertyFlag.RECURSIVE,width:G.PropertyFlag.VIEW|G.PropertyFlag.MODEL,height:G.PropertyFlag.VIEW|G.PropertyFlag.MODEL,geometry:G.PropertyFlag.VIEW|G.PropertyFlag.MODEL,actualLeft:G.PropertyFlag.VIEW,actualTop:G.PropertyFlag.VIEW,actualWidth:G.PropertyFlag.VIEW,actualHeight:G.PropertyFlag.VIEW,nodes:G.PropertyFlag.VIEW,collapsed:G.PropertyFlag.VIEW|G.PropertyFlag.MODEL|G.PropertyFlag.RECURSIVE,hidden:G.PropertyFlag.VIEW,children:G.PropertyFlag.VIEW});G.Group.prototype.customPropertyFlags=null;G.Group.prototype.toString=l("Group");G.Group.prototype.type=G.Type.GROUP;G.Group.prototype.setOrigin=function(Q,P,S){var O,u,R;if(S){if(!this.gr){throw new Error("group is not in a graph; can't use absolute coordinates")}if(isNaN(this.parent.originLeft)||isNaN(this.parent.originTop)){throw new Error("no update occured on parent group")}Q-=this.parent.originLeft;P-=this.parent.originTop}O=this.left-Q;u=this.top-P;G.ObservableData.lock();try{this.multiset("left",Q,"top",P);for(R=this.nodes.first;R;R=R.next){R.multiset("left",R.left+O,"top",R.top+u)}}finally{G.ObservableData.unlock()}};G.Group.prototype.internalUpdate=function(){var O,u;u=this.childrenBounds;if(u.isValid()&&(!this.__modifiedProperties__||!this.__modifiedProperties__.nodes)){for(O=this.nodes.first;O;O=O.next){if(O.__modifiedProperties__&&(O.__modifiedProperties__.actualTop||O.__modifiedProperties__.actualLeft||O.__modifiedProperties__.actualWidth||O.__modifiedProperties__.actualHeight)){if(u.isModifiedBy(O,O.actualLeft,O.actualLeft+O.actualWidth,O.actualTop,O.actualTop+O.actualHeight)){u.reset();break}}}}else{u.reset()}if(!u.isValid()){for(O=this.nodes.first;O;O=O.next){u.update(O,O.actualLeft,O.actualLeft+O.actualWidth,O.actualTop,O.actualTop+O.actualHeight)}}if(this.geometry&&this.geometry.onupdate){this.geometry.onupdate(this)}else{J.onupdate(this)}};G.Group.prototype.updateCollapsedFlag=function(){this.multiset("hidden",this.parent.childrenHidden,"childrenHidden",this.parent.childrenHidden||this.collapsed)};G.BoundsGeometry=function(){this.paddingTop=40;this.paddingRight=40;this.paddingBottom=40;this.paddingLeft=40};G.BoundsGeometry.prototype.onupdate=function(O){var u;u=O.childrenBounds;if(u.isValid()&&!O.collapsed){O.multiset("actualLeft",u.xmin-this.paddingLeft,"actualTop",u.ymin-this.paddingTop,"actualWidth",u.xmax-u.xmin+this.paddingLeft+this.paddingRight,"actualHeight",u.ymax-u.ymin+this.paddingTop+this.paddingBottom)}else{O.multiset("actualLeft",O.originLeft,"actualTop",O.originTop,"actualWidth",O.width,"actualHeight",O.height)}};G.BoundsGeometry.prototype.recenterGroup=function B(Q){var P=Q.childrenBounds,S,R,O,u,T;if(!Q.gr){throw new Error("group not in a graph")}if(!P.isValid){return}S=0.5*(P.xmax+P.xmin-this.paddingLeft+this.paddingRight-Q.width)-Q.parent.originLeft;R=0.5*(P.ymax+P.ymin-this.paddingTop+this.paddingBottom-Q.height)-Q.parent.originTop;O=S-Q.left;u=R-Q.top;Q.gr.updateLock();try{Q.multiset("left",S);Q.multiset("top",R);for(T=Q.nodes.first;T;T=T.next){T.multiset("left",T.left-O,"top",T.top-u)}}finally{Q.gr.updateUnlock()}};var J=new G.BoundsGeometry();G.EdgeLink=function(u){this.c=null;this.ref=u;this.next=null;this.prev=null};G.EdgeLink.prototype.otherEnd=function(){return this===this.ref.cl1?this.ref.cl2:this.ref.cl1};G.EdgeLink.prototype.nextEdge=function(){return this.next&&this.next.ref===this.ref?this.next.next:this.next};G.EdgeLink.prototype.toString=function(){return"EdgeLink<"+this.c+","+this.ref+">"};G.BorderCstr=function(){this.aoffx=0;this.aoffy=0;this.attach=0;this.offset=0;this.marginTop=0;this.marginRight=0;this.marginBottom=0;this.marginLeft=0};var H=G.BorderCstr;var a=q(G.BorderCstr,"offset","attach","aoffy","aoffx","marginTop","marginLeft","marginBottom","marginRight");G.BorderCstr.TOP=0;G.BorderCstr.BOTTOM=1;G.BorderCstr.LEFT=2;G.BorderCstr.RIGHT=3;G.BorderCstr.prototype.onupdate=function(u){var P,U,T,S,O,R,Q;U=u.node.actualLeft;T=u.node.actualTop;switch(this.attach){case G.BorderCstr.LEFT:case G.BorderCstr.RIGHT:P=F.clamp(this.offset,this.marginTop,u.node.actualHeight-this.marginBottom);break;case G.BorderCstr.TOP:case G.BorderCstr.BOTTOM:P=F.clamp(this.offset,this.marginLeft,u.node.actualWidth-this.marginRight);break}switch(this.attach){case G.BorderCstr.LEFT:T+=P;break;case G.BorderCstr.RIGHT:U+=u.node.actualWidth;T+=P;break;case G.BorderCstr.TOP:U+=P;break;case G.BorderCstr.BOTTOM:U+=P;T+=u.node.actualHeight;break}S=U;O=T;switch(this.attach){case G.BorderCstr.LEFT:S+=this.aoffy;O-=this.aoffx;break;case G.BorderCstr.RIGHT:S-=this.aoffy;O+=this.aoffx;break;case G.BorderCstr.TOP:S+=this.aoffx;O+=this.aoffy;break;case G.BorderCstr.BOTTOM:S-=this.aoffx;O-=this.aoffy;break}switch(this.attach){case G.BorderCstr.LEFT:R=-1;Q=0;break;case G.BorderCstr.RIGHT:R=1;Q=0;break;case G.BorderCstr.TOP:R=0;Q=-1;break;case G.BorderCstr.BOTTOM:R=0;Q=1;break}u.multiset("left",U,"top",T,"aleft",S,"atop",O,"anormx",R,"anormy",Q)};G.InternalConstraint=function(){};G.defaultInternalCstr=new G.InternalConstraint();G.InternalConstraint.prototype.onupdate=function(u){var O;if(!u.external){throw new Error("Can't use InternalConstraint on a non internal connector")}O=u.external;u.multiset("left",O.left,"top",O.top,"aleft",O.aleft,"atop",O.atop,"anormx",-O.anormx,"anormy",-O.anormy)};G.Connector=function(u,O,P){G.Element.call(this);G.ObservableData.call(this);G.Selectable.call(this);this.views={main:u||null};this.data=O||null;this.cstr=P===undefined?new G.BorderCstr():P;this.next=null;this.prev=null;this.left=0;this.top=0;this.aleft=0;this.atop=0;this.anormx=1;this.anormy=0;this.children=new G.List();this.node=null};F.applyMixin(G.Connector,G.Element);F.applyMixin(G.Connector,G.ObservableData);F.applyMixin(G.Connector,G.Selectable);var y=G.Connector;var o=q(G.Connector,"cstr","atop","aleft","top","left","anormx","anormy");C(G.Connector.prototype,"view",undefined,["views","main"]);C(G.Connector.prototype,"offset",undefined,["cstr","offset"]);C(G.Connector.prototype,"attach",undefined,["cstr","attach"]);C(G.Connector.prototype,"aoffx",undefined,["cstr","aoffx"]);C(G.Connector.prototype,"aoffy",undefined,["cstr","aoffy"]);C(G.Connector,"LEFT",function(){return G.BorderCstr},["LEFT"]);C(G.Connector,"RIGHT",function(){return G.BorderCstr},["RIGHT"]);C(G.Connector,"BOTTOM",function(){return G.BorderCstr},["BOTTOM"]);C(G.Connector,"TOP",function(){return G.BorderCstr},["TOP"]);i(G.Connector,"pos","left","top");i(G.Connector,"apos","aleft","atop");i(G.Connector,"aoff","aoffx","aoffy",false,true);(function(){function u(){if(!this.hasOwnProperty(P)){this[P]=new O(this)}return this[P]}function Q(){return this.connector}function O(R){this.connector=R}var P;P="deprecated:margin";C(O.prototype,"top",Q,["cstr","marginTop"]);C(O.prototype,"bottom",Q,["cstr","marginBottom"]);C(O.prototype,"left",Q,["cstr","marginLeft"]);C(O.prototype,"right",Q,["cstr","marginRight"]);Object.defineProperty(G.Connector.prototype,"margin",{enumerable:true,configurable:false,get:I(u,"margin")})}());z[G.Type.CONNECTOR]=Object.freeze({cstr:G.PropertyFlag.VIEW|G.PropertyFlag.MODEL,atop:G.PropertyFlag.VIEW,aleft:G.PropertyFlag.VIEW,anormx:G.PropertyFlag.VIEW,anormy:G.PropertyFlag.VIEW,top:G.PropertyFlag.VIEW,left:G.PropertyFlag.VIEW,hidden:G.PropertyFlag.VIEW,children:G.PropertyFlag.VIEW});G.Connector.prototype.customPropertyFlags=null;G.Connector.prototype.internal=null;G.Connector.prototype.external=null;G.Connector.prototype.set=function(u,P){var O;O=false;if(u==="pos"){G.ObservableData.lock();try{G.ObservableData.prototype.set.call(this,"left",P[0]);G.ObservableData.prototype.set.call(this,"top",P[1])}finally{G.ObservableData.unlock()}}else{if(u==="apos"){G.ObservableData.lock();try{G.ObservableData.prototype.set.call(this,"aleft",P[0]);G.ObservableData.prototype.set.call(this,"atop",P[1])}finally{G.ObservableData.unlock()}}else{if(u==="aoff"){G.ObservableData.lock();try{G.ObservableData.prototype.set.call(this,"aoffx",P[0]);G.ObservableData.prototype.set.call(this,"aoffy",-P[1])}finally{G.ObservableData.unlock()}}else{if(u==="offset"){G.ObservableData.prototype.setPath.call(this,["cstr","offset"],P)}else{if(u==="attach"){G.ObservableData.prototype.setPath.call(this,["cstr","attach"],P)}else{if(u==="aoffx"){G.ObservableData.prototype.setPath.call(this,["cstr","aoffx"],P)}else{if(u==="aoffy"){G.ObservableData.prototype.setPath.call(this,["cstr","aoffy"],P)}else{G.ObservableData.prototype.set.apply(this,arguments);O=true}}}}}}}if(!O){m("Use of deprecated property: Connector#"+u)}};G.Connector.prototype.toString=l("Connector");G.Connector.prototype.type=G.Type.CONNECTOR;G.Connector.prototype.internalUpdate=function(){if(this.cstr&&this.cstr.onupdate){this.cstr.onupdate(this)}else{this.set("aleft",this.node.left);this.set("left",this.node.left);this.set("atop",this.node.top);this.set("top",this.node.top);this.set("anormx",1);this.set("anormy",0)}};G.Connector.prototype.internalRecursiveUpdate=function(){this.set("hidden",this.node.hidden||(this.external&&this.node.childrenHidden))};G.Connector.prototype.getGraph=function(){return this.node&&this.node.gr};G.Connector.prototype.getParent=function(){return this.node};G.Connector.prototype.remove=function(u){if(this.node){this.node.removeConnector(this,u)}};G.Connector.prototype.bringToFront=function(){if(this.node){this.node.insertConnectorBefore(this,null)}};G.newConnectorPair=function(){var O,u;O=new G.Connector();u=new G.Connector(null,null,G.defaultInternalCstr);O.internal=u;u.external=O;return O};G.Edge=function(u,O,P){G.Element.call(this);G.ObservableData.call(this);G.Selectable.call(this);this.gr=null;this.views={main:u||null};this.data=O||null;this.next=null;this.prev=null;this.cl1=new G.EdgeLink(this);this.cl2=new G.EdgeLink(this);this.geometry=P||null;this.path=[];this._edgeOverlayingFlag=false};F.applyMixin(G.Edge,G.Element);F.applyMixin(G.Edge,G.ObservableData);F.applyMixin(G.Edge,G.Selectable);var h=G.Edge;var n=q(G.Edge,"path","geometry");C(G.Edge.prototype,"view",undefined,["views","main"]);G.Edge.prototype.customPropertyFlags=null;z[G.Type.EDGE]=Object.freeze({hidden:G.PropertyFlag.VIEW,geometry:G.PropertyFlag.VIEW|G.PropertyFlag.MODEL,path:G.PropertyFlag.VIEW});G.Edge.prototype.toString=l("Edge");G.Edge.prototype.type=G.Type.EDGE;G.Edge.prototype.internalUpdate=function(){if(this.geometry&&this.geometry.onupdate){this.geometry.onupdate(this)}else{G.LineGeometry.prototype.onupdate(this)}};G.Edge.prototype.internalRecursiveUpdate=function(){this.set("hidden",this.cl1.c.hidden||this.cl2.c.hidden)};G.Edge.prototype.split=function(V,U,Q,P,T,u){var S,R,O,W,X;if(T){X=P;P=Q;Q=X;X=U;U=V;V=X}if(!this.gr){throw new Error("edge not in graph")}if(V&&V.gr){throw new Error("e1 alreay in a graph")}if(U&&U.gr){throw new Error("e2 alreay in a graph")}if(Q.getGraph()!==this.gr){throw new Error("c1 not in expected graph")}if(P.getGraph()!==this.gr){throw new Error("c2 not in expected graph")}if(!V&&!U){throw new Error("both e1 or e2 are null")}if(!V){V=this}else{if(!U){U=this}}S=this.cl1.c;R=this.cl2.c;O=this.gr;W=this.next;O.updateLock();try{this.remove();O.insertEdgeBefore(S,Q,V,W,u);O.insertEdgeBefore(P,R,U,W,u)}finally{O.updateUnlock()}};G.Edge.prototype.join=function(Y,X,T,S,u){var W,V,Q,U,Z,P,O,R;P=Boolean(u&&u.keep1);O=Boolean(u&&u.keep2);if(u&&u.reverse){Z=S;S=T;T=Z;Z=X;X=Y;Y=Z;Z=P;P=O;O=Z}if(!Y&&!X){throw new Error("both e1 or e2 are null")}if(!Y){Y=this}else{if(!X){X=this}}if(Y===X){return}if(!Y.gr){throw new Error("e1 not in a graph")}if(!X.gr){throw new Error("e2 not in a graph")}if(Y.gr!==X.gr){throw new Error("e1 and e2 not in the same graph")}if(this.gr&&Y!==this&&X!==this){throw new Error("this edge is already in a graph and is neither e1 nor e2")}if(this===Y&&P){throw new Error("can't keep e1 when this === e1")}if(this===X&&O){throw new Error("can't keep e2 when this === e2")}if(!T||!S){if(T){R=T.node}else{if(S){R=S.node}else{if(Y.cl1.c.node===X.cl1.c.node||Y.cl1.c.node===X.cl2.c.node){R=Y.cl1.c.node}else{if(Y.cl2.c.node===X.cl1.c.node||Y.cl2.c.node===X.cl2.c.node){R=Y.cl2.c.node}else{throw new Error("no common node found")}}}}if(!R){throw new Error("c1 or c2 is not in a node")}if(!T){if(Y.cl1.c.node===R){T=Y.cl1.c}else{if(Y.cl2.c.node===R){T=Y.cl2.c}else{throw new Error("no common node found")}}}if(!S){if(X.cl1.c.node===R){S=X.cl1.c}else{if(X.cl2.c.node===R){S=X.cl2.c}else{throw new Error("no common node found")}}}}if(Y.cl1.c===T){W=Y.cl2.c}else{if(Y.cl2.c===T){W=Y.cl1.c}else{throw new Error("c1 is not a connector of e1")}}if(X.cl1.c===S){V=X.cl2.c}else{if(X.cl2.c===S){V=X.cl1.c}else{throw new Error("c2 is not a connector of e2")}}Q=Y.gr;U=Y.next!==X?Y.next:X.next;Q.updateLock();try{if(!P){Y.remove()}if(!O){X.remove()}Q.insertEdgeBefore(W,V,this,U,u&&u.insertOpts)}finally{Q.updateUnlock()}};G.Edge.prototype.multijoin=function(R,U,u){function T(ae){var ab,ad,ac,af;if(X){ab=ae.cl1.c.node===R?ae.cl2.c:ae.cl1.c;if(Z.external&&ab.external){if(Z.node!==ab.node){return}}else{if(Boolean(Z.external)!==Boolean(ab.external)){if(Z.external){ac=Z;ad=ab}else{ac=ab;ad=Z}for(af=ad.node;af&&af!==ac.node;af=af.parent){}if(!af){return}}}}ae.join(Y,ae,aa,null,Q)}var Y,P,Z,aa,Q,V,S,O,W,X;Y=this;X=Boolean(u&&u.ignoreInvalidPairs);P=this.gr;if(!P){throw new Error("edge not connected")}if(!R){if(Array.isArray(U)){throw new Error("node parameter is needed when edges is an array")}if(U.type!==G.Type.CONNECTOR){throw new Error("input is neither an array nor a connector")}R=U.node}if(this.cl1.c.node===R){aa=this.cl1.c;Z=this.cl2.c}else{if(this.cl2.c.node===R){aa=this.cl2.c;Z=this.cl1.c}else{throw new Error("this edge connectors are not on provided node")}}Q={keep1:true,reverse:Boolean(u&&u.reverse),insertOpts:u&&u.insertOpts};P.updateLock();try{if(Array.isArray(U)){for(V=0,S=U.length;V<S;++V){T(U[V])}}else{if(U.type!==G.Type.CONNECTOR){throw new Error("input is neither an array nor a connector")}for(O=U.children.first;O;O=W){W=O.nextEdge();T(O.ref)}}if(!u||!u.keep){this.remove()}}finally{P.updateUnlock()}};G.Edge.prototype.remove=function(u){if(this.gr){this.gr.removeEdge(this,u)}};G.Edge.prototype.getGraph=function(){return this.gr};G.Edge.prototype.getParent=function(){return this.gr};G.Edge.prototype.bringToFront=function(){if(this.cl1&&this.cl2){this.gr.insertEdgeBefore(this.cl1.c,this.cl2.c,this,null)}};G.LineGeometry=function(){};G.LineGeometry.prototype.onupdate=function(O){var u=[G.PathCmd.M,O.cl1.c.aleft,O.cl1.c.atop,G.PathCmd.L,O.cl2.c.aleft,O.cl2.c.atop];O.set("path",u)};G.ReshapableEdge=function(){this.reshapable=true};G.ReshapableEdge.prototype.getPickedSegmentOptions=function(){throw new Error("Not implemented")};G.ReshapableEdge.prototype.isReshapingValid=function(){throw new Error("Not implemented")};G.ReshapableEdge.prototype.reshapePath=function(){throw new Error("Not implemented")};G.ReshapableEdge.prototype.refinePath=function(){throw new Error("Not implemented")};G.SplittableEdge=function(){this.splittable=true;this.splitMargin=10};G.SplittableEdge.prototype.getPickedSegmentOptions=function(){throw new Error("Not implemented")};G.SplittableEdge.prototype.isSplitValid=function(){throw new Error("Not implemented")};G.SplittableEdge.prototype.splitPath=function(){throw new Error("Not implemented")};G.StairGeometry=function(u){G.ReshapableEdge.call(this);G.SplittableEdge.call(this);if(!u){return}if(!isNaN(u.nbStairs)&&u.nbStairs>=0){this.nbStairs=u.nbStairs}if(u.reshapable===false){this.reshapable=false}if(u.splittable===false){this.splittable=false}};F.applyMixin(G.StairGeometry,G.ReshapableEdge);F.applyMixin(G.StairGeometry,G.SplittableEdge);G.StairGeometry.prototype.nbStairs=1;function t(ac){var X,V,T,Z,Y,ad;ad=false;T=5;X=ac.slice(0);for(var V=3;V<X.length-3;V+=3){if(X[V]!==G.PathCmd.L){continue}var W=X[V-2];var U=X[V-1];var S=X[V+1];var R=X[V+2];var ab=X[V+4];var aa=X[V+5];var Q=X[V+7];var P=X[V+8];var Z=Math.abs(ab-S);var Y=Math.abs(aa-R);if(Z===0&&Y<=T||Y===0&&Z<=T){if(V===3&&W+T>Q){continue}else{if(V===X.length-9&&Q-T<W){continue}}var O=Math.abs(Q-W);var u=Math.abs(P-U);if(O<=T){X[V-2]=Q}else{if(u<=T){X[V-1]=P}}X.splice(V,6);ad=true}}return{modified:ad,path:X}}G.StairGeometry.prototype.onupdate=function(Y){function Z(ac,ae,ad){return ac.x===ad[1]&&ac.y===ad[2]&&ae.x===ad[ad.length-1]&&ae.y===ad[ad.length-2]}var Q={x:Y.cl1.c.aleft,y:Y.cl1.c.atop};var T={x:Y.cl2.c.aleft,y:Y.cl2.c.atop};if(Y.path.length&&Z(Q,T,Y.path)){return}if(Y.path&&Y.path.length!==6&&(Y.reshaped||Y.splitted)){var X=Y.path.slice();var S={x:X[1],y:X[2]};var ab={x:X[X.length-2],y:X[X.length-1]};if(S.x!==Q.x){X[1]=Q.x}if(S.y!==Q.y){X[2]=Q.y;X[5]=Q.y}if(ab.x!==T.x){X[X.length-2]=T.x}if(ab.y!==T.y){X[X.length-1]=T.y;X[X.length-4]=T.y}Y.gr.withLockedUpdate(function W(){Y.set("path",X)});return}Y.reshaped=false;Y.splitted=false;var R=5;var O,V,U;if(Q.x===T.x||Q.y===T.y){U=0}else{if(Math.abs(Q.x-T.x)<R||Math.abs(Q.y-T.y)<R){U=1;O=Math.floor((T.x-Q.x)/2);V=T.y-Q.y}else{U=this.nbStairs+1;do{U--;O=Math.floor((T.x-Q.x)/(U+1));V=Math.floor((T.y-Q.y)/U)}while(U>1&&(Math.abs(O)<R||Math.abs(V)<R))}}var X=[G.PathCmd.M,Q.x,Q.y];var P=Q.x,u=Q.y;for(var aa=0;aa<2*U-1;aa++){if(aa%2===0){P+=O}else{u+=V}X.push(G.PathCmd.L,P,u)}if(this.nbStairs>0){X.push(G.PathCmd.L,P,T.y)}X.push(G.PathCmd.L,T.x,T.y);Y.gr.withLockedUpdate(function W(){Y.set("path",X)})};G.StairGeometry.prototype.isOnSegment=function(V,R,O,U,u,S){var X,Q,W,P,T;var X=V-O;var Q=R-U;var W=u-O;var P=S-U;if(Math.abs(X)<5){X=0}if(Math.abs(Q)<5){Q=0}T=X*P-Q*W;if(T!==0){return false}if(Math.abs(W)>=Math.abs(P)){return W>0?O<=V&&V<=u:u<=V&&V<=O}else{return P>0?U<=R&&R<=S:S<=R&&R<=U}};G.StairGeometry.prototype.getPickedSegmentOptions=function(T,R){if(!T||!R){return{index:-1,direction:[0,0]}}function Q(Y,X){var Z=[],ab=[];for(var ad=0;ad<=Y.path.length-3;ad+=3){Z.push(Y.path[ad+1]);ab.push(Y.path[ad+2])}var ac=Math.min.apply(null,Z);var W=Math.max.apply(null,Z);var aa=Math.min.apply(null,ab);var V=Math.max.apply(null,ab);if(X[0]>ac&&X[0]<W&&X[1]>aa&&X[1]<V){return true}return false}if(!T.reshaped&&T.reshaped!==undefined&&!Q(T,R)){return{index:-1,direction:[0,0]}}var U=T.path[1],S=T.path[2];var P,O;for(var u=3;u<T.path.length;u+=3){P=T.path[u+1];O=T.path[u+2];if(this.isOnSegment(R[0],R[1],U,S,P,O)){return{index:u,direction:[T.path[u+1]-U,T.path[u+2]-S]}}U=P;S=O}return{index:-1,direction:[0,0]}};G.StairGeometry.prototype.isReshapingValid=function(R,Q,u){var P,O;if(!R||!Q){return false}O=Q.direction;P=Q.index;return(O[0]===0||O[1]===0)&&O[0]+O[1]!==0&&P!==3&&P!==R.path.length-3};G.StairGeometry.prototype.reshapePath=function(O,U,ad,aa,u,ac,T){var W,V,Z,P,R,Y;if(!O||!U||!ad){return}if(T!==null&&T!==undefined){P=T}else{P=20}Z=U.direction&&U.direction[1]===0;W=O.path.slice(0);V=U.index;var ab=aa?aa:-Infinity;var X=u?u:Infinity;R=V===6?(Z?W[2]:W[1])+P:ab;Y=V===W.length-6?(Z?W[W.length-1]:W[W.length-2])-P:X;if(Z){if(ad[1]<R){W[V+2]=R;W[V-1]=R}else{if(ad[1]>Y){W[V+2]=Y;W[V-1]=Y}else{W[V+2]=ad[1];W[V-1]=ad[1]}}if(ac){var Q=ac(W[V+2],W[V-1]);if(Q&&Q.length===2){W[V+2]=Q[0];W[V-1]=Q[1]}}}else{if(ad[0]<R){W[V+1]=R;W[V-2]=R}else{if(ad[0]>Y){W[V+1]=Y;W[V-2]=Y}else{W[V+1]=ad[0];W[V-2]=ad[0]}}if(ac){var Q=ac(W[V+1],W[V-2]);if(Q&&Q.length===2){W[V+1]=Q[0];W[V-2]=Q[1]}}}O.gr.withLockedUpdate(function S(){O.set("path",W);O.reshaped=true;O.reshapeInProgress=true})};G.StairGeometry.prototype.isSplitValid=function(T,R,S){if(!T||!R){return false}var P=R.direction;var O=R.index;if(!P||P[0]!==0&&P[1]!==0||P[0]+P[1]===0){return false}if(O<6||O>T.path.length-4){return false}var Q=(P[0]===0);var u=5;if(Q){var U=T.path[O-2]-T.path[O-5]>0?+1:-1;if(Math.abs(S[1]-T.path[O-1])<u){return false}if(Math.abs(S[1]-T.path[O+2])<u){return false}if(Math.abs((T.path[O+1]-U*this.splitMargin)-T.path[O+4])<u){return false}}else{var U=T.path[O-1]-T.path[O-4]>0?+1:-1;if(Math.abs(S[0]-T.path[O-2])<u){return false}if(Math.abs(S[0]-T.path[O+1])<u){return false}if(Math.abs((T.path[O+2]-U*this.splitMargin)-T.path[O+5])<u){return false}}return true};G.StairGeometry.prototype.splitPath=function(T,Q,S){var R,O,P,U;if(!T||!Q||!S){return}P=Q.direction[0]===0;R=T.path.slice(0);O=Q.index;if(P){U=R[O-2]-R[O-5]>0?+1:-1;R[O-2]+=U*this.splitMargin;R[O+1]-=U*this.splitMargin;R.splice(O,0,G.PathCmd.L,R[O-2],S[1],G.PathCmd.L,R[O+1],S[1])}else{U=R[O-1]-R[O-4]>0?+1:-1;R[O+2]-=U*this.splitMargin;R[O-1]+=U*this.splitMargin;R.splice(O,0,G.PathCmd.L,S[0],R[O-1],G.PathCmd.L,S[0],R[O+2])}T.gr.withLockedUpdate(function u(){T.set("path",R);T.splitted=true})};G.StairGeometry.prototype.refinePath=function(O){if(!O||!O.path||!O.reshapeInProgress){return}O.reshapeInProgress=false;var P=t(O.path);if(P.modified){O.gr.withLockedUpdate(function u(){O.set("path",P.path)})}};G.AutoBezierGeometry=function(u){if(!isNaN(u)&&u>=0){this.minTangentLength=u}};G.AutoBezierGeometry.prototype.minTangentLength=120;G.AutoBezierGeometry.prototype.onupdate=function(U){var Q,P,ac,aa,O,Y,u,W,X,V,S,R,ab,Z,T;Q=U.cl1.c.anormx;P=U.cl1.c.anormy;ac=U.cl2.c.anormx;aa=U.cl2.c.anormy;X=U.cl1.c.aleft;V=U.cl1.c.atop;S=U.cl2.c.aleft;R=U.cl2.c.atop;ab=Math.max(this.minTangentLength,Math.abs(S-X));Z=Math.max(this.minTangentLength,Math.abs(R-V));O=X+ab*Q/2;Y=V+Z*P/2;u=S+ab*ac/2;W=R+Z*aa/2;T=[G.PathCmd.M,X,V,G.PathCmd.C,S,R,O,Y,u,W];U.set("path",T)};G.EGraph=function(u,O){G.ObservableData.call(this);G.Observable.call(this);G.Grouping.call(this);this.views={};this.viewsList=[];this.data=O||null;this.edges=new G.List();this.selection=new G.SelectionList();this.boundChangeListener=this.changeListener.bind(this);this.updateLockCount=0;this.boundDelayedUpdate=this.delayedUpdate.bind(this);this.delayedUpdatePending=false;this.mark=undefined;this.registerNewElement(this);if(u){this.addView("main",u)}this.edgePickingAreaOpts=undefined;this.zoomOpts=undefined;this._edgePickingAreaList=[]};F.applyMixin(G.EGraph,G.ObservableData);F.applyMixin(G.EGraph,G.Observable);F.applyMixin(G.EGraph,G.Grouping);C(G.EGraph.prototype,"view",undefined,["views","main"]);G.EGraph.prototype.toString=l("EGraph");G.EGraph.prototype.parent=null;G.EGraph.prototype.childrenHidden=false;G.EGraph.prototype.type=G.Type.EGRAPH;G.EGraph.prototype.originLeft=0;G.EGraph.prototype.originTop=0;z[G.Type.EGRAPH]=Object.freeze({nodes:G.PropertyFlag.VIEW,edges:G.PropertyFlag.VIEW});G.EGraph.prototype.addView=function(O,u){if(this.views.hasOwnProperty(O)){throw new Error("Views with same key already exists: "+O)}if(!u){throw new Error("Null view")}this.views[O]=u;this.viewsList.push(u);if(u.oninit){if(G.EGraph.traceUpdates){console.log("Initialization of view "+O+":")}u.oninit(this,O)}};G.EGraph.prototype.setEdgePickingAreaOpts=function(u){this.edgePickingAreaOpts=u};G.EGraph.prototype.setZoomOpts=function(u){this.zoomOpts=u};G.EGraph.prototype.addAllChangeListener=function(u){if(typeof u!=="function"){throw new Error("Listener must be a function")}this.allListeners=(this.allListeners||[]).concat(u)};G.EGraph.prototype.removeAllChangeListener=function(O){var u;if(this.allListeners){u=this.allListeners.indexOf(O);if(u!==-1){this.allListeners=this.slice(0,u).concat(this.slice(u+1));return true}}return false};G.EGraph.prototype.changeListener=function(P){var O,u;this.storeUpdateChanges(P);if(this.allListeners){for(O=0,u=this.allListeners.length;O<u;++O){this.allListeners[O](P)}}};function w(S,R,T,O){var P,u,Q;T|=0;for(P=T,u=R.length;S&&S.constructor===Object&&P<u;++P,S=S[Q]){Q=R[P];if(Q===""){throw new Error("Invalid argument: path contains empty string")}if(!S.hasOwnProperty(Q)){return undefined}}if(S&&S.constructor===Object){return S.hasOwnProperty("")?S[""]:O}else{return S}}function s(P,O){var u;if(!z.hasOwnProperty(O.type)){throw new Error("Invalid argument: obj should be a graph element")}u=z[O.type];if(P[0]==="data"){return O.customPropertyFlags?w(O.customPropertyFlags,P,1)|0:0}else{return w(u,P)|0}}var e=G.PropertyFlag.VIEW|G.PropertyFlag.MODEL;function x(P,V,U){var u=[],O=[],R,Q,S;var T;for(T=P.gr.view.domRoot;T.parentNode;T=T.parentNode){}while((R=T.elementFromPoint(V,U))&&u.indexOf(R)===-1&&R!=null){u.push(R);O.push({value:R.style.getPropertyValue("pointer-events"),priority:R.style.getPropertyPriority("pointer-events")});R.style.setProperty("pointer-events","none","important")}for(Q=O.length;S=O[--Q];){u[Q].style.setProperty("pointer-events",S.value?S.value:"",S.priority)}return u}G.EGraph.prototype._restoreEdgePickingAreasSelectionCapability=function(){if(!this.edgePickingAreaOpts||!this.edgePickingAreaOpts.activate){return}var u=undefined;while(this._edgePickingAreaList.length>0){u=this._edgePickingAreaList.pop();u.element.view.display.pickingAreaElt.style.pointerEvents=u.pointerEvents}};G.EGraph.prototype._removeEdgePickingAreasSelectionCapability=function(u){if(!this.edgePickingAreaOpts||!this.edgePickingAreaOpts.activate){return}if(u&&u.type===G.Type.EDGE){if(u._edgeOverlayingFlag){this._edgePickingAreaList.push({element:u,pointerEvents:u.view.display.pickingAreaElt.style.pointerEvents});u.view.display.pickingAreaElt.style.pointerEvents="none"}if(!u._edgeOverlayingFlag&&this._edgePickingAreaList.length>0){this._restoreEdgePickingAreasSelectionCapability();this._edgePickingAreaList.push({element:u,pointerEvents:u.view.display.pickingAreaElt.style.pointerEvents});u.view.display.pickingAreaElt.style.pointerEvents="none"}}};G.EGraph.prototype._setEdgePickingAreaOverlayingFromPoint=function(P,u,S){if(!this.edgePickingAreaOpts||!this.edgePickingAreaOpts.activate){return}if(P&&P.type===G.Type.EDGE){P._edgeOverlayingFlag=false;var O=P.view.display.pickingAreaElt.style.pointerEvents;P.view.display.pickingAreaElt.style.pointerEvents="none";var R=x(P,u,S);var Q;for(Q=0;Q<R.length;Q++){if(R[Q]&&R[Q].tagName==="path"){P._edgeOverlayingFlag=true;break}}P.view.display.pickingAreaElt.style.pointerEvents=O}};G.EGraph.prototype._updateEdgePickingAreaSize=function(T,P){if(!this.edgePickingAreaOpts||!this.edgePickingAreaOpts.activate){return}if(T&&T.type===G.Type.EDGE){var Q=undefined,U=undefined,S=0,u=0,O=P;var R=1.5,V=2.5;Q=T.view.display.elt;U=T.view.display.pickingAreaElt;if(Q.style.strokeWidth!==""){u=Number(Q.style.strokeWidth.strokeWidth.replace("px",""))}else{if(T.selected==true){u=V}else{if(Q.parentNode.className.baseVal==="modifiable"){u=V}else{u=R}}}if(O==0){O=1;if(T.gr&&T.gr.view&&T.gr.view.vpt&&T.gr.view.vpt[2]){O=T.gr.view.vpt[2]}}S=this.edgePickingAreaOpts.size/O;U.style.strokeWidth=(S>=u)?S:u}};G.EGraph.prototype.updateEdgesPickingAreasSize=function(O){if(!this.edgePickingAreaOpts||!this.edgePickingAreaOpts.activate){return}var u=undefined;for(u=this.edges.first;u;u=u.next){this._updateEdgePickingAreaSize(u,O)}};G.EGraph.prototype.storeUpdateChanges=function(R){var P,O,Q,S,u;for(P=0,O=R.length;P<O;++P){Q=R[P];if(Q.type==="updated"){S=Q.object;u=s(Q.path,S);if(u&e){if(!this.pendingUpdateChanges){this.pendingUpdateChanges=[]}this.pendingUpdateChanges.push(Q)}}else{if(Q.type==="added"||Q.type==="removed"||Q.type==="moved"){if(!this.pendingUpdateChanges){this.pendingUpdateChanges=[]}this.pendingUpdateChanges.push(Q)}}}if(!this.updateLockCount&&!this.delayedUpdatePending){this.delayedUpdatePending=true;G.ObservableData.addPostCallsCB(this.boundDelayedUpdate)}};G.EGraph.prototype.delayedUpdate=function(){this.delayedUpdatePending=false;this.updateLock();this.updateUnlock()};G.EGraph.prototype.isUpdated=function D(){return !this.updateLockCount&&!this.delayedUpdatePending};G.EGraph.prototype.withLockedUpdate=function K(O,u){this.updateLock();try{return O.call(u)}finally{this.updateUnlock()}};G.EGraph.prototype.updateLock=function(){++this.updateLockCount};G.EGraph.traceUpdates=false;G.EGraph.prototype.updateUnlock=function(){var Q,P,O;if(this.updateLockCount<=0){throw new Error("Illage State: extraneous unlock of object")}if(this.updateLockCount===1){try{var u=0;while(this.pendingUpdateChanges){Q=this.pendingUpdateChanges;this.pendingUpdateChanges=null;if(G.EGraph.traceUpdates){if(u>50){throw new Error("too many loops")}console.log("Update loop "+(++u)+":");for(P=0,O=Q.length;P<O;++P){console.log("  "+Q[P])}}this.applyChanges2(Q)}if(!u&&G.EGraph.traceUpdates){console.log("Update: no pending changes so no update loop occured")}}finally{this.updateLockCount=0}this.dispatch({type:"update"})}else{--this.updateLockCount}};function d(R,Q){var O,u,P;for(O=0,u=R.length;O<u;++O){P=R[O];if(!Q.hasOwnProperty(P)){Q[P]=O===u-1?true:{}}Q=Q[P];if((O!==u-1)===(typeof Q!=="object")){throw new Error("Only leaf of composited properties can be modified")}}}G.topologicalSortNodes=function(P,u){var X,U,T,S,R,Q,O,V,W;S=P.length;if(!S){return}W=[];X=new G.MarksScope();try{for(U=0;U<S;++U){R=P[U];if(R.type!==G.Type.NODE&&R.type!==G.Type.GROUP){throw new Error("element is not a node/group")}for(Q=R;Q&&Q.mark===undefined;Q=Q.parent){X.setMark(Q,false);if(!Q.parent){W.push(Q)}}R.mark=true}for(T=0,U=0,O=W.length;U<O;++U){V=W[U];for(Q=V;Q;Q=G.dftNext(V,Q,Q.mark===undefined||(Q.mark&&u))){if(Q.mark){P[T++]=Q}}}P.length=T}finally{X.dispose()}};function E(u){var Q,O,R,P;R=u.length;Q=0,O=R;while(Q<O){while(Q<R&&!u[Q].external){++Q}while(O>0&&u[O-1].external){--O}if(Q<O){--O;P=u[Q];u[Q]=u[O];u[O]=P;++Q}}}G.EGraph.prototype.applyChanges2=function(X){var S,O,U;U=this;O=[];S=[];function Q(ac,ab){if(!ac.__updateFlag__){if(!O[ac.type]){O[ac.type]=[]}O[ac.type].push(ac)}ac.__updateFlag__|=ab}function W(ad,ac){var ae,ab;if(!ad.getGraph()){return}ab=false;if((ad.__updateFlag__&1)===0){Q(ad,1);if(!S[ad.type]){S[ad.type]=[]}S[ad.type].push(ad);ab=true;if(ad.parent&&ad.parent.type===G.Type.GROUP){W(ad.parent)}}if(ac&&(ad.__updateFlag__&128)===0){Q(ad,128);ab=true;if(ad.nodes){for(ae=ad.nodes.first;ae;ae=ae.next){W(ae,true)}}}if(ab){if(ad.children){for(ae=ad.children.first;ae;ae=ae.next){W(ae.ref||ae,ac)}}if(ad.type===G.Type.CONNECTOR&&ad.internal){W(ad.internal,ac)}}}function P(ac,ab){ac.__updateFlag__&=~ab}function R(){var ad,ab,af,ae,ac;for(ad=0,ab=O.length;ad<ab;++ad){af=O[ad];if(af){for(ae=0,ac=af.length;ae<ac;++ae){af[ae].__updateFlag__=0;if(af[ae].__modifiedProperties__){af[ae].__modifiedProperties__=null}if(af[ae].__lastParent__){af[ae].__lastParent__=null}}}}}function T(ae){var ac,ab,ad;for(ac=0,ab=ae.length;ac<ab;++ac){ad=ae[ac];if(Boolean(ad.__updateFlag__&32)!==Boolean(ad.__updateFlag__&64)){if(!ad.__modifiedProperties__){ad.__modifiedProperties__={}}d(["selected"],ad.__modifiedProperties__);Q(ad,2)}}}function V(){var ae,ac,ab,af,ah,ai,ad,ag;for(ae=0,ac=X.length;ae<ac;++ae){af=X[ae];ah=af.object;ab=s(af.path,ah);if(ab&G.PropertyFlag.VIEW){if(!ah.__modifiedProperties__){ah.__modifiedProperties__={}}d(af.path,ah.__modifiedProperties__);Q(ah,2)}if(ab&G.PropertyFlag.MODEL){W(ah,ab&G.PropertyFlag.RECURSIVE)}if(af.type==="added"||af.type==="removed"||af.type==="moved"){if(af.object.type===G.Type.EGRAPH&&af.path[0]==="selection"){ai=af.child;if(af.type==="added"){Q(ai,32)}else{if(af.type==="removed"){if(ai.__updateFlag__&32){P(ai,32)}else{Q(ai,64)}}}}else{ai=af.child;ai=ai.ref||ai;if(((af.object.type===G.Type.EGRAPH||af.object.type===G.Type.GROUP)&&af.path[0]==="nodes")||(af.object.type===G.Type.EGRAPH&&af.path[0]==="edges")||((af.object.type===G.Type.NODE||af.object.type===G.Type.GROUP)&&af.path[0]==="children")){if(af.type==="added"){Q(ai,4)}else{if(af.type==="moved"){if((ai.__updateFlag__&(4|8))===0){Q(ai,16)}}else{if(ai.__updateFlag__&4){P(ai,4)}else{Q(ai,8);ai.__lastParent__=af.object;P(ai,16)}}}}}}}ad=O[G.Type.GROUP];if(ad){for(ae=0,ac=ad.length;ae<ac;++ae){ah=ad[ae];ab=ah.__updateFlag__&(4|8);if(ab){for(ai=ah;ai;ai=G.dftNext(ah,ai)){Q(ai,ab);for(ag=ai.children.first;ag;ag=ag.next){Q(ag,ab)}}}}}ad=O[G.Type.NODE];if(ad){for(ae=0,ac=ad.length;ae<ac;++ae){ah=ad[ae];ab=ah.__updateFlag__&(4|8);if(ab){for(ai=ah.children.first;ai;ai=ai.next){Q(ai,ab)}}}}for(ae=0,ac=O.length;ae<ac;++ae){if(O[ae]){T(O[ae])}}}function u(ae,ac){var ab,ad;if(ae){if(G.EGraph.traceUpdates){console.log("  recursive update of "+ac);for(ab=ae.length;ab-->0;){if(ae[ab].__updateFlag__&128){console.log("    "+ae[ab])}}}for(ab=ae.length;ab-->0;){if(ae[ab].__updateFlag__&128){ad=ae[ab];ad.internalRecursiveUpdate();Z(ae[ab])}}}}function aa(){var ad,ab,af,ae,ac;for(ad=0,ab=O.length;ad<ab;++ad){af=O[ad];if(af){for(ae=0,ac=af.length;ae<ac;++ae){if((af[ae].__updateFlag__&(4|16))!==0){W(af[ae],true)}else{if((ad===G.Type.GROUP||ad===G.Type.NODE)&&(af[ae].__updateFlag__&8)!==0&&af[ae].__lastParent__&&af[ae].__lastParent__.type===G.Type.GROUP){W(af[ae].__lastParent__,false)}}}}}if(S[G.Type.GROUP]){G.topologicalSortNodes(S[G.Type.GROUP]);S[G.Type.GROUP].reverse()}if(S[G.Type.CONNECTOR]){E(S[G.Type.CONNECTOR])}u(S[G.Type.GROUP],"groups");u(S[G.Type.NODE],"nodes");u(S[G.Type.CONNECTOR],"connectors");u(S[G.Type.EDGE],"edges");for(ad=0,ab=S.length;ad<ab;++ad){af=S[ad];if(!af){continue}if(G.EGraph.traceUpdates){console.log("  update "+G.Type2Str[ad]);for(ae=0,ac=af.length;ae<ac;++ae){console.log("    "+af[ae])}}for(ae=0,ac=af?af.length:0;ae<ac;++ae){af[ae].internalUpdate();Z(af[ae])}}}function Z(ab){var ag,af,ae,ad,ah,ac;af=U.pendingUpdateChanges;U.pendingUpdateChanges=null;if(!af){return}if(G.EGraph.traceUpdates){console.log("  changes due to update of "+ab+":");for(ae=0,ad=af.length;ae<ad;++ae){console.log("    "+af[ae])}}for(ae=0,ad=af.length;ae<ad;++ae){ag=af[ae];if(ag.type==="updated"){ah=ag.object;ac=s(ag.path,ah);if(ac&G.PropertyFlag.VIEW){if(!ah.__modifiedProperties__){ah.__modifiedProperties__={}}d(ag.path,ah.__modifiedProperties__);Q(ah,2)}if(ac&G.PropertyFlag.MODEL){throw new Error("Change of a property that would trigger a new update during update: "+ag)}}else{throw new Error("Invalid type of change during update (only change of properties accepted): "+ag)}}}function Y(){var ad,ac,ab;if(O[G.Type.GROUP]){G.topologicalSortNodes(O[G.Type.GROUP])}for(ad=0,ac=U.viewsList.length;ad<ac;++ad){ab=U.viewsList[ad];if(ab&&ab.onupdate){ab.onupdate(U,O)}}}try{V();aa();Y()}finally{R()}};G.EGraph.prototype.registerNewElement=function(u){if(u.__graph__){if(u.__graph__!==this){throw new Error("Element already registered in an other graph")}}else{u.__graph__=this;u.addChangeListener(this.boundChangeListener)}};G.EGraph.prototype.removeEdge=function(T,R){var P,O,S,u,Q;if(T.getGraph()!==this){throw new Error("Edge not in this graph")}G.ObservableData.lock();try{this.removeFromSelection(T);P=T.cl1.c;O=T.cl2.c;u=T.cl1.next;Q=T.cl2.next;S=T.next;T.cl1.c.children.remove(T.cl1);T.cl1.c=null;T.cl2.c.children.remove(T.cl2);T.cl2.c=null;this.edges.remove(T);T.gr=null;this.notify(new G.RemovedNotif(["edges"],T,S));P.notify(new G.RemovedNotif(["children"],T.cl1,u));O.notify(new G.RemovedNotif(["children"],T.cl2,Q))}finally{G.ObservableData.unlock()}};G.EGraph.prototype.removeConnector=function(u){if(!u.node){throw new Error("connector not in a node")}u.node.removeConnector(u)};G.EGraph.prototype.addToSelection=function(u){if(u.getGraph()!==this){throw new Error("Element not in this graph")}if(!this.isSelected(u)){this._removeEdgePickingAreasSelectionCapability(u);this.selection.addLast(u);this.notify(new G.AddedNotif(["selection"],u,null));this._updateEdgePickingAreaSize(u,0)}};G.SelectionMode={REPLACE:0,ADD:1,SUBTRACT:2,INTERSECT:3};G.EGraph.prototype.updateSelection=function(R,T){var O,u,S,Q,P;if(!Array.isArray(R)){throw new Error("elements must be an array")}if(T===undefined){T=G.SelectionMode.REPLACE}this.updateLock();try{P=new G.MarksScope();try{if(T===G.SelectionMode.SUBTRACT){for(O=0,u=R.length;O<u;++O){this.removeFromSelection(R[O])}}else{if(T===G.SelectionMode.ADD){for(O=0,u=R.length;O<u;++O){this.addToSelection(R[O])}}else{if(T===G.SelectionMode.REPLACE||T===G.SelectionMode.INTERSECT){for(O=0,u=R.length;O<u;++O){P.setMark(R[O],true)}for(S=this.selection.first;S;S=Q){Q=S.nextSel;if(!S.mark){this.removeFromSelection(S)}}if(T===G.SelectionMode.REPLACE){for(O=0,u=R.length;O<u;++O){this.addToSelection(R[O])}}}else{throw new Error("invalid mode: "+T)}}}}finally{P.dispose()}}finally{this.updateUnlock()}};G.EGraph.prototype.removeFromSelection=function(u){var O;if(u.getGraph()!==this){throw new Error("Element not in this graph")}if(this.isSelected(u)){O=u.nextSel;this.selection.remove(u);this.notify(new G.RemovedNotif(["selection"],u,O));this._updateEdgePickingAreaSize(u,0)}};G.EGraph.prototype.isSelected=function(u){if(u.getGraph()!==this){throw new Error("Element not in this graph")}return Boolean(u.nextSel||u.prevSel||u===this.selection.first)};G.EGraph.prototype.clearSelection=function(){var O,u;G.ObservableData.lock();try{for(O=this.selection.first;O;O=u){u=O.nextSel;this.removeFromSelection(O)}this._restoreEdgePickingAreasSelectionCapability()}finally{G.ObservableData.unlock()}};G.EGraph.prototype.replaceSelectionWith=function(u){var P=false,Q,O;if(u.getGraph()!==this){throw new Error("Element not in this graph")}for(Q=this.selection.first;Q;Q=O){O=Q.nextSel;if(Q!==u){this.removeFromSelection(Q)}else{P=true}}if(!P){this.addToSelection(u)}};G.EGraph.prototype.bringNodeToFront=function(u){u.bringToFront()};G.EGraph.prototype.addConnector=function(O,u){O.insertConnectorBefore(u,null)};G.EGraph.prototype.addEdge=function(O,u,Q,P){this.insertEdgeBefore(O,u,Q,null,P)};G.EGraph.prototype.insertEdgeBefore=function(R,Q,O,P,u){var V,S,U,T,X,W;this.registerNewElement(O);if(R.getGraph()!==this){throw new Error("Connector not in this graph")}if(Q.getGraph()!==this){throw new Error("Connector not in this graph")}if(R===Q){throw new Error("Self loop not (yet) supported")}if(P&&P.gr!==this){throw new Error("nextEdge not in this graph")}if(P===O){throw new Error("can't insert an edge before itself")}if(u&&u.autoPairSelection&&(R.internal||R.external||Q.internal||Q.external)){R=R.external||R;Q=Q.external||Q;U=R.node;T=Q.node;X=U;W=T;while((X||W)&&X!==T&&W!==U){if(X){X=X.parent}if(W){W=W.parent}}if(X===T){if(Q.internal){Q=Q.internal}}if(W===U){if(R.internal){R=R.internal}}}if(O.gr){if(O.cl1.c!==R||O.cl2.c!==Q){throw new Error("can't change edge connectors with reorder; remove first")}S=O.next;this.edges.remove(O);V=true}else{V=false}this.edges.insertBefore(O,P);O.gr=this;if(!V){R.children.addLast(O.cl1);Q.children.addLast(O.cl2);O.cl1.c=R;O.cl2.c=Q}if(V){this.notify(new G.MovedNotif(["edges"],O,null,S))}else{G.ObservableData.lock();try{this.notify(new G.AddedNotif(["edges"],O,null));R.notify(new G.AddedNotif(["children"],O.cl1,null));Q.notify(new G.AddedNotif(["children"],O.cl2,null))}finally{G.ObservableData.unlock()}}};G.EGraph.prototype.update=function(u){m("stack dump")};return G});define("egraph/core",["DS/egraph/core"],function mod(a){return a});define("DS/egraph/views",["DS/egraph/core","DS/egraph/utils"],function(x,A){var E={},g="http://www.w3.org/2000/svg",n=document.createElementNS(g,"svg"),d=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame,h=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame;E.EltView=function(){};function m(F,H,L,K){var G,J,I;G=F.getParent();J=G?G.views[L.viewKey]:null;I=K?K.views[L.viewKey]:null;this.onposition(F,K,L,J,I)}function e(F,G,I,H){if(G){this.onmodify(F,G,I)}m.call(this,F,G,I,H)}E.EltView.prototype.oninsert=function(F,G,I,H){if(this.__viewFlag__&2){e.call(this,F,G,I,H)}else{this.__viewFlag__|=2;this.oncreate(F,I);this.onmodify(F,true,I);m.call(this,F,G,I,H)}};E.EltView.prototype.onreorder=function(F,G,I,H){e.call(this,F,G,I,H)};E.EltView.prototype.onupdate=function(F,G,H){if(this.__viewFlag__&2){this.onmodify(F,G,H)}};E.EltView.prototype.onselect=function(){};E.EltView.prototype.onremove=function(F,H,I,G){if(!G){this.__viewFlag__&=~2;this.ondestroy(F,I)}};E.EltView.prototype.oncreate=function(F,G){};E.EltView.prototype.onposition=function(F,I,J,H,G){};E.EltView.prototype.onmodify=function(F,G,H){};E.EltView.prototype.ondestroy=function(F,G){};E.LayeredEltView=function(){E.EltView.call(this)};A.inherit(E.LayeredEltView,E.EltView);E.LayeredEltView.prototype.oncreate=function(F,G){this.oncreateStructure(F,G);this.oncreateDisplay(F,G)};E.LayeredEltView.prototype.onposition=function(F,I,J,H,G){this.onpositionStructure(F,I,J,H,G)};E.LayeredEltView.prototype.onmodify=function(F,G,H){this.onmodifyStructure(F,G,H);if(G&&this.onvoteResetDisplay(F,G,H)){this.ondestroyDisplay(F,H);this.oncreateDisplay(F,H);this.onmodifyDisplay(F,true,H)}else{this.onmodifyDisplay(F,G,H)}};E.LayeredEltView.prototype.ondestroy=function(F,G){this.ondestroyDisplay(F,G);this.ondestroyStructure(F,G)};E.LayeredEltView.prototype.oncreateStructure=function(F,G){};E.LayeredEltView.prototype.onpositionStructure=function(F,I,J,H,G){};E.LayeredEltView.prototype.onmodifyStructure=function(F,G,H){};E.LayeredEltView.prototype.ondestroyStructure=function(F,G){};E.LayeredEltView.prototype.oncreateDisplay=function(F,G){};E.LayeredEltView.prototype.onvoteResetDisplay=function(F,G,H){return false};E.LayeredEltView.prototype.onmodifyDisplay=function(F,G,H){};E.LayeredEltView.prototype.ondestroyDisplay=function(F,G){};E.DOMView=function(){E.LayeredEltView.call(this);this.display={};this.structure={};this["deprecated-elts"]={};this["deprecated-lays"]={}};E.HTMLView=E.DOMView;A.inherit(E.DOMView,E.LayeredEltView);x.makeRewriter(E.DOMView.prototype,"elts",undefined,["deprecated-elts"]);x.makeRewriter(E.DOMView.prototype,"lays",undefined,["deprecated-lays"]);function o(I){var F,H,G;for(F in I){if(I.hasOwnProperty(F)){H=I[F];if(H){I[F]=null;G=H.parentNode||H.parentLayer;if(G){G.removeChild(H)}}}}}E.DOMView.prototype.ondestroy=function(){E.LayeredEltView.prototype.ondestroy.apply(this,arguments);if(this["deprecated-elts"]){o(this["deprecated-elts"])}if(this["deprecated-lays"]){o(this["deprecated-lays"])}};E.DOMView.prototype.ondestroyStructure=function(){E.LayeredEltView.prototype.ondestroyStructure.apply(this,arguments);o(this.structure)};E.DOMView.prototype.onpositionStructure=function(H,K,L,N,M){var O,I,J,G,F;if(this.reorderElts&&this["deprecated-elts"]||this.reorderLays&&this["deprecated-lays"]){if(this.reorderElts&&this["deprecated-elts"]){for(J=0,G=this.reorderElts.length;J<G;++J){I=this.reorderElts[J];O=this["deprecated-elts"][I];if(O){if(M){F=M["deprecated-elts"]&&M["deprecated-elts"][I];if(!F){console.log(new Error("next not built").stack)}}O.parentNode.insertBefore(O,F)}}}if(this.reorderLays&&this["deprecated-lays"]){for(J=0,G=this.reorderLays.length;J<G;++J){I=this.reorderLays[J];O=this["deprecated-lays"][I];if(O&&O.parentLayer){if(M){F=M["deprecated-lays"]&&M["deprecated-lays"][I];if(!F){console.log(new Error("next not built").stack)}}O.parentLayer.insertBefore(O,F)}}}}};function t(I,F,J){var G,H;for(G in I){if(I.hasOwnProperty(G)){H=I[G];if(H&&H.className){if(J){A.classListAdd(H,F)}else{A.classListRemove(H,F)}}}}}function k(H,F,G){if(x.inPathSet(G,"selected")){t(H,"selected",F.selected)}if(x.inPathSet(G,"hidden")){t(H,"hidden",F.hidden)}}E.DOMView.prototype.onmodifyStructure=function(F,G){k.call(this,this.structure,F,G)};E.DOMView.prototype.ondestroyDisplay=function(){E.LayeredEltView.prototype.ondestroyDisplay.apply(this,arguments);o(this.display)};E.DOMView.prototype.onmodifyDisplay=function(F,G){k.call(this,this.display,F,G);if(this["deprecated-elts"]){k.call(this,this["deprecated-elts"],F,G)}};E.PickableEdgeView=function c(){};E.PickableEdgeView.prototype.isRectanglePicked=function v(aa,Z,H,Y,G,F,T){function I(){return !A.isSegmentInRect.apply(undefined,arguments)}function W(an,al,ah,ag,ad,ap,ak,aj,af,ao,ae,am,ai){return !A.isBezierInRect(an,al,ah,ag,ad,ap,ak,aj,af,ao,ae,am)}var X,V,P,O,ac,ab,L,J,S,R,N;var U,K,M;var Q;if(F){M=true;U=A.isSegmentIntersectingRect;K=A.isBezierIntersectingRect}else{M=false;U=I;K=W}Q=0.5*T.invAnimVptScale;N=true;for(X=0,V=aa.path.length;X<V;){switch(aa.path[X]){case x.PathCmd.M:P=aa.path[X+1];O=aa.path[X+2];X+=3;break;case x.PathCmd.L:ac=aa.path[X+1];ab=aa.path[X+2];N=false;if(U(P,O,ac,ab,Z,H,Y,G)){return M}P=ac;O=ab;X+=3;break;case x.PathCmd.C:S=aa.path[X+1];R=aa.path[X+2];ac=aa.path[X+3];ab=aa.path[X+4];L=aa.path[X+5];J=aa.path[X+6];N=false;if(K(P,O,ac,ab,L,J,S,R,Z,H,Y,G,Q)){return M}P=S;O=R;X+=7;break;default:throw new Error("unknown path command "+aa.path[X])}}if(F){return false}else{return !N}};E.SVGEdgeView=function(F){E.DOMView.call(this);E.PickableEdgeView.call(this);if(F){this.className=F}};A.inherit(E.SVGEdgeView,E.DOMView);A.applyMixin(E.SVGEdgeView,E.PickableEdgeView);E.SVGEdgeView.prototype.className="egraph_views_SVGEdgeView";E.SVGEdgeView.prototype.oncreateStructure=function(F,G){E.DOMView.prototype.oncreateStructure.apply(this,arguments);this.structure.root=document.createElementNS(g,"g")};E.SVGEdgeView.prototype.onpositionStructure=function(I,H,J,G,F){E.DOMView.prototype.onpositionStructure.apply(this,arguments);(J.structure?J.structure.edges:J.edgesLayer).group.insertBefore(this.structure.root,F?F.structure.root:null)};E.SVGEdgeView.prototype.oncreateDisplay=function(H,I){E.DOMView.prototype.oncreateDisplay.apply(this,arguments);var F=false;if(H&&H.gr&&H.gr.edgePickingAreaOpts){F=H.gr.edgePickingAreaOpts.activate}if(F){this.display.pickingAreaElt=document.createElementNS(g,"path");if(H.gr.edgePickingAreaOpts.size&&(H.gr.edgePickingAreaOpts.size%1===0)){this.display.pickingAreaElt.style.strokeWidth=H.gr.edgePickingAreaOpts.size;this.display.pickingAreaElt.style.strokeOpacity=0}this.display.pickingAreaElt.grElt=H;if(this.className){var G=this.className+"_PickingArea";this.display.pickingAreaElt.setAttribute("class",G)}this.structure.root.appendChild(this.display.pickingAreaElt)}this.display.elt=document.createElementNS(g,"path");this.display.elt.grElt=H;if(this.className){this.display.elt.setAttribute("class",this.className)}if(F){this.display.elt.style.pointerEvents="none"}this.structure.root.appendChild(this.display.elt);this["deprecated-elts"].elt=this.display.elt};E.SVGEdgeView.prototype.onmodifyDisplay=function(J,N,M){var H,L,I,G,K,F;E.DOMView.prototype.onmodifyDisplay.apply(this,arguments);if(x.inPathSet(N,"path")){H=this.display.elt;L=this.display.pickingAreaElt;K="";loop:for(I=0,G=J.path.length;I<G;){switch(J.path[I]){case x.PathCmd.M:F="M"+J.path[I+1]+" "+J.path[I+2];I+=3;break;case x.PathCmd.L:F="L"+J.path[I+1]+" "+J.path[I+2];I+=3;break;case x.PathCmd.C:F="C"+J.path[I+3]+" "+J.path[I+4]+" "+J.path[I+5]+" "+J.path[I+6]+" "+J.path[I+1]+" "+J.path[I+2];I+=7;break;default:throw new Error("Unsupported PathCmd: "+J.path[I]);break loop}K+=F}H.setAttribute("d",K);if(L){L.setAttribute("d",K)}}};E.SVGLayer=function(){this.elt=document.createElementNS(g,"svg");this.elt.setAttribute("width","100%");this.elt.setAttribute("height","100%");this.group=document.createElementNS(g,"g");this.elt.appendChild(this.group);this.children=new x.List();this.transfo=this.group.transform.baseVal.insertItemBefore(n.createSVGTransform(),0);this.parentLayer=null};E.SVGLayer.prototype.leaf=true;E.SVGLayer.prototype.name="svg";E.SVGLayer.prototype.remove=function(){if(this.parentLayer){this.parentLayer.removeChild(this)}};E.SVGLayer.prototype.updateClasses=function(F){this.elt.className.baseVal=F.svgLayerClass};E.SVGLayer.prototype.viewpointChanged=function(F){this.transfo.matrix.e=F[0];this.transfo.matrix.f=F[1];this.transfo.matrix.a=this.transfo.matrix.d=F[2];if(A.isIE()&&this.elt.parentNode){this.elt.parentNode.insertBefore(this.elt,this.elt)}};E.SVGLayer.prototype.insertNewSVGLayer=function(F){var G;G=new E.SVGSubLayer();this.insertBefore(G,F);return G};E.SVGLayer.prototype.insertBefore=function(G,F){if(F&&F.parentLayer!==this){throw Error("Next layer not in this layer")}if(!(G instanceof E.SVGSubLayer)){throw new Error("Layer is not an SVGSubLayer")}if(G.parentLayer!==this){G.remove();G.parentLayer=this}this.children.insertBefore(G,F);this.group.insertBefore(G.group,(F&&F.group)||null)};E.SVGLayer.prototype.removeChild=function(F){if(F.parentLayer!==this){throw new Error("Layer not in this layer")}F.parentLayer=null;this.children.removeChild(child);this.group.removeChild(F.group)};E.SVGSubLayer=function(){this.group=document.createElementNS(g,"g");this.parentLayer=null};E.SVGSubLayer.prototype.leaf=true;E.SVGSubLayer.prototype.name="svg-sub";E.SVGSubLayer.prototype.remove=E.SVGLayer.prototype.remove;E.HtmlLeafLayer=function(){this.elt=document.createElement("div");this.parentLayer=null};E.HtmlLeafLayer.prototype.leaf=true;E.HtmlLeafLayer.prototype.name="html";E.HtmlLeafLayer.prototype.remove=E.SVGLayer.prototype.remove;E.HtmlLeafLayer.prototype.viewpointChanged=function(G,F){this.elt.style.transform=F;this.elt.style.webkitTransform=F;this.elt.style.msTransform=F};E.HtmlLeafLayer.prototype.updateClasses=function(F){this.elt.className=F.htmlLayerClass};E.GroupLayer=function(){this.children=new x.List();this.parentLayer=null};E.GroupLayer.prototype.elt=null;E.GroupLayer.prototype.leaf=false;E.GroupLayer.prototype.name="group";E.GroupLayer.prototype.remove=E.SVGLayer.prototype.remove;E.GroupLayer.prototype.insertNewSVGLayer=function(F){var G;G=new E.SVGLayer();this.insertBefore(G,F);return G};E.GroupLayer.prototype.newSVGLayer=function(){return new E.SVGLayer()};E.dftNextLayer=function(F,H,G){if(!G&&H.children&&H.children.first){return H.children.first}else{while(H!==F&&!H.next){H=H.parentLayer}return H!==F?H.next:null}};E.GroupLayer.prototype.insertBefore=function(J,H){var G,F,K,L,I;if(J instanceof E.SVGSubLayer){throw new Error("SVGSubLayer can only be inserted in an SVGLayer")}if(J instanceof E.RootLayer){throw new Error("A RootLayer must be at root of the layers' tree")}if(H&&H.parentLayer!==this){throw new Error("nextLayer is not in this group layer")}if(J===H){throw new Error("layer can't be inserted before itself")}for(F=this,G=null;F;G=F,F=F.parentLayer){if(F===J){throw new Error("layer is an ancestor of this group")}}I=J.parentLayer===this;J.remove();this.children.insertBefore(J,H);J.parentLayer=this;if(G.elt){for(K=E.dftNextLayer(null,J,true);K&&!K.leaf;K=E.dftNextLayer(null,K)){}L=K?K.elt:null;for(F=J;F;F=E.dftNextLayer(J,F,F.leaf)){if(F.leaf){if(!I){F.updateClasses(G);F.viewpointChanged(G.vpt,G.cssTransform)}G.elt.insertBefore(F.elt,L)}}}};E.GroupLayer.prototype.insertNewGroupLayer=function(F){var G;G=new E.GroupLayer();this.insertBefore(G,F);return G};E.GroupLayer.prototype.newGroupLayer=function(){return new E.GroupLayer()};E.GroupLayer.prototype.insertNewLeafHtmlLayer=function(F){var G;G=new E.HtmlLeafLayer();this.insertBefore(G,F);return G};E.GroupLayer.prototype.newLeafHtmlLayer=function(){return new E.HtmlLeafLayer()};E.GroupLayer.prototype.removeChild=function(F){var H,G,I;if(F.parentLayer!==this){throw new Error("childLayer not in this layer")}for(H=null,G=this;G;H=G,G=G.parentLayer){}G=F;I=H.elt;if(I){while(G){if(!G.leaf&&G.children.first){G=G.children.first}else{if(G.leaf){I.removeChild(G.elt)}for(;G&&G!==F;G=G.parentLayer){if(G.next){G=G.next;break}}if(G===F){G=null}}}}this.children.remove(F);F.parentLayer=null};E.RootLayer=function(H,F,G){E.GroupLayer.call(this);this.svgLayerClass=F||"egraph_views_SVGLayer";this.htmlLayerClass=G||"egraph_views_HtmlLayer";this.elt=document.createElement("div");this.elt.className=H||"egraph_views_RootLayer";this.vpt=[0,0,1]};A.inherit(E.RootLayer,E.GroupLayer);E.RootLayer.prototype.name="root";E.RootLayer.prototype.setViewpoint=function(G){var F;this.vpt[0]=G[0];this.vpt[1]=G[1];this.vpt[2]=G[2];this.cssTransform="translate("+G[0].toFixed(5)+"px,"+G[1].toFixed(5)+"px) scale("+G[2].toFixed(5)+")";for(F=this;F;F=E.dftNextLayer(this,F,F.leaf)){if(F.leaf){F.viewpointChanged(this.vpt,this.cssTransform)}}};E.RootLayer.prototype.toTreeString=function(){var F,G;function H(K,I){var L,J;F.push(I);if(K.leaf){F.push("*")}F.push(K.name,"\n");if(K.children){J=I+G;for(L=K.children.first;L;L=L.next){H(L,J)}}}F=[];G="  ";H(this,"  ");return F.join("")};function q(I,H,G,F){this.state=0;this.boundAnimCB=this.animCB.bind(this);this.requestID=d(this.boundAnimCB);this.start=null;this.duration=100;this.vpt1=H.slice();this.vpt2=G.slice();this.target=I;this.cb=F}q.prototype.cancel=function(){if(!this.state){this.state=2;h(this.requestID)}};q.prototype.animCB=function(I){var G,F,J,H;if(this.state){return}if(this.start===null){this.start=I}G=I-this.start;F=A.clamp(G/this.duration,0,1);J=[];for(H=0;H<3;++H){J[H]=(1-F)*this.vpt1[H]+F*this.vpt2[H]}this.target.setViewpoint(J);if(G<this.duration){this.requestID=d(this.boundAnimCB)}if(this.cb){this.cb(J)}};E.OneViewPerElt=function(){x.GraphView.call(this)};A.inherit(E.OneViewPerElt,x.GraphView);function B(F){var H=[];function G(I,J){var K;if(typeof J!=="object"){H.push(I.join("."))}else{for(K in J){if(J.hasOwnProperty(K)){G(I.concat(K),J[K])}}}}G([],F);return H.join(",")}E.OneViewPerElt.prototype.oninit=function(F,K){var M,L,J,H;x.GraphView.prototype.oninit.apply(this,arguments);H=this;function G(N){if(N.views[K]){console.log("    "+N+": oninsert(null)")}else{console.log("    "+N+": no view")}}function I(N){if(N.views[K]&&N.views[K].oninsert){N.views[K].oninsert(N,null,H)}}if(x.EGraph.traceUpdates){console.log("  calling views "+K+":");for(M=F.nodes.first;M;M=x.dftNext(F,M)){G(M);for(L=M.children.first;L;L=L.next){G(L)}}for(J=F.edges.first;J;J=J.next){G(J)}}for(M=F.nodes.first;M;M=x.dftNext(F,M)){I(M);for(L=M.children.first;L;L=L.next){I(L)}}for(J=F.edges.first;J;J=J.next){I(J)}};var s=[x.Type.EGRAPH,x.Type.GROUP,x.Type.NODE,x.Type.CONNECTOR,x.Type.EDGE];E.OneViewPerElt.prototype.onupdate=function(I,F){var U,R,L,J,M,K,T,G,H,O,S,Q,N,P;x.GraphView.prototype.onupdate.apply(this,arguments);G=this.viewKey;H=[];for(U=0,R=s.length;U<R;++U){M=F[s[U]];if(M){for(L=0,J=M.length;L<J;++L){K=M[L];if(K.views[G]){H.push(K);K.views[G].__viewFlag__&=~1}}}}O=[];S=[];Q=[];for(L=0,J=H.length;L<J;++L){K=H[L];if(K.views[G].__viewFlag__&1){continue}if(K.__updateFlag__&(4|16)){for(;;){for(N=K.next;N&&!N.views[G];N=N.next){}if(N&&N.__updateFlag__&(4|16)&&!(N.views[G].__viewFlag__&1)){Q.push(K);Q.push(N);K=N}else{O.push(K);S.push(N);K.views[G].__viewFlag__|=1;while(Q.length){N=Q.pop();K=Q.pop();O.push(K);S.push(N);K.views[G].__viewFlag__|=1}break}}}else{K.views[G].__viewFlag__|=1;O.push(K);S.push(undefined)}}if(x.EGraph.traceUpdates){console.log("  calling views "+G+":");for(L=0,J=O.length;L<J;++L){K=O[L];N=S[L];T=[];if(K.__updateFlag__&8&&!(K.__updateFlag__&4)){T.push("onremove("+B(K.__modifiedProperties__)+", false)")}else{if(K.__updateFlag__&4){if(K.__updateFlag__&8){T.push("onremove(null, true)")}T.push("oninsert("+B(K.__modifiedProperties__)+", "+N+")")}else{if(K.__updateFlag__&16){T.push("onreorder("+B(K.__modifiedProperties__)+", "+N+")")}else{if(K.__modifiedProperties__){T.push("onupdate("+B(K.__modifiedProperties__)+")")}}}}if(K.__updateFlag__&(32|64)){T.push("onselect("+Boolean(K.__updateFlag__&32)+")")}if(T.length){console.log("    "+K+": "+T.join(","))}}}for(L=0,J=O.length;L<J;++L){K=O[L];N=S[L];P=K.views[G];if(K.__updateFlag__&8&&!(K.__updateFlag__&4)){if(P.onremove){P.onremove(K,K.__modifiedProperties__,this,false)}}else{if(K.__updateFlag__&4){if(K.__updateFlag__&8&&P.onremove){P.onremove(K,null,this,true)}if(P.oninsert){P.oninsert(K,K.__modifiedProperties__,this,N)}}else{if(K.__updateFlag__&16){if(P.onreorder){P.onreorder(K,K.__modifiedProperties__,this,N)}}else{if(K.__modifiedProperties__){if(P.onupdate){P.onupdate(K,K.__modifiedProperties__,this)}}}}}if(K.__updateFlag__&(32|64)&&P.onselect){P.onselect(K,Boolean(K.__updateFlag__&32),this)}}};E.OneViewPerElt.prototype.rectanglePick=function(U,J,T,H,Q){function I(X){var Y;for(Y=X.first;Y;Y=Y.next){if(Y.hidden){continue}O=Y.views[F];if(O&&O.isRectanglePicked){if(O.isRectanglePicked(Y,U,J,T,H,G,L)){W.push(Y)}}}}var L,R,S,N,G,O,W,F;var M,V,P,K;L=this;if(!this.gr.isUpdated()){throw new Error("graph is locked or there are some out of lock pending modifications")}F=this.viewKey;M=Q&&Q.nodes!==undefined?Boolean(Q.nodes):true;K=Q&&Q.groups!==undefined?Boolean(Q.groups):false;P=Q&&Q.connectors!==undefined?Boolean(Q.connectors):false;V=Q&&Q.edges!==undefined?Boolean(Q.edges):false;N=Q&&Q.stopAtGroup!==undefined?Boolean(Q.stopAtGroup):false;G=Q&&Q.overlapping!==undefined?Boolean(Q.overlapping):true;W=[];for(R=this.gr.nodes.first;R;R=x.dftNext(this.gr,R,S&&N||R.collasped)){S=false;if((M&&(R.type===x.Type.NODE||R.type===x.Type.GROUP&&R.collasped)||K&&R.type===x.Type.GROUP&&!R.collasped)&&(O=R.views[F],O)&&O.isRectanglePicked){S=O.isRectanglePicked(R,U,J,T,H,G,this);if(S){W.push(R)}}if(P){I(R.children)}}if(V){I(this.gr.edges)}return W};E.TransformedGraphView=function D(){this.vpt=[0,0,1];this.invVptScale=1;this.animVpt=[0,0,1];this.invAnimVptScale=1};E.TransformedGraphView.prototype.clientToViewpoint=function a(G,F){return A.relativeToViewpoint(G,F,this.domRoot,this.vpt)};E.TransformedGraphView.prototype.getSize=function b(){throw A.newNotImplError()};E.DOMGraphView=function(F,G){E.OneViewPerElt.call(this);x.Observable.call(this);E.TransformedGraphView.call(this);G=G||{};if(!F){throw new Error("container parameter can't be null")}this.container=F;this.domRoot=document.createElement("div");var H="egraph_views_domroot";if(A.isIE()){H+=" egraph_browser_isIE"}this.domRoot.className=H;this.container.appendChild(this.domRoot);this.width=NaN;this.height=NaN;this.structure={};this.structure.root=new E.RootLayer(G.rootClass,G.svgClass,G.htmlClass);this.structure.root.name+=" (root)";this.domRoot.appendChild(this.structure.root.elt);this.overlayMarker=document.createElement("div");this.overlayMarker.className="egraph_views_overlay-marker";this.domRoot.appendChild(this.overlayMarker);this.structure.groups=null;this.structure.edges=null;this.structure.groupsConnectors=null;this.structure.nodes=null;this.viewpointAnimation=null;this.animateVpt=[0,0,1];this.createStructure();this.structure.groups.name+=" (groups)";this.structure.edges.name+=" (edges)";this.structure.groupsConnectors.name+=" (groupsConnectors)";this.structure.nodes.name+=" (nodes)";l.call(this)};A.inherit(E.DOMGraphView,E.OneViewPerElt);A.applyMixin(E.DOMGraphView,x.Observable);A.applyMixin(E.DOMGraphView,E.TransformedGraphView);x.makeRewriter(E.DOMGraphView.prototype,"rootLayer",undefined,["structure","root"]);x.makeRewriter(E.DOMGraphView.prototype,"edgesLayer",undefined,["structure","edges"]);x.makeRewriter(E.DOMGraphView.prototype,"nodesLayer",undefined,["structure","nodes"]);function l(H,F){function G(I,J){if(typeof J!=="number"||!isFinite(J)||J<0){throw new Error(I+" should be a finite positive number")}}if(H===undefined&&F===undefined){H=this.domRoot.offsetWidth;F=this.domRoot.offsetHeight}else{G("width",H);G("height",F)}if(this.width===H&&this.height===F){return false}this.width=H;this.height=F;return true}E.DOMGraphView.prototype.setSize=function y(G,F){if(l.call(this,G,F)){this.dispatch({type:"resize",size:[this.width,this.height]})}};E.DOMGraphView.prototype.getSize=function b(){return[this.width,this.height]};E.DOMGraphView.prototype.createStructure=function(){throw new Error("Not implemented")};E.DOMGraphView.prototype.setViewpoint=function(L,F){function M(P){var O;K.animVpt[0]=P[0];K.animVpt[1]=P[1];K.animVpt[2]=O=P[2];K.invAnimVptScale=1/O;K.dispatch({type:"animviewpoint",vpt:K.animVpt.slice()})}var K,I,G,N,J;K=this;I=L[0];G=L[1];N=L[2];if(typeof I!=="number"||!isFinite(I)||typeof G!=="number"||!isFinite(G)||typeof N!=="number"||!isFinite(N)){throw new Error("vpt must be an array of 3 finite numbers")}if(N<=0){throw new Error("vpt[2] must be > 0")}J=1/N;if(!isFinite(J)){throw new Error("vpt[2] must > 2^-1024 (else its inverse is infinite)")}this.vpt[0]=I;this.vpt[1]=G;this.vpt[2]=N;this.invVptScale=J;if(!d){F=false}if(this.viewpointAnimation){this.viewpointAnimation.cancel();this.viewpointAnimation=null}this.dispatch({type:"viewpoint",vpt:this.vpt.slice()});if(F){this.viewpointAnimation=new q(this.structure.root,this.structure.root.vpt,this.vpt,function H(O){M(O)})}else{this.structure.root.setViewpoint(this.vpt);M(this.vpt)}};E.DOMGraphView.prototype.zoomone=function(){var F,G,H;F=this.domRoot.clientWidth;G=this.domRoot.clientHeight;H=A.changeViewpointScale(this.vpt,1,[F/2,G/2],false);this.setViewpoint(H,true)};E.DOMGraphView.prototype.zoominc=function(H,G,L,F){var J,K,I;K=G?G:this.domRoot.clientWidth/2;I=L?L:this.domRoot.clientHeight/2;J=A.incViewpointScale(this.vpt,0.5*H,[K,I],false,F);this.setViewpoint(J,true);return J};E.HTMLGraphView=function(F,G){E.DOMGraphView.call(this,F,G)};A.inherit(E.HTMLGraphView,E.DOMGraphView);E.HTMLGraphView.prototype.createStructure=function(){this.structure.groups=this.structure.root.insertNewGroupLayer(null);this.structure.edges=this.structure.root.insertNewSVGLayer(null);this.structure.groupsConnectors=this.structure.root.insertNewGroupLayer(null);this.structure.nodes=this.structure.root.insertNewGroupLayer(null)};E.SVGGraphView=function(F,G){E.DOMGraphView.call(this,F,G)};A.inherit(E.SVGGraphView,E.DOMGraphView);E.SVGGraphView.prototype.createStructure=function(){this.structure.svgRoot=this.structure.root.insertNewSVGLayer(null);this.structure.groups=this.structure.svgRoot.insertNewSVGLayer(null);this.structure.edges=this.structure.svgRoot.insertNewSVGLayer(null);this.structure.groupsConnectors=this.structure.svgRoot.insertNewSVGLayer(null);this.structure.nodes=this.structure.svgRoot.insertNewSVGLayer(null)};E.PickableNodalView=function p(){};E.PickableNodalView.prototype.isRectanglePicked=function v(J,I,O,H,M,G,N){var F,L,P,K;F=J.actualLeft;L=J.actualTop;P=F+J.actualWidth;K=L+J.actualHeight;if(G){return A.areRectsOverlapping(F,L,P,K,I,O,H,M)}else{return A.isRectIncluded(F,L,P,K,I,O,H,M)}};E.PickableConnectorView=function z(){};E.PickableConnectorView.prototype.isRectanglePicked=function v(L,H,J,G,I,F,K){return A.isPointInRect(L.aleft,L.atop,H,J,G,I)};E.HTMLNodeView=function(){E.DOMView.call(this);E.PickableNodalView.call(this)};A.inherit(E.HTMLNodeView,E.DOMView);A.applyMixin(E.HTMLNodeView,E.PickableNodalView);E.HTMLNodeView.prototype.connsInFront=true;E.HTMLNodeView.prototype.resetDisplayOnCollapse=true;function j(F){if(F.type===x.Type.GROUP&&!F.collapsed){this.structure.groupConnectorsRoot.insertBefore(this.structure.connsGroup,this.structure.groupsConnectors)}else{this.structure.nodeRoot.insertBefore(this.structure.connsGroup)}if(F.type===x.Type.GROUP&&!F.collapsed){this.structure.groupRoot.insertBefore(this.structure.nodeLayer,this.structure.groups)}else{this.structure.nodeRoot.insertBefore(this.structure.nodeLayer,this.connsInFront?this.structure.connsGroup:null)}}E.HTMLNodeView.prototype.oncreateStructure=function(G,H){var F;E.DOMView.prototype.oncreateStructure.apply(this,arguments);F=G.toString();this.structure.groupRoot=new E.GroupLayer();this["deprecated-lays"].groupRoot=this.structure.groupRoot;this.structure.groupRoot.name+=" (groupRoot:"+F+")";if(G.type===x.Type.GROUP){this.structure.groups=this.structure.groupRoot.insertNewGroupLayer(null);this["deprecated-lays"].groups=this.structure.groups;this.structure.groups.name+=" (groups:"+F+")"}this.structure.groupConnectorsRoot=new E.GroupLayer();this.structure.groupConnectorsRoot.name+=" (groupConnectorsRoot:"+F+")";if(G.type===x.Type.GROUP){this.structure.groupsConnectors=this.structure.groupConnectorsRoot.insertNewGroupLayer(null);this["deprecated-lays"].groupsConnectors=this.structure.groupsConnectors;this.structure.groupsConnectors.name+=" (groupsConnectors:"+F+")"}this.structure.nodeRoot=new E.GroupLayer();this["deprecated-lays"].nodeRoot=this.structure.nodeRoot;this.structure.nodeRoot.name+=" (nodeRoot:"+F+")";if(G.type===x.Type.GROUP){this.structure.nodes=this.structure.nodeRoot.insertNewGroupLayer(null);this["deprecated-lays"].nodes=this.structure.nodes;this.structure.nodes.name+=" "+F;this.structure.nodes.name+=" (nodes:"+F+")"}this.structure.connsGroup=new E.SVGLayer();this.structure.connsGroup.name+=" (connsGroup:"+F+")";this.structure.nodeLayer=new E.HtmlLeafLayer();this.structure.nodeLayer.name+=" (nodeLayer:"+F+")";j.call(this,G)};E.HTMLNodeView.prototype.oncreateDisplay=function(F,G){E.DOMView.prototype.oncreateDisplay.apply(this,arguments);this.display.elt=this.buildNodeElement(F);this["deprecated-elts"].node=this.display.elt;this.display.elt.grElt=F;this.structure.nodeLayer.elt.appendChild(this.display.elt)};E.HTMLNodeView.prototype.onpositionStructure=function(F,K,M,I,H){var G,J,L;E.DOMView.prototype.onpositionStructure.apply(this,arguments);if(H){G=H.structure.nodeRoot;J=H.structure.groupRoot;L=H.structure.groupConnectorsRoot;if(!G||!J||!L){console.log(new Error("next not built").stack)}}I.structure.groups.insertBefore(this.structure.groupRoot,J);I.structure.groupsConnectors.insertBefore(this.structure.groupConnectorsRoot,L);I.structure.nodes.insertBefore(this.structure.nodeRoot,G)};E.HTMLNodeView.prototype.buildNodeElement=function(G){var F=document.createElement("div");F.className=G.type===x.Type.GROUP&&!G.collapsed?"egraph_views_HTMLNodeView_Group":"egraph_views_HTMLNodeView_Node";return F};E.HTMLNodeView.prototype.onmodifyStructure=function(F,G,H){E.DOMView.prototype.onmodifyStructure.apply(this,arguments);if(F.type===x.Type.GROUP&&x.inPathSet(G,"collapsed")){j.call(this,F)}};E.HTMLNodeView.prototype.onvoteResetDisplay=function(F,G,H){if(F.type===x.Type.GROUP&&this.resetDisplayOnCollapse&&x.inPathSet(G,"collapsed")){return true}return E.DOMView.prototype.onvoteResetDisplay.apply(this,arguments)};E.HTMLNodeView.prototype.onmodifyDisplay=function(F,G,H){E.DOMView.prototype.onmodifyDisplay.apply(this,arguments);if(x.inPathSet(G,"actualWidth")){this.display.elt.style.width=A.nb2px(F.actualWidth)}if(x.inPathSet(G,"actualHeight")){this.display.elt.style.height=A.nb2px(F.actualHeight)}if(x.inPathSet(G,"actualLeft")){this.display.elt.style.left=A.nb2px(F.actualLeft)}if(x.inPathSet(G,"actualTop")){this.display.elt.style.top=A.nb2px(F.actualTop)}};E.SVGConnView=function(F){E.DOMView.call(this);E.PickableConnectorView.call(this);if(F){this.className=F}};A.inherit(E.SVGConnView,E.DOMView);A.applyMixin(E.SVGConnView,E.PickableConnectorView);E.SVGConnView.prototype.className="egraph_views_SVGConnView";E.SVGConnView.prototype.oncreateStructure=function(){E.DOMView.prototype.oncreateStructure.apply(this,arguments);this.structure.root=document.createElementNS(g,"g")};E.SVGConnView.prototype.onpositionStructure=function(J,H,I,G,F){E.DOMView.prototype.onpositionStructure.apply(this,arguments);G.structure.connsGroup.group.insertBefore(this.structure.root,F?F.structure.root:null)};E.SVGConnView.prototype.oncreateDisplay=function(G,F){E.DOMView.prototype.oncreateDisplay.apply(this,arguments);this.display.elt=this.buildConnElement(G);this["deprecated-elts"].elt=this.display.elt;this.display.elt.grElt=G;this.display.elt.transform.baseVal.insertItemBefore(n.createSVGTransform(),0);this.display.elt.transform.baseVal.insertItemBefore(n.createSVGTransform(),0);this.structure.root.appendChild(this.display.elt)};E.SVGConnView.prototype.buildConnElement=function(G){var F=document.createElementNS(g,"circle");F.cx.baseVal.value=0;F.cy.baseVal.value=0;F.r.baseVal.value=6.5;F.className.baseVal=this.className;return F};E.SVGConnView.prototype.onmodifyDisplay=function(H,G){var F;E.DOMView.prototype.onmodifyDisplay.apply(this,arguments);if(x.inPathSet(G,"anormx")||x.inPathSet(G,"anormy")){F=this.display.elt.transform.baseVal.getItem(1);F.matrix.a=H.anormx;F.matrix.b=H.anormy;F.matrix.c=-H.anormy;F.matrix.d=H.anormx}if(x.inPathSet(G,"top")||x.inPathSet(G,"left")){this.display.elt.transform.baseVal.getItem(0).setTranslate(H.left,H.top)}};E.RectangleOverlay=function i(G,F){if(!G){throw new Error("grView can't be null/undefined")}if(!G.overlayMarker){throw new Error("grView.overlayMarker can't be null/undefined")}if(!G.vpt){throw new Error("grView.vpt can't be null/undefined")}this.grView=G;this.background=document.createElement("div");this.background.className="egraph_views_roverlay_pos "+(F&&F.background&&F.background.className||"egraph_views_roverlay_bgnd");G.domRoot.insertBefore(this.background,G.overlayMarker);this.rectSvg=document.createElementNS(g,"svg");this.rectSvg.className.baseVal="egraph_views_roverlay_pos";this.rectSvg.style.height="100%";this.rectSvg.style.width="100%";this.background.appendChild(this.rectSvg);this.rect=document.createElementNS(g,"rect");this.rect.className.baseVal=F&&F.rectangle&&F.rectangle.className||"egraph_views_roverlay_rect";this.rect.style.display="none";this.rectSvg.appendChild(this.rect);this.rectVisible=false;this.x1=NaN;this.y1=NaN;this.x2=NaN;this.y2=NaN;this.boundUpdate=r.bind(this);G.addListener("animviewpoint",this.boundUpdate)};E.RectangleOverlay.prototype.remove=function C(){if(this.background.parentNode){this.background.parentNode.removeChild(this.background);this.grView.removeListener("animviewpoint",this.boundUpdate)}};E.RectangleOverlay.prototype.setRectangle=function u(G,I,F,H){if(!isFinite(G)||!isFinite(I)||!isFinite(F)||!isFinite(H)){throw new Error("x1, y1, x2, y2 must not finite")}if(!this.rectVisible){this.rect.style.display="";this.rectVisible=true}this.x1=G;this.y1=I;this.x2=F;this.y2=H;r.call(this)};function r(){var F;if(isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)){return}F=this.grView.animVpt;if(!F){throw new Error("grView.animVpt can't be null/undefined")}this.rect.x.baseVal.value=Math.round(Math.min(this.x1,this.x2)*F[2]+F[0]);this.rect.y.baseVal.value=Math.round(Math.min(this.y1,this.y2)*F[2]+F[1]);this.rect.width.baseVal.value=Math.max(1,Math.round(Math.abs(this.x2-this.x1)*F[2]));this.rect.height.baseVal.value=Math.max(1,Math.round(Math.abs(this.y2-this.y1)*F[2]))}E.RectHoleOverlay=function f(G,F){if(!G){throw new Error("grView can't be null/undefined")}if(!G.overlayMarker){throw new Error("grView.overlayMarker can't be null/undefined")}if(!G.vpt){throw new Error("grView.vpt can't be null/undefined")}this.margin=15;if(F&&typeof F.margin!=="undefined"){if(typeof F.margin!=="number"||!isFinite(F.margin)||F.margin<0){throw new Error("opts.margin must be a finite >=0 number")}this.margin=F.margin}this.pixelcenter=true;if(F&&typeof F.pixelcenter!=="undefined"){this.pixelcenter=Boolean(F.pixelcenter)}this.minDiameter=A.pos_integer_opt(F,"minDiameter",5);this.grView=G;this.svg=document.createElementNS(g,"svg");this.svg.style.position="absolute";this.svg.style.left="0";this.svg.style.top="0";this.svg.style.width="100%";this.svg.style.height="100%";this.svg.style.overflow="hidden";G.domRoot.insertBefore(this.svg,G.overlayMarker);this.path=document.createElementNS(g,"path");this.path.style.display="none";this.path.className.baseVal=A.string_opt(F,"className","egraph_views_rhoverlay_path");this.svg.appendChild(this.path);this.pathVisible=false;this.x1=NaN;this.y1=NaN;this.x2=NaN;this.y2=NaN;this.view_width=NaN;this.view_height=NaN;this.boundUpdate=w.bind(this);G.addListener("animviewpoint",this.boundUpdate);G.addListener("resize",this.boundUpdate)};E.RectHoleOverlay.prototype.remove=function C(){if(this.svg.parentNode){this.svg.parentNode.removeChild(this.svg);this.grView.removeListener("animviewpoint",this.boundUpdate)}};E.RectHoleOverlay.prototype.setRectangle=function u(G,I,F,H){this.x1=Number(G);this.y1=Number(I);this.x2=Number(F);this.y2=Number(H);w.call(this)};function w(G){var P,I,R,S,N,H,Q,K,U,O;var M,J,L,T,F;if(G&&G.type==="resize"){this.view_width=G.size[0];this.view_height=G.size[1]}else{if(isNaN(this.view_width)||isNaN(this.view_height)){M=this.grView.getSize();this.view_width=M[0];this.view_height=M[1]}}if(!isFinite(this.x1)||!isFinite(this.y1)||!isFinite(this.x2)||!isFinite(this.y2)){if(this.pathVisible){this.path.style.display="none";this.pathVisible=false}return}if(!this.pathVisible){this.path.style.display="";this.pathVisible=true}P=this.grView.animVpt;if(!P){throw new Error("grView.animVpt can't be null/undefined")}S=Math.abs(this.x2-this.x1)*P[2];N=Math.abs(this.y2-this.y1)*P[2];if(S<this.minDiameter){N=N*(this.minDiameter/S);S=this.minDiameter}if(N<this.minDiameter){S=S*(this.minDiameter/N);N=this.minDiameter}I=0.5*(this.x1+this.x2)*P[2]+P[0]-0.5*S;R=0.5*(this.y1+this.y2)*P[2]+P[1]-0.5*N;I=Math.round(I);R=Math.round(R);S=Math.round(S);N=Math.round(N);H=I+S;Q=R+N;if(this.pixelcenter){I+=0.5;R+=0.5;H-=0.5;Q-=0.5}K=this.margin;J=-K;L=-K;T=this.view_width+K;F=this.view_height+K;U=this.path;O="M"+J+" "+L+"L"+T+" "+L+" "+T+" "+F+" "+J+" "+F+"Z";if(isFinite(I)&&isFinite(R)&&isFinite(H)&&isFinite(Q)){O+="M"+I+" "+R+"L"+I+" "+Q+" "+H+" "+Q+" "+H+" "+R+"Z"}U.setAttribute("d",O)}return E});define("egraph/views",["DS/egraph/views"],function mod(a){return a});define("DS/egraph/iact",["DS/egraph/core","DS/egraph/utils","DS/egraph/views"],function(u,S,d){var M={};M.Buttons={LEFT:1,RIGHT:2,MIDDLE:4};var B=[M.Buttons.LEFT,M.Buttons.MIDDLE,M.Buttons.RIGHT];function z(U){return B[U]}M.Modifiers={CTRL:1,SHIFT:2,ALT:4};M.Sides={TOP:1,BOTTOM:2,LEFT:4,RIGHT:8};function e(U){this.next=null;this.prev=null;this.target=U;this.count=0}function k(U,V){this.identifier=U;this.dragStart=null;this.touchTarget=V}M.StateMachine=function(X,W,V,U){this.graph=X;this.graphView=U||X.views.main;this.pick=W||new M.DOMPick();this.domRoot=this.graphView.domRoot;if(!this.domRoot){throw new Error('No "domRoot" property on the graph\'s view')}this.rootState=V||new M.DefaultRootState();this.state=null;w.call(this,this.rootState,true);this.drag=null;this.buttons=0;this.dragStart=null;this.touchTargets=new u.List();this.touchPoints={};this.boundMouseDownHandler=this.mouseDownHandler.bind(this);this.boundMouseMoveHandler=this.mouseMoveHandler.bind(this);this.boundMouseUpHandler=this.mouseUpHandler.bind(this);this.boundCtxMenuHandler=this.ctxMenuHandler.bind(this);this.boundMouseWheelHandler=this.mouseWheelHandler.bind(this);this.boundTouchStartHandler=this.touchStartHandler.bind(this);this.boundTouchMoveHandler=this.touchMoveHandler.bind(this);this.boundTouchEndHandler=this.touchEndHandler.bind(this);this.boundTouchCancelHandler=this.touchCancelHandler.bind(this);this.boundDragStartHandler=this.dragStartHandler.bind(this);this.boundDragEndHandler=this.dragEndHandler.bind(this);this.boundDragHandler=this.dragHandler.bind(this);this.boundDragEnterHandler=this.dragEnterHandler.bind(this);this.boundDragExitHandler=this.dragExitHandler.bind(this);this.boundDragLeaveHandler=this.dragLeaveHandler.bind(this);this.boundDragOverHandler=this.dragOverHandler.bind(this);this.boundDropHandler=this.dropHandler.bind(this);this.domRoot.addEventListener("mousedown",this.boundMouseDownHandler);this.domRoot.addEventListener("mouseup",this.boundMouseUpHandler);this.domRoot.addEventListener("contextmenu",this.boundCtxMenuHandler);this.domRoot.addEventListener("mousemove",this.boundMouseMoveHandler);this.domRoot.addEventListener(document.body.onwheel!==undefined?"wheel":"mousewheel",this.boundMouseWheelHandler);this.domRoot.addEventListener("touchstart",this.boundTouchStartHandler);this.domRoot.addEventListener("dragstart",this.boundDragStartHandler);this.domRoot.addEventListener("dragenter",this.boundDragEnterHandler);this.domRoot.addEventListener("dragexit",this.boundDragExitHandler);this.domRoot.addEventListener("dragleave",this.boundDragLeaveHandler);this.domRoot.addEventListener("dragover",this.boundDragOverHandler);this.domRoot.addEventListener("drop",this.boundDropHandler);this.lastMouseEvent=null;this.lastMouseEventResetPending=false;this.boundResetLastEvent=this.resetLastEvent.bind(this);this.currentDnD=null;this.currentHoveredElement=null;this.edgeRerouteOptions={active:false,modifier:M.Modifiers.CTRL,alwaysRerouteSelection:false};this.setEdgeRerouteActive=function(Y){if(Y){this.edgeRerouteOptions.active=true}else{this.edgeRerouteOptions.active=false}};this.setEdgeRerouteOptions=function(Y){Y=Y||{};if(typeof Y.active==="boolean"){this.edgeRerouteOptions.active=Y.active}if(Y.modifier){if(Y.modifier!==M.Modifiers.CTRL&&Y.modifier!==M.Modifiers.ALT&&Y.modifier!==M.Modifiers.SHIFT){throw new Error("the given modifier is not valid!")}else{this.edgeRerouteOptions.modifier=Y.modifier}}if(typeof Y.alwaysRerouteSelection==="boolean"){this.edgeRerouteOptions.alwaysRerouteSelection=Y.alwaysRerouteSelection}}};M.StateMachine.prototype.setLastMouseEvent=function(U){this.lastMouseEvent=U;if(!this.lastMouseEventResetPending){this.lastMouseEventResetPending=true;setTimeout(this.boundResetLastEvent,0)}};M.StateMachine.prototype.resetLastEvent=function(){this.lastMouseEventResetPending=false;this.lastMouseEvent=null};M.StateMachine.prototype.startdrag=function(V){this.enddrag(true);this.drag=V;if(this.drag&&this.drag.onstart){var U=this.drag.onstart()}};M.StateMachine.prototype.enddrag=function(V){var U;if(this.drag&&this.drag.onend){U=this.drag.onend(Boolean(V))}this.drag=null;return U};M.StateMachine.prototype.buildEventDataFromMouseEvent=function(Y){var Z,W,X,V,U;Z=this.pick.pick(Y.clientX,Y.clientY,this.domRoot);X=this.graphView.clientToViewpoint(Y.clientX,Y.clientY);W=0;if(Y.shiftKey){W|=M.Modifiers.SHIFT}if(Y.ctrlKey){W|=M.Modifiers.CTRL}if(Y.altKey){W|=M.Modifiers.ALT}if(this.dragStart){V=[Y.clientX-this.dragStart.clientPos[0],Y.clientY-this.dragStart.clientPos[1]];U=[X[0]-this.dragStart.graphPos[0],X[1]-this.dragStart.graphPos[1]]}else{V=null;U=null}return{inside:Z.inside,grElt:Z.grElt,subElt:Z.subElt,dom:Y.target,modifiers:W,clientPos:[Y.clientX,Y.clientY],graphPos:X,buttons:this.buttons,dragStart:this.dragStart,clientDelta:V,graphDelta:U}};var J=false;function w(U,W){var V,X;V=this.state;X=U||this.rootState;if(V===X){return}if(J){throw new Error("can't change state while already changing state!")}J=true;try{if(V&&V.onuninstall){V.onuninstall(this,W,X)}this.state=X;if(X.oninstall){X.oninstall(this,W,V)}}finally{J=false}}function a(W,V,U){if(U&&U.consume){V.preventDefault();if(W.dragStart&&W.dragStart.inside){V.stopPropagation()}}}function i(W,V,U){a(W,V,U);if(U&&U.hasOwnProperty("state")){w.call(W,U.state,false)}return U&&U.hasOwnProperty("reinterpret")?U.reinterpret:false}function F(Z,X,Y,W){var V,U;do{U=false;if(Z.state[Y]){V=Z.state[Y](Z,W);U=i(Z,X,V)}}while(U);if(Z.drag&&Z.drag[Y]){c(Z,X,Z.drag[Y](W))}}function c(W,V,U){a(W,V,U)}M.StateMachine.prototype.setState=function(U){w.call(this,U,true)};M.StateMachine.prototype.mouseDownHandler=function(W){var V,U=!this.buttons;if(W===this.lastMouseEvent){return}this.setLastMouseEvent(W);this.graphView.domRoot.focus();this.buttons|=B[W.button];V=this.buildEventDataFromMouseEvent(W);V.button=B[W.button];V.detail=W.detail;if(V.detail===2){F(this,W,"ondoubleclick",V)}if(U){this.dragStart=V;window.addEventListener("mousedown",this.boundMouseDownHandler);window.addEventListener("mouseup",this.boundMouseUpHandler);window.addEventListener("contextmenu",this.boundCtxMenuHandler);window.addEventListener("mousemove",this.boundMouseMoveHandler)}F(this,W,"onmousedown",V)};function I(U){U.dragStart=null;window.removeEventListener("mousedown",U.boundMouseDownHandler);window.removeEventListener("mouseup",U.boundMouseUpHandler);window.removeEventListener("contextmenu",U.boundCtxMenuHandler);window.removeEventListener("mousemove",U.boundMouseMoveHandler)}M.StateMachine.prototype.mouseMoveHandler=function(V){var U;if(V===this.lastMouseEvent){return}this.setLastMouseEvent(V);U=this.buildEventDataFromMouseEvent(V);F(this,V,"onmousemove",U)};M.StateMachine.prototype.mouseUpHandler=function(V){var U;if(V===this.lastMouseEvent){return}this.setLastMouseEvent(V);this.buttons&=~B[V.button];if(!this.buttons){I(this)}U=this.buildEventDataFromMouseEvent(V);U.button=B[V.button];U.detail=V.detail;F(this,V,"onmouseup",U)};M.StateMachine.prototype.ctxMenuHandler=function(V){var U;if(V===this.lastMouseEvent){return}this.setLastMouseEvent(V);U=this.buildEventDataFromMouseEvent(V);U.button=B[V.button];F(this,V,"oncontextmenu",U)};M.StateMachine.prototype.mouseWheelHandler=function(V){var U;U=this.buildEventDataFromMouseEvent(V);U.wheelDelta=V.deltaY!==undefined?-V.deltaY:V.wheelDelta;if(U.wheelDelta>0){U.wheelDelta=1}else{if(U.wheelDelta<0){U.wheelDelta=-1}else{return}}F(this,V,"onwheel",U)};function o(W,V){var U;U=W.buildEventDataFromMouseEvent(V);U.dataTransfer=V.dataTransfer;return U}function t(V,U){this.sm=V;this.target=U;U.addEventListener("dragend",this.sm.boundDragEndHandler);U.addEventListener("drag",this.sm.boundDragHandler)}t.prototype.end=function G(){this.target.removeEventListener("dragend",this.sm.boundDragEndHandler);this.target.removeEventListener("drag",this.sm.boundDragHandler)};M.StateMachine.prototype.dragStartHandler=function j(V){var U;if(this.currentDnD){this.currentDnD.end();this.currentDnD=null}U=o(this,V);F(this,V,"ondragstart",U);if(!V.defaultPrevented){this.currentDnD=new t(this,V.target)}};M.StateMachine.prototype.dragEndHandler=function A(V){var U;this.currentDnD.end();this.currentDnD=null;if(this.buttons){this.buttons=0;I(this)}U=o(this,V);F(this,V,"ondragend",U)};function v(W,U){M.StateMachine.prototype[U]=function V(Y){var X;X=o(this,Y);F(this,Y,W,X)}}v("ondrag","dragHandler");v("ondragenter","dragEnterHandler");v("ondragexit","dragExitHandler");v("ondragleave","dragLeaveHandler");v("ondragover","dragOverHandler");v("ondrop","dropHandler");M.StateMachine.prototype.buildEventDataFromTouchEvent=function(aa){var Y,Z,X;X=this;Y={};function V(ac){var ai,ag,ae,af,ab,ad,ah,aj,ak;ae=ac.length;ai=new Array(ae);for(ag=0;ag<ae;++ag){af=ac[ag];if(Y.hasOwnProperty(af.identifier)){ai[ag]=Y[af.identifier]}else{ab=X.pick.pick(af.clientX,af.clientY,X.domRoot);ad=X.graphView.clientToViewpoint(af.clientX,af.clientY);if(X.touchPoints.hasOwnProperty(af.identifier)&&(ak=X.touchPoints[af.identifier].dragStart,ak)){ah=[af.clientX-ak.clientPos[0],af.clientY-ak.clientPos[1]];aj=[ad[0]-ak.graphPos[0],ad[1]-ak.graphPos[1]]}else{ah=null;aj=null;ak=null}Y[af.identifier]=ai[ag]={identifier:af.identifier,inside:ab.inside,grElt:ab.grElt,subElt:ab.subElt,dom:af.target,clientPos:[af.clientX,af.clientY],graphPos:ad,dragStart:ak,clientDelta:ah,graphDelta:aj}}}return ai}function W(ab){return X.touchPoints.hasOwnProperty(ab.identifier)}function U(ab){return X.touchPoints.hasOwnProperty(ab.identifier)&&ab.dom===aa.target}Z={};Z.touches=V(aa.touches);Z.changedTouches=V(aa.changedTouches).filter(U);Z.graphTouches=Z.touches.filter(W);Z.modifiers=0;if(aa.shiftKey){Z.modifiers|=M.Modifiers.SHIFT}if(aa.ctrlKey){Z.modifiers|=M.Modifiers.CTRL}if(aa.altKey){Z.modifiers|=M.Modifiers.ALT}return Z};M.StateMachine.prototype.touchStartHandler=function(Z){var Y,X,U,W,V,aa;W=Z.changedTouches;for(X=0,U=W.length;X<U;++X){V=W[X];if(V.target!==Z.target){continue}if(this.touchPoints.hasOwnProperty(V.identifier)){throw new Error("Two touch start events with the same identifier")}for(aa=this.touchTargets.first;aa&&aa.target!==V.target;aa=aa.next){}if(!aa){aa=new e(V.target);this.touchTargets.addLast(aa);V.target.addEventListener("touchmove",this.boundTouchMoveHandler);V.target.addEventListener("touchend",this.boundTouchEndHandler);V.target.addEventListener("touchcancel",this.boundTouchCancelHandler)}aa.count+=1;this.touchPoints[V.identifier]=new k(V.identifier,aa)}Y=this.buildEventDataFromTouchEvent(Z);W=Y.changedTouches;for(X=0,U=W.length;X<U;++X){this.touchPoints[W[X].identifier].dragStart=W[X]}F(this,Z,"ontouchstart",Y)};M.StateMachine.prototype.touchMoveHandler=function(W){var V,U;if(W.eventPhase!==Event.AT_TARGET){return}U=this;V=this.buildEventDataFromTouchEvent(W,true);if(!V.changedTouches.length){return}F(this,W,"ontouchmove",V)};M.StateMachine.prototype.removeTouchDrags=function(Y){var X,U,W,V;W=Y.changedTouches;for(X=0,U=W.length;X<U;++X){V=W[X];if(V.target!==Y.target){continue}if(this.touchPoints.hasOwnProperty(V.identifier)){this.touchPoints[V.identifier].dragStart=null}}};M.StateMachine.prototype.removeTouchPoints=function(Z){var X,U,W,V,aa,Y;W=Z.changedTouches;for(X=0,U=W.length;X<U;++X){V=W[X];if(V.target!==Z.target){continue}if(this.touchPoints.hasOwnProperty(V.identifier)){aa=this.touchPoints[V.identifier];Y=aa.touchTarget;Y.count-=1;if(Y.count===0){Y.target.removeEventListener("touchmove",this.boundTouchMoveHandler);Y.target.removeEventListener("touchend",this.boundTouchEndHandler);Y.target.removeEventListener("touchcancel",this.boundTouchCancelHandler);this.touchTargets.remove(Y)}delete this.touchPoints[V.identifier]}}};M.StateMachine.prototype.touchEndHandler=function(V){var U;if(V.eventPhase!==Event.AT_TARGET){return}this.removeTouchDrags(V);U=this.buildEventDataFromTouchEvent(V);this.removeTouchPoints(V);if(!U.changedTouches.length){return}F(this,V,"ontouchend",U)};M.StateMachine.prototype.touchCancelHandler=function(V){var U;if(V.eventPhase!==Event.AT_TARGET){return}this.removeTouchDrags(V);U=this.buildEventDataFromTouchEvent(V);this.removeTouchPoints(V);if(!U.changedTouches.length){return}F(this,V,"ontouchcancel",U)};M.SinglePtDrag=function(){this.ignoreMouse=false};M.SinglePtDrag.prototype.onmove=function(U){throw new Error("Not implemented in subclass")};function g(U){var V;if(this.ignoreMouse){return}V={inside:U.inside,grElt:U.grElt,subElt:U.subElt,dom:U.dom,clientPos:U.clientPos,graphPos:U.graphPos,dragStart:U.dragStart,clientDelta:U.clientDelta,graphDelta:U.graphDelta};return this.onmove(U)}M.SinglePtDrag.prototype.onmousemove=g;M.SinglePtDrag.prototype.ondragenter=g;M.SinglePtDrag.prototype.ondragover=g;M.SinglePtDrag.prototype.ontouchmove=function(U){var W,V;if(U.graphTouches.length>1){throw new Error("Multiple touch points not supported by single point drag")}if(U.changedTouches.length>1){throw new Error("Invalid State: "+U.changedTouches.length+" changed touches but 1 target touch")}V=U.changedTouches[0];if(V!==U.graphTouches[0]){throw new Error("Invalid State: changed touch is not target touch")}this.ignoreMouse=true;W={inside:V.inside,grElt:V.grElt,subElt:V.subElt,dom:V.dom,clientPos:V.clientPos,graphPos:V.graphPos,dragStart:V.dragStart,clientDelta:V.clientDelta,graphDelta:V.graphDelta};this.onmove(W)};M.MixDrag=function(U){this.drag=U};S.inherit(M.MixDrag,M.SinglePtDrag);M.MixDrag.prototype.chooseDrag=function(U){throw new Error("Not implemented in child class")};M.MixDrag.prototype.onmove=function(U){var V=this.chooseDrag(U);if(V!==this.drag){this.drag.onend(true);this.drag=V}if(this.drag.onmove){return this.drag.onmove(U)}};M.MixDrag.prototype.onmousedown=function(U){if(this.drag.onmousedown){return this.drag.onmousedown(U)}};M.MixDrag.prototype.onmouseup=function(U){if(this.drag.onmouseup){return this.drag.onmouseup(U)}};M.MixDrag.prototype.ontouchstart=function(U){if(this.drag.ontouchstart){return this.drag.ontouchstart(U)}};M.MixDrag.prototype.ontouchend=function(U){if(this.drag.ontouchend){return this.drag.ontouchend(U)}};M.MixDrag.prototype.ontouchcancel=function(U){if(this.drag.ontouchcancel){return this.drag.ontouchcancel(U)}};M.MixDrag.prototype.onend=function(U){if(this.drag.onend){return this.drag.onend(U)}};function N(V){var W,X,U,Y;U=V.length;W=new Array(U);for(X=0;X<U;++X){Y=V[X];W[X]=[Y.left,Y.top]}return W}M.NodeDrag=function(V,U){this.gr=V;this.nodes=null;this.starts=null;this.nodes=U?U.slice():null};S.inherit(M.NodeDrag,M.SinglePtDrag);function H(V){var U,W;U=[];for(W=V.selection.first;W;W=W.nextSel){if(W.type===u.Type.NODE||W.type===u.Type.GROUP){U.push(W)}}return U}M.NodeDrag.prototype.onmove=function(X){var Y,W,V,U;if(!this.nodes){this.nodes=H(this.gr)}if(!this.starts){u.topologicalSortNodes(this.nodes,true);this.starts=N(this.nodes)}this.gr.updateLock();try{for(V=0,U=this.nodes.length;V<U;++V){Y=this.nodes[V];W=this.starts[V];Y.multiset("left",W[0]+X.graphDelta[0],"top",W[1]+X.graphDelta[1])}}finally{this.gr.updateUnlock()}};M.NodeDrag.prototype.onend=function(X){var V,U,Y,W;if(X){this.gr.updateLock();try{for(V=0,U=this.nodes.length;V<U;++V){Y=this.nodes[V];W=this.starts[V];Y.multiset("left",W[0],"top",W[1])}}finally{this.gr.updateUnlock()}}};M.ResizeNodeDrag=function(U,W,V){this.n=W;this.side=V.resize_sides;this.start={left:W.left,top:W.top,width:W.width,height:W.height}};S.inherit(M.ResizeNodeDrag,M.SinglePtDrag);M.ResizeNodeDrag.prototype.onmove=function(U){var V;u.ObservableData.lock();try{if(this.side&M.Sides.LEFT){V=Math.min(U.graphDelta[0],this.start.width-60);this.n.set("left",this.start.left+V);this.n.set("width",this.start.width-V)}else{if(this.side&M.Sides.RIGHT){V=Math.max(U.graphDelta[0],60-this.start.width);this.n.set("width",this.start.width+V)}}if(this.side&M.Sides.TOP){V=Math.min(U.graphDelta[1],this.start.height-60);this.n.set("top",this.start.top+V);this.n.set("height",this.start.height-V)}else{if(this.side&M.Sides.BOTTOM){V=Math.max(U.graphDelta[1],60-this.start.height);this.n.set("height",this.start.height+V)}}}finally{u.ObservableData.unlock()}};M.ResizeNodeDrag.prototype.onend=function(U){if(U){this.n.multiset("left",this.start.left,"top",this.start.top,"width",this.start.width,"height",this.start.height)}};M.EdgeReshapingDrag=function(U,V){M.SinglePtDrag.apply(this,arguments);this.gr=U;this.edge=V;this.pickedSegmentOptions=null;this.valid=true;this.initialPath=V.path.slice(0)};S.inherit(M.EdgeReshapingDrag,M.SinglePtDrag);M.EdgeReshapingDrag.prototype.onmove=function(U){var V;if(!this.edge){return}V=this.edge.geometry;if(!this.pickedSegmentOptions){this.pickedSegmentOptions=V.getPickedSegmentOptions(this.edge,U.graphPos);this.valid=V.isReshapingValid(this.edge,this.pickedSegmentOptions,U.graphPos)}if(this.valid){V.reshapePath(this.edge,this.pickedSegmentOptions,U.graphPos)}};M.EdgeReshapingDrag.prototype.onend=function(U){if(!this.edge){return}var V=this.edge.geometry;if(U&&this.initialPath){this.edge.set("path",this.initialPath)}else{if(V&&V.refinePath){V.refinePath(this.edge)}}};M.ConnDrag=function(U,V){this.c=V};S.inherit(M.ConnDrag,M.SinglePtDrag);M.ConnDrag.prototype.onmove=function(V){var U=S.closestSide(this.c.node,V.graphPos[0],V.graphPos[1]);if(!this.start){this.start={attach:this.c.cstr.attach,offset:this.c.cstr.offset}}this.c.multiset(["cstr","attach"],U.idx,["cstr","offset"],U.offset)};M.ConnDrag.prototype.onend=function(U){if(U&&this.start){this.c.multiset(["cstr","attach"],this.start.attach,["cstr","offset"],this.start.offset)}delete this.start};M.ConnConnectDrag=function(U,V){this.gr=U;this.c=V;this.edge=null;this.otherConnector=null;this.temp=null;this.firstMove=true;this.edgeInsertionOpts={autoPairSelection:true}};S.inherit(M.ConnConnectDrag,M.SinglePtDrag);M.ConnConnectDrag.prototype.onpick=function(U){return U.grElt};M.ConnConnectDrag.prototype.onaccept=function(V,U){return true};M.ConnConnectDrag.prototype.onfirstmove=function(){};M.ConnConnectDrag.prototype.ondisconnect=function(X,U,V,W){};M.ConnConnectDrag.prototype.onconnect=function(W,U,V){};M.ConnConnectDrag.prototype.onmove=function(V){var U;this.gr.updateLock();try{if(this.firstMove){this.firstMove=false;this.onfirstmove()}U=this.onpick(V);if(U===this.otherConnector){return}var W=U&&U!==this.c&&U.type===u.Type.CONNECTOR&&U.getGraph()===this.c.getGraph()&&this.onaccept(this.c,U);if(W){if(this.temp){this.gr.removeNode(this.temp.node);this.ondisconnect(this.temp.edge,this.temp.conn,true,U);this.temp=null}if(this.edge&&U!==this.edge.cl2.c){this.gr.removeEdge(this.edge);this.ondisconnect(this.edge,this.otherConnector,false,U);this.edge=null;this.otherConnector=null}if(!this.edge){this.edge=this.newEdge(this.c,U);this.otherConnector=U;this.gr.addEdge(this.c,U,this.edge,this.edgeInsertionOpts);this.onconnect(this.edge,this.otherConnector,false)}}else{if(this.edge){this.gr.removeEdge(this.edge);this.ondisconnect(this.edge,this.otherConnector,false,null);this.edge=null;this.otherConnector=null}if(!this.temp){this.temp={};this.temp.node=this.newTempNode();this.temp.conn=this.newTempConn();this.gr.addNode(this.temp.node);this.gr.addConnector(this.temp.node,this.temp.conn);this.temp.edge=this.newTempEdge();this.gr.addEdge(this.c,this.temp.conn,this.temp.edge,this.edgeInsertionOpts);this.onconnect(this.temp.edge,this.temp.conn,true)}this.temp.node.multiset("left",V.graphPos[0],"top",V.graphPos[1])}}finally{this.gr.updateUnlock()}};M.ConnConnectDrag.prototype.onend=function(U){this.gr.updateLock();try{this.firstMove=true;if(this.temp){this.gr.removeNode(this.temp.node);this.ondisconnect(this.edge,this.temp.conn,true,null);this.temp=null}if(this.edge&&U){this.gr.removeEdge(this.edge);this.ondisconnect(this.edge,this.otherConnector,false,null);this.edge=null;this.otherConnector=null}}finally{this.gr.updateUnlock()}};M.ConnConnectDrag.prototype.newTempNode=function(){return new u.Node()};M.ConnConnectDrag.prototype.newTempConn=function(){return new u.Connector()};M.ConnConnectDrag.prototype.newTempEdge=function(){return new u.Edge(new d.SVGEdgeView("egraph_views_SVGEdgeView temp"),null,this.geometry)};M.ConnConnectDrag.prototype.newEdge=function(V,U){return new u.Edge(new d.SVGEdgeView(),null,this.geometry)};M.RerouteConnConnectDrag=function(Y,U,Z){M.ConnConnectDrag.call(this,Y,U);this.edgesToReroute=Z.edgesToReroute||[];this.nbEdgesToReroute=this.edgesToReroute.length;this.currentConnector=U;this.removed=false;this.beginConnectors=[];this.edges=[];this.selected=[];for(var W=0;W<this.nbEdgesToReroute;W++){var X=this.edgesToReroute[W].cl1.c;var V=this.edgesToReroute[W].cl2.c;this.beginConnectors[W]=(this.currentConnector===X?V:X);this.selected[W]=this.edgesToReroute[W].selected}};S.inherit(M.RerouteConnConnectDrag,M.ConnConnectDrag);M.RerouteConnConnectDrag.prototype.onend=function(V){M.ConnConnectDrag.prototype.onend.apply(this,arguments);if(this.removed&&this.edges.length===0){for(var U=0;U<this.nbEdgesToReroute;U++){this.gr.addEdge(this.currentConnector,this.beginConnectors[U],this.edgesToReroute[U]);if(this.selected[U]){this.gr.addToSelection(this.edgesToReroute[U])}}}};M.RerouteConnConnectDrag.prototype.onfirstmove=function(){this.removed=true;for(var U=0;U<this.nbEdgesToReroute;U++){this.ondisconnect(this.edgesToReroute[U],this.currentConnector,false,null);this.gr.removeEdge(this.edgesToReroute[U]);this.edgesToReroute[U].remove()}};M.RerouteConnConnectDrag.prototype.onmove=function(W){var U;this.gr.updateLock();try{if(this.firstMove){this.firstMove=false;this.onfirstmove()}U=this.onpick(W);if(U===this.otherConnector){return}var Y=U&&U.type===u.Type.CONNECTOR&&U.getGraph()===this.currentConnector.getGraph();for(var V=0;Y&&V<this.nbEdgesToReroute;V++){Y=Y&&(U!==this.beginConnectors[V]);Y=Y&&this.onaccept(this.beginConnectors[V],U)}if(Y){if(this.temp){this.gr.removeNode(this.temp.node)}var X=this.otherConnector;for(var V=0;V<this.nbEdgesToReroute;V++){if(this.temp&&this.temp.edges[V]){this.ondisconnect(this.temp.edges[V],this.temp.conn,true,U)}if(this.edges[V]&&U!==this.edges[V].cl2.c){this.otherConnector=null;this.ondisconnect(this.edges[V],X,false,U);this.gr.removeEdge(this.edges[V]);this.edges[V]=null}if(!this.edges[V]){this.edges[V]=this.newEdge(this.beginConnectors[V],U);if(!this.otherConnector){this.otherConnector=U}this.gr.addEdge(this.beginConnectors[V],U,this.edges[V],this.edgeInsertionOpts);if(this.selected[V]){this.gr.addToSelection(this.edges[V])}this.onconnect(this.edges[V],this.otherConnector,false)}}this.temp=null}else{if(!this.temp){this.temp={};this.temp.node=this.newTempNode();this.temp.conn=this.newTempConn();this.gr.addNode(this.temp.node);this.gr.addConnector(this.temp.node,this.temp.conn);this.temp.edges=[]}this.temp.node.multiset("left",W.graphPos[0],"top",W.graphPos[1]);for(var V=0;V<this.nbEdgesToReroute;V++){if(this.edges[V]){this.ondisconnect(this.edges[V],this.otherConnector,false,null);this.gr.removeEdge(this.edges[V]);this.edges[V]=null;this.otherConnector=null}this.temp.edges[V]=this.newTempEdge();this.gr.addEdge(this.beginConnectors[V],this.temp.conn,this.temp.edges[V],this.edgeInsertionOpts);this.onconnect(this.temp.edges[V],this.temp.conn,true)}this.edges=[]}}finally{this.gr.updateUnlock()}};function E(V,U,W){return new M.NodeDrag(V)}var R=[];R[u.Type.NODE]={"":E,resize:M.ResizeNodeDrag};R[u.Type.GROUP]={"":E};R[u.Type.CONNECTOR]={"":M.ConnConnectDrag,reroute:M.RerouteConnConnectDrag};M.ViewpointMoveDrag=function(U){this.grView=U};S.inherit(M.ViewpointMoveDrag,M.SinglePtDrag);M.ViewpointMoveDrag.prototype.onmove=function(U){if(!this.start){this.start=this.grView.vpt.slice()}var V=[this.start[0]+U.clientDelta[0],this.start[1]+U.clientDelta[1],this.start[2]];this.grView.setViewpoint(V)};M.ViewpointMoveDrag.prototype.onend=function(U){if(U){this.grView.setViewpoint(this.start)}};M.ViewpointTwoTouchesDrag=function(U){this.grView=U};M.ViewpointTwoTouchesDrag.prototype.ontouchmove=function(W){var V,U,Z;function Y(aa){return Math.sqrt(Math.pow(aa.graphTouches[0].clientPos[0]-aa.graphTouches[1].clientPos[0],2)+Math.pow(aa.graphTouches[0].clientPos[1]-aa.graphTouches[1].clientPos[1],2))}if(!this.start){this.start=this.grView.vpt.slice();this.startDist=Y(W);this.fixPt=[(W.graphTouches[0].graphPos[0]+W.graphTouches[1].graphPos[0])/2,(W.graphTouches[0].graphPos[1]+W.graphTouches[1].graphPos[1])/2]}V=(W.graphTouches[0].clientDelta[0]+W.graphTouches[1].clientDelta[0])/2;U=(W.graphTouches[0].clientDelta[1]+W.graphTouches[1].clientDelta[1])/2;Z=Y(W);var X=S.changeViewpointScale(this.start,this.start[2]*Z/this.startDist,this.fixPt,true);X[0]+=V;X[1]+=U;this.grView.setViewpoint(X)};M.ViewpointScaleDrag=function(V,U){this.grView=V;this.center=U};M.ViewpointScaleDrag.prototype.onmousemove=function(U){if(!this.start){this.start=this.grView.vpt.slice()}var V=S.incViewpointScale(this.start,U.clientDelta[1]*0.03125,this.center,true);this.grView.setViewpoint(V)};M.ViewpointScaleDrag.prototype.onend=function(U){if(U){this.grView.setViewpoint(this.start)}};M.RectDrag=function T(W,U,V){M.SinglePtDrag.call(this);if(!isFinite(W)){throw new Error("startLeft must be finite")}if(!isFinite(U)){throw new Error("startTop must be finite")}if(!V||typeof V.setRectangle!=="function"){throw new Error("overlay must be an object with a setRectangle function")}this.x1=W;this.y1=U;this.x2=W;this.y2=U;this.overlay=V};S.inherit(M.RectDrag,M.SinglePtDrag);M.RectDrag.prototype.onmove=function s(U){this.x2=U.graphPos[0];this.y2=U.graphPos[1];this.overlay.setRectangle(this.x1,this.y1,this.x2,this.y2)};M.RectDrag.prototype.onend=function h(U){if(M.SinglePtDrag.prototype.onend){M.SinglePtDrag.prototype.onend.apply(this,arguments)}this.overlay.remove();if(!U){this.apply(this.gr,this.x1,this.y1,this.x2,this.y2)}};M.RectDrag.prototype.apply=function P(){throw new Error("MUST be overridden")};M.RectSelectionDrag=function l(Z,X,U,W,aa,Y,V){M.RectDrag.call(this,X,U,W);if(!Z){throw new Error("grView can't be null")}this.grView=Z;this.pickOpts=aa;this.selectionMode=Y!==undefined?Y:u.SelectionMode.REPLACE;if(V!==undefined){if(typeof V!=="function"){throw new Error("apply must be a function")}this.apply=V}};S.inherit(M.RectSelectionDrag,M.RectDrag);M.RectSelectionDrag.prototype.apply=function P(){this.grView.gr.updateSelection(this.grView.rectanglePick(this.x1,this.y1,this.x2,this.y2,this.pickOpts),this.selectionMode)};M.RectSelectionWaitPt1=function m(U){if(U&&U.overlay&&(typeof U.overlay.setRectangle!=="function"||typeof U.overlay.remove!=="function")){throw new Error("overlay must be an object with setRectangle and remove functions")}if(U&&typeof U.endcb!=="undefined"&&typeof U.endcb!=="function"){throw new Error("endcb must be either a function or undefined")}if(U&&typeof U.configcb!=="undefined"&&typeof U.configcb!=="function"){throw new Error("configcb must be either a function or undefined")}if(U&&typeof U.applycb!=="undefined"&&typeof U.applycb!=="function"){throw new Error("applycb must be either a function or undefined")}this.pickOpts=U?U.pickOpts:undefined;this.selectionMode=U&&U.selectionMode!==undefined?U.selectionMode:u.SelectionMode.REPLACE;this.overlay=U?U.overlay:undefined;this.endcb=U?U.endcb:undefined;this.configcb=U?U.configcb:undefined;this.applycb=U?U.applycb:undefined};M.RectSelectionWaitPt1.prototype.oninstall=function q(U){if(!this.overlay){this.overlay=new d.RectangleOverlay(U.graphView)}U.enddrag(true)};M.RectSelectionWaitPt1.prototype.onuninstall=function p(V,U){if(U){this.overlay.remove()}};M.RectSelectionWaitPt1.prototype.onmousedown=function D(W,V){var U;if(V.button!==M.Buttons.LEFT){return{consume:true}}if(this.configcb){this.configcb.call(this)}U=new M.RectSelectionDrag(W.graphView,V.graphPos[0],V.graphPos[1],this.overlay,this.pickOpts,this.selectionMode,this.applycb);W.startdrag(U);return{consume:true,state:new M.EndDragOnLeftRelease(this.endcb)}};M.RectSelectionWaitPt1.prototype.ontouchstart=function L(W,V){var U;if(V.graphTouches.length!==1){return{consume:true,state:M.WaitLastTouch}}if(this.configcb){this.configcb.call(this)}U=new M.RectSelectionDrag(W.graphView,V.graphTouches[0].graphPos[0],V.graphTouches[0].graphPos[1],this.overlay,this.pickOpts,this.selectionMode,this.applycb);W.startdrag(U);return{consume:true,state:new M.EndDragOnTouchChange(this.endcb)}};M.EndDragOnLeftRelease=function Q(U){if(typeof U!=="undefined"&&typeof U!=="function"){throw new Error("endcb must be either a function or undefined")}this.endcb=U};M.EndDragOnLeftRelease.prototype.oncontextmenu=function C(V,U){return{consume:true}};M.EndDragOnLeftRelease.prototype.onmouseup=function y(V,U){if(U.button===M.Buttons.LEFT){V.enddrag(false);if(this.endcb){this.endcb()}return{consume:true,state:null}}return{}};M.EndDragOnLeftState=new M.EndDragOnLeftRelease();M.WaitLastTouch={};M.WaitLastTouch.ontouchend=function(V,U){if(U.graphTouches.length){return{consume:true}}else{return{consume:true,state:null}}};M.WaitLastTouch.ontouchcancel=M.WaitLastTouch.ontouchend;M.EndDragOnSinleTouchEnd={ontouchstart:function(V,U){V.enddrag(true);return{consume:true,state:M.WaitLastTouch}},ontouchend:function(V,U){V.enddrag(false);return{consume:true,state:null}},ontouchcancel:function(V,U){V.enddrag(true);return{consume:true,state:null}}};M.EndDragOnTouchChange=function O(U){if(typeof U!=="undefined"&&typeof U!=="function"){throw new Error("endcb must be either a function or undefined")}this.endcb=U};M.EndDragOnTouchChange.prototype.ontouchstart=function L(V,U){V.enddrag(true);if(this.endcb){this.endcb()}return{consume:true,state:M.WaitLastTouch}};M.EndDragOnTouchChange.prototype.ontouchend=function x(V,U){V.enddrag(false);if(this.endcb){this.endcb()}return{consume:true,state:U.graphTouches.length?M.WaitLastTouch:null}};M.EndDragOnTouchChange.prototype.ontouchcancel=function K(V,U){V.enddrag(true);if(this.endcb){this.endcb()}return{consume:true,state:U.graphTouches.length?M.WaitLastTouch:null}};(function b(){var U=new M.EndDragOnTouchChange();M.EndDragOnTouchChange.ontouchstart=U.ontouchstart.bind(U);M.EndDragOnTouchChange.ontouchend=U.ontouchend.bind(U);M.EndDragOnTouchChange.ontouchcancel=U.ontouchcancel.bind(U)}());M.TwoPointsViewpointWait={ontouchstart:function(V,U){V.enddrag(true);return{consume:true,state:M.WaitLastTouch}},ontouchend:function(V,U){V.enddrag(false);return{consume:true,state:U.graphTouches.length?M.WaitLastTouch:null}},ontouchcancel:function(V,U){V.enddrag(true);return{consume:true,state:U.graphTouches.length?M.WaitLastTouch:null}},ontouchmove:function(V,U){if(!M.isTouchDragSignificant(U)){return{consume:true}}V.startdrag(new M.ViewpointTwoTouchesDrag(V.graphView));return{consume:true,state:M.EndDragOnTouchChange}}};M.DefaultRootState=function n(){this.longTouchDelay=600;this.onlongtouchstart=null;this.onlongtouchcancel=null;this.doubleClickOnNode=null};M.DefaultRootState.prototype.onlongtouchend=function(W,V){if(W.edgeRerouteOptions.active&&V.graphTouches.length===1&&V.graphTouches[0].grElt){var U=M.GetRerouteDrag.call(this,W,V.graphTouches[0].grElt,false);if(U){W.startdrag(U);w.call(W,M.EndDragOnTouchChange,false)}}};M.DefaultRootState.prototype.newDragForElement=function(W,V,Y){var U=R[V.type],X;if(U){X=U[Y?Y.id:""]}return X?new X(W,V,Y):null};function r(V,U){return Math.abs(V)+Math.abs(U)>12}M.isTouchDragSignificant=function(W){var V,U;for(V=0,U=W.graphTouches.length;V<U;++V){if(r(W.graphTouches[V].clientDelta[0],W.graphTouches[V].clientDelta[1])){return true}}return false};M.DefaultRootState.prototype.ontouchstart=function(ab,aa){var Z,Y,X;Y=this;if(aa.changedTouches.length===2){return{consume:true,state:M.TwoPointsViewpointWait}}if(aa.changedTouches.length>2){return{consume:true,state:M.WaitLastTouch}}X={timer:setTimeout(function U(){if(X.done){return}X.done=true;Y.onlongtouchend(ab,aa);if(Y.onlongtouchendCB){Y.onlongtouchendCB(ab,aa)}},this.longTouchDelay),cancel:function W(){if(this.done){return}clearTimeout(this.timer);this.done=true;if(Y.onlongtouchcancel){Y.onlongtouchcancel(ab,aa)}},done:false};Z={onuninstall:function V(){X.cancel()},ontouchstart:function(ad,ac){X.cancel();if(ac.changedTouches.length===1){return{consume:true,state:M.TwoPointsViewpointWait}}else{return{consume:true,state:M.WaitLastTouch}}},ontouchend:function(){var ac;X.cancel();if(aa.graphTouches[0].grElt){if(!ab.graph.isSelected(aa.graphTouches[0].grElt)){ab.graph.addToSelection(aa.graphTouches[0].grElt)}else{ab.graph.removeFromSelection(aa.graphTouches[0].grElt)}ac=Y.newDragForElement(ab.graph,aa.graphTouches[0].grElt,aa.graphTouches[0].subElt);if(ac){ab.startdrag(ac);ab.enddrag(false)}}else{ab.graph.clearSelection()}return{consume:true,state:null}},ontouchcancel:function(){X.cancel();return{consume:true,state:null}},ontouchmove:function(ae,ad){var ac;if(!M.isTouchDragSignificant(ad)){return{consume:true}}X.cancel();if(aa.graphTouches.length===1){if(aa.graphTouches[0].grElt){if(ab.edgeRerouteOptions.active&&ab.edgeRerouteOptions.alwaysRerouteSelection){ac=M.GetRerouteDrag.call(Y,ab,aa.graphTouches[0].grElt,true);if(ac){ab.startdrag(ac);return{consume:true,state:M.EndDragOnTouchChange}}}if(aa.graphTouches[0].grElt.type===u.Type.EDGE&&aa.graphTouches[0].grElt.geometry&&aa.graphTouches[0].grElt.geometry.reshapable){ac=new M.EdgeReshapingDrag(ab.graph,aa.graphTouches[0].grElt);ab.startdrag(ac);return{consume:true,state:M.EndDragOnTouchChange}}if(!ab.graph.isSelected(aa.graphTouches[0].grElt)){ab.graph.replaceSelectionWith(aa.graphTouches[0].grElt);if(aa.graphTouches[0].grElt.bringToFront){aa.graphTouches[0].grElt.bringToFront()}}ac=Y.newDragForElement(ab.graph,aa.graphTouches[0].grElt,aa.graphTouches[0].subElt);if(ac){ab.startdrag(ac)}}else{ab.startdrag(new M.ViewpointMoveDrag(ab.graphView))}}return{consume:true,state:M.EndDragOnTouchChange}}};if(Y.onlongtouchstart){Y.onlongtouchstart(ab,aa)}return{consume:true,state:Z}};M.DefaultRootState.prototype.ontouchmove=function(V,U){return{consume:true}};M.DefaultRootState.prototype.ontouchend=function(V,U){return{consume:true}};M.DefaultRootState.prototype.ontouchcancel=function(V,U){return{consume:true}};M.DefaultRootState.prototype.ondoubleclick=function(Y,X){var U,W;if(X.button===M.Buttons.LEFT){W=X.grElt;if(W&&W.type===u.Type.EDGE){if(W.geometry&&W.geometry.splittable){var V=W.geometry.getPickedSegmentOptions(W,X.graphPos);if(W.geometry.isSplitValid(W,V,X.graphPos)){W.geometry.splitPath(W,V,X.graphPos)}return{consume:true}}}if(W&&W.type===u.Type.NODE){if(U=this.doubleClickOnNode,U){U(W);return{consume:true}}}}return{}};M.DefaultRootState.prototype.onmousemove=function(W,V){W.graph._setEdgePickingAreaOverlayingFromPoint(V.grElt,V.clientPos[0],V.clientPos[1]);W.graph._restoreEdgePickingAreasSelectionCapability();if(W.currentHoveredElement){if(W.currentHoveredElement.type===u.Type.EDGE&&W.currentHoveredElement.geometry&&(W.currentHoveredElement.geometry.reshapable||W.currentHoveredElement.geometry.splittable)){W.currentHoveredElement.view.display.elt.classList.remove("modifiable")}W.currentHoveredElement=null}if(V.inside){if(V.grElt){W.currentHoveredElement=V.grElt;if(V.grElt.type===u.Type.EDGE&&V.grElt.geometry&&(V.grElt.geometry.reshapable||V.grElt.geometry.splittable)){var U=V.grElt.geometry.getPickedSegmentOptions(V.grElt,V.graphPos);if(V.grElt.geometry.reshapable&&V.grElt.geometry.isReshapingValid(V.grElt,U,V.graphPos)||V.grElt.geometry.splittable&&V.grElt.geometry.isSplitValid(V.grElt,U,V.graphPos)){V.grElt.view.display.elt.classList.add("modifiable");W.currentHoveredElement=V.grElt}}}}};M.DefaultRootState.prototype.onmousedown=function(W,V){var U;if(V.inside){if(V.button===M.Buttons.LEFT){if(V.modifiers&M.Modifiers.ALT){if(V.modifiers&M.Modifiers.CTRL){W.startdrag(new M.ViewpointScaleDrag(W.graphView,V.graphPos))}else{W.startdrag(new M.ViewpointMoveDrag(W.graphView))}return{consume:true,state:M.EndDragOnLeftState}}if(V.grElt){if(W.edgeRerouteOptions.active&&V.grElt.type===u.Type.CONNECTOR){if(V.modifiers&W.edgeRerouteOptions.modifier){U=M.GetRerouteDrag.call(this,W,V.grElt,false)}else{if(W.edgeRerouteOptions.alwaysRerouteSelection){U=M.GetRerouteDrag.call(this,W,V.grElt,true)}}if(U){W.startdrag(U);return{consume:true,state:M.EndDragOnLeftState}}}if(V.grElt.type===u.Type.EDGE&&V.grElt.geometry&&V.grElt.geometry.reshapable){U=new M.EdgeReshapingDrag(W.graph,V.grElt);W.startdrag(U);return{consume:true,state:M.EndDragOnLeftState}}if(V.modifiers===M.Modifiers.SHIFT){if(W.graph.isSelected(V.grElt)){W.graph.removeFromSelection(V.grElt)}else{W.graph.addToSelection(V.grElt)}}else{if(V.modifiers===0){W.graph._setEdgePickingAreaOverlayingFromPoint(V.grElt,V.clientPos[0],V.clientPos[1]);if(!W.graph.isSelected(V.grElt)){W.graph.updateLock();try{W.graph.replaceSelectionWith(V.grElt);if(V.grElt.bringToFront){V.grElt.bringToFront()}}finally{W.graph.updateUnlock()}}else{W.graph._removeEdgePickingAreasSelectionCapability(V.grElt)}U=this.newDragForElement(W.graph,V.grElt,V.subElt);if(U){W.startdrag(U);return{consume:true,state:M.EndDragOnLeftState}}}}return{consume:true}}else{if(V.modifiers===0){W.graph.clearSelection()}if(V.modifiers&M.Modifiers.CTRL){W.startdrag(new M.ViewpointScaleDrag(W.graphView,V.graphPos))}else{W.startdrag(new M.ViewpointMoveDrag(W.graphView))}return{consume:true,state:M.EndDragOnLeftState}}}}return{}};M.DefaultRootState.prototype.onwheel=function(Z,V){var Y;if(V.inside){Y=Z.graphView;var U=undefined,X=undefined;if(Y.gr.zoomOpts){if(Y.gr.zoomOpts.min&&!isNaN(Y.gr.zoomOpts.min)){U=Y.gr.zoomOpts.min}if(Y.gr.zoomOpts.max&&!isNaN(Y.gr.zoomOpts.max)){X=Y.gr.zoomOpts.max}}var W=Y.zoominc(0.5*V.wheelDelta,V.clientPos[0],V.clientPos[1],[U,X,0.25]);Z.graph.updateEdgesPickingAreasSize(W[2]);return{consume:true}}else{return{}}};M.GetRerouteDrag=function(Z,U,V){if(U.type===u.Type.CONNECTOR){var Y=[];var X=[];for(var W=U.children.first;W;W=W.next){X.push(W.ref);if(W.ref.selected){Y.push(W.ref)}}if((V||!Z.edgeRerouteOptions.alwaysRerouteSelection)&&Y.length!==0){return this.newDragForElement(Z.graph,U,{id:"reroute",edgesToReroute:Y})}if(!V){return this.newDragForElement(Z.graph,U,{id:"reroute",edgesToReroute:X})}}return null};M.DOMPick=function(){};M.DOMPick.prototype.pick=function(V,U,ab){var aa,Y,X,Z,ac,W;for(aa=ab;aa.parentNode;aa=aa.parentNode){}if(aa.elementFromPoint){if(V&&U){Y=aa.elementFromPoint(V,U)}}for(X=Y;X&&X!==ab;X=X.parentNode){if(ac===undefined&&X.nodeType===Node.ELEMENT_NODE&&X.hasAttribute("data-egraph-subelt")){ac=X.getAttribute("data-egraph-subelt")}if(!Z&&X.grElt){Z=X.grElt;if(ac===undefined){ac=X.subElt}}}W=X===ab;if(!W){Z=null;ac=undefined}return{inside:W,grElt:Z,subElt:ac}};M.SubEltClickDrag=function f(V,W,U){M.SinglePtDrag.call(this);if(typeof U!=="function"){throw new Error("cb must be a function")}this.cb=U;this.grElt=V;this.subElt=W;this.inside=true};S.inherit(M.SubEltClickDrag,M.SinglePtDrag);M.SubEltClickDrag.prototype.onmove=function(U){this.inside=U.grElt===this.grElt&&U.subElt===this.subElt};M.SubEltClickDrag.prototype.onend=function(U){if(!U&&this.inside){this.cb.call(undefined)}};M.SM_HTMLGraphView=function(U,V){d.HTMLGraphView.call(this,U,V);this.rootState=V&&V.rootState||new M.DefaultRootState()};S.inherit(M.SM_HTMLGraphView,d.HTMLGraphView);M.SM_HTMLGraphView.prototype.oninit=function(U){d.HTMLGraphView.prototype.oninit.apply(this,arguments);this.stateMachine=new M.StateMachine(U,new M.DOMPick(),this.rootState,this)};return M});define("egraph/iact",["DS/egraph/iact"],function mod(a){return a});define("DS/egraph/overview",["DS/egraph/utils","DS/egraph/core","DS/egraph/views","DS/egraph/iact"],function(w,t,h,o){var A={},d=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame,g=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame;A.GraphView=function m(B,D,C){t.GraphView.call(this);t.Observable.call(this);h.TransformedGraphView.call(this);if(!B){throw new Error("container parameter can't be null")}if(!D||!D.vpt||!D.vpt.length===3||typeof D.getSize!=="function"){throw new Error("mainview must be an object implementing TransformedGraphView contract")}C=C||{};this.container=B;this.mainview=D;this.mainview_width=NaN;this.mainview_height=NaN;this.width=0;this.height=0;this.maxScale=w.pos_number_opt(C,"maxScale",0.5);this.padding=w.pos_number_opt(C,"padding",5);this.background=w.string_opt(C,"background","");this.nodeFill=w.string_opt(C,"nodeFill","rgba(126, 169, 194, 1.0)");this.groupFill=w.string_opt(C,"groupFill","rgba(185, 203, 219, 0.623)");this.aliasing=w.pos_integer_opt(C,"aliasing",undefined);this.canvas=document.createElement("canvas");this.canvas.width=0;this.canvas.height=0;this.ctx=this.canvas.getContext("2d");if(!this.ctx){throw new Error("canvas 2d context not available")}this.canvasCropper=document.createElement("div");this.canvasCropper.style.display="inlink-block";this.canvasCropper.style.position="absolute";this.canvasCropper.style.top="0";this.canvasCropper.style.left="0";this.canvasCropper.style.width="100%";this.canvasCropper.style.height="100%";this.canvasCropper.style.overflow="hidden";this.canvasCropper.appendChild(this.canvas);this.domRoot=document.createElement("div");this.domRoot.style.display="inlink-block";this.domRoot.style.position="relative";this.domRoot.style.width="0";this.domRoot.style.height="0";this.domRoot.appendChild(this.canvasCropper);this.container.appendChild(this.domRoot);this.overlayMarker=document.createElement("div");this.overlayMarker.className="egraph_views_overlay-marker";this.domRoot.appendChild(this.overlayMarker);this.rect=new w.BoundingRect();this.empty=true;this.__updateFlags__=0;this.__pendingFrame__=false;this._isPierceable=false;y.call(this,w.pos_number_opt(C,"width",300),w.pos_number_opt(C,"height",150));this.rectOverlay=new h.RectHoleOverlay(this,w.obj_opt(C,"hole",undefined));this.boundUpdateOverlay=u.bind(this);this.mainview.addListener("animviewpoint",this.boundUpdateOverlay);this.mainview.addListener("resize",this.boundUpdateOverlay);u.call(this)};var s={SIZE:1,RECT:2};w.inherit(A.GraphView,t.GraphView);w.applyMixin(A.GraphView,t.Observable);w.applyMixin(A.GraphView,h.TransformedGraphView);A.GraphView.prototype.oninit=function e(C,B){t.GraphView.prototype.oninit.apply(this,arguments);this.__updateFlags__|=s.RECT;i.call(this)};function u(F){var H,C,E,B,D,G;if(F&&F.type==="resize"){this.mainview_width=F.size[0];this.mainview_height=F.size[1]}else{if(isNaN(this.mainview_width)||isNaN(this.mainview_height)||this.mainview_width===0||this.mainview_height===0){if(this.mainview_width===0||this.mainview_height===0){this.mainview.setSize()}G=this.mainview.getSize();this.mainview_width=G[0];this.mainview_height=G[1]}}if(this.empty){this.rectOverlay.setRectangle();return}H=this.mainview.animVpt;C=-H[0]/H[2];E=-H[1]/H[2];B=this.mainview_width/H[2];D=this.mainview_height/H[2];this.rectOverlay.setRectangle(C,E,C+B,E+D)}A.GraphView.prototype.setPierceable=function x(B){function D(F){if(!F){return}var E,H,G;for(E=H=F;E.parentNode;E=E.parentNode){G=E.querySelector(".egraph_views_domroot");if(G){return H}H=E}}if(this._isPierceable!==B){var C=D(this.container);if(C){if(B){C.style.opacity=0.2;C.style.pointerEvents="none";this._isPierceable=true}else{C.style.opacity=1;C.style.pointerEvents="auto";this._isPierceable=false}}}};A.GraphView.prototype.onupdate=function c(C,E){function B(G){var J,H,F,I;if(!G){return false}for(H=0,F=G.length;H<F;++H){J=G[H];if(J.__updateFlag__&(4|8)){return true}else{if(J.__updateFlag__&2){I=J.__modifiedProperties__;if(t.inPathSet(I,"actualWidth")||t.inPathSet(I,"actualHeight")||t.inPathSet(I,"actualLeft")||t.inPathSet(I,"actualTop")){return true}}}}return false}var D;t.GraphView.prototype.onupdate.apply(this.arguments);if(C!==this.gr){throw new Error("Invalid Argument: gr")}D=B(E[t.Type.GROUP]);if(!D){D=B(E[t.Type.NODE])}if(D){this.__updateFlag__=s.RECT;i.call(this)}};function i(){if(!this.__pendingFrame__){this.__pendingFrame__=true;d(f.bind(this))}}function f(){function D(ab,Y){var W,aa,V,Z,X,ac;L.fillStyle=Y;for(ac=I.nodes.first;ac;ac=t.dftNext(I,ac)){if(ac.type!==ab){continue}X=ac.views[H];if(!X){continue}V=ac.actualLeft*F+R;Z=ac.actualTop*F+O;W=ac.actualWidth*F;aa=ac.actualHeight*F;if(J){V=Math.round(B*V)*N;Z=Math.round(B*Z)*N;W=Math.round(Math.max(1,B*W))*N;aa=Math.round(Math.max(1,B*aa))*N}L.fillRect(V,Z,W,aa)}}var G,I,H,P,F,R,O,U,T,K,Q,L,M,E;var J,B,N,C,S;C=false;S=false;this.__pendingFrame__=false;G=false;if(this.__updateFlags__&s.SIZE){this.canvas.width=this.width;this.canvas.height=this.height;G=true}I=this.gr;H=this.viewKey;if(this.__updateFlags__&s.RECT){this.rect.reset();for(K=I.nodes.first;K;K=t.dftNext(I,K)){Q=K.views[H];if(Q){M=K.actualLeft;E=K.actualTop;this.rect.update(K,M,M+K.actualWidth,E,E+K.actualHeight)}}G=true;if(this.empty!==!this.rect.isValid()){this.empty=!this.rect.isValid();C=true}}if(G){P=w.reframeViewpoint([this.width,this.height],this.rect,{padding:this.padding,maxScale:this.maxScale,defaultVpt:this.vpt,aliasing:0});if(P[0]!==this.vpt[0]||P[1]!==this.vpt[1]||P[2]!==this.vpt[2]){this.animVpt[0]=this.vpt[0]=P[0];this.animVpt[1]=this.vpt[1]=P[1];this.animVpt[2]=this.vpt[2]=P[2];this.invAnimVptScale=this.invVptScale=1/P[2];S=true}}R=this.vpt[0];O=this.vpt[1];F=this.vpt[2];U=t.Type.NODE;T=t.Type.GROUP;L=this.ctx;L.setTransform(1,0,0,1,0,0);L.clearRect(0,0,this.width,this.height);if(this.background){L.fillStyle=this.background;L.fillRect(0,0,this.width,this.height)}if(typeof this.aliasing==="undefined"){J=false}else{J=true;B=Math.pow(2,this.aliasing);N=Math.pow(2,-this.aliasing)}D(t.Type.GROUP,this.groupFill);D(t.Type.NODE,this.nodeFill);if(C){u.call(this);this.dispatch({type:"empty"})}if(S){this.dispatch({type:"viewpoint",vpt:this.vpt.slice()});this.dispatch({type:"animviewpoint",vpt:this.animVpt.slice()})}}function y(C,B){if(typeof C!=="number"){throw new Error("width must be a number")}if(typeof B!=="number"){throw new Error("height must be a number")}if(!isFinite(C)||C<0){throw new Error("width must be finite and >= 0")}if(!isFinite(B)||B<0){throw new Error("height must be finite and >= 0")}if(this.width===C&&this.height===B){return false}this.width=C;this.height=B;this.domRoot.style.width=w.nb2px(this.width);this.domRoot.style.height=w.nb2px(this.height);this.__updateFlags__|=s.SIZE;return true}A.GraphView.prototype.setSize=function v(C,B){if(y.call(this,C,B)){i.call(this);this.dispatch({type:"resize",size:[this.width,this.height]})}};A.GraphView.prototype.getSize=function b(){return[this.width,this.height]};function a(B){this.ovrGraphView=B;this.start=null}a.prototype.ontouchmove=function(B){var E;function D(F){return Math.sqrt(Math.pow(F.graphTouches[0].clientPos[0]-F.graphTouches[1].clientPos[0],2)+Math.pow(F.graphTouches[0].clientPos[1]-F.graphTouches[1].clientPos[1],2))}if(!this.start){this.start={mainVpt:this.ovrGraphView.mainview.vpt.slice(),ovrVpt:this.ovrGraphView.vpt.slice(),d:D(B),fixPt:[(B.graphTouches[0].graphPos[0]+B.graphTouches[1].graphPos[0])/2,(B.graphTouches[0].graphPos[1]+B.graphTouches[1].graphPos[1])/2]}}E=D(B);var C=w.changeViewpointScale(this.start.mainVpt,this.start.mainVpt[2]*this.start.d/E,this.start.fixPt,true);C[0]-=C[2]*(B.graphTouches[0].clientDelta[0]+B.graphTouches[1].clientDelta[0])/(2*this.start.ovrVpt[2]);C[1]-=C[2]*(B.graphTouches[0].clientDelta[1]+B.graphTouches[1].clientDelta[1])/(2*this.start.ovrVpt[2]);this.ovrGraphView.mainview.setViewpoint(C)};a.prototype.onend=function(B){if(B&&this.start){this.ovrGraphView.mainview.setViewpoint(this.start.mainVpt)}this.start=null};function z(B){this.ovrGraphView=B;this.start=null}w.inherit(z,o.SinglePtDrag);z.prototype.onmove=function(B){if(!this.start){this.start={mainVpt:this.ovrGraphView.mainview.vpt.slice(),ovrVpt:this.ovrGraphView.vpt.slice()}}var C=[this.start.mainVpt[0]-Math.round(this.start.mainVpt[2]*B.clientDelta[0]/this.start.ovrVpt[2]),this.start.mainVpt[1]-Math.round(this.start.mainVpt[2]*B.clientDelta[1]/this.start.ovrVpt[2]),this.start.mainVpt[2]];this.ovrGraphView.mainview.setViewpoint(C)};z.prototype.onend=function(B){if(B&&this.start){this.ovrGraphView.mainview.setViewpoint(this.start.mainVpt)}this.start=null};A.RootState=function l(){var C;function B(G,D){var F,E;E=G.graphView.mainview.getSize();F=[Math.round(E[0]/2-G.graphView.mainview.vpt[2]*D[0]),Math.round(E[1]/2-G.graphView.mainview.vpt[2]*D[1]),G.graphView.mainview.vpt[2]];G.graphView.mainview.setViewpoint(F)}C=this;this.twoPtsWait={ontouchstart:function(E,D){return{consume:true,state:o.WaitLastTouch}},ontouchend:function(E,D){return{consume:true,state:D.graphTouches.length?o.WaitLastTouch:null}},ontouchcancel:function(E,D){return{consume:true,state:D.graphTouches.length?o.WaitLastTouch:null}},ontouchmove:function(E,D){if(!o.isTouchDragSignificant(D)){return{consume:true}}E.startdrag(new a(E.graphView));return{consume:true,state:o.EndDragOnTouchChange}}};this.onePtWait={ontouchstart:function(E,D){if(D.changedTouches.length===1){return{consume:true,state:C.twoPtsWait}}else{return{consume:true,state:o.WaitLastTouch}}},ontouchend:function(E,D){B(E,D.changedTouches[0].graphPos);return{consume:true,state:null}},ontouchcancel:function(){return{consume:true,state:null}},ontouchmove:function(E,D){if(!o.isTouchDragSignificant(D)){return{consume:true}}E.startdrag(new z(E.graphView));return{consume:true,state:o.EndDragOnTouchChange}}};this.leftClickWait={onmouseup:function(E,D){if(D.button===o.Buttons.LEFT){B(E,D.graphPos);return{consume:true,state:null}}return{}},onmousemove:function(E,D){if(D.clientDelta[0]&&D.clientDelta[1]){E.startdrag(new z(E.graphView));return{consume:true,state:o.EndDragOnLeftState}}else{return{}}}}};A.RootState.prototype.onwheel=function(H,D){var G,F,C;if(D.inside){G=H.graphView.mainview;var B=undefined,E=undefined;if(G.gr.zoomOpts){if(G.gr.zoomOpts.min&&!isNaN(G.gr.zoomOpts.min)){B=G.gr.zoomOpts.min}if(G.gr.zoomOpts.max&&!isNaN(G.gr.zoomOpts.max)){E=G.gr.zoomOpts.max}}C=G.getSize();F=w.incViewpointScale(G.vpt,0.5*D.wheelDelta,[0.5*C[0],0.5*C[1]],false,[B,E,0.5]);0.5*1;G.setViewpoint(F,true);return{consume:true}}else{return{}}};A.RootState.prototype.ontouchstart=function n(C,B){if(B.changedTouches.length===2){return{consume:true,state:this.twoPtsWait}}if(B.changedTouches.length>2){return{consume:true,state:A.WaitLastTouch}}return{consume:true,state:this.onePtWait}};A.RootState.prototype.ontouchend=function q(C,B){return{consume:true}};A.RootState.prototype.ontouchcancel=function k(C,B){return{consume:true}};A.RootState.prototype.ontouchmove=function p(C,B){return{consume:true}};A.RootState.prototype.onmousedown=function r(C,B){if(B.inside){if(B.button===o.Buttons.LEFT){return{consume:true,state:this.leftClickWait}}}return{}};A.RootState.prototype.ondragover=function j(C,B){C.graphView.setPierceable(true);return{consume:true}};return A});