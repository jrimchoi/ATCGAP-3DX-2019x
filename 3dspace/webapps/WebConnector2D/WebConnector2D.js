define("DS/WebConnector2D/Loader360",["UWA/Class","DS/WAFData/WAFData"],function(b,a){var c=b.extend({init:function(d){this._parent(d);this.PROJECTION_TYPE={CYLINDRICAL:1,EQUIRECTANGULAR:2}},img:function(d,e){var f=null;if(d&&d.format&&d.path){f=new Promise(function(j,i){var h=document.createElement("img");h.onload=function(){var k={format:d.format,projectionType:this.PROJECTION_TYPE.EQUIRECTANGULAR,fullPanoWidthPixels:h.width,fullPanoHeightPixels:h.height};j({img:h,imgData:k})}.bind(this);h.onerror=function(k){i({error:k})}.bind(this);var g=false;a.authenticatedRequest(d.path,{method:"GET",type:"img",onComplete:function(k){console.log("respBackend");console.log(k)},onFailure:function(k){console.log("errBackend");console.log(k);this.onFailCB("3DPlay 360 Error on")}})}.bind(this))}return f},video:function(d){var e=null;if(d&&d.format&&d.path){e=new Promise(function(h,g){var f=document.createElement("video");f.crossOrigin="anonymous";f.src=d.path;h({video:f})}.bind(this))}return e},});return c});define("DS/WebConnector2D/Loader",["UWA/Core","UWA/Class","DS/WebViewer2D/ViewerError"],function(c,b,a){return b.extend({init:function(d){this._parent(d);this._type="none";this.aborted=false},load:function(d,e){this.aborted=false;this._load(e,d)},createViewers:function(d,e){console.warn("3DPlay/WebConnector2D/Loader - deprecated creation of 2D viewer please migrate to load function");this._load(e,d)},_createErrorViewer:function(d,e){d.push(new a({sheet:0,viewer:e.viewer,asset:e.asset}))},_load:function(e,d){this._createErrorViewer(d,e)},getLoaderType:function(){return this._type},abort:function(){this.aborted=true},isAborted:function(){return this.aborted}})});define("DS/WebConnector2D/LoaderVideo",["UWA/Core","UWA/Class","DS/WebConnector2D/Loader","DS/WebViewer2D/ViewerVideo","DS/WebSystem/Environment","DS/WebViewer2D/VideoControls","DS/WebSystem/Settings","DS/WebSystem/Nls","DS/WebUtils/ContextedSingleton"],function(e,c,b,f,h,j,a,i,d){var g=c.singleton(b,{init:function(k){this._parent(k);this._type="video"},_load:function(r,l){var q=this;var m,o;var k=r.ctx;var n=function(u){var v=r.frameWindow.getActionBar();r.frameWindow.onActionBarReady(function(){if(v){v.close()}});var w=q._createOuterSVG();var s=new f({doc:r.idxDoc,sheet:0,viewer:r.viewer,asset:w,video:m,typeOfDoc:"video"});l.push(s);var t=new j({container:r.viewer,services:s,ctx:r.ctx,frameWindow:r.frameWindow});r.loadCB.done(r.idxDoc);m.removeEventListener("canplaythrough",n);d.add(k,"3DP_Video_Controls",t);d.add(k,"3DP_Video_Viewer",s)};var p=function(t){if(h.isSet("3DPlay.MultiDoc")){document.body.removeChild(m);q._createErrorViewer(l,r);var s={video:true,evt:t,url:r.asset.filename||r.asset};r.loadCB.failed(r.idxDoc,s)}else{i.nls("3DPlay/Core","LoadingDocumentError",function(u){SHARE.Core.displayFatalError({ctx:k,msg:u+(r.asset.filename||r.asset),error:"LoadingDocumentError"})});r.progress.hide()}};m=new e.Element("video",{data:{doc:r.idxDoc,sheet:0},styles:{height:"100%",width:"100%"},autoplay:true}).inject(r.viewer);m.addEventListener("canplaythrough",n);o=new e.Element("source",{data:{doc:r.idxDoc,sheet:0},src:r.asset.filename||r.asset,type:"video/"+r.format}).inject(m);o.addEventListener("error",p)},_createOuterSVG:function(){var k=new e.Element("div",{id:"outerSVGDiv"});k.innerHTML='<svg xmlns = http://www.w3.org/2000/svg xmlns:xlink = http://www.w3.org/1999/xlink class="outerSVG" version = 1.1 style= "position: absolute; top:0; left: 0;" viewBox="0 0 0 0"></svg>';return k}});return g});define("DS/WebConnector2D/LoaderImg",["UWA/Core","UWA/Class","DS/WebConnector2D/Loader","DS/WebViewer2D/ViewerSvg","DS/WebViewer2D/ViewerImage","DS/WebSystem/Environment","DS/WebSystem/Nls","DS/WebUtils/StringUtils"],function(c,b,a,e,h,g,i,d){var f=b.singleton(a,{init:function(j){this._parent(j);this._type="image";this._isGeneratingThumb=false;this._thumbToUpdate=[]},_createOuterSVG:function(s){var q=[];var r=new c.Element("div",{id:"outerSVGDiv"});var v;var k;var m;var w;var o=s.width*1.2;var j=s.height*1.2;var u=(o-s.width)/2;var t=(j-s.height)/2;var p=s.width;var l=s.height;k='<svg xmlns = http://www.w3.org/2000/svg xmlns:xlink = http://www.w3.org/1999/xlink class="outerSVG" version = 1.1 style= "position: absolute" height="'+j+'" width="'+o+'" viewBox="0 0 '+o+" "+j+'">';var n=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;if(n===true){m='<defs><pattern id="backgroundimage2d" patternUnits="userSpaceOnUse" width="100%" height="100%"><image id="patternSVGImage" xlink:href="'+s.src+'" x="'+u+'" y="'+t+'" width="'+p+'" height="'+l+'"/></defs>';w='<g id="mainImage"><rect x ="'+u+'" y="'+t+'" width="'+p+'" height="'+l+'" fill="url(#backgroundimage2d)"></rect></g>';v=k+m+w+"</svg>"}else{w='<image x="'+u+'" y="'+t+'" width="'+p+'" height="'+l+'" xlink:href="'+s.src+'"/>';v=k+w+"</svg>"}r.innerHTML=v;q.push({outerSVG:r,imageSRC:s.src});return q},_load:function(l,k){var j=this;this._isGeneratingThumb=false;this._thumbToUpdate=[];i.nls("3DPlay/Core","DefaultSheetName",function(m){if(l.asset.provider==="STREAM"){var q=l.asset.data;var o=0;l.loadCB.setNbSheet(q.length);for(var r=0;r<q.length;++r){q[r].getData(function(t){var s;if(this.getTitle){s=this.getTitle()}j._loadImage({url:t,idxSheet:r,type:"image/png",viewer:viewer,title:s,doneCB:l.loadCB.done});o++;if(o===q.length){j=null}}.bind(q[r]))}}else{l.loadCB.setNbSheet(1);var n=d.getExtension(l.asset.filename)||l.asset.type;var p="image/png";p=(n==="jpg"||n==="bmp"||n==="jpeg")?("image/"+n):p;j._loadImage({url:l.asset.filename,idxSheet:0,type:n,doneCB:l.loadCB.done},k)}})},_loadImage:function(n,k){var l=function(o){k[n.idxSheet]={content:o.target,realSizeHeight:o.target.height,realSizeWidth:o.target.width,format:n.type,status:{loaded:true,failed:false}};n.doneCB(0)};var m=function(o){this._displayError(o,n)}.bind(this);var j=new c.Element("img",{events:{error:m,load:l}});j.crossOrigin="use-credentials";j.setAttribute("src",n.url)},_displayError:function(k,l){var j=l.ctx;i.nls("3DPlay/Core","LoadingDocumentError",function(m){SHARE.Core.displayFatalError({ctx:j,msg:m+l.asset,error:"LoadingDocumentError"})});l.progress.hide()},generateThumb:function(m,k){if(!this._viewer){this._viewer=new h({viewer:document.createElement("div"),asset:null,defaultTitle:"this.title",typeOfDoc:this._type})}if(this._isGeneratingThumb){this._thumbToUpdate.unshift({content:m,onDone:k})}else{this._isGeneratingThumb=true;var j=this;var l=function(n,o){j._viewer.loadAsset({asset:n,doneCB:function(){if(!n.isEmpty){o(j._viewer.canvas.toDataURL("image/png"))}else{o("../3DPlayDocumentViewer/assets/images/sheet_failed.png")}if(j._thumbToUpdate.length>0){var p=j._thumbToUpdate.shift();l(p.content,p.onDone)}else{j._isGeneratingThumb=false;j._viewer=null}}})};l(m,k)}}});return f});define("DS/WebConnector2D/LoaderSvg",["UWA/Core","UWA/Class","DS/WebConnector2D/Loader","DS/WebViewer2D/ViewerSvg","DS/WebSystem/Environment","DS/WAFData/WAFData","DS/WebSystem/Nls","DS/WebSystem/DetectBrowser","WebappsUtils/WebappsUtils"],function(d,b,a,g,i,e,j,f,c){var h=b.singleton(a,{init:function(k){this._parent(k);this._type="svg";this._isGeneratingThumb=false;this._thumbToUpdate=[]},_load:function(m,l){this.inputs=m;this.viewerTab=l;this._isGeneratingThumb=false;this._thumbToUpdate=[];var k=this.inputs.asset.filename||this.inputs.asset;if(this.inputs.asset.provider===undefined||this.inputs.asset.provider==="FILE"){this._loadFile(k)}else{if(this.inputs.asset.provider==="EV6"){if(this.inputs.asset.dtype==="Drawing"){this._getSvgFromV6Drawing(k,this._loadFile.bind(this),this._displayError.bind(this))}else{this._getSvgFromCATDrawing(k,this._loadFile,this._displayError)}}else{if(this.inputs.asset.provider==="BUFFER"){if(this.inputs.asset.data){this._createViewersFromText(this.inputs.asset.data)}else{this._displayError({errorID:"NO_2D_GEOMETRY"})}}else{if(this.inputs.asset.provider==="STREAM"){this._createViewersFromStream(this.inputs.asset.data)}else{this._displayError()}}}}},_clean:function(){this.inputs=undefined;this.viewerTab=undefined},_displayError:function(k){var l=this;if(k&&k.errorID){if(k.errorID==="NO_2D_GEOMETRY"){j.nls("3DPlay/Core","LoadingError_"+k.errorID,function(m){SHARE.Core.displayNotification({ctx:l.inputs.ctx,msg:m,error:k.errorID})})}else{j.nls("3DPlay/Core",k.errorID,function(m){SHARE.Core.displayFatalError({ctx:l.inputs.ctx,msg:m,error:k.errorID})})}}else{j.nls("3DPlay/Core","LoadingDocumentError",function(m){SHARE.Core.displayFatalError({ctx:l.inputs.ctx,msg:m+l.inputs.asset.physicalid,error:"LoadingDocumentError"})})}this.inputs.progress.hide();this._clean()},_loadFile:function(l,k){var n=this;var m={type:"text",cache:3600,timeout:7200000,onComplete:function(o){n._createViewersFromText(o);n=undefined},onCancel:function(o){n._displayError(o);n=undefined},onFailure:function(o){n._displayError(o);n=undefined}};if(d.is(k,"object")){d.merge(m,k)}e.handleRequest(l,m)},_createViewersFromText:function(m){var k=new DOMParser();var l=k.parseFromString(m,"application/xml");this._createViewersFromXML(l)},_getSVGSheet:function(k,m){var r=k.outerHTML;if((m&&m.isIE===true)||r===undefined||r===null){var p=new XMLSerializer();r=p.serializeToString(k)}var l=null,n=null;if(k.width.baseVal.unitType>=0&&k.width.baseVal.unitType<11&&k.height.baseVal.unitType>=0&&k.height.baseVal.unitType<11){if(k.height.baseVal.unitType===2&&k.viewBox&&k.viewBox.baseVal.width>0&&k.viewBox.baseVal.height>0){l=k.viewBox.baseVal.width;n=k.viewBox.baseVal.height;r=r.replace(new RegExp("<svg ",""),'<svg height="'+n+'px" width="'+l+'px" ')}else{if(k.width.baseVal.valueInSpecifiedUnits&&k.height.baseVal.valueInSpecifiedUnits){l=k.width.baseVal.valueInSpecifiedUnits;n=k.height.baseVal.valueInSpecifiedUnits;r=r.replace(new RegExp('height="'+k.height.baseVal.valueAsString+'"',""),'height="'+n+'px"');r=r.replace(new RegExp('width="'+k.width.baseVal.valueAsString+'"',""),'width="'+l+'px"')}}}if(l===null||n===null){this._displayError({errorID:"LoadingError_BAD_SIZE"});return({asset:"",title:"",width:0,height:0})}var q;var o=k.getElementsByTagName("title");if(o&&o.item(0)){q=o.item(0).textContent}return({asset:r,title:q,width:l,height:n})},_getSVGSheets:function(n){var r=[],m,p;if(n.children&&n.children[0]&&n.children[0].children[0]){var l;if(n.children[0].children[0].tagName==="parsererror"||n.children[0].children[0].tagName==="svg"){l=n.children[0].children}else{l=n.children}for(p=0;p<l.length;++p){m=l[p];if(m.tagName==="svg"){r.push(this._getSVGSheet(m,{isIE:false}))}}}else{if(n.childNodes){for(p=0;p<n.childNodes.length;++p){var k=n.childNodes[p];var o=r.length;if(k.childNodes&&k.childNodes.length>0){for(var q=0;q<k.childNodes.length;++q){m=k.childNodes[q];if(("parsererror"!==m.localName)&&(m.tagName==="parsererror"||m.tagName==="svg")){r.push(this._getSVGSheet(m,{isIE:true}))}}if((o===r.length)&&("parsererror"!==k.localName)&&(k.tagName==="parsererror"||k.tagName==="svg")){r.push(this._getSVGSheet(k,{isIE:true}))}}}}}return r},_createViewersFromXML:function(m){var r=this._getSVGSheets(m);if(r){this.inputs.loadCB.setNbSheet(r.length);if(!this._viewer){this._viewer=new g({viewer:document.createElement("div"),asset:null,defaultTitle:"this.title",typeOfDoc:this._type})}var l=this;this._loadQueue=[];var p=function(s){l._viewer.loadAsset({asset:l.viewerTab[s].content,doneCB:function(v,u){l.viewerTab[s].thumbnail=u;l.viewerTab[s].thumbIsGenerated=true;l.viewerTab[s].content.image=v;l.viewerTab[s].content.pageIndex=s;l.viewerTab[s].status={loaded:true,failed:false};l.inputs.loadCB.done(s);if(l._loadQueue.length>0){var t=l._loadQueue.shift();p(t.idx)}else{l._isGeneratingImage=false;l._viewer=null}}})};for(var q=0;q<r.length;q++){var o=r[q].height;var k=r[q].width;r[q].aspectRatio=r[q].width/r[q].height;if(r[q].height<0.5*r[0].height){o=r[q].height=r[0].height;k=r[q].width=r[0].height*r[q].aspectRatio}this.viewerTab[q]={content:r[q],realSizeHeight:o,realSizeWidth:k,format:"svg",status:{loaded:false,failed:false}};if(this._isGeneratingImage){this._loadQueue.push({idx:q})}else{this._isGeneratingImage=true;p(q)}}r=undefined}else{var n={svg:true,url:this.inputs.asset};this.inputs.loadCB.failed(0,n)}},_cleanBufferAndParse:function(o){var l=/(<svg[\w\W]*svg>)/;var k=l.exec(o);if(k!==null&&k!==undefined){k=k[1]}var n=document.createElement("div");n.innerHTML=k;var m=n.children[0];return m},_createViewersFromStream:function(m){var k=this;this._loadQueue=[];this.inputs.loadCB.setNbSheet(m.length);for(var l=0;l<m.length;l++){k.viewerTab[l]={status:{failed:false,loaded:false},format:"svg"}}j.nls("3DPlayDocumentViewer/3DPlayDocumentViewer","LoadingErrorSheet",function(n){var o=function(q){if(!k._viewer){k._viewer=new g({viewer:document.createElement("div"),asset:null,defaultTitle:"this.title",typeOfDoc:k._type})}k._viewer.loadAsset({asset:k.viewerTab[q].content,status:k.viewerTab[q].status,doneCB:function(t,s){k.viewerTab[q].status.loaded=true;k.viewerTab[q].thumbnail=s;k.viewerTab[q].thumbIsGenerated=true;k.viewerTab[q].content.image=t;k.viewerTab[q].content.pageIndex=q;k.inputs.loadCB.done(q);if(k._loadQueue.length>0){var r=k._loadQueue.shift();o(r.idx)}else{k._isGeneratingImage=false;k._viewer=null}}})};var p=function(q){if(k._isGeneratingImage){k._loadQueue.push({idx:q})}else{k._isGeneratingImage=true;o(q)}};m.forEach(function(r,q){r.getData(function(v){var t=k._cleanBufferAndParse(v);if(t===null||t===undefined){var u=setInterval(function(){if(k.sheetInfo&&k.sheetInfo.height&&k.sheetInfo.width){var w='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="';w+=k.sheetInfo.width;w+='px" height="';w+=k.sheetInfo.height;w+='px" viewBox="0 0 ';w+=k.sheetInfo.width+" "+k.sheetInfo.height;w+='"><image xlink:href="data:image/png;base64,';w+="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";w+='" height="150" width="150" ';w+='x="'+Math.floor((k.sheetInfo.width/2)-75)+'"';w+=' y="'+Math.floor((k.sheetInfo.height/2)-85)+'"/>';w+="<text ";w+='x="'+Math.floor(k.sheetInfo.width/2)+'"';w+=' y="'+Math.floor((k.sheetInfo.height/2)+105)+'"';w+=' text-anchor="middle" textLength="350" lengthAdjust="spacingAndGlyphs" font-family="3ds" font-size="40" fill="#bfbfbf">';w+=n;w+="</text>";w+="</svg>";w=k._cleanBufferAndParse(w);w=k._getSVGSheet(w);k.viewerTab[q].content=w;k.viewerTab[q].status={loaded:true,failed:true};k.viewerTab[q].format="svg";clearInterval(u);k.viewerTab[q].status.sheetInfo={height:k.sheetInfo.height,width:k.sheetInfo.width};p(q)}},200)}else{var s=k._getSVGSheet(t);k.viewerTab[q].content=s;k.viewerTab[q].realSizeHeight=s.height;k.viewerTab[q].realSizeWidth=s.width;k.viewerTab[q].status={loaded:true,failed:false};k.viewerTab[q].format="svg";if(!k.sheetInfo||!k.sheetInfo.height||!k.sheetInfo.width){k.sheetInfo={height:s.height,width:s.width}}p(q)}})})})},_getSvgFromCATDrawing:function(k,p,o){var n=true;var q={query:"physicalid:"+k.physicalid,intent:"explore_3D",order_by:"asc",nresults:2,tenant_id:"OnPremise",authored:true};var l=k.serverurl+"/resources/enopad/lwc/fetch";if(n){var m={headers:{Accept:"application/json","Accept-Language":"en","Content-Type":"application/json",authored:false,nresults:1,order_by:"asc",tenant_id:"OnPremise"},onComplete:p,onCancel:o,onFailure:o};m.data=JSON.stringify(q);m.method="POST";m.proxy="passport";e.handleRequest(l,m)}},_getSvgFromV6Drawing:function(k,o,n){k.dtype="Drawing";var r={method:"POST",authentication:"passport",proxy:"none"};var p={label:"3DPlay_"+Date.now(),physicalid:[k.physicalid],select_file:["svg"]};var l=k.serverurl+"/cvservlet/fetch/v2?SecurityContext=preferred";var m={headers:{"Content-Type":"application/json"},onComplete:function(s){o(s,r)},onCancel:n,onFailure:n};if(k&&k.requestsOptions&&k.requestsOptions.authentication){m.authentication=k.requestsOptions.authentication}else{m.proxy=k.requiredAuth}m.data=JSON.stringify(p);m.method="POST";try{e.handleRequest(l,m)}catch(q){console.error("ERROR: WAFData.handleRequest failed. "+q);n()}},generateThumb:function(n,l){if(f().browser.name==="ie"){if(!iAssetContent.isEmpty){l("data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n.asset))))}else{onDone("../3DPlayDocumentViewer/assets/images/sheet_failed.png")}}else{if(!this._viewerThumb){this._viewerThumb=new g({viewer:document.createElement("div"),asset:null,defaultTitle:"this.title",typeOfDoc:this._type})}if(this._isGeneratingThumb){this._thumbToUpdate.unshift({content:n,onDone:l})}else{this._isGeneratingThumb=true;var k=this;var m=function(o,p){k._viewerThumb.loadAsset({asset:o,doneCB:function(){if(!o.isEmpty){p(k._viewer.canvas.toDataURL("image/png"))}else{p("../3DPlayDocumentViewer/assets/images/sheet_failed.png")}if(k._thumbToUpdate.length>0){var q=k._thumbToUpdate.shift();m(q.content,q.onDone)}else{k._isGeneratingThumb=false;k._viewerThumb=null}}})};m(n,l)}}}});return h});define("DS/WebConnector2D/LoaderHtml",["UWA/Class","DS/WebConnector2D/Loader","DS/WebViewer2D/ViewerHtml","DS/WebSystem/Nls","DS/WebSystem/Environment"],function(b,f,c,e,d){var a=b.singleton(f,{init:function(g){this._parent(g)},_load:function(i,g){var h=this;if(i&&i.asset&&(i.asset.provider==="BUFFER"||i.asset.data!==undefined)){e.nls("3DPlay/Core","DefaultSheetName",function(j){g.push(new c({doc:i.idxDoc,sheet:0,viewer:i.viewer,asset:i.asset,frameWindow:i.frameWindow,actionbarHeight:i.actionbarHeight,defaultTitle:j+"1",typeOfDoc:"text"}));i.loadCB.done(i.idxDoc)})}else{h._displayError("NOT IMPLEMENTED",i,g)}},_displayError:function(j,l,h){var k=this;var g=l.ctx;if(d.isSet("3DPlay.MultiDoc")){k._createErrorViewer(h,l);var i={image:true,evt:j,url:l.asset.filename};l.loadCB.failed(l.idxDoc,i)}else{e.nls("3DPlay/Core","LoadingDocumentError",function(m){SHARE.Core.displayFatalError({ctx:g,msg:m+l.asset.filename,error:"LoadingDocumentError"})});l.progress.hide()}},});return a});define("DS/WebConnector2D/LoaderPDF",["UWA/Class","DS/WebConnector2D/Loader","DS/WebViewer2D/ViewerPDF","DS/PDFjs/PDFjs","DS/WebSystem/Nls","DS/WAFData/WAFData","DS/WebUtils/Profiler"],function(c,h,e,f,g,b,d){var a=c.singleton(h,{init:function(i){this._parent(i);this._type="pdf";this._isGeneratingThumb=false;this._thumbToUpdate=[]},_load:function(n,m){var l=this;this._thumbToUpdate=[];this._isGeneratingThumb=false;this.loadingAssetSize=0;var j=n.asset.filename||n.asset;if(n&&n.asset&&(n.asset.provider==="FILE"||n.asset.data!==undefined)){var i=d.start("PDF_DL");var k=n.asset.requestsOptions||{};k.type="arraybuffer";k.timeout=10*60*1000;k.onComplete=function(o){if(!l.isAborted()){o=new Uint8Array(o);f.disableWorker=true;f.getDocument(o).then(function(q){var r=q.numPages;l.stats={nbPages:r,DownloadSize:l.loadingAssetSize,DownloadTime:i.stop()};n.loadCB.setNbSheet(r);for(var p=1;p<=r&&!l.isAborted();++p){if(m){m[p-1]={content:{pageIndex:p-1,isEmpty:true},format:"pdf"};q.getPage(p).then(function(t){if(!l.isAborted()){t.cleanupAfterRender=true;var s=t.getViewport(1);m[t.pageIndex]={content:t,status:{loaded:true,failed:false},realSizeHeight:s.height,realSizeWidth:s.width,format:"pdf"};n.loadCB.done(t.pageIndex)}})}}})["catch"](function(p){l._displayError(p,n);console.log(p)})}};k.onProgress=function(o){l.loadingAssetSize=o.total};k.onFailure=k.onTimeout=function(){l._displayError(n,iViewerTab)};b.handleRequest(j,k)}else{this._displayError("NOT IMPLEMENTED",n,m)}},generateThumb:function(l,j){if(this.isAborted()){return}if(!this._viewer){this._viewer=new e({viewer:document.createElement("div"),asset:null,defaultTitle:"this.title",typeOfDoc:this._type})}if(this._isGeneratingThumb){this._thumbToUpdate.unshift({content:l,onDone:j})}else{this._isGeneratingThumb=true;var i=this;var k=function(m,n){i._viewer.loadAsset({asset:m,doneCB:function(){if(!m.isEmpty){m.cleanup();n(i._viewer.canvas.toDataURL("image/png"),i._thumbToUpdate.length%5===0)}else{n("../3DPlayDocumentViewer/assets/images/sheet_failed.png",i._thumbToUpdate.length%5===0)}if(i._thumbToUpdate.length>0){var o=i._thumbToUpdate.shift();k(o.content,o.onDone)}else{i._isGeneratingThumb=false;i._viewer=null;i=null}}})};k(l,j)}},_displayError:function(k,l,j){var i=l?l:k;g.nls("3DPlay/Core","DocumentLoadingFailed",function(m){SHARE.Core.displayFatalError({ctx:i.ctx,msg:m,error:"DocumentLoadingFailed"},k)});if(i.progress&&i.progress.hide){i.progress.hide()}}});return a});