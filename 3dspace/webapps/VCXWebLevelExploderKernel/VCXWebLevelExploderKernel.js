define("DS/VCXWebLevelExploderKernel/VCXLevelExploderKernelServices",["UWA/Class","DS/Visualization/ThreeJS_DS"],function(a,c){var b=a.singleton({PRODUCT_TYPES:{INSTANCE:0,REFERENCE:1,INSTANCE_REP:2,REFERENCE_REP:3},init:function(){},_getStagesInfo:function(g){var i=[];var k=this;var d=function d(o,n){var p=0;for(var m=0;m<o.children.length;++m){var q=o.children[m];if(k.doesNodeHasProductTypeValue(q,k.PRODUCT_TYPES.INSTANCE_REP,true)){var l=n;if(k.doesNodeHasProductTypeValue(q,k.PRODUCT_TYPES.INSTANCE)){if(!(i[n])){i[n]=[]}i[n][p]=0;++l;++p}d(q,l)}}};d(g,0,0);var f=[];for(var h=0,e=0;h<i.length;++e){if(i[h].length===1){i.splice(h,1);f.push(e)}else{++h}}var j={nbOfStages:Math.min(i.length,6),discardedStagesIdxs:f};return j},updateMapWithTranslationsVectors:function(f,i){var l=2;for(var k in f){if(f.hasOwnProperty(k)){var e=f[k].initCenterPosInWCS;var j=f[k].pathElement.getParentPath();var h=j.getBoundingSphere(i).center;var g=new c.Vector3().subVectors(e,h);var d=g.multiplyScalar(l);f[k].maxTranslationVect=d.clone()}}return f},getLeafGeometriesPathsUnderPath:function(g){var f=this;var d=[];var e=function e(k){var h=f.getDirectDescendantInstancePaths(k);if(h.length===0){if(f.doesNodeHasProductTypeValue(k.getLastElement(),f.PRODUCT_TYPES.INSTANCE)){d.push(k)}}else{for(var j=0;j<h.length;++j){var i=h[j];e(i)}}};e(g);return d},getDirectDescendantInstancePaths:function(k){var g=[];var e=k.getLastElement();if(this.doesNodeHasProductTypeValue(e,this.PRODUCT_TYPES.INSTANCE_REP)){return g}var h=e.children;if(h.length===0){return g}var j=k.clone();var l=e.children[0];if(this.doesNodeHasProductTypeValue(l,this.PRODUCT_TYPES.REFERENCE)){h=e.children[0].children;j.addElement(l)}for(var f=0;f<h.length;++f){var d=h[f];if(this.doesNodeHasProductTypeValue(d,this.PRODUCT_TYPES.INSTANCE)){var i=j.clone();i.addElement(d);g.push(i)}}return g},doesNodeHasProductTypeValue:function(h,f,e){var g;var d=h.productType||h.worktype;if(typeof d==="undefined"&&h.getType){h.productType=h.getType();d=h.productType}var i=d&&d.toLowerCase();if(typeof f!=="number"){g=d}else{if(i){switch(f){case this.PRODUCT_TYPES.INSTANCE:g=i.indexOf("instance")>-1&&i.indexOf("rep")===-1;break;case this.PRODUCT_TYPES.REFERENCE:g=i.indexOf("reference")>-1&&i.indexOf("rep")===-1;break;case this.PRODUCT_TYPES.INSTANCE_REP:g=i.indexOf("instance")>-1&&i.indexOf("rep")>-1;break;default:console.warn("case 'iProductType === "+f+"' not supported");return false}}else{g=false}}if(e){return !g}else{return Boolean(g)}}});return b});