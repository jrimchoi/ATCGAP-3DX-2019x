/*!  COPYRIGHT DASSAULT SYSTEMES 2014   */
define("DS/SNSearchUX/InContextSearch",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Class/Collection","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredefinedQueries","require"],function(k,l,c,h,d,i,e,j,f,a,g){var b=l.extend(c,h,{_socket:null,_registered_search_ctx:null,_isWidgetMaximized:false,_pubsub_loaded:false,init:function(m){this.setDebugMode(e.getDebugMode());this._socket=j.createSocket({socket_id:"incontextsearch_socket_id"});this.setOptions(m);var n=this;g(["DS/PubSub/PubSub"],function(o){n._pubsub_loaded=true;if(UWA.is(o)){o.add("onViewChange",function(u){var s=u.widgetId||u.id;var v,t,r,p=false,q={resetNLS:true,focus:false};if(k.is(k.Widgets)&&k.is(k.Widgets.instances)){UWA.Widgets.instances.filter(function(w){return UWA.is(w.id)&&w.id.indexOf("preview")!==-1&&!w.events.onDestroy}).forEach(function(w){w.addEvent("onDestroy",function(){if(n.computeSearchBar){n.computeSearchBar()}})});t=k.Widgets.instances.filter(function(x){return x.id===s});t=t.length>0?t[0]:null}r=k.is(n.getOption("addinMode"),"string")||(k.is(t)?(t.getValue("stayOnSearch")||false):false);if(k.is(t)&&true===t.getValue("noSearchModeChange")){p=true}if(UWA.is(n._registered_search_ctx)&&k.is(n.getInContextOptions(s))){v=n.getInContextOptions(s);if(v.id===s){if(u.type==="maximized"||u.type==="fullscreen"){n._isWidgetMaximized=true;if(UWA.is(v.search_delegation)&&v.search_delegation=="3ddashboard"&&!r){n._socket.dispatchEvent("onSetFindInTab",v)}else{if(!r){n._socket.dispatchEvent("onSetInAppContext",true);n._socket.dispatchEvent("onSetFindInApp",v)}}}else{if(u.type==="windowed"||u.type==="minimized"){n._isWidgetMaximized=false;n._socket.dispatchEvent("onSetInAppContext",false);if(e.getOption("find_in_this_tab_default")===true&&!r){n._socket.dispatchEvent("onSetFindInTab",null)}else{n._socket.dispatchEvent("clickOnChoiceSearch",q)}}}}}else{if(k.is(t)){if(t&&t.getValue("appId")==="X3DSEAR_AP"){n._socket.dispatchEvent("3DSearchWidgetmaximized",u.type)}if(t&&(t.getValue("appId")==="X3DSEAR_AP"&&(u.type==="maximized"||u.type==="fullscreen"))||(t.title==="3DSearch"&&-1<t.id.indexOf("preview"))){return}}if((u.type==="maximized"||u.type==="fullscreen")&&!r){n._isWidgetMaximized=true;if(false===p){n._socket.dispatchEvent("onSetFindInTab",t?(t.getValue("searchNLS")||null):null)}}else{if(u.type==="windowed"||u.type==="minimized"){n._isWidgetMaximized=false;n._socket.dispatchEvent("onSetInAppContext",false);if(e.getOption("find_in_this_tab_default")===true&&!r){if(false===p){n._socket.dispatchEvent("onSetFindInTab",null)}}else{if(false===p){n._socket.dispatchEvent("clickOnChoiceSearch",q)}}}}}})}},function(o){console.warn("InContextSearch.js: Unknown AMD module DS/PubSub/PubSub - TODO: async treatment!")});if(UWA.is(m.addinMode,"string")){require(["DS/PlatformAPI/PlatformAPI"],function(o){n.log("InContextSearch: addinMode found, start subscribing to webinwin:win:notification");o.subscribe("webinwin:win:notification",n._onWinNotif.bind(n))})}this._socket.addListener("RegisterContext",this._registerContext.bind(this));this._socket.addListener("TemporaryBypassFedsearch",this._temporaryBypassFedsearch.bind(this));this._socket.addListener("InContextSearch",this._inContextSearch.bind(this));this._socket.addListener("UnregisterContext",this._unregisterContext.bind(this))},_onWinNotif:function(m){if(UWA.is(m,"object")&&UWA.is(m.event,"string")&&UWA.is(m.content,"object")){switch(m.event){case"RegisterContext":this.log("webinwin:win:notification for RegisterContext notif received, options="+JSON.stringify(m));this._registerContext(m.content);break;case"InContextSearch":this.log("webinwin:win:notification for InContextSearch notif received, options="+JSON.stringify(m));this._inContextSearch(m.content);break}}else{this.log("webinwin:win:notification does not contain info in expected format")}},getInContextOptions:function(m){var n=this._registered_search_ctx.get({id:m}),o;if(UWA.is(n)){o=n.toJSON()}return o},_registerContext:function(n){this.log("Register Search Context");var m=this;if(!UWA.is(this._registered_search_ctx)){this._registered_search_ctx=new d()}var p={id:n.widget_id};this._cleanSourceValue(n);this._cleanOrderFields(n);var o=m.getInContextOptions(n.widget_id);if(k.is(o)){this.log("A Context in already registered for Widget Id "+n.widget_id+". Update it");this._registered_search_ctx.remove({id:n.widget_id});n.id=n.widget_id;this._registered_search_ctx.add(n)}else{this.log("Register the context for Widget Id "+n.widget_id);n.id=n.widget_id;this._registered_search_ctx.add(n)}if(this._amIAMaximizedWidget(n.widget_id)){m._isWidgetMaximized=true;if(k.is(o)){if(UWA.is(n.search_delegation)&&n.search_delegation=="3ddashboard"){if(!UWA.is(o.search_delegation)||o.search_delegation!="3ddashboard"){m._socket.dispatchEvent("onSetInAppContext",false);m._socket.dispatchEvent("onSwitchToFindInTab",m.getInContextOptions(n.widget_id))}}else{if(UWA.is(o.search_delegation)&&o.search_delegation=="3ddashboard"){m._socket.dispatchEvent("onSwitchToFindInApp",m.getInContextOptions(n.widget_id))}}}else{if(UWA.is(n.search_delegation)&&n.search_delegation=="3ddashboard"&&!UWA.is(m.getOption("addinMode"),"string")){m._socket.dispatchEvent("onSetFindInTab",m.getInContextOptions(n.widget_id))}else{m._socket.dispatchEvent("onSetInAppContext",true);m._socket.dispatchEvent("onSetFindInApp",m.getInContextOptions(n.widget_id))}}}this._socket.dispatchEvent("RegisterContext_Response",n,n.app_socket_id)},_amIAMaximizedWidget:function(n){if(k.is(k.Widgets)&&k.is(k.Widgets.instances)){var m=k.Widgets.instances.filter(function(o){if(o.id===n&&o.getView().type==="maximized"){return true}else{return false}});return m.length?true:false}return false},_temporaryBypassFedsearch:function(n){if(!UWA.is(n.bypass_url)){return}if(UWA.is(this._registered_search_ctx)){var p={id:n.widget_id};var o=this._registered_search_ctx.where(p);if(k.is(o)&&o.length>0){for(var m=0;m<o.length;m++){if(UWA.is(o[m])&&UWA.is(o[m]._attributes)){o[m]._attributes.bypass_url=n.bypass_url}}}else{this.log("No context registered with Widget Id "+n.widget_id)}}else{this.log("No context registered")}},_inContextSearch:function(o){this.log("In Context search Activated");var n=this;var m={inCtx_widget_id:o.widget_id,};this._promise=new i(function(q,p){if(o.default_with_precond===true){if(k.is(o.default_search_criteria)&&o.default_search_criteria.length>0){if(o.default_search_criteria.indexOf(":")>0){require(["DS/SNResultUX/utils/WildcardMgr"],function(r){n._socket.dispatchEvent("fetchPQsFromServer");a.getPQFetchPromise().then(function(){var s=r.manageWildcardAddtion(o.default_search_criteria);s=f.replacePQsWithCVPrefixes(s);q(s)})})}else{q(o.default_search_criteria)}}else{q()}}else{q()}});n._promise.then(function(q){delete n._promise;n._promise=null;if(o.default_with_precond===true){if(k.is(o.default_search_criteria)&&o.default_search_criteria.length>0){m.value=q;m.displayValue=o.default_search_criteria;m.searchStringToDisplayInSearchField=o.default_search_criteria}else{}if(k.is(o.precond)){if(o.precond.trim().length>0){if(k.is(m.value)&&m.value.trim().length>0){m.value=m.value+" AND "+o.precond}else{m.value=o.precond}}}if(k.is(o.displayValue)){m.searchStringToDisplayInSearchField=o.displayValue}}else{m.focus=true}if(k.is(o.global_actions)){m.incontext_global_actions=o.global_actions}if(k.is(o.itemViewClickHandler)&&o.itemViewClickHandler.trim().length>0){m.itemViewClickHandler=o.itemViewClickHandler}n._cleanSourceValue(o);m.source=o.source;if(k.is(o.tenant)){m.tenant=o.tenant}if(k.is(o.advanced_search)){m.advanced_search=o.advanced_search;m.advanced_search.default_search_criteria=m.value}if(k.is(o.recent_search)){m.recent_search=o.recent_search}var s={id:o.widget_id};var r=n._registered_search_ctx.where(s);if(k.is(r)&&r.length>0){if(r.length===1){n.log("A Context in already registered for Widget Id "+o.widget_id+". Update it");var p=r[0].toJSON();if(UWA.is(o.context_title,"string")){n._registered_search_ctx.remove({id:o.widget_id});p.context_title=o.context_title;n._registered_search_ctx.add(p)}else{if(UWA.is(p.context_title,"string")){n._registered_search_ctx.remove({id:o.widget_id});delete p.context_title;n._registered_search_ctx.add(p)}}}else{throw new Error("2 search context have been registered for the same Widget Id "+o.widget_id)}}if(UWA.is(n.getOption("addinMode"))){m.forceWidgetUXRecreation=true}m.tag_filter=o.tag_filter;m.refine=o.tag_filter;f.autocompleteRendered().then(function(){n._socket.dispatchEvent("onInContextSearch",{inContextOptions:o,placeholder:false?o.title:undefined});n._socket.dispatchEvent("search",m)})})},_cleanOrderFields:function(m){if(k.is(m.order_field,"array")&&m.order_field.length>0&&k.is(m.order_by,"array")&&m.order_by.length>0){m.order_field=m.order_field[0];m.order_by=m.order_by[0]}else{m.order_field=undefined;m.order_by=undefined}},_cleanSourceValue:function(m){if(k.is(m.source)){if(k.is(m.source,"string")){m.source=[m.source]}}},_unregisterContext:function(o){this.log("Unregister search Context");var m=o;if(k.is(m,"string")){m={widget_id:o,widgetId:o}}if(UWA.is(this._registered_search_ctx)){var p={id:m.widget_id};var n=this._registered_search_ctx.where(p);if(k.is(n)&&n.length>0){this._registered_search_ctx.remove({id:m.widget_id});if(this._amIAMaximizedWidget(m.widget_id)){this._socket.dispatchEvent("onSetInAppContext",false);this._socket.dispatchEvent("onSetBackSearchOrFindInTab",{noFocus:true})}}else{this.log("No context registered with Widget Id "+m.widget_id)}}else{this.log("No context registered")}},_updateSearchField:function(m){var o,p=false,n=k.Widgets.instances.filter(function(q){return q.context===m&&q.getView().type==="maximized"});if(n.length===1){o=UWA.is(that._registered_search_ctx)?that.getInContextOptions(n[0].id):undefined;p=o?(k.is(o)&&o.id===widgetId):false;p=p&&!(UWA.is(o.search_delegation)&&o.search_delegation=="3ddashboard");if(p){that._socket.dispatchEvent("onSetInAppContext",true);that._socket.dispatchEvent("onSetFindInApp",o)}else{}}else{if(n.length===0){}else{}}}});return b});define("DS/SNSearchUX/SearchHistoric",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings"],function(b,e,a,c){var d=e.singleton(a,{history:{},init:function(){},getHistoric:function(){if(!b.is(localStorage.SNSearchBoxStore)){return[]}return JSON.parse(localStorage.SNSearchBoxStore)},setHistoricInLocalStorage:function(){var f=this.getHistoric();localStorage.SNSearchBoxStore=JSON.stringify(f)},storeValueInDataBase:function(i){if(!b.is(i,"string")){throw new Error("null value given to SearchView._storeValueInLocalStorage!")}if(i.trim().length<=0){return}var h=this.getHistoric();if(h.indexOf(i)===-1){if(h.length>=100){h.shift()}h.push(i)}else{var g=h.indexOf(i);var f=h[g];h.splice(g,1);h.push(f)}localStorage.SNSearchBoxStore=JSON.stringify(h)}});return d});
/*!
  Script: Autocomplete.js

    This file is part of UWA JS Runtime.

  About: License

    Copyright 2006-2012 Netvibes, a Dassault Systèmes company.
    All rights reserved.
*/
define("DS/SNSearchUX/Autocomplete_ToMigrate",["UWA/Core","UWA/Event","UWA/Data","UWA/Json","UWA/Controls/Abstract","DS/SNInfraUX/SearchUtils"],function(g,b,c,a,f,d){var e=f.extend({typeTimeout:null,dataCache:{},itemCache:{},serverSuggests:{},defaultOptions:{suggestUrl:null,suggestKey:"",placeholder:"",shouldExist:false,itemDataKey:"item",dataParser:null,typeDelay:500,minLength:1,maxHeight:"auto",suggestFormat:"{name}",className:"uwa-autocomplete nv-autocomplete"},init:function(h){this._parent(h);this.buildSkeleton();this.attachEvents()},buildSkeleton:function(){var i=this.elements,h=this.options.className;i.form=g.createElement("form",{"class":h,autocomplete:"off"});i.inputContainer=g.createElement("div",{"class":h+"-searchbox"}).inject(i.form);i.input=g.createElement("input",{"class":h+"-input",placeholder:this.options.placeholder,type:"text"}).inject(i.inputContainer);this.resetInput();i.suggestsContainer=g.createElement("div",{"class":h+"-suggests"}).inject(i.form);i.serverSuggests=g.createElement("ul",{id:"search-suggests-server"}).inject(i.suggestsContainer);i.suggests=g.createElement("ul",{id:"search-suggests-history"}).inject(i.suggestsContainer);i.container=i.form},attachEvents:function(){var h=this.elements;h.input.addEvent("keyup",this.onKeyUp.bind(this));h.input.addEvent("blur",this.onBlur.bind(this));h.input.addEvent("focus",this.onFocus.bind(this));h.form.addEvent("submit",function(j){var i=this.itemCache[h.input.value.toLowerCase()];b.stop(j);if(g.is(this.serverSuggests)&&~Object.keys(this.serverSuggests).indexOf(h.input.value)){this.dispatchEvent("onSelect",[h.input.value,this.serverSuggests[h.input.value]]);h.input.blur();this.dispatchEvent("onHideSuggests")}else{if(!this.options.shouldExist||i){if(this.options.suggestKey&&i){h.input.value=i[this.options.suggestKey]}this.dispatchEvent("onSelect",[h.input.value,i]);h.input.blur();this.dispatchEvent("onHideSuggests")}}return false}.bind(this))},dataParse:function(j){var l,h,i,k=this.options.dataParser;if(g.is(k,"function")){j=k(j)}else{if(a.isJson(j)){j=a.decode(j);i=true}else{j=a.xmlToJson(j);for(l in j){if(j.hasOwnProperty(l)){j=j[l];break}}}for(l in j){if(j.hasOwnProperty(l)){if(!h){h=l}if(Array.isArray(j[l])){j=j[l];i=true}}}if(!i&&h){j=[j[h]]}}return Array.isArray(j)?j:[]},getFormattedSuggest:function(h){return this.options.suggestFormat.replace(/\{(\w+)\}/g,function(k,l){var j=g.is(h,"string")?h:h[l];return j})},resetInput:function(){var h=this.elements;if(!h.input.placeholder){h.input.value=this.options.placeholder}else{h.input.value=""}this.resetCache()},getFocus:function(){this.elements.input.focus()},resetCache:function(){this.dataCache={};this.itemCache={}},onUpdateSuggests:function(i){var k,j,m,l=this.elements,h=this;this.dispatchEvent("onShowSuggests");if(i==null){l.suggests.empty();l.serverSuggests.empty()}if(g.is(i)&&g.is(i.serverSuggests,"array")&&i.serverSuggests.length>0){m=i.serverSuggests;l.serverSuggests.empty();h.serverSuggests={};m.forEach(function(n){k=h.createSuggestElement(true,n.command,n.icon,l.input.value,l.serverSuggests,n.label);h.serverSuggests[n.command]=h.querySuggest(n);k.addEvent("click",function(o){h.dispatchEvent("onSelect",[n.command,h.serverSuggests[n.command]])})})}else{if(g.is(i)&&g.is(i.history,"Array")||Array.isArray(i)){m=i.history||i;l.suggests.empty();l.serverSuggests.empty();m.forEach(function(n){j=h.getFormattedSuggest(n);k=h.createSuggestElement(false,j,"clock",l.input.value,l.suggests);if(h.options.suggestKey){h.itemCache[item[h.options.suggestKey].toLowerCase()]=n}k.addEvent("click",function(o){var p=o.currentTarget.getText();h.dispatchEvent("onSelect",[p,o])})})}}this.resizeSuggests()},createSuggestElement:function(i,o,m,h,n,j){if(!String.prototype.replaceLast){String.prototype.replaceLast=function(s,r){var q=this.lastIndexOf(s);if(q>=0){return this.substring(0,q)+r+this.substring(q+s.length)}return this.toString()}}var k,p,l;if(i){l=g.createElement("div",{"class":"search-suggest-div-element",title:o})}else{l=g.createElement("div",{"class":"search-history-div-element",title:o})}if(m){k=g.createElement("span",{"class":"fonticon fonticon-"+(m||"clock")}).inject(l)}if(i){p=g.createElement("a",{"class":"search-suggest-element"}).inject(l)}else{p=g.createElement("a",{"class":"search-history-element"}).inject(l)}p.setText(o);if(h&&j){j=g.String.escapeHTML(j||"");h=g.String.escapeHTML(h.split(" ").pop());if(j&&o!==j){p.innerHTML='<span style="color:#ccc; font-size:13px;">'+p.innerHTML.replaceLast(j,"</span>"+j)}p.innerHTML=p.innerHTML.replaceLast(j,j.replace(new RegExp(h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i"),"<strong>$&</strong>"))}l.inject(n);return l},querySuggest:function(i){var k,n,j,h,l,m;n=i.command;return{search_type:"#search",value:n,searchStringToDisplayInSearchField:i.label,internalSearchCriteria:null,adv_search:false}},onSelect:function(i,h){this.elements.input.value=i;this.dispatchEvent("onHideSuggests")},onHideSuggests:function(){var h=this.elements;h.container.removeClassName(this.options.className+"-suggestsDisplayed")},onShowSuggests:function(){var h=this.elements;h.container.addClassName(this.options.className+"-suggestsDisplayed")},onBlur:function(i){var h=this;if(this.preventBlur===true){this.preventBlur=false;return}setTimeout(function(){this.dispatchEvent("onHideSuggests");this._cancel_suggest_update=true}.bind(this),200)},});return e});define("DS/SNSearchUX/SearchUX_TopBar",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Collection","UWA/Promise","DS/WebappsUtils/WebappsUtils","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchUtils","DS/SNSearchUX/InContextSearch","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SWFiltering","DS/SNInfraUX/SearchControlCenterFetchService","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchLogin","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/Api/SearchApi","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/Logger"],function(r,o,y,h,z,c,e,b,w,f,u,l,d,a,v,s,t,g,p,q,j,n,i,x){var k=function(A){var B=/(http|https):\/\//;return B.test(A)};var m=o.singleton(y,h,{_resourcesMgt:null,_selectedSource:null,_url_settings:{},_socket:null,_active_3dsearch_widget:null,_wdg_ready:true,_ctx_search:null,_currentTabId:null,_topframe_search_delegation:false,_SWFilteringCheckDone:true,result_ux_customization:{},_PQEvaluationPromisePC:c.deferred(),_EasyType:null,_sidePanelClose:false,_topFrame:null,_firstInit:false,_sidePanelHide:false,init:function(A){var C=this;var D=window.location.search.substring(1);if(D){var E=D.split("&");for(var B=0;B<E.length;B++){var F=E[B].split("=");if(F.length==1){this._url_settings[F[0]]=true}else{if(F.length==2){(F[0].length>0)&&(this._url_settings[F[0]]=F[1])}}}l.urlSettings(this._url_settings)}this.setOptions(A);if(r.is(A)&&r.is(A.userId)){a.setUserId(A.userId);this.log("Connected User = "+a.getUserId())}else{this.log("SearchTopBar:init Input options do not contain the connected userId")}a.activateCompactOrComfortMode();a.ensureBetaStatus().then(function(){this.setDebugMode(l.getDebugMode());this._resourcesMgt=new f(r.is(A)?A.ressources:{});g.setResourceMgt(this._resourcesMgt);n.setResourceMgt(this._resourcesMgt);var G=this._resourcesMgt.getActiveTenant();l.getTenantSettings(G).then(function(){a.activateCompactOrComfortMode(G);if(A!==undefined){if(this.options.ressources!==undefined){this._buildUI()}}b.add("tab:change",function(I){var J;C._currentTabId=I;C.computeSearchBar(I)});if(r.is(C.options.searchParams)){if(r.is(C.options.searchParams.close,"function")&&r.is(C.options.searchParams.isOpen,"function")&&r.is(C.options.searchParams.open,"function")){C._topframe_search_delegation=true}if(C.options.searchParams.pqAccessEvalcallback){C.pqAccessEvalcallback=C.options.searchParams.pqAccessEvalcallback}if(C.options.searchParams.resultUX_customization){C._addResultUX_customization(C.options.searchParams.resultUX_customization)}if(r.is(C.options.searchParams.searchHelper,"function")){C.searchHelper=C.options.searchParams.searchHelper}if(r.is(C.options.searchParams.search_settings,"object")){l.initialize({search_settings:C.options.searchParams.search_settings})}a.autocompleteRendered().then(function(){if(r.is(C.options.searchParams.onSearchInit,"function")){C.options.searchParams.onSearchInit.call()}})}if(u.getItem("integratedSearch")===true){var H="DS/TopFrame/TopFrame";require([H],function(I){C._topFrame=I;if(r.is(A.events)&&r.is(A.events.initFrame,"function")){A.events.initFrame.call(undefined,C._topFrame)}if(r.is(C._topFrame)&&r.is(C._topFrame._frame)){C._topFrame._frame.addEvent("onPanelClose",function(J){if(r.is(J)&&r.is(J.tag)&&J.tag!=="taggerCtn"){C._sidePanelClose=true;C._socket.dispatchEvent("showSearchInThisTab");C._socket.dispatchEvent("clearSearch")}});C._topFrame._frame.addEvent("onPanelOpen",function(M){if(r.is(M)&&r.is(M.tag)&&M.tag==="search"){if(r.is(M.position)){var K=0;var J=C._isSearchWidgetAvailable();if(J.maxIndex===undefined&&J.indexSide!==undefined){K=J.indexSide}else{K=J.maxIndex}if(r.is(J.wdg_search_items)&&J.wdg_search_items.length>0){if(r.is(J.wdg_search_items[K])){var L=J.wdg_search_items[K].get("widget_id");if(r.is(L)){if(M.position==="fitted"||M.position==="maximized"){if(a.getsearchType()===a.SearchTypeEnum.ADVANCED_SEARCH){C._socket.dispatchEvent("showAdvancedSearch",{adv_search_field:null,widgetId:L})}C._socket.dispatchEvent("manageActionIconOnSidePanel",{widgetId:L,activation:false,position:M.position})}else{C._socket.dispatchEvent("manageActionIconOnSidePanel",{widgetId:L,activation:true,position:M.position})}}}}require(["DS/PlatformAPI/PlatformAPI"],function(N){N.publish("sideOnPanelOpen",M)})}}})}})}}.bind(C))}.bind(this))},setTagPinnedToQuery:function(E){var C=JSON.parse(localStorage.getItem("taggerPinned"))||{};var F=a.getUserId();C=C[F]||{};var A=a.identifyClientInfo().identifier==="3DDashboard";A=document.querySelector(".topbar-app-brand")&&document.querySelector(".topbar-app-brand").innerText.match(/enovia/i)?false:A;var B="";if(!A){B=window.location.hostname}var G=C[B]||{keep:[]};var D={};G.keep&&G.keep.forEach(function(J){var I=JSON.parse(J.predicate);var H=I.predicate;I.disptext=I.dispValue;delete I.predicate;delete I.dispValue;D[H]=[I]});if(!E.refine&&UWA.is(D,"object")&&Object.keys(D).length>0){E.refine={allfilters:D}}},computeSearchBar:function(B){var C,D;var A={resetNLS:true,focus:false};B=B||this._currentTabId||a.getCurrentTabId();if(!r.is(this._ctx_search)||!r.is(this._ctx_search._socket)){return}var E=r.Widgets.instances.filter(function(F){return F.context===B&&F.getView().type==="maximized"});if(E.length===1){C=E[0];if(r.is(this._ctx_search._registered_search_ctx)){D=this._ctx_search.getInContextOptions(C.id);if(r.is(D)&&!C.getValue("stayOnSearch")){if(UWA.is(D.search_delegation)&&D.search_delegation=="3ddashboard"){this._ctx_search._socket.dispatchEvent("onSetFindInTab",D)}else{this._ctx_search._socket.dispatchEvent("onSetInAppContext",true);this._ctx_search._socket.dispatchEvent("onSetFindInApp",D)}}else{if(!C.getValue("stayOnSearch")){this._ctx_search._socket.dispatchEvent("onSetInAppContext",false);this._ctx_search._socket.dispatchEvent("onSetFindInTab",C.getValue("searchNLS")||null)}else{this._socket.dispatchEvent("clickOnChoiceSearch",A)}}}else{if(!C.getValue("stayOnSearch")&&(r.is(C.getTitle,"function")&&C.getTitle()!=="Unified Search")){this._ctx_search._socket.dispatchEvent("onSetInAppContext",false);this._ctx_search._socket.dispatchEvent("onSetFindInTab",C.getValue("searchNLS")||null)}else{this._socket.dispatchEvent("clickOnChoiceSearch",A)}}}else{var A={resetNLS:true,focus:false};this._ctx_search._socket.dispatchEvent("onSetInAppContext",false);if(l.getOption("find_in_this_tab_default")===true){this._socket.dispatchEvent("onSetFindInTab",null)}else{if(r.is(B)){this._socket.dispatchEvent("clickOnChoiceSearch",A)}else{this._socket.dispatchEvent("onSetBackSearchOrFindInTab",A)}}}},buildPQAccessMap:function(){var A=this;p.fetchPQsFromServer(A._resourcesMgt).then(function(){var D=p.getPQs();if(A.searchHelper){var C={};C.PQ={PQ:D.PQ,requested_info:["access"]};C.onComplete=function(F){var E=F.PQ.PQ;A.pqAccessMap={};E.forEach(function(G){A.pqAccessMap[G.pqid]=G.viewData.access});A._PQEvaluationPromisePC.resolve()};A.searchHelper.call(undefined,C)}else{if(A.pqAccessEvalcallback){var B={PQ:D.PQ,onComplete:function(E){A.pqAccessMap=E;A._PQEvaluationPromisePC.resolve()}};A.pqAccessEvalcallback.call(undefined,B)}else{A.pqAccessMap=null;A._PQEvaluationPromisePC.resolve()}}})},_buildUI:function(){if(l.getOption("universal_search")===true){var C=this,B;this.log("User "+this.options.userId+" belong to the white list");j.getPlatformServices({onComplete:function(P){if(r.is(P,"array")){var I=[];var H=0,M=P.length;for(H=0;H<M;H++){var O=P[H];var L={};L.id=O.platformId;L.name=O.displayName;L.services=[];var K=Object.getOwnPropertyNames(O);if(r.is(K,"array")){var N={};for(var G=0,J=K.length;G<J;G++){if(O[K[G]].indexOf("http")===0){L.services.push({id:K[G],url:O[K[G]]})}}}I.push(L)}a.setPlatforms(I)}},onFailure:function(){console.log("oFailure")}});var E=function(){x.log("Enter loginToSources");var I="";var G=C._resourcesMgt.getAvailableTenants();if(r.is(G,"array")&&G.length===1){I=G[0].tenantId;x.log("Single Tenant: "+I)}else{if(r.is(G,"array")&&G.length>1){var J=C._resourcesMgt.getActiveTenant();x.log("Multiple tenants avaialable, active tenant: "+J);if(J==="3DDashboard"){var H=u.getItem("defaultTenantId");x.log("Tenant from preferences: "+H);if(C._resourcesMgt.getTenantInfo(H)){I=H;x.log("Tenant found in preferences is available")}else{x.log("Tenant found in preferences is NOT available");I=G[0].tenantId}}else{I=J}}}x.log("Tenant for Login is: "+I);q.login({resources:C._resourcesMgt,tenantID:I,onComplete:function(){},onFailure:function(){}});if(true===l.getOption("force_loading_WebUX_js")){require(["WebUX/WebUX"],function(K){C.log("WebUX is LOADED")})}};var D=l.getOption("fed_search_init_timeout");if(r.is(D,"number")){if(D===0){E.call()}else{if(D>0){setTimeout(function(){E.call()},D*1000)}}}this._intializeSocket();this._ctx_search=new v({addinMode:this.getAddinMode()});this._ctx_search.computeSearchBar=this.computeSearchBar.bind(this);this._ctx_search._socket.addListener("addResultUX_customization",function(G){C._addResultUX_customization(G)});var F=function(H){C._EasyType=H.adv_search_field;C._updateTenantFromIncontextOptions(H);var K={selected_source:C._resourcesMgt.toJSON(),openTagger:C.options.events.openTagger,setTaggerMode:C.options.events.setTaggerMode,closeTagger:C.options.events.closeTagger};B=C.getResultUX_customization();if(r.is(B)){K.result_ux_customization=B}if(C._isWidgetReadyToLaunch()===true){var G=p.isAPrefixedPQSearch(H.value);if(r.is(C.searchHelper)&&r.is(G)&&!r.is(H.inCtx_widget_id)){var I=p.getPQObjFromPQPrefix(G);var J={};J.PQ={PQ:[I],requested_info:["datagridview_columns","global_actions"]};J.onComplete=function(M){var L=M.PQ.PQ[0];if(L.viewData&&L.viewData.datagridview_columns){H.viewData={SearchColumnCustoDefinition:{viewId:"###"+I.pqName,viewDefinition:[]}};I.viewData.datagridview_columns.forEach(function(N){H.viewData.SearchColumnCustoDefinition.viewDefinition.push({uri:N})})}if(L.viewData&&L.viewData.global_actions){if(!H.viewData){H.viewData={}}H.viewData.global_actions=L.viewData.global_actions}C._launchWdg(K,H)};C.searchHelper.call(undefined,J)}else{C._launchWdg(K,H)}}};var A=function(G,I){var H={};if(r.is(G,"object")){H=G}if(r.is(C.options)&&r.is(C.options.searchParams)){if(r.is(C.options.searchParams.source,"array")){H.source=C.options.searchParams.source}else{if(UWA.is(C.options.searchParams.getSources,"function")){var J=C.options.searchParams.getSources();if(UWA.is(J,"array")){H.source=J}}}}H.searchType=I;F(H)};this._socket.addListener("search",function(G){A(G,a.SearchTypeEnum.SEARCH);var H=true;w.publish({channel:"TopBar_Suggest",topic:"CancelSuggest",data:H});a.setsearchType(a.SearchTypeEnum.SEARCH)});this._socket.addListener("myContent",function(G){A(G,a.SearchTypeEnum.MY_CONTENT);a.setsearchType(a.SearchTypeEnum.MY_CONTENT)});this._socket.addListener("myRecentContent",function(G){A(G,a.SearchTypeEnum.MY_RECENT_CONTENT);a.setsearchType(a.SearchTypeEnum.MY_RECENT_CONTENT)});this._socket.addListener("advancedSearch",function(G){A(G,a.SearchTypeEnum.ADVANCED_SEARCH);a.setsearchType(a.SearchTypeEnum.ADVANCED_SEARCH)});this._socket.addListener("favoriteSearches",function(G){A(G,a.SearchTypeEnum.FAVORITE_SEARCH);a.setsearchType(a.SearchTypeEnum.FAVORITE_SEARCH)});this._socket.addListener("focusOnSearch",F);this._socket.addListener("hideAdvancedSearch",function(){C._socket.dispatchEvent("hideAdvancedSearch",{})});this._socket.addListener("showAdvancedSearch",function(H){if(!r.is(H)){return}var G=C._isSearchWidgetAvailable();if(r.is(G)&&G.wdg_available===true){var I=(G.maxIndex===undefined&&G.indexSide!==undefined)?G.indexSide:G.maxIndex;var J=G.wdg_search_items[I].get("widget_id");if(r.is(J)){H.widgetId=J}}C._socket.dispatchEvent("showAdvancedSearch",H)});this._socket.addListener("openTagger",function(){if(r.is(C.options.events.openTagger,"function")){C.options.events.openTagger()}});this._socket.addListener("openTagger",C.options.events.openTagger);this._socket.addListener("setTaggerMode",function(J){if(r.is(C.options.events.setTaggerMode,"function")){C.options.events.setTaggerMode(J)}if(C._firstInit===true&&r.is(J)&&J==="criteria"){var G=C._isSearchWidgetAvailable();if(r.is(G)&&G.wdg_available===true){var H=0;if(G.maxIndex===undefined&&G.indexSide!==undefined){H=G.indexSide}else{H=G.maxIndex}var I=G.wdg_search_items[H].get("widget_id");if(r.is(I)){C._socket.dispatchEvent("showAdvancedSearch",{adv_search_field:null,widgetId:I})}}C._firstInit=false}});this._socket.addListener("closeTagger",function(){if(r.is(C.options.events.closeTagger,"function")){C.options.events.closeTagger()}});this._socket.addListener("closeTagger",C.options.events.closeTagger);this._socket.addListener("clearSearch",function(){if(C._resourcesMgt.getActiveTenant()==="3DDashboard"&&r.is(C.options.events.clearSearch,"function")){C.options.events.clearSearch.call(undefined,null)}});this._socket.addListener("closeTransient",function(G){if(r.is(C.options.events.closeTagger,"function")){C.options.events.closeTagger.call(undefined,null)}if(C._topframe_search_delegation){C.options.searchParams.close.call(undefined,G)}else{if(l.getOption("transient_widget")){require(["DS/TransientWidget/TransientWidget"],function(H){H.closeWidget()})}}});this._socket.addListener("onDragStart",function(){if(C._topframe_search_delegation){C.options.searchParams.close.call()}else{if(!(r.is(C.options)&&r.is(C.options.addinMode)&&r.is(C.options.addinMode.value,"string")&&(C.options.addinMode.value==="solidworks"||C.options.addinMode.value==="catiav5"))){setTimeout(function(){require(["DS/TransientWidget/TransientWidget"],function(G){if(true===a.isTaggerOpenedByCode()){C._socket.dispatchEvent("closeTagger")}G.closeWidget()})},250)}}if(true===u.getItem("integratedSearch")){if(C._topFrame._frame.isPanelMaximized("right")||C._topFrame._frame.isPanelFitted("right")){C._topFrame.minimizeSidePanel();C._topFrame._onRightPanelStateChange("minimized");C._socket.dispatchEvent("showSearchInThisTab")}}});this._socket.addListener("onShowPQListUX",function(){C.buildPQAccessMap();C._PQEvaluationPromisePC.promise.then(function(){require(["DS/SNResultUX/SearchPQListUX"],function(G){G.showPQSelector({pqAccessMap:C.pqAccessMap,pqSelectionCallback:function(H){C._socket.dispatchEvent("onPQPrefixSelect",H)}})})})});this._socket.addListener("getsearchTopbarResouceJson",function(G){C._socket.dispatchEvent("searchTopbarResouceJson",{resources:C._resourcesMgt.toJSON(),tenants:C._resourcesMgt.getAvailableTenants(),active_tenant:C._resourcesMgt.getActiveTenant()},r.is(G)?G.socket_id:null)});this._socket.addListener("fetchPQsFromServer",function(G){p.fetchPQsFromServer(C._resourcesMgt)});this._socket.addListener("hideSidePanel",function(){if(r.is(C._topFrame)&&r.is(C._topFrame._frame)){C._topFrame._frame.closePanel("right","search")}C._topFrame._onRightPanelStateChange("closed");C._sidePanelHide=true});this._socket.addListener("3DSearchWidgetmaximized",function(H){if(u.getItem("integratedSearch")===true&&C._topFrame){if(C._topFrame._visibleXApp==="search"){var G=C._topFrame._frame.isPanelOpen("right");if((H==="windowed"&&C._sidePanelHide===false)){C._topFrame._updateColumn("right","search");C._sidePanelHide=true}else{if(H==="maximized"&&G===true){C._sidePanelHide=false;C._topFrame._frame.closePanel("right","search");C._topFrame._onRightPanelStateChange("closed")}else{if(G===null&&(H==="windowed"&&C._sidePanelHide===true)&&C._sidePanelClose!==true){C._topFrame._updateColumn("right","search")}}}}}})}},_intializeSocket:function(){this.log("_intializeSocket");var A=this;this._active_3dsearch_widget=new z();this._socket=d.createSocket({socket_id:"searchtopbar_socket_id"});a.getSearchViewPromise().then(function(){A.log("SearchView promise resolved");A._socket.dispatchEvent("onSetSources",{sources:A._resourcesMgt.toJSON(),searchParams:A.options.searchParams});if(UWA.is(A.getAddinMode(),"string")){require(["DS/PlatformAPI/PlatformAPI"],function(B){A.log("publishing search_ready event");B.publish("webinwin:web:notification",JSON.stringify({event:"search_ready",source:a.SEARCH_APP_ID,version:"1.0",content:{status:true}}))})}a.setSearchReady()});this._socket.addListener("setSelectedSource",function(B){A.log("The selected source have been modified ["+B.value+"]");try{A._resourcesMgt.setActiveTenant(B.value)}catch(C){console.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+B.value+")")}});this._socket.addListener("onSearch",function(D){A.log("Launch command from the result wdg ["+D+"]");if(r.is(D.parameters,"object")&&r.is(D.parameters.search_criteria)){if(UWA.is(D.tabInfo,"object")){if(UWA.is(D.tabInfo.tenant,"string")&&true===D.transient_widget){try{A._resourcesMgt.setActiveTenant(D.tabInfo.tenant)}catch(G){console.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+D.tabInfo.tenant+")")}A._socket.dispatchEvent("onSelectTenantAfterTabActivation",{tenant:D.tabInfo.tenant})}}var B={focus:false,setTenant:false};var F=UWA.is(D.tabInfo,"object")&&(true===D.transient_widget||D.tabInfo.client_identifier!=="3DDashboard");if(D.parameters.search_criteria===a.SearchTypeEnum.MY_CONTENT){if(F){A._socket.dispatchEvent("clickOnChoiceMyContent",B)}}else{if(D.parameters.search_criteria===a.SearchTypeEnum.FAVORITE_SEARCH){if(F){A._socket.dispatchEvent("clickOnChoiceFavoriteSearch",B)}}else{if(D.parameters.search_criteria===a.SearchTypeEnum.MY_RECENT_CONTENT){}else{if(true===D.parameters.adv_search||D.parameters.search_criteria===a.SearchTypeEnum.ADVANCED_SEARCH){if(F){A._socket.dispatchEvent("clickOnChoiceAdvancedSearch",B)}}else{var H=D.parameters.search_criteria;if(r.is(D.parameters.originalSearchCriteria,"string")){H=D.parameters.originalSearchCriteria}if(r.is(D.parameters.search_criteria_to_display,"string")){H=D.parameters.search_criteria_to_display}var E=H;var I=D.parameters.search_criteria;var C=A._isWidgetMaximized(D.widget_id,A._currentTabId);if(!D.transient_widget&&!(C&&D.in_apps_search)){E=null;I=null}A._socket.dispatchEvent("onRefreshSearchField",{searchStringToDisplayInSearchField:E,internalSearchCriteria:I});if(F){A._socket.dispatchEvent("clickOnChoiceSearch",B)}}}}}}});this._socket.addListener("onSearchModeSwitch",function(B){if(r.is(B,"object")&&r.is(B.new_mode,"string")){A._socket.dispatchEvent("onSwitchMode",B);if(B.new_mode===a.SearchTypeEnum.MY_RECENT_CONTENT&&B.paramsFilter==="*"){A._socket.dispatchEvent("onRefreshSearchField","")}}});this._socket.addListener("onSearchFromCompass",function(C){A.init3DSearchWidgetCreatedFromCompass(C);var B=l.getOption("search_compact_mode");if(((r.is(window)&&r.is(window.innerWidth))?window.innerWidth>958:true)&&(r.is(A.getAddinMode(),"string")?["solidworks","catiav5"].indexOf(A.getAddinMode())===-1:true)&&B===false&&l.options.search_settings.taggerClosed!=true){var D="DS/TopFrame/TopFrame";require([D],function(E){var F=false;if(r.is(E)){try{if(UWA.is(E.isTaggerVisible,"function")&&true===E.isTaggerVisible()){F=true}}catch(G){if(r.is(E._isTaggerVisible)&&true===E._isTaggerVisible){F=true}console.log(G)}}if(false===F){if(r.is(A.options.events.openTagger,"function")){A.options.events.openTagger();a.setTaggerOpenedByCode(true)}}else{a.setTaggerOpenedByCode(false)}})}if(C.mode!=="windowed"){A._socket.dispatchEvent("onSetFocusInSearchField",{});setTimeout(function(){if(r.is(C)&&r.is(C.x3dPlatformId,"string")&&C.x3dPlatformId.length>0){A._socket.dispatchEvent("onSelectTenant",C.x3dPlatformId)}},200)}});this._socket.addListener("onWdgCreation",function(D){if(r.is(D.widget_id)){var F=false;if(r.is(D.tabid)){A._currentTabId=D.tabid;F=true}var B=A._currentTabId;if(B===null){B=a.getCurrentTabId()}var C=A._isWidgetMaximized(D.widget_id,B);var E={widgetId:D.widget_id,maximized:C};A._socket.dispatchEvent("toggleProxyFocus",E);if(F===true){if(F===true&&r.is(A._topFrame)){if(A._topFrame.toggleTagger){A._topFrame.toggleTagger(true)}}}A.log("onWdgCreation");A.log("Widget id ["+D.widget_id+"]");A.log("Active Tab id ["+B+"]");A.log("isMaximized ["+C+"]");A._active_3dsearch_widget.add({widget_id:D.widget_id,active_tab:B,isMaximized:C});if(D.transient_widget==="true"){A._socket.dispatchEvent("hideSearchInThisTab")}}A._wdg_ready=true});this._socket.addListener("onViewChange",function(D){A.log("onViewChange ["+D.widget_id+"]");var G={active_tab:A._currentTabId,widget_id:D.widget_id,};var F=A._active_3dsearch_widget.where(G);if(r.is(F)&&F.length===1){A.log("Widget ["+F[0].get("widget_id")+"] in store with maximized option "+F[0].get("isMaximized"));var C=F[0].get("widget_id");var B=A._isWidgetMaximized(C,F[0].get("active_tab"));F[0].set("isMaximized",B);A.log("Maximized option is now set to "+F[0].get("isMaximized"));var E={widgetId:C,maximized:B};A._socket.dispatchEvent("toggleProxyFocus",E)}else{A.log("No widget with that id found in the store")}});this._socket.addListener("onDestroyWidget",function(B){var C=A._active_3dsearch_widget.where({widget_id:B.widget_id});A._active_3dsearch_widget.remove(C);d.unsubscribeServer(B.widget_id)});this._socket.addListener("onCloseTransient",function(){A._socket.dispatchEvent("showSearchInThisTab")});this._socket.addListener("onSetFocusInSearchField",function(){A._socket.dispatchEvent("onSetFocusInSearchField",{});setTimeout(function(){var B=require("DS/TopBar/TopBar");if(UWA.is(B)&&UWA.is(B.view)&&UWA.is(B.view.focusOnSearch,"function")){B.view.focusOnSearch()}},100)});this._socket.addListener("onSearchItemClick",this._manageExternalIdCardDelegation.bind(this))},_manageExternalIdCardDelegation:function(B){var D=this;if(r.is(D.options.searchParams)){var A=true;if(B.in_apps_search){A=r.is(B.in_apps_search.idcard_activated)?B.in_apps_search.idcard_activated:true}if(A){var C=false;if(B.in_apps_search){C=r.is(B.in_apps_search.external_idcard)?B.in_apps_search.external_idcard:false}else{if(r.is(D.options.searchParams.external_idcard,"function")){C=D.options.searchParams.external_idcard.call()}else{if(r.is(D.options.searchParams.external_idcard)){C=D.options.searchParams.external_idcard}}}if(C===true){if(r.is(D.options.searchParams.idcard,"function")){D.options.searchParams.idcard.call(undefined,B.model)}}}}},_addResultUX_customization:function(B){var A=this;Object.keys(B).forEach(function(C){A.result_ux_customization[C]=B[C]})},getResultUX_customization:function(A){if(A){return this.result_ux_customization[A]}if(Object.keys(this.result_ux_customization).length>0){return this.result_ux_customization}},_isSearchWidgetAvailable:function(B){var C=this;var I={wdg_available:false,maxIndex:undefined,indexSide:undefined,active_tab:null,wdg_search_items:null};I.active_tab=a.getCurrentTabId();if(I.active_tab===null){I.active_tab=C._currentTabId}var G={active_tab:I.active_tab};I.wdg_search_items=C._active_3dsearch_widget.where(G);C.log("Check if a widget is available for update");I.wdg_available=false;if(r.is(I.wdg_search_items)&&I.wdg_search_items.length>0){var E=true;if(UWA.is(B,"object")&&true===B.forceWidgetUXRecreation){E=false}if(E){var H=I.wdg_search_items.length;if(H){C.log("A search widget is already instanciated ==> Check if it is still in the active tab");var D=0;for(D=0;D<H;D++){var A=I.wdg_search_items[D].get("widget_id");if(r.Widgets){var F=r.Widgets.instances.filter(function(K){if(((K.id===A&&K.context===I.active_tab)||K.getValue("search_wdg_id")===A)){var J="maximized";if(UWA.is(B,"object")&&UWA.is(B.viewType,"string")&&B.viewType.length>0){J=B.viewType}if(K.getView().type===J){C.log("Widget available reuse it");I.wdg_available=true;I.maxIndex=D}if(K.getView().type==="sidepanel"){C.log("Widget available reuse it Side");I.wdg_available=true;I.indexSide=D}}})}}}}}else{C.log("No widget registered in the active tab")}return I},init3DSearchWidgetCreatedFromCompass:function(C){var B=this._isSearchWidgetAvailable({viewType:C.mode});var A={};A.active_tab=B.active_tab;if(B.wdg_available===true){var D=0;if(B.maxIndex===undefined&&B.indexSide!==undefined){D=B.indexSide;if(UWA.is(C.mode)&&C.mode==="windowed"){var F=this._isSearchWidgetAvailable({viewType:"maximized"});if(UWA.is(F)&&UWA.is(F.maxIndex)&&F.maxIndex!==undefined){D=F.maxIndex}}}else{D=B.maxIndex}A.ressources=new f(this.options.ressources);try{A.ressources.setActiveTenant(C.x3dPlatformId)}catch(E){console.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+C.x3dPlatformId+")")}this._socket.dispatchEvent("onSearchFromCompassInit",A,"widget_socket_"+B.wdg_search_items[D].get("widget_id"))}},_launchWdg:function(L,J){this.log("_launchWdg");var N=this;var B=u.getItem("integratedSearch");this.setTagPinnedToQuery(J);l.options.search_settings.adv_search_field=null;if((r.is(J.adv_search_field,"string")&&J.adv_search_field.length>0)){l.options.search_settings.adv_search_field=J.adv_search_field}var F=this._isSearchWidgetAvailable({forceWidgetUXRecreation:J.forceWidgetUXRecreation});J.active_tab=F.active_tab;var O;if(J){if(r.is(J.inCtx_widget_id,"string")){O=N._ctx_search.getInContextOptions(J.inCtx_widget_id);if(r.is(O)){J.customization_options=O;B=false;if(r.is(O.modifysavedsearch)&&O.modifysavedsearch===true){B=true}}}}var Z=function(){if(J&&((r.is(J.value,"string")&&J.value.length>0)||J.focus)){var aa=l.getOption("search_compact_mode");if(((r.is(window)&&r.is(window.innerWidth))?window.innerWidth>958:true)&&(r.is(N.getAddinMode(),"string")?["solidworks","catiav5"].indexOf(N.getAddinMode())===-1:true)&&aa===false&&l.options.search_settings.taggerClosed!=true){if(l.getOption("no_TopFrame_ODT")!==true){var ab="DS/TopFrame/TopFrame";require([ab],function(ac){var ad=false;if(r.is(ac)){try{if(UWA.is(ac.isTaggerVisible,"function")&&true===ac.isTaggerVisible()){ad=true}}catch(ae){if(r.is(ac._isTaggerVisible)&&true===ac._isTaggerVisible){ad=true}console.log(ae)}}if(false===ad){L.openTagger();a.setTaggerOpenedByCode(true)}else{a.setTaggerOpenedByCode(false)}})}}}};if(u.getItem("integratedSearch")&&B===false&&F.wdg_available===true){F.wdg_available=false}if(F.wdg_available===true){var M="SearchComServer";var U;var P=0;if(F.maxIndex===undefined&&F.indexSide!==undefined){P=F.indexSide}else{P=F.maxIndex}if(B===true&&F.indexSide!==undefined&&F.maxIndex!==undefined){if(N._topFrame&&N._topFrame._frame){if(N._topFrame._frame.isPanelOpen("right")===true&&(N._topFrame._frame.isPanelMaximized("right")||N._topFrame._frame.isPanelFitted("right"))){P=F.indexSide;F.maxIndex===undefined}}}U="widget_socket_"+F.wdg_search_items[P].get("widget_id");var H="SearchComServer_"+F.wdg_search_items[P].get("widget_id");if(r.is(N._socket.servers,"array")&&N._socket.servers[H]){M=H}var S=true;if(r.is(N._topFrame)&&(F.maxIndex===undefined)&&B===true){if(r.is(J)&&r.is(J.fromEmptyString)&&J.fromEmptyString===true){S=false;if(N._sidePanelClose===false){S=true}}if(N._sidePanelClose===true&&r.is(J)){J.addNewTab=true}if(N._sidePanelClose===true||J.searchType==="#advancedSearch"||N._topFrame._visibleXApp){var D={fit:true,appId:a.SEARCH_APP_ID};N._topFrame.openPanel("right",D).then(function(){Z.call();N._topFrame._onRightPanelStateChange("fitted")});N._topFrame._visibleXApp="search";N._sidePanelClose=false}else{N._topFrame._frame.showPanelContent("right","search")}}J.active_tenant=N._resourcesMgt.getActiveTenant();if(S===true){N._socket.dispatchEvent("onSearchWdgUpd",J,U,M)}if(J.searchType==="#advancedSearch"){var X={widgetId:F.wdg_search_items[P].get("widget_id"),maximized:true};N._socket.dispatchEvent("toggleProxyFocus",X)}}else{var G=false;if(N._topframe_search_delegation){G=N.options.searchParams.isOpen.call()}else{}if(G===true){N.log("A search widget is already instantiated ==> Update its content");N._socket.dispatchEvent("onSearchWdgUpd",J);N._wdg_ready=true}else{var Y=false;if(l.options.search_settings.transient_widget){Y=true}var C="";var E={search_ressources:L.selected_source,transient_context:"true",reSearch:J.refine,settings_topbar:l.serialize(),search_criteria_to_display:J.searchStringToDisplayInSearchField,recent_filter:J.searchStringToDisplayInSearchField};if(J&&r.is(J.value,"string")&&J.value.length>0){E.search_criteria=J.value;E.adv_search=J.adv_search;E.adv_search_field=J.adv_search_field}else{E.focus=true}var K=true;if(J){if(r.is(J.searchStringToDisplayInSearchField)){E.search_criteria_to_display=J.searchStringToDisplayInSearchField}if(r.is(O)){E.customization_options=O;if(E.customization_options&&J.advanced_search&&J.advanced_search.showByDefault){if(!E.customization_options.advanced_search){E.customization_options.advanced_search=J.advanced_search}E.adv_search=true;if(J.advanced_search.searchOnInit==true){K=true}E.customization_options.advanced_search.default_search_criteria=J.advanced_search.default_search_criteria;E.search_criteria="#advancedSearch";K=false}if(r.is(J.displayValue)){E.search_criteria_to_display=J.displayValue}else{E.search_criteria_to_display=""}if(r.is(O.bypass_url)){if(l.options.search_settings.temp_bypass_fedsearch==="5746ca20-811a-11e4-b116-123b93f75cba"||l.options.search_settings.temp_bypass_fedsearch==="5746cf02-811a-11e4-b116-123b93f75cba"){var A=E.search_ressources.available_tenants[E.search_ressources.active_tenant];if(r.is(A)&&r.is(A.sources)&&r.is(A.sources.search)){A.sources.search.url=O.bypass_url;N.log("Temporary bypass of fed_search url by app with UIID "+l.options.search_settings.temp_bypass_fedsearch+": "+A.sources.search.url)}}}if(J.recent_search){E.customization_options.recent_search=J.recent_search}}if(r.is(J.content,"string")){E.content=J.content}E.viewData=J.viewData;if(!r.is(E.viewData)){E.viewData={}}if(!r.is(E.viewData.global_actions)){var W=N.getResultUX_customization("global_actions");if(r.is(W)&&r.is(W.actions)&&r.is(W.app_socket_id)){E.viewData.global_actions=W}if(r.is(O)){if(r.is(J.incontext_global_actions)){E.viewData.global_actions={actions:J.incontext_global_actions,app_socket_id:O.app_socket_id}}else{if(O.global_actions){E.viewData.global_actions={actions:O.global_actions,app_socket_id:O.app_socket_id}}}}}E.incontext_global_actions=E.viewData.global_actions;if(r.is(J.itemViewClickHandler)){E.itemViewClickHandler=J.itemViewClickHandler}else{if(r.is(O)&&r.is(O.itemViewClickHandler)&&O.itemViewClickHandler.trim().length>0){E.itemViewClickHandler=O.itemViewClickHandler}}if(r.is(J.source)){E.source=J.source}else{if(r.is(O)&&r.is(O.source)){if(r.is(O.source,"array")){E.source=O.source}else{if(r.is(O.source,"string")){E.source=[O.source]}}}}if(r.is(J.search_mode)){E.search_mode=J.search_mode}else{E.search_mode="index"}}E.tag_filter=J.tag_filter;if(r.is(L.result_ux_customization)){E.result_ux_customization=L.result_ux_customization}var V=a.SEARCH_APP_ID;if(l.getOption("noAppId")===true&&Q){var R="",Q=true;if(r.is(l.options.search_settings.widget_server_url,"string")){R=decodeURIComponent(l.options.search_settings.widget_server_url);Q=false}else{R=N._resourcesMgt.getFedSearchUrl()+"/webapps"}var T=/\/$/;R=R.replace(T,"");R=R+"/SNResultUX/SearchResult_Wdg.htm";V=R}N.log("Widget App Id: "+V);N._wdg_ready=false;if(l.getOption("pcs_analysis")===true){console.info("Launch widget at: "+Date.now())}var I=function(){q.login({resources:N._resourcesMgt,onComplete:function(){},onFailure:function(){console.log("login for helper search FAILED")}});require(["DS/SNResultUX/collections/SearchCollection","DS/SNResultUX/utils/WildcardMgr","DS/SNResultUX/utils/SNResultTypeCustoHelper"],function(ab,aa,ac){var ad=function(){if(J&&J.advanced_search&&J.advanced_search.showByDefault){if(J.advanced_search.searchOnInit){J.value=J.advanced_search.default_search_criteria}if(J.advanced_search["ds6w:type"]){var ag="";var ah=J.advanced_search["ds6w:type"];ah.forEach(function(aj){var ak=aj.uri.split(":");if(ag.length>0){ag=ag+" OR "}ag=ag+'flattenedtaxonomies:"types/'+ak[ak.length-1]+'"'});if(ag.length>0){if(r.is(J.value,"string")&&J.value.length>0){J.value=J.value+" AND  ("+ag+")"}else{J.value=ag}}}}if(J&&r.is(J.value,"string")&&J.value.length>0){var ae=J.value;if(ae!==a.SearchTypeEnum.ADVANCED_SEARCH&&K){var af=r.is(J.inCtx_widget_id);if(!af){ae=aa.manageWildcardAddtion(ae)}s.setResources({resources:N._resourcesMgt});var ai=new ab(null,{event:{onSetup:function(an){an._isAHelper=true;an.setSearchRessources(N._resourcesMgt);var am={query:ae,mode:E.search_mode,source:r.is(E.source)?E.source:[],refine:J.refine,originalSearchCriteria:J.searchStringToDisplayInSearchField};if(!UWA.is(am.source)||am.source.length<1){var aj=N.getOption("searchParams");if(UWA.is(aj)){if(UWA.is(aj.source,"array")){am.source=aj.source}else{if(UWA.is(aj.getSources,"function")){var ao=N.options.searchParams.getSources();if(UWA.is(ao,"array")){am.source=ao}}}}}if(!af){var ak=ac.getGlobalSearchTypeCustoQuery(ae);if(r.is(ak)){a.addSourceSpecificParameter(am,{sourceIds:["3dspace"],param:{id:"additional_query",value:ak}})}}if(r.is(E.customization_options)){an._ctx_options=E.customization_options}an.setRequestCriteria("fed_search",am,af);if(J.viewData&&J.viewData.SearchColumnCustoDefinition&&J.viewData.SearchColumnCustoDefinition.viewDefinition){var al=[];J.viewData.SearchColumnCustoDefinition.viewDefinition.forEach(function(ap){al.push(ap.uri)});an.setAttributesToRetrieve(al)}}}});a.setHelperCollection(a.TRANSIENT_WIDGET_HELPER_ID,ai);ai.getFirstPageOfResults({reset:true,onComplete:function(al,ak,aj){ai._currentState=a.HelperCollectionStatus.SEARCH_SUCCEEDED;N.log("helper search succeeded");if(r.is(ai._CBOnComplete,"function")){N.log("launching _CBOnComplete");ai._CBOnComplete.apply(ai,arguments)}},onFailure:function(al,ak,aj){ai._currentState=a.HelperCollectionStatus.SEARCH_FAILED;N.log("helper search failed");if(r.is(ai._CBOnFailure,"function")){N.log("launching _CBOnFailure");ai._CBOnFailure.apply(ai,arguments)}else{ai.fedSearch_error=ak}}});N.log("helper search launched");ai._currentState=a.HelperCollectionStatus.SEARCH_IN_PROGRESS}}};if(J&&r.is(J.value,"string")&&J.value.indexOf(":")>0){p.getPQFetchPromise().then(ad)}else{ad.call()}})};if(N._SWFilteringCheckDone===false){require(["DS/SWXWebPlatformSearchApi/SWXWebSearchFilterApi"],function(aa){aa.isSWFilteringON(function(ab){N._SWFilteringCheckDone=true;N.log("call of isSWFilteringON DONE");if(r.is(ab)){if(ab.swxRole){N.log("SWFiltering is ON");t.setAdditionalQueryCriteria(ab.contract.query);t.setSelectPredicates(ab.contract.select_predicate);t.setSelectExcludeSynthesis(ab.contract.select_exclude_synthesis)}else{N.log("SWFiltering is OFF")}}I.call()})},function(aa){N._SWFilteringCheckDone=true;console.warn("ERROR: failed to load DS/SWXWebPlatformSearchApi/SWXWebSearchFilterApi");if(UWA.is(aa)){console.warn("ERROR: "+aa.message)}I.call()})}else{I.call()}if(B===false){Z.call()}if(N._topframe_search_delegation){N.options.searchParams.open.call(undefined,{app_id:V,widget_title:C,preferences_wdg:E})}else{if(r.is(N._topFrame)&&B===true){var D={fit:true,appId:V,data:E};N._topFrame._visibleXApp="search";N._topFrame.openPanel("right",D).then(function(){Z.call();N._topFrame._onRightPanelStateChange("fitted")});N._firstInit=true}else{require(["DS/TransientWidget/TransientWidget","WebappsUtils/WebappsUtils"],function(ab,aa){E.x3dPlatformId=E.search_ressources.active_tenant;ab.showWidget(V,C,E)})}}}}},_isWidgetReadyToLaunch:function(){return this._wdg_ready},_updateTenantFromIncontextOptions:function(B){if(r.is(B)){if(r.is(B.tenant)){try{this._resourcesMgt.setActiveTenant(B.tenant)}catch(D){console.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+B.tenant+")")}}else{if(r.is(B.inCtx_widget_id,"string")){var C=this._ctx_search.getInContextOptions(B.inCtx_widget_id);if(r.is(C)&&r.is(C.tenant)){try{this._resourcesMgt.setActiveTenant(C.tenant)}catch(D){console.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+C.tenant+")")}}else{var A=this._resourcesMgt.getAvailableTenants();if(A.length==1){this._resourcesMgt.setActiveTenant(A[0].tenantId)}}}}}},getAddinMode:function(){var A=this.getOption("addinMode");if(UWA.is(A,"object")){return A.value}},_isWidgetMaximized:function(B,A){if(r.Widgets){var D=u.getItem("integratedSearch");var C=r.Widgets.instances.filter(function(E){if(D===false){if(r.is(E,"object")&&E.getView().type==="maximized"&&((E.id===B&&E.context===A)||E.getValue("search_wdg_id")===B)){return true}else{return false}}else{if(r.is(E,"object")&&(E.getView().type==="maximized"||E.getView().type==="sidepanel")&&((E.id===B&&E.context===A)||E.getValue("search_wdg_id")===B)){if(r.is(E.getValue("appId")===a.SEARCH_APP_ID)){E.context=A}return true}else{return false}}})}return(C&&C.length)?true:false},});return m});define("DS/SNSearchUX/SearchAutocomplete",["UWA/Core","UWA/Element","UWA/Event","UWA/Utils/Client","DS/SNSearchUX/Autocomplete_ToMigrate","DS/MessageBus/MessageBus","require","css!DS/SNSearchUX/SNSearchUX.css","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Tooltip","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchCom","UWA/Promise","DS/UIKIT/Input/Toggle","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json"],function(UWACore,Element,Event,UWAClient,Autocomplete,MessageBus,localRequire,cssSearchAutocomplete,SearchRessources,SearchPreferences,SearchSettings,SearchUtils,PlatformAPI,Tooltip,SNSearchTypeCusto,PredicatesNLS,SearchLogin,SearchCom,Promise,UIKITToggle,nlsKeys){var bMultiTenant=false,sActiveTenant="";var SearchAutocomplete=Autocomplete.extend({_clearSearch:null,_autocompleteSuggests:null,_timeoutId:null,_suggestTimeout:null,_secondTimeoutId:null,_inAppContext:false,_temporarilyOutOfContext:false,_inContextOptions:null,_previouslyActiveSource:null,_enable_search:true,_srchChoice:null,_srchChoiceA:null,_enable_similar_search:true,_SimilarSearchChoice:null,_SimilarSearchChoiceA:null,_SimilarSearchIsActive:false,_SimilarCurrentSelectedPhysicalId:null,_enable_advanced_search:true,_AdvSearchChoice:null,_AdvSearchChoiceA:null,_enable_search_in_this_tab:true,_sitChoice:null,_sitChoiceA:null,_findInTabNLS:null,_enable_my_content:true,_myContentChoice:null,_myContentChoiceA:null,_myRecentContentChoice:null,_myRecentContentChoiceA:null,_myRecentContentIsActive:false,_enable_tenant_selection:true,_cstoreChoice:[],_cstoreChoiceA:[],_cstoreSources:[],_src_ressource:null,_adv_Search_activated:false,_searchStringToDisplayInSearchField:null,_internalSearchCriteria:null,_isTypeListMode:false,_isTypeListDone:false,_isTypeValue:null,_typeList:[],_easyTypeListUI:[],_easyTypeSelect:false,_otherLastBlockListUI:[],_LastSearchResults:null,_pqSelect:false,_enable_Last_Searches:true,_enable_PredefinedQuery:true,_predefinedQuery:null,_enable_FavoriteSearches:true,_suggestionsInPipeline:0,_cancel_suggest_update:false,_AsyncSearchDropdownPromise:Promise.deferred(),_searchResourcesSet:Promise.deferred(),_suggestPreviousQueries:function(autocomplete,value){var storedSearches=null;var actualSuggestions=null;if(this._typeList.length===0){this._typeList=SNSearchTypeCusto.getSearchTypeCustoList()}this._isTypeListMode=false;this._value=value;if((this._typeList.length)&&(value.length===0)){storedSearches=this._typeList;this._isTypeListMode=true}if(UWACore.is(localStorage.SNSearchBoxStore)){storedSearches=JSON.parse(localStorage.SNSearchBoxStore);var filteredSuggestions=[];if(!value||value.replace(/\s+/g,"")===""){filteredSuggestions=storedSearches}else{storedSearches.forEach(function(entry){if(entry.indexOf(value)===0&&(entry!==value)){filteredSuggestions.push(entry)}})}actualSuggestions=filteredSuggestions.reverse();if(actualSuggestions.length>4){actualSuggestions=actualSuggestions.slice(0,4)}autocomplete.dispatchEvent("onUpdateSuggests",[actualSuggestions]);autocomplete.dispatchEvent("onShowSuggests");autocomplete.typeTimeout=null}else{autocomplete.dispatchEvent("onUpdateSuggests",[actualSuggestions]);autocomplete.dispatchEvent("onShowSuggests")}this.historySuggestions=actualSuggestions},getServerSuggestions:function(query){var that=this;var options={query:query.replace(/^\s+|\s+$/g,""),input:query.replace(/^\s+|\s+$/g,"").split(" ")};if(!query.length){that.dispatchEvent("onUpdateSuggests",{serverSuggests:[]})}else{if(true===SearchUtils.isSuggestAvailable(sActiveTenant)){var getnShowSuggests=function(){var suggest_length=SearchSettings.getOption("suggest_length");if(((options.query.length)>(suggest_length-1))&&(!(UWA.is(that._inContextOptions)))&&(that.elements.input.placeholder==that._getPlaceHolderTextDependingOnActiveTenant("search"))){that._suggestionsInPipeline++;that._src_ressource.getSuggestions(options,function(suggestions){that._suggestionsInPipeline--;suggestions=suggestions||[];var actualSuggestions=suggestions.map(function(sug){return{label:sug.entry,command:sug.entry,icon:"lightbulb"}});if(!that._cancel_suggest_update){if(actualSuggestions.length>0&&(that._suggestionsInPipeline==0)){that.dispatchEvent("onUpdateSuggests",{serverSuggests:actualSuggestions})}}})}};this.getSearchResources().then(function(){SearchLogin.login({resources:that._src_ressource,onComplete:function(){getnShowSuggests()},onFailure:function(){}})})}}},getSearchResources:function(){var that=this;return that._searchResourcesSet.promise},_buildSearchChoice:function(options){var allSources=options.sources;var that=this;MessageBus.subscribe({channel:"TopBar_Suggest",topic:"CancelSuggest",callback:function(Cancel_suggest_update){that._cancel_suggest_update=true}});var elements=this.elements;this.elements.container.addEvent("drop",function(ev){var list=null;var isIE=
/*@cc_on!@*/
false||!!document.documentMode;var isEdge=!isIE&&!!window.StyleMedia;var Ms=isIE||isEdge;if(!Ms&&ev.dataTransfer.getData("shortData")!==""){ev.preventDefault();list=JSON.parse(ev.dataTransfer.getData("shortData"))}else{if(ev.dataTransfer.getData("text")!==""){var dragData=JSON.parse(ev.dataTransfer.getData("text"));list=[];dragData.data.items.forEach(function(obj){list.push('"'+obj.displayName+'"')})}}ev.target.value=list.join(" OR ");ev.stopPropagation();ev.preventDefault()});this.elements.container.addEvent("paste",function(ev){if(that.elements.input.placeholder!==that._getPlaceHolderTextDependingOnActiveTenant("search")){return}var nonSelectedChars=0;if(UWACore.is(ev.target)&&UWACore.is(ev.target.selectionStart)&&UWACore.is(ev.target.selectionEnd)){nonSelectedChars=ev.target.value.length-(ev.target.selectionEnd-ev.target.selectionStart)}if(0===nonSelectedChars&&UWACore.is(ev)){var clipboardData=null,pastedTxt=null;if(UWACore.is(ev.clipboardData)&&UWACore.is(ev.clipboardData.getData,"function")){pastedTxt=ev.clipboardData.getData("text/plain");that.getServerSuggestions(pastedTxt)}else{if(UWACore.is(window.clipboardData)&&UWACore.is(window.clipboardData.getData,"function")){pastedTxt=window.clipboardData.getData("Text");that.getServerSuggestions(pastedTxt)}}var stringToEnterInSearchField="";if(UWACore.is(pastedTxt,"string")&&pastedTxt.length>0){var bContainsTab=pastedTxt.indexOf("\t")>=0?true:false,bContainsCR=pastedTxt.indexOf("\n")>=0?true:false,bContainsDoublePipe=pastedTxt.indexOf("||")>=0?true:false,bContainsDoubleAnd=pastedTxt.indexOf("&&")>=0?true:false,bContainsEscapedAnd=pastedTxt.indexOf("\\&&")>=0?true:false,bContainsEscapedPipe=pastedTxt.indexOf("\\||")>=0?true:false;if(false===bContainsTab&&false===bContainsCR&&false===bContainsDoublePipe&&false===bContainsDoubleAnd){that._showClearSearchBtn();return}var listLines=pastedTxt.split("\n"),lineToSplit="",firstLineAdded=false;if(UWACore.is(listLines,"array")&&listLines.length>0){for(var i=0,nb=listLines.length;i<nb;i++){if(UWACore.is(listLines[i],"string")){listLines[i]=listLines[i].trim();if(listLines[i].length>0){lineToSplit=listLines[i];var listVal=null,operatorStr="AND";bContainsTab=lineToSplit.indexOf("\t")>=0?true:false;bContainsDoublePipe=lineToSplit.indexOf("||")>=0?true:false;bContainsDoubleAnd=lineToSplit.indexOf("&&")>=0?true:false;bContainsEscapedAnd=lineToSplit.indexOf("\\&&")>=0?true:false;bContainsEscapedPipe=lineToSplit.indexOf("\\||")>=0?true:false;if(true===bContainsEscapedAnd){lineToSplit=lineToSplit.replace(/\\\&/g,"##__##")}if(true===bContainsEscapedPipe){lineToSplit=lineToSplit.replace(/\\\|/g,"__##__")}if(true===bContainsTab){listVal=lineToSplit.split("\t")}else{if(true===bContainsDoubleAnd){listVal=lineToSplit.split("&&")}else{if(true===bContainsDoublePipe){listVal=lineToSplit.split("||");operatorStr="OR"}else{listVal=[lineToSplit]}}}var lineString="";for(var iVal=0,nbVal=listVal.length;iVal<nbVal;iVal++){if(UWACore.is(listVal[iVal],"string")){listVal[iVal].trim();if(listVal[iVal].length>0){if(true===bContainsEscapedAnd){listVal[iVal]=listVal[iVal].replace(/##__##/g,"&")}if(true===bContainsEscapedPipe){listVal[iVal]=listVal[iVal].replace(/__##__/g,"|")}if(lineString.length>0){lineString+=" "+operatorStr+" "}if(listVal[iVal].length>1&&listVal[iVal][0]==='"'&&listVal[iVal][listVal[iVal].length-1]==='"'){listVal[iVal]=listVal[iVal].substr(1,listVal[iVal].length-2)}listVal[iVal]=listVal[iVal].replace(/\\([\s\S])|(")/g,"\\$1$2");lineString+='"'+listVal[iVal]+'"'}}}if(lineString.length>0){if(true===firstLineAdded){stringToEnterInSearchField+=" OR "}if(nb>1){stringToEnterInSearchField+="("}stringToEnterInSearchField+=lineString;if(nb>1){stringToEnterInSearchField+=")"}firstLineAdded=true}}}}ev.target.value=stringToEnterInSearchField;if(stringToEnterInSearchField.length>0){that._showClearSearchBtn()}ev.stopPropagation();ev.preventDefault()}}}});if(!UWACore.is(allSources)){allSources=this.options.allSources}if(!UWACore.is(allSources,"object")){throw new Error("Invalid value for allSources in SearchAutocomplete._buildSearchChoice!")}allSources.loadPredicates=true;this._src_ressource=new SearchRessources(allSources);this._searchResourcesSet.resolve();this._cstoreSources=this._src_ressource.getAvailableTenants();elements.predefinedSearches=UWA.createElement("ul",{"class":"predefined-searches",id:"search-combo-predefined-searches","data-rec-id":"search-combo-predefined-searches"}).inject(elements.suggestsContainer);if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_last_searches)){this._enable_Last_Searches=options.searchParams.enable_last_searches}if(this._enable_Last_Searches){var tooltipStr=nlsKeys.get("LastSearchResults.shortHelp");var attributesObj={};if(UWACore.is(tooltipStr,"string")&&tooltipStr.length>0){attributesObj.title=tooltipStr}this._LastSearchResults=UWA.createElement("div",{id:"search-combo-search-recent",attributes:attributesObj,"data-rec-id":"search-combo-search-recent"});var LastSearchResultsIcon=UWA.createElement("span",{"class":"fonticon fonticon-search-recent"}).inject(this._LastSearchResults);var lastSearchResultsA=UWA.createElement("a",{"class":"search-combo-item"}).inject(this._LastSearchResults);lastSearchResultsA.setHTML(nlsKeys.get("LastSearchResults"));this._LastSearchResults.inject(elements.predefinedSearches);this._LastSearchResults.addEvent("click",function(){that._setFieldValue("");that._hideClearSearchBtn();that._deactivateOtherLastBlockList();that.dispatchEvent("onSelect",["","LastSearch"]);var noFocus={focus:false};that._clickOnChoiceSearch(noFocus)});this.hideLastSearch()}if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_favorite_searches)){this._enable_FavoriteSearches=options.searchParams.enable_favorite_searches;SearchSettings.options.search_settings.global_action_save_search=(options.searchParams.enable_favorite_searches===true)?true:false}if(this._enable_FavoriteSearches===true){if(UWACore.is(SearchSettings.getOption("search_compact_mode"))&&SearchSettings.getOption("search_compact_mode")===true){this._enable_FavoriteSearches=false}}if(this._enable_FavoriteSearches){var tooltipStr=nlsKeys.get("MySavedSearches.shortHelp");var attributesObj={};if(UWACore.is(tooltipStr,"string")&&tooltipStr.length>0){attributesObj.title=tooltipStr}this._FavoriteSearches=UWA.createElement("div",{id:"search-combo-favorite-searches",attributes:attributesObj,"data-rec-id":"search-combo-favorite-searches"}).hide();var FavoriteSearchesIcone=UWA.createElement("span",{"class":"fonticon fonticon-favorite-on"}).inject(this._FavoriteSearches);this._FavoriteSearchesA=UWA.createElement("a",{"class":"search-combo-item"}).inject(this._FavoriteSearches);this._FavoriteSearchesA.setHTML(nlsKeys.get("MySavedSearches"));this._FavoriteSearchesA.getParent().removeClassName("selected");this._FavoriteSearches.inject(elements.predefinedSearches);this._otherLastBlockListUI.push(this._FavoriteSearchesA);this._FavoriteSearches.addEvent("click",that._clickOnChoiceFavoriteSearches.bind(this))}if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_my_content)){this._enable_my_content=options.searchParams.enable_my_content}if(this._enable_my_content){var tooltipStr=nlsKeys.get("mycontent.shortHelp");var attributesObj={};if(UWACore.is(tooltipStr,"string")&&tooltipStr.length>0){attributesObj.title=tooltipStr}this._myContentChoice=UWA.createElement("div",{id:"search-combo-search-my-content",attributes:attributesObj,"data-rec-id":"search-combo-search-my-content"});this._myContentChoiceAIcone=UWA.createElement("span",{"class":"fonticon fonticon-user"}).inject(this._myContentChoice);this._myContentChoiceA=UWA.createElement("a",{"class":"search-combo-item"}).inject(this._myContentChoice);this._myContentChoiceA.setHTML(nlsKeys.get("mycontent"));this._myContentChoiceA.getParent().removeClassName("selected");this._myContentChoice.inject(elements.predefinedSearches);this._otherLastBlockListUI.push(this._myContentChoiceA);this._myContentChoice.addEvent("click",that._clickOnChoiceMyContent.bind(this))}if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_search)){this._enable_search=options.searchParams.enable_search}if(this._enable_search){elements.searchChoice=UWA.createElement("ul",{"class":"search-choice",id:"search-combo-how-to-search","data-rec-id":"search-combo-how-to-search"}).inject(elements.suggestsContainer);this.howToSearchHeader=UWA.createElement("div",{}).inject(elements.searchChoice);this.howToSearchHeader.setStyle("height","26px");this.howToSearchHeader.setStyle("border-left","0px");this.howToSearchHeader.setStyle("padding-left","0px");this.ChoiceA=UWA.createElement("a",{"class":"choice-title"}).inject(this.howToSearchHeader);this.ChoiceA.setHTML(nlsKeys.get("Howtosearch"));var FD02=SearchSettings.getOption("newSearch19xFD02");var betaEnabled=SearchSettings.getOption("predefinedBetaUser");if(true===FD02&&betaEnabled){this.ChoiceX=UWA.createElement("div",{"class":"beta-toggle"}).inject(this.howToSearchHeader);var betaStatus=SearchUtils.isInTheSimpleSearch();if(betaStatus){this.ChoiceX.addClassName("beta-active")}else{this.ChoiceX.removeClassName("beta-active")}this.ChoiceX.setStyle("right","0");this._betaToggler=new UIKITToggle({type:"switch",name:"3DSearch-beta-toggler",checked:betaStatus,label:nlsKeys.get("search-beta"),events:{onChange:function(){require(["DS/UIKIT/SuperModal"],function(SuperModal){var isBetaBeingActivated=that._betaToggler.isChecked();var okButtonText=nlsKeys.get("beta_activation_ok_title");var betaMessage=nlsKeys.get("beta_activation_msg1")+nlsKeys.get("beta_activation_msg2")+nlsKeys.get("beta_pagereload_msg");var betaDialogTitle=nlsKeys.get("beta_dialog_title");if(!isBetaBeingActivated){okButtonText=nlsKeys.get("beta_deactivation_ok_title");betaMessage=nlsKeys.get("beta_deactivation_msg1")+nlsKeys.get("beta_deactivation_msg2")+nlsKeys.get("beta_pagereload_msg")}var onUserAction=function(okPressed){if(true===okPressed){var newSSEFlag=that._betaToggler.isChecked();SearchPreferences.setItem("simple_search_experience",newSSEFlag);SearchPreferences.removeItem("LastSearchViewMode");SearchPreferences.removeItem("LastInAppsSearchViewMode");SearchPreferences.commit({onComplete:function(){location.reload()},onFailure:function(){console.warn("SearchPreferences.commit FAILED")}})}else{that._betaToggler.setCheck(SearchUtils.isInTheSimpleSearch())}};if(true===SearchSettings.getOption("warnUserForBetaActivation")){var warning=new SuperModal({renderTo:document.body,className:"betaWarning",closable:false});warning.dialog({body:betaMessage,title:betaDialogTitle,buttons:[{className:"primary",value:okButtonText,action:function(modal){onUserAction(true);modal.hide()}},{value:nlsKeys.get("beta_cancel_title"),action:function(modal){onUserAction(false);modal.hide()}}]})}else{onUserAction(true)}})}}}).inject(this.ChoiceX)}var tooltipStr=nlsKeys.get("search.shortHelp");var attributesObj={};if(UWACore.is(tooltipStr,"string")&&tooltipStr.length>0){attributesObj.title=tooltipStr}this._srchChoice=UWA.createElement("div",{id:"search-combo-search-item",attributes:attributesObj,"data-rec-id":"search-combo-search-icon"});this._srchChoiceAIcone=UWA.createElement("span",{"class":"fonticon fonticon-search",id:"search-combo-search-icon"}).inject(this._srchChoice);this._srchChoiceA=UWA.createElement("a",{"class":"search-combo-item"}).inject(this._srchChoice);this._srchChoiceA.setHTML(nlsKeys.get("search"));this._srchChoiceA.getParent().addClassName("selected");if(UWACore.is(this._cstoreSources,"array")&&this._cstoreSources.length>0){sActiveTenant=this._cstoreSources[0].tenantId}this._srchChoice.inject(elements.searchChoice);this._srchChoice.addEvent("click",this._clickOnChoiceSearch.bind(this));this._srchChoice.addEvent("click",this._findInthisTabOnClick.bind(this,false))}if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_similar_search)){this._enable_similar_search=options.searchParams.enable_similar_search}if(this._enable_similar_search){var tooltipStr=nlsKeys.get("similar_search.shortHelp");var attributesObj={};if(UWACore.is(tooltipStr,"string")&&tooltipStr.length>0){attributesObj.title=tooltipStr}this._SimilarSearchChoice=UWA.createElement("div",{id:"search-combo-search-similar",attributes:attributesObj,"data-rec-id":"search-combo-search-similar"}).hide();this._SimilarSearchChoiceAIcone=UWA.createElement("span",{"class":"fonticon fonticon-search-similar"}).inject(this._SimilarSearchChoice);this._SimilarSearchChoiceA=UWA.createElement("a",{"class":"search-combo-item"}).inject(this._SimilarSearchChoice);this._SimilarSearchChoiceA.setHTML(nlsKeys.get("similar_search"));this._SimilarSearchChoiceA.getParent().removeClassName("selected");this._SimilarSearchChoice.inject(elements.searchChoice);this._SimilarSearchChoice.addEvent("click",this._clickOnChoiceSimilarSearch.bind(this));PlatformAPI.subscribe("DS/PADUtils/PADCommandProxy/select",this._selectPartForSimilarSearch.bind(this));if(UWA.debug){that._SimilarSearchChoice.show()}else{var that=this;require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(compass){compass.getServiceUrl({serviceName:"OnePart",platformId:(UWACore.is(that._cstoreSources,"array")&&that._cstoreSources.length>0)?that._cstoreSources[0].tenantId:"ErrorNoTenant",onComplete:function(url){if(typeof url==="string"&&url!==""||url&&url[0]!==""){that._SimilarSearchChoice.show()}},onFailure:function(){console.error("getServiceUrl failure!")}})})}}this._findInTabNLS=nlsKeys.get("find_in_tab");if(UWACore.is(options.searchParams)){if(UWACore.is(options.searchParams.enable_search_in_this_tab)){this._enable_search_in_this_tab=options.searchParams.enable_search_in_this_tab}if(UWACore.is(options.searchParams.enable_search_in_this_tab)){this._findInTabNLS=options.searchParams.filter_nls}}if(this._enable_search_in_this_tab){var tooltipStr=nlsKeys.get("find_in_tab.shortHelp");var attributesObj={};if(UWACore.is(tooltipStr,"string")&&tooltipStr.length>0){attributesObj.title=tooltipStr}this._sitChoice=UWA.createElement("div",{id:"search-combo-find-in-tab","data-rec-id":"search-combo-find-in-tab",attributes:attributesObj});this._sitChoiceAIcone=UWA.createElement("span",{"class":"fonticon fonticon-filter"}).inject(this._sitChoice);this._sitChoiceA=UWA.createElement("a",{"class":"search-combo-item"}).inject(this._sitChoice);this._sitChoiceA.setHTML(this._findInTabNLS);this._sitChoiceA.getParent().removeClassName("selected");this._sitChoice.inject(elements.searchChoice);this._sitChoice.addEvent("click",this._clickOnChoiceFindInTabOrApp.bind(this));this._sitChoice.addEvent("click",this._findInthisTabOnClick.bind(this,true))}if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_advanced_search)){this._enable_advanced_search=options.searchParams.enable_advanced_search}if(SearchUtils.isInTheSimpleSearch({tenant:allSources.active_tenant})===true){this._enable_advanced_search=false}if(UWACore.is(SearchSettings.getOption("NoadvOnMenu"))&&SearchSettings.getOption("NoadvOnMenu")===false){this._enable_advanced_search=true}if(this._enable_advanced_search){var tooltipStr=nlsKeys.get("adv_search.shortHelp");var attributesObj={};if(UWACore.is(tooltipStr,"string")&&tooltipStr.length>0){attributesObj.title=tooltipStr}this._AdvSearchChoice=UWA.createElement("div",{id:"search-combo-advance-search",attributes:attributesObj,"data-rec-id":"search-combo-advance-search"}).hide();this._AdvSearchChoiceIcone=UWA.createElement("span",{"class":"fonticon fonticon-search-cog"}).inject(this._AdvSearchChoice);this._AdvSearchChoiceA=UWA.createElement("a",{"class":"search-combo-item"}).inject(this._AdvSearchChoice);this._AdvSearchChoiceA.setHTML(nlsKeys.get("adv_search"));this._AdvSearchChoiceA.getParent().removeClassName("selected");this._AdvSearchChoice.inject(elements.searchChoice);this._AdvSearchChoice.addEvent("click",that._clickOnChoiceAdvancedSearch.bind(this))}if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_tenant_selection)){this._enable_tenant_selection=options.searchParams.enable_tenant_selection}if(this._cstoreSources.length>1){elements.tenantChoice=UWA.createElement("ul",{"class":"tenant-choice"}).inject(elements.suggestsContainer);var bExpandMode=SearchPreferences.getItem("LastExpandModeForTenantList");if(!UWACore.is(bExpandMode)){bExpandMode=true}var iconTenantExpander=UWA.createElement("span",{"class":"expander-icon"}).inject(elements.tenantChoice);iconTenantExpander.addClassName(bExpandMode===true?"fonticon fonticon-expand-up":"fonticon fonticon-expand-down");iconTenantExpander.setStyle("position","absolute");iconTenantExpander.setStyle("display","block");iconTenantExpander.setStyle("right","10px");iconTenantExpander.setStyle("line-height","26px");iconTenantExpander.setStyle("height","26px");iconTenantExpander.setStyle("pointer-events","none");this.ChoiceT=UWA.createElement("a",{"class":"choice-title"}).inject(elements.tenantChoice);this.ChoiceT.setHTML(nlsKeys.get("Wheretosearch"));this.ChoiceT.bExpandMode=bExpandMode;this.ChoiceT.addEvent("mousedown",function(){that.preventBlur=true});this.ChoiceT.addEvent("mouseup",function(){that.preventBlur=false});this.ChoiceT.addEvent("click",function(item){item.currentTarget.bExpandMode=!item.currentTarget.bExpandMode;if(item.currentTarget.bExpandMode===true){iconTenantExpander.removeClassName("fonticon fonticon-expand-down");iconTenantExpander.addClassName("fonticon fonticon-expand-up")}else{iconTenantExpander.removeClassName("fonticon fonticon-expand-up");iconTenantExpander.addClassName("fonticon fonticon-expand-down")}SearchPreferences.setItem("LastExpandModeForTenantList",item.currentTarget.bExpandMode);SearchPreferences.commit();for(var i=0;i<that._cstoreChoice.length;i++){var text=that._cstoreChoice[i];if(item.currentTarget.bExpandMode===false){text.hide()}else{if(that._inAppContext){var selected_incontext_tenant=that._inContextOptions.tenant?that._inContextOptions.tenant==that._cstoreSources[i].tenantId:true;if(selected_incontext_tenant){text.show()}}else{text.show()}}}this.elements.input.focus()});if(false===this._enable_tenant_selection){elements.tenantChoice.hide()}bMultiTenant=true;for(var src=0;src<this._cstoreSources.length;src++){var tenantId=this._cstoreSources[src].tenantId;var tenantNLS=this._cstoreSources[src].displayName;this._cstoreChoice.push(UWA.createElement("div"));this._cstoreChoiceA.push(UWA.createElement("a",{"class":"search-combo-item search-combo-tenant-item","tenant-id":tenantId}).inject(this._cstoreChoice[src]));if(tenantId===this._src_ressource.active_tenant){that._setPlaceHolderValue(nlsKeys.replace(nlsKeys.get("search_in_active"),{tenant:tenantNLS}));this._cstoreChoiceA[src].getParent().addClassName("active");sActiveTenant=tenantId}var sNLSTenantMsg=UWACore.is(nlsKeys.tenant)?nlsKeys.replace(nlsKeys.get("tenant"),{tenant:tenantNLS}):tenantNLS;this._cstoreChoiceA[src].setHTML(sNLSTenantMsg);this._cstoreChoiceA[src].tenantId=tenantId;this._cstoreChoiceA[src].displayName=tenantNLS;this._cstoreChoice[src].inject(elements.tenantChoice);this._cstoreChoice[src].addEvent("click",this._clickOnChoiceSearchInTenant.bind(this,this._cstoreChoiceA[src]));this._cstoreChoice[src].addEvent("mousedown",function(){that.preventBlur=true});this._cstoreChoice[src].addEvent("mouseup",function(){that.preventBlur=false})}for(var i=0;i<that._cstoreChoice.length;i++){var text=that._cstoreChoice[i];if(bExpandMode===false){text.hide()}else{text.show()}}}var actualTypeSuggestions;if(this._typeList.length===0){this._typeList=SNSearchTypeCusto.getSearchTypeCustoList();actualTypeSuggestions=this._typeList;if(actualTypeSuggestions.length>7){actualTypeSuggestions=actualTypeSuggestions.slice(0,7)}}if(Array.isArray(actualTypeSuggestions)&&actualTypeSuggestions.length!==0){elements.TypeSuggestions=UWA.createElement("ul",{"class":"what-choice"}).inject(elements.suggestsContainer);var iconDown=UWA.createElement("span",{"class":"expander-icon fonticon fonticon-expand-up"}).inject(elements.TypeSuggestions);iconDown.setStyle("position","absolute");iconDown.setStyle("display","block");iconDown.setStyle("right","10px");iconDown.setStyle("line-height","26px");iconDown.setStyle("height","26px");iconDown.setStyle("pointer-events","none");this.ChoiceT=UWA.createElement("a",{"class":"choice-title"}).inject(elements.TypeSuggestions);this.ChoiceT.setHTML(nlsKeys.get("Whattosearch"));this.ChoiceT.tpc=0;this.ChoiceT.addEvent("click",function(item){var hide=0;if(item.currentTarget.tpc===1){iconDown.removeClassName("fonticon fonticon-expand-down");item.currentTarget.tpc=0;iconDown.addClassName("fonticon fonticon-expand-up")}else{iconDown.removeClassName("fonticon fonticon-expand-up");item.currentTarget.tpc=1;iconDown.addClassName("fonticon fonticon-expand-down");hide=1}for(var i=0;i<that._easyTypeListUI.length;i++){var text=that._easyTypeListUI[i];if(hide===1){text.hide()}else{text.show()}}});var itemLi,itemDiv,itemIcon,itemA;PredicatesNLS.setResources({resources:this._src_ressource});var Option={};var that=this;Option.onComplete=function(nlsresults){actualTypeSuggestions.forEach(function(item){var Obj=nlsresults[item];var suggestString=that.getFormattedSuggest(Obj.nlsName);itemDiv=UWA.createElement("div");itemDiv.addClassName("whattosearch");itemIcon=UWA.createElement("img").inject(itemDiv);itemA=UWA.createElement("a").inject(itemDiv);itemA.setText(suggestString);itemA.getParent().removeClassName("selected");itemDiv.inject(elements.TypeSuggestions);that._easyTypeListUI.push(itemA);itemDiv.addEvent("click",function(itemDiv){var value=itemDiv;that._deactivateEasyTypeSearch(item);that.dispatchEvent("onSelect",[value,itemDiv,"AdvSearch"])}.bind(that,item))}.bind(that))};SNSearchTypeCusto.getSearchTypeCustoListNLSNames(Option)}elements.helpContent=UWA.createElement("ul",{"class":"help-container",id:"search-combo-help-container","data-rec-id":"search-combo-help-container"}).inject(elements.suggestsContainer);if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_predefined_query)){this._enable_PredefinedQuery=options.searchParams.enable_predefined_query}if(SearchUtils.isInTheSimpleSearch({tenant:allSources.active_tenant})===true){this._enable_PredefinedQuery=false}if(UWACore.is(SearchSettings.getOption("NoPQMenu"))&&SearchSettings.getOption("NoPQMenu")===false){this._enable_PredefinedQuery=true}if(this._enable_PredefinedQuery){var tooltipStr=nlsKeys.get("PredefinedQuery.shortHelp");var attributesObj={};if(UWACore.is(tooltipStr,"string")&&tooltipStr.length>0){attributesObj.title=tooltipStr}this._predefinedQuery=UWA.createElement("div",{id:"search-combo-pq-help",attributes:attributesObj,"data-rec-id":"search-combo-pq-help"}).hide();var PredefinedQueryIcone=UWA.createElement("span",{"class":"fonticon fonticon-help"}).inject(this._predefinedQuery);var PredefinedQueryA=UWA.createElement("a",{"class":"search-combo-item"}).inject(this._predefinedQuery);PredefinedQueryA.setHTML(nlsKeys.get("PredefinedQuery"));PredefinedQueryA.getParent().removeClassName("selected");this._predefinedQuery.inject(elements.helpContent);this._otherLastBlockListUI.push(PredefinedQueryA);this._predefinedQuery.addEvent("click",function(PredefinedQueryA){that._setFieldValue("");that._showPQSelectionUX();that._deactivateOtherLastBlockList();that._pqSelect=true})}this._myRecentContentChoice=UWA.createElement("div");this._myRecentContentChoiceA=UWA.createElement("a").inject(this._myRecentContentChoice);this._myRecentContentChoiceA.setHTML(nlsKeys.get("myrecentcontent"));this._myRecentContentChoiceA.getParent().removeClassName("selected");this._myRecentContentChoice.inject(elements.helpContent);this._myRecentContentChoice.hide();this._myRecentContentChoice.addEvent("click",this._clickOnChoiceMyRecentContent.bind(this));var that=this;SearchUtils.isRoleAvailable(["CSV"],sActiveTenant,function(bIsRoleAvailable){if(true===bIsRoleAvailable){if(UWACore.is(that._AdvSearchChoice)){that._AdvSearchChoice.show()}if(UWACore.is(that._FavoriteSearches)){that._FavoriteSearches.show()}if(UWACore.is(that._predefinedQuery)){that._predefinedQuery.show()}}that._AsyncSearchDropdownPromise.resolve()});localRequire(["DS/SNInfraUX/SearchSettings"],function(SearchSettings){if(true===SearchSettings.getOption("find_in_this_tab_default")){that._clickOnChoiceFindInTabOrApp({focus:false})}});SearchUtils.setAutocompleteRendered()},_clickOnChoiceSearch:function(options){this.showTenantChoice();if(this._typeList.length===0){this._typeList=SNSearchTypeCusto.getSearchTypeCustoList()}if(((this._isTypeListMode)&&(this._isTypeListDone))&&(this._typeList.length)&&(this._typeList.indexOf(options.adv_search_field)!==-1)){this._clickOnChoiceAdvancedSearch(options);this._isTypeListMode=false;this._isTypeListDone=false;return}this._internalSearchCriteria=null;if(this._SimilarSearchIsActive===true){this._setFieldValue("")}this.elements.input.readOnly=false;if(!UWACore.is(options,"object")||!UWACore.is(options.focus)||true===options.focus){this.elements.input.focus()}var placeHolderTxt=this._getPlaceHolderTextDependingOnActiveTenant("search");this._setPlaceHolderValue(placeHolderTxt);if(!UWACore.is(this._srchChoiceA)||!UWACore.is(this._srchChoiceA.getParent,"function")){return}this._deactivateMyRecentContent();this._deactivateSearchIn();this._deactivateMyContent();this._deactivateSimilarSearch();this._deactivateAdvancedSearch();if(!UWACore.is(options,"object")||!UWACore.is(options.setTenant)||false!==options.setTenant){this.options.events.setSourceCStorage(sActiveTenant)}this._deactivateOtherLastBlockList();if(options&&options.resetNLS&&UWACore.is(this._sitChoiceA)){this._sitChoiceA.setHTML(this._findInTabNLS)}if(this._easyTypeSelect===false){this._srchChoiceA.getParent().addClassName("selected")}if(this._inAppContext){}else{this.showPredefinedQuery()}var valueToSetInSearchField=this.elements.input.value;if(options&&options.resetNLS){valueToSetInSearchField=""}this._setFieldValue(valueToSetInSearchField)},storeAppContext:function(){return function(that,alreadyInappSearch,inContextOptions){var prevActiveTenant=sActiveTenant;return function(options){if(that._inAppContext){if(options&&(!options.in_apps_search||options.in_apps_search.widget_id!=that._inContextOptions.widget_id)){return false}}that.elements.suggestsContainer.getChildren().forEach(function(suggestChild){suggestChild.show()});if(that._cstoreSources.length>1){for(var insrc=0;insrc<that._cstoreSources.length;insrc++){if(that._cstoreChoiceA[insrc].getParent().show){that._cstoreChoiceA[insrc].getParent().show()}if(that._cstoreSources[insrc].tenantId===prevActiveTenant){if(UWA.is(that._cstoreChoiceA[insrc])){that._cstoreChoiceA[insrc].getParent().addClassName("active")}}else{that._cstoreChoiceA[insrc].getParent().removeClassName("active")}}}if(options&&options.in_apps_search&&options.in_apps_search.advanced_search&&options.in_apps_search.advanced_search.exclusive){that._showSearch()}if(alreadyInappSearch){}else{that.setInAppContext(false);sActiveTenant=prevActiveTenant;that.setBackSearchOrFindInTab({focus:false,noFocus:true})}}}(this,this._inAppContext,this._inContextOptions)},selectTenantOnTabActivation:function(options){if(UWA.is(options,"object")&&UWA.is(options.tenant,"string")&&options.tenant.length>0){if(options.tenant==="OnPremise"||false===bMultiTenant){return}sActiveTenant=options.tenant;for(var insrc=0;insrc<this._cstoreSources.length;insrc++){if(this._cstoreSources[insrc].tenantId===sActiveTenant){this._cstoreChoiceA[insrc].getParent().addClassName("active")}else{this._cstoreChoiceA[insrc].getParent().removeClassName("active")}}SearchPreferences.setItem("defaultTenantId",sActiveTenant);SearchPreferences.commit();this._updateMenuOnTanantSelection(sActiveTenant)}},_updateMenuOnTanantSelection:function(sActiveTenant){var that=this;SearchUtils.isRoleAvailable(["CSV"],sActiveTenant,function(bIsRoleAvailable){if(true===bIsRoleAvailable){if(UWACore.is(that._AdvSearchChoice)){if(that._inAppContext){var hideAdvancedSearch=true;if(that._inContextOptions&&that._inContextOptions.advanced_search){hideAdvancedSearch=false}if(hideAdvancedSearch){that._AdvSearchChoice.hide()}else{that._AdvSearchChoice.show()}}else{that._AdvSearchChoice.show()}}if(UWACore.is(that._FavoriteSearches)){if(that._inAppContext){var hideFavoriteSearches=false;if(that._inContextOptions&&that._inContextOptions.UXOptions&&that._inContextOptions.UXOptions.menuMyFavorites===false){hideFavoriteSearches=true}if(hideFavoriteSearches){that._FavoriteSearches.hide()}else{that._FavoriteSearches.show()}}else{that._FavoriteSearches.show()}}if(that._inAppContext){var hideHelpOnTypeShortcut=true;if(hideHelpOnTypeShortcut){that.hidePredefinedQuery()}}else{that.showPredefinedQuery()}}else{if(UWACore.is(that._AdvSearchChoice)){that._AdvSearchChoice.hide()}if(UWACore.is(that._FavoriteSearches)){that._FavoriteSearches.hide()}that.hidePredefinedQuery()}})},_clickOnChoiceSearchInTenant:function(choiceClicked){var that=this;if(!UWACore.is(choiceClicked)){throw ("E_INVALIDARG: no choiceClicked in _clickOnChoiceSearchInTenant function !")}this._internalSearchCriteria=null;this.elements.input.readOnly=false;var currentId="";if(UWACore.is(choiceClicked,"element")){currentId=choiceClicked.tenantId}else{currentId=choiceClicked}sActiveTenant=currentId;for(var insrc=0;insrc<this._cstoreSources.length;insrc++){if(this._cstoreSources[insrc].tenantId===currentId){this._cstoreChoiceA[insrc].getParent().addClassName("active")}else{this._cstoreChoiceA[insrc].getParent().removeClassName("active")}}if(sActiveTenant){this._src_ressource.setActiveTenant(sActiveTenant)}SearchPreferences.setItem("defaultTenantId",sActiveTenant);SearchPreferences.commit();this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("search"));this._deactivateSearchIn();this._deactivateSimilarSearch();this._deactivateEasyTypeSearch();this._deactivateSearch();this._deactivateMyRecentContent();this._deactivateMyContent();this._deactivateAdvancedSearch();this._deactivateOtherLastBlockList();this._srchChoiceA.getParent().addClassName("selected");this.options.events.setSourceCStorage(currentId);this._setFieldValue(this.elements.input.value);this._updateMenuOnTanantSelection(sActiveTenant);if(!this._cancel_suggest_update){this.elements.input.focus()}},selectTenant:function(iTenant){this._src_ressource.setActiveTenant(sActiveTenant);if(iTenant==="OnPremise"||false===bMultiTenant){return}if(UWACore.is(this._cstoreSources,"array")){for(var insrc=0;insrc<this._cstoreSources.length;insrc++){if(this._cstoreSources[insrc].tenantId===iTenant){if(UWACore.is(this._cstoreChoiceA,"array")&&UWACore.is(this._cstoreChoiceA[insrc])){this._cstoreChoiceA[insrc].click()}}}}},_clickOnChoiceFindInTabOrApp:function(options){var searchNLS=options&&options.searchNLS?options.searchNLS:null;this._internalSearchCriteria=null;this.elements.input.readOnly=false;if(this._inAppContext){this._setPlaceHolderValue(nlsKeys.get("find_in_app"))}else{this._setPlaceHolderValue(searchNLS||this._findInTabNLS)}if(UWACore.is(this._sitChoiceA)){this._sitChoiceA.getParent().addClassName("selected");if(!this._inAppContext){this._sitChoiceA.setHTML(searchNLS||this._findInTabNLS)}}if(!(UWACore.is(options)&&UWACore.is(options.focus)&&!(options.focus))){this.elements.input.focus()}this._deactivateSimilarSearch();this._deactivateMyRecentContent();this._deactivateMyContent();this._deactivateEasyTypeSearch();this._deactivateSearch();this._deactivateAdvancedSearch();this._deactivateOtherLastBlockList();this.hidePredefinedQuery();this.hideTenantChoice();if(this._inAppContext){this.options.events.setSourceCStorage(sActiveTenant)}else{this.options.events.setSourceDashboard()}this._setFieldValue(this.elements.input.value)},_clickOnChoiceMyContent:function(options){this.keepPreviousSearchMode();this._internalSearchCriteria=null;this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("mycontent"));this._setFieldValue("");this._hideClearSearchBtn();this.elements.input.readOnly=true;this._deactivateMyRecentContent();this._deactivateSearchIn();this._deactivateSimilarSearch();this._deactivateEasyTypeSearch();this._deactivateSearch();this._deactivateAdvancedSearch();this._deactivateOtherLastBlockList();this._myContentChoiceA.getParent().addClassName("selected");this.showPredefinedQuery();this.showTenantChoice();if(!UWACore.is(options,"object")||!UWACore.is(options.setTenant)||false!==options.setTenant){this.options.events.setSourceCStorage(sActiveTenant)}if(!UWACore.is(options,"object")||!UWACore.is(options.focus)||false!==options.focus){this.dispatchEvent("myContent")}},_clickOnChoiceFavoriteSearches:function(options){this._internalSearchCriteria=null;this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("MySavedSearches"));this._setFieldValue("");this._hideClearSearchBtn();this.elements.input.readOnly=true;this._deactivateMyRecentContent();this._deactivateSearchIn();this._deactivateSimilarSearch();this._deactivateEasyTypeSearch();this._deactivateSearch();this._deactivateAdvancedSearch();this._deactivateOtherLastBlockList();this._FavoriteSearchesA.getParent().addClassName("selected");this.showPredefinedQuery();this.showTenantChoice();if(!UWACore.is(options,"object")||!UWACore.is(options.setTenant)||false!==options.setTenant){this.options.events.setSourceCStorage(sActiveTenant)}if(!UWACore.is(options,"object")||!UWACore.is(options.focus)||false!==options.focus){this.dispatchEvent("favoriteSearches")}},_clickOnChoiceMyRecentContent:function(options){this._myRecentContentIsActive=true;var noFocus={focus:false};this._clickOnChoiceSearch(noFocus);var sFilterToUse="*";if((options&&options.paramsFilter!=="*")&&(this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("search")||this.elements.input.placeholder===nlsKeys.get("myrecentcontent"))){sFilterToUse=this.elements.input.value?this.elements.input.value:options.paramsFilter}this._internalSearchCriteria=null;this._myRecentContentChoiceA.getParent().addClassName("selected");this._deactivateMyContent();this._deactivateSearchIn();this._deactivateSimilarSearch();this._deactivateEasyTypeSearch();this._deactivateAdvancedSearch();this.options.events.setSourceCStorage(sActiveTenant);if(!UWACore.is(options,"object")||!UWACore.is(options.focus)||false!==options.focus){this.dispatchEvent("myRecentContent",{sFilter:sFilterToUse})}},_clickOnChoiceSimilarSearch:function(){this._internalSearchCriteria=null;this._setPlaceHolderValue(nlsKeys.get("similar_search"));this._setFieldValue("");this.elements.input.readOnly=true;if(UWACore.is(this._SimilarSearchChoiceA)){this._SimilarSearchChoiceA.getParent().addClassName("selected")}this._SimilarSearchIsActive=true;this._deactivateEasyTypeSearch();this._deactivateSearch();this._deactivateSearchIn();this._deactivateMyContent();this._deactivateMyRecentContent();this._deactivateAdvancedSearch();this.hidePredefinedQuery();this._setSimilarCurrentSelectedPhysicalId(this._SimilarCurrentSelectedPhysicalId)},_selectPartForSimilarSearch:function(cb_data){if(!UWACore.is(cb_data)){throw new Error("Invalid Arg in _selectPartForSimilarSearch")}if(UWACore.is(cb_data.data)&&UWACore.is(cb_data.data.paths)&&cb_data.data.paths.length>0&&cb_data.data.paths[0].length>0){var pId=cb_data.data.paths[0][cb_data.data.paths[0].length-1];if(pId.resourceid!=undefined){pId=pId.resourceid}this._setSimilarCurrentSelectedPhysicalId(pId)}},_setSimilarCurrentSelectedPhysicalId:function(physicalId){if(physicalId!==null){this._SimilarCurrentSelectedPhysicalId=physicalId;if(this._SimilarSearchIsActive===true){this._setFieldValue("#similarity/"+this._SimilarCurrentSelectedPhysicalId)}}},_clickOnChoiceAdvancedSearch:function(options){this._internalSearchCriteria=null;this._AdvSearchChoiceA.getParent().addClassName("selected");this._adv_Search_activated=true;this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("adv_search"));this._setFieldValue("");this.elements.input.readOnly=true;this._deactivateMyContent();this._deactivateMyRecentContent();this._deactivateSearchIn();this._deactivateEasyTypeSearch();this._deactivateSearch();this._deactivateOtherLastBlockList();this.hidePredefinedQuery();this.showTenantChoice();if(!UWACore.is(options,"object")||!UWACore.is(options.setTenant)||false!==options.setTenant){this.options.events.setSourceCStorage(sActiveTenant)}if(UWACore.is(options)&&UWACore.is(options.adv_search_field,"string")&&(options.adv_search_field.length>0)){this.dispatchEvent("advancedSearch",options.adv_search_field)}else{if(!UWACore.is(options,"object")||!UWACore.is(options.focus)||false!==options.focus){this.dispatchEvent("advancedSearch")}}},setInAppContext:function(isInAppContext){if(isInAppContext==false){this._inContextOptions=null}this._inAppContext=isInAppContext;this._temporarilyOutOfContext=false;if(UWACore.is(this._sitChoiceA)){if(this._inAppContext){this._sitChoiceA.setHTML(nlsKeys.get("find_in_app"))}else{this._sitChoiceA.setHTML(this._findInTabNLS)}}},setFindInContext:function(options,placeholder){this._setFindInContext(options);if(UWACore.is(placeholder)){this._setPlaceHolderValue(placeholder)}else{if(this._cstoreSources&&this._cstoreSources.length>1){}else{this._setPlaceHolderValue(nlsKeys.get("search"))}}},_setFindInContext:function(options){var that=this;this.keepPreviousSearchMode();this._internalSearchCriteria=null;this._setPlaceHolderValue(nlsKeys.get("find_in_app"));if(UWACore.is(this._sitChoiceA)){this._sitChoiceA.setHTML(nlsKeys.get("find_in_app"));this._sitChoiceA.getParent().addClassName("selected")}if(UWACore.is(this._srchChoiceA)){this._srchChoiceA.getParent().addClassName("selected")}this.elements.input.readOnly=false;var hideLastSearch=true;if(hideLastSearch){this.hideLastSearch()}var hideFavoriteSearches=false;if(options&&options.UXOptions&&options.UXOptions.menuMyFavorites===false){hideFavoriteSearches=true}if(hideFavoriteSearches){this._AsyncSearchDropdownPromise.promise.then(function(){that.hideFavoriteSearches()})}this._deactivateMyContent();var hideMyContent=false;if(options&&options.UXOptions&&options.UXOptions.menuMyContent===false){hideMyContent=true}if(hideMyContent){this.hideMyContent()}this._deactivateMyRecentContent();this._deactivateAdvancedSearch();this._deactivateEasyTypeSearch();if(UWA.is(options)&&UWA.is(options.tenant)){this.options.events.setSourceCStorage(options.tenant);sActiveTenant=options.tenant;if(this._cstoreSources.length>1){for(var insrc=0;insrc<this._cstoreSources.length;insrc++){if(this._cstoreSources[insrc].tenantId===options.tenant){if(UWA.is(this._cstoreChoiceA[insrc])){this._cstoreChoiceA[insrc].getParent().addClassName("active")}}else{if(UWA.is(this._cstoreChoiceA[insrc])&&this._cstoreChoiceA[insrc].getParent().hide){this._cstoreChoiceA[insrc].getParent().removeClassName("active");this._cstoreChoiceA[insrc].getParent().hide()}}}}this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("search"))}else{this.options.events.setSourceCStorage(sActiveTenant)}var hideAdvancedSearch=true;if(options&&options.advanced_search){hideAdvancedSearch=false;if(options.advanced_search.exclusive){that._hideSearch()}}if(hideAdvancedSearch){this._AsyncSearchDropdownPromise.promise.then(function(){that.hideAdvancedSearch()})}var hideHelpOnTypeShortcut=true;if(hideHelpOnTypeShortcut){this._AsyncSearchDropdownPromise.promise.then(function(){that.hidePredefinedQuery()})}this._inContextOptions=options},_setFindInApp:function(options){this._internalSearchCriteria=null;this._setPlaceHolderValue(nlsKeys.get("find_in_app"));if(UWACore.is(this._sitChoiceA)){this._sitChoiceA.setHTML(nlsKeys.get("find_in_app"));this._sitChoiceA.getParent().addClassName("selected")}this._deactivateMyContent();this._deactivateMyRecentContent();this._deactivateAdvancedSearch();this._deactivateEasyTypeSearch();this._deactivateSearch();if(UWA.is(options)&&UWA.is(options.tenant)){this.options.events.setSourceCStorage(options.tenant);if(this._cstoreSources.length>1){for(var insrc=0;insrc<this._cstoreSources.length;insrc++){if(this._cstoreSources[insrc].tenantId===options.tenant){this._cstoreChoiceA[insrc].getParent().addClassName("active")}else{this._cstoreChoiceA[insrc].getParent().removeClassName("active")}}}this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("find_in_app"))}else{this.options.events.setSourceCStorage(sActiveTenant)}this._inContextOptions=options},setBackSearchOrFindInTab:function(options){var noFocus={focus:false};if(UWACore.is(this._previouslyActiveSource,"string")&&this._previouslyActiveSource===SearchUtils.SearchTypeEnum.SEARCH_IN){this._clickOnChoiceFindInTabOrApp(options.noFocus?noFocus:null)}else{if(UWACore.is(this._previouslyActiveSource,"string")&&this._previouslyActiveSource===SearchUtils.SearchTypeEnum.SEARCH&&this._cstoreSources.length==1){this._clickOnChoiceSearch(noFocus)}else{if(UWACore.is(this._previouslyActiveSource,"string")&&this._previouslyActiveSource===SearchUtils.SearchTypeEnum.ADVANCED_SEARCH){this._clickOnChoiceAdvancedSearch(noFocus)}else{if(UWACore.is(this._previouslyActiveSource,"string")&&this._previouslyActiveSource===SearchUtils.SearchTypeEnum.MY_CONTENT){this._clickOnChoiceMyContent(noFocus)}else{if(UWACore.is(this._previouslyActiveSource,"string")&&this._previouslyActiveSource===SearchUtils.SearchTypeEnum.FAVORITE_SEARCH){this._clickOnChoiceFavoriteSearches(noFocus)}else{if(this._cstoreSources.length==1){this._clickOnChoiceSearch(noFocus)}else{if(this._cstoreSources.length>1){this._clickOnChoiceSearchInTenant(sActiveTenant)}}}}}}}if(options&&options.resetNLS&&UWACore.is(this._sitChoiceA)){this._sitChoiceA.setHTML(this._findInTabNLS)}this.showLastSearch();this.showFavoriteSearches();this.showMyContent();this.showAdvancedSearch(sActiveTenant)},switchToSearch:function(options){if(this.elements.input.placeholder===this._findInTabNLS){}else{this._isTypeListDone=true;var typeValue={adv_search_field:this._isTypeValue,focus:false};this._clickOnChoiceSearch(typeValue)}},setFindInApp:function(options){this.keepPreviousSearchMode();this._setFindInApp(options)},onSetFindInTab:function(searchNLS){this.keepPreviousSearchMode();var options={focus:false,searchNLS:searchNLS};this._clickOnChoiceFindInTabOrApp(options)},keepPreviousSearchMode:function(){if((this.elements.input.placeholder===this._findInTabNLS)||(this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("find_in_app"))){this._previouslyActiveSource=SearchUtils.SearchTypeEnum.SEARCH_IN}else{if(this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("search")){this._previouslyActiveSource=SearchUtils.SearchTypeEnum.SEARCH}else{if(this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("mycontent")){this._previouslyActiveSource=SearchUtils.SearchTypeEnum.MY_CONTENT}else{if(this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("adv_search")){this._previouslyActiveSource=SearchUtils.SearchTypeEnum.ADVANCED_SEARCH}else{if(this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("MySavedSearches")){this._previouslyActiveSource=SearchUtils.SearchTypeEnum.FAVORITE_SEARCH}else{this._previouslyActiveSource=SearchUtils.SearchTypeEnum.SEARCH_IN}}}}}},onSwitchToFindInTab:function(){this._clickOnChoiceFindInTabOrApp()},onSwitchToFindInApp:function(options){this._setFindInApp(options)},buildSkeleton:function(){this._parent()},resizeSuggests:function(){this._getSuggestions().setStyle("width","100%")},getSuggestions:function(text){var finalUrl,params,arrayUrl,that=this;if(!text){return}if(this.dataCache[text]){this.dispatchEvent("onUpdateSuggests",[this.dataCache[text]]);this.typeTimeout=null;return}if(this.options.suggestUrl){arrayUrl=this.options.suggestUrl.split("?");finalUrl=arrayUrl[0];params=arrayUrl[1].replace("{text}",text);if(UWACore.is(this.options.source)){params=this.options.source.getServicesData("suggest",text);return UWA.Data.request(finalUrl,{method:this.options.method||"POST",data:this.options.data||params,type:this.options.type||"json",headers:this.options.headers||{"Content-Type":"application/json"},onComplete:function(data){data=that.dataParse(data);if(data.length>0){that.dataCache[text]=data;that.dispatchEvent("onUpdateSuggests",[data])}that.typeTimeout=null;return that.typeTimeout},proxy:this.options.proxy||null})}}},onClick:function(e){var suggestion_display=this.elements.form.className;if(suggestion_display.indexOf("nv-autocomplete-suggestsDisplayed")===-1){this.onFocus(e)}},onFocus:function(e){this._cancel_suggest_update=false;if(this._inContextOptions&&this._inContextOptions.advanced_search&&this._inContextOptions.advanced_search.exclusive){this.dispatchEvent("onUpdateSuggests",[[]]);return}var autocompleteVar=this;var inputValue=autocompleteVar.elements.input.value;this._suggestPreviousQueries(this,inputValue);this.getServerSuggestions(inputValue);if(inputValue===""){localRequire(["DS/SNInfraUX/SearchSettings"],function(SearchSettings){if(SearchSettings.options.search_settings.search_on_keyup===true){autocompleteVar.dispatchEvent("defaultSearch",{value:"*"})}})}},onKeyUp:function(e){var autocompleteVar=this;if(e.keyCode===38||e.keyCode===40){return}else{if(e.keyCode===37||e.keyCode==39||e.keyCode===35||e.keyCode===36){return}else{if(e.keyCode===27){return}else{if(UWACore.is(this.elements.input)&&this.elements.input.value=="?"){this._setFieldValue("");this._showPQSelectionUX();return}}}}this._setInternalCriteria(null);var target=Event.getElement(e);if(target.value){if(target.value.length>0){this._showClearSearchBtn();autocompleteVar._suggestPreviousQueries(autocompleteVar,target.value)}else{this._hideClearSearchBtn();autocompleteVar._suggestPreviousQueries(autocompleteVar,target.value)}}else{if(this.elements.input.placeholder!=this._findInTabNLS){this._hideClearSearchBtn()}autocompleteVar._suggestPreviousQueries(autocompleteVar,target.value)}localRequire(["DS/SNInfraUX/SearchSettings"],function(SearchSettings){if(SearchSettings.options.search_settings.search_on_keyup===false){clearTimeout(autocompleteVar._suggestTimeout);autocompleteVar._suggestTimeout=setTimeout(function(){autocompleteVar.getServerSuggestions(target.value)},150)}else{if(target.value&&target.value.length===0){clearTimeout(autocompleteVar._secondTimeoutId)}clearTimeout(autocompleteVar._timeoutId);autocompleteVar._timeoutId=setTimeout((function(value){return function(){if(value&&value.length>0){autocompleteVar.options.events.onSearch(value)}autocompleteVar._suggestPreviousQueries(autocompleteVar,value);clearTimeout(autocompleteVar._suggestTimeout);autocompleteVar._suggestTimeout=setTimeout(function(){autocompleteVar.getServerSuggestions(value)},150)}})(target.value),500)}})},attachEvents:function(){this._parent();var elm=this.elements;elm.input.addEvent("keydown",this.onKeyDown.bind(this));elm.input.addEvent("click",this.onClick.bind(this))},_escapeKeyOnSuggestions:function(e){this.dispatchEvent("onHideSuggests")},_arrowKeyOnSuggestions:function(e,iDir){var children=this._getSuggestions().getChildren()[0].getChildren().concat(this._getSuggestions().getChildren()[1].getChildren());if(children.length<1){return}this.dispatchEvent("onShowSuggests");var currentItem=-1;var nextItem=-1;for(var i=0;i<children.length;i++){if(children[i].hasClassName("suggestion-selected")){currentItem=i;break}}nextItem=currentItem+iDir;if(nextItem<0){nextItem=children.length-1}if(nextItem>children.length-1){nextItem=0}if(currentItem>=0){children[currentItem].removeClassName("suggestion-selected")}if(nextItem>=0){children[nextItem].addClassName("suggestion-selected");var target=Event.getElement(e);if(UWACore.is(target)){target.value=children[nextItem].getText()}this._showClearSearchBtn()}},onKeyDown:function(e){var key=UWA.Event.whichKey(e);if(e.keyCode===38){this._arrowKeyOnSuggestions(e,-1)}else{if(e.keyCode===40){this._arrowKeyOnSuggestions(e,+1)}else{if(e.keyCode===27){this._escapeKeyOnSuggestions(e)}else{if(key==="ctrl+a"){e.stopPropagation()}}}}},_showPQSelectionUX:function(){this.dispatchEvent("showPQListUX")},setSelectedPQPrefix:function(prfix){this._setFieldValue(prfix);this.elements.input.focus();if(this._pqSelect===true){var noFocus={focus:false};this._clickOnChoiceSearch(noFocus)}this._pqSelect=false},onSelect:function(value,item,advSearch){if(UWACore.is(advSearch,"string")&&advSearch.length>0){this._isTypeListMode=true;this._value=""}this._parent(value,item);this._showClearSearchBtn()},_getClearSearchBtn:function(){if(this._clearSearch===null){this._clearSearch=UWACore.extendElement(document.body).getElement(".clear_btn_search")}return this._clearSearch},_showClearSearchBtn:function(){var clearSearchBtn=this._getClearSearchBtn();if(UWACore.is(clearSearchBtn)&&UWACore.is(clearSearchBtn.show,"function")){clearSearchBtn.setStyle("display","inline-block");clearSearchBtn.show();var inputField=UWACore.extendElement(document.body).getElement(".nv-autocomplete-input");if(UWACore.is(inputField)){inputField.addClassName("clear-visible")}}},_hideClearSearchBtn:function(){var clearSearchBtn=this._getClearSearchBtn();if(UWACore.is(clearSearchBtn)&&UWACore.is(clearSearchBtn.hide,"function")){clearSearchBtn.hide();var inputField=UWACore.extendElement(document.body).getElement(".nv-autocomplete-input");if(UWACore.is(inputField)){inputField.removeClassName("clear-visible")}}},_setPlaceHolderValue:function(sPlaceHolderValue){if(!UWACore.is(sPlaceHolderValue,"string")){throw ("Bad arg in _setPlaceHolderValue!")}if(!UWACore.is(this.elements.input)||!UWACore.is(this.elements.input.placeholder)){throw ("placeholder not found!")}this.elements.input.placeholder=sPlaceHolderValue},_getSuggestions:function(){if(this._autocompleteSuggests===null){this._autocompleteSuggests=UWACore.extendElement(document.body).getElement(".nv-autocomplete-suggests")}return this._autocompleteSuggests},hideSearchInThisTab:function(){if(this._sitChoice){this._sitChoice.hide()}},showSearchInThisTab:function(){if(this._sitChoice){this._sitChoice.show()}},hideLastSearch:function(){if(this._LastSearchResults){this._LastSearchResults.hide()}},showLastSearch:function(){if(this._inAppContext){}else{if(this._LastSearchResults){this._LastSearchResults.show()}}},hideFavoriteSearches:function(){if(this._FavoriteSearches){this._FavoriteSearches.hide()}},showFavoriteSearches:function(){var that=this;if(UWACore.is(that._FavoriteSearches)){SearchUtils.isRoleAvailable(["CSV"],sActiveTenant,function(bIsRoleAvailable){if(true===bIsRoleAvailable){that._FavoriteSearches.show()}})}},hidePredefinedQuery:function(){if(this._predefinedQuery){this._predefinedQuery.hide()}},hideMyContent:function(){if(this._myContentChoice){this._myContentChoice.hide()}},showMyContent:function(){if(this._myContentChoice){this._myContentChoice.show()}},showAdvancedSearch:function(sActiveTenant){var that=this;if(UWACore.is(that._AdvSearchChoice)){SearchUtils.isRoleAvailable(["CSV"],sActiveTenant,function(bIsRoleAvailable){if(true===bIsRoleAvailable){that._AdvSearchChoice.show()}})}},hideAdvancedSearch:function(){if(UWACore.is(this._AdvSearchChoice)){this._AdvSearchChoice.hide()}},showPredefinedQuery:function(){var that=this;if(this._srchChoice.className==="selected"){if(this._predefinedQuery){SearchUtils.isRoleAvailable(["CSV"],sActiveTenant,function(bIsRoleAvailable){if(true===bIsRoleAvailable){that._predefinedQuery.show()}})}}},_setInputValue:function(options){this.elements.input.value=options},_setFieldValue:function(options){this._setInputValue(options);this._searchStringToDisplayInSearchField=options;if((UWACore.is(options,"string")&&options.length>0)){this._showClearSearchBtn()}else{this._hideClearSearchBtn()}},_setInternalCriteria:function(options){this._internalSearchCriteria=options},_deactivateSearch:function(){if(UWACore.is(this._srchChoiceA)){this._srchChoiceA.getParent().removeClassName("selected")}},_hideSearch:function(){if(UWACore.is(this._srchChoiceA)){this._srchChoiceA.getParent().hide()}},_showSearch:function(){if(UWACore.is(this._srchChoiceA)){this._srchChoiceA.getParent().show()}},_deactivateSearchIn:function(){if(UWACore.is(this._sitChoiceA)){this._sitChoiceA.getParent().removeClassName("selected")}},_deactivateAdvancedSearch:function(){if(UWACore.is(this._AdvSearchChoiceA)){this._AdvSearchChoiceA.getParent().removeClassName("selected")}this._adv_Search_activated=false},_deactivateMyRecentContent:function(){if(UWACore.is(this._myRecentContentChoiceA)){this._myRecentContentChoiceA.getParent().removeClassName("selected")}this._myRecentContentIsActive=false},_deactivateMyContent:function(){if(UWACore.is(this._myContentChoiceA)){this._myContentChoiceA.getParent().removeClassName("selected")}},_deactivateSimilarSearch:function(){if(UWACore.is(this._SimilarSearchChoiceA)){this._SimilarSearchChoiceA.getParent().removeClassName("selected")}this._SimilarSearchIsActive=false},_getPlaceHolderTextDependingOnActiveTenant:function(sKey){if(!UWACore.is(sKey,"string")||0===sKey.length){throw ("E_INVALIDARG: need a key !")}var sPlaceHolderTxt=nlsKeys.get(sKey);if(this._cstoreSources.length>1){if(UWACore.is(nlsKeys[sKey+"_in_active"])){sPlaceHolderTxt=nlsKeys.replace(nlsKeys.get(sKey+"_in_active"),{tenant:this.getSelectedTenant().displayName})}else{sPlaceHolderTxt+=" "+this.getSelectedTenant().displayName}}return sPlaceHolderTxt},showTenantChoice:function(){if(true===this._enable_tenant_selection){if(UWACore.is(this.elements)&&UWACore.is(this.elements.tenantChoice)&&UWACore.is(this.elements.tenantChoice.hide,"function")){this.elements.tenantChoice.show()}}},hideTenantChoice:function(){if(UWACore.is(this.elements)&&UWACore.is(this.elements.tenantChoice)&&UWACore.is(this.elements.tenantChoice.hide,"function")){this.elements.tenantChoice.hide()}},isMultiTenantContext:function(){return bMultiTenant},getSelectedTenant:function(){if(!bMultiTenant){throw ("E_INVALIDARG: not in multi tenant context, check first using isMultiTenantContext before calling this function !")}if(!UWACore.is(this._cstoreChoice,"array")||this._cstoreChoice.length<=1||!UWACore.is(this._cstoreSources,"array")||this._cstoreChoice.length!==this._cstoreSources.length){throw ("E_UNEXPECTED: Supposed to be in multi tenant but invalid data !")}var currentTenant=null;for(var iTenant=0,nbTenant=this._cstoreChoice.length;iTenant<nbTenant&&currentTenant===null;iTenant++){if(UWACore.is(this._cstoreChoice[iTenant])&&UWACore.is(this._cstoreChoice[iTenant].className)){if(this._cstoreChoice[iTenant].className.indexOf("active")>=0){currentTenant={tenantId:this._cstoreSources[iTenant].tenantId,displayName:this._cstoreSources[iTenant].displayName}}}}if(null==currentTenant){currentTenant={tenantId:sActiveTenant,displayName:sActiveTenant}}return currentTenant},_deactivateEasyTypeSearch:function(iItem){this._easyTypeSelect=false;if(UWACore.is(this._easyTypeListUI,"array")&&this._easyTypeListUI.length>0){this._easyTypeListUI.forEach(function(item){item.getParent().removeClassName("selected")});if(UWACore.is(iItem)){for(var i=0;i<this._easyTypeListUI.length;i++){var text=this._easyTypeListUI[i].getText();if(text===iItem){this._easyTypeSelect=true;this._easyTypeListUI[i].getParent().addClassName("selected");break}}this._deactivateSearchIn();this._deactivateSimilarSearch();this._deactivateSearch();this._deactivateMyRecentContent();this._deactivateMyContent()}}},_deactivateOtherLastBlockList:function(iItem){if(UWACore.is(this._otherLastBlockListUI,"array")&&this._otherLastBlockListUI.length>0){this._otherLastBlockListUI.forEach(function(item){if(UWACore.is(item)){item.getParent().removeClassName("selected")}});if(UWACore.is(iItem)){iItem.getParent().addClassName("selected");this._deactivateSearchIn();this._deactivateSimilarSearch();this._deactivateSearch();this._deactivateMyRecentContent();this._deactivateMyContent();this._deactivateAdvancedSearch()}}},_findInthisTabOnClick:function(iVal){console.log("user clicked on Search");if(SearchUtils.isOneSearchInternalProd()){SearchPreferences.setItem("find_in_this_tab_default",iVal);SearchSettings.changeSettings({find_in_this_tab_default:iVal});SearchPreferences.commit()}}});return SearchAutocomplete});define("DS/SNSearchUX/SearchView",["text!DS/SNSearchUX/assets/templates/SearchView.html","DS/Handlebars/Handlebars","UWA/Core","UWA/Event","UWA/Class/View","UWA/Class/Debug","DS/SNInfraUX/SearchUtils","DS/SNSearchUX/SearchHistoric","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNSearchUX/SearchAutocomplete","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/UIKIT/Tooltip"],function(g,b,k,l,a,c,f,d,j,e,n,o,m,i){var h;h=a.extend(c,{name:"DS/SNSearchUX/SearchView",uwaClassName:"SearchView",id:"global_ctn_search",className:"global_ctn_search topbar-search",domEvents:{"click div.run_ctn_search":"_onSearch","click div.clear_btn_search":"_onClearSearch","keyup input.input_search":"_onSearchInputKeyUp","keydown input.input_search":"_onSearchInputKeyDown"},template:b.compile(g),autocomplete:undefined,socket:undefined,selectedSource:undefined,_setSource:function(p){var q=this;require(["DS/SNSearchUX/SearchUX_TopBar"],function(r){if(k.is(r.getAddinMode(),"string")){p.searchParams=p.searchParams||{};p.searchParams.enable_search_in_this_tab=false}if(k.is(q.autocomplete)&&k.is(q.autocomplete._buildSearchChoice,"function")){q.autocomplete._buildSearchChoice(p)}})},setup:function(p){var q=this;this.debugMode=f.result(p,"debugMode");var r="DS/TopBar/TopBar";require([r],function(s){s.addEvent({events:{mobileSearchAction:function(t){switch(t.action){case"enable":if(k.is(q.autocomplete)){q.autocomplete.elements.input.focus()}break;case"disable":break}}}})});this.socket=j.createSocket({socket_id:"searchview_socket_id"});this.socket.addListener("onSetSources",function(s){q._setSource(s)});this.socket.addListener("onSetFindInApp",function(s){q.autocomplete.setFindInApp(s)});this.socket.addListener("onSetBackSearchOrFindInTab",function(s){q.autocomplete.setBackSearchOrFindInTab(s)});this.socket.addListener("onSetInAppContext",function(s){q.autocomplete.setInAppContext(s)});this.socket.addListener("openTagger",function(s){q.socket.dispatchEvent("openTagger",s)});this.socket.addListener("setTaggerMode",function(s){q.socket.dispatchEvent("setTaggerMode",s)});this.socket.addListener("closeTagger",function(s){q.socket.dispatchEvent("closeTagger",s)});this.socket.addListener("onSetFocusInSearchField",function(){setTimeout(function(){if(k.is(q.autocomplete)){q.autocomplete.elements.input.focus()}},100)});this.socket.addListener("onSelectTenant",function(s){if(k.is(q.autocomplete.selectTenant,"function")){q.autocomplete.selectTenant(s)}});this.socket.addListener("onSelectTenantAfterTabActivation",function(s){if(k.is(q.autocomplete.selectTenantOnTabActivation,"function")){q.autocomplete.selectTenantOnTabActivation(s)}});this.socket.addListener("onRefreshSearchField",function(s){if(s.searchStringToDisplayInSearchField===m.get("myContent_searchFav")&&s.internalSearchCriteria!==m.get("myContent_searchFav")){q.autocomplete._clickOnChoiceSearch({focus:false})}if(k.is(s,"string")){if(s.length>0){q.autocomplete._clickOnChoiceSearch()}q.autocomplete._setFieldValue(s)}else{if(k.is(s,"object")&&k.is(s.searchStringToDisplayInSearchField,"string")&&k.is(s.internalSearchCriteria,"string")){if(s.searchStringToDisplayInSearchField.length>0){q.autocomplete._clickOnChoiceSearch({focus:false})}q.autocomplete._setFieldValue(s.searchStringToDisplayInSearchField);q.autocomplete._setInternalCriteria(s.internalSearchCriteria)}}});this.socket.addListener("onSwitchMode",function(s){if(s&&f.SearchTypeEnum.MY_RECENT_CONTENT===s.new_mode){q.autocomplete._clickOnChoiceMyRecentContent(s)}});this.socket.addListener("onResetMyRecent",function(){q.autocomplete._deactivateMyRecentContent()});this._filterInProgress=false;this.socket.addListener("clickOnChoiceSearch",function(s){q.autocomplete._clickOnChoiceSearch(s)});this.socket.addListener("clickOnChoiceMyContent",function(s){q.autocomplete._clickOnChoiceMyContent(s)});this.socket.addListener("clickOnChoiceAdvancedSearch",function(s){q.autocomplete._clickOnChoiceAdvancedSearch(s)});this.socket.addListener("clickOnChoiceFavoriteSearch",function(s){q.autocomplete._clickOnChoiceFavoriteSearches(s)});this.socket.addListener("onSetFindInTab",function(s){q.autocomplete.onSetFindInTab(s)});this.socket.addListener("onSwitchToFindInTab",function(s){q.autocomplete.onSwitchToFindInTab(s)});this.socket.addListener("onSwitchToFindInApp",function(s){q.autocomplete.onSwitchToFindInApp(s)});this.socket.addListener("hideSearchInThisTab",function(s){q.autocomplete.hideSearchInThisTab(s)});this.socket.addListener("showSearchInThisTab",function(s){q.autocomplete.showSearchInThisTab(s)});this.socket.addListener("onPQPrefixSelect",function(s){q.autocomplete.setSelectedPQPrefix(s)});this.socket.addListener("onInContextSearch",function(s){if(!q.autocomplete._inAppContext){if(s.inContextOptions.mode==="furtive"||s.inContextOptions.app_socket_id!=="socket_id_#saved_search_edit#"){q.restoreAppContext=q.autocomplete.storeAppContext();q.autocomplete.setInAppContext(true);q.autocomplete.setFindInContext(s.inContextOptions,s.placeholder)}else{q.autocomplete._clickOnChoiceSearch({focus:false})}}});this.socket.addListener("onCloseTransient",function(s){if(k.is(q.restoreAppContext,"function")){if(q.restoreAppContext(s)){q.restoreAppContext=null}}else{q.autocomplete.setBackSearchOrFindInTab({noFocus:true})}});this.socket.addListener("onInContextSearchDeactivated",function(s){if(k.is(q.restoreAppContext,"function")){if(q.restoreAppContext(s)){q.restoreAppContext=null}}});this.socket.addListener("Last_Tag_Filter",function(s){q.last_tag_filter=s});this.socket.addListener("clearSearch",function(s){if(q.autocomplete&&q.autocomplete.elements.input.placeholder===q.autocomplete._getPlaceHolderTextDependingOnActiveTenant("search")){q._onClearSearch(s)}})},destroy:function(){this.stopListening(this.model);this._parent();this.container=null},_onSearch:function(p){var t=this;if(f.identifyClientInfo().identifier==="3DSwym"&&f.getDeviceCategory()==="iphone"){t.container.parentElement.parentElement.toggleClassName("search-active")}var u=this.autocomplete.elements.input.value;if(k.is(this.autocomplete._internalSearchCriteria,"string")&&this.autocomplete._internalSearchCriteria.length>0){u=this.autocomplete._internalSearchCriteria}if(k.is(this.autocomplete.showLastSearch,"function")){this.autocomplete.showLastSearch()}f.setsearchType(f.SearchTypeEnum.SEARCH);var s=this.autocomplete._adv_Search_activated;if(k.is(u,"string")&&u.length>0){this.autocomplete._searchStringToDisplayInSearchField=this.autocomplete.elements.input.value;this.reSearch=true;this.reSearchQuery={value:u,searchStringToDisplayInSearchField:this.autocomplete._searchStringToDisplayInSearchField}}var r=this.autocomplete._inContextOptions;function q(){f.executeWithPQ({wait:function(){if(t.autocomplete.elements.input.value.indexOf(":")>0){t.socket.dispatchEvent("fetchPQsFromServer");return true}},run:function(){require(["DS/SNResultUX/utils/WildcardMgr"],function(v){var x={inCtx_widget_id:r.widget_id};var w=t.autocomplete.elements.input.value;w=v.manageWildcardAddtion(w);x.value=f.replacePQsWithCVPrefixes(w);if(k.is(r.precond)){if(r.precond.trim().length>0){x.searchStringToDisplayInSearchField=t.autocomplete.elements.input.value;if(k.is(x.value)&&x.value.trim().length>0&&x.value!=="*"){x.internalSearchCriteria="("+x.value+")AND("+r.precond+")";x.value="("+x.value+")AND("+r.precond+")"}else{x.internalSearchCriteria=r.precond;x.value=r.precond}x.displayValue=t.autocomplete.elements.input.value}}x.adv_search=s;x.source=r.source;if(!k.is(x.source)){x.source=[]}t.socket.dispatchEvent("search",x)})}})}if(true===this.autocomplete._myRecentContentIsActive&&u===""){f.setsearchType(f.SearchTypeEnum.MY_RECENT_CONTENT);this.socket.dispatchEvent("myRecentContent",{value:f.SearchTypeEnum.MY_RECENT_CONTENT,adv_search:false,sFilter:"*"})}else{if(u===""){if(this.autocomplete._inAppContext&&this.autocomplete._temporarilyOutOfContext===false&&r!==null){q()}else{if(this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("mycontent")){f.setsearchType(f.SearchTypeEnum.MY_CONTENT);this.socket.dispatchEvent("myContent",{value:f.SearchTypeEnum.MY_CONTENT,adv_search:false})}else{if(this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("search")&&this.reSearch){this.socket.dispatchEvent("search",{value:this.reSearchQuery.value,adv_search:s,refine:this.last_tag_filter,source:[],reSearch:true,internalSearchCriteria:this.autocomplete._internalSearchCriteria,searchStringToDisplayInSearchField:this.reSearchQuery.searchStringToDisplayInSearchField,fromEmptyString:true});t.autocomplete._setFieldValue(this.reSearchQuery.searchStringToDisplayInSearchField)}else{if(this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("adv_search")){f.setsearchType(f.SearchTypeEnum.ADVANCED_SEARCH);this.socket.dispatchEvent("advancedSearch",{value:f.SearchTypeEnum.ADVANCED_SEARCH,adv_search:true,source:[],adv_search_field:p});t.autocomplete._AdvancedSearchField=null}else{this._filterInProgress=false;this.autocomplete._hideClearSearchBtn();this.socket.dispatchEvent("clearSearch");if(k.is(this.autocomplete.hideLastSearch,"function")){this.autocomplete.hideLastSearch()}if(k.is(this.autocomplete)&&k.is(this.autocomplete.elements)&&k.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS){if(this.model.hasEvent("search")){f.setsearchType(f.SearchTypeEnum.SEARCH_IN);this.model.dispatchEvent("search",{value:u,searchMode:f.SearchTypeEnum.SEARCH_IN})}}}}}}}else{this._filterInProgress=true;if(this.autocomplete._inAppContext&&this.autocomplete._temporarilyOutOfContext===false&&r!==null){if(t.autocomplete._searchStringToDisplayInSearchField){d.storeValueInDataBase(t.autocomplete._searchStringToDisplayInSearchField)}q()}else{if(k.is(this.autocomplete)&&k.is(this.autocomplete.elements)&&k.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS){if(this.model.hasEvent("search")){f.setsearchType(f.SearchTypeEnum.SEARCH_IN);this.model.dispatchEvent("search",{value:this.autocomplete.elements.input.value,searchMode:f.SearchTypeEnum.SEARCH_IN})}}else{if(true===this.autocomplete._myRecentContentIsActive){this.autocomplete._clickOnChoiceSearch()}if(u===t.autocomplete._searchStringToDisplayInSearchField){d.storeValueInDataBase(u)}f.executeWithPQ({wait:function(){if(u.indexOf(":")>0){t.socket.dispatchEvent("fetchPQsFromServer");return true}},run:function(){require(["DS/SNResultUX/utils/WildcardMgr"],function(v){f.setsearchType(f.SearchTypeEnum.SEARCH);u=v.manageWildcardAddtion(u);u=f.replacePQsWithCVPrefixes(u);t.reSearchQuery.value=u;t.socket.dispatchEvent("search",{value:u,adv_search:s,internalSearchCriteria:k.is(t.autocomplete)?t.autocomplete._internalSearchCriteria:null,searchStringToDisplayInSearchField:k.is(t.autocomplete)?t.autocomplete._searchStringToDisplayInSearchField:null})})}})}}}}},_onClearSearch:function(p){this.autocomplete._setInternalCriteria(null);this.autocomplete.elements.input.value="";this.autocomplete._hideClearSearchBtn();this.reSearch=false;if(k.is(this.autocomplete)&&k.is(this.autocomplete.elements)&&k.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS){if(this.model.hasEvent("clearSearch")){this.model.dispatchEvent("clearSearch")}}else{if((!k.is(p)||!k.is(p.destroy)||p.destroy!==true)&&(k.is(this.autocomplete._myRecentContentIsActive)&&true===this.autocomplete._myRecentContentIsActive)){this._onSearch()}}this.reSearch=true},_onSearchInputKeyUp:function(p){if(this.autocomplete.elements.input.value){this.autocomplete._showClearSearchBtn()}else{if(!this._filterInProgress){this.autocomplete._hideClearSearchBtn()}}l.stopPropagation(p)},_onSearchInputKeyDown:function(p){if(l.whichKey(p)==="return"){this._onSearch()}l.stopPropagation(p)},_storeValueInLocalStorage:function(s){if(!k.is(s,"string")){throw new Error("null value given to SearchView._storeValueInLocalStorage!")}if(s.trim().length<=0){return}var r=[];if(!k.is(localStorage.SNSearchBoxStore)){r.push(s);localStorage.SNSearchBoxStore=JSON.stringify(r)}else{r=JSON.parse(localStorage.SNSearchBoxStore);if(r.indexOf(s)===-1){if(r.length>=100){r.shift()}r.push(s);localStorage.SNSearchBoxStore=JSON.stringify(r)}else{var q=r.indexOf(s);var p=r[q];r.splice(q,1);r.push(p);localStorage.SNSearchBoxStore=JSON.stringify(r)}}},render:function(){var t=this,s;s=this.template(this.model.toJSON());this.container.setContent(s);var r=t.getElement(".clear_btn_search.fonticon.fonticon-cancel-circled");if(k.is(r)){var x=new i({position:"bottom",target:r,body:o.get("clear")})}var v=t.getElement(".run_btn_search.fonticon.fonticon-search");if(v){var u=new i({position:"bottom",target:v,body:o.get("search")})}var w=this.container.getElement("#input_search_div");var q=function(y){return y.suggest};var p="tempo_deactivated";this.autocomplete=new n({suggestUrl:p+"?query={text}",placeholder:o.search,typeDelay:500,minLength:1,suggestFormat:"{label}",dataParser:q,className:"sn-search-field uwa-autocomplete nv-autocomplete",events:{openTagger:function(){t.socket.dispatchEvent("openTagger")},setSourceDashboard:function(){t.socket.dispatchEvent("setSelectedSource",{value:"3DDashboard"});t.selectedSource="3DDashboard"},setSourceCStorage:function(y){t.socket.dispatchEvent("setSelectedSource",{value:y});t.selectedSource=y},onSelect:function(z,y){if(k.is(t.autocomplete._isTypeListMode)&&t.autocomplete._isTypeListMode===true){t.autocomplete._isTypeValue=z}var A=false;if(k.is(arguments[2])&&arguments[2]==="AdvSearch"){A=true}if(k.is(arguments[1])){t.autocomplete.switchToSearch()}t.autocomplete._searchStringToDisplayInSearchField=z;if(k.is(t.autocomplete.elements)&&k.is(t.autocomplete.elements.input)&&k.is(t.autocomplete.elements.input.value)&&t.autocomplete.elements.input.value!==z){t.autocomplete._searchStringToDisplayInSearchField=null;t.autocomplete._setInternalCriteria(null)}if(t.autocomplete._searchStringToDisplayInSearchField===null||A===true){t.autocomplete._AdvancedSearchField=z}if(A===false){t._onSearch(t.autocomplete._AdvancedSearchField)}if(k.is(this._value)&&this._value.length>0){t.autocomplete.elements.input.value=z}t.socket.dispatchEvent("onHideSuggests");if(k.is(this._value)&&this._value.length>0&&(!k.is(y,"object")||y.storeSearch===true)){d.storeValueInDataBase(z)}},onSearch:function(y){t._onSearch();if(k.is(t.autocomplete._isTypeListMode)&&t.autocomplete._isTypeListMode===true){d.storeValueInDataBase(y)}},myContent:function(){t.socket.dispatchEvent("myContent",{value:f.SearchTypeEnum.MY_CONTENT,adv_search:false})},favoriteSearches:function(){t.socket.dispatchEvent("favoriteSearches",{value:f.SearchTypeEnum.FAVORITE_SEARCH,adv_search:false})},myRecentContent:function(z){var y={value:f.SearchTypeEnum.MY_RECENT_CONTENT,adv_search:false};if(k.is(z)&&k.is(z.sFilter,"string")&&0<z.sFilter.length){y.sFilter=z.sFilter}else{y.sFilter="*"}t.socket.dispatchEvent("myRecentContent",y)},hideAdvancedSearch:function(){t.socket.dispatchEvent("hideAdvancedSearch",{})},showAdvancedSearch:function(){t.socket.dispatchEvent("showAdvancedSearch",{})},advancedSearch:function(y){t.socket.dispatchEvent("showAdvancedSearch",{adv_search_field:y},["searchtopbar_socket_id"]);t.socket.dispatchEvent("advancedSearch",{value:f.SearchTypeEnum.ADVANCED_SEARCH,adv_search:true,adv_search_field:y})},storeSuggestion:function(y){d.storeValueInDataBase(y)},showPQListUX:function(){t.socket.dispatchEvent("onShowPQListUX")}}}).inject(w);f.setSearchViewRendered();return this}});return h});