define("DS/DuplicateWidget/converters/Converters",[],function(){return{groupActionToNodeAction:function(a){return[EnoDupTreeNodeAction.Undefined,EnoDupTreeNodeAction.Duplicate,EnoDupTreeNodeAction.Duplicate,EnoDupTreeNodeAction.DuplicateWDrw,EnoDupTreeNodeAction.Reuse,EnoDupTreeNodeAction.Exclude][a]},groupActionToRecursive:function(a){return a===EnoDupGroupAction.DuplicateTree},groupStringToAction:function(a){switch(a){case"Duplicate":return EnoDupGroupAction.Duplicate;case"Reuse":return EnoDupGroupAction.Reuse;case"Exclude":return EnoDupGroupAction.Exclude;case"DuplicateDrw":return EnoDupGroupAction.DuplicateWDrw;case"DuplicateTree":return EnoDupGroupAction.DuplicateTree}return EnoDupGroupAction.Invalid},groupActionToString:function(a){switch(a){case EnoDupGroupAction.Duplicate:return"Duplicate";case EnoDupGroupAction.Reuse:return"Reuse";case EnoDupGroupAction.Exclude:return"Exclude";case EnoDupGroupAction.DuplicateWDrw:return"DuplicateDrw";case EnoDupGroupAction.DuplicateTree:return"DuplicateTree"}return""}}});define("DS/DuplicateWidget/utils/EventRelay",["UWA/Controls/Abstract","DS/LifecycleCmd/Dictionary"],function(b,a){return b.extend({defaultOptions:{source:null,eventMap:[],batchMode:false,dispatcher:function(c,d){console.log("Supply dispatcher to EventRelay!")}},init:function(c){this._parent(c);if(this.options.source){this.addSource(this.options.source)}this._cache=new a()},addSource:function(c){var d=this;this.options.eventMap.forEach(function(f){c.addEvent(f.from,function(e){if(d.options.batchMode){d._cacheEvent(f.to||f.from,f.batchTransform,e)}else{d.options.dispatcher(f.to||f.from,f.transform?f.transform(e):e)}})})},setBatchMode:function(c){this.options.batchMode=c;if(!this.options.batchMode){this._dispatchCache()}},_cacheEvent:function(d,c,f){var e=this._cache.find(d);if(!e){e={data:[],transform:c};this._cache.add(d,e)}e.data.push(f)},_dispatchCache:function(){var c=this;this._cache.each(function(e,d){c.options.dispatcher(e,d.transform?d.transform(d.data):d.data)});this._cache.clear()}})});define("DS/DuplicateWidget/AlertBar",["UWA/Controls/Abstract"],function(a){return a.extend({name:"alertBar",autoHide:true,autoHideDelay:30000,init:function(b){this._parent(b);this.buildSkeleton()},buildSkeleton:function(){if(this.elements.container){return}var b=this;this.elements.container=UWA.createElement("div",{"class":this.getClassNames()});UWA.createElement("span",{"class":"fonticon fonticon-info "+this.getClassNames("_info")}).inject(this.elements.container);this.elements.text=UWA.createElement("span",{"class":this.getClassNames("_text")}).inject(this.elements.container);UWA.createElement("span",{"class":"fonticon fonticon-cancel "+this.getClassNames("_close")}).inject(this.elements.container);this.elements.container.addEventListener("click",function(){b.hide()});this.hide()},show:function(c){var b=this;this.elements.text.setContent(c);this.elements.container.setStyle("visibility","visible");this.elements.container.setStyle("display","block");this.elements.container.setStyle("height","30px");if(this.autoHide){this.timer=setTimeout(function(){b.timer=null;b.hide()},this.autoHideDelay)}},hide:function(){if(this.timer){clearTimeout(this.timer);this.timer=null}this.elements.container.setStyle("visibility","collapse");this.elements.container.setStyle("display","none");this.elements.container.setStyle("height","0px")}})});var EnoDupTitleSelectionCriteria={Undefined:0,Contains:1,NotContains:2};define("DS/DuplicateWidget/models/SelectionModel",["UWA/Controls/Abstract"],function(a){return a.extend({TitleCriteria:EnoDupTitleSelectionCriteria.Contains,TitleString:"",TypeMatch:[],StateMatch:[],_TypeSelected:[],_StateSelected:[],addSelection:function(){this.dispatchEvent("OnAddSelection",this)},removeSelection:function(){this.dispatchEvent("OnRemoveSelection",this)},clearSelection:function(){this.dispatchEvent("OnClearSelection")}})});define("DS/DuplicateWidget/utils/TreeNodeCache",["UWA/Controls/Abstract","DS/LifecycleCmd/Dictionary"],function(b,a){return b.extend({defaultOptions:{nodeModelFactory:function(){console.error("You must supply factory to TreeNodeCache");return null}},init:function(c){this._parent(c);this._cache=new a()},resolve:function(d){var c=this._createKey(d.nodeId,d.occId);var e=this._getFromCache(c);if(e){return e}return this._createAndCache(d,c)},_createKey:function(d,c){return d+"o"+c},_getFromCache:function(c){return this._cache.find(c)},_createAndCache:function(d,c){var e=this.options.nodeModelFactory(d);this._cache.add(c,e);return e}})});define("DS/DuplicateWidget/utils/UpdateSelectionModelHStrategy",["UWA/Controls/Abstract"],function(a){return a.extend({init:function(b){this._parent(b);this.controls={};this.controls.titleEdit=b.idns.getElById("titleEditH");this.controls.containsRadio=b.idns.getElById("containsRadioH");this.controls.notContainsRadio=b.idns.getElById("notContainsRadioH")},getGroupMatch:function(b){return this.options.groupList.getIsGroupUnused(b)?this.options.groupList.getGroupAll(b):this.options.groupList.getGroupSelected(b)},_getGroupSelected:function(b){return this.options.groupList.getGroupSelected(b)},updateUIFromModel:function(c){var b=c.TitleCriteria;this.options.groupList.setGroupSelected("type",c._TypeSelected);this.options.groupList.setGroupSelected("state",c._StateSelected);this.controls.titleEdit.wuxControl.value=c.TitleString;this.controls.containsRadio.wuxControl.checkFlag=b===EnoDupTitleSelectionCriteria.Contains;this.controls.notContainsRadio.wuxControl.checkFlag=b===EnoDupTitleSelectionCriteria.NotContains}})});var duplicateWidgetEvents={includeAllDrwOptionSet:"duplicate.incdrw.option.set",includeAllDrwOptionOnChange:"duplicate.incdrw.option.change",displayDuplicateAlert:"Lifecycle.Duplicate.Alert"};define("DS/DuplicateWidget/WidgetEvents",[],function(){return{}});var EnoDupTreeNodeAction={Undefined:0,Duplicate:1,DuplicateWDrw:2,Exclude:3,Reuse:4};define("DS/DuplicateWidget/models/TreeNodeModel",["UWA/Controls/Abstract","DS/LifecycleServices/AssemblyJson"],function(c,b){var a=c.extend({init:function(f,e,d,h,g){this.treeNode=f;this.assembly=d;this.treeList=h;this.isRoot=e;this.assyNode=null;this.nodeFactory=g;if(e){this.dupActionToIndex=[-1,0,1,-1,-1];this.indexToDupAction=[EnoDupTreeNodeAction.Duplicate,EnoDupTreeNodeAction.DuplicateWDrw]}else{this.dupActionToIndex=[-1,0,3,2,1];this.indexToDupAction=[EnoDupTreeNodeAction.Duplicate,EnoDupTreeNodeAction.Reuse,EnoDupTreeNodeAction.Exclude,EnoDupTreeNodeAction.DuplicateWDrw]}this.orgValues={title:this.getLabel(),action:this.getDupAction()}},setDupAction:function(d){if(this.isConnectedToParent()){return}var e=this.dupActionToIndex[d];if(e===-1){return}var f=this.getDupAction();if(d===f){return}this.treeList.setDropdownSelectionIf([this.treeNode._treeNode],e,"advancedDuplicateAction");this.dispatchEvent("onDupActionChange",{node:this,oldAction:f,newAction:d})},getDupAction:function(){var d=this.treeList.getNodeDropdownSelectedIndex(this.treeNode._treeNode,"advancedDuplicateAction");return this.indexToDupAction[d]},getDupActionFromIndex:function(d){return this.indexToDupAction[d]},getChildren:function(){var d=this.treeNode.getChildren().map(function(e){return this.nodeFactory(e)},this);return d?d:[]},getLabel:function(){return this.treeNode._treeNode.options.label},getTypeNls:function(){return this.treeNode._treeNode.options.type},getMaturityNls:function(){return this.treeNode._treeNode.options.grid.maturityNls},getId:function(){return this.treeNode.nodeId},getOccId:function(){return this.treeNode.occId},isVisible:function(){return this.treeNode._treeNode.isVisible()},getDepth:function(){return this.treeNode._treeNode._nodeDepth},getNewTitle:function(){return this.treeNode._treeNode.getNewTitle()},setNewTitle:function(d){return this.treeNode._treeNode.setNewTitle(d)},select:function(){this.treeNode._treeNode.select()},unselect:function(){this.treeNode._treeNode.unselect()},expandAll:function(){this.treeNode._treeNode.expandAll()},expandn:function(d){this.treeNode._treeNode.expandNLevels({numberOfLevelsToExpand:d})},collapseAll:function(){this.treeNode._treeNode.collapseAll()},isSelected:function(){return this.treeNode._treeNode.isSelected()},isDisabled:function(){return this.treeNode._treeNode.disabled},isConnectedToParent:function(){return this._getAssyNode().connectToParent},isHardDisabled:function(){return this.treeNode._treeNode.hardDisabled},setHardDisabled:function(d){this.treeNode._treeNode.hardDisabled=d},isUsingHardDisabledStyle:function(){return !this.treeNode._treeNode.disableHardDisabledStyle},setUseHardDisabledStyle:function(d){this.treeNode._treeNode.disableHardDisabledStyle=!d;if(d){this.treeNode._treeNode.dropdownList.advancedDuplicateAction.classList.add("hardDisabled-combo")}else{this.treeNode._treeNode.dropdownList.advancedDuplicateAction.classList.remove("hardDisabled-combo")}},reset:function(){this.setNewTitle(this.orgValues.title);this.setDupAction(this.orgValues.action)},_getAssyNode:function(){if(this.assyNode){return this.assyNode}this.assyNode=b.getNode(this.assembly,this.getId());return this.assyNode}});return a});define("DS/DuplicateWidget/utils/RegExReplace",[],function(){return{replace:function(d,c,a){var b=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};return d.replace(new RegExp(b(c),"gi"),a)}}});define("DS/DuplicateWidget/UIUpdate",["UWA/Controls/Abstract"],function(a){return a.extend({init:function(){this.elements=[]},addElement:function(d,c){var b=null;if(typeof c.enable==="function"){b=c.enable}else{if(typeof c==="function"){b=c}}this.elements.push({element:UWA.is(UWA.Element,d)?d:UWA.extend(d),enable:b})},update:function(b){this.elements.forEach(function(c){if(c.enable){if(c.element.wuxControl){c.element.wuxControl.disabled=!c.enable(b)}else{c.element.disabled=!c.enable(b)}}})}})});define("DS/DuplicateWidget/utils/UpdateSelectionModelVStrategy",["UWA/Controls/Abstract"],function(a){return a.extend({init:function(b){this._parent(b);this.controls={};this.controls.titleEdit=b.idns.getElById("titleEdit");this.controls.containsRadio=b.idns.getElById("containsRadio");this.controls.notContainsRadio=b.idns.getElById("notContainsRadio")},getGroupMatch:function(b){return this.options.groupList.getIsGroupUnused(b)?this.options.groupList.getGroupAll(b):this.options.groupList.getGroupSelected(b)},_getGroupSelected:function(b){return this.options.groupList.getGroupSelected(b)},updateUIFromModel:function(c){var b=c.TitleCriteria;this.options.groupList.setGroupSelected("type",c._TypeSelected);this.options.groupList.setGroupSelected("state",c._StateSelected);this.controls.titleEdit.wuxControl.value=c.TitleString;this.controls.containsRadio.wuxControl.checkFlag=b===EnoDupTitleSelectionCriteria.Contains;this.controls.notContainsRadio.wuxControl.checkFlag=b===EnoDupTitleSelectionCriteria.NotContains}})});var GrpSelListNodeType={GroupRoot:1,GroupEntry:2};var GrpNodeChecked={Checked:1,Unchecked:2,Mixed:3};define("DS/DuplicateWidget/controls/GroupSelectionList",["UWA/Controls/Abstract","DS/Controls/Toggle"],function(c,a){var b=c.extend({name:"groupSelectionListNode",defaultOptions:{label:"",id:"you must set id",checked:true},init:function(d){this.children=[];this._parent(d);this.type=this.options.type;this.label=this.options.label;this.id=this.options.id;this.checked=this.options.checked?GrpNodeChecked.Checked:GrpNodeChecked.Unchecked;this._isSyncing=false;this._buildLayout()},addChild:function(e){var d=this;this.children.push(e);e.addEvent("onChecked",function(f){d._syncCheck()})},getSelected:function(){return this.children.filter(function(d){return d.checked===GrpNodeChecked.Checked}).map(function(d){return d.id})},getAll:function(){return this.children.map(function(d){return d.id})},getIsUnused:function(){return(this.type===GrpSelListNodeType.GroupRoot&&this.checked===GrpNodeChecked.Unchecked)},setSelected:function(d){this.children.forEach(function(e){e.setChecked(d.find(function(f){return f===e.id})?true:false)})},_buildLayout:function(){this.elements.container=new UWA.Element("div",{"class":this.type===GrpSelListNodeType.GroupRoot?this.getClassNames("-root"):this.getClassNames("-child")});this.elements.container.addClassName(this.name)},_render:function(f){var d=this;while(this.elements.container.hasChildNodes()){this.elements.container.removeChild(this.elements.container.lastChild)}this.elements.container.inject(f);var e=new UWA.Element("div",{"class":this.getClassNames("-content")});e.addClassName(this.type===GrpSelListNodeType.GroupRoot?this.getClassNames("-content-root"):this.getClassNames("-content-child"));e.inject(this.elements.container);this.elements.check=new a({"class":this.getClassNames("-check"),type:"checkbox",label:this.label});this.elements.check.addEventListener("change",function(g){if(d._isSyncing){return}d._setCheckedInternal(d.elements.check.checkFlag)});this.elements.check.checkFlag=this.checked===GrpNodeChecked.Checked;this.elements.check.inject(e);this.children.forEach(function(g){g._render(f)})},_syncCheck:function(){this._isSyncing=true;var d=this.children.reduce(function(g,f){if(f.checked===GrpNodeChecked.Checked){return g+1}return g},0);var e=false;this.elements.check.mixedState=false;if(d===0){e=this.checked!==GrpNodeChecked.Unchecked;this.checked=GrpNodeChecked.Unchecked;this.elements.check.checkFlag=false}else{if(d===this.children.length){e=this.checked===GrpNodeChecked.Unchecked;this.checked=GrpNodeChecked.Checked;this.elements.check.checkFlag=true}else{e=this.checked===GrpNodeChecked.Unchecked;this.checked=GrpNodeChecked.Mixed;this.elements.check.checkFlag=true;this.elements.check.mixedState=true}}if(e){this._updateChildrenLabelState(this.checked===GrpNodeChecked.Unchecked)}this._isSyncing=false},_updateChildChecks:function(d){this.children.forEach(function(e){e.setChecked(d)})},_setCheckedInternal:function(e,f){var d=e?GrpNodeChecked.Checked:GrpNodeChecked.Unchecked;if(this.checked===d){return false}this.checked=d;this.dispatchEvent("onChecked",this.checked===GrpNodeChecked.Checked);if(f==null&&f!==true&&this.type===GrpSelListNodeType.GroupRoot){this._updateChildChecks(e);this._updateChildrenLabelState(this.checked===GrpNodeChecked.Unchecked)}return true},_updateChildrenLabelState:function(d){this.children.forEach(function(e){e._updateLabelState(d)})},_updateLabelState:function(f){var e=this.elements.check.getContent().querySelector(".wux-label");if(!e){return}var d=UWA.extendElement(e);if(f){d.addClassName("groupSelectionListNode-unused")}else{d.removeClassName("groupSelectionListNode-unused")}},setChecked:function(d,e){if(!this._setCheckedInternal(d,e)){return}this.elements.check.checkFlag=d}});return c.extend({name:"groupSelectionList",init:function(d){this.groups=[];this._parent(d);this._buildLayout()},addGroup:function(d,f){var e=new b({type:GrpSelListNodeType.GroupRoot,label:d.label?d.label:d.id,id:d.id});if(f&&f.forEach){f.forEach(function(g){e.addChild(new b({type:GrpSelListNodeType.GroupEntry,label:g.label?g.label:g.id,id:g.id}))})}this.groups.push(e);this._render()},getGroupSelected:function(e){var d=this._getGroupById(e);if(!d){return[]}return d.getSelected()},getGroupAll:function(e){var d=this._getGroupById(e);if(!d){return[]}return d.getAll()},getIsGroupUnused:function(e){var d=this._getGroupById(e);if(!d){return[]}return d.getIsUnused()},setGroupSelected:function(f,e){var d=this._getGroupById(f);if(!d){return}d.setSelected(e)},_getGroupById:function(d){return this.groups.find(function(e){return e.id===d})},_buildLayout:function(){var d={"class":this.getClassNames("-root")};this.elements.container=new UWA.Element("div",UWA.merge(this.options,d));this._render()},_render:function(){while(this.elements.container.hasChildNodes()){this.elements.container.removeChild(this.elements.container.lastChild)}var d=this.elements.container;this.groups.forEach(function(e){e._render(d)})}})});var EnoDupApplyTextPos={Before:0,After:1};var EnoDupGroupAction={Duplicate:1,DuplicateTree:2,DuplicateWDrw:3,Reuse:4,Exclude:5};define("DS/DuplicateWidget/models/TreeActionsModel",["UWA/Controls/Abstract"],function(a){return a.extend({GroupAction:EnoDupGroupAction.Duplicate,Text:"",ApplyTextToChildren:false,FindText:"",ReplaceText:"",ApplyToAll:false,ApplyTextPos:EnoDupApplyTextPos.Before,init:function(){},applyAction:function(b){this.dispatchEvent("OnApplyAction",this)},applySelectionAction:function(b){this.dispatchEvent("OnApplySelectionAction",b)},applyText:function(){if(this.ApplyTextPos===EnoDupApplyTextPos.Before){this.applyAddPrefixText()}else{this.applyAddPostfixText()}},applyAddPrefixText:function(){this.dispatchEvent("OnAddPrefixText",this)},applyAddPostfixText:function(){this.dispatchEvent("OnAddPostfixText",this)},applyReplace:function(){this.dispatchEvent("OnReplace",this)},reset:function(){this.dispatchEvent("OnReset",this)}})});define("DS/DuplicateWidget/utils/IdNs",["UWA/Controls/Abstract","DS/LifecycleServices/HTMLTemplating"],function(b,a){return b.extend({init:function(c,d){this.container=c;this.idPfx=d},getPfx:function(){return this.idPfx},getElById:function(c){return UWA.extendElement(this.container.querySelector("#"+this.idPfx+c))},elementFromTemplate:function(f,c,e,d){return UWA.extendElement(a.ElementFromTemplate(f,c,e,this.idPfx,d))}})});var EnoDupPanelLayout={Vertical:0,Horizontal:1};Object.freeze(EnoDupPanelLayout);define("DS/DuplicateWidget/DupToolsPanel",["UWA/Controls/Abstract","DS/Windows/Panel","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","css!DS/DuplicateWidget/DuplicateWidget"],function(c,b,a){return c.extend({defaultOptions:{initialDockArea:WUXDockAreaEnum.RightDockArea},init:function(d){var e=this;if(window.c145ae486a7011e9a9231681be663d3e){d.identifier=undefined}this._parent(d);this._initializedUI=false;this.model=this.options.model;this.immersiveFrame=this.options.immersiveFrame;this.panel=new b({identifier:d.identifier,title:this.getTitle(),content:this.getContent(),immersiveFrame:this.immersiveFrame,resizableFlag:false,allowedDockAreas:this.options.dockAreas||WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.RightDockArea|WUXDockAreaEnum.TopDockArea,closeButtonFlag:false});this.panel.addEventListener("prePlaceChange",function(f){e._onPrePlaceChange(f);e.onPrePlaceChange(f)});this.panel.addEventListener("startWindowDrag",function(f){e.onStartWindowDrag(f)});if(!this.haveStoredPlacement()){this.immersiveFrame.dockWindow(this.panel,this.options.initialDockArea)}else{this._initialUpdate(this._currentLayout())}},getContent:function(){return new UWA.Element("div",{html:"<p>TODO:Panel content</p>"})},getTitle:function(){return"panel title"},haveStoredPlacement:function(){return this.panel._getPositionFromPreferences()!=null},dock:function(d){this.immersiveFrame.dockWindow(this.panel,d)},onStartWindowDrag:function(d){},onPrePlaceChange:function(d){},_onPrePlaceChange:function(f){var d=this._isVerticalLayout(f.dsModel.currentDockArea)?EnoDupPanelLayout.Vertical:EnoDupPanelLayout.Horizontal;if(!this._initializedUI){this._initialUpdate(d);this._initializedUI=true}else{if(this._isVerticalLayout(f.dsModel.currentDockArea)!=this._isVerticalLayout(f.options.previousPlace.currentDockArea)){this._setLayout(d)}}},_currentLayout:function(){return this._isVerticalLayout(this.panel.currentDockArea)?EnoDupPanelLayout.Vertical:EnoDupPanelLayout.Horizontal},_isHorzLayout:function(d){return(d==WUXDockAreaEnum.TopDockArea||d==WUXDockAreaEnum.BottomDockArea)},_isVerticalLayout:function(d){return !this._isHorzLayout(d)},_setLayout:function(d){},_initialUpdate:function(d){}})});define("DS/DuplicateWidget/DataFilterer",["UWA/Class"],function(b){var a=b.extend({init:function(){this.filters=[]},addFilter:function(c){this.filters.push(c)},filter:function(c){return c.filter(function(d){return this.filters.every(function(e){return e(d)})},this)}});return a});define("DS/DuplicateWidget/TreeActions",[],function(){return{}});define("DS/DuplicateWidget/TreeActionsUI",[],function(){return{}});define("DS/DuplicateWidget/controls/PopupControl",["UWA/Controls/Abstract","DS/WidgetServices/WidgetServices"],function(b,a){return b.extend({name:"PopupControl",defaultOptions:{createContent:function(){return UWA.createElement("div")}},init:function(d){this._parent(d);this.createPopupContent=this.options.createContent;var e=a.getWidgetBody();var c=e.getParent("body");this.parentBody=c?c:e},showPopup:function(d){this.container=this.container||this._createUI();var c=this;this._positionPopup(d.parentEl);setTimeout(function(){c._showPopup()},50)},_createUI:function(){var e=UWA.merge({position:"absolute",display:"none",top:0,left:0,"z-index":99999,background:"green",borderWidth:"1px",borderColor:"#d0c0c0",borderStyle:"solid"},this.options.styles);var d=UWA.createElement("div",{"class":this.getClassNames("_container"),styles:e});this.createPopupContent().inject(d);d.inject(this.parentBody);var c=this;this.parentBody.addEvent("click",function(f){if(c.currentPopup&&!c.currentPopup.contains(f.target)){c._hidePopup()}});return d},hidePopup:function(){this._hidePopup()},_positionPopup:function(c){var d=c.getBoundingClientRect();this.container.setStyle("left",d.left+"px");this.container.setStyle("top",d.top+d.height+"px")},_showPopup:function(){this.currentPopup=this.container;this.container.setStyle("display","block");var c=this;setTimeout(function(){c.dispatchEvent("onShow",c.currentPopup)},10)},_hidePopup:function(){if(!this.currentPopup){return}this.dispatchEvent("onHide",this.currentPopup);this.currentPopup.setStyle("display","none");this.currentPopup=null}})});define("DS/DuplicateWidget/utils/UpdateActionModelHStrategy",["UWA/Controls/Abstract","DS/DuplicateWidget/converters/Converters"],function(b,a){return b.extend({init:function(c){this._parent(c);this.controls={};this.controls.applyAllRadio=c.idns.getElById("applyAllRadioH");this.controls.applySelRadio=c.idns.getElById("applySelRadioH");this.controls.applyToChildren=c.idns.getElById("applyChildrenCheckH");this.controls.addText=c.idns.getElById("addTextEditH");this.controls.findText=c.idns.getElById("findTextEditH");this.controls.replaceText=c.idns.getElById("replaceTextEditH");this.controls.groupActionCombo=c.idns.getElById("groupActionH");this.controls.dropDownBtn=c.idns.getElById("addtextBtnH")},getApplyChildrenCheck:function(){return this.controls.applyToChildren.wuxControl.checkFlag},updateUIFromModel:function(c){this.controls.applyToChildren.wuxControl.checkFlag=c.ApplyTextToChildren;this.controls.dropDownBtn.wuxControl.value=c.ApplyTextPos===EnoDupApplyTextPos.Before?"before":"after";this.controls.groupActionCombo.wuxControl.currentValue=a.groupActionToString(c.GroupAction);this.controls.addText.wuxControl.value=c.Text;this.controls.findText.wuxControl.value=c.FindText;this.controls.replaceText.wuxControl.value=c.ReplaceText}})});define("DS/DuplicateWidget/utils/UpdateActionModelVStrategy",["UWA/Controls/Abstract","DS/DuplicateWidget/converters/Converters"],function(b,a){return b.extend({init:function(c){this._parent(c);this.controls={};this.controls.applyAllRadio=c.idns.getElById("applyAllRadio");this.controls.applySelRadio=c.idns.getElById("applySelRadio");this.controls.applyToChildren=c.idns.getElById("applyChildrenCheck");this.controls.addText=c.idns.getElById("addTextEdit");this.controls.findText=c.idns.getElById("findTextEdit");this.controls.replaceText=c.idns.getElById("replaceTextEdit");this.controls.groupActionCombo=c.idns.getElById("groupAction");this.controls.dropDownBtn=c.idns.getElById("addtextBtn")},getApplyChildrenCheck:function(){return this.controls.applyToChildren.wuxControl.checkFlag},updateUIFromModel:function(c){this.controls.applyToChildren.wuxControl.checkFlag=c.ApplyTextToChildren;this.controls.dropDownBtn.wuxControl.value=c.ApplyTextPos===EnoDupApplyTextPos.Before?"before":"after";this.controls.groupActionCombo.wuxControl.currentValue=a.groupActionToString(c.GroupAction);this.controls.addText.wuxControl.value=c.Text;this.controls.findText.wuxControl.value=c.FindText;this.controls.replaceText.wuxControl.value=c.ReplaceText}})});define("DS/DuplicateWidget/models/TreeModel",["UWA/Controls/Abstract","DS/DuplicateWidget/models/TreeNodeModel","DS/DuplicateWidget/utils/TreeNodeCache","DS/DuplicateWidget/utils/EventRelay","DS/LifecycleCmd/Dictionary"],function(e,d,c,b,a){return e.extend({Types:null,States:null,init:function(g){var f=this;this.Types=new a();this.States=new a();g.addEvent("onTreeListCreated",function(i){f.treeList=g.treeList;f.assembly=g.assembly;f.treeList.onInitialUpdateView().then(function(){f.dispatchEvent("OnTreeInitialized",f)});f.treeList.tree.getDocument().getXSO().onPostAdd(function(j){f.dispatchEvent("OnSelChangeTree",f)});f.treeList.tree.getDocument().getXSO().onPostRemove(function(j){f.dispatchEvent("OnSelChangeTree",f)});f.treeList.tree.getDocument().getXSO().onEmpty(function(j){f.dispatchEvent("OnSelChangeTree",f)})});this._eventRelay=new b({dispatcher:function(i,j){f.dispatchEvent(i,j)},eventMap:[{from:"onDupActionChange",to:"onDupActionChangeTree",transform:function(i){return{nodes:[i]}},batchTransform:function(i){return{nodes:i}}}]});this._initNodeModel=function(i){f._eventRelay.addSource(i)};var h=function(k){var i=function(l){var m=f._treeNodeCache.resolve(l);if(m){return m}return h(l)};var j=new d(k,k._treeNode._nodeDepth===0,f.assembly,f.treeList,i);f._initNodeModel(j);return j};this._treeNodeCache=new c({nodeModelFactory:h})},getSelectedNodes:function(){return this.treeList.getSelectedNodes().map(function(f){return this._treeNodeCache.resolve(f)},this)},getAllNodes:function(){return this.treeList.getAllNodes().map(function(f){return this._treeNodeCache.resolve(f)},this)},getSelectedCount:function(){if(!this.treeList){return 0}return this.treeList.getSelectedNodes().length},getModelFromTreeNode:function(f){return this._treeNodeCache.resolve(this.treeList.buildAssemblyNode(f))},appendInstances:function(h){if(typeof h.forEach==="function"){var g={};var f=[];h.forEach(function(i){f=f.concat(this._appendInstances(i,g))},this);return f}else{return this._appendInstances(h)}},disableNode:function(f){this.treeList.disableNode(f.treeNode._treeNode)},enableNode:function(f){this.treeList.enableNode(f.treeNode._treeNode)},updateCell:function(g,f){var h=this.treeList.tree.getManager();h.updateCellView(g.treeNode._treeNode._getRowID(),f)},setBatchMode:function(f){this._eventRelay.setBatchMode(f)},_appendInstances:function(l,i){var f=function(m){return""+m.getId()+"o"+m.getOccId()};var h=function(m){if(i){i[m]=true}};var k=function(m){return i==null||i[m]==null};var g=this.treeList.getSameNodes(l.getId()).filter(function(m){return m.options.occId!=l.getOccId()}).map(function(m){return{node:m,key:f({getId:function(){return m.options.nodeId},getOccId:function(){return m.options.occId}})}}).filter(function(m){return k(m.key)}).map(function(m){h(m.key);return this.getModelFromTreeNode(m.node)},this);var j=f(l);if(k(j)){g.unshift(l);h(j)}return g},clearSelection:function(){this.getSelectedNodes().forEach(function(f){f.unselect()})},_addType:function(g,f){if(this.Types.contains(g)){return}this.Types.add(g,f)},_addState:function(g,f){if(this.States.contains(g)){return}this.States.add(g,f)}})});define("DS/DuplicateWidget/utils/TreeNodeFiltering",["UWA/Controls/Abstract","DS/DuplicateWidget/DataFilterer"],function(b,a){return b.extend({init:function(c){this.treeModel=c},filterNodes:function(g){var h=function(s,t){return t.getLabel().indexOf(s)!==-1};var l=function(s,t){return !h(s,t)};var j=function(s,t){return t.getLabel().search(new RegExp(s,"i"))!==-1};var f=function(s,t){return !j(s,t)};var r=function(s,t){return new RegExp("^"+s.split("*").join(".*")+"$","i").test(t.getLabel())};var c=function(s,t){return !r(s,t)};var d=function(s,t){return s===t.getTypeNls()};var i=function(s,t){return s.some(function(u){return d(u,t)})};var p=function(t,s){return t===s.getMaturityNls()};var e=function(s,t){return s.some(function(u){return p(u,t)})};var o=function(s){return s.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")};var q=new a();var n=o(g.TitleString);var m=n.indexOf("*")!==-1;if(n.length>0){if(g.TitleCriteria===EnoDupTitleSelectionCriteria.Contains){if(m){q.addFilter(r.bind(null,n))}else{q.addFilter(j.bind(null,n))}}else{if(m){q.addFilter(c.bind(null,n))}else{q.addFilter(f.bind(null,n))}}}q.addFilter(i.bind(null,g.TypeMatch));q.addFilter(e.bind(null,g.StateMatch));var k=q.filter(this.treeModel.getAllNodes());return k}})});define("DS/DuplicateWidget/views/ActionsPanel",["DS/DuplicateWidget/DupToolsPanel","DS/DuplicateWidget/UIUpdate","DS/DuplicateWidget/converters/Converters","DS/LifecycleServices/Utils","DS/DuplicateWidget/utils/IdNs","DS/DuplicateWidget/utils/UpdateActionModelVStrategy","DS/DuplicateWidget/utils/UpdateActionModelHStrategy","DS/LifecycleServices/HTMLTemplating","text!DS/DuplicateWidget/assets/html/actionpanelv.html","text!DS/DuplicateWidget/assets/html/actionpanelh.html","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls","css!DS/DuplicateWidget/DuplicateWidget"],function(h,k,i,f,e,b,c,d,g,j,a){return h.extend({defaultOptions:{canHaveDrawings:false},init:function(r,n,p,m){a=f.createDbgNlsProxy(a);var q=this;var l=m||{};this.options=l;this.treeModel=p;this.UIUpdate=new k();this._parent({identifier:"d94c75a2-6828-11e9-a923-1681be663d3e",immersiveFrame:r,model:n});this.options=UWA.merge(UWA.merge(l,this.defaultOptions),this.options);this.updateUI=f.debounce(this._updateUI.bind(this),100);this._delayedUpdateModel=f.debounce(this._updateModel.bind(this),100);var o=false;p.addEvent("OnSelChangeTree",function(s){var t=s.getSelectedCount()!==0;if(t===o){return}o=t;q._delayedUpdateModel()})},getContent:function(){return this.content||this.createContent()},getTitle:function(){return a.actions},createContent:function(){var o=this;this.content=UWA.createElement("div",{"class":"advdup-action-panels"});var n=new e(this.content,"enolcm-dup-actionpanel-");this.verticalLayout=UWA.createElement("div").inject(this.content);this.horzLayout=UWA.createElement("div").inject(this.content);var l={applyAction:function(){o.model.applyAction()},onChangeActionCombo:function(p){o.model.GroupAction=i.groupStringToAction(p);o.model.applyAction()},addText:function(){o.model.applyText()},onApplyChildrenChange:function(p){o._updateModel()},onChangeAddCombo:function(p){o.model.ApplyTextPos=p==="before"?EnoDupApplyTextPos.Before:EnoDupApplyTextPos.After;o.model.applyText()},replace:function(){var p=o._updateModel();if(p.FindText.length>0){p.applyReplace()}},reset:function(){o._updateModel().reset()},setProperty:function(q,p){if(q==="addText"){o.model.Text=p}else{if(q==="findText"){o.model.FindText=p}else{if(q==="replaceText"){o.model.ReplaceText=p}}}o.updateUI(o.treeModel)}};var m={actionsArray:[{isDrawingAction:false,name:a.duplicate,value:"Duplicate"},{isDrawingAction:false,name:a.duplicateTree,value:"DuplicateTree"},{isDrawingAction:true,name:a.duplicateWDrw,value:"DuplicateDrw"},{isDrawingAction:false,name:a.reuse,value:"Reuse"},{isDrawingAction:false,name:a.exclude,value:"Exclude"}],actions:function(){var p="";this.actionsArray.filter(function(q){return !q.isDrawingAction||o.options.canHaveDrawings}).forEach(function(q){p+=d.Expand("<option value={{value}}>{{name}}</option>",q)});return p}};n.elementFromTemplate(g,m,a,l).inject(this.verticalLayout);n.elementFromTemplate(j,m,a,l).inject(this.horzLayout);this._connectButtons(n);this.updateActionModelVStrategy=new b({idns:n});this.updateActionModelHStrategy=new c({idns:n});return this.content},_connectButtons:function(o){var m=this;var p=function(r){var q=o.getElById(r);m.UIUpdate.addElement(q,function(s){return !s.applyToAll})};p("applyChildrenCheck");p("applyChildrenCheckH");var n=function(r){var q=o.getElById(r);m.UIUpdate.addElement(q,function(s){return s.haveTreeSelection&&s.haveFindText})};n("replaceBtn");n("replaceBtnH");var l=function(r){var q=o.getElById(r);m.UIUpdate.addElement(q,function(s){return s.haveTreeSelection&&s.haveAddText})};l("addtextBtn");l("addtextBtnH");this.addEvent("applyModeChanged",function(q){m.updateUI(q)})},_updateModel:function(){this.model.ApplyToAll=this.treeModel.getSelectedCount()===0;this.model.ApplyTextToChildren=this.updateModelStrategy.getApplyChildrenCheck();return this.model},_updateUI:function(){this.UIUpdate.update({haveTreeSelection:this.treeModel.getSelectedNodes().length>0||this.model.ApplyToAll,haveAddText:this.model.Text.length>0,haveFindText:this.model.FindText.length>0,haveReplaceText:this.model.ReplaceText.length>0,applyToAll:this.model.ApplyToAll})},_setLayout:function(m){var l=null;if(this.updateModelStrategy){l=this._updateModel()}if(m===EnoDupPanelLayout.Vertical){this.verticalLayout.setStyle("display","block");this.horzLayout.setStyle("display","none");this.updateModelStrategy=this.updateActionModelVStrategy}else{this.verticalLayout.setStyle("display","none");this.horzLayout.setStyle("display","block");this.updateModelStrategy=this.updateActionModelHStrategy}if(l){this.updateModelStrategy.updateUIFromModel(l)}},_initialUpdate:function(l){this._setLayout(l);this._updateModel()}})});define("DS/DuplicateWidget/views/OptionsPanel",["DS/DuplicateWidget/DupToolsPanel","DS/DuplicateWidget/utils/IdNs","DS/LifecycleCmd/MessageMediator","DS/LifecycleServices/Utils","text!DS/DuplicateWidget/assets/html/optionspanel.html","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls","DS/DuplicateWidget/WidgetEvents","css!DS/DuplicateWidget/DuplicateWidget"],function(b,d,f,e,a,c){return b.extend({init:function(h,g){c=e.createDbgNlsProxy(c);this._parent({identifier:"d94c7818-6828-11e9-a923-1681be663d3e",immersiveFrame:h,model:g})},getContent:function(){return this.content||this.createContent()},getTitle:function(){return c.options},createContent:function(){var i=this;this.content=UWA.createElement("div",{"class":"advdup-option-panel"});var h=new d(this.content,"enolcm-dup-optionpanel-");this.viewModel={onIncDrwChange:function(j){i.model.setIncludeDrawings(j)}};h.elementFromTemplate(a,null,c,this.viewModel).inject(this.content);var g=h.getElById("incDrwCheck");f.addEvent(duplicateWidgetEvents.includeAllDrwOptionSet,function(j){if(i.model.IncludeDrawings===j){return}i.model.setIncludeDrawings(j);g.wuxControl.checkFlag=j;f.dispatchEvent(duplicateWidgetEvents.displayDuplicateAlert,c.autoDisableDrw)});return this.content}})});define("DS/DuplicateWidget/models/OptionsModel",["UWA/Controls/Abstract","DS/LifecycleCmd/MessageMediator","DS/DuplicateWidget/WidgetEvents"],function(b,a){return b.extend({IncludeDrawings:false,setIncludeDrawings:function(c){this.IncludeDrawings=c;a.dispatchEvent(duplicateWidgetEvents.includeAllDrwOptionOnChange,this.IncludeDrawings)}})});define("DS/DuplicateWidget/views/SelectionPanel",["DS/DuplicateWidget/DupToolsPanel","DS/DuplicateWidget/UIUpdate","DS/DuplicateWidget/controls/GroupSelectionList","DS/DuplicateWidget/controls/PopupControl","DS/LifecycleServices/Utils","DS/DuplicateWidget/utils/IdNs","DS/DuplicateWidget/utils/UpdateSelectionModelVStrategy","DS/DuplicateWidget/utils/UpdateSelectionModelHStrategy","text!DS/DuplicateWidget/assets/html/selpanelv.html","text!DS/DuplicateWidget/assets/html/selpanelh.html","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls","css!DS/DuplicateWidget/DuplicateWidget"],function(h,j,k,d,f,e,a,b,g,i,c){return h.extend({content:null,init:function(n,l,m){c=f.createDbgNlsProxy(c);this.treeModel=m;this.UIUpdate=new j();this._parent({identifier:"d94c796c-6828-11e9-a923-1681be663d3e",immersiveFrame:n,model:l});this.updateUI=f.debounce(this._updateUI.bind(this),100);m.addEvent("OnTreeInitialized",function(){var p=[];this.treeModel.Types.each(function(r,q){p.push({label:q,id:q})});this.groupList.addGroup({label:"Type",id:"type"},p);var o=[];this.treeModel.States.each(function(r,q){o.push({label:q,id:q})});this.groupList.addGroup({label:"State",id:"state"},o)},this)},getContent:function(){return this.content||this.createContent()},getTitle:function(){return c.selection},createContent:function(){var o=this;this.content=UWA.createElement("div",{"class":"advdup-selection-panels"});var m=new e(this.content,"enolcm-dup-selpanel-");this.verticalLayout=UWA.createElement("div").inject(this.content);this.horzLayout=UWA.createElement("div").inject(this.content);var l={addSelection:function(){o._updateModel().addSelection()},removeSelection:function(){o._updateModel().removeSelection()},clearSelection:function(){o._updateModel().clearSelection()},onChangeContains:function(p){o.model.TitleCriteria=EnoDupTitleSelectionCriteria.Contains},onChangeNotContains:function(p){o.model.TitleCriteria=EnoDupTitleSelectionCriteria.NotContains},setProperty:function(q,p){if(q==="title"){o.model.TitleString=p}}};m.elementFromTemplate(g,null,c,l).inject(this.verticalLayout);m.elementFromTemplate(i,null,c,l).inject(this.horzLayout);this._setupUIUpdate(m);var n=this._createGroupLists(m);this.updateSelectionModelVStrategy=new a({idns:m,groupList:n.v});this.updateSelectionModelHStrategy=new b({idns:m,groupList:n.h});return this.content},_setupUIUpdate:function(l){var n=this;var m=[{ids:["removeSelBtn","clearSelBtn","removeSelBtnH","clearSelBtnH"],enableLogic:function(o){return o.haveTreeSelection}}];m.forEach(function(o){o.ids.forEach(function(q){var p=l.getElById(q);n.UIUpdate.addElement(p,function(r){return o.enableLogic(r)})})})},_connectButtons:function(l){},onStartWindowDrag:function(){if(this.attlistPopup){this.attlistPopup.hidePopup()}},onPrePlaceChange:function(l){if(this.attlistPopup){this.attlistPopup.hidePopup()}},_createGroupLists:function(p){var m=this;var o=new k();var l=p.getElById("dropdownGrouplistPlaceholder");l.addEventListener("show",function(r){if(r.currentTarget.dsModel.elements.popup){r.currentTarget.dsModel.elements.popup.visibleFlag=false}m.attlistPopup=m.attlistPopup||new d({createContent:function(){var s=new UWA.createElement("div",{"class":"groupListDropdown-container",styles:{width:"200px",height:"auto",maxHeight:"0px",transition:"max-height 0.3s ease-in"}});o.inject(s);return s},styles:{borderRadius:"4px",height:"auto",maxHeight:"400px",overflowY:"auto"},events:{onShow:function(t){var u=t.querySelector(".groupListDropdown-container");if(u){u.setStyle("max-height","800px")}var s=t.querySelector(".groupSelectionList-root");if(s){s.setStyle("overflow-y","hidden")}},onHide:function(t){var u=t.querySelector(".groupListDropdown-container");if(u){u.setStyle("max-height","0px")}var s=t.querySelector(".groupSelectionList-root");if(s){s.setStyle("overflow-y","auto")}}}});m.attlistPopup.showPopup({parentEl:l})});var q=p.getElById("groupListPlaceholder");var n=new k();n.inject(q);this.groupList={lists:[],add:function(r){this.lists.push(r)},getGroupSelected:function(r){return this.lists[0].getGroupSelected(r)},addGroup:function(s,r){this.lists.forEach(function(t){t.addGroup(s,r)})}};this.groupList.add(n);this.groupList.add(o);return{h:o,v:n}},_updateModel:function(){this.model.TypeMatch=this.updateModelStrategy.getGroupMatch("type");this.model.StateMatch=this.updateModelStrategy.getGroupMatch("state");this.model._TypeSelected=this.updateModelStrategy._getGroupSelected("type");this.model._StateSelected=this.updateModelStrategy._getGroupSelected("state");return this.model},_updateUI:function(){this.UIUpdate.update({haveTreeSelection:this.treeModel.getSelectedNodes().length>0})},_setLayout:function(m){var l=null;if(this.updateModelStrategy){l=this._updateModel()}if(m===EnoDupPanelLayout.Vertical){this.verticalLayout.setStyle("display","block");this.horzLayout.setStyle("display","none");this.updateModelStrategy=this.updateSelectionModelVStrategy}else{this.verticalLayout.setStyle("display","none");this.horzLayout.setStyle("display","block");this.updateModelStrategy=this.updateSelectionModelHStrategy}if(l){this.updateModelStrategy.updateUIFromModel(l)}},_initialUpdate:function(l){this._setLayout(l);this._updateModel()}})});define("DS/DuplicateWidget/AdvDupModelFactory",["UWA/Controls/Abstract","DS/DuplicateWidget/models/SelectionModel","DS/DuplicateWidget/models/OptionsModel","DS/DuplicateWidget/models/TreeActionsModel","DS/DuplicateWidget/models/TreeModel"],function(e,b,d,a,c){return e.extend({init:function(f){this.advDupTree=f},createTreeModel:function(){return new c(this.advDupTree)},createOptionsModel:function(){return new d()},createSelectionModel:function(){return new b()},createTreeActionsModel:function(f){return new a(f)}})});define("DS/DuplicateWidget/AdvancedDuplicateTree",["UWA/Controls/Abstract","DS/ENO6WPlugins/jQuery","DS/DuplicateWidget/views/SelectionPanel","DS/DuplicateWidget/views/ActionsPanel","DS/DuplicateWidget/views/OptionsPanel","DS/DuplicateWidget/AdvDupModelFactory","DS/DuplicateWidget/utils/TreeNodeFiltering","DS/DuplicateWidget/converters/Converters","DS/DuplicateWidget/WidgetEvents","DS/DuplicateWidget/utils/RegExReplace","DS/Controls/LineEditor","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleCmd/Dictionary","DS/LifecycleCmd/MessageMediator","DS/WAFData/WAFData","DS/LifecycleControls/AssemblyTreeList","DS/LifecycleServices/AssemblyJson","DS/LifecycleServices/TranslationService","DS/LifecycleControls/NumberModal","DS/LifecycleServices/Utils","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls"],function(q,j,k,p,s,i,c,u,f,w,h,a,t,v,m,b,l,o,r,n,d,g){var e=q.extend({advancedOpened:false,hasRequestedPADSession:false,PADSession:null,haveCatiaV5Data:false,propagateTitleEditToInstances:true,defaultOptions:{roots:[],tenant:"OnPremise",inputValidator:null,expandOneLevel:true,modelFactory:null},init:function(x){this._parent(x);g=d.createDbgNlsProxy(g);this.roots=[];this.tenant=this.options.tenant;this.inputValidator=this.options.inputValidator;this.expandOneLevel=this.options.expandOneLevel;this.idns=this.options.idns;this.titleInputValidators=new v();this.translationService=new r({handleError:true});for(var y=0;y<this.options.roots.length;++y){this.roots.push({id:this.options.roots[y]})}this.modelFactory=this.options.modelFactory?this.options.modelFactory:new i(this);this.model=this.modelFactory.createTreeModel();this.optionsModel=this.modelFactory.createOptionsModel();this.selectionModel=this.modelFactory.createSelectionModel();this.treeActionsModel=this.modelFactory.createTreeActionsModel(this.model);this.updateTree=d.debounce(this._updateTree.bind(this),200)},getPADSessionPromise:function(){var x=this;return new UWA.Class.Promise(function(A,z){var y="DS/PADUtils/PADSession";require([y],function(B){x.hasRequestedPADSession=true;x.PADSession=B;A(x.PADSession)},function(B){x.hasRequestedPADSession=true;x.PADSession=null;A(x.PADSession)})})},_getPADSession:function(){if(this.hasRequestedPADSession){return UWA.Class.Promise.resolve(this.PADSession)}else{return this.getPADSessionPromise()}},openAdvancedTree:function(x,A,z){var y=this;this.advancedOpened=true;this.rootContainer=A.getContainer?A.getContainer():A.elements?A.elements.container:null;this._hideShowOpts(this.rootContainer,true);if(!this.container){this.container=x;if(widget&&a.isInPSEditorWidget(widget)){this._getPADSession().then(function(B){var C=true;if(B){C=B.determineAuthoredFlag()}y.expandStructure(z,C)})}else{y.expandStructure(z,true)}}},closeAdvancedTree:function(){this.advancedOpened=false;this._hideShowOpts(this.rootContainer,false)},_hideShowOpts:function(A,x){var y=this;var z=function(E,B,D){if(!y.idns){return}var C=y.idns.getElById(E);if(!C){return}C.setStyle(B,D)};if(x){j(A).find(".simpdup-option").slideUp(300,function(B){j(this).removeClass("simpdup-option").addClass("lifecycle-option-hidden");y.dispatchEvent("optionsHidden")});j(A).find(".duplicate_popup_text").slideUp(300);z("advanced-content","display","block");z("expander","display","none");z("collapser","display","block")}else{j(A).find(".lifecycle-option-hidden").slideDown(150,function(B){j(this).addClass("simpdup-option").removeClass("lifecycle-option-hidden")});j(A).find(".duplicate_popup_text").slideDown(150);z("advanced-content","display","none");z("expander","display","block");z("collapser","display","none")}},usingAdvancedDuplicate:function(){return this.advancedOpened},getTreeNodesData:function(){var x=this.getOptions().options;var y=this._getDuplicationData(x);return y},getOptions:function(y){var x,z,A;if(this.haveCatiaV5Data){if(y){x=["duplicate","duplicate2"];z=[g.duplicate,g.duplicatewithdrw];A={duplicate:0,duplicate2:1}}else{x=["duplicate","reuse","exclude","duplicate2"];z=[g.duplicate,g.reuse,g.exclude,g.duplicatewithdrw];A={duplicate:0,reuse:1,exclude:2,duplicate2:3}}}else{if(y){x=["duplicate"];z=[g.duplicate];A={duplicate:0}}else{x=["duplicate","reuse","exclude"];z=[g.duplicate,g.reuse,g.exclude];A={duplicate:0,reuse:1,exclude:2}}}return{options:x,translated:z,name2idx:A}},_getRelationData:function(A,y){for(var z=0;z<this.assembly.occurrencerelationships.length;++z){var x=this.assembly.occurrencerelationships[z];if(x.parent===A&&x.child===y){return{physicalId:x.physicalid,type:x.type}}}return null},_getDuplicationDataR:function(I,J,H,D,x,y,L){var C=o.getNode(this.assembly,I.options.nodeId);if(C.excludeFromServiceCall){return}var E;if(C.connectToParent){E=L}else{E=I.dropdownListSelectedIndex?I.dropdownListSelectedIndex:{advancedDuplicateAction:0};E=E.advancedDuplicateAction}E=this._fixupSelIndexOnRoot(E,I.options.physicalId);if(J&&(x[E]==="duplicate"||x[E]==="duplicate2"||x[E]==="reuse")){var z=o.getRelationshipData(this.assembly,J.options.occId,I.options.occId);var G=H.find(J.options.physicalId);var K=x[E]==="duplicate2"?"duplicate":x[E];G.relations.push({physicalid:z.pid,type:z.type,operation:K})}if(H.contains(I.options.physicalId)){return}var B={physicalid:I.options.physicalId,isRootNode:D,operation:x[E],title:I.getNewTitle(),revision:C.revision,relations:[]};y.push(B);H.add(I.options.physicalId,B);if(x[E]==="reuse"||x[E]==="exclude"){return}var A=I.getChildren();if(!A){return}for(var F=0;F<A.length;++F){this._getDuplicationDataR(A[F],I,H,false,x,y,E)}},_getDuplicationData:function(z){var y=[];var A=new v();var B=this.treeList.tree.getDocument();var x=B.getNthRoot(0);this._getDuplicationDataR(x,null,A,true,z,y,-1);return y},_parseExpandState:function(y){var x=y?y.split("."):[];if(x.length>1){return{state:x[1],policy:x[0]}}return{state:y}},expandDone:function(y){var x=[];var z=new v();this.assembly=o.convertFromExpandFormat(y);this.assembly.nodes.forEach(function(C){var B=this._parseExpandState(C.state);if(B.hasOwnProperty("policy")){this.translationService.addStateAndPolicy(B.state,B.policy)}else{this.translationService.addStateAndType(C.state,C.type)}this.translationService.addType(C.type);if(this.haveCatiaV5Data===false&&C.cadMaster){this.haveCatiaV5Data=C.cadMaster=="CATIAV5"||C.cadMaster=="SOLIDWORKS"}},this);var A=this;this.translationService.initAsync(this.tenant).then(function(){A.assembly.nodes.forEach(function(C){C.newTitle=C.Title;C.connectToParent=false;C.excludeFromServiceCall=false;C.isEmbeddedComponent=false;var B=A._parseExpandState(C.state);C.maturityNls=this.translationService.translateState(B.state);C.typeRaw=C.type;C.type=this.translationService.translateType(C.typeRaw);this.model._addType(C.typeRaw,C.type);this.model._addState(B.state,C.maturityNls);x.push(C.physicalid);z.add(C.physicalid,C)},A);if(x.length===0){A.createAdvancedTree()}else{a.listAttributesPromise(A.tenant,x,["type","physicalid","attribute[PLMEntity.V_usage]","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]).then(function(B){if(B.results){B.results.forEach(function(D){if((D["attribute[PLMEntity.V_usage]"]==="3DPart"&&D.type==="3DShape")||D["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]==="TRUE"){var C=z.find(D.physicalid);C.connectToParent=true;if(D["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]==="TRUE"){C.isEmbeddedComponent=true}}})}A.createAdvancedTree()})}})},getAssemblyNodeFromPhysicalid:function(x){for(var y=0;y<this.assembly.nodes.length;++y){if(this.assembly.nodes[y].physicalid===x){return this.assembly.nodes[y]}}return null},getTypeFromPhysicalid:function(x){var y=this.getAssemblyNodeFromPhysicalid(x);return y?y.type:""},isConnectedToParent:function(x){return(this.isEmbeddedComponent(x)||this.isNodeNodeConnectedToParent(x))},isEmbeddedComponent:function(x){if(this.getTypeFromPhysicalid(x)==="CATIA Embedded Component"){return true}else{var y=this.getAssemblyNodeFromPhysicalid(x);if(y){return y.isEmbeddedComponent}}return false},isNodeNodeConnectedToParent:function(x){var y=this.getAssemblyNodeFromPhysicalid(x);return y?y.connectToParent:false},getNodeFromPhysicalid:function(x){var y=this.treeList.tree.getDocument().getAllDescendants();for(var z=0;z<y.length;z++){var A=y[z];if(x===A.options.physicalId){return A}}},_isRoot:function(x){for(var y=0;y<this.roots.length;++y){if(this.roots[y].id===x){return true}}return false},getRootOptions:function(){return this.getOptions(true)},getDuplicationOptionsForThisObject:function(x){if(this._isRoot(x)){var y=this.getOptions(true);if(this.haveCatiaV5Data){return[y.translated[y.name2idx.duplicate],y.translated[y.name2idx.duplicate2]]}else{return[y.translated[y.name2idx.duplicate]]}}return this.getOptions().translated},_updateChildTreeR:function(C,x){if(x){if(C.isHardDisabled()){C.setUseHardDisabledStyle(false)}this.model.disableNode(C)}else{if(C.isHardDisabled()){C.setUseHardDisabledStyle(true)}this.model.enableNode(C)}this.model.updateCell(C,"newTitle");var A=C.getChildren()||[];if(A.length>0){var z=C.isDisabled()?C.isDisabled():false;if(!z){var B=C.getDupAction();z=B!=EnoDupTreeNodeAction.Duplicate&&B!=EnoDupTreeNodeAction.DuplicateWDrw}for(var y=0;y<A.length;++y){this._updateChildTreeR(A[y],z)}}},_updateChildTree:function(x,B){var C=B.getDupActionFromIndex(x);var y=C!=EnoDupTreeNodeAction.Duplicate&&C!=EnoDupTreeNodeAction.DuplicateWDrw;var A=B.getChildren()||[];for(var z=0;z<A.length;++z){this._updateChildTreeR(A[z],y)}this.updateTree()},_appendInstances:function(x){return this.model.appendInstances(x)},_createActionColumn:function(){var x={column:"advancedDuplicateAction",translated:g.action};var y=this;this.treeList.insertDropdownListCol(2,x.column,x.translated,function A(C,B){if(y.isConnectedToParent(C.physicalId)){B.disabled=true;B.hardDisabled=true;if(!B.disableHardDisabledStyle){B.dropdownList.advancedDuplicateAction.classList.add("hardDisabled-combo")}}return y.getDuplicationOptionsForThisObject(C.physicalId)},function z(D,B,F){var G=y.model.getModelFromTreeNode(F);var E=G.getDupActionFromIndex(B);if(E===EnoDupTreeNodeAction.DuplicateWDrw){m.dispatchEvent(duplicateWidgetEvents.includeAllDrwOptionSet,false)}var C=y._appendInstances(G);C.forEach(function(H){y.model.updateCell(H,"newTitle");y._updateChildTree(B,H)});if(y.model.getSelectedCount()>1){y.treeActionsModel.applySelectionAction(E)}},185);return x},_fixupSelIndexOnRoot:function(x,y){if(this._isRoot(y)&&this.haveCatiaV5Data){if(x===1){return this.getOptions().name2idx.duplicate2}}return x},_registerLineEditor:function(){var x=this;this.treeList.tree.getManager().registerReusableCellContent({id:"LineEditor",buildContent:function(){var z=new h({});z.getContent().addClassName("duplicate_title_lineedit");z.getContent().setStyle("max-width","none");var y=z.getContent().querySelector("input");if(y){y.setStyle("max-width","none")}else{console.error("LineEditor is missing input as child")}z.addEventListener("change",function(A){if(x.propagateTitleEditToInstances===false){return}var B=A.dsModel;B.value=B.value.trim();x._updateNewTitleOnInstances(B.nodeInfo,B.value);x.dispatchEvent("onTitleChange",B)});z.addEventListener("mousedown",function(A){A.stopPropagation()});z.addEventListener("mouseup",function(B){B.stopPropagation();var A=j(z.elements.container).find("input");A.blur();A.focus()});return z}})},_updateNewTitleOnInstances:function(x,y){if(x.instances.length<1){return}x.instances.forEach(function(A){var B=A.getNewTitle();if(A.options.occId!==x.occId&&B!==y){if(typeof A.updateInputValidation==="function"){var z=this.titleInputValidators.find(A.options.occId).getValidator();A.updateInputValidation(y)}A.setNewTitle(y)}},this)},_installCellInputValidator:function(B,y){if(!this.inputValidator){return}if(!y){return}if(!y.parentNode.parentNode){return}var z=B.nodeModel.options.occId;var x=null;if(y.hasAttribute("data-custom-id")){var C=y.getAttribute("data-custom-id");var A=this.titleInputValidators.find(C);if(A.getValidator().element===y){A.detach(y)}}if(this.titleInputValidators.contains(z)){x=this.titleInputValidators.find(z);x.attachElement(y)}else{x=this.inputValidator.inputValidator.addValidateElement(y,this.inputValidator.validators,false);x.createInfo={label:B.nodeModel.options.label,id:z};x.setCustomId(z);B.nodeModel.updateInputValidation=function(D){if(x.getValidator().element==null&&D==null){return false}};this.titleInputValidators.add(z,x)}return x},_createTitleColumn:function(){var D=this;this._registerLineEditor();var x=new v();var B=d.debounce(function(){console.log("updating - entries:",x.count());x.each(function(F,E){if(E.nodeInfo.nodeModel&&E.nodeInfo.nodeModel._parentNode){E.disabled=E.nodeInfo.nodeModel._parentNode.options.textEditdisabled;E.nodeInfo.nodeModel.options.textEditdisabled=E.disabled}});x.clear()},100);var A=function(F,E){F.nodeInfo.nodeModel=E;x.add(F.nodeInfo.nodeId,F);B()};var z=D.treeList.getCol("newTitle");z.isEditable=false;z.onCellRequest=function(N){if(!N.isHeader){var O=N.cellView.reuseCellContent("LineEditor");if(O){O.nodeInfo={nodeId:N.nodeModel.options.nodeId,occId:N.nodeModel.options.occId,instances:D.treeList.getSameNodes(N.nodeModel.options.nodeId).filter(function(P){return P.options.occId!=N.nodeModel.options.occId})};O.value=N.nodeModel.options.grid.newTitle;var M=O.elements.container.querySelector("input");var L=D._installCellInputValidator(N,M);var K=N.nodeModel.dropdownListSelectedIndex;var J=K?K.advancedDuplicateAction:0;J=D._fixupSelIndexOnRoot(J,N.nodeModel.options.physicalId);var E=D.getOptions().options;var H=E[J];var I=(H!=="duplicate"&&H!=="duplicate2")||N.nodeModel.disabled?true:false;O.disabled=I;var F=N.nodeModel.options.grid.newTitle;if(I){var G=o.getNode(D.assembly,N.nodeModel.options.nodeId);if(G.connectToParent){O.disabled=N.nodeModel._parentNode.options.textEditdisabled;A(O,N.nodeModel);if(N.nodeModel._parentNode.options.textEditdisabled){F=G.Title}}else{F=G.Title}}if(L){L.updateInputValidation(F)}N.nodeModel.options.textEditdisabled=O.disabled}}};var C=this.treeList.tree.getManager();var y=this.treeList.tree.getDocument().getAllDescendants();y.forEach(function(E){E.getNewTitle=function(){return this.options.grid.newTitle};E.setNewTitle=function(G,F){this.options.grid.newTitle=G.trim();C.setCellContent(this._rowID,"newTitle",G);C.updateCellView(this,"newTitle");if(F){D.updateTree()}}})},setDuplicateActionR:function(x,z,y){var A=this;var B=false;x.forEach(function(G){var K=G.disabled?G.disabled:false;var D=K&&!G.isSelected();var J=this.treeList.getNodeDropdownSelectedIndex(G,"advancedDuplicateAction");if(!D&&(J!=z||y)){var I=o.getNode(A.assembly,G.options.nodeId);if(!I.connectToParent){if(this.getOptions().options[z]==="duplicate2"){m.dispatchEvent(duplicateWidgetEvents.includeAllDrwOptionSet,false)}var H=this.model.getModelFromTreeNode(G);var C=this._appendInstances(H);B=true;var F=C.map(function(L){return L.treeNode._treeNode});this.treeList.setDropdownSelectionIf(F,z,"advancedDuplicateAction");C.forEach(function(L){this._updateChildTree(z,L)},this)}if(y){var E=G.getChildren()||[];this.setDuplicateActionR(E,z,y)}}},this);return B},setDuplicateAction:function(x,z,y){var A=this.treeList.tree.getManager();var B=this.setDuplicateActionR(x,z,y);if(B){this.updateTree()}},createAdvancedTree:function(){var C=this;var A=["maturityNls","revision","newTitle"];this.treeList=new l({canMultiSelect:true,getChildrenInTreeOrder:true,allCols:A,enableDragAndDrop:false,enableListSelection:true,dropdownCellFactory:function(F,E){var G=C.treeList.defaultDropdownCellFactory(F,E);G.addEventListener("DSpointerup",function(H){H.stopPropagation()});return G},onContextualEvent:{callback:function(F,G,E){if(F&&F.treeview&&F.treeview.columnID===0){var J=[];var I=F.treeview.nodeModel;var K=C.model.getModelFromTreeNode(I);J.push({type:"PushItem",title:g.expandAll,action:{callback:function(L){if(K){K.expandAll()}}}});J.push({type:"PushItem",title:g.expandNLevels,action:{callback:function(L){if(K){new n({parentContainer:C.treeList.getContent(),windowPos:F.data.windowPosition,events:{onApply:function(M){K.expandn(M)}}})}}}});J.push({type:"PushItem",title:g.collapseAll,action:{callback:function(L){if(K){K.collapseAll()}}}});if(C.debugMenuItems){var H={advancedTree:C,selNode:I};C.debugMenuItems.forEach(function(L){if(L.action&&L.action.callback){if(L.action.orgFn==null){L.action.orgFn=L.action.callback}L.action.callback=function(){L.action.orgFn(H)}}});J=J.concat(C.debugMenuItems)}return J}}}});var x=this._createActionColumn();this.treeList.load(this.assembly,["maturityNls","revision",x.column,"newTitle"],{filterDuplicates:false});this._createTitleColumn();this.treeList.insertCol(1,{text:"txt",dataIndex:"Revision",isSortable:false,type:"string",width:120});this.UpdateView=function(){C.updateTree()};this.container.style.padding="0px";if(this.expandOneLevel){this.treeList.tree.getDocument().collapseAll();this.treeList.tree.getDocument().expandNLevels(1)}m.addEvent(duplicateWidgetEvents.includeAllDrwOptionOnChange,function(G){if(G==false){return}var F=C.getOptions();var E=C.treeList.getNodes(function(I){var H=C._fixupSelIndexOnRoot(I.dropdownListSelectedIndex?I.dropdownListSelectedIndex.advancedDuplicateAction:0,I.options.physicalId);if(F.options[H]==="duplicate2"){return true}return false});C.setDuplicateAction(E.map(function(H){return H._treeNode}),F.name2idx.duplicate,false)});this.treeList.inject(this.immersiveFrame.getFreeZone());this._setupLogic();var D=new k(this.immersiveFrame,this.selectionModel,this.model);var z=new p(this.immersiveFrame,this.treeActionsModel,this.model,{canHaveDrawings:this.haveCatiaV5Data});var B=null;if(this.haveCatiaV5Data){B=new s(this.immersiveFrame,this.optionsModel)}if(!z.haveStoredPlacement()){z.panel.attachToWindow(D.panel,WUXSnapAreaEnum.InsideArea,"after")}var y=function(){D.updateUI();z.updateUI()};this.model.addEvent("OnSelChangeTree",function(E){y()});y();this.dispatchEvent("onTreeListCreated")},_setupLogic:function(){var z=this;var H=this.model;var C=this.optionsModel;var x=this.selectionModel;var A=this.treeActionsModel;var I=new c(H);x.addEvent("OnClearSelection",function(){H.clearSelection()});x.addEvent("OnAddSelection",function(J){var K=I.filterNodes(J);K.forEach(function(L){L.select()})});x.addEvent("OnRemoveSelection",function(J){var K=I.filterNodes(J);K.forEach(function(L){L.unselect()})});this.model.addEvent("onDupActionChangeTree",function(K){var J=false;K.nodes.forEach(function(N){var M=N.node.getDupAction();if(M===EnoDupTreeNodeAction.DuplicateWDrw){J=true}var L=N.node.dupActionToIndex[M];z._updateChildTree(L,N.node)});if(J){m.dispatchEvent(duplicateWidgetEvents.includeAllDrwOptionSet,false)}});var B=function(L){var J;if(typeof L.forEach==="function"){J=L}else{J=[];J.push(L)}var K=[];J.forEach(function(M){K=K.concat(M.getChildren())});K.forEach(function(M){K=K.concat(B(M))});return K};var F=function(J,M,K){var L=(K==null?A.ApplyToAll:K)?H.getAllNodes():H.getSelectedNodes();if(J&&!A.ApplyToAll){var N=B(L);L=L.concat(N)}if(M&&!A.ApplyToAll){L=H.appendInstances(L)}return L};var E=function(){return(A.ApplyToAll===false&&A.ApplyTextToChildren===true)};var D=function(M,L){var K=null;if(M.indexOf(".")!=-1){K=M.split(".").pop();M=M.replace(/\.[^/.]+$/,"")}var J=M+L;if(K){J+="."+K}return J};var y=function(L,K,J){try{H.setBatchMode(true);F(false,true,J).forEach(function(N){if(K){var M=function(P,O){P.getChildren().forEach(function(Q){M(Q,O)});P.setDupAction(O)};M(N,L)}else{N.setDupAction(L)}})}finally{H.setBatchMode(false)}};A.addEvent("OnApplyAction",function(){var K=u.groupActionToNodeAction(A.GroupAction);var J=u.groupActionToRecursive(A.GroupAction);y(K,J,A.ApplyToAll)});A.addEvent("OnApplySelectionAction",function(J){y(J,false,false)});var G=function(J,K){z.propagateTitleEditToInstances=false;J.setNewTitle(K);z.propagateTitleEditToInstances=true};A.addEvent("OnAddPrefixText",function(){F(E(),true).forEach(function(J){G(J,A.Text+J.getNewTitle())})});A.addEvent("OnAddPostfixText",function(){F(E(),true).forEach(function(J){G(J,D(J.getNewTitle(),A.Text))})});A.addEvent("OnReplace",function(){F(false,true).forEach(function(J){G(J,w.replace(J.getNewTitle(),A.FindText,A.ReplaceText))})});A.addEvent("OnReset",function(){F(false,true).forEach(function(J){z.propagateTitleEditToInstances=false;J.reset();z.propagateTitleEditToInstances=true})})},_updateTree:function(){if(!(this.treeList&&this.treeList.tree)){return}var x=this.treeList.tree.getManager();if(!x){return}x.updateView()},expandStructure:function(A,z){this.dispatchEvent("expandingStructure");var B={intent:"explore_2D",debug:false,roots:this.roots,level:"-1",source:"cstorage",authored:z,no_type_filter_rel:["XCADBaseDependency"],"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"'};var x=t.get3DSpaceWSUrl(this.tenant,"/resources/enopad/lwc/expand",null);var y=this;b.authenticatedRequest(x,{method:"POST",headers:t.getHeaders(A),timeout:600000,data:JSON.stringify(B),type:"json",onComplete:function(C){if(C.results&&C.results.length==0&&!z){console.log("expandStructure: No data in results, retrying with authored (non-index)");y.expandStructure(A,true)}else{y.expandDone(C)}},onFailure:function(C){console.error("expandStructure: onFailure -> "+C);if(!z){console.log("expandStructure: Failure with index request, retrying with authored (non-index)");y.expandStructure(A,true)}else{throw g.timeout}},onTimeout:function(){throw g.connectionTimeout}})}});return e});define("DS/DuplicateWidget/DuplicateWidget",["UWA/Controls/Abstract","DS/Utilities/TouchUtils","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls","DS/Windows/ImmersiveFrame","DS/LifecycleServices/LifecycleCommandManager","DS/LifecycleControls/DelayedMask","DS/WAFData/WAFData","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/IllegalCharMapping","DS/LifecycleServices/Utils","DS/LifecycleControls/InputValidation","DS/DuplicateWidget/AdvancedDuplicateTree","DS/DuplicateWidget/AlertBar","DS/DuplicateWidget/utils/IdNs","DS/LifecycleControls/CommandDialog","DS/LifecycleCmd/MessageMediator","DS/WidgetServices/WidgetServices","DS/LifecycleCmd/TargetFolderUtil","text!DS/DuplicateWidget/assets/html/simpledup.html","css!DS/LifecycleControls/LifecycleControls","css!DS/LifecycleControls/assets/styles/InputValidation","css!DS/DuplicateWidget/DuplicateWidget"],function(r,c,g,o,q,u,b,a,t,e,d,m,i,p,k,l,f,n,j,s){var h=r.extend({physicalid:"",selType:"",securityContext:null,context:null,tenant:null,NLVIntents:"",init:function(){var v=this;g=d.createDbgNlsProxy(g);this.illegalChars="";this.IllegalCharMapping=new e();this.securityContext=t.getCurrentFolderSecurityContext();this.duplicateOptions=[];this.commandManager=new q();this.simpleDupInputChecker=function(){if(v._SimpleDupInputValidation&&!v._SimpleDupInputValidation.isInputValid(1)){return false}return true};this.advDupInputChecker=function(){if(v.treeInputValidation.inputValidator&&!v.treeInputValidation.inputValidator.isInputValid(1)){return false}return true};this.inputChecker=this.simpleDupInputChecker},_getTargetFolderId:function(){var v=j.getTargetFolderId(this.context);try{if(t.getActiveFolder!==undefined){var w=t.getActiveFolder();if(w.id!==null){v=w.id;this.securityContex=w.sc!==""&&w.sc!==undefined?w.sc:this.securityContex;require(["DS/PlatformAPI/PlatformAPI"],function(y){y.publish("FolderEditor.ActiveFolderCallBack",{id:w.id,label:w.label})})}}}catch(x){v=j.getTargetFolderId(this.context);this.securityContex=t.getCurrentFolderSecurityContext()}return v},verifyTargetFolder:function(){this.folderId=this._getTargetFolderId();if(this.folderId===null&&t.getEnforceFolderLinkSetting()){return false}return true},executeCmd:function(w,v,x){this.addEvent("onReady",function(y){this._showCommandUI(w,y.bodyText)},this);this.addEvent("onComplete",function(y){x()});this.context=v.context;this.selType=w.length>0?w[0].type:"";if(!this.verifyTargetFolder()){throw g.noFolderSelected}this.setObjects(w)},_showCommandUI:function(B,C){var y=this;this._execDup=function(){if(!y.inputChecker()){return}if(y.commandDialog){y.commandDialog._disableUI()}v._executeDuplicate(function(E){if(E){y._saveDlgSize();x.destroy();v._onComplete()}else{x.updateUI()}})};var z=this._renderDialogContent(B[0].displayName,C);var v=this;var x=new l();var A=x.create(z,{title:g.duplicate,OKBtnText:g.duplicate,closeButton:true,imageUrl:B[0].imageUrl||"",resizable:true,powerMaximize:true,onOk:this._execDup,onClose:function(){y._saveDlgSize();v._onComplete()}});this._setupEventListeners(z);this.commandDialog=x;this.dialog=A;A.inject(widget.body);A.elements.body.setStyle("height","100%");A.elements.container.addClassName("dupDlg");if(this._isDesktopMode()){A.elements.container.setAttribute("desktop-mode","")}this.commandDialog.addEvent("widget-maxmized-changed",function(E){if(E&&y.advancedDuplicateTree&&y.advancedDuplicateTree.usingAdvancedDuplicate()){y.commandDialog.maximize()}});if(this.commandDialog){this.commandDialog.setPowermaximizeVisibility(false)}var w=330;var D=this._isDesktopMode()?180:220;A.setNewSize({width:530,height:D});setTimeout(function(){A.setMinSize(w,D)},10);this._setupSimpleDupInputValidation(B[0].name||"");this._adjustModalBody(true)},_isDesktopMode:function(){return c.getTouchMode()?false:true},_adjustModalBody:function(v){if(!this.dialog.elements||!this.dialog.elements.body){return}if(v){this.dialog.elements.body.setStyle("padding-top","2px");this.dialog.elements.body.setStyle("padding-bottom","2px");this.dialog.elements.body.setStyle("padding-left","6px");this.dialog.elements.body.setStyle("padding-right","6px")}else{this.dialog.elements.body.setStyle("padding-top","1px");this.dialog.elements.body.setStyle("padding-bottom","1px");this.dialog.elements.body.setStyle("padding-left","2px");this.dialog.elements.body.setStyle("padding-right","2px")}},_openAdvancedDup:function(v){if(!this._delayedMask){this._delayedMask=new u(v,1000,g.loadingText)}this._openAccordion(this.dialog,v)},_closeAdvancedDup:function(){this._closeAccordion(this.dialog)},_setupEventListeners:function(v){this.commandManager.addEvent("onModifyOptions",function(w){this.duplicateOptions=w.options},this);this.commandManager.addEvent("onOpenAccordion",function(w){this._openAdvancedDup(w.div)},this);this.commandManager.addEvent("onCloseAccordion",function(w){this._closeAdvancedDup()},this)},_typeHasIllegalChars:function(){return this.rootType=="VPMReference"},_setupSimpleDupInputValidation:function(w){if(!this._typeHasIllegalChars()){return}this._SimpleDupInputValidation=new m();var v=this.dialog.elements.body.querySelector("#enolcm-dup-simple-addtext-input > input");if(!v){return}var x=this.dialog.elements.footer.querySelector("button.btn-primary");this._SimpleDupInputValidation.addValidateElement(v,this._getInputValidators(w.length),false,1);this._SimpleDupInputValidation.addSubmitElement(x,1)},_renderDialogContent:function(z,C){var x=UWA.createElement("div",{"class":"duplicate_popup"});var w=this;this.simpleDupViewModel={includeChildren:true,text:"",useAdvanced:false,openAdvanced:function(){w.simpleDupViewModel.useAdvanced=true;w._openAdvancedDup(D)},closeAdvanced:function(){w.simpleDupViewModel.useAdvanced=false;w._closeAdvancedDup()},onIncludeChildrenChange:function(E,F){w.simpleDupViewModel.includeChildren=E},onTextChange:function(G,E,F){w.simpleDupViewModel.text=G},duplicate:function(){w._execDup()}};var v=new k(x,"enolcm-dup-simple-");this.idns=v;v.elementFromTemplate(s,null,g,this.simpleDupViewModel).inject(x);v.getElById("infotext").textContent=C;var D=v.getElById("advanced-content");var A=function(F){var E=v.getElById(F);E.parentElement.removeChild(E)};var B=this._getOptionsHelper(this.duplicateOptions);if(!B.prefix()){A("addtext-container")}else{setTimeout(function(){var E=v.getElById("addtext-input").querySelector("input");E.setSelectionRange(0,E.value.length);E.focus()},100)}var y=B.defaultPrefix();if(y){v.getElById("addtext-input").querySelector("input").value=y;this.simpleDupViewModel.text=y}if(!B.wholeStructure()){A("wholestructure")}if(!B.advanced()){A("advanced-content");A("expander");A("collapser")}this.HTMLContent=x;return x},_getOptionsHelper:function(v){var w=r.extend({init:function(x){this.dupOpts=x},prefix:function(){return this._findKey("prefix").length!==0},defaultPrefix:function(){if(!this.prefix()){return null}return this._findKey("prefix")[0].value},setPrefix:function(y){for(var x=0;x<this.dupOpts.length;x++){if(this.dupOpts[x].key==="prefix"){this.dupOpts[x].value=y.length>0?y:null}}},wholeStructure:function(){return this._findKey("wholeStructure").length!==0},setWholeStructure:function(y){for(var x=0;x<this.dupOpts.length;x++){if(this.dupOpts[x].key==="wholeStructure"){this.dupOpts[x].value=y}}},advanced:function(){return this._findKey("advanced").length!==0},setUseAdvanced:function(y){for(var x=0;x<this.dupOpts.length;x++){if(this.dupOpts[x].key==="advanced"){if(y!==false||this.dupOpts[x].usingAdvancedDuplicate===true){this.dupOpts[x].usingAdvancedDuplicate=y}}}},_findKey:function(x){return this.dupOpts.filter(function(y){return y.key===x})}});return new w(v)},_updateOptionsFromViewModel:function(){if(!this.simpleDupViewModel){return}var v=this._getOptionsHelper(this.duplicateOptions);v.setWholeStructure(this.simpleDupViewModel.includeChildren);v.setPrefix(this.simpleDupViewModel.text);v.setUseAdvanced(this.simpleDupViewModel.useAdvanced);this.duplicateOptions=v.dupOpts},_getInputValidators:function(w){var x=this;var v=w||0;return[{name:"illegalChars",validate:function(y){return x.strIsLegal(y)},getErrorInfo:function(y){return g.replace(g.illegalText,{illegalChars:x.illegalChars})}},{name:"maxChars",validate:function(y){return y.length+v<=100},getErrorInfo:function(y){return g.dupTooLongTitle}}]},_createAdvancedDuplicateTree:function(){var w=this;var v=new i({roots:[this.physicalid],tenant:this.tenant,inputValidator:this.treeInputValidation,idns:this.idns});this.advancedDuplicateTree=v;this.advancedDuplicateTree.immersiveFrame=this.immersiveFrame;if(this.debugMenuItems){v.debugMenuItems=this.debugMenuItems}v.addEvent("expandingStructure",function(x){if(w.okBtn){w.okBtn.disabled=true}});v.addEvent("onTreeListCreated",function(x){if(w._delayedMask){w._delayedMask.unmask()}v.treeList.onInitialUpdateView().then(function(){w.treeInputValidation.inputValidator.updateValidation();w.inputChecker=w.advDupInputChecker});if(v.translationService.translationFailure){w.showNotification("Translation failed")}});this._createAlertBar();return v},_createAlertBar:function(){var v=new p().inject(this._getDialogElement("advdup-content"),"top");f.addEvent("Lifecycle.Duplicate.Alert",function(w){v.show(w)})},_createTreeInputValidator:function(x){var w={inputValidator:new m(),validators:this._getInputValidators()};w.inputValidator.setCustomCSS({inputCSS:"tree-invalid-input",infoIconCSS:"tree-info-icon-invalid-input"});var v=x.getContainer?x.getContainer():x.elements?x.elements.container:null;this.okBtn=v?v.querySelector(".btn-primary"):null;if(this.okBtn){w.inputValidator.addSubmitElement(this.okBtn)}return w},_getSecurityContext:function(){if(this.securityContex){return UWA.Class.Promise.resolve(this.securityContext)}else{return a.getSecurityContextPromise(this.tenant,this.context)}},_createImmersiveFrame:function(v){var w="4046f1f2-6823-11e9-a923-1681be663d3e";if(window.c145ae486a7011e9a9231681be663d3e){w=undefined}var y=new o({identifier:w});y.dockingElements.forEach(function(z){if(z._properties.side.value===WUXDockAreaEnum.TopDockArea||z._properties.side.value==WUXDockAreaEnum.BottomDockArea){z._properties.dockingZoneSize.value=120}else{if(z._properties.side.value===WUXDockAreaEnum.LeftDockArea||z._properties.side.value==WUXDockAreaEnum.RightDockArea){z._properties.dockingZoneSize.value=230}}});var x=UWA.createElement("div",{"class":"immersive-frame-parent"});x.inject(v);y.inject(x);return y},_openAccordion:function(x,v){var w=this;if(this.commandDialog){this.commandDialog.setPowermaximizeVisibility(true)}if(!this.immersiveFrame){this.immersiveFrame=this._createImmersiveFrame(v)}if(this.treeInputValidation){this.treeInputValidation.inputValidator.updateValidation();this.inputChecker=this.advDupInputChecker}this.treeInputValidation=this.treeInputValidation||this._createTreeInputValidator(x);this.advancedDuplicateTree=this.advancedDuplicateTree||this._createAdvancedDuplicateTree();this._getSecurityContext().then(function(y){w.securityContext=y;w.disableWholeStructureCheckbox();w.setPrefixOrSuffixEditDisabledState(true);w.inputValidation=w.inputValidation||new m(v,w._getInputValidators());var z=UWA.createElement("div",{"class":"duplicate_tree_container"});v.appendChild(z);w.advancedDuplicateTree.openAdvancedTree(z,x,y);w._adjustDialogSizeLarge(x);x.centerIt();w._adjustModalBody(false)})},_adjustDialogSizeLarge:function(x){if(this.dialog.isMaximized){return}var w=this._loadSize("advDupLarge");var v=this._getCurrentSize(x);this._storeSize("advDupSmall",v);x.setNewSize(w?{width:w.width,height:w.height}:{width:v.width*2,height:480});if(this.commandDialog&&this.commandDialog.isWidgetMaximized()){this.commandDialog.maximize()}},_adjustDialogSizeSmall:function(x){if(this.dialog.isMaximized){return}var w=this._loadSize("advDupSmall");var v=this._getCurrentSize(x);this._storeSize("advDupLarge",v);x.setNewSize(v?{width:w.width,height:w.height}:{})},_closeAccordion:function(v){if(this.commandDialog){this.commandDialog.setPowermaximizeVisibility(false)}if(this._SimpleDupInputValidation){this._SimpleDupInputValidation.updateValidation()}this.inputChecker=this.simpleDupInputChecker;this.advancedDuplicateTree.closeAdvancedTree();this.enableWholeStructureCheckbox();this.setPrefixOrSuffixEditDisabledState(false);this._adjustDialogSizeSmall(v);this._adjustModalBody(true)},_getCurrentSize:function(w){var v=w.getModalBodySize();v.height=w.getContainerHeight();return v},_saveDlgSize:function(){var v="advDupSmall";if(this.advancedDuplicateTree&&this.advancedDuplicateTree.usingAdvancedDuplicate()){v="advDupLarge"}var w=this._getCurrentSize(this.dialog);this._storeSize(v,w)},_loadSize:function(v){var w=widget.getValue(v);if(!w){return null}return JSON.parse(w)},_storeSize:function(w,v){if(!widget.getValue(w)){widget.addPreference({name:w,type:"hidden",defaultValue:"{}"})}widget.setValue(w,JSON.stringify(v))},_onComplete:function(){this.dispatchEvent("onComplete",{})},_getDialogElement:function(v){if(!this.HTMLContent){return null}return this.HTMLContent.getElementsByClassName(v)[0]},getWholeStructureCheckbox:function(){return this._getDialogElement("lifecycle-option-wholeStructure")},getPrefixOrSuffixEdit:function(){var v=this._getDialogElement("lifecycle-option-suffix");if(!v){v=this._getDialogElement("lifecycle-option-prefix")}return v},enableWholeStructureCheckbox:function(){var v=this.getWholeStructureCheckbox();if(!v){return}v.disabled=false;v.checked=this.wholeStructureCheckboxSaved},disableWholeStructureCheckbox:function(){var v=this.getWholeStructureCheckbox();if(!v){return}v.disabled=true;this.wholeStructureCheckboxSaved=v.checked;v.checked=false},setPrefixOrSuffixEditDisabledState:function(v){var w=this.getPrefixOrSuffixEdit();if(!w){return}w.disabled=v},setObjects:function(A){var y=this;if(A.length===0){throw g.noObject}if(A.length!==1){throw g.multipleSelection}var x=A[0];if(x.hasOwnProperty("physicalid")&&x.physicalid===""){throw g.epmtyPhysicalId}this.physicalid=x.physicalid;var v=x.displayName;this.tenant=x.tenant;this.commandManager.setTenant(this.tenant);this.commandManager.addEvent("onCompleteGetOptions",function(B){this.duplicateOptions=B.options;this.rootType="";try{this.rootType=B.objects[0].type}catch(B){}var C=g.doDuplicate+v+g.questionMark;if(typeof B.options!="undefined"){B.options.forEach(function(D){if(D.key==="suffix"){C=g.doDuplicateSuff+v}else{if(D.key==="prefix"){C=g.doDuplicatePre+v}else{if(D.key==="NLV"){this.NLVIntents=D.value}}}},this)}B.objects=B.objects||[];B.objects.forEach(function(F){var D=F.CADOrigin||"CATIAV5";var E="";if(D==="CATIAV5"){E=":!"}y.IllegalCharMapping.addCADType(D,E)});console.log("BEGIN: Getting illegal char mappings");this.IllegalCharMapping.getMappings().then(function(D){console.log("END: Getting illegal char mappings");y.illegalChars=D.find("CATIAV5")||"";y.dispatchEvent("onReady",{bodyText:C})})},this);try{var z=this;document.body.style.cursor="wait";var w={data:[{physicalid:this.physicalid}],command:"duplicate"};this.commandManager.getOptions(w,function(B){z.showError(B);z._onComplete()},this.context)}finally{document.body.style.cursor="default"}},_maskDialog:function(){var w=null;var x=this.dialog.getContainer?this.dialog.getContainer():this.dialog.elements?this.dialog.elements.container:null;if(x){var v=x.querySelector("#enolcm-dup-simple-mainContainer");if(v){w=new u(UWA.extendElement(v),1000,g.duplicatingText)}}return{unmask:function(){if(w){w.unmask()}}}},_generateDuplicateServiceReqPayload:function(){var w=this.getDuplicateData();var v=false;if(this.usingAdvancedDuplicate()){v=this.advancedDuplicateTree.optionsModel.IncludeDrawings}return{data:w,options:this.duplicateOptions,folderid:this.folderId,NLVEnabled:this.NLVIntents&&this.NLVIntents.length>0,includeDrawings:v}},_executeDuplicate:function(z){if(!this.verifySuffix()||!this.verifyPrefix()){z(false);return}if(!this.verifyTargetFolder()){this.showError(g.noFolderSelected);z(false);return}var y=this._generateDuplicateServiceReqPayload();if(!this.verifyTitle(y.data)){z(false);return}var v=this._maskDialog();var w=function(){document.body.style.cursor="default";v.unmask();z(true)};var x=this;this._getSecurityContext().then(function(A){x.duplicateServiceRequest(y,A,w)})["catch"](function(A){var B=a.parseWebServiceError(A);x.showError(B)})},getDuplicateOptionValue:function(w){for(var v=0;v<this.duplicateOptions.length;++v){if(this.duplicateOptions[v].key===w){return this.duplicateOptions[v].value}}},getDuplicateOptionNlsKey:function(x){for(var w=0;w<this.duplicateOptions.length;++w){if(this.duplicateOptions[w].key===x){var v=this.duplicateOptions[w].nlsKey.substring(0,this.duplicateOptions[w].nlsKey.length-1);return v}}},strContainsNonASCII:function(x){if(x){for(var w=0;w<x.length;++w){var v=x.charCodeAt(w);if(v>127){return true}}}return false},strContainsIllegalChars:function(w,v){if(w){if(n.commonChar(w,this.illegalChars,true)>0){return true}}return false},strIsLegal:function(v){return !this.strContainsIllegalChars(v,this.illegalChars)},verifyDuplicationString:function(w,v){if(w==null){return true}if(!this.strIsLegal(w)){this.showError(g.replace(g.illegalChar,{label:v,illegalChars:this.illegalChars}));return false}return true},verifySuffix:function(){var w=this.getDuplicateOptionValue("suffix");var v=this.getDuplicateOptionNlsKey("suffix");if(!this.verifyDuplicationString(w,v)){return false}if(this.strContainsNonASCII(w)){this.showError(g.replace(g.nonAsciiChar,{label:v}));return false}return true},verifyPrefix:function(){return this.verifyDuplicationString(this.getDuplicateOptionValue("prefix"),this.getDuplicateOptionNlsKey("prefix"))},verifyTitle:function(v){if(!this.usingAdvancedDuplicate()){return true}if(v.some(function(w){if(w.operation!=="duplicate"){return false}return !this.strIsLegal(w.title)},this)){this.showError(g.replace(g.illegalTitle,{illegalChars:this.illegalChars}));return false}return true},usingAdvancedDuplicate:function(){if(!this.advancedDuplicateTree){return false}return this.advancedDuplicateTree.usingAdvancedDuplicate()},getDuplicateData:function(){if(this.usingAdvancedDuplicate()){return this.advancedDuplicateTree.getTreeNodesData()}else{return[{physicalid:this.physicalid}]}},showNotification:function(v,x){if(this.context&&typeof this.context.displayNotification==="function"){var w={eventID:typeof x==="string"?x:"primary",msg:v};this.context.displayNotification(w)}else{alert(v)}},showError:function(x){if(this.context&&typeof this.context.displayNotification==="function"){var w=x.message||x;var v={eventID:"error",msg:w};this.context.displayNotification(v)}else{alert(x)}},duplicateServiceRequest:function(z,C,w){var A=this;this._updateOptionsFromViewModel();var B=JSON.stringify(z);var v=t.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/duplicate/structure");var x=t.getHeaders(C);var D=function(H){w();if(H!==undefined&&H!==null&&H.hasOwnProperty("status")){if(H.status==="failure"){if(H.hasOwnProperty("report")&&H.report.length!==0){A.showError(H.report[0].error)}else{A.showError(g.duplicateFailed)}return}else{A.showNotification(g.duplicateSuccessful);if(H.hasOwnProperty("report")&&H.report.length!==0){A.showNotification(H.report[0].error)}}}var K=A.getCreatedObjectsToDisplay(H.results);var I={created:[],deleted:[],modified:[]};I.context=A.context;for(var G=0;G<K.length;++G){var J={physicalid:K[G].physicalid,sourceObjectId:K[G].sourceid?K[G].sourceid:z.data[G].physicalid,operation:"Duplicate"};var F=[A.folderId];J.folders=F;I.refreshFolder=true;I.created.push(J)}f.dispatchEvent("onModification",I)};var y=function(G,F){w();a.showWebServiceError(G,F,function(H){A.showError(g.duplicateFailed+"<br>"+H)});console.log("Duplicate failed:",G,F)};var E=function(H,F,G){w();A.showError(g.timeout);console.log("Duplicate: Timeout error")};document.body.style.cursor="wait";b.authenticatedRequest(v,{method:"POST",headers:x,timeout:1000*60*60*6,onComplete:D,data:B,onFailure:y,ontimeout:E,type:"json"})},isDerivedFrom:function(x,y){if(typeof y==="undefined"){return false}var w=y["attribute[PLMReference.V_DerivedFrom]"];var v=y.derivedFromPhysicalid;if(w===x||v===x||y.sourceid===x){return true}return false},getCreatedObjectsToDisplay:function(x){var y=[];for(var w=0;w<x[0].length;w++){var v=x[0][w];if(v.isRoot&&v.isRoot===true){y.push(v)}else{if(this.isDerivedFrom(this.physicalid,v)){y.push(v)}}}if(y.length===0){y.push(x[0][0])}return y}});return h});