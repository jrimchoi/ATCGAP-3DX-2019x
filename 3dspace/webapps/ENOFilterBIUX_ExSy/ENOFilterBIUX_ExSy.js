define("DS/ENOFilterBIUX_ExSy/ExSy_FBIComponentProxy",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Controls/Toggle","DS/TagNavigatorProxy/TagNavigatorProxy","DS/ENOFilterBIUX/Abstract_FBIComponentProxy","DS/ENOFilterBIUX/BIEngine","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/ENOFilterBIUX/FBIProxyServices","DS/ENOFilterBIUX/NGFServices","UWA/Promise","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOFilterBIUX/assets/nls/ENOFilterBIUX","DS/Utilities/Utils"],function(p,q,i,e,k,l,s,j,r,o,h,d,n,m,c,b,g,a){var f=r.extend({init:function(t){this._parent(t)},filterBIFilter:function(x,w){var v=this;if(this._taggerUpdatedFromFilter){this._taggerUpdatedFromFilter=false;v.setTags(null,null,null)}else{this._currentTags=x;var u=this._needsFiltering(this._currentTags,this._appliedTags);if(true===w||u){this._nbRootsWithTags=this._arrayRootsInSession.length;this._objFilteredRootsInSession.tagData=x;if(!this._nbRootsWithTags){this.myTagProxy.unsetTags()}for(var t=0;t<v._arrayRootsInSession.length;t++){this._fromBIFilterToNGFUX({rootID:v._arrayRootsInSession[t],tagData:v._objFilteredRootsInSession.tagData,NGFState:"createFromTag"})}}else{this._setTagsWithFilteredExpandSynthesis(this._objFilteredRootsInSession)}}},setTagsWithExpandSynthesis:function(v,t){var w=this;this._applyNGFilterCount=0;m.setAppQueryParam(t);if(v.length){this._keepRootsInSession(v);if(this._objFilteredRootsInSession.tagData&&Object.keys(this._objFilteredRootsInSession.tagData).length&&Object.keys(this._objFilteredRootsInSession.tagData.allfilters).length){this.filterBIFilter(this._objFilteredRootsInSession.tagData,true,v)}else{for(var u=0;u<v.length;u++){this._updateFilteredStructure(v[u])}this._setTagsWithFilteredExpandSynthesis(this._objFilteredRootsInSession)}}else{w.setTags(null,null)}},_setTagsWithFilteredExpandSynthesis:function(t){var u=this;if(t.filteredRoots.length){m.filteredExpandWithSynthesis(this._tenantId,t,this._ngExpand).then(function(v){u.setTags(null,v,null)})}else{u.setTags(null,[])}},setSynthesisMode:function(t){if("occurrence"===t||"flat"===t){d.setOption("synthesis_mode",t)}else{console.log("BiProxy, setSynthesisMode, non supported synthesisMode : "+t)}},onApplyNGFilter:function(u){var t=this.optionsToKeep.appId;if(u.appId!==t){console.log("debug RCI onApplyNGFilter, currentAppId = "+t+" , widget NG Filter = "+u.appId)}else{if(u.CVQuery){u=this.completeCVQueryWithAppParams(u,this.optionsToKeep.expandIterParam,this._expandSynthesisON);this._applyNGFilterCount++;this._fromDropOnFilter=undefined;if(u.empty){if(this._objFilteredRootsInSession.filteredRoots&&0===this._objFilteredRootsInSession.filteredRoots.length){return}else{if(-1!==this._arrayRootsInSession.indexOf(u.filterRootIds[0])){this._updateFilteredStructure(u.filterRootIds[0])}}}else{this._keepRootsInSession(u.filterRootIds);this._updateFilteredStructure(u.filterRootIds[0],u)}console.log(u);if(this._currentTags){this._appliedTags=this._currentTags}if(u.empty||m.getCombinationQuery(u.CVQuery)){this.dispatchEvent("ApplyNGFilterAbstract",u);sessionStorage.setItem("NGF_tagMgtRunning_"+u.filterRootIds[0],false)}if(!this._nbRootsWithTags||this._nbRootsWithTags===this._applyNGFilterCount||(u.empty&&0===this._arrayRootsInSession.length)){this._setTagsWithFilteredExpandSynthesis(this._objFilteredRootsInSession);this._applyNGFilterCount=0}else{this.myTagProxy.unsetTags()}}}},filterBIColorize:function(t){if(t.tagColors&&t.tagColors.length>0){this.dispatchEvent("FilterBIColorizeEvent",t);return}},_needsFiltering:function(t,v){var u=function(y,x){if(((undefined===y||(y&&0===Object.keys(y).length))&&undefined===x)||(y&&0===Object.keys(y).length)&&(x&&0===Object.keys(x).length)){return true}else{if(y&&Object.keys(y).length&&(undefined===x||(x&&0===Object.keys(x).length))){return false}else{if(y&&x&&Object.keys(y).length!==Object.keys(x).length){return false}}}for(var w in y){if(undefined===x[w]||!x[w]){return false}if(JSON.stringify(y[w])!==JSON.stringify(x[w])){return false}}return true};if(u(t.allfilters,v.allfilters)&&u(t.localfilters,v.localfilters)){return false}else{return true}},removeRoot:function(t){var u=this;this._parent(t);this._cleanRootsInSession(t);this._cleanFilteredStructure(t);var v=a.debounce(function(w){u._setTagsWithFilteredExpandSynthesis(u._objFilteredRootsInSession)},200);v()},});return f});