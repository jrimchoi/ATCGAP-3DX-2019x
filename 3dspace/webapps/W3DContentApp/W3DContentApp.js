define("DS/W3DContentApp/Views/UploadInodesView/taskView",["UWA/Core","UWA/Class/View","i18n!DS/W3DContentApp/assets/nls/W3DContentApp"],function(f,e,d){function a(k,j,l){if(!(k instanceof window.HTMLElement)||!j){return false}var i=j.progress;var o=j.isCancelled;var p=j.isError;var q=(i===0);var m=(i===100);var n=k.querySelector(".status");if(!Array.isArray(n)){n=n?[n]:[]}if(m){var r=l.get("createdDate")!==l.get("modifiedDate")?d.updated:d.completed;n.map(function(s){s.setText(r)});k.removeClassName("processing");k.addClassName("completed");return true}if(p){n.map(function(s){s.setText(d.error)});k.removeClassName("processing");k.addClassName("error");return true}if(q){n.map(function(s){s.setText(d.pending)});k.removeClassName("processing");k.addClassName("pending");return true}if(o){n.map(function(s){s.setText(d.cancelled)});k.removeClassName("processing");k.addClassName("cancelled");return true}}function b(j,n){if(!(j instanceof window.HTMLElement)||!n){return false}var l=n.progress;var m=j.querySelector("progress");var i=m.parentElement;if(0<l&&l<100){i.classList.add("processing")}var k=m?[m]:[];return !!k.map(function(o){o.value=l})}function h(i,k){if(!(i instanceof window.HTMLElement)||!k){return false}var l=k.title,j=i.querySelector(".title");if(!Array.isArray(j)){j=j?[j]:[]}return !!j.map(function(m){m.textContent=l})}function g(j,i){if(j||!i||!i.dispatchEvent){return false}i.dispatchEvent("onCancel");return true}function c(s,k){var q=new e(Object.assign({className:"w3ddrive task-view"},s)),i={isCancelled:false};var r=q.destroy;function l(){var t=a(q.container,Object.assign({},i,s),k);if(t){q.dispatchEvent("onFinish",[q])}return t}function o(){return b(q.container,s)}function n(){return h(q.container,s)}function j(){q.container.setContent([f.createElement("div",{"class":"title"}),f.createElement("progress"),f.createElement("div",{"class":"status"}),f.createElement("i",{"class":"cancel-btn"})]);l();n();o()}function p(t){if(!t){return}i.isCancelled=!!t;g(i.isCancelled,q);l()}function m(t){if(!t){return}i.isError=!!t;l()}q.delegateDOMEvents({"click .cancel-btn":function(){p(true)}});return Object.assign(q,{render:j,refreshStatus:l,refreshProgress:o,refreshTitle:n,refreshCancel:p,refreshError:m,destroy:function(){q.stopListening();q.container=null;q.model=null;q.undelegateDOMEvents();return r.apply(q,arguments)}})}return c});define("DS/W3DContentApp/Views/InodePreView/lightboxPreviewImg",["UWA/Class/Promise","css!DS/W3DContentApp/W3DContentApp.css"],function(e){function b(i,h){var g=i;if(!g.classList.contains(h)){g=g.querySelector("."+h)}return g}function d(h,i){var g=b(h,"preview-img");return new e(function(m,l){function j(){g.removeEventListener("load",j);m(h)}function k(){g.removeEventListener("error",k);l(h)}g.addEventListener("load",j);g.addEventListener("error",k);g.setAttribute("src",(i||""))})}function c(h){var g=document.createElement("img");g.classList.add("preview-img");d(g,h);return g}var a;function f(g){function h(j){if(!j){return e.resolve()}var i=j.getDefaultThumbnail();return j.getThumbnailLink().then(function(k){return d(a,k.large)})["catch"](function(){return d(a,i)})}g=g||{};if(a){h(g.inode);return a}a=Object.assign(c(g.inode),{refresh:h});h(g.inode);return a}return{refreshPreviewBodyImg:d,getPreviewImg:c,init:f}});define("DS/W3DContentApp/Views/InodePanelView/inodeItemView",["UWA/Utils","DS/W3DDrive/InodeActions","DS/W3DDrive/Utils/CompassHelpers","DS/W3DContentApp/Views/itemView"],function(d,e,a,b){function c(h){var k=h.model,l={model:k,cid:k.cid,withSelectionIcon:true},j=new e({model:k,context:"item-view"}),g,f;function i(){var m={id:"id",image:function(o){var n=o.get("thumbnailLink");if(n){n=n.medium}return n},title:"title",metas:function(s){var r=[s.getOwnerNames()];var o=s.get("modifiedDate");if(!o){return r}var n=new Date(s.get("modifiedDate"));var q=n.toISOString().split(/-|T/);q.pop();var p=q.shift();q.push(p.slice(-2));return r.concat(q.join("/"))},description:"description",icon:"icon"};Object.keys(m).map(function(o){var n;if(typeof m[o]==="function"){n=m[o](k)}else{n=k.get(m[o])}l[o]=n});l.actions=j.toJSON()}i();g=b(l);f=g.destroy;g.container.addEvent("dragstart",function(m){m.dataTransfer.setData("text",JSON.stringify(a.get3DXContent([k])))});g.listenTo(k,{"onChange:thumbnailLink":function(){d.setImmediate(function(){g.refreshImg()})},onChange:function(){i();d.setImmediate(function(){g.refreshContent()})},"onChange:actions":function(){var m=new e({model:h.model,context:"item-view"}).toJSON();d.setImmediate(function(){g.refreshActions(m)})}});g.container.addClassName("inode-item");g.container.dataset.model_cid=k.cid;g.container.dataset.view_cid=g.cid;return Object.assign(g,{destroy:function(){g.container.removeEvents();g.stopListening();return f.apply(g,arguments)}})}return c});define("DS/W3DContentApp/Utils/stopPropagationDropdownMenu",["DS/UIKIT/DropdownMenu"],function(a){return a.extend({_handleItemClick:function(c,b){this._parent(c,b);c.stopPropagation()}})});define("DS/W3DContentApp/Views/UploadInodesView/tasksView",["UWA/Core","UWA/Class/View","css!DS/UIKIT/UIKIT.css"],function(g,f){function d(h){if(!(h instanceof window.HTMLElement)){return}var i=h.parentNode||h;i.classList[h.firstChild?"remove":"add"]("hidden")}function e(h,i){if(!(h instanceof window.HTMLElement)){return}i=Array.isArray(i)?i:[i];i.map(function(j){return h.appendChild(j)});d(h)}function c(h,i){if(!(h instanceof window.HTMLElement)){return}i=Array.isArray(i)?i:[i];i.filter(function(j){return h.contains(j)}).map(function(l,k,j){setTimeout(function(){h.removeChild(l);if(k===j.length-1){d(h)}},3000)})}function a(h,i){if(!(h instanceof window.HTMLElement)){return}h.childNodes.map(function(j){h.removeChild(j)});e(h,i)}function b(k){var i;i=new f(Object.assign({className:"w3ddrive tasks-view popover"},k,{domEvents:{"click .cancel-all-btn":function(){i.dispatchEvent("onCancelAll")},"click .minimize-btn":function(){var p=i.container.getElement(".minimize-btn"),o=p.hasClassName("fonticon-down-open");p[(o?"remove":"add")+"ClassName"]("fonticon-down-open");p[(o?"add":"remove")+"ClassName"]("fonticon-up-open");i.container.toggleClassName("minimized")}}}));function m(){return i.container.getElement(".popover-body")}function h(o){return e(m(),o)}function l(o){return c(m(),o)}function j(o){return a(m(),o)}function n(){i.container.setContent([g.createElement("div",{"class":"popover-arrow"}),g.createElement("div",{"class":"popover-title",html:[{tag:"div","class":"title",text:k.title||""},{tag:"div","class":"cancel-all-btn",text:"cancel all"},{tag:"i","class":"minimize-btn fonticon fonticon-down-open"}]}),g.createElement("div",{"class":"popover-body",html:k.children})]);d(m())}return Object.assign(i,{render:n,addChildren:h,removeChildren:l,resetChildren:j})}return b});define("DS/W3DContentApp/Utils/Helpers",["UWA/Core","i18n!DS/W3DContentApp/assets/nls/W3DContentApp"],function(c,b){var a={result:function(d,f){var e;if(d){e=d[f];if(c.is(e,"function")){e=e.call(d)}}return e},replaceWith:function(d,f){if(d){var e=d.getParent();if(e){if(f){e.replaceChild(f,d)}else{d.destroy()}return f}}return false},filterXSS:function(d){return d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},computeFileExtension:function(e){if(!(typeof e==="string"||e instanceof String)){return""}var d={catanalysis:"CATAnalysis",catdrawing:"CATDrawing",catmaterial:"CATMaterial",catpart:"CATPart",catprocess:"CATProcess",catproduct:"CATProduct",catshape:"CATShape",catsystem:"CATSystem"};return d.hasOwnProperty(e.toLowerCase())?d[e.toLowerCase()]:e.toUpperCase()},computeNLSSize:function(g){var d;var i;if(isNaN(g)){throw new Error("Size input is not a number")}var f=["sizeB","sizeKB","sizeMB","sizeGB","sizeTB","sizePB"];var h=Number(g);if(h<0){throw new Error("Size input is negative")}if(h===0){d=0;i=0}else{i=Math.floor(Math.log(h)/Math.log(1000));if(i>5){throw new Error("Size input is too big")}var j=h/Math.pow(1000,i);d=Math.round(j*100)/100}return b.replace(b[f[i]],{size:d})},getActionIds:function(e){if(!e){return[]}e=[].concat(e);if(!e.length){return[]}var d=e.map(function(f){return f.getActionIds(true)});if(!d.length){return d}return d.reduce(function(g,f){return g.filter(function(h){return(f.indexOf(h)!==-1)})})},listenToHierarchy:function(d,f,e){if(f.collection&&f.collection._parentInode){d.listenTo(f.collection._parentInode,e);a.listenToHierarchy(d,f.collection._parentInode,e)}},getDateStr:function(e){var g=e.getMonth()+1;var f=e.getMinutes();var d=e.getFullYear()+"/"+((g<10)?("0"+g):g)+"/"+e.getDate()+" "+e.getHours()+":"+((f<10)?("0"+f):f);return d}};return a});define("DS/W3DContentApp/Utils/drawerOrchestrator",["css!DS/W3DDrive/W3DDrive.css"],function(){function a(f){var h=0;var b=f.parentNode;var g=b.getBoundingClientRect();var e=g.width;f.style.position="absolute";f.style.width="2000px";f.style.left="100%";f.style["will-change"]="transform";function j(){if(h<=0){return}f.children[0].style.width=h+"px";f.children[0].style["margin-right"]="auto";f.children[0].style["margin-left"]=0}function c(k){if(h===k){return}f.classList.remove("animate-on-transforms");f.style.transform="translateX(-"+k+"px)";h=k;requestAnimationFrame(j)}function i(l){if(h===l){return}f.classList.add("animate-on-transforms");f.style.transform="translateX(-"+l+"px)";h=l;function k(){f.removeEventListener("transitionend",k);f.classList.remove("animate-on-transforms");requestAnimationFrame(j)}f.addEventListener("transitionend",k)}function d(){return h}return{refreshInnerDrawer:j,translateNoAnim:c,translateAnim:i,getOpenedWidth:d}}return a});define("DS/W3DContentApp/Views/SuperModal",["DS/UIKIT/SuperModal","css!DS/UIKIT/UIKIT.css"],function(b){var a=new b({className:"w3ddrive",closable:true,renderTo:document.body});var c=a.modalFactory;var d=function(e){e.stopPropagation()};a.modalFactory=function(){var f=c.apply(this,arguments);var e=f.elements.container;f.onShowModal=function(){a.next();e.addEventListener("click",d)};f.onHide=function(){setTimeout(function(){e.removeEventListener("click",d)})};return f};return a});define("DS/W3DContentApp/BusEvent",["UWA/Class/Events"],function(a){return new a()});define("DS/W3DContentApp/SearchProxy",["UWA/Core","UWA/Class","UWA/Class/Events"],function(d,b,a){var c;c=new a();c=d.extend(c,{getQuery:function(){return this._query},setQuery:function(e){console.log("query = "+e);this._query=e;this.dispatchEvent("onSetQuery",[e])},resetQuery:function(e){e=e||{};delete this._query;if(!e.silent){this.dispatchEvent("onResetQuery")}}});return c});define("DS/W3DContentApp/Views/UploadInodesView/taskViewSet",["DS/WebAppsFoundations/Views/Plugins/Set"],function(a){return new a()});define("DS/W3DContentApp/Utils/SetOfSelectedView",["UWA/Core","DS/WebAppsFoundations/Views/Plugins/Set"],function(d,c){var b,a;a={NULL_TO_ONE:"nullToOne",ONE_TO_ONE:"oneToOne",NULL_TO_MANY:"nullToMany",ONE_TO_MANY:"oneToMany"};b=c.extend({mode:a.ONE_TO_ONE,init:function(e,f){var g;this.enable();f=f||{};g=this._parent.apply(this,arguments);if(f.disabled){this._enabled=false}return g},enable:function(){this._enabled=true;return this},disable:function(){this._enabled=false;return this},set:function(e,f){f=f||{};if(!f.force&&!this._enabled){return}return this._parent.apply(this,arguments)},add:function(e,f){var g;f=f||{};g=this.mode;if(!Array.isArray(e)){e=(e?[e]:[])}if(!f.force){switch(g){case a.ONE_TO_ONE:if(e.length&&e.length>1){throw new Error("Use the force option if you want an unexpected mode behaviour")}return this.set(e,d.extend({merge:false},f));default:break}}return this._parent.apply(this,arguments)}});return b});define("DS/W3DContentApp/Utils/getKeyboardeventKey",[],function(){var c={3:"Cancel",6:"Help",8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",28:"Convert",29:"NonConvert",30:"Accept",31:"ModeChange",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",41:"Select",42:"Print",43:"Execute",44:"PrintScreen",45:"Insert",46:"Delete",48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],91:"OS",93:"ContextMenu",144:"NumLock",145:"ScrollLock",181:"VolumeMute",182:"VolumeDown",183:"VolumeUp",186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"'],224:"Meta",225:"AltGraph",246:"Attn",247:"CrSel",248:"ExSel",249:"EraseEof",250:"Play",251:"ZoomOut"};var a;for(a=1;a<25;a++){c[111+a]="F"+a}var b="";for(a=65;a<91;a++){b=String.fromCharCode(a);c[a]=[b.toLowerCase(),b.toUpperCase()]}return function(e){var d=c[(e.which||e.keyCode)];if(Array.isArray(d)){d=d[+e.shiftKey]}return d}});define("DS/W3DContentApp/Views/DriveView/driveViewPattern",["UWA/Core","UWA/Class/View"],function(c,b){function a(g){var i=g.model,f=new b({model:i,className:"w3ddrive drive"}),k=g.header,d=g.authenticatedBody,j=f.render,e=f.destroy;function h(){f.container.setContent(k);if(i.get("authenticated")){f.container.addContent(d);d.render()}k.render();return j.apply(f,arguments)}f.listenTo(i,{"onChange:authenticated":function(){f.render()}});return Object.assign(f,{render:h,destroy:function(){f.stopListening();k.destroy();d.destroy();return e.apply(f,arguments)}})}return a});define("DS/W3DContentApp/Views/panelSlider",["UWA/Core","UWA/Element","UWA/Class/View","UWA/String","DS/UIKIT/Tooltip","DS/W3DContentApp/BusEvent","DS/W3DDrive/widget","DS/W3DDrive/Utils/ViewsRestrictions","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DContentApp/W3DContentApp.css"],function(i,d,b,e,k,j,h,c,n){var a="panel-slider-view-id";var g="controller";c.setPossibleRestrictions(a,[g]);function f(p){var o=document.body.classList.contains("collapsed");if(o&&!p){document.body.classList.remove("collapsed")}else{if(p!==false){document.body.classList.add("collapsed")}}}function m(){var o=i.createElement("div",{"class":"controller",events:{click:function(p){h.dispatchEvent("onToggleDrivePanelSideBarCollapsed");p.stopPropagation()}}});o.setContent([{tag:"span","class":"fonticon fonticon-menu"}]);new k({target:o,body:n.menu});return o}function l(B){var x=(B.panels||[]).slice();var s=B.activePanel;var y=new b({className:"w3ddrive panel-slider",domEvents:{"click .panel.left":function(D){if(!D.target.classList.contains("left","panel")){return}h.dispatchEvent("onToggleDrivePanelSideBarCollapsed")}}});var w=y.render;var z=y.destroy;var u;var r=[];var p;function q(E){var D=r[E];if(!D||s===E){return}s=E;r.forEach(function(F){F.removeClassName("active")});D.addClassName("active")}function t(D){return i.createElement("div",{"class":e.format("panel {0}",D?"right":"left")})}function v(F,D){var E=r[F];if(!E){return}if(D){x.splice(F,1,D);E.setContent(D)}else{x.splice(F,1);E.empty()}if(!u||!F){return y}u.inject(E,"top");return y}function C(){if(document.documentElement.clientWidth<560&&!document.body.classList.contains("collapsed")){h.dispatchEvent("onToggleDrivePanelSideBarCollapsed")}}function o(){if(!p){y.listenTo(h,{onDrivePanelSideBarCollapsedToggled:function(D){f(D)}});y.listenTo(j,{"driveView:onNodeClick":C,"driveTreeView:onNodeClick":C})}y.container.empty();f(h.getBool("isDrivePanelSideBarCollapsed"));if(c.getRestriction(a,g)!==true){u=m()}[0,1].map(function(D){r[D]=t(D);v(D,x[D]);y.container.addContent(r[D])});q(s||0);p=true;return w.apply(y,arguments)}function A(){x.forEach(function(D){D.destroy()});y.stopListening();return z.apply(y,arguments)}return Object.assign(y,{refreshPanel:v,slideTo:q,render:o,destroy:A})}return l});define("DS/W3DContentApp/Views/UploadInodesView/uploadInodeTasksView",["UWA/Core","DS/W3DContentApp/Views/UploadInodesView/tasksView","i18n!DS/W3DContentApp/assets/nls/W3DContentApp"],function(d,a,c){function b(l){var k=l.children,i=a({title:c.uploads,children:k.toArray().map(function(n){n.render();return n.container})}),m,j=i.destroy;function h(n){i.removeChildren(n.container)}function g(n){n.render();i.addChildren(n.container)}function e(n){i.removeChildren(n.container)}function f(n){i.resetChildren(n.toArray().map(function(o){o.render();return o.container}))}m={onFinish:h,onAdd:g,onRemove:e,onReset:f};i.listenTo(k,m);i.container.addClassName("upload bottom");return Object.assign(i,{destroy:function(){i.undelegateDOMEvents();j.apply(i,arguments);i.stopListening();i.container=null;k=null;m=null;l=null}})}return b});define("DS/W3DContentApp/Views/UploadInodesView/uploadInodeTaskView",["UWA/Core","DS/W3DContentApp/Views/UploadInodesView/taskView"],function(c,b){function a(e){var j=e.model,h={title:j.get("title"),progress:0},d=b(h,j),g;function i(k){if(!k.lengthComputable){return}h.progress=(Math.ceil(k.loaded*100/k.total)/100);d.refreshProgress()}g={onProgress:i};d.listenTo(j,g);var f={onDestroy:function(){d.stopListening(j,g);d.refreshError(true)},onError:function(){d.stopListening(j,g);d.refreshError(true)}};f["onChange:"+j.idAttribute]=function(){h.progress=100;d.refreshStatus();d.stopListening(j,g)};d.listenToOnce(j,f);return d}return a});define("DS/W3DContentApp/Views/InodeDetailView/inodeDetailAccessView",["UWA/Class/View","DS/W3DDrive/InodeActions","DS/W3DDrive/Metas/inode","DS/W3DContentApp/Views/InodeDetailView/permissionsView","DS/W3DContentApp/BusEvent","DS/W3DDrive/widget","DS/W3DDrive/Actions/Share/share","DS/W3DContentApp/Views/InodeDetailView/advancedView","DS/W3DXComponents/Views/Layout/ScrollView","DS/UIKIT/Iconbar","DS/UIKIT/Spinner","DS/UIKIT/Input/Button","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DContentApp/W3DContentApp.css","css!DS/UIKIT/UIKIT.css"],function(p,o,j,c,q,d,g,e,s,a,h,l,f){var b=j();var m=true;function n(u){var t=u.container;var v=u.elements.spinner;t.classList.add("loading");v.show()}function i(t){setTimeout(function(){var u=t.container;var v=t.elements.spinner;u.classList.remove("loading");if(!v){return}v.hide()},80)}function r(v,t){var u=t.elements.scrollView;var w=t.elements.spinner;if(v){u.container.addClassName("loading");w.show()}else{setTimeout(function(){u.container.removeClassName("loading");w.hide()},150)}}function k(B){var u=B.model;var y=u.inodeTable;var x=u.permissions;var E=new o({model:u,context:"access"});var w=E.toJSON();var z=new p(B);var A=z.destroy;var D={onSync:function(){i(z)},onReset:function(){n(z)}};var C=false;function v(){return{onToggleEmpty:function(G,F){if(G.toggleResponsive){G.toggleResponsive(F)}}}}z.elements.scrollView=new s({className:"inode-access__scroll",usePullToRefresh:false,view:c({collection:x,events:v()}),events:{onInfiniteScroll:function(){if(x.state&&(typeof x.hasNextPage==="function"&&x.hasNextPage())){q.dispatchEvent("inodeDetailAccessView:onNextPage",[y,x])}else{z.elements.scrollView.useInfiniteScroll(false)}}}});z.elements.spinner=new h({className:"inode-access__spinner"});z.elements.iconbar=new a({className:"inode-access__topbar",items:w.filter(function(F){return(F.id===b.actionPubIds.share)||(F.id===b.actionPubIds.addMember)||(F.id===b.actionPubIds.addMemberRestricted)})});if(u.isCollabSpace()){z.elements.buttonMO=e.createMultiOrgButton(u)}function t(){var F=z.container;var G=z.elements;F.setContent([]);if(u.isCollabSpace()&&m){F.setContent([G.buttonMO,G.iconbar,G.spinner,G.scrollView])}else{F.setContent([G.iconbar,G.spinner,G.scrollView])}G.scrollView.render();return z}z.container.classList.add("inode-access");z.listenTo(x,D);z.elements.scrollView.listenTo(x,{onSync:function(){z.elements.scrollView.endLoading();r(false,z);if(x.state){z.elements.scrollView.useInfiniteScroll(true)}},onReset:function(){r(true,z)}});if(x.isEmpty()){n(z)}return Object.assign(z,{render:t,destroy:function(){z.elements.scrollView.stopListening();z.stopListening();A.apply(z,arguments);C=false}})}return k});define("DS/W3DContentApp/Utils/Alert",["UWA/Drivers/Alone","DS/UIKIT/Alert","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/BusEvent","css!DS/UIKIT/UIKIT.css","css!DS/W3DDrive/W3DDrive.css"],function(c,b,a,g){var f;f=new b({className:"w3ddrive",autoHide:true,closable:true,visible:true,renderTo:document.body});var e=f.add;var d;f.add=function(h){if(h.className==="error"||h.className==="warning"){f.options.hideDelay=10000}h.message=a.filterXSS(h.message);return e.call(f,h)};f.addWithLink=function(i,h){if(i.className==="error"||i.className==="warning"){f.options.hideDelay=10000}i.message=a.filterXSS(i.message);h.message=a.filterXSS(h.message);i.message+='<a href="'+h.url+'" target="_blank">'+h.message+" </a>";if(h.help){h.help=a.filterXSS(h.help);i.message+=h.help}return e.call(f,i)};f.addAndOpenModal=function(h){var j={};d=h.inode;if(h.className==="error"||h.className==="warning"){f.options.hideDelay=10000}j.className=h.className;j.message=a.filterXSS(h.message);var i=document.createElement("div");i.className="btn-link";i.innerText="Click here for more details";j.message+=i.outerHTML;return e.call(f,j)};f.onClick=function(i,j){var h=j.getElementsByClassName("btn-link");if(h.length>0){g.dispatchEvent("OpenModal",d)}};return f});define("DS/W3DContentApp/Views/InodePreView/lightboxPreview3DPlay",["UWA/Class/Promise","DS/W3DContentApp/BusEvent","DS/W3DContentApp/Utils/Alert","i18n!DS/W3DDrive/assets/nls/W3DDrive","DS/3DPlaySupport/AssetSupport","DS/3DPlayHelper/3DPlayHelper","css!DS/W3DContentApp/W3DContentApp.css"],function(i,g,h,l,a,m){var j;var c;var d;return{init:n,createViewer3D:o,is3DPlayType:k,hide3DPlayViewer:b,getViewer3D:e};function k(q){var r={usage:"preview"};var p=false;a.checkSupport(q,r,function(s){p=s});return p}function o(){var p=document.createElement("div");p.classList.add("preview-3d");return p}function b(){if(j){j.informActiveState(false)}}function n(p){p=p||{};if(c){f(p.inode);return c}d=o();c=Object.assign(d,{refresh:f});f(p.inode);return c}function f(q){if(!q){return i.resolve()}function p(){var w=q.get3DPlayOptions();var u={loading:"autoplay",fullscreen:{mode:"PLATFORM"},callback:{onAnnotationShared:function(y){g.dispatchEvent("lightbox:onAnnotationShared",[y])}}};if(j){j.informActiveState(true);j.load({input:w,options:u})}else{j=new m({container:d,input:w,options:u})}if(q.annotation){var s=false;var x;var r=q.annotation;delete q.annotation;setTimeout(v,25000);t();function t(){if(j.isReady()){s=true;j.loadAnnotations({annotation:r.data.annotationFile},{clean:true})}else{x=setTimeout(t,100)}}function v(){clearTimeout(x);if(!s){h.add({message:l.annotationLoadError,className:"error"})}}}return c}if(q.drive.isCollabSpace){if(q.get("type")){return p()}else{return new i(function(s,r){q.fetch({onComplete:function(){return s(p())}})})}}else{return q.getFileUrl().then(p)}}function e(){return j}});define("DS/W3DContentApp/Views/itemView",["UWA/Core","UWA/Class/View","DS/UIKIT/Iconbar","DS/i3DXCompassPlatformServices/OpenWith","DS/W3DContentApp/Utils/stopPropagationDropdownMenu","DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Utils/CompassHelpers"],function(g,b,d,c,a,i,e){function f(){var j=document.createElement("span");["item__selection_icon","fonticon","fonticon-check"].map(function(k){j.classList.add(k)});return j}function h(o){var u=new b({model:o.model,className:"w3ddrive item"});var p=u.destroy;var r="selected";var l={selected:false};var x;var t;var n;function m(){if(o.image){var B=o.image;var C=[];var D=o.model.getDefaultThumbnail?o.model.getDefaultThumbnail():"";if(B){C.push({tag:"img",src:B,draggable:false,onerror:"this.src='"+D+"'; this.onerror = null;"})}return g.createElement("div",{"class":"image",html:C||{}})}else{if(o.icon){return g.createElement("div",{"class":"image",html:{"class":o.icon,tag:"span"}})}}}function w(H,F,D){if(!Array.isArray(H)||!F){return}var G=H.map(function(I){return{className:I.className||"",text:I.text||"",icon:"fonticon fonticon-"+I.icon,handler:(I.handler&&D)?I.handler.bind(D):null}});var C=D.options.dropdownRenderTo||D.container.parentElement;var B=new a({target:F,renderTo:C,position:"right",items:G,removeOnHide:false});var E=B.getItem("openWith");if(E){B.removeItem("openWith");y(B)}return B}function y(C){var B=e.get3DXContent([o.model]);if(!o.model.isContainer()){if(o.model.drive.isCollabSpace){B.data.items[0].objectTaxonomies=o.model.get("taxonomies")}else{B.data.items[0].objectTaxonomies=[o.model.get("fileExtension").toLowerCase(),B.data.items[0].objectType]}}new c().set3DXContent(B).render(C)}function z(){var B=o.actions;if(!B||!B.length){return}return g.createElement("div",{"class":"actions"})}function j(){var C=[],D=o.icon,G=o.title,B=o.model.get("alias"),F=o.metas,E=o.description;if(D){if(o.model.drive&&o.model.drive.get("actions")){C.push({tag:"img",src:o.icon,html:{"class":"image",src:o.icon,tag:"div"}})}}if(G){C.push({"class":"header",text:B?B:G})}if(F){C.push({tag:"div","class":"meta",html:[].concat(F).filter(Boolean).map(function(H){return{tag:"span",text:H}})})}if(E){C.push({"class":"description",text:E})}return g.createElement("div",{"class":"content",html:C})}function s(){var B=m();if(x){i.replaceWith(x,B)}else{if(t){B.inject(t,"before")}}x=B;return u}function k(C){var B=u.elements.dropDown;if(B){B.destroy()}o.actions=C;u.elements.dropDown=w(o.actions,n,u);return u}function q(){var B=j();i.replaceWith(t,B);t=B;if(!n&&o.actions&&o.actions.length>0){n=z();n.inject(u.container)}return u}function v(B){if(B!==undefined){l.selected=!!B}if(l.selected){u.container.addClassName(r)}else{u.container.removeClassName(r)}}function A(){u.container.empty();x=null;t=null;x=m();if(!n){n=z()}t=j();var B=[x,n,t];if(o.withSelectionIcon){B.splice(0,0,f())}u.container.setContent(B.filter(Boolean));u.container.setAttribute("draggable",true);return u}u.delegateDOMEvents({"click .actions":function(){if(!u.elements.dropDown){u.elements.dropDown=w(o.actions,n,u);n.click()}}});if(u.model.drive||(u.model.get("authenticated")&&!u.model.isDsDrive)){u.container.addEventListener("contextmenu",function(B){B.preventDefault();if(!u.elements.dropDown){u.elements.dropDown=w(o.actions,n,u)}n.click()})}v(o.selected);return Object.assign(u,{render:A,refreshImg:s,refreshActions:k,refreshContent:q,refreshSelected:v,destroy:function(){u.undelegateDOMEvents();p.apply(u,arguments);x=null;t=null;if(n&&n.iconBar){n.iconBar.destroy();n.iconBar=null}n=null}})}return h});define("DS/W3DContentApp/Views/InodeDetailView/inodeDetailSocialView",["DS/W3DXComponents/Views/Layout/ScrollView","DS/W3DContentApp/BusEvent","DS/SocialToolbar/SocialToolbar","DS/W3DDrive/Metas/3DSpace/inode","css!DS/W3DContentApp/W3DContentApp.css"],function(c,f,d,b){var e=b();function a(i){var k=i.model;var m=k.collection;var j;if(m&&m._parentInode&&m._parentInode.get("parentId")===e.ids.myCollabSpaces){j=m._auth.platform.url3DSpace+"/resources"}else{j=m._auth.getStorage().url+"/resources"}var l=new d({subjectURI:k.id,tenantId:k.drive.get("auth").platformId,serviceURL:j,enableShare:false,events:{onMediaClick:function(n){if(n&&(n.type==="annotation")){f.dispatchEvent("socialToolbar:onPreviewAnnotation",[k,n])}}}});var h=new c({className:"w3ddrive socialtoolbar-scroll",useInfiniteScroll:false,usePullToRefresh:false,view:l});var g=h.destroy;h.destroy=function(){g.apply(h,arguments);l=null;k=null;m=null;h.container=null};return h}return a});define("DS/W3DContentApp/Views/DriveView/driveTreeView",["UWA/Class/View","DS/Tree/FileTreeView","DS/W3DContentApp/BusEvent","css!DS/W3DContentApp/W3DContentApp.css"],function(c,b,d){function a(g){var e=new b({treeDocument:g.treeDocument,selection:{toggle:false},enableExpandOnDoubleClick:true,height:"inherit",enableDragAndDrop:false});var f=new c({container:e.elements.container});var h=e.getManager().getDocument();e.onNodeClick(function(i){var j=i.nodeModel,k=j.inode;d.dispatchEvent("driveTreeView:onNodeClick",[k])});e.onPreExpand(function(i){var j=i.data.nodeModel,k=j.inode;d.dispatchEvent("driveTreeView:onPreExpand",[k])});f.container.addClassName("w3ddrive drive-tree ");return Object.assign(f,{getXSO:h.getXSO.bind(h),reverseExpand:function(j){if(!j){return[]}var i=j.getParent();if(!i||j.isRoot()){return f}if(i.isExpanded()){return}i.expand();return f.reverseExpand(i)}})}return a});define("DS/W3DContentApp/Models/DriveTreeNodeModel",["UWA/Core","DS/Tree/TreeNodeModel","DS/W3DContentApp/Utils/Helpers"],function(c,e,a){var b;function d(g){var f=g.get("iconLink");if(["folder","folderShare","star","folderLock"].indexOf(f)!==-1){return f}return[f]}b=function(t){var o,g,p,n,u,r;t=t||{};g=t.inode;if(!g){throw new Error("The inode options is invalid")}p=g.inodeTable;if(!p){throw new Error("The inode options is invalid")}function l(){return{label:a.filterXSS(g.get("alias")||g.get("title")),icons:d(g),children:p.filterFiles().map(function(v){return new b({inode:v})}),useAsyncPreExpand:true}}function h(w){var v;v=l();o.prepareUpdate();o.options[w]=v[w];o.pushUpdate()}function f(v){return h.bind(this,v)}function j(y,x){var w;if(!y.isContainer()){return}w=new b({inode:y});var v=x.filter(function(z){return z.isFolder()}).indexOf(y);o.addChild(w,v)}function i(){o.removeChildren();p.toArray().map(function(v){j(v,p)})}function k(){o.preExpandDone()}function q(v){var w;w=v?"remove":"add";g[w+"Events"](n);p[w+"Events"](u)}function m(x){var w,v;w=o.getChildren();if(!w){return}w.forEach(function(y){if(y.inode===x){v=y;return}});return v}n={onRemove:function s(){q(true);o.remove()},"onChange:title":f("label"),"onChange:alias":f("label"),"onChange:iconLink":f("icons")};u={onAdd:j,onReset:i,onSync:k};o=new e(c.merge(t,l()));r={inode:g,getChildWithInode:m};c.extend(o,r);q();return o};return b});define("DS/W3DContentApp/Collections/DriveTreeDocument",["UWA/Core","DS/Tree/TreeDocument","DS/W3DContentApp/Models/DriveTreeNodeModel"],function(e,b,d){var c,a;a={useAsyncPreExpand:false,shouldAcceptDrop:function(f){return false}};c=function(g){g=g||{};var f=new b(e.merge(g,a)),i=f._getTrueRoot();function h(l,j){var k;if(!j){j=i}[].concat(j.getChildren()).some(function(m){if(m&&m.inode===l){k=m;return true}});return k}return Object.assign(f,{searchWithInode:h,buildNodesPath:function(j,k){var n=j.slice(),m,l;if(!k){k=i}if(!j.length){return[k]}m=n.shift();l=h(m,k);if(!l){l=new d({inode:m});k.addChild(l)}return[l].concat(f.buildNodesPath(n,l))}})};return c});define("DS/W3DContentApp/Views/InodeDetailView/permissionItemView",["UWA/Utils","DS/W3DContentApp/Views/itemView","DS/W3DDrive/Actions/Permissions/permissionActionsFactory","i18n!DS/W3DDrive/assets/nls/W3DDrive","DS/i3DXRDFGroupViewer/js/GroupViewer","DS/UWPClientCode/I18n","DS/UIKIT/Modal"],function(g,d,c,h,e,b,a){function f(l){var i=l.model,p={model:i},k,j;var o=c({permission:i});function m(){var r;if(l.isGroup===true){r={id:"id",title:"label",metas:"role",description:"members",icon:"fonticon fonticon-users-group"}}else{r={id:"id",title:"displayName",metas:"role",description:"emailAddress",image:"picture"}}Object.keys(r).map(function(s){p[s]=i.get(r[s])});if(p.image){p.image=p.image.medium}else{if(r.icon){p.icon=r.icon}}if(p.metas){if(typeof p.metas==="object"){var q=p.metas.value.toLowerCase();if(q==="reader"){q="readercs"}if(p.metas.admin===true){q+="Owner"}p.metas=q}p.metas=h[p.metas]}if(p.description!==null&&p.description!==undefined&&l.isGroup===true){p.description=p.description+" "+h.get("unitMembers")}if(l.isGroup!==true&&i.collection._parentInode.drive.isDsDrive){p.description=""}p.actions=o.toJSON();n()}function n(){if(p.actions&&l.isGroup){p.actions.push({handler:function(){var q=new e({platformId:p.model._auth.platformId,groupId:p.model.get("resourceid"),language:b.getCurrentLanguage()});var r=new a({closable:true,renderTo:document.body,className:"groupViewer",header:h.viewGroupMembersTitle,body:q.render()});r.show()},icon:"fonticon fonticon-eye",id:"viewMembers",text:h.viewMembers,})}}m();k=d(p);j=k.destroy;k.listenTo(i,{"onChange:picture":function(){g.setImmediate(function(){k.refreshImg()})},onChange:function(){m();g.setImmediate(function(){k.refreshContent();k.refreshActions(p.actions)})}});k.container.addClassName("permission-item");return Object.assign(k,{destroy:function(){j.apply(k,arguments);i=null;o.model=null;k.stopListening()}})}return f});define("DS/W3DContentApp/Views/DrivesPanelView/grantDriveView",["UWA/Class/View","DS/UIKIT/Input/Button","DS/W3DContentApp/BusEvent","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(d,a,e,c){function b(h){var k=h.model,g=new d({model:k,className:"w3ddrive grant-drive",tagName:"tr"}),i=new a({value:c.add,className:"primary"}),l=g.render,f=g.destroy;function j(){var m=[];m.push({tag:"span",text:k.get("title")});if(k.isDsDrive){m.push({tag:"span",text:" ("+k.get("auth").platform.displayName+")"})}g.container.setContent([{tag:"td","class":"icon",html:{tag:"img",src:k.get("iconLink")}},{tag:"td","class":"title",html:m},{tag:"td","class":"action",html:i}]);return l.apply(g,arguments)}i.addEvent("onClick",function(){g.dispatchEvent("onClick",[k]);e.dispatchEvent("grantDriveView:onClick",[k])});return Object.assign(g,{render:j,destroy:function(){i.destroy();return f.apply(g,arguments)}})}return b});define("DS/W3DContentApp/Views/DrivesPanelView/grantDrivesView",["UWA/Core","DS/WebAppsFoundations/Views/CollectionView","DS/W3DContentApp/Views/DrivesPanelView/grantDriveView","css!DS/W3DContentApp/W3DContentApp.css"],function(d,b,c){function a(f){var g=f.collection,e=new b({className:"w3ddrive grant-drives",tagName:"table",collection:g,filterer:function(h){return !h.get("granted")}});e.listenTo(g,"onChange:granted",e.filter);return Object.assign(e,{_buildItemView:function(h){return c({model:h})}})}return a});define("DS/W3DContentApp/Views/DriveView/driveTreeViewWithDocument",["UWA/Core","UWA/Class/View","DS/W3DDrive/Metas/inode","DS/W3DContentApp/Collections/DriveTreeDocument","DS/W3DContentApp/Views/DriveView/driveTreeView","css!DS/W3DContentApp/W3DContentApp.css"],function(g,f,b,d,c){var a=b();function e(j){var i=new d(),h=c({treeDocument:i});return Object.assign(h,{expandInodesPath:function(m){if(!m.length){return}var k=i.buildNodesPath(m),l=k[0];if(l&&l.inode&&l.inode.id===a.ids.trueRoot){h.container.addClassName("with-true-root")}else{h.container.removeClassName("with-true-root")}h.reverseExpand(k[k.length-1]);return k}})}return e});define("DS/W3DContentApp/Views/DriveView/driveItemView",["UWA/Utils","DS/W3DDrive/Views/driveActions","DS/W3DContentApp/Views/itemView","DS/W3DContentApp/BusEvent","DS/W3DContentApp/Views/SuperModal","css!DS/W3DContentApp/W3DContentApp.css"],function(d,c,b,f,a){function e(p){var q=p.model;var j={model:q};var i=c({model:q});var k;var l;function g(){var s={id:"id",image:"thumbnailLink",icon:"iconLink",title:"title",metas:function(u){if(!u.isDsDrive){if(!u.isCollabSpace){var t=u.get("user");if(typeof t==="object"){t=t.emailAddress}return t}}return u.get("auth").platform.displayName}};Object.keys(s).map(function(u){var t;if(typeof s[u]==="function"){t=s[u](q)}else{t=q.get(s[u])}j[u]=t});j.actions=i.toJSON()}function h(v,s,t){var u=v.classList.contains(s);if(u){if(!t){v.classList.remove(s)}}else{if(t!==false){v.classList.add(s)}}return v}function o(s){return h(k.container,"expanded",s)}function n(){return o(true)}function m(){return o(false)}function r(s){return h(k.container,"authenticated",s)}g();k=b(j);l=k.destroy;k.container.addEvent("click",function(t){var u=t.target||t.srcElement;var s=k.container.getElement(".actions");if(u===s){return}k.dispatchEvent("onClick",[q]);f.dispatchEvent("driveView:onClick",[q])});k.listenTo(q,{"onChange:thumbnailLink":function(){d.setImmediate(function(){k.refreshImg()})},"onChange:authenticated":function(){r(q.get("authenticated"))},onChange:function(){g();d.setImmediate(function(){k.refreshContent()})}});k.container.addClassName("drive-item w3dx tile half fixed relaxed");r(q.get("authenticated"));k.options=Object.assign(k.options,{dropdownRenderTo:document.body});return Object.assign(k,{toggleExpand:o,expand:n,collapse:m,destroy:function(){i=null;j=null;k.container=null;k.model=null;k.stopListening();return l.apply(k,arguments)}})}return e});define("DS/W3DContentApp/Views/InodePanelView/sortView",["UWA/Controls/Abstract","DS/W3DContentApp/BusEvent","DS/W3DDrive/widget","i18n!DS/W3DContentApp/assets/nls/W3DContentApp","css!DS/W3DContentApp/W3DContentApp.css"],function(e,k,f,l){var b=[];b["title-a"]={id:"title-a",attributeName:"title",asc:true};b["title-d"]={id:"title-d",attributeName:"title",asc:false};b["modifiedDate-a"]={id:"modifiedDate-a",attributeName:"modifiedDate",asc:true};b["modifiedDate-d"]={id:"modifiedDate-d",attributeName:"modifiedDate",asc:false};b["createdDate-a"]={id:"createdDate-a",attributeName:"createdDate",asc:true};b["createdDate-d"]={id:"createdDate-d",attributeName:"createdDate",asc:false};var j;function g(m){var p,o,n=b[m];switch(n.attributeName){default:case"title":o="alpha";break;case"createdDate":case"modifiedDate":o="num"}p="fonticon fonticon-sort-"+o;if(n.asc){p=p+"-asc"}else{p=p+"-desc"}if(j===m){p=p+" selected"}return p}function h(n){var p,o=b[n];switch(o.attributeName){default:case"title":p="alpha";break;case"createdDate":case"modifiedDate":p="num"}var m="fonticon fonticon-sort-"+p;if(o.asc){m=m+"-asc"}else{m=m+"-desc"}return m}function a(m){m.parentElement.parentElement.getElement(".selected").removeClassName("selected");m.addClassName("selected")}function c(m){return{tag:"span","class":g(m),events:{click:function(o){var n=o.target||o.srcElement;a(n);k.dispatchEvent("inodePanelView:onSort",[{id:m,logic:b[m]}])}}}}function i(m){var n=b[m];return{selected:(j===m)?true:false,fonticon:h(m),handler:function(){k.dispatchEvent("inodePanelView:onSort",[{id:m,logic:b[m]}])}}}function d(n){var n=n||{};var m=new e();if(f.getValue("is3DSpaceWidget")){j=n.sorting?n.sorting.id:"modifiedDate-a"}else{j=n.sorting?n.sorting.id:"title-a"}m.container={tag:"ul","class":"customdropdown-menu-wrap",html:[{tag:"li","class":"item",html:[{tag:"span","class":"item-text",text:l.sortTitle},c("title-a"),c("title-d")]},{tag:"li","class":"item",html:[{tag:"span","class":"item-text",text:l.sortModifiedDate},c("modifiedDate-a"),c("modifiedDate-d")]},{tag:"li","class":"item",html:[{tag:"span","class":"item-text",text:l.sortCreatedDate},c("createdDate-a"),c("createdDate-d")]}]};m.toOptions=function(){m.container={text:l.sortBy,fonticon:h("title-a"),className:"sub-icon-dropdown-menu",content:{options:{items:[{className:"header",text:l.sortTitle},i("title-a"),i("title-d"),{className:"divider"},{className:"header",text:l.sortModifiedDate},i("modifiedDate-a"),i("modifiedDate-d"),{className:"divider"},{className:"header",text:l.sortCreatedDate},i("createdDate-a"),i("createdDate-d")]}}};return m};return m}return d});define("DS/W3DContentApp/Views/InodePanelView/inodesViewFunc",["UWA/Utils","DS/WebAppsFoundations/Views/CollectionView","DS/W3DContentApp/SearchProxy","DS/W3DDrive/W3DDriveTagger6WProxy"],function(f,j,l,e){function d(m){return(Array.isArray(m)?m:[m])}function k(m){return(typeof m==="string"?m.toUpperCase():m)}function i(n){var m=new j(Object.assign({},n));m.container.addClassName("w3ddrive inodes");return m}function h(o,p,n){var m;o=d(o);if(typeof p==="function"){m=function(q){return p(q,n)}}else{m=function(q){return q===p}}return o.some(m)}function c(n,m){return h(n,function(p,o){return k(o.get("title")).indexOf(k(p))!==-1},m)}function b(m,n){return h(m,function(p,o){return p==="driveid:"+n.get("id")},n)}function g(n,m){return d(m).filter(function(o){return(typeof o==="function")}).reduce(function(o,p){return(o&&p(n))},true)}function a(m){return g(m,[function(o){var n=e.getFilteredSubjectList();return !n||b(n,o)},function(n){return(l.getQuery()===undefined)||c(l.getQuery(),n)}])}return{getView:i,test:h,testTitles:c,testUris:b,filtererWithCbks:g,filtererWith3DDProxys:a}});define("DS/W3DContentApp/Views/InodePanelView/inodeTableViewFunc",["DS/W3DContentApp/Views/InodePanelView/inodesViewFunc","DS/W3DContentApp/Views/InodePanelView/inodeItemView","DS/W3DXComponents/Views/EmptyView","i18n!DS/W3DContentApp/assets/nls/W3DContentApp"],function(f,j,c,i){var a="thumbnailsLayout";var e="tilesLayout";function g(){return new c({icon:"picture",title:i.noContent})}function d(m,n){var q=!n||(n===a);var o=n===e;var l=m.classList.contains("thumbnails");var p=m.classList.contains("tiles");if(q){if(!l){m.classList.add("thumbnails")}m.classList.remove("tiles")}else{if(o){if(!p){m.classList.add("tiles")}m.classList.remove("thumbnails")}}return m}function h(o){var n=Object.assign({emptyView:g(),ItemView:j,filterer:f.filtererWith3DDProxys},o);var m=f.getView(n);var l=m.destroy;m.destroy=function(){if(n&&n.emptyView){n.emptyView.destroy();n.emptyView=null}l.apply(m,arguments);m.container=null;m.stopListening();m.model=null;n=null};m.container.addClassName("w3ddrive inode-table w3dx link fixed reveal");d(m.container,n.layoutKey);return m}function k(l){l.container.addClassName("blue")}function b(l){l.container.removeClassName("blue")}return{getEmptyView:g,wrapWithLayout:d,getView:h,selectItemView:k,unSelectItemView:b,thumbnailsLayoutKey:a,tilesLayoutKey:e}});define("DS/W3DContentApp/Views/InodePanelView/inodeTableView",["DS/W3DContentApp/Views/InodePanelView/inodeTableViewFunc","DS/W3DDrive/widget"],function(c,b){function a(f){var h=f.collection;var e=c.getView(Object.assign({layoutKey:b.getValue("inodeTableLayoutKey")},f));var d=e.destroy;var g={onSort:function(){e.render()}};e.listenTo(b,{onInodeTableLayoutKeyUpdated:function(i){c.wrapWithLayout(e.container,i)}});h.addEvents(g);return Object.assign(e,{destroy:function(){h.removeEvents(g);e.stopListening();return d.apply(e,arguments)}})}return a});define("DS/W3DContentApp/Views/InodePanelView/inodeTableScrollViewFunc",["DS/W3DDrive/Metas/inode","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDrive/Views/startView","DS/W3DContentApp/Views/InodePanelView/inodeTableView","DS/W3DContentApp/Views/InodePanelView/inodeTableViewFunc","DS/W3DXComponents/Views/EmptyView","DS/W3DXComponents/Views/Layout/ScrollView","DS/UIKIT/Spinner","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(k,e,p,c,r,m,t,i,g){var d=k();var u=e();function f(w){if(!w||typeof w.dot!=="function"){return false}var v=w.dot();return v.isActionIdoK(d.actionPubIds.upload)}function o(v){if(!v||!v.dataTransfer){return false}return Array.prototype.some.call(v.dataTransfer.types,function(w){return w==="Files"})}function h(v){v=((typeof v==="number")?v:0);if(v!==1){return false}return true}function s(w,v){v=((typeof v==="number")?v:-1);if(!w||(v!==0||(w.visibleItems&&!w.visibleItems.length))){return false}return true}function q(y,x,w,v){if(!o(y)){return}if(!h(w)){return}if(x.collection.length===0){return}if(typeof v==="function"){v()}if(x&&typeof x.dispatchEvent==="function"){x.dispatchEvent("onDragEnterFile")}}function j(y,x,w,v){if(!o(y)){return}if(!x||!s(x.view,w)){return}if(typeof v==="function"){v()}if(x.dispatchEvent==="function"){x.dispatchEvent("onDragLeave")}}function b(v){return new m({icon:"picture",title:g.dropFiles})}function n(x,v){var w=x.collection.dot().id;if(w===u.ids.root){return p()}if(!f(v)){return r.getEmptyView()}return b(x)}function l(){return new i()}function a(y){var w=y.collection;var x=c({collection:w,emptyView:n(y,w),});var v=new t(Object.assign({useInfiniteScroll:false,usePullToRefresh:false,},y,{view:x}));v.container.addClassName("w3ddrive inode-table-scroll");return Object.assign(v,{selectedChildren:x.selectedChildren,children:x.children,findChildViewByModel:x.findChildViewByModel})}return{shouldAddDAndD:f,eventHasFiles:o,shouldDispatchDragEnter:h,shouldDispatchDragLeave:s,onDragEnter:q,onDragLeave:j,getDAndDView:b,getSpinner:l,getView:a}});define("DS/W3DContentApp/Views/InodePanelView/inodeTableScrollView",["DS/W3DXComponents/Views/Layout/ScrollView","DS/W3DXComponents/Views/EmptyView","DS/W3DDrive/Metas/inode","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Views/InodePanelView/inodeTableView","DS/W3DContentApp/Views/InodePanelView/inodeTableViewFunc","DS/W3DDrive/Views/startView","DS/W3DContentApp/BusEvent","DS/W3DContentApp/Utils/Alert","DS/UIKIT/Spinner","i18n!DS/W3DContentApp/assets/nls/W3DContentApp","css!DS/W3DContentApp/W3DContentApp.css"],function(v,m,k,e,c,t,r,s,b,j,g){var d=k();var w=e();return function(z){if(!z.isContainer()){throw new Error("The inode should be a container")}var B=false;var I=z.inodeTable;var F=z.isAtLeastOneActionIdOk([d.actionPubIds.upload,d.actionPubIds.addContent]);var y=o({isDSDriveRoot:(z.id===w.ids.root),withDaD:F});var C=c({collection:I,emptyView:y,events:y.toggleResponsive?n():{}});var J=new v({view:C,usePullToRefresh:false,events:{onInfiniteScroll:function(){if((typeof I.hasNextPage!=="function")||!I.hasNextPage()){J.useInfiniteScroll(false)}else{s.dispatchEvent("inodeTableScrollView:onNextPage",[I])}}}});var x=0;var K=new j();var E=J.render;var H=J.destroy;J.container.classList.add("inode-table-scroll");J.container.classList.add("w3ddrive");J.listenTo(I,{onSync:function(){if(B){J.endLoading();D(false);J.useInfiniteScroll(true)}},onReset:function(){D(true)}});D(true);G();return Object.assign(J,{render:function(){this.container.empty();E.apply(this,arguments);K.inject(this.container,"top");B=true;return this},destroy:function(){B=false;if(y){y.destroy();y=null}if(J){H.apply(J,arguments);J.container.removeEvents();J.stopListening();J.container=null;J=null}if(K){K.destroy();K=null}I=null}});function A(L){J.container.classList[L?"add":"remove"]("drag-over");C._toggleElement(y.container,L)}function G(){J.container.addEvent("dragenter",function(L){x+=1;if(!p(L)){return}if(!h(x)){return}A(true);L.preventDefault()});J.container.addEvent("dragover",function(L){L.preventDefault()});J.container.addEvent("dragleave",function(L){x-=1;if(!p(L)){return}if(!f(C,x)){return}A(false);L.preventDefault()});J.container.addEvent("drop",function(M){M.preventDefault();x=0;A(false);var L=z.isAtLeastOneActionIdOk([d.actionPubIds.upload,d.actionPubIds.addContent]);if(!L){A(I.length===0);return b.add({className:"error",message:g.permissionUploadForbidden})}s.dispatchEvent("inodeScrollTableView:onDrop",[I,q(M.dataTransfer)])})}function D(L){if(L){J.container.addClassName("loading");K.show();return}setTimeout(function(){if(J&&J.container){J.container.removeClassName("loading")}if(K){K.hide()}},150)}};function p(x){if(!x||!x.dataTransfer){return false}return Array.prototype.some.call(x.dataTransfer.types,function(y){return(y==="Files")})}function h(x){x=((typeof x==="number")?x:0);return(x===1)}function f(y,x){var z=!y;x=((typeof x==="number")?x:-1);z=(z||(x!==0));z=(z||(y.visibleItems&&!y.visibleItems.length));return !z}function i(x){return[].concat(x).filter(function(y){if(!y){return false}if(y.type){return true}try{new FileReader().readAsBinaryString(y.slice(0,5));return true}catch(z){return false}})}function u(y,x){return[].concat(y).filter(function(A,z){var C=x[z];if(!A||!C){return false}var B=C.webkitGetAsEntry();return !B.isDirectory})}function l(y){var x=!!y.items;x=x&&!!y.items.length;return x&&!!y.items[0].webkitGetAsEntry}function a(x){return !!x.mozSourceNode}function q(z){var y=[];var x;for(x=0;x<z.files.length;x++){y.push(z.files.item(x))}if(l(z)){return u(y,z.items)}if(a(z)){return i(y)}return y}function o(x){x=(x||{});var y=x.isDSDriveRoot;var z=x.withDaD;if(z){if(!widget.getValue("is3DSpaceWidget")){return r()}else{return new m({icon:"picture",title:g.dropFiles})}}return t.getEmptyView()}function n(){return{onToggleEmpty:function(y,x){if(y.toggleResponsive){y.toggleResponsive(x)}}}}});define("DS/W3DContentApp/Views/InodePanelView/inodeTopBarViewFunc",["UWA/Class/View","UWA/Array","DS/W3DDrive/InodeActions","DS/W3DContentApp/Views/InodePanelView/inodeTableViewFunc","DS/W3DContentApp/Views/InodePanelView/sortView","DS/W3DDrive/widget","DS/UIKIT/Iconbar","DS/UIKIT/IconDropdown","DS/UIKIT/Input/Button","i18n!DS/W3DContentApp/assets/nls/W3DContentApp"],function(H,g,t,m,h,u,E,F,C,i){function o(L){L=L||{};var N=L.target;var M=L.uri;N=N.querySelector('.breadcrumb__elem-title[href="'+M+'"]');if(!N){return}return N.parentNode}function j(L){L=L||{};var M=L.target;var N=L.title;if(!M){return}if(!M.classList.contains("breadcrumb__elem-title")){M=M.querySelector(".breadcrumb__elem-title");if(!M){return}}M.textContent=N;return L}function a(T){T=T||{};var M=T.uri;var R=T.title;var L=!!T.noIcon;var S=!!T.withOpenDown;var N=document.createElement("div");N.classList.add("breadcrumb__elem");var U=document.createElement("div");var Q;if(!L){Q=document.createElement("div");Q.classList.add("breadcrumb__elem-icon");Q.classList.add("fonticon")}var P;if(S){P=document.createElement("div");P.classList.add("breadcrumb__elem-icon");P.classList.add("fonticon");P.classList.add("breadcrumb__elem-open-down")}U.classList.add("breadcrumb__elem-divider");U.classList.add("fonticon");var O=document.createElement("a");O.classList.add("breadcrumb__elem-title");O.setAttribute("href",M);O.target="_blank";j({target:O,title:R});return[U,Q,O,P].reduce(function(V,W){if(W){V.appendChild(W)}return V},N)}function b(M){M=M||{};var O=M.target;var N=M.opts;if(!O||!N){return}if(!O.classList.contains("breadcrumb")){O=O.querySelector(".breadcrumb");if(!O){return}}var L=Object.keys(N).map(function(P){return{uri:P,elem:o({target:O,uri:P})}});L.filter(function(P){return !!L.elem}).map(function(P){j(Object.assign({},N[breadcrumbConf.uri],{target:breadcrumbConf.elem}))});L.filter(function(P){return !L.elem}).map(function(P){return P.uri}).map(function(P){return a(Object.assign({},N[P],{uri:P}))}).reverse().reduce(function(P,Q){P.appendChild(Q);return P},O)}function r(L){L=L||{};var M=document.createElement("div");M.classList.add("breadcrumb");b({target:M,opts:L.opts});return M}function s(){var L=u.getValue("inodesSorting");return new h({sorting:L}).container}function A(){var L=u.getValue("inodesSorting");return new h({sorting:L}).toOptions().container}function n(M){var L=document.createElement("div");L.classList.add("top-bar__iconbar-container");if(M){L.appendChild(M)}return L}function I(M){var L=document.createElement("div");L.classList.add("top-bar__iconbar-container--collapsed");if(M){L.appendChild(M)}return L}function y(M){var L=document.createElement("div");L.classList.add("top-bar__iconbar-container--fixed");if(M){L.appendChild(M)}return L}function p(O,N,M){M=M||{};var L=O.querySelector(N);if(L.firstChild){L.removeChild(L.firstChild)}if(M.iconbarElem){L.appendChild(M.iconbarElem)}return O}function G(M,L){return p(M,".top-bar__iconbar-container",L)}function k(M,L){return p(M,".top-bar__iconbar-container--collapsed",L)}function D(M,L){return p(M,".top-bar__iconbar-container--fixed",L)}function l(L){if(!L){return[]}if(!Array.isArray(L)){L=[].concat(L)}return L.filter(function(M){return(M&&(M.id!=="openWith"))}).map(function(M){return Object.assign({index:1},M)}).reverse()}function d(L){var M=new E({className:"top-bar__iconbar",items:[].concat(L)});return M}function w(L,N){var M;if(L.querySelector){M=L.querySelector(".iconbar__item--info")}else{M=L.elements.container.querySelector(".iconbar__item--info")}if(!M){return}if(N){M.classList.add("item-info--opened")}else{M.classList.remove("item-info--opened")}}function x(P,M,O){var L=new E({className:M,items:P.concat([{text:i.layout,fonticon:u.getValue("inodeTableLayoutKey")===m.thumbnailsLayoutKey?"view-small-thb":"view-small-tile",className:"iconbar__item--layout"},{text:i.sort,fonticon:"sort-alpha-asc",className:"iconbar__item--sort",content:{type:"dropdown",options:{className:"customdropdown-menu",body:s()}}},{text:i.infos,fonticon:"info",className:"iconbar__item--info",handler:function(){u.dispatchEvent("onToggleInodePanelSideBarVisibility")}}])});var N=L.elements.container.querySelector(".iconbar__item--layout");new F({target:N,items:[{description:i.thumbnail,text:i.thumbnail,fonticon:"view-small-thb",className:"dropdown__item--thb",selected:(u.getValue("inodeTableLayoutKey")===m.thumbnailsLayoutKey),handler:function(){u.dispatchEvent("onUpdateInodeTableLayoutKey",m.thumbnailsLayoutKey)}},{description:i.tile,text:i.tile,fonticon:"view-small-tile",className:"dropdown__item--tile",selected:(u.getValue("inodeTableLayoutKey")===m.tilesLayoutKey),handler:function(){u.dispatchEvent("onUpdateInodeTableLayoutKey",m.tilesLayoutKey)}}],events:{onClick:function(R,Q){N.querySelector(".fonticon").set("class",Q.elements.icon.className)}}});return L}function K(){var L=[{text:i.selectAll,fonticon:"select-all",className:"dropdown__item--select-all",handler:function(){return}},{text:i.unselectAll,fonticon:"select-none",className:"dropdown__item--select-none",handler:function(){return}}];return L}function z(){var L=[{text:i.multiSelection,fonticon:"select-on",className:"iconbar__item--select-on"}];return L}function c(){var N=[{fonticon:"open-down",className:"iconbar__item--select-on-option",innerComponent:{type:"dropdownmenu",options:{className:"item-select-on__dropdown",items:K()}}}];var M=z();M=[{className:"divider"}].concat(M);M=M.concat(N);var L=x(M,"top-bar__iconbar top-bar__iconbar--fixed");w(L,u.getBool("isInodePanelSideBarOpened"));return L}function f(){var L=document.createElement("div");L.classList.add("top-bar__upload-btn");return L}function J(R){var N=R.target.querySelector(".top-bar__upload-btn");var Q=R.model;if(N.querySelector("button")){N.querySelector("button").parentElement.removeChild(N.querySelector("button"))}var P=new t({model:Q,context:"topbar"});var O=P.toJSON();if(!O.length>0||!Q.inodeTable._models.length>0){return}var M=g.detect(O,function(S){return S.id==="upload"});if(!M){return}var L=new C({value:i.upload,icon:"upload",className:"primary btn-sm"});L.addEvent("onClick",M.handler);L.inject(N)}function e(L,M){var N=L.querySelector(".top-bar__upload-btn");if(M){N.classList.remove("upload-btn--invisible")}else{N.classList.add("upload-btn--invisible")}}function B(O){var O=l(O);if(O.length){O=O.concat({className:"divider"})}var M=z();M[0].content={type:"dropdownMenu",options:{items:K()}};O=O.concat(M);var N=A();O=O.concat(N);var L=x(O,"top-bar__iconbar top-bar__iconbar--collapsed",true);w(L,u.getBool("isInodePanelSideBarOpened"));return L}function v(){var L=document.createElement("div");L.classList.add("inode-panel__action-bar");return L}function q(M){var L=new H(M);L.container.classList.add("top-bar");return L}return{getBreadcrumpElem:o,refreshBreadcrumpElem:j,createBreadcrumpElem:a,refreshBreadcrump:b,createBreadcrump:r,getIconBarContainer:n,refreshIconBarContainer:G,getFixedIconBarContainer:y,refreshFixedIconBarContainer:D,getCollapsedIconBarContainer:I,refreshCollapsedIconBarContainer:k,getIconbarItems:l,createIconbar:d,createFixedIconbar:c,createCollapsedIconbar:B,getView:q,updateIconbarInfoColor:w,wrapActionBar:v,createUploadButtonContainer:f,refreshUploadButtonContainer:J,refreshUploadButtonState:e}});define("DS/W3DContentApp/Views/setOfSelectedItemView",["UWA/Array","DS/W3DContentApp/Utils/SetOfSelectedView"],function(a,b){function c(d){var e=new b(d);e.addEvents({onAdd:function(f){f.refreshSelected(true)},onRemove:function(f){f.refreshSelected(false)},onReset:function(f,g){g.previousItems.map(function(h){h.refreshSelected(false)});a.invoke(e,"refreshSelected",true)}});return e}return c});define("DS/W3DContentApp/Views/InodeDetailView/inodeDetailPropertiesView",["UWA/Class/View","DS/W3DDrive/widget","DS/W3DContentApp/Utils/Helpers","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/W3DDrive/Metas/3DSpace/inode","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DContentApp/W3DContentApp.css"],function(r,f,g,l,n,b,s,i){var j=s().ids.myCollabSpaces;function u(w){var v=w.get("size");if(v<0||!v){return""}return g.computeNLSSize(v)}function p(w){var v=w.get("createdDate");if(!v){return""}return g.getDateStr(new Date(v))}function t(w){var v=w.get("modifiedDate");if(!v){return""}return g.getDateStr(new Date(v))}function a(v){return v.get("visibility").value}function c(v){return v.get("alias")}function h(v){var w=document.createElement("div");w.textContent=v;return w}function d(v,w){var x=document.createElement("div");x.textContent=w||"";x.setAttribute("model-key",v);return x}function e(x,v,z){var y=document.createElement("div");var w=h(v);var A=d(x);w.classList.add("property-row__cell");w.classList.add("property-row__cell--label");A.classList.add("property-row__cell");A.classList.add("property-row__cell--value");y.classList.add("property-row");y.classList.add("inode-properties-table__property-row");[w,A].map(y.appendChild.bind(y));o(y,x,z);return y}function k(x,v,z){var y=document.createElement("div");var w=h(v);var A=d(x);w.classList.add("property-flex__label");A.classList.add("property-flex__value");y.classList.add("property-flex");y.classList.add("inode-property-flex");[w,A].map(y.appendChild.bind(y));o(y,x,z);return y}function q(v){var w=document.createElement("div");w.classList.add("properties-table");w.classList.add("inode-properties-table");v=v.map(function(x){return e(x.key,x.txt,x.val)});v.map(w.appendChild.bind(w));return w}function o(y,v,x){var w=y.querySelector('*[model-key="'+v+'"]');if(!w){return}var z=!!x;if(z){w.parentElement.classList.add("property-row--visible")}else{w.parentElement.classList.remove("property-row--visible")}w.textContent=x}function m(D){var w=D.model;var A=new r(D);var B=A.destroy;var x;var E={"onChange:alias":y("alias",c),"onChange:fileExtension":y("fileExtension",w.getNLSType.bind(w)),"onChange:size":y("size",u),"onChange:modifiedDate":y("modifiedDate",t),"onChange:createdDate":y("createdDate",p),"onChange:owners":y("owner",w.getOwnerNames.bind(w)),"onChange:description":y("description"),"onChange:contentVersions":y("contentVersions"),"onChange:inodeVersions":y("contentVersions"),"onChange:visibility":y("visibility",a)};function y(G,F){return function(H,I){if(typeof F==="function"){I=F(w)}o(A.container,G,I)}}function z(K){var J=K.collection?K.collection._parentInode:undefined;if((f.getValue("is3DSpaceWidget")!=="true")||(f.getValue("is3DSpaceWidget")==="true"&&J&&J.id==="myCollabSpaces")){var H=[{key:"fileExtension",txt:i.type,val:K.getNLSType()},{key:"owner",txt:i.owner,val:K.getOwnerNames()},{key:"createdDate",txt:i.dateCreated,val:p(K)},{key:"modifiedDate",txt:i.dateModified,val:t(K)},{key:"description",txt:i.description,val:K.get("description")}];if((f.getValue("is3DSpaceWidget")==="true")){if(K&&K.get("parentId")===j){var G=[{key:"name",txt:i.name,val:K.get("name")}],F=[];F.push({key:"visibility",txt:i.visibility,val:K.get("visibility").value},{key:"family",txt:i.family,val:K.get("family").name})}H=G.concat(H,F)}else{var I=u(K);if(!K.isContainer()&&I){H.splice(1,0,{key:"size",txt:i.size,val:I})}H.push({key:"oldParentFolder",txt:i.description,val:K.get("oldParentFolder")});if(K.get("alias")){H.splice(0,0,{key:"originalName",txt:i.originalName,val:K.get("title")},{key:"alias",txt:i.alias,val:K.get("alias")})}}return H}else{if(K.get("parentId")===undefined||K.get("parentId")==="trueRootId"){return[]}}}function v(M){A.stopListening();A.listenTo(w,E);var F=A.container;var N=z(w);if((f.getValue("is3DSpaceWidget")!=="true")||(f.getValue("is3DSpaceWidget")==="true"&&(w.collection&&w.collection._parentInode.id==="myCollabSpaces")||w.id==="myCollabSpaces")){if(F.childNodes.length<1){F.appendChild(q(N))}}else{var H=[];if(M){w=M}var L=new b({metatype:"businessobject",tenant:w.drive.id,objectId:w.get("id")});if(!x){x=new l({typeOfDisplay:n.ONLY_EDIT_PROPERTIES,selectionType:n.NO_SELECTION,extraNotif:true,editMode:false});H.push(L);x.initDatas(H);var K=x.elements.container.elements.container.getElementsByClassName("EP_ContainerProperties")[0];var G=x.elements.container.elements.container.getElementsByClassName("formSections")[0];var I=x.elements.container.elements.container.getElementsByClassName("EP_ScrollerProperties")[0];var J=x.elements.container.elements.container.getElementsByClassName("IDCardInnerBottomArea")[0];if(J){K.appendChild(G);I.remove();J.appendChild(K);J.inject(F)}else{F.appendChild(K)}}else{x.onRefresh();H.push(L);x.initDatas(H)}}return A}function C(){A.scroller=null;A.stopListening();w=null;E=null;B.apply(A,arguments);A.container=null;A.model=null;D=null}A.container.classList.add("inode-detail-properties");return Object.assign(A,{render:v,destroy:C})}return m});define("DS/W3DContentApp/Views/InodeDetailView/inodePropertiesViewContainer",["UWA/Class/View","DS/UIKIT/Scroller","DS/W3DDrive/Metas/3DSpace/inode","DS/W3DContentApp/Views/InodeDetailView/inodeDetailVersionsView","DS/W3DContentApp/Views/InodeDetailView/inodeDetailPropertiesView","css!DS/W3DContentApp/W3DContentApp.css"],function(g,a,f,b,e){var c=f();var d=c.ids.myCollabSpaces;return function(i){var k=new g();var h=k.destroy;var n=i.model.collection?i.model.collection._parentInode:undefined;var j=e(i);var l=k.render;var m;k.elements.propertiesView=j;k.container.appendChild(j.container);j.container.classList.add("inode-detail__body");if((n&&n.get("parentId")===d&&i.model.get("type").value.toUpperCase()==="DOCUMENT")||(i.model.hasOwnProperty("inodeVersions"))){m=b(i);k.container.appendChild(m.container);m.container.classList.add("inode-detail__body")}new a({element:k.container});return Object.assign(k,{render:function(){j.render();if(m){m.render()}l()},destroy:function(){if(m){m.destroy()}h.apply(k,arguments);k.container=null;k.stopListening();k.model=null}})}});define("DS/W3DContentApp/Views/InodePanelView/inodeTopBarView",["DS/W3DDrive/InodeActions","DS/W3DContentApp/Utils/stopPropagationDropdownMenu","DS/W3DContentApp/Views/InodePanelView/inodeTopBarViewFunc","DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/widget","css!DS/W3DContentApp/W3DContentApp.css"],function(f,a,c,b,e){function d(q){var i=q.model;var r=i.drive;var l;var m=c.getView(q);var n=m.destroy;var j=false;m.elements.fixediconbar=c.createFixedIconbar();m.elements.actionBarWrapper=c.wrapActionBar();var u={"onChange:title":function(v,x){var w=r[(v.isContainer()?"getInodePanelContentURI":"getInodePreviewURI")](v);c.refreshBreadcrumpElem({target:c.getBreadcrumpElem({target:m.container,uri:w}),title:x});o()},"onChange:alias":function(v,x){var w=r[(v.isContainer()?"getInodePanelContentURI":"getInodePreviewURI")](v);c.refreshBreadcrumpElem({target:c.getBreadcrumpElem({target:m.container,uri:w}),title:x});o()},"onChange:parentId":function(v,w){setTimeout(function(){h()},1000)}};var t={onSync:function(v){var w=v._parentInode?v._parentInode:v.collection._parentInode;c.refreshUploadButtonContainer({target:m.elements.actionBarWrapper,model:w})},onRemove:function(w){var v=w.collection._parentInode;c.refreshUploadButtonContainer({target:m.elements.actionBarWrapper,model:v})}};function o(){if(window.requestAnimationFrame){l=requestAnimationFrame(v)}else{setTimeout(v)}function v(){var w=m.elements.iconbar;if(!w){return}w.resize()}}function k(x){var v,w;x=[].concat(x);if(m.elements.iconbar){m.elements.iconbar.destroy();m.elements.iconbar=null;delete m.elements.iconbar}w=m.elements.fixediconbar=c.createFixedIconbar();c.refreshFixedIconBarContainer(m.container,{iconbarElem:w&&w.elements.container});if(x.length){v=m.elements.iconbar=c.createIconbar(c.getIconbarItems(x))}if(v){c.refreshIconBarContainer(m.container,{iconbarElem:v&&v.elements.container})}}function g(v){c.refreshUploadButtonState(m.elements.actionBarWrapper,v)}function h(){m.stopListening();m.stopListening(i);m.stopListening(i,u);m.listenTo(i,u);m.listenTo(i.inodeTable,t);setTimeout(function(){if(j){b.listenToHierarchy(m,i,u)}},1000);if(j){while(m.container.firstChild){m.container.removeChild(m.container.firstChild)}}var v=(i.isContainer()?i:i.collection.dot());r.getInodesPath(v.id).then(function(z){var A=new f({model:i,context:"topbar"});var w=A.toJSON();z.shift();var y=z.reduce(function(D,F,B){var C=r.getInodePanelContentURI(F);var E=(B===(z.length-1));D[C]={title:F.get("alias")||F.get("title"),withOpenDown:(E&&w.length)};return D},{});c.refreshUploadButtonContainer({target:m.elements.actionBarWrapper,model:i});c.refreshBreadcrump({target:m.container,opts:y});var x=m.container.querySelector(".breadcrumb__elem-open-down");if(w.length&&x){m.elements.dropdown=new a({target:x,items:w})}c.refreshFixedIconBarContainer(m.container,{iconbarElem:m.elements.fixediconbar&&m.elements.fixediconbar.elements.container});o()});[c.createUploadButtonContainer(),c.getIconBarContainer(),c.getFixedIconBarContainer()].reduce(function(w,x){w.appendChild(x);return w},m.elements.actionBarWrapper);[c.createBreadcrump(),m.elements.actionBarWrapper].reduce(function(w,x){w.appendChild(x);return w},m.container);j=true;return m}function p(){if(l){window.cancelAnimationFrame(l)}l=null;this.stopListening();this.undelegateDOMEvents();j=false;m.elements.actionBarWrapper.parentNode.removeChild(m.elements.actionBarWrapper);delete m.elements.actionBarWrapper;n.apply(m,arguments);this.elements=null;this.model=null;q=null;r=null;i=null;this.container=null;e.removeEvent("onInodePanelSideBarVisibilityToggled",s)}m.delegateDOMEvents({"click .breadcrumb__elem-title":function(v){v.preventDefault()}});e.addEvent("onInodePanelSideBarVisibilityToggled",s);function s(v){c.updateIconbarInfoColor(m.elements.actionBarWrapper.querySelector(".top-bar__iconbar-container--fixed"),v)}return Object.assign(m,{refreshIconBarActions:k,toggleUploadButtonState:g,render:h,destroy:p})}return d});define("DS/W3DContentApp/Views/InodeDetailView/advancedView",["DS/i3DXPnOMultiOrg/OrgOperatorController","DS/W3DContentApp/BusEvent","DS/W3DDrive/Actions/Share/share","DS/UIKIT/Input/Button","DS/W3DDrive/widget","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DDrive/W3DDrive.css"],function(i,h,b,e,d,j){return{createMultiOrgButton:f,multiOrgClick:g};function f(l){var k=new e({value:j.advanced,className:"primary multiOrgBtn"});k.addEvent("onClick",function(){g(l)});return k}function g(m){function l(n){var o=j.replace(j.addMemberTo,{title:n.get("title")});b(n,{title:o,onComplete:function(r,q){var p=[r[0],q];p=p.concat(orgOperatorController);h.dispatchEvent("inodeActions:onShareCS",p)}})}var k=document.createElement("div");k.classList.add("multiOrg");k.classList.add("multiOrg--visible");d.body.appendChild(k);window.selectedInode=m;window.orgOperatorController=new i({container:k,tenantId:m._auth.platformId,currentUser:m.drive.get("user").id,collabSpace:m.id,securityContext:c(m),owner:a(m).isOwner,ownerRestricted:a(m).isOwnerRestricted,spaceUrl:m._auth.platform.url3DSpace,swymUrl:m._auth.platform.urlSwym,mainOwner:m.get("owners").login,roles:m.drive.get("availableRoles"),onAddUsers:function(){l.call(this,selectedInode)},onCloseView:function(){document.querySelector(".multiOrg").destroy();h.dispatchEvent("inodeDetailView:onAccess",selectedInode);d.removeEvents({onLoad:orgOperatorController.load.bind(orgOperatorController),onRefresh:orgOperatorController.refresh.bind(orgOperatorController),onDestroy:orgOperatorController.destroy.bind(orgOperatorController)});orgOperatorController.destroy();orgOperatorController=null}});m.listenTo(orgOperatorController,"onRemoveUser",function(o){var q=this.permissions;for(var p=0;p<q._models.length;p++){var n=q._models[p];if(n.get("people").login.toLowerCase()===o.toLowerCase()){q.remove(n);break}}});d.addEvents({onLoad:orgOperatorController.load.bind(orgOperatorController),onRefresh:orgOperatorController.refresh.bind(orgOperatorController),onDestroy:orgOperatorController.destroy.bind(orgOperatorController)})}function c(m){var n=m.get("contexts"),l,k;if(n.length>1){for(l=0;l<n.length;l++){k=n[l];if(k.role==="VPLMProjectAdministrator"){break}if(k.role==="3DSRestrictedOwner"){break}}return k.name}else{return n[0].name}}function a(n){var p=n.get("contexts"),m;var k,o;for(var l=0;l<p.length;l++){m=p[l];if(m.ocdx==="VPLMProjectAdministrator"){k=true;break}if(m.ocdx==="3DSRestrictedOwner"){o=true;break}else{k=false;o=false}}return{isOwner:k,isOwnerRestricted:o}}});define("DS/W3DContentApp/Views/InodeDetailView/inodeDetailAccessGroupView",["UWA/Class/View","DS/W3DXComponents/Views/Layout/ScrollView","DS/UIKIT/Iconbar","DS/UIKIT/Spinner","DS/W3DDrive/InodeActions","DS/W3DDrive/Metas/inode","DS/W3DContentApp/Views/InodeDetailView/permissionsView","DS/W3DContentApp/Views/InodeDetailView/advancedView","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DContentApp/W3DContentApp.css","css!DS/UIKIT/UIKIT.css"],function(a,e,c,d,l,g,j,i,n){var k=g();var f=true;return function(r){var v=r.model;var q=v.userGroups;var p=new a(r);var o=p.destroy;var s={onSync:function(){h(p)},onReset:function(){m(p)}};var u=new l({model:v,context:"access"});var t=u.toJSON();p.elements.scrollView=new e({className:"inode-access__scroll",useInfiniteScroll:false,usePullToRefresh:false,view:j({isGroups:true,collection:q})});p.elements.spinner=new d({className:"inode-access__spinner"});p.elements.iconbar=new c({className:"inode-access__topbar",items:t.filter(function(w){return(w.id===k.actionPubIds.share)||(w.id===k.actionPubIds.addMember)||(w.id===k.actionPubIds.addMemberRestricted)}).map(function(x){var w=x.handler;return Object.assign(x,{fonticon:"users-group-add",handler:function(){w({shareTab:"group"})},text:n.addGroupsBtn})})});if(v.isCollabSpace()){p.elements.buttonMO=i.createMultiOrgButton(v)}p.container.classList.add("inode-access-link");p.listenTo(q,s);if(q.isEmpty()){m(p)}return Object.assign(p,{render:function(){b({view:p})},destroy:function(){p.stopListening();o.apply(p,arguments)}})};function b(q){var p=q.view;var o=p.container;var r=p.elements;o.setContent([]);if(q.view.model.isCollabSpace()&&f){o.setContent([r.buttonMO,r.iconbar,r.spinner,r.scrollView])}else{o.setContent([r.iconbar,r.spinner,r.scrollView])}r.scrollView.render();return p}function m(p){var o=p.container;var q=p.elements.spinner;o.classList.add("loading");q.show()}function h(o){setTimeout(function(){var p=o.container;var q=o.elements.spinner;p.classList.remove("loading");if(!q){return}q.hide()},80)}});define("DS/W3DContentApp/Views/DriveView/driveDetailViewFunc",["UWA/Core","UWA/Class/View","UWA/String","DS/UIKIT/Input/Button","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/BusEvent","i18n!DS/W3DContentApp/assets/nls/W3DContentApp"],function(j,b,f,i,o,l,p){function h(q){q=q||0;return o.computeNLSSize(q)}function g(r,q){return f.format("{0} %",q?Math.round(r*100/q):0)}function k(t){var u=j.createElement("div",{"class":"account-detail"});if(!t||(typeof t.get!=="function")){return u}var q=t.get("user"),s="",r="";if(q){s=q.displayName||"";r=q.emailAddress||""}u.setContent([{tag:"h5",text:p.account},{tag:"div","class":"name",text:s},{tag:"div","class":"email",text:r}]);return u}function n(s,q,r){var u=j.createElement("div",{"class":"account"});if(!s||(typeof s.get!=="function")||(typeof q!=="function")){return u}var t=[q(s)];if(r){t.push(r)}u.setContent(t);return u}function a(r){var q=document.createElement("div");var t=document.createElement("h5");var s=document.createElement("div");q.classList.add("legal");var u=r.getLegalInfo();if(u){t.textContent=p.legalTitle;s.innerHTML=u}q.appendChild(t);q.appendChild(s);return q}function d(u,t,q){var w=j.createElement("div",{"class":"storage"});if(!u||(typeof u.get!=="function")||(typeof t!=="function")||(typeof q!=="function")){return w}var r=u.get("quotaBytes"),s=0,v=0;if(r){s=r.used||0;v=r.total||0}w.setContent([{tag:"h5",text:p.storage},{tag:"div",html:[{tag:"span","class":"used",text:t(s)},{tag:"span","class":"total",text:t(v)},{tag:"span","class":"percent",text:q(s,v)}]}]);return w}function c(r,s,q){return function(){if(!r||!(r.container instanceof window.HTMLElement)||typeof s!=="function"){return r}var t=r.container.querySelector(""+q);if(!t){return r}o.replaceWith(t,s());return r}}function m(v,r,u){var q=new b(Object.assign({},v));q.container.addClassName("w3ddrive drive-detail");var s=v.model;if(!s){return q}var t={};if(typeof r==="function"){t["onChange:user"]=r}if(typeof u==="function"){t["onChange:quotaBytes"]=u}q.listenTo(s,t);q.destroy=function(){q.stopListening();q.container=null;q.model=null;v=null};return q}function e(q){var r=new i({value:"Remove",className:"warning account-remove"});r.addEvent("onClick",function(){if(!q||!q.dispatchEvent||!q.model){return}q.dispatchEvent("onRemove",[q.model]);l.dispatchEvent("driveDetailView:onRemove",[q.model])});return r}return{toSizeStr:h,toPercentStr:g,createLegal:a,createAccountDetailElem:k,createAccountElem:n,createStorageElem:d,getRefreshElem:c,getView:m,getRemoveButton:e,}});define("DS/W3DContentApp/Views/DriveView/driveDetailView",["UWA/Utils","DS/W3DContentApp/Views/DriveView/driveDetailViewFunc","css!DS/W3DContentApp/W3DContentApp.css"],function(c,b){function a(l){var j;var m=l.model;var k=function(){return b.createAccountElem(m,b.createAccountDetailElem)};var d=function(){return b.createStorageElem(m,b.toSizeStr,b.toPercentStr)};var f=function(){return b.createLegal(m)};function g(){c.setImmediate(b.getRefreshElem(j,k,".account"))}function e(){c.setImmediate(b.getRefreshElem(j,f,".legal"))}function i(){c.setImmediate(b.getRefreshElem(j,d,".storage"))}j=b.getView(l,g,e,i);var h=j.destroy;return Object.assign(j,{render:function(){j.container.setContent([k(),d(),f()]);return j},destroy:function(){m=null;k=null;f=null;d=null;g=null;i=null;j.stopListening();return h.apply(j,arguments)}})}return a});define("DS/W3DContentApp/Views/InodeDetailView/inodeDetailViewFunc",["UWA/Class/View","UWA/String","DS/W3DDrive/Metas/inode","DS/W3DContentApp/Views/InodeDetailView/inodeDetailAccessView","DS/W3DContentApp/Views/InodeDetailView/inodeDetailSocialView","DS/W3DDrive/Utils/ViewsRestrictions","DS/W3DDrive/Views/inodeDetailAnalyticsView","DS/W3DContentApp/Views/InodeDetailView/inodePropertiesViewContainer","DS/W3DDrive/Views/inodeDetailAccessLinkView","DS/W3DContentApp/Views/InodeDetailView/inodeDetailAccessGroupView","DS/W3DDrive/widget","DS/UIKIT/Tooltip","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(I,J,E,K,s,d,m,b,L,C,A,z,i){var c="inode-detail-properties";var p="inode-detail-access";var t="inode-detail-comments";var f="inode-detail-analytics";var o="inode-detail-access-link";var a="inode-detail-access-group";var w="inode-detail-view";var y={};y[p]=K;y[c]=b;y[t]=s;y[f]=m;y[o]=L;y[a]=C;var h=E();d.setPossibleRestrictions(w,[c,p,t,o,a]);function H(M){if(M===t){return h.actionPubIds.comment}if(M===p){return h.actionPubIds.viewPermissions}if(M===f){return h.actionPubIds.viewAnalytics}if(M===o){return h.actionPubIds.viewPermissionsLink}if(M===a){return h.actionPubIds.viewPermissionsGroup}return}function v(M,N){var O=H(M);if(!O){return M}if(N.isActionIdoK(O)){return M}}function u(M,N){M=v(M,N);if(!M){return c}return M}function j(N,M){var P=document.createElement("div");var O=document.createElement("span");O.classList.add("fonticon");O.classList.add("fonticon-close");O.classList.add("inode-detail__header-icon");new z({target:O,body:i.close});if(M&&typeof M.onClickCloseIcon==="function"){O.addEventListener("click",M.onClickCloseIcon)}P.classList.add("inode-detail__header");q(P,N.get("alias")?N.get("alias"):N.get("title"));P.insertBefore(O,P.firstChild);P.destroy=function(){if(typeof M.onClickCloseIcon!=="function"){return}O.removeEventListener("click",M.onClickCloseIcon)};return P}function q(M,N){if(!M.classList.contains("inode-detail__header")){M=M.querySelector(".inode-detail__header")}if(!M){return M}M.textContent=N;return M}function n(M){if(!M||M.nodeType!==Node.ELEMENT_NODE){return}if(!M.classList.contains("navigation__data")){M=M.querySelector(".navigation__data");if(!M){return}}return M.getAttribute("data-key")}function e(O){var R=document.createElement("li");var N=document.createElement("span");var P=document.createElement("span");var Q=document.createElement("span");N.textContent=O.label||"";N.classList.add("navigation__label");Q.setAttribute("data-key",O.key||"");P.classList.add("navigation__icon");P.classList.add("fonticon");P.classList.add(J.format("fonticon-{0}",O.icon||""));var M=new z({target:R,body:O.nls});R.classList.add("navigation__header");Q.classList.add("navigation__data");if(O.selected){R.classList.add("navigation__header--selected")}[P,N,Q].map(function(S){R.appendChild(S)});return R}function D(N){var M=document.createElement("ul");M.classList.add("navigation");[].concat(N).map(function(O){M.appendChild(O)});return M}function G(N,P){var O=[];if(d.getRestriction(w,c)!==true){O.push({key:c,nls:i.properties,icon:"doc-text",selected:(N===c)})}if(d.getRestriction(w,p)!==true){O.push({key:p,nls:(A.getValue("is3DSpaceWidget"))?i.members:i.access,icon:"users",selected:(N===p)})}if(d.getRestriction(w,o)!==true){O.push({key:o,nls:i.access_link,icon:"link",selected:(N===o)})}if(d.getRestriction(w,a)!==true){O.push({key:a,nls:i.groups,icon:"users-group",selected:(N===a)})}if(d.getRestriction(w,t)!==true){O.push({key:t,nls:i.comments,icon:"comment",selected:(N===t)})}if(d.getRestriction(w,f)!==true){O.push({key:f,nls:i.analytics,icon:"chart-bar",selected:(N===f)})}O=O.filter(function(Q){return v(Q.key,P)}).map(e);if(O.length>2){O[0].classList.add("navigation__header--left");O[O.length-1].classList.add("navigation__header--right")}var M=D(O);M.classList.add("inode-detail__navigation");return M}function B(O,M){var N=O.querySelector(".navigation__data[data-key="+M+"]");if(!N){return}return N.parentNode}function k(P,N){var O=B(P,N);if(!O){return}var M=O.parentNode.parentNode;var Q=M.querySelector(".navigation__header--selected");if(!Q||O===Q){return}if(Q){Q.classList.remove("navigation__header--selected")}O.classList.add("navigation__header--selected")}function r(M){return M.getAttribute("data-key")}function l(M){var N=document.createElement("div");N.classList.add("inode-detail__body-wrapper");N.appendChild(M);return N}function F(O,N){var P=y[O];if(typeof P!=="function"){return}var M=P(N);M.container.classList.add("inode-detail__body");M.container.setAttribute("data-key",O);return M}function g(O,N){if(!O.classList.contains("inode-detail__body")){O=O.querySelector(".inode-detail__body")}var M=O.parentNode;M.removeChild(O);M.appendChild(N.container);N.render();return N}function x(N){var M=new I(N);M.container.classList.add("inode-detail");return M}return{createHeader:j,refreshHeader:q,getActionIdFromHeaderKey:H,getNavigationHeaderKey:n,filterValidKey:v,getValidKey:u,createNavigation:G,getNavigationHeaderWithKey:B,refreshNavigation:k,getBodyElemKey:r,wrapBody:l,createBody:F,refreshBodyWithView:g,getView:x,propertiesKey:c,accessKey:p,commentsKey:t,analyticsKey:f,accessLinkKey:o,accessGroupKey:a}});define("DS/W3DContentApp/Views/InodeDetailView/permissionsView",["UWA/Class/Promise","UWA/Core","DS/WebAppsFoundations/Views/CollectionView","DS/W3DContentApp/Views/InodeDetailView/permissionItemView","DS/W3DXComponents/Views/EmptyView","i18n!DS/W3DContentApp/assets/nls/W3DContentApp","css!DS/W3DContentApp/W3DContentApp.css"],function(e,g,b,d,a,f){function c(i){var j=f.notShared;var h=new b({className:"w3ddrive permissions w3dx tiles fixed relaxed",collection:i.collection,emptyView:new a({icon:"lock",title:j})});return Object.assign(h,{_buildItemView:function(k){return d({isGroup:i.isGroups,model:k})}})}return c});define("DS/W3DContentApp/Views/InodeDetailView/permissionsScrollView",["DS/W3DContentApp/Views/InodeDetailView/permissionsView","DS/W3DXComponents/Views/Layout/ScrollView","DS/UIKIT/Spinner","css!DS/W3DContentApp/W3DContentApp.css"],function(c,d,b){function a(g){var j=g.collection,l=c({collection:j}),f=new d({className:"w3ddrive permissions-scroll",useInfiniteScroll:false,usePullToRefresh:false,view:l}),i=new b(),h=f.render,e=f.destroy;function k(m){if(m){f.container.addClassName("loading");i.show()}else{setTimeout(function(){f.container.removeClassName("loading");i.hide()},180)}}f.listenTo(j,{onSync:function(){k(false)},onReset:function(){k(true)}});if(j.isEmpty()){k(true)}return Object.assign(f,{children:l.children,findChildViewByModel:l.findChildViewByModel,render:function(){var m=h.apply(this,arguments);i.inject(f.container,"top");return m},destroy:function(){l.destroy();i.destroy();f.stopListening();f.container=null;f.model=null;g=null;e.apply(f,arguments)}})}return a});define("DS/W3DContentApp/Views/InodeDetailView/versionItemView",["DS/W3DContentApp/Views/itemView","DS/W3DDrive/Models/DSDrive/InodeVersion","DS/W3DDrive/Actions/Iterations/iterationActionsFactory","DS/W3DContentApp/Utils/Helpers"],function(f,h,e,d){var c=1;var a=0;var b;function g(l){var k;var j=l.model;var p={model:j};var i;var o={"onChange:thumbnail":m};function m(){p.image=j.get("thumbnail");i.render()}function n(){var q={id:"physicalid",title:"title",metas:"iteration",};Object.keys(q).map(function(r){p[r]=j.get(q[r])});if(j instanceof h){p.title=d.getDateStr(new Date(parseInt(j.get("modified"))*1000));p.metas=j.get("fullnameowner");p.image=j.get("thumbnail")}else{if(b!==j.get("masterid")){a=1;b=j.get("masterid");c=a}else{if(j.collection.length===a){c=a}else{a++;c=a}}p.metas="Iteration "+c}p.actions=e({iteration:j}).toJSON()}n();i=f(p);i.listenTo(j,o);k=i.destroy;i.container.addClassName("permission-item");return Object.assign(i,{destroy:function(){j=null;if(p.actions){p.actions.model=null}p=null;return k.apply(i,arguments)}})}return g});define("DS/W3DContentApp/Views/DriveView/driveView",["DS/W3DContentApp/Views/DriveView/driveItemView","DS/W3DContentApp/Views/DriveView/driveTreeViewWithDocument","DS/W3DContentApp/Views/DriveView/driveViewPattern","DS/W3DContentApp/BusEvent"],function(c,d,b,e){function a(i){var j=i.model;var k=c({model:j});var h=d();var g=b({model:j,header:k,authenticatedBody:h});var f=h.getXSO();f.onAdd(function(){var l=f.get().filter(function(m){return m.isSelectionChangeFromUI()});if(!l.length){return}e.dispatchEvent("driveView:onNodeClick",l.map(function(m){return m.inode}))});return Object.assign(g,{refreshSelected:k.refreshSelected,expandInodesPath:h.expandInodesPath,toggleExpand:k.toggleExpand,expand:k.expand,collapse:k.collapse})}return a});define("DS/W3DContentApp/Views/InodeDetailView/versionsView",["DS/WebAppsFoundations/Views/CollectionView","DS/W3DContentApp/Views/InodeDetailView/versionItemView","css!DS/W3DContentApp/W3DContentApp.css"],function(a,c){function b(e){var d=new a({className:"w3ddrive versions w3dx tiles fixed relaxed",collection:e.collection});return Object.assign(d,{_buildItemView:function(f){return c({model:f})}})}return b});define("DS/W3DContentApp/Views/InodeDetailView/inodeDetailVersionsView",["UWA/Class/View","DS/W3DContentApp/Views/InodeDetailView/versionsView","i18n!DS/W3DContentApp/assets/nls/W3DContentApp","css!DS/W3DContentApp/W3DContentApp.css","css!DS/UIKIT/UIKIT.css"],function(d,b,c){function a(o){var g=o.model;var h;var n=false;var i=false;if(g.hasOwnProperty("inodeVersions")){h=g.inodeVersions;n=true;i=true}else{h=g.get("contentVersions")}var l=new d(o);var m=l.destroy;var k=b({collection:h});var j=UWA.createElement("div",{text:c.noHistory,visible:false});function e(p){i=p;if(i===true){h.reset();k.hide();j.hide()}else{h.fetch({onComplete:function(){if(h.length>0){k.show()}else{j.show()}}})}}function f(){var p=l.container;var q=l.elements;if(n){e(i);p.setContent([UWA.createElement("button",{"class":"btn btn-link",text:c.showHistory,events:{click:function(s){e(!i);this.innerText=(i===true)?c.showHistory:c.hideHistory}}}),j,k])}else{var r=document.createElement("div");r.classList.add("headerVersion");r.textContent=c.iterations;p.setContent([r,k])}k.render();return l}l.container.classList.add("inode-version");if(n){l.container.classList.add("file-history")}return Object.assign(l,{render:f,destroy:function(){m.apply(l,arguments);g=null;h=null;k.destroy();l.model=null;l.container=null;l.stopListening()}})}return a});define("DS/W3DContentApp/Views/DrivesPanelView/drivesView",["UWA/Core","DS/WebAppsFoundations/Views/CollectionView","DS/W3DContentApp/Views/setOfSelectedItemView","DS/W3DContentApp/Views/DriveView/driveView","DS/W3DContentApp/BusEvent","css!DS/W3DContentApp/W3DContentApp.css"],function(d,b,f,a,e){function c(h){var j=h.collection;var g=new b({className:"w3ddrive drives",collection:j,filterer:function(l){return l.get("granted")}});var k=f();function i(){g.children.map(function(l){l.collapse()});k.map(function(l){l.expand()});e.dispatchEvent("drivesView:onChangeSelection",[k.toArray()])}g.listenTo(j,"onChange:granted",g.filter);g.listenTo(j,"onChange:authenticated",function(l){var m=g.findChildViewByModel(l);if(k.contains(m)&&!l.get("authenticated")){k.remove(m)}});g.listenTo(k,{onAdd:i,onReset:i,onRemove:i});g.listenTo(e,"driveView:onClick",function(l){var m=g.findChildViewByModel(l);if(k.contains(m)){m.toggleExpand()}else{e.dispatchEvent("drivesView:onWannaChangeSelection",[l])}});return Object.assign(g,{_buildItemView:function(l){return a({model:l})},selectedChildren:k})}return c});define("DS/W3DContentApp/Views/InodeDetailView/inodeDetailView",["UWA/Utils","DS/W3DContentApp/Views/InodeDetailView/inodeDetailViewFunc","DS/W3DContentApp/BusEvent","DS/W3DDrive/widget","css!DS/W3DContentApp/W3DContentApp.css"],function(c,b,e,a){function d(n){n=n||{};var k=b.getView(n);var f=n.model;var l=k.destroy;var j={"onChange:title":function(o,p){b.refreshHeader(k.container,p);k.elements.bodyView.elements.propertiesView.render(o)},"onChange:description":function(o){k.elements.bodyView.elements.propertiesView.render(o)},"onChange:alias":function(o,p){b.refreshHeader(k.container,p)},"onChange:actions":function(o){g()}};var h=false;function i(p){var o=k.elements.bodyView;if(o){if(p===b.getBodyElemKey(o.container)){return o}c.setImmediate(function(){o.destroy()})}k.elements.bodyView=b.createBody(p,{model:f});if(p===b.accessKey){e.dispatchEvent("inodeDetailView:onAccess",[f])}if(p===b.analyticsKey){e.dispatchEvent("inodeDetailView:onAnalytics",[f])}if(p===b.accessLinkKey){e.dispatchEvent("inodeDetailView:onAccessLink",[f])}if(p===b.accessGroupKey){e.dispatchEvent("inodeDetailView:onAccessGroup",[f])}return k.elements.bodyView}function g(){k.stopListening();k.listenTo(f,j);if(!h){}else{while(k.container.firstChild){k.container.removeChild(k.container.firstChild)}}var p=b.getValidKey(a.getValue("inodeDetailViewKey"),f);var o=i(p);k.elements.header=b.createHeader(f,n.headerOptions);var q=[k.elements.header,b.createNavigation(p,f),b.wrapBody(o.container)];q.map(function(r){k.container.appendChild(r)});o.render();h=true;return k}function m(){k.stopListening();h=false;k.undelegateDOMEvents();l.apply(k,arguments);k.container=null;k.model=null}k.delegateDOMEvents({"click .navigation__header":function(o){var p=b.getNavigationHeaderKey(o.target);p=b.getValidKey(p,f);b.refreshNavigation(k.container,p);b.refreshBodyWithView(k.container,i(p));a.dispatchEvent("onUpdateInodeDetailViewKey",p)}});return Object.assign(k,{render:g,destroy:m})}return d});define("DS/W3DContentApp/Views/DrivesPanelView/drivesScrollView",["DS/W3DContentApp/Views/DrivesPanelView/drivesView","DS/W3DXComponents/Views/Layout/ScrollView","css!DS/W3DContentApp/W3DContentApp.css"],function(c,b){function a(e){var f=e.collection,g=c({collection:f}),d=new b({className:"w3ddrive drives-scroll",useInfiniteScroll:false,usePullToRefresh:false,view:g});return Object.assign(d,{selectedChildren:g.selectedChildren,children:g.children,findChildViewByModel:g.findChildViewByModel})}return a});define("DS/W3DContentApp/Views/DrivesPanelView/drivesPanelView",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/W3DContentApp/Views/DrivesPanelView/drivesScrollView","DS/W3DDrive/widget","DS/W3DContentApp/BusEvent","DS/W3DDrive/Utils/SystemDetection","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DContentApp/W3DContentApp.css"],function(g,a,e,i,c,d,h,f,k){function j(){var l=g.createElement("div",{"class":"controller",events:{click:function(m){d.dispatchEvent("onToggleDrivePanelSideBarCollapsed");m.stopPropagation()}}});l.setContent([{tag:"span","class":"fonticon fonticon-close"}]);new i({target:l,body:k.close});return l}function b(v){var u=v.collection;var r=new a({className:"w3ddrive drives-panel drives-panel--one-drive-not-granted"});var s=r.destroy;var q=c({collection:u});var l;if(!d.getValue("is3DSpaceWidget")&&f.isWindows()){l=new e({value:k.checkingInstall,className:"link block download-app",icon:"install"});var o;require(["DS/i3DXCompassServices/i3DXCompassPubSub"],function(x){o=setTimeout(function(){w({nls:k.install,style:"primary",handler:"onInstallApp"})},25000);x.publish("detectInstallApp",{appId:"X3DDRVN_AP"},function(y){clearTimeout(o);t(y)})});function w(x){if(x.icon){l.setIcon(x.icon)}l.setValue(x.nls);l.setClassName(x.style);l.elements.container.addClassName("btn-block download-app");l.elements.container.addEventListener("click",function(){h.dispatchEvent("driveActions:"+x.handler)})}function t(x){if(x&&!x.error){w({icon:"refresh",nls:k.refreshConfiguration,style:"default",handler:"onLaunchApp"})}else{if(x&&x.error==="recommended_update"){w({nls:k.updateInstall,style:"info",handler:"onInstallApp"})}else{if(x&&x.error==="mandatory_update"){w({nls:k.updateInstall,style:"warning",handler:"onInstallApp"})}else{w({nls:k.install,style:"primary",handler:"onInstallApp"})}}}}}var p=j();var n;function m(){var x=r.container;if(n){while(x.firstChild){x.removeChild(x.firstChild)}}var y=[p,q.container];if(!d.getValue("is3DSpaceWidget")&&f.isWindows()){y.unshift(l.elements.container)}y.map(function(z){x.appendChild(z)});q.render();n=true;return r}return Object.assign(r,{selectedChildren:q.selectedChildren,children:q.children,findChildViewByModel:q.findChildViewByModel,render:m,destroy:function(){q.destroy();return s.apply(r,arguments)}})}return b});define("DS/W3DContentApp/Views/InodePanelView/inodePanelViewFunc",["UWA/Class/View","DS/W3DContentApp/Views/InodeDetailView/inodeDetailView","DS/W3DContentApp/Views/InodePanelView/inodeTableScrollView","DS/W3DContentApp/Views/InodePanelView/inodeTopBarView","DS/W3DDrive/widget"],function(I,p,h,D,A){var r=Object.freeze({multiSelection:"inode-panel--multi-select-active",ctrlSelection:"inode-panel--ctrl-select-active",shiftSelection:"inode-panel--shift-select-active",item:"inode-item",focusedItem:"inode-item--focused",selectedItem:"selected"});function v(O,L,M){if(!O||!L){throw new Error("you must specify valid classList and className")}var N=O.contains(L);if(N){if(!M){O.remove(L);return true}return false}if(M===false){return false}O.add(L);return true}function o(M,L){if(!M||!M.classList){throw new Error("you must specify a valid target")}return v(M.classList,r.multiSelection,L)}function c(L){if(!L||!L.classList){return false}return L.classList.contains(r.multiSelection)}function i(M,L){if(!M||!M.classList){throw new Error("you must specify a valid target")}return v(M.classList,r.ctrlSelection,L)}function J(L){if(!L||!L.classList){return false}return L.classList.contains(r.ctrlSelection)}function l(M,L){if(!M||!M.classList){throw new Error("you must specify a valid target")}return v(M.classList,r.shiftSelection,L)}function b(L){if(!L||!L.classList){return false}return L.classList.contains(r.shiftSelection)}function B(M){if(!M){return[]}var L=r.selectedItem;return Array.prototype.slice.call(M.querySelectorAll("."+L))}function s(L){if(!L){return}return L.querySelector("."+r.selectedItem)}function F(L,M){if(!L||!L.dataset||!M||!M.get){return}return M.get(L.dataset.model_cid)}function g(M,L){if(!L||!M){return}return M.querySelector("."+r.item+'[data-model_cid="'+L.cid+'"]')}function m(L,M){return B(L).map(function(N){return F(N,M)}).filter(function(N){return !!N})}function K(L){if(!L||!L.classList){throw new Error("you must specify a valid elem")}return L.classList.contains(r.selectedItem)}function q(L,M){if(!L||!L.classList){throw new Error("you must specify a valid elem")}return v(L.classList,r.selectedItem,M)}function a(M){if(!M||!M.classList){throw new Error("you must specify a valid target")}var L=M.parentElement;var N;if(L){N=L.querySelector("."+r.focusedItem)}M.classList.add(r.focusedItem);if(N&&N!==M){N.classList.remove(r.focusedItem)}}function H(L){if(!L){return[]}return Array.prototype.filter.call(L.querySelectorAll("."+r.item),function(M){return M.offsetParent}).map(function(M){return(q(M,true)&&M)})}function n(M){if(!M){return[]}var L=r.item;return Array.prototype.map.call(M.querySelectorAll("."+L),function(N){return(q(N,false)&&N)})}function y(N){if(!N){return}var O=N.parentElement;var L=K(N);var M=[];if(O){M=n(O).filter(function(P){return P})}q(N,((M.length>1)||!L));a(N);return}function d(Q){if(!Q){return}var N=Q.parentElement;if(!N){return}var P=N.querySelector("."+r.focusedItem);var O=Array.prototype.slice.call(N.querySelectorAll("."+r.item));var S=O.indexOf(P);var M=O.indexOf(Q);var R=Math.min(S,M);var L=Math.max(S,M);n(N);while(R<=L){q(O[R],true);R+=1}}function e(M,L){if(!M){return}if(b(L)){d(M);return}if(c(L)||J(L)){q(M);a(M);return}y(M);return}function k(M){var L=D({model:M});L.container.classList.add("inode-panel__top-bar");return L}function f(N,M){if(!N.classList.contains("inode-panel__top-bar")){N=N.querySelector(".inode-panel__top-bar")}if(N===M.container){return}var L=N.parentNode;if(!L){return}L.replaceChild(M.container,N);M.render();return M}function j(M){var L=p({model:M,headerOptions:{onClickCloseIcon:function(){A.dispatchEvent("onToggleInodePanelSideBarVisibility")}}});L.container.classList.add("inode-panel__detail");return L}function u(O,M,N){if(!O.classList.contains("inode-panel__detail")){O=O.querySelector(".inode-panel__detail")}if(!O||(O===M.container)){return}var L=O.parentNode;L.removeChild(O);L.appendChild(M.container);M.render();N.refreshInnerDrawer();return M}function w(M){var L=h(M);L.container.classList.add("inode-panel__content");return L}function E(M){var L=document.createElement("div");L.classList.add("inode-panel__side-bar");if(M){L.appendChild(M)}return L}function G(N,O,M,L){var P=M?293:0;O[L?"translateNoAnim":"translateAnim"](P);N.style["margin-right"]=(P+"px")}function x(M){var L=new I(Object.assign({},M));L.container.classList.add("inode-panel");L.container.classList.add("w3ddrive");L.container.setAttribute("cid",M.model.cid);return L}function z(L,M){if(!M){return[]}if(M.parentNode===document.body||M===L){return[M]}return[M].concat(z(L,M.parentNode))}function C(N,M){var L=N.indexOf(M);if(L===-1){return[]}return N.slice(0,L+1)}function t(N,M){var L=-1;N.some(function(Q,P){var O=Q.classList&&Q.classList.contains(M);if(O){L=P}return O});if(L===-1){return[]}return N.slice(0,L+1)}return{isMultiSelectionModeActive:c,isShifSelectionModeActive:b,toggleCtrlSelectionMode:i,isCtrlSelectionModeActive:J,toggleMultiSelectionMode:o,toggleShiftSelectionMode:l,isElemSelected:K,getSelectedOf:B,getFirstSelectedOf:s,getModelOf:F,getElemOf:g,getSelectedModelsOf:m,selectAll:H,unSelectAll:n,selectAmongItems:e,createTopBar:k,refreshTopBarView:f,createDetail:j,refreshDetailWithView:u,subPathFrom0ToClassName:t,subPathFrom0ToElem:C,buildPathToContainer:z,createContent:w,wrapSideBar:E,getView:x,refreshSideBar:G}});define("DS/W3DContentApp/Views/InodePanelView/inodePanelView",["UWA/Utils","UWA/Array","DS/W3DDrive/InodeActions","DS/W3DDrive/inodesActions","DS/W3DContentApp/Utils/drawerOrchestrator","DS/W3DContentApp/Utils/getKeyboardeventKey","DS/W3DContentApp/Views/InodePanelView/inodePanelViewFunc","DS/W3DContentApp/BusEvent","DS/W3DContentApp/SearchProxy","DS/W3DDrive/W3DDriveTagger6WProxy","DS/W3DDrive/widget","DS/W3DDrive/Collections/3DSpace/ContentVersions","css!DS/W3DContentApp/W3DContentApp.css"],function(d,q,s,r,t,y,w,v,a,m,e,g){var p=500;var h=560;var n="inode-panel__content--responsive";var z="side-bar--responsive";var b="action-bar--responsive";function o(f){return w.toggleMultiSelectionMode(document.querySelector(".inode-panel"),f)}function c(f){return w.toggleCtrlSelectionMode(document.querySelector(".inode-panel"),f)}function u(f){return w.toggleShiftSelectionMode(document.querySelector(".inode-panel"),f)}function i(){return w.selectAll(document.querySelector(".inode-table"))}function l(){return w.unSelectAll(document.querySelector(".inode-table"))}function k(f){return w.selectAmongItems(f,document.querySelector(".inode-panel"))}(function(f){var B;var A;document.body.addEventListener("click",function(C){var D=C.target;if(!D){return}if(D.classList.contains("item__selection_icon")){if(!w.isElemSelected(D.parentElement)){o(true)}k(D.parentElement);return}if(D&&D.classList.contains("inode-item")&&(B!==D)){clearTimeout(A);B=D;A=setTimeout(function(){B=null},(f+10));k(D);return}if(D.classList.contains("breadcrumb__elem-title")){v.dispatchEvent("inodePanelView:onPathClick",[D.getAttribute("href")]);C.preventDefault();return}if(D.classList.contains("iconbar__item--select-on")||(D.parentElement&&D.parentElement.classList.contains("iconbar__item--select-on"))){o();v.dispatchEvent("inodePanelView:ontoggleMultiSelectionMode");return}})})(p);(function(){document.addEventListener("keyup",function(){document.addEventListener("keydown",f)});document.addEventListener("keydown",f);function A(){var B=w.getSelectedOf(document.querySelector(".inode-table"));if(B.length>1){o(true)}else{o(false)}}function f(E){var B=document.querySelector(".inode-panel");if(document.querySelector(".modal")){return}document.removeEventListener("keydown",f);var C=y(E);if(C==="Control"){c(true);document.addEventListener("keyup",G);document.addEventListener("keydown",F)}if(C==="Shift"){u(true);document.addEventListener("keyup",D)}function G(H){if(y(H)==="Control"){c();A();document.removeEventListener("keyup",G);document.removeEventListener("keydown",F)}else{document.addEventListener("keydown",F)}}function F(I){var H=y(I);if(H==="Control"||j(document.activeElement.nodeName)){return}document.removeEventListener("keydown",F);if(H.toLowerCase()==="a"){i();v.dispatchEvent("inodePanelView:CtrlA");I.preventDefault()}}function D(H){if(y(H)==="Shift"){u(false);A();document.removeEventListener("keyup",D)}}}}());function j(A){var f=["input","textarea"];return f.some(function(B){return A.toLowerCase()===B})}function x(H){var L=H.model;var F=L.inodeTable;var N=w.getView(H);var I=N.destroy;var aa=false;var T;var J;N.elements.topBarView=w.createTopBar(L);N.elements.detailView=w.createDetail(L);N.elements.contentView=w.createContent(L);N.elements.detailViewWrapper=w.wrapSideBar(N.elements.detailView.container);var D;var K;function X(ae){var ac=N.elements.topBarView;if(!ac){return}if(!ae||!Array.isArray(ae)){ac.refreshIconBarActions();return}var ad;if(ae.length===1){ad=new s({model:ae[0],context:"topbar"});ac.refreshIconBarActions(ad.toJSON());return}ac.refreshIconBarActions(r.getActionsJSON(ae));return}function W(ac){var ad=N.elements.detailView;if(ad){d.setImmediate(function(){ad.destroy()})}N.elements.detailView=w.createDetail(ac);w.refreshDetailWithView(N.container,N.elements.detailView,T)}function U(ad){var ac=N.elements.topBarView;if(!ac){return}ac.toggleUploadButtonState(ad)}function P(ag){var ae=document.querySelector(".inode-table");var ad;if(ag&&w.isElemSelected(ag)){ad=ag}else{ad=w.getFirstSelectedOf(ae)}var ad=(w.getModelOf(ad,F)||L);var af=w.getSelectedModelsOf(ae,F);U(!af.length>0);d.setImmediate(function(){X(af)});if(e.getValue("is3DSpaceWidget")==="true"){if(ad.get("type")&&ad.get("type").value==="Document"){var ac=new g();ac.id=ad.get("id");ac.parentId=ad.get("parentId");ac._auth=ad._auth;ac.parentCS=ad.collection._parentInode;ac.fetch({reset:true,onComplete:function(ah){ad.set("contentVersions",ah);d.setImmediate(function(){W(ad)})},onFailure:function(ah){console.log(ah)}})}else{d.setImmediate(function(){W(ad)})}}else{d.setImmediate(function(){W(ad)})}v.dispatchEvent("inodePaneView:onChangeSelection",[ad,af])}function G(){i();o(true);P()}function f(){l();P()}function S(ac){var ad=ac.target;if(ad.classList.contains("inode-item")){clearTimeout(K);if(D===ad){D=null;v.dispatchEvent("inodeView:onDblClick",[w.getModelOf(ad,F)]);return}D=ad;K=setTimeout(function(){D=null},p);P(ad);return}if(ad.classList.contains("item__selection_icon")){P(ad.parentElement);return}if(ad.classList.contains("dropdown__item--select-all")||(ad.parentElement&&ad.parentElement.classList.contains("dropdown__item--select-all"))){G();return}if(ad.classList.contains("dropdown__item--select-none")||(ad.parentElement&&ad.parentElement.classList.contains("dropdown__item--select-none"))){f();return}}function M(){var ac=N.elements.contentView;f();ac.view.filter()}function A(){M()}function R(ac){M();if(e.getValue("is3DSpaceWidget")!=="true"){m.updateSubjectsTags()}}function E(){M();m.setSubjectsTagsWithInode(F)}function C(ae){var ad=document.querySelector(".inode-table");var ac=w.getElemOf(ad,ae);if(ac&&!w.isElemSelected(ac)){return}P()}function ab(){document.addEventListener("click",S);N.listenTo(F,{onRemove:C,onReset:function(){P()}});N.listenTo(v,{"inodePanelView:CtrlA":function(){P()},inodeActions:function(){o(false);f()},"inodePanelView:ontoggleMultiSelectionMode":function(){var ac=w.isMultiSelectionModeActive(document.querySelector(".inode-panel"));if(!ac){f()}}});N.listenTo(e,{onInodePanelSideBarVisibilityToggled:function(ac){w.refreshSideBar(N.elements.contentView.container,T,ac)}});N.listenTo(m,{onFilterSubjectsChange:A});N.listenTo(a,{onSetQuery:R,onResetQuery:E})}function B(){N.stopListening();N.undelegateDOMEvents();document.removeEventListener("click",S)}function Z(){if(!aa){ab()}else{while(N.container.firstChild){N.container.removeChild(N.container.firstChild)}}var ac=N.elements.topBarView;var af=N.elements.contentView;var ae=N.elements.detailView;var ad=N.elements.detailViewWrapper;[ac.container,af.container,ad].map(function(ag){N.container.appendChild(ag)});T=null;T=t(ad);w.refreshSideBar(af.container,T,e.getBool("isInodePanelSideBarOpened"),true);ac.render();af.render();ae.render();V();aa=true;return N}function V(){if(document.querySelector("#start_view_0 .btn-primary.btn-block")){document.querySelector("#start_view_0 .btn-primary.btn-block").addEventListener("click",function(){var ad=new s({model:L,context:"startView"}).toJSON();var ac=q.detect(ad,function(ae){return ae.id==="upload"});if(ac){ac.handler()}})}}function Y(){B();if(J){window.cancelAnimationFrame(J)}J=null;I.apply(N,arguments);aa=false;N.elements.topBarView=null;N.elements.contentView=null;N.elements.detailView=null;N.elements=null;N.container.empty();N.container=null}var Q=Object.assign(N,{render:Z,destroy:Y});function O(ad,ac){if(!ac.elements){return false}if(ad){ac.elements.detailViewWrapper.classList.add(z);ac.elements.contentView.container.classList.add(n);ac.elements.topBarView.container.childNodes[1].classList.add(b);return true}else{ac.elements.detailViewWrapper.classList.remove(z);ac.elements.contentView.container.classList.remove(n);ac.elements.topBarView.container.childNodes[1].classList.remove(b);return true}}(function(){function ac(){if(N&&N.container){var ad=N.container.getBoundingClientRect();O((ad.width<h),N);if(!aa){return}setTimeout(function(){J=window.requestAnimationFrame(ac)},500)}}J=window.requestAnimationFrame(ac)})();return Q}return x});define("DS/W3DContentApp/Views/InodePreView/lightboxPreviewBody",["UWA/Class/Promise","DS/W3DContentApp/Views/InodePreView/lightboxPreviewImg","DS/UIKIT/Spinner","css!DS/W3DContentApp/W3DContentApp.css"],function(d,f,i){var e;var j=new d(function(u){require(["DS/W3DContentApp/Views/InodePreView/lightboxPreview3DPlay"],function(v){e=v;u(v)})});var o=k(j);return{getFileExtension:c,isImgType:b,shouldRefreshAdapter:o,togglePreviewBodyVisibility:l,addAdapter:r,getPreviewBodySpinner:a,getPreviewBody:s,hidePreviewBody:q,init:g(),getPreview3DPlay:h};function h(){return e}function k(u){return function(w){var v=new d(function(x){if(w.drive.isCollabSpace){return x(w)}if(w.get("fileExtension")){return x(w)}w.addEventOnce("onChange:fileExtension",function(){x(w)})});return d.all([v,u])}}function t(w,v){var u=w;if(!u.classList.contains(v)){u=u.querySelector("."+v)}return u}function n(v,u){u=[].concat(u);return u.reduce(function(w,x){w.appendChild(x);return w},v)}function c(v){var u;u=v.get("fileExtension");if(typeof u!=="string"){return u}return u.toLowerCase()}function b(u){return(u&&((u==="bmp")||(u==="gif")||(u==="jpg")||(u==="jpeg")||(u==="png")))}function m(u){if(u.drive.isCollabSpace){return true}}function p(v,w){var u=t(v,"preview-body");if(w){u.classList.add("preview-body--interactive")}else{u.classList.remove("preview-body--interactive")}return v}function l(x,u){var w=x.querySelectorAll(".preview-body__adapter");var v=Array.prototype.map.call(w,function(y){var z=(y===u);if(z){y.classList.add("preview-body__adapter--visible");return true}else{y.classList.remove("preview-body__adapter--visible");return false}}).reduce(function(z,y){return z||y},false);p(x,v);return x}function r(v,u){if(v.contains(u)){return u}u.classList.add("preview-body__adapter");v.appendChild(u);return u}function a(){var u=new i();u.elements.container.classList.add("preview-body__spinner");return u}function s(v){var u=document.createElement("div");u.classList.add("preview-body");return n(u,v)}function q(){require(["DS/W3DContentApp/Views/InodePreView/lightboxPreview3DPlay"],function(u){u.hide3DPlayViewer()})}function g(){var u;return function(w){if(u){return u}w=w||{};var y=a();var z=s([y.elements.container]);u=Object.assign(z,{refresh:x,toggleInteraction:v});x(w.inode);return u;function x(B,A){y.show();l(u);if(!B){return d.resolve()}return o(B).then(function(F){var G=F[0];var C=F[1];var E=c(G);if(m(G)){return C}if(A){return C}if(b(E)&&!(G.drive.isDsDrive||G.drive.isDrivesHubDrive)){return f}var D=G.get3DPlayOptions();if(C.is3DPlayType(D.asset)===true){return C}return f}).then(function(D){var C=D.init();r(u,C);return C.refresh(B)}).then(function(C){l(u,C);y.hide()})}function v(A){return p(z,A)}}}});define("DS/W3DContentApp/Views/InodePreView/lightbox",["UWA/Class/Promise","DS/W3DDrive/InodeActions","DS/W3DDrive/Metas/inode","DS/W3DContentApp/Views/InodeDetailView/inodeDetailView","DS/W3DContentApp/Views/InodePreView/lightboxPreviewBody","DS/W3DContentApp/BusEvent","DS/W3DDrive/widget","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","i18n!DS/W3DContentApp/assets/nls/W3DContentApp","css!DS/W3DContentApp/W3DContentApp.css"],function(Q,I,U,o,b,B,L,W,H,s){var p=U();var d;var Z;function i(ad,ac){var ab=ad;if(!ab.classList.contains(ac)){ab=ab.querySelector("."+ac)}return ab}function c(ac,ab){ab=[].concat(ab);return ab.reduce(function(ad,ae){ad.appendChild(ae);return ad},ac)}function G(ab){return i(ab,"preview__title")}function S(ab){return i(ab,"preview__iconbar")}function m(ab){return i(ab,"lightbox__cancel")}function t(ab){return i(ab,"lightbox_previous")}function j(ab){return i(ab,"lightbox_next")}function w(ab){return i(ab,"lightbox__preview-properties-container")}function T(ab){return i(ab,"lightbox__preview-properties")}function e(ab){return i(ab,"lightbox")}function u(ac,ab){if(ab.isFolder()){v(ac,false);B.dispatchEvent("lightbox:onPreviewError")}}function Y(ad,ac){ac=ac||{};var ab=G(ad);if(ab){ab.textContent=ac.title||""}return ad}function n(ad,ac){ac=ac||{};var ab=S(ad);if(ac.iconbarElem){ab.parentElement.replaceChild(ac.iconbarElem,ab)}else{ab.parentElement.removeChild(ab)}return ad}function l(ac,ab){return new Q(function(ag,af){var ae=ac.elements.container;var ad;requestAnimationFrame(function(){if(ab){ad=(ab.elements?ab.elements.container:ab);if(ad.parentElement){n(ad.parentElement,{iconbarElem:ae})}requestAnimationFrame(function(){if(typeof ab.destroy==="function"){ab.destroy()}});ag()}})})}function x(ac){var ab=document.createElement("span");ab.classList.add("preview__title");Y(ab,{title:ac});return ab}function R(ab,ad){if(!ab){return}var ac=ab.querySelector(".iconbar__item--info");if(!ac){return}if(ad){ac.classList.add("item-info--opened")}else{ac.classList.remove("item-info--opened")}}function E(ab){return ab.classList.contains("lightbox__preview-properties-container--visible")}function V(af,ad){var ab=w(af);if(!ab){return af}var ac=S(af);var ae=E(ab);if(ae){if(!ad){ab.classList.remove("lightbox__preview-properties-container--visible");R(ac,ad)}}else{if(ad!==false){ab.classList.add("lightbox__preview-properties-container--visible");R(ac,true)}}return af}function z(ae){var ab;if(!ae){ab=document.createElement("div");ab.classList.add("preview__iconbar");return ab}var ad=new I({model:ae,context:"lightbox"});var ac=ad.toJSON();ac=ac.filter(function(ag){var af=true;af=af&&(ag.id!==p.actionPubIds.preview);af=af&&(ag.id!==p.actionPubIds.del);af=af&&(ag.id!==p.actionPubIds.moveTo);af=af&&(ag.id!==p.actionPubIds.openWith);af=af&&(ag.id!==p.actionPubIds.moveToCS);af=af&&(ag.id!==p.actionPubIds.update);return af});ac=ac.concat([{id:"info",text:s.infos,fonticon:"info",className:"iconbar__item--info",handler:function(){V(document.body)}}]);if(ae.isPlayable()){ac=ac.concat([{id:"play",text:s.play,fonticon:"play",className:"iconbar__item--play",handler:function(){ae.set("forcePlay",true);B.dispatchEvent("lightbox:onPlay",[ae])}}])}ab=new W({className:"preview__iconbar",items:ac});return ab}function aa(ac){var ab=document.createElement("div");ab.classList.add("preview__header");c(ab,ac);return ab}function h(ae,ab){ab=ae.get(ab);var ac=ae.indexOf(ab);var ad=((ae.length>ac-1)?ae.at(ac-1):null);return((ad&&!ad.isContainer())?ad.drive.getInodePreviewURI(ad):null)}function K(ae,ab){ab=ae.get(ab);var ad=ae.indexOf(ab);var ac=((ae.length>ad+1)?ae.at(ad+1):null);return((ac&&!ac.isContainer())?ac.drive.getInodePreviewURI(ac):null)}function r(ac){ac=ac||{};var ad=ac.child;var ab=document.createElement("div");ab.classList.add("preview-controller");ad.classList.add("preview-controller__container");ad.classList.add("lightbox__preview-body");return c(ab,ad)}function P(){var ab=document.body.querySelector(".lightbox")?document.body.querySelector(".lightbox"):false;return ab?ab.classList.contains("lightbox--visible"):false}function J(ab){return(P()&&E(w(document.body)))?N().container.querySelector('.navigation__header.navigation__header--selected > span[data-key="'+ab+'"]'):false}function v(ae,ac){var ab=e(ae);if(!ab){return ae}var ad=ab.classList.contains("lightbox--visible");if(ad){if(!ac){ab.classList.remove("lightbox--visible");V(ab,false)}}else{if(ac===false){V(ab,false)}else{ab.classList.add("lightbox--visible")}}return ae}function a(ad,ac){ac=ac||{};var ab=m(ad);if(ab){ab.setAttribute("href",ac.href||"")}return ad}function q(ad,ac){ac=ac||{};function ab(ag,ae){if(!ag){return}var af=!!ae;if(af){ag.classList.remove("disabled")}else{ag.classList.add("disabled")}ag.setAttribute("href",ae);return ag}ab(t(ad),ac.previous);ab(j(ad),ac.next);return ad}function O(ac){ac=ac||{};var ab=document.createElement("a");ab.classList.add("lightbox__cancel");ab.classList.add("fonticon");ab.classList.add("fonticon-cancel");new H({target:ab,body:s.close});a(ab,ac);return ab}function k(ac){ac=ac||{};var ab=document.createElement("a");ab.classList.add("lightbox_previous");ab.classList.add("fonticon");ab.classList.add("fonticon-chevron-left");new H({target:ab,body:s.previous,position:"bottom"});a(ab,ac);return ab}function M(ac){ac=ac||{};var ab=document.createElement("a");ab.classList.add("lightbox_next");ab.classList.add("fonticon");ab.classList.add("fonticon-chevron-right");new H({target:ab,body:s.next,position:"bottom"});a(ab,ac);return ab}function F(ab){ab.classList.add("lightbox__preview-properties");return ab}function y(ac){var ab=document.createElement("div");ab.classList.add("lightbox__preview-properties-container");c(ab,F(ac));return ab}function A(ab){return new o({model:ab,headerOptions:{onClickCloseIcon:function(){L.dispatchEvent("onToggleLightboxPropertiesVisibility")}}})}function C(ad,ac){var ab=T(ad);if(ab&&ab.parentElement){ab.parentElement.replaceChild(ac,ab)}return ab}function g(ae,ad){var ac=new Q(function(ag,af){requestAnimationFrame(function(){C(ad.container,ae.container);requestAnimationFrame(function(){ad.destroy()});ag()})});var ab=new Q(function(ag,af){requestAnimationFrame(function(){ae.render();ag()})});F(ae.container);return Q.all([ac,ab])}function f(af,ad,ae,ab){var ac=document.createElement("div");ac.classList.add("lightbox");ae.classList.add("lightbox__preview-controller");v(ac,!!ab);return c(ac,[af,y(ad),ae])}function X(ai){ai=ai||{};var ak=z();var aq=O();var ar=k();var ah=M();var ap=aa([x(),ak,ar,ah,aq]);var aj=b.init();var ab=A();var at=r({child:aj});var ac=f(ap,ab.container,at,ai.visibility);d=ab;Z=b;var ao={"onChange:mimeType":function(av){u(ac,av)},"onChange:title":function(av,aw){Y(ap,{title:aw})},"onChange:parentId":function(av,ax){var aw=av.drive.getInodePanelContentURI(av.drive.getInode(ax));a(ac,{href:aw})},"onChange:accessright":function(av){var aw=z(av);an(aw,ak);ak=aw},"onChange:removed":function(av,aw){var ax=z(av);an(ax,ak);ak=ax;if(av.get("cancelHref")){a(ac,{href:av.get("cancelHref")})}ae({inode:av,force:!aw})}};var ag=function(av){return !!av};function an(){l.apply(this,arguments).then(function(){B.dispatchEvent("lightbox:onRefreshIconbar",[ac]);R(S(ac),E(w(ac)))})}function au(){g.apply(this,arguments).then(function(){B.dispatchEvent("lightbox:onRefreshPreviewProperties",[ac])})}function af(){b.hidePreviewBody()}function ae(ax){ax=ax||{};var aA=ax.inode;var ay=ag(aA);if(!ay&&ax.force!==true){return}var aB=aA.collection;var av={onSync:function(){q(ac,{previous:h(aB,aA),next:K(aB,aA)})}};ag=function(aC){if(!aA){return false}aA.removeEvents(ao);aB.removeEvents(av);return true};aA.addEvents(ao);aB.addEvents(av);var aw=A(aA);var az=z(aA);au(aw,ab);an(az,ak);ak=az;ab=aw;d=ab;aj.refresh(aA).then(function(){B.dispatchEvent("lightbox:onRefreshBody",[ac])});Y(ac,{title:(aA.get("alias")||aA.get("title"))});a(ac,{href:aA.drive.getInodePanelContentURI(aA.collection.dot())});q(ac,{previous:h(aB,aA),next:K(aB,aA)})}function ad(av){aj.toggleInteraction(av);return v(ac,av)}function al(aw,av){aj.refresh(aw,av)}ae({inode:ai.inode});ac.addEventListener("click",function(av){var aw=av.target.classList;if(aw.contains("lightbox__cancel")){B.dispatchEvent("lightbox:onCancelClick",[av.target.getAttribute("href")]);av.preventDefault()}else{if(aw.contains("lightbox_previous")||aw.contains("lightbox_next")){B.dispatchEvent("lightbox:onArrowClick",[av.target.getAttribute("href")]);av.preventDefault()}}av.stopPropagation()});function am(){V(document.body)}L.addEvent("onToggleLightboxPropertiesVisibilityToggled",am);return Object.assign(ac,{destroy:function(){L.removeEvent("onToggleLightboxPropertiesVisibilityToggled",am)},refresh:ae,updatePreviewBody:al,toggleVisibility:ad,hideLightbox:af,unbind:ag})}function N(){return d}function D(){return Z}return{selectorFromTarget:i,appendChildren:c,selectPreviewTitleElem:G,selectPreviewIconbarElem:S,selectCancelElem:m,selectPreviewPropertiesContElem:w,selectPreviewPropertiesElem:T,selectLightboxElem:e,refreshPreviewTitle:Y,getPreviewTitle:x,refreshCancelElem:a,getCancelElem:O,refreshNavigationElem:q,getPreviousElem:k,getNextElem:M,refreshPreviewIconbarElem:n,refreshPreviewIconbar:l,getPreviewIconbar:z,getPreviewHeader:aa,wrapLightBoxPreviewProperties:F,getPreviewProperties:A,refreshPreviewPropertiesElem:C,refreshPreviewProperties:g,getPreviewController:r,isPreviewPropertiesVisible:E,togglePreviewPropertiesVisibility:V,isLightboxVisible:P,toggleLightboxVisibility:v,isTabVisible:J,getPreviewPropertiesContainer:y,getLightbox:f,getPropertiesView:N,getPreviewBody:D,init:X}});