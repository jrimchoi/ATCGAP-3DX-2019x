define("DS/EditPropExtensions/WebServices/WebServices",["UWA/Class","DS/WAFData/WAFData"],function(b,a){var c=b.singleton({init:function(){this._parent({})},getUrl:function(d){var e=null;return url},getClassInterfaces:function(l,k,j,h,i,g){console.log("getClassInterfaces");var f={classes:h};var n="/resources/dictionary/interfaces";var e={Accept:"application/json","Content-Type":"application/json","Accept-Language":widget.lang,};if(l){e.SecurityContext=l.SecurityContext}var m=this.options;var d=this.get3DSpaceWSUrl(this.tenant,j,n,"customerOnly=true&displayAttributes=true");a.authenticatedRequest(d,{method:"POST",headers:e,timeout:1000*60*60*24,data:JSON.stringify(f),type:"json",onComplete:function(o){console.log("getClassInterfaces:onComplete");i(o)},onFailure:function(p,r,o){console.log("fail");console.log(this);var q=p;if(r&&typeof r==="object"){if(r.error&&r.error.message){q=r.error.message}else{if(r.message){q=r.message}}}else{if(typeof p==="string"){if(p.startsWith("NetworkError:")){if(p.endsWith('return ResponseCode with value "0".')){q=NLS.noConnection}else{if(p.endsWith('return ResponseCode with value "401".')||p.endsWith('return ResponseCode with value "403".')){q=NLS.unauthorized}else{q=NLS.webServiceError}}}else{if(p==="null"){q=NLS.webServiceError}}}}g(q)},onTimeout:function(){g("timeout")},})},getObjectInterfaces:function(k,j,i,l,f,h){console.log("getObjectInterfaces");var g={objects:l};var n="/resources/dictionary/object/interfaces";var e={Accept:"application/json","Content-Type":"application/json","Accept-Language":widget.lang,};if(k){e.SecurityContext=k.SecurityContext}var m=this.options;var d=this.get3DSpaceWSUrl(this.tenant,i,n,"customerOnly=true");a.authenticatedRequest(d,{method:"POST",headers:e,timeout:1000*60*60*24,data:JSON.stringify(g),type:"json",onComplete:function(o){console.log("getObjectInterfaces:onComplete");f(o)},onFailure:function(p,r,o){console.log("fail");console.log(this);var q=p;if(r&&typeof r==="object"){if(r.error&&r.error.message){q=r.error.message}else{if(r.message){q=r.message}}}else{if(typeof p==="string"){if(p.startsWith("NetworkError:")){if(p.endsWith('return ResponseCode with value "0".')){q=NLS.noConnection}else{if(p.endsWith('return ResponseCode with value "401".')||p.endsWith('return ResponseCode with value "403".')){q=NLS.unauthorized}else{q=NLS.webServiceError}}}else{if(p==="null"){q=NLS.webServiceError}}}}h(q)},onTimeout:function(){console.log("timeout")},})},addInterfaces:function(j,i,f,h,g){console.log("addInterfaces");var k="/resources/dictionary/object/addInterfaces";var e={Accept:"application/json","Content-Type":"application/json","Accept-Language":widget.lang,};if(j){e.SecurityContext=j.SecurityContext}var l=this.options;var d=this.get3DSpaceWSUrl(this.tenant,i,k);a.authenticatedRequest(d,{method:"POST",headers:e,timeout:1000*60*60*24,data:JSON.stringify(f),type:"json",onComplete:function(m){console.log("addInterfaces:onComplete");h()},onFailure:function(n,p,m){console.log("fail");console.log(this);var o=n;if(p&&typeof p==="object"){if(p.error&&p.error.message){o=p.error.message}else{if(p.message){o=p.message}}}else{if(typeof n==="string"){if(n.startsWith("NetworkError:")){if(n.endsWith('return ResponseCode with value "0".')){o=NLS.noConnection}else{if(n.endsWith('return ResponseCode with value "401".')||n.endsWith('return ResponseCode with value "403".')){o=NLS.unauthorized}else{o=NLS.webServiceError}}}else{if(n==="null"){o=NLS.webServiceError}}}}console.log(o);g(o)},onTimeout:function(m){console.log("timeout");g(m)},})},removeInterfaces:function(j,i,f,h,g){console.log("removeInterfaces");var k="/resources/dictionary/object/removeInterfaces";var e={Accept:"application/json","Content-Type":"application/json","Accept-Language":widget.lang,};if(j){e.SecurityContext=j.SecurityContext}var l=this.options;var d=this.get3DSpaceWSUrl(this.tenant,i,k);a.authenticatedRequest(d,{method:"POST",headers:e,timeout:1000*60*60*24,data:JSON.stringify(f),type:"json",onComplete:function(m){console.log("removeInterfaces:onComplete");h(m)},onFailure:function(n,p,m){console.log("fail");console.log(this);var o=n;if(p&&typeof p==="object"){if(p.error&&p.error.message){o=p.error.message}else{if(p.message){o=p.message}}}else{if(typeof n==="string"){if(n.startsWith("NetworkError:")){if(n.endsWith('return ResponseCode with value "0".')){o=NLS.noConnection}else{if(n.endsWith('return ResponseCode with value "401".')||n.endsWith('return ResponseCode with value "403".')){o=NLS.unauthorized}else{o=NLS.webServiceError}}}else{if(n==="null"){o=NLS.webServiceError}}}}console.log(o)},onTimeout:function(m){console.log("timeout")},})},get3DSpaceUrl:function(f){var d=location.protocol+"//"+location.hostname;var e="3DSpace";if(f){f.serverUrl=d;f.serverUri=e}return d+"/"+e},get3DSpaceBaseUrl:function(k){var f=this.options;var d=this.options.platform_services;if(!UWA.is(this.getOption("platform_services"),"array")){throw new Error("Platform services not initialize yet")}var j=this;var e;try{for(var h=0;h<this.getOption("platform_services").length;h++){if(this.getOption("platform_services")[h]["platformId"]==k){e=this.getOption("platform_services")[h]["3DSpace"];break}}}catch(g){e=j.get3DSpaceUrl()}return e},get3DSpaceWSUrl:function(h,d,e,g){if(h==null||h==undefined||h==""){h="OnPremise"}var f=d+e+"?tenant="+h;if(g!=undefined&&g!=null){f=f+"&"+g}return f},});return c});define("DS/EditPropExtensions/UI/AddExtensionsWidget",["UWA/Controls/Abstract","UWA/Core","DS/UIKIT/SuperModal","DS/UIKIT/Autocomplete","DS/UIKIT/Accordion","DS/UIKIT/Form","DS/EditPropExtensions/WebServices/WebServices","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/EditPropExtensions/assets/nls/AddExtensionsNLS","i18n!DS/UIKIT/assets/nls/UIKIT"],function(n,d,m,k,b,f,r,i,q,g,p,c){var s="en";var o=function(x){this.interfaces=[];if(x!==null){var w=x.results;if(w.length===1){this.interfaces=w[0]["interfaces"]}else{var t=w[0]["interfaces"];for(var u=1;u<w.length;u++){t=l(t,w[u]["interfaces"])}this.interfaces=t}if(this.allAttachedInterfaces){var v=0;while(v<this.interfaces.length){for(var u=0;u<this.allAttachedInterfaces.length;u++){if(this.allAttachedInterfaces[u]["name"]===this.interfaces[v]["name"]){this.interfaces.splice(v,1);v--;break}}v++}}}return this.interfaces};var h=function(w){this.attachedInterfaces=[];if(w!==null){var v=w.results;if(v.length===1){this.attachedInterfaces=v[0]["interfaces"]}else{var t=v[0]["interfaces"];for(var u=1;u<v.length;u++){t=l(t,v[u]["interfaces"])}this.attachedInterfaces=t}}return this.attachedInterfaces};var j=function(w){this.allAttachedInterfaces=[];if(w!==null){var v=w.results;if(v.length==1){this.allAttachedInterfaces=v[0]["interfaces"]}else{var v=w.results;for(var u=0;u<v.length;u++){var x=v[u]["interfaces"];for(var t=0;t<x.length;t++){this.allAttachedInterfaces.push(x[t])}}}}return this.allAttachedInterfaces};var l=function(t,y){var w=[];for(var v=0;v<t.length;v++){var x=t[v]["name"];for(var u=0;u<y.length;u++){if(x===y[u]["name"]){w.push(t[v]);continue}}}return w};var a=function(){this._buildUI()};var e=n.extend({context:null,init:function(z,v,G,F,y,C,w){console.log("init");var A=this;s=z.lang;this._parent(G);this.elements.SC=F;var B=[];var E=y.getTenant();this.tenant=E;this.elements.myObject=y;this.setInterfaces=o.bind(this);this.setAttachedInterfaces=h.bind(this);this.setAllAttachedInterfaces=j.bind(this);this.buildUI=a.bind(this);if(y._innerModels){var x=y._innerModels;for(var D in x){var t=x[D].get("objectId");var u=x[D].get("_DS_ATTR_type");if(u){B.push(u.valueDB)}else{B[0]=y.get("_DS_ATTR_type").valueDB}this.setObject(t)}}else{var t=y.get("objectId");B[0]=y.get("_DS_ATTR_type").valueDB;this.setObject(t)}g.getServiceUrl({serviceName:"3DSpace",onComplete:function(I){I.forEach(function(K){if(K.url===undefined){d.log("url is undefined, skipping "+K.platformId)}else{if(E===K.platformId){this.URL=K.url}}}.bind(this));r.getObjectInterfaces(F,this.tenant,this.URL,this.models,function J(M){this.attachedInterfaces=this.setAttachedInterfaces(M);this.allAttachedInterfaces=this.setAllAttachedInterfaces(M);r.getClassInterfaces(F,this.tenant,this.URL,B,function L(N){this.interfaces=this.setInterfaces(N);this.buildUI();console.log("init:onComplete");this.showDialog(z,C,w)}.bind(this),function K(O){var N=p.failMessage+O;w(N)})}.bind(this),function H(L){var K=p.failMessage+L;w(K)})}.bind(this),onFailure:function(H){d.log(H);w(p.urlNotFound)}});this.context=G.context},setObject:function(t){if(!this.models){this.models=[]}this.models.push(t)},showDialog:function(z,y,v){console.log("EditPropExtensions:showDialog");var w=document.getElementsByClassName("EPP_PopupDial");var A=new m({closable:true,className:"Modals",events:{onHide:function(){y()}}});var x=p.ok;var C=p.cancel;var t=this.elements.myContainer;A.dialog({body:t,title:p.title,buttons:[{className:"primary",value:x,action:function(Q){var P=this.autoComplete;var G=P.getSelection();var L=this.attributesForm;var O={},K={},H={},R={};for(var E in L){var D=L[E];var J=D.getChangedValues();for(var N in J){var F=D.get(N).get("valueDB");if(D.get(N).get("type")=="boolean"){F=String(F)}R[N]=F}K[E]=R}O.interfaces=K;O.phyIDS=this.models;H.interfaces=this.extensionsToDelete;H.phyIDS=this.models;if(G.length>0){r.addInterfaces(this.elements.SC,this.URL,O,function M(){if(this.extensionsToDelete.length>0){r.removeInterfaces(this.elements.SC,this.URL,H,function T(){Q.hide()},function S(U){Q.hide();v(U)})}else{Q.hide()}}.bind(this),function I(S){Q.hide();v(S)})}else{if(this.extensionsToDelete.length>0){r.removeInterfaces(this.elements.SC,this.URL,H,function M(){Q.hide()},function I(S){Q.hide();v(S)})}}}.bind(this)},{value:C,action:function(D){D.hide()}}]});if(A&&A.modals&&A.modals.current&&A.modals.current.elements){var u=(A.modals.current.elements.header)?A.modals.current.elements.header.getElement(".close.fonticon.fonticon-cancel"):null;if(u){u.setText("\u00D7");u.removeClassName("fonticon");u.removeClassName("fonticon-cancel");u.setAttributes({title:c.close})}if(A.modals.current.elements.closeTooltip&&A.modals.current.elements.closeTooltip.elements){A.modals.current.elements.closeTooltip.elements.container.addClassName("hideDefaultTooltip")}}this.mySuperModal=A;var B=document.getElementsByName("autoCompleteExtensions");B[0].focus()},changeClass:function(w,t){var y=w.getParent();var x=y.getParent();if(x.className!="warning"){x.className="warning";w.className="fonticon fonticon-2x fonticon-reset";var v=w.getAttribute("id");t.push(v)}else{x.className="";w.className="fonticon fonticon-2x fonticon-exchange-delete";var v=w.getAttribute("id");var u=t.indexOf(v);if(u>-1){t.splice(u,1)}}},_buildUI:function(){console.log("buildUI");var E=this;var B=[];var D=this.interfaces;var z=this.attachedInterfaces;var v=this.allAttachedInterfaces;this.extensionsToDelete=[];var G=d.createElement("div",{styles:{position:"relative",overflow:"visible"}});var P=d.createElement("div",{id:"attachedExtDiv"});var u=d.createElement("div",{id:"tableDiv",styles:{height:"110px",}});var M=d.createElement("table",{"class":"table table-hover",width:"100%"}).inject(u);var t=d.createElement("tbody").inject(M);var O=0;for(var O=0;O<z.length;O++){var A=d.createElement("tr").inject(t);var x=z[O];var J=d.createElement("p",{title:x.name,text:x.nameNLS});J.inject(d.createElement("td",{align:"left",width:"80%"}).inject(A));var N=d.createElement("span",{styles:{cursor:"pointer;"},id:x.name});N.className="fonticon fonticon-2x fonticon-exchange-delete";N.inject(d.createElement("td",{align:"center",width:"20%"}).inject(A));N.onclick=function(T){var U=T.target;E.changeClass(U,E.extensionsToDelete)}}var I=new q({element:u}).inject(P);this.elements.myScroller=I;var Q=d.createElement("div",{id:"autoComplete",styles:{overflow:"visible"}}).inject(G);this.interfaces.forEach(function(T){B.push({value:T.name,label:T.nlsName,subLabel:T.name,name:T.name})});var y={name:"extensions",items:B};var L=new k({name:"autoCompleteExtensions",showSuggestsOnFocus:true,multiSelect:true,placeholder:p.autoCompPlaceHolder,autofocus:"autofocus",events:{onSelect:function(U,T){E.updateAttUI(U,true)},onUnselect:function(V,T,U){E.updateAttUI(V,false)}},style:{width:"100%",overflow:"visible"}}).inject(Q);L.addDataset(y);var F=new b({className:"divided",exclusive:false,items:[]}).inject(G);this.elements.accordion=F;var K=new b({className:"filled",exclusive:false,items:[{title:"Attached extensions",content:I,name:"atExt"}]}).inject(G);var H=L.getItems();var S=H[0];var R=H[1];var w=L.currentSuggestions;var C=L.datasets;this.autoComplete=L;this.elements.tableExtensions=M;this.elements.myContainer=G;return G},convertDateToStandard:function(v,B){if(!v){return{value:"",valueDB:""}}var u=B?v:new Date();var t=v.getUTCFullYear();var w=v.getUTCMonth()+1;var A=v.getUTCDate();var z=u.getUTCHours();var x=u.getUTCMinutes();var y=u.getUTCSeconds();if(w<10){w="0"+w}if(A<10){A="0"+A}if(z<10){z="0"+z}if(x<10){x="0"+x}if(y<10){y="0"+y}u.setYear(t);u.setMonth(v.getMonth());u.setDate(A);return{value:u.toLocaleString(s),valueDB:t+"/"+w+"/"+A+"@"+z+":"+x+":"+y+":GMT"}},updateAttUI:function(F,x){var v=this.elements.accordion;var E=this.interfaces;var w=this;var u=[];var G=[];if(!this.attributesForm){this.attributesForm={}}var t=this.attributesForm;var z=F.name;var D="DS/EditPropWidget/facets/Properties/Properties",B="DS/EditPropWidget/models/EditPropAttributeModel",A="DS/EditPropWidget/models/EditPropModel";if(x){E.forEach(function(H){if(H.name===F.name){u=H.attributes;require([D,B,A],function(K,O,L){var Q={};Q.editMode=true;Q.setCloseButton=false;Q.scroller=false;var I=true;var J=new K(Q);var P={};var N;u.forEach(function(T){if(T.Primitive==="Date"){var S=T["default"];var U=new Date(S*1000);var R=w.convertDateToStandard(U,true);N=new O({path:T.name,label:T.nlsName,valueDB:R.valueDB,name:T.name,type:"timestamp",readOnly:false});P[N.getIdentifier()]=N}else{if(T.Primitive==="Double"){N=new O({path:T.name,label:T.nlsName,valueDB:T["default"],name:T.name,type:"real",dimension:T.Dimension,readOnly:false});P[N.getIdentifier()]=N}else{if(T.Primitive==="Integer"){N=new O({path:T.name,label:T.nlsName,valueDB:T["default"],name:T.name,type:"integer",readOnly:false});P[N.getIdentifier()]=N}else{if(T.Primitive==="Boolean"){N=new O({path:T.name,label:T.nlsName,valueDB:T["default"],name:T.name,type:"boolean",readOnly:false});P[N.getIdentifier()]=N}else{N=new O({path:T.name,label:T.nlsName,valueDB:T["default"],name:T.name,readOnly:false});P[N.getIdentifier()]=N}}}}});var M=new L();M.set(P);M.saveInitialValues();J.initData([M]);J.elements.container.setStyle("height","100%");t[z]=M;v.addItem({title:F.label,content:J,selected:true,name:F.name})})}})}else{v.removeItem(F.name);delete this.attributesForm[z]}var C=v.getSelectedItems();var y=v.getUnselectedItems()}});e.setInterfaces=o;e.setAttachedInterfaces=h;e.setAllAttachedInterfaces=j;return e});