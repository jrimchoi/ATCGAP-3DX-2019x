define("DS/Effects/SaveAsHDR",[],function(){var a={writeHDRHeader:function(b,j){var k=function(o,n,m){for(var l=0;l<n.length;l++){o[m++]=n.charCodeAt(l)}return m};var c="#?RADIANCE";var h="# Made with Dassault Systemes HDR mipmap roughness generator - TZW";var e="FORMAT=32-bit_rle_rgbe";var d="-Y "+j+" +X "+b;var i=c.length+1+h.length+1+e.length+2+d.length+1;var g=new Uint8Array(i+b*j*4);var f=0;f=k(g,c,f);g[f++]=10;f=k(g,h,f);g[f++]=10;f=k(g,e,f);g[f++]=10;g[f++]=10;f=k(g,d,f);g[f++]=10;return{buffer:g,offset:f,width:b,height:j}},writeTexture:function(b,l,n,m){var f=4*l.width*m;var g=4*n;var h=b.height-1;for(var d=0;d<b.height;d++){var o=b.width-1;for(var e=0;e<b.width;e++){for(var c=0;c<4;c++){l.buffer[l.offset+f+g+4*e+c]=255*b.buffer[4*(b.width*h+o)+c]}o--}f+=4*l.width;h--}},compressHDR:function(r){var s=function(k){var j=new Uint8Array(2*k.length);for(var c=0;c<k.length;c++){j[c]=k[c]}return j};var h=r.offset;var p=h;var v=new Uint8Array(r.buffer.length);for(var n=0;n<h;n++){v[n]=r.buffer[n]}var w=new Uint8Array(4+5*r.width);for(var l=0;l<r.height;l++){var f=0;w[f++]=2;w[f++]=2;w[f++]=r.width>>8;w[f++]=r.width&255;for(var t=0;t<4;t++){var u=[];var n=0;while(n<r.width){var e=0;var q=r.buffer[h+4*(l*r.width+n)+t];var d=q;while(n<r.width&&d===q&&e<127){e++;n++;q=d;d=r.buffer[h+4*(l*r.width+n)+t]}if(e>3){if(u.length){w[f++]=u.length;for(var g=0;g<u.length;g++){w[f++]=u[g]}u=[]}w[f++]=128+e;w[f++]=q}else{if(u.length+e>127){w[f++]=u.length;for(var g=0;g<u.length;g++){w[f++]=u[g]}u=[]}u.push(q);if(e>1){u.push(q)}if(e>2){u.push(q)}}}if(u.length){w[f++]=u.length;for(var g=0;g<u.length;g++){w[f++]=u[g]}}}if(p+f>=v.length){v=s(v)}for(var b=0;b<f;b++){v[p++]=w[b]}}var o=new Uint8Array(p);for(var n=0;n<p;n++){o[n]=v[n]}r.buffer=o}};return a});define("DS/Effects/BasicEffect",["UWA/Class","DS/Visualization/ThreeJS_DS"],function(b,c){var a=b.extend({init:function(d){this.enabled=true;this.composers=[];this.mixPass=null;this.width=2;this.height=2;this.renderer=d;return this},initEffect:function(d,e){},update:function(e,d,f){},setSize:function(e,d){if((this.width===e)&&(this.height===d)){return false}this.width=Math.max(2,e);this.height=Math.max(2,d);return true},updateComposersName:function(d){var e;for(e=0;e<this.composers.length;e++){this.composers[e].composerContext.name=d+"#"+e}},setEnabled:function(d){this.enabled=d;var f;for(f=0;f<this.composers.length;f++){this.composers[f].enabled=d}if(this.mixPass!==null){var e=this.mixPass.composer;if(e&&e.contexts.length){e.contexts[0].enablePass(this.mixPass,d)}}},getMaxIteration:function(){return 0},dispose:function(){var d;for(d=0;d<this.composers.length;d++){if(this.composers[d].composerContext){this.composers[d].composerContext.dispose()}this.composers[d].dispose()}}});return a});define("Effects/BasicEffect",["DS/Effects/BasicEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/BasicEffect");return b});define("DS/Effects/ComputeMipMapRoughness",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/PreComputeShaders","DS/Shaders/DisplayMipsRoughnessShader","DS/Shaders/EncodeHDRShader","DS/Shaders/FlipXShader"],function(h,d,f,c,k,e,g,i){var b=d.extend({init:function(m,l){this._parent(m);this.gl=this.renderer.context;this.renderTargetPool=l;this.nbSamples=64;this.nbIterations=32;this.passFilterEnvMap=[];this.passMergeMips=null;this.saveComposer=null;this.passFlipX=null;this.passEncodeHDR=null;this.modeValue=0;this.shader=null;this.texture=null;this.nbMipMaps=7;this.inputLods=9;this.lodCst=7.707519;return this},setSize:function(m,l){this.width=(typeof m==="string")?parseInt(m):m;this.height=(typeof l==="string")?parseInt(l):l;this.inputLods=Math.round(Math.log(Math.min(this.width,this.height))/Math.log(2))-1},setNbSamples:function(o){this.nbSamples=o;var m=0.5*Math.log(0.5*this.width*this.height/this.nbSamples)/Math.log(2);this.lodCst=m.toFixed(8);for(var n=1;n<=this.nbMipMaps;n++){var p=n-1;var l=this.getCoeff(p);if(this.passFilterEnvMap[p]){this.passFilterEnvMap[p].material.defines.NB_SAMPLES=l*this.nbSamples;this.passFilterEnvMap[p].material.defines.NB_SAMPLES_IT=l*this.nbSamples/this.nbIterations;this.passFilterEnvMap[p].material.defines.LOD_CST=this.lodCst;this.passFilterEnvMap[p].material.needsUpdate=true}}},getCoeff:function(l){if(this.modeValue===1){return l>2?16:1}else{return l===6?32:(l>3?4:1)}},setMode:function(m){this.modeValue=0;switch(m){case"ASHIKMIN":this.modeValue=1;break;case"BECKMANN":this.modeValue=2;break;default:}for(var l=1;l<=this.nbMipMaps;l++){var n=l-1;if(this.passFilterEnvMap[n]){this.passFilterEnvMap[n].material.defines.MODE=l===7?3:this.modeValue;this.passFilterEnvMap[n].material.needsUpdate=true;this.passFilterEnvMap[n].uniforms.roughness.value=(this.modeValue===1||this.modeValue===4)?1-Math.pow(2,(l-6)/1.15):Math.pow(2,(l-6)/1.15)}}},setInput:function(q){this.texture=q;if(this.hasOwnProperty("iter")){this.iter=0}var o=[1,1,0.5,0.5,0.25,0.25,0.25,0.25];for(var r=1;r<=this.nbMipMaps;r++){var l=r-1;var m=o[r]*this.width;var v=o[r]*this.height;if(this.composers[l]){this.composers[l].setSize(m,v);this.passFilterEnvMap[l].uniforms.tEnvMap.value=this.texture}else{var t=new h.WebGLRenderTargetProperties(m,v,"linear");t.generateMipmaps=false;t.mapping=this.texture.mapping;this.composers[l]=new f(this.renderer,t,this.renderTargetPool);this.composers[l].composerContext.keepResult=true;this.composers[l].composerContext.noIdCheck=true;var p=this.nbSamples;var n=this.nbIterations;var s=this.getCoeff(l);var u={defines:{NB_SAMPLES:s*p,NB_SAMPLES_IT:s*p/n,DP_SCALE:this.shader.defines.DP_SCALE,LOD_CST:this.lodCst,MODE:r===7?3:(this.modeValue||0),MAX_LOD:this.inputLods},uniforms:this.shader.uniforms,vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader};this.passFilterEnvMap[l]=new c(u);this.passFilterEnvMap[l].uniforms.roughness.value=(this.modeValue===1||this.modeValue===4)?1-Math.pow(2,(r-6)/1.15):Math.pow(2,(r-6)/1.15);this.composers[l].addPass(this.passFilterEnvMap[l])}this.texture.linkToShaderPassUniform(this.passFilterEnvMap[l],this.passFilterEnvMap[l].uniforms.tEnvMap)}this.setComposers()},setComposers:function(){var m=this.nbMipMaps;if(this.composers[m]){this.composers[m].setSize(this.width,2*this.height)}else{var n=new h.WebGLRenderTargetProperties(this.width,2*this.height,"linear");n.generateMipmaps=false;this.composers[m]=new f(this.renderer,n,this.renderTargetPool);this.composers[m].composerContext.keepResult=true;this.composers[m].composerContext.noIdCheck=true;this.passMergeMips=new c(e.MergeMips);this.passMergeMips.renderToScreen=false;this.passFlipX=new c(i);this.composers[m].addPass(this.passMergeMips);this.composers[m].addPass(this.passFlipX);for(var l=1;l<=this.nbMipMaps;l++){var o=l-1;this.composers[o].linkToShaderPassUniform(this.passMergeMips,this.passMergeMips.uniforms["tDiffuse"+l])}}if(this.saveComposer){this.saveComposer.setSize(this.width,2*this.height)}else{var n=new h.WebGLRenderTargetProperties(this.width,2*this.height,"uintNearest");n.generateMipmaps=false;n.mapping=this.texture.mapping;this.saveComposer=new f(this.renderer,n,this.renderTargetPool);this.saveComposer.composerContext.keepResult=true;this.saveComposer.composerContext.noIdCheck=true;this.passEncodeHDR=new c(g);this.saveComposer.composerContext.setPassRenderToCanvas(this.passEncodeHDR,false);this.saveComposer.addPass(this.passEncodeHDR)}},encodeRGBE:function(){var n=this.composers[this.nbMipMaps];var o=n.composerContext.renderTargetProperties.width;var m=n.composerContext.renderTargetProperties.height;var l=this.saveComposer.composerContext.getResult(undefined,true);if(l){this.renderTargetPool.pushRenderTarget(l)}var p=n.composerContext.getResult(undefined,true);this.passEncodeHDR.uniforms.map.value=p;this.saveComposer.render();if(p){this.renderTargetPool.pushRenderTarget(p)}}});var a=b.extend({init:function(m,l){this._parent(m,l);this.shader=k.ComputeMipMapRoughnessFIS;return this},execute:function(l){if(l!==undefined){var n=this.composers[l].composerContext.getResult(undefined,true);this.composers[l].render();if(n){this.renderTargetPool.pushRenderTarget(n)}}else{for(var m=0;m<this.nbMipMaps;m++){if(this.modeValue>0&&m===6){continue}this.execute(m)}this.composers[this.nbMipMaps].render()}},});var j=b.extend({init:function(o,n){this._parent(o,n);this.iter=0;this.shader=k.ComputeMipMapRoughnessIterative;var l=new Uint8Array(2*2*4);for(var m=0;m<2*2*4;m++){l[m]=0}this.initTexture=new h.DataTexture(l,2,2,h.RGBAFormat,h.UnsignedByteType,new h.LatLongReflectionMapping(),h.ClampToEdgeWrapping,h.ClampToEdgeWrapping,h.LinearFilter,h.LinearFilter);this.initTexture.generateMipmaps=false;this.initTexture.needsUpdate=true;this.renderer.setTexture(this.initTexture,0);return this},execute:function(m){if(this.iter>=this.nbIterations){return}var l=this.iter;if(m!==undefined){var p=this.composers[m].composerContext.getResult(undefined,true);var n=this.getCoeff(m);this.passFilterEnvMap[m].uniforms.prevMap.value=!l?this.initTexture:p;this.passFilterEnvMap[m].uniforms.firstSample.value=n*l*this.nbSamples/this.nbIterations;this.composers[m].render();if(p){this.renderTargetPool.pushRenderTarget(p)}}else{for(var o=0;o<this.nbMipMaps;o++){if(this.modeValue>0&&o===6){continue}this.execute(o)}this.iter++;this.composers[this.nbMipMaps].render()}},});return{ComputeMipMapRoughnessFIS:a,ComputeMipMapRoughnessIterative:j}});define("DS/Effects/ConvertCubemapToLatlong",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/NothingShader","DS/Shaders/ConvertCubemapToLatlongShader","DS/Shaders/DisplayIrradianceMapShader","DS/Shaders/EncodeHDRShader"],function(h,c,e,b,f,d,a,g){var i=c.extend({init:function(k,j){this._parent(k);this.gl=this.renderer.context;this.renderTargetPool=j;this.passConvert=null;this.texture=null;this.passDisplayLatlongMap=null;this.saveComposer=null;this.passEncodeHDR=null;return this},setEnvMap:function(n,k){this.texture=n;var l=2*parseInt(this.texture.width);var j=parseInt(this.texture.width);this.width=l;this.height=j;if(this.composers[1]){this.composers[1].setSize(l,j)}else{var m=new h.WebGLRenderTargetProperties(l,j,"linear");m.generateMipmaps=false;m.mapping=this.texture.mapping;this.composers[1]=new e(this.renderer,m,this.renderTargetPool);this.composers[1].composerContext.keepResult=true;d.ConvertCubemapToLatlong.defines.ORIENTATION=(k&&k>0)?1:0;this.passConvert=new b(d.ConvertCubemapToLatlong);this.composers[1].addPass(this.passConvert)}this.passConvert.uniforms.cubemap.value=this.texture;if(this.composers[0]){this.composers[0].setSize(this.width,this.height)}else{var m=new h.WebGLRenderTargetProperties(this.width,this.height,"uint");m.generateMipmaps=false;m.mapping=this.texture.mapping;this.composers[0]=new e(this.renderer,m,this.renderTargetPool);this.composers[0].composerContext.keepResult=false;this.passDisplayLatlongMap=new b(a);this.composers[0].composerContext.setPassRenderToCanvas(this.passDisplayLatlongMap,true);this.composers[0].addPass(this.passDisplayLatlongMap);this.composers[1].linkToShaderPassUniform(this.passDisplayLatlongMap,this.passDisplayLatlongMap.uniforms.tDiffuse1)}},execute:function(){this.composers[1].render()},getResult:function(k){var j=this.composers[1].composerContext.getResult(undefined,k);j.hdr=true;j.mapping=new h.LatLongReflectionMapping();return j},getResultRGBE:function(k){this.encodeRGBE();var j=this.saveComposer.composerContext.getResult(undefined,k);j.hdr=true;j.mapping=new h.LatLongReflectionMapping();return j},encodeRGBE:function(){var k=this.composers[1];var l=k.composerContext.renderTargetProperties.width;var j=k.composerContext.renderTargetProperties.height;if(this.saveComposer){this.saveComposer.setSize(l,j)}else{var m=new h.WebGLRenderTargetProperties(l,j,"nearest");m.generateMipmaps=false;m.mapping=this.texture.mapping;this.saveComposer=new e(this.renderer,m,this.renderTargetPool);this.saveComposer.composerContext.keepResult=true;this.passEncodeHDR=new b(g);this.saveComposer.composerContext.setPassRenderToCanvas(this.passEncodeHDR,false);this.saveComposer.addPass(this.passEncodeHDR)}this.passEncodeHDR.uniforms.map.value=k.composerContext.renderTarget2;this.saveComposer.render()}});return i});define("DS/Effects/ToneMappingEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/CompositeShader","DS/Shaders/BloomShaders","DS/Plugins/ClearPass"],function(e,b,f,d,g,a,h){var c=b.extend({init:function(k,j){this._parent(k);this.renderer=k;this.rtPool=j;this.defines={TONEMAP_SIMPLE:true};this.tonemapping=1;this.brightness=0;this.passThreshold=null;this._initBloom=false;this.bloom=0;this.nbIterations=5;this.threshold=0.626;this.mixPass=new d(g,undefined,"compositePass");this.mixPass.material.blending=e.NoBlending;this.mixPass.gammaCorrectionPass=true;this.passBlurH=null;this.passBlurV=null;var i=new e.WebGLRenderTargetProperties(this.viewportWidth,this.viewportHeight,"uint");this.mixPass.changeRenderTargetProperties=i;return this},initEffect:function(i,j){j.insertComposer(null,this.mixPass)},update:function(j,i,k){},setBloom:function(i){if(this.bloom!==i){this.bloom=i?1:0;this.defines.USE_BLOOM=this.bloom;this.mixPass.material.defines=this.defines;this.mixPass.material.needsUpdate=true;this.mixPass.requiredComposers=[];if(i){this._buildBloomRT();this.mixPass.addRequiredComposer(this.composers[5])}}},setToneMapping:function(i){var j={USE_BLOOM:this.bloom};this.tonemapping=i;switch(i){case 1:j.TONEMAP_SIMPLE=true;break;case 2:j.TONEMAP_LINEAR=true;break;case 3:j.TONEMAP_REINHARD=true;break;case 4:j.TONEMAP_FILMIC=true;break;case 5:j.TONEMAP_UNCHARTED=true;break;case 6:j.TONEMAP_FILMIC_NRE=true;break;case 7:j.TONEMAP_FILMIC_NRE_APPROXIMATE=true;break;case 8:j.TONEMAP_PHOTOGRAPHIC_NRE=true;break;case 9:j.TONEMAP_LINEAR_NRE=true;break;default:break}this.defines=j;this.mixPass.material.defines=j;this.mixPass.material.needsUpdate=true},setGamma:function(i){this.mixPass.uniforms.gamma.value=i},setBrightness:function(i){this.brightness=i;this.mixPass.uniforms.brightness.value=i},setBloomFactor:function(i){this.mixPass.uniforms.bloomFactor.value=i},setBloomThreshold:function(i){if(this.passThreshold){this.passThreshold.uniforms.threshold.value=i}},setSize:function(m,j){var l=this._parent(m,j);if(!l){return}if(!this.bloom){return}var k,n=0.5;this.composers[0].setSize(n*this.width,n*this.height);for(k=1;k<=this.nbIterations;k++){this.composers[k].setSize(n*this.width,n*this.height);this.passBlurH[k].uniforms.invSize.value.set(1/(n*this.width),1/(n*this.height));this.passBlurV[k].uniforms.invSize.value.set(1/(n*this.width),1/(n*this.height));n*=0.5}},_buildBloomRT:function(l){if(this._initBloom){return}this._initBloom=true;var m=0.5;this.passBlurH=[];this.passBlurV=[];var j=new e.WebGLRenderTargetProperties(m*this.width,m*this.height,"uint");this.composers[0]=new f(this.renderer,j,this.rtPool);this.passThreshold=new d(a.Threshold);this.passThreshold.uniforms.threshold.value=this.threshold;this.composers[0].addPass(this.passThreshold);for(var k=1;k<=this.nbIterations;k++){var j=new e.WebGLRenderTargetProperties(m*this.width,m*this.height,"uint");this.composers[k]=new f(this.renderer,j,this.rtPool);this.passBlurH[k]=new d(a.BlurH2);this.passBlurV[k]=new d(a.BlurV);this.passBlurH[k].material.defines={LEVEL:k};this.passBlurV[k].material.defines={LEVEL:k};this.passBlurH[k].uniforms.invSize.value.set(1/(m*this.width),1/(m*this.height));this.passBlurV[k].uniforms.invSize.value.set(1/(m*this.width),1/(m*this.height));this.passBlurH[k].material.needsUpdate=true;this.passBlurV[k].material.needsUpdate=true;this.composers[k].addPass(this.passBlurH[k]);this.composers[k].addPass(this.passBlurV[k]);m*=0.5}this.passBlurH[1].addRequiredComposer(this.composers[0]);this.passBlurH[2].addRequiredComposer(this.composers[1]);this.passBlurH[3].addRequiredComposer(this.composers[2]);this.passBlurH[4].addRequiredComposer(this.composers[3]);this.passBlurH[5].addRequiredComposer(this.composers[4]);var n=this;this.mixPass.beforeRenderCB=function(i){n.passThreshold.uniforms.tDiffuse2.value=i};this.composers[0].linkToShaderPassUniform(this.passBlurH[1],this.passBlurH[1].uniforms.tDiffuse2);this.composers[1].linkToShaderPassUniform(this.passBlurH[2],this.passBlurH[2].uniforms.tDiffuse2);this.composers[2].linkToShaderPassUniform(this.passBlurH[3],this.passBlurH[3].uniforms.tDiffuse2);this.composers[3].linkToShaderPassUniform(this.passBlurH[4],this.passBlurH[4].uniforms.tDiffuse2);this.composers[4].linkToShaderPassUniform(this.passBlurH[5],this.passBlurH[5].uniforms.tDiffuse2);this.composers[1].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse2);this.composers[2].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse3);this.composers[3].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse4);this.composers[4].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse5);this.composers[5].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse6)}});return c});define("DS/Effects/ConvertLatLongToDualParaboloid",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/ConvertLatLongToDualParaboloidShader","DS/Shaders/DisplayIrradianceMapShader"],function(e,b,g,d,c,a){var f=b.extend({init:function(i,h){this._parent(i);this.gl=this.renderer.context;this.renderTargetPool=h;this.passConvert=null;this.texture=null;this.passDualParaboloidMap=null;return this},setSize:function(i,h){this.width=(typeof i==="string")?parseInt(i):i;this.height=(typeof h==="string")?parseInt(h):h},setEnvMap:function(l){this.texture=l;if(this.texture instanceof e.Texture){var j=parseInt(this.texture.image.width);var h=parseInt(this.texture.image.height);this.width=j;this.height=h}if(this.composers[1]){this.composers[1].setSize(this.width,this.height)}else{var k=new e.WebGLRenderTargetProperties(this.width,this.height,"linear");k.generateMipmaps=false;k.mapping=e.LatLongReflectionMapping;this.composers[1]=new g(this.renderer,k,this.renderTargetPool);this.composers[1].composerContext.keepResult=true;this.composers[1].composerContext.noIdCheck=true;var i=c.ConvertLatLongToDualParaboloid;if(this.texture instanceof e.Texture){i=c.ConvertLatLongRGBEToDualParaboloid}this.passConvert=new d({defines:{SCALE:1.2},uniforms:i.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader},undefined,"Convert");this.composers[1].addPass(this.passConvert)}if(this.texture instanceof e.Texture){this.passConvert.uniforms.map.value=this.texture}else{this.texture.linkToShaderPassUniform(this.passConvert,this.passConvert.uniforms.map)}if(this.composers[0]){this.composers[0].setSize(this.width,this.height)}else{var k=new e.WebGLRenderTargetProperties(this.width,this.height,"uint");k.generateMipmaps=false;k.mapping=e.LatLongReflectionMapping;this.composers[0]=new g(this.renderer,k,this.renderTargetPool);this.composers[0].composerContext.keepResult=false;this.composers[0].composerContext.noIdCheck=true;this.passDualParaboloidMap=new d(a,undefined,"DisplayConvert");this.composers[0].composerContext.setPassRenderToCanvas(this.passDualParaboloidMap,true);this.composers[0].addPass(this.passDualParaboloidMap);this.composers[1].linkToShaderPassUniform(this.passDualParaboloidMap,this.passDualParaboloidMap.uniforms.tDiffuse1)}},execute:function(){this.composers[1].render()}});return f});define("DS/Effects/ComputeSDFFontIterative",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/NothingShader","DS/Shaders/PreComputeSDFFontIterativeShaders","DS/Shaders/EncodeHDRShader"],function(d,a,g,c,f,h,b){var e=a.extend({init:function(j,i){this._parent(j);this.gl=this.renderer.context;this.renderTargetPool=i;this.__renderer=j;this.passComputeSDFFontSeed=null;this.passComputeSDFFontFlood=null;this.passComputeSDFFontMerge=null;this.OutputRatio=0.25;this.texture=null;this.passDisplayMap=null;this.passNothing=null;return this},setMap:function(m,k){this.texture=m;this.width=parseInt(m.image.width);this.height=parseInt(m.image.height);if(this.composers[1]){this.composers[1].setSize(this.width,this.height);this.passComputeSDFFontSeed.uniforms.prevMap.value=this.texture}else{var l=new d.WebGLRenderTargetProperties(this.width,this.height,"nearest");l.generateMipmaps=false;l.mapping=this.texture.mapping;this.composers[1]=new g(this.renderer,l,this.renderTargetPool);this.composers[1].composerContext.keepResult=true;this.passComputeSDFFontSeed=new c(h.ComputeSDFFontSeed);this.passComputeSDFFontSeed.compileShader(this.__renderer);this.passComputeSDFFontSeed.uniforms.prevMap.value=this.texture;this.passComputeSDFFontFlood=new c(h.ComputeSDFFontFlood);this.passComputeSDFFontMerge=new c(h.ComputeSDFFontMerge);var j=new c(f);this.composers[1].addPass(this.passComputeSDFFontSeed);this.composers[1].addPass(this.passComputeSDFFontFlood);this.composers[1].addPass(this.passComputeSDFFontMerge);this.composers[1].addPass(j)}var i=this.getOutputSize();if(this.composers[0]){this.composers[0].setSize(i.width,i.height)}else{var l=new d.WebGLRenderTargetProperties(i.width,i.height,"uint");l.generateMipmaps=false;l.mapping=this.texture.mapping;this.composers[0]=new g(this.renderer,l,this.renderTargetPool);this.composers[0].composerContext.keepResult=false;this.passDisplayMap=new c(h.ComputeSDFFontDisplay);this.passDisplayMap.renderToScreen=false;this.composers[0].addPass(this.passDisplayMap);this.composers[1].linkToShaderPassUniform(this.passDisplayMap,this.passDisplayMap.uniforms.tDiffuse)}this.passComputeSDFFontFlood.uniforms.invSize.value.set(1/this.width,1/this.height)},executeStep:function(j,i){var l=null;if(i){this.composers[1].enablePass(this.passComputeSDFFontSeed,false);this.composers[1].enablePass(this.passComputeSDFFontFlood,false);this.composers[1].enablePass(this.passComputeSDFFontMerge,true);l=this.composers[1].composerContext.getResult(undefined,true);this.passComputeSDFFontMerge.uniforms.prevMap.value=l}else{if(j>0){this.composers[1].enablePass(this.passComputeSDFFontSeed,false);this.composers[1].enablePass(this.passComputeSDFFontFlood,true);this.composers[1].enablePass(this.passComputeSDFFontMerge,false);l=this.composers[1].composerContext.getResult(undefined,true);this.passComputeSDFFontFlood.uniforms.prevMap.value=l;var k=1;this.passComputeSDFFontFlood.uniforms.invSize.value.set(k/this.width,k/this.height);if(k<1){return}}else{this.composers[1].enablePass(this.passComputeSDFFontSeed,true);this.composers[1].enablePass(this.passComputeSDFFontFlood,false);this.composers[1].enablePass(this.passComputeSDFFontMerge,false);this.passComputeSDFFontFlood.uniforms.prevMap.value=this.texture}}this.composers[1].render();if(l){this.renderTargetPool.pushRenderTarget(l);l=null}},renderToScreen:function(){this.passDisplayMap.renderToScreen=true;this.composers[0].render()},renderOffscreen:function(){this.passDisplayMap.renderToScreen=false;this.composers[0].render()},getOutputSize:function(){return{width:Math.floor(this.width*this.OutputRatio),height:Math.floor(this.height*this.OutputRatio)}}});return e});define("DS/Effects/DownSamplingEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/DownSamplingShaders","DS/Plugins/ClearPass"],function(e,c,f,d,b,g){var a=c.extend({init:function(i,h){this._parent(i);this.renderer=i;this.rtPool=h;this.map=null;this.nbIterations=3;this.passBlurH=[];return this},setSize:function(i,h){this.width=parseInt(i);this.height=parseInt(h)},setInput:function(l){if(!l){return}this.map=l;var k=0.5;if(this.composers[0]){for(var j=0;j<this.nbIterations;j++){this.composers[j].setSize(k*this.width,k*this.height);this.passBlurH[j].uniforms.invSize.value.set(1/(k*this.width),1/(k*this.height));k*=0.5}}else{for(var j=0;j<this.nbIterations;j++){var h=new e.WebGLRenderTargetProperties(k*this.width,k*this.height,"uint");this.composers[j]=new f(this.renderer,h,this.rtPool);this.composers[j].composerContext.keepResult=false;this.passBlurH[j]=new d(b.DownSampling);this.passBlurH[j].uniforms.invSize.value.set(1/(k*this.width),1/(k*this.height));this.passBlurH[j].material.needsUpdate=true;this.passBlurH[j].renderToScreen=false;this.composers[j].addPass(this.passBlurH[j]);k*=0.5}this.composers[this.nbIterations-1].composerContext.keepResult=false;for(var j=1;j<this.nbIterations;j++){this.passBlurH[j].addRequiredComposer(this.composers[j-1]);this.composers[j-1].linkToShaderPassUniform(this.passBlurH[j],this.passBlurH[j].uniforms.tDiffuse2)}}this.map.linkToShaderPassUniform(this.passBlurH[0],this.passBlurH[0].uniforms.tDiffuse2)},execute:function(){this.composers[this.nbIterations-1].render()}});return a});define("DS/Effects/ESMEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/BloomShaders","DS/Plugins/ClearPass"],function(e,c,f,d,b,g){var a=c.extend({init:function(i,h){this._parent(i);this.renderer=i;this.rtPool=h;this.map=null;this.passBlurH=null;this.passBlurV=null;return this},setSize:function(i,h){this.width=parseInt(i);this.height=parseInt(h)},setInput:function(i){if(!i){return}this.map=i;if(this.composers[0]){this.composers[0].setSize(this.width,this.height);this.passBlurH.uniforms.invSize.value.set(1/this.width,1/this.height);this.passBlurV.uniforms.invSize.value.set(1/this.width,1/this.height)}else{var h=new e.WebGLRenderTargetProperties(this.width,this.height,"linear");this.composers[0]=new f(this.renderer,h,this.rtPool);this.composers[0].composerContext.keepResult=true;this.passBlurH=new d(b.BlurH2);this.passBlurV=new d(b.BlurV);this.passBlurH.material.defines={LEVEL:3};this.passBlurV.material.defines={LEVEL:3};this.passBlurH.uniforms.invSize.value.set(1/this.width,1/this.height);this.passBlurV.uniforms.invSize.value.set(1/this.width,1/this.height);this.passBlurH.material.needsUpdate=true;this.passBlurV.material.needsUpdate=true;this.passBlurH.renderToScreen=false;this.passBlurV.renderToScreen=false;this.composers[0].addPass(this.passBlurH);this.composers[0].addPass(this.passBlurV)}this.passBlurH.uniforms.tDiffuse2.value=this.map},execute:function(){this.composers[0].render(0,undefined,undefined,"toto")},getResult:function(){return this.composers[0].getRenderResult("toto")}});return a});define("DS/Effects/SSAOIterativeEffect",["DS/Visualization/ThreeJS_DS","WebappsUtils/WebappsUtils","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/SSAOIterativeShader","DS/Shaders/MultiplicativeBlendShader","DS/Shaders/NothingShader"],function(g,b,d,e,c,a,i,f){var h=d.extend({init:function(p,o){var r=this._parent(p);var q=new g.WebGLRenderTargetProperties(this.width,this.height,"linear");this.influenceRadius=0.2;var m=new e(p,q,o);m.composerContext.keepResult=true;this.composers.push(m);this.effectSSAO=new c(a);var n=new c(f);this.composers[0].addPass(this.effectSSAO);this.composers[0].addPass(n);this.mixPass=new c(i,undefined,"SSAOIterativeEffect");var k=new Uint8Array(2*2*4);for(var l=0;l<2*2;l++){k[4*l]=0;k[4*l+1]=0;k[4*l+2]=0;k[4*l+3]=255}this.initTexture=new g.DataTexture(k,2,2,g.RGBAFormat,g.UnsignedByteType,new g.LatLongReflectionMapping(),g.ClampToEdgeWrapping,g.ClampToEdgeWrapping,g.LinearFilter,g.LinearFilter);this.initTexture.generateMipmaps=false;this.initTexture.needsUpdate=true;this.renderer.setTexture(this.initTexture,0);this.setStrength(0.95);return this},initEffect:function(k,l){var j=l.getComposer("normalDepth");j.linkToShaderPassUniform(this.effectSSAO,this.effectSSAO.uniforms.tNormalDepth);l.insertComposer(this.composers[0],this.mixPass);this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse2);this.mixPass.addRequiredComposer(this.composers[0])},update:function(r,k,n,o){n._renderedCamera.projectionMatrixInverse.getInverse(n._renderedCamera.projectionMatrix);this.effectSSAO.uniforms.realProjectionMatrixInverse.value=n._renderedCamera.projectionMatrixInverse;var m=k.getBoundingSphere(),q=this.influenceRadius*m.radius,j=(new g.Vector3().subVectors(n.target,n._renderedCamera.position)).length(),p=this.influenceRadius*j*Math.tan(0.5*n._renderedCamera.fov*(Math.PI/180));q=(q>p)?p:q;this.effectSSAO.uniforms.radius.value=q;this.effectSSAO.uniforms.numIteration.value=o;this.effectSSAO.uniforms.firstSample.value=8*o;this.effectSSAO.uniforms.prevMap.value=!o?this.initTexture:this.composers[0].composerContext.renderTarget2;var l=Math.min(8*o,this.getMaxIteration())/this.getMaxIteration();this.setStrength(Math.min(1,Math.max(0,0.95*l)))},setStrength:function(k){var j=Math.min(Math.max(k,0.000001),1);this.mixPass.uniforms.strength.value=Math.log(j)+0.7},setThresholdAngle:function(j){this.effectSSAO.uniforms.thresholdAngle.value=Math.cos(j)},setRadius:function(j){this.influenceRadius=Math.max(0,Math.min(j,1))},setSize:function(l,j){var k=this._parent(l,j);if(!k){return}this.composers[0].setSize(this.width,this.height);this.effectSSAO.uniforms.screenMin.value=Math.min(this.width,this.height);this.effectSSAO.uniforms.screenRatio.value=this.height/this.width},getMaxIteration:function(){return 64}});return h});define("DS/Effects/MSAAEffect",["DS/Visualization/ThreeJS_DS","WebappsUtils/WebappsUtils","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/MSAAShaders","DS/Shaders/NothingShader"],function(e,f,a,h,d,c,g){var b=a.extend({init:function(q,p){this._parent(q);var o=new e.WebGLRenderTargetProperties(this.width,this.height,"linear");o.generateMipmaps=false;this.composers[0]=new h(q,o,p);this.composers[0].composerContext.keepResult=true;this.passBlend=new d(c.Blending);var n=new d(g);this.composers[0].addPass(this.passBlend);this.composers[0].addPass(n);this.mixPass=new d(c.Transfer,undefined,"MSAAEffect");this.tmpResult=null;this.renderTargetPool=p;var k=new Uint8Array(2*2*4);for(var l=0;l<2*2;l++){k[4*l]=0;k[4*l+1]=0;k[4*l+2]=0;k[4*l+3]=255}this.initTexture=new e.DataTexture(k,2,2,e.RGBAFormat,e.UnsignedByteType,new e.LatLongReflectionMapping(),e.ClampToEdgeWrapping,e.ClampToEdgeWrapping,e.LinearFilter,e.LinearFilter);this.initTexture.generateMipmaps=false;this.initTexture.needsUpdate=true;this.renderer.setTexture(this.initTexture,0);this.maxIteration=128;this.msaaOffset=[];for(var m=0;m<this.maxIteration;m++){var r=e.RandomLib.LowDiscrepancy2D(m);this.msaaOffset.push({x:r.x-0.5,y:r.y-0.5})}return this},initEffect:function(i,j){j.insertComposer(null,this.mixPass);this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse2);this.mixPass.addRequiredComposer(this.composers[0])},update:function(j,i,k,l){l=l-1;this.passBlend.uniforms.numIteration.value=l;this.passBlend.uniforms.prevMap.value=!l?this.initTexture:this.composers[0].composerContext.renderTarget2;var m=this;this.mixPass.beforeRenderCB=function(n){if(l===0){m.passBlend.uniforms.prevMap.value=m.initTexture}else{if(l>0){m.tmpResult=m.composers[0].composerContext.getResult("main",true);m.passBlend.uniforms.prevMap.value=m.tmpResult}}};this.mixPass.afterRenderCB=function(){if(m.tmpResult){m.renderTargetPool.pushRenderTarget(m.tmpResult);m.tmpResult=null}};if(l>=this.getMaxIteration()){this.mixPass.requiredComposers=[]}else{if(!this.mixPass.requiredComposers.length){this.mixPass.addRequiredComposer(this.composers[0])}}},getMaxIteration:function(){return this.maxIteration},computeJitterCamera:function(i,k){var l=i.clone();var j=Math.min(this.getMaxIteration()-1,k);l.updateProjectionMatrix(this.msaaOffset[j].x/this.width,this.msaaOffset[j].y/this.height);return l},computeJitterValues:function(i,k){var j=Math.min(this.getMaxIteration()-1,k);return new e.Vector2(this.msaaOffset[j].x/this.width,this.msaaOffset[j].y/this.height)},setSize:function(k,i){var j=this._parent(k,i);if(!j){return}this.composers[0].setSize(this.width,this.height)}});return b});define("DS/Effects/GenerateMipMaps",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/DownSamplingShaders","DS/Plugins/ClearPass","DS/Shaders/DisplayIrradianceMapShader"],function(d,b,e,c,a,h,g){var f=b.extend({init:function(j,i){this._parent(j);this.renderer=j;this.rtPool=i;this.map=null;this.nbIterations=9;this.passMip=[];this.passMergeMips=null;this.passDisplayMap=null;return this},setSize:function(j,i){this.width=(typeof j==="string")?parseInt(j):j;this.height=(typeof i==="string")?parseInt(i):i;this.nbIterations=Math.round(Math.log(Math.min(this.width,this.height))/Math.log(2))-1},setInput:function(p){if(!p){return}this.map=p;var o=0.5;if(this.composers[0]){for(var k=0;k<this.nbIterations;k++){this.composers[k].setSize(o*this.width,o*this.height);this.passMip[k].uniforms.invSize.value.set(1/(o*this.width),1/(o*this.height));o*=0.5}this.composers[this.nbIterations].setSize(this.width,2*this.height)}else{for(var k=0;k<this.nbIterations;k++){var j=new d.WebGLRenderTargetProperties(o*this.width,o*this.height,"linear");this.composers[k]=new e(this.renderer,j,this.rtPool);this.composers[k].composerContext.keepResult=false;this.composers[k].composerContext.noIdCheck=true;this.passMip[k]=new c(a.DownSamplingBlur,undefined,"GenerateMips"+k);this.passMip[k].uniforms.invSize.value.set(1/(o*this.width),1/(o*this.height));this.passMip[k].material.needsUpdate=true;this.passMip[k].renderToScreen=false;this.composers[k].addPass(this.passMip[k]);o*=0.5}var l=new d.WebGLRenderTargetProperties(this.width,2*this.height,"linear");this.composers[this.nbIterations]=new e(this.renderer,l,this.rtPool);this.composers[this.nbIterations].composerContext.keepResult=false;this.composers[this.nbIterations].composerContext.noIdCheck=true;this.passMergeMips=new c(a.MergeMips(this.nbIterations),undefined,"MergeMips");this.passMergeMips.renderToScreen=false;this.composers[this.nbIterations].addPass(this.passMergeMips);for(var k=1;k<this.nbIterations;k++){this.passMip[k].addRequiredComposer(this.composers[k-1]);this.composers[k-1].linkToShaderPassUniform(this.passMip[k],this.passMip[k].uniforms.tDiffuse2)}this.passMergeMips.addRequiredComposer(this.composers[this.nbIterations-1]);this.map.linkToShaderPassUniform(this.passMergeMips,this.passMergeMips.uniforms.tDiffuse1);for(var k=0;k<this.nbIterations;k++){this.composers[k].linkToShaderPassUniform(this.passMergeMips,this.passMergeMips.uniforms["tDiffuse"+(k+2)])}}this.map.linkToShaderPassUniform(this.passMip[0],this.passMip[0].uniforms.tDiffuse2);var n=this.nbIterations+1;if(this.composers[n]){this.composers[n].setSize(this.width,2*this.height)}else{var m=new d.WebGLRenderTargetProperties(this.width,2*this.height,"uint");m.generateMipmaps=false;this.composers[n]=new e(this.renderer,m,this.rtPool);this.composers[n].composerContext.keepResult=false;this.composers[n].composerContext.noIdCheck=true;this.passDisplayMap=new c(g,undefined,"DisplayMips");this.composers[n].composerContext.setPassRenderToCanvas(this.passDisplayMap,true);this.composers[n].addPass(this.passDisplayMap);this.composers[this.nbIterations].linkToShaderPassUniform(this.passDisplayMap,this.passDisplayMap.uniforms.tDiffuse1)}},execute:function(){this.composers[this.nbIterations].render()},renderToScreen:function(){this.composers[this.nbIterations+1].render()}});return f});define("DS/Effects/BlurShadowEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/BloomShaders","DS/Plugins/ClearPass"],function(e,c,g,d,b,h){var f={uniforms:{tDiffuse2:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;",e._DefaultShaderChunk.model_view_projection_transformation_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse2;","varying vec2 vUv;","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","void main() {","gl_FragColor = vec4(1.0);","float shadowDepth = unpackDepth(texture2D(tDiffuse2, vUv));","if (shadowDepth < 1.0) {","  gl_FragColor.x = 0.5;","}","}"].join("\n")};var a=c.extend({init:function(j,i){this._parent(j);this.renderer=j;this.rtPool=i;this.map=null;this.passShadow=null;this.passBlurH=null;this.passBlurV=null;return this},setSize:function(j,i){this.width=parseInt(j);this.height=parseInt(i)},setInput:function(j){if(!j){return}this.map=j;if(this.composers[0]){this.composers[0].setSize(this.width,this.height);this.passBlurH.uniforms.invSize.value.set(1/this.width,1/this.height);this.passBlurV.uniforms.invSize.value.set(1/this.width,1/this.height)}else{var i=new e.WebGLRenderTargetProperties(this.width,this.height,"uint");this.composers[0]=new g(this.renderer,i,this.rtPool);this.composers[0].composerContext.keepResult=false;this.clearPass=new h("groundShadowClearPass");this.passShadow=new d(f);this.passBlurH=new d(b.BlurH);this.passBlurV=new d(b.BlurV);this.passBlurH.material.defines={LEVEL:5};this.passBlurV.material.defines={LEVEL:5};this.passBlurH.uniforms.invSize.value.set(1/this.width,1/this.height);this.passBlurV.uniforms.invSize.value.set(1/this.width,1/this.height);this.passBlurH.material.needsUpdate=true;this.passBlurV.material.needsUpdate=true;this.passBlurH.renderToScreen=false;this.passBlurV.renderToScreen=false;this.composers[0].addPass(this.clearPass);this.composers[0].addPass(this.passShadow);this.composers[0].addPass(this.passBlurH);this.composers[0].addPass(this.passBlurV);this.composers[0].composerContext.keepResult=true;this.composers[0].composerContext.setPassClear(this.clearPass,true,new e.Color(16777215),1)}this.passShadow.uniforms.tDiffuse2.value=this.map},execute:function(){this.composers[0].render(0,undefined,undefined,"toto")},getResult:function(){return this.composers[0].getRenderResult("toto")}});return a});define("DS/Effects/SSAO2IterativeEffect",["DS/Visualization/ThreeJS_DS","WebappsUtils/WebappsUtils","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/SSAO2IterativeShader","DS/Shaders/MultiplicativeBlendShader","DS/Shaders/NothingShader"],function(h,c,e,f,d,a,i,g){var b=e.extend({init:function(p,r){var o=this._parent(p);var l=new h.WebGLRenderTargetProperties(this.width,this.height,"linear");this.influenceRadius=0.2;var k=new f(p,l,r);k.composerContext.keepResult=true;this.composers.push(k);this.renderTargetPool=r;this.effectSSAO=new d(a);var q=new d(g);this.tmpResult=null;var s=h.RandomLib.computeHaltonSequence4D(64);s.minFilter=h.NearestFilter;s.magFilter=h.NearestFilter;s.needsUpdate=true;this.effectSSAO.uniforms.tRandSeq.value=s;this.composers[0].addPass(this.effectSSAO);this.composers[0].addPass(q);this.mixPass=new d(i,undefined,"SSAO2IterativeEffect");var n=new Uint8Array(2*2*4);for(var m=0;m<2*2;m++){n[4*m]=0;n[4*m+1]=0;n[4*m+2]=0;n[4*m+3]=255}this.initTexture=new h.DataTexture(n,2,2,h.RGBAFormat,h.UnsignedByteType,new h.LatLongReflectionMapping(),h.ClampToEdgeWrapping,h.ClampToEdgeWrapping,h.LinearFilter,h.LinearFilter);this.initTexture.generateMipmaps=false;this.initTexture.needsUpdate=true;this.renderer.setTexture(this.initTexture,0);this.setStrength(0.7);return this},initEffect:function(k,l){var j=l.getComposer("normalDepth");j.linkToShaderPassUniform(this.effectSSAO,this.effectSSAO.uniforms.tNormalDepth);l.insertComposer(this.composers[0],this.mixPass);this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse2);this.mixPass.addRequiredComposer(this.composers[0])},update:function(s,k,n,o){o--;this.mixPass.composer.contexts[0].enablePass(this.mixPass,(o>=0));this.composers[0].enablePass(this.effectSSAO,(o>=0));n._renderedCamera.projectionMatrixInverse.getInverse(n._renderedCamera.projectionMatrix);this.effectSSAO.uniforms.realProjectionMatrixInverse.value=n._renderedCamera.projectionMatrixInverse;this.effectSSAO.uniforms.realProjectionMatrix.value=n._renderedCamera.projectionMatrix;var m=k.getBoundingSphere(),r=this.influenceRadius*m.radius,j=(new h.Vector3().subVectors(n.target,n._renderedCamera.position)).length(),p=this.influenceRadius*j*Math.tan(0.5*n._renderedCamera.fov*(Math.PI/180));r=(r>p)?p:r;this.effectSSAO.uniforms.radius.value=r;this.effectSSAO.uniforms.numIteration.value=o;this.effectSSAO.uniforms.firstSample.value=16*o;this.effectSSAO.uniforms.prevMap.value=!o?this.initTexture:this.composers[0].composerContext.renderTarget2;var q=this;this.mixPass.beforeRenderCB=function(t){if(o===0){q.effectSSAO.uniforms.prevMap.value=q.initTexture}else{if(o>0){q.tmpResult=q.composers[0].composerContext.getResult("main",true);q.effectSSAO.uniforms.prevMap.value=q.tmpResult}}};this.mixPass.afterRenderCB=function(){if(q.tmpResult){q.renderTargetPool.pushRenderTarget(q.tmpResult);q.tmpResult=null}};var l=Math.min(16*o,this.getMaxIteration())/this.getMaxIteration();this.setStrength(Math.min(1,Math.max(0,0.7*l)))},setStrength:function(k){var j=Math.min(Math.max(k,0.000001),1);this.mixPass.uniforms.strength.value=Math.log(j)+0.7},setThresholdAngle:function(j){this.effectSSAO.uniforms.thresholdAngle.value=Math.cos(j)},setRadius:function(j){this.influenceRadius=Math.max(0,Math.min(j,1))},setSize:function(l,j){var k=this._parent(l,j);if(!k){return}this.composers[0].setSize(this.width,this.height);this.effectSSAO.uniforms.screenSize.value.set(this.width,this.height);this.effectSSAO.uniforms.invSize.value.set(1/this.width,1/this.height)},getMaxIteration:function(){return 64}});return b});define("DS/Effects/ComputeSDFFontMergeTiles",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/NothingShader","DS/Shaders/PreComputeSDFFontIterativeShaders"],function(d,b,f,c,e,g){var a=b.extend({init:function(i,h){this._parent(i);this.renderer=i;this.rtPool=h;this.width=512;this.height=512;this.tileMin=new d.Vector2();this.tileMax=new d.Vector2();this.realTileMax=new d.Vector2();this.map=null;this.passMergeTile=null;this.passNothing=null;return this},setSize:function(i,h){this.width=parseInt(i);this.height=parseInt(h)},setTileInfos:function(l,j,k,i,h,m){this.tileMin.set(l/this.width,j/this.height);this.tileMax.set((l+k)/this.width,(j+i)/this.height);this.realTileMax.set((l+h)/this.width,(j+m)/this.height);if(this.passMergeTile){this.passMergeTile.uniforms.tileMin.value=this.tileMin;this.passMergeTile.uniforms.tileMax.value=this.tileMax;this.passMergeTile.uniforms.realTileMax.value=this.realTileMax}},setInput:function(h){if(!h){return}this.map=h;if(this.composers[0]){this.composers[0].setSize(this.width,this.height)}else{var i=new d.WebGLRenderTargetProperties(this.width,this.height,"uint");this.composers[0]=new f(this.renderer,i,this.rtPool);this.composers[0].composerContext.keepResult=true;this.passMergeTile=new c(g.MergeTiles);this.passMergeTile.renderToScreen=false;this.passNothing=new c(e);this.composers[0].addPass(this.passMergeTile);this.composers[0].addPass(this.passNothing)}this.map.linkToShaderPassUniform(this.passMergeTile,this.passMergeTile.uniforms.tDiffuse2)},execute:function(){this.composers[0].render()}});return a});define("DS/Effects/CompareModelsEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/ComposerContext","DS/Plugins/ClearPass","DS/Plugins/RenderPass","DS/Plugins/ShaderPass","DS/Shaders/CompareModelsShader"],function(e,c,a,h,b,d,g){var f=c.extend({init:function(j,i){this._parent(j);this.mixPass=new d(g,undefined,"compareModelPass");this.mixPass.compileShader(j);this.tolerance=0.0001;this.composerEffects=[];this.forwardContext=null;this.passClearOld=null;this.passColorOld=null;this.passDepthOld=null;this.passDepthNew=null;this.passAll=null;this.passSectionCappingFrontFaces1=null;this.passSectionCappingFrontFaces2=null;this.passSectionCappingFrontFaces3=null;this.v6renderer=null;this.forwardPass=null;return this},initEffect:function(s,q){var k=new e.WebGLRenderTargetProperties(this.width,this.height,"linear");k.generateMipmaps=false;var l=new a(k,q.mainComposer,"colorOldComposerContext");l.keepResult=true;var i=new e.WebGLRenderTargetProperties(this.width,this.height,"linear");i.generateMipmaps=false;var t=new a(i,q.mainComposer,"depthOldComposerContext");t.keepResult=true;var o=new e.WebGLRenderTargetProperties(this.width,this.height,"linear");o.generateMipmaps=false;var p=new a(o,q.mainComposer,"depthNewComposerContext");p.keepResult=true;this.composerEffects.push(l);this.composerEffects.push(t);this.composerEffects.push(p);q.customComposerContexts=[];q.customComposerContexts[0]=l;q.customComposerContexts[1]=t;q.customComposerContexts[2]=p;var n=new h("depth_clear_old");n.clearColor=new e.Color(0);n.clearAlpha=0;n.disabledByDefault=true;this.passClearOld=n;var u=new b(null,null,null,true,false,false,"color_old");u.idString="compareOld";u.disabledByDefault=true;this.passColorOld=u;var r=new b(null,null,null,true,false,false,"depth_old");r.idString="compareOld";r.disabledByDefault=true;r.setMaterialToUse(e.MaterialToUse.normalDepthMaterial);this.passDepthOld=r;var j=new b(null,null,null,true,false,false,"depth_new");j.idString="compareNew";j.disabledByDefault=true;j.setMaterialToUse(e.MaterialToUse.normalDepthMaterial);this.passDepthNew=j;var m=new b(null,null,null,true,false,false,"all_models");m.disabledByDefault=true;this.passAll=m;this.passSectionCappingFrontFaces1=new b(null,null,null,true,false,false,"colorOldCapping");this.passSectionCappingFrontFaces1.setRenderCuttingElements(true);this.passSectionCappingFrontFaces1.idString="compareOld";this.passSectionCappingFrontFaces1.setEnableStencilTest(true);this.passSectionCappingFrontFaces1.setEnableStencilWrite(true);this.passSectionCappingFrontFaces1.setDisableColorWrite(true);this.passSectionCappingFrontFaces1.setDisableDepthWrite(true);this.passSectionCappingFrontFaces1.setStencilFunc("ALWAYS");this.passSectionCappingFrontFaces1.setStencilOps("INCR_WRAP","DECR_WRAP");this.passSectionCappingFrontFaces1.setDisableBackFaceCulling(true);this.passSectionCappingFrontFaces1.setHideSurfacesAndUnclippedMeshes(true);this.passSectionCappingFrontFaces1.setDisableBackFaceClipPlanes(+1);this.passSectionCappingFrontFaces1.setRenderPluginsPre(false);this.passSectionCappingFrontFaces1.setRenderPluginsPost(false);this.passSectionCappingFrontFaces1.ignoreNoZ=true;this.passSectionCappingFrontFaces1.scene=q.scene;this.passSectionCappingFrontFaces1.disabledByDefault=true;this.passSectionCappingFrontFaces2=new b(null,null,null,true,false,false,"depthOldCapping");this.passSectionCappingFrontFaces2.setRenderCuttingElements(true);this.passSectionCappingFrontFaces2.idString="compareOld";this.passSectionCappingFrontFaces2.setEnableStencilTest(true);this.passSectionCappingFrontFaces2.setEnableStencilWrite(true);this.passSectionCappingFrontFaces2.setDisableColorWrite(true);this.passSectionCappingFrontFaces2.setDisableDepthWrite(true);this.passSectionCappingFrontFaces2.setStencilFunc("ALWAYS");this.passSectionCappingFrontFaces2.setStencilOps("INCR_WRAP","DECR_WRAP");this.passSectionCappingFrontFaces2.setDisableBackFaceCulling(true);this.passSectionCappingFrontFaces2.setHideSurfacesAndUnclippedMeshes(true);this.passSectionCappingFrontFaces2.setDisableBackFaceClipPlanes(+1);this.passSectionCappingFrontFaces2.setRenderPluginsPre(false);this.passSectionCappingFrontFaces2.setRenderPluginsPost(false);this.passSectionCappingFrontFaces2.ignoreNoZ=true;this.passSectionCappingFrontFaces2.scene=q.scene;this.passSectionCappingFrontFaces2.setMaterialToUse(e.MaterialToUse.normalDepthMaterial);this.passSectionCappingFrontFaces2.disabledByDefault=true;this.passSectionCappingFrontFaces3=new b(null,null,null,true,false,false,"depthNewCapping");this.passSectionCappingFrontFaces3.setRenderCuttingElements(true);this.passSectionCappingFrontFaces3.idString="compareNew";this.passSectionCappingFrontFaces3.setEnableStencilTest(true);this.passSectionCappingFrontFaces3.setEnableStencilWrite(true);this.passSectionCappingFrontFaces3.setDisableColorWrite(true);this.passSectionCappingFrontFaces3.setDisableDepthWrite(true);this.passSectionCappingFrontFaces3.setStencilFunc("ALWAYS");this.passSectionCappingFrontFaces3.setStencilOps("INCR_WRAP","DECR_WRAP");this.passSectionCappingFrontFaces3.setDisableBackFaceCulling(true);this.passSectionCappingFrontFaces3.setHideSurfacesAndUnclippedMeshes(true);this.passSectionCappingFrontFaces3.setDisableBackFaceClipPlanes(+1);this.passSectionCappingFrontFaces3.setRenderPluginsPre(false);this.passSectionCappingFrontFaces3.setRenderPluginsPost(false);this.passSectionCappingFrontFaces3.ignoreNoZ=true;this.passSectionCappingFrontFaces3.scene=q.scene;this.passSectionCappingFrontFaces3.setMaterialToUse(e.MaterialToUse.normalDepthMaterial);this.passSectionCappingFrontFaces3.disabledByDefault=true;q.mainComposer.insertCustomPassAfterPass(n,null);q.mainComposer.insertCustomPassAfterPass(u,n);q.mainComposer.insertCustomPassAfterPass(this.passSectionCappingFrontFaces1,u);q.mainComposer.insertCustomPassAfterPass(r,this.passSectionCappingFrontFaces1);q.mainComposer.insertCustomPassAfterPass(this.passSectionCappingFrontFaces2,r);q.mainComposer.insertCustomPassAfterPass(j,this.passSectionCappingFrontFaces2);q.mainComposer.insertCustomPassAfterPass(this.passSectionCappingFrontFaces3,j);q.mainComposer.insertCustomPassAfterPass(m,this.passSectionCappingFrontFaces3);this.v6renderer=q;this.forwardContext=q.compForwardComposerContext;this.forwardPass=q.forwardPass;q.insertComposer(null,this.mixPass);l.linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tCommonColor);t.linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDepthOld);p.linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDepthNew)},update:function(k,j,m){var i=this.v6renderer.clippingScene?true:false;this.composerEffects[0].enablePass(this.passSectionCappingFrontFaces1,i);this.composerEffects[1].enablePass(this.passSectionCappingFrontFaces2,i);this.composerEffects[2].enablePass(this.passSectionCappingFrontFaces3,i);var l=m._renderedCamera;l.projectionMatrixInverse.getInverse(l.projectionMatrix);this.mixPass.uniforms.realProjectionMatrixInverse.value=l.projectionMatrixInverse;this.mixPass.uniforms.tolerance.value=this.tolerance},setTolerance:function(i){this.tolerance=i},setSize:function(m,j){var l=this._parent(m,j);if(!l){return}for(var k=0;k<this.composerEffects.length;k++){this.composerEffects[k].setSize(m,j)}},setEnabled:function(j){this._parent(j);var k=this.v6renderer.clippingScene?true:false;this.composerEffects[0].setPassClear(this.passClearOld,j);this.composerEffects[0].setPassClearDepth(this.passClearOld,j);this.composerEffects[0].enablePass(this.passClearOld,j);this.composerEffects[0].enablePass(this.passColorOld,j);this.composerEffects[0].enablePass(this.passSectionCappingFrontFaces1,k&&j);this.composerEffects[1].enablePass(this.passDepthOld,j);this.composerEffects[1].enablePass(this.passSectionCappingFrontFaces2,k&&j);this.composerEffects[2].enablePass(this.passDepthNew,j);this.composerEffects[2].enablePass(this.passSectionCappingFrontFaces3,k&&j);for(var l=0;l<3;l++){this.composerEffects[l].enablePass(this.forwardPass,false);this.composerEffects[l].needsUpdate=j;this.composerEffects[l].enablePass(this.v6renderer.infPlanePass,false);this.composerEffects[l].enablePass(this.v6renderer.mirrorBlendPass,false)}},});return f});define("Effects/CompareModelsEffect",["DS/Effects/CompareModelsEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/CompareModelsEffect");return b});define("DS/Effects/SMAAEffect",["DS/Visualization/ThreeJS_DS","WebappsUtils/WebappsUtils","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/SMAAShader","DS/Plugins/ClearPass"],function(d,e,b,g,c,f,h){var a=b.extend({init:function(n,m){this._parent(n);var j=new d.WebGLRenderTargetProperties(this.width,this.height,"uint");this.composer=new g(n,j,m);this.composer.composerContext.name="SMAAEffect";this.composers.push(this.composer);this.pass1=new c(f.EdgeDetection);this.pass1.compileShader(n);this.pass2=new c(f.BlendingWeights);this.pass2.compileShader(n);this.mixPass=new c(f.FinalBlending,undefined,"SMAAEffect");this.mixPass.compileShader(n);this.composer.addPass(this.pass1);this.composer.addPass(this.pass2);var i=e.getWebappsAssetUrl("Effects","");var l=new d.ImageUtils.loadTexture(i+"AreaTexSMAA.png",undefined,null,null,d.ImageUtils.crossOriginPolicy);l.minFilter=d.LinearFilter;l.magFilter=d.LinearFilter;this.pass2.uniforms.areaTex.value=l;var k=new d.ImageUtils.loadTexture(i+"SearchTexSMAA.png",undefined,null,null,d.ImageUtils.crossOriginPolicy);k.minFilter=d.NearestFilter;k.magFilter=d.NearestFilter;this.pass2.uniforms.searchTex.value=k;this.areaTexture=l;this.searchTexture=k;return this},initEffect:function(i,j){j.insertComposer(this.composer,this.mixPass);this.composer.linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse2);this.mixPass.addRequiredComposer(this.composer)},update:function(j,i,k){},setSize:function(k,i){var j=this._parent(k,i);if(!j){return}this.composer.setSize(this.width,this.height);this.pass1.uniforms.screenWidth.value=this.width;this.pass1.uniforms.screenHeight.value=this.height;this.pass2.uniforms.screenWidth.value=this.width;this.pass2.uniforms.screenHeight.value=this.height;this.mixPass.uniforms.screenWidth.value=this.width;this.mixPass.uniforms.screenHeight.value=this.height},dispose:function(){this._parent();this.areaTexture.dispose();this.searchTexture.dispose()}});return a});define("Effects/SMAAEffect",["DS/Effects/SMAAEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/SMAAEffect");return b});define("DS/Effects/SSAO2Effect",["DS/Visualization/ThreeJS_DS","WebappsUtils/WebappsUtils","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/SSAO3Shader","DS/Shaders/AdaptativeBlurShader","DS/Shaders/MultiplicativeBlendShader","DS/Plugins/ClearPass"],function(h,a,c,f,b,g,j,i,e){var d=c.extend({init:function(o,n){var q=this._parent(o);this.__renderer=o;var p=new h.WebGLRenderTargetProperties(this.width,this.height,"uintRGBA");var m=new f(o,p,n);m.composerContext.keepResult=true;this.composers.push(m);this.version=2;this.influenceRadius=0.3;this.mixPass=new b(i,undefined,"SSAOEffect");this.mixPass.compileShader(o);this.__compNormalDepth=null;this.setVersion(this.version);var k=new Uint8Array(2*2*4);for(var l=0;l<2*2;l++){k[4*l]=0;k[4*l+1]=0;k[4*l+2]=0;k[4*l+3]=255}this.initTexture=new h.DataTexture(k,2,2,h.RGBAFormat,h.UnsignedByteType,new h.LatLongReflectionMapping(),h.ClampToEdgeWrapping,h.ClampToEdgeWrapping,h.LinearFilter,h.LinearFilter);this.initTexture.generateMipmaps=false;this.initTexture.needsUpdate=true;this.renderer.setTexture(this.initTexture,0);return this},initEffect:function(k,l){if(k){this.mixPass.disabledByDefault=true;this.mixPass.needsSwap=false;this.mixPass.material.defines.POSTPRO=0;this.mixPass.material.transparent=true;this.mixPass.material.needsUpdate=true}this.__compNormalDepth=l.getComposer("normalDepth");if(this.version===1){this.__compNormalDepth.linkToShaderPassUniform(this.effectSSAO_1_32,this.effectSSAO_1_32.uniforms.tNormalDepth)}else{if(this.version===2){this.__compNormalDepth.linkToShaderPassUniform(this.effectSSAO_2,this.effectSSAO_2.uniforms.tNormalDepth)}else{this.__compNormalDepth.linkToShaderPassUniform(this.effectSSAO_0,this.effectSSAO_0.uniforms.tNormalDepth)}this.__compNormalDepth.linkToShaderPassUniform(this.effectSSAOBlurH,this.effectSSAOBlurH.uniforms.tNormalDepth);this.__compNormalDepth.linkToShaderPassUniform(this.effectSSAOBlurV,this.effectSSAOBlurV.uniforms.tNormalDepth)}l.insertComposer(this.composers[0],this.mixPass);this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse2);this.mixPass.addRequiredComposer(this.composers[0])},update:function(t,l,o,p,n){var s=o._renderedCamera;s.projectionMatrixInverse.getInverse(s.projectionMatrix);var m=l.getBoundingSphere(),r=this.influenceRadius*m.radius,k=(new h.Vector3().subVectors(o.target,s.position)).length(),q=this.influenceRadius*k*Math.tan(0.5*s.fov*(Math.PI/180));r=(r>q)?q:r;if(this.version===1){this.composers[0].composerContext.needsUpdate=(p<=2);this.effectSSAO_1_32.uniforms.realProjectionMatrixInverse.value=s.projectionMatrixInverse;this.effectSSAO_1_32.uniforms.radius.value=r;this.effectSSAO_1_32.uniforms.numIteration.value=p;this.effectSSAO_1_32.uniforms.prevMap.value=!p?this.initTexture:this.composers[0].composerContext.renderTarget2}else{if(this.version===2){this.effectSSAO_2.uniforms.realProjectionMatrixInverse.value=s.projectionMatrixInverse;this.effectSSAO_2.uniforms.radius.value=r}else{this.effectSSAO_0.uniforms.realProjectionMatrixInverse.value=s.projectionMatrixInverse;this.effectSSAO_0.uniforms.radius.value=r}this.effectSSAOBlurH.uniforms.radius.value=r;this.effectSSAOBlurV.uniforms.radius.value=r}},setStrength:function(l){var k=Math.min(Math.max(l,0.000001),1);this.mixPass.uniforms.strength.value=Math.log(k)+0.7},setThresholdAngle:function(k){if(this.version===1){this.effectSSAO_1_32.uniforms.thresholdAngle.value=Math.cos(k)}else{if(this.version===2){this.effectSSAO_2.uniforms.thresholdAngle.value=Math.cos(k)}else{this.effectSSAO_0.uniforms.thresholdAngle.value=Math.cos(k)}}},setNbSamples:function(k){if((this.version===0)&&this.effectSSAO_0){this.effectSSAO_0.uniforms.tau.value=this.tau[this.effectSSAO_0.uniforms.nbSamples.value];this.effectSSAO_0.uniforms.nbSamples.value=Math.min(k,32)}if((this.version===2)&&this.effectSSAO_2){this.effectSSAO_2.uniforms.tau.value=this.tau[this.effectSSAO_2.uniforms.nbSamples.value];this.effectSSAO_2.uniforms.nbSamples.value=Math.min(k,32)}},setRadius:function(k){this.influenceRadius=Math.max(0,Math.min(k,1))},setSize:function(m,k,n){var l=this._parent(m,k);if(!l&&!n){return}this.composers[0].setSize(this.width,this.height);if(this.version!==1){if(this.effectSSAO_0){this.effectSSAO_0.uniforms.screenMin.value=Math.min(this.width,this.height);this.effectSSAO_0.uniforms.screenRatio.value=this.height/this.width}if(this.effectSSAO_2){this.effectSSAO_2.uniforms.screenRatio.value=this.height/this.width;this.effectSSAO_2.uniforms.screenSize.value.set(this.width,this.height);this.effectSSAO_2.uniforms.invSize.value.set(1/this.width,1/this.height)}this.effectSSAOBlurH.uniforms.invSize.value.set(1/this.width,1/this.height);this.effectSSAOBlurV.uniforms.invSize.value.set(1/this.width,1/this.height)}if((this.version===1)&&this.effectSSAO_1_32){this.effectSSAO_1_32.uniforms.screenRatio.value=this.height/this.width;this.effectSSAO_1_32.uniforms.screenSize.value.set(this.width,this.height);this.effectSSAO_1_32.uniforms.invSize.value.set(1/this.width,1/this.height)}},_setVersion:function(k){this.version=k;if(k!==1){if(!this.tau){var l=[];l[0]=0;l[1]=1;l[2]=1;l[3]=2;l[4]=3;l[5]=3;l[6]=5;l[7]=5;l[8]=5;l[9]=7;l[10]=7;l[11]=7;l[12]=7;l[13]=7;l[14]=11;l[15]=11;l[16]=11;l[17]=13;l[18]=13;l[19]=13;l[20]=17;l[21]=17;l[22]=17;l[23]=17;l[24]=19;l[25]=19;l[26]=19;l[27]=23;l[28]=23;l[29]=23;l[30]=23;l[31]=27;l[32]=27;l[48]=43;l[64]=59;this.tau=l}if((k===0)&&!this.effectSSAO_0){this.effectSSAO_0=new b(g.SSAO_V0);this.effectSSAO_0.order=0;this.effectSSAO_0.compileShader(this.__renderer);this.composers[0].addPass(this.effectSSAO_0);this.__compNormalDepth&&this.__compNormalDepth.linkToShaderPassUniform(this.effectSSAO_0,this.effectSSAO_0.uniforms.tNormalDepth);j.H.defines.NB_SAMPLES=4;j.V.defines.NB_SAMPLES=4;j.H.defines.STEP="1.5";j.V.defines.STEP="1.5"}if((k===2)&&!this.effectSSAO_2){this.effectSSAO_2=new b(g.SSAO_V2);this.effectSSAO_2.order=10;this.effectSSAO_2.compileShader(this.__renderer);this.composers[0].addPass(this.effectSSAO_2);this.__compNormalDepth&&this.__compNormalDepth.linkToShaderPassUniform(this.effectSSAO_2,this.effectSSAO_2.uniforms.tNormalDepth);j.H.defines.NB_SAMPLES=3;j.V.defines.NB_SAMPLES=3;j.H.defines.STEP="1.5";j.V.defines.STEP="1.5"}if(!this.effectSSAOBlurH){this.effectSSAOBlurH=new b(j.H);this.effectSSAOBlurV=new b(j.V);this.effectSSAOBlurH.order=100;this.effectSSAOBlurV.order=110;this.effectSSAOBlurH.compileShader(this.__renderer);this.effectSSAOBlurV.compileShader(this.__renderer);this.composers[0].addPass(this.effectSSAOBlurH);this.composers[0].addPass(this.effectSSAOBlurV);this.__compNormalDepth&&this.__compNormalDepth.linkToShaderPassUniform(this.effectSSAOBlurH,this.effectSSAOBlurH.uniforms.tNormalDepth);this.__compNormalDepth&&this.__compNormalDepth.linkToShaderPassUniform(this.effectSSAOBlurV,this.effectSSAOBlurV.uniforms.tNormalDepth)}else{this.effectSSAOBlurH.compileShader(this.__renderer);this.effectSSAOBlurV.compileShader(this.__renderer)}this.composers[0].enablePass(this.effectSSAO_0,(k===0));this.composers[0].enablePass(this.effectSSAO_2,(k===2));this.composers[0].enablePass(this.effectSSAOBlurH,true);this.composers[0].enablePass(this.effectSSAOBlurV,true);if(this.effectSSAO_1_32){this.composers[0].enablePass(this.effectSSAO_1_32,false)}}else{if(!this.effectSSAO_1_32){this.effectSSAO_1_32=new b(g.SSAO_V1);this.effectSSAO_1_32.order=20;this.effectSSAO_1_32.compileShader(this.__renderer);this.composers[0].addPass(this.effectSSAO_1_32);this.__compNormalDepth&&this.__compNormalDepth.linkToShaderPassUniform(this.effectSSAO_1_32,this.effectSSAO_1_32.uniforms.tNormalDepth)}if(this.effectSSAO_0||this.effectSSAO_2){this.composers[0].enablePass(this.effectSSAO_0,false);this.composers[0].enablePass(this.effectSSAO_2,false);this.composers[0].enablePass(this.effectSSAOBlurH,false);this.composers[0].enablePass(this.effectSSAOBlurV,false)}this.composers[0].enablePass(this.effectSSAO_1_32,true)}},setVersion:function(k){this._setVersion(k);this.setStrength(0.95);if(k===1){this.influenceRadius=0.3}else{this.influenceRadius=0.2;this.setNbSamples(12)}this.setSize(this.width,this.height,true)},getMaxIteration:function(){return(this.version===1)?3:0}});return d});define("Effects/SSAO2Effect",["DS/Effects/SSAO2Effect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/SSAO2Effect");return b});define("DS/Effects/BokehDOFEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/ShaderPass","DS/Shaders/BokehDOFShader"],function(c,a,b,e){var d=a.extend({init:function(k,h){this._parent(k);this.mixPass=new b(e,undefined,"BokehDOFEffect");this.mixPass.uniforms.focusCoords.value.set(0.5,0.5);this.autofocus=true;this.distanceToTarget=100;this.lensRadius=1;this.iterative=false;this.maxIteration=128;this.dofOffset=[];var g;var f=0;for(g=0;g<this.maxIteration;g++){var l;do{l=c.RandomLib.LowDiscrepancy2D(f);l.x=2*l.x-1;l.y=2*l.y-1;f++}while(l.length()>1);this.dofOffset.push({x:l.x,y:l.y})}this.dofOffset.sort(function(j,i){if(j.x*j.x+j.y*j.y<i.x*i.x+i.y*i.y){return -1}return 1});return this},initEffect:function(g,h){h.insertComposer(null,this.mixPass);var f=h.getComposer("normalDepth");f.linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tNormalDepth)},update:function(h,g,i){i._renderedCamera.projectionMatrixInverse.getInverse(i._renderedCamera.projectionMatrix);this.mixPass.uniforms.realProjectionMatrixInverse.value=i._renderedCamera.projectionMatrixInverse;if(this.autofocus){var f=new c.Vector3().subVectors(i.target,i._renderedCamera.position);this.distanceToTarget=f.length();this.mixPass.uniforms.focalDepth.value=this.distanceToTarget}},updateFocalPlane:function(f){this.mixPass.uniforms.focalDepth.value=f},updateFocalLength:function(f){this.mixPass.uniforms.focalLength.value=f;this.lensRadius=f},updateFStop:function(f){this.mixPass.uniforms.fstop.value=f},setAutoFocus:function(f){this.autofocus=f},setSize:function(h,f){var g=this._parent(h,f);if(!g){return}this.mixPass.uniforms.textureWidth.value=h;this.mixPass.uniforms.textureHeight.value=f},setIterative:function(f){if(f===this.iterative){return}this.iterative=f;if(this.mixPass){var g=this.mixPass.composer;if(g&&g.contexts.length){g.contexts[0].enablePass(this.mixPass,this.enabled&&!this.iterative)}}},getMaxIteration:function(){return this.maxIteration},computeJitterCamera:function(o,m,f){var p=this.width/this.height;var n=o.clone();var r=n.near*Math.tan(c.Math.degToRad(0.5*n.fov));var t=p*r;var i=Math.min(this.getMaxIteration()-1,m);var k=n.near*this.lensRadius*this.dofOffset[i].x/this.mixPass.uniforms.focalDepth.value;var j=n.near*this.lensRadius*this.dofOffset[i].y/this.mixPass.uniforms.focalDepth.value;var h=t-k;var s=-(t+k);var q=r-j;var g=-(r+j);if(f){f.x*=2*Math.abs(t);f.y*=2*Math.abs(r);s+=f.x;h+=f.x;g+=f.y;q+=f.y}var l=n.getLookAt().cross(n.up);n.position.add(n.up.clone().multiplyScalar(this.lensRadius*this.dofOffset[i].y));n.position.add(l.clone().multiplyScalar(this.lensRadius*this.dofOffset[i].x));n.projectionMatrix.makeFrustum(s,h,g,q,n.near,n.far);return n}});return d});define("Effects/BokehDOFEffect",["DS/Effects/BokehDOFEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/BokehDOFEffect");return b});define("DS/Effects/OITEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/ComposerContext","DS/Plugins/EffectComposer","DS/Plugins/ClearPass","DS/Plugins/RenderPass","DS/Plugins/ShaderPass","DS/Shaders/OITShader"],function(h,d,g,f,e,a,b,c){var i=d.extend({init:function(n,m,j){this._parent(n);this.stateSortingResult=j;var l=m.buildRenderTarget(this.width,this.height,"linear",null,null,true);l.generateMipmaps=false;var k=m.buildRenderTarget(this.width,this.height,"linear",null,null,true);k.generateMipmaps=false;this.composerAccum=new f(n,l,m);this.composerAccum.needsCameraUpdate=true;this.composerAccum.targetUniform="tAccum";this.composers.push(this.composerAccum);this.composerReveal=new f(n,k,m);this.composerReveal.needsCameraUpdate=true;this.composerReveal.targetUniform="tReveal";this.composers.push(this.composerReveal);this.composerAccum.bShareDepth=true;this.composerAccum.composerContext.keepResult=true;this.composerReveal.bShareDepth=true;this.composerReveal.composerContext.keepResult=true;this.mixPass=new b(c,"tOpaque","oitPass");this.mixPass.compileShader(n);this.clearAccumPass=null;this.accumPass=null;this.clearRevealPass=null;this.revealPass=null;return this},initEffect:function(k,l){var j=["SOLID","SURFACE","EDGE","POINT","NOZ","NOZTRANSPAR"];this.clearAccumPass=new e("clear_accum_oit");this.clearAccumPass.clearColor=new h.Color(0);this.clearAccumPass.clearbColor=true;this.clearAccumPass.clear=false;this.clearAccumPass.defaults.clear=false;this.clearAccumPass.clearAlpha=0;this.clearAccumPass.disabledByDefault=true;this.accumPass=new a(l.scene,null,null,null,null,null,"oit_accum_pass");this.accumPass.setStateSortingResult(this.stateSortingResult,false);this.accumPass.isOITPass=true;this.accumPass.setMaterialToUse(h.MaterialToUse.oitAccumMaterial);this.accumPass.setDLsToDisable(j);this.accumPass.disabledByDefault=true;this.accumPass.setDisableBackFaceCulling(false);this.accumPass.setDisableDepthWrite(true);this.composerAccum.addPass(this.clearAccumPass);this.composerAccum.addPass(this.accumPass);this.composerAccum.enablePass(this.clearAccumPass,true);this.composerAccum.enablePass(this.accumPass,true);this.clearRevealPass=new e("clear_reveal_oit");this.clearRevealPass.clearColor=new h.Color(16711680);this.clearRevealPass.clear=false;this.clearRevealPass.clearbColor=true;this.clearRevealPass.defaults.clear=false;this.clearRevealPass.clearAlpha=0;this.clearRevealPass.disabledByDefault=true;this.revealPass=new a(l.scene,null,null,null,null,null,"oit_reveal_pass");this.revealPass.setStateSortingResult(this.stateSortingResult,false);this.revealPass.setMaterialToUse(h.MaterialToUse.oitRevealMaterial);this.revealPass.isOITPass=true;this.revealPass.setDLsToDisable(j);this.revealPass.disabledByDefault=true;this.revealPass.setDisableBackFaceCulling(false);this.revealPass.setDisableDepthWrite(true);this.composerReveal.addPass(this.clearRevealPass);this.composerReveal.addPass(this.revealPass);this.composerReveal.enablePass(this.clearRevealPass,true);this.composerReveal.enablePass(this.revealPass,true);this.mixPass.addRequiredComposer(this.composerAccum);this.mixPass.addRequiredComposer(this.composerReveal);l.insertComposer(null,this.mixPass)},update:function(k,j,l){},setSize:function(m,j){var l=this._parent(m,j);if(!l){return}for(var k=0;k<this.composers.length;k++){this.composers[k].setSize(m,j)}},});return i});define("Effects/OITEffect",["DS/Effects/OITEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/OITEffect");return b});define("DS/Effects/SpatialOccupationEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/RenderPass","DS/Plugins/ClearPass"],function(d,b,e,a,f){var c=b.extend({init:function(k,h){this._parent(k.renderer.renderer);var j;switch(h.filtering){case"linear":j="uint";break;case"nearest":j="uintNearest";break;default:j="uintNearest";break}var g=h.name?h.name:"offScreenPass";this.viewer=k;this.renderer=k.renderer.renderer;var i=k.renderer.renderTargetPool;this.sceneGraph=k.internalSceneGraph;this.viewpoint=k.viewpoints[0];this.width=h.targetWidth?h.targetWidth:k.SCREEN_WIDTH;this.height=h.targetHeight?h.targetHeight:k.SCREEN_HEIGHT;this.renderTarget=new d.WebGLRenderTargetProperties(this.width,this.height,j);this.composers.push(new e(this.renderer,this.renderTarget,i));this.composers[0].composerContext.keepResult=false;this.renderPass=new a(null,null,null,undefined,undefined,undefined,g);this.renderPass.idString=g;this.renderPass.setMaterialToUse(d.MaterialToUse.pickingMaterial);this.clearPass=new f("customClearPass");this.composers[0].addPass(this.clearPass);this.composers[0].addPass(this.renderPass);this.composers[0].composerContext.enablePass(this.renderPass,true);this.renderPass.setScene(this.sceneGraph.scene);this.composers[0].composerContext.setPassClear(this.clearPass,true,new d.Color(0),1);this.renderPass.renderFaces=this.renderer.renderFaces;this.renderPass.renderLineMode=this.renderer.renderLineMode;this.renderPass.renderPoints=this.renderer.renderPoints;this.renderPass.renderSurfacicPoints=this.renderer.renderSurfacicPoints;return this},renderResult:function(s){this._setSize(this.width,this.height);this.composers[0].updateScene(this.sceneGraph.scene);var n=this.renderer.context;var g={main:this.viewpoint._renderedCamera,connectedRobotCamera:this.viewpoint.connectedRobotCamera,robotCameraOrtho:this.viewpoint.robotCameraOrtho};var m=this.viewpoint._renderedCamera.pixelCulling;this.viewpoint.setPixelCulling(m*Math.min(this.width/this.viewer.SCREEN_WIDTH,this.height/this.viewer.SCREEN_HEIGHT));this.composers[0].render(undefined,undefined,g,"main");this.viewpoint.setPixelCulling(m);var q=new Uint8Array(4*this.width*this.height);n.readPixels(0,0,this.width,this.height,n.RGBA,n.UNSIGNED_BYTE,q);if(s.flipImage){var h=this.width;var r=this.height;var p=new Array();for(var l=0;l<r;l++){for(var k=0;k<h;k++){for(var o=0;o<4;o++){p.push(q[h*4*(r-1-l)+4*k+o])}}}return{data:p,width:h,height:r,}}else{return{data:q,width:this.width,height:this.height,}}},_setSize:function(h,g){this._parent(h,g);this.composers[0].setSize(h,g);this.width=h;this.height=g},});return c});define("Effects/SpatialOccupationEffect",["DS/Effects/SpatialOccupationEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/SpatialOccupationEffect");return b});define("DS/Effects/FlareEffect",["WebappsUtils/WebappsUtils","DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/BloomShaders","DS/Shaders/FlareShaders"],function(g,e,b,h,d,a,f){var c=b.extend({init:function(k,j){this._parent(k);this.threshold=1;this.passThreshold;this.passBlurH;this.passBlurV;this.passThreshold=new d(a.Threshold);var n=0.5,o;o=new e.WebGLRenderTargetProperties(n*this.width,n*this.height,"uint");this.composers[0]=new h(k,o,j);this.passBlurH=new d(a.BlurH);this.passBlurV=new d(a.BlurV);this.composers[0].addPass(this.passThreshold);this.composers[0].addPass(this.passBlurH);this.composers[0].addPass(this.passBlurV);this.passThreshold.uniforms.threshold.value=this.threshold;this.mixPass=new d(f.FinalBlending,undefined,"FlareEffect");var i=g.getWebappsAssetUrl("Effects","");var m=new e.ImageUtils.loadTexture(i+"lenscolor.png",undefined,null,null,e.ImageUtils.crossOriginPolicy);m.minFilter=e.LinearFilter;m.magFilter=e.LinearFilter;var l=new e.ImageUtils.loadTexture(i+"lensdirt.png",undefined,null,null,e.ImageUtils.crossOriginPolicy);l.minFilter=e.LinearFilter;l.magFilter=e.LinearFilter;this.mixPass.uniforms.tLensColor.value=m;this.mixPass.uniforms.tLensDirt.value=l;return this},initEffect:function(j,k){var i=k.getComposer("result");i.linkToShaderPassUniform(this.passThreshold,this.passThreshold.uniforms.tDiffuse2);k.insertComposer(this.composers[0],this.mixPass);this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tBlur);this.mixPass.addRequiredComposer(this.composers[0])},update:function(j,i,k){},setSize:function(k,i){var j=this._parent(k,i);if(!j){return}var l=0.5;this.composers[0].setSize(l*this.width,l*this.height);this.passBlurH.uniforms.invSize.value.set(1/(l*this.width),1/(l*this.height));this.passBlurV.uniforms.invSize.value.set(1/(l*this.width),1/(l*this.height));this.mixPass.uniforms.invSize.value.set(1/(l*this.width),1/(l*this.height))}});return c});define("Effects/FlareEffect",["DS/Effects/FlareEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/FlareEffect");return b});define("DS/Effects/VignettingEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/ShaderPass","DS/Shaders/VignettingShader"],function(d,b,c,a){var e=b.extend({init:function(g,f){this._parent(g);this.mixPass=new c(a,undefined,"VignettingEffect");return this},initEffect:function(f,g){g.insertComposer(null,this.mixPass)},update:function(g,f,h){},setSize:function(h,f){var g=this._parent(h,f);if(!g){return}}});return e});define("Effects/VignettingEffect",["DS/Effects/VignettingEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/VignettingEffect");return b});define("DS/Effects/PreHighlightEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/RenderPass","DS/Plugins/ShaderPass","DS/Shaders/AdvancedHighlightShader","DS/Shaders/AdvancedPreHighlightShader","DS/Plugins/ClearPass"],function(h,c,e,a,b,g,i,d){var f=c.extend({init:function(l,k){this._parent(l);var j=new h.WebGLRenderTargetProperties(this.width,this.height,"uint");this.composers.push(new e(l,j,k));this.composers[0].composerContext.keepResult=true;this.hlClearPass=null;this.hlRenderPass=null;this.mixPass=new b(i.FinalBlending,undefined,"PreHighlightEffect");this.mixPass.compileShader(l);return this},initEffect:function(j,k){if(j){this.mixPass.disabledByDefault=true;this.mixPass.needsSwap=false;this.mixPass.material.defines.POSTPRO=0;this.mixPass.material.transparent=true;this.mixPass.material.needsUpdate=true}k.insertComposer(this.composers[0],this.mixPass);this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tAdd);this.mixPass.addRequiredComposer(this.composers[0])},update:function(r,l,n,o,p){var q=this.composers[0].renderer;if(this.hlRenderPass===null){this.hlClearPass=new d("prehl");this.hlRenderPass=new a(l.selectionPreHL.sceneHL,n._renderedCamera,null);this.hlRenderPass.setMaterialToUse(h.MaterialToUse.preHighlightMaterial);this.hlRenderPass.cameraName="mainNoJittering";this.composers[0].composerContext.setPassClear(this.hlClearPass,true,new h.Color(16711680),1);this.composers[0].addPass(this.hlClearPass);this.composers[0].addPass(this.hlRenderPass)}this.hlRenderPass.renderFaces=(q.pickFacesMode===1)||((q.pickFacesMode===2)&&q.renderFaces)||((q.pickFacesMode===3)&&!q.renderFaces);var m=q.getRenderMode().clone();m.setRenderMode("Outline",false);var k=m.getRenderLineMode();var j=(q.pickLinesMode===1)||((q.pickLinesMode===2)&&(k||(k===null)))||((q.pickLinesMode===3)&&(k===0));this.hlRenderPass.renderLineMode=j?h.ShowAllRenderLineMode:0;this.hlRenderPass.renderPoints=(q.pickPointsMode===1)||q.renderPoints;this.hlRenderPass.renderPointMode=q.getPickingRenderPointMode();this.composers[0].composerContext.needsUpdate=true},setColor:function(k,j){if(k instanceof h.Vector4){this.mixPass.uniforms.iOutlineColor.value=k;if(!j){this.mixPass.uniforms.iOutlineColor2.value=k}}if(j instanceof h.Vector4){this.mixPass.uniforms.iOutlineColor2.value=j}},setSize:function(l,j){var k=this._parent(l,j);if(!k){return}this.composers[0].setSize(this.width,this.height);this.mixPass.uniforms.h.value=1/this.width;this.mixPass.uniforms.v.value=1/this.height}});return f});define("Effects/PreHighlightEffect",["DS/Effects/PreHighlightEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/PreHighlightEffect");return b});define("DS/Effects/SSLREffect",["DS/Visualization/ThreeJS_DS","WebappsUtils/WebappsUtils","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/SSLRShader","DS/Shaders/BloomShaders","DS/Shaders/SSLRBlendShader"],function(h,b,d,e,c,f,i,g){var a=d.extend({init:function(n,m){var o=this._parent(n);var l=new h.WebGLRenderTargetProperties(this.width,this.height,"uint");this.composers.push(new e(n,l,m));this.effectSSLR=new c(f);this.effectSSLRBlurH=new c(i.BlurH);this.effectSSLRBlurV=new c(i.BlurV);this.composers[0].addPass(this.effectSSLR);this.composers[0].addPass(this.effectSSLRBlurH);this.composers[0].addPass(this.effectSSLRBlurV);this.composers[0].enablePass(this.effectSSLRBlurH,false);this.composers[0].enablePass(this.effectSSLRBlurV,false);var j=b.getWebappsAssetUrl("Effects","");var k=new h.ImageUtils.loadTexture(j+"SSAORandom.png",undefined,null,null,h.ImageUtils.crossOriginPolicy);k.minFilter=h.LinearFilter;k.magFilter=h.LinearFilter;this.effectSSLR.uniforms.tRandomTex.value=k;this.mixPass=new c(g,undefined,"SSLREffect");var o=this;this.mixPass.beforeRenderCB=function(p){o.effectSSLR.uniforms.tDiffuse2.value=p};return this},initEffect:function(k,l){var j=l.getComposer("normalDepth");j.linkToShaderPassUniform(this.effectSSLR,this.effectSSLR.uniforms.tNormalDepth);l.insertComposer(this.composers[0],this.mixPass);this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse2);this.mixPass.addRequiredComposer(this.composers[0])},update:function(l,k,n){n._renderedCamera.projectionMatrixInverse.getInverse(n._renderedCamera.projectionMatrix);this.effectSSLR.uniforms.realProjectionMatrixInverse.value=n._renderedCamera.projectionMatrixInverse;this.effectSSLR.uniforms.realProjectionMatrix.value=n._renderedCamera.projectionMatrix;var p=k.getBoundingSphere(),m=0.2*p.radius,j=(new h.Vector3().subVectors(n.target,n._renderedCamera.position)).length(),o=0.2*j*Math.tan(0.5*n._renderedCamera.fov*(Math.PI/180));m=(m>o)?o:m;this.effectSSLR.uniforms.radius.value=m},setSize:function(l,j){var k=this._parent(l,j);if(!k){return}this.composers[0].setSize(this.width,this.height);this.effectSSLRBlurH.uniforms.invSize.value.set(1/this.width,1/this.height);this.effectSSLRBlurV.uniforms.invSize.value.set(1/this.width,1/this.height);this.effectSSLR.uniforms.size.value.set(this.width,this.height)}});return a});define("Effects/SSLREffect",["DS/Effects/SSLREffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/SSLREffect");return b});define("DS/Effects/HighlightEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/RenderPass","DS/Plugins/ShaderPass","DS/Shaders/AdvancedHighlightShader","DS/Plugins/ClearPass"],function(f,c,g,b,e,a,h){var d=c.extend({init:function(n,m,k){this._parent(n);this.scenes=[];this.sceneToAdd=[];this.isMultiHighlightMode=false;this.rendererType=k;var l=new f.WebGLRenderTargetProperties(this.width,this.height,"uint");this.effectComp=new g(n,l,m);this.effectComp.keepResult=true;this.composers.push(this.effectComp);var j=new f.WebGLRenderTargetProperties(this.width,this.height,"uintNearest");this.effectCompMultiHL=new g(n,j,m);this.effectCompMultiHL.keepResult=true;this.hlClearPass=null;this.hlClearPass2=null;this.hlRenderPass=null;this.hlRenderPass2=null;this.mixPass=new e(a.FinalBlending,undefined,"HighlightEffect");this.mixPass.enableWarmStart=true;this.mixPass.compileShader(n);var i=[];i[0]=-0.326212;i[1]=-0.405805;i[2]=-0.840144;i[3]=-0.07358;i[4]=-0.695914;i[5]=0.457137;i[6]=-0.203345;i[7]=0.620716;i[8]=0.96234;i[9]=-0.194983;i[10]=0.473434;i[11]=-0.480026;i[12]=0.519456;i[13]=0.767022;i[14]=0.185461;i[15]=-0.893124;i[16]=0.507431;i[17]=0.064425;i[18]=0.530992;i[19]=0.412458;i[20]=-0.32194;i[21]=-0.871945;i[22]=-0.791559;i[23]=0.597705;this.mixPass.uniforms.poisson.value=i;return this},initEffect:function(i,j){this.rendererType=i;if(this.rendererType){this.mixPass.disabledByDefault=true;this.mixPass.needsSwap=false;this.mixPass.material.defines.POSTPRO=0;this.mixPass.material.transparent=true;this.mixPass.material.needsUpdate=true}j.insertComposer(this.composers[0],this.mixPass);this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tAdd);this.mixPass.addRequiredComposer(this.composers[0])},update:function(y,n,r,u,v){var w=this.composers[0].renderer;if(this.hlRenderPass===null){this.hlClearPass=new h("hlClearPass");this.hlRenderPass=new b(n.selectionHL.sceneHL,null,null,undefined,undefined,undefined,"hlRenderPass");this.hlRenderPass.setDisableBackFaceCulling(true);this.hlRenderPass.setMaterialToUse(f.MaterialToUse.highlightMaterial);this.hlRenderPass.cameraName="mainNoJittering";this.composers[0].addPass(this.hlClearPass);this.composers[0].addPass(this.hlRenderPass);this.composers[0].composerContext.setPassClear(this.hlClearPass,true,new f.Color(0),0)}if(this.isMultiHighlightMode&&this.hlRenderPass2===null){this.hlClearPass2=new h("hlClearPass");this.hlRenderPass2=new b(n.selectionHL.sceneHL,null,null,undefined,undefined,undefined,"hlRenderPass");this.hlRenderPass2.setDisableBackFaceCulling(true);this.hlRenderPass2.setMaterialToUse(f.MaterialToUse.outlineHighlightMaterial);this.hlRenderPass2.cameraName="mainNoJittering";this.composers[1].addPass(this.hlClearPass2);this.composers[1].addPass(this.hlRenderPass2);this.composers[1].composerContext.setPassClear(this.hlClearPass2,true,new f.Color(0),0)}if(this.sceneToAdd.length){for(var s=0;s<this.sceneToAdd.length;s++){var t=this.sceneToAdd[s];var A=new b(t.sceneHL,null,null,undefined,undefined,undefined,"hlRenderPass");A.setDisableBackFaceCulling(true);A.setMaterialToUse(f.MaterialToUse.highlightMaterial);A.cameraName="mainNoJittering";this.composers[0].addPass(A);t.passes.push(A)}for(var s=0;s<this.sceneToAdd.length;s++){var t=this.sceneToAdd[s];var A=new b(t.sceneHL,null,null,undefined,undefined,undefined,"hlRenderPass");A.setDisableBackFaceCulling(true);A.setMaterialToUse(f.MaterialToUse.outlineHighlightMaterial);A.cameraName="mainNoJittering";this.composers[1].addPass(A);t.passes.push(A)}this.sceneToAdd=[]}var m=(w.pickFacesMode===1)||((w.pickFacesMode===2)&&w.renderFaces)||((w.pickFacesMode===3)&&!w.renderFaces);var p=w.getRenderMode().clone();p.setRenderMode("Outline",false);var l=p.getRenderLineMode();var k=(w.pickLinesMode===1)||((w.pickLinesMode===2)&&(l||(l===null)))||((w.pickLinesMode===3)&&(l===0));var o=w.getPickingRenderPointMode();var x=(w.pickPointsMode===1)||w.renderPoints;this.hlRenderPass.renderFaces=m;this.hlRenderPass.renderLineMode=k?f.ShowAllRenderLineMode:0;this.hlRenderPass.renderPoints=x;this.hlRenderPass.renderPointMode=o;if(this.isMultiHighlightMode){this.hlRenderPass2.renderFaces=m;this.hlRenderPass2.renderLineMode=k?f.ShowAllRenderLineMode:0;this.hlRenderPass2.renderPoints=x;this.hlRenderPass2.renderPointMode=o;for(var s=0;s<this.scenes.length;s++){for(var q=0;q<this.scenes[s].passes.length;q++){var z=this.scenes[s].passes[q];z.renderFaces=m;z.renderLineMode=k?f.ShowAllRenderLineMode:0;z.renderPoints=x;z.renderPointMode=o}}}this.composers[0].composerContext.needsUpdate=(u===0)||v;if(this.composers[1]){this.composers[1].composerContext.needsUpdate=(u===0)||v}},switchHiglightMode:function(l){var j;if(l){j=a.FinalBlendingMultiHL}else{j=a.FinalBlending}this.mixPass.uniforms=f.UniformsUtils.clone(j.uniforms);if(j.defines){this.mixPass.defines=j.defines}this.mixPass.material=new f.ShaderMaterial({uniforms:this.mixPass.uniforms,vertexShader:j.vertexShader,fragmentShader:j.fragmentShader,defines:this.mixPass.defines,force:true});var k=this.composers[0].renderer;this.mixPass.compileShader(k);if(this.rendererType){this.mixPass.disabledByDefault=true;this.mixPass.needsSwap=false;this.mixPass.material.defines.POSTPRO=0;this.mixPass.material.transparent=true;this.mixPass.material.needsUpdate=true}if(l){this.composers[0].removeLinks();this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tAdd);this.composers.push(this.effectCompMultiHL);this.mixPass.addRequiredComposer(this.composers[1]);this.composers[1].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tAdd2);this.composers[1].setSize(this.composers[0].composerContext.width,this.composers[0].composerContext.height)}else{this.composers[0].removeLinks();this.composers[1].removeLinks();this.composers.splice(1,1);this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tAdd);var i=[];i[0]=-0.326212;i[1]=-0.405805;i[2]=-0.840144;i[3]=-0.07358;i[4]=-0.695914;i[5]=0.457137;i[6]=-0.203345;i[7]=0.620716;i[8]=0.96234;i[9]=-0.194983;i[10]=0.473434;i[11]=-0.480026;i[12]=0.519456;i[13]=0.767022;i[14]=0.185461;i[15]=-0.893124;i[16]=0.507431;i[17]=0.064425;i[18]=0.530992;i[19]=0.412458;i[20]=-0.32194;i[21]=-0.871945;i[22]=-0.791559;i[23]=0.597705;this.mixPass.uniforms.poisson.value=i;this.mixPass.linkedComposerContexts.pop();this.mixPass.requiredComposers.pop();this.composers[0].updateComposerContexts()}},addScene:function(i){if(this.isMultiHighlightMode==false){this.switchHiglightMode(true)}this.isMultiHighlightMode=true;this.scenes.push(i);this.sceneToAdd.push(i)},removePasses:function(m){var j=this.composers[0];var l=j.passLists[0].passes;for(var k=0;k<l.length;k++){if(l[k]===m.passes[0]){l.splice(k,1)}}j.updateComposerContexts();var j=this.composers[1];var l=j.passLists[0].passes;for(var k=0;k<l.length;k++){if(l[k]===m.passes[1]){l.splice(k,1)}}j.updateComposerContexts()},removeScene:function(l){var j=[];for(var k=0;k<this.scenes.length;k++){if(this.scenes[k]===l){this.removePasses(l);this.scenes[k].clearAll();continue}j.push(this.scenes[k])}this.scenes=j},setSize:function(k,i){var j=this._parent(k,i);if(!j){return}this.composers[0].setSize(this.width,this.height);if(this.composers[1]){this.composers[1].setSize(this.width,this.height)}this.mixPass.uniforms.h.value=1/this.width;this.mixPass.uniforms.v.value=1/this.height},setEnabled:function(i){this.composers[0].composerContext.enablePass(this.hlRenderPass,i);if(i){this._parent(i)}}});return d});define("Effects/HighlightEffect",["DS/Effects/HighlightEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/HighlightEffect");return b});define("DS/Effects/FXAAEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/ShaderPass","DS/Shaders/FXAAShader"],function(d,a,c,e){var b=a.extend({init:function(f){this._parent(f);this.mixPass=new c(e,undefined,"FXAAEffect");return this},initEffect:function(f,g){g.insertComposer(null,this.mixPass)},update:function(g,f,h){},setSize:function(h,f){var g=this._parent(h,f);if(!g){return}this.mixPass.uniforms.resolution.value.set(1/h,1/f)}});return b});define("Effects/FXAAEffect",["DS/Effects/FXAAEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/FXAAEffect");return b});define("DS/Effects/DebugShadowMapsEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/RenderPass","DS/Plugins/ShaderPass","DS/Shaders/ReplaceBlendShader","DS/Shaders/DisplayShadowMapsShader"],function(g,c,h,b,f,a,d){var e=c.extend({init:function(k,j){this._parent(k);var i=new g.WebGLRenderTargetProperties(this.width,this.height,"uint");this.composers.push(new h(k,i,j));this.debugPass=null;this.mixPass=new f(a,undefined,"DebugShadowMapsEffect");this.nbLights=0;return this},initEffect:function(i,j){if(this.debugPass===null){this.debugPass=new f(d);this.composers[0].addPass(this.debugPass)}j.insertComposer(this.composers[0],this.mixPass);this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse2);this.mixPass.addRequiredComposer(this.composers[0])},update:function(p,j,k){var n=j.scene;var q=n.__lights.length;if(q===this.nbLights){return}var r=2;for(var m=0;m<q;m++){var l=n.__lights[m];if(l.shadowMap){var o="tDiffuse"+r;if(this.debugPass.uniforms[o]!==undefined){this.debugPass.uniforms[o].value=l.shadowMap}r++}}},setSize:function(k,i){var j=this._parent(k,i);if(!j){return}this.composers[0].setSize(this.width,this.height)}});return e});define("Effects/DebugShadowMapsEffect",["DS/Effects/DebugShadowMapsEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/DebugShadowMapsEffect");return b});define("DS/Effects/DebugPassEffect",["DS/Visualization/ThreeJS_DS","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/RenderPass","DS/Plugins/ShaderPass","DS/Shaders/ReplaceBlendShader","DS/Shaders/DisplayPassShader"],function(f,d,h,c,e,a,g){var b=d.extend({init:function(k,j){this._parent(k);var i=new f.WebGLRenderTargetProperties(this.width,this.height,"uint");this.composers.push(new h(k,i,j));this.debugPass=null;this.mixPass=new e(a,undefined,"DebugPassEffect");return this},initEffect:function(i,k){if(this.debugPass===null){this.debugPass=new e(g);this.composers[0].addPass(this.debugPass);if(k.HighlightEffect!==null){k.HighlightEffect.composers[0].linkToShaderPassUniform(this.debugPass,this.debugPass.uniforms.tDiffuse2)}else{if(k.composers[0]){k.composers[0].linkToShaderPassUniform(this.debugPass,this.debugPass.uniforms.tDiffuse2)}}if(k.pickingGPUComposerContext){k.pickingGPUComposerContext.linkToShaderPassUniform(this.debugPass,this.debugPass.uniforms.tDiffuse3)}var j=k.getComposer("normalDepth");j.linkToShaderPassUniform(this.debugPass,this.debugPass.uniforms.tDiffuse4)}k.insertComposer(this.composers[0],this.mixPass);this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse2);this.mixPass.addRequiredComposer(this.composers[0])},update:function(j,i,k){},setSize:function(k,i){var j=this._parent(k,i);if(!j){return}this.composers[0].setSize(this.width,this.height)}});return b});define("Effects/DebugPassEffect",["DS/Effects/DebugPassEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/DebugPassEffect");return b});define("DS/Effects/MLAAEffect",["DS/Visualization/ThreeJS_DS","WebappsUtils/WebappsUtils","DS/Effects/BasicEffect","DS/Plugins/EffectComposer","DS/Plugins/ShaderPass","DS/Shaders/MLAAShaders"],function(c,d,a,f,b,g){var e=a.extend({init:function(l,k){this._parent(l);var i=new c.WebGLRenderTargetProperties(this.width,this.height,"uint");this.composers.push(new f(l,i,k));this.pass1=new b(g.EdgeDetection);this.pass2=new b(g.BlendingWeights);this.mixPass=new b(g.FinalBlending,undefined,"MLAAEffect");this.composers[0].addPass(this.pass1);this.composers[0].addPass(this.pass2);var h=d.getWebappsAssetUrl("Effects","");var j=new c.ImageUtils.loadTexture(h+"AreaTexMLAA.png",undefined,null,null,c.ImageUtils.crossOriginPolicy);j.minFilter=c.LinearFilter;j.magFilter=c.LinearFilter;this.pass2.uniforms.areaTex.value=j;return this},initEffect:function(h,i){i.insertComposer(this.composers[0],this.mixPass);this.composers[0].linkToShaderPassUniform(this.mixPass,this.mixPass.uniforms.tDiffuse2);this.mixPass.addRequiredComposer(this.composers[0])},update:function(i,h,j){},setSize:function(j,h){var i=this._parent(j,h);if(!i){return}this.composers[0].setSize(this.width,this.height);this.pass1.uniforms.screenWidth.value=this.width;this.pass1.uniforms.screenHeight.value=this.height;this.pass2.uniforms.screenWidth.value=this.width;this.pass2.uniforms.screenHeight.value=this.height;this.mixPass.uniforms.screenWidth.value=this.width;this.mixPass.uniforms.screenHeight.value=this.height}});return e});define("Effects/MLAAEffect",["DS/Effects/MLAAEffect","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Effects/MLAAEffect");return b});