define("DS/VCXWebFilterBar/VCXFilterBar",["UWA/Controls/Abstract","DS/Core/PointerEvents","DS/CoreEvents/Events","DS/WebappsUtils/WebappsUtils",],function(e,b,a,d){var c=e.extend({defaultOptions:{body:null,actionBar:null,frmWindow:null,heightElem:"32",widthElem:"32",title:"",updateVisibilty:true,typeSeparator:"line",lJsonSubElement:[],lJsonElement:[],classpanel:"",Idpanel:"",heightOffset:0,radius:500,gapAngle:0.018},init:function(f){this._tokenVISUEvent=null;this._startPos=true;this._listbutton=[];this._listSubbutton=[];this._listCallbackButton={};this._listCallbackSubButton={};this._panel=null;this._panelLeft=null;this._panelBody=null;this._panelRight=null;this._parent(f);this.loadCssFile("VCXWebFilterBar/VCXFilterBar.css",1);if(this._testIdJson()){this._createFilter()}else{alert("pb ID not unique")}},loadCssFile:function(g,f){var j=document.getElementsByTagName("head")[0];var k=j.getElementsByTagName("link");var l=null;for(var h=0;h<k.length;h++){l=k[h];if(l.href.search(g)>-1){l.disabled=false;return}}l=document.createElement("link");l.type="text/css";l.rel="stylesheet";if(f===undefined){l.href=g}else{l.href=d.getWebappsBaseUrl()+g}j.appendChild(l)},_inputDiv:function(g,f){var h;if(arguments.length===2){h=UWA.createElement("div",{html:"",id:g,"class":g}).inject(f);h.style.display="block"}else{if(arguments.length===1){h=UWA.createElement("div",{html:"",id:g,"class":g})}else{h=UWA.createElement("div")}}return h},_findDuplicates:function(g){var f=g.length,h=[],k={};for(var j=0;j<f;j++){var l=g[j];k[l]=k[l]>=1?k[l]+1:1}for(var l in k){if(k[l]>1){h.push(l)}}return h},_testIdJson:function(){var h=[];for(var g=0;g<this.options.lJsonElement.length;g++){if(this.options.lJsonElement[g].type!=="separator"){h.push(this.options.lJsonElement[g].id)}}var f=this._findDuplicates(h);if(!f||f.length===0){return true}else{return false}},_buildButtonIcon:function(g){var f=new UWA.Controls.Img({url:g,width:"25px",height:"25px"});f.elements.container.setStyles({position:"absolute",display:"block",padding:"4px"});return f},_getCallbackGroupInactif:function(h,g){var f=function(){};var i=this;if(g.bexclude){f=function(){for(var j=0;j<i._listbutton.length;j++){if(h!==i._listbutton[j]){i._removeInactif(i._listbutton[j]);if((i._listbutton[j].parentNode)&&(i._listbutton[j].parentNode.id==="dmu-filter-Body")){i._listbutton[j].style.opacity=1}}}}}else{f=function(){}}return f},_getCallbackGroupActif:function(h,g){var f=function(){};var j=this;var i=new RegExp("dmu-ui-state-inactive");if(g.bexclude){f=function(){for(var k=0;k<j._listbutton.length;k++){if(h!==j._listbutton[k]){if(!i.test(j._listbutton[k].className)){j._setInactif(j._listbutton[k]);if((j._listbutton[k].parentNode)&&(j._listbutton[k].parentNode.id==="dmu-filter-Body")){j._listbutton[k].style.opacity=0.5}}}}}}return f},_setExcludeType:function(f){f.addClassName("dmu-ui-type-exclude")},_setActif:function(f){f.addClassName("dmu-ui-state-active")},_setInactif:function(f){f.addClassName("dmu-ui-state-inactive")},_removeActif:function(f){f.removeClassName("dmu-ui-state-active")},_removeInactif:function(f){f.removeClassName("dmu-ui-state-inactive")},_getState:function(g){var h;var f=new RegExp("dmu-ui-state-active");var i=new RegExp("dmu-ui-state-inactive");if(f.test(g)){h="actif"}else{if(i.test(g)){h="inactif"}else{h="none"}}return h},_buildButtonSquare:function(n,f,h,k,g){var j=UWA.createElement("div",{"class":"dmu-filter-Button",id:n.id,title:n.nls,styles:{position:"absolute",background:"rgba(255,255,255,1)",opacity:"1",top:k,left:g,borderRadius:"2px",zIndex:"100",height:"20px",width:"20px",display:"inline-block",cursor:"pointer"}}).inject(f);var m=this._buildButtonIcon(n.url).inject(j);m.elements.container.style.padding="2px";this._listCallbackSubButton[n.id]=n.callback;this._listSubbutton.push(j);if(n.bstateActif){this._setActif(j)}var l=this;var i=new RegExp("dmu-ui-state-active");j.addEvent(b.POINTERUP,function(p){if(!i.test(this.className)){l._setActif(this);if(n.callback){n.callback.call(h,p)}for(var o=0;o<l._listSubbutton.length;o++){if(this!==l._listSubbutton[o]){l._removeActif(l._listSubbutton[o]);if(l._listCallbackSubButton[l._listSubbutton[o].id]){l._listCallbackSubButton[l._listSubbutton[o].id].call(h,p)}}}}else{}});return j},_buildButton:function(r,f,h,k,g){var j=UWA.createElement("div",{"class":"dmu-filter-Button",id:r.id,title:r.nls,styles:{position:"absolute",background:"rgba(255,255,255,1)",opacity:"1",top:k,left:g,borderRadius:"50%",zIndex:"100",height:this.options.heightElem+"px",width:this.options.widthElem+"px",display:"inline-block",cursor:"pointer"}}).inject(f);var q=UWA.createElement("div",{"class":"dmu-shadow-Button",styles:{opacity:"1",position:"absolute",width:"36px",height:"37px",transform:"translate3d(-5%, 57%, 0px) rotateX(116deg)",zIndex:"100"}}).inject(j);q.addEvent(b.POINTERUP,function(s){s.stopPropagation()});this._buildButtonIcon(r.url).inject(j);this._listCallbackButton[r.id]=r.callback;this._listbutton.push(j);var i=new RegExp("dmu-ui-state-active");var o=new RegExp("dmu-ui-state-inactive");var n=new RegExp("dmu-ui-type-exclude");var p=this._getCallbackGroupActif(j,r);var l=this._getCallbackGroupInactif(j,r);if(r.bexclude){this._setExcludeType(j)}if(r.bstateActif){this._setActif(j)}var m=this;j.addEvent(b.POINTERUP,function(t){if(o.test(this.className)&&!i.test(this.className)&&r.bexclude){m._removeInactif(this);m._setActif(this);for(var s=0;s<m._listbutton.length;s++){if(j!==m._listbutton[s]&&n.test(m._listbutton[s].className)){m._removeActif(m._listbutton[s]);if(m._listCallbackButton[m._listbutton[s].id]){m._listCallbackButton[m._listbutton[s].id].call(h,t)}m._setInactif(m._listbutton[s])}}if(r.callback){r.callback.call(h,t)}if(p){p.call(h,t)}}else{if((o.test(this.className)&&!i.test(this.className)&&!r.bexclude)||(o.test(this.className)&&i.test(this.className)&&!r.bexclude)){m._removeInactif(this);if(!i.test(this.className)){m._setActif(this);if(r.callback){r.callback.call(h,t)}}for(var s=0;s<m._listbutton.length;s++){m._listbutton[s].style.opacity=1;if(j!==m._listbutton[s]){if(i.test(m._listbutton[s].className)){m._removeActif(m._listbutton[s]);if(m._listCallbackButton[m._listbutton[s].id]){m._listCallbackButton[m._listbutton[s].id].call(h,t)}}if(o.test(m._listbutton[s].className)){m._removeInactif(m._listbutton[s])}}}if(p){p.call(h,t)}m._panelBody.style.opacity=1}else{if(!i.test(this.className)){m._setActif(this);if(r.callback){r.callback.call(h,t)}if(p){p.call(h,t)}}else{m._removeActif(this);if(r.callback){r.callback.call(h,t)}if(l){l.call(h,t)}}}}});return j},_inputpanel:function(){this._listSeparator=[];var i=0;for(var f=0;f<this.options.lJsonElement.length;f++){if(this.options.lJsonElement[f].type==="separator"){i++}}this._nbcontainer=i+1;this._panel=UWA.createElement("div",{id:"dmu-filter-panel "+this.options.Idpanel,"class":"dmu-filter-panel "+this.options.classpanel,styles:{position:"relative",width:"auto",zIndex:"30000000000",transition:"opacity 0.3s ease-in-out"}});this._panel.addEvent("dragstart",function(j){j.preventDefault()});if(this._nbcontainer===1){this._panelBody=this._inputDiv("dmu-filter-Body",this._panel);this._panelBody.setStyles({display:"inline-block",width:"auto"});this._panelBody.setHTML("")}else{if(this._nbcontainer===2){if(this.options.lJsonElement[0].bexclude){this._panelLeft=this._inputDiv("dmu-filter-Left",this._panel);this._panelBody=this._inputDiv("dmu-filter-Body",this._panel);this._panelBody.setHTML("");var h=this._createSeparator(this._panelBody);this._listSeparator.push(h);this._panelLeft.setStyles({display:"inline-block",width:"auto"});this._panelLeft.setHTML("")}else{this._panelBody=this._inputDiv("dmu-filter-Body",this._panel);this._panelBody.setHTML("");this._panelRight=this._inputDiv("dmu-filter-Right",this._panel);this._panelRight.setHTML("");var h=this._createSeparator(this._panelRight);this._listSeparator.push(h);this._panelRight.setStyles({display:"inline-block",width:"auto"})}this._panelBody.setStyles({display:"inline-block",width:"auto"})}else{if(this._nbcontainer===3){this._panelLeft=this._inputDiv("dmu-filter-Left",this._panel);this._panelLeft.setHTML("");this._panelBody=this._inputDiv("dmu-filter-Body",this._panel);this._panelBody.setHTML("");var h=this._createSeparator(this._panelBody);this._listSeparator.push(h);this._panelRight=this._inputDiv("dmu-filter-Right",this._panel);this._panelRight.setHTML("");var g=this._createSeparator(this._panelRight);this._listSeparator.push(g);this._panelLeft.setStyles({display:"inline-block",width:"auto"});this._panelBody.setStyles({display:"inline-block",width:"auto"});this._panelRight.setStyles({display:"inline-block",width:"auto"})}else{alert("it's not a valid filter json")}}}return this._panel},_createElement:function(h,f,j,i){var g=this._buildButton(h,f,this,j,i);return g},_createSubElement:function(h,f,j,i){var g=this._buildButtonSquare(h,f,this,j,i);return g},_createSeparator:function(f){var g;if(this.options.typeSeparator==="bubble"){g=UWA.createElement("div",{"class":"dmu-filter-Separator",styles:{position:"absolute",display:"inline-block",height:"5px",width:"5px",border:"1px solid rgb(100,100,100)",opacity:"0.6",borderRadius:"50%",background:"grey",}}).inject(f)}else{g=UWA.createElement("div",{"class":"dmu-filter-Separator",styles:{opacity:"1",position:"absolute",width:"26px",height:"39px",marginLeft:"-9px",transform:"translate3d(0%, 0%, 0px) rotate(15deg) rotateY(85deg)",zIndex:"100",background:"-webkit-radial-gradient(50% 50%, circle, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.2) 30%, rgba(0, 0, 0, 0) 70%)"}}).inject(f)}return g},_getkindContainer:function(){var f;if(this._nbcontainer===1){f=this._panelBody}else{if(this._nbcontainer===2){if(this.options.lJsonElement[0].bexclude){f=this._panelLeft}else{f=this._panelBody}}else{if(this._nbcontainer===3){f=this._panelLeft}else{alert("it's not a valid filter json")}}}return f},_centerBottomPosition:function(){this._panel.style.width=((36+8)*this._listbutton.length)+"px";var f=parseInt(this.options.frmWindow.getContent().offsetHeight);this._leftPanel=(this.options.body.getStyle("width").replace(/px/g,""))/2-(this._panel.style.width.replace(/px/g,"")/2);if(this.options.actionBar&&this.options.actionBar.elements&&this.options.actionBar.elements.container&&this.options.actionBar.elements.container.getStyle("height")&&parseInt(this.options.actionBar.elements.container.getStyle("height").replace(/px/g,""))>0){if(this.options.lJsonSubElement.length!==0){this._topPanel=f-parseInt(this.options.actionBar.elements.container.getStyle("height").replace(/px/g,""))*2-10}else{this._topPanel=f-parseInt(this.options.actionBar.elements.container.getStyle("height").replace(/px/g,""))*2}this._bottomPanel=parseInt(this.options.actionBar.elements.container.getStyle("height").replace(/px/g,""))*2}else{if(this.options.lJsonSubElement!==0){this._topPanel=f-155;this._bottomPanel=155}else{this._topPanel=f-145;this._bottomPanel=145}}this._topPanel-=this.options.heightOffset},_checkPosition:function(){if(this._startPos===true&&this.options.body!==null){this._centerBottomPosition();this._panel.style.top=this._topPanel+"px";this._panel.style.left=this._leftPanel+"px"}},_updateVisibility:function(j,m){var l=m*2;var i=m*2.5;var h=m*3;var g=m*3.5;var f=m*4;var k=this;this._callbackLeave=function(o){var p=0;if(!o){var o=window.event}if(o.pageY){p=o.pageY}else{if(o.clientX){p=o.clientY+document.body.scrollTop+document.documentElement.scrollTop}}var n=0;if(j>p){n=j-p}else{n=p-j}if(n<l){k._panel.style.opacity="1"}else{if(n>l&&n<i){k._panel.style.opacity="0.9"}else{if(n>=i&&n<h){k._panel.style.opacity="0.8"}else{if(n>=h&&n<g){k._panel.style.opacity="0.5"}else{if(n>=g&&n<f){k._panel.style.opacity="0.3"}else{if(n>=f){k._panel.style.opacity="0.1"}}}}}}};if(this.options.body.parentNode&&this.options.body.parentNode.parentNode){this.options.body.parentNode.parentNode.addEvent(b.POINTERMOVE,this._callbackLeave)}},_calcRadius:function(f){var g=parseInt(this.options.widthElem)/2;if(f.type==="separator"){if(this.options.typeSeparator==="bubble"){g=1.5}}return g},_calcElementDemiAngle:function(g){var i=this._calcRadius(g);var h=this.options.radius;var f=Math.asin(i/h);return f},_computeStartAngle:function(){var k=0;var j=this.options.radius;for(var h=0;h<this.options.lJsonElement.length;h++){var f=this._calcElementDemiAngle(this.options.lJsonElement[h]);k+=2*f;if(h!=this.options.lJsonElement.length-1){k+=this.options.gapAngle}}var g=Math.PI*1.5-k/2;return g},_createFilter:function(){this._panel=this._inputpanel();var H=this._getkindContainer();var C=this.options.lJsonElement.length;this._heightPanel=0;var v;var j;if(C<=3){var l=5000;this.options.gapAngle/=l/this.options.radius;this.options.radius=l}var F=0;var D=0;var E=this._computeStartAngle();var k=this.options.radius;var p=0;var G=0;var f=6;var z=0;for(var s=0;s<this.options.lJsonElement.length;s++){var h=this.options.lJsonElement[s];var w=this._calcElementDemiAngle(h);E+=w;var q=Math.cos(E)*k;var o=Math.sin(E)*k;E+=w+this.options.gapAngle;if(s===0){F=q;D=-o}var n=q-F;var m=-o-D;var t=this._calcRadius(h);v=m-t;j=n-t;v-=parseInt(this.options.heightElem)/2;j+=parseInt(this.options.widthElem)/2;v+="px";j+="px";if(this.options.lJsonElement[s].type==="separator"){if(H===this._panelLeft){H=this._panelBody}else{if(H===this._panelBody){H=this._panelRight}else{alert("it's not a valid filter json")}}if(this.options.typeSeparator==="bubble"){this._listSeparator[p].style.top=v;this._listSeparator[p].style.width=2*t+"px";this._listSeparator[p].style.height=2*t+"px"}else{this._listSeparator[p].style.top=v}this._listSeparator[p].style.left=j;if((p>=1&&this.options.typeSeparator!=="bubble")||(H===this._panelRight&&this.options.typeSeparator!=="bubble")){this._listSeparator[p].style.transform="translate3d(0%, 0%, 0px) rotate(-15deg) rotateY(85deg)"}p++;G=-(parseInt(this.options.widthElem)+4)*(p)}else{if(s===0){this._heightPanel=parseInt(v.replace(/px/g,"").replace(/-/g,""))+36}this._createElement(this.options.lJsonElement[s],H,v,j)}}if(this._panelRight&&this.options.lJsonSubElement&&this.options.lJsonSubElement.length!==0){for(var s=0;s<this.options.lJsonSubElement.length;s++){var B=parseInt(j.replace(/px/g,""))+10+(27*s)+"px";var g=parseInt(v.replace(/px/g,""))+46+"px";this._createSubElement(this.options.lJsonSubElement[s],this._panelRight,g,B)}}if(this.options.body!==null){this._centerBottomPosition();this._panel.style.top=this._topPanel+"px";this._panel.style.left=this._leftPanel+"px";this._panel.inject(this.options.body);if(this.options.updateVisibilty){this.updateVisibility()}var A=this;this._tokenVISUEvent=a.subscribe({event:"/VISU/onWindowResized"},function(i){if(i.eventType==="@onWindowResized"){A.stopUpdateVisibility();A._checkPosition(this);if(A.options.updateVisibilty){A.updateVisibility()}}})}},updateVisibility:function(){this._updateVisibility(this._topPanel,this._heightPanel)},stopUpdateVisibility:function(){if(this._callbackLeave){if(this.options.body.parentNode&&this.options.body.parentNode.parentNode){this.options.body.parentNode.parentNode.removeEvent(b.POINTERMOVE,this._callbackLeave)}}},getActifState:function(k){var h=new RegExp("dmu-ui-state-active");var j=true;var g=false;for(var f=0;j&&f<this._listbutton.length;f++){if(this._listbutton[f].id===k&&h.test(this._listbutton[f].className)){j=false;g=true}}return g},resetPosition:function(){this._startPos=true;this._panel.style.top=this._topPanel+"px";this._panel.style.left=this._leftPanel+"px"},updatePosition:function(f){this._startPos=false;this._panel.style.top=f.top+"px";this._panel.style.left=f.left+"px"},show:function(){this._panel.style.display="block"},noShow:function(){if(this._panel){this._panel.style.display="none"}},clear:function(){this._listbutton=[];this._listSubbutton=[];this._listCallbackButton={};this._listCallbackSubButton={};if(this._panel){this._panel.destroy();this._panel=null}if(this._panelLeft){this._panelLeft.destroy();this._panelLeft=null}if(this._panelBody){this._panelBody.destroy();this._panelBody=null}if(this._panelRight){this._panelRight.destroy();this._panelRight=null}this.stopUpdateVisibility();if(this._tokenVISUEvent){a.unsubscribe(this._tokenVISUEvent);this._tokenVISUEvent=null}}});return c});