/*!  Copyright 2019 Dassault Systemes. All rights reserved. */
(function(){function d(g){if(g.pimCtrl){g.pimCtrl.clearIsr()}if(window.widget){window.widget.setValue("ItfSimuInSession",{})}return Object.getPrototypeOf(g.exp).clearView.apply(g.exp,g.args)}function c(h){if(h.args&&h.args.disposeFrameWindow===true){d(h);if(h.pimCtrl){h.pimCtrl.dereference()}}else{if(h.pimCtrl){h.pimCtrl.deactivate()}}if(window.widget){window.widget.setMetas({helpPath:undefined})}var k;if(h.args&&h.args.disposeFrameWindow!==true){var g=h.exp.pad3DViewer.getCommandContext();k=Object.getPrototypeOf(h.exp).dispose.apply(h.exp,h.args);var j=require("DS/ApplicationFrame/CommandsManager"),i=j.getCommandCheckHeaders(g);if(i){Object.keys(i).forEach(function(l){delete i[l]})}}else{k=Object.getPrototypeOf(h.exp).dispose.apply(h.exp,h.args)}return k}function b(g){return Object.getPrototypeOf(g.exp).refresh.apply(g.exp,g.args)}function a(i){var g=i.exp.pad3DViewer;if(g){var h=require("DS/PADUtils/PADSettingsMgt");h.setSetting("appModelerType","VPM");h.setSetting("settypes",true);g.getController()._model._modelLoader.setCGRWithSG(true);if(window.widget){window.widget.setMetas({helpPath:"PIMweb3DPlayExperience/assets/help"});window.widget.dispatchEvent("onPlayExperienceReady",[{pad3DViewer:g}])}}return Object.getPrototypeOf(i.exp).onPostCreate.apply(i.exp,i.args)}function e(j,k,i,g){if(!j||!k||!i){return}var m,h;function l(n){j.unsubscribe(m);m=undefined;j.unsubscribe(h);h=undefined;if(window.widget){if(!window.widget.hasPreference("ItfSimuInSession")){window.widget.addPreference({name:"ItfSimuInSession",type:"hidden"})}window.widget.setValue("ItfSimuInSession",JSON.stringify(n.isrLog));k.pad3DViewer.getContentName({callbacks:{onComplete:function(o){window.widget.setTitle(o.contentName)},onFailure:function(){}}})}setTimeout(function(){k.publish("ASSET/LOADINGFINISHED",{loadAssetInfo:g.asset})},10)}m=j.subscribe("onIsrAdded",l);h=j.subscribe("onItfAdded",l);j.load(i)}function f(h){var g=h.exp,j;g.clearView=function(){return d({exp:g,pimCtrl:j,args:arguments})};g.dispose=function(){var k=c({exp:g,pimCtrl:j,args:arguments});j=null;return k};g.refresh=function(){return b({exp:g,pimCtrl:j,args:arguments})};g.onPostCreate=function(){if(!j){require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(k){j=k.getItfCtrl({pad3DViewer:g.pad3DViewer});j.activate({readOnly:true})})}return a({exp:g,pimCtrl:j,args:arguments})};g.loadAsset=function(k){if(!k||!k.asset||!k.asset.physicalid){window.console.log("No data provided!!")}if(!j){g.pad3DViewer.setDefaultContextualMenuVisibility(true);g.pad3DViewer.setDefaultContextualBarVisibility(true);require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(l){j=l.getItfCtrl({pad3DViewer:g.pad3DViewer});g.loadAsset(k)})}else{j.activate({readOnly:true});if(h.isr){e(j,g,{isrID:k.asset.physicalid},k)}else{e(j,g,{metricID:k.asset.physicalid},k)}}};var i=require("DS/ApplicationFrame/CommandsManager");if(i._cmdCheckHeader){i._cmdCheckHeader={}}h.options.commandApplication=false;h.options.workbenchs=[{module:"PIMweb3DPlayExperience",name:"PIMweb3DPlayExperience"}]}define("DS/PIMweb3DPlayExperience/PIMwebIsr3DPlayExperience",["DS/3DPlayExperienceModule/PlayExperience3D"],function(g){return g.extend({init:function(h){f({exp:this,options:h,isr:true});this._parent(h)}})});define("DS/PIMweb3DPlayExperience/PIMwebItf3DPlayExperience",["DS/3DPlayExperienceModule/PlayExperience3D"],function(g){return g.extend({init:function(h){f({exp:this,options:h,isr:false});this._parent(h)}})})}());