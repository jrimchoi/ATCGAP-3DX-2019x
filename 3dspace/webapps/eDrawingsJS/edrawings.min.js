var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
;
console.assert(!console.debugLog);
console.debugLog = function (iCategory, iMsg) {
    var iParams = [];
    for (var _i = 2; _i < arguments.length; _i++) {
        iParams[_i - 2] = arguments[_i];
    }
    if (!console.debugLogCategories) {
        console.debugLogCategories = ["*"];
    }
    if (!console.excludeDebugLogCategories) {
        console.excludeDebugLogCategories = [];
    }
    if (console.excludeDebugLogCategories.indexOf(iCategory) > -1) {
        return;
    }
    var augmentedMsg = iMsg;
    var stack = (new Error).stack;
    if (stack) {
        var stackLine = stack.split("\n")[2];
        if (!stackLine)
            return;
        var callerLine = stackLine.slice(stackLine.lastIndexOf('('), stackLine.lastIndexOf(')') + 1);
        if (!callerLine) {
            callerLine = stackLine.slice(stackLine.lastIndexOf('@') + 1);
            callerLine = "(" + callerLine + ")";
        }
        augmentedMsg = callerLine + " " + iMsg;
    }
    if (console.debugLogCategories.indexOf(iCategory) > -1 ||
        console.debugLogCategories.indexOf("*") > -1) {
        if (iParams && iParams.length)
            console.log(augmentedMsg, iParams);
        else
            console.log(augmentedMsg);
    }
};
define("eDrawingsWebViewerUtils", ["require", "exports", "jquery", "eDwView", "eDwEventMgr", "eDwServiceMgr", "eDwResultError", "eDwAJAXError", "eDwTypes", "eDwUIUtils", "eDrawingsBase"], function (require, exports, $, eDwView, eDwEventMgr, eDwServiceMgr, eDwResultError, eDwAJAXError, eDwTypes_1, eDwUIUtils) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    function getViewerVersion() {
        return "<EDRAWINGS_VERSION_STRING>";
    }
    exports.getViewerVersion = getViewerVersion;
    function startViewer(iServerURL, iCanvasID, iViewerOpts, iInit, iOnError) {
        var _this = this;
        l_ModelLoadEvents = function (iState) {
            var viewerCanvasID = "#" + iCanvasID;
            if (iState === "init") {
                $(viewerCanvasID).on("edw:ModelLoaded", function (iEvent, iViewer) {
                    iViewer.getHCView().setPointSize(0, eDwTypes_1.HC.PointSizeUnit.ScreenPixels);
                    (function () { return __awaiter(_this, void 0, void 0, function () {
                        var iExcp_1;
                        return __generator(this, function (_a) {
                            switch (_a.label) {
                                case 0:
                                    _a.trys.push([0, 2, , 3]);
                                    return [4, l_processProductStructure(iViewer, iServerURL)];
                                case 1:
                                    _a.sent();
                                    return [3, 3];
                                case 2:
                                    iExcp_1 = _a.sent();
                                    l_displayError(iExcp_1, iOnError);
                                    return [3, 3];
                                case 3: return [2];
                            }
                        });
                    }); })();
                });
            }
            else {
                $(viewerCanvasID).off("edw:ModelLoaded");
            }
        };
        var viewerFeatOpts = {};
        $.extend(viewerFeatOpts, c_featOps);
        if (iViewerOpts) {
            $.extend(viewerFeatOpts, iViewerOpts);
        }
        else {
            eDwUIUtils.getRequestedQueryStringParams(location.href, viewerFeatOpts);
        }
        if (viewerFeatOpts.Debug) {
            if (!console.debugLogCategories ||
                console.debugLogCategories.length === 0) {
                console.debugLogCategories = ["*"];
                console.debugLogCategories.push("*");
            }
        }
        eDwServiceMgr.create(iServerURL);
        (function () { return __awaiter(_this, void 0, void 0, function () {
            var clientIP, iExcp_2;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 3, , 4]);
                        return [4, eDwServiceMgr.get().getClientPublicIP(viewerFeatOpts.ValidateClientIP)];
                    case 1:
                        clientIP = _a.sent();
                        l_ModelLoadEvents("init");
                        return [4, l_init(iCanvasID, viewerFeatOpts, iInit, clientIP)];
                    case 2:
                        _a.sent();
                        return [3, 4];
                    case 3:
                        iExcp_2 = _a.sent();
                        l_displayError(iExcp_2, iOnError);
                        return [3, 4];
                    case 4: return [2];
                }
            });
        }); })();
    }
    exports.startViewer = startViewer;
    function shutdownViewer(iViewer) {
        l_ModelLoadEvents("shutdown");
        iViewer.unregister();
    }
    exports.shutdownViewer = shutdownViewer;
    function removeModelStreamCache(iViewer, iServer) {
        return __awaiter(this, void 0, void 0, function () {
            var modelKey, serviceMgr, iExcp_3;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        modelKey = iViewer.getCurrModelKey();
                        if (!modelKey || !iViewer.ViewerFeatureOpts.DeleteModelCacheFileWhenDone) {
                            return [2];
                        }
                        console.debugLog("ModelLoad", "Attempting to remove cached model: " +
                            modelKey);
                        serviceMgr = eDwServiceMgr.get();
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4, serviceMgr.removeNamedCache(modelKey, iViewer.ViewerFeatureOpts.DeleteModelCacheFileWhenDone)];
                    case 2:
                        _a.sent();
                        console.debugLog("ModelLoad", "Removed cached model: " + modelKey);
                        return [3, 4];
                    case 3:
                        iExcp_3 = _a.sent();
                        console.debugLog("ModelLoad", "Failed to remove cached model: " +
                            modelKey);
                        console.debugLog("ModelLoad", iExcp_3.message);
                        throw iExcp_3;
                    case 4: return [2];
                }
            });
        });
    }
    exports.removeModelStreamCache = removeModelStreamCache;
    function viewFile(iModelName, iModelKey, iParams, iContainerID, iModelData) {
        return __awaiter(this, void 0, void 0, function () {
            function createViewer(iWebSocketEndpoint) {
                if (iWebSocketEndpoint === "") {
                    return;
                }
                var streamAlways = iParams.StreamAlwaysConnected;
                var streamModes = eDwTypes_1.HC.StreamingMode;
                var webViewerInfo = {};
                webViewerInfo.containerId = iContainerID;
                webViewerInfo.model = iModelKey;
                webViewerInfo.endpointUri = iWebSocketEndpoint;
                webViewerInfo.streamingMode = streamAlways ? streamModes.Interactive
                    : streamModes.All;
                webViewerInfo.streamingMode = iModelData ? null
                    : webViewerInfo.streamingMode;
                webViewerInfo.buffer = iModelData;
                webViewerInfo.boundingPreviewMode = eDwTypes_1.HC.BoundingPreviewMode.None;
                var viewer = new eDwView(webViewerInfo, iParams);
                eDwUIUtils.hide("#" + iContainerID, false);
                var modelName = iModelName;
                if (!iModelName) {
                    modelName = iModelKey;
                }
                $("#edrawings-filename-text").html(modelName);
                console.debugLog("ModelLoad", "Created new edw viewer");
            }
            var serviceMgr, wsEndPt;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        serviceMgr = eDwServiceMgr.get();
                        if (!iModelData) return [3, 1];
                        createViewer(null);
                        return [3, 3];
                    case 1: return [4, serviceMgr.getWebSocketEndpoint(iModelKey, iParams.WebSocketEndpoint)];
                    case 2:
                        wsEndPt = _a.sent();
                        createViewer(wsEndPt);
                        _a.label = 3;
                    case 3: return [2];
                }
            });
        });
    }
    exports.viewFile = viewFile;
    function l_init(iContainerElemID, ioViewerOpts, iInit, iClientIP) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (iInit)
                            iInit(ioViewerOpts, iContainerElemID, iClientIP);
                        if (!ioViewerOpts.URL) return [3, 2];
                        return [4, l_processFile(iContainerElemID, iClientIP, ioViewerOpts)];
                    case 1:
                        _a.sent();
                        _a.label = 2;
                    case 2: return [2];
                }
            });
        });
    }
    function l_processProductStructure(iViewer, iServerURL) {
        return __awaiter(this, void 0, void 0, function () {
            var model, modelHC, rootId, iException_1, msg, _i, _a, msg_1;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        model = iViewer.getModel();
                        modelHC = model.getHCModel();
                        _b.label = 1;
                    case 1:
                        _b.trys.push([1, 3, , 4]);
                        rootId = modelHC.getRootNode();
                        modelHC._getModelStructure().resetPmiColor(rootId);
                        return [4, model.initModelData()];
                    case 2:
                        _b.sent();
                        eDwEventMgr.get().addEventHandlerFunc("Done", function (iViewer) {
                            removeModelStreamCache(iViewer, iServerURL);
                        });
                        iViewer.processProductStructure();
                        return [3, 4];
                    case 3:
                        iException_1 = _b.sent();
                        msg = iException_1.message ? iException_1.message
                            : "No product structure XML?";
                        console.debugLog("ModelLoad", msg);
                        if (iException_1 instanceof eDwResultError) {
                            for (_i = 0, _a = iException_1.Result.ErrorData; _i < _a.length; _i++) {
                                msg_1 = _a[_i];
                                console.debugLog("ModelLoad", msg_1);
                            }
                            if (iException_1.Result.ErrorCode === "NoNodeWithName") {
                                iException_1.Result.ErrorCode = "IncompleteFileProcessing";
                            }
                            throw iException_1;
                        }
                        else {
                            throw new eDwAJAXError(msg, "AJAXFailure");
                        }
                        return [3, 4];
                    case 4: return [2];
                }
            });
        });
    }
    function l_processFile(iContainerElemID, iClientIP, ioParams) {
        return __awaiter(this, void 0, void 0, function () {
            var pos, ext, pos2, fileName;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        pos = ioParams.URL.lastIndexOf('.');
                        if (pos === -1)
                            throw new Error("The file has no extension");
                        ext = ioParams.URL.substr(pos + 1).toLowerCase();
                        if (!(ext === "scs")) return [3, 2];
                        pos2 = ioParams.URL.lastIndexOf("/");
                        fileName = ioParams.URL.substring(pos2 + 1, pos);
                        return [4, l_viewSCSFile(fileName, iContainerElemID, ioParams)];
                    case 1:
                        _a.sent();
                        return [3, 4];
                    case 2: return [4, l_convert(iContainerElemID, iClientIP, ioParams)];
                    case 3:
                        _a.sent();
                        _a.label = 4;
                    case 4: return [2];
                }
            });
        });
    }
    function l_viewSCSFile(iFileName, iContainerElemID, ioParams) {
        return __awaiter(this, void 0, void 0, function () {
            var modelContents, _a;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = Uint8Array.bind;
                        return [4, eDwServiceMgr.get().getFileFromServer(ioParams.URL, true)];
                    case 1:
                        modelContents = new (_a.apply(Uint8Array, [void 0, _b.sent()]))();
                        return [4, viewFile(iFileName, null, ioParams, iContainerElemID, modelContents)];
                    case 2:
                        _b.sent();
                        return [2];
                }
            });
        });
    }
    function l_convert(iContainerID, iClientIP, ioParams) {
        return __awaiter(this, void 0, void 0, function () {
            var serviceMgr, result, iExcp_4;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        serviceMgr = eDwServiceMgr.get();
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 4, , 5]);
                        return [4, serviceMgr.convert(iClientIP, ioParams)];
                    case 2:
                        result = _a.sent();
                        if (result.ErrorCode !== "Success") {
                            throw new eDwResultError(result);
                        }
                        return [4, viewFile(result.FileName, result.ModelCacheName, ioParams, iContainerID)];
                    case 3:
                        _a.sent();
                        return [3, 5];
                    case 4:
                        iExcp_4 = _a.sent();
                        if (iExcp_4 instanceof eDwResultError)
                            throw iExcp_4;
                        console.debugLog("ModelLoad", "Model loading failed: " + iExcp_4.message);
                        throw new eDwAJAXError(iExcp_4.message, "AJAXFailure");
                    case 5: return [2];
                }
            });
        });
    }
    function l_displayError(iExcp, iOnError) {
        if (iOnError) {
            var result = { ErrorCode: "UnkownError", ErrorData: [] };
            if (iExcp instanceof eDwResultError) {
                result = iExcp.Result;
            }
            else if (iExcp instanceof eDwAJAXError) {
                result.ErrorCode = iExcp.ErrorCode;
                result.ErrorData = [iExcp.message];
            }
            else {
                result.ErrorData = [iExcp.name, iExcp.message];
            }
            iOnError(result);
        }
    }
    var c_featOps = {
        URL: "",
        ValidateClientIP: true,
        RenderType: "ShadedWithEdges",
        Tree: false,
        Measure: false,
        Markup: false,
        Debug: false,
        Annot: false,
        Section: true,
        Explode: true,
        DragDrop: false,
        Move: false,
        AR: false,
        Tabs: false,
        Exp: false,
        DeleteModelCacheFileWhenDone: true,
        StreamAlwaysConnected: false,
        WebSocketEndpoint: ""
    };
    var l_ModelLoadEvents;
});
define("eDwAJAXError", ["require", "exports", "eDwBaseError"], function (require, exports, eDwBaseError) {
    "use strict";
    var eDwAJAXError = (function (_super) {
        __extends(eDwAJAXError, _super);
        function eDwAJAXError(iMsg, iErrorCode) {
            var _this = _super.call(this, "eDwAJAXError", iMsg) || this;
            _this.ErrorCode = iErrorCode;
            return _this;
        }
        return eDwAJAXError;
    }(eDwBaseError));
    ;
    return eDwAJAXError;
});
define("eDwAmbientOcclusionCmd", ["require", "exports", "eDwSupportsHistoryCmd"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwAmbientOcclusionCmd = (function (_super) {
        __extends(eDwAmbientOcclusionCmd, _super);
        function eDwAmbientOcclusionCmd(iViewer, iActivate) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitiallyActive = !iActivate;
            _this.mFinallyActive = iActivate;
            return _this;
        }
        eDwAmbientOcclusionCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.mViewer.ViewMgr.enableAmbientOcclusion(this.mInitiallyActive);
            return true;
        };
        eDwAmbientOcclusionCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.mViewer.ViewMgr.enableAmbientOcclusion(this.mFinallyActive);
            return true;
        };
        eDwAmbientOcclusionCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            this.mViewer.ViewMgr.enableAmbientOcclusion(this.mFinallyActive);
        };
        Object.defineProperty(eDwAmbientOcclusionCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        return eDwAmbientOcclusionCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwAmbientOcclusionCmd;
});
define("eDwAnimateCmd", ["require", "exports", "eDwSupportsHistoryCmd"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwAnimateCmd = (function (_super) {
        __extends(eDwAnimateCmd, _super);
        function eDwAnimateCmd(iViewer) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitiallyActive = iViewer.ViewMgr.isActive();
            return _this;
        }
        eDwAnimateCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.toggleState(this.mInitiallyActive);
            return true;
        };
        eDwAnimateCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.toggleState(this.mFinallyActive);
            return true;
        };
        eDwAnimateCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            this.toggleState(this.mInitiallyActive);
            this.mFinallyActive = !this.mInitiallyActive;
        };
        eDwAnimateCmd.prototype.toggleState = function (iState) {
            if (!this.mViewer.getModel().isDrawing()) {
                var viewMgr = this.mViewer.ViewMgr;
                if (iState) {
                    viewMgr.stop();
                }
                else {
                    viewMgr.start();
                }
            }
        };
        return eDwAnimateCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwAnimateCmd;
});
define("eDwBaseError", ["require", "exports"], function (require, exports) {
    "use strict";
    var eDwBaseError = (function (_super) {
        __extends(eDwBaseError, _super);
        function eDwBaseError(iName, iMessage) {
            var _newTarget = this.constructor;
            var _this = this;
            var trueProto = _newTarget.prototype;
            _this = _super.call(this, iMessage) || this;
            var setPrototypeOf = Object["setPrototypeOf"];
            if (setPrototypeOf)
                setPrototypeOf(_this, trueProto);
            else
                _this.__proto__ = trueProto;
            _this.name = iName ? iName : "eDwBaseError";
            return _this;
        }
        return eDwBaseError;
    }(Error));
    ;
    return eDwBaseError;
});
define("eDwBaseOperator", ["require", "exports", "eDwTypes", "eDrawingsBase"], function (require, exports, eDwTypes_2) {
    "use strict";
    var eDwBaseOperator = (function (_super) {
        __extends(eDwBaseOperator, _super);
        function eDwBaseOperator(iViewer) {
            var _this = _super.call(this) || this;
            _this.mCurTouches = [];
            _this.mViewer = iViewer;
            return _this;
        }
        eDwBaseOperator.getAsMouseEvent = function (iTouchEvent, iMouseInputType, iButton) {
            if (iButton === void 0) { iButton = eDwTypes_2.HC.Button.Left; }
            if (iTouchEvent) {
                var pos = iTouchEvent.getPosition();
                var mouseEvent = new eDwTypes_2.HC.Event.MouseInputEvent(pos.x, pos.y, iButton, eDwTypes_2.HC.Buttons.None, eDwTypes_2.HC.KeyModifiers.None, iMouseInputType);
                eDwBaseOperator.setPickResult(mouseEvent, eDwBaseOperator.getPickResult(iTouchEvent));
                mouseEvent.setHandled(iTouchEvent.getHandled());
                return mouseEvent;
            }
            return null;
        };
        eDwBaseOperator.screenToWorld = function (iScrPt, iView) {
            var camera = iView.getCamera();
            var pt = camera.getCameraPlaneIntersectionPoint(iScrPt, iView);
            console.debugLog("Operator", "Screen pt = " + JSON.stringify(iScrPt) +
                " 3D pt = " + JSON.stringify(pt));
            var pt1 = iView.unprojectPoint(iScrPt, 0);
            return pt;
        };
        eDwBaseOperator.prototype.onMouseDown = function (ioMouseEvent) {
            _super.prototype.onMouseDown.call(this, ioMouseEvent);
            if (ioMouseEvent && ioMouseEvent.getButton() !== eDwTypes_2.HC.Button.None) {
                this.setMouse(ioMouseEvent);
            }
        };
        eDwBaseOperator.prototype.onMouseMove = function (ioMouseEvent) {
            _super.prototype.onMouseMove.call(this, ioMouseEvent);
            if (ioMouseEvent) {
                var pos = ioMouseEvent.getPosition();
                if (this.mCurMouse) {
                    this.mDragPt = eDwBaseOperator.screenToWorld(pos, this.mViewer.getHCView());
                    this.updateMouse(ioMouseEvent);
                }
                console.debugLog("Operator", "move screen pt = " +
                    JSON.stringify(pos));
            }
        };
        eDwBaseOperator.prototype.onMouseUp = function (ioMouseEvent) {
            _super.prototype.onMouseUp.call(this, ioMouseEvent);
            if (ioMouseEvent) {
                this.mDragPt = null;
                this.mCurMouse = null;
            }
        };
        eDwBaseOperator.prototype.onTouchStart = function (ioTouchEvent) {
            var _this = this;
            _super.prototype.onTouchStart.call(this, ioTouchEvent);
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_2.HC.MouseInputType.Down, function (ioMouseEvent) {
                _this.onMouseDown(ioMouseEvent);
            });
            this.addTouch(ioTouchEvent);
        };
        eDwBaseOperator.prototype.onTouchMove = function (ioTouchEvent) {
            var _this = this;
            _super.prototype.onTouchMove.call(this, ioTouchEvent);
            if (!this.hasTouchMoved(ioTouchEvent)) {
                ioTouchEvent.setHandled(true);
                return;
            }
            this.updateTouch(ioTouchEvent);
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_2.HC.MouseInputType.Move, function (ioMouseEvent) {
                _this.onMouseMove(ioMouseEvent);
            });
        };
        eDwBaseOperator.prototype.onTouchEnd = function (ioTouchEvent) {
            var _this = this;
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_2.HC.MouseInputType.Up, function (ioMouseEvent) {
                _this.onMouseUp(ioMouseEvent);
            });
            ioTouchEvent.setHandled(false);
            _super.prototype.onTouchEnd.call(this, ioTouchEvent);
            this.removeTouchById(ioTouchEvent.getId());
        };
        eDwBaseOperator.prototype.onDeactivate = function () {
            _super.prototype.onDeactivate.call(this);
            this.mDragPt = null;
        };
        eDwBaseOperator.getPickResult = function (iEvent) {
            return iEvent._getPickResult();
        };
        eDwBaseOperator.setPickResult = function (iEvent, iSelObj) {
            iEvent._setPickResult(iSelObj);
        };
        eDwBaseOperator.prototype.wrapAndCallAsMouseEvent = function (ioTouchEvent, iInputType, iMouseFunc, iButton) {
            if (iButton === void 0) { iButton = eDwTypes_2.HC.Button.Left; }
            var mouseEvent = eDwBaseOperator.getAsMouseEvent(ioTouchEvent, iInputType, iButton);
            if (mouseEvent) {
                iMouseFunc(mouseEvent);
                ioTouchEvent.setHandled(mouseEvent.getHandled());
            }
        };
        eDwBaseOperator.prototype.addTouch = function (ioTouchEvent) {
            if (!this.getTouchById(ioTouchEvent.getId())) {
                this.mCurTouches.push({
                    origTouch: ioTouchEvent,
                    lastDragPt: eDwBaseOperator.screenToWorld(ioTouchEvent.getPosition(), this.mViewer.getHCView()),
                    lastPos: ioTouchEvent.getPosition()
                });
            }
        };
        eDwBaseOperator.prototype.getTouchById = function (touchId) {
            for (var i = 0; i < this.mCurTouches.length; ++i) {
                if (touchId === this.mCurTouches[i].origTouch.getId()) {
                    return this.mCurTouches[i];
                }
            }
            return null;
        };
        eDwBaseOperator.prototype.removeTouchById = function (touchId) {
            var idx = -1;
            for (var i = 0; i < this.mCurTouches.length; ++i) {
                if (touchId === this.mCurTouches[i].origTouch.getId()) {
                    idx = i;
                    break;
                }
            }
            if (idx === -1)
                return;
            var tmpArray = [];
            for (var i = 0; i < this.mCurTouches.length; ++i) {
                if (i === idx)
                    continue;
                tmpArray.push(this.mCurTouches[i]);
            }
            this.mCurTouches = tmpArray;
        };
        eDwBaseOperator.prototype.hasTouchMoved = function (ioTouchEvent) {
            if (!ioTouchEvent)
                return false;
            var touch = this.getTouchById(ioTouchEvent.getId());
            if (!touch)
                return false;
            var curPos = ioTouchEvent.getPosition();
            if (curPos.x !== Math.round(curPos.x) ||
                curPos.y !== Math.round(curPos.y)) {
                return false;
            }
            var lastPos = touch.lastPos;
            var origPos = touch.origTouch.getPosition();
            var epsX = 1, epsY = 1;
            var delta = eDwTypes_2.HC.Point2.subtract(curPos, origPos);
            return (Math.abs(delta.x) > epsX && Math.abs(delta.y) > epsY);
        };
        eDwBaseOperator.prototype.updateTouch = function (ioTouchEvent) {
            var touch = this.getTouchById(ioTouchEvent.getId());
            if (touch) {
                touch.lastPos = ioTouchEvent.getPosition();
                touch.lastDragPt = eDwBaseOperator.screenToWorld(ioTouchEvent.getPosition(), this.mViewer.getHCView());
            }
        };
        eDwBaseOperator.prototype.hasMouseMoved = function (ioMouseEvent) {
            if (!this.mCurMouse)
                return false;
            var curPos = ioMouseEvent.getPosition();
            var origPos = this.mCurMouse.origMouse.getPosition();
            var delta = eDwTypes_2.HC.Point2.subtract(curPos, origPos);
            return Math.abs(delta.x) > 1 || Math.abs(delta.y) > 1;
        };
        eDwBaseOperator.prototype.setMouse = function (ioMouseEvent) {
            this.mCurMouse = {
                origMouse: ioMouseEvent,
                lastDragPt: eDwBaseOperator.screenToWorld(ioMouseEvent.getPosition(), this.mViewer.getHCView()),
                lastPos: ioMouseEvent.getPosition()
            };
        };
        eDwBaseOperator.prototype.updateMouse = function (ioMouseEvent) {
            if (!ioMouseEvent || !this.mCurMouse)
                return;
            var pos = ioMouseEvent.getPosition();
            this.mCurMouse.lastPos = pos;
            this.mCurMouse.lastDragPt = eDwBaseOperator.screenToWorld(pos, this.mViewer.getHCView());
        };
        return eDwBaseOperator;
    }(eDwTypes_2.HC.Operator.Operator));
    return eDwBaseOperator;
});
define("eDwBaseSelOperator", ["require", "exports", "eDwBaseOperator", "eDwTypes"], function (require, exports, eDwBaseOperator, eDwTypes_3) {
    "use strict";
    var eDwBaseSelOperator = (function (_super) {
        __extends(eDwBaseSelOperator, _super);
        function eDwBaseSelOperator(iViewer, iSelMgr) {
            var _this = _super.call(this, iViewer) || this;
            _this.mSelMgr = iSelMgr;
            _this.mPrevHighlightStates = {};
            return _this;
        }
        eDwBaseSelOperator.prototype.onDeactivate = function () {
            _super.prototype.onDeactivate.call(this);
            this.popHighlightSelectionState("NODE");
            this.popHighlightSelectionState("FACE");
            this.popHighlightSelectionState("EDGE");
            this.popHighlightSelectionState("VERTEX");
            this.popNodeSelectionColor();
            this.popNodeSelectionOutlineColor();
            this.popNodeSelectionHighlightMode();
            this.popElementSelectionColor();
            this.popElementSelectionOutlineColor();
            this.popElementSelectionHighlightMode();
        };
        eDwBaseSelOperator.prototype.onMouseDown = function (ioMouseEvent) {
            _super.prototype.onMouseDown.call(this, ioMouseEvent);
            if (ioMouseEvent) {
                this.actionStart(ioMouseEvent.getPosition());
            }
        };
        eDwBaseSelOperator.prototype.onMouseUp = function (ioMouseEvent) {
            _super.prototype.onMouseUp.call(this, ioMouseEvent);
            if (ioMouseEvent) {
                this.actionEnd(ioMouseEvent.getPosition());
            }
        };
        eDwBaseSelOperator.prototype.onTouchStart = function (ioTouchEvent) {
            _super.prototype.onTouchStart.call(this, ioTouchEvent);
            if (ioTouchEvent) {
                this.actionStart(ioTouchEvent.getPosition());
            }
        };
        eDwBaseSelOperator.prototype.onTouchMove = function (ioTouchEvent) {
            _super.prototype.onTouchMove.call(this, ioTouchEvent);
        };
        eDwBaseSelOperator.prototype.onTouchEnd = function (ioTouchEvent) {
            _super.prototype.onTouchEnd.call(this, ioTouchEvent);
            if (ioTouchEvent) {
                this.actionEnd(ioTouchEvent.getPosition());
            }
        };
        eDwBaseSelOperator.prototype.pushHighlightSelectionState = function (iSelType, iNewState) {
            return this.mPrevHighlightStates[iSelType] =
                this.mSelMgr.setHighlightSelection(iSelType, iNewState);
        };
        eDwBaseSelOperator.prototype.pushNodeSelectionColor = function (iColor) {
            return this.mPrevNodeColor =
                this.mSelMgr.setNodeSelectionColor(iColor);
        };
        eDwBaseSelOperator.prototype.pushNodeSelectionOutlineColor = function (iColor) {
            return this.mPrevNodeOutlineColor =
                this.mSelMgr.setNodeSelectionOutlineColor(iColor);
        };
        eDwBaseSelOperator.prototype.pushNodeSelectionHighlightMode = function (iSelHighlightMode) {
            return this.mPrevNodeHighlightMode =
                this.mSelMgr.setNodeSelectionHighlightMode(iSelHighlightMode);
        };
        eDwBaseSelOperator.prototype.pushElementSelectionColor = function (iColor) {
            return this.mPrevElementColor =
                this.mSelMgr.setElementSelectionColor(iColor);
        };
        eDwBaseSelOperator.prototype.pushElementSelectionOutlineColor = function (iColor) {
            return this.mPrevElementOutlineColor =
                this.mSelMgr.setElementSelectionOutlineColor(iColor);
        };
        eDwBaseSelOperator.prototype.pushElementSelectionHighlightMode = function (iSelHighlightMode) {
            return this.mPrevElementHighlightMode =
                this.mSelMgr.setElementSelectionHighlightMode(iSelHighlightMode);
        };
        eDwBaseSelOperator.prototype.popHighlightSelectionState = function (iSelType) {
            if (this.mPrevHighlightStates &&
                this.mPrevHighlightStates.hasOwnProperty(iSelType)) {
                this.mSelMgr.setHighlightSelection(iSelType, this.mPrevHighlightStates[iSelType]);
                delete this.mPrevHighlightStates[iSelType];
            }
        };
        eDwBaseSelOperator.prototype.popNodeSelectionColor = function () {
            if (this.mPrevNodeColor) {
                this.mSelMgr.setNodeSelectionColor(this.mPrevNodeColor);
                this.mPrevNodeColor = null;
            }
        };
        eDwBaseSelOperator.prototype.popNodeSelectionOutlineColor = function () {
            if (this.mPrevNodeOutlineColor) {
                this.mSelMgr.setNodeSelectionOutlineColor(this.mPrevNodeOutlineColor);
                this.mPrevNodeOutlineColor = null;
            }
        };
        eDwBaseSelOperator.prototype.popNodeSelectionHighlightMode = function () {
            if (this.mPrevNodeHighlightMode) {
                this.mSelMgr.setNodeSelectionHighlightMode(this.mPrevNodeHighlightMode);
                this.mPrevNodeHighlightMode = null;
            }
        };
        eDwBaseSelOperator.prototype.popElementSelectionColor = function () {
            if (this.mPrevElementColor) {
                this.mSelMgr.setElementSelectionColor(this.mPrevElementColor);
                this.mPrevElementColor = null;
            }
        };
        eDwBaseSelOperator.prototype.popElementSelectionOutlineColor = function () {
            if (this.mPrevElementOutlineColor) {
                this.mSelMgr.setElementSelectionOutlineColor(this.mPrevElementOutlineColor);
                this.mPrevElementOutlineColor = null;
            }
        };
        eDwBaseSelOperator.prototype.popElementSelectionHighlightMode = function () {
            if (this.mPrevElementHighlightMode) {
                this.mSelMgr.setElementSelectionHighlightMode(this.mPrevElementHighlightMode);
                this.mPrevElementHighlightMode = null;
            }
        };
        eDwBaseSelOperator.prototype.getSelObjFromEvent = function (iInputEvent) {
            var obj = eDwBaseOperator.getPickResult(iInputEvent);
            return obj && obj.getSelectionType() === eDwTypes_3.HC.SelectionType.None ? null
                : obj;
        };
        eDwBaseSelOperator.prototype.actionStart = function (iPoint) {
            this.mFirstPt = eDwBaseOperator.screenToWorld(iPoint, this.mViewer.getHCView());
            console.debugLog("BaseSelOp", "down screen pt = " +
                JSON.stringify(iPoint));
        };
        eDwBaseSelOperator.prototype.actionEnd = function (iPoint) {
            this.mFirstPt = null;
            console.debugLog("BaseSelOp", "up screen pt = " +
                JSON.stringify(iPoint));
        };
        return eDwBaseSelOperator;
    }(eDwBaseOperator));
    return eDwBaseSelOperator;
});
define("eDwChangeModelViewCmd", ["require", "exports", "eDwSupportsHistoryCmd", "eDrawingsBase"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwChangeModelViewCmd = (function (_super) {
        __extends(eDwChangeModelViewCmd, _super);
        function eDwChangeModelViewCmd(iViewer, iModelViewName, iCamera) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitialModelViewName =
                iViewer.getModel().getActiveModelView().Name;
            _this.mInitialCamera = iViewer.getHCView().getCamera().copy();
            _this.mFinalModelViewName = iModelViewName;
            _this.mFinalCamera = iCamera;
            return _this;
        }
        eDwChangeModelViewCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.activateModelView(this.mInitialModelViewName, this.mInitialCamera);
            return true;
        };
        eDwChangeModelViewCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.activateModelView(this.mFinalModelViewName, this.mFinalCamera);
            return true;
        };
        eDwChangeModelViewCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            this.activateModelView(this.mFinalModelViewName, this.mFinalCamera);
        };
        Object.defineProperty(eDwChangeModelViewCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        eDwChangeModelViewCmd.prototype.activateModelView = function (iModelView, iCamera) {
            this.mViewer.SelectionMgr.unSelectAllObjects();
            this.mViewer.getModel().activateModelView(iModelView, iCamera);
        };
        return eDwChangeModelViewCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwChangeModelViewCmd;
});
define("eDwChangeSectionPlaneCmd", ["require", "exports", "eDwSupportsHistoryCmd", "eDrawingsBase"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwChangeSectionPlaneCmd = (function (_super) {
        __extends(eDwChangeSectionPlaneCmd, _super);
        function eDwChangeSectionPlaneCmd(iViewer, iInitialPlane, iFinalPlane) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitialPlane = iInitialPlane;
            _this.mFinalPlane = iFinalPlane;
            return _this;
        }
        eDwChangeSectionPlaneCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.mViewer.XSectionMgr.setSectionPlane(this.mInitialPlane);
            return true;
        };
        eDwChangeSectionPlaneCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.mViewer.XSectionMgr.setSectionPlane(this.mFinalPlane);
            return true;
        };
        eDwChangeSectionPlaneCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            this.mViewer.XSectionMgr.setSectionPlane(this.mFinalPlane);
        };
        eDwChangeSectionPlaneCmd.prototype.isCommitted = function () {
            return _super.prototype.isCommitted.call(this) && !!this.mInitialPlane &&
                !!this.mFinalPlane;
        };
        Object.defineProperty(eDwChangeSectionPlaneCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        return eDwChangeSectionPlaneCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwChangeSectionPlaneCmd;
});
define("eDwCmd", ["require", "exports", "eDwOperationMixin"], function (require, exports, eDwOperationMixin) {
    "use strict";
    var eDwCmd = (function (_super) {
        __extends(eDwCmd, _super);
        function eDwCmd(iViewer) {
            var _this = _super.call(this) || this;
            _this.mViewer = iViewer;
            return _this;
        }
        eDwCmd.prototype.commit = function () {
        };
        eDwCmd.prototype.cancel = function () {
        };
        eDwCmd.prototype.setHierarchyNodeIDsAttribs = function (iNodesWithAttribs) {
            if (!iNodesWithAttribs)
                return;
            var model = this.mViewer.getModel();
            model.setAttribs(iNodesWithAttribs);
        };
        eDwCmd.prototype.getHierarchyNodesAttribs = function (iExcludeModelViewNode) {
            if (iExcludeModelViewNode === void 0) { iExcludeModelViewNode = true; }
            var nodeWithAttrib = [];
            var modelView = this.mViewer.getModel().getActiveModelView();
            var hierNodes = modelView.Nodes;
            for (var hierNodeName in hierNodes) {
                var hierNode = hierNodes[hierNodeName];
                if (iExcludeModelViewNode && modelView.Hierarchy === hierNode) {
                    continue;
                }
                var attrib = $.extend(true, {}, hierNode.getAttribs());
                nodeWithAttrib.push({ HierNode: hierNode, Attribs: attrib });
            }
            return nodeWithAttrib;
        };
        return eDwCmd;
    }(eDwOperationMixin));
    ;
    return eDwCmd;
});
define("eDwCommandMgr", ["require", "exports", "utils"], function (require, exports, Utils) {
    "use strict";
    var eDwCommandMgr = (function () {
        function eDwCommandMgr() {
            this.mActiveCmds = [];
        }
        eDwCommandMgr.get = function () {
            if (!eDwCommandMgr.sCommandMgr) {
                eDwCommandMgr.sCommandMgr = new eDwCommandMgr();
            }
            return eDwCommandMgr.sCommandMgr;
        };
        eDwCommandMgr.prototype.add = function (iCmd) {
            if (!iCmd)
                return;
            this.popCmds(iCmd);
            this.mActiveCmds.push(iCmd);
            console.debugLog("CommandMgr", "Added " +
                Utils.getObjectTypeName(iCmd) +
                " as an active command.");
        };
        eDwCommandMgr.prototype.remove = function (iCmd, iCmdAction) {
            var ret = this.detach(iCmd);
            if (ret && iCmdAction)
                iCmd[iCmdAction]();
            console.debugLog("CommandMgr", (ret ? "Removed " : "Not Found ") +
                Utils.getObjectTypeName(iCmd) +
                " as an active command. " +
                (ret && iCmdAction ? " Also, " + iCmdAction +
                    "ed it." : ""));
            return ret;
        };
        eDwCommandMgr.prototype.clear = function () {
            for (var cmd = this.mActiveCmds.pop(); cmd; cmd = this.mActiveCmds.pop()) {
                cmd.cancel();
            }
            console.debugLog("CommandMgr", "All active commands cleared.");
        };
        eDwCommandMgr.prototype.popCmds = function (iCmd) {
            if (iCmd.Aggregable && (!this.mActiveCmds.length ||
                this.mActiveCmds[this.mActiveCmds.length - 1].AllowsAggregation)) {
                return;
            }
            if (iCmd.Exclusive) {
                var exclusiveCmds = this.mActiveCmds.filter(function (iCmd) { return iCmd.Exclusive; });
                for (var i = exclusiveCmds.length - 1; i > -1; --i) {
                    exclusiveCmds[i].commit();
                }
                this.mActiveCmds = this.mActiveCmds.filter(function (iCmd) { return !iCmd.Exclusive; });
            }
        };
        eDwCommandMgr.prototype.detach = function (iCmd) {
            var cmdPos = this.mActiveCmds.indexOf(iCmd);
            if (cmdPos === -1)
                return false;
            var removedCmds = this.mActiveCmds.splice(cmdPos, 1);
            return removedCmds.length === 1 ? true : false;
        };
        return eDwCommandMgr;
    }());
    ;
    return eDwCommandMgr;
});
define("eDwCompositeCmd", ["require", "exports", "eDwSupportsHistoryCmd", "eDwHistoryMgr", "eDwCommandMgr", "utils", "eDrawingsBase"], function (require, exports, eDwSupportsHistoryCmd, eDwHistoryMgr, eDwCommandMgr, Utils) {
    "use strict";
    var eDwCompositeCmd = (function (_super) {
        __extends(eDwCompositeCmd, _super);
        function eDwCompositeCmd(iViewer) {
            var _this = _super.call(this, iViewer) || this;
            eDwHistoryMgr.get().pushStack();
            return _this;
        }
        eDwCompositeCmd.prototype.initCmdActionImplementation = function (iHistoryActions) {
            this.mCmdHistoryActions = iHistoryActions;
            if (this.mCmdHistoryActions && this.mCmdHistoryActions.compositeInit) {
                this.mCmdHistoryActions.compositeInit(this);
            }
        };
        eDwCompositeCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            var actionExists = this.mCmdHistoryActions &&
                this.mCmdHistoryActions.compositeUndo;
            return actionExists ? this.mCmdHistoryActions.compositeUndo(this)
                : this.undoSubCmds();
        };
        eDwCompositeCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            var actionExists = this.mCmdHistoryActions &&
                this.mCmdHistoryActions.compositeRedo;
            return actionExists ? this.mCmdHistoryActions.compositeRedo(this)
                : this.redoSubCmds();
        };
        eDwCompositeCmd.prototype.commit = function () {
            this.mSubCmds = eDwHistoryMgr.get().popStack();
            _super.prototype.commit.call(this);
            if (this.mCmdHistoryActions && this.mCmdHistoryActions.compositeCommit) {
                this.mCmdHistoryActions.compositeCommit(this);
            }
        };
        eDwCompositeCmd.prototype.cancel = function () {
            this.mSubCmds = eDwHistoryMgr.get().popStack();
            _super.prototype.cancel.call(this);
            if (this.mCmdHistoryActions && this.mCmdHistoryActions.compositeCancel) {
                this.mCmdHistoryActions.compositeCancel(this);
            }
            else {
                this.cancelSubCmds();
            }
            this.clearSubCmds();
        };
        eDwCompositeCmd.prototype.isCommitted = function () {
            return _super.prototype.isCommitted.call(this) &&
                !(this.InitialState === undefined || this.InitialState === null) &&
                !(this.FinalState === undefined || this.FinalState === null);
        };
        Object.defineProperty(eDwCompositeCmd.prototype, "AllowsAggregation", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        eDwCompositeCmd.prototype.undoSubCmds = function () {
            var isSuccessful = true;
            var lastCmdIndex = this.mSubCmds.length - 1;
            for (var i = lastCmdIndex; i > -1; i--) {
                var cmd = this.mSubCmds[i];
                var ret = cmd.undo();
                console.debugLog("History", "Undo subcommand history at index " +
                    i + (ret ? " succeeded." : " failed.") +
                    " Object Type = " +
                    Utils.getObjectTypeName(cmd) + ".");
                if (!ret) {
                    isSuccessful = false;
                }
            }
            return isSuccessful;
        };
        eDwCompositeCmd.prototype.cancelSubCmds = function () {
            var cmdMgr = eDwCommandMgr.get();
            var lastCmdIndex = this.mSubCmds.length - 1;
            for (var i = lastCmdIndex; i > -1; i--) {
                cmdMgr.remove(this.mSubCmds[i], "cancel");
            }
        };
        eDwCompositeCmd.prototype.redoSubCmds = function () {
            var isSuccessful = true;
            var numCmds = this.mSubCmds.length;
            for (var i = 0; i < numCmds; i++) {
                var cmd = this.mSubCmds[i];
                var ret = cmd.redo();
                console.debugLog("History", "Redo subcommand history at index " +
                    i + (ret ? " succeeded." : " failed.") +
                    " Object Type = " +
                    Utils.getObjectTypeName(cmd) + ".");
                if (!ret) {
                    isSuccessful = false;
                }
            }
            return isSuccessful;
        };
        eDwCompositeCmd.prototype.clearSubCmds = function () {
            this.mSubCmds = null;
        };
        return eDwCompositeCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwCompositeCmd;
});
define("eDwCompXformMgr", ["require", "exports", "eDwMoveOperator", "eDwEventMgr", "eDwCommandMgr", "eDwCompositeCmd", "utils"], function (require, exports, eDwMoveOperator, eDwEventMgr, eDwCommandMgr, eDwCompositeCmd, Utils) {
    "use strict";
    var eDwCompXformMgr = (function () {
        function eDwCompXformMgr(iViewer) {
            var _this = this;
            this.mViewer = iViewer;
            iViewer.CompXformMgr = this;
            this.mMoveOp = new eDwMoveOperator(iViewer, iViewer.SelectionMgr);
            iViewer.OperatorMgr.registerCustomOperator(this.mMoveOp);
            var eventMgr = eDwEventMgr.get();
            this.mModelChangeStartEventIndex =
                eventMgr.addEventHandlerFunc("ModelXformChangeStart", function (iModelNodeID, iModelXform) {
                    if (!_this.mOrigModelXforms)
                        _this.mOrigModelXforms = {};
                    if (!_this.mOrigModelXforms[iModelNodeID]) {
                        _this.mOrigModelXforms[iModelNodeID] = iModelXform;
                    }
                });
            this.mOrigModelXforms = {};
            this.mChangedModelXforms = {};
        }
        eDwCompXformMgr.prototype.unregister = function () {
            eDwEventMgr.get().removeEventHandlerByIndex("ModelXformChangeStart", this.mModelChangeStartEventIndex);
            this.mViewer.OperatorMgr.unregisterCustomOperatorByID(this.mMoveOp.OperatorID);
            this.mViewer.CompXformMgr = null;
        };
        eDwCompXformMgr.prototype.activateMoveOp = function () {
            var _this = this;
            if (!this.mMoveOp)
                return null;
            this.mCompositeMoveCmd = new eDwCompositeCmd(this.mViewer);
            eDwCommandMgr.get().add(this.mCompositeMoveCmd);
            this.mCompositeMoveCmd.initCmdActionImplementation({
                compositeInit: function (ioCmd) {
                    ioCmd.InitialState = true;
                },
                compositeUndo: function (ioCmd) {
                    ioCmd.undoSubCmds();
                    _this.resetModelNodeXforms(ioCmd.InitialState);
                    return true;
                },
                compositeRedo: function (ioCmd) {
                    ioCmd.redoSubCmds();
                    _this.resetModelNodeXforms(ioCmd.FinalState);
                    return true;
                },
                compositeCommit: function (ioCmd) {
                    ioCmd.FinalState = false;
                },
                compositeCancel: function (ioCmd) {
                    ioCmd.FinalState = ioCmd.InitialState = undefined;
                }
            });
            var ret = this.mViewer.OperatorMgr.push(this.mMoveOp.OperatorID);
            return ret ? this.mMoveOp : null;
        };
        eDwCompXformMgr.prototype.deactivateMoveOp = function () {
            eDwCommandMgr.get().remove(this.mCompositeMoveCmd, "commit");
            this.mCompositeMoveCmd = null;
            return this.mViewer.OperatorMgr.pop();
        };
        eDwCompXformMgr.prototype.getModelNodeXform = function (iID) {
            return this.mOrigModelXforms ? this.mOrigModelXforms[iID] : null;
        };
        eDwCompXformMgr.prototype.resetModelNodeXforms = function (iRestoreOrigs) {
            var _this = this;
            if (iRestoreOrigs === void 0) { iRestoreOrigs = true; }
            var modelHC = this.mViewer.getModel().getHCModel();
            var modelXforms = iRestoreOrigs ? this.mOrigModelXforms
                : this.mChangedModelXforms;
            Utils.forAll(function (iCompNodeID, iCompXform) {
                if (!_this.mChangedModelXforms[iCompNodeID]) {
                    _this.mChangedModelXforms[iCompNodeID] =
                        modelHC.getNodeMatrix(iCompNodeID).copy();
                }
                modelHC.setNodeMatrix(iCompNodeID, iCompXform.copy());
            }, modelXforms);
        };
        return eDwCompXformMgr;
    }());
    ;
    return eDwCompXformMgr;
});
define("eDwConvTypes", ["require", "exports"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
});
define("eDwDrawModeCmd", ["require", "exports", "eDwSupportsHistoryCmd"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwDrawModeCmd = (function (_super) {
        __extends(eDwDrawModeCmd, _super);
        function eDwDrawModeCmd(iViewer, iDrawMode) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitialDrawMode = iViewer.getDrawMode();
            _this.mFinalDrawMode = iDrawMode;
            return _this;
        }
        eDwDrawModeCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.mViewer.setDrawMode(this.mInitialDrawMode);
            return true;
        };
        eDwDrawModeCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.mViewer.setDrawMode(this.mFinalDrawMode);
            return true;
        };
        eDwDrawModeCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            this.mViewer.setDrawMode(this.mFinalDrawMode);
        };
        Object.defineProperty(eDwDrawModeCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        return eDwDrawModeCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwDrawModeCmd;
});
define("eDwEventMgr", ["require", "exports"], function (require, exports) {
    "use strict";
    var eDwEventMgr = (function () {
        function eDwEventMgr() {
            this.mEventHandlers = {};
        }
        eDwEventMgr.get = function () {
            if (!eDwEventMgr.sMgr)
                eDwEventMgr.sMgr = new eDwEventMgr();
            return eDwEventMgr.sMgr;
        };
        eDwEventMgr.prototype.addEventHandlerObj = function (iEventCategory, iEventHandlerObj, iEventHandlerFuncName) {
            if (!this.mEventHandlers[iEventCategory]) {
                this.mEventHandlers[iEventCategory] = [];
            }
            var handlerMap = {};
            handlerMap[iEventHandlerFuncName] = iEventHandlerObj;
            return this.mEventHandlers[iEventCategory].push(handlerMap);
        };
        eDwEventMgr.prototype.addEventHandlerFunc = function (iEventCategory, iEventHandlerFunc) {
            if (!this.mEventHandlers[iEventCategory]) {
                this.mEventHandlers[iEventCategory] = [];
            }
            var handlerMap = {};
            handlerMap[iEventHandlerFunc.name] = iEventHandlerFunc;
            return this.mEventHandlers[iEventCategory].push(handlerMap);
        };
        eDwEventMgr.prototype.getCreatedEventHandlerCategories = function () {
            return Object.keys(this.mEventHandlers);
        };
        eDwEventMgr.prototype.removeEventHandlerFunc = function (iEventCategory, iEventHandlerFuncName) {
            var handlerMaps = this.mEventHandlers[iEventCategory];
            if (!handlerMaps)
                return;
            for (var index in handlerMaps) {
                var handlerMap = handlerMaps[index];
                if (handlerMap[iEventHandlerFuncName]) {
                    handlerMaps.splice(parseInt(index, 10), 1);
                }
            }
        };
        eDwEventMgr.prototype.removeEventHandlerObj = function (iEventCategory, iEventHandlerObj) {
            this.removeEventHandlerFunc(iEventCategory, iEventHandlerObj.name);
        };
        eDwEventMgr.prototype.removeEventHandlerByIndex = function (iEventCategory, iEventHandlerIndex) {
            var handlerMaps = this.mEventHandlers[iEventCategory];
            if (!handlerMaps || iEventHandlerIndex === -1)
                return;
            if (handlerMaps.length > iEventHandlerIndex) {
                handlerMaps.splice(iEventHandlerIndex, 1);
            }
        };
        eDwEventMgr.prototype.removeAllEventHandlers = function () {
            this.removeEventHandlerCategories(Object.keys(this.mEventHandlers));
        };
        eDwEventMgr.prototype.removeEventHandlerCategories = function (iCategoryKeys) {
            for (var i = 0; i < iCategoryKeys.length; i++) {
                delete this.mEventHandlers[iCategoryKeys[i]];
            }
        };
        eDwEventMgr.prototype.fireEvents = function (iEventCategory) {
            var iArgs = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                iArgs[_i - 1] = arguments[_i];
            }
            var handlerMaps = this.mEventHandlers[iEventCategory];
            if (!handlerMaps)
                return;
            for (var _a = 0, handlerMaps_1 = handlerMaps; _a < handlerMaps_1.length; _a++) {
                var handlerMap = handlerMaps_1[_a];
                var keys = Object.keys(handlerMap);
                console.assert(keys.length === 1);
                var funcName = keys[0];
                var handlerObj = handlerMap[funcName];
                if (typeof (handlerObj) === "function") {
                    var handlerFunc = handlerObj;
                    if (handlerFunc)
                        handlerFunc.call.apply(handlerFunc, [handlerObj].concat(iArgs));
                }
                else {
                    var handlerFunc = eDwEventMgr.getHandler(handlerObj, funcName);
                    if (handlerFunc)
                        handlerFunc.call.apply(handlerFunc, [handlerObj].concat(iArgs));
                }
            }
        };
        eDwEventMgr.getHandler = function (iHandlerObj, iHandlerName) {
            var handler;
            var handlerObj = iHandlerObj;
            var parentClass = Object.getPrototypeOf(iHandlerObj);
            while (handlerObj && !handler) {
                handler = handlerObj[iHandlerName];
                if (!handler) {
                    handlerObj = parentClass;
                    parentClass = handlerObj ? Object.getPrototypeOf(handlerObj)
                        : null;
                }
            }
            return handler instanceof Function ? handler : null;
        };
        return eDwEventMgr;
    }());
    ;
    return eDwEventMgr;
});
define("eDwEvents", ["require", "exports"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    ;
    ;
});
define("eDwExplodeCmd", ["require", "exports", "eDwSupportsHistoryCmd"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwExplodeCmd = (function (_super) {
        __extends(eDwExplodeCmd, _super);
        function eDwExplodeCmd(iViewer) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitialLevel = _this.mViewer.getExplosionLevel();
            return _this;
        }
        eDwExplodeCmd.prototype.setLevel = function (iLevel) {
            this.setExplosionLevel(iLevel);
            this.mFinalLevel = iLevel;
        };
        eDwExplodeCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.setExplosionLevel(this.mInitialLevel);
            return true;
        };
        eDwExplodeCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.setExplosionLevel(this.mFinalLevel);
            return true;
        };
        eDwExplodeCmd.prototype.cancel = function () {
            _super.prototype.cancel.call(this);
            this.setExplosionLevel(this.mInitialLevel);
            this.mViewer.HCViewer.getExplodeManager().stop();
        };
        Object.defineProperty(eDwExplodeCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        eDwExplodeCmd.prototype.setExplosionLevel = function (iLevel) {
            var explodeMgrHC = this.mViewer.HCViewer.getExplodeManager();
            if (!explodeMgrHC.getActive())
                explodeMgrHC.start();
            this.mViewer.setExplosionLevel(iLevel);
        };
        return eDwExplodeCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwExplodeCmd;
});
define("eDwGeomUtils", ["require", "exports", "eDrawingsBase"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    function dropPointOnPlane(iPoint, iPlane) {
        var dist = iPlane.distanceToPoint(iPoint);
        var vec = iPlane.normal.copy();
        return vec.normalize().scale(-dist).add(iPoint);
    }
    exports.dropPointOnPlane = dropPointOnPlane;
});
define("eDwHierarchyNode", ["require", "exports", "jquery", "eDwResultError", "eDwNodeAttributes"], function (require, exports, $, eDwResultError, eDwNodeAttributes_1) {
    "use strict";
    var eDwHierarchyNode = (function () {
        function eDwHierarchyNode(iName, iCategory, iAttributes, iParentNode, iModeView, iModel) {
            this.Category = iCategory;
            this.mModelView = iModeView;
            this.mModel = iModel;
            this.mChildren = {};
            this.mBoundingBoxNodeIDs = [];
            this.mParentNode = iParentNode;
            this.Name = iName;
            if ("`" === iName.charAt(0) &&
                "`" === iName.charAt(iName.length - 1)) {
                this.Name = iName.slice(1, -1);
            }
            this.mAttribs = {};
            $.extend(this.mAttribs, iAttributes);
            if (this.mAttribs.Visible !== true)
                this.mAttribs.Visible = false;
            this.mReadOnlyAttribs = {};
            $.extend(this.mReadOnlyAttribs, this.mAttribs);
            this.mReadOnlyOverrideAttribs = {};
        }
        eDwHierarchyNode.prototype.addChild = function (iName, iCategory, iAttribs, iParentNode) {
            var node = new eDwHierarchyNode(iName, iCategory, iAttribs, iParentNode, this.mModelView, this.mModel);
            this.mChildren[iName] = node;
            return node;
        };
        eDwHierarchyNode.prototype.getChildren = function () {
            return this.mChildren;
        };
        Object.defineProperty(eDwHierarchyNode.prototype, "ParentNode", {
            get: function () {
                return this.mParentNode;
            },
            enumerable: true,
            configurable: true
        });
        eDwHierarchyNode.prototype.getAttribs = function () {
            var attribs = {};
            $.extend(attribs, this.mAttribs);
            $.extend(attribs, this.mReadOnlyOverrideAttribs);
            return attribs;
        };
        eDwHierarchyNode.prototype.getInitialAttribs = function () {
            var attribs = {};
            $.extend(attribs, this.mReadOnlyAttribs);
            return attribs;
        };
        eDwHierarchyNode.prototype.setAttribs = function (iAttribs) {
            var changedAttribs = eDwNodeAttributes_1.eDwNodeAttributes.setAttribs(this.mAttribs, iAttribs);
            return changedAttribs;
        };
        eDwHierarchyNode.prototype.setOverrideAttribs = function (iAttribs) {
            this.mReadOnlyOverrideAttribs = {};
            $.extend(this.mReadOnlyOverrideAttribs, iAttribs);
        };
        eDwHierarchyNode.prototype.mergeAttribs = function (iAttribs) {
            return eDwNodeAttributes_1.eDwNodeAttributes.mergeAttribs(this.mAttribs, iAttribs);
        };
        eDwHierarchyNode.prototype.getMergedChildrenAttribs = function (iTraverseOption, ioAccumAttrib) {
            var attrib = {};
            var childHierNodes = this.mChildren;
            var childNodeKeys = Object.keys(childHierNodes);
            if (childNodeKeys.length) {
                attrib = ioAccumAttrib || attrib;
                for (var i = 0; i < childNodeKeys.length; i++) {
                    var childHierNode = childHierNodes[childNodeKeys[i]];
                    var childAttrib = childHierNode.getAttribs();
                    eDwNodeAttributes_1.eDwNodeAttributes.mergeAttribs(attrib, childAttrib);
                    if (iTraverseOption === "All") {
                        childHierNode.getMergedChildrenAttribs(iTraverseOption, attrib);
                    }
                }
            }
            return attrib;
        };
        eDwHierarchyNode.prototype.syncAttribsWithChildren = function (iTraverseOption) {
            if (iTraverseOption === void 0) { iTraverseOption = "DirectDescendantsOnly"; }
            this.setAttribs(this.getMergedChildrenAttribs(iTraverseOption));
        };
        eDwHierarchyNode.prototype.propagateAttribsToChildren = function (iPropagatingAttribNames, iTraverseOption) {
            if (iTraverseOption === void 0) { iTraverseOption = "All"; }
            var changedHierNodes = [];
            var childHierNodes = this.mChildren;
            var childNodeKeys = Object.keys(childHierNodes);
            if (childNodeKeys.length) {
                for (var i = 0; i < childNodeKeys.length; i++) {
                    if (iPropagatingAttribNames && iPropagatingAttribNames.length) {
                        for (var _i = 0, iPropagatingAttribNames_1 = iPropagatingAttribNames; _i < iPropagatingAttribNames_1.length; _i++) {
                            var attribName = iPropagatingAttribNames_1[_i];
                            var attrib = {};
                            attrib[attribName] = this.mAttribs[attribName];
                            var childHierNode = childHierNodes[childNodeKeys[i]];
                            var changedAttribNames = childHierNode.setAttribs(attrib);
                            if (changedAttribNames.length) {
                                changedHierNodes.push(childHierNode);
                            }
                            if (iTraverseOption === "All") {
                                var childrenChangedHierNodes = childHierNode.propagateAttribsToChildren(iPropagatingAttribNames, iTraverseOption);
                                Array.prototype.push.apply(changedHierNodes, childrenChangedHierNodes);
                            }
                        }
                    }
                }
            }
            return changedHierNodes;
        };
        eDwHierarchyNode.prototype.invertAttrib = function (iAttribName) {
            this.mAttribs[iAttribName] = !this.mAttribs[iAttribName];
            return this.mAttribs;
        };
        eDwHierarchyNode.prototype.getDisplayState = function (iOtherAttribs) {
            var state = eDwNodeAttributes_1.NodeDisplayState.Invisible;
            if (this.mAttribs.Visible) {
                state = this.mAttribs.Opaque ? eDwNodeAttributes_1.NodeDisplayState.Visible
                    : eDwNodeAttributes_1.NodeDisplayState.Transparent;
                state = this.mAttribs.Opaque === undefined
                    ? eDwNodeAttributes_1.NodeDisplayState.Visible : state;
                if (iOtherAttribs) {
                    state = iOtherAttribs.Opaque === false &&
                        iOtherAttribs.Visible === false
                        ? eDwNodeAttributes_1.NodeDisplayState.Transparent : state;
                }
            }
            return state;
        };
        eDwHierarchyNode.prototype.findNodes = function (iPropName, iPropValue, iRecurse) {
            if (iRecurse === void 0) { iRecurse = true; }
            var nodes = [];
            this.getAllNodesWithPropNameAndValue(iPropName, iPropValue, nodes, iRecurse);
            return nodes;
        };
        eDwHierarchyNode.prototype.findFirstMatchingHCNode = function (iModelHC, iRootHCID) {
            var nodeHCName = iModelHC.getNodeName(iRootHCID);
            var children = iModelHC.getNodeChildren(iRootHCID);
            var grandChildren = [];
            while (children.length) {
                for (var i = 0; i < children.length; i++) {
                    nodeHCName = iModelHC.getNodeName(children[i]);
                    if (nodeHCName === this.Name) {
                        return children[i];
                    }
                    Array.prototype.push.apply(grandChildren, iModelHC.getNodeChildren(children[i]));
                }
                children = grandChildren;
                grandChildren = [];
            }
            throw new eDwResultError({
                ErrorCode: "NoNodeWithName",
                ErrorData: ["No HC node with name: " + this.Name]
            });
        };
        eDwHierarchyNode.prototype.selectBoundingBox = function (iViewer) {
            return __awaiter(this, void 0, void 0, function () {
                var model, activeModelView, modelHC, beautifulGreen, bbox, width, height, length_1, scale, vmin, vmax, p0, p1, p2, p3, polylineData, rgba, i, tmp, boxMesh, key, meshInstance, nodeID;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            model = iViewer.getModel();
                            activeModelView = model.getActiveModelView();
                            if (!(this.mModelView !== activeModelView)) return [3, 2];
                            return [4, model.activateModelView(this.mModelView.Name, iViewer.getInitCamera())];
                        case 1:
                            _a.sent();
                            _a.label = 2;
                        case 2:
                            modelHC = iViewer.getModel().getHCModel();
                            if (!this.mBoundingBoxNodeIDs.length) return [3, 3];
                            modelHC.setNodesVisibility(this.mBoundingBoxNodeIDs, true);
                            return [3, 7];
                        case 3:
                            beautifulGreen = new Communicator.Color(0, 255, 0);
                            return [4, modelHC.getNodesBounding([this.HOOPSID])];
                        case 4:
                            bbox = _a.sent();
                            width = bbox.max.x - bbox.min.x;
                            height = bbox.max.y - bbox.min.y;
                            length_1 = Math.max(width, height);
                            scale = 0.05 / 2.0;
                            vmin = new Communicator.Point3(bbox.min.x - length_1 * scale, bbox.min.y - length_1 * scale, bbox.min.z);
                            vmax = new Communicator.Point3(bbox.max.x + length_1 * scale, bbox.max.y + length_1 * scale, bbox.max.z);
                            p0 = new Communicator.Point3(vmin.x, vmin.y, vmax.z);
                            p1 = new Communicator.Point3(vmin.x, vmax.y, vmax.z);
                            p2 = new Communicator.Point3(vmax.x, vmax.y, vmax.z);
                            p3 = new Communicator.Point3(vmax.x, vmin.y, vmax.z);
                            polylineData = [
                                p0.x, p0.y, p0.z,
                                p1.x, p1.y, p1.z,
                                p2.x, p2.y, p2.z,
                                p3.x, p3.y, p3.z,
                                p0.x, p0.y, p0.z
                            ];
                            rgba = [];
                            for (i = 0; i < 5; i++) {
                                tmp = [beautifulGreen.r,
                                    beautifulGreen.g,
                                    beautifulGreen.b, 255];
                                rgba = rgba.concat(tmp);
                            }
                            boxMesh = new Communicator.MeshData();
                            boxMesh.addPolyline(polylineData, rgba);
                            return [4, modelHC.createMesh(boxMesh)];
                        case 5:
                            key = _a.sent();
                            meshInstance = new Communicator.MeshInstanceData(key);
                            return [4, modelHC.createMeshInstance(meshInstance, 0)];
                        case 6:
                            nodeID = _a.sent();
                            this.mBoundingBoxNodeIDs.push(nodeID);
                            _a.label = 7;
                        case 7: return [2];
                    }
                });
            });
        };
        eDwHierarchyNode.prototype.unSelectBoundingBox = function (iViewer) {
            if (!this.mBoundingBoxNodeIDs.length)
                return;
            var modelHC = iViewer.getModel().getHCModel();
            modelHC.setNodesVisibility(this.mBoundingBoxNodeIDs, false);
        };
        eDwHierarchyNode.prototype.getComponentCount = function () {
            function isComponent(iHierNode) {
                return iHierNode.Category === "assembly" ||
                    iHierNode.Category === "body";
            }
            var count = isComponent(this) ? 1 : 0;
            for (var hierNodeKey in this.getChildren()) {
                count += this.mChildren[hierNodeKey].getComponentCount();
            }
            return count;
        };
        eDwHierarchyNode.prototype.isSelectable = function () {
            return this.mAttribs.Selectable;
        };
        eDwHierarchyNode.prototype.isActive = function () {
            return this.mModelView === this.mModel.getActiveModelView() ? true
                : false;
        };
        eDwHierarchyNode.create = function (iAttribs) {
            return new eDwHierarchyNode("", "", iAttribs ? iAttribs : {}, null, null, null);
        };
        eDwHierarchyNode.findPropagatingAttribNames = function (iChangedAttribNames) {
            var propagatingAttribNames = eDwHierarchyNode.sPropagatingAttribNames;
            var changedPropAttribNames = [];
            for (var _i = 0, iChangedAttribNames_1 = iChangedAttribNames; _i < iChangedAttribNames_1.length; _i++) {
                var attribName = iChangedAttribNames_1[_i];
                if (propagatingAttribNames.indexOf(attribName) > -1) {
                    changedPropAttribNames.push(attribName);
                }
            }
            return changedPropAttribNames;
        };
        eDwHierarchyNode.prototype.getAllNodesWithPropNameAndValue = function (iPropName, iPropValue, ioNodes, iRecurse) {
            for (var childNodeName in this.mChildren) {
                var childNode = this.mChildren[childNodeName];
                var propValue = childNode[iPropName];
                if (propValue && propValue === iPropValue)
                    ioNodes.push(childNode);
                if (iRecurse) {
                    childNode.getAllNodesWithPropNameAndValue(iPropName, iPropValue, ioNodes);
                }
            }
        };
        eDwHierarchyNode.sPropagatingAttribNames = [
            "Visible",
            "Opaque"
        ];
        return eDwHierarchyNode;
    }());
    ;
    return eDwHierarchyNode;
});
define("eDwHierNodeAttribArray", ["require", "exports"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
});
define("eDwHistoryMgr", ["require", "exports", "utils"], function (require, exports, Utils) {
    "use strict";
    var eDwHistoryMgr = (function () {
        function eDwHistoryMgr() {
            this.clear();
        }
        eDwHistoryMgr.get = function () {
            if (!eDwHistoryMgr.sHistoryMgr) {
                eDwHistoryMgr.sHistoryMgr = new eDwHistoryMgr();
            }
            return eDwHistoryMgr.sHistoryMgr;
        };
        eDwHistoryMgr.prototype.undo = function () {
            var currStacksElem = this.getCurrStackElem();
            var currStack = currStacksElem.Stack;
            var currStackCmdIndex = currStacksElem.getCurrCmdIndex();
            if (currStackCmdIndex < 0 || currStack.length === 0) {
                console.debugLog("History", "Already before first command.");
                return null;
            }
            currStacksElem.incrementCurrCmdIndex(-1);
            var cmd = currStack[currStackCmdIndex];
            cmd.undo();
            console.debugLog("History", "Undoing command at index " + currStackCmdIndex +
                " Object type: " + Utils.getObjectTypeName(cmd));
            return cmd;
        };
        eDwHistoryMgr.prototype.redo = function () {
            var currStacksElem = this.getCurrStackElem();
            var currStack = currStacksElem.Stack;
            var nextStackCmdIndex = currStacksElem.getCurrCmdIndex() + 1;
            if (nextStackCmdIndex >= currStack.length) {
                console.debugLog("History", "Already after last command.");
                return null;
            }
            currStacksElem.incrementCurrCmdIndex(1);
            var cmd = currStack[nextStackCmdIndex];
            cmd.redo();
            console.debugLog("History", "Redoing command at index " + nextStackCmdIndex +
                " Object type: " + Utils.getObjectTypeName(cmd));
            return cmd;
        };
        eDwHistoryMgr.prototype.push = function (iCmd) {
            if (!iCmd)
                return;
            var currStacksElem = this.getCurrStackElem();
            var currStack = currStacksElem.Stack;
            var currStackSize = currStack.length;
            var currStackCmdIndex = currStacksElem.getCurrCmdIndex();
            if (currStackCmdIndex !== currStackSize - 1) {
                currStack.splice(currStackCmdIndex + 1);
                console.debugLog("History", "Truncated history to " +
                    (currStackCmdIndex + 1) + " elements.");
            }
            currStack.push(iCmd);
            currStacksElem.incrementCurrCmdIndex(1);
            console.debugLog("History", "Adding command to history at index " +
                (currStackCmdIndex + 1) + " Object Type = " +
                Utils.getObjectTypeName(iCmd) + ".");
        };
        eDwHistoryMgr.prototype.clear = function () {
            console.debugLog("History", "Clear all history.");
            this.mCmdStacksStack = [];
            this.pushStack();
        };
        eDwHistoryMgr.prototype.pushStack = function () {
            console.debugLog("History", "Add a new history stack at index " +
                this.mCmdStacksStack.length + ".");
            this.mCmdStacksStack.push(new eDwCmdStacksElem());
        };
        eDwHistoryMgr.prototype.popStack = function () {
            console.debugLog("History", "Remove history stack at index " +
                (this.mCmdStacksStack.length - 1) + ".");
            var activeCmds = [];
            var currStackElem = this.mCmdStacksStack.pop();
            var currCmdIndex = currStackElem.getCurrCmdIndex();
            for (var i = 0; i < currCmdIndex; i++) {
                activeCmds.push(currStackElem.Stack[i]);
            }
            return activeCmds;
        };
        eDwHistoryMgr.prototype.getCurrStackElem = function () {
            return this.mCmdStacksStack[this.mCmdStacksStack.length - 1];
        };
        return eDwHistoryMgr;
    }());
    ;
    var eDwCmdStacksElem = (function () {
        function eDwCmdStacksElem() {
            this.mCmdStack = [];
            this.mCurrCmdIndex = -1;
        }
        Object.defineProperty(eDwCmdStacksElem.prototype, "Stack", {
            get: function () {
                return this.mCmdStack;
            },
            enumerable: true,
            configurable: true
        });
        eDwCmdStacksElem.prototype.getCurrCmdIndex = function () {
            return this.mCurrCmdIndex;
        };
        eDwCmdStacksElem.prototype.incrementCurrCmdIndex = function (iIndex) {
            if (typeof iIndex !== "number")
                return;
            this.mCurrCmdIndex += iIndex;
        };
        return eDwCmdStacksElem;
    }());
    ;
    return eDwHistoryMgr;
});
define("eDwKeyMgr", ["require", "exports", "eDwUIHTMLEventMgr"], function (require, exports, eDwUIHTMLEventMgr) {
    "use strict";
    var eDwKeyMgr = (function () {
        function eDwKeyMgr() {
            var _this = this;
            window.frames.focus();
            this.mUIHTMLEventMgr = new eDwUIHTMLEventMgr();
            var processKeyEventFunc = function (iEvent) {
                if (iEvent.type === "keydown")
                    _this.mDownKeys[iEvent.key] = true;
                else if (iEvent.type == "keyup")
                    delete _this.mDownKeys[iEvent.key];
                var eventHandlers = _this.mKeyEventHandlers[iEvent.type][iEvent.key];
                for (var i in eventHandlers) {
                    var eventHandler = eventHandlers[i];
                    if (isEqual(iEvent, eventHandler.Modifiers)) {
                        eventHandler.KeyFunc(iEvent);
                    }
                }
            };
            this.mUIHTMLEventMgr.addEventHandler("document", "keydown", processKeyEventFunc);
            this.mUIHTMLEventMgr.addEventHandler("document", "keyup", processKeyEventFunc);
            this.mUIHTMLEventMgr.addEventHandler("document", "keypress", processKeyEventFunc);
            this.mKeyEventHandlers = {};
            this.mKeyEventHandlers["keydown"] = {};
            this.mKeyEventHandlers["keyup"] = {};
            this.mKeyEventHandlers["keypress"] = {};
            this.mDownKeys = {};
        }
        eDwKeyMgr.get = function () {
            if (!eDwKeyMgr.sKeyMgr) {
                eDwKeyMgr.sKeyMgr = new eDwKeyMgr();
            }
            return eDwKeyMgr.sKeyMgr;
        };
        eDwKeyMgr.prototype.add = function (iKeyInfo, iEventName, iFunc) {
            var eventHandlers = this.mKeyEventHandlers[iEventName][iKeyInfo.key];
            if (!eventHandlers) {
                eventHandlers =
                    this.mKeyEventHandlers[iEventName][iKeyInfo.key] = {};
            }
            var numKeys = Object.keys(eventHandlers).length;
            this.mKeyEventHandlers[iEventName][iKeyInfo.key][numKeys] =
                { Modifiers: iKeyInfo, KeyFunc: iFunc };
            return numKeys;
        };
        eDwKeyMgr.prototype.remove = function (iKey, iEventName, iCallbackIndex) {
            delete this.mKeyEventHandlers[iEventName][iKey][iCallbackIndex];
        };
        eDwKeyMgr.prototype.isDown = function (iKey) {
            return this.mDownKeys[iKey] ? true : false;
        };
        eDwKeyMgr.prototype.isLMBPressed = function (iEvent) {
            return iEvent.which === 1 || iEvent.button === 1 ? true : false;
        };
        eDwKeyMgr.prototype.isMMBPressed = function (iEvent) {
            return iEvent.which === 2 || iEvent.button === 4 ? true : false;
        };
        eDwKeyMgr.prototype.isRMBPressed = function (iEvent) {
            return iEvent.which === 3 || iEvent.button === 2 ? true : false;
        };
        return eDwKeyMgr;
    }());
    ;
    ;
    function isEqual(iKey1, iKey2) {
        var numMatch = 0;
        var compareFields = ["altKey", "ctrlKey", "metaKey", "shiftKey"];
        for (var _i = 0, compareFields_1 = compareFields; _i < compareFields_1.length; _i++) {
            var i = compareFields_1[_i];
            if (iKey1[i] === iKey2[i])
                ++numMatch;
        }
        return numMatch === Object.keys(iKey2).length - 1 ? true : false;
    }
    return eDwKeyMgr;
});
define("eDwMarkupItem", ["require", "exports", "eDwTypes", "eDrawingsBase"], function (require, exports, eDwTypes_4) {
    "use strict";
    var eDwMarkupItem = (function (_super) {
        __extends(eDwMarkupItem, _super);
        function eDwMarkupItem(iViewer) {
            var _this = _super.call(this) || this;
            _this.mPoints = [];
            _this.mLeagalPointNum = 2;
            _this = _super.call(this) || this;
            _this.mViewer = iViewer;
            _this.mModel = _this.mViewer.getModel();
            var dummyMax = new eDwTypes_4.HC.Point2(0, 0);
            var dummyMin = new eDwTypes_4.HC.Point2(0, 0);
            _this.mShape = new eDwTypes_4.HC.Markup.Shape.Rectangle(dummyMax, dummyMin);
            return _this;
        }
        eDwMarkupItem.prototype.remove = function () {
            this.mPoints = [];
        };
        eDwMarkupItem.prototype.draw = function () {
            if (this.mLeagalPointNum !== this.mPoints.length)
                return;
            var renderer = this.mViewer.getMarkupManager().getRenderer();
            renderer.drawRectangle(this.mShape);
        };
        eDwMarkupItem.prototype.projectPoints = function () {
            if (this.mLeagalPointNum !== this.mPoints.length)
                return;
            var view = this.mViewer.getView();
            var p0 = eDwTypes_4.HC.Point2.fromPoint3(view.projectPoint(this.mPoints[0]));
            var p1 = eDwTypes_4.HC.Point2.fromPoint3(view.projectPoint(this.mPoints[1]));
            var pMax = new eDwTypes_4.HC.Point2(Math.max(p0.x, p1.x), Math.max(p0.y, p1.y));
            var pMin = new eDwTypes_4.HC.Point2(Math.min(p0.x, p1.x), Math.min(p0.y, p1.y));
        };
        eDwMarkupItem.prototype.addPoint = function (point) {
            if (this.mPoints.length < this.mLeagalPointNum) {
                this.mPoints.push(point);
                return true;
            }
            return false;
        };
        eDwMarkupItem.prototype.onSelect = function () {
        };
        eDwMarkupItem.prototype.onDeselect = function () {
        };
        eDwMarkupItem.prototype.getClassName = function () {
            return "eDwMarkupItem";
        };
        return eDwMarkupItem;
    }(eDwTypes_4.HC.Markup.MarkupItem));
    ;
    return eDwMarkupItem;
});
define("eDwMarkupMgr", ["require", "exports", "eDwMarkupOperator", "eDwServiceMgr", "eDwRedlineOperator", "eDrawingsBase"], function (require, exports, eDwMarkupOperator, eDwServiceMgr, eDwRedlineOperator) {
    "use strict";
    var cMarkupJSONFileName = "edw_markup.json";
    var eDwMarkupMgr = (function () {
        function eDwMarkupMgr(iViewer) {
            iViewer.MarkupMgr = this;
            this.mViewer = iViewer;
            this.mMarkupOp = new eDwMarkupOperator(iViewer, this);
            this.mMarkupOpID =
                iViewer.OperatorMgr.registerCustomOperator(this.mMarkupOp);
        }
        eDwMarkupMgr.prototype.unregister = function () {
            this.mViewer.OperatorMgr.unregisterCustomOperatorByID(this.mMarkupOpID);
            this.mViewer.MarkupMgr = null;
        };
        eDwMarkupMgr.prototype.addMarkup = function (iNewMarkupID) {
            if (!this.mMarkupArray) {
                this.mMarkupArray = [];
            }
            this.mMarkupArray.push(iNewMarkupID);
        };
        eDwMarkupMgr.prototype.activateMarkup = function () {
            var viewer = this.mViewer;
            var opMgr = viewer.OperatorMgr;
            opMgr.push(this.mMarkupOpID);
            console.debugLog("Markup", "Markup Activated : )");
        };
        eDwMarkupMgr.prototype.deactivateMarkup = function () {
            var viewer = this.mViewer;
            var opMgr = viewer.OperatorMgr;
            if (opMgr.getActiveOperatorID() === this.mMarkupOpID) {
                opMgr.pop();
            }
            console.debugLog("Markup", "Markup Dectivated : (");
        };
        eDwMarkupMgr.prototype.setMarkupMode = function (mode) {
            this.mMarkupMode = mode;
            this.mMarkupOp.setMarkupMode(mode);
        };
        eDwMarkupMgr.prototype.getMarkupMode = function () {
            return this.mMarkupMode;
        };
        eDwMarkupMgr.prototype.getOperator = function () {
            return this.mMarkupOp;
        };
        eDwMarkupMgr.prototype.readFromCache = function () {
            return __awaiter(this, void 0, void 0, function () {
                var modelKey, markupData, iExcp_5;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            modelKey = this.mViewer.getCurrModelKey();
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            return [4, eDwServiceMgr.get().readMarkup(modelKey, cMarkupJSONFileName)];
                        case 2:
                            markupData = _a.sent();
                            this.reconstructView(markupData);
                            return [3, 4];
                        case 3:
                            iExcp_5 = _a.sent();
                            return [3, 4];
                        case 4: return [2];
                    }
                });
            });
        };
        eDwMarkupMgr.prototype.saveToCache = function () {
            return __awaiter(this, void 0, void 0, function () {
                var modelKey, viewerHC, markupMgr, markupJSON, markupJSONStr, input, inputStr, iExcp_6;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            modelKey = this.mViewer.getCurrModelKey();
                            if (!modelKey ||
                                !this.mViewer.ViewerFeatureOpts.DeleteModelCacheFileWhenDone) {
                                return [2];
                            }
                            viewerHC = this.mViewer.HCViewer;
                            markupMgr = viewerHC.getMarkupManager();
                            markupJSON = markupMgr.exportMarkup();
                            markupJSONStr = JSON.stringify(markupJSON);
                            input = {
                                iModelKey: modelKey,
                                iName: cMarkupJSONFileName,
                                iData: markupJSONStr
                            };
                            inputStr = JSON.stringify(input);
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            return [4, eDwServiceMgr.get().writeMarkup({
                                    data: inputStr,
                                    dataType: "json",
                                    contentType: "application/json"
                                })];
                        case 2:
                            _a.sent();
                            return [3, 4];
                        case 3:
                            iExcp_6 = _a.sent();
                            console.debugLog("Markup", "FAILED -- model: " + modelKey);
                            return [3, 4];
                        case 4: return [2];
                    }
                });
            });
        };
        eDwMarkupMgr.prototype.getOp = function () {
            var op = this.mViewer.OperatorMgr.getOperator(this.mMarkupOpID);
            return op;
        };
        eDwMarkupMgr.prototype.reconstructView = function (iMarkupData) {
            eDwRedlineOperator.constructView(iMarkupData, this.mViewer.HCViewer);
        };
        return eDwMarkupMgr;
    }());
    ;
    return eDwMarkupMgr;
});
define("eDwMarkupOperator", ["require", "exports", "eDwBaseOperator", "eDwRedlineOperator", "eDwTypes", "eDrawingsBase"], function (require, exports, eDwBaseOperator, eDwRedlineOperator, eDwTypes_5) {
    "use strict";
    var eDwMarkupOperator = (function (_super) {
        __extends(eDwMarkupOperator, _super);
        function eDwMarkupOperator(iViewer, iMarkupMgr) {
            var _this = _super.call(this, iViewer) || this;
            _this.mIsDrawing = true;
            _this.mViewer = iViewer;
            _this.mViewerHC = iViewer.HCViewer;
            _this.mMarkupMgr = iMarkupMgr;
            _this.mHCMarkupMgr = _this.mViewerHC.getMarkupManager();
            _this.mMarkupOperator = new eDwRedlineOperator(iViewer);
            _this.mMarkupOperator.setMarkupMode(iMarkupMgr.getMarkupMode());
            return _this;
        }
        eDwMarkupOperator.prototype.setMarkupMode = function (mode) {
            this.mMarkupMode = mode;
            this.mMarkupOperator.setMarkupMode(mode);
        };
        eDwMarkupOperator.prototype.onActivate = function () {
            _super.prototype.onActivate.call(this);
            this.mMarkupOperator.onActivate();
        };
        eDwMarkupOperator.prototype.onDeactivate = function () {
            _super.prototype.onDeactivate.call(this);
            this.mMarkupOperator.onDeactivate();
        };
        eDwMarkupOperator.prototype.onMouseMove = function (iEvent) {
            _super.prototype.onMouseMove.call(this, iEvent);
            if (eDwTypes_5.MarkupMode.None !== this.mMarkupMode) {
                this.mMarkupOperator.onMouseMove(iEvent);
                iEvent.setHandled(true);
            }
        };
        eDwMarkupOperator.prototype.onMouseDown = function (iEvent) {
            _super.prototype.onMouseDown.call(this, iEvent);
            if (eDwTypes_5.MarkupMode.None !== this.mMarkupMode) {
                this.mMarkupOperator.onMouseDown(iEvent);
                iEvent.setHandled(true);
            }
        };
        eDwMarkupOperator.prototype.onMouseUp = function (iEvent) {
            _super.prototype.onMouseUp.call(this, iEvent);
            if (eDwTypes_5.MarkupMode.None !== this.mMarkupMode) {
                this.mMarkupOperator.onMouseUp(iEvent);
                iEvent.setHandled(true);
            }
        };
        eDwMarkupOperator.prototype.onTouchStart = function (ioTouchEvent) {
            var _this = this;
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_5.HC.MouseInputType.Down, function (ioMouseEvent) {
                _this.onMouseDown(ioMouseEvent);
            });
        };
        eDwMarkupOperator.prototype.onTouchMove = function (ioTouchEvent) {
            var _this = this;
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_5.HC.MouseInputType.Move, function (ioMouseEvent) {
                _this.onMouseMove(ioMouseEvent);
            });
        };
        eDwMarkupOperator.prototype.onTouchEnd = function (ioTouchEvent) {
            var _this = this;
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_5.HC.MouseInputType.Up, function (ioMouseEvent) {
                _this.onMouseUp(ioMouseEvent);
            });
        };
        eDwMarkupOperator.prototype.setCurAnnotation = function (str) {
            this.mMarkupOperator.setCurAnnotation(str);
        };
        return eDwMarkupOperator;
    }(eDwBaseOperator));
    ;
    return eDwMarkupOperator;
});
define("eDwMBDNoteMgr", ["require", "exports", "eDwTypes", "eDwBaseOperator", "eDrawingsBase"], function (require, exports, eDwTypes_6, eDwBaseOperator) {
    "use strict";
    var MBDNote = (function () {
        function MBDNote(iViewer, refPos, curPos, nodeId) {
            this.mDrawBounding = false;
            this.mBoundingId = 0;
            var modelHC = iViewer.getModel().getHCModel();
            var viewHC = iViewer.getHCView();
            this.mViewer = iViewer;
            this.mRefPos = refPos.copy();
            this.mNodeId = nodeId;
            var rPos2 = eDwTypes_6.HC.Point2.fromPoint3(iViewer.getHCView().projectPoint(this.mRefPos));
            var cPos2 = eDwTypes_6.HC.Point2.fromPoint3(iViewer.getHCView().projectPoint(curPos));
            this.mOffset = eDwTypes_6.HC.Point2.subtract(cPos2, rPos2);
            var rPos3 = eDwBaseOperator.screenToWorld(rPos2, viewHC);
            var cPos3 = eDwBaseOperator.screenToWorld(cPos2, viewHC);
            this.mOffsetLen = eDwTypes_6.HC.Point3.subtract(cPos3, rPos3).length();
            var cDelta = eDwTypes_6.HC.Point3.subtract(cPos3, curPos);
            var matrix = new eDwTypes_6.HC.Matrix();
            matrix.loadIdentity();
            matrix.setTranslationComponent(cDelta.x, cDelta.y, cDelta.z);
            var nodeMatrix = modelHC.getNodeMatrix(nodeId);
            nodeMatrix = eDwTypes_6.HC.Matrix.multiply(nodeMatrix, matrix);
            modelHC.setNodeMatrix(nodeId, nodeMatrix);
            this.mOrigPos = cPos3.copy();
            var camera = this.mViewer.getHCView().getCamera();
            this.mOrigCamMatrix = camera.getMatrixFromCamera().copy();
            this.mOrigModMatrix = modelHC.getNodeMatrix(nodeId);
        }
        MBDNote.prototype.updatePos = function () {
            var viewHC = this.mViewer.getHCView();
            var modelHC = this.mViewer.getModel().getHCModel();
            var rPos2 = eDwTypes_6.HC.Point2.fromPoint3(this.mViewer.getHCView().projectPoint(this.mRefPos));
            var cPos2 = eDwTypes_6.HC.Point2.add(rPos2, this.mOffset);
            var rPos3 = eDwBaseOperator.screenToWorld(rPos2, viewHC);
            var cPos3 = eDwBaseOperator.screenToWorld(cPos2, viewHC);
            var crDelta = eDwTypes_6.HC.Point3.subtract(cPos3, rPos3);
            crDelta.normalize();
            crDelta.scale(this.mOffsetLen);
            cPos3 = eDwTypes_6.HC.Point3.add(rPos3, crDelta);
            var posDelta = eDwTypes_6.HC.Point3.subtract(cPos3, this.mOrigPos);
            var revTransMat = new eDwTypes_6.HC.Matrix(), transMat = new eDwTypes_6.HC.Matrix(), extraTransMat = new eDwTypes_6.HC.Matrix();
            revTransMat.setTranslationComponent(-this.mOrigPos.x, -this.mOrigPos.y, -this.mOrigPos.z);
            transMat.setTranslationComponent(this.mOrigPos.x, this.mOrigPos.y, this.mOrigPos.z);
            extraTransMat.setTranslationComponent(posDelta.x, posDelta.y, posDelta.z);
            this.mOrigPos = cPos3.copy();
            var nodeMatrix = this.mOrigModMatrix.copy();
            var camera = viewHC.getCamera();
            var curCamMatrix = camera.getMatrixFromCamera().copy();
            var curCamMatrixR = curCamMatrix.inverseAndDeterminant()[0];
            var matrix0 = eDwTypes_6.HC.Matrix.multiply(eDwTypes_6.HC.Matrix.multiply(nodeMatrix, this.mOrigCamMatrix), curCamMatrixR);
            var oriCamMatrix = this.mOrigCamMatrix.copy();
            var oriCamMatrixR = oriCamMatrix.inverseAndDeterminant()[0];
            this.mOrigCamMatrix = curCamMatrix.copy();
            var rotMatrix = eDwTypes_6.HC.Matrix.multiply(revTransMat, oriCamMatrixR);
            rotMatrix = eDwTypes_6.HC.Matrix.multiply(rotMatrix, curCamMatrix);
            rotMatrix = eDwTypes_6.HC.Matrix.multiply(rotMatrix, transMat);
            rotMatrix = eDwTypes_6.HC.Matrix.multiply(rotMatrix, extraTransMat);
            nodeMatrix = modelHC.getNodeMatrix(this.mNodeId);
            nodeMatrix = eDwTypes_6.HC.Matrix.multiply(nodeMatrix, rotMatrix);
            modelHC.setNodeMatrix(this.mNodeId, nodeMatrix, false);
        };
        MBDNote.prototype.printMatrix = function (matrix) {
            console.log("MATRIX PRINT");
            console.log("Det = " + matrix.inverseAndDeterminant()[1]);
            for (var i = 0; i < 4; ++i) {
                var str = "";
                for (var j = 0; j < 4; ++j) {
                    str += matrix.m[i * 4 + j] + " , ";
                }
                console.log(str);
            }
        };
        return MBDNote;
    }());
    var eDwMBDNoteMgr = (function () {
        function eDwMBDNoteMgr(iViewer) {
            this.mNotes = [];
            this.mIndices = [];
            this.mViewer = iViewer;
            this.mOverLayerMgr = this.mViewer.HCViewer.getOverlayManager();
            var box = this.mViewer.getModel().getBoundingBox();
            this.mRefer = box.center().copy();
        }
        eDwMBDNoteMgr.prototype.addNote = function (nodeId, refBox) {
            var _this = this;
            (function () { return __awaiter(_this, void 0, void 0, function () {
                var box;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.mViewer.getModel().getHCModel().getNodesBounding([nodeId])];
                        case 1:
                            box = _a.sent();
                            this.mNotes.push(new MBDNote(this.mViewer, refBox.center(), box.center(), nodeId));
                            return [2];
                    }
                });
            }); })();
            return true;
        };
        eDwMBDNoteMgr.prototype.updateNote = function () {
            var len = this.mNotes.length;
            for (var i = 0; i < len; ++i) {
                this.mNotes[i].updatePos();
            }
        };
        return eDwMBDNoteMgr;
    }());
    ;
    return eDwMBDNoteMgr;
});
define("eDwMeasureEntities", ["require", "exports", "eDwEventMgr", "eDwTypes", "eDwBaseOperator", "eDrawingsBase"], function (require, exports, eDwEventMgr, eDwTypes_7, eDwBaseOperator) {
    "use strict";
    var MeasureType;
    (function (MeasureType) {
        MeasureType[MeasureType["None"] = 0] = "None";
        MeasureType[MeasureType["Angle"] = 1] = "Angle";
        MeasureType[MeasureType["Distance"] = 2] = "Distance";
        MeasureType[MeasureType["Coordinate"] = 4] = "Coordinate";
    })(MeasureType || (MeasureType = {}));
    ;
    var AuxLineType;
    (function (AuxLineType) {
        AuxLineType[AuxLineType["Regular"] = 0] = "Regular";
        AuxLineType[AuxLineType["Dist"] = 1] = "Dist";
    })(AuxLineType || (AuxLineType = {}));
    ;
    var ValueType;
    (function (ValueType) {
        ValueType[ValueType["Distance"] = 0] = "Distance";
        ValueType[ValueType["Angle"] = 1] = "Angle";
        ValueType[ValueType["Text"] = 3] = "Text";
    })(ValueType || (ValueType = {}));
    ;
    var eDwLineDistColor = new eDwTypes_7.HC.Color(50, 50, 50);
    var eDwLengthTolerance = 1e-6;
    var eDwAngleTolerance = 1e-4;
    var eDwLabelItem = (function (_super) {
        __extends(eDwLabelItem, _super);
        function eDwLabelItem(iViewer, iLabel) {
            var _this = _super.call(this) || this;
            _this.mViewer = iViewer;
            _this.mLabel = iLabel;
            return _this;
        }
        eDwLabelItem.prototype.setStringContent = function (iUnit) {
            this.mLabel.setStringContent(iUnit);
        };
        eDwLabelItem.prototype.draw = function () {
            this.mLabel.drawLabel();
        };
        eDwLabelItem.prototype.hit = function (iPos) {
            var box = this.mLabel.getLabelBox();
            var xMin = box.Min.x;
            var xMax = box.Max.x;
            var yMin = box.Min.y;
            var yMax = box.Max.y;
            return (iPos.x <= xMax && iPos.x >= xMin && iPos.y <= yMax &&
                iPos.y >= yMin);
        };
        eDwLabelItem.prototype.onDragStart = function (iPos) {
            this.mDragPos = iPos.copy();
            return true;
        };
        eDwLabelItem.prototype.onDragMove = function (iPos) {
            var delta = eDwTypes_7.HC.Point2.subtract(iPos, this.mDragPos);
            var endPos = this.mLabel.getLeaderEndPos();
            endPos.add(delta);
            this.mLabel.setLeaderEndPos(endPos);
            this.mDragPos = iPos.copy();
            return true;
        };
        eDwLabelItem.prototype.onDragEnd = function (iPos) {
            return true;
        };
        return eDwLabelItem;
    }(eDwTypes_7.HC.Markup.MarkupItem));
    ;
    var eDwMeasureUtils = (function () {
        function eDwMeasureUtils() {
        }
        eDwMeasureUtils.getAngle = function (iV0, iV1) {
            var vec0 = iV0.copy();
            var vec1 = iV1.copy();
            vec0.normalize();
            vec1.normalize();
            var dotVal = eDwTypes_7.HC.Point3.dot(vec0, vec1);
            if (0 === dotVal)
                return 90;
            dotVal = Math.min(dotVal, 1);
            dotVal = Math.max(dotVal, -1);
            var angle = Math.acos(dotVal);
            var angleDgree = angle * 180 / Math.PI;
            var n = eDwTypes_7.HC.Point3.cross(vec0, vec1);
            n.normalize();
            if (isNaN(n.x) || isNaN(n.y) || isNaN(n.z))
                return 0;
            if (Math.abs(angleDgree) < eDwAngleTolerance) {
                angleDgree = 0;
            }
            if (Math.abs(angleDgree - 90) < eDwAngleTolerance) {
                angleDgree = 90;
            }
            if (Math.abs(angleDgree - 180) < eDwAngleTolerance) {
                angleDgree = 180;
            }
            return angleDgree;
        };
        eDwMeasureUtils.getRealCylinderProperties = function (iItemObj, iCylinderInitial, iCylinderReal, iModelHC) {
            var matrix = iModelHC.getNodeNetMatrix(iItemObj.getNodeId());
            iCylinderReal.origin = iCylinderInitial.origin.copy();
            matrix.transform(iCylinderReal.origin, iCylinderReal.origin);
            iCylinderReal.radius = iCylinderInitial.radius;
            iCylinderReal.normal = iCylinderInitial.normal.copy();
        };
        eDwMeasureUtils.getRealPlaneProperties = function (iItemObj, iPlaneInitial, iPlaneReal, iModelHC) {
            var matrix = iModelHC.getNodeNetMatrix(iItemObj.getNodeId());
            iPlaneReal.origin = iPlaneInitial.origin.copy();
            matrix.transform(iPlaneReal.origin, iPlaneReal.origin);
            iPlaneReal.normal = iPlaneInitial.normal.copy();
            var coordOrigin = new eDwTypes_7.HC.Point3(0, 0, 0);
            var selNormal = iItemObj.getFaceEntity().getNormal();
            iPlaneReal.normal = selNormal.copy();
            iPlaneReal.normal.normalize();
        };
        eDwMeasureUtils.getRealCircleProperties = function (iItemObj, iCircleInitial, iCircleReal, iModelHC) {
            var matrix = iModelHC.getNodeNetMatrix(iItemObj.getNodeId());
            iCircleReal.origin = iCircleInitial.origin.copy();
            matrix.transform(iCircleReal.origin, iCircleReal.origin);
            iCircleReal.radius = iCircleInitial.radius;
        };
        eDwMeasureUtils.getRealLinePoints = function (iItemObj, iModelHC) {
            var line = iItemObj.getLineEntity();
            var points = line.getPoints();
            var n = points.length;
            var p0 = points[0].copy();
            var p1 = points[n - 1].copy();
            return { A: p0, B: p1 };
        };
        eDwMeasureUtils.closestPoints = function (iSet0, iSet1) {
            var p0 = iSet0[0].copy();
            var p1 = iSet1[0].copy();
            var minDist = eDwTypes_7.HC.Point3.subtract(iSet0[0], iSet1[0]).length();
            for (var i = 0; i < iSet0.length; ++i) {
                for (var j = 0; j < iSet1.length; ++j) {
                    var dist = eDwTypes_7.HC.Point3.subtract(iSet0[i], iSet1[j]).length();
                    if (dist < minDist) {
                        p0.assign(iSet0[i]);
                        p1.assign(iSet1[j]);
                        minDist = dist;
                    }
                }
            }
            return { P0: p0, P1: p1 };
        };
        eDwMeasureUtils.distanceLineLineCross = function (iLine0, iLine1) {
            var v0 = eDwTypes_7.HC.Point3.subtract(iLine0.A, iLine0.B);
            var v1 = eDwTypes_7.HC.Point3.subtract(iLine1.A, iLine1.B);
            v0.normalize();
            v1.normalize();
            var n = eDwTypes_7.HC.Point3.cross(v0, v1);
            n.normalize();
            var tmpArray = [
                v0.x, -1 * v1.x, -1 * n.x, 0,
                v0.y, -1 * v1.y, -1 * n.y, 0,
                v0.z, -1 * v1.z, -1 * n.z, 0,
                0, 0, 0, 1
            ];
            var matrix = eDwTypes_7.HC.Matrix.createFromArray(tmpArray);
            var inv = eDwTypes_7.HC.Matrix.inverse(matrix);
            inv = matrix.inverseAndDeterminant()[0];
            var vector = eDwTypes_7.HC.Point3.subtract(iLine1.A, iLine0.A);
            var a = inv.m[0] * vector.x + inv.m[1] * vector.y + inv.m[2] * vector.z;
            var b = inv.m[4] * vector.x + inv.m[5] * vector.y + inv.m[6] * vector.z;
            var orig0 = eDwTypes_7.HC.Point3.add(iLine0.A, eDwTypes_7.HC.Point3.scale(v0, a));
            var orig1 = eDwTypes_7.HC.Point3.add(iLine1.A, eDwTypes_7.HC.Point3.scale(v1, b));
            var p0A = eDwTypes_7.HC.Point3.subtract(iLine0.A, orig0);
            var p0B = eDwTypes_7.HC.Point3.subtract(iLine0.B, orig0);
            var pSet0 = [iLine0.A.copy(), iLine0.B.copy()];
            if (eDwTypes_7.HC.Point3.dot(p0A, p0B) < 0)
                pSet0.push(orig0);
            var p1A = eDwTypes_7.HC.Point3.subtract(iLine1.A, orig1);
            var p1B = eDwTypes_7.HC.Point3.subtract(iLine1.B, orig1);
            var pSet1 = [iLine1.A.copy(), iLine1.B.copy()];
            if (eDwTypes_7.HC.Point3.dot(p1A, p1B) < 0)
                pSet1.push(orig1);
            var p0 = new eDwTypes_7.HC.Point3(0, 0, 0);
            var p1 = new eDwTypes_7.HC.Point3(0, 0, 0);
            if (eDwTypes_7.HC.Point3.dot(p1A, p1B) > 0 || eDwTypes_7.HC.Point3.dot(p0A, p0B) > 0) {
                var cp01 = eDwMeasureUtils.closestPoints(pSet0, pSet1);
                p0.assign(cp01.P0);
                p1.assign(cp01.P1);
            }
            else {
                p0.assign(orig0);
                p1.assign(orig1);
            }
            return { Cp0: orig0, Cp1: orig1, P0: p0, P1: p1 };
        };
        eDwMeasureUtils.distanceLineLinePara = function (iLine0, iLine1, iP0, iP1) {
            var v0 = eDwTypes_7.HC.Point3.subtract(iLine0.A, iLine0.B);
            var v1 = eDwTypes_7.HC.Point3.subtract(iLine1.A, iLine1.B);
            v0.normalize();
            v1.normalize();
            var n = eDwTypes_7.HC.Point3.cross(v0, v1);
            n.normalize();
            var k = 0;
            var p10 = new eDwTypes_7.HC.Point3(0, 0, 0);
            k = eDwTypes_7.HC.Point3.dot(v0, eDwTypes_7.HC.Point3.subtract(iP1, iP0)) /
                eDwTypes_7.HC.Point3.dot(v0, v0);
            p10 = eDwTypes_7.HC.Point3.add(iP0, eDwTypes_7.HC.Point3.scale(v0, k));
            var p0A1 = eDwTypes_7.HC.Point3.subtract(iLine0.A, p10);
            var p0B1 = eDwTypes_7.HC.Point3.subtract(iLine0.B, p10);
            var pA0 = new eDwTypes_7.HC.Point3(0, 0, 0);
            k = eDwTypes_7.HC.Point3.dot(v0, eDwTypes_7.HC.Point3.subtract(iLine1.A, iP0)) /
                eDwTypes_7.HC.Point3.dot(v0, v0);
            pA0 = eDwTypes_7.HC.Point3.add(iP0, eDwTypes_7.HC.Point3.scale(v0, k));
            var p0AA = eDwTypes_7.HC.Point3.subtract(iLine0.A, p10);
            var p0BA = eDwTypes_7.HC.Point3.subtract(iLine0.B, p10);
            var pB0 = new eDwTypes_7.HC.Point3(0, 0, 0);
            k = eDwTypes_7.HC.Point3.dot(v0, eDwTypes_7.HC.Point3.subtract(iLine1.B, iP0)) /
                eDwTypes_7.HC.Point3.dot(v0, v0);
            pB0 = eDwTypes_7.HC.Point3.add(iP0, eDwTypes_7.HC.Point3.scale(v0, k));
            var p0AB = eDwTypes_7.HC.Point3.subtract(iLine0.A, p10);
            var p0BB = eDwTypes_7.HC.Point3.subtract(iLine0.B, p10);
            var orig0;
            var orig1;
            var pp0;
            var pp1;
            if (eDwTypes_7.HC.Point3.dot(p0A1, p0B1) < 0) {
                orig1 = iP1.copy();
                orig0 = p10.copy();
                pp1 = iP1.copy();
                pp0 = p10.copy();
            }
            else if (eDwTypes_7.HC.Point3.dot(p0AA, p0BA) < 0) {
                orig1 = iLine1.A.copy();
                orig0 = pA0.copy();
                pp1 = iLine1.A.copy();
                pp0 = pA0.copy();
            }
            else if (eDwTypes_7.HC.Point3.dot(p0A1, p0B1) < 0) {
                orig1 = iLine1.B.copy();
                orig0 = pB0.copy();
                pp1 = iLine1.B.copy();
                pp0 = pB0.copy();
            }
            else {
                var tmp = eDwMeasureUtils.closestPoints([iLine1.A, iLine1.B], [iLine0.A, iLine0.B]);
                orig1 = iP1;
                orig0 = p10;
                pp1 = tmp.P0;
                pp0 = tmp.P1;
            }
            return { Cp0: orig0, Cp1: orig1, P0: pp0, P1: pp1 };
        };
        eDwMeasureUtils.adjustLeaderEndByStart = function (iPoints) {
            if (0 === iPoints.length)
                return [];
            function computeAngle(iVect) {
                var angle = Math.atan2(iVect.y, iVect.x);
                var degrees = 180 * angle / Math.PI;
                return (360 + Math.round(degrees)) % 360;
            }
            function compare(iA, iB) {
                if (iA.ang < iB.ang)
                    return -1;
                if (iA.ang > iB.ang)
                    return 1;
                return 0;
            }
            var targetRadius = 120;
            var center = new eDwTypes_7.HC.Point2(0, 0);
            for (var i = 0; i < iPoints.length; ++i) {
                center.add(iPoints[i]);
            }
            if (1 === iPoints.length) {
                var vec = new eDwTypes_7.HC.Point2(targetRadius, targetRadius);
                return [eDwTypes_7.HC.Point2.add(iPoints[0], vec)];
            }
            else {
                center.set(center.x / iPoints.length, center.y / iPoints.length);
            }
            var angles = [];
            for (var i = 0; i < iPoints.length; ++i) {
                var vec = new eDwTypes_7.HC.Point2(iPoints[i].x - center.x, iPoints[i].y - center.y);
                angles.push({ 'idx': i, 'ang': computeAngle(vec) });
            }
            angles.sort(compare);
            var tmp = 0;
            for (var i = 1; i < iPoints.length; ++i) {
                tmp = tmp + (angles[i].ang - angles[0].ang) - 180;
            }
            angles[0].ang = angles[0].ang + tmp / iPoints.length;
            var deltaAng = 360 / iPoints.length;
            for (var i = 1; i < iPoints.length; ++i) {
                angles[i].ang = angles[i - 1].ang + deltaAng;
            }
            var leaderVec = new Array(iPoints.length);
            for (var i = 0; i < iPoints.length; ++i) {
                var idx = angles[i].idx;
                var angle = angles[i].ang % 360;
                angle = angle * Math.PI / 180;
                var vec = new eDwTypes_7.HC.Point2(Math.cos(angle), Math.sin(angle));
                vec = vec.scale(targetRadius);
                leaderVec[idx] = eDwTypes_7.HC.Point2.add(iPoints[idx], vec);
            }
            return leaderVec;
        };
        return eDwMeasureUtils;
    }());
    ;
    var eDwMeasureResult = (function () {
        function eDwMeasureResult(iName, iValue, iType) {
            this.Name = iName;
            if (iValue instanceof eDwTypes_7.HC.Point3) {
                this.Value = iValue.copy();
            }
            else {
                this.Value = iValue;
            }
            this.Type = iType;
        }
        return eDwMeasureResult;
    }());
    ;
    var eDwMeasureLabelItem = (function () {
        function eDwMeasureLabelItem(iViewer, iResult) {
            this.mNameTextBox = new eDwTypes_7.HC.Markup.Shape.TextBox();
            this.mValueTextBox = new eDwTypes_7.HC.Markup.Shape.TextBox();
            this.mNameBox = new eDwTypes_7.HC.Markup.Shape.Rectangle();
            this.mValueBox = new eDwTypes_7.HC.Markup.Shape.Rectangle();
            this.mViewer = iViewer;
            this.mResult = iResult;
            var dark = new eDwTypes_7.HC.Color(150, 150, 150);
            var white = eDwTypes_7.HC.Color.white();
            this.mNameTextBox.getBoxPortion().setFillColor(white);
            this.mNameTextBox.getBoxPortion().setStrokeWidth(0);
            this.mNameTextBox.getTextPortion().setFillColor(white);
            this.mNameTextBox.getBoxPortion().setFillOpacity(0);
            this.mNameTextBox.getTextPortion().setFontFamily("arial");
            this.mValueTextBox.getBoxPortion().setFillColor(white);
            this.mValueTextBox.getBoxPortion().setStrokeWidth(0);
            this.mValueTextBox.getTextPortion().setFillColor(dark);
            this.mValueTextBox.getBoxPortion().setFillOpacity(0);
            this.mValueTextBox.getTextPortion().setFontFamily("arial");
            this.mNameBox.setFillColor(dark);
            this.mValueBox.setFillColor(white);
            this.mNameBox.setFillColor(dark);
            this.mValueBox.setFillColor(white);
        }
        ;
        eDwMeasureLabelItem.prototype.drawItem = function () {
            var renderer = this.mViewer.getMarkupManager().getRenderer();
            renderer.drawRectangle(this.mNameBox);
            renderer.drawRectangle(this.mValueBox);
            renderer.drawTextBox(this.mNameTextBox);
            renderer.drawTextBox(this.mValueTextBox);
        };
        eDwMeasureLabelItem.prototype.setPosition = function (iPos, iNameWidth, ivalueWidth) {
            var renderer = this.mViewer.getMarkupManager().getRenderer();
            var nameSize = renderer.measureTextBox(this.mNameTextBox);
            var valueSize = renderer.measureTextBox(this.mValueTextBox);
            var height = Math.max(nameSize.y, valueSize.y);
            this.mNameBox.setSize(new eDwTypes_7.HC.Point2(iNameWidth, height));
            this.mValueBox.setSize(new eDwTypes_7.HC.Point2(ivalueWidth, height));
            var namePos = iPos.copy();
            var valuePos = iPos.copy();
            valuePos.x += iNameWidth;
            this.mNameBox.setPosition(namePos);
            this.mValueBox.setPosition(valuePos);
            this.mNameTextBox.setPosition(this.mNameBox.getPosition());
            this.mValueTextBox.setPosition(this.mValueBox.getPosition());
            iPos.y += height;
        };
        eDwMeasureLabelItem.prototype.getWidth = function () {
            var renderer = this.mViewer.getMarkupManager().getRenderer();
            var nameSize = renderer.measureTextBox(this.mNameTextBox);
            var valueSize = renderer.measureTextBox(this.mValueTextBox);
            return { NameWidth: nameSize.x, ValueWidth: valueSize.x };
        };
        eDwMeasureLabelItem.prototype.setStringContent = function (iUnit) {
            this.mNameTextBox.setTextString(this.mResult.Name);
            if (this.mResult.Type === MeasureType.None) {
                this.mValueTextBox.setTextString(this.mResult.Value);
            }
            if (this.mResult.Type === MeasureType.Distance) {
                var scale = this.mViewer.getModel().getUnitMultiplier() /
                    iUnit.LenMultiplier;
                this.mValueTextBox.setTextString(eDwTypes_7.HC.MeasureUtils.formatWithUnit(this.mResult.Value * scale, iUnit.LenMultiplier));
            }
            if (this.mResult.Type === MeasureType.Angle) {
                if (iUnit.AngleUnit === "degree") {
                    this.mValueTextBox.setTextString(this.mResult.Value.toFixed(3) + "Deg");
                }
                else {
                    this.mValueTextBox.setTextString(eDwTypes_7.HC.MeasureUtils.Degrees_To_Radians(this.mResult.Value).toFixed(3) + "Rad");
                }
            }
            if (this.mResult.Type === MeasureType.Coordinate) {
                var scale = this.mViewer.getModel().getUnitMultiplier() /
                    iUnit.LenMultiplier;
                var xStr = eDwTypes_7.HC.MeasureUtils.formatWithUnit(this.mResult.Value.x * scale, iUnit.LenMultiplier);
                var yStr = eDwTypes_7.HC.MeasureUtils.formatWithUnit(this.mResult.Value.y * scale, iUnit.LenMultiplier);
                var zStr = eDwTypes_7.HC.MeasureUtils.formatWithUnit(this.mResult.Value.z * scale, iUnit.LenMultiplier);
                this.mValueTextBox.setTextString(xStr + "," + yStr + "," + zStr);
            }
        };
        eDwMeasureLabelItem.prototype.setLabelColor = function (iColor) {
            this.mNameBox.setFillColor(iColor);
        };
        eDwMeasureLabelItem.prototype.getText = function () {
            return this.mNameTextBox.getTextString() + ": " +
                this.mValueTextBox.getTextString();
        };
        eDwMeasureLabelItem.prototype.getBoundingBox = function () {
            var size0 = this.mNameBox.getSize();
            var size1 = this.mValueBox.getSize();
            var posS = this.mNameBox.getPosition().copy();
            var pos1 = this.mValueBox.getPosition();
            var posE = new eDwTypes_7.HC.Point2(pos1.x + size1.x, pos1.y + size1.y);
            var min = new eDwTypes_7.HC.Point2(Math.min(posS.x, posE.x), Math.min(posS.y, posE.y));
            var max = new eDwTypes_7.HC.Point2(Math.max(posS.x, posE.x), Math.max(posS.y, posE.y));
            return { Min: min, Max: max };
        };
        eDwMeasureLabelItem.prototype.setLableColor = function (iColor) {
            this.mNameTextBox.getBoxPortion().setFillColor(iColor);
        };
        return eDwMeasureLabelItem;
    }());
    ;
    var eDwMeasureLine = (function () {
        function eDwMeasureLine(iViewer) {
            this.mColor = new eDwTypes_7.HC.Color(150, 150, 150);
            this.mViewer = iViewer;
            this.mLine = new eDwTypes_7.HC.Markup.Shape.Line();
            this.mEnd0 = new eDwTypes_7.HC.Point3(0, 0, 0);
            this.mEnd1 = new eDwTypes_7.HC.Point3(0, 0, 0);
            this.setStyle("default");
        }
        eDwMeasureLine.prototype.setStyle = function (iStyle) {
            var defaultColor = new eDwTypes_7.HC.Color(150, 150, 150);
            var defaultWidth = 3;
            var distColor = new eDwTypes_7.HC.Color(52, 73, 94);
            var distWidth = 3;
            var leaderColor = new eDwTypes_7.HC.Color(150, 150, 150);
            var leaderWidth = 1;
            switch (iStyle) {
                case "default":
                    this.mLine.setStrokeWidth(defaultWidth);
                    this.mLine.setStrokeColor(defaultColor);
                    this.mLine.setEndcapType(eDwTypes_7.HC.Markup.Shape.EndcapType.None);
                    break;
                case "distance":
                    this.mLine.setEndEndcapColor(distColor);
                    this.mLine.setStartEndcapColor(distColor);
                    this.mLine.setStrokeColor(distColor);
                    this.mLine.setEndcapType(eDwTypes_7.HC.Markup.Shape.EndcapType.Arrowhead);
                    this.mLine.setEndEndcapSize(5);
                    this.mLine.setStartEndcapSize(5);
                    this.mLine.setStrokeWidth(distWidth);
                    break;
                case "leader":
                    this.mLine.setStrokeWidth(leaderWidth);
                    this.mLine.setStrokeColor(leaderColor);
                    break;
            }
        };
        eDwMeasureLine.prototype.reset = function () {
            var point = new eDwTypes_7.HC.Point3(0, 0, 0);
            this.mEnd0 = point;
            this.mEnd1 = point;
            this.mIsAvailible = false;
        };
        eDwMeasureLine.prototype.drawLine = function () {
            if (0 === this.getLength() || !this.mIsAvailible)
                return;
            this.projectPoints();
            var renderer = this.mViewer.getMarkupManager().getRenderer();
            renderer.drawLine(this.mLine);
        };
        eDwMeasureLine.prototype.drawLeader = function () {
            if (0 === this.getLength() || !this.mIsAvailible)
                return;
            var view = this.mViewer.getView();
            this.mLine.setP1(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mEnd0)));
            var renderer = this.mViewer.getMarkupManager().getRenderer();
            renderer.drawLine(this.mLine);
        };
        eDwMeasureLine.prototype.projectPoints = function () {
            var view = this.mViewer.getView();
            this.mLine.setP1(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mEnd0)));
            this.mLine.setP2(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mEnd1)));
        };
        eDwMeasureLine.prototype.getMiddlePoint = function () {
            var middle = eDwTypes_7.HC.Point3.scale(eDwTypes_7.HC.Point3.add(this.mEnd0, this.mEnd1), 0.5);
            return middle;
        };
        eDwMeasureLine.prototype.setLineColor = function (iColor) {
            this.mLine.setStrokeColor(iColor);
            this.mLine.setEndEndcapColor(iColor);
            this.mLine.setStartEndcapColor(iColor);
        };
        eDwMeasureLine.prototype.getLeaderStartPos = function () {
            var viewer = this.mViewer.getView();
            var pos = eDwTypes_7.HC.Point2.fromPoint3(viewer.projectPoint(this.mEnd0));
            this.mLine.setP1(pos);
            return pos;
        };
        eDwMeasureLine.prototype.getLeaderEndPos = function () {
            var viewer = this.mViewer.getView();
            var pos = eDwTypes_7.HC.Point2.fromPoint3(viewer.projectPoint(this.mEnd1));
            return pos;
        };
        eDwMeasureLine.prototype.setLeaderEndPos = function (iPos) {
            this.mLine.setP2(iPos);
            var point = eDwBaseOperator.screenToWorld(iPos, this.mViewer.getView());
            this.mEnd1 = point;
        };
        eDwMeasureLine.prototype.setLeaderEnd = function (iPoint) {
            this.mEnd1 = iPoint.copy();
        };
        eDwMeasureLine.prototype.getLength = function () {
            return eDwTypes_7.HC.Point3.subtract(this.mEnd0, this.mEnd1).length();
        };
        eDwMeasureLine.prototype.getLeaderStart = function () {
            return this.mEnd0.copy();
        };
        eDwMeasureLine.prototype.setEnds = function (iStart, iEnd) {
            this.reset();
            this.mEnd0 = iStart.copy();
            this.mEnd1 = iEnd.copy();
            this.mIsAvailible = true;
        };
        eDwMeasureLine.prototype.setAvailibility = function (iIsOn) {
            this.mIsAvailible = iIsOn;
        };
        eDwMeasureLine.prototype.getEnd0 = function () {
            return this.mEnd0.copy();
        };
        eDwMeasureLine.prototype.getEnd1 = function () {
            return this.mEnd1.copy();
        };
        return eDwMeasureLine;
    }());
    ;
    var eDwMeasureLabel = (function () {
        function eDwMeasureLabel(iViewer) {
            this.mItems = [];
            this.mViewer = iViewer;
            this.mLeader = new eDwMeasureLine(iViewer);
            this.mLeader.setStyle("leader");
        }
        ;
        eDwMeasureLabel.prototype.reset = function () {
            this.mItems = [];
        };
        eDwMeasureLabel.prototype.drawLabel = function () {
            var view = this.mViewer.getView();
            var point = this.mLeader.getEnd1().copy();
            var pos = eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(point));
            this.setLabelPosition(pos);
            var n = this.mItems.length;
            if (0 === n)
                return;
            else {
                this.mLeader.drawLine();
            }
            for (var i = 0; i < n; ++i) {
                this.mItems[i].drawItem();
            }
        };
        eDwMeasureLabel.prototype.addItem = function (iResult) {
            var item = new eDwMeasureLabelItem(this.mViewer, iResult);
            this.mItems.push(item);
        };
        eDwMeasureLabel.prototype.addItemWithColor = function (iResult, icolor) {
            var item = new eDwMeasureLabelItem(this.mViewer, iResult);
            item.setLabelColor(icolor);
            this.mItems.push(item);
        };
        eDwMeasureLabel.prototype.setStringContent = function (iUnit) {
            var n = this.mItems.length;
            for (var i = 0; i < n; ++i) {
                this.mItems[i].setStringContent(iUnit);
            }
        };
        eDwMeasureLabel.prototype.setLeader = function (iEnd0) {
            var end1 = eDwTypes_7.HC.Point3.add(iEnd0, new eDwTypes_7.HC.Point3(1, 1, 1));
            this.mLeader.setEnds(iEnd0, end1);
        };
        eDwMeasureLabel.prototype.getLeaderStart = function () {
            return this.mLeader.getLeaderStart();
        };
        eDwMeasureLabel.prototype.getLeaderStartPos = function () {
            return this.mLeader.getLeaderStartPos();
        };
        eDwMeasureLabel.prototype.getLeaderEndPos = function () {
            return this.mLeader.getLeaderEndPos();
        };
        eDwMeasureLabel.prototype.setLeaderEndPos = function (pos) {
            this.mLeader.setLeaderEndPos(pos.copy());
            this.setLabelPosition(pos.copy());
        };
        eDwMeasureLabel.prototype.setDefaultEndPos = function () {
            var start = this.getLeaderStartPos();
            var end = eDwTypes_7.HC.Point2.add(start, new eDwTypes_7.HC.Point2(30, 30));
            this.setLeaderEndPos(end);
        };
        eDwMeasureLabel.prototype.setLeaderEnd = function (point) {
            var view = this.mViewer.getView();
            this.mLeader.setLeaderEnd(point.copy());
            var pos = eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(point));
            this.setLabelPosition(pos);
        };
        eDwMeasureLabel.prototype.getLeaderEnd = function () {
            return this.mLeader.getEnd1();
        };
        eDwMeasureLabel.prototype.getText = function (unit) {
            this.setStringContent(unit);
            var n = this.mItems.length;
            if (0 === n)
                return "";
            var str = this.mItems[0].getText();
            for (var i = 1; i < n; ++i) {
                str = str + "\n" + this.mItems[i].getText();
            }
            return str;
        };
        eDwMeasureLabel.prototype.getLabelBox = function () {
            var n = this.mItems.length;
            if (0 === n)
                return null;
            var box = this.mItems[0].getBoundingBox();
            var xMin = box.Min.x, xMax = box.Max.x;
            var yMin = box.Min.y, yMax = box.Max.y;
            for (var i = 0; i < n; ++i) {
                var box_1 = this.mItems[i].getBoundingBox();
                xMin = Math.min(box_1.Min.x, xMin);
                yMin = Math.min(box_1.Min.y, yMin);
                xMax = Math.max(box_1.Max.x, xMax);
                yMax = Math.max(box_1.Max.y, yMax);
            }
            var min = new eDwTypes_7.HC.Point2(xMin, yMin);
            var max = new eDwTypes_7.HC.Point2(xMax, yMax);
            return { Min: min, Max: max };
        };
        eDwMeasureLabel.prototype.setLabelPosition = function (iPos) {
            var n = this.mItems.length;
            var nameWidth = 0, valueWidth = 0;
            for (var i = 0; i < n; ++i) {
                var tmp = this.mItems[i].getWidth();
                nameWidth = Math.max(nameWidth, tmp.NameWidth);
                valueWidth = Math.max(valueWidth, tmp.ValueWidth);
            }
            for (var i = 0; i < n; ++i) {
                this.mItems[i].setPosition(iPos, nameWidth, valueWidth);
            }
        };
        return eDwMeasureLabel;
    }());
    ;
    var eDwMeasureAuxPlane = (function () {
        function eDwMeasureAuxPlane(iViewer) {
            this.mViewer = iViewer;
            this.mFacePolygon = new eDwTypes_7.HC.Markup.Shape.Polygon();
            var orig = new eDwTypes_7.HC.Point3(0, 0, 0);
            this.mFacePolygonPoints = { A: orig.copy(), B: orig.copy(),
                C: orig.copy(), D: orig.copy() };
            var faceColor = new eDwTypes_7.HC.Color(26, 188, 156);
            this.mFacePolygon.setFillColor(faceColor);
            this.mFacePolygon.setStrokeColor(faceColor);
            this.mFacePolygon.setFillOpacity(0.5);
            var widthEdge = 0;
            this.mFacePolygon.setStrokeWidth(widthEdge);
        }
        eDwMeasureAuxPlane.prototype.drawPlane = function () {
            if (!this.mIsAvailible)
                return;
            this.projectPoints();
            var renderer = this.mViewer.getMarkupManager().getRenderer();
            renderer.drawPolygon(this.mFacePolygon);
        };
        eDwMeasureAuxPlane.prototype.setByPlane = function (iFaceOrig, iFaceObj) {
            var model = this.mViewer.getModel();
            var face = new eDwTypes_7.HC.SubentityProperties.PlaneElement();
            face.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            face.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            eDwMeasureUtils.getRealPlaneProperties(iFaceObj, iFaceOrig, face, model);
            this.mFaceInfo = { Orig: face.origin, Normal: face.normal,
                Pick: iFaceObj.getPosition() };
            var bbox = iFaceObj.getFaceEntity().getBounding();
            this.mBoundingMax = bbox.max;
            this.mBoundingMin = bbox.min;
            this.setAvailibility(true);
            this.computePoints();
        };
        eDwMeasureAuxPlane.prototype.setByPlaneIntersection = function (iFaceOrig, iFaceObj, iOrig0, iOrig1, iRadius) {
            var model = this.mViewer.getModel();
            var face = new eDwTypes_7.HC.SubentityProperties.PlaneElement();
            face.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            face.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            eDwMeasureUtils.getRealPlaneProperties(iFaceObj, iFaceOrig, face, model);
            this.mFaceInfo = { Orig: face.origin, Normal: face.normal,
                Pick: iFaceObj.getPosition() };
            var bbox = iFaceObj.getFaceEntity().getBounding();
            this.mBoundingMax = bbox.max;
            this.mBoundingMin = bbox.min;
            var n = this.mFaceInfo.Normal.copy();
            n.normalize();
            var edgeDir0 = eDwTypes_7.HC.Point3.subtract(iOrig1, iOrig0);
            var lenDir0 = edgeDir0.length();
            edgeDir0.normalize();
            var vp1 = eDwTypes_7.HC.Point3.subtract(iOrig1, this.mFaceInfo.Pick);
            var vp0 = eDwTypes_7.HC.Point3.subtract(iOrig0, this.mFaceInfo.Pick);
            if (eDwTypes_7.HC.Point3.dot(n, eDwTypes_7.HC.Point3.cross(vp0, vp1)) < 0) {
                n.scale(-1);
            }
            var edgeDir1 = eDwTypes_7.HC.Point3.cross(n, edgeDir0);
            edgeDir1.normalize();
            var lenDir1 = Math.max(vp1.length(), vp0.length());
            edgeDir1.scale(iRadius);
            var origC = eDwTypes_7.HC.Point3.scale(eDwTypes_7.HC.Point3.add(iOrig0, iOrig1), 0.5);
            lenDir0 = Math.max(lenDir0, iRadius / 2);
            edgeDir0.scale(lenDir0);
            var A = eDwTypes_7.HC.Point3.subtract(origC, eDwTypes_7.HC.Point3.scale(edgeDir0, 0.5));
            var B = eDwTypes_7.HC.Point3.add(A, edgeDir0);
            var C = eDwTypes_7.HC.Point3.add(B, edgeDir1);
            var D = eDwTypes_7.HC.Point3.subtract(C, edgeDir0);
            this.mFacePolygonPoints = { A: A, B: B, C: C, D: D };
            this.setAvailibility(true);
        };
        eDwMeasureAuxPlane.prototype.setByPlaneProjection = function (iFaceOrig, iFaceObj, iOtherPoint) {
            var model = this.mViewer.getModel();
            var face = new eDwTypes_7.HC.SubentityProperties.PlaneElement();
            face.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            face.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            eDwMeasureUtils.getRealPlaneProperties(iFaceObj, iFaceOrig, face, model);
            this.mFaceInfo = { Orig: face.origin, Normal: face.normal,
                Pick: iFaceObj.getPosition() };
            var bbox = iFaceObj.getFaceEntity().getBounding();
            this.mBoundingMax = bbox.max;
            this.mBoundingMin = bbox.min;
            var n = this.mFaceInfo.Normal.copy();
            n.normalize();
            var minSide = 0.25 * eDwTypes_7.HC.Point3.subtract(bbox.max, bbox.min).length();
            var p0 = this.mFaceInfo.Pick.copy();
            var p1 = eDwTypes_7.HC.Point3.subtract(iOtherPoint, eDwTypes_7.HC.Point3.scale(n, eDwTypes_7.HC.Point3.dot(eDwTypes_7.HC.Point3.subtract(iOtherPoint, p0), n)));
            var edgeDir0 = eDwTypes_7.HC.Point3.subtract(p1, p0);
            if (0 === edgeDir0.length()) {
                var aX = new eDwTypes_7.HC.Point3(1, 0, 0);
                var aY = new eDwTypes_7.HC.Point3(0, 1, 0);
                var aZ = new eDwTypes_7.HC.Point3(0, 0, 1);
                if (0 === eDwTypes_7.HC.Point3.dot(n, aX) && 0 === eDwTypes_7.HC.Point3.dot(n, aZ)) {
                    edgeDir0 = aX.copy();
                }
                else {
                    edgeDir0 = eDwTypes_7.HC.Point3.cross(n, aY);
                }
            }
            edgeDir0.normalize();
            var edgeDir1 = eDwTypes_7.HC.Point3.cross(n, edgeDir0);
            edgeDir1.normalize();
            var side0 = eDwTypes_7.HC.Point3.subtract(p1, p0).length() + 2 * minSide;
            var side1 = 2 * minSide;
            var A = eDwTypes_7.HC.Point3.add(eDwTypes_7.HC.Point3.subtract(p0, eDwTypes_7.HC.Point3.scale(edgeDir0, minSide)), eDwTypes_7.HC.Point3.scale(edgeDir1, minSide));
            var B = eDwTypes_7.HC.Point3.add(A, eDwTypes_7.HC.Point3.scale(edgeDir0, side0));
            var C = eDwTypes_7.HC.Point3.subtract(B, eDwTypes_7.HC.Point3.scale(edgeDir1, side1));
            var D = eDwTypes_7.HC.Point3.subtract(C, eDwTypes_7.HC.Point3.scale(edgeDir0, side0));
            this.mFacePolygonPoints = { A: A, B: B, C: C, D: D };
            this.setAvailibility(true);
        };
        eDwMeasureAuxPlane.prototype.isAvailible = function () {
            return this.mIsAvailible;
        };
        eDwMeasureAuxPlane.prototype.setAvailibility = function (iIsOn) {
            this.mIsAvailible = iIsOn;
        };
        eDwMeasureAuxPlane.prototype.computePoints = function () {
            var cS = eDwTypes_7.HC.Point3.add(this.mBoundingMax, this.mBoundingMin).scale(0.5);
            var rS = 0.5 * eDwTypes_7.HC.Point3.subtract(this.mBoundingMax, this.mBoundingMin).length();
            var p = this.mFaceInfo.Orig.copy();
            var n = this.mFaceInfo.Normal.copy();
            n.normalize();
            var dist = eDwTypes_7.HC.Point3.dot(eDwTypes_7.HC.Point3.subtract(p, cS), n);
            var cC = eDwTypes_7.HC.Point3.add(eDwTypes_7.HC.Point3.scale(n, dist), cS);
            var rC = 0;
            if (rS * rS - dist * dist > 0) {
                rC = Math.sqrt(rS * rS - dist * dist);
            }
            else {
                rC = rS;
            }
            var aX = new eDwTypes_7.HC.Point3(1, 0, 0);
            var aY = new eDwTypes_7.HC.Point3(0, 1, 0);
            var aZ = new eDwTypes_7.HC.Point3(0, 0, 1);
            var edgeLen = rC;
            var edgeDir0;
            if (0 === eDwTypes_7.HC.Point3.dot(n, aX) && 0 == eDwTypes_7.HC.Point3.dot(n, aZ)) {
                edgeDir0 = aX.copy();
            }
            else {
                edgeDir0 = eDwTypes_7.HC.Point3.cross(n, aY);
                edgeDir0.normalize();
            }
            var edgeDir1 = eDwTypes_7.HC.Point3.cross(n, edgeDir0);
            edgeDir1.normalize();
            var sCenter = this.mFaceInfo.Pick.copy();
            edgeDir0.scale(0.5 * edgeLen);
            edgeDir1.scale(0.5 * edgeLen);
            var A = eDwTypes_7.HC.Point3.add(sCenter, eDwTypes_7.HC.Point3.add(edgeDir0, edgeDir1));
            edgeDir0.scale(2);
            edgeDir1.scale(2);
            var B = eDwTypes_7.HC.Point3.add(A, eDwTypes_7.HC.Point3.scale(edgeDir0, -1));
            var C = eDwTypes_7.HC.Point3.add(B, eDwTypes_7.HC.Point3.scale(edgeDir1, -1));
            var D = eDwTypes_7.HC.Point3.add(A, eDwTypes_7.HC.Point3.scale(edgeDir1, -1));
            this.mFacePolygonPoints = { A: A, B: B, C: C, D: D };
        };
        eDwMeasureAuxPlane.prototype.projectPoints = function () {
            var view = this.mViewer.getView();
            this.mFacePolygon.clearPoints();
            this.mFacePolygon.pushPoint(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mFacePolygonPoints.A)));
            this.mFacePolygon.pushPoint(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mFacePolygonPoints.B)));
            this.mFacePolygon.pushPoint(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mFacePolygonPoints.C)));
            this.mFacePolygon.pushPoint(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mFacePolygonPoints.D)));
        };
        return eDwMeasureAuxPlane;
    }());
    ;
    var eDwMeasureAuxMessage = (function () {
        function eDwMeasureAuxMessage(iViewer) {
            this.mLabels = [];
            this.mViewer = iViewer;
        }
        eDwMeasureAuxMessage.prototype.reset = function () {
            this.mLabels = [];
        };
        eDwMeasureAuxMessage.prototype.addByResultWithColor = function (iResult, iStart, iColor) {
            var label = new eDwMeasureLabel(this.mViewer);
            label.addItemWithColor(iResult, iColor);
            label.setLeader(iStart);
            this.mLabels.push(label);
            this.setAvailibility(true);
        };
        eDwMeasureAuxMessage.prototype.addByResult = function (iResult, iStart) {
            var label = new eDwMeasureLabel(this.mViewer);
            label.addItem(iResult);
            label.setLeader(iStart);
            this.mLabels.push(label);
            this.setAvailibility(true);
        };
        eDwMeasureAuxMessage.prototype.addByVertex = function (iVertObj) {
            if (!iVertObj.getPointEntity())
                return;
            var label = new eDwMeasureLabel(this.mViewer);
            label.addItem(new eDwMeasureResult("Entity", "Vertex", MeasureType.None));
            label.addItem(new eDwMeasureResult("Coordinate", iVertObj.getPosition(), MeasureType.Coordinate));
            label.setLeader(iVertObj.getPosition());
            this.mLabels.push(label);
            this.setAvailibility(true);
        };
        eDwMeasureAuxMessage.prototype.addByLine = function (iEdge, iEdgeObj) {
            if (!iEdgeObj.getLineEntity())
                return;
            if (iEdge instanceof eDwTypes_7.HC.SubentityProperties.LineElement) {
                var label = new eDwMeasureLabel(this.mViewer);
                label.addItem(new eDwMeasureResult("Entity", "Straight line", MeasureType.None));
                label.addItem(new eDwMeasureResult("Length", iEdge.length, MeasureType.Distance));
                label.setLeader(iEdgeObj.getPosition());
                this.mLabels.push(label);
                this.setAvailibility(true);
            }
            if (iEdge instanceof eDwTypes_7.HC.SubentityProperties.OtherElement) {
                var label = new eDwMeasureLabel(this.mViewer);
                label.addItem(new eDwMeasureResult("Entity", "Curve", MeasureType.None));
                label.addItem(new eDwMeasureResult("Length", iEdge.length, MeasureType.Distance));
                label.setLeader(iEdgeObj.getPosition());
                this.mLabels.push(label);
                this.setAvailibility(true);
            }
        };
        eDwMeasureAuxMessage.prototype.addByCircle = function (iCircleOrig, iEdgeObj) {
            if (!iEdgeObj.getLineEntity())
                return;
            if (iCircleOrig instanceof eDwTypes_7.HC.SubentityProperties.CircleElement) {
                var circle = new eDwTypes_7.HC.SubentityProperties.CircleElement();
                circle.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
                circle.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
                circle.radius = 0;
                eDwMeasureUtils.getRealCircleProperties(iEdgeObj, iCircleOrig, circle, this.mViewer.getModel());
                var label = new eDwMeasureLabel(this.mViewer);
                label.addItem(new eDwMeasureResult("Entity", "Circle", MeasureType.None));
                label.addItem(new eDwMeasureResult("Center", circle.origin, MeasureType.Coordinate));
                label.addItem(new eDwMeasureResult("Radius", circle.radius, MeasureType.Distance));
                label.setLeader(iEdgeObj.getPosition());
                this.mLabels.push(label);
                this.setAvailibility(true);
            }
        };
        eDwMeasureAuxMessage.prototype.addByPlane = function (iFaceOrig, iFaceObj) {
            if (!iFaceObj.getFaceEntity())
                return;
            if (iFaceOrig instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement) {
                var face = new eDwTypes_7.HC.SubentityProperties.PlaneElement();
                face.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
                face.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
                eDwMeasureUtils.getRealPlaneProperties(iFaceObj, iFaceOrig, face, this.mViewer.getModel());
                var label = new eDwMeasureLabel(this.mViewer);
                label.addItem(new eDwMeasureResult("Entity", "Plane", MeasureType.None));
                label.setLeader(iFaceObj.getPosition());
                this.mLabels.push(label);
                this.setAvailibility(true);
            }
        };
        eDwMeasureAuxMessage.prototype.addByCylinder = function (iCylinderOrig, iFaceObj) {
            if (!iFaceObj.getFaceEntity())
                return;
            if (iCylinderOrig instanceof eDwTypes_7.HC.SubentityProperties.CylinderElement) {
                var cylinder = new eDwTypes_7.HC.SubentityProperties.CylinderElement();
                cylinder.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
                cylinder.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
                cylinder.radius = 0;
                eDwMeasureUtils.getRealCylinderProperties(iFaceObj, iCylinderOrig, cylinder, this.mViewer.getModel());
                var label = new eDwMeasureLabel(this.mViewer);
                label.addItem(new eDwMeasureResult("Entity", "Cylinder", MeasureType.None));
                label.addItem(new eDwMeasureResult("Radius", cylinder.radius, MeasureType.Distance));
                label.setLeader(iFaceObj.getPosition());
                this.mLabels.push(label);
                this.setAvailibility(true);
            }
        };
        eDwMeasureAuxMessage.prototype.addPickInfos = function (iSelProps, iSelObjs) {
            var n = iSelObjs.length;
            for (var i = 0; i < n; ++i) {
                var selProp = iSelProps[i];
                var selObj = iSelObjs[i];
                this.addByCircle(selProp, selObj);
                this.addByCylinder(selProp, selObj);
                this.addByLine(selProp, selObj);
                this.addByPlane(selProp, selObj);
            }
            this.mIsAvailible = this.countLabels() > 0;
        };
        eDwMeasureAuxMessage.prototype.getLabels = function () {
            if (!this.mIsAvailible)
                return [];
            return this.mLabels;
        };
        eDwMeasureAuxMessage.prototype.setAvailibility = function (isOn) {
            this.mIsAvailible = isOn;
        };
        eDwMeasureAuxMessage.prototype.isAvailible = function () {
            return this.mIsAvailible;
        };
        eDwMeasureAuxMessage.prototype.countLabels = function () {
            return this.mLabels.length;
        };
        eDwMeasureAuxMessage.prototype.getText = function (iUnit) {
            var n = this.mLabels.length;
            if (0 === n)
                return "";
            var str = this.mLabels[0].getText(iUnit);
            for (var i = 1; i < n; ++i) {
                str = str + "\n\n" + this.mLabels[i].getText(iUnit);
            }
            return str;
        };
        return eDwMeasureAuxMessage;
    }());
    ;
    var eDwMeasureAuxDelta = (function () {
        function eDwMeasureAuxDelta(iViewer) {
            this.mViewer = iViewer;
            this.mStart = new eDwTypes_7.HC.Point3(0, 0, 0);
            this.mEnd = new eDwTypes_7.HC.Point3(0, 0, 0);
            this.mLineDeltaX = new eDwMeasureLine(iViewer);
            this.mLineDeltaY = new eDwMeasureLine(iViewer);
            this.mLineDeltaZ = new eDwMeasureLine(iViewer);
            this.mLineDist = new eDwMeasureLine(iViewer);
            this.mLineDist.setStyle("distance");
            this.mCircleEnd0 = new eDwTypes_7.HC.Markup.Shape.Circle();
            this.mCircleEnd1 = new eDwTypes_7.HC.Markup.Shape.Circle();
            var colorAngleFill = new eDwTypes_7.HC.Color(41, 128, 185);
            var colorPolygonEdge = new eDwTypes_7.HC.Color(255, 0, 0);
            var colorPoint = new eDwTypes_7.HC.Color(137, 196, 244);
            var colorEdgeArc = new eDwTypes_7.HC.Color(52, 73, 94);
            var colorEdgeStroke = new eDwTypes_7.HC.Color(100, 100, 100);
            var widthEdge = 3;
            var arrowSize = 5;
            var pointSize = 7;
            this.mLineDeltaX.setLineColor(eDwTypes_7.HC.Color.red());
            this.mLineDeltaY.setLineColor(eDwTypes_7.HC.Color.green());
            this.mLineDeltaZ.setLineColor(eDwTypes_7.HC.Color.blue());
            this.mCircleEnd0.setFillColor(colorPoint);
            this.mCircleEnd0.setStrokeColor(colorEdgeStroke);
            this.mCircleEnd0.setStrokeWidth(widthEdge);
            this.mCircleEnd0.setRadius(pointSize);
            this.mCircleEnd1.setFillColor(colorPoint);
            this.mCircleEnd1.setStrokeColor(colorEdgeStroke);
            this.mCircleEnd1.setStrokeWidth(widthEdge);
            this.mCircleEnd1.setRadius(pointSize);
            this.mShowDelta = true;
            this.mShowDist = true;
            this.mIsAvailible = false;
        }
        eDwMeasureAuxDelta.prototype.reset = function () {
            var point = new eDwTypes_7.HC.Point3(0, 0, 0);
            this.mEnd = point;
            this.mStart = point;
            this.mLineDist.reset();
            this.mLineDeltaX.reset();
            this.mLineDeltaY.reset();
            this.mLineDeltaZ.reset();
            this.mIsAvailible = false;
        };
        eDwMeasureAuxDelta.prototype.setDeltaEnds = function (iStart, iEnd) {
            this.reset();
            this.mStart = iStart.copy();
            this.mEnd = iEnd.copy();
            var delta = eDwTypes_7.HC.Point3.subtract(iStart, iEnd);
            if (0 === delta.x && 0 === delta.y && 0 === delta.z)
                return;
            var a = iStart.copy();
            var b = new eDwTypes_7.HC.Point3(a.x - delta.x, a.y, a.z);
            var c = new eDwTypes_7.HC.Point3(b.x, b.y - delta.y, b.z);
            var d = iEnd.copy();
            this.mLineDeltaX.setEnds(a, b);
            this.mLineDeltaY.setEnds(b, c);
            this.mLineDeltaZ.setEnds(c, d);
            this.mLineDist.setEnds(a, d);
            this.setAvailibility(true);
        };
        eDwMeasureAuxDelta.prototype.draw = function (consice) {
            var delta = eDwTypes_7.HC.Point3.subtract(this.mEnd, this.mStart);
            if (!this.mIsAvailible ||
                (0 === delta.x && 0 === delta.y && 0 === delta.z))
                return;
            if (this.mShowDelta) {
                this.mLineDeltaX.drawLine();
                this.mLineDeltaY.drawLine();
                this.mLineDeltaZ.drawLine();
            }
            if (this.mShowDist) {
                this.mLineDist.drawLine();
            }
            var view = this.mViewer.getView();
            this.mCircleEnd0.setCenter(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mStart)));
            this.mCircleEnd1.setCenter(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mEnd)));
            var renderer = this.mViewer.getMarkupManager().getRenderer();
            if (!consice) {
                renderer.drawCircle(this.mCircleEnd0);
                renderer.drawCircle(this.mCircleEnd1);
            }
        };
        eDwMeasureAuxDelta.prototype.getLabels = function () {
            var labels = [];
            if (!this.mIsAvailible)
                return labels;
            var delta = eDwTypes_7.HC.Point3.subtract(this.mStart, this.mEnd);
            if (0 === delta.x && 0 === delta.y && 0 === delta.z)
                return [];
            if (this.mShowDelta) {
                var labelDx = new eDwMeasureLabel(this.mViewer);
                labelDx.addItemWithColor(new eDwMeasureResult("dX", Math.abs(delta.x), MeasureType.Distance), eDwTypes_7.HC.Color.red());
                labelDx.setLeader(this.mLineDeltaX.getMiddlePoint());
                labels.push(labelDx);
                var labelDy = new eDwMeasureLabel(this.mViewer);
                labelDy.addItemWithColor(new eDwMeasureResult("dY", Math.abs(delta.y), MeasureType.Distance), eDwTypes_7.HC.Color.green());
                labelDy.setLeader(this.mLineDeltaY.getMiddlePoint());
                labels.push(labelDy);
                var labelDz = new eDwMeasureLabel(this.mViewer);
                labelDz.addItemWithColor(new eDwMeasureResult("dZ", Math.abs(delta.z), MeasureType.Distance), eDwTypes_7.HC.Color.blue());
                labelDz.setLeader(this.mLineDeltaZ.getMiddlePoint());
                labels.push(labelDz);
            }
            if (this.mShowDist) {
                var labelDist = new eDwMeasureLabel(this.mViewer);
                labelDist.addItem(new eDwMeasureResult("Distance", delta.length(), MeasureType.Distance));
                labelDist.setLeader(this.mLineDist.getMiddlePoint());
                labels.push(labelDist);
            }
            return labels;
        };
        eDwMeasureAuxDelta.prototype.getDistLabel = function () {
            var delta = this.getDelta();
            var labelDist = new eDwMeasureLabel(this.mViewer);
            labelDist.addItem(new eDwMeasureResult("Distance", delta.length(), MeasureType.Distance));
            labelDist.setLeader(this.mLineDist.getMiddlePoint());
            return labelDist;
        };
        eDwMeasureAuxDelta.prototype.getDeltaLabel = function () {
            var delta = this.getDelta();
            delta.x = Math.abs(delta.x);
            delta.y = Math.abs(delta.y);
            delta.z = Math.abs(delta.z);
            var labelDelta = new eDwMeasureLabel(this.mViewer);
            labelDelta.addItem(new eDwMeasureResult("Delta", delta, MeasureType.Coordinate));
            labelDelta.setLeader(this.mLineDist.getMiddlePoint());
            return labelDelta;
        };
        eDwMeasureAuxDelta.prototype.isAvailible = function () {
            return this.mIsAvailible;
        };
        eDwMeasureAuxDelta.prototype.setAvailibility = function (iIsOn) {
            this.mIsAvailible = iIsOn;
        };
        eDwMeasureAuxDelta.prototype.setDeltaDistAvailability = function (iIsDelta, iIsDist) {
            this.mShowDelta = iIsDelta;
            this.mShowDist = iIsDist;
        };
        eDwMeasureAuxDelta.prototype.getDeltaDistAvailablility = function () {
            return { Delta: this.mShowDelta, Dist: this.mShowDist };
        };
        eDwMeasureAuxDelta.prototype.setDistLineColor = function (iColor) {
            this.mLineDist.setLineColor(iColor);
        };
        eDwMeasureAuxDelta.prototype.setPointColor = function (iColor) {
            this.mCircleEnd0.setFillColor(iColor);
            this.mCircleEnd1.setFillColor(iColor);
        };
        eDwMeasureAuxDelta.prototype.getDelta = function () {
            return eDwTypes_7.HC.Point3.subtract(this.mEnd, this.mStart);
        };
        eDwMeasureAuxDelta.prototype.getStartPoint = function () {
            return this.mStart.copy();
        };
        eDwMeasureAuxDelta.prototype.getEndPoint = function () {
            return this.mEnd.copy();
        };
        eDwMeasureAuxDelta.prototype.getDistance = function () {
            return this.getDelta().length();
        };
        return eDwMeasureAuxDelta;
    }());
    ;
    var eDwMeasureAuxDistance = (function () {
        function eDwMeasureAuxDistance(iViewer) {
            this.mDuplicateDist = false;
            this.mShowDelta = true;
            this.mViewer = iViewer;
            this.mDistLine = new eDwMeasureAuxDelta(iViewer);
            this.mNDistLine = new eDwMeasureAuxDelta(iViewer);
            this.mNDistLine.setDeltaDistAvailability(false, true);
            this.mNDistLineExt0 = new eDwMeasureLine(iViewer);
            this.mNDistLineExt1 = new eDwMeasureLine(iViewer);
            var extLineColor = new eDwTypes_7.HC.Color(154, 236, 219);
            this.mNDistLineExt0.setLineColor(extLineColor);
            this.mNDistLineExt1.setLineColor(extLineColor);
            var NDistLineColor = new eDwTypes_7.HC.Color(41, 128, 185);
            this.mNDistLine.setDistLineColor(NDistLineColor);
            var NDistPointColor = new eDwTypes_7.HC.Color(236, 240, 241);
            this.mNDistLine.setPointColor(NDistPointColor);
        }
        eDwMeasureAuxDistance.prototype.avoidDuplication = function () {
            var delta0 = this.mDistLine.getDelta();
            var delta1 = this.mNDistLine.getDelta();
            var len0 = delta0.length();
            var len1 = delta1.length();
            var lenMax = Math.max(len0, len1);
            var lenDiff = Math.abs(len0 - len1);
            if (0 === lenMax || lenDiff / lenMax < eDwLengthTolerance) {
                delta1 = delta0.copy();
            }
            var diff = new eDwTypes_7.HC.Point3(Math.abs(delta0.x) - Math.abs(delta1.x), Math.abs(delta0.y) - Math.abs(delta1.y), Math.abs(delta0.z) - Math.abs(delta1.z));
            if (0 === diff.x && 0 === diff.y && 0 === diff.z) {
                var start = this.mDistLine.getStartPoint();
                var end = this.mDistLine.getEndPoint();
                this.mNDistLine.setDeltaEnds(start, end);
                this.mDistLine.reset();
                var dd = this.mDistLine.getDeltaDistAvailablility();
                this.mNDistLine.setDeltaDistAvailability(dd.Delta, dd.Dist);
                this.mDuplicateDist = true;
            }
            if ((0 === delta1.x && 0 === delta1.y && 0 === delta1.z) ||
                (0 === diff.x && 0 === diff.y && 0 === diff.z)) {
                this.mNDistLineExt0.reset();
                this.mNDistLineExt1.reset();
            }
        };
        eDwMeasureAuxDistance.prototype.reset = function () {
            this.mIsAvailible = false;
            this.mDistLine.reset();
            this.mNDistLine.reset();
            this.mNDistLine.setDeltaDistAvailability(false, true);
            this.mNDistLineExt0.reset();
            this.mNDistLineExt1.reset();
            this.mDuplicateDist = false;
        };
        eDwMeasureAuxDistance.prototype.draw = function (consice) {
            if (!this.mIsAvailible)
                return;
            var renderer = this.mViewer.getMarkupManager().getRenderer();
            this.mDistLine.draw(consice);
            this.mNDistLine.draw(consice);
            this.mNDistLineExt0.drawLine();
            this.mNDistLineExt1.drawLine();
        };
        eDwMeasureAuxDistance.prototype.setByPointLine = function (point, iEdge, iEdgeObj) {
            this.reset();
            var linePoints = eDwMeasureUtils.getRealLinePoints(iEdgeObj, this.mViewer.getModel());
            var v0 = eDwTypes_7.HC.Point3.subtract(linePoints.A, linePoints.B);
            v0.normalize();
            var p0 = iEdgeObj.getPosition();
            var k = eDwTypes_7.HC.Point3.dot(eDwTypes_7.HC.Point3.subtract(point, p0), v0) /
                eDwTypes_7.HC.Point3.dot(v0, v0);
            var pn = eDwTypes_7.HC.Point3.add(p0, eDwTypes_7.HC.Point3.scale(v0, k));
            var pnA = eDwTypes_7.HC.Point3.subtract(linePoints.A, pn);
            var pnB = eDwTypes_7.HC.Point3.subtract(linePoints.B, pn);
            if (eDwTypes_7.HC.Point3.dot(pnA, pnB) < 0) {
                this.mDistLine.setDeltaEnds(point, pn);
                this.mNDistLine.setDeltaEnds(point, pn);
                this.mNDistLineExt0.setEnds(point, point);
                this.mNDistLineExt1.setEnds(pn, pn);
            }
            else {
                var cp = pnA.length() < pnB.length() ? linePoints.A.copy()
                    : linePoints.B.copy();
                this.mDistLine.setDeltaEnds(point, cp);
                this.mNDistLine.setDeltaEnds(point, pn);
                this.mNDistLineExt0.setEnds(point, point);
                this.mNDistLineExt1.setEnds(cp, pn);
            }
            this.avoidDuplication();
            this.setAvailibility(true);
        };
        eDwMeasureAuxDistance.prototype.setByPointPlane = function (iPoint, iFace, iFaceObj, iExtraInfo) {
            this.reset();
            var n1 = iFace.normal;
            var p1 = iFaceObj.getPosition();
            n1.normalize();
            var pp1 = eDwTypes_7.HC.Point3.subtract(p1, iPoint);
            var k = eDwTypes_7.HC.Point3.dot(pp1, n1);
            var pn1 = eDwTypes_7.HC.Point3.scale(n1, k);
            pn1 = eDwTypes_7.HC.Point3.add(pn1, iPoint);
            var model = this.mViewer.getModel();
            var lineRay = new eDwTypes_7.HC.Ray(iPoint, new eDwTypes_7.HC.Point3(0, 0, 0));
            var dist = iExtraInfo;
            this.mDistLine.setDeltaEnds(dist.pos1, dist.pos2);
            this.mNDistLine.setDeltaEnds(iPoint, pn1);
            this.mNDistLineExt0.setEnds(iPoint, iPoint);
            this.mNDistLineExt1.setEnds(p1, pn1);
            this.avoidDuplication();
            this.setAvailibility(true);
        };
        eDwMeasureAuxDistance.prototype.setByPointPoint = function (iPoint0, iPoint1) {
            this.reset();
            this.mDistLine.setDeltaEnds(iPoint0, iPoint1);
            this.mNDistLine.setDeltaEnds(iPoint0, iPoint1);
            this.mNDistLineExt0.setEnds(iPoint0, iPoint0);
            this.mNDistLineExt1.setEnds(iPoint1, iPoint1);
            this.avoidDuplication();
            this.setAvailibility(true);
        };
        eDwMeasureAuxDistance.prototype.setByPlanePlane = function (iFace0, iFace1, iFaceObj0, iFaceObj1, iExtraInfo) {
            this.reset();
            var pick0 = iFaceObj0.getPosition();
            var pick1 = iFaceObj1.getPosition();
            var n0 = iFace0.normal;
            n0.normalize();
            var p0 = pick0.copy();
            var n1 = iFace1.normal;
            n1.normalize();
            var p1 = pick1.copy();
            var angle = eDwMeasureUtils.getAngle(n0, n1);
            if (0 !== angle && 180 !== angle) {
                var v = eDwTypes_7.HC.Point3.cross(n0, n1);
                var w0 = eDwTypes_7.HC.Point3.cross(v, n0);
                var k0 = (eDwTypes_7.HC.Point3.dot(p1, n1) - eDwTypes_7.HC.Point3.dot(p0, n1)) /
                    eDwTypes_7.HC.Point3.dot(w0, n1);
                var orig0 = eDwTypes_7.HC.Point3.add(p0, w0.scale(k0));
                var w1 = eDwTypes_7.HC.Point3.cross(v, n1);
                var k1 = (eDwTypes_7.HC.Point3.dot(p0, n0) - eDwTypes_7.HC.Point3.dot(p1, n0)) /
                    eDwTypes_7.HC.Point3.dot(w1, n0);
                var orig1 = eDwTypes_7.HC.Point3.add(p1, w1.scale(k1));
                var vec0 = eDwTypes_7.HC.Point3.subtract(p0, orig0);
                var vec1 = eDwTypes_7.HC.Point3.subtract(p1, orig1);
                var radius = Math.max(vec0.length(), vec1.length());
                var model = this.mViewer.getModel();
                var dist = iExtraInfo;
                this.mDistLine.setDeltaEnds(dist.pos1, dist.pos2);
                this.mNDistLine.setDeltaEnds(orig0, orig0);
                this.mNDistLineExt0.setEnds(orig0, orig0);
                this.mNDistLineExt1.setEnds(orig1, orig1);
                this.avoidDuplication();
                this.setAvailibility(true);
            }
            else {
                var distP0 = p0.copy();
                var distP1 = new eDwTypes_7.HC.Point3(0, 0, 0);
                if (0 !== eDwTypes_7.HC.Point3.dot(n0, n1)) {
                    var k = (eDwTypes_7.HC.Point3.dot(p1, n1) - eDwTypes_7.HC.Point3.dot(p0, n1)) /
                        eDwTypes_7.HC.Point3.dot(n0, n1);
                    distP1 = eDwTypes_7.HC.Point3.add(p0, eDwTypes_7.HC.Point3.scale(n0, k));
                }
                var model = this.mViewer.getModel();
                var dist = iExtraInfo;
                this.mDistLine.setDeltaEnds(dist.pos1, dist.pos2);
                this.mNDistLine.setDeltaEnds(distP0, distP1);
                this.mNDistLineExt0.setEnds(distP0, p0);
                this.mNDistLineExt1.setEnds(distP1, p1);
                this.avoidDuplication();
                this.setAvailibility(true);
            }
        };
        eDwMeasureAuxDistance.prototype.setByLinePlane = function (iEdge, iFace, iEdgeObj, iFaceObj) {
            this.reset();
            var linePoints = eDwMeasureUtils.getRealLinePoints(iEdgeObj, this.mViewer.getModel());
            var v0 = eDwTypes_7.HC.Point3.subtract(linePoints.A, linePoints.B);
            v0.normalize();
            var p0 = iEdgeObj.getPosition();
            var n1 = iFace.normal;
            var p1 = iFaceObj.getPosition();
            n1.normalize();
            var angle = eDwMeasureUtils.getAngle(v0, n1);
            var dist = 0;
            if (90 !== angle && 270 !== angle) {
                var k = (eDwTypes_7.HC.Point3.dot(p1, n1) - eDwTypes_7.HC.Point3.dot(p0, n1)) /
                    eDwTypes_7.HC.Point3.dot(v0, n1);
                var orig = eDwTypes_7.HC.Point3.add(p0, eDwTypes_7.HC.Point3.scale(v0, k));
                var vec0 = eDwTypes_7.HC.Point3.subtract(p0, orig);
                var vec1 = eDwTypes_7.HC.Point3.subtract(p1, orig);
                if (0 !== angle && 180 !== angle) {
                    vec1 = eDwTypes_7.HC.Point3.cross(n1, eDwTypes_7.HC.Point3.cross(vec0, n1));
                }
                vec1.normalize();
                vec1.scale(vec0.length());
                var radius = Math.max(vec0.length(), vec1.length());
                var axis = eDwTypes_7.HC.Point3.cross(vec0, vec1);
                axis.normalize();
                var orig0 = eDwTypes_7.HC.Point3.add(orig, eDwTypes_7.HC.Point3.scale(axis, radius * 0.25));
                var orig1 = eDwTypes_7.HC.Point3.subtract(orig, eDwTypes_7.HC.Point3.scale(axis, radius * 0.25));
                if (0 !== angle && 180 !== angle) {
                    vec1 = eDwTypes_7.HC.Point3.cross(n1, eDwTypes_7.HC.Point3.cross(vec0, n1));
                    var proj = eDwTypes_7.HC.Point3.dot(eDwTypes_7.HC.Point3.subtract(orig, p1), axis);
                    orig1 = eDwTypes_7.HC.Point3.subtract(orig, eDwTypes_7.HC.Point3.scale(axis, proj));
                    orig0 = orig.copy();
                }
                this.avoidDuplication();
                this.setAvailibility(false);
            }
            else {
                var distP0 = p0.copy();
                var distP1 = new eDwTypes_7.HC.Point3(0, 0, 0);
                var k1 = eDwTypes_7.HC.Point3.dot(n1, eDwTypes_7.HC.Point3.subtract(p0, p1));
                distP1 = eDwTypes_7.HC.Point3.subtract(p0, eDwTypes_7.HC.Point3.scale(n1, k1));
                var pL = p0.copy();
                var pP = eDwTypes_7.HC.Point3.subtract(p1, pL);
                pP = eDwTypes_7.HC.Point3.scale(n1, eDwTypes_7.HC.Point3.dot(n1, pP));
                pP = eDwTypes_7.HC.Point3.add(pL, pP);
                this.mDistLine.setDeltaEnds(p0, p0);
                this.mNDistLine.setDeltaEnds(pL, pP);
                this.mNDistLineExt0.setEnds(pL, p0);
                this.mNDistLineExt1.setEnds(pP, p1);
                this.avoidDuplication();
                this.setAvailibility(true);
            }
        };
        eDwMeasureAuxDistance.prototype.setByLineLine = function (iEdge0, iEdge1, iEdgeObj0, iEdgeObj1) {
            var line0 = eDwMeasureUtils.getRealLinePoints(iEdgeObj0, this.mViewer.getModel());
            var line1 = eDwMeasureUtils.getRealLinePoints(iEdgeObj1, this.mViewer.getModel());
            var p0 = iEdgeObj0.getPosition();
            var p1 = iEdgeObj1.getPosition();
            var v0 = eDwTypes_7.HC.Point3.subtract(line0.A, line0.B);
            var v1 = eDwTypes_7.HC.Point3.subtract(line1.A, line1.B);
            var angle = eDwMeasureUtils.getAngle(v0, v1);
            var dist = 0;
            if (0 !== angle && 180 !== angle) {
                var tmp = eDwMeasureUtils.distanceLineLineCross(line0, line1);
                this.mDistLine.setDeltaEnds(tmp.P0, tmp.P1);
                this.mNDistLine.setDeltaEnds(tmp.Cp0, tmp.Cp1);
                this.mNDistLineExt0.setEnds(tmp.Cp0, tmp.P0);
                this.mNDistLineExt1.setEnds(tmp.Cp1, tmp.P1);
                this.avoidDuplication();
                this.setAvailibility(true);
            }
            else {
                var tmp = eDwMeasureUtils.distanceLineLinePara(line0, line1, p0, p1);
                this.mDistLine.setDeltaEnds(tmp.P0, tmp.P1);
                this.mNDistLine.setDeltaEnds(tmp.Cp0, tmp.Cp1);
                this.mNDistLineExt0.setEnds(tmp.Cp0, tmp.P0);
                this.mNDistLineExt1.setEnds(tmp.Cp1, tmp.P1);
                this.avoidDuplication();
                this.setAvailibility(true);
            }
        };
        eDwMeasureAuxDistance.prototype.isAvailible = function () {
            return this.mIsAvailible;
        };
        eDwMeasureAuxDistance.prototype.setAvailibility = function (iIsOn) {
            this.mIsAvailible = iIsOn;
        };
        eDwMeasureAuxDistance.prototype.getLabels = function () {
            var labels = [];
            if (this.mIsAvailible) {
                labels = labels.concat(this.mDistLine.getLabels());
                labels = labels.concat(this.mNDistLine.getLabels());
            }
            return labels;
        };
        eDwMeasureAuxDistance.prototype.setShowDelta = function (iShowDelta) {
            this.mShowDelta = iShowDelta;
            this.mDistLine.setDeltaDistAvailability(iShowDelta, true);
            if (this.mDuplicateDist) {
                this.mNDistLine.setDeltaDistAvailability(iShowDelta, true);
            }
            else {
                this.mNDistLine.setDeltaDistAvailability(false, true);
            }
        };
        eDwMeasureAuxDistance.prototype.getText = function (iUnit) {
            if (!this.mIsAvailible)
                return "";
            var str = "";
            var dist = this.mDistLine.getDelta();
            var distN = this.mNDistLine.getDelta();
            var showDist = dist.length() > distN.length();
            var showNDist = distN.length() > 0;
            var newLine = "";
            if (showDist) {
                var label = this.mDistLine.getDistLabel();
                label.setStringContent(iUnit);
                str += label.getText(iUnit);
                newLine = "\n";
            }
            if (showNDist) {
                var labelN = this.mNDistLine.getDistLabel();
                labelN.setStringContent(iUnit);
                str += newLine + "Normal" + labelN.getText(iUnit);
            }
            if (this.mShowDelta) {
                var labelD = this.mDistLine.getDeltaLabel();
                labelD.setStringContent(iUnit);
                str += "\n" + labelD.getText(iUnit);
            }
            return str;
        };
        eDwMeasureAuxDistance.prototype.setUnits = function (iUnit) {
            this.mUnit = iUnit;
        };
        eDwMeasureAuxDistance.getAngle = function (iV0, iV1) {
            var vec0 = iV0.copy();
            var vec1 = iV1.copy();
            vec0.normalize();
            vec1.normalize();
            var dotVal = eDwTypes_7.HC.Point3.dot(vec0, vec1);
            if (0 === dotVal)
                return 90;
            dotVal = Math.min(dotVal, 1);
            dotVal = Math.max(dotVal, -1);
            var angle = Math.acos(dotVal);
            var angleDgree = angle * 180 / Math.PI;
            var n = eDwTypes_7.HC.Point3.cross(vec0, vec1);
            n.normalize();
            if (isNaN(n.x) || isNaN(n.y) || isNaN(n.z))
                return 0;
            return angleDgree;
        };
        return eDwMeasureAuxDistance;
    }());
    ;
    var eDwMeasureAuxAngle = (function () {
        function eDwMeasureAuxAngle(iViewer) {
            this.mAngle = 0;
            this.mViewer = iViewer;
            this.mAngleFace = new eDwTypes_7.HC.Markup.Shape.Polygon();
            this.mAngleArc = new eDwTypes_7.HC.Markup.Shape.Polyline();
            this.mAngleEdge = new eDwTypes_7.HC.Markup.Shape.Polyline();
            this.mAngleTip = new eDwTypes_7.HC.Markup.Shape.Circle();
            var colorAngleFill = new eDwTypes_7.HC.Color(41, 128, 185);
            var colorPolygonEdge = new eDwTypes_7.HC.Color(255, 0, 0);
            var colorPoint = new eDwTypes_7.HC.Color(137, 196, 244);
            var colorEdgeArc = new eDwTypes_7.HC.Color(52, 73, 94);
            var colorEdgeStroke = new eDwTypes_7.HC.Color(100, 100, 100);
            var widthEdge = 3;
            var arrowSize = 5;
            var pointSize = 7;
            this.mAngleFace.setFillColor(colorAngleFill);
            this.mAngleFace.setStrokeWidth(0);
            this.mAngleFace.setFillOpacity(0.5);
            this.mAngleArc.setStrokeColor(colorEdgeArc);
            this.mAngleArc.setEndEndcapColor(colorEdgeArc);
            this.mAngleArc.setStartEndcapColor(colorEdgeArc);
            this.mAngleArc.setStrokeWidth(widthEdge);
            this.mAngleArc.setEndcapType(eDwTypes_7.HC.Markup.Shape.EndcapType.Arrowhead);
            this.mAngleArc.setEndEndcapSize(arrowSize);
            this.mAngleArc.setStartEndcapSize(arrowSize);
            this.mAngleEdge.setStrokeColor(colorEdgeStroke);
            this.mAngleEdge.setStrokeWidth(widthEdge + 1);
            this.mAngleTip.setFillColor(colorPoint);
            this.mAngleTip.setStrokeColor(colorEdgeStroke);
            this.mAngleTip.setStrokeWidth(widthEdge);
            this.mAngleTip.setRadius(pointSize);
        }
        eDwMeasureAuxAngle.prototype.reset = function () {
            this.mIsAvailible = false;
            this.mAngle = 0;
            this.mVec0 = new eDwTypes_7.HC.Point3(0, 0, 1);
            this.mVec1 = new eDwTypes_7.HC.Point3(0, 0, 1);
            this.mTip = new eDwTypes_7.HC.Point3(0, 0, 0);
            this.mPointsArcEdge = [];
            this.mPointsBorder = null;
        };
        eDwMeasureAuxAngle.prototype.draw = function (consice) {
            if (!this.mIsAvailible ||
                0 === this.mAngle || 180 == this.mAngle)
                return;
            this.projectPoints();
            var renderer = this.mViewer.getMarkupManager().getRenderer();
            renderer.drawPolygon(this.mAngleFace);
            renderer.drawPolyline(this.mAngleArc);
            renderer.drawPolyline(this.mAngleEdge);
            if (!consice) {
                renderer.drawCircle(this.mAngleTip);
            }
        };
        eDwMeasureAuxAngle.prototype.setByPlanePlane = function (iFace0, iFace1, iFaceObj0, iFaceObj1) {
            this.reset();
            var model = this.mViewer.getModel();
            var pick0 = iFaceObj0.getPosition();
            var pick1 = iFaceObj1.getPosition();
            var n0 = iFace0.normal;
            n0.normalize();
            var p0 = pick0.copy();
            var n1 = iFace1.normal;
            n1.normalize();
            var p1 = pick1.copy();
            var angle = eDwMeasureUtils.getAngle(n0, n1);
            if (0 !== angle && 180 !== angle) {
                var v = eDwTypes_7.HC.Point3.cross(n0, n1);
                var w0 = eDwTypes_7.HC.Point3.cross(v, n0);
                var k0 = (eDwTypes_7.HC.Point3.dot(p1, n1) - eDwTypes_7.HC.Point3.dot(p0, n1)) /
                    eDwTypes_7.HC.Point3.dot(w0, n1);
                var orig0 = eDwTypes_7.HC.Point3.add(p0, w0.scale(k0));
                var w1 = eDwTypes_7.HC.Point3.cross(v, n1);
                var k1 = (eDwTypes_7.HC.Point3.dot(p0, n0) - eDwTypes_7.HC.Point3.dot(p1, n0)) /
                    eDwTypes_7.HC.Point3.dot(w1, n0);
                var orig1 = eDwTypes_7.HC.Point3.add(p1, w1.scale(k1));
                var vec0 = eDwTypes_7.HC.Point3.subtract(p0, orig0);
                var vec1 = eDwTypes_7.HC.Point3.subtract(p1, orig1);
                var radius = Math.max(vec0.length(), vec1.length());
                this.mVec0 = vec0;
                this.mVec1 = vec1;
                this.mTip = p0;
                this.setAvailibility(true);
                var maxScale = this.maxScale(iFace0, iFaceObj0);
                this.mAngle = this.computeAnglePoints(maxScale);
            }
            else {
                var k = eDwTypes_7.HC.Point3.dot(eDwTypes_7.HC.Point3.subtract(p0, p1), n0);
                var pn1 = eDwTypes_7.HC.Point3.add(p1, eDwTypes_7.HC.Point3.scale(n0, k));
                var vec = eDwTypes_7.HC.Point3.subtract(pn1, p0);
                if (0 === vec.x && 0 === vec.y && 0 === vec.z) {
                    var tmp = new eDwTypes_7.HC.Point3(1, 0, 0);
                    vec = eDwTypes_7.HC.Point3.cross(n0, tmp);
                }
                if (0 === vec.x && 0 === vec.y && 0 === vec.z) {
                    var tmp = new eDwTypes_7.HC.Point3(0, 1, 0);
                    vec = eDwTypes_7.HC.Point3.cross(n0, tmp);
                }
                this.mVec0 = vec.copy();
                this.mVec1 = vec.copy();
                this.mTip = p0;
                this.setAvailibility(true);
                var maxScale = this.maxScale(iFace0, iFaceObj0);
                this.mAngle = this.computeAnglePoints(maxScale);
            }
        };
        eDwMeasureAuxAngle.prototype.setByLinePlane = function (iEdge, iFace, iEdgeObj, iFaceObj) {
            this.setByLinePlaneOrig(iEdge, iFace, iEdgeObj, iFaceObj, false);
        };
        eDwMeasureAuxAngle.prototype.setByPlaneLine = function (iFace, iEdge, iFaceObj, iEdgeObj) {
            this.setByLinePlaneOrig(iEdge, iFace, iEdgeObj, iFaceObj, true);
        };
        eDwMeasureAuxAngle.prototype.setByLineLine = function (iEdge0, iEdge1, iEdgeObj0, iEdgeObj1) {
            this.reset();
            var model = this.mViewer.getModel();
            var line0 = eDwMeasureUtils.getRealLinePoints(iEdgeObj0, model);
            var line1 = eDwMeasureUtils.getRealLinePoints(iEdgeObj1, model);
            var p0 = iEdgeObj0.getPosition();
            var p1 = iEdgeObj1.getPosition();
            var v0 = eDwTypes_7.HC.Point3.subtract(line0.A, line0.B);
            var v1 = eDwTypes_7.HC.Point3.subtract(line1.A, line1.B);
            var angle = eDwMeasureUtils.getAngle(v0, v1);
            if (0 !== angle && 180 !== angle) {
                var tmp = eDwMeasureUtils.distanceLineLineCross(line0, line1);
                var orig0 = tmp.Cp0;
                var orig1 = tmp.Cp1;
                var vec0 = eDwTypes_7.HC.Point3.subtract(p0, orig0);
                var vec1 = eDwTypes_7.HC.Point3.subtract(p1, orig1);
                this.mVec0 = vec0;
                this.mVec1 = vec1;
                this.mTip = p1;
                this.setAvailibility(true);
                var maxScale = this.maxScale(iEdge1, iEdgeObj1);
                this.mAngle = this.computeAnglePoints(maxScale);
            }
            else {
                var k1 = (eDwTypes_7.HC.Point3.dot(p1, v0) - eDwTypes_7.HC.Point3.dot(p0, v0)) /
                    eDwTypes_7.HC.Point3.dot(v0, v0);
                var p1n = eDwTypes_7.HC.Point3.add(p0, eDwTypes_7.HC.Point3.scale(v0, k1));
                var k0 = (eDwTypes_7.HC.Point3.dot(p0, v1) - eDwTypes_7.HC.Point3.dot(p1, v1)) /
                    eDwTypes_7.HC.Point3.dot(v1, v1);
                var p0n = eDwTypes_7.HC.Point3.add(p1, eDwTypes_7.HC.Point3.scale(v1, k0));
                var vec = eDwTypes_7.HC.Point3.subtract(p0n, p1);
                if (0 === vec.x && 0 === vec.y && 0 === vec.z) {
                    vec = v0.copy();
                }
                this.mVec0 = vec.copy();
                this.mVec1 = vec.copy();
                this.mTip = p1;
                this.setAvailibility(true);
                var maxScale = this.maxScale(iEdge1, iEdgeObj1);
                this.mAngle = this.computeAnglePoints(maxScale);
            }
        };
        eDwMeasureAuxAngle.prototype.getLabels = function () {
            var labels = [];
            if (this.mIsAvailible && 0 !== this.mAngle) {
                var label = new eDwMeasureLabel(this.mViewer);
                label.addItem(new eDwMeasureResult("Angle", this.mAngle, MeasureType.Angle));
                label.setLeader(this.getAngleArcCenter());
                labels.push(label);
            }
            return labels;
        };
        eDwMeasureAuxAngle.prototype.getAngleArcCenter = function () {
            var point = new eDwTypes_7.HC.Point3(0, 0, 0);
            var n = this.mPointsArcEdge.length;
            var midPoint = this.mPointsArcEdge[Math.round(n / 2)];
            point.assign(midPoint);
            return point;
        };
        eDwMeasureAuxAngle.prototype.isAvailible = function () {
            return this.mIsAvailible;
        };
        eDwMeasureAuxAngle.prototype.getText = function (iUnit) {
            var label = new eDwMeasureLabel(this.mViewer);
            label.addItem(new eDwMeasureResult("Angle", this.mAngle, MeasureType.Angle));
            label.setStringContent(iUnit);
            var str = "";
            str += label.getText(iUnit);
            return str;
        };
        eDwMeasureAuxAngle.prototype.setAvailibility = function (iIsOn) {
            this.mIsAvailible = iIsOn;
        };
        eDwMeasureAuxAngle.prototype.setByLinePlaneOrig = function (iEdge, iFace, iEdgeObj, iFaceObj, iReverseOrder) {
            this.reset();
            var linePoints = eDwMeasureUtils.getRealLinePoints(iEdgeObj, this.mViewer.getModel());
            var v0 = eDwTypes_7.HC.Point3.subtract(linePoints.A, linePoints.B);
            v0.normalize();
            var p0 = iEdgeObj.getPosition();
            var n1 = iFace.normal;
            var p1 = iFaceObj.getPosition();
            n1.normalize();
            var angle = eDwMeasureUtils.getAngle(v0, n1);
            if (90 !== angle && 270 !== angle) {
                var k = (eDwTypes_7.HC.Point3.dot(p1, n1) - eDwTypes_7.HC.Point3.dot(p0, n1)) /
                    eDwTypes_7.HC.Point3.dot(v0, n1);
                var orig = eDwTypes_7.HC.Point3.add(p0, eDwTypes_7.HC.Point3.scale(v0, k));
                var vec0 = eDwTypes_7.HC.Point3.subtract(p0, orig);
                var vec1 = eDwTypes_7.HC.Point3.subtract(p1, orig);
                if (0 !== angle && 180 !== angle) {
                    vec1 = eDwTypes_7.HC.Point3.cross(n1, eDwTypes_7.HC.Point3.cross(vec0, n1));
                }
                vec1.normalize();
                vec1.scale(vec0.length());
                var radius = Math.max(vec0.length(), vec1.length());
                var axis = eDwTypes_7.HC.Point3.cross(vec0, vec1);
                axis.normalize();
                var orig0 = eDwTypes_7.HC.Point3.add(orig, eDwTypes_7.HC.Point3.scale(axis, radius * 0.25));
                var orig1 = eDwTypes_7.HC.Point3.subtract(orig, eDwTypes_7.HC.Point3.scale(axis, radius * 0.25));
                if (0 !== angle && 180 !== angle) {
                    vec1 = eDwTypes_7.HC.Point3.cross(n1, eDwTypes_7.HC.Point3.cross(vec0, n1));
                    var proj = eDwTypes_7.HC.Point3.dot(eDwTypes_7.HC.Point3.subtract(orig, p1), axis);
                    orig1 = eDwTypes_7.HC.Point3.subtract(orig, eDwTypes_7.HC.Point3.scale(axis, proj));
                    orig0 = orig.copy();
                }
                this.mVec0 = vec0;
                this.mVec1 = vec1;
                this.mTip = iReverseOrder ? p0 : p1;
                this.setAvailibility(true);
                var maxScale = iReverseOrder ?
                    this.maxScale(iEdge, iEdgeObj) : this.maxScale(iFace, iFaceObj);
                this.mAngle = this.computeAnglePoints(maxScale);
            }
            else {
                var k = (eDwTypes_7.HC.Point3.dot(p1, v0) - eDwTypes_7.HC.Point3.dot(p0, v0)) /
                    eDwTypes_7.HC.Point3.dot(v0, v0);
                var pn = eDwTypes_7.HC.Point3.add(p0, eDwTypes_7.HC.Point3.scale(v0, k));
                var vec = iReverseOrder ? eDwTypes_7.HC.Point3.subtract(pn, p0)
                    : eDwTypes_7.HC.Point3.subtract(p0, pn);
                if (0 === vec.x && 0 === vec.y && 0 === vec.z) {
                    vec = v0.copy();
                }
                this.mVec0 = vec.copy();
                this.mVec1 = vec.copy();
                this.mTip = iReverseOrder ? p0 : p1;
                this.setAvailibility(true);
                var maxScale = iReverseOrder ?
                    this.maxScale(iEdge, iEdgeObj) : this.maxScale(iFace, iFaceObj);
                this.mAngle = this.computeAnglePoints(maxScale);
            }
        };
        eDwMeasureAuxAngle.prototype.maxScale = function (iPorp, iObj) {
            var lineEntity = iObj.getLineEntity();
            var faceEntity = iObj.getFaceEntity();
            if (lineEntity) {
                var line = eDwMeasureUtils.getRealLinePoints(iObj, this.mViewer.getModel());
                return eDwTypes_7.HC.Point3.subtract(line.A, line.B).length();
            }
            else {
                var box = faceEntity.getBounding();
                return eDwTypes_7.HC.Point3.subtract(box.max, box.min).length();
            }
        };
        eDwMeasureAuxAngle.prototype.computeAnglePoints = function (iMaxLen) {
            if (!this.mIsAvailible)
                return 0;
            var radius = Math.max(this.mVec0.length(), this.mVec1.length());
            radius = Math.min(radius * 0.8, iMaxLen * 0.6);
            var vec0 = this.mVec0.copy();
            var vec1 = this.mVec1.copy();
            var orig = this.mTip.copy();
            vec0.normalize();
            vec1.normalize();
            var angleDegree = eDwMeasureUtils.getAngle(vec0, vec1);
            var angle = angleDegree * Math.PI / 180;
            var normal = eDwTypes_7.HC.Point3.cross(vec0, vec1);
            var vecY = eDwTypes_7.HC.Point3.cross(normal, vec0);
            vecY.normalize();
            if (isNaN(vecY.x) || isNaN(vecY.y) || isNaN(vecY.z)) {
                angleDegree = 0;
                var num = 2;
                var arcPoints = [];
                for (var i = 0; i <= num; ++i) {
                    var point = eDwTypes_7.HC.Point3.add(orig, eDwTypes_7.HC.Point3.scale(vec0, radius));
                    arcPoints.push(point);
                }
                this.mPointsArcEdge = arcPoints;
            }
            else {
                var num = 20;
                var arcPoints = [];
                for (var i = 0; i <= num; ++i) {
                    var aX = vec0.copy();
                    var aY = vecY.copy();
                    var alpha = angle * i / num;
                    var vX = aX.scale(Math.cos(alpha) * radius);
                    var vY = aY.scale(Math.sin(alpha) * radius);
                    var point = eDwTypes_7.HC.Point3.add(orig, eDwTypes_7.HC.Point3.add(vX, vY));
                    arcPoints.push(point);
                }
                this.mPointsArcEdge = arcPoints;
            }
            var p0 = eDwTypes_7.HC.Point3.add(orig, eDwTypes_7.HC.Point3.scale(vec0, 1.2 * radius));
            var p1 = eDwTypes_7.HC.Point3.add(orig, eDwTypes_7.HC.Point3.scale(vec1, 1.2 * radius));
            this.mPointsBorder = { end0: p0, end1: p1, tip: orig.copy() };
            return angleDegree;
        };
        eDwMeasureAuxAngle.prototype.projectPoints = function () {
            if (!this.mIsAvailible)
                return;
            this.mAngleFace.clearPoints();
            this.mAngleArc.clearPoints();
            this.mAngleEdge.clearPoints();
            if (0 === this.mPointsArcEdge.length || !this.mPointsBorder)
                return;
            var view = this.mViewer.getView();
            this.mAngleFace.pushPoint(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mTip)));
            for (var i = 0; i < this.mPointsArcEdge.length; ++i) {
                var p = eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mPointsArcEdge[i]));
                this.mAngleFace.pushPoint(p);
                this.mAngleArc.pushPoint(p);
            }
            this.mAngleFace.pushPoint(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mTip)));
            this.mAngleEdge.pushPoint(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mPointsBorder.end0)));
            this.mAngleEdge.pushPoint(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mPointsBorder.tip)));
            this.mAngleEdge.pushPoint(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mPointsBorder.end1)));
            this.mAngleTip.setCenter(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mPointsBorder.tip)));
        };
        return eDwMeasureAuxAngle;
    }());
    ;
    var eDwMeasureAuxPick = (function () {
        function eDwMeasureAuxPick(iViewer) {
            this.mDeltas = [];
            this.mCircles = [];
            this.mPoints = [];
            this.mConcise = false;
            this.mViewer = iViewer;
        }
        eDwMeasureAuxPick.prototype.reset = function () {
            this.mIsAvailible = false;
            this.mDeltas = [];
            this.mCircles = [];
            this.mPoints = [];
        };
        eDwMeasureAuxPick.prototype.draw = function (consice) {
            if (!this.mIsAvailible)
                return;
            this.updateDeltaDistStatus();
            for (var i = 0; i < this.mDeltas.length; ++i) {
                this.mDeltas[i].draw(consice);
            }
            var renderer = this.mViewer.getMarkupManager().getRenderer();
            if (consice)
                return;
            for (var i = 0; i < this.mCircles.length; ++i) {
                var view = this.mViewer.getView();
                this.mCircles[i].setCenter(eDwTypes_7.HC.Point2.fromPoint3(view.projectPoint(this.mPoints[i])));
                renderer.drawCircle(this.mCircles[i]);
            }
        };
        eDwMeasureAuxPick.prototype.getLabels = function () {
            if (!this.mIsAvailible)
                return [];
            this.updateDeltaDistStatus();
            var labels = [];
            var n = this.mPoints.length;
            for (var i = 0; i < this.mDeltas.length; ++i) {
                if (this.mConcise && i !== this.mDeltas.length - 1) {
                    continue;
                }
                labels = labels.concat(this.mDeltas[i].getLabels());
            }
            return labels;
        };
        eDwMeasureAuxPick.prototype.getPointLabels = function () {
            var labels = [];
            var n = this.mPoints.length;
            for (var i = 0; i < n; ++i) {
                var label = new eDwMeasureLabel(this.mViewer);
                var pointName = "Coordinate";
                label.addItem(new eDwMeasureResult(pointName, this.mPoints[i].copy(), MeasureType.Coordinate));
                label.setLeader(this.mPoints[i].copy());
                labels.push(label);
            }
            return labels;
        };
        eDwMeasureAuxPick.prototype.regeneratePicks = function (iSelObjs) {
            this.twoPointPickUpdate(iSelObjs);
        };
        eDwMeasureAuxPick.prototype.twoPointPickUpdate = function (iSelObjs) {
            this.reset();
            var n = iSelObjs.length;
            if (0 === n)
                return;
            var color = new eDwTypes_7.HC.Color(41, 128, 185);
            var pos1 = iSelObjs[n - 1].getPosition();
            var circle1 = this.createCircle(pos1);
            var line0 = new eDwMeasureAuxDelta(this.mViewer);
            line0.setDistLineColor(color);
            line0.setDeltaEnds(pos1, pos1);
            this.mDeltas.push(line0);
            if (n > 1) {
                var pos0 = iSelObjs[0].getPosition();
                var circle0 = this.createCircle(pos0);
                this.mCircles.push(circle0);
                this.mPoints.push(pos0);
                var line = new eDwMeasureAuxDelta(this.mViewer);
                line.setDistLineColor(color);
                line.setDeltaEnds(pos0, pos1);
                this.mDeltas.push(line);
            }
            this.mCircles.push(circle1);
            this.mPoints.push(pos1);
            this.mIsAvailible = true;
        };
        eDwMeasureAuxPick.prototype.adjustPickPoints = function (iSelObjs) {
            this.twoPointPickUpdate(iSelObjs);
        };
        eDwMeasureAuxPick.prototype.setDeltaDistAvailability = function (iIsDelta, iIsDist) {
            this.mShowDelta = iIsDelta;
            this.mShowDist = iIsDist;
        };
        eDwMeasureAuxPick.prototype.isAvailible = function () {
            return this.mIsAvailible;
        };
        eDwMeasureAuxPick.prototype.getText = function (iUnit) {
            if (!this.mIsAvailible)
                return "";
            if (0 === this.mPoints.length)
                return "";
            var label = new eDwMeasureLabel(this.mViewer);
            var str = label.getText(iUnit);
            if (this.mPoints.length > 1) {
                label.reset();
                label.addItem(new eDwMeasureResult("Total Length", this.getTotalLength(), MeasureType.Distance));
                str += "\n\n" + label.getText(iUnit);
            }
            return str;
        };
        eDwMeasureAuxPick.prototype.setConcise = function (iEnable) {
            this.mConcise = iEnable;
        };
        eDwMeasureAuxPick.prototype.createCircle = function (iStart) {
            var colorAngleFill = new eDwTypes_7.HC.Color(41, 128, 185);
            var colorPolygonEdge = new eDwTypes_7.HC.Color(255, 0, 0);
            var colorPoint = new eDwTypes_7.HC.Color(137, 196, 244);
            var colorEdgeArc = new eDwTypes_7.HC.Color(52, 73, 94);
            var colorEdgeStroke = new eDwTypes_7.HC.Color(100, 100, 100);
            var widthEdge = 3;
            var arrowSize = 5;
            var pointSize = 7;
            var point = new eDwTypes_7.HC.Markup.Shape.Circle();
            point.setFillColor(colorPoint);
            point.setStrokeColor(colorEdgeStroke);
            point.setStrokeWidth(widthEdge);
            point.setRadius(pointSize);
            return point;
        };
        eDwMeasureAuxPick.prototype.getTotalLength = function () {
            var totalLen = 0;
            for (var i = 1; i < this.mDeltas.length; ++i) {
                totalLen += this.mDeltas[i].getDistance();
            }
            return totalLen;
        };
        eDwMeasureAuxPick.prototype.updateDeltaDistStatus = function () {
            for (var i = 0; i < this.mDeltas.length; ++i) {
                if (0 === i) {
                    this.mDeltas[i].setDeltaDistAvailability(this.mShowDelta, false);
                }
                else {
                    this.mDeltas[i].setDeltaDistAvailability(false, true);
                }
            }
        };
        return eDwMeasureAuxPick;
    }());
    ;
    var eDwMeasureAuxGeo = (function () {
        function eDwMeasureAuxGeo(iViewer, iUnit) {
            this.mResultLabels = [];
            this.mInfoLabels = [];
            this.mShowDelta = true;
            this.mMeasurePick = false;
            this.mDrawLabel = true;
            this.mConcise = false;
            this.mLabelIDs = [];
            this.mMarkupLabels = [];
            this.mViewer = iViewer;
            this.mUnit = iUnit;
            var colorPolygon = new eDwTypes_7.HC.Color(41, 128, 185);
            var colorPolygonEdge = new eDwTypes_7.HC.Color(255, 0, 0);
            var colorTip = new eDwTypes_7.HC.Color(137, 196, 244);
            var colorEdge0 = new eDwTypes_7.HC.Color(75, 119, 190);
            var colorEdge1 = new eDwTypes_7.HC.Color(52, 73, 94);
            var colorEdge2 = new eDwTypes_7.HC.Color(100, 100, 100);
            var widthEdge = 3;
            var arrowSize = 5;
            this.mAuxAngle = new eDwMeasureAuxAngle(iViewer);
            this.mAuxDist = new eDwMeasureAuxDistance(iViewer);
            this.mAuxDist.setUnits(iUnit);
            this.mOtherResults = new eDwMeasureAuxMessage(iViewer);
            this.mMessage = new eDwMeasureAuxMessage(iViewer);
            this.mPickInfo = new eDwMeasureAuxMessage(iViewer);
            this.mAuxPick = new eDwMeasureAuxPick(iViewer);
        }
        eDwMeasureAuxGeo.prototype.setUnits = function (iUnit) {
            this.mUnit = iUnit;
            this.mAuxDist.setUnits(iUnit);
            for (var i = 0; i < this.mResultLabels.length; ++i) {
                this.mResultLabels[i].setStringContent(iUnit);
            }
        };
        eDwMeasureAuxGeo.prototype.reset = function () {
            this.mIsAvailible = false;
            this.mAuxAngle.reset();
            this.mAuxDist.reset();
            this.mOtherResults.reset();
            this.mMessage.reset();
            this.mPickInfo.reset();
            this.mResultLabels = [];
            this.mInfoLabels = [];
            this.clearMarkupLabels();
        };
        eDwMeasureAuxGeo.prototype.draw = function () {
            if (!this.mIsAvailible)
                return;
            if (!this.mMeasurePick) {
                this.mAuxAngle.draw(this.mConcise);
                this.mAuxDist.draw(this.mConcise);
            }
            else {
                this.mAuxPick.draw(this.mConcise);
            }
            if (this.mDrawLabel) {
                if (this.mConcise) {
                    this.drawResultLabels();
                }
                this.drawInfoLabels();
            }
        };
        eDwMeasureAuxGeo.prototype.addMarkupLabels = function () {
            this.clearMarkupLabels();
            var markupMgr = this.mViewer.getMarkupManager();
            var n = this.mResultLabels.length;
            for (var i = 0; i < n; ++i) {
                var label = new eDwLabelItem(this.mViewer, this.mResultLabels[i]);
                var id = markupMgr.registerMarkup(label);
                this.mLabelIDs.push(id);
                this.mMarkupLabels.push(label);
            }
        };
        eDwMeasureAuxGeo.prototype.clearMarkupLabels = function () {
            var markupMgr = this.mViewer.getMarkupManager();
            var n = this.mLabelIDs.length;
            for (var i = 0; i < n; ++i) {
                markupMgr.unregisterMarkup(this.mLabelIDs[i]);
            }
            this.mLabelIDs = [];
            this.mMarkupLabels = [];
        };
        eDwMeasureAuxGeo.prototype.drawResultLabels = function () {
            var n = this.mResultLabels.length;
            for (var i = 0; i < n; ++i) {
                this.mResultLabels[i].drawLabel();
            }
        };
        eDwMeasureAuxGeo.prototype.drawInfoLabels = function () {
            var m = this.mInfoLabels.length;
            for (var i = 0; i < m; ++i) {
                this.mInfoLabels[i].drawLabel();
            }
        };
        eDwMeasureAuxGeo.prototype.setByVertexVertex = function (iVertObj0, iVertObj1) {
            this.reset();
            var p0 = iVertObj0.getPosition();
            var p1 = iVertObj1.getPosition();
            this.mAuxDist.setByPointPoint(p0, p1);
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.setByVertexLine = function (iVertObj, iEdge, iEdgeObj) {
            this.reset();
            var p0 = iVertObj.getPosition();
            this.mAuxDist.setByPointLine(p0, iEdge, iEdgeObj);
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.setByVertexCircle = function (iVertObj, iCircleOrig, iEdgeObj) {
            this.reset();
            var p0 = iVertObj.getPosition();
            var circle = new eDwTypes_7.HC.SubentityProperties.CircleElement();
            circle.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            circle.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            circle.radius = 0;
            eDwMeasureUtils.getRealCircleProperties(iEdgeObj, iCircleOrig, circle, this.mViewer.getModel());
            this.mAuxDist.setByPointPoint(p0, circle.origin);
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.setByVertexPlane = function (iVertObj, iFaceOrig, iFaceObj, iExtraInfo) {
            this.reset();
            var p0 = iVertObj.getPosition();
            var face = new eDwTypes_7.HC.SubentityProperties.PlaneElement();
            face.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            face.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            eDwMeasureUtils.getRealPlaneProperties(iFaceObj, iFaceOrig, face, this.mViewer.getModel());
            this.mAuxDist.setByPointPlane(p0, face, iFaceObj, iExtraInfo);
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.setByPlanePlane = function (iFaceOrig0, iFaceOrig1, iFaceObj0, iFaceObj1, iExtraInfo) {
            this.reset();
            var model = this.mViewer.getModel();
            var face0 = new eDwTypes_7.HC.SubentityProperties.PlaneElement();
            face0.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            face0.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            eDwMeasureUtils.getRealPlaneProperties(iFaceObj0, iFaceOrig0, face0, model);
            var face1 = new eDwTypes_7.HC.SubentityProperties.PlaneElement();
            face1.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            face1.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            eDwMeasureUtils.getRealPlaneProperties(iFaceObj1, iFaceOrig1, face1, model);
            this.mAuxAngle.setByPlanePlane(face0, face1, iFaceObj0, iFaceObj1);
            this.mAuxDist.setByPlanePlane(face0, face1, iFaceObj0, iFaceObj1, iExtraInfo);
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.setByLinePlane = function (iEdge, iFaceOrig, iEdgeObj, iFaceObj) {
            this.reset();
            var face = new eDwTypes_7.HC.SubentityProperties.PlaneElement();
            face.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            face.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            eDwMeasureUtils.getRealPlaneProperties(iFaceObj, iFaceOrig, face, this.mViewer.getModel());
            this.mAuxAngle.setByLinePlane(iEdge, face, iEdgeObj, iFaceObj);
            this.mAuxDist.setByLinePlane(iEdge, face, iEdgeObj, iFaceObj);
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.setByPlaneLine = function (iFaceOrig, iEdge, iFaceObj, iEdgeObj) {
            this.reset();
            var face = new eDwTypes_7.HC.SubentityProperties.PlaneElement();
            face.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            face.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            eDwMeasureUtils.getRealPlaneProperties(iFaceObj, iFaceOrig, face, this.mViewer.getModel());
            this.mAuxAngle.setByPlaneLine(face, iEdge, iFaceObj, iEdgeObj);
            this.mAuxDist.setByLinePlane(iEdge, face, iEdgeObj, iFaceObj);
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.setByLineLine = function (iEdge0, iEdge1, iEdgeObj0, iEdgeObj1) {
            this.reset();
            this.mAuxAngle.setByLineLine(iEdge0, iEdge1, iEdgeObj0, iEdgeObj1);
            this.mAuxDist.setByLineLine(iEdge0, iEdge1, iEdgeObj0, iEdgeObj1);
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.setByCircleCircle = function (iCircleOrig0, iCircleOrig1, iEdgeObj0, iEdgeObj1) {
            this.reset();
            var circle0 = new eDwTypes_7.HC.SubentityProperties.CircleElement();
            circle0.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            circle0.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            circle0.radius = 0;
            eDwMeasureUtils.getRealCircleProperties(iEdgeObj0, iCircleOrig0, circle0, this.mViewer.getModel());
            var circle1 = new eDwTypes_7.HC.SubentityProperties.CircleElement();
            circle1.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            circle1.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            circle1.radius = 0;
            eDwMeasureUtils.getRealCircleProperties(iEdgeObj1, iCircleOrig1, circle1, this.mViewer.getModel());
            this.mAuxDist.setByPointPoint(circle0.origin, circle1.origin);
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.setByCircleLine = function (iCircleOrig0, iEdge1, iEdgeObj0, iEdgeObj1) {
            this.reset();
            var circle0 = new eDwTypes_7.HC.SubentityProperties.CircleElement();
            circle0.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            circle0.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            circle0.radius = 0;
            eDwMeasureUtils.getRealCircleProperties(iEdgeObj0, iCircleOrig0, circle0, this.mViewer.getModel());
            this.mAuxDist.setByPointLine(circle0.origin, iEdge1, iEdgeObj1);
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.setByCirclePlane = function (iCircleOrig, iFaceOrig, iEdgeObj, iFaceObj, iExtraInfo) {
            this.reset();
            var circle = new eDwTypes_7.HC.SubentityProperties.CircleElement();
            circle.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            circle.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            circle.radius = 0;
            eDwMeasureUtils.getRealCircleProperties(iEdgeObj, iCircleOrig, circle, this.mViewer.getModel());
            var face = new eDwTypes_7.HC.SubentityProperties.PlaneElement();
            face.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
            face.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
            eDwMeasureUtils.getRealPlaneProperties(iFaceObj, iFaceOrig, face, this.mViewer.getModel());
            this.mAuxDist.setByPointPlane(circle.origin, face, iFaceObj, iExtraInfo);
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.addPickInfos = function (iSelProps, iSelObjs) {
            var n = iSelObjs.length;
            for (var i = 0; i < n; ++i) {
                if (this.mConcise && i < n - 1)
                    continue;
                var selProp = iSelProps[i];
                var selObj = iSelObjs[i];
                this.mPickInfo.addByVertex(selObj);
                this.mPickInfo.addByCircle(selProp, selObj);
                this.mPickInfo.addByCylinder(selProp, selObj);
                this.mPickInfo.addByLine(selProp, selObj);
                this.mPickInfo.addByPlane(selProp, selObj);
            }
            if (n > 0)
                this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.setAuxPick = function (iSelObjs) {
            this.mAuxPick.adjustPickPoints(iSelObjs);
            this.mAuxPick.setDeltaDistAvailability(this.mShowDelta, true);
        };
        eDwMeasureAuxGeo.prototype.regeneratePicks = function (iSelObjs) {
            this.mAuxPick.regeneratePicks(iSelObjs);
        };
        eDwMeasureAuxGeo.prototype.addMessage = function (iResult, iStart, iColor) {
            this.mMessage.addByResultWithColor(iResult, iStart.copy(), iColor);
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.addOtherResult = function (iResult, iStart) {
            this.mOtherResults.addByResult(iResult, iStart.copy());
            this.setAvailibility(true);
        };
        eDwMeasureAuxGeo.prototype.updateResultLabels = function () {
            this.mResultLabels = [];
            if (!this.mMeasurePick) {
                this.mResultLabels = this.mResultLabels.concat(this.mAuxAngle.getLabels());
                this.mResultLabels = this.mResultLabels.concat(this.mAuxDist.getLabels());
                this.mResultLabels = this.mResultLabels.concat(this.mOtherResults.getLabels());
                this.mResultLabels = this.mResultLabels.concat(this.mMessage.getLabels());
            }
            else {
                this.mResultLabels = this.mResultLabels.concat(this.mAuxPick.getLabels());
            }
            this.distributeLabels();
            if (!this.mConcise) {
                this.addMarkupLabels();
            }
            else {
                this.updateLastInfoLabels();
            }
        };
        eDwMeasureAuxGeo.prototype.updateLastInfoLabels = function () {
            var pLabel = this.mPickInfo.getLabels();
            var aLabel = this.mAuxPick.getPointLabels();
            var idx = -1;
            if (!this.mMeasurePick) {
                idx = pLabel.length - 1;
            }
            else if (this.mMeasurePick) {
                idx = aLabel.length - 1;
            }
            this.updateInfoLabel(idx);
        };
        eDwMeasureAuxGeo.prototype.updateInfoLabel = function (idx) {
            this.mInfoLabels = [];
            var pLabel = this.mPickInfo.getLabels();
            var aLabel = this.mAuxPick.getPointLabels();
            if (!this.mMeasurePick && pLabel.length > idx && idx >= 0) {
                var label = pLabel[idx];
                label.setDefaultEndPos();
                label.setStringContent(this.mUnit);
                this.mInfoLabels.push(label);
            }
            else if (this.mMeasurePick && aLabel.length > idx && idx >= 0) {
                var label = aLabel[idx];
                label.setDefaultEndPos();
                label.setStringContent(this.mUnit);
                this.mInfoLabels.push(label);
            }
        };
        eDwMeasureAuxGeo.prototype.getInfoLabelText = function () {
            var output = [];
            var labels;
            if (!this.mMeasurePick) {
                labels = this.mPickInfo.getLabels();
            }
            else {
                labels = this.mAuxPick.getPointLabels();
            }
            for (var i = 0; i < labels.length; ++i) {
                var label = labels[i];
                output.push(label.getText(this.mUnit));
            }
            return output;
        };
        eDwMeasureAuxGeo.prototype.distributeLabels = function () {
            var n = this.mResultLabels.length;
            var startsOrig = [];
            for (var i = 0; i < n; ++i) {
                this.mResultLabels[i].setStringContent(this.mUnit);
                startsOrig.push(this.mResultLabels[i].getLeaderStartPos());
            }
            var startsNew = eDwMeasureUtils.adjustLeaderEndByStart(startsOrig);
            for (var i = 0; i < n; ++i) {
                this.mResultLabels[i].setLeaderEndPos(startsNew[i]);
            }
        };
        eDwMeasureAuxGeo.prototype.isAvailible = function () {
            return this.mIsAvailible;
        };
        eDwMeasureAuxGeo.prototype.setAvailibility = function (iIsOn) {
            this.mIsAvailible = iIsOn;
        };
        eDwMeasureAuxGeo.prototype.setMeasurePick = function (iIsPick) {
            this.mMeasurePick = iIsPick;
            this.updateResultLabels();
        };
        eDwMeasureAuxGeo.prototype.setShowDelta = function (iIsDelta) {
            this.mShowDelta = iIsDelta;
            this.mAuxDist.setShowDelta(iIsDelta);
            this.mAuxPick.setDeltaDistAvailability(iIsDelta, true);
            this.updateResultLabels();
        };
        eDwMeasureAuxGeo.prototype.getMeasureText = function () {
            if (!this.mIsAvailible)
                return "";
            var str = "";
            if (this.mMeasurePick) {
                str += "MEASURE RESULTS - point-to-point" + "\n";
                str += this.mAuxPick.getText(this.mUnit);
                return str;
            }
            if (this.mMessage.isAvailible() && 0 !== this.mMessage.countLabels()) {
                str += this.mMessage.getText(this.mUnit) + "\n\n";
            }
            var isOtherResults = this.mOtherResults.isAvailible() &&
                0 !== this.mOtherResults.countLabels();
            var isDist = this.mAuxDist.isAvailible();
            var isAngle = this.mAuxAngle.isAvailible();
            if (isOtherResults || isDist || isAngle) {
                str += "MEASURE RESULTS" + "\n\n";
            }
            if (isOtherResults) {
                str += this.mOtherResults.getText(this.mUnit) + "\n";
            }
            if (isDist) {
                str += this.mAuxDist.getText(this.mUnit) + "\n";
            }
            if (isAngle) {
                str += this.mAuxAngle.getText(this.mUnit);
            }
            return str;
        };
        eDwMeasureAuxGeo.prototype.setDrawLabel = function (iEnable) {
            this.mDrawLabel = iEnable;
        };
        eDwMeasureAuxGeo.prototype.setConciseMode = function (iEnable) {
            this.mConcise = iEnable;
            this.mAuxPick.setConcise(iEnable);
        };
        return eDwMeasureAuxGeo;
    }());
    ;
    var eDwMeasurePanelInfo = (function () {
        function eDwMeasurePanelInfo(iPickInfo, iDelta, iUnit, iAuxGeo) {
            this.mSelObjs = [];
            this.mEnablePickInfo = iPickInfo;
            this.mEnableDelta = iDelta;
            this.mUnit = iUnit;
            this.mAuxGeo = iAuxGeo;
            this.mUnit = { AngleUnit: iUnit.AngleUnit,
                LenMultiplier: iUnit.LenMultiplier };
        }
        eDwMeasurePanelInfo.prototype.updatePanelResult = function (iSelObjs, iPickInfo, iDelta, iUnit) {
            if (!this.isUnitChanged(iUnit) &&
                !this.isDeltaChanged(iDelta) &&
                !this.isPickInfoChanged(iPickInfo) &&
                !this.isEntitiesChanged(iSelObjs)) {
                return;
            }
            var result = {
                SelObjs: iSelObjs,
                Descriptions: this.mAuxGeo.getInfoLabelText(),
                Message: this.mAuxGeo.getMeasureText(),
                MeasureByPointsOnly: iPickInfo
            };
            eDwEventMgr.get().fireEvents("MeasurementRefresh", result);
            this.mUnit = { AngleUnit: iUnit.AngleUnit,
                LenMultiplier: iUnit.LenMultiplier };
            this.mEnableDelta = iDelta;
            this.mEnablePickInfo = iPickInfo;
            this.mSelObjs = [];
            for (var i = 0; i < iSelObjs.length; ++i) {
                this.mSelObjs.push(iSelObjs[i]);
            }
            return;
        };
        eDwMeasurePanelInfo.prototype.isUnitChanged = function (iUnit) {
            return this.mUnit.AngleUnit !== iUnit.AngleUnit ||
                this.mUnit.LenMultiplier !== iUnit.LenMultiplier;
        };
        eDwMeasurePanelInfo.prototype.isDeltaChanged = function (iDelta) {
            return this.mEnableDelta !== iDelta;
        };
        eDwMeasurePanelInfo.prototype.isPickInfoChanged = function (iPickInfo) {
            return this.mEnablePickInfo !== iPickInfo;
        };
        eDwMeasurePanelInfo.prototype.isEntitiesChanged = function (iSelObjs) {
            var n = this.mSelObjs.length;
            if (n !== iSelObjs.length)
                return true;
            for (var i = 0; i < n; ++i) {
                if (!this.isEntitySame(iSelObjs[i], this.mSelObjs[i])) {
                    return true;
                }
            }
            return false;
        };
        eDwMeasurePanelInfo.prototype.isEntitySame = function (iSelObj0, iSelObj1) {
            var faceEntity0 = iSelObj0.getFaceEntity();
            var lineEntity0 = iSelObj0.getLineEntity();
            var vertEntity0 = iSelObj0.getPointEntity();
            var faceEntity1 = iSelObj1.getFaceEntity();
            var lineEntity1 = iSelObj1.getLineEntity();
            var vertEntity1 = iSelObj1.getPointEntity();
            if ((faceEntity0 && faceEntity1) &&
                (faceEntity0.getCadFaceIndex() === faceEntity1.getCadFaceIndex())) {
                return true;
            }
            if ((lineEntity0 && lineEntity1) &&
                (lineEntity0.getLineId() === lineEntity1.getLineId())) {
                return true;
            }
            if ((vertEntity0 && vertEntity1) &&
                (vertEntity0.getPointId() === vertEntity1.getPointId())) {
                return true;
            }
            return false;
        };
        return eDwMeasurePanelInfo;
    }());
    ;
    var eDwMeasureEntities = (function (_super) {
        __extends(eDwMeasureEntities, _super);
        function eDwMeasureEntities(iViewer, iUnitMultiplier, iAngleUnit) {
            var _this = _super.call(this) || this;
            _this.mSelObjs = [];
            _this.mSelProps = [];
            _this.mViewerHC = iViewer;
            _this.mModel = _this.mViewerHC.getModel();
            _this.mHighlightColor = eDwTypes_7.HC.Color.green();
            _this.mEnablePickInfo = false;
            _this.mEnableDelta = false;
            var unit = { LenMultiplier: iUnitMultiplier, AngleUnit: iAngleUnit };
            _this.mUnit = unit;
            _this.mAuxGeoSteady = new eDwMeasureAuxGeo(iViewer, unit);
            _this.mAuxGeoInstant = new eDwMeasureAuxGeo(iViewer, unit);
            _this.mAuxGeoInstant.setConciseMode(true);
            _this.mPanelInfo = new eDwMeasurePanelInfo(_this.mEnablePickInfo, _this.mEnableDelta, unit, _this.mAuxGeoSteady);
            return _this;
        }
        eDwMeasureEntities.prototype.addObjProps = function (iSelObj, iSelProp) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!(this.mEnablePickInfo && 2 === this.mSelObjs.length)) return [3, 2];
                            return [4, this.removeEntityAtIndex(1)];
                        case 1:
                            _a.sent();
                            _a.label = 2;
                        case 2:
                            this.mSelObjs.push(iSelObj);
                            this.mSelProps.push(iSelProp);
                            return [2];
                    }
                });
            });
        };
        eDwMeasureEntities.prototype.addEntity = function (iSelObj) {
            return __awaiter(this, void 0, void 0, function () {
                var view, nodeID, faceEntity, lineEntity, pointEntity, selectionType, extraInfo, edgeProps, extraInfo, faceProps, extraInfo;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            view = this.mViewerHC.getView();
                            nodeID = iSelObj.getNodeId();
                            faceEntity = iSelObj.getFaceEntity();
                            lineEntity = iSelObj.getLineEntity();
                            pointEntity = iSelObj.getPointEntity();
                            selectionType = iSelObj.getSelectionType();
                            this.mAuxGeoSteady.reset();
                            if (!pointEntity) return [3, 3];
                            return [4, this.addObjProps(iSelObj, null)];
                        case 1:
                            _a.sent();
                            return [4, this.getExtraInfo(this.mSelProps, this.mSelObjs)];
                        case 2:
                            extraInfo = _a.sent();
                            this.updateResult(this.mSelProps, this.mSelObjs, extraInfo, this.mAuxGeoSteady);
                            this.addEntityAttempt(null);
                            this.highlightEntity(iSelObj);
                            return [3, 12];
                        case 3:
                            if (!(lineEntity &&
                                ((lineEntity.getLineBits() &
                                    4)))) return [3, 7];
                            return [4, this.mViewerHC.getModel().getEdgeProperty(iSelObj.getNodeId(), iSelObj.getLineEntity().getLineId())];
                        case 4:
                            edgeProps = _a.sent();
                            return [4, this.addObjProps(iSelObj, edgeProps)];
                        case 5:
                            _a.sent();
                            return [4, this.getExtraInfo(this.mSelProps, this.mSelObjs)];
                        case 6:
                            extraInfo = _a.sent();
                            this.updateResult(this.mSelProps, this.mSelObjs, extraInfo, this.mAuxGeoSteady);
                            this.addEntityAttempt(null);
                            this.highlightEntity(iSelObj);
                            return [3, 12];
                        case 7:
                            if (!(faceEntity && faceEntity.getCadFaceIndex())) return [3, 11];
                            return [4, this.mViewerHC.getModel().getFaceProperty(iSelObj.getNodeId(), iSelObj.getFaceEntity().getCadFaceIndex())];
                        case 8:
                            faceProps = _a.sent();
                            return [4, this.addObjProps(iSelObj, faceProps)];
                        case 9:
                            _a.sent();
                            return [4, this.getExtraInfo(this.mSelProps, this.mSelObjs)];
                        case 10:
                            extraInfo = _a.sent();
                            this.updateResult(this.mSelProps, this.mSelObjs, extraInfo, this.mAuxGeoSteady);
                            this.addEntityAttempt(null);
                            this.highlightEntity(iSelObj);
                            return [3, 12];
                        case 11:
                            this.reset();
                            this.mAuxGeoSteady.setAuxPick([]);
                            return [2, false];
                        case 12: return [2, true];
                    }
                });
            });
        };
        eDwMeasureEntities.prototype.addEntityAttempt = function (iSelObj) {
            return __awaiter(this, void 0, void 0, function () {
                var extraInfo_1, faceEntity, lineEntity, pointEntity, selectionType, selObjs, selProps, drawLabels, edgeProp, faceProp, extraInfo;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!(!iSelObj || (!this.getMeasurePickPoint() &&
                                this.isItemSelected(iSelObj) >= 0))) return [3, 2];
                            return [4, this.getExtraInfo(this.mSelProps, this.mSelObjs)];
                        case 1:
                            extraInfo_1 = _a.sent();
                            this.updateResult(this.mSelProps, this.mSelObjs, extraInfo_1, this.mAuxGeoInstant);
                            this.mAuxGeoInstant.setDrawLabel(false);
                            return [2];
                        case 2:
                            faceEntity = iSelObj.getFaceEntity();
                            lineEntity = iSelObj.getLineEntity();
                            pointEntity = iSelObj.getPointEntity();
                            selectionType = iSelObj.getSelectionType();
                            selObjs = this.mSelObjs.slice();
                            selProps = this.mSelProps.slice();
                            drawLabels = true;
                            if (!pointEntity) return [3, 3];
                            selObjs.push(iSelObj);
                            selProps.push(null);
                            return [3, 8];
                        case 3:
                            if (!(lineEntity &&
                                ((lineEntity.getLineBits() &
                                    4)))) return [3, 5];
                            return [4, this.mViewerHC.getModel().getEdgeProperty(iSelObj.getNodeId(), iSelObj.getLineEntity().getLineId())];
                        case 4:
                            edgeProp = _a.sent();
                            selObjs.push(iSelObj);
                            selProps.push(edgeProp);
                            return [3, 8];
                        case 5:
                            if (!(faceEntity && faceEntity.getCadFaceIndex())) return [3, 7];
                            return [4, this.mViewerHC.getModel().getFaceProperty(iSelObj.getNodeId(), iSelObj.getFaceEntity().getCadFaceIndex())];
                        case 6:
                            faceProp = _a.sent();
                            selObjs.push(iSelObj);
                            selProps.push(faceProp);
                            return [3, 8];
                        case 7:
                            selProps = this.mSelProps;
                            selObjs = this.mSelObjs;
                            drawLabels = false;
                            _a.label = 8;
                        case 8: return [4, this.getExtraInfo(selProps, selObjs)];
                        case 9:
                            extraInfo = _a.sent();
                            this.updateResult(selProps, selObjs, extraInfo, this.mAuxGeoInstant);
                            this.mAuxGeoInstant.setDrawLabel(drawLabels);
                            return [2];
                    }
                });
            });
        };
        eDwMeasureEntities.prototype.resetInstantResults = function () {
            return __awaiter(this, void 0, void 0, function () {
                var extraInfo;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.getExtraInfo(this.mSelProps, this.mSelObjs)];
                        case 1:
                            extraInfo = _a.sent();
                            this.updateResult(this.mSelProps, this.mSelObjs, extraInfo, this.mAuxGeoInstant);
                            this.mAuxGeoInstant.setDrawLabel(false);
                            return [2];
                    }
                });
            });
        };
        eDwMeasureEntities.prototype.removeEntityAtIndex = function (idx) {
            return __awaiter(this, void 0, void 0, function () {
                var toRemove, extraInfo;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (idx < 0 || idx >= this.mSelObjs.length)
                                return [2];
                            toRemove = this.mSelObjs[idx];
                            this.mSelObjs.splice(idx, 1);
                            this.mSelProps.splice(idx, 1);
                            this.mAuxGeoSteady.regeneratePicks(this.mSelObjs);
                            this.mAuxGeoInstant.regeneratePicks(this.mSelObjs);
                            if (this.isItemSelected(toRemove) < 0) {
                                this.deHighlightEntity(toRemove);
                            }
                            this.dehighlightAllTemporaryEntity();
                            return [4, this.getExtraInfo(this.mSelProps, this.mSelObjs)];
                        case 1:
                            extraInfo = _a.sent();
                            this.updateResult(this.mSelProps, this.mSelObjs, extraInfo, this.mAuxGeoSteady);
                            this.addEntityAttempt(null);
                            return [2];
                    }
                });
            });
        };
        eDwMeasureEntities.prototype.setHighlightColor = function (iColor) {
            this.mHighlightColor = iColor;
        };
        eDwMeasureEntities.prototype.setMeasureUnit = function (iUnitMultiplier, iAngleUnit) {
            var unit = { LenMultiplier: iUnitMultiplier, AngleUnit: iAngleUnit };
            this.mUnit = unit;
            this.mAuxGeoSteady.setUnits(unit);
            this.mAuxGeoInstant.setUnits(unit);
            var markupMgr = this.mViewerHC.getMarkupManager();
            markupMgr.refreshMarkup();
        };
        eDwMeasureEntities.prototype.setMeasurePickPoint = function (iEnable) {
            this.reset();
            this.mAuxGeoSteady.setMeasurePick(iEnable);
            this.mAuxGeoInstant.setMeasurePick(iEnable);
            this.mEnablePickInfo = iEnable;
            var markupMgr = this.mViewerHC.getMarkupManager();
            markupMgr.refreshMarkup();
        };
        eDwMeasureEntities.prototype.getMeasurePickPoint = function () {
            return this.mEnablePickInfo;
        };
        eDwMeasureEntities.prototype.setMeasureDelta = function (iEnable) {
            this.mAuxGeoSteady.setShowDelta(iEnable);
            this.mAuxGeoInstant.setShowDelta(iEnable);
            this.mEnableDelta = iEnable;
            var markupMgr = this.mViewerHC.getMarkupManager();
            markupMgr.refreshMarkup();
        };
        eDwMeasureEntities.prototype.reset = function () {
            this.deHighlightAll();
            this.mAuxGeoSteady.reset();
            this.mAuxGeoInstant.reset();
            this.mSelObjs = [];
            this.mSelProps = [];
            this.mPanelInfo.updatePanelResult(this.mSelObjs, this.mEnablePickInfo, this.mEnableDelta, this.mUnit);
        };
        eDwMeasureEntities.prototype.draw = function () {
            this.mAuxGeoSteady.draw();
            this.mAuxGeoInstant.draw();
            this.mPanelInfo.updatePanelResult(this.mSelObjs, this.mEnablePickInfo, this.mEnableDelta, this.mUnit);
        };
        eDwMeasureEntities.prototype.getClassName = function () {
            return "eDwMeasureEntities";
        };
        eDwMeasureEntities.prototype.isItemSelected = function (iSelObj) {
            var faceNew = iSelObj.getFaceEntity();
            var lineNew = iSelObj.getLineEntity();
            var vertNew = iSelObj.getPointEntity();
            for (var i = 0; i < this.mSelObjs.length; ++i) {
                var selObj = this.mSelObjs[i];
                var face = selObj.getFaceEntity();
                var line = selObj.getLineEntity();
                var vert = selObj.getPointEntity();
                if ((faceNew && face) &&
                    (faceNew.getCadFaceIndex() === face.getCadFaceIndex())) {
                    return i;
                }
                if ((lineNew && line) &&
                    (lineNew.getLineId() === line.getLineId())) {
                    return i;
                }
                if ((vertNew && vert) &&
                    (vertNew.getPointId() === vert.getPointId())) {
                    return i;
                }
            }
            return -1;
        };
        eDwMeasureEntities.prototype.onDragLabelStart = function (iLabel, iPos) {
            this.mCurLabel = iLabel;
            this.mCurLabel.onDragStart(iPos);
        };
        eDwMeasureEntities.prototype.onDragLabelMove = function (iPos) {
            this.mCurLabel.onDragMove(iPos);
            var markupMgr = this.mViewerHC.getMarkupManager();
            markupMgr.refreshMarkup();
        };
        eDwMeasureEntities.prototype.onDragLabelEnd = function (iPos) {
            this.mCurLabel.onDragEnd(iPos);
            this.mCurLabel = null;
        };
        eDwMeasureEntities.prototype.highlightTemporaryEntityAt = function (iIndex) {
            this.highlightEntityAt(iIndex);
            this.mAuxGeoSteady.updateInfoLabel(iIndex);
            eDwEventMgr.get().fireEvents("MeasurementSelection", iIndex);
        };
        eDwMeasureEntities.prototype.dehighlightTemporaryEntityAt = function (iIndex) {
            this.highlightEntityAt(iIndex, false);
            this.mAuxGeoSteady.updateInfoLabel(-1);
        };
        eDwMeasureEntities.prototype.dehighlightAllTemporaryEntity = function () {
            eDwEventMgr.get().fireEvents("MeasurementDeselectAll");
            var n = this.mSelObjs.length;
            for (var i = 0; i < n; ++i) {
                this.dehighlightTemporaryEntityAt(i);
            }
        };
        eDwMeasureEntities.getMeasureSelItemID = function (iSelItem) {
            if (!iSelItem)
                return undefined;
            var pointEntity = iSelItem.getPointEntity();
            var lineEntity = iSelItem.getLineEntity();
            var faceEntity = iSelItem.getFaceEntity();
            if (pointEntity) {
                return pointEntity.getPointId();
            }
            if (lineEntity &&
                (lineEntity.getLineBits() &
                    4)) {
                return lineEntity.getLineId();
            }
            if (faceEntity) {
                return faceEntity.getCadFaceIndex();
            }
            return undefined;
        };
        eDwMeasureEntities.prototype.deHighlightAll = function () {
            for (var i = 0; i < this.mSelObjs.length; ++i) {
                this.deHighlightEntity(this.mSelObjs[i]);
            }
        };
        eDwMeasureEntities.prototype.deHighlightEntity = function (iSelItem) {
            var model = this.mViewerHC.getModel();
            var nodeID = iSelItem.getNodeId();
            var entityID = eDwMeasureEntities.getMeasureSelItemID(iSelItem);
            if (iSelItem.getFaceEntity()) {
                model.unsetNodeFaceColor(nodeID, entityID);
            }
            if (iSelItem.getLineEntity()) {
                model.unsetNodeLineColor(nodeID, entityID);
            }
            if (iSelItem.getPointEntity()) {
            }
        };
        eDwMeasureEntities.prototype.highlightEntity = function (iSelItem) {
            var model = this.mViewerHC.getModel();
            var nodeID = iSelItem.getNodeId();
            var entityID = eDwMeasureEntities.getMeasureSelItemID(iSelItem);
            if (iSelItem.getFaceEntity()) {
                model.setNodeFaceColor(nodeID, entityID, this.mHighlightColor);
            }
            if (iSelItem.getLineEntity()) {
                model.setNodeLineColor(nodeID, entityID, this.mHighlightColor);
            }
            if (iSelItem.getPointEntity()) {
            }
        };
        eDwMeasureEntities.prototype.getExtraInfo = function (iSelProps, iSelObjs) {
            return __awaiter(this, void 0, void 0, function () {
                var model, vertProp, vertObj, faceProp, faceObj, lineRay, faceObj0, faceObj1, faceProp0, faceProp1, edgeProp, edgeObj, faceProp, faceObj, circle, lineRay;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            model = this.mViewerHC.getModel();
                            if (2 !== iSelObjs.length)
                                return [2, null];
                            if (!((iSelObjs[0].getPointEntity() && iSelObjs[1].getFaceEntity()) ||
                                (iSelObjs[1].getPointEntity() && iSelObjs[0].getFaceEntity()))) return [3, 3];
                            vertProp = iSelProps[0];
                            vertObj = iSelObjs[0];
                            faceProp = iSelProps[1];
                            faceObj = iSelObjs[1];
                            if (iSelObjs[1].getPointEntity() && iSelObjs[0].getFaceEntity()) {
                                vertProp = iSelProps[1];
                                vertObj = iSelObjs[1];
                                faceProp = iSelProps[0];
                                faceObj = iSelObjs[0];
                            }
                            if (!(faceProp instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement)) return [3, 2];
                            lineRay = new eDwTypes_7.HC.Ray(vertObj.getPosition(), new eDwTypes_7.HC.Point3(0, 0, 0));
                            return [4, model.computeMinimumFaceLineDistance(faceObj.getNodeId(), faceObj.getFaceEntity().getCadFaceIndex(), lineRay)];
                        case 1: return [2, _a.sent()];
                        case 2: return [3, 8];
                        case 3:
                            if (!(iSelObjs[0].getFaceEntity() && iSelObjs[1].getFaceEntity())) return [3, 6];
                            faceObj0 = iSelObjs[0], faceObj1 = iSelObjs[1];
                            faceProp0 = iSelProps[0], faceProp1 = iSelProps[1];
                            if (!(faceProp0 instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement &&
                                faceProp1 instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement)) return [3, 5];
                            return [4, model.computeMinimumFaceFaceDistance(faceObj0.getNodeId(), faceObj0.getFaceEntity().getCadFaceIndex(), faceObj1.getNodeId(), faceObj1.getFaceEntity().getCadFaceIndex())];
                        case 4: return [2, _a.sent()];
                        case 5: return [3, 8];
                        case 6:
                            if (!((iSelObjs[0].getLineEntity() &&
                                iSelObjs[1].getFaceEntity()) ||
                                (iSelObjs[1].getLineEntity() && iSelObjs[0].getFaceEntity()))) return [3, 8];
                            edgeProp = iSelProps[0];
                            edgeObj = iSelObjs[0];
                            faceProp = iSelProps[1];
                            faceObj = iSelObjs[1];
                            if (iSelObjs[1].getLineEntity() && iSelObjs[0].getFaceEntity()) {
                                edgeProp = iSelProps[1];
                                edgeObj = iSelObjs[1];
                                faceProp = iSelProps[0];
                                faceObj = iSelObjs[0];
                            }
                            if (!(edgeProp instanceof eDwTypes_7.HC.SubentityProperties.CircleElement &&
                                faceProp instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement)) return [3, 8];
                            circle = new eDwTypes_7.HC.SubentityProperties.CircleElement();
                            circle.origin = new eDwTypes_7.HC.Point3(0, 0, 0);
                            circle.normal = new eDwTypes_7.HC.Point3(0, 0, 0);
                            circle.radius = 0;
                            eDwMeasureUtils.getRealCircleProperties(edgeObj, edgeProp, circle, model);
                            lineRay = new eDwTypes_7.HC.Ray(circle.origin, new eDwTypes_7.HC.Point3(0, 0, 0));
                            return [4, model.computeMinimumFaceLineDistance(faceObj.getNodeId(), faceObj.getFaceEntity().getCadFaceIndex(), lineRay)];
                        case 7: return [2, _a.sent()];
                        case 8: return [2, null];
                    }
                });
            });
        };
        eDwMeasureEntities.prototype.updateResult = function (iSelProps, iSelObjs, iExtraInfo, iAuxGeo) {
            iAuxGeo.reset();
            var isValid = false;
            isValid = isValid || this.updateSingleVert(iSelProps, iSelObjs);
            isValid = isValid || this.updateSingleEdge(iSelProps, iSelObjs);
            isValid = isValid || this.updateSingleFace(iSelProps, iSelObjs);
            isValid = isValid || this.updateVertEdge(iSelProps, iSelObjs, iAuxGeo);
            isValid = isValid || this.updateVertFace(iSelProps, iSelObjs, iExtraInfo, iAuxGeo);
            isValid = isValid || this.updateVertVert(iSelProps, iSelObjs, iAuxGeo);
            isValid = isValid || this.updateEdgeFace(iSelProps, iSelObjs, iExtraInfo, iAuxGeo);
            isValid = isValid || this.updateFaceFace(iSelProps, iSelObjs, iExtraInfo, iAuxGeo);
            isValid = isValid || this.updateEdgeEdge(iSelProps, iSelObjs, iAuxGeo);
            isValid = isValid || this.updateEdges(iSelProps, iSelObjs, iAuxGeo);
            iAuxGeo.addPickInfos(iSelProps, iSelObjs);
            iAuxGeo.setAuxPick(iSelObjs);
            var n = iSelObjs.length;
            if (!isValid && n > 0) {
                var result = new eDwMeasureResult("Info", "Invalid combination", MeasureType.None);
                iAuxGeo.addMessage(result, iSelObjs[n - 1].getPosition(), eDwTypes_7.HC.Color.red());
            }
            iAuxGeo.updateResultLabels();
            return isValid;
        };
        eDwMeasureEntities.prototype.updateSingleVert = function (iSelProps, iSelObjs) {
            if (1 !== iSelObjs.length)
                return false;
            var vertObj = iSelObjs[0];
            var vertProp = iSelProps[0];
            if (!vertObj.getPointEntity())
                return false;
            var view = this.mViewerHC.getView();
            return true;
        };
        eDwMeasureEntities.prototype.updateSingleEdge = function (iSelProps, iSelObjs) {
            if (1 !== iSelObjs.length)
                return false;
            var edgeObj = iSelObjs[0];
            var edgeProp = iSelProps[0];
            if (!edgeObj.getLineEntity() || !edgeProp)
                return false;
            var view = this.mViewerHC.getView();
            if (edgeProp instanceof eDwTypes_7.HC.SubentityProperties.LineElement ||
                edgeProp instanceof eDwTypes_7.HC.SubentityProperties.OtherElement) {
                return true;
            }
            else if (edgeProp instanceof eDwTypes_7.HC.SubentityProperties.CircleElement) {
                return true;
            }
            return false;
        };
        eDwMeasureEntities.prototype.updateSingleFace = function (iSelProps, iSelObjs) {
            if (1 !== iSelObjs.length)
                return false;
            var faceObj = iSelObjs[0];
            var faceProp = iSelProps[0];
            if (!faceObj.getFaceEntity() || !faceProp)
                return false;
            if (faceProp instanceof eDwTypes_7.HC.SubentityProperties.CylinderElement) {
                return true;
            }
            else if (faceProp instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement) {
                return true;
            }
            return false;
        };
        eDwMeasureEntities.prototype.updateVertVert = function (iSelProps, iSelObjs, iAuxGeo) {
            if (2 !== iSelObjs.length)
                return false;
            if (iSelObjs[0].getPointEntity() && iSelObjs[1].getPointEntity()) {
                var vertProp0 = iSelProps[0];
                var vertObj0 = iSelObjs[0];
                var vertProp1 = iSelProps[1];
                var vertObj1 = iSelObjs[1];
                iAuxGeo.setByVertexVertex(vertObj0, vertObj1);
                return true;
            }
            return false;
        };
        eDwMeasureEntities.prototype.updateVertEdge = function (iSelProps, iSelObjs, iAuxGeo) {
            if (2 !== iSelObjs.length)
                return false;
            if (iSelObjs[0].getLineEntity() && iSelObjs[1].getPointEntity()) {
                var edgeProp = iSelProps[0];
                var edgeObj = iSelObjs[0];
                var vertProp = iSelProps[1];
                var vertObj = iSelObjs[1];
                if (edgeProp instanceof eDwTypes_7.HC.SubentityProperties.LineElement) {
                    iAuxGeo.setByVertexLine(vertObj, edgeProp, edgeObj);
                    return true;
                }
                else if (edgeProp instanceof eDwTypes_7.HC.SubentityProperties.CircleElement) {
                    iAuxGeo.setByVertexCircle(vertObj, edgeProp, edgeObj);
                    return true;
                }
            }
            if (iSelObjs[1].getLineEntity() && iSelObjs[0].getPointEntity()) {
                var edgeProp = iSelProps[1];
                var edgeObj = iSelObjs[1];
                var vertProp = iSelProps[0];
                var vertObj = iSelObjs[0];
                if (edgeProp instanceof eDwTypes_7.HC.SubentityProperties.LineElement) {
                    iAuxGeo.setByVertexLine(vertObj, edgeProp, edgeObj);
                    return true;
                }
                else if (edgeProp instanceof eDwTypes_7.HC.SubentityProperties.CircleElement) {
                    iAuxGeo.setByVertexCircle(vertObj, edgeProp, edgeObj);
                    return true;
                }
            }
            return false;
        };
        eDwMeasureEntities.prototype.updateVertFace = function (iSelProps, iSelObjs, iExtraInfo, iAuxGeo) {
            if (2 !== iSelObjs.length)
                return false;
            if (iSelObjs[0].getPointEntity() && iSelObjs[1].getFaceEntity()) {
                var vertProp = iSelProps[0];
                var vertObj = iSelObjs[0];
                var faceProp = iSelProps[1];
                var faceObj = iSelObjs[1];
                if (faceProp instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement) {
                    iAuxGeo.setByVertexPlane(vertObj, faceProp, faceObj, iExtraInfo);
                    return true;
                }
            }
            if (iSelObjs[1].getPointEntity() && iSelObjs[0].getFaceEntity()) {
                var vertProp = iSelProps[1];
                var vertObj = iSelObjs[1];
                var faceProp = iSelProps[0];
                var faceObj = iSelObjs[0];
                if (faceProp instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement) {
                    iAuxGeo.setByVertexPlane(vertObj, faceProp, faceObj, iExtraInfo);
                    return true;
                }
            }
            return false;
        };
        eDwMeasureEntities.prototype.updateEdgeFace = function (iSelProps, iSelObjs, iExtraInfo, iAuxGeo) {
            if (2 !== iSelObjs.length)
                return false;
            if (iSelObjs[0].getLineEntity() && iSelObjs[1].getFaceEntity()) {
                var edgeProp = iSelProps[0];
                var edgeObj = iSelObjs[0];
                var faceProp = iSelProps[1];
                var faceObj = iSelObjs[1];
                if (edgeProp instanceof eDwTypes_7.HC.SubentityProperties.LineElement &&
                    faceProp instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement) {
                    iAuxGeo.setByLinePlane(edgeProp, faceProp, edgeObj, faceObj);
                    return true;
                }
                else if (edgeProp instanceof eDwTypes_7.HC.SubentityProperties.CircleElement &&
                    faceProp instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement) {
                    iAuxGeo.setByCirclePlane(edgeProp, faceProp, edgeObj, faceObj, iExtraInfo);
                    return true;
                }
            }
            if (iSelObjs[1].getLineEntity() && iSelObjs[0].getFaceEntity()) {
                var edgeProp = iSelProps[1];
                var edgeObj = iSelObjs[1];
                var faceProp = iSelProps[0];
                var faceObj = iSelObjs[0];
                if (edgeProp instanceof eDwTypes_7.HC.SubentityProperties.LineElement &&
                    faceProp instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement) {
                    iAuxGeo.setByPlaneLine(faceProp, edgeProp, faceObj, edgeObj);
                    return true;
                }
                else if (edgeProp instanceof eDwTypes_7.HC.SubentityProperties.CircleElement &&
                    faceProp instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement) {
                    iAuxGeo.setByCirclePlane(edgeProp, faceProp, edgeObj, faceObj, iExtraInfo);
                    return true;
                }
            }
            return false;
        };
        eDwMeasureEntities.prototype.updateEdgeEdge = function (iSelProps, iSelObjs, iAuxGeo) {
            if (2 !== iSelObjs.length)
                return false;
            if (!iSelObjs[0].getLineEntity() || !iSelObjs[1].getLineEntity()) {
                return false;
            }
            var edgeObj0 = iSelObjs[0];
            var edgeProp0 = iSelProps[0];
            var edgeObj1 = iSelObjs[1];
            var edgeProp1 = iSelProps[1];
            if (edgeObj0.getLineEntity().getLineId() ===
                edgeObj1.getLineEntity().getLineId())
                return false;
            if (edgeProp0 instanceof eDwTypes_7.HC.SubentityProperties.LineElement &&
                edgeProp1 instanceof eDwTypes_7.HC.SubentityProperties.LineElement) {
                iAuxGeo.setByLineLine(edgeProp0, edgeProp1, edgeObj0, edgeObj1);
                return true;
            }
            else if (edgeProp0 instanceof eDwTypes_7.HC.SubentityProperties.LineElement &&
                edgeProp1 instanceof eDwTypes_7.HC.SubentityProperties.CircleElement) {
                iAuxGeo.setByCircleLine(edgeProp1, edgeProp0, edgeObj1, edgeObj0);
                return true;
            }
            else if (edgeProp0 instanceof eDwTypes_7.HC.SubentityProperties.CircleElement &&
                edgeProp1 instanceof eDwTypes_7.HC.SubentityProperties.LineElement) {
                iAuxGeo.setByCircleLine(edgeProp0, edgeProp1, edgeObj0, edgeObj1);
                return true;
            }
            else if (edgeProp0 instanceof eDwTypes_7.HC.SubentityProperties.CircleElement &&
                edgeProp1 instanceof eDwTypes_7.HC.SubentityProperties.CircleElement) {
                iAuxGeo.setByCircleCircle(edgeProp1, edgeProp0, edgeObj1, edgeObj0);
                return true;
            }
            return false;
        };
        eDwMeasureEntities.prototype.updateFaceFace = function (iSelProps, iSelObjs, iExtraInfo, iAuxGeo) {
            if (2 !== iSelObjs.length)
                return false;
            if (!iSelObjs[0].getFaceEntity() || !iSelObjs[1].getFaceEntity()) {
                return false;
            }
            var faceObj0 = iSelObjs[0];
            var faceProp0 = iSelProps[0];
            var faceObj1 = iSelObjs[1];
            var faceProp1 = iSelProps[1];
            if (faceObj0.getFaceEntity().getCadFaceIndex() ===
                faceObj1.getFaceEntity().getCadFaceIndex())
                return false;
            if (!faceObj1.getFaceEntity() || !faceProp1)
                return false;
            if (faceProp0 instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement &&
                faceProp1 instanceof eDwTypes_7.HC.SubentityProperties.PlaneElement) {
                iAuxGeo.setByPlanePlane(faceProp1, faceProp0, faceObj1, faceObj0, iExtraInfo);
                return true;
            }
            return false;
        };
        eDwMeasureEntities.prototype.updateEdges = function (iSelProps, iSelObjs, iAuxGeo) {
            var n = iSelObjs.length;
            var len = 0;
            var ids = [];
            for (var i = 0; i < n; ++i) {
                var prop = iSelProps[i];
                var obj = iSelObjs[i];
                if (!obj.getLineEntity() || !prop)
                    return false;
                var lineId = obj.getLineEntity().getLineId();
                if (-1 !== ids.indexOf(lineId))
                    return false;
                ids.push(lineId);
                if (prop instanceof eDwTypes_7.HC.SubentityProperties.LineElement ||
                    prop instanceof eDwTypes_7.HC.SubentityProperties.OtherElement) {
                    len += prop.length;
                }
                else if (prop instanceof eDwTypes_7.HC.SubentityProperties.CircleElement) {
                    len += 2 * Math.PI * prop.radius;
                }
                else {
                    return false;
                }
            }
            var pos = new eDwTypes_7.HC.Point3(0, 0, 0);
            if (n > 1) {
                pos = iSelObjs[n - 1].getPosition();
                var result = new eDwMeasureResult("Total Length", len, MeasureType.Distance);
                iAuxGeo.addOtherResult(result, pos);
                return true;
            }
            return false;
        };
        eDwMeasureEntities.prototype.highlightEntityAt = function (iIndex, iHighlight) {
            if (iHighlight === void 0) { iHighlight = true; }
            var n = this.mSelObjs.length;
            var model = this.mViewerHC.getModel();
            if (iIndex < 0 || iIndex >= n)
                return;
            var nodeID = this.mSelObjs[iIndex].getNodeId();
            var entityID = eDwMeasureEntities.getMeasureSelItemID(this.mSelObjs[iIndex]);
            if (this.mSelObjs[iIndex].getFaceEntity()) {
                model.setNodeFaceHighlighted(nodeID, entityID, iHighlight);
            }
            if (this.mSelObjs[iIndex].getLineEntity()) {
                model.setNodeLineHighlighted(nodeID, entityID, iHighlight);
            }
            if (this.mSelObjs[iIndex].getPointEntity()) {
                model.setNodePointHighlighted(nodeID, entityID, iHighlight);
            }
        };
        return eDwMeasureEntities;
    }(eDwTypes_7.HC.Markup.MarkupItem));
    ;
    return eDwMeasureEntities;
});
define("eDwMeasureMgr", ["require", "exports", "eDwMeasureOperator", "eDwTypes", "eDrawingsBase"], function (require, exports, eDwMeasureOperator, eDwTypes_8) {
    "use strict";
    var eDwMeasureMgr = (function () {
        function eDwMeasureMgr(iViewer) {
            iViewer.MeasureMgr = this;
            this.mViewer = iViewer;
            var measureOp = new eDwMeasureOperator(iViewer, this);
            this.mMeasureOpID =
                iViewer.OperatorMgr.registerCustomOperator(measureOp);
            this.mMarkupArray = [];
            this.setMeasureUnits(eDwTypes_8.DefaultDistanceUnit, eDwTypes_8.DefaultAngleUnit);
        }
        eDwMeasureMgr.prototype.unregister = function () {
            this.mViewer.OperatorMgr.unregisterCustomOperatorByID(this.mMeasureOpID);
            this.mViewer.MeasureMgr = null;
        };
        eDwMeasureMgr.prototype.addMarkup = function (iNewMarkupID) {
            if (!this.mMarkupArray) {
                this.mMarkupArray = [];
            }
            this.mMarkupArray.push(iNewMarkupID);
        };
        eDwMeasureMgr.prototype.activateMeasure = function (iMode) {
            var viewer = this.mViewer;
            if (!viewer.getModel().getMeasureable())
                return;
            var opMgr = viewer.OperatorMgr;
            this.mViewer.HCViewer.getMeasureManager().setMeasurementColor(new Communicator.Color(4, 200, 5));
            opMgr.push(this.mMeasureOpID);
            this.setMeasureMode(iMode);
        };
        eDwMeasureMgr.prototype.deleteMeasurements = function () {
            var mkupMgr = this.mViewer.HCViewer.getMarkupManager();
            var markups = this.mMarkupArray.length;
            for (var i = 0; i < markups; i++) {
                mkupMgr.unregisterMarkup(this.mMarkupArray[i]);
            }
        };
        eDwMeasureMgr.prototype.deactivateMeasure = function () {
            var viewer = this.mViewer;
            if (!viewer.getModel().getMeasureable())
                return;
            this.deleteMeasurements();
            var opMgr = viewer.OperatorMgr;
            if (opMgr.getActiveOperatorID() === this.mMeasureOpID) {
                opMgr.pop();
            }
            this.mViewer.HCViewer.getSelectionManager().setNodeSelectionColor(new Communicator.Color(4, 200, 5));
        };
        eDwMeasureMgr.prototype.getLastMarkup = function () {
            return this.mMarkupArray.length ? this.mMarkupArray[length - 1] : null;
        };
        eDwMeasureMgr.prototype.setMeasureUnits = function (iDistUnit, iAngleUnit) {
            var distMultiplier = eDwTypes_8.DistanceConversion[iDistUnit];
            var angleMultiplier = eDwTypes_8.AngleConversion[iAngleUnit];
            if (!distMultiplier || !angleMultiplier) {
                throw Error("Invalid distance or angle unit type");
            }
            this.mDistUnitMultiplier = distMultiplier;
            this.mAngleUnit = iAngleUnit;
            this.mDistanceUnit = iDistUnit;
            this.getOp().updateMeasureResults(distMultiplier, iAngleUnit);
        };
        eDwMeasureMgr.prototype.getDistanceUnit = function () {
            return this.mDistanceUnit;
        };
        eDwMeasureMgr.prototype.getAngleUnit = function () {
            return this.mAngleUnit;
        };
        eDwMeasureMgr.prototype.getUnitMultiplier = function () {
            return this.mDistUnitMultiplier;
        };
        eDwMeasureMgr.prototype.getMeasureMode = function () {
            return this.getOp().getMeasureMode();
        };
        eDwMeasureMgr.prototype.setMeasureMode = function (iMode) {
            this.getOp().setMeasureMode(iMode);
        };
        eDwMeasureMgr.prototype.setMeasurePickPoint = function (iEnable) {
            this.getOp().setShowPickPoint(iEnable);
        };
        eDwMeasureMgr.prototype.setMeasureDelta = function (iEnable) {
            this.getOp().setShowDelta(iEnable);
        };
        eDwMeasureMgr.prototype.removeMeasureEntityAt = function (idx) {
            this.getOp().removeMeasureEntityAt(idx);
        };
        eDwMeasureMgr.prototype.clearMeasureEntities = function () {
            this.getOp().clearMeasureEntities();
        };
        eDwMeasureMgr.prototype.highlightSelectEntityAt = function (idx) {
            this.getOp().highlightSelectEntityAt(idx);
        };
        eDwMeasureMgr.prototype.dehighlightAllSelectEntity = function () {
            this.getOp().dehighlightAllTemporaryEntity();
        };
        eDwMeasureMgr.prototype.getOp = function () {
            var op = this.mViewer.OperatorMgr.getOperator(this.mMeasureOpID);
            return op;
        };
        return eDwMeasureMgr;
    }());
    ;
    return eDwMeasureMgr;
});
define("eDwMeasureOperator", ["require", "exports", "eDwBaseOperator", "eDwBaseSelOperator", "eDwMeasureEntities", "eDwTypes", "eDrawingsBase"], function (require, exports, eDwBaseOperator, eDwBaseSelOperator, eDwMeasureEntities, eDwTypes_9) {
    "use strict";
    var eDwMeasureOperator = (function (_super) {
        __extends(eDwMeasureOperator, _super);
        function eDwMeasureOperator(iViewer, iMeasureMgr) {
            var _this = _super.call(this, iViewer, iViewer.SelectionMgr) || this;
            _this.mTempHighlightItem = null;
            _this.mMeasuringItems = [];
            _this.mOperatingLabel = false;
            _this.mViewerHC = iViewer.HCViewer;
            _this.mMeasureMgr = iMeasureMgr;
            _this.mMarkupMgr = _this.mViewerHC.getMarkupManager();
            _this.mPickConfig = new eDwTypes_9.HC.PickConfig(eDwTypes_9.HC.SelectionMask.All);
            _this.mHighlightColor = new eDwTypes_9.HC.Color(72, 219, 251);
            _this.mSelectionColor = new eDwTypes_9.HC.Color(0, 255, 0);
            _this.mSelectionArray = new Array();
            var selManager = _this.mViewerHC.getSelectionManager();
            selManager.setPickTolerance(10);
            _this.mMeasureEntities = new eDwMeasureEntities(_this.mViewerHC, _this.mMeasureMgr.getUnitMultiplier(), _this.mMeasureMgr.getAngleUnit());
            _this.mMeasureEntities.setHighlightColor(new eDwTypes_9.HC.Color(0, 250, 0));
            var mkupId = _this.mMarkupMgr.registerMarkup(_this.mMeasureEntities);
            _this.mMeasureMgr.addMarkup(mkupId);
            _this.mMeasureMode = eDwTypes_9.MeasureMode.ALL;
            return _this;
        }
        eDwMeasureOperator.prototype.onActivate = function () {
            _super.prototype.onActivate.call(this);
            if (!this.mMeasureEntities) {
                this.mMeasureEntities = new eDwMeasureEntities(this.mViewerHC, this.mMeasureMgr.getUnitMultiplier(), this.mMeasureMgr.getAngleUnit());
                var mkupId = this.mMarkupMgr.registerMarkup(this.mMeasureEntities);
                this.mMeasureMgr.addMarkup(mkupId);
            }
            this.mViewer.getHCView().setPointSize(2, eDwTypes_9.HC.PointSizeUnit.ScreenPixels);
            this.pushHighlightSelectionState("NODE", false);
            this.pushHighlightSelectionState("FACE", true);
            this.pushHighlightSelectionState("EDGE", true);
            this.pushHighlightSelectionState("VERTEX", true);
            this.pushElementSelectionColor(this.mHighlightColor);
            this.pushElementSelectionOutlineColor(this.mHighlightColor);
            this.pushNodeSelectionColor(this.mHighlightColor);
            this.pushNodeSelectionOutlineColor(this.mHighlightColor);
            this.pushNodeSelectionHighlightMode("HighlightAndOutline");
            this.pushElementSelectionHighlightMode("HighlightAndOutline");
            var deltaButton = $("#edrawings-measure-menu " +
                ".edrawings-measure-delta-button");
            var pickButton = $("#edrawings-measure-menu " +
                ".edrawings-measure-pickpoint-button");
            this.mMeasureEntities.setMeasureDelta(deltaButton.hasClass("active-button"));
            this.mMeasureEntities.setMeasurePickPoint(pickButton.hasClass("active-button"));
        };
        eDwMeasureOperator.prototype.onDeactivate = function () {
            _super.prototype.onDeactivate.call(this);
            this.mViewer.getHCView().setPointSize(0, eDwTypes_9.HC.PointSizeUnit.ScreenPixels);
            this.mMeasureEntities.reset();
            this.mMeasureEntities = null;
            this.mMeasureMgr.deleteMeasurements();
            this.resetSelections();
        };
        eDwMeasureOperator.prototype.onMouseMove = function (iEvent) {
            var _this = this;
            var pos = iEvent.getPosition();
            if (this.mOperatingLabel) {
                this.mMeasureEntities.onDragLabelMove(pos);
                iEvent.setHandled(true);
                return;
            }
            this.dehighlightAllTemporaryEntity();
            var markupMgr = this.mViewer.HCViewer.getMarkupManager();
            var label = markupMgr.pickMarkupItem(pos);
            if (label) {
                this.mMeasureEntities.resetInstantResults();
                this.resetTempHighlight();
                return;
            }
            if (this.mCurMouse) {
                _super.prototype.onMouseMove.call(this, iEvent);
            }
            else {
                (function () { return __awaiter(_this, void 0, void 0, function () {
                    var selItem, model, nodeID, existId, entityID;
                    return __generator(this, function (_a) {
                        switch (_a.label) {
                            case 0: return [4, this.mViewerHC.getView().pickFromPoint(iEvent.getPosition(), this.mPickConfig)];
                            case 1:
                                selItem = _a.sent();
                                this.mMeasureEntities.addEntityAttempt(selItem);
                                this.resetTempHighlight();
                                if ("undefined" === typeof selItem ||
                                    !selItem.getNodeId()) {
                                    return [2, new Promise(function () { })];
                                }
                                model = this.mViewerHC.getModel();
                                nodeID = selItem.getNodeId();
                                if (!isAllowedSelection(selItem, this.mMeasureMode)) {
                                    return [2, new Promise(function () { })];
                                }
                                existId = this.mMeasureEntities.isItemSelected(selItem);
                                this.mMeasureEntities.highlightTemporaryEntityAt(existId);
                                entityID = eDwMeasureEntities.getMeasureSelItemID(selItem);
                                if (entityID) {
                                    if (selItem.getPointEntity()) {
                                        model.setNodePointHighlighted(nodeID, entityID, true);
                                        this.mTempHighlightItem = selItem;
                                    }
                                    else if (selItem.getLineEntity()) {
                                        model.setNodeLineHighlighted(nodeID, entityID, true);
                                        this.mTempHighlightItem = selItem;
                                    }
                                    else if (selItem.getFaceEntity()) {
                                        model.setNodeFaceHighlighted(nodeID, entityID, true);
                                        this.mTempHighlightItem = selItem;
                                    }
                                    else {
                                        this.mMarkupMgr.refreshMarkup();
                                    }
                                }
                                return [2];
                        }
                    });
                }); })();
                this.mMarkupMgr.refreshMarkup();
            }
        };
        eDwMeasureOperator.prototype.onMouseDown = function (iEvent) {
            var pos = iEvent.getPosition();
            var markupMgr = this.mViewer.HCViewer.getMarkupManager();
            var label = markupMgr.pickMarkupItem(pos);
            if (label) {
                this.resetTempHighlight();
                this.mMeasureEntities.resetInstantResults();
                this.mOperatingLabel = true;
                this.mMeasureEntities.onDragLabelStart(label, pos);
                iEvent.setHandled(true);
                return;
            }
            _super.prototype.onMouseDown.call(this, iEvent);
        };
        eDwMeasureOperator.prototype.onMouseUp = function (iEvent) {
            var _this = this;
            if (this.mOperatingLabel) {
                this.mOperatingLabel = false;
                this.mMeasureEntities.onDragLabelEnd(iEvent.getPosition());
                iEvent.setHandled(true);
                return;
            }
            this.resetTempHighlight();
            if ((iEvent.getButton() === eDwTypes_9.HC.Button.Left) &&
                !this.hasMouseMoved(iEvent)) {
                (function () { return __awaiter(_this, void 0, void 0, function () {
                    var selItem, existId, isAdded;
                    return __generator(this, function (_a) {
                        switch (_a.label) {
                            case 0: return [4, this.mViewerHC.getView().pickFromPoint(iEvent.getPosition(), this.mPickConfig)];
                            case 1:
                                selItem = _a.sent();
                                existId = this.mMeasureEntities.isItemSelected(selItem);
                                if (!this.mMeasureEntities.getMeasurePickPoint() &&
                                    existId >= 0) {
                                    this.mMeasureEntities.removeEntityAtIndex(existId);
                                    return [2];
                                }
                                if (!isAllowedSelection(selItem, this.mMeasureMode))
                                    return [2];
                                return [4, this.mMeasureEntities.addEntity(selItem)];
                            case 2:
                                isAdded = _a.sent();
                                if (isAdded) {
                                    this.highlightMeasuringItem(selItem);
                                }
                                else {
                                    this.dehighlightMeasuringItems();
                                }
                                return [2];
                        }
                    });
                }); })();
                var selectable = eDwTypes_9.HC.Selection.SelectionItem.create(null);
                eDwBaseOperator.setPickResult(iEvent, selectable);
            }
            _super.prototype.onMouseUp.call(this, iEvent);
        };
        eDwMeasureOperator.prototype.onTouchStart = function (ioTouchEvent) {
            var _this = this;
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_9.HC.MouseInputType.Down, function (ioMouseEvent) {
                _this.onMouseDown(ioMouseEvent);
            });
        };
        eDwMeasureOperator.prototype.onTouchMove = function (ioTouchEvent) {
            var _this = this;
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_9.HC.MouseInputType.Move, function (ioMouseEvent) {
                _this.onMouseMove(ioMouseEvent);
            });
        };
        eDwMeasureOperator.prototype.onTouchEnd = function (ioTouchEvent) {
            var _this = this;
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_9.HC.MouseInputType.Up, function (ioMouseEvent) {
                _this.onMouseUp(ioMouseEvent);
            });
        };
        eDwMeasureOperator.prototype.updateMeasureResults = function (iUnitMultiplier, iAngleUnit) {
            this.mMeasureEntities.setMeasureUnit(iUnitMultiplier, iAngleUnit);
        };
        eDwMeasureOperator.prototype.removeMeasureEntityAt = function (idx) {
            this.mMeasureEntities.removeEntityAtIndex(idx);
        };
        eDwMeasureOperator.prototype.clearMeasureEntities = function () {
            this.mMeasureEntities.reset();
        };
        eDwMeasureOperator.prototype.highlightSelectEntityAt = function (idx) {
            this.mMeasureEntities.highlightTemporaryEntityAt(idx);
        };
        eDwMeasureOperator.prototype.dehighlightAllTemporaryEntity = function () {
            this.mMeasureEntities.dehighlightAllTemporaryEntity();
            this.resetTempHighlight();
        };
        eDwMeasureOperator.prototype.getMeasureMode = function () {
            return this.mMeasureMode;
        };
        eDwMeasureOperator.prototype.setMeasureMode = function (iMode) {
            this.mMeasureMode = iMode;
        };
        eDwMeasureOperator.prototype.setShowPickPoint = function (iEnable) {
            this.mMeasureEntities.setMeasurePickPoint(iEnable);
        };
        eDwMeasureOperator.prototype.setShowDelta = function (iEnable) {
            this.mMeasureEntities.setMeasureDelta(iEnable);
        };
        eDwMeasureOperator.prototype.highlightMeasuringItem = function (iSelItem) {
            this.mMeasuringItems.push(iSelItem);
            this.mViewerHC.getSelectionManager().add(iSelItem);
        };
        eDwMeasureOperator.prototype.dehighlightMeasuringItems = function () {
            this.mMeasuringItems = [];
            this.mViewerHC.getSelectionManager().clear();
        };
        eDwMeasureOperator.prototype.removeMeasuringItemTempHighlight = function () {
            for (var _i = 0, _a = this.mMeasuringItems; _i < _a.length; _i++) {
                var selItem = _a[_i];
                var model = this.mViewerHC.getModel();
                var nodeID = selItem.getNodeId();
                var entityID = eDwMeasureEntities.getMeasureSelItemID(selItem);
                if (selItem.getFaceEntity()) {
                    model.setNodeFaceHighlighted(nodeID, entityID, false);
                }
                if (selItem.getLineEntity()) {
                    model.setNodeLineHighlighted(nodeID, entityID, false);
                }
                if (selItem.getPointEntity()) {
                    model.setNodePointHighlighted(nodeID, entityID, false);
                }
            }
        };
        eDwMeasureOperator.prototype.resetSelections = function () {
            var arraySize = this.mSelectionArray.length;
            for (var i = 0; i < arraySize; i++) {
                this.mSelectionArray[i].reset(this.mViewerHC.getModel());
            }
            this.mSelectionArray.length = 0;
            this.mViewerHC.getSelectionManager().clear();
        };
        eDwMeasureOperator.prototype.resetTempHighlight = function () {
            var highlightItem = this.mTempHighlightItem;
            if (highlightItem) {
                var entityID = eDwMeasureEntities.getMeasureSelItemID(highlightItem);
                if (highlightItem.getFaceEntity()) {
                    this.mViewerHC.getModel().setNodeFaceHighlighted(highlightItem.getNodeId(), entityID, false);
                }
                if (highlightItem.getLineEntity()) {
                    this.mViewerHC.getModel().setNodeLineHighlighted(highlightItem.getNodeId(), entityID, false);
                }
                if (highlightItem.getPointEntity()) {
                    this.mViewerHC.getModel().setNodePointHighlighted(highlightItem.getNodeId(), entityID, false);
                }
                this.mTempHighlightItem = null;
            }
            this.removeMeasuringItemTempHighlight();
        };
        return eDwMeasureOperator;
    }(eDwBaseSelOperator));
    ;
    function isAllowedSelection(iSelItem, iMeasureMode) {
        iSelItem.getSelectionType();
        if ((iSelItem.getPointEntity() && iMeasureMode & eDwTypes_9.MeasureMode.VERTEX) ||
            (iSelItem.getLineEntity() && iMeasureMode & eDwTypes_9.MeasureMode.EDGE) ||
            (iSelItem.getFaceEntity() && iMeasureMode & eDwTypes_9.MeasureMode.FACE) ||
            iSelItem.getSelectionType() === eDwTypes_9.HC.SelectionType.None) {
            return true;
        }
        return false;
    }
    return eDwMeasureOperator;
});
define("eDwModel", ["require", "exports", "eDwEventMgr", "eDwHierarchyNode", "eDwModelView", "eDwServiceMgr", "eDwTypes", "eDrawingsBase"], function (require, exports, eDwEventMgr, eDwHierarchyNode, eDwModelView, eDwServiceMgr, eDwTypes_10) {
    "use strict";
    var eDwModel = (function () {
        function eDwModel(iViewer) {
            this.mMeasurable = true;
            this.mViewer = iViewer;
            this.mModelHC = iViewer.HCViewer.getModel();
            this.mModelViews = {};
            this.mInitialModelView = this.mActiveModelView = null;
            this.mCategory = "UNKNOWN";
            this.mOrigin = "";
            this.mBox = new eDwTypes_10.HC.Box();
            this.mModelHC.setBehaviorInitiallyHidden(false);
            this.calculateBoundingBox();
        }
        eDwModel.prototype.initModelData = function () {
            return __awaiter(this, void 0, void 0, function () {
                var nodeProps, modelViews, _i, modelViews_1, modelView, attribs;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!this.mViewer)
                                return [2];
                            this.mViewer.initializeManagers();
                            return [4, this.mModelHC.getNodeProperties(this.getModelHCID())];
                        case 1:
                            nodeProps = _a.sent();
                            this.loadXMLProperty(nodeProps.eDrawingsXMLData);
                            modelViews = this.getModelViews();
                            for (_i = 0, modelViews_1 = modelViews; _i < modelViews_1.length; _i++) {
                                modelView = modelViews_1[_i];
                                attribs = modelView.Hierarchy.getAttribs();
                                if (attribs.Visible) {
                                    this.mActiveModelView = modelView;
                                    this.mInitialModelView = this.mActiveModelView;
                                    return [2];
                                }
                            }
                            if (modelViews.length) {
                                console.warn("There is no active model view." +
                                    "  Defaulting to first.");
                                this.mActiveModelView = this.mInitialModelView = modelViews[0];
                                return [2];
                            }
                            console.warn("There are no model views in this model.");
                            throw new Error("There are no model views in this model.");
                    }
                });
            });
        };
        eDwModel.prototype.getBoundingBox = function () {
            return this.mBox;
        };
        eDwModel.prototype.calculateBoundingBox = function (iIgnoreInvisible, iIncludeExcluded) {
            if (iIgnoreInvisible === void 0) { iIgnoreInvisible = true; }
            if (iIncludeExcluded === void 0) { iIncludeExcluded = false; }
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _a = this;
                            return [4, this.mModelHC.getModelBounding(iIgnoreInvisible, iIncludeExcluded)];
                        case 1:
                            _a.mBox = _b.sent();
                            return [2, this.mBox];
                    }
                });
            });
        };
        eDwModel.prototype.setMeasureable = function (val) {
            this.mMeasurable = val;
        };
        eDwModel.prototype.getMeasureable = function () {
            return this.mMeasurable;
        };
        eDwModel.prototype.getModelHCID = function () {
            return 0;
        };
        eDwModel.prototype.setAttribOnHierNodes = function (iHierNodes, iAttribs) {
            return __awaiter(this, void 0, void 0, function () {
                var changedHierNodes, changedAncestorHierNodeMap, _i, iHierNodes_1, hierNode, changedAttribNames, propagatingAttribNames, changedChildHierNodes, _a, propagatingAttribNames_1, attribName, attrib, parentHierNode, parentAttrib, value, mergedAttrib, changedHierNodesAndAttribs, _b, changedHierNodes_1, hierNode, changedNodeKey, ancHierNode;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            changedHierNodes = [];
                            changedAncestorHierNodeMap = [];
                            for (_i = 0, iHierNodes_1 = iHierNodes; _i < iHierNodes_1.length; _i++) {
                                hierNode = iHierNodes_1[_i];
                                if (hierNode && !isNaN(hierNode.HOOPSID)) {
                                    changedAttribNames = hierNode.setAttribs(iAttribs);
                                    propagatingAttribNames = eDwHierarchyNode.findPropagatingAttribNames(changedAttribNames);
                                    if (propagatingAttribNames.length) {
                                        changedHierNodes.push(hierNode);
                                        changedChildHierNodes = hierNode.propagateAttribsToChildren(propagatingAttribNames);
                                        Array.prototype.push.apply(changedHierNodes, changedChildHierNodes);
                                        for (_a = 0, propagatingAttribNames_1 = propagatingAttribNames; _a < propagatingAttribNames_1.length; _a++) {
                                            attribName = propagatingAttribNames_1[_a];
                                            attrib = {};
                                            attrib[attribName] = iAttribs[attribName];
                                            parentHierNode = hierNode.ParentNode;
                                            while (parentHierNode) {
                                                parentAttrib = parentHierNode.getAttribs();
                                                value = parentAttrib[attribName];
                                                if (value) {
                                                    if (value !== attrib[attribName]) {
                                                        mergedAttrib = parentHierNode.getMergedChildrenAttribs("DirectDescendantsOnly");
                                                        if (!mergedAttrib[attribName]) {
                                                            parentHierNode.setAttribs(attrib);
                                                            changedAncestorHierNodeMap[parentHierNode.HOOPSID] =
                                                                parentHierNode;
                                                            parentHierNode =
                                                                parentHierNode.ParentNode;
                                                        }
                                                        else {
                                                            parentHierNode = null;
                                                        }
                                                    }
                                                    else {
                                                        parentHierNode = null;
                                                    }
                                                }
                                                else {
                                                    if (value !== attrib[attribName]) {
                                                        parentHierNode.setAttribs(attrib);
                                                        changedAncestorHierNodeMap[parentHierNode.HOOPSID] =
                                                            parentHierNode;
                                                        parentHierNode =
                                                            parentHierNode.ParentNode;
                                                    }
                                                    else {
                                                        parentHierNode = null;
                                                    }
                                                }
                                                if (parentHierNode && !parentHierNode.ParentNode) {
                                                    parentHierNode = null;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            changedHierNodesAndAttribs = [];
                            for (_b = 0, changedHierNodes_1 = changedHierNodes; _b < changedHierNodes_1.length; _b++) {
                                hierNode = changedHierNodes_1[_b];
                                changedHierNodesAndAttribs.push({ HierNode: hierNode, Attribs: iAttribs });
                            }
                            return [4, this.syncHCNodesState(changedHierNodesAndAttribs)];
                        case 1:
                            _c.sent();
                            for (changedNodeKey in changedAncestorHierNodeMap) {
                                ancHierNode = changedAncestorHierNodeMap[changedNodeKey];
                                changedHierNodes.push(ancHierNode);
                            }
                            if (changedHierNodes.length) {
                                eDwEventMgr.get().fireEvents("NodeAttribChange", this.mViewer, changedHierNodesAndAttribs);
                            }
                            return [2];
                    }
                });
            });
        };
        eDwModel.prototype.setAttribs = function (iNodesWithAttribs) {
            return __awaiter(this, void 0, void 0, function () {
                var nodesWithAttribs, _i, nodesWithAttribs_1, nodeWithAttrib;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            nodesWithAttribs = iNodesWithAttribs;
                            _i = 0, nodesWithAttribs_1 = nodesWithAttribs;
                            _a.label = 1;
                        case 1:
                            if (!(_i < nodesWithAttribs_1.length)) return [3, 4];
                            nodeWithAttrib = nodesWithAttribs_1[_i];
                            return [4, this.setAttribOnHierNodes([nodeWithAttrib.HierNode], nodeWithAttrib.Attribs)];
                        case 2:
                            _a.sent();
                            _a.label = 3;
                        case 3:
                            _i++;
                            return [3, 1];
                        case 4: return [2];
                    }
                });
            });
        };
        eDwModel.prototype.setOverrideAttribOnHierNodes = function (iHierNodesAndAttribs) {
            return __awaiter(this, void 0, void 0, function () {
                var overriddenHierNodesAndAttribs, _i, iHierNodesAndAttribs_1, hierNodeAndAttribs, hierNode, attribs, childHierNodesAndAttribs, children, key;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            overriddenHierNodesAndAttribs = [];
                            for (_i = 0, iHierNodesAndAttribs_1 = iHierNodesAndAttribs; _i < iHierNodesAndAttribs_1.length; _i++) {
                                hierNodeAndAttribs = iHierNodesAndAttribs_1[_i];
                                hierNode = hierNodeAndAttribs.HierNode;
                                attribs = hierNodeAndAttribs.Attribs;
                                hierNode.setOverrideAttribs(attribs);
                                overriddenHierNodesAndAttribs.push({ HierNode: hierNode, Attribs: hierNode.getAttribs() });
                                childHierNodesAndAttribs = [];
                                children = hierNode.getChildren();
                                for (key in children) {
                                    childHierNodesAndAttribs.push({
                                        HierNode: children[key],
                                        Attribs: attribs
                                    });
                                }
                                this.setOverrideAttribOnHierNodes(childHierNodesAndAttribs);
                            }
                            return [4, this.syncHCNodesState(overriddenHierNodesAndAttribs)];
                        case 1:
                            _a.sent();
                            if (overriddenHierNodesAndAttribs.length) {
                                eDwEventMgr.get().fireEvents("NodeAttribChange", this.mViewer, overriddenHierNodesAndAttribs);
                            }
                            return [2];
                    }
                });
            });
        };
        eDwModel.prototype.isAssembly = function () {
            return this.mCategory === "ASSEMBLY" ? true : false;
        };
        eDwModel.prototype.isPart = function () {
            return this.mCategory === "PART" ? true : false;
        };
        eDwModel.prototype.isDrawing = function () {
            return this.mCategory === "DRAWING" ? true : false;
        };
        eDwModel.prototype.getNodeType = function (iNodeID) {
            if (iNodeID === null || iNodeID === undefined) {
                return eDwTypes_10.HC.NodeType.Unknown;
            }
            return this.mModelHC.getNodeType(iNodeID);
        };
        eDwModel.prototype.getHierarchyNode = function (iIDHC) {
            var modelHC = this.getHCModel();
            var modelViews = this.getModelViews();
            var i = 0;
            var modelView;
            var hierNode;
            while (i < modelViews.length && (modelView = modelViews[i++]) &&
                !hierNode) {
                var nodeType = this.getNodeType(iIDHC);
                var nodeIDHC = iIDHC;
                hierNode = modelView.Nodes[nodeIDHC];
                while ((hierNode && (!hierNode.isSelectable() &&
                    hierNode !== modelView.Hierarchy)) ||
                    (!hierNode && nodeType !== eDwTypes_10.HC.NodeType.Unknown)) {
                    nodeIDHC = modelHC.getNodeParent(nodeIDHC);
                    nodeType = this.getNodeType(nodeIDHC);
                    hierNode = modelView.Nodes[nodeIDHC];
                }
            }
            return hierNode;
        };
        eDwModel.prototype.getModelViews = function () {
            var modelViews = [];
            for (var modelViewName in this.mModelViews) {
                modelViews.push(this.mModelViews[modelViewName]);
            }
            return modelViews;
        };
        eDwModel.prototype.getModelView = function (iName) {
            return this.mModelViews[iName];
        };
        eDwModel.prototype.getActiveModelView = function () {
            return this.mActiveModelView;
        };
        eDwModel.prototype.activateModelView = function (iModelViewName, iCamera) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (iModelViewName === this.mActiveModelView.Name)
                                return [2];
                            return [4, this.setActiveModelView(iModelViewName, iCamera)];
                        case 1:
                            _a.sent();
                            return [2];
                    }
                });
            });
        };
        eDwModel.prototype.getFileOriginType = function () {
            return this.mOrigin;
        };
        eDwModel.prototype.addIDToNode = function (iPathToNode, iID) {
            if (!iPathToNode)
                return null;
            var retNode = this.findNode(iPathToNode);
            if (retNode)
                retNode.HOOPSID = iID;
            return retNode;
        };
        eDwModel.prototype.resetToDefault = function () {
            this.setActiveModelView(this.mInitialModelView.Name, this.mViewer.getInitCamera());
        };
        eDwModel.prototype.notifyDataChange = function (iModelView) {
            if (!iModelView)
                return;
            var eventMgr = eDwEventMgr.get();
            eventMgr.fireEvents("ModelViewChange", this.mViewer, iModelView, this.mCategory !== "PART");
        };
        eDwModel.prototype.parseHierarchy = function (iConfig, iParentNode, iXMLNode, iParseDepth) {
            if ((iParseDepth !== undefined && iParseDepth === 0) ||
                this.mCategory === "PART") {
                return;
            }
            var children = $(iXMLNode).children("body,assembly,view");
            for (var i = 0; i < children.length; i++) {
                var childJQ = $(children[i]);
                var elemTag = childJQ.prop("tagName");
                var name_1 = childJQ.attr("name");
                var attribs = {};
                attribs.Visible = childJQ.attr("visible") === "1" ? true : false;
                attribs.Selectable = childJQ.attr("selectable") ? true : false;
                attribs.Opaque =
                    childJQ.attr("transparent") === "1" ? false : true;
                var newChild = iParentNode.addChild(name_1, elemTag, attribs, iParentNode);
                this.parseHierarchy(iConfig, newChild, childJQ, iParseDepth - 1);
            }
        };
        eDwModel.prototype.loadXMLProperty = function (iXML) {
            console.debugLog("ViewerLoad", "XML = " + iXML);
            var doc = $.parseXML(iXML);
            var data = $(doc).find("sceneData");
            if (data.length > 0) {
                var sceneData = $(data[0]);
                this.mOrigin = sceneData.attr("origin");
                switch (sceneData.attr("type")) {
                    case "drawing":
                        this.mCategory = "DRAWING";
                        break;
                    case "part":
                        this.mCategory = "PART";
                        break;
                    case "assembly":
                        this.mCategory = "ASSEMBLY";
                        break;
                    default:
                        break;
                }
            }
            var properties = $(doc).find("property");
            if (properties.length > 0) {
                var numProps = properties.length;
                for (var i = 0; i < properties.length; i++) {
                    var property = $(properties[i]);
                    var propName = property.attr("name");
                    var val = property.attr("val");
                    switch (propName) {
                        case "measure":
                            this.mViewer.getModel().setMeasureable(val === "true");
                            break;
                        default:
                            break;
                    }
                }
            }
            var configurations = $(doc).find("configuration");
            if (configurations.length > 0) {
                var numConfigs = configurations.length;
                for (var i = 0; i < configurations.length; i++) {
                    var modelViewXML = $(configurations[i]);
                    var configName = modelViewXML.attr("name");
                    if (!configName) {
                        configName = "Unnamed Config" + (i + 1);
                    }
                    var attribs = {};
                    attribs.Visible = modelViewXML.attr("visible") === "1" ? true
                        : false;
                    var modelView = this.mModelViews[configName] =
                        new eDwModelView(configName, "config", attribs, this);
                    this.readModelViewPreviewImage(modelView, i);
                    var hierarchyNode = modelView.Hierarchy;
                    this.parseHierarchy(modelView, hierarchyNode, modelViewXML.find("hierarchy"));
                    assignHOOPSID(hierarchyNode, modelView, this, this.getModelHCID());
                    addTables(this.mViewer, $(doc), this, hierarchyNode, modelView);
                }
            }
            else {
                var sheets = $(doc).find("sheet");
                for (var i = 0; i < sheets.length; i++) {
                    var modelViewXML = $(sheets[i]);
                    var sheetName = modelViewXML.attr("name");
                    var attribs = {};
                    attribs.Visible = modelViewXML.attr("visible") === "1" ? true
                        : false;
                    attribs.Selectable = modelViewXML.attr("selectable") ? true
                        : false;
                    var modelView = this.mModelViews[sheetName] =
                        new eDwModelView(sheetName, "sheet", attribs, this);
                    var hierarchyNode = modelView.Hierarchy;
                    this.parseHierarchy(modelView, hierarchyNode, modelViewXML.find("views"));
                    assignHOOPSID(hierarchyNode, modelView, this, this.getModelHCID());
                    this.processLayers(this.mModelViews[sheetName], hierarchyNode, hierarchyNode.HOOPSID);
                    addTables(this.mViewer, $(doc), this, hierarchyNode, modelView);
                }
            }
            if (this.getModelViews().length === 0) {
                var attrib = { Visible: true };
                this.mModelViews["eDrawingsDefault"] = new eDwModelView("eDrawingsDefault", "config", attrib, this);
            }
        };
        eDwModel.prototype.processLayers = function (ioModelView, iSheetHierNode, iNodeHCID) {
            var layerMark = "(layername)";
            var childName = this.mModelHC.getNodeName(iNodeHCID);
            if (childName && -1 !== childName.indexOf(layerMark)) {
                childName = childName.replace(layerMark, "");
                if (childName.length) {
                    var attribs = { Visible: true };
                    var hierarchyNode = iSheetHierNode.addChild(childName, "layer", attribs, iSheetHierNode);
                    hierarchyNode.HOOPSID = iNodeHCID;
                    ioModelView.Nodes[iNodeHCID] = hierarchyNode;
                }
            }
            var childHCIDs = this.mModelHC.getNodeChildren(iNodeHCID);
            for (var i = 0; i < childHCIDs.length; i++) {
                this.processLayers(ioModelView, iSheetHierNode, childHCIDs[i]);
            }
        };
        eDwModel.prototype.findNode = function (iPathToNode) {
            if (!iPathToNode)
                return null;
            var nodeNames = iPathToNode.split("/");
            var retNode = null;
            var modelView = this.mModelViews[nodeNames[0]];
            if (modelView) {
                retNode = modelView.Hierarchy;
                for (var i = 1; i < nodeNames.length && retNode; i++) {
                    retNode = retNode.getChildren()[nodeNames[i]];
                }
            }
            return retNode;
        };
        eDwModel.prototype.readModelViewPreviewImage = function (iModelView, iIndex) {
            return __awaiter(this, void 0, void 0, function () {
                var imageFileName, modelKey, fileInfo, iExcp_7;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            imageFileName = "config_" + iIndex + ".jpg";
                            modelKey = this.mViewer.getCurrModelKey();
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            return [4, eDwServiceMgr.get().getFileFromServerModelCache(modelKey, imageFileName)];
                        case 2:
                            fileInfo = _a.sent();
                            if (fileInfo.Data) {
                                iModelView.setPreviewImagePath(fileInfo.Path);
                            }
                            return [3, 4];
                        case 3:
                            iExcp_7 = _a.sent();
                            return [3, 4];
                        case 4: return [2];
                    }
                });
            });
        };
        eDwModel.prototype.getAllModelViewHierarchyNodes = function () {
            var modelViews = this.getModelViews();
            var modelViewHierarchyNodes = [];
            for (var _i = 0, modelViews_2 = modelViews; _i < modelViews_2.length; _i++) {
                var modelView = modelViews_2[_i];
                modelViewHierarchyNodes.push(modelView.Hierarchy);
            }
            return modelViewHierarchyNodes;
        };
        eDwModel.prototype.setActiveModelView = function (iModelViewName, iCamera) {
            return __awaiter(this, void 0, void 0, function () {
                var newModelView, oldModelView, debug, camera, hierNodeHCID, iError_1;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            newModelView = this.mModelViews[iModelViewName];
                            if (!newModelView) return [3, 8];
                            oldModelView = this.mActiveModelView;
                            this.mActiveModelView = newModelView;
                            debug = this.mViewer.ViewerFeatureOpts.Debug;
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 6, , 7]);
                            if (!oldModelView) return [3, 3];
                            if (debug) {
                                dumpModelViewStateInfo("Before set oldModelView = false", this.mModelViews, this.mModelHC);
                            }
                            return [4, this.setAttribOnHierNodes([oldModelView.Hierarchy], { Visible: false })];
                        case 2:
                            _a.sent();
                            if (debug) {
                                dumpModelViewStateInfo("After set oldModelView = false", this.mModelViews, this.mModelHC);
                            }
                            _a.label = 3;
                        case 3: return [4, this.hackAroundTSBug_BadInitialVisState()];
                        case 4:
                            _a.sent();
                            if (debug) {
                                dumpModelViewStateInfo("Before set active view = true", this.mModelViews, this.mModelHC);
                            }
                            return [4, this.setAttribOnHierNodes([this.mActiveModelView.Hierarchy], { Visible: true })];
                        case 5:
                            _a.sent();
                            if (debug) {
                                dumpModelViewStateInfo("After set active view = true", this.mModelViews, this.mModelHC);
                            }
                            if (this.isDrawing()) {
                                camera = iCamera.copy();
                                hierNodeHCID = this.mActiveModelView.Hierarchy.HOOPSID;
                                this.mViewer.ViewMgr.fitScreenToNodes([hierNodeHCID], camera);
                            }
                            else {
                                this.mViewer.ViewMgr.setCamera(iCamera, 400);
                            }
                            return [3, 7];
                        case 6:
                            iError_1 = _a.sent();
                            console.debugLog("NodeVisibility", "activateModelView failed to set node visibilities.");
                            console.error(iError_1);
                            return [3, 7];
                        case 7:
                            this.notifyDataChange(newModelView);
                            _a.label = 8;
                        case 8: return [2];
                    }
                });
            });
        };
        eDwModel.prototype.setHCToAttrib = function (iNodeHCIDsAndAttribs) {
            return __awaiter(this, void 0, void 0, function () {
                var _i, iNodeHCIDsAndAttribs_1, nodeHCIDAndAttribs, nodeHCID, attribs, oldVisibility, oldOpacity, nodeHCName, opacities, iErrorMsg_1, opacity, newVisibility;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!iNodeHCIDsAndAttribs.length)
                                return [2];
                            _i = 0, iNodeHCIDsAndAttribs_1 = iNodeHCIDsAndAttribs;
                            _a.label = 1;
                        case 1:
                            if (!(_i < iNodeHCIDsAndAttribs_1.length)) return [3, 13];
                            nodeHCIDAndAttribs = iNodeHCIDsAndAttribs_1[_i];
                            nodeHCID = nodeHCIDAndAttribs.ID;
                            attribs = nodeHCIDAndAttribs.Attribs;
                            oldVisibility = void 0;
                            oldOpacity = void 0;
                            nodeHCName = void 0;
                            if (!this.mViewer.ViewerFeatureOpts.Debug) return [3, 6];
                            _a.label = 2;
                        case 2:
                            _a.trys.push([2, 4, , 5]);
                            return [4, this.mModelHC.getNodesTransparency([nodeHCID])];
                        case 3:
                            opacities = _a.sent();
                            oldOpacity = opacities[0];
                            return [3, 5];
                        case 4:
                            iErrorMsg_1 = _a.sent();
                            oldOpacity = undefined;
                            return [3, 5];
                        case 5:
                            oldVisibility = this.mModelHC.getNodeVisibility(nodeHCID);
                            nodeHCName = this.mModelHC.getNodeName(nodeHCID);
                            _a.label = 6;
                        case 6:
                            opacity = void 0;
                            if (!(attribs.Opaque !== undefined)) return [3, 9];
                            return [4, this.mModelHC.setNodesVisibility([nodeHCID], true)];
                        case 7:
                            _a.sent();
                            opacity = attribs.Opaque ? 1 : .5;
                            return [4, this.mModelHC.setNodesTransparency([nodeHCID], opacity)];
                        case 8:
                            _a.sent();
                            return [3, 11];
                        case 9: return [4, this.mModelHC.setNodesVisibility([nodeHCID], attribs.Visible)];
                        case 10:
                            _a.sent();
                            _a.label = 11;
                        case 11:
                            if (this.mViewer.ViewerFeatureOpts.Debug) {
                                newVisibility = this.mModelHC.getNodeVisibility(nodeHCID);
                                console.debugLog("NodeVisibility", "HC Node name = " +
                                    nodeHCName + " | old visibility = " +
                                    oldVisibility + " | new visibility = " +
                                    newVisibility + " | intended visibility = " +
                                    attribs.Visible + " | old opacity = " +
                                    oldOpacity + " | intended opacity = " + opacity);
                            }
                            _a.label = 12;
                        case 12:
                            _i++;
                            return [3, 1];
                        case 13: return [2];
                    }
                });
            });
        };
        eDwModel.prototype.syncHCNodesState = function (iHierNodesAndAttribs) {
            return __awaiter(this, void 0, void 0, function () {
                var nodeHCIDsAndAttribs, _i, iHierNodesAndAttribs_2, hierNodeAndAttribs, hierNode;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            nodeHCIDsAndAttribs = [];
                            for (_i = 0, iHierNodesAndAttribs_2 = iHierNodesAndAttribs; _i < iHierNodesAndAttribs_2.length; _i++) {
                                hierNodeAndAttribs = iHierNodesAndAttribs_2[_i];
                                hierNode = hierNodeAndAttribs.HierNode;
                                if (hierNode.HOOPSID && !isNaN(hierNode.HOOPSID)) {
                                    nodeHCIDsAndAttribs.push({ ID: hierNode.HOOPSID,
                                        Attribs: hierNodeAndAttribs.Attribs });
                                }
                            }
                            return [4, this.setHCToAttrib(nodeHCIDsAndAttribs)];
                        case 1:
                            _a.sent();
                            return [2];
                    }
                });
            });
        };
        eDwModel.prototype.hackAroundTSBug_BadInitialVisState = function () {
            return __awaiter(this, void 0, void 0, function () {
                var hackedThis;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            hackedThis = this;
                            hackedThis.hackInitializedModelViews =
                                hackedThis.hackInitializedModelViews || {};
                            if (!!hackedThis.hackInitializedModelViews[this.mActiveModelView.Name]) return [3, 4];
                            hackedThis.hackInitializedModelViews[this.mActiveModelView.Name] =
                                true;
                            dumpModelViewStateInfo("Before hack set active view = false", this.mModelViews, this.mModelHC);
                            return [4, this.setAttribOnHierNodes([this.mActiveModelView.Hierarchy], { Visible: false })];
                        case 1:
                            _a.sent();
                            return [4, this.setAttribOnHierNodes([this.mActiveModelView.Hierarchy], { Visible: true })];
                        case 2:
                            _a.sent();
                            return [4, this.setAttribOnHierNodes([this.mActiveModelView.Hierarchy], { Visible: false })];
                        case 3:
                            _a.sent();
                            dumpModelViewStateInfo("After hack set active view = false", this.mModelViews, this.mModelHC);
                            _a.label = 4;
                        case 4: return [2];
                    }
                });
            });
        };
        eDwModel.prototype.getHCModel = function () { return this.mModelHC; };
        return eDwModel;
    }());
    ;
    function addTables(iViewer, iDoc, iModel, ioHierachyNode, ioModelView) {
        var tables = $(iDoc).find("table");
        var numTables = tables.length;
        if (numTables > 0 && ioHierachyNode) {
            for (var i = 0; i < numTables; i++) {
                var tableJQ = $(tables[i]);
                var tableName = tableJQ.attr("name");
                if (!tableName) {
                    tableName = "Unnamed Table" + (i + 1);
                }
                var attribs = {};
                attribs.Visible =
                    tableJQ.attr("visible") === "1" ? true : false;
                attribs.NotesArea =
                    tableJQ.attr("notesarea") === "1" ? true : false;
                attribs.Selectable = tableJQ.attr("selectable") ? true : false;
                var hierarchyNode = ioHierachyNode.addChild(tableName, "table", attribs, ioHierachyNode);
                assignHOOPSID(hierarchyNode, ioModelView, iModel, ioHierachyNode.HOOPSID);
                iViewer.TableMgr.add(hierarchyNode);
            }
        }
    }
    function assignHOOPSID(ioHierNode, ioModelView, iModel, iAncestorNodeHCID) {
        ioHierNode.HOOPSID = ioHierNode.findFirstMatchingHCNode(iModel.getHCModel(), iAncestorNodeHCID);
        ioModelView.Nodes[ioHierNode.HOOPSID] = ioHierNode;
    }
    function dumpModelViewStateInfo(iPrefixMsg, iModelViews, iModelHC) {
        var msg = iPrefixMsg + " -> | ";
        for (var mvName in iModelViews) {
            var nodeHCID = iModelViews[mvName].Hierarchy.HOOPSID;
            msg += mvName + " - " + iModelHC.getNodeVisibility(nodeHCID) +
                " | ";
        }
        console.debugLog("NodeVisibility", msg);
    }
    return eDwModel;
});
define("eDwModelView", ["require", "exports", "eDwHierarchyNode"], function (require, exports, eDwHierarchyNode) {
    "use strict";
    var eDwModelView = (function () {
        function eDwModelView(Name, Category, iAttribs, iModel) {
            this.Name = Name;
            this.Category = Category;
            this.Hierarchy = new eDwHierarchyNode(this.Name, this.Category, iAttribs, null, this, iModel);
            this.Nodes = {};
            this.mPreviewImage = "";
        }
        eDwModelView.prototype.getNodes = function () {
            var hierNodes = [];
            for (var hierNodeName in this.Nodes) {
                hierNodes.push(this.Nodes[hierNodeName]);
            }
            return hierNodes;
        };
        eDwModelView.prototype.setPreviewImagePath = function (iImagePath) {
            this.mPreviewImage = iImagePath;
        };
        eDwModelView.prototype.getPreviewImagePath = function () {
            return this.mPreviewImage;
        };
        return eDwModelView;
    }());
    ;
    return eDwModelView;
});
define("eDwMoveComponentCmd", ["require", "exports", "eDwSupportsHistoryCmd", "utils", "eDrawingsBase"], function (require, exports, eDwSupportsHistoryCmd, Utils) {
    "use strict";
    var eDwMoveComponentCmd = (function (_super) {
        __extends(eDwMoveComponentCmd, _super);
        function eDwMoveComponentCmd(iViewer, iComponentData) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitialComponentXforms = _this.assignModelXforms(iComponentData);
            return _this;
        }
        eDwMoveComponentCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.setModelXforms(this.mInitialComponentXforms);
            return true;
        };
        eDwMoveComponentCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.setModelXforms(this.mFinalComponentXforms);
            return true;
        };
        eDwMoveComponentCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            this.setModelXforms(this.mFinalComponentXforms);
        };
        Object.defineProperty(eDwMoveComponentCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        eDwMoveComponentCmd.prototype.setFinalComponentXforms = function (iComponentData) {
            this.mFinalComponentXforms = this.assignModelXforms(iComponentData);
        };
        eDwMoveComponentCmd.prototype.setModelXforms = function (iComponentXforms) {
            if (!iComponentXforms)
                return;
            var modelHC = this.mViewer.getModel().getHCModel();
            for (var _i = 0, iComponentXforms_1 = iComponentXforms; _i < iComponentXforms_1.length; _i++) {
                var compXform = iComponentXforms_1[_i];
                modelHC.setNodeMatrix(compXform.NodeID, compXform.Xform.copy());
            }
        };
        eDwMoveComponentCmd.prototype.assignModelXforms = function (iComponentData) {
            var componentXforms = [];
            if (!iComponentData)
                return componentXforms;
            Utils.forAll(function (iCompNodeID, iCompData) {
                componentXforms.push({ NodeID: iCompNodeID,
                    Xform: iCompData.Xform.copy() });
            }, iComponentData);
            return componentXforms;
        };
        return eDwMoveComponentCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwMoveComponentCmd;
});
define("eDwMoveOperator", ["require", "exports", "eDwBaseOperator", "eDwBaseSelOperator", "eDwEventMgr", "eDwCommandMgr", "eDwMoveComponentCmd", "eDwTypes", "utils", "eDrawingsBase"], function (require, exports, eDwBaseOperator, eDwBaseSelOperator, eDwEventMgr, eDwCommandMgr, eDwMoveComponentCmd, eDwTypes_11, utils) {
    "use strict";
    var eDwMoveOperator = (function (_super) {
        __extends(eDwMoveOperator, _super);
        function eDwMoveOperator(iViewer, iSelMgr) {
            return _super.call(this, iViewer, iSelMgr) || this;
        }
        eDwMoveOperator.prototype.onActivate = function () {
            _super.prototype.onActivate.call(this);
            this.mSelMgr.unSelectAllObjects();
        };
        eDwMoveOperator.prototype.onDeactivate = function () {
            _super.prototype.onDeactivate.call(this);
            this.mSelMgr.unSelectAllObjects();
            this.mLastDragPt = null;
        };
        eDwMoveOperator.prototype.onMouseDown = function (ioMouseEvent) {
            var _this = this;
            _super.prototype.onMouseDown.call(this, ioMouseEvent);
            if (!ioMouseEvent)
                return;
            ioMouseEvent.setHandled(false);
            var eventMgr = eDwEventMgr.get();
            var button = ioMouseEvent.getButton();
            if ((button === eDwTypes_11.HC.Button.Left) || (button === eDwTypes_11.HC.Button.Right)) {
                if (this.mCompDataLocal) {
                    console.warn("Component transform already exists");
                }
                var newlySelObj = _super.prototype.getSelObjFromEvent.call(this, ioMouseEvent);
                if (!newlySelObj || !ioMouseEvent.controlDown()) {
                    this.mSelMgr.unSelectAllObjects();
                }
                if (!newlySelObj)
                    return;
                ioMouseEvent.setHandled(true);
                this.mSelMgr.append(newlySelObj);
                if (this.mDragPt)
                    console.warn("Still have last drag point");
                this.mDragPt = this.mFirstPt;
                this.mLastDragPt = this.mFirstPt;
                this.mLastMousePt = ioMouseEvent.getPosition();
                this.mCompDataLocal = {};
                var selObjIDs = this.mSelMgr.getSelectableHCIDs();
                selObjIDs.forEach(function (iSelObjID) {
                    var model = _this.mViewer.getModel();
                    var modelHC = model.getHCModel();
                    var modelXform = modelHC.getNodeMatrix(iSelObjID);
                    if (!_this.mCompDataLocal[iSelObjID]) {
                        _this.mCompDataLocal[iSelObjID] =
                            { Xform: null, Bbox: null };
                    }
                    _this.mCompDataLocal[iSelObjID].Xform = modelXform;
                    var selType = model.getNodeType(iSelObjID);
                    (function () { return __awaiter(_this, void 0, void 0, function () {
                        var bbox, worldXform, invWorldXform, localBBox;
                        return __generator(this, function (_a) {
                            switch (_a.label) {
                                case 0: return [4, modelHC.getNodesBounding([iSelObjID])];
                                case 1:
                                    bbox = _a.sent();
                                    worldXform = modelHC.getNodeNetMatrix(iSelObjID);
                                    invWorldXform = eDwTypes_11.HC.Matrix.inverse(worldXform);
                                    localBBox = bbox.copy();
                                    transformBox(invWorldXform, localBBox);
                                    this.mCompDataLocal[iSelObjID].Bbox = localBBox;
                                    return [2];
                            }
                        });
                    }); })();
                    eventMgr.fireEvents("ModelXformChangeStart", iSelObjID, modelXform.copy());
                });
                this.mMoveComponentCmd = new eDwMoveComponentCmd(this.mViewer, this.mCompDataLocal);
                eDwCommandMgr.get().add(this.mMoveComponentCmd);
            }
        };
        eDwMoveOperator.prototype.onMouseMove = function (ioMouseEvent) {
            _super.prototype.onMouseMove.call(this, ioMouseEvent);
            if (!ioMouseEvent)
                return;
            ioMouseEvent.setHandled(false);
            if (this.mSelMgr.getLastSelHCID() instanceof RangeError)
                return;
            if (!this.mCurMouse)
                return;
            var button = this.mCurMouse.origMouse.getButton();
            var mousePt = ioMouseEvent.getPosition();
            if (button === eDwTypes_11.HC.Button.Left) {
                var dragVec = eDwTypes_11.HC.Point3.subtract(this.mDragPt, this.mLastDragPt);
                ioMouseEvent.setHandled(this.dragFree(dragVec));
            }
            else if (button === eDwTypes_11.HC.Button.Right) {
                var deltaPt = this.mLastMousePt.subtract(mousePt).scale(-1);
                ioMouseEvent.setHandled(this.dragOrbit(deltaPt));
            }
            this.mLastDragPt = this.mDragPt;
            this.mLastMousePt = mousePt;
        };
        eDwMoveOperator.prototype.onMouseUp = function (ioMouseEvent) {
            _super.prototype.onMouseUp.call(this, ioMouseEvent);
            if (!ioMouseEvent)
                return;
            this.mMoveComponentCmd.setFinalComponentXforms(this.mCompDataLocal);
            eDwCommandMgr.get().remove(this.mMoveComponentCmd, "commit");
            ioMouseEvent.setHandled(false);
            this.mCompDataLocal = null;
            this.mDragPt = null;
            this.mLastDragPt = null;
        };
        eDwMoveOperator.prototype.onTouchStart = function (ioTouchEvent) {
            var _this = this;
            if (!ioTouchEvent)
                return;
            this.addTouch(ioTouchEvent);
            ioTouchEvent.setHandled(false);
            if (this.mSelectingTouch) {
                ioTouchEvent.setHandled(true);
                return;
            }
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_11.HC.MouseInputType.Down, function (ioMouseEvent) {
                _this.onMouseDown(ioMouseEvent);
            });
            this.mCurMouse = null;
            var selID = this.mSelMgr.getLastSelHCID();
            if (!(selID instanceof RangeError)) {
                this.mSelectingTouch = { touch: ioTouchEvent, selID: selID };
            }
        };
        eDwMoveOperator.prototype.onTouchMove = function (ioTouchEvent) {
            if (!ioTouchEvent || !this.hasTouchMoved(ioTouchEvent))
                return;
            if (this.mCurTouches.length > 2 || !this.mSelectingTouch) {
                ioTouchEvent.setHandled(false);
                return;
            }
            var masterOrigTouch = this.mSelectingTouch.touch;
            var curTouchComplex = this.getTouchById(ioTouchEvent.getId());
            if (ioTouchEvent.getId() === masterOrigTouch.getId()) {
                var curDragPt = eDwBaseOperator.screenToWorld(ioTouchEvent.getPosition(), this.mViewer.getHCView());
                var dragVec = eDwTypes_11.HC.Point3.subtract(curDragPt, curTouchComplex.lastDragPt);
                this.dragFree(dragVec);
            }
            else {
                var deltaPt = eDwTypes_11.HC.Point2.subtract(ioTouchEvent.getPosition(), curTouchComplex.lastPos);
                this.dragOrbit(deltaPt);
            }
            this.updateTouch(ioTouchEvent);
            ioTouchEvent.setHandled(true);
        };
        eDwMoveOperator.prototype.onTouchEnd = function (ioTouchEvent) {
            if (!ioTouchEvent)
                return;
            this.removeTouchById(ioTouchEvent.getId());
            var curTouchID = ioTouchEvent.getId();
            if (this.mSelectingTouch &&
                curTouchID === this.mSelectingTouch.touch.getId()) {
                this.mSelectingTouch = null;
            }
            ioTouchEvent.setHandled(false);
        };
        eDwMoveOperator.prototype.needsSelection = function (iEventType) {
            return iEventType === eDwTypes_11.HC.EventType.MouseDown ||
                iEventType === eDwTypes_11.HC.EventType.TouchStart;
        };
        eDwMoveOperator.prototype.dragFree = function (vec) {
            if (!this.mCurMouse && 0 === this.mCurTouches.length)
                return false;
            var modelHC = this.mViewer.getModel().getHCModel();
            var transMat = new eDwTypes_11.HC.Matrix();
            transMat.setTranslationComponent(vec.x, vec.y, vec.z);
            utils.forAll(function (iModelNodeID, ioNodeData) {
                ioNodeData.Xform = eDwTypes_11.HC.Matrix.multiply(ioNodeData.Xform, transMat);
                modelHC.setNodeMatrix(iModelNodeID, ioNodeData.Xform);
            }, this.mCompDataLocal);
            return true;
        };
        eDwMoveOperator.prototype.dragOrbit = function (deltaScrPt) {
            if (!this.mCurMouse && 0 === this.mCurTouches.length)
                return false;
            var view = this.mViewer.getHCView();
            var model = this.mViewer.getModel();
            var modelHC = model.getHCModel();
            var camera = view.getCamera();
            var projVec = eDwTypes_11.HC.Point3.subtract(camera.getTarget(), camera.getPosition()).normalize();
            var upVec = camera.getUp().copy().normalize();
            var dirVec = eDwTypes_11.HC.Point3.cross(upVec, projVec).normalize();
            utils.forAll(function (iModelNodeID, ioNodeData) {
                if (!ioNodeData.Bbox)
                    return;
                var xformedCenter = new eDwTypes_11.HC.Point3(0, 0, 0);
                ioNodeData.Xform.transform(ioNodeData.Bbox.center(), xformedCenter);
                var transMat = new eDwTypes_11.HC.Matrix();
                var revTransMat = new eDwTypes_11.HC.Matrix();
                revTransMat.setTranslationComponent(-xformedCenter.x, -xformedCenter.y, -xformedCenter.z);
                transMat.setTranslationComponent(xformedCenter.x, xformedCenter.y, xformedCenter.z);
                var upAxisRotMat = eDwTypes_11.HC.Matrix.createFromOffAxisRotation(upVec, deltaScrPt.x);
                var dirAxisRotMat = eDwTypes_11.HC.Matrix.createFromOffAxisRotation(dirVec, -deltaScrPt.y);
                var rotMatrix = eDwTypes_11.HC.Matrix.multiply(revTransMat, upAxisRotMat);
                rotMatrix = eDwTypes_11.HC.Matrix.multiply(rotMatrix, dirAxisRotMat);
                rotMatrix = eDwTypes_11.HC.Matrix.multiply(rotMatrix, transMat);
                ioNodeData.Xform = eDwTypes_11.HC.Matrix.multiply(ioNodeData.Xform, rotMatrix);
                modelHC.setNodeMatrix(iModelNodeID, ioNodeData.Xform);
            }, this.mCompDataLocal);
            return true;
        };
        eDwMoveOperator.prototype.getComponentAndXform = function () {
            var nodeXforms = [];
            utils.forAll(function (iModelNodeID, iNodeData) {
                nodeXforms.push({ NodeID: iModelNodeID, Xform: iNodeData.Xform });
            }, this.mCompDataLocal);
            return nodeXforms;
        };
        return eDwMoveOperator;
    }(eDwBaseSelOperator));
    ;
    function transformBox(iXform, ioBox) {
        iXform.transform(ioBox.min, ioBox.min);
        iXform.transform(ioBox.max, ioBox.max);
    }
    return eDwMoveOperator;
});
define("eDwMoveSectionPlaneCmd", ["require", "exports", "eDwTypes", "eDwSupportsHistoryCmd", "eDrawingsBase"], function (require, exports, eDwTypes_12, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwMoveSectionPlaneCmd = (function (_super) {
        __extends(eDwMoveSectionPlaneCmd, _super);
        function eDwMoveSectionPlaneCmd(iViewer) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitialPntOnPlane = _this.mViewer.XSectionMgr.projectPoint(new eDwTypes_12.HC.Point3(0, 0, 0));
            return _this;
        }
        eDwMoveSectionPlaneCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            var altDir = this.mDir.copy().negate();
            this.mViewer.XSectionMgr.moveCurrentAlongNormal(altDir);
            return true;
        };
        eDwMoveSectionPlaneCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.mViewer.XSectionMgr.moveCurrentAlongNormal(this.mDir);
            return true;
        };
        eDwMoveSectionPlaneCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            this.mFinalPntOnPlane = this.mViewer.XSectionMgr.projectPoint(new eDwTypes_12.HC.Point3(0, 0, 0));
            this.mDir = this.mFinalPntOnPlane.subtract(this.mInitialPntOnPlane);
        };
        eDwMoveSectionPlaneCmd.prototype.isCommitted = function () {
            return _super.prototype.isCommitted.call(this) && !!this.mInitialPntOnPlane &&
                !!this.mFinalPntOnPlane;
        };
        Object.defineProperty(eDwMoveSectionPlaneCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        return eDwMoveSectionPlaneCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwMoveSectionPlaneCmd;
});
define("eDwNodeAttributes", ["require", "exports"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var eDwNodeAttributes = (function () {
        function eDwNodeAttributes() {
        }
        eDwNodeAttributes.setAttribs = function (ioTargetAttribs, iSourceAttribs) {
            var changedAttributes = [];
            for (var attribKey in iSourceAttribs) {
                if (ioTargetAttribs[attribKey] !== iSourceAttribs[attribKey]) {
                    ioTargetAttribs[attribKey] = iSourceAttribs[attribKey];
                    changedAttributes.push(attribKey);
                }
            }
            return changedAttributes;
        };
        eDwNodeAttributes.mergeAttribs = function (ioTargetAttribs, iSourceAttribs) {
            if (ioTargetAttribs && iSourceAttribs) {
                syncAttributeKeys(ioTargetAttribs, iSourceAttribs);
                for (var attribKey in ioTargetAttribs) {
                    ioTargetAttribs[attribKey] = ioTargetAttribs[attribKey] ||
                        iSourceAttribs[attribKey];
                }
            }
            return ioTargetAttribs;
        };
        return eDwNodeAttributes;
    }());
    exports.eDwNodeAttributes = eDwNodeAttributes;
    ;
    var NodeDisplayState;
    (function (NodeDisplayState) {
        NodeDisplayState["Visible"] = "Visible";
        NodeDisplayState["Invisible"] = "Invisible";
        NodeDisplayState["Opaque"] = "Opaque";
        NodeDisplayState["Transparent"] = "Transparent";
    })(NodeDisplayState = exports.NodeDisplayState || (exports.NodeDisplayState = {}));
    ;
    function syncAttributeKeys(ioTargetAttribs, iSourceAttribs) {
        for (var attribKey in iSourceAttribs) {
            if (!ioTargetAttribs[attribKey]) {
                ioTargetAttribs[attribKey] = undefined;
            }
        }
    }
});
define("eDwNodeColorInfo", ["require", "exports", "eDwTypes"], function (require, exports, eDwTypes_13) {
    "use strict";
    var eDwNodeColorInfo = (function () {
        function eDwNodeColorInfo(pNodeId, pSecondaryId, pColor, pType) {
            this.mNodeId = pNodeId;
            this.mSecondId = pSecondaryId;
            this.mColor = pColor;
            this.mType = pType;
        }
        eDwNodeColorInfo.prototype.reset = function (pModel) {
            switch (this.mType) {
                case eDwTypes_13.MeasureMode.VERTEX:
                    break;
                case eDwTypes_13.MeasureMode.EDGE:
                    pModel.unsetNodeLineColor(this.mNodeId, this.mSecondId);
                    break;
                case eDwTypes_13.MeasureMode.FACE:
                    pModel.unsetNodeFaceColor(this.mNodeId, this.mSecondId);
                    break;
            }
        };
        return eDwNodeColorInfo;
    }());
    ;
    return eDwNodeColorInfo;
});
define("eDwOperationMixin", ["require", "exports"], function (require, exports) {
    "use strict";
    var eDwOperationMixin = (function () {
        function eDwOperationMixin() {
            this.mExclusive = true;
        }
        Object.defineProperty(eDwOperationMixin.prototype, "Exclusive", {
            get: function () {
                return this.mExclusive;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(eDwOperationMixin.prototype, "AllowsAggregation", {
            get: function () {
                return false;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(eDwOperationMixin.prototype, "Aggregable", {
            get: function () {
                return false;
            },
            enumerable: true,
            configurable: true
        });
        return eDwOperationMixin;
    }());
    ;
    return eDwOperationMixin;
});
define("eDwOperatorMgr", ["require", "exports", "eDwTypes", "utils", "eDrawingsBase"], function (require, exports, eDwTypes_14, utils) {
    "use strict";
    var eDwOperatorMgr = (function () {
        function eDwOperatorMgr(iViewer) {
            this.mOpsData = {};
            this.mOperatorMgrHC = iViewer.HCViewer.getOperatorManager();
            this.resetToDefault();
            var cameraZoomOp = (this.mOperatorMgrHC.getOperator(eDwTypes_14.HC.OperatorId.Zoom));
            cameraZoomOp.setMouseWheelZoomInverted(false);
        }
        eDwOperatorMgr.prototype.registerCustomOperator = function (ioOp, iActivate) {
            if (iActivate === void 0) { iActivate = false; }
            ioOp.OperatorID = this.mOperatorMgrHC.registerCustomOperator(ioOp);
            this.mOpsData[ioOp.OperatorID] = { Op: ioOp,
                ActivatedByDefault: iActivate };
            if (iActivate)
                this.push(ioOp.OperatorID);
            return ioOp.OperatorID;
        };
        eDwOperatorMgr.prototype.unregisterCustomOperator = function (iOp) {
            this.unregisterCustomOperatorByID(this.getOperatorID(iOp));
        };
        eDwOperatorMgr.prototype.unregisterCustomOperatorByID = function (iOpID) {
            if (this.popToOp(iOpID) === iOpID) {
                this.pop();
            }
            this.mOperatorMgrHC.unregisterCustomOperator(iOpID);
            delete this.mOpsData[iOpID];
        };
        eDwOperatorMgr.prototype.unregisterAll = function () {
            var _this = this;
            utils.forAll(function (iOpID, iOpData) {
                _this.unregisterCustomOperatorByID(iOpID);
            }, this.mOpsData);
        };
        eDwOperatorMgr.prototype.push = function (iOpID) {
            if (this.getActiveOperatorID() !== iOpID) {
                return this.mOperatorMgrHC.push(iOpID);
            }
            return false;
        };
        eDwOperatorMgr.prototype.pop = function (iOpID) {
            var retOpID = eDwTypes_14.HC.OperatorId.None;
            if (!iOpID || (iOpID && this.getActiveOperatorID() === iOpID)) {
                retOpID = this.mOperatorMgrHC.pop();
            }
            return retOpID;
        };
        eDwOperatorMgr.prototype.popToOp = function (iOpID) {
            var retOpID = eDwTypes_14.HC.OperatorId.None;
            var opStackPos = this.mOperatorMgrHC.indexOf(iOpID);
            if (opStackPos > -1) {
                while (this.getActiveOperatorID() !== iOpID) {
                    this.pop();
                }
                retOpID = iOpID;
            }
            return retOpID;
        };
        eDwOperatorMgr.prototype.getOperator = function (iOpID) {
            return this.mOperatorMgrHC.getOperator(iOpID);
        };
        eDwOperatorMgr.prototype.getOperatorID = function (iOp) {
            return iOp.OperatorID;
        };
        eDwOperatorMgr.prototype.getActiveOperatorID = function () {
            return this.mOperatorMgrHC.peek();
        };
        eDwOperatorMgr.prototype.getOperatorIndex = function (iOp) {
            var opsStack = [];
            var numOps = this.mOperatorMgrHC.size();
            var index = -1;
            for (var i = 0; i < numOps; i++) {
                if (this.getOperator(this.getActiveOperatorID()) === iOp) {
                    index = i;
                    break;
                }
                opsStack.push(this.mOperatorMgrHC.pop());
            }
            var lastOpPos = opsStack.length - 1;
            for (var i = lastOpPos; i >= 0; i++) {
                this.mOperatorMgrHC.push(opsStack[i]);
            }
            return index;
        };
        eDwOperatorMgr.prototype.setOpID = function (iOpID, iIndex) {
            return this.mOperatorMgrHC.set(iOpID, iIndex);
        };
        eDwOperatorMgr.prototype.set = function (iOp, iIndex) {
            return this.setOpID(this.getOperatorID(iOp), iIndex);
        };
        eDwOperatorMgr.prototype.resetToDefault = function () {
            var _this = this;
            for (var opID = eDwTypes_14.HC.OperatorId.NavCube; opID > eDwTypes_14.HC.OperatorId.Navigate; opID--) {
                this.pop(opID);
            }
            utils.forAll(function (iOpID, iOpData) {
                if (iOpData.ActivatedByDefault) {
                    _this.push(iOpData.Op.OperatorID);
                }
            }, this.mOpsData);
        };
        return eDwOperatorMgr;
    }());
    ;
    return eDwOperatorMgr;
});
define("eDwPerspectiveCmd", ["require", "exports", "eDwSupportsHistoryCmd"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwPerspectiveCmd = (function (_super) {
        __extends(eDwPerspectiveCmd, _super);
        function eDwPerspectiveCmd(iViewer, iNewState) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitiallyActive = iViewer.getPerspectiveMode();
            _this.mFinallyActive = iNewState;
            return _this;
        }
        eDwPerspectiveCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.mViewer.setPerspectiveMode(this.mInitiallyActive);
            return true;
        };
        eDwPerspectiveCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.mViewer.setPerspectiveMode(this.mFinallyActive);
            return true;
        };
        eDwPerspectiveCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            this.mViewer.setPerspectiveMode(this.mFinallyActive);
        };
        Object.defineProperty(eDwPerspectiveCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        return eDwPerspectiveCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwPerspectiveCmd;
});
define("eDwRedlineOperator", ["require", "exports", "eDwTypes", "eDwBaseOperator", "eDrawingsBase"], function (require, exports, eDwTypes_15, eDwBaseOperator) {
    "use strict";
    var eDwRedlineUtils = (function () {
        function eDwRedlineUtils() {
        }
        eDwRedlineUtils.screenToCameraPlane = function (iScrPt, iView, iCamera) {
            var pt = iCamera.getCameraPlaneIntersectionPoint(iScrPt, iView);
            return pt;
        };
        eDwRedlineUtils.cameraDiff = function (iCamOld, iCamNew) {
            var mOld = iCamOld.getMatrixFromCamera();
            var mNew = iCamNew.getMatrixFromCamera();
            var base = 0;
            for (var i = 0; i < 16; ++i) {
                base += mOld.m[i] * mOld.m[i];
            }
            var diff = 0;
            for (var i = 0; i < 16; ++i) {
                diff += (mOld.m[i] - mNew.m[i]) * (mOld.m[i] - mNew.m[i]);
            }
            diff /= base;
            var maxDiff = 0.1;
            diff = Math.min(maxDiff, diff);
            var result = 1 - diff / maxDiff;
            return result;
        };
        eDwRedlineUtils.normalizePoint2 = function (iPos) {
            var len = iPos.length();
            if (0 === len)
                return;
            iPos.x /= len;
            iPos.y /= len;
        };
        eDwRedlineUtils.dotPoint2 = function (iPos0, iPos1) {
            return iPos0.x * iPos1.x + iPos0.y * iPos1.y;
        };
        eDwRedlineUtils.fastFactorial = function (iNum) {
            if (0 == iNum)
                return 1;
            if (iNum <= 100)
                return eDwRedlineUtils.factorial[iNum];
            var output = eDwRedlineUtils.factorial[100];
            for (var i = 101; i <= iNum; ++i) {
                output *= i;
            }
            return output;
        };
        eDwRedlineUtils.uniqueIdGenerator = function () {
            var S4 = function () {
                return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
            };
            var str = (S4() + S4() + "-" + S4() + "-" + S4() + "-" + S4() + "-" + S4() + S4() + S4());
            if (-1 !== eDwRedlineUtils.mUniqueIds.indexOf(str)) {
                return eDwRedlineUtils.uniqueIdGenerator();
            }
            else {
                return str;
            }
        };
        eDwRedlineUtils.factorial = [1, 1, 2, 6, 24, 120, 720, 5040, 40320, 362880, 3628800,
            39916800, 479001600, 6227020800, 87178291200, 1307674368000,
            20922789888000, 355687428096000, 6402373705728000,
            121645100408832000, 2432902008176640000, 51090942171709440000,
            1124000727777607680000, 25852016738884976640000,
            620448401733239439360000, 15511210043330985984000000,
            403291461126605635584000000, 10888869450418352160768000000,
            304888344611713860501504000000, 8841761993739701954543616000000,
            265252859812191058636308480000000, 8222838654177922817725562880000000,
            263130836933693530167218012160000000,
            8683317618811886495518194401280000000,
            295232799039604140847618609643520000000,
            10333147966386144929666651337523200000000,
            371993326789901217467999448150835200000000,
            13763753091226345046315979581580902400000000,
            523022617466601111760007224100074291200000000,
            20397882081197443358640281739902897356800000000,
            815915283247897734345611269596115894272000000000,
            33452526613163807108170062053440751665152000000000,
            1405006117752879898543142606244511569936384000000000,
            60415263063373835637355132068513997507264512000000000,
            2658271574788448768043625811014615890319638528000000000,
            119622220865480194561963161495657715064383733760000000000,
            5502622159812088949850305428800254892961651752960000000000,
            258623241511168180642964355153611979969197632389120000000000,
            12413915592536072670862289047373375038521486354677760000000000,
            608281864034267560872252163321295376887552831379210240000000000,
            30414093201713378043612608166064768844377641568960512000000000000,
            1551118753287382280224243016469303211063259720016986112000000000000,
            80658175170943878571660636856403766975289505440883277824000000000000,
            4274883284060025564298013753389399649690343788366813724672000000000000,
            230843697339241380472092742683027581083278564571807941132288000000000000,
            12696403353658275925965100847566516959580321051449436762275840000000000000,
            710998587804863451854045647463724949736497978881168458687447040000000000000,
            40526919504877216755680601905432322134980384796226602145184481280000000000000,
            2350561331282878571829474910515074683828862318181142924420699914240000000000000,
            138683118545689835737939019720389406345902876772687432540821294940160000000000000,
            8320987112741390144276341183223364380754172606361245952449277696409600000000000000,
            507580213877224798800856812176625227226004528988036003099405939480985600000000000000,
            31469973260387937525653122354950764088012280797258232192163168247821107200000000000000,
            1982608315404440064116146708361898137544773690227268628106279599612729753600000000000000,
            126886932185884164103433389335161480802865516174545192198801894375214704230400000000000000,
            8247650592082470666723170306785496252186258551345437492922123134388955774976000000000000000,
            544344939077443064003729240247842752644293064388798874532860126869671081148416000000000000000,
            36471110918188685288249859096605464427167635314049524593701628500267962436943872000000000000000,
            2480035542436830599600990418569171581047399201355367672371710738018221445712183296000000000000000,
            171122452428141311372468338881272839092270544893520369393648040923257279754140647424000000000000000,
            11978571669969891796072783721689098736458938142546425857555362864628009582789845319680000000000000000,
            850478588567862317521167644239926010288584608120796235886430763388588680378079017697280000000000000000,
            61234458376886086861524070385274672740778091784697328983823014963978384987221689274204160000000000000000,
            4470115461512684340891257138125051110076800700282905015819080092370422104067183317016903680000000000000000,
            330788544151938641225953028221253782145683251820934971170611926835411235700971565459250872320000000000000000,
            24809140811395398091946477116594033660926243886570122837795894512655842677572867409443815424000000000000000000,
            1885494701666050254987932260861146558230394535379329335672487982961844043495537923117729972224000000000000000000,
            145183092028285869634070784086308284983740379224208358846781574688061991349156420080065207861248000000000000000000,
            11324281178206297831457521158732046228731749579488251990048962825668835325234200766245086213177344000000000000000000,
            894618213078297528685144171539831652069808216779571907213868063227837990693501860533361810841010176000000000000000000,
            71569457046263802294811533723186532165584657342365752577109445058227039255480148842668944867280814080000000000000000000,
            5797126020747367985879734231578109105412357244731625958745865049716390179693892056256184534249745940480000000000000000000,
            475364333701284174842138206989404946643813294067993328617160934076743994734899148613007131808479167119360000000000000000000,
            39455239697206586511897471180120610571436503407643446275224357528369751562996629334879591940103770870906880000000000000000000,
            3314240134565353266999387579130131288000666286242049487118846032383059131291716864129885722968716753156177920000000000000000000,
            281710411438055027694947944226061159480056634330574206405101912752560026159795933451040286452340924018275123200000000000000000000,
            24227095383672732381765523203441259715284870552429381750838764496720162249742450276789464634901319465571660595200000000000000000000,
            2107757298379527717213600518699389595229783738061356212322972511214654115727593174080683423236414793504734471782400000000000000000000,
            185482642257398439114796845645546284380220968949399346684421580986889562184028199319100141244804501828416633516851200000000000000000000,
            16507955160908461081216919262453619309839666236496541854913520707833171034378509739399912570787600662729080382999756800000000000000000000,
            1485715964481761497309522733620825737885569961284688766942216863704985393094065876545992131370884059645617234469978112000000000000000000000,
            135200152767840296255166568759495142147586866476906677791741734597153670771559994765685283954750449427751168336768008192000000000000000000000,
            12438414054641307255475324325873553077577991715875414356840239582938137710983519518443046123837041347353107486982656753664000000000000000000000,
            1156772507081641574759205162306240436214753229576413535186142281213246807121467315215203289516844845303838996289387078090752000000000000000000000,
            108736615665674308027365285256786601004186803580182872307497374434045199869417927630229109214583415458560865651202385340530688000000000000000000000,
            10329978488239059262599702099394727095397746340117372869212250571234293987594703124871765375385424468563282236864226607350415360000000000000000000000,
            991677934870949689209571401541893801158183648651267795444376054838492222809091499987689476037000748982075094738965754305639874560000000000000000000000,
            96192759682482119853328425949563698712343813919172976158104477319333745612481875498805879175589072651261284189679678167647067832320000000000000000000000,
            9426890448883247745626185743057242473809693764078951663494238777294707070023223798882976159207729119823605850588608460429412647567360000000000000000000000,
            933262154439441526816992388562667004907159682643816214685929638952175999932299156089414639761565182862536979208272237582511852109168640000000000000000000000,
            93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000];
        eDwRedlineUtils.mUniqueIds = [];
        return eDwRedlineUtils;
    }());
    ;
    var eDwSVGUtil = (function () {
        function eDwSVGUtil() {
        }
        eDwSVGUtil.drawSVGElment = function (iTag, iAttrs) {
            var elr = document.createElementNS('http://www.w3.org/2000/svg', iTag);
            for (var k in iAttrs) {
                if ("href" === k) {
                    elr.setAttributeNS('http://www.w3.org/1999/xlink', k, iAttrs[k]);
                }
                else {
                    elr.setAttributeNS(null, k, iAttrs[k]);
                }
            }
            $("#" + eDwSVGUtil.redlineSVGId).append(elr);
        };
        eDwSVGUtil.removeSVGElment = function (iTag, iAttrs) {
            var elr = document.createElementNS('http://www.w3.org/1999/xlink', iTag);
            for (var k in iAttrs) {
                elr.setAttribute(k, iAttrs[k]);
            }
            var redlineSVGElmt = document.getElementById(eDwSVGUtil.redlineSVGId);
            var children = redlineSVGElmt.children;
            redlineSVGElmt.appendChild(elr);
        };
        eDwSVGUtil.redlineSVGId = "edrawings-canvas-redline-svg";
        eDwSVGUtil.canvasSVGId = "edrawings-canvas-svg";
        eDwSVGUtil.testData = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4RakRXhpZgAASUkqAAgAAAAEADEBAgAHAAAAPgAAADIBAgAUAAAARQAAADsBAgAHAAAAWQAAAGmHBAABAAAAYA" +
            "AAAA4BAABQaWNhc2EAMjAxMzowOToyMSAxNDo1OTo0NQBQaWNhc2EABgAAkAcABAAAADAyMjADkAIAFAAAAK4AAAACoAQAAQAAAJQCAAADoAQAAQAAAHwCAAAFoAQAAQAAAOQAAAAgpAIAIQAAAMIAAAAAA" +
            "AAAMjAxMzowOToyMCAxOTozMDoxNQBmYTRmZWZmZTVhMGJmODk0OWM3YmYwNTRiNmQ1OTBiYgAAAwACAAcABAAAADAxMDABEAQAAQAAAAAFAAACEAQAAQAAAAAEAAAAAAAABgADAQMAAQAAAAYAAAAaAQUA" +
            "AQAAAFwBAAAbAQUAAQAAAGQBAAAoAQMAAQAAAAIAAAABAgQAAQAAAGwBAAACAgQAAQAAAC8VAAAAAAAASAAAAAEAAABIAAAAAQAAAP/Y/+AAEEpGSUYAAQEAAAEAAQAA/9sAQwAFAwQEBAMFBAQEBQUFBgc" +
            "MCAcHBwcPCwsJDBEPEhIRDxERExYcFxMUGhURERghGBodHR8fHxMXIiQiHiQcHh8e/9sAQwEFBQUHBgcOCAgOHhQRFB4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh" +
            "4e/8AAEQgAoACgAwEiAAIRAQMRAf/EABwAAAEFAQEBAAAAAAAAAAAAAAQCAwUGBwEIAP/EAEYQAAIBAwIEAwUEBgcFCQAAAAECAwAEEQUhBhIxQRNRYQcUInGRIzKB0RVCk6GxwQgkM1JicvAWNJKU0iU1Q" +
            "1VWY3OD4f/EABoBAAIDAQEAAAAAAAAAAAAAAAMEAQIFAAb/xAAkEQACAgICAQQDAQAAAAAAAAAAAQIRAyEEEjEFIjJBExQjUf/aAAwDAQACEQMRAD8AAj0uy5GZ7K2/ZL+VMrplockWVvj/AOJfyqZnjK22" +
            "BTUAxBST2aKZFrYWaH/c7Y/OFfyp4WFkQD7la/sV/KigQzYIogIgGwFQjiLk0+zI2srb9iv5V8un2eAfcbb9iv5VJzFVUHloO8vIre2knlPLHGpdj5AdanZ1EVxDdaRo1ibq4srY7HkRYVy58ulYPxRqE+p" +
            "ai8ssUInkOMIgVY17Af63q/cX3s+qQNfyho0KAon90Hovz7msr12ccyRqx8V/jkYHz2AosU0DlQLcrDlgjIyxjDOOhbyH8zQhlycRoNurEfwou9MMIjXk5sIAqfzPzoFZTysFHxN1otgKJMXNs+nG3SOFXP" +
            "UlfiY/Oo68s3tkQySRczfqK2SPnRFpbTeEZUjiflGSGbf6U7b6bJeRPNHycwGeUDFV7KJf8Tn4BYEiSNV8MzTtuF7KPWibeSVDye7QSFepxy8v4g0TFZG3cxAY5lJeTyABJxSdFtFklE102LdVMrKO4HQfj" +
            "irXZRxa0WPSuOdT0zS1W90m0u42J93klUcwA9cbj51NcN8fR3citqmkaWtuW5GkgQBoiehZT1HqKz2/vbvUIpZ5AqRO4VFA+ij0FAPBLbkl2KMOgHnUOCZKyNHostpssayRW1swYZBES4I+lG21pZNGD7pb" +
            "H/6l/Ksu9lnEz3LpoV+QxVf6tIeuB+qf5Vq1suIhtSk04uhqDUlaFe5WXaztv2K/lXJLayijLmzttv8A2l/KiBTV4paEig5G+ofEl3RZpWJQ5r5EJhHrX0igR7+dPwkCICmRbwweGFVclmzTVzIVlAXcZpV" +
            "0ZEbmHSmjmT4u9Qyw+cSLjbNRGqWEmqXcGgxLn3geJM5Pwxxqckt6bfuo4F0cE0/quoWug8P6heXfhxXGoW5sLZ2X4lXlMksg8wFKjHmavjVsrOXVaMk9pstomkWVnZ3AEs/M0jA7gdTgefLgelZFqEqXM4" +
            "eJQkagAfhVi4tv1USSOCt1OSFAOfBi7IPU9zVWd05QApXHaigkOQGSa5CxL4shzzE+WP4CutZoD/bhcDJ+X/75UTpE4sbC8naPLzoIYmI75Bb8MCvtFsJ9U1AKMtzNuTUSl1Vkwh3lQbw5pE95cAQRrnPVh" +
            "zGtI0jgW5No3hxgM43wMb1b/Ztwhb2tukjqGbqTitR0uyhjwoRQB6VjZ+VKTpHoePw4xhs88atwLfQ2ZUwOD8QJx2IqpDQ57aGZJ8qCmNh/hwP9ete0RptrcR4kiUj5VWOI+BNJvkKxwiNx9042rocyUNMH" +
            "k4cJPR5HlgiK21sEKC3Cnp1z1NCapKZSAqCPmYgFh0HrXp5PZPpEQZ5TzORjOKyn2zcGjh17G5tkEsVxKY2GOhx+VNYuapySFM3p7hByMo4elmteI7OSFgZEuEwR0O+K9Lwgcg7V524Zt0HF9rGQPDW5TGO" +
            "3xbV6Lj3Gcb01mdtGfhVKhwCkTgch3pdN3TYiJpbL8GN4fmiyXB+yFKiJ5BvXLxgqYFdTaJT6UcWYiVwwKYoZFPPgnGKLCfFmkSQsx2FSWTGJ2iiBllYCNAWbJ2AHWs54l1qfXbcJOJbu/DpHBGNo1UuXZQ" +
            "egyqqWP91QKvfEFzZaVot1fapH4lpGn2i5Izk9NuvyrMbXR9f1HTru7hsykzicQl35I7YSYA27vy7egNXi4xXaTKShLJJRijHtWvHu9SmnZQuXOFByFHpQwf4sk5qU4l4d1Th+4WHUYAnOMoynKkfOoejxc" +
            "ZK0LSU8cqkqYZLJLciMNjlReVQOgq/eze0UTxkgdaqHCWkXGsapFaxA8rMOY+QrfeFeCtPsGQB2cqoLfOs/mZlBdTW4HHc/caJw1GiafFyjtvVitVBXbY9qgbSWOKJY0wAowBUrY3UTsEEq83zrFvdnoGqV" +
            "Fhss+HhqXcYAzTFmjFchtvnTsynaokwKWwK4b4ulZd/SASJ+EoZGHxR3Ssp8vhNavNESpOaxv+kPcmHQ7G0IyLm75TgZ2Cn86vgXvR2avxtGL8Maex1pLp4RyzMCuPMMMn9xraYvu5qq6XpENstmEUqIzlQ" +
            "eqrtgH6fvq1R/cBrauzzzVCz6UJqQY2x5eoowCgtXlaG1LouTQs3xCYVc0TqvM2TICMedLhmlK79KInTNuxIphpAsKpy70wLpIdEzedLWZsdaEUkt0p4fCtVsmkR3F72c2g3KaiW93QCVgvVih5gv4kAfjT" +
            "nBWqR6xwNaXbeF7340kMixpgK/Of5EUNxPbQX2j3FrcECN0Jb5Dc1X/ZQsWleLpxu/HU3Ed2o7Kj5jz9Qv1oXJTli0aHpuSMc6T+yR9rWg22oaL7pLCrOFyrjHMrjyrzHLCY7wwMMFX5Tn516w4ggjeN7m4" +
            "OZw/Kik5IPy7VhHtb4Vl0XWkvYowLa4I3Xpz9TVOBmp9GF9X43dKaLb7CNHVppLspkAYBxWyNaGGNlhiHM1Uz2TpFa8P2zIM8ygsfWtP04RzKD1pDkScpux3j4+mNUUfUtLumUy6jqgtoB2Q4qGuY9PtpSd" +
            "J4ifxx0jk+L+BzWgcU8NJqFseXnO+SM7GoLhbhqLReIRrAieYAhhbjCKWGSMnG4BJOKmEklsjLBvcSO4V4y4mgmEMkcd5CjYd4znA88GtG4d1681Cd/ebVo4wNnPSq5BpES6nc6kbeO3M5LGKIfCD6eVWrh" +
            "zEkMsJTGUIGfPFUm1JhYw6qyH4k47sNIVxOQcHAC7k1lnF3EEvF+t6Wp0+W2s7Sc3AkkUjxABjbPbOKO03h2Sz1i5m4odLtGWUqyyOckghEAHQg4OaGsbCeOBUuZWnZF5FZuoUdqZwY43aEeVllFUfXV5H7" +
            "yoGxNSsDc0Y+VAGwjdlblAIqQhQKgAp1GU2PdqauVWSFlIyKe7U1cNyxn1qmb4MJx3/RFlm/3Y0JyDYkZoiVvsCKQv3BtTAsJ5AR8IrgB5sEU9GNs0nIEnXeoa0Siqe0CdLa2tVLuvPMA/L3XuKzjhXjLT9" +
            "M4/jhuDCdLmM1nK4zlInI5fkFYA/WtI47Uw+6XskIuoknUMnLnkHdj+OKwLi/SltdZZrWUyxSE4YDYb9P8AXnRVFOFMiMprInH6PTWs6cl9pjR3Ny8U3L9ncRb8w7Z86zL2t840jTrS5JkIJBcjqwXY1L+z" +
            "zV+IoeF0sXvFkWHAhMsYcqmNhnyoPVZTqK+FqbePIZCzHlwM+g7ViL2ZD0uZ98Y77Jr2SXRBA3WBuXY9RWucPXADqrZ371knC1nbaVOzWjMiv1XO1abw1eRyx9fiquRW7RGHJUerNAtTE4AYAg0S9tasBiN" +
            "fpUJp0zbA9qnVk+wJAycbULyc9PRCa69vaDl5VBOwFN6DMBMGxtVfvbuOXXLl9RmMUUP97sPOpbh3VNHubkJaXkc2PI4P0NckMtVA+v8AS4nkkmIGQ+SKzy+AW5lx05zj61pvE9xHbWlxKj7cv76yyaTmJy" +
            "TnNN8W9mVz2nSORdzTiU0uy7U5BT0TLY92oXUm5LfmooUBrpxZNioyK40TF1stEh+wPyrsQ/q6mlXkfLbnBr63GbdBRqAnUyqE70LE3iTb7Uei7EHpTXu6iTmG1SWRG8Xwxy8Kal4kLyRRwszcoJIyCAdqq" +
            "XEPs8tNK4Q4VvZ7gme8slmkjbsXJYEfgRWyaIsVpw/qF9cqOST4BkdgNz9TXmj2h8Z3v+1LW0F3NPYp9yGRyVT/AC56D0o08Eni15KYeRGOZdvBetHgjtl8FQFwMY9Kg9aiMNw7bgqx28xXOC9bi1IYDHnG" +
            "29TWvWLzRm4QZOMNXn2nGTTPSyfaFoi9KnOSM/D2JFXTQbhYWX4hjFZrFerBcm3bbOw9Ktmh6gGJV2BA2Bq0vACLpmmafdtkSGQBep3ou94ikVPDhwvLuxPlVNt7+NbdgJOU9iDvTLC5uC2b5LdRuCY+bPz" +
            "qqQRtydIO1vVZ7i4Jt4wZSwBZV3qpajd6lBqlzeBph7nKgblTGxIyCfUZq0pY3kls7QazGJT3VVwaG1WXVbaAiS9gmTk+LnXHNj+NFSQf9eXXs5Bl3rjajpiW2wIbL/LtUPLEM5zTelxOLPxSADKeb8O1OS" +
            "JIT503jh1RiZ5ucrGiCpxRMHTNDzZAGRvRMAxGDRaF2OMNxih76MSRYI2oobimLtWMJVB8R2FUyfEth+ZaAnjxsrUPzNEOQdBUubUpAzKK+isQ8YcrmmaFlJEOJnPpXwkcuAOpqZltLeCFppsIijLE9AKrk" +
            "fG/AcSTXF1qygRghUMbqJGHbONx8qmMG2dKaSLdx/Nb6ZwW1hkc8cfKw8z1Jrxfq8kt5rdzK5yfEIHoK2TjL2mwa/pF1p8csbXyKWtXiOzxjqnzA3HnWLWXMzkt1Jz860ZaSSEEtuya4evZdL1CK7QnlB+N" +
            "fMVuOnXMF/p8c0bBkkXPzrCYhsKuXs815dPv00y8k5bedsQux2Rz2+RrI53Fv+kTc9N5iX8pklxhpDQzG6hGMeVVux1uaym5ZiwXOxPStV1O1EsTrIM5G21UTVuHizMY1+EncEVlxkvs1p4/8DNK1o3JAMo" +
            "C9Aatdgst1bvyylhjGM71lQ0LVbWbxLB+/wBxuhqw6Prmqadg3lhcRhD8TohYfUUZRTXtYpK4PZabrhO6um8Q6i8MLdAjd/Wg73TLizgggFw7iRhHliSeu/7qXHxjHI3wJJJncIEOf4VIafHPf3S3tzC8MK" +
            "KfCjfYknqxHbbaiRg72VyZF10w83MMcQiTZVAA9AKbjvEUkE5zTj28ZH3abFtGGzimV4ELB7u+hMoTlO/ejoSPDFB3VvGXDBRRMP3QPSpIYSu6VNcFaSdX4lsrQqShkDv/AJRvUNH90VqfsN0smS71Z1yF+" +
            "yjOO/eu62V7ddibqxK2LsFxSbOz/qoZxgDuasl9ABp8mO9UfivUJha+6W7GOEKTI/dj5D0puMRZz0Vv2i69ZWWk3Jz4iBCAo/WPlXlPXV1i9ml1C5VghYhVOwUeQHYVrnHOrgSSR85cIdsnasr4q1OS6kWI" +
            "OeULuKu9FI7K0SwbIJDDuDUnosvPIY3OW6gnvUYDhjTscrRyrImzKcipTolqy3wocdMV2RA6lTQ+n3aTorZ6j6GjgBgHrVnT8g03F2jS/ZxxIdZsv0XqDZv7VdmP/jR9m+Y6H61ZrnThK+VGF8qw6Ge4sby" +
            "G/spDHcwPzIf5H0Nbdwvr9nrejJexEI/3Zoz1jfuPl5Vgc3jPHLtHwz1XA5kc8OsvKA3tESbl8IZ6dKPggSC3blG564pxJobhPHgZZI2zyspyDSgeZDtRONi6q2J8zkd5UvANE65wU5T8qeDADGabUAbU5h" +
            "WOKaE2IB+0rjnBrr4Q7Gh2Zi2TUEHJiOYA07F0FDPu4omHoPlXHMMgQuQqgkk4Ar0XwHpY0nhe0teXlcpzyerHesT9nOlnVOJrSArlEbxHPkBXolByqFA6CrxAzf0UnVZkWzMZ6tuflWXcYT80TxqdgNwOw" +
            "8qtXG2vWOhaTdalql0lvBGpLOx+gHmfSsN/7U9oVtPreq3lxw/wijEqFHLcXajqSeynoAOtaMYiTkUTje/ggmlmiVZ0VihkXLgP5ZGwrO72ZbtzIAVPoK2rj3ULKPg66stHtI9PsLaVbaCJPLAOSe5PU1lE" +
            "am4ALlC48lAzXPGiVkaK/wAuOm9cII7VMyWvKGYLmu3FuptEcRhWNUcaReM7dEfp900D8ufhNWOyuxJGNxVZuYfDHMKI02c/d5jtUJlpRplqVlcbkUq3v73TluDYzMgnjMcg7YPf5iok3UMQBkmVNu53P4U" +
            "Bea1kFLVD/nf8qiUVJbIhNwdo0T2WcRtZXH6FvZMW8xzCzHZX8vx/jWrp9w715bstUmgm8SQ+Jnrnt6it89nnEUWuaHGHlzdxKBICdyOzUtkx1tDOPJ28k9M/ISO9JilPNmlSYJG1cWIP6UEKKmYN0psYp2" +
            "TlCik464qGdQOw+MYoqDfHahZP7Qb0ZZqXdFAyScAeZqUQzZPYVpJS0utVdRmQ+GmfIda092CqSahuDNNXSuG7K0AwyxAv8zuaI14T+6locjucUeK0LSezzJo/i8f3UnHOv2hk0C3n8HRdOk+656G4kU9f8" +
            "INVP2pa/Hqeqyafp9wjWdqrrLzNywRHYAtjqcZwo3qZtNftU4CcTazY6fbiNW+zlUyQrjGI0z989B5VgnEuurK62enJ4VtGxMac3NgnqzH9Zz3P02rSbSQmo2yS1q8XUL5bf3m4nXmLqG+FASAMhB06Dc74" +
            "Fdgs7eFcscGojTTFaIbiaaNp2H94bDyp33o3TfFMiqP8QoN2w1IkAltJJyJzMTtXLmwyoC/q121e1ixi4i/4xRi3Nvgfbxf8YqHshOnZAXVlzKUIqClgkhlKbrVzv3t2XnWeLI6/GN6htbEBijkjdObvhhQ" +
            "/AfspkCYmJOTSCuDRrchwQy/Wm8KepX61ykVcVQIauvArTx6tpkNvO0MruAGU9cnpVOkQgk5B+Rq3+y5oJ+L9PN1NHFHBly0jhR8IJHX1xUz3FlMepo3dm7Yr7xOWhpNS0oN/3lZ/t1/OkHUtK/8AM7P9uv" +
            "50hTNC0ENIpODtXROBtQbahpW5/SVl+3X86Gl1TTRIANQs8ek6/nXNM60GTyjmBFXH2X6Z+luKLKB1zGjeI/yXeqL+kNLfrqNn+3X86172FX/DtqLvUbrXNJhc4jjEl5Gpx36mpUW2Uk1Rt4XHTGKROniRl" +
            "D3GKixxXwsOvE2i/wDPxf8AVXDxVwt/6m0X/n4v+qjirP/ZAP/hAtdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3pr" +
            "YzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuMS4yIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzI" +
            "yLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYm" +
            "UuY29tL2V4aWYvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxMy0wOS0yMVQxNDo1OTo0NSswMzowMCIgZXhpZjpEYXRlVGltZ" +
            "U9yaWdpbmFsPSIyMDEzLTA5LTIwVDE5OjMwOjE1KzAzOjAwIj4gPGRjOmNyZWF0b3I+IDxyZGY6U2VxPiA8cmRmOmxpPlBpY2FzYTwvcmRmOmxpPiA8L3JkZjpTZXE+IDwvZGM6Y3JlYXRvcj4gPC9yZGY6" +
            "RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA" +
            "gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPD94cGFja2V0IGVuZD0idyI/Pv/tAHZQaG90b3Nob3AgMy4wADhCSU0EBAAAAAAAPhwBAAACAAQcAVoAAxslRxwCAA" +
            "ACAAQcAjcACDIwMTMwOTIwHAI8AAsxOTMwMTUrMDAwMBwCUAAGUGljYXNhOEJJTQQlAAAAAAAQhWP4wDnWYTnaLlLhxoXiAf/bAEMABQMEBAQDBQQEBAUFBQYHDAgHBwcHDwsLCQwRDxISEQ8RERMWHBcTF" +
            "BoVEREYIRgaHR0fHx8TFyIkIh4kHB4fHv/bAEMBBQUFBwYHDggIDh4UERQeHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHv/AABEIAnwClAMBEQACEQEDEQH/xAAd" +
            "AAABBQEBAQEAAAAAAAAAAAADAAECBAUGBwgJ/8QARxAAAQQBAwIEBAMDCQQKAwEAAQACAxEEBSExBhITIkFRB2FxkRQygRZVkhUjQlJTVKGxwSQzNNEIFzU2REVWYnLhJUPxgv/EABoBAAMBAQEBAAAAAAA" +
            "AAAAAAAABAgMEBQb/xAAhEQEBAQEBAQEBAQEBAQEBAAAAARECAxIhMRMEQWFRcf/aAAwDAQACEQMRAD8A5H9h+nP7hD/Cuf7d/wAG/Ynpq6/k6En/AOKPsfETHQ/Th/8ALof4Uvsv80X9D9O+mnxfZH2fwE" +
            "eiunBzgRfwp/ZfBv2M6d/uEX8KV7P4P+xfTv8AcIv4VlfQ/wDMv2L6d/d8X2R/qP8AM37GdOfu+L+FH+p/ESb0V04f/Aw/wpz1L4gg6H6c/uEP8Kv/AET8Jjobpv8Ad8X8KL6H8Q/7DdN/u+L+FR9UfEI9C" +
            "9N/u+L7I+qPiI/sN01+7oP4E/tP+cP+wvTX7th/gR9n/nD/ALC9Ofu2H+FV9D4P+wvTf7vi+yc6HwieiOmwa/k+L+FVei+EXdE9Nj/wEX8Kz+l/ER/Yfpw/+Xxfwo0/hL9hum/3fD/Cn9F8F+w/Tf7vi/hR" +
            "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";
        return eDwSVGUtil;
    }());
    ;
    var eDwRedlineDivElement = (function () {
        function eDwRedlineDivElement() {
            this.mDivId = eDwRedlineUtils.uniqueIdGenerator();
            var div = "<div id='" + this.mDivId + "' class='edrawings-custom-redline'></div>";
            $(eDwRedlineDivElement.parentId).append(div);
        }
        eDwRedlineDivElement.prototype.addContent = function (iContent) {
            $("#" + this.mDivId).append(iContent);
        };
        eDwRedlineDivElement.prototype.setSize = function (iSize) {
            $("#" + this.mDivId).height(iSize.y);
            $("#" + this.mDivId).width(iSize.x);
        };
        eDwRedlineDivElement.prototype.setPosition = function (iPos) {
            $("#" + this.mDivId).css({ top: iPos.y, left: iPos.x });
        };
        eDwRedlineDivElement.prototype.getPosition = function () {
            var w = $("#" + this.mDivId).width();
            var h = $("#" + this.mDivId).height();
            return new eDwTypes_15.HC.Point2(w, h);
        };
        eDwRedlineDivElement.prototype.setCss = function (iKey, iVal) {
            $("#" + this.mDivId).css(iKey, iVal);
        };
        eDwRedlineDivElement.prototype.getSize = function () {
            var h = $("#" + this.mDivId).height();
            var w = $("#" + this.mDivId).width();
            return new eDwTypes_15.HC.Point2(w, h);
        };
        eDwRedlineDivElement.prototype.showElement = function (iShow) {
            var target = $("#" + this.mDivId);
            if (iShow) {
                target.show();
            }
            else {
                target.css("display", "none");
            }
        };
        eDwRedlineDivElement.prototype.remove = function () {
            $("#" + this.mDivId).remove();
        };
        eDwRedlineDivElement.parentId = "#edrawings-canvas-redline";
        return eDwRedlineDivElement;
    }());
    ;
    var eDwSVGElementBase = (function () {
        function eDwSVGElementBase(iTag, iAttrs) {
            this.mTag = iTag;
            this.mAttrs = iAttrs;
        }
        eDwSVGElementBase.prototype.draw = function () {
            eDwSVGUtil.drawSVGElment(this.mTag, this.mAttrs);
        };
        return eDwSVGElementBase;
    }());
    ;
    var eDwSVGImage = (function (_super) {
        __extends(eDwSVGImage, _super);
        function eDwSVGImage(iImageLink, iPos, iSize) {
            var _this = _super.call(this, "image", {
                "href": iImageLink,
                "x": iPos.x, "y": iPos.y,
                "height": iSize.y, "width": iSize.x,
                "preserveAspectRatio": "none"
            }) || this;
            _this.mPos = eDwTypes_15.HC.Point2.zero();
            _this.mSize = eDwTypes_15.HC.Point2.zero();
            _this.mPos = iPos.copy();
            _this.mSize = iSize.copy();
            return _this;
        }
        eDwSVGImage.prototype.setPosition = function (iPos) {
            this.mPos = iPos.copy();
            this.mAttrs["x"] = iPos.x;
            this.mAttrs["y"] = iPos.y;
        };
        eDwSVGImage.prototype.setSize = function (iSize) {
            this.mSize = iSize.copy();
            this.mAttrs["height"] = iSize.y;
            this.mAttrs["width"] = iSize.x;
        };
        return eDwSVGImage;
    }(eDwSVGElementBase));
    ;
    var eDwRedlineDivText = (function (_super) {
        __extends(eDwRedlineDivText, _super);
        function eDwRedlineDivText() {
            var _this = _super.call(this) || this;
            _this.mTextId = "";
            _this.mTextId = eDwRedlineUtils.uniqueIdGenerator();
            var inputHtml = "<input id='" + _this.mTextId + "'" +
                " class='edrawings-redline-text-html'" +
                " placeholder= 'Enter text here' >";
            _this.addContent(inputHtml);
            return _this;
        }
        eDwRedlineDivText.prototype.getFocus = function () {
            $("#" + this.mTextId).focus();
        };
        eDwRedlineDivText.prototype.getBlur = function () {
            $("#" + this.mTextId).blur();
        };
        eDwRedlineDivText.prototype.setText = function (iText) {
            $("#" + this.mTextId).val(iText);
        };
        eDwRedlineDivText.prototype.getText = function () {
            return $("#" + this.mTextId).val();
        };
        return eDwRedlineDivText;
    }(eDwRedlineDivElement));
    ;
    var eDwRedlineItemBase = (function (_super) {
        __extends(eDwRedlineItemBase, _super);
        function eDwRedlineItemBase(iViewer) {
            var _this = _super.call(this) || this;
            _this.mWPoints = [];
            _this.mSPoints = [];
            _this.mTransing = false;
            _this.mEditing = false;
            _this.mRegisterId = "";
            _this.mActive = 1;
            _this.mEditHandle = [];
            _this.mEditIdx = -1;
            _this.mSelected = false;
            _this.mStrokeWidthRegular = 3;
            _this.mStrokeWidthHighlight = 5;
            _this.mTransStart = eDwTypes_15.HC.Point3.zero();
            _this.mColor = eDwTypes_15.HC.Color.red();
            _this.mViewerHC = iViewer;
            return _this;
        }
        eDwRedlineItemBase.prototype.draw = function () {
            if (!this.mSelected)
                return;
            var renderer = this.mViewerHC.getMarkupManager().getRenderer();
            for (var i = 0; i < this.mEditHandle.length; ++i) {
                renderer.drawCircle(this.mEditHandle[i]);
            }
        };
        eDwRedlineItemBase.prototype.addPoint = function (iPoint) {
            var view = this.mViewerHC.getView();
            var pos = eDwTypes_15.HC.Point2.fromPoint3(view.projectPoint(iPoint));
            this.mWPoints.push(iPoint.copy());
            this.mSPoints.push(pos.copy());
            var editColor = new eDwTypes_15.HC.Color(159, 191, 61);
            var editSize = 6;
            var circle = new eDwTypes_15.HC.Markup.Shape.Circle();
            circle.setCenter(pos);
            circle.setFillColor(editColor);
            circle.setRadius(editSize);
            this.mEditHandle.push(circle);
            if (this.mEditing) {
                ++this.mEditIdx;
            }
        };
        eDwRedlineItemBase.prototype.editPoint = function (iIdx, iPoint) {
            var view = this.mViewerHC.getView();
            var pos = eDwTypes_15.HC.Point2.fromPoint3(view.projectPoint(iPoint));
            this.mWPoints[iIdx].assign(iPoint.copy());
            this.mSPoints[iIdx].assign(pos.copy());
            this.mEditHandle[iIdx].setCenter(pos);
        };
        eDwRedlineItemBase.prototype.hitEditHandle = function (iPos) {
            if (!this.mSelected)
                return -1;
            var editNum = this.mEditHandle.length;
            for (var i = editNum - 1; i >= 0; --i) {
                var c = this.mEditHandle[i].getCenter();
                var r = this.mEditHandle[i].getRadius();
                var w = this.mEditHandle[i].getStrokeWidth();
                var dist = eDwTypes_15.HC.Point2.subtract(iPos, c).length();
                if (dist < (r + w))
                    return i;
            }
            return -1;
        };
        eDwRedlineItemBase.prototype.onSelect = function () {
            _super.prototype.onSelect.call(this);
            this.mSelected = true;
        };
        eDwRedlineItemBase.prototype.onDeselect = function () {
            _super.prototype.onDeselect.call(this);
            this.mSelected = false;
        };
        eDwRedlineItemBase.prototype.getStrokeWidth = function () {
            return this.mSelected ? this.mStrokeWidthHighlight
                : this.mStrokeWidthRegular;
        };
        eDwRedlineItemBase.prototype.onInitialEditStart = function (iPos) {
            this.mEditing = true;
            this.mEditIdx = this.mWPoints.length - 1;
        };
        eDwRedlineItemBase.prototype.onTransOrEditStart = function (iPos) {
            var editIdx = this.hitEditHandle(iPos);
            if (-1 !== editIdx) {
                this.onEditStart(iPos);
            }
            else {
                this.onTransStart(iPos);
            }
        };
        eDwRedlineItemBase.prototype.onTransStart = function (iPos) {
            var wpos = eDwRedlineUtils.screenToCameraPlane(iPos, this.mViewerHC.getView(), this.mCamera);
            this.mTransStart.assign(wpos.copy());
            this.mTransing = true;
            this.onEditEnd(iPos);
            return true;
        };
        eDwRedlineItemBase.prototype.onTransMove = function (iPos) {
            if (!this.mTransing)
                return false;
            var wpos = eDwRedlineUtils.screenToCameraPlane(iPos, this.mViewerHC.getView(), this.mCamera);
            var delta = eDwTypes_15.HC.Point3.subtract(wpos, this.mTransStart);
            for (var i = 0; i < this.mWPoints.length; ++i) {
                var point = this.mWPoints[i].copy();
                point.add(delta);
                this.editPoint(i, point);
            }
            this.mTransStart.assign(wpos.copy());
            return true;
        };
        eDwRedlineItemBase.prototype.onTransEnd = function (iPos) {
            this.mTransing = false;
            this.mTransStart.assign(eDwTypes_15.HC.Point3.zero());
            return true;
        };
        eDwRedlineItemBase.prototype.onEditStart = function (iPos) {
            this.mEditIdx = this.hitEditHandle(iPos);
            this.mEditing = true;
            this.onTransEnd(iPos);
        };
        eDwRedlineItemBase.prototype.onEditMove = function (iPos) {
            if (!this.mEditing)
                return;
            var wpos = eDwRedlineUtils.screenToCameraPlane(iPos, this.mViewerHC.getView(), this.mCamera);
            this.editPoint(this.mEditIdx, wpos);
        };
        eDwRedlineItemBase.prototype.onEditEnd = function (iPos) {
            this.mEditIdx = -1;
            this.mEditing = false;
        };
        eDwRedlineItemBase.prototype.finialize = function (iPos) {
            return true;
        };
        eDwRedlineItemBase.prototype.isEditing = function () {
            return this.mEditing;
        };
        eDwRedlineItemBase.prototype.isTransing = function () {
            return this.mTransing;
        };
        eDwRedlineItemBase.prototype.setCamera = function (iCamera) {
            this.mCamera = iCamera.copy();
        };
        eDwRedlineItemBase.prototype.setViewID = function (iID) {
            this.mViewId = iID;
        };
        eDwRedlineItemBase.prototype.getViewID = function () {
            return this.mViewId;
        };
        eDwRedlineItemBase.prototype.setMarkupId = function (iID) {
            this.mRegisterId = iID;
        };
        eDwRedlineItemBase.prototype.setOrigId = function (iID) {
            this.mOrigId = iID;
        };
        eDwRedlineItemBase.prototype.activateWithId = function (iID) {
            this.mActive = 1;
            this.mRegisterId = iID;
        };
        eDwRedlineItemBase.prototype.initializeId = function () {
            var markupMgr = this.mViewerHC.getMarkupManager();
            this.mOrigId = markupMgr.registerMarkup(this);
            this.mActive = 1;
            this.mRegisterId = this.mOrigId;
        };
        eDwRedlineItemBase.prototype.deActivate = function () {
            if (this.mRegisterId === "")
                return;
            var markupMgr = this.mViewerHC.getMarkupManager();
            markupMgr.unregisterMarkup(this.mRegisterId);
            this.mRegisterId = "";
        };
        eDwRedlineItemBase.prototype.forJson = function () {
            var anchors = [];
            var strs = [];
            for (var i = 0; i < this.mWPoints.length; ++i) {
                var str = JSON.stringify(this.mWPoints[i]);
                strs.push(str);
                anchors.push({
                    "x": this.mWPoints[i].x,
                    "y": this.mWPoints[i].y,
                    "z": this.mWPoints[i].z
                });
            }
            return { "anchors": this.mWPoints };
        };
        eDwRedlineItemBase.prototype.setWPoints = function (iWPoints) {
            this.mWPoints = [];
            this.mEditHandle = [];
            this.mSPoints = [];
            for (var i = 0; i < iWPoints.length; ++i) {
                var point = eDwTypes_15.HC.Point3.construct(iWPoints[i]);
                this.addPoint(point);
            }
        };
        eDwRedlineItemBase.prototype.updateGeometry = function () {
            var view = this.mViewerHC.getView();
            for (var i = 0; i < this.mWPoints.length; ++i) {
                var point = this.mWPoints[i].copy();
                var pos = eDwTypes_15.HC.Point2.fromPoint3(view.projectPoint(point));
                this.mSPoints[i].assign(pos.copy());
                this.mEditHandle[i].setCenter(pos.copy());
            }
            var active = eDwRedlineUtils.cameraDiff(this.mCamera, view.getCamera());
            this.mActive = active;
            if (0 === active) {
                this.deActivate();
            }
            var markupMgr = this.mViewerHC.getMarkupManager();
            if (1 === active && "" === this.mRegisterId) {
                var id = markupMgr.registerMarkup(this);
                this.activateWithId(id);
            }
        };
        eDwRedlineItemBase.prototype.getCurColor = function () {
            var dieColor = new eDwTypes_15.HC.Color(100, 100, 100);
            var factor = 1 - this.mActive;
            var cr = this.mColor.r * this.mActive + dieColor.r * factor;
            var cg = this.mColor.g * this.mActive + dieColor.g * factor;
            var cb = this.mColor.b * this.mActive + dieColor.b * factor;
            cr = Math.round(cr);
            cg = Math.round(cg);
            cb = Math.round(cb);
            var curColor = new eDwTypes_15.HC.Color(cr, cg, cb);
            return curColor;
        };
        eDwRedlineItemBase.prototype.checkHit = function (iHitPnt, iPnts, iStrokeWidth) {
            if (iPnts.length < 2)
                return false;
            for (var i = 1; i < iPnts.length; ++i) {
                var pos0 = iPnts[i - 1];
                var pos1 = iPnts[i];
                if (eDwTypes_15.HCI.pointOnLineSegment2d(iHitPnt, pos0, pos1, iStrokeWidth)) {
                    return true;
                }
            }
            if (-1 !== this.hitEditHandle(iHitPnt))
                return true;
            return false;
        };
        return eDwRedlineItemBase;
    }(eDwTypes_15.HC.Markup.Redline.RedlineItem));
    ;
    var eDwRedlinePolyline = (function (_super) {
        __extends(eDwRedlinePolyline, _super);
        function eDwRedlinePolyline(iViewer, point) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitializing = false;
            _this.mPolyline = new eDwTypes_15.HC.Markup.Shape.Polyline();
            _this.addPoint(point);
            _this.addPoint(point);
            return _this;
        }
        eDwRedlinePolyline.prototype.draw = function () {
            this.updateGeometry();
            var renderer = this.mViewerHC.getMarkupManager().getRenderer();
            this.mPolyline.setStrokeWidth(this.getStrokeWidth());
            this.mPolyline.setStrokeColor(this.getCurColor());
            renderer.drawPolyline(this.mPolyline);
            _super.prototype.draw.call(this);
        };
        eDwRedlinePolyline.prototype.hit = function (iPos) {
            return _super.prototype.checkHit.call(this, iPos, this.mSPoints, this.getStrokeWidth());
        };
        eDwRedlinePolyline.prototype.finialize = function (pos) {
            if (!this.mInitializing) {
                return _super.prototype.finialize.call(this, pos);
            }
            if (this.mWPoints.length < 2) {
                return false;
            }
            var wpos = eDwRedlineUtils.screenToCameraPlane(pos, this.mViewerHC.getView(), this.mCamera);
            var lastPos = this.mWPoints[this.mWPoints.length - 2];
            var diff = eDwTypes_15.HC.Point3.subtract(lastPos, wpos);
            return 0 === diff.length();
        };
        eDwRedlinePolyline.prototype.onInitialEditStart = function (pos) {
            _super.prototype.onInitialEditStart.call(this, pos);
            this.mInitializing = true;
        };
        eDwRedlinePolyline.prototype.onEditEnd = function (pos) {
            _super.prototype.onEditEnd.call(this, pos);
            this.mInitializing = false;
        };
        eDwRedlinePolyline.prototype.getClassName = function () {
            return "eDwRedlinePolyline";
        };
        eDwRedlinePolyline.prototype.forJson = function () {
            var basic = _super.prototype.forJson.call(this);
            return basic;
        };
        eDwRedlinePolyline.constructInView = function (jsonObj, iViewer, markupView) {
            var item = new eDwRedlinePolyline(iViewer, eDwTypes_15.HC.Point3.zero());
            item.setWPoints(jsonObj.anchors);
            markupView.addMarkupItem(item);
            item.initializeId();
            item.setViewID(markupView.getUniqueId());
            item.setCamera(markupView.getCamera());
            return item;
        };
        eDwRedlinePolyline.prototype.updateGeometry = function () {
            _super.prototype.updateGeometry.call(this);
            this.mPolyline.clearPoints();
            for (var i = 0; i < this.mSPoints.length; ++i) {
                this.mPolyline.pushPoint(this.mSPoints[i]);
            }
        };
        return eDwRedlinePolyline;
    }(eDwRedlineItemBase));
    ;
    var eDwRedlineBezier = (function (_super) {
        __extends(eDwRedlineBezier, _super);
        function eDwRedlineBezier(iViewer, point) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitializing = false;
            _this.mIsClose = false;
            _this.mPolyline = new eDwTypes_15.HC.Markup.Shape.Polyline();
            _this.addPoint(point);
            _this.addPoint(point);
            return _this;
        }
        eDwRedlineBezier.prototype.draw = function () {
            this.updateGeometry();
            var renderer = this.mViewerHC.getMarkupManager().getRenderer();
            this.mPolyline.setStrokeWidth(this.getStrokeWidth());
            this.mPolyline.setStrokeColor(this.getCurColor());
            renderer.drawPolyline(this.mPolyline);
            _super.prototype.draw.call(this);
        };
        eDwRedlineBezier.prototype.hit = function (iPos) {
            return _super.prototype.checkHit.call(this, iPos, this.mPolyline.getPoints(), this.getStrokeWidth());
        };
        eDwRedlineBezier.prototype.finialize = function (iPos) {
            if (!this.mInitializing) {
                return _super.prototype.finialize.call(this, iPos);
            }
            if (this.mWPoints.length < 2) {
                return false;
            }
            var wpos = eDwRedlineUtils.screenToCameraPlane(iPos, this.mViewerHC.getView(), this.mCamera);
            var lastPos = this.mWPoints[this.mWPoints.length - 2].copy();
            var overlap = 0 === eDwTypes_15.HC.Point3.subtract(lastPos, wpos).length();
            this.mIsClose = this.mWPoints.length > 3 &&
                eDwTypes_15.HC.Point3.subtract(this.mWPoints[0], wpos).length() < 1e-3;
            if (overlap) {
                this.mWPoints.splice(-1, 1);
                this.mSPoints.splice(-1, 1);
                this.mEditHandle.splice(-1, 1);
            }
            return overlap || this.mIsClose;
        };
        eDwRedlineBezier.prototype.onInitialEditStart = function (iPos) {
            _super.prototype.onInitialEditStart.call(this, iPos);
            this.mInitializing = true;
        };
        eDwRedlineBezier.prototype.onEditEnd = function (iPos) {
            _super.prototype.onEditEnd.call(this, iPos);
            this.mInitializing = false;
        };
        eDwRedlineBezier.prototype.onEditStart = function (iPos) {
            _super.prototype.onEditStart.call(this, iPos);
            var n = this.mWPoints.length;
            if (this.mIsClose && this.mEditIdx == n - 1) {
                this.mEditIdx = 0;
            }
        };
        eDwRedlineBezier.prototype.getClassName = function () {
            return "eDwRedlineBezier";
        };
        eDwRedlineBezier.prototype.forJson = function () {
            var basic = _super.prototype.forJson.call(this);
            basic.isclose = this.mIsClose;
            return basic;
        };
        eDwRedlineBezier.constructInView = function (iJSONObj, iViewer, iMarkupView) {
            var item = new eDwRedlineBezier(iViewer, eDwTypes_15.HC.Point3.zero());
            item.setWPoints(iJSONObj.anchors);
            iMarkupView.addMarkupItem(item);
            item.initializeId();
            item.setViewID(iMarkupView.getUniqueId());
            item.setCamera(iMarkupView.getCamera());
            item.mIsClose = iJSONObj.isclose;
            return item;
        };
        eDwRedlineBezier.prototype.updateGeometry = function () {
            _super.prototype.updateGeometry.call(this);
            if (this.mIsClose) {
                var n = this.mSPoints.length;
                this.mSPoints[n - 1].assign(this.mSPoints[0].copy());
                this.mEditHandle[n - 1].setCenter(this.mSPoints[0].copy());
            }
            this.mPolyline.clearPoints();
            var bPoints = this.cBezierPoints(this.mSPoints);
            for (var i = 0; i < bPoints.length; ++i) {
                this.mPolyline.pushPoint(bPoints[i]);
            }
        };
        eDwRedlineBezier.prototype.bezierPoints = function (iPnt) {
            var n = iPnt.length;
            var N = 5 * n;
            var T = [];
            for (var i = 0; i <= N; ++i) {
                T.push(i / N);
            }
            var output = [];
            for (var k = 0; k < T.length; ++k) {
                var a = T[k];
                var Pa = eDwTypes_15.HC.Point2.zero();
                for (var i = 0; i < n; ++i) {
                    var Bi = eDwRedlineUtils.fastFactorial(n - 1) /
                        eDwRedlineUtils.fastFactorial(i) /
                        eDwRedlineUtils.fastFactorial(n - 1 - i) *
                        Math.pow(a, i) * Math.pow(1 - a, n - 1 - i);
                    var Pi = iPnt[i].copy();
                    Pi.scale(Bi);
                    Pa = eDwTypes_15.HC.Point2.add(Pa, Pi);
                }
                output.push(Pa);
            }
            return output;
        };
        eDwRedlineBezier.prototype.rBezierPoints = function (iPnt) {
            var n = iPnt.length;
            var N = 5 * n;
            var T = [];
            for (var i = 0; i <= N; ++i) {
                T.push(i / N);
            }
            var output = [];
            for (var k = 0; k < T.length; ++k) {
                var a = T[k];
                var Pa = eDwTypes_15.HC.Point2.zero();
                var sum = 0;
                for (var i = 0; i < n; ++i) {
                    var Bi = eDwRedlineUtils.fastFactorial(n - 1) /
                        eDwRedlineUtils.fastFactorial(i) /
                        eDwRedlineUtils.fastFactorial(n - 1 - i) *
                        Math.pow(a, i) * Math.pow(1 - a, n - 1 - i);
                    sum += Bi;
                }
                for (var i = 0; i < n; ++i) {
                    var Bi = eDwRedlineUtils.fastFactorial(n - 1) /
                        eDwRedlineUtils.fastFactorial(i) /
                        eDwRedlineUtils.fastFactorial(n - 1 - i) *
                        Math.pow(a, i) * Math.pow(1 - a, n - 1 - i) / sum;
                    var Pi = iPnt[i].copy();
                    Pi.scale(Bi);
                    Pa = eDwTypes_15.HC.Point2.add(Pa, Pi);
                }
                output.push(Pa);
            }
            return output;
        };
        eDwRedlineBezier.prototype.rBezierSegment = function (iPos0, tangent0, iPos1, tangent1) {
            var Pn = [iPos0, eDwTypes_15.HC.Point2.add(iPos0, tangent0.TR),
                eDwTypes_15.HC.Point2.add(iPos1, tangent1.TL), iPos1];
            var n = Pn.length;
            var N = 5 * n;
            var T = [];
            for (var i = 0; i <= N; ++i) {
                T.push(i / N);
            }
            var output = [];
            for (var k = 0; k < T.length; ++k) {
                var a = T[k];
                var Pa = eDwTypes_15.HC.Point2.zero();
                var sum = 0;
                for (var i = 0; i < n; ++i) {
                    var Bi = eDwRedlineUtils.fastFactorial(n - 1) /
                        eDwRedlineUtils.fastFactorial(i) /
                        eDwRedlineUtils.fastFactorial(n - 1 - i) *
                        Math.pow(a, i) * Math.pow(1 - a, n - 1 - i);
                    sum += Bi;
                }
                for (var i = 0; i < n; ++i) {
                    var Bi = eDwRedlineUtils.fastFactorial(n - 1) /
                        eDwRedlineUtils.fastFactorial(i) /
                        eDwRedlineUtils.fastFactorial(n - 1 - i) *
                        Math.pow(a, i) * Math.pow(1 - a, n - 1 - i) / sum;
                    var Pi = Pn[i].copy();
                    Pi.scale(Bi);
                    Pa = eDwTypes_15.HC.Point2.add(Pa, Pi);
                }
                output.push(Pa);
            }
            return output;
        };
        eDwRedlineBezier.prototype.cBezierPoints = function (iPnt) {
            var n = iPnt.length;
            if (this.mIsClose) {
                this.computTangentDirsClose(iPnt);
            }
            else {
                this.computTangentDirsOpen(iPnt);
            }
            this.mPolyline.clearPoints();
            var output = [];
            for (var i = 1; i < n; ++i) {
                var pointSgmt = this.rBezierSegment(iPnt[i - 1], this.mTangents[i - 1], iPnt[i], this.mTangents[i]);
                output = output.concat(pointSgmt);
            }
            return output;
        };
        eDwRedlineBezier.prototype.computTangentDirsOpen = function (iPnt) {
            this.mTangents = [];
            var n = iPnt.length;
            this.mTangents.push({ TL: eDwTypes_15.HC.Point2.zero(), TR: eDwTypes_15.HC.Point2.zero() });
            for (var i = 1; i < n - 1 && n > 2; ++i) {
                this.mTangents.push({ TL: eDwTypes_15.HC.Point2.zero(), TR: eDwTypes_15.HC.Point2.zero() });
                var vecL = eDwTypes_15.HC.Point2.subtract(iPnt[i - 1], iPnt[i]);
                var vecR = eDwTypes_15.HC.Point2.subtract(iPnt[i + 1], iPnt[i]);
                var origStrength = 0.4;
                var lenL = vecL.length() * origStrength;
                var lenR = vecR.length() * origStrength;
                eDwRedlineUtils.normalizePoint2(vecL);
                eDwRedlineUtils.normalizePoint2(vecR);
                var bisec = eDwTypes_15.HC.Point2.add(vecL, vecR);
                eDwRedlineUtils.normalizePoint2(bisec);
                if (0 === bisec.x && 0 === bisec.y) {
                    continue;
                }
                var vec0 = new eDwTypes_15.HC.Point2(-1 * bisec.y, bisec.x);
                var vec1 = new eDwTypes_15.HC.Point2(bisec.y, -1 * bisec.x);
                if (vec0.x * vecL.x + vec0.y * vecL.y > 0) {
                    vec0.scale(lenL);
                    vec1.scale(lenR);
                    this.mTangents[i].TL = vec0;
                    this.mTangents[i].TR = vec1;
                }
                else {
                    vec0.scale(lenR);
                    vec1.scale(lenL);
                    this.mTangents[i].TR = vec0;
                    this.mTangents[i].TL = vec1;
                }
            }
            this.mTangents.push({ TL: eDwTypes_15.HC.Point2.zero(), TR: eDwTypes_15.HC.Point2.zero() });
            if (2 == n)
                return;
            var pB0 = this.pBisectorDir(iPnt[0], iPnt[1]);
            this.mTangents[0].TR = this.symmetricVec(pB0, this.mTangents[1].TL);
            var pBn = this.pBisectorDir(iPnt[n - 1], iPnt[n - 2]);
            this.mTangents[n - 1].TL = this.symmetricVec(pBn, this.mTangents[n - 2].TR);
        };
        eDwRedlineBezier.prototype.computTangentDirsClose = function (iPnt) {
            this.mTangents = [];
            var n = iPnt.length - 1;
            for (var i = 0; i < n; ++i) {
                this.mTangents.push({ TL: eDwTypes_15.HC.Point2.zero(), TR: eDwTypes_15.HC.Point2.zero() });
                var idxPre = (n + i - 1) % n;
                var idxNxt = (n + i + 1) % n;
                var vecL = eDwTypes_15.HC.Point2.subtract(iPnt[idxPre], iPnt[i]);
                var vecR = eDwTypes_15.HC.Point2.subtract(iPnt[idxNxt], iPnt[i]);
                var origStrength = 0.4;
                var lenL = vecL.length() * origStrength;
                var lenR = vecR.length() * origStrength;
                eDwRedlineUtils.normalizePoint2(vecL);
                eDwRedlineUtils.normalizePoint2(vecR);
                var bisec = eDwTypes_15.HC.Point2.add(vecL, vecR);
                eDwRedlineUtils.normalizePoint2(bisec);
                if (0 === bisec.x && 0 === bisec.y) {
                    continue;
                }
                var vec0 = new eDwTypes_15.HC.Point2(-1 * bisec.y, bisec.x);
                var vec1 = new eDwTypes_15.HC.Point2(bisec.y, -1 * bisec.x);
                if (vec0.x * vecL.x + vec0.y * vecL.y > 0) {
                    vec0.scale(lenL);
                    vec1.scale(lenR);
                    this.mTangents[i].TL = vec0;
                    this.mTangents[i].TR = vec1;
                }
                else {
                    vec0.scale(lenR);
                    vec1.scale(lenL);
                    this.mTangents[i].TR = vec0;
                    this.mTangents[i].TL = vec1;
                }
            }
            this.mTangents.push(this.mTangents[0]);
        };
        eDwRedlineBezier.prototype.symmetricVec = function (iAxis, iSource) {
            if (0 === iAxis.x && 0 === iAxis.y)
                return iSource.copy();
            var a = iAxis.copy();
            eDwRedlineUtils.normalizePoint2(a);
            var proj = eDwRedlineUtils.dotPoint2(a, iSource);
            a.scale(2 * proj);
            var output = eDwTypes_15.HC.Point2.subtract(a, iSource);
            return output;
        };
        eDwRedlineBezier.prototype.pBisectorDir = function (iPos0, iPos1) {
            var p01 = eDwTypes_15.HC.Point2.subtract(iPos1, iPos0);
            if (0 === p01.x && 0 === p01.y) {
                return eDwTypes_15.HC.Point2.zero();
            }
            eDwRedlineUtils.normalizePoint2(p01);
            var output = new eDwTypes_15.HC.Point2(p01.y, -1 * p01.x);
            return output;
        };
        return eDwRedlineBezier;
    }(eDwRedlineItemBase));
    ;
    var eDwRedlineCircle = (function (_super) {
        __extends(eDwRedlineCircle, _super);
        function eDwRedlineCircle(iViewer, iPoint) {
            var _this = _super.call(this, iViewer) || this;
            _this.mCircle = new eDwTypes_15.HC.Markup.Shape.Circle();
            _this.mCircle.setFillOpacity(0);
            _this.addPoint(iPoint);
            _this.addPoint(iPoint);
            return _this;
        }
        eDwRedlineCircle.prototype.draw = function () {
            this.updateGeometry();
            var renderer = this.mViewerHC.getMarkupManager().getRenderer();
            this.mCircle.setStrokeWidth(this.getStrokeWidth());
            this.mCircle.setStrokeColor(this.getCurColor());
            renderer.drawCircle(this.mCircle);
            _super.prototype.draw.call(this);
        };
        eDwRedlineCircle.prototype.hit = function (iPos) {
            var r = this.mCircle.getRadius();
            var center = this.mCircle.getCenter();
            var w = this.mCircle.getStrokeWidth();
            var dist = eDwTypes_15.HC.Point2.subtract(iPos, center).length();
            if (dist > r - w && dist < r + w)
                return true;
            if (-1 !== this.hitEditHandle(iPos))
                return true;
            return false;
        };
        eDwRedlineCircle.prototype.getClassName = function () {
            return "eDwRedlineCircle";
        };
        eDwRedlineCircle.prototype.forJson = function () {
            var basic = _super.prototype.forJson.call(this);
            return basic;
        };
        eDwRedlineCircle.constructInView = function (iJSONObj, iViewer, iMarkupView) {
            var item = new eDwRedlineCircle(iViewer, eDwTypes_15.HC.Point3.zero());
            item.setWPoints(iJSONObj.anchors);
            iMarkupView.addMarkupItem(item);
            item.initializeId();
            item.setViewID(iMarkupView.getUniqueId());
            item.setCamera(iMarkupView.getCamera());
            return item;
        };
        eDwRedlineCircle.prototype.updateGeometry = function () {
            _super.prototype.updateGeometry.call(this);
            this.mCircle.setCenter(this.mSPoints[0].copy());
            var radius = eDwTypes_15.HC.Point2.subtract(this.mSPoints[0], this.mSPoints[1]).length();
            this.mCircle.setRadius(radius);
        };
        return eDwRedlineCircle;
    }(eDwRedlineItemBase));
    ;
    var eDwRedlineRectangle = (function (_super) {
        __extends(eDwRedlineRectangle, _super);
        function eDwRedlineRectangle(iViewer, iPoint) {
            var _this = _super.call(this, iViewer) || this;
            _this.mRectangle = new eDwTypes_15.HC.Markup.Shape.Rectangle();
            _this.mRectangle.setFillOpacity(0);
            _this.addPoint(iPoint);
            _this.addPoint(iPoint);
            return _this;
        }
        eDwRedlineRectangle.prototype.draw = function () {
            this.updateGeometry();
            var renderer = this.mViewerHC.getMarkupManager().getRenderer();
            this.mRectangle.setStrokeWidth(this.getStrokeWidth());
            this.mRectangle.setStrokeColor(this.getCurColor());
            renderer.drawRectangle(this.mRectangle);
            _super.prototype.draw.call(this);
        };
        eDwRedlineRectangle.prototype.hit = function (iPos) {
            var p0 = this.mSPoints[0];
            var p1 = this.mSPoints[1];
            var xMin = Math.min(p0.x, p1.x);
            var xMax = Math.max(p0.x, p1.x);
            var yMin = Math.min(p0.y, p1.y);
            var yMax = Math.max(p0.y, p1.y);
            var A = new eDwTypes_15.HC.Point2(xMin, yMin);
            var B = new eDwTypes_15.HC.Point2(xMin, yMax);
            var C = new eDwTypes_15.HC.Point2(xMax, yMax);
            var D = new eDwTypes_15.HC.Point2(xMax, yMin);
            var w = this.mRectangle.getStrokeWidth();
            var output = false;
            output = output || eDwTypes_15.HCI.pointOnLineSegment2d(iPos, A, B, w);
            output = output || eDwTypes_15.HCI.pointOnLineSegment2d(iPos, B, C, w);
            output = output || eDwTypes_15.HCI.pointOnLineSegment2d(iPos, C, D, w);
            output = output || eDwTypes_15.HCI.pointOnLineSegment2d(iPos, D, A, w);
            if (output)
                return true;
            if (-1 !== this.hitEditHandle(iPos))
                return true;
            return false;
        };
        eDwRedlineRectangle.prototype.getClassName = function () {
            return "eDwRedlineRectangle";
        };
        eDwRedlineRectangle.prototype.forJson = function () {
            var basic = _super.prototype.forJson.call(this);
            return basic;
        };
        eDwRedlineRectangle.constructInView = function (iJSONObj, iViewer, iMarkupView) {
            var item = new eDwRedlineRectangle(iViewer, eDwTypes_15.HC.Point3.zero());
            item.setWPoints(iJSONObj.anchors);
            iMarkupView.addMarkupItem(item);
            item.initializeId();
            item.setViewID(iMarkupView.getUniqueId());
            item.setCamera(iMarkupView.getCamera());
            return item;
        };
        eDwRedlineRectangle.prototype.updateGeometry = function () {
            _super.prototype.updateGeometry.call(this);
            var p0 = this.mSPoints[0];
            var p1 = this.mSPoints[1];
            var diff = eDwTypes_15.HC.Point2.subtract(p0, p1);
            var pos = new eDwTypes_15.HC.Point2(Math.min(p0.x, p1.x), Math.min(p0.y, p1.y));
            var sides = new eDwTypes_15.HC.Point2(Math.abs(diff.x), Math.abs(diff.y));
            this.mRectangle.setPosition(pos);
            this.mRectangle.setSize(sides);
        };
        return eDwRedlineRectangle;
    }(eDwRedlineItemBase));
    ;
    var eDwRedlineImage = (function (_super) {
        __extends(eDwRedlineImage, _super);
        function eDwRedlineImage(iViewer, iPoint) {
            var _this = _super.call(this, iViewer) || this;
            _this.mRectangle = new eDwTypes_15.HC.Markup.Shape.Rectangle();
            _this.mRectangle.setFillOpacity(0);
            _this.addPoint(iPoint);
            _this.addPoint(iPoint);
            _this.setImage(eDwSVGUtil.testData);
            return _this;
        }
        eDwRedlineImage.prototype.draw = function () {
            this.updateGeometry();
            var renderer = this.mViewerHC.getMarkupManager().getRenderer();
            this.mRectangle.setStrokeWidth(this.getStrokeWidth());
            this.mRectangle.setStrokeColor(this.getCurColor());
            this.mImageSVG.draw();
            renderer.drawRectangle(this.mRectangle);
            _super.prototype.draw.call(this);
        };
        eDwRedlineImage.prototype.hit = function (iPos) {
            var p0 = this.mSPoints[0];
            var p1 = this.mSPoints[1];
            var xMin = Math.min(p0.x, p1.x);
            var xMax = Math.max(p0.x, p1.x);
            var yMin = Math.min(p0.y, p1.y);
            var yMax = Math.max(p0.y, p1.y);
            var A = new eDwTypes_15.HC.Point2(xMin, yMin);
            var B = new eDwTypes_15.HC.Point2(xMin, yMax);
            var C = new eDwTypes_15.HC.Point2(xMax, yMax);
            var D = new eDwTypes_15.HC.Point2(xMax, yMin);
            var w = this.mRectangle.getStrokeWidth();
            var output = false;
            output = output || eDwTypes_15.HCI.pointOnLineSegment2d(iPos, A, B, w);
            output = output || eDwTypes_15.HCI.pointOnLineSegment2d(iPos, B, C, w);
            output = output || eDwTypes_15.HCI.pointOnLineSegment2d(iPos, C, D, w);
            output = output || eDwTypes_15.HCI.pointOnLineSegment2d(iPos, D, A, w);
            if (output)
                return true;
            if (iPos.x <= xMax && iPos.x >= xMin &&
                iPos.y <= yMax && iPos.y >= yMin)
                return true;
            if (-1 !== this.hitEditHandle(iPos))
                return true;
            return false;
        };
        eDwRedlineImage.prototype.onSelect = function () {
            _super.prototype.onSelect.call(this);
        };
        eDwRedlineImage.prototype.getClassName = function () {
            return "eDwRedlineImage";
        };
        eDwRedlineImage.prototype.forJson = function () {
            var basic = _super.prototype.forJson.call(this);
            return basic;
        };
        eDwRedlineImage.prototype.setImage = function (iData) {
            this.mImageSVG = new eDwSVGImage(iData, eDwTypes_15.HC.Point2.zero(), eDwTypes_15.HC.Point2.zero());
        };
        eDwRedlineImage.constructInView = function (iJSONObj, iViewer, iMarkupView) {
            var item = new eDwRedlineImage(iViewer, eDwTypes_15.HC.Point3.zero());
            item.setWPoints(iJSONObj.anchors);
            iMarkupView.addMarkupItem(item);
            item.initializeId();
            item.setViewID(iMarkupView.getUniqueId());
            item.setCamera(iMarkupView.getCamera());
            return item;
        };
        eDwRedlineImage.prototype.updateGeometry = function () {
            _super.prototype.updateGeometry.call(this);
            var p0 = this.mSPoints[0];
            var p1 = this.mSPoints[1];
            var diff = eDwTypes_15.HC.Point2.subtract(p0, p1);
            var pos = new eDwTypes_15.HC.Point2(Math.min(p0.x, p1.x), Math.min(p0.y, p1.y));
            var sides = new eDwTypes_15.HC.Point2(Math.abs(diff.x), Math.abs(diff.y));
            this.mRectangle.setPosition(pos);
            this.mRectangle.setSize(sides);
            this.mImageSVG.setPosition(pos);
            this.mImageSVG.setSize(sides);
        };
        eDwRedlineImage.prototype.deActivate = function () {
            _super.prototype.deActivate.call(this);
        };
        return eDwRedlineImage;
    }(eDwRedlineItemBase));
    ;
    var eDwRedlineTextBox = (function (_super) {
        __extends(eDwRedlineTextBox, _super);
        function eDwRedlineTextBox(iViewer, iPoint) {
            var _this = _super.call(this, iViewer) || this;
            _this.mBox = new eDwTypes_15.HC.Markup.Shape.Rectangle();
            _this.mTextHtml = new eDwRedlineDivText();
            _this.mLeader = new eDwTypes_15.HC.Markup.Shape.Line();
            _this.addPoint(iPoint);
            _this.addPoint(iPoint);
            return _this;
        }
        eDwRedlineTextBox.prototype.draw = function () {
            this.updateGeometry();
            var renderer = this.mViewerHC.getMarkupManager().getRenderer();
            this.mBox.setStrokeWidth(this.getStrokeWidth());
            this.mBox.setStrokeColor(this.getCurColor());
            this.mLeader.setStrokeWidth(1);
            renderer.drawRectangle(this.mBox);
            renderer.drawLine(this.mLeader);
            _super.prototype.draw.call(this);
        };
        eDwRedlineTextBox.prototype.setText = function (str) {
            this.mTextHtml.setText(str);
        };
        eDwRedlineTextBox.prototype.getText = function () {
            return this.mTextHtml.getText();
        };
        eDwRedlineTextBox.prototype.hit = function (iPos) {
            var renderer = this.mViewerHC.getMarkupManager().getRenderer();
            var boxPos = this.mBox.getPosition();
            var boxSize = this.mBox.getSize();
            var xMin = boxPos.x;
            var xMax = boxPos.x + boxSize.x;
            var yMin = boxPos.y;
            var yMax = boxPos.y + boxSize.y;
            var A = new eDwTypes_15.HC.Point2(xMin, yMin);
            var B = new eDwTypes_15.HC.Point2(xMin, yMax);
            var C = new eDwTypes_15.HC.Point2(xMax, yMax);
            var D = new eDwTypes_15.HC.Point2(xMax, yMin);
            var w = this.mBox.getStrokeWidth();
            var output = false;
            output = output || eDwTypes_15.HCI.pointOnLineSegment2d(iPos, A, B, w);
            output = output || eDwTypes_15.HCI.pointOnLineSegment2d(iPos, B, C, w);
            output = output || eDwTypes_15.HCI.pointOnLineSegment2d(iPos, C, D, w);
            output = output || eDwTypes_15.HCI.pointOnLineSegment2d(iPos, D, A, w);
            var hitText = iPos.x < xMax && iPos.x > xMin && iPos.y < yMax &&
                iPos.y > yMin;
            if (hitText) {
                this.mTextHtml.getFocus();
            }
            output = output || hitText;
            if (output)
                return true;
            if (-1 !== this.hitEditHandle(iPos))
                return true;
            return false;
        };
        eDwRedlineTextBox.prototype.getClassName = function () {
            return "eDwRedlineTextBox";
        };
        eDwRedlineTextBox.prototype.onDeselect = function () {
            _super.prototype.onDeselect.call(this);
            this.mTextHtml.getBlur();
        };
        eDwRedlineTextBox.prototype.activateWithId = function (id) {
            _super.prototype.activateWithId.call(this, id);
            this.mTextHtml.showElement(true);
        };
        eDwRedlineTextBox.prototype.deActivate = function () {
            _super.prototype.deActivate.call(this);
            this.mTextHtml.showElement(false);
        };
        eDwRedlineTextBox.prototype.forJson = function () {
            var basic = _super.prototype.forJson.call(this);
            basic.textContent = this.getText();
            return basic;
        };
        eDwRedlineTextBox.constructInView = function (iJSONObj, iViewer, iMarkupView) {
            var item = new eDwRedlineTextBox(iViewer, eDwTypes_15.HC.Point3.zero());
            item.setWPoints(iJSONObj.anchors);
            iMarkupView.addMarkupItem(item);
            item.initializeId();
            item.setViewID(iMarkupView.getUniqueId());
            item.setCamera(iMarkupView.getCamera());
            item.setText(iJSONObj.textContent);
            return item;
        };
        eDwRedlineTextBox.prototype.updateGeometry = function () {
            _super.prototype.updateGeometry.call(this);
            var p0 = this.mSPoints[0];
            var p1 = this.mSPoints[1];
            var diff = eDwTypes_15.HC.Point2.subtract(p0, p1);
            this.mLeader.setP1(p0.copy());
            this.mLeader.setP2(p1.copy());
            this.mBox.setPosition(p1.copy());
            this.mTextHtml.setPosition(p1.copy());
            var size = this.mTextHtml.getSize();
            this.mBox.setSize(size);
        };
        return eDwRedlineTextBox;
    }(eDwRedlineItemBase));
    ;
    var eDwRedlineOperator = (function (_super) {
        __extends(eDwRedlineOperator, _super);
        function eDwRedlineOperator(iViewer) {
            var _this = _super.call(this, iViewer.HCViewer) || this;
            _this.mPoints = [];
            _this.mLeaglePointNum = 2;
            _this.mViewer = iViewer;
            _this.mViewerHC = _this.mViewer.HCViewer;
            _this.mModel = _this.mViewer.HCViewer.getModel();
            _this.mMarkupMode = eDwTypes_15.MarkupMode.None;
            return _this;
        }
        eDwRedlineOperator.prototype.onMouseMove = function (iEvent) {
            var markupMgr = this.mViewerHC.getMarkupManager();
            if (!this.mCurMarkup)
                return;
            var pos = iEvent.getPosition();
            var wpos = eDwBaseOperator.screenToWorld(iEvent.getPosition(), this.mViewerHC.getView());
            if (this.mCurMarkup.isTransing()) {
                this.mCurMarkup.onTransMove(pos);
            }
            if (this.mCurMarkup.isEditing()) {
                this.mCurMarkup.onEditMove(pos);
            }
            markupMgr.refreshMarkup();
        };
        eDwRedlineOperator.prototype.onMouseDown = function (iEvent) {
            var pos = iEvent.getPosition();
            var view = this.mViewerHC.getView();
            var camera = this.mViewerHC.getView().getCamera();
            var wpos = camera.getCameraPlaneIntersectionPoint(pos, view);
            var markupMgr = this.mViewerHC.getMarkupManager();
            if (this.mCurMarkup) {
                if (this.mCurMarkup.finialize(iEvent.getPosition())) {
                    this.mCurMarkup.onEditEnd(iEvent.getPosition());
                    this.mCurMarkup = null;
                    this.mViewerHC.getMarkupManager().refreshMarkup();
                }
                else {
                    this.mCurMarkup.addPoint(wpos);
                }
                return;
            }
            var pickItem = markupMgr.pickMarkupItem(iEvent.getPosition());
            this.mCurMarkup = pickItem;
            markupMgr.selectMarkup(this.mCurMarkup);
            var activeView = markupMgr.getActiveMarkupView();
            if (activeView && this.mCurMarkup &&
                activeView.getUniqueId() != this.mCurMarkup.getViewID()) {
                this.mCurMarkup = null;
                markupMgr.selectMarkup(null);
            }
            if (!this.mCurMarkup) {
                this.createItem(pos);
            }
            else {
                this.mCurMarkup.onSelect();
                this.mViewerHC.getMarkupManager().refreshMarkup();
                this.mCurMarkup.onTransOrEditStart(pos);
            }
            this.onItemSelected();
        };
        eDwRedlineOperator.prototype.onMouseUp = function (iEvent) {
            if (this.mCurMarkup && this.mCurMarkup.isTransing()) {
                this.mCurMarkup.onTransEnd(iEvent.getPosition());
                this.mCurMarkup = null;
            }
        };
        eDwRedlineOperator.prototype.onItemSelected = function () {
        };
        eDwRedlineOperator.prototype.setCurAnnotation = function (iStr) {
            var selected = this.mViewerHC.getMarkupManager().getSelectedMarkup();
            if (selected && (selected instanceof eDwRedlineTextBox)) {
                selected.setText(iStr);
                this.mViewerHC.getMarkupManager().refreshMarkup();
            }
        };
        eDwRedlineOperator.prototype.getCurAnnotation = function () {
            if (this.mCurMarkup && (this.mCurMarkup instanceof eDwRedlineTextBox)) {
                return this.mCurMarkup.getText();
            }
            return "";
        };
        eDwRedlineOperator.prototype.getClassName = function () {
            return "eDwMarkupRedlineOperator";
        };
        eDwRedlineOperator.prototype.setMarkupMode = function (iMode) {
            this.mMarkupMode = iMode;
        };
        eDwRedlineOperator.prototype.getMarkupMode = function () {
            return this.mMarkupMode;
        };
        eDwRedlineOperator.activateMarkups = function (iMkView, iViewer) {
            var markupMgr = iViewer.getMarkupManager();
            var markups = iMkView.getMarkup();
            for (var i = 0; i < markups.length; ++i) {
                var edwMkup = markups[i];
                var mkupId = markupMgr.registerMarkup(edwMkup);
                edwMkup.activateWithId(mkupId);
            }
        };
        eDwRedlineOperator.deActivateMarkups = function (iMkView, iViewer) {
            var markupMgr = iViewer.getMarkupManager();
            var markups = iMkView.getMarkup();
            for (var i = 0; i < markups.length; ++i) {
                var edwMkup = markups[i];
                edwMkup.deActivate();
            }
        };
        eDwRedlineOperator.reconstructMarkups = function (iJSONObj, iViewer, iMarkupView) {
            if (iJSONObj.className === "eDwRedlinePolyline") {
                eDwRedlinePolyline.constructInView(iJSONObj, iViewer, iMarkupView);
            }
            if (iJSONObj.className === "eDwRedlineBezier") {
                eDwRedlineBezier.constructInView(iJSONObj, iViewer, iMarkupView);
            }
            if (iJSONObj.className === "eDwRedlineCircle") {
                eDwRedlineCircle.constructInView(iJSONObj, iViewer, iMarkupView);
            }
            if (iJSONObj.className === "eDwRedlineRectangle") {
                eDwRedlineRectangle.constructInView(iJSONObj, iViewer, iMarkupView);
            }
            if (iJSONObj.className === "eDwRedlineImage") {
                eDwRedlineImage.constructInView(iJSONObj, iViewer, iMarkupView);
            }
            if (iJSONObj.className === "eDwRedlineTextBox") {
                eDwRedlineTextBox.constructInView(iJSONObj, iViewer, iMarkupView);
            }
        };
        eDwRedlineOperator.constructView = function (iMarkupData, iViewer) {
            var markupMgr = iViewer.getMarkupManager();
            markupMgr.loadMarkupData(iMarkupData);
            var keys = markupMgr.getMarkupViewKeys();
            for (var i = 0; i < keys.length; ++i) {
                var mkView = markupMgr.getMarkupView(keys[i]);
                eDwRedlineOperator.constructMarkupForView(keys[i], iMarkupData, iViewer);
            }
        };
        eDwRedlineOperator.constructMarkupForView = function (iViewKey, iMarkupData, iViewer) {
            var markupMgr = iViewer.getMarkupManager();
            var curView = markupMgr.getMarkupView(iViewKey);
            var mkViews = iMarkupData.views;
            for (var i = 0; i < mkViews.length; ++i) {
                var mkView = mkViews[i];
                if (iViewKey === mkView.uniqueId) {
                    var markupObjs = mkView.markup;
                    for (var i_1 = 0; i_1 < markupObjs.length; ++i_1) {
                        var markupObj = markupObjs[i_1];
                        eDwRedlineOperator.reconstructMarkups(markupObj, iViewer, curView);
                    }
                }
            }
        };
        eDwRedlineOperator.prototype.createItem = function (iPos) {
            var camera = this.mViewerHC.getView().getCamera();
            var wpos = camera.getCameraPlaneIntersectionPoint(iPos, this.mViewerHC.getView());
            if (this.mMarkupMode === eDwTypes_15.MarkupMode.Text) {
                this.mCurMarkup = new eDwRedlineTextBox(this.mViewerHC, wpos);
            }
            else if (this.mMarkupMode === eDwTypes_15.MarkupMode.Circle) {
                this.mCurMarkup = new eDwRedlineCircle(this.mViewerHC, wpos);
            }
            else if (this.mMarkupMode === eDwTypes_15.MarkupMode.Rectangle) {
                this.mCurMarkup = new eDwRedlineRectangle(this.mViewerHC, wpos);
            }
            else if (this.mMarkupMode === eDwTypes_15.MarkupMode.Polyline) {
                this.mCurMarkup = new eDwRedlinePolyline(this.mViewerHC, wpos);
            }
            else if (this.mMarkupMode === eDwTypes_15.MarkupMode.Bezier) {
                this.mCurMarkup = new eDwRedlineBezier(this.mViewerHC, wpos);
            }
            else if (this.mMarkupMode === eDwTypes_15.MarkupMode.Image) {
                this.mCurMarkup = new eDwRedlineImage(this.mViewerHC, wpos);
            }
            if (!this.mCurMarkup)
                return;
            var markupMgr = this.mViewerHC.getMarkupManager();
            var activeView = markupMgr.getActiveMarkupView();
            var viewId = "";
            if (!activeView) {
                viewId = markupMgr.createMarkupView();
                activeView = markupMgr.getMarkupView(viewId);
                markupMgr.activateMarkupView(viewId);
                console.log("sheetId????? " + activeView.getSheetId());
            }
            viewId = activeView.getUniqueId();
            if (this.mCurMarkup) {
                markupMgr.getActiveMarkupView().addMarkupItem(this.mCurMarkup);
                this.mCurMarkup.initializeId();
                this.mCurMarkup.setViewID(viewId);
                this.mCurMarkup.setCamera(camera);
                this.mCurMarkup.onInitialEditStart(iPos);
            }
        };
        return eDwRedlineOperator;
    }(eDwTypes_15.HC.RedlineOperator));
    ;
    return eDwRedlineOperator;
});
define("eDwResetCmd", ["require", "exports", "eDwSupportsHistoryCmd", "eDwEventMgr"], function (require, exports, eDwSupportsHistoryCmd, eDwEventMgr) {
    "use strict";
    var eDwResetCmd = (function (_super) {
        __extends(eDwResetCmd, _super);
        function eDwResetCmd(iViewer) {
            var _this = _super.call(this, iViewer) || this;
            _this.mPerspective = iViewer.getPerspectiveMode();
            _this.mExplosionLevel = iViewer.getExplosionLevel();
            _this.mDrawMode = iViewer.getDrawMode();
            _this.mAmbientOcclusion =
                iViewer.getHCView().getAmbientOcclusionEnabled();
            _this.mCamera = iViewer.getHCView().getCamera();
            _this.resetToHome();
            return _this;
        }
        eDwResetCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.resetToPrevious();
            return true;
        };
        eDwResetCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.resetToHome();
            return true;
        };
        eDwResetCmd.prototype.resetToHome = function () {
            this.mViewer.SelectionMgr.unSelectAllObjects();
            this.mViewer.OperatorMgr.resetToDefault();
            this.mViewer.setPerspectiveMode(false);
            this.mViewer.getModel().resetToDefault();
            this.mViewer.setExplosionLevel(0);
            this.mViewer.resetDrawMode();
            this.mViewer.ViewMgr.enableAmbientOcclusion(false);
            this.mViewer.CompXformMgr.resetModelNodeXforms();
            eDwEventMgr.get().fireEvents("ResetScene");
        };
        eDwResetCmd.prototype.resetToPrevious = function () {
            this.mViewer.setPerspectiveMode(this.mPerspective);
            this.mViewer.ViewMgr.setCamera(this.mCamera);
            this.mViewer.setExplosionLevel(this.mExplosionLevel);
            this.mViewer.setDrawMode(this.mDrawMode);
            this.mViewer.ViewMgr.enableAmbientOcclusion(this.mAmbientOcclusion);
            this.mViewer.CompXformMgr.resetModelNodeXforms(false);
            eDwEventMgr.get().fireEvents("ResetScene");
        };
        return eDwResetCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwResetCmd;
});
define("eDwResultError", ["require", "exports", "eDwBaseError"], function (require, exports, eDwBaseError) {
    "use strict";
    var eDwResultError = (function (_super) {
        __extends(eDwResultError, _super);
        function eDwResultError(iResult) {
            var _this = _super.call(this, "eDwResultError") || this;
            _this.Result = iResult;
            return _this;
        }
        return eDwResultError;
    }(eDwBaseError));
    ;
    return eDwResultError;
});
define("eDwSectionFlipCmd", ["require", "exports", "eDwSupportsHistoryCmd"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwSectionFlipCmd = (function (_super) {
        __extends(eDwSectionFlipCmd, _super);
        function eDwSectionFlipCmd(iViewer) {
            return _super.call(this, iViewer) || this;
        }
        eDwSectionFlipCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.mViewer.XSectionMgr.flipSectionPlane();
            return true;
        };
        eDwSectionFlipCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.mViewer.XSectionMgr.flipSectionPlane();
            return true;
        };
        eDwSectionFlipCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            this.mViewer.XSectionMgr.flipSectionPlane();
        };
        Object.defineProperty(eDwSectionFlipCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        return eDwSectionFlipCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwSectionFlipCmd;
});
define("eDwSelectionOperator", ["require", "exports", "eDwBaseOperator", "eDwBaseSelOperator", "eDwEventMgr", "eDwKeyMgr", "eDwTypes"], function (require, exports, eDwBaseOperator, eDwBaseSelOperator, eDwEventMgr, eDwKeyMgr, eDwTypes_16) {
    "use strict";
    var cUnselectableItem = -1;
    var eDwNameCallout = (function (_super) {
        __extends(eDwNameCallout, _super);
        function eDwNameCallout(iVewer) {
            var _this = _super.call(this) || this;
            _this.mViewer = iVewer;
            _this.mViewerHC = iVewer.HCViewer;
            _this.mTextBox = new eDwTypes_16.HC.Markup.Shape.TextBox();
            _this.mTextBox.getBoxPortion().setFillColor(eDwTypes_16.HC.Color.white());
            _this.mTextBox.getBoxPortion().setFillOpacity(1);
            return _this;
        }
        eDwNameCallout.prototype.draw = function () {
            var str = this.mTextBox.getTextString();
            if (str === "")
                return;
            var renderer = this.mViewerHC.getMarkupManager().getRenderer();
            renderer.drawTextBox(this.mTextBox);
        };
        eDwNameCallout.prototype.setPosition = function (pos) {
            this.mTextBox.setPosition(pos);
        };
        eDwNameCallout.prototype.setText = function (str) {
            this.mTextBox.setTextString(str);
        };
        return eDwNameCallout;
    }(eDwTypes_16.HC.Markup.MarkupItem));
    var eDwSelectionOperator = (function (_super) {
        __extends(eDwSelectionOperator, _super);
        function eDwSelectionOperator(iViewer, iSelMgr) {
            var _this = _super.call(this, iViewer, iSelMgr) || this;
            _this.mPickedHCID = cUnselectableItem;
            _this.mCurMousePos = new eDwTypes_16.HC.Point2(0, 0);
            _this.mDoPickTimeOutHandle = null;
            _this.mNameCallout = new eDwNameCallout(iViewer);
            _this.mViewer.HCViewer.getMarkupManager().registerMarkup(_this.mNameCallout);
            _super.prototype.pushHighlightSelectionState.call(_this, "NODE", true);
            _super.prototype.pushHighlightSelectionState.call(_this, "FACE", true);
            _super.prototype.pushHighlightSelectionState.call(_this, "EDGE", false);
            _super.prototype.pushHighlightSelectionState.call(_this, "VERTEX", false);
            _super.prototype.pushElementSelectionHighlightMode.call(_this, "HighlightAndOutline");
            return _this;
        }
        eDwSelectionOperator.prototype.onMouseUp = function (ioMouseEvent) {
            var selObj = eDwBaseOperator.getPickResult(ioMouseEvent);
            var isOtherSel = selObj && !(selObj.getNodeId());
            if (ioMouseEvent && this.mCurMouse && !isOtherSel) {
                var handled = false;
                var moved = this.hasMouseMoved(ioMouseEvent);
                if (!ioMouseEvent.getHandled() && !this.hasMouseMoved(ioMouseEvent)) {
                    handled = this.onUp(ioMouseEvent.getPosition(), ioMouseEvent.getButton());
                }
                ioMouseEvent.setHandled(handled);
                _super.prototype.onMouseUp.call(this, ioMouseEvent);
            }
        };
        eDwSelectionOperator.prototype.onMouseDown = function (ioMouseEvent) {
            this.updateCallout(cUnselectableItem);
            if (ioMouseEvent) {
                _super.prototype.onMouseDown.call(this, ioMouseEvent);
                ioMouseEvent.setHandled(this.onDown(ioMouseEvent.getPosition(), ioMouseEvent.getButton()));
            }
        };
        eDwSelectionOperator.prototype.onMouseMove = function (ioMouseEvent) {
            this.updateCallout(cUnselectableItem);
            if (!this.mCurMouse && this.mViewer.getModel().isAssembly()) {
                this.updatePos(ioMouseEvent.getPosition());
            }
            if (ioMouseEvent) {
                _super.prototype.onMouseMove.call(this, ioMouseEvent);
                ioMouseEvent.setHandled(this.onMove(ioMouseEvent.getPosition()));
            }
        };
        eDwSelectionOperator.prototype.onTouchStart = function (ioTouchEvent) {
            _super.prototype.onTouchStart.call(this, ioTouchEvent);
            this.onDown(ioTouchEvent.getPosition(), eDwTypes_16.HC.Button.Left);
        };
        eDwSelectionOperator.prototype.onTouchMove = function (ioTouchEvent) {
            var pos = ioTouchEvent.getPosition();
            if (pos.x === Math.round(pos.x) && pos.y === Math.round(pos.y)) {
                _super.prototype.onTouchMove.call(this, ioTouchEvent);
            }
        };
        eDwSelectionOperator.prototype.onTouchEnd = function (ioTouchEvent) {
            if (!ioTouchEvent)
                return;
            if (!this.hasTouchMoved(ioTouchEvent)) {
                if (this.mCurTouches.length === 1) {
                    var curTime = new Date();
                    var startTime = new Date();
                    var touchStart = this.getTouchById(ioTouchEvent.getId());
                    if (touchStart) {
                        startTime = touchStart.origTouch.getDate();
                    }
                    var temp = curTime.getTime() - startTime.getTime();
                    if (curTime.getTime() - startTime.getTime() > 1000) {
                        this.onUp(ioTouchEvent.getPosition(), eDwTypes_16.HC.Button.Right);
                    }
                    else {
                        this.onUp(ioTouchEvent.getPosition(), eDwTypes_16.HC.Button.Left);
                    }
                    ioTouchEvent.setHandled(true);
                }
                else {
                    ioTouchEvent.setHandled(false);
                }
            }
            _super.prototype.onTouchEnd.call(this, ioTouchEvent);
        };
        eDwSelectionOperator.prototype.doPick = function (iCoords) {
            var viewerFeatureOpts = this.mViewer.ViewerFeatureOpts;
            if (this.mViewer.getModel().isDrawing()) {
                this.doPickInDrawing(iCoords);
            }
            else {
                this.doPickIn3D(iCoords);
            }
        };
        eDwSelectionOperator.prototype.updateCallout = function (iNodeHCID) {
            var name = "";
            if (iNodeHCID > 0 && iNodeHCID === this.mPickedHCID) {
                var model = this.mViewer.getModel();
                var hierNode = model.getHierarchyNode(iNodeHCID);
                name = hierNode && hierNode.Name ? hierNode.Name : "Unamed model";
            }
            if (this.mCurMouse) {
                name = "";
            }
            this.mNameCallout.setText(name);
            var offset = new eDwTypes_16.HC.Point2(10, 20);
            var pos = this.mCurMousePos.copy();
            this.mNameCallout.setPosition(eDwTypes_16.HC.Point2.add(pos, offset));
            this.mViewer.HCViewer.getMarkupManager().refreshMarkup();
        };
        eDwSelectionOperator.prototype.updatePos = function (pos) {
            return __awaiter(this, void 0, void 0, function () {
                var viewerHC, markupMgrHC, config, sectionMgrHC, selItem, op;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            this.mCurMousePos = pos.copy();
                            viewerHC = this.mViewer.HCViewer;
                            markupMgrHC = viewerHC.getMarkupManager();
                            config = new eDwTypes_16.HC.PickConfig(eDwTypes_16.HC.SelectionMask.Face);
                            sectionMgrHC = this.mViewer.XSectionMgr.HCXSectionMgr;
                            return [4, viewerHC.getView().pickFromPoint(pos, config)];
                        case 1:
                            selItem = _a.sent();
                            this.mPickedHCID = selItem ? selItem.getNodeId() : cUnselectableItem;
                            op = this;
                            setTimeout(function () {
                                op.updateCallout(op.mPickedHCID);
                            }, 1000);
                            return [2];
                    }
                });
            });
        };
        eDwSelectionOperator.prototype.doPickIn3D = function (iCoords) {
            if (!eDwKeyMgr.get().isDown("Control")) {
                this.mViewer.SelectionMgr.select(iCoords);
            }
            else {
                this.mViewer.SelectionMgr.select(iCoords, undefined, eDwTypes_16.HC.SelectionMode.Add);
            }
        };
        eDwSelectionOperator.prototype.doPickInDrawing = function (iCoords) {
            return __awaiter(this, void 0, void 0, function () {
                var viewerHC, model, modelHC, pickConfig, activeSheet, childHierarchy, children, viewIDs, i, currentNode, selItem, hierNode;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            viewerHC = this.mViewer.HCViewer;
                            model = this.mViewer.getModel();
                            modelHC = model.getHCModel();
                            pickConfig = new eDwTypes_16.HC.PickConfig(eDwTypes_16.HC.SelectionMask.All);
                            activeSheet = model.getActiveModelView();
                            childHierarchy = activeSheet.Hierarchy.getChildren();
                            children = Object.keys(childHierarchy);
                            viewIDs = [];
                            for (i = 0; i < children.length; i++) {
                                currentNode = childHierarchy[children[i]];
                                viewIDs.push(currentNode.HOOPSID);
                            }
                            return [4, viewerHC.getView().pickFromPoint(iCoords, pickConfig)];
                        case 1:
                            selItem = _a.sent();
                            if ("undefined" === typeof selItem || !selItem.getNodeId()) {
                                this.doPickIn3D(iCoords);
                                return [2, new Promise(function () { })];
                            }
                            hierNode = model.getHierarchyNode(selItem.getNodeId());
                            if (hierNode) {
                                if (viewIDs.indexOf(hierNode.HOOPSID) > -1) {
                                    this.mViewer.SelectionMgr.selectByID(hierNode.HOOPSID);
                                }
                            }
                            return [2];
                    }
                });
            });
        };
        eDwSelectionOperator.prototype.clearPickTimeOut = function () {
            if (this.mDoPickTimeOutHandle) {
                clearTimeout(this.mDoPickTimeOutHandle);
                this.mDoPickTimeOutHandle = null;
            }
        };
        eDwSelectionOperator.prototype.onUp = function (iCoord, iButton) {
            var _this = this;
            var eventMgr = eDwEventMgr.get();
            if (iButton === eDwTypes_16.HC.Button.Left) {
                this.doPick(iCoord);
                if (!this.mDoPickTimeOutHandle) {
                    this.mDoPickTimeOutHandle = setTimeout(function () {
                        _this.clearPickTimeOut();
                        eventMgr.fireEvents("LeftClick", _this.mViewer, iCoord);
                    }, 500);
                }
                else {
                    this.clearPickTimeOut();
                    eventMgr.fireEvents("LeftDoubleClick", this.mViewer, iCoord);
                }
                return true;
            }
            else if (iButton === eDwTypes_16.HC.Button.Right) {
                this.clearPickTimeOut();
                this.doPick(iCoord);
                eventMgr.fireEvents("RightClick", this.mViewer, iCoord);
                return true;
            }
            return false;
        };
        eDwSelectionOperator.prototype.onDown = function (iCoord, iButton) {
            var handled = false;
            var isDrawing = this.mViewer.getModel().isDrawing();
            if (!isDrawing || (isDrawing && iButton == eDwTypes_16.HC.Button.Right)) {
                this.mDragPt = eDwBaseOperator.screenToWorld(iCoord, this.mViewer.getHCView());
            }
            else {
                handled = true;
            }
            return handled;
        };
        eDwSelectionOperator.prototype.onMove = function (iCoord) {
            return !this.mCurMouse;
        };
        return eDwSelectionOperator;
    }(eDwBaseSelOperator));
    function isLeft(iP0, iP1, iP2) {
        return (iP1.x - iP0.x) * (iP2.y - iP0.y) -
            (iP2.x - iP0.x) * (iP1.y - iP0.y);
    }
    return eDwSelectionOperator;
});
define("eDwSelIsolateCmd", ["require", "exports", "eDwTypes", "eDwSupportsHistoryCmd", "eDrawingsBase"], function (require, exports, eDwTypes_17, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwSelIsolateCmd = (function (_super) {
        __extends(eDwSelIsolateCmd, _super);
        function eDwSelIsolateCmd(iViewer) {
            return _super.call(this, iViewer) || this;
        }
        eDwSelIsolateCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.setHierarchyNodeIDsAttribs(this.mInitialNodeIDsAttribs);
            this.mViewer.ViewMgr.setCamera(this.mInitialViewCamera);
            return true;
        };
        eDwSelIsolateCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.setHierarchyNodeIDsAttribs(this.mFinalNodeIDsAttribs);
            this.mViewer.ViewMgr.setCamera(this.mFinalViewCamera);
            return true;
        };
        eDwSelIsolateCmd.prototype.commit = function () {
            var _this = this;
            _super.prototype.commit.call(this);
            this.mInitialNodeIDsAttribs = this.getHierarchyNodesAttribs();
            var viewHC = this.mViewer.getHCView();
            this.mInitialViewCamera = viewHC.getCamera().copy();
            (function () { return __awaiter(_this, void 0, void 0, function () {
                var selMgr, selHierNodes, model, modelView, hierNodes, invisHierNodes, selHCIDs, modelHC, bbox;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            selMgr = this.mViewer.SelectionMgr;
                            selHierNodes = selMgr.getSelHierarchyNodes();
                            model = this.mViewer.getModel();
                            modelView = model.getActiveModelView();
                            hierNodes = modelView.getNodes();
                            hierNodes.shift();
                            invisHierNodes = hierNodes.filter(function (hierNode) {
                                return selHierNodes.indexOf(hierNode) === -1;
                            });
                            return [4, model.setAttribOnHierNodes(invisHierNodes, { Visible: false })];
                        case 1:
                            _a.sent();
                            selHCIDs = selMgr.getSelectableHCIDs();
                            modelHC = this.mViewer.getModel().getHCModel();
                            return [4, modelHC.getNodesBounding(selHCIDs)];
                        case 2:
                            bbox = _a.sent();
                            if (!(bbox && eDwTypes_17.HC.Point3.distance(bbox.max, bbox.min) > 1e-3)) return [3, 4];
                            return [4, this.mViewer.getHCView().isolateNodes(selHCIDs)];
                        case 3:
                            _a.sent();
                            _a.label = 4;
                        case 4:
                            this.mFinalNodeIDsAttribs = this.getHierarchyNodesAttribs();
                            this.mFinalViewCamera = viewHC.getCamera().copy();
                            return [2];
                    }
                });
            }); })();
        };
        eDwSelIsolateCmd.prototype.isCommitted = function () {
            return _super.prototype.isCommitted.call(this) && !!this.mInitialViewCamera &&
                !!this.mFinalNodeIDsAttribs;
        };
        Object.defineProperty(eDwSelIsolateCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        return eDwSelIsolateCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwSelIsolateCmd;
});
define("eDwSelMgr", ["require", "exports", "eDwSelectionOperator", "eDwEventMgr", "eDwKeyMgr", "eDrawingsBase"], function (require, exports, eDwSelectionOperator, eDwEventMgr, eDwKeyMgr) {
    "use strict";
    var eDwSelMgr = (function () {
        function eDwSelMgr(iViewer) {
            iViewer.SelectionMgr = this;
            this.mViewer = iViewer;
            this.mHCSelMgr = iViewer.HCViewer.getSelectionManager();
            this.mSelectableHCObjs = [];
            var selectOp = new eDwSelectionOperator(iViewer, this);
            var opMgr = this.mViewer.OperatorMgr;
            this.mSelectOperatorID = opMgr.registerCustomOperator(selectOp, true);
            this.mSelectOverlayNotifiers = {};
        }
        eDwSelMgr.prototype.setColorForViewMode = function (mode) {
            var nodeSelColor;
            var nodeSelOutlineColor = new Communicator.Color(0, 255, 0);
            var nodeElmtSelColor;
            var nodeElmtSelOutlineColor = new Communicator.Color(255, 255, 0);
            var beautifulGreen = new Communicator.Color(4, 200, 5);
            switch (mode) {
                case Communicator.DrawMode.WireframeOnShaded:
                    nodeSelColor = beautifulGreen;
                    nodeElmtSelColor = beautifulGreen;
                    break;
                case Communicator.DrawMode.Shaded:
                    nodeSelColor = beautifulGreen;
                    nodeElmtSelColor = beautifulGreen;
                    break;
                case Communicator.DrawMode.Wireframe:
                case Communicator.DrawMode.HiddenLine:
                    nodeSelColor = Communicator.Color.white();
                    nodeElmtSelColor = Communicator.Color.white();
                    break;
                default:
                    var msg = "Unknown draw mode: " + mode;
                    console.debugLog("Selection", msg);
                    throw new Error(msg);
            }
            this.mHCSelMgr.setNodeSelectionColor(nodeSelColor);
            this.mHCSelMgr.setNodeSelectionOutlineColor(nodeSelOutlineColor);
            this.mHCSelMgr.setNodeElementSelectionColor(nodeElmtSelColor);
            this.mHCSelMgr.setNodeElementSelectionOutlineColor(nodeElmtSelOutlineColor);
            if (this.mViewer.getModel().isDrawing() &&
                !this.mViewer.ViewerFeatureOpts.Debug) {
                this.mHCSelMgr.setNodeSelectionHighlightMode(Communicator.SelectionHighlightMode.OutlineOnly);
                this.mHCSelMgr.setHighlightNodeSelection(false);
            }
        };
        eDwSelMgr.prototype.unregister = function () {
            this.mViewer.OperatorMgr.unregisterCustomOperatorByID(this.mSelectOperatorID);
            this.mViewer.SelectionMgr = null;
        };
        eDwSelMgr.prototype.addSelectOverlayNotifier = function (iTypeIndex, iNotifier) {
            if (!this.mSelectOverlayNotifiers[iTypeIndex]) {
                this.mSelectOverlayNotifiers[iTypeIndex] = [];
            }
            this.mSelectOverlayNotifiers[iTypeIndex].push(iNotifier);
        };
        eDwSelMgr.prototype.onSelection = function (iPartSelectionEvent) {
            var ctrlKeyDown = eDwKeyMgr.get().isDown("Control");
            var existingIdx = -1;
            var selObj = this.getHCSelectionObj(iPartSelectionEvent.getSelection());
            if (selObj) {
                var idx = 0;
                for (var _i = 0, _a = this.mSelectableHCObjs; _i < _a.length; _i++) {
                    var existingSelObj = _a[_i];
                    if (selObj === existingSelObj || selObj.equals(existingSelObj)) {
                        existingIdx = idx;
                        break;
                    }
                    idx++;
                }
            }
            var isDrawing = this.mViewer.getModel().isDrawing();
            if (this.mSelectableHCObjs.length > 0 && !ctrlKeyDown) {
                this.unSelectObjs(this.mSelectableHCObjs, isDrawing);
                this.mSelectableHCObjs = [];
            }
            else if (ctrlKeyDown && existingIdx > -1 && selObj) {
                this.mSelectableHCObjs.splice(existingIdx, 1);
                this.unSelectObjs([selObj], isDrawing);
                return;
            }
            if (selObj) {
                var modelView = this.mViewer.getModel().getActiveModelView();
                var node = modelView.Nodes[selObj.getNodeId()];
                if (node && isDrawing) {
                    this.mHCSelMgr.remove(selObj);
                    node.selectBoundingBox(this.mViewer);
                }
                this.mSelectableHCObjs.push(selObj);
                eDwEventMgr.get().fireEvents("Select", this.mViewer, selObj);
            }
        };
        eDwSelMgr.prototype.selectByID = function (iID) {
            var ret = true;
            try {
                if (!eDwKeyMgr.get().isDown("Control")) {
                    this.mHCSelMgr.selectNode(iID);
                }
                else {
                    this.mHCSelMgr.selectNode(iID, Communicator.SelectionMode.Add);
                }
            }
            catch (iErr) {
                console.log("eDwSelMgr.selectByID failed");
                ret = false;
            }
            return ret;
        };
        eDwSelMgr.prototype.select = function (iCoords, iPickConfig, iSelMode) {
            var _this = this;
            if (iSelMode === void 0) { iSelMode = Communicator.SelectionMode.Set; }
            var pickCfg = iPickConfig ? iPickConfig : new Communicator.PickConfig(Communicator.SelectionMask.Face);
            var viewHC = this.mViewer.getHCView();
            (function () { return __awaiter(_this, void 0, void 0, function () {
                var selItem;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, viewHC.pickFromPoint(iCoords, pickCfg)];
                        case 1:
                            selItem = _a.sent();
                            if (this.isSelectionHandled(selItem)) {
                                return [2];
                            }
                            if (iSelMode === Communicator.SelectionMode.Set) {
                                this.mHCSelMgr.set(selItem);
                            }
                            else if (iSelMode === Communicator.SelectionMode.Add) {
                                this.mHCSelMgr.add(selItem);
                            }
                            return [2];
                    }
                });
            }); })();
        };
        eDwSelMgr.prototype.isSelected = function (iHCNodeID) {
            return this.getSelectableHCIDs().indexOf(iHCNodeID) < 0 ? false
                : true;
        };
        eDwSelMgr.prototype.append = function (iSelObj) {
            this.mHCSelMgr.add(iSelObj);
        };
        eDwSelMgr.prototype.unSelectAllObjects = function () {
            if (this.mSelectableHCObjs.length > 0) {
                var viewer = this.mViewer;
                var selMgr = this;
                for (var _i = 0, _a = this.mSelectableHCObjs; _i < _a.length; _i++) {
                    var selObj = _a[_i];
                    eDwEventMgr.get().fireEvents("Unselect", viewer, selMgr.getHCSelectionObj(selObj));
                }
                this.mHCSelMgr.selectNode(null);
                this.mSelectableHCObjs = [];
            }
        };
        eDwSelMgr.prototype.setViewToSelectedFace = function () {
            var camera = null;
            var selObjs = this.mHCSelMgr.getResults();
            for (var _i = 0, selObjs_1 = selObjs; _i < selObjs_1.length; _i++) {
                var selObj = selObjs_1[_i];
                var faceObj = selObj.getFaceEntity();
                if (faceObj) {
                    camera = this.mViewer.ViewMgr.setViewOrientationToDirection(faceObj.getNormal());
                    break;
                }
            }
            return camera;
        };
        eDwSelMgr.prototype.getLastSelHCID = function () {
            var selHCIDs = this.getSelectableHCIDs();
            if (selHCIDs.length > 0) {
                return selHCIDs[selHCIDs.length - 1];
            }
            return new RangeError("nothing selected");
        };
        eDwSelMgr.prototype.getSelHierarchyNodes = function () {
            var selHierNodes = [];
            var modelView = this.mViewer.getModel().getActiveModelView();
            var selHCIDs = this.getSelectableHCIDs();
            for (var _i = 0, selHCIDs_1 = selHCIDs; _i < selHCIDs_1.length; _i++) {
                var selNodeID = selHCIDs_1[_i];
                selHierNodes.push(modelView.Nodes[selNodeID]);
            }
            return selHierNodes;
        };
        eDwSelMgr.prototype.getSelectableHCIDs = function () {
            var model = this.mViewer.getModel();
            var selHCIDs = [];
            for (var _i = 0, _a = this.mSelectableHCObjs; _i < _a.length; _i++) {
                var selObj = _a[_i];
                selHCIDs.push(selObj.getNodeId());
            }
            return selHCIDs;
        };
        eDwSelMgr.prototype.isIDSelectable = function (iNodeIDHC) {
            var modelView = this.mViewer.getModel().getActiveModelView();
            var hierNode = modelView ? modelView.Nodes[iNodeIDHC] : null;
            return hierNode ? hierNode.isSelectable() : false;
        };
        eDwSelMgr.prototype.setHighlightSelection = function (iType, iEnable) {
            var highlighted;
            var selMgr = this.mHCSelMgr;
            if (iType === "NODE") {
                highlighted = selMgr.getHighlightNodeSelection();
                selMgr.setHighlightNodeSelection(iEnable);
            }
            else if (iType === "FACE") {
                highlighted = selMgr.getHighlightFaceElementSelection();
                selMgr.setHighlightFaceElementSelection(iEnable);
            }
            else if (iType === "EDGE") {
                highlighted = selMgr.getHighlightLineElementSelection();
                selMgr.setHighlightLineElementSelection(iEnable);
            }
            else if (iType === "VERTEX") {
                highlighted = selMgr.getHighlightPointElementSelection();
                selMgr.setHighlightPointElementSelection(iEnable);
            }
            else {
                console.debugLog("Selection", "Unknown selection type: " + iType);
            }
            return highlighted;
        };
        eDwSelMgr.prototype.setNodeSelectionHighlightMode = function (iSelHighlightMode) {
            var mapping = {};
            var revMapping = {};
            this.initMappings(mapping, revMapping);
            this.mHCSelMgr.setNodeSelectionHighlightMode(mapping[iSelHighlightMode]);
            return (revMapping[this.mHCSelMgr.getNodeSelectionHighlightMode()]);
        };
        eDwSelMgr.prototype.setNodeSelectionColor = function (iColor) {
            var oldColor = this.mHCSelMgr.getNodeSelectionColor();
            this.mHCSelMgr.setNodeSelectionColor(iColor);
            return oldColor;
        };
        eDwSelMgr.prototype.setNodeSelectionOutlineColor = function (iColor) {
            var oldColor = this.mHCSelMgr.getNodeSelectionOutlineColor();
            this.mHCSelMgr.setNodeSelectionOutlineColor(iColor);
            return oldColor;
        };
        eDwSelMgr.prototype.setElementSelectionHighlightMode = function (iSelHighlightMode) {
            var mapping = {};
            var revMapping = {};
            this.initMappings(mapping, revMapping);
            this.mHCSelMgr.setNodeElementSelectionHighlightMode(mapping[iSelHighlightMode]);
            return (revMapping[this.mHCSelMgr.getNodeElementSelectionHighlightMode()]);
        };
        eDwSelMgr.prototype.setElementSelectionColor = function (iColor) {
            var oldColor = this.mHCSelMgr.getNodeElementSelectionColor();
            this.mHCSelMgr.setNodeElementSelectionColor(iColor);
            return oldColor;
        };
        eDwSelMgr.prototype.setElementSelectionOutlineColor = function (iColor) {
            var oldColor = this.mHCSelMgr.getNodeElementSelectionOutlineColor();
            this.mHCSelMgr.setNodeElementSelectionOutlineColor(iColor);
            return oldColor;
        };
        eDwSelMgr.prototype.initMappings = function (ioMapping, ioRevMapping) {
            var HCM = Communicator.SelectionHighlightMode;
            ioRevMapping[ioMapping["Highlight"] = HCM.HighlightOnly] = "Highlight";
            ioMapping["HighlightAndOutline"] = HCM.HighlightAndOutline;
            ioRevMapping[HCM.HighlightAndOutline] = "HighlightAndOutline";
            ioRevMapping[ioMapping["Outline"] = HCM.OutlineOnly] = "Outline";
        };
        eDwSelMgr.prototype.getHCSelectionObj = function (iSelObj) {
            var hierNode = this.mViewer.getModel().getHierarchyNode(iSelObj.getNodeId());
            var selection = null;
            if (hierNode) {
                selection = Communicator.Selection.SelectionItem.create(hierNode.HOOPSID, iSelObj.getIncludeId(), iSelObj.getFaceEntity(), iSelObj.getLineEntity(), iSelObj.getPointEntity());
            }
            return selection;
        };
        eDwSelMgr.prototype.isSelectionHandled = function (iSelObj) {
            var notifiers = this.mSelectOverlayNotifiers[iSelObj.overlayIndex()];
            if (!notifiers)
                return false;
            for (var _i = 0, notifiers_1 = notifiers; _i < notifiers_1.length; _i++) {
                var notifier = notifiers_1[_i];
                if (notifier.onSelect(iSelObj))
                    return true;
            }
            return false;
        };
        eDwSelMgr.prototype.unSelectObjs = function (iSelObjs, iIs2D) {
            var modelView = this.mViewer.getModel().getActiveModelView();
            for (var _i = 0, iSelObjs_1 = iSelObjs; _i < iSelObjs_1.length; _i++) {
                var selObj = iSelObjs_1[_i];
                eDwEventMgr.get().fireEvents("Unselect", this.mViewer, selObj);
                var node = modelView.Nodes[selObj.getNodeId()];
                if (node && iIs2D)
                    node.unSelectBoundingBox(this.mViewer);
            }
        };
        return eDwSelMgr;
    }());
    ;
    return eDwSelMgr;
});
define("eDwServiceMgr", ["require", "exports", "jquery", "jquery-ajax-native"], function (require, exports, $) {
    "use strict";
    var eDwServiceMgr = (function () {
        function eDwServiceMgr(iServerURL, iDisable) {
            this.mServerURL = iServerURL.replace(/(\/*)$/, "");
            this.mAdvancedServicesDisabled = iDisable;
        }
        eDwServiceMgr.create = function (iServerURL, iDisable) {
            if (iDisable === void 0) { iDisable = false; }
            if (!eDwServiceMgr.sServiceMgr) {
                eDwServiceMgr.sServiceMgr = new eDwServiceMgr(iServerURL, iDisable);
            }
        };
        eDwServiceMgr.get = function () {
            return eDwServiceMgr.sServiceMgr;
        };
        eDwServiceMgr.prototype.disableAdvancedServices = function (iDisable) {
            if (iDisable === void 0) { iDisable = true; }
            this.mAdvancedServicesDisabled = iDisable;
        };
        eDwServiceMgr.prototype.readMarkup = function (iModelKey, iFileName) {
            return __awaiter(this, void 0, void 0, function () {
                var fileInfo;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            alert("See comment in the code about reading markup");
                            return [4, this.getFileFromServerModelCache(iModelKey, iFileName)];
                        case 1:
                            fileInfo = _a.sent();
                            return [2, fileInfo.Data];
                    }
                });
            });
        };
        eDwServiceMgr.prototype.writeMarkup = function (iParams) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            alert("See comment in the code about writing markup");
                            if (this.mAdvancedServicesDisabled)
                                return [2];
                            return [4, this.ajax("POST", "EDrawingsService.svc/SaveToCache", iParams)];
                        case 1: return [2, _a.sent()];
                    }
                });
            });
        };
        eDwServiceMgr.prototype.getFileFromServer = function (iFileURL, iLoadAsNativeType) {
            if (iLoadAsNativeType === void 0) { iLoadAsNativeType = false; }
            return __awaiter(this, void 0, void 0, function () {
                var jqNativePlugin, _a, iExcp_8;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            if (this.mAdvancedServicesDisabled)
                                return [2, null];
                            _b.label = 1;
                        case 1:
                            _b.trys.push([1, 6, , 7]);
                            jqNativePlugin = $;
                            if (!iLoadAsNativeType) return [3, 3];
                            return [4, jqNativePlugin.getNative(iFileURL)];
                        case 2:
                            _a = _b.sent();
                            return [3, 5];
                        case 3: return [4, $.get(iFileURL)];
                        case 4:
                            _a = _b.sent();
                            _b.label = 5;
                        case 5: return [2, _a];
                        case 6:
                            iExcp_8 = _b.sent();
                            return [3, 7];
                        case 7: return [2, null];
                    }
                });
            });
        };
        eDwServiceMgr.prototype.getFileFromServerModelCache = function (iModelKey, iFileName) {
            return __awaiter(this, void 0, void 0, function () {
                var fileInfo, baseCacheDirs, _i, baseCacheDirs_1, dir, fileURL, _a, iExcp_9;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            fileInfo = { Path: "" };
                            if (this.mAdvancedServicesDisabled)
                                return [2, fileInfo];
                            return [4, this.getBaseCacheDirs()];
                        case 1:
                            baseCacheDirs = _b.sent();
                            _i = 0, baseCacheDirs_1 = baseCacheDirs;
                            _b.label = 2;
                        case 2:
                            if (!(_i < baseCacheDirs_1.length)) return [3, 7];
                            dir = baseCacheDirs_1[_i];
                            fileURL = dir + "/" + iModelKey + "/" + iFileName;
                            _b.label = 3;
                        case 3:
                            _b.trys.push([3, 5, , 6]);
                            _a = fileInfo;
                            return [4, this.getFileFromServer(fileURL)];
                        case 4:
                            _a.Data = _b.sent();
                            fileInfo.Path = this.mServerURL + "/" + fileURL;
                            return [2, fileInfo];
                        case 5:
                            iExcp_9 = _b.sent();
                            return [3, 6];
                        case 6:
                            _i++;
                            return [3, 2];
                        case 7: return [2, fileInfo];
                    }
                });
            });
        };
        eDwServiceMgr.prototype.getClientPublicIP = function (iGetClientPublicIP) {
            return __awaiter(this, void 0, void 0, function () {
                var ret, iExcp_10;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!iGetClientPublicIP || this.mAdvancedServicesDisabled)
                                return [2, null];
                            ret = "";
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            return [4, $.get("https://api.ipify.org", "", $.noop(), "text")];
                        case 2:
                            ret = _a.sent();
                            return [3, 4];
                        case 3:
                            iExcp_10 = _a.sent();
                            console.warn("Failed to get client public IP: " + iExcp_10.message);
                            return [3, 4];
                        case 4: return [2, ret];
                    }
                });
            });
        };
        eDwServiceMgr.prototype.convert = function (iClientIP, ioParams) {
            return __awaiter(this, void 0, void 0, function () {
                var result, params;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            result = {
                                FileName: ioParams.URL,
                                ModelCacheName: "",
                                ErrorCode: "",
                                ErrorData: [],
                                ServerID: ""
                            };
                            if (!(ioParams.URL.indexOf('http') === 0 &&
                                !this.mAdvancedServicesDisabled)) return [3, 2];
                            params = {
                                data: { "iFileURL": ioParams.URL },
                                headers: { "X-Forwarded-For": iClientIP },
                                cache: false
                            };
                            return [4, this.ajax("GET", "EDrawingsService.svc/Conversion", params)];
                        case 1:
                            result = _a.sent();
                            return [3, 3];
                        case 2:
                            ioParams.URL = "";
                            _a.label = 3;
                        case 3: return [2, result];
                    }
                });
            });
        };
        eDwServiceMgr.prototype.removeNamedCache = function (iModelKey, iAllowRemove) {
            return __awaiter(this, void 0, void 0, function () {
                var iExcp_11;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!iAllowRemove || this.mAdvancedServicesDisabled)
                                return [2];
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            return [4, this.ajax("GET", "EDrawingsService.svc/RemoveNamedCache", { data: { "iModelKey": iModelKey } })];
                        case 2:
                            _a.sent();
                            return [3, 4];
                        case 3:
                            iExcp_11 = _a.sent();
                            console.warn("Could not remove the cache: " + iModelKey);
                            console.warn(iExcp_11.message);
                            throw iExcp_11;
                        case 4: return [2];
                    }
                });
            });
        };
        eDwServiceMgr.prototype.getWebSocketEndpoint = function (iModelKey, iWSEndPt) {
            return __awaiter(this, void 0, void 0, function () {
                var params, ws, iExpc_1;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (this.mAdvancedServicesDisabled)
                                return [2, ""];
                            if (iWSEndPt) {
                                this.disableAdvancedServices();
                                return [2, iWSEndPt];
                            }
                            params = {
                                data: { iModelCacheName: iModelKey },
                                cache: false
                            };
                            ws = "";
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            return [4, this.ajax("GET", "EDrawingsService.svc/GetWSEndpoint", params)];
                        case 2:
                            ws = _a.sent();
                            return [3, 4];
                        case 3:
                            iExpc_1 = _a.sent();
                            console.warn("Cannot get WebSocket.");
                            return [3, 4];
                        case 4: return [2, ws];
                    }
                });
            });
        };
        eDwServiceMgr.prototype.load = function (iElemOrClassID, iPanelHTML) {
            return __awaiter(this, void 0, void 0, function () {
                var loadedHTML;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.ajax("GET", iPanelHTML, { dataType: "html" })];
                        case 1:
                            loadedHTML = _a.sent();
                            $(iElemOrClassID).html(loadedHTML);
                            return [2];
                    }
                });
            });
        };
        eDwServiceMgr.prototype.fileUpload = function (iJQObj, iParams) {
            if (this.mAdvancedServicesDisabled)
                return;
            var paramsObj = {
                url: this.mServerURL + "/EDrawingsService.svc/FileUploadConversion"
            };
            if (iParams)
                $.extend(paramsObj, iParams);
            iJQObj.fileupload(paramsObj);
        };
        eDwServiceMgr.prototype.getBaseCacheDirs = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!(this.mBaseCacheDirs === undefined)) return [3, 2];
                            this.mBaseCacheDirs = [];
                            this.mGetBaseCacheDirsPromise = $.get("cacheDirs.xml", function (iDoc) {
                                var cacheDirs = iDoc.getElementsByTagName("modelSearchDirectory");
                                var numDirs = cacheDirs.length;
                                for (var i = 0; i < numDirs; ++i) {
                                    var cacheDir = cacheDirs[i].textContent.split("/").pop();
                                    _this.mBaseCacheDirs.push(cacheDir);
                                    console.debugLog("ServiceMgr", "Added cache dir: " + cacheDir);
                                }
                            }, "xml").fail(function (iJQXHR, iStatus, iError) {
                                console.warn("Could not get model cache directories: " +
                                    iStatus + ": " + iError);
                            });
                            return [4, this.mGetBaseCacheDirsPromise];
                        case 1:
                            _a.sent();
                            return [3, 4];
                        case 2: return [4, this.mGetBaseCacheDirsPromise];
                        case 3:
                            _a.sent();
                            _a.label = 4;
                        case 4: return [2, this.mBaseCacheDirs];
                    }
                });
            });
        };
        eDwServiceMgr.prototype.ajax = function (iMethod, iService, iParams) {
            return __awaiter(this, void 0, void 0, function () {
                var paramsObj, retAJAX, iExcp_12;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (this.mAdvancedServicesDisabled)
                                return [2, null];
                            paramsObj = {
                                type: iMethod,
                                url: this.mServerURL + "/" + iService,
                                async: true
                            };
                            if (iParams)
                                $.extend(paramsObj, iParams);
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            return [4, $.ajax(paramsObj)];
                        case 2:
                            retAJAX = _a.sent();
                            return [3, 4];
                        case 3:
                            iExcp_12 = _a.sent();
                            console.warn("AJAX " + iMethod + " failed for " + iService + ": " +
                                iExcp_12.message);
                            throw iExcp_12;
                        case 4: return [2, retAJAX];
                    }
                });
            });
        };
        return eDwServiceMgr;
    }());
    ;
    return eDwServiceMgr;
});
define("eDwSetHierNodeAttribsCmd", ["require", "exports", "eDwSupportsHistoryCmd", "eDrawingsBase"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwSetHierNodeAttribsCmd = (function (_super) {
        __extends(eDwSetHierNodeAttribsCmd, _super);
        function eDwSetHierNodeAttribsCmd(iViewer, iHierNodes, iAttrib) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitialHierNodeAttribs = [];
            _this.mFinalHierNodeAttribs = [];
            var finalAttrib = $.extend(true, {}, iAttrib);
            for (var _i = 0, iHierNodes_2 = iHierNodes; _i < iHierNodes_2.length; _i++) {
                var hierNode = iHierNodes_2[_i];
                var initialAttrib = $.extend(true, {}, hierNode.getAttribs());
                _this.mInitialHierNodeAttribs.push({ HierNode: hierNode, Attribs: initialAttrib });
                _this.mFinalHierNodeAttribs.push({ HierNode: hierNode, Attribs: finalAttrib });
            }
            return _this;
        }
        eDwSetHierNodeAttribsCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            var modelHC = this.mViewer.getModel().getHCModel();
            this.mViewer.getModel().setAttribs(this.mInitialHierNodeAttribs);
            return true;
        };
        eDwSetHierNodeAttribsCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.mViewer.getModel().setAttribs(this.mFinalHierNodeAttribs);
            return true;
        };
        eDwSetHierNodeAttribsCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            this.mViewer.getModel().setAttribs(this.mFinalHierNodeAttribs);
        };
        Object.defineProperty(eDwSetHierNodeAttribsCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        return eDwSetHierNodeAttribsCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwSetHierNodeAttribsCmd;
});
define("eDwSetNodeVisibilityCmd", ["require", "exports", "eDwSupportsHistoryCmd", "eDrawingsBase"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwSetNodeVisibilityCmd = (function (_super) {
        __extends(eDwSetNodeVisibilityCmd, _super);
        function eDwSetNodeVisibilityCmd(iViewer, iNodeIDs, iVisible) {
            var _this = _super.call(this, iViewer) || this;
            _this.mNodeIDs = iNodeIDs;
            _this.mVisible = iVisible;
            var modelHC = _this.mViewer.getModel().getHCModel();
            _this.mNodeIDVisMap = {};
            for (var _i = 0, iNodeIDs_1 = iNodeIDs; _i < iNodeIDs_1.length; _i++) {
                var nodeID = iNodeIDs_1[_i];
                _this.mNodeIDVisMap[nodeID] = modelHC.getNodeVisibility(nodeID);
            }
            return _this;
        }
        eDwSetNodeVisibilityCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            var modelHC = this.mViewer.getModel().getHCModel();
            modelHC.setNodesVisibilities(this.mNodeIDVisMap);
            return true;
        };
        eDwSetNodeVisibilityCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            var modelHC = this.mViewer.getModel().getHCModel();
            modelHC.setNodesVisibility(this.mNodeIDs, this.mVisible);
            return true;
        };
        eDwSetNodeVisibilityCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            var modelHC = this.mViewer.getModel().getHCModel();
            modelHC.setNodesVisibility(this.mNodeIDs, this.mVisible);
        };
        Object.defineProperty(eDwSetNodeVisibilityCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        return eDwSetNodeVisibilityCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwSetNodeVisibilityCmd;
});
define("eDwSetViewCameraCmd", ["require", "exports", "eDwSupportsHistoryCmd", "eDrawingsBase"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwSetViewCameraCmd = (function (_super) {
        __extends(eDwSetViewCameraCmd, _super);
        function eDwSetViewCameraCmd(iViewer) {
            return _super.call(this, iViewer) || this;
        }
        eDwSetViewCameraCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.mViewer.ViewMgr.setCamera(this.mInitialViewCamera);
            return true;
        };
        eDwSetViewCameraCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.mViewer.ViewMgr.setCamera(this.mFinalViewCamera);
            return true;
        };
        eDwSetViewCameraCmd.prototype.commit = function () {
            if (this.mViewer.getModel().isDrawing())
                return;
            _super.prototype.commit.call(this);
            var viewHC = this.mViewer.getHCView();
            this.mInitialViewCamera = viewHC.getCamera();
            this.mFinalViewCamera = this.setView();
        };
        eDwSetViewCameraCmd.prototype.isCommitted = function () {
            return _super.prototype.isCommitted.call(this) && !!this.mInitialViewCamera &&
                !!this.mFinalViewCamera;
        };
        Object.defineProperty(eDwSetViewCameraCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        eDwSetViewCameraCmd.prototype.setView = function () {
            return this.mViewer.SelectionMgr.setViewToSelectedFace();
        };
        return eDwSetViewCameraCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwSetViewCameraCmd;
});
define("eDwSetViewCmd", ["require", "exports", "eDwSetViewCameraCmd", "eDrawingsBase"], function (require, exports, eDwSetViewCameraCmd) {
    "use strict";
    var eDwSetViewCmd = (function (_super) {
        __extends(eDwSetViewCmd, _super);
        function eDwSetViewCmd(iViewer, iOrientation) {
            var _this = _super.call(this, iViewer) || this;
            _this.mViewOrientation = iOrientation;
            return _this;
        }
        eDwSetViewCmd.prototype.setView = function () {
            return this.mViewer.ViewMgr.setViewOrientation(this.mViewOrientation);
        };
        return eDwSetViewCmd;
    }(eDwSetViewCameraCmd));
    ;
    return eDwSetViewCmd;
});
define("eDwSetViewNormalToSectionCmd", ["require", "exports", "eDwSupportsHistoryCmd", "eDrawingsBase"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwSetViewNormalToSectionCmd = (function (_super) {
        __extends(eDwSetViewNormalToSectionCmd, _super);
        function eDwSetViewNormalToSectionCmd(iViewer) {
            return _super.call(this, iViewer) || this;
        }
        eDwSetViewNormalToSectionCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.mViewer.ViewMgr.setCamera(this.mInitialCamera);
            return true;
        };
        eDwSetViewNormalToSectionCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.mViewer.ViewMgr.setCamera(this.mFinalCamera);
            return true;
        };
        eDwSetViewNormalToSectionCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            var viewHC = this.mViewer.getHCView();
            this.mInitialCamera = viewHC.getCamera();
            this.mFinalCamera = this.mViewer.XSectionMgr.setViewToSectionPlane();
        };
        Object.defineProperty(eDwSetViewNormalToSectionCmd.prototype, "Committed", {
            get: function () {
                return _super.prototype.isCommitted.call(this) && !!this.mInitialCamera &&
                    !!this.mFinalCamera;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(eDwSetViewNormalToSectionCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        return eDwSetViewNormalToSectionCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwSetViewNormalToSectionCmd;
});
define("eDwShowSectionCapCmd", ["require", "exports", "eDwSupportsHistoryCmd"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwShowSectionCapCmd = (function (_super) {
        __extends(eDwShowSectionCapCmd, _super);
        function eDwShowSectionCapCmd(iViewer, iVisible) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitialVisibility = _this.mViewer.XSectionMgr.SectionCapVisibility;
            _this.mFinalVisibility = iVisible;
            return _this;
        }
        eDwShowSectionCapCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.mViewer.XSectionMgr.SectionCapVisibility = this.mInitialVisibility;
            return true;
        };
        eDwShowSectionCapCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.mViewer.XSectionMgr.SectionCapVisibility = this.mFinalVisibility;
            return true;
        };
        eDwShowSectionCapCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            this.mViewer.XSectionMgr.SectionCapVisibility = this.mFinalVisibility;
        };
        Object.defineProperty(eDwShowSectionCapCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        return eDwShowSectionCapCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwShowSectionCapCmd;
});
define("eDwSupportsHistoryCmd", ["require", "exports", "eDwHistoryMgr", "eDwCmd"], function (require, exports, eDwHistoryMgr, eDwCmd) {
    "use strict";
    var eDwSupportsHistoryCmd = (function (_super) {
        __extends(eDwSupportsHistoryCmd, _super);
        function eDwSupportsHistoryCmd(iViewer) {
            var _this = _super.call(this, iViewer) || this;
            _this.mAddedToHistory = false;
            _this.mUndone = false;
            return _this;
        }
        eDwSupportsHistoryCmd.prototype.undo = function () {
            var ret = this.isCommitted() && !this.isUndone();
            this.mUndone = true;
            return ret;
        };
        eDwSupportsHistoryCmd.prototype.redo = function () {
            var ret = this.isCommitted() && this.isUndone();
            this.mUndone = false;
            return ret;
        };
        eDwSupportsHistoryCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            eDwHistoryMgr.get().push(this);
            this.mAddedToHistory = true;
        };
        eDwSupportsHistoryCmd.prototype.cancel = function () {
            _super.prototype.cancel.call(this);
        };
        eDwSupportsHistoryCmd.prototype.isCommitted = function () {
            return this.mAddedToHistory;
        };
        eDwSupportsHistoryCmd.prototype.isUndone = function () {
            return this.mUndone;
        };
        return eDwSupportsHistoryCmd;
    }(eDwCmd));
    ;
    return eDwSupportsHistoryCmd;
});
define("eDwTableMgr", ["require", "exports", "eDwTypes", "eDrawingsBase"], function (require, exports, eDwTypes_18) {
    "use strict";
    var eDwTableMgr = (function () {
        function eDwTableMgr(iViewer) {
            this.mViewer = iViewer;
            this.mTables = [];
        }
        eDwTableMgr.prototype.numTables = function () {
            return this.mTables.length;
        };
        eDwTableMgr.prototype.getTables = function () {
            return this.mTables;
        };
        eDwTableMgr.prototype.add = function (iHierNode) {
            if (!iHierNode && iHierNode.Category !== "table")
                return;
            this.mTables.push(iHierNode);
            var attribs = iHierNode.getAttribs();
            if (attribs.NotesArea === true) {
                this.mViewer.getModel().getHCModel().setInstanceModifier(eDwTypes_18.HC.InstanceModifier.ScreenOriented, [iHierNode.HOOPSID], true);
            }
        };
        return eDwTableMgr;
    }());
    ;
    return eDwTableMgr;
});
define("eDwTimer", ["require", "exports"], function (require, exports) {
    "use strict";
    var eDwTimer = (function () {
        function eDwTimer() {
            this.start();
        }
        eDwTimer.prototype.start = function () {
            this.mMilliSeconds = 0;
            this.mSeconds = 0;
            this.mMinutes = 0;
            this.mHours = 0;
            this.mDays = 0;
            this.mStart = new Date();
        };
        eDwTimer.prototype.ellapsed = function () {
            var endDate = new Date();
            var timeDiff = endDate.valueOf() - this.mStart.valueOf();
            this.mMilliSeconds = Math.round(timeDiff % 1000);
            timeDiff = Math.floor(timeDiff / 1000);
            this.mSeconds = Math.round(timeDiff % 60);
            timeDiff = Math.floor(timeDiff / 60);
            this.mMinutes = Math.round(timeDiff % 60);
            timeDiff = Math.floor(timeDiff / 60);
            this.mHours = Math.round(timeDiff % 24);
            this.mDays = Math.floor(timeDiff / 24);
        };
        eDwTimer.prototype.dumpToConsole = function () {
            console.debugLog("Timer", "Elapsed time = " + this.mDays + " days - " +
                this.mHours + ":" + this.mMinutes + ":" +
                this.mSeconds + " and " + this.mMilliSeconds +
                " milliseconds");
        };
        Object.defineProperty(eDwTimer.prototype, "Days", {
            get: function () {
                return this.mDays;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(eDwTimer.prototype, "Hours", {
            get: function () {
                return this.mHours;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(eDwTimer.prototype, "Minutes", {
            get: function () {
                return this.mMinutes;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(eDwTimer.prototype, "Seconds", {
            get: function () {
                return this.mSeconds;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(eDwTimer.prototype, "MilliSeconds", {
            get: function () {
                return this.mMilliSeconds;
            },
            enumerable: true,
            configurable: true
        });
        return eDwTimer;
    }());
    ;
    return eDwTimer;
});
define("eDwTouchExplodeOperator", ["require", "exports", "eDwBaseOperator", "eDwExplodeCmd", "eDwCommandMgr", "eDwTypes"], function (require, exports, eDwBaseOperator, eDwExplodeCmd, eDwCommandMgr, eDwTypes_19) {
    "use strict";
    var eDwTouchExplodeOperator = (function (_super) {
        __extends(eDwTouchExplodeOperator, _super);
        function eDwTouchExplodeOperator(iViewer) {
            var _this = _super.call(this, iViewer) || this;
            _this.mFiveArea = 0;
            _this.mTouchShow = new eDwTouchUtils(iViewer);
            return _this;
        }
        eDwTouchExplodeOperator.prototype.onTouchStart = function (ioTouchEvent) {
            _super.prototype.onTouchStart.call(this, ioTouchEvent);
            this.mExplodeCmd = new eDwExplodeCmd(this.mViewer);
            eDwCommandMgr.get().add(this.mExplodeCmd);
            var curLevel = this.mViewer.getExplosionLevel();
            this.mFiveArea = this.getTouchArea();
            if (curLevel > 0) {
                this.mFiveArea = this.mFiveArea / (curLevel / 2 + 1);
            }
        };
        eDwTouchExplodeOperator.prototype.onTouchMove = function (ioTouchEvent) {
            _super.prototype.onTouchMove.call(this, ioTouchEvent);
            var area = this.getTouchArea();
            if (this.mFiveArea > 0) {
                var curLevel = this.mViewer.getExplosionLevel();
                var ratio = area / this.mFiveArea;
                var nxtLevel = 2 * (ratio - 1);
                nxtLevel = Math.min(nxtLevel, 10);
                nxtLevel = Math.max(nxtLevel, 0);
                this.mExplodeCmd.setLevel(nxtLevel);
            }
        };
        eDwTouchExplodeOperator.prototype.onTouchEnd = function (ioTouchEvent) {
            eDwCommandMgr.get().remove(this.mExplodeCmd, "commit");
            this.mExplodeCmd = null;
            this.mFiveArea = 0;
            _super.prototype.onTouchEnd.call(this, ioTouchEvent);
        };
        eDwTouchExplodeOperator.prototype.getTouchArea = function () {
            var coords = [];
            for (var i = 0; i < this.mCurTouches.length; ++i) {
                coords.push(this.mCurTouches[i].lastPos.copy());
            }
            return this.mTouchShow.getTouchArea(coords);
        };
        eDwTouchExplodeOperator.prototype.getArea = function () {
            var coords = [];
            for (var i = 0; i < this.mCurTouches.length; ++i) {
                coords.push(this.mCurTouches[i].lastPos.copy());
            }
            return this.maxArea(coords);
        };
        eDwTouchExplodeOperator.prototype.maxArea = function (coords) {
            var n = coords.length;
            var output = 0;
            for (var i = 0; i <= n - 1; ++i) {
                for (var j = i + 1; j <= n - 1; ++j) {
                    for (var k = j + 1; k <= n - 1; ++k) {
                        var temp = this.circleArea(coords[i], coords[j], coords[k]);
                        if (temp > output)
                            output = temp;
                    }
                }
            }
            return output;
        };
        eDwTouchExplodeOperator.prototype.circleArea = function (p0, p1, p2) {
            var center = eDwTypes_19.HC.Point2.add(p0, eDwTypes_19.HC.Point2.add(p1, p2));
            center.scale(1.0 / 3);
            var r = eDwTypes_19.HC.Point2.subtract(p0, center).length();
            return r * r;
        };
        return eDwTouchExplodeOperator;
    }(eDwBaseOperator));
    function isLeft(iP0, iP1, iP2) {
        return (iP1.x - iP0.x) * (iP2.y - iP0.y) -
            (iP2.x - iP0.x) * (iP1.y - iP0.y);
    }
    var eDwTouchUtils = (function (_super) {
        __extends(eDwTouchUtils, _super);
        function eDwTouchUtils(iVewer) {
            var _this = _super.call(this) || this;
            _this.mViewer = iVewer;
            _this.mViewerHC = iVewer.HCViewer;
            return _this;
        }
        eDwTouchUtils.prototype.draw = function () {
            var renderer = this.mViewerHC.getMarkupManager().getRenderer();
            renderer.drawPolygon(this.mTouchPolygon);
            renderer.drawPolygon(this.mConvex);
            for (var _i = 0, _a = this.mTouchPoss; _i < _a.length; _i++) {
                var c = _a[_i];
                renderer.drawCircle(c);
            }
        };
        eDwTouchUtils.prototype.getTouchArea = function (iPoss) {
            this.mTouchPoss = [];
            this.mTouchPolygon = new eDwTypes_19.HC.Markup.Shape.Polygon();
            this.mTouchPolygon.setFillOpacity(0);
            this.mTouchPolygon.setStrokeColor(eDwTypes_19.HC.Color.blue());
            this.mTouchPolygon.setStrokeWidth(2);
            for (var _i = 0, iPoss_1 = iPoss; _i < iPoss_1.length; _i++) {
                var pos = iPoss_1[_i];
                this.addPos(pos);
                this.mTouchPolygon.pushPoint(pos);
            }
            this.mConvex = new eDwTypes_19.HC.Markup.Shape.Polygon();
            this.mConvex.setFillOpacity(0.5);
            this.mConvex.setStrokeColor(eDwTypes_19.HC.Color.red());
            this.mConvex.setFillColor(new eDwTypes_19.HC.Color(46, 204, 113));
            this.mConvex.setStrokeWidth(2);
            var convexPoss = eDwTouchUtils.convexHull(iPoss);
            for (var _a = 0, convexPoss_1 = convexPoss; _a < convexPoss_1.length; _a++) {
                var pos = convexPoss_1[_a];
                this.mConvex.pushPoint(pos);
            }
            return eDwTouchUtils.convexArea(convexPoss);
        };
        eDwTouchUtils.prototype.addPos = function (iPos) {
            var circle = new eDwTypes_19.HC.Markup.Shape.Circle();
            circle.setCenter(iPos);
            circle.setRadius(2);
            this.mTouchPoss.push(circle);
        };
        eDwTouchUtils.convexHull = function (iPoss) {
            var h = [];
            var n = iPoss.length;
            if (!n)
                return h;
            var bot = 0, top = (-1);
            var minmin = 0, minmax = 0;
            var i = 0, xmin = iPoss[0].x;
            for (i = 1; i < n; i++) {
                if (iPoss[i].x != xmin) {
                    break;
                }
            }
            minmax = i - 1;
            if (minmax === n - 1) {
                h[++top] = iPoss[minmin];
                if (iPoss[minmax].y != iPoss[minmin].y) {
                    h[++top] = iPoss[minmax];
                }
                h[++top] = iPoss[minmin];
                return h;
            }
            var maxmin = 0, maxmax = n - 1;
            var xmax = iPoss[n - 1].x;
            for (i = n - 2; i >= 0; i--) {
                if (iPoss[i].x != xmax)
                    break;
            }
            maxmin = i + 1;
            h[++top] = iPoss[minmin];
            i = minmax;
            while (++i <= maxmin) {
                if (isLeft(iPoss[minmin], iPoss[maxmin], iPoss[i]) >= 0 &&
                    i < maxmin) {
                    continue;
                }
                while (top > 0) {
                    if (isLeft(h[top - 1], h[top], iPoss[i]) > 0) {
                        break;
                    }
                    else {
                        top--;
                    }
                }
                h[++top] = iPoss[i];
            }
            if (maxmax != maxmin) {
                h[++top] = iPoss[maxmax];
            }
            bot = top;
            i = maxmin;
            while (--i >= minmax) {
                if (isLeft(iPoss[maxmax], iPoss[minmax], iPoss[i]) >= 0 &&
                    i > minmax) {
                    continue;
                }
                while (top > bot) {
                    if (isLeft(h[top - 1], h[top], iPoss[i]) > 0) {
                        break;
                    }
                    else {
                        top--;
                    }
                }
                if (iPoss[i].x == h[0].x && iPoss[i].y == h[0].y) {
                    return h;
                }
                h[++top] = iPoss[i];
            }
            if (minmax != minmin) {
                h[++top] = iPoss[minmin];
            }
            return h;
        };
        eDwTouchUtils.convexArea = function (iPoss) {
            if (iPoss.length < 4)
                return 0;
            var n = iPoss.length;
            var area = 0;
            for (var i = 1; i < n - 1; ++i) {
                var temp = isLeft(iPoss[0], iPoss[i], iPoss[i + 1]);
                area += Math.abs(temp / 2);
            }
            return area;
        };
        return eDwTouchUtils;
    }(eDwTypes_19.HC.Markup.MarkupItem));
    return eDwTouchExplodeOperator;
});
define("eDwTouchOpsMgr", ["require", "exports", "eDwTouchExplodeOperator", "eDrawingsBase"], function (require, exports, eDwTouchExplodeOperator) {
    "use strict";
    var eDwTouchOpsMgr = (function () {
        function eDwTouchOpsMgr(iViewer) {
            iViewer.TouchOpsMgr = this;
            this.mViewer = iViewer;
            var touchOp = new eDwTouchExplodeOperator(iViewer);
            this.mTouchOpID = iViewer.OperatorMgr.registerCustomOperator(touchOp, true);
        }
        eDwTouchOpsMgr.prototype.unregister = function () {
            this.mViewer.OperatorMgr.unregisterCustomOperatorByID(this.mTouchOpID);
            this.mViewer.TouchOpsMgr = null;
        };
        eDwTouchOpsMgr.isTouchEnabled = function () {
            console.debugLog("TouchOps", "Touch enabled = " + ("ontouchstart" in window));
            return "ontouchstart" in window;
        };
        return eDwTouchOpsMgr;
    }());
    ;
    return eDwTouchOpsMgr;
});
define("eDwTypes", ["require", "exports", "eDrawingsBase"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var HC = Communicator;
    exports.HC = HC;
    var HCI = Communicator.Internal;
    exports.HCI = HCI;
    exports.SectionPlaneOrientation = {
        XY: {
            Plane: HC.Plane.createFromPointAndNormal(new HC.Point3(0, 0, 0), new HC.Point3(0, 0, 1)),
            Index: 0
        },
        YZ: {
            Plane: HC.Plane.createFromPointAndNormal(new HC.Point3(0, 0, 0), new HC.Point3(1, 0, 0)),
            Index: 1
        },
        ZX: {
            Plane: HC.Plane.createFromPointAndNormal(new HC.Point3(0, 0, 0), new HC.Point3(0, 1, 0)),
            Index: 2
        }
    };
    ;
    exports.DefaultDistanceUnit = "millimeter";
    exports.DefaultAngleUnit = "degree";
    exports.AngleConversion = {
        "degree": 1,
        "radian": Math.PI / 180
    };
    exports.DistanceConversion = {
        "millimeter": 1,
        "centimeter": 10,
        "meter": 1000,
        "inch": 25.4,
        "foot": 304.8
    };
    exports.MeasureMode = {
        FACE: 1,
        EDGE: 2,
        VERTEX: 4,
        HOLE: 8,
        ALL: 0xffffffff
    };
    exports.MarkupMode = {
        None: 0,
        Text: 1,
        Circle: 2,
        Rectangle: 3,
        Polyline: 4,
        Bezier: 5,
        Image: 6
    };
    ;
});
define("eDwUIAnnotHTMLGenerator", ["require", "exports", "eDwUIHTMLGenerator"], function (require, exports, eDwUIHTMLGenerator) {
    "use strict";
    var eDwUIAnnotHTMLGenerator = (function (_super) {
        __extends(eDwUIAnnotHTMLGenerator, _super);
        function eDwUIAnnotHTMLGenerator(iViewer, iPanelUIID) {
            return _super.call(this, iViewer, iPanelUIID) || this;
        }
        eDwUIAnnotHTMLGenerator.prototype.generateHTML = function (iAdditionalClasses) {
            return __awaiter(this, void 0, void 0, function () {
                var generatedHTML, modelHC, annotViews, viewID;
                return __generator(this, function (_a) {
                    generatedHTML = "";
                    modelHC = this.mViewer.getModel().getHCModel();
                    annotViews = modelHC.getCADViews();
                    for (viewID in annotViews) {
                        generatedHTML += "<div class='edrawings-submenu-list-item'" +
                            " data-viewid=" + viewID + ">" +
                            "<div class='edrawings-tree-space'> </div>" +
                            "<span class='item-tree-text'>" +
                            annotViews[viewID] + "</span></div>";
                    }
                    return [2, generatedHTML];
                });
            });
        };
        return eDwUIAnnotHTMLGenerator;
    }(eDwUIHTMLGenerator));
    ;
    return eDwUIAnnotHTMLGenerator;
});
define("eDwUIBaseEventHandlers", ["require", "exports", "eDwUIContextMenu", "eDwEventMgr", "eDwUIHTMLEventMgr", "eDwCommandMgr", "eDwChangeModelViewCmd", "eDwZoomToFitCmd", "eDwCompositeCmd", "eDwSetNodeVisibilityCmd", "eDwRedlineOperator", "eDwKeyMgr", "eDwUIUtils", "eDwTypes"], function (require, exports, eDwUIContextMenu, eDwEventMgr, eDwUIHTMLEventMgr, eDwCommandMgr, eDwChangeModelViewCmd, eDwZoomToFitCmd, eDwCompositeCmd, eDwSetNodeVisibilityCmd, eDwRedlineOperator, eDwKeyMgr, eDwUIUtils, eDwTypes_20) {
    "use strict";
    var eDwUIBaseEventHandlers = (function () {
        function eDwUIBaseEventHandlers(iViewerHTMLID, iViewerHTMLCanvasID) {
            this.mViewerHTMLID = iViewerHTMLID;
            this.mViewerHTMLCanvasID = iViewerHTMLCanvasID;
            this.mUIHTMLEventMgr = new eDwUIHTMLEventMgr();
        }
        eDwUIBaseEventHandlers.prototype.setViewer = function (iViewer) {
            this.mViewer = iViewer;
            this.setContextMenu(iViewer);
        };
        eDwUIBaseEventHandlers.prototype.addHTMLEventHandlers = function (iViewerFeatOpts) {
            var _this = this;
            this.mViewerFeatureOpts = iViewerFeatOpts;
            var eventMgrHTML = this.mUIHTMLEventMgr;
            eventMgrHTML.addEventHandler("#" + this.mViewerHTMLID, "contextmenu", eDwUIUtils.inhibitEventBehavior);
            eventMgrHTML.addEventHandler("window", "resize", function (iEvent) {
                if (_this.mViewer)
                    _this.mViewer.HCViewer.resizeCanvas();
            });
            this.addSubTreeArrowEventHandler("#edrawings-sheet-tree-menu");
            var eventHandlers = this;
            function selectElement(ioTarget, iX, iY) {
                var selIDHC = getHCID(ioTarget);
                if (isNaN(selIDHC))
                    return false;
                eventHandlers.mViewer.SelectionMgr.selectByID(selIDHC);
                return true;
            }
            function selectElementWithContextMenu(ioTarget, iX, iY) {
                if (selectElement(ioTarget, iX, iY)) {
                    eventHandlers.updateContextMenu(iX, iY);
                }
            }
            eventMgrHTML.addDelegatedEventHandler("#edrawings-sheet-tree-menu .edrawings-submenu-list-item-button", "click", function (iEvent) {
                var target = $(iEvent.target);
                if (!target)
                    return;
                selectElementWithContextMenu(target.parent(), iEvent.clientX, iEvent.clientY);
            });
            eventMgrHTML.addDelegatedEventHandler("#edrawings-sheet-tree-menu .edrawings-submenu-list-item", "click", function (iEvent) {
                if ($(iEvent.target).hasClass("edrawings-root")) {
                    switchModelView(iEvent.target, _this.mViewer);
                    return;
                }
                selectElement($(iEvent.target), iEvent.clientX, iEvent.clientY);
            });
            function isTreeExpandElement(iTarget) {
                return iTarget ? iTarget.hasClass("edrawings-tree-arrow") ||
                    iTarget.hasClass("edrawings-tree-expanded") ||
                    iTarget.hasClass("edrawings-tree-icon")
                    : false;
            }
            eventMgrHTML.addDelegatedEventHandler("#edrawings-sheet-tree-menu .edrawings-submenu-list-item", "mousedown", function (iEvent) {
                if ($(iEvent.target).hasClass("edrawings-root")) {
                    return;
                }
                if (isTreeExpandElement($(iEvent.target)))
                    return;
                _this.onMouseDown(iEvent);
            });
            eventMgrHTML.addDelegatedEventHandler("#edrawings-sheet-tree-menu .edrawings-submenu-list-item", "dblclick", function (iEvent) {
                var target = $(iEvent.target);
                if (target.hasClass("edrawings-root")) {
                    return;
                }
                var id = getHCID(target);
                if (isNaN(id) || id < 0) {
                    return;
                }
                var cmdMgr = eDwCommandMgr.get();
                var zoomToViewCmd = new eDwCompositeCmd(_this.mViewer);
                zoomToViewCmd.initCmdActionImplementation();
                cmdMgr.add(zoomToViewCmd);
                var targetModelView = _this.getModelViewFromID(id);
                var activeModelView = _this.mViewer.getModel().getActiveModelView();
                if (targetModelView && targetModelView !== activeModelView) {
                    _this.mViewer.SelectionMgr.selectByID(id);
                    var changeModelViewCmd = new eDwChangeModelViewCmd(_this.mViewer, targetModelView.Name, _this.mViewer.getInitCamera());
                    cmdMgr.add(changeModelViewCmd);
                    cmdMgr.remove(changeModelViewCmd, "commit");
                }
                _this.onLeftDoubleClick(_this.mViewer);
                cmdMgr.remove(zoomToViewCmd, "commit");
            });
            function switchModelView(iElement, iViewer) {
                var modelViewName = eDwUIUtils.getText(iElement);
                var changeModelViewCmd = new eDwChangeModelViewCmd(iViewer, modelViewName, iViewer.getInitCamera());
                var cmdMgr = eDwCommandMgr.get();
                cmdMgr.add(changeModelViewCmd);
                cmdMgr.remove(changeModelViewCmd, "commit");
            }
            if (this.mViewerFeatureOpts.Tree) {
                this.addSubTreeArrowEventHandler("#edrawings-component-tree-menu");
                eventMgrHTML.addDelegatedEventHandler("#edrawings-component-tree-menu .edrawings-submenu-list-item", "click", function (iEvent) {
                    selectElement($(iEvent.target), iEvent.clientX, iEvent.clientY);
                });
                eventMgrHTML.addDelegatedEventHandler("#edrawings-configurations-menu .edrawings-submenu-list-item", "click", function (iEvent) {
                    switchModelView(iEvent.target, _this.mViewer);
                });
                eventMgrHTML.addDelegatedEventHandler("#edrawings-component-tree-menu .edrawings-submenu-list-item", "dblclick", function (iEvent) {
                    var id = getHCID($(iEvent.target));
                    if (isNaN(id))
                        return;
                    _this.onLeftDoubleClick(_this.mViewer);
                });
                eventMgrHTML.addDelegatedEventHandler("#edrawings-component-tree-menu .edrawings-submenu-list-item", "mousedown", function (iEvent) {
                    if (isTreeExpandElement($(iEvent.target)))
                        return;
                    _this.onMouseDown(iEvent);
                });
                eventMgrHTML.addEventHandler("#component-search-cancel", "click", function (iEvent) {
                    $("#edrawings-component-tree-menu " +
                        ".edrawings-menu-search-input").val("");
                    _this.searchPanelList($(iEvent.target));
                });
                eventMgrHTML.addDelegatedEventHandler("#edrawings-configurations-menu .item-text", "click", function (iEvent) {
                    switchModelView(iEvent.target, _this.mViewer);
                });
                var selectorName = "#edrawings-component-tree-menu " +
                    ".edrawings-submenu-list-item-button";
                eventMgrHTML.addDelegatedEventHandler(selectorName, "click", function (iEvent) {
                    var target = $(iEvent.target);
                    if (!target)
                        return;
                    selectElementWithContextMenu(target.parent(), iEvent.clientX, iEvent.clientY);
                });
                eventMgrHTML.addEventHandler("#edrawings-search-component-input", "keyup", function (iEvent) {
                    _this.searchPanelList($(iEvent.target));
                });
            }
            if (this.mViewerFeatureOpts.Debug) {
                this.addSubTreeArrowEventHandler("#edrawings-debug-menu");
                var inputSelectorName = "#edrawings-console-debug-categories " +
                    ".edrawings-menu-search-input";
                eventMgrHTML.addDelegatedEventHandler(inputSelectorName, "blur", function (iEvent) {
                    var inputElem = iEvent.target;
                    var categories = inputElem.value.split(",");
                    if (categories.length === 0)
                        return;
                    for (var _i = 0, categories_1 = categories; _i < categories_1.length; _i++) {
                        var category = categories_1[_i];
                        category = category.trim();
                        if (!category)
                            continue;
                        console.debugLogCategories.push(category);
                        var pos = console.excludeDebugLogCategories.indexOf(category);
                        if (pos > -1) {
                            console.excludeDebugLogCategories.slice(pos, 1);
                        }
                    }
                });
                var selectorName_1 = "#edrawings-debug-menu .edrawings-submenu-list-item";
                eventMgrHTML.addDelegatedEventHandler(selectorName_1, "click", function (iEvent) {
                    var id = getHCID($(iEvent.target));
                    if (isNaN(id))
                        return;
                    $(selectorName_1).removeClass("edrawings-list-selected");
                    $(iEvent.target).addClass("edrawings-list-selected");
                    _this.mViewer.SelectionMgr.selectByID(id);
                });
                eventMgrHTML.addDelegatedEventHandler("#edrawings-debug-menu .edrawings-submenu-list-item", "dblclick", function (iEvent) {
                    var id = getHCID($(iEvent.target));
                    if (isNaN(id))
                        return;
                    _this.onLeftDoubleClick(_this.mViewer);
                });
                eventMgrHTML.addEventHandler("#edrawings-debug-menu .edrawings-menu-search-cancel", "click", function (iEvent) {
                    $("#edrawings-debug-menu " +
                        ".edrawings-menu-search-input").val("");
                    _this.searchPanelList($(iEvent.target));
                });
                eventMgrHTML.addEventHandler("#edrawings-debug-menu .edrawings-menu-search-input", "keyup", function (iEvent) {
                    _this.searchPanelList($(iEvent.target));
                });
            }
            if (this.mViewerFeatureOpts.Measure) {
                eventMgrHTML.addDelegatedEventHandler("#edrawings-measure-menu .edrawings-measure-entities-remove", "click", function (iEvent) {
                    var target = $(iEvent.target);
                    var idxStr = target.parent().attr('index');
                    if (!idxStr)
                        return;
                    var idx = parseInt(idxStr, 10);
                    _this.mViewer.MeasureMgr.removeMeasureEntityAt(idx);
                });
                var selectorName_2 = "#edrawings-measure-menu .edrawings-measure-entities-list-item";
                eventMgrHTML.addDelegatedEventHandler(selectorName_2, "click", function (iEvent) {
                    _this.mContextMenu.hide();
                    var target = $(iEvent.target);
                    var idxStr = target.attr('index');
                    if (!idxStr) {
                        return;
                    }
                    var idx = parseInt(idxStr, 10);
                    $(selectorName_2).removeClass("edrawings-list-selected");
                    _this.mViewer.MeasureMgr.dehighlightAllSelectEntity();
                    target.addClass("edrawings-list-selected");
                    _this.mViewer.MeasureMgr.highlightSelectEntityAt(idx);
                });
                eventMgrHTML.addDelegatedEventHandler("#edrawings-measure-menu .edrawings-measure-entities-list-item", "mousedown", function (iEvent) {
                    if (!eDwKeyMgr.get().isRMBPressed(iEvent)) {
                        return;
                    }
                    var target = $(iEvent.target);
                    var idxStr = target.attr('index');
                    if (!idxStr)
                        return;
                    target.addClass("edrawings-list-selected");
                    var measureMgr = _this.mViewer.MeasureMgr;
                    measureMgr.dehighlightAllSelectEntity();
                    var idx = parseInt(idxStr, 10);
                    measureMgr.highlightSelectEntityAt(idx);
                    _this.updateContextMenu(iEvent.pageX, iEvent.pageY, "#measure");
                });
                eventMgrHTML.addDelegatedEventHandler("#edrawings-measure-menu .measure-filter-button", "click", function (iEvent) {
                    var target = $(iEvent.target);
                    if (target.hasClass("active-button")) {
                        target.removeClass("active-button");
                    }
                    else {
                        target.addClass("active-button");
                    }
                    _this.mViewer.MeasureMgr.setMeasureMode(eDwUIUtils.getCurrentMeasureMode());
                });
                eventMgrHTML.addDelegatedEventHandler("#edrawings-measure-menu .edrawings-measure-delta-button", "click", function (iEvent) {
                    var target = $(iEvent.target);
                    if (target.hasClass("active-button")) {
                        target.removeClass("active-button");
                        _this.mViewer.MeasureMgr.setMeasureDelta(false);
                    }
                    else {
                        target.addClass("active-button");
                        _this.mViewer.MeasureMgr.setMeasureDelta(true);
                    }
                });
                eventMgrHTML.addDelegatedEventHandler("#edrawings-measure-menu .edrawings-measure-pickpoint-button", "click", function (iEvent) {
                    var target = $(iEvent.target);
                    if (target.hasClass("active-button")) {
                        target.removeClass("active-button");
                        _this.mViewer.MeasureMgr.setMeasurePickPoint(false);
                    }
                    else {
                        target.addClass("active-button");
                        _this.mViewer.MeasureMgr.setMeasurePickPoint(true);
                    }
                });
                eventMgrHTML.addDelegatedEventHandler("#edrawings-measure-menu .measure-unit-selector", "change", function (iEvent) {
                    var unitMultiplier = $("#edrawings-measure-distant-unit").val();
                    var angleUnit = $("#edrawings-measure-angle-unit").val();
                    _this.mViewer.MeasureMgr.setMeasureUnits(unitMultiplier, angleUnit);
                });
            }
            function addListClickEventHandler(iEventMgrHTML, iSelectorName, iViewAttrName) {
                var _this = this;
                iEventMgrHTML.addDelegatedEventHandler(iSelectorName, "click", function (iEvent) {
                    var items = $(iSelectorName);
                    items.removeClass("edrawings-list-selected");
                    var target = $(iEvent.target);
                    var viewID = parseInt(target.data(iViewAttrName), 10);
                    if (isNaN(viewID))
                        return;
                    var modelHC = _this.mViewer.getModel().getHCModel();
                    modelHC.activateCADView(viewID);
                    var pmiIds = [];
                    var cadViews = modelHC.getCADViews();
                    for (var idStr in cadViews) {
                        var id = parseInt(idStr, 10);
                        var name_2 = cadViews[idStr];
                        Array.prototype.push.apply(pmiIds, modelHC.getCADViewPMIs(id));
                    }
                    var setNodeVisCmd = new eDwSetNodeVisibilityCmd(_this.mViewer, pmiIds, true);
                    var cmdMgr = eDwCommandMgr.get();
                    cmdMgr.add(setNodeVisCmd);
                    cmdMgr.remove(setNodeVisCmd, "commit");
                    $(iEvent.target).addClass("edrawings-list-selected");
                });
            }
            if (this.mViewerFeatureOpts.Annot) {
                addListClickEventHandler(eventMgrHTML, "#edrawings-annot-control-menu " +
                    ".edrawings-submenu-list-item", "viewid");
            }
            eventMgrHTML.addDelegatedEventHandler("#edrawings-tables-menu .edrawings-submenu-list-item", "click", function (iEvent) {
                selectElementWithContextMenu($(iEvent.target), iEvent.clientX, iEvent.clientY);
            });
            eventMgrHTML.addDelegatedEventHandler("#edrawings-tables-menu .edrawings-submenu-list-item", "mousedown", function (iEvent) {
                if (!eDwKeyMgr.get().isRMBPressed(iEvent))
                    return;
                selectElementWithContextMenu($(iEvent.target), iEvent.clientX, iEvent.clientY);
            });
            eventMgrHTML.addDelegatedEventHandler("#edrawings-tables-menu " +
                ".edrawings-submenu-list-item-button", "click", function (iEvent) {
                var target = $(iEvent.target);
                if (!target)
                    return;
                selectElementWithContextMenu(target.parent(), iEvent.clientX, iEvent.clientY);
            });
            if (this.mViewerFeatureOpts.Markup) {
                eventMgrHTML.addDelegatedEventHandler("#edrawings-markup-menu .edrawings-submenu-list-item", "click", function (iEvent) {
                    $(".edrawings-submenu-list-item").removeClass("edrawings-list-selected");
                    var target = $(iEvent.target);
                    var viewKey = target.attr("key");
                    target.addClass("edrawings-list-selected");
                    var markupMgr = _this.mViewer.HCViewer.getMarkupManager();
                    markupMgr.activateMarkupView(viewKey, 400);
                    var markupView = markupMgr.getMarkupView(viewKey);
                    eDwRedlineOperator.activateMarkups(markupView, _this.mViewer.HCViewer);
                });
                eventMgrHTML.addDelegatedEventHandler("#edrawings-markup-menu .edrawings-submenu-list-item", "dblclick", function (iEvent) {
                    $(".edrawings-submenu-list-item").removeClass("edrawings-list-selected");
                    var target = $(iEvent.target);
                    var viewKey = target.attr("key");
                    var markupMgr = _this.mViewer.HCViewer.getMarkupManager();
                    markupMgr.deleteMarkupView(viewKey);
                });
                eventMgrHTML.addEventHandler("#markup-text-editor", "keyup", function (iEvent) {
                    var input = $("#markup-text-editor").val();
                    var op = _this.mViewer.MarkupMgr.getOperator();
                    op.setCurAnnotation(input);
                });
                eventMgrHTML.addDelegatedEventHandler("#edrawings-markup-menu .markup-mode-button", "click", function (iEvent) {
                    var target = $(iEvent.target);
                    if (!target.hasClass("active-button")) {
                        var button = $("#edrawings-markup-menu .markup-mode-button");
                        button.removeClass("active-button");
                        target.addClass("active-button");
                    }
                    else {
                        target.removeClass("active-button");
                    }
                    _this.mViewer.MarkupMgr.setMarkupMode(eDwUIUtils.getCurrentMarkupMode());
                });
                if (this.mViewerFeatureOpts.Exp) {
                    eDwUIUtils.hide(".edrawings-markup-io", false);
                    eventMgrHTML.addDelegatedEventHandler("#edrawings-markup-menu .markup-op-button", "click", function (iEvent) {
                        var target = $(iEvent.target);
                        if (target[0].id === "edrawings-markup-read") {
                            _this.mViewer.MarkupMgr.readFromCache();
                        }
                        if (target[0].id === "edrawings-markup-save") {
                            _this.mViewer.MarkupMgr.saveToCache();
                        }
                    });
                }
            }
            eventMgrHTML.addDelegatedEventHandler("#edrawings-layer-control-menu .item-layer-checkbox", "click", function (iEvent) {
                var targetJQ = eDwUIUtils.getTarget($(iEvent.target));
                var layerName = eDwUIUtils.getSpanText(targetJQ.next("span.item-tree-text"));
                var isVisible = targetJQ.prop("checked");
                _this.setOneLayerVisibility(layerName, isVisible);
            });
            eventMgrHTML.addDelegatedEventHandler("#edrawings-layer-control-menu .layer-all", "click", function (iEvent) {
                var isVisible = $(iEvent.target).prop("checked");
                _this.setAllLayerVisibility(isVisible);
            });
        };
        eDwUIBaseEventHandlers.prototype.addDefaultHTMLPanelCloseEventHandlers = function () {
            var eventMgrHTML = this.mUIHTMLEventMgr;
            function addCloseEventHandler(iPanelID) {
                eventMgrHTML.addDelegatedEventHandler(iPanelID + " .edrawings-menu-close", "click", function (iEvent) {
                    eDwUIUtils.hide(iPanelID, true);
                });
            }
            if (this.mViewerFeatureOpts.Tree) {
                addCloseEventHandler("#edrawings-component-tree-menu");
            }
            addCloseEventHandler("#edrawings-configurations-menu");
            if (this.mViewerFeatureOpts.Debug) {
                addCloseEventHandler("#edrawings-debug-menu");
            }
            addCloseEventHandler("#edrawings-sheet-tree-menu");
            addCloseEventHandler("#edrawings-layer-control-menu");
            if (this.mViewerFeatureOpts.Annot) {
                addCloseEventHandler("#edrawings-annot-control-menu");
            }
            addCloseEventHandler("#edrawings-tables-menu");
        };
        ;
        eDwUIBaseEventHandlers.addViewerEventHandlers = function (iEventHandlerObj) {
            var handlerObj = iEventHandlerObj;
            var eventMgr = eDwEventMgr.get();
            eventMgr.addEventHandlerObj("Init", handlerObj, "onInit");
            eventMgr.addEventHandlerObj("Select", handlerObj, "onSelect");
            eventMgr.addEventHandlerObj("Unselect", handlerObj, "onUnselect");
            eventMgr.addEventHandlerObj("StartAnimation", handlerObj, "onStartAnimation");
            eventMgr.addEventHandlerObj("StopAnimation", handlerObj, "onStopAnimation");
            eventMgr.addEventHandlerObj("LeftClick", handlerObj, "onLeftClick");
            eventMgr.addEventHandlerObj("RightClick", handlerObj, "onRightClick");
            eventMgr.addEventHandlerObj("LeftDoubleClick", handlerObj, "onLeftDoubleClick");
            eventMgr.addEventHandlerObj("ModelLoadFailure", handlerObj, "onModelLoadFailed");
            eventMgr.addEventHandlerObj("Timeout", handlerObj, "onTimeout");
            eventMgr.addEventHandlerObj("DrawModeChange", handlerObj, "onDrawModeChange");
            eventMgr.addEventHandlerObj("ProjModeChange", handlerObj, "onProjectionModeChange");
            eventMgr.addEventHandlerObj("NodeAttribChange", handlerObj, "onNodeAttribChanged");
            eventMgr.addEventHandlerObj("CameraChange", handlerObj, "onCameraChange");
            eventMgr.addEventHandlerObj("ResetScene", handlerObj, "onResetScene");
            eventMgr.addEventHandlerObj("AmbientOcclChange", handlerObj, "onAmbientOcclusionChange");
            eventMgr.addEventHandlerObj("ExplodeLevelChange", handlerObj, "onExplodeLevelChange");
            eventMgr.addEventHandlerObj("Done", handlerObj, "onDone");
            eventMgr.addEventHandlerObj("ModelViewChange", handlerObj, "onModelViewChange");
            if (handlerObj.mViewerFeatureOpts.Measure) {
                eventMgr.addEventHandlerObj("MeasurementRefresh", handlerObj, "onMeasurementRefresh");
                eventMgr.addEventHandlerObj("MeasurementSelection", handlerObj, "onMeasurementSelection");
                eventMgr.addEventHandlerObj("MeasurementDeselectAll", handlerObj, "onMeasurementDeselectAll");
            }
            if (handlerObj.mViewerFeatureOpts.Markup) {
                eventMgr.addEventHandlerObj("ViewCreated", handlerObj, "onViewCreated");
                eventMgr.addEventHandlerObj("ViewLoaded", handlerObj, "onViewLoaded");
                eventMgr.addEventHandlerObj("ViewDeleted", handlerObj, "onViewDeleted");
            }
        };
        eDwUIBaseEventHandlers.prototype.removeHTMLEventHandlers = function () {
            this.mUIHTMLEventMgr.removeAllEventHandlers();
            if (this.mContextMenu)
                this.mContextMenu.removeAllEventHandlers();
            this.mContextMenu = undefined;
        };
        eDwUIBaseEventHandlers.removeViewerEventHandlers = function () {
            eDwEventMgr.get().removeAllEventHandlers();
        };
        eDwUIBaseEventHandlers.prototype.onInit = function (iViewer) {
            this.mViewer = iViewer;
            this.setContextMenu(this.mViewer);
            eDwUIUtils.createUIGenerators(iViewer);
            if (iViewer.ViewerFeatureOpts.Annot) {
                this.populateMBDNotes(iViewer);
            }
        };
        eDwUIBaseEventHandlers.prototype.onDone = function (iViewer) {
            iViewer.destroy();
        };
        eDwUIBaseEventHandlers.prototype.onMouseDown = function (iEvent) {
            if (!this.mContextMenu) {
                return;
            }
            var jqSelObj = $(iEvent.target);
            jqSelObj.attr("inhibitScroll", "true");
            if (eDwKeyMgr.get().isRMBPressed(iEvent)) {
                var id = getHCID($(iEvent.target));
                if (isNaN(id)) {
                    jqSelObj.removeAttr("inhibitScroll");
                    return;
                }
                this.mViewer.SelectionMgr.selectByID(id);
                this.updateContextMenu(iEvent.pageX, iEvent.pageY);
            }
            else {
                this.mContextMenu.hide();
            }
        };
        ;
        eDwUIBaseEventHandlers.prototype.onSelect = function (iViewer, iSelObj) {
            this.handleSelectionChange(iViewer, iSelObj, true);
            this.updateComponentCount(iViewer);
        };
        eDwUIBaseEventHandlers.prototype.onUnselect = function (iViewer, iSelObj) {
            this.handleSelectionChange(iViewer, iSelObj, false);
            this.updateComponentCount(iViewer);
        };
        ;
        eDwUIBaseEventHandlers.prototype.onResizePanel = function (iEvent, iMenuID, mouseXOrig, menuWidthOrig) {
            $(iMenuID).width(menuWidthOrig + iEvent.clientX - mouseXOrig);
        };
        eDwUIBaseEventHandlers.prototype.onLeftDoubleClick = function (iViewer) {
            var nodeHCID;
            var result = iViewer.SelectionMgr.getLastSelHCID();
            if (result instanceof RangeError) {
                var activeModelView = iViewer.getModel().getActiveModelView();
                if (activeModelView)
                    nodeHCID = activeModelView.Hierarchy.HOOPSID;
            }
            else {
                nodeHCID = result;
            }
            var zoomToFitCmd = new eDwZoomToFitCmd(iViewer, nodeHCID, iViewer.getHCView().getCamera());
            var cmdMgr = eDwCommandMgr.get();
            cmdMgr.add(zoomToFitCmd);
            cmdMgr.remove(zoomToFitCmd, "commit");
            if (this.mContextMenu)
                this.mContextMenu.hide();
        };
        ;
        eDwUIBaseEventHandlers.prototype.onRightClick = function (iViewer, iCoords) {
            this.updateContextMenu(iCoords.x, iCoords.y);
        };
        eDwUIBaseEventHandlers.prototype.updateContextMenu = function (iX, iY, iSelector) {
            if (iSelector === void 0) { iSelector = ""; }
            var selector = iSelector;
            if (!selector) {
                var isDrawing = this.mViewer.getModel().isDrawing();
                selector = "#display" +
                    (isDrawing ? " .edw-context-transp-solid" : "");
                ;
            }
            if (this.mViewer.getModel().isPart()) {
                selector += " #display";
            }
            this.mContextMenu.show(iX, iY, selector);
        };
        ;
        eDwUIBaseEventHandlers.prototype.hideContextMenu = function () {
            if (this.mContextMenu)
                this.mContextMenu.hide();
        };
        ;
        eDwUIBaseEventHandlers.prototype.onLeftClick = function (iViewer, iCoords) {
            this.hideContextMenu();
        };
        ;
        eDwUIBaseEventHandlers.prototype.onModelViewChange = function (iViewer, iNewModelView, iIsAssembly) {
            var _this = this;
            (function () { return __awaiter(_this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, eDwUIUtils.updateUI(iViewer, iNewModelView)];
                        case 1:
                            _a.sent();
                            eDwUIUtils.setModelView(iNewModelView);
                            return [2];
                    }
                });
            }); })();
        };
        ;
        eDwUIBaseEventHandlers.prototype.onNodeAttribChanged = function (iViewer, iHierNodesAndAttribs) {
            if (iViewer.ViewerFeatureOpts.Debug) {
                for (var _i = 0, iHierNodesAndAttribs_3 = iHierNodesAndAttribs; _i < iHierNodesAndAttribs_3.length; _i++) {
                    var hierNodeAndAttribs = iHierNodesAndAttribs_3[_i];
                    console.debugLog("NodeAttribChanged", "Node name = " +
                        hierNodeAndAttribs.HierNode.Name +
                        " attributes = " +
                        JSON.stringify(hierNodeAndAttribs.Attribs));
                }
            }
            this.handleNodeAttribChange(iViewer, iHierNodesAndAttribs);
        };
        eDwUIBaseEventHandlers.prototype.onMeasurementDeselectAll = function () {
            $(".edrawings-measure-entities-list-item").removeClass("edrawings-list-selected");
        };
        eDwUIBaseEventHandlers.prototype.onMeasurementSelected = function (iSelListIndex) {
            var selector = '.edrawings-measure-entities-list-item[index="' +
                iSelListIndex + '"]';
            var item = $(selector);
            if (item.length && !item.hasClass("edrawings-list-selected")) {
                var hasScrollParent = item.scrollParent;
                var ownerDivScrollParent = hasScrollParent ?
                    item.scrollParent() : null;
                var position = ownerDivScrollParent ?
                    ownerDivScrollParent.scrollTop() : 0;
                var ownerDivPos = item.position();
                position += ownerDivPos ? ownerDivPos.top : 0;
                if (hasScrollParent) {
                    item.scrollParent().animate({ scrollTop: position }, "fast");
                }
            }
            $(".edrawings-measure-entities-list-item").removeClass("edrawings-list-selected");
            item.addClass("edrawings-list-selected");
        };
        eDwUIBaseEventHandlers.prototype.onMeasurementRefresh = function (iMeasureResult) {
            var _this = this;
            (function () { return __awaiter(_this, void 0, void 0, function () {
                var list, gen, _a, _b;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            list = $("#edrawings-measure-submenu-list");
                            $("#edrawings-measure-result").text("");
                            list.empty();
                            $("#edrawings-measure-result").text(iMeasureResult.Message);
                            gen = eDwUIUtils.getUIGenerator("#edrawings-measure-menu");
                            gen.setMeasureResult(iMeasureResult);
                            _b = (_a = list).append;
                            return [4, gen.generateHTML("")];
                        case 1:
                            _b.apply(_a, [_c.sent()]);
                            return [2];
                    }
                });
            }); })();
        };
        eDwUIBaseEventHandlers.prototype.onViewCreated = function (iView) {
            eDwRedlineOperator.activateMarkups(iView, this.mViewer.HCViewer);
            populateMarkupList();
        };
        eDwUIBaseEventHandlers.prototype.onViewLoaded = function (iView) {
            this.onViewCreated(iView);
        };
        eDwUIBaseEventHandlers.prototype.onViewDeleted = function (iView) {
            eDwRedlineOperator.deActivateMarkups(iView, this.mViewer.HCViewer);
            this.mViewer.HCViewer.getMarkupManager().refreshMarkup();
            populateMarkupList();
        };
        eDwUIBaseEventHandlers.prototype.onCameraChange = function (iCamera) {
            if (this.mViewer.ViewerFeatureOpts.Annot) {
                this.mViewer.MBDNoteMgr.updateNote();
            }
        };
        eDwUIBaseEventHandlers.prototype.updateComponentCount = function (iViewer) {
            var panel = $(".edrawings-menu.active");
            if (!panel || !panel[0])
                return;
            var componentCount = $(panel[0]).find(".edrawings-menu-info");
            if (!componentCount || !componentCount[0])
                return;
            var selHierNodes = iViewer.HCViewer.getSelectionManager().getResults();
            var modelView = iViewer.getModel().getActiveModelView();
            if (0 === selHierNodes.length) {
                var curHierarcy = modelView.Hierarchy;
                $(componentCount[0]).text("Components: " +
                    curHierarcy.getComponentCount());
            }
            else {
                var modelHC = iViewer.getModel().getHCModel();
                var count = 0;
                if (selHierNodes.length) {
                    var selHCID = selHierNodes[0].getNodeId();
                    var selType = modelHC.getNodeType(selHCID);
                    do {
                        if (selType === eDwTypes_20.HC.NodeType.AssemblyNode ||
                            selType === eDwTypes_20.HC.NodeType.PartInstance) {
                            var hierNode = modelView.Nodes[selHCID];
                            if (hierNode) {
                                $(componentCount[0]).text("Selected Compponent: " +
                                    hierNode.getComponentCount());
                                return;
                            }
                        }
                        selHCID = modelHC.getNodeParent(selHCID);
                        selType = modelHC.getNodeType(selHCID);
                    } while (selType !== eDwTypes_20.HC.NodeType.Unknown);
                    $(componentCount[0]).text("Selected Component: " +
                        modelView.Hierarchy.getComponentCount());
                }
            }
        };
        eDwUIBaseEventHandlers.prototype.setContextMenu = function (iViewer) {
            if (!this.mContextMenu) {
                this.mContextMenu = new eDwUIContextMenu(iViewer, this.mViewerHTMLCanvasID);
            }
        };
        ;
        eDwUIBaseEventHandlers.prototype.treeArrowClick = function (ioTarget) {
            function collapseListNode(iTarget) {
                var parentElem = iTarget[0].parentElement.parentElement;
                var childElems = $(parentElem).children("[data-hoopsparentid='" +
                    iTarget.data("hoopsid") + "']");
                $.each(childElems, function (iArg, iElem) {
                    collapseListNode($(iElem));
                    parentElem.removeChild(iElem);
                });
            }
            if (ioTarget.hasClass("edrawings-tree-expanded")) {
                collapseListNode(ioTarget);
                ioTarget.removeClass("edrawings-tree-expanded");
            }
            else {
                var appendJQ = ioTarget.closest(".edrawings-submenu-list-item");
                var panelID = eDwUIUtils.getUIPanelID(appendJQ);
                var gen = eDwUIUtils.getUIGenerator(panelID);
                var nodeToExpand = parseInt(ioTarget.data("hoopsid"), 10);
                var node = gen.getNodeFromID(nodeToExpand);
                if (node === undefined) {
                    console.debugLog("ListUI", "There is no node for the ID");
                    return;
                }
                var offset = parseInt($(appendJQ).css("padding-left"), 10);
                appendJQ.after(gen.generateHTMLForChildNodes(node, false, offset));
                ioTarget.addClass("edrawings-tree-expanded");
            }
        };
        ;
        eDwUIBaseEventHandlers.prototype.addSubTreeArrowEventHandler = function (iTreeNodeID) {
            var _this = this;
            this.mUIHTMLEventMgr.addDelegatedEventHandler(iTreeNodeID + " .edrawings-tree-arrow", "click", function (iEvent) {
                var targetJQ = $(iEvent.target);
                _this.treeArrowClick(targetJQ);
            });
        };
        eDwUIBaseEventHandlers.prototype.searchPanelList = function (iElemJQ) {
            var panelID = eDwUIUtils.getUIPanelID(iElemJQ);
            var list = $(panelID + " .edrawings-submenu-list");
            var listItems = $(list).children(".edrawings-submenu-list-item");
            if (listItems.length) {
                var parentNodeID = $(listItems[0]).data("hoopsparentid");
                list.empty();
                this.mViewer.SelectionMgr.unSelectAllObjects();
                var gen = eDwUIUtils.getUIGenerator(panelID);
                var parentNode = gen.getNodeFromID(parentNodeID);
                var inputVal = $(panelID + " .edrawings-menu-search-input").val();
                list.append(gen.generateHTMLForChildNodes(parentNode, inputVal.length > 0, undefined));
                eDwUIUtils.hide(".edrawings-menu-search-cancel", true);
            }
        };
        eDwUIBaseEventHandlers.prototype.getModelViewFromID = function (iNodeHCID) {
            var model = this.mViewer.getModel();
            var modelHC = model.getHCModel();
            var modelViews = model.getModelViews();
            for (var _i = 0, modelViews_3 = modelViews; _i < modelViews_3.length; _i++) {
                var modelView = modelViews_3[_i];
                var configHId = modelView.Hierarchy.HOOPSID;
                var configChildren = modelHC.getNodeChildren(configHId);
                if (-1 !== configChildren.indexOf(iNodeHCID)) {
                    return modelView;
                }
            }
            return null;
        };
        eDwUIBaseEventHandlers.prototype.setOneLayerVisibility = function (layerName, isVisible) {
            var viewer = this.mViewer;
            var activeModelView = viewer.getModel().getActiveModelView();
            var layerNodes = activeModelView.Hierarchy.findNodes("Name", layerName);
            var layerNodeIDs = [];
            var numNodes = layerNodes.length;
            for (var i = 0; i < numNodes; i++) {
                layerNodeIDs.push(layerNodes[i].HOOPSID);
            }
            this.setLayerVisibility(layerNodeIDs, isVisible);
            var eachLayer = $("#edrawings-layer-control-menu .item-layer-checkbox");
            var isAnyShow = false, isAnyHidden = false;
            $.each(eachLayer, function (iIdx, iTarget) {
                if ($(iTarget).prop('checked')) {
                    isAnyShow = true;
                }
                else {
                    isAnyHidden = true;
                }
            });
            var allLayerBox = $("#edrawings-layer-control-menu .layer-all");
            if (isAnyShow && isAnyHidden) {
                allLayerBox.prop('indeterminate', true);
            }
            if (isAnyShow && !isAnyHidden) {
                allLayerBox.prop('indeterminate', false);
                allLayerBox.prop('checked', true);
            }
            if (!isAnyShow && isAnyHidden) {
                allLayerBox.prop('indeterminate', false);
                allLayerBox.prop('checked', false);
            }
        };
        eDwUIBaseEventHandlers.prototype.setAllLayerVisibility = function (isVisible) {
            var activeModelView = this.mViewer.getModel().getActiveModelView();
            if (!activeModelView || !activeModelView.Hierarchy)
                return;
            var layerNodes = activeModelView.Hierarchy.findNodes("Category", "layer");
            var layerNodeIDs = [];
            var numLayers = layerNodes.length;
            for (var i = 0; i < numLayers; i++) {
                var layerName = layerNodes[i].Name;
                layerNodeIDs = layerNodeIDs.concat(layerNodes[i].HOOPSID);
            }
            this.setLayerVisibility(layerNodeIDs, isVisible);
            var eachLayer = $("#edrawings-layer-control-menu .item-layer-checkbox");
            if (isVisible) {
                eachLayer.prop('checked', true);
            }
            else {
                eachLayer.prop('checked', false);
            }
        };
        eDwUIBaseEventHandlers.prototype.setLayerVisibility = function (layerNodeIDs, isVisible) {
            var modelHC = this.mViewer.getModel().getHCModel();
            var setNodeVisCmd = new eDwSetNodeVisibilityCmd(this.mViewer, layerNodeIDs, isVisible);
            var cmdMgr = eDwCommandMgr.get();
            cmdMgr.add(setNodeVisCmd);
            cmdMgr.remove(setNodeVisCmd, "commit");
        };
        eDwUIBaseEventHandlers.prototype.setTreeNodeSelected = function (iViewer, iSelObj, iSetSelected) {
            var activeModelView = iViewer.getModel().getActiveModelView();
            function expandNode(iTarget) {
                if (!iTarget.length)
                    return;
                if (!iTarget.hasClass("edrawings-tree-expanded")) {
                    var panelUIID = eDwUIUtils.getUIPanelID(iTarget);
                    if (!$(panelUIID).is(":visible"))
                        return;
                    var gen = eDwUIUtils.getUIGenerator(panelUIID);
                    var offset = parseInt($(iTarget).css("padding-left"), 10);
                    var nodeToExpand = parseInt(iTarget.data("hoopsid"), 10);
                    var hierarchyNode = activeModelView.Nodes[nodeToExpand];
                    var appendNode = iTarget.closest(".edrawings-submenu-list-item");
                    appendNode.after(gen.generateHTMLForChildNodes(hierarchyNode, false, offset));
                    iTarget.addClass("edrawings-tree-expanded");
                }
            }
            var selHierNode = activeModelView.Nodes[iSelObj.getNodeId()];
            if (!selHierNode) {
                return;
            }
            if (iSetSelected && !iViewer.getModel().isDrawing()) {
                var hierNode = selHierNode.ParentNode;
                while (hierNode && hierNode.Category !== "config") {
                    var expandNodes = $('[data-hoopsid="' + hierNode.HOOPSID +
                        '"][class~="edrawings-tree-arrow"]');
                    $.each(expandNodes, function (iIdx, iTarget) {
                        expandNode($(iTarget));
                    });
                    hierNode = hierNode.ParentNode;
                }
            }
            var treeElem = eDwUIUtils.getListElements(iSelObj.getNodeId(), iViewer);
            if (treeElem.ownerDiv.length) {
                var classAction_1 = iSetSelected ? "addClass" : "removeClass";
                $.each(treeElem.node, function (iIdx, iTarget) {
                    $(iTarget)[classAction_1]("edrawings-list-selected");
                });
                $.each(treeElem.ownerDiv, function (iIdx, iTarget) {
                    $(iTarget)[classAction_1]("edrawings-list-selected");
                    if (!$(iTarget).hasClass("edrawings-submenu-list-item")) {
                        return;
                    }
                    var componentMenu = $("#edrawings-component-tree-menu");
                    var menuHidden = componentMenu.is(':hidden');
                    eDwUIUtils.hide("#edrawings-component-tree-menu", !menuHidden);
                    var hasScrollParent = $(iTarget).scrollParent;
                    var ownerDivScrollParent = hasScrollParent ?
                        $(iTarget).scrollParent() : null;
                    var position = ownerDivScrollParent ?
                        ownerDivScrollParent.scrollTop() : 0;
                    var ownerDivPos = $(iTarget).position();
                    position += ownerDivPos ? ownerDivPos.top : 0;
                    var inhibitScroll = $(iTarget).attr("inhibitScroll");
                    if (iSetSelected && !inhibitScroll && hasScrollParent) {
                        if (!menuHidden) {
                            $(iTarget).scrollParent().animate({ scrollTop: position }, "slow");
                        }
                        else {
                            $(iTarget).scrollParent().scrollTop(position);
                        }
                    }
                    $(iTarget).removeAttr("inhibitScroll");
                    eDwUIUtils.hide("#edrawings-component-tree-menu", menuHidden);
                });
            }
        };
        ;
        eDwUIBaseEventHandlers.prototype.handleSelectionChange = function (iViewer, iSelObj, iIsObjSelected) {
            if (!iSelObj)
                return;
            this.setTreeNodeSelected(iViewer, iSelObj, iIsObjSelected);
        };
        ;
        eDwUIBaseEventHandlers.prototype.handleNodeAttribChange = function (iViewer, iHierNodesAndAttribs) {
            eDwUIUtils.updateIcons(iHierNodesAndAttribs);
        };
        eDwUIBaseEventHandlers.prototype.populateMBDNotes = function (iViewer) {
            var _this = this;
            var model = iViewer.getModel();
            var modelHC = model.getHCModel();
            var viewHC = iViewer.getHCView();
            var modelViews = model.getModelViews();
            var _loop_1 = function (modelView) {
                var hierNode = modelView.Hierarchy;
                var children = modelHC.getNodeChildren(hierNode.HOOPSID);
                var count = children.length;
                var modelIDs = [];
                var noteIDs = [];
                for (var j = 0; j < count; j++) {
                    var name_3 = modelHC.getNodeName(children[j]);
                    if (-1 === name_3.indexOf("annot") &&
                        -1 === name_3.indexOf("dim") && -1 === name_3.indexOf("ANNOT")) {
                        modelIDs.push(children[j]);
                    }
                    if (-1 !== name_3.indexOf("#ANNOTNOTE")) {
                        noteIDs.push(children[j]);
                    }
                }
                (function () { return __awaiter(_this, void 0, void 0, function () {
                    var boxModel, i, iExcp_13;
                    return __generator(this, function (_a) {
                        switch (_a.label) {
                            case 0:
                                _a.trys.push([0, 2, , 3]);
                                return [4, modelHC.getNodesBounding(modelIDs)];
                            case 1:
                                boxModel = _a.sent();
                                for (i = 0; i < noteIDs.length; ++i) {
                                    iViewer.MBDNoteMgr.addNote(noteIDs[i], boxModel);
                                }
                                return [3, 3];
                            case 2:
                                iExcp_13 = _a.sent();
                                console.debugLog("MBD", "MBD: " + iExcp_13.message);
                                return [3, 3];
                            case 3: return [2];
                        }
                    });
                }); })();
            };
            for (var _i = 0, modelViews_4 = modelViews; _i < modelViews_4.length; _i++) {
                var modelView = modelViews_4[_i];
                _loop_1(modelView);
            }
        };
        return eDwUIBaseEventHandlers;
    }());
    ;
    function getAllChildIDs(iModelHC, iIDs) {
        var childIDs = [];
        for (var _i = 0, iIDs_1 = iIDs; _i < iIDs_1.length; _i++) {
            var selID = iIDs_1[_i];
            childIDs = childIDs.concat(iModelHC.getNodeChildren(selID));
        }
        return childIDs.length ? iIDs.concat(getAllChildIDs(iModelHC, childIDs))
            : iIDs;
    }
    function getHCID(ioTarget) {
        if (!ioTarget)
            return Number.NaN;
        return parseInt(ioTarget.data("hoopsid"), 10);
    }
    function populateMarkupList() {
        var _this = this;
        (function () { return __awaiter(_this, void 0, void 0, function () {
            var list, gen, _a, _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        list = $("#edrawings-markup-view-list");
                        list.empty();
                        gen = eDwUIUtils.getUIGenerator("#edrawings-markup-menu");
                        _b = (_a = list).append;
                        return [4, gen.generateHTML("")];
                    case 1:
                        _b.apply(_a, [_c.sent()]);
                        return [2];
                }
            });
        }); })();
    }
    return eDwUIBaseEventHandlers;
});
define("eDwUICompTreeHTMLGenerator", ["require", "exports", "eDwUIHTMLGenerator"], function (require, exports, eDwUIHTMLGenerator) {
    "use strict";
    var eDwUICompTreeHTMLGenerator = (function (_super) {
        __extends(eDwUICompTreeHTMLGenerator, _super);
        function eDwUICompTreeHTMLGenerator(iViewer, iPanelUIID) {
            return _super.call(this, iViewer, iPanelUIID) || this;
        }
        eDwUICompTreeHTMLGenerator.prototype.shouldIncludeNode = function (iHierNode) {
            if (iHierNode.Category === "table")
                return false;
            return _super.prototype.shouldIncludeNode.call(this, iHierNode);
        };
        return eDwUICompTreeHTMLGenerator;
    }(eDwUIHTMLGenerator));
    ;
    return eDwUICompTreeHTMLGenerator;
});
define("eDwUIContextMenu", ["require", "exports", "eDwUIHTMLEventMgr", "eDwCommandMgr", "eDwSetHierNodeAttribsCmd", "eDwSelIsolateCmd", "eDwUIUtils"], function (require, exports, eDwUIHTMLEventMgr, eDwCommandMgr, eDwSetHierNodeAttribsCmd, eDwSelIsolateCmd, eDwUIUtils) {
    "use strict";
    var eDwUIContextMenu = (function () {
        function eDwUIContextMenu(iViewer, iViewerHTMLCanvasID) {
            var _this = this;
            this.mViewer = iViewer;
            this.mViewerHTMLCanvasID = iViewerHTMLCanvasID;
            var eventMgrHTML = this.mUIHTMLEventMgr = new eDwUIHTMLEventMgr();
            eventMgrHTML.addDelegatedEventHandler("#edrawings-context-menu .edw-context-show-all", "click", function (iEvent) {
                var modelView = _this.mViewer.getModel().getActiveModelView();
                var attrib = { Visible: true };
                var showAllCmd = new eDwSetHierNodeAttribsCmd(_this.mViewer, modelView.getNodes(), attrib);
                var cmdMgr = eDwCommandMgr.get();
                cmdMgr.add(showAllCmd);
                cmdMgr.remove(showAllCmd, "commit");
                _this.hide();
            });
            eventMgrHTML.addDelegatedEventHandler("#edrawings-context-menu .edw-context-hide-show", "click", function (iEvent) {
                var selMgr = _this.mViewer.SelectionMgr;
                var selHierNodes = selMgr.getSelHierarchyNodes();
                if (selHierNodes && selHierNodes.length) {
                    var attrib = {
                        Visible: !selHierNodes[0].getAttribs().Visible
                    };
                    var selHideShowCmd = new eDwSetHierNodeAttribsCmd(_this.mViewer, selHierNodes, attrib);
                    var cmdMgr = eDwCommandMgr.get();
                    cmdMgr.add(selHideShowCmd);
                    cmdMgr.remove(selHideShowCmd, "commit");
                }
                _this.hide();
            });
            eventMgrHTML.addDelegatedEventHandler("#edrawings-context-menu .edw-context-transp-solid", "click", function (iEvent) {
                var selMgr = _this.mViewer.SelectionMgr;
                var selHierNodes = selMgr.getSelHierarchyNodes();
                if (selHierNodes && selHierNodes.length) {
                    var attrib = {
                        Visible: true,
                        Opaque: !selHierNodes[0].getAttribs().Opaque
                    };
                    var selTransSolidCmd = new eDwSetHierNodeAttribsCmd(_this.mViewer, selHierNodes, attrib);
                    var cmdMgr = eDwCommandMgr.get();
                    cmdMgr.add(selTransSolidCmd);
                    cmdMgr.remove(selTransSolidCmd, "commit");
                }
                _this.hide();
            });
            eventMgrHTML.addDelegatedEventHandler("#edrawings-context-menu .edw-context-isolate", "click", function (iEvent) {
                var selIsolateCmd = new eDwSelIsolateCmd(_this.mViewer);
                var cmdMgr = eDwCommandMgr.get();
                cmdMgr.add(selIsolateCmd);
                cmdMgr.remove(selIsolateCmd, "commit");
                _this.hide();
            });
            eventMgrHTML.addDelegatedEventHandler("#edrawings-context-menu .edw-measure-remove", "click", function (iEvent) {
                var selMeasureItem = $("#edrawings-measure-menu .edrawings-list-selected");
                if (selMeasureItem) {
                    var indexStr = selMeasureItem.attr("index");
                    if (indexStr) {
                        var index = parseInt(indexStr);
                        _this.mViewer.MeasureMgr.removeMeasureEntityAt(index);
                        _this.hide();
                    }
                }
            });
            eventMgrHTML.addDelegatedEventHandler("#edrawings-context-menu .edw-measure-clear", "click", function (iEvent) {
                _this.mViewer.MeasureMgr.clearMeasureEntities();
                _this.mViewer.MeasureMgr.dehighlightAllSelectEntity();
                _this.hide();
            });
            eventMgrHTML.addEventHandler("#edrawings-context-menu", "contextmenu", eDwUIUtils.inhibitEventBehavior);
        }
        eDwUIContextMenu.prototype.removeAllEventHandlers = function () {
            this.mUIHTMLEventMgr.removeAllEventHandlers();
        };
        eDwUIContextMenu.prototype.show = function (iX, iY, iSelector) {
            eDwUIUtils.hide(".edrawings-context-menu", true);
            var selectors = iSelector.split(" ");
            var contextMenus = eDwUIUtils.hide(selectors ? selectors[0] : "", false);
            selectors.shift();
            var itemsToHide = selectors.join(" ");
            eDwUIUtils.hide(itemsToHide, true);
            var canvasObj = $("#" + this.mViewerHTMLCanvasID);
            console.assert(typeof (canvasObj) === "object", "The ID for the HTML canvas element is missing or wrong.");
            var canvasHeight = canvasObj.height();
            var canvasWidth = canvasObj.width();
            var contextMenu = $("#edrawings-context-menu");
            var menuHeight = contextMenu.height();
            var menuWidth = contextMenu.width();
            var posx = iX;
            if (posx + menuWidth > canvasWidth) {
                posx = canvasWidth - menuWidth - 5;
            }
            var posy = iY;
            if (posy + menuHeight > canvasHeight) {
                posy = canvasHeight - menuHeight - 5;
            }
            contextMenu.css({ top: posy + "px", left: posx + "px" });
            eDwUIUtils.hide("#edrawings-context-menu", false);
        };
        eDwUIContextMenu.prototype.hide = function () {
            eDwUIUtils.hide("#edrawings-context-menu", true);
        };
        return eDwUIContextMenu;
    }());
    ;
    return eDwUIContextMenu;
});
define("eDwUIDebugHTMLGenerator", ["require", "exports", "eDwUIHTMLGenerator"], function (require, exports, eDwUIHTMLGenerator) {
    "use strict";
    var eDwUIDebugHTMLGenerator = (function (_super) {
        __extends(eDwUIDebugHTMLGenerator, _super);
        function eDwUIDebugHTMLGenerator(iViewer, iPanelUIID) {
            var _this = _super.call(this, iViewer, iPanelUIID) || this;
            _this.mHCModel = iViewer.getModel().getHCModel();
            return _this;
        }
        eDwUIDebugHTMLGenerator.prototype.getNodeFromID = function (iNodeID) {
            return getHCNode(iNodeID);
        };
        eDwUIDebugHTMLGenerator.prototype.getPostSpanHTML = function (iAdditionalClasses) {
            return "";
        };
        eDwUIDebugHTMLGenerator.prototype.forNodeGetName = function (iNode) {
            return this.mHCModel.getNodeName(getHCNode(iNode));
        };
        eDwUIDebugHTMLGenerator.prototype.forNodeGetID = function (iNode) {
            return getHCNode(iNode);
        };
        eDwUIDebugHTMLGenerator.prototype.forNodeGetParentID = function (iNode) {
            return this.mHCModel.getNodeParent(getHCNode(iNode));
        };
        eDwUIDebugHTMLGenerator.prototype.forNodeGetChildren = function (iNode) {
            return this.mHCModel.getNodeChildren(getHCNode(iNode));
        };
        eDwUIDebugHTMLGenerator.prototype.forNodeHasChildren = function (iNode) {
            return this.forNodeGetChildren(iNode).length > 0;
        };
        eDwUIDebugHTMLGenerator.prototype.forNodeGetDataAttributes = function (iNode) {
            return _super.prototype.forNodeGetDataAttributes.call(this, iNode);
        };
        eDwUIDebugHTMLGenerator.prototype.forNodeGetElementContent = function (iNode) {
            var nodeHCID = this.forNodeGetID(iNode);
            return this.forNodeGetName(iNode) + " ID: " + nodeHCID +
                " TYPE: " + this.mHCModel.getNodeType(nodeHCID);
        };
        eDwUIDebugHTMLGenerator.prototype.forNodeGetDisplayStateCSSClass = function (iNode) {
            return "edrawings-body-visible";
        };
        return eDwUIDebugHTMLGenerator;
    }(eDwUIHTMLGenerator));
    ;
    function isHCNode(iNode) {
        return !isNaN(iNode);
    }
    function getHCNode(iNode) {
        if (!isHCNode(iNode)) {
            throw new Error("Not an HC node:\n" + JSON.stringify(iNode));
        }
        return iNode;
    }
    return eDwUIDebugHTMLGenerator;
});
define("eDwUIHTMLEventMgr", ["require", "exports"], function (require, exports) {
    "use strict";
    var eDwUIHTMLEventMgr = (function () {
        function eDwUIHTMLEventMgr() {
            this.mEventHandlerData = {};
        }
        eDwUIHTMLEventMgr.prototype.addDelegatedEventHandler = function (iElemSelector, iEventName, iEventHandler) {
            if (!iElemSelector || !iEventName || !iEventHandler)
                return false;
            var selectors = iElemSelector.split(' ');
            if (selectors.length < 2)
                return false;
            var ancestorElementID = selectors.shift();
            var ancestorElementJQ = $(ancestorElementID);
            if (!ancestorElementJQ)
                return false;
            var ancestorElement = $(ancestorElementJQ)[0];
            if (!ancestorElement)
                return false;
            return this.commonAddEventHandler(ancestorElementJQ, iEventName, iEventHandler, selectors.join().replace(".", ""));
        };
        eDwUIHTMLEventMgr.prototype.addEventHandler = function (iElemID, iEventName, iEventHandler) {
            if (!iElemID || !iEventName || !iEventHandler)
                return false;
            var elementJQ;
            if (iElemID === "window") {
                elementJQ = $(window);
                elementJQ[0].id = "window";
                elementJQ[0].className = "";
                elementJQ[0].nodeType = Node.ELEMENT_NODE;
            }
            else if (iElemID === "document") {
                elementJQ = $(document);
                elementJQ[0].id = "document";
                elementJQ[0].className = "";
            }
            else {
                elementJQ = $(iElemID);
            }
            if (!elementJQ)
                return false;
            var element = $(elementJQ)[0];
            if (!element)
                return false;
            return this.commonAddEventHandler(elementJQ, iEventName, iEventHandler);
        };
        eDwUIHTMLEventMgr.prototype.removeAllEventHandlers = function () {
            for (var eventName in this.mEventHandlerData) {
                if (this.mEventHandlerData.hasOwnProperty(eventName)) {
                    var handlersOfEvent = this.mEventHandlerData[eventName];
                    for (var elemID in handlersOfEvent) {
                        if (handlersOfEvent.hasOwnProperty(elemID)) {
                            this.removeEventHandlersByID(elemID, eventName, handlersOfEvent);
                        }
                    }
                    this.mEventHandlerData[eventName] = {};
                }
            }
            this.mEventHandlerData = {};
        };
        eDwUIHTMLEventMgr.prototype.removeEventHandlers = function (iElemID, iEventName) {
            var handlersRemoved = false;
            if (this.mEventHandlerData.hasOwnProperty(iEventName)) {
                var handlersOfEvent = this.mEventHandlerData[iEventName];
                if (handlersOfEvent.hasOwnProperty(iElemID)) {
                    handlersRemoved = this.removeEventHandlersByID(iElemID, iEventName, handlersOfEvent);
                }
            }
            return handlersRemoved;
        };
        eDwUIHTMLEventMgr.prototype.commonAddEventHandler = function (iElementJQ, iEventName, iEventHandler, iElemClasses) {
            if (iElemClasses === void 0) { iElemClasses = ""; }
            if (!iElementJQ || !$(iElementJQ))
                return false;
            var element = $(iElementJQ)[0];
            if (!element)
                return false;
            var eventHandlerData = this.mEventHandlerData;
            var handlersOfEvent = eventHandlerData[iEventName];
            if (!handlersOfEvent) {
                handlersOfEvent = eventHandlerData[iEventName] = {};
            }
            var elemHandlers = handlersOfEvent[element.id];
            if (!elemHandlers) {
                elemHandlers = handlersOfEvent[element.id] = {
                    MainDispatcher: null,
                    Handlers: []
                };
            }
            if (elemHandlers.MainDispatcher) {
                element.removeEventListener(iEventName, elemHandlers.MainDispatcher, true);
            }
            elemHandlers.MainDispatcher =
                function (ioEvent) {
                    eventDispatcher(ioEvent, elemHandlers.Handlers);
                };
            element.addEventListener(iEventName, elemHandlers.MainDispatcher, true);
            elemHandlers.Handlers.push({
                Element: element,
                TargetElemClasses: iElemClasses,
                Handler: iEventHandler
            });
            console.debugLog("UIEvents", "Event name = " + iEventName + ", id = " +
                element.id + ", classes = " + iElemClasses +
                ", Num handlers = " + elemHandlers.Handlers.length);
            return true;
        };
        eDwUIHTMLEventMgr.prototype.removeEventHandlersByID = function (iElemID, iEventName, ioHandlersOfEvent) {
            var handlersRemoved = false;
            var elemHandlers = ioHandlersOfEvent[iElemID];
            if (!elemHandlers) {
                elemHandlers = ioHandlersOfEvent[iElemID] = {
                    MainDispatcher: null,
                    Handlers: []
                };
            }
            if (elemHandlers.Handlers.length) {
                var handler = elemHandlers.Handlers[0];
                handler.Element.removeEventListener(iEventName, elemHandlers.MainDispatcher, true);
                handlersRemoved = true;
            }
            return handlersRemoved;
        };
        return eDwUIHTMLEventMgr;
    }());
    ;
    function eventDispatcher(ioEvent, iHandlerObjs) {
        var handlers = iHandlerObjs;
        if (!iHandlerObjs || !iHandlerObjs.length)
            return;
        console.debugLog("UIEvents", "Event = " + ioEvent.type +
            ", Num handlers = " + iHandlerObjs.length);
        var runHandler = false;
        var eventTarget = ioEvent.target;
        while (eventTarget && !runHandler) {
            for (var i = 0; i < iHandlerObjs.length; i++) {
                console.debugLog("UIEvents", "  element ID = " +
                    iHandlerObjs[i].Element.id +
                    ", target classes = " +
                    iHandlerObjs[i].TargetElemClasses +
                    ", event target classes = " +
                    eventTarget.className);
                var classes = iHandlerObjs[i].TargetElemClasses.split(' ');
                var numMatches = 0;
                for (var j = 0; j < classes.length; j++) {
                    numMatches += $(eventTarget).hasClass(classes[j]) ? 1 : 0;
                }
                if (numMatches !== classes.length)
                    continue;
                iHandlerObjs[i].Handler(ioEvent);
                runHandler = true;
                if ((ioEvent.cancelable && ioEvent.cancelBubble) ||
                    (ioEvent.isPropagationStopped &&
                        ioEvent.isPropagationStopped())) {
                    return;
                }
            }
            eventTarget = eventTarget.parentElement;
            if (!runHandler && eventTarget) {
                console.debugLog("UIEvents", "Events not found on target, checking parent(" +
                    "id=" + eventTarget.id + ", class=" +
                    eventTarget.className);
            }
            else if (!runHandler) {
                console.debugLog("UIEvents", "No matching events found on target.");
            }
            else {
                console.debugLog("UIEvents", "Done processing event handlers.");
            }
        }
    }
    return eDwUIHTMLEventMgr;
});
define("eDwUIHTMLGenerator", ["require", "exports", "eDwHierarchyNode"], function (require, exports, eDwHierarchyNode) {
    "use strict";
    var cDefaultInitialLeftPaddingInPX = 4;
    var cDefaultLeftPaddingInPX = 27;
    var eDwUIHTMLGenerator = (function () {
        function eDwUIHTMLGenerator(iViewer, iPanelUIID, iInitialLeftPaddingInPX, iLeftPaddingInPX) {
            if (iInitialLeftPaddingInPX === void 0) { iInitialLeftPaddingInPX = cDefaultInitialLeftPaddingInPX; }
            if (iLeftPaddingInPX === void 0) { iLeftPaddingInPX = cDefaultLeftPaddingInPX; }
            this.mViewer = iViewer;
            this.mPanelUIID = iPanelUIID;
            this.mLeftPaddingInPX = iLeftPaddingInPX;
            this.mInitialLeftPaddingInPX = iInitialLeftPaddingInPX;
        }
        eDwUIHTMLGenerator.prototype.generateHTMLForChildNodes = function (iParentNode, iIncludeAllDescendents, iLeftPaddingInPX) {
            if (iIncludeAllDescendents === void 0) { iIncludeAllDescendents = false; }
            var generatedHTML = "";
            var offset = iLeftPaddingInPX === undefined
                ? this.mInitialLeftPaddingInPX
                : iLeftPaddingInPX + this.mLeftPaddingInPX;
            var childrenNodes = this.forNodeGetChildren(iParentNode);
            for (var _i = 0, childrenNodes_1 = childrenNodes; _i < childrenNodes_1.length; _i++) {
                var childNode = childrenNodes_1[_i];
                var descendentsHTML = iIncludeAllDescendents
                    ? this.generateHTMLForChildNodes(childNode, iIncludeAllDescendents, offset)
                    : "";
                if (!this.shouldIncludeNode(childNode) &&
                    descendentsHTML.length === 0) {
                    continue;
                }
                var moreClasses = descendentsHTML ? " edrawings-tree-expanded "
                    : "";
                var nodeHTML = this.generateHTMLForNode(childNode, offset, moreClasses);
                generatedHTML += nodeHTML + descendentsHTML;
            }
            return generatedHTML;
        };
        eDwUIHTMLGenerator.prototype.generateHTMLForNode = function (iNode, iLeftPaddingInPX, iAdditionalClasses, iIgnoreChildren) {
            if (iAdditionalClasses === void 0) { iAdditionalClasses = ""; }
            if (iIgnoreChildren === void 0) { iIgnoreChildren = false; }
            var additionalClasses = iAdditionalClasses.replace("edrawings-tree-expanded", "");
            var expanded = iAdditionalClasses.length !== additionalClasses.length;
            var nonRootClass = additionalClasses.indexOf("edrawings-root") > -1
                ? "" : " edrawings-list-option ";
            var highlight = this.getHighlightClass(iNode);
            var currOffset = iLeftPaddingInPX === undefined
                ? this.mInitialLeftPaddingInPX + "px"
                : iLeftPaddingInPX + "px";
            var generatedHTML = "<div class='edrawings-submenu-list-item" +
                highlight + " " + additionalClasses +
                "' style='padding-left: " + currOffset +
                "; width:calc(100% - " + currOffset + ");' " +
                this.forNodeGetDataAttributes(iNode) + ">";
            generatedHTML += this.getPreSpanHTML(iNode, additionalClasses, expanded, iIgnoreChildren);
            generatedHTML += "<span class='item-tree-text" + highlight + " " +
                additionalClasses + "' " + this.forNodeGetDataAttributes(iNode) +
                "style='margin-left: 0px;'>" +
                this.forNodeGetElementContent(iNode) + "</span>";
            generatedHTML += this.getPostSpanHTML(nonRootClass + " " +
                additionalClasses);
            generatedHTML += "</div>";
            return generatedHTML;
        };
        eDwUIHTMLGenerator.prototype.getNodeFromID = function (iNodeID) {
            var modelViews = this.mViewer.getModel().getModelViews();
            for (var _i = 0, modelViews_5 = modelViews; _i < modelViews_5.length; _i++) {
                var modelView = modelViews_5[_i];
                var hierNode = modelView.Nodes[iNodeID];
                if (hierNode)
                    return hierNode;
            }
            return undefined;
        };
        eDwUIHTMLGenerator.getDisplayStateCSSClass = function (iHierNode, iNewAttrib) {
            var classCSS = "edrawings-" + iHierNode.Category;
            classCSS += iHierNode.isActive() ? "" : "-inactive";
            var dummyNode = eDwHierarchyNode.create(iNewAttrib);
            var displayState = iNewAttrib
                ? dummyNode.getDisplayState(iHierNode.getAttribs())
                : iHierNode.getDisplayState();
            switch (displayState) {
                case "Invisible":
                    classCSS += "-invisible";
                    break;
                case "Visible":
                    classCSS += "-visible";
                    break;
                case "Transparent":
                    classCSS += "-transparent";
                    break;
                default: console.debugLog("UI", "Invalid node display type: " +
                    displayState);
            }
            return classCSS;
        };
        eDwUIHTMLGenerator.prototype.shouldIncludeNode = function (iNode) {
            var searchField = $(this.mPanelUIID + " .edrawings-menu-search-input");
            if (searchField && searchField.val()) {
                var regex = new RegExp(searchField.val(), "i");
                if (this.forNodeGetName(iNode).search(regex) < 0)
                    return false;
            }
            return true;
        };
        eDwUIHTMLGenerator.prototype.getHighlightClass = function (iNode) {
            var isSelected = this.mViewer.SelectionMgr.isSelected(this.forNodeGetID(iNode));
            return isSelected ? " edrawings-list-selected " : "";
        };
        eDwUIHTMLGenerator.prototype.getPreSpanIconHTML = function (iNode, iAdditionalClasses, iNodeExpanded, iIgnoreChildren) {
            var generatedHTML = "";
            if (!iIgnoreChildren && this.forNodeHasChildren(iNode)) {
                generatedHTML += "edrawings-tree-arrow " +
                    "edrawings-tree-arrow-space-common ";
                if (iNodeExpanded)
                    generatedHTML += "edrawings-tree-expanded ";
            }
            else {
                generatedHTML += "edrawings-tree-space " +
                    "edrawings-tree-arrow-space-common ";
            }
            return generatedHTML;
        };
        eDwUIHTMLGenerator.prototype.getPreSpanHTML = function (iNode, iAdditionalClasses, iNodeExpanded, iIgnoreChildren) {
            var generatedHTML = "<div class='" + this.getPreSpanIconHTML(iNode, iAdditionalClasses, iNodeExpanded, iIgnoreChildren);
            var nodeIconClass = this.forNodeGetDisplayStateCSSClass(iNode);
            generatedHTML += iAdditionalClasses + "' data-hoopsid='" +
                this.forNodeGetID(iNode) + "'> </div> <div class='" +
                nodeIconClass + " " + iAdditionalClasses +
                " edrawings-tree-icon'> </div>";
            return generatedHTML;
        };
        eDwUIHTMLGenerator.prototype.getPostSpanHTML = function (iAdditionalClasses) {
            return "<div class='edrawings-submenu-list-item-button " +
                iAdditionalClasses + "'> </div>";
        };
        eDwUIHTMLGenerator.prototype.forNodeGetName = function (iNode) {
            return getHierarchyNode(iNode).Name;
        };
        eDwUIHTMLGenerator.prototype.forNodeGetID = function (iNode) {
            return getHierarchyNode(iNode).HOOPSID;
        };
        eDwUIHTMLGenerator.prototype.forNodeGetParentID = function (iNode) {
            var parentHierNode = getHierarchyNode(iNode).ParentNode;
            return parentHierNode ? parentHierNode.HOOPSID : undefined;
        };
        eDwUIHTMLGenerator.prototype.forNodeGetChildren = function (iNode) {
            var childrenObj = getHierarchyNode(iNode).getChildren();
            return Object.keys(childrenObj).map(function (key) { return childrenObj[key]; });
        };
        eDwUIHTMLGenerator.prototype.forNodeHasChildren = function (iNode) {
            return this.forNodeGetChildren(iNode).length > 0;
        };
        eDwUIHTMLGenerator.prototype.forNodeGetDataAttributes = function (iNode) {
            var parentNodeID = this.forNodeGetParentID(iNode);
            return " data-hoopsid='" + this.forNodeGetID(iNode) + "' " +
                (parentNodeID !== undefined ? "data-hoopsparentid='" +
                    parentNodeID + "' "
                    : "");
        };
        eDwUIHTMLGenerator.prototype.forNodeGetElementContent = function (iNode) {
            return this.forNodeGetName(iNode);
        };
        eDwUIHTMLGenerator.prototype.forNodeGetDisplayStateCSSClass = function (iNode) {
            return eDwUIHTMLGenerator.getDisplayStateCSSClass(getHierarchyNode(iNode));
        };
        return eDwUIHTMLGenerator;
    }());
    ;
    function isHierarchyNode(iNode) {
        return iNode.Name;
    }
    function getHierarchyNode(iNode) {
        if (!isHierarchyNode(iNode)) {
            throw new Error("Not a hierarchy node:\n" + JSON.stringify(iNode));
        }
        return iNode;
    }
    return eDwUIHTMLGenerator;
});
define("eDwUILayerHTMLGenerator", ["require", "exports", "eDwUIHTMLGenerator"], function (require, exports, eDwUIHTMLGenerator) {
    "use strict";
    var eDwUILayerHTMLGenerator = (function (_super) {
        __extends(eDwUILayerHTMLGenerator, _super);
        function eDwUILayerHTMLGenerator(iViewer, iPanelUIID) {
            return _super.call(this, iViewer, iPanelUIID) || this;
        }
        eDwUILayerHTMLGenerator.prototype.generateHTML = function (iAdditionalClasses) {
            return __awaiter(this, void 0, void 0, function () {
                var generatedHTML, activeModelView, layerNodes, _i, layerNodes_1, layerNode;
                return __generator(this, function (_a) {
                    generatedHTML = "";
                    activeModelView = this.mViewer.getModel().getActiveModelView();
                    if (activeModelView && activeModelView.Hierarchy) {
                        layerNodes = activeModelView.Hierarchy.findNodes("Category", "layer");
                        if (layerNodes.length) {
                            generatedHTML += "<div class='edrawings-submenu-list-item' " +
                                "style='padding-left: " +
                                this.mInitialLeftPaddingInPX + "px; " +
                                "width:calc(100% - " +
                                this.mInitialLeftPaddingInPX + "px);'> " +
                                "<input id='layer-all' class='layer-all " +
                                " edrawings-layer-checkbox-style' " +
                                " type='checkbox' checked> " +
                                "<span class='item-tree-text'>" +
                                "Select all</span></div>";
                        }
                        for (_i = 0, layerNodes_1 = layerNodes; _i < layerNodes_1.length; _i++) {
                            layerNode = layerNodes_1[_i];
                            if (!this.shouldIncludeNode(layerNode))
                                continue;
                            generatedHTML += this.generateHTMLForNode(layerNode, undefined, "edrawings-root " +
                                iAdditionalClasses, true);
                        }
                    }
                    return [2, generatedHTML];
                });
            });
        };
        eDwUILayerHTMLGenerator.prototype.getPreSpanHTML = function (iHierNode, iAdditionalClasses, iNodeExpanded, iIgnoreChildren) {
            return "<input class='item-layer-checkbox" +
                " edrawings-layer-checkbox-style' type='checkbox' " +
                (iHierNode.getAttribs().Visible ? "checked" : "unchecked") +
                ">";
        };
        eDwUILayerHTMLGenerator.prototype.getPostSpanHTML = function (iAdditionalClasses) {
            return "";
        };
        return eDwUILayerHTMLGenerator;
    }(eDwUIHTMLGenerator));
    ;
    return eDwUILayerHTMLGenerator;
});
define("eDwUIMarkupHTMLGenerator", ["require", "exports", "eDwUIHTMLGenerator"], function (require, exports, eDwUIHTMLGenerator) {
    "use strict";
    var eDwUIMarkupHTMLGenerator = (function (_super) {
        __extends(eDwUIMarkupHTMLGenerator, _super);
        function eDwUIMarkupHTMLGenerator(iViewer, iPanelUIID) {
            return _super.call(this, iViewer, iPanelUIID) || this;
        }
        eDwUIMarkupHTMLGenerator.prototype.generateHTML = function (iAdditionalClasses) {
            return __awaiter(this, void 0, void 0, function () {
                var generatedHTML, markupMgr, keys, i, view;
                return __generator(this, function (_a) {
                    generatedHTML = "";
                    markupMgr = this.mViewer.HCViewer.getMarkupManager();
                    keys = markupMgr.getMarkupViewKeys();
                    for (i = 0; i < keys.length; ++i) {
                        view = markupMgr.getMarkupView(keys[i]);
                        generatedHTML = "<div class='edrawings-submenu-list-item " +
                            "edrawings-markup-view' key='" + keys[i] + "'>" +
                            "<div class='edrawings-tree-space'> </div>" +
                            "<span class='edrawings-markup-view-name'>" +
                            view.getName() + "</span></div>";
                    }
                    return [2, generatedHTML];
                });
            });
        };
        return eDwUIMarkupHTMLGenerator;
    }(eDwUIHTMLGenerator));
    ;
    return eDwUIMarkupHTMLGenerator;
});
define("eDwUIMeasureHTMLGenerator", ["require", "exports", "eDwUIHTMLGenerator"], function (require, exports, eDwUIHTMLGenerator) {
    "use strict";
    var eDwUIMeasureHTMLGenerator = (function (_super) {
        __extends(eDwUIMeasureHTMLGenerator, _super);
        function eDwUIMeasureHTMLGenerator(iViewer, iPanelUIID) {
            return _super.call(this, iViewer, iPanelUIID) || this;
        }
        eDwUIMeasureHTMLGenerator.prototype.setMeasureResult = function (iMeasureResult) {
            this.mMeasureResult = iMeasureResult;
        };
        eDwUIMeasureHTMLGenerator.prototype.generateHTML = function (iAdditionalClasses) {
            return __awaiter(this, void 0, void 0, function () {
                var generatedHTML, model, fCount, lCount, pCount, i, obj, faceEntity, lineEntity, pointEntity, nodeId, eType, count, highlight, status_1;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            generatedHTML = "";
                            model = this.mViewer.getModel().getHCModel();
                            fCount = 0, lCount = 0, pCount = 0;
                            i = 0;
                            _a.label = 1;
                        case 1:
                            if (!(i < this.mMeasureResult.SelObjs.length)) return [3, 10];
                            obj = this.mMeasureResult.SelObjs[i];
                            faceEntity = obj.getFaceEntity();
                            lineEntity = obj.getLineEntity();
                            pointEntity = obj.getPointEntity();
                            nodeId = obj.getNodeId();
                            eType = "", count = 0;
                            highlight = false;
                            if (!faceEntity) return [3, 3];
                            fCount++;
                            eType = "Face";
                            count = fCount;
                            return [4, model.getNodeFaceHighlighted(nodeId, faceEntity.getCadFaceIndex())];
                        case 2:
                            highlight = _a.sent();
                            return [3, 8];
                        case 3:
                            if (!lineEntity) return [3, 5];
                            lCount++;
                            eType = "Edge";
                            count = lCount;
                            return [4, model.getNodeLineHighlighted(nodeId, lineEntity.getLineId())];
                        case 4:
                            highlight = _a.sent();
                            return [3, 8];
                        case 5:
                            if (!pointEntity) return [3, 7];
                            pCount++;
                            eType = "Point";
                            count = pCount;
                            return [4, model.getNodePointHighlighted(nodeId, pointEntity.getPointId())];
                        case 6:
                            highlight = _a.sent();
                            return [3, 8];
                        case 7: return [3, 9];
                        case 8:
                            if (this.mMeasureResult.MeasureByPointsOnly) {
                                eType = "Point";
                                count = i + 1;
                            }
                            status_1 = highlight ? " edrawings-list-selected" : "";
                            generatedHTML +=
                                "<div class='edrawings-measure-entities-list-item" +
                                    status_1 + "' index='" + i + "'>" +
                                    "<div class='edrawings-measure-entities-info'>" +
                                    "<span class='edrawings-measure-entities-type'>" + eType +
                                    " -" + count + "\n" + "</span>" +
                                    "<span class='edrawings-measure-entities-type'>" +
                                    this.mMeasureResult.Descriptions[i] + "</span></div>" +
                                    "<img class='edrawings-measure-entities-remove' src= " +
                                    "'edrawings_icons/cross.png' > </div>";
                            _a.label = 9;
                        case 9:
                            ++i;
                            return [3, 1];
                        case 10: return [2, generatedHTML];
                    }
                });
            });
        };
        return eDwUIMeasureHTMLGenerator;
    }(eDwUIHTMLGenerator));
    ;
    return eDwUIMeasureHTMLGenerator;
});
define("eDwUIModelViewHTMLGenerator", ["require", "exports", "eDwUIHTMLGenerator"], function (require, exports, eDwUIHTMLGenerator) {
    "use strict";
    var eDwUIModelViewHTMLGenerator = (function (_super) {
        __extends(eDwUIModelViewHTMLGenerator, _super);
        function eDwUIModelViewHTMLGenerator(iViewer, iPanelUIID) {
            return _super.call(this, iViewer, iPanelUIID) || this;
        }
        eDwUIModelViewHTMLGenerator.prototype.generateHTML = function (iAdditionalClasses) {
            return __awaiter(this, void 0, void 0, function () {
                var generatedHTML, modelViews, _i, modelViews_6, modelView, modelViewHierNode;
                return __generator(this, function (_a) {
                    generatedHTML = "";
                    modelViews = this.mViewer.getModel().getModelViews();
                    for (_i = 0, modelViews_6 = modelViews; _i < modelViews_6.length; _i++) {
                        modelView = modelViews_6[_i];
                        modelViewHierNode = modelView.Hierarchy;
                        if (!this.shouldIncludeNode(modelViewHierNode)) {
                            continue;
                        }
                        generatedHTML += this.generateHTMLForNode(modelViewHierNode, undefined, "edrawings-root " +
                            iAdditionalClasses, true);
                    }
                    return [2, generatedHTML];
                });
            });
        };
        eDwUIModelViewHTMLGenerator.prototype.shouldIncludeNode = function (iHierNode) {
            if (iHierNode.Category === "layer" ||
                iHierNode.Category === "table") {
                return false;
            }
            return _super.prototype.shouldIncludeNode.call(this, iHierNode);
        };
        eDwUIModelViewHTMLGenerator.prototype.getPreSpanIconHTML = function (iNode, iAdditionalClasses, iNodeExpanded, iIgnoreChildren) {
            return "";
        };
        return eDwUIModelViewHTMLGenerator;
    }(eDwUIHTMLGenerator));
    ;
    return eDwUIModelViewHTMLGenerator;
});
define("eDwUIModelViewTabHTMLGenerator", ["require", "exports", "eDwUIHTMLGenerator"], function (require, exports, eDwUIHTMLGenerator) {
    "use strict";
    var eDwUIModelViewTabHTMLGenerator = (function (_super) {
        __extends(eDwUIModelViewTabHTMLGenerator, _super);
        function eDwUIModelViewTabHTMLGenerator(iViewer, iPanelUIID) {
            return _super.call(this, iViewer, iPanelUIID) || this;
        }
        eDwUIModelViewTabHTMLGenerator.prototype.generateHTML = function (iAdditionalClasses) {
            var generatedHTML = "";
            var modelViews = this.mViewer.getModel().getModelViews();
            for (var _i = 0, modelViews_7 = modelViews; _i < modelViews_7.length; _i++) {
                var modelView = modelViews_7[_i];
                var modelViewNode = modelView.Hierarchy;
                generatedHTML += "<div class='edrawings-config-tab' " +
                    "configname='" + modelView.Name + "'>" +
                    "<span class='config-tab-text' " +
                    this.forNodeGetDataAttributes(modelViewNode) +
                    ">" + modelView.Name + "</span></div>";
            }
            return generatedHTML;
        };
        eDwUIModelViewTabHTMLGenerator.prototype.shouldIncludeNode = function (iHierNode) {
            if (iHierNode.Category === "layer" ||
                iHierNode.Category === "table") {
                return false;
            }
            return _super.prototype.shouldIncludeNode.call(this, iHierNode);
        };
        return eDwUIModelViewTabHTMLGenerator;
    }(eDwUIHTMLGenerator));
    ;
    return eDwUIModelViewTabHTMLGenerator;
});
define("eDwUISheetTreeHTMLGenerator", ["require", "exports", "eDwUIHTMLGenerator"], function (require, exports, eDwUIHTMLGenerator) {
    "use strict";
    var eDwUISheetTreeHTMLGenerator = (function (_super) {
        __extends(eDwUISheetTreeHTMLGenerator, _super);
        function eDwUISheetTreeHTMLGenerator(iViewer, iPanelUIID) {
            return _super.call(this, iViewer, iPanelUIID) || this;
        }
        eDwUISheetTreeHTMLGenerator.prototype.shouldIncludeNode = function (iHierNode) {
            if (iHierNode.Category === "layer")
                return false;
            return _super.prototype.shouldIncludeNode.call(this, iHierNode);
        };
        return eDwUISheetTreeHTMLGenerator;
    }(eDwUIHTMLGenerator));
    ;
    return eDwUISheetTreeHTMLGenerator;
});
define("eDwUITableHTMLGenerator", ["require", "exports", "eDwUIHTMLGenerator"], function (require, exports, eDwUIHTMLGenerator) {
    "use strict";
    var eDwUITableHTMLGenerator = (function (_super) {
        __extends(eDwUITableHTMLGenerator, _super);
        function eDwUITableHTMLGenerator(iViewer, iPanelUIID) {
            return _super.call(this, iViewer, iPanelUIID) || this;
        }
        eDwUITableHTMLGenerator.prototype.generateHTML = function (iAdditionalClasses) {
            return __awaiter(this, void 0, void 0, function () {
                var generatedHTML, activeModelView, tableNodes, _i, tableNodes_1, tableNode;
                return __generator(this, function (_a) {
                    generatedHTML = "";
                    activeModelView = this.mViewer.getModel().getActiveModelView();
                    if (activeModelView && activeModelView.Hierarchy) {
                        tableNodes = activeModelView.Hierarchy.findNodes("Category", "table");
                        for (_i = 0, tableNodes_1 = tableNodes; _i < tableNodes_1.length; _i++) {
                            tableNode = tableNodes_1[_i];
                            if (!this.shouldIncludeNode(tableNode))
                                continue;
                            generatedHTML += this.generateHTMLForNode(tableNode, undefined, "edrawings-root " +
                                iAdditionalClasses, true);
                        }
                    }
                    return [2, generatedHTML];
                });
            });
        };
        eDwUITableHTMLGenerator.prototype.getPreSpanIconHTML = function (iNode, iAdditionalClasses, iNodeExpanded, iIgnoreChildren) {
            return "";
        };
        return eDwUITableHTMLGenerator;
    }(eDwUIHTMLGenerator));
    ;
    return eDwUITableHTMLGenerator;
});
define("eDwUIUtils", ["require", "exports", "eDwServiceMgr", "eDwKeyMgr", "eDwUIHTMLGenerator", "eDwUICompTreeHTMLGenerator", "eDwUISheetTreeHTMLGenerator", "eDwUIModelViewHTMLGenerator", "eDwUIModelViewTabHTMLGenerator", "eDwUILayerHTMLGenerator", "eDwUITableHTMLGenerator", "eDwUIAnnotHTMLGenerator", "eDwUIMarkupHTMLGenerator", "eDwUIMeasureHTMLGenerator", "eDwUIDebugHTMLGenerator", "eDwEventMgr", "eDwNodeAttributes", "eDwTypes"], function (require, exports, eDwServiceMgr, eDwKeyMgr, eDwUIHTMLGenerator, eDwUICompTreeHTMLGenerator, eDwUISheetTreeHTMLGenerator, eDwUIModelViewHTMLGenerator, eDwUIModelViewTabHTMLGenerator, eDwUILayerHTMLGenerator, eDwUITableHTMLGenerator, eDwUIAnnotHTMLGenerator, eDwUIMarkupHTMLGenerator, eDwUIMeasureHTMLGenerator, eDwUIDebugHTMLGenerator, eDwEventMgr, eDwNodeAttributes_2, eDwTypes_21) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    function updateIcons(iHierNodesAndAttribs) {
        for (var _i = 0, iHierNodesAndAttribs_4 = iHierNodesAndAttribs; _i < iHierNodesAndAttribs_4.length; _i++) {
            var hierNodeAndAttribs = iHierNodesAndAttribs_4[_i];
            var hierNode = hierNodeAndAttribs.HierNode;
            var attribs = hierNodeAndAttribs.Attribs;
            var listItemDiv = $('[data-hoopsid="' + hierNode.HOOPSID +
                '"][class~="edrawings-submenu-list-item"]');
            var iconDiv = listItemDiv.children("div.edrawings-tree-icon");
            iconDiv.removeClass(l_getAllDisplayStateCSSClasses(hierNode));
            var newCSSClass = eDwUIHTMLGenerator.getDisplayStateCSSClass(hierNode, attribs);
            iconDiv.addClass(newCSSClass);
        }
    }
    exports.updateIcons = updateIcons;
    ;
    function getListElements(iID, iViewer) {
        if (iID > -1) {
            var hierNode = iViewer.getModel().getHierarchyNode(iID);
            if (hierNode) {
                return {
                    node: $("span[data-hoopsid='" + hierNode.HOOPSID + "']"),
                    ownerDiv: $("div[data-hoopsid='" + hierNode.HOOPSID + "']")
                };
            }
        }
        return null;
    }
    exports.getListElements = getListElements;
    ;
    function createUIGenerators(iViewer) {
        var panelID = "#edrawings-component-tree-menu";
        l_generators[panelID] = new eDwUICompTreeHTMLGenerator(iViewer, panelID);
        panelID = "#edrawings-sheet-tree-menu";
        l_generators[panelID] = new eDwUISheetTreeHTMLGenerator(iViewer, panelID);
        panelID = "#edrawings-layer-control-menu";
        l_generators[panelID] = new eDwUILayerHTMLGenerator(iViewer, panelID);
        panelID = "#edrawings-tables-menu";
        l_generators[panelID] = new eDwUITableHTMLGenerator(iViewer, panelID);
        panelID = "#edrawings-config-navigation";
        l_generators[panelID] = new eDwUIModelViewHTMLGenerator(iViewer, panelID);
        panelID = "#edrawings-configurations-menu";
        l_generators[panelID] = new eDwUIModelViewHTMLGenerator(iViewer, panelID);
        panelID = "#edrawings-config-tab-list";
        l_generators[panelID] = new eDwUIModelViewTabHTMLGenerator(iViewer, panelID);
        panelID = "#edrawings-debug-menu";
        l_generators[panelID] = new eDwUIDebugHTMLGenerator(iViewer, panelID);
        panelID = "#edrawings-annot-control-menu";
        l_generators[panelID] = new eDwUIAnnotHTMLGenerator(iViewer, panelID);
        panelID = "#edrawings-markup-menu";
        l_generators[panelID] = new eDwUIMarkupHTMLGenerator(iViewer, panelID);
        panelID = "#edrawings-measure-menu";
        l_generators[panelID] = new eDwUIMeasureHTMLGenerator(iViewer, panelID);
    }
    exports.createUIGenerators = createUIGenerators;
    function getUIGenerator(iName) {
        return l_generators[iName];
    }
    exports.getUIGenerator = getUIGenerator;
    function getUIPanelID(iTarget) {
        var panelJQ = iTarget.closest(".edrawings-submenu");
        return panelJQ ? "#" + panelJQ[0].id : "";
    }
    exports.getUIPanelID = getUIPanelID;
    function updateUI(iViewer, iModelView) {
        return __awaiter(this, void 0, void 0, function () {
            function regenList(iList, iHTML) {
                iList.empty();
                iList.append(iHTML);
            }
            var list, gen, listHTML, list, gen, modelViews, _i, modelViews_8, modelView;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!iViewer) return [3, 7];
                        return [4, l_populateLayerPanel(iViewer)];
                    case 1:
                        _a.sent();
                        return [4, populateModelViewPanel(iViewer, "#edrawings-configurations-menu", "config-tree-text")];
                    case 2:
                        _a.sent();
                        if (iViewer.ViewerFeatureOpts.Debug)
                            l_populateDebugPanel(iViewer);
                        if (!iViewer.ViewerFeatureOpts.Annot) return [3, 4];
                        return [4, l_populateAnnotPanel(iViewer)];
                    case 3:
                        _a.sent();
                        _a.label = 4;
                    case 4:
                        if (!iViewer.TableMgr.numTables()) return [3, 6];
                        return [4, l_populateTablesPanel(iViewer)];
                    case 5:
                        _a.sent();
                        _a.label = 6;
                    case 6:
                        if (iModelView) {
                            if (iModelView.Category === "config") {
                                list = $("#edrawings-component-tree-menu .edrawings-submenu-list");
                                gen = getUIGenerator("#edrawings-component-tree-menu");
                                regenList(list, gen.generateHTMLForChildNodes(iModelView.Hierarchy, false, undefined));
                            }
                            else {
                                listHTML = "";
                                list = $("#edrawings-sheet-tree-menu .edrawings-submenu-list");
                                gen = getUIGenerator("#edrawings-sheet-tree-menu");
                                modelViews = iViewer.getModel().getModelViews();
                                for (_i = 0, modelViews_8 = modelViews; _i < modelViews_8.length; _i++) {
                                    modelView = modelViews_8[_i];
                                    listHTML += gen.generateHTMLForNode(modelView.Hierarchy, undefined, "edrawings-root");
                                }
                                regenList(list, listHTML);
                            }
                        }
                        _a.label = 7;
                    case 7: return [2];
                }
            });
        });
    }
    exports.updateUI = updateUI;
    function setModelView(iModelView) {
        var elements = $("#edrawings-configurations-menu").find(".edrawings-submenu-list-item");
        elements.removeClass("edrawings-list-selected");
        updateModelViewTargets(iModelView, "[class~='config-tree-text']", "edrawings-list-selected");
    }
    exports.setModelView = setModelView;
    function updateModelViewTargets(iModelView, iFilter, iTargetClass) {
        var targetSpans = $("span[data-hoopsid='" + iModelView.Hierarchy.HOOPSID +
            "']");
        if (targetSpans.length > 0) {
            var viewTab = targetSpans.filter(iFilter);
            if (viewTab.length > 0) {
                viewTab.parent().addClass(iTargetClass);
            }
        }
    }
    exports.updateModelViewTargets = updateModelViewTargets;
    function activatePanelResizeInput(iPanelID, iInputEventIDSuffix, iHandlers) {
        var mouseDown = "mousedown" + iInputEventIDSuffix;
        var mouseMove = "mousemove" + iInputEventIDSuffix;
        var mouseUp = "mouseup" + iInputEventIDSuffix;
        $(document).on(mouseDown, ".edrawings-menu-resizer", function (iEvent) {
            var msg = "Panel resize: " + mouseDown;
            console.debugLog("UIPanelResize", msg);
            iEvent.preventDefault();
            var origMouseX = iEvent.clientX;
            var origMenuWidth = $(iPanelID).width();
            $(document).on(mouseMove, function (iEvent) {
                var pressedLMB = eDwKeyMgr.get().isLMBPressed(iEvent);
                var msg = "Panel resize LMB " + mouseMove + ": ";
                msg += pressedLMB ? "true" : "false";
                console.debugLog("UIPanelResize", msg);
                if (!pressedLMB)
                    return;
                iEvent.preventDefault();
                iHandlers.onResizePanel(iEvent, iPanelID, origMouseX, origMenuWidth);
                iEvent.stopImmediatePropagation();
            });
            iEvent.stopImmediatePropagation();
        });
        $(document).on(mouseUp, function (iEvent) {
            var msg = "Panel resize: " + mouseUp;
            console.debugLog("UIPanelResize", msg);
            iEvent.preventDefault();
            $(document).off(mouseMove);
        });
    }
    exports.activatePanelResizeInput = activatePanelResizeInput;
    function deactivateMoveInput(iInputEventIDSuffix) {
        $(document).off("mousemove" + iInputEventIDSuffix);
        $(document).off("mousedown" + iInputEventIDSuffix);
        $(document).off("mouseup" + iInputEventIDSuffix);
    }
    exports.deactivateMoveInput = deactivateMoveInput;
    function loadComponentHTML(iViewerOpts) {
        l_loadContextMenu();
        l_loadSheetTreePanel();
        l_loadLayerPanel();
        l_loadAnnotPanel();
        l_loadTablesPanel();
        l_loadDebugPanel();
        if (iViewerOpts.Tree) {
            l_loadComponentTreePanel();
        }
        l_loadConfigPanel();
        if (iViewerOpts.Measure) {
            l_loadMeasurePanel();
        }
        l_loadMarkupPanel();
        eDwEventMgr.get().fireEvents("LoadUIPanel");
    }
    exports.loadComponentHTML = loadComponentHTML;
    function inhibitEventBehavior(iEvent) {
        iEvent.preventDefault();
        iEvent.stopPropagation();
    }
    exports.inhibitEventBehavior = inhibitEventBehavior;
    function getCurrentMeasureMode() {
        var vertexEnabled = l_isActive("#edrawings-measure-vertex-button") ?
            eDwTypes_21.MeasureMode.VERTEX : 0;
        var edgeEnabled = l_isActive("#edrawings-measure-edge-button") ?
            eDwTypes_21.MeasureMode.EDGE : 0;
        var faceEnabled = l_isActive("#edrawings-measure-face-button") ?
            eDwTypes_21.MeasureMode.FACE : 0;
        var holeEnabled = l_isActive("#edrawings-measure-hole-button") ?
            eDwTypes_21.MeasureMode.HOLE : 0;
        return vertexEnabled | edgeEnabled | faceEnabled | holeEnabled;
    }
    exports.getCurrentMeasureMode = getCurrentMeasureMode;
    function syncMeasureModeUI(iMeasureMgr) {
        function setMeasureButton(iID, iMeasureModes, iTargetModes) {
            var method = iMeasureModes & iTargetModes ? "addClass" : "removeClass";
            $(iID)[method]("active-button");
        }
        $("#edrawings-measure-distant-unit").val(iMeasureMgr.getDistanceUnit());
        $("#edrawings-measure-angle-unit").val(iMeasureMgr.getAngleUnit());
        var measureMode = iMeasureMgr.getMeasureMode();
        setMeasureButton("#edrawings-measure-vertex-button", measureMode, eDwTypes_21.MeasureMode.VERTEX);
        setMeasureButton("#edrawings-measure-edge-button", measureMode, eDwTypes_21.MeasureMode.EDGE);
        setMeasureButton("#edrawings-measure-face-button", measureMode, eDwTypes_21.MeasureMode.FACE);
    }
    exports.syncMeasureModeUI = syncMeasureModeUI;
    function getCurrentMarkupMode() {
        if (l_isActive("#edrawings-markup-text-button"))
            return eDwTypes_21.MarkupMode.Text;
        if (l_isActive("#edrawings-markup-circle-button"))
            return eDwTypes_21.MarkupMode.Circle;
        if (l_isActive("#edrawings-markup-rectangle-button")) {
            return eDwTypes_21.MarkupMode.Rectangle;
        }
        if (l_isActive("#edrawings-markup-polyline-button")) {
            return eDwTypes_21.MarkupMode.Polyline;
        }
        if (l_isActive("#edrawings-markup-bezier-button"))
            return eDwTypes_21.MarkupMode.Bezier;
        if (l_isActive("#edrawings-markup-image-button"))
            return eDwTypes_21.MarkupMode.Image;
        return eDwTypes_21.MarkupMode.None;
    }
    exports.getCurrentMarkupMode = getCurrentMarkupMode;
    function syncMarkupModeUI(iMarkupMgr) {
        function setMarkupButton(iID, iMeasureModes, iTargetModes) {
            var method = iMeasureModes === iTargetModes ? "addClass"
                : "removeClass";
            $(iID)[method]("active-button");
        }
        var markupmode = iMarkupMgr.getMarkupMode();
        setMarkupButton("#edrawings-markup-text-button", markupmode, eDwTypes_21.MarkupMode.Text);
        setMarkupButton("#edrawings-markup-rectangle-button", markupmode, eDwTypes_21.MarkupMode.Rectangle);
        setMarkupButton("#edrawings-markup-circle-button", markupmode, eDwTypes_21.MarkupMode.Circle);
        setMarkupButton("#edrawings-markup-polyline-button", markupmode, eDwTypes_21.MarkupMode.Polyline);
    }
    exports.syncMarkupModeUI = syncMarkupModeUI;
    function populateModelViewPanel(iViewer, iPanelUIID, iTextClass) {
        return __awaiter(this, void 0, void 0, function () {
            var listModelViewMenu, gen, _a, _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        listModelViewMenu = $(iPanelUIID + " .edrawings-submenu-list");
                        listModelViewMenu.empty();
                        gen = getUIGenerator(iPanelUIID);
                        _b = (_a = listModelViewMenu).append;
                        return [4, gen.generateHTML(iTextClass)];
                    case 1:
                        _b.apply(_a, [_c.sent()]);
                        return [2];
                }
            });
        });
    }
    exports.populateModelViewPanel = populateModelViewPanel;
    function populateModelViewTabs(iViewer) {
        var panelUIID = "#edrawings-config-tab-list";
        var modelViewTabs = $(panelUIID);
        modelViewTabs.empty();
        var gen = getUIGenerator(panelUIID);
        modelViewTabs.append(gen.generateHTML(""));
    }
    exports.populateModelViewTabs = populateModelViewTabs;
    function getText(iElement) {
        return $(iElement).text().trim();
    }
    exports.getText = getText;
    function getTarget(iTarget) {
        return iTarget.hasClass("config-tab-text") ? iTarget.parent()
            : iTarget;
    }
    exports.getTarget = getTarget;
    function getSpanText(iTarget) {
        var target = getTarget(iTarget);
        if (!target.is("span")) {
            target = target.find("span");
        }
        if (!target || !target.length)
            return "";
        return target[0].innerText;
    }
    exports.getSpanText = getSpanText;
    function loadPanel(iElemOrClassID, iPanelHTML) {
        return __awaiter(this, void 0, void 0, function () {
            var iExcp_14;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4, eDwServiceMgr.get().load(iElemOrClassID, iPanelHTML)];
                    case 1:
                        _a.sent();
                        return [3, 3];
                    case 2:
                        iExcp_14 = _a.sent();
                        console.debugLog("PanelLoad", "Failed to load " + iPanelHTML +
                            ": " + iExcp_14.message);
                        return [3, 3];
                    case 3: return [2];
                }
            });
        });
    }
    exports.loadPanel = loadPanel;
    function hide(iSelector, iOff) {
        var selJQ = $(iSelector);
        selJQ[iOff ? "addClass" : "removeClass"]("edrawings-ui-hide");
        return selJQ;
    }
    exports.hide = hide;
    function getCSSContent(iJQElem) {
        if (iJQElem) {
            return iJQElem.css("content").replace(/^['"]+|\s+|\\|(;\s?})+|['"]$/g, '');
        }
        return "";
    }
    exports.getCSSContent = getCSSContent;
    function getRequestedQueryStringParams(iURL, ioViewerFeatOpts, iWarnOfOtherParams) {
        if (iWarnOfOtherParams === void 0) { iWarnOfOtherParams = true; }
        var hashes = iURL.slice(iURL.indexOf('?') + 1).split('&');
        for (var i = 0; i < hashes.length; i++) {
            var hash = hashes[i].split('=');
            if (hash.length > 1) {
                var strVal = hash[1];
                var val = strVal === "true" ? true :
                    strVal === "false" ? false : strVal;
                if (ioViewerFeatOpts.hasOwnProperty(hash[0])) {
                    ioViewerFeatOpts[hash[0]] = val;
                }
                else if (iWarnOfOtherParams) {
                    console.warn(hash[0] + " is not a valid query parameter.");
                }
            }
        }
    }
    exports.getRequestedQueryStringParams = getRequestedQueryStringParams;
    var l_generators = {};
    function l_loadContextMenu() {
        var _this = this;
        (function () { return __awaiter(_this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, loadPanel("#edrawings-context-menu", "contextmenu.html")];
                    case 1:
                        _a.sent();
                        return [2];
                }
            });
        }); })();
    }
    function l_loadSheetTreePanel() {
        var _this = this;
        (function () { return __awaiter(_this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, loadPanel("#edrawings-sheet-tree-menu", "sheetspanel.html")];
                    case 1:
                        _a.sent();
                        return [2];
                }
            });
        }); })();
    }
    function l_loadLayerPanel() {
        var _this = this;
        (function () { return __awaiter(_this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, loadPanel("#edrawings-layer-control-menu", "layerspanel.html")];
                    case 1:
                        _a.sent();
                        return [2];
                }
            });
        }); })();
    }
    function l_loadAnnotPanel() {
        var _this = this;
        (function () { return __awaiter(_this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, loadPanel("#edrawings-annot-control-menu", "annotpanel.html")];
                    case 1:
                        _a.sent();
                        return [2];
                }
            });
        }); })();
    }
    function l_loadTablesPanel() {
        var _this = this;
        (function () { return __awaiter(_this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, loadPanel("#edrawings-tables-menu", "tablespanel.html")];
                    case 1:
                        _a.sent();
                        return [2];
                }
            });
        }); })();
    }
    function l_loadDebugPanel() {
        var _this = this;
        (function () { return __awaiter(_this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, loadPanel("#edrawings-debug-menu", "debugpanel.html")];
                    case 1:
                        _a.sent();
                        return [2];
                }
            });
        }); })();
    }
    function l_loadComponentTreePanel() {
        var _this = this;
        (function () { return __awaiter(_this, void 0, void 0, function () {
            var viewerFeatOpts;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, loadPanel("#edrawings-component-tree-menu", "componentpanel.html")];
                    case 1:
                        _a.sent();
                        viewerFeatOpts = { Exp: false };
                        getRequestedQueryStringParams(location.href, viewerFeatOpts, false);
                        if (viewerFeatOpts.Exp) {
                            hide("#edrawings-component-tree-menu .edrawings-menu-info", false);
                        }
                        return [2];
                }
            });
        }); })();
    }
    function l_loadConfigPanel() {
        var _this = this;
        (function () { return __awaiter(_this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, loadPanel("#edrawings-configurations-menu", "configpanel.html")];
                    case 1:
                        _a.sent();
                        return [2];
                }
            });
        }); })();
    }
    function l_loadMeasurePanel() {
        var _this = this;
        (function () { return __awaiter(_this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, loadPanel("#edrawings-measure-menu", "measurepanel.html")];
                    case 1:
                        _a.sent();
                        return [2];
                }
            });
        }); })();
    }
    function l_loadMarkupPanel() {
        var _this = this;
        (function () { return __awaiter(_this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, loadPanel("#edrawings-markup-menu", "markuppanel.html")];
                    case 1:
                        _a.sent();
                        return [2];
                }
            });
        }); })();
    }
    function m_makePair(iFirst, iSecond) {
        return { First: iFirst, Second: iSecond };
    }
    function l_isActive(iID) {
        return $(iID).hasClass("active-button");
    }
    function l_getAllDisplayStateCSSClasses(iHierNode) {
        var classes = "";
        for (var displayState in eDwNodeAttributes_2.NodeDisplayState) {
            classes += "edrawings-" + iHierNode.Category +
                "-" + displayState.toLowerCase() + " ";
        }
        return classes;
    }
    function l_populatePanel(iViewer, iCategoryName, iListID, iPanelUIID, iAdditionalClasses) {
        if (iAdditionalClasses === void 0) { iAdditionalClasses = ""; }
        return __awaiter(this, void 0, void 0, function () {
            var activeModelView, nodes, list, gen, _a, _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        activeModelView = iViewer.getModel().getActiveModelView();
                        if (!activeModelView || !activeModelView.Hierarchy)
                            return [2];
                        nodes = activeModelView.Hierarchy.findNodes("Category", iCategoryName);
                        list = $(iListID);
                        list.empty();
                        gen = getUIGenerator(iPanelUIID);
                        _b = (_a = list).append;
                        return [4, gen.generateHTML(iAdditionalClasses)];
                    case 1:
                        _b.apply(_a, [_c.sent()]);
                        return [2];
                }
            });
        });
    }
    function l_populateAnnotPanel(iViewer) {
        return __awaiter(this, void 0, void 0, function () {
            var activeModelView, list, gen, _a, _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        activeModelView = iViewer.getModel().getActiveModelView();
                        if (!activeModelView || !activeModelView.Hierarchy)
                            return [2];
                        list = $("#edrawings-annot-control-list");
                        list.empty();
                        gen = getUIGenerator("#edrawings-annot-control-menu");
                        _b = (_a = list).append;
                        return [4, gen.generateHTML("")];
                    case 1:
                        _b.apply(_a, [_c.sent()]);
                        return [2];
                }
            });
        });
    }
    function l_populateLayerPanel(iViewer) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, l_populatePanel(iViewer, "layer", "#edrawings-layer-control-list", "#edrawings-layer-control-menu")];
                    case 1:
                        _a.sent();
                        return [2];
                }
            });
        });
    }
    function l_populateTablesPanel(iViewer) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, l_populatePanel(iViewer, "table", "#edrawings-tables-control-list", "#edrawings-tables-menu")];
                    case 1:
                        _a.sent();
                        return [2];
                }
            });
        });
    }
    function l_populateDebugPanel(iViewer) {
        var list = $("#edrawings-debug-menu .edrawings-submenu-list");
        list.empty();
        var gen = getUIGenerator("#edrawings-debug-menu");
        var modelView = iViewer.getModel().getActiveModelView();
        list.append(gen.generateHTMLForChildNodes(modelView.Hierarchy.HOOPSID, false, undefined));
    }
});
define("eDwView", ["require", "exports", "eDwSelMgr", "eDwMeasureMgr", "eDwMarkupMgr", "eDwXSectionMgr", "eDwViewMgr", "eDwTimer", "eDwOperatorMgr", "eDwCompXformMgr", "eDwEventMgr", "eDwHistoryMgr", "eDwModel", "eDwTypes", "eDwMBDNoteMgr", "eDwTouchOpsMgr", "eDwTableMgr", "eDrawingsBase"], function (require, exports, eDwSelMgr, eDwMeasureMgr, eDwMarkupMgr, eDwXSectionMgr, eDwViewMgr, eDwTimer, eDwOperatorMgr, eDwCompXformMgr, eDwEventMgr, eDwHistoryMgr, eDwModel, eDwTypes_22, eDwMBDNoteMgr, eDwTouchOpsMgr, eDwTableMgr) {
    "use strict";
    var eDwView = (function () {
        function eDwView(iViewerInfo, iFeatureOptions) {
            this.mElemID = iViewerInfo.containerId;
            this.HCViewer = new eDwTypes_22.HC.WebViewer(iViewerInfo);
            this.mTimer = new eDwTimer();
            this.ViewerFeatureOpts = iFeatureOptions;
            this.mDrawMode = iFeatureOptions.RenderType;
            this.OperatorMgr = new eDwOperatorMgr(this);
            this.TableMgr = new eDwTableMgr(this);
            var streamAll = this.HCViewer.getStreamingMode() === eDwTypes_22.HC.StreamingMode.All;
            var timeBeforeTimeout = streamAll ? 14400 : 120;
            var timeBeforeWarnTimeout = timeBeforeTimeout - 10;
            this.HCViewer.setClientTimeout(timeBeforeTimeout, timeBeforeWarnTimeout);
            this.mFitCamera = null;
            this.mModelKey = iViewerInfo.model;
            this.setupWebViewer();
        }
        eDwView.prototype.getHCView = function () {
            return this.HCViewer.getView();
        };
        eDwView.prototype.getModel = function () {
            if (!this.mModel) {
                this.mModel = new eDwModel(this);
            }
            return this.mModel;
        };
        eDwView.prototype.processProductStructure = function () {
            this.MBDNoteMgr = new eDwMBDNoteMgr(this);
            this.mFitCamera = this.getHCView().getCamera();
            var bbox = this.mModel.getBoundingBox();
            if (bbox.extents().equals(eDwTypes_22.HC.Point3.zero())) {
                this.mModel.calculateBoundingBox();
            }
            var model = this.getModel();
            var modelHC = model.getHCModel();
            function recurseStructure(iHCID, ioModelViewName, ioPath, iModelHC) {
                var fullName = iModelHC.getNodeName(iHCID);
                if (!fullName)
                    return;
                var nameArr = fullName.split("config: ");
                var name = (nameArr.length > 1) ? nameArr[1] : nameArr[0];
                if (!name) {
                    console.error("No name for id " + iHCID +
                        " under path " + ioPath +
                        ".  Full name was " + fullName);
                    console.warn("Continuing with fake name.");
                    name = "Unnamed Config1";
                }
                ioModelViewName = (ioPath.length > 0) ? ioModelViewName : name;
                var path = ioPath;
                if (path)
                    path += "/";
                path += name;
                var hierNode = model.addIDToNode(path, iHCID);
                if (hierNode) {
                    ioPath = path;
                    console.debugLog("ViewerLoad", "path = " + ioPath +
                        " id = " + iHCID);
                    var modelView = model.getModelView(ioModelViewName);
                    modelView.Nodes[iHCID] = hierNode;
                }
                var children = iModelHC.getNodeChildren(iHCID);
                for (var i = 0; i < children.length; i++) {
                    recurseStructure(children[i], ioModelViewName, ioPath, iModelHC);
                }
            }
            var children = modelHC.getNodeChildren(model.getModelHCID());
            var ioPath = "";
            var modelViewName = "";
            for (var i = 0; i < children.length; i++) {
                recurseStructure(children[i], modelViewName, ioPath, modelHC);
            }
            $("#" + this.mElemID).trigger("edw:AddViewerEvents", this);
            this.finishInit();
        };
        eDwView.prototype.setupWebViewer = function () {
            var _this = this;
            var processingSelection = false;
            var eventMgr = eDwEventMgr.get();
            this.mHCCallbacksObj = {
                sceneReady: function () {
                    console.debugLog("ViewerLoad", "Scene ready");
                    _this.HCViewer.resizeCanvas();
                },
                streamingActivated: function () {
                    console.debugLog("Viewer", "Streaming activated");
                },
                streamingDeactivated: function () {
                    var streamMode = _this.HCViewer.getStreamingMode();
                    if (streamMode === eDwTypes_22.HC.StreamingMode.All) {
                        setTimeout(function () {
                            console.debugLog("Viewer", "Streaming finished. Closing connection...");
                            _this.HCViewer.closeConnection();
                        }, 5000);
                    }
                    console.debugLog("Viewer", "Streaming deactivated");
                },
                selection: function (iSelEvent) {
                    if (!processingSelection) {
                        processingSelection = true;
                        try {
                            _this.SelectionMgr.onSelection(iSelEvent);
                        }
                        catch (iException) {
                        }
                        processingSelection = false;
                    }
                },
                timeoutWarning: function (iRemainingMinutes) {
                    console.debugLog("Viewer", "Inactivity timeout pending in " +
                        iRemainingMinutes + " minutes.");
                    _this.mTimer.ellapsed();
                    _this.mTimer.dumpToConsole();
                },
                timeout: function () {
                    console.debugLog("Viewer", "Inactivity timeout");
                    _this.mTimer.ellapsed();
                    _this.mTimer.dumpToConsole();
                    eventMgr.fireEvents("Timeout", _this);
                },
                modelLoadFailure: function (iModelName, iReason) {
                    console.warn("Model " + iModelName + " load failed: " +
                        iReason);
                    eventMgr.fireEvents("ModelLoadFailure", _this, iModelName, iReason);
                },
                deprecated: function (iDeprecatedFuncName) {
                    console.debugLog("Debug", iDeprecatedFuncName);
                },
                info: function (iInfoType, iMsg) {
                    console.debugLog("Debug", iInfoType.toString() + " " + iMsg);
                },
                missingModel: function (iModelPath) {
                    console.debugLog("Debug", "Missing model: " + iModelPath);
                },
                webGlContextLost: function () {
                    console.debugLog("Debug", "Browser lost GL context!  Render incomplete!!");
                },
                click: function (iMousePos, iEvent) {
                    console.debugLog("Debug", "Mouse clicked");
                },
                modelStructureReady: function () {
                    console.debugLog("ViewerLoad", "Model structure ready.");
                    $("#" + _this.mElemID).trigger("edw:ModelLoaded", _this);
                },
                modelSwitched: function () {
                    console.debugLog("ViewerLoad", "Model switch done.");
                    $("#" + _this.mElemID).trigger("edw:ModelLoaded", _this);
                },
                viewCreated: function (iView) {
                    eventMgr.fireEvents("ViewCreated", iView);
                },
                viewLoaded: function (iView) {
                    eventMgr.fireEvents("ViewLoaded", iView);
                },
                viewDeleted: function (iView) {
                    eventMgr.fireEvents("ViewDeleted", iView);
                },
                camera: function (iCamera) {
                    eventMgr.fireEvents("CameraChange", iCamera);
                }
            };
            this.HCViewer.setCallbacks(this.mHCCallbacksObj);
            this.HCViewer.start();
        };
        eDwView.prototype.getInitCamera = function () {
            return this.mFitCamera;
        };
        eDwView.prototype.getCurrModelKey = function () {
            return this.mModelKey;
        };
        eDwView.prototype.unregister = function () {
            if (this.HCViewer)
                this.HCViewer.unsetCallbacks(this.mHCCallbacksObj);
            this.OperatorMgr.unregisterAll();
            eDwEventMgr.get().fireEvents("Done", this);
        };
        ;
        eDwView.prototype.destroy = function () {
            this.HCViewer.shutdown();
        };
        eDwView.prototype.setExplosionLevel = function (iLevel) {
            this.HCViewer.getExplodeManager().setMagnitude(iLevel);
            eDwEventMgr.get().fireEvents("ExplodeLevelChange", this, iLevel);
        };
        eDwView.prototype.getExplosionLevel = function () {
            return this.HCViewer.getExplodeManager().getMagnitude();
        };
        eDwView.prototype.getDrawMode = function () {
            return this.mDrawMode;
        };
        eDwView.prototype.setDrawMode = function (iValue) {
            var view = this.getHCView();
            var settings = view.getHiddenLineSettings();
            switch (iValue) {
                case "ShadedWithEdges":
                    view.setDrawMode(eDwTypes_22.HC.DrawMode.WireframeOnShaded);
                    this.SelectionMgr.setColorForViewMode(eDwTypes_22.HC.DrawMode.WireframeOnShaded);
                    break;
                case "Shaded":
                    view.setDrawMode(eDwTypes_22.HC.DrawMode.Shaded);
                    this.SelectionMgr.setColorForViewMode(eDwTypes_22.HC.DrawMode.Shaded);
                    break;
                case "HiddenLinesRemoved":
                    settings.setObscuredLineTransparency(0);
                    view.setDrawMode(eDwTypes_22.HC.DrawMode.HiddenLine);
                    this.SelectionMgr.setColorForViewMode(eDwTypes_22.HC.DrawMode.HiddenLine);
                    break;
                case "HiddenLinesVisible":
                    settings.setObscuredLineTransparency(.5);
                    view.setDrawMode(eDwTypes_22.HC.DrawMode.HiddenLine);
                    this.SelectionMgr.setColorForViewMode(eDwTypes_22.HC.DrawMode.HiddenLine);
                    break;
                case "Wireframe":
                    settings.setObscuredLineTransparency(1);
                    view.setDrawMode(eDwTypes_22.HC.DrawMode.HiddenLine);
                    this.SelectionMgr.setColorForViewMode(eDwTypes_22.HC.DrawMode.HiddenLine);
                    break;
                default:
                    throw new Error("Unknown draw mode: " + iValue);
            }
            this.mDrawMode = iValue;
            eDwEventMgr.get().fireEvents("DrawModeChange", this, iValue);
        };
        eDwView.prototype.getPerspectiveMode = function () {
            return this.getHCView().getProjectionMode() ===
                eDwTypes_22.HC.Projection.Perspective;
        };
        eDwView.prototype.setPerspectiveMode = function (iValue) {
            if (!iValue) {
                this.getHCView().setProjectionMode(eDwTypes_22.HC.Projection.Orthographic);
            }
            else {
                this.getHCView().setProjectionMode(eDwTypes_22.HC.Projection.Perspective);
            }
            eDwEventMgr.get().fireEvents("ProjModeChange", this, iValue);
            return iValue;
        };
        eDwView.prototype.resetDrawMode = function () {
            this.setDrawMode(this.ViewerFeatureOpts.RenderType);
        };
        eDwView.prototype.initializeManagers = function () {
            new eDwSelMgr(this);
            new eDwMeasureMgr(this);
            new eDwMarkupMgr(this);
            new eDwXSectionMgr(this);
            new eDwViewMgr(this);
            new eDwCompXformMgr(this);
            if (eDwTouchOpsMgr.isTouchEnabled() && this.ViewerFeatureOpts.Exp) {
                new eDwTouchOpsMgr(this);
            }
        };
        eDwView.prototype.drawDebugBoundingBox = function (bbox) {
            return __awaiter(this, void 0, void 0, function () {
                var modelHC, beautifulGreen, width, height, length, vmin, vmax, p0, p1, p2, p3, p4, p5, p6, p7, polylineData0, polylineData1, polylineData2, polylineData3, rgba, i, tmp, boxMesh, key, meshInstance;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            modelHC = this.getModel().getHCModel();
                            beautifulGreen = new Communicator.Color(0, 255, 0);
                            width = bbox.max.x - bbox.min.x;
                            height = bbox.max.y - bbox.min.y;
                            length = Math.max(width, height);
                            vmin = bbox.min;
                            vmax = bbox.max;
                            p0 = new Communicator.Point3(vmin.x, vmin.y, vmax.z);
                            p1 = new Communicator.Point3(vmin.x, vmax.y, vmax.z);
                            p2 = new Communicator.Point3(vmax.x, vmax.y, vmax.z);
                            p3 = new Communicator.Point3(vmax.x, vmin.y, vmax.z);
                            p4 = new Communicator.Point3(vmin.x, vmin.y, vmin.z);
                            p5 = new Communicator.Point3(vmin.x, vmax.y, vmin.z);
                            p6 = new Communicator.Point3(vmax.x, vmax.y, vmin.z);
                            p7 = new Communicator.Point3(vmax.x, vmin.y, vmin.z);
                            polylineData0 = [
                                p0.x, p0.y, p0.z,
                                p1.x, p1.y, p1.z,
                                p2.x, p2.y, p2.z,
                                p3.x, p3.y, p3.z,
                                p0.x, p0.y, p0.z
                            ];
                            polylineData1 = [
                                p4.x, p4.y, p4.z,
                                p5.x, p5.y, p5.z,
                                p6.x, p6.y, p6.z,
                                p7.x, p7.y, p7.z,
                                p4.x, p4.y, p4.z
                            ];
                            polylineData2 = [
                                p4.x, p4.y, p4.z,
                                p0.x, p0.y, p0.z,
                                p1.x, p1.y, p1.z,
                                p5.x, p5.y, p5.z,
                                p4.x, p4.y, p4.z
                            ];
                            polylineData3 = [
                                p7.x, p7.y, p7.z,
                                p3.x, p3.y, p3.z,
                                p2.x, p2.y, p2.z,
                                p6.x, p6.y, p6.z,
                                p7.x, p7.y, p7.z
                            ];
                            rgba = [];
                            for (i = 0; i < 5; i++) {
                                tmp = [beautifulGreen.r,
                                    beautifulGreen.g,
                                    beautifulGreen.b, 255];
                                rgba = rgba.concat(tmp);
                            }
                            boxMesh = new Communicator.MeshData();
                            boxMesh.addPolyline(polylineData0, rgba);
                            boxMesh.addPolyline(polylineData1, rgba);
                            boxMesh.addPolyline(polylineData2, rgba);
                            boxMesh.addPolyline(polylineData3, rgba);
                            return [4, modelHC.createMesh(boxMesh)];
                        case 1:
                            key = _a.sent();
                            meshInstance = new Communicator.MeshInstanceData(key);
                            return [2, modelHC.createMeshInstance(meshInstance)];
                    }
                });
            });
        };
        eDwView.prototype.finishInit = function () {
            eDwEventMgr.get().fireEvents("Init", this);
            this.mModel.notifyDataChange(this.mModel.getActiveModelView());
            this.HCViewer.enableBackgroundSheet(false);
            eDwHistoryMgr.get().clear();
        };
        return eDwView;
    }());
    ;
    return eDwView;
});
define("eDwViewMgr", ["require", "exports", "eDwEventMgr", "eDwTypes", "eDrawingsBase"], function (require, exports, eDwEventMgr, eDwTypes_23) {
    "use strict";
    var eDwViewMgr = (function () {
        function eDwViewMgr(iViewer) {
            if (!iViewer)
                throw new Error("Must have viewer object");
            iViewer.ViewMgr = this;
            this.mViewAnimationIndex = 0;
            this.mViewAnimationActive = false;
            this.mAnimationTimeOutID = -1;
            this.mViewer = iViewer;
        }
        eDwViewMgr.prototype.start = function () {
            if (this.mViewer.getModel().isDrawing())
                return;
            eDwEventMgr.get().fireEvents("StartAnimation", this.mViewer);
            this.mViewAnimationActive = true;
            this.animateNextView();
        };
        eDwViewMgr.prototype.stop = function () {
            this.mViewAnimationActive = false;
            if (this.mAnimationTimeOutID > -1) {
                window.clearTimeout(this.mAnimationTimeOutID);
                this.mAnimationTimeOutID = -1;
            }
            eDwEventMgr.get().fireEvents("StopAnimation", this.mViewer);
        };
        eDwViewMgr.prototype.isActive = function () {
            return this.mViewAnimationActive;
        };
        eDwViewMgr.prototype.setViewOrientation = function (iEyeDir, iDuration) {
            if (iDuration === void 0) { iDuration = 400; }
            var center = this.mViewer.getModel().getBoundingBox().center();
            var viewHC = this.mViewer.getHCView();
            var camera = viewHC.getCamera().copy();
            var pos = camera.getPosition().copy();
            var target = camera.getTarget();
            var up = camera.getUp();
            pos = pos.subtract(target);
            var dist = pos.length();
            switch (iEyeDir) {
                case Communicator.ViewOrientation.Front:
                    pos.set(0, 0, 1).scale(dist).add(center);
                    up.set(0, 1, 0);
                    break;
                case Communicator.ViewOrientation.Back:
                    pos.set(0, 0, -1).scale(dist).add(center);
                    up.set(0, 1, 0);
                    break;
                case Communicator.ViewOrientation.Left:
                    pos.set(-1, 0, 0).scale(dist).add(center);
                    up.set(0, 1, 0);
                    break;
                case Communicator.ViewOrientation.Right:
                    pos.set(1, 0, 0).scale(dist).add(center);
                    up.set(0, 1, 0);
                    break;
                case Communicator.ViewOrientation.Top:
                    pos.set(0, 1, 0).scale(dist).add(center);
                    up.set(0, 0, -1);
                    break;
                case Communicator.ViewOrientation.Bottom:
                    pos.set(0, -1, 0).scale(dist).add(center);
                    up.set(0, 0, 1);
                    break;
                case Communicator.ViewOrientation.Iso:
                    pos.set(1, 1, 1).normalize().scale(dist).add(center);
                    up.set(-.408204, .816541, -.408204);
                    break;
                default:
                    throw new Error("Unsupported orientation: " + iEyeDir);
            }
            camera.setPosition(pos);
            camera.setTarget(center);
            camera.setUp(up);
            viewHC.fitWorld(iDuration, camera);
            return camera;
        };
        eDwViewMgr.prototype.setViewOrientationToDirection = function (normal) {
            var camera = this.mViewer.getHCView().getCamera();
            var position = camera.getPosition();
            var target = camera.getTarget();
            var up = camera.getUp();
            var delta = target.subtract(position);
            var distance = delta.length();
            var bbox = this.mViewer.getModel().getBoundingBox();
            var bbox_min = bbox.min;
            var bbox_max = bbox.max;
            target = Communicator.Point3.add(bbox_max, bbox_min).scale(.5);
            var eyeVec = Communicator.Point3.scale(normal, distance);
            position = Communicator.Point3.add(target, eyeVec);
            var vTest = new Communicator.Point3(1, 0, 0);
            var isParallel = Communicator.Point3.dot(vTest, normal);
            if (Math.abs((Math.abs(isParallel) - 1.0)) < .001) {
                vTest.set(0, 1, 0);
                var vec = Communicator.Point3.cross(normal, vTest);
                vec = vec.normalize();
                up = Communicator.Point3.cross(vec, normal);
                up = up.normalize();
            }
            else {
                up = Communicator.Point3.cross(normal, vTest);
                up = up.normalize();
            }
            var dotProd = Communicator.Point3.dot(up, new Communicator.Point3(1, 0, 0));
            if (Math.abs(Math.abs(dotProd) - 1.0) < 0.001 && dotProd < 0) {
                up = up.negate();
            }
            dotProd = Communicator.Point3.dot(up, new Communicator.Point3(0, 1, 0));
            if (Math.abs(Math.abs(dotProd) - 1.0) < 0.001 && dotProd < 0) {
                up = up.negate();
            }
            dotProd = Communicator.Point3.dot(up, new Communicator.Point3(0, 0, 1));
            if (Math.abs(Math.abs(dotProd) - 1.0) < 0.001 && dotProd < 0) {
                up = up.negate();
            }
            camera.setPosition(position);
            camera.setTarget(target);
            camera.setUp(up);
            this.setCamera(camera, 500);
            return camera;
        };
        eDwViewMgr.prototype.setCamera = function (iCamera, iTimeInMS) {
            if (iTimeInMS === void 0) { iTimeInMS = 400; }
            this.mViewer.getHCView().setCamera(iCamera, iTimeInMS);
        };
        eDwViewMgr.prototype.enableAmbientOcclusion = function (iEnable) {
            this.mViewer.getHCView().setAmbientOcclusionEnabled(iEnable);
            eDwEventMgr.get().fireEvents("AmbientOcclChange", this, iEnable);
        };
        eDwViewMgr.prototype.fitScreenToNodes = function (iNodeHCIDs, ioCamera) {
            return __awaiter(this, void 0, void 0, function () {
                var modelHC, bbox, subtract, viewVec, center, add, ratio, boxMaxLen;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!ioCamera)
                                return [2];
                            modelHC = this.mViewer.getModel().getHCModel();
                            return [4, modelHC.getNodesBounding(iNodeHCIDs)];
                        case 1:
                            bbox = _a.sent();
                            subtract = eDwTypes_23.HC.Point3.subtract;
                            viewVec = subtract(ioCamera.getPosition(), ioCamera.getTarget());
                            center = bbox.center().copy();
                            ioCamera.setTarget(center);
                            add = eDwTypes_23.HC.Point3.add;
                            ioCamera.setPosition(add(center, viewVec));
                            ratio = ioCamera.getWidth() / ioCamera.getHeight();
                            if (this.mViewer.getModel().isDrawing()) {
                                bbox.min.z = bbox.max.z = 0;
                            }
                            boxMaxLen = bbox.extents().length();
                            ioCamera.setHeight(boxMaxLen);
                            ioCamera.setWidth(boxMaxLen * ratio);
                            this.setCamera(ioCamera, 400);
                            return [2];
                    }
                });
            });
        };
        eDwViewMgr.prototype.onCameraUpdate = function () {
            this.mViewAnimationIndex += 1;
            if (this.mViewAnimationIndex >= eDwViewMgr.viewAnimations.length) {
                this.mViewAnimationIndex = 0;
                this.mViewAnimationActive = false;
                this.stop();
            }
            if (this.mViewAnimationActive) {
                this.animateNextView();
            }
        };
        eDwViewMgr.prototype.animateNextView = function () {
            var _this = this;
            if (this.mViewAnimationActive) {
                this.setViewOrientation(eDwViewMgr.viewAnimations[this.mViewAnimationIndex], 2000);
                var self_1 = this;
                this.mAnimationTimeOutID = window.setTimeout(function () { _this.onCameraUpdate(); }, 2000);
            }
        };
        eDwViewMgr.viewAnimations = [Communicator.ViewOrientation.Front,
            Communicator.ViewOrientation.Back,
            Communicator.ViewOrientation.Left,
            Communicator.ViewOrientation.Right,
            Communicator.ViewOrientation.Bottom,
            Communicator.ViewOrientation.Top,
            Communicator.ViewOrientation.Iso];
        return eDwViewMgr;
    }());
    ;
    return eDwViewMgr;
});
define("eDwXSectionMgr", ["require", "exports", "eDwXSectionOperator", "eDwGeomUtils", "eDwTypes", "eDwTypes", "eDrawingsBase"], function (require, exports, eDwXSectionOperator, eDwGeomUtils, eDwTypes_24, eDwTypes_25) {
    "use strict";
    var cSectionCapFaceColor = new eDwTypes_25.HC.Color(128, 128, 128);
    var cSectionCapOutlineColor = new eDwTypes_25.HC.Color(255, 0, 0);
    var eDwXSectionMgr = (function () {
        function eDwXSectionMgr(iViewer) {
            iViewer.XSectionMgr = this;
            this.mViewer = iViewer;
            var xSectionOp = new eDwXSectionOperator(iViewer);
            this.mXSectionOpID =
                iViewer.OperatorMgr.registerCustomOperator(xSectionOp);
            this.HCXSectionMgr = iViewer.HCViewer.getCuttingManager();
            this.SectionCapVisibility = false;
            this.mXSectionIndex = eDwTypes_24.SectionPlaneOrientation.XY.Index;
        }
        eDwXSectionMgr.prototype.unregister = function () {
            this.mViewer.OperatorMgr.unregisterCustomOperatorByID(this.mXSectionOpID);
            this.mViewer.XSectionMgr = null;
        };
        eDwXSectionMgr.prototype.turnOnSectionPlane = function (iOn) {
            if (this.getHCXSection()) {
                if (iOn) {
                    var ret = this.mViewer.OperatorMgr.push(this.mXSectionOpID);
                    console.debugLog("Section", "Section plane operator push ret = " + ret);
                    this.HCXSectionMgr.setCappingGeometryVisibility(true);
                }
                else {
                    var opID = this.mViewer.OperatorMgr.pop();
                    console.debugLog("Section", "Popped op ID = " + opID +
                        " xSection op ID = " + this.mXSectionOpID);
                }
            }
        };
        eDwXSectionMgr.prototype.activateCurrent = function () {
            this.getHCXSection().activate();
        };
        eDwXSectionMgr.prototype.deactivateCurrent = function () {
            this.getHCXSection().deactivate();
        };
        eDwXSectionMgr.prototype.isCurrentActive = function () {
            return this.getHCXSection().isActive();
        };
        Object.defineProperty(eDwXSectionMgr.prototype, "SectionIndex", {
            get: function () {
                return this.mXSectionIndex;
            },
            enumerable: true,
            configurable: true
        });
        eDwXSectionMgr.prototype.setSectionPlane = function (ioSection, iAllowActivation) {
            if (iAllowActivation === void 0) { iAllowActivation = true; }
            return __awaiter(this, void 0, void 0, function () {
                var bbox, bboxExtents, needsActivation, sectionHC, numActive, boxCenter, sectionPlane, minPlanePt, maxPlanePt, vec, centerPt, dir, mirrorPlaneNormal, mirrorPlane, maxOnPlnPt, minOnPlnPt, mirrorPlaneDist, distDir, revDistDir, pts;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.mViewer.getModel().calculateBoundingBox()];
                        case 1:
                            bbox = _a.sent();
                            bboxExtents = bbox.extents();
                            if (!ioSection || bboxExtents.equals(eDwTypes_25.HC.Point3.zero()))
                                return [2];
                            needsActivation = false;
                            sectionHC = this.getHCXSection();
                            if (ioSection.Index !== this.mXSectionIndex) {
                                if (sectionHC) {
                                    needsActivation = sectionHC.isActive();
                                    sectionHC.deactivate();
                                    this.HCXSectionMgr.refreshPlaneGeometry();
                                }
                                this.mXSectionIndex = ioSection.Index;
                                sectionHC = this.getHCXSection();
                            }
                            numActive = this.HCXSectionMgr.getActiveCuttingSectionCount();
                            boxCenter = bbox.center();
                            if (sectionHC.getCount() < 1) {
                                sectionPlane = ioSection.Plane.copy();
                                sectionPlane.d = -sectionPlane.distanceToPoint(boxCenter);
                                minPlanePt = eDwGeomUtils.dropPointOnPlane(bbox.min, sectionPlane);
                                maxPlanePt = eDwGeomUtils.dropPointOnPlane(bbox.max, sectionPlane);
                                vec = maxPlanePt.copy().subtract(minPlanePt);
                                vec = vec.scale(.55);
                                centerPt = eDwGeomUtils.dropPointOnPlane(boxCenter, sectionPlane);
                                dir = sectionPlane.normal.copy();
                                centerPt = centerPt.add(dir.scale(sectionPlane.d));
                                mirrorPlaneNormal = eDwTypes_25.HC.Point3.zero();
                                eDwTypes_25.HC.MeasureUtils.oneVectorCross(sectionPlane.normal.copy(), mirrorPlaneNormal);
                                mirrorPlane = eDwTypes_25.HC.Plane.createFromPointAndNormal(centerPt, mirrorPlaneNormal);
                                maxOnPlnPt = eDwTypes_25.HC.Point3.add(centerPt, vec);
                                minOnPlnPt = eDwTypes_25.HC.Point3.add(centerPt, vec.scale(-1));
                                mirrorPlaneDist = mirrorPlane.distanceToPoint(maxOnPlnPt);
                                distDir = mirrorPlaneNormal.copy().scale(2 * mirrorPlaneDist);
                                revDistDir = distDir.copy().scale(-1);
                                pts = [];
                                pts.push(minOnPlnPt);
                                pts.push(eDwTypes_25.HC.Point3.add(maxOnPlnPt, revDistDir));
                                pts.push(maxOnPlnPt);
                                pts.push(eDwTypes_25.HC.Point3.add(minOnPlnPt, distDir));
                                sectionHC = this.getHCXSection();
                                sectionHC.addPlane(sectionPlane, pts);
                                sectionHC.setColor(eDwTypes_25.HC.Color.createFromFloat(0, 1, 0));
                                sectionHC.setTransparency(.3);
                                needsActivation = true;
                            }
                            if (sectionHC && needsActivation && iAllowActivation) {
                                sectionHC.activate();
                            }
                            this.HCXSectionMgr.setStandinGeometryPickable(true);
                            return [2];
                    }
                });
            });
        };
        eDwXSectionMgr.prototype.flipSectionPlane = function () {
            var sectionHC = this.getHCXSection();
            if (!sectionHC)
                return;
            var sectionPlane = sectionHC.getPlane(0);
            if (!sectionPlane)
                return;
            sectionPlane.normal.negate();
            sectionPlane.d = -sectionPlane.d;
            sectionHC.updatePlane(0, sectionPlane);
        };
        eDwXSectionMgr.prototype.setViewToSectionPlane = function () {
            var sectionHC = this.getHCXSection();
            if (!sectionHC)
                return null;
            var sectionPlane = sectionHC.getPlane(0);
            if (!sectionPlane)
                return null;
            return this.mViewer.ViewMgr.setViewOrientationToDirection(sectionPlane.normal.copy());
        };
        eDwXSectionMgr.prototype.moveCurrentAlongNormal = function (iDistVec) {
            var camera = this.mViewer.getHCView().getCamera();
            var camPosition = camera.getPosition();
            var camTarget = camera.getTarget();
            var camUp = camera.getUp();
            var camZ = camTarget.subtract(camPosition);
            camZ = camZ.normalize();
            var camY = camUp.normalize();
            var camX = eDwTypes_25.HC.Point3.cross(camZ, camY);
            var realVec = camX.scale(iDistVec.x).
                add(camY.scale(iDistVec.y)).
                add(camZ.scale(iDistVec.z));
            var sectionHC = this.getHCXSection();
            var sectionPlane = sectionHC.getPlane(0);
            var normal = sectionPlane.normal.copy();
            normal = normal.normalize();
            var distance = eDwTypes_25.HC.Point3.dot(realVec, normal);
            if (Math.abs(distance) < 1e-6)
                return;
            sectionPlane.d -= distance;
            sectionHC.updatePlane(0, sectionPlane);
        };
        Object.defineProperty(eDwXSectionMgr.prototype, "SectionCapVisibility", {
            get: function () {
                return this.mEnableSectionCaps;
            },
            set: function (iEnable) {
                this.mEnableSectionCaps = iEnable;
                this.setSectionCapVisibility(iEnable);
            },
            enumerable: true,
            configurable: true
        });
        eDwXSectionMgr.prototype.disableSectionCapVisibility = function (iDisable) {
            this.setSectionCapVisibility(iDisable ? false : this.mEnableSectionCaps);
        };
        eDwXSectionMgr.prototype.projectPoint = function (iPnt) {
            var sectionHC = this.getHCXSection();
            var sectionPlane = sectionHC.getPlane(0);
            return eDwGeomUtils.dropPointOnPlane(iPnt, sectionPlane);
        };
        eDwXSectionMgr.prototype.getHCXSection = function () {
            return this.HCXSectionMgr.getCuttingSection(this.mXSectionIndex);
        };
        eDwXSectionMgr.prototype.setSectionCapVisibility = function (iEnable) {
            var enable = iEnable;
            var drawMode = this.mViewer.getDrawMode();
            if (drawMode !== "Shaded" && drawMode !== "ShadedWithEdges") {
                enable = false;
            }
            this.HCXSectionMgr.setCappingFaceColor(enable ? cSectionCapFaceColor : null);
            this.HCXSectionMgr.setCappingLineColor(enable ? null : cSectionCapOutlineColor);
        };
        return eDwXSectionMgr;
    }());
    ;
    return eDwXSectionMgr;
});
define("eDwXSectionOperator", ["require", "exports", "eDwTypes", "eDwBaseOperator", "eDwCommandMgr", "eDwMoveSectionPlaneCmd", "eDrawingsBase"], function (require, exports, eDwTypes_26, eDwBaseOperator, eDwCommandMgr, eDwMoveSectionPlaneCmd) {
    "use strict";
    var eDwXSectionOperator = (function (_super) {
        __extends(eDwXSectionOperator, _super);
        function eDwXSectionOperator(iViewer) {
            return _super.call(this, iViewer) || this;
        }
        eDwXSectionOperator.prototype.onActivate = function () {
            _super.prototype.onActivate.call(this);
            this.mViewer.XSectionMgr.activateCurrent();
        };
        eDwXSectionOperator.prototype.onDeactivate = function () {
            this.mViewer.XSectionMgr.deactivateCurrent();
            _super.prototype.onDeactivate.call(this);
        };
        eDwXSectionOperator.prototype.onMouseDown = function (ioMouseEvent) {
            if (!ioMouseEvent || !this.mViewer.XSectionMgr.isCurrentActive()) {
                ioMouseEvent.setHandled(true);
                return;
            }
            var selObj = eDwBaseOperator.getPickResult(ioMouseEvent);
            var selID = selObj.getNodeId();
            if (!selObj || selObj.getNodeId() >= 0) {
                ioMouseEvent.setHandled(false);
                return;
            }
            _super.prototype.onMouseDown.call(this, ioMouseEvent);
            var sectionMgr = this.mViewer.XSectionMgr;
            sectionMgr.disableSectionCapVisibility(true);
            if (selObj) {
                var typeOfSel = selObj.getSelectionType();
                selObj = typeOfSel === eDwTypes_26.HC.SelectionType.None ? null : selObj;
            }
            ioMouseEvent.setHandled(true);
            var selNodeID = selObj.getNodeId();
            if (selNodeID) {
                console.debugLog("Section", "sel obj = " +
                    JSON.stringify(selObj));
                var sectionMgrHC = this.mViewer.XSectionMgr.HCXSectionMgr;
                if (sectionMgrHC.getCuttingSectionFromNodeId(selNodeID)) {
                    this.mSectionDragPt = this.screenToWorld(ioMouseEvent.getPosition());
                }
            }
            if (this.mMoveSectionCmd)
                this.mMoveSectionCmd.cancel();
            this.mMoveSectionCmd = new eDwMoveSectionPlaneCmd(this.mViewer);
        };
        eDwXSectionOperator.prototype.onMouseMove = function (ioMouseEvent) {
            ioMouseEvent.setHandled(false);
            var crossSectionMgr = this.mViewer.XSectionMgr;
            if (!crossSectionMgr.isCurrentActive()) {
                return;
            }
            if (this.mCurMouse && this.mSectionDragPt) {
                var coords = ioMouseEvent.getPosition();
                var current = this.screenToWorld(coords);
                var delta = eDwTypes_26.HC.Point3.subtract(current, this.mSectionDragPt);
                this.mViewer.XSectionMgr.moveCurrentAlongNormal(delta);
                this.mSectionDragPt = current;
                ioMouseEvent.setHandled(true);
            }
        };
        eDwXSectionOperator.prototype.onMouseUp = function (ioMouseEvent) {
            _super.prototype.onMouseUp.call(this, ioMouseEvent);
            this.mViewer.XSectionMgr.disableSectionCapVisibility(false);
            ioMouseEvent.setHandled(false);
            this.mSectionDragPt = null;
            var cmdMgr = eDwCommandMgr.get();
            cmdMgr.add(this.mMoveSectionCmd);
            cmdMgr.remove(this.mMoveSectionCmd, "commit");
            this.mMoveSectionCmd = null;
        };
        eDwXSectionOperator.prototype.onTouchStart = function (ioTouchEvent) {
            var _this = this;
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_26.HC.MouseInputType.Down, function (ioMouseEvent) {
                _this.onMouseDown(ioMouseEvent);
            });
        };
        eDwXSectionOperator.prototype.onTouchMove = function (ioTouchEvent) {
            var _this = this;
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_26.HC.MouseInputType.Move, function (ioMouseEvent) {
                _this.onMouseMove(ioMouseEvent);
            });
        };
        eDwXSectionOperator.prototype.onTouchEnd = function (ioTouchEvent) {
            var _this = this;
            this.wrapAndCallAsMouseEvent(ioTouchEvent, eDwTypes_26.HC.MouseInputType.Up, function (ioMouseEvent) {
                _this.onMouseUp(ioMouseEvent);
            });
        };
        eDwXSectionOperator.prototype.needsSelection = function (iEventType) {
            return iEventType === eDwTypes_26.HC.EventType.MouseDown ||
                iEventType === eDwTypes_26.HC.EventType.TouchStart;
        };
        eDwXSectionOperator.prototype.screenToWorld = function (iScrPt) {
            var view = this.mViewer.getHCView();
            var normScrPt = view.pointToWindowPosition(iScrPt);
            var input = new Communicator.Point3(normScrPt.x, normScrPt.y, 0);
            var projMatrix = view.getProjectionMatrix();
            projMatrix.m[15] = 1;
            var invMat = Communicator.Matrix.inverse(projMatrix).transpose();
            var worldPt = new Communicator.Point3(0, 0, 0);
            var div = input.x * invMat.m[3] + input.y * invMat.m[7] +
                input.z * invMat.m[11] + invMat.m[15];
            worldPt.x = (input.x * invMat.m[0] + input.y * invMat.m[1] +
                input.z * invMat.m[2] + invMat.m[3]) / div;
            worldPt.y = (input.x * invMat.m[4] + input.y * invMat.m[5] +
                input.z * invMat.m[6] + invMat.m[7]) / div;
            worldPt.z = (input.x * invMat.m[8] + input.y * invMat.m[9] +
                input.z * invMat.m[10] + invMat.m[11]) / div;
            return worldPt;
        };
        return eDwXSectionOperator;
    }(eDwBaseOperator));
    return eDwXSectionOperator;
});
define("eDwZoomToFitCmd", ["require", "exports", "eDwSupportsHistoryCmd"], function (require, exports, eDwSupportsHistoryCmd) {
    "use strict";
    var eDwZoomToFitCmd = (function (_super) {
        __extends(eDwZoomToFitCmd, _super);
        function eDwZoomToFitCmd(iViewer, iNodeID, iCamera) {
            var _this = _super.call(this, iViewer) || this;
            _this.mInitialCamera = iCamera.copy();
            _this.mFinalCamera = iCamera.copy();
            _this.mNodeHCID = iNodeID;
            return _this;
        }
        eDwZoomToFitCmd.prototype.undo = function () {
            if (!_super.prototype.undo.call(this))
                return false;
            this.mViewer.ViewMgr.setCamera(this.mInitialCamera);
            return true;
        };
        eDwZoomToFitCmd.prototype.redo = function () {
            if (!_super.prototype.redo.call(this))
                return false;
            this.mViewer.ViewMgr.setCamera(this.mFinalCamera);
            return true;
        };
        eDwZoomToFitCmd.prototype.commit = function () {
            _super.prototype.commit.call(this);
            this.mViewer.ViewMgr.fitScreenToNodes([this.mNodeHCID], this.mFinalCamera);
        };
        Object.defineProperty(eDwZoomToFitCmd.prototype, "Aggregable", {
            get: function () {
                return true;
            },
            enumerable: true,
            configurable: true
        });
        return eDwZoomToFitCmd;
    }(eDwSupportsHistoryCmd));
    ;
    return eDwZoomToFitCmd;
});
define("utils", ["require", "exports"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    function forAll(iFunc, iDictionary) {
        if (!iDictionary)
            return;
        Object.keys(iDictionary).forEach(function (iKeyString) {
            var key = parseInt(iKeyString, 10);
            iFunc(key, iDictionary[key]);
        });
    }
    exports.forAll = forAll;
    function getUint8Array(iBase64EncodedString) {
        var binString = window.atob(iBase64EncodedString);
        var len = binString.length;
        var bytes = new Uint8Array(len);
        for (var i = 0; i < len; i++) {
            bytes[i] = binString.charCodeAt(i);
        }
        return bytes;
    }
    exports.getUint8Array = getUint8Array;
    function applyMixins(iDerivedConstructor, iBaseConstructors) {
        for (var _i = 0, iBaseConstructors_1 = iBaseConstructors; _i < iBaseConstructors_1.length; _i++) {
            var baseConstructor = iBaseConstructors_1[_i];
            var baseProps = Object.getOwnPropertyNames(baseConstructor.prototype);
            for (var _a = 0, baseProps_1 = baseProps; _a < baseProps_1.length; _a++) {
                var baseProp = baseProps_1[_a];
                iDerivedConstructor[baseProp] =
                    baseConstructor.prototype[baseProp];
            }
        }
    }
    exports.applyMixins = applyMixins;
    function getObjectTypeName(iObj) {
        if (!iObj)
            return "";
        return iObj.constructor.toString().split(" ")[1].split("(")[0];
    }
    exports.getObjectTypeName = getObjectTypeName;
    function isOfType(iArg, iDiscriminator) {
        return iDiscriminator in iArg;
    }
    exports.isOfType = isOfType;
});
//# sourceMappingURL=edrawings.min.js.map

