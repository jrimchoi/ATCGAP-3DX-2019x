define("DS/CfgFilterUX/CfgFilterSlideInComponent",["UWA/Class/View","DS/UIKIT/Input/Button","DS/Handlebars/Handlebars","DS/UIKIT/Tooltip","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","DS/UIKIT/Mask","css!DS/CfgFilterUX/CfgFilterUX.css"],function(h,b,g,e,c,f,d){var a={init:function(l,j,z,y,w,i){var t=UWA.createElement("div",{"class":"operations-main-container",id:"operations-container"});z.filterTitle=c.CFG_Filter_Title;var p=g.compile(y);t.innerHTML=p(z);l.appendChild(t);var o=document.querySelector("#cfgslideInBody");if(w){o.appendChild(w)}if(j){o.appendChild(j)}if(i){o.appendChild(i)}var s=[];z.dialogue.buttonArray.forEach(function(B){var A=new b({value:B.label,id:"cfg"+B.label+"id",className:B.className,events:{onClick:function(){B.handler()}}});s.push(A)});var v=document.querySelector("#cfgslideInFooter");for(k=0;k<s.length;k++){v.appendChild(s[k].getContent())}var u=document.querySelector("#checkCfgfilterBtn");if(u){new e({className:"filterValidate",id:"filterValidateId",position:"top",target:u,body:c.CFG_Configuration_Validate_Filter,trigger:"touch"})}if(z.dialogue.showButton){var r=document.querySelector(".globalEdit-container");r.setAttribute("style"," height: 100%");var n=document.querySelector(".ActiveCriteria-container");n.setAttribute("style"," display: none");var q=document.querySelector(".filter-cmd-close");q.setAttribute("style"," visibility: hidden");var x=document.querySelector("#cfgfilterBackBtn");x.addEventListener("click",m,false);function m(A){document.querySelector(".operations-main-container").destroy();require(["DS/CfgFilterUX/CfgFilterFactory"],function(B){B.showFilter()})}}else{f.unmask(l)}}};return a});define("DS/CfgFilterUX/CfgFilterEditor",["UWA/Drivers/Alone","DS/Core/Core","UWA/Class/View","DS/Handlebars/Handlebars","text!DS/CfgBaseUX/scripts/CfgDialogTemplate.html","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/CfgEvolutionUX/CfgModelSelection","DS/CfgEvolutionUX/CfgProductState","DS/CfgBaseUX/scripts/CfgData","UWA/Class/Promise","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgEvolutionUX/CfgDatePicker","DS/CfgEvolutionUX/CfgUnit","DS/CfgEvolutionUX/CfgVariants","DS/CfgFilterUX/CfgFilterSlideInComponent","DS/UIKIT/Mask","DS/CfgEvolutionUX/CfgFilterView","text!DS/CfgFilterUX/CfgFilterslideInTemplate.html","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/UIKIT/UIKIT.css","css!DS/CfgFilterUX/CfgFilterUX.css"],function(b,e,v,i,t,n,c,s,y,h,x,d,f,g,a,p,l,q,z,j,u,m,w){var o=i.compile(t);var r=v.extend({name:"filter-dialog-view",globalDisplayExpression:"",tagName:"div",ModelSelectionComponent:null,alertDiv:null,productstateCheckbox:null,ProductStateComponent:null,viewPanel:null,DateCheckbox:null,DatePicker:null,UnitCheckbox:null,UnitComponent:null,VariantsCheckbox:null,VariantsComponent:null,filter150Checkbox:null,manufacturingplanComponent:null,manufacturingplanCheckbox:null,init:function(A){this.singleProductEvolutionStatus=true;A.EvolutionLabel=m.Filter_Evolution;A.ModelLabel=m.Filter_Model;A.VariantsLabel=m.Filter_Variants;this._parent(A);x.clear();this.alertDiv=new n({visible:false,autoHide:true,hideDelay:3000,closeOnClick:true,maximumVisibleMessages:3,className:"error"});this.alertDiv.inject(document.body.querySelector(".f-globalFilter-container"),"top")},getModelMarketingName:function(A){for(var B=0;B<A.length;B++){if(A[B].name=="Marketing Name"){return A[B].value}}},getModelName:function(A){for(var B=0;B<A.length;B++){if(A[B].name=="name"){return A[B].value}}},render:function(){var D=this;x.renderTo=D.options.renderTo;x.renderToApp=D.options.renderToApp;this.container.setHTML(o(this.options));var J=[];var B={dialogue:{buttonArray:J,showHeader:false}};if(document.querySelector(".operations-main-container")){document.querySelector(".operations-main-container").destroy()}q.init(x.renderTo,this.container,B,u);var A=document.querySelector("#checkCfgfilterBtn");A.addEventListener("click",ad,false);function ad(af){if(D.UnitComponent!=null&&D.UnitComponent.validate()==false){return}if(D.VariantsComponent.textBox.getText()==""){D.VariantsComponent.xmlExpression="";D.VariantsComponent.displayExpression=""}if(D.manufacturingplanComponent!=null&&D.manufacturingplanComponent.textBox.getText()==""){D.manufacturingplanComponent.xml="";D.manufacturingplanComponent.displayExpression=""}D.onApplyFilter(af,D)}var Z=this.options.iModelsList.length;var aa=[];var C="";var X=null;var S=null;var E="";var V="";var L=true;var ac=false;var F=false;var H=false;var Y=0;if(Object.keys(D.options.expression).length!=0){C=D.options.expression.modelId[0];X=D.options.expression.psJson;S=D.options.expression.mpJson;L=D.options.expression.productstatecheckbox;ac=D.options.expression.unitcheckbox;F=D.options.expression.datestatecheckbox;H=D.options.expression.manufacturingplanCheckbox}for(var G=0;G<Z;G++){var T=this.getModelMarketingName(this.options.iModelsList[G].data);var ae=this.getModelName(this.options.iModelsList[G].basicData);var Q={value:this.options.iModelsList[G].physicalID,label:T,name:ae};if(this.options.iModelsList[G].physicalID==C){Y=G;Q.selected=true}aa.push(Q)}var I={};I.Data=aa;I.currentindex=Y;I.parentElement=this.container.getElement(".filter-dialog-models");this.ModelSelectionComponent=new y(I);this.ModelSelectionComponent.render();var P=null;if(Object.keys(D.options.expression).length!=0){P=D.options.expression.viewJson}var K={};K.parentElement=this.container.getElement(".filter-dialog-viewpanel");K.viewJson=P;this.viewPanel=new j(K);this.userGrantedRoles=this.viewPanel.userGrantedRoles;if(this.viewPanel.isLicenseValid==false){this.viewPanel=null}else{this.viewPanel=this.viewPanel}var M=this.ModelSelectionComponent.getcriteriasAvailable(this.ModelSelectionComponent);M.then(function(af){x.criteriasAvailable=af.criteria[0];console.log(x.criteriasAvailable);var ak={};ak.parentElement=D.container.getElement(".filter-dialog-productstates");ak.psJson=X;if(X!=null&&X.length>1){D.singleProductEvolutionStatus=false}ak.expression=D.options.expression;ak.mode="PRODUCTS";ak.use="FILTER";D.productstateCheckbox=new s({type:"checkbox",value:"PSComponent",className:"primary",label:m.Filter_Product_State,events:{onChange:function(){if(this.isChecked()===true){D.ProductStateComponent.show();if(D.VariantsComponent.configuratorButton!=null){D.VariantsComponent.configuratorButton.removeClassName("disableButton")}}else{D.ProductStateComponent.hide();if(D.VariantsComponent.configuratorButton!=null){D.VariantsComponent.configuratorButton.addClassName("disableButton")}}if(D.ProductStateComponent.options.psJson!=null&&D.ProductStateComponent.options.psJson!=undefined){D.isRoot=D.ProductStateComponent.options.psJson[0].start.isRoot;D.length=D.ProductStateComponent.options.psJson.length}x.ModelEvents.publish({event:"ProductStatecheckbox",data:{model:D.productstateCheckbox.isChecked(),isRoot:D.isRoot,psJsonLength:D.ProductStateComponent.options.psJson.length}})}}}).inject(D.container.getElement(".filter-dialog-productstates-checkbox"));D.ProductStateComponent=new h(ak);D.ProductStateComponent.render();x.productstateCheckbox=D.productstateCheckbox;x.ProductStateComponent=D.ProductStateComponent;var ai=x.CurrentFilterModel={model:aa[Y]};if(Object.keys(ak.expression).length!=0){D.ProductStateComponent.setExpression(ai)}else{D.ProductStateComponent.setLastMainEvolution(ai)}if(x.criteriasAvailable!=undefined&&x.criteriasAvailable.products=="FALSE"){x.productstateCheckbox.hide();x.ProductStateComponent.hide();L=false}if(L==true){D.productstateCheckbox.check();D.ProductStateComponent.show()}else{D.ProductStateComponent.hide();D.singleProductEvolutionStatus=true}var ah={};ah.parentElement=D.container.getElement(".filter-dialog-manufacturingplans");ah.psJson=S;ah.expression=D.options.expression;ah.mode="MANUFACTURINGPLAN";ah.use="FILTER";D.manufacturingplanCheckbox=new s({type:"checkbox",value:"PSComponent",className:"primary",label:w.Manufacturing_Plan,events:{onChange:function(){if(this.isChecked()===true){D.manufacturingplanComponent.show()}else{D.manufacturingplanComponent.hide()}}}}).inject(D.container.getElement(".filter-dialog-manufacturingplans-checkbox"));D.manufacturingplanComponent=new h(ah);D.manufacturingplanComponent.render();x.manufacturingplanComponent=D.manufacturingplanComponent;x.manufacturingplanCheckbox=D.manufacturingplanCheckbox;var ai=x.CurrentFilterModel={model:aa[Y]};D.manufacturingplanComponent.setExpression(ai);if(x.criteriasAvailable!=undefined&&x.criteriasAvailable.manufacturingPlans=="False"){x.manufacturingplanCheckbox.hide();x.manufacturingplanComponent.hide();H=false}if(H==true){D.manufacturingplanCheckbox.check();D.manufacturingplanComponent.show()}else{D.manufacturingplanComponent.hide()}if(D.userGrantedRoles.isCFGRoleAvail==true){if(x.configurationCriteria.unit==true){D.UnitCheckbox=new s({type:"checkbox",value:"UnitComponent",className:"primary",label:m.Filter_Unit,events:{onChange:function(){if(this.isChecked()===true){D.UnitComponent.show();D.UnitComponent.updateDictionary(x.CurrentFilterModel)}else{D.UnitComponent.hide()}}}}).inject(D.container.getElement(".filter-dialog-unit-checkbox"));var aj=null;if(Object.keys(D.options.expression).length!=0){aj=D.options.expression.iUnitJson}var ag=D.container.getElement(".filter-dialog-unit");D.UnitComponent=new p({parentElement:ag,mode:"UNIT",invokeFrom:"Filter",filterParent:D.options.renderToApp});D.UnitComponent.render();x.UnitComponent=D.UnitComponent;x.UnitCheckbox=D.UnitCheckbox;D.UnitComponent.SetJson(aj);if(x.criteriasAvailable!=undefined&&x.criteriasAvailable.builds=="FALSE"){x.UnitCheckbox.hide();x.UnitComponent.hide();ac=false}if(ac==true){D.UnitComponent.show();D.UnitCheckbox.check();D.UnitComponent.updateDictionary({model:aa[Y],})}else{D.UnitComponent.hide()}}}});if(this.userGrantedRoles.isCFGRoleAvail==true&&x.configurationCriteria.contextualDate==true){this.DateCheckbox=new s({type:"checkbox",value:"DateComponent",className:"primary",label:m.Filter_Date,checked:false,events:{onChange:function(){if(this.isChecked()===true){D.DatePicker.show()}else{D.DatePicker.hide()}}}}).inject(this.container.getElement(".filter-dialog-date-checkbox"));var ab=null;if(Object.keys(D.options.expression).length!=0){ab=D.options.expression.iDateJson}var O=this.container.getElement(".filter-dialog-date");this.DatePicker=a.create(O,ab,{view:"show",defaultDateBehavior:"SingleDate"},null);x.DateCheckbox=this.DateCheckbox;x.DatePicker=this.DatePicker;if(F==true){D.DatePicker.show();this.DateCheckbox.check()}else{this.DatePicker.hide()}}var N="";if(Object.keys(D.options.expression).length!=0){N=D.options.expression.iVariantsJson}var U=this.singleProductEvolutionStatus;var W={};W.status=U;W.iUnitJson=N;W.parentElement=this.container.getElement(".filter-dialog-variants");W.invokeFrom="Filter";W.filterParent=this.options.renderToApp;W.filterParentContainer=this.options.renderTo;W.userGrantedRoles=this.userGrantedRoles;W.tenant=this.options.tenant;this.VariantsComponent=new l(W);this.VariantsComponent.render();this.updateVariantsComponent();this.filter150Checkbox=new s({type:"checkbox",value:"filter150Component",className:"primary",label:m.filter150,checked:false}).inject(this.container.getElement(".filter-dialog-150-checkbox"));var R=this;this.filter150Checkbox.onChange=function(){R.VariantsComponent.clearProductConfLabelInfo()};x.filter150Checkbox=this.filter150Checkbox;if(this.options.expression.refineModecheckbox==true){this.filter150Checkbox.check()}x.ModelEvents.publish({event:"modelUpdated",data:{noEvolutionUpdate:true,model:aa[Y],}});if(this.options.expression.psJson!=undefined&&this.options.expression.psJson[0].start.isRoot==true){document.getElementById("edit").addClassName("disableButton")}},updateVariantsComponent:function(){this.VariantsComponent.enableDisableEditVariantfromProductEvolution()},getFilterDisplayXML:function(){var B=this.ModelSelectionComponent.getSelectedModelName();var E="";if(this.productstateCheckbox&&this.productstateCheckbox.isChecked()==true){E=this.ProductStateComponent.buildDisplayExpression()}var D="";if(this.manufacturingplanCheckbox&&this.manufacturingplanCheckbox.isChecked()==true){D=this.manufacturingplanComponent.buildDisplayExpression()}var H="";var C="";if(this.UnitCheckbox&&this.UnitCheckbox.isChecked()==true){H=this.UnitComponent.buildUnitXML(B[0]);if(H!=""){C=g.getDisplayExpressionUsingXSLT(f.startFilterXML()+H+f.endFilterXML())}}var F="";var A="";if(this.DateCheckbox&&this.DateCheckbox.isChecked()==true){F=this.DatePicker.getXML();if(F!=""){A=g.getDisplayExpressionUsingXSLT(f.startFilterXML()+F+f.endFilterXML())}}var G=this.VariantsComponent.getDisplayExpression();this.globalDisplayExpression=E+D+C+A+G;return this.globalDisplayExpression},buildFilterXML:function(){var E=this.ModelSelectionComponent.getSelectedModelName();var F=this.ProductStateComponent==null?null:this.ProductStateComponent.buildFilterXML();if(this.productstateCheckbox!=null&&this.productstateCheckbox.isChecked()==false){F=""}var G=this.manufacturingplanComponent==null?null:this.manufacturingplanComponent.buildFilterXML();if(this.manufacturingplanCheckbox!=null&&this.manufacturingplanCheckbox.isChecked()==false){G=""}var B=this.UnitComponent==null?null:this.UnitComponent.buildUnitXML(E[0]);if(this.UnitCheckbox==null?null:this.UnitCheckbox.isChecked()==false){B=""}var C=this.VariantsComponent.getXml();var A="";var H="";if(this.filter150Checkbox.isChecked()==true){H="150%"}else{H="Strict"}if(this.viewPanel!=null){A=this.viewPanel.getSelectedView()}var J=this.DatePicker==null?null:this.DatePicker.getXML();if(J==null||this.DateCheckbox.isChecked()==false){J=""}var I=f.buildTreeSeries("ProductState",E[0],F);var D=f.buildTreeSeries("ManufPlan",E[0],G);if(F==""||F==null){I=""}if(G==""||G==null){D=""}this.finalXML=f.startFilterXML(A,H)+I+D+J+B+C+f.endFilterXML();this.finalXML=this.finalXML.replace(/&(?!amp;)/g,"&amp;");console.log(this.finalXML);return this.finalXML},onApplyFilter:function(E,B){if((x.singleProductId!=""&&B.productstateCheckbox!=null&&B.productstateCheckbox.isChecked()==true)&&B.UnitComponent!=null&&B.UnitCheckbox.isChecked()==false&&B.DateCheckbox!=null&&B.DateCheckbox.isChecked()==false&&B.VariantsComponent.binaryExpression!=""&&B.filter150Checkbox.isChecked()==false){var A=B.getFilterDisplayXML();var F=B.options.rootId;var D={};D[F]={filterName:"Configuration Filter ",displayExpression:A,compiledBinary:B.VariantsComponent.binaryExpression,expression:{productstatecheckbox:B.productstateCheckbox==null?null:B.productstateCheckbox.isChecked(),unitcheckbox:B.UnitCheckbox==null?null:B.UnitCheckbox.isChecked(),datestatecheckbox:B.DateCheckbox==null?null:B.DateCheckbox.isChecked(),modelId:B.ModelSelectionComponent.get(),psJson:B.ProductStateComponent==null?null:B.ProductStateComponent.buildFilterJson(),mpJson:B.manufacturingplanComponent==null?null:B.manufacturingplanComponent.buildFilterJson(),psXmlDesc:B.ProductStateComponent==null?null:B.ProductStateComponent.buildDescription(),mpXmlDesc:B.manufacturingplanComponent==null?null:B.manufacturingplanComponent.buildDescription(),manufacturingplanCheckbox:B.manufacturingplanCheckbox==null?null:B.manufacturingplanCheckbox.isChecked(),viewJson:B.viewPanel==null?null:B.viewPanel.getJSON(),iDateJson:B.DatePicker==null?null:B.DatePicker.getJSON(),iUnitJson:B.UnitComponent==null?null:B.UnitComponent.getJson(),iVariantsJson:{displayExpression:B.VariantsComponent.getJson(),xmlExpression:B.VariantsComponent.getXml(),variant:B.VariantsComponent.getSelectedVariant(),binaryExpression:B.VariantsComponent.binaryExpression},displayExpression:B.ProductStateComponent==null?null:B.ProductStateComponent.buildDisplayExpression(),xmlExpression:B.ProductStateComponent==null?null:B.ProductStateComponent.buildFilterXML(),impXml:B.manufacturingplanComponent==null?null:B.manufacturingplanComponent.buildFilterXML(),refineModecheckbox:B.filter150Checkbox.isChecked()}};B.options.callback([D]);document.querySelector(".operations-main-container").destroy();return}var G=B.buildFilterXML();var C=new d(function(M,L){var I="/resources/modeler/configuration/filteringServices/createVolatileFilter";var J=function(O){M(O)};var N=B.ModelSelectionComponent.get();var K={version:"1.0",output:{targetformat:"TXT"},expression:{version:"0.1",format:"xml",content:G},dictionary:{version:"0.1",id:{pid:N[0]}}};var K=JSON.stringify(K);var H=function(){L()};g.makeWSCall(I,"POST","enovia","application/json",K,J,H,true)});C.then(function(H){var J=B.options.rootId;var I={};I[J]={filterName:"Configuration Filter ",displayExpression:B.getFilterDisplayXML(),compiledBinary:H.FilterBinaryforExpand,expression:{productstatecheckbox:B.productstateCheckbox==null?null:B.productstateCheckbox.isChecked(),unitcheckbox:B.UnitCheckbox==null?null:B.UnitCheckbox.isChecked(),datestatecheckbox:B.DateCheckbox==null?null:B.DateCheckbox.isChecked(),modelId:B.ModelSelectionComponent.get(),psJson:B.ProductStateComponent==null?null:B.ProductStateComponent.buildFilterJson(),mpJson:B.manufacturingplanComponent==null?null:B.manufacturingplanComponent.buildFilterJson(),psXmlDesc:B.ProductStateComponent==null?null:B.ProductStateComponent.buildDescription(),mpXmlDesc:B.manufacturingplanComponent==null?null:B.manufacturingplanComponent.buildDescription(),manufacturingplanCheckbox:B.manufacturingplanCheckbox==null?null:B.manufacturingplanCheckbox.isChecked(),viewJson:B.viewPanel==null?null:B.viewPanel.getJSON(),iDateJson:B.DatePicker==null?null:B.DatePicker.getJSON(),iUnitJson:B.UnitComponent==null?null:B.UnitComponent.getJson(),iVariantsJson:{displayExpression:B.VariantsComponent.getJson(),xmlExpression:B.VariantsComponent.getXml(),variant:B.VariantsComponent.getSelectedVariant()},displayExpression:B.ProductStateComponent==null?null:B.ProductStateComponent.buildDisplayExpression(),xmlExpression:B.ProductStateComponent==null?null:B.ProductStateComponent.buildFilterXML(),impXml:B.manufacturingplanComponent==null?null:B.manufacturingplanComponent.buildFilterXML(),refineModecheckbox:B.filter150Checkbox.isChecked()}};B.options.callback([I]);if(document.querySelector(".operations-main-container")!=null){document.querySelector(".operations-main-container").destroy()}},function(){B.alertDiv.add({message:m.Filter_Error_CompiledBinary,style:{position:"absolute"},className:"error"});B.alertDiv.show()})}});return r});define("DS/CfgFilterUX/CfgFilterFactory",["DS/UIKIT/Alert","DS/CfgFilterUX/CfgFilterEditor","DS/CfgBaseUX/scripts/CfgController","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Promise","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgData","DS/UIKIT/Mask"],function(f,e,i,g,j,d,a,h,b){var c={_parameters:null,_callbackAdd:null,alertDiv:null,CfgFilterDialog:null,begin:function(l){this._parameters=l;this._callbackAdd=l.callback;this.alertDiv=new f({visible:false,autoHide:true,hideDelay:3000,closeOnClick:true,maximumVisibleMessages:3,className:"error"});this.alertDiv.inject(document.body.querySelector(".f-globalFilter-container"),"top");b.mask(l.renderTo);this.execute()},onSecurityContext:function(l,n){var q=null,m,p=null;if(n._parameters&&n._parameters.rootId&&n._parameters.renderTo&&n._callbackAdd){console.log(n._parameters.rootId);q=n._parameters.rootId;m=n._callbackAdd;p=document.body}if(q!=null){var r=q;var o=new j(function(w,v){var u=function(x){v(x)};var t="/resources/modeler/configuration/navigationServices/getConfiguredObjectInfo/pid:"+q+"?cfgCtxt=1";var s=function(x){if(x.contexts.content.results[0]!=undefined&&x.contexts.content.results[0].notification!=undefined&&x.contexts.content.results[0].notification.code=="unaccessible"&&x.contexts.content.results[0].notification.type=="ERROR"){n.alertDiv.add({message:d.Filter_unaccessiblecode_Error,style:{position:"absolute"},className:"error"});n.alertDiv.elements.container.addClassName("CfgAlertstyle");n.alertDiv.show();n._callbackAdd([]);return}w(x)};g.makeWSCall(t,"GET","enovia","application/ds-json","",s,u,true)});o.then(function(s){n.createDialog(s)},function(){n.alertDiv.add({message:d.Filter_Error_Models,style:{position:"absolute"},className:"error"});n.alertDiv.show();n._callbackAdd([])})}else{}},execute:function(){var l=this;i.init();h.ModelEvents=new a();enoviaServerFilterWidget.tenant=l._parameters.tenant;g.populate3DSpaceURL().then(function(){var n=g.populateSecurityContext();var o=function m(p){g.populateDisplayExpressionXSLT();l.onSecurityContext(p,l);b.unmask(l._parameters.renderTo)};n.then(function(){g.checkDecouplingActivation().then(function(p){console.log(p);h.configurationCriteria=p;o()})})})},hideFilter:function(){this._parameters.hideFilter()},showFilter:function(){this._parameters.showFilter();var l=document.querySelector(".filter-cmd-close");l.setAttribute("style"," visibility: visible")},createDialog:function(m){var n=this._parameters||{};if(m.version=="1.1"){n.iModelsList=m.contexts.content.results}else{if(m.version=="1.0"){n.iModelsList=m.Contexts.Content.results}}if(n.iModelsList.length>0){var l=this;require("DS/CfgFilterUX/CfgFilterEditor",function(o){var o=new o(l._parameters);o.render()})}else{if(this._callbackAdd){this.alertDiv.add({message:d.Filter_Error_No_Model,style:{position:"absolute"},className:"error"});this.alertDiv.show();this._callbackAdd([])}}}};return c});define("DS/CfgFilterUX/CfgVariantEditor",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Input/Button","DS/ConfiguratorPanel/scripts/Presenters/PCPanel","DS/ConfiguratorPanel/scripts/Models/ConfiguratorModel","DS/ConfiguratorPanel/scripts/ConfiguratorSolverFunctions","DS/ConfiguratorPanel/scripts/Utilities","DS/Core/ModelEvents","DS/UIKIT/Modal","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgFilterUX/CfgFilterSlideInComponent","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","DS/CfgBaseUX/scripts/CfgData","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","css!DS/CfgFilterUX/CfgFilterUX.css",],function(e,i,j,m,r,h,d,a,n,b,c,o,q,g,f,l){var p=i.extend({init:function(s){var t=this;f.selectedOptionsforConfigurator="";this.options=s?e.clone(s,false):{};var u={useSolver:true,configData:{xml:"",displayXml:""},parentContainer:document.body};e.merge(this.options,u);if(this.options.invokeFrom=="Filter"){}else{this.getModal()}this.modelEvent=new a();if(e.is(this.options.onOK,"function")){this.modelEvent.subscribe({event:"onCfgDataChange"},t.options.onOK)}},render:function(){var s=this;this.getProductID()},setDefaultConfigurations:function(s){var u=this;if(this.options.PCId){var w,v,t;w="/resources/cfg/configurator/configuration/"+this.options.PCId;u.options.cfgCriteria="{}";v=function(x){u.options.configuration=x.configurationCriteria;u.options.appRulesParams=x.appRuleParam;if(u.options.startDate!=null&&u.options.startDate!=""){u.options.cfgCriteria='{"date":{"startDate":"'+u.options.startDate+'","endDate":""}, "milestone":{"id":""}, "productState":{"productRev":""}}'}u.buildSkeleton()};t=function(){u.buildSkeleton()};d.sendRequest(w,"GET","json",false,v,t,null,3000,u.options.tenant)}},getProductID:function(){var t=this;if(this.options.PCId&&!this.options.productId){var v,u,s;v="/resources/cfg/configurator/configuration/parentcontext/"+this.options.PCId;u=function(w){t.options.productId=w.objectDetails.id;t.options.startDate=w.objectDetails.startEffDate;if(!t.options.configuration){t.setDefaultConfigurations()}else{t.buildSkeleton()}};s=function(w){t.errorMsg="Failed to get product id for PC id";console.log(t.errorMsg)};d.sendRequest(v,"GET","json",false,u,s,null,3000,t.options.tenant)}else{t.buildSkeleton()}},buildSkeleton:function(){var s=this;var t=this;this.configModelEvents=new a();this.ws_pcModel=this.options.configuration;this.VariantsConfigPanelContainer=e.createElement("div",{"class":"VariantsConfigPanelContainer"});s.initializePanel()},initializePanel:function(){var s=this;this.ws_dictionary;if(this.modal){this.modal.setBody(this.VariantsConfigPanelContainer);c.unmask(this.modal.elements.body)}else{this.getPanelForConfigurator()}var t={version:"V3",realistic:false,tenant:enoviaServerFilterWidget.tenant,mvId:s.options.productId,ruleLevels:{RulesMode_ProposeOptimizedConfiguration:false,RulesMode_SelectCompleteConfiguration:false,RulesMode_EnforceRequiredOptions:true,RulesMode_DisableIncompatibleOptions:true,},initalOptions:{initialRuleLevel:"RulesMode_EnforceRequiredOptions",initialMode:"selectionMode_Build"},configCriteria:s.options.cfgCriteria};this.PCPanel1=new m(s.ws_pcModel,this.ws_dictionary,s.configModelEvents,t);s.configModelEvents.subscribe({event:"pc-loaded"},function(){s.PCPanel1.inject(s.VariantsConfigPanelContainer);var u=s.VariantsConfigPanelContainer.getElement("#PC-panel-container");u.addClassName("variants-configuratorPanel");var v=document.getElementsByClassName("topbar-MidMenu-Container").item(0);if(v!=null){v.addClassName("variants-topbarMidMenuContainer")}c.unmask(s.VariantsConfigPanelContainer);if(s.options.invokeFrom=="Filter"){c.unmask(s.options.filterParentContainer);c.unmask(s.options.filterParent)}})},publishPanelData:function(){this.formattedInnerXML=(this.formattedInnerXML===undefined)?"":this.formattedInnerXML;this.modelEvent.publish({event:"onCfgDataChange",data:{displayXml:this.formattedInnerDisplayXML,xml:this.formattedInnerXML,PCId:this.options.PCId,configuration:this.options.configuration,selectionmode:this.PCPanel1.getConfigmodel().getAppRulesParam().selectionMode},})},createActionsPresenter:function(){var s=e.createElement("div",{"class":"actionsContainer"}),u;if(e.is(this.options.onBack,"function")){u=new j({value:l.Filter_VariantEditor_Back}).inject(s);u.elements.container.addClassName("variant-editor-backBtn")}if(!t){var t=e.createElement("div",{"class":"OKCancelContainer"}).inject(s),w=new j({value:l.Filter_VariantEditor_Ok,className:"primary btn btn-primary variant-editor-okBtn"}).inject(t),v=new j({value:l.Filter_VariantEditor_Cancel}).inject(t);v.elements.container.addClassName("variant-editor-cancelBtn")}return s},destroy:function(){h.releaseSolver();delete this.configModel;delete this.options.modelEvents;delete this.VariantsConfigPanelContainer},getModal:function(){var s=this;this.modal=new n({className:"site-reset",closable:true,overlay:true,escapeToClose:false,header:"<h4>"+l.Filter_VariantEditor_Header+"</h4>",body:this.VariantsConfigPanelContainer,footer:this.createActionsPresenter(),events:{onShow:function(){c.mask(s.modal.elements.body)}}}).inject(this.options.parentContainer);this.modal.getContent().getElements(".btn").forEach(function(t){t.addEvent("click",function(){if(this.hasClassName("variant-editor-backBtn")||this.hasClassName("variant-editor-cancelBtn")){s.formattedInnerXML="";s.options.configData.xml="";var u={xml:"",PCId:""};if(e.is(s.options.onCancel,"function")){this.hasClassName("variant-editor-backBtn")?s.options.onBack(u):s.options.onCancel(u)}}if(this.hasClassName("variant-editor-okBtn")){s.options.configData.xml=s.PCPanel1.getXMLProductConfigurationDefinition();s.options.configData.displayXml=s.PCPanel1._configModel.getXMLExpressionWithDisplayName();f.selectedOptionsforConfigurator=s.PCPanel1._configModel.getConfigurationCriteria();console.log(s.options.configData.xml);s.options.configuration=s.PCPanel1._configurations;s.formattedInnerXML=s.getInnerXML();s.publishPanelData()}s.destroy();s.modal.destroy();console.log("Modal destroyed with all references")})});this.modal.elements.close.onclick=function(){s.destroy();s.modal.destroy();var t={closeOnModal:true}};this.modal.elements.body.addClassName("variant-modal-body");this.modal.elements.content.addClassName("variant-modal-content");this.modal.show()},getPanelForConfigurator:function(){var v=this;var w=function(){v.formattedInnerXML="";v.formattedInnerDisplayXML="";v.options.configData.xml="";v.options.configData.displayXml="";var x={xml:"",displayXml:"",PCId:""};require(["DS/CfgFilterUX/CfgFilterFactory"],function(y){document.querySelector(".operations-main-container").destroy();y.showFilter()})};var s=function(x){v.options.configData.xml=v.PCPanel1.getXMLProductConfigurationDefinition();if(v.PCPanel1._configModel.getXMLExpressionWithDisplayName){v.options.configData.displayXml=v.PCPanel1._configModel.getXMLExpressionWithDisplayName()}else{v.options.configData.displayXml=v.options.configData.xml}f.selectedOptionsforConfigurator=v.PCPanel1._configModel.getConfigurationCriteria();console.log(v.options.configData.xml);v.options.configuration=v.PCPanel1._configurations;v.formattedInnerXML=v.getInnerXML();v.formattedInnerDisplayXML=v.getInnerDisplayXML();v.publishPanelData();v.destroy();require(["DS/CfgFilterUX/CfgFilterFactory"],function(y){document.querySelector(".operations-main-container").destroy();y.showFilter()})};var u=[{label:l.Filter_VariantEditor_Cancel,handler:w,className:"default"},{label:l.Filter_VariantEditor_Ok,handler:s,className:"primary"}];var t={dialogue:{buttonArray:u,showHeader:true,showButton:true},HeaderLabel:l.Filter_VariantEditor_Header};q.init(f.renderToApp,this.VariantsConfigPanelContainer,t,g)},getInnerXML:function(){var w,s,u,y,t="",x,v;w=this.options.configData.xml;if(w){s=w.indexOf("<Feature");u=w.indexOf("</FilterSelection>");v=w.indexOf("<NOT");if(v!==-1){if(v<s){s=v}}y=w.slice(s,u);x=function(z){var C,B,A;C=z.indexOf("SelectedBy");B=z.indexOf("/",C);A=z.substr(0,C)+z.substr(B,z.length+1);if(A.indexOf("SelectedBy")===-1){t=A}else{x(A)}};if(y.indexOf("SelectedBy")!=-1){x(y);console.log(t)}}return t},getInnerDisplayXML:function(){var w,s,u,y,t="",x,v;w=this.options.configData.displayXml;if(w){s=w.indexOf("<Feature");u=w.indexOf("</FilterSelection>");v=w.indexOf("<NOT");if(v!==-1){if(v<s){s=v}}y=w.slice(s,u);x=function(z){var C,B,A;C=z.indexOf("SelectedBy");B=z.indexOf("/",C);A=z.substr(0,C)+z.substr(B,z.length+1);if(A.indexOf("SelectedBy")===-1){t=A}else{x(A)}};if(y.indexOf("SelectedBy")!=-1){x(y);console.log(t)}}return t}});return p});define("DS/CfgFilterUX/CfgPCChooser",["DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/W3DXComponents/Views/Layout/GridScrollView","DS/UIKIT/Input/Text","DS/UIKIT/Iconbar","DS/W3DXComponents/Views/Item/TileView","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgFilterUX/CfgVariantEditor","DS/UIKIT/Mask","DS/UIKIT/Tooltip","UWA/Class/Collection","UWA/Class/Model","DS/i3DXCompassServices/i3DXCompassServices","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","DS/CfgBaseUX/scripts/CfgData","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","css!DS/CfgFilterUX/CfgFilterUX.css"],function(o,l,r,e,c,i,q,j,g,p,h,d,b,n,m,f){var a={collectionNew:null,create:function(s){var t=this;this.options=s?UWA.clone(s,false):{};var u={pcExpression:{displayExpression:"",xmlExpression:""},parentContainer:document.body};UWA.merge(this.options,u);this.getServiceUrl();if(UWA.is(this.options.model_id,"array")){this.options.model_id=this.options.model_id[0]}this.MainContainer=new UWA.Element("div",{id:"pcchooser-mainContainer"});this.getModel();this.buildToolbar();this.PClistContainer=new UWA.Element("div",{id:"pcchooser-PClistContainer"}).inject(this.MainContainer);this.getPCCollection()},buildToolbar:function(){var t=new UWA.Element("div",{id:"pcchooser-headerwrapperDiv"}).inject(this.MainContainer);var s=new UWA.Element("div",{id:"pcchooser-PCChooserHeader"}).inject(t);var v=new UWA.Element("div",{id:"pcchooser-PCSearchContainer"}).inject(this.MainContainer);var w=new c({renderTo:s,items:[{fonticon:"down-bold",text:n.Filter_Sort_oder,handler:function(x){a.sortPCsByName()}},{className:"divider"},{fonticon:"search",text:n.Search,handler:function(x){a.searchPC()}}]});var u=new UWA.Element("div",{id:"pcchooser-PCSortContainer",html:n.Filter_Sort_By+'<font color="#368ec4">'+n.Filter_Marketing_Name+"</font>",}).inject(s);this.getSearchTextBox(v)},getSearchTextBox:function(t){var s=new e({id:"pcchooser-PCSearchBox",attributes:{placeholder:n.Filter_Search,events:{keyup:function(u){a.enteredText=u.target.value;a.filterSearch()}}}}).inject(t)},getPCCollection:function(){var s=this;var u=this.options.model_id;var t=new Promise(function(D,E){var A='{"version":"1.0.0","input":{"productPIDs":"';var C='","status":"0","basics":"description,name,current,to[Product Configuration].from.attribute[Marketing Name],to[Product Configuration].from.revision","attributes":"ValidationStatus,CompletenessStatus"}}';var x="";if(m.productstateCheckbox.isChecked()==true){x=m.singleProductId}var z=encodeURIComponent(A)+x+encodeURIComponent(C);var v="/resources/modeler/browsing/model/"+u+"/getproductconfigurations?filteringCriteria="+z;var y=function(F){D(F)};var B="";var w=function(){};q.makeWSCall(v,"GET","enovia","application/json",B,y,w,true)});t.then(function(w){var y=w.productconfigurations;var x=[];if(y&&y.length>0){y.forEach(function(B){if(B&&B.id){var C=B.id.substr(4);x.push(C)}})}var v=JSON.parse(f);var z=v.pcImageEnabled;if((x.length>0)&&(z)){var A=q.getpcImage(x);A.then(function(F){var B={};var I="";var C="";var J=F.results;for(var D=0;D<J.length;D++){var G=F.results[D].attributes;for(var E=0;E<G.length;E++){var H=G[E].name;if(H=="resourceid"){I=G[E].value}if(H=="preview_url"){C=G[E].value}}B[I]=B[I]||[];B[I].push(C)}s.collectionNew=s.buildTreeDocument(w,B);a.createView(s.collectionNew)})}else{s.collectionNew=s.buildTreeDocument(w);a.createView(s.collectionNew)}})},buildTreeDocument:function(s,z){var w,u,y,x=[];y=s.productconfigurations;var t=[];var v=this;if(y&&y.length>0){y.forEach(function(A){if(A&&A.id){var B=A.id.substr(4);var C=function(){if(!v.defaultImage){v.getDefaultImage()}return v.defaultImage};if(z!=undefined){C=z[B]}u={id:B,type:A.type||"",marketingName:A.marketingName||"",name:A.name||"",state:A.attributes.CompletenessStatus,description:A.basics.description||"",label:A.marketingName||A.name,subLabel:A.attributes.CompletenessStatus,icon:C,thumbnail:"",maturity:A.basics.current,basedOn:A.basics["to[Product Configuration].from.attribute[Marketing Name]"]+" "+A.basics["to[Product Configuration].from.revision"]};x.push(u)}})}else{this.PClistContainer.setContent('<span class="fonticon fonticon-2x fonticon-doc"></span>');this.PClistContainer.addContent('<font-size="17px">'+n.Filter_PC_NoContent+'</font><br> <font-size="15px">'+n.Filter_PC_NoPC+"</font>");this.PClistContainer.setStyle("color","silver");this.PClistContainer.setStyle("text-align","center");this.PClistContainer.setStyle("padding-top","90px");this.PClistContainer.setStyle("display","inline-flex");this.PClistContainer.setStyle("flex-direction","column");this.PClistContainer.setStyle("justify-content","center")}w=new h(x,{model:d.extend({defaults:function(){return{id:null,type:"",marketingName:"",name:"",state:"",description:"",label:"",subLabel:"",icon:"",thumbnail:"",maturity:"",basedOn:""}}})});return w},launchVariantEditor:function(u){var t=this;var s=new j({parentContainer:document.body,modelId:this.options.model_id,PCId:u,tenant:t.options.tenant,onOK:function(v){console.log("On OK Data : "+v.xml);t.options.variantEditorOnOK(v);t.dialog.destroy()},onCancel:function(v){console.log("On Cancel Data : "+v.xml);t.options.variantEditorOnCancel(v);t.dialog.destroy()},onBack:function(v){console.log("On Back Data : "+v.xml);if(v.closeOnModal){t.dialog.hide();t.dialog.destroy()}else{t.dialog.show()}g.unmask(t.dialog.elements.body)}});this.modelView=s;setTimeout(function(){s.render()},1000)},getServiceUrl:function(){var u=this,v;if(!this.serviceUrl){var t={serviceName:"3DSpace",platformId:"",onComplete:function(w){if(typeof w==="string"){u.serviceUrl=w}else{u.serviceUrl=w[0].url}u.defaultIcon=u.serviceUrl+"/snresources/images/icons/small/ProductConfiguration22.png"},onFailure:function(){console.log("Service initialization failed...")}};var s=b.getServiceUrl(t)}},getDefaultImage:function(){var s=this;if(this.serviceUrl){this.defaultImage=this.serviceUrl+"/snresources/images/icons/large/iconLargeDefault.png"}},createView:function(t){var s=this;if(this.dialog){g.unmask(this.dialog.elements.body);g.unmask(this.PClistContainer)}this.PCListView=new r({collection:t,useInfiniteScroll:false,scrollDuration:1,itemView:i,layout:{column:{xsmall:1}},itemViewOptions:{className:"item-view",mapping:{title:"marketingName",image:"icon",subtitle:function(){var u=new UWA.Element("div",{id:"pcSubtitle",html:"<span class=type>"+this.model.get("name")+"</span>"});return u.innerHTML},content:function(){var v;if(this.model.get("state")==="Partial"){v=n.Filter_PC_Completeness_Partial}else{if(this.model.get("state")==="Complete"){v=n.Filter_PC_Completeness_Complete}else{if(this.model.get("state")==="Hybrid"){v=n.Filter_PC_Completeness_Hybrid}}}var y=new UWA.Element("div",{id:"pcStatus",html:"<span class=type>"+n.Filter_PC_Completeness_DisplayName+": "+v+"</span>"});var z;if(this.model.get("maturity")==="Preliminary"){z=n.Filter_PC_Preliminary}else{if(this.model.get("maturity")==="Active"){z=n.Filter_PC_Active}else{if(this.model.get("maturity")==="Inactive"){z=n.Filter_PC_Inactive}}}var w=new UWA.Element("div",{id:"pcStatus",html:"<span class=type>"+n.Filter_PC_Maturity_DisplayName+": "+z+"</span>"});var x=new UWA.Element("div",{id:"pcBasedOn",html:"<span class=type>"+n.Filter_PC_BasedOn_DisplayName+": "+this.model.get("basedOn")+"</span>",styles:{"white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden"}});var u=new UWA.Element("div",{id:"pcCont",styles:{color:"#808080"}});u.appendChild(y);u.appendChild(w);u.appendChild(x);return u.innerHTML},icon:"icon"},contextualActions:[{text:n.Filter_Edit,fonticon:"pencil",actionId:"Edit",handler:function(u,w){s.dialog.hide();var v=u.model.get("id");s.launchVariantEditor(v)}}]},withMultisel:false,events:{onItemViewClick:function(v,u){console.log("selected Item model is:",u.model);s.itemClickHandler(u)}}});this.PCListView.render().inject(this.PClistContainer);this.PCListView.scrollView.scroller.elements.content.setStyle("bottom","0px");this.addStyling()},itemClickHandler:function(s){s.model.set("selected",true);var t=this.getSelectedNodeInfo(s.model);this.addStyling();this.options.pcExpression.displayExpression=JSON.stringify(t);this.options.pcExpression.xmlExpression=this.json2xml_str(t);console.log("Config Criteria:",this.options.pcExpression);this.pcExpression=this.options.pcExpression},json2xml_str:function(t){var s="";for(var u in t){if(!t.hasOwnProperty(u)){continue}if(t[u]==undefined){continue}s+="<"+u+">";if(typeof t[u]=="object"){s+=json2xml_str(new Object(t[u]))}else{s+=t[u]}s+="</"+u+">"}return s},addStyling:function(){if(this.PCListView.container){var t=this.PCListView.container.getElementsByClassName("actions-inline-container");for(var v=0;v<t.length;v++){var y=t[v].getElementsByClassName("fonticon-pencil")[0];if(y){y.setStyle("font-size","20px")}}var u=this.PCListView.container.getElementsByClassName("tile-header");var z=this.PCListView.container.getElementsByClassName("tile-container");for(var v=0;v<u.length;v++){var A=u[v];if(A){A.style.height="75px"}var x=z[v];if(x){x.style.height="95px"}}var w=this.PCListView.container.getElementsByClassName("tile-subtitle");if(w){for(var v=0;v<w.length;v++){w[v].style.whiteSpace="nowrap";w[v].style.textOverflow="ellipsis";w[v].style.overflow="hidden";w[v].style.fontSize="13px";w[v].style.marginBottom="2px";w[v].style.color="black";w[v].style.fontFamily="sans-serif"}}var s=this.PCListView.container.getElementsByClassName("tile-content");if(s){for(var v=0;v<s.length;v++){s[v].style.color="#808080";s[v].style.fontFamily="sans-serif"}}}},getSelectedNodeInfo:function(u){var t={};var s=["id","label","description"];Object.keys(u._attributes).forEach(function(v){if(s.indexOf(v)!==-1){t[v]=u._attributes[v]}});return t},getModel:function(){var t=this;this.dialog=new o({closable:true,header:"<h4>"+n.Filter_Product_Config_Chooser+"</h4>",body:this.MainContainer,footer:this.createActionsPresenter(),events:{onShow:function(){g.mask(t.dialog.elements.body)}}}).inject(this.options.parentContainer);this.dialog.show();this.dialog.elements.body.setStyle("padding","0px");var s=t.dialog.elements.header.getElementsByTagName("h4");if(s&&s[0]){s[0].style.whiteSpace="nowrap";s[0].style.overflow="hidden";s[0].style.textOverflow="ellipsis";this.headerTooltip=new p({target:s[0],body:s[0].innerHTML,position:"bottom"})}this.dialog.getContent().getElements(".btn").forEach(function(u){u.addEvent("click",function(){if(this.hasClassName("btn-primary")){if(t.pcExpression!==undefined&&t.pcExpression!==""&&t.pcExpression!==null){t.options.okCallback(t.pcExpression)}require("DS/CfgBaseUX/scripts/CfgData",function(v){v.selectedOptionsforConfigurator="";t.pcExpression="";t.dialog.destroy()})}if(this.hasClassName("btn-default")){t.dialog.hide();t.pcExpression="";t.dialog.destroy()}})});this.dialog.elements.close.onclick=function(){t.pcExpression="";t.dialog.destroy()}},createActionsPresenter:function(){var s=UWA.createElement("div",{"class":"pc-actionsContainer"});var u=new l({value:n.Filter_Apply,className:"primary btn btn-primary okBtn"}).inject(s);var t=new l({value:n.Filter_Cancel,}).inject(s);return s},sortPCsByName:function(){var s=document.getElementsByClassName("fonticon fonticon-down-bold");var t=true;if(s.length==0){var t=false;s=document.getElementsByClassName("fonticon fonticon-up-bold")}if(this.PCListView.collection.length>0){var u=[];u=this.PCListView.collection.sortBy("label");if(!t){u.reverse()}this.PCListView.collection.reset(u);this.addStyling();this.changeSortIcon(s,t)}},changeSortIcon:function(s,t){if(s.length>0){s[0].className=t?"fonticon fonticon-up-bold":"fonticon fonticon-down-bold"}},searchPC:function(){var s=document.querySelector("#pcchooser-PCSearchContainer");var t=s.getStyle("display");if(t=="table-row"){s.setStyle("display","none")}else{s.setStyle("display","table-row")}},filterSearch:function(){var s=[];this.PCListView.destroy();s=this.collectionNew.filter(this.filterNameBased);var t=new UWA.Class.Collection(s);this.createView(t)},filterNameBased:function(s){var v=false;var x=s._attributes.subLabel;var u=s._attributes.label;var w=a.enteredText;if(w&&w.length){if(x){x=x.toLowerCase()}if(u){u=u.toLowerCase()}w=w.toLowerCase();var t=x.indexOf(w);if(t<0){t=u.indexOf(w)}v=(t>=0)?true:false}if((w===undefined)||(w.length===0)){v=true}if(v==true){return s}}};return a});