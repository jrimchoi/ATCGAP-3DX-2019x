define("DS/CollaborativeTasks/Models/RDFTasksWorkscopeModel",["UWA/Core","DS/E6WCommonApps/Models/WorkscopeModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/SmartSchedulerUtils"],function(h,d,b,g,c){var f="dsxplan:hasTask";var e="invoke/dsxplan:getTasksForProject?$mask=dsplan:MVMask.Task.CollaborativeTask.Basic";var a=d.extend({_uwaClassName:"RDFTasksWorkscopeModel",getTaskCollectionForFilter:function(k,m){var l=this.getCollectionAttribute(d.TASK_RELATION_ATTR,{mask:"dsplan:MVMask.Task.Complex",detailsMask:"dsplan:MVMask.Task.Complex"});l.setIdForCreateChild(this.id+"/"+f);var j=h.clone(m||{},false);var i=this.getTaskFetchOptions(k);h.merge(j,i);l.fetch(j);return l},getTaskFetchOptions:function(j){var i={};i.url=b.expandUrl(e);i.data=JSON.stringify([this.id,j,c.getCompletedTaskFilter()]);i.headers={"Content-Type":"application/json"};i.method="POST";return i}});return a});define("DS/CollaborativeTasks/Collections/MergingSplitCollection",["UWA/Core","DS/E6WCommonUI/Collections/MergingCollection"],function(c,b){var a=b.extend({_uwaClassName:"MergingSplitCollection",getSaveAttributes:function(){return this._subCollections[0].getSaveAttributes.apply(this,arguments)},dataForRendering:function(){var e=this._subCollections[0];var f=e.dataForRendering.apply(e,arguments);var d=this._subCollections[1];var g=d.dataForRendering.apply(d,arguments);f.filteredCount=f.filteredCount+g.filteredCount;return f}});Object.defineProperty(a.prototype,"extid",{get:function(){return this._subCollections[0].extid}});Object.defineProperty(a.prototype,"_valueForFiltering",{get:function(){return this._subCollections[0]._valueForFiltering}});Object.defineProperty(a.prototype,"_filterAttr",{get:function(){return this._subCollections[0]._filterAttr}});return a});define("DS/CollaborativeTasks/Views/CustomizedStartStopView",["UWA/Core","DS/E6WCommonUI/Views/StartStopView"],function(c,b){var a=b.extend({_uwaClassName:"E6WCommonUIStartStopView",template:function(){var d=arguments[0].data;if(d){this.setEditFlagOnFields(d)}return this._parent.apply(this,arguments)},_clearValidationErrors:function(){this._parent.apply(this,arguments);var d=this.container.getElements(".has-error");if(d.length>0){for(var e=0;e<d.length;e++){d[e].toggleClassName("has-error",false)}}}});return a});define("DS/CollaborativeTasks/Models/UserGroupModel",["DS/Foundation2/Models/FoundationBaseModel","DS/E6WCommonUI/PlatformManager"],function(a,c){var b=a.extend({_uwaClassName:"UserGroupModel",dataForRendering:function(){var d=this._parent.apply(this,arguments);d.image=this.getUserGroupImage()||d.image;d.firstname=d.Title;return d},getUserGroupImage:function(){try{var d=c.getServiceUrl("usersgroup");return d+"/3DRDFApps/webapps/i3DXRDFGroupViewer/assets/img/default-group.png"}catch(f){return undefined}}});return b});define("DS/CollaborativeTasks/Views/TaskMenuMixin",["DS/Foundation2/FoundationV2Data","DS/E6WCommonUI/UIHelper"],function(d,a){var b=function(){return d.getWidgetConstant.apply(this,arguments)};var c={createMenuButtons:function(h){var i=this;var g=[];var f=h&&h.modificationPending;var e=this.model&&this.model.isRouteTask&&this.model.isRouteTask();if(!this.model){return undefined}g.push({className:i.editItemClassName(),fonticon:"pencil",text:b("emxCollaborativeTasks.Command.Edit"),func:function(){i.dispatchEvent("onTaskCardClicked",i)}},{className:i.launchItemClassName(),fonticon:"logout",disabled:!i.launchItemAccess()||f,text:b("emxCollaborativeTasks.Command.OpenProjectItem"),func:function(j){i.openProjectItemCallback(j)}},{className:i.assignToSelfItemClassName(),fonticon:"user-add",disabled:!i.assignToSelfItemAccess()||f,text:b("emxCollaborativeTasks.Command.AssignToSelf"),func:function(){i.assignToSelf()}});g=i.getConditionalDropMenuItems(g,e);g.push({className:i.completeItemClassName()+(i.model.isComplete()?"re-open":""),fonticon:i.model.isComplete()?"reset":"check",disabled:(!i.completeItemAccess()&&!i.reOpenItemAccess())||f,text:i.model.isComplete()?b("emxCollaborativeTasks.Command.ReOpen"):b("emxCollaborativeTasks.Command.Complete"),func:i.toggleStateIntoOrOutOfDone.bind(i)},{className:i.deleteItemClassName(),fonticon:"trash",disabled:e||!i.deleteItemAccess()||f,text:b("emxCollaborativeTasks.Command.Delete"),func:function(){i.deleteItemCallback()}});return i.getCardMenu(g)},getConditionalDropMenuItems:function(f,e){var h=this;var g=this.model&&this.model.isProjectTask();if(this.subscribedToItem()&&!g&&!e&&this.model.subscriptionsEnabled()){f.push({className:h.unsubscribeItemClassName(),fonticon:"rss",visible:false,text:b("emxCollaborativeTasks.Command.Unsubscribe"),func:function(){h.toggleSubscription()}})}else{if(!g&&!e&&this.model.subscriptionsEnabled()){f.push({className:h.subscribeItemClassName(),fonticon:"rss",text:b("emxCollaborativeTasks.Command.Subscribe"),func:function(){h.toggleSubscription()}})}}return f},getCardMenu:function(e){var f={value:"",dropdownCaret:false,removeOnHide:true,id:this.menuId(),className:"link",icon:"fonticon-open-down",dropdown:{items:e},events:{onDropdownClick:function(h,g){if(g&&typeof g.func==="function"){g.func()}}}};return f},deleteItemClassName:function(){return"item"+this.id()+"delete"},completeItemClassName:function(){return"item"+this.id()+"complete"},launchItemClassName:function(){return"item"+this.id()+"launch"},subscribeItemClassName:function(){return"item"+this.id()+"subscribe"},unsubscribeItemClassName:function(){return"item"+this.id()+"unsubscribe"},assignToSelfItemClassName:function(){return"item"+this.id()+"assign"},editItemClassName:function(){return"item"+this.id()+"edit"},toggleSubscription:function(){this.model.save("subscribed",String(!this.subscribedToItem()).toUpperCase(),{patch:true,onFailure:function(){var e=b("emxCollaborativeTasks.Error.FailSubscription");a.displayError(e)}})},deleteItemAccess:function(){return this.model.canDelete()},completeItemAccess:function(){var e=!this.model.isComplete()&&this.model.get("canEdit");if(e){if(this.model.isProjectTask()&&this.model.get("needsReview")==="Yes"&&this.model.get("state")!=="Review"){e=false}}return(e)},reOpenItemAccess:function(){var e=!this.model.isRouteTask()&&this.model.isComplete();if(this.model.isRDF){e=e&&this.model.get("canEdit")}return e},subscribedToItem:function(){var e=this.model&&this.model.get("subscribed");if(e===undefined){e="false"}return(e==="TRUE")},launchItemAccess:function(){return this.model&&this.model.isProjectTask()},assignToSelfItemAccess:function(){return this.model.canAssignToSelf()},deleteItemCallback:function(){var f=this;if(f.deleteItemAccess()){var e=f.model;e.destroy({onComplete:function(){a.displaySuccess(b("emxCollaborativeTasks.Label.TaskDeleted"))},onFailure:function(){a.displayError(b("emxCollaborativeTasks.Error.FailedToDeleteTask"))}})}},openProjectItemCallback:function(g){var f=g||this.model.id;var e=d.calculateFinalUrl("/emxLogin.jsp?appName=ENOPRPR_AP&physicalId="+f);window.open(e,"projectWindow");return true},toggleStateIntoOrOutOfDone:function(){var f=this.options.stateValues||this._parentView.options.stateValues;var i=f.length;var e;var g=this.model.isComplete()?"Active":"Complete";for(var h=0;h<i;h++){if(f[h].actualValue===g){e=f[h].displayValue}}if(!this.model.isComplete()){this.completeItem(e)}else{this.reOpenItem(e)}},reOpenItem:function(f){var g={actualValue:"Active",displayValue:f};if(this.model.isRDF){g.displayValue=b("emxCollaborativeTasks.Label.InProgress")}var e=this.stateChangeOptions(g.displayValue);this.model.save("state",g.actualValue,e)},completeItem:function(f){if(!this.model.isComplete()){var h={actualValue:"Complete",displayValue:f};if(this.model.isRDF){h.displayValue=b("emxCollaborativeTasks.Label.Done")}var g=b("emxCollaborativeTasks.Error.FailSetToComplete");var e=this.stateChangeOptions(h.displayValue,g);this.model.save("state",h.actualValue,e)}},stateChangeOptions:function(g,f){var e={patch:true,onComplete:function(){var h=b("emxCollaborativeTasks.Label.SuccessfullyChangedAttribute");h=h.replace("%ATTRIBUTE_NAME%",b("emxCollaborativeTasks.Command.View.state"));h=h.replace("%ATTRIBUTE_VALUE%",g);a.displaySuccess(h)},onFailure:function(){var h;if(f){h=f}else{h=b("emxCollaborativeTasks.Label.FailedToChangeAttribute");h=h.replace("%ATTRIBUTE_NAME%",b("emxCollaborativeTasks.Command.View.state"));h=h.replace("%ATTRIBUTE_VALUE%",g)}a.displayError(h)}};return e},assignToSelf:function(){if(this.assignToSelfItemAccess()){this.model.assignToSelf()}},menuId:function(){return"menu"+this.id()+"card"}};return c});define("DS/CollaborativeTasks/Models/TaskModel",["UWA/Core","DS/Foundation2/FoundationV2Data","DS/Foundation2/Models/FoundationBaseModel","DS/Foundation2/Models/ReferenceModel","DS/Foundation2/Collections/FoundationBaseCollection","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/TaskModelMixin","DS/E6WCommonApps/Models/FileManagementMixin","DS/E6WCommonApps/XTaskScope","DS/Foundation2/Collections/ProxyFoundationBaseCollection","DS/CollaborativeTasks/Models/UserGroupModel","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(c,e,J,g,q,w,E,H,y,G,B,o){var K=function(L){var M=e.getWidgetConstant.apply(this,arguments);M===L&&(M=o.get(L));return M};var r="route";var F="assignees";var p="references";var D="scopes";var d="originatorInfo";var v="ownerInfo";var f="ObjectInfo";var k="deliverables";var b="dependenciesPredecessors";var t="dependenciesSuccessors";var a="DPMProject";var j="state";var s="stateForDisplay";var n={"To Do":"Assign","In Progress":"Active",Done:"Complete"};var I={Create:"To Do",Assign:"To Do",Active:"In Progress",Review:"In Progress",Complete:"Done"};var m=g.extend({});var i=null;m.typeAheadCallback=function(M,L,N){if(i!==null){i.cancel();i=null}i=e.ajaxRequest({url:"/resources/v2/e6w/service/PersonSearch?searchStr="+L+"*",type:"get",dataType:"json",callback:function(U){var P=[];i=null;if(U.success&&U.data&&U.data.length){var Q=U.data.length;for(var R=0;R<Q;R++){var T=U.data[R];if(T.dataelements){var S=T.dataelements.firstname||"";var O=T.dataelements.lastname||"";var V=T.dataelements.name||"";P.push({value:T.id,label:S+" "+O,image:w.userPictureURL(V)})}}}N(P)},headers:{"content-type":"application/json"}});return(i)};var z=function(M,L){switch(M.type){case"Group":case"Group Proxy":return new B(M,L);default:return new m(M,L)}};z.prototype.idAttribute="id";var l=q.childCollection.extend({});var C=J.extend({ASSIGNEESATTR:F,_relations:[{key:F,collectionType:l,serviceName:f,relatedModel:z},{key:d,relatedModel:m,collectionType:l,serviceName:f},{key:v,relatedModel:m,collectionType:l,serviceName:f},{key:p,serviceName:f,collectionType:G},{key:D,serviceName:f,relatedModel:g},{key:k,serviceName:f,collectionType:G},{key:b,serviceName:f,relatedModel:g},{key:a,serviceName:f,relatedModel:g},{key:r,serviceName:f,relatedModel:g},{key:t,serviceName:f,relatedModel:g}],_uwaClassName:"TaskModel",addAssigneesByName:function(N){var L=N.map(function(O){return{image:w.userPictureURL(O)}});var M=this.addObjects(N,this.getMappedAttribute(this.ASSIGNEESATTR),"name",{otherObjectAttributes:L});return M},_getValidationOptions:function(M){var N=K("emxComponents.Routes.ShowCommentsForTaskApproval").toLowerCase().trim()!=="false";var R=N&&(K("emxComponents.Routes.EnforceAssigneeApprovalComments").toLowerCase().trim()!=="false");var Q=K("emxComponents.Routes.EnforceOwnerReviewComments").toLowerCase().trim()!=="false";var P=M.needsReview;var L=M.state;var O=this.get("state");return{needsReview:P,newState:L,currentState:O,showComments:N,enforceAssigneeApprovalComments:R,enforceOwnerReviewComments:Q}},_validateNeedsReview:function(M,N,L){if(!(L.currentState==="Review"||L.currentState==="Complete")){if(L.newState==="Complete"&&L.needsReview==="Yes"){N.fields.push("needsReview")}}},validate:function(M){var N;var L={fields:[]};var O=this._getValidationOptions(M);this._validateNeedsReview(M,L,O);if(L.fields.length){N=L}return N},get:function(L){switch(L){case"canEdit":return !this.isComplete()&&this.get("modifyAccess")==="TRUE";case s:return I[this.get(j)];case this.DUEDATECATEGORY:return this.dueDateCategory(this.get(this.DUEDATEATTR));default:break}return this._parent.apply(this,arguments)},getFieldDef:function(M){var L=this.getInMemoryData();var N=L&&L.getAllFields();N=N||{};return N[M]},set:function(){var O=w.setHelper.apply(this,arguments);var N=c.clone(O.attrs||{},false);var M=O.options;if(N){if(N.hasOwnProperty(s)){var P=N[s];delete N[s];N[j]=n[P]}if(N.hasOwnProperty(this.DUEDATECATEGORY)){var L=N[this.DUEDATECATEGORY];delete N[this.DUEDATECATEGORY];if(!(this.isProjectTask()&&L==="NO_DATE")){N[this.DUEDATEATTR]=this.dueDateCategory2DueDate(L)}}return this._parent(N,M)}return this._parent.apply(this,arguments)},toJSON:function(M){var L=this._parent.apply(this,arguments);if(M&&M.onlyUpdated&&!M.dataForRendering){delete L.dueDateCategory}if(M&&M.dataForRendering){L[this.DUEDATECATEGORY]=this.get(this.DUEDATECATEGORY);L[s]=this.get(s)}return L},setup:function u(){this.nbInFlightRequests=0;this.listenTo(this,"onChange:"+a,function(){this.adjustDuration();this._filterDatabyScope()});this.listenTo(this,"onChange:"+D,function(){this._filterDatabyScope()});this.listenTo(this,"onChange:"+F,function(){this._filterDatabyScope()});this.listenTo(this,"onChange:"+this.DUEDATEATTR,function(M,N,L){if(!L.silent){M.dispatchEvent("onChange:"+this.DUEDATECATEGORY,arguments)}});this.listenTo(this,"onChange:"+j,function(M,N,L){var P=I[M.previousAttributes()[j]];var O=I[N];if(P!==O&&!L.silent){M.dispatchEvent("onChange:"+s,[M,O,L])}});this.listenTo(this,"onReset",this._filterDatabyScope);this._parent.apply(this,arguments)},dataForRendering:function A(){var L=this._parent.apply(this,arguments);if(this.isComplete()){L.date=L.actualFinishDate}else{L.date=L.dueDate}L.canEdit=this.get("canEdit");return L},adjustDuration:function(){var L=this.get("estimatedDuration")||0;if(c.is(L,"string")){L=parseInt(L,10)}var M=this.isProjectTask()?1:0;if(L>=M){return}this.set("estimatedDuration",M)},isProjectTask:function(){var L=this.get(a);return Boolean(L&&L.length)},isRouteTask:function(){return false},isRDFTask:function(){return false},subscriptionsEnabled:function(){var L=e.getWidgetConstant("ENABLE_SUBSCRIPTIONS");return !this.isProjectTask()&&(L==="true"||L==="TRUE")},addObjects:function(Y,N,L,O){var P=c.clone(O||{},false);var V=[];if(N==="assignees"||N==="references"){var S=false;var X=[];this.get(N).forEach(function(ad){var ae={};ae.id=(L&&ad.get(L))||ad.id;if(N==="assignees"){ae.name=ad.get("firstname")+" "+ad.get("lastname")}else{ae.name=ad.get("name")}X.push(ae)});var aa,W;var Q=function(ad){aa=ad.id===W?ad:false;return aa};if(P.values&&N==="assignees"){var M=P.values.length;for(var U=0;U<M;U++){aa=false;W=P.values[U].get("name");X.some(Q);if(aa){S=true;V.push(aa.name)}}}else{var ab=Y.length;for(var ac=0;ac<ab;ac++){aa=false;W=Y[ac];X.some(Q);if(aa){S=true;V.push(aa.name)}}}if(S){var R;if(N==="assignees"){R=K("emxCollaborativeTasks.Warning.AlreadyAssigned")}else{R=K("E6WCommonUI.Warning.AlreadyAttached")}var T=V[0];for(var Z=1;Z<V.length;Z++){T+=", "+V[Z]}R=R.replace("{EXISTING_CHILD_NAME}",T).replace("{PARENT_NAME}",this.get("title"));R=R.replace("%ALREADY%",T).replace("%TASK_NAME%",this.get("title"));P.onFailure&&P.onFailure(R);return{}}}return this._parent.apply(this,arguments)},_filterDatabyScope:function x(S){if(this.collection){var Y=y.getScopeId();var Q=y.getScopeType();var P=this;var W=true;var T;var V=function(){};if(Y&&Y!=="tempfix"&&!y.isScopeRDF()){var M=this.collection.projectTypes().split(",");if(M.indexOf(Q)!==-1){T=this.get(this.DPMPROJECTATTR)}else{T=this.get(this.SCOPESATTR)}V=function(Z){return Z.id||Z.get("objectId")}}else{if(!y.isScopeRDF()){Y=window.enoviaServer.user;T=this.get(this.ASSIGNEESATTR);var L=this.get(v);if((!L||!L.length)&&this.isNew()){L={get:function(aa){var Z;if(aa==="name"){Z=Y}return Z}}}T=T.concat(L);V=function(Z){return Z.get("name",{noMapping:true})}}else{T=[]}}var X,U;for(var O=0;O<T.length;O++){U=T[O];X=V(U);if((X&&Y&&X.toUpperCase()===Y.toUpperCase())||this.isProjectTask()||this.isRouteTask()){W=false;break}}var N=window.widget.getValue("showProjectTasks");if(!W&&(N===false||N==="false")){var R=this.get(this.DPMPROJECTATTR);W=R.length}if(W){c.Utils.setImmediate(function(){if(P.collection){P.collection.remove(P)}if(typeof S==="function"){S()}})}else{if(typeof S==="function"){S()}}}},uploadFile:function h(N,M,P){var Q=this;this._onRequest();var L=c.clone(P||{},false);var R=L.onComplete;var O=L.onFailure;L.onComplete=function(){Q._onCompleteRequest();Q.set("subscribed","sendEmail");Q.save();if(R){R.apply(this,arguments)}};L.onFailure=function(){Q._onCompleteRequest();if(O){O.apply(this,arguments)}};L.collabspace=this.get("project");this._parent(N,M,L)},sync:function(R,O,N){var M=Array.prototype.slice.call(arguments,0);var L=c.clone(N||{},false);M[2]=L;if(R==="create"){var P=this;var Q=L.onComplete;L.onComplete=function(){P.completed=true;if(Q){Q.apply(this,arguments)}}}return this._parent.apply(this,M)},getWorkDayLength:function(){return 8},getWorkingHoursInMilliseconds:function(){return this.getWorkDayLength()*60*60*1000},isStarted:function(){var L=this.get(j);return(L==="Active"||L==="Review")},getStartDate:function(){return(this.isStarted()?this.get(this.ACTUALSTARTDATEATTR):this.get("estimatedStartDate"))},getPercentComplete:function(){return this.get("percentComplete")===undefined?-1:parseFloat(this.get("percentComplete"))},getEstimatedDuration:function(){var L=this.get("estimatedDuration")||0;return L&&parseFloat(L)},getDefinedDuration:function(){return this.getEstimatedDuration()},getTransferObject:function(N){var O=this.get("type");var M=c.clone(N||{},false);var L=c.merge(M,{source:window.widget.getValue("appId")||"ENOTASK_AP",envId:window.enoviaServer.tenant||window.widget.getValue("x3dPlatformId"),objectId:this.id,objectType:O,objectType_Internal:O,displayName:this.get("title"),image:this.get("typeicon")});return w.getTransferObject(L)},canDelete:function(){var L=this.get("deleteAccess");L=(L==="FALSE")?false:L;var M=this.get("state");var N=(M==="Assign"||M==="Create");return L&&N}});C.implement(E,{updateDocument:H.updateDocument});C.getAttachmentErrorMessage=function(L,M){var N="";if(L===F){N=K("emxCollaborativeTasks.Error.FailedToAssignUser")}else{if(L===p){N=K("emxCollaborativeTasks.Error.FailedToCreateReference")}else{if(L===D){N=K("emxCollaborativeTasks.Error.FailedToCreateScope")}}}N=N.replace("%NAME%",M);return N};C.PersonModel=m;C.ReferenceModel=g;Object.defineProperty(C.prototype,"extid",{get:function(){return this.id}});return C});define("DS/CollaborativeTasks/Models/TskCloneModel",["UWA/Core","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonUI/Models/CloneModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/Models/DropValidator","i18n!DS/CollaborativeTasks/assets/nls/CollaborativeTasksNLS"],function(g,f,h,d,i,e,l){var j="DPMProject";var k=f.getWidgetConstant;f.getWidgetConstant=function(n){var o=k.apply(this,arguments);return o||l.get(n)};var m=function(){return f.getWidgetConstant.apply(this,arguments)};var c={d:0,h:1};var b=["d","h"];var a=d.extend({_uwaClassName:"TskCloneModel",init:function(o,n){this._parent.apply(this,arguments);this.listenTo(this,"onChange:"+j,function(){this.dispatchEvent("onChange:scopes",[this,n])});return this},i18n:m,_attributesGet:function(n,o){return n?n[o]:this.get(o)},validate:function(o){var r=true;var p={fields:[],messages:{}};var s=this._attributesGet(o,"title");var n=this.model.isRouteTask();var q=!n&&f.containsBadChars(s);if(!(s&&s.length)||q){p.fields.push("title");if(q){p.messages.title=m("emxCollaborativeTasks.Validate.TitleError")}r=false}r=r&&this._validateActualDates(o,p);return r?undefined:p},_validateActualDates:function(p,q){var r=true;var n=this._attributesGet(p,"actualStartDate");var t=this._attributesGet(p,"actualFinishDate");var s=this._attributesGet(p,"state");if(s!=="Create"&&s!=="Assign"&&(!n||typeof n==="undefined"||n==="")){if(this._hasModifiedProperty("actualStartDate")){q.fields.push("actualStartDate");r=false}}if(s==="Complete"&&(!t||typeof t==="undefined"||t==="")){q.fields.push("actualFinishDate");r=false}var o=new Date();n=n&&new Date(n).setHours(0,0,0,0);t=t&&new Date(t).setHours(0,0,0,0);if(n&&n>o){q.fields.push("actualStartDate");r=false}if(t&&t>o){q.fields.push("actualFinishDate");r=false}if(n&&t&&n>t){q.fields.push("actualStartDate");r=false}return r},get:function(p){if(p==="scopes"){var n=this._parent(j);if(n&&n.length){return n}}var o=this._parent.apply(this,arguments);if(p==="needsReview"){return o==="Yes"?"TRUE":"FALSE"}switch(p){case"estimatedDurationInputUnit":o=c[o];break;case"modified":case"originated":case"actualStartDate":case"actualFinishDate":o=i.getIntlDateFormat(o);break;default:break}return o},dataForRendering:function(){var r=this._parent();var n,q;if(!this.model||!g.is(this.model.isRouteTask,"function")||!this.model.isRouteTask()){n=this.get("scopes");q=n&&n.length?[n[0].dataForRendering()]:[];r.scopes=q}if(r.route){r.route.forEach(function(s){s.image={imageValue:window.enoviaServer.computeUrl("/common/images/iconSmallRoute.gif")}})}var p=this.get("estimatedDurationInputUnit");p!==undefined&&(r.estimatedDurationInputUnit=p);var o=this.get("needsReview");o!==undefined&&(r.needsReview=o);r.modified!==undefined&&(r.modified=this.get("modified"));r.originated!==undefined&&(r.originated=this.get("originated"));r.actualStartDate!==undefined&&(r.actualStartDate=this.get("actualStartDate"));r.actualFinishDate!==undefined&&(r.actualFinishDate=this.get("actualFinishDate"));return r},set:function(u,t,v){var q=t;if(t.actualValue&&typeof t.actualValue!=="undefined"&&t.actualValue!==""){var n=this.model.getFieldDef(u);if(n&&n.format&&(n.format==="UTC"||n.format==="date")){var s=new Date(t.actualValue);var r=s.getDate();var o=s.getMonth();var p=s.getFullYear();s.setUTCHours(12,0,0,0);s.setMonth(o,r);s.setFullYear(p);q=s}}if(typeof q.actualValue!=="undefined"){q=q.actualValue}if(u==="title"){q=q.trim()}if(u==="needsReview"){q=q==="TRUE"?"Yes":"No"}if(u==="estimatedDurationInputUnit"){q=b[q]}return this._parent(u,q,v)},add:function(q,o,n){var p=n&&n.dropObj;if(p&&!e.validateTenant(p.envId)){i.displayError(i.getTenantErrorMessage(p.envId,window.enoviaServer.tenant));return[]}return this._parent.apply(this,arguments)},addIndividualObject:function(n){if(n==="scopes"){return this._addForScopes.apply(this,arguments)}else{return this._parent.apply(this,arguments)}},_addForScopes:function(r,q,o){var p=function(s){return this._addCompletedModelToScope(s,r,o)};var n=this.model.collection.getRelatedObject(r,q);if(n.get("type")){return p.call(this,n)}else{this.listenToOnce(n,"onChange:type",p)}return{ret:n}},_addCompletedModelToScope:function(s,v,y){var r={};if(v==="scopes"){var p=s.get("type");var o=this.scopesTypes.concat(this.projectTypes);var t=o.indexOf(p);if(t!==-1){var u=this.get(v);var n=g.clone(y||{},false);n.silent=true;if(!(u&&u.length&&u[0]===s)){if(u&&u.length){this.remove(v,0,n)}var x=this.projectTypes.indexOf(p);var q=(x!==-1)?j:v;r=d.prototype.addIndividualObject.call(this,q,s.id,s,n);if(r.changedModificationPending){this.dispatchEvent("onChange:modificationsPending")}if(r.changed){n=g.clone(y||{},false);n.operation="add";this._fireRelationshipChangeEvents(q,n);q!==v&&this._fireRelationshipChangeEvents(v,n)}}}else{var w=m("emxCollaborativeTasks.Error.InvalidScopesType");w=w.replace("%TYPE%",p);i.displayError(w)}}return r},remove:function(q,p,o){var n=Array.prototype.slice.call(arguments,0);var r;if(q==="scopes"){if(o&&o.singleObjectRemove){return r}var s=this.get(j);if(s&&s.length){n[0]=j}}return this._parent.apply(this,n)},save:function(){var n=this.localAttributes;this._parent.apply(this,arguments);if(this.model.validationError){this.localAttributes=n;this.modificationsPending=true;this.dispatchEvent("onChange:modificationsPending",[this])}}});return a});define("DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig",["UWA/Core","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/Models/RDFCloneModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Views/DependencyGroupView","DS/E6WCommonUI/Views/ObjectCardView","DS/RDFFoundation/RDFUtils","DS/CollaborativeTasks/Views/CustomizedStartStopView","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/UIHelper","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(h,o,i,s,a,l,f,e,r,d,b,n,c,q,k){var j=function(v){var w=o.getWidgetConstant.apply(this,arguments);w===v&&(w=k.get(v));return w};var u={};u.config=function(){var v=j("emxCollaborativeTasks.GroupLabel.More");return[{readWrite:"true",name:"title",type:"text",removeCarriageReturns:true,numberOfEditableLines:4,maxLength:128,required:true,validate:true},{readWrite:"true",name:"description",label:j("emxCollaborativeTasks.Label.TaskDescription"),type:"textarea",numberOfDisplayLines:3,numberOfEditableLines:6},{readWrite:"true",name:"scopes",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:true,label:j("emxCollaborativeTasks.Label.AssociatedWith"),searchTitle:j("emxCollaborativeTasks.Label.referencesAssociatedWithTitle"),customView:d,typeAheadCallback:i.ReferenceModel.typeAheadCallback,searchSource:l.filterSearchSources(["3dspace"]),linkCallback:a.launchProperties,getDropDownMenuItems:a.getDropDownMenuItems,placeHolder:j("emxCollaborativeTasks.Label.ObjectPlaceHolder")},{readWrite:"true",name:"state",label:j("emxCollaborativeTasks.Label.TaskStatus"),type:"select"},{name:"dueDate",readWrite:"true",label:j("emxCollaborativeTasks.Label.EstimatedFinishDate"),type:"date",validate:true},{readWrite:"true",name:"estimatedDurationInputValue",unitAttribute:"estimatedDurationInputUnit",label:j("emxCollaborativeTasks.Label.estimatedDuration"),type:"uom",uomValues:[j("emxCollaborativeTasks.Label.Days"),j("emxCollaborativeTasks.Label.Hours")],minimumValue:"0",conversionTable:[1,24]},u.assigneeFieldConfig,u.attachmentFieldConfig,u.deliverablesFieldConfig,{name:"project",label:j("emxCollaborativeTasks.Label.CollaborativeSpace"),type:"text"},{readWrite:"true",name:"actualStartDate",label:j("emxCollaborativeTasks.Label.ActualDates"),type:"startStop",customView:n,startDateLabel:j("emxCollaborativeTasks.Label.StartDate"),canEditStartDate:function(w){var x=w.get("state");return x!=="Create"&&x!=="Assign"},endDateAttribute:"actualFinishDate",endDateLabel:j("emxCollaborativeTasks.Label.FinishDate"),canEditEndDate:function(w){return w.get("state")==="Complete"},validate:true,group:v},{name:"originatorInfo",attributeToDisplay:"name",imageAttribute:"image",label:j("emxCollaborativeTasks.Label.TaskOriginator"),type:"person",customView:d,searchSource:["swym"],group:v,linkCallback:a.launchProperties},{name:"ownerInfo",attributeToDisplay:"name",imageAttribute:"image",label:j("emxCollaborativeTasks.Label.TaskOwner"),type:"person",customView:d,searchSource:["swym"],group:v,linkCallback:a.launchProperties},{name:"originated",label:j("emxCollaborativeTasks.Label.TaskCreated"),type:"date",group:v},{name:"modified",label:j("emxCollaborativeTasks.Label.TaskModified"),type:"date",group:v}]};u.projectConfig=function m(){var v=j("emxCollaborativeTasks.GroupLabel.More");return[{readWrite:"true",name:"percentComplete",label:j("emxCollaborativeTasks.Label.Percent"),type:"range",step:10,percents:true,insertIndex:3},{readWrite:"true",name:"estimatedStartDate",label:j("emxCollaborativeTasks.Label.EstimatedDates"),type:"startStop",startDateLabel:j("emxCollaborativeTasks.Label.StartDate"),endDateAttribute:"dueDate",endDateLabel:j("emxCollaborativeTasks.Label.FinishDate"),insertIndex:5},{name:"taskRequirement",insertIndex:10,label:j("emxCollaborativeTasks.Label.TaskRequirement"),type:"select"},{name:"actualDuration",label:j("emxCollaborativeTasks.Label.ActualDuration"),type:"uom",uomValues:[j("emxCollaborativeTasks.Label.Days"),j("emxCollaborativeTasks.Label.Hours")],conversionTable:[1,24],group:v,insertIndex:12},{readWrite:"true",name:"needsReview",label:j("emxProgramCentral.Task.NeedsReview"),type:"checkbox",insertIndex:18,group:v}]};var p=function(v,z){var A;var x,y,w;if(v==="assignees"){y=o.getFieldValue(z,"firstname");w=o.getFieldValue(z,"lastname");x=h.is(y,"string")&&h.is(w,"string")?(y+" "+w):"";A=j("emxCollaborativeTasks.Error.FailedToDisconnectUser")}else{if(v==="references"){A=j("emxCollaborativeTasks.Error.FailedToDisconnectReference");x=o.getFieldValue(z,"name")}else{if(v==="scopes"){A=j("emxCollaborativeTasks.Error.FailedToDisconnectScope");x=o.getFieldValue(z,"name")}}}A=x?A.replace("%NAME%",x):"";return A};var g=function(v,z){var A;var x,y,w;if(v==="assignees"){y=o.getFieldValue(z,"firstname");w=o.getFieldValue(z,"lastname");x=h.is(y,"string")&&h.is(w,"string")?(y+" "+w):""}else{if(v==="references"||v==="scopes"){x=o.getFieldValue(z,"name")}}A=x?i.getAttachmentErrorMessage(v,x):"";return A};var t=function(v){var w=j("emxCollaborativeTasks.Error.FailedToModify");if(v&&v.response&&v.response.statusCode===400&&v.response.error){w+="<br>"+j(v.response.error)}return w};u.options={onComplete:function(){var v=j("emxCollaborativeTasks.Label.SuccessfulSave");q.displaySuccess(v)},onFailure:function(C,A,F){var E;if(F.clonedInfo){var B=Object.keys(F.clonedInfo);var y=B.length;for(var D=0;D<y;D++){var v=B[D];var w=F.clonedInfo[v].item;var x=F.clonedInfo[v].source._relationship;var z=w.updateAction;if(z==="DISCONNECT"){E=p(x,w)}else{if(z==="CONNECT"){E=g(x,w)}else{if(z==="MODIFY"){E=t(F)}}}if(E){q.displayError(E)}}}else{q.displayError(j("E6WCommonApps.Error.SaveFailed"))}}};Object.defineProperty(u,"assigneeFieldConfig",{get:function(){return{readWrite:"true",name:"assignees",attributeToDisplay:"name",imageAttribute:"image",label:j("emxCollaborativeTasks.Label.TaskAssignedTo"),searchTitle:j("emxCollaborativeTasks.Label.assigneeSearchTitle"),typeAheadCallback:i.PersonModel.typeAheadCallback,dropTypes:c.PERSON_DROP_TYPES,searchSourceTypes:{swym:"pno:Person"},type:"person",searchSource:l.filterSearchSources(["swym"]),customView:d,dropHandler:c.hasInvalidDroppedObject,linkCallback:a.launchProperties,getDropDownMenuItems:a.getDropDownMenuItems,placeHolder:j("emxCollaborativeTasks.Label.ObjectPlaceHolder"),validateSameTenant:true}}});Object.defineProperty(u,"attachmentFieldConfig",{get:function(){return{readWrite:"true",name:"references",attributeToDisplay:"name",imageAttribute:"image",allowFileManagement:true,label:j("emxCollaborativeTasks.Label.References"),searchTitle:j("emxCollaborativeTasks.Label.referencesSearchTitle"),typeAheadCallback:b.typeAheadCallback,type:"object",customView:d,linkCallback:a.launchProperties,getDropDownMenuItems:a.getDropDownMenuItems,placeHolder:j("emxCollaborativeTasks.Label.ObjectPlaceHolder"),searchSource:l.filterSearchSources(["3dspace","drive"]),excludeSearchTypes:{"3dspace":["Person","Security Context"]},validateSameTenant:true}}});Object.defineProperty(u,"deliverablesFieldConfig",{get:function(){return{readWrite:"true",name:"deliverables",attributeToDisplay:"name",allowFileManagement:true,searchTitle:j("emxCollaborativeTasks.Label.deliverablesSearchTitle"),imageAttribute:"image",label:j("emxCollaborativeTasks.Label.Deliverables"),type:"object",customView:d,typeAheadCallback:b.typeAheadCallback,linkCallback:a.launchProperties,getDropDownMenuItems:a.getDropDownMenuItems,placeHolder:j("emxCollaborativeTasks.Label.ObjectPlaceHolder"),searchSource:l.filterSearchSources(["3dspace","drive"]),validateSameTenant:true}}});return u});define("DS/CollaborativeTasks/Views/CardView",["UWA/Core","DS/UIKIT/Input/Button","DS/Handlebars/Handlebars","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/E6WCommonUI/Views/FoundationBaseView","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonUI/UIHelper","DS/CollaborativeTasks/Views/TaskMenuMixin","DS/CollaborativeTasks/Models/TskCloneModel","DS/E6WCommonApps/Models/RDFTaskCloneModel","DS/UIKIT/Tooltip","DS/Foundation2/FoundationV2Data","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/RDFUtils","DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig","DS/E6WCommonApps/Views/RDFTaskDetailsPanelConfig","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/CompassUtil","text!DS/CollaborativeTasks/assets/templates/card.html.handlebars"],function(h,q,j,p,o,m,y,r,f,v,z,w,e,b,i,l,c,u,F){var n=function(){return w.getWidgetConstant.apply(this,arguments)};var A=j.compile(F);var E="drag-over";var B="DPMProject";var x="dragDataTransfer";var t=o.extend({_uwaClassName:"CardView",className:"card real-card drop-target",name:"CollaborativeTasks.CardView",domEvents:{"click .card-content":"onClickTaskCard","dragenter ":"handleDragEnter","dragover ":"handleDragOver","dragleave ":"handleDragLeave","drop ":"handleDrop","dragend .drop-target":"handleDragEnd"},droppedData:null,onClickTaskCard:function(){this.dispatchEvent("onTaskCardClicked",this)},onSelect:function(){this.container.toggleClassName("active",true);u.publishOnPlatformAPI(window.widget.getValue("appId")+".select",this.model)},onUnselect:function(){this.container.toggleClassName("active",false);u.publishOnPlatformAPI(window.widget.getValue("appId")+".unselect",this.model)},id:function(){return"card"+(this.model.extid?this.model.extid:this.model.cid)},destroy:function(){this._tooltip&&this._tooltip.destroy();this.cardMenu&&this.cardMenu.destroy();delete this.cardMenu;this._parent()},_changeDirty:function(){this.container.toggleClassName("pending-modification",this.model.nbInFlightRequests>0);this.showSubscriptionIcon()},setup:function(G){this._parent.apply(this,arguments);this.listenToModelEvent();return G},listenToModelEvent:function(){var H=this;var G={onChange:function(J,I){if(!I||!I.relationshipChanged||I.relationshipChanged==="assignees"){H.render()}else{if(I&&(I.relationshipChanged==="references"||I.relationshipChanged==="deliverables")){H.showAttachmentIcon()}}},"onChange:nbInFlightRequests":this._changeDirty};G["onChange:"+e.USER_DEFINED_START_DATE_ATTR]=this.showFixedIcon;G["onChange:"+e.USER_DEFINED_END_DATE_ATTR]=this.showFixedIcon;this.listenTo(this.model,G);this.listenTo(this.model,"onChange:"+B,function(){this._emptyMenuButtons();this._drawMenuButtons()})},template:function(){return A(this.model.dataForRendering({attributes:["id","title","dueDate","assignees","name","firstname","lastname","state","stateForDisplay"]}))},render:function(){if(this.container){this.container.innerHTML=this.template();this._drawMenuButtons();this.setDefaultImages();this.showAttachmentIcon();this._changeDirty();this.showFixedIcon();this.showCompressionOrLateness();var H=this.getElement(".task-type span");H.toggleClassName("fonticon-route-task",Boolean(this.model.isRouteTask()));H.toggleClassName("fonticon-project-task",Boolean(this.model.isProjectTask()));H.toggleClassName("fonticon-plan-task",Boolean(this.model.isRDFTask()));H.toggleClassName("fonticon-standalone-task",!(this.model.isRouteTask()||this.model.isProjectTask()||this.model.isRDFTask()));var G=this.model.get("assignees");G&&this.container.toggleClassName("more-assignees",Boolean(G.length>3))}return this},showCompressionOrLateness:function(){var G=this.model.getCompressionLevel&&this.model.getCompressionLevel();this.container.toggleClassName("compression-low",false);this.container.toggleClassName("compression-high",false);switch(G){case 1:this.container.toggleClassName("compression-low",true);break;case 2:this.container.toggleClassName("compression-high",true);break;default:}this.container.removeClassName("at-risk");this.container.removeClassName("late");if(this.model.isLate()){this.container.addClassName("late")}else{if(this.model.isAtRisk()){this.container.addClassName("at-risk")}}},showFixedIcon:function(){this.container.toggleClassName("is-fixed",Boolean(this.model.fixed))},showAttachmentIcon:function k(){var H=this.model.get("references")||[];var G=this.model.get("deliverables")||[];H.toArray&&(H=H.toArray());G.toArray&&(G=G.toArray());var I=H.concat(G);this.container.toggleClassName("has-files",Boolean(I.length))},showSubscriptionIcon:function(){var G=this.model.get("subscribed");this.container.toggleClassName("subscribed",(this.model.subscriptionsEnabled()&&G==="TRUE"&&!this.model.isProjectTask()&&!this.model.isRouteTask()))},_emptyMenuButtons:function(){var G=this.getElement(".card-menu");if(G){G.empty()}},_drawMenuButtons:function(){var H=this.getElement(".card-menu");var G=this.createMenuButtons();if(H){this.cardMenu&&this.cardMenu.destroy();this.cardMenu=new q(G).inject(H);this.cardMenu.elements.container.setStyle("min-width","");this._tooltip=new z({target:this.cardMenu.elements.container,body:n("emxCollaborativeTasks.Label.TaskMenu")})}},handleDragOver:function D(G){if(this.model.get("state").toLowerCase()==="complete"){return false}if(G.preventDefault){G.preventDefault()}G.dataTransfer.dropEffect="copy";this.container.addClassName(E);return false},handleDragEnter:function s(){var G;if(this.model.get("state").toLowerCase()==="complete"){return false}this.container.addClassName(E);return G},handleDragLeave:function d(){this.container.removeClassName(E)},handleDrop:function g(J){if(J.stopPropagation){J.stopPropagation()}if(J.preventDefault){J.preventDefault()}this.container.removeClassName(E);var H=J.dataTransfer.files;if(H&&H.length){if(this.model.uploadFiles){var K={onFailure:function(){y.displayError(n("emxCollaborativeTasks.Error.FailUploadDocument"))}};var I=this;K.onComplete=function(L){var N=I.model.isRDFTask()?v:f;var O=new N(I.model);var M={fieldName:I.model.getMappedAttribute("references"),fileName:L.title||L.dataelements.title};O.onFileUploadComplete(M,L);O.save()};this.model.uploadFiles(H,"references",K)}else{y.displayError("emxCollaborativeTasks.Error.NoFileDrop")}return false}var G=y.getDataTransferJSON(J.dataTransfer);if(G){this.processDropData(G,J.dataTransfer)}return false},handleDragEnd:function a(){this.container.removeClassName(E)},processDropData:function C(I){var G=I.data.items;for(var H=0;H<G.length;H++){var J=G[H];if(this.validateDroppedObject(J)){return}}G.forEach(function(O){var L;if(O.objectType==="Person"||O.objectType==="pno:Person"){L="assignees"}else{L="references"}if(this.model.isRDFTask()){var Q=new v(this.model);var N=Q.add(L,[O.objectId],{dropObj:O});N&&Q.save();return}var M=!this.model.isRDFTask()&&O.objectType==="pno:Person"?"name":undefined;var K=this._getIdForDroppedItem(O);var P=this.model.addObjects([K],L,M,{attributes:{service:O.serviceId,tenant:O.envId},onFailure:function(R){y.displayError(R)}});if(P&&P.length){this.model.save(null,{onFailure:function(){y.displayError(m.getAttachmentErrorMessage(L,name))},at:0})}}.bind(this))},_getFieldConfigForValidatingDrop:function(G){var H;if(this.model instanceof m){H=i}else{H=l}if(G.objectType==="Person"||G.objectType==="pno:Person"){return H.assigneeFieldConfig}else{return H.attachmentFieldConfig}},validateDroppedObject:function(I){var G;var H=this._getFieldConfigForValidatingDrop(I);G=c.validateDroppedObject(I,H);if(G){y.displayError(G)}return G},_getIdForDroppedItem:function(G){var H=G.objectId;if(!this.model.isRDFTask()&&G.objectType==="pno:Person"){H=b.splitUri(G.objectId)[1]}return H}});t.implement(r);return t});define("DS/CollaborativeTasks/Models/RouteTaskModel",["DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonUI/UIHelper","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(f,c,b,e){var d=function(g){var h=f.getWidgetConstant.apply(this,arguments);h===g&&(h=e.get(g));return h};var a=c.extend({_uwaClassName:"RouteTaskModel",dataForRendering:function(){var g=this._parent.apply(this,arguments);if(this.isComplete()){g.date=g.routeTaskActualFinishDate}else{g.date=g.routeTaskDueDate}return g},isAssignedToUserGroup:function(){var g=this.get("assignees");return g&&g.length&&(g[0].get("type")==="Group"||g[0].get("type")==="Group Proxy")},get:function(g){if(g==="canEdit"&&this.isAssignedToUserGroup()){return false}return this._parent.apply(this,arguments)},subscriptionsEnabled:function(){return false},isRouteTask:function(){return true},canAssignToSelf:function(){var g=!this.isComplete()&&(this.isAssignedToUserGroup()||this.get("canEdit"));return g&&!this.isAssignedToCurrentUser()},_validateApprovalComments:function(h,j,g){if(g.currentState!==g.newState&&h.hasOwnProperty("routeTaskAction")){var i=h.routeTaskApprovalComments&&h.routeTaskApprovalComments.trim();if(g.enforceAssigneeApprovalComments&&!i){j.fields.push("routeTaskApprovalComments")}}},_validateApprovalAction:function(h,i,g){if(g.currentState!==g.newState&&h.hasOwnProperty("routeTaskApprovalAction")){if(h.routeTaskAction==="Approve"&&h.routeTaskApprovalAction==="None"){i.fields.push("routeTaskApprovalAction")}}},_validateEnforceOwnerReviewComments:function(h,i,g){if(g.needsReview==="Yes"&&g.enforceOwnerReviewComments&&h.hasOwnProperty("routeTaskReviewerComments")){if(g.newState==="Complete"&&!h.routeTaskReviewerComments.trim()){i.fields.push("routeTaskReviewerComments")}}},validate:function(i){var h=this._parent.apply(this,arguments)||{fields:[]};var g=this._getValidationOptions(i);this._validateApprovalComments(i,h,g);this._validateApprovalAction(i,h,g);this._validateEnforceOwnerReviewComments(i,h,g);return h.fields.length?h:undefined},assignToSelf:function(){var g=this;this.addAssigneesByName([window.enoviaServer.user]);if(this.isAssignedToUserGroup()){this.removeObject("assignees",this.get("assignees")[0])}this.save(null,{patch:true,onComplete:function(){g.dispatchEvent("onChange:"+g.ASSIGNEESATTR);var h=d("emxCollaborativeTasks.Label.SuccessfullyAssignedToSelf");b.displaySuccess(h);g.dispatchEvent("onModifyAccessChanged")},onFailure:function(){var h=d("emxCollaborativeTasks.Error.FailAssignToSelf");b.displayError(h)}})}});return a});define("DS/CollaborativeTasks/Collections/TasksCollection",["UWA/Core","UWA/Class/Promise","DS/Foundation2/FoundationV2Data","DS/Foundation2/Collections/FoundationBaseCollection","DS/Foundation/CsvParser","DS/Foundation/WidgetUwaUtils","DS/CollaborativeTasks/Models/TaskModel","DS/CollaborativeTasks/Models/RouteTaskModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Collections/TasksSplitCollection"],function(d,A,m,t,F,b,C,J,w,x,i){"use strict";var H=function(){return m.getWidgetConstant.apply(this,arguments)};var E="dueDateCategory";var e="taskRequirement";var a="state";var G="stateForDisplay";var c="routeTaskAction";var n="routeTaskApprovalAction";var D="routeTaskValidStates";var g="actualValue";var s="displayValue";var k=function(K){return(K&&K.actualValue)||K};var v=function(L){var K=C;if(L==="Inbox Task"){K=J}return K};var z=t.extend({_uwaClassName:"TasksCollection",model:C,_prepareModel:function(K){this.model=v(K.type);return this._parent.apply(this,arguments)},setAttrToSplitBy:function(M,N){if(N&&this._attrToSplitBy!==M){var K=Object.prototype.hasOwnProperty;for(var L in this._TasksByAttr){if(K.call(this._TasksByAttr,L)){this._cleanupSubCollectionForAttr(L)}}}this._attrToSplitBy=M},addNewTask:function p(){var M=this.add.apply(this,arguments);if(window.widget){var K=x.getScopeId();var L=x.getScopeType();if(K&&!x.isScopeRDF()){var O=this.projectTypes().split(",");var N=O.indexOf(L)===-1?"scopes":"DPMProject";if(K!=="tempfix"){M.addObjects([K],N)}}}return M},setup:function r(O,M){var L=Array.prototype.slice.call(arguments,0);if(window.widget){var N=b.getContext().split(".");if(N&&N.length){this.collabSpace=N[N.length-1]}}this._TasksByAttr={};this._attrToSplitBy="state";this.extid="allTasks";var K=d.clone(M,false);K.serviceName="/resources/v1/modeler/tasks";K.initialLoadOptions="$include=none&$fields=none,title,modifyAccess,deleteAccess,state,dueDate&$definition=true&$terse=true";K.completeOptions="$terse=true";L[1]=K;this._translate=M.translate;this.addEvent("onSync",this._onSync);this._parent.apply(this,L)},setSearch:function(K){this._search=K;this._cleanupSubCollections();this.dispatchEvent("onChange:search")},resetSearch:function(){delete this._search;this._cleanupSubCollections();this.dispatchEvent("onChange:search")},getSearch:function(){return(this._search)},dataForRendering:function y(){return{collabSpace:this.collabSpace}},tasksWithAttrValue:function(O,K){var N=this;var M=K?K:this._attrToSplitBy;var L=k(O);return this.filter(function(T){var R=k(T.get("state"));var Q=k(T.get(M));var S=k(T.get("title")||T.get("text"));var P=N._search?w.match(N._search,S):true;return(M==="dueDateCategory"&&R==="Complete")?false:(Q===L&&P)})},tasksWithAttrValueCollection:function f(R,M){if(typeof R==="undefined"){return undefined}var P=M?M:this._attrToSplitBy;var O=k(R);var L=this._TasksByAttr[P];if(!L||!L[O]){var Q=this.tasksWithAttrValue(R,P);var K={filterAttr:P,valueForFiltering:R,parentCollection:this};var N=new z.TasksSplitCollection(Q,K);N.extid="tasks-"+P+"-"+O;if(!L){this._TasksByAttr[P]=L={}}L[O]=N}return L[O]},_getDefRange:function B(Q){var N=m.getAllFields(this.data());var R=N[Q];var P=[];if(R&&R.range){var M=R.range.item;var O=M.length;for(var L=0;L<O;L++){var K=M[L];P.push({actualValue:K.value,displayValue:(this._translate)?H("emxCollaborativeTasks.Label."+K.display.replace(/ /g,"")):K.display})}}return P},allTaskRequirements:function(){if(!this._allTaskRequirements){var K=this.data();if(K&&K.definitions){this._allTaskRequirements=this._getDefRange(e)}}return this._allTaskRequirements},allStates:function l(){if(!this._allStates){var M=this.data();if(M&&M.definitions){this._allStates=this._getDefRange(a);var N=this._allStates.length;for(var K=0;K<N;K++){var L=this._allStates[K];m.setWidgetConstant(L.actualValue,L.displayValue)}}}return this._allStates},allDueDates:function h(){if(!this._allDueDates){var K=this.data();if(K&&K.definitions){this._allDueDates=this._getDefRange(E)}}return this._allDueDates},allRouteTaskApprovalActions:function o(K){if(!this._allRouteTaskApprovalActions){this._allRouteTaskApprovalActions=this._getTranslatedAttributeValues(n,K)}return this._allRouteTaskApprovalActions},allRouteTaskActions:function I(K){if(!this._allRouteTaskActions){this._allRouteTaskActions=this._getTranslatedAttributeValues(c,K)}return this._allRouteTaskActions},allRouteTaskStates:function u(K){if(!this._allRouteTaskStates){this._allRouteTaskStates=this._getTranslatedAttributeValues(D,K)}return this._allRouteTaskStates},allRouteTaskNoReviewStates:function j(K){if(!this._allRouteTaskNoReviewStates){this._allRouteTaskNoReviewStates=this._getTranslatedAttributeValues(D,K);if(this._allRouteTaskNoReviewStates){this._allRouteTaskNoReviewStates.splice(1,1)}}return this._allRouteTaskNoReviewStates},_getTranslatedAttributeValues:function(M){var O;var N=this.data();if(N&&N.definitions){O=this._getDefRange(M);var P=O.length;for(var K=0;K<P;K++){var L=O[K];m.setWidgetConstant(L.actualValue,L.displayValue)}}return(O)},allStatesForDisplay:function(){if(!this._allStatesForDisplay){var M=this.data();if(M&&M.definitions){this._allStatesForDisplay=this._getDefRange(G);var N=this._allStatesForDisplay.length;for(var K=0;K<N;K++){var L=this._allStatesForDisplay[K];m.setWidgetConstant(L.actualValue,L.displayValue)}}}return this._allStatesForDisplay},allValues:function(){switch(this._attrToSplitBy){case E:return this.allDueDates();case a:return this.allStates();case G:return this.allStatesForDisplay();default:return[]}},getSearchTypes:function(M,K){var L=this._getDefRange(M);var N;if(L&&L.length){N=L[0][K]}return N},scopesTypesForSearch:function(){return this.getSearchTypes("scopes.scopesTypesForSearch",g)},scopesTypes:function(){return this.getSearchTypes("scopes.scopesTypesForSearch",s)},deliverablesTypesForSearch:function(){return this.getSearchTypes("deliverables.deliverablesTypesForSearch",g)},deliverablesTypes:function(){return this.getSearchTypes("deliverables.deliverablesTypesForSearch",s)},projectTypesForSearch:function(){return this.getSearchTypes("projectTypesForSearch",g)},projectTypes:function(){return this.getSearchTypes("projectTypesForSearch",s)},importTasksFromCSV:function q(L,M){var O=5;var P=F.parse(L);var ag,S={},af=P.length,W=[],ae=[],R=0,V="";function Y(aj,ak,ai,am){var al=new A(function(aq,ap){var ao={};ao.onComplete=function(){ak.forEach(function(ar){ar._onCompleteRequest()});aq(ak)};ao.onFailure=function an(){ak.forEach(function(ar){ar._onCompleteRequest()});ap(new Error("timeout for: "+am))};aj.save(null,ao)});return al}var N;var Q;var ac;var K;if(af){N=P[0];Q=N.length;for(ac=0;ac<Q;ac++){K=N[ac].toLowerCase().trim();if(K.match(/^(name|estimated duration|estimated finish date|type|description|assignee)$/)){W.push({index:ac,value:K.trim()})}}}var ab=this.allStates()[R];var aa=W.length;var Z=[];for(var ad=1;ad<af;ad++){N=P[ad];S={};S.state=ab;var U=[];for(ac=0;ac<aa;ac++){K=N[W[ac].index].trim();var ah=W[ac].value;switch(ah){case"name":S.title=K;break;case"estimated duration":S.estimatedDuration={actualValue:parseFloat(K),displayValue:K};break;case"estimated finish date":S.dueDate={actualValue:new Date(K).getTime(),displayValue:K};break;case"description":S.description={actualValue:K,displayValue:K};break;case"type":S.type=K.toLowerCase();break;case"assignee":U=K.split(";");break;default:}}if(S.type==="task"&&(!isNaN(S.estimatedDuration.actualValue))&&(!isNaN(S.dueDate.actualValue))){ag=this.addNewTask(S);if(U&&U.length){ag.addAssigneesByName(U)}ae.push(ag);ag._onRequest();this.updateModelInFoundation("create",ag,null);V+=", "+S.title}if(ae.length&&ae.length%O===0){Z.push(Y(ag,ae,M,V));ae=[];V=""}}if(ae.length){Z.push(Y(ag,ae,M,V))}A.all(Z).then(function T(){M.onComplete()},function X(){M.onFailure()})},_cleanupSubCollections:function(){var K=Object.prototype.hasOwnProperty;for(var L in this._TasksByAttr){if(K.call(this._TasksByAttr,L)){this._cleanupSubCollectionForAttr(L)}}},_cleanupSubCollectionForAttr:function(M){var L=Object.prototype.hasOwnProperty;var O=this._TasksByAttr[M];for(var N in O){if(L.call(O,N)){var K=O[N];K.stopListening();delete O[N]}}},_onSync:function(L,Q,M){var P=this;if(L===P){var O;var K;var N;if(M&&M.server){O=P._getDefRange(E);K=P._getDefRange(a);N=P._getDefRange(G)}if(!d.equals(K,this._allStates)){this._allStates=false;this._cleanupSubCollectionForAttr(a);this.dispatchEvent("onChange:allStates",[this,this.allStates(true)])}if(!d.equals(O,this._allDueDates)){this._allDueDates=false;this._cleanupSubCollectionForAttr(E);this.dispatchEvent("onChange:allDueDates",[this,this.allDueDates(true)])}if(!d.equals(N,this._allStatesForDisplay)){this._allStatesForDisplay=false;this._cleanupSubCollectionForAttr(G);this.dispatchEvent("onChange:allStatesForDisplay",[this,this.allStatesForDisplay(true)])}}},sync:function(K,P,V){var M=V||{};var Q=this;var S=Q._getStorage();if(K==="read"&&Q.isServerFetch(P,M)&&M.partialRefresh){var U={data:[]};var O=this.data();if(O&&O.data){var T=O.data;T.forEach(function(X){var W={id:X.id,cestamp:X.cestamp};if(X.serviceId){W.serviceId=X.serviceId}U.data.push(W)});var L="refreshWidget="+JSON.stringify(U);return m.loadServiceData(this._partialRefreshServiceName,function(Y){var ac=Q.data();m.copyDefinition(ac,Y);m.__updateCsrf(ac,Y);var ab;if(Y&&Y.success&&Y.data){var aa=Y.data;var ad=aa.length;for(var W=0;W<ad;W++){var X=aa[W];switch(X.updateAction.toUpperCase()){case"DELETE":Q.remove(X.tempId);m.unloadObjects(Q.data(),[X.tempId]);break;case"MODIFY":var ag=X;var ae=m.__getSourceObjectFromServerObject(ac,ag);m.__synchronizeSourceObjectFromServerObject(ac,ag,ae,true,true);break;case"CREATE":ag=X;delete ag.updateAction;var af=v(X.type);var Z=new af(ag);m.__addOrConnectObjectToStructure(ac,undefined,undefined,ag,undefined,Z);Q.add(Z);break;default:}}if(S){m.saveCachedData(S,Q._serviceName,ac)}if(d.is(M.onComplete,"function")){ab=M.onComplete(Y,M)}}else{if(d.is(M.onFailure,"function")){ab=M.onFailure(Y,M)}}return ab},true,L,"application/x-www-form-urlencoded; charset=utf-8")}}else{if(P instanceof C){var N=P;var R=N.toJSON({onlyUpdated:true});if(!R.subscribed&&N.subscriptionsEnabled()){N.set("sendEmail","sendEmail")}}}return this._parent.apply(this,arguments)},fetch:function(L){var O,M,N=this;var K=d.clone(L||{},false);if(x.isScopeRDF()||K.forceRDF){if(!this.data()){K.url="/resources/v1/modeler/tasks/00000000000000000000000000000000"}else{if(this.lastReadFrom==="local"){this.lastReadFrom="server";this.dispatchEvent("onChange:lastReadFrom",[this,this.lastReadFrom,L])}this.clearData();this.reset(undefined,K);this.getTNProxy().setSubjectsTags({},"foundation2");return{cancel:function(){}}}}if(K.partialRefresh){if(K.parse===undefined){K.parse=true}O=K.onComplete;K.onComplete=function(P){if(O){O(N,P,K)}return N.dispatchEvent("onSync",[N,P,K])};M=K.onFailure;K.onFailure=function(P){if(M){M(N,P,K)}N.dispatchEvent("onError",[N,P,K])};return N.sync("read",N,K)}else{return this._parent(K)}},fetchTaskById:function(L,K){this.fetch(d.extend({server:true,url:"/resources/v1/modeler/tasks",method:"POST",data:"$ids="+L,contentType:"application/x-www-form-urlencoded"},K))}});z.optimized=true;z.TasksSplitCollection=i.extend({model:C});return z});define("DS/CollaborativeTasks/Views/RouteTaskDetailsPanelConfig",["DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonUI/Models/DropValidator"],function(g,c,f,b,d){var e=function(){return g.getWidgetConstant.apply(this,arguments)};var a={};a.config=function(q){var m=e("emxCollaborativeTasks.GroupLabel.More");var k=e("emxComponents.Routes.ShowCommentsForTaskApproval").toLowerCase().trim()!=="false";var t=e("emxComponents.Routes.EnforceAssigneeApprovalComments").toLowerCase().trim()!=="false";var p=q&&q.get("routeTaskAction")!=="Comment";var r=q&&q.get("routeTaskSetDueDate")!=="No";var s=q&&q.get("routeTaskDelegationAllowed")!=="FALSE";var u=q&&q.get("needsReview")!=="No";var l=[{name:"title",type:"text",numberOfEditableLines:4,maxLength:128},{name:"route",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:true,label:e("emxCollaborativeTasks.Label.Route"),type:"object",linkCallback:function(v){var i=g.calculateFinalUrl("/emxLogin.jsp?appName=ENOBUPS_AP&physicalId="+v);window.open(i,"routeWindow");return(true)}},{name:"scopes",attributeToDisplay:"name",imageAttribute:"image",label:e("emxCollaborativeTasks.Label.Content"),type:"object",customView:f,linkCallback:b.launchProperties,getDropDownMenuItems:b.getDropDownMenuItems,allowFileManagement:true},{readWrite:"true",name:"state",label:e("emxCollaborativeTasks.Label.TaskStatus"),type:"select"},{readWrite:"true",name:"routeTaskDueDate",label:e("emxCollaborativeTasks.Label.TaskDueDate"),type:"date"},{readWrite:"true",name:"assignees",attributeToDisplay:"name",imageAttribute:"image",label:e("emxCollaborativeTasks.Label.TaskAssignedTo"),searchTitle:e("emxCollaborativeTasks.Label.assigneeSearchTitle"),typeAheadCallback:c.PersonModel.typeAheadCallback,singleObjectOnly:true,type:"person",dropTypes:d.PERSON_DROP_TYPES,searchSourceTypes:{swym:"pno:Person"},searchSource:["swym"]},{name:"routeTaskAction",label:e("emxCollaborativeTasks.Label.TaskExpectedAction"),type:"select"},{name:"routeTaskInstructions",label:e("emxCollaborativeTasks.Label.TaskInstructions"),type:"textarea",numberOfDisplayLines:3},{readWrite:"true",required:true,name:"routeTaskApprovalAction",label:e("emxCollaborativeTasks.Label.Decision"),type:"select"},{readWrite:"true",required:t,name:"routeTaskApprovalComments",label:e("emxCollaborativeTasks.Label.Comments"),type:"textarea",numberOfDisplayLines:3,numberOfEditableLines:6},{name:"needsReview",label:e("emxCollaborativeTasks.Label.TaskNeedsReview"),type:"checkbox"},{name:"project",label:e("emxCollaborativeTasks.Label.CollaborativeSpace"),type:"text"},{name:"originatorInfo",attributeToDisplay:"name",imageAttribute:"image",label:e("emxCollaborativeTasks.Label.TaskOriginator"),type:"person",searchSource:["swym"],group:m},{name:"ownerInfo",attributeToDisplay:"name",imageAttribute:"image",label:e("emxCollaborativeTasks.Label.TaskOwner"),type:"person",searchSource:["swym"],group:m},{name:"originated",label:e("emxCollaborativeTasks.Label.TaskCreated"),type:"date",group:m},{name:"modified",label:e("emxCollaborativeTasks.Label.TaskModified"),type:"date",group:m}];if(u){l.splice(11,0,{readWrite:"true",name:"routeTaskReviewerComments",label:e("emxCollaborativeTasks.Label.TaskReviewerComments"),type:"textarea",numberOfDisplayLines:3,numberOfEditableLines:6})}if(!k){l.splice(9,1)}if(!p){l.splice(8,1)}var h=q.get("originatorInfo")[0];var n=h&&h.get("name",{noMapping:true});var j=q.get("state");for(var o=0;o<l.length;o++){if((l[o].name==="assignees"&&!s)||(l[o].name==="routeTaskDueDate"&&!r)||(l[o].name==="routeTaskReviewerComments"&&(enoviaServer.user!==n||j!=="Review"))){delete l[o].readWrite}}return(l)};return a});define("DS/CollaborativeTasks/Views/ColumnView",["UWA/Core","UWA/Event","UWA/Class/View","DS/UIKIT/Scroller","DS/Handlebars/Handlebars","DS/E6WCommonUI/Views/FoundationBaseView","DS/CollaborativeTasks/Collections/TasksCollection","DS/CollaborativeTasks/Views/CardView","DS/UIKIT/Tooltip","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/SmartSchedulerUtils","text!DS/CollaborativeTasks/assets/templates/column.html.handlebars","DS/Foundation2/FoundationV2Data","DS/E6WCommonUI/Views/E6WHandlebarsHelpers"],function(c,u,p,r,d,i,e,l,q,o,k,t,n,f){var h=function(){return n.getWidgetConstant.apply(this,arguments)};var s=d.compile(t);var m=i.extend({_uwaClassName:"ColumnView",tagName:"div",className:"column ds-dialog",name:"CollaborativeTasks.ColumnView",id:function(){return this.collection.extid},resizeBuffer:function(){var w=this._childrenViews.length;if(w<m.nbCardsBuffer&&w<this.collection.size()){var y=this.collection.size();if(this._firstChild+m.nbCardsBuffer>y){var v=(m.nbCardsBuffer-w);this.resetChildViews(Math.max(this._firstChild-v,0),true,true);this._addChildrenToDom(0,this._childrenViews.length-w,true)}else{this.resetChildViews(this._firstChild+this._childrenViews.length,true);this._addChildrenToDom(w,undefined,true)}}else{if(w>m.nbCardsBuffer){for(var x;this._childrenViews.length>m.nbCardsBuffer;){x=this._childrenViews.pop();this._recycleChild(x)}}}this._adjustBufferHeights()},_onScroll:function(v){if(this.collection&&this.container){var z=c.Event.getElement(v);if(z){if(this._childrenViews.length&&(this.collection.length-this._childrenViews.length)>0){if(!m._cardHeight){this._computeCardHeight()}var y=z.scrollTop;var F=Math.floor(y/m._cardHeight);var A=Math.max(F-m.nbCardsTopBuffer,0);A=Math.min(A,this.collection.length-m.nbCardsBuffer);var G=A-this._firstChild;if(G!==0){if(G>0){if(G>=this._childrenViews.length){this.resetChildViews(A);this._addChildrenToDom(0,undefined)}else{for(var B=0;B<G;B++){var w=this._childrenViews.shift();this._recycleChild(w)}this.resetChildViews(A+this._childrenViews.length,true);this._addChildrenToDom(this._childrenViews.length-G,undefined)}}else{if(G<0){G=-G;if(G>=this._childrenViews.length){this.resetChildViews(A);this._addChildrenToDom(0,undefined)}else{var E=this._childrenViews.length-m.nbCardsBuffer+G;for(var D=0;D<E;D++){var C=this._childrenViews.pop();this._recycleChild(C)}var x=this._childrenViews.length;this.resetChildViews(A,true,true);this._addChildrenToDom(0,this._childrenViews.length-x)}}}this._adjustBufferHeights()}}}}},_createTaskView:function(v){var w=new l({model:v,parentView:this});this.listenTo(w,{onTaskCardClicked:function(){this.dispatchEvent("onTaskCardClicked",arguments)},onDestroy:function(){this.dispatchEvent("onTaskDestroyed",arguments)}});return w},_getRecycledChild:function(v){var w;if(this._recycleBin&&this._recycleBin.length){w=this._recycleBin.pop();w.model=v;w.container.id=w.id();w.listenToModelEvent();delete w._recycled}else{w=this._createTaskView(v)}return w},_recycleChild:function(v){this.dispatchEvent("onTaskDestroyed",arguments);v._recycled=true;v.container.remove();v.container.empty(true);this._recycleBin.push(v)},resetChildViews:function a(L,v,B){var A=L||0;var C=this;if(!this._childrenViews){this._childrenViews=[]}var z=!v?0:this._childrenViews.length;this._firstChild=A-(B?0:z);var y=C.collection.length;A=Math.max(0,A);var D=A+(m.nbCardsBuffer-z);D=Math.min(y,D);var G={};var H;if(!v){var K=[];var J={};for(H=A;H<D;H++){J[C.collection.at(H).cid]=true}this._childrenViews.forEach(function(M){var N=M.model;if(!J[N.cid]){C._recycleChild(M)}else{K.push(M);G[N.cid]=M}});this._childrenViews=K}if(B){for(var F=D-1;F>=A;F--){var w=C.collection.at(F);if(G[w.cid]){continue}var I=C._getRecycledChild(w);C._childrenViews.unshift(I)}}else{for(H=A;H<D;H++){var x=C.collection.at(H);if(G[x.cid]){continue}var E=C._getRecycledChild(x);C.addChildView(E)}}},tasksChanged:function g(){this.resetChildViews();this.render()},_onAdd:function b(z,C,y){var v=y.at;v=typeof v!=="undefined"?v:this._childrenViews.length-1;var A=this._getRecycledChild(z);if(A){this._childrenViews.splice(v,0,A);var w=this.getElement(m.CssSelectorMarkingInsertionPoint);A.render();if(v===0){A.container.inject(w,"after")}else{A.container.inject(this.getElement(m.CssSelectorMarkingBottomInsertionPoint),"before")}}m.lastCardAdded=A;if(this._childrenViews.length>m.nbCardsBuffer){var B;if(v!==0){B=this._childrenViews.shift()}else{B=this._childrenViews.pop()}this._recycleChild(B)}if(z.id){m.pushToComplete(A);this.scheduleComplete()}this._adjustBufferHeights();var x=this.getElement(m.TitleObjectCountId);x.setText(m.TitleObjectCountString.replace("%COUNT%",this.collection.length))},_onRemove:function j(w){var x=this;this._childrenViews=this._childrenViews.filter(function(A){if(A.model===w){x._recycleChild(A);return false}return true});var y=this._childrenViews.length;var z=this.collection.length;if(this._firstChild+m.nbCardsBuffer>z&&m.nbCardsBuffer<z){this.resetChildViews(this._firstChild-1,true,true);this._addChildrenToDom(0,this._childrenViews.length-y,true)}else{this.resetChildViews(this._firstChild+this._childrenViews.length,true);this._addChildrenToDom(y,undefined,true)}this._adjustBufferHeights();var v=this.getElement(m.TitleObjectCountId);v.setText(z?m.TitleObjectCountString.replace("%COUNT%",z):"")},setup:function(v){this._parent.apply(this,arguments);this._firstChild=0;this._scrolling=0;this.resetChildViews();this.listenTo(this.collection,"onReset",this.tasksChanged);this.listenTo(this.collection,"onAdd",this._onAdd);this.listenTo(this.collection,"onRemove",this._onRemove);this.listenTo(this.collection,"onValidationFailure",function(x,w){var z;for(var y=0;y<w.fields.length;y++){if(w.fields[y]==="needsReview"){z=h("emxCollaborativeTasks.Error.needsReview")}else{if(w.fields[y]==="routeTaskApprovalComments"){z=h("emxCollaborativeTasks.Error.needsApprovalComments")}else{if(w.fields[y]==="routeTaskApprovalAction"){z=h("emxCollaborativeTasks.Error.needsApprovalAction")}else{if(w.fields[y]==="routeTaskReviewerComments"){z=h("emxCollaborativeTasks.Error.needsReviewerComments")}}}}}o.displayError(z)});this._recycleBin=[];this.$dsTaskManagement=v.$dsTaskManagement;return v},destroy:function(){clearTimeout(this.completeTimeout);delete this.completeTimeout;this.container.remove();if(this._scroller){this._scroller.destroy()}var w=this._recycleBin.length;for(var x=0;x<w;x++){var v=this._recycleBin[x];v.destroy()}delete this._recycleBin;this._parent();this.$dsTaskManagement=null;this.container=null;delete this._BottomPlaceholder;delete this._TopPlaceholder;this._taskFilterTooltip&&this._taskFilterTooltip.destroy();delete this._taskFilterTooltip},template:function(){var x=f.i18n;f.i18n=h;var w=this.collection.dataForRendering();var z=w.filteredByValue&&w.filteredByValue.actualValue;var y=widget.getValue(k.COMPLETED_TASK_PREF_NAME);if(y!=="all"&&(z==="Done"||z==="Complete")){w.completedTaskFilterOn=true}var v=s(w);f.i18n=x;return v},_handleDrop:function(z){var y,A;y=this;var v=y.getElement(".drop-target-marker");v.addClassName("dropping");A=z._parentView;if((typeof A!=="undefined"||typeof y!=="undefined")&&(y!==A)){var x=z.model;var C=y.collection._valueForFiltering;C=C.displayValue?C.displayValue:C;var B=y.collection.getSaveAttributes(x.dateHelper);setTimeout(function(){v.removeClassName("dropping")},500);var w=y.collection._filterAttr;x.save(B,{patch:true,onComplete:function(){var D=h("emxCollaborativeTasks.Label.SuccessfullyChangedAttribute");D=D.replace("%ATTRIBUTE_NAME%",h("emxCollaborativeTasks.Command.View."+w));D=D.replace("%ATTRIBUTE_VALUE%",C);o.displaySuccess(D)},onFailure:function(G,E,D){var F=h("emxCollaborativeTasks.Error.FailedToChangeAttribute");F=F.replace("%ATTRIBUTE_NAME%",h("emxCollaborativeTasks.Command.View."+w));F=F.replace("%ATTRIBUTE_VALUE%",C);if(D&&D.response&&D.response.statusCode===400&&D.response.error){F+="<br>"+h(D.response.error)}o.displayError(F)}})}},_addChildrenToDom:function(G,H,F){var v=G||0;var B=(H?H+G:this._childrenViews.length);var z=document.createDocumentFragment();var A=[];for(var w=v;w<B;w++){var D=this._childrenViews[w];D.container.inject(z);A.push(D)}var x=this;var E=function(){var L=A.length;var K;K=false;for(var J=0;J<L;J++){var I=A[J];if(!I._recycled&&I.model&&I.container){I.render();if(!I.model.completed){K=true;m.pushToComplete(I)}}}if(m.toComplete&&m.toComplete.length&&K){if(F){x.complete()}else{x.scheduleComplete()}}};if(A.length){if(!F){setTimeout(E,21)}else{E()}var y;var C;if(H&&G+H<this._childrenViews.length){y=this._childrenViews[G+H].container;C=y.parentElement}if(!y||y._recycled){y=this._BottomPlaceholder;C=y.parentElement}C.insertBefore(z,y)}},scheduleComplete:function(){if(!this.completeTimeout){this.completeTimeout=setTimeout(this.complete.bind(this),200)}},complete:function(){if(this.collection&&m.toComplete){var y=[];for(var x=0,v=m.toComplete.length;x<v;x++){var w=m.toComplete[x];if(!w._recycled&&w.model&&w.container){y.push(w.model)}}this.collection.complete(y,{onlyIfNeeded:true});delete m.toComplete}delete this.completeTimeout},_computeCardHeight:function(){var w=this._childrenViews[0];if(w){var v=w.container.getDimensions();if(v.height>0){m._cardHeight=v.outerHeight}}},_adjustBufferHeights:function(){if(this.collection){var x=Math.max(this.collection.length-this._childrenViews.length-this._firstChild,0);var w=this._childrenViews[0];if(w){if(!m._cardHeight){this._computeCardHeight()}if(!m._cardHeight){setTimeout(this._adjustBufferHeights.bind(this),0)}var v=m._cardHeight||80;if(this._BottomPlaceholder){this._BottomPlaceholder.setStyle("height",x*v)}if(this._TopPlaceholder){this._TopPlaceholder.setStyle("height",this._firstChild*v)}}}},render:function(){var A=this;var C=this._childrenViews.length;for(var y=0;y<C;y++){var v=A._childrenViews[y];v.container.remove()}A.container.empty(true);delete this._BottomPlaceholder;delete this._TopPlaceholder;A.container.setHTML(this.template());var B=this.container.getElement(".fonticon-filter");if(B){this.setCompletedTaskFilterToolTip(B)}this._BottomPlaceholder=this.getElement(".bottom-buffer");this._TopPlaceholder=this.getElement(".top-buffer");var w=A.getElement(m.CssSelectorMarkingInsertionPoint);w.getParent().setSelectable(false);this._columnContent=A.getElement(".body");this._scroller&&this._scroller.destroy();var z=function(E){if(A._scrolling===0){A._scrolling++;var D=c.clone(E,false);window.requestAnimationFrame(function(){A._onScroll(D);A._scrolling--})}};this._scroller=new r({element:w.parentElement}).inject(this._columnContent);var x=this.getElement(".scroller-content");x.addEventListener("scroll",z);this._addChildrenToDom(0,undefined,true);this._adjustBufferHeights();return this},setCompletedTaskFilterToolTip:function(x){var w=widget.getValue("completedTasksDisplayPref");var v=h("emxCollaborativeTasks.Label.CompletedTaskTopCountFilterToolTip");v=v.replace("%DAY_COUNT%",w);this._taskFilterTooltip=new q({target:x,body:v+"<br><br>"+h("emxCollaborativeTasks.Label.ChangeCompletedTaskFiltering")})},getVisibleModels:function(){var w=[];if(!m._cardHeight){this._computeCardHeight()}var A=this._scroller.getInnerElement();var z=A.scrollTop;var B=Math.floor(z/m._cardHeight);var v=A.getSize().height;var y=Math.ceil(v/m._cardHeight);y=Math.min(y,this.collection.length);for(var x=0;x<y;x++){w.push(this.collection.at(x+B))}return w}});m.nbCardsBuffer=20;m.nbCardsTopBuffer=5;m.CssSelectorMarkingInsertionPoint=".top-buffer";m.CssSelectorMarkingBottomInsertionPoint=".bottom-buffer";m.TitleObjectCountId=".object-count";m.TitleObjectCountString="(%COUNT%)";m.pushToComplete=function(){if(!m.toComplete){m.toComplete=[]}m.toComplete.push.apply(m.toComplete,arguments)};return m});define("DS/CollaborativeTasks/Views/DetailsPanel",["UWA/Core","UWA/Class/Events","DS/Foundation2/FoundationV2Data","DS/E6WCommonApps/Views/PropertyPanel","DS/DocumentManagement/DocumentManagement","DS/UIKIT/Input/Button","DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig","DS/CollaborativeTasks/Models/TskCloneModel","DS/CollaborativeTasks/Views/TaskMenuMixin","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/RDFTaskCloneModel","DS/CollaborativeTasks/Views/RouteTaskDetailsPanelConfig","DS/E6WCommonApps/Models/AssigneeTypeAhead","DS/E6WCommonApps/Views/RDFTaskDetailsPanelConfig","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,j,p,a,r,i,t,d,m,q,o,u,b,g,c,k,n){var h=function(w){var v=p.getWidgetConstant.apply(this,arguments);if(v===w||v===null||v===undefined){var x=k.get(w);x===w&&(x=n.get(w));return x}return v};var s="DPMProject";var f=a.extend({_uwaClassName:"DetailsPanel",_durationOfDetailOpening:500,tagName:"div",className:"column ds-dialog property-panel off",name:"CollaborativeTasks.DetailsPanel",domEvents:{"click #assignToSelfItem":"assignToSelf","click #completeItem":"toggleStateIntoOrOutOfDone","click #deleteItem":"deleteItemCallback","click #openProjectItem":function(){this.openProjectItemCallback()},"click #subscribeToItem":"toggleSubscription",resize:"_adjustHeader"},treatCustomFields:function(D,A){var w=Object.keys(A);var E=w.length;for(var y=0;y<E;y++){var v=A[w[y]];var z={};z.name=v.name;z.label=v.label;var B=this.model.get(v.name);if(B===undefined){continue}var x=v.viewConfig;try{if(z.name&&z.label&&x){e.extend(z,x);var F=z.insertIndex||0;if(typeof z.insertIndex!=="undefined"){D.splice(F,0,z)}else{D.push(z)}}}catch(C){console.log(C)}}},close:function(){this.container.toggleClassName("off",true);if(this._isOpen){this._isOpen=false;this._lockWidths();this.dispatchEvent("onClose")}},open:function(v){var w=this;this.container.toggleClassName("off",false);this._width=v;if(!this._isOpen){this._isOpen=true;this._unlockWidths();this.dispatchEvent("onOpen")}if(this._detailsView){this._detailsView.container.style.width=v+"px";setTimeout(function(){if(w._detailsView){w._detailsView.container.style.width=""}},this._durationOfDetailOpening);this._detailsView._resizeHandler()}},isOpen:function(){return this._isOpen},id:function(){return"DetailsPanelView"},init:function(w){var v=e.clone(w||{},false);v.scopesTypes=w.collection.scopesTypes();v.scopesTypesForSearch=w.collection.scopesTypesForSearch();v.projectTypes=w.collection.projectTypes();v.projectTypesForSearch=w.collection.projectTypesForSearch();v.deliverablesTypes=w.collection.deliverablesTypes();v.deliverablesTypesForSearch=w.collection.deliverablesTypesForSearch();delete v.collection;this._parent(v)},setup:function(y){var x=e.clone(y||{},false);this.config=t.config();this.projectConfig=t.projectConfig();this.config.options=t.options;this.scopesTypes=y&&y.scopesTypes?y.scopesTypes.split(","):[];this.projectTypes=y&&y.projectTypes?y.projectTypes.split(","):[];this._updateConfigValues(y);if(e.Utils.Client.Platform.ios||e.Utils.Client.Platform.android){var z=this.config.length;for(var v=0;v<z;v++){var w=this.config[v];switch(w.type){case"object":case"person":w.appendTo=".collaborative-tasks";break;default:break}}}x.buttons=this._getButtonConfig();x.detailsViewParameters={DocumentManagement:r};this._parent(x);this._detailsView.setConfig(this.getConfig());this._callbackForVisibleTasks=y.callbackForVisibleTasks;return y},_updateConfigValues:function(w){var v=this.config.detect(function(A){return A.name==="state"});v.values=w.stateValues;var y=this.config.detect(function(A){return A.name==="scopes"});y.dropTypes={"3dspace":(w.scopesTypes+","+w.projectTypes).split(",")};y.searchSourceTypes={"3dspace":(w.scopesTypesForSearch+","+w.projectTypesForSearch).split(",")};var x=this.config.detect(function(A){return A.name==="deliverables"});x.dropTypes={"3dspace":w.deliverablesTypes?w.deliverablesTypes.split(","):[]};x.searchSourceTypes={"3dspace":w.deliverablesTypesForSearch?w.deliverablesTypesForSearch.split(","):[]};if(x.searchSource.indexOf("drive")!==-1){x.dropTypes.drive=["DriveFile"];x.searchSourceTypes.drive=["DriveFile"]}var z=this.projectConfig.detect(function(A){return A.name==="taskRequirement"});z.values=w.taskRequirementValues},_emptyMenu:function(){if(this._menu){this._menu.destroy();delete this._menu}},_drawMenu:function(){var v=this.getElement(".panel-overflow");v.empty();if(v){this._menu=new i(this._panelActionsMenu).inject(v);this._menu.elements.container.setStyle("min-width","")}this._adjustHeader()},cloneModelForDetailDisplayView:function(){if(this.model){var v=this.CloneClass;if(this.model instanceof q){v=o}else{if(!v){v=d}}var w=new v(this.model,t.options);w.scopesTypes=this.scopesTypes;w.projectTypes=this.projectTypes;return w}return undefined},render:function(){if(!this.model){return this}this._parent.apply(this,arguments);this._updateActionButtonDisplay();this.toggleLaunchControl();return this},_adjustHeader:function(){var x=this.getContent();var v=this.getElement(".panel-tabs");var w=this.getElement(".panel-actions");if(x&&v&&w){x.removeClassName("overflow");var y=e.is(this._width)?this._width:x.offsetWidth;if(w.offsetWidth>=(y-v.offsetWidth)){x.addClassName("overflow")}else{x.removeClassName("overflow")}}},toggleLaunchControl:function l(){var w=this.getElement("#openProjectItem");if(w){var v=this.model.get(s);if(v&&v.length){w.removeAttribute("disabled")}else{w.setAttribute("disabled",true)}}},getStates:function(){var v=[];v.push({actualValue:c.STATE_OPEN,displayValue:h("emxCollaborativeTasks.Label.ToDo")});v.push({actualValue:c.STATE_IN_PROGRESS,displayValue:h("emxCollaborativeTasks.Label.InProgress")});v.push({actualValue:c.STATE_DONE,displayValue:h("emxCollaborativeTasks.Label.Done")});return(v)},onFieldValueChange:function(){var v=this._scroller&&this._scroller.getInnerElement().scrollTop;var w=this._scroller&&this._scroller.getInnerElement().scrollLeft;this._detailsView.setConfig(this.getConfig());this._renderBodyContent();this._scroller&&this._scroller.scrollTo(w,v)},onStateChange:function(){this.resetModel(this.model||this._detailsView.model,{},true)},resetModel:function(x,w){var y=this;this._parent(x,w);this.listenTo(this.model,"onChange:"+s,function(){y._panelActionsMenu=y.createMenuButtons();y._updateConfigAndRender()});this.listenTo(this.model,"onChange:PALId",this._updateConfigAndRender);this.listenTo(this.model,"onChange:subscribed",this._updateActionButtonDisplay);var v={"onChange:dsxplan:hasAssignee":this._updateActionButtonDisplay,onChange:function(A,z){if(z&&z.relationshipChanged&&z.relationshipChanged==="assignees"){y._updateActionButtonDisplay()}},onDeleteAccessChanged:this._updateStateOfDeleteButton};this.listenTo(this.model,v);this.container.getElement(".panel-actions").empty();this._initButtons(this._getButtonConfig());this._updateActionButtonDisplay();this.listenTo(this.model,"onChange:"+c.STATE_ATTR,this.onStateChange);this.listenTo(this._detailsView.model,"onChange:"+c.STATE_ATTR,this.onFieldValueChange);this.listenTo(this._detailsView.model,"onChange:modificationsPending",this._updateActionButtonDisplay)},_updateConfigAndRender:function(){this._detailsView.setConfig(this.getConfig());this.render()},getConfig:function(){var I=this.config;if(!this.model){return I}if(this.model.isRouteTask()){I=this._getRouteTaskConfig()}else{if(e.is(this.model.isDSLC,"function")&&this.model.isDSLC()){I=this._getRDFTaskConfig(this._detailsView.model&&this._detailsView.model.model===this.model?this._detailsView.model:this.model)}}var E=e.clone(I,true);E.options=I.options;var y=this.model.get(s);var w=y&&y.length;if(w){var x=E.length;var H=3,v=-1;for(var z=0;z<x;z++){if(E[z].name==="scopes"){var C=e.clone(E[z]);delete C.readWrite;C.label=h("emxCollaborativeTasks.Label.Project");E[z]=C;H--}else{if(E[z].name==="dueDate"){v=z;H--}else{if(E[z].name==="estimatedDuration"){if(this.model.get("state")==="Review"){var G=e.clone(E[z]);delete G.readWrite;E[z]=G}H--}}}if(H===0){break}}if(v>-1){E.splice(v,1)}var D=this.projectConfig;if(D&&D.length>0){var B=0,F=D.length;for(;B<F;B++){E.splice(D[B].insertIndex,0,D[B])}}}var A=this.model.getCustomFields();if(A){this.treatCustomFields(E,A)}return E},_updateActionButtonDisplay:function(){var C=this._detailsView&&this._detailsView.model.modificationsPending;delete this._panelActionsMenu;this._panelActionsMenu=this.createMenuButtons({modificationPending:C});var B=this.getElement("#assignToSelfItem");var z=this.getElement("#completeItem");var x=this.getElement("#subscribeToItem");var y=this.getElement("#openProjectItem");if(!B){return}if(!this.assignToSelfItemAccess()||C){B.setAttribute("disabled",true)}else{B.removeAttribute("disabled")}if((!this.completeItemAccess()&&!this.reOpenItemAccess())||C){z.setAttribute("disabled",true)}else{z.removeAttribute("disabled")}this._updateStateOfDeleteButton();if(!this.launchItemAccess()||C){y.setAttribute("disabled",true)}else{y.removeAttribute("disabled")}if(x){x.toggleClassName("active",this.subscribedToItem());var w=this.getElement("#subscribeToItem");if(this.subscribedToItem()){w.set("title",(h("emxCollaborativeTasks.Command.UnsubscribeFromNotifications")))}else{w.set("title",(h("emxCollaborativeTasks.Command.SubscribeToNotifications")))}if(!this.model.subscriptionsEnabled()){x.remove()}}if(this.reOpenItemAccess()){z.setAttribute("title",h("emxCollaborativeTasks.Command.ReOpen"));var v=z.getElement(".fonticon-check");if(v){v.removeClassName("fonticon-check").addClassName("fonticon-reset")}}else{z.setAttribute("title",h("emxCollaborativeTasks.Command.Complete"));var A=z.getElement(".fonticon-reset");if(A){A.removeClassName("fonticon-reset").addClassName("fonticon-check")}}this._emptyMenu();this._drawMenu()},subscribedToItem:function(){var v=this.model.get("subscribed");return(v==="TRUE")},destroy:function(){this._emptyMenu();delete this._panelActionsMenu;delete this.config;delete this.projectConfig;delete this.scopesTypes;delete this.projectTypes;this._unlockTimeout&&clearTimeout(this._unlockTimeout);delete this._unlockTimeout;this._parent.apply(this,arguments)},_lockWidths:function(){var w=this.container.getSize().width;var v=this.container.getElement(".body");if(v){v.setStyle("width",w);this.container.getElement(".footer").setStyle("width",w);this.container.getElement(".header").setStyle("width",w);this._unlockTimeout&&clearTimeout(this._unlockTimeout);this._unlockTimeout=setTimeout(this._unlockWidths.bind(this),this._durationOfDetailOpening)}},_unlockWidths:function(){if(this.container){var v=this.container.getElement(".body");if(v){v.setStyle("width","");this.container.getElement(".footer").setStyle("width","");this.container.getElement(".header").setStyle("width","")}}},_getButtonConfig:function(){return[{id:"openProjectItem",title:h("emxCollaborativeTasks.Command.OpenProjectItem"),fonticon:"logout"},{id:"assignToSelfItem",title:h("emxCollaborativeTasks.Command.AssignToSelf"),fonticon:"user-add"},{id:"subscribeToItem",title:h("emxCollaborativeTasks.Command.SubscribeToNotifications"),fonticon:"rss"},{id:"completeItem",title:h("emxCollaborativeTasks.Command.Complete"),fonticon:"check"},{id:"deleteItem",title:h("emxCollaborativeTasks.Command.Delete"),fonticon:"trash"}]},_getRouteTaskConfig:function(){var A=u.config(this.model);var B=this.model&&this.model.get("needsReview")!=="No";var z=this.options;var C=A.length;for(var y=0;y<C;y++){var x=A[y];if(x.name==="state"){x.values=B?z.routeTaskStateValues:z.routeTaskNoReviewStateValues}else{if(x.name==="routeTaskApprovalAction"){x.values=z.routeTaskApprovalActionValues}else{if(x.name==="routeTaskAction"){x.values=z.routeTaskActionValues}}}}if(e.Utils.Client.Platform.ios||e.Utils.Client.Platform.android){for(var v=0;v<C;v++){var w=A[v];switch(w.type){case"object":case"person":w.appendTo=".collaborative-tasks";break;default:}}}return(A)},_getRDFTaskConfig:function(x){var z=g.config(x||this.model);var y=z.length;for(var w=0;w<y;w++){var v=z[w];if(v.name===c.STATE_ATTR){v.values=this.getStates()}else{if(v.name==="dependencies"){v.getVisibleModels=this._callbackForVisibleTasks}}}return(z)},_updateStateOfDeleteButton:function(){var w=this.getElement("#deleteItem");var v=this._detailsView&&this._detailsView.model.modificationsPending;if((this.model&&this.model.isRouteTask&&this.model.isRouteTask())||!this.deleteItemAccess()||v){w.setAttribute("disabled",true)}else{w.removeAttribute("disabled")}}});f.implement(m);return f});define("DS/CollaborativeTasks/Views/CollaborativeTasksView",["UWA/Core","UWA/Event","UWA/Controls/Drag","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/Handlebars/Handlebars","DS/ENO6WPlugins/jQuery_3.3.1","DS/Foundation/WidgetUwaUtils","DS/E6WCommonUI/Views/FoundationBaseView","DS/E6WCommonUI/Views/DetailsDisplayView","DS/Foundation2/FoundationV2Data","DS/DocumentManagement/DocumentManagement","DS/CollaborativeTasks/Collections/MergingSplitCollection","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/E6WCommonUI/UIHelper","DS/Foundation2/TaggerAggregator","DS/CollaborativeTasks/Views/ColumnView","DS/CollaborativeTasks/Views/CardView","DS/CollaborativeTasks/Views/DetailsPanel","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/RDFTaskModel","DS/XTaskApp/Models/ScopeModelContainer","DS/E6WCommonApps/XTaskScope","DS/RDFFoundation/SecurityContextUtils","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonUI/PlatformManager","text!DS/CollaborativeTasks/assets/templates/main.html.handlebars","css!DS/CollaborativeTasks/CollaborativeTasks"],function(h,P,ab,V,f,S,w,e,k,W,n,U,B,d,J,q,c,X,g,C,j,I,K,D,r,Q,l){"use strict";C.typeDictionary.typeMap=C.typeDictionary.typeMap||{};h.merge(C.typeDictionary,C.typeDictionary,{mapping:[{key:"dsplan:Task",type:j},{key:"dsxplan:Task",type:j}],typeMap:{"dsplan:Task":j,"dsxplan:Task":j}});var o="dueDateCategory";var ac=function(){return n.getWidgetConstant.apply(this,arguments)};function b(ae){var ad=(ae&&ae.length)?n.containsBadChars(ae):false;return ad&&!K.isScopeRDF()}var m=S.compile(l);var z="drag-over";var N="all";var M="owned";var H="assigned";var F=k.extend({_uwaClassName:"CollaborativeTasksView",_minColWidth:256,_maxColWidth:350,_durationOfDetailClosure:300,className:"collaborative-tasks",name:"CollaborativeTasks.CollaborativeTasksView",scopeName:"",domEvents:{"keypress #addExpandedTaskText":"onKeyUpAddTask","click button.scroll-right":"scrollRight","click button.scroll-left":"scrollLeft","click #addTask":"onClickAddTaskButton","click #addAndOpenTask":"onClickAddAndOpenTaskButton","click #cancelCreateTask":"onClickCancelTaskButton","click #closeCreateTask":"onClickCancelTaskButton","click .add-actions .add-button button":"expandTaskInputField","drop #addTaskDropZone #addTaskText, div.toolbar.add-button":"handleDropCSV","dragenter #addTaskDropZone #addTaskText, div.toolbar.add-button":"handleDragEnter","dragover #addTaskDropZone #addTaskText, div.toolbar.add-button":"handleDragOver","dragleave #addTaskDropZone #addTaskText, div.toolbar.add-button":"handleDragLeave","dragend #addTaskDropZone #addTaskText, div.toolbar.add-button":"handleDragEnd",mousedown:"handleMouseDown","input #addExpandedTaskText":"onExpandedTaskTextInput"},disableCreateTask:function(){var af=this.getElement("#addTaskText");var ad=this.getElement("#addTaskButton");var ae=this.getElement(".add-actions .add-button button");af&&af.setAttribute("disabled",true);ae&&ae.setAttribute("disabled",true);ad&&ad.setAttribute("disabled",true)},enableCreateTask:function(){var af=this.getElement("#addTaskText");var ad=this.getElement("#addTaskButton");var ae=this.getElement(".add-actions .add-button button");af&&af.removeAttribute("disabled");ae&&ae.removeAttribute("disabled");ad&&ad.removeAttribute("disabled")},_updateTaskDivDisplayBasedOnTaskName:function(af){var ad=this.getElement("#addExpandedTaskDiv").getElement(".form-group");var ae=b(af);ad.toggleClassName("has-error",ae);this.getElement("#addTask").disabled=ae;this.getElement("#addAndOpenTask").disabled=ae;ad.getElement(".form-control-error-text").setText(ae?ac("emxCollaborativeTasks.Validate.TitleError"):"")},onExpandedTaskTextInput:function(){var ad=this.getElement("#addExpandedTaskText");var ae=ad&&ad.value&&ad.value.trim();this._updateTaskDivDisplayBasedOnTaskName(ae);this.hideOrShowCloseAndCancelButtons(ae)},hideOrShowCloseAndCancelButtons:function(ae){var ad=this.getElement("#addExpandedTaskDiv");ad.toggleClassName("showCancelHideClose",Boolean(ae))},id:function(){var ad="no id found";if(this.collection&&this.collection.extid){ad=this.collection.extid}else{if(this.options&&this.options.rdfCollection&&this.options.rdfCollection.extid){ad=this.options.rdfCollection.extid}}return ad},destroy:function(){this.scopeIdView&&this.scopeIdView.destroy();delete this.scopeIdView;this._parent();this.$dsTaskManagement=null;delete this._columnStyle;delete this._columnsCarrier;this._taskTools&&this._taskTools.destroy();delete this._taskTools;this._overflowMenuDiv&&this._overflowMenuDiv.destroy();delete this._overflowMenuDiv;this.taskToolsButton&&this.taskToolsButton.destroy();delete this.taskToolsButton;this.overflowMenuButton&&this.overflowMenuButton.destroy();delete this.overflowMenuButton;delete this._scopeIdContainer;if(this.scopeIdView){this.stopListening(this.scopeIdView);this.scopeIdView.destroy();delete this.scopeIdView}delete this._scopeListenedTo;this.modal&&this.modal.destroy();delete this.modal;this.scopeIdView&&this.scopeIdView.destroy();delete this.scopeIdView},cleanUpChildren:function(){var ad=this;if(ad._circleContainer){ad._circleContainer.empty(true)}ad._parent();delete this._detailPanel;delete this._selectedView;delete this._selectedChildView},selectById:function(ae){var ah=this;var ai=this.getColumnAndCardIdxFromId(ae);var ad=ai[0];var af=ai[1];if(ad&&af!==-1){if(!c._cardHeight){ad._computeCardHeight()}var ag=c._cardHeight*af;ad._scroller.scrollTo(0,ag);setTimeout(function(){var ak;for(var aj=0;aj<ad._childrenViews.length;aj++){var al=ad._childrenViews[aj];var am=al.model;if(am.id===ae){ak=al;break}}if(ak){ah.select(ad,ak);ah._detailPanel.selectTab(widget.getValue("propertyPanelTab"))}widget.deleteValue("propertyPanelTab")},0)}},getColumnAndCardIdxFromId:function(ah){var aj=-1;var ag;var af=this._childrenViews.length;for(var ae=0;ae<af;ae++){ag=this._childrenViews[ae];var ad=ag.collection;if(ad){var ai=ad.get(ah);if(ai){aj=ad.indexOf(ai);break}}}return[ag,aj]},onTaskCardClicked:function(ae,ad){if(ad===this._selectedView){this.unselect(this._selectedChildView,this._selectedView)}else{this.select(ae,ad)}},select:function(ah,ae){var ag=this;function ad(){ag._selectedView&&ag._selectedView.onUnselect();ae.onSelect();ag._selectedChildView=ah;ag._selectedView=ae;ag.openDetailPanel(ag._childrenViews.indexOf(ah)+1)}if(this._selectedView){var af=!this._selectedChildView||this._selectedChildView===ah;this._detailPanel.cancel({keepPanelOpen:af,onCancel:function(){if(ag._durationOfDetailClosure&&!af){setTimeout(ad,ag._durationOfDetailClosure)}else{ad()}ag.handleTagCollect(ae)}})}else{ad();this.handleTagCollect(ae)}},openDetailPanel:function y(ae){if(!this._detailPanel.isOpen()){h.createElement("li").inject(this._circleContainer)}var ad=ae*10+1;this.onResize();this._detailPanel.container.setAttributes({style:"order:"+ad+"; -webkit-order:"+ad+"; -ms-order:"+ad+";"});this._detailPanel.open(this._selectedChildView.container.clientWidth);this._detailPanel.resetModel(this._selectedView.model,{force:true},this._selectedView);if((ae-this.getLeftColumnIndex())===this._nbColumnsShown){this.scrollRight()}else{this._updateScrollButtonsAndDots()}},unselect:function(ag,ae,ad){var af=this;if(ae===this._selectedView&&ag===this._selectedChildView){this._detailPanel.cancel({onCancel:function(){af.handleTagCollect();ad&&ad.onCancel&&ad.onCancel()}})}},cancelCurrentDetailsPanel:function aa(ad){if(this._selectedView){this.unselect(this._selectedChildView,this._selectedView,ad)}else{ad&&ad.onCancel&&ad.onCancel()}},handleTagCollect:function(ae){var ag=this.collection.getTNProxy();if(ag){if(ae){var ad=ae.model;var af={};af[ad.id]=ad instanceof j?"6WTags":"3DSpace";ag.focusOnSubjects([ad.getTagPrefix()+ad.id],true,af)}else{ag.unfocus()}}},resetChildViews:function(){var ak=this;this.cleanUpChildren();var al=this.collection.allValues();if(!this._circleContainer){this._circleContainer=h.createElement("ul")}function ae(ap){if(ak._selectedView===ap){ak.unselect(this._selectedChildView,this._selectedView)}}if(al){var ad=al.length;for(var af=0;af<ad;af++){var am=al[af];var aj=this.collection.tasksWithAttrValueCollection(am);if(this._rdfCollection){var an=this._rdfCollection.tasksWithAttrValueCollection(am);var ag=new B();ag.addSubCollection(aj);ag.addSubCollection(an);aj=ag}var ao=new c({parentView:this,collection:aj,$dsTaskManagement:this.$dsTaskManagement,stateValues:this.collection.allStates()});var ai=(af+1)+"0";ao.container.setAttributes({style:"order:"+ai+"; -webkit-order:"+ai+"; -ms-order:"+ai+";"});this.addChildView(ao);this.listenTo(ao,"onTaskCardClicked",this.onTaskCardClicked.bind(this,ao));this.listenTo(ao,"onTaskDestroyed",ae);h.createElement("li").inject(this._circleContainer)}}var ah=function(){return ak.filterModelsWithSameParentWorkScopeAsSelectedTask(ak.getVisibleRDFModels())};this._detailPanel=new g({stateValues:this.collection.allStates(),collection:this.collection,deliverablesTypes:this.collection.deliverablesTypes(),deliverablesTypesForSearch:this.collection.deliverablesTypesForSearch(),taskRequirementValues:this.collection.allTaskRequirements(),routeTaskActionValues:this.collection.allRouteTaskActions(),routeTaskStateValues:this.collection.allRouteTaskStates(),routeTaskNoReviewStateValues:this.collection.allRouteTaskNoReviewStates(),routeTaskApprovalActionValues:this.collection.allRouteTaskApprovalActions(),alertMessageContainer:this._alertContainer||this.container,context:e.getContext(),callbackForVisibleTasks:ah});this.listenTo(this._detailPanel,"onClose",this.onCloseDetail);this.addChildView(this._detailPanel)},onCloseDetail:function(){if(this._selectedView&&typeof this._selectedView.onUnselect==="function"){this._selectedView.onUnselect()}var af=this._selectedChildView;this._selectedChildView=null;this._selectedView=null;this.onResize();if(this._maxLeftIndex()<this.getLeftColumnIndex()){this.scrollLeft()}else{var ad=this.getLeftColumnIndex();ad--;if(ad>=0&&ad<this._childrenViews.length&&af===this._childrenViews[ad]){this.scrollLeft()}}var ae=this._circleContainer.getElements("li").pop();ae.remove();this._updateScrollButtonsAndDots();this.handleTagCollect()},filterTasks:function(ad){var ae=K.getFilter();var af=ad.value;if(af!==ae){K.setFilter(af);enoviaServer.preferences.currentTaskFilter=af;this._drawTaskTools();this.onFilter()}},onFilter:function(){this.onReset()},switchView:function(ae,af){if(ae!==this.currentViewName){if(this.currentViewName){this.container.toggleClassName("tasks-"+this.currentViewName,false)}this.container.toggleClassName("tasks-"+ae,true);this.currentViewName=ae;var ad=false;this.collection.setAttrToSplitBy(this.currentViewName,ad);if(this._rdfCollection){this._rdfCollection.setAttrToSplitBy(this.currentViewName,ad)}if(!af){this.colChanged()}widget.setValue("currentView",ae);this.onResize()}this._drawTaskTools()},colReset:function s(){},colChanged:function T(){this.resetChildViews();this.onResize();this.renderColumns();this.dispatchEvent("afterColChanged")},setScopeNameLabels:function G(){if(!this.container.isInjected()){return}var ad=this.scopeModelContainer.getScope();var ae;if(ad){ae=ad.get("name")}this.setTitleDefaultValue(ae);this.modifyCreateTaskText(ae);this.setScopePlaceholderText(ad);this.setTaskForProjectLabel(ad);this.updateTitle()},setTaskForProjectLabel:function L(ak){var al=this.getElement(".collab-space");if(K.isScopeRDF()){al.hide();return}else{al.show()}var aj=al.getElement("span");var ag=false;var ah=false;var am,ae;if(ak){var ad=ak.get("collabSpace")||this.collection.collabSpace;ah=(ad!==this.collection.collabSpace);var ai=ak.get("type")||"";var af=this.collection.projectTypes();ag=af&&af.split(",").indexOf(ai)!==-1;if(ag){ae=ac("emxCollaborativeTasks.Label.CollaborativeSpace")+": ";am=ae+ad;al.set("title",am);aj.setText(ad)}}if(!ag){ae=ac("emxCollaborativeTasks.Label.CollaborativeSpace")+": ";am=ae+this.collection.collabSpace;al.set("title",am);aj.setText(this.collection.collabSpace)}al.toggleClassName("alert-icon",ah)},setScopePlaceholderText:function i(ae){var af=this.scopeIdView.getElement("input[type=text]");if(!af){return}var ad=ac("emxCollaborativeTasks.Label.ShowTasksForObject");ad=ad.replace("%NAME%",ac("emxCollaborativeTasks.WidgetLabel.MyTasks"));if(!ae){af.setAttribute("placeholder",ad)}else{af.removeAttribute("placeholder")}},setup:function(af){var ae=h.clone(af||{},false);this.SHOWTASKSFOR=ac("emxCollaborativeTasks.Label.ShowTasksForObject");this._parent.apply(this,arguments);this.$dsTaskManagement=w(this.container);var ad=widget.getValue("currentView");var ag=ad?ad:"stateForDisplay";this._columnStyleInnerHTML="";this._rdfCollection=ae.rdfCollection;this._embeddedApp=ae.embeddedApp;this._alertContainer=ae.alertContainer;this._singleTaskId=ae.singleTaskId;this.switchView(ag,true);this.resetChildViews();this._initializeScopeModelContainer();this._initializeScopeIdView();this._rdfCollection&&this.listenTo(this._rdfCollection,"onFailToFindScope",this.onFailToFindRDFScope);this.addListeners();this.modal=new f({renderTo:this.container,okButtonText:ac("emxCollaborativeTasks.Command.OK"),koButtonText:ac("emxCollaborativeTasks.Command.Cancel")});this.initTagger()},addListeners:function(){this.listenTo(this.collection,"onChange:allStates",function(){if(this.currentViewName==="state"){this.colChanged()}});this.listenTo(this.collection,"onChange:allDueDates",function(){if(this.currentViewName===o){this.colChanged()}});this.listenTo(this.collection,"onChange:allStatesForDisplay",function(){if(this.currentViewName==="stateForDisplay"){this.colChanged()}});this.listenTo(this.collection,"onReset",this.colReset);this.listenTo(this.collection,"onChange:lastReadFrom",this._setLastReadClass);this.listenTo(this.collection,"onChange:search",function(){this.colChanged()});if(widget){this.listenTo(widget,"onViewChange",this.onViewChange)}this.listenTo(this.collection,"onChange:collabSpace",this.render);this.listenTo(this,"onInjected",this.setScopeNameLabels)},_initializeScopeIdView:function(){this.scopeIdView=new W({model:this.scopeModelContainer,id:function(){return"changeContextDiv"},DocumentManagement:U,context:e.getContext(),i18n:ac})},_initializeScopeModelContainer:function(){var ae=this;this.scopeModelContainer=new I({collection:this.collection});this.scopeModelContainer.confirmRemoveScope=function af(aj){var ah=this.get("scope");if(ah){var ag=ah.get("name")||"";var ai=ac("emxCollaborativeTasks.Command.RemoveContext").replace("%NAME%",ag);ae.modal.confirm(ai,ac("emxCollaborativeTasks.Command.RemoveContextTitle"),function(ak){if(ak){aj();ae.setScopePlaceholderText()}})}};var ad=function(){if(this._scopeListenedTo){this.stopListening(this._scopeListenedTo)}this._scopeListenedTo=this.scopeModelContainer.getScope();if(this._scopeListenedTo){this.listenTo(this._scopeListenedTo,{onChange:this.setScopeNameLabels,onReset:this.setScopeNameLabels})}};this.listenTo(this.scopeModelContainer,"onChange:scopeId",function(ag){ad.apply(this);this.updateCreateTaskUI();if(ag){this.onReset()}});ad.apply(this)},_setLastReadClass:function(ad,ae){this.container.toggleClassName("readFromLocal",ae==="local")},onViewChange:function(){this.container.click()},template:function(){var ae=d.i18n;d.i18n=ac;var ad=m(this.collection.dataForRendering());d.i18n=ae;return ad},updateCreateTaskUI:function(){this.setScopeNameLabels();if(this.shouldDisableCreateTask()){this.disableCreateTask()}else{this.enableCreateTask()}},render:function(){var ad=this;this._removeElementsFromDom();ad.container.empty(true);ad.container.setHTML(this.template());if(h.Utils.Client.Platform.ios){ad.container.addClassName("ios")}this._setScopesTypesForSearch();this._columnStyle=ad.getElement("#respColumnWidth");this._columnStyle.setHTML(this._columnStyleInnerHTML);this._addEventsOnAddTaskArea();this.renderColumns();this._drawTaskTools();this._setLastReadClass(null,this.collection.lastReadFrom);this._scopeIdContainer=this.getElement("#scopeIdContainer");this.scopeIdView.render().inject(this._scopeIdContainer);if(this.dragControl){this.dragControl.destroy()}this._initializeDragControl();this.updateCreateTaskUI();if(!Q.hasLoadedRolesData()){this.listenToOnce(Q,"rolesDataLoaded",this.updateCreateTaskUI)}this.dispatchEvent("afterRender");return this},_addEventsOnAddTaskArea:function(){var ad=this.container.getElement("#addTaskText");ad.addEvent("focus",this.onFocusAddExpandedTask.bind(this));var ae=this.container.getElement("#addTaskButton");ae.addEvent("click",this.onFocusAddExpandedTask.bind(this))},shouldDisableCreateTask:function(){var af=D.getUsersContentRepositories();var ad=K.isScopeRDF();var ae=!ad&&af.length===0;if(!ae&&ad){ae=!Q.hasRole("XPP")}return ae},_removeElementsFromDom:function(){this._circleContainer.remove();this.scopeIdView&&this.scopeIdView.remove();var af=this._childrenViews.length;for(var ae=0;ae<af;ae++){var ad=this._childrenViews[ae];ad.container.remove()}},_initializeDragControl:function(){var ae=this;this.dragControl=new ab.Move({container:this._columnsCarrier,zones:".body.ui-droppable",delegate:".real-card *",centerHandles:true,handles:function(af){var aj=af.target.getParent(".real-card");var ai=k.getViewFromContainer(aj);af.cardView=ai;af.cardView.container.toggleClassName("ui-being-dragged",true);ae.container.click();if(!ai.dragHelperView){ai.dragHelperView=new X({model:ai.model});ai.dragHelperView.render()}var ah=ai.dragHelperView.container;var ag=aj.getDimensions();ah.toggleClassName("drag-helper",true);var ak=h.createElement("div");ak.toggleClassName("dragged-card-wrapper",true);ak.setStyle("width",ag.innerWidth);ak.setStyle("height",ag.innerHeight);ah.inject(ak);ak.inject(af.options.container.getParent("div.collaborative-tasks-content"));return ak},start:function(){return !ae._selectedChildView},stop:function(af){af.cardView.container.toggleClassName("ui-being-dragged",false);var ag=af.cardView.dragHelperView;delete af.cardView.dragHelperView;if(ag){ag.container.parentElement.destroy()}delete af.cardView},enter:function(ah){var af=k.getViewFromContainer(ah.zone.getClosest(".column"));var ag=ah.zone;if(ah.accept(af)){ag.toggleClassName("drop-zone",true)}},leave:function(ag){var af=ag.zone;af.toggleClassName("drop-zone",false)},drop:function(ah){var af=k.getViewFromContainer(ah.zone.getClosest(".column"));if(ah.accept(af)){var ag=ah.zone;ag.toggleClassName("drop-zone",false);af=k.getViewFromContainer(ah.zone.getClosest(".column"));af._handleDrop(ah.cardView)}},move:function(ag){if(ae.autoScrolling){return}var aj,ah,af;try{aj=ag.cardView.dragHelperView.container.offsetParent;ah=aj.offsetWidth;af=aj.offsetLeft;var ak=ae.container.offsetWidth;if((af+ah)>(ak+Number(ah)/3)){ae.scrollRight()}else{if(af<=(-ah/3)){ae.scrollLeft()}}}catch(ai){}}});this.dragControl.accept=function(af){var ah=this.target.getClosest(this.options.zones)!==this.zone;var ag,ai;if(ah){if(this.cardView.model.isRDF){ag=af.collection._filterAttr;if(ag==="state"){ai=af.collection._valueForFiltering;ai=ai.actualValue?ai.actualValue:ai;ah=ai==="Assign"||ai==="Active"||ai==="Complete"}}}return(ah)};this.dragControl.refreshCache=function ad(){this.constructor.prototype.refreshCache.apply(this,arguments);if(this.limit){this.limit.x=[-Infinity,Infinity]}}},_setScopesTypesForSearch:function(){var af=this;var ae=function(){var ag=af.scopeModelContainer.config();ag[0].activationCallback=function(ai,ah){af._scopeIdContainer.toggleClassName("active",ah)};af.scopeIdView.setConfig(ag);af.scopeIdView.render();af.setScopeNameLabels()};var ad=this.collection.scopesTypesForSearch();if(!ad){this.listenToOnce(this.collection,"onSync",function(){ae()})}if(!r.hasLoadedFederatedSearchSources()){this.listenToOnce(r.eventDispatcher,"onFederatedSearchSourcesLoaded",function(){ae()})}ae()},renderColumns:function(){var ag=this;var ah=ag.getElement(".columns-carrier");this._columnsCarrier=ah;if(ah){ah.empty();var af=ag._childrenViews.length;for(var ae=0;ae<af;ae++){var ad=ag._childrenViews[ae];ad.container.inject(ah);ad.render()}}this._circleContainer.inject(ag.getElement(".pagination"));this.setLeftColumnIndex(0);return this},_drawTaskTools:function(){var aj=this;var ag=ac("emxCollaborativeTasks.Menu.ViewBy");var af=ac("emxCollaborativeTasks.Command.View.stateForDisplay");var ad=ac("emxCollaborativeTasks.Command.View.state");var an=ac("emxCollaborativeTasks.Command.View.dueDateCategory");var am=ac("emxCollaborativeTasks.Command.Filter.all");var ak=ac("emxCollaborativeTasks.Command.Filter.owned");var ah=ac("emxCollaborativeTasks.Command.Filter.assigned");var ai=[];ai.push({text:ag,className:"header"});ai.push({id:"stateForDisplayViewDrop",className:"drop view-by-menu stateForDisplay-view",text:af,value:"stateForDisplay",func:function(){aj.switchView(this.value)}});if(!this._embeddedApp){ai.push({id:"stateViewDrop",className:"drop view-by-menu state-view",text:ad,value:"state",func:function(){aj.switchView(this.value)}})}ai.push({text:an,id:"dueDateViewDrop",className:"drop view-by-menu dueDateCategory-view",value:o,func:function(){aj.switchView(this.value)}});ai.push({className:"divider"});ai.push({className:"drop task-filter filter-all",text:am,value:N,func:function(){aj.filterTasks(this)}});ai.push({className:"drop task-filter filter-owned",text:ak,value:M,func:function(){aj.filterTasks(this)}});ai.push({className:"drop task-filter filter-assigned",text:ah,value:H,func:function(){aj.filterTasks(this)}});var al={dropdownCaret:false,id:"overflowCTXMenu",className:"link",icon:"fonticon-2x fonticon-menu-dot",dropdown:{items:ai},events:{onDropdownClick:function(ap,ao){if(ao&&typeof ao.func==="function"){ao.func()}}}};var ae=[];ae.push({className:"drop-tool view-by-menu stateForDisplay-view",text:af,value:"stateForDisplay"});if(!this._embeddedApp){ae.push({className:"drop-tool view-by-menu state-view",text:ad,value:"state"})}ae.push({className:"drop-tool view-by-menu dueDateCategory-view",text:an,value:o});ae.push({className:"divider"});ae.push({className:"drop-tool task-filter filter-all",text:am,value:N});ae.push({className:"drop-tool task-filter filter-owned",text:ak,value:M});ae.push({className:"drop-tool task-filter filter-assigned",text:ah,value:H});this._taskButtons={id:"ViewMenu",value:ag,dropdown:{items:ae},events:{onDropdownClick:function(ap,ao){if(ao.className.indexOf("filter-")>-1){aj.filterTasks(ao)}else{aj.switchView(ao.value)}}}};this._taskTools=this.getElement("#taskTools");if(this._taskTools){this._taskTools.empty();this.setSelectView(this._taskButtons);this.taskToolsButton&&this.taskToolsButton.destroy();this.taskToolsButton=new V(this._taskButtons).inject(this._taskTools)}this._overflowMenuDiv=this.getElement("#overflowMenu");if(this._overflowMenuDiv){this._overflowMenuDiv.empty();this.setSelectView(al);this.overflowMenuButton&&this.overflowMenuButton.destroy();this.overflowMenuButton=new V(al).inject(this._overflowMenuDiv)}},setSelectView:function(ad){var ag=this;var af=ad.dropdown.items;var ae=K.getFilter();af.forEach(function(ah){if(ag.currentViewName===ah.value||ae===ah.value){ah.icon="fonticon fonticon-check"}else{ah.icon="fonticon"}});return af},scrollRight:function(){var ad=this.getLeftColumnIndex();this.setLeftColumnIndex(++ad)},scrollLeft:function(){var ad=this.getLeftColumnIndex();this.setLeftColumnIndex(--ad)},_resetSingleTask:function(){this.collection.fetchTaskById(this._singleTaskId);this._rdfCollection.length&&this._rdfCollection.at(0).fetch()},onReset:function(){this.onViewChange();if(this._singleTaskId){this._resetSingleTask()}else{if(!this._embeddedApp){this.collection.fetch({server:true,reset:true,onComplete:function(){var ad=ac("emxCollaborativeTasks.Label.SuccessfulRefresh");J.displaySuccess(ad)},onFailure:function(){var ad=ac("emxCollaborativeTasks.Label.FailedRefresh");J.displayError(ad)}})}this._rdfCollection&&this._rdfCollection.fetch({reset:true,onComplete:this.updateTitle.bind(this)})}},onResize:function(){var an=this;if(!this._childrenViews){return}var at=this.container.getSize();if(!at.width||!at.height){return}var ai=this._nbColumnsShown;var ae=function(){var aw=c.nbCardsBuffer;var au=c._cardHeight||80;c.nbCardsBuffer=Math.floor(at.height/au)+2*c.nbCardsTopBuffer;for(var ay=an._childrenViews.length-1;ay>=0;ay--){var av=an._childrenViews[ay];if(av.collection){var ax=av.collection.size();if(ax>Math.min(aw,c.nbCardsBuffer)){av.resizeBuffer()}}}};ae();var ar=w(this.container);var am=at.width/this._minColWidth;var ap=Math.floor(am);ap=Math.max(1,ap);var aq="min-width:"+this._minColWidth+"px;";var ad=100/ap;var ao=this._nbColumnsToDisplay();var ah=ad*ao;var al=100/ao;var ag="";var af="";var ak="";if(am>ao){af=".columns-carrier { max-width: calc( "+ao+" * "+this._maxColWidth+"px );} ";ag=".column { width:"+al+"%;"+aq+" max-width:"+this._maxColWidth+"px; } ";ar.toggleClass("wide",true);ar.toggleClass("medium",false);ar.toggleClass("narrow",false);this._nbColumnsShown=ao}else{ar.toggleClass("wide",false);if(ap>1){ar.toggleClass("medium",true);ar.toggleClass("narrow",false);aq="min-width:0px;"}else{ar.toggleClass("medium",false);ar.toggleClass("narrow",true);aq="min-width:0px;"}ag=".column { width:"+al+"%; max-width:none;"+aq+"} ";af=".columns-carrier { width:"+ah+"%;} ";this._nbColumnsShown=ap?ap:1}ak=".collaborative-tasks-content .alert:not(.alert-fullwidth)  { width: calc("+100/this._nbColumnsShown+"% - 4px) }";var aj=".column.details-tasks.off { transition: width "+this._durationOfDetailClosure/1000+"s ease-in-out; }";this._columnStyleInnerHTML=aj+ag+af+ak;if(this._columnStyle){this._columnStyle.setHTML(this._columnStyleInnerHTML)}if(ai!==this._nbColumnsShown){this.setLeftColumnIndex(this.getLeftColumnIndex())}},_maxLeftIndex:function(){var ad=this._nbColumnsToDisplay()-this._nbColumnsShown;return ad},_stopAutoScrolling:function(){this.autoScrolling=false;if(this.dragControl){this.dragControl.refreshCache()}},_nbColumnsToDisplay:function(){var ad=0;this._childrenViews.forEach(function(ae){if(ae instanceof c){ad++}});if(this._selectedChildView){ad++}return ad},setLeftColumnIndex:function E(ae){if(!this._childrenViews){return}var ad=ae<0?0:ae;if(this._selectedChildView){var ag=this._childrenViews.indexOf(this._selectedChildView)-(this._nbColumnsShown-2);if(this._nbColumnsShown===1){ag=this._childrenViews.indexOf(this._selectedChildView)+1}ad=ad<ag?ag:ad}var af=this._maxLeftIndex();ad=ad>af?af:ad;if(this._leftColumnIndex!==ad){this.autoScrolling=true;setTimeout(this._stopAutoScrolling.bind(this),510)}this._leftColumnIndex=ad;if(this._columnsCarrier){this._columnsCarrier.setStyle("left",-100*ad/this._nbColumnsShown+"%")}this._updateScrollButtonsAndDots()},_updateScrollButtonsAndDots:function(){var ai=this.getLeftColumnIndex();var ae=this.getElement(".scroll-left");var am=this.getElement(".scroll-right");if(ae){ae.toggle(ai!==0&&!this._selectedChildView)}if(am){am.toggle(ai!==this._maxLeftIndex()&&!this._selectedChildView)}var al=this._circleContainer.getElements("li");if(al){var aq=al.length;for(var ao=0;ao<aq;ao++){var af=al[ao];if(ao<ai||ao>=ai+this._nbColumnsShown){af.removeClassName("in-view")}else{af.addClassName("in-view")}}}var ag=this._nbColumnsToDisplay();var ap=[];for(var ak=0;ak<ag;ak++){var ah=this._childrenViews[ak];ap.push(ah);if(ah===this._selectedChildView){ap.push(this._detailPanel)}}var aj=ai+this._nbColumnsShown-1;for(var ad=0;ad<ag;ad++){var an=ap[ad].container;an.toggleClassName("right-most-column-shown",ad===aj)}},getLeftColumnIndex:function(){if(!this._leftColumnIndex){this._leftColumnIndex=0}return this._leftColumnIndex},expandTaskInputField:function(){var ae=this.getElement("#addExpandedTaskDiv");ae.getElement(".form-group").toggleClassName("has-error",false);ae.toggleClassName("visible",true);var ad=this.getElement("#addExpandedTaskText");ad.focus()},onFocusAddExpandedTask:function(){this.expandTaskInputField()},onKeyUpAddTask:function(ad){if(ad.key==="Enter"){if(ad.preventDefault){ad.preventDefault()}this.processExpandedTaskInput(false)}},onClickAddTaskButton:function(){this.processExpandedTaskInput(true)},onClickAddAndOpenTaskButton:function(){this.processExpandedTaskInput(true,true)},onClickCancelTaskButton:function(){this.removeExpandedTaskInput()},removeExpandedTaskInput:function(){var ae=this.getElement("#addExpandedTaskDiv");ae.toggleClassName("visible",false);var ad=this.getElement("#addExpandedTaskText");ad.blur();ad.value=""},processExpandedTaskInput:function(ad,af){var ae,ag=this.getElement("#addExpandedTaskText");var ah=ag&&ag.value&&ag.value.trim();if(ag&&ag.value&&ag.value.trim()){ae=this.createTaskWithString(ag.value.trim(),af)}if(!ah){this.removeExpandedTaskInput()}if(ae){if(ad){this.removeExpandedTaskInput()}else{ag.value="";ag.focus();this.hideOrShowCloseAndCancelButtons()}}return ae},createTaskWithString:function(ad,ai){var aj;var ag=1;var ae=0;var ah=this.collection.allDueDates()[ag];var ak;if(ai){ak=function(){if(c.lastCardAdded){c.lastCardAdded.onClickTaskCard()}}}if(K.isScopeRDF()){aj=this._rdfCollection.addNewTask(ad,this.scopeModelContainer.getScope(),{onComplete:ak})}else{var am={title:ad,state:this.collection.allStates()[ae],dueDateCategory:ah};aj=this.collection.addNewTask(am);aj.save(null,{onFailure:function(){var ap=ac("emxCollaborativeTasks.Error.FailedToCreateTask");var ao=arguments[2];var an=ao&&ao.response;if(an&&an.statusCode===400){ap=(an.error&&an.error.length)?ac(an.error):ap}J.displayError(ap)},onComplete:ak,at:0})}var af=0;if(this.currentViewName==="state"){af=ae}else{if(this.currentViewName===o){var al=aj.get(o);af=ag;this.collection.allDueDates().detect(function(ap,ao){var an=ap.actualValue===al;if(an){af=ao}return an})}}this.setLeftColumnIndex(af);return aj},handleDropCSV:function a(ai){var ah=this,ag,af,ad;if(ai.stopPropagation){ai.stopPropagation()}if(ai.preventDefault){ai.preventDefault()}var ae=P.getElement(ai);ae.getParent().removeClassName(z);ag=ai.dataTransfer.files;if(ag&&ag.length){af=ag[0];if(typeof(FileReader)!=="undefined"){ad=new FileReader();ad.onload=function(al){var aj=al.target.result;var ak={onComplete:ah.onCSVSuccess,onFailure:ah.onCSVFailure};ah.collection.importTasksFromCSV(aj,ak)};ad.readAsText(af)}}return false},onCSVSuccess:function p(){var ad=ac("emxCollaborativeTasks.Label.ImportItemsDone");J.displayMessage({msg:ad,msgType:"primary"})},onCSVFailure:function A(){var ad=ac("emxCollaborativeTasks.Label.ImportItemsDone");J.displayPrimary(ad)},handleDragOver:function x(ae){if(ae.preventDefault){ae.preventDefault()}ae.dataTransfer.dropEffect="copy";var ad=P.getElement(ae);ad.getParent().addClassName(z);return false},handleDragEnter:function O(ae){var ad=P.getElement(ae);ad.getParent().addClassName(z)},handleDragLeave:function Y(ae){var ad=P.getElement(ae);ad.getParent().removeClassName(z)},handleDragEnd:function Z(ae){var ad=P.getElement(ae);ad.getParent().removeClassName(z)},modifyCreateTaskText:function R(ae){var af=this.getElement("#addTaskText");var ad=ac("emxCollaborativeTasks.Label.CreateTask");if(this.shouldDisableCreateTask()){af.placeholder=this.getDisabledPlaceholder()}else{if(ae){ad=ac("emxCollaborativeTasks.Label.CreateTaskForContext");af.placeholder=ad.replace("%CONTEXT%",ae);this.getElement("#addExpandedTaskText").placeholder=ad.replace("%CONTEXT%",ae)}else{af.placeholder=ad;this.getElement("#addExpandedTaskText").placeholder=ad}}},getDisabledPlaceholder:function(){var ae;var ad=K.isScopeRDF();var af=!ad&&D.getUsersContentRepositories().length===0;if(af){ae="emxCollaborativeTasks.Label.SetCollabSpaceOrProjectAsContext"}else{if(ad&&!Q.hasRole("XPP")){ae="emxCollaborativeTasks.Error.FailedToCreateTaskWithNoXPPLicense"}}return ac(ae)},getTitlePref:function u(){var ad=widget.getPreference("title");if(typeof ad.value==="string"&&ad.value.trim().length===0){delete ad.value}return ad.value||ad.defaultValue},setTitleDefaultValue:function t(ag){var ae=ac("emxCollaborativeTasks.WidgetLabel.MyTasks");var ad=widget.getPreference("title");if(!ad){ad={name:"title",type:"text",label:ac("emx.CollaborativeTasks.Label.WidgetTitle"),onchange:"onTitleChange"}}ad.label=ac("emx.CollaborativeTasks.Label.WidgetTitle");ad.onchange="onTitleChange";var af=(ad.value===ad.defaultValue);ad.defaultValue=ae;if(ag){ad.defaultValue=ag}widget.addPreference(ad);if(af){widget.setValue("title",ad.defaultValue)}!this._embeddedApp&&widget.setTitle(this.getTitlePref())},handleMouseDown:function v(ah){var ag=w(this.container).find("#addExpandedTaskDiv");if(ag.hasClass("visible")&&ag.has(w(ah.target)).length===0){this.removeExpandedTaskInput()}else{if(!ag.hasClass("visible")){this.hideOrShowCloseAndCancelButtons()}}var ad=w("#contextDropZone");var af=ad.find(".active");var ae=w(ah.target).closest("#changeContextDiv").length;if(af.length&&!ae){af.removeClass("active")}},initScope:function(){var ad=K.getScopeId();if(!this.scopeModelContainer.getScope()&&ad){this.scopeModelContainer.add("scope",ad,{scopeType:K.getScopeType(),isRDF:K.isScopeRDF(),dontCheckTypes:true,noRealChange:true})}},_getSingleTaskTitle:function(){var ad;if(this.collection.length===1){ad=this.collection.at(0).get("title")}else{if(this._rdfCollection&&this._rdfCollection.length===1){ad=this._rdfCollection.at(0).get("title")}}return ad},updateTitle:function(){if(this._singleTaskId){widget.setTitle(this._getSingleTaskTitle());return}var af=widget.getValue("title");var ad=widget.getPreference("title");if(widget&&af&&ad){af=af&&af.trim();af=af||ad.defaultValue;var ae=this.collection.length;if(this._rdfCollection){ae=ae+this._rdfCollection.length}af+=" ("+ae+")";if(widget.getTitle()!==af){widget.setTitle(af)}}},getVisibleModels:function(){var ae=[];var ag=this.getLeftColumnIndex();for(var af=ag;af<ag+this._nbColumnsShown;af++){var ad=this._childrenViews[af];if(ad.getVisibleModels){ae=ae.concat(ad.getVisibleModels())}}return ae},getVisibleRDFModels:function(){return this.getVisibleModels().filter(function(ad){return ad instanceof j})},filterModelsWithSameParentWorkScopeAsSelectedTask:function(ag){var af=this;var ad=[];var ae=af._selectedView.model.getParent&&af._selectedView.model.getParent();if(ae){ad=ag.filter(function(ah){var ai=ah.getParent&&ah.getParent();return ai&&ai.id===ae.id})}return ad},onFailToFindRDFScope:function(){J.displayError(ac("emxCollaborativeTasks.Error.FailedToRetrieveScope"));var ad=widget.getPreference("title");widget.setValue("title",ad.defaultValue);this.scopeModelContainer.setScope(null);K.removeScopeData();this._rdfCollection.fetch({reset:true,onComplete:this.updateTitle.bind(this)})},filterRDFCollection:function(ah){var ag=this;var ad=ah.filteredSubjectList;var ae=ah.allfilters&&Object.keys(ah.allfilters).length;if(ae){if(!this._originalRdfCollection){this._originalRdfCollection=this._rdfCollection.clone()}var af=[];ad.forEach(function(aj){var ai=ag._originalRdfCollection.get(aj);ai&&af.push(ai)});ag._rdfCollection.reset(af,{dontCallTagger:true})}else{if(this._originalRdfCollection){this._rdfCollection.reset(this._originalRdfCollection._models,{dontCallTagger:true});delete this._originalRdfCollection}}},initTagger:function(){try{var af=this.collection.getTNProxy();var ad=new q(af);this.collection.setTNProxy(ad);if(this._rdfCollection&&af){this.listenTo(af,"onFilterSubjectsChange",this.filterRDFCollection);this.listenTo(this._rdfCollection,"onReset",function(){var ah=Array.prototype.slice.call(arguments,0);var ag=h.clone(ah[1]||{},false);this.fetchNewTags(ag)})}}catch(ae){}},fetchNewTags:function(ae){var ad=h.clone(ae||{},false);if(ad&&!ad.dontCallTagger){this._handleRequestForImplicitAndExplicitTags.apply(this,arguments)}},_setTagDataOnProxy:function(ae){var ad=this._rdfCollection.getTaggerData();var af=this.collection.getTNProxy();af.setSubjectsTags(ad,ae)},_handleRequestForImplicitAndExplicitTags:function(ae){var af=this;var ad=ae&&ae.rdfCollection||this._rdfCollection;if(ad&&ad.length===0){af._setTagDataOnProxy("rdf",ae)}else{ad&&ad.federatedTaggerServiceRequest({onComplete:function(){af._setTagDataOnProxy("rdf",ae)},onFailure:function(){af._setTagDataOnProxy("rdf",ae)}})}}});return F});define("DS/CollaborativeTasks/CollaborativeTasksBootstrap",["UWA/Core","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Collections/TasksCollection","DS/E6WCommonApps/Collections/RDFTasksCollection","DS/CollaborativeTasks/Models/RDFTasksWorkscopeModel","DS/RDFFoundation/RDFUtils","DS/CollaborativeTasks/Views/CollaborativeTasksView","DS/Foundation/WidgetAPIs","DS/Foundation/WidgetUwaUtils","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/LiveUpdateUtils","DS/DocumentManagement/DocumentManagement","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/SecurityContextUtils","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonUI/PlatformManager","i18n!DS/CollaborativeTasks/assets/nls/CollaborativeTasksNLS","DS/XTaskApp/Models/XTaskAppTypeDictionary","css!DS/E6WCommonApps/E6WCommonApps"],function(h,x,l,d,q,c,k,w,y,m,E,D,C,s,z,t,r,A,F,g){"use strict";var v;var f=new h.Class.Listener();var p=x.getWidgetConstant;x.getWidgetConstant=function(J){var K=p.apply(this,arguments);return K||g.get(J)};var o=function(){return x.getWidgetConstant.apply(this,arguments)};m.i18n=o;window.dataVersion=0.3;v={emailNotificationService:"/resources/v1/modeler/tasks/tasksPreference",defaultWindowedHeight:505,checkVisibilityAPI:function(){if(typeof v.document.hidden!=="undefined"){v._hidden="hidden";v._visibilityChange="visibilitychange"}else{if(typeof v.document.mozHidden!=="undefined"){v._hidden="mozHidden";v._visibilityChange="mozvisibilitychange"}else{if(typeof v.document.msHidden!=="undefined"){v._hidden="msHidden";v._visibilityChange="msvisibilitychange"}else{if(typeof v.document.webkitHidden!=="undefined"){v._hidden="webkitHidden";v._visibilityChange="webkitvisibilitychange"}}}}},onPreferencesOpened:function(){v._prefsWhenOpened=widget.getPreferences().reduce(function(K,J){K[J.name]=J.value;return K},{})},onPreferencesClosed:function(){v.updateEmailPreference.apply(this,arguments);widget.dispatchEvent("onUpdateTitle",[widget.getTitle(),undefined]);if(v._prefsWhenOpened.collabspace!==widget.getValue("collabspace")){v.onSpaceChange()}if(v._prefsWhenOpened.collabstorage!==widget.getValue("collabstorage")){v.onStorageChange()}},_initEmailPreference:function u(){var J={url:v.emailNotificationService,type:"GET",dataType:"json",callback:function(N){N||(N={});var M,L;var K=v.tasks.data();if(K){x.__updateCsrf(K,N)}try{L=widget.getValue("emailNotify");M=N.data[0].dataelements.preference_AssignedTaskNotificationOn;if(L!==M){widget.setValue("emailNotify",M)}}catch(O){}}};x.ajaxRequest(J)},_doAutoRefresh:function(){if(!this._getTaskIdToOpen()){v.tasks.fetch({server:true,partialRefresh:true,noTag:true,onComplete:function(){v._setAutoRefreshTimeout()},onFailure:v._setAutoRefreshTimeout.bind(undefined,undefined)})}},_setAutoRefreshTimeout:function(J){if(J){v._doAutoRefresh()}else{if(v.REFRESHTIMEOUT){v.refreshTimeoutId=setTimeout(function(){if(!v.document[v._hidden]){v._doAutoRefresh()}},v.REFRESHTIMEOUT)}}},handleVisibilityChange:function(){if(v.document[v._hidden]){clearTimeout(v.refreshTimeoutId);delete v.refreshTimeoutId}else{if(!v.refreshTimeoutId){v._setAutoRefreshTimeout(true)}}},addNewPreferences:function e(){var M={name:"title",type:"text",label:"Widget Title"};var N=function(){window.enoviaServer.preferences.showProjectTasks=widget.getValue("showProjectTasks")};var L={name:"showProjectTasks",type:"boolean",label:"Show project tasks",defaultValue:"true",onChange:N};var O={name:"emailNotify",type:"boolean",label:"Email notifications",defaultValue:"defaultValue"};var Q=s.getCompletedTasksFilterPref();widget.addPreference({name:"collabspace",type:"list",label:"collabspace"});widget.addPreference({name:"collabstorage",type:"list",label:"collabstorage"});widget.addPreference(M);widget.addPreference(L);widget.addPreference(O);widget.addPreference(Q);widget.setValue("emailNotify","defaultValue");N();var P=E.getFilter();var K=P?P:E.setFilter("all");enoviaServer.preferences.currentTaskFilter=K;var J=s.getCompletedTaskFilter();enoviaServer.preferences[s.COMPLETION_DATE_TASK_FILTER_ATTR]=J[s.COMPLETION_DATE_TASK_FILTER_ATTR];if(!widget.getValue("createSampleData")){widget.setValue("createSampleData","true");enoviaServer.preferences.createSampleData="true"}},_has3DPlanAccess:function j(){return F.hasAccess("3dplan")},_loadRDFTasks:function i(){if(v._getTaskIdToOpen()){if(v._taskIdToOpenIsRDF()){var J=new A({"@id":v._getTaskIdToOpen(),forceDslc:true});var K=c.getDictionaryBatch();J.fetch({onComplete:function(){v.rdfTasks.add(J);v._selectTaskByIdOnLoad(J.id)},onFailure:v._onSingleTaskFetchFail,mask:"dsplan:MVMask.Task.CollaborativeTask.Basic",ajax:K.ajax});K.sendBatch()}}else{v.rdfTasks.fetch({reset:true,data:JSON.stringify([E.getFilter(),s.getCompletedTaskFilter()])})}c.subscribeToNotification(this.onNotification.bind(this));this._notifQueue=[]},onNotification:D.onNotification,_getTaskIdToOpen:function(){return v._selectedTaskId},_taskIdToOpenIsRDF:function(){return v._getTaskIdToOpen().indexOf(":")!==-1},initMSF:function(){var J="DS/MSFDocumentManagement/MSFDocumentClient";require([J],function(K){C.MSFDocumentClient=K;C.MSFDocumentClient.onConnectWithMSF()})},_initTasksCollection:function(){v.tasks=new l();v.tasks.addEvent("onAdd",v.onTitleChange);v.tasks.addEvent("onRemove",v.onTitleChange);v.tasks.addEvent("onReset",v.onTitleChange)},_initRDFTasksCollection:function(){d.RDFWorkscopeModel=q;this.rdfTasks=new d(undefined,{"@href":"/invoke/dsxplan:getTasks","@mask":"dsplan:MVMask.Task.CollaborativeTask.Basic",detailsMask:"dsplan:MVMask.Task.CollaborativeTasks.Complex"});this.rdfTasks.addEvent("onAdd",this.onTitleChange);this.rdfTasks.addEvent("onRemove",this.onTitleChange);this.rdfTasks.addEvent("onReset",this.onTitleChange)},init:function B(){window.enoviaServer||y.setupEnoviaServer();window.enoviaServer.widgetId=widget.id;window.enoviaServer.widgetName=widget["6wWidgetName"];h.Utils.Client.Platform.windows&&this.initMSF();widget.addEvents({onRefresh:v.onRefresh,onEdit:v.onPreferencesOpened,endEdit:v.onPreferencesClosed});this.addNewPreferences();y.onAfterLoad=Function.prototype;var K=widget.getValue("collabstorage");this._initTasksCollection();this._processSelectedIds();w.getCollaborativeStorages(function(L){F.storePlatformServiceData(L);y.processStorages(L,K);y.setStoragesPrefs(widget,L,K,"true");E.initialize();v.processStorageChange(K);v.document.addEventListener(v._visibilityChange,v.handleVisibilityChange,false)});v.scopes=v.tasks.getChildCollection("scopes");var J=top.document.getElementsByName("viewport");J&&J.length&&J[0].setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no");C.downloadDocument=function(P,M,L,O){var N=h.clone(O||{},false);var Q=Array.prototype.slice.call(arguments,0);Q[3]=N;var R=N.serviceId;enoviaServer&&R&&(N.tenantUrl=enoviaServer[R]);return this.constructor.prototype.downloadDocument.apply(this,Q)};F.fetchRolesData()},onLoad:function b(){v.init()},onRefresh:function H(){v._updatePrefOnRefresh();v.tasksView.onReset()},_updatePrefOnRefresh:function(){var K=widget.getValue("showProjectTasks");window.enoviaServer.preferences.showProjectTasks=K;var J=s.getCompletedTaskFilter();enoviaServer.preferences[s.COMPLETION_DATE_TASK_FILTER_ATTR]=J[s.COMPLETION_DATE_TASK_FILTER_ATTR]},onViewChange:function I(){var J=widget.getView();if(J.previous&&J.previous.type!==J.type){v.setWindowHeight()}},setWindowHeight:function a(){var J=widget.getViewportDimensions();if(v.tasksView){v.tasksView.container.setStyle("height",J.height)}},onTitleChange:function(){v.tasksView&&v.tasksView.updateTitle()},onEmailNotifyChange:function(J,K){v.userEnteredEmailValue=K.toString().toLowerCase()},onCompletedTasksDisplayPrefChange:function(J,K){s.setCompletedTaskFilter(K)},updateEmailPreference:function G(){var M=widget.getValue("emailNotify");var K={data:[{dataelements:{}}]};if(v.userEnteredEmailValue!==undefined&&M===v.userEnteredEmailValue){var L=v.tasks.data();if(L){x.__updateCsrf(K,L)}K.data[0].dataelements.preference_AssignedTaskNotificationOn=v.userEnteredEmailValue.toString();var J={url:v.emailNotificationService,type:"PUT",dataType:"json",data:JSON.stringify(K),headers:{"content-type":"application/json"}};x.ajaxRequest(J);delete v.userEnteredEmailValue}},spaceNames:{},myAppsStorages:null,onStorageChange:function(){F.setTenantBy3DSpaceUrl(widget.getValue("collabstorage"));y.onStorageChange.call(v)},onSpaceChange:function(){y.onSpaceChange.call(v);y.processStorageChange.call(v,widget.getValue("collabstorage"));v.setSpace()},_loadIndividual3DSpaceTask:function(){var J=v._getTaskIdToOpen();if(v._taskIdToOpenIsRDF()){J="00000000000000000000000000000000"}v.tasks.fetchTaskById(J,{reset:true,onComplete:v._afterLoadInvididual3DSpaceTask,onFailure:v._onSingleTaskFetchFail})},_afterLoadInvididual3DSpaceTask:function(){if(v._taskIdToOpenIsRDF()){return}var J=v._getTaskIdToOpen();if(!v.tasksView){widget.addEventOnce("constantsServiceReturned",function(){v._selectTaskByIdOnLoad(J)})}else{v._selectTaskByIdOnLoad(J)}},_load3DSpaceTasks:function(){if(v._getTaskIdToOpen()){v._loadIndividual3DSpaceTask()}else{v.tasks.fetch({server:true,reset:true,onComplete:function(){v._setAutoRefreshTimeout()},onFailure:function(){v._setAutoRefreshTimeout()}})}},_tasksServiceInitCalls:function(){var J=this;this._load3DSpaceTasks();x.getWidgetConstants("/resources/v2/e6w/service/TSK_WIDGET_CONSTANTS",function(){var K=o("REFRESH_TIMEOUT");if(K){v.REFRESHTIMEOUT=parseInt(K,10)*1000}enoviaServer.widgetId=widget.id;if(v._has3DPlanAccess()){J._initRDFTasksCollection();v._loadRDFTasks()}if(!v.tasksView){widget.addEvents({onViewChange:v.onViewChange,onUpdateTitle:v.onTitleChange,onUpdateValue:v.onValueChanged});v.setupTasksView();v._initEmailPreference.apply(this,arguments)}v.tasksView.setTitleDefaultValue();v.tasksView.initScope();v.setWindowHeight();widget.dispatchEvent("onResize");v._initPreferencesWithConstants();widget.dispatchEvent("constantsServiceReturned")})},onValueChanged:function(J,K){switch(J){case"emailNotify":v.onEmailNotifyChange(J,K);break;case s.COMPLETED_TASK_PREF_NAME:v.onCompletedTasksDisplayPrefChange(J,K);break;default:break}},setupTasksView:function(){v.tasksView=new k({collection:v.tasks,rdfCollection:v.rdfTasks,singleTaskId:v._getTaskIdToOpen()});f.listenTo(v.tasksView,"afterRender",function(){z.initializeAlert(v.tasksView.container.getElement(".collaborative-tasks-content"))});v.tasksView.listenTo(widget,"onResize",function(){v.setWindowHeight();v.tasksView.onResize.apply(v.tasksView,arguments)});v.tasksView.listenTo(widget,"onSearch",function(J){if(v.rdfTasks){v.rdfTasks.setSearch(J)}v.tasks.setSearch(J)});v.tasksView.listenTo(widget,"onResetSearch",function(){if(v.rdfTasks){v.rdfTasks.resetSearch()}v.tasks.resetSearch()});widget.body.empty();v.tasksView.render().inject(widget.body)},_initPreferencesWithConstants:function(){var O=p("hasDPJAccess");if(O!=="0"){var M=widget.getPreference("showProjectTasks");M.disabled="disabled";widget.addPreference(M)}var J=widget.getPreference("collabspace");J.label=o("emxCollaborativeTasks.Label.Credential");widget.addPreference(J);var N=widget.getPreference("collabstorage");N.label=o("emxFoundation.Widget.CollaborativeStorages");widget.addPreference(N);var P=widget.getPreference("showProjectTasks");P.label=o("emxCollaborativeTasks.Label.ShowProjectTasks");widget.addPreference(P);var K=widget.getPreference("emailNotify");K.label=o("emxCollaborativeTasks.Label.EmailNotify");widget.addPreference(K);var L=widget.getPreference("title");L.label=o("emxFoundation.Widget.WidgetTitle");widget.addPreference(L)},setSpace:function n(){var K=y.getContext().split(".");v.tasks.collabSpace=K[K.length-1];v._tasksServiceInitCalls();v.tasks.dispatchEvent("onChange:collabSpace",[v.tasks,v.tasks.collabSpace]);var J=this.spaceNames[enoviaServer.storageUrl];J&&r.processSecurityContextData(J)},clearData:function(){y.clearData.call(v)},loadBPS:function(){y.loadBPS.call(v,widget,enoviaServer.showSpace,"/resources/v2/e6w/service/TSK_WIDGET_CONSTANTS")},setTitlePref:Function.prototype,setRowPref:Function.prototype,processStorageChange:function(){y.processStorageChange.apply(v,arguments)},onAfterLoad:Function.prototype,_onSingleTaskFetchFail:function(){z.displayInfo(o("emxCollaborativeTasks.Info.TaskNotFound"))},_selectTaskByIdOnLoad:function(J){if(v.tasksView.getColumnAndCardIdxFromId(J)[1]===-1){v.tasksView.addEventOnce("afterColChanged",function(){v.tasksView.selectById(J)})}else{v.tasksView.selectById(J)}},_processSelectedIds:function(){var K;if(widget.getValue("id")||widget.getValue("ids")){K=widget.getValue("id")||widget.getValue("ids");var J=K.indexOf("?");if(J!==-1){K=K.substring(0,J)}}else{if(widget.getValue("X3DContentId")){K=this._getIdFromCompassSelect()}}if(K){v._selectedTaskId=K}},_getIdFromCompassSelect:function(){var K=["Task","Inbox Task","dsxplan:TaskVersion"];var J=JSON.parse(widget.getValue("X3DContentId"));var L=J.data.items[0];if(K.indexOf(L.objectType)!==-1){return L.objectId}else{z.initializeAlert(widget.body);z.displayWarning(x.getWidgetConstant("emxCollaborativeTasks.Warning.ObjectNotTask"));widget.deleteValue("X3DContentId");return undefined}}};v.onAfterLoad=v.setSpace;v.REFRESHTIMEOUT=0;v.document=document;v.checkVisibilityAPI();return v});