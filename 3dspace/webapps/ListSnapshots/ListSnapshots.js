define("DS/ListSnapshots/PropertyView",["UWA/Controls/Abstract","DS/UIKIT/Scroller"],function(c,a){var b=c.extend({init:function(d){this._parent();this.buildUI();this.count=0;this.currentRow=null},add:function(d){if(this.count%2==0){this.currentRow=this.addRow()}this.count++;var e=this.currentRow.addProperty(d);return e},buildUI:function(e){var d=new UWA.Element("table",{styles:{width:"100%",cursor:"default","white-space":"nowrap"}});this.elements.container=d;this.tbody=document.createElement("tbody");d.appendChild(this.tbody)},addRow:function(){var d=document.createElement("tr");this.tbody.appendChild(d);d.addCol=function(){var e=document.createElement("td");e.style.display="table-cell";e.style.verticalAlign="top";e.style.padding="5px";d.appendChild(e);e.addText=function(i,g){var h=document.createTextNode(i);if(g){var f=document.createElement("b");e.appendChild(f);f.appendChild(h)}else{e.appendChild(h)}h.setText=function(j){h.nodeValue=j};return h};return e};d.addProperty=function(g){var e=d.addCol();e.addText(g,true);var h=d.addCol();var f=h.addText("");h.setValue=function(i){f.setText(i)};return h};return d}});return b});define("DS/ListSnapshots/OpenInCatia",["UWA/Class","DS/i3DXCompassServices/i3DXCompassPubSub"],function(b,a){var c=b.singleton({init:function(){this._parent({})},collectAncestors:function(f,d){var e=f.getParent();while(e!=null){d.unshift(e);e=e.getParent()}},collectDescendents:function(g,d){var f=g.getChildren();var j=f.length;for(var e=0;e<j;e++){var h=f[e];d.push(h);this.collectDescendents(h,d)}},getNodesToOpen:function(d){var e=[];e.push(d);this.collectAncestors(d,e);this.collectDescendents(d,e);return e},getNodePhysicalIds:function(d){var j=[];var h=d.length;for(var f=0;f<h;f++){var g=d[f];var e=g.physicalId;if(j.indexOf(e)==-1){j.push(e)}}return j},getNodeOccIds:function(h){var d=[];var j=h.length;for(var e=0;e<j;e++){var f=h[e];var g=f.occId;if(d.indexOf(g)==-1){d.push(g)}}return d},convertToPartialOpenFormat:function(l,m){function d(v){var t,s;var w=v.occurrencerelationships.length;for(t=0;t<w;t++){var u=v.occurrencerelationships[t].parent;var r=v.occurrencerelationships[t].child;if(v.occurrences[u].children==undefined){v.occurrences[u].children=[]}v.occurrences[u].children.push(r);v.occurrences[r].parent=u;v.occurrences[r].parentrelationship=t}}function p(x,r,z,t){var u;for(u=0;u<z.length;u++){if(r==z[u]){t=true}}var v=false;if(x.occurrences[r].children){var u;for(u=0;u<x.occurrences[r].children.length;u++){var y=x.occurrences[r].children[u];var s=x.occurrences[y].parentrelationship;var w=p(x,y,z,t);if(w){x.occurrencerelationships[s].partialopen=true}v|=w}}t|=v;if(t){x.occurrences[r].partialopen=true;x.nodes[x.occurrences[r].nodeid].partialopen=true}return t}function e(x,u,r){var v=JSON.stringify(x.nodes[x.occurrences[r].nodeid].localid);u[v]={};if(x.occurrences[r].children){var t;for(t=0;t<x.occurrences[r].children.length;t++){var y=x.occurrences[r].children[t];var s=x.occurrences[y].parentrelationship;var w=JSON.stringify(x.occurrencerelationships[s].localid);var z=x.occurrences[y].partialopen;if(z){u[v][w]={};e(x,u[v][w],y)}}}}function f(y,x,t){if(!y.occurrences[t].partialopen){return false}if(x.localids==undefined){x.localids=0}var r=y.occurrences[t].nodeid;var v=y.nodes[r];if(v.localid==undefined){var s=JSON.parse('{"localid":"1","type":"","physicalid":""}');s.physicalid=v.physicalid;s.type=v.type;s.localid=JSON.stringify(x.localids);x.structures.references.push(s);v.localid=x.localids++}if(y.occurrences[t].children){var w;for(w=0;w<y.occurrences[t].children.length;w++){var u=y.occurrences[t].children[w];var z=y.occurrences[u].partialopen;if(z){f(y,x,u)}}}}function g(y,x,s){if(y.occurrences[s].children){var w;for(w=0;w<y.occurrences[s].children.length;w++){var t=y.occurrences[s].children[w];var z=y.occurrences[t];var v=z.parentrelationship;var u=y.occurrencerelationships[v];var A=z.partialopen;if(A){if(x.referencemap==undefined){x.referencemap={}}if(x.referencemap[u.physicalid]==undefined){x.referencemap[u.physicalid]=x.localids++;var r=JSON.parse('{"localid":"1","type":"","physicalid":"","IEF-UUID":""}');r.physicalid=u.physicalid;r["IEF-UUID"]=u["IEF-UUID"];r.localid=JSON.stringify(x.referencemap[u.physicalid]);r.type=u.relname;x.structures.connections.push(r)}u.localid=x.referencemap[u.physicalid];g(y,x,t)}}}}function q(u,t,r){var s='{"id": "1", "show": true, "children": []}';var v=JSON.parse(s);v.id=""+(1+parseInt(r));t.push(v);for(var w in u[r]){q(u[r],t[t.length-1].children,w)}}function j(u){var t='{"version": "2.0","results":[],"structures":[]}';var x=JSON.parse(t);var y='{"id":"1","phid":""}';var w;for(w=0;w<u.structures.references.length;w++){var v=JSON.parse(y);var s=u.structures.references[w];v.id=""+(1+parseInt(s.localid));v.phid=s.physicalid;v.type=s.type;x.results.push(v)}for(w=0;w<u.structures.connections.length;w++){var v=JSON.parse(y);var r=u.structures.connections[w];v.id=""+(1+parseInt(r.localid));v.phid=r.physicalid;v.type=r.type;v["IEF-UUID"]=r["IEF-UUID"];x.results.push(v)}var z=[];for(var A in u.structures.trees){x.structures.push(JSON.parse('{"structure":[]}'));q(u.structures.trees,x.structures[x.structures.length-1]["structure"],A)}return x}function k(s){var r=JSON.stringify(j(JSON.parse(s)));return r}var o='{"version":"1","structures":{"references":[{"localid":"0","type":"CATProduct","physicalid":"7C3E9B56BF090000D2D1CF5831DB0E00"},{"localid":"1","type":"CATPart","physicalid":"7C3E9B56BF090000D3D1CF58A8250C00"}],"connections":[{"localid":"2","type":"CAD SubComponent","physicalid":"7C3E9B56BF090000D4D1CF585F850700","IEF-UUID":"IDV1:d43f83c8_584_58cfd19a_139"}],"trees":{"0":{"2":{"1":{}}}}}}';var n='{"version":"2.0","results":[{"id":"1","phid":"7C3E9B56BF090000D2D1CF5831DB0E00","type":"CATProduct"},{"id":"2","phid":"7C3E9B56BF090000D3D1CF58A8250C00","type":"CATPart"},{"id":"3","phid":"7C3E9B56BF090000D4D1CF585F850700","type":"CAD SubComponent","IEF-UUID":"IDV1:d43f83c8_584_58cfd19a_139"}],"structures":[{"structure":[{"id":"1","show":true,"children":[{"id":"3","show":true,"children":[{"id":"2","show":true,"children":[]}]}]}]}]}';function i(){var r=JSON.stringify(JSON.parse(k(o)));if(n==r){return true}else{return false}}function h(u,w){var s,r;var v=JSON.parse('{"version":"1","structures":{"references":[],"connections":[],"trees":{}}}');var t=JSON.parse(JSON.stringify(u));d(t);p(t,0,w,false);f(t,v,0);g(t,v,0);delete v.localids;delete v.referencemap;e(t,v.structures.trees,0);v=j(v);return JSON.stringify(v)}return h(l,m)},launchCatia:function(){a.publish("launchApp",{appId:"ENOV5MA_AP"})},clearOpenInCatia:function(){a.publish("resetStructure")},prepareOpenOccsInCatia:function(e,d){var f=[e.rootoccurrence];if(d!=null){f=this.getNodeOccIds(d)}var g=this.convertToPartialOpenFormat(e,f);a.publish("setStructure",{structure:g})},prepareOpenInCatia:function(r,p){var q=[];var d=p.length;for(var j=0;j<d;j++){var g=this.getNodesToOpen(p[j]);q=q.concat(g)}var k=this.getNodePhysicalIds(q);var s=[];var e=k.length;for(var j=0;j<e;j++){var l=k[j];var f=false;if(r==l){f=true}var h={physicalid:l,isroot:f};s.push(h)}var o=JSON.stringify(s);a.publish("setStructure",{structure:o})}});return c});define("DS/ListSnapshots/CmdCtx",["UWA/Class"],function(a){var b=a.singleton({init:function(){this._parent({})},set:function(c){this.ctx=c},get:function(){return this.ctx}});return b});define("DS/ListSnapshots/CustomizeColumns",["UWA/Class","DS/LifecycleControls/ChooseAttributes","DS/LifecycleServices/LifecycleServices","i18n!DS/ListSnapshots/assets/nls/ListSnapshotsNls"],function(a,c,b,e){var d=a.singleton({init:function(){this._parent({});this.appId="ListSnapshotsCustomizeColumns";this.allAttributeNames=["revision","owner","description","policy","modified","originated","type","project","newTarget"];this.defaultCols=["revision","modified","newTarget"]},getAll:function(){return this.allAttributeNames},load:function(){var f=widget.getValue(this.appId);if(f==null){f=this.defaultCols;this.save(f)}return f},save:function(f){widget.setValue(this.appId,f)},getAttrDispName:function(f){var g=f;if(f=="newTarget"){g=e.newTarget}else{g=b.getAttributeDisplayName(f)}return g},customizeColumns:function(j,r){var p=this;var g=this.load();var l=[{name:"title",displayName:this.getAttrDispName("title"),isSelected:true,disabled:true}];var k=g.length;for(var o=0;o<k;o++){var s=g[o];var f=this.getAttrDispName(s);var q={name:s,displayName:f,isSelected:true};l.push(q)}var h=this.allAttributeNames.length;for(var o=0;o<h;o++){var s=this.allAttributeNames[o];var f=this.getAttrDispName(s);if(g.indexOf(s)==-1){var q={name:s,displayName:f,isSelected:false};l.push(q)}}c.showDialog({title:e.customizeColumns,parent:document.body,allAttributes:l,onShow:function(i){r(i)},onOk:function(t){var m=[];var v=t.length;for(var u=0;u<v;u++){if(t[u]=="title"){continue}m.push(t[u])}p.save(m);j(m)}})}});return d});define("DS/ListSnapshots/SuperModalEx",["DS/UIKIT/SuperModal","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","UWA/Class/Promise","i18n!DS/UIKIT/assets/nls/UIKIT","i18n!DS/ListSnapshots/assets/nls/ListSnapshotsNls","css!DS/ListSnapshots/assets/style/SuperModalEx.css"],function(a,c,b,e,g,f,d){var h=a.extend({init:function(i){this._parent(i)},promptRadioList:function(){var q=arguments,m=q[0],s=q[1],p=q[2],v=q[3],x=q[4],o=q[5],u,r=[],w=UWA.merge({visible:false,closable:true},this.options),k;function j(i){u.preventEvent=true;u.hide();if(UWA.is(v,"function")){v(i)}}if(UWA.is(q[0],"object")){m=q[0].message;s=q[0].title;p=q[0].fields;v=q[0].callback;x=q[0].okButtonText;o=q[0].koButtonText}w.events={onHide:function(){if(!u.preventEvent&&UWA.is(v,"function")){v()}},onShow:function(){k.getField("input_radio").focus()}};u=this.modalFactory(w);var l=[];for(var n=0;n<p.length;n++){var t=false;if(n==0){t=true}l.push({type:"radio",checked:t,name:"input_radio",value:p[n].value,label:p[n].label})}k=new c({fields:l,events:{onSubmit:function(i){var y=i.input_radio;j(y)}}});this.form=k;if(UWA.is(m,"string")){u.elements.body.addContent({tag:"p",text:m},k)}else{u.elements.body.addContent(m,k)}if(UWA.is(s,"string")){u.setHeader({tag:"h4",text:s})}else{u.getHeader().hide();if(!v){v=s}}if(!UWA.is(v,"function")&&this.options.callback){v=this.options.callback}r.push(new b({value:x||w.okButtonText,className:"primary"}));r[0].addEvent("onClick",function(){k.submit()});r.push(new b({value:o||w.koButtonText}));r[1].addEvent("onClick",function(){j(null)});u.setFooter(r);u.dispatchEvent("onShowModal")},promptSelectList:function(){var V=this;var ai=true;var l=null;var af=arguments,Z=af[0],O=af[1],ab=af[2],k=af[3],s=af[4],y=af[5],ac=af[6],X=af[7],F=af[8],u=af[9],B,M=[],J=UWA.merge({visible:false,closable:true},this.options),T;widget.addEvent("CREATIONDONE",function(){var i=d.CreateButton;M[0].load(false,i)});function U(an,ap,ao,i){B.preventEvent=true;if(ai){B.hide()}ai=true;if(UWA.is(X,"function")){X(an,ap,ao,i)}}function E(){B.hide()}function m(){T.submit()}function aa(aq){var ao=null;var ap=JSON.parse(ab);Object.keys(ap).forEach(function(ar){if(ap[ar].hasOwnProperty("DSType")){ao=ar}});var an=aq.getTextInput("input_title");var i=an.getValue();L(aq).then(function(ar){return ar}).then(function(ar){if(ar&&typeof ar.getInvalidCharInTitle==="function"){ar.getInvalidCharInTitle(ao).then(function(at){return at}).then(function(aA){var az=new RegExp(aA);var aB=i.match(az);var ay=aq.getField("input_title");var au=ay.getParent();if(aB==null){au.getParent(".form-group").removeClassName("has-error")}else{var av;var aw=null;var ax;for(ax=0;ax<aB.length;ax++){if(av===undefined){av=aB[ax]}else{if(!av.includes(aB[ax])){av+=aB[ax]}}}var at=av.split("");if(at!==undefined){aw=d.get("Unsupported_char",{"char":at})}if(aw!=null){if(au!=null){au.lastChild.textContent=aw;au.getParent(".form-group").addClassName("has-error")}}}})["catch"](function(at){var au=aq.getField("input_title");var av=au.getParent();av.getParent(".form-group").removeClassName("has-error")})}})["catch"](function(ar){var at=aq.getField("input_title");var au=at.getParent();au.getParent(".form-group").removeClassName("has-error")})}function N(ap){var an=ap.getValue("input_select");var au=ap.getTextInput("input_filename");var ao=ap.getField("input_filename");var at=ao.getParent().getParent();if(s){if(an=="V6"){at.hide();V.showfilename=false}else{if((y!=null)&&(an!=null)){var aq=an;aq=aq.substring(0,5);var i=JSON.parse(y);var ar=false;Object.keys(i).forEach(function(aw){if(aq==aw){if(i[aw].hasOwnProperty("filenameStatus")){var av=i[aw].filenameStatus;if(av=="TRUE"){ar=true}}}})}if(ar){at.show();V.showfilename=true}else{at.hide();V.showfilename=false}}}else{at.hide()}}function j(ao){var an=false;var i=ao.getValue("input_select");if(i=="V5"||(i.indexOf("UPSV5")!==-1)){an=true}return an}function ae(ao){var i;var an=ao.getValue("input_select");if(an=="V5"||(an.indexOf("UPSV5")!==-1)){i="CATIAV5"}else{if((an.indexOf("UPSSW")!==-1)){i="SOLIDWORKS"}else{if((an.indexOf("UPSCR")!==-1)){i="CREO"}else{if((an.indexOf("UPSNX")!==-1)){i="NX"}else{if((an.indexOf("UPSNX")!==-1)){i="NX"}else{if((an.indexOf("UPSIV")!==-1)){i="INVENTOR"}else{if((an.indexOf("UPSAD")!==-1)){i="AUTOCAD"}}}}}}}return i}function z(i){return new g(function(ap,ao){if(j(i)){var an=ae(i);require(["DS/LifecycleServices/LifecycleServicesSettings"],function(aq){aq.getCADvalidityService(an).then(function(ar){ap(ar)})["catch"](function(ar){ao(ar)})})}else{ao(null)}})}function L(i){return new g(function(ap,ao){var an=ae(i);require(["DS/LifecycleServices/LifecycleServicesSettings"],function(aq){aq.getCADvalidityService(an).then(function(ar){ap(ar)})["catch"](function(ar){ao(ar)})})})}function S(an,i){I(an,function ao(ap){al(an,function aq(ar){var at=ap&&ar;i(at)})})}function I(an,i){L(an).then(function(ao){return ao}).then(function(ao){if(ao&&typeof ao.checktitleValidity==="function"){var aq;var ap=an.getValue("input_title");var ar=JSON.parse(ab);Object.keys(ar).forEach(function(av){if(ar[av].hasOwnProperty("DSType")){aq=av}});ao.checktitleValidity(aq,ap).then(function(ay){var av=an.getField("input_title");var ax=av.getParent();if(ax!=null){ax.getParent(".form-group").removeClassName("has-error")}ax.lastChild.textContent="";var aw=true;i(aw)})["catch"](function(av){var aw=an.getField("input_title");var ay=aw.getParent();if(ay!=null){ay.lastChild.textContent=av;ay.getParent(".form-group").addClassName("has-error")}var ax=false;aw.focus();i(ax)})}else{au.lastChild.textContent="";var au=titlefield.getParent();if(au!=null){au.getParent(".form-group").removeClassName("has-error")}var at=true;i(at)}})["catch"](function(ao){var ap=an.getField("input_title");var ar=ap.getParent();if(ar!=null){ar.getParent(".form-group").removeClassName("has-error")}ar.lastChild.textContent="";var aq=true;i(aq)})}function al(ao,an){var i=ao.getValue("input_title");var ap=ao.getValue("input_filename");if(i!=ap){V.modifyfilename=false}z(ao).then(function(aq){if(aq&&typeof aq.checkfilenameValidity==="function"){aq.checkfilenameValidity(ap,function(av){var aw=ao.getField("input_filename");var ay=aw.getParent();if(av!=null){if(ay!=null){V.filenamevalidated=false;var ax=false;ay.lastChild.textContent=av;aw.getParent(".form-group").addClassName("has-error");aw.focus();an(ax)}}else{if(ay!=null){V.filenamevalidated=true;var ax=true;aw.getParent(".form-group").removeClassName("has-error");ay.lastChild.textContent="";aw.focus();an(ax)}}})}else{var ar=ao.getField("input_filename");var au=ar.getParent();ar.getParent(".form-group").removeClassName("has-error");au.lastChild.textContent="";var at=true;an(at)}})["catch"](function(ar){var aq=ao.getField("input_filename");var au=aq.getParent();aq.getParent(".form-group").removeClassName("has-error");au.lastChild.textContent="";var at=true;an(at)})}if(UWA.is(af[0],"object")){Z=af[0].message;O=af[0].title;k=af[0].fields;X=af[0].callback;F=af[0].okButtonText;u=af[0].koButtonText}J.events={onHide:function(){if(!B.preventEvent&&UWA.is(X,"function")){X()}},onShow:function(){T.getField("input_select").focus()}};var x=localStorage.getItem("CADOriginPSECreate");var D=x;if((D!==null)&&(D!=="V6")){D=D.substring(0,5)}var W=[];var o=false;for(var ah=0;ah<k.length;ah++){var w="background-image: url("+k[ah].icon+");background-repeat: no-repeat;background-position-y: center;white-space: pre;background-size: 20px;background-origin: content-box;";var am=k[ah].value;if(am.startsWith(D)&&!o){var Q={label:k[ah].label,value:k[ah].value,attributes:{style:w},group:k[ah].Connector,selected:true};W.push(Q);o=true}else{var Q={label:k[ah].label,value:k[ah].value,attributes:{style:w},group:k[ah].Connector};W.push(Q)}}var P=[];if(ab!=null){var n=localStorage.getItem("ProductTypePSECreate");var q=false;var ad=JSON.parse(ab);Object.keys(ad).forEach(function(an){q=false;if(n===null){if(ad[an].hasOwnProperty("DSType")){q=true}}if(n===an){q=true}var i={label:ad[an].nlsname,value:an,selected:q};P.push(i)})}P.sort(function(an,i){var ap=an.label.toLowerCase();var ao=i.label.toLowerCase();var aq=ap.localeCompare(ao);return aq});B=this.modalFactory(J);var aj=d.Template;var K=d.Title;var ag=d.Filename;var r=d.Type;var Y="TitlePlaceHolder";var C=d.TitlePlaceHolder;var H=d.FilenamePlaceHolder;var p=[];V.modifyfilename=true;V.filenamevalidated=true;if(x=="V6"){V.showfilename=false}if(!s){V.showfilename=false}if(P.length>1){p.push({type:"select",name:"input_types",label:r,options:P,})}p.push({type:"text",name:"input_title",placeholder:C,maxlength:100,label:K,errorText:"title not correct",events:{onKeyDown:function(i){if(i.keyCode===13){setTimeout(function(){S(T,function an(ao){if((ao==true)||(V.showfilename==false)){m()}})})}}}});p.push({type:"select",name:"input_select",label:aj,options:W,events:{onChange:function(an){var i=this;if(s){N(T)}I(T,function ao(ap){})},}});p.push({type:"text",name:"input_filename",placeholder:H,label:ag,errorText:"filename not correct",events:{onChange:function(an){if(V.modifyfilename===true){var i=T.getValue("input_title");var ao=T.getValue("input_filename");if(i!=ao){V.modifyfilename=false}}},}});T=new c({className:"horizontal",fields:p,grid:"3 9",events:{onSubmit:function(an){var aq=an.input_title;var ap=an.input_select;var i=an.input_filename;var ao=an.input_types;localStorage.setItem("CADOriginPSECreate",ap);localStorage.setItem("ProductTypePSECreate",ao);U(ao,aq,ap,i)},}});this.form=T;var R={input:function(){setTimeout(function(){var i=T.getTextInput("input_title");var ao=T.getTextInput("input_filename");if(i.elements.input){var an=i.getValue();aa(T);if(V.modifyfilename){V.form.setValue("input_filename",an)}}})}};var A=T.getTextInput("input_title");A.elements.input.addEvents(R);if(!V.showfilename){N(T)}I(T,function G(i){});B.elements.body.addContent(T);if(UWA.is(O,"string")){B.setHeader({tag:"h4",text:O})}else{B.getHeader().hide();if(!X){X=O}}if(!UWA.is(X,"function")&&this.options.callback){X=this.options.callback}var t=d.CreateButton;var v=d.CreateCloseButton;var ak=d.CloseButton;M.push(new b({value:F||t}));M[0].addEvent("onClick",function(){S(T,function i(ao){if((ao==true)||(V.showfilename==false)){var an=d.CreatingButton;if(M.length&&M[0]!=null){M[0].load(true,an)}ai=false;T.submit()}})});M.push(new b({value:F||v,className:"primary"}));M[1].addEvent("onClick",function(){S(T,function i(an){if((an==true)||(V.showfilename==false)){ai=true;T.submit()}})});M.push(new b({value:u||ak}));M[2].addEvent("onClick",function(){ai=true;U(null)});if(ac){M[0].hide()}B.setFooter(M);B.dispatchEvent("onShowModal")}});return h});define("DS/ListSnapshots/RestoreInputJson",["UWA/Class","DS/LifecycleServices/AssemblyJson"],function(b,c){var a=b.singleton({init:function(){this._parent({})},build:function(e,d,f){return this.buildJson(e,d,f)},getSelectedNode:function(f,k){var d=f.nodeid;var j=k.length;for(var e=0;e<j;e++){var g=k[e];var h=g.nodeId;if(d==h){return g}}return null},buildJsonNodes:function(s,p,l){var k=new c.Assembly(s);var v=[];var u=s.nodes.length;for(var z=0;z<u;z++){var y=s.nodes[z];var j=y.nodeid;var q=c.getNodePhysicalId(s,j);var t="false";var m=c.getNodeAttributeValues(s,j,["type","Title","revision"]);var e=m[0];var E=m[1];var B=m[2];var x="";var o="";var h="";var D="";var A=this.getSelectedNode(y,l);if(A!=null){t="true";var f=p.getNodeFromPhysicalId(q);var C=f.getTargetFromIter(A.newTarget);x=C.getIter();o=C.getIterseries();h=C.getIterseriesInfo();if(x=="NEW"){var g=k.getNodeByPhysicalId(q);var r=g.getAttribute("name");var d=Date.now().toString();D=r+"-restore-"+d}}var w={id:q,selected:t,type:e,name:E,rev:B,target_iter:x,target_iterseries:o,target_iterseries_info:h,target_name:D};v.push(w)}return v},buildJsonStructure:function(f,k,j){var g=[];var h=f.occurrencerelationships;var d=h.length;for(var e=0;e<d;e++){var m=h[e];var l={parent:m.parentid,child:m.childid,relid:m.physicalid,relname:m.relname,projected:m.projected};g.push(l)}return g},buildJson:function(f,e,h){var d=c.getRootPhysicalId(f);var g={rootid:d,nodes:null,structure:null};g.nodes=this.buildJsonNodes(f,e,h);g.structure=this.buildJsonStructure(f,e,h);return g}});return a});define("DS/ListSnapshots/TableView",["UWA/Controls/Abstract"],function(f){var c="#fff";var b="#f4f5f6";var a=c;var e=b;var d=f.extend({init:function(g){this.rowHeight=20;this.addingOddRow=true;this.darkGrey="#e2e4e3";this.grey="#f4f5f6";this.white="#fff";this.black="#000";this.selectColor="#d5e8f2";this.onselectchange=null;this.header=g;this.selectedRows=[];this._parent();this.buildUI(g)},buildUI:function(h){this.elements.container=new UWA.Element("div",{styles:{position:"absolute",height:"100%",width:"100%",overflow:"auto"}});var g=new UWA.Element("table",{styles:{width:"100%",cursor:"default"}});g.inject(this.elements.container);g.onselectstart=function(i){i.preventDefault()};this.tbody=document.createElement("tbody");g.appendChild(this.tbody);this.addHeader(h)},clear:function(){while(this.tbody.firstChild){this.tbody.removeChild(this.tbody.firstChild)}this.addHeader(this.header);this.selectedRows=[]},deleteSelectedRows:function(){var h=this.getSelectedRows();for(var g=0;g<h.length;g++){var j=h[g];j.del()}this.selectedRows=[]},addRow:function(i){var g=this;var h=this.add(i,this.darkGrey);h.del=function(){if(h.selected){h.deselect()}h.parentNode.removeChild(h)},h.setBackgroundColor=function(j){h.bgcolor=j;h.updateColor()};h.select=function(){h.sel();h.notifySelectChange()};h.deselect=function(){h.desel();h.notifySelectChange()};h.onclick=function(j){if(!j.ctrlKey&&!j.shiftKey){g.clearSelect()}if(!h.selected){h.sel()}else{h.desel()}h.notifySelectChange()};h.updateColor=function(){if(h.selected){h.style.backgroundColor=g.selectColor}else{h.style.backgroundColor=h.bgcolor}};h.sel=function(){h.selected=true;h.updateColor();g.selectedRows.push(h)};h.desel=function(){h.selected=false;h.updateColor();var j=g.selectedRows.indexOf(h);if(j>-1){g.selectedRows.splice(j,1)}};h.notifySelectChange=function(){if(g.onselectchange!=null){var j=g.getSelectedRows();g.onselectchange(j)}};h.selected=false;if(this.addingOddRow){h.setBackgroundColor(a)}else{h.setBackgroundColor(e)}h.updateColor();this.addingOddRow=!this.addingOddRow;return h},clearSelect:function(){var h=this.getSelectedRows();h=h.slice(0);for(var g=0;g<h.length;g++){h[g].desel()}},getRowByObj:function(j){var h=this.getRows();var l=h.length;for(var g=0;g<l;g++){var k=h[g];if(k.obj==j){return k}}return null},getRows:function(){var g=this.tbody.getElementsByTagName("tr");return g},getSelectedRows:function(){return this.selectedRows},addHeader:function(o){var h=document.createElement("tr");this.tbody.appendChild(h);var m=o.length;for(var g=0;g<m;g++){var l=document.createElement("td");l.style.height=this.rowHeight+"px";l.style.border="0 solid "+this.white;if(g>0){l.style.borderLeftWidth="1px"}l.style.borderBottomWidth="1px";l.style.padding="5px 8px 5px 8px";h.appendChild(l);var k=document.createElement("div");k.style.top="0px";l.appendChild(k);var j=document.createTextNode(o[g]);k.appendChild(j)}h.style.backgroundColor=this.darkGrey;h.style.fontWeight="bold"},add:function(t,l){var r=document.createElement("tr");this.tbody.appendChild(r);var k=t.length;for(var p=0;p<k;p++){var m=document.createElement("td");m.style.height=this.rowHeight+"px";m.style.border="0 solid "+l;if(p>0){m.style.borderLeftWidth="1px"}m.style.borderBottomWidth="1px";m.style.padding="5px 8px 5px 8px";r.appendChild(m);var h=t[p];var g=h.split("\n");for(var o=0;o<g.length;o++){if(o>0){m.appendChild(document.createElement("br"))}var q=g[o];var s=document.createTextNode(q);m.appendChild(s)}}return r}});return d});define("DS/ListSnapshots/Table",["UWA/Controls/Abstract"],function(b){var a=b.extend({init:function(){this._parent();this.buildUI()},addRow:function(){var c=document.createElement("tr");this.tbody.appendChild(c);c.addCol=function(){var d=document.createElement("td");c.appendChild(d);return d};return c},setHeight:function(c){this.elements.container.setStyle("height",c)},buildUI:function(c){this.elements.container=new UWA.Element("table",{styles:{width:"100%",height:"100%",cursor:"default"}});this.tbody=document.createElement("tbody");this.elements.container.appendChild(this.tbody)}});return a});define("DS/ListSnapshots/NewTargetsJson",["UWA/Class","DS/LifecycleServices/LifecycleServicesSettings"],function(a,c){var b=a.extend({init:function(e){this._parent({});this.json=e;var d=c.getCurrentFolderID();if((d!=null&&c.getEnforceFolderLinkSetting())||!c.getEnforceFolderLinkSetting()){this.addNewObjectTarget(this.json)}},addNewObjectTarget:function(f){var h=f.nodes.length;for(var e=0;e<h;e++){var g=f.nodes[e];var d={target_iter:"NEW",target_iterseries:"",target_iterseries_info:""};g.targets.push(d)}},getNodeFromPhysicalId:function(d){var g=this.json.nodes.length;for(var e=0;e<g;e++){var f=this.getNode(e);if(f.id==d){return f}}return null},getNode:function(d){var e=this.json.nodes[d];e.getTarget=function(f){var g=e.constructTarget(e.targets[f]);return g};e.getTargetFromIter=function(f){var j=e.targets.length;for(var h=0;h<j;h++){var g=e.targets[h];if(g.target_iter==f){return e.constructTarget(g)}}};e.constructTarget=function(f){var g=f;if(g!=null){g.getIter=function(){return g.target_iter};g.getIterseries=function(){return g.target_iterseries};g.getIterseriesInfo=function(){return g.target_iterseries_info}}return g};e.getTargetCount=function(){return e.targets.length};e.getPhysicalId=function(){return e.id};e.sortTargets=function(){var g=e.getCurrentRevTargetIndex();if(g==-1){g=e.getNewRevTargetIndex()}if(g==-1){g=0}var f=e.targets.slice();e.targets=[];e.targets.push(f[g]);var j=f.length;for(var h=0;h<j;h++){if(h!=g){e.targets.push(f[h])}}};e.getCurrentRevTargetIndex=function(){return e.getRevTargetIndex("current")};e.getNewRevTargetIndex=function(){return e.getRevTargetIndex("new")};e.getRevTargetIndex=function(g){var k=e.targets.length;for(var f=0;f<k;f++){var h=e.getTarget(f);var j=h.getIterseries();if(j==g){return f}}return -1};e.sortTargets();return e},getCount:function(){return this.json.nodes.length}});return b});define("DS/ListSnapshots/SearchOptionsDialog",["UWA/Controls/Abstract","DS/UIKIT/SuperModal","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/LifecycleControls/assets/styles/LifecycleModals"],function(e,a,b,c){var d=e.extend({init:function(h,f,g){this._parent(g)},showDialog:function(g,f){var i=new a({closable:true,renderTo:g,className:"Lifecycle_Modals"});var j="Options";i.dialog({body:"",title:j,buttons:[{value:"foo",action:function(k){k.hide()}},{value:"bar",action:function(k){k.hide()}}]});if(i&&i.modals&&i.modals.current&&i.modals.current.elements){var h=(i.modals.current.elements.header)?i.modals.current.elements.header.getElement(".close.fonticon.fonticon-cancel"):null;if(h){h.setText("\u00D7");h.removeClassName("fonticon");h.removeClassName("fonticon-cancel");h.setAttributes({title:b.close})}if(i.modals.current.elements.closeTooltip&&i.modals.current.elements.closeTooltip.elements){i.modals.current.elements.closeTooltip.elements.container.addClassName("hideDefaultTooltip")}}}});return d});define("DS/ListSnapshots/WebServices",["UWA/Class","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/AssemblyJson","DS/ListSnapshots/NewTargetsJson"],function(a,f,c,b,e){var d=a.singleton({init:function(){this._parent({})},getSnapshotAssembly:function(n,h,i,k){var l=this;var o="/resources/iteration/snapshot/expand";var l=this;var j=["Title","name","revision","owner","description","policy","modified","originated.generic","type","vault","project","islast","current","MCADInteg-SourceObj"];c.post(n,o,{baselineId:h,attributes:j},function m(u){var v=u.results;var x=v;l.formatOriginatedDate(x);l.removePrivateNodes(x);var p=x.occurrences.length;for(var w=0;w<p;w++){var t=x.occurrences[w];var q=parseFloat(t.TreeOrder);var r=x.occurrencerelationships.length;for(var s=0;s<r;s++){var y=x.occurrencerelationships[s];if(y.child==t.occurrenceid){y.treeOrder=q}}}x.occurrencerelationships.sort(function(A,z){return(A.treeOrder-z.treeOrder)});i(x)},function g(p){k(p)})},formatOriginatedDate:function(g){var l=g.nodes.length;for(var h=0;h<l;h++){var j=g.nodes[h];var k=j.attributes["originated.generic"];j.attributes.originated=k}},getRestoreNewTargets:function(t,l,m,p){var j=[];var g=b.getAllNodePhysicalIds(l);var k=g.length;for(var o=0;o<k;o++){j.push({id:g[o]})}var s={nodes:j};var u="/resources/iteration/snapshot/restoreTargets";var q=this;c.post(t,u,s,function r(v){if(v.results.status=="success"){var i=q.createNewTargetJson(v.results);m(i)}else{var n=v.results.Message;if(n==null){n=v.results.message}p(n)}},function h(i){p(i)})},createNewTargetJson:function(g){return new e(g)},restoreSnapshot:function(m,g,k,i){var h=this;var j="/resources/iteration/snapshot/restore";c.post(m,j,g,function l(q){var o=q.results;if(o.status=="success"){k(q)}else{var p=o.Message;if(p==null){p=o.message}if(p==null){p=""}i(p)}},function n(o){i(o)})},listAllSnapshotsCreatedByCurrentUser:function(i,h){var g="listOwner";var j=null;this.listSnapshots(j,"",g,i,h)},listSnapshotsOfObject:function(k,g,j,i){var h="listRoot";this.listSnapshots(k,g,h,j,i)},listSnapshotsContainingObject:function(k,g,j,i){var h="listRevision";this.listSnapshots(k,g,h,j,i)},listSnapshotsContainingAnyRevOfObject:function(k,g,j,i){var h="listAllRevisions";this.listSnapshots(k,g,h,j,i)},deleteSnapshots:function(m,i,h,j){var n=i[0].id;var o="/resources/iteration/snapshot/delete";var k=this;c.get(m,o,{objectId:n},function l(r){var p=r.results;if(p.status=="success"){h()}else{var q=p.Message;if(q==null){q=p.message}j(q)}},function g(p){j(p)})},deleteSnapshot:function(m,g,k,i){var j="/resources/iteration/snapshot/delete";var h=this;c.get(m,j,{objectId:g},function l(q){var o=q.results;if(o.status=="success"){k()}else{var p=o.Message;if(p==null){p=o.message}i(p)}},function n(o){i(o)})},getSampleSnapshots:function(){var h=null;var g=[];g.push({id:"1",title:"Snapshot 1",owner:"Christopher Ryan",created:"05/04/2015 4:12 PM",thumbnailUrl:h,description:"Suspendisse et augue purus. Morbi rutrum nec elit a mollis...",components:66,history:"7 changed since last snapshot"});g.push({id:"2",title:"Snapshot 2",owner:"Christopher Ryan",created:"05/04/2015 4:12 PM",thumbnailUrl:h,description:"Suspendisse et augue purus. Morbi rutrum nec elit a mollis...",components:67,history:"8 changed since last snapshot"});g.push({id:"3",title:"Snapshot 2",owner:"Christopher Ryan",created:"05/04/2015 4:12 PM",thumbnailUrl:h,description:"Suspendisse et augue purus. Morbi rutrum nec elit a mollis...",components:68,history:"9 changed since last snapshot"});return g},getSnapshot:function(g){var h={title:g[0],owner:g[1],date:g[2],desc:g[3]};return h},getUrl:function(h){var i=null;var g=f.get3DSpaceWSUrl(i,h,null);return g},buildSnapshots:function(k){var l=[];var o=k.length;for(var j=0;j<o;j++){var g=k[j];var h={id:g.physicalid,title:g.name,owner:g.owner,originated:g.originated,description:g.description,components:g.components,history:g.history};if(h.components==null){h.components=""}if(h.history==null){h.history=""}var m=null;h.thumbnailUrl=m;l.push(h)}return l},getTestList:function(){var g=[{id:123,name:"",originated:""}];return g},getTestAssembly:function(){var g={uicontroltype:"piecewisecgrviewer",version:2,rootoccurrence:0,nodes:[{nodeid:0,physicalid:"0",Title:"Car 0",mod:"5:00PM 3/13/2015",type:"CATProduct",cgrurl:"",attributes:{}},{nodeid:1,physicalid:"1",Title:"Axel 1",mod:"5:00PM 3/13/2015",type:"CATProduct",cgrurl:"",attributes:{}},{nodeid:2,physicalid:"2",Title:"Wheel 2",mod:"5:00PM 3/13/2015",type:"CATProduct",cgrurl:"",attributes:{}},{nodeid:3,physicalid:"3",Title:"Bolt 3",mod:"5:00PM 3/13/2015",type:"CATPart",cgrurl:"wheel.cgr",attributes:{}}],occurrences:[{occurrenceid:0,nodeid:0,xform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},{occurrenceid:1,nodeid:1,xform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},{occurrenceid:2,nodeid:2,xform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},{occurrenceid:3,nodeid:3,xform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},{occurrenceid:4,nodeid:3,xform:[1,0,0,0,0,1,0,0,0,0,1,0,10000,0,0,1]},{occurrenceid:5,nodeid:2,xform:[1,0,0,0,0,1,0,0,0,0,1,0,0,10000,0,1]},{occurrenceid:6,nodeid:3,xform:[1,0,0,0,0,1,0,0,0,0,1,0,0,10000,0,1]},{occurrenceid:7,nodeid:3,xform:[1,0,0,0,0,1,0,0,0,0,1,0,10000,10000,0,1]},{occurrenceid:8,nodeid:1,xform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,10000,1]},{occurrenceid:9,nodeid:2,xform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,10000,1]},{occurrenceid:10,nodeid:3,xform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,10000,1]},{occurrenceid:11,nodeid:3,xform:[1,0,0,0,0,1,0,0,0,0,1,0,10000,0,10000,1]},{occurrenceid:12,nodeid:2,xform:[1,0,0,0,0,1,0,0,0,0,1,0,0,10000,10000,1]},{occurrenceid:13,nodeid:3,xform:[1,0,0,0,0,1,0,0,0,0,1,0,0,10000,10000,1]},{occurrenceid:14,nodeid:3,xform:[1,0,0,0,0,1,0,0,0,0,1,0,10000,10000,10000,1]}],occurrencerelationships:[{parent:0,child:1},{parent:1,child:2},{parent:2,child:3},{parent:2,child:4},{parent:1,child:5},{parent:5,child:6},{parent:5,child:7},{parent:0,child:8},{parent:8,child:9},{parent:9,child:10},{parent:9,child:11},{parent:8,child:12},{parent:12,child:13},{parent:12,child:14}]};return g},removePrivateNodes:function(g){function k(o,p,n){var m=o.occurrencerelationships[p].parent;var q=o.occurrencerelationships[p].child;if(o.occurrences[q].nodeid==n){return true}while(true){if(o.occurrences[m].nodeid==n){return true}if(m==0){return false}var l;for(l=0;l<o.occurrencerelationships.length;l++){if(o.occurrencerelationships[l].child==m){m=o.occurrencerelationships[l].parent}}}return false}function j(v,x){var r,q;for(r=v.occurrencerelationships.length-1;r>=0;r--){v.occurrencerelationships[r]["delete"]=true}for(r=v.occurrences.length-1;r>=0;r--){v.occurrences[r]["delete"]=true}for(r=v.nodes.length-1;r>=0;r--){v.nodes[r]["delete"]=true}v.nodes[v.occurrences[0].nodeid]["delete"]=false;v.occurrences[0]["delete"]=false;for(r=v.occurrencerelationships.length-1;r>=0;r--){if(k(v,r,x)!=true){v.occurrencerelationships[r]["delete"]=false;var p=v.occurrencerelationships[r].child;var w=v.occurrences[p].nodeid;var o=v.occurrencerelationships[r].parent;var m=v.occurrences[o].nodeid;v.occurrences[p]["delete"]=false;v.occurrences[o]["delete"]=false;v.nodes[w]["delete"]=false;v.nodes[m]["delete"]=false}}for(r=v.occurrencerelationships.length-1;r>=0;r--){if(v.occurrencerelationships[r]["delete"]==true){v.occurrencerelationships.splice(r,1)}else{delete v.occurrencerelationships[r]["delete"]}}for(r=v.occurrences.length-1;r>=0;r--){if(v.occurrences[r]["delete"]==true){v.occurrences.splice(r,1)}else{delete v.occurrences[r]["delete"]}}for(r=v.nodes.length-1;r>=0;r--){if(v.nodes[r]["delete"]==true){v.nodes.splice(r,1)}else{delete v.nodes[r]["delete"]}}var u=1000000;for(r=v.nodes.length-1;r>=0;r--){var l=v.nodes[r].nodeid;var n=r;if(l!=n){v.nodes[r].nodeid=n;for(q=v.occurrences.length-1;q>=0;q--){if(v.occurrences[q].nodeid==l){v.occurrences[q].nodeid=n+u}}}}for(q=v.occurrences.length-1;q>=0;q--){if(v.occurrences[q].nodeid>=u){v.occurrences[q].nodeid-=u}}for(r=v.occurrences.length-1;r>=0;r--){var t=v.occurrences[r].occurrenceid;var s=r;if(t!=s){v.occurrences[r].occurrenceid=s;for(q=v.occurrencerelationships.length-1;q>=0;q--){if(v.occurrencerelationships[q].parent==t){v.occurrencerelationships[q].parent=s+u}if(v.occurrencerelationships[q].child==t){v.occurrencerelationships[q].child=s+u}}}}for(q=v.occurrencerelationships.length-1;q>=0;q--){if(v.occurrencerelationships[q].parent>=u){v.occurrencerelationships[q].parent-=u}if(v.occurrencerelationships[q].child>=u){v.occurrencerelationships[q].child-=u}}}function h(m){var l;for(l=0;l<m.nodes.length;l++){if(m.nodes[l]["isaccessible"]=="false"){return l}}return -1}function i(l){while(h(l)!=-1){var m;m=l.nodes.length;j(l,h(l));if(l.nodes.length>=m){break}}}if(g.accessComplete!="false"){return}i(g)},listSnapshots:function(n,j,m,g,i){var o="/resources/iteration/snapshot/list";var k=this;c.get(n,o,{objectId:j,listType:m},function l(s){var p=s.results;if(p.status=="success"){var r=p.baselines;g(r)}else{var q=p.Message;if(q==null){q=p.message}i(q)}},function h(p){i(p)})}});return d});define("DS/ListSnapshots/DetailsPanel",["UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","UWA/Core","DS/Tree/TreeListView","DS/ListSnapshots/PropertyView","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleControls/AssemblyTreeList","DS/ListSnapshots/WebServices","DS/LifecycleServices/AssemblyJson","DS/ListSnapshots/RestoreInputJson","DS/PADUtils/views/PADAlert","DS/ListSnapshots/OpenInCatia","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/Refresh","DS/UIKIT/Mask","DS/ListSnapshots/CustomizeColumns","DS/Core/Events","DS/PADUtils/PADUtilsServices","i18n!DS/ListSnapshots/assets/nls/ListSnapshotsNls","css!DS/ListSnapshots/ListSnapshots.css"],function(t,b,e,g,s,v,h,x,l,r,w,d,a,u,c,p,m,j,k,i){var q=40;var o=110;var n="#e2e4e3";var f=t.extend({init:function(y){this.snapshotsWidget=y;this._parent({});this.buildUI()},onDataLoaded:function(){var z=this.snapshot;var D=z.thumbnailUrl;if(D==null||D==""){D="/snresources/images/icons/large/I_DECAsmCV5108x144.png";D=v.get3DSpaceWSUrl(this.tenant,D)}this.snapshotThumbnail.src=D;this.snapshotTitle.setValue(z.title);this.snapshotResponsible.setValue(z.owner);var y=a.formatDate(z.creationDate,true);this.snapshotOriginated.setValue(y);var B=z.components;if(B==null){var E=l.getNodeCount(this.snapshotAssembly);B=E.toString()}this.snapshotComponents.setValue(B);var C=z.history;if(C==null){C=""}this.snapshotDescription.setValue(z.description);this.customTreeCols=p.load();this.updateTree();this.snapshotsWidget.disableRestoreCmd();this.snapshotsWidget.disableOpenInCatiaCmd();c.unmask(this.elements.container);if(this.snapshotAssembly.accessComplete=="false"){this.snapshotsWidget.disableRestoreCmd();var A=[];this.tree.disableNodesByType(A);w.displayNotification({eventID:"warning",msg:k.hasPrivateParts})}this.parent.dispatchEvent("onDetailsPanelShown")},setData:function(C,y){c.mask(this.elements.container);this.tenant=C;var A=this;A.treeTargetNodes=[];this.snapshot=y;this.snapshotId=y.id;x.getSnapshotAssembly(this.tenant,this.snapshotId,function B(D){A.snapshotAssembly=D;x.getRestoreNewTargets(A.tenant,D,function F(G){A.newTargetsJson=G;A.treeTargetNodes=A.getTreeTargetNodes(G);A.onDataLoaded()},function E(G){var H=k.getNewTargetsFail;H+=" "+G;w.displayNotification({eventID:"warning",msg:H});console.log(H);A.onDataLoaded()})},function z(D){var E=k.expandFail;E+=" "+D;w.displayNotification({eventID:"warning",msg:E});console.log(E)})},slideIn:function(){this.snapshotsWidget.slideIn(this.elements.container)},onBack:function(y){this.onBackCallback=y},slideOut:function(){if(this.onBackCallback!=null){this.clearOpenInCatia();this.onBackCallback()}},getCheckedNodes:function(){var G=[];var B=this.tree.getToggledNodes();var z=B.length;for(var C=0;C<z;C++){var A=B[C];var H=this.tree.getDropdownSelectedIndex(A,"newTarget");var D=l.getNodePhysicalId(this.snapshotAssembly,A);var y=this.newTargetsJson.getNodeFromPhysicalId(D);var E=y.getTarget(H);var F="";if(E!=null){F=E.getIter()}G.push({nodeId:A,newTarget:F})}return G},restoreSnapshot:function(){var z=this;var C=this.getCheckedNodes();if(C.length){c.mask(z.elements.container);this.snapshotsWidget.disableRestoreCmd();var A=r.build(this.snapshotAssembly,this.newTargetsJson,C);this.folderID=v.getCurrentFolderID();A.selectedFolder=this.folderID;x.restoreSnapshot(this.tenant,A,function B(G){c.unmask(z.elements.container);z.setData(z.tenant,z.snapshot);w.displayNotification({eventID:"info",msg:k.restoreSuccess});var F={created:[],deleted:[],modified:[]};var H=G.results.created;var E=G.results.revised;E.forEach(function(I){var J={physicalid:I.physicalid,operation:"Revise",refreshPSD:true};if(I.hasOwnProperty("folders")){F.refreshFolder=true;J.folders=I.folders}F.created.push(J)});H.forEach(function(I){var J={physicalid:I.physicalid,operation:"New",refreshPSD:true};if(I.hasOwnProperty("folders")){F.refreshFolder=true;J.folders=I.folders}F.created.push(J)});var D=null;if(z.snapshotsWidget.context.hasOwnProperty("widget")){if(z.snapshotsWidget.context.widget.hasOwnProperty("data")&&z.snapshotsWidget.context.widget.data.hasOwnProperty("appId")){D=z.snapshotsWidget.context.widget.data.appId}}else{if(z.snapshotsWidget.context.hasOwnProperty("options")){if(z.snapshotsWidget.context.options.hasOwnProperty("x3dAppId")&&z.snapshotsWidget.context.options.x3dAppId=="ENOPRSU_AP"){D=z.snapshotsWidget.context.options.x3dAppId}}}u.refreshEditors(z.folderID,F,D,z.snapshotsWidget.context)},function y(D){c.unmask(z.elements.container);z.snapshotsWidget.enableRestoreCmd();var E=k.restoreFail;E+=" "+D;console.log(E);w.displayNotification({eventID:"warning",msg:E})})}else{w.displayNotification({eventID:"warning",msg:k.noSelection})}},buildUI:function(){var z=this;this.elements.container=e.createElement("div",{styles:{position:"absolute",overflow:"hidden",top:"0px",left:"0px",width:"100%","border-right":"1px solid "+n,"background-color":"white",height:"100%"}});c.mask(this.elements.container);this.buildHeader(this.elements.container);var B=10;var A=q+B;var y=o;this.buildBasicInfoTable(this.elements.container,A+"px",y+"px");A=A+y+B;this.treeContainer=e.createElement("div",{"class":"tree-list-container"});this.treeContainer.inject(this.elements.container);m.subscribe({event:"ENOLifecycleSnapshotsSelectOccurrencesInTree"},function(C){if(z.tree){z.tree.selectOccurrences(C)}})},buildHeader:function(y){var E=e.createElement("div",{styles:{overflow:"hidden",top:"0px",left:"0px",width:"100%",height:q+"px"}});E.inject(y);var B=e.createElement("span",{"class":"fonticon fonticon-left-open skeleton-ctrl-back"});B.setStyle("font-size","2.3em");B.setStyle("vertical-align","middle");B.setStyle("color","#77797c");B.setStyle("opcity","0.75");B.setStyle("cursor","pointer");B.onmouseover=function(){B.setStyle("opcity","1")};B.onmouseout=function(){B.setStyle("opcity","0.75")};var A=this;B.onclick=function(){A.slideOut()};B.inject(E);var D=this.snapshotsWidget.getUrl("/webapps/ListSnapshots/assets/icons/32/I_Snapshots.png");var z=new e.Element("img",{"vertical-align":"text-bottom",src:D});z.inject(E);var C=new e.Element("span");C.setStyle("font-size","16px");C.setStyle("color","#77797c");C.setStyle("margin-left","10px");C.setStyle("vertical-align","middle");C.setStyle("font-weight","bold");C.setContent(k.Snapshots);C.inject(E)},buildBasicInfoTable:function(z,H,F){var A=new s(2);this.snapshotTitle=A.add(k.Title);this.snapshotComponents=A.add(k.Components);this.snapshotResponsible=A.add(k.Responsible);this.snapshotOriginated=A.add(k.Originated);this.snapshotDescription=A.add(k.Description);var I=document.createElement("div");I.style.overflow="auto";z.appendChild(I);var J=document.createElement("table");J.style.width="100%";I.appendChild(J);var E=document.createElement("tbody");J.appendChild(E);J.addRow=function(){var K=document.createElement("tr");E.appendChild(K);K.addCol=function(){var L=document.createElement("td");L.style.verticalAlign="bottom";K.appendChild(L);return L};return K};var G=J.addRow();var C=G.addCol();this.snapshotThumbnail=document.createElement("img");var D=8;this.snapshotThumbnail.style.height=o-2*D+"px";this.snapshotThumbnail.style.padding="5px";this.snapshotThumbnail.style.margin=D+"px";this.snapshotThumbnail.style.border="1px solid "+n;C.appendChild(this.snapshotThumbnail);var B=G.addCol();var y=document.createElement("div");y.style.maxHeight="150px";B.appendChild(y);A.inject(y)},clearOpenInCatia:function(){if(this.openInCatiaReady===true){d.clearOpenInCatia()}},prepareOpenInCatia:function(){var y=this.tree.getSelectedNodes();if(y.length==0){this.clearOpenInCatia();return}d.prepareOpenOccsInCatia(this.snapshotAssembly,y);this.openInCatiaReady=true},onSelectTreeNode:function(y){this.onTreeNodeSelectionChange()},onUnselectTreeNode:function(y){this.onTreeNodeSelectionChange()},onTreeNodeSelectionChange:function(){this.prepareOpenInCatia();this.highlightSelectedNodesInViewer();this.updateOpenInCatiaCmd()},updateOpenInCatiaCmd:function(){var y=this.tree.getSelectedNodes();if(y.length==0){this.snapshotsWidget.disableOpenInCatiaCmd()}else{this.snapshotsWidget.enableOpenInCatiaCmd()}},openInCatia:function(){var y=this;c.mask(y.elements.container,k.launchingCatia);c.mask(y.snapshotsWidget.snapshotListPanel.elements.container,k.launchingCatia);j.open_app({appId:"ENOV5MA_AP"},function z(){c.unmask(y.elements.container);c.unmask(y.snapshotsWidget.snapshotListPanel.elements.container)})},onTreeNodeToggleChange:function(){var y=this.tree.getToggledNodes();if(y.length>0){this.snapshotsWidget.enableRestoreCmd()}else{this.snapshotsWidget.disableRestoreCmd()}},onCheckTreeNode:function(y){this.onTreeNodeToggleChange()},onUncheckTreeNode:function(y){this.onTreeNodeToggleChange()},buildTree:function(z,F){var D=this;F.get=function(G){var J=F.length;for(var H=0;H<J;H++){var I=F[H];if(I.partid==G){return I.newTargets}}return[]};var E=p.getAll();var B={showCheckbox:true,selectOnCheck:false,onDropCol:function(G){D.onDragDropTreeColumn(G)},getTypeIcon:function(H){var G=a.getTypeIcon(D.tenant,H);return G},allCols:E};D.tree=new h(B);D.tree.onSelect(function(G){D.onSelectTreeNode(G)});D.tree.onUnselect(function(G){D.onUnselectTreeNode(G)});D.tree.onCheck(function(G){D.onCheckTreeNode(G)});D.tree.onUncheck(function(G){D.onUncheckTreeNode(G)});D.tree.inject(D.treeContainer);D.tree.insertDropdownListCol(4,"newTarget",k.newTarget,function C(I,H){var G=F.get(I.physicalId);if(G.length==0){D.tree.disableNode(H)}return G},function y(H,G,I){I.toggle()});D.tree.load(z,D.customTreeCols);var A=["CATPart","CATProduct","CATIA Design Table"];D.tree.disableNodesByType(A)},onDragDropTreeColumn:function(y){p.save(y)},customizeColumns:function(){var z=this;p.customizeColumns(function y(B){z.customTreeCols=B;z.tree.customizeColumns(B);z.parent.dispatchEvent("onCustomizeColumnsDone")},function A(B){z.parent.dispatchEvent("onCustomizeColumnsDlgShown",[B])})},getTreeTargetNodes:function(H){var E=k.newObjectTarget;var z=[];var A=H.getCount();for(var F=0;F<A;F++){var I=H.getNode(F);var B={partid:I.getPhysicalId(),newTargets:[]};var C=I.getTargetCount();for(var D=0;D<C;D++){var G=I.getTarget(D);if(G==null){continue}var y=G.getIter();if(y=="NEW"){y=E}B.newTargets.push(y)}z.push(B)}return z},updateTree:function(){if(this.tree!=null){this.tree.remove()}if(this.snapshotId==null){console.log("no snapshot");return}this.buildTree(this.snapshotAssembly,this.treeTargetNodes)},highlightSelectedNodesInViewer:function(){var A=this.tree.getSelectedNodes();var z=[];for(var y=0;y<A.length;y++){z.push(A[y].occId)}m.publish({event:"ENOLifecycleSnapshotsHighlightOccurrencesInViewer",data:z})}});return f});define("DS/ListSnapshots/ListPanel",["UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","UWA/Core","DS/ListSnapshots/TableView","DS/UIKIT/SuperModal","UWA/Utils/InterCom","DS/ListSnapshots/WebServices","DS/LifecycleServices/LifecycleServices","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","i18n!DS/ListSnapshots/assets/nls/ListSnapshotsNls","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/LifecycleControls/assets/styles/LifecycleModals"],function(g,n,f,j,c,p,o,e,a,m,d,l,h){var i="#e2e4e3";var b=i;var k=g.extend({init:function(s,q,r){this._parent(r);this.buildUI();this.selectedObjects=[];this.firstSnapshotRow=null},getSelectedSnapshots:function(){return this.selectedObjects},onSelect:function(q){this.onSelectCallBack=q},loadSnapshots:function(v,s,q,r,t){switch(s){case 0:o.listAllSnapshotsCreatedByCurrentUser(function u(x){r(x)},function w(x){t(x)});break;case 1:o.listSnapshotsOfObject(v,q,function u(x){r(x)},function w(x){t(x)});break;case 2:o.listSnapshotsContainingObject(v,q,function u(x){r(x)},function w(x){t(x)});break;case 3:o.listSnapshotsContainingAnyRevOfObject(v,q,function u(x){r(x)},function w(x){t(x)});break}},onDataLoaded:function(){this.updateTableView();m.unmask(this.elements.container);this.parent.dispatchEvent("onListPanelShown")},setData:function(v,q,s){m.mask(this.elements.container);var u=this;u.tenant=v;this.loadSnapshots(v,s,q,function r(y){u.snapshots=y;if(y.length==0){var z=d.noSnapshots;a.displayNotification({msg:z,eventID:"warning"})}e.getAssemblyInfo(v,q,function x(A){u.assembly=A;u.onDataLoaded()},function w(A){u.tableView.clear();var B=d.getAsmInfoFail;B+=" "+A;console.log(B);a.displayNotification({msg:B,eventID:"warning"})})},function t(w){u.tableView.clear();var x=d.getSnapshotsFail;x+=" "+w;console.log(x);a.displayNotification({eventID:"warning",msg:x})})},updateTableView:function(){this.tableView.clear();if(this.assembly!=null){var u=d.currentState;var s=e.formatDate(this.assembly.originated);var w=this.tableView.addRow([u,this.assembly.owner,s,this.assembly.desc]);w.setBackgroundColor("#e8f2e5");w.obj=this.assembly}var x=this.snapshots.length;for(var t=0;t<x;t++){var r=this.snapshots[t];var q=e.formatDate(r.creationDate,true);var v=r.description||"";var w=this.tableView.addRow([r.title,r.owner,q,v]);w.obj=r;if(t==0){w.select()}}},buildUI:function(){var u=d.Title;var t=d.Responsible;var q=d.Originated;var s=d.Description;this.tableView=new j([u,t,q,s]);var r=this;this.tableView.onselectchange=function(v){r.selectedObjects=[];for(var w=0;w<v.length;w++){r.selectedObjects.push(v[w].obj)}if(r.onSelectCallBack!=null){r.onSelectCallBack(r.selectedObjects)}};this.elements.container=f.createElement("div",{styles:{position:"absolute",overflow:"hidden",top:"0px",left:"0px",width:"100%",height:"100%"}});m.mask(this.elements.container);this.tableView.inject(this.elements.container)},deleteSnapshot:function(q){var s=this;var v=q.id;var u=q.title;o.deleteSnapshot(s.tenant,v,function t(){var x=s.tableView.getRowByObj(q);x.del();var w=d.deleteSuccess;w+="<br>"+u;a.displayNotification({msg:w,eventID:"info"})},function r(w){var x=d.deleteFail;x+="<br>"+u;x+="<br>"+w;console.log(x);a.displayNotification({msg:x,eventID:"warning"})})},deleteSnapshots:function(r){var t=this;var s=new c({closable:true,className:"Lifecycle_Modals",events:{onShow:function(){t.parent.dispatchEvent("onConfirmDeleteSnapshotShown")}},renderTo:document.body});var v=d.deleteConfirm;var u=d.deleteConfirmTitle;s.confirm(v,u,function(w){if(w==true){var z=r.length;for(var y=0;y<z;y++){var x=r[y];t.deleteSnapshot(x)}}});if(s&&s.modals&&s.modals.current&&s.modals.current.elements){var q=(s.modals.current.elements.header)?s.modals.current.elements.header.getElement(".close.fonticon.fonticon-cancel"):null;if(q){q.setText("\u00D7");q.removeClassName("fonticon");q.removeClassName("fonticon-cancel");q.setAttributes({title:l.close})}if(s.modals.current.elements.closeTooltip&&s.modals.current.elements.closeTooltip.elements){s.modals.current.elements.closeTooltip.elements.container.addClassName("hideDefaultTooltip")}}}});return k});define("DS/ListSnapshots/CompareImpl",["UWA/Class","DS/ListSnapshots/WebServices","DS/LifecycleServices/LifecycleServices"],function(a,c,b){var d=a.singleton({init:function(){this._parent({})},getCompareId:function(g,i){var h="snapshotID";var e=i.id;var f=g.isCurrentState(i);if(f){h="modelID";e=i.physicalid}return{ID:e,TYPE:h}},getCompareIDs:function(g,j,l){var i=g.getSelectedSnapshots();var k=i.length;if(k!=2){l("the selected snapshots number is not 2")}else{var h=this.getCompareId(g,i[0]);var f=this.getCompareId(g,i[1]);var e=[f,h];j(e)}},getJSONSnapshots:function(g,k,f){var m=g;var p=m.getSelectedSnapshots();var j=p.length;if(j!=2){f("the selected snapshots number is not 2")}else{var i=p[0].id;var h=p[1].id;var e=false;if(p[0]==m.assembly){i=h;h=p[0].physicalid;e=true}else{if(p[1]==m.assembly){e=true;h=p[1].physicalid}}var q=[];c.getSnapshotAssembly(m.tenant,i,function o(n){q.push(n);if(e){b.expandAssembly(m.tenant,h,function s(t){q.push(t);k(q)},function r(t){f(t)})}else{c.getSnapshotAssembly(m.tenant,h,function s(t){q.push(t);k(q)},function r(t){f(t)})}},function l(n){f(n)})}}});return d});define("DS/ListSnapshots/SnapshotsWidget",["UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/ListSnapshots/SuperModalEx","DS/ListSnapshots/ListPanel","DS/ListSnapshots/DetailsPanel","DS/ListSnapshots/OpenInCatia","DS/LifecycleServices/LifecycleServicesSettings","DS/ListSnapshots/WebServices","DS/ApplicationFrame/ActionBar","DS/ApplicationFrame/CommandsManager","DS/LifecycleControls/Assembly3DViewer","DS/LifecycleServices/AssemblyJson","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleAlert","DS/ListSnapshots/CompareImpl","DS/ListSnapshots/CmdCtx","DS/UIKIT/Mask","i18n!DS/IterationsWidget/assets/nls/IterationsWidget","i18n!DS/ListSnapshots/assets/nls/ListSnapshotsNls","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/ListSnapshots/ListSnapshots.css","css!DS/LifecycleControls/assets/styles/LifecycleModals"],function(y,g,m,e,x,c,q,o,j,A,C,a,d,w,t,b,B,r,v,f,l,s,i,p,z){var h=0;var k=10;var u="#e2e4e3";var n=y.extend({closeCallback:null,context:null,init:function(G,D,E){this.widget=G;this.snapshotListPanel=new q();this.snapshotListPanel.isVisible=false;var F=this;this.selectedSnapshots=[];this.snapshotListPanel.onSelect(function(H){F.onSelectSnapshots(H)});this.snapshotDetailsPanel=new o(this);this.snapshotDetailsPanel.onBack(function(){F.showList(false)});this._parent(E);if(E.hasOwnProperty("closeCallback")){F.closeCallback=E.closeCallback}if(typeof(E.context)!=="undefined"&&E.context!==null){F.context=E.context}this.buildUI()},getSelectedSnapshots:function(){return this.selectedSnapshots},onSelectSnapshots:function(D){var E=this;this.selectedSnapshots=D;this.updateListPanelCommands(D);if(D.length==1){var F=D[0];this.loadAssembly(F,function G(H){j.prepareOpenOccsInCatia(H)})}else{j.clearOpenInCatia()}this.update3DViewer(D)},showSnapshotsDialogWithoutSelection:function(D){this.showSnapshotsDialog(D)},isCurrentState:function(D){if(this.assembly!=null){if(this.assembly.physicalid==D.physicalid){return true}}return false},showSnapshotsDialogWithSelection:function(D){var F=this;b.getAssemblyInfo(this.tenant,this.object.physicalid,function G(H){F.assembly=H;F.showSnapshotsDialog(D)},function E(H){var I=s.getAsmInfoFail;I+=" "+H;console.log(I);B.displayNotification({msg:I,eventID:"warning"})})},showSnapshotsDialog:function(K){var H=this;H.is3DViewerReady=false;f.mask(this.viewer3dContainer);var J="SnapshotsWidgetDialog Lifecycle_Modals";var I=K.getElementsByClassName(J);var E=I.length;for(var G=0;G<E;G++){var F=I[G];K.removeChild(F)}var M=s.Snapshots;if(H.object!=null){M+=" - "+H.object.displayName}var L=new e({className:J,closable:true,events:{onShow:function(){H.showList(true)},onHide:function(){H.dispatchEvent("onClose");H.viewer3d.destroy();B.clearNotifications()}},header:"<h4>"+M+"</h4>",});L.inject(K);L.setBody(H.elements.container);L.elements.container.setStyle("top","20px");L.elements.wrapper.setStyle("width","100%");L.elements.wrapper.setStyle("height","100%");L.elements.content.setStyle("height","100%");L.elements.body.setStyle("width","100%");if(L&&L.elements&&L.elements.header){var D=L.elements.header.getElement(".close.fonticon.fonticon-cancel");if(D){D.setText("\u00D7");D.removeClassName("fonticon");D.removeClassName("fonticon-cancel");D.setAttributes({title:i.close})}if(L.elements.closeTooltip&&L.elements.closeTooltip.elements){L.elements.closeTooltip.elements.container.addClassName("hideDefaultTooltip")}}L.show();L.onClose=function(){snapshotDetailsPanel.clearOpenInCatia();if(H.closeCallback!=null){H.closeCallback()}};H.myModal=L;widget.addEvent("onRefresh",function(){if(H.myModal!=null){H.myModal.hide();H.myModal=null}})},getCompareIDs:function(D,E){r.getCompareIDs(this,D,E)},getJSONSnapshots:function(D,E){r.getJSONSnapshots(this,D,E)},listSnapshots:function(E,D){},showConfirmDialogForNoSelection:function(G,E,K){var H=this;H.listType=-1;var F=new x({closable:true,className:"Lifecycle_Modals",events:{onShow:function(){H.dispatchEvent("onConfirmForNoSelectionShown")}},renderTo:G});var J=s.showAllYourSnapshots;var I=s.Confirm;F.confirm(J,I,function(L){if(L==true){E()}else{K();H.dispatchEvent("onConfirmForNoSelectionCancel")}});if(F&&F.modals&&F.modals.current&&F.modals.current.elements){var D=(F.modals.current.elements.header)?F.modals.current.elements.header.getElement(".close.fonticon.fonticon-cancel"):null;if(D){D.setText("\u00D7");D.removeClassName("fonticon");D.removeClassName("fonticon-cancel");D.setAttributes({title:i.close})}if(F.modals.current.elements.closeTooltip&&F.modals.current.elements.closeTooltip.elements){F.modals.current.elements.closeTooltip.elements.container.addClassName("hideDefaultTooltip")}}H.confirmModal=F;widget.addEvent("onRefresh",function(){if(H.confirmModal!=null&&H.confirmModal.modals.current!=null){H.confirmModal.modals.current.destroy();H.confirmModal=null}})},showOptionsDialogForSelectedObject:function(H,F,J){var I=this;var E=this.object.physicalid;var G=new c({closable:true,className:"Lifecycle_Modals",events:{onShow:function(){I.dispatchEvent("onSearchOptionsShown",G)}},renderTo:document.body});G.promptRadioList("",s.SearchOptions,[{label:s.ofObject,value:"opt1"},{label:s.containingObject,value:"opt2"},{label:s.containingRev,value:"opt3"}],function(K){if(K==null){J()}else{if(K=="opt1"){F(1)}else{if(K=="opt2"){F(2)}else{if(K=="opt3"){F(3)}else{J()}}}}});if(G&&G.modals&&G.modals.current&&G.modals.current.elements){var D=(G.modals.current.elements.header)?G.modals.current.elements.header.getElement(".close.fonticon.fonticon-cancel"):null;if(D){D.setText("\u00D7");D.removeClassName("fonticon");D.removeClassName("fonticon-cancel");D.setAttributes({title:i.close})}if(G.modals.current.elements.closeTooltip&&G.modals.current.elements.closeTooltip.elements){G.modals.current.elements.closeTooltip.elements.container.addClassName("hideDefaultTooltip")}}I.optionsModal=G;widget.addEvent("onRefresh",function(){if(I.optionsModal!=null&&I.optionsModal.modals.current!=null){I.optionsModal.modals.current.destroy();I.optionsModal=null}})},showDialog:function(E){var F=this;if(this.object==null){this.showConfirmDialogForNoSelection(E,function D(){F.listType=0;F.showSnapshotsDialogWithoutSelection(E)},function G(){if(F.closeCallback!=null){F.closeCallback(null)}})}else{this.showOptionsDialogForSelectedObject(E,function D(H){F.listType=H;F.showSnapshotsDialogWithSelection(E)},function G(){if(F.closeCallback!=null){F.closeCallback(null)}})}},disableRestoreCmd:function(){d.getCommand("RestoreSnapshotHdr",null).disable({by:"SnapshotsWidget"})},enableRestoreCmd:function(){d.getCommand("RestoreSnapshotHdr",null).enable({by:"SnapshotsWidget"})},disableOpenInCatiaCmd:function(){d.getCommand("OpenInCatiaHdr",null).disable({by:"SnapshotsWidget"})},enableOpenInCatiaCmd:function(){d.getCommand("OpenInCatiaHdr",null).enable({by:"SnapshotsWidget"})},showList:function(E){this.snapshotDetailsPanel.hide();this.disableAllCommands();this.snapshotListPanel.isVisible=false;this.snapshotListPanel.show();var D="";if(this.object!=null){D=this.object.physicalid}this.snapshotListPanel.isVisible=true;this.updateListPanelCommands(this.getSelectedSnapshots());if(E){this.snapshotListPanel.setData(this.tenant,D,this.listType)}},showDetails:function(){this.snapshotListPanel.hide();this.snapshotListPanel.isVisible=false;this.disableAllCommands();var E=this.getSelectedSnapshots();this.snapshotDetailsPanel.show();this.snapshotDetailsPanel.setData(this.tenant,E[0]);this.updateDetailsPanelCommands();var D=null;if(A.getEnforceFolderLinkSetting()||b.getCurrentAppName(this.context)==="ENOFOL4_AP"||b.getCurrentAppName(this.context)==="ENOFOL3_AP"){D=A.getCurrentFolderID()}if(A.getEnforceFolderLinkSetting()&&D==null){B.displayNotification({eventID:"warning",msg:s.FolderNotSelected})}},buildUI:function(){this.elements.container=m.createElement("div",{styles:{position:"relative",top:"0px",left:"0px",width:"100%",height:"100%",overflow:"hidden",border:"1px solid "+u}});var D=m.createElement("div",{styles:{position:"absolute",overflow:"hidden",top:"0px",left:"0px",width:"calc(60% - 5px)","border-right":"1px solid "+u,height:"100%"}});D.inject(this.elements.container);var E=m.createElement("div",{styles:{position:"absolute",overflow:"hidden",top:"0px",left:"60%",width:"40%",height:"100%"}});E.inject(this.elements.container);this.build3DViewer(E);this.viewer3dContainer=E;this.snapshotListPanel.inject(D);this.snapshotListPanel.hide();this.snapshotListPanel.parent=this;this.snapshotDetailsPanel.inject(D);this.snapshotDetailsPanel.hide();this.snapshotDetailsPanel.parent=this;this.buildActionBar(D)},on3DViewerReady:function(){this.is3DViewerReady=true;var D=this.getSelectedSnapshots();this.update3DViewer(D)},on3DViewerLoad:function(){var D=this;setTimeout(function(){f.unmask(D.viewer3dContainer)},300)},viewer3dLoad:function(D){f.mask(this.viewer3dContainer);this.viewer3d.clear();this.viewer3d.load(D)},loadAssembly:function(E,F){if(this.isCurrentState(E)){b.expandAssembly(this.tenant,E.physicalid,function G(H){F(H)},function D(H){var I=s.expandCurrentFail;I+=" "+H;console.log(I);B.displayNotification({msg:I,eventID:"warning"});console.log(H)})}else{C.getSnapshotAssembly(this.tenant,E.id,function G(H){F(H)},function D(H){var I=s.expandFail;I+=" "+H;console.log(I);B.displayNotification({msg:I,eventID:"warning"})})}},update3DViewer:function(D){if(this.is3DViewerReady!==true){return}var E=this;E.viewer3d.clear();if(D.length==1){var F=D[0];this.loadAssembly(F,function G(H){E.viewer3dLoad(H)})}else{f.unmask(this.viewer3dContainer)}},build3DViewer:function(D){var E=this;E.viewer3d=new w(this.tenant);E.viewer3d.onReadyCallback=function(){E.on3DViewerReady()};E.viewer3d.onLoadCallback=function(){E.on3DViewerLoad()};E.viewer3d.onLoadFailCallback=function(){E.on3DViewerLoad()};E.viewer3d.inject(D)},buildActionBar:function(E){v.set(this);var G=new a({context:null,file:"snapshots.xml",module:"ListSnapshots"});G.inject(E);var F=this;G.onActionBarReady(function D(){F.isActionBarReady=true;F.updateListPanelCommands(F.getSelectedSnapshots());F.dispatchEvent("onActionBarReady")})},onCommand:function(E){switch(E){case"SnapshotDetailsHdr":this.showDetails();break;case"DeleteSnapshotsHdr":var D=this.getSelectedSnapshots();this.snapshotListPanel.deleteSnapshots(D);break;case"RestoreSnapshotHdr":this.snapshotDetailsPanel.restoreSnapshot();break;case"CustomizeColsHdr":this.snapshotDetailsPanel.customizeColumns();break;case"OpenInCatiaHdr":this.snapshotDetailsPanel.openInCatia();break;default:alert("cmd not implemented")}},disableAllCommands:function(){if(this.isActionBarReady!==true){return}d.getCommand("SnapshotDetailsHdr",null).disable({by:"SnapshotsWidget"});d.getCommand("CompareJSONHdr",null).disable({by:"SnapshotsWidget"});d.getCommand("DeleteSnapshotsHdr",null).disable({by:"SnapshotsWidget"});d.getCommand("RestoreSnapshotHdr",null).disable({by:"SnapshotsWidget"});d.getCommand("OpenInCatiaHdr",null).disable({by:"SnapshotsWidget"});d.getCommand("CustomizeColsHdr",null).disable({by:"SnapshotsWidget"})},updateListPanelCommands:function(D){if(this.isActionBarReady!==true){return}this.disableAllCommands();if(this.snapshotListPanel.isVisible==true){this.updateDetailsCmd(D);this.updateCompareCmd(D);this.updateDeleteCmd(D);this.updateOpenInCatiaCmd(D)}},updateDetailsPanelCommands:function(){this.disableAllCommands();d.getCommand("CustomizeColsHdr",null).enable({by:"SnapshotsWidget"})},updateDetailsCmd:function(D){var E=d.getCommand("SnapshotDetailsHdr",null);E.disable({by:"SnapshotsWidget"});if(D.length==1){if(!this.isCurrentState(D[0])){E.enable({by:"SnapshotsWidget"})}}},updateCompareCmd:function(D){var E=d.getCommand("CompareJSONHdr",null);E.disable({by:"SnapshotsWidget"});if(D.length==2){E.enable({by:"SnapshotsWidget"})}},updateDeleteCmd:function(D){var G=d.getCommand("DeleteSnapshotsHdr",null);G.disable({by:"SnapshotsWidget"});if(D.length>0){var E=false;for(var F=0;F<D.length;F++){if(this.isCurrentState(D[F])){E=true;break}}if(!E){G.enable({by:"SnapshotsWidget"})}}},updateOpenInCatiaCmd:function(D){var E=d.getCommand("OpenInCatiaHdr",null);if(D.length==1){E.enable({by:"SnapshotsWidget"})}else{E.disable({by:"SnapshotsWidget"})}},hideDetails:function(){this.snapshotDetailsPanel.slideOut()},getUrl:function(E){var D=A.get3DSpaceWSUrl(this.tenant,E,null);return D},setObject:function(D){this.object=D;this.selectedSnapshots=[];var E="";if(D!=undefined){E=D.physicalid;this.tenant=D.tenant}if(!this.isObjectTypeSupported(D)){throw D.type+l.iterationUnsupportedType}},isObjectTypeSupported:function(D){if(D==null){return true}else{if(D.type=="CATPart"||D.type=="CATProduct"){return true}else{return false}}},slideIn:function(J){var G=this;var F=h;var D=k;var I=0;var E=setInterval(H,D);function H(){if(I>=F){clearInterval(E);J.style.left="0px"}else{I+=D;var K=-(F-I)*100/F;J.style.left=K+"%"}}},slideOut:function(J){var G=this;var F=h;var D=k;var I=0;var E=setInterval(H,D);function H(){if(I>=F){clearInterval(E);J.style.left="-100%"}else{I+=D;var K=-I*100/F;J.style.left=K+"%"}}}});return n});define("DS/ListSnapshots/Cmd",["UWA/Core","DS/Core/Core","DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/ListSnapshots/SnapshotsWidget","DS/ListSnapshots/CmdCtx","DS/LifecycleServices/LifecycleServicesSettings"],function(h,f,c,e,b,g,d){var a=c.extend({name:"snapshot_list_actionbar",context:null,inENOPAD:false,activeCommands:{},init:function(i){var j=this;this._parent(i,{mode:"exclusive",isAsynchronous:false});this.baseEnable=this.enable;this.baseDisable=this.disable;this.enable=function(k){if(k!=null&&k.by=="SnapshotsWidget"){this.baseEnable()}};this.disable=function(k){if(k!=null&&k.by=="SnapshotsWidget"){this.baseDisable()}};require(["DS/PADUtils/PADContext"],function(k){j.context=k.get();if(null==j.context){j.context=i.context}else{j.inENOPAD=true;j.context.getPADTreeDocument().getXSO().onChange(j.checkSelect.bind(j))}d.hasPARRole(function(l){j.setCommandAvailability(j.getEnableCmd())})},function(k){j.context=i.context});d.hasPARRole(function(k){j.setCommandAvailability(j.getEnableCmd())})},beginExecute:function(){},setCommandAvailability:function(i){var j=e.getCommand(this._id,this);if(!j){j=e.getCommands()[this._id]}if(j){if(i===true){j.enable()}else{j.disable()}}},getEnableCmd:function(){var i=this;var j=false;d.hasPARRole(function(o){if(o==true&&i.context!=null&&(i.context.getPADTreeDocument||i.context.widgetType==="LifecycleWidget")){var n=0;if(i.context.getPADTreeDocument){n=i.context.getPADTreeDocument().getXSO().get().length}else{n=i.context.getSelectedNodes().length}if(n==1){var p=i.context.getSelectedNodes();var m=p[0];var l=null;try{l=m.options.grid["ds6w:type"]}catch(k){l=m.object.type}if(l==null&&m.getType!=null){l=m.getType()}if(l=="CATProduct"||l=="CATPart"){j=true}}else{if(n==0){j=true}}}else{j=o}});return j},checkSelect:function(){var i=this;setTimeout(function(){var j=i.getEnableCmd();i.setCommandAvailability(j)})},resetActiveCmd:function(i){delete this.activeCommands[i]},execute:function(){var n=this;var l=this._id;if(n.activeCommands[l]){n.showInfo(LifecycleWidgetNls.multiCmdInfo);return}var o=function(s){n.resetActiveCmd(l);if(s!=null){s.enable()}};var i=e.getCommand(l,n);try{var r=this._id;switch(r){case"ListSnapshotsHdr":var m=n.context.snapshotsWidget;if(m==null){m=new b(n.context,null,{closeCallback:o,context:n.context});n.context.snapshotsWidget=m}n.load(m);break;default:var q=g.get();q.onCommand(r)}}catch(p){if(typeof n.context.displayNotification==="function"){var k=p;if(p.hasOwnProperty("message")){k=p.message}var j={eventID:"warning",msg:k};n.context.displayNotification(j)}console.log(p.message)}},load:function(q){var s=this;var y=s.context.getSelectedNodes();var o=null;if(y.length>0){o=y[0].object}function i(){if(typeof s.context.getCurrentFolder!=="function"){return false}var z=s.context.getCurrentFolder();var A=JSON.parse(z);if(A&&A.IsInDeletedItems!=null&&A.IsInDeletedItems){return true}return false}var n=null;if(y.length==1){var m=y[0];var t=m.getID();var v=null;try{v=m.options.grid["ds6w:type"]}catch(l){v=m.object.type}if(v==null&&m.getType!=null){v=m.getType()}var r="";var w;try{w=m.object.revision}catch(l){w=m.options.grid["ds6wg:revision"]}if(w!==null&&w!==undefined){r=w}var p=null;try{p=m.getTenant()}catch(l){}var x;if(typeof m.getDisplayName==="function"){x=m.getDisplayName()}else{x=m.getLabel();if(r!==""){x=x+" "+r}}n={physicalid:t,name:m.getLabel(),displayName:x,type:v,revision:r,tenant:p};if(!q.isObjectTypeSupported(n)){n=null}if(i()){n=null}}try{q.setObject(n);q.showDialog(document.body)}catch(u){if(typeof s.context.displayNotification==="function"){var k=u;if(u.hasOwnProperty("message")){k=u.message}var j={eventID:"warning",msg:k};s.context.displayNotification(j)}console.log(u.message)}},endExecute:function(){},toRefresh:function(i){if(this.options.context){if(typeof this.options.context.RefreshView!=="undefined"){this.options.context.RefreshView(i)}}}});return a});