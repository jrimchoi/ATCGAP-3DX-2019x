define("DS/AfrUndoRedoUI/Private_UndoStep",["DS/Core/Events","DS/CoreUtilities/ErrorManagement"],function(d,a){var g=0;var e=a.getErrorManager();function b(h){if(h===undefined){throw new Error("publishUndoExecuted expect an undo step as input")}d.publish({event:"UNDO_"+h.getId()+"/EXECUTED",data:h})}function c(h){if(h===undefined){throw new Error("publishRedoExecuted expect an undo step as input")}d.publish({event:"REDO_"+h.getId()+"/EXECUTED",data:h})}var f=function(h){if(h===undefined||h.undoTitle===undefined||typeof h.undoTitle!=="string"){throw new Error("PrivateUndoStep constructor : expects an object parameters as an input with a property named undoTitle {string} on it.")}if(h.undoAction!==undefined&&typeof h.undoAction!=="function"){throw new Error("PrivateUndoStep constructor : parameters.undoAction if specified must be a function.")}if(h.undoAction===undefined&&h.undoData!==undefined){throw new Error("PrivateUndoStep constructor : parameters.undoData specified but parameters.undoAction undefined.")}if(h.doAction!==undefined&&typeof h.doAction!=="function"){throw new Error("PrivateUndoStep constructor : parameters.doAction if specified must be a function.")}if(h.doAction===undefined&&h.doData!==undefined){throw new Error("PrivateUndoStep constructor : parameters.doData specified but parameters.doAction undefined.")}this._private=Object.create(null);this._private._id=g++;this._private._undoTitle=h.undoTitle;this._private._exclusivity=false;this._private._redoEnabled=true;this._private._undoAction=undefined;this._private._undoData=undefined;this._private._doAction=undefined;this._private._doData=undefined;this._private._serverUndoStepId=(h.serverUndoStepId>=0)?h.serverUndoStepId:undefined;this._private._serverExclusivity=(h.serverExclusivity===true);this._private._groupedUndos=[];this._private._groupedUndosTokens=[];this._private._serverUndoToken=undefined;this._private._pendingGroupedUndosIds=[];this._private._undoEventSent=false;this._private._redoEventSent=false;this._private._undoAction=h.undoAction;this._private._undoData=h.undoData;this._private._doAction=h.doAction;this._private._doData=h.doData;if(h.redoEnabled===false){this._private._redoEnabled=false}if(h.exclusivity===true){this._private._exclusivity=true}};f.prototype._reset=function(){this._private._undoAction=undefined;this._private._undoData=undefined;this._private._doAction=undefined;this._private._doData=undefined;this._private._serverUndoStepId=undefined;this._private._serverExclusivity=false};f.prototype.getId=function(){return this._private._id};f.prototype.getUndoTitle=function(){return this._private._undoTitle};f.prototype.setExclusivity=function(h){if(h===undefined||typeof h!=="boolean"){throw new Error("privateUndoStep.setExclusivity expects an input parameter exclusivity of type boolean.")}this._private._exclusivity=h};f.prototype.getExclusivity=function(){return this._private._exclusivity};f.prototype.setRedoEnabled=function(h){if(h===undefined||typeof h!=="boolean"){throw new Error("privateUndoStep.setRedoEnabled expects an input redoEnabled of type boolean.")}this._private._redoEnabled=h};f.prototype.getRedoEnabled=function(){return this._private._redoEnabled};f.prototype.getServerUndoStepId=function(){return this._private._serverUndoStepId};f.prototype.getServerExclusivity=function(){return this._private._serverExclusivity};f.prototype._addGroupedUndo=function(h){if(h===undefined||!(h instanceof f)){throw new Error("privateUndoStep.addGroupedUndo expects an input parameter of type number (Id of the undo step to group to.")}if(h._private._groupedUndos.indexOf(this)>=0){throw new Error("privateUndoStep.addGroupedUndo cannot group a step into one of its own groupedStep")}this._private._groupedUndos.unshift(h);return a.createReturnObject(e.SUCCEEDED,{description:"privateUndoStep.addGroupedUndo was executed as expected."})};f.prototype.hasGroupedUndoSteps=function(){if(this._private._groupedUndos.length>0){return true}else{return false}};f.prototype.hasGroupedStepWithPropertyValue=function(j){for(var h=0;h<this._private._groupedUndos.length;h++){if((this._private._groupedUndos[h]&&j.propertyGetter(this._private._groupedUndos[h],j.propertyValue))||this._private._groupedUndos[h].hasGroupedStepWithPropertyValue(j)){return true}}return false};f.prototype._executeUndo=function(){var h=true;var k=this;var j=this._private._groupedUndos.length-1;this._private._undoEventSent=false;if(this._private._serverUndoStepId!==undefined&&this._private._serverUndoStepId>=0){this._private._serverUndoToken=d.subscribe({event:"UNDO_SERVER_"+this._private._serverUndoStepId+"/EXECUTED"},function(){if(this._private._serverUndoToken!==undefined){d.unsubscribe(this._private._serverUndoToken);this._private._serverUndoToken=undefined}if(this._private._groupedUndosTokens.length===0&&j<0){this._private._undoEventSent=true;b(k)}}.bind(this))}if(this._private._undoAction){this._private._undoAction.call(this,this._private._undoData)}for(j=this._private._groupedUndos.length-1;j>=0;j--){if(this._private._groupedUndos[j]){this._private._pendingGroupedUndosIds.push(this._private._groupedUndos[j].getId());this._private._groupedUndosTokens.push(this._private._groupedUndos[j]._onUndoExecuted(function(l){var i=this._private._pendingGroupedUndosIds.indexOf(l.getId());d.unsubscribe(this._private._groupedUndosTokens[i]);this._private._groupedUndosTokens.splice(i,1);this._private._pendingGroupedUndosIds.splice(i,1);if(this._private._groupedUndosTokens.length===0&&this._private._serverUndoToken===undefined&&j<0){this._private._undoEventSent=true;b(k)}}.bind(this)));h=this._private._groupedUndos[j]._executeUndo()}else{h=false}}if(this._private._groupedUndosTokens.length===0&&this._private._serverUndoToken===undefined&&this._private._undoEventSent===false){b(k)}return h};f.prototype._executeRedo=function(){var h=true;var k=this;var j=0;this._private._redoEventSent=false;if(this._private._serverUndoStepId!==undefined&&this._private._serverUndoStepId>=0){this._private._serverUndoToken=d.subscribe({event:"REDO_SERVER_"+this._private._serverUndoStepId+"/EXECUTED"},function(){if(this._private._serverUndoToken!==undefined){d.unsubscribe(this._private._serverUndoToken);this._private._serverUndoToken=undefined}if(this._private._groupedUndosTokens.length===0&&j>=this._private._groupedUndos.length){this._private._redoEventSent=true;c(k)}}.bind(this))}for(j=0;j<this._private._groupedUndos.length;j++){if(this._private._groupedUndos[j]){this._private._pendingGroupedUndosIds.push(this._private._groupedUndos[j].getId());this._private._groupedUndosTokens.push(this._private._groupedUndos[j]._onRedoExecuted(function(l){var i=this._private._pendingGroupedUndosIds.indexOf(l.getId());d.unsubscribe(this._private._groupedUndosTokens[i]);this._private._groupedUndosTokens.splice(i,1);this._private._pendingGroupedUndosIds.splice(i,1);if(this._private._groupedUndosTokens.length===0&&this._private._serverUndoToken===undefined&&j>=this._private._groupedUndos.length){this._private._redoEventSent=true;c(k)}}.bind(this)));h=this._private._groupedUndos[j]._executeRedo()}else{h=false}}if(this._private._doAction){this._private._doAction.call(this,this._private._doData)}if(this._private._groupedUndosTokens.length===0&&this._private._serverUndoToken===undefined&&this._private._redoEventSent===false){c(k)}return h};f.prototype._onUndoExecuted=function(h){return d.subscribe({event:"UNDO_"+this._private._id+"/EXECUTED"},h)};f.prototype._onRedoExecuted=function(h){return d.subscribe({event:"REDO_"+this._private._id+"/EXECUTED"},h)};f.prototype.removeCallback=function(h){d.unsubscribe(h)};return f});define("DS/AfrUndoRedoUI/Private_GenericStack",["DS/Core/Events","DS/AfrUndoRedoUI/Private_UndoStep","DS/CoreUtilities/ErrorManagement"],function(f,j,e){var d=[e.generateReturnValue("MISSING_STEP",false),e.generateReturnValue("NO_STEPS_TO_GROUP",false)];var n=e.getErrorManager(d,{merge:true});function m(o){if(o===undefined||typeof o!=="string"){throw new Error("getEventWhenStackFilled expect the stack Id for which to sent the event")}return o+"_FILLED"}function b(o){if(o===undefined||typeof o!=="string"){throw new Error("getEventWhenStackEmptied expect the stack Id for which to sent the event")}return o+"_EMPTIED"}function k(o){if(o===undefined||typeof o!=="string"){throw new Error("getEventWhenStepPushedIntoStack expect the stack Id for which to sent the event")}return"STEP_PUSHED_IN_"+o}function i(o){if(o===undefined||typeof o!=="string"){throw new Error("getEventWhenStepPopedOutOfStack expect the stack Id for which to sent the event")}return"STEP_REMOVED_FROM_"+o}function a(o){f.publish({event:m(o)})}function c(o){f.publish({event:b(o)})}function h(o,p){if(p===undefined||typeof p!=="string"){throw new Error("sendStepPushedIntoStack expect the step UndoTitle pushed into the stack")}f.publish({event:k(o),data:p})}function g(o,p){if(p===undefined||typeof p!=="string"){throw new Error("sendStepRemovedFromStack expect the step UndoTitle pushed into the stack")}f.publish({event:i(o),data:p})}var l=function(o){this._private=Object.create(null);this._private._stack=[];this._private._capacity=10;this._private._name="";this._private.removeStepAt=function(p){if(p===undefined||typeof p!=="number"||p<0||p>=this._stack.length){throw new Error("genericStack._private.removeStepAt expected a number (betwwen 0 and this._stack.lenght) as an input parameter")}var q=this._stack.splice(p,1);if(q&&q[0]){g(this._name,q[0].getUndoTitle());if(this._stack.length===0){c(this._name)}return q[0]}};if(o){if(o.ID&&typeof o.ID==="string"){this._private._name=o.ID}else{throw new Error("genericStack constructor: method expects options.ID (a string) as input parameter.")}if(o.capacity!==undefined){if(typeof o.capacity==="number"&&o.capacity>=0){this._private._capacity=o.capacity}else{throw new Error("genericStack constructor: if options.capacity is set, it must be a number >= 0.")}}}else{throw new Error("genericStack constructor: method expects options (an object)  as input parameter.")}};l.prototype.getName=function(){return this._private._name};l.prototype.getSize=function(){return this._private._stack.length};l.prototype.getCapacity=function(){return this._private._capacity};l.prototype.setCapacity=function(o){if(o===undefined||typeof o!=="number"||o<0){throw new Error("genericStack.setCapacity: method expects the undo stack capacity (a number >= 0) to set as input parameter.")}this._private._capacity=o;while(this._private._stack.length>o){this._private.removeStepAt(0)}return e.createReturnObject(n.SUCCEEDED,{description:""})};l.prototype.pushStep=function(o){if(o===undefined){throw new Error("genericStack pushStep: method expects the step as input parameter.")}if(!(o instanceof j)){throw new Error("genericStack pushStep: method expects the step of type PrivateUndoStep as input parameter.")}if(this._private._stack.length===this._private._capacity){this._private.removeStepAt(0)}this._private._stack.push(o);h(this.getName(),o.getUndoTitle());if(this.getSize()===1){a(this.getName())}return e.createReturnObject(n.SUCCEEDED,{description:"Step added in stack"})};l.prototype.popStep=function(){if(this.getSize()===0){return}var o=this._private.removeStepAt(this._private._stack.length-1);return o};l.prototype.flush=function(){this._private._stack=[];c(this.getName())};l.prototype.getLastStepId=function(){if(this._private._stack.length>0){return this._private._stack[this._private._stack.length-1].getId()}else{return -1}};l.prototype.getLastStepUndoTitle=function(){if(this._private._stack.length>0){return this._private._stack[this._private._stack.length-1].getUndoTitle()}else{return undefined}};l.prototype.findStepIdx=function(p){var o=-1;if(p===undefined||p<-1||typeof p!=="number"){throw new Error("genericStack findStepIdx: method expects the Step identifier (a number >= 0) as input parameter.")}for(o=this._private._stack.length-1;o>=0;o--){if(this._private._stack[o].getId()===p){return o}}return -1};l.prototype.findStepIdFromPropertyValue=function(p){var o=-1;if(p===undefined||p.propertyGetter===undefined||p.propertyValue===undefined||typeof p.propertyGetter!=="function"){throw new Error("findStepIdFromPropertyValue expects a property named propertyGetter (function) and another named propertyValue on parameters.")}for(o=this._private._stack.length-1;o>=0;o--){if(p.propertyGetter(this._private._stack[o],p.propertyValue)||this._private._stack[o].hasGroupedStepWithPropertyValue(p)){return this._private._stack[o].getId()}}return -1};l.prototype.removeStepWithId=function(p){if(p===undefined||typeof p!=="number"||p<0){throw new Error("genericStack.removeStepWithId: method expects the step Id of type nummber >= 0 as input parameter.")}var o=this.findStepIdx(p);if(o<0){return e.createReturnObject(n.MISSING_STEP,{description:"genericStack.removeStepWithId: step with Id:"+p+", not found."})}this._private.removeStepAt(o);return e.createReturnObject(n.SUCCEEDED,{description:"genericStack.removeStepWithId: step with Id : "+p+", was successfully removed."})};l.prototype.removeStepsFromId=function(q){if(q===undefined||typeof q!=="number"||q<0){throw new Error("genericStack.removeStepsFromId: method expects the step Id from which to remove step of type nummber >= 0 as input parameter.")}var o=this.findStepIdx(q);if(o<0){return e.createReturnObject(n.MISSING_STEP,{description:"genericStack.removeStepsFromId: step with Id:"+q+", not found."})}for(var p=0;p<=o;p++){this._private.removeStepAt(0)}return e.createReturnObject(n.SUCCEEDED,{description:"genericStack.removeUndoWithId: step with Id : "+q+", was successfully removed."})};l.prototype.groupSteps=function(p,o){if(p===undefined||o===undefined){throw new Error("genericStack.groupSteps: method expects iFromId and iToId, the 2 server step server Id to group as input parameters.")}if(typeof p!=="number"||typeof o!=="number"){throw new Error("genericStack.groupSteps: method expects iFromId and iToId, the 2 server step server Id to group as input parameters to be of numbers.")}if(o>p){throw new Error("genericStack.groupSteps: index of step with iFromId:"+p+"< index of step with iToId:"+o+".")}var s=this.findStepIdx(p);if(s===-1){return e.createReturnObject(n.MISSING_STEP,{description:"genericStack.groupSteps: step with iFromId:"+p+", not found."})}else{if(s===0){return e.createReturnObject(n.NO_STEPS_TO_GROUP,{description:"genericStack.groupSteps: no steps to group between iFromId:"+p+" and iToId:"+o+"."})}}var t=this._private._stack[s];var q=p-1;var r;var u;while(q>=o){r=this.findStepIdx(q);if(r>-1){u=this._private._stack[r];if(u){t._addGroupedUndo(u);this._private.removeStepAt(r)}}q--}return e.createReturnObject(n.SUCCEEDED,{description:"genericStack.groupSteps: server steps from Id : "+p+" to Id : "+o+" were grouped."})};l.prototype.onStackFilled=function(o){return f.subscribe({event:m(this.getName())},o)};l.prototype.onStackEmptied=function(o){return f.subscribe({event:b(this.getName())},o)};l.prototype.onStepPushedIntoStack=function(o){return f.subscribe({event:k(this.getName())},o)};l.prototype.onStepRemovedFromStack=function(o){return f.subscribe({event:i(this.getName())},o)};l.prototype.removeCallback=function(o){f.unsubscribe(o)};return l});define("DS/AfrUndoRedoUI/Private_UndoRedoManager",["DS/Core/Core","UWA/Class","DS/Core/Events","DS/AfrUndoRedoUI/Private_GenericStack","DS/AfrUndoRedoUI/Private_UndoStep","DS/ApplicationFrame/CommandsManager","DS/CoreUtilities/ErrorManagement"],function(f,b,g,j,i,l,e){var d=[e.generateReturnValue("MISSING_UNDO_STEP",false),e.generateReturnValue("WRONG_UNDO_STEP_ORDER",false),e.generateReturnValue("NO_UNDO_STEPS_TO_GROUP",false),e.generateReturnValue("UNDO_STEP_CREATION_FAILED",false),e.generateReturnValue("FAIL",false)];var k=e.getErrorManager(d,{merge:true});var a;var h=function(){if(e.getDebugMode()){f.enableWUXConsole();a=WUX.getWUXConsole()?WUX.getWUXConsole():console}else{a=console}};var c=function(n){if(e.getDebugMode()){h();a.log(n)}};var m=b.singleton({init:function(){m._parent();this._private=Object.create(null);this._private._undoStack=new j({ID:"AfrUndoStack"});this._private._redoStack=new j({ID:"AfrRedoStack"});this._private._endAllEventToken=undefined;this._private._undoExecutedToken=[];this._private._undoExecutedId=[];this._private._redoExecutedToken=[];this._private._redoExecutedId=[];this._private._undosPending=[];this._private._lastUndoStepId=-1;this._private._lastUndoStepIdSaved=-1;this._private._cleanEndAllEventToken=function(){if(this._endAllEventToken!==undefined){g.unsubscribe(this._endAllEventToken);this._endAllEventToken=undefined}};this._private._executeUndoPending=function(){if(this._undosPending.length<=0||this._undosPending[this._undosPending.length-1]===undefined){return e.createReturnObject(k.MISSING_UNDO_STEP,{description:"_executeUndoPending: No undo Pending"})}var n=this._undosPending.pop();if(n){c("Undo action: "+n.getUndoTitle());this._undoExecutedId.push(n.getId());this._undoExecutedToken.push(n._onUndoExecuted(function(p){if(!p){return e.createReturnObject(k.FAILED,{description:"_onUndoExecuted Callback: No undo step corresponding to undo event."})}var o=this._undoExecutedId.indexOf(p.getId());if(o>=0){if(this._undoExecutedToken[o]!==undefined){g.unsubscribe(this._undoExecutedToken[o])}this._undoExecutedId.splice(o,1);this._undoExecutedToken.splice(o,1)}if((p.getRedoEnabled()!==false)){this._redoStack.pushStep(p)}m.displayStacksSize();g.publish({event:"UNDO_"+p.getId()+"/ENDED",data:p.getUndoTitle()})}.bind(this)));n._executeUndo()}};this._private.displayStacksSize=function(){c("Undo  : "+this._undoStack.getSize()+" | Redo : "+this._redoStack.getSize())}},createUndoStep:function(p){if(p===undefined||p.undoTitle===undefined||typeof p.undoTitle!=="string"||p.undoAction===undefined||typeof p.undoAction!=="function"){throw new Error("PrivateUndoRedoManager.createUndoStep expects an input object parameters with at least parameters.undoTitle {string} and parameters.undoAction {function} specified.")}var o=null;var q=null;if(this._private._executionContext){var r=this._private._executionContext.getComponent("AFR_CommandsManager");q=r._private._runningCmd._private._command._instance}else{o=l._getCurrent();q=l.getCommand(o)}if(q&&q._previousUndoId===this._private._lastUndoStepId){p.redoEnabled=false;p.exclusivity=true}else{p.redoEnabled=true;p.exclusivity=false}var n=new i(p);if(n){this.registerAction(n);return e.createReturnObject(k.SUCCEEDED,"PrivateUndoRedoManager.createUndoStep as succeeded, undo step created and add to undo stack.")}else{return e.createReturnObject(k.UNDO_STEP_CREATION_FAILED,"PrivateUndoRedoManager.createUndoStep as failed, undo step couldn't be created correctly.")}},registerAction:function(n){if(n===undefined||!(n instanceof i)){throw new Error("PrivateUndoRedoManager.registerAction expects a PrivateUndoStep instance as input.")}var o=null;var p=null;if(this._private._executionContext){var r=this._private._executionContext.getComponent("AFR_CommandsManager");p=r._private._runningCmd._private._command._instance}else{o=l._getCurrent();p=l.getCommand(o)}if(p){p._dirtyUndoStack=true}this._private._lastUndoStepId=n.getId();this._private._undoStack.pushStep(n);if(this._private._executionContext){var q=this._private._executionContext.getComponent("AFR_AvailabilityModesComponent");if(q){if(this._private._redoStack.getSize()>0){q.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_REDO"})}else{q.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_ONLY"})}}}this._private._redoStack.flush();return e.createReturnObject(k.SUCCEEDED,{description:"Undo step "})},startConcatenateUS:function(){var n=null;var o=null;var q=null;var p=null;if(this._private._executionContext){q=this._private._executionContext.getComponent("AFR_CommandsManager");p=q._private._runningCmd._private._command._instance;n=q._private._defaultCommand}else{o=l._getCurrent();n=l._getDefaultCommand();p=l.getCommand(o)}if(o!=n){this._private._lastUndoStepIdSaved=p._previousUndoId}else{this._private._lastUndoStepIdSaved=this._private._lastUndoStepId}},stopConcatenateUS:function(q){if(this._private._lastUndoStepIdSaved===-1){return}var n=null;var o=null;var r=null;var p=null;if(this._private._executionContext){r=this._private._executionContext.getComponent("AFR_CommandsManager");p=r._private._runningCmd._private._command._instance;if(p){o=p.getId()}n=r._private._defaultCommand}else{o=l._getCurrent();n=l._getDefaultCommand();p=l.getCommand(o)}p.askForUndoGroupingAtEnd(q);if(o==n){if(r){r.endAll(true)}else{l.endAll(undefined,true)}}},discardConcatenateUS:function(){this._private._lastUndoStepIdSaved=-1},_stopConcatenateUS:function(p){var o=this._private._undoStack.getLastStepId();if(this._private._lastUndoStepIdSaved>-1&&this._private._lastUndoStepIdSaved<o){var q=new i({undoTitle:p,exclusivity:true,redoEnabled:true});this.registerAction(q);var n=this._private._undoStack.groupSteps(q.getId(),this._private._lastUndoStepIdSaved+1);if(!e.hasSucceeded(n)){var r=this._private._undoStack.removeStepWithId(this._private._undoStack.getLastStepId());if(!e.hasSucceeded(r)){e.logResult(r)}}}},getLastCreatedUndoStepId:function(){return this._private._lastUndoStepId},flushStacks:function(){this._private._undoStack.flush();this._private._redoStack.flush();c("Undo and redo stacks have been emptied");this.displayStacksSize()},undo:function(){var n=e.createReturnObject(k.SUCCEEDED,{description:""});var s=this._private._undoStack.getSize();var t;if(s>0){if(this._private._executionContext){t=this._private._executionContext.getComponent("AFR_AvailabilityModesComponent");if(t){if(s>1){t.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_REDO"})}else{t.publish({mode:"WAFR_UNDO_REDO",value:"REDO_ONLY"})}}}var o=this._private._undoStack.popStep();if(o!==undefined){this._private._undosPending.push(o);var q=null;var r=null;var u=null;if(this._private._executionContext){u=this._private._executionContext.getComponent("AFR_CommandsManager");r=u._private._runningCmd._private._command._instance}else{q=l._getCurrent();r=l.getCommand(q)}if(r&&r._previousUndoId+1>=o.getId()&&o.getRedoEnabled()===true){o.setExclusivity(true);if(r._previousUndoId+1===o.getId()){o.setRedoEnabled(false)}}if(o.getExclusivity()&&r&&r.isCanceled()===false){if(o.getRedoEnabled()===false){this._private._undoStack.pushStep(o);var p=o.getId();this._private._endAllEventToken=g.subscribe({event:"COMMAND_MANAGER/ALL_CMD_ENDED"},function(){this._private._cleanEndAllEventToken();g.publish({event:"UNDO_"+p+"/ENDED"})}.bind(this));o=undefined;this._private._undosPending.pop()}else{this._private._endAllEventToken=g.subscribe({event:"COMMAND_MANAGER/ALL_CMD_ENDED"},function(){this._private._cleanEndAllEventToken();this._private._executeUndoPending()}.bind(this))}if(u){u.endAll(false)}else{l.endAll(undefined)}}else{this._private._executeUndoPending()}}else{n=e.createReturnObject(k.EMPTY_STACK,{description:"undo: The undo stack is empty. Nothing to undo"})}}else{n=e.createReturnObject(k.EMPTY_STACK,{description:"undo: The undo stack is empty. Nothing to undo"})}return n},onUndoExecuted:function(n,o){if(n===undefined||n<0){return undefined}else{return g.subscribe({event:"UNDO_"+n+"/ENDED"},o)}},redo:function(q){var n=e.createReturnObject(k.SUCCEEDED,{description:""});var p=this._private._redoStack.getSize();var r;if(this._private._executionContext){r=this._private._executionContext.getComponent("AFR_AvailabilityModesComponent");if(r){if(p===1){r.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_ONLY"})}else{if(p>1){r.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_REDO"})}}}}var o=this._private._redoStack.popStep();if(o){c("Redo action: "+o.getUndoTitle());this._private._redoExecutedId.push(o.getId());this._private._redoExecutedToken.push(o._onRedoExecuted(function(t){if(!t){return e.createReturnObject(k.FAILED,{description:"redo Callback: No undo step corresponding to undo event."})}var s=this._private._redoExecutedId.indexOf(t.getId());if(s>=0){if(this._private._redoExecutedToken[s]!==undefined){g.unsubscribe(this._private._redoExecutedToken[s])}this._private._redoExecutedId.splice(s,1);this._private._redoExecutedToken.splice(s,1)}this._private._undoStack.pushStep(t);m.displayStacksSize();g.publish({event:"REDO_"+t.getId()+"/ENDED",data:t.getUndoTitle()})}.bind(this)));n=o._executeRedo()}else{n=e.createReturnObject(k.EMPTY_STACK,{description:"redo: The redo stack is empty. Nothing to redo"})}return n},onRedoExecuted:function(n,o){if(n===undefined||n<0){return undefined}else{return g.subscribe({event:"REDO_"+n+"/ENDED"},o)}},displayStacksSize:function(){this._private.displayStacksSize()},getUndoRedoErrorManager:function(){return k}});return m});define("DS/AfrUndoRedoUI/UndoCmd",["UWA/Core","DS/Core/Events","DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/AfrUndoRedoUI/Private_UndoRedoManager"],function(f,b,c,a,e){var d=c.extend({_token:undefined,_disableWhenPossible:function(){if(this.isRunning()){this._disbaleOnNextEnd=true}else{this.disable()}},init:function(g){console.log("init");if(g){g.ID="Undo";g.mode="undefined";g.isAsynchronous="true";this._parent(g)}else{this._parent({ID:"Undo",mode:"undefined",isAsynchronous:"true"})}if(g&&g.executionContext){this._exeCtx=g.executionContext}this.disable();this._token=undefined;this._disbaleOnNextEnd=false;e._private._undoStack.onStackEmptied(this._disableWhenPossible.bind(this));e._private._undoStack.onStackFilled(this.enable.bind(this))},beginExecute:function(){console.log("begin");var k=false;var j=null;var h=null;if(this.isNewInfraActivated&&this._exeCtx){var g=this._exeCtx.getComponent("AFR_CommandsManager");if(g&&g.getRunningCommand()=="WAFRRedoCmd"){k=true}}else{j=a.getCommand("Redo");if(j&&j.isRunning()){k=true}}if(e._private._undoStack.getSize()===0||k){this.end()}else{var i=this;this._token=e.onUndoExecuted(e._private._undoStack.getLastStepId(),function(){b.unsubscribe(i._token);i._token=undefined;i.end()});e.undo()}if(this.isNewInfraActivated()){this.endExecute()}},endExecute:function(){console.log("undo");if(this._disbaleOnNextEnd){this._disbaleOnNextEnd=false;this.disable()}this.done()}});return d});define("DS/AfrUndoRedoUI/RedoCmd",["UWA/Core","DS/Core/Events","DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/AfrUndoRedoUI/Private_UndoRedoManager"],function(f,a,c,b,d){var e=c.extend({_token:undefined,_disableWhenPossible:function(){if(this.isRunning()){this._disbaleOnNextEnd=true}else{this.disable()}},init:function(g){if(g){g.ID="Redo";g.mode="undefined";g.isAsynchronous="true";this._parent(g)}else{this._parent({ID:"Redo",mode:"undefined",isAsynchronous:"true"})}if(g&&g.executionContext){this._exeCtx=g.executionContext}this._token=undefined;this.disable();this._disbaleOnNextEnd=false;d._private._redoStack.onStackEmptied(this._disableWhenPossible.bind(this));d._private._redoStack.onStackFilled(this.enable.bind(this))},beginExecute:function(){var j=false;var k=null;var h=null;if(this.isNewInfraActivated&&this._exeCtx){var g=this._exeCtx.getComponent("AFR_CommandsManager");if(g&&g.getRunningCommand()=="WAFRUndoCmd"){j=true}}else{k=b.getCommand("Undo");if(k&&k.isRunning()){j=true}}if(d._private._redoStack.getSize()===0||j){this.end()}else{var i=this;this._token=d.onRedoExecuted(d._private._redoStack.getLastStepId(),function(){a.unsubscribe(i._token);i._token=undefined;i.end()});d.redo()}if(this.isNewInfraActivated()){this.endExecute()}},endExecute:function(){if(this._disbaleOnNextEnd){this._disbaleOnNextEnd=false;this.disable()}this.done()},destroy:function(){if(this.isNewInfraActivated){this.endExecute()}this.done()}});return e});define("DS/AfrUndoRedoUI/Private_UndoRedoCSServices",["DS/Core/Core","DS/Core/Events","DS/AfrUndoRedoUI/Private_UndoRedoManager","DS/AfrUndoRedoUI/Private_UndoStep","DS/ApplicationFrame/Private_AfrCSController","DS/ApplicationFrame/CommandsManager","DS/CSICommandBinder/CSICommandBinder","DS/CoreUtilities/ErrorManagement"],function(f,g,k,m,h,b,j,d){var a;var l=function(){if(d.getDebugMode()){f.enableWUXConsole();a=WUX.getWUXConsole()?WUX.getWUXConsole():console}else{a=console}};var o=k.getUndoRedoErrorManager();var i=function(r){var q=r.readInt32("serverUndoStepId");g.publish({event:"UNDO_SERVER_"+q+"/EXECUTED",data:undefined})};var c=function(r){var q=r.readInt32("serverUndoStepId");g.publish({event:"REDO_SERVER_"+q+"/EXECUTED",data:undefined})};var e=function(q,r){if(q===undefined){throw new Error("PrivateUndoRedoCSServices.isUndoStepServerId : Expects the server undo step server as input parameter.")}if(!(q instanceof m)){throw new Error("PrivateUndoRedoCSServices.isUndoStepServerId: Expects the server undo step server as input parameter.")}return q.getServerUndoStepId()===r};var p=function(q,r){if(q===undefined){throw new Error("PrivateUndoRedoCSServices.isOlderUndoStepServerThan : Expects the server undo step server as input parameter.")}if(!(q instanceof m)){throw new Error("PrivateUndoRedoCSServices.isOlderUndoStepServerThan: Expects the server undo step server as input parameter.")}return q.getServerUndoStepId()<r};var n={registerServerAction:function(s){var r=false;if(s&&s.exclusiveUndo){r=true}var q=new m({exclusivity:r,serverExclusivity:s.serverExclusivity,undoTitle:s.undoTitle,serverUndoStepId:s.serverUndoStepId,undoAction:function(u){var t=this.getRedoEnabled();if(u){if(!t){return}}n.sendUndoRequest({undoStep:this,redoEnabled:t})},undoData:s.serverExclusivity,doAction:function(){n.sendRedoRequest()}});return k.registerAction(q)},removeUndoWithServerId:function(r){var q=n.findUndoStepIdFromServerId(r);if(q>=0){k._private._undoStack.removeStepWithId(q);return d.createReturnObject(o.SUCCEEDED,{description:"PrivateUndoRedoCSServices.removeUndoWithServerId: server undo step with server Id : "+r+", was successfully removed."})}},findUndoStepIdFromServerId:function(r){var q=-1;if(r===undefined){throw new Error("PrivateUndoRedoCSServices.findUndoStepIdFromServerId: method expects the server undo step server Id as input parameter.")}if(typeof r!=="number"){throw new Error("PrivateUndoRedoCSServices.findUndoStepIdFromServerId: method expects the server undo step server Id of type nummber as input parameter.")}var q=k._private._undoStack.findStepIdFromPropertyValue({propertyGetter:e,propertyValue:r});if(q<0){d.createReturnObject(o.MISSING_UNDO_STEP,{description:"PrivateUndoRedoCSServices.findUndoStepIdFromServerId: server undo step with server Id:"+r+", not found."})}return q},findFirstUndoStepServerOlderThan:function(r){var q=-1;if(r===undefined){throw new Error("PrivateUndoRedoCSServices.findFirstUndoStepServerOlderThan: method expects the server undo step server Id as input parameter.")}if(typeof r!=="number"){throw new Error("PrivateUndoRedoCSServices.findFirstUndoStepServerOlderThan: method expects the server undo step server Id of type nummber as input parameter.")}var q=k._private._undoStack.findStepIdFromPropertyValue({propertyGetter:p,propertyValue:r});if(q<0){d.createReturnObject(o.MISSING_UNDO_STEP,{description:"PrivateUndoRedoCSServices.findFirstUndoStepServerOlderThan: server undo step with server Id:"+r+", not found."})}return q},sendUndoRequest:function(r){var q={operation:"AfrUndoOperation"};if(r!==undefined&&r.redoEnabled!==undefined){if(q.inputs===undefined){q.inputs=new j.Parameters()}q.inputs.writeBool("keepRedo",r.redoEnabled)}q.callbackArgs=r;h.callInternalService(q);if(d.getDebugMode()){l();a.log("Undo operation call on server")}},sendRedoRequest:function(){var q={operation:"AfrRedoOperation"};h.callInternalService(q);if(d.getDebugMode()){l();a.log("Redo operation call on server")}},getUndoServerCallback:function(){return i},getRedoServerCallback:function(){return c},flushUndoRedoStacks:function(){var q={operation:"AfrFlushUndoRedoStacksOperation"};h.callInternalService(q);k.flushStacks()},setServerUndoRedoStacksCapacity:function(q){if(!h.isServerConnected()){return}if(q===undefined||typeof q!=="number"||q<0){throw new Error("PrivateUndoRedoCSServices.setUndoRedoStackCapacity: method expects the stacks capacity (a number >= 0) to set as input parameter.")}var s=new j.Parameters();s.writeInt32("stacksSize",q);var r={operation:"AfrChangeUndoRedoStacksSizeOperation",inputs:s};h.callInternalService(r)}};return n});define("DS/AfrUndoRedoUI/FlushUndoRedoStacksCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/AfrUndoRedoUI/Private_UndoRedoCSServices"],function(d,c,b){var a=c.extend({init:function(){this._parent({ID:"FlushUndoRedoStacksCmd",mode:"undefined"})},beginExecute:function(){b.flushUndoRedoStacks()}});return a});define("DS/AfrUndoRedoUI/UndoRedoServices",["DS/AfrUndoRedoUI/Private_UndoRedoManager","DS/AfrUndoRedoUI/Private_UndoRedoCSServices","DS/CoreUtilities/ErrorManagement"],function(e,c,a){var d=a.getErrorManager();var b={createUndoStep:function(g){if(g.exclusivity!==undefined){var f=d.createReturnObject(d.WRONG_PARAMETERS,"UndoRedoServices.createUndoStep do not support parameters.exclusivity as a valid input parameter.");d.logResult(f)}if(g.redoEnabled!==undefined){var f=d.createReturnObject(d.WRONG_PARAMETERS,"UndoRedoServices.redoEnabled do not support parameters.exclusivity as a valid input parameter.");d.logResult(f)}return e.createUndoStep(g)},setUndoRedoStacksCapacity:function(f){e._private._undoStack.setCapacity(f);e._private._redoStack.setCapacity(f);c.setServerUndoRedoStacksCapacity(f)},getUndoRedoStackCapacity:function(){return e._private._undoStack.getCapacity()},startConcatenateUS:function(){return e.startConcatenateUS()},stopConcatenateUS:function(f){return e.stopConcatenateUS(f)}};return b});