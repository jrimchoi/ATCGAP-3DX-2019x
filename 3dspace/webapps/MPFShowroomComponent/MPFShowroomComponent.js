define("DS/MPFShowroomComponent/ShowroomShopDescription",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFTooltip/Tooltip","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopServiceModel","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(f,h,a,c,e,g,d,b){var i;i=a.extend({className:"mpf-shop-description",setup:function(j){g.requiredOfPrototype(j.shopService,d,"options.shopService must be a ShopServiceModel");this.shopService=j.shopService;this.serviceTerm=j.serviceTerm||b.get("lab");this.isContextEditable=j.isContextEditable===true;this.hasSelectButton=j.hasSelectButton===true;this.selectButtonLabel=j.selectButtonLabel||b.get("getAQuote");this.onSelectButtonClicked=j.onSelectButtonClicked;this.listenTo(this.shopService,"onChange:"+d.Fields.BACKGROUND_IMAGE,this.render.bind(this));this.listenTo(this.shopService,"onChange:"+d.Fields.DESCRIPTION,this.render.bind(this))},render:function(){var k=this.shopService.getBackgroundImage();if(k){this.container.setStyle("background-image","url("+k+")")}else{this.container.addClassName("mpf-background-placeholder")}var j=[this._createTitle(),this._createDescription()];if(this.hasSelectButton===true){j.push(this._createSelectButton())}this.container.setContent([{tag:"div","class":"mpf-shop-text-container",html:j}]);return this},destroy:function(){this.stopListening();this.shopService=null;this._parent();this.container=null},_createTitle:function(){var j=f.createElement("div",{"class":"mpf-title",html:b.get("aboutUs")});if(this.isContextEditable){f.createElement("span",{"class":"mpf-required",text:"*"}).inject(j);new e({body:h.format(b.get("aboutUsTooltip"),this.serviceTerm)}).inject(j)}return j},_createDescription:function(){var j=f.createElement("div",{"class":"mpf-description-container"});var k=this.shopService.getDescription();if(f.is(k,"string")&&k.length>0){k=k.replace(/\r?\n/g,"<br />");j.setContent(k)}else{j.setContent(f.createElement("span",{text:h.format(b.get("descPlaceHolder"),this.serviceTerm),"class":"mpf-description-placeholder"}))}return j},_createSelectButton:function(){var k=this;var j=new c({value:h.ucfirst(this.selectButtonLabel),className:"primary"});j.addEvent("onClick",function(){k.onSelectButtonClicked()});return f.createElement("div",{"class":"mpf-button-container",html:j})}});return i});define("DS/MPFShowroomComponent/ShowroomCollaborationDeleteModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFServices/ObjectService","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(h,g,b,a,e,d,f){var c;c=g.extend({className:"mpf-showroom-collaboration-delete-modal",setup:function(i){d.requiredOfPrototype(i.showcaseItem,e,"options.showcaseItem must be a ShowcaseItemModel");this.showcaseItem=i.showcaseItem;this.modal=this._createModal()},render:function(){this.container.setContent(this.modal);return this},destroy:function(){this.modal.destroy();this._parent();this.container=null},show:function(){this.modal.show();return this},hide:function(){this.modal.hide();return this},_createModal:function(){var j=new a({value:f.get("delete"),className:"error"});j.addEvent("onClick",this._onDelete.bind(this));var i=new a({value:f.get("cancel"),className:"default"});i.addEvent("onClick",this.hide.bind(this));return new b({closable:true,header:h.createElement("h4",{text:f.get("removeContent")}),body:f.get("deleteConfirmationMessage"),footer:[j,i]})},_onDelete:function(){this.showcaseItem.destroy()}});return c});define("DS/MPFShowroomComponent/ShowroomShopModal",["UWA/Core","UWA/Class/View","UWA/Promise","UWA/String","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFDataProxy/Connector","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFShopModel/LogoModel","DS/MPFShopModel/BackgroundModel","DS/MPFServices/ObjectService","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldReplaceImage","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(p,b,n,o,a,c,h,j,q,k,f,l,m,e,d,g){var i;i=b.extend({className:"mpf-showroom-shop-modal",setup:function(r){m.requiredOfPrototype(r.shop,q,"options.shop must be a ShopModel");m.requiredOfPrototype(r.shopService,k,"options.shopService must be a ShopServiceModel");m.requiredOfPrototype(r.logo,f,"options.logo must be a LogoModel");m.requiredOfPrototype(r.background,l,"options.background must be a BackgroundModel");this.shop=r.shop;this.shopService=r.shopService;this.logo=r.logo;this.background=r.background;this.serviceTerm=r.serviceTerm||g.get("lab");this.maxFileSize=r.maxFileSize;this.shopNameEntry=this._createShopNameEntry();this.shopNameRemainingCharactersContainer=this._createRemainingCharactersContainer(this.shopNameEntry);this.shopLogoEntry=this._createShopLogoEntry();this.shopBackgroundEntry=this._createShopBackgroundEntry();this.shopDescriptionEntry=this._createShopDescriptionEntry();this.shopDescriptionRemainingCharactersContainer=this._createRemainingCharactersContainer(this.shopDescriptionEntry);this.modal=this._createModal();this.alert=new h({visible:true,autoHide:true});this.listenTo(this.shop,"onChange",this._onChange.bind(this));this.listenTo(this.shopService,"onChange",this._onChange.bind(this));this.listenTo(this.shopLogoEntry,"update",this._onChange.bind(this));this.listenTo(this.shopBackgroundEntry,"update",this._onChange.bind(this));this.listenTo(this.shopLogoEntry,"error",this._onFileSelectError.bind(this));this.listenTo(this.shopBackgroundEntry,"error",this._onFileSelectError.bind(this));this.listenTo(this.shopNameEntry.input.elements.input,"keyup",this._updateRemainingCharacters.bind(this));this.listenTo(this.shopDescriptionEntry.input.elements.input,"keyup",this._updateRemainingCharacters.bind(this))},render:function(){var r=p.createElement("div",{"class":"mpf-image-replace-container",html:[this.shopLogoEntry.render(),this.shopBackgroundEntry.render()]});this.modal.setBody([this.alert,this.shopNameEntry.render(),r,this.shopDescriptionEntry.render()]);this.shopNameRemainingCharactersContainer.inject(this.shopNameEntry.container.getElement(".mpf-label"),"after");this.shopDescriptionRemainingCharactersContainer.inject(this.shopDescriptionEntry.container.getElement(".mpf-label"),"after");this.alert.elements.container.setStyle("visibility","visible");this.container.setContent([this.modal]);return this},show:function(){this._storeOldValues();this.saveButton.disable();this.modal.show();return this},hide:function(){this.saveButton.load(false);this.modal.hide();this.shopLogoEntry.reset();this.shopBackgroundEntry.reset();return this},destroy:function(){this.stopListening();this.shop=null;this.shopService=null;this.logo=null;this.background=null;this._parent();this.container=null},_onChange:function(){if(this._validateModel()){this.saveButton.enable()}else{this.saveButton.disable()}},_onCancel:function(){this._restoreOldValues();this.shopLogoEntry.reset();this.shopBackgroundEntry.reset();this.hide()},_onSave:function(){var u=this.shopNameEntry.validate();var r=this.shopDescriptionEntry.validate();if(u.isValid&&r.isValid){this.saveButton.load();var s=[];if(this.shop.get(q.Fields.NAME)!==this.oldValues[q.Fields.NAME]){s.push(this.shop.savePromise(null,{method:"PUT"}))}if(this.shopService.get(k.Fields.DESCRIPTION)!==this.oldValues[k.Fields.DESCRIPTION]){s.push(this.shopDescriptionEntry.save())}s.push(this.shopLogoEntry.save());s.push(this.shopBackgroundEntry.save());var t=this;n.all(s).then(function(){t._storeOldValues();t.saveButton.load(false);t.hide()})["catch"](function(v){t.saveButton.load(false);t.alert.add({className:"error alert-error",message:g.get("modificationSaveFailure")});console.error(v.response||v.message)})}},_createRemainingCharactersContainer:function(r){return p.createElement("span",{"class":"nb-remaining-characters",text:" ("+o.format(g.get("nbRemainingCharacters"),this._getNumberRemainingCharacters(r).toString())+")"})},_updateRemainingCharacters:function(r){if(r.target.name===q.Fields.NAME){this.shopNameRemainingCharactersContainer.setText(" ("+o.format(g.get("nbRemainingCharacters"),this._getNumberRemainingCharacters(this.shopNameEntry).toString())+")")}else{if(r.target.name===q.Fields.DESCRIPTION){this.shopDescriptionRemainingCharactersContainer.setText(" ("+o.format(g.get("nbRemainingCharacters"),this._getNumberRemainingCharacters(this.shopDescriptionEntry).toString())+")")}}},_getNumberRemainingCharacters:function(s){var r=s.maxlength;var t=s.getValue().length;return r-t},_onFileSelectError:function(r){this.alert.add({className:"error",message:r.message})},_validateModel:function(){var r=this.shop.validate(q.Fields.NAME);if(r&&r.length>0){r=r.filter(function(t){return t.field===q.Fields.NAME})}var s=this.shopService.validate(this.shopService.pick(k.Fields.DESCRIPTION));if(s&&s.length>0){s=s.filter(function(t){return t.field===k.Fields.DESCRIPTION})}if((!p.is(r)||r.length===0)&&(!p.is(s)||s.length===0)){return true}else{return false}},_createModal:function(){var u;var t;var s;u=this._createModalTitle();this.saveButton=this._createSaveButton();t=this._createCancelButton();var r=new a({closable:true,header:u,footer:[this.saveButton,t]});s=this;r.getContent().getElement(".fonticon-cancel").addEvent("click",function(v){v.preventDefault();s._onCancel()});return r},_createModalTitle:function(){return p.createElement("h4",{text:o.format(g.get("editServiceModalHeader"),this.serviceTerm)})},_createSaveButton:function(){var r=this;return new c({value:g.get("save"),className:"primary",disabled:true,events:{onClick:function(){r._onSave()}}})},_createCancelButton:function(){var r=this;return new c({value:g.get("cancel"),events:{onClick:function(){r._onCancel()}}})},_createShopNameEntry:function(){return new e({model:this.shop,fieldLabel:o.ucfirst(o.format(g.get("serviceName"),this.serviceTerm)),fieldName:q.Fields.NAME,dynamicValidation:true,required:true,silent:false,readOnly:this.shop.get(q.Fields.STATE)===q.States.SUBMITTED,maxlength:60})},_createShopLogoEntry:function(){return new d({model:this.shop,imageModel:this.logo,fieldLabel:o.ucfirst(o.format(g.get("serviceImage"),this.serviceTerm)),fieldName:q.Fields.LOGO,imageShape:"round",maxFileSize:this.maxFileSize})},_createShopBackgroundEntry:function(){return new d({model:this.shopService,imageModel:this.background,fieldLabel:g.get("backgroundImage"),fieldName:k.Fields.BACKGROUND_IMAGE,maxFileSize:this.maxFileSize})},_createShopDescriptionEntry:function(){return new e({model:this.shopService,fieldLabel:o.ucfirst(o.format(g.get("serviceDescription"),this.serviceTerm)),fieldName:k.Fields.DESCRIPTION,dynamicValidation:true,silent:false,required:true,multiline:true,multilineRows:5,maxlength:500})},_storeOldValues:function(){this.oldValues={};this.oldValues[q.Fields.NAME]=this.shop.get(q.Fields.NAME);this.oldValues[q.Fields.LOGO]=this.shop.get(q.Fields.LOGO);this.oldValues[k.Fields.BACKGROUND_IMAGE]=this.shopService.get(k.Fields.BACKGROUND_IMAGE);this.oldValues[k.Fields.DESCRIPTION]=this.shopService.get(k.Fields.DESCRIPTION)},_restoreOldValues:function(){if(this.shop.get(q.Fields.NAME)!==this.oldValues[q.Fields.NAME]){this.shop.set(q.Fields.NAME,this.oldValues[q.Fields.NAME]);this.shopNameEntry.setValue(this.shop.get(q.Fields.NAME),{emitEvent:false})}if(this.shop.get(q.Fields.LOGO)!==this.oldValues[q.Fields.LOGO]){this.shop.set(q.Fields.LOGO,this.oldValues[q.Fields.LOGO])}if(this.shopService.get(k.Fields.BACKGROUND_IMAGE)!==this.oldValues[k.Fields.BACKGROUND_IMAGE]){this.shopService.set(k.Fields.BACKGROUND_IMAGE)}if(this.shopService.get(k.Fields.DESCRIPTION)!==this.oldValues[k.Fields.DESCRIPTION]){this.shopService.set(k.Fields.DESCRIPTION,this.oldValues[k.Fields.DESCRIPTION]);this.shopDescriptionEntry.setValue(this.shopService.get(k.Fields.DESCRIPTION),{emitEvent:false})}}});return i});define("DS/MPFShowroomComponent/ShowroomShopAddressTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFAddressModel/AddressModel"],function(e,d,a,b){var c;c=d.extend({className:"mpf-tile mpf-address-tile",setup:function(f){a.requiredOfPrototype(f.address,b,"options.address must be an AddressModel");this.address=f.address;this.country=f.country;this.listenTo(this.address,"onChange",this.render.bind(this))},render:function(){var g=(this.country&&this.country.getName())?this.country.getName():this.address.getCountry();var f=this.address.getCity();var h;if(e.is(f,"string")&&f.length>0){h=""+f}if(e.is(g,"string")&&g.length>0){if(h){h+=", "+g}else{h=g}}if(h){this.container.setContent([{tag:"span","class":"fonticon fonticon-3ds-where"},{tag:"div",text:h}])}return this},destroy:function(){this.stopListening();this.address=null;this._parent();this.container=null}});return c});define("DS/MPFShowroomComponent/ShowroomGalleryDeleteModal",["UWA/Core","UWA/Class/View","DS/UIKIT/SuperModal","DS/MPFServices/ObjectService","DS/MPFShowcaseItemModel/ShowcaseItemModel","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(g,f,a,c,b,d){var e;e=f.extend({className:"mpf-showroom-gallery-delete-modal",setup:function(h){c.requiredOfPrototype(h.showcaseItem,b,"options.showcaseItem must be a ShowcaseItemModel");this.showcaseItem=h.showcaseItem},render:function(){this.modal=new a({renderTo:this.container});return this},show:function(){this.modal.confirm(d.get("deleteConfirmationMessage"),d.get("deleteConfirmation"),this._handleInput.bind(this),d.get("delete"))},destroy:function(){this.showcaseItem=null;this._parent();this.modal=null;this.container=null},_handleInput:function(h){if(h===true){this.showcaseItem.destroy({onComplete:function(){}})}}});return e});define("DS/MPFShowroomComponent/MPFShowroomComponent",["UWA/Core","UWA/Class/View","DS/MPFLabMap/LabMap","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Input/File","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/PlatformAPI/PlatformAPI","DS/MPFShopModel/MediaDataProxy","DS/MPFShopModel/MediaModel","DS/MPFShopModel/BackgroundModel","DS/MPFShopModel/BackgroundDataProxy","DS/MPFShopModel/LogoModel","DS/MPFShopModel/LogoDataProxy","DS/MPFView/InitialsDot","DS/MPFView/FieldToggleInput","DS/MPFView/FieldTextInput","DS/MPFView/FieldButtonInput","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent","css!DS/MPFUI/MPFUI"],function(r,o,v,c,w,h,n,a,e,s,d,g,b,u,l,m,i,q,t,j,f,k){var p=o.extend({setup:function(x){var y=this;this._parent(x);this.connector=x.connector;this.backgroundModel=x.backgroundModel;this.disabled=x.disabled;this.editable=x.editable;this.items=x.showcaseItems;this.media=[];this.logoModel=x.logoModel;this.services=x.shopServices;d.publish("MPLabCreation",{event:"titleSet",id:"showroom",title:y.model.get("shopName")});d.subscribe("MPLabCreation",function(z){if(z.id==="showroom"||z.event==="titleGet"){switch(z.event){case"titleGet":d.publish("MPLabCreation",{event:"titleSet",id:"showroom",title:y.model.get("shopName")});break;case"widgetSaveRequest":if(y.validate()){d.publish("MPLabCreation",{event:"widgetSaveResponse",id:"showroom",saved:true})}break;default:break}}})},render:function(x){d.publish("MPLabCreation",{event:"updateMenu",id:"showroom",status:this.services.get("description")===""?"active":"complete"});this.container.setContent(this._createShowroom());this.dispatchEvent("onRender",this);return this},createPart1:function(){var D=this;var A=r.createElement("div",{"class":"mpf-fontWeightBold",html:k.get("storeURL")});var y=r.createElement("div",{"class":"mpf-standardMargin",html:k.get("urlMessage")});var B=new w({className:"mpf-srShortInput"});var C=new f({className:"mpf-srCopyButtonDiv",buttonLabel:k.get("copy"),buttonName:"copyURLButton"});var E=r.createElement("div",{"class":"mpf-srUrlDiv",html:[B,C]});if(!this.services.get("enableStoreURL")){E.addClassName("hidden")}else{this._setURL(B)}C.render();var x=new t({fieldLabel:k.get("enableURL"),fieldName:"enableStoreURL",model:this.services,saveOnChange:true,type:"switch",useStringValue:false});this.listenTo(this.services,"onChange:storeURL",function(F){if(x.isChecked()){E.removeClassName("hidden");if(B.getValue()===""){D._setURL(B)}}else{if(!E.hasClassName("hidden")){E.addClassName("hidden")}}});var z=r.createElement("div",{"class":"mpf-srToggleDiv",html:x.container});x.render();return r.createElement("div",{"class":"mpf-srPart1Div",html:[A,y,z,E]})},_setURL:function(x){var y=this},createPart2:function(){var z=r.createElement("h3",{"class":"font-3dslight mpf-srTitle",html:this.model.get("shopName")});var x;if(this.model.get("logo")){x=r.createElement("div",{"class":"mpf-icon",name:"logo"});x.setStyle("background-image","url("+this.model.get("logo")+")")}else{x=new q({title:this.model.getName()})}var y=new v({onCenterChangedCB:function(A){y.render()},defaultZoom:15});y.setShopList([this.model]);y.map.setMapPosition([this.model.getLatitude(),this.model.getLongitude()]);y.container.setStyle("height","350px");return[r.createElement("div",{"class":"mpf-srTopLeftDiv",html:[r.createElement("div",{"class":"mpf-srTitleDiv",html:z}),r.createElement("div",{"class":"mpf-iconContainerDiv",html:x}),y.container]}),r.createElement("div",{"class":"mpf-srTopRightDiv",html:this._createBgDesc(x,z)})]},createPart3:function(){return this._createShowcaseItemGallery("image")},createPart4:function(){return this._createShowcaseItemGallery("customerRef")},destroy:function(){this.model=null;this._parent();this.container=null},validate:function(){return this.services.get("description")!==""},_createBgDesc:function(F,E){var D=this;var z=r.createElement("span",{"class":"fonticon fonticon-2x fonticon-pencil"});var A=r.createElement("div",{"class":"mpf-srEditBGDiv",html:z});var x=r.createElement("div",{"class":"mpf-aboutUsDiv",html:k.get("aboutUs")});var C=r.createElement("div",{"class":"mpf-srInvalidDescDiv",html:k.get("descPlaceHolder")});var y=r.createElement("div",{"class":"mpf-labDescriptionContainerDiv",html:[x,C]});var B=r.createElement("div",{"class":"mpf-srDefaultBGDiv",html:[y]});A.addEvent("click",function(H){var G=D._createEditLabModal(F,B,C,E);G.inject(B,"before");G.show()});if(this.editable){A.inject(B,"top")}this.services.fetch({onComplete:function(G){if(G.get("description")){C.removeClassName("mpf-srInvalidDescDiv");C.addClassName("mpf-srDescDiv");C.setContent(G.get("description"))}if(G.get("background")){B.removeClassName("mpf-srDefaultBGDiv");B.addClassName("mpf-srBGDiv");B.setStyle("background-image","url("+G.get("background")+")")}}});D._disableElement(A);return B},_createConfirmationModal:function(x){var z=this;var y=new n({body:k.get("deleteConfirmationMessage"),className:"mpf-fontFamily3ds",closable:false,header:k.get("deleteConfirmation"),visible:true});var B=new a({className:"",events:{onClick:function(C){z._removeItem(x);z._destroyModal(y)}},value:k.get("delete")});var A=new a({className:"",events:{onClick:function(C){z._destroyModal(y)}},value:k.get("cancel")});y.setFooter([B,A]);return y},_createEditLabModal:function(F,N,K,P){var C=this;const M=500;const H=2097152;var I=new n({className:"mpf-fontFamilyArial",closable:false,header:k.get("editLabModalHeader")});var A=r.createElement("span",{"class":"mpf-labNameLabel",html:k.get("labName")});var D=new w({value:this.model.get("shopName")});var z=r.createElement("span",{html:k.get("labNameFooter")});var E=r.createElement("div",{html:[A,D,z]});var G=r.createElement("span",{"class":"mpf-labNameLabel",html:k.get("labDescription")});var O=r.createElement("span",{"class":"mpf-labNameLabel",html:" ("+(M-this.services.get("description").length)+k.get("charLimit")+")"});var L=r.createElement("textarea",{"class":"form-control",events:{input:function(Q){O.setContent(" ("+(M-L.value.length)+k.get("charLimit")+")")}},maxlength:M,multiline:true,rows:8,value:this.services.get("description")});var x=r.createElement("div",{html:[G,O,L]});var y=new a({className:"mpf-standardMargin save",events:{onClick:function(Q){if(!D.getValue()){D.setClassName(D.getClassNames()+" mpf-srInvalidInput")}if(!L.value){L.addClassName("mpf-srInvalidInput")}if(D.getValue()&&L.value){if(D.getValue()!==C.model.get("shopName")){D.setClassName(D.getClassNames().replace(" mpf-srInvalidInput",""));C.model.save("shopName",D.getValue(),{onComplete:function(R){P.setContent(R.get("shopName"))}})}if(L.value!==C.services.get("description")){C.services.save("description",L.value,{onComplete:function(R){d.publish("updateMenu",{showroom:"complete"});K.setContent(R.get("description"));K.removeClassName("mpf-srInvalidDescDiv");K.addClassName("mpf-srDescDiv")},patch:true})}C._saveImage({file:C.logoFile,MAX_SIZE:H,model:C.logoModel,icon:F,parentID:C.model.get("id"),type:"logo"});C._saveImage({file:C.backgroundFile,MAX_SIZE:H,model:C.backgroundModel,icon:N,parentID:C.services.get("id"),type:"background"});C._destroyModal(I)}}},value:k.get("save")});var B=new a({className:"mpf-standardMargin cancel",events:{onClick:function(Q){C.logoFile=null;C.backgroundFile=null;C._destroyModal(I)}},value:k.get("cancel")});var J=r.createElement("div",{"class":"mpf-icon"});J.setStyle("background-image",N.getStyle("background-image"));I.setBody(r.createElement("div",{html:[E,this._createIcon({icon:F,className:"mpf-labIconDiv",MAX_SIZE:H,name:"logo"}),this._createIcon({icon:J,className:"mpf-bgIconDiv",MAX_SIZE:H,name:"background"}),x,r.createElement("div",{"class":"mpf-modalButtonDiv",html:[y,B]})]}));return I},_createShowcaseItemGallery:function(F){var C=this;var y=r.createElement("span",{"class":"mpf-galleryLabel",html:F==="image"?k.get("gallery"):k.get("partners")});var D=r.createElement("span",{"class":"mpf-showYourWorkLabel",html:F==="image"?k.get("showYourWork"):""});var A;if(this.editable){A=r.createElement("div",{"class":F==="image"?"mpf-imageGalleryDiv":"mpf-customerRefGalleryDiv",events:{click:function(I){var H=C._createSCItemModal({type:F,uploadDiv:A});H.inject(x);H.show()}}})}else{A=r.createElement("div")}this.items.parentResourceId=this.services.get("id");this.items.fetch({onComplete:function(H){var I=H.toArray();var L=false;for(var K=0;K<I.length;K++){var J=I[K];if(J.get("itemType")===F){L=true;C._createSCItemDiv({image:J.get("image"),item:J,type:J.get("itemType"),uploadDiv:A}).inject(A,"before")}}if(!C.editable&&L){A.empty()}else{if(!C.editable){A.setContent(r.createElement("div",{"class":"mpf-standardCenterFont",html:k.get("noItems")}))}}}});var x=r.createElement("div",{"class":"mpf-srGalleryDiv "+F,html:[y,D,A]});var G=r.createElement("span",{"class":"fonticon fonticon-2x fonticon-popup"});var E=r.createElement("span",{"class":"mpf-displayBlock",html:k.get("dropFileMessage")});var z=r.createElement("span",{"class":"mpf-displayBlock",html:k.get("orMessage")});var B=new a({className:"primary",value:k.get("upContent")});A.setContent(r.createElement("div",{"class":F==="image"?"mpf-srImageGalleryMessageDiv":"mpf-srRefGalleryMessageDiv",html:[G,E,z,B]}));this._disableElement(A);this._disableElement(B.elements.container);return x},_createIcon:function(y){var D=this;var E=r.createElement("span",{"class":"mpf-labNameLabel",html:k.get(y.name+"Image")});var B=r.createElement("span",{"class":"fonticon fonticon-2x fonticon-refresh mpf-refreshIconSpan"});var A=r.createElement("span",{"class":"mpf-verticalAlignMiddle",html:k.get("replaceImage")});var C=new h({className:"mpf-displayNone",events:{onChange:function(G){if(G.target.files){var F=new window.FileReader();if(G.target.files[0].type.indexOf("image")!==-1&&G.target.files[0].size<y.MAX_SIZE){D[G.target.name+"File"]=G.target.files[0];F.readAsDataURL(G.target.files[0]);G.target.value="";F.onloadend=function(){var H=G.target.getParent().getParent().getParent().getParent().getChildren()[0];D[G.target.name]=F.result;if(H.getTagName()==="div"){H.className="mpf-icon";H.innerHTML="";H.setStyle("backgroundImage","url("+F.result+")")}}}else{new s({closable:true,messages:k.get("imageUploadError")}).inject(this.container)}}}},name:y.name});var z=y.icon.elements?r.clone(y.icon).elements.container:y.icon;z.classList.add("mpf-displayInlineBlock");var x=r.createElement("div",{"class":"mpf-iconDiv",events:{click:function(F){x.getElementsByTagName("input")[0].click()}},html:[z,B,A,C]});return r.createElement("div",{"class":y.className,html:[E,x]})},_createSCItemDiv:function(A){var C=this;var B=r.createElement("div",{"class":"mpf-showcaseItemDiv",id:A.item.get("id")});var x=r.createElement("div",{"class":"mpf-showcaseItemImageDiv"});x.setStyle("background-image","url("+A.image+")");if(A.type==="image"){var E=r.createElement("span",{"class":"mpf-showcaseItemTitleSpan",html:A.item.get("shortDescription")});var D=r.createElement("span",{"class":"mpf-showcaseItemSpanBase",html:A.item.get("longDescription")})}var z=r.createElement("div",{"class":"mpf-showcaseItemIcon",html:r.createElement("span",{"class":"fonticon fonticon-2x fonticon-pencil",events:{click:function(G){var F=C._createSCItemModal(Object.assign(A,{descriptionSpan:D,imageDiv:x,titleSpan:E}));F.inject(A.uploadDiv.getParent(),"top");F.show()},mouseover:function(F){z.setStyle("color","black")},mouseout:function(F){z.setStyle("color","lightgray")}},})});var y=r.createElement("div",{"class":"mpf-showcaseItemIcon",html:r.createElement("span",{"class":"fonticon fonticon-2x fonticon-trash",events:{click:function(G){var F=G.target.getParent().getParent().getParent();Object.assign(A,{item:C.items.get(F.id),itemDiv:F});C._createConfirmationModal(A).inject(C.container,"top")},mouseover:function(F){y.setStyle("color","black")},mouseout:function(F){y.setStyle("color","lightgray")}}})});if(A.type==="image"){B.setContent([x,E,D])}else{B.setContent(x)}B.setStyle("height",A.uploadDiv.getStyle("height"));if(this.editable){r.createElement("div",{html:[y,z]}).inject(B,"top")}A.uploadDiv.setStyle("width","15em");return B},_createSCItemModal:function(z){var B=this;var L=new n({closable:false,header:k.get("newContentModalHeader")});var F;if(z.type==="image"){var P=new w({className:"mpf-srTextInput",placeholder:k.get("title"),value:z.item?z.item.get("shortDescription"):""});var K=new w({multiline:true,placeholder:k.get("desc"),rows:5,value:z.item?z.item.get("longDescription"):""})}var J=function(Q){if(B.media[B.media.length-1]&&B.media[B.media.length-1].needsDisplay){B.media[B.media.length-1].needsDisplay=false;B._saveMedia(Object.assign(z,{createNew:z.item===undefined,item:Q,media:B.media[B.media.length-1]}))}B._destroyModal(L)};var x=new a({className:"primary",events:{onClick:function(S){if(z.item){var Q={};var R=false;if(z.type==="image"){if(K.getValue()!==z.item.get("longDescription")){R=true;Q.longDescription=K.getValue()}if(P.getValue()!==z.item.get("shortDescription")){R=true;Q.shortDescription=P.getValue()}}if(B.media[B.media.length-1]&&B.media[B.media.length-1].needsDisplay){B.media[B.media.length-1].needsDisplay=false;B._saveMedia(Object.assign(z,{createNew:false,media:B.media[B.media.length-1]}))}if(R){z.titleSpan.setContent(P.getValue());z.descriptionSpan.setContent(K.getValue());z.item.save(Q,{onComplete:J,patch:true})}B._destroyModal(L)}else{if(B.media[B.media.length-1]&&B.media[B.media.length-1].needsDisplay){B.items.parentResourceId=B.services.get("id");B.items.create({itemType:z.type,longDescription:z.type==="image"?K.getValue():"",shortDescription:z.type==="image"?P.getValue():""},{onComplete:J})}else{new s({closable:true,messages:k.get("imageUploadError"),visible:true}).inject(F,"top")}}}},value:k.get("save")});var C=new a({events:{onClick:function(){if(B.media[B.media.length-1]&&B.media[B.media.length-1].needsDisplay){B.media.splice(B.media.length-1,1)}B._destroyModal(L)}},value:k.get("cancel")});var A=new a({className:"error",events:{onClick:function(){B._removeItem(Object.assign(z,{itemDiv:z.imageDiv.getParent()}));B._destroyModal(L)}},value:k.get("delete")});if(z.item===undefined){A.elements.container.setStyle("display","none")}const E=2097152;var G=r.createElement("div",{"class":"mpf-newImageContentContainer"});var N=new h({className:"mpf-displayNone",events:{onChange:function(R){if(R.target.files[0].type.indexOf("image")!==-1&&R.target.files[0].size<E){var Q=new window.FileReader();Q.readAsDataURL(R.target.files[0]);B.media.push({file:R.target.files[0],needsDisplay:true});R.target.value="";Q.onloadend=function(){G.setStyle("backgroundImage","url("+Q.result+")")}}else{new s({messages:k.get("imageUploadError"),visible:true}).inject(F,"top")}}}});G.setContent(N);if(z.image!==undefined){G.setStyle("backgroundImage","url("+z.image+")")}var H=new a({events:{onClick:function(Q){N.elements.input.click()}},value:k.get("upContent")});var O=r.createElement("div",{"class":"mpf-srUploadButtonDiv",html:[H]});if(z.type==="image"){var D=r.createElement("span",{"class":"mpf-newContentLabel",html:k.get("title")});var M=r.createElement("span",{"class":"mpf-newContentLabel",html:k.get("desc")});var I=r.createElement("div",{"class":"mpf-newContentLeft",html:[G,D,M]});var y=r.createElement("div",{"class":"mpf-newContentRight",html:[O,P,K]});F=r.createElement("div",{html:[I,y]})}else{F=r.createElement("div",{"class":"mpf-textAlignCenter",html:[G,O]})}L.setFooter(r.createElement("div",{html:[x,C,A]}));L.setBody(F);return L},_createShowroom:function(){return r.createElement("div",{"class":"mpf-srContainerDiv",html:[this.createPart1(),this.createPart2(),this.createPart3(),this.createPart4()]})},_destroyModal:function(x){x.hide();x.destroy()},_disableElement:function(x){if(this.disabled){x.setAttributes({disabled:""});x.setOpacity(0.5);x.setStyle("cursor","auto");x.removeEvent("click")}},_removeItem:function(x){var y=this;x.itemDiv.remove();x.item.parentResourceId=this.model.get("id");x.item.destroy({onComplete:function(){if(y.items.toArray().filter(function(z){return z.get("itemType")===x.type}).length===0){x.uploadDiv.setStyle("width","100%")}}})},_saveImage:function(x){var y=x.icon;if(x.file){var z=null;if(x.file.type.indexOf("image")!==-1&&x.file.size<x.MAX_SIZE){z=new FormData();z.append("file",x.file)}else{new s({closable:true,messages:k.get("imageUploadError")}).inject(this.container)}x.model.clear();x.model.parentResourceId=x.parentID;x.model.save({},{data:z});if(x.type==="logo"){if(y.elements&&y.elements.container){y=y.elements.container}y.empty();y.setStyle("background-size","100%");y.addClassName("mpf-icon")}else{if(x.type==="background"){y.removeClassName("mpf-srDefaultBGDiv");y.addClassName("mpf-srBGDiv")}}y.setStyle("background-image","url("+this[x.type]+")")}},_saveMedia:function(y){var A=this;var z=new b(null,{dataProxy:new g(this.connector,y.item.get("id"))});var x=new FormData();x.append("file",y.media.file);z.parentResourceId=y.item.get("id");z.save({},{data:x,onComplete:function(B){if(y.createNew){A._createSCItemDiv(Object.assign(y,{image:B.get("image")})).inject(y.uploadDiv,"before")}else{y.imageDiv.setStyle("background-image","url("+B.get("image")+")")}}})}});return p});define("DS/MPFShowroomComponent/ShowroomShopSizeTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopServiceModel","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(f,e,b,a,c){var d;d=e.extend({className:"mpf-tile mpf-employees-tile",setup:function(g){b.requiredOfPrototype(g.shopService,a,"options.shopService nust be a ShopServiceModel");this.shopService=g.shopService;this.listenTo(this.shopService,"onChange",this.render.bind(this))},render:function(){var g=this._renderEmployeeNumber();if(f.is(g,"string")&&g.length>0){this.container.setContent([{tag:"span","class":"fonticon fonticon-users"},{tag:"div",text:g+" "+c.get("employees")}])}return this},destroy:function(){this.stopListening();this.shopService=null;this._parent();this.container=null},_renderEmployeeNumber:function(){var g=this.shopService.getNumberEmployees();if(g.length>0){var i=g[0]}if(g.length>1){var h=g[1]}if(h&&(i===null||i===0||i==="0"||i==="")){return"< "+h}else{if(i&&!h){return"> "+i}else{if(i&&h){return i+" - "+h}}}}});return d});define("DS/MPFShowroomComponent/ShowroomGalleryEditModal",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldFileInput","DS/MPFServices/ObjectService","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFShopModel/MediaModel","DS/MPFShowroomComponent/ShowroomGalleryDeleteModal","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(d,k,a,h,f,e,b,l,j,n,c,i,m){var g;g=a.extend({className:"mpf-showroom-gallery-modal",setup:function(o){j.requiredOfPrototype(o.showcaseItem,n,"options.showcaseItem must be a ShowcaseItemModel");j.requiredOfPrototype(o.mediaModel,c,"options.mediaModel must be a MediaModel");this.acceptedFileTypes=o.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"];this.maxFileSize=o.maxFileSize;this.showcaseItem=o.showcaseItem;this.mediaModel=o.mediaModel;this.editExisting=o.editExisting===true;this.Fields=n.Fields;this._createUI();this.alert=new e({visible:true,autoHide:true,hideDelay:3000,closeOnClick:true});var p=this;this.listenTo(this.showcaseItem,"onChange",p._onChange)},render:function(){this.inputContainer.setContent([this.fileInput.render(),this.titleInput.render(),this.descriptionInput.render()]);this.container.setContent([this.modal,this.deleteModal]);this.alert.inject(this.modal.getBody());return this},destroy:function(){this.stopListening();this.mediaModel.destroy();this.mediaModel=null;this.showcaseItem=null;this._parent();this.container=null},show:function(){this._saveOldValues();this.modal.show();return this},hide:function(){this.mediaModel.clear();this._hideLoadingState();this._createUI();return this.render()},validateModel:function(){var p=this.showcaseItem.validate();var o=!d.is(p)||p.length===0;if(o&&this._validateImage()&&this._validateTitle()&&this._validateDescription()>0){return true}else{return false}},validateInputs:function(){var o=[];o.push(this.titleInput.validate().isValid);o.push(this.descriptionInput.validate().isValid);if(!this._validateImage()){o.push(false);this.fileInput.showErrorMessage([{message:k.format(m.get("isRequired"),this.fileInput.fieldLabel)}])}return o.indexOf(false)<0},_validateImage:function(){return(d.is(this.showcaseItem.get(n.Fields.IMAGE))&&this.showcaseItem.get(n.Fields.IMAGE).length>0)||d.is(this.fileInput.getFile())},_validateTitle:function(){return d.is(this.showcaseItem.get(n.Fields.TITLE))&&this.showcaseItem.get(n.Fields.TITLE).length>0},_validateDescription:function(){return d.is(this.showcaseItem.get(n.Fields.DESCRIPTION))&&this.showcaseItem.get(n.Fields.DESCRIPTION).length>0},_onChange:function(){if(this.validateModel()){this.saveButton.enable()}else{this.saveButton.disable()}},_onFileChange:function(p){if(p&&this.mediaModel.isNew()){var q=this;var o=new window.FileReader();o.onload=function(){q.imagePreview.setStyle("background-image","url("+o.result+")");q._onChange()};o.onerror=function(r){console.error(r);q.alert.add({className:"error",message:m.get("fileCouldNotBeLoaded")})};o.readAsDataURL(p)}},_onSave:function(){if(this.validateInputs()){this._showLoadingState();if(!this.editExisting&&this.showcaseItem.isNew()){this.dispatchEvent("saveNewItemRequested",{showcaseItem:this.showcaseItem,mediaModel:this.mediaModel,name:"saveNewItemRequested"})}else{this.dispatchEvent("updateExistingRequested",{showcaseItem:this.showcaseItem,mediaModel:this.mediaModel,name:"updateExistingRequested"})}}},_onCancel:function(){this._restoreOldValues();this.hide()},_onDelete:function(){this.deleteModal.render().show()},_createUI:function(){var q=this;var p=d.createElement("h4",{html:this.editExisting?m.get("editImage"):m.get("addNewImage")});this.inputContainer=d.createElement("div",{"class":"mpf-form mpf-horizontal"});this.fileInput=new l({fileModel:this.mediaModel,fieldName:this.Fields.IMAGE,fieldLabel:m.get(this.Fields.IMAGE),showTextInput:true,silent:false,acceptedFileTypes:this.acceptedFileTypes,wrongFileTypeMessage:m.get("wrongFileTypeMessage"),maxFileSize:this.maxFileSize,placeholder:this.showcaseItem.get(this.Fields.IMAGE)!==""?this.showcaseItem.get(this.Fields.IMAGE):m.get("noImageSelected"),buttonText:this.showcaseItem.get(this.Fields.IMAGE)!==""?m.get("replaceImage"):m.get("chooseImage"),required:true});this.listenTo(this.fileInput,"newFileSelected",q._onFileChange);this.titleInput=new b({model:this.showcaseItem,fieldName:this.Fields.TITLE,fieldLabel:m.get(this.Fields.TITLE),placeholder:m.get(this.Fields.TITLE),required:true,dynamicValidation:true,silent:false});this.descriptionInput=new b({model:this.showcaseItem,fieldName:this.Fields.DESCRIPTION,fieldLabel:m.get(this.Fields.DESCRIPTION),placeholder:m.get("addDescription"),required:true,dynamicValidation:true,silent:false,multiline:true,multilineRows:3});this.imagePreview=d.createElement("div",{"class":"mpf-image-preview",styles:{"background-image":"url("+this.showcaseItem.get("image")+")"}});var o=d.createElement("div");this.saveButton=new f({className:"primary",value:m.get("save"),disabled:true}).inject(o);this.saveButton.addEvent("onClick",function(){q._onSave()});var r=new f({className:"standard",value:m.get("cancel")}).inject(o);r.addEvent("onClick",function(){q._onCancel()});if(this.editExisting&&!this.showcaseItem.isNew()){var s=new f({className:"error",value:m.get("delete")}).inject(o);s.addEvent("onClick",function(){q._onDelete()})}this.modal=new h({className:"site-reset",closable:true,header:p,body:[this.imagePreview,this.inputContainer],footer:o,events:{onShow:function(){q.dispatchEvent("editingModalShowing")}}});if(this.editExisting){this.deleteModal=new i({showcaseItem:this.showcaseItem})}},_showLoadingState:function(){this.saveButton.load()},_hideLoadingState:function(){this.saveButton.load(false)},_saveOldValues:function(){this.oldValues={};this.oldValues[this.Fields.TITLE]=this.showcaseItem.get(this.Fields.TITLE);this.oldValues[this.Fields.DESCRIPTION]=this.showcaseItem.get(this.Fields.DESCRIPTION)},_restoreOldValues:function(){this.showcaseItem.set(this.oldValues)}});return g});define("DS/MPFShowroomComponent/ShowroomCollaborationModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/MPFView/FieldFileInput","DS/MPFShowroomComponent/ShowroomCollaborationDeleteModal","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(g,a,f,b,c,h,e,i){var d;d=a.extend({className:"mpf-collaboration-modal",setup:function(j){this.showcaseItem=j.showcaseItem;this.acceptedFileTypes=j.acceptedFileTypes;this.maxFileSize=j.maxFileSize;if(this.showcaseItem){this.editMode=true}else{this.editMode=false}this._createModal();if(this.editMode){this.deleteModal=this._createDeleteModal()}this.alert=new b({visible:true,autoHide:true,hideDelay:3000,maximumVisibleMessages:1})},render:function(){var j=[this.modal];if(this.editMode){j.push(this.deleteModal.render())}this.container.setContent(j);this.alert.inject(this.modal.getBody(),"top");return this},destroy:function(){this.stopListening();this._clearModal();this._parent();this.container=null},show:function(){this._createModal();this.render();this.modal.show();return this},hide:function(){this.modal.hide();this._clearModal();return this},showLoading:function(){this.saveButton.load(true)},hideLoading:function(){this.saveButton.load(false)},showAlert:function(j){var l=this.alert.getMessages();for(var k=0;k<l.length;k++){this.alert.remove(l[k])}this.alert.add(j)},_onChange:function(){if(this.fileInput.file){this.saveButton.enable()}else{this.saveButton.disable()}},_clearModal:function(){if(this.saveButton){this.saveButton.destroy();this.saveButton=null}if(this.cancelButton){this.cancelButton.destroy();this.cancelButton=null}if(this.deleteButton){this.deleteButton.destroy();this.deleteButton=null}if(this.fileInput){this.fileInput.destroy();this.fileInput=null}if(this.modal){this.modal.destroy();this.modal=null}},_onSave:function(){if(g.is(this.fileInput.getFile())){if(this.editMode){this.dispatchEvent("replaceImageRequested",{showcaseItem:this.showcaseItem,file:this.fileInput.file,name:"replaceImageRequested"})}else{this.dispatchEvent("saveNewItemRequested",{file:this.fileInput.file,name:"saveNewItemRequested"})}}},_onDelete:function(){this.deleteModal.show()},_onCancel:function(){this.hide()},_onFileChange:function(k){if(k){var l=this;var j=new window.FileReader();j.onload=function(){l.imagePreview.setStyle("background-image","url("+j.result+")");l._onChange()};j.onerror=function(m){console.error(m);l.alert.add({className:"error",message:i.get("fileCouldNotBeLoaded")})};j.readAsDataURL(k)}},_createModal:function(){if(this.editMode){this.imagePreview=this._createImagePreview(this.showcaseItem.get("image"))}else{this.imagePreview=this._createImagePreview()}this.fileInput=this._createFileInput();var j=[];this.saveButton=new c({value:i.get("save"),className:"primary",disabled:true});this.saveButton.addEvent("onClick",this._onSave.bind(this));j.push(this.saveButton);this.cancelButton=new c({value:i.get("cancel"),className:"default"});this.cancelButton.addEvent("onClick",this._onCancel.bind(this));j.push(this.cancelButton);if(this.editMode){this.deleteButton=new c({value:i.get("delete"),className:"error"});this.deleteButton.addEvent("onClick",this._onDelete.bind(this));j.push(this.deleteButton)}this.modal=new f({closable:true,header:g.createElement("h4",{text:i.get("addNewLogo")}),body:[this.imagePreview,this.fileInput.render()],footer:j})},_createImagePreview:function(j){var k=g.createElement("div",{"class":"mpf-image-preview"});if(j){k.setStyle("background-image","url("+j+")")}return k},_createFileInput:function(){var j=new h({acceptedFileTypes:this.acceptedFileTypes,wrongFileTypeMessage:i.get("wrongFileTypeMessage"),maxFileSize:this.maxFileSize,fieldName:"image",fieldLabel:i.get("image"),buttonText:this.editMode?i.get("replaceImage"):i.get("chooseImage"),showTextInput:true,saveOnChange:false});this.listenTo(j,"newFileSelected",this._onFileChange.bind(this));return j},_createDeleteModal:function(){return new e({showcaseItem:this.showcaseItem})}});return d});define("DS/MPFShowroomComponent/ShowroomShopTopBar",["UWA/Core","UWA/Class/View","DS/MPFView/InitialsDot","DS/MPFShowroomComponent/ShowroomShopAddressTile","DS/MPFShowroomComponent/ShowroomShopSizeTile","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFAddressModel/AddressModel"],function(h,a,b,f,c,i,j,e,g){var d;d=a.extend({className:"mpf-showroom-shop-top-bar",setup:function(l){i.requiredOfPrototype(l.shop,j,"options.shop must be a ShopModel");this.shop=l.shop;this.address=l.address;this.shopService=l.shopService;this.country=l.country;this.logoElement=this._createLogo();if(this.address){this.addressElement=this._createAddressTile()}if(this.shopService){var k=this.shopService.getNumberEmployees();if(Array.isArray(k)&&k.length>0){this.shopSizeElement=this._createShopSizeTile()}}this.listenTo(this.shop,"onChange:"+j.Fields.NAME,this.render.bind(this));this.listenTo(this.shop,"onChange:"+j.Fields.LOGO,this._updateLogo.bind(this))},render:function(){var k=[];if(this.addressElement){k.push(this.addressElement.render())}if(this.shopSizeElement){k.push(this.shopSizeElement.render())}this.container.setContent([this.logoElement,{tag:"div","class":"mpf-right-column",html:[{tag:"div","class":"mpf-showroom-shop-title",text:this.shop.getName()},k]}]);return this},destroy:function(){this.stopListening();if(this.addressElement){this.addressElement.destroy()}if(this.shopSizeElement){this.shopSizeElement.destroy()}this.shop=null;this.address=null;this._parent();this.container=null},_createLogo:function(){return new b({title:this.shop.getName(),image:this.shop.getLogo()})},_createAddressTile:function(){return new f({address:this.address,country:this.country})},_createShopSizeTile:function(){return new c({shopService:this.shopService})},_updateLogo:function(){this.logoElement=this._createLogo();this.render()}});return d});define("DS/MPFShowroomComponent/ShowroomShop",["UWA/Core","UWA/Promise","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFDataProxy/Connector","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFShopModel/LogoModel","DS/MPFShopModel/BackgroundModel","DS/MPFServices/ObjectService","DS/MPFShowroomComponent/ShowroomShopTopBar","DS/MPFShowroomComponent/ShowroomShopDescription","DS/MPFShowroomComponent/ShowroomShopModal","DS/MPFDataProxy/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFModelFactory/ShopFactory","DS/MPFModelFactory/ShopServiceFactory","DS/MPFModelFactory/AddressFactory","DS/MPFAddressModel/AddressModel","css!DS/MPFShowroomComponent/MPFShowroomComponent"],function(k,a,e,n,c,i,m,h,r,q,g,b,d,t,o,s,l,f,j){var u;u=e.extend({className:"mpf-showroom-shop",setup:function(v){q.requiredOfPrototype(v.shop,i,"options.shop must be a ShopModel");q.requiredOfPrototype(v.shopService,m,"options.shopService must be a ShopServiceModel");q.requiredOfPrototype(v.logo,h,"options.logo must be a LogoModel");q.requiredOfPrototype(v.background,r,"options.background must be a BackgroundModel");this.shop=v.shop;this.address=v.address;this.shopService=v.shopService;this.logo=v.logo;this.background=v.background;this.country=v.country;this.editable=v.editable===true;this.serviceTerm=v.serviceTerm;this.maxFileSize=v.maxFileSize||2000000;this.hasSelectButton=v.hasSelectButton;this.selectButtonLabel=v.selectButtonLabel;this.logo.setParentResourceId(this.shop.get("id"));this.background.setParentResourceId(this.shopService.get("id"));this.topBar=this._createTopBar();this.shopDescription=this._createShopDescription();if(this.editable){this.shopEditModal=this._createShopEditModal();this.editDescriptionCommand=this._createEditDescriptionCommand()}},render:function(){var v=[this.topBar.render(),this.shopDescription.render()];if(this.editable){v.push(this.editDescriptionCommand);v.push(this.shopEditModal.render())}this.container.setContent(v);return this},destroy:function(){if(this.editDescriptionCommand){this.editDescriptionCommand.destroy()}this.topBar.destroy();this.shopDescription.destroy();this.shop=null;this.shopService=null;this.logo=null;this.background=null;this._parent();this.container=null},_onEdit:function(){this.shopEditModal.show()},_createShopDescription:function(){return new b({isContextEditable:this.editable,shopService:this.shopService,serviceTerm:this.serviceTerm,hasSelectButton:this.hasSelectButton,selectButtonLabel:this.selectButtonLabel,onSelectButtonClicked:this._onSelectButtonClicked.bind(this)})},_createTopBar:function(){return new g({shop:this.shop,shopService:this.shopService,address:this.address,country:this.country})},_createEditDescriptionCommand:function(){return new n({className:"mpf-shop-edit",icon:"pencil",events:{onClick:this._onEdit.bind(this)}})},_createShopEditModal:function(){return new d({shop:this.shop,shopService:this.shopService,logo:this.logo,background:this.background,serviceTerm:this.serviceTerm,maxFileSize:this.maxFileSize})},_onSelectButtonClicked:function(){this.dispatchEvent("onSelectButtonClicked",{shop:this.shop,shopService:this.shopService})}});u.fromShopId=function(C,E){var z;if(k.is(E,"object")){z=E}else{if(k.is(E,"boolean")){z={editable:E}}}var w;var B;var x;var v;var A;var y;var D;return p().then(function(I){var J=I[0];var F=I[1];var K=I[2];var H=I[3];y=I[4];var G=I[5];w=J.createModel(s.Types.SHOP);B=F.createModel(l.Types.SHOP_SHOP_SERVICE);x=K.createModel();v=H.createModel();w.set("id",C);B.setParentResourceId(C);D=G.createCollection("seller");return a.all([w.fetchPromise(),B.fetchPromise(),D.fetchPromise()])}).then(function(){A=y.createModel(f.Types.address,{id:w.get("address")},{parentResourceId:C});return A.fetchPromise()}).then(function(){var G;var F=A.getCountry();if(F.test(/^[A-Z]{3}$/)){G=D.getCountryWithIso3(F)}z=k.extend(z,{shop:w,shopService:B,logo:x,background:v,address:A,country:G});return new u(z)})};u.fromPublicShopId=function(C,w){w=w||{};w.editable=false;var z=w.service;var v;var B;var y;var A;var x;return t.fetchPromise().then(function(D){var E=o.getInstance(D);return a.all([E.getFactory(o.Types.SHOP),E.getFactory(o.Types.SHOP_SERVICE),E.getFactory(o.Types.LOGO),E.getFactory(o.Types.BACKGROUND)])}).then(function(E){var F=E[0];v=E[1];var G=E[2];var D=E[3];B=F.createModel(s.Types.PUBLIC_V1);B.set("id",C);A=G.createModel();x=D.createModel();return a.all([B.fetchPromise({expand:[i.Expands.SHOP_SERVICES]})])}).then(function(D){var E=D[0].getService(z);y=v.createModel(l.Types.SHOP_SHOP_SERVICE,E);w=k.extend(w,{shop:B,shopService:y,logo:A,background:x});return new u(w)})};function p(){return t.fetchPromise().then(function(v){var w=o.getInstance(v);return a.all([w.getFactory(o.Types.SHOP),w.getFactory(o.Types.SHOP_SERVICE),w.getFactory(o.Types.LOGO),w.getFactory(o.Types.BACKGROUND),w.getFactory(o.Types.ADDRESS),w.getFactory(o.Types.COUNTRY)])})}return u});define("DS/MPFShowroomComponent/ShowroomCollaborationItem",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFShowroomComponent/ShowroomCollaborationModal","DS/MPFShowroomComponent/ShowroomCollaborationDeleteModal","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFModelFactory/MediaFactory","DS/MPFServices/ObjectService","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(e,a,f,c,d,j,h,g,i){var b;b=a.extend({className:"col-xs-6 col-sm-4 col-md-3 mpf-collaboration-item",setup:function(k){g.requiredOfPrototype(k.showcaseItem,j,"options.showcaseItem must be a ShowcaseItemModel");this.showcaseItem=k.showcaseItem;this.editable=k.editable===true;this.acceptedFileTypes=k.acceptedFileTypes;this.maxFileSize=k.maxFileSize;this.image=this._createImage();if(this.editable){g.requiredOfPrototype(k.mediaFactory,h,"options.mediaFactory must me a MediaFactory if ShowroomCollaborationItem is editable");this.mediaFactory=k.mediaFactory;this.editButtonContainer=this._createEditButtons();this.editModal=this._createEditModal();this.deleteModal=this._createDeleteModal();this.listenTo(this.editModal,"replaceImageRequested",this._saveNewImage.bind(this))}this.listenTo(this.showcaseItem,"onChange",this._updateImage)},render:function(){var k=[this.image];if(this.editable){k.push(this.editButtonContainer);k.push(this.editModal.render());k.push(this.deleteModal.render())}this.container.setContent(k);return this},destroy:function(){this.stopListening();this.showcaseItem=null;this._parent();this.container=null},_updateImage:function(){this.image=this._createImage();this.render()},_saveNewImage:function(k){var l=this;this._uploadImage(k.file).then(function(m){l.showcaseItem.set("image",m.get("image"));l.editModal.hide()})["catch"](function(m){console.error(m);l.editModal.showAlert({className:"error",message:i.get("fileUploadFailed")})})},_uploadImage:function(n){var m=this.mediaFactory.createModel(h.Types.MEDIA,null,{parentResourceId:this.showcaseItem.get("id")});var k=f.deferred();var o=new FormData();o.append("file",n);var l={};l.method="POST";l.data=o;l.onComplete=k.resolve;l.onFailure=function(r,p,q){k.reject({model:r,response:p,options:q})};m.save(null,l);return k.promise},_createImage:function(){return e.createElement("div",{"class":"mpf-collaboration-item-image",styles:{"background-image":"url("+this.showcaseItem.get("image")+")"}})},_createEditButtons:function(){var k=this;return e.createElement("div",{"class":"mpf-collaboration-item-edit-buttons",html:[{tag:"span","class":"fonticon fonticon-2x fonticon-pencil",events:{click:function(){k.editModal.show()}}},{tag:"span","class":"fonticon fonticon-2x fonticon-trash",events:{click:function(){k.deleteModal.show()}}}]})},_createEditModal:function(){return new c({showcaseItem:this.showcaseItem,acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize})},_createDeleteModal:function(){return new d({showcaseItem:this.showcaseItem})}});return b});define("DS/MPFShowroomComponent/ShowroomGalleryDropZone",["UWA/Core","UWA/Class/View","UWA/Promise","UWA/String","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFView/DropZone","DS/MPFShowroomComponent/ShowroomGalleryEditModal","DS/MPFDataProxy/Connector","DS/MPFModelFactory/ShowcaseItemFactory","DS/MPFModelFactory/MediaFactory","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFShowcaseItemModel/ShowcaseItemCollection","DS/MPFShopModel/MediaModel","DS/MPFShopModel/MediaDataProxy","DS/MPFServices/ObjectService","DS/MPFError/BadArgumentError","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(f,r,c,j,k,g,h,o,d,q,t,l,s,n,b,e,p,m,i){var a;a=r.extend({className:"mpf-showroom-dropzone",setup:function(u){p.requiredOfPrototype(u.showcaseItems,n,"options.showcaseItems must be a ShowcaseItemCollection");if(!f.is(u.showcaseItems.parentResourceId)){throw new m("options.showcaseItems.parentResourceId must be defined to create ShowroomGalleryDropZone")}this.showcaseItems=u.showcaseItems;if(u.connector&&!u.mediaFactory&&!u.showcaseItemFactory){p.requiredOfPrototype(u.connector,d,"options.connector must be a Connector");this.connector=u.connector}else{p.requiredOfPrototype(u.mediaFactory,t,"options.mediaFactory must be a MediaFactory");this.mediaFactory=u.mediaFactory;p.requiredOfPrototype(u.showcaseItemFactory,q,"options.showcaseItemFactory must be a ShowcaseItemFactory");this.showcaseItemFactory=u.showcaseItemFactory}this.additionalClass=u.additionalClass;this.acceptedFileTypes=u.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"];this.maxFileSize=u.maxFileSize;if(f.is(u.additionalClass,"string")){this.container.addClassName(u.additionalClass)}this.Fields=s.Fields;this.dropZone=this._createDropZone();this.listenTo(this.dropZone,"onClick",this._createModal.bind(this));this.listenTo(this.dropZone,"onDrop",this._onDrop.bind(this))},render:function(){this.container.setContent([this.dropZone.render(),this.modal]);return this},destroy:function(){this.stopListening();this.dropZone.destroy();this.connector=null;this.showcaseItems=null;this._parent();this.container=null},_createDropZone:function(){return new h({acceptedFileTypes:this.acceptedFileTypes})},_onDrop:function(w){var v=w.files;for(var u=0;u<v.length;u++){this._createShowcaseItemOnDrop(v[u])}},_createModal:function(){var u=this;return this._createBlankShowcaseItem().then(function(v){var w;if(u.mediaFactory){w=u.mediaFactory.createModel(t.Types.MEDIA)}else{w=new b(null,{dataProxy:new e(u.connector)})}u.modal=new o({showcaseItem:v,mediaModel:w,editExisting:false,acceptedFileTypes:u.acceptedFileTypes,maxFileSize:u.maxFileSize}).inject(u.container).render().show();u.listenTo(u.modal,"saveNewItemRequested",u._onSave);u.listenTo(u.modal,"updateExistingRequested",u._onSave)})},_onSave:function(v){var u=this;this.dropZone.showLoading();v.showcaseItem.savePromise().then(function(){v.mediaModel.clear();v.mediaModel.setParentResourceId(v.showcaseItem.get("id"));return u.modal.fileInput.save()}).then(function(w){v.showcaseItem.set("image",w.get("image"));u.modal.hide();u.dropZone.hideLoading();u.showcaseItems.push(v.showcaseItem)})["catch"](function(w){u._onFileUploadFailed(v.showcaseItem,w)})},_onFileUploadFailed:function(u,v){u.destroy();this.dropZone.hideLoading();if(this.modal&&this.modal.modal&&this.modal.modal.isVisible){this.modal._hideLoadingState();this.modal.alert.add({className:"error",message:i.get("fileUploadFailed")})}else{this.dropZone.showAlert({className:"error",message:i.get("fileUploadFailed")})}console.error(v.response||v.message)},_createBlankShowcaseItem:function(){var w=this;var u;if(this.showcaseItemFactory){u=this.showcaseItemFactory.createModel("shopServiceShowcaseItem",{itemType:"image"},{parentResourceId:w.showcaseItems.parentResourceId});return c.resolve(u)}else{var v=l.getInstance(this.connector);return v.getFactory(l.Types.SHOWCASE_ITEM).then(function(y){var x=y.createModel("shopServiceShowcaseItem",{itemType:"image"},{parentResourceId:w.showcaseItems.parentResourceId});return x})}},_uploadImage:function(x,z){var w;if(this.mediaFactory){w=this.mediaFactory.createModel(t.Types.MEDIA,null,{parentResourceId:z})}else{w=new b(null,{dataProxy:new e(this.connector),parentResourceId:z})}var u=c.deferred();var y=new FormData();y.append("file",x);var v={};v.method="POST";v.data=y;v.onComplete=u.resolve;v.onFailure=function(C,A,B){u.reject({model:C,response:A,options:B})};w.save(null,v);return u.promise},_createShowcaseItemOnDrop:function(x){var v=this;var u;var w;if(f.is(x.getAsFile,"function")){w=x.getAsFile()}else{w=x}if(this.maxFileSize&&w.size>this.maxFileSize){v.dropZone.showAlert({className:"error",message:i.get(j.format(i.get("fileTooBig"),this.maxFileSize/1000000,i.get("megaByte")))});return}this.dropZone.showLoading();this._createBlankShowcaseItem().then(function(y){u=y;u.set({title:w.name.substr(0,w.name.lastIndexOf("."))});return u.savePromise()}).then(function(){return v._uploadImage(w,u.get("id"))}).then(function(y){u.set(v.Fields.IMAGE,y.get("image"));v.dropZone.hideLoading();v.showcaseItems.push(u)})["catch"](function(y){console.error(y);v._onFileUploadFailed(u,y)})}});return a});define("DS/MPFShowroomComponent/ShowroomCollaborationDropZone",["UWA/Core","UWA/Class/View","UWA/Promise","UWA/String","DS/MPFView/DropZone","DS/MPFShowroomComponent/ShowroomCollaborationModal","DS/MPFShowcaseItemModel/ShowcaseItemCollection","DS/MPFModelFactory/ShowcaseItemFactory","DS/MPFModelFactory/MediaFactory","DS/MPFServices/ObjectService","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(f,a,g,h,k,d,i,c,j,e,l){var b;b=a.extend({className:"mpf-showroom-collaboration-drop-zone",setup:function(m){e.requiredOfPrototype(m.showcaseItems,i,"options.showcaseItems must be a ShowcaseItemCollection");this.showcaseItems=m.showcaseItems;e.requiredOfPrototype(m.showcaseItemFactory,c,"options.showcaseItemFactory must be a ShowcaseItemFactory");this.showcaseItemFactory=m.showcaseItemFactory;e.requiredOfPrototype(m.mediaFactory,j,"options.mediaFactory must be a MediaFactory");this.mediaFactory=m.mediaFactory;this.acceptedFileTypes=m.acceptedFileTypes;this.maxFileSize=m.maxFileSize;this.dropZone=this._createDropZone();this.modal=this._createModal();this.listenTo(this.modal,"saveNewItemRequested",this._onSaveModal.bind(this));this.listenTo(this.dropZone,"onClick",this._onClick.bind(this));this.listenTo(this.dropZone,"onDrop",this._onDrop.bind(this))},render:function(){this.container.setContent([this.dropZone.render(),this.modal.render()]);return this},destroy:function(){this.stopListening();this.dropZone.destroy();this.modal.destroy();this._parent();this.container=null},_onDrop:function(o){var n=o.files;for(var m=0;m<n.length;m++){this._createShowcaseItemOnDrop(n[m])}},_onClick:function(){this.modal.show()},_onSaveModal:function(o){var n=this;var m;if(o.file){this.modal.showLoading();m=this._createBlankShowcaseItem();m.savePromise().then(function(p){return n._uploadImage(o.file,m.get("id"))}).then(function(p){m.set("image",p.get("image"));n.modal.hideLoading();n.modal.hide();n.showcaseItems.push(m)})["catch"](function(p){console.error(p);n.modal.showAlert({className:"error",message:l.get("fileUploadFailed")});n.modal.hideLoading()})}},_createDropZone:function(){var m=new k({acceptedFileTypes:this.acceptedFileTypes});return m},_createModal:function(){return new d({acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize})},_createBlankShowcaseItem:function(){var n=this;var m=this.showcaseItemFactory.createModel("shopServiceShowcaseItem",{itemType:"customerRef"},{parentResourceId:n.showcaseItems.parentResourceId});return m},_uploadImage:function(p,r){var o=this.mediaFactory.createModel(j.Types.MEDIA,null,{parentResourceId:r});var m=g.deferred();var q=new FormData();q.append("file",p);var n={};n.method="POST";n.data=q;n.onComplete=m.resolve;n.onFailure=function(u,s,t){m.reject({model:u,response:s,options:t})};o.save(null,n);return m.promise},_createShowcaseItemOnDrop:function(q){var o=this;var m;var p;if(f.is(q.getAsFile,"function")){p=q.getAsFile()}else{p=q}if(this.maxFileSize&&p.size>this.maxFileSize){o.dropZone.showAlert({className:"error",message:l.get(h.format(l.get("fileTooBig"),this.maxFileSize/1000000,l.get("megaByte")))});return}this.dropZone.showLoading();var n=this._createBlankShowcaseItem();n.savePromise().then(function(r){m=r;return o._uploadImage(p,m.get("id"))}).then(function(r){m.set("image",r.get("image"));o.showcaseItems.push(m);o.dropZone.hideLoading()})["catch"](function(r){console.error(r);o.dropZone.showAlert({className:"error",message:l.get("fileUploadFailed")});o.dropZone.hideLoading()})}});return b});define("DS/MPFShowroomComponent/ShowroomCollaborationGallery",["UWA/Core","UWA/Class/View","DS/MPFTooltip/Tooltip","DS/MPFShowroomComponent/ShowroomCollaborationDropZone","DS/MPFShowcaseItemModel/ShowcaseItemCollection","DS/MPFShowroomComponent/ShowroomCollaborationItem","DS/MPFModelFactory/ShowcaseItemFactory","DS/MPFModelFactory/MediaFactory","DS/MPFServices/ObjectService","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent","css!DS/MPFShowroomComponent/MPFShowroomComponent"],function(h,a,f,b,i,c,e,j,g,k){var d;d=a.extend({className:"mpf-showroom-collaboration-gallery",setup:function(l){g.requiredOfPrototype(l.showcaseItems,i,"options.showcaseItems must be a ShowcaseItemCollection");this.showcaseItems=l.showcaseItems;this.editable=l.editable===true;this.acceptedFileTypes=l.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"];this.maxFileSize=l.maxFileSize||2000000;if(this.editable){g.requiredOfPrototype(l.showcaseItemFactory,e,"options.showcaseItemFactory must be a ShowcaseItemFactory");this.showcaseItemFactory=l.showcaseItemFactory;g.requiredOfPrototype(l.mediaFactory,j,"options.mediaFactory must be a MediaFactory");this.mediaFactory=l.mediaFactory;this.dropZone=this._createDropZone()}this.title=this._createTitle();this.items=this._createItems();this.listenTo(this.showcaseItems,{onAdd:this.update.bind(this),onRemove:this.update.bind(this),onReset:this.update.bind(this)})},render:function(){var l=[];for(var n=0;n<this.items.length;n++){l.push(this.items[n].render())}if(this.editable){l.push(this.dropZone.render())}var m=h.createElement("div",{"class":"mpf-collaboration-item-container row",html:l});this.container.setContent([this.title,m]);return this},destroy:function(){this.stopListening();if(this.editable){this.tooltip.destroy();this.dropZone.destroy()}for(var l=0;l<this.items.length;l++){this.items[l].destroy()}this._parent();this.container=null},update:function(){this.items=this._createItems();if(this.editable){this.dropZone=this._createDropZone()}this.render()},_createTitle:function(){var l=h.createElement("div",{"class":"mpf-collaboration-title",text:k.get("partners")});if(this.editable){this.tooltip=new f({body:k.get("collaborationTooltip")}).inject(l)}return l},_createItems:function(){var l=[];for(var m=0;m<this.showcaseItems.size();m++){var n=this.showcaseItems.at(m);if(n.get("type")==="customerRef"||n.get("itemType")==="customerRef"){l.push(new c({editable:this.editable,mediaFactory:this.mediaFactory,showcaseItemFactory:this.showcaseItemFactory,showcaseItem:n,acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize}))}}return l},_createDropZone:function(){return new b({mediaFactory:this.mediaFactory,showcaseItemFactory:this.showcaseItemFactory,showcaseItems:this.showcaseItems,acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize,className:this._getNumberCustomerRefs()>0?"mpf-showroom-collaboration-drop-zone col-xs-6 col-sm-4 col-md-3":"mpf-showroom-collaboration-drop-zone col-xs-12"})},_getNumberCustomerRefs:function(){var m=0;for(var l=0;l<this.showcaseItems.size();l++){if(this.showcaseItems.at(l).get("type")==="customerRef"||this.showcaseItems.at(l).get("itemType")==="customerRef"){m++}}return m}});return d});define("DS/MPFShowroomComponent/ShowroomGalleryItem",["UWA/Core","UWA/Element","UWA/Class/View","DS/UIKIT/SuperModal","DS/MPFServices/ObjectService","DS/MPFDataProxy/Connector","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFShowroomComponent/ShowroomGalleryEditModal","DS/MPFShowroomComponent/ShowroomGalleryDeleteModal","DS/MPFModelFactory/MediaFactory","DS/MPFShopModel/MediaModel","DS/MPFShopModel/MediaDataProxy","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],function(f,b,a,c,k,g,n,i,j,l,d,e,m){var h;h=a.extend({className:"col-xs-6 col-sm-4 col-md-3 mpf-showroom-gallery-item",setup:function(o){k.requiredOfPrototype(o.showcaseItem,n,"options.showcaseItem must be a ShowcaseItemModel");this.showcaseItem=o.showcaseItem;if(o.connector&&!o.mediaFactory){k.requiredOfPrototype(o.connector,g,"options.connector must be a Connector");this.connector=o.connector}else{k.requiredOfPrototype(o.mediaFactory,l,"options.mediaFactory must be a MediaFactory");this.mediaFactory=o.mediaFactory}this.editable=o.editable===true;this.acceptedFileTypes=o.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"];this.maxFileSize=o.maxFileSize;this.mediaModel=this._createMediaModel();this._createUI();this.deleteModal=new j({showcaseItem:this.showcaseItem});var p=this;this.editionModal=new i({showcaseItem:this.showcaseItem,mediaModel:this.mediaModel,editExisting:true,acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize});this.listenTo(this.editionModal,"updateExistingRequested",p._onSave)},render:function(){this.container.setContent([this.content,this.editionModal.render(),this.deleteModal.render()]);this.textContainer.addEvent("mouseenter",this._shiftTextUpwards.bind(this));this.textContainer.addEvent("mouseleave",this._putTextBackInPlace.bind(this));this.textContainer.addEvent("click",this._onTextContainerClick.bind(this));this.image.addEvent("resize",this._insertArrowForLongDescriptions.bind(this));this._insertArrowForLongDescriptions();return this},destroy:function(){this.textContainer.removeEvents();this.image.removeEvents();this.stopListening();this.showcaseItem=null;this._parent();this.container=null},_createMediaModel:function(){var o;if(this.connector&&!this.mediaFactory){o=new d(null,{dataProxy:new e(this.connector)})}else{o=this.mediaFactory.createModel(l.Types.MEDIA)}return o},_createUI:function(){var o=this;this.content=f.createElement("div",{"class":"mpf-gallery-item-content"});this.imageContainer=f.createElement("div",{"class":"mpf-gallery-item-image-container"}).inject(this.content);this.image=f.createElement("div",{"class":"mpf-gallery-item-image",styles:{"background-image":"url("+this.showcaseItem.get("image")+")"},events:{click:this._openImage.bind(this)}}).inject(this.imageContainer);this.textContainer=f.createElement("div",{"class":"mpf-gallery-item-text"}).inject(this.content);this.title=f.createElement("h4",{"class":"mpf-gallery-item-title",html:this.showcaseItem.get("title")}).inject(this.textContainer);this.description=f.createElement("div",{"class":"mpf-gallery-item-description",html:this.showcaseItem.get("description")}).inject(this.textContainer);if(this.editable){this.editButtonContainer=f.createElement("div",{"class":"mpf-gallery-item-edit-buttons",html:[{tag:"span","class":"fonticon fonticon-2x fonticon-pencil",events:{click:function(){o._showEditionModal()}}},{tag:"span","class":"fonticon fonticon-2x fonticon-trash",events:{click:function(){o._showDeletionModal()}}}]}).inject(this.content)}this.downArrow=f.createElement("span",{"class":"fonticon fonticon-expand-up"}).inject(this.content)},_shiftTextUpwards:function(){if(this.isDescriptionOverflowing){this.downArrow.setOpacity(0);this.textContainer.setStyle("top",this.imageContainerHeight-this.descriptionOverFlow+"px")}},_putTextBackInPlace:function(){if(this.isDescriptionOverflowing){this.textContainer.setStyle("top",this.imageContainerHeight+"px");this.downArrow.setOpacity(1)}},_onTextContainerClick:function(){if(parseInt(this.textContainer.getStyle("top"),10)<this.imageContainerHeight){this._putTextBackInPlace()}else{this._shiftTextUpwards()}},_openImage:function(){var o=this.showcaseItem.get("image")||this.image.getStyle("background-image").slice(4,-1).replace(/"/g,"");window.open(o,"_blank")},_showEditionModal:function(){this.editionModal.show()},_showDeletionModal:function(){this.deleteModal.show()},_onChange:function(){this._createUI();this.render()},_onSave:function(){var o=this;this.showcaseItem.savePromise(null,{method:"PATCH"}).then(function(){if(f.is(o.editionModal.fileInput.file)){o.mediaModel.setParentResourceId(o.showcaseItem.get("id"));return o.editionModal.fileInput.save().then(function(p){o.showcaseItem.set("image",p.get("image"))})["catch"](function(p){o._onFileUploadFailed(p)})}}).then(function(){o.editionModal.hide();o._onChange()})["catch"](function(p){o._onSaveModificationsFailed(p)})},_onFileUploadFailed:function(o){this.editionModal._hideLoadingState();console.error(o.response||o.message);this.editionModal.alert.add({className:"error",message:m.get("fileUploadFailed")})},_onSaveModificationsFailed:function(o){this.editionModal._hideLoadingState();console.error(o.response||o.message);this.editionModal.alert.add({className:"error",message:m.get("modificationSaveFailure")})},_insertArrowForLongDescriptions:function(p){if(!p||p.target===this.image){var o=this.content.getScrolls().height;var q=this.content.getSize().height;this.descriptionOverFlow=o-q;this.imageContainerHeight=this.imageContainer.getSize().height;if(this.descriptionOverFlow>0){this.isDescriptionOverflowing=true;this.downArrow.show();this.downArrow.setOpacity(1)}else{this.isDescriptionOverflowing=false;this.downArrow.hide();this.downArrow.setOpacity(0)}}}});return h});define("DS/MPFShowroomComponent/ShowroomGallery",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShowcaseItemModel/ShowcaseItemCollection","DS/MPFDataProxy/Connector","DS/MPFModelFactory/ShowcaseItemFactory","DS/MPFModelFactory/MediaFactory","DS/MPFShowroomComponent/ShowroomGalleryItem","DS/MPFShowroomComponent/ShowroomGalleryDropZone","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent","css!DS/MPFShowroomComponent/MPFShowroomComponent"],function(c,a,g,h,e,d,i,f,b,k){var j=a.extend({className:"mpf-showroom-gallery",setup:function(l){g.requiredOfPrototype(l.showcaseItems,h,"options.showcaseItems must be a ShowcaseItemCollection");this.showcaseItems=l.showcaseItems;if(l.connector&&!l.mediaFactory&&!l.showcaseItemFactory){g.requiredOfPrototype(l.connector,e,"options.connector must be a MarketplaceConnector");this.connector=l.connector}else{g.requiredOfPrototype(l.mediaFactory,i,"options.mediaFactory must be a MediaFactory");this.mediaFactory=l.mediaFactory;g.requiredOfPrototype(l.showcaseItemFactory,d,"options.showcaseItemFactory must be a ShowcaseItemFactory");this.showcaseItemFactory=l.showcaseItemFactory}this.title=l.title||k.get("gallery");this.subtitle=l.subtitle;this.editable=l.editable===true;this.acceptedFileTypes=l.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"];this.maxFileSize=l.maxFileSize||2000000;this._createUI();this.listenTo(this.showcaseItems,{onAdd:this._onChange.bind(this),onRemove:this._onChange.bind(this),onReset:this._onChange.bind(this)});this.rendered=false},render:function(){for(var l=0;l<this.galleryItems.length;l++){this.galleryItems[l].render().inject(this.galleryContainer)}if(this.editable){this.dropZone.render().inject(this.galleryContainer)}this.container.setContent([this.titleContainer,this.galleryContainer]);this.rendered=true;return this},destroy:function(){this.stopListening();for(var l=0;l<this.galleryItems.length;l++){this.galleryItems[l].destroy()}if(this.dropZone){this.dropZone.destroy()}this.showcaseItems=null;this._parent();this.connector=null;this.container=null},_onChange:function(){this._createUI();if(this.rendered){this.render()}},_createUI:function(){this.titleContainer=c.createElement("div",{"class":"mpf-title-container",html:[{tag:"h3",text:this.title}]});if(this.subtitle!==false){c.createElement("h4",{html:this.subtitle||k.get("showYourWork")}).inject(this.titleContainer)}this.galleryContainer=c.createElement("div",{"class":"mpf-sr-gallery-item-container row"});this.galleryItems=[];for(var l=0;l<this.showcaseItems.size();l++){var m=this.showcaseItems.at(l);if(m.get("type")==="image"||m.get("itemType")==="image"){this.galleryItems.push(new f({connector:this.connector,mediaFactory:this.mediaFactory,showcaseItem:m,editable:this.editable,acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize}))}}if(this.editable){this.dropZone=new b({connector:this.connector,mediaFactory:this.mediaFactory,showcaseItemFactory:this.showcaseItemFactory,showcaseItems:this.showcaseItems,additionalClass:this._getNumberShowcaseItems()>0?"col-xs-6 col-sm-4 col-md-3":"col-xs-12",acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize})}},_getNumberShowcaseItems:function(){var m=0;for(var l=0;l<this.showcaseItems.size();l++){if(this.showcaseItems.at(l).get("type")==="image"||this.showcaseItems.at(l).get("itemType")==="image"){m++}}return m}});return j});