define("DS/VCXWebComposer3DPlayExperience/VCXWebPlayerIn3DPlayExperience",["DS/3DPlayExperienceModule/PlayExperience3D","UWA/Core","DS/VCXWebComposer/VCXWebAppHelper","DS/VCXWebComposer/VCXWebDictionary","DS/VCXWebDigger/VCXWebDiggerDictionary","DS/VCXWebKernelCommands/VCXCmdChangeComponent","DS/RuntimeView/NLSManager","DS/VCXWebInteropSMG/VCXSmgLoader","DS/WAFData/WAFData"],function(d,c,h,b,a,f,j,i,g){var e=d.extend({init:function(l){this._parent(l);var m=h.getOptions();l.commandApplication=false;var n={composerExp:{workbenchs:[{name:"VCXWebPlayer3DPlayExperience",module:"VCXWebComposer3DPlayExperience"}],visu:m.viewerOptions,ui:{displayTree:false,displayActionBar:false}}};var k=n.composerExp;this.args=c.extend(l,k,true)},dispose:function(l){var k=this._experienceBase;if(k&&k.webApplication){k.Clean()}this._parent(l)},loadAsset:function(q){if(!q){return}var n=q.asset?q.asset:this.args.input.asset;if(!n){return}var o=function(t){};var s=function(){console.error("Error in WAFData request")};var p=this;var m=function(w){var u=p._experienceBase;var v=null;if(u){if(u.webApplication){var t=u.webApplication;t.requestNewExperienceBaseAsync().then(function(x){v=x.getManager("VCXGUIManager").getGettingStartedUI();if(v){v.startLoadingExperience()}var z=x.getManager("VCXContextManager").getMainViewer();var y=new i();y._experienceProgressCB=p.onModelLoadingProgression;p.onModelLoadingStarted();p.autoReframe=false;y.LoadFromArrayBuffer(x,z,w,function(){p.onModelLoadingCompleted();if(v){v.endLoadingExperience()}y._experienceProgressCB=null})})}}};var l="";if(n.provider==="FILE"){if((n.format&&n.format.toLowerCase()==="smg")||(n.mimetype&&n.mimetype.toLowerCase()==="smg")||(n.format&&n.format.toLowerCase()==="smgs")||(n.mimetype&&n.mimetype.toLowerCase()==="smgs")){l=n.filename;var k="";if((n.requestsOptions)&&(n.requestsOptions.authentication)){k=n.requestsOptions.authentication}g.handleRequest(l,{method:"GET",authentication:k,responseType:"arraybuffer",type:"arraybuffer",onComplete:m,onProgress:o,onFailure:s})}else{alert("Format not supported:"+n.format)}}else{if(n.provider==="BUFFER"){m(n.data)}else{if(n.provider==="STREAM"){var r=n.data[0];m(r.data)}else{alert("Hoops it seems that the data is not an smg file")}}}},onPreCreate:function(k){},onPostCreate:function(k){},initExperienceBase:function(k,n){this._experienceBase=k;this._experienceBase.AddDictionary(b);this._experienceBase.AddDictionary(a);this._nlsToLoad=b.getNLSModules();this._nlsToLoad=this._nlsToLoad.concat(a.getNLSModules());var l=this.addComposerManagers();var m=this;l.loadNLS(this._nlsToLoad).then(function(o){if(n){console.warn("Should not be here : VCXWebPlayerIn3DPlayExperience.initExperienceBase");n(0)}})},addComposerManagers:function(){var m=this._experienceBase.Factory.BuildComponent("VCXExperience");m.SetID("VCXExperienceID");m.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXExperience",m);var k=this._experienceBase.getManager("VCXContextManager");if(k){k.setRootOptions({componentType:"VCXComponentOccurrenceComposer"});k.setPlayerMode();k.setExperienceIn3DPlay();k.useTraverseGraph=true;k.setTrapSelectionRequirements({pick:true,prePick:true});if((this.args)&&(this.args.options)){if(this.args.options.smgUI==="false"){k.setDisplayUIMode(false)}if(this.args.options.smgUIAssemblyPanel==="false"){k.setDisplayUIAssemblyPanelMode(false)}if(this.args.options.smgUIDressupsPanel==="false"){k.setDisplayUIDressupsPanelMode(false)}if(this.args.options.smgUIScenariosPanel==="false"){k.setDisplayUIScenariosPanelMode(false)}if(this.args.options.smgUIPropertiesPanel==="false"){k.setDisplayUIPropertiesPanelMode(false)}if(this.args.options.smgPaper==="false"){k.setDisplayPaper(false)}}}m.SetPreviewMode(true);m.addApplicationManagers();var l=this._experienceBase.getManager("VCXManipulatorManager");l.setManipulatorsRequirements({active:true});return m},onFinished:function(k){WUX.setFullscreen();if(this.options&&this.options.onAppInitialize){this.options.onAppInitialize(this,this._experienceBase);this.options.onAppInitialize=null}if(this._experienceBase&&this._experienceBase._ManagerSet&&this._experienceBase._ManagerSet.getVersions){console.log(this._experienceBase._ManagerSet.getVersions())}}});return e});