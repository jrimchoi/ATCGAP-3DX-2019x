define("DS/EditPropWidget/UI/EditPropSkeleton",["UWA/Json","DS/EditPropWidget/UI/IDCardManager","DS/EditPropWidget/constants/EditPropConstants","DS/WidgetServices/WidgetServices","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(j,c,b,i){var f=20;var d=400;var g=300;var a="EditProp_MasterContain";var h="withMenuBar";var e=c.extend({defaultOptions:{className:"",typeOfDisplay:b.ALL,setEditButton:false,displayType:b.STANDARD},init:function(l,k){var m=this;k.typeOfDisplay=k.typeOfDisplay?k.typeOfDisplay:b.ALL;k.displayType=k.displayType?k.displayType:b.STANDARD;k.className=k.className?k.className:"";k.className+=" "+a;k.className+=k.typeOfDisplay?" "+k.typeOfDisplay:"";k.name=a;k.showIdCard=k.showIdCard!==undefined?k.showIdCard:k.typeOfDisplay!==b.ONLY_EDIT_PROPERTIES;k.showFacets=k.typeOfDisplay===b.ALL;k.showExpander=k.typeOfDisplay===b.ALL;k.closeButton=b.isCloseButton(k.displayType);k.idCardOptions={events:{thumbnailClick:function(){var n=m._getFirstPropertiesModel();if(n.get("activeThumbnail")){if(m.elements.postIdCard){m.elements.postIdCard.maskThumbnail()}require(["DS/ImageManager/ImageManager","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests"],function(r,p){if(m.elements.postIdCard){m.elements.postIdCard.unmaskThumbnail()}var q=m._getFirstPropertiesModel();var o=q?q.get("objectId"):null;if(o&&(!m.elements.imageManager||m.elements.imageManager.getModelId()!==o)){if(!!m.elements.imageManager){m.elements.imageManager.destroy()}m.elements.imageManager=new r({modelId:o,tenantId:p.getTenantFromModel(q),events:{onPrimaryChange:function(s){q=m._getFirstPropertiesModel();q.set("previewUrl",s?s.url:"");var t=q?q.get("objectId"):null;if(t){m.dispatchEvent("onPrimaryChange",{id:t,image:s})}m._updateThumbnailForModel(q)}}})}if(m.elements.imageManager){m.elements.imageManager.execute()}})}else{if(m._isFacetAuthorized(b.FACET_VIEWS)){m.selectFacet(b.FACET_VIEWS)}}}}};this._parent(l,k);this._sharedOptions.readOnly=k.readOnly!==false;if(this.options.typeOfDisplay===b.ONLY_IDENTITY_CARD){this.options.setEditButton=false}this.editMode=k.editMode===true;if(this.options.typeOfDisplay===b.ALL){this.elements.containerError=this.elements.globalDiv}this.elements.mainError=UWA.createElement("div",{"class":"EditProp_MainError"}).inject(this.elements.globalDiv).hide()},setReadonlyStatus:function(k){this._sharedOptions.readOnly=k;this.onRefresh()},setOccurrences:function(k){if(this.elements.imageManager){this.elements.imageManager.destroy();delete this.elements.imageManager}this._parent(k)},_manageEvent:function(l){this._parent(l);var m=this._getCurrentSelectedFacet();var k=this._getFacetName(m);if(l.facet===k){if(l.eventID==="switchMode"){if(this.elements.postIdCard){this._manageActionVisibility()}}}},clearPanel:function(){this._parent();this._getErrorManager(function(k){k.clearAllMessages()})},_getErrorManager:function(k){var l=this;if(this.errorOverlay){k.call(null,this.errorOverlay)}else{require(["DS/ErrorWidget/ErrorWidget"],function(m){if(!l.errorOverlay){l.errorOverlay=new m(i.getWidgetObject(),l.elements.containerError,{className:"editProperties_errorManager"})}k.call(null,l.errorOverlay)})}},_addNotif:function(k){var n=k.msg;var l=k.eventID;var m=k.customClass;switch(l){case"error":n=n?n:k.json;this._addError(n,m);break;case"warning":this._addWarning(n,m);break;case"success":this._addSuccess(n,m);break;default:this._addInfo(n,m)}},_addInfo:function(m,l){var k=this;this._getErrorManager(function(n){var o=n.addInfo(m,l);k.dispatchEvent("onNotification",o)})},_addWarning:function(k,m){var l=this;this._getErrorManager(function(n){var o=n.addWarning(k,m);l.dispatchEvent("onNotification",o)})},_addSuccess:function(m,l){var k=this;this._getErrorManager(function(n){var o=n.addSuccess(m,l);k.dispatchEvent("onNotification",o)})},_addError:function(k,m){var l=this;this._getErrorManager(function(n){var o=n.displayJSONError(j.encode(k),m);l.dispatchEvent("onNotification",o)})},hideMainErrorArea:function(){this.elements.mainError.hide()},showMainErrorArea:function(k){if(k!=null&&k!=""){this.clearAllMainError();this.addMainError(k)}this.elements.mainError.show()},addMainError:function(k){new UWA.createElement("div",{text:k}).inject(this.elements.mainError)},clearAllMainError:function(){this.elements.mainError.setContent("")},showMainComponent:function(){this._parent();this.hideMainErrorArea()}});return e});define("DS/EditPropWidget/constants/EditPropConstants",[],function(){var a=150;var c=200;var b={ONLY_IDENTITY_CARD:"editProp_onlyIC",ONLY_EDIT_PROPERTIES:"editProp_onlyProperties",ALL:"editProp_all",ALL_SELECTION:"allSelection",RESTRICTED_SELECTION:"restrictSelection",NO_SELECTION:"noSelection",MVA_SEP:"|",POPUP:"editProp_popup",TRANSIENT:"editProp_transient",STANDARD:"editProp_standard",FORCE_READWRITE:"force_readWrite",FORCE_READONLY:"force_readonly",FORCE_DEFAULT:"force_default",NO_CHANGES:"no_changes",ACTION_SWITCH:"pencil",ACTION_REFRESH:"cw",ACTION_RESET:"reset",ACTION_SWYM_VIEW_CONTENT_IN_3DSWYM:"swym_view_content_in_3dswym",ACTION_SWYM_VIEW_COMMUNITY_IN_3DSWYM:"swym_view_community_in_3dswym",ACTION_SWYM_VIEW_USER_PROFILE:"swym_view_user_profile",ACTION_SWYM_VIEW_SURVEY_IN_3DSWYM:"swym_view_survey_in_3dswym",FACET_NONE:"none",FACET_VIEWS:"views",FACET_PROPERTIES:"properties",FACET_INSTANCE:"instance",FACET_ACTIVITY:"activity",FACET_SWYMCOMMENTS:"social",FACET_EBOM:"EBOMPart",FACET_SWYM_CONTENT:"swym_content",FACET_SWYM_COMMUNITY_PROPERTIES:"swym_community_properties",FACET_SWYM_USER_PROPERTIES:"swym_user_properties",FACET_SWYM_SURVEY_PROPERTIES:"swym_survey_properties",FACET_EFFECTIVITY:"Effectivity",FACET_CHANGE:"Change",FACET_PROXY:"proxyFacet",FACET_ADMIN:"adminFacet",FACET_RELATIONS:"relations",MODEL_INIT:"_Model_init",MODEL_FACET_INFO_PREFIX:"_DS_FACET_",MODEL_DS_ATTR:"_DS_ATTR_",METATYPE_BUS:"businessobject",METATYPE_REL:"relationship",METATYPE_PATH:"path",METATYPE_UNKNOWN:"unknown",MULTISEL_STD:"yes",MULTISEL_NO:"no",MULTISEL_MERGE:"merge",COLLAPSE_IC_PREFERENCE:{type:"hidden",name:"editProperty_collapseIC",label:"is IC collapse",defaultValue:"false"},TYPES:{INTEGER:"integer",REAL:"real",TIMESTAMP:"timestamp",PERSON:"person",BOOLEAN:"boolean",ENUM:"enum"},MIN_WIDTH_FOR_TABLE:c,WIDTH_SWITCH_MODE:a,VARIABLES:{minWidthForTable:c},isCloseButton:function(d){return d!==this.STANDARD}};return b});define("DS/EditPropWidget/changeAction/passThruJS",[],function(){var a="DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext";return{onReady:function(b){require([a],function(c){var g={changeIsSetChecker:function(h){return h&&h.AuthoringContextHeader&&Object.keys(h.AuthoringContextHeader).length>0}};var e=[];var f=[];for(var d in c){if(typeof c[d]==="function"){e.push(c[d]);f.push(d)}}f.forEach(function(i,h){g[i]=function(l,k){if(i!=="init"&&i!=="constructor"&&i!=="initialize"){if(typeof(enoviaServerAuthoringWidget)==="undefined"){console.log("Authoring context not initialized");if(typeof l==="function"){l({})}else{if(typeof k==="function"){k({})}}return}}var j=e[h];j.apply(c,arguments)}});b.call(null,g)},function(){b.call(null,null)})}}});define("DS/EditPropWidget/comm/CommManager",["UWA/Class"],function(b){var a=b.extend({subscriptions:[],lCurrentListId:[],_nbOfCancelReceived:0,_statusReady:"ready",_statusRunning:"running",_commName:null,_currentStatus:null,_currentListenStatus:null,init:function(c){this._currentStatus=null;this._currentListenStatus=null;this.subscriptions=[];this.lCurrentListId=[];this._nbOfCancelReceived=0;if(!c){c="default"}this._commName=c},getCommObject:function(d){var c=window.top.EP_CommManager;if(!c&&d!==true){c=window.top.EP_CommManager={}}return c},getCurrentComm:function(e){var c=this.getCommObject(e);c=c?c:{};var d=c[this._commName];if(!d&&!e){c[this._commName]={callbacks:[]}}return c[this._commName]},_removeCurrentComm:function(){var c=this.getCommObject(true);if(c){delete window.top.EP_CommManager[this._commName]}},createRunningEvent:function(c){var d=this;this.lCurrentListId=c;this._currentStatus={status:d._statusRunning,answer:d.lCurrentListId};var e=this.getCurrentComm();e.status=this._currentStatus},createReadyEvent:function(d){var c=this;this._currentStatus={status:c._statusReady,answer:d};var e=this.getCurrentComm();e.status=this._currentStatus;if(e.callbacks&&e.callbacks.length>0){e.callbacks.forEach(function(f){f.call(null,d)});this._removeCurrentComm()}},createListenEvent:function(e){var c=this;var d=this.getCurrentComm(true);if(d){if(d.status.status===c._statusReady){e.call(null,d.status.answer);this._removeCurrentComm()}else{d.callbacks.push(e)}}},getCurrentListenStatus:function(){var d=this.getCurrentComm(true);var c=null;if(d){c=d.status.status}return c},destroy:function(){this._removeCurrentComm();this._parent()}});return a});define("DS/EditPropWidget/utils/AttributesUtils",["UWA/Array","DS/WidgetServices/WidgetServices","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(c,b,d){var a={defaultOptions:{},validateModels:function(j){var h=this;var k=null;var e=j.length;for(var g=0;g<e;g++){var f=j[g];k=h._validateAllAttributes(f)}return k},validateAttributes:function(f,h){var g=this;var i=[];var e=[];h.forEach(function(p){var o=p?p.name:null;if(o){var k=p.get("error");if(k.server!==true){p.resetError()}var j=p.valueDB;var m=null;if(f.isMergedModel()){var n=Object.keys(j);if(n.length>0){m=n[0]}}if(m!=null){j=j[m]}j=j?j:p.get("readOnly")===true?null:m!=null?p.value[m]:p.value;if(j!==null){var l=g.checkValueForAttribute(p,j,e);if(l&&l.message){p.setError(l.message,l.type)}}}});if(e.length>0){e.forEach(function(j){var k={customClass:f.get("objectId")?"EP_Warning_"+f.get("objectId")+"_"+j.attrName:null,message:j.message,code:"ERROR",eventID:"warning"};i.push(k)})}else{i=null}return i},checkValueForAttribute:function(j,e,g){var i=this;var h=j?j.name:null;var f={message:null,type:null};if(h&&j.get("readOnly")!==true){var k=j.label;k=k?k.toLowerCase():"";if(e!==null){if(!Array.isArray(e)){e=[e]}e.every(function(n){var q=null;if(typeof j.validationFunction==="function"){q=j.validationFunction(j)}if(q){f=i.addError(g,j,j.label,q.message);f.type=q.type}if(j.mandatory===true){var o=n+"";var l=new RegExp(" ","g");var u="";o=o.replace(l,u);if(o===""){f=i.addError(g,j,k,"MandatoryAttribute")}}if(j.maxlength>0){if(n.length>j.maxlength){f=i.addErrorWithValue(g,j,k,j.maxlength,"MaxLengthAttribute")}}if(j.type==="real"||j.type==="integer"){var o=n;if(c.isArray(o)){o.forEach(function(x){if(isNaN(x)){f=i.addErrorWithValue(g,j,j.label,x,"NotaNumber")}})}else{if(isNaN(o)){f=i.addErrorWithValue(g,j,j.label,o,"NotaNumber")}else{if(j.type==="integer"&&o%1!=0){f=i.addErrorWithValue(g,j,j.label,o,"IntegerIsDecimal")}}}}if(j.minval!==""){var s=parseFloat(j.minval);var v=j.value;if(c.isArray(v)){v.forEach(function(y){var x=parseFloat(y);if(x<s){f=i.addErrorWithValue(g,j,j.label,y,"OutOfMinVal")}if(!j.minvalincluded&&x===s){f=i.addErrorWithValue(g,j,j.label,y,"OutOfMinVal")}})}else{var t=parseFloat(j.value);if(t<s){f=i.addErrorWithValue(g,j,j.label,j.value,"OutOfMinVal")}if(!j.minvalincluded&&t===s){f=i.addErrorWithValue(g,j,j.label,j.value,"OutOfMinVal")}}}if(j.maxval!==""){var r=parseFloat(j.maxval);var v=j.value;if(c.isArray(v)){v.forEach(function(y){var x=parseFloat(y);if(x>r){f=i.addErrorWithValue(g,j,j.label,y,"OutOfMaxVal")}if(!j.maxvalincluded&&x===r){f=i.addErrorWithValue(g,j,j.label,y,"OutOfMaxVal")}})}else{var t=parseFloat(j.value);if(t>r){f=i.addErrorWithValue(g,j,j.label,j.value,"OutOfMaxVal")}if(!j.maxvalincluded&&t===r){f=i.addErrorWithValue(g,j,j.label,j.value,"OutOfMaxVal")}}}var m=j.get("forbiddenChar");if(m){var o=n;var p=b.commonChar(o,m,true);if(p>0){var w=d.replace(d.get("ForbiddenCharacters"),{label:j.label,badChars:m});g.push({message:w,attrName:j.getIdentifier()});f.message=w;f.type="error"}}return f.message===null})}return f}},_validateAllAttributes:function(f){var g=this;var h=null;var e=f.values();h=g.validateAttributes(f,e);return h},addErrorWithValue:function(g,j,f,k,e){var i=d.get(e);var h=d.replace(d.get(e),{label:f,value:k});g.push({message:h,attrName:j.getIdentifier()});return{message:h,type:"error"}},addError:function(g,j,f,e){var i=d.get(e);var h=d.replace(d.get(e),{label:f});g.push({message:h,attrName:j.getIdentifier()});return{message:h,type:"error"}}};return a});define("DS/EditPropWidget/models/HistoryObjectModel",[],function(){var a=function(b){this.name="";this.type="";this.revision="";this.id="";for(var c in b){this[c]=b[c]}this.set=function(d,e){if(e!==undefined){this[d]=e}};this.get=function(d){return this[d]}};return a});define("DS/EditPropWidget/buttonsBar/ButtonsBar",["UWA/Controls/Abstract","DS/Controls/TooltipModel","DS/Controls/Button","DS/UIKIT/DropdownMenu","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(g,b,c,a,e){var f=38;var d=g.extend({defaultOptions:{vertical:false,minimumSize:0},init:function(h,i){this._parent(h);this.elements.container=UWA.createElement("div",{"class":"buttonsBar "+(h.classname?h.classname:"")+(h.vertical?" vertical":"")});if(this.options.minimumSize<0&&!i){i=this.elements.container}this.elements.previous=UWA.createElement("div",{"class":"buttonsList"});this.elements.comboButton=new c({value:"dropdownAction",tooltipInfos:new b({shortHelp:e.dropActions,mouseRelativePosition:true}),icon:{iconName:"chevron-down",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"lite"});this.elements.dropdown=new a({target:this.elements.comboButton.getContent(),items:[]});this.elements.comboButton.hide();this.elements.after=UWA.createElement("div",{"class":"buttonsList"});this.elements.previous.inject(this.elements.container);this.elements.comboButton.inject(this.elements.container);this.elements.after.inject(this.elements.container);this._limitingDiv=i;this._availableSize=0;this._sizeButtons=null;this._buttons={}},addButton:function(k,j){var i=new c({value:k.name,tooltipInfos:new b({shortHelp:k.text,mouseRelativePosition:true}),icon:{iconName:k.icon,fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"lite",type:k.type,onClick:function(){if(k.handler){k.handler()}}});var h=this.elements.after;if(k.after!==true){h=this.elements.previous;this.elements.dropdown.addItem({text:k.text,name:k.name,fonticon:k.icon,handler:k.handler})}i.inject(h);this._buttons[k.name]={element:i,options:UWA.clone(k)};this._sizeButtons+=f;if(j!==false){this.refresh()}},addButtons:function(i){var h=this;i.forEach(function(j){h.addButton(j,false)});this.refresh()},setButtons:function(h){this.elements.previous.empty();this.elements.after.empty();this.clearButtons();this.addButtons(h)},destroy:function(){this.clearButtons();this._parent.apply(this,arguments)},clearButtons:function(){for(var h in this._buttons){this._buttons[h].element.destroy();this.elements.dropdown.removeItem(h)}this._buttons={};this._sizeButtons=0},hideButton:function(h){this.elements.dropdown.disableItem(h);var i=this._buttons[h];if(i){i.options._visible=false}this._sizeButtons-=f;this.refresh()},showButton:function(h){this.elements.dropdown.enableItem(h);var i=this._buttons[h];if(i){i.options._visible=true}this._sizeButtons+=f;this.refresh()},updateButton:function(i,h){h.id=i;h.name=i;var k={id:i,name:i};if(h.text){k.text=h.text}if(h.icon){k.fonticon=h.icon}this.elements.dropdown.updateItem(k);var j=this._buttons[i];if(j){if(h.text){j.element.getModel().tooltipInfos.shortHelp=h.text}if(h.icon){j.element.getModel().icon={iconName:h.icon,fontIconFamily:WUXManagedFontIcons.Font3DS}}}},onResize:function(){if(!!this._limitingDiv&&this.options.minimumSize!==0){var i=this._limitingDiv;var j=this.options.minimumSize;if(this.options.minimumSize<0){i=this._limitingDiv.getParent();j=0}if(i){var h=i.getSize();var k=this.options.vertical?h.height:h.width;this._availableSize=k-this.options.minimumSize}}this.refresh()},refresh:function(){if(!!this._limitingDiv&&this.options.minimumSize){if(this._availableSize!==0&&this._availableSize<this._sizeButtons){var h=null;for(var j in this._buttons){if(this._buttons[j].options.after!==true){if(h!==null){if(h!==false){h.element.hide();this.elements.comboButton.show()}h=false;this._buttons[j].element.hide()}else{h=this._buttons[j]}}}}else{this.elements.comboButton.hide();for(var j in this._buttons){var i=this._buttons[j];if(i.options._visible!==false){i.element.show()}}}}}});return d});define("DS/EditPropWidget/models/EditPropAttributeModel",[],function(){var a=function(b){this._identifier=null;this.isTransient=false;this.name="";this.label="";this.select="";this.path="";this.value="";this.valueDB="";this.type="text";this.tw_type=null;this.authorizedValues=[];this.authorizedValuesNLS=[];this.authorizedValuesRequired=true;this.dimension="";this.unitName=null;this.dimensionType=null;this.maxlength=-1;this.positionUI="0";this.positionIdentityCard=-1;this.sectionIdentityCard="";this.masked=true;this.forbiddenChar=null;this.mandatory=false;this.modified=false;this.multiline=false;this.multivalue=false;this.multisel=false;this.readOnly=true;this.minval="";this.maxval="";this.minvalincluded=false;this.maxvalincluded=false;this.attributeID="";this.facet="";this.section="";this.urlIcon=null;this.from=null;this.navType=null;this.relation=null;this.initialsValues={value:"",valueDB:""};this.error={message:null,type:"error"};this.validationFunction=function(){};for(var c in b){this[c]=b[c]}this.getIdentifier=function(){var d=this._identifier;if(!d){d="";d+=this.facet?this.facet+"-":"";d+=this.path;this._identifier=d}return d};this.set=function(d,e){if(e!==undefined){this[d]=e;if(d!=="modified"){this.modified=true}}};this.saveInitialValues=function(){for(var d in this.initialsValues){this.initialsValues[d]=UWA.clone(this[d])}};this.resetError=function(){this.error={message:null,type:"error"}};this.setError=function(f,e,d){if(f){if(!e){e="error"}this.error={message:f,type:e,server:d===true}}};this.resetInitialValues=function(){for(var d in this.initialsValues){this[d]=UWA.clone(this.initialsValues[d])}};this.get=function(d){return this[d]};this.isSameValueSet=function(f){var e=true;e=!(f.value===null||this.value===null||f.valueDB===null||this.valueDB===null);if(e){if(this.multisel){for(var d in this.value){e=e&&this._isSameValueSet(f.value[d],this.value[d],f.valueDB[d],this.valueDB[d]);if(!e){break}}}else{e=this._isSameValueSet(f.value,this.value,f.valueDB,this.valueDB)}}return !e},this._isSameValueSet=function(g,e,h,k){var d=true;if(this.type==="boolean"){d=h===k||((h+"").toLowerCase()===(k+"").toLowerCase())}else{var j=g.length;d=j===e.length;if(d){if(this.type!=="relation"){for(var f=0;f<j;f++){d=g[f]===e[f];if(!d){break}}}if(d){j=h.length;d=j===(k?k.length:0);for(var f=0;f<j;f++){d=h[f]===k[f];if(!d){break}}}}}return d},this.getChangedIds=function(){var f={};if(this.multisel===true){for(var e in this.value){var g=this.value[e];var h=this.valueDB[e];var d=d&&this._isSameValueSet(this.initialsValues.value[e],g,this.initialsValues.valueDB[e],h);if(!d){f[e]={value:g,valueDB:h}}}}else{f.a={value:this.value,valueDB:this.valueDB}}return f};this.hasChanged=function(){return this.isSameValueSet(this.initialsValues)}};return a});define("DS/EditPropWidget/controllers/EditPropUIController",["UWA/Class"],function(a){var b=a.extend({defaultOptions:{},init:function(d,c){this.editPropModelList=d;this._parent(c)},setModels:function(c){this.editPropModelList=c},getModels:function(){return this.editPropModelList},getModel:function(c){var d=this;var e=null;this.editPropModelList.every(function(f){var g=true;if(c==f.get("objectId")){e=f;g=false}return g});return e},getModifiedModels:function(){var c=[];this.editPropModelList.forEach(function(d){if(d.get("isTransient")!==true){var e=d.getChangedValues();if(Object.keys(e).length>0){c.push(d)}}});return c},getLabel:function(){var c="";if(this.editPropModelList.length===1){c=this.editPropModelList[0].get("label")}return c}});return b});define("DS/EditPropWidget/ajaxRequests/MultipleAsynchronousRequests",[],function(){var a=function(d,f){var c={};var e=d.length;var b=f;this.setAnswer=function(h,g){if(d.indexOf(h)>=0){if(c[h]===undefined){e--}c[h]=g}if(e<=0&&b!==null){b.call(this)}},this.getAnswer=function(g){return c[g]}};return a});define("DS/EditPropWidget/comm/EventManager",["UWA/Class"],function(b){var a=0;var c=b.singleton({init:function(){this._parent.apply(this,arguments);this._events={};this._queueStack=[]},publish:function(d){var i=this;a++;var h={index:a};var g=this._events[d];Array.prototype.shift.apply(arguments);var e=arguments;if(g){g.forEach(function(j){i._queueStack.push({callback:j,context:h,args:e})})}var f=null;while((f=this._queueStack.shift())){f.callback.apply(f.context,f.args)}},subscribe:function(d,f){var e=this._events[d];if(!e){e=[];this._events[d]=e}e.push(f)},remove:function(d,g){var f=this._events[d];if(f){var e=-1;while((e=f.indexOf(g))>=0){f.splice(e,1)}if(f.length==0){delete this._events[d]}}}});return c});define("DS/EditPropWidget/models/EditPropModel",["UWA/Class/Model","UWA/Class/Debug","DS/WidgetServices/WidgetServices","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/constants/EditPropConstants","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(f,d,e,a,c){var b=f.extend(d,{METATYPE_BUS:c.METATYPE_BUS,METATYPE_REL:c.METATYPE_REL,METATYPE_PATH:c.METATYPE_PATH,changedValues:{},_locked:false,_lockedAttributes:[],_initProperties:{},defaults:{metatype:c.METATYPE_UNKNOWN,source:"3DSpace",sourceName:"",tenant:e.getTenantID(),objectId:"",label:"",labelAttribute:"",type_icon_url:"",previewUrl:"",isTransient:false,_changeId:"",},isMergedModel:function(){return false},getOptions:function(){var g={};for(var h in this.defaults){g[h]=this.get(h)}return g},lockModel:function(g){var h=this;this._locked=g===true;if(!this._locked){this._lockedAttributes.forEach(function(j){var i=h.get(j);if(i!=null){i=new a(i);h.set(j,i)}});this._lockedAttributes=[]}},isLocked:function(){return this._locked===true},setFloatingAttribute:function(h,i,g){if(!this.isLocked()){if(g!==true){i=new a(i)}this.set(h,i)}else{this._attributes[h]=i;if(this._lockedAttributes.indexOf(h)<0){this._lockedAttributes.push(h)}}},getComputedTitle:function(){var g=this.get("label");return g},setup:function(){this._lockedAttributes=[];this._locked=false;this.changedValues={};this._initProperties={};for(var g in this.defaults){this._initProperties[g]=this.get(g)}},getChangeId:function(){return this.get("_changeId")},getTenant:function(){return this.get("tenant")},saveInitialValues:function(h,i){var k=this;var j=this.keys();var g=[];j.forEach(function(l){var m=k.get(l);if(m!==null&&typeof m==="object"&&typeof m.saveInitialValues==="function"&&(h==null||h.indexOf(l)>=0)){m.saveInitialValues();g.push(l)}});if(i!==false){this._dispatchChangedAttributes(k,g,false)}this._clearChangedValue(h);this.modelSaved()},isTransientModel:function(){return this.get("isTransient")},getAttributeFromField:function(l,k,j){var i=this;j=j?j:0;var g=[];var h=this.keys();h.every(function(m){var n=i.get(m);if(n!==null&&typeof n==="object"&&typeof n.get==="function"){if(n.get(l)===k){g.push(n)}}return j===0||g.length<j});return j===1?g.length>0?g[0]:null:g},resetInitialValues:function(){var h=this;var g=this.keys();g.forEach(function(i){var j=h.get(i);if(j&&typeof j==="object"&&typeof j.resetInitialValues==="function"){j.resetInitialValues();h._dispatchChangedAttributes(h,[i],true)}});this._clearChangedValue()},resetAllErrors:function(g){var i=this;var h=this.keys();h.forEach(function(j){var k=i.get(j);if(k&&typeof k==="object"&&typeof k.resetError==="function"){k.resetError();if(g!==false){i._dispatchChangedAttributes(i,[j],true)}}})},clearChangedValue:function(g){this._clearChangedValue(g)},_clearChangedValue:function(h){var g=this;if(h){h.forEach(function(i){g._removeChangedValue(i)})}else{this.changedValues={}}},removeChangedValue:function(g){this._removeChangedValue(g)},_removeChangedValue:function(g){if(this.changedValues[g]){delete this.changedValues[g]}},attributeHasChanged:function(g){return this.changedValues[g]?true:false},removeEvent:function(g,h){this.removeEvent2("onChange:"+g,h)},removeEvent2:function(g,k){var l=this._dispatchers[g];if(l){var m=l.bindings.length;for(var h=m-1;h>=0;h--){var j=l.bindings[h];if(j.listener===k){l.bindings.splice(h,1)}}}},getChangedValues:function(){return this.changedValues},setChangedValues:function(g){if(typeof g==="object"){this.changedValues=g}},hasSameAttributesThan:function(g){var i=Object.keys(this._attributes);var h=Object.keys(g._attributes);var j=false;if(i.length===h.length){j=true;i.every(function(k){if(h.indexOf(k)<0){j=false}return j})}return j},onChange:function(g){var h=this._getChangedAttributes(g);if(h.length>0){this._dispatchChangedAttributes(g,h,false)}},_getChangedAttributes:function(g){var l=g.changedAttributes();var i=[];for(var h in l){var k=l[h];var j=false;if(k instanceof a){j=k.hasChanged();if(j){g.changedValues[h]=k}else{j=g.changedValues[h]!==undefined?true:false;if(j){delete g.changedValues[h]}j=j||!this._previousAttributes[h]}if(j){i.push(h)}}}return i},_dispatchChangedAttributes:function(i,h,g){var k=this;var j=[];h.forEach(function(l){if(g){k.dispatchEvent("onChange:"+l)}j.push(i.get(l))});this.dispatchEvent("onChangeAttributes",[i,j])},modelSaved:function(){this.dispatchEvent("onSave")},getAllAttributes:function(){return this._attributes}});return b});define("DS/EditPropWidget/models/CommonAbstract",["DS/EditPropWidget/comm/EventManager","UWA/Controls/Abstract"],function(a,d){var c=0;var b=d.extend({_callbacks:{},init:function(e){c++;if(e&&!e.eventThread){e.eventThread="CT"+c}this._parent.apply(this,arguments);this._callbacks={}},publishEvt:function(f){var e=this._getEventThread(f);arguments[0]=e;a.publish.apply(a,arguments)},subscribeEvt:function(g,h,e){var f=this._getEventThread(g);arguments[0]=f;a.subscribe.apply(a,arguments);this._callbacks[f]=h},destroy:function(){for(var e in this._callbacks){a.remove(e,this._callbacks[e])}this._parent.apply(this,arguments)},_getEventThread:function(e){var f=this.options.eventThread?this.options.eventThread+".":"";return f+e},_callMethodOnEach:function(e,h){var f=e;var i=h;Array.prototype.shift.apply(arguments);Array.prototype.shift.apply(arguments);for(var g in f){f[g][i].apply(this,arguments)}}});return b});define("DS/EditPropWidget/constants/ConstantsMapping",["DS/EditPropWidget/constants/EditPropConstants","DS/WidgetServices/WidgetServices","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(b,e,d){var a={"3dspace":{name:"3DSpace",fedPrefix:"physicalid",require:"DS/EditPropWidget/ajaxRequests/3DSpaceAjaxRequests"},drive:{name:"3DDrive",fedPrefix:"physicalid",isSource:true,require:"DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests"},"3dswym":{name:"3DSwym",fedPrefix:"resourceid",modelRequired:true,modelNeeded:true,require:"DS/SwymUnifiedSearch/script/customization/editprop-ajax-requests/swym-ajax-requests"},fedsearch:{name:"3DSearch",require:"DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests"}};var c={getSupportedServices:function(){return a},getSupportedServicesArray:function(){var h=this.getSupportedServices();var g=[];var f=[];for(var i in h){var j=h[i];if(j.modelRequired!==true){if(j.isSource){g.push(j.id?j.id:i)}else{f.push(j.name)}}}return{sources:g,services:f}},getServiceForModel:function(f){var i=null;var h=null;if(f){h=f.get("_sourceId");i=a[h];if(!i){var g=f.get("sourceName");if(g){h=g.toLowerCase();i=a[h]}if(!i){g=f.get("source");if(g){h=g.toLowerCase();i=a[h]}}f.set("_sourceId",h)}}return i},getMapping:function(f){var g={};g[b.FACET_ACTIVITY]={require:"DS/EditPropWidget/facets/History/History",facet:{name:b.FACET_ACTIVITY,text:d.get("Activity"),icon:"clock"}};g[b.FACET_VIEWS]={require:"DS/EditPropWidget/facets/3DPlay/3DPlayFacet",webInWin:false,facet:{name:b.FACET_VIEWS,text:d.get("Views"),icon:"eye"}};g[b.FACET_PROPERTIES]={alwaysCalled:true,supportMerge:true,require:"DS/EditPropWidget/facets/Properties/EditPropController",options:f,actions:[b.ACTION_SWITCH,b.ACTION_RESET],facet:{name:b.FACET_PROPERTIES,text:d.get("Properties"),icon:"attributes"}};g[b.FACET_SWYMCOMMENTS]={require:"DS/EditPropWidget/facets/SwymComments/SwymComments",services:["comment"],content:null,facet:{name:b.FACET_SWYMCOMMENTS,text:d.get("Social"),icon:"comment"}};g[b.FACET_EBOM]={supportMerge:true,require:"DS/EditPropWidget/facets/EBOMPart/EBOMPart",options:f,actions:[b.ACTION_SWITCH,b.ACTION_RESET],facet:{name:b.FACET_EBOM,text:d.get("EBOMPart"),icon:"table"}};g[b.FACET_EFFECTIVITY]={alwaysVisible:false,roles:["CSV","InternalDS"],require:"DS/CfgWebAppEffectivityUX/facets/EffectivityFacet",options:f,facet:{name:b.FACET_EFFECTIVITY,text:d.Effectivity,icon:"survey"}};g[b.FACET_CHANGE]={alwaysVisible:false,roles:["CAP","CHG","COR","DAR","FCD","FME","FRA","FTM","GLS","PDA","PDE","PDM","PPE","QUC","SPM","TRM","UWE","UXG","ENO_ECM_TP","InternalDS"],options:f,require:"DS/ENOChgActionProp/facets/ChangePropertiesFacet",facet:{name:b.FACET_CHANGE,text:d.Change,icon:"change"}};g[b.FACET_PROXY]={require:"DS/OSLCConsumer/facets/ProxyFacet",calledIfVisible:true,facet:{name:b.FACET_PROXY,text:d.get("ProxyFacet"),icon:"link"}};g[b.FACET_INSTANCE]={supportMerge:true,require:"DS/EditPropWidget/facets/Instance/InstanceFacet",options:f,actions:[b.ACTION_SWITCH,b.ACTION_RESET],facet:{name:b.FACET_INSTANCE,text:d.get("EP_instance"),icon:"attributes"}};g[b.FACET_SWYM_CONTENT]={alwaysVisible:false,alwaysCalled:false,require:"DS/SwymUnifiedSearch/script/customization/facets/edit-properties-facets/swym-content-facet",actions:[b.ACTION_SWYM_VIEW_CONTENT_IN_3DSWYM],facet:{name:b.FACET_SWYM_CONTENT,text:d.get("View"),icon:"eye"}},g[b.FACET_SWYM_SURVEY_PROPERTIES]={alwaysVisible:false,alwaysCalled:false,require:"DS/SwymUnifiedSearch/script/customization/facets/edit-properties-facets/swym-survey-properties-facet",actions:[b.ACTION_SWYM_VIEW_SURVEY_IN_3DSWYM],facet:UWA.merge({name:b.FACET_SWYM_SURVEY_PROPERTIES},g[b.FACET_PROPERTIES].facet)};g[b.FACET_SWYM_COMMUNITY_PROPERTIES]={alwaysCalled:false,alwaysVisible:false,require:"DS/SwymUnifiedSearch/script/customization/facets/edit-properties-facets/swym-community-properties-facet",actions:[b.ACTION_SWYM_VIEW_COMMUNITY_IN_3DSWYM],facet:UWA.merge({name:b.FACET_SWYM_COMMUNITY_PROPERTIES},g[b.FACET_PROPERTIES].facet)};g[b.FACET_SWYM_USER_PROPERTIES]={alwaysCalled:false,alwaysVisible:false,require:"DS/SwymUnifiedSearch/script/customization/facets/edit-properties-facets/swym-user-properties-facet",actions:[b.ACTION_SWYM_VIEW_USER_PROFILE],facet:UWA.merge({name:b.FACET_SWYM_USER_PROPERTIES},g[b.FACET_PROPERTIES].facet)};g[b.FACET_ADMIN]={require:"DS/PropertiesAdmin/PropertiesAdmin",facet:{name:b.FACET_ADMIN,text:d.get("AdminFacet"),icon:"cog"}};g[b.FACET_RELATIONS]={require:"DS/ENORIPE_Relations/views/RelationsTab",facet:{name:b.FACET_RELATIONS,text:d.get("relations_tab"),icon:"object-related"}};return g},getDefaultFacets:function(j,i){var h=this.getMapping();var k=[b.FACET_PROPERTIES,b.FACET_INSTANCE,b.FACET_VIEWS,b.FACET_EBOM,b.FACET_ACTIVITY,b.FACET_EFFECTIVITY,b.FACET_CHANGE,b.FACET_PROXY,b.FACET_SWYMCOMMENTS,b.FACET_SWYM_CONTENT,b.FACET_SWYM_COMMUNITY_PROPERTIES,b.FACET_SWYM_USER_PROPERTIES,b.FACET_SWYM_SURVEY_PROPERTIES,b.FACET_ADMIN];var f=k;var g=e.isWebInWinEnvironment();if(g===true||j===true||i===true){f=[];k.forEach(function(l){var m=true;var n=h[l];if(j===true){m=(!n||n.supportMerge===true)}if(m&&g===true){m=n.webInWin!==false}if(m){i===true?f.push(n):f.push(l)}})}return f}};return c});define("DS/EditPropWidget/models/EditPropModelMerge",["DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropAttributeModel","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(c,a,d){var b=c.extend({_innerModels:{},setup:function(){this._parent();this._innerModels={}},getMergingModels:function(){return this._innerModels},getMergedModelIds:function(){var e=this.getMergingModels();return Object.keys(e)},setMergingModels:function(h){var f=this;if(this._innerModels){for(var e in this._innerModels){var g=this._innerModels[e];if(g._callbackMerge){g.removeEvent("onChangeAttributes",g._callbackMerge[f.get("objectId")])}}}this._innerModels=h;for(var e in this._innerModels){var g=this._innerModels[e];g._callbackMerge=g._callbackMerge?g._callbackMerge:{};g._callbackMerge[f.get("objectId")]=function(k,j){var i=k.get("objectId");j.forEach(function(o){var p=o.getIdentifier();var n=f.get(p);if(n){var m=n.get("value");m[i]=o.get("value");var l=n.get("valueDB");l[i]=o.get("valueDB");f.setFloatingAttribute(p,n)}})};g.addEvent("onChangeAttributes",g._callbackMerge[f.get("objectId")])}},isMergedModel:function(){return true},set:function(e,f){if(f instanceof a){f.set("multisel",true)}this._parent(e,f)},getComputedTitle:function(){var e=this.getMergedModelIds().length;newLabel=d.replace(d.get("{0} objects selected"),{"0":e});return newLabel},resetAllErrors:function(){var f=this;this.lockModel(true);var g=this.getMergingModels();for(var e in g){g[e].resetAllErrors()}setTimeout(function(){f.lockModel(false)});f._parent(false)},clearChangedValue:function(g){var f=this;this.lockModel(true);var h=this.getMergingModels();for(var e in h){h[e].clearChangedValue(g)}setTimeout(function(){f.lockModel(false)})},resetInitialValues:function(){this._parent.apply(this,arguments);var g=this.getMergingModels();for(var e in g){var f=g[e];f.resetInitialValues.apply(f,arguments)}},getChangedValues:function(){var i=this;var l={};var k=this.getMergingModels();for(var g in k){var h=k[g];if(h){var j=h.getChangedValues();if(j){for(var f in j){var e=i.get(f);if(e){l[f]=e}}}}}return l},_getChangedAttributes:function(f){var i=f.changedAttributes();var h=f.getChangedValues();var e=[];for(var g in i){if(h[g]!==null){e.push(g)}}return e},});return b});define("DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests",["DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/EditPropWidget/ajaxRequests/MultipleAsynchronousRequests","DS/WAFData/WAFData","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(f,e,d,a,c){var b={createRequest:function(g,k,j,i){var h=this;if(!g||g.withChange!==false){require(["DS/EditPropWidget/changeAction/passThruJS"],function(l){l.onReady(function(m){h._createRequestWithAuthoringContext(g,k,j,i,m)})})}else{h._createRequestWithAuthoringContext(g,k,j,i)}},_createRequestWithAuthoringContext:function(h,n,l,j,g){var i=this;if(!h.handleRequest){h.handleRequest={}}else{if(h.handleRequest.handle&&typeof h.handleRequest.handle.isCancelled==="function"&&h.handleRequest.handle.isCancelled()){return}}var m=["A"];if(f.isChangeAvailable()&&g){m.push("B")}if(h.withSC===true){m.push("C")}var k=new d(m,function(){var p=this.getAnswer("A");var u=this.getAnswer("B");var w=this.getAnswer("C");w=w?w:h.securityContext;var t="passport";var o=p+l;var q={Accept:"application/json","content-type":"application/json"};q["Accept-Language"]=f.getLanguage();if(u){var s=h.withChange==="silent"&&typeof j==="object";for(var x in u){if(s){if(j[x]===undefined){j[x]=u[x]}}else{q[x]=u[x]}}}w?q.SecurityContext=encodeURIComponent(w):null;var v=h.contentType?h.contentType:"json";if(h.headers){for(var x in h.headers){q[x]=h.headers[x]}}var r={type:v,method:n,timeout:3600000,proxy:t,headers:q,cache:-1,onComplete:function(y){h.onCompleteWS(y,h)},onFailure:function(y,z,A){i._onFailure(y,z,A,h)},onTimeout:function(y){i._onTimeout(h)}};if(!f.getWidgetValue("isStandalone")){r.authentication="passport"}if(j){r.data=v!=="json"?j:UWA.Json.encode(j)}h.handleRequest.handle=a.handleRequest(i._formatUrl(h.model,o),r)});h.handleRequest.handle=f.getSourceUrlAsync({platformId:this.getTenantFromModel(h.model),source:h.source?h.source:this.getSourceFromModel(h.model),onComplete:function(o){k.setAnswer("A",o)}});if(h.withSC===true){e.getInstance({tenant:this.getTenantFromModel(h.model)}).getSecurityContext({onSuccess:function(o){k.setAnswer("C",o.SecurityContext)},onFailure:function(o){console.log(" -- >> Can't get the security context");k.setAnswer("C",null)}})}if(f.isChangeAvailable()&&g){g.get2(function(o){var p=null;if(g.changeIsSetChecker(o)){p=o.AuthoringContextHeader}if(o.errorMessage){console.log("Change : "+o.errorMessage)}k.setAnswer("B",p)})}},getTenantFromModel:function(h){var g=h?h.get("tenant"):null;g=g?g:f.getTenantID();return g},getSourceFromModel:function(g){return g?g.get("source"):null},_formatUrl:function(h,i){var g=this.getTenantFromModel(h);return this._formatUrl2(g,i)},_formatUrl2:function(h,i){if(h){var g=i.indexOf("?");if(g<0){i+="?"}if(g>0&&g<i.length-1){i+="&"}i=i+="tenant="+h}return i},getExtraValues:function(j,i){var h={};var g=[];j.forEach(function(k){h[k]=true});i.forEach(function(k){if(!h[k]){g.push(k)}});return g},_createJSONModifiedAttribute:function(p){var v=this;var G=[];var q=["physicalid","modified"];var h={};var E={};var y=p.getChangedValues();var i={};var r={};for(var A in y){var j=p.get(A);var t=j.facet;if(typeof j==="object"&&!j.isTransient){var m=j.attributeID;if(m!=null&&m.length>0){this._addPLMParameterQuery(j,G)}else{var k=j.getChangedIds();for(var s in k){var C=k[s];if(s==="a"){s=p.get("objectId")}var u=i[s];if(!u){u=[];i[s]=u}var H=r[s];if(!H){H=[].concat(q);r[s]=H}H.push(j.select);var D=C.valueDB;if(D!==false&&!D){D=C.value}var g=null;if(!Array.isArray(D)&&!(typeof D==="string")){g=D.toString()}if(g===null){g=D}var x=null;if(j.from!==null){var z=null;var w=null;if(j.multivalue){z=v.getExtraValues(j.valueDB,j.initialsValues.valueDB);w=v.getExtraValues(j.initialsValues.valueDB,j.valueDB)}else{if(j.valueDB!==j.initialsValues.valueDB){z=j.initialsValues.valueDB?[j.initialsValues.valueDB]:null;w=j.valueDB?[j.valueDB]:null}}if(w&&w.length>0){x={op:"connect",path:j.path,relation:j.relation,name:j.name,from:j.from,value:w}}if(z&&z.length>0){var n={op:"disconnect",path:j.path,relation:j.relation,from:j.from,name:j.name,value:z};if(!x){x=n}else{u.push(n)}}}else{x={op:"replace",path:j.path,value:g}}if(t){x.facet=t}var B=j.get("unitName");if(B){x.unitName=B;x.dimensionType=j.get("dimensionType")}if(!!x){u.push(x)}}}}}var F=p.get("metatype");var l="model/";if(F=="businessobject"||F=="bus"){l+="bus/"}else{if(F=="EBOM"){l+="EBOM/"}else{l+="rel/"}}var o=[];for(var s in i){var E={path:l+s,method:"PATCH",body:i[s]};var H=r[s];if(H){h={select:H};E.queryParams=h}o.push(E)}return{requests:o,plmParametersRequests:G}},_addPLMParameterQuery:function(l,p){var n=l.valueDB;if(n!==false&&!n){n=l.value}var h=[];var k=[];var i={};var o=null;if(!Array.isArray(n)&&!(typeof n==="string")){o=n.toString()}if(o===null){o=n}h.push(l.name);k.push({op:"replace",path:l.path,value:o});if(null!=h){var j={select:h};i.queryParams=j}i.body=k;var m="plmparameter/"+l.attributeID;i.path="model/"+m;var g="PATCH";i.method=g;p.push(i)},_concatRequestListComposite:function(g,h){h.forEach(function(k,i){var j=false;g.every(function(l,m){if(k.path==l.path&&k.method==l.method){g[m].body=g[m].body.concat(k.body);g[m].queryParams.select=g[m].queryParams.select.concat(k.queryParams.select);j=true;return false}return true});if(j===false){g.push(k)}})},securityContextDispatcher:function(h,g){var j=this;var i=h.securityContext;if(i){g.call(this,h)}else{var k=e.getInstance({tenant:h.tenant}).getSecurityContext({context:h.context,onSuccess:function(l){h.securityContext=l.SecurityContext;g.call(j,h)},onFailure:function(l){j._onFailure(null,{error:l},null,h)}});if(h.handleRequest&&!!k){h.handleRequest.handle=k}}},_onCompleteAttributes:function(h,g){g.onComplete.call(null,h)},_onCompleteCommit:function(h,g){g.onComplete.call(null,h)},_onFailure:function(g,i,k,h){var j=this;var l={};if(i!=null&&i.hasOwnProperty("error")){l=i.error}else{l={message:c.get("Error Server"),code:"ERROR"}}this._raiseError(l,h)},_raiseError:function(h,g){if(typeof h!=="object"){h={message:h}}g.onComplete.call(null,{success:false,error:h})},_onTimeout:function(g){var h={message:c.get("ErrorTimeOut"),code:"TO"};this._raiseError(h,g)}};return b});define("DS/EditPropWidget/utils/EditPropUtils",["DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/EditPropConstants","DS/WidgetServices/WidgetServices","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/constants/EditPropConstants","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(a,b,l,s,n,i){var p="type_icon_url";var r="type_icon_large_url";var k=i.get("accordion_parameters");var g="PLMParametersAvailable";var h=function(u){var t=u[g];t=t?t:false;return t};var o=function(u,M,H){var t=new s();var x=null;if(H&&M.extension){x=H[M.extension]}x=x?x:{};var D=1;t.set("multisel",u.isMergedModel());t.set("name",M.name);t.set("label",M.name+" (NLS not defined)");t.set("path",M.selectable);t.set("select",M.selectable);t.set("select",M.select);t.set("type",M.type);if(M.speType){t.set("type",M.speType)}t.set("multiline",M.multiline!=undefined&&M.multiline!==false);var C=M.multivalue!=undefined&&M.multivalue!==false;t.set("multivalue",C);var E=M.value;var z=M.valueDB;if(!u.isMergedModel()){E={r:E};if(z){z={r:z}}}if(!E){if(u.isMergedModel()){var J=u.getMergingModels();var E={};var z={};for(var L in J){var F=J[L];var v=C===false?"":[];E[F.get("objectId")]=v;z[F.get("objectId")]=v}}}else{for(var w in E){var I=E[w];var y=z?z[w]:y;if(C===false){I=I===null?"":I;y=y===null?"":y;if(Array.isArray(I)){I=I.length>0?I[0]:"";if(y){y=y.length>0?y[0]:""}}I=I===undefined?"":I}else{if(I===""||I===undefined){I=[];y=[]}}E[w]=I;if(z){z[w]=y}}}if(!u.isMergedModel()){E=E.r;if(z){z=z.r}}if(M.range){if(typeof M.range==="string"){M.range=M.range.split(",")}t.set("authorizedValues",M.range)}if(M.rangeNLS){if(typeof M.rangeNLS==="string"){M.rangeNLS=M.rangeNLS.split(",")}t.set("authorizedValuesNLS",M.rangeNLS)}if(M.range_required!==undefined){t.set("authorizedValuesRequired",M.range_required===true)}var G=true;if(!M.readOnly&&M.selectable==="owner"){G=false}if(M.readOnly==="No"||M.readOnly===false){G=false}t.set("readOnly",G);t.set("value",E);if(!z){t.set("valueDB",E)}else{t.set("valueDB",z)}t.set("mandatory",M.mandatory==="Yes"||M.mandatory===true);t.set("label",M.nls);t.set("path",M.path);t.set("dimension",M.dimension);t.set("unitName",M.unitName);t.set("dimensionType",M.dimensionType);t.set("maxlength",M.maxlength);t.set("forbiddenChar",M.forbiddenChar);if(M.minval){t.set("minval",M.minval);if(M.minvalincluded){t.set("minvalincluded",M.minvalincluded)}}if(M.maxval){t.set("maxval",M.maxval);if(M.maxvalincluded){t.set("maxvalincluded",M.maxvalincluded)}}if(M.attrID){t.set("attributeID",M.attrID);t.set("facet",k);t.set("section",k)}if(M.facet){t.set("facet",M.facet);t.set("section",M.facet)}else{if(x.name&&x.deploymentExtension!==true){t.set("facet",x.name);t.set("section",x.nameNLS?x.nameNLS:x.name)}}if(M.facetName){t.set("section",M.facetName)}if(M.from!==undefined){t.set("from",M.from)}if(M.relation){t.set("relation",M.relation)}if(M.rules){t.set("rules",M.rules)}var K=M.UIPosition;var D=1;var B=1;if(x.deploymentExtension&&M.maskedByType!==true){D=2}if(!K&&K!==0){B=2;K=0;t.set("masked",false)}var A=D+"-"+B+"-"+K;t.set("positionUI",A);t.saveInitialValues();return t};var d=function(t,v,x){var w=[];if(v){var u=this;v.forEach(function(B,A){var z=o(t,B,x);var y=z.get("positionUI");y+="-"+A;z.set("positionUI",y);w.push(z)})}return w};var e=function(t){var u=t[p];return u?u:""};var f=function(t){var u=t[r];return u?u:""};var m=function(u,A,y){var w=this;var x=true;if(!y){y={}}var C=["owner","modified"];var z=["ds6w:responsible","ds6w:modified"];if(l.getWidgetValue("index_mode")||A.source==="Federated"){C=z}var v=y.type_small_icon;var t=d(u,A.data,A.extensions);var B=d(u,A.basicData,A.extensions);B.forEach(function(E){x=x&&E.get("readOnly")===true;if(E.name===p&&v!==E.value){y.type_icon_url=E.value}if(E.name==="type"){E.set("urlIcon",v)}var D=0;var F=C.indexOf(E.name);if(E.get("positionUI")){D=E.get("positionUI")}if(!u.isMergedModel()&&F>=0){if(F===0){E.set("sectionIdentityCard","ownerName")}else{if(F===1){E.set("sectionIdentityCard","date")}else{E.set("positionIdentityCard",F)}}}var G=E.get("masked");if(G===true){E.set("positionUI",D);y[E.getIdentifier()]=E}});t.forEach(function(F,D){x=x&&F.get("readOnly")===true;if(F.name==="ds6w:type"){F.set("urlIcon",v)}var E=0;var G=C.indexOf(F.name);if(F.get("positionUI")){E=F.get("positionUI")}if(!u.isMergedModel()&&G>=0){if(G===0){F.set("sectionIdentityCard","ownerName")}else{if(G===1){F.set("sectionIdentityCard","date")}else{F.set("positionIdentityCard",G)}}}F.set("positionUI",E);y[F.getIdentifier()]=F});return x};var q=function(y){var x={};var t=y.computed;if(t&&t.label){var w=t.label;if(w.value&&typeof w.value==="object"){for(var v in w.value){var u=w.value[v];w.value[v]=Array.isArray(u)&&u.length>0?u[0]:u}}x.label=w.value;if(w.path){x.attributeId=w.path}if(!w.path&&w.name){x.attributeId=w.name}}return x};var c=function(t){var u=this;if(t.get("type")&&l.getWidgetValue("admin")==="true"&&("CATProduct"===t.get("type").value||t.get("type").value==="CATPart")){if(t.get("project")){t.get("project").set("readOnly",false)}}};var j={getModelFromSelectedNode:function(u){var x=null;var y=u&&typeof u.getInstID==="function"?u.getInstID():null;var y=!y&&u&&typeof u.getRelationID==="function"?u.getRelationID():y;if(y!=null&&Array.isArray(y)){y=y.length>0?y[0]:null}var C=!!y;var v=C?"relationship":"businessobject";y=y?y:u.getID();y=y?y:u.id;if(y===u.plmType){return null}var D=!C&&u.metatype?u.metatype:v;var t=u.source?u.source:null;var B=u.tenant?u.tenant:null;var z=!C&&u.type?u.type:null;if(y){var w={metatype:D,objectId:y};var B=B?B:l.getTenantID();if(B){w.tenant=B}if(t){w.source=t}if(z){w.type=z;w[b.MODEL_DS_ATTR+"type"]=z}var A=new a(w);x=A}return x},getModelFromPath:function(x,z,D){var E=x.length;var H=D||(E%2)==0;var F=E==1||H;var v=F?E-1:E-2;var u=x[v];var C=z?z[u]:null;var w=C;if(z&&!F){var A=x[v+1];w=z[A]}var I=D||!F?"relationship":"businessobject";var y={objectId:u,metatype:I};if(w){var t=w.source?w.source:null;var B=w.type?w.type:null;var G=w.tenant?w.tenant:null;var I=F&&w.metatype?w.metatype:I;if(G){y.tenant=G}if(t){y.source=t}if(B){y[b.MODEL_DS_ATTR+"type"]=B}if(I){y.metatype=I}}return new a(y)},getPreviewUrl:function(t){var u=t.preview_url;return u?u:""},fillFromServer:function(N,x,v){var C=this;var H={modifyAccess:true,success:false,allAttributeAreRO:true,plmparams:false};if(N.success!==false){H.success=true;H.modifyAccess=N.modifyAccess!==false;var F=C.getPreviewUrl(N);var z=e(N);var t=f(N);if(z===t){t=""}var w=x.getChangedValues();var B={};if(F){B.previewUrl=F}if(t){B.type_icon_url=t}if(z){B.type_small_icon=z}if(N.thumbnailsRW){B.activeThumbnail=true}H.allAttributeAreRO=m(x,N,B);var D=q(N);var A=D.label;if(!A){if(x.isMergedModel()){A={};x.getMergedModelIds().forEach(function(P){A[P]=""})}else{A=""}}if(A){B.label=Array.isArray(A)?A[0]:A}if(D.attributeId&&B[D.attributeId]){B.labelAttribute=D.attributeId;B[D.attributeId].set("sectionIdentityCard","title");x.addEvent("onChange:"+D.attributeId,function(){var P=x.get(D.attributeId);if(P){x.set("label",P.valueDB)}})}else{B[n.MODEL_DS_ATTR+"label"]=new s({sectionIdentityCard:"title",value:A,valueDB:A,multisel:x.isMergedModel(),isTransient:true,path:n.MODEL_DS_ATTR+"label"})}var E={};for(var O in w){if(!B[O]){E[O]=w[O]}}if(N.type){if(!B.type){B.type=N.type}else{B.type.set("valueDB",N.type)}}var u=x.getAllAttributes();for(var O in u){var I=u[O];if(typeof I==="object"&&I instanceof s&&!I.isTransient){if(v.initTable||I.attributeID){delete u[O]}}}x.set(B);if(x&&x.isMergedModel()){var M=x.getMergingModels();for(var y in M){var L=M[y];L.clearChangedValue();var J=UWA.clone(B);for(var O in B){var G=B[O];if(G instanceof s){var K=new s(J[O]);K.set("value",G.get("value")[y]);K.set("valueDB",G.get("valueDB")[y]);K.set("multisel",false);K.saveInitialValues();J[O]=K}}L.set(J);L.setChangedValues(E)}}x.clearChangedValue();x.setChangedValues(E);c(x);H.plmparams=h(N)===true}return H}};return j});define("DS/EditPropWidget/comm/DistantAjax",["UWA/Class","DS/EditPropWidget/comm/CommManager","DS/WidgetServices/WidgetServices"],function(b,d,c){window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0;var a=b.singleton({_isAsynchronous:false,_valuesAsync:{},init:function(){this._isAsynchronous=widget.getValue("asynchronousRequest")===true||widget.getValue("asynchronousRequest")==="true";widget.setValue("asynchronousRequest","false");this._valuesAsync={}},_getCommManager:function(e){e.call(this,d)},getAsyncRead:function(e){this._getAsync("read",e)},getAsyncFacetCheck:function(e){this._getAsync("facetCheck",e)},_getAsync:function(e,f){if(this._isAsynchronous){this._getCommManager(function(g){var h=new g(e);h.createListenEvent(function(i){f(i);h.destroy()});setTimeout(function(){var i=h.getCurrentListenStatus();if(!i){f(null)}},100)})}else{f(null)}},_distantCall:function(f,e,h,g){this._getCommManager(function(i){var j=new i(f);var k=false;var l=++window.top.perfoIncrem;window.top.performance.mark("start_getAsync:"+l);this._getAsync(f,function(m){if(!!m){window.top.performance.mark("end_getAsync:"+l)}if(k===false&&!!m&&m.discriminant===e){k=true;if(h){h(!m?m:m.value)}}});setTimeout(function(){if(k===false){j.createRunningEvent();g.call(this,function(m){if(k===false){k=true;j.createReadyEvent({value:m,discriminant:e});if(h){h(m)}}})}});setTimeout(function(){if(j){j.destroy()}},120000)})},getRoles:function(f,g){var e=this;this._distantCall("role",f,g,function(h){c.getGrantedRoles(function(i){h.call(e,i)},f)})},getServices:function(f,g){var e=this;this._distantCall("services",f,g,function(h){c.getServicesUrl({onComplete:function(i){h.call(e,i)}})})},launchMainRead:function(f,e){require(["DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests"],function(h,g){var i=new d("read");i.createRunningEvent(f);h.getListOfAttributes({modelList:f,tenant:g.getTenantFromModel(f&&f.length>0?f[0]:null),handleRequest:{},navigateToMain:true,securityContext:e.securityContext,index_mode:e.index_mode,onComplete:function(j){i.createReadyEvent(j)}});setTimeout(function(){if(i){i.destroy()}},120000)})},launchFacetsVisibility:function(j,l,n,h){var k=this;var f=["DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests"];if(this._valuesAsync.facetCheck===undefined){this._valuesAsync.facetCheck=this._isAsynchronous}var e=this._valuesAsync.facetCheck&&!h;var m=false;var i=0;n.handleRequest=n.handleRequest?n.handleRequest:{};if(n.handleRequest){n.handleRequest.handle=c.getCancelObject()}var g=n.handleRequest.handle;if(h){f.push("DS/EditPropWidget/comm/CommManager")}else{if(e){i=200;this.getAsyncFacetCheck(function(o){if(m!=true&&(!g.isCancelled())){if(o){m=true;k._valuesAsync.facetCheck=false;n.onComplete(o)}}})}}require(f,function(q,p,o){setTimeout(function(){if(m!==true&&(!g.isCancelled())){var r=null;if(o){r=new o("facetCheck");r.createRunningEvent(j);setTimeout(function(){if(r){r.destroy()}},120000)}q.checkFacetsVisibility({handleRequest:n.handleRequest,context:n.context,tenant:p.getTenantFromModel(j),model:j,facets:l,onComplete:function(s){if(r){r.createReadyEvent(s)}if(typeof n.onComplete==="function"&&m!==true){n.onComplete(s)}m=true;k._valuesAsync.facetCheck=false}})}},i)})}});return a});define("DS/EditPropWidget/facets/Properties/TweakerManager",["UWA/Core","UWA/Class","DS/WidgetServicesUI/helpers/Helpers","DS/WidgetServicesUI/helpers/Constants","DS/EditPropWidget/models/EditPropAttributeModel","DS/WidgetServices/WidgetServices","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(f,a,h,b,g,k,i){var e="DEFAULT";var j={};j[e]={type:e,from:function(l){return l.valueDB},to:function(l){return{valueDB:l.value,value:l.displayValue?l.displayValue:l.value}},extraOptions:function(s,l){var w=l.authorizedValuesNLS;var q=l.authorizedValues;var p=w.length;if(p>0){var t=false;var x=l.get("tw_type");var o=j[x];if(!o||!o.from){o=j[e]}var m=[];var n=[];for(var r=0;r<p;r++){var u=w[r];var v=q[r];n.push({label:u,value:v});if(!t&&w[r]===q[r]){v=o.from({value:u,valueDB:v});u=null;m.push({label:u,value:v})}else{t=true}}return{trueEnum:t,data:{list:t?n:m,range_required:l.authorizedValuesRequired}}}}},j[b.TYPES.BOOLEAN]={type:b.TYPES.BOOLEAN,from:function(l){return l.valueDB===true||(typeof l.valueDB==="string"&&l.valueDB.toLowerCase()==="true")}};j[b.TYPES.RELATION]={type:b.TYPES.RELATION,from:function(l){return{id:l.valueDB,label:!!l.value&&l.value.label?l.value.label:""}},to:function(l){return{valueDB:l.value?l.value.id:"",value:l.value?l.value:""}},extraOptions:function(l,m){return{data:{rules:m.get("rules")}}}};j[b.TYPES.PERSON]={type:b.TYPES.PERSON,from:function(l){return{personID:l.valueDB,fullName:l.value}},to:function(l){return{valueDB:l.value.personID,value:l.value.fullName}},extraOptions:function(l){var m=l.isMergedModel()?l.getMergedModelIds():[l.get("objectId")];return{data:{objectIDs:m}}},check:function(m,l){if(l===null){return{message:i.UnvalidAttribute,type:"error"}}}};j[b.TYPES.DATE]={type:b.TYPES.DATE,from:function(l){return k.formatDateObj(l.valueDB)},to:function(m){var l=k.convertDateToStandard(m.value,true);return{valueDB:l.valueDB,value:m.displayValue}}};j[b.TYPES.DATETIME]=j[b.TYPES.DATE];var d=function(o){var n=j[o.get("tw_type")];var m=null;if(n&&n.check){var l=o.get("valueDB");if(o.multisel){l=l[Object.keys(l)[0]]}if(!Array.isArray(l)){l=[l]}l.every(function(p){m=n.check(o,p);return m===null})}return m};var c=a.extend({_sharedOptions:null,init:function(l,m){this._parent(l);this.elements={};this.elements.fields={};this._sharedOptions=m;this.onNotification=l.onNotification?l.onNotification:function(){};this.options=this.options?this.options:{};this._setEditable(l&&l.editable===true)},isReadOnly:function(){var l=this._sharedOptions;return l?l.readOnly===true:true},clear:function(){for(var l in this.elements.fields){this._removeField(l)}this.elements.fields={}},actionOnScroll:function(){for(var m in this.elements.fields){var l=this.elements.fields[m];if(l.field&&typeof l.field.actionOnScroll==="function"){l.field.actionOnScroll()}}},getValidationFunction:function(m){var l=j[m];if(l&&l.check){return d}},_getValueForTweaker:function(n,o){var l=n;var m=j[l];if(!m||!m.from){l=e;m=j[l]}var p=null;if(o.multisel){p=this.__getValueFromMultiselForConvert(m,o)}else{p=this.__getValueFromStandardForConvert(m,o)}return p},__getValueFromStandardForConvert:function(p,l){var o=l.multivalue===true;var m=p.type;var u=l.value;var r=Array.isArray(u)?u:[u];var s=u;var w=r;if(m!==e||!l.readOnly){s=l.valueDB;w=Array.isArray(s)?s:[s]}var q=r.length;var v=[];for(var t=0;t<q;t++){var n=p.from({value:r[t],valueDB:w[t]});v.push(n)}return o?v:q>0?v[0]:null},__getValueFromMultiselForConvert:function(p,m){var t=m.value;var r=m.valueDB;var o={};for(var u in t){var n=t[u];var q=r[u];var l={value:n,valueDB:q,multivalue:m.multivalue,readOnly:m.readOnly};var s=this.__getValueFromStandardForConvert(p,l);o[u]=s}return o},__getValueFromStandardFromTweaker:function(o,m){var t=m.value;var r=m.displayValue;var n={};var q={};if(Array.isArray(t)){var n=[];var q=[];var s=t.length;for(var p=0;p<s;p++){var l=o.to({value:t[p],displayValue:r[p]});n.push(l.value);q.push(l.valueDB)}}else{var l=o.to({value:t,displayValue:r});n=l.value;q=l.valueDB}return{value:n,valueDB:q}},__getValueFromMultiselFromTweaker:function(o,q){var p=q.value;var m=q.displayValue;valueAttr={};valueDBAttr={};for(var l in p){var n=this.__getValueFromStandardFromTweaker(o,{value:p[l],displayValue:m[l]});valueAttr[l]=n.value;valueDBAttr[l]=n.valueDB}return{value:valueAttr,valueDB:valueDBAttr}},_getValueFromTweaker:function(r,p,m){var o=j[r];if(!o||!o.to){o=j[e]}var n=m.multivalue===true;var s=p.getValue();var q=p.getDisplayValues();var l={value:s,displayValue:q};var t=null;if(m.multisel===true){t=this.__getValueFromMultiselFromTweaker(o,l)}else{t=this.__getValueFromStandardFromTweaker(o,l)}return t},_generateOptions:function(p,l,q){var r={units:q.dimension,minValue:q.minval,maxValue:q.maxval,minValueIncluded:q.minvalincluded,maxValueIncluded:q.maxvalincluded,multiline:q.multiline,multisel:q.multisel,icon:q.urlIcon,parameter:q.attributeID?true:false,multivalued:q.multivalue,mandatory:q.mandatory,readOnly:q.readOnly};if(this.isReadOnly()){r.editable=false}var o=j[p];if(!o||!o.extraOptions){o=j[e]}if(o&&o.extraOptions){var n=o.extraOptions(l,q);for(var m in n){r[m]=n[m]}}return r},_updateValue:function(o,p,s,n){var r=this;var m=o.isMergedModel();if(!m){this.__updateValue(o,p,s,n)}else{var q=o.getMergingModels();o.lockModel(true);for(var l in q){innerModel=q[l];r.__updateValue(innerModel,innerModel.get(p.getIdentifier()),s[l],n[l])}setTimeout(function(){o.lockModel(false)})}},__updateValue:function(s,m,x,n){var u=this;var q=s.getChangedValues();var v=m.getIdentifier();var y=m.value;var r=m.valueDB;var p=q[v];if(p){var y=p.value;var r=p.valueDB}var t=n===r;if(!t&&s.isMergedModel()){t=true;var w=s.getMergingModels();for(var z in w){t=t&&w[z]===r[z]}}if(Array.isArray(n)){var l=n.length;t=l===r.length;if(t){for(var o=0;o<l;o++){t=n[o]===r[o];if(!t){break}}}}if(!t){u._modelChangeValue(s,s.get(v),x,n)}},_modelChangeValue:function(m,n,o,l){var p=new g(f.clone(n));p.set("value",o);p.set("valueDB",l);m.set(n.getIdentifier(),p);return p},_getOrCreateField:function(l){var m=this.elements.fields[l];if(!m){m=this.elements.fields[l]={}}return m},_addEventToField:function(l,n,m){var o=this._getOrCreateField(n);if(!o.events){o.events=[]}o.events.push(m);o.model=l},_addTweakerToField:function(l,m){var n=this._getOrCreateField(l);n.field=m},_removeField:function(m){var l=this.elements.fields[m];if(l.field){if(typeof l.destroy==="function"){l.destroy()}else{if(typeof l.field.destroy==="function"){l.field.destroy()}}}if(l.events&&l.model){l.events.forEach(function(n){l.model.removeEvent(m,n)})}delete this.elements.fields[m]},setError:function(l){},onNotification:function(l){},_manageOnChangeEvent:function(m,n,o,p){var l=function(){setTimeout(function(){if(!o.elements.container){m.removeEvent(n,l)}else{p.call()}})};this._addEventToField(m,n,l);m.addEvent("onChange:"+n,l)},_setEditable:function(l){this.editable=l&&!this.isReadOnly()},underEdition:function(){return this.editable&&!this.isReadOnly()},switchMode:function(m){this._setEditable(m);for(var l in this.elements.fields){var n=this.elements.fields[l];if(n&&n.field){n.field.switchMode(this.underEdition())}}},getTweakerFromId:function(l){var m=this.elements.fields[l];return m},getTweaker:function(n,l,p,r,t){var o=this;var m=n.get(l);var u=this._generateOptions(p,n,m);if(u.trueEnum===true){p=b.TYPES.ENUM}var q=this._getValueForTweaker(p,m);u.value=q;u.events={changes:function(){var w=n.get(l);if(w){var v=o._getValueFromTweaker(p,this,w);o._updateValue(n,w,v.value,v.valueDB)}},notification:function(v){o.onNotification(v)}};if(r){for(var s in r){u[s]=r[s]}}h.getTweaker(p,u,function(v){o._addTweakerToField(l,v);o._manageOnChangeEvent(n,l,v,function(){var w=n.get(l);var x=o._getValueForTweaker(p,w);v.setValue(x)});v.switchMode(o.underEdition());t.call(this,v)})}});return c});define("DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/utils/EditPropUtils","DS/WAFData/WAFData","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(k,i,g,l,b,f,h){var d={};var a={};var j={};var c=function(p,o,n){var m=p[o];if(m){if(!m.multivalue===true){m.value=[m.value];m.valueDB=[m.valueDB];m.multivalue=true}m.value.push(n.value);m.valueDB.push(n.valueDB)}else{p[o]=n}};var e={getPreviewUrl:function(m){if(!m.ids&&m.modelList){var n=this;m.ids=[];m.modelList.forEach(function(o){var p=n.getIdFromModel(o);if(!!p){m.ids.push(p)}})}this._getPreviewUrl(m)},_getPreviewUrl:function(n){var p=this;var o=n.ids;var m="/search";var q=o.length;if(q){n.handleRequest.handle=k.get3DSearchUrlAsync({platformId:n.tenant,onComplete:function(u){var A="passport";var r=u+m;var s=k.getLanguage();var y="";var w="";o.forEach(function(D){y+=w+D;w=" OR "});var B={with_indexing_date:false,with_synthesis:false,with_synthesis_attribute:false,with_nls:false,nresults:q,locale:s,query:y,tenant:n.tenant,start:0,select_file:["icon","thumbnail_2d"]};var C="PropertiesPanel";var x=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";var z=C+"-"+x+"-"+(new Date()).getTime();B.label=z;var t={Accept:"application/json","content-type":"application/json"};t["Accept-Language"]=k.getLanguage();var v={type:"json",method:"POST",timeout:240000,data:UWA.Json.encode(B),proxy:A,headers:t,cache:-1,onComplete:function(D){p.onCompletePreview(D,n)},onFailure:function(D,E,F){i._onFailure(D,E,F,n)},onTimeout:function(D){i._onTimeout(n)}};if(!k.getWidgetValue("isStandalone")){v.authentication="passport"}n.handleRequest.handle=f.handleRequest(i._formatUrl2(n.tenant,r),v)}})}},onCompletePreview:function(n,m){var o=[];if(n&&n.results){n.results.forEach(function(p){var s=null;var q=null;var r=true;if(p.attributes){p.attributes.every(function(t){if(t.name==="resourceid"){s=t.value}if(t.name==="preview_url"){q=t.value}r=!(s!=null&&q!=null);return r})}if(!r){o.push({id:s,preview:q})}})}m.onComplete(o)},checkFacetsVisibility:function(m){var n={};n[g.FACET_PROPERTIES]=true;m.onComplete.call(this,{id:m.model.get("objectId"),facets:n})},getSourceId:function(n){var o=n.get("sourceName");o=o?o:n.get("source");var p="";var m=l.getSupportedServices();var q=m[o.toLowerCase()];if(q&&q.fedPrefix){p=q.fedPrefix}return p},fillModel:function(n,m){var o=n.onComplete;n.onComplete=function(p){if(p&&p.results&&p.results.length>0){b.fillFromServer(p.results[0],m,{})}o.apply(this,[m])};n.modelList=[m];return this.getListOfAttributes(n)},getIdFromModel:function(n){var o=this.getSourceId(n);var m=n.get("objectId");m=m?m:"";return o&&m.indexOf(o)!==0?o+':"'+m+'"':m},_getModelType:function(n){var o=n.get("ds6w:type");var p=o?o.get("valueDB"):"";var m=n.get("source");if(!p&&m==="3DSwym"){var q=n.get("objectId");if(q.indexOf("iam")==0){p="pno:Person"}}return p},getListOfAttributes:function(x){var p=x.modelList;var w=x.securityContext;var u=p.length;if(u){var r=[];var y=p[0];var v=y.get("objectId");var o="POST";var s="";if(v){var s="/search";var n=[];if(y.get("sourceName")){n.push(y.get("sourceName"))}x.model=y;x.idModel=v;x.onCompleteWS=this._onCompleteFederated.bind(this);var q=k.getLanguage();var m=k.getCancelObject();var t=this.getMask({"ds6w:type":{valueDB:this._getModelType(y)}},function(F){var C=[];F.Write.attributes.forEach(function(H){var G=H.name;C.push(G)});var z=this.getIdFromModel(y);var D={with_indexing_date:false,with_synthesis:false,with_synthesis_attribute:true,with_nls:true,locale:q,query:z,tenant:i.getTenantFromModel(y),source:n,select_predicate:C,start:0,select_file:["icon","thumbnail_2d"]};var E="PropertiesPanel";var B=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";var A=E+"-"+B+"-"+(new Date()).getTime();D.label=A;x.source="3DSearch";m.handler=i.createRequest(x,o,s,D)});return m}}},getElementsNls:function(o,n){if(o&&o.length>0){var m="/resources/6WVocab/access/ElementsNLSNames";n.source="6WTags";n.headers={"content-type":"text/uri-list"};n.contentType="text";o.join(",");n.onCompleteWS=n.onComplete;i.createRequest(n,"POST",m,o.join(","))}else{n.onComplete.call(this,null)}},getValuesNls:function(o,n){if(o){var m="/resources/6WVocab/access/PredicateValue";n.headers={"content-type":"application/json"};n.onCompleteWS=n.onComplete;i.createRequest(n,"POST",m,o)}else{n.onComplete.call(this,null)}},_callMask:function(m,o,p){var n=this;if(!j[m]){require([o],function(q){j[m]=JSON.parse(q);p.call(n,j[m])})}else{p.call(n,j[m])}},getMask:function(o,p){var n=this;var m=o["ds6w:type"];if(m&&m.valueDB==="pno:Person"){this._callMask("Person","text!DS/EditPropWidget/assets/masks/3DSwym/Person.json",p)}else{this._callMask("Default","text!DS/EditPropWidget/assets/masks/Federated/default.json",p)}},_onCompleteFederated:function(x,o){var s=this;var y=x.results;var B={source:"Federated"};var D=[];var t={};B.data=D;if(y&&y.length>0){var p={};var n={};var A={};var u={};var z=null;var v=null;var q=y[0];var m={};q.attributes.forEach(function(W){var P=W.name;var T=P;var O=W.value;O=O===undefined?"":O;var Q=W.format==="ds6w_facet";var J=Q;if(Q){var V=P.split("/");T=V[V.length-1]}Q=Q||W.format==="attribute";if(Q){z=J===true?u:n;v=J===true?A:p;var I=W.type;var H=O;var N=false;if(I==="date"){var X=Date.parse(O);var F=new Date(X);if(F){O=k.convertDateToStandard(F,true);O=O.valueDB;if("ds6w:modified"===T||"ds6w:created"===T){I="datetime"}}}else{N=I==="string"}if(O.indexOf(T)===0){O=O.replace(T+".","")}var R=W.dispValue!==undefined;var S=R?W.dispValue:O;if(N&&!R){var K=a[T];S=O;var L=K?K[O]:null;if(L){S=L}else{var M=m[T];if(!M){M=[];m[T]=M}M.push(O)}}var G={name:T,selectable:T,path:P,type:I,value:S,valueDB:O,readOnly:true,nls:T};if(T==="ds6w:label"){t=G}var U=d[T];if(U){G.nls=U.nlsName;c(z,T,G)}else{c(v,T,G)}}else{if(T==="resourceid"){B.physicalID=O}else{B[P]=O}}});for(var E in A){if(!p[E]){p[E]=A[E]}}for(var E in u){if(!n[E]){n[E]=u[E]}}if(o.idModel){B.physicalID=o.idModel}B.computed={label:t};var r=Object.keys(p);var w=new Promise(function(F){s.getElementsNls(r,{onComplete:function(G){F(G)}})});var C=new Promise(function(F){s.getValuesNls(m,{onComplete:function(G){F(G)}})});Promise.all([w,C]).then(function(J){var M=J[0];var L=J[1];if(M){if(M.success!==false){var G=M?JSON.parse(M):{};if(G.vocabularyElementNLSInfo){G.vocabularyElementNLSInfo.forEach(function(P){var O=p[P.uri];var N=P.type==="Predicate";if(N){d[P.uri]=P}else{a[P.uri]=P}if(O&&P.nlsName){O.nls=P.nlsName;n[P.uri]=O}})}}else{i._raiseError(M.error?M.error.message:"Error",o)}}for(var I in L){var K=n[I];if(K){var H=L[I];if(K.multivalue){var F=[];K.value.forEach(function(O){var N=H[O];F.push(N?N:O)});K.value=F}else{K.value=H[K.value]?H[K.value]:K.value}}}s.getMask(n,function(N){N.Write.attributes.forEach(function(P){var O=P.name;var Q=n[O];if(Q){D.push(Q)}});o.onComplete.call(null,{results:[B]})})})}else{i._raiseError(h.get("FedAjax_NotFound"),o)}}};return e});define("DS/EditPropWidget/facets/Properties/PropertiesUIController",["DS/EditPropWidget/controllers/EditPropUIController","DS/EditPropWidget/utils/AttributesUtils","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(c,a,d){var b=c.extend({defaultOptions:{},validateModels:function(e){return a.validateModels(e)},validateAttributes:function(e,f){return a.validateAttributes(e,f)},resetValueOfModels:function(e){if(!e){e=this.getModels()}e.forEach(function(f){f.resetInitialValues()})}});return b});define("DS/EditPropWidget/models/OccurrenceModel",["UWA/Class/Model","DS/EditPropWidget/models/EditPropModel","UWA/Class/Debug"],function(d,b,c){var a=d.extend(c,{defaults:{isMerging:false,modelPrefix:"00"},isMergedOccurrence:function(){return this.get("isMerging")===true},getMergePrefixe:function(){return this.get("modelPrefix")},getAllModels:function(e,h){var f=this._attributes;var i=e===true?[]:{};for(var g in f){if(f[g].model instanceof b){if(e===true){i.push(f[g].model)}else{i[g]=f[g].model}if(h===true){break}}}return i},_getModelElement:function(f){var e=this.get(f);if(!e){e={model:null,options:null}}return e},setOptions:function(g,f){var e=this._getModelElement();e.options=f;this.set(g,e)},getOptions:function(f){var e=this.get(f);return e?e.options:null},setModel:function(g,f){var e=this._getModelElement();e.model=f;this.set(g,e)},getModel:function(f){var e=this.get(f);return e?e.model:null}});return a});define("DS/EditPropWidget/controllers/EditPropMainController",["UWA/Class/Model","DS/EditPropWidget/models/OccurrenceModel","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/utils/EditPropUtils","DS/EditPropWidget/UI/EditPropSkeleton","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices"],function(g,j,b,e,h,f,i,a,l,k,c){var d=UWA.Class.extend({skeleton:null,defaultOptions:{selectionType:a.ALL_SELECTION,displayType:a.STANDARD,context:null,odtUpTransient:false},init:function(n){var p=this;this._parent(n);this._selectionIsStopped=false;this._currentNewSelection=null;this.options=this.options?this.options:{};for(var o in this.defaultOptions){this.options[o]=n[o]}c.getInstance({context:this.options.context});var m=n.events["onCancel"];n.events["onCancel"]=function(q){p._unsubscribeSelect();p.skeleton.clearPanel();p.skeleton.setOccurrences([]);if(m){m.call(p,q)}};this._setup(n);if(n.selectionType!==a.NO_SELECTION){this._commandProxy=null;require(["DS/WidgetServices/commandProxy/CommandProxy"],function(u){var s=false;var q=0;var t=function(x,y){var v=(x.paths&&x.paths.length===0)||(x.pathsInst&&x.pathsInst.length===0);if(v){s=false;setTimeout(function(){if(s===false){p._onSelectionChange(x,y)}},500)}else{s=true;q++;var w=q;setTimeout(function(){if(w===q){p._onSelectionChange(x,y)}},50)}};var r={events:{onSelect:t}};if(p.options.displayType===a.TRANSIENT||p.options.odtUpTransient===true){r.events["onUpdateTransient"]=function(w){var x=w.models;var v=w.options;if(v){if(v.securityContext){c.getInstance({context:{getSecurityContext:function(){return{SecurityContext:v.securityContext}}}}).getSecurityContext()}}p._commandProxy.subscribe({onSelect:t})}}p._commandProxy=u.create(r)})}},getTopBar:function(){return this.skeleton.getTopBar()},_unsubscribeSelect:function(){if(this._commandProxy){this._commandProxy.unsubscribe(this._commandProxy.choices.SELECT)}},setModels:function(p,o){var n=this;var m=this._currentNewSelection?true:false;this._currentNewSelection={models:p,change:o};if(!m){this.skeleton.checkChangeAuthorized(function(q){var r=n._currentNewSelection;n._currentNewSelection=null;if(q===true){n._setModels(r.models,r.change)}},true)}},_setModels:function(o,y){window.top.performance.mark("start_setModelController");var C=o&&o.length>0?o[0]:null;var s=C?C instanceof g?C.get("tenant"):C.tenant:null;if(C&&s){k.setWidgetValue("x3dPlatformId",s)}if(k.getWidgetValue("x3dAppId")==="ENOLCMT_AP"&&y!==undefined&&k.isChangeAvailable()){var w="DS/EditPropWidget/changeAction/passThruJS";require([w],function(F){F.onReady(function(G){if(G.changeIsSetChecker(y)&&o.length>0){G.set(y,function(H){if(H.Message===undefined){G.show()}})}else{G.set({change:{}});G.hide()}})})}var p=this;var q=o.length;var B=[];if(q){var A={};var t={};var z=null;o.forEach(function(G,K){if(typeof G.isMergedModel!=="function"||G.isMergedModel()!==true){var I=o[K];var O=null;var F=G instanceof g;if(!F){I=new b(G);o[K]=I}else{if(!p._getModel(I.get("objectId"))){I.clearChangedValue()}O=I.getChangedValues()}if(!p._getModel(I.get("objectId"))){p.editPropModelList=[I];I.clearChangedValue()}var N=I.keys();N.forEach(function(P){var U=I.get(P);var V=U instanceof h;if(!V&&U&&typeof U==="object"&&P!=="EditProp_listOfChange"&&P!=="label"){U=new h(U);V=true;I.set(P,U)}if(V&&I.isTransientModel()===true){var T=U.getIdentifier();if(T){var Q=t[T];if(Q){var W=U.get("value");var S=U.get("valueDB");var X=Q.get("value");var R=Q.get("valueDB");X[I.get("objectId")]=W;R[I.get("objectId")]=S;if(Q.get("sectionIdentityCard")==="title"){z.value[I.get("objectId")]=W;z.valueDB[I.get("objectId")]=S}Q.__nbValues++}else{Q=new h(UWA.clone(U));var W=Q.get("value");var S=Q.get("valueDB");var X={};var R={};X[I.get("objectId")]=W;R[I.get("objectId")]=S;Q.set("multisel",true);Q.set("value",X);Q.set("valueDB",R);Q.__nbValues=1;if(Q.get("sectionIdentityCard")==="title"){z={value:{},valueDB:{}};z.value[I.get("objectId")]=W;z.valueDB[I.get("objectId")]=S}t[T]=Q}}}});I.clearChangedValue();var H=I.get("EditProp_listOfChange");if(H){I.setChangedValues(H);I.unset("EditProp_listOfChange")}if(O){I.setChangedValues(O)}var M=I;var J=!A[M.get("objectId")];if(J){A[M.get("objectId")]=M;var L=new j();L.setModel(a.MODEL_INIT,M);B.push(L)}}});var D=Object.keys(A).length;if(D>1){var r=B[0];var C=r.getModel(a.MODEL_INIT);if(C!=null){var u=UWA.clone(C.getOptions());for(var E in t){var v=t[E];if(v.__nbValues===D){u[E]=t[E]}}if(z!=null){u[a.MODEL_DS_ATTR+"label"]=new h({sectionIdentityCard:"title",value:z.value,valueDB:z.valueDB,isTransient:true,multisel:true,path:a.MODEL_DS_ATTR+"label"})}var n=k.getWidgetPreference("transactionId");var n=n&&n.value?n.value:p._generateMergeID();var m=new j({modelPrefix:n,isMerging:true});u.objectId=n;var x=new e(u);x.setMergingModels(A);m.setModel(a.MODEL_INIT,x);B.unshift(m)}else{console.log("First model not found in occurrence")}}}window.top.performance.mark("end_setModelController");this.skeleton.setOccurrences(B)},_generateMergeID:function(){return k.generateUniqueId()},_getModel:function(m){return this.skeleton.getModel(m)},getModels:function(){return this.skeleton.getModels()},getTitle:function(){return this.skeleton.getTitle()},getOptimalSize:function(){return this.skeleton.getOptimalSize()},getUI:function(){return this.skeleton},onRefresh:function(){var m=this;var n=m.getModels();m.setModels([],undefined);m.setModels(n,undefined)},_getFacet:function(n,q){var p=q;if(typeof q==="string"){p=n[q]}else{if(typeof q==="object"&&!!q.id){var m=n[q.id];if(!!m){for(var o in q){m[o]=q[o]}p=m}}}return p},addFacets:function(o){if(!!o){var n=this;var m=[];var q=l.getMapping();o.forEach(function(r){m.push(n._getFacet(q,r))});var p=this.getUI();if(!!p){p.addFacets(m)}}},_setup:function(p){var q=this;var r=l.getMapping(p);var o=l.getDefaultFacets();if(p.facets){o=p.facets;delete p.facets}var n=[];var m=false;o.forEach(function(t){var s=q._getFacet(r,t);if(s){if(!m&&s.facet&&s.facet.name===a.FACET_PROPERTIES){m=true}n.push(s)}});if(!m){r[a.FACET_PROPERTIES]["visible"]=false;n.push(r[a.FACET_PROPERTIES])}this.skeleton=new i(n,p)},destroyComponent:function(){if(this._commandProxy){this._commandProxy.unsubscribe("onUpdateTransient");this._commandProxy.unsubscribe("onSelect")}},onResize:function(){this.getUI().onResize()},_raiseNotif:function(n,m){this.dispatchEvent("onNotification",{msg:n,eventID:m})},stopSelection:function(m){this._selectionIsStopped=m===true},_onSelectionChange:function(z,m){if(this.options.selectionType===a.NO_SELECTION||this._selectionIsStopped===true){return}var y=z.pathsInst;var n=!!y;y=y&&y.length>0?y:z.paths;var v=y.length;var p=z.attributes;var A=this.getModels();var t=[];A.forEach(function(B){t.push(B.get("objectId"))});var u=false;if(this.options.selectionType===a.RESTRICTED_SELECTION){u=m.metadata&&m.metadata.originWidgetId===k.getWidgetId()}else{u=true}if(u){var w=this;var r=[];for(var q=0;q<v;q++){var o=y[q];if(o){var s=f.getModelFromPath(o,p,n);if(!s.get("tenant")&&z.tenant){s.set("tenant",z.tenant)}r.push(s)}}var x=null;if(k.isChangeAvailable()){x=UWA.clone(z.changeControl)}this.setModels(r,x?x:null)}}});return d});define("DS/EditPropWidget/EditPropWidget",["UWA/Core","UWA/Controls/Abstract","DS/WidgetServices/WidgetServices","DS/EditPropWidget/comm/EventManager","DS/EditPropWidget/controllers/EditPropMainController"],function(g,f,e,a,d){var c=function(h){this.setReadonlyStatus(h)};var b=f.extend({defaultOptions:{},_getController:function(h){return this.controller?this.controller:new d(h)},init:function(k,l){if(l){e.setWidgetObject(l)}var h={};for(var i in k){h[i]=k[i]}var j=this;this._parent(h);if(!this.elements){this.elements={}}if(!h.events){h.events={}}h.events["onInnerCancel"]=function(){j.destroyComponent()};this.controller=this._getController(h);this.elements.UI=this.controller.getUI();this.elements.container=this.elements.UI;this.elements.container.getContent().addEvent("resize",function(){j.onInnerResize()});if(e.isReplayedODT()||e.getWidgetObject().getValue("proto")===true){this._handlerSwitch=c.bind(this);a.subscribe("switchMode",this._handlerSwitch)}},initDatas:function(h){this.controller.setModels(h)},initData:function(h){this.initDatas(h)},show:function(h){if(this.elements.popup){this.elements.popup.show();this.initDatas(h)}},centerIt:function(h){if(this.elements.popup){this.elements.popup.centerIt()}},onRefresh:function(){this.controller.onRefresh()},onResize:function(){},onInnerResize:function(){if(this.elements.popup){this.elements.popup.onResize()}else{if(this.elements.UI){this.elements.UI.onResize()}}},setReadonlyStatus:function(h){this.elements.UI.setReadonlyStatus(h)},selectFacet:function(h){this.elements.UI.selectFacet(h)},removeFacets:function(h){this.elements.UI.removeFacets(h)},stopSelection:function(h){this.controller.stopSelection(h)},addFacets:function(h){this.controller.addFacets(h)},getTitle:function(){return this.elements.UI.getTitle()},getIdentityCardUI:function(){return this.elements.UI.getIdentityCardUI()},getMainTable:function(h){return this.elements.UI.getMainTable()},getListModel:function(){return this.controller.getModels()},destroyComponent:function(){if(this._handlerSwitch){a.remove("switchMode",this._handlerSwitch)}this.controller.destroyComponent();if(this.elements.popup){this.elements.popup.destroyComponent()}else{this.elements.UI.destroyComponent()}},});return b});define("DS/EditPropWidget/EditPropWidgetHTML",["DS/EditPropWidget/EditPropWidget","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel"],function(c,j,b,g,a){window.top.performance.mark("end_EP_HTMLProperties");window.top.performance.mark("start_widgetLoading");if(!window.currentPropertiesOptions){window.currentPropertiesOptions={}}var e=null;var d=true;var i="600";var h=null;var f={onLoad:function(){window.top.performance.mark("end_widgetLoading");window.top.performance.mark("start_managePref");var u=this;if(!currentPropertiesOptions.selected){if(j.getUrlParameter("selected")){var v=j.getUrlParameter("meta")?j.getUrlParameter("meta"):null;var x=j.getUrlParameter("tenant")?j.getUrlParameter("tenant"):null;var k=j.getUrlParameter("source")?j.getUrlParameter("source"):null;var n=j.getUrlParameter("sourceName")?j.getUrlParameter("sourceName"):null;var q={objectId:j.getUrlParameter("selected")};if(v){q.metatype=v}if(x){q.tenant=x}if(k){q.source=k}if(n){q.sourceName=n}currentPropertiesOptions.selected=[new a(q)]}else{var y=j.getWidgetPreference("SelectedItem");if(y!=null&&typeof y=="object"){d=j.getWidgetPreferenceValue("loadData")==="true"||j.getWidgetPreferenceValue("loadData")===true;currentPropertiesOptions.selected=Array.isArray(y.value)?y.value:[]}}}j.setWidgetValue("x3dAppId","ENOLCMT_AP");document.body.addClassName("editPropWidgetHTML");var l=j.getWidgetPreferenceValue("editProperties_editMode")==="true";var s=j.getWidgetPreferenceValue("isTransient")==="true";var r=g.STANDARD;if(s){r=g.TRANSIENT}var p=j.getUrlParameter("readonly")==="true";p=p||(widget.getBool("readOnly")!=="false"&&widget.getBool("readOnly")!==false);window.top.performance.mark("end_managePref");window.top.performance.mark("start_createProp");e=new c({readOnly:p,showTopBar:true,setCloseButton:true,setEditButton:true,displayType:r,selectionType:g.ALL_SELECTION,editMode:l,topClassHeight:"modal-content",events:{onTitleChanged:function(B){var A=B||B===""?B:e.getTitle();A=A?A.unescapeHTML():"";widget.setTitle(A)},onDataLoaded:function(){e.onResize();setTimeout(function(){if(j.isChangeAvailable()){require(["DS/EditPropWidget/changeAction/passThruJS"],function(A){A.onReady(function(C){var E=j.getWidgetPreference("changeControl");var F=null;var D=true;if(E&&E.value){var B=E.value;D=!C.changeIsSetChecker(B)}C.initialize(e.elements.container.elements.container,null,D?"hide":"show","bottom-left",{isEditable:false});enoviaServerAuthoringWidget.saveMode="change";if(!D){C.set(B)}})})}})}}});window.top.performance.mark("end_createProp");var w=e.getTitle();widget.setTitle(w);widget.body.setContent(e);var o=widget.getView().type;if(o!="fullscreen"&&o!="maximized"){f._setBodyHeight(i)}h=j.getWidgetPreference("securityContext");if(h&&h.value){b.getInstance({context:{getSecurityContext:function(){return{SecurityContext:h.value}}}}).getSecurityContext()}var m=j.getWidgetPreference("isTransient");if(m&&m.value==="false"){j.deleteWidgetValue("SelectedItem")}j.setWidgetValue("isTransient","false");j.deleteWidgetValue("securityContext");var z=widget.body.getParent().getSize();f._setBodyHeight(z.height);var t=currentPropertiesOptions.selected?currentPropertiesOptions.selected:[];window.top.performance.mark("start_initdata");e.initDatas(t,{loadModel:d});window.top.performance.mark("end_initdata");currentPropertiesOptions.component=e},onRefresh:function(){e.onRefresh()},onResize:function(l){var k=widget.body.getParent().getSize();f._setBodyHeight(k.height);e.onResize()},onDestroy:function(k){e.destroyComponent()},onViewChange:function(m){var l=this;var k=m.height;if(m.type!=="fullscreen"&&m.type!=="maximized"){k=i}if(k){f._setBodyHeight(i)}},_setBodyHeight:function(k){if(k){if(k!=="auto"){k+="px"}widget.body.setStyle("height",k)}}};if(!j.isReplayedODT()){widget.addEvent("onLoad",f.onLoad)}else{setTimeout(function(){f.onLoad()})}widget.addEvent("onRefresh",f.onRefresh);widget.addEvent("onResize",f.onResize);widget.addEvent("onViewChange",f.onViewChange);window.addEventListener("unload",f.onDestroy);widget.setAutoRefresh(10000)});define("DS/EditPropWidget/form/Form",["DS/EditPropWidget/models/CommonAbstract","DS/WidgetServicesUI/helpers/Constants","DS/EditPropWidget/facets/Properties/TweakerManager","DS/EditPropWidget/utils/AttributesUtils","DS/WidgetServices/WidgetServices","DS/WidgetServices/moveHelper/MoveHelper","DS/UIKIT/Tooltip","DS/EditPropWidget/models/EditPropAttributeModel","css!DS/EditPropWidget/EditPropWidget.css"],function(v,o,d,h,l,c,q,t){var n=function(x){var y=x;if(x==="integer"){y=o.TYPES.INTEGER}else{if(x==="real"){y=o.TYPES.NUMBER}else{if(x==="timestamp"||x==="date"){y=o.TYPES.DATE}else{if(x==="person"){y=o.TYPES.PERSON}else{if(x==="boolean"||x==="radiobutton"||x==="checkbox"){y=o.TYPES.BOOLEAN}else{if(x==="enum"||x==="listbox"||x==="listboxmanual"||x==="combobox"){y=o.TYPES.ENUM}}}}}}return y};var j=function(y){var x=y.get("tw_type");if(!x){if(y.get("name")==="owner"){x=o.TYPES.PERSON}else{if(y.get("name")==="originated"||y.get("name")==="modified"){x=o.TYPES.DATETIME}else{x=n(y.get("type"))}}y.set("tw_type",x)}return x};var m=80;var p="formLabel";var b=function(y){var x=w(y);l.addNewStyles(y+"_style",x.style,true);return x};var r=function(z,y){try{localStorage.setItem(z+"_style",JSON.stringify(y))}catch(x){console.log("Local storage full. Current form size can't be saved")}};var s=function(y){var x=f(y,"200");r(y,x);return x};var w=function(A){var x=localStorage.getItem(A+"_style");var z=null;try{z=JSON.parse(x);if(z.width<m){z.width=m}}catch(y){}if(!z){z=s(A)}return z};var f=function(A,x){var z="."+A+" ."+p;var y={};y[z]={width:x+"px"};y["."+A+" .resizeHandler"]={left:(x-10)+"px"};return{style:y,width:x}};var e=function(x,z){var y=null;x.forEach(function(B){var A=b(B);if(z===B){y=A}});return y};var u=function(x,y){var z={};x.forEach(function(B){var A=w(B);if(y===B){A.current=true}z[B]=A});return z};var g=v.extend({postBuildTweaker:function(){if(this._tweaker){this._tweaker.postBuildUI()}this._finalizeWhenReady=true},destroy:function(){this._parent.apply(this,arguments);if(this._model){this._model.removeEvent(this._idAttr,this._manageMessageHandler)}},init:function(B,C,z,M){this._parent(M);this._idAttr=z.getIdentifier();this._model=C;this._form=B;this._tweaker=null;this._finalizeWhenReady=false;this._manageMessageHandler=this._manageMessage.bind(this);var D=this;if(M.postBuild!==true){this.subscribeEvt("triggerPostBuild",function(){D.postBuildTweaker()})}this.elements.container=UWA.createElement("div",{"class":"formLine s12 m12"+(!!z.get("width")?" l"+z.get("width"):" l12")});this.elements.flexLine=UWA.createElement("div",{"class":"flexLine"}).inject(this.elements.container);var F=UWA.createElement("div",{"class":p+" s12"}).inject(this.elements.flexLine);var E=this.options.readOnly!==true&&z.get("mandatory");var K=UWA.createElement("div",{"class":"attrLabel"+(E?" mandAttr":"")}).inject(F);var L=UWA.createElement("span",{"class":"textContainer"}).inject(K);var H=UWA.createElement("span",{text:z.get("label")}).inject(L);new q({position:"left top",target:H,body:z.get("label")});if(E===true){UWA.createElement("div",{"class":"attrMand fonticon fonticon-asterisk-alt"}).inject(K)}var J=UWA.createElement("div",{"class":"formValue s12"}).inject(this.elements.flexLine);var A=UWA.createElement("div",{"class":"formTweakerContainer"}).inject(J);if(this.options.readOnly!==true){var y=UWA.createElement("span",{"class":"messageIndicator fonticon fonticon-cancel"}).inject(J);var I=new UWA.createElement("div",{"class":"formError"}).inject(J);this.elements.errorContent=I}var x=j(z);var G={};if(this.options.readonly){G.readOnly=this.options.readOnly}G.postBuild=this.options.postBuild;this._form.tweakerManager.getTweaker(C,this._idAttr,x,G,function(N){N.inject(A);D._tweaker=N;if(D._finalizeWhenReady){D.postBuildTweaker()}D.dispatchEvent("tweakerReady:"+D._idAttr,[N])});C.addEvent("onChange:"+this._idAttr,this._manageMessageHandler);this._manageMessage()},showNotificationOnField:function(y){if(this.elements.errorContent){this.elements.errorContent.setText(y.message?y.message:"")}if(y.message){var x=y.type?y.type:"error";this.elements.flexLine.addClassName("notif"+x);this.elements.flexLine.addClassName("errorOnField")}else{this.elements.flexLine.removeClassName("errorOnField")}},_manageMessage:function(){var x=this._model.get(this._idAttr);var z=j(x);x.validationFunction=this._form.tweakerManager.getValidationFunction(z);var y=h.validateAttributes(this._model,[x]);if(x&&x.error){this.showNotificationOnField(x.error)}if(y&&y.length>0&&(!this._tweaker||this._tweaker.underEdition===true)){this.publishEvt("onNotifications",y)}}});var i=null;var a=null;var k=v.extend({defaultOptions:{width:12,label:null,classname:"large",postBuild:true},_sharedOptions:null,isReadOnly:function(){var x=this._sharedOptions;return x?x.readOnly===true:true},init:function(y,A){this._parent(y);this._sharedOptions=A;var z=this;this.elements.container=UWA.createElement("fieldset",{"class":"formContainer s12 m12 l"+this.options.width});this.fields=[];var C=UWA.createElement("div",{"class":"resizeHandler"}).inject(this.elements.container);var B=null;var x=null;this.elements.moveHelpers=new c({element:C,events:{startMove:function(){x=null;var D=w(z.getClassResize());B=D.width},move:function(E){x=null;if(E.diff.x){var D=(B-E.diff.x);if(D<m){D=m}x=f(z.getClassResize(),D);l.addNewStyles(z.getClassResize()+"_style",x.style,true)}},endMove:function(){if(x){var D=r(z.getClassResize(),x);x.userAction=true;z._publishResizeCell(x)}x=null}}});if(y.label){UWA.createElement("legend",{text:y.label}).inject(this.elements.container)}this.elements.content=UWA.createElement("div",{"class":"formContent"}).inject(this.elements.container);this.subscribeEvt("editionSwitched",function(D){z.switchTweakersStatus()});this.subscribeEvt("innerSwitch",function(E){z.options.sizeClassname=E;if(a!==this.index){a=this.index;var D=w(E);z._publishResizeCell(D)}});this.subscribeEvt("resetDisplay",function(){if(i!==this.index){i=this.index;z.resetDisplay()}});this.tweakerManager=new d({editable:this._sharedOptions.editMode===true,onNotification:function(D){z.publishEvt("onNotifications",D)}},this._sharedOptions);this._manageEditionStatus();if(this.options.automaticCSS===true){this.updateCSS()}},updateCSS:function(){var x=e(this.options.classnames,this.options.sizeClassname);this._publishResizeCell(x)},_publishResizeCell:function(x){var y=null;if(!!x){y=u(this.options.classnames,this.options.sizeClassname);y.userAction=x.userAction}this.publishEvt("onResizeCells",y)},resetDisplay:function(){var x=this.options.classnames;if(!x){x=[this.getClassResize()]}x.forEach(function(z){var y=s(z);l.addNewStyles(z+"_style",y.style,true)});this._publishResizeCell(null)},getClassResize:function(){return this.options.sizeClassname},_manageEditionStatus:function(){var x=this.isReadOnly()===false&&this._sharedOptions.editMode===true;if(x){this.elements.container.addClassName("underEdition")}else{this.elements.container.removeClassName("underEdition")}this.tweakerManager.switchMode(x)},destroy:function(){this.clear();this.fields.forEach(function(x){x.destroy()});this._parent.apply(this,arguments)},switchTweakersStatus:function(){this._manageEditionStatus()},_clearAllFields:function(){this.tweakerManager.clear()},_actionOnScroll:function(){this.tweakerManager.actionOnScroll()},clear:function(){this._clearAllFields();this.elements.content.empty()},setModel:function(A,z){var C=this;this.clear();var y=z!=null&&z.attrs?z.attrs:A.getAllAttributes();var D=[];for(var B in y){var x=y[B];if(x instanceof t){D.push(x)}}D.sort(function(F,E){return l.compareValue(E.get("positionUI"),F.get("positionUI"))});D.forEach(function(E){C._addLine(A,E)})},_addLine:function(y,z){var A=this;this.options.readOnly=this.isReadOnly();var x=new g(this,y,z,this.options);this.fields.push(x);x.inject(this.elements.content)}});return k});define("DS/EditPropWidget/popup/EditPropPopup",["UWA/Controls/Abstract","DS/Logger/Logger","DS/EditPropWidget/controllers/EditPropMainController","DS/WidgetServices/WidgetServices","DS/EditPropWidget/constants/EditPropConstants","DS/UIKIT/Spinner","DS/ENOFloatingPanel/ENOFloatingPanel","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/editPropPopup"],function(j,g,f,o,d,h,n,c,m){var b="1000";var e="1000";var k="ENOVIA - "+m.get("Properties");var i=600;var a=40;var l=j.extend({defaultOptions:{className:"",readOnly:false,serverName:"",serverUri:"",editMode:false,container:null,context:null},init:function(p){this.dataReady=false;this._parent(p);this.initUI()},centerIt:function(){this.centerAtNextResize=false;this.container.centerIt()},setDefaultListOfModel:function(p){this.defaultModels=p},setDataReady:function(p){if(p){this.defaultModels=null}this.dataReady=p},getController:function(){return this.propController},initUI:function(){var y=this;this.centerAtNextResize=false;this.widgetPere=this.options.container;this.widgetPere=this.widgetPere?this.widgetPere:o.getWidgetBody();var C={};var E=this.options;for(var B in E){C[B]=E[B]}C.className="editProp_innerComponent";C.showTopBar=false;C.popup=true;C.setCloseButton=true;C.setEditButton=true;C.events={};var v=false;var w={onDataLoaded:function(){if(v){var G=y.propController.getOptimalSize();var F=G.width;if(F<i){F=i}y.container.setNewBodySize({width:F,height:G.height});y.container.lockWidth();y.centerAtNextResize=true}y.fakeFloatingPanel.hide()},onTitleChanged:function(){var F=y.propController.getTitle();if(!!F){F=F.replace(/(&nbsp;)/g," ");F=F.replace(/(<wbr>)/g,"");F=" - "+F}y.container.setTitle(k+F)},onIdentityCardExpands:function(){y.onResize()}};if(E.events){for(var B in E.events){C.events[B]=E.events[B]}}for(var B in w){C.events[B]=w[B]}y.propController=new f(C);var u=y.propController.getTopBar();var s=UWA.createElement("table",{"class":"EditProp_topBarPopup"});var D=UWA.createElement("td",{"class":"titleSpan"}).inject(s);var x=UWA.createElement("td",{"class":"right-actions"}).inject(s);var z=null;var A=null;var t=null;if(!o.isWebInWinEnvironment()&&!o.isNatifEnvironnement()){z=o.getRealPath("EditPropWidget/EditPropWidget.html",widget,false);A={custoClass:"properties_piner",widgetTitle:"",widgetAppId:"ENOLCMT_AP",widgetData:{title:"My widget",SelectedItem:[],loadData:true,editProperty_collapseIC:o.getWidgetValue(d.COLLAPSE_IC_PREFERENCE.name),editProperties_editMode:o.getWidgetValue("editProperties_editMode"),},};t=function(F){var G=y.propController.getModels();if(G.length===0&&y.defaultModels){G=y.defaultModels}var H=[];G.forEach(function(J,I){var K=UWA.clone(J.getChangedValues());G[I].set("EditProp_listOfChange",K)});F.widgetData.SelectedItem=G;F.widgetData.loadData=!y.dataReady;F.widgetData.editProperty_collapseIC=o.getWidgetValue(d.COLLAPSE_IC_PREFERENCE.name);F.widgetData.editProperties_editMode=o.getWidgetValue("editProperties_editMode")}}var r=UWA.createElement("span");(new h({visible:true})).inject(r);UWA.createElement("span",{tag:"span",text:m.get("Loading")}).inject(r);y.fakeFloatingPanel=new n({className:"EPP_PopupDialFake",body:r,title:k,pinOptions:A,pinCallback:t,overlay:false,closable:true,animate:true,resizable:false,events:{onClose:function(){y._cancel()}}});y.container=new n({className:"EPP_PopupDial "+this.options.className,body:y.propController.getUI(),footer:y.propController.getTopBar(),title:k,pinOptions:A,pinCallback:t,persistId:"floatProperties",overlay:false,closable:true,animate:true,resizable:true,autocenter:false,events:{onResizeFloating:function(){if(y.centerAtNextResize){y.centerIt()}},onClose:function(){y._cancel()}}});v=!y.container.isDimensionSaved();y.container.elements.container.setStyle("left",-20000);y.fakeFloatingPanel.inject(this.widgetPere);y.container.inject(this.widgetPere);var p=this.container.elements.header;var q=this.container.elements.content;setTimeout(function(){var H=y.widgetPere.getSize();var G=p.getSize();var F=e;if(b>H.height-G.height){F=H.height-G.height}if(v){y.container.setNewSize({width:i,height:F})}y.fakeFloatingPanel.centerIt()},0)},show:function(){this.fakeFloatingPanel.show();this.container.show()},onRefresh:function(){if(this.propController!=null){this.propController.onRefresh()}},onResize:function(){this.container.onResize();if(this.propController){this.propController.onResize()}},_cancel:function(){this.dispatchEvent("onCancel");this.dispatchEvent("onInnerCancel")},destroyComponent:function(){this.propController.destroyComponent();this.container.hide();this.container.destroy();this.fakeFloatingPanel.hide();this.fakeFloatingPanel.destroy()}});return l});define("DS/EditPropWidget/EditPropComponent",["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/popup/EditPropPopup"],function(c,b){var a=c.extend({init:function(d){this._parent(d)},_getController:function(d){this.elements.popup=this.elements.popup?this.elements.popup:new b(d);return this.controller?this.controller:this.elements.popup.getController()}});return a});define("DS/EditPropWidget/form/FormOrganizer",["DS/EditPropWidget/models/CommonAbstract","DS/EditPropWidget/models/EditPropAttributeModel","DS/WidgetServices/WidgetServices","DS/EditPropWidget/form/Form"],function(b,a,e,c){var d=b.extend({_sharedOptions:null,init:function(f,h){var g=this;this._parent(f);this._display=null;this._sharedOptions=h;this._forms=[];this.elements.container=UWA.createElement("div",{"class":"formOrganizer "+(this.options.className?this.options.className:"")})},destroy:function(){this.clear();this._parent.apply(this,arguments)},clear:function(){this._forms.forEach(function(f){f.destroy()});this._forms=[]},_callOnForms:function(g,f){this._forms.forEach(function(h){h[g].apply(h,f)})},setModel:function(h,f){var g=h.getAllAttributes();this.setAttributes(h,g,f)},setAttributes:function(h,p,g){var i=this;this.clear();var m={};var k=[];for(var o in p){var l=p[o];if(l instanceof a&&l.isTransient!==true){var q=l.get("form");if(!q){q="DSDefault"}var j=m[q];if(!j){var n=g?g[q]:null;j={list:[],name:q};if(n){j.group=n;if(n.position!==undefined){j.position=n.position}}k.push(j);m[q]=j}j.list.push(l)}}k.sort(function(s,r){t=null;var t=s.position===undefined&&r.position!==undefined?1:null;t=t===null&&r.position===undefined&&s.position!==undefined?-1:t;t=t===null&&r.position!==undefined&&s.position!==undefined?s.position-r.position:t;t=t===null?e.compareValue(r.name,s.name):t;return t});var f=++window.top.perfoIncrem;window.top.performance.mark("start_buildForm:"+f);k.forEach(function(r){var t=UWA.clone(i.options);if(r.group){for(var s in r.group){t[s]=r.group[s]}}t.automaticCSS=false;var u=new c(t,i._sharedOptions);u.setModel(h,{attrs:r.list});u.inject(i.elements.container);i._forms.push(u)});if(i._forms.length>0){i._forms[0].updateCSS()}window.top.performance.mark("end_buildForm:"+f)}});return d});define("DS/EditPropWidget/facets/Properties/EditPropBase",["UWA/Class","DS/UIKIT/Tooltip","DS/WidgetServicesUI/helpers/Constants","DS/EditPropWidget/facets/Properties/TweakerManager"],function(b,d,e,a){var f="span";var c=b.extend({lTooltip:[],elements:{},_sharedOptions:null,init:function(g,i){var h=this;this._sharedOptions=i?i:{};this._parent(g);this.tweakerManager=new a({editable:g.editMode===true,onNotification:function(j){h._manageError(j)}},i)},getSharedOptions:function(){return this._sharedOptions},isReadOnly:function(){var g=this.getSharedOptions();return g?g.readOnly===true:true},switchTweakersStatus:function(g){this.tweakerManager.switchMode(g)},_clearAllFields:function(){this.tweakerManager.clear()},_actionOnScroll:function(){this.tweakerManager.actionOnScroll()},_valueIsChanging:function(h,g){},setError:function(g){},_manageError:function(h,g){}});return c});define("DS/EditPropWidget/form/FormSections",["DS/EditPropWidget/models/CommonAbstract","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/form/FormOrganizer","DS/EditPropWidget/comm/EventManager","DS/WidgetServices/WidgetServices","DS/UIKIT/Accordion","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(c,g,j,d,k,h,e){var i=e.get("accordion_attributes");var a=e.get("accordion_parameters");var b=[{title:i,name:i,selected:true,className:"EditProp_basicAttributes"}];var f=c.extend({_sharedOptions:null,defaultOptions:{showSections:true,sizeClassname:"large"},init:function(l,n){var m=this;this._parent.apply(this,arguments);this.options.classnames=["large","medium","small"];this._sharedOptions=n;this.elements.accordion=new h({exclusive:false,items:[],events:{onOpen:function(o){d.publish("onTableOpened",o.name)}}});this.elements.container=UWA.createElement("div",{"class":this._getDefaultClassname()+" "+this.options.sizeClassname});this.elements.container.addEvent("resize",function(){console.log("resize section")});this.elements.accordion.inject(this.elements.container);this.subscribeEvt("switchDisplay",function(p){var o=m._switchDisplay(p);if(!o){m.publishEvt("innerSwitch",m.options.sizeClassname)}});this.subscribeEvt("switchWrap",function(){m._switchWrap()});this.elements._organizers={};this._accordionProperties=[];this._openedSections=[i]},_switchWrap:function(){if(this.options.titleWrap){this.elements.container.removeClassName("formWrap")}else{this.elements.container.addClassName("formWrap")}this.options.titleWrap=!this.options.titleWrap},_getDefaultClassname:function(){var l="";if(k.isTouchDevice()){l="touchDevice "}if(this.options.titleWrap===true){l+="formWrap"}return"formSections "+l},_switchDisplay:function(m){var l=this._display===m;if(!l){this._display=m;this._checkSize()}return l},_checkSize:function(){var l=this.elements.container.getSize().width;var m=this._getDefaultClassname();if(this._display===null&&l<500||this._display==="s"){this.options.sizeClassname="small"}if(this._display===null&&l<1000&&l>500||this._display==="m"){this.options.sizeClassname="medium"}if(this._display===null&&l>1000||this._display==="l"){this.options.sizeClassname="large"}m+=this.options.sizeClassname;this.elements.container.className=m},inject:function(){var l=this;this._parent.apply(this,arguments);setTimeout(function(){l._checkSize()})},getOrganizers:function(){return this.elements._organizers},setAccordionProperties:function(l){this._accordionProperties=l},_callOnOrganizers:function(o,l){for(var m in this.elements._organizers){var n=this.elements._organizers[m];n[o].apply(n,l)}},getSelectedItems:function(){var l=this;var m=[];var n=this.elements.accordion.getSelectedItems();n.forEach(function(p){var o=l.elements.accordion.getItem(p.id);if(o){m.push(o.name)}});return m},openSections:function(l){var m=this;l.forEach(function(n){m.openSection(n)})},openSection:function(l){this.elements.accordion.selectItem(l)},destroy:function(){this.clear();this._parent.apply(this,arguments)},clear:function(){this.reset()},setModel:function(p,o){var q=this;this.clear();this._model=p;this._groups=o;var y=p.getAllAttributes();var v={};var s=[];for(var x in y){var t=y[x];if(t instanceof g&&t.isTransient!==true){var w=i;var m=t.get("facet");var u=t.get("section");m=m?m:u;var z=q.options.showSections||m===a;if(z){w=m?m:i}var r=v[w];if(!r){var l=q._accordionProperties[w];l=l?l:{};if(!l||!l.name||!l.nameNLS){l.name=w;l.nameNLS=u?u:w}q._accordionProperties[w]=l;if(!l.weight){l.weight=0}r={list:[],name:w,section:l};s.push(r);v[w]=r}r.list.push(t)}}s.sort(function(C,B){var A=C.section.weight===B.section.weight?null:C.section.weight<B.section.weight?1:-1;A=A===null?k.compareValue(B.name,C.name):A;return A});var n=++window.top.perfoIncrem;window.top.performance.mark("start_buildSections:"+n);s.forEach(function(A){q.addSection(A)});window.top.performance.mark("end_buildSections:"+n);this.openSections(this._openedSections)},addSection:function(n,t){var r=n.section;var u=r;var m=r;if(typeof r=="object"){u=r.name}if(t){var p=!!this.elements.accordion.getItem(u);if(p){return}}var l=this._accordionProperties[u];var s=null;if(l){if(!t){if(l.nameNLS){m=l.nameNLS}}if(l.icon){if(l.icon==="classif"){s=UWA.createElement("span",{"class":"fonticon fonticon-flow-tree",title:e.get("EP_icon_classification")})}else{s=UWA.createElement("img",{src:l.icon,width:"10px"})}}}var q=UWA.createElement("span",{text:m});if(s){s.inject(q)}var o=m?m.replace(/ /g,"_"):"";this._addSection({selected:m===a?false:this.options.sectionAutoexpand,name:u,attrs:n.list,title:q,orgClassName:"formSection_"+o})},reset:function(){if(this.elements.accordion.items.length>0){this._openedSections=this.getSelectedItems()}for(var m in this.elements._organizers){var l=this.elements._organizers[m];l.remove();l.destroy();delete this.elements._organizers[m];this.elements.accordion.removeItem(m)}},_addSection:function(n){if(n&&n.name){var m=n.name;var l=this.elements._organizers[m];if(!l){var o=UWA.clone(this.options);o.className=n.orgClassName;l=new j(o,this._sharedOptions);this.elements._organizers[m]=l;n.content=l.getContent();this.elements.accordion.addItem(n)}l.setAttributes(this._model,n.attrs,this._groups)}this._manageAccordionVisibility()},_manageAccordionVisibility:function(){if(this.elements.accordion.items.length<=1){this._hideAccordion()}else{if(this.elements.accordion.items.length==2){this._showAccordion()}}},_hideAccordion:function(){var n=this.elements.accordion.getItem(0);if(n){var m=this.elements.accordion.elements.container.parentElement;var l=this.elements._organizers[n.name];l.inject(m)}this.elements.accordion.hide()},_showAccordion:function(){var m=this.elements.accordion.getItem(0);if(m){var l=this.elements._organizers[m.name];l.inject(m.elements.content)}this.elements.accordion.show()},});return f});define("DS/EditPropWidget/ajaxRequests/3DSpaceAjaxRequests",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/WAFData/WAFData"],function(h,b,f,d,a){var c=true;var g="EditPropWidget";var e={commitModels:function(p){var m=this;var i=p.modelList;var o=p.securityContext;var l="/resources/v1/collabServices/attributes/op/update?propertiesFacet=true";var j=[];var k=false;i.forEach(function(u,t){var r=b._createJSONModifiedAttribute(u);k=k||r.requests.length>0;j=j.concat(r.requests);var s=r.plmParametersRequests;if(s.length>0){b._concatRequestListComposite(j,s)}});var q=i.length>0?i[0]:null;var n={requests:j};if(k&&q!=null&&q.isMergedModel()){n.transactionid=q.get("objectId")}p.model=q;p.onCompleteWS=b._onCompleteCommit;b.createRequest(p,"PUT",l,n)},getPreviewUrl:function(i){var j=i.modelList;var l=j.length;var k=[];var m="";j.forEach(function(o){var n=o.get("objectId");m=m?m:o.get("tenant");if(n){k.push("physicalid:"+o.get("objectId"))}});if(k.length>0){i.ids=k;i.tenant=m;f.getPreviewUrl(i)}},getHistory:function(i){b.securityContextDispatcher(i,this._getHistory)},_getHistory:function(t){var p=this;var l=t.modelList;var o=t.nbResult;var k=t.lastDate;var q=t.securityContext;if(!t.handleRequest){t.handleRequest={}}o=o?o:20;var n=l.length;var u=false;if(n){var i="";var r="";l.forEach(function(v){var w=v.get("objectId");i+=r+"id="+w;r="&"});var j="GET";var m="/resources/v1/collabServices/attributes/op/history";var s=l.length>0?l[0]:null;t.handleRequest.handle=h.getSourceUrlAsync({platformId:b.getTenantFromModel(s),source:b.getSourceFromModel(s),onComplete:function(A){var w="";var z="";if(c){w="passport";z=A+m;z+="?"+i;z+="&nbResults="+o;k?z+="&lastDate="+k:""}var y={Accept:"application/json","content-type":"application/json"};y["Accept-Language"]=h.getLanguage();q?y.SecurityContext=encodeURIComponent(q):null;var x={type:"json",method:j,timeout:3600000,proxy:w,headers:y,cache:-1,onComplete:function(B){b._onCompleteAttributes(B,t)},onFailure:function(B,C,D){b._onFailure(B,C,D,t)},onTimeout:function(B){b._onTimeout(t)}};if(!h.getWidgetValue("isStandalone")){x.authentication="passport"}var v=l.length>0?l[0]:null;t.handleRequest.handle=a.handleRequest(b._formatUrl(v,z),x)}})}},checkFacetsVisibility:function(i){b.securityContextDispatcher(i,this._checkFacetsVisibility)},_checkFacetsVisibility:function(q){var n=this;var m=q.model;var j=m.get("objectId");var o=q.facets;var p=q.securityContext;if(!q.handleRequest){q.handleRequest={}}var l={id:j,facets:o};if(m.isMergedModel()){l.ids=m.getMergedModelIds()}var i="POST";var k="/resources/v1/collabServices/attributes/op/facets/available";q.handleRequest.handle=h.getSourceUrlAsync({platformId:b.getTenantFromModel(m),source:b.getSourceFromModel(m),onComplete:function(v){var r="";var u="";if(c){r="passport";u=v+k}var t={Accept:"application/json","content-type":"application/json"};t["Accept-Language"]=h.getLanguage();p?t.SecurityContext=encodeURIComponent(p):null;var s={type:"json",method:i,timeout:3600000,proxy:r,headers:t,data:UWA.Json.encode(l),onComplete:function(w){b._onCompleteAttributes(w,q)},onFailure:function(w,x,y){b._onFailure(w,x,y,q)},onTimeout:function(w){b._onTimeout(q)}};if(!h.getWidgetValue("isStandalone")){s.authentication="passport"}q.handleRequest.handle=a.handleRequest(b._formatUrl(m,u),s)}})},getListOfAttributes:function(k){var s=this;var v=k.modelList;var m=k.navigateToMain===true?"true":"false";var l=k.securityContext;var z=h.getWidgetValue("index_mode");var r=v.length;var F=false;var u=false;if(r){var w=[];var o=[];var C=[];var G=v[0];var A=G.get("objectId");for(var E=0;E<r;E++){var D=v[E];var j={a:D};u=u||D.isMergedModel();if(D.isMergedModel()){j=D.getMergingModels()}for(var I in j){var t=j[I];var x=t.get("metatype");var q=t.get("objectId");F=F||x=="EBOM";if(!z&&(x==d.METATYPE_BUS||x=="bus")){C.push(q)}else{if(!z&&x==d.METATYPE_REL){o.push(q)}else{w.push(q)}}}}var y="POST";var n="";if(c){n="/resources/v1/proto/attributes/op/read";if(F===false&&!z){n="/resources/v1/collabServices/attributes/op/read"}else{if(z){n="/resources/v1/collabServices/attributes/op/readIndex"}}}var B=h.isDebug();var p=h.getWidgetValue("debug_properties")||B?"true":null;var H=null;if(!z){H={lIds:w,relIDs:o,busIDs:C,plmparameters:k.plmParams?"true":"false",attributes:k.attributes!==false?"true":"false",navigateToMain:m,readonly:k.readonly===true?"true":"false",debug_properties:p?p:""};if(u){H.format="merge"}if(u){H.transactionid=A}}else{H={lIds:w,indexattributes:"true",debug_properties:p?p:""}}var G=v.length>0?v[0]:null;k.model=G;k.withSC=true;k.withChange="silent";k.onCompleteWS=b._onCompleteAttributes;b.createRequest(k,y,n,H)}}};return e});define("DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests",["DS/EditPropWidget/ajaxRequests/3DSpaceAjaxRequests","DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests","DS/EditPropWidget/constants/ConstantsMapping","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,f,i,h){var a={checkFacetsVisibility:"_getDefaultFacetsVisibility"};var d=i.getSupportedServices();var c=d["3dspace"];if(c){c.service=e}var b=d.fedsearch;if(c){b.service=f}var g={_getAjaxService:function(k,o){var n=null;var m=null;var l=i.getSupportedServices();if(k&&k.length>0){var j=k[0];n=i.getServiceForModel(j)}if(n){var m=n.service;if(!m){require([n.require],function(p){n.service=p;o.call(null,n,k)})}else{o.call(null,n,k)}}else{o.call(null,{name:h.get("Unknown")},k)}},_onSourceUnavailable:function(k,j){var l=h.replace(h.get("sourceUnavailable"),{label:"SourceName",value:j});var m={message:l,code:"SU"};k.onComplete.call(null,{success:false,error:m})},_callMethodOnSource:function(j,l){var k=this;var m=j.modelList;if(!Array.isArray(m)&&j.model){m=[j.model]}this._getAjaxService(m,function(q,p){var n=q.service;if(n&&typeof n[l]==="function"){n[l].call(n,j)}else{var o=true;p.forEach(function(s){o=o&&s.get("isTransient")});var r=a[l];if(o&&r){k[r].call(k,j)}else{k._onSourceUnavailable(j,q.name)}}})},commitModels:function(j){this._callMethodOnSource(j,"commitModels")},getPreviewUrl:function(j){this._callMethodOnSource(j,"getPreviewUrl")},getHistory:function(j){this._callMethodOnSource(j,"getHistory")},checkFacetsVisibility:function(j){this._callMethodOnSource(j,"checkFacetsVisibility")},getListOfAttributes:function(j){this._callMethodOnSource(j,"getListOfAttributes")},_getDefaultFacetsVisibility:function(k){var j=k.model;var l=j.get("objectId");k.onComplete.call(null,{id:l,facets:{properties:true}})}};return g});define("DS/EditPropWidget/models/EditPropHistoryModel",["DS/EditPropWidget/models/HistoryObjectModel"],function(a){var b=function(c){this.user="";this.date="";this.event="";this.eventNls="";this.objects=[];this._generationObjectList=function(){if(this.objects&&this.objects.length>0){var e=[];this.objects.forEach(function(g){var f=new a(g);e.push(f)});this.objects=e}};for(var d in c){this[d]=c[d]}this.set=function(e,f){if(f!==undefined){this[e]=f}if(e==="objects"){this._generationObjectList()}};this.get=function(e){return this[e]};this._generationObjectList()};return b});define("DS/EditPropWidget/facets/Common/FacetsCore",["DS/EditPropWidget/models/CommonAbstract"],function(a){var b=a.extend({_sharedContext:null,destroyComponent:function(){},onResize:function(){},updateFacet:function(){},getButtons:function(){},onAction:function(c){},onSave:function(){},getExtensions:function(){},nothingToSave:function(){return true},isActionAvailable:function(c){return true},init:function(c){this._parent(c);if(!this.elements){this.elements={}}},getTabId:function(){return this.options.tabId?this.options.tabId:""},onRefresh:function(){this.updateFacet()},getContext:function(){return this._sharedContext},switchSaveButton:function(c){this._raiseEvent("switchSave",c)},switchAddButton:function(c){this._raiseEvent("switchAdd",c)},refreshActions:function(){this._raiseEvent("updateActions")},_raiseNotification:function(e,c,d){c=c?c:"error";this.dispatchEvent("onNotification",{msg:e,eventID:c,customClass:d})},_raiseEvent:function(c,d){if(c){this.dispatchEvent("onEvent",{facet:this.getTabId(),eventID:c,value:d})}},inject:function(c){var d=this.getUI();if(d){d.hide();d.inject(c)}},show:function(){return this.__callMethodOnUI("show")},hide:function(){return this.__callMethodOnUI("hide")},getOptimalSize:function(){return this.__callMethodOnUI("getSize")},__callMethodOnUI:function(e){var d=this._getUI();var c=d[e];if(typeof c!=="function"){d=this._getDOMUI();c=d[e]}return d?c.call(d):null},getUI:function(){return this._getUI()},_getDOMUI:function(){var d=this._getUI();var c=d;while(typeof c.getContent==="function"){c=c.getContent()}return c},_getUI:function(){return this.elements?this.elements.container:null},showLoader:function(){this._raiseEvent("switchLoader",true)},hideLoader:function(){this._raiseEvent("switchLoader",false)},display:function(c){this.setContext(c);this.show()},setContext:function(c){if(this._sharedContext!==c){this._sharedContext=c;this.updateFacet()}}});return b});define("DS/EditPropWidget/facets/Common/FacetsBase",["DS/EditPropWidget/facets/Common/FacetsCore","DS/EditPropWidget/constants/EditPropConstants"],function(c,a){var b=c.extend({_lastUpdatedId:null,_sharedOptions:null,init:function(d,e){this._sharedOptions=e;this._parent.apply(this,arguments);if(!this.elements){this.elements={}}},getSharedOptions:function(){return this._sharedOptions},isReadOnly:function(){var d=this.getSharedOptions();return d?d.readOnly===true:true},getOccurrence:function(){return this.getContext()},getModel:function(e){var d=null;var g=null;var j=this.getOccurrence();if(j){model=this.getOccurrence().getModel(this.getTabId())}if(e){if(model&&model.get("objectId")===e){g=model}if(!model&&j){var i=j.getAllModels();for(var f in i){var h=i[f];if(h&&h.get("objectId")===e){g=h;break}}}}else{if(j){if(!model){model=this.getOccurrence().getModel(a.FACET_PROPERTIES)}if(!model){model=this.getOccurrence().getModel(a.MODEL_INIT)}g=model}}return g},setContext:function(d){this.setOccurrence(d)},setOccurrence:function(e){var l=false;var i=null;var g=this.getOccurrence();if(g&&e){var d=g.getModel(a.MODEL_INIT);var j=g.getModel(a.FACET_PROPERTIES);var k=e.getModel(a.MODEL_INIT);i=this.getModel();var f=e.getModel(this.getTabId())}this._setOccurrence(e);var g=this.getOccurrence();if(g){var h=g.getModel(this.getTabId());if(f&&d.get("objectId")===k.get("objectId")){g.setModel(this.getTabId(),f)}else{if(j&&d.get("objectId")===k.get("objectId")){g.setModel(a.FACET_PROPERTIES,j)}else{if(d&&d.get("objectId")===k.get("objectId")){g.setModel(a.MODEL_INIT,d)}else{this.updateFacet()}}}}},_setOccurrence:function(d){this._sharedContext=d},setModel:function(d){if(this.getOccurrence()){this.getOccurrence().setModel(this.getTabId(),d)}}});return b});define("DS/EditPropWidget/facets/3DPlay/3DPlayFacet",["DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/Abstract","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","UWA/Class","DS/WidgetServices/WidgetServices","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(f,d,b,h,a,i,g){var c=100;var e=a.extend(d,f,{player3D:null,_3DViewLaunched:false,init:function(j){this._parent(j);this._initUI()},_initUI:function(){var j=this;this.elements.container=UWA.createElement("div",{"class":"container_3DPlay"});this.elements.containerHDThumbnail=UWA.createElement("div",{"class":"editProp_HDImageContainer",events:{click:function(){j._switchTo3DView();j._3DViewLaunched=true}}});this.elements.containerHDThumbnail.inject(this.elements.container);this.elements.containerHDThumbnail.hide();this.elements.container3DPlay=UWA.createElement("div",{"class":"editProp_3DPlayContainer"});this.elements.container3DPlay.inject(this.elements.container);this.elements.container3DPlay.hide()},_switchTo3DView:function(j){this.elements.containerHDThumbnail.hide();this.elements.container3DPlay.show();this._initPlayer(j)},_switchToHDThumbnail:function(j){this.elements.containerHDThumbnail.show();this.elements.container3DPlay.hide()},destroyComponent:function(){this._stop3DPlayer()},onResize:function(){},_stop3DPlayer:function(){if(this.player3D){this.player3D.dispose();this.player3D=null}},getIdentityCardUI:function(){return this.elements.topTable},_initPlayer:function(k){var j=this.getModel();if(j){var m=j.get("type");if(!m){m=j.get(b.MODEL_DS_ATTR+"type")}if(m){if(typeof m==="object"){m=m.valueDB;m=m?m:m.value}var o=j.get("objectId");if(this.currentId3DPlay===o&&this.player3D){return}this.elements.container3DPlay.setContent(g.get("3DPlay loading"));this._stop3DPlayer();var l={};if(k!==false){l.loading="autoplay"}var n=this;i.getSourceUrlAsync({platformId:h.getTenantFromModel(j),source:h.getSourceFromModel(j),onComplete:function(p){var q={container:n.elements.container3DPlay,input:{asset:{provider:"EV6",serverurl:p,physicalid:o,dtype:m,tenant:h.getTenantFromModel(j),requiredAuth:"passport"},usage:"preview"},options:l};require(["DS/3DPlayHelper/3DPlayHelper"],function(r){n.elements.container3DPlay.empty();n.player3D=new r(q);n.currentId3DPlay=o})}})}}},_handlerUpdateThumbnail:function(j){this._updateThumbnail(j)},updateFacet:function(){var k=this;this._3DViewLaunched=false;var j=this.getModel();if(j){j.removeEvent2("onChange:previewUrl",k._handlerUpdateThumbnail);j.removeEvent2("onChange:type_icon_url",k._handlerUpdateThumbnail);j.addEvent("onChange:previewUrl",k._handlerUpdateThumbnail.bind(this,j));j.addEvent("onChange:type_icon_url",k._handlerUpdateThumbnail.bind(this,j));this._updateThumbnail(j)}this._stop3DPlayer();this.onRefresh()},onRefresh:function(){var k=null;var j=this.getModel();if(j){var k=j.get("previewUrl");k=k?k:j.get("type_icon_url")}if(!k||this._3DViewLaunched===true){this._switchTo3DView(false)}else{this._switchToHDThumbnail()}},_updateThumbnail:function(k){var l=this;this._switchToHDThumbnail();var m=k.get("previewUrl");m=m?m:k.get("type_icon_url");if(m){this.elements.HDThumbnail=UWA.createElement("div",{"class":"editProp_BigThumbnail"});var j=new Image();j.onload=function(){if(this.naturalHeight<c){l._switchTo3DView(false)}else{l.elements.HDThumbnail.setStyle("background-image","url("+this.src+")")}};j.src=m;this.elements.containerHDThumbnail.setContent(this.elements.HDThumbnail)}},});return e});define("DS/EditPropWidget/facets/History/History",["DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/Abstract","UWA/Class","DS/DataDragAndDrop/DataDragAndDrop","UWA/Json","DS/UIKIT/Tooltip","DS/UIKIT/Scroller","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/WidgetServices/WidgetServices","DS/WidgetServices/UIInfra/UIInfra","DS/EditPropWidget/models/EditPropHistoryModel","DS/UIKIT/Spinner","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(a,h,d,j,o,k,e,i,n,l,c,g,b,m){var f=d.extend(h,a,{defaultOptions:{className:"",nbResults:5},pictureAPIConfig:{defaultSwym:"https://dsext001-eu1-215dsi0708-3dswym.3dexperience.3ds.com",pictureAPIPrefix:"/api/user/getpicture/login/",pictureAPISuffix:"/format/mini"},init:function(p){this._parent(p);this._initValues();this._initUI()},_initValues:function(){this._mapItemToDrag={};this.currentStatus={noMoreHistory:false,lastDate:null,model:null};this.request={getHistory:{handle:null}}},_initUI:function(){var r=this;this.elements={};this.elements.container=UWA.createElement("div",{"class":"EP_MainHistoryContainer "+this.options.className});this.elements.sub_container=UWA.createElement("div",{"class":"EP_SS_MainHistoryContainer"}).inject(this.elements.container);var p=UWA.createElement("div",{"class":"EP_HistoryFatherContainer"}).inject(this.elements.sub_container);var q=this.elements.historyContainer=UWA.createElement("div",{"class":"EP_HistoryContainer"}).inject(p);this.elements.scroller=new e({element:this.elements.sub_container}).inject(this.elements.container);this.elements.scroller.elements.content.addEventListener("scroll",function(){r._actionOnScroll()});this.elements.sSpinner=new g({className:"hist_small_spinner"}).inject(UWA.createElement("div",{"class":"hist_small_spinner_container"}).inject(p));this.elements.spinner=new g({className:"hist_spinner"}).inject(this.elements.container)},_actionOnScroll:function(){var q=this.elements.historyContainer.getSize();var s=this.elements.scroller.elements.content.getSize();var p=this.elements.sSpinner.elements.container.parentElement.getSize();var r=this.elements.historyContainer.getPosition();if(r.y<=s.height-q.height-p.height+2){this.loadHistory(this.currentStatus.model)}},_hideAll:function(){var p=this._getAllUIElements();p.length>0?null:this.elements.historyContainer.hide();this.elements.spinner.hide();this.elements.sSpinner.hide()},_showLoader:function(){var p=this._getAllUIElements();p.length>0?this._showSmallSpinner():this._showMainSpinner()},_showSmallSpinner:function(){this.elements.sSpinner.show()},_showMainSpinner:function(){this._hideAll();this.elements.spinner.show()},_hideSpinner:function(){this._hideAll();this.elements.historyContainer.show()},_createChangeNameUI:function(t,q){var p=UWA.createElement("div",{"class":"hist_modify_container"});if(q.info){var w=q.info.name;w=w?w:q.info.value;var s=q.info.was;if(t&&t.iconType){UWA.createElement("div",{"class":"hist_modify_container_image",html:{tag:"img","class":"EditProp_undraggable",width:"16px",src:t.iconType}}).inject(p)}var v=UWA.createElement("div",{"class":"hist_modify_container_txt"}).inject(p);var r=UWA.createElement("span",{text:w?w:""}).inject(UWA.createElement("div",{"class":"hist_modify_name"}).inject(v));var u=UWA.createElement("span",{text:s?s:""}).inject(UWA.createElement("div",{"class":"hist_modify_name hist_oldName"}).inject(v));new k({delay:{show:400},position:"top left",target:u,body:s});new k({delay:{show:400},position:"top left",target:r,body:w})}return p},_addHistory:function(s,y){var v=this;var A=UWA.createElement("div",{"class":"EP_HistoryElement"}).inject(this.elements.historyContainer);var r=y.get("userId");if(r){this._userPictureURL(r,{onComplete:function(I){var H=UWA.createElement("img",{tag:"img","class":"EditProp_undraggable img-circle",width:"45px",src:I}).inject(UWA.createElement("div",{"class":"EP_HistoryPicture"}).inject(A));H.hide();H.onload=function(J){A.addClassName("hist_withPicture");H.show()}}})}var u=UWA.createElement("div",{"class":"EP_HistoryInfos"}).inject(A);var F=y.get("objects");var z=y.get("eventNls");var D=y.get("time");var w=y.get("user");var x="";if(!w){x="Someone "}var p=F?F.length:0;var B=p>1?"s":"";var G=null;var E="";switch(z){case"addFolder":E=m.replace(m.get(x+"added {0} folder"+B),{"0":p});break;case"addContent":E=m.replace(m.get(x+"added {0} content"+B),{"0":p});break;case"removeFolder":E=m.replace(m.get(x+"removed {0} folder"+B),{"0":p});break;case"removeContent":E=m.replace(m.get(x+"removed {0} content"+B),{"0":p});break;case"changeName":E=m.get(x+"changed the name");G=this._createChangeNameUI(s,y);break;case"create":E=m.get(x+"create the object");break;default:E=m.get(x+"made some changes")}UWA.createElement("div",{html:[{tag:"span","class":"EP_history_user",text:w},{tag:"span",text:" "+E}]}).inject(u);var q=new Date(D).toLocaleString(n.getLanguage());UWA.createElement("div",{"class":"EP_History_date",text:q}).inject(u);if(null!=G){G.inject(u)}var C=UWA.createElement("div",{"class":"EP_History_ObjectList"}).inject(u);var t=["Workspace","Workspace Vault"];F.forEach(function(M){var Q=M.get("type");if(t.indexOf(Q)<0){var H=M.get("name");var T=M.get("label");T=T?T:H;var J=M.get("id");var O=J||J===0;var R=O?"exist":"hist_object_delete";var N=M.get("iconType");var U=null;if(N){U=UWA.createElement("div",{"class":"EP_History_type_icon",html:{tag:"img",width:"16px","class":"EditProp_undraggable",src:N}})}R+=U!==null?"":" withoutThumbnail";var S=UWA.createElement("div",{"class":"EP_History_dragObj"}).inject(C);var M=UWA.createElement("div",{"class":"EP_History_ObjectElement "+R}).inject(S);U?U.inject(M):null;var K=UWA.createElement("span",{"class":"EP_History_ObjectName",text:T}).inject(M);new k({delay:{show:400},target:K,body:T});if(O){var I={objectId:J,objectType:Q,serviceId:s.source,envId:s.tenant};var L=function(W,Y,V){if(Y.hasClassName(P)&&V===true){return}if(W.ctrlKey!==true){var X=v.elements.historyContainer.getElements("."+P);X.forEach(function(Z){Z.removeClassName(P)});v._mapItemToDrag={}}Y.toggleClassName(P);if(Y.hasClassName(P)){v._mapItemToDrag[J]=I}else{if(v._mapItemToDrag[J]){delete v._mapItemToDrag[J]}}};var P="hist_objectSelected";M.addEvents({click:function(V){L(V,this)}});j.draggable(M,{protocol:"3DXContent",version:"1.1",source:"ENOLCMT_AP",widget_id:n.getWidgetId(),data:undefined,start:function(W,aa){L(aa,M,true);v._mapItemToDrag[J]=I;var V=[];for(var Y in v._mapItemToDrag){V.push(v._mapItemToDrag[Y])}var X={data:{items:V}};var Z=o.encode(X);aa.dataTransfer.setData("text",Z);l.createGhostDnD(aa,{number:V.length,className:"Hist_ghost"})},stop:function(){}})}else{new k({position:"bottom",delay:{show:400},target:M,body:m.get("This object is not accessible"),})}}})},launchHistory:function(r){var q=r.length;var p=this.currentStatus.model?this.currentStatus.model.length:0;var t=false;if(q===p){t=true;for(var s=0;s<q;s++){t=r[s].get("objectId")===this.currentStatus.model[s].get("objectId");if(t===false){break}}}if(!t){this.clearHistory();this.loadHistory(r)}},clearHistory:function(){this._endOfRequest();this.currentStatus.lastDate=null;this.currentStatus.noMoreHistory=false;var p=this._getAllUIElements();p.forEach(function(q){q.remove()})},_getAllUIElements:function(){return this.elements.historyContainer.getElements(".EP_HistoryElement")},_userPictureURL:function(p,q){var r=this;n.get3DSwymUrlAsync({onComplete:function(s){var u=s?s:r.pictureAPIConfig.defaultSwym;var t=u?u+r.pictureAPIConfig.pictureAPIPrefix+p+r.pictureAPIConfig.pictureAPISuffix:"";q.onComplete.call(null,t)}})},updateFacet:function(p){this.clearHistory();this.loadHistory(this.getModel())},loadHistory:function(q){var s=this;if(q!=null&&!Array.isArray(q)){q=[q]}if(this.request.getHistory.handle&&q&&this.currentStatus.model&&(q.length!=this.currentStatus.model.length||q[0].get("objectId")!=this.currentStatus.model[0].get("objectId"))){this.request.getHistory.handle.cancel();this.request.getHistory.handle=null}var t=this.currentStatus.lastDate===null;if(s.currentStatus.noMoreHistory===false&&!this.request.getHistory.handle&&q){this.currentStatus.model=q;this._showLoader();var p=q[0].get("source");var r={modelList:q,tenant:q[0].getTenant(),nbResult:this.options.nbResults,onComplete:function(u){if(t){s.clearHistory()}s._endOfRequest();if(u.results){u.results.forEach(function(v){if(v.lastTime){s.currentStatus.lastDate=v.lastTime}if(v.history){var x={id:v.id,type:v.type,iconType:v.iconType,source:p,tenant:v.tenant};var w=s.getModel(x.id);if(w){if(v.history.length===0){s.currentStatus.noMoreHistory=true}v.history.forEach(function(y){var z=new c(y);s._addHistory(x,z)});s._actionOnScroll()}}if(v.error){s._setError({message:v.error})}})}else{s._setError({message:m.get("can't find history")})}},onFailure:function(u){s._endOfRequest();s._setError(u)}};if(this.currentStatus.lastDate){r.lastDate=this.currentStatus.lastDate}r.handleRequest=this.request.getHistory;r.handleRequest.handle=n.getCancelObject().handler;i.getHistory(r)}},_endOfRequest:function(){this.request.getHistory.handle=null;this._hideSpinner()},_setError:function(r,p,q){this._raiseNotification(r,p,q)}});return f});define("DS/EditPropWidget/facets/SwymComments/SwymComments",["DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/Abstract","UWA/Class","DS/WidgetServices/WidgetServices","DS/SocialToolbar/SocialToolbar","DS/UIKIT/Scroller","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(d,h,c,g,e,a,f){var b=c.extend(h,d,{_socialView:null,init:function(i){this._socialView=null;this._parent(i);this._initUI()},_initUI:function(){var i=this;this.elements.container=UWA.createElement("div",{"class":"container_SwymComment"});this.elements.content=UWA.createElement("div",{"class":"content_SwymComment"});this.elements.contentScroll=UWA.createElement("div",{"class":"contentScroll_SwymComment"});this.elements.contentScroll.inject(this.elements.content);this.elements.scroller=new a({element:this.elements.content}).inject(this.elements.container)},updateFacet:function(){if(this._socialView){this._socialView.destroy()}var k=this;this.elements.contentScroll.empty();var j=this.getModel();var i=null;if(j){var l=j.get("objectId");g.getServicesUrl({onComplete:function(q){if(Array.isArray(q)&&q.length>0){q=q[0]}var p=j.get("source")?j.get("source"):"3DSpace";var n=q[p]?q[p]:q["3DSpace"];var s=q["3DSwym"];var o=p==="3DSpace"?"pid:"+l:l;if(n){var m=s?s:"https://dsext001-eu1-215dsi0708-3dswym.3dexperience.3ds.com";var r=g.getTenantID();r=r?r:"OnPremise";k._socialView=new e({"3DSwymUrl":m,subjectURI:o,tenantId:r,serviceURL:n+"/resources",enableShare:false});k.elements.contentScroll.empty();k._socialView.inject(k.elements.contentScroll)}else{k._raiseNotification(f.get("CannotFindServerAdress"),"error","SC_FindServer")}}})}else{i=UWA.createElement("div",{"class":"SC_NoItems",text:f.get("NoItemSelected")}).inject(k.elements.contentScroll)}},destroyComponent:function(){if(this._socialView){this._socialView.destroy()}},onResize:function(){},onRefresh:function(){this.updateFacet()},});return b});define("DS/EditPropWidget/facets/Properties/Properties",["UWA/Class","DS/EditPropWidget/models/CommonAbstract","UWA/Json","UWA/Array","DS/WidgetServices/WidgetServices","DS/EditPropWidget/form/FormSections","DS/EditPropWidget/comm/EventManager","DS/EditPropWidget/facets/Properties/EditPropBase","DS/EditPropWidget/facets/Properties/PropertiesUIController","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(s,A,n,p,m,d,w,v,y,b,x,k,u,r,i){var h=null;var o=null;var a=null;var z=i.get("accordion_attributes");var j=i.get("accordion_parameters");var f=false;window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0;var t=null;var B=function(C){t=Date.now()};var l=function(C){var D=Date.now()-t;if(a&&D>300&&D<1500){C.preventDefault();if(C.changedTouches&&C.changedTouches.length>0){a.show(this.nodesCM,{position:{x:C.changedTouches[0].clientX+10,y:C.changedTouches[0].clientY+10}})}}};var c=function(){this._switchEditionMode(true)};var g=function(){if(!!this._firstModel){this.dispatchEvent("onTitleChanged",this._firstModel.get("label"))}};var q=function(){this._ManageValidButton()};var e=s.extend(A,v,{_previousScrollerPosition:null,defaultOptions:{setRefreshButton:false,setValidButton:true,setCloseButton:true,setEditButton:false,showTopBar:true,editMode:false,showSections:true,sectionAutoexpand:false,readOnly:true,scroller:true,displayType:b.STANDARD},init:function(C){require(["DS/TransientWidget/TransientWidget"]);this._parent.apply(this,arguments);this.handlerTouchEnd=l.bind(this);this.handlerDblClick=null;this.handlerAttributeChanged=q.bind(this);this.handlerLabelChanged=g.bind(this);this._firstModel=null;this._previousScrollerPosition=null;this.lastPointedTableCellObj=null;this._sharedOptions.editMode=C.editMode===true;this.elements.UIController=new y([]);this.isReadOnly=this.isReadOnly();var D=this;this.subscribeEvt("onResizeCells",this._onCellResized.bind(this));this.subscribeEvt("onNotifications",function(E){D.setError(E)});this.initUI()},_onCellResized:function(C){var H=null;var F=false;if(C){var E=C.medium;H=E&&E.current===true?E:C.large;F=H.current!==true}var D=false;if(!F){var G=b.MIN_WIDTH_FOR_TABLE;if(C){G=parseInt(H.width)}D=b.VARIABLES.minWidthForTable!==G;b.VARIABLES.minWidthForTable=G}if(C&&D===true){this.dispatchEvent("refreshActions")}this._updateUI()},setAccordionProperties:function(C){this.elements.formSection.setAccordionProperties(C)},isReadonly:function(){return this.isReadOnly!==false},clear:function(){this._clearAllFields()},_clearAllLine:function(){this.elements.formSection.clear()},_getModel:function(C){return this.elements.UIController.getModel(C)},initData:function(C,D){this.resetUIValues();this.elements.UIController.setModels([]);this._clearAllLine();var E=this._sharedOptions.editMode;if(D){switch(D.edition){case b.FORCE_READWRITE:E=true;break;case b.FORCE_READONLY:E=false;break;case b.FORCE_DEFAULT:E=this.options.editMode===true}}if(this._sharedOptions.editMode!==E){this._switchEditionMode()}this.addData(C)},addData:function(C){this._addData(C)},_getScrollerContent:function(){return this.elements.scroller?this.elements.scroller.elements.content:null},_scrollIsBottom:function(C){var F=false;if(C){var D=C.scrollHeight;var E=C.getDimensions();F=C.scrollTop!==0&&C.scrollTop>D-E.height}return F},_getScrollerPosition:function(){var C=this._getScrollerContent();return C?this._scrollIsBottom(C)?-1:C.scrollTop:null},_setScrollerPosition:function(C){var D=this._getScrollerContent();if(D){D.scrollTop=C===-1?D.scrollHeight:C}},_saveScrollerPosition:function(){this._previousScrollerPosition=this._getScrollerPosition()},_restoreScrollerPosition:function(){if(this._previousScrollerPosition!==null){this._setScrollerPosition(this._previousScrollerPosition)}this._previousScrollerPosition=null},onResize:function(){},_addData:function(F){var E=++window.top.perfoIncrem;window.top.performance.mark("start_LoadUI:"+E);var H=this;var D=this._getScrollerPosition();this._ManageValidButton(false);if(f===true){}else{if(F!=null&&F.length>0){this.elements.UIController.setModels([F[0]])}}var G=this.elements.UIController.getModels();if(G.length<=0){this._clearAllLine()}else{var C=G[0];this._firstModel=C;C.addEvent("onChange:label",this.handlerLabelChanged);C.addEvent("onChange",this.handlerAttributeChanged);this.updateTableManager();this.onResize();this._ManageValidButton();this.endOfLoad()}window.top.performance.mark("end_LoadUI:"+E);this.dispatchEvent("onChangeSize");this.dispatchEvent("onTitleChanged");this.elements.UIController.validateModels(this.elements.UIController.getModels());window.top.readPerfo=function(I,J){console.log("computing...");require(["text!DS/EditPropWidget/assets/noNls/perfos.json"],function(K){var Z=JSON.parse(K);var X=[];var N=window.top.performance.getEntriesByType("mark");var M={};var S="";for(var U=0;U<N.length;U++){var P=N[U].name;var O=N[U].startTime;var L=P.replace("start_","").replace("end_","");var Y=L;var T=null;if(P!==L){X.push(P);var W=L.split(":");Y=W[0];if(W.length>0){T=W[1]}}if(!M[L]){M[L]={startTime:O}}else{var R=O-M[L].startTime;M[L].endTime=O;M[L].duration=R;if(window.console){var Q=Z[Y]?Z[Y]:Y+" [ NO NLS ]";var V=Q.toUpperCase();if(T){V+=" :increm: "+T}if(I===true){V+=" -- specificName: "+L+" -- Entry Type: "+N[U].entryType+" -- Start Time: "+M[L].startTime+" -- End Time: "+O}V+=" -- Duration: "+R+"ms \n";console.log(V);S+=V}}}X.forEach(function(aa){window.top.performance.clearMarks(aa)});if(J!==true){m.download("perfo",S,"text",false)}})};console.log("%creadPerfo() to read Properties the performances","color:blue;font-weight:bold;");if(m.isDebug()){setTimeout(function(){window.top.readPerfo(true,true)},2000)}window.top.performance.mark("end_EP_DataDisplay");setTimeout(function(){H._restoreScrollerPosition();window.top.performance.mark("end_EP_FullTime")});this.elements.formSection._manageAccordionVisibility()},endOfLoad:function(){var C=this;if(!this.dataLoadedOnce){setTimeout(function(){C.dataLoadedOnce=true;C.dispatchEvent("onDataLoaded")},0)}},_isCloseButton:function(){return b.isCloseButton(this.options.displayType)},show:function(){this.getUI().show()},setOption:function(C,D){this._parent.apply(this,arguments);this.elements.formSection.options[C]=D},resetDisplay:function(){this.publishEvt("resetDisplay")},initUI:function(){var I=++window.top.perfoIncrem;window.top.performance.mark("start_EP_InitUI:"+I);var H=this;this.elements.mainDiv=this.elements.container=UWA.createElement("div",{"class":"EditProp_MainContain includeMenuBar"});if(this.isReadOnly===true||this._sharedOptions.editMode!==true){this.elements.container.addClassName("EP_ReadOnly")}this.ManageButtonDiv=UWA.createElement("div",{"class":"EditProp_ManageButtonDiv"});H.ManageButtonTopRight=UWA.createElement("td",{"class":"EditProp_ManageButtonTopRight"});if(!this._isCloseButton()){var D=i.get("EP_Cancel");this.elements.boutonCancel=new k({name:"TopButtonCancel",value:D,className:"default medium EditProp_buttonTop EditProp_Cancel"});this.elements.boutonCancel.addEvents({onClick:function(){H.elements.UIController.resetValueOfModels();H.elements.UIController.validateModels(H.elements.UIController.getModels());setTimeout(function(){H._ManageValidButton()},0)}})}if(this.elements.boutonCancel&&H.options.setCloseButton===true){this.elements.boutonCancel.inject(H.ManageButtonDiv)}H.ManageButtonTopRight.inject(this.elements.container);var E=this.elements.containerProperties=UWA.createElement("div",{"class":"EP_ContainerProperties"});var C=this.elements.containerAccordeon=UWA.createElement("div",{"class":"EP_ScrollerProperties"});w.subscribe("onTableOpened",function(K){H._saveScrollerPosition()});this.elements.formSection=new d({postBuild:false,sectionAutoexpand:this.options.sectionAutoexpand,showSections:this.options.showSections,eventThread:this.options.eventThread},this._sharedOptions);this.elements.formSection.inject(C);if(H.options.scroller===true){this.elements.scroller=new u({element:C}).inject(E);this.elements.scroller.elements.content.addEventListener("scroll",function(){H._actionOnScroll()})}else{if(H.options.scroller===false){C.inject(E)}}var G=this.elements.bottomTable=UWA.createElement("div",{"class":"EditProp_BottomTableContainer"});var F=m.getWidgetValue(b.COLLAPSE_IC_PREFERENCE.name)==="true"&&this.options.typeOfDisplay===b.ALL;if(F===null||F===true){m.setWidgetValue(b.COLLAPSE_IC_PREFERENCE.name,"true")}var J=this.elements.containerMainTable=UWA.createElement("div",{"class":"ICTableContainer "}).inject(G);E.inject(J);G.inject(this.elements.container);if(this.options.showTopBar===true){this.ManageButtonDiv.inject(H.elements.container)}this.elements.formSection._manageAccordionVisibility();window.top.performance.mark("end_EP_InitUI:"+I);this.elements.container.addEvent("resize",this._updateUI.bind(this))},_updateUI:function(){var D=this.elements.container;var C=D.getSize();if(C.width/2<b.VARIABLES.minWidthForTable){this.publishEvt("switchDisplay","s")}else{this.publishEvt("switchDisplay","m")}},getUI:function(){return this.elements.container},resetUIValues:function(){var C=this;if(!!this.elements.formSection){this.elements.formSection.reset()}},getComponentMode:function(){return this.isReadOnly},switchComponentMode:function(C){this.isReadOnly=C;if(this.handlerDblClick){this.elements.container.removeEvent("dblclick",this.handlerDblClick)}this.handlerDblClick=null;if(C!==true){this.handlerDblClick=c.bind(this);this.elements.container.addEvent("dblclick",this.handlerDblClick)}},addSection:function(){this.elements.formSection.addSection.apply(this.elements.formSection,arguments)},_switchEditionMode:function(D){var F=false;if(D!==(this.isReadOnly===false&&this._sharedOptions.editMode===true)){if(this.isReadOnly===false){if(this._sharedOptions.editMode){var E=this.elements.UIController.getModifiedModels();if(E.length>0){var C=i.get("Some attributes are in edition. Please valid or cancel the modifications to switch");if(this._isCloseButton()){C=i.get("Some attributes are in edition. Please valid or refresh to switch")}this.addWarning(C);return}this._sharedOptions.editMode=false;this._activateAddingButton(false)}else{this._sharedOptions.editMode=true;this._activateAddingButton(true)}}else{this._sharedOptions.editMode=false}F=true}if(F){this.publishEvt("editionSwitched",this._sharedOptions.editMode)}if(this._sharedOptions.editMode!==true){this.elements.container.addClassName("EP_ReadOnly")}else{this.elements.container.removeClassName("EP_ReadOnly")}m.setWidgetValue("editProperties_editMode",this._sharedOptions.editMode);return F},_switchEdition:function(C){if(this._switchEditionMode(C)){this.onResize()}this.lastPointedTableCellObj=null},resizeActionActive:function(){return b.VARIABLES.minWidthForTable!==b.MIN_WIDTH_FOR_TABLE},getOptimalSize:function(){var E={height:0,width:0};var D=this.elements.masterTable.getSize();var C=this.elements.containerProperties.getSize();var G=D.height-C.height;var F=this.elements.formSection.getContent().getSize();F.height+=G+60;F.width+=30;return F},updateTableManager:function(){var C=this;this._saveScrollerPosition();this._clearAllLine();this.updateTable()},updateTable:function(){var G=this;this._clearAllFields();this._clearAllLine();if(G.modelIdentityCard){G.modelIdentityCard.set("title","");G.modelIdentityCard.set("ownerName","");G.modelIdentityCard.set("date","");G.modelIdentityCard.set("description","")}var D=this.elements.UIController.getModels();var H=D.length;var C=++window.top.perfoIncrem;window.top.performance.mark("start_addInForm:"+C);for(var F=0;F<H;F++){var E=D[F];this.elements.formSection.setModel(E)}window.top.performance.mark("end_addInForm:"+C);this._restoreScrollerPosition();setTimeout(function(){G.publishEvt("triggerPostBuild")})},saveIsNeeded:function(){var C=true;var D=this.elements.UIController.getModifiedModels();D.every(function(E){var H=E.previousAttributes();if(typeof E.getChangedValues==="function"){H=E.getChangedValues()}for(var F in H){var G=H[F];if(G instanceof x&&G.isTransient===false){C=false;break}}if(C===false){return false}return true});return !C},validateModel:function(){var D=false;var E=this.elements.UIController.getModifiedModels();if(E.length>0){var C=this.elements.UIController.validateModels(E);if(C){C.message=i.get("Modification failed")+":"+C.message;this.setError(C)}else{D=true}}this._ManageValidButton();return D},_valueIsChanging:function(D,C){this._ManageValidButton();var E={value:C,valueDB:D.get("valueDB")};if(D.isSameValueSet(E)){this._activateValidButton()}},_activateAddingButton:function(C){this.dispatchEvent("onAddActivation",C)},_activateValidButton:function(D){var C=D?false:true;if(this.elements.boutonCancel){if(C){this.elements.boutonCancel.show()}else{this.elements.boutonCancel.hide()}}this.dispatchEvent("onValidActivation",C)},_ManageValidButton:function(){this._activateValidButton(!this.saveIsNeeded())},getButtons:function(){return this.ManageButtonDiv},getTitle:function(){var C="";if(this.elements.UIController){C=this.elements.UIController.getLabel()}return C},showNotification:function(C){this.addSuccess(C)},setError:function(E){var D=this;if(p.isArray(E)){E.forEach(function(F){var G=F&&F.customClass?F.customClass:null;D._manageError(F,G)})}else{var C=E&&E.customClass?E.customClass:null;D._manageError(E,C)}},_manageError:function(E,D){if(E){var C=E.eventID?E.eventID:"error";switch(C){case"warning":this.addWarning(E.message?E.message:E,D);break;case"success":this.addSuccess(E.message?E.message:E,D);break;default:this.addError(E,D)}}},addWarning:function(C,D){this.dispatchEvent("onNotification",{msg:C,eventID:"warning",customClass:D})},addSuccess:function(D,C){this.dispatchEvent("onNotification",{msg:D,eventID:"success",customClass:C})},addError:function(D,C){this.dispatchEvent("onNotification",{msg:D.message?D.message:n.encode(D),eventID:"error",customClass:C})},});return e});define("DS/EditPropWidget/facets/Properties/EditPropController",["UWA/Class/Model","UWA/Core","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/WidgetServices","DS/EditPropWidget/comm/EventManager","DS/EditPropWidget/facets/Common/FacetsBase","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/facets/Properties/Properties","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/comm/DistantAjax","DS/EditPropWidget/utils/EditPropUtils","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(o,a,g,j,p,q,b,c,r,d,m,k,f,e,n,h){var i=h.get("accordion_parameters");var l=q.extend({defaultOptions:{serverName:"",serverUri:"",displayType:k.STANDARD,extraNotif:false,context:null},getListHandle:null,commitHandle:null,previewUrlHandle:null,init:function(t){var v=this;this._parent.apply(this,arguments);this.getListHandle={handle:null};this.commitHandle={handle:null};this.previewUrlHandle={handle:null};var s={};for(var u in t){s[u]=t[u]}s.events=s.events?s.events:{};s.events["onNotification"]=function(w){v._setError(w.msg?w.msg:w.json,w.eventID,w.customClass)};s.events["onValidActivation"]=function(w){v.switchSaveButton(w)};s.events["onAddActivation"]=function(w){v.switchAddButton(w)};v.parametersLoaded=false;p.subscribe("onTableOpened",function(w){if(w==i&&v.parametersLoaded===false){v.parametersLoaded=true;v._loadPLMParameters()}});s.events["refreshActions"]=function(w){v.refreshActions()};this._createUI(s)},isUIReadonly:function(){return this.editPropertiesUI.isReadonly()},_createUI:function(s){s.className=this.getTabId();s.eventThread=this.options.eventThread;this.editPropertiesUI=new m(s,this.getSharedOptions())},nothingToSave:function(){return !this.editPropertiesUI.saveIsNeeded()},onSave:function(){var t=this.editPropertiesUI.validateModel();if(t){var s=this.getModel();this._commitModels([s])}},getExtensions:function(){var t=this;var s="DS/EditPropExtensions/UI/AddExtensionsWidget";require([s],function(w){var v=t.getModel();var u=v.getTenant();g.getInstance({tenant:u}).getSecurityContext({context:t.options.context,onSuccess:function(A){t.showLoader();var x=new w(widget,t._parent,t.options,A,v,function z(){t.hideLoader();t.onRefresh()},function y(B){t.hideLoader();require(["DS/PADUtils/views/PADAlert"],function(C){C.displayNotification({eventID:((typeof type==="string")?type:"info"),msg:B})})})},onFailure:function(x){t._setError(x)}})},function(){t._setError("AddExtensionWidget do not exist")})},onAction:function(s){if(s===k.ACTION_SWITCH){this.switchEdition()}else{if(s===k.ACTION_RESET){this.editPropertiesUI.resetDisplay();this.refreshActions()}}},isActionAvailable:function(s){if(s===k.ACTION_SWITCH){return !this.editPropertiesUI.getComponentMode()}if(s===k.ACTION_RESET){return this.editPropertiesUI.resizeActionActive()}return true},switchEdition:function(){this.editPropertiesUI._switchEdition()},getButtons:function(){return this.editPropertiesUI.getButtons()},_getUI:function(){return this.editPropertiesUI},onLoad:function(){this.clearAllDatas()},updateFacet:function(){this.onRefresh()},onRefresh:function(){this.loadModels(this.getModel(),{parameters:this.parametersLoaded===true})},_cancelListRequest:function(){if(this.getListHandle&&this.getListHandle.handle){this.getListHandle.handle.cancel();this.getListHandle.handle=null}},_cancelCommitHandle:function(){if(this.commitHandle&&this.commitHandle.handle){this.commitHandle.handle.cancel();this.commitHandle=null}},_cancelPreviewUrlHandle:function(){if(this.previewUrlHandle&&this.previewUrlHandle.handle){this.previewUrlHandle.handle.cancel();this.previewUrlHandle=null}},destroyComponent:function(){this._cancelCommitHandle();this._cancelListRequest();this._cancelPreviewUrlHandle();this.clearAllDatas();if(this._commandProxy){this._commandProxy.destroy()}},clearAllDatas:function(){var s=this.getModel();if(s){s.destroy()}this.setModel(null)},_loadPLMParameters:function(){this.loadModels(this.getModel(),{parameters:true,attributes:false})},loadModels:function(v,C){window.top.performance.mark("start_PrepareAjax");var y=this;this.showLoader();var x=v;if(v){var z=f.getServiceForModel(v);if(v.isTransientModel()===true||(z&&z.modelNeeded===true)){this.setModel(x);this.editPropertiesUI.switchComponentMode(true);this.editPropertiesUI.initData([this.getModel()]);this.hideLoader()}else{var B=null;var t=v instanceof o;if(!t){x=new b(v)}else{if(!y.getModel(x.get("objectId"))){x.clearChangedValue()}B=x.getChangedValues()}if(!y.getModel(x.get("objectId"))){y.setModel(x);x.clearChangedValue()}var A=x.keys();A.forEach(function(E){var D=x.get(E);var F=D instanceof r;if(!F&&typeof D==="object"&&E!=="EditProp_listOfChange"&&E!=="label"&&!E.startsWith(k.MODEL_FACET_INFO_PREFIX)&&!E.startsWith(k.MODEL_DS_ATTR)){x.set(E,new r(D))}});y._resetModifFlag(x);var w=x.get("EditProp_listOfChange");if(w){x.setChangedValues(w);x.unset("EditProp_listOfChange")}if(B){x.setChangedValues(B)}window.top.performance.mark("end_PrepareAjax");if(!C||C.loadModel!==false){window.top.performance.mark("start_EP_AJAXRequest");var s=false;var u=function(){y._cancelListRequest();var E=j.getCancelObject();y.getListHandle.handle=E;var G=C&&C.parameters===true;var F=C&&C.attributes!==false;var D={handleRequest:{handle:E},modelList:[x],tenant:x.getTenant(),onComplete:function(H){y.hideLoader();if(s===false&&!E.isCancelled()){s=true;console.log("Ajax 2");if(window.top.isDebug===true){console.log("Ajax 2 answered "+window.top.performance.now())}y.getListHandle.handle=null;y._onCompleteLoadModel(H,{initTable:!G,buildBehavior:F?k.FORCE_DEFAULT:k.NO_CHANGES})}}};D.plmParams=G;D.attributes=F;D.readonly=y.isUIReadonly();D.navigateToMain=y.getTabId()===k.FACET_PROPERTIES;d.getListOfAttributes(D)};window.top.performance.mark("start_EP_GetFromDistant");e.getAsyncRead(function(D){if(s===false){if(D){window.top.performance.mark("end_EP_GetFromDistant");s=true;y._cancelListRequest();y._onCompleteLoadModel(D)}else{u()}}})}else{this.setModel(x);this.editPropertiesUI.initData([this.getModel()])}}}else{this.editPropertiesUI.clear();this._onCompleteLoadModel({results:[]})}},hide:function(){this._parent();this.editPropertiesUI.clear()},_commitModels:function(s){var t=this;t.commitHandle.handle=null;g.getInstance({tenant:s[0].getTenant()}).getSecurityContext({context:this.options.context,onSuccess:function(u){t.showLoader();d.commitModels({handleRequest:t.commitHandle,serverName:t.options.serverName,serverUri:t.options.serverUri,modelList:s,tenant:s[0].getTenant(),securityContext:u.SecurityContext,onComplete:function(v){t.hideLoader();t.commitHandle.handle=null;t._onCompleteCommit(v)}})},onFailure:function(u){t._setError(u,"error")}})},_manageNotificationFromAnswer:function(s,w){var u=w;var v="error";if(s){if(s.hasOwnProperty("error")){u=s.error}else{if(s.hasOwnProperty("notification")){var t=s.notification;u=t.message;v=t.type?t.type:v}else{if(s.hasOwnProperty("errors")&&s.errors.length>0){var t=s.errors[s.errors.length-1];u=t.message;v=t.type?t.type:v}else{if(s.success===false){u={message:h.get("Server error"),code:"ERROR"}}}}}}if(u){this._setError(u,v.toLowerCase(),u.customClass)}return{message:u,type:v.toLowerCase()}},_setError:function(u,s,t){s=s?s:"error";this._raiseNotification(u,s,t)},_onCompleteCommit:function(w){var A=this;var x=[];var D="";var v=true;var y=false;var z=null;var s=null;var B=w.transactionid;if(B){z=A.getModel(B);if(z===null||!z.isMergedModel()){console.log(" --- >> The model retrieved from the update is not the same than the one which has been sent")}else{z.resetAllErrors();z.lockModel(true);s=z.getMergingModels()}}var u=w.results;var t=false;var C={created:[],deleted:[],modified:[],ownerChanged:[]};if(w.success===false){A.editPropertiesUI.setError(w.error)}else{u.forEach(function(R,N){var aa=true;var W=R.status;var ab=null;if(W<200||W>=300){var ab={message:h.get("Error during update"),code:"ERROR",customClass:"errorUpdate"}}else{t=true;var J=null;var E=null;var G=null;if(R.body.physicalid){E=typeof R.body.physicalid==="object"?R.body.physicalid.value:R.body.physicalid;J=A.getModel(E);if(s!==null&&J===null){J=s[E]}}var Y=null;if(R.hasOwnProperty("RefreshUI")){Y=R.RefreshUI.results.attributes}if((Y==null)||(Y!=null&&Y.length==0)){G={physicalid:E,operation:"update"}}else{G={physicalid:E,operation:"update",attributes:R.RefreshUI.results.attributes}}if(null==J){if(R.body.attrID!=null&&R.body.name!=null&&R.body.value!=null){aa=false;var V=A.getModel();if(V){var T=V.getAttributeFromField("attributeID",R.body.attrID.value,1);if(T){var H=new r(a.clone(T));H.set("value",R.body.value.value);V.set(T.getIdentifier(),H);A._resetModifFlag(V,[T.getIdentifier()]);if(R.body.physicalid&&R.body.physicalid.value){C.modified.push({physicalid:R.body.physicalid.value,operation:"update"})}}}}}else{J.resetAllErrors();D=h.get("Modification successful");v=A.options.extraNotif;var ac=R.body;var F=J.values();var P=[];var Z=[];var af=false;for(var ah in R.body){var ag=R.body[ah];var X=A._manageNotificationFromAnswer(ag);var U=ag?typeof ag==="object"?ag.value:ag:null;var S=ag?typeof ag==="object"?ag.valueDB:U:null;var I=J.get(ah);if(null==I&&null!=F){F=J.values();F.every(function(ai){var aj=true;if(ai instanceof r&&null!=ai.get("select")&&ai.get("select")===ah){I=ai;ah=ai.getIdentifier();aj=false}return aj})}if(I){var ad=I?I.get("multivalue")===true:false;var T=a.clone(I);T.setError(X.message,X.type,true);var M=ah!="current"&&ah!="owner";var ae=null!==U&&(X.type!=="error"||!X.message);if(ae){if(M){var Q=U;if(Array.isArray(U)){Q=U.length>0?U[0]:""}if(Q==="#DENIED!"){y=true;af=true;break}if(ah=="description"){U=Q}if(S==null){S=U}var L=U;var K=S;if(ad){var O=U!==undefined&&U!==null;L=Array.isArray(U)?U:O?[U]:[];K=Array.isArray(S)?S:O?[S]:[]}else{var O=U!==undefined&&U!==null;L=Array.isArray(U)?U.length>0?U[0]:"":U?U:"";K=Array.isArray(S)?S.length>0?S[0]:"":S?S:""}T.set("value",L);T.set("valueDB",K)}Z.push(ah)}if(!J.attributeHasChanged(ah)||ae){P.push(ah)}if(!(T instanceof r)){T=new r(T)}J.set(ah,T)}}A._resetModifFlag(J,P);J.saveInitialValues(Z)}if(!af&&R.body&&R.body.errors){R.body.errors.forEach(function(ai){af=af||ai.code==="unaccessible"})}if(aa&&G){if(af){C.deleted.push(G)}else{if(R.body&&R.body.owner){C.ownerChanged.push(G)}else{C.modified.push(G)}}}}A._manageNotificationFromAnswer(R.body,ab)});if(t===true){require(["DS/PADUtils/PADCommandProxy"],function(H){var F={authored:true};var I=[];var G=[];C.modified.forEach(function(L){I.push(L.physicalid)});C.ownerChanged.forEach(function(L){I.push({physicalid:L.physicalid,key:"ownerChanged"})});C.deleted.forEach(function(L){G.push(L.physicalid)});var K={modified:I};if(G.length>0){K.deleted=G}var E={authored:K};var J=H.create();J.authored(F);J.refresh(E);J.destroy()})}}if(z){setTimeout(function(){z.lockModel(false)})}if(v&&D!=""){A.editPropertiesUI.showNotification(D)}if(y===true){this.onRefresh()}},_buildFromResponse:function(s,v,x){var y=this;var F={modifyAccess:true,oneSuccess:false,allAttributeAreRO:true,plmparams:null};if(s.success!==false){var H=s.transactionid;var D=s.results;var C=D.length;for(var I=0;I<C;I++){var N=D[I];y._manageNotificationFromAnswer(N);var G=null;if(H!=null){G=H}else{G=y._getID(N)}var w=y.getModel(G);var M=y._getMetaType(N);var z=null;var K=false;if(w&&w.isMergedModel()){z={};var t=N.ids;var J=w.getMergingModels();t.forEach(function(R){var Q=J[R];if(Q==null){K=true;var P=UWA.clone(w.getOptions());P.objectId=R;P.metatype=M;Q=new b(P)}z[R]=Q})}if(K||w==null){if(!K){var u=y.getOccurrence();if(u===null){console.log(" --- >> No current occurence");return{}}var L=u.getModel(this.getTabId());if(L!==null){console.log(" --- >> A model already exist for properties tab");return{}}else{if(!w&&!!H){console.log(" --- >> A merged model is returned for a single model");return{}}}}var E=y.getOccurrence().getAllModels(true,true);var v={metatype:M,objectId:G};if(E&&E.length>0){v=UWA.clone(E[0].getOptions());v.objectId=G;v.metatype=M}if(z!=null){w=new c(v);w.setMergingModels(z)}else{w=new b(v)}w.clearChangedValue()}if(M){w.set("metatype",M)}y.setModel(w);if(N.extensions){for(var O in N.extensions){x[O]=N.extensions[O]}}var A=n.getPreviewUrl(N);y._cancelPreviewUrlHandle();if(!A){d.getPreviewUrl({handleRequest:y.commitHandle,modelList:[w],tenant:w.getTenant(),onComplete:function(P){y.previewUrlHandle.handle=null;P.forEach(function(R){var Q=y.getModel(R.id);if(Q!=null){if(R.preview&&(R.preview.indexOf("icons")<0||!Q.get("type_icon_url"))){Q.set("previewUrl",R.preview)}}})}})}var B=n.fillFromServer(N,w,v);F.modifyAccess=B.modifyAccess!==false&&F.modifyAccess;F.oneSuccess=F.oneSuccess||B.success;F.allAttributeAreRO=F.allAttributeAreRO&&B.allAttributeAreRO;F.plmparams=F.plmparams!==false&&B.plmparams}y.editPropertiesUI._ManageValidButton()}return F},_onCompleteLoadModel:function(u,A){this.hideLoader();window.top.performance.mark("end_EP_AJAXRequest");window.top.performance.mark("start_EP_DataTreatement");if(!A){A={initTable:true,buildBehavior:k.FORCE_DEFAULT}}var z=u.options;if(z){if(z.showSections!==undefined){this.editPropertiesUI.setOption("showSections",z.showSections===true)}if(z.autoExpand!==undefined){this.editPropertiesUI.setOption("sectionAutoexpand",z.autoExpand===true)}}var x=this;var v=[];var t={};this._manageNotificationFromAnswer(u);var B=this._buildFromResponse(u,A,t);var y=B.modifyAccess&&!B.allAttributeAreRO&&(!this.isReadOnly()||this.isReadOnly()==="false");if(A.initTable===true||y===true){this.editPropertiesUI.switchComponentMode(!y);this._raiseEvent("switchMode",y)}window.top.performance.mark("end_EP_DataTreatement");window.top.performance.mark("start_EP_DataDisplay");var w=x.getModel();var s=B.oneSuccess&&w?[w]:[];this.editPropertiesUI.setAccordionProperties(t);this.editPropertiesUI.initData(s,{edition:A.buildBehavior});if(B.plmparams){x.editPropertiesUI.addSection({section:i},true)}},_getID:function(t){var s=t.physicalID;return s},_getMetaType:function(s){var t=s.metatype;return t},_resetModifFlag:function(t,s){t.clearChangedValue(s);this.editPropertiesUI._ManageValidButton()}});return l});define("DS/EditPropWidget/facets/Common/PropertiesDerived",["DS/EditPropWidget/facets/Properties/EditPropController","UWA/Controls/Abstract","UWA/Class","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/constants/EditPropConstants","DS/WidgetServices/WidgetServices"],function(d,h,a,e,f,c,g){var b=d.extend({metatype:c.METATYPE_UNKNOWN,setOccurrence:function(m){var o=this;var q=m?m.getOptions(this.getTabId()):null;var n=m?m.getModel(this.getTabId()):null;if(q&&!n){var k=q;if(typeof k==="object"){var p=k.targets;if(p!=null){var i=[];var l={};p.forEach(function(s){var r=new e({objectId:s.id,metatype:o.metatype});i.push(r);l[s.id]=r});if(m.isMergedOccurrence()){var j=m.getMergePrefixe();n=new f({objectId:j,metatype:o.metatype});n.setMergingModels(l)}else{if(i.length>0){var j=i[0].get("objectId");n=new e({objectId:j,metatype:o.metatype})}}m.setModel(this.getTabId(),n)}}}if(m==null||m.getModel(this.getTabId())){this._parent(m)}}});return b});define("DS/EditPropWidget/facets/EBOMPart/EBOMPart",["DS/EditPropWidget/facets/Common/PropertiesDerived","DS/EditPropWidget/constants/EditPropConstants"],function(b,a){var c=b.extend({metatype:a.BUS,init:function(d){var f={};for(var e in d){f[e]=d[e]}f.readOnly=true;this._parent(f)}});return c});define("DS/EditPropWidget/facets/Instance/InstanceFacet",["DS/EditPropWidget/facets/Common/PropertiesDerived","DS/EditPropWidget/constants/EditPropConstants"],function(c,b){var a=c.extend({metatype:b.REL});return a});define("DS/EditPropWidget/ICard/IdCard",["UWA/Controls/Abstract","DS/Controls/Button","DS/Controls/TooltipModel","DS/UIKIT/Mask","DS/WidgetServicesUI/helpers/Helpers","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServices/WidgetServices","DS/EditPropWidget/facets/Properties/TweakerManager","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/buttonsBar/ButtonsBar","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(h,m,k,d,n,b,p,e,j,i,a,f){var l=function(){this.dispatchEvent("thumbnailClick")};var c=350;var o=4;var g=h.extend({init:function(s){this._parent.apply(this,arguments);this._showThumbnailsCondition={};this._currentModel=null;this._titleAttr=null;this.elements.container=UWA.createElement("div",{"class":"idCardContainer"});this.elements.thumbnail=UWA.createElement("div",{"class":"thumbnail"});this.elements.attrContainer=UWA.createElement("div",{"class":"attributes"});this.elements.thumbnail.inject(this.elements.container);this.elements.attrContainer.inject(this.elements.container);this.elements.headerContainer=UWA.createElement("div",{"class":"header-section"});this.elements.titleContainer=UWA.createElement("div",{"class":"title-section"});this.elements.title=UWA.createElement("div",{"class":"title"});this.elements.revision=UWA.createElement("div",{"class":"revision"});this.elements.multititles=UWA.createElement("div",{"class":"multititles"});this.elements.title.inject(this.elements.titleContainer);this.elements.revision.inject(this.elements.titleContainer);this.elements.multititles.inject(this.elements.titleContainer);this.elements.actions=new a({classname:"actions-section",minimumSize:200},this.elements.titleContainer);this.elements.actions.inject(this.elements.headerContainer);this.elements.titleContainer.inject(this.elements.headerContainer);this.elements.detailsContainer=UWA.createElement("div",{"class":"details-section"});this.elements.headerContainer.inject(this.elements.attrContainer);this.elements.detailsContainer.inject(this.elements.attrContainer);this.elements.owner=UWA.createElement("span",{"class":"owner"});this.elements.date=UWA.createElement("span",{"class":"lastModified text-muted"});this.elements.owner.inject(this.elements.detailsContainer);this.elements.date.inject(this.elements.detailsContainer);this.tweakerManager=new e({},{readOnly:false});this._handlerThumbnailClick=l.bind(this);var u=this;var t=[{icon:"expand-up",text:f.get("hideIDCard"),method:"show"},{icon:"expand-down",text:f.get("showIDCard"),method:"hide"}];var r=p.getWidgetValue(j.COLLAPSE_IC_PREFERENCE.name);var q=r===0||r===1?r:0;this.defaultAction={name:"actionHide",text:t[q].text,icon:t[q].icon,handler:function(){q=q?0:1;var v=t[q];u.defaultAction.text=t[q].text;u.defaultAction.icon=t[q].icon;p.setWidgetValue(j.COLLAPSE_IC_PREFERENCE.name,q);u._updateFromExpandButton(v)}};this.setActions(s.actions);var s=t[q];this._updateFromExpandButton(s)},_updateFromExpandButton:function(q){this.showThumbnail("collapse",q.method==="show");this.elements.detailsContainer[q.method]();this.elements.multititles[q.method]();this.elements.actions.updateButton("actionHide",q)},setActions:function(q){this.elements.actions.setButtons(q);this.elements.actions.addButton(this.defaultAction)},fillFromModel:function(s){this.clearValues();var v=this;var r=s.getAllAttributes();if(r){for(var t in r){var u=r[t];if(u instanceof i){v.setValueForSection(s,u)}}}if(!s.get("labelAttribute")){var q=s.get(j.MODEL_DS_ATTR+"label");if(q){this.setValueForSection(s,q)}}},clearValues:function(){if(!!this.elements.container){this.elements.owner.empty();this.elements.date.empty();this.elements.title.empty();this.elements.multititles.empty();this.elements.revision.empty()}},onResize:function(){this._manageThumbnailDisplay();this.elements.actions.onResize();this._computeTitle()},maskThumbnail:function(){var q=this.getThumbnailElement();if(q){d.mask(q)}},unmaskThumbnail:function(){var q=this.getThumbnailElement();if(q){d.unmask(q)}},changeThumbnail:function(s,q){var t=this;this.elements.thumbnail.setStyle("background-image","url("+s+")");var r=this.getThumbnailElement();if(r){this.showThumbnail("url",!!s);if(q===true){r.addClassName("clickable")}r.removeEvent("click",this._handlerThumbnailClick);r.addEvent("click",this._handlerThumbnailClick)}},showThumbnail:function(r,q){var s=this._showThumbnailsCondition[r];if(s!==q){this._showThumbnailsCondition[r]=q;this.__manageThumbnailDisplay()}},_manageThumbnailDisplay:function(){var q=this.elements.container.getSize();showThumbnails=q.width>=c;this.showThumbnail("width",showThumbnails)},__manageThumbnailDisplay:function(){var r=true;for(var q in this._showThumbnailsCondition){r=this._showThumbnailsCondition[q];if(!r){break}}if(!r){this.elements.container.addClassName("noThumbnail")}else{this.elements.container.removeClassName("noThumbnail")}},getThumbnailElement:function(){return this.elements.thumbnail},injectValue:function(s,q,t,r){if(this.elements[t]){this._injectValue(s,q,this.elements[t],r)}},_injectValue:function(v,t,s,u){var q={readOnly:true,value:v,postBuild:false};if(u){for(var r in u){q[r]=u[r]}}s.empty();n.getTweaker(t,q,function(w){s.empty();w.inject(s);if(u&&u.callback){u.callback()}})},addRevision:function(){if(this.elements.title){var q=this.elements.title.getElementsByClassName("tw_ROValue_content");if(q&&q.length>0){this.elements.revision.inject(q[0])}}},_computeTitle:function(s){if(this._currentModel){var w=this;var r=this._currentModel.getComputedTitle();var x=s;if(!s){x=this._currentModel.get(this._titleAttr)}if(x){this._titleAttr=x.getIdentifier();if(!r){r=x.get("value")}}var y=this.elements.container.getSize();var t=380;var A=!!(y.width>t);if(!A){this.elements.container.addClassName("smallSize")}else{this.elements.container.removeClassName("smallSize")}var z=this.elements.attrContainer.getSize();var q=z.width/o;var v=r.length>q;var B=A;var u=A;this.injectValue(r,b.TYPES.STRING,"title",{postBuild:v,maxCharacters:q,multiline:B,forHTML:u,callback:function(){w.addRevision()}})}},setValueForSection:function(r,t){var v=this;var u=t.get("sectionIdentityCard");var w=!!u;if(w){this._currentModel=r;var q=u==="title";if(q){this._computeTitle(t);if(r.isMergedModel()===true){this.elements.title.addClassName("EP_MergedTitle")}else{this.elements.title.removeClassName("EP_MergedTitle")}}if(r.isMergedModel()!==true){if(q){var s=r.get("revision");if(!!s){this.injectValue(" "+s.get("value"),b.TYPES.STRING,"revision")}}else{if(u==="ownerName"){this.injectValue(t.get("value")+" ",b.TYPES.STRING,"owner")}else{if(u==="date"){var x=t.get("value");x=x?x:t.get("valueDB");computedDate=p.formatDateObj(x);this._injectValue(computedDate,b.TYPES.DATETIME,this.elements.date)}}}}else{this.injectValue(t.get("value"),b.TYPES.STRING,"multititles",{multisel:true})}}return w}});return g});define("DS/EditPropWidget/UI/IDCardSkeleton",["UWA/Class/Model","DS/EditPropWidget/models/CommonAbstract","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/ICard/IdCard","DS/EditPropWidget/facets/Properties/EditPropController","DS/WidgetServices/MultipleAsynchronousRequests","DS/WidgetServices/WidgetServices","DS/EditPropWidget/comm/DistantAjax","DS/EditPropWidget/buttonsBar/ButtonsBar","DS/UIKIT/Tooltip","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/Spinner","DS/Controls/TabBar","DS/Controls/TooltipModel","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(k,z,c,v,l,r,o,f,w,u,m,s,j,h,i,p,g){var a={"DS/EditPropWidget/facets/Properties/EditPropController":l};var d=function(C,E){var B=[];var D=[];C.forEach(function(F){var G=a[F];if(G){D.push(G)}else{B.push(F)}});if(B.length>0){require(B,function(){for(var F=0;F<arguments.length;F++){C[B[F]]=arguments[F];D.push(arguments[F])}E.apply(null,D)})}else{E.apply(null,D)}};var y=400;var n=300;var b=400;var q="EditProp_MasterContain";var x="withMenuBar";window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0;var t={};t[c.ACTION_SWITCH]={name:c.ACTION_SWITCH,text:g.get("EditProp_boutonSwitchtoEdit"),icon:c.ACTION_SWITCH};t[c.ACTION_RESET]={name:c.ACTION_RESET,text:g.get("Reset display"),icon:c.ACTION_RESET};t[c.ACTION_SWYM_VIEW_CONTENT_IN_3DSWYM]={name:c.ACTION_SWYM_VIEW_CONTENT_IN_3DSWYM,text:g.get("ViewIn3DSwym"),icon:"level-down"};t[c.ACTION_SWYM_VIEW_COMMUNITY_IN_3DSWYM]={name:c.ACTION_SWYM_VIEW_COMMUNITY_IN_3DSWYM,text:g.get("ViewIn3DSwym"),icon:"level-down"};t[c.ACTION_SWYM_VIEW_USER_PROFILE]={name:c.ACTION_SWYM_VIEW_USER_PROFILE,text:g.get("ViewUserProfile"),icon:"level-down"};t[c.ACTION_SWYM_VIEW_SURVEY_IN_3DSWYM]={name:c.ACTION_SWYM_VIEW_SURVEY_IN_3DSWYM,text:g.get("ViewIn3DSwym"),icon:"level-down"};var A={name:c.FACET_NONE,text:"None",handler:function(){}};var e=z.extend({_lFacets:[],_sharedContext:null,_sharedOptions:{},defaultOptions:{name:"",className:"",showIdCard:true,showTopBar:true,showFacets:true,warningOnUnsaved:true,closeButton:true,noThumbnail:false,facetLabel:true,displayType:c.STANDARD},init:function(C,B){this._sharedOptions={};this._parent(B);if(this.options.actions){this.options.actions.forEach(function(D){if(D.after===undefined&&D.name==="action_close_panel"){D.after=true}})}this._sharedContext=B.sharedContext?B.sharedContext:null;this._lFacets=C;if(!this.elements){this.elements={}}this.loaderFacetList=[];this.idcardInit()},getTopBar:function(){return this.elements.manageButtonDiv},idcardInit:function(L){var J=this;var H=this.elements.container=UWA.createElement("div",{name:this.options.name,"class":this.options.className});var K="";if(this.options.showTopBar===true){K=x}var C=this.elements.globalDiv=UWA.createElement("div",{"class":"IDCardGlobalContain "+K}).inject(H);var G=J.elements.mainInterface=UWA.createElement("div",{"class":"IDCardMainInterface"}).inject(this.elements.globalDiv);var E=this.elements.masterTable=UWA.createElement("div",{"class":"IDCardMasterTable "}).inject(G);var I=this.elements.topTable=UWA.createElement("div",{"class":"IDCardTopTableContainer"});this.elements.bottomMainArea=UWA.createElement("div",{"class":"IDCardBottomArea"});this.elements.bottomInnerArea=UWA.createElement("div",{"class":"IDCardInnerBottomArea"});this.elements.bottomInnerArea.inject(this.elements.bottomMainArea);this.elements.actionArea=UWA.createElement("div",{"class":"actionArea"});this.elements.bottomArea=UWA.createElement("div",{"class":"facetContainer"});this.elements.actionArea.inject(this.elements.bottomInnerArea);this.elements.bottomArea.inject(this.elements.bottomInnerArea);this.elements.tabContainer=UWA.createElement("div",{"class":"tabMainContainer"});I.inject(E);this.elements.tabContainer.inject(E);this.elements.bottomMainArea.inject(E);this.elements.buttonsBar=new w({vertical:false,minimumSize:-1});this.elements.buttonsBar.inject(this.elements.actionArea);delete this.elements.postIdCard;if(this.options.showIdCard===true){var F=[];var B={};if(this.options.idCardOptions){B=this.options.idCardOptions}B.actions=F;this.elements.postIdCard=new v(B);J.identityCardContainer=UWA.createElement("div",{"class":"topTableElement identityCardCell infra"}).inject(I);var N=UWA.createElement("div",{"class":"ICTableContainer "}).inject(this.identityCardContainer);this.elements.postIdCard.inject(N);this.currentFacetName=null;this._createTabs([]);this.elements.superModal=new s({renderTo:this.container})}this.elements.manageButtonDiv=UWA.createElement("div",{"class":"skeleton_ManageButtonDiv"}).inject(E);this.elements.loadingArea=new j({visible:false});this.elements.loadingArea.inject(this.elements.manageButtonDiv);this.elements.boutonValid=new m({name:"TopButtonValid",value:g.get("EP_Ok"),className:"primary default medium"});this.elements.boutonValid.addEvents({onClick:function(){J._saveAllFacets()}});this.elements.boutonValid.hide();this.elements.boutonValid.inject(this.elements.manageButtonDiv);this.elements.facetButtonDiv=UWA.createElement("div",{"class":"skeleton_FacetButtonDiv",html:{}}).inject(this.elements.manageButtonDiv);var D="DS/EditPropExtensions/UI/AddExtensionsWidget";require([D],function(O){J.elements.boutonAdd=new m({name:"TopButtonAdd",value:g.get("EP_Add"),className:"default medium"});J.elements.boutonAdd.addEvents({onClick:function(){J._loadExtensions()}});J.elements.boutonAdd.hide();J.elements.boutonAdd.inject(J.elements.manageButtonDiv)});this.elements.facetButtonDiv=UWA.createElement("div",{"class":"skeleton_FacetButtonDiv",html:{}}).inject(this.elements.manageButtonDiv);if(this.options.closeButton){var M=g.get("EP_Close");this.elements.boutonCancel=new m({name:"TopButtonClose",value:M,className:"default medium"});this.elements.boutonCancel.addEvents({onClick:function(){J.checkChangeAuthorized(function(){J.dispatchEvent("onCancel");if(J.options.displayType===c.TRANSIENT){require(["DS/TransientWidget/TransientWidget"],function(O){O.hide()})}else{J.dispatchEvent("onInnerCancel")}})}});this.elements.boutonCancel.inject(this.elements.manageButtonDiv)}},_switchFacet:function(C){var B=C!==this.currentFacetName;this.currentFacetName=C;if(B){this._manageFacetLaunching()}},_createTabs:function(B){var C=this;if(this.options.showFacets===true){if(this.elements.tabs&&this.elements.tabs.getTabCount()>0){this.elements.tabs.destroy();this.elements.tabs=null}if(!this.elements.tabs){this.elements.tabs=new h({displayStyle:"strip",centeredFlag:true,showComboBoxFlag:true,editableFlag:false,multiSelFlag:false,reorderFlag:false});this.elements.tabs.touchMode=o.isTouchDevice();this.elements.tabs.onSelectTab(function(E){if(E!==undefined&&E.index!==undefined&&E.index>=0){var D=C.elements.tabs.getValueByIndex(E.index);C._switchFacet(D)}});this.elements.tabs.inject(this.elements.tabContainer)}B=!!B?B:this._lFacets;B.forEach(function(E){var D=C.elements.tabs.add({label:C.options.facetLabel===true?E.facet.text:undefined,value:E.facet.name,allowClosableFlag:false,icon:{iconName:E.facet.icon,fontIconFamily:1}});D.getModel().tooltipInfos=new i({shortHelp:E.facet.text,mouseRelativePosition:false}),D.getContent().setAttribute("tab_name",E.facet.name)});if(B.length>1){this.elements.tabs.show()}else{this.elements.tabs.hide()}}},_saveAllFacets:function(){var B=this;this._lFacets.forEach(function(D){var C=B._getFacetContent(D);if(C&&D._isVisible!==false){C.onSave()}})},_loadExtensions:function(){var B=this;this._lFacets.forEach(function(D){var C=B._getFacetContent(D);if(C&&D._isVisible!==false){C.getExtensions()}})},checkChangeAuthorized:function(F,E){var D=this;var B=this.options.warningOnUnsaved===true&&this._checkSaveForAllFacets();if(B){var C="EP_checkValidClose";this.elements.superModal.confirm(g.get(C),g.get("EP_Confirmation"),function(G){if(G===true||E===true){F.call(D,G)}})}else{F.call(this,true)}},_checkSaveForAllFacets:function(){var C=this;var B=false;this._lFacets.every(function(E){var D=C._getFacetContent(E);if(D&&E._isVisible!==false){B=!D.nothingToSave()}return !B});return B},getSharedContext:function(){return this._sharedContext},setSharedContext:function(B){this._sharedContext=B;this.onRefresh()},getContainer:function(){return this.elements.container},getMainTable:function(){return this.elements.bottomArea},getIdentityCardUI:function(){return this.elements.topTable},getCollapseICPreferenceName:function(){return c.COLLAPSE_IC_PREFERENCE.name},destroyComponent:function(){var B=this;this._lFacets.forEach(function(D){var C=B._getFacetContent(D);if(C){C.destroyComponent()}});this.elements.tabs.destroy()},getOptimalSize:function(){var B=this._getCurrentFacetContent();var C=this._getSizeTopTable();var D={width:0,height:0};if(B){D=B.getOptimalSize();D.height+=C.height}return D},_getSizeTopTable:function(){var B={height:0,width:0};var C=this.elements.topTable.getSize();var D=this.elements.topTable.getStyle("display");if(D==="none"){C=B}return C},_getThumbnailDiv:function(){if(!this.thumbnail){this.thumbnail=this.elements.container.getElement(".thumbnail-section")}return this.thumbnail},_refreshCurrentFacet:function(){var C=this._getCurrentSelectedFacet();var B=this._getFacetContent(C);if(B){B.onRefresh()}},onRefresh:function(){var B=this;var C=this._getCurrentSelectedFacet();this._refreshCurrentFacet();this._lFacets.forEach(function(D){if(((D.alwaysCalled===true&&D._isVisible!==false)||(D.calledIfVisible===true&&D._isVisible===true))&&B._getFacetName(D)!==B._getFacetName(C)){B._loadFacet(D,false,function(){var E=B._getFacetContent(D);if(E){E.onRefresh()}})}})},_manageThumbnailDisplay:function(){var B=this.elements.container.getSize();var C=this.options.noThumbnail!==true&&B.height>=n;if(this.elements.postIdCard){this.elements.postIdCard.showThumbnail("height",C)}},onResize:function(B){var C=this._getCurrentFacetContent();if(C){C.onResize()}this._manageThumbnailDisplay();if(this.elements.postIdCard){this.elements.postIdCard.onResize()}this.elements.buttonsBar.onResize()},_getFacetFromName:function(C){var B=null;this._lFacets.every(function(D){if(D.facet&&D.facet.name===C){B=D}return !B});return B},getFacetContent:function(B){var C=this._getFacetFromName(B);return C?this._getFacetContent(C):null},_getFacetContent:function(B){return B&&B.content&&typeof B.content==="object"?B.content:null},_getCurrentFacetContent:function(){var B=this._getCurrentSelectedFacet();return B?this._getFacetContent(B):null},_getCurrentSelectedFacet:function(){var C=null;var B=null;if(!!this.currentFacetName&&this.options.showFacets){C=this.currentFacetName;if(C){this._lFacets.every(function(E){if(E.facet&&E.facet.name===C){B=E}return !B})}}else{if(this._lFacets.length>0){var D=this._lFacets[0];this._lFacets.every(function(F){var E=F.alwaysVisible;if(E){D=F}return !E})}B=D}return B},_updateFacets:function(){var B=this._getCurrentFacetContent();if(B){B.display()}},_hideAllFacetsContent:function(D){var C=this;var B=D?this._getFacetName(D):null;this._lFacets.forEach(function(F){var E=C._getFacetContent(F);if(E&&C._getFacetName(F)!==B){E.hide()}})},_manageFacetLaunching:function(B){var F=++window.top.perfoIncrem;window.top.performance.mark("start_launchFacets:"+F);var E=this;var G=this._getCurrentSelectedFacet();var D=this.getSharedContext();if(B!==true){this._launchFacet()}window.top.performance.mark("start_Iterate:"+F);var C=E._getFacetName(G);this._lFacets.forEach(function(I){if(((I.alwaysCalled===true&&I._isVisible!==false)||(I.calledIfVisible===true&&I._isVisible===true))&&E._getFacetName(I)!==C){var H=++window.top.perfoIncrem;window.top.performance.mark("start_loadFacet:"+H);E._loadFacet(I,false,function(){window.top.performance.mark("end_loadFacet:"+H);var J=E._getFacetContent(I);if(J){J.setContext(D)}var K=E._getCurrentSelectedFacet();if(E._getFacetName(K)===E._getFacetName(I)){E.__launchFacet(K)}})}});window.top.performance.mark("end_Iterate:"+F);window.top.performance.mark("end_launchFacets:"+F)},_launchFacet:function(){var B=this;var C=this._getCurrentSelectedFacet();this._hideAllFacetsContent(C);this._loadFacet(C,true,function(){B.__launchFacet(C)});return C},_loadFacet:function(E,B,G){var C=this;var F="loading";if(E&&E.content!==F){if(!E.content){E.content=F;var D=++window.top.perfoIncrem;window.top.performance.mark("start_prereqFacet:"+D);d([E.require],function(L){window.top.performance.mark("end_prereqFacet:"+D);E.content=null;var H=C._getCurrentSelectedFacet();var N=C._getFacetName(E)===C._getFacetName(H);if(!B||N){var I=E.options?E.options:{};var K=I.events?I.events:{};K.onNotification=function(O){C._addNotif(O)};K.onEvent=function(O){C._manageEvent(O)};I.events=K;E.options=I;E.options.tabId=E.facet.name;E.options.eventThread=C.options.eventThread+"."+E.facet.name;E.content=new L(E.options,C._sharedOptions);var M=E.content.getUI();var J=typeof M.addClassName==="function"?M:M.container?M.container:M.elements?M.elements.container:null;if(J){J.addClassName("EP_tab_Container EP_tab_"+E.facet.name)}E.content.getUI().inject(C.elements.bottomArea);if(!N){E.content.hide()}G.call(C)}})}else{G.call(C)}}},_switchSave:function(B){if(B){this.elements.boutonValid.show();if(this.elements.boutonAdd){this.elements.boutonAdd.disable()}}else{this.elements.boutonValid.hide();if(this.elements.boutonAdd){this.elements.boutonAdd.enable()}}},_switchAdd:function(B){if(B){if(this.elements.boutonAdd){this.elements.boutonAdd.show()}}else{if(this.elements.boutonAdd){this.elements.boutonAdd.hide()}}},_manageActionVisibility:function(){var B=this;var C=this._getCurrentSelectedFacet();var E=C?C.actions:null;var D=[];if(E){E.forEach(function(K){var L=K;var G=K;var F=typeof K==="object";if(F){L=K.name}else{G={}}var J=true;var I=B._getFacetContent(C);if(I){J=I.isActionAvailable(L)}if(J){var M=t[L];for(var H in M){if(!G[H]){G[H]=M[H]}}G.handler=function(){var N=B._getCurrentFacetContent();N.onAction(L)};D.push(G)}})}var E=this.options.actions;if(this.elements.postIdCard&&E&&E.length>0){this.elements.postIdCard.setActions(E)}this.elements.buttonsBar.setButtons(D);D.length>0?this.elements.buttonsBar.show():this.elements.buttonsBar.hide()},_manageEvent:function(F){var D=this._getCurrentSelectedFacet();var H=this._getFacetName(D);if(F.eventID==="switchSave"){var I=F.value;if(I!==true){I=this._checkSaveForAllFacets()}this._switchSave(I)}else{if(F.eventID==="switchAdd"){var G=this._getFacetContent(D);var K=G.getModel();var C=K.getTenant();var J=F.value;if(!J||(C=="OnPremise"||C==null||C==undefined||C=="")){this._switchAdd(J)}}else{if(F.eventID==="switchLoader"){var B=F.value;var E=this.loaderFacetList.indexOf(F.facet);if(B===true&&E<0){this.loaderFacetList.push(F.facet)}else{if(B===false&&E>=0){this.loaderFacetList.splice(E,1)}}if(this.loaderFacetList.length>0){this._displayLoadingArea()}else{this._hideLoadingArea()}}else{if(F.facet===H&&F.eventID==="updateActions"){this._manageActionVisibility()}}}}},_hideLoadingArea:function(){this.elements.loadingArea.hide()},_displayLoadingArea:function(){this.elements.loadingArea.show()},__launchFacet:function(E){var C=++window.top.perfoIncrem;var B=this._getFacetContent(E);if(B){if(this.options.showTopBar===true){this.elements.globalDiv.addClassName(x)}else{this.elements.globalDiv.removeClassName(x)}var D=B.getButtons();this.elements.facetButtonDiv.empty();if(D){D.inject(this.elements.facetButtonDiv)}window.top.performance.mark("start_displayFacets:"+C);B.display(this.getSharedContext());window.top.performance.mark("end_displayFacets:"+C);this._manageActionVisibility()}},_getFacetName:function(B){return B?B.facet?B.facet.name:"":""},_updateThumbnail:function(D,B){var C=this;if(this.elements.postIdCard){this.elements.postIdCard.changeThumbnail(D,B)}},clearIdentityCard:function(){if(this.elements.postIdCard){this.elements.postIdCard.clearValues()}},getIdentityCard:function(){return this.elements.postIdCard},selectFacet:function(B){var D=this._getFacetFromName(B);if(this.elements.tabs&&D&&D._isVisible!==false){var C=this.elements.tabs.getButtonFromValue(B);if(!!C){C.setProperties({checkFlag:true});this._switchFacet(B)}}},clearPanel:function(){this._hideAllFacetsContent()},hideMainComponent:function(){this.elements.mainInterface.hide()},showMainComponent:function(){this.elements.mainInterface.show()},_manageFacetVisibility:function(){var C=this;this._hideAllFacets();var D=++window.top.perfoIncrem;window.top.performance.mark("start_facetVisibility:"+D);var F=new r(["B","C"],function(){var H=this.getAnswer("B");var J=this.getAnswer("C");var K=C._facetCheck(this);if(K.success===true){var L=C._getCurrentSelectedFacet();var I=true;var G=null;var M=false;C._lFacets.forEach(function(P){var N=P.facet.name;var O=L&&C._getFacetName(L)===N;var Q=P._isVisible||P.alwaysVisible===true;if(Q&&P.services){P.services.forEach(function(R){if(!H[R]){Q=false}})}if(Q&&P.roles){Q=false;P.roles.forEach(function(R){if(J.indexOf(R)>=0){Q=true}})}if(!G&&Q){G=N}if(Q&&O){I=false}P._isVisible=Q;if(K.refreshCurrent===true&&O&&!I){M=true}});C._facetVisibilityUpdate();if(I){C.selectFacet(G)}if(!M&&K.refreshAction){C._manageActionVisibility()}window.top.performance.mark("end_facetVisibility:"+D);C._manageFacetLaunching(!M)}});var B=C._queryFacets(F);if(B===true){var E=C._getTenant();window.top.performance.mark("start_visibilityUrl");f.getServices(E,function(G){window.top.performance.mark("end_visibilityUrl");F.setAnswer("B",G)});window.top.performance.mark("start_visibilityRole");f.getRoles(E,function(G){window.top.performance.mark("end_visibilityRole");F.setAnswer("C",G)})}},_getTenant:function(){return o.getTenantID()},_queryFacets:function(B){return true},_facetCheck:function(B){this._lFacets.forEach(function(C){C._isVisible=true});return{success:true}},_facetVisibilityUpdate:function(){var E=this;if(this.elements.tabs){var F=this._getCurrentSelectedFacet();var D=null;var C=false;var B=[];this._lFacets.forEach(function(G){if(G._isVisible!==false&&G.visible!==false){B.push(G);if(D===null){D=G}if(G===F){C=true}}});this._createTabs(B);if(C&&F.content&&F.content.display){this.selectFacet(F.facet.name);F.content.display(this.getSharedContext())}else{if(D){this.selectFacet(D.facet.name)}}}},removeFacets:function(D){var C=[];var E=this;var F=this._getCurrentSelectedFacet();var B=false;this._lFacets.forEach(function(G){if(D.indexOf(G.facet.name)<0){C.push(G)}else{if(!!F&&F.facet.name===G.facet.name){B=true}}});this._lFacets=C;this._facetVisibilityUpdate();if(B){this._manageFacetLaunching()}},getOrAddFacets:function(D){var C=this;var B=[];D.forEach(function(E){if(!C._getFacetFromName(E.facet.name)){B.push(E)}});this.addFacets(B)},addFacets:function(E){if(!E||(Array.isArray(E)&&E.length===0)){return}var D=this;var C=true;if(E&&Array.isArray(E)){var B={};D._lFacets.forEach(function(F){if(!!F.facet){B[F.facet.name]=true}});E.forEach(function(F){if(!!F.facet&&!B[F.facet.name]){F._isVisible=F.alwaysVisible===true;C=C&&F._isVisible;if(F.position!==undefined){D._lFacets.splice(Math.min(F.position,Object.keys(D._lFacets).length-1),0,F)}else{D._lFacets.push(F)}}})}if(!C){this._manageFacetVisibility()}else{this._facetVisibilityUpdate()}},_hideAllFacets:function(){this._createTabs([])},_isFacetAuthorized:function(B){var C=this._getCurrentModelType();var D=this._getFacetFromName(B);return D&&D._isVisible!==false}});return e});define("DS/EditPropWidget/UI/IDCardManager",["DS/EditPropWidget/UI/IDCardSkeleton","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/comm/DistantAjax","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/models/EditPropAttributeModel","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(i,b,j,g,c,e,f,a,h){window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0;var d=i.extend({_lOccurrences:[],_faceVisibilityHandler:null,defaultOptions:{multiselection:b.MULTISEL_STD},init:function(l,k){this._lOccurrences=[];this._faceVisibilityHandler={handle:null};this._parent(l,k)},getModels:function(){var l=this.getOccurrences();var k=[];if(l){l.forEach(function(n){var m=n.getModel(b.MODEL_INIT);if(m){k.push(m)}})}return k},getModel:function(k,o){var m=this;var n=null;var l=[];if(o){l=o.getAllModels(true)}else{l=this.getModels()}l.every(function(p){if(k===p.get("objectId")){n=p;return false}return true});return n},_getFirstFacetModel:function(m){var k=null;var l=this._getFirstOccurrence();if(l){k=l.getModel(m)}return k},_getFirstInitModel:function(){return this._getFirstFacetModel(b.MODEL_INIT)},_getFirstPropertiesModel:function(){return this._getFirstFacetModel(b.FACET_PROPERTIES)},getOccurrences:function(){return this._lOccurrences},_getFirstOccurrence:function(){return this._lOccurrences.length>0?this._lOccurrences[0]:null},getSharedContext:function(){return this._getFirstOccurrence()},setOccurrences:function(t){var o=window.top.perfoIncrem++;window.top.performance.mark("start_setModelSkeleton:"+o);var q=this;this._clearAllFacetsModels();this.modelHasChanged=true;var l=t.length<=0;var r=null;if(l||(this.options.multiselection===b.MULTISEL_NO&&t.length>1)){r=h.get(l?"NoItemSelected":"TooManyObjectSelected")}else{if(t.length>1&&this.options.multiselection===b.MULTISEL_MERGE){var v=t[0];var p=v.getModel(b.MODEL_INIT);if(p){var w=p.getMergingModels();var k=null;var s=null;for(var x in w){var n=w[x];var u=n.get("tenant");var m=n.get("source");if(k===null){k=u}else{if(k!==u){r=h.get("DifferentTenantsNotSupported")}}if(s===null){s=m}else{if(s!==m){r=h.get("DifferentSourcesNotSupported")}}if(r!==null){break}}}}}if(r!==null){this.clearIdentityCard();this.showMainErrorArea(r);this.dispatchEvent("onTitleChanged","");this.hideMainComponent();this._lOccurrences=[]}else{this.showMainComponent();var v=t[0];v.addEvent("onChange:"+b.FACET_PROPERTIES,function(){q._initializeIDCard(v)});this._initializeIDCard(v);this._lOccurrences=t}window.top.performance.mark("end_setModelSkeleton:"+o);this._manageFacetVisibility();this._manageFacetLaunching()},__queryFacets:function(o){var n=this;if(this._faceVisibilityHandler.handle){this._faceVisibilityHandler.handle.cancel();this._faceVisibilityHandler.handle=null}var k=this._getFirstInitModel();if(k){var l=[];var m=false;n._lFacets.forEach(function(p){if(!k.isMergedModel()||p.supportMerge){l.push({name:p.facet.name,inheritance:p.inheritance});m=m||(p.services&&p.services.length>0)}});g.launchFacetsVisibility(k,l,{context:this.options.context,handleRequest:this._faceVisibilityHandler,onComplete:function(p){if(!p||p.success===false){n._addNotif({msg:!!p?p.error.message:h["Error Server"],eventID:"error"})}else{o.setAnswer("A",p)}}})}},_queryFacets:function(n){var m=this;n.addRequest("A");var l=this._getFirstInitModel();if(l){var k=j.getServiceForModel(l);if(!l.get("isTransient")&&k.modelNeeded===true){n.addRequest("Fed");require(["DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests"],function(o){o.fillModel({onComplete:function(p){var r=p.get("ds6w:type");r=r?r:p.get("ds6w:what/ds6w:type");if(r){var q=r.get("valueDB");p.set("ds6w:what/ds6w:type_value",q)}p.set("preview_url",p.get("previewUrl"));m.__queryFacets(n);n.setAnswer("Fed",true)}},l)})}else{m.__queryFacets(n)}}return !!l},_facetCheck:function(x){var A=this;var F=x.getAnswer("A");var v=x.getAnswer("Fed");var C=F.id;var m=F.facets;var M=A._getFirstInitModel();var L=A._getCurrentSelectedFacet();var D=M!==null&&M.get("objectId")===C;var E=null;var y=!!v;var P=false;if(D&&F.notification){this.clearIdentityCard();this.showMainErrorArea(F.notification.message);this.hideMainComponent();return{success:false}}if(D){var t=A._getFirstOccurrence();var G=F.mains;var R=G?G[C]:null;var I=[];var l=C;var s="empty";var z=null;if(R){l=R.id;s=R.type;z=R.metatype?R.metatype=="bus"?b.METATYPE_BUS:b.METATYPE_REL:b.METATYPE_UNKNOWN}var n=false;var J={};E=t.getModel(b.FACET_PROPERTIES);if(M.isMergedModel()){l=C;s="mergedObject";var O=M.getMergingModels();var o=E&&E.isMergedModel()?E.getMergingModels():null;for(var w in O){var r=O[w];var Q=G[w];var K=Q!=null&&Q.id?Q.id:w;var H=b.METATYPE_UNKNOWN;H=Q.metatype?Q.metatype=="bus"?b.METATYPE_BUS:b.METATYPE_REL:H;s=Q?Q.type:"";var N=o?o[K]:null;if(!N&&K!==w){n=true;var q=UWA.clone(r.getOptions());q.objectId=K;r=new c(q)}r.set("metatype",H);r.set(b.MODEL_DS_ATTR+"type",{valueDB:s,isTransient:true});var B=H===b.METATYPE_REL?F.hierarchiesRel:F.hierarchiesBus;r.set(b.MODEL_DS_ATTR+"types",{valueDB:B?B[s]:null,isTransient:true});J[K]=r}E=t.getModel(b.FACET_PROPERTIES)}else{if(E===null&&l===C){E=M}}if(n||!E){var p=E?E:M;var k=p.getAllAttributes();var u=k;if(p.get("isTransient")!==true){u=p.getOptions()}var q=UWA.clone(u);q.objectId=l;if(z){q.metatype=z}q[b.MODEL_DS_ATTR+"type"]={valueDB:s,isTransient:true};var B=H===b.METATYPE_REL?F.hierarchiesRel:F.hierarchiesBus;q[b.MODEL_DS_ATTR+"types"]={valueDB:B?B[s]:null,isTransient:true};for(var S in q){if(u[S] instanceof f){q[S]=new f(q[S])}}if(M.isMergedModel()){E=new e(q);E.setMergingModels(J)}else{E=new c(q)}}else{if(E){E.set(b.MODEL_DS_ATTR+"type",{valueDB:s,isTransient:true});var B=H===b.METATYPE_REL?F.hierarchiesRel:F.hierarchiesBus;E.set(b.MODEL_DS_ATTR+"types",{valueDB:B?B[s]:null,isTransient:true})}}t.setModel(b.FACET_PROPERTIES,E);var m=F.facets;A._lFacets.forEach(function(W){var T=W.facet.name;var U=m[T];var X=U&&(U===true||U.available===true);W._isVisible=X;if(W.inheritance===true&&A._getFacetName(L)===T){P=true}if(U&&U.information){t.setOptions(T,U.information);var V=A._getFacetName(L)===T;if(V){y=true}}})}return{success:!!E,refreshCurrent:y,refreshAction:P}},_getTenant:function(){var k=this._getFirstInitModel();return k.getTenant()?k.getTenant():this._parent()},_clearAllFacetsModels:function(){var k=this;this._lFacets.forEach(function(m){var l=k._getFacetContent(m);if(l){l.setOccurrence(null)}})},_initializeIDCard:function(m){var l=this;if(m){var k=m.getModel(b.FACET_PROPERTIES);if(k){this._updateThumbnailForModel(k);if(this.elements.postIdCard){this.elements.postIdCard.fillFromModel(k)}if(this.elements.postIdCard){k.addEvent("onChangeAttributes",function(p,n){var o=false;n.forEach(function(q){if(q&&q instanceof f){o=l.elements.postIdCard.setValueForSection(p,q)||o}})})}k.addEvent("onChange:label",function(){var n=k?k.getComputedTitle():"";l.dispatchEvent("onTitleChanged",n);if(k.get(b.MODEL_DS_ATTR+"label")){l.elements.postIdCard.setValueForSection(k,k.get(b.MODEL_DS_ATTR+"label"))}});k.addEvent("onChange:previewUrl",function(){l._updateThumbnailForModel(this)});k.addEvent("onChange:type_icon_url",function(){l._updateThumbnailForModel(this)})}}},getTitle:function(){var k=this._getFirstOccurrence();var l=k?k.getModel(b.FACET_PROPERTIES):null;var m=l?l.getComputedTitle():"";return m},_updateThumbnailForModel:function(l){if(this.options.noThumbnail!==true){var m=l.get("previewUrl")?l.get("previewUrl"):l.get("type_icon_url");m=m?m:"";var k=this._isFacetAuthorized(b.FACET_VIEWS)||l.get("activeThumbnail");this._updateThumbnail(m,k)}},_getCurrentModelType:function(){var l=this.getModels();var k=l.length>0?l[0].get("type"):"";var m=k;if(k&&typeof k==="object"){m=k.get("valueDB");m=m?m:k.get("value")}return m}});return d});