define("DS/IterationsWidget/Toolbar",["UWA/Class"],function(a){return a.extend({init:function(e,b,d){this._parent({});this.buttonWidth=e;this.buttonCount=0;var c="calc(100% - "+b+"px)";if(d=="top"){c="0px"}this.container=new UWA.Element("div",{styles:{position:"absolute",height:b+"px",top:c,width:"100%","z-index":"100"}});this.container.setAttribute("data-rec-id","toolbarDiv")},inject:function(b){this.container.inject(b)},center:function(){var b=this.buttonWidth*this.buttonCount;this.container.style.left="calc(50% - "+b/2+"px)"},addButton:function(f,d,e){var c=new UWA.Element("div",{styles:{position:"absolute",top:"0px",left:this.buttonCount*this.buttonWidth+"px",height:"100%"},title:d});c.setAttribute("data-rec-id",d+"-div");this.buttonCount++;var b=new UWA.Element("img",{src:f});b.setAttribute("data-rec-id",f+"img-"+d);b.inject(c);b.style.cursor="pointer";c.inject(this.container);c.check=function(){b.src=e;b.style.cursor="default"};c.uncheck=function(){b.src=f;b.style.cursor="pointer"};c.hide=function(){c.style.visibility="hidden"};c.show=function(){c.style.visibility="inherit"};return c},appendChild:function(b){this.container.appendChild(b)}})});define("DS/IterationsWidget/TimeAxis",["UWA/Controls/Abstract"],function(a){return a.extend({init:function(b){this.container=document.createElementNS("http://www.w3.org/2000/svg","g");this.container.setAttribute("class","timeline-timeAxis");this.container.setAttribute("data-rec-id","timeline-timeAxis");this.timeline=b;this._parent({});this.rect=document.createElementNS("http://www.w3.org/2000/svg","rect");this.rect.setAttribute("style","fill:white;stroke:black;stroke-width:2;fill-opacity:0");this.rect.setAttribute("data-rec-id","svg-rect-timeAxis");this.container.appendChild(this.rect)},inject:function(b){b.appendChild(this.container)},onResize:function(e){var b=this.timeline.getWidth()+this.timeline.config.getSliderWidth();var c=this.timeline.config.getTimepointHeight();var d=this.timeline.config.getPaddingTop();this.rect.setAttribute("x",this.timeline.config.getPaddingLeft());this.rect.setAttribute("y",d);this.rect.setAttribute("width",b);this.rect.setAttribute("height",c)}})});define("DS/IterationsWidget/Point",["UWA/Class"],function(a){var b=a.extend({init:function(c,d){this.x=c;this.y=d},add:function(c,d){return new b(this.x+c,this.y+d)},toString:function(){return this.x+","+this.y}});return b});define("DS/IterationsWidget/TimelineConfig",["UWA/Class"],function(a){return a.extend({init:function(){this.timepointHeight=15;this.timepointTopMargin=20;this.height=50;this.paddingLeft=8;this.paddingRight=8;this.paddingTop=60;this.timespanMinWidth=5;this.sliderWidth=10},getTimespanMinWidth:function(){return this.timespanMinWidth},getSliderWidth:function(){return this.sliderWidth},getTimepointTopMargin:function(){return this.timepointTopMargin},getTimepointHeight:function(){return this.timepointHeight},getWidth:function(){return this.width},getHeight:function(){return this.height},getPaddingLeft:function(){return this.paddingLeft},getPaddingRight:function(){return this.paddingRight},getPaddingTop:function(){return this.paddingTop}})});define("DS/IterationsWidget/Checkbox",["UWA/Controls/Abstract"],function(a){return a.extend({init:function(b){this.label=b;this._parent({});this.buildUI();this.oncheck=null;this.onuncheck=null;this.checked=false},buildUI:function(){this.elements.container=new UWA.Element("label",{text:" "+this.label,styles:{"font-family":"arial","font-size":"13px"}});var b=this}})});define("DS/IterationsWidget/CGRViewer",["UWA/Controls/Abstract","DS/Visualization/WebGLV6Viewer","DS/Visualization/Node3D","DS/Visualization/Viewpoint","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS"],function(g,f,d,b,a,c){var e=g.extend({init:function(j,h,i){this._parent({});this.buildUI();this.onViewpointMove=null},buildUI:function(){this.elements.container=new UWA.Element("div",{styles:{position:"absolute",height:"100%",width:"100%",}});this.elements.container.setAttribute("data-rec-id","iterationsPlayer-CGRViewerContainer");this.viewer=new f({div:this.elements.container,antiAliasing:"SMAA",useShadowMap:false,infinitePlane:false,displayGrid:false,usePicking:false});this.viewer.setVisuEnv("None");this.viewer.setLightOnViewpoint(true);this.viewpoint=new b(this.viewer);this.viewpoint.setDefaultController(true,"CATIA");this.viewer.setPicking({activated:true,computeNormalDepth:true,displayHL:true,primitive:false,trapSelection:true});this.viewer.setPrePicking({activated:true,computeNormalDepth:true,disableWhileMoving:true,displayHL:true,gpu:true,primitive:false});var h=this;this.viewpoint.onMove(function(){h.viewer.render();if(h.onViewpointMove!=null){var i=h.getViewpointJson();h.onViewpointMove(i)}});this.viewer.addViewpoint(this.viewpoint);this.modelLoader=new a(this.viewer.getWebGLContext(),false);this.sceneGraph=new d();this.viewer.addNode(this.sceneGraph);this.modelLoader.setSceneGraph(this.sceneGraph);this.modelLoader.setRenderCallback(this.viewer.render);this.modelLoader.setFileType("cgr")},getViewpointJson:function(){var i={target:this.viewpoint.control.target,orientation:this.viewpoint.control.orientation,distanceToTarget:this.viewpoint.control.distanceToTarget,};var h=JSON.stringify(i);return h},setViewpoint:function(j){var i=this.getViewpointJson();if(i==j){return}var k=JSON.parse(j);var h={};h.target=new c.Vector3(k.target.x,k.target.y,k.target.z);h.orientation=new c.Quaternion(k.orientation.x,k.orientation.y,k.orientation.z,k.orientation.w);h.distanceToTarget=k.distanceToTarget;this.viewpoint.control.moveTo(h)},loadModels:function(k){if(k==null){return}var j=0;var h=this;function i(n){if(j>=n.length){return}var m=n[j];h.loadModel(m,function l(){j++;i(n)})}i(k)},loadModel:function(m,i){var l=this;var k=new d(m);k.setVisibility(false);this.sceneGraph.addChild(k);var h=m;this.modelLoader.setOnLoadedCallback(function(){l.viewpoint.reframe();i()});var j=new XMLHttpRequest();j.onload=function(o){var n=new Uint8Array(o.target.response);l.modelLoader.loadModelFromBuffer(n,k)};j.onerror=function(){console.log("Load failed !")};j.open("GET",h,true);j.responseType="arraybuffer";j.send(null)},showModel:function(i){this.hideAll();if(i==null){return}var h=this.sceneGraph.getChildByName(i);if(h!=null){h.setVisibility(true);this.viewer.render()}},hideAll:function(){var k=this.sceneGraph.children.length;for(var h=0;h<k;h++){var j=this.sceneGraph.children[h];j.setVisibility(false)}this.viewer.render()}});return e});define("DS/IterationsWidget/CGRViewerWidget",["UWA/Controls/Abstract"],function(b){var a=b.extend({init:function(e,c,d){this._parent({});this.lang=e;this._isWebInWin=c;this._isODT=d;this.bufferedModels=null;this.bufferedActiveModel=null;this.id=this.register();this.cgrViewerLoaded=false;this.bufferedOnViewpointMove=null;this.onViewpointMove=null;window["onCGRViewerFrameLoaded"+this.id]=this.onCGRViewerFrameLoaded;window["onCGRViewerViewpointMove"+this.id]=this.onCGRViewerViewpointMove;this.buildUI()},loadModels:function(c){this.bufferedModels=c;this.loadBufferedModels()},showModel:function(c){this.bufferedActiveModel=c;this.showBufferedModel()},setViewpoint:function(c){if(this.cgrViewerLoaded==true&&this.iframe.contentWindow!=null){this.iframe.contentWindow.setViewpoint(c)}},register:function(){window.cgrViewers=window.cgrViewers||[];var c=window.cgrViewers.length;window.cgrViewers[c]=this;return c},buildUI:function(){this.iframe=UWA.createElement("iframe");this.iframe.src="CGRViewer.html?id="+this.id+"&lang="+this.lang;this.iframe.className="CGRViewerWidget";this.iframe.width="100%";this.iframe.height="100%";this.iframe.style.border="0px";this.elements.container=this.iframe;this.iframe.setAttribute("data-rec-id","CGRViewerWidget");this.iframe.setAttribute("data-rec-frame-id","CGRViewerWidget")},onCGRViewerFrameLoaded:function(d){var c=window.cgrViewers[d];c.cgrViewerLoaded=true;c.loadBufferedModels();c.showBufferedModel();c.addBufferedViewpointMoveEventListener()},onCGRViewerViewpointMove:function(e,c){var d=window.cgrViewers[e];if(d.onViewpointMove!=null){d.onViewpointMove(c)}},loadBufferedModels:function(){if(this.cgrViewerLoaded==true&&this.iframe.contentWindow!=null){this.iframe.contentWindow.loadModels(this.bufferedModels)}},showBufferedModel:function(){if(this.cgrViewerLoaded==true&&this.iframe.contentWindow!=null){this.iframe.contentWindow.showModel(this.bufferedActiveModel)}},addViewpointMoveEventListener:function(c){this.bufferedOnViewpointMove=c;addBufferedViewpointMoveEventListener()},addBufferedViewpointMoveEventListener:function(){if(this.cgrViewerLoaded==true&&this.iframe.contentWindow!=null){this.iframe.contentWindow.onViewpointMove=this.bufferedOnViewpointMove}}});return a});define("DS/IterationsWidget/TimelineData",["UWA/Class"],function(a){return a.extend({init:function(){this.data=[]},add:function(f,e,c,b){var d={id:f,time:e,label:c,img:b};this.data.push(d)},getCount:function(){return this.data.length},get:function(b){return this.data[b]},getMaxTimespan:function(){var c=this.data.length;if(c==0||c==1){return 0}var b=this.data[c-1].time-this.data[0].time;return b},getMinTimespan:function(){var e=this.data.length;var b=0;for(var c=0;c<e-1;c++){var d=this.data[c+1].time-this.data[c].time;if(c==0){b=d}else{if(d<b){b=d}}}return b}})});define("DS/IterationsWidget/IterationsWidget",["UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","UWA/Core","DS/UIKIT/Modal","i18n!DS/IterationsWidget/assets/nls/IterationsWidget","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WebappsUtils/WebappsUtils","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/LifecycleControls/assets/styles/LifecycleModals","DS/WebInWinHelper/WebInWinHelper"],function(e,j,d,g,k,c,a,b,i,f,l){var h=e.extend({defaultOptions:{wintop:false,},setOptions:function(m){this._options=m},setODT:function(m){this._isODT=m},executeCmd:function(n,m,q){var p=this;var o={wintop:false};if(m!=undefined){p.setODT(m.isODT)}console.log("options = "+m.isODT);this.setOptions(o);this._parent(m);this.buildUI();this.setObject(n.length>0?n[0]:null);this.showDialog(document.body);q()},buildUI:function(){var m=this;var n=this.elements.container=d.createElement("iframe");n.style.width="100%";n.style.height="100%"},buildWebInWinUI:function(n,m){var o=this;o._isWebInWinODTMode=m;var p=this.elements.container=d.createElement("iframe",{id:"iterationsWidgetIframe","data-socket":n});p.style.width="100%";p.style.height="100%";if(o._isWebInWinODTMode==true){p.setAttribute("data-rec-id",p.id+n);p.setAttribute("data-rec-frame-id",p.id)}},setObject:function(n){this.object=n;var p;if(n!=undefined){p=n.physicalid;if(p==="clear"){this.elements.container.src="clear";return}}else{throw k.NoInput}if(this._options.wintop!=true){if(n.type=="Folder"||n.type=="RootFolder"){throw k.Folder+k.iterationUnsupportedType}if(n.type!="CATPart"&&n.type!="3DShape"){throw n.type+k.iterationUnsupportedType}}this.tenant=n.tenant;var s="";if(this._isWebInWinODTMode===true||this._isODT===true){s=b.getWebappsBaseUrl()+"../IterationsWidget/Iterations.html?objectId="+p;s+="&_isWebInWinODTMode=true"}else{try{s=a.get3DSpaceWSUrl(this.tenant,"/webapps/IterationsWidget/Iterations.html","objectId="+p)}catch(m){}}var r=widget.lang;s+="&lang="+r;var o=this;var q="DS/UWPClientCode/PublicAPI";if(this._isWebInWinODTMode===true||this._isODT===true){o.elements.container.src=s}else{require([q],function(t){c.getSecurityContextPromise(o.tenant).then(function(u){s+="&SecurityContext="+u;o.elements.container.src=s})})}},showDialog:function(v){var s=this;var o="";if(this.object!=null){o=" - "+this.object.name+" "+this.object.revision}var u="IterationsWidgetDialog Lifecycle_Modals";var t=v.getElementsByClassName(u);var p=t.length;for(var r=0;r<p;r++){var q=t[r];v.removeChild(q)}var w=new g({className:u,closable:true,header:k.get("Title")+o});w.inject(v);w.setBody(this);w.elements.container.setStyle("top","20px");w.elements.wrapper.setStyle("width","100%");w.elements.wrapper.setStyle("height","100%");w.elements.content.setStyle("height","100%");if(w&&w.elements&&w.elements.header){var m=w.elements.header.getElement(".close.fonticon.fonticon-cancel");if(m){m.setText("\u00D7");m.removeClassName("fonticon");m.removeClassName("fonticon-cancel");m.setAttributes({title:i.close})}if(w.elements.closeTooltip&&w.elements.closeTooltip.elements){w.elements.closeTooltip.elements.container.addClassName("hideDefaultTooltip")}}w.show();s.myModal=w;widget.addEvent("onRefresh",function(){if(s.myModal!=null){s.myModal.destroy();s.myModal=null}})}});return h});define("DS/IterationsWidget/ContextMenu",["UWA/Class"],function(a){return a.extend({init:function(){this._parent({});this.contextMenu=new UWA.Element("div",{"class":"wux-afr-contextual-menu",styles:{position:"absolute",top:"115px",left:"210px",visibility:"hidden"}});var c=new UWA.Element("div",{"class":"wux-afr wux-afr-view wux-afr-state-labels"});c.inject(this.contextMenu);var b=new UWA.Element("div",{"class":"wux-afr-cmdWorkbench",styles:{display:"inline-block"}});b.inject(c);this.cmdContainer=new UWA.Element("div",{"class":"wux-afr-cmdContainer","data-name":"Views","data-visibility":"1","data-representationtype":"AfrActionBarSection"});this.cmdContainer.inject(b)},inject:function(c){this.contextMenu.inject(c);var d=this;var b=false;var e=false;c.onmousedown=function(f){if(f.button==2){b=true}};c.onmousemove=function(f){if(b){e=true}};c.oncontextmenu=function(g){if(e){b=false;e=false;return true}if(g.buttons!=0){return true}b=false;e=false;var f=g.clientX;var h=g.clientY;d.contextMenu.setStyle("top",h+"px");d.contextMenu.setStyle("left",f+"px");d.contextMenu.setStyle("visibility","visible");return false};c.onclick=function(f){d.contextMenu.setStyle("visibility","hidden")}},addMenuItem:function(e,h,c){var d=this;var g=new UWA.Element("div",{"class":"wux-afr-cmdstarter",events:{click:function(){c();d.contextMenu.setStyle("visibility","hidden")}}});g.inject(this.cmdContainer);var b=new UWA.Element("div",{styles:{width:"32px",height:"32px","line-height":"32px",display:"inline-block","vertical-align":"top","background-size":"cover","background-image":'url("'+e+'")'}});b.inject(g);var f=new UWA.Element("div",{"class":"wux-afr-label",styles:{display:"inline-block"},text:h});f.inject(g)}})});define("DS/IterationsWidget/Timer",["UWA/Class"],function(a){return a.extend({init:function(b,c){this.interval=b;this.timeout=c;this.ontick=null;this.ontimeout=null;this.id=null;this.elapsed=0},start:function(){this.elapsed=0;this.stop();this.resume()},stop:function(){this.pause()},pause:function(){clearInterval(this.id)},resume:function(){var b=this;this.id=setInterval(function(){b.elapsed+=b.interval;if(b.timeout!=null&&b.elapsed>=b.timeout){b.stop();b.postTimeoutEvent();return}else{b.postIntervalEvent()}},b.interval)},postIntervalEvent:function(){if(this.ontick!=null){this.ontick()}},postTimeoutEvent:function(){if(this.ontimeout!=null){this.ontimeout()}}})});define("DS/IterationsWidget/CGRViewerContextMenu",["UWA/Class","DS/IterationsWidget/ContextMenu"],function(a,b){return a.extend({init:function(c){this._parent({});this.cgrViewer=c;this.root3DSpaceUrl=this.get3DSpaceUrl();this.menu=new b();var d=this;this.getNls(function e(f){d.addMenuItems(f)})},getNls:function(f){var e=getUrlParamVal("lang");var c="text!DS/IterationsWidget/assets/nls/IterationsWidget_"+e+".json";var d={};require([c],function(g){d.json=JSON.parse(g);d.get=function(h){return d.json[h]};f(d)})},addMenuItems:function(c){this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_NoVisuEnv.png",c.get("Basic"),"None");this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_WhiteMirrorVisuEnv.png",c.get("WhiteReview"),"V6");this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_CleanSpaceVisuEnv.png",c.get("PureWhite"),"CleanSpace");this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_DarkBlueVisuEnv.png",c.get("BlueDesign"),"DarkBlue");this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_DarkGreyVisuEnv.png",c.get("DarkReview"),"DarkGrey");this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_ShinyVisuEnv.png",c.get("DarkMirror"),"Shiny")},addMenuItem:function(e,g,d){var f=this;this.menu.addMenuItem(this.root3DSpaceUrl+e,g,function c(){f.cgrViewer.setVisuEnv(d)})},get3DSpaceUrl:function(){var d=window.location.href;var e=d.indexOf("webapps");var c=d.substring(0,e);return c},inject:function(c){this.menu.inject(c)}})});define("DS/IterationsWidget/Tooltip",["UWA/Controls/Abstract","DS/IterationsWidget/Point"],function(c,b){var a=c.singleton({init:function(){this.fontSize=12;this.frameThickness=3;a.container=document.createElementNS("http://www.w3.org/2000/svg","svg");a.container.setAttribute("style","position:absolute;z-index:1000");a.text=document.createElementNS("http://www.w3.org/2000/svg","text");a.text.setAttribute("style","-webkit-user-select:none");a.text.setAttribute("font-family","Arial, sans-serif");a.text.setAttribute("font-size",this.fontSize);a.text.setAttribute("y",0);a.text.setAttribute("text-anchor","middle");a.rect=document.createElementNS("http://www.w3.org/2000/svg","rect");a.container.appendChild(a.rect);a.container.appendChild(a.text);a.rect.setAttribute("style","fill:#fff;stroke-width:1;stroke:#000");this._parent({})},show:function(d,h,f,e){a.text.textContent="";this.addTextContent(f);document.body.appendChild(a.container);var g=a.text.getBoundingClientRect();this.w=g.width+2*this.frameThickness;this.h=g.height+2*this.frameThickness;a.container.style.width=this.w+1;a.container.style.height=this.h+1;a.container.setAttribute("height",this.h+1);a.container.style.top=h+"px";a.container.style.left=d-g.width/2+"px";a.rect.setAttribute("width",this.w);a.rect.setAttribute("height",this.h);a.rect.setAttribute("transform","translate(1, 0)");a.text.setAttribute("transform","translate("+this.w/2+", 0)");if(a.container.offsetLeft<0){a.container.style.left="0px"}else{if(a.container.offsetLeft+this.w>window.innerWidth){a.container.style.left=window.innerWidth-this.w+"px"}}if(a.container.offsetTop<0){a.container.style.top="0px"}else{if(a.container.offsetTop+this.h>window.innerHeight){a.container.style.top=window.innerHeight-this.h+"px"}}},addTextContent:function(h){var e=h.split("<br>");var j=e.length;this.lines=j;var f="";for(var d=0;d<j;d++){var g=document.createElementNS("http://www.w3.org/2000/svg","tspan");g.setAttribute("x","0");g.setAttribute("dy","1.2em");g.textContent=e[d];this.text.appendChild(g)}},hide:function(){if(a.container.parentNode!=null){a.container.parentNode.removeChild(a.container)}}});return UWA.namespace("DS/IterationsWidget/Tooltip",a)});define("DS/IterationsWidget/TimelineSlider",["UWA/Controls/Abstract","DS/IterationsWidget/Point"],function(b,a){return b.extend({init:function(d){this.container=document.createElementNS("http://www.w3.org/2000/svg","g");this.container.setAttribute("class","timeline-slider");this.container.setAttribute("data-rec-id","timeline-slider");this.mousedown=false;this.x=0;this.thickness=3;this.timeline=d;this._parent({});var c="fill:white;stroke:black;stroke-width:2;fill-opacity:1";this.rect=document.createElementNS("http://www.w3.org/2000/svg","polygon");this.rect.setAttribute("style",c);this.rect.setAttribute("data-rec-id","timeline-slider-polygon");this.container.appendChild(this.rect);this.rect.onmousedown=this.onmousedown.bind(this);document.addEventListener("mousemove",this.onmousemove.bind(this));document.addEventListener("mouseup",this.onmouseup.bind(this));this.onmove=null;this.onbegindrag=null;this.onenddrag=null;this.w=this.timeline.config.getSliderWidth()},inject:function(c){c.appendChild(this.container)},setPosition:function(e){if(e>1){e=1}else{if(e<0){e=0}}var d=this.timeline.getWidth();this.x=d*e;var k=this.timeline.config.getSliderWidth();var i=this.timeline.timelineToCanvas(this.x);var f=this.timeline.config.getPaddingTop()-this.thickness;var c=this.timeline.config.getTimepointHeight()+2*this.thickness;var m=new a(i-k/2,f);var l=m.add(k,0);var j=l.add(0,c);var g=j.add(-k,0);this.rect.setAttribute("points",m.toString()+" "+l.toString()+" "+j.toString()+" "+g.toString());if(this.onmove!=null){this.onmove(e)}},setPositionFromList:function(e){if(e>1){e=1}else{if(e<0){e=0}}var d=this.timeline.getWidth();this.x=d*e;var k=this.timeline.config.getSliderWidth();var i=this.timeline.timelineToCanvas(this.x);var f=this.timeline.config.getPaddingTop()-this.thickness;var c=this.timeline.config.getTimepointHeight()+2*this.thickness;var m=new a(i-k/2,f);var l=m.add(k,0);var j=l.add(0,c);var g=j.add(-k,0);this.rect.setAttribute("points",m.toString()+" "+l.toString()+" "+j.toString()+" "+g.toString())},onmousedown:function(d){var c=(d.offsetX==undefined)?d.layerX:d.offsetX;this.clickXOffset=this.timeline.canvasToTimeline(c)-this.x;this.mousedown=true;d.cancelBubble=true;d.stopPropagation();d.preventDefault();if(this.onbegindrag!=null){this.onbegindrag()}},onmousemove:function(d){if(this.mousedown){d.preventDefault();var c=this.timeline.clientToTimeline(d.clientX)-this.clickXOffset;this.setPosition(c/this.timeline.getWidth())}},onmouseup:function(c){this.mousedown=false;if(this.onenddrag!=null){this.onenddrag()}}})});define("DS/IterationsWidget/Label",["UWA/Controls/Abstract","DS/IterationsWidget/Point"],function(b,a){return b.extend({init:function(c,e){this.arrowWidth=5;this.arrowHeight=3;this.textHeight=18;this.container=document.createElementNS("http://www.w3.org/2000/svg","g");this.text=document.createElementNS("http://www.w3.org/2000/svg","text");this.addTextContent(c);this.text.setAttribute("style","-webkit-user-select:none");this.text.setAttribute("font-family","Arial, sans-serif");var d=12;this.text.setAttribute("font-size",d);this.text.setAttribute("text-anchor","middle");this.frameThickness=3;this.frame=document.createElementNS("http://www.w3.org/2000/svg","polygon");this.frame.setAttribute("style","fill:#eee;stroke-width:1;stroke:#000");this.container.appendChild(this.frame);this.container.appendChild(this.text);this.hide();this.text.setAttribute("data-rec-id",c);this.frame.setAttribute("data-rec-id",c+"polygon")},addTextContent:function(g){var d=g.split("<br>");var h=d.length;this.lines=h;var e="";for(var c=0;c<h;c++){var f=document.createElementNS("http://www.w3.org/2000/svg","tspan");f.setAttribute("x","0");f.setAttribute("dy","1.2em");f.textContent=d[c];this.text.appendChild(f);f.setAttribute("data-rec-id",d[c])}},inject:function(c){c.appendChild(this.container)},show:function(){this.container.style.visibility="visible"},hide:function(){this.container.style.visibility="hidden"},getWidth:function(){var d=this.text.getBoundingClientRect();var c=d.width+2*this.frameThickness;return c},getHeight:function(){var d=this.text.getBoundingClientRect();var c=d.height+2*this.frameThickness;return c},updateFrame:function(l){var n=this.getWidth();var c=this.getHeight();var g=3;var q=new a(-n/2,0);var p=q.add(n,0);var o=p.add(0,c);var m=o.add(-g,0);var e=o.add(-n,0);var f=e.add(g,0);var j=new a(-l,c+this.arrowHeight);var i=j.add(-this.arrowWidth/2,-this.arrowHeight);var k=i.add(this.arrowWidth,0);if(i.x<f.x){i=f;k=i.add(this.arrowWidth*1.5,0)}else{if(i.x+this.arrowWidth>m.x){i=m.add(-this.arrowWidth*1.5,0);k=m}}var r=[q,p,o,m,k,j,i,f,e];this.frame.setAttribute("points",this.pointsToString(r))},update:function(c,f){var d=15;var e=f+d;this.container.setAttribute("transform","translate("+c+","+e+")");this.text.setAttribute("x","0");this.updateFrame(c)},pointsToString:function(e){var d="";for(var c=0;c<e.length;c++){if(c!=0){d+=" "}d+=e[c].toString()}return d}})});define("DS/IterationsWidget/CGRGridView",["UWA/Controls/Abstract","DS/IterationsWidget/CGRViewerWidget","DS/IterationsWidget/Checkbox"],function(d,a,b){var c=d.extend({init:function(f,j,g){this._parent({});this.elements.container=new UWA.Element("div",{styles:{position:"absolute",height:"100%",width:"100%","overflow-y":"auto"},"class":"CGRGridView"});this._isODT=g;this._webinwin=j;this.elements.container.setAttribute("data-rec-id","cgrgridviewdiv");this.cgrViewers=[];this.viewerDivs=[];this.onselectchange=null;var h=f.length;for(var e=0;e<h;e++){this.addViewer(f[e])}},onViewpointMove:function(e){var h=this.cgrViewers.length;for(var f=0;f<h;f++){var g=this.cgrViewers[f];g.setViewpoint(e)}},showSelected:function(){var g=this.viewerDivs.length;for(var e=0;e<g;e++){var f=this.viewerDivs[e];if(f.selected){f.show()}else{f.hide()}}},showAll:function(){var g=this.viewerDivs.length;for(var e=0;e<g;e++){var f=this.viewerDivs[e];f.show()}},addViewer:function(f){var j=new UWA.Element("div",{styles:{display:"inline - block",width:"250px",height:"250px",border:"1px solid grey",position:"relative","float":"left","margin-top":"10px","margin-left":"20px","margin-right":"30px","margin-bottom":"0px"},"class":"CGRGridViewCell"}).inject(this.elements.container);j.setAttribute("data-rec-id",f.label+"-CGRGridViewCell");var e=new a(this._isODT);this.cgrViewers.push(e);this.viewerDivs.push(j);e.inject(j);var i=[f.url];e.loadModels(i);e.showModel(i[0]);e.onViewpointMove=this.onViewpointMove.bind(this);if(f.label!=null){var h=new UWA.Element("div",{styles:{width:"100%",height:"20px",bottom:"0px",position:"absolute",color:"rgb(142, 142, 142)","text-align":"center","background-color":"rgba(255,255,255,0.9)","font-family":"arial","font-size":"13px"},"class":"CGRGridViewCellLabel"});h.setAttribute("data-rec-id",f.label+"CGRGridViewCellLabel"+this.viewerDivs.length);h.inject(j);var g=new b(f.label);g.inject(h)}},setODT:function(e){this._isODT=e}});return c});define("DS/IterationsWidget/Timepoint",["UWA/Controls/Abstract","DS/IterationsWidget/Label","DS/IterationsWidget/Tooltip"],function(d,c,b){var a=d.extend({init:function(g,f,i,e,h){this.container=document.createElementNS("http://www.w3.org/2000/svg","g");this.container.setAttribute("class","timeline-timepoint");this._isODT=h;this.parent=e;this.obj=g;this.timeline=f;this.nextTimepoint=null;this.previousTimepoint=i;if(i!=null){i.nextTimepoint=this}this.h=this.timeline.config.getTimepointHeight();this.y=this.timeline.config.getPaddingTop();this._parent({});this.color="rgb(54, 142, 196)";this.line=document.createElementNS("http://www.w3.org/2000/svg","line");this.line.setAttribute("style","stroke:"+this.color+";stroke-width:2");this.line.setAttribute("x1",0);this.line.setAttribute("y1",this.y);this.line.setAttribute("x2",0);this.line.setAttribute("y2",this.y+this.h);this.rect=document.createElementNS("http://www.w3.org/2000/svg","rect");this.rect.setAttribute("y",this.y);this.rect.setAttribute("height",this.h);this.container.appendChild(this.rect);this.container.appendChild(this.line);this.from=0;this.to=this.timeline.getWidth();this.hilighted=false;this.label=new c(this.obj.label,this._isODT);this.label.inject(this.container);this.resetRectStyle();this.container.setAttribute("data-rec-id","timeline-timepoint");this.rect.setAttribute("data-rec-id","timeline-timepoint-rectangle")},getNext:function(){return this.nextTimepoint},getPrevious:function(){return this.previousTimepoint},activate:function(){var e=this.getPrecentPosition();this.timeline.moveSlider(e)},inject:function(e){e.appendChild(this.container)},hilight:function(){this.unprehilight();this.hilighted=true;this.rect.setAttribute("style","fill:#eee;stroke-width:0");this.label.show()},unhilight:function(){this.hilighted=false;this.resetRectStyle();this.line.style.stroke=this.color;this.label.hide()},prehilight:function(f){if(this.hilighted){return}this.rect.setAttribute("style","fill:#ccc;stroke-width:0");var g=this.container.getBoundingClientRect();var e=this.timeline.timelineToClient(f);b.show(e,g.top,this.obj.label)},unprehilight:function(){if(this.hilighted){return}this.resetRectStyle();b.hide()},resetRectStyle:function(){this.rect.setAttribute("style","fill:#fff;stroke-width:0")},getPrecentPosition:function(){var l=this.timeline.getData();var f=l.getMaxTimespan();var o=l.getCount();if(o==1){return 0.5}var k=l.get(0).time;var e=l.get(o-1).time;var h=this.obj.time;var g=h-k;var j=(h-k)/(e-k);return j},getPosition:function(){var e=this.timeline.getWidth();var f=this.getPrecentPosition();return f*e},calcFromTo:function(){this.from=0;this.to=this.timeline.getWidth();if(this.previousTimepoint!=null){this.from=(this.previousTimepoint.x+this.x)/2;this.previousTimepoint.to=this.from}},updateLabel:function(){var f=0;var h=0;var e=this.label.getWidth();var g=false;if(this.x-e/2<0){f=e/2-this.x}else{if(this.timeline.getWidth()-this.x<e/2){f=this.timeline.getWidth()-this.x-e/2}}this.label.update(f,h)},onResize:function(e){var f=this.y;this.x=this.getPosition();this.updateLabel();this.calcFromTo()},onResized:function(){this.container.setAttribute("transform","translate("+this.x+")");this.rect.setAttribute("x",this.from-this.x);var e=this.to-this.from;if(e>0){this.rect.setAttribute("width",e)}},getPercent:function(e){var g=this.timeline.getWidth();var h=e*g;var f=(h-this.from)/(this.to-this.from);return f},hitTestX:function(e){return(this.from<=e&&e<=this.to)},hitTestY:function(e){return(e>=this.y&&e<=this.y+this.h)},hitTest:function(e,f){if(f==undefined){return this.hitTestX(e)}else{return(this.hitTestX(e)&&this.hitTestY(f))}},onmousemove:function(e,f){this.prehilight(e)},onmouseout:function(){this.unprehilight()}});return a});define("DS/IterationsWidget/IterationsGrid",["UWA/Controls/Abstract","DS/IterationsWidget/CGRGridView","DS/IterationsWidget/Checkbox"],function(d,a,b){var c=null;return d.extend({init:function(g,h,f,e,i){c=f;this.iterations=g;this.top=h;this._webinwin=e;this._parent({});this._isODT=i;this.elements.container=new UWA.Element("div",{styles:{position:"absolute",top:this.top+"px",height:"calc(100% - "+this.top+"px)",width:"100%"},"class":"IterationsGrid"});this.elements.container.setAttribute("data-rec-id","IterationsGridDiv");this.hide();this.uiBuilt=false},hide:function(){this.elements.container.style.visibility="hidden"},show:function(){this.elements.container.style.visibility="visible";if(this.uiBuilt==false){this.uiBuilt=true;this.buildUI()}},buildUI:function(){var f=new UWA.Element("div",{styles:{position:"absolute",top:"-22px",left:"150px","z-index":"200"}}).inject(this.elements.container);f.setAttribute("data-rec-id","IterationsGridShowOptionsDiv");var k=[];var j=this.iterations.length;for(var e=0;e<j;e++){var g=this.iterations[e];k.push({url:g.cgr,label:g.date})}var h=new a(k,this._webinwin,this._isODT);h.inject(this.elements.container);h.showAll();h.onselectchange=function(){}}})});define("DS/IterationsWidget/IterationsTable",["UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","UWA/Core","DS/IterationsWidget/IterationsGrid","DS/Tree/TreeDocument","DS/Tree/TreeListView","DS/Tree/TreeNodeModel","DS/Controls/Button","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","i18n!DS/IterationsWidget/assets/nls/IterationsWidget","i18n!DS/UIKIT/assets/nls/UIKIT"],function(i,n,f,b,a,h,g,o,c,m,e,l){var j="#e2e4e3";var d=j;var k=i.extend({init:function(v,p,x,u){this._parent({});this._oid=x.oid;this.NLS=v;this.lang=p;this._isODT=u;this.list=x.iterations;this._parentContainer=x.parentContainer;this._treeList=null;this.buildUITree(x.iterations);this.selectedObjects=[];this.firstSnapshotRow=null;this.iterations=x.iterations;var q=this._treeList.elements;if(q!==null){if(q.container!==null){this.setODTVariables(q.container)}if(q.formContainer!==null){this.setODTVariables(q.formContainer)}if(q.formSubmitButton!==null){this.setODTVariables(q.formSubmitButton)}}if(this._treeModel){this._treeModel["data-rec-id"]="treeDocument"}if(this._treeList){this._treeList["data-rec-id"]="treeList"}var s=document.getElementsByClassName("wux-layouts-gridengine-poolcontainer-rel");for(var t=0;t<s.length;t++){var r=s.item(t);r.setAttribute("data-rec-id","wux-layouts-gridengine-poolcontainer-rel_"+t)}var w=this._treeList.getManager().elements.poolContainerRel.querySelectorAll("wux-datagrid-cell wux-layouts-treeview-cell wux-datagrid-cell-even");for(var t=0;t<w.length;t++){var r=w.item(t);r.setAttribute("data-rec-id","wux-datagrid-cell wux-layouts-treeview-cell wux-datagrid-cell-even-"+t)}},buildUITree:function(r){var u=this;this.container=f.createElement("div",{"class":"iterationsTreeListViewContainer"});this._treeModel=new a({id:"iterations-webinwin-list","class":"iterations-webinwin-list",selection:{nodes:true,rowHeaders:false,columnHeaders:false,toggle:true,canMultiSelect:true},columns:[{dataIndex:"tree",isHidden:true},{dataIndex:"number",isHidden:true},{text:e.iterationNumber,dataIndex:"numberLabel",width:"auto"},{text:e.iterationName,dataIndex:"name",width:"auto"},{text:e.iterationDate,dataIndex:"date",width:"auto"},{dataIndex:"iterationObj",isHidden:true}],shouldAcceptDrop:function(){return false}});var v=this.NLS.get("LastSavedModelString");var x=[];for(var A=0;A<r.length;A++){var y=r[A];var q=A+1;if(A===0){q=0}var z=new Date(parseInt(y.date_ms)).toLocaleString();if(y.date.indexOf("*")>=0){z+="(*)"}var w=new g({label:A,data:y,grid:{tree:y,number:A.toString(),numberLabel:y.title,name:y.name,date:z,iterationObj:A}});this._treeModel.addChild(w);x.push({label:A,grid:{tree:y.physicalid,number:A.toString(),numberLabel:y.title,name:y.name,date:z,iterationObj:A}});y.treeNode=x[A]}var p=new h({"class":"iterationsTreeListView",id:"iterationsTreeListViewId",enableListSelection:true,resize:{columns:true,rows:true},selection:{nodes:true,rowHeaders:true,columnHeaders:false,toggle:true,canMultiSelect:true},columns:[{dataIndex:"tree",isHidden:true,width:"auto",onCellRequest:function(C){if(!C.isHeader){var B=C.cellView;if(C.nodeModel&&C.nodeModel.options){B.getContent().setContent(C.nodeModel.options.grid.tree);var s=B.getPosition();B.getContent().setAttribute("data-rec-id",C.virtualRowID+"-"+C.dataIndex)}}else{C.cellView.getContent().setAttribute("data-rec-id","tree-header")}}},{text:e.iterationNumber,dataIndex:"number",width:"10%",fontWeight:"bolder",onCellRequest:function(C){if(!C.isHeader){var B=C.cellView;if(C.nodeModel&&C.nodeModel.options){B.getContent().setContent(C.nodeModel.options.grid.number);var s=B.getPosition();B.getContent().setAttribute("data-rec-id",C.virtualRowID+"-"+C.dataIndex)}}else{C.cellView.getContent().setAttribute("data-rec-id","number-header")}}},{text:e.iterationName,dataIndex:"name",width:"auto",fontWeight:"bolder",onCellRequest:function(C){if(!C.isHeader){var B=C.cellView;if(C.nodeModel&&C.nodeModel.options){B.getContent().setContent(C.nodeModel.options.grid.name);var s=B.getPosition();B.getContent().setAttribute("data-rec-id",C.virtualRowID+"-"+C.dataIndex)}}else{C.cellView.getContent().setAttribute("data-rec-id","name-header")}}},{text:e.iterationDate,dataIndex:"date",width:"auto",fontWeight:"bolder",onCellRequest:function(C){if(!C.isHeader){var B=C.cellView;if(C.nodeModel&&C.nodeModel.options){B.getContent().setContent(C.nodeModel.options.grid.date);var s=B.getPosition();B.getContent().setAttribute("data-rec-id",C.virtualRowID+"-"+C.dataIndex)}}else{C.cellView.getContent().setAttribute("data-rec-id","date-header")}}},{dataIndex:"iterationObj",isHidden:true,width:"auto",onCellRequest:function(C){var B=C.cellView;if(C.nodeModel&&C.nodeModel.options){B.getContent().setContent(String(model.count));var s=B.getPosition();B.getContent().setAttribute("data-rec-id",C.virtualRowID+"-"+C.dataIndex)}}}],treeDocument:this._treeModel});p.onNodeClick(this.onNodeClick.bind(this));this._treeList=p;this._treeList.inject(this.container);var t=this._treeList.getManager();t.onPostUpdateViewOnce(function(){var B=this;var s=B.getScroller();if(typeof s!==undefined&&s!=null){s.elements.container.setAttribute("data-rec-id","wux-scroller")}})},setODTVariables:function(u){var q=[];if(u!=null){var s=u.childNodes;if(s!==null){for(var r=0;r<s.length;r++){if(s[r].nodeType==1){p(s[r],q,r,r)}}}function p(y,A,x,z){if(y===null){return}var t="";if(y.className==""){t=y.nodeName}else{t=y.className}y.setAttribute("data-rec-id",t);A.push(y.className);var w=y.childNodes;for(var v=0;v<w.length;v++){if(w[v].nodeType==1){p(w[v],A,v,x)}}}}}});k.prototype.onNodeClick=function(r){var E=this;if(r.cellView!==null){var s=r.cellView.elements;Object.getOwnPropertyNames(s).forEach(function(H,G,I){if(s[H]!==null){s[H].setAttribute["data-rec-id",s[H].toString()+"-"+G]}})}var A=document.getElementById("iterationCompareViewContainer");var B=document.getElementById("iterationPlayerContainer");if(E._treeList&&!E._treeList.clicked){E._treeList.clicked=false;var y=[];var t=E._treeList.getManager().getDocument().getChildren();var x=E._treeList.getManager().getSelectedRows();var C=[];for(var z=0;z<x.length;z++){var w=E._treeList.getManager().getTreeNodeModelFromRowID(x[z]);if(null!=w){C.push(w._id)}}this.selectedObjects=C;if(C&&C.length==2){window.restoreBtn.disabled=true;window.restoreBtn.className="lite";if(window._disableCompareBtn===true){window.compareBtn.disabled=true}else{window.compareBtn.disabled=false}window.compareBtn.className="icon";window.openBtn.disabled=false;window.openBtn.className="icon";if(A&&B){A.hidden="";B.hidden="hidden";var F=[];var v=[];for(var z=0;z<C.length;z++){v.push(E.iterations[C[z]])}while(A.hasChildNodes()){A.removeChild(A.lastChild)}var p=new b(v,30,this.NLS,true);p.show();p.inject(A)}}else{if(C&&C.length==0){window.openBtn.disabled=true;window.openBtn.className="lite"}else{window.openBtn.disabled=false;window.openBtn.className="icon"}if(C&&C.length==1){var q=E.iterations[C[0]].name;var u=E.NLS.get("LastSavedModelString");if(q.indexOf(u)===-1){window.restoreBtn.disabled=false;window.restoreBtn.className="icon";window.openBtn.disabled=false;window.openBtn.className="icon"}else{window.restoreBtn.disabled=true;window.restoreBtn.className="lite";window.openBtn.disabled=true;window.openBtn.className="lite"}}else{window.restoreBtn.disabled=true}window.compareBtn.disabled=true;if(A&&B){var p=window.iterationsGrid;if(p){p.hide()}A.hidden="hidden";B.hidden=""}}if(typeof window.iterationsPlayer!==undefined&&window.iterationsPlayer!=null){if(C.length==1){var D=E.iterations[C[0]].id;window.iterationsPlayer.timepointChangeFromList(D)}}}};return k});define("DS/IterationsWidget/TimelineWidget",["UWA/Controls/Abstract","DS/IterationsWidget/Timepoint","DS/IterationsWidget/TimeAxis","DS/IterationsWidget/TimelineSlider","DS/IterationsWidget/TimelineConfig"],function(e,b,d,a,c){return e.extend({init:function(f,g){this.width=500;this.config=new c();this.data=f;this._isODT=g;this.svg=null;this._parent({});window.addEventListener("resize",this.onResize.bind(this));this.timepoints=[];this.timeaxis=null;this.slider=null;this.buildUI();this.activeTimepoint=null;this.lastActiveTimepoint=null;this.sliderPosition=0;this.lastHoverTimepoint=null;this.activeTimepointChanged=null;this.activeTimepointChangedFromList=null;this.onsliderbegindrag=null;this.onsliderenddrag=null},buildUI:function(){this.container=new UWA.Element("div",{styles:{"overflow-x":"auto","overflow-y":"hidden",width:"100%",height:"100%"},"class":"timeline-container"});this.container.setAttribute("data-rec-id","timeline-container");this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg");this.svg.setAttribute("class","timeline-canvas");this.svg.setAttribute("style","position:relative;height:100%;");this.container.appendChild(this.svg);this.timepointContainer=document.createElementNS("http://www.w3.org/2000/svg","g");this.timepointContainer.setAttribute("class","timeline-timepoints");var f=this.config.getPaddingLeft()+this.config.getSliderWidth()/2;this.timepointContainer.setAttribute("transform","translate("+f+")");this.svg.appendChild(this.timepointContainer);this.buildTimepoints();this.buildTimeAxis();this.buildSlider();this.container.addEventListener("mousedown",this.onmousedown.bind(this));this.container.addEventListener("mousemove",this.onmousemove.bind(this));this.svg.setAttribute("data-rec-id","timeline-canvas");this.timepointContainer.setAttribute("data-rec-id","timeline-timepoints")},getActiveTimepoint:function(){return this.activeTimepoint},moveSlider:function(f){this.slider.setPosition(f)},moveSliderFromList:function(f){this.slider.setPositionFromList(f)},getWidth:function(){return this.width},onmousedown:function(h){var k=(h.offsetY==undefined)?h.layerY:h.offsetY;var j=k;if(this.hitTestY(j)){var g=(h.offsetX==undefined)?h.layerX:h.offsetX;var f=this.canvasToTimeline(g);var i=f/this.getWidth();this.moveSlider(i)}},hitTestY:function(i){var g=this.config.getTimepointHeight();var f=this.config.getPaddingTop();if(i>=f&&i<=f+g){return true}else{return false}},onmousemove:function(k){var m=(k.offsetY==undefined)?k.layerY:k.offsetY;var l=m;var g=(k.offsetX==undefined)?k.layerX:k.offsetX;var f=this.canvasToTimeline(g);if(this.lastHoverTimepoint!=null){if(this.lastHoverTimepoint.hitTest(f,l)==false){this.lastHoverTimepoint.onmouseout()}}for(var j=0;j<this.timepoints.length;j++){var h=this.timepoints[j];if(h.hitTest(f,l)){this.lastHoverTimepoint=h;h.onmousemove(f,l);break}}},buildTimepoints:function(){var h=null;for(var g=0;g<this.data.getCount();g++){var f=new b(this.data.get(g),this,h,this,this._isODT);f.inject(this.timepointContainer);h=f;this.timepoints.push(f)}},buildTimeAxis:function(){this.timeaxis=new d(this);this.timeaxis.inject(this.svg)},buildSlider:function(){this.slider=new a(this);this.slider.onmove=this.onSliderMoved.bind(this);this.slider.onenddrag=this.onSliderEndDragged.bind(this);this.slider.onbegindrag=this.onSliderBeginDragged.bind(this);this.slider.inject(this.svg)},getTimepoint:function(j){var f=j*this.getWidth();var k=this.timepoints.length;for(var h=0;h<k;h++){var g=this.timepoints[h];if(g.hitTest(f)){g.index=h;return g}}return null},getSliderPosition:function(){return this.sliderPosition},getSlider:function(){return this.slider},getScrollLeft:function(){return this.container.scrollLeft},recalcWidth:function(){var f=this.data.getMaxTimespan();var h=this.data.getMinTimespan();var i=this.container.offsetWidth;if(f==0||h==0){this.width=i}else{var j=f/h;var g=j*this.config.getTimespanMinWidth();if(g<i){this.width=i}else{this.width=g}}this.width-=this.config.getPaddingLeft();this.width-=this.config.getPaddingRight();this.width-=this.config.getSliderWidth()},getData:function(){return this.data},onResize:function(g){this.recalcWidth();this.svg.style.width=this.getWidth()+this.config.getSliderWidth()+this.config.getPaddingLeft()+this.config.getPaddingRight()+"px";for(var f=0;f<this.timepoints.length;f++){this.timepoints[f].dispatchEvent("onResize")}for(var f=0;f<this.timepoints.length;f++){this.timepoints[f].onResized()}this.timeaxis.dispatchEvent("onResize");this.moveSlider(this.sliderPosition)},onSliderMoved:function(f){if(this.activeTimepoint!=null){this.activeTimepoint.unhilight()}this.activeTimepoint=this.getTimepoint(f);if(this.activeTimepoint!=null){this.activeTimepoint.hilight()}this.sliderPosition=f;if(this.activeTimepointChanged!=null){if(this.activeTimepoint!=null&&this.lastActiveTimepoint!=this.activeTimepoint){this.activeTimepointChanged(this.activeTimepoint.obj.id);this.lastActiveTimepoint=this.activeTimepoint}}},onSliderMovedFromList:function(f){this.activeTimepoint=this.getTimepoint(f);if(this.activeTimepoint!=null){this.activeTimepoint.hilight()}this.sliderPosition=f;if(this.activeTimepointChangedFromList!=null){if(this.activeTimepoint!=null&&this.lastActiveTimepoint!=this.activeTimepoint){this.activeTimepointChangedFromList(this.activeTimepoint.obj.id);this.lastActiveTimepoint=this.activeTimepoint;this.lastHoverTimepoint.unhilight();this.lastHoverTimepoint=this.activeTimepoint;this.lastHoverTimepoint.hilight()}}},onSliderBeginDragged:function(){if(this.onsliderbegindrag!=null){this.onsliderbegindrag()}},onSliderEndDragged:function(){if(this.onsliderenddrag!=null){this.onsliderenddrag()}},addActiveTimepointChangeEventListener:function(f){this.activeTimepointChanged=f},addActiveTimepointChangeFromListEventListener:function(f){this.activeTimepointChangedFromList=f},clientToTimeline:function(g){var f=this.clientToCanvas(g);var h=this.canvasToTimeline(f);return h},canvasToTimeline:function(f){var g=f-this.config.getPaddingLeft()-this.config.getSliderWidth()/2;return g},timelineToCanvas:function(g){var f=g+this.config.getPaddingLeft()+this.config.getSliderWidth()/2;return f},timelineToClient:function(g){var f=this.timelineToCanvas(g);return this.canvasToClient(f)},clientToCanvas:function(g){var h=this.getCanvasClientLeft();var f=g+this.getScrollLeft()-h;return f},canvasToClient:function(g){var h=this.getCanvasClientLeft();var f=g-this.getScrollLeft()+h;return f},getCanvasClientLeft:function(){var f=this.container.getClientRects()[0];return f.left}})});define("DS/IterationsWidget/IterationsPlayer",["UWA/Controls/Abstract","DS/IterationsWidget/Toolbar","DS/IterationsWidget/CGRViewerWidget","DS/IterationsWidget/TimelineData","DS/IterationsWidget/TimelineWidget","DS/IterationsWidget/Timer","DS/IterationsWidget/Tooltip"],function(h,b,e,g,a,d,c){var f=null;return h.extend({init:function(k,j,i,n,m,l){f=i;this.lang=n;this.paused=false;this.viewEvenly=j;this.iterations=k;this._bIsWebinwin=m;this._isODT=l;this._parent({});this.buildUI();this.hide();this.interval=10;this.iterationDuration=1*1000;this.timer=null;this.timer=new d(this.interval);this.timer.ontick=this.onTimerTick.bind(this);this.timer2=null;this.timer2=new d(this.interval);this.timer2.ontick=this.onTimer2Tick.bind(this)},buildUI:function(){this.container=new UWA.Element("div",{styles:{position:"absolute",height:"100%",width:"100%"},"class":"IterationsPlayer"});var i=25;this.timelineContainer=new UWA.Element("div",{styles:{position:"absolute",height:"80px",width:"100%",left:"0px",bottom:i+"px"}});this.timelineContainer.inject(this.container);var j=new b(i,i,"bottom");this.firstButton=j.addButton("assets/images/first.png",f.get("First"));this.firstButton.onclick=this.first.bind(this);this.previousButton=j.addButton("assets/images/previous.png",f.get("Previous"));this.previousButton.onclick=this.previous.bind(this);this.backPlayButton=j.addButton("assets/images/back_play.png",f.get("BackPlay"));this.backPlayButton.onclick=this.backPlay.bind(this);this.pauseButton=j.addButton("assets/images/pause.png",f.get("Pause"));this.pauseButton.onclick=this.pause.bind(this);this.playButton=j.addButton("assets/images/play.png",f.get("Play"));this.playButton.onclick=this.play.bind(this);this.nextButton=j.addButton("assets/images/next.png",f.get("Next"));this.nextButton.onclick=this.next.bind(this);this.lastButton=j.addButton("assets/images/last.png",f.get("Last"));this.lastButton.onclick=this.last.bind(this);j.inject(this.container);j.center();this.buildTimeline(this.iterations);this.buildCGRViewer(this.iterations);this.timelineContainer["data-rec-id"]="timeLineContainer";this.container["data-rec-id"]="iterationsPlayer"},hide:function(){this.container.style.visibility="hidden";this.removeTimeline();c.hide()},showEvenly:function(){this.container.style.visibility="visible";this.viewEvenly=true;this.buildTimeline(this.iterations)},showPropotionally:function(){this.container.style.visibility="visible";this.viewEvenly=false;this.buildTimeline(this.iterations)},buildTimeline:function(j){this.removeTimeline();if(j==null){return}this.timelineData=this.getTimelineData(j);this.timeline=new a(this.timelineData,this._isODT);this.timeline.inject(this.timelineContainer);this.timeline.addActiveTimepointChangeEventListener(this.onActiveTimepointChange.bind(this));if(true===this._bIsWebinwin){this.timeline.addActiveTimepointChangeFromListEventListener(this.onActiveTimepointChangeFromList.bind(this))}var i=this;this.timeline.onslidermove=function(){i.container.style.pointerEvents="none"};this.timeline.onsliderenddrag=function(){i.container.style.pointerEvents=""};this.timeline.moveSlider(1)},buildCGRViewer:function(l){this.cgrViewer=new e(this.lang,this._bIsWebinwin,this._isODT);this.cgrViewer.inject(this.container);var o=l.length;var m=[];for(var j=o-1;j>=0;j--){var k=l[j];m.push(k.cgr)}if(m.length>0){this.cgrViewer.loadModels(m);this.cgrViewer.showModel(m[0])}},removeTimeline:function(){while(this.timelineContainer.firstChild){this.timelineContainer.removeChild(this.timelineContainer.firstChild)}},getTimelineData:function(o){var q=new g();var k=o.length;if(k>0){for(var r=0;r<k;r++){var l=o[r];var j=l.id;var m=l.date_ms;if(this.viewEvenly){m=r}var t=l.title;if(t==null){t=r}var p=new Date(parseInt(l.date_ms)).toLocaleString();if(l.date.indexOf("*")>=0){p+="(*)"}t=f.get("Iteration")+" "+t;var s=t+"<br>"+p;q.add(j,m,s)}}return q},onActiveTimepointChange:function(j){if(this.cgrViewer!=null){var i=this.getCgr(j);this.cgrViewer.showModel(i)}},onActiveTimepointChangeFromList:function(j){if(this.cgrViewer!=null){var i=this.getCgr(j);this.cgrViewer.showModel(i)}},timepointChangeFromList:function(l){if(this.cgrViewer!=null){var j=this.getCgr(l);this.cgrViewer.showModel(j);var n=this.getRowId(l);var i=this.iterations.length;var k=0;if(i>0){if(n==0){k=0}else{if(n==(i-1)){k=1}else{k=(n)/i}}}var m=true;this.timeline.moveSliderFromList(k)}},getCgr:function(l){var m=this.iterations.length;for(var j=0;j<m;j++){var k=this.iterations[j];if(k.id==l){return k.cgr}}return null},getRowId:function(l){var m=this.iterations.length;for(var j=0;j<m;j++){var k=this.iterations[j];if(k.id==l){return j}}return null},onTimerTick:function(){var i=this.timeline.getSliderPosition();var k=this.timeline.getTimepoint(i);var j=k.index;var l=k.getPercent(i);var o=this.interval/this.iterationDuration;l+=o;if(l>=1){var m=o/10;l=m;j++}var p=this.iterations.length;if(j<p){var i=this.getTimelinePosition(j,l);this.timeline.moveSlider(i)}else{this.timer.stop();this.timeline.moveSlider(1)}},onTimer2Tick:function(){var i=this.timeline.getSliderPosition();var k=this.timeline.getTimepoint(i);var j=k.index;var l=k.getPercent(i);var n=this.interval/this.iterationDuration;l-=n;if(l<=0){var m=1-n/10;l=m;j--}if(j>=0){var i=this.getTimelinePosition(j,l);this.timeline.moveSlider(i)}else{this.timer2.stop();this.timeline.moveSlider(0)}},getTimelinePosition:function(m,s){var j=this.iterations.length;if(j==0){return 0}if(j==1){return s}var p=this.getTimepointTime(0);var t=this.getTimepointTime(j-1);var i=this.getTimepointTime(m);var q=p;if(m>0){var u=this.getTimepointTime(m-1);q=(i+u)/2}var o=t;if(m<j-1){var k=this.getTimepointTime(m+1);o=(i+k)/2}var l=q+s*(o-q);var r=(l-p)/(t-p);return r},getTimepointTime:function(j){return parseInt(this.timelineData.data[j].time)},first:function(){this.pause();this.timeline.moveSlider(0)},previous:function(){this.pause();var j=this.timeline.getActiveTimepoint();var i=j.getPrevious();if(i!=null){i.activate()}},backPlay:function(){this.timer.stop();if(this.iterations==undefined||this.iterations==null){return}var i=this.timeline.getSliderPosition();if(i==0){this.timeline.moveSlider(1)}this.timer2.start()},pause:function(){this.timer.stop();this.timer2.stop()},play:function(){this.timer2.stop();if(this.iterations==undefined||this.iterations==null){return}var i=this.timeline.getSliderPosition();if(i==1){this.timeline.moveSlider(0)}this.timer.start()},next:function(){this.pause();var j=this.timeline.getActiveTimepoint();var i=j.getNext();if(i!=null){i.activate()}},last:function(){this.pause();this.timeline.moveSlider(1)}})});