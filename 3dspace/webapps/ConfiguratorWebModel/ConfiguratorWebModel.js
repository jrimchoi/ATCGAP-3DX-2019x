define("DS/ConfiguratorWebModel/ConfiguratorModel",["UWA/Core"],function(d){function a(){this._applicationStateInJson={featuresVisibleAttributes:[],optionsVisibleAttributes:["Display Text"]};this._appRulesParamInJson={multiSelection:"false",selectionMode:"selectionMode_Build",rulesMode:"RulesMode_EnforceRequiredOptions",rulesActivation:"true",completenessStatus:"Unknown",rulesCompliancyStatus:"Unknown"};this._dictionaryInJson="";this._configurationCriteriaInJson=[];this.cacheKeyInValueById=new Object();this.cacheDateKeyInDisplayValueById=new Object();this._appFuncInJson="";this._appAction="";this._accordConfigurationFeature={};this._evolutionCriteriaInJson={};this._productStateTreeObj=null;this._nodeSolver;this._solverId;this._nodeSolverName="SolverNode_0";this._mustSelectFeatureNumber=0;this._listOfListOfConflictingImpliedRules=[];this._listOfListOfConflictingIds=[];this._listOfDefaultOptionsFromSolver=[];this._rulesConsistency=true;this.cacheIdWithState=new Object();this.cacheIdWithPrice=new Object();this.totalPrice="0.0";this.cacheFeatures;this.cacheOption;this.CoordForTooltipIncompatibilities;this.cacheOptionIdWithFeatureId=new Object();this.cacheOrderableState;this._pcPurpose="";this._refineSelMode="";this._listOfRefineSelectionMode=new Object();this._showWarningInfoBox=true;this._onWinEnv=false;this._widget=null;this._errorOnConflictPanel=false;this._3dCounter=0;this.getPCPurpose=function(){return this._pcPurpose};this.setPCPurpose=function(e){this._pcPurpose=e};this.getRefineSelMode=function(){return this._refineSelMode};this.setRefineSelMode=function(e){this._refineSelMode=e};this.getWidget=function(){return this._widget};this.setWidget=function(e){this._widget=e};this.setErrorOnConflictPanel=function(e){this._errorOnConflictPanel=e};this.getErrorOnConflictPanel=function(){return this._errorOnConflictPanel};this.getFeatureIdWithOptionId=function(e){return this.cacheOptionIdWithFeatureId[e]};this.getCacheOptionsIdWithFeatureId=function(){return this.cacheOptionIdWithFeatureId};this.getCacheOrderableState=function(){return this.cacheOrderableState};this.EmptyCacheIdWithState=function(){this.cacheIdWithState=[];this._configurationCriteriaInJson=[];this.cacheKeyInValueById=[];this.cacheDateKeyInDisplayValueById=[];this.cacheFeatures=null;this.cacheOption=null};this.setCoordForTooltipIncompatibilities=function(e){this.CoordForTooltipIncompatibilities=e};this.getCoordForTooltipIncompatibilities=function(){return this.CoordForTooltipIncompatibilities};this.getFeatureCache=function(){return this.cacheFeatures};this.setFeatureCache=function(e){this.cacheFeatures=e};this.getOptionCache=function(){return this.cacheOption};this.setOptionCache=function(e){this.cacheOption=e};this.getDefaultOptionsList=function(){return this._listOfDefaultOptionsFromSolver};this.setDefaultOptionsList=function(e){this._listOfDefaultOptionsFromSolver=e};this.getListOfListOfImpliedRules=function(){return this._listOfListOfConflictingImpliedRules};this.setListOfListOfImpliedRules=function(e){this._listOfListOfConflictingImpliedRules=e};this.getListOfListOfConflictingIds=function(){return this._listOfListOfConflictingIds};this.setListOfListOfConflictingIds=function(e){this._listOfListOfConflictingIds=e};this.get3DCounter=function(){return this._3dCounter};this.set3DCounter=function(e){this._3dCounter=e};this.getRulesConsistency=function(){return this._rulesConsistency};this.setRulesConsistency=function(e){this._rulesConsistency=e};this.setConfigurationMode=function(e){if(this._onWinEnv&&this._appRulesParamInJson.selectionMode&&this._appRulesParamInJson.selectionMode!=e){this._3dCounter++}this._appRulesParamInJson.selectionMode=e;if(this._appRulesParamInJson.selectionMode=="build"){this._appRulesParamInJson.selectionMode="selectionMode_Build"}if(this._appRulesParamInJson.selectionMode=="refine"){this._appRulesParamInJson.selectionMode="selectionMode_Refine"}if(this._appRulesParamInJson.selectionMode=="selectionMode_Build"){this.setRefineSelectionModeForAllFeatures("select")}if(this._appRulesParamInJson.selectionMode=="selectionMode_Refine"){this.setRefineSelectionModeForAllFeatures("reject")}};this.getConfigurationMode=function(){return this._appRulesParamInJson.selectionMode};this.setRefineSelectionModeForSpecifiedFeature=function(f,e){this._listOfRefineSelectionMode[f]=e};this.getRefineSelectionModeForSpecifiedFeature=function(e){return this._listOfRefineSelectionMode[e]};this.setRefineSelectionModeForAllFeatures=function(f){for(var e in this._listOfRefineSelectionMode){this._listOfRefineSelectionMode[e]=f}};this.getSelectionTypeForSpecifiedFeature=function(g){var f=this._dictionaryInJson.features;for(var e=0;e<f.length;e++){if(f[e].ruleId==g){return f[e].selectionType}}};this.setCompletenessStatus=function(e){this._appRulesParamInJson.completenessStatus=e};this.getCompletenessStatus=function(){return this._appRulesParamInJson.completenessStatus};this.setRulesCompliancyStatus=function(e){this._appRulesParamInJson.rulesCompliancyStatus=e};this.getRulesCompliancyStatus=function(){return this._appRulesParamInJson.rulesCompliancyStatus};this.setDictionary=function(h){this._dictionaryInJson=h;var l=this._dictionaryInJson.features;this.cacheOrderableState=new Object();for(var f=0;f<l.length;f++){this.cacheOptionIdWithFeatureId[l[f].ruleId]=l[f].ruleId;var k=false;var g=true;if(this.getConfigurationMode()=="selectionMode_Build"){this.setRefineSelectionModeForSpecifiedFeature(l[f].ruleId,"select")}else{if(this.getConfigurationMode()=="selectionMode_Refine"){this.setRefineSelectionModeForSpecifiedFeature(l[f].ruleId,"reject")}}for(var e=0;e<l[f].options.length;e++){this.cacheOptionIdWithFeatureId[l[f].options[e].ruleId]=l[f].ruleId;if(l[f].options[e].orderability!=null){g=false;this.cacheOrderableState[l[f].options[e].ruleId]=l[f].options[e].orderability;if(l[f].options[e].orderability==true){k=true}}}if(!k&&!g){this.cacheOrderableState[l[f].ruleId]=false}else{this.cacheOrderableState[l[f].ruleId]=true}}};this.getDictionary=function(){return this._dictionaryInJson};this.setAction=function(e){this._appAction=e};this.getAction=function(){return this._appAction};this.setApplicationState=function(e){this._applicationStateInJson=e};this.getApplicationState=function(){return this._applicationStateInJson};this.setAppRulesParam=function(e){if(this._onWinEnv&&this._appRulesParamInJson.selectionMode&&this._appRulesParamInJson.selectionMode!=e.selectionMode){this._3dCounter++}this._appRulesParamInJson=e;if(this._appRulesParamInJson.selectionMode=="build"){this._appRulesParamInJson.selectionMode="selectionMode_Build"}if(this._appRulesParamInJson.selectionMode=="refine"){this._appRulesParamInJson.selectionMode="selectionMode_Refine"}if(this._appRulesParamInJson.rulesMode=="optim"){this._appRulesParamInJson.rulesMode="RulesMode_ProposeOptimizedConfiguration"}if(this._appRulesParamInJson.rulesMode=="completeConfMode"){this._appRulesParamInJson.rulesMode="RulesMode_SelectCompleteConfiguration"}if(this._appRulesParamInJson.rulesMode=="dependencies"){this._appRulesParamInJson.rulesMode="RulesMode_EnforceRequiredOptions"}if(this._appRulesParamInJson.rulesMode=="incompatibilities"){this._appRulesParamInJson.rulesMode="RulesMode_DisableIncompatibleOptions"}if(e.rules&&!e.rulesActivation){this._appRulesParamInJson.rulesActivation=e.rules}if(this._appRulesParamInJson.selectionMode=="selectionMode_Build"){this.setRefineSelectionModeForAllFeatures("select")}if(this._appRulesParamInJson.selectionMode=="selectionMode_Refine"){this.setRefineSelectionModeForAllFeatures("reject")}};this.getAppRulesParam=function(){return this._appRulesParamInJson};this.setConfigurationCriteria=function(e){this._configurationCriteriaInJson=this.stateInterpreter(e)};this.getConfigurationCriteria=function(){return this._configurationCriteriaInJson};this.getAdaptedConfigurationCriteria=function(){var e=this._configurationCriteriaInJson;for(var f=0;f<e.length;f++){if(this.isAFeature(e[f].Id)){e[f].State="Unknown"}else{if(this.isAnOption(e[f].Id)||e[f].Id.indexOf("KeyIn_")==0){if(e[f].State=="chosen"||e[f].State=="chosenInConflict"){e[f].State="Chosen"}else{if(e[f].State=="required"){e[f].State="Required"}else{if(e[f].State=="default"||e[f].State=="defaultInConflict"){e[f].State="Default"}else{if(e[f].State=="dismissed"||e[f].State=="dismissedInConflict"){e[f].State="Dismissed"}else{if(e[f].State=="incompatible"){e[f].State="Incompatible"}else{if(e[f].State=="available"||e[f].State=="included"){e[f].State="Unselected"}else{if(e[f].State=="Unknown"){e[f].State="Unknown"}else{if(e[f].State=="recommanded"){e[f].State="Selected"}}}}}}}}}}}return e};this.setAppFunc=function(e){this._appFuncInJson=e;if(e.build&&!e.selectionMode_Build){this._appFuncInJson.selectionMode_Build=e.build}if(e.refine&&!e.selectionMode_Refine){this._appFuncInJson.selectionMode_Refine=e.refine}if(e.optim&&!e.rulesMode_ProposeOptimizedConfiguration){this._appFuncInJson.rulesMode_ProposeOptimizedConfiguration=e.optim}if(e.completeConfMode&&!e.rulesMode_SelectCompleteConfiguration){this._appFuncInJson.rulesMode_SelectCompleteConfiguration=e.completeConfMode}if(e.rules&&!e.rulesMode_EnforceRequiredOptions){this._appFuncInJson.rulesMode_EnforceRequiredOptions=e.rules}if(e.incompatibilities&&!e.rulesMode_DisableIncompatibleOptions){this._appFuncInJson.rulesMode_DisableIncompatibleOptions=e.incompatibilities}};this.getAppFunc=function(){return this._appFuncInJson};this.setmultiSelect=function(e){this._appRulesParamInJson.multiSelection=e};this.getmultiSelect=function(){return this._appRulesParamInJson.multiSelection};this.setRulesMode=function(e){if(e=="optim"){e="RulesMode_ProposeOptimizedConfiguration"}if(e=="completeConfMode"){e="RulesMode_SelectCompleteConfiguration"}if(e=="dependencies"){e="RulesMode_EnforceRequiredOptions"}if(e=="incompatibilities"){e="RulesMode_DisableIncompatibleOptions"}this._appRulesParamInJson.rulesMode=e};this.getRulesMode=function(){return this._appRulesParamInJson.rulesMode};this.setRulesActivation=function(f){if(f=="false"){for(var e in this.cacheIdWithState){if(this.cacheIdWithState[e]=="chosenInConflict"){this.cacheIdWithState[e]="chosen"}else{if(this.cacheIdWithState[e]=="incompatibleFeature"){this.cacheIdWithState[e]="Unknown"}}}}this._appRulesParamInJson.rulesActivation=f};this.getRulesActivation=function(){return this._appRulesParamInJson.rulesActivation};this.setMustSelectFeatureNumber=function(e){this._mustSelectFeatureNumber=e};this.getMustSelectFeatureNumber=function(){return this._mustSelectFeatureNumber};this.getNodeSolver=function(){return this._nodeSolver};this.setNodeSolver=function(e){this._nodeSolver=e};this.setSolverId=function(e){this._solverId=e};this.getSolverId=function(){return this._solverId};this.setNodeSolverName=function(e){this._nodeSolverName=e};this.getNodeSolverName=function(){return this._nodeSolverName};this.getAttrVisibility=function(h,g){var f;if(h=="feature"){f=this._applicationStateInJson.featuresVisibleAttributes}else{if(h=="option"){f=this._applicationStateInJson.optionsVisibleAttributes}}for(var e=0;e<f.length;e++){if(f[e]==g){return true}}return false};this.setAttrVisibility=function(j,g,k){var h=false;var f=this._applicationStateInJson;var e;if(j=="feature"){for(e=0;e<f.featuresVisibleAttributes.length;e++){if(f.featuresVisibleAttributes[e]==g){h=true;if(k==false){f.featuresVisibleAttributes.splice(e,1)}}}if(!h&&k==true){f.featuresVisibleAttributes[e]=g}}else{if(j=="option"){for(e=0;e<f.optionsVisibleAttributes.length;e++){if(f.optionsVisibleAttributes[e]==g){h=true;if(k==false){f.optionsVisibleAttributes.splice(e,1)}}}if(!h&&k==true){f.optionsVisibleAttributes[e]=g}}}this.setApplicationState(f)};this.getStateWithId=function(e){return this.cacheIdWithState[e]};this.setStateWithId=function(e,g){if(g=="range"){return 0}var h=false;for(var f=0;f<this._configurationCriteriaInJson.length;f++){if(this._configurationCriteriaInJson[f].Id==e){if(this._configurationCriteriaInJson[f].State!=g&&this._onWinEnv&&this.isAnOption(this._configurationCriteriaInJson[f].Id)){this._3dCounter++}this._configurationCriteriaInJson[f].State=g;h=true;break}}if(!h){this._configurationCriteriaInJson.push({Id:e,State:g});this._3dCounter++}this.cacheIdWithState[e]=g};this.getKeyInValueById=function(e){return this.cacheKeyInValueById[e]};this.getDateKeyInDisplayValueById=function(e){return this.cacheDateKeyInDisplayValueById[e]};this.setKeyInValueById=function(e,h){var j=false;var g="available";if(h&&h!=""){g="chosen"}for(var f=0;f<this._configurationCriteriaInJson.length;f++){if(this._configurationCriteriaInJson[f].Id==e){this._configurationCriteriaInJson[f].State=g;this._configurationCriteriaInJson[f].Value=h;j=true;break}}if(!j){this._configurationCriteriaInJson.push({Id:e,State:g,Value:h})}this.cacheIdWithState[e]=g;this.cacheKeyInValueById[e]=h};this.setDateKeyInDisplayValueById=function(e,f){this.cacheDateKeyInDisplayValueById[e]=f};this.getPriceById=function(e){return this.cacheIdWithPrice[e]};this.setPriceById=function(e,f){this.cacheIdWithPrice[e]=f};this.getTotalPrice=function(){return this.totalPrice};this.setTotalPrice=function(e){this.totalPrice=e};this.stateInterpreter=function(e){var h=this;var k=[];for(var j=0;j<e.length;j++){var g=e[j].Id.indexOf("KeyIn_")==0;if(this.isAnOption(e[j].Id)||g){if(e[j].State=="Chosen"){e[j].State="chosen";if(g){e[j].Value=h.cacheKeyInValueById[e[j].Id]}}else{if(e[j].State=="Default"){e[j].State="default"}else{if(e[j].State=="Required"){e[j].State="required"}else{if(e[j].State=="Selected"){e[j].State="recommanded"}else{if(e[j].State=="Dismissed"){e[j].State="dismissed"}else{if(e[j].State=="Incompatible"){e[j].State="incompatible"}else{if(e[j].State=="Unselected"){e[j].State="available"}else{if(e[j].State=="Unknown"){e[j].State="available"}}}}}}}}if(e[j].State!="range"){h.cacheIdWithState[e[j].Id]=e[j].State;if(g&&e[j].Value){h.cacheKeyInValueById[e[j].Id]=e[j].Value;console.log("key in value "+e[j].Value)}}else{k.push(j)}}else{if(e[j].State=="Incompatible"){e[j].State="incompatibleFeature"}else{if(e[j].State=="Required"){e[j].State="requiredFeature"}else{e[j].State="Unknown"}}if(e[j].State!="range"){h.cacheIdWithState[e[j].Id]=e[j].State}else{k.push(j)}}}if(k.length>0){var f=[];f=e;e=[];for(var j=0;j<f.length;j++){if(f[j].State!="range"){e.push(f[j])}}}return e};this.setAccordConfigurationFeature=function(e){this._accordConfigurationFeature=e};this.getAccordConfigurationFeature=function(){return this._accordConfigurationFeature};this.getEvolutionCriteria=function(){return this._evolutionCriteriaInJson};this.setEvolutionCriteria=function(e){this._evolutionCriteriaInJson=e};this.getProductStateTreeObj=function(){return this._productStateTreeObj};this.isAFeature=function(h){var f=this.getFeatureCache();if(f==undefined){f=new Object();var g=this.getDictionary().features;for(var e=0;e<g.length;e++){f[g[e].ruleId]=true}this.setFeatureCache(f);if(f[h]!=undefined){return true}else{return false}}else{if(f[h]!=undefined){return true}else{return false}}return false},this.isAnOption=function(k){var g=this.getOptionCache();if(g==undefined){g=new Object();var h=this.getDictionary().features;for(var f=0;f<h.length;f++){for(var e=0;e<h[f].options.length;e++){g[h[f].options[e].ruleId]=true}}this.setOptionCache(g);if(g[k]!=undefined){return true}else{return false}}else{if(g[k]!=undefined){return true}else{return false}}return false},this.getOnWinEnv=function(){return this._onWinEnv};this.setOnWinEnv=function(e){this._onWinEnv=e},this.setProductStateTreeObj=function(e){this._productStateTreeObj=e},this.checkOptionsAndFeaturesPresenceInDictionary=function(f){var e=[];var g=false;for(var h=0;h<f.length;h++){if(f[h].Id){if(this.isAFeature(f[h].Id)||this.isAnOption(f[h].Id)){e.push({Id:f[h].Id,State:f[h].State})}else{if(f[h].Id.indexOf("KeyIn_")==0&&this.isAFeature(f[h].Id.substring("KeyIn_".length))){e.push({Id:f[h].Id,State:f[h].State,Value:f[h].Value})}else{g=true}}}}if(g&&this.getAction()=="view"){var j=d.i18n("FeatureOptionInEffective");alert(j)}return e}}var c=null;function b(){if(c==null){c=new a()}return c}return d.namespace("DS/ConfiguratorWebModel/ConfiguratorModel",b)});