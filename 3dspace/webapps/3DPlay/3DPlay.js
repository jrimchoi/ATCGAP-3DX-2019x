/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/3DPlay/3DPlayRegister",["UWA/Class","DS/WebSystem/Nls"],function(a,c){var b=a.extend({init:function(d){var e=this;this._parent(d);if(d!==undefined){if(!d.registerID){console.log("ERROR: RegisterID missing")}this.registerID=d.registerID;this.title="Register_"+this.registerID;if(d.scenarioManager){this.scenarioManager=d.scenarioManager}}c.nls(d.registerModule+"/"+d.registerName,d.registerName+".Title",function(f){e.title=f})},getTitle:function(){return this.title},dispose:function(){this.scenarioManager=undefined;this.title=undefined;this.registerID=undefined},});return b});define("DS/3DPlay/Manager",["UWA/Class"],function(a){return a.extend({init:function(b){this.name=b.name||"Manager";this.enabled=b.enabled!==undefined?b.enabled:true},enable:function(b){var c=b!==undefined?b:true;if(this.enabled!=c){this.enabled=c;this.onChangeState(c)}},isEnabled:function(){return this.enabled==true},onChangeState:function(b){},preProcess:function(b){},postProcess:function(b){},dispose:function(){}})});define("DS/3DPlay/ExperiencesList",["DS/3DPlaySupport/AssetSupport","DS/3DPlaySupport/SupportList","DS/3DPlaySupport/ExperiencesList","DS/WebSystem/Environment","UWA/Core"],function(a,f,b,h,e){console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");var c="3DPlayModelViewer";var g="3DPlayDocumentViewer";var d={"2D":[g,g,"3DPlay3DSwYm2DExperience",""],"3D":[c,"3DPlayCollaborativeExperience","3DPlay3DSwYmExperience",""]};var i={usage:{preview:0,collaborate:1,"3DSwYm":2,SimReview:3},defaultExperience:{"2D":d["2D"][0],"3D":d["3D"][1]},mimetypes:f.FILE,dtypes:f.EV6,experiences:b};i.getExperienceFromMimeType=function(j){console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");return this.mimetypes[j.toLowerCase()]};i.getExperienceFromDType=function(j){console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");return this.dtypes[j]};i.getDTypeFromPLMType=function(l,j){console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");var k={};e.extend(k,l,true);f.EV6.resolveParenting(k,j)};i.getParentBusType=function(m,l,k,j){console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");j(null)};i.getParentBusTypeServiceUri=function(k,j){console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");j(null)};i.computeUsage=function(j){console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");return f.computeUsage(j)};i.getExperienceFromUsage=function(m,l,j){console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");var k={};e.extend(k,m,true);k.usage=l;a.getExperienceID(k,{usage:l},j)};i.getExperiencesFromUsage=function(l,r,j){console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");var u=this.computeUsage(r);var p=function(x){if(x){var w=[];for(var v=0;v<=u;v++){if(typeof x[v]!=="undefined"){w.push(x[v])}}j(w.length>0?w:null)}else{j(undefined)}};var n=window.localStorage["3DPlay.OverrideSettings"];if(n){try{n=JSON.parse(n);if(n.input&&n.input.experience){var k=n.input.experience;if(k){var q=[];for(var m=0;m<=u;m++){q.push(k)}p(q)}}}catch(o){p(undefined)}return}var t=(l.asset)?l.asset.provider:l.provider;if(t==="FILE"){var s=(l.asset)?l.asset.mimetype:l.mimetype;p(i.mimetypes[s])}else{this.getExperiencesFromPLMType(l,p)}};i.getExperienceFromPLMType=function(k,j){console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");this.getExperienceFromUsage(k,null,j)};i.getExperiencesFromPLMType=function(l,j){console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");console.error("DS/3DPlay/ExperiencesList is deprecated please move to DS/3DPlaySupport/AssetSupport");var k={};e.extend(k,l,true);k=k.asset||k;a.getExperiencesIDList(k,{},j)};return i});var BrowserSupport={none:0,blacklist:1,partial:2,perfo:3,ok:4};var LogLevel={none:0,error:1,warning:2,log:3,debug:4};var eventType={loading:"loading",modelLoading:"modelLoading",notif:"notif"};var notification={info:"info",fatal:"fatal",error:"error",warning:"warning",success:"success"};var experience={create:0,ready:1};var loading={loading:"loading",launch:"launch",initialized:"initialized"};var modelLoading={reload:"reload",load:"load",started:"started",progress:"progress",finished:"finished",error:"error"};var loadingMode={autoplay:"autoplay",preload:"preload",onclick:"onclick"};var pathMigration=function(e,d,f){console.error(e,"has been moved to",d,"in framework",f)};define("DS/3DPlay/3DPlay",["UWA/Core","DS/CoreEvents/Events","DS/WebSystem/Environment","DS/WebUtils/StringUtils","DS/WebUtils/ContextedSingleton","DS/WebUtils/ProbesManager","i18n!DS/3DPlay/assets/nls/3DPlay","css!DS/3DPlay/3DPlay",],function(e,j,k,f,c,h,g,i){var b;var a="6.420.0.0";require(["text!DS/3DPlay/.3DPlay.mkversion.mk"],function(m){if(m){var l=e.is(m,"string")?JSON.parse(m):m;if(l.version){a=l.version}}},function(l){});var d=e.Class.singleton({name:"3DPlay",getApplicationWorkBenchs:function(){return this.workbenchs},workbenchs:[],initWorkbenchs:function(l){this.wbcb=l},init:function(l){this.nextAvailableCTX=0;this.args=l;this.Experiences={};this.SplashScreens={};this._setLang();console.log("3DPlay: "+this.getVersion())},_setLang:function(){if(window.widget!==undefined&&window.widget!==null&&widget.lang!==undefined&&widget.lang!==null){this.lang=widget.lang}else{if(e&&e.Utils&&e.Utils.Client&&e.Utils.Client.Locale&&e.Utils.Client.Locale.lang){this.lang=e.Utils.Client.Locale.lang}else{this.lang=""}}if(k.isSet("3DPlay.DisableNls")){this.lang=""}if(this.lang){k.set("3DPlay.Nls.Lang",this.lang)}},loadNls:function(l){pathMigration("3DPlay.LoadNLS","System/Nls","WebInfra");var m=this;require(["DS/WebSystem/Nls"],function(n){n.loadNls(l,m.lang);m=null})},nls:function(m,l,n){pathMigration("3DPlay.nls","System/Nls","WebInfra");var o=this;require(["DS/WebSystem/Nls"],function(p){p.nls(m,l,n,o.lang);o=null})},getExperience:function(l){return this.Experiences[l]},getSplashScreen:function(l){var m=c.get(l,"helper").playerSplashScreen;return m},loadCssFile:function(m,l){console.error("Deprecated, please now use require with css!");console.error("Deprecated, please now use require with css!");cssLoader(m,l)},displayFatalError:function(p,q){var o=c.get(p.ctx,"helper");var l=true;if(o&&o.playerSplashScreen){var n=o.playerSplashScreen;n.showView(n.views.logo);var m;if(p.msg!==undefined){m=p.msg;this.publish(p.ctx,"EXPERIENCE/ERROR",p);console.error("3DPlay: "+p.msg)}else{if(p.eventID!="notSupported"){m=document.createTextNode("An exception occurred during loading, see console for more details");l=false}else{if(p.error==="ScripNotFoundError"||p.NLS_ID==="LoadingError_LOAD"){l=false}}}n.showFatal(m,l,false,q)}var r=this.getExperience(p.ctx);if(r&&r.progress){r.progress.hide()}},displayNotification:function(n){var m=c.get(n.ctx,"helper");if(m&&m.playerSplashScreen){var l=m.playerSplashScreen;this.publish(n.ctx,"EXPERIENCE/ERROR",n);l.showNotification(n.msg)}var o=this.getExperience(n.ctx);if(o&&o.progress){o.progress.hide()}},endAllCommands:function(l){if(l!==undefined&&l.ctx!==undefined&&l.ctx!==null){if(WUX&&WUX.AFR&&WUX.AFR.CommandsManager){WUX.AFR.CommandsManager.endAll(l.ctx,l.resetDefaultCmd)}else{require("DS/ApplicationFrame/CommandsManager",function(m){if(m){m.endAll(l.ctx,l.resetDefaultCmd)}})}}},load:function(l){if(l!==undefined&&l.ctx!==undefined&&l.ctx!==null){var m=this.getSplashScreen(l.ctx);if(m!==undefined&&m!==null){m.removeFatal();m.hide();this.SplashScreens[l.ctx]=m=null}var n=this.getExperience(l.ctx);if(n!==undefined&&n!==null){this.Experiences[l.ctx]=n=null;delete this.Experiences[l.ctx]}l.ctx=undefined}this.createExperience(l)},createExperience:function(m){var n=this;if(m!==undefined){this.lang=m.lang||this.lang;m.lang=this.lang}var l=m.ctx||n.createContext();require(["DS/3DPlay/Loader"],function(o){o(m.input,l,n.SplashScreens[l],function(p,r){m.input=r;var s=new p(m);n.Experiences[l]=s;var u=c.get(l,"helper");if(u){s.playerSplashScreen=u.playerSplashScreen}if(m.i3DPlayApp){s._3DApp=true;m.i3DPlayApp.experience=s}var q=[];var t={};if(d.wbcb!==undefined&&d.wbcb!==null){d.wbcb(t)}if(t.commandApplication===undefined||t.commandApplication===true){q=m.workbenchs;m.workbenchs=undefined;delete m.workbenchs}if(t.workbenchs!==undefined&&t.workbenchs!==null){q=q.concat(t.workbenchs)}s.args.workbenchs=q;s.publish("EXPERIENCE/EXPERIENCECREATED",s);if(m.options.loading==loadingMode.preload){s.initExperience()}else{setTimeout(function(){s.start()},1)}},function(q){if(q.requireType=="scripterror"){var p=q.requireModules.join(",");console.error("3DPlay ScripNotFoundError: ",p);n.publish(l,"EXPERIENCE/ERROR",{exp:undefined,ScripNotFoundError:p});n.displayFatalError({ctx:l,msg:g.ScripNotFoundError+p,error:"ScripNotFoundError"})}else{console.error(q)}},m.options)})},});d.publish=function(l,m,n){j.publish({event:"/"+l+"/"+m+"/",data:n})};d.subscribe=function(l,n,m){return j.subscribe({event:"/"+l+"/"+n+"/"},m)};d.unsubscribe=function(l){return j.unsubscribe(l)};d.sendEvent=function(l,m,q,p){var n={};if(arguments.length==1){n=l}else{n.ctx=l;n.eventType=m;n.eventID=q;e.extend(n,p,true)}if(k.isBoolActive("3DPlay.Debug")){console.log("Event : "+n.toString())}if(!n.ctx){console.error("Event's context undefined or null");return}var o=this.getExperience(n.ctx);if(!o){console.error("unknown context");return}if(n.eventType==eventType.notif){return o._handleNotification(n)}this.publish(n.ctx,"EXPERIENCE/ERROR",{msg:"Event Not supported : "+n.eventType})};d.sprintf=function(){console.warn("sprintf has been moved to WebInfraWebUtils.mwebsrcStringUtils");return f.sprintf.apply(null,arguments)};d.getVersion=function(){return a};d.inputCbs=[];d.addCallbacks=function(l,s,m){m=m||"/";for(var q in s){if(s.hasOwnProperty(q)){var o=s[q];var p=m+q+"/";var t=Array.isArray(o);if(typeof(o)==="object"&&!t){d.addCallbacks(l,o,p)}else{if(this.inputCbs[l]===undefined){this.inputCbs[l]=[]}if(t){for(var n=0;n<o.length;n++){this.inputCbs[l].push(this.subscribe(l,p.toUpperCase(),o[n]))}}else{this.inputCbs[l].push(this.subscribe(l,p.toUpperCase(),o))}}}}};d.removeCallbacks=function(l){if(this.inputCbs[l]){var n=this.inputCbs[l];for(var m=0;m<n.length;m++){this.unsubscribe(n[m])}this.inputCbs[l]=undefined}};return e.namespace("SHARE/Core",d)});var Provider={FILE:"FILE",BUFFER:"BUFFER",EV6:"EV6"};define("DS/3DPlay/Loader",["DS/WebSystem/Environment","DS/3DPlaySupport/AssetSupport","DS/3DPlaySupport/SupportList","DS/3DPlaySupport/ExperiencesList","DS/WebUtils/StringUtils","DS/WebSystem/Nls","DS/WebUtils/ProbesManager","DS/3DPlayConnectors/3DPlayInputPreProcessor"],function(d,e,h,c,g,f,b,a){return function(n,i,m,o,l,k){if(n&&n.preProcessed!==true){console.error("3DPlayWeb: inputs should have been pre processed before call.");console.error("3DPlayWeb: Please consider using 3DPlayHelper or InputPreProcessor.")}var j=new a();j.run(n,function(q){var p=null;var v=function(w){b.end("Require Experience");o(w,q)};var t=function(w){var x=Array.isArray(w)?w[0]:w;var y=c[x];if(y!==undefined){console.log(g.sprintf('3DPlay: Product found : "{0}" in Experience "{1}"',y.name,y.module));q.experience={};q.experience.filename=y.module;b.createProbe("Require Experience").begin();require([y.module],v,l);return}f.nls("3DPlay/Core","NoExperience",function(z){SHARE.Core.displayFatalError({ctx:i,msg:z+x,error:"NoExperience"})})};if(q.experience!==undefined){if((typeof q.experience)==="string"){p=[q.experience]}else{var r=q.experience;if(r.provider===undefined){r.provider="FILE"}if(r.provider.toUpperCase()==="FILE"){if(r.filename!==undefined&&r.filename!==null&&(typeof r.filename)==="string"){b.createProbe("Require Experience").begin();require([r.filename],v,l);return}}f.nls("3DPlay/Core","BadExperience",function(w){SHARE.Core.displayFatalError({ctx:i,msg:w,error:"BadExperience"})});return}}else{var s=Array.isArray(q.asset)?q.asset[0]:q.asset;if(s===undefined||s===null){p=h.FILE["3dxml"]}else{if(s.error){if(s.error.NLS_File&&s.error.NLS_ID){f.nls(s.error.NLS_File,s.error.NLS_ID,function(w){SHARE.Core.displayFatalError({ctx:i,msg:w,error:s.error.NLS_ID})});return}}e.getExperienceID(s,{doOpen:true,usage:q.usage},function(w){if(w!==null&&w!==undefined){t(w)}else{if(s.provider==="EV6"){f.nls("3DPlay/Core","BadDType",function(x){SHARE.Core.displayFatalError({ctx:i,msg:x,error:"BadDType"})})}else{if(s.provider==="FILE"){f.nls("3DPlay/Core",["UnsupportedMimeType1","UnsupportedMimeType2"],function(x){var y=s.mimetype||s.format;SHARE.Core.displayFatalError({ctx:i,msg:x[0]+y.toUpperCase()+x[1],error:"NoMimeType"})})}}}});return}}if(Array.isArray(p)&&p.length>1){var u=h.computeUsage(q.usage);p=p[u]}t(p)})}});define("DS/3DPlay/3DPlayScenarioManager",["UWA/Core","UWA/Class","DS/ApplicationFrame/CommandsManager","DS/3DPlay/3DPlay","DS/WebSystem/Nls","DS/WebSystem/Environment","DS/WebappsUtils/WebappsUtils","DS/WAFData/WAFData"],function(f,b,a,h,g,j,d,i){var c=1000;var k={};var e=b.singleton({init:function(l){this._currentID=undefined},getExperience:function(){if(this._3DPlayExp!==undefined){return this._3DPlayExp}},loadManager:function(n){if(n){var p=this;this._3DPlayExp=n;this._updateScenarioChooser();var o=this._3DPlayExp._name.split("/");var l=o.length-2;var m=o[l];this._loadRegisters(d.getWebappsBaseUrl()+m+"/assets/RegisterList.json");this._3DPlayExp.EventDisposer.add(this._3DPlayExp.subscribe("ASSET/CHANGE",function(){p._3DPlayExp.stop();p._3DPlayExp.workbenchIndex=0;p._3DPlayExp.manageWorkBenchs({createActionBar:true,finishCallBack:function(){p._currentID=undefined},})}));return null}},addScenario:function(p){var n=p.registerID;var m=p.scenario;if(!n||!m){return null}c++;var o={registerModule:k[n].registerModule,registerName:k[n].registerName,scenarioName:p.name,scenarioManager:this,id:c,};var l={scenarioID:c,available:p.available,scenario:new m(o),subScenario:{},};if(l.scenario){k[n].scenario[c]=l}if(!this._defaultRegisterID||(k[n].isDefault===true&&n!==this._defaultRegisterID)){this._defaultRegisterID=undefined;this._setDefaultRegister()}this._updateScenarioChooser();return l.scenarioID},removeScenario:function(m,l){if(!m||!l){return false}var p=true;var o=k[m].scenario[l];if(o.scenario!==this._currentID){if(Object.keys(o.subScenario).length>0){for(var n in o.subScenario){p=this.removeSubScenario(m,l,o.subScenario[n].scenarioID)}}if(p===true){o.scenario.dispose();o.scenario=undefined;o=undefined;delete k[m].scenario[l];if(this._defaultRegisterID&&this._defaultRegisterID===m){this._setDefaultRegister()}return p}}return false},addSubScenario:function(p){var n=p.registerID;var l=p.scenarioID;var q=p.subScenario;if(!n||!l||!q){return null}c++;var o={registerModule:k[n].registerModule,registerName:k[n].registerName,scenarioName:p.name,scenarioManager:this,id:c,};var m={scenarioID:c,available:p.available,parentScenarioID:l,scenario:new q(o),};if(m.scenario){k[n].scenario[l].subScenario[c]=m}if(!this._defaultRegisterID||(k[n].isDefault===true&&n!==this._defaultRegisterID)){this._defaultRegisterID=undefined;this._setDefaultRegister()}return m.subScenarioID},removeSubScenario:function(o,n,m){if(!o||!n||!m){return false}var l=k[o].scenario[n].subScenario[m];if(scenario.scenario!==this._currentID){l.scenario.dispose();l.scenario=undefined;l=undefined;delete k[o].scenario[n].subScenario[m];if(this._defaultRegisterID&&this._defaultRegisterID===o){this._setDefaultRegister()}return true}return false},setAvailability:function(q,p){var n=p.iRegisterID;var m=p.iScenarioID;var l=p.iSubScenarioID;var o=false;if(!q){q=false}if(l&&m&&n&&k[n]&&k[n].scenario[m]){if(k[n].scenario[m].subScenario[l]){k[n].scenario[m].subScenario[l].available=q;o=true}}else{if(m&&n&&k[n]){if(k[n].scenario[m]){k[n].scenario[m].available=q;o=true}}else{if(n&&k[n]){k[n].available=q;if(n===this._defaultRegisterID){this._setDefaultRegister()}o=true}}}this._updateScenarioChooser();return o},initScenario:function(){this._updateScenarioChooser();var l=this._getDefaultScenario();this.changeScenario(l.registerID,l.scenarioID,l.subScenarioID)},changeScenario:function(p,n,m,s){if(s){this._resetScenario(p,n,m)}else{if(m&&((this._currentID&&this._currentID.subScenarioID&&m!==this._currentID.subScenarioID)||m)){var l=this._getScenario(p,n,m);this._3DPlayExp.publish("SCENARIO/CHANGE",{experience:this._3DPlayExp,ctx:this._3DPlayExp.args.ctx,scenario:l.scenario,});if(this._currentID&&this._currentID.registerID&&this._currentID.scenarioID&&this._currentID.subScenarioID){var q=this._getScenario(this._currentID.registerID,this._currentID.scenarioID,this._currentID.subScenarioID)}if(this._currentID&&n===this._currentID.scenarioID&&this._currentID.subScenarioID){q.scenario.stop();l.scenario.launch();a.resetDefaultCommand(this._3DPlayExp.args.ctx)}else{var r=this._getScenario(p,n);if(this._currentID&&this._currentID.registerID&&this._currentID.scenarioID){var o=this._getScenario(this._currentID.registerID,this._currentID.scenarioID)}if(this._currentID&&this._currentID.subScenarioID){q.scenario.stop()}if(o&&o.scenario){o.scenario.stop()}r.scenario.launch();l.scenario.launch();a.resetDefaultCommand(this._3DPlayExp.args.ctx)}this._currentID={registerID:p,scenarioID:n,subScenarioID:m,};return true}else{if(n&&((this._currentID&&this._currentID.scenarioID&&n!==this._currentID.scenarioID)||n)&&!m){var r=this._getScenario(p,n);this._3DPlayExp.publish("SCENARIO/CHANGE",{experience:this._3DPlayExp,ctx:this._3DPlayExp.args.ctx,scenario:r.scenario,});if(this._currentID&&this._currentID.registerID&&this._currentID.scenarioID){var o=this._getScenario(this._currentID.registerID,this._currentID.scenarioID)}if(this._currentID&&this._currentID.subScenarioID){var q=this._getScenario(this._currentID.registerID,this._currentID.scenarioID,this._currentID.subScenarioID);q.scenario.stop()}if(o&&o.scenario){o.scenario.stop()}r.scenario.launch();a.resetDefaultCommand(this._3DPlayExp.args.ctx);this._currentID={registerID:p,scenarioID:n,subScenarioID:m,};return true}}}return false},getAllRegisters:function(){return k},getAllScenarioForRegister:function(l){if(!l){return false}var q=[];var o=k[l].scenario;for(var n in o){if(Object.keys(o[n].subScenario).length>0){var m=o[n].subScenario;for(var p in m){q.push(m[p])}}else{q.push(o[n])}}return q},getAllScenarios:function(){var m=[];for(var l in k){m=m.concat(this.getAllScenarioForRegister(k[l].registerID))}return m},getCurrentScenario:function(){if(this._currentID){return this._getScenario(this._currentID.registerID,this._currentID.scenarioID,this._currentID.subScenarioID)}},isAvaiable:function(n,m,l){if(n&&m&&l){return k[n].scenario[m].subScenario[l].available}else{if(n&&m){return k[n].scenario[m].available}else{if(n){return k[n].available}}}return null},reset:function(){k=[];this._currentID=undefined;if(this._requiredRegister&&this._requiredRegister.length>0){this._initRegisters(this._requiredRegister)}},getScenarioAvailibility:function(){if(this._getAllAvailableScenarios().length>1){return true}},dispose:function(){this._requiredRegister=[];k=[];this._3DPlayExp=undefined},_updateScenarioChooser:function(){if(this._3DPlayExp&&this._3DPlayExp.args&&this._3DPlayExp.args.ctx){var l=a.getCommands(this._3DPlayExp.args.ctx);if(l&&l.Scenario){if(this._getAllAvailableScenarios().length>1){l.Scenario.enable()}else{l.Scenario.disable()}}}},_initRegisters:function(q){var r=this,p;for(p=q.length-1;p>=0;p--){var m=q[p];if(m.registerClass){c++;var o={registerID:c,available:true,scenario:{},isDefault:m.isDefault,registerName:m.registerName,registerModule:m.registerModule,register:m.registerClass,};k[c]=o}}for(p in k){if(k.hasOwnProperty(p)){var n={};n.registerID=k[p].registerID;n.scenarioManager=r;n.registerName=k[p].registerName;n.registerModule=k[p].registerModule;var l=new k[p].register(n);if(l){k[l.registerID].register=l;if(!this._defaultRegisterID||k[l.registerID].isDefault===true){this._defaultRegisterID=l.registerID}}}}},_loadRegisters:function(p){var o=this;if(p===undefined||p===null||p===""){return false}this._3DPlayExp.disposeFunctions.add(function(){o=null});var m=[];var l=false;var n={type:"json",cache:3600,timeout:7200000,onComplete:function(r){if(r&&r.list&&r.list.length>0){o._requiredRegister=[];var q=0;r.list.forEach(function(s){require([s.NS+"/"+s.module+"/"+s.name,],function(t){q++;var u=false;if(s.isDefault&&s.isDefault.toLowerCase()==="true"){u=true}else{u=false}o._requiredRegister.push({registerName:s.name,registerModule:s.module,registerClass:t,isDefault:u,});if(q===r.list.length){o._initRegisters(o._requiredRegister);o.initScenario()}},function(t){q++;console.log("ERROR : require failed "+t);if(q===r.list.length){o._initRegisters(o._requiredRegister);o.initScenario()}})});l=true}else{l=false}},onFailure:function(q){console.log("Did not find any registers, this is OK if you are not using Scenarios in your experience. Detailed Error: "+q);l=false},onCancel:function(q){console.log("Did not find any registers, this is OK if you are not using Scenarios in your experience. Detailed Error: "+q);l=false}};i.handleRequest(p,n);return l},_setDefaultRegister:function(){if(this._defaultRegisterID&&k[this._defaultRegisterID].available===true){var l=this._getAllAvailableScenarioForRegister(this._defaultRegisterID).length;if(l<1){this._defaultRegisterID=undefined}}if(!this._defaultRegisterID){for(var m in k){var l=this._getAllAvailableScenarioForRegister(k[m].registerID).length;if(l>0&&k[m].available===true&&k[m].isDefault===true){this._defaultRegisterID=m;break}}if(!this._defaultRegisterID){for(var m in k){var l=this._getAllAvailableScenarioForRegister(k[m].registerID).length;if(l>0&&k[m].available===true){this._defaultRegisterID=m;break}}}}this._updateScenarioChooser()},_getAllAvailableScenarioForRegister:function(l){if(!l){return false}var n=this.getAllScenarioForRegister(l);var o=[];for(var m=0;m<n.length;m++){if(n[m].available===true){o.push(n[m])}}return o},_getDefaultScenario:function(){this._setDefaultRegister();var n=null;var l=null;if(this._defaultRegisterID!==null&&k[this._defaultRegisterID]&&k[this._defaultRegisterID].available){var m=this._getAllAvailableScenarioForRegister(this._defaultRegisterID);n=m[0].scenarioID;if(m[0].parentScenarioID){n=m[0].parentScenarioID;l=m[0].scenarioID}}return{registerID:this._defaultRegisterID,scenarioID:n,subScenarioID:l,}},_getAllAvailableScenarios:function(){var m=this.getAllScenarios();var n=[];for(var l=0;l<m.length;l++){if(m[l].available===true){n.push(m[l])}}return n},_getScenario:function(n,m,l){if(!n||!m){return null}if(l){if(k&&k[n]&&k[n].scenario&&k[n].scenario[m]&&k[n].scenario[m].subScenario&&k[n].scenario[m].subScenario[l]){return k[n].scenario[m].subScenario[l]}}else{if(k&&k[n]&&k[n].scenario&&k[n].scenario[m]){return k[n].scenario[m]}}return null},_resetScenario:function(n,m,l){var o=this;this._3DPlayExp.stop();this._3DPlayExp.workbenchIndex=0;this._3DPlayExp.manageWorkBenchs({createActionBar:true,finishCallBack:function(){if(n&&m){o._3DPlayExp.resetScenarioMAB();o.changeScenario(n,m,l)}else{o.initScenario()}},})},});return e});define("DS/3DPlay/3DPlaySubScenario",["DS/3DPlay/3DPlay","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/WebSystem/Environment","DS/WebSystem/Nls","DS/WebSystem/Rsc",],function(c,b,e,d,f,a){return b.extend({init:function(g){var h=this;this.subScenarioID=g.id;this.scenarioManager=g.scenarioManager;this.title="Scenario"+this.scenarioID;this.description="Description"+this.scenarioID;f.nls(g.registerModule+"/"+g.registerName,g.registerName+"."+g.scenarioName+".Title",function(i){h.title=i});f.nls(g.registerModule+"/"+g.registerName,g.registerName+"."+g.scenarioName+".Description",function(i){h.description=i});a.rsc(g.registerModule+"/"+g.registerName,{iconName:g.scenarioName,iconSize:"Normal"},function(i){h.icon=i})},dispose:function(){this.scenarioManager=undefined;this.title=undefined;this.icon=undefined;this.description=undefined},getTitle:function(){return this.title},getDescription:function(){return this.description},getIcon:function(){return this.icon},launch:function(){},stop:function(){},})});define("DS/3DPlay/3DPlayScenario",["DS/3DPlay/3DPlay","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/WebSystem/Environment","DS/WebSystem/Nls","DS/WebSystem/Rsc"],function(c,b,e,d,f,a){return b.extend({init:function(g){var h=this;this.scenarioID=g.id;this.scenarioManager=g.scenarioManager;this.title="Scenario"+this.scenarioID;this.description="Description"+this.scenarioID;f.nls(g.registerModule+"/"+g.registerName,g.registerName+"."+g.scenarioName+".Title",function(i){h.title=i});f.nls(g.registerModule+"/"+g.registerName,g.registerName+"."+g.scenarioName+".Description",function(i){h.description=i});a.rsc(g.registerModule+"/"+g.registerName,{iconName:g.scenarioName,iconSize:"Normal"},function(i){h.icon=i})},dispose:function(){this.scenarioManager=undefined;this.title=undefined;this.icon=undefined;this.description=undefined},getTitle:function(){return this.title},getDescription:function(){return this.description},getIcon:function(){return this.icon},launch:function(){},stop:function(){},loadWorkbench:function(i,g,h){if(!i||!i.module||!i.name){console.error(this.title," did not provide a valid workbench")}var k=(g!==undefined)?g:true;var j=this.scenarioManager.getExperience();j.loadWorkbench(i,k,h)},isMobileCompatible:function(){return false}})});define("DS/3DPlay/PlayScenario3D",["DS/3DPlay/3DPlayScenario"],function(a){return a.extend({init:function(b){this._parent(b)}})});