/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/TraceableRequirementsUtils/Command/ActionBar_CleanAllCmd",["DS/ApplicationFrame/Command","DS/i3DXCompassServices/i3DXCompassPubSub"],function(b,a){var c=b.extend({name:"req_cleanAll",init:function(d){this._parent(d,{isAsynchronous:true})},beginExecute:function(){},execute:function(){var d=this;require(["DS/PADUtils/PADContext"],function(f){a.publish("resetObject");a.publish("resetX3DContent");var g=UWA.is(widget.getValue("X3DContentId"),"string")?JSON.parse(widget.getValue("X3DContentId")):null;if(UWA.is(g)&&UWA.is(g.data)){g.data.items=[];widget.setValue("X3DContentId",JSON.stringify(g))}var e=f.get();e.cleanAll();d.end()})},endExecute:function(){}});return c});define("DS/TraceableRequirementsUtils/Command/ReqCmdBase",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(b,c){var a=b.extend({init:function(d){this._parent(d,{isAsynchronous:true});if(c.get()){this._check_select();c.get().getPADTreeDocument().getXSO().onChange(this._check_select.bind(this))}},_check_select:function(){var d=c.get().getPADTreeDocument().getXSO().get().length?true:false;if(d===true){this.enable()}else{this.disable()}}});return a});if(typeof jQuery!=="undefined"){define("DS/TraceableRequirementsUtils/jQuery",function(){return jQuery})}else{if(require.toUrl("DS/VENENO6WPlugins/jQuery").indexOf("latest")===-1){var lJQueryPath=require.toUrl("DS/VENENO6WPlugins/plugins/jquery/latest/");var lIndexOfQuestionMark=lJQueryPath.indexOf("?");if(lIndexOfQuestionMark>-1){lJQueryPath=lJQueryPath.substring(0,lIndexOfQuestionMark)}require.config({paths:{"DS/VENENO6WPlugins/jQuery":lJQueryPath+"jquery"},shim:{"DS/VENENO6WPlugins/jQuery":{exports:"jQuery"}}})}}define("DS/TraceableRequirementsUtils/jQuery",["DS/VENENO6WPlugins/jQuery"],function(a){a.noConflict();return a});define("DS/TraceableRequirementsUtils/Command/HomePage_InsertRootCmd",["UWA/Core","DS/Logger/Logger","DS/ApplicationFrame/Command","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json"],function(f,b,a,e,d){var c=a.extend({name:"REQ_HOMEPAGE_PANEL",_logger:null,_options:null,init:function(g){this._logger=b.getLogger(c);this._options=g},_displayMessage:function(g,h,i){if(UWA.is(g.displayNotification)){g.displayNotification({eventID:i,msg:h})}else{alert(h)}},beginExecute:function(){this._logger.log(this._id+".beginExecute")},execute:function(){this._logger.log(this._id+".execute");var g=this;require(["DS/PADUtils/PADContext","DS/PADUtils/views/PADModalChooser"],function(n,q){var s=function(h){new q({renderTo:document.body,position:"above_action_bar",in_apps_search:{multiSel:false,in_apps_callback:g._onSelectionDone.bind(g),precond:h}})};var m=n.get();var p=null;var o=g._options.arguments[0].Type;var j;if(UWA.is(o)){var r=new Array(o.length);for(var l=0;l<o.length;l++){r[l]=o[l]}j="(";for(var k=0;k<r.length;k++){if(k===0){j+='flattenedtaxonomies:"types/'+r[k]+'"'}else{j+=' OR flattenedtaxonomies:"types/'+r[k]+'"'}}j+=")";s(j)}else{m.displayNotification({eventID:"warning",msg:e.Requirement_Notif_CmdNotAvailable})}})},endExecute:function(){this._logger.log(this._id+".endExecute")},_onSelectionDone:function(h){var g=this;require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices"],function(l,k,i){var j=l.get();var m=h[0].id;i.getInfo({securityContext:k.getSecurityContext(),pid:m,selectables:"type,name,revision,attribute[Title],type.kindof,current,physicalid,id",onComplete:function(p){var o=UWA.is(p,"string")?JSON.parse(p):p;var n=o.results[0];n.indexCreation=false;j.refreshOnCreate(n,true)},onFailure:function(n,o){console.warn("WS getInfo.onFailure")},onTimeout:function(n){console.warn("WS getInfo.onFailure")}})})}});return c});define("DS/TraceableRequirementsUtils/Command/ActionBar_CreateStandaloneCmd",["DS/ApplicationFrame/Command","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json"],function(a,c){var b=a.extend({init:function(d){this._parent(d,{isAsynchronous:true});this._options=d;this._relPattern=JSON.parse(c)},_displayMessage:function(d,e,f){if(UWA.is(d.displayNotification)){d.displayNotification({eventID:f,msg:e})}else{alert(e)}},beginExecute:function(){var d=this;require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(j,f,h,g){var i=j.get();var e=d._options.arguments[0].Type;var k=e;if(UWA.is(i.getDefaultType)){k=i.getDefaultType(k)}f.getCustomTypes({type:"Requirement",selectables:"type,name,revision,attribute[Title]",onComplete:function(l){var m=UWA.is(l,"string")?JSON.parse(l):l;i.saveCSRF(m.csrf);f.create({securityContext:h.getSecurityContext(),type:k,json:{},onComplete:function(s){var q=UWA.is(s,"string")?JSON.parse(s):s;var o=q.results;i.refreshOnCreate(o,true);var n=UWA.is(o.type,"object")?o.type["displayName"]:o.type;var p=n+" "+o.name+" "+o.revision;var r=g.Requirement_Notif_ObjectCreated;r=r.replace("{TNR}",p);d._displayMessage(i,r,"success")},onFailure:function(o,n){if(UWA.is(o,"string")){try{o=JSON.parse(n)}catch(p){}}if(UWA.is(n,"string")){try{n=JSON.parse(n)}catch(p){}}if(UWA.is(n)&&UWA.is(n.message,"string")){d._displayMessage(i,n.message,"error")}else{if(UWA.is(o)&&UWA.is(o.message,"string")){d._displayMessage(i,o.message,"error")}else{if(UWA.is(o,"string")){d._displayMessage(i,o,"error")}else{console.error('"RequirementWebServices.create(...)" failed without returning an error message!')}}}},onTimeout:function(){d._displayMessage(i,g.Requirement_Notif_RequestTimeout,"error")}})},onFailure:function(l){d._displayMessage(i,g.Requirement_Notif_RequestTimeout,"error")}});d.end()})}});return b});if(require.toUrl("DS/VENREQPlugins/Fancytree").indexOf("latest")===-1){var lFancytreePath=require.toUrl("DS/VENREQPlugins/External/fancytree/latest/media/");var lIndexOfQuestionMark=lFancytreePath.indexOf("?");if(lIndexOfQuestionMark>-1){lFancytreePath=lFancytreePath.substring(0,lIndexOfQuestionMark)}require.config({paths:{"DS/VENREQPlugins/Fancytree":lFancytreePath+"jquery.fancytree-all.min"},shim:{"DS/VENREQPlugins/Fancytree":{deps:["DS/TraceableRequirementsUtils/jQueryUI","DS/TraceableRequirementsUtils/jQuery"],exports:"jQuery.ui.fancytree"}}})}define("DS/TraceableRequirementsUtils/Fancytree",["DS/VENREQPlugins/Fancytree"],function(a){return a});define("DS/TraceableRequirementsUtils/Command/ActionBar_LaunchWebAppCmd",["DS/ApplicationFrame/Command","UWA/Utils/InterCom"],function(a,b){var c=a.extend({init:function(d){this._parent(d,{isAsynchronous:true});this.socketName="selection_socket_"+widget.id;this.socket=new b.Socket(this.socketName,{dispatchRetryInterval:5});this.socket.subscribeServer("com.ds.compass",window.parent)},beginExecute:function(){},execute:function(){var d=this;function e(f){if((f.appId==="ENOREQL_AP")&&(f.widgetId===widget.id)){console.log(f.response)}}require(["DS/i3DXCompassServices/i3DXCompassPubSub","DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Utils"],function(g,j,h){var k={appId:"ENOREQL_AP",widgetId:widget.id};var f=undefined;if(UWA.is(j.get().getSelectedElement())){f=j.get().getSelectedElement().physicalid}var i=h.getSecurityContext();g.publish("setObject",{objectId:f,contextId:i});g.subscribe("launchAppCallback",e);g.publish("launchApp",k)})},endExecute:function(){}});return c});define("DS/TraceableRequirementsUtils/REQCommandProxy",["text!DS/TraceableRequirementsUtils/assets/RequirementCommandProxyResources.json","UWA/Core","UWA/Class","DS/PlatformAPI/PlatformAPI","DS/Logger/Logger"],function(f,i,b,k,c){var j={},d=JSON.parse(f);for(var l in d){if(d.hasOwnProperty(l)){var o=p(l);d[l].callback=o;j[o]=l}}function h(){return(((1+Math.random())*65536)|0).toString(16).substring(1)}function q(){var r="/no_private_channel";if(typeof widget!=="undefined"&&widget!==null){if(widget.getValue("x3dSharedId")!==undefined){r="/"+widget.getValue("x3dSharedId")}else{if(widget.getValue("x3dAppId")!==undefined){r="/"+widget.getValue("x3dAppId")}else{if(widget.getValue("appId")!==undefined){r="/"+widget.getValue("appId")+"_"+widget.id}}}}return r}function n(r,t,s){return{metadata:{uid:h(),originUid:r,timestamp:Date.now(),appid:q(),originWidgetId:typeof s!=="undefined"?s:typeof widget!=="undefined"&&widget!==null?widget.id:r},data:t}}function p(r){return"on"+r.charAt(0).toUpperCase()+r.slice(1)}function e(s){var r="DS/TraceableRequirementsUtils/REQCommandProxy/"+s;if(UWA.is(d[s])&&d[s]["private"]===true){r=r+q()}return r}var m=b.extend({init:function(s,t,r){this.ownerProxyUid=s;this.eventHandlingFunction=t;this.ignoreMyEvents=r},handleEvent:function(s){var r=Date.now();if(i.debug){c.debug("Event received at %d, %dms after event creation",r,r-s.metadata.timestamp);c.debug("    %o",s.metadata)}if(this.ignoreMyEvents===true&&s.metadata.originUid===this.ownerProxyUid){if(i.debug){c.debug("Ignoring this event (sent by me)")}}else{try{this.eventHandlingFunction(s.data,s.metadata)}catch(t){c.error("Error while handling event %o",s);c.error(t)}}}});var g=b.extend({init:function(r){this.uid=h();this.subscriptions=[];if(i.debug){c.debug("Creating proxy %s",this.uid)}this.addProxyEvents(r)},addProxyEvents:function(z){if(z){for(var w in z){var u=j[w];if(u){var t=z[w];if(typeof t==="function"||(Array.isArray(t)&&t.length>0&&typeof t[0]==="function")){var s;var x=true;if(typeof t==="function"){s=t}else{s=t[0];x=(t.length<2||t[1]!==false)}var r=new m(this.uid,s,x);var v=e(u);if(i.debug){c.debug("Subscribing to topic [%s]",v)}var y=k.subscribe(v,r.handleEvent.bind(r));this.subscriptions.push(y)}else{c.warn("Input [events.%s] is not a function",w)}}else{c.info("Input [events.%s] is not a known event",w)}}}},destroy:function(){if(i.debug){c.debug("Destroying proxy [%s]",this.uid)}if(this.subscriptions){if(i.debug){c.debug("Unsubcribing")}this.subscriptions.forEach(function(r){k.unsubscribe(r)});delete this.subscriptions}this.destroyed=true}});g.prototype._publish=function(s,u){if(this.destroyed===true){throw new Error("This proxy has been destroyed")}var r=e(s);var t=n(this.uid,u,this.odtWidgetId);if(i.debug){c.debug("Publishing to topic [%s]",r);c.debug("\t%o",t)}k.publish(r,t)};for(var a in d){if(d.hasOwnProperty(a)){g.prototype[a]=(function(r){return function(s){this._publish(r,s)}}(a))}}g.create=function(r){var s;if(r){s=r.events}return new g(s)};g.appId=function(){return q()};return g});if(typeof jQuery!=="undefined"&&typeof jQuery.ui!=="undefined"){define("DS/TraceableRequirementsUtils/jQueryUI",function(){return jQuery.ui})}else{if(require.toUrl("DS/VENENO6WPlugins/jQueryUI").indexOf("latest")===-1){var lJQueryUIPath=require.toUrl("DS/VENENO6WPlugins/plugins/jqueryui/latest/js/");var lIndexOfQuestionMark=lJQueryUIPath.indexOf("?");if(lIndexOfQuestionMark>-1){lJQueryUIPath=lJQueryUIPath.substring(0,lIndexOfQuestionMark)}require.config({paths:{"DS/VENENO6WPlugins/jQueryUI":lJQueryUIPath+"jquery.ui.custom.min"},shim:{"DS/VENENO6WPlugins/jQueryUI":{deps:["DS/TraceableRequirementsUtils/jQuery"],exports:"jQuery.ui"}}})}}define("DS/TraceableRequirementsUtils/jQueryUI",["DS/VENENO6WPlugins/jQueryUI"],function(a){return a});define("DS/TraceableRequirementsUtils/Command/ActionBar_DetachCmd",["DS/TraceableRequirementsUtils/Command/ReqCmdBase","DS/Logger/Logger"],function(b,a){var c=b.extend({name:"REQ_ACTION_BAR",_logger:null,init:function(d){this._logger=a.getLogger(c);this._parent(d,{isAsynchronous:true});this._options=d},_displayMessage:function(d,e,f){if(UWA.is(d.displayNotification)){d.displayNotification({eventId:f,msg:e})}else{alert(e)}},beginExecute:function(){var d=this;require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(j,l,e,f){var i=j.get();var h=i.getSelectedElement();if(UWA.is(h)){var m=h.path;if(!UWA.is(m)||!UWA.is(m.length)||m.length===1){i.displayNotification({eventID:"warning",msg:f.Requirement_Notif_RootSelection})}else{var k=m[m.length-1];var g=m[m.length-2];l.detach({securityContext:e.getSecurityContext(),json:{relationship_physical_ids:[g]},onComplete:function(o){var n=UWA.is(o,"string")?JSON.parse(o):o;d._logger.log("WS detach.onComplete");if(!UWA.is(n.PhysicalDelete)||(UWA.is(n.PhysicalDelete)&&n.PhysicalDelete)){i.refreshOnRemove(h,true)}d._displayMessage(i,f.Requirement_Notif_DetachSuccess,"success")},onFailure:function(n){d._logger.log("WS detach.onFailure");n=UWA.is(n,"string")?JSON.parse(n):n;d._displayMessage(i,n.message,"error")},onTimeout:function(){d._logger.warn("WS detach.onTimeout");d._displayMessage(i,f.Requirement_Notif_RequestTimeout,"error")}})}""}else{i.displayNotification({eventID:"warning",msg:f.Requirement_Notif_ObjectSelection})}d.end()})}});return c});define("DS/TraceableRequirementsUtils/Command/ActionBar_InsertExternalObject",["UWA/Core","DS/Logger/Logger","DS/TraceableRequirementsUtils/Command/ReqCmdBase","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json"],function(f,a,b,e,d){var c=b.extend({name:"REQ_ACTION_BAR",_logger:null,_options:null,init:function(g){this._logger=a.getLogger(c);this._options=g;this._parent(g,{mode:"exclusive",isAsynchronous:false});this._relPattern=JSON.parse(d)},beginExecute:function(){this._logger.log(this._id+".beginExecute")},execute:function(){var i=this,h="";var g=i._options.arguments[2].operation;if(g==="selectionDialog"){h=e.InsertExistExtReq}else{h=e.InsertNewExtReq}if(widget.id!="enopad_odt_wgd"||widget.id!="dummy"){try{require(["DS/LifecycleCmd/OSLCConsumerCmd","DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/ApplicationFrame/CommandsManager"],function(o,q,p,k,m){var n=q.get();var l=m.getCommand("OSLCConsumerHdr",n.options.action_bar_opts&&n.options.action_bar_opts.context?n.options.action_bar_opts.context:null);l.setup({title:h,resourceType:"http://open-services.net/ns/rm#Requirement",operation:g,proxyType:"Requirement Proxy",providerFilter:"RM",securityContext:p.getSecurityContext(),tenantId:p.getTenant(),singleObject:true,notification:function(s){if(UWA.is(s.error)){n.displayNotification({eventID:"error",msg:s.error});return}if(!UWA.is(s.objects,"array")){return}if(s.objects.length===0){console.log("result:");console.log(s);return}var v=n.getSelectedElement();var y=v.physicalid;var x=v.type;var t=v.kindof;var u=s.objects[0].proxy.id;var w=i._options.arguments[1].relType;if(UWA.is(w)){var r=null;if(UWA.is(n.authoring)&&UWA.is(n.authoring.placeholder)&&w!="Derived Requirement"){v.position="over";v.content="";v.fetchContent=true;v.target={element:v.element,id:UWA.is(v.element)?v.element.attr("id"):""};r=n.authoring.placeholder(v)}k.insertExisting({securityContext:p.getSecurityContext(),json:{pid:y,id:u,relationship:w,previousSibling:{},nextSibling:{}},onComplete:function(E){i._logger.log("WS insertExisting.onComplete");var C=UWA.is(E,"string")?JSON.parse(E):E;var A=C.results;var z=UWA.is(A.type,"object")?A.type["displayName"]:A.type;var B=z+" "+A.name+" "+A.revision;var D=e.Requirement_Notif_ObjectCreated;D=D.replace("{TNR}",B);n.displayNotification({eventID:"success",msg:D});if(w==="Derived Requirement"){return}n.refreshOnInsert(A,r,"insertExisting")},onFailure:function(z){i._logger.log("WS insertExisting.onFailure");if(UWA.is(r)){r.placeholder.container.remove()}z=UWA.is(z,"string")?JSON.parse(z):z;n.displayNotification({eventID:"error",msg:z.message})},onTimeout:function(){i._logger.warn("WS insertExisting.onTimeout");if(UWA.is(r)){r.placeholder.container.remove()}n.displayNotification({eventID:"error",msg:e.Requirement_Notif_RequestTimeout})}})}}});l.execute()})}catch(j){console.log("DS/OSLCConsumer/OSLCConsumer file not found")}}},endExecute:function(){this._logger.log(this._id+".endExecute")}});return c});define("DS/TraceableRequirementsUtils/Command/ActionBar_ReplaceByNewVersion",["DS/TraceableRequirementsUtils/Command/ReqCmdBase","DS/Logger/Logger"],function(b,a){var c=b.extend({name:"REQ_ACTION_BAR",_logger:null,init:function(d){this._logger=a.getLogger(c);this._parent(d,{isAsynchronous:true});this._options=d},_displayMessage:function(d,e,f){if(UWA.is(d.displayNotification)){d.displayNotification({eventId:f,msg:e})}else{alert(e)}},beginExecute:function(){var d=this;require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(o,p,e,f){var n=o.get();var t={};var g=false,r;var l=n.getSelectedNodes();if(l.length>1){for(var m=l.length-1;m>0;m--){for(var k=0;k<m;k++){if(l[k+1].getOccurencePath().length<l[k].getOccurencePath().length){var s=l[k];l[k]=l[k+1];l[k+1]=s}}}}if(UWA.is(l)&&l.length>0){var q=[];for(var m=0;m<l.length;m++){var u=l[m].getOccurencePath();if(l[m].isRoot()){g=true}r=n.getReqSpecRoot(l[m]);var h={object_id:u[u.length-1],rel_id:u[u.length-2],parent_id:r};q.push(h)}if(g){d._displayMessage(n,f.Requirement_Headers_ReviseRoot,"warning");return}if(r==null){d._displayMessage(n,f.Requirement_Headers_ReviseRoot,"warning");return}t={objects_to_revise:q,revise_mode:d._options.arguments[0].Type};p.replaceByNewLatestRevision({securityContext:e.getSecurityContext(),json:t,onComplete:function(i){d._logger.log("WS Revise.onComplete");d._displayMessage(n,f[d._options.arguments[0].Type+".Requirement_Headers_Revise"],"success");var w=o.get();var j=UWA.is(i,"string")?JSON.parse(i):i;if(j.status==="success"){var v=j.results;w.refreshOnRevise(v)}},onFailure:function(j,i){var v=j.message;i=UWA.is(i,"string")?JSON.parse(i):i;if(UWA.is(i.message)){v=UWA.is(f[i.message])?f[i.message]:i.message}d._displayMessage(n,v,"error")},onTimeout:function(){d._logger.warn("WS detach.onTimeout");d._displayMessage(n,f.Requirement_Notif_RequestTimeout,"error")}});""}else{n.displayNotification({eventID:"warning",msg:f.Requirement_Notif_ObjectSelection})}d.end()})}});return c});define("DS/TraceableRequirementsUtils/Command/ActionBar_AddNewCmd",["DS/TraceableRequirementsUtils/Command/ReqCmdBase","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json",],function(a,c){var b=a.extend({init:function(d){this._parent(d,{isAsynchronous:true});this._options=d;this._relPattern=JSON.parse(c);this._promisesData=[];this._promises=[]},_displayMessage:function(d,e,f){if(UWA.is(d.displayNotification)){d.displayNotification({eventID:f,msg:e})}else{alert(e)}},beginExecute:function(){var d=this;require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(q,i,u,w){var j=q.get();var m=true;var g,h,s,k,l,e=undefined,o,n,p=null,r=null;var t=d._options.arguments[0].Type;var f=t;if(UWA.is(j.getDefaultType)){f=j.getDefaultType(f)}var v=null;if(UWA.is(j.getToAddSelectedElement)){v=j.getToAddSelectedElement();if(v==null){d._displayMessage(j,w.Requirement_Notif_MutliSelection,"warning");return}g=v.physicalid;h=v.element;s=v.type;k=v.kindof;o=v.previousSibling;n=v.nextSibling;if(UWA.is(v.previousNode)&&v.previousNode!=null){p=v.previousNode}}else{if(UWA.is(j.authoring)&&UWA.is(j.authoring.placeholder)){v=j.getSelectedElement();g=v.physicalid;h=v.element;s=v.type;k=v.kindof;var r=null;v.position="after";v.content="";v.target={element:h,id:UWA.is(h)?h.attr("id"):""};r=j.authoring.placeholder(v);g=r.parent.objectId;s=r.parent.type;o=r.previousSibling;n=r.nextSibling;k=r.parent.kindof}else{d._displayMessage(j,w.Requirement_Notif_CmdNotAvailable,"error")}}l=d._relPattern[k]||d._relPattern[s];e=null;if(!UWA.is(l)){m=false;d._displayMessage(j,w.Requirement_Notif_CmdNotAvailable,"error")}else{e=l[t];if(!UWA.is(e)){m=false;d._displayMessage(j,w.Requirement_Notif_CmdNotAvailable,"error")}}if(m){i.insertNew({securityContext:u.getSecurityContext(),type:f,json:{pid:g,relationship:e,previousSibling:o,nextSibling:n,attributes:[]},onComplete:function(C){var A=UWA.is(C,"string")?JSON.parse(C):C;var y=A.results;if(UWA.is(j.refreshOnInsertSibling)){j.refreshOnInsertSibling(y,r,p)}else{j.refreshOnInsert(y,r,null)}var x=UWA.is(y.type,"object")?y.type["displayName"]:y.type;var z=x+" "+y.name+" "+y.revision;var B=w.Requirement_Notif_ObjectCreated;B=B.replace("{TNR}",z);d._displayMessage(j,B,"success")},onFailure:function(y,x){if(UWA.is(r)){r.placeholder.container.remove()}if(UWA.is(y,"string")){try{y=JSON.parse(x)}catch(z){}}if(UWA.is(x,"string")){try{x=JSON.parse(x)}catch(z){}}if(UWA.is(x)&&UWA.is(x.message,"string")){d._displayMessage(j,x.message,"error")}else{if(UWA.is(y)&&UWA.is(y.message,"string")){d._displayMessage(j,y.message,"error")}else{if(UWA.is(y,"string")){d._displayMessage(j,y,"error")}else{console.error('"RequirementWebServices.insertNew(...)" failed without returning an error message!')}}}},onTimeout:function(){if(UWA.is(r)){r.placeholder.container.remove()}d._displayMessage(j,w.Requirement_Notif_RequestTimeout,"error")}})}d.end()})}});return b});define("DS/TraceableRequirementsUtils/Command/ActionBar_InsertExistingCmd",["UWA/Core","DS/Logger/Logger","DS/TraceableRequirementsUtils/Command/ReqCmdBase","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json"],function(f,a,b,e,d){var c=b.extend({name:"REQ_ACTION_BAR",_logger:null,_options:null,init:function(g){this._logger=a.getLogger(c);this._options=g;this._parent(g,{mode:"exclusive",isAsynchronous:false});this._relPattern=JSON.parse(d)},beginExecute:function(){this._logger.log(this._id+".beginExecute")},execute:function(){this._logger.log(this._id+".execute");var g=this;require(["DS/PADUtils/PADContext","DS/PADUtils/views/PADModalChooser"],function(s,z){var y=function(i){new z({renderTo:document.body,position:"above_action_bar",in_apps_search:{multiSel:false,in_apps_callback:g._onSelectionDone.bind(g),precond:i}})};var l=s.get();var q="";var h,k,v,m=null;var n=false;var w,x;var t=l.getSelectedElement();if(UWA.is(t)){var o=t.type;var j=t.kindof;var p=g._relPattern[j]||g._relPattern[o];if(UWA.is(p)){var r=Object.keys(p);if(g._options.arguments.length>0&&g._options.arguments[0].Type){w=g._options.arguments[0].Type;if(r.indexOf(w)>-1){x='flattenedtaxonomies:"types/'+w+'"';y(x)}else{l.displayNotification({eventID:"warning",msg:e.Requirement_Notif_CmdNotAvailable})}}else{r.pop("Root");x="(";for(var u=0;u<r.length;u++){if(u===0){x+='flattenedtaxonomies:"types/'+r[u]+'"'}else{x+=' OR flattenedtaxonomies:"types/'+r[u]+'"'}}x+=")";y(x)}}else{l.displayNotification({eventID:"warning",msg:e.Requirement_Notif_CmdNotAvailable})}}else{l.displayNotification({eventID:"warning",msg:e.Requirement_Notif_ObjectSelection})}})},endExecute:function(){this._logger.log(this._id+".endExecute")},_onSelectionDone:function(h){var g=this;require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices"],function(o,p,q){var i=o.get();var m=i.getSelectedElement();var l=m.physicalid;var r=m.type;var k=m.kindof;var n=g._relPattern[r]||g._relPattern[k];var j=h[0].resourceid;q.getKindOf({securityContext:p.getSecurityContext(),pid:j,onComplete:function(v){var u=UWA.is(v,"string")?JSON.parse(v):v;var t=u.results;var w=n[t];if(UWA.is(w)){var s=null;if(UWA.is(i.authoring)&&UWA.is(i.authoring.placeholder)){m.position="over";m.content="";m.fetchContent=true;m.target={element:m.element,id:UWA.is(m.element)?m.element.attr("id"):""};s=i.authoring.placeholder(m)}q.insertExisting({securityContext:p.getSecurityContext(),json:{pid:l,id:j,relationship:w,previousSibling:{},nextSibling:{}},onComplete:function(C){g._logger.log("WS insertExisting.onComplete");var A=UWA.is(C,"string")?JSON.parse(C):C;var y=A.results;i.refreshOnInsert(y,s,"insertExisting");var x=UWA.is(y.type,"object")?y.type["displayName"]:y.type;var z=x+" "+y.name+" "+y.revision;var B=e.Requirement_Notif_ObjectCreated;B=B.replace("{TNR}",z);i.displayNotification({eventID:"success",msg:B})},onFailure:function(x){g._logger.log("WS insertExisting.onFailure");if(UWA.is(s)){s.placeholder.container.remove()}x=UWA.is(x,"string")?JSON.parse(x):x;i.displayNotification({eventID:"error",msg:x.message})},onTimeout:function(){g._logger.warn("WS insertExisting.onTimeout");if(UWA.is(s)){s.placeholder.container.remove()}i.displayNotification({eventID:"error",msg:e.Requirement_Notif_RequestTimeout})}})}},onFailure:function(s){g._logger.warn("WS getKindof.onFailure");i.displayNotification({eventID:"warning",msg:s})}})})}});return c});define("DS/TraceableRequirementsUtils/Command/ActionBar_InsertNewCmd",["DS/TraceableRequirementsUtils/Command/ReqCmdBase","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json",],function(a,c){var b=a.extend({init:function(d){this._parent(d,{isAsynchronous:true});this._options=d;this._relPattern=JSON.parse(c);this._promisesData=[];this._promises=[]},_displayMessage:function(d,e,f){if(UWA.is(d.displayNotification)){d.displayNotification({eventID:f,msg:e})}else{alert(e)}},beginExecute:function(){var d=this;require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(o,q,e,f){var l=o.get();var t=true;var p,j,s,r,n,m=undefined;var i=d._options.arguments[0].Type;var k=i;if(UWA.is(l.getDefaultType)){k=l.getDefaultType(k)}var h=l.getSelectedElement();if(UWA.is(h)){p=h.physicalid;j=h.element;s=h.type;r=h.kindof;n=d._relPattern[r]||d._relPattern[s];m=null;if(!UWA.is(n)){t=false;d._displayMessage(l,f.Requirement_Notif_CmdNotAvailable,"error")}else{m=n[i];if(!UWA.is(m)){t=false;d._displayMessage(l,f.Requirement_Notif_CmdNotAvailable,"error")}}}else{d._displayMessage(l,f.Requirement_Notif_ObjectSelection,"warning");t=false}if(t){var g=null;if(UWA.is(l.authoring)&&UWA.is(l.authoring.placeholder)){h.position="over";h.content="";h.target={element:j,id:UWA.is(j)?j.attr("id"):""};g=l.authoring.placeholder(h)}q.insertNew({securityContext:e.getSecurityContext(),type:k,json:{pid:p,relationship:m,previousSibling:{},nextSibling:{},attributes:[]},onComplete:function(z){var x=UWA.is(z,"string")?JSON.parse(z):z;var v=x.results;l.refreshOnInsert(v,g,null);var u=UWA.is(v.type,"object")?v.type["displayName"]:v.type;var w=u+" "+v.name+" "+v.revision;var y=f.Requirement_Notif_ObjectCreated;y=y.replace("{TNR}",w);d._displayMessage(l,y,"success")},onFailure:function(v,u){if(UWA.is(g)){g.placeholder.container.remove()}if(UWA.is(v,"string")){try{v=JSON.parse(u)}catch(w){}}if(UWA.is(u,"string")){try{u=JSON.parse(u)}catch(w){}}if(UWA.is(u)&&UWA.is(u.message,"string")&&u.message.indexOf("No fromconnect access to business object")>-1&&u.message.indexOf("1500028")>-1){d._displayMessage(l,f.get("Requirement_Notif_SourceReleasedOrObsolete"),"error")}else{if(UWA.is(u)&&UWA.is(u.message,"string")){d._displayMessage(l,u.message,"error")}else{if(UWA.is(v)&&UWA.is(v.message,"string")){d._displayMessage(l,v.message,"error")}else{if(UWA.is(v,"string")){d._displayMessage(l,v,"error")}else{console.error('"RequirementWebServices.insertNew(...)" failed without returning an error message!')}}}}},onTimeout:function(){if(UWA.is(g)){g.placeholder.container.remove()}d._displayMessage(l,f.Requirement_Notif_RequestTimeout,"error")}})}d.end()})}});return b});define("DS/TraceableRequirementsUtils/Utils",["UWA/Core","DS/Logger/Logger","DS/TraceableRequirementsUtils/jQuery","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","UWA/Utils/Client"],function(h,c,k,a,e){var i=c.getLogger("DS/TraceableRequirementsUtils/Utils"),g,l,j,d=function(n,m){if(!this.channels[n]){this.channels[n]=[]}this.channels[n].push({context:this,callback:m});return this},b=function(q){if(!this.channels[q]){return false}var n=Array.prototype.slice.call(arguments,1);for(var o=0,m=this.channels[q].length;o<m;o++){var p=this.channels[q][o];p.callback.apply(p.context,n)}return this};var f={mediator:{channels:{},publish:b,subscribe:d,installTo:function(m){m.channels={};m.subscribe=d;m.publish=b}},getSecurityContext:function(){var m=widget.getValue("trm_security_ctx");if(widget.defaultData!=undefined){if((widget.defaultData.pad_security_ctx===undefined||widget.defaultData.pad_security_ctx==="")||(widget.defaultData.trm_security_ctx===undefined||widget.defaultData.trm_security_ctx==="")){return undefined}}if(!UWA.is(m)||m===""){m=widget.getValue("pad_security_ctx");if(m===""){return undefined}}if(UWA.is(m,"string")&&m.indexOf("ctx::")===-1){m="ctx::"+m}return m},getTenant:function(){var m=widget.getValue("req_tenant");if(!UWA.is(m)){m=widget.getValue("x3dPlatformId")}if(!UWA.is(m)){return undefined}if(UWA.is(m.value)){return m.value}else{return m}},computeDisplayName:function(n,w){var t=n.name;var r=JSON.parse(w);var o=(r.treeDisplayName);var u=(r.treeDisplayTitle);var p=(r.treeDisplayRevision);var m=(r.treeDisplaySeperation);var v=(r.treeDisplayTitleMaxSize);v=Math.floor(v);var s=n.title;var q="  ";if(m!==""&&m!=="false"){q=" | "}if((o!=="false"&&o!=="")&&(u!=="false"&&u!=="")&&s.length!==0){t=n.name+q+s}if((o==="false"||o==="")&&(u!=="false"&&u!=="")&&s.length!==0){t=s}if(p!="false"&&p!=""){t+=q+n.revision}if((o==="false"||o==="")&&(u==="false"||u==="")&&(p==="false"||p==="")){t=s+" "+n.revision}return t},app_initialization:function(m){i.log("app_initialization");if(!UWA.is(m,"function")){throw new Error("Invalid callback for the REQ app initialization")}a.getPlatformServices({onComplete:function(n){g=n;m.call(null)},onFailure:function(n){i.error("Cannot retrieve the Platform Services");throw new Error("Cannot retrieve the Platform Services")}})},getTenant3DSpaceUrl:function(o){var m=0;for(var n=0;n<g.length;n++){if(g[n].platformId===o){m=n}}return g[m]["3DSpace"]},get3DSpaceUrl:function(){if(!UWA.is(g,"array")){throw new Error("Platform services not initialize yet")}var m=this.getTenantIndex();return g[m]["3DSpace"]},getTenantIndex:function(){var o=this.getTenant(),p=false;if(UWA.is(o)){var m=o;if(!UWA.is(j)||g[j].displayName!==m){for(var n=0;n<g.length&&!p;n++){if(g[n].platformId===m){j=n;p=true}}if(!UWA.is(j)){j=0}}}return j},setTenantIndex:function(n){var m=n;if(g[j].displayName!==m){for(var o=0;o<g.length;o++){if(g[o].platformId===m){j=o}}}},getPlatformServices:function(){if(!UWA.is(g,"array")){throw new Error("Platform services not initialize yet")}return g},getLanguage:function(){var m;if(widget&&widget.lang){m=widget.lang}else{var n=(navigator?(navigator.language||navigator.systemLanguage):"en");m=n.toLowerCase().split("-")[0]}return m},isOnCloud:function(){var m=this.getTenant();if(UWA.is(m)&&m!=="OnPremise"){return true}return false},isIpad:function(){return e.Platform.ipad},isAndroid:function(){return e.Platform.android},isSurface:function(){return(e.Platform.tablet&&(e.Platform.win32||e.Platform.win64))},isMobile:function(){return this.isIpad()||this.isAndroid()||this.isSurface()}};return f});define("DS/TraceableRequirementsUtils/Services/RichContentObjectServices",["UWA/Drivers/Alone","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/WAFData/WAFData","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADContext","DS/Logger/Logger"],function(g,f,d,h,k,i,b,e,a){var c=null;var j=d.extend(h,k,{name:"RichContentObjectServices",defaultOptions:{url:null,parallelUploads:2,uploadMultiple:false,maxFilesize:256,paramName:"file",createImageThumbnails:true,maxThumbnailFilesize:10,thumbnailWidth:100,thumbnailHeight:100,maxFiles:null,params:{},ignoreHiddenFiles:true,autoProcessQueue:true,addRemoveLinks:false,previewsContainer:null,accept:function(m,l){return l()}},init:function(l){c=this;this.options=UWA.merge(this.defaultOptions,l||{})},checkinFiles:function(A){var q={};var n=b.get3DSpaceUrl()+"/resources/richeditor/res/checkinRCO";var p=A.physicalid;n+="?objectId="+p;if(!UWA.is(A.callbacks.onComplete,"function")){throw new Error("No onComplete callback function defined")}if(!UWA.is(A.callbacks.onTimeout,"function")){throw new Error("No onTimeout callback function defined")}if(!UWA.is(A.callbacks.onFailure,"function")){throw new Error("No onFailure callback function defined")}var u=A.callbacks.onComplete;q.onComplete=function(B){u(B,A)};var w=A.callbacks.onTimeout;q.onTimeout=function(B){w(B,A)};var r=A.callbacks.onFailure;q.onFailure=function(B){r(B,A)};var m=A.files;if(m&&m.length){q.method="POST";q.headers={Accept:"application/json","Cache-Control":"no-cache"};q.timeout=4*60000;var o=e.get();if(UWA.is(o)&&UWA.is(o.getCSRF)){var l=o.getCSRF();var y=Object.keys(l);var v=y[0];var x=l[v];var z=l[x];n+="&"+v+"="+x+"&"+x+"="+z}var t=m[0];var s=new FormData();s.append("file",t,t.name);q.data=s;i.authenticatedRequest(n,q)}}});return j});define("DS/TraceableRequirementsUtils/Command/ActionBar_DownloadMSAddin",["DS/ApplicationFrame/Command","DS/TraceableRequirementsUtils/Utils"],function(a,c){var b=null;var d=a.extend({init:function(e){b=this;this._parent(e,{isAsynchronous:true});this.path="/requirements/ENOVIA_RMCInstaller.zip";if(c.isOnCloud()===true||c.isMobile()===true){this.disable()}},beginExecute:function(){},execute:function(){b=this;var e=c.get3DSpaceUrl()+b.path;window.open(e)},endExecute:function(){}});return d});define("DS/TraceableRequirementsUtils/Services/RequirementTenantMgt",["UWA/Class","UWA/Class/Events","DS/Logger/Logger","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(c,a,b,f,e,d){var g=c.singleton(a,{name:"RequirementTenantMgt",options:{},_preferences_added:false,_logger:null,init:function(){this._logger=b.getLogger(g)},addTenant2Preferences:function(h){this._logger.log("addTenant2Preferences");if(!UWA.is(widget)){throw new Error("widget variable isn't defined")}if(h!==undefined&&h.events!==undefined){this.addEvents(h.events)}if(this._preferences_added===false){this._logger.log("add tenant information to the widget preferences");widget.mergePreferences([{name:"req_tenant",type:"list",label:d.trm_Tenant,defaultValue:""}]);this._logger.log("Fill the values");this._fillPreferences();this._preferences_added=true}},_fillPreferences:function(){this._logger.log("_fillPreferences");var i=this;if(widget===undefined){throw new Error("widget variable isn't defined")}var j=[];var h=e.getPlatformServices();h.forEach(function(k){j.push({label:k.displayName,value:k.platformId})});i._update_req_tenant_pref(j)},_update_req_tenant_pref:function(m){var k=this,l=false,j=widget.getValue("req_tenant")?widget.getValue("req_tenant"):m[0];if(widget.getValue("req_tenant")===""){var h=widget.getValue("x3dPlatformId");for(var i=0;i<m.length&&!l;i++){if(m[i].value===h){j=m[i];l=true}}}if(UWA.is(m)&&m.length>0){widget.addPreference({name:"req_tenant",type:"list",label:d.trm_Tenant,defaultValue:j,options:m,onchange:"onUpdateTenant"});widget.setValue("req_tenant",j);k.dispatchEvent("onUpdateTenant",j)}}});return g});define("DS/TraceableRequirementsUtils/Services/RequirementWebServices",["UWA/Core","DS/WAFData/WAFData","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADContext","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings"],function(e,i,h,g,b,a){var k=function(l,m){var n=h.getLanguage();if("zh"===n){n+="_CN"}l.timeout=1000000000;l.method="GET";l.headers.Accept="application/json";l.headers["Cache-Control"]="no-cache";l.headers["Content-Type"]="application/json";l.headers["Accept-Language"]=n;m=m.replace(/\[/g,"%5B");m=m.replace(/\]/g,"%5D");i.authenticatedRequest(m,l)};var j=function(l,m){a.isLogicalDeleteActive(function(n){try{b.oslcRequest(l.tenant,l.service,m,{method:"GET",onSuccess:l.onComplete,onError:l.onFailure})}catch(o){console.log("OauthRequest not found")}})};var f=function(l,m,o){var p=h.getLanguage();if("zh"===p){p+="_CN"}l.timeout=1000000000;l.method="POST";l.headers.Accept="application/json";l.headers["Content-Type"]="application/json";l.headers["Cache-Control"]="no-cache";l.headers["Accept-Language"]=p;var n=g.get();if(e.is(n)&&e.is(n.getCSRF)){o.csrf=n.getCSRF()}if(e.is(n)&&e.is(n.getAuthoringContextPID)){o.ChangeActionID=n.getAuthoringContextPID();if(o.ChangeActionID===null){o.ChangeActionID=""}}l.data=JSON.stringify(o);i.authenticatedRequest(m,l)};var d=function(l,m,o){var p=h.getLanguage();if("zh"===p){p+="_CN"}l.method="PUT";l.headers.Accept="application/json";l.headers["Content-Type"]="application/json";l.headers["Accept-Language"]=p;var n=g.get();if(e.is(n)&&e.is(n.getCSRF)){o.csrf=n.getCSRF()}if(e.is(n)&&e.is(n.getAuthoringContextPID)){o.ChangeActionID=n.getAuthoringContextPID()}l.data=JSON.stringify(o);i.authenticatedRequest(m,l)};var c={insertExisting:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RichViewWebService.insertExisting")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/authoring/model/structure/insertexisting";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;var o=n.json;f(l,m,o)}else{this.getsecuritycontext({onComplete:function(q){var p=e.is(q,"string")?JSON.parse(q):q;l.headers.SecurityContext=p.SecurityContext;var q=n.json;f(l,m,q)}})}},connect:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RichViewWebService.connect")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/authoring/model/structure/insertexisting";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;var o=n.json;f(l,m,o)}else{this.getsecuritycontext({onComplete:function(q){var p=e.is(q,"string")?JSON.parse(q):q;l.headers.SecurityContext=p.SecurityContext;var q=n.json;f(l,m,q)}})}},insertNew:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RichViewWebService.insert")}if(!l.headers){l.headers={}}var o=n.type;var m=h.get3DSpaceUrl()+"/resources/trm/authoring/model/structure/"+o+"/insertnew";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;var p=n.json;f(l,m,p)}else{this.getsecuritycontext({onComplete:function(r){var q=e.is(r,"string")?JSON.parse(r):r;l.headers.SecurityContext=q.SecurityContext;var r=n.json;f(l,m,r)}})}},reorder:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RichViewWebService.reorder")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/authoring/model/structure/reorder";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;var o=n.json;f(l,m,o)}else{this.getsecuritycontext({onComplete:function(q){var p=e.is(q,"string")?JSON.parse(q):q;l.headers.SecurityContext=p.SecurityContext;var q=n.json;f(l,m,q)}})}},create:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RichViewWebService.create")}if(!l.headers){l.headers={}}var o=n.type;var m=h.get3DSpaceUrl()+"/resources/trm/authoring/model/"+o+"/create";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;var p=n.json;f(l,m,p)}else{this.getsecuritycontext({onComplete:function(r){var q=e.is(r,"string")?JSON.parse(r):r;l.headers.SecurityContext=q.SecurityContext;var r=n.json;f(l,m,r)}})}},edit:function(o){var m=o;if(!e.is(m,"object")){throw new Error("Invalid inputs for RichViewWebService.insert")}if(!m.headers){m.headers={}}var l=o.pid;var n=h.get3DSpaceUrl()+"/resources/trm/authoring/model/edit/"+l+"";if(e.is(o.securityContext)){m.headers.SecurityContext=o.securityContext;var p=o.json;d(m,n,p)}else{this.getsecuritycontext({onComplete:function(r){var q=e.is(r,"string")?JSON.parse(r):r;m.headers.SecurityContext=q.SecurityContext;var r=o.json;d(m,n,r)}})}},editRelationAttributes:function(o){console.log("function called");var m=o;if(!e.is(m,"object")){throw new Error("Invalid inputs for RichViewWebService.insert")}if(!m.headers){m.headers={}}var l=o.pid;var n=h.get3DSpaceUrl()+"/resources/trm/authoring/model/updateRelationAttr/"+l+"";if(e.is(o.securityContext)){m.headers.SecurityContext=o.securityContext;var p=o.json;console.log("in if");d(m,n,p)}else{this.getsecuritycontext({onComplete:function(r){var q=e.is(r,"string")?JSON.parse(r):r;m.headers.SecurityContext=q.SecurityContext;var r=o.json;console.log("in else");d(m,n,r)}})}},getRelStatusValues:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.getKindOf")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/rmt/get/browsing";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;var o=n.json;f(l,m,o)}else{this.getsecuritycontext({onComplete:function(q){var p=e.is(q,"string")?JSON.parse(q):q;l.headers.SecurityContext=p.SecurityContext;var q=n.json;f(l,m,q)}})}},getContent:function(o){var m=o;if(!e.is(m,"object")){throw new Error("Invalid inputs for RichViewWebService.insert")}if(!m.headers){m.headers={}}var l=o.pid;var n=h.get3DSpaceUrl()+"/resources/trm/browsing/model/content/"+l+"";if(e.is(o.securityContext)){m.headers.SecurityContext=o.securityContext;k(m,n)}else{this.getsecuritycontext({onComplete:function(q){var p=e.is(q,"string")?JSON.parse(q):q;m.headers.SecurityContext=p.SecurityContext;k(m,n)}})}},getHistory:function(o){var m=o;if(!e.is(m,"object")){throw new Error("Invalid inputs for RequirementWebServices.insert")}if(!m.headers){m.headers={}}var l=o.pid;var n=h.get3DSpaceUrl()+"/resources/trm/dictionary/history/"+l+"";if(e.is(o.securityContext)){m.headers.SecurityContext=o.securityContext;k(m,n)}else{this.getsecuritycontext({onComplete:function(q){var p=e.is(q,"string")?JSON.parse(q):q;m.headers.SecurityContext=p.SecurityContext;k(m,n)}})}},getsecuritycontext:function(n){var o=h.get3DSpaceUrl();var p=n.tenant;if(e.is(p)){o=h.getTenant3DSpaceUrl(p)}n.proxy="passport";var m=o+"/resources/pno/person/getsecuritycontext",l=n;if(!l.headers){l.headers={}}if(e.is(p)){m+="?tenant="+p}if(!e.is(m)||!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.getsecuritycontext")}k(l,m)},availablesecuritycontext:function(n){var o=h.get3DSpaceUrl();var p=n.tenant;if(e.is(p)){o=h.getTenant3DSpaceUrl(p)}n.proxy="passport";var m=o+"/resources/bps/cspaces",l=n;if(!l.headers){l.headers={}}if(e.is(p)){m+="?tenant="+p}if(!e.is(m)||!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.availablesecuritycontext")}k(l,m)},getInfo:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.getInfo")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/dictionary/info";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;m+="?pid="+n.pid;if(n.selectables!==undefined&&n.selectables!==null){m+="&select="+n.selectables}k(l,m)}else{this.getsecuritycontext({onComplete:function(p){var o=e.is(p,"string")?JSON.parse(p):p;l.headers.SecurityContext=o.SecurityContext;m+="?pid="+n.pid;if(n.selectables!==undefined&&n.selectables!==null){m+="&select="+n.selectables}k(l,m)}})}},getCustomTypes:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.getCustomTypes")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/browsing/model/custom/"+n.type;if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;k(l,m)}else{this.getsecuritycontext({onComplete:function(p){var o=e.is(p,"string")?JSON.parse(p):p;l.headers.SecurityContext=o.SecurityContext;k(l,m)}})}},getKindOf:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.getKindOf")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/browsing/model/"+n.pid+"/kindof";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;k(l,m)}else{this.getsecuritycontext({onComplete:function(p){var o=e.is(p,"string")?JSON.parse(p):p;l.headers.SecurityContext=o.SecurityContext;k(l,m)}})}},expand:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.getKindOf")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/browsing/model/expand";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;var o=n.json;f(l,m,o)}else{this.getsecuritycontext({onComplete:function(q){var p=e.is(q,"string")?JSON.parse(q):q;l.headers.SecurityContext=p.SecurityContext;var q=n.json;f(l,m,q)}})}},detach:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.detach")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/authoring/model/detach";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;var o=n.json;f(l,m,o)}else{this.getsecuritycontext({onComplete:function(q){var p=e.is(q,"string")?JSON.parse(q):q;l.headers.SecurityContext=p.SecurityContext;var q=n.json;f(l,m,q)}})}},replaceByNewLatestRevision:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.replaceByNewRevision")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/authoring/model/replacebynewlatestrevision";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;var o=n.json;f(l,m,o)}else{this.getsecuritycontext({onComplete:function(q){var p=e.is(q,"string")?JSON.parse(q):q;l.headers.SecurityContext=p.SecurityContext;var q=n.json;f(l,m,q)}})}},replaceByExistingRevision:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.replaceByExistingRevision")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/authoring/model/replacebyexisitngrevision";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;var o=n.json;f(l,m,o)}else{this.getsecuritycontext({onComplete:function(q){var p=e.is(q,"string")?JSON.parse(q):q;l.headers.SecurityContext=p.SecurityContext;var q=n.json;f(l,m,q)}})}},handlePasteEvent:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.handlePasteEvent")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/richeditor/res/htmlpreview?format=rtf";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;var o=n.json;f(l,m,o)}else{this.getsecuritycontext({onComplete:function(q){var p=e.is(q,"string")?JSON.parse(q):q;l.headers.SecurityContext=p.SecurityContext;var q=n.json;f(l,m,q)}})}},setsecuritycontext:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.setsecuritycontext")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/pno/person/setsecuritycontext";l.data=n.json;l.method="POST";l.proxy="passport";l.headers["Content-Type"]="application/x-www-form-urlencoded";i.proxifiedRequest(m,l)},getScopeInformation:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.getScopeInformation")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/syc/api/scope/v1/res"+n.scopeId;if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;k(l,m)}else{this.getsecuritycontext({onComplete:function(p){var o=e.is(p,"string")?JSON.parse(p):p;l.headers.SecurityContext=o.SecurityContext;k(l,m)}})}},getDisplayNamePref:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.getDisplayNamePref")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/res/preferences/displayname";l.async=n.async;l.responseType="text";if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;k(l,m)}else{this.getsecuritycontext({onComplete:function(p){var o=e.is(p,"string")?JSON.parse(p):p;l.headers.SecurityContext=o.SecurityContext;k(l,m)}})}},getStructureWithStreaming:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.getStructureWithStreaming")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/streaming/structure/"+n.id;if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;k(l,m)}else{this.getsecuritycontext({onComplete:function(p){var o=e.is(p,"string")?JSON.parse(p):p;l.headers.SecurityContext=o.SecurityContext;k(l,m)}})}},getContentWithStreaming:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.getContentWithStreaming")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/streaming/content/"+n.id;if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;k(l,m)}else{this.getsecuritycontext({onComplete:function(p){var o=e.is(p,"string")?JSON.parse(p):p;l.headers.SecurityContext=o.SecurityContext;k(l,m)}})}},htmlConvert:function(n){var l=e.merge(n||{},{responseType:"text",cache:false});if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/richeditor/res/HTMLConvert?objectId="+n.id;if(e.is(n.securityContext)){l.headers.SecurityContext=n.securityContext;k(l,m)}else{this.getsecuritycontext({onComplete:function(p){var o=e.is(p,"string")?JSON.parse(p):p;l.headers.SecurityContext=o.SecurityContext;k(l,m)}})}},getOSLCContent:function(n){var o=this;var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebServices.getContentWithStreaming")}if(!l.headers){l.headers={}}var m=n.doors_url;j(l,m)},getTRMExpressionValue:function(n){var m=n;if(!e.is(m,"object")){throw new Error("Invalid inputs for RequirementWebServices.getTRMTRCExpressionValue")}if(!m.headers){m.headers={}}var o=this;var l=function(){var q;if(e.is(n.expression,"string")){var r=n.expression;q=h.get3DSpaceUrl()+"/resources/trm/res/preferences/reqconfig/"+n.expression}else{console.error("Expression value not specified or not a String. Please specify the expression value to get in {options.expression}.");return}if(e.is(n.securityContext)){m.headers.SecurityContext=n.securityContext;k(m,q)}else{o.getsecuritycontext({onComplete:function(t){var s=e.is(t,"string")?JSON.parse(t):t;m.headers.SecurityContext=s.SecurityContext;k(m,q)}})}};try{h.get3DSpaceUrl();l()}catch(p){console.error(p);h.app_initialization(l)}},getTRCSessionInfo:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebService.getTRCSessionInfo")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/res/TRCSessionInfo";k(l,m)},setTRCSessionId:function(n){var l=n;if(!e.is(l,"object")){throw new Error("Invalid inputs for RequirementWebService.setTRCSessionId")}if(!l.headers){l.headers={}}var m=h.get3DSpaceUrl()+"/resources/trm/res/TRCSessionId";var o=n.json;f(l,m,o)}};return c});define("DS/TraceableRequirementsUtils/Services/RequirementUserPrefrences",["UWA/Core","UWA/Controls/Abstract","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/Logger/Logger"],function(k,h,m,l,b){var d=null,i=null;var f=b.getLogger(c);var g=null;try{g=l.getPlatformServices();n(false)}catch(j){g=null;l.app_initialization(function(){n(false)})}function n(e){if(!UWA.is(e)){e=false}if(i===null){i=sessionStorage.getItem("RMTPreferredDisplayName");i=UWA.is(i,"string")?JSON.parse(i):i;if(i===null){m.getDisplayNamePref({async:!e,onComplete:function(o){o=UWA.is(o,"string")?JSON.parse(o):o;i=o.results;sessionStorage.setItem("RMTPreferredDisplayName",JSON.stringify(i))},onFailure:function(o){f.log(o.message)},onTimeout:function(){f.log("WS timeout")}})}}return i}function a(){try{return n(true)}catch(o){}return undefined}var c=h.extend({init:function(){d=this;this._logger=f},getDisplayNamePref:a});return c});define("DS/TraceableRequirementsUtils/Services/RequirementTypeMgt",["UWA/Class","UWA/Class/Events","DS/Logger/Logger","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADContext","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(d,b,c,a,f,g,e){var h=d.singleton(b,{name:"RequirementTypeMgt",options:{},_preferences_added:false,_token_sent:false,_logger:null,_context:null,init:function(){this._logger=c.getLogger(h)},addTypes2Preferences:function(i){this._logger.log("addTypes2Preferences");if(widget===undefined){throw new Error("widget variable isn't defined")}if(i!==undefined&&i.events!==undefined){this.addEvents(i.events)}if(this._preferences_added===false){this._logger.log("add the preferences");var j=this;i.types.forEach(function(l){var k=l.replace(" ","_");a.getCustomTypes({securityContext:f.getSecurityContext(),type:l,onComplete:function(o){var n=UWA.is(o,"string")?JSON.parse(o):o;var m=[];if(n.results.length>1){n.results.forEach(function(q){if(q["abstract"]==="FALSE"&&q.value!="Requirement Proxy"){m.push({label:q.label,value:q.value})}});j.addType2Pref(l,m)}if(j._token_sent===false){var p=g.get();if(UWA.is(p)&&UWA.is(p.saveCSRF)){p.saveCSRF(n.csrf);j._token_sent=true}}}})});this._preferences_added=true}},addType2Pref:function(k,i){this._logger.log("Add management of "+k+"to the preferences");if(widget===undefined){throw new Error("widget variable isn't defined")}var j=k.replace(" ","_");widget.mergePreferences([{name:"trm_types_"+j,type:"list",label:e["trm_Types_"+j],defaultValue:""}]);this._update_trm_req_types_pref(k,i)},_update_trm_req_types_pref:function(k,i){var l=this;if(i.length>0){var j=k.replace(" ","_");widget.addPreference({name:"trm_types_"+j,type:"list",label:e["trm_Types_"+j],defaultValue:i[0].value,options:i});var m=null;if(widget.getValue("trm_types_"+j)===undefined||widget.getValue("trm_types_"+j)===""){m=widget.setValue("trm_types_"+j,i[0].value)}else{m=widget.getValue("trm_types_"+j)}l.dispatchEvent("onUpdateTypePreferences",{type:j,value:m})}}});return h});define("DS/TraceableRequirementsUtils/Services/RequirementSecurityCtxMgt",["UWA/Class","UWA/Class/Events","DS/Logger/Logger","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADContext","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(d,b,c,a,e,h,g){var f=d.singleton(b,{name:"RequirementSecurityCtxMgt",options:{},_preferences_added:false,_logger:null,init:function(){this._logger=c.getLogger(f);var i=this;if(widget.hasEvent("onUpdateTenant")===false){widget.addEvent("onUpdateTenant",function(j,k){if(UWA.is(k.value)){k=k.value}i._logger.log("onUpdateTenant "+j+" "+k);widget.setValue("req_tenant",k);i._fillPreferences({tenant:k,update:true})})}},addSecurityCtx2Preferences:function(i){this._logger.log("addSecurityCtx2Preferences");if(widget===undefined){throw new Error("widget variable isn't defined")}if(i!==undefined&&i.events!==undefined){this.addEvents(i.events)}if(this._preferences_added===false){this._logger.log("add the preferences");widget.mergePreferences([{name:"trm_security_ctx",type:"list",label:g.trm_SecurityCtx,defaultValue:""}]);this._logger.log("Fill there values");this._fillPreferences({tenant:undefined,update:false});this._preferences_added=true}},updatePreferences:function(){this._logger.log("updatePreferences");this.dispatchEvent("onUpdateSecurityContext",widget.getValue("trm_security_ctx"))},_fillPreferences:function(k){this._logger.log("_fillPreferences");var m=this,i;if(widget===undefined){throw new Error("widget variable isn't defined")}var l="",j=[];if(!UWA.is(k.tenant)){k.tenant=e.getTenant()}a.getsecuritycontext({tenant:k.tenant,onComplete:function(o){var n=UWA.is(o,"string")?JSON.parse(o):o;l=n.SecurityContext;m._update_trm_security_ctx_pref(l,j,k.update)},onFailure:function(n){console.log("selected tenant: "+this.tenant);console.log("called url: "+this.url);console.log("generated error: ",n)}});a.availablesecuritycontext({tenant:k.tenant,onComplete:function(o){var n=UWA.is(o,"string")?JSON.parse(o):o;n.cspaces.forEach(function(p){j.push({label:p.displayName,value:p.name})});m._update_trm_security_ctx_pref(l,j,k.update)},onFailure:function(n){console.log("selected tenant: "+this.tenant);console.log("called url: "+this.url);console.log("generated error: ",n)}})},_update_trm_security_ctx_pref:function(l,i,k){var m=this;if(l!==""&&i.length>0){if(UWA.is(widget.getValue("trm_security_ctx"))&&widget.getValue("trm_security_ctx")!==""){l=widget.getValue("trm_security_ctx")}else{if(!UWA.is(l)){l=i[0].value}}var n="ctx::";var j=l.indexOf(n)===-1?n+l:l;widget.addPreference({name:"trm_security_ctx",type:"list",label:g.trm_SecurityCtx,defaultValue:j,options:i});widget.setValue("trm_security_ctx",j);m.dispatchEvent("onUpdateSecurityContext",j);if(k===true){widget.dispatchEvent("onEdit")}}}});return f});