define("DS/ENOGantt/Controller/MainController",["DS/ENOGantt/Ven/Ext","DS/ENOGantt/Controller/Finder","DS/ENOGantt/GanttUtil","DS/ENOGantt/GanttConstants"],function(a,c,b,d){a.define("DS/ENOGantt/Controller/MainController",{extend:"Ext.app.ViewController",alias:"controller.GanttViewController",control:{"#dpmprojectgantt":{beforetaskresize:"beforetaskresize",beforetaskdrag:"beforetaskdrag",aftertaskresize:"aftertaskresize",taskdrop:"taskdrop",dependencydrop:"dependencydrop"},"[reference=zoomToFit]":{click:"onzoomToFit"},"[reference=zoomOut]":{click:"onZoomOut"},"[reference=zoomIn]":{click:"onZoomIn"},"[reference=expandAll]":{click:"onExpandAll"},"#rmbExpandAll":{click:"onExpandAll"},"#expandLevel_1":{click:"onExpandNLevelHandler"},"#expandLevel_2":{click:"onExpandNLevelHandler"},"#expandLevel_3":{click:"onExpandNLevelHandler"},"#expandLevel_4":{click:"onExpandNLevelHandler"},"#expandLevel_5":{click:"onExpandNLevelHandler"},"#expandLevel_all":{click:"onExpandAll"},"[reference=highlightCrit]":{click:"onHighlightCrit"},"[reference=statusDatePicker]":{click:"onStatusDatePicker"},"[reference=print]":{click:"onPrint"},"[reference=collapseGanttChart]":{click:"onCollapseGanttChart"},"[reference=SaveAll]":{click:"onSave",},"[reference=resetAll]":{click:"onReset"},"[reference=viewDropDown]":{click:"toggleView"},"[reference=showRollUpTask]":{click:"toggleRollUpTaskView"},"[reference=refinement]":{click:"showRefinement"},"#RMB_expandLevel_1":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_2":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_3":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_4":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_5":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_all":{click:"onExpandAll"},"#rmbOpenTaskAction":{click:"openTask"},"[reference=find]":{change:"find"},"[reference=filterByName]":{keyup:"filterByName"},"[reference=filter]":{click:"filter"},"[reference=resetFilter]":{click:"resetFilter"},"[reference=hide]":{click:"hide"},},getGantt:function(){return this.getView()},beforetaskdrag:function(g,f,j,h){return f.isStartDateEditable()&&f.isEndDateEditable()},beforetaskresize:function(g,f,j,h){return b.isValidTaskResize(f,j,h)},aftertaskresize:function(f,e,h){var j=e.data;var l=j.Policy;var k=j.Duration;if(l!="Project Review"&&(k!=null&&k==0)){var g=App.Nls["emxProgramCentral.Common.ValueMustBeAPositiveReal"];alert(g);e.reject();return}},taskdrop:function(f,o,l){var h=o.data;var n=h.Policy;var e=h.StartDate;var j=h.EndDate;var g=h.Duration;var k=h.DurationUnit;if(j==null&&e!=undefined){var p=h.Duration;var k=h.DurationUnit;j=a.Date.add(e,k,p)}o.setConstraint("startnoearlierthan",e)},dependencydrop:function(j,e,h,g){var f=a.ComponentQuery.query("#dpmprojectgantt")[0];if(!h){return false}},onzoomToFit:function(){var e=this.getGantt();e.zoomToFit()},onZoomOut:function(){var e=this.getGantt();e.zoomOut()},onZoomIn:function(){var e=this.getGantt();e.zoomIn()},onExpandAll:function(g,f){var e=this.getGantt();new UWA.Promise(function(j,h){var k;if(g.scope){k=g.scope.rec}b.isReadyToExpand(k,j)}).then(function(h){e.setLoading(false);e.setLoading(App.Nls["emxProgramCentral.Gantt.ExpandingStructure"]);setTimeout(function(){console.time("expand");if(!App.Gantt.toolbar){App.Gantt.toolbar={expandAll:{expanded:false,}}}App.Gantt.toolbar.expandAll.expanded=true;if(g.scope){var j=g.scope.rec;if(j.data.depth===1){e.expandAll()}else{j.expand(true)}}else{e.expandAll()}e.setLoading(false);App.Gantt.toolbar.expandAll.expanded=false;console.timeEnd("expand")},50)})},onExpandNLevelHandler:function(f){var e=this.getGantt();new UWA.Promise(function(h,g){var j;if(f.scope){j=f.scope.rec}b.isReadyToExpand(j,h,f.level)}).then(function(g){e.setLoading(false);e.setLoading(App.Nls["emxProgramCentral.Gantt.ExpandingStructure"]);setTimeout(function(){console.time("expand");if(!App.Gantt.toolbar){App.Gantt.toolbar={expandAll:{expanded:true,}}}else{App.Gantt.toolbar.expandAll.expanded=true}if(f.scope){var h=f.scope.rec;b.selectiveExpandFromRMB(h,f.level)}else{b.selectiveExpand(e,f.level)}e.setLoading(false);App.Gantt.toolbar.expandAll.expanded=false;console.timeEnd("expand")},100)})},onHighlightCrit:function(g){var f=this.getGantt();var e=f.getSchedulingView();if(g.pressed||g.checked){e.highlightCriticalPaths(true)}else{e.unhighlightCriticalPaths(true)}},onStatusDatePicker:function(g){var j=this.getGantt();var f=g.getValue();var h=j.getTimeAxis();var e=h.getEnd();if(f>=e){f=e-1}progressLine=j.plugins[5];progressLine.setStatusDate(f);progressLine.enable()},onPrint:function(){var e=this.getGantt();e.print()},onCollapseGanttChart:function(h){var g=h.icon;var f=this.getGantt();var j=enoviaServer.computeUrl("/common/images/");var e=j+"iconActionComplianceExport.png";var k=j+"iconActionImportDesignSyncModule.png";if(f.lockedGrid.getWidth()>d.gantt.lockedGrid.width||g.contains("iconActionImportDesignSyncModule.png")){f.normalGrid.setCollapsed(false);f.lockedGrid.setWidth(d.gantt.lockedGrid.width);b.enableButtons(d.toolbarBtnListToEnableDisable);h.setIcon(e);h.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.CollapseChart"])}else{f.lockedGrid.setWidth(f.ownerGrid.getWidth()+f.normalGrid.getWidth());f.normalGrid.collapse(true);b.disableButtons(d.toolbarBtnListToEnableDisable);h.setIcon(k);h.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.ExpandChart"])}},onSave:function(){var e=this.getGantt();e.getCrudManager().sync();this.filter()},onReset:function(){var f=this.getGantt();f.getCrudManager().reject();var g=a.ComponentQuery.query("#dpmresourceutilizationpanel")[0];var e=g.getStore();e.rejectChanges()},toggleView:function(f){var l=f.pressed;var j=this.getView();var n=enoviaServer.computeUrl("/common/images/");var g=n+"I_HidePlanActual32.png";var k=n+"I_ShowPlanActual32.png";var e=j.getColumns();for(i=0,m=e.length;i<m;i++){if(e[i].name=="BaselineDuration"||e[i].name=="BaselineStartDate"||e[i].name=="BaselineEndDate"){e[i].setVisible(l)}}App.Infra.BaselineRequired=l;j.baselineVisible=App.Infra.BaselineRequired;j.setReadOnly(l);j.getView().refresh();if(l){j.showBaseline();enoviaServer.viewId=App.Nls.viewStore[2].viewId;f.setTooltip(App.Nls.viewStore[0].name);f.setIcon(g);a.getCmp("tBarActionRollUpTask").disable()}else{j.hideBaseline();enoviaServer.viewId=App.Nls.viewStore[0].viewId;f.setTooltip(App.Nls.viewStore[2].name);f.setIcon(k);a.getCmp("tBarActionRollUpTask").enable()}var h=a.ComponentQuery.query("panel#GanttRefinementPanel")[0];if(h&&h.isVisible()){h.hide();this.showRefinement()}},toggleRollUpTaskView:function(e){var h=e.pressed;var g=this.getView();var k=enoviaServer.computeUrl("/common/images/");var f=k+"I_ShowRollupTask32.png";var j=k+"I_HideRollupTask32.png";g.setShowRollupTasks(h);if(h){e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.hideRollUpTasks"]);e.setIcon(j)}else{e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.showRollUpTasks"]);e.setIcon(f)}},showRefinement:function(){var e=a.ComponentQuery.query("panel#GanttRefinementPanel")[0];e.show()},openTask:function(j){var f=this.getGantt();if(j.scope){var e=j.scope.rec;var h=e.getId();if(h.indexOf("_")>=0){h=h.split("_")[0]}var g="../../common/emxNavigator.jsp?physicalId="+h;if(window.isIFWE){g=enoviaServer.computeUrl("/common/emxNavigator.jsp?physicalId=")+h}window.open(g)}},resetCache:function(){if(App.Gantt.filter.filterBy){for(var e in App.Gantt.filter.filterBy){if("Name"!==e){delete App.Gantt.filter.filterBy[e]}}}},resetFilter:function(){var e=this.getView();e.reset();enoviaServer.resetRefinement=true;this.resetCache();this.filter()},hide:function(){this.getView().hide()},filter:function(){var l=a.ComponentQuery.query("panel#GanttRefinementPanel")[0];var f=l.getValues();this.resetCache();for(var j in f){if(App.Gantt.filter.filterBy){var k=f[j];var h=false;if(k instanceof Array){if(k.join("")!=""){h=true;k=k.join("@")}}else{if(k+""!=""){h=true}}if(h){if(App.Gantt.filter.filterBy[j]){var g=App.Gantt.filter.filterBy[j];g=g+"@"+k.toString();App.Gantt.filter.filterBy[j]=g}else{App.Gantt.filter.filterBy[j]=k.toString()}}}}var e=App.Gantt.filter.filterBy;if(e&&Object.keys(e).length>0){this.getView().store.filterTreeBy()}else{this.getView().store.clearTreeFilter();App.Gantt.filter.filterBy={}}},filterByName:function(h,g){if(g.getKey()===g.ESC){delete App.Gantt.filter.filterBy.Name;h.reset()}var f=h.getValue();if(f.length>0){App.Gantt.filter.filterBy.Name=f}else{delete App.Gantt.filter.filterBy.Name}this.getGantt().getTaskStore().filterTreeBy()},find:function(k,j,g){var e=this.getView();var f=e.getTaskStore();k.focus(false);var h=this;this.finder=new c({field:k,view:e,store:f,newValue:j,oldValue:g,});a.Function.defer(function(){var l=h.finder.find()},500)},clear:function(e){e.focus(false);this.finder.reset()},previous:function(f){f.focus(false);var e=this.finder.find(true)},next:function(f){f.focus(false);var e=this.finder.find()},})});