define("DS/ENOGantt/Data/TaskStore",["UWA/Class","DS/ENOGantt/Ven/Bryntum","DS/ENOGantt/Data/ResponseUtil","DS/Foundation2/FoundationV2Data",],function(a,c,e,d){var b={patternMatches:function(h,g){var f=new RegExp(Ext.String.escapeRegex(h),"i");return f.test(g)},nameMatchFound:function(f){var i=Ext.getCmp("filterField").getValue();var h=f.get("Name");var g=new RegExp(Ext.String.escapeRegex(i),"i");return g.test(h)},dateMatchFound:function(h,k,i){var j=new Date(i[0]);var g=new Date(i[1]);var f=new Date(h.get(k));f.setHours(0);f.setMinutes(0);f.setSeconds(0);if(!isNaN(j)&&!isNaN(g)){return(j<=f)&&(f<=g)}else{if(!isNaN(j)){return j<=f}else{return f<=g}}},deviationMatchFound:function(f,m,n,l){var k=false;var p=App.Nls["emxProgramCentral.DurationUnits.Days"];if(l==null||l==""){return k}l=l.substring(0,l.indexOf(p));var g=parseInt(l);for(var j=0;j<n.length;j++){var r=[];var h=n[j];h=h.substring(0,h.indexOf(p));r=h.split(" - ");var q=parseInt(r[0]);var o=parseInt(r[1]);if(g>=q&&g<=o){k=true;break}}return k}};return a.extend({init:function(g){var f=this;if(!Ext.ClassManager.isCreated("DS.ENOGantt.Data.TaskModel")){Ext.define("DS.ENOGantt.Data.TaskModel",{extend:"Gnt.model.Task",autoCalculateCostForParentTask:false,autoCalculateCost:false,fields:function(){var h=new Array();var j=App.Infra.Columns;var l=j.length;h.push({name:"TaskProjectId",mapping:"TaskProjectId"});h.push({name:"ExternalDependencies",mapping:"ExternalDependencies"});h.push({name:"ExternalRawDependencies",mapping:"ExternalRawDependencies"});h.push({name:"hasEditAccess",mapping:"hasEditAccess"});h.push({name:"EnglishType",mapping:"EnglishType"});for(idx=0;idx<l;idx++){var k=j[idx];var m=k.dataIndex;var i=k.xtype;var n=k.excludeInRefinement;if("datecolumn"==i){h.push({name:m,mapping:m,excludeInRefinement:n,type:"date",dateFormat:"c"})}else{h.push({name:m,mapping:m,excludeInRefinement:n,})}}return h}(),getEarlyStartDateDefaultValue:function(j){var k=this,i=j.taskStore||k.getTaskStore(true),m=k.getProject();var h=k.data.TaskProjectId;if(h){var l=i.getModelById(k.data.TaskProjectId).data;return l.ConstraintDate?l.ConstraintDate:i.getProjectStartDate()}return m?m.getStartDate():i.getProjectStartDate()},isEditable:function(j){if(App.Infra.CustomeColumnDataIndex.includes(j)){return App.Infra.customeColumnEditableData[j].isEditable}if(this.getReadOnly()){return false}var i=this.get("parentId");if("root"==i){return false}var h=["State","Status","TaskSequenceId","Type","PercentDone","Assignee","Deviation","FreeFloat","TotalFloat"];if(h.indexOf(j)!=-1){return false}if(j=="StartDate"){return this.isStartDateEditable()}else{if(j=="EndDate"){return this.isEndDateEditable()}else{if(j=="Duration"){return this.isDurationEditable()}else{if(j=="Dependency"){return this.isDependencyEditable()}}}}return this.callParent(arguments)},isExpandable:function(){var h=this;if(h.get("expandable")){return !(h.isLeaf())}return false},isReadOnly:function(){var h=false;if(this.getReadOnly()){h=true}return h},isMilestone:function(h){var k=false;var j=this.get("EnglishType");var i=this.hasChildNodes();if(i){k=false}else{if("Gate"==j||"Milestone"==j){k=true}}return k},isStartDateEditable:function(){var j=App.Nls.Active;var l=App.Nls.Review;var h=App.Nls.Complete;var k=this.get("State");var i=!(this.isLeaf());if(k==j||k==l||k==h||i||App.Infra.TypeOf.ProjectTemplate){return false}return true},isEndDateEditable:function(){var k=App.Nls.Review;var h=App.Nls.Complete;var j=this.get("State");var i=!(this.isLeaf());if(j==k||j==h||i||App.Infra.TypeOf.ProjectTemplate){return false}return true},isDurationEditable:function(){var m=App.Nls.Review;var i=App.Nls.Complete;var l=this.get("State");var k=!(this.isLeaf());var j=this.isMilestone();var h=this.get("PercentDone");if(100==h||l==m||l==i||k||j){return false}return true},isDependencyEditable:function(){var h=App.Nls.Complete;var i=this.get("State");if(i==h){return false}return true},})}Ext.define("MyDependencyStore",{override:"Gnt.data.DependencyStore",autoLoad:true,proxy:{type:"memory",reader:{type:"json"},},getDependencyError:function(j,h,o,q,s){var r=this.callParent(arguments);if(r<=0&&r==-2&&App.Infra.Load.Level!=0){r=0}var k=Ext.ComponentQuery.query("#dpmprojectgantt")[0];if(r>=0){if(j instanceof c.model.Dependency){o=j.getType();h=j.getTargetId()}else{if(o===null||o===undefined){var p=this.model.getField(this.model.prototype.typeField).defaultValue;o=p!==undefined?p:this.model.Type.EndToStart}}var t=App.Nls.Review;var l=App.Nls.Active;var m=App.Nls.Complete;var n=k.taskStore.getModelById(h);var i=n.data.State;if((i===t||i===l)&&(0===o||2===o)){r=-101}if((1===o||3===o)&&n.hasChildNodes()){r=-102}if(i===m){r=-104}}return r}});Ext.define("DS.ENOGantt.Data.TaskStore",{extend:"Gnt.data.TaskStore",model:"DS.ENOGantt.Data.TaskModel",sortOnLoad:false,autoNormalizeNodes:false,scheduleByConstraints:true,RefinementUtil:b,keepExpandStateWhileFiltered:true,allowExpandCollapseWhileFiltered:true,calendar:new c.data.calendar.BusinessTime({name:"General",calendarId:"General"}),proxy:{type:"memory",reader:{type:"json"},},getCriticalPaths:function(){var j=this,h=[],i=j.toArray()[1].data.Id;if(!i){this.callParent(arguments)}else{url="/resources/v1/modeler/projects/"+i+"?$indexBasedImages=false&$include=none,tasks&level=0&$fields=none,tasks.criticalTask";var k=d.calculateFinalUrl(url);Ext.Ajax.request({url:k,async:false,success:function(l){var n=JSON.parse(l.responseText.trim());if(n.success){var m=n.data[0];if(m.relateddata&&m.relateddata.tasks&&m.relateddata.tasks.length>0){h=e.getCriticalTasksArray(m.relateddata.tasks,j)}}}});return Ext.Array.map(h,function(l){return l.getCriticalPaths()})}},find:function(u,q,r,p){var o=e.getGanttTableColumnArray(false);if(o&&o.length>0){var k=o.length;var n=this.toArray();var s=n.length;if(u){var t=p-1;if(t==-1){t=s-1}for(var m=t;m>0;m--){var h=n[m];if(h.raw.visible){if(this.performFind(q,h,k,o)){return{model:h,index:m}}}}}else{var t=p+1;for(var m=t,l=n.length;m<l;m++){var h=n[m];if(h.raw.visible){if(this.performFind(q,h,k,o)){return{model:h,index:m}}}}}}},performFind:function(p,h,j,m){var o=false;for(var l=0;l<j;l++){var n=m[l];var q=h.get(n.dataIndex);if(q==undefined||q.toString()==""){continue}if(n.columnDataType=="datefield"){var i=n.format;q=Ext.util.Format.date(q,i)}if(n.dataIndex=="Duration"){q=n.getValueToRender(q,null,h)}if(p.test(q)){o=true;break}}return o},filterTreeBy:function(h){this.callParent([{filter:function(j){if(j.get("parentId")=="root"){return true}if(j.get("ExternalTask")){return false}if(j.parentNode&&(!j.parentNode.isExpanded())){return false}var t=App.Gantt.filter.filterBy;var l=true;for(var r in t){if(t.hasOwnProperty(r)){var s=App.Gantt.filter.fields[r]?App.Gantt.filter.fields[r].fieldDataType:undefined;var q=r;var k=t[r].split("@");var i=j.get(q);if("Name"==r){var p=App.Gantt.filter.filterBy.Name;var o=new RegExp(Ext.String.escapeRegex(p),"i");l=o.test(j.getName())}else{if("datefield"==s){l=b.dateMatchFound(j,q,k);if(!l){break}}else{if(r=="Deviation"){l=this.doDeviationFilter(j,q,k,i);if(!l){break}}else{if(!(i==undefined)){if("numberfield"==s){i=Math.round(Number(i)*100)/100;if(r=="Duration"){var m=App.Nls["emxProgramCentral.DurationUnits.Days"];i=i+" "+m.toLowerCase()}}var n=k.indexOf(i.toString());if(n>=0){continue}else{l=false;break}}else{l=false;break}}}}}}return l},checkParents:true}])},doDeviationFilter:function(h,p,q,o){var m=false;var n=App.Nls["emxProgramCentral.DurationUnits.Days"];if(o==null||o==""){return m}o=o.substring(0,o.indexOf(n));var j=parseInt(o);for(var l=0;l<q.length;l++){var t=[];var k=q[l];k=k.substring(0,k.indexOf(n));t=k.split(" - ");var s=parseInt(t[0]);var r=parseInt(t[1]);if(j>=s&&j<=r){m=true;break}}return m}})},getStore:function(){return Ext.create("DS.ENOGantt.Data.TaskStore")}})});