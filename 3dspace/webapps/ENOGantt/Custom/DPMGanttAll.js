define("DS/ENOGantt/Custom/DPMGanttAll",["UWA/Class","DS/ENOGantt/Ven/Ext","DS/ENOGantt/Ven/Bryntum","DS/ENOGantt/Data/ResponseUtil","DS/ENOGantt/GanttUtil"],function(b,a,d,e,c){return b.extend({init:function(){a.define("DS.ENOGantt.DPMGanttAll.TooltipTamplate",{extend:"Gnt.template.TaskTooltip",disableFormats:true,dateFormat:null,markup:['<tpl if="records">','<tpl for="records">','<tpl if="xindex &lt;= _maxItemsInTooltip_">',"_bodyTpl_","</tpl>","</tpl>",'<tpl if="records.length &gt; _maxItemsInTooltip_">','<div class="sch-task-tip-extra">',"{[this.getOverflowText(values)]}","</div>","</tpl>","<tpl else>","_bodyTpl_","</tpl>"].join(""),bodyMarkup:['<h5 class="sch-task-tip-header">{Name}</h5><table><tr><td>'+App.Nls["emxProgramCentral.Common.StartDate"]+':</td> <td align="left">{[this.getStartDateString(values)]}</td></tr><tr><td>'+App.Nls["emxProgramCentral.Common.EndDate"]+':</td> <td align="left">{[this.getEndDateString(values)]}</td></tr><tr><td>'+App.Nls["emxProgramCentral.Gantt.Tooltip.Progress"]+':</td> <td align="left">{[this.getPercentDoneString(values)]}%</td></tr><tr><td valign="top">'+App.Nls["emxProgramCentral.Common.Assignee"]+':</td><td width="100px" align="left">{[values.Assignee]}</td></tr></table>'].join(""),constructor:function(g,f){this.markup=g||this.markup;this.callParent([this.markup]);this.dateFormat=f},getPercentDoneString:function(h){var f=h._record;var g=h.PercentDone;return Math.round(g)}});a.define("DS.ENGantt.patches.Task",{extend:"Sch.util.Patch",target:"Gnt.model.Task",overrides:{setStartDateWithoutPropagation:function(g,l,k){var h=this,f=h.getTaskStore(true),j,i;l=l!==false;if(f&&k!==true&&k!==false){k=f.skipWeekendsDuringDragDrop}else{if(k!==true&&k!==false){k=false}}h.autoCalculateLag();h.beginEdit();if(!g){h.set(h.durationField,null);h.set(h.startDateField,null);h.setSegmentsWithoutPropagation(null)}else{if(k&&!(h.isMilestone()&&f&&f.scheduleByConstraints)){g=h.skipNonWorkingTime(g,true)}h.set(h.startDateField,g);if(f&&h.isSegmented()){h.updateSegmentsDates()}if(l!==false){h.set(h.endDateField,h.recalculateEndDate(g))}else{i=this.getEndDate();if(i){this.constrainSegments();h.set(h.durationField,h.calculateDuration(g,i,h.getDurationUnit()))}}}j=h.getDuration();i=h.getEndDate();if(g&&i&&(j===undefined||j===null)){h.set(h.durationField,h.calculateDuration(g,i,h.getDurationUnit()))}h.onPotentialEffortChange();h.endEdit();return true},setEndDateWithoutPropagation:function(j,h,i){var n=this,o=n.getTaskStore(true),l,g;if(h){this.isEndDateModified=true}h=h!==false;if(i!==true&&i!==false&&o){i=o.skipWeekendsDuringDragDrop}else{if(i!==true&&i!==false){i=false}}n.autoCalculateLag();n.beginEdit();var m=n.getEndDate();if(!j){n.set(n.durationField,null);n.set(n.endDateField,null);n.setSegments(null)}else{g=n.getStartDate();if(j<g&&h===false){j=g}if(i){if(n.isMilestone()){j=n.skipNonWorkingTime(j,true)}else{j=n.skipNonWorkingTime(j,false)}}if(h!==false){l=n.getDuration();if(a.isNumber(l)){if(o&&n.isSegmented()&&(j-m)){n.updateSegmentsDates({isForward:false,endDate:j})}n.set(n.startDateField,n.calculateStartDate(j,l,n.getDurationUnit()));n.set(n.endDateField,j)}else{n.set(n.endDateField,j)}}else{var k=n.isMilestone();if(j<g){n.set(n.startDateField,j)}n.set(n.endDateField,j);n.constrainSegments();if(g){n.set(n.durationField,n.calculateDuration(g,j,n.getDurationUnit()));if(k&&!n.isMilestone()){var f=n.skipNonWorkingTime(g,true);if(f-g!==0){n.set(n.startDateField,f)}}}}}l=n.getDuration();g=n.getStartDate();if(j&&g&&(l===undefined||l===null)){n.set(n.durationField,n.calculateDuration(g,j,n.getDurationUnit()))}n.onPotentialEffortChange();n.endEdit();return true},getPinConstraintType:function(g){g=g||this.getTaskStore(true);var f=g&&g.isBackwardScheduled();var h;if(this.isEndDateModified){h="finishnoearlierthan";if(f){h="finishnolaterthan"}return h}return f?"finishnolaterthan":"startnoearlierthan"},pinWithoutPropagation:function(i,l){var k=this,h=k.getTaskStore(true);if(k.isPinnable(h)){var g=k.getPinConstraintType(h),j=k.getProjectScheduleBackwards(),f=(j?k.getEndDate():(k.isEndDateModified?k.getEndDate():k.getStartDate()));delete k.isEndDateModified;k.setConstraintWithoutPropagation(g,f)}},}});a.define("DS.ENOGantt.DPMGanttAll.Component",{override:"Ext.Component",getMaskTarget:function(){return this.getEl()}});a.define("DS.ENOGantt.DPMGanttAll.column.EndDate",{override:"Gnt.column.EndDate",validateStartDate:false,keepDuration:true,});a.define("DS.ENOGantt.DPMGanttAll.field.EndDate",{override:"Gnt.field.EndDate",validateStartDate:false,keepDuration:true,});a.define("DS.ENOGantt.DPMGanttAll.util.DependencyParser",{override:"Gnt.util.DependencyParser",parse:function(q){if(!q){return[]}var k=q.split(",");var s=[];var j=this.dependencyRegex;for(var m=0;m<k.length;m++){var g=k[m];if(!g&&m==k.length-1){continue}var n=j.test(g);var l={};if(!n){return null}if(g.indexOf("+")==-1&&g.indexOf("-")==-1){g=g+"+0 d"}var n=g.split(new RegExp("(([a-zA-Z0-9_-]+((sw+)+))?:)?(-?\d+)?:(FS|SF|FF|SS|sf|fs|ff|fs|Sf|Fs|Ff|Ss|sS|sF|fS|fF)?([+-]{1})(\d+(.\d+)?s[DdHh])?"));var f=n[0];if(f.includes(":")){var p=f.split(":");var r=p[0];l.predProjectName=r;l.isExtDep=true;f=p[1]}else{if(App.Infra.RootProjectname){l.predProjectName=App.Infra.RootProjectname}}l.taskId=parseInt(f,10);l.predTaskSeqNumber=l.taskId;l.type=a.Array.indexOf(this.types,(n[6]||this.types[2]).toUpperCase());var o=n[10];if(o){var h=this.durationParser.parse(o,true);if(!h){return null}if(n[7]=="-"){h.value=h.value*(-1)}h.value=parseFloat(h.value).toFixed(1);l.lag=h.value;l.lagUnit=h.unit||Sch.util.Date.DAY}s.push(l)}return s}});a.define("DS.ENOGantt.DPMGanttAll.field.Dependency",{override:"Gnt.field.Dependency",getTaskIdFromDependency:function(w,v){var l=this.task.getTaskStore(),h=w.taskId,z;var o=this;if(this.useSequenceNumber){var t=w.isExtDep;if(t){var m=w.predProjectName;var i=false;var u=l.toArray();var r=u.length;var g=0;var s="";var k=App.Infra.ColumnIndex.Name;for(idx=g;idx<r;idx++){var j=u[idx];var n=j.get(App.Infra.Columns[k].dataIndex);if(n){if(l.RefinementUtil.patternMatches(m,n)){s=j.get("Id");i=true;break}}}if(i){var p=s;var u=l.toArray();var r=u.length;var g=0;var f=App.Infra.ColumnIndex.TaskSequenceId;for(idx=g;idx<r;idx++){var j=u[idx];var n=j.get(App.Infra.Columns[f].dataIndex);if(n){if(""+h==n){var q=j.get("TaskProjectId");if(q==p){z=j;break}else{continue}}}}}else{if(v){var y=m;var A=h;o.taskId=h;h=c.getExternalProjectTaskBySequenceId(y,A);w.ToAddToTask=true;w.predTaskSeqNumber=A;return h}else{return{taskId:undefined,isExtprojDep:true}}}}else{var p=this.task.get("TaskProjectId");var u=l.toArray();var r=u.length;var g=0;var f=App.Infra.ColumnIndex.TaskSequenceId;var x=App.Infra.Columns[f].dataIndex;for(idx=g;idx<r;idx++){var j=u[idx];var n=j.get(x);if(n){if(""+h==n){var q=j.get("TaskProjectId");if(q==p){z=j;break}else{continue}}}}}h=z&&z.getId()}if(!h&&App.Infra.Load.Level!=0){var m=w.predProjectName;var A=w.taskId;o.taskId=h;h=c.getExternalProjectTaskBySequenceId(y,A)}return h},applyChanges:function(k){k=k||this.task;var u=k.getTaskStore().dependencyStore,p=this.getDependencies(),r=this.isPredecessor(),t=r?k.getIncomingDependencies(true):k.getOutgoingDependencies(true),h=[],n;var f=a.Array.map(p,function(i){return this.getTaskIdFromDependency(i)},this);for(n=0;n<t.length;n++){if(!a.Array.contains(f,t[n][r?"getSourceId":"getTargetId"]())){h.push(t[n])}}if(h.length>0){u.remove(h)}var v=[];var m=[];for(n=0;n<p.length;n++){var l=p[n];var g=this.getTaskIdFromDependency(l,true);var q=u.getTasksLinkingDependency(g,k.getId());if(q){q.beginEdit();q.setType(l.type);q.setLag(l.lag,l.lagUnit);q.endEdit()}else{if(l.ToAddToTask){var o={};o.isExtDep=true;o.From=g;o.To=k.getId();o.Type=l.type;o.predTaskSeqNumber=l.predTaskSeqNumber;o.predProjectName=l.predProjectName;o.Lag=l.lag||0;o.LagUnit=l.lagUnit||"d";m.push(o)}else{q=new u.model();q.setSourceId(r?g:k.getId());q.setTargetId(r?k.getId():g);q.setType(l.type);q.data.predTaskSeqNumber=l.predTaskSeqNumber;q.data.predProjectName=l.predProjectName;q.setLag(l.lag||0,l.lagUnit||"d");v.push(q)}}}if(v.length>0){u.add(v)}if(m){var j=k.get("ExternalDependencies");var s=m;if(!j){k.data.ExternalDependencies=[];k.set("ExternalDependencies",s)}else{k.set("ExternalDependencies",s)}e.setRawExternalDependency(k,m,j)}},getErrors:function(s){if(!s){return[]}var m=this.dependencyParser.parse(s);if(!m){return[this.L("invalidFormatText")]}var o=this.getDependencies(),r=this.isPredecessor(),x=this.task,z=x.getTaskStore().dependencyStore,q=x[r?"predecessors":"successors"],p=this.dependencyParser.types,l=z.allowedDependencyTypes,n=z.model.Type,f;var y=[];for(var w=0;w<o.length;w++){var u=o[w];var A=this.getTaskIdFromDependency(u);if(A&&A.isExtprojDep){return""}else{f=A;if(!f){return[this.L("invalidDependencyText")]}}if(z.allowedDependencyTypes&&!z.isValidDependencyType(u.type)){var g="";for(var v=0,t=l.length;v<t;v++){g+=p[n[l[v]]]+","}return[a.String.format(this.L("invalidDependencyType"),p[u.type],g.substring(0,g.length-1))]}var h=new z.model();h.setSourceId(r?f:x.getId());h.setTargetId(r?x.getId():f);h.setType(u.type);h.data.predProjectName=u.predProjectName;h.setLag(u.lag,u.lagUnit);y.push(h)}for(w=0;w<y.length;w++){if(!z.isValidDependency(y[w],y,q)){return[this.L("invalidDependencyText")]}}return this.callParent([m.value])},getFieldDisplayValue:function(D){var j=D.getTaskStore();var s=this.isPredecessor();if(s){var t=D.getId();var o=D.getAllDependencies();var k=D.get("ExternalDependencies");if(k&&k.length>0){o=o.concat(k)}var B=new Array();var r=o.length;for(idx=0;idx<r;idx++){var v=o[idx];var A=v.isExtDep;if(A){var h=parseInt(v.Type);var g=v.To;var y=v.predTaskSeqNumber;var l=v.predProjectName;var q=v.Lag;var i=v.LagUnit}else{var y=v.getFrom();if(y==t){continue}y=j.getModelById(y);if(y){y=y.get("TaskSequenceId")}else{y=v.data.predTaskSeqNumber}var g=v.getTo();var h=v.getType();var q=v.getLag();var l=v.data.predProjectName;var i=v.getLagUnit()}if(!l&&v.getFrom()){var n=v.getFrom();var f=j.getModelById(n);if(f){var p=f.get("TaskProjectId");var w=j.getModelById(p);if(w){l=w.get("Name")}}}switch(h){case 0:h="SS";break;case 1:h="SF";break;case 2:h="FS";break;case 3:h="FF";break}var F=parseInt(q)>=0?"+":"";var z="";if(l){var m=true;var x=j.data.items[0].data.Id;var C=j.getModelById(g);var E=C.get("TaskProjectId");var u="";var n=v.getFrom();var f=j.getModelById(n);if(f){u=f.get("TaskProjectId")}if(E==u){m=false}if(m){z=l+":"}}z=z+y+":"+h+F+q+" "+i;B.push(z)}B.sort();return B.join(",")}},});a.define("DS.ENOGantt.DPMGanttAll.plugin.ConstraintResolutionGui",{override:"Gnt.plugin.ConstraintResolutionGui",onConstraintConflict:function(g,f){var m=this,o=m.getCmp(),q=o.lockedGrid.getView(),h=o.normalGrid.getView(),j=o.getDependencyView(),n=h.indexOf(g),l,k={destroy:function(){a.destroy(l)}};function i(){if(n!=-1){q.refreshNode(n);h.refreshNode(n);j.updateDependencies(g.getAllDependencies()).then(null,a.emptyFn)}}i();if(!m.hasStoredResolutionForContext(f)){m.window=new d.widget.ConstraintResolutionWindow({dateFormat:m.getDateFormat(),resolutionContext:f});l=m.window.on({ok:a.Function.bind(m.onUserActionOk,m,[f,i,m.window,k],true),cancel:a.Function.bind(m.onUserActionCancel,m,[f,i,m.window,k],true),close:a.Function.bind(m.onUserActionClose,m,[f,i,k],true),destroyable:true});o.completeEdit();var p={resolutionOption:1,dontAsk:false};m.window.form.fireEvent("ok",m.window.form,p)}else{m.resolveSilently(f,i)}},});a.define("DS.ENOGantt.DPMGanttAll.constraint.Base",{override:"Gnt.constraint.Base",getRemoveConstraintResolutionOption:function(j,g,h){h=h||g.getConstraintDate();var i=this,f=g.getTaskStore(true);return{id:"remove-constraint",title:a.String.format(i.L("Remove the constraint"),i.L("name")),resolve:function(){g.setConstraintWithoutPropagation("startnoearlierthan");if(f.scheduleByConstraints&&(g.getEarlyStartDate()<=g.getStartDate())){var k;g.pinWithoutPropagation(k,true)}j()}}},});a.define("DS.ENOGantt.DPMGanttAll.widget.taskeditor.TaskEditor",{extend:"Sch.util.Patch",target:"Gnt.widget.taskeditor.TaskEditor",overrides:{buildItems:function(){var f=this;items=[];f.taskForm=a.create(f.taskFormClass,a.apply({xtype:"taskform",xclass:f.taskFormClass,task:f.task,border:false,taskStore:f.taskStore,showBaseline:f.showBaseline,showRollup:false},f.taskForm,f.taskFormConfig));items=f.callParent(arguments);return items},}});a.define("DS.ENOGantt.DPMGanttAll.util.DurationParser",{extend:"Sch.util.Patch",target:"Gnt.util.DurationParser",overrides:{parse:function(i,f){var g=this.durationRegex.exec(i);if(i==null||!g){return null}var k=this.parseNumberFn(g[1]);var h=g[2];var j;if(h&&!f){a.iterate(this.L("unitsRegex"),function(l,m){if(m.test(h)){j=Sch.util.Date.getUnitByName(l);return false}});if(!j){return null}}return{value:k,unit:j}}}});a.define("DS.ENOGantt.Ext.tree.View",{extend:"Sch.util.Patch",target:"Ext.tree.View",overrides:{expand:function(g,f,l,j,i){var k=this;var h=arguments;if(i){return k.callParent(h)}else{new UWA.Promise(function(n,m){c.isReadyToExpand(g,n)}).then(function(m){return k.expand(g,f,l,j,true)})}}}})}})});