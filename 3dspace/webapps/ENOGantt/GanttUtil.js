define("DS/ENOGantt/GanttUtil",["DS/ENOGantt/GanttConstants","DS/ENO6WPlugins/jQuery","DS/WAFData/WAFData"],function(b,c,a){var d=function(e){var h=e.onFailure||function(j,k){var l=k||{};if(!(l.success===false&&l.error)){l={error:"Network Error: Unable to load widget due to network or authentication error."}}e.callback.call(this,l)};var g=e.onTimeout||function(){e.callback.call(this,{error:"Network Error: Unable to load widget due to timeout error."})};var f=e.onCancel||function(){e.callback.call(this,{error:"Application Error: Request canceled."})};var i=a.authenticatedRequest(e.url,{method:e.type,type:e.dataType,proxy:"passport",timeout:500000,cache:3600,data:e.data,onComplete:e.callback,onFailure:h,onCancel:f,async:false,onTimeout:g,headers:e.headers});i=i||{cancel:Function.prototype};return i};return{updateStoreWithNewDependency:function(g,e){var f=Ext.ComponentQuery.query("#dpmprojectgantt")[0]},checkRepetativeDependancy:function(k){var f=new Array();var l=k.split(",");for(var j=0;j<l.length;j++){var e="";var h=l[j].split(":");if(h.length>2){e=h[0]+":"+h[1]}else{e=h[0]}var g=(f.indexOf(e)!=-1)?true:false;if(g){return true}else{f.push(e)}}return false},isNumeric:function(e){return(isNaN(e))?false:true},getSelectiveItemArray:function(g,n,m,e){var h=[];var f=App.Nls["emxProgramCentral.Common.All"];for(var l=1,k=g;l<=k;l++){h.push({text:l,id:n.concat(l),itemId:n.concat(l),level:l})}h.push({text:f,id:n.concat("all"),itemId:n.concat("all"),});return h},selectiveExpandFromRMB:function(e,f){e.collapse(true);e.expand(false);if(f>1&&e.hasChildNodes){this.expandNode(e,f,e.data.depth)}},selectiveExpand:function(e,f){var g=e.taskStore.getRoot().childNodes[0];if(g.expanded){e.collapseAll()}else{g.collapse(true)}g.expand(false);if(f>g.data.depth&&g.hasChildNodes){this.expandNode(g,f,null)}},expandNode:function(l,n,f){var m=l.childNodes;var o=m.length;for(var k=0,g=o;k<g;k++){var e=m[k];var h=e.data.depth;if(f){h=(e.data.depth-f)+1}if(n>=h){e.expand(false)}if(n>=h&&e.hasChildNodes){this.expandNode(e,n,f)}}},getDateFormat:function(f){var e="M d, Y";return e},getLastSequenceIdForProject:function(g){var i=0;var f=enoviaServer.computeUrl("/programcentral/");var e=f+"gantt/data/emxGanttService.jsp?mode=getProjectsLastSeq&projectId="+g+"&SecurityContext="+enoviaServer.securityContext;var h={url:e,type:"GET",async:false,dataType:"json",callback:function(j){if(j.success=="200"){i=j.lastSequence}}};if("undefined"==typeof widget){Ext.Ajax.request({url:e,async:false,success:function(j){var k=JSON.parse(j.responseText.trim());if(k.success=="200"){i=k.lastSequence}}})}else{d(h)}return i},hasValidSequenceNo:function(m,p){var w=Ext.ComponentQuery.query("#dpmprojectgantt")[0];var j=App.Nls["emxProgramCentral.Common.Dependency.InvalidSequenceNumber"];var t=p.data.Id;var e=null;var n=m.split(",");for(var o=0;o<n.length;o++){var g;var s=n[o];var k=s.split(":");var h=k.length>2;var f=true;if(h){var r=k[0];if(!this.isValidExternalProject(r)){return false}var v=k[1];g=this.getSubProjectByName(r);if(g!=null){e=g.get("LastSequence")}else{f=false}}else{var v=k[0];var q=w.taskStore.getModelById(t);var l=null;var u=q.data.EnglishType;if(u=="ProjectSpace"||u=="ProjectConcept"||u=="Experiment"){l=w.taskStore.toArray()[1].get("Id")}else{l=q.get("TaskProjectId")}g=w.taskStore.getModelById(l);e=g.get("LastSequence")}if((!e||App.Infra.Load.Level!=0)&&g!=undefined){var l=g.getId();e=this.getLastSequenceIdForProject(l);if(!e){g.set("LastSequence",e)}}v=parseInt(v);var x=(v<=e);if(v==0||(!h&&!x)||(f&&!x)){j=j.replace("<SequenceNo>",v);alert(j);return false}}return true},binarySearch:function(i,f,j,l,h){l=parseInt(l);var m=parseInt((i+f)/2);var n;if(i>f||f<i){return n}var e=j[m];var g=e.get("TaskSequenceId");g=parseInt(g);var k=e.get("TaskProjectId");if(l===g){if("null"===k||k==h){n=e;return n}}else{if(g>=l){n=this.binarySearch(i,m-1,j,l,h)}else{n=this.binarySearch(m+1,f,j,l,h)}}return n},getTaskBySequenceId:function(k,l){var i=this;var f=Ext.ComponentQuery.query("#dpmprojectgantt")[0];var g=k.get("Id");var j=f.taskStore.toArray();var m=j.length;var n=null;n=this.binarySearch(0,m-1,j,l,g);if(!n){var e=k.get("Name");var h=this.getExternalProjectTaskBySequenceId(e,l);n={Id:h}}return n},getExternalProjectTaskBySequenceId:function(f,j){var i=this;var g=enoviaServer.computeUrl("/programcentral/");var e=g+"gantt/data/emxGanttService.jsp?mode=getExternalProjectsTaskId&extProjectName="+f+"&fromSequenceId="+j+"&SecurityContext="+enoviaServer.securityContext;var h={url:e,type:"GET",async:false,dataType:"json",callback:function(k){if(k.success=="200"){var l=k.taskId;i.taskId=l}}};if("undefined"==typeof widget){Ext.Ajax.request({url:e,async:false,success:function(k){var m=JSON.parse(k.responseText.trim());if(m.success=="200"){var l=m.taskId;i.taskId=l}}})}else{d(h)}return i.taskId},hasCircularDependency:function(u,z){var G=Ext.ComponentQuery.query("#dpmprojectgantt")[0];var J=true;var m=[-1,-3,-4,-9,];var q={SS:0,SF:1,FS:2,FF:3};var D=z.data.Id;var n=z.data.Name;n+=", id:"+z.data.TaskSequenceId;var j=App.Nls["emxComponents.Task.CircularDependancyDetected"];j=j.replace("{0}",n);var r=[];var H=G.getDependencyStore();var t=z.getIncomingDependencies(H);var x=[];for(var y=0;y<t.length;y++){var w=t[y].data;x.push(w.From)}var v=u.split(",");for(var y=0;y<v.length;y++){var f=true;var p=null;var I=null;var C=v[y];var k=C.split(":");var h=k.length>2;if(h){var B=k[0];var F=k[1];I=k[2];var g=this.getSubProjectByName(B);if(g!=null){var o=this.getTaskBySequenceId(g,F);p=o.Id||o.get("Id")}else{f=false}}else{var F=k[0];I=k[1];var A=G.taskStore.getModelById(D);var s=null;var E=A.data.EnglishType;if(E=="ProjectSpace"||E=="ProjectConcept"||E=="Experiment"){s=G.taskStore.toArray()[1].get("Id")}else{s=A.get("TaskProjectId")}var g=G.taskStore.getModelById(s);var o=this.getTaskBySequenceId(g,F);p=o.Id||o.get("Id")}I=I.substring(0,2);I=q[I.toUpperCase()];if(f){var l={};l.From=p;l.To=D;l.Type=I;r.push(l)}if(!f||x.indexOf(p)!=-1){continue}if(!h||f){var e=H.getDependencyError(p,D,I);if(m.indexOf(e)!=-1){alert(j);return J}}}if(r.length){this.updateStoreWithNewDependency(r,z)}return !J},validateDependency:function(x,u){u=u.trim();if(u&&u!=""){var n=App.Nls.dependencyTypes;var g=n[0];var l=n[1];var v=n[2];var z=n[3];var A=App.Nls.Active;var q=App.Nls.Review;var k=App.Nls["emxProgramCentral.Common.InValidProjectSpaceDependency"];var m=App.Nls["emxProgramCentral.Common.InValidProjectTemplateDependency"];var f=(App.Infra.TypeOf.ProjectTemplate)?m:k;f=f.replace(/\\n/g,"\n");var i=App.Nls["emxProgramCentral.WBS.editDependency.errorMessage"];var w=App.Nls["emxProgramCentral.Common.InValidRepetitionDependency"];var o=this.parseDependencyString(u);u=o.validationValue;var y=this.validateDependencySyntax(u);if(!y){alert(f);return false}else{u=o.actualValue}if(this.checkRepetativeDependancy(u)){alert(w);return false}var s=!(x.isLeaf());var r=u.toUpperCase();var B=(r.indexOf(l)!=-1||r.indexOf(z)!=-1);if(s&&B){var e=x.data.Name;var j=" "+l+" and "+z+" "+i+" "+e;alert(j);return false}var h=(r.indexOf(g)!=-1||r.indexOf(v)!=-1);if((x.data.State==A||x.data.State===q)&&h){var p=App.Nls["emxProgramCentral.DependencyNotAllowedNotice"];p=p.replace("{0}",x.data.State);alert(p);return false}if(!this.hasValidSequenceNo(u,x)){return false}if(this.hasCircularDependency(u,x)){return false}}else{var t=[];this.updateStoreWithNewDependency(t,x)}return true},validateDependencySyntax:function(f){var e=/^((([a-zA-Z0-9_-]+((\s\w+)+)?:)?\d+:[FSfs]{2}([\+\-]\d+(\.\d+)?\s[DdHh])?)(\,((\w+((\s\w+)+)?:)?\d+:[FSfs]{2}([\+\-]\d+(\.\d+)?\s[DdHh])?))*)?$/;if(App.Infra.TypeOf.ProjectTemplate){e=/^((\d+:[FSfs]{2}([\+\-]\d+(\.\d+)?\s[DdHh])?)(\,(\d+:[FSfs]{2}([\+\-]\d+(\.\d+)?\s[DdHh])?))*)?$/}return e.test(f)},parseDependencyString:function(e){if(e&&e!=""){e=e.trim();var l=new Array("","");var k=App.Nls["emxProgramCentral.KeyinDependency.Default"];var n=":"+k;var m=e;var p=",";var g=m.split(",");for(var h=0;h<g.length;h++){var o=g[h];if(o){o=o.trim();if(!isNaN(o)){g[h]=o+n;o=g[h]}else{var f=(o.split(":").length-1);if(f==2){o="TestPRJ:"+o.substring(o.indexOf(":")+1,o.length)}}if(h==0){l[0]=g[h].trim();l[1]=o.trim()}else{l[0]+=p+g[h].trim();l[1]+=p+o.trim()}}}var j={actualValue:l[0],validationValue:l[1]};return j}else{var j={actualValue:"",validationValue:""};return j}},isValidExternalProject:function(e){return true;var h=this.getSubProjectByName(e);if(!h){var f=this.getExternalProjectsName();if(f&&f.indexOf(e)!=-1){return true}var g=App.Nls["emxProgramCentral.Common.Dependency.InvalidExternalProject"];g=g.replace("<ProjectName>",e);alert(g);return false}return true},getExternalProjectsName:function(){var e=new Array();Ext.Ajax.request({url:"",async:false,success:function(f){var g=JSON.parse(f.responseText.trim());e=g}});return e},getSubProjectByName:function(f){var e=Ext.ComponentQuery.query("#dpmprojectgantt")[0];var l=e.taskStore.toArray();var m=null;for(var k=0,h=l.length;k<h;k++){var g=l[k].data.EnglishType;if(l[k].data.Name==f&&(g=="ProjectSpace"||g=="ProjectConcept"||g=="Experiment")){m=l[k];break}}return m},enableButtons:function(f){for(var e=0;e<f.length;e++){Ext.getCmp(f[e].trim()).enable()}},disableButtons:function(f){for(var e=0;e<f.length;e++){Ext.getCmp(f[e].trim()).disable()}},isValidRMBOperation:function(g,h){var e=Ext.ComponentQuery.query("#dpmprojectgantt")[0];var f=b.actionType;if(e.crudManager.hasChanges()){var i=confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]);if(i){e.getCrudManager().reject()}else{return false}}if(!this.isRecordSelectionOkForAddOrDeleteTask(h)){return false}if(this.isDeleteTask(h)&&!confirm(App.Nls["emxProgramCentral.Project.ConfirmTaskDelete"])){return false}if(this.isAddAsSubTask(h)&&!this.cnfrmToRemoveSelectedTaskDependency(g)){return false}if(this.isDeleteTask(h)){this.filterTasksBeforeDelete()}return true},isValidAddTaskAbove:function(f){if(this.isRootNode(f)){return false}var e=(f.parentNode.data.hasEditAccess=="TRUE");if(!e){return false}if(!this.isSelTaskInActiveOrPrior(f.parentNode)){return false}return true},isValidAddSubTask:function(e){if(e.data.hasEditAccess!="TRUE"){return false}if(!this.isSelTaskInActiveOrPrior(e)){return false}if(e.isMilestone()&&e.isLeaf()){return false}return true},isValidDeleteTask:function(e){var h=App.Nls.Create;var g=App.Nls.Assign;var f=e.data.State;if(this.isRootNode(e)){return false}if(e.data.hasEditAccess!="TRUE"){return false}if(!(h==f||g==f)){return false}return true},filterTasksBeforeDelete:function(){this.filterTasksBeyondAssignState()},filterTasksBeyondAssignState:function(){var k=Ext.ComponentQuery.query("#dpmprojectgantt")[0];var n=App.Nls.Create;var e=App.Nls.Assign;var p=new Array();var h=k.lockedGrid.getSelectionModel();var f=h.selected.items;for(var m=0,l=f.length;m<l;m++){var o=f[m].id;var g=k.taskStore.getModelById(o);var q=g.data.State;if(!(n==q||e==q)){k.lockedGrid.getSelectionModel().deselect(g);p.push(g.data.Name);--m;--l}}if(p.length>0){alert(App.Nls["emxProgramCentral.Common.UnableToDeleteTasks"]+"\n"+p)}},filterBy_Mandatory_Effort_Effectivity:function(g){var j=g.MandExcludeTaskIds;var h="";if(j.length>0){var e=this.deSelectAndGetNames(j);if(e.length>0){h="\n"+h+App.Nls["emxProgramCentral.Common.CannotDeleteMandatoryTask"]+"\n"+e+"\n"}}var f=g.TaskIdsWithEffort;if(f.length>0){var e=this.deSelectAndGetNames(f);if(e.length>0){h="\n"+h+App.Nls["emxProgramCentral.WeeklyTimeSheet.DeleteTask.TaskWithEffortCannotBeDeleted"]+"\n"+e+"\n"}}var i=g.MilestoneListUsedInEffectivity;if(i){var e=this.deSelectAndGetNames(i);if(e.length>0){h="\n"+h+App.Nls["emxProgramCentral.Common.CannotDeleteMilestoneEffectivityTask"]+"\n"+e}}if(h.length>0){return h}},getAsArr:function(e){if(e.indexOf("[")!=-1&&e.indexOf("]")!=-1){e=e.substring(1,e.length-1)}return e.split(",")},deSelectAndGetNames:function(n){var f=Ext.ComponentQuery.query("#dpmprojectgantt")[0];var l=new Array();var e=f.lockedGrid.getSelectionModel();for(var k=0,g=n.length;k<g;k++){var h=n[k].trim();var m=f.taskStore.getModelById(h);e.deselect(m);l.push(m.data.Name)}return l},isParentInActiveOrPrior:function(h){var f=App.Nls.Active;var g=App.Nls.Review;var e=App.Nls.Complete;var i=h.parentNode.data.State;if(i==g||i==e){return false}return true},isSelTaskInActiveOrPrior:function(g){var f=App.Nls.Review;var e=App.Nls.Complete;var i=App.Nls.Archive;var h=g.data.State;if(h==f||h==e||h==i){return false}return true},cnfrmToRemoveSelectedTaskDependency:function(p){var g=Ext.ComponentQuery.query("#dpmprojectgantt")[0];var h=p.getIncomingDependencies(g.getDependencyStore());for(var n=0,l=h.length;n<l;n++){var o=h[n].data.Type;if(o=="1"||o=="3"){var e=App.Nls.dependencyTypes;var m=e[1];var k=e[3];var f=App.Nls["emxProgramCentral.WBS.addSubtask.ConfirmToRemoveDependency"];f=f.replace("<dependencyType1>",m);f=f.replace("<dependencyType3>",m);f=f.replace("<dependencyType2>",k);f=f.replace("<dependencyType4>",k);return confirm(f)}}return true},isRecordSelectionOkForAddOrDeleteTask:function(g){var e=Ext.ComponentQuery.query("#dpmprojectgantt")[0];var f=e.lockedGrid.getSelectionModel().selected.length;if((this.isAddTask(g)&&f!=1)){alert(App.Nls["emxFramework.Common.PleaseSelectOneItemOnly"]);return false}else{if(this.isDeleteTask(g)){if(f<1){alert(App.Nls["emxFramework.Common.PleaseSelectitem"]);return false}else{if(f>1950){alert(App.Nls["emxProgramCentral.Common.TooManySelected"]);return false}}}}return true},isAddAsSubTask:function(f){var e=b.actionType;if(e.ADD_SUB_TASK==f||e.ADD_PHASE==f||e.ADD_GATE==f||e.ADD_MILESTONE==f){return true}return false},isAddTask:function(f){var e=b.actionType;return(this.isAddAsSubTask(f)||e.ADD_TASK_ABOVE==f)},isDeleteTask:function(e){return !this.isAddTask(e)},isRootNode:function(e){return(e.data.TaskSequenceId==""||e.data.TaskSequenceId==undefined)},isValidTaskResize:function(k,i,j){var f=Ext.ComponentQuery.query("#dpmprojectgantt")[0];if(!k.isDurationEditable()){return false}var n=i.currentTarget.className;var m=(n.indexOf("start")>-1)?"StartStretch":"EndStretch";var l=k.get("TaskProjectId");l=(l=="null")?k.id:l;var h=f.taskStore.getModelById(l);var g=h.get("ScheduleFrom");if(("StartStretch"===m&&"Project Start Date"===g)||("EndStretch"===m&&"Project Finish Date"===g)){return false}return true},isValidManageResourceAction:function(g){var i=Ext.ComponentQuery.query("#dpmprojectgantt")[0];if(g.isReadOnly()){return false}var l=App.Infra.TypeOf.Experiment;var m=App.Infra.TypeOf.ProjectTemplate;var f=App.Infra.TypeOf.ProjectBaseline;var k=g.data.EnglishType;if(l||m||f||k=="ProjectSpace"){return false}var j=i.taskStore.getRoot().childNodes[0];var e=j.data.EnglishType;if(e=="ProjectSpace"&&k!="ProjectSpace"){var h=j.data.Policy;if(h!="Project Space"){return false}else{var n=g.data.PercentDone;if(100==n){return false}}}return true},isGanttChartReadOnly:function(){var f=false;var e=Ext.ComponentQuery.query("#dpmprojectgantt")[0];if(e){f=e.isReadOnly()}return f},validateBadNameChar:function(f){var i=true;var g=enoviaServer.computeUrl("/programcentral/");var e=g+"emxProgramCentralUtil.jsp?mode=getBadChars&SecurityContext="+enoviaServer.securityContext;var h={url:e,type:"GET",async:false,dataType:"json",callback:function(l){if(l.badChars){var n=App.Nls["emxProgramCentral.ProjectImport.InvalidCharacterInTaskName"];var n=n+"\n"+l.badChars;var j=l.badChars.split(" ");for(var m=0;m<j.length;m++){var k=j[m];if(f.indexOf(k)!=-1){i=false;alert(n);break}}}}};if("undefined"==typeof widget){Ext.Ajax.request({url:e,async:false,success:function(l){if(l.status=="200"){var o=JSON.parse(l.responseText.trim());var n=App.Nls["emxProgramCentral.ProjectImport.InvalidCharacterInTaskName"];var n=n+"\n"+o.badChars;var j=o.badChars.split(" ");for(var m=0;m<j.length;m++){var k=j[m];if(f.indexOf(k)!=-1){i=false;alert(n);break}}}}})}else{d(h)}return i},getStoreTaskExpandStatus:function(g){var j=g.getData().items;var f=j.length;for(var h=0;h<f;h++){var e=g.getData().items[h];if(e.get("leaf")==false){var k=e.get("expanded");if(k==true){App.Infra.expandStatus[e.get("Id")]=true}}}},isReadyToExpand:function(i,m,e){var k=this;var f=false;var l=Ext.ComponentQuery.query("#dpmprojectgantt")[0];var g=i?i.data.depth:(e?e:0);if(App.Infra.Load.Level!=undefined){var h=App.Infra.Load.Level;if((h>=g&&g!=0)||h==0){m();return true}else{if(g>=5||g==0){App.Infra.Load.Level=0}else{App.Infra.Load.Level=g}}}if(i){i.set("expanded",true);f=true}var j=l.getTaskStore();new UWA.Promise(function(o,n){l.crudManager.transport.load.resolve=o;if(f){k.getStoreTaskExpandStatus(j)}console.time("load");l.crudManager.load();console.timeEnd("load")}).then(function(n){m()})},}});