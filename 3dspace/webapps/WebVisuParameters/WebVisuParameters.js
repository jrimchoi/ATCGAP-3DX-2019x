define("DS/WebVisuParameters/CSICustomNodeHandler",["UWA/Class","DS/Visualization/Node3D"],function(a,c){var b=a.extend({init:function(){},handleMessage:function(d){return c()},handleUpdateMessage:function(e,d){return}});return b});define("DS/WebVisuParameters/InfiniteGeometryParameterHelper",["UWA/Class","DS/CSIViewModelWebInterfaces/CSIVMClientInfiniteGeometryParameter","DS/CSIViewModelWebInterfaces/CSIVMClientInfiniteDrawGroupParameter","DS/SceneGraphNodes/FixedSizeArrowNode","DS/SceneGraphNodes/FixedSizePlaneNode","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/Node3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/TextNode","DS/SceneGraphNodes/RefPlaneNode","DS/Visualization/GraphicAttributeSet"],function(n,h,p,o,f,d,r,e,i,k,g,l,m,q){var b=p.prototype.infiniteGeomTypeValues;var a=0.264583333;var j=new r.Color(0);var s=new r.ParticleBasicMaterial({size:4,color:j,blending:r.NormalBlending,depthTest:false,sizeAttenuation:false,transparent:false,force:true});var c=[1,2,3,4,5,6,7,8,9];var t=n.extend({init:function(u){this.parameter=u;this.newMatInherit=window.newMaterialInheritance;this.newMatInheritCSI=window.newMaterialInheritanceCSI},getInfiniteGeometry:function(I){var ar=window.devicePixelRatio||1;var Z=this.parameter.getInfiniteDrawGroups();var aA=[];var ad=[];var ay=this.parameter.getInfiniteBufferPartition(this.parameter.infiniteBufferPartitionValues.infiniteGeometryArray);if(!ay||!ay.getByteLength()||!ay.getBytePerElement()){return{geometry:undefined,primitiveIDs:undefined}}var O=new Float32Array(this.parameter.getBuffer(),ay.getOffset(),ay.getByteLength()/ay.getBytePerElement());var P=null;var A=this.parameter.getInfiniteBufferPartition(this.parameter.infiniteBufferPartitionValues.additionalDataArray);if(A&&A.getByteLength()&&A.getBytePerElement()){P=new Uint8Array(this.parameter.getBuffer(),A.getOffset(),A.getByteLength()/A.getBytePerElement())}var ac=0,L=0,H=0;for(var au=0;au<Z.length;au++){var av=Z[au];var ab=av.getInfiniteGeomType();var ae=new Uint32Array(this.parameter.getBuffer(),av.getStart(),av.getCount()*3);for(var at=0;at<av.getCount();++at){ac=ae[3*at];L=ae[3*at+1];H=ae[3*at+2];var X;var B=true;switch(ab){case b.origin:var am=[O[L++],O[L++],O[L++]];var ak=P[H++];if(ak>8){ak=7}var v={positions:am,number:1,color:j};window.newMaterialInheritance=this.newMatInheritCSI;X=new i();var G=d.createPointsNode(v);var u=new r.Sphere(new r.Vector3(am[0],am[1],am[2]));u.pixelRadius=1;G.forceBoundingSphere(u);G.setPickParent(true);X.addChild(G);window.newMaterialInheritance=this.newMatInherit;if(this.newMatInheritCSI){G._setGAS(new q({colorRGB:j,symbolType:ak,inheritance:r.GASEnum.RGB_INHERIT|r.GASEnum.SYMBOLTYPE_INHERIT}))}else{var S=I.getMaterialManager();var ai=s;if(S){var ax={color:j,size:3,symbol:c[ak]};ai=S.getMaterialFromGAS(ax)}G.setMaterial(ai)}X.traverse(this._CBOnTraversal,r.GeomTypeEnum.FREE_POINT);break;case b.points:var x=O[L++];var ag=[];for(var aq=0;aq<3*x;++aq){ag.push(O[L++])}var ak=P[H++];if(ak>8){ak=7}var v={positions:ag,number:x,color:new r.Color("black")};window.newMaterialInheritance=this.newMatInheritCSI;X=new i();var G=d.createPointsNode(v);G.setPickParent(true);X.addChild(G);window.newMaterialInheritance=this.newMatInherit;if(this.newMatInheritCSI){G._setGAS(new q({colorRGB:j,symbolType:ak}))}else{var S=I.getMaterialManager();var ai=s;if(S){var ax={color:j,size:3,symbol:c[ak]};ai=S.getMaterialFromGAS(ax)}G.setMaterial(ai)}X.traverse(this._CBOnTraversal,r.GeomTypeEnum.FREE_POINT);break;case b.axis:var V=O[L++];V*=1/a;var am=new r.Vector3(O[L++],O[L++],O[L++]);var K=new r.Vector3(O[L++],O[L++],O[L++]);var ao=O[L++];ao*=1/a;var N="CSIFixedSizeArrowNode";var C=P[H++];if(C>0){var J=[];for(var aq=0;aq<C;++aq){J.push(String.fromCharCode(P[H++]))}N=J.join("")}X=new i();var E=new r.Vector3(0,0,1);var D=new r.Vector3().crossVectors(E,K).normalize();var af=new r.Matrix4().makeRotationAxis(D,E.angleTo(K)).setPosition(am);X.setMatrix(af);var v={name:"arrow",pickable:true,color:new r.Color("black"),head:(ao>0)?o.types.ARROW:o.types.NONE,arrowLength:V,arrowWidth:1,headLength:ao,globalSelection:true};window.newMaterialInheritance=this.newMatInheritCSI;var y=new o(v);y.setPickParent(true);window.newMaterialInheritance=this.newMatInherit;var aj=new i("labelNode");aj.setPickParent(true);var aw=new l("myText");aw.setPickParent(true);aw.setBillboard(true,false);aw.setFixedSize(true);aw.textMaterial.uniforms.invSize.value.set(1/debugWebGLV6Viewer.renderer.deviceWidth,1/debugWebGLV6Viewer.renderer.deviceHeight);aw.addText({string:N,anchor:new r.Vector3(),color:new r.Color(0),size:20*ar,lineLength:500,up:new r.Vector3(0,0,1),right:new r.Vector3(0,1,0),});var ah=new r.Matrix4();aw.setPrimitivePicking(false);X.addChild(y);aj.addChild(aw);aj._setRatio(1);aj._setFixedSizeCenter(new r.Vector3(0,0,V),1);X.addChild(aj);X.traverse(this._CBOnTraversal,r.GeomTypeEnum.AXIS_SYSTEM);break;case b.infinite_plane:var Q=O[L++];Q*=1/a;var am=new r.Vector3(O[L++],O[L++],O[L++]);var an=new r.Vector3(O[L++],O[L++],O[L++]);var al=new r.Vector3(O[L++],O[L++],O[L++]);var W=P[H++];if(!W){var z=new r.Vector3().crossVectors(an,al);var aa=new r.Matrix4();aa.makeBasis(an,al,z);aa.setPosition(am);var v={name:"refPlane",fill:true,fixedSize:true,size:new r.Vector2(Q,Q),planeAttributes:{front:{color:new r.Color("#005686"),opacity:0.075},back:{color:new r.Color("#a3c8dc"),opacity:0.075}},borderAttributes:{front:{color:new r.Color("#005686"),opacity:0.8,width:1},back:{color:new r.Color("#a3c8dc"),opacity:0.8,width:1}},textAttributes:{fixedSize:true,front:{data:"",color:new r.Color("#005686"),opacity:1,size:30},back:{data:"",color:new r.Color("#a3c8dc"),opacity:1,size:30}}};window.newMaterialInheritance=this.newMatInheritCSI;B=false;X=new m(v);window.newMaterialInheritance=this.newMatInherit;X.setMatrix(aa)}else{X=d.createFixedSizeNode({name:"CSIFixedSizeHalfPlaneNode",ratio:1});X.setMatrix(new r.Matrix4().setPosition(am));var F=(((an.clone()).add(al)).normalize()).multiplyScalar(Q*1.4142136/2);var T=(am.clone()).add(F);var U=(T.clone()).add(an.multiplyScalar(Q/2));var R=(T.clone()).add(al.multiplyScalar(Q/2));var ap=d.createLineNode({points:[U,T,R],color:new r.Color("black")});ap.setPickParent(true);ap.setMatrix(new r.Matrix4().setPosition(am.negate()));X.addChild(ap)}X.traverse(this._CBOnTraversal,r.GeomTypeEnum.INFINITE_FACE);break;case b.text:var am=new r.Vector3(O[L++],O[L++],O[L++]);var w=O[L++];var Y=function(aC){if(Array.isArray(aC)){var aD=new ArrayBuffer(aC.length);var aB=new DataView(aD);aC.forEach(function(aE,aF){aB.setUint8(aF,aE)});return aB}};var M=[];for(var aq=0;aq<4;++aq){M.push(P[H++])}var Q=Y(M.reverse()).getUint32(0);var N="";if(Q>0){var J=[];for(var aq=0;aq<Q;++aq){J.push(String.fromCharCode(P[H++]))}N=J.join("")}var az=new l("CSIText");az.setPrimitivePicking(false);az.textMaterial.side=2;az.addText({string:N,anchor:new r.Vector3(am.x,am.y,0),color:new r.Color(0),size:w,lineLength:500,up:new r.Vector3(0,1,0),right:new r.Vector3(1,0,0),});az.setPickParent(true);X=new i();X.addChild(az);break}if(X){if(B){X.setNoZ(true)}ad.push(X);aA.push(ac)}}}return{geometry:ad,primitiveIDs:aA}},_CBOnTraversal:function(w,u){if(w===undefined){return true}if(w.getNodeType()==="Mesh3D"){var v=w.mesh3js.geometry[0];v.drawingGroups.forEach(function(x){x._geomType=u})}return false}});return t});define("DS/WebVisuParameters/GeometryParameterHelper",["UWA/Class","DS/CSIViewModelWebInterfaces/CSIVMClientGeometryParameter","DS/CSIViewModelWebInterfaces/CSIVMClientDrawGroupParameter","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/GraphicAttributeSet"],function(c,b,e,l,f,k){var a=e.prototype.geomTypeValues;var j={};j[a.unknown]={glType:4,geomType:l.GeomTypeEnum.UNKNOWN};j[a.edge]={glType:1,geomType:l.GeomTypeEnum.EDGE};j[a.wire_Edge]={glType:1,geomType:l.GeomTypeEnum.WIRE_EDGE};j[a.boundary_Edge]={glType:1,geomType:l.GeomTypeEnum.BOUNDARY_EDGE};j[a.sharp_Edge]={glType:1,geomType:l.GeomTypeEnum.SHARP_EDGE};j[a.smooth_Edge]={glType:1,geomType:l.GeomTypeEnum.SMOOTH_EDGE};j[a.hidden_Seam_Edge]={glType:1,geomType:l.GeomTypeEnum.HIDDEN_SEAM_EDGE};j[a.boundary_Point]={glType:0,geomType:l.GeomTypeEnum.BOUNDARY_POINT};j[a.sharp_Point]={glType:0,geomType:l.GeomTypeEnum.SHARP_POINT};j[a.smooth_Point]={glType:0,geomType:l.GeomTypeEnum.SMOOTH_POINT};j[a.hidden_Seam_Point]={glType:0,geomType:l.GeomTypeEnum.HIDDEN_SEAM_POINT};j[a.surfacic_Point]={glType:0,geomType:l.GeomTypeEnum.SURFACIC_POINT};j[a.free_Point]={glType:0,geomType:l.GeomTypeEnum.FREE_POINT};j[a.infinite_Face]={glType:4,geomType:l.GeomTypeEnum.INFINITE_FACE};j[a.face]={glType:4,geomType:l.GeomTypeEnum.FACE};var h=new l.MeshPhongMaterial({side:l.DoubleSide,color:new l.Color(16777215)});var d=new l.MeshPhongMaterial({side:l.FrontSide,color:new l.Color(16777215)});var g=new k({colorRGB:new l.Color(16777215)});var m=new k({colorRGB:new l.Color(0),inheritance:l.GASEnum.RGBA_INHERIT});var i=c.extend({init:function(o,n){this.parameter=o;this.version=n.version;this.hasGeomDecorations=n.hasGeomDecorations;this._newMatInherit=window.newMaterialInheritanceCSI},getGeometry:function(u,S){var I=u.getDefaultMaterials();var A=I.volume;var q=I.surface;var s=I.line;var C=I.point;var v=new l.BufferGeometryDS();var o;var ad;var x=[];var aa=0;for(var U in this.parameter.bufferPartitionValues){var Q=this.parameter.bufferPartitionValues[U];var G=this.parameter.getBufferPartition(Q);if(G){if(Q===this.parameter.bufferPartitionValues.vertexIndexArray){o=G.getBytePerElement();if(o===4){ad=new Uint32Array(this.parameter.getBuffer(),G.getOffset(),G.getByteLength()/o)}else{ad=new Uint16Array(this.parameter.getBuffer(),G.getOffset(),G.getByteLength()/o)}if(this.version===1){v[U]=ad}}else{if(this.hasGeomDecorations&&Q===this.parameter.bufferPartitionValues.primitiveDecorationArray){v.decorations=new Uint8Array(this.parameter.getBuffer(),G.getOffset(),G.getByteLength())}else{v[U]=new Float32Array(this.parameter.getBuffer(),G.getOffset(),G.getByteLength()/G.getBytePerElement())}}}}var O=new f.SGRep({solid:S});var K=this.parameter.getDrawGroups();var af=[];for(var ab=0;ab<K.length;ab++){var z=K[ab];var N=z.getPrimitives();N=new Uint32Array(this.parameter.getBuffer(),N.getOffset(),N.getByteLength()/N.getBytePerElement());var P=j[z.getGeomType()];var F=P.glType;var p=[];var y=[];var M;if(this._newMatInherit){M=new f.DrawingGroup((F===4)?g:m,null,F,(this.version===2)?aa:z.getStart(),z.getCount(),p,undefined,P.geomType,0)}else{var W=(v.vertexNormalArray&&(F===4))?(S?A:q):((F===0)?C:s);var t=(S?d:h);M=new f.DrawingGroup(t,W,F,(this.version===2)?aa:z.getStart(),z.getCount(),p,undefined,P.geomType,0)}M.geometry=v;v.drawingGroups.push(M);if(this.version===2){var T=(F===1)&&(P.geomType!==l.GeomTypeEnum.WIRE_EDGE);var w=T?1:0;var ac=this.hasGeomDecorations?1:0;var r=4+w+ac;for(var Z=0;Z<N.length;Z+=r){var H=N[Z];var R=N[Z+1];var Y=w?N[Z+3+w]:true;var D=aa;if(Y){for(var X=H;X<H+R;X++){x[aa]=ad[X];aa++}}else{for(var X=0;X<R-1;X++){x[aa]=H+X;x[aa+1]=H+X+1;aa+=2}}var B=new f.SGPrimitive({start:D,count:Y?R:2*(R-1),cgmId:N[Z+2],decoration:(ac&&N[Z+3+w+ac]!==4294967295)?N[Z+3+w+ac]:undefined,rep:O,group:M});p.push(B);y.push(N[Z+3]);O.primitives.push(B)}}else{var ac=this.hasGeomDecorations?1:0;var r=4+ac;for(var Z=0;Z<N.length;Z+=r){var B=new f.SGPrimitive({start:N[Z],count:N[Z+1],cgmId:N[Z+2],decoration:(ac&&N[Z+3+ac]!==4294967295)?N[Z+3+ac]:undefined,rep:O,group:M});p.push(B);y.push(N[Z+3]);O.primitives.push(B)}}af.push(y)}if(this.version===2){if(o===4){v.vertexIndexArray=new Uint32Array(x.length)}else{v.vertexIndexArray=new Uint16Array(x.length)}for(var ab=0;ab<x.length;ab++){v.vertexIndexArray[ab]=x[ab]}}if(!v.boundingBox){var ae=[0,0,0];var E=[0,0,0];var J=v.vertexPositionArray;if(J){var L=J.length;if(L>=3){ae=[J[0],J[1],J[2]];E=[J[0],J[1],J[2]];for(var V=0;V<L;V+=3){if(J[V]<ae[0]){ae[0]=J[V]}if(J[V+1]<ae[1]){ae[1]=J[V+1]}if(J[V+2]<ae[2]){ae[2]=J[V+2]}if(J[V]>E[0]){E[0]=J[V]}if(J[V+1]>E[1]){E[1]=J[V+1]}if(J[V+2]>E[2]){E[2]=J[V+2]}}}}ae=new l.Vector3(ae[0],ae[1],ae[2]);E=new l.Vector3(E[0],E[1],E[2]);v.boundingBox=new l.Box3(ae,E);v.boundingSphere=new l.Sphere(E.clone().add(ae).multiplyScalar(0.5),E.clone().sub(ae).multiplyScalar(0.5).length())}return{geometry:v,primitiveIDs:af}},updateGeometry:function(H){if(!H){return}if(!this._newMatInherit){return}var M=H.getPrimitives();if(!Array.isArray(M)||M.length===0){return}var o={};var L;var P=0;M.forEach(function(R){L=R.getIdentificationObject();if(!L){return}P=L.getLocalId();if(P===undefined){return}o[P]=R});var w=H._occurrences[0].renderable.geometry;for(var K=0;K<w.length;K++){w[K].needsUpdate=true}var n=w[0];var E=n.vertexIndexArray;var p=n.vertexPositionArray;if(!E||!p){return}var B={};var O,u,A;for(var z in this.parameter.bufferPartitionValues){u=this.parameter.bufferPartitionValues[z];O=this.parameter.getBufferPartition(u);if(O){if(u!==this.parameter.bufferPartitionValues.vertexIndexArray){A=new Float32Array(this.parameter.getBuffer(),O.getOffset(),O.getByteLength()/O.getBytePerElement());B[z]=A;for(var K=0;K<w.length;K++){var F=w[K];var p=F.vertexPositionArray;if(p&&!F[z]){F[z]=new Float32Array(p.length)}}}}}var Q=this.parameter.getDrawGroups();var N;if(Array.isArray(Q)&&(Q.length===1)){N=Q[0]}if(!N){return}var s=N.getPrimitives();if(!s){return}s=new Uint32Array(this.parameter.getBuffer(),s.getOffset(),s.getByteLength()/s.getBytePerElement());var q,v,r,t,y,x,G,J,D,C;for(var I=0;I<s.length;I+=3){P=s[I];v=s[I+1];r=s[I+2];q=o[P];if(!q||!q.sgNode){continue}C=q.sgNode.group.geometry;var E=C.vertexIndexArray;t=q.sgNode.start;y=q.sgNode.count;G=E[t];J=G;for(var K=1;K<y;++K){x=E[K+t];if(x<G){G=x}else{if(x>J){J=x}}}D=(J-G+1)*3;if(!D||D!==r){continue}for(var z in B){for(var K=0;K<r;++K){C[z][K+3*G]=B[z][K+v]}}}}});return i});define("DS/WebVisuParameters/CustomDataParameterHelper",["UWA/Class","DS/CSIViewModelWebInterfaces/CSIVMClientCustomDataParameter","DS/Visualization/Node3D"],function(b,a,d){var c=b.extend({init:function(f,e){this.parameter=f;this.onFinishedCB=e},getNode:function(){var f=this;var e=new d();require([this.parameter.getModule()],function(h){if(!h){return}var g=new h();var i=g.handleMessage(f.parameter.getData());e.addChild(i);if(f.onFinishedCB){f.onFinishedCB()}},this.onModuleError);return e},modifyNode:function(e){var f=this;require([this.parameter.getModule()],function(h){if(!h){return}var g=new h();var k=null;if(e){k=e.children[0];var j=e.getChildren();for(var l=0;l<j.length;l++){if(!j[l].getModelIdentification()){k=j[l];break}}}g.handleUpdateMessage(f.parameter.getData(),k);if(f.onFinishedCB){f.onFinishedCB()}},this.onModuleError)},onModuleError:function(f){var e=f.requireModules&&f.requireModules[0];console.log("Module "+e+" is missing.")}});return c});define("DS/WebVisuParameters/GraphicPropertyParameterHelper",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/MaterialApplication","DS/Visualization/GraphicAttributeSet","DS/VisuLoaders/ThreeDXLoader","DS/Visualization/Node3D","DS/Visualization/Mesh3D"],function(c,j,e,b,i,a,h,n){var m=0.264583333;var d=window.devicePixelRatio;var k=[0.13,0.35,0.7,1,1.4,2,2.3,2.6];var l=new a();var g=-1;var o=new Map();var f=c.extend({init:function(p){this.parameter=p;this._newMatInherit=window.newMaterialInheritanceCSI},createOldGAS:function(s,u,p,v){var q=s;var r=u;if(q===undefined){q=p?p.color:null}if(r===undefined){r=p?p.opacity:1}var t=v.getMaterialFromGAS({color:q||undefined,opacity:r});t.line=v.getMaterialFromGAS({color:q,opacity:r,lineWidth:1});t.point=v.getMaterialFromGAS({color:q,opacity:r,symbol:0,size:4});t.force=true;return t},createGAS:function(t,v,s,r,D,z,B,u,w,q,A,p){var y=p?p._inheritance:j.GASEnum.NO_INHERIT;if(v){y&=~j.GASEnum.COLOR_INHERIT}if(r){y&=~j.GASEnum.ALPHA_INHERIT}if(z){y&=~j.GASEnum.LINETYPE_INHERIT}if(u){y&=~j.GASEnum.LINEWIDTH_INHERIT}if(q){y&=~j.GASEnum.SYMBOLTYPE_INHERIT}var C={colorRGB:t,colorA:s,lineType:D,symbolType:(w>0)?w-1:e.PointSymbolEnum.DOT,lineWidth:this.getPixelLineWidth(B),inheritance:A|y};var x=new i(C);return x},getPixelLineWidth:function(q){var p=0;if(!q||q<1||q>k.length){p=k[0]}else{p=k[q-1]}return p*d/m},applyMaterialToElt:function(w,q,v,t,p,u,r){if(!w||!w[q]){return}var s=w[q];if(p){if(this._newMatInherit){u.setMaterial(r,new b({geometricalFaceMaterial:s,layer:v,inheritance:t}))}else{u.setMaterial(r,s)}}else{if(this._newMatInherit){u._setMaterialApplication(new b({geometricalFaceMaterial:s,layer:v,inheritance:t}))}else{u.setMaterial(s)}}},applyGP:function(y,X,aa){if(y===undefined){return}if(X===undefined){return}var ag=this.parameter;if(ag===undefined){return}var s=this;var R=(Array.isArray(aa)&&aa.length>0);var v=this._newMatInherit;var G=y.getMaterialManager();var O=false;var D=j.GASEnum.NO_INHERIT;var L=undefined;var q=false;var ae=undefined;var A=false;var V=undefined;var Y=false;var H=undefined;var B=false;var N=undefined;var J=false;var Q=ag.getColorAndOpacity();if(Q!==undefined){var p=Q.getRGBO();if(p!==undefined){O=true;if(p.DefaultRGB===true){q=true;L=null}else{if(p.R!==undefined&&p.G!==undefined&&p.B!==undefined){L=new j.Color();L.setRGB(p.R/255,p.G/255,p.B/255);D|=j.GASEnum.COLOR_INHERIT}}if(p.DefaultO===true){A=true;ae=1}else{if(p.O!==undefined){ae=p.O/255;D|=j.GASEnum.ALPHA_INHERIT}}}}var W=ag.getLineicProperty();if(W!==undefined){var P=W.getLineicValues();if(P!==undefined){O=true;if(P.DefaultLineType===true){Y=true;V=e.LinePatternEnum.SOLID}else{if(P.LineType!==undefined){V=P.LineType;D|=j.GASEnum.LINETYPE_INHERIT}}if(P.DefaultLineWidth===true){B=true;H=0}else{if(P.LineWidth!==undefined){H=P.LineWidth;D|=j.GASEnum.LINEWIDTH_INHERIT}}if(P.DefaultPointType===true){J=true;N=0}else{if(P.PointType!==undefined){N=P.PointType;D|=j.GASEnum.SYMBOLTYPE_INHERIT}}}}if(O){var af=null;if(R){var F=[];if(X instanceof n){F=v?X._getGas(aa):X._getMaterials(aa)}else{aa.forEach(function(ah){if(ah instanceof h){F.push(v?ah._gas:ah.material)}})}if(Array.isArray(F)&&F.length!==0){af=F[0]}}else{af=v?X._gas:X.material}if(!v){var ad=this.createOldGAS(L,ae,af,G);if(R){if(X instanceof n){X.setMaterial(aa,ad)}else{aa.forEach(function(ah){if(ah instanceof h){ah.setMaterial(ad)}})}}else{X.setMaterial(ad)}}else{var x=this.createGAS(L,q,ae,A,V,Y,H,B,N,J,D,af);if(R){if(X instanceof n){X._setGAS(aa,x)}else{aa.forEach(function(ah){if(ah instanceof h){ah._setGAS(x)}})}}else{X._setGAS(x)}}}var M=ag.getMaterial();if(M!==undefined){var t=M.getMaterialDefinition();if(t!==undefined){if(t.DefaultMaterial===true){if(R){X.setMaterial(aa,null)}else{v?X._removeMaterialApplication():X.setMaterial(null)}}else{if(y.id!==g){g=y.id;o.clear()}var ac=t.JSON;var T=o.get(ac);var I=t.Index?t.Index:0;var K=t.Buffers;var r=t.Layer;var C=t.Inherit;if(T){this.applyMaterialToElt(T,I,r,C,R,X,aa)}else{var z=[];if(Array.isArray(K)&&K.length>0){K.forEach(function(ah){z.push({buffer:ah.getData()})})}l.load({zipped:false,json:ac,chunks:z,doneCallback:function(ah){o.set(ah.json,ah.materials);s.applyMaterialToElt(ah.materials,I,r,C,R,X,aa)}})}}}}if(!R){if(ag.getShowMode()&&(ag.getShowMode()!=="")){var U=-1;if(ag.getShowMode()==="Show"){U=1}else{if(ag.getShowMode()==="NoShow"){U=0}}if(U!==-1){X.setVisibility(U)}}if(ag.getPickMode()&&(ag.getPickMode()!=="")){var E=-1;if(ag.getPickMode()==="Pick"){E=e.PICKABLE}else{if(ag.getPickMode()==="NoPick"){E=e.NOPICKABLE}}if(E!==-1){X.setPickable(E)}}if(ag.getPickParent()&&(ag.getPickParent()!=="")){var Z=undefined;if(ag.getPickParent()==="TRUE"){Z=true}else{if(ag.getPickParent()==="FALSE"){Z=false}}if(Z!==undefined){X.traverse(function(ai,ah){if(ai){ai.setPickParent(ah)}},Z);X.setPickParent(false)}}if(ag.getExcludeFromBounding()&&(ag.getExcludeFromBounding()!=="")){var w=undefined;if(ag.getExcludeFromBounding()==="TRUE"){w=true}else{if(ag.getExcludeFromBounding()==="FALSE"){w=false}}if(w!==undefined){X.exludeFromBounding(w)}}if(ag.getStaticGeomType!==undefined){if(ag.getStaticGeomType()&&(ag.getStaticGeomType()!=="")){var S=j.GeomTypeEnum[ag.getStaticGeomType()];if(S!==undefined){X.traverse(function(aj,ah){if(aj===undefined){return true}if(aj.getNodeType()==="Mesh3D"){var ai=aj.mesh3js.geometry[0];ai.drawingGroups.forEach(function(ak){ak._geomType=ah})}return false},S)}}}if(ag.getStaticPickPriority()&&(ag.getStaticPickPriority()!=="")){X.setPickingPriorityId(ag.getStaticPickPriority())}if(ag.getStaticMaterial()&&(ag.getStaticMaterial()!=="")){var ad=y.getStaticMaterial(ag.getStaticMaterial());if(v){ad&&X._setMaterialApplication(new b({faceMaterial:ad,lineMaterial:ad.line,pointMaterial:ad.point,layer:0,inheritance:2}))}else{ad&&X.setMaterial(ad)}if(ad){X.traverse(function(ah){if(ah===undefined){return true}if(ah.getNodeType()==="Mesh3D"){ah.setMaterialMode(true)}return false})}}if(ag.getStaticLook&&(ag.getStaticLook()!=="")){var u=y.getStaticLook(ag.getStaticLook());if(u){if(v){u.material&&X._setMaterialApplication(new b({faceMaterial:u.material,lineMaterial:u.material.line,pointMaterial:u.material.point,layer:0,inheritance:2}))}else{u.material&&X.setMaterial(u.material)}if((u.shadowReceive!==undefined)||(u.shadowCast!==undefined)){var ab=[];X.traverse(function(ah){if(ah instanceof n){ab.push(ah)}});ab.forEach(function(ah){ah.setShadow&&ah.setShadow(!!u.shadowReceive,!!u.shadowCast)})}if(u.material){X.traverse(function(ah){if(ah===undefined){return true}if(ah.getNodeType()==="Mesh3D"){ah.setMaterialMode(true)}return false})}}}}}});return f});define("DS/WebVisuParameters/BoundingSphereParameterHelper",["DS/CSIViewModelWebInterfaces/CSIVMClientBoundingSphereParameter","DS/Visualization/ThreeJS_DS"],function(b,c){var a={};a.getBoundingSphere=function(e){if(!e){return null}var d=e.getRadius();var g=e.getRadiusMM();if(g===d&&g>0){d=0}if(e.getState()===e.stateValues.infinite){d=0;g=0}var f=new c.Sphere(new c.Vector3(e.getCenterX(),e.getCenterY(),e.getCenterZ()),d);f.pixelRadius=g;return f};return a});define("DS/WebVisuParameters/CSIModelIdPathParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder"],function(b,a){var c={labels:{elementsId:"elems_id",elementsNamingContext:"elems_nc",subElements:"subelems_id"},serialize:function(g,j){var d=[],h=[];var f,e;for(f=0;f<j.elements.length;f++){e=j.elements[f];d.push(e.id);h.push(e.namingContext)}g.writeUint32Array(c.labels.elementsId,d);g.writeUint8Array(c.labels.elementsNamingContext,h);g.writeUint32Array(c.labels.subElements,j.subElements)},unserialize:function(g){var j={elements:[],subElements:[]};var d=g.readUint32Array(c.labels.elementsId);var h=g.readUint8Array(c.labels.elementsNamingContext);var e=g.readUint32Array(c.labels.subElements);var f;for(f=0;f<d.length;f++){j.elements.push({id:d[f],namingContext:h[f]})}for(f=0;f<e.length;f++){j.subElements.push(e[f])}return j}};a.declareType({type:"CATModelIdPath",serialize:c.serialize,unserialize:c.unserialize});return c});define("DS/WebVisuParameters/CSIViewParameterLabels",[],function(){var a={viewStatus:"viewStatus",idPatterns:"idPatterns",graphicProperties:"GraphicProperties",treeUpdates:"treeUpdates",viewStatusTemporary:"temporary",viewStatusPermanent:"permanent",viewStatusCommit:"commit",viewStatusAbort:"abort",showMode:"ShowMode",staticMaterial:"SetStaticMaterial",staticPickPriority:"SetStaticPickPriority",id:"id",idSpace:"idSpace",idContext:"idContext",shared:"shared",treeKey:"treeKey",tokens:"tokens",appliedGas:"AppliedGraphicProperties",node:"Node",value:"value",localIdInt:"localId_Int",localIdString:"localId_String",idPattern:"idPattern",parent:"parent",valueAddNode:"AddNode",valueAddCustomNode:"AddCustomNode",valueModifyCustomNode:"ModifyCustomNode",valueAddExistingNode:"AddExistingNode",valueAddExistingCell:"AddExistingCell",valueRemoveExistingCell:"RemoveExistingCell",valueRemoveExistingNode:"RemoveExistingNode",valueAddBody:"AddBody",valueAddCells:"AddCells",valueRemoveAll:"RemoveAll",valueMesh:"mesh",valueBoundingSphere:"bs",valueBoundingBox:"bbox",valueInitializers:"inits",valueCustomData:"customdata",valueGeometry:"geometry",valueGeometries:"geometries",valueOffset:"offset",valueByteLength:"bytelength",valueBytePerElement:"bpe",valueDrawGroups:"dgs",valueStart:"start",valueCount:"count",valueGeomType:"geomType",valuePrimitives:"primitives",valueBuffer:"buffer",valueBufferPartitions:"bufferPartitions",valueBufferPartition:["vertexPositionArray","vertexIndexArray","vertexColorArray","vertexNormalArray","vertexBinormalArray","vertexTangentArray","vertexUvArray","vertexUv2Array"],valueGeomTypeValue:["EDGE","WIRE_EDGE","BOUNDARY_EDGE","SHARP_EDGE","SMOOTH_EDGE","BOUNDARY_POINT","SHARP_POINT","SMOOTH_POINT","SURFACIC_POINT","FREE_POINT","INFINITE_FACE","FACE"],glTypeFromGeomType:{EDGE:1,WIRE_EDGE:1,BOUNDARY_EDGE:1,SHARP_EDGE:1,SMOOTH_EDGE:1,BOUNDARY_POINT:0,SHARP_POINT:0,SMOOTH_POINT:0,SURFACIC_POINT:0,FREE_POINT:0,INFINITE_FACE:4,FACE:4},valueRadius:"rad",valueState:"state",valueStateValue:["EMPTY","NORMAL","INIFINITE","CONTAIN"],valueX1:"x1",valueY1:"y1",valueZ1:"z1",valueX2:"x2",valueY2:"y2",valueZ2:"z2",shortId:"shortId",idPath:"idPath",valueBinaryFormat:"binaryformat",valueClientModule:"clientmodule",valueData:"Data",valueBinaryFormatValue:["Bin","Cgr"]};return a});define("DS/WebVisuParameters/CSISelectionObject",["UWA/Class","DS/Visualization/ViewManager","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels","DS/VisuIdentification/Converter"],function(b,k,c,a,f){var i=false;var e=new f();var h=new k();var d=b.extend({init:function(l){this.treeKey=l.treeKey||"";this.idPath=l.idPath||null;if(h&&h.viewer&&!h.viewer.newModelIdentification){this.declareType()}},fromPathElement:function(o){this.idPath=e.buildGlobalId(o);var p=o.getLength();var n=null;for(var m=p-1;(m>=0)&&(!n);m--){var l=o.getElement(m);if(l){n=h.getKey(l)}}if(n!==null){this.treeKey=n}},getPathElement:function(){var l=h.getView(this.treeKey);var m=e.decodeGlobalId(l,this.idPath);return m}});var j=function(m,l){m.writeString(a.treeKey,l.treeKey);m.writeString(a.idPath,l.idPath)};var g=function(l){var m={treeKey:l.readString(a.treeKey),idPath:l.readString(a.idPath)};return new d(m)};d.prototype.declareType=function(){if(i){return}c.declareType({type:"CSISelectionObject",serialize:j,unserialize:g});i=true};return d});define("DS/WebVisuParameters/CSIBoundingBoxParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels","DS/Visualization/ThreeJS_DS"],function(d,c,h,g){var b=false;var e=d.extend({init:function(i){this.minX=i.minX||0;this.minY=i.minY||0;this.minZ=i.minZ||0;this.maxX=i.maxX||0;this.maxY=i.maxY||0;this.maxZ=i.maxZ||0;this.state=i.state||h.valueStateValue[0]},getBoundingBox:function(){return g.Box3(new g.Vector3(this.minX,this.minY,this.minZ),new g.Vector3(this.maxX,this.maxY,this.maxZ))}});var f=function(i){};var a=function(i){var j={minX:i.readDouble(h.valueX1),minY:i.readDouble(h.valueY1),minZ:i.readDouble(h.valueZ1),maxX:i.readDouble(h.valueX2),maxY:i.readDouble(h.valueY2),maxZ:i.readDouble(h.valueZ2),state:i.readString(h.valueState)};return new e(j)};e.prototype.declareType=function(){if(b){return}c.declareType({type:"CSIBoundingBoxParam",serialize:f,unserialize:a});b=true};return e});define("DS/WebVisuParameters/CSIViewTreeObjectParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels","DS/VisuIdentification/Converter","DS/Visualization/Node3D","DS/Visualization/Mesh3D"],function(b,c,a,e,g,i){var d=new e();var j=false;var f=b.extend({init:function(l){this.shortId=l.shortId||null;this.idPath=l.idPath||null},getParentNode:function(m,o,l){var n=null;if(this.shortId!==null){n=o.createdNodes[this.shortId];if(!n){if(!l){n=new g()}else{n=new i();n.setShadow(true,true);n.mesh3js.geometry=n._occurrences[0].renderable.geometry}o.createdNodes[this.shortId]=n}}else{if(this.idPath!==null){var p=d.decodeGlobalId(m,this.idPath);n=p.getLastElement(true)}else{n=m}}return n}});var k=function(l){};var h=function(l){var m={shortId:l.readInt32(a.shortId),idPath:l.readString(a.idPath)};return new f(m)};f.prototype.declareType=function(){if(j){return}c.declareType({type:"CSIViewTreeObjectParam",serialize:k,unserialize:h});j=true};return f});define("DS/WebVisuParameters/CSIBinaryRangeParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels"],function(d,c,g){var b=false;var f=d.extend({init:function(h){this.offset=h.offset||0;this.byteLength=h.byteLength||0;this.bpe=h.bpe||0}});var e=function(h){};var a=function(h){var i={offset:h.readUint32(g.valueOffset),byteLength:h.readUint32(g.valueByteLength),bpe:h.readUint32(g.valueBytePerElement)};return new f(i)};f.prototype.declareType=function(){if(b){return}c.declareType({type:"CSIBinaryRangeParam",serialize:e,unserialize:a});b=true};return f});define("DS/WebVisuParameters/CSIAppliedGasTokenParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels","DS/WebVisuParameters/CSIViewTreeObjectParameter"],function(f,d,h,e){var c=false;var b=f.extend({init:function(i){this.id=i.id||0;this.node=i.node||null},execute:function(i,n){var m=n.graphicProperties;var l=m[this.id];if(!l||!this.node){return}var k=this.node.getParentNode(i,n,false);if(!k){return}if(l.showMode){k.setVisibility(l.showMode==="Show")}if(l.staticMaterial&&(l.staticMaterial!=="")){var j=n.getStaticMaterial(l.staticMaterial);j&&k.setMaterial(j)}if(l.staticPickPriority&&(l.staticPickPriority!=="")){k.setPickingPriorityId(l.staticPickPriority)}}});var g=function(i){};var a=function(i){var j={id:i.readInt32(h.id),node:i.readObject(h.node,"CSIViewTreeObjectParam")};return new b(j)};b.prototype.declareType=function(){if(c){return}d.declareType({type:"CSIViewTreeAppliedGPTokenParam",serialize:g,unserialize:a});c=true;e.prototype.declareType()};return b});define("DS/WebVisuParameters/CSIGraphicPropertyParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels"],function(d,c,g){var b=false;var f=d.extend({init:function(h){this.id=h.id||0;this.showMode=h.showMode||"Show";this.staticMaterial=h.staticMaterial||null;this.staticPickPriority=h.staticPickPriority||null}});var e=function(h){};var a=function(h){var i={id:h.readInt32(g.id),showMode:h.readString(g.showMode),staticMaterial:h.readString(g.staticMaterial),staticPickPriority:h.readString(g.staticPickPriority)};return new f(i)};f.prototype.declareType=function(){if(b){return}c.declareType({type:"CSIViewModelGraphicPropertyParam",serialize:e,unserialize:a});b=true};return f});define("DS/WebVisuParameters/WebVisuUpdateTransaction",["DS/CSIViewModelWebInterfaces/CSIVMClientTransaction","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/Visualization/MaterialManager","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/Mesh3D","DS/WebVisuParameters/BoundingSphereParameterHelper","DS/WebVisuParameters/CustomDataParameterHelper","DS/WebVisuParameters/GeometryParameterHelper","DS/WebVisuParameters/InfiniteGeometryParameterHelper","DS/WebVisuParameters/GraphicPropertyParameterHelper","DS/Mesh/MeshUtils","DS/Visualization/GraphicAttributeSet"],function(l,m,d,v,n,f,c,e,p,x,o,i,u){var b=false;var k=null;var a=null;var h=0;var t={volume:new v.MeshPhongMaterial({side:v.FrontSide,color:new v.Color(16777215)}),surface:new v.MeshPhongMaterial({side:v.DoubleSide,color:new v.Color(16777215)}),line:new v.MeshBasicMaterial({color:new v.Color(0)}),point:new v.ParticleBasicMaterial({size:1,color:new v.Color(0),blending:v.NormalBlending,depthTest:false,sizeAttenuation:false,transparent:false})};t.volume.line=t.line;t.volume.point=t.point;t.surface.line=t.line;t.surface.point=t.point;var j=new v.MeshPhongMaterial({side:v.DoubleSide,color:new v.Color(16777215)});var s=new v.MeshPhongMaterial({side:v.FrontSide,color:new v.Color(16777215)});var g=new u({color:new v.Color(16777215)});var w=new u({color:new v.Color(0)});var r=function(B,z){if(z){for(var A=0;A<B.meshList.length;A++){var y=B.meshList[A]._occurrence.node;if(y&&(y._bodyDim===2)){return}}}for(var A=0;A<B.drawingGroups.length;A++){var E=B.drawingGroups[A];var D=E.gas;var C=E.material;if(E.glType!==4){continue}if(E.primitives.length){E.primitives[0].rep.solid=z}if(!b){if(z){E.gas=s;if(C===t.surface){E.material=t.volume}}else{E.gas=j;if(C===t.volume){E.material=t.surface}}}}};var q=function(z,y){b=window.newMaterialInheritanceCSI;this.viewManager=z;this.treeKeyID=y;this.view=z?z.getView(this.treeKeyID):null;this.id=h++;this.nodesToRemove=[];this.nodesToOptimize={};this.inverseAction={adds:[],removes:[],overrides:{}};this.commitAction={adds:[],removes:[]}};q.prototype=Object.create(l.prototype);q.prototype.doOperation=function(ag){this.setDefaultMaterials(this.viewManager.getDefaultMaterials());if(a!==this){if(a){a.executeInverse()}a=this}var z=this;var J=ag.getType();switch(J){case ag.OperationType.RemoveAll:if(this.view){this.view.removeChildren()}break;case ag.OperationType.AddNode:case ag.OperationType.AddBody:case ag.OperationType.CreateRoot:var U=null;var R=ag.getGeometricalData();if(J===ag.OperationType.AddNode||J===ag.OperationType.CreateRoot){U=new n()}else{if(R&&R.hasInfiniteGeometry()){U=new n()}else{U=new f();U.setShadow(true,true);U.mesh3js.fromLoadedModel=true;U._occurrences[0].renderable.fromLoadedModel=true;U.mesh3js.geometry=U._occurrences[0].renderable.geometry}}if(!U){return}ag.setCreatedObject(U);var aa=ag.getAttributes();if(aa){var Z=aa.getPositionMatrix();Z=this.unstreamMatrix(Z);Z&&U.setMatrix(Z)}var I=ag.getOperatedObject();if(!I){I=this.view}var B=R?c.getBoundingSphere(R.getBoundingSphere()):null;if(B){if(!B.radius&&!B.pixelRadius){B.radius=1000;U.exludeFromBounding(true)}U.bSphere.copy(B);U.bBox.copy(U.bSphere.getBoundingBox())}I.addChild(U);if(R&&R.getDimension){U._bodyDim=R.getDimension();for(var ae=0;ae<U._occurrences.length;ae++){var X=U._occurrences[ae].renderable;if(X){X._bodyDim=U._bodyDim}}}var C=R?R.getInitializers():null;if(C&&C.length){for(var ai=0;ai<C.length;ai++){var K=C[ai];if(!K||!K._occurrences[0].renderable){console.warn("Error during initializers of AddBody operation");continue}var aj=K._occurrences[0].renderable;for(var af=0;af<aj.geometry.length;af++){var F=aj.geometry[af];var Y=aj.layer?aj.layer.getIntervals(F,null,true):null;for(var ae=0;ae<U._occurrences.length;ae++){U._occurrences[ae].renderable.addGeometry(F,!B,Y)}U._bodyDim&&r(F,(U._bodyDim===3))}var ac=aj.selectionGroups;if(ac){for(var ae=0;ae<U._occurrences.length;ae++){var X=U._occurrences[ae].renderable;for(var ak=0;ak<ac.length;ak++){X.addSelectionGroup(ac[ak].clone())}}}}}if(B){var N=function(ao,an){if(!ao){return}ao.boundingSphere.copy(an.bSphere);ao.boundingBox.copy(an.bBox);if(ao.geometry){ao.geometry.boundingSphere=ao.boundingSphere;ao.geometry.boundingBox=ao.boundingBox}};for(var ae=0;ae<U._occurrences.length;ae++){var W=U._occurrences[ae].renderable;N(W,U)}}this.inverseAction.removes.push({parentNode:I,node:U});break;case ag.OperationType.AddCustomNode:var U=null;var al=new e(ag.getCustomData(),function(){z.viewManager._publishVisuAnswer(false)});if(al){U=al.getNode()}if(!U){return}ag.setCreatedObject(U);var aa=ag.getAttributes();if(aa){var Z=aa.getPositionMatrix();Z=this.unstreamMatrix(Z);Z&&U.setMatrix(Z)}var I=ag.getOperatedObject();if(!I){I=this.view}I.addChild(U);this.inverseAction.removes.push({parentNode:I,node:U});break;case ag.OperationType.ModifyCustomNode:var U=ag.getOperatedObject();var al=new e(ag.getCustomData(),function(){z.viewManager._publishVisuAnswer(false)});U&&al.modifyNode(U);break;case ag.OperationType.AddExistingNode:case ag.OperationType.RemoveExistingNode:var U=ag.getOperandObject();if(!U){return}var I=ag.getOperatedObject();if(!I){I=this.view}if(J===ag.OperationType.AddExistingNode){I.addChild(U)}else{this.nodesToRemove.push({parentNode:I,node:U})}if(J===ag.OperationType.AddExistingNode){this.inverseAction.removes.push({parentNode:I,node:U})}else{this.inverseAction.adds.push({parentNode:I,node:U})}break;case ag.OperationType.AddExistingCell:var O=ag.getOperatedObject();if(!O){return}var M=ag.getOperandObject();if(!M){return}if((O instanceof n)&&(M instanceof n)){O.addChild(M);return}if(!(O instanceof f)||!(M instanceof i.SGPrimitive)){return}var L=M.group.geometry;if(!L){return}this.nodesToOptimize[O.id]=O;var W=O._occurrences[0].renderable;var T=true;for(var ai=0;ai<W.geometry.length;ai++){if(L===W.geometry[ai]){T=false;break}}if(M.group&&(M.group.glType===4)){var V=(O._bodyDim===3);r(L,V)}if(T){for(var ae=0;ae<O._occurrences.length;ae++){W=O._occurrences[ae].renderable;W.initLayers(1);W.addGeometry(L);W._initLayersForGeometry(0,L)}}O.show([M]);break;case ag.OperationType.RemoveExistingCell:var M=ag.getOperandObject();if(!M){return}var O=ag.getOperatedObject();if(!O){return}if((O instanceof n)&&(M instanceof n)){O.removeChild(M);return}if(!(O instanceof f)||!(M instanceof i.SGPrimitive)){return}this.nodesToOptimize[O.id]=O;for(var ae=0;ae<O._occurrences.length;ae++){var W=O._occurrences[ae].renderable;W.initLayers(1);W.layer.addPrimitivesToLayers([M],0);W.removeSelectionGroup(M)}break;case ag.OperationType.AddCells:var U=ag.getOperatedObject();var R=ag.getGeometricalData();var P=R?R.hasInfiniteGeometry():false;if(!U||!(U instanceof n)){return}if(!P&&!(U instanceof f)){return}this.nodesToOptimize[U.id]=U;var H=R?R.getGeometries():null;if(H){if(!P){var V=(U._bodyDim===3);var ab={version:R.getVersion(),hasGeomDecorations:R.hasGeomDecorations()};for(var ai=0;ai<H.length;ai++){var y=new p(H[ai],ab).getGeometry(this,V);var L=y.geometry;var ad=y.primitiveIDs;if(L){for(var ae=0;ae<U._occurrences.length;ae++){var W=U._occurrences[ae].renderable;W.addGeometry(L,false);if(U.bSphere){var D=W.geometry;if(!D.boundingSphere){D.boundingSphere=new v.Sphere()}D.boundingSphere.copy(U.bSphere)}}var S=L.drawingGroups;for(var af=0;af<S.length;af++){var E=S[af].primitives;for(var ae=0;ae<E.length;ae++){ag.addCreatedObjectWithID(E[ae],ad[af][ae])}}}}}else{for(var ai=0;ai<H.length;ai++){var y=new x(H[ai]).getInfiniteGeometry(this);var L=y.geometry;var ad=y.primitiveIDs;for(var ae=0;ae<L.length;ae++){U.addChild(L[ae]);ag.addCreatedObjectWithID(L[ae],ad[ae])}}}}break;case ag.OperationType.ApplyGP:var am=ag.getGraphicProperties();if(!am){return}var U=ag.getOperatedObject();if(!U){return}var Q=new o(am);Q.applyGP(this,U,ag.getOperatedSubElements());break;case ag.OperationType.ApplyAttributes:var U=ag.getOperatedObject();if(!U||!(U instanceof n)){return}var aa=ag.getAttributes();if(aa){var Z=aa.getPositionMatrix();Z=this.unstreamMatrix(Z);Z&&U.setMatrix(Z)}break;case ag.OperationType.AddGroups:var U=ag.getOperatedObject();if(!U||!(U instanceof f)){return}var R=ag.getGeometricalData();var ac=ag._Groups;for(var ai=0;ai<ac.length;ai++){var ah=ac[ai].getGroupedElements();var A=new i.SelectionGroup();for(var af=0;af<ah.length;af++){A.addPrimitive(ah[af])}for(var af=0;af<U._occurrences.length;af++){var W=U._occurrences[af].renderable;W.addSelectionGroup(A)}}break;case ag.OperationType.ModifyBody:var U=ag.getOperatedObject();if(!U||!(U instanceof f)){return}var R=ag.getGeometricalData();if(!R){return}var H=R.getGeometries();if(!H){return}var ab={version:R.getVersion()};for(var ai=0;ai<H.length;ai++){var G=new p(H[ai],ab);G.updateGeometry(U)}break;default:break}};q.prototype.commit=function(){this.executeInverse({commits:true,overrides:true,optimize:true});a=null;this.executeEnd()};q.prototype.abort=function(){this.executeInverse({inverses:true,overrides:true});a=null;this.executeEnd()};q.prototype.executeEnd=function(){for(var y=0;y<this.nodesToRemove.length;y++){var z=this.nodesToRemove[y];z.parentNode.removeChild(z.node)}this.nodesToRemove=[];this.optimizeMeshes();this.viewManager._publishVisuAnswer(true)};q.prototype.executeInverse=function(B){if(!B){return}if(B.inverses){for(var z=0;z<this.inverseAction.adds.length;z++){var A=this.inverseAction.adds[z];A.parentNode.addChild(A.node)}for(var z=0;z<this.inverseAction.removes.length;z++){var A=this.inverseAction.removes[z];A.parentNode.removeChild(A.node)}}if(B.commits){for(var z=0;z<this.commitAction.removes.length;z++){var A=this.commitAction.removes[z];A.parentNode.removeChild(A.node)}}if(B.optimize){this.optimizeMeshes()}if(B.overrides){var C=this.getDefaultMaterials();for(var D in this.inverseAction.overrides){var y=this.inverseAction.overrides[D];y.node.setMaterial(C.face);y.node.setPickable(i.PICKABLE);y.node.setNoZ(false)}}};q.prototype.optimizeMeshes=function(){for(var y in this.nodesToOptimize){var z=this.nodesToOptimize[y]}this.nodesToOptimize={}};q.prototype.unstreamMatrix=function(y){if(!y){return null}var z=y.getArray(1);if(!z){return null}var A=new v.Matrix4();A.set(z[0],z[1],z[2],z[3],z[4],z[5],z[6],z[7],z[8],z[9],z[10],z[11],0,0,0,1);return A};q.prototype.getStaticMaterial=function(y){if(!this.viewManager){return null}return this.viewManager.getStaticMaterial(y)};q.prototype.getStaticLook=function(y){if(!this.viewManager){return null}return this.viewManager.getStaticLook(y)};q.prototype.setDefaultMaterials=function(z){if(z.surface||z.face){var y=z.surface?z.surface:z.face;t.surface=y}if(z.volume){t.volume=z.volume}else{if(z.face){t.volume=z.face}}if(z.line){t.line=z.line;t.surface.line=t.surface.line;t.volume.line=t.volume.line}if(z.point){t.point=z.point;t.surface.point=t.surface.point;t.volume.point=t.volume.point}};q.prototype.getDefaultMaterials=function(){return t};q.prototype.getMaterialManager=function(){if(!k){k=new d()}return k};return q});define("DS/WebVisuParameters/WebVisuSceneGraphUpdater",["DS/CSIViewModelWebInterfaces/CSIVMClientDelegateInterface","DS/WebVisuParameters/WebVisuUpdateTransaction","DS/Visualization/ViewManager","DS/Mesh/MeshUtils","DS/Visualization/Node3D","DS/Visualization/Mesh3D","DS/Visualization/PathElement","DS/Visualization/SubElement"],function(d,b,i,e,f,h,c,a){var g=function(){this.viewManager=new i()};g.prototype=Object.create(d.prototype);g.prototype.createTransaction=function(j){return new b(this.viewManager,j.getUUID())};g.prototype.createPathElement=function(l){if(!l||!l.length){return null}var v=l[0];if(!(v instanceof f)){return null}var n=v;var z=false;if(n.parents.length>1){for(var q=0;q<n.parents.length;q++){if(!n.parents[q].notAllowedInPathElement){return null}}z=true}var y=[n];var w=[];if(!z){var t=n.parents[0];while(t){n=t;if(n.notAllowedInPathElement){break}else{y.unshift(n)}if(n.parents.length>1){for(var q=0;q<n.parents.length;q++){if(!n.parents[q].notAllowedInPathElement){return null}}break}t=n.parents[0]}}var s;var m=null;for(s=1;s<l.length;s++){n=l[s];if(n instanceof f){y.push(n);if(n instanceof h){m=n._occurrences[0].renderable}}else{break}}for(var r=s;r<l.length;r++){var o=l[r];if(o instanceof e.SGPrimitive){var p=o;if(m){var x=m.getSelectionGroup(o);if(x){p=x}}w.push(a.getFromSGNode(p))}}var u=new c();u.setFromArray(y,w);return u};g.prototype.createIdentifiedObjectsArray=function(j){if(!j){return null}var l=[];for(var k=0;k<j.externalPath.length;k++){var m=j.externalPath[k];if(m&&m.getIdentificationObject()){l.push(m)}}for(var k=0;k<j.internalPath.length;k++){var n=j.internalPath[k];if(n&&n.sgNode&&n.sgNode.getIdentificationObject()){l.push(n.sgNode)}}return l};return g});define("DS/WebVisuParameters/CSICustomDataParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels","DS/Visualization/Node3D"],function(d,c,h,g){var b=false;var e=d.extend({init:function(i){this.binFormat=i.binFormat||h.valueBinaryFormatValue[0];this.module=i.module||"";this.data=i.data||null},getNode:function(){var j=this;var i=new g();require([this.module],function(l){var k=new l();var m=k.handleMessage(j.data);i.addChild(m)},this.onModuleError);return i},modifyNode:function(i){var j=this;require([this.module],function(l){var k=new l();k.handleUpdateMessage(j.data,i.children[0])},this.onModuleError)},onModuleError:function(j){var i=j.requireModules&&j.requireModules[0];console.log("Module "+i+" is missing.")}});var f=function(i){};var a=function(i){var j={binFormat:i.readString(h.valueBinaryFormat),module:i.readString(h.valueClientModule),data:i.readObject(h.valueData,"Parameters")};return new e(j)};e.prototype.declareType=function(){if(b){return}c.declareType({type:"CSICustomDataParam",serialize:f,unserialize:a});b=true};return e});define("DS/WebVisuParameters/CSIBoundingSphereParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels","DS/Visualization/ThreeJS_DS"],function(e,c,h,g){var b=false;var d=e.extend({init:function(i){this.radius=i.radius||0;this.centerX=i.centerX||0;this.centerY=i.centerY||0;this.centerZ=i.centerZ||0;this.state=i.state||h.valueStateValue[0]},getBoundingSphere:function(){return new g.Sphere(new g.Vector3(this.centerX,this.centerY,this.centerZ),((this.state==="INFINITE")||(this.state==="INIFINITE"))?0:this.radius)}});var f=function(i){};var a=function(i){var j={radius:i.readFloat(h.valueRadius),centerX:i.readDouble(h.valueX1),centerY:i.readDouble(h.valueY1),centerZ:i.readDouble(h.valueZ1),state:i.readString(h.valueState)};return new d(j)};d.prototype.declareType=function(){if(b){return}c.declareType({type:"CSIBoundingSphereParam",serialize:f,unserialize:a});b=true};return d});define("DS/WebVisuParameters/CSIViewModelIdPatternParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels"],function(d,c,f){var b=false;var g=d.extend({init:function(h){this.id=h.id||0;this.idSpace=h.idSpace||"";this.idContext=h.idContext||"";this.shared=!!h.shared},getPattern:function(){return{space:this.idSpace,context:this.idContext,shared:this.shared}}});var e=function(h){};var a=function(h){var i={id:h.readInt32(f.id),idSpace:h.readString(f.idSpace),idContext:h.readString(f.idContext),shared:h.readInt32(f.shared)};return new g(i)};g.prototype.declareType=function(){if(b){return}c.declareType({type:"CSIViewModelIdPatternParam",serialize:e,unserialize:a});b=true};return g});define("DS/WebVisuParameters/CSIDrawGroupParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels"],function(d,c,g){var b=false;var f=d.extend({init:function(h){this.geomType=h.geomType||"";this.start=h.start||0;this.count=h.count||0;this.primitives=h.primitives||null}});var e=function(h){};var a=function(h){var i={geomType:h.readString(g.valueGeomType),start:h.readUint32(g.valueStart),count:h.readUint32(g.valueCount),primitives:h.readObject(g.valuePrimitives,"CSIBinaryRangeParam")};return new f(i)};f.prototype.declareType=function(){if(b){return}c.declareType({type:"CSIDrawGroupParam",serialize:e,unserialize:a});b=true};return f});define("DS/WebVisuParameters/CSIGeometryParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels","DS/WebVisuParameters/CSIBinaryRangeParameter","DS/WebVisuParameters/CSIDrawGroupParameter","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils"],function(b,c,a,g,i,h,d){var j=false;var f=b.extend({init:function(l){this.buffers=l.buffers||{};this.dgs=l.dgs||[];this.binaryBuffer=l.binaryBuffer||null},getGeometry:function(r){var H=r.getDefaultMaterials();var A=H.face;var D=H.line;var p=H.point;var y=new h.BufferGeometryDS();for(var q in this.buffers){var l=this.buffers[q];if(l){if(q==="vertexIndexArray"){y[q]=new Uint16Array(this.binaryBuffer,l.offset,l.byteLength/l.bpe)}else{y[q]=new Float32Array(this.binaryBuffer,l.offset,l.byteLength/l.bpe)}}}for(var E=0;E<this.dgs.length;E++){var G=this.dgs[E];var m=G.primitives;m=new Uint32Array(this.binaryBuffer,m.offset,m.byteLength/m.bpe);var x=a.glTypeFromGeomType[G.geomType];var t=(y.vertexNormalArray&&(x===4))?A:((x===0)?p:D);var F=[];var s=new d.DrawingGroup(t,null,x,G.start,G.count,F,undefined,h.GeomTypeEnum[G.geomType],0);s.geometry=y;y.drawingGroups.push(s);for(var B=0;B<m.length;B+=4){var u=new d.SGPrimitive({start:m[B],count:m[B+1],cgmId:m[B+2],group:s});F.push(u)}}if(!y.boundingBox){var z=[0,0,0];var C=[0,0,0];var o=y.vertexPositionArray;if(o){var v=o.length;if(v>=3){z=[o[0],o[1],o[2]];C=[o[0],o[1],o[2]];for(var w=0;w<v;w+=3){if(o[w]<z[0]){z[0]=o[w]}if(o[w+1]<z[1]){z[1]=o[w+1]}if(o[w+2]<z[2]){z[2]=o[w+2]}if(o[w]>C[0]){C[0]=o[w]}if(o[w+1]>C[1]){C[1]=o[w+1]}if(o[w+2]>C[2]){C[2]=o[w+2]}}}}z=new h.Vector3(z[0],z[1],z[2]);C=new h.Vector3(C[0],C[1],C[2]);y.boundingBox=new h.Box3(z,C);y.boundingSphere=new h.Sphere(C.clone().add(z).multiplyScalar(0.5),C.clone().sub(z).multiplyScalar(0.5).length())}return y}});var k=function(l){};var e=function(p){var m={};for(var o=0;o<a.valueBufferPartition.length;o++){var n=a.valueBufferPartition[o];var l=p.readObject(n,"CSIBinaryRangeParam");if(l){m[n]=l}}var q={buffers:m,dgs:p.readObjectArray(a.valueDrawGroups,"CSIDrawGroupParam"),binaryBuffer:p.readBuffer(a.valueBuffer)};return new f(q)};f.prototype.declareType=function(){if(j){return}c.declareType({type:"CSIGeometryParam",serialize:k,unserialize:e});j=true;g.prototype.declareType();i.prototype.declareType()};return f});define("DS/WebVisuParameters/CSIViewTreeTokenParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels","DS/WebVisuParameters/CSIViewTreeObjectParameter","DS/WebVisuParameters/CSIGeometryParameter","DS/WebVisuParameters/CSIBoundingSphereParameter","DS/WebVisuParameters/CSICustomDataParameter","DS/VisuIdentification/Node","DS/VisuIdentification/Converter","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/Mesh3D","DS/Visualization/PathElement","DS/Visualization/SubElement","DS/Mesh/MeshUtils"],function(o,c,n,f,l,s,p,a,b,t,i,d,m,q,e){var j=false;var r=new b();var g=o.extend({init:function(u){this.value=u.value||"";this.localIdInt=u.localIdInt||0;this.localIdString=u.localIdString||"";this.shortId=u.shortId||null;this.idPath=u.idPath||null;this.idPattern=u.idPattern||0;this.parent=u.parent||null;this.geometries=(u.geometries&&u.geometries.length)?u.geometries:(u.geometry?[u.geometry]:[]);this.bs=u.bs||null;this.inits=u.inits||[];this.customData=u.customData||null;this.nodesToRemove=[];this.nodesToOptimize={};this.inverseAction={adds:[],removes:[],overrides:{}};this.commitAction={adds:[],removes:[]}},execute:function(F,B){var K=null;var P=B.getPatternFromID(this.idPattern);var v=(this.localIdInt!==0)?this.localIdInt:this.localIdString;switch(this.value){case n.valueRemoveAll:if(F){F.removeChildren()}break;case n.valueAddNode:case n.valueAddBody:var K=B.createdNodes[this.shortId];if(!K){if(this.value===n.valueAddNode){K=new i()}else{K=new d();K.setShadow(true,true);K.mesh3js.geometry=K._occurrences[0].renderable.geometry}B.createdNodes[this.shortId]=K}K.setModelIdentification(new a(P,v));var C=F;if(this.parent){var N=this.parent.getParentNode(F,B,false);if(N){C=N}}if(this.bs){K.bSphere.copy(this.bs.getBoundingSphere());K.bBox.copy(K.bSphere.getBoundingBox())}C.addChild(K);if(this.inits.length){for(var O=0;O<this.inits.length;O++){var y=this.inits[O];var w=r.decodeGlobalId(F,y);var D=w.getLastElement(true);if(!D){continue}var H=D._occurrences[0].renderable;for(var M=0;M<H.geometry.length;M++){var J=H.geometry[M];var A=H.layer?H.layer.getIntervals(J,null,true):null;for(var L=0;L<K._occurrences.length;L++){K._occurrences[L].renderable.addGeometry(J,!this.bs,A)}}}}if(this.bs){var E=function(S,R){if(!S){return}S.boundingSphere.copy(R.bSphere);S.boundingBox.copy(R.bBox);if(S.geometry){S.geometry.boundingSphere=S.boundingSphere;S.geometry.boundingBox=S.boundingBox}};for(var L=0;L<K._occurrences.length;L++){var I=K._occurrences[L].renderable;E(I,K)}}if(B.viewStatus===n.viewStatusTemporary){if(B.getTemporaryBodies().activated){this.setTransparency(K,0.5,B);K.setPickable(e.NODRAWHL);K.setNoZ(true)}this.inverseAction.removes.push({parentNode:C,node:K})}break;case n.valueAddCustomNode:var K=B.createdNodes[this.shortId];if(!K){if(this.customData){K=this.customData.getNode()}if(K){B.createdNodes[this.shortId]=K}}if(!K){return}K.setModelIdentification(new a(P,v));var C=F;if(this.parent){var N=this.parent.getParentNode(F,B,false);if(N){C=N}}C.addChild(K);if(B.viewStatus===n.viewStatusTemporary){if(B.getTemporaryBodies().activated){this.setTransparency(K,0.5,B)}this.inverseAction.removes.push({parentNode:C,node:K})}break;case n.valueModifyCustomNode:var w=r.decodeGlobalId(F,this.idPath);var K=w.getLastElement(true);K&&this.customData.modifyNode(K);break;case n.valueAddExistingNode:case n.valueRemoveExistingNode:var w=r.decodeGlobalId(F,this.idPath);var K=w.getLastElement(true);if(!K){return}var C=F;if(this.parent){var N=this.parent.getParentNode(F,B,false);if(N){C=N}}if(this.value===n.valueAddExistingNode){C.addChild(K)}else{if((B.viewStatus===n.viewStatusPermanent)||!B.getTemporaryBodies().activated){this.nodesToRemove.push({parentNode:C,node:K})}}if(B.viewStatus===n.viewStatusTemporary){if(this.value===n.valueAddExistingNode){if(B.getTemporaryBodies().activated){this.setTransparency(K,0.5,B)}this.inverseAction.removes.push({parentNode:C,node:K})}else{if(B.getTemporaryBodies().activated){this.commitAction.removes.push({parentNode:C,node:K})}else{this.inverseAction.adds.push({parentNode:C,node:K})}}}break;case n.valueAddExistingCell:var w=r.decodeGlobalId(F,this.idPath);var G=w.getLastElement();if(!G||!(G instanceof q)){return}var x=G.sgNode.group.geometry;if(!x){return}var u=null;if(this.parent){u=this.parent.getParentNode(F,B,true)}if(!u||!(u instanceof d)){return}this.nodesToOptimize[u.id]=u;var I=u._occurrences[0].renderable;var Q=true;for(var O=0;O<I.geometry.length;O++){if(x===I.geometry[O]){Q=false;break}}if(Q){for(var L=0;L<u._occurrences.length;L++){I=u._occurrences[L].renderable;I.initLayers(1);I.addGeometry(x);I._initLayersForGeometry(0,x)}}u.show([G]);break;case n.valueRemoveExistingCell:var w=r.decodeGlobalId(F,this.idPath,true);var G=w.getLastElement();if(!G||!(G instanceof q)){return}var u=null;if(this.parent){u=this.parent.getParentNode(F,B,true)}if(!u||!(u instanceof d)){return}this.nodesToOptimize[u.id]=u;for(var L=0;L<u._occurrences.length;L++){var I=u._occurrences[L].renderable;I.initLayers(1);I.layer.addPrimitivesToLayers([G.sgNode],0)}break;case n.valueAddCells:if(this.parent){K=this.parent.getParentNode(F,B,true)}if(!K||!(K instanceof d)){return}this.nodesToOptimize[K.id]=K;if(this.geometries){for(var O=0;O<this.geometries.length;O++){var x=this.geometries[O].getGeometry(B);if(x){for(var L=0;L<K._occurrences.length;L++){var I=K._occurrences[L].renderable;I.addGeometry(x,false);if(K.bSphere){var z=I.geometry;if(!z.boundingSphere){z.boundingSphere=new t.Sphere()}z.boundingSphere.copy(K.bSphere)}}}}}break;default:break}},executeEnd:function(u,y,w){for(var v=0;v<this.nodesToRemove.length;v++){var x=this.nodesToRemove[v];x.parentNode.removeChild(x.node)}if(y.viewStatus===n.viewStatusPermanent){this.optimizeMeshes(w)}},executeInverse:function(A,w,y){if(y.inverses){for(var v=0;v<this.inverseAction.adds.length;v++){var x=this.inverseAction.adds[v];x.parentNode.addChild(x.node)}for(var v=0;v<this.inverseAction.removes.length;v++){var x=this.inverseAction.removes[v];x.parentNode.removeChild(x.node)}}if(y.commits){for(var v=0;v<this.commitAction.removes.length;v++){var x=this.commitAction.removes[v];x.parentNode.removeChild(x.node)}}if(y.optimize){this.optimizeMeshes(w)}if(y.overrides){var z=A.getDefaultMaterials();for(var B in this.inverseAction.overrides){var u=this.inverseAction.overrides[B];u.node.setMaterial(z.face);u.node.setPickable(e.PICKABLE);u.node.setNoZ(false)}}},optimizeMeshes:function(v){for(var u in this.nodesToOptimize){var w=this.nodesToOptimize[u];v.nodesToOptimize[w.id]=w}},setTransparency:function(x,u,z){var y=z.getDefaultMaterials();var v=y.tempFace;var w=z.getTemporaryBodies().material;if(w){v=w}else{v.opacity=u}if(!v){return}x.setMaterial(v);this.inverseAction.overrides[x.id]={node:x}}});var k=function(u){};var h=function(u){var v={value:u.readString(n.value),localIdInt:u.readUint32(n.localIdInt),localIdString:u.readString(n.localIdString),shortId:u.readInt32(n.shortId),idPath:u.readString(n.idPath),idPattern:u.readInt32(n.idPattern),parent:u.readObject(n.parent,"CSIViewTreeObjectParam"),geometry:u.readObject(n.valueGeometry,"CSIGeometryParam"),geometries:u.readObjectArray(n.valueGeometries,"CSIGeometryParam"),bs:u.readObject(n.valueBoundingSphere,"CSIBoundingSphereParam"),customData:u.readObject(n.valueCustomData,"CSICustomDataParam"),inits:u.readStringArray(n.valueInitializers)};return new g(v)};g.prototype.declareType=function(){if(j){return}c.declareType({type:"CSIViewTreeTokenParam",serialize:k,unserialize:h});j=true;f.prototype.declareType();l.prototype.declareType();s.prototype.declareType();p.prototype.declareType()};return g});define("DS/WebVisuParameters/CSIViewTreeUpdateParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels","DS/WebVisuParameters/CSIViewTreeTokenParameter","DS/WebVisuParameters/CSIAppliedGasTokenParameter"],function(b,c,a,d,g){var h=false;var f=b.extend({init:function(j,k,l){this.treeKey=j||"";this.tokens=k||[];this.appliedGas=l||[];this.nodesToOptimize={}},execute:function(k,o){var m;var j=k.getView(this.treeKey);for(m=0;m<this.tokens.length;m++){var l=this.tokens[m];l.execute(j,o)}for(m=0;m<this.tokens.length;m++){var l=this.tokens[m];l.executeEnd(j,o,this)}this.optimizeMeshes();for(m=0;m<this.appliedGas.length;m++){var n=this.appliedGas[m];n.execute(j,o)}},executeInverse:function(m,l){for(var k=0;k<this.tokens.length;k++){var j=this.tokens[k];j.executeInverse(m,this,l)}this.optimizeMeshes()},optimizeMeshes:function(){for(var j in this.nodesToOptimize){var k=this.nodesToOptimize[j]}this.nodesToOptimize={}},});var i=function(j){};var e=function(k){var j=k.readString(a.treeKey);var l=k.readObjectArray(a.tokens,"CSIViewTreeTokenParam");var m=k.readObjectArray(a.appliedGas,"CSIViewTreeAppliedGPTokenParam");return new f(j,l,m)};f.prototype.declareType=function(){if(h){return}c.declareType({type:"CSIViewTreeUpdateParam",serialize:i,unserialize:e});h=true;d.prototype.declareType();g.prototype.declareType()};return f});define("DS/WebVisuParameters/CSIViewParameter",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/CSICommandBinder/CSICommandBinder","DS/WebVisuParameters/CSIViewParameterLabels","DS/WebVisuParameters/CSIViewTreeUpdateParameter","DS/WebVisuParameters/CSIViewModelIdPatternParameter","DS/WebVisuParameters/CSIGraphicPropertyParameter"],function(b,j,c,a,k,d,g){var l=false;var n=null;var i={activated:false,material:null};var e={face:new j.MeshPhongMaterial({side:j.DoubleSide,color:new j.Color(16777215)}),line:new j.MeshBasicMaterial({color:new j.Color(0)}),point:new j.ParticleBasicMaterial({size:1,color:new j.Color(0),blending:j.NormalBlending,depthTest:false,sizeAttenuation:false,transparent:false}),tempFace:new j.MeshPhongMaterial({force:true,color:new j.Color(16777215),transparent:true,opacity:0.5})};e.face.line=e.line;e.face.point=e.point;e.tempFace.line=e.line;e.tempFace.point=e.point;var f=b.extend({init:function(o){this.viewStatus=o.viewStatus||a.viewStatusPermanent;this.idPatterns=o.idPatterns||{};this.graphicProperties=o.gas||{};this.treeUpdates=o.treeUpdates||[];this.createdNodes={};this.staticMaterials={}},getPatternFromID:function(o){if(this.idPatterns[o]){return this.idPatterns[o].getPattern()}return null},execute:function(o){if(this.viewStatus===a.viewStatusCommit){n.executeInverse({commits:true,overrides:true,optimize:true});n=null;return}if(n){n.executeInverse({inverses:true,overrides:true})}if(this.viewStatus===a.viewStatusAbort){n=null;return}n=(this.viewStatus===a.viewStatusTemporary)?this:null;for(var p=0;p<this.treeUpdates.length;p++){var q=this.treeUpdates[p];q.execute(o,this)}},executeInverse:function(p){for(var o=0;o<this.treeUpdates.length;o++){var q=this.treeUpdates[o];q.executeInverse(this,p)}},setStaticMaterials:function(o){this.staticMaterials=o},getStaticMaterial:function(o){return this.staticMaterials[o]},setDefaultMaterials:function(o){if(o.line){e.line=o.line}if(o.point){e.point=o.point}if(o.face){e.face=o.face;e.tempFace=o.face.clone();e.tempFace.force=true;e.tempFace.line=e.line;e.tempFace.point=e.point;e.tempFace.transparent=true;e.tempFace.opacity=0.5}e.face.line=e.line;e.face.point=e.point},getDefaultMaterials:function(){return e},setTemporaryBodies:function(o){i.activated=!!o.activated;i.material=o.material||null},getTemporaryBodies:function(){return i}});var m=function(o){};var h=function(q){var p;var u={viewStatus:q.readString(a.viewStatus),gas:{},treeUpdates:q.readObjectArray(a.treeUpdates,"CSIViewTreeUpdateParam"),idPatterns:{}};var o=q.readObjectArray(a.idPatterns,"CSIViewModelIdPatternParam");var t=q.readObjectArray(a.graphicProperties,"CSIViewModelGraphicPropertyParam");if(o){for(p=0;p<o.length;p++){var s=o[p];u.idPatterns[s.id]=s}}if(t){for(p=0;p<t.length;p++){var r=t[p];u.gas[r.id]=r}}return new f(u)};f.prototype.declareType=function(){if(l){return}c.declareType({type:"CSIViewParam",serialize:m,unserialize:h});l=true;k.prototype.declareType();d.prototype.declareType();g.prototype.declareType()};return f});