define("DS/PropertiesAdmin/ajax/AjaxRequests",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/WAFData/WAFData","i18n!DS/MaskCustomization/assets/nls/maskCustomization"],function(e,b,a){var d={createRequest:function(f,i,h,g){if(!f.handleRequest){f.handleRequest={}}f.handleRequest.handle=e.get3DSpaceUrlAsync({onComplete:function(o){var j="passport";var n=o+h;var m={Accept:"application/json","content-type":"application/json"};m["Accept-Language"]=widget.lang;var k=f.securityContext;k?m.SecurityContext=encodeURIComponent(k):null;var l={type:"json",method:i,timeout:3600000,proxy:j,headers:m,onComplete:function(p){f.onComplete(p)},onFailure:function(p,q,r){b._onFailure(p,q,r,f)},onTimeout:function(p){b._onTimeout(f)}};if(!widget.getValue("isStandalone")){l.authentication="passport"}if(g){l.data=UWA.Json.encode(g)}f.handleRequest.handle=a.handleRequest(b._formatUrl(null,n),l)}})},getListOfSettings:function(h){var g="GET";var f="/resources/collabCommon/settings/list";d.createRequest(h,g,f,null)},getSettingsFile:function(h){var g="GET";var f="/resources/collabCommon/settings/"+h.name;d.createRequest(h,g,f,null)},getOriginFile:function(h){var g="GET";var f="/resources/collabCommon/settings/"+h.name+"/origin";d.createRequest(h,g,f,null)},updateSettingsFile:function(h){var i=h.content;if(h.content.settings===undefined){i={settings:i}}var g="PATCH";var f="/resources/collabCommon/settings/"+h.name;d.createRequest(h,g,f,i)}};var c={getListOfSettings:function(f){b.securityContextDispatcher(f,d.getListOfSettings)},getSettingsFile:function(f){b.securityContextDispatcher(f,d.getSettingsFile)},updateSettingsFile:function(f){b.securityContextDispatcher(f,d.updateSettingsFile)},getOriginFile:function(f){b.securityContextDispatcher(f,d.getOriginFile)}};return c});define("DS/PropertiesAdmin/PropertiesAdmin",["DS/EditPropWidget/facets/Common/FacetsBase","DS/PropertiesAdmin/ajax/AjaxRequests","DS/UIKIT/Mask","DS/Controls/Button","DS/Controls/TooltipModel","DS/WidgetServices/WidgetServices","i18n!DS/PropertiesAdmin/assets/nls/propertiesAdmin","css!DS/PropertiesAdmin/PropertiesAdmin.css"],function(c,b,g,d,a,f,e){require(["DS/UIKIT/SuperModal"]);var h=c.extend({init:function(i){this._parent(i);this._maskNumber=0;this._initUI()},_setError:function(k,i,j){i=i?i:"error";this._raiseNotification(k,i,j)},_manageError:function(j){var i=j.success===false;if(i){var k=j.message!==undefined?j.message:j.error&&j.error.message?j.error.message:"server error";this._setError(k)}return i},_initUI:function(){var i=this;this.elements.settingsContainer=UWA.createElement("div",{"class":"containerSettings"});this.elements.container=this.elements.settingsContainer;this.onRefresh()},__uploadFile:function(j,k){var l=this;var i=new FileReader();i.onload=(function(m){return function(o){try{var n=JSON.parse(o.target.result);b.updateSettingsFile({name:j,content:n,onComplete:function(q){var p=l._manageError(q);if(!p){l._raiseNotification(e.uploadDone,"success")}}})}catch(o){l._raiseNotification(e.notJson,"error")}}})(k);i.readAsText(k)},_uploadFile:function(l,k,j){var p=this;var o=j.target.files;var n=null;for(var m=0,q;q=o[m];m++){if(!q.name.match(".*json")){this._raiseNotification(e.ChooseJson,"warning");continue}else{n=q;break}}if(n){if(n.name.indexOf(l)!==0){require(["DS/UIKIT/SuperModal"],function(i){p.elements.validUpload=p.elements.validUpload?p.elements.validUpload:new i({renderTo:p.elements.container});p.elements.validUpload.confirm(e.wrongNameMsg,e.wrongNameTitle,function(r){if(r){p.__uploadFile(k,n)}})})}else{p.__uploadFile(k,n)}}},_addSettings:function(l){var n=this;var k=l.name;var p=l.label;var s=UWA.createElement("div",{"class":"containerFile"}).inject(this.elements.settingsContainer);UWA.createElement("div",{text:p,"class":"fileTitle"}).inject(s);var j="1x";var m=UWA.createElement("div",{"class":"fileButtons"}).inject(s);var o=new d({label:e.Download,emphasize:"primary",icon:{iconName:"download",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:j}}).inject(UWA.createElement("div",{"class":"buttonContainer"}).inject(m));o.tooltipInfos=new a({shortHelp:e.DownloadTooltip,mouseRelativePosition:true});o.addEventListener("buttonclick",function(){n.showLoader();b.getSettingsFile({name:k,onComplete:function(u){n.hideLoader();var t=n._manageError(u);if(!t){f.download(p,u.settings,"json",true)}}})});var q=UWA.createElement("input",{type:"file","class":"inputSettings",events:{change:function(t){n._uploadFile(p,k,t);this.value=null}}}).inject(s);q.hide();var r=new d({label:e.Upload,emphasize:"primary",icon:{iconName:"upload",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:j}}).inject(UWA.createElement("div",{"class":"buttonContainer"}).inject(m));r.tooltipInfos=new a({shortHelp:e.UploadTooltip,mouseRelativePosition:true});r.addEventListener("buttonclick",function(){if(!f.isReplayedODT()){q.click()}});var i=new d({label:e.Origin,emphasize:"primary",icon:{iconName:"export",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:j}}).inject(UWA.createElement("div",{"class":"buttonContainer"}).inject(m));i.tooltipInfos=new a({shortHelp:e.OriginTooltip,mouseRelativePosition:true});i.addEventListener("buttonclick",function(){n.showLoader();b.getOriginFile({name:k,onComplete:function(u){n.hideLoader();var t=n._manageError(u);if(!t){f.download(p,u.settings,"json",true)}}})})},onRefresh:function(){var i=this;this._maskNumber++;g.mask(this.elements.container);b.getListOfSettings({onComplete:function(k){i._maskNumber--;if(i._maskNumber<=0){g.unmask(i.elements.container)}var j=i._manageError(k);if(!j){var l=k.settings;l.forEach(function(m){i._addSettings(m)})}}})}});if(f.isReplayedODT()){h.priv=f}return h});