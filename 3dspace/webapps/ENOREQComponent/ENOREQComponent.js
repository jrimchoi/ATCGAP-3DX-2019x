/*! -- Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/ENOREQComponent/ENOREQContextualMenu",["DS/ENOPAD_v2/mixins/_PADCtx","UWA/Core","UWA/Class","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADUtils/PADClipboard","DS/WebappsUtils/WebappsUtils","DS/RichView/Command/CreateLinkAction","DS/RichView/Command/CtxMenu_StartLinkCmd","DS/RichView/Command/CtxMenu_EndLinkCmd","i18n!DS/ENOREQComponent/assets/nls/ENOREQ.json"],function(h,g,a,k,d,b,i,j,e,f){var c=h.extend({commonMenu:function(o){var l=[],n=this;if(o!==null){if(o._expandState!=="noExpandState"){l.push({title:k.PAD_CMDExpandAll,icon:"url("+b.getWebappsAssetUrl("ENXNav","icons/32/I_ExpandAll.png")+")",type:"PushItem",action:{callback:n._expandAll.bind(n)}});l.push({title:k.PAD_CMDCollapseAll,icon:"url("+b.getWebappsAssetUrl("ENXNav","icons/32/I_CollapseAll.png")+")",type:"PushItem",action:{callback:n._collapseAll.bind(n)}});l.push({type:"SeparatorItem"})}l.push({title:k.PAD_CMDProperties,icon:"url("+b.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_CATSSEditorDisplayProperties.png")+")",type:"PushItem",action:{callback:n._editProperties.bind(n)}});if(!o.isRoot()){n.detachCommand(l)}var m=n._defaultTypes[o.options.type]||o.options.type;if(m==="Requirement"){if(o.options.externalObject){n.AddRequirementCommand(l)}else{n.AddChapterCommand(l);n.AddRequirementCommand(l);n.AddCommentCommand(l);n.insertRequirementCommand(l);n.CreateExternalRequirementCommand(l);n.InsertExistingRequirementCommand(l);n.InsertExternalRequirementCommand(l);n.insertParameterCommand(l);l.push({title:f.StartLink,icon:"url("+b.getWebappsAssetUrl("ENOREQComponent","icons/32/DerivedRequirementStartLink.png")+")",type:"PushItem",action:{context:o,callback:n._startLink.bind(n)}});l.push({title:f.EndLink,icon:"url("+b.getWebappsAssetUrl("ENOREQComponent","icons/32/DerivedRequirementEndLink.png")+")",type:"PushItem",action:{context:o,callback:n._endLink.bind(n)}});l.push({title:f.Links_Management,type:"PushItem",action:{context:o,callback:n.launchDeleteWindow.bind(n)}})}}if(m==="Chapter"){n.AddChapterCommand(l);n.AddRequirementCommand(l);n.AddCommentCommand(l);n.insertChapterCommand(l);n.insertRequirementCommand(l);n.insertCommentCommand(l)}if(m==="Requirement Specification"){if(!o.isRoot()){n.AddSpecificationFolderCommand(l);n.AddRequirementSpecificationCommand(l)}n.insertRequirementCommand(l);n.insertCommentCommand(l);n.insertChapterCommand(l)}if(m==="Requirement Group"){if(!o.isRoot()){n.AddSpecificationFolderCommand(l);n.AddRequirementSpecificationCommand(l)}n.insertSpecificationFolderCommand(l);n.insertRequirementSpecificationCommand(l)}if(m==="Comment"){n.AddChapterCommand(l);n.AddRequirementCommand(l);n.AddCommentCommand(l)}if(m!="Comment"&&m!="Requirement"&&m!="PlmParameter"){n.insertInsertExistingCommand(l)}}return l},_startLink:function(l){var m=l.context;if(this._startLinkCmd===null){this._startLinkCmd=new j();this._endLinkCmd=new e({container:".pad_view_container"})}var n={id:m.getID(),physicalId:m.getID(),type:m.options.type,kindof:this._defaultTypes[m.options.type]||m.options.type,path:m.getOccurencePath(),title:m.options.label};this._startLinkCmd.execute(n)},_endLink:function(l){var p=l.context;if(this._startLinkCmd===null){this._startLinkCmd=new j();this._endLinkCmd=new e({container:".pad_view_container"})}var m=p.getID();var n=p.getID();var t=p.options.type;var q=p.options.type;var o=p.getOccurencePath();var s=p.options.label;var r={id:n,physicalId:n,type:t,kindof:q,path:o,title:s};this._endLinkCmd.execute(r)},AddRequirementCommand:function(l){var m=this;l.push({title:f.AddRequirement,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertNewRequirement.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"AddNewRequirement"})}}})},CreateExternalRequirementCommand:function(l){if(!this.externalProviders){return}var m=this;l.push({type:"PushItem",title:f.InsertNewExtReq,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertNewRequirement.png")+")",submenu:[{type:"PushItem",title:f.ExternalSubReq,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertSubReq.png")+")",action:{callback:function(){m._launchAction({command:"CreateExternalSubRequirement"})}}},{type:"PushItem",title:f.ExternalDerivedReq,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertSubReq.png")+")",action:{callback:function(){m._launchAction({command:"CreateExternalDerRequirement"})}}}]})},InsertExternalRequirementCommand:function(l){if(!this.externalProviders){return}var m=this;l.push({type:"PushItem",title:f.InsertExistExtReq,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertNewRequirement.png")+")",submenu:[{type:"PushItem",title:f.ExternalSubReq,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertSubReq.png")+")",action:{callback:function(){m._launchAction({command:"InsertExternalSubRequirement"})}}},{type:"PushItem",title:f.ExternalDerivedReq,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertSubReq.png")+")",action:{callback:function(){m._launchAction({command:"InsertExternalDerRequirement"})}}}]})},AddRequirementSpecificationCommand:function(l){var m=this;l.push({title:f.AddRequirementSpecification,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertNewRequirementSpecification.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"AddNewRequirementSpecification"})}}})},AddSpecificationFolderCommand:function(l){var m=this;l.push({title:f.AddSpecificationFolder,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertNewSpecificationFolder.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"AddNewSpecificationFolder"})}}})},AddCommentCommand:function(l){var m=this;l.push({title:f.AddComment,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertNewComment.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"AddNewComment"})}}})},AddChapterCommand:function(l){var m=this;l.push({title:f.AddChapter,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertNewChapter.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"AddNewChapter"})}}})},insertRequirementCommand:function(l){var m=this;l.push({title:f.InsertRequirement,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertSubReq.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"InsertRequirement"})}}})},insertChapterCommand:function(l){var m=this;l.push({title:f.InsertChapter,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertSubChapter.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"InsertChapter"})}}})},insertCommentCommand:function(l){var m=this;l.push({title:f.InsertComment,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertSubComment.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"InsertComment"})}}})},insertRequirementSpecificationCommand:function(l){var m=this;l.push({title:f.InsertRequirementSpecification,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertSubRequirementSpecification.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"InsertRequirementSpecification"})}}})},insertSpecificationFolderCommand:function(l){var m=this;l.push({title:f.InsertSpecificationFolder,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertSubSpecFolder.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"InsertSpecificationFolder"})}}})},insertInsertExistingCommand:function(l){var m=this;l.push({title:f.InsertExisting,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertExistingObject.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"InsertExisting"})}}})},InsertExistingRequirementCommand:function(l){var m=this;l.push({title:f.InsertExistingRequirement,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdInsertExisting.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"InsertExisting"})}}})},insertParameterCommand:function(l){var m=this;l.push({title:f.insertParameterCommand,icon:"url("+b.getWebappsAssetUrl("PARParameterCommands","icons/32/I_AddParameter.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"ActionBar_Parameters"})}}})},detachCommand:function(l){var m=this;l.push({title:f.DetachCommand,icon:"url("+b.getWebappsAssetUrl("RichView","icons/32/iconReqCmdDetach.png")+")",type:"PushItem",action:{callback:function(){m._launchAction({command:"Detach"})}}})}});return c});define("DS/ENOREQComponent/ENOREQTreeListView",["DS/PADUtils/PADPredicatesNls","DS/TraceableRequirementsUtils/REQCommandProxy","UWA/Class/Listener","DS/Tree/TreeNodeView","i18n!DS/ENOREQComponent/assets/nls/ENOREQ.json","css!DS/ENOPAD_v2/ENOPAD_v2","DS/ENXNav/views/xNavTreeListView","DS/Utilities/Dom","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADUtils/XNavSettings"],function(e,h,n,m,j,c,i,b,l,a,g){var d;var k=i.extend(n,{name:"pad_treelistview",padtreelst_def_file:{module:"ENOREQComponent",asset:"ENOREQ.2D.json"},_commandProxy:null,_padcustomization:null,_reqCommandProxy:null,init:function(p){this._reqCommandProxy=h.create();p.apiVersion=2;p.not_attr_column=[];var o={};o={0:"bi_color"};p.specific_columns=o;p.isEditable=true;p.enableScrollOnDrag=true;var q=this;this.listenTo(this,"onComplete",function(){if(p.isEditable){var t=q.getManager();var r=t.getNumberOfColumns();for(var s=0;s<r;s++){var u=t.getColumnOptions(s);if(u&&u.dataIndex!=="tree"){t.setColumnOptions(s,{isEditable:false})}}}});p.cellClass=m.extend({init:function(r){this._parent(r)},updateInternalParameters:function(){this._parent();var r=this.getCellInfos();if(!r.isHeader){if(r.nodeModel&&r.nodeModel.options.isBeingCut){r.cellView.getContent().addClassName("pad-state-is-being-cut")}else{r.cellView.getContent().removeClassName("pad-state-is-being-cut")}}},setLabel:function(r){if(this._cellInfos.dataIndex=="tree"&&this.isInEditionMode()){if(!f(this._cellInfos.nodeModel)){return}this._parent(this._cellInfos.nodeModel.options.req_label)}else{this._parent(r)}}});this._parent(p);this.thumbnail_size=15;d=this},buildTreeListOpts:function(o,r){var p=this;if(!UWA.is(o,"object")){throw new Error("Invalid input parameter")}function q(){var s=p._formatColums();s=p._getLocalColumns(s,{specific_columns:o.specific_columns});s=UWA.extend(UWA.clone(g.getSetting("basic_treelistopts")),s);s=p._mergeWithStoredOpts(o.view_customization,s);s=p._enrichViews(s);s.shouldDisplayTooltip=p.provideDisplayTooltip.bind(p);e.updateColumnsWithNLS(s.columns,function(t){if(t.status==="success"){s.columns=t.columns}r(s)})}if(g.getSetting("available_attr")===undefined||o.explicitReset===true){require(["DS/ENOREQComponent/utils/ENOREQTreeLstDefinitionMgr","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices"],function(x,t,w){var v=UWA.clone(o);v.reset=t.getSetting("enopad_widget_reload");v.padtreelst_def_file=p.padtreelst_def_file;v.tenantId=w.getPlatformId();var u=new x(v);if(o.explicitReset===true){u.clearCache()}var y=function(A){function z(C){var B=[];C.pad_columns.forEach(function(E){var F=E.cv_name.split("/");var D=F[F.length-1];B.push({name:D,dataIndex:E.dataIndex,tree:E.dataIndex==="tree"?true:false,exportable:{lock:E["export"].lock,value:E["export"].value},layout:{removable:E.isRemovable,hidden:E.isHidden?E.isHidden:false,width:E.width?E.width:"auto"},kind:E.kind})});return B}g.setAvailableAttr(z(A.json_response));q()};var s=function(){console.error("Error retrieving PADTreeListDefinition: ");var z=g.getSetting("basic_treelistopts");r(z)};u.getTreeListDefinition(y,s)})}else{q()}},getHeader:function(o){var p=j[o]?j[o]:e.getPredicateNls(o);return p},_onCellClick:function(p){this.dispatchEvent("onNodeCellClick",p);if(!UWA.is(p)||!UWA.is(p.cellModel)){return}if(p.cellModel.options.isHeader!==true){var o=this.getOnCellClickCB(p.dataIndex);d._reqCommandProxy.reqSelect({appId:"ENORETV_AP",data:p.dataIndex},true);if(UWA.is(o,"function")){o.call(this,p)}}},getColumnViewCusto:function(p){var o;switch(p){default:o=this._parent(p);break}return o},_getLocalColumns:function(p,o){p=this._parent(p,o);p.columns.splice(1,0,{text:j["ds6w:label"],dataIndex:"tree",width:400,isDraggable:true,minWidth:10,isHidden:false,xnav_options:{name:"displayName",dataIndex:"tree",tree:true,exportable:{lock:true,value:true},layout:{removable:false,hidden:false,width:400}}});p.columns.splice(7,1,{width:150,minWidth:100,maxWidth:400,dataIndex:"paramContent",isDraggable:true,isHidden:false,text:j.paramContent,xnav_options:{name:"paramContent",hardcoded:true,exportable:{lock:false,value:true},layout:{removable:true,hidden:false,width:150,minWidth:100,maxWidth:400}}});return p},provideDisplayTooltip:function(p){var o="";if(p){if(p.isHeader&&UWA.is(j[p.dataIndex])){return{longHelp:j[p.dataIndex]}}else{return this._parent(p)}}}});var f=function(r){var p=widget.displayNameSettings[r.options.reqKindOf];if(!UWA.is(p)){return false}var q=JSON.parse(p);var o=(q.treeDisplayTitle);if(o!=="false"&&o!==""){return true}else{return false}};return k});define("DS/ENOREQComponent/utils//_ENOREQKBInput",["UWA/Core","UWA/Class","UWA/Event","DS/ApplicationFrame/CommandsManager","DS/PADUtils/views/PADAlert","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENOPAD_v2/mixins/_PADKBInput"],function(h,b,f,c,a,e,d){var g=d.extend({init:function(i){this._parent(i);this._onKeyDown_binded=this._onKeyDown.bind(this)},startObservingKeyboard:function(i){h.Element.addEvent.call(document,"keydown",this._onKeyDown_binded)},_onKeyDown:function(l){var k=f.whichKey(l);var j=function(){var m=document.activeElement;if(m&&m.tagName==="INPUT"){return true}else{return false}};var i=function(m,o){var n=c.getCommand(o);if(n&&(n.isEnabled()||o==="Uncut")){if(!j()){n.begin();f.stop(l)}}};switch(k){case"ctrl+a":i(k,"SelectAll");break;case"del":i(k,"DeleteHdr");break;case"ctrl+c":i(k,"Copy");break;case"ctrl+x":i(k,"Cut");break;case"ctrl+v":i(k,"Paste");break;case"ctrl+z":case"esc":i(k,"Uncut");break;case"alt+return":case"alt+enter":i(k,"ActionBar_Attributes");break;default:break}}});return g});define("DS/ENOREQComponent/ENOREQModelParser",["DS/Logger/Logger","DS/ENXNav/models/xNavNodeModel","DS/UIKIT/Spinner","DS/PADUtils/views/PADAlert","DS/PADUtils/PADSettingsMgt","text!DS/ENOREQComponent/assets/ENOREQSettings.json","DS/PADUtils/PADUtilsServices","i18n!DS/ENOREQComponent/assets/nls/ENOREQ.json","DS/PADUtils/PADProbes","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/XNavSettings"],function(q,m,i,p,h,n,j,e,f,c,g){var s={},t={};var b,a,l;var d=function(v){var u=document.createElement("textarea");u.innerHTML=v;return u.value};var r=["revision","current","policy","project"];var k=function(){if(!b){var u=JSON.parse(n);b=u.Icons;a=u.mql_colmuns;l=u.thumbnail}};var o=function(y,D){k();var B=function(L){var K,I="";var H=" < ";var J=(UWA.is(L.unit)&&UWA.is(L.unit.displayName))?" "+L.unit.displayName:"";if(L.minvalue!=null){if(L.mininclus=="true"){H=" <= "}I=L.minvalue+J+H;H=" < "}if(UWA.is(L.values,"array")&&L.values.length>0){I=I+"..."}else{if(L.value!=null){I=I+L.value+J}}if(L.maxvalue!=null){if(L.maxinclus=="true"){H=" <= "}I=I+H+L.maxvalue+J;H=" < "}return I};var w={grid:{},padgrid:{},label:null,type:null,externalObject:false,reqInterface:null,resourceid:null,thumbnail:null,icons:[],relationOrder:null,tenant:"tenant",reqKindOf:null};if(UWA.is(y["interface"])&&UWA.is(y["interface"].name)&&y["interface"].name!==null){var A=[];if(y["interface"].name.indexOf(",")>=0){A=y["interface"].name.split(",")}else{A.push(y["interface"].name)}for(var F=0;F<A.length;F++){if(D.externalTypes.indexOf(A[F])>=0){w.externalObject=true}}w.reqInterface=A}var E,u,G;for(var v in y){if(y.hasOwnProperty(v)){if(v==="physicalid[connection]"){w.relationid=y[v]}if(v==="attribute[TreeOrder]"){w.relationOrder=parseFloat(y[v])}else{if(v==="type[connection]"){w.relationtype=y[v]}else{if(v==="physicalid"){w.resourceid=y[v]}else{if(v==="attribute[Title]"){w.label=(y[v]!==null)?d(y[v]):y.name;w.req_label=d(y[v]);w.grid["ds6w:label"]=w.req_label}else{if(v==="name"){w.req_name=y[v]}else{if(v==="type"){var z=(UWA.is(y[v].displayName))?y[v].value:y[v];var x=(UWA.is(y[v].displayName))?y[v].displayName:y[v];w.type=z;x=d(x);w.grid[a[v]]=x;G=D._defaultTypes[w.type]||w.type,w.reqKindOf=G}else{if(v==="description"){w.grid[a[v]]=(y[v]!==null)?y[v]:""}else{if(v==="organization"){w.padgrid[a[v]]=e[v]}else{if(v==="originated"||v==="modified"){w.grid[a[v]]=d(y[v])}else{if(v==="owner"){w.grid["ds6w:responsible"]=y[v].displayName}else{if(v==="interface"&&UWA.is(y["interface"].value)){w.grid.paramContent=B(y[v].value)}else{if(w.externalObject&&r.indexOf(v)<0){continue}if(UWA.is(y[v],"object")){w.grid[a[v]]=(y[v].displayName!==null)?y[v].displayName:""}else{w.grid[a[v]]=(y[v]!==null)?y[v]:""}}}}}}}}}}}}}}if(y.type_icon_url){E=y.type_icon_url}else{if(w.externalObject){E=j.get3DSpaceUrl()+"/webapps/ENOREQComponent/assets/icons/32/";E+=b["Requirement Proxy"]}else{E=j.get3DSpaceUrl()+"/snresources/images/icons/small/";if(b[G]){E+=b[G]}else{E+="iconSmallDefault.gif"}}}w.icons.push(E);if(y.thumbnails){E=y.thumbnails}else{u=j.get3DSpaceUrl()+"/snresources/images/icons/large/";if(l[G]){u+=l[G]}else{u+="iconLargeDefault.png"}}w.thumbnail=u;w.grid.thumbnail="url("+u+")";if(widget&&!UWA.is(widget.displayNameSettings)){var C=sessionStorage.getItem("RMTPreferredDisplayName");widget.displayNameSettings=UWA.is(C,"string")?JSON.parse(C):C}if(UWA.is(name)&&UWA.is(widget.displayNameSettings[G])){w.label=c.computeDisplayName({name:y.name,title:w.label,revision:w.grid["ds6wg:revision"]},widget.displayNameSettings[G])}w.grid.displayName=w.label;w.display=w.label;return w};s.parse_expand=function(x,z,y,w){if(f.begin){f.begin({name:"parse_expand"})}var u={nodes:{},did_to_resourceid:{},structure:{}};var v=y;x.forEach(function(A){if(A.hasOwnProperty("attributes")){var C=t.parse_attributes(A.attributes,z,v);u.nodes[C.resourceid]=C;if(UWA.is(C.did)){u.did_to_resourceid[C.did]=C.resourceid}}else{if(A.hasOwnProperty("path")){var B=u.structure;A.path.forEach(function(E,D){if(!B.hasOwnProperty(E)){B[E]={}}B=B[E]})}else{console.log("parse_expand: Unknown object "+JSON.stringify(A))}}});if(f.begin){f.end({name:"parse_expand"})}return u};t.parse_attributes=function(w,B,v){k();var A={},x,y;w.forEach(function(G){if(G.name==="type"){G.name="ds6w:type"}else{if(G.name==="ds6w:businessType"){console.log("noooooooooooooooooo")}else{if(G.name==="owner"){G.name="ds6w:responsible"}else{var H=G.name.split("/");G.name=H[H.length-1]}}}if(UWA.is(G.value)&&UWA.is(G.value.replace,"function")){G.value=G.value.replace(/\\n/g," ")}if(G.name==="ds6w:type"){A.type=G.value;y=v._defaultTypes[A.type]||A.type;A.reqKindOf=y}if(G.name==="resourceid"||G.name==="physicalid"){A.resourceid=G.value}else{if(G.name==="did"){A.did=G.value}else{if(G.name==="spec.TreeOrder"){A.relationOrder=parseFloat(G.value)}else{if(G.name==="preview_url"||G.name==="thumbnail_2d"){A.thumbnail=G.value;if(!A.grid){A.grid={}}A.grid.thumbnail="url("+G.value+")"}else{if(G.name==="type_icon_url"){if(!A.icons){A.icons=[]}A.icons.push(G.value)}else{if(G.name==="ECChangement"||G.name==="COChangement"){if(!A.grid){A.grid={}}var F=j.get3DSpaceUrl()+"/common/images/iconSmallECRO.gif";A.grid.changeManagement=F}else{if(G.name===B.tree||G.name==="ds6w:label"){A.label=G.value;A.req_label=G.value}else{if(G.name==="ds6w:refinedInto"){if(!A.refined){A.refined=[]}A.refined.push(G.value)}else{if(G.name==="Req_Test_Cases"){if(!A.test_cases){A.test_cases=[]}A.test_cases.push(G.value)}else{if(G.name==="ds6w:covers"){if(!A.covers){A.covers=[]}A.covers.push(G.value)}else{if(G.name==="name"){x=G.value;A.req_name=G.value}else{if(G.name==="ds6w:status"){if(!A.grid){A.grid={}}if(G.dispValue){var C=G.dispValue;if(C.contains(".")){var E=C.split(".");C=E[E.length-1]}A.grid[G.name]=C}else{var C=G.value;if(C.contains(".")){var E=C.split(".");C=E[E.length-1]}A.grid[G.name]=C}}else{if(G.name==="ds6wg:revision"){if(!A.grid){A.grid={}}A.grid[G.name]=G.dispValue?G.dispValue:G.value}else{if(B.available_columns&&B.available_columns.indexOf(G.name)!==-1){if(!A.grid){A.grid={}}var D=G.dispValue?G.dispValue:G.value;if(UWA.is(A.grid[G.name])){A.grid[G.name]=A.grid[G.name]+","+D}else{A.grid[G.name]=D}}else{if(!A.padgrid){A.padgrid={}}A.padgrid[G.name]=G.dispValue?G.dispValue:G.value}}}}}}}}}}}}}}});if(A.refined){A.grid["ds6w:refinedInto"]=A.refined.length.toString()}if(A.test_cases){A.grid.Req_Test_Cases=A.test_cases.length.toString()}if(A.covers){A.grid["ds6w:covers"]=A.covers.length.toString()}if(!A.relationOrder){A.relationOrder=-1}if(!A.icons&&w.length>4){A.icons=[];var z=j.get3DSpaceUrl()+"/snresources/images/icons/small/";var y=v._defaultTypes[A.type]||A.type;if(b[y]){z+=b[y]}else{z+="iconSmallDefault.gif"}A.icons.push(z)}if(w.length>4){if(e[A.type]){A.grid["ds6w:type"]=e[A.type]}if(widget&&!UWA.is(widget.displayNameSettings)){var u=sessionStorage.getItem("RMTPreferredDisplayName");widget.displayNameSettings=UWA.is(u,"string")?JSON.parse(u):u}A.grid["ds6w:label"]=A.req_label;if(UWA.is(x)&&UWA.is(widget.displayNameSettings[y])){A.label=c.computeDisplayName({name:x,title:A.grid["ds6w:label"],revision:A.grid["ds6wg:revision"]},widget.displayNameSettings[y])}A.grid.displayName=A.label;A.display=A.label}return A};t.process={fetch:function(u){u.treedocument.withTransactionUpdate(function(){var w=[];if(u.authored){console.log("process.fetch on mql");for(var v=0;v<u.response.results.length;v++){var x=new m(o(u.response.results[v],u.treedocument));w.push(x);u.treedocument.addRoot(x);u.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:u.treedocument.getRoots().length,added_node:x}});u.treedocument.getModelEvents().publish({event:"onReqAdded",data:{nb_root:u.treedocument.getRoots().length,added_node:x}})}}else{console.log("process.fetch");if(!UWA.is(u.treedocument,"object")||!UWA.is(u.response,"object")){throw new Error("Invalid input parameters")}if(!UWA.is(u.response.results,"array")){throw new Error("Invalid response format - results isn't an array")}console.log(u.response.results.length+" nodes to create");u.response.results.forEach(function(z,y){console.log("Create node "+(y+1));if(!UWA.is(z.attributes,"array")){throw new Error("Invalid result format - attributes isn't an array")}var B=t.parse_attributes(z.attributes,g.getAvailableColumns(),u.treedocument);var A=new m(B);u.treedocument.addRoot(A);w.push(A);u.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:u.treedocument.getRoots().length,added_node:A}});u.treedocument.getModelEvents().publish({event:"onReqAdded",data:{nb_root:u.treedocument.getRoots().length,added_node:A}})})}u.treedocument.prepareBroadcastSelect();w.forEach(function(y){y.select()});u.treedocument.pushBroadcastSelect()})},expand:function(u){console.log("process.expand");if(!u.filterMode){this.expandMql(u)}else{if(!UWA.is(u.treedocument,"object")||!UWA.is(u.root_nodes,"array")||!UWA.is(u.response,"object")){throw new Error("Invalid input parameters")}if(!UWA.is(u.response.results,"array")){throw new Error("Invalid response format - results should be an array")}u.starting_from_root=(u.starting_from_root===undefined)?true:u.starting_from_root;if(f.begin){f.begin({name:"CV transactionWithUpdate_expand"})}u.treedocument.withTransactionUpdate(function(){var G=s.parse_expand(u.response.results,g.getAvailableColumns(),u.treedocument);var w="expanded",z=false,D=false,C=u.expand_level;switch(u.mode){case"find_in_ctx":w="partiallyExpanded";z=true;break;case"refresh":D=true;break}var A=function(I){var H;for(var J=0;J<u.root_nodes.length;J++){if(u.starting_from_root===true){if(u.root_nodes[J].getID()===I){H=[u.root_nodes[J]];break}}else{H=u.root_nodes[J].getNodesById(I);if(H!==undefined&&H.length>0){break}}}return H};var B=function(J,H){var K=false;var I={};if(H.label!==J.options.label){I.label=H.label;K=true}if(!UWA.equals(H.grid,J.options.grid)){I.grid=H.grid;K=true}if(!UWA.equals(H.padgrid,J.options.padgrid)){I.padgrid=H.padgrid;K=true}if(K){J.updateOptions(I)}};var x=function(W,aa){var P=Object.getOwnPropertyNames(W);var S=[],M=D?S.concat(aa.getChildren()):undefined;if(P.length>0){var N=false,U=-1,J=[];for(var I=0;I<P.length;I++){var ac=P[I];if(G.did_to_resourceid.hasOwnProperty(ac)){var Q=G.did_to_resourceid[ac];var K=G.nodes[Q].type;var H=G.nodes[Q].relationOrder;var ab=Object.getOwnPropertyNames(W[ac])[0];var O=G.did_to_resourceid[ab];var T=aa.getChildByIds(Q,O);if(!UWA.is(T,"object")){N=true;var ad=G.nodes[O];ad.relationid=Q;ad.relationtype=K;ad.relationOrder=H;if(h.getSetting("tree_order_in_label")===true){ad.label+=("(treeorder="+H+")")}T=new m(ad);if(H>=U){aa.addChild(T);U=H;J.push(H)}else{var R=null;var L=aa.getChildren();if(L){for(var Y=0,Z=L.length;Y<Z;Y++){if(J[Y]>H){R=L[Y];J.splice(Y,0,H);break}}}aa.insertBefore(T,R)}}else{if(D===true){B(T,G.nodes[O])}if(M!==undefined){var V=M.indexOf(T);if(V!==-1){M.splice(V,1)}}}x(W[ac][ab],T)}else{console.log("Invalid CV id ["+ac+"]")}}if(z){aa.childComputed=false;aa.select()}else{aa.childComputed=true}if(D===true&&N===false){console.log("State is not changed in refresh context")}else{aa.setState({state:w});aa.options.padstate=w}}else{if(D!==true){var X=aa.getDepth();if(C&&(C===-1||C>X)){if(aa.options.type!=="Requirement Specification"){aa.childComputed=true;aa.options.children=null;aa.setState({state:"noChildren"});aa.options.padstate="noChildren";if(X===0||C===-1){aa._expandState="noExpandState"}}}else{if(aa.options.relcount!==null&&aa.options.relcount===0){aa.setState({state:"noChildren"});aa.options.padstate="noChildren";aa.childComputed=true;aa.options.children=null;if(z){aa.select()}}}}}if(M!==undefined&&M!==null&&M.length>0){M.forEach(function(ae){if(ae!==null){aa.removeChild(ae)}})}};var y=Object.getOwnPropertyNames(G.structure);if(f.begin){f.begin({name:"CV treat_expand"})}if(y.length>0){for(var E=0;E<y.length;E++){var F=y[E];if(G.did_to_resourceid.hasOwnProperty(F)){var v=A(G.did_to_resourceid[F]);if(v!==undefined){v.forEach(function(I){if(I!==undefined){B(I,G.nodes[G.did_to_resourceid[F]]);var H=G.structure[F];x(H,I)}})}else{console.log("Invalid root id: "+F)}}}}else{console.log("No roots found")}if(f.end){f.end({name:"CV treat_expand"})}});if(f.end){f.end({name:"CV transactionWithUpdate_expand"})}}},refresh_nodes:function(v){console.log("process.refresh_nodes");if(!UWA.is(v.treedocument,"object")||!UWA.is(v.response,"object")||!UWA.is(v.refresh_parameters,"object")){throw new Error("Invalid input parameters")}var u=[];var w=function(y,x){var z=o(x,v.treedocument);if(UWA.is(v.treedocument.filterAttributesForUpdate,"function")){z=v.treedocument.filterAttributesForUpdate({node:y,node_opts:z})}return z};v.treedocument.withTransactionUpdate(function(){for(var y=0;y<v.response.results.length;y++){var x=v.response.results[y];var B=x.physicalid;if(B===""){throw new Error("Resourceid not found in fetch result for "+JSON.stringify(x))}if(v.refresh_parameters.created&&v.refresh_parameters.created.indexOf(B)!==-1){var A=t.parse_attributes(x.attributes,g.getAvailableColumns(),v.treedocument);var z=new m(A);v.treedocument.addRoot(z);v.treedocument.getModelEvents().publish({event:"onReqAdded",data:{nb_root:v.treedocument.getRoots().length,added_node:z}});u.push(z.getID())}else{if(v.refresh_parameters.modified&&(v.refresh_parameters.modified.indexOf(B)!==-1||v.ids_modified.indexOf(B)!==-1)){v.treedocument.getRoots().forEach(function(E){var D=E.getNodesById(B);D.forEach(function(F){if(F._getNodeInfos().virtualRowID===null){console.log("Invalid virtualRowID for node "+F.options.label)}F.updateOptions(w(F,x))})});var C=v.treedocument.searchRootById(B);if(C){C.updateOptions(w(C,x))}if(C){v.treedocument.getModelEvents().publish({event:"onReqAdded",data:{nb_root:v.treedocument.getRoots().length,added_node:C}})}}}}});return u},insert_nodes:function(x){console.log("process.insert_nodes");if(!UWA.is(x.treedocument,"object")||!UWA.is(x.response,"object")||!UWA.is(x.insert_parameters,"object")){throw new Error("Invalid input parameters")}var y={};var u={insertExisting:{modified:[],inserted:[],created:[]}};for(var w in x.insert_parameters){if(x.insert_parameters.hasOwnProperty(w)){var v=[];if(x.insert_parameters[w][0].resourceid!==x.response.results[0]["physicalid"]){throw new Error("Invalid child id["+x.insert_parameters[w][0].resourceid+"]")}x.treedocument.getRoots().forEach(function(z){v=v.concat(z.getNodesById(w))});x.insert_parameters[w].forEach(function(z){x.treedocument.withTransactionUpdate(function(){v.forEach(function(F){var D=o(x.response.results[0],x.treedocument);D.relationid=z.relationid;var C=new m(D);if(UWA.is(x.beforeNode)&&x.beforeNode!=null){F.addChild(C,x.beforeNode+1)}else{if(UWA.is(z.treeOrder)&&z.treeOrder!=null){var E=F.getChildren();var B=z.treeOrder;var A=0;if(E&&E.length>0){while(A<E.length){if(E[A].options.relationOrder>B){C.options.relationOrder=B;F.insertBefore(C,E[A]);break}else{if(A==E.length-1){C.options.relationOrder=B;F.addChild(C);break}}A++}}else{C.options.relationOrder=B;F.addChild(C)}}else{F.addChild(C)}}F.options.expandState="partiallyExpanded";F.setState({state:"partiallyExpanded"});F.options.padstate="partiallyExpanded";u.insertExisting.modified.push(F.getID());u.insertExisting.inserted.push(C.getID());u.insertExisting.created.push(C.getRelationID());u.insertExisting.withContext=false;C.select()})})})}}return u},expandMql:function(u){var v="expanded";if(f.begin){f.begin({name:"MQL transactionWithUpdate_expand"})}u.treedocument.withTransactionUpdate(function(){var B=[u.root_nodes[0]];var D=1;var y=0;function C(E){var F=parseFloat(E);return F|0}var z=u.response.results;for(var x=0;x<z.length;x++){if(f.begin){f.begin({name:"MQL parse_expand"})}var w=new m(o(z[x],u.treedocument));var A=C(z[x]["level"]);if(w.options.reqKindOf!=="Requirement Specification"){w.options.padstate=v}if(B.length>1){if(A===D){B[A].options.padstate=v;if(B[A].options.reqKindOf!=="Requirement Specification"){B[A].setState({state:v});B[A]._expandState="noExpandState";B[A].childComputed=true;B[A].options.children=null;B[A-1].childComputed=true}B[A-1].setState({state:v});B[A-1].options.padstate=v;B[A-1].addChild(B[A]);B[A]=w;D=A}else{if(A>D){B[A]=w;D=A}else{y=D;if(B[D].options.reqKindOf!=="Requirement Specification"){B[D].childComputed=true;B[D]._expandState="noExpandState";B[D].options.padstate="noChildren";B[D].options.children=null}while(A-1<y){B[y-1].setState({state:v});B[y-1].options.padstate=v;B[y-1].childComputed=true;B[y-1].addChild(B[y]);y=y-1}B[A]=w;D=A}}}else{B.push(w)}}y=D;if(B[D].options.reqKindOf!=="Requirement Specification"){B[D].childComputed=true;B[D]._expandState="noExpandState";B[D].options.padstate="noChildren";B[D].options.children=null}while(0<y){B[y-1].setState({state:v});if(B[y-1].options.reqKindOf!=="Requirement Specification"){B[y-1].childComputed=true}B[y-1].options.padstate=v;B[y-1].addChild(B[y]);y=y-1}if(f.end){f.end({name:"MQL parse_expand"})}});if(f.end){f.end({name:"MQL transactionWithUpdate_expand"})}}};return t});define("DS/ENOREQComponent/ENOREQWSAccess",["UWA/Core","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADSession","DS/PADUtils/PADUtilsServices","DS/TraceableRequirementsUtils/Services/RequirementWebServices","text!DS/ENOREQComponent/assets/ENOREQSettings.json","DS/PADUtils/PADContext","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/PADUtils/PADProbes"],function(h,l,c,a,d,j,n,f,b,g){var p;var m=function(){var w=null;var v=f.get();var r=null;var u=null;var s;var t={context:v};if(null==v){alert("Can't find localContext")}b.getInstance(t).getSecurityContext({onSuccess:function(x){s=x.SecurityContext},onFailure:function(y){if(typeof v.displayNotification==="function"){var x={eventID:"error",msg:y.message};v.displayNotification(x)}else{alert(message)}}},{serverName:r,serverUri:u});return s};var i=function(){if(!p){p=JSON.parse(n)}return p};var o=function(r){var u={};var s=i();var t=UWA.extend({root_physical_id:r.data.root_physicalid,type_filter:r.data.type_filter_bo,rel_filter:r.data.type_filter_rel,},s.expand.mql_expand_data,false);j.expand({securityContext:m(),json:t,onComplete:r.onComplete,onFailure:r.onFailure})};var k=function(t){var s="";for(var r=0;r<t.pids.length-1;r++){s+=t.pids[r]+","}s+=t.pids[t.pids.length-1];j.getInfo({securityContext:m().replace("ctx::",""),pid:s,selectables:i().fetch.MQL_fetch,onComplete:t.onComplete,onFailure:t.onFailure})};var e=function(s,r){var u=null;var t=require("DS/PADUtils/PADSettingsMgt");var v=t.getSetting("cors_activated");if(v===true){u=l.authenticatedRequest(s,r)}else{r.proxy="passport";u=l.proxifiedRequest(s,r)}return u};var q={padtreelistOpts:function(t){var u=require("DS/PADUtils/PADSettingsMgt");var s=d.get3DSpaceUrl()+"/resources/enopad/admin/readsettings";if(u.getSetting("local_preferences")){s=c.getWebappsAssetUrl("ENOREQComponent","ENOREQ.2D.json");var r=t;r.data={};l.request(s,r)}else{if(t.data!==undefined&&UWA.is(t.data,"object")&&t.data.app!==undefined&&t.data.intent!==undefined&&t.data.reset!==undefined){var v=t;if(!UWA.is(s)||!UWA.is(v,"object")){throw new Error("Invalid inputs for PADWSAccess.padtreelistOpts")}v.method="GET";v.headers={Accept:"application/json"};v.data="intent="+t.data.intent+"&app="+t.data.app+"&reset="+((t.data.reset===true)?"true":"false");return e(s,v)}else{throw new Error("Invalid inputs for PADWSAccess.padtreelistOpts")}}},navigate:function(t){var u=require("DS/PADUtils/PADSettingsMgt");if(t.data.authored){t.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":u.getSetting("lang")};o(t)}else{var s=d.get3DSpaceUrl(),r=t;s=s+"/cvservlet/multiexpand";if(!UWA.is(s)||!UWA.is(r,"object")){throw new Error("Invalid inputs for PADWSAccess.navigate")}if(!UWA.is(r.data,"object")){throw new Error("Invalid inputs for PADWSAccess.navigate options.data not found")}r.method="POST";r.headers={Accept:"application/json","Content-Type":"application/json"};r.data.label=d.getRequestLabel();delete r.data.authored;delete r.data.expand_iter;delete r.data.type_filter_bo;delete r.data.type_filter_rel;r.onTimeout=r.onTimeout||r.onFailure;r.data=JSON.stringify(r.data);return e(s,r)}},fetch:function(t){var u=require("DS/PADUtils/PADSettingsMgt");if(t.authored){t.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":u.getSetting("lang")};k(t)}else{var s="",r=t;if(!UWA.is(s)||!UWA.is(r,"object")){throw new Error("Invalid inputs for PADWSAccess.fetch")}r.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":u.getSetting("lang")};r.method="POST";s=d.get3DSearchUrl()+"/search";if(s.contains("3DSpace")){s=s.replace("/3DSpace","")}r.data={label:d.getRequestLabel(),query:"physicalid:"+r.pids.join(" OR physicalid:"),nresults:r.pids.length,locale:u.getSetting("lang"),tenant:d.getTenantId(),source:["3dspace"],select_predicate:i().fetch.CV_fetch,};if(UWA.is(t.isParameter)&&t.isParameter==true){r.data.specific_source_parameter={"3dspace":{plmparam:{retrieve_plmparam:true}}}}delete r.authored;r.data=JSON.stringify(r.data);r.onTimeout=r.onTimeout||r.onFailure;return e(s,r)}},getTenant:function(){return d.getTenantId()},reParent:function(r){r.securityContext=m();j.reorder(r)},insertExisting:function(r){r.securityContext=m();j.insertExisting(r)}};return q});define("DS/ENOREQComponent/utils/ENOREQTreeLstDefinitionMgr",["UWA/Core","UWA/Class","UWA/Event","DS/ENXNav/views/customize_views/_xNavTreeLstDefinitionMgr","DS/PADUtils/XNavSettings","text!DS/ENOREQComponent/assets/ENOREQ.2D.json"],function(g,b,c,e,a,f){var d=e.extend({init:function(h){this._parent(h)},getTreeListDefinition:function(n,j){var k=this;var i=localStorage.getItem(this.storageKey);var m=g.is(i,"string")?JSON.parse(i):i;if(g.is(m)){if(n){n(m)}}else{var h=a.getSetting("basic_treelistopts");var l=function(p){var o=g.is(p,"string")?JSON.parse(p):p;var q={build_tree_opts:h,json_response:o};localStorage.setItem(k.storageKey,JSON.stringify(q));sessionStorage.removeItem(k.pendingKey);if(n){n(q)}};l(f)}},});return d});define("DS/ENOREQComponent/ENOREQTreeDocument",["DS/ENOPAD_v2/models/PADTreeDocument","DS/PADUtils/PADSettingsMgt","DS/ENOREQComponent/ENOREQModelParser","DS/ENOREQComponent/ENOREQWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADProgressBar","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADSession","text!DS/ENOREQComponent/assets/ENOREQSettings.json","DS/PADUtils/PADProbes","i18n!DS/ENOREQComponent/assets/nls/ENOREQ.json","DS/TraceableRequirementsUtils/REQCommandProxy","DS/TraceableRequirementsUtils/Services/RequirementWebServices","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/XNavSettings","i18n!DS/RichView/assets/nls/RichView"],function(r,g,m,n,t,h,a,p,l,q,e,k,j,b,o,c,f,s){var u;var i={notAllowedChars:["/",'"',"#","$","@","%","*",",","?","\\","<",">","[","]","|",":"],maxLength:127};var d=r.extend({name:"pad_treedocument",_insertFlag:true,req_navigate_options:{},_defaultTypes:{},reroderSpecTypes:["Chapter","Comment","Requirement","Requirement Specification","Specification Folder"],externalTypes:["ProxyItem"],_relPattern:null,nameRules:{notAllowedChars:["/",'"',"#","$","@","%","*",",","?","\\","<",">","[","]","|",":"],maxLength:127},init:function(v){this.reqCommandProxy=j.create();this._defineDefaultTypes();this._relPattern=JSON.parse(o);this._parent(v);this.req_navigate_options=JSON.parse(q);this.onNodeModelUpdate(this.onNodeModelUpdateRequirement);u=this},_selectOccurence:function(){var E=this.getRoots(),A=this,F=this._selected_paths,C=null,D=true;if(F.length>0){C=this._selected_paths[0][this._selected_paths[0].length-1];this._doNotBroadcastSelect=true;this.prepareUpdate();var B=[];E.forEach(function(G){for(var H=0;H<F.length;H++){var I=G.getNodeByPath(F[H]);if(I){B.push(I)}}});if(B.length===0){D=false;var y=this.getSelectedNodes();for(var z=0;z<y.length;z++){var w=y[z];if(w.getID()===C){D=true}}if(!D){this.unselectAll();var v=this.getNodesById(C);v.forEach(function(G){G.select()})}}else{this.unselectAll();for(var x=0;x<B.length;x++){if(!B[x].isSelected()){B[x].select()}}}this.pushUpdate();this._doNotBroadcastSelect=false}},xnav_expand:function(K){var B=K.data,z=B.nodeModel,J=B.expandAll?B.expandAll:false,F=null,C=false,y="default",E="-1";this.invalidateViewPort();var D=this,w=function(O,N,M){var P=function(V,U,T){if(U===-1||T<U){if(V.childComputed){if(V.hasChildren()){var S=V.getChildren(),R=true;for(var Q=0;Q<S.length&&R===true;Q++){var W=S[Q];if(W.childComputed&&W._expandState!=="noExpandState"&&(W.getDepth()<U||U===-1)){W.setState({state:"expanded"})}R=P(W,U,T+1);if(R===undefined){throw new Error("Undefined no_expand_needed flag")}}return R}else{return true}}else{if(V.options.reqKindOf==="Requirement Specification"){return true}else{if(U===-1||U>T){return false}else{return true}}}}else{return true}};var L=P(O,N,M);return L};if(z.childComputed&&C===false){var A=z.getDepth();if(w(z,J?parseInt(E):A+parseInt(E),A)){K.target.preExpandDone({preventExpandAll:true});D._colorize3D(this);return}}if(z.options.expandState&&z.options.expandState==="partiallyExpanded"){z.removeChildren();z.options.expandState="expanded"}else{if(!z.options.expandState&&z.options.children.length>0){z.removeChildren();z.options.expandState="expanded"}else{if(!z.childComputed&&z.options.children.length>0){z.removeChildren();z.options.expandState="expanded"}}}var G={};var v=z.options.reqKindOf;if(v==="Requirement Group"){G=this.req_navigate_options.expand.cv_expand_data.folder_expand}else{G=this.req_navigate_options.expand.cv_expand_data.no_folder_expand}var x=n.getTenant();var H=true;var I=UWA.extend({root_physicalid:z.getID(),expand_iter:E,authored:H},G,true);if(e.begin){e.begin({name:"expand_WS"})}n.navigate({data:I,onComplete:function(O){if(e.end){e.end({name:"expand_WS"})}var L=false;var M;try{M=D.startTransaction("expand");var N=UWA.is(O,"string")?JSON.parse(O):O;if(N.results.length===0){if(C){t.displayNotification({msg:p.find_in_context_no_result,eventID:"info"})}}else{L=true;m.process.expand({treedocument:D,root_nodes:[z],response:N,mode:y,authored:I.authored,expand_level:parseInt(E),filterMode:false})}}catch(P){t.displayNotification({msg:p.generic_service_failure,eventID:"error"})}finally{if(L){z.childComputed=true;D.unselectAll();D._selectOccurence()}if(M){M.end()}if(l.isUsingIndex()){D.setAdditionalAttributes(I.root_physicalid)}K.target.preExpandDone({preventExpandAll:true,state:C?"partiallyExpanded":undefined})}},onFailure:function(L){K.target.preExpandDone();t.displayNotification({msg:p.generic_service_failure,eventID:"error"})}})},expandMultiSelect:function(w){for(var v=0;v<w.nodes2Expand.length;v++){w.nodes2Expand[v].expandAll()}},add:function(z){var y=this;var A=[];if(UWA.is(z.pids,"array")){z.pids.forEach(function(B){if(A.indexOf(B)===-1){A.push(B)}})}var x=this.getRoots();for(var w=0;w<x.length;w++){var v=A.indexOf(x[w].options.resourceid);if(v!==-1){A.splice(v,1)}}if(A.length>0){n.fetch({pids:A,authored:l.isUsingIndex()?!l.isUsingIndex:!false,onComplete:function(I){var F=UWA.is(I,"string")?JSON.parse(I):I;if(!F.results||F.results.length<A.length){if(!l.isUsingIndex()){t.displayNotification({msg:p.object_not_found_in_db,eventID:"error"})}else{if(F.infos&&F.infos.sources&&F.infos.sources.length>0&&F.infos.sources[0].error){var H=F.infos.sources[0];var C=H.error.errorMessage||"An error has occurred in "+H.name;t.displayNotification({msg:C,eventID:"error"})}else{l.setAuthoringState(true,p.PADSession_disabling_index_object_not_found);y.add(z)}}}else{if(F.results.length>A.length){throw new Error("More results than input objects")}else{if(!l.isUsingIndex()&&F.results.length===1&&UWA.is(F.results[0]["type.kindof"])){var E=F.results[0]["type.kindof"];var G=y.req_navigate_options.root_type;if(G.indexOf(E)===-1){t.displayNotification({msg:p.replace(p.get("unsupported_type_v2"),{type:E}),eventID:"warning"});z.callback.call();y.getModelEvents().publish({event:"onReqAdded",data:{isremove:true,added_node:y.getRoots().length===1?y.getRoots()[0]:null,nb_root:y.getRoots().length}});y.getModelEvents().publish({event:"onReqAdded",data:{isremove:true,added_node:y.getRoots().length===1?y.getRoots()[0]:null,nb_root:y.getRoots().length}});return}}y.wrapInTransaction(function(){y.unselectAll();m.process.fetch({treedocument:y,response:F,authored:l.isUsingIndex()?!l.isUsingIndex:!false})});var B=widget.getValue("trm_tv_addednodes");for(var D=0;D<A.length;D++){if(!UWA.is(B[A[D]])){B[A[D]]={};B[A[D]].tenant=y.getTenant()}}widget.setValue("trm_tv_addednodes",B)}}z.callback.call()},onFailure:function(B){t.displayNotification({msg:p.generic_service_failure,eventID:"error"});z.callback.call()},})}else{z.callback.call()}},applyFilter:function(A){console.log("filter dataaaaaaaaaaaaaaaaaaa",A);var z=this,y="default",w=z.searchRootById(A.filterRootIds[0]);var x=A.CVQuery;if(!UWA.is(x.expand_iter,"string")){x.expand_iter="-1"}x.intent="explore_2D";var v=w.options.reqKindOf;if(v==="Requirement Group"){x=UWA.extend(x,this.req_navigate_options.expand.cv_expand_data.folder_expand,true)}else{x=UWA.extend(x,this.req_navigate_options.expand.cv_expand_data.no_folder_expand,true)}x.authored=false;z.prepareUpdate();x.union.expand.forEach(function(C,B){delete C["q.iterative_filter_query_bo"];delete C.no_type_filter_rel});n.navigate({data:x,onComplete:function(E){if(e.end){e.end({name:"expand_WS"})}var B=false;var C;try{C=z.startTransaction("expand");var D=UWA.is(E,"string")?JSON.parse(E):E;if(D.results.length===0){t.displayNotification({msg:p.find_in_context_no_result,eventID:"info"})}else{B=true;m.process.expand({treedocument:z,root_nodes:[w],response:D,mode:y,authored:false,filterMode:true,expand_level:-1})}}catch(F){t.displayNotification({msg:p.generic_service_failure,eventID:"error"})}finally{if(B){w.childComputed=true;z.unselectAll();z._selectOccurence()}if(C){C.end()}if(l.isUsingIndex()){z.setAdditionalAttributes(x.root_physicalid)}z.pushUpdate()}},onFailure:function(B){t.displayNotification({msg:p.generic_service_failure,eventID:"error"})}})},removeRoot:function(y,z,w){var x=this;this.wrapInTransaction(function(){var A=x.hasOwnProperty("detachedRoots")?x.detachedRoots.indexOf(y):-1;if(A>=0){x.detachedRoots.splice(A,1)}else{x.invalidateViewPort();if(x.getRoots().indexOf(y)>=0){x._parent(y,z,w)}if(!UWA.is(w,"boolean")||!w){if(UWA.is(x._getChildrenFilterInfo,"function")){var B=x._getChildrenFilterInfo();if(B&&UWA.is(B.childrenBeforeFiltering,"array")){var C=B.childrenBeforeFiltering.indexOf(y);if(C>=0){B.childrenBeforeFiltering.splice(C,1)}}}}}});if(!UWA.is(z,"boolean")||!z){var v=this.getRoots().length;if(v===0&&UWA.is(this.detachedRoots,"array")){v=this.detachedRoots.length}this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:y.getID(),remainingRoots:v}});this.getModelEvents().publish({event:"onRootAdded",data:{isremove:true,added_node:this.getRoots().length===1?this.getRoots()[0]:null,nb_root:v}});this.getModelEvents().publish({event:"onReqAdded",data:{isremove:true,added_node:this.getRoots().length===1?this.getRoots()[0]:null,nb_root:v}})}},refreshNodeById:function(y){var z=[],x=this,w=[];if(UWA.is(y.created)){z=z.concat(y.created)}if(UWA.is(y.modified)&&UWA.is(y.modified,"array")){this.withTransactionUpdate(function(){y.modified.forEach(function(C){if(UWA.is(C,"object")){var A=C.physicalid;if(UWA.is(C.attributes,"array")){var B=x.getNodesById(A);B.forEach(function(D){D.updateAttributes(C.attributes,f.getAvailableColumns())})}else{z.push(A);w.push(A)}}else{z.push(C)}})})}if(z.length>0){var v={intent:"explore_2D",authored:y.authored,debug:g.getSetting("enopad_webapis_debug")};n.fetch({enopad_webapis:g.getSetting("enopad_webapis"),pids:z,authored:true,onComplete:function(B){var A=UWA.is(B,"string")?JSON.parse(B):B;if(A.results.length===0){throw new Error("Cannot find object with the physicalid "+z)}if(A.results.length!==z.length){throw new Error("Inconsistent number of results")}x.wrapInTransaction(function(){var D=m.process.refresh_nodes({treedocument:x,response:A,refresh_parameters:y,ids_modified:w});if(UWA.is(D,"array")&&D.length>0){var C={pids:D};x._commandProxy.drop(C)}});if(y.onComplete!==undefined){y.onComplete()}},onFailure:function(A){t.displayNotification({msg:p.generic_service_failure,eventID:"error"})},})}},insertNodes:function(B,w,y){var A=this,v=[];function z(C){if(v.indexOf(C.resourceid)===-1){v.push(C.resourceid)}}for(var x in B){if(B.hasOwnProperty(x)){B[x].forEach(z)}}this._beginBlockingTransaction(a.inserting_nodes);n.fetch({pids:v,authored:true,onComplete:function(D){var C=UWA.is(D,"string")?JSON.parse(D):D;if(C.results.length===0){throw new Error("Cannot find object with the physicalid "+v)}if(C.results.length!==v.length){throw new Error("More results than input objects")}C.results[0]["attribute[TreeOrder]"]=y;A.wrapInTransaction(function(){A.unselectAll();var E=m.process.insert_nodes({treedocument:A,response:C,insert_parameters:B,beforeNode:w});A._commandProxy.padRefresh(E)},"insert_nodes");A._endBlockingTransaction()},onFailure:function(C){t.displayNotification({msg:p.generic_service_failure,eventID:"error"});A._endBlockingTransaction()},})},_defineDefaultTypes:function(){var v=function(z){return z.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")};this._defaultTypes={"Requirement Proxy":"Requirement"};var x=g.getSetting("authorized_types");var w=this;var y=["Requirement Specification","Comment","Requirement","Chapter","Requirement Group"];if(widget){y.forEach(function(z){var B=z.replace(" ","_");var A=widget.getPreference("trm_types_"+B);if(UWA.is(A)){A.options.forEach(function(C){x.push(C.value);x.push(C.value.replace(new RegExp(v(" "),"g"),"_"));w._defaultTypes[C.value]=z})}})}g.setSetting("authorized_types",x)},getReqSpecRoot:function(z){var B=z.getOccurencePath();var w=0,A=null;if(z.options.reqKindOf==="Requirement Specification"||z.options.reqKindOf==="Requirement Group"){return B[0]}else{var v=(B.length/2)+0.5;var y=z;while(A==null&&w<v){var x=y.getParent();if(x.options.reqKindOf=="Requirement Specification"){A=x.getID()}else{w++;y=x}}return A}},_onInsert:function(w,G,C){if(w===G){return}if(G.options.externalObject){t.displayNotification({msg:k.Transaction_forbidden,eventID:"error"});return}var F=[],H=true,A,y;if(UWA.is(w,"array")){for(var B=0;B<w.length;B++){if(w[B]===G){return}}}else{w=[w]}var D=this;w=this.getSelectedNodes();var x=D.getReqSpecRoot(G);var v=D._copyMode;function E(X){try{var W=UWA.is(X,"string")?JSON.parse(X):X;if(W.status==="success"){if(!UWA.is(W.results.resultArray)){var U=W.results;W.results.resultArray=[];W.results.resultArray[0]=U}var O=W.results.resultArray;for(var M=0;M<O.length;M++){var J=D.getReqSpecRoot(w[M]);var V=O[M];var T=V["physicalid[connection]"];var S=V["attribute[TreeOrder]"];w[M].options.relationOrder=S;var R={appId:widget.getValue("appId"),id:w[M].getID(),old_position:{id:A,relid:w[M].getRelationID(),path:y},new_position:{id:G.getID(),relid:T,path:G.getOccurencePath(),treeOrder:S,relType:V["type[connection]"]?V["type[connection]"]:null}};if(UWA.is(x)&&UWA.is(J)){if((x===J)){D.reqCommandProxy.reorder(R)}else{D.reqCommandProxy.detach({appId:widget.getValue("appId"),path:w[M].getOccurencePath()});var N=G.getOccurencePath();N.push(T);N.push(w[M].getID());var L={"attribute[Title]":w[M].options.req_label,"attribute[TreeOrder]":w[M].options.relationOrder,"from.physicalid[connection]":G.getID(),physicalid:w[M].getID(),"physicalid[connection]":T,"type.kindof":w[M].options.reqKindOf,"type[connection]":w[M].options.relationtype,type:{displayName:w[M].options.grid["ds6w:type"],value:w[M].options.type},revision:w[M].options.grid["ds6wg:revision"]};var I={appId:widget.getValue("appId"),path:N,object:L,selection:G.getOccurencePath(),mode:"insertExisting"};D.reqCommandProxy.attach(I)}}var K={node:w[M],parent:G,next:C,behavior:v,newRelationID:T};D.wrapInTransaction(function(){D.withTransactionUpdate(function(){var Z=w[M].getID();var ab=G.getID();var ac=w[M].getRelationID();var aa=!Boolean(ac);D.instantiate(K);var Y={transactions:[]};if(aa||v==="COPY"){Y.transactions.push({insertExisting:{modified:[ab],inserted:[Z],created:[T],withContext:!aa}})}else{Y.transactions.push({reParent:{modified:[ab],inserted:[Z],created:[T],deleted:[ac]}})}D._commandProxy.padRefresh(Y)},D)})}t.displayNotification({msg:"Reorder/Reparent done",eventID:"success"});D._endBlockingTransaction()}else{D._endBlockingTransaction();var Q;if(W.message&&W.message!==null){Q=W.message}else{Q=p.generic_service_failure}t.displayNotification({msg:Q,eventID:"error"})}}catch(P){D._endBlockingTransaction();t.displayNotification({msg:p.generic_service_failure,eventID:"error"})}}function z(J){D._endBlockingTransaction();var I;if(J.message&&J.message!==null){I=J.message}else{I=p.generic_service_failure}t.displayNotification({msg:k.Transaction_forbidden,eventID:"error"})}w.forEach(function(L){var O=null;if(G.getOccurencePath().indexOf(L.getID())>=0){t.displayNotification({msg:k.Transaction_forbidden,eventID:"error"});return}var J=L.getID();var K=null;if(typeof G.getID()==="function"){K=G.getID()}var N=L.getRelationID();var I=(N?false:true);var M;if(L._parentNode.options.resourceid&&v!="COPY"){A=L._parentNode.getID();y=L._parentNode.getOccurencePath();O={object:{id:L.getID(),rootId:A,position:{previousSibling:{},nextSibling:{}}},old:{id:L._parentNode.getID(),relid:L.getRelationID()},newParentId:G.getID()}}else{H=false;A=null;y=null;O={id:L.getID(),pid:G.getID(),previousSibling:{},nextSibling:{}}}M={childBus:L.getOccurencePath(),newParent:G.getOccurencePath(),commit:true};F.push(O)});D._beginBlockingTransaction(a.reparenting);D.reParent({json:{dataArray:F},onComplete:E,onFailure:z},H,null,null);return false},reParent:function(x,w,v,B){if(w){n.reParent(x)}else{x.json=x.json.dataArray[0];if(!UWA.is(v)||!UWA.is(B)){B=this.getNodesById(x.json.pid)[0].options.type;v=this.getNodesById(x.json.id)[0].options.type}var z=this._defaultTypes[v]||v;var y=this._defaultTypes[B]||B;var A=this._relPattern[y][z];x.json.relationship=A;n.insertExisting(x)}},checkReorder:function(x,v){var w=this;return true},handleReparent:function(y,w,C,v){var x=this;var z="MOVE";try{var C=C;var B={node:y,parent:w,next:v,behavior:z,newRelationID:C};x.wrapInTransaction(function(){x.withTransactionUpdate(function(){var E=y.getID();var G=w.getID();var H=y.getRelationID();var F=!Boolean(H);x.instantiate(B);var D={transactions:[]};if(F||z==="COPY"){D.transactions.push({insertExisting:{modified:[G],inserted:[E],created:[C],withContext:!F}})}x._commandProxy.padRefresh(D)},x)});t.displayNotification({msg:"Reorder/Reparent done",eventID:"success"});x._endBlockingTransaction()}catch(A){x._endBlockingTransaction();t.displayNotification({msg:p.generic_service_failure,eventID:"error"})}},onNodeModelUpdateRequirement:function(A){if(!A||UWA.is(A,"function")){return}var y=A.data.nodeModel;var D=y._lastUpdateTime?y._lastUpdateTime:0;var I=Date.now()-D;y._lastUpdateTime=Date.now();console.log("lastUpdateTime : "+D+", elapsedTime : "+I);if(D!==0&&I<300){return}if(y._resetting){return}var B=y.getID();var v=y.options.label;var H=y.options.oldLabel;var C=y.options.req_label;if(y.options.reqKindOf==="PlmParameter"){return;F=H;G=v}else{var F=c.computeDisplayName({name:y.options.req_name,title:C,revision:y.options.grid["ds6wg:revision"]},widget.displayNameSettings[y.options.reqKindOf]);var G=c.computeDisplayName({name:y.options.req_name,title:v,revision:y.options.grid["ds6wg:revision"]},widget.displayNameSettings[y.options.reqKindOf])}if(H===undefined){H=""}if(G===F||F===v){if(F!=v){y.withTransactionUpdate(function(){this.setLabel(H)})}return}if(v&&v.trim){v=v.trim()}var w=true;if(v.trim().length==0){t.displayNotification({msg:k.msg_error_name_empty,eventID:"error"});w=false}if(!w){y.withTransactionUpdate(function(){this.setLabel(H)})}else{var x=[];x.push({name:"Title",value:v});function E(K){y.options.oldLabel=G;var M={authored:{modified:[B]}};l.setAuthoringState(true,"PADSession_disabling_index_authoring");u.refreshNodeById(M.authored);var J=y.options.req_name;var L=s.RichView_Notif_ObjectSaved;L=L.replace("{TNR}",J);u._commandProxy.refresh(M);t.displayNotification({msg:L,eventID:"success"})}function z(K,J){var L=K.message;J=UWA.is(J,"string")?JSON.parse(J):J;if(UWA.is(J.message)){L=J.message}t.displayNotification({msg:L,eventID:"error"});y._resetting=true;y.withTransactionUpdate(function(){this.setLabel(H)});y._resetting=false}u.setReqAttributes(B,x,E,z)}},setReqAttributes:function(y,w,x,v){b.edit({pid:y,json:{attributes:w},securityContext:c.getSecurityContext(),onComplete:x,onFailure:v})},setAdditionalAttributes:function(y){var v=true,w=false;if(!v){return}var x=this;setTimeout(function(){var E={ids:[]};var z={},D=g.getSetting("authorized_find_in_ctx_types");function C(G,F){var H=false;switch(F){case"boolean":if(G&&G.length&&(G.toUpperCase()==="TRUE"||G.toUpperCase()==="FALSE")){H=true}break}return H}function B(I){var H=I.options.reqKindOf;if(!I.isHidden()&&D.indexOf(H)!==-1){var F=I.getID();if((!C(I.options.grid.isDuplicated,"boolean")||!C(I.options.grid.isLastMinorRevision,"boolean"))&&(E.ids.indexOf(F)<0)){E.ids.push(F)}}var G=I.getChildren();if(G){G.forEach(function(J){B(J)})}}var A=x.getNodesById(y);A.forEach(function(F){B(F)});x._completeNodes(E,w)})},_completeNodes:function(A,x){var z=this;var C=function(E,D){var F=m.parse_attributes(D.attributes,f.getAvailableColumns(),z);if(UWA.is(E.options.externalObject)&&E.options.externalObject){F.icons=E.options.icons}if(UWA.is(z.filterAttributesForUpdate,"function")){F=z.filterAttributesForUpdate({node:E,node_opts:F})}return F};var B=[];if(UWA.is(A.ids)&&UWA.is(A.ids,"array")){B=A.ids}if(B.length===0){return}var v={intent:"explore_2D",debug:g.getSetting("enopad_webapis_debug")};var w=function(D,E){n.fetch({pids:D,isParameter:false,authored:l.isUsingIndex()?!l.isUsingIndex:!false,onComplete:function(G){if(UWA.is(E)&&UWA.is(E,"function")){E.call()}var F=UWA.is(G,"string")?JSON.parse(G):G;if(F.results.length===0){throw new Error("Cannot find object with the physicalid "+D)}if(F.results.length!==D.length){return}z.wrapInTransaction(function(){z.withTransactionUpdate(function(){F.results.forEach(function(H){var K="",I=0;for(I=0;I<H.attributes.length;I++){var J=H.attributes[I];if(J.name==="resourceid"||J.name==="physicalid"){K=J.value;break}}if(K===""){throw new Error("Resourceid not found in fetch result for "+JSON.stringify(H))}z.getRoots().forEach(function(N){var M=N.getNodesById(K);M.forEach(function(O){O.updateOptions(C(O,H))})});var L=z.searchRootById(K);if(L){L.updateOptions(C(L,H))}})})});if(A.onComplete!==undefined){A.onComplete()}},onFailure:function(F){t.displayNotification({msg:p.generic_service_failure,eventID:"error"})},},"BOR")};var y=function(D,E){if(D.length-E>0){w(D.slice(E,E+500),function(){y(D,E+501)})}else{return}};if(B.length>500){y(B,0)}else{w(B)}},_buildSelectData:function(){var x=this._parent(),w=this;if(UWA.is(x.attributes)){for(var v in x.attributes){if(x.attributes.hasOwnProperty(v)){x.attributes[v].tenant=w.getTenant()}}}return x},getTenant:function(){var v=require("DS/TraceableRequirementsUtils/Utils");return v.getTenant()}});return d});define("DS/ENOREQComponent/ENOREQComponent",["DS/ENOPAD_v2/PADComponent","DS/PADUtils/PADSession","UWA/Core","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","i18n!DS/ENOREQComponent/assets/nls/ENOREQ.json","DS/ENOREQComponent/ENOREQContextualMenu","DS/RichView/Command/DeleteLinkAction","DS/ENOREQComponent/ENOREQWSAccess","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/UIKIT/Mask","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADTypesMgt","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/ENOREQComponent/utils//_ENOREQKBInput","DS/ENOChgActionCMDs/scripts/CAActionBarController","require","css!DS/ENOREQComponent/ENOREQComponent"],function(e,m,a,f,l,i,o,r,n,d,t,p,k,s,c,j,h,g){m.softInit();var q=e.extend(o,j,{name:"enoreq_container",_defaultTypes:{},defaultOptions:{x3dAppId:"REQ_appId",amd_custo:{TreeDocument:"DS/ENOREQComponent/ENOREQTreeDocument",TreeListView:"DS/ENOREQComponent/ENOREQTreeListView"},layout:{title_update:false}},reqCommandProxy:null,richViewDropIn:false,insert_from_RV:false,_deleteLinkAction:null,__csrf:null,_startLinkCmd:null,_endLinkCmd:null,externalProviders:false,OSLCProviders:undefined,init:function(u){var v=this;this._defineDefaultTypes();if(u.layout&&u.layout.title_update){u.layout.title_update=false}if(widget.id!="enopad_odt_wgd"){try{require(["text!DS/OSLCConsumer/assets/OSLCConfig.json"],function(x){v.OSLCProviders=JSON.parse(x);if(UWA.is(v.OSLCProviders)&&UWA.is(v.OSLCProviders.repositories)&&v.OSLCProviders.repositories.length>0){v.externalProviders=true}})}catch(w){console.log("/OSLCConsumer/assets/OSLCConfig.json file not found")}}require(["DS/TraceableRequirementsUtils/REQCommandProxy"],function(x){v.reqCommandProxy=x.create({events:{onDrop:function(z){if(z.appId!="ENORETV_AP"){if(z.action==="new"){v.author(true)}var y={pids:[z.id],id_to_detach:[]};v.richViewDropIn=true;v.add(y)}},onReorder:function(y){if(y.appId==="ENORETV_AP"){return}v.refreshOnReorder(y)},onDetach:function(z){if(z.appId==="ENORETV_AP"){return}var y=v.options.model.getNodesById(z.path[z.path.length-1])[0];v.author(true);if(y.getID()===z.path[z.path.length-1]){v.refreshOnRemove(z)}},onTraceabilityAuthoring:function(y){v.refreshOnTraceabilityAuthoring(y)},onAttach:function(D,E){if(D.appId==="ENORETV_AP"){return}v.author(true);var B={};var A=v.options.model.getNodesById(D.selection[D.selection.length-1])[0];if(D.mode==="insert"){if(A&&A._expandState!=="expandState"){B[A.getID()]=[{resourceid:D.object.physicalid,relationid:D.object["physicalid[connection]"]}];v.insertNodes(B);setTimeout(function(){var F=v.getSelectedNodes()[0];v.options.views.treelistview.getManager().scrollToNode(F)},3000)}}else{var y=A.getParent();if(y&&y._expandState!=="expandState"){var C=y.getChildren();var z=C.indexOf(A);B[y.getID()]=[{resourceid:D.object.physicalid,relationid:D.object["physicalid[connection]"]}];v.insertNodes(B,z);setTimeout(function(){var F=v.getSelectedNodes()[0];v.options.views.treelistview.getManager().scrollToNode(F)},3000)}}},onReqSelect:function(A,z){if(UWA.is(A.commandId)&&A.commandId==="TVDeleteCommand"){return}if(A.appId==="ENORETV_AP"){v.deleteCommand(A.data);return}var y=v.options.model.getNodesById(A.paths[0][A.paths[0].length-1])[0];if(UWA.is(y)){v.options.model.unselectAll();y.select();setTimeout(function(){var B=v.getSelectedNodes()[0];if(!UWA.is(B)){y.select()}if(B){v.options.views.treelistview.getManager().scrollToNode(B)}},50)}},onPreferenceModification:function(z){if(UWA.is(z)&&UWA.is(z.appId)&&z.appId!==widget.getValue("appId")){var y=z.preferences;if(UWA.is(y)&&y.length>0){y.forEach(function(A){if(widget.hasPreference(A.name)){widget.setValue(A.name,A.value)}else{if(A.name==="req_tenant"){widget.setValue("x3dPlatformId",A.value)}else{if(A.name==="trm_security_ctx"){widget.setValue("pad_security_ctx",A.value)}}}})}}}}})});c.subscribe("DS/PARParameterComponent/PlatformAPI/create",function(y){if(UWA.is(y.physicalid)&&UWA.is(y.relid)){var x={physicalid:y.physicalid,"physicalid[connection]":y.relId}}v.refreshOnInsert(x)});this.setOptions(u);this._parent(this.options);d.getCustomTypes({type:"Requirement",selectables:"type,name,revision,attribute[Title]",onComplete:function(x){var y=UWA.is(x,"string")?JSON.parse(x):x;v.saveCSRF(y.csrf)},onFailure:function(x){v.displayNotification({eventID:"error",msg:x})}});self.widget.addEvent("endEdit",function(){var x=self.widget.getPreferences();v.reqCommandProxy.preferenceModification({preferences:x,appId:widget.getValue("appId"),widgetId:widget.id})});require(["DS/ENOFilterBIUX/NGFServices"],function(x){setTimeout(function(){x.setAppQueryParam({no_type_filter_rel:["XCADBaseDependency"]})},3000)})},destroy:function(){this.reqCommandProxy.destroy();this._parent()},refresh:function(u){var v=this;u=u===undefined?true:u;if(u){this._commandProxy.refreshModel()}require(["DS/PADUtils/PADSettingsMgt"],function(y){if(y.getSetting("refresh")==="basic"){var w=v.options.model.getRoots();if(w.length>0){var z=[];for(var x=0;x<w.length;x++){z.push(w[x].getID())}}if(z&&z.length>0){var A={pids:z};v.empty();setTimeout(function(){v.add(A,null,true)},1000)}}})},add:function(G,F,z){var B=this;var E=document.getElementsByClassName(" fonticon fonticon-info pad_status_span");if(UWA.is(E)&&UWA.is(E.length)&&E.length>0){var D=function(){if(B._padStatusClicked){B._padStatusClicked=false}else{B._padStatusClicked=true}B.elements.padstatus.show()};var C=function(){if(B._padStatusClicked){B.elements.padstatus.show()}else{B.elements.padstatus.hide()}};E[0].addEventListener("click",D);E[0].addEventListener("mouseout",C)}this._commandProxy.addProxyEvents({onSelect:function(K){if(B._padStatusClicked&&UWA.is(E)&&UWA.is(E.length)&&E.length>0){B.elements.padstatus.hide();B.elements.padstatus.show()}if(widget.id!="enopad_odt_wgd"){var J=B.getSelectedNodes();h.clearObjects();h.addAssignee([l.getUser().login]);if(J.length>0){for(var I=0;I<J.length;I++){h.addProposed([J[I].getID()])}}else{h.clearObjects()}}}});var w=G||{};var u=[];switch(G.content){case"idslist":w=G;u=w.pids;break;case"pathslist":for(var x=0;x<G.paths.length;x++){u.push(G.paths[x][0])}break;case"3DXContent":w=b(G);u=w.pids;break;default:if(!w.pids){throw new Error("Not supported content")}else{u=w.pids}}var A=widget.getValue("trm_tv_addednodes");for(var y=0;y<u.length;y++){if(UWA.is(A[u[y]])&&A[u[y]].tenant!=this.getTenant()){return}}if(UWA.is(F,"function")){G.callback=F}if(this.richViewDropIn===false){var H={paths:[w.pids],appId:widget.getValue("appId")};this.reqCommandProxy.drop(H)}else{this.richViewDropIn=false}this.options.model.getModelEvents().subscribe({event:"onReqAdded"},function(I){if(I.data.nb_root===1&&UWA.is(I.data.added_node)&&UWA.is(I.data.added_node.getLabel(),"string")&&I.data.added_node.getLabel()!==""){B.options.widget.setTitle(I.data.added_node.getLabel())}else{if(I.data.nb_root===0){B.options.widget.setTitle("");B.elements.container.nextSibling.show();B.dropInvitContainer.show()}else{B.options.widget.setTitle(I.data.nb_root+i.multi_root_tile)}}});if(u.length>0){this.dropInvitContainer.hide();this.elements.container.nextSibling.hide();t.mask(this.elements.container);this.options.model.add({pids:u,callback:function(){if(UWA.is(w.id_to_detach,"array")&&w.id_to_detach.length>0){w.id_to_detach.forEach(function(J){var I=B.options.model.searchRootById(J);if(UWA.is(I)){B.toggleRoot({context:I})}})}t.unmask(B.elements.container);if(UWA.is(G.callback,"function")){G.callback.call(null)}}})}if(w.broadcast!==false){var v={paths:w.paths,pids:w.pids,pids_hidden:w.id_to_detach};B._commandProxy.drop(v)}},empty:function(u){this._parent(u);this.elements.container.nextSibling.show()},getSelectedElement:function(){var u=this.getSelectedNodes();var v;if(u.length<1){return null}else{if(u.length>1){return null}else{v={physicalid:u[0].getID(),type:u[0].options.type,path:u[0].getOccurencePath(),kindof:this._defaultTypes[u[0].options.type]||u[0].options.type}}}return v},getToAddSelectedElement:function(){var u=this.getSelectedNodes();var v;if(u.length<1){return null}else{if(u.length>1){return null}else{var z=u[0];var x=z.getParent();var B=x.getChildren();var w=B.indexOf(z);var A={},y={id:z.getID(),relId:z.getRelationID()};if(B.length>w+1){A={id:B[w+1].getID(),relId:B[w+1].getRelationID()}}v={physicalid:x.getID(),type:x.options.type,path:u[0].getOccurencePath(),kindof:this._defaultTypes[x.options.type]||x.options.type,nextSibling:A,previousSibling:y,previousNode:w}}}return v},saveCSRF:function(u){this._csrf=u},getCSRF:function(){return this._csrf},getAuthoringContextPID:function(){var x=null;if(l.isAuthoringCtxAvailable()){try{var u=g("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");var v=u.get();x=UWA.is(v)?UWA.is(v.change.id)?v.change.id:null:null}catch(w){console.warn("CfgAuthoringContext throw an error")}}return x},insertNodes:function(w,u,v){this.options.model.insertNodes(w,u,v)},refreshOnTraceabilityAuthoring:function(v){var u=this;if(v.event==="create"){u.options.model.getRoots().forEach(function(A){var x=A.getNodesById(v.data.from.id);var y=A.getNodesById(v.data.to.id);var z=v.data.link_type;var B,w;if(z=="refined"){B="ds6w:refinedInto";w="ds6w:covers"}else{B="ds6w:covers";w="ds6w:refinedInto"}u.options.model.wrapInTransaction(function(){u.options.model.withTransactionUpdate(function(){x.forEach(function(C){if(C.options.grid[B]){var D=parseFloat(C.options.grid[B])+1;C.options.grid[B]=""+D+"";C.updateOptions(C.options.grid)}else{C.options.grid[B]="1";C.updateOptions(C.options.grid)}});y.forEach(function(C){if(C.options.grid[w]){var D=parseFloat(C.options.grid[w])+1;C.options.grid[w]=""+D+"";C.updateOptions(C.options.grid)}else{C.options.grid[w]="1";C.updateOptions(C.options.grid)}})})})})}else{if(v.event==="delete"){u.options.model.getRoots().forEach(function(D){var C=D.getNodesById(v.data.selected_id);var x=[];var y=[];var w=v.data.covered_ids;var B=v.data.refined_ids;for(var z=0;z<w.length;z++){var A=D.getNodesById(w[z]);x=x.concat(A)}for(var z=0;z<B.length;z++){var A=D.getNodesById(B[z]);y=y.concat(A)}u.options.model.wrapInTransaction(function(){u.options.model.withTransactionUpdate(function(){C.forEach(function(E){if(E.options.grid["ds6w:refinedInto"]&&B.length>0){var F=parseFloat(E.options.grid["ds6w:refinedInto"])-B.length;F=(F<=0)?"":F;E.options.grid["ds6w:refinedInto"]=""+F+"";E.updateOptions(E.options.grid)}if(E.options.grid["ds6w:covers"]&&w.length>0){var F=parseFloat(E.options.grid["ds6w:covers"])-w.length;F=(F<=0)?"":F;E.options.grid["ds6w:covers"]=""+F+"";E.updateOptions(E.options.grid)}});x.forEach(function(E){if(E.options.grid["ds6w:covers"]){var F=parseFloat(E.options.grid["ds6w:covers"])-1;F=(F<=0)?"":F;E.options.grid["ds6w:covers"]=""+F+"";E.updateOptions(E.options.grid)}});y.forEach(function(E){if(E.options.grid["ds6w:refinedInto"]){var F=parseFloat(E.options.grid["ds6w:refinedInto"])-1;F=(F<=0)?"":F;E.options.grid["ds6w:refinedInto"]=""+F+"";E.updateOptions(E.options.grid)}})})})})}}},refreshOnInsert:function(H){this.author(true);var C=this;var y=this.getSelectedNodes();var D=y[0].getID();var z=UWA.is(H,"string")?JSON.parse(H):H;var x=z.physicalid;var F=z["physicalid[connection]"];var E=z["attribute[TreeOrder]"];this.author(true);var G={};G[D]=[{resourceid:x,relationid:F}];this.insertNodes(G,null,E);var B=y[0].getOccurencePath();B.push(z["physicalid[connection]"]);B.push(z.physicalid);var w="insert";if(arguments.length>=3&&arguments[2]==="insertExisting"){w="insertExisting"}var v={appId:widget.getValue("appId"),object:z,path:B,selection:y[0].getOccurencePath(),mode:w};if(z["type.kindof"]==="DOCUMENTS"){var u={paths:[[x]],appId:widget.getValue("appId")};this.reqCommandProxy.drop(u)}else{this.reqCommandProxy.attach(v)}var A=this.options.views.treelistview.getManager();setTimeout(function(){try{setTimeout(function(){var M=C.getSelectedNodes()[0];var O=M._computeRowID();var J=A.getRow(O);var N=null;C.getSelectedNodes()[0];for(var L=0;L<J.length;L++){var K=J[L];if(K._view&&"tree"===(K._view.getCellInfos()).dataIndex){N=K.getView();break}}if(null!==N){N.switchToWriteView()}})}catch(I){}},1000)},refreshOnInsertSibling:function(I,D,E){this.author(true);var A=this;var x=this.getSelectedNodes();var B=x[0].getParent().getID();var y=UWA.is(I,"string")?JSON.parse(I):I;var w=y.physicalid;var G=y["physicalid[connection]"];var C=y["attribute[TreeOrder]"];this.author(true);var H={};H[B]=[{resourceid:w,relationid:G}];this.insertNodes(H,E,C);var F=x[0].getOccurencePath();var J=x[0].getParent().getOccurencePath();J.push(y["physicalid[connection]"]);J.push(y.physicalid);var v={appId:widget.getValue("appId"),object:y,selection:F,path:J,mode:"append"};if(y["type.kindof"]==="DOCUMENTS"){var u={paths:[[w]],appId:widget.getValue("appId")};this.reqCommandProxy.drop(u)}else{this.reqCommandProxy.attach(v)}var z=this.options.views.treelistview.getManager();setTimeout(function(){try{setTimeout(function(){var O=A.getSelectedNodes()[0];var Q=O._computeRowID();var L=z.getRow(Q);var P=null;A.getSelectedNodes()[0];for(var N=0;N<L.length;N++){var M=L[N];if(M._view&&"tree"===(M._view.getCellInfos()).dataIndex){P=M.getView();break}}if(null!==P){P.switchToWriteView()}})}catch(K){}},1000)},refreshOnCreate:function(v){var w=this;this.author(true);var x=UWA.is(v,"string")?JSON.parse(v):v;var u=x.physicalid;this.add({pids:[u]});var y=this.options.views.treelistview.getManager();setTimeout(function(){try{setTimeout(function(){var A=w.options.model.getNodesById(u);A.forEach(function(E){var G=E._computeRowID();var B=y.getRow(G);var F=null;for(var D=0;D<B.length;D++){var C=B[D];if(C._view&&"tree"===(C._view.getCellInfos()).dataIndex){F=C.getView();break}}if(null!==F){F.switchToWriteView()}})})}catch(z){}},3500)},refreshOnRemove:function(x){this.author(true);var v=[];var u=[];var w=x.path[x.path.length-2];v.push({physicalid:w});u.push(w);this.refreshView({deleted:v});this.reqCommandProxy.detach({appId:widget.getValue("appId"),path:x.path})},refreshOnReorder:function(x,v){var w=this;var u=parseFloat(x.new_position.treeOrder);this.options.model.getRoots().forEach(function(A){var B=function(E,G){var F=E.getChildren();var D=0;if(F&&F.length>0){while(D<F.length){if(F[D].options.relationOrder>u){if(G.options.resourceid===F[D].options.resourceid){F[D].options.relationOrder=u;F[D].options.relationid=x.new_position.relid;break}else{G.options.relationOrder=u;G.options.relationid=x.new_position.relid;E.insertBefore(G,F[D]);break}}else{if(D==F.length-1){G.options.relationOrder=u;G.options.relationid=x.new_position.relid;E.addChild(G);break}}D++}}else{G.options.relationOrder=u;w.options.model.handleReparent(G,E,x.new_position.relid)}};var C=A.getNodesById(x.new_position.path[x.new_position.path.length-1]);var y=A.getNodesById(x.id);for(var z=0;z<y.length;z++){if(C[z]){B(C[z],y[z])}}})},refreshOnRevise:function(w){this.author(true);var x=this;var y=[];var u=[];w.forEach(function(A){var D={};var C=x.options.model.getNodesById(A.old_object_id)[0].getParent().getID();D[C]=[{resourceid:A.object.physicalid,relationid:A.object["physicalid[connection]"],treeOrder:A.object["attribute[TreeOrder]"]}];x.insertNodes(D);var z=A.old_object_id;y.push({physicalid:z});u.push(z);var B=x.options.model.getNodesById(A.old_object_id)[0].getParent().getOccurencePath();B.push(A.object["physicalid[connection]"]);B.push(A.object.physicalid);x.reqCommandProxy.revise({data:A,newPath:B,selection:x.options.model.getNodesById(A.old_object_id)[0].getParent().getOccurencePath(),path:x.options.model.getNodesById(A.old_object_id)[0].getOccurencePath(),appId:widget.getValue("appId")})});this.refreshView({deleted:y});var v={};v.detach={deleted:u};this._commandProxy.padRefresh(v)},getReqSpecRoot:function(y){var A=y.getOccurencePath();var v=0,z=null;if(y.options.reqKindOf==="Requirement Specification"||y.options.reqKindOf==="Requirement Group"){return A[0]}else{var u=(A.length/2)+0.5;var x=y;while(z==null&&v<u){var w=x.getParent();if(w.options.reqKindOf=="Requirement Specification"){z=w.getID()}else{v++;x=w}}return z}},deleteCommand:function(w){var x=[];var v=this.options.model.getSelectedNodes()[0];if(w==="ds6w:covers"||w==="ds6w:refinedInto"){if(v.options.grid["ds6w:refinedInto"]||v.options.grid["ds6w:covers"]){this.launchDeleteWindow(v)}}var x=[];if(!UWA.is(v)||!UWA.is(v.getOccurencePath())){return}x.push(v.getOccurencePath());var u={paths:x,appId:widget.getValue("appId"),commandId:"TVDeleteCommand"};if(v.options.reqKindOf!="Requirement Group"){this.reqCommandProxy.reqSelect(u,widget.id)}},launchDeleteWindow:function(v){var u=(UWA.is(v.context)?v.context:v);if(!r._initialized){this._deleteLinkAction=r.init({context:this,renderTo:".xnav_component"})}this._deleteLinkAction.execute({physicalid:u.getID(),type:u.options.grid["ds6w:type"],name:u.options.label})},_defineDefaultTypes:function(){var u=function(y){return y.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")};this._defaultTypes={"Requirement Proxy":"Requirement"};var w=f.getSetting("authorized_types");var v=this;var x=["Requirement Specification","Comment","Requirement","Chapter","Requirement Group"];x.forEach(function(y){var A=y.replace(" ","_");var z=widget.getPreference("trm_types_"+A);if(UWA.is(z)){z.options.forEach(function(B){w.push(B.value);w.push(B.value.replace(new RegExp(u(" "),"g"),"_"));v._defaultTypes[B.value]=y})}});f.setSetting("authorized_types",w)},getDefaultType:function(u){var w=u.replace(" ","_");var v=widget.getPreference("trm_types_"+w);if(UWA.is(v)){return widget.getValue("trm_types_"+w)}else{return u}},getTenant:function(){var u=require("DS/TraceableRequirementsUtils/Utils");return u.getTenant()},getSelectedNodes:function(){var v=this._parent(),u=this;if(UWA.is(v)){v.forEach(function(w){w.tenant=u.getTenant()})}return v},_buildENOPADModel:function(){var u=this;if(u.options.layout.keyboard_inputs===true&&!u._keyboardListener){u._keyboardListener=new j({});u._keyboardListener.startObservingKeyboard(this.elements.container)}},onDropCell:function(x,w){var v=this;this.onDragLeaveCell(x);function u(){return ids}k.retrieveAuthorizedObjects({dnd_event:x,callback:function(A){if(w.dropPosition!=="top"&&w.dropPosition!=="bottom"){var z=[];var y=0;if(w.dataIndex==="find_in_ctx"){for(y=0;y<A.authorized_objects.length;y++){z.push([A.authorized_objects[y].objectId])}w.nodeModel.options.partialPreExpand=u;w.nodeModel.expand()}else{if(w.dataIndex==="tree"){v._dropOnTreeColumn({dropped_data:A.authorized_objects,source_data:A.source_data,dropInfos:w})}}}else{if(A.authorized_objects.length===1){if(w.dataIndex==="tree"){v._dropOnCellCompositeOrder({dropped_data:A.authorized_objects,source_data:A.source_data,dropInfos:w})}else{s.displayNotification({msg:p.drop_between_lines,eventID:"warning"})}}else{s.displayNotification({msg:p.multi_reordering,eventID:"warning"})}}}});return false},_dropOnCellCompositeOrder:function(N){var B=this;if(N.dropInfos&&N.dropInfos.nodeModel){var L=this.getPADTreeDocument();var F=N.dropped_data[0].path;if(F&&F.length>0&&UWA.is(F[0],"object")){var C=[];F.forEach(function(Q){C.push(Q.resourceid)});F=C}var J=F?L.getNodeByOccurencePath(F):null;if(N.dropInfos.nodeModel.getOccurencePath().indexOf(J.getID())>=0){return}if(true){var D=N.dropInfos.nodeModel.getParent();var O=B.getReqSpecRoot(D);var K=B.getReqSpecRoot(J);var w=[];if(D&&D.options.resourceid){if(J===N.dropInfos.nodeModel){return}if(!L.checkReorder(J,N.dropInfos.nodeModel.getParent())){this.displayNotification({eventID:"error",msg:i.Transaction_forbidden});return}var H=null,G=true,u,A,P=B.options.model._copyMode;var I=J.getRelationID();if(J._parentNode.options.resourceid){u=J._parentNode.getID();A=J._parentNode.getOccurencePath();H={object:{id:J.getID(),rootId:J._parentNode.getID(),position:{previousSibling:{},nextSibling:{}}},old:{id:J._parentNode.getID(),relid:J.getRelationID()},newParentId:D.getID()}}else{G=false;u=null;A=null;H={id:J.getID(),pid:D.getID(),previousSibling:{},nextSibling:{}}}var z={appId:widget.getValue("appId"),id:J.getID(),old_position:{id:u,relid:J.getRelationID(),path:A},new_position:{id:D.getID(),relid:null,relType:null,path:D.getOccurencePath(),treeOrder:null,position:{previousSibling:{},nextSibling:{}}}};var x=D.getChildren();if(N.dropInfos.dropPosition==="top"){if(G){H.object.position.nextSibling={id:N.dropInfos.nodeModel.getID(),relid:N.dropInfos.nodeModel.getRelationID()}}else{H.nextSibling={id:N.dropInfos.nodeModel.getID(),relId:N.dropInfos.nodeModel.getRelationID()}}var E=x.indexOf(N.dropInfos.nodeModel);if(E!=0){if(G){H.object.position.previousSibling={id:x[E-1].getID(),relid:x[E-1].getRelationID()}}else{H.previousSibling={id:x[E-1].getID(),relId:x[E-1].getRelationID()}}}var v=function(Q){B.author(true);var U=UWA.is(Q,"string")?JSON.parse(Q):Q;U.results=UWA.is(U.results.resultArray)?U.results.resultArray[0]:U.results;J.options.relationid=U.results["physicalid[connection]"];J.options.relationOrder=U.results["attribute[TreeOrder]"];z.new_position.relid=J.options.relationid;z.new_position.treeOrder=U.results["attribute[TreeOrder]"];z.new_position.position.previousSibling=UWA.is(H.object)?H.object.position.previousSibling:H.previousSibling;z.new_position.position.nextSibling=UWA.is(H.object)?H.object.position.nextSibling:H.nextSibling;z.new_position.relType=U.results["type[connection]"];if(UWA.is(O)&&UWA.is(K)){if((O===K)){B.reqCommandProxy.reorder(z)}else{B.reqCommandProxy.detach({appId:widget.getValue("appId"),path:J.getOccurencePath()});var T=D.getOccurencePath();T.push(U.results["physicalid[connection]"]);T.push(J.getID());var S={"attribute[Title]":J.options.req_label,"attribute[TreeOrder]":U.results["attribute[TreeOrder]"],"from.physicalid[connection]":D.getID(),physicalid:J.getID(),"physicalid[connection]":U.results["physicalid[connection]"],"type.kindof":J.options.reqKindOf,"type[connection]":J.options.relationtype,type:{displayName:J.options.grid["ds6w:type"],value:J.options.type},revision:J.options.grid["ds6wg:revision"]};var W="insertExisting";var V=D.getOccurencePath();if(UWA.is(z.new_position.position.previousSibling)&&UWA.is(z.new_position.position.previousSibling.id)){W="appendExisting";V.push(z.new_position.position.previousSibling.relid);V.push(z.new_position.position.previousSibling.id)}else{if(z.new_position.position.nextSibling&&UWA.is(z.new_position.position.nextSibling.id)){W="prependExisting";V.push(z.new_position.position.nextSibling.relid);V.push(z.new_position.position.nextSibling.id)}}var R={appId:widget.getValue("appId"),path:T,object:S,selection:V,mode:W};B.reqCommandProxy.attach(R)}}D.insertBefore(J,N.dropInfos.nodeModel);B.displayNotification({eventID:"success",msg:i.Reparent_done});if(!G&&P!="COPY"){B.options.model.removeRoot(J)}};L.reParent({json:{dataArray:[H]},onComplete:v,onFailure:function(Q){B.displayNotification({eventID:"error",msg:i.Transaction_forbidden})}},G,J.options.type,D.options.type);w[0]=J;w[1]=N.dropInfos.nodeModel}else{if(N.dropInfos.dropPosition==="bottom"){if(G){H.object.position.previousSibling={id:N.dropInfos.nodeModel.getID(),relid:N.dropInfos.nodeModel.getRelationID()}}else{H.previousSibling={id:N.dropInfos.nodeModel.getID(),relId:N.dropInfos.nodeModel.getRelationID()}}var y=x.indexOf(N.dropInfos.nodeModel);if(y<x.length-1){if(G){H.object.position.nextSibling={id:x[y+1].getID(),relid:x[y+1].getRelationID()}}else{H.nextSibling={id:x[y+1].getID(),relId:x[y+1].getRelationID()}}}var M=function(Q){B.author(true);var V=UWA.is(Q,"string")?JSON.parse(Q):Q;V.results=UWA.is(V.results.resultArray)?V.results.resultArray[0]:V.results;J.options.relationid=V.results["physicalid[connection]"];J.options.relationOrder=V.results["attribute[TreeOrder]"];z.new_position.relid=J.options.relationid;z.new_position.relType=V.results["type[connection]"];z.new_position.treeOrder=V.results["attribute[TreeOrder]"];z.new_position.position.previousSibling=UWA.is(H.object)?H.object.position.previousSibling:H.previousSibling;z.new_position.position.nextSibling=UWA.is(H.object)?H.object.position.nextSibling:H.nextSibling;if(UWA.is(O)&&UWA.is(K)){if((O===K)){B.reqCommandProxy.reorder(z)}else{B.reqCommandProxy.detach({appId:widget.getValue("appId"),path:J.getOccurencePath()});var U=D.getOccurencePath();U.push(V.results["physicalid[connection]"]);U.push(J.getID());var S={"attribute[Title]":J.options.req_label,"attribute[TreeOrder]":V.results["attribute[TreeOrder]"],"from.physicalid[connection]":D.getID(),physicalid:J.getID(),"physicalid[connection]":V.results["physicalid[connection]"],"type.kindof":J.options.reqKindOf,"type[connection]":J.options.relationtype,type:{displayName:J.options.grid["ds6w:type"],value:J.options.type},revision:J.options.grid["ds6wg:revision"]};var X="insertExisting";var W=D.getOccurencePath();if(UWA.is(z.new_position.position.previousSibling)&&UWA.is(z.new_position.position.previousSibling.id)){X="appendExisting";W.push(z.new_position.position.previousSibling.relid);W.push(z.new_position.position.previousSibling.id)}else{if(z.new_position.position.nextSibling&&UWA.is(z.new_position.position.nextSibling.id)){X="prependExisting";W.push(z.new_position.position.nextSibling.relid);W.push(z.new_position.position.nextSibling.id)}}var R={appId:widget.getValue("appId"),path:U,object:S,selection:W,mode:X};B.reqCommandProxy.attach(R);setTimeout(function(){B.reqCommandProxy.reorder(z)},1000)}}if(x.indexOf(J)!=-1){D.addChild(J,y)}else{D.addChild(J,y+1)}B.displayNotification({eventID:"success",msg:i.Reparent_done});if(!G&&P!="COPY"){B.options.model.removeRoot(J)}var T=B.options.model.getNodesById(J.getID())[0]};L.reParent({json:{dataArray:[H]},onComplete:M,onFailure:function(Q){B.displayNotification({eventID:"error",msg:i.Transaction_forbidden})}},G,J.options.type,D.options.type);w[0]=N.dropInfos.nodeModel;w[1]=J}else{s.displayNotification({msg:p.drop_between_lines,eventID:"warning"})}}}}}}});function b(A){var z={pids:[]};var x=(A.behavior?A.behavior:"WITH_CONTEXT");var B=[],u=[];for(var w=0;w<A.authorized_objects.length;w++){var y=A.authorized_objects[w];B.push(y.objectId);if(x==="WITH_CONTEXT"){if(!UWA.is(y.path,"array")){x="WITHOUT_CONTEXT"}}if(x==="WITH_CONTEXT"){u.push(y.path.map(function(C){return C.resourceid}))}}if(x==="WITH_CONTEXT"){z.paths=u;for(var v=0;v<z.paths.length;v++){z.pids.push(z.paths[v][0])}}else{z.pids=B}z.broadcast=UWA.is(A.broadcast,"boolean")?A.broadcast:true;return z}return q});