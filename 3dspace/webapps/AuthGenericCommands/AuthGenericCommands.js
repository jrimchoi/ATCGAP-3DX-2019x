/*!  COPYRIGHT DASSAULT SYSTEMES 2016   */
define("DS/AuthGenericCommands/AuthGenericCmdWSAccess",["text!DS/AuthGenericCommands/assets/AuthGenericCommands.json","DS/WAFData/WAFData","DS/WidgetServices/WidgetServices","DS/AuthGenericCommands/AppContext","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext",],function(j,i,l,h,f){var g=JSON.parse(j);function b(m){var n=g.version;return g[m]}function a(o){var p="";if((o!==undefined)&&Array.isArray(o)){var m=o.length/2;for(var n=0;n<m;n++){p+=(n===0)?"?":"&";p+=o[2*n]+"="+o[2*n+1]}}return encodeURI(p)}function e(p,o,m,n){m=m||"";n=n||[];n.push("securityContext");n.push(h.getSetting("securityContext"));l.get3DSpaceUrlAsync({onComplete:function(q){var t="OnPremise";var u=l.getTenantID();if(u&&u.length!=0){t=u}n.push("tenant");n.push(t);var s=a(n);var r=q+o+m+s;return i.authenticatedRequest(r,p)}})}function d(o,m,q){var t=b(m);var s=t.url.replace("[modeler]",o.modeler);var r=UWA.clone(o,false);r.method=t.verb;r.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":h.getSetting("lang"),SecurityContext:h.getSetting("securityContext")};if(typeof r.data==="object"){r.data=JSON.stringify(r.data)}if(q===true){var n=f.get();if(n&&n.AuthoringContextHeader){for(var p in n.AuthoringContextHeader){r.headers[p]=n.AuthoringContextHeader[p]}}}e(r,s,o.optionalURL)}function k(o,n,r,p){var q=UWA.clone(o,false);q.method=r;q.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":h.getSetting("lang"),SecurityContext:h.getSetting("securityContext")};if(typeof q.data==="object"){q.data=JSON.stringify(q.data)}var m="";e(q,n,m,p)}var c={callWS:function(n,m,p,o){return k(n,m,p,o)},unparent:function(m){return d(m,"unparent",true)},insertExisting:function(m){return d(m,"insertExisting",true)},replace:function(m){return d(m,"replace",true)},reorder:function(m){return d(m,"reorder",true)},move3D:function(m){return d(m,"move3D",true)},reparent:function(m){return d(m,"reparent",true)},getTypesHierarchy:function(m){return d(m,"gettypeshierarchy")},MassChunkedRequests:function(A){const v=30;var q=A.chunkSize||v;var r=undefined;var t=undefined;var m=undefined;var u=undefined;var z=undefined;var y=0;var o=0;var p=0;var w=0;var n=false;var x=false;var s=this;this.process=function(){if(y===z){return}if(typeof A.cbOnProcess==="function"){var B=m.slice(o,o+q);A.cbOnProcess(s,B)}};this.reprocess=function(){if(n){return}if(typeof A.cbOnProcess==="function"){var B=m.slice(o,o+q);A.cbOnProcess(s,B)}};this.setAnswer=function(C,D){if(n){return}y++;if(r){u.push({request:C,answer:D})}else{u[C]=D}if(typeof A.cbOnProgress==="function"){var B=y/z;A.cbOnProgress(B)}if(y>p){w++;if(w===t){if(A.cbOnLastChunk&&(typeof A.cbOnLastChunk==="function")){A.cbOnLastChunk()}}o=p+1;p+=q;if(p>=z){p=z-1}if(x){A.cbOnComplete(s,x);n=true}else{this.process()}}if(y>=z&&!n){if(typeof A.cbOnComplete==="function"){A.cbOnComplete(s,x);n=true}}};this.getAnswer=function(F){if(r!==undefined){if(!r){return u[F]}var D=JSON.stringify(F);for(var E=0,C=u.length;E<C;E++){var B=JSON.stringify(u[E].request);if(D===B){return u[E].answer}}}return undefined};this.getAnswers=function(){if(r!==undefined){return u}return undefined};this.getAbortedRequests=function(){if(r!==undefined){return m.slice(o)}return undefined};this.cancel=function(){x=true;if(!n){if(typeof A.cbOnComplete==="function"){A.cbOnComplete(s,x);n=true}}if(A.cbOnCancel&&(typeof A.cbOnCancel==="function")){A.cbOnCancel(s)}};this.abort=function(){if(!n){x=true}};this.start=function(){if(A.requests!==undefined){if(Array.isArray(A.requests)){z=A.requests.length;if(z>0){if(typeof A.requests[0]==="string"){r=false;u={};m=A.requests.filter(function(C,D,B){return(B.indexOf(C)==D)});z=m.length}else{if(typeof A.requests[0]==="object"){r=true;u=[];m=A.requests}}if(r!==undefined){o=0;p=q-1;if(p>=z){p=z-1}this.process();return}}}}if(typeof A.cbOnComplete==="function"){A.cbOnComplete(s,x)}};this.start()},replaceMassOperations:function(n){var o=this;var m=n;m.cbOnProcess=function(q,p){console.log("replaceMassOperations.cbOnProcess: size=",p.length);o.replace({data:{version:n.version,bAllOrNothing:n.bAllOrNothing,operations:p},modeler:n.modeler,onComplete:function(y){y=(typeof y==="string")?JSON.parse(y):y;for(var u=0,s=p.length;u<s;u++){var x=p[u];var w={};if(y.status==="success"){w=y.results[u]}else{var r=y.results[u];if(r===undefined){q.setAnswer(x,{status:"failure"});return}var v=[];if(r.messages!==undefined){var t=r.messages.length-1;v.push(r.messages[t])}w={status:"failure"};if(r.parent){w.parent=r.parent}if(r.oldInstance){w.oldInstance=r.oldInstance}w.messages=v;if(r.oldName){w.oldName=r.oldName}if(r.newName){w.newName=r.newName}}q.setAnswer(x,w)}},onFailure:function(r,s){console.log("replaceMassOperations.onFailure");q.reprocess()}})};return new c.MassChunkedRequests(m)}};return c});define("DS/AuthGenericCommands/AuthGenericRevision",["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],function(d){function c(e){var f=e;f.cbOnProcess=function(n,p){var l=[];p.forEach(function(s){var r={id:s};l.push(r)});var k={};function g(t,s){if(!k[s]){var v=[];var w=function(x){if(x.id===s){v.push(x);return true}};t.some(w);var r=s;var u=function(x){if(x.ancestors&&x.ancestors[0].id===r){v.push(x);r=x.id;return true}};while(t.some(u)){}k[s]=v;return v}return k[s]}function j(t,x,s){var u=undefined;var w=function(y){if(y.id===s){u=s;return true}};t.some(w);if(u!==undefined){return u}var r=x;var v=function(y){if(y.id===r){if(y.ancestors&&y.ancestors[0].id){r=y.ancestors[0].id;return true}else{u=r}}};while(t.some(v)){}return u}function o(y,r){var v=y.length;for(var w=0;w<v;w++){var A=y[w];var t=A.versions;var x=t.length;var z=A.item.vid;for(var u=0;u<x;u++){if(t[u].id===r){z=j(t,r,z);var s=g(t,z);return s}}}}var m={data:{graphRequests:l},onComplete:function(s){var r=(typeof s==="string")?JSON.parse(s):s;if((r.graphs!==undefined)&&(Array.isArray(r.graphs))){p.forEach(function(u){var v=u;var t=o(r.graphs,v);n.setAnswer(v,t)})}},onFailure:function(r,s){console.log("getRevisions.onFailure");n.reprocess()}};var i="POST";var h="/resources/v1/dslc/versiongraph";var q=["withIsLastVersion","1","validIntents","E"];return d.callWS(m,h,i,q)};return new d.MassChunkedRequests(f)}function b(e){var f=e;f.cbOnProcess=function(i,g){var j={data:{data:g},onComplete:function(q){var n=(typeof q==="string")?JSON.parse(q):q;if(n.results!==undefined){for(var o=0,m=n.results.length;o<m;o++){var p=n.results[o];i.setAnswer(p.physicalid,p.data)}}if(n.report!==undefined){for(var o=0,m=n.report.length;o<m;o++){var p=n.report[o];i.setAnswer(p.physicalid,p.errorMessage)}}},onFailure:function(l,m){console.log("getRevisions.onFailure");i.reprocess()}};var h="/resources/lifecycle/revision/families";var k="POST";return d.callWS(j,h,k)};return new d.MassChunkedRequests(f)}var a={getRevisions:function(f,e){if((e!==undefined)&&(e===false)){return b(f)}return c(f)},getCurrentAndLatestRevisionNames:function(h,k){var j="";var l=null;var g=h.length;for(var e=0;e<g;e++){var f=h[e];if(f.id===k){if(f.code!==undefined){j=f.code}else{if(f.revision!==undefined){j=f.revision}}}if((f.isLastVersion!==undefined)&&(f.isLastVersion===true)){l=f.code}}if(l===null){l=h[g-1].revision}return{oldRevision:j,newRevision:l}},getLatestRevisionForReplace:function(j,k){var f=null;var h=j.length;for(var e=0;e<h;e++){var g=j[e];if((g.isLastVersion!==undefined)&&(g.isLastVersion===true)){f=g.id}}if(f===null){f=j[j.length-1].id}if(k===f){return null}return f},getNameOfLatestRevisionForReplace:function(h,j){var g=h.length;for(var e=0;e<g;e++){var f=h[e];if((f.isLastVersion!==undefined)&&(f.isLastVersion===true)){return f.label}}return h[h.length-1].displayName},getLightRevisionsFromWSData:function(f){if(!Array.isArray(f)){return undefined}var g=[];for(var h=0,e=f.length;h<e;h++){var j=f[h];if(typeof j==="object"){if((j.id!==undefined)&&(j.code!==undefined)&&(j.maturity!==undefined)&&(j.maturity_nls!==undefined)&&(j.isLastVersion!==undefined)&&(j.label!==undefined)){g.push({id:j.id,revision:j.code,maturity:j.maturity,maturityNLS:j.maturity_nls,bLastVersion:j.isLastVersion,displayName:j.label})}else{if((j.id!==undefined)&&(j.revision!==undefined)&&(j.currentUntranslated!==undefined)&&(j.current!==undefined)&&(j.displayName!==undefined)){g.push({id:j.id,revision:j.revision,maturity:j.currentUntranslated,maturityNLS:j.current,bLastVersion:(h===e-1),displayName:j.displayName})}}}}if(g.length===0){return undefined}return g},getLightRevisions:function(f){if(typeof f!=="object"){return undefined}if(f.results===undefined){return undefined}if(!Array.isArray(f.results)){return undefined}var g={};var e=f.results.length;for(var h=0;h<e;h++){var j=f.results[h];if((j.physicalid!==undefined)&&Array.isArray(j.data)){g[j.physicalid]=this.getLightRevisionsFromWSData(j.data)}}return g},getLatestCandidateRevisions:function(m){if(typeof m!=="object"){return undefined}var j={};for(var o in m){var k=m[o];if(Array.isArray(k)){var n=this.getLightRevisionsFromWSData(k);var f=o;j[o]={};var g=j[o];var l=this.getLRCurrentRevision(n,f);g.CURRENT=l;var e=this.getLRLatestReleasedRevision(n,f);if(e!==undefined){if(e.indexIn!==e.indexOut){g.RELEASED=e}}var i=this.getLRLatestStableRevision(n,f);if(i!==undefined){if(i.indexIn!==i.indexOut){g.STABLE=i}}var h=this.getLRLatestRevision(n,f);if(h!==undefined){if(h.indexIn!==h.indexOut){g.LATEST=h}}}}return j},getLRRevisionIndex:function(h,g){for(var f=0,e=h.length;f<e;f++){if(h[f].id===g){return f}}return -1},getLRCurrentRevision:function(k,j){var h=this.getLRRevisionIndex(k,j);var g=k.length;for(var e=g-1;e>=0;e--){var f=k[e];if(f.id===j){return{id:f.id,revision:f.revision,maturityNLS:f.maturityNLS,indexIn:h,indexOut:e,maturity:f.maturity,displayName:f.displayName}}}},getLRLatestReleasedRevision:function(k,j){var h=this.getLRRevisionIndex(k,j);var g=k.length;for(var e=g-1;e>=0;e--){var f=k[e];if(f.maturity==="RELEASED"){return{id:f.id,revision:f.revision,maturityNLS:f.maturityNLS,indexIn:h,indexOut:e,displayName:f.displayName}}}return undefined},isLRLatestReleasedRevision:function(g,f){var e=this.getLRLatestReleasedRevision(g,f);if(e===undefined){return false}return(e.indexIn===e.indexOut)},getLRLatestStableRevision:function(k,j){var h=this.getLRRevisionIndex(k,j);var g=k.length;for(var e=g-1;e>=0;e--){var f=k[e];if((f.maturity==="FROZEN")||(f.maturity==="RELEASED")){return{id:f.id,revision:f.revision,maturityNLS:f.maturityNLS,indexIn:h,indexOut:e,displayName:f.displayName}}}return undefined},isLRLatestStableRevision:function(g,f){var e=this.getLRLatestStableRevision(g,f);if(e===undefined){return false}return(e.indexIn===e.indexOut)},getLRLatestRevisionIndex:function(j){var e=-1;var h=j.length;for(var f=0;f<h;f++){var g=j[f];if(g.bLastVersion===true){e=f}}return e},getLRLatestRevision:function(i,h){var g=this.getLRRevisionIndex(i,h);var e=this.getLRLatestRevisionIndex(i);var f=i[e];return{id:f.id,revision:f.revision,maturityNLS:f.maturityNLS,indexIn:g,indexOut:e,displayName:f.displayName}},isLRLatestRevision:function(g,f){var e=this.getLRLatestRevision(g,f);if(e===undefined){return false}return(e.indexIn===e.indexOut)},getLRExpectedRevision:function(g,f,e){switch(e){case"LatestReleased":return this.getLRLatestReleasedRevision(g,f);case"LatestStable":return this.getLRLatestStableRevision(g,f);case"Latest":return this.getLRLatestRevision(g,f)}return undefined},isLRExpectedRevision:function(g,f,e){switch(e){case"LatestReleased":return this.isLRLatestReleasedRevision(g,f);case"LatestStable":return this.isLRLatestStableRevision(g,f);case"Latest":return this.isLRLatestRevision(g,f)}return false}};return a});define("DS/AuthGenericCommands/views/AuthSearchView",["css!DS/AuthGenericCommands/AuthGenericCommands","UWA/Core","UWA/Class/View","UWA/Drivers/Alone","DS/Logger/Logger","DS/PADUtils/PADCommandProxy","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/Handlebars/Handlebars","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADContext","UWA/Event"],function(g,m,a,n,e,b,f,d,i,c,k,p){var l='<div class="vpe_left_ctn_search ctn_search"></div>  <div class="vpe_input_ctn_search ctn_search search_css_temp">  <div class="input_search_div" id="input_search_div">  <input class="input_search" id="input_search_input" type="text" placeholder="Search" ondrop="event.preventDefault ? event.preventDefault() : event.returnValue = false">  </div>  <div class="right_search">  <div class="vpe_clear_ctn_search ctn_search"><div class="clear_btn_search" style="display:none;"></div></div>  <div class="vpe_nav_ctn_search ctn_search"><span class="fonticon fonticon-check fonticon-1x"  style="opacity:0;"></span></div>  <div class="vpe_run_ctn_search ctn_search"><div class="vpe_run_btn_search"  style="opacity:0.1;"></div></div>  <div class="vpe_right_ctn_search ctn_search"></div>  </div>  </div>';var h='<div class="vpe_left_ctn_search ctn_search"></div>  <div class="vpe_input_ctn_search ctn_search search_css_temp">  <div class="input_search_div with_nav" id="input_search_div">  <input class="input_search" id="input_search_input" type="text" placeholder="Search" ondrop="event.preventDefault ? event.preventDefault() : event.returnValue = false">  </div>  <div class="pad_count_ctn" id="pad_count_ctn"><div class="pad_count" id="pad_count"></div></div>  <div class="right_search">  <div class="vpe_nav_ctn_search ctn_search"><span class="fonticon fonticon-up-open ctn_search pad_nav"  style="display:none;" title="Previous"></span></div>  <div class="vpe_nav_ctn_search ctn_search"><span class="fonticon fonticon-down-open ctn_search pad_nav"  style="display:none;" title="Next"></span></div>  <div class="vpe_clear_ctn_search ctn_search"><div class="clear_btn_search" style="display:none;"></div></div>  <div class="vpe_run_ctn_search ctn_search"><div class="vpe_run_btn_search" style="opacity:0.1;"></div></div>  <div class="vpe_right_ctn_search ctn_search"></div>  </div>  </div>';function j(v,s,r){var q,u,t;if(!m.is(v,"object")){return v}t=Object.keys(v);for(q=0,u=t.length;q<u;q++){s.call(r,v[t[q]],t[q],v)}return v}var o=a.extend({name:"AuthSearchView",_searchTriggered:false,className:"vpe_global_ctn_search",_selected_paths:[],_insertReplaceNode:null,_insertParams:null,_insertFlag:null,_insertSelected:null,input_text:null,domEvents:{"click div.vpe_run_ctn_search":"_onSearch","click span.fonticon-check":"_onConfirmSelect","click div.vpe_clear_ctn_search":"_onClearSearch","click span.fonticon-up-open":"_onPrevious","click span.fonticon-down-open":"_onNext","keyup input.input_search":"_onSearchInputKeyUp","paste input.input_search":"_onSearchInputPaste","keydown input.input_search":"_onSearchInputKeyDown"},template:null,_logger:null,setup:function(q){var r=this;if(undefined!==k.get().getPADTreeDocument||k.get().name==="ENOPAD3DViewer"){r._insertFlag=true}this._logger=e.getLogger(o);this._logger.log("setup");if(q.navigate_onresult===true){this.template=d.compile(h)}else{this.template=d.compile(l)}this._searchTriggered=false;this._parent(q);this._commandProxy=b.create({events:{onSelect:function(t){function s(){r.$clearSearchButton.style.display="inline-block";r.$searchInput.value=r._insertParams["ds6w:label"];r.input_text=r.$searchInput.value;if(r.$searchButton){r.$searchButton.style.opacity=1}if(r.$checkButton){r.$checkButton.style.opacity=1}if(undefined!==k.get().getPADTreeDocument||k.get().name==="ENOPAD3DViewer"){r._insertSelected=true}}if((undefined!==k.get().getPADTreeDocument&&r._insertFlag&&k.get().getPADTreeDocument().options.insert_replace===true)||(k.get().name==="ENOPAD3DViewer"&&r._insertFlag)){if(t.paths[0]){var v=t.paths[0];var w=v[v.length-1];var u=[];u.push({type:t.attributes[w].type});c.isTypesAuthorized(u,function(x){if(x.length>0){r._selected_paths=t.paths[0];r._insertReplaceNode=r._selected_paths[r._selected_paths.length-1];r._insertParams={"ds6w:type":t.attributes[r._insertReplaceNode].type,"ds6w:label":t.attributes[r._insertReplaceNode].label};if(!UWA.is(r._insertParams["ds6w:label"])){require(["DS/PADUtils/PADWSAccess"],function(z){r._insertParams["ds6w:label"]=f.PADProgressBar_loading;s();var y=i.getWebAPI_Options("fetch");z.fetch({enopad_webapis:i.getSetting("enopad_webapis"),data:y,pids:[r._selected_paths[r._selected_paths.length-1]],onComplete:function(E){var C=UWA.is(E,"string")?JSON.parse(E):E;if(!C.results||C.results.length!==1){r._insertParams["ds6w:label"]=null;s()}else{var F=C.results[0],B=null,A,D=F.attributes.length;for(A=0;A<D&&!B;A++){if(F.attributes[A].name==="ds6w:label"){B=F.attributes[A].value}}r._insertParams["ds6w:label"]=B;s()}},onFailure:function(){r._insertParams["ds6w:label"]=null;s()}})})}else{s()}}})}}}}})},render:function(){this._logger.log("render");var q=this.template();this.container.setContent(q);j({searchInput:"input.input_search",searchButton:"div.vpe_run_btn_search",checkButton:"span.fonticon-check",searchOptionButton:".option_ctn_search",clearSearchButton:"div.clear_btn_search",onprevious:"span.fonticon-up-open",onnext:"span.fonticon-down-open",padcount:"div.pad_count"},function(r,s){this["$"+s]=this.getElement(r)},this);if(this.$onprevious){this.$onprevious.title=f.PADSearchView_previous}if(this.$onnext){this.$onnext.title=f.PADSearchView_next}if(this.$clearSearchButton){this.$clearSearchButton.title=f.PADSearchView_clear}if(this.$searchButton){this.$searchButton.title=f.PADSearchView_search}if(this.$checkButton){this.$checkButton.title=f.PADSearchView_check}if(undefined!==k.get().getPADTreeDocument&&k.get().getPADTreeDocument().options.insert_replace===true){this.$searchInput.placeholder=f.PADSearchView_search_select;this.$searchInput.title=f.PADSearchView_search_select}else{this.$searchInput.placeholder=f.PADSearchView_search;this.$searchInput.title=f.PADSearchView_search}setTimeout((function(){this.$searchInput.focus()}).bind(this),500);return this},setCount:function(q){this.$padcount.setContent(q.index+"/"+q.total);if(this.$onprevious!==null&&this.$onnext!==null){this.$onprevious.setStyle("display","inline-block");this.$onnext.setStyle("display","inline-block")}},_onConfirmSelect:function(){var q=this;if((undefined!==k.get().getPADTreeDocument&&q._insertSelected===true)||(k.get().name==="ENOPAD3DViewer"&&q._insertSelected===true)){if(UWA.is(this.options.callbacks.onSearch,"function")){this.options.callbacks.onSearch.call(null,[{search_value:this.$searchInput.value,resourceid:q._insertReplaceNode,"ds6w:type":q._insertParams["ds6w:type"],"ds6w:type_value":q._insertParams["ds6w:type"],"ds6w:label":q._insertParams["ds6w:label"]}],this._insertSelected)}if(undefined!==k.get().getPADTreeDocument||k.get().name==="ENOPAD3DViewer"){q._insertSelected=false;q._insertFlag=false}}},_onSearch:function(){var q=this;if(undefined!==k.get().getPADTreeDocument||k.get().name==="ENOPAD3DViewer"){q._insertSelected=false}this._logger.log("_onSearch");this.$searchInput.blur();if(UWA.is(this.options.callbacks.onSearch,"function")){this.options.callbacks.onSearch.call(null,{search_value:this.$searchInput.value},this._insertSelected)}if(undefined!==k.get().getPADTreeDocument||k.get().name==="ENOPAD3DViewer"){q._insertFlag=false}},_onClearSearch:function(){this._logger.log("_onClearSearch");this.$searchInput.value="";this.$clearSearchButton.hide();if(this.$checkButton){this.$checkButton.setStyle("opacity","0")}this.$searchButton.setStyle("opacity","0.1");this._searchTriggered=false;if(this.$onprevious!==null&&this.$onnext!==null&&this.$padcount!==null){this.$onprevious.hide();this.$onnext.hide();this.$padcount.setContent("")}if(UWA.is(this.options.callbacks.onClear,"function")){this.options.callbacks.onClear.call(null)}},_onSearchInputKeyUp:function(){var q=this;if(this.$searchInput.value){this.$searchButton.setStyle("opacity","1");this.$clearSearchButton.setStyle("display","inline-block");if(this.$onprevious!==null&&this.$onnext!==null&&this._searchTriggered===true){this.$onprevious.setStyle("display","inline-block");this.$onnext.setStyle("display","inline-block")}}else{this.$clearSearchButton.hide();if(this.$onprevious!==null&&this.$onnext!==null&&this.$padcount!==null){this.$onprevious.hide();this.$onnext.hide();this.$padcount.setContent("")}this.$searchButton.setStyle("opacity","0.1")}if(this.$checkButton){if(this.input_text!==this.$searchInput.value){if(undefined!==k.get().getPADTreeDocument||k.get().name==="ENOPAD3DViewer"){q._insertSelected=false}this.$checkButton.setStyle("opacity","0.2")}}},_onSearchInputPaste:function(){var q=this;setTimeout(function(){q._onSearchInputKeyUp()},200)},_onPrevious:function(){if(UWA.is(this.options.callbacks.onPrevious,"function")){this.options.callbacks.onPrevious.call(null)}},_onNext:function(){if(UWA.is(this.options.callbacks.onNext,"function")){this.options.callbacks.onNext.call(null)}},_onSearchInputKeyDown:function(q){var r=this;if(p.whichKey(q)==="return"||q.keyIdentifier==="Enter"||q.keyIdentifier==="return"){if((undefined!==k.get().getPADTreeDocument&&this._insertSelected===true)||(k.get().name==="ENOPAD3DViewer"&&this._insertSelected===true)){if(UWA.is(this.options.callbacks.onSearch,"function")){this.options.callbacks.onSearch.call(null,[{search_value:this.$searchInput.value,resourceid:r._insertReplaceNode,"ds6w:type":r._insertParams["ds6w:type"],"ds6w:type_value":r._insertParams["ds6w:type"],"ds6w:label":r._insertParams["ds6w:label"]}],this._insertSelected)}if(undefined!==k.get().getPADTreeDocument||k.get().name==="ENOPAD3DViewer"){r._insertSelected=false;r._insertFlag=false}}else{this._onSearch()}}p.stopPropagation(q)}});return o});define("DS/AuthGenericCommands/views/AuthGenericReportPanel",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Controls/Tab","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericReportPanel.json"],function(f,b,a,e,d){var c=b.extend(a,{name:"GenericReportPanel",_logger:null,_panel:null,options:{},init:function(g){this._parent(g);var h=this;require(["DS/Logger/Logger"],function(i){if(!g.renderTo){g.renderTo=document.body}h._logger=i.getLogger(c);h.setOptions(g);h._createPanel(g)})},_fillTab:function(r,o,p,j){var n="<ul>";for(var m=0,h=o.length;m<h;m++){n+="<li>"+o[m]+"</li>"}n+="</ul>";var q=new f.Element("div",{html:n});var g=new f.Element("div");g.style.padding="2px";g.appendChild(q);var k={label:r+" ("+o.length+")",isSelected:j===p,content:g,index:p};return k},_createTab:function(i,h){var j=this;var g=0;if(i.success.length>0){i.tab.add(j._fillTab(d.success,i.success,g,i.selectedIndex));g++}if(i.failure.length>0){i.tab.add(j._fillTab(d.failure,i.failure,g,i.selectedIndex));g++}if(i.neutral.length>0){i.tab.add(j._fillTab(d.neutral,i.neutral,g,i.selectedIndex));g++}if(i.aborted.length>0){i.tab.add(j._fillTab(d.aborted,i.aborted,g,i.selectedIndex));g++}i.tab.inject(h)},_createPanel:function(g){var h=this;require(["DS/Windows/Panel","DS/Windows/ImmersiveFrame"],function(o,n){var k=new f.Element("div",{styles:{"vertical-align":"top","min-height":"286px",position:"relative"}});var j=new f.Element("div",{"class":"wux-control-inline-container"});k.inject(j);var p=new n();p.inject(h.options.renderTo);var l=new f.Element("div",{"class":"wux-control-container"});var i=new e({displayStyle:"panel"});i.reorderFlag=false;i.pinFlag=true;i.showComboBoxFlag=false;i.editableFlag=false;i.multiSelFlag=true;i.centeredFlag=false;i.touchMode=true;var m={tab:i,selectedIndex:0};if((g.success!==undefined)&&(g.success!==null)&&Array.isArray(g.success)){m.success=g.success}if((g.failure!==undefined)&&(g.failure!==null)&&Array.isArray(g.failure)){m.failure=g.failure}if((g.neutral!==undefined)&&(g.neutral!==null)&&Array.isArray(g.neutral)){m.neutral=g.neutral}if((g.aborted!==undefined)&&(g.aborted!==null)&&Array.isArray(g.aborted)){m.aborted=g.aborted}h._createTab(m,l);h._panel=new o({title:g.title,content:l,position:{my:"center",at:"center"},width:600,allowedDockAreas:0,immersiveFrame:p,resizableFlag:true,collapsibleFlag:false,minWidth:600,minHeight:85});if(m.success.length>15||g.failure.length>15||g.neutral.length>15||g.aborted.length>15){h._panel.height=400}h._panel.elements.container.classList.add("AuthGenericReportPanel_Panel")})}});return c});define("DS/AuthGenericCommands/views/AuthGenericDlgConfirm",["UWA/Controls/Abstract","UWA/Class/Events","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],function(f,b,a,e,d){var c=f.extend(b,{init:function(g){var j=this;this.className="AuthGenericDlgConfirm_modal";this.options=g;j.confirmModal=new a({className:this.className,closable:true,okButtonText:g.action,animate:true,renderTo:g.renderTo});var h=g.callback;var i=function(l){if(l){var m=j.displayToggle.isChecked();localStorage.setItem(g.className+".displayConfirmMsg",!m)}h(l)};g.callback=i;j.confirmModal.confirm(g);this.displayToggle=new e({type:"checkbox",label:d.displayAgain,checked:false});var k=document.querySelector("."+this.className+" .modal-footer");this.displayToggle.inject(k)}});return c});define("DS/AuthGenericCommands/views/AuthGenericDlgProgressbar",["UWA/Core","UWA/Class","UWA/Class/Options"],function(d,b,a){var c=b.extend(a,{options:{},init:function(e){this._parent(e);var f=this;f.setOptions(e);if(!e.renderTo){e.renderTo=document.body}f._createPanel()},_createPanel:function(){var e=this;require(["DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Controls/ProgressBar"],function(h,j,g,i){var k=new j();k.inject(document.body);var f=new d.Element("div",{"class":"wux-control-inline-container",styles:{width:"100%",height:"100%",position:"relative"}});e._dialog=new h({immersiveFrame:k,title:e.options.label.progressBarMainTitle,className:"progressBar_dialog",content:f,movableFlag:false,width:500,height:100,modalFlag:true,closeButtonFlag:false,buttons:{Abort:new g({label:e.options.label.modalFooterAbort,onClick:e._onAbort.bind(e)})}});e.progressBar=new i({value:0,visibleflag:true,statusflag:true,emphasize:"success"}).inject(f)})},_onAbort:function(){var e=this;require(["DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button"],function(g,h,f){var i=new h();i.inject(document.body);e._alert=new g({title:e.options.label.progressBarAlertTitle,content:e.options.label.progressBarAbortAlert,immersiveFrame:i,modalFlag:true,buttons:{Cancel:new f({onClick:function(l){var j=l.dsModel;var k=j.dialog;k.close()}}),Ok:new f({onClick:function(l){var j=l.dsModel;var k=j.dialog;k.close();e.options.events.onAbort();e.disableAbort()}})}})})},destroy:function(){if(this._alert&&this._alert.activeFlag){this._alert.close()}this._dialog.close()},disableAbort:function(){if(this._alert&&this._alert.activeFlag){this._alert.close()}this._dialog.buttons.Abort.disabled=true}});return c});define("DS/AuthGenericCommands/views/AuthGenericDlgReorder",["UWA/Core","UWA/Class","UWA/Class/Options","DS/WebappsUtils/WebappsUtils","css!DS/AuthGenericCommands/AuthGenericCommands.css","DS/Core/PointerEvents"],function(g,b,a,e,d,c){var f=b.extend(a,{name:"UPSDlgReorder",_logger:null,_dialog:null,options:{},_treeListView:null,_manualButtons:[],_initialList:[],init:function(h){this._parent(h);var i=this;if(sessionStorage.UPSDlgReorderDnDIsHeader){delete sessionStorage.UPSDlgReorderDnDIsHeader}if(sessionStorage.UPSDlgReorderDnDIsCell){delete sessionStorage.UPSDlgReorderDnDIsCell}require(["DS/Logger/Logger"],function(j){i._logger=j.getLogger(f);i._manualButtons=[];i._initialList=[];i.setOptions(h);if(!h.renderTo){h.renderTo=document.body}var n=h.children.length;var l=new Array(n);for(var m=0;m<n;m++){var o=h.children[m];l[m]={label:o.options.label,created:new Date(o.options.grid["ds6w:created"]),modified:new Date(o.options.grid["ds6w:modified"]),responsible:o.options.grid["ds6w:responsible"],relationid:o.getRelationID(),physicalid:o.getID()}}var k=l;i._createPanel(k,h)})},_createPanel:function(i,h){var j=this;require(["i18n!DS/AuthGenericCommands/assets/nls/AuthDlgReorder.json","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Controls/TooltipModel","DS/UIKIT/Alert","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],function(l,r,v,o,t,n,q){var s=new v();s.inject(document.body);var u=g.createElement("div",{"class":"reorder-dialog-body",styles:{width:"100%",height:"100%",position:"relative"}});var w=l.modalHeader;j._dialog=new r({immersiveFrame:s,title:w,className:"reorder_dialog",content:u,resizableFlag:true,allowMaximizeFlag:true,maximizeButtonFlag:true,movableFlag:true,width:1000,minWidth:500,minHeight:300,height:500,position:{at:"top left",my:"top left",offsetX:50,offsetY:50},modalFlag:true,touchMode:true,buttons:{Reset:new o({label:l.modalFooterReset,onClick:j._onReset.bind(j)}),Ok:new o({label:l.modalFooterOK,disabled:true,onClick:function(z){j.options.onReorderDone(j._treeListView.getDocument().getRoots());var x=z.dsModel;var y=x.dialog;y.hide()}}),Cancel:new o({label:l.modalFooterCancel,onClick:function(z){var x=z.dsModel;var y=x.dialog;y.hide()}})}});j._dialog.buttons.Reset.elements.container.classList.add("reorder-btn-reset-tree-order");j._dialog.elements.container.classList.add("AuthDLgReorder_Dialog");j._dialog.elements.container.addEventListener("click",function(x){x.preventDefault();x.stopPropagation();return false});var m=new g.Element("div",{"class":"wux-control-inline-container",styles:{width:"100%",height:"100%",position:"relative"}}).inject(u);var k=new g.Element("div",{"class":"reorder-manual-listview-container",styles:{width:"calc(100% - 83.77px)",height:"calc(100% - 10px)",position:"relative",display:"inline-block"}}).inject(m);var p=new g.Element("div",{"class":"reorder-manual-updown-container",styles:{display:"inline-block","vertical-align":"top","margin-left":"25.88px","margin-top":"25.88px"}}).inject(m);j.reorderUp=new o({icon:e.getWebappsAssetUrl("AuthGenericCommands","icons/22/I_UpArrowReorder.png"),touchMode:true,onClick:j._onReorderUp.bind(j)}).inject(p);j.reorderDown=new o({icon:e.getWebappsAssetUrl("AuthGenericCommands","icons/22/I_DownArrowReorder.png"),touchMode:true,onClick:j._onReorderDown.bind(j)}).inject(p);j.reorderFree=new o({icon:e.getWebappsAssetUrl("AuthGenericCommands","icons/22/I_DesFlipSelection_34.png"),touchMode:true,onClick:j._onReorderFree.bind(j)}).inject(p);j.reorderUp.tooltipInfos=new t({shortHelp:l.upArrow});j.reorderDown.tooltipInfos=new t({shortHelp:l.downArrow});j.reorderFree.tooltipInfos=new t({shortHelp:l.freeArrow});j.reorderUp.elements.container.addClassName("reorder-manual-button-up-arrow");j.reorderDown.elements.container.addClassName("reorder-manual-button-down-arrow");j.reorderFree.elements.container.addClassName("reorder-manual-button-free");j._manualButtons.push(j.reorderUp);j._manualButtons.push(j.reorderDown);j._manualButtons.push(j.reorderFree);j._createTreeListView(k,i)})},_createTreeListView:function(h,i){var j=this;require(["i18n!DS/AuthGenericCommands/assets/nls/AuthDlgReorder.json","DS/Tree/TreeListView","DS/Tree/TreeDocument"],function(p,n,l){var m={apiVersion:2,defaultCellHeight:20,height:"auto",resize:{columns:true,rows:true},selection:{nodes:true,cells:false,rowHeaders:false,columnHeaders:false,unselectAllOnEmptyArea:true,toggle:false,canMultiSelect:true},enableScrollOnDrag:true,columns:[{text:p.TreeListViewHeaderName,dataIndex:"tree",width:"40%",isSortable:true},{text:p.TreeListViewHeaderResponsible,dataIndex:"responsible",width:"18%",isSortable:true},{text:p.TreeListViewHeaderCreationDate,dataIndex:"createdDate",width:"20%",typeRepresentation:"datetime",isSortable:true,isEditable:false},{text:p.TreeListViewHeaderModifiedDate,dataIndex:"lastModifiedDate",width:"20%",typeRepresentation:"datetime",isSortable:true,isEditable:false}]};m.onDragStartCell=function(r,t){if(this.reorderFreeRunning===true){return}var q=[];var s=[];t.manager.getDocument().getXSO().get().forEach(function(u){q.push(u.dump());s.push(u._getID())});this.serializeDragAndDropEvent(r,{data:{"dswebux/x-tree.treenodemodel+json":q,"dswebux/x-tree.treenodemodel+number":t.nodeModel._getID(),"dspsd/x-tree.dlgreorderproduct+number":s}});r.dataTransfer.effectAllowed="move";if(sessionStorage.UPSDlgReorderDnDIsHeader){delete sessionStorage.UPSDlgReorderDnDIsHeader}sessionStorage.UPSDlgReorderDnDIsCell="true";j.DragFromThisPanel=true};m.onDragStartColumnHeader=function(){sessionStorage.UPSDlgReorderDnDIsHeader=true;if(sessionStorage.UPSDlgReorderDnDIsCell){delete sessionStorage.UPSDlgReorderDnDIsCell}return true};m.onDragEnterCell=function(q){if(sessionStorage.UPSDlgReorderDnDIsCell!==undefined&&sessionStorage.UPSDlgReorderDnDIsCell==="true"){return true}else{q.dataTransfer.dropEffect="none";return false}};m.onDragOverCell=m.onDragEnterCell;m.onDragEnterBlank=m.onDragEnterCell;m.onDragOverBlank=m.onDragEnterCell;m.onDragEndCell=function(){delete j.DragFromThisPanel;delete sessionStorage.UPSDlgReorderDnDIsHeader;delete sessionStorage.UPSDlgReorderDnDIsCell};m.onDragEnterColumnHeader=function(q){if(sessionStorage.UPSDlgReorderDnDIsHeader!==undefined&&sessionStorage.UPSDlgReorderDnDIsHeader==="true"){return true}else{q.dataTransfer.dropEffect="none";return false}};m.onDragOverColumnHeader=m.onDragEnterColumnHeader;m.onDropCell=function(x,C){if(sessionStorage.UPSDlgReorderDnDIsCell===undefined||(sessionStorage.UPSDlgReorderDnDIsHeader!==undefined&&sessionStorage.UPSDlgReorderDnDIsHeader==="true")||j.DragFromThisPanel!==true){return false}var q=j._treeListView.getDocument().getSelectedNodes();var s=this.unserializeDragAndDropEvent(x);if(s){var w=C.nodeModel._getID();var y=s.data["dswebux/x-tree.treenodemodel+number"];var z=s.data["dspsd/x-tree.dlgreorderproduct+number"];var t=false;z.forEach(function(D){if(D===w){t=true}});if(w===y||t){return false}if(C.dropPosition==="middle"){C.dropPosition="bottom"}}j._treeListView.options.onDropCellDefault.call(j._treeListView._datagrid,x,C);if(C.manager.getDocument().options.shouldAcceptDrop(C)){var A,B,v;var r=C.nodeModel;var u=r.getParent().getChildren().indexOf(r);j._logger.log("insert before or after node "+r.dump().label+", index of node: "+u+". Drop position : "+C.dropPosition);j._logger.log("reminder: top = insertBefore ||| bottom = addChild ");if(C.dropPosition==="top"){A=u-1;for(v=q.length-1;v>=0;v--){B=A-v;j._logger.log("idxToSelect after recalculation: "+B);j._treeListView.getManager().getRoots()[B].select()}}else{A=u+1;for(v=0;v<q.length;v++){B=A+v;j._logger.log("idxToSelect after recalculation: "+B);j._treeListView.getManager().getRoots()[B].select()}}j._dialog.buttons.Ok.disabled=false}delete j.DragFromThisPanel;delete sessionStorage.UPSDlgReorderDnDIsHeader;delete sessionStorage.UPSDlgReorderDnDIsCell;return false};m.onDropBlank=function(x,w){if(sessionStorage.UPSDlgReorderDnDIsCell===undefined||(sessionStorage.UPSDlgReorderDnDIsHeader!==undefined&&sessionStorage.UPSDlgReorderDnDIsHeader==="true")||j.DragFromThisPanel!==true){return false}var r=Math.min(j._treeListView.getDocument().getRoots().length,13);var v=r*j._treeListView.elements.container.querySelectorAll(".wux-datagrid-cell.wux-layouts-treeview-cell.wux-datagrid-cell-even")[0].getSize().height;if(x.offsetY<v){return false}var u=j._treeListView.getDocument().getSelectedNodes();var s=w.manager._rowsList.length-1;j._logger.log("idxToSelect for onDropBlank: "+s);j._treeListView.options.onDropBlankDefault.call(j._treeListView._datagrid,x,w);for(var t=0;t<u.length;t++){var q=s-t;j._logger.log("idxToSelect after recalculation: "+q);j._treeListView.getManager().getRoots()[q].select()}j._dialog.buttons.Ok.disabled=false;delete j.DragFromThisPanel;delete sessionStorage.UPSDlgReorderDnDIsHeader;delete sessionStorage.UPSDlgReorderDnDIsCell;return false};m.onDropColumnHeader=function(){if(sessionStorage.UPSDlgReorderDnDIsHeader===undefined||(sessionStorage.UPSDlgReorderDnDIsCell!==undefined&&sessionStorage.UPSDlgReorderDnDIsCell==="true")){return false}return true};j._treeListView=new n(m);var o=function(r){var q=function(x,v,u){if(u!==0){return u}var w=undefined,t=undefined;for(var s=0;s<j._initialList.length;s++){if(w===undefined&&x===j._initialList[s]){w=s}else{if(t===undefined&&v===j._initialList[s]){t=s}}}return(w-t)};r.columns.forEach(function(s){if(s.dataIndex==="tree"){s.sortFunction=function(y,w){var x=y.options.label;var v=w.options.label;var u=x>v?1:(x<v)?-1:0;u=q(y,w,u);j._dialog.buttons.Ok.disabled=false;return u}}else{if(s.dataIndex==="responsible"){s.sortFunction=function(w,v){var u=w.options.grid.responsible>v.options.grid.responsible?1:(w.options.grid.responsible<v.options.grid.responsible)?-1:0;u=q(w,v,u);j._dialog.buttons.Ok.disabled=false;return u}}else{var t=undefined;if(s.dataIndex==="createdDate"){t="createdDate"}else{if(s.dataIndex==="lastModifiedDate"){t="lastModifiedDate"}}s.sortFunction=function(w,v){var u=new Date(w.options.grid[t])-new Date(v.options.grid[t]);u=q(w,v,u);j._dialog.buttons.Ok.disabled=false;return u}}}})};var k=new l({shouldAcceptDrop:function(q){if(sessionStorage.UPSDlgReorderDnDIsCell===undefined||(sessionStorage.UPSDlgReorderDnDIsHeader!==undefined&&sessionStorage.UPSDlgReorderDnDIsHeader==="true")){return false}return(q.dropPosition!=="middle"&&j.DragFromThisPanel===true)},shouldAcceptDrag:function(q,r){if(r.dataIndex!=="tree"){return false}return(j.reorderFreeRunning===undefined||j.reorderFreeRunning===false)}});j._fillTreeNodeModel(k,i);j._treeListView.getManager().loadDocument(k);o(m);j._treeListView.onNodeClick(function(){if(j.reorderFreeRunning===false){delete j.reorderFreeRunning}});j._treeListView.inject(h)})},_fillTreeNodeModel:function(h,j){var i=this;require(["DS/Tree/TreeNodeModel"],function(k){h.prepareUpdate();j.forEach(function(l){var m=new k({label:l.label,grid:{responsible:l.responsible,createdDate:l.created,lastModifiedDate:l.modified,relationid:l.relationid,physicalid:l.physicalid}});h.addRoot(m)});h.pushUpdate();i._initialList=h.getRoots().slice()})},_getSelectedItems:function(){var k=this;var h=[];var l=k._treeListView.getDocument().getSelectedNodes();l.sort(function(m,i){return m._rowID-i._rowID});for(var j=0;j<l.length;j++){h.push({label:l[j].options.label,rowID:l[j]._rowID,newRowID:l[j]._rowID})}return h},_onReorderUp:function(){var p=this;var j=p._getSelectedItems();var h=false;var k=p._treeListView.getDocument().getRoots();p._treeListView.getManager().prepareUpdateView();for(var m=0;m<j.length;m++){var o=j[m];if(o.rowID===0){continue}if((m===0&&o.rowID>0)||(j[m-1].newRowID!==o.rowID-1)){var n=k[o.rowID];o.newRowID=o.rowID-1;n.getParent().insertBefore(n,k[o.newRowID]);n.select();h=true}}p._treeListView.getManager().pushUpdateView();if(!h){return}var l=p._treeListView.getManager()._getVirtualPositionFromScrollPosition().rowID;if(j[0].newRowID<=l){p._treeListView.getManager().scrollToRow(j[0].newRowID,"top")}p._dialog.buttons.Ok.disabled=false},_onReorderDown:function(){var o=this;var r=o._getSelectedItems();var k=o._treeListView.getDocument().getRoots().length-1;var p=false;var n=o._treeListView.getDocument().getRoots();o._treeListView.getManager().prepareUpdateView();for(var l=r.length-1;l>=0;l--){var q=r[l];if(q.rowID===k){continue}if(l===r.length-1||(r[l+1].newRowID!==q.rowID+1)){var h=n[q.rowID];q.newRowID=q.rowID+1;h.getParent().insertBefore(h,n[q.newRowID+1]);h.select();p=true}}o._treeListView.getManager().pushUpdateView();if(!p){return}var j=o._treeListView.getManager()._getVirtualPositionFromScrollPosition().rowID;var m=Math.min(o._treeListView.getDocument().getRoots().length,14)+j;if(r[r.length-1].newRowID+1>=m){o._treeListView.getManager().scrollToRow(r[r.length-1].newRowID+1,"bottom")}o._dialog.buttons.Ok.disabled=false},_onReorderFree:function(){var i=this;if(i.reorderFreeRunning===true){return}var h=i._getSelectedItems();var k=i._treeListView.getDocument().getSelectedNodes();if(h.length===0){return}i.reorderUp.disabled=true;i.reorderDown.disabled=true;i._dialog.buttons.Ok.disabled=true;i._dialog.buttons.Reset.disabled=true;var j;i.reorderFreeRunning=true;i.reorderFreeEmptyAreaCB=function(r){function o(v){if(!v.hasOwnProperty("offsetX")){var u=v.target||v.srcElement,t=u.getBoundingClientRect(),s=v.clientX-t.left,w=v.clientY-t.top;return{offsetX:s,offsetY:w}}else{return{offsetX:v.offsetX,offsetY:v.offsetY}}}var q=o(r);var n=18;if(r.target.className.indexOf("wux-scroller")!==-1){var p=g.extendElement(r.target).getDimensions();var m=p.width;var l=p.height;if(q.offsetX<(m-n)&&q.offsetY<(l-n)){i._reorderFreeEmptyAreaRunning=true;k.forEach(function(s){s.select()});i._reorderFreeEmptyAreaRunning=false}}};i._treeListView.getManager().elements.container.addEvent(c.POINTERUP,i.reorderFreeEmptyAreaCB);i.reorderFreeOnAddCB=i._treeListView.getDocument().getXSO().onAdd(function(n){if(i._reorderFreeEmptyAreaRunning){return}i._treeListView.getDocument().getXSO()._modelEvents.unsubscribe(i.reorderFreeOnAddCB);i._treeListView.getManager().elements.container.removeEvent(c.POINTERUP,i.reorderFreeEmptyAreaCB);n.unselect();i.reorderUp.disabled=false;i.reorderDown.disabled=false;i._dialog.buttons.Ok.disabled=false;i._dialog.buttons.Reset.disabled=false;j=n._getRowID();var s=i._treeListView.getDocument().getRoots();var l=n.getParent();var m={UNDEFINED:0,UP:1,DOWN:2,CENTER:3,IN_SELECTION:4};var u=0,o=0,v=false,r;for(r=0;r<h.length;r++){if(h[r].rowID===j){v=true;break}else{h[r].rowID<j?o++:u++}}var t=m.UNDEFINED;if(v){t=m.IN_SELECTION}else{if(o>0&&u===0){t=m.DOWN}else{if(u>0&&o===0){t=m.UP}else{t=m.CENTER}}}i._treeListView.getManager().prepareUpdateView();var q=[];for(r=h.length-1;r>=0;r--){var p=s[h[r].rowID];q.push(p.remove());if(h[r].rowID<j){j--}}if(t===m.DOWN||t===m.CENTER){j++}setTimeout(function(){q.forEach(function(y,w){l.insertBefore(y,s[j]);var x=(w===0);y.select(x);i.reorderFreeRunning=false;delete i.reorderFreeOnAddCB});i._treeListView.getManager().pushUpdateView()},100);i._dialog.buttons.Ok.disabled=false})},_onReset:function(){var l=this,h;l._treeListView.getManager().prepareUpdateView();var j=l._treeListView.getDocument().getRoots();for(h=0;h<l._initialList.length;h++){var k=j[h];if(l._initialList[h]!==k){k.getParent().insertBefore(l._initialList[h],k)}k.unselect()}for(h=j.length-1;h>l._initialList.length;h--){j[h].remove()}j.length=l._initialList.length;l._treeListView.getManager().pushUpdateView();l._dialog.buttons.Ok.disabled=true}});return f});define("DS/AuthGenericCommands/views/AuthModalChooser",["css!DS/AuthGenericCommands/AuthGenericCommands.css","UWA/Class","UWA/Class/Options","DS/Logger/Logger","DS/AuthGenericCommands/views/AuthSearchView","DS/UIKIT/Modal","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices"],function(d,a,h,c,i,g,f,e){var b=a.extend(h,{name:"authmodalchooser",_logger:null,_modal:null,options:{},init:function(j){this._logger=c.getLogger(i);this._logger.log("init");this._parent(j);this.setOptions(j);if(!j.renderTo){var m=document.getElementsByClassName("xnav_component");if(m&&m.length===1){j.renderTo=m[0]}else{j.renderTo=document.body}}var n=UWA.createElement("div");var k=this;new i({callbacks:{onSearch:this._onPADSearch.bind(this)}}).render().inject(n);document.addEventListener("keyup",function(o){if(o.keyCode===27){k._modal.destroy();if(undefined!==f.get().getPADTreeDocument){f.get().getPADTreeDocument()._insertFlag=false}}});this._modal=new g({className:this.name+"_modal",closable:false,body:n,visible:true,overlay:UWA.is(this.getOption("overlay"))?this.getOption("overlay"):true});if(j.position){if(j.position.top&&j.position.left){this._modal.elements.content.setStyle("top",j.position.top);this._modal.elements.content.setStyle("left",j.position.left)}else{switch(j.position){case"above_action_bar":var l=j.renderTo.getBoundingClientRect();this._modal.elements.wrapper.setStyle("padding-top","calc("+l.height+"px - 80px)");this._modal.elements.wrapper.setStyle("padding-left","calc(50% - 135px)");break;default:this._logger.log("unknown style");break}}}this._modal.elements.container.addEventListener("click",function(){k._modal.destroy();if(undefined!==f.get().getPADTreeDocument){f.get().getPADTreeDocument()._insertFlag=false}});this._modal.elements.content.addEventListener("click",function(o){o.preventDefault();o.stopPropagation();return false});this._modal.inject(j.renderTo)},close:function(){this._modal.destroy()},_onPADSearch:function(o,j){this._logger.log("_onPADSearch with "+JSON.stringify(o));var m=this;if((undefined!==f.get().getPADTreeDocument&&j===true)||(f.get().name==="ENOPAD3DViewer"&&j===true)){m._modal.destroy();var k=this.getOption("in_apps_search");k.in_apps_callback.call(null,o)}else{if(o.search_value.length){var l;var p=this.getOption("in_apps_search");if(this.getOption("retrieveSearchValue")===true){l=o.search_value;m._modal.destroy();var n=this.getOption("searchValueCallback");if(UWA.is(n,"function")){n.call(null,{searchValue:l})}}else{if(p){l=o.search_value;p.fts_value=l;p.callback=function(q){m._logger.log("In Apps Search callback");m._modal.destroy();if(UWA.is(p.in_apps_callback,"function")){p.in_apps_callback.call(null,q)}};p.cancel=function(){m._logger.log("In Apps Search Cancel callback");m._modal.destroy()};e.in_apps_search(p)}}}else{this._logger.log("No search done since no string inside the input");this._modal.destroy()}}}});return b});define("DS/AuthGenericCommands/AppContext",["DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/AuthGenericCommands/views/AuthModalChooser","DS/WidgetServices/WidgetServices"],function(f,d,a,g){var e=undefined,c=undefined;var b={myContext:undefined,isExternalContext:false,_b3DFirstTime:true,getContext:function(){this.myContext=this.myContext||f.get();return this.myContext},setContext:function(h){if(h!=="Default"){this.myContext=h;this.isExternalContext=true}},_is2DContext:function(){return this.getContext().name==="pad_component"},_is3DContext:function(){if(this._b3DFirstTime===true){e=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices");c=require("DS/Selection/CSOManager");this._b3DFirstTime=false}return this.getContext().name==="ENOPAD3DViewer"},getSelectedNodes:function(){if(this.isExternalContext){return this.getContext().getSelectedNodes()}else{if(this._is2DContext()){var i=this.getContext().getSelectedNodes();if(i&&i[0]){return i}}else{if(this._is3DContext()){var h=this;var i=[];c.get().forEach(function(m){var j=m.pathElement.getLastElement(true);var l=m.pathElement.externalPath.length-1;while((j!==undefined)&&!e.isPLMNode(j)&&l>=0){l--;j=m.pathElement.externalPath[l]}if((j!==undefined)&&e.isPLMNode(j)){var k=h.getNodesById(e.getNodeID(j));if(k&&k.length>0&&k[0]){i.push(k[0])}else{i.push(m)}}});return i}}}return[]},isThereARootSelected:function(){if(this.isExternalContext){return this.getContext().isThereARootSelected()}else{if(this._is2DContext()){var i=this;var h=this.getSelectedNodes();var j=0;if(h.length>0){h.forEach(function(k){if(i.isRoot(k)){j++}});return(j>0)}}else{if(this._is3DContext()){}}}return false},getSelectedRoots:function(){if(this.isExternalContext){return this.getContext().getSelectedRoots()}else{if(this._is2DContext()){var h=[];var j=this;var i=this.getSelectedNodes();if(i.length>0){i.forEach(function(k){if(j.isRoot(k)){h.push(k)}})}return h}else{if(this._is3DContext()){}}}return[]},getParentWithChild:function(l){if(this.isExternalContext){return this.getContext().getSelectedRoots()}else{if(this._is2DContext()){if((l!==undefined)&&(l!==null)&&l.length){var o=[];var n=l.length;for(var p=0;p<n;p++){var k=l[p];for(var m=0;m<n;m++){if(p!==m){var h=l[m];var q=h.getParent();while(q){if(q===k){o.push({parent:k,child:h})}q=q.getParent()}}}}return o}}else{if(this._is3DContext()){}}}return[]},getInstance:function(h){if(this.isExternalContext){return this.getContext().getInstance(h)}else{return this.getRelationID(h)}},getRelationID:function(i){if(this.isExternalContext){return this.getContext().getRelationID(i)}else{if(this._is2DContext()){if((i!==undefined)&&(i!==null)&&i.getRelationID){return i.getRelationID()}}else{if(this._is3DContext()){if((i!==undefined)&&(i!==null)){var j=i.pathElement||i.path;while(j!==undefined&&j!==null){var h=j.getLastElement(true);if(h.className==="PAD3DViewerNode"){if(e.isReference(h)||e.is3DLeaf(h)||e.isRepReference(h)){return e.getNodeID(h.path.getParentPath().getLastElement(true))}else{if(e.isInstance(h)||e.isRepInstance(h)){return e.getNodeID(h)}}}j=j.getParentPath()}}}}}return undefined},getReference:function(h){if(this.isExternalContext){return this.getContext().getReference(h)}else{if(this._is2DContext()){if((h!==undefined)&&(h!==null)&&h.getID){return h.getID()}}else{if(this._is3DContext()){if((h!==undefined)&&(h!==null)){if(e.isPLMNode(h)){if(e.isReference(h)||e.isRepReference(h)){return e.getNodeID(h)}else{return e.getNodeID(h.getChildren()[0])}}}}}}return undefined},getParent:function(j){if(this.isExternalContext){return this.getContext().getParent(j)}else{if(this._is2DContext()){if((j!==undefined)&&(j!==null)&&j.getParent){return j.getParent()}}else{if(this._is3DContext()){if((j!==undefined)&&(j!==null)){var k=j.pathElement||j.path;while(k!==undefined&&k!==null){var i=k.getLastElement(true);if(i.className==="PAD3DViewerNode"&&(e.isReference(i)||e.isRepReference(i)||e.is3DLeaf(i))){var h=j.path.getParentPath().getParentPath().getLastElement(true);return h}k=k.getParentPath()}}}}}return undefined},getParents:function(h){if(this.isExternalContext){return this.getContext().getParents(h)}else{if(this._is2DContext()){if((h!==undefined)&&(h!==null)&&h.getParents){return h.getParents()}}else{if(this._is3DContext()){if((h!==undefined)&&(h!==null)){if(e.isReference(h)){if(!this.isRoot(h)){h=h.getParents()[0]}else{return undefined}}return h.getParents()}}}}return undefined},getRoot:function(h){if(this.isExternalContext){return this.getContext().getRoot(h)}else{if(this._is2DContext()){if((h!==undefined)&&(h!==null)&&h.getRoot){return h.getRoot()}}else{if(this._is3DContext()){if((h!==undefined)&&(h!==null)){var i=h.pathElement||h.path;if(i!==undefined){return i.externalPath[1]}}}}}return undefined},getRoots:function(){if(this.isExternalContext){return this.getContext().getRoots()}else{if(this._is2DContext()){return this.getContext().getPADTreeDocument().getRoots()}else{if(this._is3DContext()){return e.getRoots(this.myContext)}}}},getType:function(h){if(this.isExternalContext){return this.getContext().getType(h)}else{if(this._is2DContext()){if((h!==undefined)&&(h!==null)&&h.options){return h.options.type}}else{if(this._is3DContext()){if((h!==undefined)&&(h!==null)){var i=h.pathElement||h.path;while(i!==undefined&&i!==null){var j=i.getLastElement(true);if(j.className==="PAD3DViewerNode"&&(e.isReference(j)||e.is3DLeaf(j))){return e.getNodeType(j)}i=i.getParentPath()}}}}}return""},getName:function(h){if(this.isExternalContext){return this.getContext().getName(h)}else{if(this._is2DContext()){if((h!==undefined)&&(h!==null)&&h.options){return h.options.label}}else{if(this._is3DContext()){}}}return""},getNamesAsync:function(k,o){var n=this;var p=[];if(Array.isArray(k)){var j=k.length;if(this.isExternalContext||this._is2DContext()){for(var l=0;l<j;l++){p[l]=this.getName(k[l])}}else{if(this._is3DContext()){var h=[];for(var l=0;l<j;l++){h[l]=e.getNodeID(k[l])}var q={ids:h,attributes:["ds6w:label"],callbacks:{onComplete:function(s){for(var r=0;r<j;r++){var t=h[r];p[r]=s[t]["ds6w:label"]}if(o){o(p)}},onFailure:function(){if(o){o(p)}}}};var m=f.get().getController();return m.getAttributes(q)}}}if(o){o(p)}},getChildren:function(h){if(this.isExternalContext){return this.getContext().getChildren(h)}else{if(this._is2DContext()||this._is3DContext()){if((h!==undefined)&&(h!==null)&&h.getChildren){return h.getChildren()||[]}}}return[]},getOrdering:function(h){if(this.isExternalContext){return this.getContext().getOrdering(h)}else{if(this._is2DContext()){if((h!==undefined)&&(h!==null)){return this.getContext().getOrdering(h)}}else{if(this._is3DContext()){}}}return undefined},getNodesById:function(i){if(this.isExternalContext){return this.getContext().getNodesById(i)}else{if(this._is2DContext()){return this.getContext().getPADTreeDocument().getNodesById(i)}else{if(this._is3DContext()){if((i!==undefined)&&(i!==null)){var h=this.getContext().getController().getNode({id:i});return h?[h]:null}return[]}}}},isRoot:function(h){if(this.isExternalContext){return this.getContext().isRoot(h)}else{if(this._is2DContext()){if((h!==undefined)&&(h!==null)&&h.getRoot){return(h.getRoot()===h?true:false)}}else{if(this._is3DContext()){if((h!==undefined)&&(h!==null)){var i=h.pathElement||h.path;return i.externalPath.length<=2}}}}return false},isDescendantOf:function(h,i){if(this.isExternalContext){return this.getContext().isDescendantOf(h,i)}else{if(this._is2DContext()){if((h!==undefined)&&(h!==null)&&h.isDescendantOf){return h.isDescendantOf(i)}}else{if(this._is3DContext()){if((h!==undefined)&&(h!==null)){if(this.getReference(h)===i){return true}if(!this.isRoot(h)){var j=this.getParent(h);if(j){return this.isDescendantOf(j,i)}}}}}}return false},refresh:function(u){this.author(true);var h=this.getContext();if(this.isExternalContext){h.refresh(u)}else{if(u.action==="unparent"){var r=[];var q=[];u.instances.forEach(function(i){r.push({physicalid:i});q.push(i)});if(this._is2DContext()){h.refreshView({deleted:r})}else{if(this._is3DContext()){h.getController().unparent({deleted:q})}}var l={};l.detach={deleted:q};h._commandProxy.padRefresh(l,true)}else{if(u.action==="insert"){var j={};j[u.parent]=[];for(var p=0;p<u.references.length;p++){j[u.parent].push({resourceid:u.references[p],relationid:u.instances[p]})}j.noNotification=true;if(this._is2DContext()){this.getContext().insertNodes(j)}else{if(this._is3DContext()){var n=[],o=[];for(var p=0;p<j[u.parent].length;p++){n.push(j[u.parent][p].relationid);o.push(j[u.parent][p].resourceid)}h.getController().insertExisting({created:n,inserted:o,modified:[u.parent]},true)}}}else{if(u.action==="replace"){if(u.operations.length===0){return}var h=this.getContext();var m={};var t={created:[],inserted:[],modified:[]};m.noNotification=true;var k=[];var s=[];u.operations.forEach(function(i){m[i.parent]=m[i.parent]||[];m[i.parent].push({resourceid:i["new"].reference,relationid:i["new"].instance,ordering:i.ordering});t.created.push(i["new"].instance);t.inserted.push(i["new"].reference);if(t.modified.indexOf(i.parent)===-1){t.modified.push(i.parent)}k.push({physicalid:i.old});s.push(i.old)});if(this._is2DContext()){h.replaceNodes({toInsert:m,toDelete:k})}else{if(this._is3DContext()){h.getController().insertExisting({created:t.created,inserted:t.inserted,modified:t.modified});var l={};l.detach={deleted:s};h._commandProxy.padRefresh(l)}}}}}}},author:function(h){if(this.isExternalContext){this.getContext().author(h)}else{if(this._is2DContext()){this.getContext().author(h)}else{if(this._is3DContext()){this.getContext().getController().switchAuthoringMode(h,true,"PADSession_disabling_index_authoring")}}}},beginBlockingTransaction:function(h){if(this.isExternalContext){if(this.getContext().beginBlockingTransaction){this.getContext().beginBlockingTransaction(h)}}else{if(this._is2DContext()){this.getContext().beginBlockingTransaction(h)}else{if(this._is3DContext()){}}}},endBlockingTransaction:function(){if(this.isExternalContext){if(this.getContext().endBlockingTransaction){this.getContext().endBlockingTransaction()}}else{if(this._is2DContext()){this.getContext().endBlockingTransaction()}else{if(this._is3DContext()){}}}},displayNotification:function(h){if(this.getContext().displayNotification){this.getContext().displayNotification(h)}},modalChooser:function(h){var i="OnPremise";var j=g.getTenantID();if(j&&j.length!=0){i=j}if(this.isExternalContext){this.getContext().modalChooser(h)}else{new a({position:h.position,in_apps_search:{source:h.source?h.source:["3dspace"],precond:h.precond,in_apps_callback:h.in_apps_callback,multiSel:h.multiSel,tenant:i}})}},addRoot:function(h,j,i){if(this.isExternalContext){this.getContext().addRoot(h,j,i)}else{if(this._is2DContext()){this.getContext().add(h,j,i)}else{if(this._is3DContext()){this.getContext().addRoots(h,i)}}}},getSetting:function(h){if(this.isExternalContext){return this.getContext().getSetting(h)}switch(h){case"lang":return d.getSetting("lang");case"securityContext":return d.getSetting("pad_security_ctx");default:return undefined}}};return b});define("DS/AuthGenericCommands/commands/AuthGenericCmdUnparent",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext"],function(c,b,a){var d=c.extend(b,{defaultOptions:{},init:function(e){if(e.context){a.setContext(e.context)}this._parent(e,{mode:"exclusive",isAsynchronous:false})},execute:function(){var e=this;e.selectedNodes=a.getSelectedNodes();var f=localStorage.getItem(e.options.className+".displayConfirmMsg");if(f==="false"){e._launchUnparent()}else{this._launchConfirm({callback:function(g){g?e._launchUnparent():null}})}},_launchConfirm:function(e){var f=this;require(["DS/AuthGenericCommands/views/AuthGenericDlgConfirm","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],function(h,g){var i=undefined;a.getNamesAsync(f.selectedNodes,function(k){f.cachedNames=k;if(f.selectedNodes.length===0){}else{if(f.selectedNodes.length===1){i=g.unparent_confirm_message_single;var j=f.cachedNames[0];i=i?i.replace(/{name}/g,j):i}else{i=g.unparent_confirm_message_multiple}}f._confirmModal=new h({className:f.options.className,renderTo:document.body,action:g.unparent_confirm_title,title:g.unparent_confirm_title,message:i,callback:e.callback})})})},_launchUnparent:function(){var e=this;require(["i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json","DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/AuthGenericCommands/AuthGenericCmdUtils"],function(f,h,g){var l=e.selectedNodes;if(l.length){if(a.isThereARootSelected()){a.displayNotification({msg:f.SEL_006,eventID:"error"})}else{var k=[];l.forEach(function(m){k.push(a.getRelationID(m))});var j=function(m){return m.filter(function(o,p,n){return n.indexOf(o)==p})};k=j(k);var i={version:e.defaultOptions.version,bAllOrNothing:e.defaultOptions.bAllOrNothing,instances:k};e.defaultOptions.isValidSelection(l,function(o){if(o.status===false){var p="";for(var q=0,m=o.invalid.length;q<m;q++){p+=a.getName(o.invalid[q]);if(q!=m-1){p+=", "}}a.displayNotification({msg:f.replace(f.get("unparent_unsupported_object"),{name:p}),eventID:"error"});return}a.beginBlockingTransaction(f.executing);h.unparent({data:i,modeler:e.defaultOptions.modeler,onComplete:function(n){a.endBlockingTransaction();e._onUpdate(n,k,{successMsg:f.unparent_success,failureMsg:f.unparent_error})},onFailure:function(u,w){a.endBlockingTransaction();var x=f.unparent_error;var s=e.cachedNames?e.cachedNames[0]:"";try{var r={remapErrors:e.defaultOptions.remapErrors,name:s,type:null};var n=JSON.parse(w);x+=g.buildErrorMessage(n.messages,r);var t=new RegExp(f.unwanted_word_delete,"g");x=x.replace(t,f.unwanted_word_replacer_delete)}catch(v){x+=u.message}a.displayNotification({msg:x,eventID:"error"})}})})}}})},_onUpdate:function(h,g,f){var e=(typeof h==="string")?JSON.parse(h):h;if(e.status==="success"){a.refresh({action:"unparent",instances:g});a.displayNotification({msg:f.successMsg,eventID:"primary"})}else{a.displayNotification({msg:f.failureMsg+e.message,eventID:"error"})}}});return d});define("DS/AuthGenericCommands/commands/AuthGenericCmdRevisionUpdate",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],function(d,c,b,a){var e=d.extend(c,{defaultOptions:{},init:function(f){if(f.context){b.setContext(f.context)}this._parent(f,{mode:"exclusive",isAsynchronous:false})},execute:function(){var f=this;require(["DS/AuthGenericCommands/views/AuthGenericDlgRevisionUpdate"],function(g){f.disable();var h=b.getSelectedNodes();f.selectedNodes=h;if(h.length){f.defaultOptions.isValidSelection(h,function(j){if(j.status===false){for(var p=0,i=j.invalid.length;p<i;p++){var m=j.invalid[p];var o="";var k=b.getName(m.node);if(m.why==="BADTYPE"){o=a.replace(a.get("selection_unsupported_type"),{name:k,type:b.getType(m.node)})}else{if(m.why==="ROOT"){o=a.replace(a.get("selection_root"),{name:k})}else{if(m.why==="CHILD"){o=a.replace(a.get("selection_child"),{child:k,parent:b.getName(m.parent)})}else{if(m.why==="ROOT_NO_CHILD"){o=a.replace(a.get("selection_root_no_children"),{name:k})}else{if(m.why==="CYCLE"){o=a.replace(a.get("selection_cycle"),{name:k})}}}}}b.displayNotification({title:a.BAD_SELECTION,msg:o,eventID:"warning"})}f.enable()}if(j.valid.length>0){f.selectedNodes=j.valid;f.revisionDlg=new g({roots:f.selectedNodes,title:f.options.commandName,commandMode:f.options.commandMode,onLoad:f._launchLoad.bind(f),onComplete:f._launchReplace.bind(f),onAbort:f._launchLoadAbort.bind(f),enableCmdOnClose:f._setCmdAvailability.bind(f)})}})}})},_setCmdAvailability:function(f){if(f===true){this.enable()}else{if(f===false){this.disable()}}},_launchLoad:function(i,h,f){var g=this;require(["DS/AuthGenericCommands/AuthGenericRevision"],function(j){var k={requests:i,chunkSize:25,progressBar:g.revisionDlg.progressBar,cbOnComplete:function(m){var n=m.getAnswers();var l=j.getLatestCandidateRevisions(n);if(typeof h==="function"){h(l)}},cbOnProgress:f,cbOnAbort:g._launchLoadAbort};g.loadProcess=j.getRevisions(k)})},_launchLoadAbort:function(){var f=this;if(f.loadProcess){f.loadProcess.abort()}},_getNodeToOrder:function(g){var h=this;var f=[];if(h.options.commandMode==="FlatList"){f=h.selectedNodes}else{g.forEach(function(k){var j=h.selectedNodes.length;for(var m=0;m<j;m++){var n=h.selectedNodes[m].getNodesByRelId(k.instance);if(n.length){if(n.length===1){f.push(n[0]);break}}}})}return f},_launchReplace:function(f){var g=this;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],function(j){var i=g._getNodeToOrder(f);g.ordering=b.getOrdering(i);var h={version:g.defaultOptions.version,bAllOrNothing:g.defaultOptions.bAllOrNothing,modeler:g.defaultOptions.modeler,chunkSize:30,requests:f,cbOnComplete:g._replaceMass_OnComplete.bind(g),cbOnProgress:g._replaceMass_OnProgress.bind(g),cbOnAbort:g._replaceMass_OnAbort.bind(g),cbOnLastChunk:g._replaceMass_OnLastChunk.bind(g)};if(h.chunkSize<f.length){require(["DS/AuthGenericCommands/views/AuthGenericDlgProgressbar"],function(k){g.progressbarDlg=new k({label:{progressBarMainTitle:a.executing,progressBarAbortAlert:a.abort_confirm_message,progressBarAlertTitle:a.confirm,modalFooterAbort:a.modalFooterAbort},events:{onAbort:function(){h.cbOnAbort()}}})})}else{b.beginBlockingTransaction(a.executing)}g.replaceProcess=j.replaceMassOperations(h)})},_replaceMass_OnAbort:function(){var f=this;if(f.replaceProcess){f.replaceProcess.abort()}},_replaceMass_OnProgress:function(f){var g=this;if(g.progressbarDlg&&g.progressbarDlg.progressBar){g.progressbarDlg.progressBar.value=f*100}},_replaceMass_OnLastChunk:function(){var f=this;if(f.progressbarDlg){f.progressbarDlg.disableAbort()}},_replaceMass_OnComplete:function(g){var f=this;require(["DS/AuthGenericCommands/views/AuthGenericReportPanel","DS/AuthGenericCommands/AuthGenericCmdUtils"],function(k,p){var q=[],i=[],l=[],h=[],j;var n=g.getAnswers();var m={action:"replace",operations:[]};n.forEach(function(t){var u=t.answer;if(u.status==="success"){m.operations.push({parent:u.parent,old:u.oldInstance,"new":{reference:u.newReference,instance:u.newInstance},rootNode:u.parent,ordering:f.ordering[u.oldInstance]});j=a.replace(a.get("replace_report_success"),{oldName:u.oldName,newName:u.newName});q.push(j)}else{var s={remapErrors:f.defaultOptions.remapErrors,name:u.oldName,type:null};var r=p.buildErrorMessage(u.messages,s);j=a.replace(a.get("replace_report_failure1"),{oldName:u.oldName})+" "+r;i.push(j)}});var o=g.getAbortedRequests();o.forEach(function(r){j=a.replace(a.get("replace_report_abort"),{oldName:r.oldName,newName:r.newName});h.push(j)});b.refresh(m);if(f.progressbarDlg){f.progressbarDlg.destroy();f.progressbarDlg=undefined}else{b.endBlockingTransaction()}f.reportPanel=new k({title:f.options.reportTitle,success:q,failure:i,neutral:l,aborted:h})})}});return e});define("DS/AuthGenericCommands/commands/AuthGenericCmdInsertProductConfiguration",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],function(e,d,c,b){const a=true;var f=e.extend(d,{defaultOptions:{},init:function(g){if(g.context){c.setContext(g.context)}this._parent(g,{mode:"exclusive",isAsynchronous:false})},execute:function(){var g=this;var h=c.getSelectedNodes();g._parentNodesFromID=[];g._childrenNameFromID=[];g.defaultOptions.isValidParentSelection(h,function(j){if(j.status===false){for(var p=0,i=j.invalid.length;p<i;p++){var m=j.invalid[p];var o=b.replace(b.get("insert_unsupported_type_parent"),{name:c.getName(m),type:c.getType(m)});c.displayNotification({msg:o,eventID:"error"})}}else{g._parentNodes=h;var k=g.defaultOptions.chooser.precondFilter;g._launchModalChooser(k)}})},_launchModalChooser:function(g){var h=this;c.modalChooser({position:"above_action_bar",source:h.defaultOptions.chooser.source,precond:g,in_apps_callback:h._onSearchDone_Children.bind(h),multiSel:h.defaultOptions.chooser.multiSel})},_onSearchDone_Children:function(i){var h=this;var g=h._launchProductConfigurationChooser.bind(h);h._checkValidParentAndChildren(i,g)},_checkValidParentAndChildren:function(i,g){var h=this;require(["DS/AuthGenericCommands/AuthGenericCmdUtils"],function(j){h.defaultOptions.isValidChildrenSelection(i,function(o){if(o.status===false){var A="",z="";for(var C=0,F=o.invalid.length;C<F;C++){A+=o.invalid[C]["ds6w:label"];z+=o.invalid[C]["ds6w:type"];if(C!=F-1){A+=", ";z+=", "}}var s=b.replace(b.get("insert_unsupported_child_type"),{name:A,type:z});c.displayNotification({msg:s,eventID:"error"});return}for(var C=0,F=o.valid.length;C<F;C++){var D=o.valid[C];var L=D["ds6w:label"];if(L===undefined){L=""}h._childrenNameFromID[D.resourceid]=L}var r=[];var w=[],K=[];var k=i.length;if(a){console.log("nChild =",k)}for(var J=0;J<k;J++){var D=i[J];var t=D.resourceid;var L=h._childrenNameFromID[t];if(a){console.log("Child["+J+"] is",L)}r.push({isInstanceOf:t,name:L});w.push(t);K.push(L)}var y=h._parentNodes;var I=[];var G=y.length;if(a){console.log("nParent =",G)}for(var B=0;B<G;B++){var u=y[B];var t=c.getReference(u);if(h._parentNodesFromID[t]===undefined){h._parentNodesFromID[t]=u;var m=b.insert_unsupported_cycle;var q=b.insert_unsupported_itself;var E=c.getName(u);if(a){console.log("Parent["+B+"] is",E)}if(!j.canInstantiate(t,w,m,E,K,q)){return}var v={isInstanceOf:t,name:E};var x=undefined;var H=c.getChildren(u);if(null!==H&&H.length>0){x=[];H.forEach(function(l){var n=c.getRelationID(l);if(n!==undefined){x.push(n)}});v.children=x}I.push(v)}}h._parents=I;h._children=r;h._childrenIDs=w;h._childrenName=K;if(typeof g==="function"){g()}})})},_launchProductConfigurationChooser:function(){var g=this;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],function(j){var l={data:{},onComplete:function(p){var o=null;var n=(typeof p==="string")?JSON.parse(p):p;if(n.version&&n.version==="1.1"){if(n.contexts.content.results.length>0){o=n.contexts.content.results[0].physicalID}}g._launchProductConfigurationChooser2(o)},onFailure:function(n,o){console.log("getConfiguredObjectInfo.onFailure");g._launchProductConfigurationChooser2(null)}};var k=g._childrenIDs[0];var h="/resources/modeler/configuration/navigationServices/getConfiguredObjectInfo/pid:"+k;var m="GET";var i=["cfgCtxt","1","enabledCriteria","1"];j.callWS(l,h,m,i)})},_launchProductConfigurationChooser2:function(i){var g=this;if(i===null){var h=b.get("insertPC_noPCFound");c.displayNotification({msg:h,eventID:"error"});return}else{require(["DS/CfgBaseUX/scripts/CfgSearchConfiguration"],function(j){if(a){console.log("CFG ModelId:",i)}var m=false;var r=new j(m);var o="";var n="Product Configuration";var l="";var q=g._onSearchDone_ProductConfiguration.bind(g);var p="(based_95_on_95_model_95_pid:"+i+")";var k="";r.activate(o,n,l,q,p,k)})}},_onSearchDone_ProductConfiguration:function(h){var g=this;g._productConfigurationFromSearch=h[0];var i=h[0].id;g._children[0].productConfigurationId=i;g._processInsertExisting()},_processInsertExisting:function(){var l=this;var q=l._parents;var j=l._children;var g=[];var m=q.length;var o=j.length;for(var i=0;i<m;i++){for(var n=0;n<o;n++){g.push({parent:q[i],child:j[n]})}}var k=l.defaultOptions.chunkSize;var r={chunkSize:k,requests:g,cbOnProgress:function(t,p,s){if(a){console.log("insertMassOperations.cbOnProgress",p)}},cbOnComplete:function(v,B){c.endBlockingTransaction();var A={},w=[];var y=v.getAnswers();var x="";y.forEach(function(p){var D=p.answer;if(D.status==="success"){var C=D.parent;if(A[C]!==undefined){A[C].references.push(D.child);A[C].instances.push(D.instance)}else{A[C]={references:[D.child],instances:[D.instance],rootNode:l._parentNodesFromID[C]};if(l._productConfigurationFromSearch){A[C].productConfigurationFromSearch=l._productConfigurationFromSearch}}}else{w.push(D)}});var t=(w.length>0);if(t){c.displayNotification({msg:b.ERR_InsertProductCconfiguration+x,eventID:"error"})}var u=[];for(var s in A){var z=A[s];z.parent=s;z.action="insert";u.push(z)}if(u.length>0){u.forEach(function(p){c.refresh(p)});if(!t){c.displayNotification({msg:b.SUC_InsertProductCconfiguration,eventID:"primary"})}}}};if(a){console.log("insertMassOperations need to process",g.length,"operation(s)");console.time("insert-ws")}c.beginBlockingTransaction(b.executing);var h=l._insertMassOperations(r)},_optimize:function(r){var m=[];var t=r.length;var q={};var g={};var n=0;var v=0;for(var k=0;k<t;k++){var l=r[k];var u=l.parent.isInstanceOf;if(!q[u]){q[u]={count:1,cacheId:n++};if(l.parent.children){q[u].children=l.parent.children}}var j=l.child.isInstanceOf;if(!g[j]){g[j]={count:1,cacheId:v++};if(l.child.productConfigurationId){g[j].productConfigurationId=l.child.productConfigurationId}}}var w={};for(var h in q){w[h]={isInstanceOf:h};if(q[h].children){w[h].children=q[h].children}}var i={};for(var s in g){i[s]={isInstanceOf:s};if(g[s].productConfigurationId){i[s].productConfigurationId=g[s].productConfigurationId}}for(k=0;k<t;k++){var l=r[k];var h=l.parent.isInstanceOf;var s=l.child.isInstanceOf;var u={};if(q[h].used===undefined){u=w[h];q[h].used=true}var j={};if(g[s].used===undefined){j=i[s];g[s].used=true}m.push({parent:u,child:j})}return m},_insertMassOperations:function(g){var h=this;var i=g;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/AuthGenericCommands/AuthGenericCmdUtils"],function(k,j){i.cbOnProcess=function(m,l){if(a){console.log("insertMassOperations.cbOnProcess: size=",l.length)}l=h._optimize(l);console.log(l);k.insertExisting({data:{version:h.defaultOptions.version,bAllOrNothing:h.defaultOptions.bAllOrNothing,operations:l},modeler:h.defaultOptions.modeler,onComplete:function(s){if(a){console.log("insertMassOperations.WS.onComplete")}s=(typeof s==="string")?JSON.parse(s):s;var y=[],q=[];if(s.status==="success"){for(var t=0,r=l.length;t<r;t++){var p=l[t];var w=s.results[t];m.setAnswer(p,w)}}else{if(s.status==="failure"){if(s.messages!==undefined){var u=h._parentNodesFromID[s.parent];var o=c.getName(u);var x=h._childrenNameFromID[s.child];var v={remapErrors:h.defaultOptions.remapErrors,name:x,type:null};var z=j.buildErrorMessage(s.messages,v);var n=b.replace(b.get("insertPC_failure"),{parent:o,child:x,error:z});c.displayNotification({msg:n,eventID:"error"});m.cancel()}else{}}}},onFailure:function(q,s){if(a){console.log("insertMassOperations.WS.onFailure")}var t=b.ERR_InsertProductCconfiguration;var o=(typeof s==="string")?JSON.parse(s):s;try{var n={remapErrors:h.defaultOptions.remapErrors,name:null,type:null};t+=j.buildErrorMessage(o.messages,n)}catch(r){var p=o.messages.length-1;t+=o.messages[p]}c.displayNotification({msg:t,eventID:"error"});m.cancel()}})};return new k.MassChunkedRequests(i)})}});return f});define("DS/AuthGenericCommands/commands/AuthGenericCmdReplaceByLatestRevision",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],function(d,c,b,a){var e=d.extend(c,{defaultOptions:{},init:function(f){if(f.context){b.setContext(f.context)}this._parent(f,{mode:"exclusive",isAsynchronous:false})},execute:function(){var f=this;require(["DS/AuthGenericCommands/AuthGenericCmdUtils"],function(g){f.errors=[];f.neutrals=[];var h=b.getSelectedNodes();f.selectedNodes=h;if(b.isThereARootSelected()){b.displayNotification({msg:a.SEL_002,eventID:"error"});return}if(!g.checkNoParentWithChild(h)){b.displayNotification({msg:(a.replace_error+a.replace_latest_failed_child_selected),eventID:"error"});return}f.defaultOptions.isValidSelection(h,f._checkValidSelection.bind(f))})},_checkValidSelection:function(f){var g=this;require(["DS/AuthGenericCommands/AuthGenericRevision"],function(j){if(f.status===false){for(var o=0,h=f.invalid.length;o<h;o++){var i=f.invalid[o];var m=a.replace(a.get("replace_unsupported_type"),{name:b.getName(i),type:b.getType(i)});b.displayNotification({msg:m,eventID:"error"})}return}g.ordering=b.getOrdering(g.selectedNodes);g.preparedItems={};g.physicalIds=[];g.selectedNodes.forEach(function(p){var l=b.getRelationID(p);var q=b.getReference(p);g.physicalIds.push(q);var n={};n.node=p;n.oldInstance=l;n.oldReference=q;n.parentNode=b.getParent(p);n.parentInstance=b.getReference(n.parentNode);g.preparedItems[l]=n});var k={requests:g.physicalIds,chunkSize:30,cbOnComplete:g._revisionMass_onComplete.bind(g),cbOnAbort:g._revisionMass_onAbort.bind(g)};b.beginBlockingTransaction(a.executing);g.loadProcess=j.getRevisions(k)})},_revisionMass_onAbort:function(){},_revisionMass_onComplete:function(g){var f=this;require(["DS/AuthGenericCommands/AuthGenericRevision"],function(w){var s=g.getAnswers();var h=[],k=[];for(var v in f.preparedItems){var n=f.preparedItems[v];var r=n.oldReference;var x=s[r];var m=n.node;if(x!==undefined){var j=b.getName(m);var p=w.getCurrentAndLatestRevisionNames(x,r);var i=w.getLatestRevisionForReplace(x,r);if(i===null){var l=a.replace_latest_failed_already_latest.replace("{name}",j+" "+p.newRevision);f.neutrals.push(l)}else{var q=w.getNameOfLatestRevisionForReplace(x,r);var u=n.parentInstance;var t=n.oldInstance;var o={hasParent:u,instance:t,isInstanceOf:i,oldName:j+" "+p.oldRevision,newName:q+" "+p.newRevision};h.push(o);n.newReference=i;k.push(n)}}}f._launchReplace(h)})},_launchReplace:function(f){var g=this;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/AuthGenericCommands/views/AuthGenericReportPanel","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],function(k,j,h){if(f.length<1){g.reportPanel=new j({title:g.options.reportTitle,success:[],failure:g.errors,neutral:g.neutrals,aborted:[]});b.endBlockingTransaction();return}var i={version:g.defaultOptions.version,bAllOrNothing:g.defaultOptions.bAllOrNothing,modeler:g.defaultOptions.modeler,chunkSize:30,requests:f,cbOnProgress:g._replaceMass_OnProgress.bind(g),cbOnComplete:g._replaceMass_OnComplete.bind(g),cbOnAbort:g._replaceMass_OnAbort.bind(g),cbOnLastChunk:g._replaceMass_OnLastChunk.bind(g)};if(i.chunkSize<f.length){require(["DS/AuthGenericCommands/views/AuthGenericDlgProgressbar"],function(l){g.progressbarDlg=new l({label:{progressBarMainTitle:h.executing,progressBarAbortAlert:h.abort_confirm_message,progressBarAlertTitle:h.confirm,modalFooterAbort:h.modalFooterAbort},events:{onAbort:function(){i.cbOnAbort()}}});b.endBlockingTransaction()})}g.replaceProcess=k.replaceMassOperations(i)})},_replaceMass_OnAbort:function(){var f=this;if(f.replaceProcess){f.replaceProcess.abort()}},_replaceMass_OnProgress:function(f){var g=this;if(g.progressbarDlg&&g.progressbarDlg.progressBar){g.progressbarDlg.progressBar.value=f*100}},_replaceMass_OnLastChunk:function(){var f=this;if(f.progressbarDlg){f.progressbarDlg.disableAbort()}},_replaceMass_OnComplete:function(g){var f=this;require(["DS/AuthGenericCommands/views/AuthGenericReportPanel","DS/AuthGenericCommands/AuthGenericCmdUtils"],function(j,o){var i,p=[],h=[];var k=f.errors;var m=g.getAnswers();var l={action:"replace",operations:[]};m.forEach(function(s){var t=s.answer;if(t.status==="success"){l.operations.push({parent:t.parent,old:t.oldInstance,"new":{reference:t.newReference,instance:t.newInstance},rootNode:t.parent,ordering:f.ordering[t.oldInstance]});i=a.replace(a.get("replace_report_success"),{oldName:t.oldName,newName:t.newName});p.push(i)}else{var r={remapErrors:f.defaultOptions.remapErrors,name:t.oldName,type:null};var q=o.buildErrorMessage(t.messages,r);i=a.replace(a.get("replace_report_failure1"),{oldName:t.oldName})+" "+q;k.push(i)}});var n=g.getAbortedRequests();n.forEach(function(q){i=a.replace(a.get("replace_report_abort"),{oldName:q.oldName,newName:q.newName});h.push(i)});b.refresh(l);if(f.progressbarDlg){f.progressbarDlg.destroy();f.progressbarDlg=undefined}else{b.endBlockingTransaction()}f.reportPanel=new j({title:f.options.reportTitle,success:p,failure:k,neutral:f.neutrals,aborted:h});b.endBlockingTransaction()})}});return e});define("DS/AuthGenericCommands/commands/AuthGenericCmdInsertExisting",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],function(e,d,c,b){const a=true;var f=e.extend(d,{defaultOptions:{},init:function(g){if(g.context){c.setContext(g.context)}this._parent(g,{mode:"exclusive",isAsynchronous:false})},execute:function(){var h=this;var i=c.getSelectedNodes();h._addRootMode=(i.length===0);if(h._addRootMode){var g=h.defaultOptions.chooser.precondFilterAddRoot;h._launchModalChooser(g);return}h._parentNodesFromID=[];h._childrenNameFromID=[];h.defaultOptions.isValidParentSelection(i,function(k){if(k.status===false){for(var q=0,j=k.invalid.length;q<j;q++){var o=k.invalid[q];var p=b.replace(b.get("insert_unsupported_type_parent"),{name:c.getName(o),type:c.getType(o)});c.displayNotification({msg:p,eventID:"error"})}}else{h._parentNodes=i;var m=h.defaultOptions.chooser.precondFilter;h._launchModalChooser(m)}})},_launchModalChooser:function(g){var h=this;c.modalChooser({position:"above_action_bar",source:h.defaultOptions.chooser.source,precond:g,in_apps_callback:h._onSearchDone.bind(h),multiSel:h.defaultOptions.chooser.multiSel})},_onSearchDone:function(h){var g=this;if(g._addRootMode){g._addRoot(h)}else{g._insertExisting(g._parentNodes,h)}},_addRoot:function(h){var g=this;g.defaultOptions.isValidRootSelection(h,function(j){if(j.status===false){var k="";for(var p=0,i=j.invalid.length;p<i;p++){k+=j.invalid[p]["ds6w:label"];if(p!=i-1){k+=", "}}var m=b.replace(b.get("insert_unsupported_root"),{name:k});c.displayNotification({msg:m,eventID:"error"})}if(j.valid.length>0){var o=[];j.valid.forEach(function(l){o.push(l.resourceid)});c.addRoot({pids:o},undefined,true)}})},_optimize:function(r){var m=[];var t=r.length;var q={};var g={};var n=0;var v=0;for(var k=0;k<t;k++){var l=r[k];var u=l.parent.isInstanceOf;if(!q[u]){q[u]={count:1,cacheId:n++};if(l.parent.children){q[u].children=l.parent.children}}else{q[u].count++}var j=l.child.isInstanceOf;if(!g[j]){g[j]={count:1,cacheId:v++}}else{g[j].count++}}var w={};for(var h in q){w[h]={isInstanceOf:h};if(q[h].children){w[h].children=q[h].children}if(q[h].count>1){w[h].cacheId=q[h].cacheId}}var i={};for(var s in g){i[s]={isInstanceOf:s};if(g[s].count>1){i[s].cacheId=g[s].cacheId}}for(k=0;k<t;k++){var l=r[k];var h=l.parent.isInstanceOf;var s=l.child.isInstanceOf;var u={};if(q[h].used===undefined){u=w[h];q[h].used=true}else{u={cacheId:w[h].cacheId}}var j={};if(g[s].used===undefined){j=i[s];g[s].used=true}else{j={cacheId:i[s].cacheId}}m.push({parent:u,child:j})}return m},_insertExisting:function(g,i){var h=this;h.defaultOptions.isValidChildrenSelection(i,function(k){if(k.status===false){var q="",o="";for(var s=0,j=k.invalid.length;s<j;s++){q+=k.invalid[s]["ds6w:label"];o+=k.invalid[s]["ds6w:type"];if(s!=j-1){q+=", ";o+=", "}}var r=b.replace(b.get("insert_unsupported_child_type"),{name:q,type:o});c.displayNotification({msg:r,eventID:"error"});return}for(var s=0,j=k.valid.length;s<j;s++){var p=k.valid[s];var m=p["ds6w:label"];if(m===undefined){m=""}h._childrenNameFromID[p.resourceid]=m}h._processInsertExisting(g,i)})},_processInsertExisting:function(g,i){var h=this;require(["DS/AuthGenericCommands/AuthGenericCmdUtils"],function(v){var n=[];var t=[],F=[];var j=i.length;if(a){console.log("nChild =",j)}for(var E=0;E<j;E++){var y=i[E];var o=y.resourceid;var G=h._childrenNameFromID[o];if(a){console.log("Child["+E+"] is",G)}n.push({isInstanceOf:o,name:G});t.push(o);F.push(G)}var D=[];var A=g.length;if(a){console.log("nParent =",A)}for(var x=0;x<A;x++){var r=g[x];var o=c.getReference(r);if(h._parentNodesFromID[o]===undefined){h._parentNodesFromID[o]=r;var k=b.insert_unsupported_cycle;var l=b.insert_unsupported_itself;var z=c.getName(r);if(a){console.log("Parent["+x+"] is",z)}if(!v.canInstantiate(o,t,k,z,F,l)){return}var s={isInstanceOf:o,name:z};var u=undefined;var C=c.getChildren(r);if(null!==C&&C.length>0){u=[];C.forEach(function(p){var H=c.getRelationID(p);if(H!==undefined){u.push(H)}});s.children=u}D.push(s)}}var B=[];A=D.length;for(x=0;x<A;x++){for(var E=0;E<j;E++){B.push({parent:D[x],child:n[E]})}}var q=h.defaultOptions.chunkSize;var m={chunkSize:q,requests:B,cbOnProgress:function(I,p,H){if(a){console.log("insertMassOperations.cbOnProgress",p)}},cbOnComplete:function(K,Q){c.endBlockingTransaction();var P={},L=[];var N=K.getAnswers();var M="";N.forEach(function(p){var S=p.answer;if(S.status==="success"){var R=S.parent;if(P[R]!==undefined){P[R].references.push(S.child);P[R].instances.push(S.instance)}else{P[R]={references:[S.child],instances:[S.instance],rootNode:h._parentNodesFromID[R]}}}else{L.push(S)}});var I=(L.length>0);if(I){c.displayNotification({msg:b.ERR_003+M,eventID:"error"})}var J=[];for(var H in P){var O=P[H];O.parent=H;O.action="insert";J.push(O)}if(J.length>0){J.forEach(function(p){c.refresh(p)});if(!I){c.displayNotification({msg:b.SUC_003,eventID:"primary"})}}}};if(a){console.log("insertMassOperations need to process",B.length,"operation(s)");console.time("insert-ws")}c.beginBlockingTransaction(b.executing);var w=h._insertMassOperations(m)})},_insertMassOperations:function(g){var h=this;var i=g;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/AuthGenericCommands/AuthGenericCmdUtils"],function(k,j){i.cbOnProcess=function(m,l){if(a){console.log("insertMassOperations.cbOnProcess: size=",l.length)}l=h._optimize(l);k.insertExisting({data:{version:h.defaultOptions.version,bAllOrNothing:h.defaultOptions.bAllOrNothing,operations:l},modeler:h.defaultOptions.modeler,onComplete:function(s){if(a){console.log("insertMassOperations.WS.onComplete")}s=(typeof s==="string")?JSON.parse(s):s;var x=[],q=[];if(s.status==="success"){for(var t=0,r=l.length;t<r;t++){var p=l[t];var v=s.results[t];m.setAnswer(p,v)}}else{if(s.status==="failure"){if(s.messages!==undefined){var u=h._parentNodesFromID[s.parent];var o=c.getName(u);var w=h._childrenNameFromID[s.child];var z={remapErrors:h.defaultOptions.remapErrors,name:w,type:null};var y=j.buildErrorMessage(s.messages,z);var n=b.replace(b.get("insert_failure"),{parent:o,child:w,error:y});c.displayNotification({msg:n,eventID:"error"});m.cancel()}else{}}}},onFailure:function(q,s){if(a){console.log("insertMassOperations.WS.onFailure")}var t=b.ERR_003;var o=(typeof s==="string")?JSON.parse(s):s;try{var n={remapErrors:h.defaultOptions.remapErrors,name:null,type:null};t+=j.buildErrorMessage(o.messages,n)}catch(r){var p=o.messages.length-1;t+=o.messages[p]}c.displayNotification({msg:t,eventID:"error"});m.cancel()}})};return new k.MassChunkedRequests(i)})}});return f});define("DS/AuthGenericCommands/commands/AuthGenericCmdReplaceByExisting",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext"],function(c,b,a){var d=c.extend(b,{defaultOptions:{},init:function(e){if(e.context){a.setContext(e.context)}this._parent(e,{mode:"exclusive",isAsynchronous:false})},execute:function(){var e=this;require(["i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],function(f){var g=a.getSelectedNodes();e.selectedNodes=g;if(g.length){e.defaultOptions.isValidSelection(g[0],function(h){if(h===false){a.displayNotification({eventID:"error",msg:f.replace(f.get("replace_unsupported_type"),{name:a.getName(g[0]),type:a.getType(g[0])})});return}a.modalChooser({position:"above_action_bar",precond:e.defaultOptions.chooser.precondFilter,in_apps_callback:e._onSelectionDone.bind(e),multiSel:e.defaultOptions.chooser.multiSel})})}})},_onSelectionDone:function(f){var e=this;require(["i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json","DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/AuthGenericCommands/AuthGenericCmdUtils"],function(s,p,v){var u=a.getSelectedNodes();if(!u.length){a.displayNotification({eventID:"error",msg:s.replace_error+s.replace(s.get("replace_unaccessible_objet"),{name:a.getName(e.selectedNodes[0])})});return}var g=[];var l=[];u.forEach(function(w){g.push(a.getRelationID(w));l.push(a.getReference(w))});var i=g[0];var r=l[0];var t=u[0];var q=a.getParent(t);var k=a.getReference(q);var j=f[0].resourceid;var n=[j];if(r===j){a.displayNotification({msg:s.operationAborted_Cycle,eventID:"error"});return}if(!v.canInstantiate(k,n,s.operationAborted_Cycle)){return}var o={version:e.defaultOptions.version,bAllOrNothing:e.defaultOptions.bAllOrNothing,operations:[{hasParent:k,instance:i,isInstanceOf:j}]};var h=a.getOrdering(u);var m=f[0];e.defaultOptions.isValidReplacer(m,function(w){if(w===false){a.displayNotification({eventID:"error",msg:s.replace_error+s.replace(s.get("replace_bad_replacer_type"),{name:m["ds6w:label"],type:m["ds6w:type"]})});return}p.replace({data:o,modeler:e.defaultOptions.modeler,onComplete:function(F){var y=UWA.is(F,"string")?JSON.parse(F):F;if(y.status==="success"){var E={action:"replace",operations:[]};for(var D=0,B=y.results.length;D<B;D++){var G=y.results[D];if(G.status==="success"){var C={parent:k,old:G.oldInstance,"new":{reference:G.newReference,instance:G.newInstance},rootNode:q};if(h!==undefined){C.ordering=h[G.oldInstance]}E.operations.push(C);a.displayNotification({eventID:"primary",msg:s.replace_success})}else{var z=s.replace_error+v.buildErrorMessage(G.messages,{remapErrors:e.defaultOptions.remapErrors});a.displayNotification({eventID:"error",msg:z})}}a.refresh(E)}else{var G=y.results[0];var A=u[0];var x=(A!==undefined)?a.getName(A):"?";var H={remapErrors:e.defaultOptions.remapErrors,name:x,type:null};var z=v.buildErrorMessage(G.messages,H);a.displayNotification({eventID:"error",msg:s.replace_error+z})}},onFailure:function(z,B){var C=s.replace_error;try{var y={remapErrors:e.defaultOptions.remapErrors,name:a.getName(u[0]),type:null};var x=JSON.parse(B);C+=v.buildErrorMessage(x.messages,y)}catch(A){C+=z.message}a.displayNotification({eventID:"error",msg:C})}})})})}});return d});define("DS/AuthGenericCommands/commands/AuthGenericCmdReorder",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext"],function(c,b,a){var d=c.extend(b,{defaultOptions:{},init:function(e){if(e.context){a.setContext(e.context)}this._parent(e,{mode:"exclusive",isAsynchronous:false})},execute:function(){var e=this;require(["i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],function(g){var j=a.getSelectedNodes(),f;if(j.length===1){var h=j[0];e.defaultOptions.isValidParentSelection(h,function(i){if(i.status===false){var m=g.SEL_004;m=m.replace(/{type}/g,a.getType(j[0]));a.displayNotification({msg:m,eventID:"error"})}else{var k=h.getChildren();if(k&&k.length>1){k=k.slice();var l=[];e.defaultOptions.isChildrenOrderable(k,function(n){for(f=0;f<k.length;f++){if(n.status[f]===false){k.splice(f,1);n.status.splice(f,1);l.push(f);f--}}if(k.length>1){a.getContext().isPartiallyExpanded(h,function(o){if(o){a.displayNotification({msg:g.reorder_view_partially_expanded,eventID:"warning"})}e._launchReorderUI(h,k,l)})}else{a.displayNotification({msg:g.SEL_003,eventID:"error"})}})}else{a.displayNotification({msg:g.SEL_003,eventID:"error"})}}})}else{if(j.length>1){a.displayNotification({msg:g.SEL_005,eventID:"error"})}}})},_launchReorderUI:function(g,f,i,e){var h=this;require(["i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json","DS/AuthGenericCommands/views/AuthGenericDlgReorder","DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/AuthGenericCommands/AuthGenericCmdUtils","UWA/Core"],function(l,m,j,k,n){h.reorderDlg=new m({parent:g,children:f,css_style:"maximized",events:{onApply:function(){}},onReorderDone:function(p){var r=[],q;var s=p.length;for(q=0;q<s;q++){var u=p[q];r.push(u.options.grid.relationid)}var t={version:"1.0",order:{type:"RTInstance",count:s,children:r}};var o=function(z,w){if(!z.hasChildren()){return}var A=z.getState();z.prepareUpdate();var y=z.removeChildren();for(q=0;q<i.length;q++){z.addChild(y.splice(i[q],1))}for(var x=0;x<y.length;x++){var v=y.find(function(B){return(B.options.relationid===w[x].options.grid.relationid)});z.addChild(v)}z.setState({state:A});z.pushUpdate()};j.reorder({data:t,modeler:h.defaultOptions.modeler,optionalURL:g.getID(),onComplete:function(x){var v=n.is(x,"string")?JSON.parse(x):x;if(v.status==="success"){a.author(true);if(!Array.prototype.find){Array.prototype.find=function(y){var C=Object(this),A=C.length>>>0,z=arguments[1],B;for(q=0;q<A;q++){B=C[q];if(y.call(z,B,q,C)){return B}}return undefined}}var w=a.getRoots();w.forEach(function(y){var z=y.getNodesById(g.getID());z.forEach(function(A){o(A,p)})});a.displayNotification({msg:l.SUC_005,eventID:"primary"})}else{a.displayNotification({msg:l.ERR_005+v.message,eventID:"error"})}},onFailure:function(x,z){var A=l.ERR_005;try{var w={remapErrors:h.defaultOptions.remapErrors,name:null,type:null};var v=JSON.parse(z);A+=k.buildErrorMessage(v.messages,w)}catch(y){A+=x.message}a.displayNotification({msg:A,eventID:"error"})}})}})})}});return d});define("DS/AuthGenericCommands/AuthGenericCmdUtils",["DS/AuthGenericCommands/AppContext"],function(a){var b={checkNoParentWithChild:function(k){if(!a._is2DContext()){return}var h=k.length;for(var f=0;f<h;f++){var d=k[f];for(var e=0;e<h;e++){if(f!==e){var c=k[e];var g=c.getParent();while(g){if(g===d){return false}g=g.getParent()}}}}return true},canInstantiate:function(l,o,k,h,c,d){var e=k;if(a.isExternalContext&&a.getContext().canInstantiate!==undefined){return a.getContext().canInstantiate(l,o,k)}for(var j=0;j<o.length;j++){var m=this.searchForCycle(l,o[j]);if(k&&m){var e=k;var g=(h!==undefined)&&(e.indexOf("{parent}")!==-1);var f=(c!==undefined)&&(e.indexOf("{child}")!==-1);if(g&&f){var n=c[j];if(n===h){e=d;e=e.replace(/{name}/g,h)}else{e=e.replace(/{parent}/g,h);e=e.replace(/{child}/g,n)}}a.displayNotification({msg:e,eventID:"error"});return false}}return true},searchForCycle:function(k,o,l){var n=false;if(!Array.isArray(l)){l=[]}var h=a.getNodesById(k);for(var g=0;g<h.length&&!n;g++){var c=h[g];var e=a.getParents(c);if(e){for(var f=e.length-1;f>=0&&!n;f--){var m=e[f];var d=a.getReference(m);if(l.indexOf(d)<0){n=this.searchForCycle(d,o,l);if(!n){l.push(d)}}}}if(!n){n=a.isDescendantOf(c,o)}}return n},buildErrorMessage:function(h,m){var e=null,k=null,c=null,f=null;if((m.remapErrors!==undefined)&&(m.remapErrors!==null)){var g=m.remapErrors.length;for(var j=0;j<g;j++){var d=new RegExp(m.remapErrors[j].modeler,"i");if(d.test(h)){e=m.remapErrors[j].user;k=((m.remapErrors[j].type!==undefined)&&(m.remapErrors[j].type!==null))?m.remapErrors[j].type:null;c=((m.remapErrors[j].name!==undefined)&&(m.remapErrors[j].name!==null))?m.remapErrors[j].name:null;break}}}if(e===null){e=h[h.length-1]}c=(c!==null)?c:m.name;if((c!==undefined)&&(c!==null)){e=e.replace(/{name}/g,c)}k=(k!==null)?k:m.type;if((k!==undefined)&&(k!==null)){e=e.replace(/{type}/g,k)}return e}};return b});define("DS/AuthGenericCommands/commands/AuthGenericCmdReplaceProductConfiguration",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json","DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/AuthGenericCommands/AuthGenericCmdUtils"],function(e,d,c,b,g,f){const a=sessionStorage.getItem("PSWEBR2Debeug");var h=e.extend(d,{defaultOptions:{},init:function(i){if(i.context){c.setContext(i.context)}this._parent(i,{mode:"exclusive",isAsynchronous:false})},execute:function(){var i=this;i.selectedNodes=c.getSelectedNodes();if(i.selectedNodes.length){i.defaultOptions.isValidSelection(i.selectedNodes[0],function(j){if(j===false){c.displayNotification({eventID:"error",msg:b.replace(b.get("replace_unsupported_type"),{name:c.getName(i.selectedNodes[0]),type:c.getType(i.selectedNodes[0])})});return}c.modalChooser({position:"above_action_bar",precond:i.defaultOptions.chooser.precondFilter,in_apps_callback:i._onSearchDone_Children.bind(i),multiSel:i.defaultOptions.chooser.multiSel})})}},_onSearchDone_Children:function(k){var j=this;var i=j._launchProductConfigurationChooser.bind(j);j._checkValidParentAndChildren(k,i)},_launchProductConfigurationChooser:function(){var k=this;var m={data:{},onComplete:function(q){var p=null;var o=(typeof q==="string")?JSON.parse(q):q;if(o.version&&o.version==="1.1"){if(o.contexts.content.results.length>0){p=o.contexts.content.results[0].physicalID}}k._launchProductConfigurationChooser2(p)},onFailure:function(o,p){if(a){console.log("getConfiguredObjectInfo.onFailure, serverError :"+p)}k._launchProductConfigurationChooser2(null)}};var l=k.newReference.resourceid;var i="/resources/modeler/configuration/navigationServices/getConfiguredObjectInfo/pid:"+l;var n="GET";var j=["cfgCtxt","1","enabledCriteria","1"];g.callWS(m,i,n,j)},_launchProductConfigurationChooser2:function(k){var i=this;if(k===null){var j=b.get("replacePC_noPCFound");c.displayNotification({msg:j,eventID:"error"})}else{require(["DS/CfgBaseUX/scripts/CfgSearchConfiguration"],function(l){if(a){console.log("CFG ModelId:",k)}var o=false;var t=new l(o);var q="";var p="Product Configuration";var n="";var s=i._onSearchDone_ProductConfiguration.bind(i);var r="(based_95_on_95_model_95_pid:"+k+")";var m="";t.activate(q,p,n,s,r,m)})}},_onSearchDone_ProductConfiguration:function(j){var i=this;i._productConfigurationFromSearch=j[0];var k=j[0].id;i._childrenproductConfigurationId=k;i._processReplaceExisting()},_checkValidParentAndChildren:function(l,i){var k=this;k.selectedNodes=c.getSelectedNodes();if(!k.selectedNodes.length){c.displayNotification({eventID:"error",msg:b.ERR_ReplaceProductCconfiguration+b.replace(b.get("replace_unaccessible_objet"),{name:c.getName(k.selectedNodes[0])})});return}var n=[];k.selectedNodes.forEach(function(o){n.push(c.getRelationID(o))});k.oldInstance=n[0];var j=k.selectedNodes[0];k.parentNode=c.getParent(j);k.parentReference=c.getReference(k.parentNode);k.newReference=l[0];var m=[k.newReference.resourceid];if(!f.canInstantiate(k.parentReference,m,b.operationAborted_Cycle)){return}if(typeof i==="function"){i()}},_processReplaceExisting:function(){var j=this;var k={version:j.defaultOptions.version,bAllOrNothing:j.defaultOptions.bAllOrNothing,operations:[{hasParent:j.parentReference,instance:j.oldInstance,isInstanceOf:j.newReference.resourceid,productConfigurationId:j._childrenproductConfigurationId}]};var l=c.getOrdering(j.selectedNodes);var i=j.newReference;j.defaultOptions.isValidReplacer(i,function(m){if(m===false){c.displayNotification({eventID:"error",msg:b.ERR_ReplaceProductCconfiguration+b.replace(b.get("replace_bad_replacer_type"),{name:i["ds6w:label"],type:i["ds6w:type"]})});return}g.replace({data:k,modeler:j.defaultOptions.modeler,onComplete:function(v){var o=UWA.is(v,"string")?JSON.parse(v):v;var w=null,p=null;if(o.status==="success"){var u={action:"replace",operations:[]};for(var t=0,r=o.results.length;t<r;t++){w=o.results[t];if(w.status==="success"){var s={parent:j.parentReference,old:w.oldInstance,"new":{reference:w.newReference,instance:w.newInstance},productConfigurationId:w.productConfigurationId,rootNode:j.parentNode};if(l!==undefined){s.ordering=l[w.oldInstance]}u.operations.push(s);c.displayNotification({eventID:"primary",msg:b.SUC_ReplaceProductCconfiguration})}else{p=b.ERR_ReplaceProductCconfiguration+f.buildErrorMessage(w.messages,{remapErrors:j.defaultOptions.remapErrors});c.displayNotification({eventID:"error",msg:p})}}c.refresh(u)}else{w=o.results[0];var q=j.selectedNodes[0];var n=(q!==undefined)?c.getName(q):"?";var x={remapErrors:j.defaultOptions.remapErrors,name:n,type:null};p=f.buildErrorMessage(w.messages,x);c.displayNotification({eventID:"error",msg:b.ERR_ReplaceProductCconfiguration+p})}},onFailure:function(q,s){var p=null,o=null;var t=b.ERR_ReplaceProductCconfiguration;try{var n={remapErrors:j.defaultOptions.remapErrors,name:c.getName(j.selectedNodes[0]),type:null};if(typeof s==="string"){o=JSON.parse(s)}else{if(typeof s==="object"){o=s}}if(o.messages){p=o.messages}else{if(o.results&&o.results[0]&&o.results[0].messages){p=o.results[0].messages}}t+=f.buildErrorMessage(p,n)}catch(r){t+=q.message}c.displayNotification({eventID:"error",msg:t})}})})}});return h});define("DS/AuthGenericCommands/views/AuthGenericTLVRevisionUpdate",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/AuthGenericCommands/AppContext","DS/Controls/ComboBox","DS/UIKIT/Spinner","DS/ApplicationFrame/CommandsManager","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerViews/VersionExplorerModal","DS/WidgetServices/WidgetServices","i18n!DS/AuthGenericCommands/assets/nls/AuthDlgRevisionUpdate.json"],function(g,b,j,m,e,c,k,i,d,a,n,f,l,h,q,p){var o=b.extend(j,{name:"GenericTLVRevisionUpdate",options:{},_treeListView:null,_isDataReady:false,_isTreeListViewReady:false,_isTreeDocumentReady:false,_revisions:undefined,compareCmd:a.getCommand("CompareHdr",widget),_myVersionExplorer:null,init:function(r){this._parent(r);this.setOptions(r);this._createTreeListView(r.renderTo)},_launchCompare:function(w){var u=this;var v=w._options.grid;var r=v.actionSelected;var s=u._findCorrespondingAction(r);var t=[v.physicalid,v[s].id];u.compareCmd.options.CompareIds=t;u.compareCmd.execute_CompareHdr()},_resetAction:function(r){this._launchAction(r,p.ReplaceActionNone)},_createTreeListView:function(r){var v=this;var t={apiVersion:2,height:"auto",resize:{columns:true,rows:true},selection:{nodes:true,rowHeaders:false,columnHeaders:false,unselectAllOnEmptyArea:true,toggle:false,canMultiSelect:true,enableListSelection:true,preSelection:true},enableDragAndDrop:false,enableScrollOnDrag:false,enableTreeColumnEllipsisOverflow:false,enableActiveUI:true,enableKeyboardNavigation:true,enableExpandOnDoubleClick:true,keymaps:{"ctrl+a":"treelistview:select-all"},onContextualEvent:{callback:function u(z){var y=[];if(z.treeview.cellModel&&!z.treeview.cellModel.options.isHeader){var A=z.treeview.nodeModel;if(!A.isSelected()){A.select(true)}if(!A.isSelected()){return}if(v._isTreeListMode()){y.push({type:"PushItem",title:p.TreeListViewContextualMenuSelectAllChildren,icon:"url("+c.getWebappsAssetUrl("AuthGenericCommands","icons/I_SelectAll.png")+")",action:{callback:function(D){var C=[];var B=v._treeListView.getDocument().getSelectedNodes();B.forEach(function(E){if(C.indexOf(E)===-1){C.push(E);E.getAllDescendants().forEach(function(F){F.isSelected()?null:F.select();C.push(F)})}})}}});y.push({type:"PushItem",title:p.TreeListViewContextualMenuSelectChildren,icon:"url("+c.getWebappsAssetUrl("AuthGenericCommands","icons/I_SelectChildren.png")+")",action:{callback:function(C){var B=v._treeListView.getDocument().getSelectedNodes();B.forEach(function(E){var D=E.getChildren();if(D&&D.length){D.forEach(function(F){F.isSelected()?null:F.select()})}})}}})}var x=(A._options.grid.revisionPreview&&A._options.grid.revisionPreview.length>0&&z.treeview.manager.getSelectedRows().length===1)?"enabled":"disabled";y.push({type:"PushItem",title:p.TreeListViewContextualMenuCompareRevisions,icon:"url("+c.getWebappsAssetUrl("AuthGenericCommands","icons/I_Compare.png")+")",state:x,action:{callback:function(B){v._launchCompare(A)}}});y.push({type:"PushItem",title:p.TreeListViewContextualMenuReplaceby,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-part-replace"},state:v._isDataReady&&!(v._isTreeListMode()&&A.isRoot()&&v._treeListView.getDocument().getSelectedNodes().length===1)?"enabled":"disabled",submenu:[{type:"PushItem",title:p.ReplaceActionLatest,action:{callback:function(C){var B=v._treeListView.getDocument().getSelectedNodes();v._launchActions(B,p.ReplaceActionLatest)}}},{type:"PushItem",title:p.ReplaceActionLatestStable,action:{callback:function(C){var B=v._treeListView.getDocument().getSelectedNodes();v._launchActions(B,p.ReplaceActionLatestStable)}}},{type:"PushItem",title:p.ReplaceActionLatestReleased,action:{callback:function(C){var B=v._treeListView.getDocument().getSelectedNodes();v._launchActions(B,p.ReplaceActionLatestReleased)}}}]});y.push({type:"PushItem",title:p.TreeListViewContextualMenuResetAction,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reset"},state:v._isDataReady&&!(v._isTreeListMode()&&A.isRoot()&&v._treeListView.getDocument().getSelectedNodes().length===1)&&!(v._treeListView.getDocument().getSelectedNodes().length===1&&!v._isActionRequired(A))?"enabled":"disabled",action:{callback:function(D){var B=z.treeview.manager;var C=B.getSelectedRows();C.forEach(function(F){var E=B.getRowModel(F).tree;v._resetAction(E)})}}})}return y}},columns:[{text:p.TreeListViewHeaderName,dataIndex:"tree",width:275,isSortable:false,isEditable:false,isDraggable:true},{text:p.TreeListViewHeaderRevisionCurrent,dataIndex:"revisionCurrent",width:65,isSortable:false,isEditable:false,isDraggable:true},{text:p.TreeListViewHeaderMaturityCurrent,dataIndex:"maturityCurrent",width:100,isSortable:false,isEditable:false,isDraggable:true},{text:p.TreeListViewHeaderType,dataIndex:"type",width:100,isSortable:false,isEditable:false,isDraggable:true},{text:p.TreeListViewHeaderResponsible,dataIndex:"responsible",width:100,isSortable:false,isEditable:false,isDraggable:true},{text:"",dataIndex:"candidate",width:40,minWidth:30,maxWidth:50,isSortable:false,isEditable:false,isDraggable:true,onCellRequest:function(A){if(!A.isHeader){if(!v._isTreeListMode()||!A.nodeModel.isRoot()){var y=A.nodeModel._options.grid.candidate;var z;if(y&&y.length>0){z=A.cellView.reuseCellContent("candidateLoaded");if(z){v._drawCandidate(z,y)}}else{z=A.cellView.reuseCellContent("candidateLoading")}var x=v._getTooltipCandidates(A);A.cellView._setTooltip(A.cellView.elements.container,{longHelp:x})}}else{A.cellView._setTooltip(A.cellView.elements.container,{longHelp:p.TreeListViewHeaderCandidate})}}},{text:p.TreeListViewHeaderAction,dataIndex:"action",width:125,isSortable:false,isEditable:true,isDraggable:true,onCellRequest:function(A){if(!A.isHeader){if(!v._isTreeListMode()||!A.nodeModel.isRoot()){var x=A.nodeModel._options.grid.action;var z=A.cellView.reuseCellContent("action");if(z){z.disabled=!A.nodeModel.options.grid.isEnabled;z.elementsList=x;z.currentValue=A.nodeModel.options.grid.actionSelected;A.nodeModel.options.grid.actionComboBox=z;var y=v._getTooltipCandidates(A);A.cellView._setTooltip(A.cellView.elements.container,{longHelp:y})}}}},setValue:function(x){},onCellChange:function(y){var x=y.event.target.dsModel?y.event.target.dsModel.currentValue:y.event.ODTTarget.dsModel.currentValue;v._launchAction(y.nodeModel,x);return x}},{text:p.TreeListViewHeaderRevisionPreview,dataIndex:"revisionPreview",width:65,isSortable:false,isEditable:false,isDraggable:false,setValue:function(x){x.nodeModel.options.grid[x.dataIndex]=x.value;x.manager.updateRowViewWithException(x.nodeModel,x.dataIndex)}},{text:p.TreeListViewHeaderMaturityPreview,dataIndex:"maturityPreview",width:100,isSortable:false,isEditable:false,isDraggable:false}]};if(this._isTreeListMode()){t.columns.unshift({text:"",dataIndex:"isModified",width:30,minWidth:30,maxWidth:30,isSortable:false,isEditable:false,isDraggable:true,onCellRequest:function(A){if(!A.isHeader){var x=A.nodeModel._options.grid.isModified;if(x&&x.length>0){var z=A.cellView.reuseCellContent("isModified");var B=undefined;if(z){switch(x){case"yes_editable":B=c.getWebappsAssetUrl("AuthGenericCommands","icons/22/I_ParentModified.bmp");break;case"yes_not_editable":B=c.getWebappsAssetUrl("AuthGenericCommands","icons/22/I_ParentUneditable.bmp");break;default:B=""}z.src=B}}var y="";if(A.nodeModel.options.grid.isModified==="yes_editable"){y=p.TreeListViewTooltipCellIsModifiedAvailable}else{if(A.nodeModel.options.grid.isModified==="yes_not_editable"){y=p.TreeListViewTooltipCellIsModifiedForbidden}}y=y.replace("{objectName}",A.nodeModel.getLabel());A.cellView._setTooltip(A.cellView.elements.container,{longHelp:y})}else{A.cellView._setTooltip(A.cellView.elements.container,{longHelp:p.TreeListViewTooltipHeaderIsModified})}}})}this._treeListView=new m(t);this._treeListView.getManager().onReady(function(){v._isTreeListViewReady=true;v.checkAndLaunchTreeNodeModelUpdate()});this._registerAllReusableCellContent();var s=new e({shouldAcceptDrop:false,shouldAcceptDrag:false,shouldBeSelected:function(x){return x.options.grid.isEnabled}});var w=s.onUpdate(function(){this.removeEventListener(w);v._isTreeDocumentReady=true;v.checkAndLaunchTreeNodeModelUpdate()});this._fillTreeNodeModel(s);this._treeListView.getManager().loadDocument(s);this._treeListView.inject(r)},_getTooltipCandidates:function(t){var s=undefined;var r=[];if(t.nodeModel.options.grid.Latest){r.push(p.ReplaceActionLatest)}if(t.nodeModel.options.grid.LatestStable){r.push(p.ReplaceActionLatestStable)}if(t.nodeModel.options.grid.LatestReleased){r.push(p.ReplaceActionLatestReleased)}if(t.nodeModel.options.grid.action.length>1){r.push(p.ReplaceActionByRevision)}if(r.length>0){s=p.TreeListViewTooltipCellCandidateAvailable;s=s.replace("{candidateList}",r.join("\n"))}else{s=p.TreeListViewTooltipCellCandidateNone}s=s.replace("{objectName}",t.nodeModel.getLabel());return s},_fillTreeNodeModel:function(r){var s=this;require(["DS/Tree/TreeNodeModel"],function(y){var x=s.options.roots;var v=[];var w=[];r.prepareUpdate();var u=function(E){var D=k.getRelationID(E);var F=k.getReference(E);var A=false;if(w.indexOf(D)>=0){A=true}var C={isModified:"",revisionCurrent:E.options.grid["ds6wg:revision"],revisionPreview:"",maturityCurrent:"",maturityPreview:"",type:E.options.grid["ds6w:type"],responsible:E.options.grid["ds6w:responsible"],candidate:"",action:"",relationid:D,physicalid:F,isEnabled:true,hasOtherInstances:A};if(s._isFlatListMode()){var z=k.getParent(E);C.parent=k.getReference(z)}var B=new y({label:E.options.label,badges:E.options.badges,icons:E.options.icons,grid:C});return B};var t=function(B,z){var A=z.getChildren(z)||[];A.forEach(function(D){if(D.options.relationtype!=="VPMRepInstance"&&D.options.type!=="3DShape"&&D.options.type!=="Drawing"){var C=u(D);if(D.isExpanded()){t(C,D)}B.addChild(C)}});B.expandAll()};x.forEach(function(z){z.getAllDescendants().forEach(function(B){var A=k.getRelationID(B);if(v.indexOf(A)>=0){w.push(A)}else{v.push(A)}})});x.forEach(function(A){var z=u(A);if(s._isTreeListMode()){t(z,A);z.expandAll()}else{if(s._isFlatListMode()){}else{console.log("commandMode option not defined !")}}r.addRoot(z)});r.pushUpdate()})},_isFlatListMode:function(){return(this.getOption("mode")==="FlatList")},_isTreeListMode:function(){return(this.getOption("mode")==="TreeList")},checkAndLaunchTreeNodeModelUpdate:function(r){if(r){this._revisions=r;this._isDataReady=true}if(this._revisions&&this._isTreeListViewReady&&this._isTreeDocumentReady){this._updateTreeNodeModel(this._revisions)}},_updateTreeNodeModel:function(u){var s=this._treeListView.getDocument();var t=function(w,y){var x={iconName:undefined,actions:[]};x.actions.push(p.ReplaceActionNone);if(y.LATEST){x.iconName="Latest";x.actions.push(p.ReplaceActionLatest)}if(y.STABLE){x.iconName===undefined?x.iconName="Stable":x.iconName+="+Stable";x.actions.push(p.ReplaceActionLatestStable)}if(y.RELEASED){x.iconName===undefined?x.iconName="Released":x.iconName+="+Released";x.actions.push(p.ReplaceActionLatestReleased)}if(x.iconName===undefined){x.iconName="None"}if(x.iconName!=="None"||(y.CURRENT.indexIn+y.CURRENT.indexOut)>0){x.actions.push(p.ReplaceActionByRevision)}return x};var v=function(w,y){if(y===undefined){return}var x=t(w,y);w.updateOptions({grid:{maturityCurrent:y.CURRENT.maturityNLS,maturityType:y.CURRENT.maturity,revisionCurrent:y.CURRENT.revision,Latest:y.LATEST?y.LATEST:undefined,LatestStable:y.STABLE?y.STABLE:undefined,LatestReleased:y.RELEASED?y.RELEASED:undefined,candidate:x.iconName,action:x.actions,actionSelected:x.actions[0],}})};var r=function(w){var x=w.getChildren();if(x!==null&&x.length>0){x.forEach(function(z){var y=u[z._options.grid.physicalid];v(z,y);r(z)})}};s.prepareUpdate();s.getRoots().forEach(function(x){var w=u[x._options.grid.physicalid];v(x,w);r(x)});s.pushUpdate()},_launchAction:function(s,t){var u={};switch(t){case p.ReplaceActionNone:u.maturity="";u.revision="";u.newName="";break;case p.ReplaceActionLatest:u.maturity=s._options.grid.Latest?s._options.grid.Latest.maturityNLS:undefined;u.revision=s._options.grid.Latest?s._options.grid.Latest.revision:undefined;u.newName=s._options.grid.Latest?s._options.grid.Latest.displayName:undefined;break;case p.ReplaceActionLatestStable:u.maturity=s._options.grid.LatestStable?s._options.grid.LatestStable.maturityNLS:undefined;u.revision=s._options.grid.LatestStable?s._options.grid.LatestStable.revision:undefined;u.newName=s._options.grid.LatestStable?s._options.grid.LatestStable.displayName:undefined;break;case p.ReplaceActionLatestReleased:u.maturity=s._options.grid.LatestReleased?s._options.grid.LatestReleased.maturityNLS:undefined;u.revision=s._options.grid.LatestReleased?s._options.grid.LatestReleased.revision:undefined;u.newName=s._options.grid.LatestReleased?s._options.grid.LatestReleased.displayName:undefined;break;case p.ReplaceActionByRevision:u.maturity="";u.revision="";u.newName="";if(s._options.grid.physicalid!==undefined){this._launchVersionExplorer(s)}break;default:break}var r={maturityPreview:u.maturity!==undefined?u.maturity:s._options.grid.maturityPreview,revisionPreview:u.revision!==undefined?u.revision:s._options.grid.revisionPreview,actionSelected:s._options.grid.action.indexOf(t)>=0?t:s._options.grid.actionSelected,expectedNewName:u.newName!==undefined?u.newName:s._options.grid.expectedNewName};if(t!==p.ReplaceActionByRevision){this._updateNodesAfterAction(s,r)}return u.revision!==undefined},_updateNodesAfterAction:function(u,s){var t=this;var r=this._getallSameNodes(u);r.forEach(function(v){v.updateOptions({grid:s});var w=t._isActionRequired(v);t._enableChildren(v,!w);if(w){t._clearParentsAction(v);t._enable(v,true)}t._updateParentStatus(v);t.options.cbActionAvailable(t._isActionRequired())})},_launchVersionExplorer:function(r){this._myVersionExplorer=new n({versionGraphContainer:null,selectionMode:l.SELECTION_MODES.SINGLE_SELECT_ONLY,widget:null});this._myVersionExplorer.disableDrag();this._myVersionExplorer.showDialog({x:100,y:100},null,true);f.loadUserSettingsPromise({displayMode:l.DISPLAY_MODES.SUBWAY_VIEW,displayLegend:true},true);this._myVersionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:r._options.grid.physicalid,tenantId:q.getTenantID(),securityContext:k.getSetting("securityContext"),onComplete:function(){},dataModelType:l.DATA_MODEL_TYPES.MODEL_HISTORY});this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",this._onVersionExplorerModalOK.bind(this,r),false);this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",this._onVersionExplorerModalCancel.bind(this,r),false);this._dlgVersionExplorer=h._dlg;if(h._dlg&&h._dlg.rightButtons){h._dlg.rightButtons.addEventListener("click",this._onVersionExplorerModalCancel.bind(this,r))}},_onVersionExplorerModalCancel:function(s){var r={actionSelected:s._options.grid.actionSelected};this._updateNodesAfterAction(s,r)},_onVersionExplorerModalOK:function(s){var r;var t=this._myVersionExplorer.getSelectedNodes().shift();if(t&&t._options.data.physicalid!=s._options.grid.physicalid){r={maturityPreview:t._options.grid.maturity_nls,revisionPreview:t._options.data.revision,actionSelected:p.ReplaceActionByRevision,expectedNewName:t._options.data.name,ByRevision:{id:t._options.data.physicalid,indexIn:0,indexOut:0,maturity:t._options.grid.maturity,maturityNLS:t._options.grid.maturity_nls,revision:t._options.data.revision}}}else{r={actionSelected:s._options.grid.actionSelected}}this._updateNodesAfterAction(s,r)},_launchActions:function(s,u){var x=this;var r=function(C,B){var A=B.getAllDescendants();A.forEach(function(D){C.forEach(function(F,E){if(D===F){C.splice(E,1)}})})};var v=x._treeListView.getDocument();var y=0;var z=s.length;v.prepareUpdate();s.forEach(function(A){if(!x._isTreeListMode()||!A.isRoot()){if(x._launchAction(A,u)){y++}if(x._isActionRequired(A)){r(s,A)}}});v.pushUpdate();var t=undefined;t=y===z?p.ReplaceMultiInfoSuccess:y>0?p.ReplaceMultiInfoPartial:p.ReplaceMultiInfoFailure;t=t.replace("{candidatesCount}",y);t=t.replace("{selectedNodes}",z);t=t.replace("{action}",u);var w={level:"info",message:t,sticky:false};if(x.options.cbInfoMessage){x.options.cbInfoMessage(t)}},_updateParentStatus:function(y){var x=this;var r=y.getParent();var w=false;var v=r.getChildren();for(var u=0;u<v.length;u++){if(v[u]._options.grid.revisionPreview){w=true;break}}var t="no";if(w){var s=r.options.grid.maturityType;if(s!=="FROZEN"&&s!=="RELEASED"&&s!=="OBSOLETE"){t="yes_editable"}else{t="yes_not_editable"}}r.updateOptions({grid:{isModified:t}});if(r.options.grid.actionComboBox&&r.options.grid.actionComboBox.elements&&r.options.grid.actionComboBox.elements.container.attributes.focused){r.options.grid.actionComboBox.elements.container.attributes.removeNamedItem("focused")}},_getallSameNodes:function(s){var w=this;if(w._isFlatListMode()){return[s]}var y=[];var x=s._options.grid.relationid;var z=this._treeListView.getDocument().getRoots();for(var u=0;u<z.length;u++){var v=z[u].getAllDescendants();if(v&&v.length>0){for(var t=0;t<v.length;t++){var r=v[t];if(r._options.grid.hasOtherInstances&&r._options.grid.relationid===x){y.push(r)}}}}return y.length>0?y:[s]},_enableChildren:function(r,s){var u=this;var t=r.getChildren();if(t&&t.length>0){t.forEach(function(x){var w=u._getallSameNodes(x);var v=true;w.forEach(function(y){if(s&&u._isActionRequired(y.getParent(),true)){v=false}});if(v){w.forEach(function(y){u._enable(y,s);if(!s){u._removeAction(y)}})}u._enableChildren(x,s)})}},_enable:function(s,r){s.updateOptions({grid:{actionComboBox:{disabled:!r},isEnabled:r}});if(!r&&s.isSelected()){s.unselect()}},_clearParentsAction:function(t){var s=this;var r=t.getParents();if(r&&r.length){r.forEach(function(v){var u=true;s._removeAction(v,u)})}},_removeAction:function(s,r){s.updateOptions({grid:{maturityPreview:"",revisionPreview:"",actionSelected:p.ReplaceActionNone}});if(r){this._enable(s,r)}this._updateParentStatus(s)},_isActionRequired:function(s,x){var y=this;if(!s){var A=this._treeListView.getDocument().getRoots();for(var v=0;v<A.length;v++){if(y._isFlatListMode()&&y._isActionRequired(A[v])){return true}var w=A[v].getAllDescendants();if(w&&w.length>0){for(var u=0;u<w.length;u++){var r=w[u];if(y._isActionRequired(r)){return true}}}}return false}else{if(s._options.grid.actionSelected!==p.ReplaceActionNone){return true}if(x){var z=s.getParents();for(var t=0;t<z.length;t++){if(y._isActionRequired(z[t])){return true}}}return false}},_findCorrespondingAction:function(r){switch(r){case p.ReplaceActionLatest:return"Latest";case p.ReplaceActionLatestStable:return"LatestStable";case p.ReplaceActionLatestReleased:return"LatestReleased";case p.ReplaceActionByRevision:return"ByRevision";case p.ReplaceActionNone:return"None";default:return"None"}return"None"},_registerAllReusableCellContent:function(){var r=this._treeListView.getManager();r.registerReusableCellContent({id:"isModified",buildContent:function(){return new g.Element("img",{"class":"isModifiedIcon"})}});r.registerReusableCellContent({id:"candidateLoading",buildContent:function(){var s=new g.Element("div",{"class":"candidateLoading"});var t=new d().inject(s).show();return s}});r.registerReusableCellContent({id:"candidateLoaded",buildContent:function(){var t=new g.Element("div",{"class":"candidateContainer",styles:{width:"inherit",height:"inherit",padding:"inherit"}});var u=g.createElement("div",{"class":"candidateLatest"});var v=g.createElement("div",{"class":"candidateStable"});var s=g.createElement("div",{"class":"candidateReleased"});t.appendChild(u);t.appendChild(v);t.appendChild(s);return t}});r.registerReusableCellContent({id:"action",buildContent:function(){var s=this;return new i({elementsList:"",touchMode:false,placeholder:p.TreeListViewReplacePlaceholder,enableSearchFlag:false,actionOnClickFlag:false,selectedIndex:-1,currentValue:""})}})},_drawCandidate:function(u,t){var r=u.querySelector(".candidateLatest");const s="available";if(r!=null){t.contains("Latest")?r.addClassName(s):r.removeClassName(s)}r=u.querySelector(".candidateStable");if(r!=null){t.contains("Stable")?r.addClassName(s):r.removeClassName(s)}r=u.querySelector(".candidateReleased");if(r!=null){t.contains("Released")?r.addClassName(s):r.removeClassName(s)}},getReplaceList:function(){var s=this;var t=[];var r=this._treeListView.getDocument().getRoots();r.forEach(function(u){if(s._isTreeListMode()){s._addRecursivelyReplaceCouple(u,t)}else{s._addReplaceCouple(u,t)}});return t},_addRecursivelyReplaceCouple:function(t,u){var s=this;var r=t.getChildren();if(r&&r.length>0){r.forEach(function(v){s._addReplaceCouple(v,u);s._addRecursivelyReplaceCouple(v,u)})}},_addReplaceCouple:function(s,x){var A=this;var w=s.options.grid.actionSelected;var y=this._findCorrespondingAction(w);var t=undefined;if(s.options.grid[y]){t=s.options.grid[y].id;if(t){var r=s.options.label+" "+s.options.grid.revisionCurrent;var z=s.options.grid.expectedNewName+" "+s.options.grid.revisionPreview;var C=A._isTreeListMode()?s.getParent().options.grid.physicalid:s.options.grid.parent;var B=-1;if(x&&x.length>0){for(var v=0;v<x.length;v++){var u=x[v];if(u.instance===s.options.grid.relationid){B=v;break}}}if(B<0){x.push({hasParent:C,instance:s.options.grid.relationid,isInstanceOf:t,oldName:r,newName:z})}}}}});return o});define("DS/AuthGenericCommands/views/AuthGenericDlgRevisionUpdate",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Controls/ProgressBar","DS/UIKIT/Alert","DS/AuthGenericCommands/views/AuthGenericTLVRevisionUpdate","DS/Logger/Logger","i18n!DS/AuthGenericCommands/assets/nls/AuthDlgRevisionUpdate.json"],function(e,a,h,g,i,j,c,f,l,b,k){var d=a.extend(h,{name:"GenericDlgRevisionUpdate",_logger:null,_dialog:null,options:{},_treeListView:null,init:function(m){this._parent(m);this._logger=b.getLogger(d);this.setOptions(m);this._createPanel();this._getRevisionInfo()},_getRevisionInfo:function(){var o=this;var n=[];var p=o.options.roots;p.forEach(function(q){n.push(q.getID());if(o._isTreeListMode()){o._addChildrenRevision(q,n)}});var m=o.options.onLoad;if(typeof m==="function"){m(n,function(r){var q=Object.keys(r).length;console.log("AuthGenericDlgRevisionUpdate.onLoadComplete: "+q+" item(s) processed.");o._allrevisions=r;o._treeListView.checkAndLaunchTreeNodeModelUpdate(o._allrevisions);if((o.progressBar!==undefined)&&(o.progressBar.value!==undefined)){o.progressBar.destroy()}},function(q){var r=this;if((r.progressBar!==undefined)&&(r.progressBar.value!==undefined)){r.progressBar.value=100*q}})}},_createPanel:function(){var q=this;var s=new i();s.inject(document.body);var t=e.createElement("div",{"class":"revisionUpdate-dialog-body"});var u=this.options.title;this._dialog=new g({immersiveFrame:s,title:u,className:this.name+"_dialog",content:t,resizableFlag:true,width:1000,minWidth:500,minHeight:250,height:500,position:{at:"left",my:"left",offsetX:50},modalFlag:true,buttons:{Ok:new j({label:k.modalFooterOK,disabled:true,"class":"btn btn-primary disabled revisionUpdate-btn-ok",onClick:q._onOK.bind(q)}),Cancel:new j({label:k.modalFooterCancel,disabled:false,"class":"btn btn-default revisionUpdate-btn-cancel",onClick:q._onCancel.bind(q)})}});this._dialog.addEventListener("close",this._onClosePanel.bind(this),false);this._dialog.elements.container.classList.add("AuthDlgRevisionUpdate_Dialog");this._dialog.elements.container.addEventListener("click",function(y){y.preventDefault();y.stopPropagation();return false});var n=new e.Element("div",{"class":"wux-control-inline-container"}).inject(t);var o=new c({value:0,displayStyle:"normal",shape:"linear",emphasize:"success",position:{at:"left",my:"left",offsetY:10}});var v=this._dialog.elements.container.querySelector(".wux-windows-dialog-footer");var p=new e.Element("div",{"class":"generalLoader"});v.insertBefore(p,v.getChildren()[0]);o.inject(p);this.progressBar=o;var x=this._dialog.elements.container.querySelector(".wux-windows-dialog-footer");x.setStyle("display","flex");x.setStyle("justify-content","space-between");var w=new e.Element("div",{"class":"informationPopup",styles:{}});x.insertBefore(w,x.getChildren()[0]);this.alert_replaceMulti=new f({visible:true,autoHide:true,hideDelay:5000,maximumVisibleMessages:1}).inject(x.querySelector(".informationPopup"));var r=new e.Element("div").inject(n);var m=new e.Element("div",{"class":"revisionUpdate-listview-container"}).inject(r);this._treeListView=new l({renderTo:m,roots:this.getOption("roots"),mode:this.getOption("commandMode"),cbActionAvailable:function(y){q._enableOKButton(y)},cbInfoMessage:function(y){q.alert_replaceMulti.getMessages().forEach(function(z){q.alert_replaceMulti.remove(z)});q.alert_replaceMulti.add({className:"primary",message:y})}})},_addChildrenRevision:function(n,o){var m=this;if(null!==n.getChildren()&&0<n.getChildren().length){n.getChildren().forEach(function(p){if(p.options.relationtype!=="VPMRepInstance"&&p.options.type!=="3DShape"){o.push(p.getID());m._addChildrenRevision(p,o)}})}},_closePanel:function(m){this.alert_replaceMulti.destroy();m.close()},_onClosePanel:function(){if(this.options.enableCmdOnClose!==undefined&&typeof(this.options.enableCmdOnClose)==="function"){this.options.enableCmdOnClose(true)}},_enableOKButton:function(m){var n=this._dialog.buttons.Ok;n.disabled=!m},_getReplaceList:function(){var m=this._treeListView.getReplaceList();return m},_isTreeListMode:function(){return(this.getOption("commandMode")==="TreeList")},_onOK:function(o){var n=this;var m=o.dsModel;n._closePanel(m.dialog);var p=n._getReplaceList();n.options.onComplete(p)},_onCancel:function(p){var o=this;var n=p.dsModel;o._closePanel(n.dialog);var m=o.options.onCancel;if(m&&(typeof m==="function")){m()}}});return d});