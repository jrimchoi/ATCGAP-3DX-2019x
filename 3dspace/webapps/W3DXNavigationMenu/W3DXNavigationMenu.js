define("DS/W3DXNavigationMenu/NavigationMenu",["UWA/Core","UWA/String","UWA/Event","UWA/Element","UWA/Utils/Client","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/UIKIT/Scroller","i18n!DS/W3DXNavigationMenu/assets/nls/NavigationMenuDefault","css!W3DXNavigationMenu/W3DXNavigationMenu"],function(c,G,z,g,i,n,v,D,r){var F;var w=null;var b;var y;var j={};var H={scrollMode:false,itemActions:{share:{name:"share",text:"Share",fonticon:"forward"},rename:{name:"rename",text:"Rename",fonticon:"rss"},duplicate:{name:"duplicate",text:"Duplicate",fonticon:"copy"},manage:{name:"manage",text:"Manage",fonticon:"cog"},"delete":{name:"delete",text:"Delete",fonticon:"trash"}},events:{onClick:function(L){var N=F.options.itemActions,K=z.getElement(L),M;if(!K.hasClassName("item-action-cnt")){K=K.getParent()}if(K){M=K.className.split(" ")[1]}if(M){if(w&&N[M]&&N[M].callback){N[M].callback(w)}}},onShow:function(){var M=this,L=M.getItem("items-cnt"),K=document.querySelector(".item.search .item-search-cnt > input");K.focus();M.options.target.addClassName("active");if(L){l(L,M)}window.requestAnimationFrame(function(){y=function(){M.hide()};g.addEvent.call(document.body,"click",y);M.updatePosition()})},onHide:function(){var K=this;K.options.target.removeClassName("active");g.removeEvent.call(document.body,"click",y)}},itemTemplate:function(L){var K='<span class="item-text">'+L.name+"</span>";if(L.fonticon){K+='<span class="item-icon fonticon fonticon-'+L.fonticon+'"></span>'}return'<li class="item object d-'+L.modelId+" selectable"+(L.active?' selected"':'"')+">"+K+"</li>"},kb:false,className:"ifwe-header-dd",renderTo:document.body,offset:{x:0,y:0},position:"bottom right",bound:false};var o=45;function e(O,R,N){var M,Q,K,P=0;function L(){P=new Date().getTime();Q=null;K=O.apply(N,M)}return function(){var S=new Date().getTime(),T=R-(S-P);N=N||this;M=arguments;if(T<=0){clearTimeout(Q);Q=null;P=S;K=O.apply(N,M)}else{if(!Q){Q=setTimeout(L,T)}}return K}}function x(L){var M=F.getBody(),K;K=M.getElement(".selected");if(K){K.removeClassName("selected")}K=M.getElement("."+L);if(K){if(K.className.indexOf("d-")===-1){K=K.getParent().getParent()}K.addClassName("selected")}}function k(K){var L=F.getBody().getElement(".item-action");Object.keys(F.options.itemActions).map(function(M){L.getElement("."+M).hide()});K.forEach(function(M){L.getElement("."+M).show()})}function f(){F.getBody().getElement(".item-action").hide()}function u(K){F.getBody().getElement(".item-action").show();if(K){k(K)}}function I(M,K){var N=F.getBody(),L;w=M;if(w){u(K)}else{f()}}function A(P){var O=this,K=/d-([\w|\-]{1,})/i,N=z.getElement(P),M,L;if(!N.hasClassName("item")){N=N.getParent()}M=N.getAttribute("class").match(K);if(M&&M[1]){if(w!==M[1]){O.options.target.removeClassName("active");I(M[1]);x("d-"+w);O.dispatchEvent("onObjectSelect",w)}}}function C(M){var K=F.elements.container,L=c.extendElement(K.querySelector(".item.search input"));L.focus();z.stopPropagation(M)}function h(L){var K;K='<div class="item-add-cnt"><span class="item-icon fonticon fonticon-plus"></span><span class="item-text">'+(j.AddItem?j.AddItem+"...":r.AddItem)+"</span></div>";return{template:K,handler:L,className:"add",_type:"action"}}function m(L){var K;K='<span class="item-icon fonticon fonticon-search"></span><div class="item-search-cnt"><span class="item-search-clear fonticon fonticon-cancel-circled"></span><input type="text" class="form-control" placeholder="'+(j.Search?j.Search:r.Search)+'"> </div>';return{template:K,handler:null,className:"search",_type:"action"}}function E(L){var M=[],N="";function K(P){var O="";if(P.fonticon){O+='<span class="item-icon fonticon fonticon-'+P.fonticon+'"></span>'}O+='<span class="item-action-cnt '+P.name+' item-text">'+G.escapeHTML(P.text)+"</span>";return O}Object.keys(L).map(function(O){var P=L[O];N=K(P);M.push({template:N,handler:function(Q){if(P.callback){P.callback()}x(P.name)},className:"global-actions-cnt selectable "+P.name,_type:"action"})});return M}function d(M,Q,O){if(!Q){Q=H.itemTemplate}var P="",L,K,N;b=[];if(M){M.forEach(function(R){b.push(R);P+=Q(R)});P+='<li class="item object nodb" style="display: none;"><span class="item-icon fonticon fonticon-info"></span><span class="item-text">'+(j.NoObjectFound?j.NoObjectFound:r.NoObjectFound)+"</span> </li>"}else{return{className:"loading-cnt",template:'<span class="item-text">'+r.Loading+"</span>"}}K={template:P,id:"items-cnt",className:"items-cnt",_type:O};return K}function s(P,L,O){var N="",K="",M="";b.forEach(function(Q){M=".d-"+Q.modelId+",";if(Q.name.toLowerCase().indexOf(P.trim().toLowerCase().escapeHTML())<0){N+=M}else{K+=M}});N=N.replace(/,$/,"");K=K.replace(/,$/,"");window.requestAnimationFrame(function(){var S=L.elements.container,Q=K?S.getElements(K):[],R=S.getElement(".nodb");Array.prototype.forEach.call(N?S.getElements(N):[],function(T){T.setStyle("display","none")});Array.prototype.forEach.call(Q,function(T){T.setStyle("display","")});if(!K){R.setStyle("display","")}else{R.setStyle("display","none")}J(L,O,{itemNumber:Q.length})})}function p(N,P){var K=P.elements.container,M=c.extendElement(K.querySelector(".item.search")),L=c.extendElement(K.querySelector(".item.search input")),O=c.extendElement(K.querySelector(".item.search .item-search-clear"));N.elements.container.addEvent("click",A.bind(P));M.addEvent("click",C.bind(P));L.addEvent("click",z.stopPropagation);L.addEvent("keyup",e(q.bind(null,L,N,P),500));O.addEvent("click",function(Q){z.stopPropagation(Q);L.value="";q(L,N,P);L.focus()})}function q(K,L,M){if(K.value){g.addClassName.call(K.parentElement,"input-active")}else{g.removeClassName.call(K.parentElement,"input-active")}s(K.value,L,M)}function J(P,R,M){if(!M){M={}}var N=P.elements,L=R.elements,K=N.scroller,O=Math.max(c.is(M.itemNumber)?M.itemNumber:N.container.querySelectorAll(".object").length-1,1),Q;if(!K){return}Q=L.container.getPosition(document.body).y+L.container.getSize().height-N.container.getSize().height;K.elements.container.setStyles({height:(o*O+2),"max-height":"calc(100vh - "+Q+"px)"})}function l(L,N){var M=L.elements,K=M.scroller;if(K){return}M.scroller=K=new D({element:M.container,scrollbarsMargin:0});J(L,N);if(i.Engine.firefox){K.elements.container.setStyle("display","block");K.elements.content.setStyles({"padding-right":0,right:-21})}p(L,N)}function a(K){if(!K){K=H.itemActions}var L="";Object.keys(K).map(function(M){var N=K[M];L+='<span class="item-action-cnt '+N.name+'"><div class="item-action-icon fonticon fonticon-'+N.fonticon+'"></div> <div class="item-action-name">'+(N.text||G.escapeHTML(G.capitalize(N.name)))+"</div></span>"});return{className:"item-action",template:L,_type:"action"}}function t(L){var K=F.getItem("items-cnt");if(L.isVisible){L.hide()}else{L.show();if(K){J(K,L)}}}var B={create:function(K){if(K.nls){j=K.nls}K.target=K.menu||K.target;var M={target:K.target,itemActions:K.itemActions,globalActions:K.globalActions,addCallback:K.addCallback,items:K.items,itemTemplate:K.itemTemplate,type:K.type,position:"bottom left"},L=[];c.createElement("div",{"class":"fonticon fonticon-down-open item-actions-holder "}).inject(K.menu||K.target.getElement(".topbar-app-menu"));new v({position:"bottom",target:K.target,body:(j.tooltipMenu?j.tooltipMenu:r.tooltipMenu),offset:{x:0,y:0}});L.push(a(K.itemActions));if(K.globalActions){L.push({className:"divider"});L.push(E(K.globalActions))}if(K.addCallback){L.push(h(K.addCallback))}L.push({className:"divider"});L.push(m());L.push({className:"divider"});L.push(d(K.items,K.itemTemplate,K.type));M.items=L;F=new n(c.merge(M,H));f();K.target.addEvent("click",t.bind(null,F));return F},setCurrentSelectedObject:function(L,K){I(L,K);if(L){x("d-"+L)}},selectCurrentItem:x,showItemActions:u,hideItemActions:f,setItems:function(K){var L;F.addItem(d(K));L=F.getItem("items-cnt");F.getBody().getElement(".loading-cnt").hide();l(L,F)},destroy:function(){if(F){F.destroy()}b.length=0;F=null}};return B});