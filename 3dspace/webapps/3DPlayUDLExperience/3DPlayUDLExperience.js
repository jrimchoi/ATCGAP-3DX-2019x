define("DS/3DPlayUDLExperience/UDLLeftPanel",["UWA/Core","UWA/Class","css!DS/3DPlayUDLExperience/UDLLeftPanel","DS/Panels/SidePanel"],function(e,a,c,d){var b=a.extend({init:function(p){var k=this;this.sheets=[];var f=0;this.leftPanel=new d({side:"left"}).inject(p.container);this.leftPanel.slideOut();this.mainContainer=new e.Element("div",{id:"MAIN_CONTAINER",styles:{height:this.leftPanel.elements.panel.clientHeight+"px","overflow-y":"auto"}}).inject(this.leftPanel);var n=new e.Element("div",{id:"SHEET_LIST_CONTAINER"}).inject(this.mainContainer);this.sheetIDs=[];var j=function(q,i,s){var r=new e.Element("div",{id:s,"class":"UDL-leftpanel-item",events:{click:function(u){if(u.target.parentElement.className.indexOf("selected")<0){p.clickCB(i)}else{return}}}}).inject(q);var t=new e.Element("span",{title:s,"class":"UDL-title"}).inject(r);t.innerHTML=s;return r};for(var h=0;h<p.items.length;h++){var m=p.items[h];var l=p.items[h].index;var g="Sheet_"+(h+1);var o=j(n,l,g);this.sheets.push(o)}},selectSheetByIndex:function(h){if(this.leftPanel){for(var g=0;g<this.sheets.length;g++){var i=this.sheets[g];if(i.className.indexOf("selected")>0){i.removeClassName("selected")}}var k=h+1;var f=document.getElementById("Sheet_"+k);f.addClassName("selected")}},loadImg:function(g){var h=g.index+1;var f=new e.Element("img",{src:g.url,id:"thumbnail_image",alt:"Thumbnail Image",styles:{width:"150",height:"90",position:"absolute",top:0,left:0,right:0}});document.getElementById("Sheet_"+h).appendChild(f)},dispose:function(){if(this.leftPanel){if(this.mainContainer.remove){this.mainContainer.remove()}if(this.leftPanel.elements.panel.remove){this.leftPanel.elements.panel.remove()}if(this.leftPanel.elements.lateralHandle){this.leftPanel.elements.lateralHandle.remove()}this.leftPanel=undefined;this.mainContainer=undefined;this.sheets=[]}}});return b});define("DS/3DPlayUDLExperience/CmdScaleUDL",["UWA/Core","DS/ApplicationFrame/Command"],function(d,b){var a=[5,10,15,20,25,35,50,75,100,125,150,200,300,400,500];var c=b.extend({init:function(e){this._parent(e,{isAsynchronous:false});for(var f in e.arguments){if(e.arguments[f].ID=="Scale"){this.scaleMode=e.arguments[f].Value}}},execute:function(){var g=this.getFrameWindow();if(g&&g.experience){var f=g.experience.getZoomScale();var e=this.getScale(f);g.experience.setZoomScale(e)}},getScale:function(g){var h;if(g>500){h=500}else{if(g<5){h=5}else{h=g}}if(this.scaleMode=="+"){for(var e=0;e<a.length-1;++e){if(g<a[e]){h=a[e];break}else{if(g===a[e]){h=a[++e];break}}}}else{for(var f=a.length-1;f>=1;--f){if(g>a[f]){h=a[f];break}else{if(g===a[f]){h=a[--f];break}}}}return h}});return c});define("DS/3DPlayUDLExperience/CmdScrollUDL",["DS/ApplicationFrame/Command","DS/CoreEvents/Events","DS/WebUtils/EventDisposer"],function(d,a,c){var b=d.extend({init:function(e){this._parent(e,{isAsynchronous:false});for(var f in e.arguments){if(e.arguments[f].ID=="ScrollSheet"){this.scrollDir=e.arguments[f].Value}}var g=this;this._exp=this.getFrameWindow().experience;this.loadingCompletedToken=this._exp.subscribe("ASSET/LOADINGFINISHED",function(){if(g._exp.getNumberOfSheets()>1){g.enable()}else{g.disable()}})},execute:function(){if(this.scrollDir==="Previous"){this._exp.scrollToPreviousSheet()}else{if(this.scrollDir==="Next"){this._exp.scrollToNextSheet()}}},_destroy:function(){if(this._exp){this._exp.unsubscribe(this.loadingCompletedToken);this.loadingCompletedToken=undefined;this._exp=undefined;this._parent()}}});return b});define("DS/3DPlayUDLExperience/3DPlayUDLExperience",["DS/3DPlayExperienceModule/PlayExperience3D","DS/CoreEvents/Events","DS/3DPlayUDLExperience/UDLLeftPanel","DS/ApplicationFrame/CommandsManager"],function(f,b,e,d){var h=function(i,j){this.id=j;this.index=i;this.annotList=[];this.loadingStarted=false;this.node=null;this.isLoaded=false;this.setThumbnail=function(k){this.thumbnail=k};this.getThumbnail=function(){return this.thumbnail};this.setSource=function(k){this.node=k};this.getSource=function(){return this.node}};var a=["DS/DibUDLWebLoader/DraftingUDLWebLoader"];var g=["DS/DibUDLWebLoader/CATDibUDLWebLoader"];var c=f.extend({init:function(i){this._parent(i);var j=this;this.sheets=[];i.workbenchs=[];i.workbenchs.unshift({name:"3DPlayUDLExperience",module:"3DPlayUDLExperience"});this.loadingCompletedToken=this.subscribe("ASSET/LOADINGFINISHED",function(){j.sheetCameraDistance=j.frmWindow.getViewpoint().getTargetDistance();j.zoomScale=100});this.viewpointChangedToken=b.subscribe({event:"/VISU/"},function(l){if(j.sheetCameraDistance&&j.zoomScale){if(l.eventType=="@onViewpointEndMove"||l.eventType=="@onViewpointChange"){var k=j.frmWindow.getViewpoint().getTargetDistance();j.zoomScale=Math.floor(100*(j.sheetCameraDistance/k))}}})},refreshExp:function(){this.sheets=[];if(this.LeftPanel){this.LeftPanel.dispose()}},onPreCreate:function(){var i=this;this._parent();this.mabModel={speeddial:[{id:"Reframe",rsc:"3DPlayUDLExperience/3DPlayUDLExperience"}],sections:[{id:"ScaleP",rsc:"3DPlayUDLExperience/3DPlayUDLExperience",nls:"3DPlayUDLExperience/3DPlayUDLExperience"},{id:"ScaleM",rsc:"3DPlayUDLExperience/3DPlayUDLExperience",nls:"3DPlayUDLExperience/3DPlayUDLExperience"},{id:"Previous",rsc:"3DPlayUDLExperience/3DPlayUDLExperience",nls:"3DPlayUDLExperience/3DPlayUDLExperience"},{id:"Next",rsc:"3DPlayUDLExperience/3DPlayUDLExperience",nls:"3DPlayUDLExperience/3DPlayUDLExperience"}]}},onPostCreate:function(){if(!this.viewer){this.viewer=this.frmWindow.getViewer()}this.viewer.set2DMode(true);this.viewer.setPicking({activated:false,trapSelection:false,displayHL:false});this.viewer.setPrePicking({activated:false,displayHL:false})},loadAsset:function(i){this.onModelLoadingStarted();var k=this;this.refreshExp();var j=i.asset.provider;require(a,function(n){if(n){if(!k._UDLLoader){k._UDLLoader=new n()}if(i){var l={provider:"FILE",serverurl:"",proxyurl:"none",requiredAuth:null};if(j.toLowerCase()==="file"){l.filename=i.asset.filename}else{l.filename=i.asset.data}var m={UDLObjURL:l,onComplete:function(q){k.modelLoader.onLoadedCB();for(var o=0;o<q.sheetIDList.length;o++){var p=new h(o,q.sheetIDList[o]);k.sheets.push(p)}k.currentSheetIndex=0;if(k.sheets.length>1){k.initiateLeftPanel();k.loadThumbnail()}k.cmds=d.getCommands(k.ctx);k.setCurrentSheet(k.currentSheetIndex)},onFailure:function(){console.log("Unexpected error!! Failed to Load UDL via _UDLLoader.loadModel!!")}};if(k._UDLLoader){k._UDLLoader.loadModel(m)}}}})},loadThumbnail:function(){var i=this;this.sheets.forEach(function(j){i._UDLLoader.getSheetThumbnail({sheetID:j.id,onComplete:function(k){j.setThumbnail(k);i.LeftPanel.loadImg({url:k,index:j.index})},onFailure:function(){console.log("Thumbnail Loading Failed!! Failed to Load Thumbnail via _UDLLoader.getSheetThumbnail")}})})},getSheet3DNode:function(j,i){var l=this;j.loadingStarted=true;var k={sheetID:j.id,onSheetNodeCreated:function(n){var m=l.frmWindow.experience.getRootBag();n.visible=false;m.addChild(n);j.setSource(n)},onSheetLoaded:function(){j.isLoaded=true;j.loadingStarted=false;i()},onFailure:function(){console.log("Unexpected error");l=undefined}};this._UDLLoader.getSheet3DNode(k)},unloadSheet:function(i){this.viewer.removeNode(i.getSource());this.viewer.render()},setCurrentSheet:function(i){if(i>=0&&i<this.sheets.length){if(this.LeftPanel){this.LeftPanel.selectSheetByIndex(i)}if(this.sheets[this.currentSheetIndex].isLoaded){this.sheets[this.currentSheetIndex].getSource().setVisibility(false);this.viewer.render()}this.currentSheetIndex=i;if(this.sheets.length>1){if(!this.cmds.Previous._isEnabled){this.cmds.Previous.enable()}if(!this.cmds.Next._isEnabled){this.cmds.Next.enable()}if(this.currentSheetIndex===this.sheets.length-1){this.cmds.Next.disable()}else{if(this.currentSheetIndex===0){this.cmds.Previous.disable()}}}if(!this.sheets[this.currentSheetIndex].isLoaded){this.getSheet3DNode(this.sheets[this.currentSheetIndex],this.showCurrentSheet.bind(this))}else{this.showCurrentSheet()}}},showCurrentSheet:function(){this.sheets[this.currentSheetIndex].getSource().setVisibility(true);this.viewer.currentViewpoint.reframe()},onFailure:function(){console.log("Unexpected error")},initiateLeftPanel:function(){var i=this;this.LeftPanel=new e({items:this.sheets,container:this.frmWindow.getUIFrame(),clickCB:function(j){i.setCurrentSheet(j)}})},getZoomScale:function(){return this.zoomScale},setZoomScale:function(k){this.zoomScale=k;var i=this.frmWindow.getViewpoint();var j=(this.sheetCameraDistance*100)/this.zoomScale;i.moveTo({distanceToTarget:j,duration:200});this.frmWindow.getViewer().render()},getNumberOfSheets:function(){return this._UDLLoader.getNumberOfSheets()},getCurrentSheet:function(){return this.sheets[this.currentSheetIndex]},scrollToPreviousSheet:function(){var i=this.currentSheetIndex-1;this.setCurrentSheet(i)},scrollToNextSheet:function(){var i=this.currentSheetIndex+1;this.setCurrentSheet(i)},dispose:function(){if(this.viewpointChangedToken){b.unsubscribe(this.viewpointChangedToken);this.viewpointChangedToken=undefined}if(this.loadingCompletedToken){this.unsubscribe(this.loadingCompletedToken);this.loadingCompletedToken=undefined}this.sheets=null;this.viewer=null;this.LeftPanel=null;this._parent()}});return c});define("DS/3DPlayUDLExperience/3DPlayUDLExperiencePreview",["DS/3DPlayUDLExperience/3DPlayUDLExperience"],function(b){var a=b.extend({init:function(c){this._parent(c);c.workbenchs=[];c.workbenchs.unshift({name:"3DPlayUDLExperiencePreview",module:"3DPlayUDLExperience"})},dispose:function(){this._parent()},onPreCreate:function(){this.args.visu={picking:false};var c=this;this.args.ui={keepActionbarClosed:true,onActionBarReady:function(){if(c&&c.frmWindow){c.frmWindow.getActionBar().close();c=undefined}}};this.mabModel={speeddial:[{id:"Reframe",rsc:"3DPlayUDLExperience/3DPlayUDLExperience"},{id:"Previous",rsc:"3DPlayUDLExperience/3DPlayUDLExperience"},{id:"Next",rsc:"3DPlayUDLExperience/3DPlayUDLExperience"}]}}});return a});