define("DS/W3DXTimeline/Timeline",["UWA/Core","UWA/Class/View","i18n!DS/W3DXTimeline/assets/nls/feed","css!W3DXTimeline/W3DXTimeline.css"],function(e,d,c){UWA.log("Timeline - Add");var a=d.extend({tagName:"div",className:"w3dxtimeline",setup:function(g){this._createContent()},_createContent:function(){var h=this.model.get("url");var i=this.model.get("text");var g=this.model.get("img");var j=this.model.get("pictureSize");if(!j){j="48px"}this.setContainer({tag:"div","class":"TL-item-view",html:[{tag:"div","class":"TL-picture-view",html:[{tag:"img",src:g,height:j,width:j}]},{tag:"div","class":"TL-text-view",html:[{tag:"span",html:decodeURIComponent(encodeURIComponent(i))}]}]})}});var f=d.extend({tagName:"div",className:"w3dxtimeline",defaultOptions:{title:""},setup:function(g){this.listOfItems={};this.title=g.title?g.title:this.options.title;this.setContainer({tag:"div","class":"TL-section",html:[{tag:"div",Class:"TL-section-name",text:this.title},{tag:"div","class":"TL-section-list-item",html:[{tag:"div","class":"TL-section-item",}]}]})},add:function(w,z,r){var k=this.container.getElement(".TL-section-item");var v=new Date(w.model.get("date")).strftime("%H:%M");var n=w.model.get("removeTime");var g=w.model.get("removeCircle");var q=w.model.get("pictureSize");var p=UWA.createElement("div",{"class":"TL-item",html:[{tag:"div","class":"TL-time-item",html:[{tag:"div","class":"TL-time-item-txt",text:v}]},{tag:"div","class":"TL-section-line",html:[{tag:"div","class":"TL-cirlce-item",html:[{tag:"div","class":"TL-time-item-cirlce",}]}]},{tag:"div","class":"TL-content-view",styles:{width:"100%"},html:w.container}]});if(q){var s=parseInt(q.replace("px",""));var o=p.getElement(".TL-time-item-cirlce");var l=p.getElement(".TL-time-item-txt");if(o){o.style["margin-top"]=s/2+"px"}if(l){l.style["margin-top"]=(s/2-2)+"px"}}if(n){p.getElement(".TL-time-item").destroy()}if(g){p.getElement(".TL-section-line").destroy()}var t=false;if(r){p.inject(k,"top");t=true}else{for(var x in this.listOfItems){var y=new Date("2016-01-01T"+x+":00.000Z");var j=new Date("2016-01-01T"+v+":00.000Z");if(y<j){p.inject(this.listOfItems[x].textView,"before");t=true;break}}}if(!t){p.inject(k)}this.listOfItems[v]={textView:p};var u=p.clientHeight+2;var i=new UWA.Fx(p,{duration:400,transition:"backOut",events:{onComplete:function(){p.style.height="auto"}}});i.start({height:["0px",u+"px"]});if(!g){var o=p.getElement(".TL-time-item-cirlce");var l=p.getElement(".TL-time-item-txt");z[w.id]={alert:w,timeView:l,circleView:o,textView:p};var m=this;if(w.model.get("readState")){o.style.background="";l.style.opacity="0.6"}else{o.style.background="#368ec4"}w.model.addEvent("read",function(h){if(h.read){if(l.style.opacity=="0.6"){h.flag=true}else{h.flag=false;o.style.background="";l.style.opacity="0.6"}}else{o.style.background="#368ec4";l.style.opacity="1"}this.dispatchEvent("readCenter",h)});w.model.addEvent("delete",function(h){p.destroy();if(!m.container.getElement(".TL-item")){m.container.destroy()}this.dispatchEvent("deleteCenter",h)});w.model.addEvent("unsubscribe",function(h){o.style.background="";l.style.opacity="0.6";this.dispatchEvent("unsubscribeCenter",[{id:w.model.id,subscribe:0}])});w.model.addEvent("deleteView",function(h){p.destroy()})}},inject:function(h,g){this.container.inject(h,g)}});var b=d.extend({tagName:"div",className:"TL-main-view",defaultOptions:{itemView:a,language:"en",pictureSize:"48px",removeTime:false,removeCircle:false},setup:function(g){var h=this;this.isInject=false;this.section={};this.alertlist=[];this.itemView=g.itemView?g.itemView:this.options.itemView;this.language=g.language?g.language:this.options.language;this.pictureSize=g.pictureSize?g.pictureSize:this.options.pictureSize;this.removeTime=g.removeTime?g.removeTime:this.options.removeTime;this.removeCircle=g.removeCircle?g.removeCircle:this.options.removeCircle;this.listenTo(this.collection,"onAdd",this.add);this.listenTo(this.collection,"onAfterPageChange",this.onAfterPageChange);this.addEvent("updatePicture",function(i){if(h.alertlist[i.notifID]&&h.alertlist[i.notifID].alert){h.alertlist[i.notifID].alert.dispatchEvent("updatePicture",[{src:i.src}])}})},onAfterPageChange:function(h,g){UWA.log("Timeline - onAfterPageChange")},markAll:function(g){for(var h in this.alertlist){if(!this.alertlist[h]||!this.alertlist[h].alert){continue}else{this.alertlist[h].alert.setReadstate(g.read);if(this.alertlist[h].alert.mergeList){this.alertlist[h].alert.mergeList.forEach(function(i){i.setReadstate(g.read)},this)}if(g.read){this.alertlist[h].circleView.style.background="";this.alertlist[h].timeView.style.opacity="0.6"}else{this.alertlist[h].circleView.style.background="rgb(54, 142, 196)";this.alertlist[h].timeView.style.opacity="1"}}}},getSectionName:function(k){var g=new Date();var m=undefined;var o=g.getDate();var h=k.getDate();var t=g.strftime("%Y-%m-%d");var l=k.strftime("%Y-%m-%d");var q=g.strftime("%m");var s=k.strftime("%m");var j=g.strftime("%Y");var r=k.strftime("%Y");if(t===l){m=c.today||"today"}if(o===(h+1)&&q===s&&j===r){m=c.yesterday||"yesterday"}if(!m){var i=this.language;if(!i){i=window.navigator.language}var n=k.toLocaleString(i,{month:"short"});var p=k.strftime("%d");m=k.toLocaleString(i,{weekday:"short"})+", "+p+" "+n+" "+r}return m},add:function(i,l){if((this.isInject)&&(i.get("text").trim()!="")){UWA.log("Timeline - Add");var h=i.get("date");if(!i.get("pictureSize")){i.set("pictureSize",this.pictureSize)}if(!i.get("removeTime")){i.set("removeTime",this.removeTime)}if(!i.get("removeCircle")){i.set("removeCircle",this.removeCircle)}var j=new Date(h);var g=this.getSectionName(j);if(g){if(!this.section[g]){this.buildSection({sectionName:g,date:j},l)}if(this.section[g]){var k=new this.itemView({model:i});this.section[g].section.add(k,this.alertlist,l)}}}},buildSection:function(l,k){var g=new f({title:l.sectionName.toUpperCase()});var i=false;for(var j in this.section){if(this.section[j].date<l.date){if(!k){g.inject(this.section[j].section,"before")}else{g.inject(this.container,"top")}i=true;break}}if(!i){if(this.removeTime){var h=g.container.getElement(".TL-section-name");h.style["margin-left"]="0px"}g.inject(this.container)}this.section[l.sectionName]={section:g,date:l.date}},inject:function(h){this.isInject=true;this.container.inject(h);for(var g=0;g<this.collection.size();g++){this.add(this.collection.at(g))}},deleteView:function(g){this.alertlist[g.id].textView.destroy();if(!this.container.getElement(".TL-item")){this.container.destroy()}delete this.alertlist[g.id]}});return b});