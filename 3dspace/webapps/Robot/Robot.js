define("DS/Robot/ReferenceAxisSystemNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/Mesh/MeshUtils"],function(e,g,b,d,a,f){var c=g.extend({init:function(h,i){this._parent(h);this.viewer=i;this.setVisibilityFree(true);this.fixedSizeNode=new b({name:"AxisSystemDisplayFixedSizeNode",ratio:4});this._createAxis();this.addChild(this.fixedSizeNode);this.setPickable(f.NODRAWHL);this.wantedVisibility=true;this._enabled=true;this.eventToken=this.viewer._modelEvent.subscribe({event:"UpdateReferenceAxisSystemVisibility"},this.onUpdateVisibility.bind(this))},onViewpointChange:function(){var j=this.viewer.currentViewpoint;if(!j){return}var l=Math.max(2*100/this.viewer.canvas.height-1,-0.85);var n=n=2*(this.viewer.canvas.width-100)/this.viewer.canvas.width-1;function k(o,v){var s=j.robotCameraOrtho;var r=new e.Vector3(o,v,0);var u=new e.Projector();u.unprojectVector(r,s);var t;if(s instanceof e.PerspectiveCamera){var q=new e.Ray(data.cameraEye,r.sub(data.cameraEye).normalize());var p=new e.Plane(j.camera.getLookAt(),0);t=q.intersectPlane(p)}else{t=r}return new e.Matrix4().setPosition(t)}var h;var i;var m=window.devicePixelRatio;h=k(2*(this.viewer.canvas.width-m*34)/this.viewer.canvas.width-1,Math.max(m*2*70/this.viewer.canvas.height-1,-0.85));this._changeMatrix(h,j.robotCameraOrtho)},onUpdateVisibility:function(h){this.wantedVisibility=h.visible;this.applyVisibility()},setCameraName:function(h){this.fixedSizeNode.setCameraName(h)},applyVisibility:function(){this.setVisibility(this.wantedVisibility&&this._enabled)},_dispose:function(){this.viewer._modelEvent.unsubscribe(this.eventToken);this.eventToken=null},_setEnabled:function(h){this._enabled=h;this.applyVisibility()},_changeMatrix:function(n,k){this.setMatrix(n);var j=new e.Vector3(),i=new e.Vector3(),q=new e.Vector3(),m=k.getLookAt();n.extractBasis(j,i,q);var l=new e.Vector3();var p=0.01;function h(r,s){l.crossVectors(r,m);if(l.lengthSq()<p*p){s.setVisibility(false)}else{s.setVisibility(true)}}var o=this._hasAxis();if(!this._hasAxis()){o=this._createAxis()}if(o){h(j,this.xAxis);h(i,this.yAxis);h(q,this.zAxis)}},_hasAxis:function(){if(!this.xAxis||!this.yAxis||!this.zAxis){return false}else{return true}},_createAxis:function(){var i=new e.MeshBasicMaterial({color:"black"});var h=5.5;function j(p,r){var l=d.createTextNode({text:r,hotspot:{x:0.5,y:0.5},font:"Trebuchet MS",color:new e.Color("black"),fontSize:4,bold:false,_fix:true});if(!l){return null}l.setFrustumCulled(false);var o=new g();var q=d.createLineNode({points:[new e.Vector3(0,0,0),new e.Vector3(h*p.x,h*p.y,h*p.z)],material:i});q.setFrustumCulled(false);q.setShadow(false);o.addChild(q);var n=new a({type:"Spherical"});var k=new e.Matrix4();var m=1.2;k.setPosition(new e.Vector3(m*h*p.x,m*h*p.y,m*h*p.z));n.setMatrix(k);n.addChild(l);o.addChild(n);return o}this.xAxis=j(new e.Vector3(1,0,0),"x");this.yAxis=j(new e.Vector3(0,1,0),"y");this.zAxis=j(new e.Vector3(0,0,1),"z");if(this.xAxis&&this.yAxis&&this.zAxis){this.fixedSizeNode.addChild(this.xAxis);this.fixedSizeNode.addChild(this.yAxis);this.fixedSizeNode.addChild(this.zAxis);return true}else{this.xAxis=null;this.yAxis=null;this.zAxis=null;return false}},CallBackEventHandlerViewPoint:function(){this.onViewpointChange.apply(this,arguments)}});return c});define("DS/Robot/CustomReferenceAxisSystem",["DS/Visualization/Node3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/ThreeJS_DS"],function(d,a,b){var c=d.extend({init:function(g,f){f=f||{};this._parent("customReferenceAxisSystem");this._subscribedEvents=[];this.viewer=g;this.ratio=f.ratio||7;this.fixedSizeNode3D=new a({name:"fixedSizeNode3D",ratio:this.ratio});this.addChild(this.fixedSizeNode3D);this.fixedSizeNode3D.addChild(f.node);this.fixedSizeNode3D.setCameraName("robotCameraOrtho");this.node=f.node;this.removeGeomTypes=f.removeGeomTypes;this.getPosition=f.getPosition||function(j,i){return{x:2*(j-100)/j-1,y:Math.max(2*100/i-1,-0.85)}};this.notifyNodesHierarchyUpdate();var h=this;var e=this.viewer.currentViewpoint.onMove(function(){h.onViewpointChange()});this._subscribedEvents.push({object:this.viewer.currentViewpoint,token:e});e=this.viewer.onViewerResize(function(){h.onViewpointChange()});this._subscribedEvents.push({object:this.viewer,token:e})},setRatio:function(e){this.fixedSizeNode3D.setRatio(e)},notifyNodesHierarchyUpdate:function(){var e=this;this.fixedSizeNode3D.traverse(function(h){if(h.getNodeType()==="Mesh3D"){h.excludeFromHighlight(true,true);h.setShadow(false);h.setFrustumCulled(false);h.excludeFromCSO(true);if(e.removeGeomTypes&&h.mesh3js&&h.mesh3js.geometry){var g;for(g=0;g<h.mesh3js.geometry.length;g++){var f;var k=h.mesh3js.geometry[g];for(f=0;f<k.drawingGroups.length;f++){k.drawingGroups[f]._geomType=0}}}}})},onViewpointChange:function(){var g=this.viewer.currentViewpoint;if(!g){return}g._updateRobotCamera(this.viewer.internalSceneGraph);var i,j,e;e=this.getPosition(this.viewer.canvas.width,this.viewer.canvas.height);j=e.x;i=e.y;function h(k,r){var o=g.robotCameraOrtho;var n=new b.Vector3(k,r,0);var q=new b.Projector();q.unprojectVector(n,o);var p;if(o instanceof b.PerspectiveCamera){var m=new b.Ray(data.cameraEye,n.sub(data.cameraEye).normalize());var l=new b.Plane(this.viewer.currentViewpoint.camera.getLookAt(),0);p=m.intersectPlane(l)}else{p=n}return new b.Matrix4().setPosition(p)}var f;f=h(j,i);this.setMatrix(f)},_dispose:function(){var f,e;for(f=0;f<this._subscribedEvents.length;f++){e=this._subscribedEvents[f];e.object.unsubscribe(e.token)}this._subscribedEvents=[]},CallBackEventHandlerViewPoint:function(){this.onViewpointChange.apply(this,arguments)}});return c});define("DS/Robot/RobotHandle",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/ScreenPlaneManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory"],function(j,g,d,k,e,h,f,c,b,i){var a=g.extend({init:function(w){this._parent(w.name);this.position=w.position;this._modelEvent=new b();this.isPreactivated=false;this.isManipulated=false;this.enablePreactivate=true;this.touchMode=w.touchMode;var o=this;var n=new k();var q={width:4,height:4,fill:true,fillColor:null,noEdge:true};var u=n.createRectangle(q);var p=this;var v=d.getWebappsAssetUrl("Robot","");var t=new j.ImageUtils.loadTexture(v+"models/textures/Point.png",undefined,null,null,j.ImageUtils.crossOriginPolicy);t.flipY=false;t.minFilter=j.LinearMipMapLinearFilter;this.pointMat=new j.MeshBasicMaterial({map:t,side:j.DoubleSide,transparent:true,alphaTest:0.05,enableClipPlanes:false});this.pointMat.force=true;var r=i.createMeshNode(u,this.pointMat);r.setShadow(false);r.setFrustumCulled(false);r.name="diskNode";r.excludeFromCSO(true);r.excludeFromHighlight(true,true);r.setMatrix(new j.Matrix4().setPosition(new j.Vector3(-2,-2,0)));if(this.touchMode){r.setPickable(f.NODRAWHL);var s=new j.MeshBasicMaterial({transparent:true,opacity:0,enableClipPlanes:false,color:new j.Color("red"),force:true});var m=i.createSphereNode({radius:3,material:s});m.setShadow(false);m.setFrustumCulled(false);m.name="sphereNode";m.excludeFromCSO(true);m.excludeFromHighlight(true,true);this.addChild(m)}var l={position:this.position,name:"billBoard1",type:"Spherical"};this.billBoardNode=new e(l);this.billBoardNode.addChild(r);this.addChild(this.billBoardNode);this.screenPlaneManipulator=new h({cameraName:w.cameraName});this.screenPlaneManipulator.setExclusive(true);this.screenPlaneManipulator.linkToNode(this);this.screenPlaneManipulator.onBeginManipulate(function(x){o._modelEvent.publish({event:"ScreenPlaneTranslationBegin",data:x,context:this});o.pointMat.color=new j.Color("#1B6E9C");o.pointMat.opacity=1;o.isManipulated=true});this.screenPlaneManipulator.onManipulate(function(x){o._modelEvent.publish({event:"ScreenPlaneTranslationManipulation",data:x,context:this})});this.screenPlaneManipulator.onEndManipulate(function(x){o._modelEvent.publish({event:"ScreenPlaneTranslationEnd",data:x,context:this});if(!o.isPreactivated){o.pointMat.color=new j.Color("#FFFFFF")}else{o.pointMat.color=new j.Color("#A1D9ED")}o.isManipulated=false});this.screenPlaneManipulator.onBeginPreactivate(function(x){o._modelEvent.publish({event:"BeginPreactivate",data:x,context:this});if(!o.isManipulated&&o.enablePreactivate){x.viewer.setTemporaryCursor("pointer")}o.isPreactivated=true;if(!o.isManipulated&&o.enablePreactivate){o.pointMat.color=new j.Color("#A1D9ED")}x.viewer.render()});this.screenPlaneManipulator.onEndPreactivate(function(x){o._modelEvent.publish({event:"EndPreactivate",data:x,context:this});if(!o.isManipulated&&o.enablePreactivate){x.viewer.unsetTemporaryCursor()}o.isPreactivated=false;if(!o.isManipulated){o.pointMat.color=new j.Color("#FFFFFF")}x.viewer.render()})},setParentManipulated:function(l){this.enablePreactivate=!l},setToGhostState:function(){this.pointMat.opacity=0},setToNonGhostState:function(){this.pointMat.opacity=1},setCameraName:function(l){this.screenPlaneManipulator.setCameraName(l)}});return UWA.namespace("THREEDS/Robot/RobotHandle",a)});define("Robot/RobotHandle",["DS/Robot/RobotHandle","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Robot/RobotHandle");return b});define("DS/Robot/YZPlaneTranslationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/PlaneTranslationManipulator","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils"],function(h,f,b,j,c,i,a,g,d){var e=f.extend({init:function(u){var n=this;this._parent(u.name);this._modelEvent=new a();this.axis=u.constraintAxis;this.isPreactivated=false;this.isManipulated=false;this.enablePreactivate=true;this.touchMode=u.touchMode;var m=new j();var p={width:6,height:6,fill:true,fillColor:null,noEdge:true};var r=m.createRectangle(p);var o=this;var s=b.getWebappsAssetUrl("Robot","");var l=new h.ImageUtils.loadTexture(s+"models/textures/PlaneTranslationNode.png",undefined,null,null,h.ImageUtils.crossOriginPolicy);l.flipY=false;l.minFilter=h.LinearMipMapLinearFilter;this.planeMat=new h.MeshBasicMaterial({map:l,side:h.DoubleSide,transparent:true,alphaTest:0.05,enableClipPlanes:false,opacity:1});this.planeMat.force=true;var t=g.createMeshNode(r,this.planeMat);t.setShadow(false);t.setFrustumCulled(false);t.excludeFromCSO(true);t.excludeFromHighlight(true,true);t.setMatrix(new h.Matrix4().rotateY(-0.5*Math.PI).translate(new h.Vector3(0.5,0.5,0)));this.addChild(t);if(this.touchMode){t.setPickable(d.NODRAWHL);var k=new h.ImageUtils.loadTexture(s+"models/textures/PlaneTranslationNode_picking.png",undefined,null,null,h.ImageUtils.crossOriginPolicy);k.flipY=false;k.minFilter=h.LinearMipMapLinearFilter;this.planeMat_picking=new h.MeshBasicMaterial({map:k,side:h.DoubleSide,transparent:true,alphaTest:0.05,enableClipPlanes:false,opacity:0});this.planeMat_picking.force=true;var q=g.createMeshNode(r,this.planeMat_picking);q.setShadow(false);q.setFrustumCulled(false);q.excludeFromCSO(true);q.excludeFromHighlight(true,true);q.setMatrix(new h.Matrix4().rotateY(-0.5*Math.PI).translate(new h.Vector3(0.5,0.5,0)));this.addChild(q)}this.manipulator=new i({axis:this.axis});this.manipulator.setExclusive(true);this.manipulator.linkToNode(this);this.manipulator.onPrimaryPointerClick(function(v){n._modelEvent.publish({event:"PrimaryPointerClick",data:{node:this},context:this})});this.manipulator.onBeginManipulate(function(v){n._modelEvent.publish({event:"PlaneTranslationBegin",data:v,context:this});n.planeMat.opacity=1;n.planeMat.color=new h.Color("#1B6E9C");n.isManipulated=true});this.manipulator.onManipulate(function(v){n._modelEvent.publish({event:"PlaneTranslationManipulation",data:v,context:this})});this.manipulator.onEndManipulate(function(v){n._modelEvent.publish({event:"PlaneTranslationEnd",data:v,context:this});if(!n.isPreactivated){n.planeMat.color=new h.Color("#FFFFFF")}else{n.planeMat.color=new h.Color("#A1D9ED")}n.isManipulated=false});this.manipulator.onBeginPreactivate(function(v){n._modelEvent.publish({event:"BeginPreactivate",data:v,context:this});if(!n.isManipulated&&n.enablePreactivate){v.viewer.setTemporaryCursor("pointer")}n.isPreactivated=true;if(!n.isManipulated&&n.enablePreactivate){n.planeMat.color=new h.Color("#A1D9ED")}v.viewer.render()});this.manipulator.onEndPreactivate(function(v){n._modelEvent.publish({event:"EndPreactivate",data:v,context:this});if(!n.isManipulated&&n.enablePreactivate){v.viewer.unsetTemporaryCursor()}n.isPreactivated=false;if(!n.isManipulated){n.planeMat.color=new h.Color("#FFFFFF")}v.viewer.render()})},setCenter:function(k){this.manipulator.setCenter(k)},setAxis:function(k){this.axis=k;this.manipulator.axis=k},setParentManipulated:function(k){this.enablePreactivate=!k},setToGhostState:function(){this.planeMat.opacity=0},setToNonGhostState:function(){this.planeMat.opacity=1}});return UWA.namespace("THREEDS/Robot/YZPlaneTranslationNode",e)});define("Robot/YZPlaneTranslationNode",["DS/Robot/YZPlaneTranslationNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Robot/YZPlaneTranslationNode");return b});define("DS/Robot/XYPlaneTranslationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/PlaneTranslationManipulator","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils"],function(g,e,b,j,c,h,a,f,d){var i=e.extend({init:function(u){var o=this;this._parent(u.name);this.axis=u.constraintAxis;this._modelEvent=new a();this.isPreactivated=false;this.isManipulated=false;this.enablePreactivate=true;this.touchMode=u.touchMode;var n=new j();var q={width:15,height:15,fill:true,fillColor:null,noEdge:true};var s=n.createRectangle(q);var p=this;var t=b.getWebappsAssetUrl("Robot","");var m=new g.ImageUtils.loadTexture(t+"models/textures/Translation_FullPlane.png",undefined,null,null,g.ImageUtils.crossOriginPolicy);m.flipY=false;this.planeMat=new g.MeshBasicMaterial({map:m,side:g.DoubleSide,transparent:true,shading:g.NoShading,alphaTest:0.05,opacity:1,enableClipPlanes:false});this.planeMat.force=true;var l=f.createMeshNode(s,this.planeMat);l.setShadow(false);l.setFrustumCulled(false);l.excludeFromCSO(true);l.excludeFromHighlight(true,true);l.setMatrix(new g.Matrix4().setPosition(new g.Vector3(-7.5,-7.5,0)));this.addChild(l);if(this.touchMode){l.setPickable(d.NODRAWHL);var k=new g.ImageUtils.loadTexture(t+"models/textures/Translation_FullPlane_picking.png",undefined,null,null,g.ImageUtils.crossOriginPolicy);k.flipY=false;this.planeMatPicking=new g.MeshBasicMaterial({map:k,side:g.DoubleSide,transparent:true,shading:g.NoShading,alphaTest:0.05,opacity:0,enableClipPlanes:false});this.planeMatPicking.force=true;var r=f.createMeshNode(s,this.planeMatPicking);r.setShadow(false);r.setFrustumCulled(false);r.excludeFromCSO(true);r.excludeFromHighlight(true,true);r.setMatrix(new g.Matrix4().setPosition(new g.Vector3(-7.5,-7.5,0)));this.addChild(r)}this.manipulator=new h({axis:this.axis});this.manipulator.setExclusive(true);this.manipulator.linkToNode(this);this.manipulator.onPrimaryPointerClick(function(v){o._modelEvent.publish({event:"PrimaryPointerClick",data:{node:this},context:this})});this.manipulator.onBeginManipulate(function(v){o._modelEvent.publish({event:"PlaneTranslationBegin",data:v,context:this});o.planeMat.opacity=1;o.planeMat.color=new g.Color("#1B6E9C");o.isManipulated=true});this.manipulator.onManipulate(function(v){o._modelEvent.publish({event:"PlaneTranslationManipulation",data:v,context:this})});this.manipulator.onEndManipulate(function(v){o._modelEvent.publish({event:"PlaneTranslationEnd",data:v,context:this});if(!o.isPreactivated){o.planeMat.color=new g.Color("#FFFFFF")}else{o.planeMat.color=new g.Color("#A1D9ED")}o.isManipulated=false;v.viewer.render()});this.manipulator.onBeginPreactivate(function(v){o._modelEvent.publish({event:"BeginPreactivate",data:v,context:this});if(!o.isManipulated&&o.enablePreactivate){v.viewer.setTemporaryCursor("pointer")}o.isPreactivated=true;if(!o.isManipulated&&o.enablePreactivate){o.planeMat.color=new g.Color("#A1D9ED")}v.viewer.render()});this.manipulator.onEndPreactivate(function(v){o._modelEvent.publish({event:"EndPreactivate",data:v,context:this});if(!o.isManipulated&&o.enablePreactivate){v.viewer.unsetTemporaryCursor()}o.isPreactivated=false;if(!o.isManipulated){o.planeMat.color=new g.Color("#FFFFFF")}v.viewer.render()})},setAxis:function(k){this.axis=k;this.manipulator.axis=k},setParentManipulated:function(k){this.enablePreactivate=!k},setToGhostState:function(){this.planeMat.opacity=0},setToNonGhostState:function(){this.planeMat.opacity=1},setToDragState:function(){this.planeMat.opacity=0.3}});return UWA.namespace("THREEDS/Robot/XYPlaneTranslationNode",i)});define("Robot/XYPlaneTranslationNode",["DS/Robot/XYPlaneTranslationNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Robot/XYPlaneTranslationNode");return b});define("DS/Robot/ScalingNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/ScalingManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory"],function(g,e,b,h,c,j,d,a,f){var i=e.extend({init:function(t){var m=this;this._parent(t.name);this.axis=t.constraintAxis;this._modelEvent=new a();this.isPreactivated=false;this.isManipulated=false;this.enablePreactivate=true;var l=new h();var o={width:2,height:2,fill:true,fillColor:null,noEdge:true};var r=l.createRectangle(o);var n=this;var s=b.getWebappsAssetUrl("Robot","");var q=new g.ImageUtils.loadTexture(s+"models/textures/Point.png",undefined,null,null,g.ImageUtils.crossOriginPolicy);q.flipY=false;q.minFilter=g.LinearMipMapLinearFilter;this.pointMat=new g.MeshBasicMaterial({map:q,side:g.DoubleSide,transparent:true,alphaTest:0.05,enableClipPlanes:false});this.pointMat.force=true;var p=f.createMeshNode(r,this.pointMat);p.setShadow(false);p.setFrustumCulled(false);p.name="diskNode";p.excludeFromCSO(true);p.excludeFromHighlight(true,true);p.setMatrix(new g.Matrix4().setPosition(new g.Vector3(-1,-1,0)));var k={position:this.position,name:"billBoard1",type:"Spherical"};this.billBoardNode=new c(k);this.billBoardNode.addChild(p);this.addChild(this.billBoardNode);this.name="handleNode";this.manipulator=new j({axis:this.axis});this.manipulator.setExclusive(true);this.manipulator.linkToNode(this);this.manipulator.onBeginManipulate(function(u){m._modelEvent.publish({event:"ScalingBegin",data:u,context:this});m.pointMat.opacity=1;m.pointMat.color=new g.Color("#1B6E9C");m.isManipulated=true});this.manipulator.onManipulate(function(u){m._modelEvent.publish({event:"ScalingManipulation",data:u,context:this})});this.manipulator.onEndManipulate(function(u){m._modelEvent.publish({event:"ScalingEnd",data:u,context:this});if(!m.isPreactivated){m.pointMat.color=new g.Color("#FFFFFF")}else{m.pointMat.color=new g.Color("#A1D9ED")}m.isManipulated=false});this.manipulator.onBeginPreactivate(function(u){m._modelEvent.publish({event:"BeginPreactivate",data:u,context:this});if(!m.isManipulated&&m.enablePreactivate){u.viewer.setTemporaryCursor("pointer")}m.isPreactivated=true;if(!m.isManipulated&&m.enablePreactivate){m.pointMat.color=new g.Color("#A1D9ED")}u.viewer.render()});this.manipulator.onEndPreactivate(function(u){m._modelEvent.publish({event:"EndPreactivate",data:u,context:this});if(!m.isManipulated&&m.enablePreactivate){u.viewer.unsetTemporaryCursor()}m.isPreactivated=false;if(!m.isManipulated){m.pointMat.color=new g.Color("#FFFFFF")}u.viewer.render()});this.manipulator.onPrimaryPointerClick(function(u){m._modelEvent.publish({event:"PrimaryPointerClick",data:u,context:this})})},setCenter:function(k){this.manipulator.setCenter(k)},setAxis:function(k){this.axis=k;this.manipulator.axis=k},setParentManipulated:function(k){this.enablePreactivate=!k},setToGhostState:function(){this.pointMat.opacity=0},setToNonGhostState:function(){this.pointMat.opacity=1}});return UWA.namespace("THREEDS/Robot/ScalingNode",i)});define("Robot/ScalingNode",["DS/Robot/ScalingNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Robot/ScalingNode");return b});define("DS/Robot/XZRotationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/RotationManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory"],function(i,f,c,j,d,k,e,b,a,h){var g=f.extend({init:function(v){var q=this;this._parent(v.name);this.axis=v.constraintAxis;this._modelEvent=new a();this.isPreactivated=false;this.isManipulated=false;this.enablePreactivate=true;var p=new j();var s={width:8.5,height:8.5,fill:true,fillColor:null,noEdge:true};var t=p.createRectangle(s);var r=this;var u=c.getWebappsAssetUrl("Robot","");var n=new i.ImageUtils.loadTexture(u+"models/textures/Arc.png",undefined,null,null,i.ImageUtils.crossOriginPolicy);n.flipY=false;n.minFilter=i.LinearMipMapLinearFilter;this.planeMat=new i.MeshBasicMaterial({map:n,side:i.DoubleSide,transparent:true,alphaTest:0.05,enableClipPlanes:false});this.planeMat.force=true;var l=h.createMeshNode(t,this.planeMat);l.setShadow(false);l.setFrustumCulled(false);l.excludeFromCSO(true);l.excludeFromHighlight(true,true);l.setMatrix(new i.Matrix4().rotateX(0.5*Math.PI));this.addChild(l);if(this.touchMode){l.setPickable(e.NODRAWHL);var m=new i.ImageUtils.loadTexture(u+"models/textures/Arc_picking.png",undefined,null,null,i.ImageUtils.crossOriginPolicy);m.flipY=false;m.minFilter=i.LinearMipMapLinearFilter;this.planeMat_picking=new i.MeshBasicMaterial({map:m,side:i.DoubleSide,transparent:true,alphaTest:0.05,enableClipPlanes:false,opacity:0});this.planeMat_picking.force=true;var o=h.createMeshNode(t,this.planeMat_picking);o.setShadow(false);o.setFrustumCulled(false);o.excludeFromCSO(true);o.excludeFromHighlight(true,true);o.setMatrix(new i.Matrix4().rotateX(0.5*Math.PI));this.addChild(o)}this.manipulator=new k({axis:this.axis});this.manipulator.setExclusive(true);this.manipulator.linkToNode(this);this.manipulator.onBeginManipulate(function(w){q._modelEvent.publish({event:"RotationBegin",data:w,context:this});q.planeMat.opacity=1;q.planeMat.color=new i.Color("#1B6E9C");q.isManipulated=true});this.manipulator.onManipulate(function(w){q._modelEvent.publish({event:"RotationManipulation",data:w,context:this})});this.manipulator.onEndManipulate(function(w){q._modelEvent.publish({event:"RotationEnd",data:w,context:this});if(!q.isPreactivated){q.planeMat.color=new i.Color("#FFFFFF")}else{q.planeMat.color=new i.Color("#A1D9ED")}q.isManipulated=false});this.manipulator.onBeginPreactivate(function(w){q._modelEvent.publish({event:"BeginPreactivate",data:w,context:this});if(!q.isManipulated&&q.enablePreactivate){w.viewer.setTemporaryCursor("pointer")}q.isPreactivated=true;if(!q.isManipulated&&q.enablePreactivate){q.planeMat.color=new i.Color("#A1D9ED")}w.viewer.render()});this.manipulator.onEndPreactivate(function(w){q._modelEvent.publish({event:"EndPreactivate",data:w,context:this});if(!q.isManipulated&&q.enablePreactivate){w.viewer.unsetTemporaryCursor()}q.isPreactivated=false;if(!q.isManipulated){q.planeMat.color=new i.Color("#FFFFFF")}w.viewer.render()});this.manipulator.onPrimaryPointerClick(function(w){q._modelEvent.publish({event:"PrimaryPointerClick",data:w,context:this})})},setCenter:function(l){this.manipulator.setCenter(l)},setAxis:function(l){this.axis=l;this.manipulator.axis=l},setParentManipulated:function(l){this.enablePreactivate=!l},setToGhostState:function(){this.planeMat.opacity=0},setToNonGhostState:function(){this.planeMat.opacity=1}});return UWA.namespace("THREEDS/Robot/XZRotationNode",g)});define("Robot/XZRotationNode",["DS/Robot/XZRotationNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Robot/XZRotationNode");return b});define("DS/Robot/YZRotationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/RotationManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory"],function(i,g,c,j,d,k,e,b,a,h){var f=g.extend({init:function(v){var o=this;this._parent(v.name);this.axis=v.constraintAxis;this._modelEvent=new a();this.isPreactivated=false;this.isManipulated=false;this.enablePreactivate=true;this.touchMode=v.touchMode;var n=new j();var q={width:8.5,height:8.5,fill:true,fillColor:null,noEdge:true};var s=n.createRectangle(q);var p=this;var t=c.getWebappsAssetUrl("Robot","");var m=new i.ImageUtils.loadTexture(t+"models/textures/Arc.png",undefined,null,null,i.ImageUtils.crossOriginPolicy);m.flipY=false;m.minFilter=i.LinearMipMapLinearFilter;this.planeMat=new i.MeshBasicMaterial({map:m,side:i.DoubleSide,transparent:true,alphaTest:0.05,opacity:1,enableClipPlanes:false});this.planeMat.force=true;var u=h.createMeshNode(s,this.planeMat);u.setShadow(false);u.setFrustumCulled(false);u.excludeFromCSO(true);u.excludeFromHighlight(true,true);u.setMatrix(new i.Matrix4().rotateY(-0.5*Math.PI));this.addChild(u);if(this.touchMode){u.setPickable(e.NODRAWHL);var l=new i.ImageUtils.loadTexture(t+"models/textures/Arc_picking.png",undefined,null,null,i.ImageUtils.crossOriginPolicy);l.flipY=false;l.minFilter=i.LinearMipMapLinearFilter;this.planeMat_picking=new i.MeshBasicMaterial({map:l,side:i.DoubleSide,transparent:true,alphaTest:0.05,opacity:0,enableClipPlanes:false});this.planeMat_picking.force=true;var r=h.createMeshNode(s,this.planeMat_picking);r.setShadow(false);r.setFrustumCulled(false);r.excludeFromCSO(true);r.excludeFromHighlight(true,true);r.setMatrix(new i.Matrix4().rotateY(-0.5*Math.PI));this.addChild(r)}this.manipulator=new k({axis:this.axis});this.manipulator.setExclusive(true);this.manipulator.linkToNode(this);this.manipulator.onBeginManipulate(function(w){o._modelEvent.publish({event:"RotationBegin",data:w,context:this});o.planeMat.opacity=1;o.planeMat.color=new i.Color("#1B6E9C");o.isManipulated=true});this.manipulator.onManipulate(function(w){o._modelEvent.publish({event:"RotationManipulation",data:w,context:this})});this.manipulator.onEndManipulate(function(w){o._modelEvent.publish({event:"RotationEnd",data:w,context:this});if(!o.isPreactivated){o.planeMat.color=new i.Color("#FFFFFF")}else{o.planeMat.color=new i.Color("#A1D9ED")}o.isManipulated=false});this.manipulator.onBeginPreactivate(function(w){o._modelEvent.publish({event:"BeginPreactivate",data:w,context:this});if(!o.isManipulated&&o.enablePreactivate){w.viewer.setTemporaryCursor("pointer")}o.isPreactivated=true;if(!o.isManipulated&&o.enablePreactivate){o.planeMat.color=new i.Color("#A1D9ED")}w.viewer.render()});this.manipulator.onEndPreactivate(function(w){o._modelEvent.publish({event:"EndPreactivate",data:w,context:this});if(!o.isManipulated&&o.enablePreactivate){w.viewer.unsetTemporaryCursor()}o.isPreactivated=false;if(!o.isManipulated){o.planeMat.color=new i.Color("#FFFFFF")}w.viewer.render()});this.manipulator.onPrimaryPointerClick(function(w){o._modelEvent.publish({event:"PrimaryPointerClick",data:w,context:this})})},setCenter:function(l){this.manipulator.setCenter(l)},setAxis:function(l){this.axis=l;this.manipulator.axis=l},setParentManipulated:function(l){this.enablePreactivate=!l},setToGhostState:function(){this.planeMat.opacity=0},setToNonGhostState:function(){this.planeMat.opacity=1}});return UWA.namespace("THREEDS/Robot/YZRotationNode",f)});define("Robot/YZRotationNode",["DS/Robot/YZRotationNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Robot/YZRotationNode");return b});define("DS/Robot/XZPlaneTranslationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/PlaneTranslationManipulator","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils"],function(h,e,b,j,c,i,a,f,d){var g=e.extend({init:function(u){var p=this;this._parent(u.name);this.axis=u.constraintAxis;this._modelEvent=new a();this.isPreactivated=false;this.isManipulated=false;this.enablePreactivate=true;this.touchMode=u.touchMode;var o=new j();var r={width:6,height:6,fill:true,fillColor:null,noEdge:true};var s=o.createRectangle(r);var q=this;var t=b.getWebappsAssetUrl("Robot","");var m=new h.ImageUtils.loadTexture(t+"models/textures/PlaneTranslationNode.png",undefined,null,null,h.ImageUtils.crossOriginPolicy);m.flipY=false;m.minFilter=h.LinearMipMapLinearFilter;this.planeMat=new h.MeshBasicMaterial({map:m,side:h.DoubleSide,transparent:true,alphaTest:0.05,enableClipPlanes:false});this.planeMat.force=true;var l=f.createMeshNode(s,this.planeMat);l.setShadow(false);l.setFrustumCulled(false);l.excludeFromCSO(true);l.excludeFromHighlight(true,true);l.setMatrix(new h.Matrix4().rotateX(0.5*Math.PI).translate(new h.Vector3(0.5,0.5,0)));this.addChild(l);if(this.touchMode){l.setPickable(d.NODRAWHL);var k=new h.ImageUtils.loadTexture(t+"models/textures/PlaneTranslationNode_picking.png",undefined,null,null,h.ImageUtils.crossOriginPolicy);k.flipY=false;k.minFilter=h.LinearMipMapLinearFilter;this.planeMat_picking=new h.MeshBasicMaterial({map:k,side:h.DoubleSide,transparent:true,alphaTest:0.05,enableClipPlanes:false,opacity:0});this.planeMat_picking.force=true;var n=f.createMeshNode(s,this.planeMat_picking);n.setShadow(false);n.setFrustumCulled(false);n.excludeFromCSO(true);n.excludeFromHighlight(true,true);n.setMatrix(new h.Matrix4().rotateX(0.5*Math.PI).translate(new h.Vector3(0.5,0.5,0)));this.addChild(n)}this.manipulator=new i({axis:this.axis});this.manipulator.setExclusive(true);this.manipulator.linkToNode(this);this.manipulator.onPrimaryPointerClick(function(v){p._modelEvent.publish({event:"PrimaryPointerClick",data:{node:this},context:this})});this.manipulator.onBeginManipulate(function(v){p._modelEvent.publish({event:"PlaneTranslationBegin",data:v,context:this});p.planeMat.opacity=1;p.planeMat.color=new h.Color("#1B6E9C");p.isManipulated=true});this.manipulator.onManipulate(function(v){p._modelEvent.publish({event:"PlaneTranslationManipulation",data:v,context:this})});this.manipulator.onEndManipulate(function(v){p._modelEvent.publish({event:"PlaneTranslationEnd",data:v,context:this});if(!p.isPreactivated){p.planeMat.color=new h.Color("#FFFFFF")}else{p.planeMat.color=new h.Color("#A1D9ED")}p.isManipulated=false});this.manipulator.onBeginPreactivate(function(v){p._modelEvent.publish({event:"BeginPreactivate",data:v,context:this});if(!p.isManipulated&&p.enablePreactivate){v.viewer.setTemporaryCursor("pointer")}p.isPreactivated=true;if(!p.isManipulated&&p.enablePreactivate){p.planeMat.color=new h.Color("#A1D9ED")}v.viewer.render()});this.manipulator.onEndPreactivate(function(v){p._modelEvent.publish({event:"EndPreactivate",data:v,context:this});if(!p.isManipulated&&p.enablePreactivate){v.viewer.unsetTemporaryCursor()}p.isPreactivated=false;if(!p.isManipulated){p.planeMat.color=new h.Color("#FFFFFF")}v.viewer.render()})},setAxis:function(k){this.axis=k;this.manipulator.axis=k},setParentManipulated:function(k){this.enablePreactivate=!k},setToGhostState:function(){this.planeMat.opacity=0},setToNonGhostState:function(){this.planeMat.opacity=1}});return UWA.namespace("THREEDS/Robot/XZPlaneTranslationNode",g)});define("Robot/XZPlaneTranslationNode",["DS/Robot/XZPlaneTranslationNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Robot/XZPlaneTranslationNode");return b});define("DS/Robot/LineTranslationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/LineTranslationManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory"],function(j,h,e,k,f,c,g,d,b,i){var a=h.extend({init:function(y){var q=this;this._parent(y.name);this.axis=new j.Vector3(0,0,1);this.position=y.position;this._modelEvent=new b();this.isPreactivated=false;this.isManipulated=false;this.enablePreactivate=true;this.touchMode=y.touchMode;this.labelText=null;this.labelBillBoardNode=null;this.labelDistance=11.5;this.labelColor=null;var p=new k();var w={width:2,height:9,fill:true,fillColor:null,noEdge:true};var A={width:2,height:9.5,fill:true,fillColor:null,noEdge:true};var v=p.createRectangle(w);var o=p.createRectangle(A);var r=this;var x=e.getWebappsAssetUrl("Robot","");var u=new j.ImageUtils.loadTexture(x+"models/textures/AS_Arrow.png",undefined,null,null,j.ImageUtils.crossOriginPolicy);u.flipY=false;this.mat=new j.MeshBasicMaterial({map:u,side:j.DoubleSide,transparent:true,alphaTest:0.05,enableClipPlanes:false});this.mat.force=true;var m=i.createMeshNode(v,this.mat);m.setShadow(false);m.setFrustumCulled(false);m.excludeFromCSO(true);m.excludeFromHighlight(true,true);if(this.touchMode){m.setPickable(g.NODRAWHL);var t=new j.MeshBasicMaterial({map:u,transparent:true,opacity:0,enableClipPlanes:false,force:true});var l={bottomCenterPoint:new j.Vector3(0,0,0),topCenterPoint:new j.Vector3(0,0,7),radius:1,sag:60,material:t};var z=i.createCylinderNode(l);z.excludeFromCSO(true);z.excludeFromHighlight(true,true);z.setShadow(false);z.setFrustumCulled(false);this.addChild(z)}m.setMatrix(new j.Matrix4().rotateX(0.5*Math.PI).translate(new j.Vector3(-1,-1,0)));var n={position:this.position,name:"billBoardNode",type:"Cylindrical"};this.billBoardNode=new f(n);this.billBoardNode.addChild(m);var s=new j.Matrix4();s.setPosition(new j.Vector3().getPositionFromMatrix(this.getMatrix()));this.setMatrix(s);this.addChild(this.billBoardNode);this.manipulator=new c({axis:this.axis});this.manipulator.setExclusive(true);this.manipulator.linkToNode(this);this.manipulator.onPrimaryPointerClick(function(B){q._modelEvent.publish({event:"PrimaryPointerClick",data:B,context:this})});this.manipulator.onBeginManipulate(function(B){q._modelEvent.publish({event:"LineTranslationBegin",data:B,context:this});q.mat.opacity=1;q.mat.color=new j.Color("#1B6E9C");q.isManipulated=true});this.manipulator.onManipulate(function(B){q._modelEvent.publish({event:"LineTranslationManipulation",data:B,context:this})});this.manipulator.onEndManipulate(function(B){q._modelEvent.publish({event:"LineTranslationEnd",data:B,context:this});if(!q.isPreactivated){q.mat.color=new j.Color("#FFFFFF")}else{B.viewer.setTemporaryCursor("pointer")}q.isManipulated=false});this.manipulator.onBeginPreactivate(function(B){q._modelEvent.publish({event:"BeginPreactivate",data:{preactivated:B.preactivated,node:m},context:this});q.isPreactivated=true;if(!q.isManipulated&&q.enablePreactivate){q.mat.color=new j.Color("#A1D9ED")}if(!q.isManipulated&&q.enablePreactivate){B.viewer.setTemporaryCursor("pointer")}B.viewer.render()});this.manipulator.onEndPreactivate(function(B){q._modelEvent.publish({event:"EndPreactivate",data:{preactivated:B.preactivated,node:m},context:this});q.isPreactivated=false;if(!q.isManipulated){q.mat.color=new j.Color("#FFFFFF")}if(!q.isManipulated&&q.enablePreactivate){B.viewer.unsetTemporaryCursor()}B.viewer.render()})},setLabel:function(n,l){l=l||"grey";if(n!==this.labelText||this.labelColor!=l){this.labelColor=l;this.labelText=n;if(this.labelBillBoardNode){this.removeChild(this.labelBillBoardNode);this.labelBillBoardNode=null}if(n){var m=i.createTextNode({text:n,font:"Trebuchet MS",fontSize:2,color:new j.Color(l),hotspot:{x:0.5,y:0.5},zoom:1.3,_fix:true});if(m){this.labelBillBoardNode=new f({name:"labelBillBoardNode",type:"Spherical"});this._updateLabelPosition();m.setFrustumCulled(false);this.labelBillBoardNode.addChild(m);this.labelBillBoardNode.setPickable(g.NODRAWHL);this.addChild(this.labelBillBoardNode)}else{this.labelColor=null;this.labelText=null}}}},setAxis:function(l){this.manipulator.axis=l},_updateLabelPosition:function(m){if(m){this.labelDistance=m}if(this.labelBillBoardNode){var n=new j.Vector3(0,0,this.labelDistance);var l=new j.Matrix4();l.setPosition(n);this.labelBillBoardNode.setMatrix(l)}},setParentManipulated:function(l){this.enablePreactivate=!l},setToGhostState:function(){this.mat.opacity=0},setToNonGhostState:function(){this.mat.opacity=1},setToDragState:function(){this.mat.opacity=0.2}});return UWA.namespace("THREEDS/Robot/LineTranslationNode",a)});define("Robot/LineTranslationNode",["DS/Robot/LineTranslationNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Robot/LineTranslationNode");return b});define("DS/Robot/XYRotationNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/RotationManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Visualization/SceneGraphFactory"],function(i,g,d,j,e,k,f,c,b,h){var a=g.extend({init:function(v){var p=this;this._parent(v.name);this.axis=v.constraintAxis;this._modelEvent=new b();this.isPreactivated=false;this.isManipulated=false;this.enablePreactivate=true;this.touchMode=v.touchMode;var o=new j();var r={width:17,height:17,fill:true,fillColor:null,noEdge:true};var t=o.createRectangle(r);var q=this;var u=d.getWebappsAssetUrl("Robot","");var n=new i.ImageUtils.loadTexture(u+"models/textures/Rotation_FullArc_B.png",undefined,null,null,i.ImageUtils.crossOriginPolicy);n.flipY=false;n.minFilter=i.LinearMipMapLinearFilter;this.privilegedPlaneMat=new i.MeshBasicMaterial({map:n,side:i.DoubleSide,transparent:true,alphaTest:0.05,opacity:1,enableClipPlanes:false});this.privilegedPlaneMat.force=true;var m=h.createMeshNode(t,this.privilegedPlaneMat);m.setShadow(false);m.setFrustumCulled(false);m.excludeFromCSO(true);m.excludeFromHighlight(true,true);m.setMatrix(new i.Matrix4().setPosition(new i.Vector3(-8.5,-8.5,0)));this.addChild(m);if(this.touchMode){m.setPickable(f.NODRAWHL);var l=new i.ImageUtils.loadTexture(u+"models/textures/Rotation_FullArc_picking.png",undefined,null,null,i.ImageUtils.crossOriginPolicy);l.flipY=false;l.minFilter=i.LinearMipMapLinearFilter;this.privilegedPlaneMatPicking=new i.MeshBasicMaterial({map:l,side:i.DoubleSide,transparent:true,alphaTest:0.05,opacity:0,enableClipPlanes:false});this.privilegedPlaneMatPicking.force=true;var s=h.createMeshNode(t,this.privilegedPlaneMatPicking);s.setShadow(false);s.setFrustumCulled(false);s.excludeFromCSO(true);s.excludeFromHighlight(true,true);s.setMatrix(new i.Matrix4().setPosition(new i.Vector3(-8.5,-8.5,0)));this.addChild(s)}this.manipulator=new k({axis:this.axis});this.manipulator.setExclusive(true);this.manipulator.linkToNode(this);this.manipulator.onBeginManipulate(function(w){p._modelEvent.publish({event:"RotationBegin",data:w,context:this});p.privilegedPlaneMat.opacity=1;p.privilegedPlaneMat.color=new i.Color("#1B6E9C");p.isManipulated=true});this.manipulator.onManipulate(function(w){p._modelEvent.publish({event:"RotationManipulation",data:w,context:this})});this.manipulator.onEndManipulate(function(w){p._modelEvent.publish({event:"RotationEnd",data:w,context:this});if(!p.isPreactivated){p.privilegedPlaneMat.color=new i.Color("#FFFFFF")}else{p.privilegedPlaneMat.color=new i.Color("#A1D9ED")}p.isManipulated=false});this.manipulator.onBeginPreactivate(function(w){p._modelEvent.publish({event:"BeginPreactivate",data:w,context:this});if(!p.isManipulated&&p.enablePreactivate){w.viewer.setTemporaryCursor("pointer")}p.isPreactivated=true;if(!p.isManipulated&&p.enablePreactivate){p.privilegedPlaneMat.color=new i.Color("#A1D9ED")}w.viewer.render()});this.manipulator.onEndPreactivate(function(w){p._modelEvent.publish({event:"EndPreactivate",data:w,context:this});if(!p.isManipulated&&p.enablePreactivate){w.viewer.unsetTemporaryCursor()}p.isPreactivated=false;if(!p.isManipulated){p.privilegedPlaneMat.color=new i.Color("#FFFFFF")}w.viewer.render()});this.manipulator.onPrimaryPointerClick(function(w){p._modelEvent.publish({event:"PrimaryPointerClick",data:w,context:this})})},setCenter:function(l){this.manipulator.setCenter(l)},setAxis:function(l){this.axis=l;this.manipulator.setAxis(l)},setParentManipulated:function(l){this.enablePreactivate=!l},setToGhostState:function(){this.privilegedPlaneMat.opacity=0},setToNonGhostState:function(){this.privilegedPlaneMat.opacity=1}});return UWA.namespace("THREEDS/Robot/XYRotationNode",a)});define("Robot/XYRotationNode",["DS/Robot/XYRotationNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Robot/XYRotationNode");return b});define("DS/Robot/FreeRobot",["DS/SceneGraphNodes/FixedSizeNode3D","DS/Mesh/MeshUtils","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Robot/LineTranslationNode","DS/Robot/XYRotationNode","DS/Robot/XZRotationNode","DS/Robot/YZRotationNode","DS/Robot/YZPlaneTranslationNode","DS/Robot/XYPlaneTranslationNode","DS/Robot/XZPlaneTranslationNode","DS/Robot/RobotHandle","DS/Robot/ScalingNode","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Selection/HSOManager"],function(l,b,r,g,j,k,n,c,o,d,f,p,q,m,i,e){var a=false;var h=g.extend({init:function(K,v,z,x,y){this._parent(K);this.setParameters(z,x);var C=this;this.isManipulated=false;this.sceneGraphState=null;this.mode="NODE";this._labels={};this._modelEvent=new i();this._subscribedEvents=[];var t={position:new r.Vector3(0,0,0),touchMode:y||false};this.arrowZ=new j(t);this.arrowZ.setMatrix(new r.Matrix4().setPosition(new r.Vector3(0,0,2)));this.arrowZ.name="arrowZ";this.arrowY=new j(t);this.arrowY.setMatrix(new r.Matrix4().rotateX(-Math.PI/2).setPosition(new r.Vector3(0,2,0)));this.arrowY.name="arrowY";this.arrowX=new j(t);this.arrowX.setMatrix(new r.Matrix4().rotateY(Math.PI/2).setPosition(new r.Vector3(2,0,0)));this.arrowX.name="arrowX";var H={constraintAxis:new r.Vector3(0,0,1),touchMode:y||false};this.rotationArcXY=new k(H);var I={constraintAxis:new r.Vector3(0,1,0),touchMode:y||false};this.rotationArcXZ=new n(I);this.rotationArcXZ.name="rotationArcXZ";var J={constraintAxis:new r.Vector3(1,0,0),touchMode:y||false};this.rotationArcYZ=new c(J);this.rotationArcYZ.name="rotationArcYZ";var D={position:new r.Vector3(0,0,0),touchMode:y||false};this.robotHandle=new p(D);var G={constraintAxis:new r.Vector3(1,0,0),touchMode:y||false};this.scalingNodeX=new q(G);this.scalingNodeX.setMatrix(new r.Matrix4().setPosition(new r.Vector3(11,0,0)));var F={constraintAxis:new r.Vector3(0,1,0),touchMode:y||false};this.scalingNodeY=new q(F);this.scalingNodeY.setMatrix(new r.Matrix4().setPosition(new r.Vector3(0,11,0)));var E={constraintAxis:new r.Vector3(0,0,1),touchMode:y||false};this.scalingNodeZ=new q(E);this.scalingNodeZ.setMatrix(new r.Matrix4().setPosition(new r.Vector3(0,0,11)));var B={constraintAxis:new r.Vector3(0,0,1),touchMode:y||false};var A={constraintAxis:new r.Vector3(0,1,0),touchMode:y||false};var s={constraintAxis:new r.Vector3(1,0,0),touchMode:y||false};this.translationPlaneXY=new d(B);this.translationPlaneXZ=new f(A);this.translationPlaneYZ=new o(s);this.name="robot";this.fixedSizeNode3D=new l({name:"fixedSizeNode3D",ratio:7});this.fixedSizeNode3D.addChild(this.rotationArcXY);this.fixedSizeNode3D.addChild(this.rotationArcYZ);this.fixedSizeNode3D.addChild(this.rotationArcXZ);this.fixedSizeNode3D.addChild(this.arrowZ);this.fixedSizeNode3D.addChild(this.arrowX);this.fixedSizeNode3D.addChild(this.arrowY);this.fixedSizeNode3D.addChild(this.robotHandle);this.fixedSizeNode3D.addChild(this.scalingNodeZ);this.fixedSizeNode3D.addChild(this.scalingNodeY);this.fixedSizeNode3D.addChild(this.scalingNodeX);this.fixedSizeNode3D.addChild(this.translationPlaneYZ);this.fixedSizeNode3D.addChild(this.translationPlaneXY);this.fixedSizeNode3D.addChild(this.translationPlaneXZ);this.addChild(this.fixedSizeNode3D);this.setVisibilityInTree(false);this.setRenderPasses(["robot"]);this._subscribeModelEvent(this.arrowX,"LineTranslationBegin",C.LineTranslationBeginCB.bind(C));this._subscribeModelEvent(this.arrowX,"LineTranslationManipulation",C.LineTranslationManipulationCB.bind(C));this._subscribeModelEvent(this.arrowX,"LineTranslationEnd",C.LineTranslationEndCB.bind(C));this._subscribeModelEvent(this.arrowY,"LineTranslationBegin",C.LineTranslationBeginCB.bind(C));this._subscribeModelEvent(this.arrowY,"LineTranslationManipulation",C.LineTranslationManipulationCB.bind(C));this._subscribeModelEvent(this.arrowY,"LineTranslationEnd",C.LineTranslationEndCB.bind(C));this._subscribeModelEvent(this.arrowZ,"LineTranslationBegin",C.LineTranslationBeginCB.bind(C));this._subscribeModelEvent(this.arrowZ,"LineTranslationManipulation",C.LineTranslationManipulationCB.bind(C));this._subscribeModelEvent(this.arrowZ,"LineTranslationEnd",C.LineTranslationEndCB.bind(C));this._subscribeModelEvent(this.translationPlaneYZ,"PlaneTranslationBegin",C.PlaneTranslationBeginCB.bind(C));this._subscribeModelEvent(this.translationPlaneYZ,"PlaneTranslationManipulation",C.PlaneTranslationManipulationCB.bind(C));this._subscribeModelEvent(this.translationPlaneYZ,"PlaneTranslationEnd",C.PlaneTranslationEndCB.bind(C));this._subscribeModelEvent(this.translationPlaneXZ,"PlaneTranslationBegin",C.PlaneTranslationBeginCB.bind(C));this._subscribeModelEvent(this.translationPlaneXZ,"PlaneTranslationManipulation",C.PlaneTranslationManipulationCB.bind(C));this.translationPlaneXZ._modelEvent.subscribe({event:"PlaneTranslationEnd"},C.PlaneTranslationEndCB.bind(C));this._subscribeModelEvent(this.translationPlaneXY,"PlaneTranslationBegin",C.PlaneTranslationBeginCB.bind(C));this._subscribeModelEvent(this.translationPlaneXY,"PlaneTranslationManipulation",C.PlaneTranslationManipulationCB.bind(C));this._subscribeModelEvent(this.translationPlaneXY,"PlaneTranslationEnd",C.PlaneTranslationEndCB.bind(C));this._subscribeModelEvent(this.rotationArcXY,"RotationBegin",C.RotationBeginCB.bind(C));this._subscribeModelEvent(this.rotationArcXY,"RotationManipulation",C.RotationManipulationCB.bind(C));this._subscribeModelEvent(this.rotationArcXY,"RotationEnd",C.RotationEndCB.bind(C));this._subscribeModelEvent(this.rotationArcXZ,"RotationBegin",C.RotationBeginCB.bind(C));this._subscribeModelEvent(this.rotationArcXZ,"RotationManipulation",C.RotationManipulationCB.bind(C));this._subscribeModelEvent(this.rotationArcXZ,"RotationEnd",C.RotationEndCB.bind(C));this._subscribeModelEvent(this.rotationArcYZ,"RotationBegin",C.RotationBeginCB.bind(C));this._subscribeModelEvent(this.rotationArcYZ,"RotationManipulation",C.RotationManipulationCB.bind(C));this._subscribeModelEvent(this.rotationArcYZ,"RotationEnd",C.RotationEndCB.bind(C));this._subscribeModelEvent(this.scalingNodeX,"ScalingBegin",C.ScalingBeginCB.bind(C));this._subscribeModelEvent(this.scalingNodeX,"ScalingManipulation",C.ScalingManipulationCB.bind(C));this._subscribeModelEvent(this.scalingNodeX,"ScalingEnd",C.ScalingEndCB.bind(C));this._subscribeModelEvent(this.scalingNodeY,"ScalingBegin",C.ScalingBeginCB.bind(C));this._subscribeModelEvent(this.scalingNodeY,"ScalingManipulation",C.ScalingManipulationCB.bind(C));this._subscribeModelEvent(this.scalingNodeY,"ScalingEnd",C.ScalingEndCB.bind(C));this._subscribeModelEvent(this.scalingNodeZ,"ScalingBegin",C.ScalingBeginCB.bind(C));this._subscribeModelEvent(this.scalingNodeZ,"ScalingManipulation",C.ScalingManipulationCB.bind(C));this._subscribeModelEvent(this.scalingNodeZ,"ScalingEnd",C.ScalingEndCB.bind(C));this._subscribeModelEvent(this.robotHandle,"ScreenPlaneTranslationBegin",C.ScreenPlaneTranslationBeginCB.bind(C));this._subscribeModelEvent(this.robotHandle,"ScreenPlaneTranslationManipulation",C.ScreenPlaneTranslationManipulationCB.bind(C));this._subscribeModelEvent(this.robotHandle,"ScreenPlaneTranslationEnd",C.ScreenPlaneTranslationEndCB.bind(C));this._labelColor=null;this._updateLabelColor(v);var u=v.onBackgroundModify(function w(){C._updateLabelColor(v);C.setLabels(C._labels)});this._subscribedEvents.push({object:v,token:u});this.snapFilterCallback=null;this.snapTranslationCallback=null;this.snapRotationCallback=null;this.target=null;this.initialMatrix=null;this.initialTargetWorldMatrix=null;this.robotRotationMatrix=null},setRatio:function(s){s=s||{ratio:7};this.fixedSizeNode3D.setRatio(s.ratio)},setParameters:function(t,s){this.snapOnFace=t;this.showOnlyManipulated=s},setLabels:function(s){s=s||{};this._labels=s;this.arrowX.setLabel(s.labelX,this._labelColor);this.arrowY.setLabel(s.labelY,this._labelColor);this.arrowZ.setLabel(s.labelZ,this._labelColor)},setMoveMode:function(t,s){if(t==="OCCURRENCE"){if(!a){console.warn("OCCURRENCE move mode is no more supported");a=true}return}this.mode=t;this.sceneGraphState=s?s.sceneGraphState:null},setDisplayScalingNodes:function(s){this.scalingNodeX.setVisibility(s?true:false);this.scalingNodeY.setVisibility(s?true:false);this.scalingNodeZ.setVisibility(s?true:false);var t=s?11.5:9;this.arrowX._updateLabelPosition(t);this.arrowY._updateLabelPosition(t);this.arrowZ._updateLabelPosition(t)},getNodeType:function(){return"FreeRobot"},LineTranslationBeginCB:function(s){if(this.target){this.setManipulated(true);this.initialMatrix=new r.Matrix4().copy(this.getMatrix());this.initialTargetWorldMatrix=new r.Matrix4().copy(this.target.getWorldMatrix(s.viewer));if(this.showOnlyManipulated){this.setToGhostState()}s.viewer.render()}this._modelEvent.publish({event:"LineTranslationBegin",data:{eventChannel:"LineTranslationBegin",target:this.target,intersection:s.intersection,manipulator:s.manipulator,event:s.event}})},LineTranslationManipulationCB:function(y){var t=y.translationVector;if(this.target){var z=y.paths[0].externalPath;if(this.contains(this,z)){if(this.snapTranslationCallback){t=this.snapTranslationCallback({translationVector:t,target:this.target,intersection:y.intersection});if(!t){return}}var B=new r.Vector3();B.getPositionFromMatrix(this.initialMatrix);B.add(t);var C=new r.Matrix4().copy(this.getMatrix());this.setMatrix(C.setPosition(B));this.updateCenterPosition(B);var A=new r.Vector3();A.getPositionFromMatrix(this.initialTargetWorldMatrix);A.add(t);var E=new r.Matrix4().copy(this.initialTargetWorldMatrix).setPosition(A);if(this.sceneGraphState&&this.mode==="OCCURRENCE_secret"){this.sceneGraphState.applyAbsolutePositionToPath(this.target,E)}else{if(this.mode==="NODE"){var s=this.target.externalPath;var D;var u=this.target.getParentPath();if(u){D=u.getWorldMatrix(y.viewer)}else{D=new r.Matrix4()}var x=new r.Matrix4();x.getInverse(D);var w=x.multiply(E);var v=s[s.length-1];v.setMatrix(w)}}y.viewer.render()}}this._modelEvent.publish({event:"LineTranslationManipulation",data:{eventChannel:"LineTranslationManipulation",target:this.target,translationVector:t,intersection:y.intersection,manipulator:y.manipulator,event:y.event}})},LineTranslationEndCB:function(s){if(this.target){this.setManipulated(false);if(this.showOnlyManipulated){this.setToNonGhostState()}s.viewer.render()}this._modelEvent.publish({event:"LineTranslationEnd",data:{eventChannel:"LineTranslationEnd",target:this.target,intersection:s.intersection,manipulator:s.manipulator,event:s.event}})},PlaneTranslationBeginCB:function(s){if(this.target){this.setManipulated(true);this.initialMatrix=new r.Matrix4().copy(this.getMatrix());this.initialTargetWorldMatrix=new r.Matrix4().copy(this.target.getWorldMatrix(s.viewer));if(this.showOnlyManipulated){this.setToGhostState()}s.viewer.render()}this._modelEvent.publish({event:"PlaneTranslationBegin",data:{eventChannel:"PlaneTranslationBegin",target:this.target,intersection:s.intersection,manipulator:s.manipulator,event:s.event}})},PlaneTranslationManipulationCB:function(x){if(this.target){var y=x.paths[0].externalPath;if(this.contains(this,y)){var A=new r.Vector3();A.getPositionFromMatrix(this.initialMatrix);A.add(x.translationVector);var B=new r.Matrix4().copy(this.getMatrix());this.setMatrix(B.setPosition(A));this.updateCenterPosition(A)}var z=new r.Vector3();z.getPositionFromMatrix(this.initialTargetWorldMatrix);z.add(x.translationVector);var D=(new r.Matrix4().copy(this.initialTargetWorldMatrix)).setPosition(z);if(this.sceneGraphState&&this.mode==="OCCURRENCE_secret"){this.sceneGraphState.applyAbsolutePositionToPath(this.target,D)}else{if(this.mode==="NODE"){var s=this.target.externalPath;var C;var t=this.target.getParentPath();if(t){C=t.getWorldMatrix(x.viewer)}else{C=new r.Matrix4()}var w=new r.Matrix4();w.getInverse(C);var v=w.multiply(D);var u=s[s.length-1];u.setMatrix(v)}}x.viewer.render()}this._modelEvent.publish({event:"PlaneTranslationManipulation",data:{eventChannel:"PlaneTranslationManipulation",target:this.target,translationVector:x.translationVector,intersection:x.intersection,manipulator:x.manipulator,event:x.event}})},PlaneTranslationEndCB:function(s){if(this.target){this.setManipulated(false);if(this.showOnlyManipulated){this.setToNonGhostState()}s.viewer.render()}this._modelEvent.publish({event:"PlaneTranslationEnd",data:{eventChannel:"PlaneTranslationEnd",target:this.target,intersection:s.intersection,manipulator:s.manipulator,event:s.event}})},RotationBeginCB:function(s){if(this.target){this.setManipulated(true);this.initialMatrix=new r.Matrix4().copy(this.getMatrix());this.initialTargetWorldMatrix=new r.Matrix4();this.target.getWorldMatrix(s.viewer,this.initialTargetWorldMatrix);if(this.showOnlyManipulated){this.setToGhostState()}s.viewer.render()}this._modelEvent.publish({event:"RotationBegin",data:{eventChannel:"RotationBegin",target:this.target,intersection:s.intersection,manipulator:s.manipulator,event:s.event}})},RotationManipulationCB:function(K){var v=K.angle;var J=K.axis;if(this.target){var y=K.paths[0].externalPath;var B=K.rotationMatrix;if(this.snapRotationCallback){var G=this.snapRotationCallback({axis:K.axis,angle:K.angle,target:this.target,intersection:K.intersection});v=G.value;J=G.axis;if((v===undefined)||!J){return}v=Math.PI*v/180;B=new r.Matrix4().makeRotationAxis(J,v)}if(this.contains(this,y)){var F=new r.Matrix4().copy(B);F.multiply(new r.Matrix4().extractRotation(this.initialMatrix));var H=F.setPosition(new r.Vector3().getPositionFromMatrix(this.initialMatrix));this.setMatrix(H)}var E=new r.Matrix4().copy(this.initialTargetWorldMatrix);var B=new r.Matrix4().makeRotationAxis(J,v);var u=new r.Matrix4().setPosition(new r.Vector3().getPositionFromMatrix(this.initialMatrix));var w=new r.Matrix4().getInverse(u).multiply(E);var z=new r.Matrix4().copy(B).multiply(w);var I=new r.Matrix4().copy(u).multiply(z);if(this.sceneGraphState&&this.mode==="OCCURRENCE_secret"){this.sceneGraphState.applyAbsolutePositionToPath(this.target,I)}else{if(this.mode==="NODE"){var C=this.target.externalPath;var t=new r.Matrix4();var x=this.target.getParentPath();if(x){x.getWorldMatrix(K.viewer,t)}var s=new r.Matrix4();s.getInverse(t);var A=s.multiply(I);var D=C[C.length-1];D.setMatrix(A)}}K.viewer.render()}this._modelEvent.publish({event:"RotationManipulation",data:{eventChannel:"RotationManipulation",target:this.target,rotationMatrix:K.rotationMatrix,rotationCenter:K.center,angle:v,axis:J,intersection:K.intersection,manipulator:K.manipulator,event:K.event}})},RotationEndCB:function(t){if(this.target){this.setManipulated(false);this.robotRotationMatrix=new r.Matrix4().extractRotation(this.getMatrix());var v=new r.Vector3(this.robotRotationMatrix.elements[0],this.robotRotationMatrix.elements[1],this.robotRotationMatrix.elements[2]).normalize();var u=new r.Vector3(this.robotRotationMatrix.elements[4],this.robotRotationMatrix.elements[5],this.robotRotationMatrix.elements[6]).normalize();var s=new r.Vector3(this.robotRotationMatrix.elements[8],this.robotRotationMatrix.elements[9],this.robotRotationMatrix.elements[10]).normalize();this.updateAxis(v,u,s);if(this.showOnlyManipulated){this.setToNonGhostState()}t.viewer.render()}this._modelEvent.publish({event:"RotationEnd",data:{eventChannel:"RotationEnd",target:this.target,intersection:t.intersection,manipulator:t.manipulator,event:t.event}})},ScalingBeginCB:function(s){if(this.target){this.setManipulated(true);this.initialMatrix=new r.Matrix4().copy(this.target.getWorldMatrix(s.viewer));if(this.showOnlyManipulated){this.setToGhostState()}s.viewer.render()}this._modelEvent.publish({event:"ScalingBegin",data:{eventChannel:"ScalingBegin",target:this.target,intersection:s.intersection,manipulator:s.manipulator,event:s.event}})},ScalingManipulationCB:function(y){if(this.target){var z=y.paths[0].externalPath;if(this.contains(this,z)){var s=new r.Matrix4();s.copy(y.scalingMatrix);s.multiply(new r.Matrix4().copy(this.initialMatrix));if(this.sceneGraphState&&this.mode==="OCCURRENCE_secret"){this.sceneGraphState.applyAbsolutePositionToPath(this.target,s)}else{if(this.mode==="NODE"){var t=this.target.externalPath;var A;var u=this.target.getParentPath();if(u){A=u.getWorldMatrix(y.viewer)}else{A=new r.Matrix4()}var x=new r.Matrix4();x.getInverse(A);var w=x.multiply(s);var v=t[t.length-1];v.setMatrix(w)}}y.viewer.render()}}this._modelEvent.publish({event:"ScalingManipulation",data:{eventChannel:"ScalingManipulation",target:this.target,scalingFactor:y.scalingFactor,scalingCenter:y.center,intersection:y.intersection,manipulator:y.manipulator,event:y.event}})},ScalingEndCB:function(s){if(this.target){this.setManipulated(false);if(this.showOnlyManipulated){this.setToNonGhostState()}s.viewer.render()}this._modelEvent.publish({event:"ScalingEnd",data:{eventChannel:"ScalingEnd",target:this.target,scalingFactor:s.scalingFactor,scalingCenter:s.center,intersection:s.intersection,manipulator:s.manipulator,event:s.event}})},ScreenPlaneTranslationBeginCB:function(s){this._modelEvent.publish({event:"ScreenPlaneTranslationBegin",data:{eventChannel:"ScreenPlaneTranslationBegin",position:s.position,intersection:s.intersection,manipulator:s.manipulator,event:s.event}})},ScreenPlaneTranslationManipulationCB:function(s){this._modelEvent.publish({event:"ScreenPlaneTranslationManipulation",data:{eventChannel:"ScreenPlaneTranslationManipulation",intersection:s.intersection,manipulator:s.manipulator,event:s.event}})},ScreenPlaneTranslationEndCB:function(s){this._modelEvent.publish({event:"ScreenPlaneTranslationEnd",data:{eventChannel:"ScreenPlaneTranslationEnd",target:this.target,intersection:s.intersection,manipulator:s.manipulator,event:s.event}})},setRobotMatrix:function(s){this.setMatrix(s);this.updateCenterPosition(new r.Vector3().getPositionFromMatrix(s));var v=new r.Vector3();var u=new r.Vector3();var t=new r.Vector3();s.extractBasis(v,u,t);this.updateAxis(v,u,t)},updateCenterPosition:function(s){this.rotationArcXY.setCenter(s);this.rotationArcXZ.setCenter(s);this.rotationArcYZ.setCenter(s);this.scalingNodeZ.setCenter(s);this.scalingNodeX.setCenter(s);this.scalingNodeY.setCenter(s)},updateAxis:function(u,t,s){this.arrowX.setAxis(u);this.arrowY.setAxis(t);this.arrowZ.setAxis(s);this.translationPlaneYZ.setAxis(u);this.translationPlaneXY.setAxis(s);this.translationPlaneXZ.setAxis(t);this.scalingNodeY.setAxis(t);this.scalingNodeX.setAxis(u);this.scalingNodeZ.setAxis(s);this.rotationArcYZ.setAxis(u);this.rotationArcXZ.setAxis(t);this.rotationArcXY.setAxis(s)},setManipulated:function(s){this.isManipulated=s;this.arrowX.setParentManipulated(s);this.arrowY.setParentManipulated(s);this.arrowZ.setParentManipulated(s);this.translationPlaneYZ.setParentManipulated(s);this.translationPlaneXY.setParentManipulated(s);this.translationPlaneXZ.setParentManipulated(s);this.scalingNodeY.setParentManipulated(s);this.scalingNodeX.setParentManipulated(s);this.scalingNodeZ.setParentManipulated(s);this.rotationArcYZ.setParentManipulated(s);this.rotationArcXZ.setParentManipulated(s);this.rotationArcXY.setParentManipulated(s);this.robotHandle.setParentManipulated(s)},setToGhostState:function(){this.arrowX.setToGhostState();this.arrowY.setToGhostState();this.arrowZ.setToGhostState();this.translationPlaneYZ.setToGhostState();this.translationPlaneXY.setToGhostState();this.translationPlaneXZ.setToGhostState();this.scalingNodeY.setToGhostState();this.scalingNodeX.setToGhostState();this.scalingNodeZ.setToGhostState();this.robotHandle.setToGhostState();this.rotationArcYZ.setToGhostState();this.rotationArcXZ.setToGhostState();this.rotationArcXY.setToGhostState()},setToNonGhostState:function(){this.arrowX.setToNonGhostState();this.arrowY.setToNonGhostState();this.arrowZ.setToNonGhostState();this.translationPlaneYZ.setToNonGhostState();this.translationPlaneXY.setToNonGhostState();this.translationPlaneXZ.setToNonGhostState();this.scalingNodeY.setToNonGhostState();this.scalingNodeX.setToNonGhostState();this.scalingNodeZ.setToNonGhostState();this.robotHandle.setToNonGhostState();this.rotationArcYZ.setToNonGhostState();this.rotationArcXZ.setToNonGhostState();this.rotationArcXY.setToNonGhostState()},subscribe:function(s,t){return this._modelEvent.subscribe({event:s},t)},unsubscribe:function(s){this._modelEvent.unsubscribe(s)},setTarget:function(A,t,s){this.target=A;var y=t?t.clone():null;if(!y){y=this.target.getWorldMatrix(s);var z=this.target.getBoundingSphere();y.setPosition(z.center)}this.setMatrix(y);var v=new r.Vector3();v.getPositionFromMatrix(y);this.updateCenterPosition(v);var x=new r.Vector3();var w=new r.Vector3();var u=new r.Vector3();this.getMatrix().extractBasis(x,w,u);this.updateAxis(x,w,u)},contains:function(t,u){for(var s=0;s<u.length;s++){if(u[s]===t){return true}}return false},_dispose:function(){var t,s;for(t=0;t<this._subscribedEvents.length;t++){s=this._subscribedEvents[t];s.object.unsubscribe(s.token)}this._subscribedEvents=[];this._modelEvent.destroy()},_subscribeModelEvent:function(t,s,u){this._subscribe(t._modelEvent,s,u)},_subscribe:function(t,s,v){var u=t.subscribe({event:s},v);this._subscribedEvents.push({object:t,token:u})},_updateLabelColor:function(u){var s=new r.Color(u.backgroundColor);var t=Math.round(((s.r*255*299)+(s.g*255*587)+(s.b*255*114))/1000);if(t>125){this._labelColor="grey"}else{this._labelColor="white"}}});return UWA.namespace("THREEDS/Nodes/FreeRobot",h)});define("Robot/FreeRobot",["DS/Robot/FreeRobot","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Robot/FreeRobot");return b});define("DS/Robot/Robot",["DS/Robot/FreeRobot","DS/Mesh/MeshUtils","DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Selection/HSOManager","DS/Selection/CSOManager","DS/Robot/ReferenceAxisSystemNode"],function(b,h,j,f,c,d,g,e){var a={x:new j.Vector3(),y:new j.Vector3(),z:new j.Vector3()};var i=b.extend({init:function(l,k,m,p,o,q,n){if(q!=="I solemnly swear that I am up to no good."){console.warn("DEPRECATED API USE: create Robot using 'webGLV6Viewer.setRobot(true, {snapOnFace: true});\nStack: "+(new Error()).stack)}this._parent(k,m,p,o,n);this.viewer=m;this.sceneGraph=l;this._addToCSO=true;this._addToHSO=true;this.hiddenMode=false;this.moveViewpointOnClickDuration=1000;this._enabled=true;this._showLabels=true;this._viewPlane=null;this._viewPlaneOrientation=0;this.ratio=null;this.isConnected=false;this.isManipulatedInPlane=false;this._getPositionCB=null;var r=this;this.setVisibilityFree(true);m._addRobot(this,this.sceneGraph);this._subscribe(this.translationPlaneXY._modelEvent,"PrimaryPointerClick",function(s){r.moveViewToPlane("XY")});this._subscribe(this.translationPlaneXZ._modelEvent,"PrimaryPointerClick",function(s){r.moveViewToPlane("XZ")});this._subscribe(this.translationPlaneYZ._modelEvent,"PrimaryPointerClick",function(s){r.moveViewToPlane("YZ")});this._subscribe(this.rotationArcXY._modelEvent,"PrimaryPointerClick",function(s){r.moveViewToPlane("XY")});this._subscribe(this.rotationArcXZ._modelEvent,"PrimaryPointerClick",function(s){r.moveViewToPlane("XZ")});this._subscribe(this.rotationArcYZ._modelEvent,"PrimaryPointerClick",function(s){r.moveViewToPlane("YZ")});this._subscribe(this.arrowZ._modelEvent,"PrimaryPointerClick",function(s){r.moveViewToPlane("XY")});this._subscribe(this.arrowY._modelEvent,"PrimaryPointerClick",function(s){r.moveViewToPlane("XZ")});this._subscribe(this.arrowX._modelEvent,"PrimaryPointerClick",function(s){r.moveViewToPlane("YZ")});this._subscribe(this.scalingNodeZ._modelEvent,"PrimaryPointerClick",function(s){r.moveViewToPlane("XY")});this._subscribe(this.scalingNodeY._modelEvent,"PrimaryPointerClick",function(s){r.moveViewToPlane("XZ")});this._subscribe(this.scalingNodeX._modelEvent,"PrimaryPointerClick",function(s){r.moveViewToPlane("YZ")});this.robotHandle.setCameraName("robotCameraOrtho");this.snapFilterCallback=null;this.snapTranslationCallback=null;this.snapRotationCallback=null;this.manipulationX=0;this.manipulationY=0;this._setOrthoState(true);this.setRatio(null)},setRatio:function(k){this.ratio=k||{docked:7,moving:10,connected:10};this._updateRatio()},setAddToCSO:function(k){this._addToCSO=k},setAddToHSO:function(k){this._addToHSO=k},getNodeType:function(){return"Robot"},ScreenPlaneTranslationBeginCB:function(l){this.isManipulatedInPlane=true;this.setManipulated(true);this.initialMatrix=new j.Matrix4().copy(this.getMatrix());this._updateRatio();this.setPickable(h.NODRAWHL);this.viewer.renderer.pickingGPUComposerContext.needsUpdate=true;this.viewer.renderer.depthComposerContext.needsUpdate=true;this.viewer.renderer.normalComposerContext.needsUpdate=true;var n=new j.Vector3(1,0,0);var m=new j.Vector3(0,1,0);var k=new j.Vector3(0,0,1);this.updateAxis(n,m,k);if(this.showOnlyManipulated){this.setToDragState()}this._parent(l);var o=this.getMousePosition(l.event);this.manipulationX=o.x;this.manipulationY=o.y;this._setOrthoState(true);this.onViewpointChange();this._updateLabelsAndReferenceAxisSystem()},ScreenPlaneTranslationManipulationCB:function(k){this._setOrthoState(true);var m=k.paths[0].externalPath;if(this.contains(this,m)){var l=this.getMousePosition(k.event);this.manipulationX=l.x;this.manipulationY=l.y;this.onViewpointChange();this.viewer.render();this._parent(k)}this._updateLabelsAndReferenceAxisSystem()},getMousePosition:function(k){var l=k.from[1]||k.from[0];return l.getCurrentPosition(this.viewer.canvas)},ScreenPlaneTranslationEndCB:function(r){this.isManipulatedInPlane=false;this.setManipulated(false);var k=r.intersection;var s=k.position&&k.path.length;var u=s?k.path[0]:null;if(s&&this.snapFilterCallback){u=this.snapFilterCallback(u);if(u===null||u===undefined){s=false}}if(s){this._setOrthoState(false);this.isConnected=true;this.target=u;if(this._addToHSO){d.empty();d.add({pathElement:this.target})}if(this._addToCSO){g.empty();g.add({pathElement:this.target})}var v=new j.Matrix4();if(this.snapOnFace){var m=k.normal;m.normalize();var o=new j.Vector3(1,0,0).projectOnPlane(m);var t=o.length();var n=new j.Vector3(0,1,0).projectOnPlane(m);var q=n.length();var l=new j.Vector3().crossVectors(new j.Vector3(0,0,1),m);var p=new j.Vector3(0,0,1).dot(m);if(Math.abs(p)>0.999){if(Math.abs(t-q)<0.0005){o.normalize();n.normalize()}else{if(t<q){n=new j.Vector3(0,1,0).projectOnPlane(m);n.normalize();o=new j.Vector3().crossVectors(n,m).normalize()}else{o=new j.Vector3(1,0,0).projectOnPlane(m);o.normalize();n=new j.Vector3().crossVectors(m,o).normalize()}}}else{o=l.normalize();n=new j.Vector3().crossVectors(m,o).normalize()}v=new j.Matrix4(o.x,n.x,m.x,0,o.y,n.y,m.y,0,o.z,n.z,m.z,0,0,0,0,1);v.setPosition(k.position);this.setRobotMatrix(v)}else{this.updateCenterPosition(k.position);v.setPosition(k.position);this.setMatrix(v)}}else{this._setOrthoState(true);this.target=null;this.isConnected=false;this.viewer.render()}this.setPickable(h.PICKABLE);if(this.showOnlyManipulated){this.setToNonGhostState()}this.viewer.render();this._parent(r);this._updateRatio();this.onViewpointChange();this._updateLabelsAndReferenceAxisSystem()},onViewpointChange:function(){var m=this.viewer.currentViewpoint;if(!m){return}var q;q=window.devicePixelRatio;var k;if(this._getPositionCB){k=this._getPositionCB(this.viewer.canvas.width,this.viewer.canvas.height,q)}else{k=this._getPosition_default(this.viewer.canvas.width,this.viewer.canvas.height,q)}var o=k.y;var p=k.x;function n(r,A){var v=m.robotCameraOrtho;var u=new j.Vector3(r,A,0);var z=new j.Projector();z.unprojectVector(u,v);var w;if(v instanceof j.PerspectiveCamera){var t=new j.Ray(data.cameraEye,u.sub(data.cameraEye).normalize());var s=new j.Plane(m.camera.getLookAt(),0);w=t.intersectPlane(s)}else{w=u}return new j.Matrix4().setPosition(w)}var l;if(this.isManipulatedInPlane){l=n(2*q*this.manipulationX/this.viewer.canvas.width-1,2*(1-q*this.manipulationY/this.viewer.canvas.height)-1);this.setMatrix(l)}else{if(!this.isConnected&&!this.isManipulated){l=n(p,o);this.setMatrix(l)}}this._updateLabelsAndReferenceAxisSystem()},setConnectionState:function(k){if(!this.isManipulated){if(k){this.connect()}else{this.disconnect()}this._updateLabelsAndReferenceAxisSystem();return true}else{this._updateLabelsAndReferenceAxisSystem();this._updateRatio();return false}},setCheckTarget:function(k){this.checkTarget=k},isTargetGone:function(n){if(!this.checkTarget){return false}if(this.target===null||typeof this.target==="undefined"){return true}var l=0;var p=1;var o=this.target.externalPath;for(var m=0;m<o.length;m++){var k=o[m];if(k._getVisibilityFree()){l=1}if(!k._getVisible()){p=0}}if(l){return !p}if(n===p){return false}return true},setSnapFilterCallback:function(k){this.snapFilterCallback=k},setSnapTranslationCallback:function(k){this.snapTranslationCallback=k},setSnapRotationCallback:function(k){this.snapRotationCallback=k},moveViewToPlane:function(k){if(!this.isConnected&&this.moveViewpointOnClickDuration>=0){var q=this.viewer.currentViewpoint.control;var m=new j.Matrix4();if(this._viewPlane===k){this._viewPlaneOrientation*=-1}else{this._viewPlaneOrientation=1}this._viewPlane=k;var n=this._viewPlaneOrientation>0?0:Math.PI;if(k==="XY"){m.rotateX(0+n);m.rotateZ(Math.PI/2)}else{if(k==="XZ"){m.rotateX(Math.PI/2);m.rotateY(Math.PI+n)}else{if(k==="YZ"){m.rotateY(Math.PI/2+n);m.rotateZ(Math.PI/2+n)}}}var l=m.decompose();var p=new j.Vector3(0,1,0);p.applyQuaternion(l[1]);p.normalize();var o=new j.Vector3(0,0,-1);o.applyQuaternion(l[1]);o.normalize();this.viewer.currentViewpoint.moveTo({upDirection:p,sightDirection:o,duration:this.moveViewpointOnClickDuration})}},connect:function(){this._setOrthoState(false);this.isConnected=true;this._updateRatio();this._updateLabelsAndReferenceAxisSystem()},disconnect:function(){this._setOrthoState(true);this.isConnected=false;this._updateRatio();this.onViewpointChange();this.viewer.render();this.target=null;this._updateLabelsAndReferenceAxisSystem()},setToDragState:function(){this.arrowX.setToDragState();this.arrowY.setToDragState();this.translationPlaneYZ.setToGhostState();this.translationPlaneXZ.setToGhostState();this.translationPlaneXY.setToDragState();this.scalingNodeY.setToGhostState();this.scalingNodeX.setToGhostState();this.scalingNodeZ.setToGhostState();this.rotationArcYZ.setToGhostState();this.rotationArcXZ.setToGhostState();this.rotationArcXY.setToGhostState()},setVisibility:function(k){this.setHiddenMode(!k);this._parent(k)},setHiddenMode:function(k){this.hiddenMode=k;this._updateLabelsAndReferenceAxisSystem()},_setOrthoState:function(k){if(k){this.setRenderPasses(["robotOrtho"]);this._setCameraName("robotCameraOrtho")}else{this.setRenderPasses(["robot"]);this._setCameraName("connectedRobotCamera")}},setDrivenConnectionMode:function(){this.setDrivenMode.apply(this,arguments)},setDrivenMode:function(){this.setConnectionState.apply(this,arguments)},_setCameraName:function(k){this.fixedSizeNode3D.setCameraName(k)},_updateLabelsAndReferenceAxisSystem:function(){var m=this;function l(o){var n=o&&m._enabled;if(m.fixedSizeNode3D._getVisible()!==n){m.fixedSizeNode3D.setVisibility(n)}}function k(o){var n=o&&m._enabled;m.viewer._modelEvent.publish({event:"UpdateReferenceAxisSystemVisibility",data:{visible:o}})}if(this.hiddenMode){l(false);k(true)}else{if(this.isManipulated){l(true);k(true);this.setLabels(null)}else{if(this.isConnected){if(this._showLabels){this._setLocalLabels()}else{this.setLabels(null)}l(true);k(true)}else{if(this._showLabels){this.setLabels({labelX:"x",labelY:"y",labelZ:"z"})}else{this.setLabels(null)}l(true);k(false)}}}},_setLocalLabels:function(){var k=this.getMatrix();k.extractBasis(a.x,a.y,a.z);function l(n,o){n.normalize();var p=null;var m=0.9995;if(n.x>m){p="x"}else{if(n.y>m){p="y"}else{if(n.z>m){p="z"}}}if(p){return o+"|"+p}else{return o}}this.setLabels({labelX:l(a.x,"u"),labelY:l(a.y,"v"),labelZ:l(a.z,"w")})},setMatrix:function(){this._parent.apply(this,arguments);this._updateLabelsAndReferenceAxisSystem()},setManipulated:function(l){var k=l!==this.isManipulated;this._parent.apply(this,arguments);if(k){this._updateLabelsAndReferenceAxisSystem()}},showLabels:function(k){this._showLabels=k;this._updateLabelsAndReferenceAxisSystem()},setMoveViewpointOnClickDuration:function(k){this.moveViewpointOnClickDuration=k},setGetPositionCB:function(k){this._getPositionCB=k;this.onViewpointChange()},_setEnabled:function(k){var l=k?true:false;if(this._enabled!==l){this._enabled=l;this.onViewpointChange()}},_isEnabled:function(){return this._enabled},_updateRatio:function(){if(this.isManipulatedInPlane){this.fixedSizeNode3D.setRatio((this.ratio.moving||this.ratio.ratio))}else{if(this.isConnected){this.fixedSizeNode3D.setRatio((this.ratio.connected||this.ratio.ratio))}else{this.fixedSizeNode3D.setRatio((this.ratio.docked||this.ratio.ratio))}}},_dispose:function(){this._getPositionCB=null;this._parent()},_getPosition_default:function(m,k,n){var l,n;l=this.fixedSizeNode3D.ratio/7;return{x:2*(m-n*100*l)/m-1,y:Math.max(2*100*n*l/k-1,-0.85)}},CallBackEventHandlerViewPoint:function(){this.onViewpointChange.apply(this,arguments)}});return UWA.namespace("THREEDS/Nodes/Robot",i)});define("Robot/Robot",["DS/Robot/Robot","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Robot/Robot");return b});