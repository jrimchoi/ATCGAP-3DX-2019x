define("DS/CATCXPLightModel/extensions/CATECXPLightVariablesInit",["UWA/Core","DS/CATCXPModel/extensions/CATECXPModelVariablesInit","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject"],function(d,a,c){var b=a.extend({Init:function(){var e=this;return this._parent().done(function(){return e.CreateComponent("Color_Spec","diffuseColor")}).done(function(f){e.QueryInterface("CATI3DExperienceObject").SetValueByName("diffuseColor",f,c.SetValueMode.NoCheck);f.QueryInterface("CATI3DExperienceObject").SetValueByName("r",255);f.QueryInterface("CATI3DExperienceObject").SetValueByName("g",255);f.QueryInterface("CATI3DExperienceObject").SetValueByName("b",255)})}});return b});define("DS/CATCXPLightModel/interfaces/CATICXPLight",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(c,b){var a=b.singleton({interfaceName:"CATICXPLight",required:{SetIntensity:function(d){console.log("interface using these variables : "+d)},GetIntensity:function(){return undefined},SetColor:function(f,e,d){console.log("interface using these variables : "+f+e+d)},GetRed:function(){return undefined},GetGreen:function(){return undefined},GetBlue:function(){return undefined}},optional:{}});return a});define("DS/CATCXPLightModel/extensions/CATELightActor3DGeoVisu",["UWA/Core","DS/CATCXPModel/extensions/CATE3DActor3DGeoVisu","DS/Visualization/ThreeJS_DS","MathematicsES/MathsDef"],function(e,d,c,b){var a=d.extend({init:function(){this._parent()},destroy:function(){this._parent();this._colorListener.stopListening();this._colorListener=null},_Fill:function(g){this._parent(g);this._createOrRefreshLight();var f=this;this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"diffuseColor.CHANGED",function(){f._createOrRefreshDiffuseColorListeners();f.frameVisuChanges.push(f._refreshColor);f.RequestVisuRefresh()});this._createOrRefreshDiffuseColorListeners();this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"power.CHANGED",function(){f.frameVisuChanges.push(f._refreshPower);f.RequestVisuRefresh()});this.setReady(true)},_createOrRefreshDiffuseColorListeners:function(){if(this._colorListener){this._colorListener.stopListening()}else{this._colorListener=new e.Class.Listener()}var g=this.QueryInterface("CATI3DExperienceObject").GetValueByName("diffuseColor");var f=this;this._colorListener.listenTo(g.QueryInterface("CATI3DExperienceObject"),"r.CHANGED",function(){f.frameVisuChanges.push(f._refreshColor);f.RequestVisuRefresh()});this._colorListener.listenTo(g.QueryInterface("CATI3DExperienceObject"),"g.CHANGED",function(){f.frameVisuChanges.push(f._refreshColor);f.RequestVisuRefresh()});this._colorListener.listenTo(g.QueryInterface("CATI3DExperienceObject"),"b.CHANGED",function(){f.frameVisuChanges.push(f._refreshColor);f.RequestVisuRefresh()})},_createOrRefreshLight:function(){if(e.is(this._lightNode)){this._node3D.removeChild(this._lightNode);this._lightNode.removeChildren()}},_refreshPower:function(){this._lightNode.setPower(this.QueryInterface("CATI3DExperienceObject").GetValueByName("power"))},_refreshColor:function(){this._lightNode.setColor(this._getThreeColor(this.QueryInterface("CATI3DExperienceObject").GetValueByName("diffuseColor")))},GetLocalNodes:function(){return this._lightNode},_getThreeColor:function(f){var g=f.QueryInterface("CATI3DExperienceObject");return new c.Color("rgb("+g.GetValueByName("r")+","+g.GetValueByName("g")+","+g.GetValueByName("b")+")")},GetBoundingBox:function(k){var j=this.Get();k=k?k:0;var f;if(j.visible){f=new c.Box3(new c.Vector3(0,0,0),new c.Vector3(0,0,0))}else{f=j.getBoundingBox("invisibleSpace")}if(k===0){var h=new b.Transformation();var l=this.QueryInterface("CATIMovable");l.GetAbsPosition(h);var g=h.getArray();var i=new c.Matrix4(g[0],g[3],g[6],g[9],g[1],g[4],g[7],g[10],g[2],g[5],g[8],g[11],0,0,0,1);f.applyMatrix4(i)}return f}});return a});define("DS/CATCXPLightModel/extensions/CATECXPLight",["UWA/Class","DS/CAT3DExpModel/CAT3DXInterfaceImpl"],function(c,a){var b=a.extend({init:function(){this._parent()},SetIntensity:function(d){this.QueryInterface("CATI3DExperienceObject").SetValueByName("power",d)},GetIntensity:function(){return this.QueryInterface("CATI3DExperienceObject").GetValueByName("power")},SetColor:function(f,e,d){var h=this.QueryInterface("CATI3DExperienceObject").GetValueByName("diffuseColor");var i=h.QueryInterface("CATI3DExperienceObject");i.SetValueByName("r",f);i.SetValueByName("g",e);i.SetValueByName("b",d);this.QueryInterface("CATI3DExperienceObject").SetValueByName("diffuseColor",h)},GetRed:function(){var d=this.QueryInterface("CATI3DExperienceObject").GetValueByName("diffuseColor");return d.QueryInterface("CATI3DExperienceObject").GetValueByName("r")},GetGreen:function(){var d=this.QueryInterface("CATI3DExperienceObject").GetValueByName("diffuseColor");return d.QueryInterface("CATI3DExperienceObject").GetValueByName("g")},GetBlue:function(){var d=this.QueryInterface("CATI3DExperienceObject").GetValueByName("diffuseColor");return d.QueryInterface("CATI3DExperienceObject").GetValueByName("b")}});return b});define("DS/CATCXPLightModel/extensions/CATESpotLightActor3DGeoVisu",["UWA/Core","DS/CATCXPLightModel/extensions/CATELightActor3DGeoVisu","DS/SceneGraphNodes/SpotLightNode","DS/Visualization/ThreeJS_DS"],function(e,b,c,d){var a=b.extend({_Fill:function(g){this._parent(g);var f=this;this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"castShadows.CHANGED",function(){f.frameVisuChanges.push(f._refreshCastShadow);f.RequestVisuRefresh()});this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"innerAngle.CHANGED",function(){f.frameVisuChanges.push(f._refreshAngles);f.RequestVisuRefresh()});this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"outerAngle.CHANGED",function(){f.frameVisuChanges.push(f._refreshAngles);f.RequestVisuRefresh()});this.frameVisuChanges.push(this._refreshCastShadow);this.frameVisuChanges.push(this._refreshAngles);f.RequestVisuRefresh()},_createOrRefreshLight:function(){this._parent();var g=this.QueryInterface("CATI3DExperienceObject");var f=g.GetValueByName("outerAngle")/2*Math.PI/180;this._lightNode=new c({color:this._getThreeColor(g.GetValueByName("diffuseColor")),power:g.GetValueByName("power"),outerAngle:f,innerAngle:f*g.GetValueByName("innerAngle")/100,distance:0,physicalAttenuation:true});this._lightNode.setMatrix(new d.Matrix4(0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1));this._lightNode.setName(g.GetValueByName("_varName"));this._node3D.addChild(this._lightNode)},_refreshAngles:function(){var h=this.QueryInterface("CATI3DExperienceObject");var f=h.GetValueByName("outerAngle")/2*Math.PI/180;var g=f*h.GetValueByName("innerAngle")/100;this._lightNode.setAngles(f,g,false)},_refreshCastShadow:function(){var f=this.QueryInterface("CATI3DExperienceObject").GetValueByName("castShadows");this._lightNode.castShadows(f);if(f){this._lightNode.updateShadowMap(true)}else{this._lightNode.updateShadowMap(false)}}});return a});define("DS/CATCXPLightModel/extensions/CATEDirectionalLightActor3DGeoVisu",["UWA/Core","DS/CATCXPLightModel/extensions/CATELightActor3DGeoVisu","DS/SceneGraphNodes/DirectionalLightNode","DS/Visualization/ThreeJS_DS"],function(e,a,c,d){var b=a.extend({_createOrRefreshLight:function(){this._parent();var f=this.QueryInterface("CATI3DExperienceObject");this._lightNode=new c({color:this._getThreeColor(f.GetValueByName("diffuseColor")),intensity:f.GetValueByName("power")});this._lightNode.setMatrix(new d.Matrix4(0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,1));this._lightNode.setName(f.GetValueByName("_varName"));this._node3D.addChild(this._lightNode)},_refreshPower:function(){this._lightNode.setIntensity(this.QueryInterface("CATI3DExperienceObject").GetValueByName("power"))}});return b});define("DS/CATCXPLightModel/extensions/CATEPointLightActor3DGeoVisu",["UWA/Core","DS/CATCXPLightModel/extensions/CATELightActor3DGeoVisu","DS/SceneGraphNodes/PointLightNode"],function(d,b,a){var c=b.extend({_createOrRefreshLight:function(){this._parent();var e=this.QueryInterface("CATI3DExperienceObject");this._lightNode=new a({color:this._getThreeColor(e.GetValueByName("diffuseColor")),power:e.GetValueByName("power"),distance:0,physicalAttenuation:true});this._lightNode.setName(e.GetValueByName("_varName"));this._node3D.addChild(this._lightNode)}});return c});