define("DS/ENOChgActionCMDs/scripts/Commands/CommandBase",["DS/ApplicationFrame/Command"],function(a){var b=a.extend({name:"",pids:null,init:function(d,c){this.name=c;this._parent(d,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){},endExecute:function(){},});return b});define("DS/ENOChgActionCMDs/scripts/SearchConfiguration",["UWA/Core","UWA/Utils/InterCom","UWA/Class/Model","DS/ENOFrameworkPlugins/jQuery"],function(e,b,d,c){var a=function(f){this.multiSelectVal=f;this.socketName="search_socket_"+(new Date()).getTime();this.socket=new b.Socket(this.socketName,{dispatchRetryInterval:5});this.socket.subscribeServer("SearchComServer");this.listener=this.objectsSelected.bind(this);this.socket.addListener("Selected_Objects_search",this.listener);var g=this.options();this.socket.dispatchEvent("RegisterContext",g)};a.prototype.destroy=function(){var f={};f.widget_id=(widget)?widget.id:null;this.socket.dispatchEvent("unregisterSearchContext",f);this.socket.unsubscribeServer("SearchComServer");this.socket.removeListener("Selected_Objects_search",this.listener);this.socket.disconnect()};a.prototype.options=function(j,h,k,g,f){var i={};i.title=j;i.multiSel=this.multiSelectVal;i.mode="furtive";i.app_socket_id=this.socketName;i.widget_id=(widget)?widget.id:null;i.default_with_precond=true;i.show_precond=false;i.idcard_activated=false;i.role=k;i.tenant=ENOChgActionCMDs.tenant;if(h){i.precond="(";h=h.split(",");c.each(h,function(l,m){if(l!==0){i.precond+=" OR "}i.precond+='flattenedtaxonomies:"types/'+m.trim()+'"'});i.precond+=")";if(f!=""){i.precond+=f}}if(g){i.default_search_criteria=g}return(i)};a.prototype.activate=function(j,i,l,k,h,f){var g=this.options(j,i,l,h,f);this.callback=k;this.socket.dispatchEvent("InContextSearch",g)};a.prototype.isAvailable=function(){return(e.is(this.socket))};a.prototype.objectsSelected=function(k){var f=[];if(this.callback){for(var j=0;j<k.length;j++){var h=[];var g=new d(k[j]);h.push(g.get("id"));h.push(g.get("ds6w:identifier"));h.push(g.get("ds6w:type"));h.push(g.get("ds6w:policy"));h.push(g.get("type_icon_url"));f.push(h)}this.callback(f)}};return(a)});define("DS/ENOChgActionCMDs/scripts/CAActionBarUtility",["DS/UIKIT/Alert","i18n!DS/ENOChgActionCMDs/assets/nls/ENOChgActionCMDs","DS/WAFData/WAFData","UWA/Core","UWA/Class/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassServices/i3DXCompassServices","DS/ENOChangeActionUX/scripts/CAUtility","DS/ENOChgActionCMDs/scripts/SearchConfiguration","DS/ENOChangeActionUX/scripts/CASpinner"],function(e,f,j,g,i,c,b,a,d,k){var h={populate3DSpaceURL:function(){var l=new i(function(n,m){c.getPlatformServices({onComplete:function(p){for(var o=0;o<p.length;o++){if(ENOChgActionCMDs.tenant==p[o]["platformId"]){ENOChgActionCMDs.baseURL=p[o]["3DSpace"];ENOChgActionCMDs.federatedURL=p[o]["3DSearch"]}}n()},onFailure:m})});return l},populateSecurityContext:function(){var l=new i(function(r,q){var o="/resources/pno/person/getsecuritycontext";var p="";var n=function(t){m=t.SecurityContext;if(!m||m==null){a.error(CA_NLS.ECM_CA_Use_Preferences)}else{if(t!=null&&t!=""&&t.hasOwnProperty("SecurityContext")){var u="";if(t.SecurityContext.indexOf("ctx::")!=0){u="ctx::"}m=u+t.SecurityContext}console.log("Setting security Context: "+m);ENOChgActionCMDs.mySecurityContext=m;m=m.replace("ctx::","");ENOChgActionCMDs.myRole=m.substring(0,m.indexOf("."));ENOChgActionCMDs.collabspace=m.substring(m.lastIndexOf(".")+1,m.length);r(t)}};var s=widget.getValue("SC");if((s!=null)&&(s!=undefined)&&(s!="")){var m="ctx::"+s;ENOChgActionCMDs.mySecurityContext=m;m=m.replace("ctx::","");ENOChgActionCMDs.myRole=m.substring(0,m.indexOf("."));ENOChgActionCMDs.collabspace=m.substring(m.lastIndexOf(".")+1,m.length);r(m)}else{h.makeWSCall(o,"GET","enovia","application/json",p,n,q,true)}});return l},populateRoles:function(){var l=new i(function(n,m){c.getGrantedRoles(function(p){var o=["CAP","CHG","COR","DAR","FCD","FME","FRA","FTM","GLS","PDA","PDE","PDM","PPE","QUC","SPM","TRM","UWE","UXG","ENO_ECM_TP"];p.forEach(function(q){if(((o.indexOf(q.id)>=0)&&q.platforms.indexOf(ENOChgActionCMDs.tenant)>=0)||(q.id==="InternalDS")){ENOChgActionCMDs.isChangeAvailable=true}});n(true)})});return l},activateSearch:function(n){var l=true;l=(n!=undefined&&n!=null&&n==="AddToExistingCA")?false:true;var m=new d(l);return m},search:function(q,m,s,o,l){var p="";var r=ENOChgActionCMDs.getRole();var n=null;l.activate(q,m,r,s,n,p)},makeWSCall:function(u,m,s,o,q,v,p,x){x=x||null;var l="";if(x!=null&&x.isfederated!=undefined&&x.isfederated==true){l=ENOChgActionCMDs.federatedURL+u}else{l=ENOChgActionCMDs.computeUrl(u)}var r=new Date().getTime();if(l.indexOf("?")==-1){l=l+"?tenant="+ENOChgActionCMDs.tenant+"&timestamp="+r}else{l=l+"&tenant="+ENOChgActionCMDs.tenant+"&timestamp="+r}var w=ENOChgActionCMDs.getSecurityContext();v=v||function(){};p=p||function(){};var n=widget.getValue("lang");if(widget.lang){n=widget.lang}var t={};t.method=m;t.timeout=ENOChgActionCMDs.wsCallTimeout;t.type="json";if(ENOChgActionCMDs.isNative){if(w){t.headers={Accept:"application/json","Content-Type":o,SecurityContext:w,"Accept-Language":n}}else{t.headers={Accept:"application/json","Content-Type":o,"Accept-Language":n}}}else{if(s){t.auth={passport_target:s}}t.proxy=ENOChgActionCMDs.proxy;if(w){t.headers={Accept:"application/json","Content-Type":o,SecurityContext:w,"Accept-Language":n}}else{t.headers={Accept:"application/json","Content-Type":o,"Accept-Language":n}}}if(q){t.data=q}t.onComplete=function(y){console.log("Success calling url: "+l);console.log("Success data: "+JSON.stringify(y));v(y)};t.onFailure=function(z,y){console.log("Error in calling url: "+l);console.log("Additional Details:: httpMethod: "+m+" authentication: "+s+" securityContext: "+w+" ContentType: "+o);console.log("Error Detail: "+z);console.log("Error Data: "+JSON.stringify(y));if(y&&y.errorMessage){a.error(y.errorMessage)}else{if(z&&z.message){a.error(z.message)}else{a.error("Something went wrong, please check logs for more details")}}p(z,y);k.endWait(widget.body)};t.onTimeout=function(){console.log("Timedout for url: "+l);a.error("Webservice Timedout, please refresh and try again.");k.endWait(widget.body)};if(x!=null&&x.isfederated!=undefined&&x.isfederated==true){delete t.headers.SecurityContext}j.authenticatedRequest(l,t)}};return h});define("DS/ENOChgActionCMDs/scripts/CAActionBarController",["UWA/Class","DS/ENOChgActionCMDs/scripts/CAActionBarUtility","DS/Core/ModelEvents","UWA/Class/Promise",],function(a,b,d,c){return a.singleton({_baseJSON:{version:"v0",changeaction:{cestamp:"0000",add:{proposed:[],context:[],people:[],}}},_CACMDModelEvent:undefined,_SingletonCAActionBarEventInstance:null,init:function(e){console.log(widget.id);var f=this;window.ENOChgActionCMDs={serviceName:"3DSpace",baseURL:"",wsCallTimeout:30000,isNative:false,is3DSpace:false,mySecurityContext:"",proxy:window.UWA.Data.proxies.passport?"passport":"ajax",myRole:"",get3DSpaceURL:function(){return this.baseURL},computeUrl:function(g){return this.get3DSpaceURL()+g},getSecurityContext:function(){return this.mySecurityContext},getRole:function(){return this.myRole},tenant:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"};b.populate3DSpaceURL().then(function(g){b.populateSecurityContext().then(function(h){b.populateRoles().then(function(i){c.resolve(true);f.setCommandState()},function(i){console.log("ENOChgActionCMDs: populate roles failed");return c.reject(i)})},function(h){console.log("ENOChgActionCMDs: populate security context failed");return c.reject(h)})},function(g){console.log("ENOChgActionCMDs: populate base URL failed");return c.reject(g)})},getEventHandler:function(){if(this._SingletonCAActionBarEventInstance==null){this._SingletonCAActionBarEventInstance=new d()}return this._SingletonCAActionBarEventInstance},setCommandState:function(){var e=this.getEventHandler();if(ENOChgActionCMDs&&ENOChgActionCMDs.isChangeAvailable&&this.isObjectSelected()){e.publish({event:"AddToCAEnable",data:{}})}else{e.publish({event:"AddToCADisable",data:{}})}},clearObjects:function(){this._baseJSON={version:"v0",changeaction:{cestamp:"0000",add:{proposed:[],context:[],people:[],}}};this.setCommandState()},addProposed:function(e){var f=this;e.forEach(function(h){var g=f.getProposedWhereBlockToAdd(h);f._baseJSON.changeaction.add.proposed.push(g)});this.setCommandState()},getProposedWhereBlockToAdd:function(e){var f={where:{id:""},operation:{name:"None"}};f.where.id="pid:"+e;return f},addContext:function(e){var f=this;e.forEach(function(g){f._baseJSON.changeaction.add.context.push("pid:"+g)});this.setCommandState()},addAssignee:function(e){var f=this;e.forEach(function(g){var h=f.getAssigneeBlockToAdd(g);f._baseJSON.changeaction.add.people.push(h)});this.setCommandState()},getAssigneeBlockToAdd:function(e){var f={name:"",role:"contributor"};f.name=e;return f},removeProposed:function(e){var f=this;e.forEach(function(g){for(var h=f._baseJSON.changeaction.add.proposed.length-1;h>=0;h=h-1){if(f._baseJSON.changeaction.add.proposed[h].where.id=="pid:"+g){f._baseJSON.changeaction.add.proposed.splice(h,1)}}});this.setCommandState()},removeContext:function(e){var f=this;e.forEach(function(g){var h=f._baseJSON.changeaction.add.context.indexOf("pid:"+g);if(h!=-1){f._baseJSON.changeaction.add.context.splice(h,1)}});this.setCommandState()},removeAssignee:function(e){var f=this;e.forEach(function(g){for(var h=f._baseJSON.changeaction.add.people.length-1;h>=0;h=h-1){if(f._baseJSON.changeaction.add.people[h].name==g){f._baseJSON.changeaction.add.people.splice(h,1)}}});this.setCommandState()},isObjectSelected:function(){var e=false;if(this._baseJSON.changeaction.add.proposed.length>0||this._baseJSON.changeaction.add.context.length||this._baseJSON.changeaction.add.people.length){e=true}return e},getJSON:function(){console.log(this._baseJSON);return this._baseJSON},setJSON:function(e){this._baseJSON=e;this.setCommandState()},})});define("DS/ENOChgActionCMDs/scripts/Commands/AddToNewCA",["DS/ENOChgActionCMDs/scripts/Commands/CommandBase","DS/ENOChgActionCMDs/scripts/CAActionBarController","DS/ENOChangeActionUX/scripts/CreateCAForm","DS/ENOChangeActionUX/scripts/CAUtility","DS/ENOChgActionCMDs/scripts/CAActionBarUtility"],function(a,b,d,e,c){return a.extend({init:function(f){var g=this;this._parent(f,"AddToNewCA");this.disable();var h=b.getEventHandler();h.unsubscribe("AddToCAEnable");h.subscribe({event:"AddToCAEnable"},function(i){g.enable()});h.unsubscribe("AddToCADisable");h.subscribe({event:"AddToCADisable"},function(i){g.disable()})},execute:function(){if(!b.isObjectSelected()){e.error("No  object selected");return}var f=b.getJSON();console.log(f);var h=function(i){e.success("Successfully added to Change Action: "+i.changeaction.name)};var g=function(k,j,l){var i="/resources/modeler/change/changeaction";c.makeWSCall(i,"POST","enovia","application/json",k,j,l)};d.createCAFromActionBar(f,g,h)}})});define("DS/ENOChgActionCMDs/scripts/SearchSelector",["UWA/Class/View","DS/Handlebars/Handlebars","DS/UIKIT/Autocomplete","UWA/Class/Promise","DS/ENOChgActionCMDs/scripts/CAActionBarUtility","css!DS/ENOChgActionCMDs/ENOChgActionCMDs"],function(g,f,d,e,c,b){var a=g.extend({autocomplete:null,toolbar:null,fieldTemplate:null,searchCallBack:null,confirmCallBack:null,confirmIconSpan:null,setup:function(){},init:function(h){this._parent(h);this.searchCallBack=h.searchCallBack;this.confirmCallBack=h.confirmCallBack;var i='<div id="SearchSelectorContainer" style="height:38px;display:flex">										<div class="model-selector-container" style="width:270px;display:flex;position:relative"></div>										<div class="toolbar-model-selector" style="display:flex;position:relative"></div>										</div>';this.fieldTemplate=f.compile(i)},render:function(){var l=this;this.container.setHTML(this.fieldTemplate());this.autocomplete=new d({multiSelect:false,showSuggestsOnFocus:false,placeholder:"Type to search Change Action",disabled:false,allowFreeInput:true,minLengthBeforeSearch:3,events:{onSelect:function(o,n){l.confirmIconSpan.setStyle("visibility","visible")},onUnselect:function(o,n){l.confirmIconSpan.setStyle("visibility","hidden");this.removeDataset("searchDataSet")}},datasets:{configuration:{remoteSearchEngine:function(o,p){var n;if(!p){return false}return new e(function(v,u){var s="/search?xrequestedwith=xmlhttprequest";var w=function(y){n={};n.dataset=o;n.matchingItems=y&&o.dataParser&&o.dataParser.call(l,o,y);v(n)};var r=function(y){y.type="error";y.dataset=o;u(y)};if(!p.contains("*")){p=p+"*"}var x='(flattenedtaxonomies:"types/Change Action" AND '+p+")";var t={with_indexing_date:true,with_nls:false,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:responsible"],select_file:["icon","thumbnail_2d"],query:x,order_by:"desc",order_field:"relevance",nresults:1000,start:"0",source:[],tenant:ENOChgActionCMDs.tenant};var t=JSON.stringify(t);var q={};q.isfederated=true;c.makeWSCall(s,"POST","enovia","application/json",t,w,r,q)})},dataParser:function(p,r){var q=[],n=[],o=this;if(r.results&&r.results.length){r.results.forEach(function(t){if(t.attributes&&t.attributes.length){var s={};t.attributes.forEach(function(u){if(u.name=="resourceid"){s.value=u.value}else{if(u.name=="ds6w:identifier"){s.label=u.value}}});n.push(s)}})}return n}}}});var h=UWA.createElement("div");h.setStyles({position:"relative",width:"100%"});h.style.display="inline-block";this.autocomplete.inject(h);h.inject(this.container.getElement(".model-selector-container"));var j=function(n){if(n.length==1){var p=[];p.push({label:n[0][1],value:n[0][0],selected:true});var o={};o.name="searchDataSet";o.items=p;l.autocomplete.addDataset(o)}};var k=function(){l.searchCallBack(j)};var m=UWA.createElement("span",{"class":"fonticon fonticon-1x fonticon-search",id:"CACMDSearchIcon"});m.addEventListener("click",k);this.confirmIconSpan=UWA.createElement("span",{"class":"fonticon fonticon-1x fonticon-check",id:"CACMDConfirmIcon"});this.confirmIconSpan.setStyle("visibility","hidden");this.confirmIconSpan.setStyle("margin-right","24px");this.confirmIconSpan.addEventListener("click",function(){l.confirmCallBack(l.autocomplete.getValue())});var i=UWA.createElement("div",{"class":"imgSearchContainer1",id:"searchIconCont"});this.autocomplete.elements.clear.setStyle("margin-right","20px");this.autocomplete.elements.clear.setStyle("z-index","999");i.style.opacity="0.5";i.style["float"]="right";i.style.marginTop="-27px";i.style.marginRight="5px";i.addClassName("imgFocusIdenty");i.addContent(this.confirmIconSpan);i.addContent(m);i.inject(h);return this},});return a});define("DS/ENOChgActionCMDs/scripts/Commands/AddToExistingCA",["DS/ENOChgActionCMDs/scripts/Commands/CommandBase","DS/ENOChgActionCMDs/scripts/CAActionBarController","DS/ENOChangeActionUX/scripts/CAUtility","DS/ENOChgActionCMDs/scripts/CAActionBarUtility","DS/ENOChgActionCMDs/scripts/SearchSelector","DS/UIKIT/Modal","DS/UIKIT/Input/Button"],function(d,e,g,f,c,b,a){return d.extend({searchSelector:null,_modal:null,init:function(h){var i=this;this._parent(h,"AddToExistingCA");this.disable();var j=e.getEventHandler();j.unsubscribe("AddToCAEnable");j.subscribe({event:"AddToCAEnable"},function(k){i.enable()});j.unsubscribe("AddToCADisable");j.subscribe({event:"AddToCADisable"},function(k){i.disable()})},execute:function(){if(!e.isObjectSelected()){g.error("No object selected");return}var m=JSON.stringify(e.getJSON());console.log(m);var k=this;var n=widget.body;var p={};p.searchCallBack=function(r){var s=function(t){r(t)};var q=f.activateSearch("AddToExistingCA");f.search("Add To Existing Change Action","Change Action",s,"AddToExistingCA",q)};p.confirmCallBack=function(s){var r=function(t){k._modal.destroy();console.log("data addition: successful");g.success("Successfully added to Change Action: "+t.changeaction.name)};var q="/resources/modeler/change/changeaction/pid:"+s;f.makeWSCall(q,"PUT","enovia","application/json",m,r,null)};if(this._modal){this._modal.destroy()}var o=UWA.createElement("div");o.setStyle("display","flex");var j=new c(p);j.render().inject(o);var h=new a({value:"",icon:"wrong"}).inject(o);h.addEvent("onClick",function(){k._modal.destroy()});this._modal=new b({className:this.name+"_modal",closable:false,body:o,visible:true,events:{}});this._modal.inject(n);this._modal.elements.wrapper.setStyle("width","336px");var o=this._modal.elements.wrapper.querySelector(".modal-body");o.setStyle("padding","0px");o.setStyle("min-height","0px");o.setStyle("overflow","visible");var l=this._modal.elements.wrapper.querySelector(".autocomplete-suggests");l.setStyle("width","270px");this._modal.elements.wrapper.setStyle("padding-top","calc("+i()+" - 80px)");function i(){var q="500px";if(n.scrollHeight>40){q=n.scrollHeight+"px"}return q}}})});