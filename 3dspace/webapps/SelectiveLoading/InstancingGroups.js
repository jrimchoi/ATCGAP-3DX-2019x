define("DS/SelectiveLoading/InstancingGroups",["DS/SelectiveLoading/LDHJsModule","DS/SelectiveLoading/SelectiveLoadingImpl","DS/Visualization/ThreeJS_DS"],function(c,a,b){a.queryMode={eDefault:0,ePriority:1};a.InstanceInfo=function(d){this.transform=(d!==undefined&&d.transform!==undefined)?d.transform:null;this.material=(d!==undefined&&d.material!==undefined)?d.material:null;this.color=(d!==undefined&&d.color!==undefined)?d.color:null;this.userData=(d!==undefined&&d.userData!==undefined)?d.userData:null};a.InstanceInfo.prototype={};a.InstanceInfo.prototype.constructor=a.InstanceInfo;a.InstanceInfo.prototype.version="0.0.1";a.InstancingGroup=function(){this.viewUpToDate=false;this.template=null;this.aabbox=null;this.instances=[];this.userData=null;this.priority=-1};a.InstancingGroup.prototype={};a.InstancingGroup.prototype.constructor=a.InstancingGroup;a.InstancingGroup.prototype.version="0.0.1";a.InstancingGroup.prototype.clone=function(){var d=new a.InstancingGroup();d.aabbox=this.aabbox.clone();d.viewUpToDate=this.viewUpToDate;d.template=this.template;d.instances=this.instances.slice(0);d.userData=this.userData;d.priority=this.priority;return d};a.Grouper=function(d){this.cppGrouper=new c.CppGrouper(a,d,new a.Helpers)};a.Grouper.prototype={};a.Grouper.prototype.constructor=a.Grouper;a.Grouper.prototype.version="0.0.1";a.Grouper.prototype.destructor=function(){this.cppGrouper["delete"]();this.cppGrouper=undefined};a.Grouper.prototype.addInstance=function(d,f,e){if(e==undefined||e.transform==undefined){console.log("Error in Grouper::addInstance: iInstanceInfo is invalid!");return a.error.eInvalidArg}if(e.transform.elements==undefined||e.transform.elements.length!=16||!(e.transform.elements instanceof Float32Array)){console.log("Error in Grouper::addInstance: matrix is invalid!");return a.error.eInvalidArg}return this.cppGrouper.addInstance(d,f,e)};a.Grouper.prototype.addInstances=function(f,g,e){if(e==undefined||e.length==undefined){console.log("Error in Grouper::addInstances: matrix is invalid!");return a.error.eInvalidArg}for(var d=0;d<e.length;d+=1){if(e[d]==undefined||e[d].transform==undefined){console.log("Error in Grouper::addInstances: iInstanceInfo is invalid!");return a.error.eInvalidArg}if(e[d].transform.elements==undefined||e[d].transform.elements.length!=16||!(e[d].transform.elements instanceof Float32Array)){console.log("Error in Grouper::addInstances: matrix is invalid!");return a.error.eInvalidArg}}return this.cppGrouper.addInstances(f,g,e)};a.Grouper.prototype.unregisterTemplate=function(d){return this.cppGrouper.unregisterTemplate(d)};a.Grouper.prototype.getRelevantGroups=function(e,f,d){return this.cppGrouper.getRelevantGroups(e,f,d)};a.Grouper.prototype.getRelevantGroupsInBox=function(e,d){return this.cppGrouper.getRelevantGroupsInBox(e,d)};a.Helpers.prototype.createInstancingNode=function(m,f){if(m.template==undefined){console.log("Error in Helpers::createInstancingNode: template is invalid!");return null}if(m.template.mesh3js==undefined){console.log("Error in Helpers::createInstancingNode: mesh3js is invalid!");return null}if(m.template.mesh3js.geometry==undefined){console.log("Error in Helpers::createInstancingNode: geometry is invalid!");return null}var k=[];for(var n=0;n<m.template.mesh3js.geometry.length;++n){k.push(m.template.mesh3js.geometry[n].clone())}var o=new b.Mesh(k,m.template.mesh3js.material);var g=new THREEDS.Nodes.Mesh(o,m.template.name);var d=[];var h=[];for(var e=0;e<m.instances.length;++e){d.push(m.instances[e].color);h.push(m.instances[e].transform)}var l={data:d,type:"v4",attribName:"instanceColor"};var j={data:h,type:"m4",attribName:"instanceMatrix"};if(m.instances.length>0){g.setMaterial(m.instances[0].material)}g.setInstancingParameters(m.instances.length,[l,j],f);g.forceBoundingBox(m.aabbox.clone());return g};a.Helpers.prototype.createInstancingNodes=function(i,h,g){var d=[];for(var e=0;e<i.length;e=e+1){var f=this.createInstancingNode(i[e],g);if(f==null){console.log("Error in Helpers::createInstancingNodes: node "+e+" is invalid!");return[]}d.push(f)}if(h!=undefined){for(var e=0;e<d.length;e=e+1){h.add(d[e])}}return d};return a});