(function(global){define("DS/ENXSBToolbarClient/ENXSBToolbarClient",["DS/Core/Core","DS/Tweakers/GeneratedToolbar","DS/Controls/Toggle","DS/Menu/Menu","DS/Utilities/TouchUtils","DS/Windows/ImmersiveFrame","DS/Windows/Panel","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/Tweakers/TypeRepresentationFactory","DS/WAFData/WAFData","DS/ENXSBGridConnector/StandardFunctions"],function(WUX,WUXGeneratedToolbar,WUXToggle,Menu,WUXTouch,WUXImmersiveFrame,WUXPanel,TreeDocument,TreeNodeModel,WebappsUtils,TypeRepresentationFactory,WAFData,StandardFunctions){var exports={};var loadToolbar=function(data){var result=loadTreeDocument(data);var typeRepFactory=new TypeRepresentationFactory();if(result.enums){for(var enumName in result.enums){typeRepFactory.registerEnum(enumName,result.enums[enumName])}}if(result.typeReps){typeRepFactory.registerTypeRepresentations(result.typeReps)}var container=document.getElementById("toolbar");var toolbar=new WUXGeneratedToolbar({overflowManagement:"dropdown",direction:"horizontal",items:result.treeDoc,typeRepresentationFactory:typeRepFactory});var immersiveFrame=new WUXImmersiveFrame({}).inject(container);var panel=new WUXPanel({title:"ToolBar",immersiveFrame:immersiveFrame,content:toolbar,resizableFlag:true,width:1000});var content=result.content;var config={submenu:"outside"};Menu.show(content,config);var element=UWA.createElement("div").inject(document.body)};var loadTreeDocument=function(jsonData){var data,entries,enums,typeRepresentations;data=jsonData.data;entries=data[0].relateddata.entries;enums=data[0].relateddata.enums;typeRepresentations=data[0].relateddata.typeRepresentations;if(!entries){return}var entry=null;entries.forEach(function(item){item=processEntry(item)});var processedTypeReps={};typeRepresentations.forEach(function(item){item=processTypeRep(item);processedTypeReps[item.id]=item});return{entries:entries,typeRepresentations:processedTypeReps,enums:enums,}};var loadTreeDocumentFromTechno=function(jsonFile){var toolbarTreeDocument,root,parsedJSON;toolbarTreeDocument=new TreeDocument({});parsedJSON=JSON.parse(jsonFile);if(!parsedJSON.entries){return}parsedJSON.entries.forEach(function(entry){toolbarTreeDocument.addRoot(new TreeNodeModel(entry))});return{treeDoc:toolbarTreeDocument,typeReps:parsedJSON.typeRepresentations,enums:parsedJSON.enums,content:""}};var processEntry=function(entry){if(entry.children&&entry.children.length==0){delete entry.children}entry.dataElements=entry.dataelements;if(entry.dataelements.disabled!=undefined){entry.dataelements.disabled=JSON.parse(entry.dataelements.disabled)}if(entry.dataelements.single!=undefined){entry.dataelements.single=JSON.parse(entry.dataelements.single)}if(entry.dataelements.action){var action=JSON.parse(entry.dataelements.action)}if(typeof entry.dataElements.addEventListener!="undefined"&&entry.dataElements.addEventListener=="true"&&typeof action!="undefined"){addEventListenersTo.push({nodeModelId:entry.id,argument:action.argument});delete entry.dataelements.action}else{if(entry.dataelements.action){entry.dataelements.action=action}}var cachedDisplayView=dgView.layout._getDataFromPreferences("displayView");if(typeof cachedDisplayView=="undefined"&&entry.id=="DataGridDisplayDetails"){entry.dataelements.icon="../../common/images/utilCheckboxChecked.png"}else{if(typeof cachedDisplayView!="undefined"&&entry.id.toLowerCase().contains(cachedDisplayView)){entry.dataelements.icon="../../common/images/utilCheckboxChecked.png"}}var jsBeforeLoad=entry.dataelements.jsBeforeLoad;if(StandardFunctions.isNotNullAndNotEmpty(jsBeforeLoad)&&jsBeforeLoad.substring(0,11)==="javascript:"){jsBeforeLoad=jsBeforeLoad.substring(11);if("()"==jsBeforeLoad.substring(jsBeforeLoad.length-2)){jsBeforeLoad=jsBeforeLoad.substring(0,jsBeforeLoad.length-2)}var fnJsBeforeLoad=eval(jsBeforeLoad);if(typeof fnJsBeforeLoad=="function"){fnJsBeforeLoad(entry)}}if(entry.children&&entry.children.length>0){entry.children.forEach(function(item){item=processEntry(item)})}return entry};var processDisabledEntries=function(entry,disabledEntries){var mapObject={},data=[];if(entry.dataelements.disabled){mapObject[entry.id]="menu"}else{if(entry.dataelements.state){mapObject[entry.id]="subMenu"}}if(Object.keys(mapObject).length!=0&&mapObject.constructor===Object){disabledEntries.push(mapObject)}if(entry.children&&entry.children.length>0){entry.children.forEach(function(item){item=processDisabledEntries(item,disabledEntries)})}return disabledEntries};var processRowSelectSinglEntries=function(entry,rowSelectSingleIds){var mapObject={},data=[];if(entry.dataelements.single){mapObject[entry.id]="menu"}if(Object.keys(mapObject).length!=0&&mapObject.constructor===Object){rowSelectSingleIds.push(mapObject)}if(entry.children&&entry.children.length>0){entry.children.forEach(function(item){item=processRowSelectSinglEntries(item,rowSelectSingleIds)})}return rowSelectSingleIds};var processTypeRep=function(entry){var semantics=JSON.parse(entry.dataelements.semantics);entry.semantics=semantics;entry.stdTemplate=entry.dataelements.stdTemplate;return entry};var createItem=function(entry){return{title:entry.dataelements.label,type:"PushItem"}};exports.setEnableState=function(toolbar,disabledMenuIds,isDisabled,state){disabledMenuIds.forEach(function(item){for(var key in item){if(item[key]=="menu"){toolbar.updateNodeModel(key,{disabled:isDisabled})}else{if(item[key]=="subMenu"){toolbar.updateNodeModel(key,{state:state})}}}})};exports.processToolbarData=function(result,gridView){var toolbarData=this.defineToolbar(result);console.log(toolbarData);var toolbar=gridView.setToolbar(JSON.stringify(toolbarData));dgView._dgViewToolbar=toolbar;var gridModel=gridView.nodeModel;var that=this;var disabledMenuIds=[],disabledSubMenuIds=[],rowSelectSingleIds=[];toolbarData.entries.forEach(function(item){disabledMenuIds=exports.processedEntries(item,disabledMenuIds);rowSelectSingleIds=exports.processedRSEntries(item,rowSelectSingleIds)});gridModel.getXSO().onPostAdd(function(){exports.setEnableState(toolbar,disabledMenuIds,false,"selected");if(dataGridModel.getSelectedNodes().length>1){exports.setEnableState(toolbar,rowSelectSingleIds,true,"disabled")}});gridModel.getXSO().onPostRemove(function(){if(gridView.gridView.getNodesXSO().get().length===0){exports.setEnableState(toolbar,disabledMenuIds,true,"disabled")}else{if(dataGridModel.getSelectedNodes().length==1){exports.setEnableState(toolbar,disabledMenuIds,false,"selected")}}})};exports.init=function(){_pref3DSpace="../..";this.on3dspaceURLRetrieved(_pref3DSpace)};exports.on3dspaceURLRetrieved=function(url){var urlParameters=new URL(location.href);var toolbarMenu=urlParameters.searchParams.get("toolbar");var serviceURL=url+"/resources/v1/ui/toolbar/getToolbar?toolbar="+toolbarMenu;var queryOptions={type:"json",onComplete:function(data){loadToolbar(data)}};WAFData.authenticatedRequest(serviceURL,queryOptions)};exports.defineToolbar=function(data){var treeDoc=loadTreeDocument(data);return treeDoc};exports.processedEntries=function(entry,disabledEntries){var finalList=processDisabledEntries(entry,disabledEntries);return disabledEntries};exports.processedRSEntries=function(entry,rowSelectSingleIds){var finalList=processRowSelectSinglEntries(entry,rowSelectSingleIds);return rowSelectSingleIds};return exports})})(this);