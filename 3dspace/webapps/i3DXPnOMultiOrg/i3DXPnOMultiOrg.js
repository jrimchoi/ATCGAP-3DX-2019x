"use strict";define("DS/i3DXPnOMultiOrg/DataProxy",["DS/WAFData/WAFData"],function(a){var d,b;var c={setParams:function(f,e){d=f;b=e},request:function(f,e){f+=(f.indexOf("?")===-1?"?":"&");f+="tenant="+b;var g=e.headers||{};g.SecurityContext=d;e.headers=g;return a.authenticatedRequest(f,e)}};return c});"use strict";define("DS/i3DXPnOMultiOrg/OrganisationsOperator/Models/Org",["UWA/Class/Model"],function(b){var a=b.extend({idAttribute:"pid",defaults:{pid:"",name:"",type:"",host:"false",visible:"true",children:[],color:""},setup:function(){this.visibleChildren=null},sync:function(d){var c=this;d!=="delete"&&c._parent.apply(c,arguments)},getId:function(){return this.get("pid")||""},getName:function(){return this.get("name")||""},getChildren:function(){return this.get("children")||[]},getColor:function(){return this.get("color")},setColor:function(d,c){this.set("color",d,{silent:c})},isRoot:function(){return this.get("type")==="Company"},isVisible:function(){return this.get("visible")==="true"},destroy:function(){var c=this;c._parent.apply(c,arguments)}});return a});"use strict";define("DS/i3DXPnOMultiOrg/OrganisationsOperator/Collections/Orgs",["UWA/Core","UWA/Json","UWA/Class/Collection","DS/i3DXPnOMultiOrg/DataProxy","DS/i3DXPnOMultiOrg/OrganisationsOperator/Models/Org"],function(f,a,e,d,c){var b=e.extend({model:c,rootColor:["blue-root","yellow-root","red-root","orange-root","green-root","purple-root","pink-root","grey-root","black-root"],hostRootColor:"host-color-root",rootColorIndex:0,setup:function(h,g){this.roots=[]},sync:function(i,h,g){g.ajax=d.request;this._parent.apply(this,[i,h,g])},parse:function(g,h){return g.organizations},parseCollection:function(){var h=this,g=h.rootColor;h.forEach(function(j){if(j.isRoot()){j.get("host")==="true"?h.roots.unshift(j):h.roots.push(j);j.setColor(j.get("host")==="true"?h.hostRootColor:g[h.rootColorIndex%g.length]);var i=j.getColor();h.getVisibleChildrenOf(j).forEach(function(k){k.setColor(i)});h.rootColorIndex++}})},getRoots:function(){return this.roots},getChildrenOf:function(j){var g=[];var h=this;function i(l){var k=l.getChildren();k.forEach(function(m){m=h.get(m);g.splice(g.indexOf(l)!==-1?g.indexOf(l)+1:0,0,m);i(m)})}i(j);return g},getVisibleChildrenOf:function(h){var g=h.visibleChildren;if(g){return g}else{h.visibleChildren=this.getChildrenOf(h).filter(function(i){return i.isVisible()});return h.visibleChildren}},getPeopleColor:function(i){var h=i.getMemberOfIds(),g="",j;if(!h.length){return""}j=this.get(h[0]);g=j&&j.getColor();return g}});return b});"use strict";define("DS/i3DXPnOMultiOrg/OrganisationsOperator/Models/People",["UWA/Core","UWA/Class/Model","UWA/String","DS/i3DXPnOMultiOrg/DataProxy"],function(e,d,c,b){var a=d.extend({idAttribute:"pid",defaults:{pid:"",name:"",firstname:"",lastname:"",couples:[],organizations:[],assignmentOverflow:false,group:false},setup:function(g){var f=this;f.set("couples",g.couples||[],{silent:true});f.set("organizations",g.organizations||[],{silent:true})},sync:function(h,g,f){f.ajax=b.request;this._parent(h,g,f)},isGroup:function(){return this.get("group")},getNLSType:function(){return this.isGroup()?"groupType":"userType"},getId:function(){return this.get("pid")||""},getName:function(){return this.isGroup()?this.get("name"):c.ucfirst(this.get("firstname"))+" "+this.get("lastname").toUpperCase()},getMemberOfIds:function(){return this.get("organizations")||[]},getAssignments:function(){return this.get("couples")||[]},getNumberOfOwnerAssignments:function(){var f=this.getAssignments();return f.filter(function(g){return g.role==="VPLMProjectAdministrator"}).length},getNumberOfAssignments:function(){var f=this.getAssignments();return f.length-this.getNumberOfOwnerAssignments()},canOwnerRoleBeRemoved:function(f,h){var g;if(this.getNumberOfOwnerAssignments()===1){if(this.get("name")===f){g=false}else{if(f!==h){g=false}else{g=true}}}else{g=true}return g},canBeRemovedfromCS:function(f,h){var g;if(this.get("name")===f){g=false}else{if(this.getNumberOfOwnerAssignments()>0&&f!==h){g=false}else{g=true}}return g},_removeAssignmentImpl:function(f){var k=this,g=k.getAssignments(),h=[],l,j;for(j=0;j<g.length;j++){l=g[j];if(l.organization!==f){h.push(l)}}return h},setAssignment:function(j,f,h){var i=this,g=e.clone(i._removeAssignmentImpl(f));if(j==="VPLMProjectLeader"){g.push({role:"VPLMProjectAdministrator",organization:f})}g.push({role:c.ucfirst(j),organization:f});this.save({couples:g},{headers:{"Content-Type":"application/json"},wait:true,onComplete:h.onComplete,onFailure:h.onFailure})},removeAssignment:function(f,g){this.save({couples:this._removeAssignmentImpl(f)},{headers:{"Content-Type":"application/json"},wait:true,onComplete:g.onComplete,onFailure:g.onFailure})},destroy:function(){var f=this;f._parent.apply(f,arguments)}});return a});"use strict";define("DS/i3DXPnOMultiOrg/OrganisationsOperator/Collections/Peoples",["UWA/Core","UWA/Json","UWA/Class/Collection","DS/i3DXPnOMultiOrg/DataProxy","DS/i3DXPnOMultiOrg/OrganisationsOperator/Models/People"],function(f,b,d,c,e){var a=d.extend({model:e,setView:function(g){var h=this;h.view=g;h.addEvent("onChange:couples",function(i){h.view.dispatchEvent("onAssignmentsChange",i)})},sync:function(i,h,g){g.ajax=c.request;this._parent.apply(this,[i,h,g])},parse:function(g,h){return g.members}});return a});"use strict";define("DS/i3DXPnOMultiOrg/OrganisationsOperator/Views/OrganisationsOperator",["UWA/Core","UWA/Class/View","UWA/Event","UWA/Element","UWA/Utils","UWA/String","DS/UIKIT/SuperModal","DS/UIKIT/Input/Text","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/i3DXPnOMultiOrg/OrganisationsOperator/Collections/Peoples","DS/i3DXPnOMultiOrg/OrganisationsOperator/Collections/Orgs","i18n!DS/i3DXPnOMultiOrg/assets/nls/OrganisationsOperator","css!DS/i3DXPnOMultiOrg/i3DXPnOMultiOrg.css"],function(j,w,f,t,k,d,m,o,z,y,v,e,h){var A=false,n=false,i=0,q=0,r=null,c=null,p=750,s=750;function l(F,I,E){var D,H,B,G=0;function C(){G=new Date().getTime();H=null;B=F.apply(E,D)}return function(){var J=new Date().getTime(),K=I-(J-G);E=E||this;D=arguments;if(K<=0){clearTimeout(H);H=null;G=J;B=F.apply(E,D)}else{if(!H){H=setTimeout(C,K)}}return B}}function u(E,D,B,C){if(j.is(E,"function")){if(C){setTimeout(function(){E.apply(D,B)})}else{E.apply(D,B)}}}function b(C,B){return C.replace(/\{([\w\-]+)\}/g,function(D,E){return B[E]!==undefined?B[E]:""})}function x(F,D){var H,I,C,B,G,E;H=D.getDimensions();I=H.width;C=F.getOffsets().x-D.getOffsets().x;B=C+F.getDimensions().width;G=(C>=0&&B<=I);E=((C<0&&B>0)||(C>=0&&C<=H.width));return{totally:G,partially:E,visible:G||E}}function g(C,B){if(C.scroll){C.scroll(B)}else{if(B.top){C.scrollTop=B.top}if(B.left){C.scrollLeft=B.left}}}var a=w.extend({tagName:"div",className:"orgsop-view",domEvents:{"click .content-line .suborg-cell":"_clickOnCell","click .add-people-btn":"_clickOnAddUsersBtn","click .close-view-btn":"_clickOnCloseViewBtn","click .people-trash-ctn":"_clickOnTrashBtn","click .left-orgnav-btn":"_clickOnLeftOrgNavBtn","click .right-orgnav-btn":"_clickOnRightOrgNavBtn"},events:{onAddUsers:null,onRemoveUser:null},currentUser:"",swymUrl:null,peoplesCollection:null,orgsCollection:null,roleIcons:{VPLMProjectLeader:"fonticon fonticon-favorite-on",VPLMProjectAdministrator:"fonticon fonticon-key",VPLMCreator:"fonticon fonticon-feather",VPLMExperimenter:"fonticon fonticon-chat",VPLMViewer:"fonticon fonticon-eye",VPLMSecuredCrossAccess:"fonticon fonticon-eye"},rolesDDMenu:null,selectedCell:null,hoverPeopleCell:null,hoverContentCell:null,setup:function(B){var C=B||{};this.readOnly=C.readOnly;this.currentUser=(C.currentUser||"");this.swymUrl=C.swymUrl||"";this.roles=C.roles;this.mainOwner=C.mainOwner;this.peoplesCollection=C.peopleCollection;this.peoplesCollection.setView(this);this.orgsCollection=C.orgsCollection;this.orgsCollection.parseCollection();this.successAlert=C.successAlert;this.errorAlert=C.errorAlert;j.merge(this.events,C.events||{})},render:function(){var J=this,V=k.Client.getScrollbarWidth(),N=J.container,Q,M,U,O,F,H,C,K,I,D,G,S,R,P,B,L,T,E;U=j.createElement("div",{"class":"buttons-row-ctn",html:[J.readOnly?null:Q=j.createElement("div",{"class":"fonticon fonticon-user-add action-btn add-people-btn",title:h.addNewUser}),M=j.createElement("div",{"class":"fonticon fonticon-close action-btn close-view-btn",title:h.closeAdvView})]});O=j.createElement("div",{"class":"table-ctn"});J.container.addContent(U,O);if(J.orgsCollection.isEmpty()){O.addContent(j.createElement("div",{"class":"empty-table",text:h.emptyTable}));return J}O.addContent(C=j.createElement("div",{"class":"header-line",html:[F=j.createElement("div",{"class":"filter-cell",html:[j.createElement("div",{"class":"filter-ctn",html:[new o({className:"search-filter hide",placeholder:h.searchPlaceHolder}),j.createElement("div",{"class":"fonticon fonticon-tag-sorting sort-icon hide"})]})]}),j.createElement("div",{"class":"orgs-col",html:[H=j.createElement("div",{"class":"navorg-cell",html:[j.createElement("div",{"class":"navorg-ctn",html:[L=j.createElement("div",{"class":"fonticon fonticon-chevron-left left-orgnav-btn nav-btn disabled",title:h.previousOrgNavBtn}),j.createElement("div",{"class":"navorg-middle-ctn",text:h.contentOwnByTitle}),j.createElement("div",{"class":"fonticon fonticon-network org-explode-btn nav-btn hide",}),T=j.createElement("div",{"class":"fonticon fonticon-chevron-right right-orgnav-btn nav-btn",title:h.nextOrgNavBtn})]})]}),G=j.createElement("div",{"class":"orgs-line"})]})]}),K=j.createElement("div",{"class":"contents-line",html:[I=j.createElement("div",{"class":"peoples-col",styles:{"padding-bottom":V}}),D=j.createElement("div",{"class":"contents-col",html:[S=j.createElement("div",{"class":"contents-ctn"})],events:{scroll:J._onScroll.bind(J)}}),E=j.createElement("div",{"class":"action-overlay"})]}),P=j.createElement("div",{"class":"horizontal-highlight"}),B=j.createElement("div",{"class":"vertical-highlight"}));J.orgsCollection.getRoots().forEach(function(Z){var X=Z.getName();G.addContent(j.createElement("div",{"class":"org-cell",html:[j.createElement("div",{"class":"rootorg-cell",html:[j.createElement("div",{"class":"rootorg-ctn",html:[j.createElement("div",{"class":"rootorg-name",text:X.toUpperCase(),title:X,styles:{width:((Z.isVisible()?1:0)+J.orgsCollection.getVisibleChildrenOf(Z).length)*138-5+"px",overflow:"hidden","text-overflow":"ellipsis"}}),j.createElement("div",{"class":"rootorg-color "+Z.getColor()})]})]}),j.createElement("div",{"class":"subsorg-cell",html:J._buildSubOrgCell(Z)})]}));var Y=G.getElement('div[title="'+Z.getName()+'"]');var W=new y({target:Y,body:X,position:"top"})});G.addContent(j.createElement("div",{html:'<div style="width: 138px"></div>'}));J.peoplesCollection.forEach(function(W){I.addContent(J._buildPeopleCell(W));S.addContent(J._buildContentLine(W))});J.elements={horizontalHighlight:P,verticalHighlight:B,headerLine:C,orgsLine:G,peoplesCol:I,contentsCol:D,contentsCtn:S,actionOverlay:E,leftOrgNavBtn:L,rightOrgNavBtn:T};return J},onPostInject:function(){var D=this,E=D.elements,C=E.contentsCtn,F=E.orgsLine,B=k.Client.getScrollbarWidth();C.setStyles({width:F.scrollWidth-B+"px"});E.verticalHighlight.setStyles({top:C.getPosition().y});D._addEvents()},onFacetSelect:function(){},onPositionChange:function(){this.onResize()},onResize:function(){},destroy:function(){var B=this;if(B.peoplesCollection){B.peoplesCollection=null}if(B.orgsCollection){B.orgsCollection=null}B._parent.apply(B,arguments);B.elements=null},_buildSubOrgCell:function(E){var D=this;function C(F){return j.createElement("div",{"class":"suborg-cell",html:[j.createElement("div",{"class":"suborg-ctn",html:[j.createElement("div",{"class":"suborg-name",text:d.capitalize(F.getName().toLowerCase())})]})]})}var B=E.isVisible()?[C(E)]:[];return B.concat(D.orgsCollection.getVisibleChildrenOf(E).map(C))},_buildPeopleCell:function(D){var E=this,G=E.orgsCollection,F="",C=D.getId();if(E.swymUrl&&!D.isGroup()){var B=k.parseUrl(E.swymUrl);if(B.authority){F=d.format("{0}://{1}{2}api/user/getpicture/login/{3}/format/normal",B.protocol||"https",B.authority,B.directoryPath||"/",D.get("name"))}}return j.createElement("div",{"class":"people-cell people-id-"+C,html:[j.createElement("div",{"class":"peopleorg-color "+G.getPeopleColor(D)}),j.createElement("div",{"class":"people-ctn",html:[j.createElement("div",{"class":D.isGroup()?"profile-pic-ctn fonticon fonticon-users":"profile-pic-ctn fonticon fonticon-user",html:j.createElement("div",{"class":"profile-pic",styles:{"background-image":'url("'+F+'")'}})}),j.createElement("div",{"class":"people-info-ctn",html:[j.createElement("div",{"class":"name-ctn",text:D.getName()}),D.isGroup()?null:j.createElement("div",{"class":"memberof-org-ctn",html:E._buildPeopleMemberOfInfo(D)})]}),E.readOnly?null:j.createElement("div",{"class":"separator"}),E.readOnly?null:j.createElement("div",{"class":"people-trash-ctn "+(D.canBeRemovedfromCS(E.currentUser,E.mainOwner)?"":"disabled"),title:h.replace(h.get("trashBtn"),{type:h.get(D.getNLSType())}),html:[j.createElement("div",{"class":"fonticon fonticon-trash trash-btn"})]})]})]}).setData("people",{id:C})},_buildPeopleMemberOfInfo:function(D){var E=this,B=D.getAssignments(),H=D.getMemberOfIds();var G=j.createElement("div",{"class":"memberof-names",html:H.map(function(J){var I=!!B.filter(function(K){return J===K.organization}).length;return'<span class="org-name '+(I?"has-assignment":"")+'">'+d.capitalize(E.orgsCollection.get(J).getName().toLowerCase())+"</span>"}).join(" - ")});var F=G.textContent.length;if(F>37){var C=new y({target:G,className:"memberof-tooltip",body:G.innerHTML,position:"right"})}return G},_buildContentLine:function(D){var E=this,C=D.getId();function B(F){var G=F.isVisible()?[E._buildCell(D,F)]:[];return G.concat(E.orgsCollection.getVisibleChildrenOf(F).map(function(H){return E._buildCell(D,H)}))}return j.createElement("div",{"class":"content-line people-id-"+C,html:E.orgsCollection.getRoots().map(function(F){return j.createElement("div",{"class":"subsorg-cell"+(E.readOnly?" read-only":""),html:B(F)})})}).setData("people",{id:C})},_buildCell:function(L,K){var I=this,D=K.getId(),C=L.getMemberOfIds(),B=L.getAssignments().filter(function(M){return M.organization===D}),H,E=false,F={orgId:D,peopleId:L.getId()},G=[],J;E=C.indexOf(D)>=0;if(E){F.isMemberOf=E}if(B.length){if(B.length===2){if(B[0].role!=="VPLMProjectLeader"){B.reverse()}}B=B.map(function(P,N){var M=(P.role||""),O=E&&!L.isGroup()?I.roleIcons[M]:"";G.push(M);M=h[M];return j.createElement("div",{"class":"role-ctn "+O,html:j.createElement("div",{"class":"role-name",text:N?"& "+M:M})})});H=j.createElement("div",{"class":"assignments-ctn",html:B});F.roles=G}J=j.createElement("div",{"class":"content-cell suborg-cell",html:[j.createElement("div",{"class":"suborg-ctn "+(E&&H&&!L.isGroup()?"memberof":""),html:[H,j.createElement("div",{"class":"fonticon fonticon-chevron-down menu-icon "+(!H||I.readOnly?"has-no-role":"")})]})],events:{mouseenter:I._onMouseEnterCell.bind(I)}}).setData("data",F);return J},_addEvents:function(){var F=this,G=F.elements,C=G.contentsCol,H=G.orgsLine,B=G.peoplesCol,D=G.horizontalHighlight,E=G.verticalHighlight;F.addEvent("onAssignmentsChange",F._onAssignmentsChange.bind(F));C.addEvent("mouseenter",function(){D.addClassName("show");E.addClassName("show")});C.addEvent("mouseleave",function(){var I=F.rolesDDMenu||{};if(I.isVisible){return}D.removeClassName("show");E.removeClassName("show")});F.container.addEvent("mousewheel",function(I){if(A||n){if(I.preventDefault){I.preventDefault()}I.returnValue=false;return false}});B.addEvent("mouseenter",function(){A=true});B.addEvent("mouseleave",function(){A=false});H.addEvent("mouseenter",function(){n=true});H.addEvent("mouseleave",function(){n=false});B.addEvent("mousewheel",l(function(I){var J=I.wheelDelta;F._scrollContent({way:J>0?"up":"down",delta:J,behavior:"smooth"})},200));H.addEvent("mousewheel",l(function(I){var J=I.wheelDelta;F._scrollContent({way:J>0?"right":"left",delta:J,behavior:"smooth"})},200))},selectCell:function(B){B.addClassName("selected");this.selectedCell=B},_unSelectCell:function(B){B=B||this.selectedCell;if(!B){return}B.removeClassName("selected");this.selectedCell=null},_hoverPeopleCell:function(B){B.addClassName("hover");this.hoverPeopleCell=B},_hoverContentCell:function(B){B.addClassName("hover");this.hoverContentCell=B},_unHoverPeopleCell:function(B){B=B||this.hoverPeopleCell;if(!B){return}B.removeClassName("hover");this.hoverPeopleCell=null},_unHoverContentCell:function(B){B=B||this.hoverContentCell;if(!B){return}B.removeClassName("hover");this.hoverContentCell=null},_showActionOverlay:function(){this.elements.actionOverlay.addClassName("show")},_hideActionOverlay:function(){this.elements.actionOverlay.removeClassName("show")},_clickOnCell:function(P){var G=this,S=P.target,T,F,E,H,I,K,M,C,B;if(G.readOnly){return}function O(U){return K.indexOf(U)>=0}G._unSelectCell();C=S.hasClassName("content-cell")?S:S.getParent(".content-cell");H=C.getParent(".content-line");I=C.getData("data");K=I.roles||[];M=K.length===0;F=H.getData("people").id;E=G.peoplesCollection.get(F);var J=O("VPLMProjectLeader")&&!E.canOwnerRoleBeRemoved(this.currentUser,this.mainOwner);var Q=h.replace(h.get("lastOwnerRole"),{type:h.get(E.getNLSType())});T=[{text:h.VPLMExperimenter,name:"VPLMExperimenter",selectable:true,disabled:J,attributes:J?{title:Q}:{},selected:O("VPLMExperimenter")},{text:h.VPLMCreator,name:"VPLMCreator",selectable:true,disabled:J,attributes:J?{title:Q}:{},selected:O("VPLMCreator")},{text:h.VPLMProjectLeader+" & "+h.VPLMProjectAdministrator,name:"VPLMProjectLeader",selectable:true,selected:O("VPLMProjectLeader")}];var R=G.roles||[];var L=false,D=false;for(var N=0;N<R.length;N++){if(R[N]==="PublicReader"){D=true}else{if(R[N]==="Reader"){L=true}}}if(L){T.unshift({text:h.VPLMViewer,name:"VPLMViewer",selectable:true,disabled:J,attributes:J?{title:Q}:{},selected:O("VPLMViewer")})}if(D){T.unshift({text:h.VPLMSecuredCrossAccess,name:"VPLMSecuredCrossAccess",selectable:true,disabled:J,attributes:J?{title:Q}:{},selected:O("VPLMSecuredCrossAccess")})}if(!M){B={text:h.revoke,name:"revoke",fonticon:"block",selectable:false,disabled:J,attributes:J?{title:Q}:{}};if(E.getNumberOfAssignments()<2){B.disabled=true;B.attributes.title=B.attributes.title||h.replace(h.get("unableToRevoke"),{type:h.get(E.getNLSType())})}T.unshift(B)}if(G.rolesDDMenu){G.rolesDDMenu.destroy()}G.rolesDDMenu=new z({target:C.getElement(".menu-icon"),items:T,events:{onClick:function(V,U){G._clickOnRoleDDMenu(V,U,C,I,K,E)},onHide:function(){G._unSelectCell()}}});G.selectCell(C);G.rolesDDMenu.show()},_clickOnRoleDDMenu:function(I,K,J,G,E,M){var H=this,L=K.name,D;function F(O,N){return N.indexOf(O)===-1||(N.length>1&&O!=="VPLMProjectLeader")}if(!F(L,E)){return}D=G.orgId;var C=function(N){H._hideActionOverlay();var O=[{message:h.replace(h.get("success.changeAssignment"),{type:h.get(M.getNLSType())})}];if(N.get("assignmentOverflow")){O.push({message:h.replace(h.get("warning.assignmentOverflow"),{type:h.get(M.getNLSType())}),className:"warning"})}H.successAlert.add(O);H._buildCell(M,H.orgsCollection.get(D)).inject(J,"after");J.remove();J=null};var B=function(){H._hideActionOverlay();H.errorAlert.add({message:h.replace(h.get("error.changeAssignment"),{type:h.get(M.getNLSType())})})};H._showActionOverlay();if(L==="revoke"){M.removeAssignment(D,{onComplete:C,onFailure:B})}else{M.setAssignment(L,D,{onComplete:C,onFailure:B})}},_clickOnTrashBtn:function(I){var F=this,H=I.target,B,C,E,D,G;G=H.hasClassName("people-trash-ctn")?H:H.getParent(".people-trash-ctn");if(G.hasClassName("disabled")){return}B=H.getParent(".people-cell");C=B.getData("people").id;E=F.peoplesCollection.get(C);D=E.getName();new m({closable:true}).confirm(b(h.removeUserMsg,{name:D}),h.removeUserTitle,function(K){var J;if(K){var M=function(){F._hideActionOverlay();F.successAlert.add({message:h.replace(h.get("success.removeUser"),{type:h.get(E.getNLSType())})});J=F.elements.contentsCtn.getElement(".content-line.people-id-"+C);J.addClassName("removed");B.addClassName("removed");setTimeout(function(){B&&B.remove();B=null;J&&J.remove();J=null},s);F.events.onRemoveUser(E.get("name"))};var L=function(){F._hideActionOverlay();F.errorAlert.add({message:h.replace(h.get("error.removeUser"),{type:h.get(E.getNLSType())})})};F._showActionOverlay();E.destroy({wait:true,onComplete:M,onFailure:L})}})},_clickOnAddUsersBtn:function(){u(this.events.onAddUsers,this)},_clickOnCloseViewBtn:function(){this.events.onCloseView()},_clickOnLeftOrgNavBtn:function(){var K=this,C=K.elements,M=C.orgsLine,D=C.contentsCol,L=D.scrollLeft,I,J,H,F,G,E;function B(N){return M.scrollLeft+N.getPosition().x}if(L===0){return}E=M.getElements(".org-cell");for(I=0;I<E.length;I++){J=E[I];H=x(J,M);if(H.totally){if(I===0){return}F=E[I-1];break}if(H.partially){F=J;break}}G=B(F);if(I!==0&&E.length>1&&G===L){F=E[I-1];G=B(F)}K._scrollContent({way:"left",left:G,behavior:"smooth"})},_clickOnRightOrgNavBtn:function(){var I=this,B=I.elements,J=B.orgsLine,K=B.rightOrgNavBtn,G,H,F,D,E,C;if(K.hasClassName("disabled")){return}C=J.getElements(".org-cell");for(G=0;G<C.length;G++){H=C[G];F=x(H,J);if(F.visible){if(G+1>=C.length){return}D=C[G+1];break}}E=J.scrollLeft+D.getOffsets().x-J.getOffsets().x;I._scrollContent({way:"right",left:E,behavior:"smooth"})},_getPeopleCell:function(B){return this.elements.peoplesCol.getElement(".people-id-"+B)},_onMouseEnterCell:function(G){var E=this,B=G.target,D=B.getPosition(),F=E.elements,C=B.getData("data");E._unHoverPeopleCell();E._unHoverContentCell();F.horizontalHighlight.setStyles({transform:"translateY("+D.y+"px)"});F.verticalHighlight.setStyles({transform:"translateX("+D.x+"px)"});E._hoverPeopleCell(E._getPeopleCell(C.peopleId));E._hoverContentCell(B)},_onScroll:function(){var E=this,D=E.elements.contentsCol,B=D.scrollTop,C=D.scrollLeft;if(E.rolesDDMenu){E.rolesDDMenu.destroy()}E._unSelectCell();if(B>i){E._onScrollV("down")}else{if(B<i){E._onScrollV("up")}}i=B;if(C>q){E._onScrollH("right")}else{if(C<q){E._onScrollH("left")}}q=C},_onScrollV:function(E,D){D=D||{};var F=this,G=F.elements,B=G.peoplesCol,H=G.headerLine,C=G.contentsCol;g(B,{top:D.top||C.scrollTop-(D.delta||0),behavior:D.behavior});H.addClassName("scrolling");clearTimeout(r);r=setTimeout(function(){H.removeClassName("scrolling")},p);i=C.scrollTop},_onScrollH:function(L,O){O=O||{};var H=this,B=H.elements,E=B.peoplesCol,K=B.orgsLine,D=B.contentsCol,I=B.leftOrgNavBtn,M=B.rightOrgNavBtn,N,F,G,J;function C(Q,P){Q[(P?"add":"remove")+"ClassName"]("disabled")}g(K,{left:O.left||D.scrollLeft-(O.delta||0),behavior:O.behavior});L==="left"&&E.addClassName("scrolling");L==="right"&&D.addClassName("scrolling");clearTimeout(c);c=setTimeout(function(){E.removeClassName("scrolling");D.removeClassName("scrolling")},p);N=D.scrollLeft;q=N;C(I,N===0);F=K.getElements(".org-cell");if(F.length>1){G=x(F[F.length-2],K);J=x(F[F.length-1],K);C(M,!G.visible&&J.visible)}else{C(M,true)}},_scrollContent:function(M){M=M||{};var H=this,C=H.elements.contentsCol,I=j.is(M.top,"number")?M.top:undefined,E=j.is(M.left,"number")?M.left:undefined,B=M.behavior,J=j.is(M.delta)?M.delta:undefined,K=M.way,G=J&&(K==="up"||K==="down"),L=J&&(K==="right"||K==="left"),D,F;D=G&&J?C.scrollTop-J:I;F=L&&J?C.scrollLeft-J:E;g(C,{top:D,left:F,behavior:B});j.log(J);if(I||G){H._onScrollV(K,{top:D,behavior:B})}if(E||L){H._onScrollH(K,{left:F,behavior:B})}},_onAssignmentsChange:function(D){var F=this,C=D.getId(),B=F._getPeopleCell(C);if(!D.isGroup()){B.getElement(".memberof-org-ctn").empty().addContent(F._buildPeopleMemberOfInfo(D))}if(!D.canBeRemovedfromCS(F.currentUser,F.mainOwner)){var E=B.getElement(".people-trash-ctn");if(!E.hasClassName("disabled")){E.addClassName("disabled")}}}});return a});"use strict";define("DS/i3DXPnOMultiOrg/OrgOperatorController",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Json","DS/UIKIT/Alert","DS/i3DXPnOMultiOrg/OrganisationsOperator/Collections/Orgs","DS/i3DXPnOMultiOrg/OrganisationsOperator/Collections/Peoples","DS/i3DXPnOMultiOrg/OrganisationsOperator/Views/OrganisationsOperator","DS/i3DXPnOMultiOrg/DataProxy"],function(e,b,j,c,f,h,g,d,a){var i=b.extend(j,{options:{},container:null,orgsOpView:null,buildSkeleton:function(){var k=this.options;this.container.empty();this.successAlert=new f({className:"message-alert",closable:true,visible:true,autoHide:true,messageClassName:"success"});this.errorAlert=new f({className:"message-alert",closable:true,visible:true,autoHide:true,messageClassName:"error"});this.orgsOpView=new d({currentUser:k.currentUser,readOnly:!k.owner,swymUrl:k.swymUrl,roles:k.roles,mainOwner:k.mainOwner,orgsCollection:k.orgsCollection,peopleCollection:k.peopleCollection,successAlert:this.successAlert,errorAlert:this.errorAlert,events:{onAddUsers:k.onAddUsers||function(){},onRemoveUser:(function(l){this.dispatchEvent("onRemoveUser",[l])}).bind(this),onCloseView:k.onCloseView||this.destroy.bind(this)}});this.orgsOpView.render().inject(this.container);this.successAlert.inject(this.container);this.errorAlert.inject(this.container)},init:function(k){this.options=e.clone(k,false)||{};this.container=e.extendElement(k.container)},load:function(){var q=this,n=this.options,o=n.spaceUrl,m=n.collabSpace,p=n.securityContext,l=n.tenantId;a.setParams(p,l);var r=new h([],{url:o+"/resources/pno/collaborativespace/"+m+"/organizations"});var k=new g([],{url:o+"/resources/pno/collaborativespace/"+m+"/members"});r.fetch({onComplete:function(){k.fetch({onComplete:function(){n.orgsCollection=r;n.peopleCollection=k;q.buildSkeleton()},onFailure:function(){}})},onFailure:function(){}})},refresh:function(){var k=this;if(k.orgsOpView){k.orgsOpView.destroy()}if(k.successAlert){k.successAlert.destroy()}if(k.errorAlert){k.errorAlert.destroy()}k.orgsOpView=null;k.successAlert=null;k.errorAlert=null;k.load()},destroy:function(){var k=this;k.container=null;if(k.orgsOpView){k.orgsOpView.destroy()}if(k.successAlert){k.successAlert.destroy()}if(k.errorAlert){k.errorAlert.destroy()}k.orgsOpView=null;k.successAlert=null;k.errorAlert=null;k.removeEvents()},onAddUsersEnd:function(){this.refresh()}});return i});