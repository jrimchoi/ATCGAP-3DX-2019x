/*!  COPYRIGHT DASSAULT SYSTEMES 2016   */
define("DS/PSDCommands/views/PSDDlgReorderProduct",["UWA/Core","UWA/Class","UWA/Class/Options","css!DS/PSDCommands/PSDCommands.css","DS/Core/PointerEvents"],function(f,b,a,d,c){var e=b.extend(a,{name:"PSDDlgReorderProduct",_logger:null,_modal:null,options:{},_treeListView:null,_manualButtons:[],_automaticButtons:[],_reorderMode:undefined,_initialList:[],init:function(g){this._parent(g);var h=this;if(sessionStorage.PSDDlgReorderDnDIsHeader){delete sessionStorage.PSDDlgReorderDnDIsHeader}if(sessionStorage.PSDDlgReorderDnDIsCell){delete sessionStorage.PSDDlgReorderDnDIsCell}require(["DS/Logger/Logger"],function(j){h._logger=j.getLogger(e);h._manualButtons=[];h._automaticButtons=[];h._initialList=[];h.setOptions(g);if(!g.renderTo){g.renderTo=document.body}g.children.sort(function(p,i){return p.options.relationOrder-i.options.relationOrder});var n=g.children.length;var l=new Array(n);for(var m=0;m<n;m++){var o=g.children[m];l[m]={label:o.options.label,created:new Date(o.options.grid["ds6w:created"]),modified:new Date(o.options.grid["ds6w:modified"]),responsible:o.options.grid["ds6w:responsible"],relationid:o.getRelationID(),physicalid:o.getID()}}var k=l;h._createPanel(k,g)})},_createPanel:function(h,g){var i=this;require(["i18n!DS/PSDCommands/assets/nls/PSDDlgReorderProduct.json","DS/UIKIT/Modal","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ComboBox","DS/UIKIT/Tooltip"],function(j,k,u,x,E,B){var s=f.createElement("div",{"class":"reorder-modal-body"});i._modal=new k({className:i.name+"_modal",animate:false,closable:true,visible:true,overlay:true,header:"<h4>"+j.modalHeader+"</h4>",body:s,footer:"<button type='button' class='btn btn-default reorder-btn-reset-tree-order' style='float:left' >"+j.modalFooterReset+"</button><button type='button' class='btn btn-primary disabled reorder-btn-ok'>"+j.modalFooterOK+"</button><button type='button' class='btn btn-default reorder-btn-cancel'>"+j.modalFooterCancel+"</button> "});i._modal.inject(g.renderTo);i._modal.elements.container.addEventListener("click",function(F){});i._modal.elements.content.addEventListener("click",function(F){F.preventDefault();F.stopPropagation();return false});i._modal.getFooter().querySelector(".reorder-btn-reset-tree-order").addEventListener("click",function(F){i._treeListView.getManager().prepareUpdateView();var H=i._treeListView.getDocument().getRoots();for(var G=0;G<i._initialList.length;G++){if(i._initialList[G]!==H[G]){var I=H[G];I.getParent().insertBefore(i._initialList[G],I)}if(H[G].isSelected()){H[G].unselect()}}for(var G=H.length-1;G>i._initialList.length;G--){H[G].remove()}H.length=i._initialList.length;i._treeListView.getManager().pushUpdateView();i._modal.getFooter().querySelector(".btn-primary").classList.add("disabled")});i._modal.getFooter().querySelector(".reorder-btn-cancel").addEventListener("click",function(F){i._modal.hide()});i._modal.getFooter().querySelector(".reorder-btn-ok").addEventListener("click",function(F){i._modal.hide();i.options.onReorderDone(i._treeListView.getDocument().getRoots())});var q=new f.Element("div",{"class":"wux-control-inline-container"}).inject(s);i.toggleManual=new x({type:"radio",label:j.toggleManual,checkFlag:true}).inject(q);var r=new f.Element("div").inject(q);new f.Element("hr").inject(q);i.toggleAutomatic=new x({type:"radio",label:j.toggleAutomatic}).inject(q);var t=new f.Element("div").inject(q);i.toggleManual.elements.container.addClassName("toggle-radio-inline-block reorder-toggle-manual");i.toggleAutomatic.elements.container.addClassName("toggle-radio-inline-block reorder-toggle-auto");var o=new f.Element("div",{"class":"reorder-manual-listview-container"}).inject(r);var w=new f.Element("div",{"class":"reorder-manual-updown-container"}).inject(r);i.reorderUp=new u().inject(w);i.reorderDown=new u().inject(w);i.reorderFree=new u().inject(w);new B({target:i.reorderUp.getContent(),body:j.upArrow});new B({target:i.reorderDown.getContent(),body:j.downArrow});new B({target:i.reorderFree.getContent(),body:j.freeArrow});i.reorderUp.elements.container.addClassName("reorder-manual-button-up-arrow");i.reorderDown.elements.container.addClassName("reorder-manual-button-down-arrow");i.reorderFree.elements.container.addClassName("reorder-manual-button-free");i._manualButtons.push(i.reorderUp);i._manualButtons.push(i.reorderDown);i._manualButtons.push(i.reorderFree);var z=new f.Element("span").inject(t);z.addClassName("display-table-cell");var n=[j.criterionTitle,j.criterionResponsible,j.criterionCreationDate,j.criterionModifiedDate];var D=new E({elementsList:n,selectedIndex:0,enableSearchFlag:true,}).inject(z);D.enableSearchFlag=false;var l=new f.Element("span").inject(t);l.addClassName("display-table-cell");var y=new x({type:"radio",label:j.ascending,checkFlag:true,}).inject(l);y.elements.container.addClassName("toggle-radio-inline-block reorder-auto-toggle reorder-auto-toggle-ascending");var A=new x({type:"radio",label:j.descending,}).inject(l);A.elements.container.addClassName("toggle-radio-inline-block reorder-auto-toggle reorder-auto-toggle-descending");i._automaticButtons.push(D);i._automaticButtons.push(y);i._automaticButtons.push(A);i._createTreeListView(o,h);function C(){var F=[];var H=i._treeListView.getDocument().getSelectedNodes();H.sort(function(J,I){return J._rowID-I._rowID});for(var G=0;G<H.length;G++){F.push({label:H[G].options.label,rowID:H[G]._rowID,newRowID:H[G]._rowID})}return F}i.reorderUp.addEventListener("click",function p(M){var G=C();var F=false;var H=i._treeListView.getDocument().getRoots();i._treeListView.getManager().prepareUpdateView();for(var J=0;J<G.length;J++){var L=G[J];if(L.rowID===0){continue}if((J===0&&L.rowID>0)||(G[J-1].newRowID!==L.rowID-1)){var K=H[L.rowID];L.newRowID=L.rowID-1;K.getParent().insertBefore(K,H[L.newRowID]);K.select();F=true}}i._treeListView.getManager().pushUpdateView();if(!F){return}var I=i._treeListView.getManager()._getVirtualPositionFromScrollPosition().rowID;if(G[0].newRowID<=I){i._treeListView.getManager().scrollToRow(G[0].newRowID,"top")}i._modal.getFooter().querySelector(".btn-primary").classList.remove("disabled")});i.reorderDown.addEventListener("click",function p(K){var O=C();var H=i._treeListView.getDocument().getRoots().length-1;var M=false;var L=i._treeListView.getDocument().getRoots();i._treeListView.getManager().prepareUpdateView();for(var I=O.length-1;I>=0;I--){var N=O[I];if(N.rowID===H){continue}if(I===O.length-1||(O[I+1].newRowID!==N.rowID+1)){var F=L[N.rowID];N.newRowID=N.rowID+1;F.getParent().insertBefore(F,L[N.newRowID+1]);F.select();M=true}}i._treeListView.getManager().pushUpdateView();if(!M){return}var G=i._treeListView.getManager()._getVirtualPositionFromScrollPosition().rowID;var J=Math.min(i._treeListView.getDocument().getRoots().length,14)+G;if(O[O.length-1].newRowID+1>=J){i._treeListView.getManager().scrollToRow(O[O.length-1].newRowID+1,"bottom")}i._modal.getFooter().querySelector(".btn-primary").classList.remove("disabled")});i.reorderFree.addEventListener("click",function p(H){if(i.reorderFreeRunning===true){return}var F=C();var I=i._treeListView.getDocument().getSelectedNodes();if(F.length===0){return}i.toggleAutomatic.disabled=true;i.reorderUp.disabled=true;i.reorderDown.disabled=true;i._modal.getFooter().querySelector(".reorder-btn-reset-tree-order").disabled=true;var G;i.reorderFreeRunning=true;i.reorderFreeEmptyAreaCB=function(P){function M(T){if(!T.hasOwnProperty("offsetX")){var S=T.target||T.srcElement,R=S.getBoundingClientRect(),Q=T.clientX-R.left,U=T.clientY-R.top;return{offsetX:Q,offsetY:U}}else{return{offsetX:T.offsetX,offsetY:T.offsetY}}}var O=M(P);var L=18;if(P.target.className.indexOf("wux-scroller")!==-1){var N=f.extendElement(P.target).getDimensions();var K=N.width;var J=N.height;if(O.offsetX<(K-L)&&O.offsetY<(J-L)){i._reorderFreeEmptyAreaRunning=true;I.forEach(function(R,Q){R.select()});i._reorderFreeEmptyAreaRunning=false}}};i._treeListView.getManager().elements.container.addEvent(c.POINTERUP,i.reorderFreeEmptyAreaCB);i.reorderFreeOnAddCB=i._treeListView.getDocument().getXSO().onAdd(function(L){if(i._reorderFreeEmptyAreaRunning){return false}i._treeListView.getDocument().getXSO()._modelEvents.unsubscribe(i.reorderFreeOnAddCB);i._treeListView.getManager().elements.container.removeEvent(c.POINTERUP,i.reorderFreeEmptyAreaCB);L.unselect();i.toggleAutomatic.disabled=false;i.reorderUp.disabled=false;i.reorderDown.disabled=false;i._modal.getFooter().querySelector(".reorder-btn-reset-tree-order").disabled=false;G=L._getRowID();var Q=i._treeListView.getDocument().getRoots();var J=L.getParent();var K={UNDEFINED:0,UP:1,DOWN:2,CENTER:3,IN_SELECTION:4};var S=0,M=0,T=false;for(var P=0;P<F.length;P++){if(F[P].rowID===G){T=true;break}else{F[P].rowID<G?M++:S++}}var R=K.UNDEFINED;if(T){R=K.IN_SELECTION}else{if(M>0&&S===0){R=K.DOWN}else{if(S>0&&M===0){R=K.UP}else{R=K.CENTER}}}i._treeListView.getManager().prepareUpdateView();var O=[];for(var P=F.length-1;P>=0;P--){var N=Q[F[P].rowID];O.push(N.remove());if(F[P].rowID<G){G--}}if(R===K.DOWN||R===K.CENTER){G++}setTimeout(function(){O.forEach(function(W,U){J.insertBefore(W,Q[G]);var V=U===0?true:false;W.select(V);i.reorderFreeRunning=false;delete i.reorderFreeOnAddCB});i._treeListView.getManager().pushUpdateView()},100);i._modal.getFooter().querySelector(".btn-primary").classList.remove("disabled")})});y.addEventListener("click",function p(F){if(i._reorderMode==="automatic"){m(true)}});A.addEventListener("click",function p(F){if(i._reorderMode==="automatic"){m(false)}});D.addEventListener("change",function p(F){if(i._reorderMode==="automatic"){m()}});i.toggleManual.addEventListener("click",function p(F){i._activateManualReorder()});i.toggleAutomatic.addEventListener("click",function p(F){i._activateAutomaticReorder()});var v=document.createEvent("Event");v.initEvent("click",true,false);v.dsModel=null;i.toggleManual.elements.container.dispatchEvent(v);var m=function(H){var N=i._treeListView.getDocument().getRoots();var I=i._initialList.slice();var L=i._automaticButtons[0];var K=L.selectedIndex;var F;if(K===0){F="label"}else{if(K===1){F="responsible"}else{if(K===2){F="createdDate"}else{if(K===3){F="lastModifiedDate"}}}}i._logger.log("Reorder by "+F);for(var G in I){I[G]._tempindex=G}if(H===undefined){H=i._automaticButtons[1].checkFlag}var M=H?-1:1;var J=-M;I.sort(function(P,O){var S=0;if(F==="createdDate"||F==="lastModifiedDate"){var R=new Date(P.options.grid[F]);var Q=new Date(O.options.grid[F]);S=R-Q;if(!H){S=-S}}else{if(F==="label"){if(P.options[F]<O.options[F]){S=M}else{if(P.options[F]>O.options[F]){S=J}}}else{if(P.options.grid[F]<O.options.grid[F]){S=M}else{if(P.options.grid[F]>O.options.grid[F]){S=J}}}}if(S===0){S=P._tempindex-O._tempindex}return S});for(var G in I){delete I[G]._tempindex}i._treeListView.getDocument().prepareUpdate();i._treeListView.getDocument().removeRoots();I.forEach(function(O){i._treeListView.getDocument().addRoot(O)});i._treeListView.getDocument().pushUpdate();i._modal.getFooter().querySelector(".btn-primary").classList.remove("disabled")}})},_createTreeListView:function(g,h){var i=this;require(["i18n!DS/PSDCommands/assets/nls/PSDDlgReorderProduct.json","DS/Tree/TreeListView","DS/Tree/TreeDocument"],function(n,m,k){var l={apiVersion:2,defaultCellHeight:20,resize:{columns:true,rows:true},selection:{nodes:true,cells:false,rowHeaders:false,columnHeaders:false,unselectAllOnEmptyArea:true,toggle:false,canMultiSelect:true},enableScrollOnDrag:true,columns:[{text:n.TreeListViewHeaderName,dataIndex:"tree",width:"50%",isSortable:false},{text:n.TreeListViewHeaderResponsible,dataIndex:"responsible",width:"20%",isSortable:false},{text:n.TreeListViewHeaderCreationDate,dataIndex:"createdDate",width:"30%",typeRepresentation:"datetime",isSortable:false,isEditable:false},{text:n.TreeListViewHeaderModifiedDate,dataIndex:"lastModifiedDate",width:"30%",typeRepresentation:"datetime",isSortable:false,isEditable:false},]};l.onDragStartCell=function(p,r){if(this.reorderFreeRunning===true){return}var o=[];var q=[];r.manager.getDocument().getXSO().get().forEach(function(s){o.push(s.dump());q.push(s._getID())});this.serializeDragAndDropEvent(p,{data:{"dswebux/x-tree.treenodemodel+json":o,"dswebux/x-tree.treenodemodel+number":r.nodeModel._getID(),"dspsd/x-tree.dlgreorderproduct+number":q}});p.dataTransfer.effectAllowed="move";if(sessionStorage.PSDDlgReorderDnDIsHeader){delete sessionStorage.PSDDlgReorderDnDIsHeader}sessionStorage.PSDDlgReorderDnDIsCell="true";return true};l.onDragStartColumnHeader=function(o,p){sessionStorage.PSDDlgReorderDnDIsHeader=true;if(sessionStorage.PSDDlgReorderDnDIsCell){delete sessionStorage.PSDDlgReorderDnDIsCell}return true};l.onDragEnterCell=function(p,o){if(sessionStorage.PSDDlgReorderDnDIsCell!==undefined&&sessionStorage.PSDDlgReorderDnDIsCell==="true"){return true}else{p.dataTransfer.dropEffect="none";return false}};l.onDragOverCell=l.onDragEnterCell;l.onDragEnterBlank=l.onDragEnterCell;l.onDragOverBlank=l.onDragEnterCell;l.onDragEnterColumnHeader=function(p,o){if(sessionStorage.PSDDlgReorderDnDIsHeader!==undefined&&sessionStorage.PSDDlgReorderDnDIsHeader==="true"){return true}else{p.dataTransfer.dropEffect="none";return false}};l.onDragOverColumnHeader=l.onDragEnterColumnHeader;l.onDropCell=function(v,A){if(sessionStorage.PSDDlgReorderDnDIsCell===undefined||(sessionStorage.PSDDlgReorderDnDIsHeader!==undefined&&sessionStorage.PSDDlgReorderDnDIsHeader==="true")){return false}var o=i._treeListView.getDocument().getSelectedNodes();var q=this.unserializeDragAndDropEvent(v);if(q){var u=A.nodeModel._getID();var w=q.data["dswebux/x-tree.treenodemodel+number"];var B=q.data["dswebux/x-tree.treenodemodel+json"];var x=q.data["dspsd/x-tree.dlgreorderproduct+number"];var r=false;x.forEach(function(C,D){if(C===u){r=true}});if(u===w||r){return false}if(A.dropPosition==="middle"){A.dropPosition="bottom"}}i._treeListView.options.onDropCellDefault.call(i._treeListView._datagrid,v,A);if(A.manager.getDocument().options.shouldAcceptDrop(A)){var p=A.nodeModel;var t=p.getParent().getChildren().indexOf(p);i._logger.log("insert before or after node "+p.dump().label+", index of node: "+t+". Drop position : "+A.dropPosition);i._logger.log("reminder: top = insertBefore ||| bottom = addChild ");if(A.dropPosition==="top"){var y=t-1;for(var s=o.length-1;s>=0;s--){var z=y-s;i._logger.log("idxToSelect after recalculation: "+z);i._treeListView.getManager().getRoots()[z].select()}}else{var y=t+1;for(var s=0;s<o.length;s++){var z=y+s;i._logger.log("idxToSelect after recalculation: "+z);i._treeListView.getManager().getRoots()[z].select()}}i._modal.getFooter().querySelector(".btn-primary").classList.remove("disabled")}delete sessionStorage.PSDDlgReorderDnDIsCell;return false};l.onDropBlank=function(v,u){if(sessionStorage.PSDDlgReorderDnDIsCell===undefined||(sessionStorage.PSDDlgReorderDnDIsHeader!==undefined&&sessionStorage.PSDDlgReorderDnDIsHeader==="true")){return false}var p=Math.min(i._treeListView.getDocument().getRoots().length,13);var t=p*i._treeListView.elements.container.querySelectorAll(".wux-datagrid-cell.wux-layouts-treeview-cell.wux-datagrid-cell-even")[0].getSize().height;if(v.offsetY<t){return false}var s=i._treeListView.getDocument().getSelectedNodes();var q=u.manager._rowsList.length-1;i._logger.log("idxToSelect for onDropBlank: "+q);i._treeListView.options.onDropBlankDefault.call(i._treeListView._datagrid,v,u);for(var r=0;r<s.length;r++){var o=q-r;i._logger.log("idxToSelect after recalculation: "+o);i._treeListView.getManager().getRoots()[o].select()}i._modal.getFooter().querySelector(".btn-primary").classList.remove("disabled");delete sessionStorage.PSDDlgReorderDnDIsCell;return false};l.onDropColumnHeader=function(o,p){if(sessionStorage.PSDDlgReorderDnDIsHeader===undefined||(sessionStorage.PSDDlgReorderDnDIsCell!==undefined&&sessionStorage.PSDDlgReorderDnDIsCell==="true")){return false}delete sessionStorage.PSDDlgReorderDnDIsHeader;return true};i._treeListView=new m(l);var j=new k({shouldAcceptDrop:function(o,p){if(sessionStorage.PSDDlgReorderDnDIsCell===undefined||(sessionStorage.PSDDlgReorderDnDIsHeader!==undefined&&sessionStorage.PSDDlgReorderDnDIsHeader==="true")){return false}return o.dropPosition!=="middle"},shouldAcceptDrag:function(o,p){if(p.dataIndex!=="tree"){return false}return !(i.reorderFreeRunning===true)}});i._fillTreeNodeModel(j,h);i._treeListView.getManager().loadDocument(j);i._treeListView.onNodeClick(function(o){if(i._reorderMode!=="manual"){return}else{if(i.reorderFreeRunning===false){delete i.reorderFreeRunning}}});i._treeListView.inject(g)})},_fillTreeNodeModel:function(g,i){var h=this;require(["DS/Tree/TreeNodeModel"],function(j){g.prepareUpdate();i.forEach(function(k){var l=new j({label:k.label,grid:{responsible:k.responsible,createdDate:k.created,lastModifiedDate:k.modified,relationid:k.relationid,physicalid:k.physicalid}});g.addRoot(l)});g.pushUpdate();h._initialList=g.getRoots().slice()})},_activateManualReorder:function(){if(this._reorderMode==="manual"){return}this._automaticButtons.forEach(function(g){g.disabled=true});this._manualButtons.forEach(function(g){g.disabled=false});if(this._treeListView){this._treeListView.elements.container.querySelector(".wux-layouts-gridengine-poolcontainer-rel").setStyles({"pointer-events":"auto"})}this._reorderMode="manual"},_activateAutomaticReorder:function(){if(this._reorderMode==="automatic"||this.reorderFreeRunning){return}this._manualButtons.forEach(function(h){h.disabled=true});this._treeListView.elements.container.querySelector(".wux-layouts-gridengine-poolcontainer-rel").setStyles({"pointer-events":"none"});this._automaticButtons.forEach(function(h){h.disabled=false});this._reorderMode="automatic";var g=document.createEvent("Event");g.initEvent("click",true,false);g.dsModel=null;if(this._automaticButtons[1].checkFlag){this._automaticButtons[1].elements.container.dispatchEvent(g)}else{this._automaticButtons[2].elements.container.dispatchEvent(g)}}});return e});define("DS/PSDCommands/commands/PSDCmdAvailability",["UWA/Class","DS/PADUtils/PADContext"],function(b,c){var a=b.extend({init:function(d){this._parent(d);if(c.get()){this._check_select();c.get().getPADTreeDocument().getXSO().onChange(this._check_select.bind(this))}},_check_select:function(){var d=undefined;if(this.options.availability&&this.options.availability==="monoSelection"){d=c.get().getPADTreeDocument().getXSO().get().length===1}else{d=c.get().getPADTreeDocument().getXSO().get().length?true:false}if(d===true){this.enable()}else{this.disable()}}});return a});define("DS/PSDCommands/commands/PSDCmdReplaceByExisting",["UWA/Class","DS/ApplicationFrame/Command","DS/PSDCommands/commands/PSDCmdAvailability"],function(b,a,d){var c=b.extend(a,d,{init:function(e){e.availability="monoSelection";this._parent(e,{mode:"exclusive",isAsynchronous:false})},execute:function(){var e=this;require(["DS/PADUtils/views/PADModalChooser","DS/PADUtils/PADContext","i18n!DS/PSDCommands/assets/nls/PSDCatalog.json"],function(f,h,g){var j=h.get().getSelectedNodes();e.selectedNodes=j;if(j.length){if(j.length>1){h.get().displayNotification({msg:g.SEL_001,eventID:"warning"});return}var i=0;j.forEach(function(k){if(k._parentNode._nodeDepth===-1){i++}});if(i>0){h.get().displayNotification({msg:g.SEL_002,eventID:"warning"})}else{new f({position:"above_action_bar",in_apps_search:{precond:"(type:CATProduct OR type:CATPart)",in_apps_callback:e._onSelectionDone.bind(e),multiSel:false}})}}})},_onSelectionDone:function(f){var e=this;require(["i18n!DS/PSDCommands/assets/nls/PSDCatalog.json","DS/PADUtils/PADWSAccess","DS/PADUtils/PADContext"],function(h,n,l){var k=["CATProduct","CATPart","CATDrawing","CATAnalysis","CATProcess","CATIA Embedded Component","CATIA CGR","CATShape","CATIA V4 Model","CATIA Design Table"];var j=f[0]["ds6w:type"];if(k.indexOf(j)===-1){l.get().displayNotification({msg:h.replace(h.get("unsupported_type"),{name:f[0]["ds6w:label"],type:j}),eventID:"warning"});return}var g=l.get();var m=g.getSelectedNodes();if(!m.length){l.get().displayNotification({msg:h.ERR_004+h.replace(h.get("replace_unaccessible_objet"),{name:e.selectedNodes[0].options.label}),eventID:"error"});return}var i={type:"byExisting",transactionMode:"all-or-nothing",commit:true,parent:m[0].getRelationID(),old:m[0].getID(),"new":f[0].resourceid};n.replace({data:i,onComplete:function(r){var q=UWA.is(r,"string")?JSON.parse(r):r;if(q.status==="success"){g.author(true);var s={};var u=m[0].getParent().getID();s[u]=[{resourceid:f[0].resourceid,relationid:q.newNode.attributes[0].value}];g.insertNodes(s);var t=[];var o=[];m.forEach(function(w){var v=w.getRelationID();t.push({physicalid:v});o.push(v)});g.refreshView({deleted:t});var p={};p.detach={deleted:o};g._commandProxy.padRefresh(p);l.get().displayNotification({msg:h.SUC_004,eventID:"primary"})}else{l.get().displayNotification({msg:h.ERR_004+q.message,eventID:"error"})}},onFailure:function(o){l.get().displayNotification({msg:h.ERR_004,eventID:"warning"})}})})}});return c});define("DS/PSDCommands/commands/PSDCmdReorderProduct",["UWA/Class","DS/ApplicationFrame/Command","DS/PSDCommands/commands/PSDCmdAvailability"],function(b,a,d){var c=b.extend(a,d,{init:function(e){e.availability="monoSelection";this._parent(e,{mode:"exclusive",isAsynchronous:false})},execute:function(){var e=this;require(["i18n!DS/PSDCommands/assets/nls/PSDCatalog.json","DS/PADUtils/PADContext"],function(h,m){var n=m.get().getSelectedNodes();if(n.length===1){var k=n[0];if(k.options.type==="CATProduct"||k.options.type==="CATIA Embedded Component"){var g=k.getChildren();if(g&&g.length>1){g=g.slice();var l=[];for(var f=0;f<g.length;f++){var j=g[f].options.type;if(j!=="CATProduct"&&j!=="CATIA Embedded Component"&&j!=="CATPart"){g.splice(f,1);l.push(f);f--}}if(g.length>1){e._launchReorderUI(k,g,l)}else{m.get().displayNotification({msg:h.SEL_003,eventID:"warning"})}}else{m.get().displayNotification({msg:h.SEL_003,eventID:"warning"})}}else{m.get().displayNotification({msg:h.SEL_004,eventID:"warning"})}}else{if(n.length>1){m.get().displayNotification({msg:h.SEL_005,eventID:"warning"})}}})},_launchReorderUI:function(f,e,h){var g=this;require(["i18n!DS/PSDCommands/assets/nls/PSDCatalog.json","DS/PSDCommands/views/PSDDlgReorderProduct","DS/PADUtils/PADWSAccess","DS/PADUtils/PADContext"],function(i,l,k,j){g.reorderDlg=new l({parent:f,children:e,css_style:"maximized",events:{onApply:function(m){}},onReorderDone:function(n){var p=[];var q=n.length;for(var o=0;o<q;o++){var s=n[o];p.push({index:o,child:s.options.grid.relationid})}var r={parent:f.getID(),type:"RTInstance",count:q,children:p,commit:true};var m=function(x,u){if(!x.hasChildren()){return}var y=x.getState();x.prepareUpdate();var w=x.removeChildren();for(var v=0;v<h.length;v++){x.addChild(w.splice(h[v],1))}for(var v=0;v<w.length;v++){var t=w.find(function(z){return(z.options.relationid===u[v].options.grid.relationid)?true:false});x.addChild(t)}x.setState({state:y});x.pushUpdate()};k.reorder({data:r,onComplete:function(v){var t=UWA.is(v,"string")?JSON.parse(v):v;if(t.status==="success"){var w=j.get();w.author(true);if(!Array.prototype.find){Array.prototype.find=function(x){var C=Object(this);var A=C.length>>>0;var y=arguments[1];var B;for(var z=0;z<A;z++){B=C[z];if(x.call(y,B,z,C)){return B}}return undefined}}var u=j.get().getPADTreeDocument().getRoots();u.forEach(function(x){var y=x.getNodesById(f.getID());y.forEach(function(z){m(z,n)})});w.displayNotification({msg:i.SUC_005,eventID:"primary"})}else{j.get().displayNotification({msg:i.ERR_005+t.message,eventID:"error"})}},onFailure:function(t){j.get().displayNotification({msg:i.ERR_005+t,eventID:"warning"})}})}})})}});return c});define("DS/PSDCommands/commands/PSDCmdDeleteProduct",["UWA/Class","DS/ApplicationFrame/Command","DS/PSDCommands/commands/PSDCmdAvailability"],function(b,a,d){var c=b.extend(a,d,{init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:false})},execute:function(){var e=this;require(["i18n!DS/PSDCommands/assets/nls/PSDCatalog.json","DS/PADUtils/PADWSAccess","DS/PADUtils/PADContext"],function(f,l,i){var k=i.get().getSelectedNodes();if(k.length){var j=0;var h=[];k.forEach(function(m){if(m._parentNode._nodeDepth===-1){j++}else{h.push(m.getRelationID())}});if(j>0){i.get().displayNotification({msg:f.SEL_006,eventID:"warning"})}else{var g={instances:h,commit:true};l.detach({data:g,onComplete:function(m){e._onUpdate(m,k)},onFailure:function(m){}})}}})},_onUpdate:function(f,g){var e=this;require(["i18n!DS/PSDCommands/assets/nls/PSDCatalog.json","DS/PADUtils/PADContext"],function(m,n){var l=n.get();var j=UWA.is(f,"string")?JSON.parse(f):f;if(j.status==="success"){l.author(true);var k=[];var h=[];g.forEach(function(p){var o=p.getRelationID();k.push({physicalid:o});h.push(o)});l.refreshView({deleted:k});var i={};i.detach={deleted:h};l._commandProxy.padRefresh(i);n.get().displayNotification({msg:m.SUC_001,eventID:"primary"})}else{n.get().displayNotification({msg:m.ERR_001+j.message,eventID:"error"})}})}});return c});define("DS/PSDCommands/commands/PSDCmdReplaceByLatestPublishedRevision",["UWA/Class","DS/ApplicationFrame/Command","DS/PSDCommands/commands/PSDCmdAvailability"],function(b,a,d){var c=b.extend(a,d,{init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:false})},_insertIfNeeded:function(f,m){var e=f.length;if(e===0){f.push(m)}else{var j=false;var n=m.getID();var h=m.getParent();for(var g=0;g<f.length;g++){var k=f[g];if((k.getID()===n)&&(k.getParent()===h)){j=true;break}}if(j===false){f.push(m)}}},execute:function(){var e=this;require(["DS/PADUtils/PADWSAccess","DS/PADUtils/PADContext","i18n!DS/PSDCommands/assets/nls/PSDCatalog.json","i18n!DS/PSDCommands/assets/nls/ENOPAD_ERROR.json"],function(o,j,m,h){var n=j.get().getSelectedNodes();if(n.length){var i=0;n.forEach(function(q){if(q._parentNode._nodeDepth===-1){i++}});if(i>0){j.get().displayNotification({msg:m.SEL_002,eventID:"warning"})}else{var l=[];var p=[];var k=[];var f=[];n.forEach(function(q){e._insertIfNeeded(f,q)});f.forEach(function(s){var t=s.getID();var r=s.getParent();var q=r.getChildren();if((null!==q)&&(q.length)){q.forEach(function(u){if(u.getID()===t){l.push(u.getRelationID());p.push(r.getID());k.push(u.getID())}})}});var g={type:"byLatestPublished",transactionMode:"all-or-nothing",commit:true,parentRelIds:l,oldIds:k,parentIds:p};o.replace({data:g,onComplete:function(w){var s=j.get();var t=UWA.is(w,"string")?JSON.parse(w):w;if(t.status==="success"){s.author(true);var q=[];var y=[];var x=JSON.parse(t.results);x.forEach(function(A){var B={};B[A.parentID]=[{resourceid:A.newReference,relationid:A.newInstance}];s.insertNodes(B);var z=A.parent;q.push({physicalid:z});y.push(z)});s.refreshView({deleted:q});var v={};v.detach={deleted:y};s._commandProxy.padRefresh(v);j.get().displayNotification({msg:m.SUC_004,eventID:"primary"})}else{var u=t.message;if(t.error!==undefined){if(t.error.errorCode!==undefined){var r=t.error.errorCode;if(h[r]!==undefined){u=h[r]}}}j.get().displayNotification({msg:m.ERR_004+u,eventID:"error"})}},onFailure:function(q){j.get().displayNotification({msg:m.ERR_004,eventID:"warning"})}})}}})}});return c});