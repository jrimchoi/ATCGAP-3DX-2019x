define("DS/DMUPlayMarker/DMUMarker2DCircleNode3D",["UWA/Core","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/FixedSizeNode3D","DS/Manipulators/PointHandle","DS/Manipulators/ScreenPlaneManipulator","DS/Visualization/SceneGraphFactory","DS/WebappsUtils/WebappsUtils","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUNode2D","DS/Selection/CSOManager","DS/DMUMeasurable/DMUToolsSceneGraph"],function(e,c,k,n,m,g,i,b,h,d,f,a,l){var j=f.extend({init:function(p){this._parent(p);this.setName(p.getAttribute("sName"));this.setNoZ(true);var u=this,w=false,r={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}};var y,v;var x=new c({type:"Spherical"});this.addChild(x);x.setPickParent(true);var s=new n({ratio:1});x.addChild(s);s.setPickParent(true);function B(){w=p._checkUnderCertainCommand()}function o(D){if(w){return}p.manipulate=false;var C={pathElement:l.buildPathElement(u)};if(D&&D.event.from[0].event.ctrlKey){a.remove(C)}else{a.empty()}a.add(C)}var q=new m({viewer:p._viewer,sceneGraph:x});q.subscribe("BeginManipulate",B);q.subscribe("Manipulate",function(C){if(w){return}p.manipulate=true;p.setAttribute("vCenter",C.event.from[0].currentPosition.clone())});q.subscribe("EndManipulate",o);var A=new g();A.setExclusive(true);var t=A.linkToNode(s);var z=0;A.subscribe("BeginManipulate",function(C){B(C);if(w){return}z=0});A.subscribe("Manipulate",function(C){if(w){return}z++;p.manipulate=true;var D=C.event.from[0].currentPosition.clone();p.setAttribute("fRadius",D.sub(p.getAttribute("vCenter")).length())});A.subscribe("EndManipulate",function(D){if(w){return}if(z<3){p.manipulate=false;var C={pathElement:l.buildPathElement(u)};if(!D.event.from[0].event.ctrlKey){setTimeout(function(){a.empty();a.add(C)})}else{if(a.isIn(C)){a.remove(C)}else{a.add(C)}}}else{o(D)}});this.removeDMUNode3DOverload=function(){u=A=t=y=v=x=s=q=null};this.update=function(E){if(!u){return}if(JSON.stringify(E)!==JSON.stringify(r)||(r.isPositionProportional&&(r.screenWidth!==p._viewer.SCREEN_WIDTH||r.screenHeight!==p._viewer.SCREEN_HEIGHT))){var J=r.graphicProperties&&r.graphicProperties.fillStyle?JSON.stringify(r.graphicProperties.fillStyle):"";var I=r.graphicProperties&&r.graphicProperties.lineStyle?JSON.stringify(r.graphicProperties.lineStyle):"";r=u.mergeParams(r,E);r.screenWidth=p._viewer.SCREEN_WIDTH;r.screenHeight=p._viewer.SCREEN_HEIGHT;if(r.isPositionProportional){var F=u.convertCoordsInPixels({coords:new k.Vector2(r.radius,r.radius)});r.radiusPx=F.x}else{r.radiusPx=r.radius}A.deactivate(t);s.removeChildren();var C=Math.round((2*Math.PI)/Math.acos(1-(1/(r.radiusPx))));if(isNaN(C)||C<0){C=20}var H;if(r.isFilled){if(!y||JSON.stringify(r.graphicProperties.fillStyle)!==J){y=h.createBasicMaterial({color:r.graphicProperties.fillStyle.color,opacity:r.graphicProperties.fillStyle.opacity})}H=i.createCircleNode({radius:r.radiusPx,fill:true,segments:C,startAngle:0,endAngle:2*Math.PI,material:y});H.setShadow(false);H.setPickParent(true);s.addChild(H)}if(r.hasBorder){if(!v||JSON.stringify(r.graphicProperties.lineStyle)!==I){v=h.createLineMaterial({color:r.graphicProperties.lineStyle.color,opacity:1,lineWidth:r.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:r.graphicProperties.lineStyle.pattern})}var G=[];for(var D=0;D<=C;D++){G.push(new k.Vector3(r.radiusPx*Math.cos(Math.PI*D/(C/2)),r.radiusPx*Math.sin(Math.PI*D/(C/2)),0))}H=i.createLineNode({points:G,material:v});H.setShadow(false);H.setPickParent(true);s.addChild(H)}A.activate(t);u.setVisibility(r.isVisible);u.setPointHandleVisibility(q,r.inEdition,r.inEdition,p._viewer.getVisibleSpace());q.setMatrix(new k.Matrix4().makeTranslation(0,0,0.1))}u.setMatrix(new k.Matrix4().setPosition(u.get3DPositionFromScreenCoordinates({coords:r.center,anchor:r.windowAnchor,proportionalPosition:r.isPositionProportional})));u.highlightIfNeeded();p._viewer.render()};this.onViewerEventCB=function(C){if(C.eventType==="@onViewpointChange"||C.eventType==="@onWindowResized"){u.update(r)}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}});return j});define("DS/DMUPlayMarker/DMUMarker2DPointNode3D",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/DMUBaseUI/DMUNode2D"],function(b,c,a){return a.extend({init:function(e){this._parent(e);this.setName(e.getAttribute("sName"));var f=this;var d=new c();this.addChild(d);this.removeDMUNode3DOverload=function(){f=d=null};this.update=function(g){if(!f){return}if(g.position){d.setMatrix(new b.Matrix4().setPosition(f.get3DPositionFromScreenCoordinates({coords:g.position,anchor:g.windowAnchor,proportionalPosition:g.isPositionProportional})));e._viewer.render()}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}})});define("DS/DMUPlayMarker/DMUMarkerImport",["UWA/Class"],function(a){return a.extend({init:function(b){this.importData=function(d,c){if(d&&c&&b){c.fillObjectAttributes(b,d);c.registerForPostImport(b)}};this.afterImport=function(){if(b){b.buildNode()}}}})});define("DS/DMUPlayMarker/DMUMarker3DPointNode3D",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/DMUBaseUI/DMUNode3D"],function(b,c,a){return a.extend({init:function(e){this._parent(e);this.setName(e.getAttribute("sName"));var f=this;var d=new c();this.addChild(d);this.removeDMUNode3DOverload=function(){f=d=null};this.update=function(g){if(!f){return}if(g.position){d.setMatrix(new b.Matrix4().setPosition(g.position));e._viewer.render()}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}})});define("DS/DMUPlayMarker/DMUMarker2DPolylineNode3D",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/DMUBaseUI/DMUNode2D","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/SceneGraphFactory","DS/Selection/CSOManager","DS/Manipulators/ScreenPlaneManipulator","DS/DMUMeasurable/DMUToolsSceneGraph","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/ArrowNode","DS/Mesh/MeshUtils","DS/DMUMeasurable/DMUMathsVector3D",],function(j,f,d,h,i,c,g,l,b,m,k,e,a){return d.extend({init:function(o){this._parent(o);this.setName(o.getAttribute("sName"));this.setNoZ(true);var t=this,v=false;var r={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},u;var z;var p=new b({type:"Spherical"});this.addChild(p);p.setPickParent(true);var q=new m({ratio:1});p.addChild(q);q.setPickParent(true);var x=new g();x.setExclusive(true);var s=x.linkToNode(q);this.removeDMUNode3DOverload=function(){t=q=s=x=u=null};function y(){v=o._checkUnderCertainCommand()}function n(C){if(v){return}o.manipulate=false;var B={pathElement:l.buildPathElement(t)};if(C&&C.event.from[0].event.ctrlKey){c.remove(B)}else{c.empty()}c.add(B)}var w=0;x.subscribe("BeginManipulate",function(B){y(B);if(v){return}w=0});x.subscribe("Manipulate",function(){if(v){return}w++});x.subscribe("EndManipulate",function(C){if(v){return}if(w<3){o.manipulate=false;var B={pathElement:l.buildPathElement(t)};if(!C.event.from[0].event.ctrlKey){setTimeout(function(){c.empty();c.add(B)})}else{if(c.isIn(B)){c.remove(B)}else{c.add(B)}}}else{n(C)}});function A(I,P){if(I.length>1){var R=new f("LineChild");R.setPickParent(true);q.addChild(R);var E=I[I.length-1];var H=I[0];function J(Z){var Y=[Z.Beginx-Z.Endx,Z.Beginy-Z.Endy,0];var V=a.length(Y);var W=a.multiply(Y,(1/V));var X=a.multiply(W,Z.HeadSize);var U=a.sub(X,Y);if(Z.inverse){U=a.sub(Y,X)}var aa=new j.Vector3(U[0],U[1],U[2]);return aa}var Q=h.getDashPattern(r.graphicProperties.lineStyle.pattern,null,true);var C=2;var G={arrowWidth:r.graphicProperties.lineStyle.thickness,viewpoint:o._viewer.currentViewpoint,arrowDashType:Q,arrowScale:C,color:r.graphicProperties.lineStyle.color,head:1,};if(P[0].getAttribute("iPointType")===1){var S=new f("BeginNode");S.setPickable(e.NOPICKABLE);R.addChild(S);var T=P[0].getAttribute("iSize");var M={Beginx:H.x,Endx:E.x,Beginy:H.y,Endy:E.y,HeadSize:T*3,inverse:1};var O=J(M);G.headLength=M.HeadSize;G.initialPoint=O.clone();G.finalPoint=H.clone();var F=new k(G);F.name="begin";S.addChild(F);I[0]=(new j.Vector3(O.x,O.y,O.z))}if(P[P.length-1].getAttribute("iPointType")===1){var B=new f("EndNode");B.setPickable(e.NOPICKABLE);R.addChild(B);var L=P[P.length-1].getAttribute("iSize");var K={Beginx:E.x,Endx:H.x,Beginy:E.y,Endy:H.y,HeadSize:L*3,inverse:0};var N=J(K);G.headLength=K.HeadSize;G.initialPoint=N.clone();G.finalPoint=E.clone();var D=new k(G);D.name="end";B.addChild(D);I[P.length-1]=(new j.Vector3(N.x,N.y,N.z))}}}this.update=function(N){var P;if(!t){return}if(JSON.stringify(N)!==JSON.stringify(r)||(r.isPositionProportional&&(r.screenWidth!==o._viewer.SCREEN_WIDTH||r.screenHeight!==o._viewer.SCREEN_HEIGHT))){var I=r.graphicProperties&&r.graphicProperties.lineStyle?JSON.stringify(r.graphicProperties.lineStyle):"";r=t.mergeParams(r,N);r.screenWidth=o._viewer.SCREEN_WIDTH;r.screenHeight=o._viewer.SCREEN_HEIGHT;var O=o.getPoints(true),G=[],J;for(P=0;P<O.length;P++){J=O[P].getAttribute("vPosition");if(J){G.push(J)}}if(!u||JSON.stringify(r.graphicProperties.lineStyle)!==I){u=h.createLineMaterial({color:r.graphicProperties.lineStyle.color,opacity:1,lineWidth:r.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:r.graphicProperties.lineStyle.pattern})}x.deactivate(s);q.removeChildren();var H=[],D,M;var F=0,C=0,E=0,B=0;for(P=0;P<O.length;P++){q.addChild(O[P]._nNode)}if(G.length>1){z=G[0].clone();for(P=0;P<G.length;P++){D=G[P];if(r.isPositionProportional){D=t.convertCoordsInPixels({coords:D,anchor:r.windowAnchor})}if(P>0){D=new j.Vector2(D.x-M.x,D.y-M.y)}else{M=new j.Vector2(D.x,D.y);D=new j.Vector2(0,0)}H.push(new j.Vector3(D.x,-D.y,0));F=Math.min(F,D.x);C=Math.max(C,D.x);E=Math.min(E,D.y);B=Math.max(B,D.y)}A(H,O);for(P=0;P<H.length;P++){H[P].x-=(C-F)/2;H[P].y+=(B-E)/2}var L=i.createLineNode({points:H,material:u});L.setShadow(false);L.setPickParent(true);var K=new j.Matrix4().makeTranslation((C-F)/2,-(B-E)/2,0);if(r.rotationAngle){K.multiply(new j.Matrix4().makeRotationAxis(new j.Vector3(0,0,1),r.rotationAngle))}L.setMatrix(K);q.addChild(L)}x.activate(s);t.setVisibility(r.isVisible)}if(z){t.setMatrix(new j.Matrix4().setPosition(t.get3DPositionFromScreenCoordinates({coords:z,anchor:r.windowAnchor,proportionalPosition:r.isPositionProportional})))}t.highlightIfNeeded();o._viewer.render()};this.onViewerEventCB=function(B){if(B.eventType==="@onViewpointChange"||B.eventType==="@onWindowResized"){t.update(r)}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}})});define("DS/DMUPlayMarker/DMUMarkerMkvShape",["UWA/Core","DS/DMUMarkerVisu/DMUMkvShapeAdapter","DS/DMUBaseExperience/EXPToolsVisualization"],function(d,b,a){var c=b.extend({buildGrid:function(){var n=this.getMarkUpGrid();if(n){var u=1,z=1,m=null;var o=this.getObject();var y,k,p;if(o){var i=o.GetType();if("DMUMarker3DText"===i||"DMUMarker2DText"===i||"DMUMarker3DHyperlink"===i||"DMUMarker2DHyperlink"===i){m=o.getAttribute("sImageSrc");if(m){z++}n.setNbofRows(u);n.setNbofColumns(z);if(m){p=n.getMarkUpCell(0,0);if(p){p.setCellImage(m);var x=o.getAttribute("fImageWidth"),v=o.getAttribute("fImageHeight");if(x&&v){var w=o.getAttribute("vLeaderBreakPoint3D");if(w){x=a.convertModelToPixels({sizeInMM:x,viewer:o._viewer})*window.devicePixelRatio;v=a.convertModelToPixels({sizeInMM:v,viewer:o._viewer})*window.devicePixelRatio}else{if(o.getAttribute("bProportionalPosition")){var q=o._viewer.SCREEN_HEIGHT/2;x=x*q;v=v*q}}}else{x=40;v=40}p.setCellWd(x);p.setCellHt(v)}}k=n.getMarkUpCell(u-1,z-1);if(k){y=k.getCellText();if(y){y.setTextContent(o.getAttribute("sTextContents"));y.setFontSize(o.getPixelFontSize());y.setFontName(o.getAttribute("sFontName"));y.setFontStyle(o.getAttribute("sFontStyle"))}}}else{if("DMUMarker3DPicture"===o.GetType()||"DMUMarker2DPicture"===o.GetType()){m=o.getAttribute("sImageSrc");var B=o.getTextToDisplay();if(B&&B.length&&B[0]&&B[0].length){u++}var j=0;n.setNbofRows(u);n.setNbofColumns(z);if(m){p=n.getMarkUpCell(0,0);if(p){p.setCellImage(m);j=o.getAttribute("fImageWidth");var v=o.getAttribute("fImageHeight");if(j&&v){var w=o.getAttribute("vLeaderBreakPoint3D");if(w){j=a.convertModelToPixels({sizeInMM:j,viewer:o._viewer})*window.devicePixelRatio;v=a.convertModelToPixels({sizeInMM:v,viewer:o._viewer})*window.devicePixelRatio}else{if(o.getAttribute("bProportionalPosition")){var q=o._viewer.SCREEN_HEIGHT/2;j=j*q;v=v*q}}}else{j=m.naturalWidth;v=m.naturalHeight}p.setCellWd(j);p.setCellHt(v)}}if(u===2){k=n.getMarkUpCell(u-1,z-1);if(k){y=k.getCellText();if(y){var g=o.getPixelFontSize();var h=o.getAttribute("sFontStyle");var t=o.getAttribute("sFontName");var f=d.createElement("canvas").getContext("2d");var A=h?h+" ":"";A+=g+"px "+o.getAttribute("sFontName");f.font=A;var C=[],e="";for(var r=0;r<B.length;r++){e=B[r];if(e&&f.measureText(" "+e+" ").width>j){var l=e.length-4,s=e;while(l>=2&&f.measureText(" "+s+" ").width>j){s=e.substring(0,l)+"...";l--}e=s}C.push(e)}o.setTextToDisplay(C);y.setTextToDisplay(C);y.setFontSize(g);y.setFontName(t);y.setFontStyle(h)}}}}}}n.updateGrid()}}});return c});define("DS/DMUPlayMarker/DMUMarker2DRectangleNode3D",["UWA/Core","DS/DMUBaseExperience/EXPToolsMaterial","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/ThreeJS_DS","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUNode2D","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/PointHandle","DS/Selection/CSOManager","DS/Manipulators/ScreenPlaneManipulator","DS/DMUMeasurable/DMUToolsSceneGraph"],function(c,h,n,j,d,f,e,i,b,m,a,g,l){var k=f.extend({init:function(p){this._parent(p);this.name=p.getAttribute("sName");this.setNoZ(true);var v=this,x=false,s;var u=new b({type:"Spherical"});u.setPickParent(true);this.addChild(u);var r=new n({ratio:1});u.addChild(r);r.setPickParent(true);var w,y;function B(){x=p._checkUnderCertainCommand()}function o(D){if(x){return}p.manipulate=false;var C={pathElement:l.buildPathElement(v)};if(D&&D.event.from[0].event.ctrlKey){a.remove(C)}else{a.empty()}a.add(C)}var A=new g();A.setExclusive(true);var t=A.linkToNode(r);var z=0;A.subscribe("BeginManipulate",function(C){B(C);if(x){return}z=0});A.subscribe("Manipulate",function(){if(x){return}z++});A.subscribe("EndManipulate",function(D){if(x){return}if(z<3){p.manipulate=false;var C={pathElement:l.buildPathElement(v)};if(!D.event.from[0].event.ctrlKey){setTimeout(function(){a.empty();a.add(C)})}else{if(a.isIn(C)){a.remove(C)}else{a.add(C)}}}else{o(D)}});var q=new m({viewer:p._viewer,sceneGraph:u});q.subscribe("BeginManipulate",B);q.subscribe("Manipulate",function(C){if(!x){p.manipulate=true;p.setAttribute("vPosition",C.event.from[0].currentPosition.clone())}});q.subscribe("EndManipulate",o);this.update=function(D){if(!v){return}if(!s||JSON.stringify(D)!==JSON.stringify(s)||(s.isPositionProportional&&(s.screenWidth!==p._viewer.SCREEN_WIDTH||s.screenHeight!==p._viewer.SCREEN_HEIGHT))){var H=s&&s.graphicProperties&&s.graphicProperties.fillStyle?JSON.stringify(s.graphicProperties.fillStyle):"";var G=s&&s.graphicProperties&&s.graphicProperties.lineStyle?JSON.stringify(s.graphicProperties.lineStyle):"";s=s?v.mergeParams(s,D):D;s.screenWidth=p._viewer.SCREEN_WIDTH;s.screenHeight=p._viewer.SCREEN_HEIGHT;if(s.isPositionProportional){var E=v.convertCoordsInPixels({coords:new j.Vector2(s.width,s.height)});s.widthPx=E.x;s.heightPx=E.y}else{s.widthPx=s.width;s.heightPx=s.height}A.deactivate(t);r.removeChildren();if(!y||JSON.stringify(s.graphicProperties.fillStyle)!==H){y=h.createBasicMaterial({color:s.graphicProperties.fillStyle.color,opacity:s.graphicProperties.fillStyle.opacity})}if(!w||JSON.stringify(s.graphicProperties.lineStyle)!==G){w=h.createLineMaterial({color:s.graphicProperties.lineStyle.color,opacity:1,lineWidth:s.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:s.graphicProperties.lineStyle.pattern})}var C=new j.Matrix4();if(s.rotationAngle){C.makeRotationAxis(new j.Vector3(0,0,1),s.rotationAngle)}C.multiply(new j.Matrix4().makeTranslation(-s.widthPx/2,-s.heightPx/2,0));var F;if(s.isFilled){F=i.createRectangleNode({width:s.widthPx,height:s.heightPx,fill:true,material:y});F.setShadow(false);F.setPickParent(true);F.setMatrix(C);r.addChild(F)}if(s.hasBorder){F=i.createRectangleNode({width:s.widthPx,height:s.heightPx,fill:false,material:w});F.setShadow(false);F.setPickParent(true);F.setMatrix(C);r.addChild(F)}A.activate(t);v.setVisibility(s.isVisible);v.setPointHandleVisibility(q,s.inEdition,s.inEdition,p._viewer.getVisibleSpace())}v.setMatrix(new j.Matrix4().setPosition(v.get3DPositionFromScreenCoordinates({coords:s.position,anchor:s.windowAnchor,proportionalPosition:s.isPositionProportional})));v.highlightIfNeeded();p._viewer.render()};this.removeDMUNode3DOverload=function(){u=v=t=r=q=null};this.onViewerEventCB=function(C){if(C.eventType==="@onViewpointChange"||C.eventType==="@onWindowResized"){v.update(s)}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}});return k});define("DS/DMUPlayMarker/DMUMarkerTools",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/DMUBaseExperience/DMUContextManager","DS/Visualization/ThreeJS_DS"],function(e,c,b,a){var d={getArrowSpecs:function(f,u,p,t,g){var o=(1-p)*u;var j=f/2,k=0;var m=t!==null&&t!==undefined?t:0.5;var h=[],n=[];if(g==="beginSide"){h[k++]=0;h[k++]=0;h[k++]=0;h[k++]=o;h[k++]=-j-f*m;h[k++]=0;h[k++]=o;h[k++]=-j;h[k++]=0;h[k++]=u;h[k++]=-j;h[k++]=0;h[k++]=u;h[k++]=j;h[k++]=0;h[k++]=o;h[k++]=j;h[k++]=0;h[k++]=o;h[k++]=j+f*m;h[k++]=0}else{if(g==="bothSide"){h[k++]=0;h[k++]=0;h[k++]=0;h[k++]=o;h[k++]=-j-f*m;h[k++]=0;h[k++]=o;h[k++]=-j;h[k++]=0;h[k++]=u-o;h[k++]=-j;h[k++]=0;h[k++]=u-o;h[k++]=-j-f*m;h[k++]=0;h[k++]=u;h[k++]=0;h[k++]=0;h[k++]=u-o;h[k++]=j+f*m;h[k++]=0;h[k++]=u-o;h[k++]=j;h[k++]=0;h[k++]=o;h[k++]=j;h[k++]=0;h[k++]=o;h[k++]=j+f*m;h[k++]=0}}var l=[];k=0;l[k++]=0;l[k++]=0;l[k++]=1;var q=[];k=0;if(g==="beginSide"){q[k++]=1;q[k++]=1;q[k++]=1;q[k++]=1;q[k++]=1;q[k++]=1;q[k++]=1;n.push(0);n.push(1);n.push(2);n.push(0);n.push(2);n.push(3);n.push(0);n.push(3);n.push(4);n.push(0);n.push(4);n.push(5);n.push(0);n.push(5);n.push(6)}else{if(g==="bothSide"){q[k++]=1;q[k++]=1;q[k++]=1;q[k++]=1;q[k++]=1;q[k++]=1;q[k++]=1;q[k++]=1;q[k++]=1;q[k++]=1;n.push(0);n.push(1);n.push(2);n.push(0);n.push(2);n.push(3);n.push(3);n.push(4);n.push(5);n.push(3);n.push(6);n.push(5);n.push(3);n.push(7);n.push(8);n.push(0);n.push(8);n.push(3);n.push(0);n.push(8);n.push(9)}}var r=[];k=0;for(var s=0;s<h.length/3;s++){r.push(new a.Vector3(h[3*s],h[3*s+1],h[3*s+2]))}r.push(new a.Vector3(h[0],h[1],h[2]));return{bufferPosition:h,bufferNormal:l,bufferUV:q,bufferIndex:n,coordinates:r}},getBentArrowSpecs:function(j,l,w,q,o,x,f,y){var r=[],n=[],v=0,k,g,s;var p=j/2;if(y==="beginSide"){r[v++]=0;r[v++]=0;r[v++]=0;r[v++]=p;r[v++]=-(1-x)*q;r[v++]=0;r[v++]=p-f*o;r[v++]=-(1-x)*q;r[v++]=0;r[v++]=p-f*o;r[v++]=-q;r[v++]=0;r[v++]=-o+p;r[v++]=-q;r[v++]=0;r[v++]=-o+p;r[v++]=-q+l;r[v++]=0;r[v++]=-p+f*o;r[v++]=-q+l;r[v++]=0;r[v++]=-p+f*o;r[v++]=-(1-x)*q;r[v++]=0;r[v++]=-p;r[v++]=-(1-x)*q;r[v++]=0}else{if(y==="bothSide"){k=(1-x-f)*q;g=(1-x-f)*o;r[v++]=0;r[v++]=0;r[v++]=0;r[v++]=p;r[v++]=-k;r[v++]=0;r[v++]=p-f*o;r[v++]=-k;r[v++]=0;r[v++]=p-f*o;r[v++]=-q+f*q;r[v++]=0;r[v++]=-o+p+g;r[v++]=-q+f*q;r[v++]=0;r[v++]=-o+p+g;r[v++]=-q;r[v++]=0;r[v++]=-o+p;r[v++]=-q+l/2;r[v++]=0;r[v++]=-o+p+g;r[v++]=-q+l;r[v++]=0;r[v++]=-o+p+g;r[v++]=-q+l-f*q;r[v++]=0;r[v++]=-p+f*o;r[v++]=-q+l-f*q;r[v++]=0;r[v++]=-p+f*o;r[v++]=-k;r[v++]=0;r[v++]=-p;r[v++]=-k;r[v++]=0}}var m={x:-p+o/2,y:q/2};for(s=0;s<r.length/3;s++){r[3*s]+=m.x;r[3*s+1]+=m.y}var t=[];v=0;t[v++]=0;t[v++]=0;t[v++]=1;var u=[];v=0;if(y==="beginSide"){u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;n.push(0);n.push(1);n.push(8);n.push(2);n.push(6);n.push(7);n.push(2);n.push(3);n.push(6);n.push(3);n.push(5);n.push(6);n.push(3);n.push(4);n.push(5)}else{if(y==="bothSide"){u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;u[v++]=1;n.push(0);n.push(1);n.push(2);n.push(0);n.push(2);n.push(3);n.push(3);n.push(4);n.push(8);n.push(4);n.push(5);n.push(6);n.push(4);n.push(6);n.push(7);n.push(3);n.push(8);n.push(9);n.push(0);n.push(3);n.push(9);n.push(0);n.push(9);n.push(10);n.push(0);n.push(10);n.push(11)}}var h=[];v=0;for(s=0;s<r.length/3;s++){h.push(new a.Vector3(r[3*s],r[3*s+1],r[3*s+2]))}h.push(new a.Vector3(r[0],r[1],r[2]));return{bufferPosition:r,bufferNormal:t,bufferUV:u,bufferIndex:n,coordinates:h}},getEllipseSpecs:function(v,t){var w=new a.Vector3();var n=Math.round((2*Math.PI)/Math.acos(1-(1/(v))));var m=Math.round((2*Math.PI)/Math.acos(1-(1/(t))));if(isNaN(n)||n<0){n=20}if(isNaN(m)||m<0){m=20}var o=n>m?n:m;var s=[],f=[],l=[];var r=0;f[r++]=w.x;f[r++]=w.y;f[r++]=w.z;var p=[];p[0]=1;for(var u=0;u<=o;u++){var q=new a.Vector3(v*Math.cos(Math.PI*u/(o/2)),-t*Math.sin(Math.PI*u/(o/2)),0);s.push(q);p[r]=1;f[r++]=q.x;f[r++]=q.y;f[r++]=q.z}for(var g=0;g<f.length/3;g++){l.push(0);l.push(g);l.push(g+1)}l.push(0);l.push((f.length/3)-1);l.push(1);var j=[];var h=0;j[h++]=0;j[h++]=0;j[h++]=1;return{bufferPosition:f,bufferNormal:j,bufferUV:p,bufferIndex:l,coordinates:s}},solveHyperlink:function(i,h){if(i){if(i.urls&&i.urls.length){for(var g=0;g<i.urls.length;g++){if(i.urls[g].indexOf("http")!==-1){window.open(i.urls[g])}}}if(i.ids&&i.ids.length){var f=b.getContextViewer({viewer:h});if(f){f.getController().getAttributes({ids:i.ids,attributes:["ds6w:type","ds6w:label"],callbacks:{onComplete:function(k){var j=["DS/PADUtils/PADUtilsServices","DS/TransientWidget/TransientWidget"];require(j,function(m,l){m.getSecurityContext(function(n){var q=[],p;for(var o=0;o<i.ids.length;o++){if(k[i.ids[o]]["ds6w:type"]){p={protocol:"3DXContent",version:"0.1",source:"X3DCSMA_AP",data:{items:[{envId:m.getPlatformId(),serviceId:"3DSpace",objectId:i.ids[o],objectType:k[i.ids[o]]["ds6w:type"],contextId:n.securityContext}]}};q.push({id:"X3DPLAW_AP",title:k[i.ids[o]]["ds6w:label"],data:{x3dSharedId:widget.getValue("x3dSharedId"),x3dPlatformId:widget.getValue("x3dPlatformId"),X3DContentId:JSON.stringify(p)}})}}if(q.length===1){l.showWidget(q[0].id,q[0].title,q[0].data)}else{if(q.length>1){l.showWidget(q)}}})})},onFailure:function(){}}})}}}},getHyperlinkIcon:function(f){var g=e.createElement("img"),h="I_WebMarkerHyperlink_default_Old.png";if(f){if(f.urls&&f.urls.length){h="I_WebMarkerHyperlink_url_Old.png"}}g.src=c.getWebappsAssetUrl("DMUPlayMarker","icons/32/")+h;return g},createHyperlinkDiv:function(h){var g;if(h&&h.urls&&h.urls.length){g=e.createElement("div");var i;for(var f=0;f<h.urls.length;f++){if(h.urls[f].indexOf("http")!==-1){i=e.createElement("a",{styles:{margin:"2px",padding:0}}).inject(g);i.href=h.urls[f];e.createElement("br").inject(g)}else{i=e.createElement("p",{styles:{margin:"2px",padding:0,userSelect:"text"}}).inject(g)}i.innerHTML=h.urls[f]}}return g},is3DMarkerDisplayed:function(i,j,f){if(!f||!i||!j){return true}var h=j.getChildWithID(Array.isArray(f)?f[0]:f);if(!h.pathElement&&j.getLinksManager(false)){j.getLinksManager(false).completeData()}if(!h.pathElement){return false}var g=i.getSceneGraphOverrideSetManager();var k=g?g.getCurrentVisibility(h.pathElement):true;k=k===null||k===undefined?true:k;return k}};return d});define("DS/DMUPlayMarker/DMUMarker3DTextNode3D",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Manipulators/ScreenPlaneManipulator","DS/DMUBaseUI/DMUToolsLeader","DS/Manipulators/PointHandle","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUBaseUI/DMUNode3D","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMarkerVisu/DMUMkvShapeNode","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUPlayMarker/DMUMarkerMkvShape","DS/DMUPlayMarker/DMUMarkerTools"],function(e,h,m,i,l,p,f,g,b,n,a,d,k,o,c){var j=b.extend({init:function(u,y){this._parent(u);var F=this,C=false,G,t;var I=null;var H={horizontalAlignement:"topLeft"};if(y){var E=Object.keys(y);for(var D=0;D<E.length;D++){H[E[D]]=y[E[D]]}}var x=new a({window:u._frmWindow,data:{mkvShape:new o(u),graphicProperties:H},onStartContentEditionCB:function(){u.setTextEditionFlag(true)},onEndContentEditionCB:function(){u.setTextEditionFlag(false);u.refreshNode()},onContentModifiedCB:function(N){if(N.text!==u.getAttribute("sTextContents")){var P=N.text;var O=true;var M;for(M=0;M<P.length;M++){if(P[M]){O=false;break}}if(O){for(M=0;M<P.length;M++){P[M]=" "}}u.setAttribute("sTextContents",P)}}});this.addChild(x);x.setPickParent(true);this.setName(u.getAttribute("sName"));this.setNoZ(true);var v=new h();this.addChild(v);v.setPickParent(true);var z=u.getAttribute("lLeaderPointingPoints"),r;var L=this.setClippingControlPoints(z);function w(){C=u._checkUnderCertainCommand()}function B(N){if(C){return}var M={pathElement:n.buildPathElement(F)};if(N&&N.event.from[0].event.ctrlKey){d.remove(M)}else{d.empty()}d.add(M)}if(z.length){r=new p({viewer:u._viewer,sceneGraph:this});r.subscribe("BeginManipulate",w);r.subscribe("Manipulate",function(O){if(C){return}var P=O.intersection;var M=f.getPositionFromIntersection(u._viewer,P.position,u.getAttribute("lLeaderPointingPoints")[0],u._frmWindow);var N=P.position&&P.path.length;if(N){M=P.position}u.modifyLeaderPointingPoint(0,M)});r.subscribe("EndManipulate",function(M){if(C){return}B(M);F.removeClippingControlPoints(L);L=F.setClippingControlPoints(u.getAttribute("lLeaderPointingPoints"))})}var s=new i();s.setExclusive(true);var K=s.linkToNode(x);var J=0;s.subscribe("BeginPreactivate",function(M){if(F&&F.onBeginPreactivateCB){F.onBeginPreactivateCB(M)}});s.subscribe("EndPreactivate",function(M){if(F&&F.onEndPreactivateCB){F.onEndPreactivateCB(M)}});s.subscribe("BeginManipulate",function(){w();J=0;if(C){return}G=u.getAttribute("vLeaderBreakPoint3D")});s.subscribe("Manipulate",function(M){J++;if(C){return}u.setAttribute("vLeaderBreakPoint3D",G.clone().add(M.translationVector))});s.subscribe("EndManipulate",function(N){if(J<3){if(F.onClickCB){F.onClickCB(N)}else{if(!C){var M={pathElement:n.buildPathElement(F)};if(!N.event.from[0].event.ctrlKey){if(d.get().length===1&&d.isIn(M)){x.startEdition(F)}else{setTimeout(function(){d.empty();d.add(M)})}}else{if(d.isIn(M)){d.remove(M)}else{d.add(M)}}}}}else{B(N)}});function A(){if(!t.hasALeader){v.setVisibility(false);v.setVisibilityFree(true);return}v.setVisibility(true);v.setVisibilityFree(false);if((u._viewer.getVisibleSpace()===0&&t.isVisible===false)||(u._viewer.getVisibleSpace()===1&&t.isVisible===true)){var N=0;switch(u.getAttribute("sLeaderEndType")){case"Arrow":N=1;break;case"Bubble":N=2;break}var Z=x.getDimensions();if(Z.offsetWidth>0&&Z.offsetHeight>0){var X=t.position.clone();var V={offsetWidth:f.convertModelToPixels({sizeInMM:Z.offsetWidth,viewer:u._viewer,coords:t.zoomMode?X:null}),offsetHeight:f.convertModelToPixels({sizeInMM:Z.offsetHeight,viewer:u._viewer,coords:t.zoomMode?X:null})};V.offsetWidth/=window.devicePixelRatio;V.offsetHeight/=window.devicePixelRatio;if(t.anchorMode==="topleft"){if(t.zoomMode){var W=u._viewer.currentViewpoint.getUpDirection().clone();var P=new m.Vector3().crossVectors(u._viewer.currentViewpoint.getSightDirection(),W).setLength(Z.offsetWidth/2);W.setLength(-Z.offsetHeight/2);X.add(W);X.add(P)}else{var ab=f.getViewerPositionFromPoint(u._viewer,X);if(!isNaN(ab.left)&&!isNaN(ab.top)){var T=new m.Vector2(ab.left+V.offsetWidth/2,ab.top+V.offsetHeight/2);var O=f.getLineFromWindowPosition(u._viewer,T.x,T.y);var S=f.getViewpointInfo(u._viewer.currentViewpoint);var Y=g.computeLinePlaneDistance(O.position.toArray(),O.direction.toArray(),t.position.toArray(),S.sight.toArray());X=new m.Vector3(Y.aPosition[0],Y.aPosition[1],Y.aPosition[2])}}}var ac=u.getAttribute("lLeaderPointingPoints"),M;if(ac!==undefined&&ac.length){var R=v.getChildren();for(var U=0;U<ac.length;U++){M=R[U];if(!M){M=new h("DMUMarkerLeaderNode");M.setPickParent(true);v.addChild(M)}var Q={width:u.getAttribute("fLeaderAttachWidthRatio"),height:u.getAttribute("fLeaderAttachLengthRatio")};l.modifyLeaderNode(u._viewer,M,true,X,ac[U],Q,t.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,t.graphicProperties.leaderStyle.color,t.graphicProperties.leaderStyle.pattern,N,V,u._frmWindow)}R=v.getChildren();if(ac.length<R.length){for(var aa=R.length-1;aa>=ac.length;aa--){v.removeChild(R[aa])}}}}}}this.removeDMUNode3DOverload=function(){if(x){x.remove()}if(L){this.removeClippingControlPoints(L);L=null}x=r=G=v=F=K=s=null};this.getPixelFontSize=function(){var M;if(u.getAttribute("iFontSize")){M=f.convertPixelToModel({sizeInPixels:u.getAttribute("iFontSize")*(4/3),viewer:u._viewer})}if(!M){M=u.getAttribute("fFontSize")}return f.convertModelToPixels({sizeInMM:M,viewer:u._viewer})};function q(){if(t.content&&t.content.length){for(var M=0;M<t.content.length;M++){if(t.content[M].length){return true}}}return false}this.update=function(M){if(!F){return}t=t?F.mergeParams(t,M):M;if(I===null){I=c.is3DMarkerDisplayed(u._viewer,u.getParent(),t.pointedReferences)}s.deactivate(K);t.graphicProperties.fontStyle.height=F.getPixelFontSize();if(M.markerImage&&!q()){t.graphicProperties.padding=0}x.modify(t);s.activate(K);A();if(r){r.setMatrix(new m.Matrix4().setPosition(u.getAttribute("lLeaderPointingPoints")[0]));F.setPointHandleVisibility(r,t.hasALeader&&t.isVisible&&t.inEdition,t.inEdition,u._viewer.getVisibleSpace());if(!t.hasALeader){r.setVisibilityFree(true)}}F.setVisibility(t.isVisible&&I);F.highlightIfNeeded();u._viewer.render()};this.onViewerEventCB=function(M){if(M.eventType==="@onWindowResized"||M.eventType==="@onViewpointChange"||M.eventType==="onSwapVisibleSpace"){A();x.stopEdition(F,u._frmWindow);u._viewer.render()}else{if(M.eventType==="onHideShow"&&t.pointedReferences){x.stopEdition(F,u._frmWindow);I=c.is3DMarkerDisplayed(u._viewer,u.getParent(),t.pointedReferences);F.setVisibility(t.isVisible&&I);u._viewer.render()}}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}});return j});define("DS/DMUPlayMarker/DMUMarker",["DS/DMUBaseReview/DMUOverloadableObject","DS/DMUBaseExperience/EXPToolsVisualization","DS/ApplicationFrame/CommandsManager","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUBaseExperience/EXPUtils","DS/Visualization/ThreeJS_DS","DS/DMUMarkupsController/DMUMarkupsController","DS/DMUPlayMarker/DMUMarkerImport","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager"],function(f,g,b,a,i,l,h,d,c,k){var j=[{name:"cFillStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.color",isOverloadable:true,defaultValue:new l.Color("#ffffff")},{name:"cLineStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.color",isOverloadable:true,defaultValue:new l.Color("#000000")},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",isOverloadable:true,defaultValue:"1"},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",isOverloadable:true,defaultValue:1},{name:"bVisible",type:"bool",JSONname:"PropertiesMarkerBase.GraphicProperties.visible",defaultValue:true,isOverloadable:true},{name:"bIsFilled",type:"bool",JSONname:"PropertiesMarkerBase.filled",defaultValue:true,isOverloadable:true},{name:"bHasBorder",type:"bool",JSONname:"PropertiesMarkerBase.border",defaultValue:false,isOverloadable:true},{name:"fOpacity",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.opacity",defaultValue:1,isOverloadable:true},{name:"oGradient",type:"objectDefinition",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.gradient",isOverloadable:true}];var e=f.extend({init:function(p,o){this._parent(p,o);this._sExpType="DMUMarker";this._parameters=this._parameters.concat(j);var q=this;this.initContextualBar=function(r){if(k.getAuthoringFeatureTypes().indexOf("Marker")!==-1){require([r],function(u){var s=new u();q.getContextualCommandList=s.getContextualCommandList;q.getSharedContextualCommandList=s.getSharedContextualCommandList;q.getSharedHeaderTypes=s.getSharedHeaderTypes;s.register({frmWindow:q._frmWindow});var t=c.get().length===1?c.get()[0].pathElement.clone():null;if(t&&t.getLastElement(true).getDMUType&&t.getLastElement(true)===q._nNode){c.empty();c.add({pathElement:t})}})}};if(k.getAuthoringFeatureTypes().indexOf("Marker")!==-1){var m="DS/DMUMarker/DMUMarkerExport";require([m],function(s){var r=new s(q);q.exportData=r.exportData})}var n=new d(q);this.importData=n.importData;this.afterImport=n.afterImport},initComponent:function(n){this._parent(n);this._viewer=n.context._viewer;var m=h.getDMUMarkupsController({context:this._viewer});if(m){m.registerMarker(this)}},remove:function(){this._parent();var m=h.giveDMUMarkupsController({context:this._viewer});if(m){m.unregisterMarker(this)}h.unreferenceDMUMarkupsController({context:this._viewer})},onViewerEventCB:function(m){if(this._nNode&&this._nNode.onViewerEventCB){this._nNode.onViewerEventCB(m)}},_checkUnderCertainCommand:function(){return i.checkIfCommandIsRunning(this._viewer)||this.isReadOnly()}});return e});define("DS/DMUPlayMarker/DMUMarker2D",["DS/DMUPlayMarker/DMUMarker"],function(c){var b=[{name:"sWindowAnchor",type:"String",JSONname:"PropertiesMarker2D.windowAnchor",defaultValue:"topLeft"},{name:"bProportionalPosition",type:"bool",JSONname:"PropertiesMarker2D.proportionalPosition"},{name:"fRotationAngle",type:"float",JSONname:"PropertiesMarker2D.RotationAngle",isOverloadable:true}];var a=c.extend({init:function(e,d){this._parent(e,d);this._sExpType="DMUMarker2D";this._parameters=this._parameters.concat(b)}});return a});define("DS/DMUPlayMarker/DMUMarker2DCircle",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DCircleNode3D"],function(a,c,d){var b=[{name:"vCenter",type:"Vector2",JSONname:"Properties2DCircle.Center",isOverloadable:true,defaultValue:new c.Vector2()},{name:"fRadius",type:"float",JSONname:"Properties2DCircle.Radius",defaultValue:100,isOverloadable:true}];var e=a.extend({init:function(g,f){this._parent(g,f);this._sExpType="DMUMarker2DCircle";this._sType="Marker2DCircle";this._parameters=this._parameters.concat(b);this.defineMembersFromParameters();var h=this;this.buildNode=function(){if(!h._nNode){h._nNode=new d(h);h.addNodeInParentNode();h.setInEdition(false);h.refreshNode()}}},initComponent:function(f){this._parent(f);this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar")},refreshNode:function(){if(this._nNode){this._nNode.update({radius:this.getAttribute("fRadius"),center:this.getAttribute("vCenter"),windowAnchor:this.getAttribute("sWindowAnchor"),inEdition:this.isInEdition(),isVisible:this.getAttribute("bVisible"),isFilled:this.getAttribute("bIsFilled"),hasBorder:this.getAttribute("bHasBorder"),isPositionProportional:this.getAttribute("bProportionalPosition"),graphicProperties:{fillStyle:{color:this.getAttribute("cFillStyleColor"),opacity:this.getAttribute("fOpacity")},lineStyle:{pattern:this.getAttribute("sLineStylePattern"),thickness:this.getAttribute("fLineStyleThickness"),color:this.getAttribute("cLineStyleColor")}}})}},setAttribute:function(f,g){if(g===false&&f==="bHasBorder"&&!this.getAttribute("bIsFilled")){this.setAttribute("bIsFilled",true);this._parent(f,g)}else{if(g===false&&f==="bIsFilled"&&!this.getAttribute("bHasBorder")){this.setAttribute("bHasBorder",true);this._parent(f,g)}}if(f==="vCenter"){this._parent(f,g);this.refreshNode()}else{if(f==="fRadius"){if(g>0){this._parent(f,g);this.refreshNode()}}else{return this._parent(f,g)}}},getAttribute:function(f){if(f==="vCenter"){return this._parent("vCenter").clone()}else{return this._parent(f)}},GetType:function(){return"DMUMarker2DCircle"}});return e});define("DS/DMUPlayMarker/DMUMarker2DRectangle",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DRectangleNode3D"],function(a,d,c){var b=[{name:"fWidth",type:"float",JSONname:"Properties2DRectangle.width",isOverloadable:true,defaultValue:10},{name:"fHeight",type:"float",JSONname:"Properties2DRectangle.height",isOverloadable:true,defaultValue:10},{name:"vPosition",type:"Vector2",JSONname:"Properties2DRectangle.position",isOverloadable:true,defaultValue:new d.Vector2()},{name:"sAnchor",type:"string",JSONname:"Properties2DRectangle.anchor",isOverloadable:true,defaultValue:"center"}];var e=a.extend({init:function(g,f){this._parent(g,f);this._sExpType="DMUMarker2DRectangle";this._sType="Marker2DRectangle";this._parameters=this._parameters.concat(b);this.defineMembersFromParameters();var h=this;this.buildNode=function(){if(!h._nNode){h._nNode=new c(h);h.addNodeInParentNode();h.setInEdition(false);h.refreshNode()}}},initComponent:function(f){this._parent(f);this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar")},refreshNode:function(){if(this._nNode){this._nNode.update({position:this.getAttribute("vPosition"),width:this.getAttribute("fWidth"),height:this.getAttribute("fHeight"),anchor:this.getAttribute("sAnchor"),windowAnchor:this.getAttribute("sWindowAnchor"),inEdition:this.isInEdition(),isVisible:this.getAttribute("bVisible"),isFilled:this.getAttribute("bIsFilled"),hasBorder:this.getAttribute("bHasBorder"),isPositionProportional:this.getAttribute("bProportionalPosition"),rotationAngle:this.getAttribute("fRotationAngle"),graphicProperties:{fillStyle:{color:this.getAttribute("cFillStyleColor"),opacity:this.getAttribute("fOpacity")},lineStyle:{pattern:this.getAttribute("sLineStylePattern"),thickness:this.getAttribute("fLineStyleThickness"),color:this.getAttribute("cLineStyleColor")}}})}},setAttribute:function(f,g){if(g===false&&f==="bHasBorder"&&!this.getAttribute("bIsFilled")){this.setAttribute("bIsFilled",true);this._parent(f,g)}else{if(g===false&&f==="bIsFilled"&&!this.getAttribute("bHasBorder")){this.setAttribute("bHasBorder",true);this._parent(f,g)}else{if(f==="vPosition"||f==="fWidth"||f==="fHeight"){this._parent(f,g);this.refreshNode()}else{this._parent(f,g)}}}},getAttribute:function(f){if(f==="vPosition"){return this._parent(f).clone()}else{return this._parent(f)}},GetType:function(){return"DMUMarker2DRectangle"}});return e});define("DS/DMUPlayMarker/DMUMarker3D",["DS/DMUPlayMarker/DMUMarker"],function(b){var a=b.extend({init:function(d,c){this._parent(d,c);this._parameters=this._parameters.concat([{name:"lPointedReferences",type:"listStrings",JSONname:"Properties3DMarker.PointedReferences"}]);this._sExpType="DMUMarker3D"}});return a});define("DS/DMUPlayMarker/DMUMarker2DTextNode3D",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Manipulators/ScreenPlaneManipulator","DS/DMUBaseUI/DMUToolsLeader","DS/Manipulators/PointHandle","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUNode2D","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMarkerVisu/DMUMkvShapeNode","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/Selection/CSOManager","DS/DMUPlayMarker/DMUMarkerMkvShape"],function(d,g,j,h,i,n,e,f,l,a,c,b,m){var k=f.extend({init:function(s,w){this._parent(s);var D=this,z=false,r;var E={horizontalAlignement:"topLeft"};if(w){var B=Object.keys(w);for(var A=0;A<B.length;A++){E[B[A]]=w[B[A]]}}var v=new a({viewer:s._viewer,window:s._frmWindow,data:{mkvShape:new m(s),graphicProperties:E},onStartContentEditionCB:function(){s.setTextEditionFlag(true)},onEndContentEditionCB:function(){s.setTextEditionFlag(false);s.refreshNode()},onContentModifiedCB:function(I){if(I.text!==s.getAttribute("sTextContents")){var K=I.text;var J=true;var H;for(H=0;H<K.length;H++){if(K[H]){J=false;break}}if(J){for(H=0;H<K.length;H++){K[H]=" "}}s.setAttribute("sTextContents",K)}}});this.addChild(v);v.setPickParent(true);var t=new g();this.addChild(t);t.setPickParent(true);this.setName(s.getAttribute("sName"));function x(){if(!r.hasALeader){t.setVisibility(false);t.setVisibilityFree(true);return}t.setVisibility(true);t.setVisibilityFree(false);if((s._viewer.getVisibleSpace()===0&&r.isVisible===false)||(s._viewer.getVisibleSpace()===1&&r.isVisible===true)){var I=0;switch(r.leaderEndType){case"Arrow":I=1;break;case"Bubble":I=2;break}var T=v.getDimensions();if(T.offsetWidth>0&&T.offsetHeight>0){var R=r.position.clone();var Q={offsetWidth:e.convertModelToPixels({sizeInMM:T.offsetWidth,viewer:s._viewer}),offsetHeight:e.convertModelToPixels({sizeInMM:T.offsetHeight,viewer:s._viewer})};Q.offsetWidth/=window.devicePixelRatio;Q.offsetHeight/=window.devicePixelRatio;if(r.anchorMode==="topleft"){var V=e.getViewerPositionFromPoint(s._viewer,R);if(!isNaN(V.left)&&!isNaN(V.top)){var N=new j.Vector2(V.left+Q.offsetWidth/2,V.top+Q.offsetHeight/2);var J=e.getLineFromWindowPosition(s._viewer,N.x,N.y);var O=e.getViewpointInfo(s._viewer.currentViewpoint);var S=c.computeLinePlaneDistance(J.position.toArray(),J.direction.toArray(),r.position.toArray(),O.sight.toArray());R=new j.Vector3(S.aPosition[0],S.aPosition[1],S.aPosition[2])}}var W=r.pointingPoints,H,M;if(W!==undefined&&W.length){var L=t.getChildren();for(var P=0;P<W.length;P++){M=D.get3DPositionFromScreenCoordinates({coords:W[P],anchor:r.windowAnchor,proportionalPosition:r.isPositionProportional});H=L[P];if(!H){H=new g("DMUMarkerLeaderNode");H.setPickParent(true);t.addChild(H)}var K={width:s.getAttribute("fLeaderAttachWidthRatio"),height:s.getAttribute("fLeaderAttachLengthRatio")};i.modifyLeaderNode(s._viewer,H,true,R,M,K,r.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,r.graphicProperties.leaderStyle.color,r.graphicProperties.leaderStyle.pattern,I,Q,s._frmWindow)}L=t.getChildren();if(W.length<L.length){for(var U=L.length-1;U>=W.length;U--){t.removeChild(L[U])}}}}}}function u(){z=s._checkUnderCertainCommand()}function y(I){if(z){return}var H={pathElement:l.buildPathElement(D)};if(I&&I.event.from[0].event.ctrlKey){b.remove(H)}else{b.empty()}b.add(H)}var q=new h();q.setExclusive(true);var G=q.linkToNode(v);var C,F=0;q.subscribe("BeginPreactivate",function(H){if(D&&D.onBeginPreactivateCB){D.onBeginPreactivateCB(H)}});q.subscribe("EndPreactivate",function(H){if(D&&D.onEndPreactivateCB){D.onEndPreactivateCB(H)}});q.subscribe("BeginManipulate",function(){u();F=0;if(z){return}C=D.get3DPositionFromScreenCoordinates({coords:s.getAttribute("vLeaderBreakPoint2D"),anchor:s.getAttribute("sWindowAnchor"),proportionalPosition:s.getAttribute("bProportionalPosition")})});q.subscribe("Manipulate",function(H){F++;if(z){return}var I=e.getWindowPositionFromPoint(s._viewer,C.clone().add(H.translationVector),s._frmWindow);s.setAttribute("vLeaderBreakPoint2D",new j.Vector2(I.left,I.top))});q.subscribe("EndManipulate",function(I){if(F<3){if(D.onClickCB){D.onClickCB(I)}else{if(!z){var H={pathElement:l.buildPathElement(D)};if(!I.event.from[0].event.ctrlKey){if(b.get().length===1&&b.isIn(H)){v.startEdition(D)}else{setTimeout(function(){b.empty();b.add(H)})}}else{if(b.isIn(H)){b.remove(H)}else{b.add(H)}}}}}else{y(I)}});var p=new n({viewer:s._viewer,sceneGraph:this});p.subscribe("BeginManipulate",u);p.subscribe("Manipulate",function(J){if(z){return}var I=D.get3DPositionFromScreenCoordinates({coords:s.getAttribute("lLeaderPointingPoints")[0],anchor:s.getAttribute("sWindowAnchor"),proportionalPosition:s.getAttribute("bProportionalPosition")});var H=e.getPositionFromIntersection(s._viewer,J.intersection.position,I,s._frmWindow);if(J.intersection.position&&J.intersection.path.length){H=J.intersection.position}var K=e.getWindowPositionFromPoint(s._viewer,H,s._frmWindow);s.modifyLeaderPointingPoint(0,new j.Vector2(K.left,K.top))});p.subscribe("EndManipulate",y);this.removeDMUNode3DOverload=function(){if(v){v.remove()}v=p=D=t=G=q=null};this.getPixelFontSize=function(){var H;if(s.getAttribute("iFontSize")){H=e.convertPixelToModel({sizeInPixels:s.getAttribute("iFontSize")*(4/3),viewer:s._viewer})}if(!H){H=s.getAttribute("fFontSize")}return e.convertModelToPixels({sizeInMM:H,viewer:s._viewer})};function o(){if(r.content&&r.content.length){for(var H=0;H<r.content.length;H++){if(r.content[H].length){return true}}}return false}this.update=function(J){if(!D){return}r=r?D.mergeParams(r,J):J;q.deactivate(G);r.graphicProperties.fontStyle.height=D.getPixelFontSize();if(J.markerImage&&!o()){r.graphicProperties.padding=0}v.modify(r);var I=r.breakPoint2D.clone();var H=v.getDimensions();H.offsetWidth-=1;H.offsetHeight-=1;if(r.isPositionProportional){var K=D.convertPixelsInCoords({coords:new j.Vector2(H.offsetWidth,H.offsetHeight),anchor:r.windowAnchor});H.offsetWidth=K.x;H.offsetHeight=K.y}if(H.offsetWidth>0&&H.offsetHeight>0&&r.anchorMode==="topleft"){I.x+=H.offsetWidth/2;I.y+=H.offsetHeight/2}r.position=D.get3DPositionFromScreenCoordinates({coords:I,anchor:r.windowAnchor,proportionalPosition:r.isPositionProportional});v.setMatrix(new j.Matrix4().setPosition(r.position));q.activate(G);x();if(p){var L=D.get3DPositionFromScreenCoordinates({coords:r.pointingPoints[0],anchor:r.windowAnchor,proportionalPosition:r.isPositionProportional});p.setMatrix(new j.Matrix4().setPosition(L));D.setPointHandleVisibility(p,r.hasALeader&&r.isVisible&&r.inEdition,r.inEdition,s._viewer.getVisibleSpace());if(!r.hasALeader){p.setVisibilityFree(true)}}D.setVisibility(r.isVisible);D.highlightIfNeeded();s._viewer.render()};this.onViewerEventCB=function(H){if(H.eventType==="@onWindowResized"||H.eventType==="@onViewpointChange"||H.eventType==="onSwapVisibleSpace"){v.stopEdition(D);s.refreshNode()}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}});return k});define("DS/DMUPlayMarker/DMUMarker3DText",["DS/DMUPlayMarker/DMUMarker3D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3DTextNode3D"],function(c,d,e){var b=[{name:"sTextContents",type:"string",JSONname:"Properties3DText.TextContents",defaultValue:[""]},{name:"bHasALeader",type:"bool",JSONname:"Properties3DText.HasALeader",isOverloadable:true,defaultValue:true},{name:"sLeaderEndType",type:"string",JSONname:"Properties3DText.LeaderEndType",isOverloadable:true,defaultValue:"None"},{name:"vLeaderBreakPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderBreakPoint3D",isOverloadable:true,defaultValue:new d.Vector3(0,0,0)},{name:"lLeaderPointingPoints",type:"ListVector3",JSONname:"Properties3DText.LeaderPointingPoints",isOverloadable:true,defaultValue:[]},{name:"fTextBoxLength",type:"float",JSONname:"Properties3DText.TextBoxLength",isOverloadable:true},{name:"fTextBoxWidth",type:"float",JSONname:"Properties3DText.TextBoxWidth",isOverloadable:true},{name:"fLeaderAttachWidthRatio",type:"float",JSONname:"Properties3DText.LeaderAttachWidthRatio",isOverloadable:true},{name:"fLeaderAttachLengthRatio",type:"float",JSONname:"Properties3DText.LeaderAttachLengthRatio",isOverloadable:true},{name:"sFontName",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyName",isOverloadable:true,defaultValue:"sans-serif"},{name:"sFontStyle",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyStyle",isOverloadable:true,defaultValue:"normal"},{name:"fFontSize",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.fontSize",isOverloadable:true},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",isOverloadable:true,defaultValue:"1"},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",isOverloadable:true,defaultValue:1},{name:"cFontColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.color",isOverloadable:true,defaultValue:new d.Color("#000000")},{name:"sLeaderStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.pattern",isOverloadable:true,defaultValue:"1"},{name:"fLeaderStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thickness",isOverloadable:true,defaultValue:1},{name:"cLeaderStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.color",isOverloadable:true,defaultValue:new d.Color("#3d3d3d")},{name:"sAnchorMode",type:"string",JSONname:"Properties3DText.AnchorMode",defaultValue:"center"},{name:"fImageWidth",type:"float",JSONname:"Properties3DText.imgData.imgWidth",isOverloadable:true},{name:"fImageHeight",type:"float",JSONname:"Properties3DText.imgData.imgHeight",isOverloadable:true},{name:"sImageSrc",type:"ImageURL",JSONname:"Properties3DText.imgData.imgSrc"},{name:"bInvertH",type:"bool",JSONname:"Properties3DText.imgData.InvertH",isOverloadable:true},{name:"bInvertV",type:"bool",JSONname:"Properties3DText.imgData.InvertV",isOverloadable:true},{name:"fBorderRadius",type:"float",JSONname:"Properties3DText.BorderRadius",defaultValue:4},{name:"bZoomMode",type:"bool",JSONname:"Properties3DText.ZoomMode",defaultValue:false},{name:"oHyperlinks",type:"objectDefinition",JSONname:"Properties3DText.hyperlink"},{name:"fBoxRotationAngle",type:"float",JSONname:"Properties3DText.BoxRotationAngle",isOverloadable:true},{name:"iFontSize",type:"int",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.height",isOverloadable:true},{name:"MarkerImg",type:"ImageURL",JSONname:"Properties3DText.MarkerImg",defaultValue:""},{name:"vLeaderPointingPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderPointingPoint3D",isOverloadable:true}];var a=c.extend({init:function(h,g){this._parent(h,g);this._sExpType="DMUMarker3DText";this._sType="Marker3DText";this._parameters=this._parameters.concat(b);this.defineMembersFromParameters();var i=this;this.getPixelFontSize=function(){if(i._nNode){return i._nNode.getPixelFontSize()}return undefined};this.convertPixelToModelOnScreen=function(j){if(i._nNode){return i._nNode.convertPixelToModel({sizeinPixels:j})}return undefined};var f=false;this.setTextEditionFlag=function(j){f=j};this.isTextEdited=function(){return f};this.buildNode=function(){if(!i._nNode){i._nNode=new e(i);i.addNodeInParentNode();i.setInEdition(false);i.refreshNode()}}},initComponent:function(f){this._parent(f);if(this.GetType()==="DMUMarker3DText"){this.initContextualBar("DS/DMUMarker/DMUMarkerTextContextualBar")}},refreshNode:function(){if(this._nNode){this._nNode.update({pointedReferences:this.getAttribute("lPointedReferences"),isVisible:this.getAttribute("bVisible"),content:this.getAttribute("sTextContents"),position:this.getAttribute("vLeaderBreakPoint3D"),pointingPoints:this.getAttribute("lLeaderPointingPoints"),anchorMode:this.getAttribute("sAnchorMode"),hasALeader:this.getAttribute("bHasALeader"),markerImage:this.getAttribute("sImageSrc"),imageWidth:this.getAttribute("fImageWidth"),imageHeight:this.getAttribute("fImageHeight"),imageInvertH:this.getAttribute("bInvertH"),imageInvertV:this.getAttribute("bInvertV"),leaderEndType:this.getAttribute("sLeaderEndType"),isFilled:this.getAttribute("bIsFilled"),hasBorder:this.getAttribute("bHasBorder"),zoomMode:this.getAttribute("bZoomMode"),leaderAttachWidthRatio:this.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:this.getAttribute("fLeaderAttachLengthRatio"),hyperlinks:this.getAttribute("oHyperlinks"),boxRotationAngle:this.getAttribute("fBoxRotationAngle"),inEdition:this.isInEdition(),graphicProperties:{borderRadius:this.getAttribute("fBorderRadius"),fontStyle:{pxheight:this.getAttribute("iFontSize")*(4/3),fontSize:this.getAttribute("fFontSize"),familyName:this.getAttribute("sFontName"),familyStyle:this.getAttribute("sFontStyle"),color:this.getAttribute("cFontColor")},fillStyle:{color:this.getAttribute("cFillStyleColor"),opacity:this.getAttribute("fOpacity"),gradient:this.getAttribute("oGradient")},lineStyle:{thickness:this.getAttribute("fLineStyleThickness"),pattern:this.getAttribute("sLineStylePattern"),color:this.getAttribute("cLineStyleColor")},leaderStyle:{thickness:this.getAttribute("fLeaderStyleThickness"),pattern:this.getAttribute("sLeaderStylePattern"),color:this.getAttribute("cLeaderStyleColor")}}})}},setAttribute:function(f,g){if(f==="vLeaderBreakPoint3D"||f==="fBoxRotationAngle"||f==="fImageWidth"||f==="fImageHeight"){this._parent(f,g);this.refreshNode()}else{if(f==="sImageSrc"||f==="MarkerImg"){this._parent("MarkerImg",null);this._parent("sImageSrc",g);this.refreshNode()}else{if(f==="sTextContents"){this._parent(f,g);this.refreshNode()}else{if(f==="fFontSize"){this._parent("iFontSize",null);this._parent(f,g);this.refreshNode()}else{this._parent(f,g)}}}}},getAttribute:function(i){var j;if(i==="lLeaderPointingPoints"){var h=this._parent("lLeaderPointingPoints");var f=[];if(!h||!h.length){var g=this._parent("vLeaderPointingPoint3D");if(g){f.push(g.clone())}}else{for(j=0;j<h.length;j++){f.push(h[j].clone())}}return f}else{if(i==="sImageSrc"){var k=this._parent("sImageSrc");if(k===undefined||k===null){k=this._parent("MarkerImg")}if(!k||-1<k.src.search("undefined")||k.src===""){return""}return k}else{return this._parent(i)}}},modifyLeaderPointingPoint:function(f,h){var g=this.getAttribute("lLeaderPointingPoints");if(f<g.length){g[f]=h}this.setAttribute("lLeaderPointingPoints",g);this.refreshNode()},GetType:function(){return"DMUMarker3DText"}});return a});define("DS/DMUPlayMarker/DMUMarker2DText",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DTextNode3D"],function(b,e,a){var d=[{name:"sTextContents",type:"string",JSONname:"Properties2DText.TextContents",defaultValue:[""]},{name:"bHasALeader",type:"bool",JSONname:"Properties2DText.HasALeader",isOverloadable:true,defaultValue:false},{name:"sLeaderEndType",type:"string",JSONname:"Properties2DText.LeaderEndType",isOverloadable:true,defaultValue:"None"},{name:"vLeaderBreakPoint2D",type:"Vector2",JSONname:"Properties2DText.LeaderBreakPoint2D",isOverloadable:true,defaultValue:new e.Vector2(0,0)},{name:"lLeaderPointingPoints",type:"ListVector2",JSONname:"Properties2DText.LeaderPointingPoints",isOverloadable:true,defaultValue:[]},{name:"fTextBoxLength",type:"float",JSONname:"Properties2DText.TextBoxLength",isOverloadable:true},{name:"fTextBoxWidth",type:"float",JSONname:"Properties2DText.TextBoxWidth",isOverloadable:true},{name:"fLeaderAttachWidthRatio",type:"float",JSONname:"Properties2DText.LeaderAttachWidthRatio",isOverloadable:true},{name:"fLeaderAttachLengthRatio",type:"float",JSONname:"Properties2DText.LeaderAttachLengthRatio",isOverloadable:true},{name:"sAnchorMode",type:"string",JSONname:"Properties2DText.AnchorMode",defaultValue:"center"},{name:"sFontName",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyName",isOverloadable:true,defaultValue:"sans-serif"},{name:"sFontStyle",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyStyle",isOverloadable:true,defaultValue:"normal"},{name:"fFontSize",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.fontSize",isOverloadable:true},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",isOverloadable:true,defaultValue:"1"},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",isOverloadable:true,defaultValue:1},{name:"sLeaderStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.pattern",isOverloadable:true,defaultValue:"1"},{name:"fLeaderStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thickness",isOverloadable:true,defaultValue:1},{name:"cLeaderStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.color",isOverloadable:true,defaultValue:new e.Color(4013373)},{name:"cFontColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.color",isOverloadable:true,defaultValue:new e.Color(0)},{name:"fImageWidth",type:"float",JSONname:"Properties2DText.imgData.imgWidth",isOverloadable:true},{name:"fImageHeight",type:"float",JSONname:"Properties2DText.imgData.imgHeight",isOverloadable:true},{name:"sImageSrc",type:"ImageURL",JSONname:"Properties2DText.imgData.imgSrc"},{name:"bInvertH",type:"bool",JSONname:"Properties2DText.imgData.InvertH",isOverloadable:true},{name:"bInvertV",type:"bool",JSONname:"Properties2DText.imgData.InvertV",isOverloadable:true},{name:"fBorderRadius",type:"float",JSONname:"Properties2DText.BorderRadius",defaultValue:4},{name:"oHyperlinks",type:"objectDefinition",JSONname:"Properties2DText.hyperlink"},{name:"fBoxRotationAngle",type:"float",JSONname:"Properties2DText.BoxRotationAngle",isOverloadable:true},{name:"iFontSize",type:"int",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.height",isOverloadable:true},{name:"MarkerImg",type:"ImageURL",JSONname:"Properties2DText.MarkerImg"},{name:"vLeaderPointingPoint2D",type:"Vector2",JSONname:"Properties2DText.LeaderPointingPoint2D",isOverloadable:true}];var c=b.extend({init:function(h,g){this._parent(h,g);this._sExpType="DMUMarker2DText";this._sType="Marker2DText";this._parameters=this._parameters.concat(d);this.defineMembersFromParameters();var i=this;this.getPixelFontSize=function(){if(i._nNode){return i._nNode.getPixelFontSize()}return undefined};this.convertPixelToModelOnScreen=function(j){if(i._nNode){return i._nNode.convertPixelToModel({sizeinPixels:j})}return undefined};var f=false;this.setTextEditionFlag=function(j){f=j};this.isTextEdited=function(){return f};this.buildNode=function(){if(!i._nNode){i._nNode=new a(i);i.addNodeInParentNode();i.setInEdition(false);i.refreshNode()}}},initComponent:function(f){this._parent(f);if(this.GetType()==="DMUMarker2DText"){this.initContextualBar("DS/DMUMarker/DMUMarkerTextContextualBar")}},refreshNode:function(){if(this._nNode){this._nNode.update({isVisible:this.getAttribute("bVisible"),content:this.getAttribute("sTextContents"),breakPoint2D:this.getAttribute("vLeaderBreakPoint2D"),pointingPoints:this.getAttribute("lLeaderPointingPoints"),inEdition:this.isInEdition(),windowAnchor:this.getAttribute("sWindowAnchor"),hasALeader:this.getAttribute("bHasALeader"),leaderEndType:this.getAttribute("sLeaderEndType"),isFilled:this.getAttribute("bIsFilled"),hasBorder:this.getAttribute("bHasBorder"),anchorMode:this.getAttribute("sAnchorMode"),isPositionProportional:this.getAttribute("bProportionalPosition"),leaderAttachWidthRatio:this.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:this.getAttribute("fLeaderAttachLengthRatio"),hyperlinks:this.getAttribute("oHyperlinks"),markerImage:this.getAttribute("sImageSrc"),imageWidth:this.getAttribute("fImageWidth"),imageHeight:this.getAttribute("fImageHeight"),imageInvertH:this.getAttribute("bInvertH"),imageInvertV:this.getAttribute("bInvertV"),boxRotationAngle:this.getAttribute("fBoxRotationAngle"),graphicProperties:{borderRadius:this.getAttribute("fBorderRadius"),fontStyle:{pxheight:this.getAttribute("iFontSize")*(4/3),fontSize:this.getAttribute("fFontSize"),familyName:this.getAttribute("sFontName"),familyStyle:this.getAttribute("sFontStyle"),color:this.getAttribute("cFontColor")},fillStyle:{color:this.getAttribute("cFillStyleColor"),opacity:this.getAttribute("fOpacity"),gradient:this.getAttribute("oGradient")},lineStyle:{thickness:this.getAttribute("fLineStyleThickness"),pattern:this.getAttribute("sLineStylePattern"),color:this.getAttribute("cLineStyleColor")},leaderStyle:{thickness:this.getAttribute("fLeaderStyleThickness"),pattern:this.getAttribute("sLeaderStylePattern"),color:this.getAttribute("cLeaderStyleColor")}}})}},setAttribute:function(f,g){if(f==="vLeaderBreakPoint2D"||f==="sAnchorMode"||f==="fBoxRotationAngle"||f==="fImageWidth"||f==="fImageHeight"){this._parent(f,g);this.refreshNode()}else{if(f==="sImageSrc"||f==="MarkerImg"){this._parent("MarkerImg",null);this._parent("sImageSrc",g);this.refreshNode()}else{if(f==="sTextContents"){this._parent(f,g);this.refreshNode()}else{if(f==="fFontSize"){this._parent("iFontSize",null);this._parent(f,g);this.refreshNode()}else{this._parent(f,g)}}}}},getAttribute:function(h){var i;if(h==="lLeaderPointingPoints"){var g=this._parent("lLeaderPointingPoints");var f=[];if(!g||!g.length){var k=this._parent("vLeaderPointingPoint2D");if(k){f.push(k.clone())}}else{for(i=0;i<g.length;i++){f.push(g[i].clone())}}return f}else{if(h==="sImageSrc"){var j=this._parent("sImageSrc");if(j===undefined||j===null){j=this._parent("MarkerImg")}if(!j||-1<j.src.search("undefined")||j.src===""){return""}return j}else{if(h==="vLeaderBreakPoint2D"){return this._parent(h).clone()}else{return this._parent(h)}}}},modifyLeaderPointingPoint:function(f,h){var g=this.getAttribute("lLeaderPointingPoints");if(f<g.length){g[f]=h}this.setAttribute("lLeaderPointingPoints",g);this.refreshNode()},GetType:function(){return"DMUMarker2DText"}});return c});define("DS/DMUPlayMarker/DMUMarker2DPoint",["DS/DMUBaseReview/DMUOverloadableObject","DS/DMUPlayMarker/DMUMarker2DPointNode3D","DS/DMUPlayMarker/DMUMarkerImport"],function(d,a,c){var b=[{name:"iPointType",type:"int",JSONname:"PointType",isOverloadable:true},{name:"iSize",type:"float",JSONname:"Size",isOverloadable:true},{name:"vPosition",type:"Vector2",JSONname:"Point2D",isOverloadable:true},{name:"vRelativePosition",type:"Vector2",JSONname:"RelativePos",isOverloadable:true}];return d.extend({init:function(h,g){this._parent(h,g);this._sExpType="DMUMarker2DPoint";this._sType="Marker2DPoint";this._parameters=this._parameters.concat(b);this.defineMembersFromParameters();var i=this;this.buildNode=function(){i._nNode=new a(i);i.refreshNode()};var e="DS/DMUMarker/DMUMarkerExport",i=this;require([e],function(k){var j=new k(i);i.exportData=j.exportData});var f=new c(i);this.importData=f.importData;this.afterImport=f.afterImport},initComponent:function(){this.makeDirty()},refreshNode:function(){if(!this._nNode){return this.buildNode()}this._nNode.update({pointType:this.getAttribute("iPointType"),size:this.getAttribute("iSize"),position:this.getAttribute("vPosition"),relativePos:this.getAttribute("vRelativePosition"),windowAnchor:this.getAttribute("sWindowAnchor"),isPositionProportional:this.getAttribute("bProportionalPosition")})},GetType:function(){return"DMUMarker2DPoint"}})});define("DS/DMUPlayMarker/DMUMarker3DPoint",["DS/DMUBaseReview/DMUOverloadableObject","DS/DMUPlayMarker/DMUMarker3DPointNode3D","DS/DMUPlayMarker/DMUMarkerImport"],function(d,c,b){var a=[{name:"iPointType",type:"int",JSONname:"PointType",isOverloadable:true},{name:"iSize",type:"float",JSONname:"Size",isOverloadable:true},{name:"vPosition",type:"Vector3",JSONname:"Point3D",isOverloadable:true},{name:"vRelativePosition",type:"Vector3",JSONname:"RelativePos",isOverloadable:true}];return d.extend({init:function(h,g){this._parent(h,g);this._sExpType="DMUMarker3DPoint";this._sType="Marker3DPoint";this._parameters=this._parameters.concat(a);this.defineMembersFromParameters();var i=this;this.buildNode=function(){i._nNode=new c(i);i.refreshNode()};var e="DS/DMUMarker/DMUMarkerExport",i=this;require([e],function(k){var j=new k(i);i.exportData=j.exportData});var f=new b(i);this.importData=f.importData;this.afterImport=f.afterImport},initComponent:function(){this.makeDirty()},refreshNode:function(){if(!this._nNode){return this.buildNode()}this._nNode.update({pointType:this.getAttribute("iPointType"),size:this.getAttribute("iSize"),position:this.getAttribute("vPosition"),relativePos:this.getAttribute("vRelativePosition")})},GetType:function(){return"DMUMarker3DPoint"}})});define("DS/DMUPlayMarker/DMUMarker3DArrowNode3D",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/SceneGraphFactory","DS/WebappsUtils/WebappsUtils","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseUI/DMUNode3D","DS/Manipulators/PointHandle","DS/DMUBaseExperience/EXPToolsVisualization","DS/Manipulators/ScreenPlaneManipulator","DS/DMUBaseCommands/EXPToolsWUX","DS/Selection/CSOManager","DS/Mesh/MeshUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUPlayMarker/DMUMarkerTools"],function(j,k,o,h,n,g,m,b,q,i,l,a,f,d,p,e){var c=b.extend({init:function(x){this._parent(x);this.setName(x.getAttribute("sName"));this.setIcon(g.getWebappsAssetUrl("DMUBaseUI","icons/32/I_WebMarkerArrow.png"));this.setNoZ(true);var w={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}};var N=this,E=-1;var U=this.setClippingControlPoints([x.getAttribute("vFirstPoint"),x.getAttribute("vSecondPoint")]);var T,J;var G=false,C=true;var P,u,B;var O=null;var K=x.getAttribute("vFirstPoint"),R=x.getAttribute("vSecondPoint");var H=R.clone().sub(K);var I=new h({constraintAxis:H,type:"Cylindrical"});this.addChild(I);I.setPickParent(true);function D(){G=x._checkUnderCertainCommand()}function F(X){if(G){return}x.manipulate=false;var W={pathElement:p.buildPathElement(N)};if(X&&X.event.from[0].event.ctrlKey){f.remove(W)}else{f.empty()}f.add(W);N.removeClippingControlPoints(U);U=N.setClippingControlPoints([x.getAttribute("vFirstPoint"),x.getAttribute("vSecondPoint")])}P=new q({viewer:x._viewer,sceneGraph:I});P.subscribe("BeginManipulate",D);P.subscribe("Manipulate",function(W){if(G){return}x.manipulate=true;x.setAttribute("vFirstPoint",i.getPositionFromIntersection(x._viewer,W.intersection.position,x.getAttribute("vFirstPoint"),x._frmWindow))});P.subscribe("EndManipulate",F);u=new q({viewer:x._viewer,sceneGraph:I});u.subscribe("BeginManipulate",D);u.subscribe("Manipulate",function(W){if(G){return}x.manipulate=true;x.setAttribute("vSecondPoint",i.getPositionFromIntersection(x._viewer,W.intersection.position,x.getAttribute("vSecondPoint"),x._frmWindow))});u.subscribe("EndManipulate",F);B=new q({viewer:x._viewer,sceneGraph:I});var v,V,M;var L,t;B.subscribe("BeginManipulate",function(ae){D();if(G){return}v=ae.intersection.position;var af=x.getAttribute("vSecondPoint").clone().sub(x.getAttribute("vFirstPoint"));var aa=i.getViewpointInfo(x._viewer.currentViewpoint);var aj=aa.sight.clone().cross(af.clone());V=new o.Vector3().copy(v);V.add(aj);M=new o.Vector3().copy(v);M.add(af);var ad=x.getAttribute("fShaftRatio");var ag=x.getAttribute("vFirstPoint");var ab=x.getAttribute("vSecondPoint");var Z=x.getAttribute("fWidth");af=ab.clone().sub(ag);var ac=af.length();var ai=(1-ad)*ac;var X=new o.Vector3(af.x/ac,af.y/ac,af.z/ac).multiplyScalar(ai);L=X.add(ag);var ah=aj.length();var Y=new o.Vector3(aj.x/ah,aj.y/ah,aj.z/ah);var W=Y.multiplyScalar(Z/2);t=W.add(ab)});B.subscribe("Manipulate",function(Y){if(G){return}x.manipulate=true;var W=new o.Vector2().copy(Y.event.from[0].getCurrentPosition(Y.event.viewer.canvas));var ad=Y.event.viewer.currentViewpoint.create3DRayFrom2DPoint(W);var ab=ad.computeShortestPointToLine(v,V);var X=ad.computeShortestPointToLine(v,M);var aa=x.getAttribute("vSecondPoint").clone().sub(x.getAttribute("vFirstPoint"));var ae=new o.Vector3().subVectors(ab,L);x.setAttribute("fWidth",2*ae.length());var ac=new o.Vector3().subVectors(X,t);var Z=ac.length()/aa.length();if((x.getAttribute("sStyle")==="beginSide"&&Z<=0.9&&Z>=0.1)||(x.getAttribute("sStyle")==="bothSide"&&Z<=0.9&&Z>=0.55)){x.setAttribute("fShaftRatio",Z)}});B.subscribe("EndManipulate",F);var s=new k();I.addChild(s);s.setPickParent(true);s.setMatrix(new o.Matrix4(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1));var r=new l();r.setExclusive(true);var S=r.linkToNode(s);var z,A,y;var Q=0;r.subscribe("BeginManipulate",function(W){D();if(G){return}Q=0;C=false;z=x._viewer.currentViewpoint.project(W.intersection.position);A=x._viewer.currentViewpoint.project(x.getAttribute("vFirstPoint"));y=x._viewer.currentViewpoint.project(x.getAttribute("vSecondPoint"))});r.subscribe("Manipulate",function(Z){if(G){return}Q++;x.manipulate=true;var X=x._viewer.currentViewpoint.project(Z.intersection.position).sub(z);var Y=A.clone().add(X);x.setAttribute("vFirstPoint",i.getPositionFromIntersection(x._viewer,x._viewer.currentViewpoint.unProject(Y),x.getAttribute("vFirstPoint"),x._frmWindow));var W=y.clone().add(X);x.setAttribute("vSecondPoint",i.getPositionFromIntersection(x._viewer,x._viewer.currentViewpoint.unProject(W),x.getAttribute("vSecondPoint"),x._frmWindow))});r.subscribe("EndManipulate",function(X){if(G){return}C=true;if(Q<3){x.manipulate=false;var W={pathElement:p.buildPathElement(N)};if(!X.event.from[0].event.ctrlKey){setTimeout(function(){f.empty();f.add(W)})}else{if(f.isIn(W)){f.remove(W)}else{f.add(W)}}}else{F(X)}});this.removeDMUNode3DOverload=function(){if(U){N.removeClippingControlPoints(U);U=null}N=T=I=s=r=S=null};this.update=function(Y){if(!N){return}if(JSON.stringify(Y)!==JSON.stringify(w)){if(O===null){O=e.is3DMarkerDisplayed(x._viewer,x.getParent(),w.pointedReferences)}var ac=w.graphicProperties&&w.graphicProperties.fillStyle?JSON.stringify(w.graphicProperties.fillStyle):"";var ab=w.graphicProperties&&w.graphicProperties.lineStyle?JSON.stringify(w.graphicProperties.lineStyle):"";w=N.mergeParams(w,Y);r.deactivate(S);s.removeChildren();var X=w.secondPoint.clone().sub(w.firstPoint);var aa=e.getArrowSpecs(w.width,X.length(),w.shaftRatio,w.headRatio,w.style);if(w.isFilled){if(!T||JSON.stringify(w.graphicProperties.fillStyle)!==ac){if(T){T.dispose();T=null}T=m.createBasicMaterial({color:w.graphicProperties.fillStyle.color,opacity:w.graphicProperties.fillStyle.opacity})}aa.material=T;var Z=n.createSimpleMeshNode(aa);Z.setShadow(false);Z.setPickParent(true);s.addChild(Z)}if(w.hasBorder){if(!J||JSON.stringify(w.graphicProperties.lineStyle)!==ab){if(J){J.dispose();J=null}J=m.createLineMaterial({color:w.graphicProperties.lineStyle.color,opacity:1,lineWidth:w.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:w.graphicProperties.lineStyle.pattern})}var W=n.createLineNode({points:aa.coordinates,material:J});W.setShadow(false);W.setPickParent(true);s.addChild(W)}N.setVisibility(w.isVisible&&O);I.setConstraintAxis(X.clone());N.setMatrix(new o.Matrix4().setPosition(w.firstPoint));r.activate(S);N.setPointHandleVisibility(P,w.inEdition&&C,w.inEdition,x._viewer.getVisibleSpace());P.setMatrix(new o.Matrix4().makeTranslation(0,E,0));N.setPointHandleVisibility(u,w.inEdition&&C,w.inEdition,x._viewer.getVisibleSpace());u.setMatrix(new o.Matrix4().makeTranslation(0,E,X.length()));N.setPointHandleVisibility(B,w.inEdition&&C,w.inEdition,x._viewer.getVisibleSpace());B.setMatrix(new o.Matrix4().makeTranslation(w.width/2,E,X.length()*(1-w.shaftRatio)))}N.highlightIfNeeded();x._viewer.render()};this.onViewerEventCB=function(W){if(W.eventType==="onHideShow"&&w.pointedReferences){O=e.is3DMarkerDisplayed(x._viewer,x.getParent(),w.pointedReferences);N.setVisibility(w.isVisible&&O);x._viewer.render()}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}});return c});define("DS/DMUPlayMarker/DMUMarker3DArrow",["DS/DMUPlayMarker/DMUMarker3D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3DArrowNode3D"],function(c,d,a){var b=[{name:"vFirstPoint",type:"Vector3",JSONname:"Properties3DArrow.FirstPoint",isOverloadable:true,defaultValue:new d.Vector3()},{name:"vSecondPoint",type:"Vector3",JSONname:"Properties3DArrow.SecondPoint",isOverloadable:true,defaultValue:new d.Vector3(10,0,0)},{name:"fWidth",type:"float",JSONname:"Properties3DArrow.Width",defaultValue:1,isOverloadable:true},{name:"sStyle",type:"string",JSONname:"Properties3DArrow.Style",defaultValue:"beginSide",isOverloadable:true},{name:"fShaftRatio",type:"float",JSONname:"Properties3DArrow.ShaftRatio",defaultValue:0.8,isOverloadable:true},{name:"fHeadRatio",type:"float",JSONname:"Properties3DArrow.HeadRatio",defaultValue:0.5,isOverloadable:true}];var e=c.extend({init:function(g,f){this._parent(g,f);this._sExpType="DMUMarker3DArrow";this._sType="Marker3DArrow";this._parameters=this._parameters.concat(b);this.defineMembersFromParameters();var h=this;this.buildNode=function(){if(!h._nNode){h._nNode=new a(h);h.addNodeInParentNode();h.setInEdition(false);h.refreshNode()}}},initComponent:function(f){this._parent(f);this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar")},refreshNode:function(){if(this._nNode){this._nNode.update({pointedReferences:this.getAttribute("lPointedReferences"),firstPoint:this.getAttribute("vFirstPoint"),secondPoint:this.getAttribute("vSecondPoint"),width:this.getAttribute("fWidth"),style:this.getAttribute("sStyle"),shaftRatio:this.getAttribute("fShaftRatio"),headRatio:this.getAttribute("fHeadRatio"),inEdition:this.isInEdition(),isVisible:this.getAttribute("bVisible"),isFilled:this.getAttribute("bIsFilled"),hasBorder:this.getAttribute("bHasBorder"),graphicProperties:{fillStyle:{color:this.getAttribute("cFillStyleColor"),opacity:this.getAttribute("fOpacity")},lineStyle:{pattern:this.getAttribute("sLineStylePattern"),thickness:this.getAttribute("fLineStyleThickness"),color:this.getAttribute("cLineStyleColor")}}})}},setAttribute:function(f,g){if(g===false&&f==="bHasBorder"&&!this.getAttribute("bIsFilled")){this.setAttribute("bIsFilled",true);this._parent(f,g)}else{if(g===false&&f==="bIsFilled"&&!this.getAttribute("bHasBorder")){this.setAttribute("bHasBorder",true);this._parent(f,g)}else{if(f==="vFirstPoint"||f==="vSecondPoint"||f==="fWidth"||f==="fShaftRatio"||f==="sStyle"){this._parent(f,g);this.refreshNode()}else{this._parent(f,g)}}}},getAttribute:function(f){if(f==="vFirstPoint"||f==="vSecondPoint"){return this._parent(f).clone()}else{return this._parent(f)}},GetType:function(){return"DMUMarker3DArrow"}});return e});define("DS/DMUPlayMarker/DMUMarker2DEllipseNode3D",["UWA/Core","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/FixedSizeNode3D","DS/Manipulators/PointHandle","DS/Manipulators/ScreenPlaneManipulator","DS/Visualization/SceneGraphFactory","DS/WebappsUtils/WebappsUtils","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUNode2D","DS/Selection/CSOManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUPlayMarker/DMUMarkerTools"],function(g,e,l,o,n,i,k,d,j,f,h,c,m,b){var a=h.extend({init:function(q){this._parent(q);this.setName(q.getAttribute("sName"));this.setNoZ(true);var v=this,x=false,t={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}};var y,w;var C=new e({type:"Spherical"});this.addChild(C);C.setPickParent(true);var s=new o({ratio:1});C.addChild(s);s.setPickParent(true);function B(){x=q._checkUnderCertainCommand()}function p(E){if(x){return}q.manipulate=false;var D={pathElement:m.buildPathElement(v)};if(E&&E.event.from[0].event.ctrlKey){c.remove(D)}else{c.empty()}c.add(D)}var r=new n({viewer:q._viewer,sceneGraph:C});r.subscribe("BeginManipulate",B);r.subscribe("Manipulate",function(D){if(x){return}q.manipulate=true;q.setAttribute("vCenter",D.event.from[0].currentPosition.clone())});r.subscribe("EndManipulate",p);var A=new i();A.setExclusive(true);var u=A.linkToNode(s);var z=0;A.subscribe("BeginManipulate",function(D){B(D);if(x){return}z=0});A.subscribe("Manipulate",function(D){if(x){return}z++;q.manipulate=true;var E=D.event.from[0].currentPosition.clone()});A.subscribe("EndManipulate",function(E){if(x){return}if(z<3){q.manipulate=false;var D={pathElement:m.buildPathElement(v)};if(!E.event.from[0].event.ctrlKey){setTimeout(function(){c.empty();c.add(D)})}else{if(c.isIn(D)){c.remove(D)}else{c.add(D)}}}else{p(E)}});this.removeDMUNode3DOverload=function(){v=A=u=y=w=C=s=r=null};this.update=function(F){if(!v){return}if(JSON.stringify(F)!==JSON.stringify(t)||(t.isPositionProportional&&(t.screenWidth!==q._viewer.SCREEN_WIDTH||t.screenHeight!==q._viewer.SCREEN_HEIGHT))){var I=t.graphicProperties&&t.graphicProperties.fillStyle?JSON.stringify(t.graphicProperties.fillStyle):"";var H=t.graphicProperties&&t.graphicProperties.lineStyle?JSON.stringify(t.graphicProperties.lineStyle):"";t=v.mergeParams(t,F);t.screenWidth=q._viewer.SCREEN_WIDTH;t.screenHeight=q._viewer.SCREEN_HEIGHT;if(t.isPositionProportional){t.xAxisLengthPx=v.convertCoordsInPixels({coords:new l.Vector2(t.xAxisLength,t.xAxisLength)}).x;t.yAxisLengthPx=v.convertCoordsInPixels({coords:new l.Vector2(t.yAxisLength,t.yAxisLength)}).y;t.CenterPx=v.convertCoordsInPixels({coords:t.center})}else{t.xAxisLengthPx=t.xAxisLength;t.yAxisLengthPx=t.yAxisLength;t.CenterPx=t.center}A.deactivate(u);s.removeChildren();var E=new l.Matrix4();if(t.rotationAngle){E.makeRotationAxis(new l.Vector3(0,0,1),t.rotationAngle)}var D=b.getEllipseSpecs(t.xAxisLengthPx,t.yAxisLengthPx);var G;if(t.isFilled){if(!y||JSON.stringify(t.graphicProperties.fillStyle)!==I){y=j.createBasicMaterial({color:t.graphicProperties.fillStyle.color,opacity:t.graphicProperties.fillStyle.opacity})}D.material=y;G=k.createSimpleMeshNode(D);G.setShadow(false);G.setPickParent(true);G.setMatrix(E);s.addChild(G)}if(t.hasBorder){if(!w||JSON.stringify(t.graphicProperties.lineStyle)!==H){w=j.createLineMaterial({color:t.graphicProperties.lineStyle.color,opacity:1,lineWidth:t.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:t.graphicProperties.lineStyle.pattern})}G=k.createLineNode({points:D.coordinates,material:w});G.setShadow(false);G.setPickParent(true);G.setMatrix(E);s.addChild(G)}A.activate(u);v.setVisibility(t.isVisible);v.setPointHandleVisibility(r,t.inEdition,t.inEdition,q._viewer.getVisibleSpace());r.setMatrix(new l.Matrix4().makeTranslation(0,0,0.1))}v.setMatrix(new l.Matrix4().setPosition(v.get3DPositionFromScreenCoordinates({coords:t.center,anchor:t.windowAnchor,proportionalPosition:t.isPositionProportional})));v.highlightIfNeeded();q._viewer.render()};this.onViewerEventCB=function(D){if(D.eventType==="@onViewpointChange"||D.eventType==="@onWindowResized"){v.update(t)}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}});return a});define("DS/DMUPlayMarker/DMUMarker2DEllipse",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DEllipseNode3D"],function(b,e,c){var d=[{name:"vCenter",type:"Vector2",JSONname:"Properties2DEllipse.center",isOverloadable:true,defaultValue:new e.Vector2()},{name:"fxAxisLength",type:"float",JSONname:"Properties2DEllipse.xAxisLength",defaultValue:100,isOverloadable:true},{name:"fyAxisLength",type:"float",JSONname:"Properties2DEllipse.yAxisLength",defaultValue:100,isOverloadable:true}];var a=b.extend({init:function(g,f){this._parent(g,f);this._sExpType="DMUMarker2DEllipse";this._sType="Marker2DEllipse";this._parameters=this._parameters.concat(d);this.defineMembersFromParameters();var h=this;this.buildNode=function(){if(!h._nNode){h._nNode=new c(h);h.addNodeInParentNode();h.setInEdition(false);h.refreshNode()}}},initComponent:function(f){this._parent(f);this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar")},refreshNode:function(){if(this._nNode){this._nNode.update({xAxisLength:this.getAttribute("fxAxisLength"),yAxisLength:this.getAttribute("fyAxisLength"),center:this.getAttribute("vCenter"),windowAnchor:this.getAttribute("sWindowAnchor"),inEdition:this.isInEdition(),isVisible:this.getAttribute("bVisible"),isFilled:this.getAttribute("bIsFilled"),hasBorder:this.getAttribute("bHasBorder"),isPositionProportional:this.getAttribute("bProportionalPosition"),rotationAngle:this.getAttribute("fRotationAngle"),graphicProperties:{fillStyle:{color:this.getAttribute("cFillStyleColor"),opacity:this.getAttribute("fOpacity")},lineStyle:{pattern:this.getAttribute("sLineStylePattern"),thickness:this.getAttribute("fLineStyleThickness"),color:this.getAttribute("cLineStyleColor")}}})}},setAttribute:function(f,g){if(g===false&&f==="bHasBorder"&&!this.getAttribute("bIsFilled")){this.setAttribute("bIsFilled",true);this._parent(f,g)}else{if(g===false&&f==="bIsFilled"&&!this.getAttribute("bHasBorder")){this.setAttribute("bHasBorder",true);this._parent(f,g)}}if(f==="vCenter"){this._parent(f,g);this.refreshNode()}else{if(f==="fxAxisLength"||f==="fyAxisLength"){if(g>0){this._parent(f,g);this.refreshNode()}}else{return this._parent(f,g)}}},getAttribute:function(f){if(f==="vCenter"){return this._parent("vCenter").clone()}else{return this._parent(f)}},GetType:function(){return"DMUMarker2DEllipse"}});return a});define("DS/DMUPlayMarker/DMUMarker2DHyperlinkNode3D",["UWA/Core","DS/DMUPlayMarker/DMUMarker2DTextNode3D","DS/Mesh/MeshUtils","DS/DMUPlayMarker/DMUMarkerTools","DS/Selection/PSOManager","DS/DMUMeasurable/DMUToolsSceneGraph"],function(f,b,c,d,a,e){return b.extend({init:function(g){this._parent(g,{padding:0});var j=this;var i;this.getTooltip=function(){return d.createHyperlinkDiv(g.getAttribute("oHyperlinks"))};this.onClickCB=function(){g._viewer.setCursor("auto");d.solveHyperlink(g.getAttribute("oHyperlinks"),g._viewer)};this.onBeginPreactivateCB=function(k){if(!i){i=e.buildPathElement(j.children[0])}a.add({pathElement:i,event:k.event.from[0]});g._viewer.setCursor("pointer")};this.onEndPreactivateCB=function(){if(!i){i=e.buildPathElement(j.children[0])}if(a.isIn({pathElement:i})){a.remove({pathElement:i})}g._viewer.setCursor("auto")};var h=this.update;this.update=function(k){h(k);j.setPickable(c.PICKABLE);j._getExcludeFromCSO=function(){return g.isReadOnly()}}}})});define("DS/DMUPlayMarker/DMUMarker2DHyperlink",["DS/DMUPlayMarker/DMUMarker2DText","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DHyperlinkNode3D","DS/DMUPlayMarker/DMUMarkerTools"],function(a,c,b,d){return a.extend({init:function(f,e){this._parent(f,e);this._sExpType="DMUMarker2DHyperlink";this._sType="Marker2DHyperlink";var g=this;this.buildNode=function(){if(!g._nNode){g._nNode=new b(g);g.addNodeInParentNode();g.setInEdition(false);g.refreshNode()}}},initComponent:function(e){this._parent(e);this.initContextualBar("DS/DMUMarker/DMUMarkerTextContextualBar")},getAttribute:function(f){if(f==="sImageSrc"){var e=this._parent(f);if(!e){e=d.getHyperlinkIcon(this.getAttribute("oHyperlinks"))}return e}else{return this._parent(f)}},GetType:function(){return"DMUMarker2DHyperlink"}})});define("DS/DMUPlayMarker/DMUMarker2DPictureNode3D",["DS/Visualization/Node3D","DS/Manipulators/ScreenPlaneManipulator","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUBaseUI/DMUNode2D","DS/Visualization/ThreeJS_DS","DS/DMUMarkerVisu/DMUMkvShapeNode","DS/DMUBaseUI/DMUToolsLeader","DS/Manipulators/PointHandle","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/DMUPlayMarker/DMUMarkerMkvShape"],function(h,i,a,g,k,b,j,n,f,e,l,c,m){var d=g.extend({init:function(q){this._parent(q);var w=this,x=false,s;var v=new b({viewer:q._viewer,window:q._frmWindow,data:{mkvShape:new m(q),graphicProperties:{padding:0}}});this.addChild(v);v.setPickParent(true);var y=new h();this.addChild(y);y.setPickParent(true);this.setName(q.getAttribute("sName"));this.setNoZ(true);function r(){if(!s.hasALeader){y.setVisibility(false);y.setVisibilityFree(true);return}y.setVisibility(true);y.setVisibilityFree(false);if((q._viewer.getVisibleSpace()===0&&s.isVisible===false)||(q._viewer.getVisibleSpace()===1&&s.isVisible===true)){var D=0;switch(s.leaderEndType){case"Arrow":D=1;break;case"Bubble":D=2;break}var O=v.getDimensions();if(O.offsetWidth>0&&O.offsetHeight>0){var M=s.position.clone();var L={offsetWidth:f.convertModelToPixels({sizeInMM:O.offsetWidth,viewer:q._viewer}),offsetHeight:f.convertModelToPixels({sizeInMM:O.offsetHeight,viewer:q._viewer})};L.offsetWidth/=window.devicePixelRatio;L.offsetHeight/=window.devicePixelRatio;if(s.anchorMode==="topleft"){var Q=f.getViewerPositionFromPoint(q._viewer,M);if(!isNaN(Q.left)&&!isNaN(Q.top)){var I=new k.Vector2(Q.left+L.offsetWidth/2,Q.top+L.offsetHeight/2);var E=f.getLineFromWindowPosition(q._viewer,I.x,I.y);var J=f.getViewpointInfo(q._viewer.currentViewpoint);var N=e.computeLinePlaneDistance(E.position.toArray(),E.direction.toArray(),s.position.toArray(),J.sight.toArray());M=new k.Vector3(N.aPosition[0],N.aPosition[1],N.aPosition[2])}}var R=s.pointingPoints,C,H;if(R!==undefined&&R.length){var G=y.getChildren();for(var K=0;K<R.length;K++){H=w.get3DPositionFromScreenCoordinates({coords:R[K],anchor:s.windowAnchor,proportionalPosition:s.isPositionProportional});C=G[K];if(!C){C=new h("DMUMarkerLeaderNode");C.setPickParent(true);y.addChild(C)}var F={width:q.getAttribute("fLeaderAttachWidthRatio"),height:q.getAttribute("fLeaderAttachLengthRatio")};j.modifyLeaderNode(q._viewer,C,true,M,H,F,s.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,s.graphicProperties.leaderStyle.color,s.graphicProperties.leaderStyle.pattern,D,L,q._frmWindow)}G=y.getChildren();if(R.length<G.length){for(var P=G.length-1;P>=R.length;P--){y.removeChild(G[P])}}}}}}function B(){x=q._checkUnderCertainCommand()}function p(D){if(x){return}var C={pathElement:l.buildPathElement(w)};if(D&&D.event.from[0].event.ctrlKey){c.remove(C)}else{c.empty()}c.add(C)}var A=new i();A.setExclusive(true);var u=A.linkToNode(v);var o,z=0;A.subscribe("BeginManipulate",function(){B();if(x){return}z=0;if(!x){o=w.get3DPositionFromScreenCoordinates({coords:q.getAttribute("vLeaderBreakPoint2D"),anchor:q.getAttribute("sWindowAnchor"),proportionalPosition:q.getAttribute("bProportionalPosition")})}});A.subscribe("Manipulate",function(C){if(x){return}z++;var D=f.getWindowPositionFromPoint(q._viewer,o.clone().add(C.translationVector),q._frmWindow);q.setAttribute("vLeaderBreakPoint2D",new k.Vector2(D.left,D.top))});A.subscribe("EndManipulate",function(D){if(x){return}if(z<3){var C={pathElement:l.buildPathElement(w)};if(!D.event.from[0].event.ctrlKey){setTimeout(function(){c.empty();c.add(C)})}else{if(c.isIn(C)){c.remove(C)}else{c.add(C)}}}else{p(D)}});var t=new n({viewer:q._viewer,sceneGraph:this});t.subscribe("BeginManipulate",B);t.subscribe("Manipulate",function(E){if(x){return}var D=w.get3DPositionFromScreenCoordinates({coords:q.getAttribute("lLeaderPointingPoints")[0],anchor:q.getAttribute("sWindowAnchor"),proportionalPosition:q.getAttribute("bProportionalPosition")});var C=f.getPositionFromIntersection(q._viewer,E.intersection.position,D,q._frmWindow);if(E.intersection.position&&E.intersection.path.length){C=E.intersection.position}var F=f.getWindowPositionFromPoint(q._viewer,C,q._frmWindow);q.modifyLeaderPointingPoint(0,new k.Vector2(F.left,F.top))});t.subscribe("EndManipulate",p);this.removeDMUNode3DOverload=function(){if(v){v.remove()}w=t=y=v=u=A=null};this.getPixelFontSize=function(){var C;if(q.getAttribute("iFontSize")){C=f.convertPixelToModel({sizeInPixels:q.getAttribute("iFontSize")*(4/3),viewer:q._viewer})}if(!C){C=q.getAttribute("fFontSize")}return f.convertModelToPixels({sizeInMM:C,viewer:q._viewer})};this.update=function(F){if(!w){return}s=s?w.mergeParams(s,F):F;A.deactivate(u);if(s.isPositionProportional){var G=w.convertCoordsInPixels({coords:new k.Vector2(s.imageWidth,s.imageHeight)});s.imageWidth=G.x;s.imageHeight=G.y}s.graphicProperties.fontStyle.height=this.getPixelFontSize();v.modify(s);var E=s.breakPoint2D.clone();var D=v.getDimensions();D.offsetWidth-=1;D.offsetHeight-=1;if(s.isPositionProportional){var C=w.convertPixelsInCoords({coords:new k.Vector2(D.offsetWidth,D.offsetHeight),anchor:s.windowAnchor});D.offsetWidth=C.x;D.offsetHeight=C.y}if(D.offsetWidth>0&&D.offsetHeight>0&&s.anchorMode==="topleft"){E.x+=D.offsetWidth/2;E.y+=D.offsetHeight/2}s.position=w.get3DPositionFromScreenCoordinates({coords:E,anchor:s.windowAnchor,proportionalPosition:s.isPositionProportional});v.setMatrix(new k.Matrix4().setPosition(s.position));A.activate(u);r();if(t){var H=w.get3DPositionFromScreenCoordinates({coords:q.getAttribute("lLeaderPointingPoints")[0],anchor:s.windowAnchor,proportionalPosition:s.isPositionProportional});t.setMatrix(new k.Matrix4().setPosition(H));w.setPointHandleVisibility(t,s.hasALeader&&s.isVisible&&s.inEdition,s.inEdition,q._viewer.getVisibleSpace());if(!s.hasALeader){t.setVisibilityFree(true)}}w.setVisibility(s.isVisible);w.highlightIfNeeded();q._viewer.render()};this.onViewerEventCB=function(C){if(C.eventType==="@onWindowResized"||C.eventType==="@onViewpointChange"||C.eventType==="onSwapVisibleSpace"){v.stopEdition(w);q.refreshNode()}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}});return d});define("DS/DMUPlayMarker/DMUMarker2DPicture",["DS/DMUPlayMarker/DMUMarker2DText","DS/DMUPlayMarker/DMUMarker2DPictureNode3D"],function(a,d){var b=[{name:"bShortDisplay",type:"bool",JSONname:"Properties2DPicture.Shortdisplay",defaultValue:false,isOverloadable:true}];var c=a.extend({init:function(g,f){this._parent(g,f);this._sExpType="DMUMarker2DPicture";this._sType="Marker2DPicture";var h=this;var e=null;this.setTextToDisplay=function(i){e=i};this.getTextToDisplay=function(){if(h.getAttribute("bShortDisplay")){return""}return e?e:h.getAttribute("sTextContents")};this._parameters=this._parameters.concat(b);this.defineMembersFromParameters();this.buildNode=function(){if(!h._nNode){h._nNode=new d(h);h.addNodeInParentNode();h.setInEdition(false);h.refreshNode()}}},initComponent:function(e){this._parent(e);this.initContextualBar("DS/DMUMarker/DMUMarkerPictureContextualBar")},refreshNode:function(){if(this._nNode){this._nNode.update({content:this.getTextToDisplay(),isVisible:this.getAttribute("bVisible"),hasALeader:this.getAttribute("bHasALeader"),leaderEndType:this.getAttribute("sLeaderEndType"),breakPoint2D:this.getAttribute("vLeaderBreakPoint2D"),pointingPoints:this.getAttribute("lLeaderPointingPoints"),inEdition:this.isInEdition(),isFilled:this.getAttribute("bIsFilled"),hasBorder:this.getAttribute("bHasBorder"),imageWidth:this.getAttribute("fImageWidth"),imageHeight:this.getAttribute("fImageHeight"),imageInvertH:this.getAttribute("bInvertH"),imageInvertV:this.getAttribute("bInvertV"),markerImage:this.getAttribute("sImageSrc"),shortDisplay:this.getAttribute("bShortDisplay"),windowAnchor:this.getAttribute("sWindowAnchor"),anchorMode:this.getAttribute("sAnchorMode"),isPositionProportional:this.getAttribute("bProportionalPosition"),leaderAttachWidthRatio:this.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:this.getAttribute("fLeaderAttachLengthRatio"),boxRotationAngle:this.getAttribute("fBoxRotationAngle"),graphicProperties:{borderRadius:this.getAttribute("fBorderRadius"),fontStyle:{pxheight:this.getAttribute("iFontSize")*(4/3),fontSize:this.getAttribute("fFontSize"),familyName:this.getAttribute("sFontName"),familyStyle:this.getAttribute("sFontStyle"),color:this.getAttribute("cFontColor")},fillStyle:{color:this.getAttribute("cFillStyleColor"),opacity:this.getAttribute("fOpacity"),gradient:this.getAttribute("oGradient")},lineStyle:{thickness:this.getAttribute("fLineStyleThickness"),pattern:this.getAttribute("sLineStylePattern"),color:this.getAttribute("cLineStyleColor")},leaderStyle:{thickness:this.getAttribute("fLeaderStyleThickness"),pattern:this.getAttribute("sLeaderStylePattern"),color:this.getAttribute("cLeaderStyleColor")}}})}},setAttribute:function(e,f){if(e==="sTextContents"||e==="iFontSize"||e==="fFontSize"||e==="sFontName"||e==="sFontStyle"){this.setTextToDisplay("")}if(e==="fTextBoxWidth"){this._parent("fTextBoxWidth",null);this._parent("fImageWidth",f)}else{if(e==="fTextBoxLength"){this._parent("fTextBoxLength",null);this._parent("fImageHeight",f)}else{if(e==="bInvertH"||e==="bInvertV"){this._parent(e,f);this.refreshNode()}else{this._parent(e,f)}}}},getAttribute:function(e){var f=this._parent(e);if(e==="fImageWidth"){if(f===undefined||f===null){f=this._parent("fTextBoxWidth")}}else{if(e==="fImageHeight"){if(f===undefined||f===null){f=this._parent("fTextBoxLength")}}}return f},GetType:function(){return"DMUMarker2DPicture"}});return c});define("DS/DMUPlayMarker/DMUMarker2DPolyline",["DS/DMUPlayMarker/DMUMarker2D","DS/DMUPlayMarker/DMUMarker2DPolylineNode3D","DS/DMUPlayMarker/DMUMarker2DPoint","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPImportServices"],function(d,c,b,f,a){var e=[{name:"oPoints",type:"objectDefinition",JSONname:"Properties2DMultiPoint.Points",isOverloadable:true},{name:"cFillStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.color",defaultValue:null},{name:"bIsFilled",type:"bool",JSONname:"PropertiesMarkerBase.filled",defaultValue:null},{name:"bHasBorder",type:"bool",JSONname:"PropertiesMarkerBase.border",defaultValue:null},{name:"fOpacity",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.opacity",defaultValue:null}];return d.extend({init:function(j,g){this._parent(j,g);this._sExpType="DMUMarker2DPolyline";this._sType="Marker2DPolyline";this._parameters=this._parameters.concat(e);this.defineMembersFromParameters();var i=[];var h=new a();var k=this;this.buildNode=function(){if(!k._nNode){k._nNode=new c(k);k.addNodeInParentNode();k.refreshNode()}};this.getPoints=function(o){if(o||!i.length){var n=k.getAttribute("oPoints");for(var m=0;m<i.length;m++){i[m].remove()}i.length=0;for(var m=0;m<n.length;m++){var p=f.getReviewContext({viewer:k._viewer});var l=new b(k._viewer,p);l.initComponent({context:p.getCurrentReview()});h.fillObjectAttributes(l,n[m]);l.buildNode();i.push(l)}}return i}},refreshNode:function(){if(this._nNode){this._nNode.update({isVisible:this.getAttribute("bVisible"),windowAnchor:this.getAttribute("sWindowAnchor"),isPositionProportional:this.getAttribute("bProportionalPosition"),points:this.getAttribute("oPoints"),rotationAngle:this.getAttribute("fRotationAngle"),graphicProperties:{lineStyle:{thickness:this.getAttribute("fLineStyleThickness"),pattern:this.getAttribute("sLineStylePattern"),color:this.getAttribute("cLineStyleColor")}}})}},GetType:function(){return"DMUMarker2DPolyline"}})});define("DS/DMUPlayMarker/DMUMarker2DLine",["DS/DMUPlayMarker/DMUMarker2DPolyline"],function(a){return a.extend({init:function(c,b){this._parent(c,b);this._sExpType="DMUMarker2DLine";this._sType="Marker2DLine"},initComponent:function(b){this._parent(b);this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar")},GetType:function(){return"DMUMarker2DLine"}})});define("DS/DMUPlayMarker/DMUMarker3DHyperlinkNode3D",["DS/DMUPlayMarker/DMUMarker3DTextNode3D","DS/Mesh/MeshUtils","DS/DMUPlayMarker/DMUMarkerTools","DS/Selection/PSOManager","DS/DMUMeasurable/DMUToolsSceneGraph"],function(b,c,d,a,e){return b.extend({init:function(f){this._parent(f,{padding:0});var i=this;var h;this.getTooltip=function(){return d.createHyperlinkDiv(f.getAttribute("oHyperlinks"))};this.onClickCB=function(){f._viewer.setCursor("auto");d.solveHyperlink(f.getAttribute("oHyperlinks"),f._viewer)};this.onBeginPreactivateCB=function(j){if(!h){h=e.buildPathElement(i.children[0])}a.add({pathElement:h,event:j.event.from[0]});f._viewer.setCursor("pointer")};this.onEndPreactivateCB=function(){if(!h){h=e.buildPathElement(i.children[0])}if(a.isIn({pathElement:h})){a.remove({pathElement:h})}f._viewer.setCursor("auto")};var g=this.update;this.update=function(j){g(j);i.setPickable(c.PICKABLE);i._getExcludeFromCSO=function(){return f.isReadOnly()}}}})});define("DS/DMUPlayMarker/DMUMarker3DHyperlink",["DS/DMUPlayMarker/DMUMarker3DText","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3DHyperlinkNode3D","DS/DMUPlayMarker/DMUMarkerTools"],function(a,c,b,d){return a.extend({init:function(f,e){this._parent(f,e);this._sExpType="DMUMarker3DHyperlink";this._sType="Marker3DHyperlink";var g=this;this.buildNode=function(){if(!g._nNode){g._nNode=new b(g);g.addNodeInParentNode();g.setInEdition(false);g.refreshNode()}}},initComponent:function(e){this._parent(e);this.initContextualBar("DS/DMUMarker/DMUMarkerTextContextualBar")},getAttribute:function(f){if(f==="sImageSrc"){var e=this._parent(f);if(!e){e=d.getHyperlinkIcon(this.getAttribute("oHyperlinks"))}return e}else{return this._parent(f)}},GetType:function(){return"DMUMarker3DHyperlink"}})});define("DS/DMUPlayMarker/DMUMarker3DPictureNode3D",["UWA/Core","DS/Visualization/Node3D","DS/Manipulators/ScreenPlaneManipulator","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUBaseUI/DMUNode3D","DS/Visualization/ThreeJS_DS","DS/DMUMarkerVisu/DMUMkvShapeNode","DS/DMUBaseUI/DMUToolsLeader","DS/Manipulators/PointHandle","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/DMUPlayMarker/DMUMarkerMkvShape","DS/DMUPlayMarker/DMUMarkerTools"],function(h,i,j,a,b,l,c,k,p,g,f,n,e,o,d){var m=b.extend({init:function(r){this._parent(r);var A=this,B=false,u;var s=null;var z=new c({window:r._frmWindow,data:{mkvShape:new o(r),graphicProperties:{padding:0}}});this.addChild(z);z.setPickParent(true);this.setName(r.getAttribute("sName"));this.setNoZ(true);var D=new i();this.addChild(D);D.setPickParent(true);function t(){if(!u.hasALeader){D.setVisibility(false);D.setVisibilityFree(true);return}D.setVisibility(true);D.setVisibilityFree(false);if((r._viewer.getVisibleSpace()===0&&u.isVisible===false)||(r._viewer.getVisibleSpace()===1&&u.isVisible===true)){var I=0;switch(r.getAttribute("sLeaderEndType")){case"Arrow":I=1;break;case"Bubble":I=2;break}var U=z.getDimensions();if(U.offsetWidth>0&&U.offsetHeight>0){var S=u.position.clone();var Q={offsetWidth:g.convertModelToPixels({sizeInMM:U.offsetWidth,viewer:r._viewer,coords:u.zoomMode?S:null}),offsetHeight:g.convertModelToPixels({sizeInMM:U.offsetHeight,viewer:r._viewer,coords:u.zoomMode?S:null})};Q.offsetWidth/=window.devicePixelRatio;Q.offsetHeight/=window.devicePixelRatio;if(u.anchorMode==="topleft"){if(u.zoomMode){var R=r._viewer.currentViewpoint.getUpDirection().clone();var K=new l.Vector3().crossVectors(r._viewer.currentViewpoint.getSightDirection(),R).setLength(U.offsetWidth/2);R.setLength(-U.offsetHeight/2);S.add(R);S.add(K)}else{var W=g.getViewerPositionFromPoint(r._viewer,S);if(!isNaN(W.left)&&!isNaN(W.top)){var O=new l.Vector2(W.left+Q.offsetWidth/2,W.top+Q.offsetHeight/2);var J=g.getLineFromWindowPosition(r._viewer,O.x,O.y);var N=g.getViewpointInfo(r._viewer.currentViewpoint);var T=f.computeLinePlaneDistance(J.position.toArray(),J.direction.toArray(),u.position.toArray(),N.sight.toArray());S=new l.Vector3(T.aPosition[0],T.aPosition[1],T.aPosition[2])}}}var X=r.getAttribute("lLeaderPointingPoints"),H;if(X!==undefined&&X.length){var M=D.getChildren();for(var P=0;P<X.length;P++){H=M[P];if(!H){H=new i("DMUMarkerLeaderNode");H.setPickParent(true);D.addChild(H)}var L={width:r.getAttribute("fLeaderAttachWidthRatio"),height:r.getAttribute("fLeaderAttachLengthRatio")};k.modifyLeaderNode(r._viewer,H,true,S,X[P],L,u.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,u.graphicProperties.leaderStyle.color,u.graphicProperties.leaderStyle.pattern,I,Q,r._frmWindow)}M=D.getChildren();if(X.length<M.length){for(var V=M.length-1;V>=X.length;V--){D.removeChild(M[V])}}}}}}function G(){B=r._checkUnderCertainCommand()}function q(I){if(B){return}var H={pathElement:n.buildPathElement(A)};if(I&&I.event.from[0].event.ctrlKey){e.remove(H)}else{e.empty()}e.add(H)}var F=new j();F.setExclusive(true);var y=F.linkToNode(z);var E=0;var x;F.subscribe("BeginManipulate",function(){G();if(B){return}E=0;x=r.getAttribute("vLeaderBreakPoint3D")});F.subscribe("Manipulate",function(H){if(B){return}E++;if(!B){r.setAttribute("vLeaderBreakPoint3D",x.clone().add(H.translationVector))}});F.subscribe("EndManipulate",function(I){if(B){return}if(E<3){var H={pathElement:n.buildPathElement(A)};if(!I.event.from[0].event.ctrlKey){setTimeout(function(){e.empty();e.add(H)})}else{if(e.isIn(H)){e.remove(H)}else{e.add(H)}}}else{q(I)}});var v=r.getAttribute("lLeaderPointingPoints"),w;var C=this.setClippingControlPoints(v);if(v.length){w=new p({viewer:r._viewer,sceneGraph:this});w.subscribe("BeginManipulate",G);w.subscribe("Manipulate",function(J){if(B){return}var K=J.intersection;var H=g.getPositionFromIntersection(r._viewer,K.position,r.getAttribute("lLeaderPointingPoints")[0],r._frmWindow);var I=K.position&&K.path.length;if(I){H=K.position}r.modifyLeaderPointingPoint(0,H)});w.subscribe("EndManipulate",function(H){if(B){return}q(H);A.removeClippingControlPoints(C);C=A.setClippingControlPoints(r.getAttribute("lLeaderPointingPoints"))})}this.removeDMUNode3DOverload=function(){if(z){z.remove()}if(C){A.removeClippingControlPoints(C);C=null}D=z=w=A=y=F=null};this.getPixelFontSize=function(){var H;if(r.getAttribute("iFontSize")){H=g.convertPixelToModel({sizeInPixels:r.getAttribute("iFontSize")*(4/3),viewer:r._viewer})}if(!H){H=r.getAttribute("fFontSize")}return g.convertModelToPixels({sizeInMM:H,viewer:r._viewer})};this.update=function(H){if(!A){return}u=u?A.mergeParams(u,H):H;if(s===null){s=d.is3DMarkerDisplayed(r._viewer,r.getParent(),u.pointedReferences)}F.deactivate(y);u.graphicProperties.fontStyle.height=A.getPixelFontSize();z.modify(u);F.activate(y);t();if(w){w.setMatrix(new l.Matrix4().setPosition(r.getAttribute("lLeaderPointingPoints")[0]));A.setPointHandleVisibility(w,u.hasALeader&&u.isVisible&&u.inEdition,u.inEdition,r._viewer.getVisibleSpace());if(!u.hasALeader){w.setVisibilityFree(true)}}A.setVisibility(u.isVisible&&s);A.highlightIfNeeded();r._viewer.render()};this.onViewerEventCB=function(H){if(H.eventType==="@onWindowResized"||H.eventType==="@onViewpointChange"||H.eventType==="onSwapVisibleSpace"){t();r._viewer.render()}else{if(H.eventType==="onHideShow"&&u.pointedReferences){s=d.is3DMarkerDisplayed(r._viewer,r.getParent(),u.pointedReferences);A.setVisibility(u.isVisible&&s);r._viewer.render()}}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}});return m});define("DS/DMUPlayMarker/DMUMarker3DPicture",["DS/DMUPlayMarker/DMUMarker3DText","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUPlayMarker/DMUMarker3DPictureNode3D"],function(b,a,c){var e=[{name:"bShortDisplay",type:"bool",JSONname:"Properties3DPicture.Shortdisplay",defaultValue:false,isOverloadable:true}];var d=b.extend({init:function(h,g){this._parent(h,g);this._sExpType="DMUMarker3DPicture";this._sType="Marker3DPicture";var i=this;var f=null;this.setTextToDisplay=function(j){f=j};this.getTextToDisplay=function(){if(i.getAttribute("bShortDisplay")){return[]}return f?f:i.getAttribute("sTextContents")};this._parameters=this._parameters.concat(e);this.defineMembersFromParameters();this.buildNode=function(){if(!i._nNode){i._nNode=new c(i);i.addNodeInParentNode();i.setInEdition(false);i.refreshNode()}}},initComponent:function(f){this._parent(f);this.initContextualBar("DS/DMUMarker/DMUMarkerPictureContextualBar")},refreshNode:function(){if(this._nNode){this._nNode.update({pointedReferences:this.getAttribute("lPointedReferences"),content:this.getTextToDisplay(),isVisible:this.getAttribute("bVisible"),hasALeader:this.getAttribute("bHasALeader"),inEdition:this.isInEdition(),leaderEndType:this.getAttribute("sLeaderEndType"),position:this.getAttribute("vLeaderBreakPoint3D"),pointingPoints:this.getAttribute("lLeaderPointingPoints"),isFilled:this.getAttribute("bIsFilled"),hasBorder:this.getAttribute("bHasBorder"),imageWidth:this.getAttribute("fImageWidth"),imageHeight:this.getAttribute("fImageHeight"),imageInvertH:this.getAttribute("bInvertH"),imageInvertV:this.getAttribute("bInvertV"),markerImage:this.getAttribute("sImageSrc"),shortDisplay:this.getAttribute("bShortDisplay"),windowAnchor:this.getAttribute("sWindowAnchor"),anchorMode:this.getAttribute("sAnchorMode"),zoomMode:this.getAttribute("bZoomMode"),leaderAttachWidthRatio:this.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:this.getAttribute("fLeaderAttachLengthRatio"),boxRotationAngle:this.getAttribute("fBoxRotationAngle"),graphicProperties:{borderRadius:this.getAttribute("fBorderRadius"),fontStyle:{pxheight:this.getAttribute("iFontSize")*(4/3),fontSize:this.getAttribute("fFontSize"),familyName:this.getAttribute("sFontName"),familyStyle:this.getAttribute("sFontStyle"),color:this.getAttribute("cFontColor")},fillStyle:{color:this.getAttribute("cFillStyleColor"),opacity:this.getAttribute("fOpacity"),gradient:this.getAttribute("oGradient")},lineStyle:{thickness:this.getAttribute("fLineStyleThickness"),pattern:this.getAttribute("sLineStylePattern"),color:this.getAttribute("cLineStyleColor")},leaderStyle:{thickness:this.getAttribute("fLeaderStyleThickness"),pattern:this.getAttribute("sLeaderStylePattern"),color:this.getAttribute("cLeaderStyleColor")}}})}},setAttribute:function(f,g){if(f==="sTextContents"||f==="iFontSize"||f==="fFontSize"||f==="sFontName"||f==="sFontStyle"){this.setTextToDisplay("")}if(f==="fTextBoxWidth"){this._parent("fTextBoxWidth",null);this._parent("fImageWidth",g)}else{if(f==="fTextBoxLength"){this._parent("fTextBoxLength",null);this._parent("fImageHeight",g)}else{if(f==="bInvertH"||f==="bInvertV"){this._parent(f,g);this.refreshNode()}else{this._parent(f,g)}}}},getAttribute:function(f){var g;if(f==="fImageWidth"){g=this._parent("fImageWidth");if(g===undefined||g===null){g=a.convertPixelToModel({sizeInPixels:this._parent("fTextBoxWidth"),viewer:this._viewer})}}else{if(f==="fImageHeight"){g=this._parent("fImageHeight");if(g===undefined||g===null){g=a.convertPixelToModel({sizeInPixels:this._parent("fTextBoxLength"),viewer:this._viewer})}}else{g=this._parent(f)}}return g},GetType:function(){return"DMUMarker3DPicture"}});return d});define("DS/DMUPlayMarker/DMUMarker2DArrowNode3D",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/SceneGraphFactory","DS/WebappsUtils/WebappsUtils","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseUI/DMUNode2D","DS/Manipulators/PointHandle","DS/DMUBaseExperience/EXPToolsVisualization","DS/Manipulators/ScreenPlaneManipulator","DS/DMUBaseCommands/EXPToolsWUX","DS/Selection/CSOManager","DS/Mesh/MeshUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUPlayMarker/DMUMarkerTools"],function(d,m,r,j,o,c,b,l,i,p,e,a,k,q,h,g,n){var f=i.extend({init:function(w){this._parent(w);this.setName(w.getAttribute("sName"));this.setIcon(b.getWebappsAssetUrl("DMUBaseUI","icons/32/I_WebMarkerArrow.png"));this.setNoZ(true);var H=this,F=false,v={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}};var K,G;var I,u,B;var D=new j({type:"Spherical"});this.addChild(D);D.setPickParent(true);var t=new o({ratio:1});D.addChild(t);t.setPickParent(true);function C(){F=w._checkUnderCertainCommand()}function E(O){if(F){return}w.manipulate=false;var N={pathElement:g.buildPathElement(H)};if(O&&O.event.from[0].event.ctrlKey){q.remove(N)}else{q.empty()}q.add(N)}function A(N,Q,O){var T=new r.Vector2().subVectors(N,Q);var P=new r.Vector2().subVectors(O,Q);var S=P.dot(P);var R=P.dot(T);return R/S}function L(N,Q,P){var O=A(N,Q,P);return new r.Vector2().subVectors(P,Q).multiplyScalar(O).add(Q)}I=new p({viewer:w._viewer,sceneGraph:D});I.subscribe("BeginManipulate",C);I.subscribe("Manipulate",function(N){if(F){return}w.manipulate=true;w.setAttribute("vFirstPoint",N.event.from[0].currentPosition.clone())});I.subscribe("EndManipulate",E);u=new p({viewer:w._viewer,sceneGraph:D});u.subscribe("BeginManipulate",C);u.subscribe("Manipulate",function(N){if(F){return}w.manipulate=true;w.setAttribute("vSecondPoint",N.event.from[0].currentPosition.clone())});u.subscribe("EndManipulate",E);B=new p({viewer:w._viewer,sceneGraph:D});B.subscribe("BeginManipulate",C);B.subscribe("Manipulate",function(S){if(F){return}w.manipulate=true;var P=L(S.event.from[0].currentPosition.clone(),v.firstPoint.clone(),v.secondPoint.clone());var O=v.secondPoint.clone().sub(v.firstPoint.clone());var T=P.clone().sub(v.firstPoint),R=P.clone().sub(v.secondPoint);if(T.length()<O.length()&&R.length()<O.length()){var N=1-T.length()/O.length();if((w.getAttribute("sStyle")==="beginSide"&&N<=0.9&&N>=0.1)||(w.getAttribute("sStyle")==="bothSide"&&N<=0.9&&N>=0.55)){w.setAttribute("fShaftRatio",N)}}var Q=P.sub(S.event.from[0].currentPosition.clone()).length();if(Q>0){w.setAttribute("fWidth",2*Q)}});B.subscribe("EndManipulate",E);var s=new a();s.setExclusive(true);var M=s.linkToNode(t);var J=0;var y,z,x;s.subscribe("BeginManipulate",function(N){C();if(F){return}J=0;y=N.event.from[0].currentPosition.clone();z=w.getAttribute("vFirstPoint").clone();x=w.getAttribute("vSecondPoint").clone()});s.subscribe("Manipulate",function(O){if(F){return}J++;w.manipulate=true;var N=O.event.from[0].currentPosition.clone().sub(y);w.setAttribute("vFirstPoint",z.clone().add(N));w.setAttribute("vSecondPoint",x.clone().add(N))});s.subscribe("EndManipulate",function(O){if(F){return}if(J<3){w.manipulate=false;var N={pathElement:g.buildPathElement(H)};if(!O.event.from[0].event.ctrlKey){setTimeout(function(){q.empty();q.add(N)})}else{if(q.isIn(N)){q.remove(N)}else{q.add(N)}}}else{E(O)}});this.removeDMUNode3DOverload=function(){H=K=D=t=s=M=null};this.update=function(R){if(!H){return}if(JSON.stringify(R)!==JSON.stringify(v)||(v.isPositionProportional&&(v.screenWidth!==w._viewer.SCREEN_WIDTH||v.screenHeight!==w._viewer.SCREEN_HEIGHT))){var Q=v.graphicProperties&&v.graphicProperties.fillStyle?JSON.stringify(v.graphicProperties.fillStyle):"";var ah=v.graphicProperties&&v.graphicProperties.lineStyle?JSON.stringify(v.graphicProperties.lineStyle):"";v=H.mergeParams(v,R);v.screenWidth=w._viewer.SCREEN_WIDTH;v.screenHeight=w._viewer.SCREEN_HEIGHT;if(v.isPositionProportional){v.firstPointPx=H.convertCoordsInPixels({coords:v.firstPoint,anchor:v.windowAnchor});v.secondPointPx=H.convertCoordsInPixels({coords:v.secondPoint,anchor:v.windowAnchor});var S=H.convertCoordsInPixels({coords:new r.Vector2(v.width,v.width)});v.widthPx=S.x;if(v.bentPoint){v.bentPointPx=H.convertCoordsInPixels({coords:v.bentPoint,anchor:v.windowAnchor})}if(v.endwidth){var N=H.convertCoordsInPixels({coords:new r.Vector2(v.endwidth,v.endwidth)});v.endwidthPx=N.x}}else{v.firstPointPx=v.firstPoint.clone();v.secondPointPx=v.secondPoint.clone();v.widthPx=v.width;if(v.bentPoint){v.bentPointPx=v.bentPoint.clone()}if(v.endwidth){v.endwidthPx=v.endwidth}}var Z,af,ab,ag;if(v.bentPointPx){var V=v.bentPointPx.clone().sub(v.firstPointPx.clone());var Y=V.length()+v.endwidthPx/2;var aa=v.bentPointPx.clone().sub(v.secondPointPx.clone());var ac=aa.length()+v.widthPx/2;ab=new r.Matrix4().makeTranslation(v.widthPx/2-ac/2,-Y/2,0);if(v.rotationAngle){ab.multiply(new r.Matrix4().makeRotationAxis(new r.Vector3(0,0,1),v.rotationAngle))}ag=n.getBentArrowSpecs(v.widthPx,v.endwidthPx,v.bentPointPx,Y,ac,v.shaftRatio,v.headRatio,v.style)}else{Z=v.secondPointPx.clone().sub(v.firstPointPx.clone());af=Math.atan2(Z.y,Z.x);if(af<0){af+=2*Math.PI}af=2*Math.PI-af;ab=new r.Matrix4().makeRotationAxis(new r.Vector3(0,0,1),af);ag=n.getArrowSpecs(v.widthPx,Z.length(),v.shaftRatio,v.headRatio,v.style)}s.deactivate(M);t.removeChildren();var O;if(v.isFilled){if(!K||JSON.stringify(v.graphicProperties.fillStyle)!==Q){K=l.createBasicMaterial({color:v.graphicProperties.fillStyle.color,opacity:v.graphicProperties.fillStyle.opacity})}ag.material=K;O=c.createSimpleMeshNode(ag);O.setShadow(false);O.setPickParent(true);O.setMatrix(ab);t.addChild(O)}if(v.hasBorder){if(!G||JSON.stringify(v.graphicProperties.lineStyle)!==ah){G=l.createLineMaterial({color:v.graphicProperties.lineStyle.color,opacity:1,lineWidth:v.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:v.graphicProperties.lineStyle.pattern})}O=c.createLineNode({points:ag.coordinates,material:G});O.setShadow(false);O.setPickParent(true);O.setMatrix(ab);t.addChild(O)}H.setVisibility(v.isVisible);H.setPointHandleVisibility(I,v.bentPoint===undefined&&v.inEdition,v.inEdition,w._viewer.getVisibleSpace());H.setPointHandleVisibility(u,v.bentPoint===undefined&&v.inEdition,v.inEdition,w._viewer.getVisibleSpace());H.setPointHandleVisibility(B,v.bentPoint===undefined&&v.inEdition,v.inEdition,w._viewer.getVisibleSpace());s.activate(M)}var ae=H.get3DPositionFromScreenCoordinates({coords:v.firstPoint,anchor:v.windowAnchor,proportionalPosition:v.isPositionProportional});H.setMatrix(new r.Matrix4().setPosition(ae));if(!v.bentPointPx){var W=H.get3DPositionFromScreenCoordinates({coords:v.secondPoint,anchor:v.windowAnchor,proportionalPosition:v.isPositionProportional}).clone().sub(ae);var T=v.secondPoint.clone().sub(v.firstPoint.clone());var ad=Math.atan2(T.y,T.x);if(ad<0){ad+=2*Math.PI}ad=2*Math.PI-ad;I.setMatrix(new r.Matrix4().makeTranslation(0,0,1));u.setMatrix(new r.Matrix4().makeTranslation(W.length()*Math.cos(ad),W.length()*Math.sin(ad),1));var U=Math.sqrt(Math.pow(W.length()*(1-v.shaftRatio),2)+Math.pow(W.length()*(v.width/2)/T.length(),2));var X=Math.sqrt(Math.pow(T.length()*(1-v.shaftRatio),2)+Math.pow(v.width/2,2));var P=ad-Math.asin((v.width/2)/X);B.setMatrix(new r.Matrix4().makeTranslation(U*Math.cos(P),U*Math.sin(P),1))}H.highlightIfNeeded();w._viewer.render()};this.onViewerEventCB=function(N){if(N.eventType==="@onViewpointChange"||N.eventType==="@onWindowResized"){H.update(v)}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}});return f});define("DS/DMUPlayMarker/DMUMarker2DArrow",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DArrowNode3D"],function(a,c,e){var b=[{name:"vFirstPoint",type:"Vector2",JSONname:"Properties2DArrow.FirstPoint",isOverloadable:true,defaultValue:new c.Vector2()},{name:"vSecondPoint",type:"Vector2",JSONname:"Properties2DArrow.SecondPoint",isOverloadable:true,defaultValue:new c.Vector2(10,0)},{name:"fWidth",type:"float",JSONname:"Properties2DArrow.Width",defaultValue:1,isOverloadable:true},{name:"sStyle",type:"string",JSONname:"Properties2DArrow.Style",defaultValue:"beginSide",isOverloadable:true},{name:"fShaftRatio",type:"float",JSONname:"Properties2DArrow.ShaftRatio",defaultValue:0.8,isOverloadable:true},{name:"fHeadRatio",type:"float",JSONname:"Properties2DArrow.HeadRatio",defaultValue:0.5,isOverloadable:true},{name:"vBentPoint",type:"Vector2",JSONname:"Properties2DArrow.BentPoint",isOverloadable:true},{name:"fEndWidth",type:"float",JSONname:"Properties2DArrow.EndWidth",isOverloadable:true}];var d=a.extend({init:function(g,f){this._parent(g,f);this._sExpType="DMUMarker2DArrow";this._sType="Marker2DArrow";this._parameters=this._parameters.concat(b);this.defineMembersFromParameters();var h=this;this.buildNode=function(){if(!h._nNode){h._nNode=new e(h);h.addNodeInParentNode();h.setInEdition(false);h.refreshNode()}}},initComponent:function(f){this._parent(f);this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar")},refreshNode:function(){if(this._nNode){this._nNode.update({firstPoint:this.getAttribute("vFirstPoint"),secondPoint:this.getAttribute("vSecondPoint"),bentPoint:this.getAttribute("vBentPoint"),windowAnchor:this.getAttribute("sWindowAnchor"),width:this.getAttribute("fWidth"),endwidth:this.getAttribute("fEndWidth"),style:this.getAttribute("sStyle"),shaftRatio:this.getAttribute("fShaftRatio"),headRatio:this.getAttribute("fHeadRatio"),inEdition:this.isInEdition(),isVisible:this.getAttribute("bVisible"),isFilled:this.getAttribute("bIsFilled"),hasBorder:this.getAttribute("bHasBorder"),isPositionProportional:this.getAttribute("bProportionalPosition"),rotationAngle:this.getAttribute("fRotationAngle"),graphicProperties:{fillStyle:{color:this.getAttribute("cFillStyleColor"),opacity:this.getAttribute("fOpacity")},lineStyle:{pattern:this.getAttribute("sLineStylePattern"),thickness:this.getAttribute("fLineStyleThickness"),color:this.getAttribute("cLineStyleColor")}}})}},setAttribute:function(f,g){if(g===false&&f==="bHasBorder"&&!this.getAttribute("bIsFilled")){this.setAttribute("bIsFilled",true);this._parent(f,g)}else{if(g===false&&f==="bIsFilled"&&!this.getAttribute("bHasBorder")){this.setAttribute("bHasBorder",true);this._parent(f,g)}else{if(f==="vFirstPoint"||f==="vSecondPoint"||f==="fWidth"||f==="fShaftRatio"||f==="sStyle"){this._parent(f,g);this.refreshNode()}else{this._parent(f,g)}}}},getAttribute:function(f){if(f==="vFirstPoint"||f==="vSecondPoint"){return this._parent(f).clone()}else{return this._parent(f)}},GetType:function(){return"DMUMarker2DArrow"}});return d});define("DS/DMUPlayMarker/DMUMarker3DCircleNode3D",["UWA/Core","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Manipulators/PointHandle","DS/Manipulators/ScreenPlaneManipulator","DS/Visualization/SceneGraphFactory","DS/WebappsUtils/WebappsUtils","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUNode3D","DS/Selection/CSOManager","DS/Mesh/MeshUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUPlayMarker/DMUMarkerTools"],function(h,f,n,j,p,k,m,e,l,g,a,d,b,o,c){var i=a.extend({init:function(s){this._parent(s);this.setName(s.getAttribute("sName"));this.setIcon(e.getWebappsAssetUrl("DMUBaseUI","icons/32/I_WebMarkerCircle.png"));this.setNoZ(true);var r;var P=this.setClippingControlPoints([s.getAttribute("vCenter")]);var C=false,v=true,G=true;var I=this;var O,E;var M;var J=null;var z=new f({type:"Spherical"});this.addChild(z);z.setPickParent(true);var y=new j();z.addChild(y);y.setPickParent(true);function x(){C=s._checkUnderCertainCommand()}function A(R){if(C){return}s.manipulate=false;var Q={pathElement:o.buildPathElement(I)};if(R&&R.event.from[0].event.ctrlKey){d.remove(Q)}else{d.empty()}d.add(Q);I.removeClippingControlPoints(P);P=I.setClippingControlPoints([s.getAttribute("vCenter")])}function H(R){var Q=s.getAttribute("fRadius");var S=g.getDistanceFromPixel(s._viewer,s.getAttribute("vCenter"),Q,s._frmWindow);s.setAttribute("vCenter",R);var T=g.getDistanceFromPixel(s._viewer,R,Q,s._frmWindow);if(T!==S){s.setAttribute("fRadius",(s.getAttribute("fRadius")*T)/S)}}var F=new p({viewer:s._viewer,sceneGraph:z});F.subscribe("BeginManipulate",function(Q){G=false;M=null;x(Q)});F.subscribe("Manipulate",function(S){if(C){return}s.manipulate=true;var T=S.intersection;var Q=g.getPositionFromIntersection(s._viewer,T.position,s.getAttribute("vCenter"),s._frmWindow);var R=T.position&&T.path.length;if(R){Q=T.position}H(Q)});F.subscribe("EndManipulate",function(Q){if(C){return}G=true;A(Q)});var D=new j();D.setPickable(b.NODRAWHL);z.addChild(D);var L;var w=new p({viewer:s._viewer,sceneGraph:z});w.subscribe("BeginManipulate",x);w.subscribe("Manipulate",function(R){if(C){return}s.manipulate=true;var Q=g.getPositionFromIntersection(s._viewer,R.intersection.position,s.getAttribute("vCenter"),s._frmWindow);Q.sub(s.getAttribute("vCenter"));M=R.event.from[0].currentPosition.clone();s.setAttribute("fRadius",Q.length())});w.subscribe("EndManipulate",A);function B(){var V=Math.PI;if(M){var U=s._viewer.currentViewpoint.project(s.getAttribute("vCenter"));U=new n.Vector2(U.x,U.y);var R=U.sub(M);V=Math.atan2(R.y,R.x);if(V<0){V+=2*Math.PI}}var S=g.getMMPerPixelRatio(s._viewer,r.center);var Q=new n.Matrix4().makeRotationZ(Math.PI-V).multiply(new n.Matrix4().makeTranslation(s.getAttribute("fRadius")+S*10,0,0.1));var T=new n.Matrix4().makeRotationZ(Math.PI-V).multiply(new n.Matrix4().makeTranslation(s.getAttribute("fRadius"),0,0.1));D.removeChildren();if(r.inEdition&&G){if(!L){L=l.createLineMaterial({color:new n.Color(61,61,61),opacity:1,lineWidth:window.devicePixelRatio,pattern:"6"})}D.addChild(m.createLineNode({points:[new n.Vector3(),new n.Vector3().getPositionFromMatrix(T)],material:L}))}w.setMatrix(Q);s._viewer.render()}var q=new k();q.setExclusive(true);var N=q.linkToNode(y);var t,u;var K=0;q.subscribe("BeginManipulate",function(Q){x();if(C){return}K=0;v=false;t=s._viewer.currentViewpoint.project(Q.intersection.position);u=s._viewer.currentViewpoint.project(s.getAttribute("vCenter"))});q.subscribe("Manipulate",function(S){if(C){return}K++;s.manipulate=true;var Q=s._viewer.currentViewpoint.project(S.intersection.position).sub(t);var R=u.clone().add(Q);M=S.event.from[0].currentPosition.clone();B();H(g.getPositionFromIntersection(s._viewer,s._viewer.currentViewpoint.unProject(R),s.getAttribute("vCenter"),s._frmWindow))});q.subscribe("EndManipulate",function(R){if(C){return}v=true;M=R.event.from[0].currentPosition.clone();B();if(K<3){s.manipulate=false;var Q={pathElement:o.buildPathElement(I)};if(!R.event.from[0].event.ctrlKey){setTimeout(function(){d.empty();d.add(Q)})}else{if(d.isIn(Q)){d.remove(Q)}else{d.add(Q)}}}else{A(R)}});this.removeDMUNode3DOverload=function(){if(P){I.removeClippingControlPoints(P);P=null}P=I=q=N=O=E=z=y=F=null;D=L=null};this.update=function(X){if(!I){return}if(!r||JSON.stringify(X)!==JSON.stringify(r)){var Q=r&&r.graphicProperties&&r.graphicProperties.fillStyle?JSON.stringify(r.graphicProperties.fillStyle):"";var U=r&&r.graphicProperties&&r.graphicProperties.lineStyle?JSON.stringify(r.graphicProperties.lineStyle):"";r=r?I.mergeParams(r,X):X;if(J===null){J=c.is3DMarkerDisplayed(s._viewer,s.getParent(),r.pointedReferences)}q.deactivate(N);y.removeChildren();var T=g.getMMPerPixelRatio(s._viewer,r.center);if(T>0){var V=Math.round((2*Math.PI)/Math.acos(1-(1/(r.radius/T))));if(isNaN(V)||V<0){V=20}if(r.isFilled){if(!O||JSON.stringify(r.graphicProperties.fillStyle)!==Q){O=l.createBasicMaterial({color:r.graphicProperties.fillStyle.color,opacity:r.graphicProperties.fillStyle.opacity})}var W=m.createCircleNode({radius:r.radius,fill:true,segments:V,startAngle:0,endAngle:2*Math.PI,material:O});W.setShadow(false);W.setPickParent(true);y.addChild(W)}if(r.hasBorder){if(!E||JSON.stringify(r.graphicProperties.lineStyle)!==U){E=l.createLineMaterial({color:r.graphicProperties.lineStyle.color,opacity:1,lineWidth:r.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:r.graphicProperties.lineStyle.pattern})}var S=[];for(var Y=0;Y<=V;Y++){S.push(new n.Vector3(r.radius*Math.cos(Math.PI*Y/(V/2)),r.radius*Math.sin(Math.PI*Y/(V/2)),0))}var R=m.createLineNode({points:S,material:E});R.setShadow(false);R.setPickParent(true);y.addChild(R)}}q.activate(N);I.setVisibility(r.isVisible&&J);I.setMatrix(new n.Matrix4().setPosition(r.center));I.setPointHandleVisibility(F,r.inEdition&&v,r.inEdition,s._viewer.getVisibleSpace());I.setPointHandleVisibility(w,r.inEdition&&v&&G,r.inEdition,s._viewer.getVisibleSpace());F.setMatrix(new n.Matrix4().makeTranslation(0,0,0.1));B()}I.highlightIfNeeded();s._viewer.render()};this.onViewerEventCB=function(Q){if(Q.eventType==="@onViewpointEndMove"&&r.inEdition){s.refreshNode();var R={pathElement:o.buildPathElement(I)};d.remove(R);d.add(R)}else{if(Q.eventType==="onHideShow"&&r.pointedReferences){J=c.is3DMarkerDisplayed(s._viewer,s.getParent(),r.pointedReferences);I.setVisibility(r.isVisible&&J);s._viewer.render()}}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}});return i});define("DS/DMUPlayMarker/DMUMarker3DCircle",["DS/DMUPlayMarker/DMUMarker3D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3DCircleNode3D"],function(b,c,d){var a=[{name:"vCenter",type:"Vector3",JSONname:"Properties3DCircle.Center",isOverloadable:true,defaultValue:new c.Vector3()},{name:"fRadius",type:"float",JSONname:"Properties3DCircle.Radius",defaultValue:100,isOverloadable:true}];var e=b.extend({init:function(g,f){this._parent(g,f);this._sExpType="DMUMarker3DCircle";this._sType="Marker3DCircle";this._parameters=this._parameters.concat(a);this.defineMembersFromParameters();var h=this;this.buildNode=function(){if(!h._nNode){h._nNode=new d(h);h.addNodeInParentNode();h.setInEdition(false);h.refreshNode()}}},initComponent:function(f){this._parent(f);this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar")},refreshNode:function(){if(this._nNode){var h=!this.getAttribute("bHasBorder")&&!this.getAttribute("bIsFilled")?true:this.getAttribute("bHasBorder");var g=!this.getAttribute("bHasBorder")&&!this.getAttribute("bIsFilled")?this.getAttribute("cFillStyleColor"):this.getAttribute("cLineStyleColor");var f=!this.getAttribute("bHasBorder")&&!this.getAttribute("bIsFilled")?5:this.getAttribute("fLineStyleThickness");this._nNode.update({pointedReferences:this.getAttribute("lPointedReferences"),radius:this.getAttribute("fRadius"),center:this.getAttribute("vCenter"),inEdition:this.isInEdition(),isVisible:this.getAttribute("bVisible"),isFilled:this.getAttribute("bIsFilled"),hasBorder:h,graphicProperties:{fillStyle:{color:this.getAttribute("cFillStyleColor"),opacity:this.getAttribute("fOpacity")},lineStyle:{pattern:this.getAttribute("sLineStylePattern"),thickness:f,color:g}}})}},setAttribute:function(f,g){if(g===false&&f==="bHasBorder"&&!this.getAttribute("bIsFilled")){this.setAttribute("bIsFilled",true);this._parent(f,g)}else{if(g===false&&f==="bIsFilled"&&!this.getAttribute("bHasBorder")){this.setAttribute("bHasBorder",true);this._parent(f,g)}else{if(f==="cLineStyleColor"&&!this.getAttribute("bIsFilled")&&!this.getAttribute("bHasBorder")){this._parent("cFillStyleColor",g)}else{if(f==="vCenter"){this._parent("vCenter",g);this.refreshNode()}else{if(f==="fRadius"){if(g>0){this._parent("fRadius",g);this.refreshNode()}}else{this._parent(f,g)}}}}}},getAttribute:function(f){if(f==="cLineStyleColor"&&!this.getAttribute("bIsFilled")&&!this.getAttribute("bHasBorder")){return this._parent("cFillStyleColor")}else{if(f==="vCenter"){return this._parent("vCenter").clone()}else{return this._parent(f)}}},GetType:function(){return"DMUMarker3DCircle"}});return e});define("DS/DMUPlayMarker/DMUMarker3DRectangleNode3D",["UWA/Core","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Manipulators/PointHandle","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUNode3D","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/Selection/CSOManager","DS/Manipulators/ScreenPlaneManipulator","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUPlayMarker/DMUMarkerTools"],function(f,j,h,l,n,g,b,k,e,d,i,m,c){var a=b.extend({init:function(q){this._parent(q);this.name=q.getAttribute("sName");this.setNoZ(true);var v=this,y=false;var x=new e({position:q.getAttribute("vPosition"),type:"Spherical"});x.setPickParent(true);this.addChild(x);var s=new h();x.addChild(s);s.setPickParent(true);var t,w,z;var p=null;var B=new i();B.setExclusive(true);var u=B.linkToNode(s);this.removeDMUNode3DOverload=function(){x=v=s=w=z=B=u=null};function C(){y=q._checkUnderCertainCommand()}function o(E){if(y){return}q.manipulate=false;var D={pathElement:m.buildPathElement(v)};if(E&&E.event.from[0].event.ctrlKey){d.remove(D)}else{d.empty()}d.add(D)}var A=0;B.subscribe("BeginManipulate",function(D){C(D);if(y){return}A=0});B.subscribe("Manipulate",function(){if(y){return}A++});B.subscribe("EndManipulate",function(E){if(y){return}if(A<3){q.manipulate=false;var D={pathElement:m.buildPathElement(v)};if(!E.event.from[0].event.ctrlKey){setTimeout(function(){d.empty();d.add(D)})}else{if(d.isIn(D)){d.remove(D)}else{d.add(D)}}}else{o(E)}});var r=new n({viewer:q._viewer,sceneGraph:x});r.subscribe("BeginManipulate",C);r.subscribe("Manipulate",function(I){if(y){return}q.manipulate=true;var E=I.intersection;var L=g.getPositionFromIntersection(q._viewer,E.position,q.getAttribute("vPosition"),q._frmWindow);var K=E.position&&E.path.length;if(K){L=E.position}var G=q.getAttribute("fWidth"),M=q.getAttribute("fHeight");var F=g.getDistanceFromPixel(q._viewer,q.getAttribute("vPosition"),G,q._frmWindow);var J=g.getDistanceFromPixel(q._viewer,q.getAttribute("vPosition"),M,q._frmWindow);var H=g.getDistanceFromPixel(q._viewer,L,G,q._frmWindow);var D=g.getDistanceFromPixel(q._viewer,L,M,q._frmWindow);if(H!==F){q.setAttribute("fWidth",(G*H)/F)}if(D!==J){q.setAttribute("fHeight",(M*D)/J)}q.setAttribute("vPosition",L.clone())});r.subscribe("EndManipulate",o);this.update=function(E){if(!v){return}if(!t||JSON.stringify(E)!==JSON.stringify(t)){var H=t&&t.graphicProperties&&t.graphicProperties.fillStyle?JSON.stringify(t.graphicProperties.fillStyle):"";var G=t&&t.graphicProperties&&t.graphicProperties.lineStyle?JSON.stringify(t.graphicProperties.lineStyle):"";t=t?v.mergeParams(t,E):E;if(p===null){p=c.is3DMarkerDisplayed(q._viewer,q.getParent(),t.pointedReferences)}B.deactivate(u);s.removeChildren();if(!z||JSON.stringify(t.graphicProperties.fillStyle)!==H){z=j.createBasicMaterial({color:t.graphicProperties.fillStyle.color,opacity:t.graphicProperties.fillStyle.opacity})}if(!w||JSON.stringify(t.graphicProperties.lineStyle)!==G){w=j.createLineMaterial({color:t.graphicProperties.lineStyle.color,opacity:1,lineWidth:t.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:t.graphicProperties.lineStyle.pattern})}if(t.isFilled){var F=k.createRectangleNode({width:t.width,height:t.height,fill:true,material:z});F.setShadow(false);F.setPickParent(true);s.addChild(F)}if(t.hasBorder){var D=k.createRectangleNode({width:t.width,height:t.height,fill:false,material:w});D.setShadow(false);D.setPickParent(true);s.addChild(D)}B.activate(u);v.setVisibility(t.isVisible&&p);v.setPointHandleVisibility(r,t.inEdition,t.inEdition,q._viewer.getVisibleSpace())}s.setMatrix(new l.Matrix4().makeTranslation(-t.width/2,-t.height/2,0));v.setMatrix(new l.Matrix4().setPosition(t.position));v.highlightIfNeeded();q._viewer.render()};this.onViewerEventCB=function(D){if(D.eventType==="onHideShow"&&t.pointedReferences){p=c.is3DMarkerDisplayed(q._viewer,q.getParent(),t.pointedReferences);v.setVisibility(t.isVisible&&p);q._viewer.render()}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}});return a});define("DS/DMUPlayMarker/DMUMarker3DRectangle",["DS/DMUPlayMarker/DMUMarker3D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3DRectangleNode3D"],function(d,e,b){var c=[{name:"fWidth",type:"float",JSONname:"Properties3DRectangle.width",isOverloadable:true,defaultValue:10},{name:"fHeight",type:"float",JSONname:"Properties3DRectangle.height",isOverloadable:true,defaultValue:10},{name:"vPosition",type:"Vector3",JSONname:"Properties3DRectangle.position",isOverloadable:true,defaultValue:new e.Vector3()},{name:"sAnchor",type:"string",JSONname:"Properties3DRectangle.anchor",isOverloadable:true,defaultValue:"center"}];var a=d.extend({init:function(g,f){this._parent(g,f);this._sExpType="DMUMarker3DRectangle";this._sType="Marker3DRectangle";this._parameters=this._parameters.concat(c);this.defineMembersFromParameters();var h=this;this.buildNode=function(){if(!h._nNode){h._nNode=new b(h);h.addNodeInParentNode();h.setInEdition(false);h.refreshNode()}}},initComponent:function(f){this._parent(f);this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar")},refreshNode:function(){if(this._nNode){this._nNode.update({pointedReferences:this.getAttribute("lPointedReferences"),position:this.getAttribute("vPosition"),width:this.getAttribute("fWidth"),height:this.getAttribute("fHeight"),anchor:this.getAttribute("sAnchor"),inEdition:this.isInEdition(),isVisible:this.getAttribute("bVisible"),isFilled:this.getAttribute("bIsFilled"),hasBorder:this.getAttribute("bHasBorder"),graphicProperties:{fillStyle:{color:this.getAttribute("cFillStyleColor"),opacity:this.getAttribute("fOpacity")},lineStyle:{pattern:this.getAttribute("sLineStylePattern"),thickness:this.getAttribute("fLineStyleThickness"),color:this.getAttribute("cLineStyleColor")}}})}},setAttribute:function(f,g){if(g===false&&f==="bHasBorder"&&!this.getAttribute("bIsFilled")){this.setAttribute("bIsFilled",true);this._parent(f,g)}else{if(g===false&&f==="bIsFilled"&&!this.getAttribute("bHasBorder")){this.setAttribute("bHasBorder",true);this._parent(f,g)}else{if(f==="vPosition"||f==="fWidth"||f==="fHeight"){this._parent(f,g);this.refreshNode()}else{this._parent(f,g)}}}},getAttribute:function(f){if(f==="vPosition"){return this._parent(f).clone()}else{return this._parent(f)}},GetType:function(){return"DMUMarker3DRectangle"}});return a});define("DS/DMUPlayMarker/DMUMarker3DPolylineNode3D",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/DMUBaseUI/DMUNode3D","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/SceneGraphFactory","DS/Selection/CSOManager","DS/Manipulators/ScreenPlaneManipulator","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUPlayMarker/DMUMarkerTools"],function(h,d,a,f,g,c,e,i,b){return a.extend({init:function(k){this._parent(k);this.setName(k.getAttribute("sName"));var o=this,r=false;var m={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},p;var l=null;var q=new d();this.addChild(q);q.setPickParent(true);var t=new e();t.setExclusive(true);var n=t.linkToNode(q);this.removeDMUNode3DOverload=function(){o=q=n=t=null};function u(){r=k._checkUnderCertainCommand()}function j(w){if(r){return}k.manipulate=false;var v={pathElement:i.buildPathElement(o)};if(w&&w.event.from[0].event.ctrlKey){c.remove(v)}else{c.empty()}c.add(v)}var s=0;t.subscribe("BeginManipulate",function(v){u(v);if(r){return}s=0});t.subscribe("Manipulate",function(){if(r){return}s++});t.subscribe("EndManipulate",function(w){if(r){return}if(s<3){k.manipulate=false;var v={pathElement:i.buildPathElement(o)};if(!w.event.from[0].event.ctrlKey){setTimeout(function(){c.empty();c.add(v)})}else{if(c.isIn(v)){c.remove(v)}else{c.add(v)}}}else{j(w)}});this.update=function(y){var x;if(!o){return}if(JSON.stringify(y)!==JSON.stringify(m)){var A=m.graphicProperties&&m.graphicProperties.lineStyle?JSON.stringify(m.graphicProperties.lineStyle):"";m=m?o.mergeParams(m,y):y;if(l===null){l=b.is3DMarkerDisplayed(k._viewer,k.getParent(),m.pointedReferences)}var w=k.getPoints(true),v=[],B;for(x=0;x<w.length;x++){B=w[x].getAttribute("vPosition");if(B){v.push(B)}}if(!p||JSON.stringify(m.graphicProperties.lineStyle)!==A){p=f.createLineMaterial({color:m.graphicProperties.lineStyle.color,opacity:1,lineWidth:m.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:m.graphicProperties.lineStyle.pattern})}t.deactivate(n);q.removeChildren();for(x=0;x<w.length;x++){q.addChild(w[x]._nNode)}if(v.length>1){var z=g.createLineNode({points:v,material:p});z.setShadow(false);q.addChild(z)}t.activate(n)}o.setVisibility(y.isVisible&&l);o.highlightIfNeeded();k._viewer.render()};this.onViewerEventCB=function(v){if(v.eventType==="onHideShow"&&m.pointedReferences){l=b.is3DMarkerDisplayed(k._viewer,k.getParent(),m.pointedReferences);o.setVisibility(m.isVisible&&l);k._viewer.render()}}},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}})});define("DS/DMUPlayMarker/DMUMarker3DPolyline",["DS/DMUPlayMarker/DMUMarker3D","DS/DMUPlayMarker/DMUMarker3DPolylineNode3D","DS/DMUPlayMarker/DMUMarker3DPoint","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPImportServices"],function(e,b,c,f,a){var d=[{name:"oPoints",type:"objectDefinition",JSONname:"PropertiesMultiPoint.Points",isOverloadable:true},{name:"cFillStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.color",isOverloadable:true,defaultValue:null},{name:"bIsFilled",type:"bool",JSONname:"PropertiesMarkerBase.filled",defaultValue:null,isOverloadable:true},{name:"bHasBorder",type:"bool",JSONname:"PropertiesMarkerBase.border",defaultValue:null,isOverloadable:true},{name:"fOpacity",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.opacity",defaultValue:null,isOverloadable:true}];return e.extend({init:function(j,g){this._parent(j,g);this._sExpType="DMUMarker3DPolyline";this._sType="Marker3DPolyline";this._parameters=this._parameters.concat(d);this.defineMembersFromParameters();var k=this;this.buildNode=function(){if(!k._nNode){k._nNode=new b(k);k.addNodeInParentNode();k.refreshNode()}};var i=[];var h=new a();this.getPoints=function(p){if(p||!i.length){var o=k.getAttribute("oPoints");for(var m=0;m<i.length;m++){i[m].remove()}i.length=0;for(var n=0;n<o.length;n++){var q=f.getReviewContext({viewer:k._viewer});var l=new c(k._viewer,q);l.initComponent({context:q.getCurrentReview()});h.fillObjectAttributes(l,o[n]);l.buildNode();i.push(l)}}return i}},refreshNode:function(){if(this._nNode){this._nNode.update({pointedReferences:this.getAttribute("lPointedReferences"),points:this.getAttribute("oPoints"),isVisible:this.getAttribute("bVisible"),graphicProperties:{lineStyle:{thickness:this.getAttribute("fLineStyleThickness"),pattern:this.getAttribute("sLineStylePattern"),color:this.getAttribute("cLineStyleColor")}}})}},GetType:function(){return"DMUMarker3DPolyline"}})});define("DS/DMUPlayMarker/DMUMarker3DLine",["DS/DMUPlayMarker/DMUMarker3DPolyline"],function(a){var b=a.extend({init:function(d,c){this._parent(d,c);this._sExpType="DMUMarker3DLine";this._sType="Marker3DLine"},initComponent:function(c){this._parent(c);this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar")},GetType:function(){return"DMUMarker3DLine"}});return b});