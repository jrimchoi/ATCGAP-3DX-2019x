define("DS/AppFrameGlobal/transition/TransitionDecision",[],function(){var a=function(){};a.prototype.execute=function(c,b){throw new Error("Not implemented")};a.extend=function(b){b.prototype=Object.create(a.prototype,{constructor:{value:b,enumerable:false}})};return a});define("DS/AppFrameGlobal/model/Container",[],function(){function b(c,d){c.currentIndex=d}var a=function(c){this.id=c.id;this.contexts=c.contexts||[];this.currentIndex=c.currentIndex===undefined?-1:c.currentIndex};a.prototype.getId=function(){return this.id};a.prototype.getContexts=function(){return this.contexts};a.prototype.getCurrentContext=function(){if(this.currentIndex<0){return null}return this.contexts[this.currentIndex]};a.prototype.getCurrentApp=function(){var c=this.getCurrentContext();if(!c){return null}return c.getCurrentApp()};a.prototype.addExecutionContext=function(d,c){this.contexts.push(d);if(c){b(this,this.contexts.length-1)}};a.prototype.setCurrentContextIndex=function(c){if(c>=this.contexts.length){throw new Error("The index "+c+"is out of bound > "+this.contexts.length)}if(c<0){c=-1}b(this,c)};a.prototype.toString=function(){return"{\n\tid:"+this.id+",\n\t contexts :"+this.contexts+",\n\t currentIndex :"+this.currentIndex+"\n}"};return a});define("DS/AppFrameGlobal/model/FrameContext",[],function(){function a(c,d){c.currentIndex=d}var b=function(c){this.containers=[];this.currentIndex=-1};b.prototype.getContainers=function(){return this.containers};b.prototype.getCurrentContainer=function(){if(this.currentIndex<0){return null}return this.containers[this.currentIndex]};b.prototype.getCurrentExecutionContext=function(){var c=this.getCurrentContainer();if(!c){return null}var d=c.getCurrentContext();return d};b.prototype.getCurrentApp=function(){var c=this.getCurrentExecutionContext();if(!c){return null}return c.getCurrentApp()};b.prototype.indexOfContainer=function(f){var e=this.getContainers();for(var d=0;d<e.length;d++){var c=e[d];if(c.getId()==f){return d}}return -1};b.prototype.addContainer=function(d,c){this.containers.push(d);if(c){a(this,this.containers.length-1)}};b.prototype.setCurrentContainerIndex=function(c){if(c>=this.containers.length){throw new Error("The index "+c+"is out of bound > "+this.containers.length)}if(c<0){c=-1}a(this,c)};b.prototype.getContextOfApp=function(d){var c=this.getContainerOfApp(d);if(c){return c.getCurrentContext()}return null};b.prototype.getContainerOfApp=function(g){var f=this.containers;for(var e=0;e<f.length;e++){var c=f[e];var d=c.getCurrentApp();if(d&&d.getId()==g){return c}}return null};b.prototype.forEachContext=function(h){if(!h){return}var g=this.containers;for(var d=0;d<g.length;d++){var c=g[d];var j=c.getContexts();for(var f=0;f<j.length;f++){var e=j[f];h(e)}}};b.prototype.toString=function(){return"{\n\tcontainers :"+this.containers+",\n\t currentIndex :"+this.currentIndex+"\n}"};return b});var AppFramemod_WafData="DS/WAFData/WAFData";define("DS/AppFrameGlobal/DelegateFrame",["UWA/Data",AppFramemod_WafData,"UWA/Class/Promise","DS/WebappsUtils/WebappsUtils"],function(e,b,d,g,c){var a=function(){};a.WAFData=b;a.prototype.requestJson=function(h){return new d(function(j,i){b.request(h,{type:"json",responseType:"json",onComplete:function(k){j(k)},onFailure:i})})};a.prototype.requestWebService=function(h){return new d(function(j,i){b.proxifiedRequest(h,{type:"json",responseType:"json",onComplete:function(k){j(k)},onFailure:i})})};a.prototype.requestPostWebService=function(h,i){return new d(function(k,j){b.proxifiedRequest(h,{type:"json",method:"POST",data:i,responseType:"json",onComplete:function(l){k(l)},onFailure:j})})};a.prototype.loadIdCard=function(k,j){var h=k.getConfigUrl();if(h.endsWith(".json")){var i=this;return this.requestJson(h).then(function(n){if(n.afrService){var l="";if(!n.afrServiceUrl||n.afrServiceUrl===""){if((n.appId).indexOf("SWX")>-1){l=h}else{l=g.getWebappsBaseUrl()}var m=l.split(":");if(m.length>=2){l=m[0]+":"+m[1]}}else{l=n.afrServiceUrl}if(n.afrServicePort){l+=":"+n.afrServicePort}l+="/"+n.afrService+n.appId;if(typeof j==="string"&&j!==""){l=l+"?lang="+j}return i.requestWebService(l)}return d.resolve(n)})}else{return this.requestWebService(configUrl)}};function f(j){if(j.afrService){var h="";if(!j.afrServiceUrl||j.afrServiceUrl===""){h=g.getWebappsBaseUrl();var i=h.split(":");if(i.length>=2){h=i[0]+":"+i[1]}}else{h=j.afrServiceUrl}if(j.afrServicePort){h+=":"+j.afrServicePort}h+="/"+j.afrService.replace("/apps","/transitions")+j.appId;return h}return undefined}a.prototype.requestTransitionWebService=function(k){var i=k.getConfigUrl();var h;var j=this;if(k.getServiceInfo()){h=f(k.getServiceInfo());if(h){return this.buildFrameContext().then(function(l){return j.requestPostWebService(h,l)})}else{throw new Error("No find afrService in the config json ->"+i)}}else{if(i.endsWith(".json")){return d.all(this.requestJson(i),this.buildFrameContext()).then(function(l){var n=l[0];var m=l[1];h=f(n);if(h){k._serviceInfo=n;return j.requestPostWebService(h,m)}else{throw new Error("No find afrService in the config json ->"+i)}})}}throw new Error("The app "+k+" must provide a valid config url which must point to a json declaring where to find the service")};a.prototype.buildFrameContext=function(){if(this.options.success){this.options.success(new FrameContext())}throw new Error("This call must be implemented by sub class")};a.prototype.onTransitionSuccessful=function(h){throw new Error("This call must be implemented by sub class")};a.prototype.createContainer=function(h){log("Create container of apps ** To overrride");if(errorCallback){errorCallback.call()}throw new Error("This call must be implemented by sub class")};a.prototype.publish=function(h,i){throw new Error("This call must be implemented by sub class")};a.prototype.subscribe=function(h,i){throw new Error("This call must be implemented by sub class")};a.prototype.unsubscribe=function(h){throw new Error("This call must be implemented by sub class")};a.prototype.getCurrentLanguage=function(){return c&&c.getCurrentLanguage()};return a});define("DS/AppFrameGlobal/model/App",["UWA/Core"],function(d){var c="AppFrameContainer/container.html";var b="WAfrContainerAsWidget/container.html";var a=function(f){var e={id:null,title:null,brand:null,url:null,configUrl:null};this.options=e;this.options=d.extend(d.clone(this.options),f)};a.prototype.getId=function(){return this.options.id};a.prototype.getTitle=function(){return this.options.title};a.prototype.getBrand=function(){return this.options.brand};a.prototype.getUrl=function(){return this.options.url};a.prototype.getBaseUrl=function(){var e=this.options.url.indexOf(c);if(!e){e=this.options.url.indexOf(b)}if(e){return this.options.url.substring(0,e)}return undefined};a.prototype.getConfigUrl=function(){return this.options.configUrl};a.prototype.getAppConfig=function(){return this.options.appConfig};a.prototype.getFamily=function(){return this.options.appConfig&&this.options.appConfig.afrFamily};a.prototype.setAppConfig=function(e){this.options.appConfig=d.extend(this.options.appConfig||{},e)};a.prototype.getServiceInfo=function(){if(this._serviceInfo===undefined){var h="?afrWebService";var e=this.getUrl();var l=e.indexOf(h);if(l>0){var j=e.substring(l+h.length,e.length);var m=j.split("/");var f=null;var n={protocol:"",host:"",port:"8080",service:null,appId:""};for(var g=0;g<m.length;g++){f=m[g].split(":");if(f.length===2){n[f[0]]=f[1]}}var k=n.service?n.service+"/wafr/apps/":"";if(n.protocol&&n.host){k=n.protocol+"://"+n.host+":"+n.port+"/"+k}this._serviceInfo={afrService:k,afrServicePort:n.port,appId:n.appId}}else{this._serviceInfo=null}}return this._serviceInfo};a.prototype.supportTransition=function(){return this.options.url.endsWith(c)||this.isNewInfra()};a.prototype.isNewInfra=function(){return this.options.url.indexOf(b)>=0};a.prototype.toString=function(){return"{\n\tid:"+this.options.id+", \n\ttitle :"+this.options.title+"\n}"};return a});define("DS/AppFrameGlobal/model/ExecutionContext",[],function(){var a=function(c,b){this.id=c;this.currentApp=b};a.prototype.getId=function(){return this.id};a.prototype.getCurrentApp=function(){return this.currentApp};a.prototype.toString=function(){return"{\n\tid:"+this.id+",\n\t currentApp :"+this.currentApp+"\n}"};return a});define("DS/AppFrameGlobal/transition/CreateNewContainer",["DS/AppFrameGlobal/transition/TransitionDecision","UWA/Class/Promise"],function(c,a){var b=function(d){this.containerId=d};c.extend(b);b.prototype.getContainerId=function(){return this.containerId};b.prototype.execute=function(d){return a.reject(new Error("Transition is not possible"))};return b});define("DS/AppFrameGlobal/transition/ReuseContext",["UWA/Core","DS/AppFrameGlobal/transition/TransitionDecision"],function(c,b){var a=function(d){this.options=d||{}};b.extend(a);a.prototype.getContextId=function(){return this.contextId};a.prototype.execute=function(f,d){var e=this;return new c.Class.Promise(function(k,j){var l=e.options.contextId;var m=d.getAppConfig();if(!l){if(e.options.of){var h=f.frameContext.getContextOfApp(e.options.of);l=h.getId()}if(!l){var g=f.frameContext.getCurrentExecutionContext();if(!g){j(new Error("Cannot reuse the current context cause it do not exist "))}l=g.getId()}}if(!l){j(new Error("The id of the current context is null ! "))}var i=m;i.baseUrl=d.getBaseUrl();i.brand=d.options.brand;f.delegateFrame.publish("onReuseContext."+l,i)})};return a});define("DS/AppFrameGlobal/transition/CreateNewContext",["DS/AppFrameGlobal/transition/TransitionDecision","DS/AppFrameGlobal/transition/CreateNewContainer"],function(c,b){var a=function(d){this.options=d};c.extend(a);a.prototype.getContainerId=function(){return this.containerId};a.prototype.execute=function(g,f){var e=null;if(this.options.of){var d=g.frameContext.getContainerOfApp(this.options.of);if(d){e=d.getId();var h=f.getId();g.delegateFrame.publish("onCreateContext."+e,f.getAppConfig());return UWAPromise.resolve()}}return b.prototype.execute.call(this,g,f)};return a});define("DS/AppFrameGlobal/transition/ErrorDecision",["DS/AppFrameGlobal/transition/TransitionDecision"],function(b){var a=function(c){this.messageId=c};b.extend(a);a.prototype.execute=function(d,c){alert("Error during transition");return UWA.Class.Promise.reject()};return a});define("DS/AppFrameGlobal/AppFrame",["UWA/Core","UWA/Data","UWA/Class","UWA/Class/Promise","UWA/Utils","WebappsUtils/WebappsUtils","DS/AppFrameGlobal/model/App","DS/AppFrameGlobal/model/Container","DS/AppFrameGlobal/model/ExecutionContext","DS/AppFrameGlobal/model/FrameContext","DS/AppFrameGlobal/DelegateFrame","DS/AppFrameGlobal/transition/CreateNewContainer","DS/AppFrameGlobal/transition/CreateNewContext","DS/AppFrameGlobal/transition/ErrorDecision","DS/AppFrameGlobal/transition/ReuseContext"],function(j,g,s,h,d,i,p,o,u,q,c,e,k,t,m){window.performance.mark=window.performance.mark||function(){};window.performance.measure=window.performance.measure||function(){};var f=window.location.href.indexOf("debug")>=0;var w=5*60*1000;var v={};v.log=function(x){if(f){console.log("[Afr]"+x)}};v.warn=function(x){if(f){console.warn("[Afr]"+x)}};v.severe=function(x){if(f){console.error("[Afr]"+x)}};v.inherit=function(y,x){y.prototype=Object.create(x.prototype,{constructor:{value:y,enumerable:false}})};v.App=p;v.FrameContext=q;v.FrameContext.ExecutionContext=u;v.FrameContext.Container=o;v.DelegateFrame=c;v.TransitionDecision=Object.create(null);v.TransitionDecision.ErrorDecision=t;v.TransitionDecision.CreateNewContext=k;v.TransitionDecision.CreateNewContainer=e;v.TransitionDecision.ReuseContext=m;var b={type:"CreateNewContext"};function a(C,B){if(!C){throw (new Error("Must define a transition"))}var x=C.type;if(!x){throw (new Error("No defined a type"))}var A=v.TransitionDecision[x];if(!A){throw (new Error("No type "+x+" do not exist"))}var z=j.clone(C);delete z.type;var y=new A(z);return y}var n=a(b);var l=function(x){this.delegateFrame=x;if(!this.delegateFrame){throw new Error("Need to provide a delegate Frame")}if(!(this.delegateFrame instanceof v.DelegateFrame)){throw new Error("Not a valid delagate Frame")}this._apps={};this.frameContext=null;this._currentTransition=false};l.prototype.doTransition=function(x){if(this._currentTransition){return h.reject()}if(!x){return h.reject()}if(!x.supportTransition()){v.warn("The target app "+x+" do not support the Afr transition");return h.reject(new Error("The target app "+x+" do not support the Afr transition"))}var y=this;var z=x.getId();if(!z){return h.reject(new Error("The target app "+x+" do not have a valid id"))}window.performance.mark("WAfrGlobalAppFrame_doTransition_"+z);y._currentTransition=true;return new h(function(E,D){var B=function(H){y.delegateFrame.unsubscribe("onAppReady."+z);y.delegateFrame.unsubscribe("onAppFail."+z);y._currentTransition=false;window.performance.mark("WAfrGlobalAppFrame_doTransitionFailure_"+z);window.performance.measure("WAfrGlobalAppFrame_TotalTransition_Failure_"+z,"WAfrGlobalAppFrame_doTransition_"+z,"WAfrGlobalAppFrame_doTransitionFailure_"+z);D(H)};var G=setTimeout(function(){B(new Error("Timeout reaches for a transition !"))},w);var F=function(H){if(!y._currentTransition){return}y.delegateFrame.unsubscribe("onAppReady."+z);y.delegateFrame.unsubscribe("onAppFail."+z);H.targetApp=x;y.delegateFrame.onTransitionSuccessful(H);y._currentTransition=false;window.performance.mark("WAfrGlobalAppFrame_doTransitionSuccess_"+z);window.performance.measure("WAfrGlobalAppFrame_TotalTransition_"+z,"WAfrGlobalAppFrame_doTransition_"+z,"WAfrGlobalAppFrame_doTransitionSuccess_"+z);window.clearTimeout(G);E()};var C=function(H){B(H);window.clearTimeout(G)};if(x.getServiceInfo()){y.delegateFrame.requestTransitionWebService(x).then(function(H){if(H.error){v.severe("Failed to execute the transition :\n"+H.error.message);return B(new Error(H.error))}y.delegateFrame.subscribe("onAppReady."+z,F);y.delegateFrame.subscribe("onAppFail."+z,B);var I=a(H);x.setAppConfig(H.targetAppIdCard);return I.execute(y,x)},B);return}var A="";if(j&&j.Widgets&&j.Widgets.instances&&Array.isArray(j.Widgets.instances)&&j.Widgets.instances.length>0){A=j.Widgets.instances[0].lang}else{console.error("cannot compute language")}h.all([y._loadAppIdCard(x,A),y.delegateFrame.buildFrameContext()]).then(function(H){var I=H[0];var J=H[1];y.delegateFrame.subscribe("onAppReady."+z,F);y.delegateFrame.subscribe("onAppFail."+z,B);var K=y._computeTransitionDecisionFrom(x,I,J);return K.execute(y,x)},C).then(function(){},C)["catch"](C)})};l.prototype._loadAppIdCard=function(y,z){var x=this._apps[y.getId()];if(x){y.setAppConfig(x);return h.resolve(x)}else{return this.delegateFrame.loadIdCard(y,z)}};l.prototype._computeTransitionDecisionFrom=function(A,C,z){C.appId=A.getId();C.title=A.getTitle();A.setAppConfig(C);this.frameContext=z;if(this.frameContext.getContainers().length===1){this.frameContext.setCurrentContainerIndex(0)}var B=null;var x=this.frameContext.getCurrentContainer();var y=x?x.getCurrentApp():null;if(x&&!y){return h.reject(new Error("Found a current container but no compatible app, reject the transition"))}v.log("Compute Transition From "+(y?y.getId():"None App")+" to "+A.getId());if(y){B=this._computeTransitionDecisionBetween(y,A)}else{B=this._computeNonAmbiguousTransition(A)}if(!B){throw (new Error("No found transition decision !"))}return B};l.prototype._computeTransitionDecisionBetween=function(x,z,y){var A=this._computeTransitionTypeBetween(x,z,y);if(!A){return null}return a(A,this.frameContext)};l.prototype._computeTransitionTypeBetween=function(x,z,y){if(!z){return null}if(!x){return b}var D=z.getAppConfig().afrTransitionsFrom||{};var C=x.getAppConfig().afrTransitionsTo;var B;if(C){var A=C[z.getId()];if(A===undefined){B=z.getFamily();if(B&&z.getAppConfig().afrTransitionsToFamily){A=z.getAppConfig().afrTransitionsToFamily[B]}}if(A!==undefined&&A===false){v.warn("The app "+x+" refuse to transit to "+z);return b}}if(!D&&y){return null}if(!D){return b}var E=null;B=x.getFamily();E=D[x.getId()];if(B&&!E){E=z.getAppConfig().afrTransitionsFromFamily[B]}if(!E&&!y){E=D._default_;if(!E){v.log("There is no default transition so create a new container");return b}}if(!E){return null}return E};l.prototype._computeNonAmbiguousTransition=function(y){var A=y.getAppConfig().afrTransitionsFrom||{};if(!A){return n}var x=[];var z=this;v.log("[AppFrame] Deduct transition to "+y.getAppConfig().appId);this.frameContext.forEachContext(function(D){if(!D){return}var F=D.getCurrentApp();if(!F){return}var C=z._computeTransitionTypeBetween(F,y,true);var E=j.clone(C);v.log("[AppFrame] Transition From "+F.getId()+" -> "+JSON.stringify(E||{}));if(E){x.push(E);E.of=F.getId()}});if(x.length>1){v.warn("[AppFrame] Ambiguous transition");throw (new Error("To Many apps to decide the correct transition"))}var B=null;if(x.length>0){B=x[0]}else{B=A._default_;if(!B){v.log("There is no default transition so create a new container");return n}}return a(B,this.frameContext)};var r=s.extend({init:function(x){this._frame=new l(x)},doTransition:function(x){return this._frame.doTransition(x)}});v.Frame=r;return v});window.performance.mark("AFR_AppFrameGlobal_AppFrame3DD");define("DS/AppFrameGlobal/AppFrame3DD",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/AppFrameGlobal/AppFrame","DS/PlatformAPI/PlatformAPI"],function(g,b,c,f,a){var d=function(){};f.inherit(d,f.DelegateFrame);d.prototype.getCurrentTabId=function(){window.performance.mark("AFR_AppFrameGlobal_AppFrame3DD_getCurrentTabId");window.performance.measure("AppFrame3DD_getCurrentTabId","AFR_AppFrameGlobal_AppFrame3DD_getCurrentTabId");f.log("AppFrame3DD::getCurrentTabId Enter");var m=undefined;var l,k,h;l=g.Widgets.instances||[];var j=l.length;f.log("AppFrame3DD::getCurrentTabId instance = "+j);for(k=0;k<j;k++){h=l[k];if(h.data!==undefined){f.log("AppFrame3DD::getCurrentTabId instance.data = "+JSON.stringify(h.data));if(h.data.module!==undefined){f.log("AppFrame3DD::getCurrentTabId instance.data.module = "+JSON.stringify(h.data.module));if(h.data.module==="DS/Dashboard/Layout/Dashboard"){f.log("AppFrame3DD::getCurrentTabId instance.data.module = DS/Dashboard/Layout/Dashboard = ");if((h.layout!==undefined)&&(h.layout.selectedTab!==undefined)&&(h.layout.selectedTab.options!==undefined)){m=h.layout.selectedTab.options.id;f.log("AppFrame3DD::getCurrentTabId Id current Tab = "+h.layout.selectedTab.options.id);break}}}}}f.log("AppFrame3DD::getCurrentTabId End oId = "+m);return m};d.prototype.onTransitionSuccessful=function(){};d.prototype._createContainerFromWidget=function(h,n){var j=new f.FrameContext.Container({id:h});var l=n.afrExecutionContexts;if(l){for(var o=0;o<l.length;o++){var q=l[o];var m=new f.App({id:n.afrAppId,appConfig:n});var k=new f.FrameContext.ExecutionContext(q.id,m);j.addExecutionContext(k)}var p=n.afrCurrentExecutionContextIdx;f.log("[AppFrame3DD] Widget "+h+" -> "+JSON.stringify(l));j.setCurrentContextIndex(Math.max(l.length-1,p))}return j};d.prototype.buildFrameContext=function(){f.log("AppFrame3DD::buildFrameContext Start");var m=new f.FrameContext();var j=this.getCurrentTabId();var l=g.Widgets.instances||[];var k,n,h,i;l.forEach(function(o){n=o._view||{};k=o.getValue("appId");if(k){i=n.type==="maximized";if(o.context===j||(i&&o.context===undefined)){f.log("AppFrame3DD::buildFrameContext add container (widget) = "+o);var p={afrAppId:o.getValue("afrAppId"),afrCode:o.getValue("afrCode"),afrCurrentExecutionContextIdx:o.getValue("afrCurrentExecutionContextIdx"),afrExecutionContexts:o.getValue("afrExecutionContexts"),afrFamily:o.getValue("afrFamily"),afrTransitionsFrom:o.getValue("afrTransitionsFrom"),afrTransitionsFromFamily:o.getValue("afrTransitionsFromFamily"),afrTransitionsTo:o.getValue("afrTransitionsTo"),afrVersion:o.getValue("afrVersion")};h=this._createContainerFromWidget(o,p);m.addContainer(h);if(!m.getCurrentContainer()&&i){m.setCurrentContainerIndex(m.containers.length-1)}}}}.bind(this));f.log("AppFrame3DD::buildFrameContext End");return c.resolve(m)};d.prototype.createContainer=function(){f.log("AppFrame3DD:createContainer");return c.reject()};d.prototype.publish=function(h,i){a.publish(h,i)};d.prototype.subscribe=function(h,i){a.subscribe(h,i)};d.prototype.unsubscribe=function(h){a.unsubscribe(h)};var e=f.Frame.singleton({init:function(){this._parent(new d())},loadAppInfoAndDoTransition:function(h){window.performance.mark("AFR_AppFrameGlobal_AppFrame3DD_loadAppInfoAndDoTransition");window.performance.measure("AppFrame3DD_loadAppInfoAndDoTransition","AFR_AppFrameGlobal_AppFrame3DD_loadAppInfoAndDoTransition");f.log("ApplicationFrame:loadAppInfoAndDoTransition = "+JSON.stringify(h));var j=this;var i=new f.App({url:h.launchInfos,id:h.id,title:h.title,configUrl:h.config,brand:h.brand});h.targetApp=i;f.log("ApplicationFrame:loadAppInfoAndDoTransition targetApp = "+JSON.stringify(i));j.doTransition(h.targetApp).then(h.success,h.failure);f.log("ApplicationFrame:loadAppInfoAndDoTransition End doTransition")}});return e});