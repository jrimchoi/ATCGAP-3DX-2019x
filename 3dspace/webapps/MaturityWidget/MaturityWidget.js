define("DS/MaturityWidget/MultiselUI",["css!DS/MaturityWidget/MaturityWidget","UWA/Controls/Abstract","DS/LifecycleServices/LifecycleObjectList","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","text!DS/LifecycleWidget/assets/MaturityStatePriority.json",],function(e,d,c,b,a){return d.extend({isPromotePayload:true,create:function(j,k,r){var m=this;this.model=j;this.setTitle=r;var s=this.model.getObjects();this.container=UWA.createElement("div");this.container.inject(k);var f=this.promotion={};var g={};var n=[];this._prepareAndSort(s,f,g,n);if(n.length>0){var l=document.createElement("p");l.textContent=b.changeMaturityTo;l.style.display="inline";this.container.appendChild(l)}if(n.length>=1){this._createStateSelCombo(f,g,n)}else{if(n.length===1){var p=n[0];this.toState=p;var o=document.createElement("p");o.textContent=g[p].stateUserName;o.style.display="inline";this.container.appendChild(o)}else{var q=UWA.createElement("p",{text:b.noAvailTransition,"class":"maturity-info-msg"});this.container.appendChild(q);return false}}var i=document.createElement("p");i.textContent=b.stateQ;i.style.display="inline";this.container.appendChild(i);this.objectListDiv=UWA.createElement("div",{"class":"maturity-objectList"});this.objectsList=new c({className:"objectlist-Revise",showTypeColumn:true,showRevisionColumn:true,showMaturityColumn:true});this.objectsList.inject(this.objectListDiv);this.objectListDiv.inject(this.container);this.objectListDiv.hide();this.objectsList.objectsTable.resizeTable();var h=this._getUpdatedObjectsForState(f,this.toState);this._updateObjectListUI(f,h);this.onPanelResize();return true},getPromotePayload:function(){var g=this.toState;var f=[];this.promotion[g].forEach(function(i){if(!i.excludeFromPromote&&!i.isDemote){f.push({physicalid:i.phid,tostate:g,fromstate:i.fromstate})}});var h={};h.data=f;return h},getDemotePayload:function(){var g=this.toState;var f=[];this.promotion[g].forEach(function(i){if(!i.excludeFromPromote&&i.isDemote){f.push({physicalid:i.phid,tostate:g,fromstate:i.fromstate})}});var h={};h.data=f;return h},onPanelResize:function(){var j=this;if(this.objectsList!==undefined&&this.objectsList!==null){if(this.objectsList.objectsTable!==undefined&&this.objectsList.objectsTable!==null){this.objectsList.objectsTable.resizeTable();var i=document.querySelectorAll("div.command_dialog.floatingPanelComponent.modal.modal-root.modal.modal-root.fade.in");if(i!==undefined&&i!==null&&i.length>0){var g=i[0].getSize();var f=document.querySelectorAll("div.accordion-item.active");if(f!==undefined&&f!==null&&f.length>0){var h=f[0].querySelectorAll('div.DivSSTableBody.objectlist-ReviseBody[data-rec-id="dataRecSSTable2"] div.no-native-scrollbars.scroller-content');if(h!==undefined&&h!==null&&h.length>0){var k=(g.height)-270;if(k>0){h[0].style.height=k+"px"}}}}}}},_createObjectForList:function(f){return{physicalid:f,name:this.model.getAttribute(f,"name"),revision:this.model.getAttribute(f,"revision"),type:this.model.getAttribute(f,"typeDisplayName"),current:this.model.getAttribute(f,"currentStateUserName"),imageUrl:this.model.getAttribute(f,"imageUrl"),policy:this.model.getAttribute(f,"policy")}},_getUpdatedObjectsForState:function(j,h){var f=this;var g=[];var k;var i=this.toState;if(j[this.toState]){j[this.toState].forEach(function(m){var q=this._createObjectForList(m.phid);var t=q.physicalid;var r=f.model.objects[t];if(r.hasOwnProperty("coretype")&&r.coretype=="Entity"){var o=this.model.maturityGraphs[q.policy];if(o.states!==undefined&&o.states!==null&&o.hasOwnProperty("states")){k=o.states}var s=m.fromstate;for(var l in k){var u=k[l];if(u!==undefined&&u!==null&&u.hasOwnProperty("info")){var n=u.info;if(n!==undefined&&n!==null&&n.hasOwnProperty("stateUserName")&&n.hasOwnProperty("visuorder")){if(n.stateSysName==m.fromstate){if(k[i].info.visuorder<n.visuorder){m.isDemote=true}else{m.isDemote=false}break}}}}}g.push(q)},this)}return g},_createStateSelCombo:function(k,g,h){var i=this;var j=document.createElement("select");j.style.display="inline";this.container.appendChild(j);j.addEventListener("change",function(){i.toState=this.value;var l=i._getUpdatedObjectsForState(k,this.value);i._updateObjectListUI(k,l)});var f=true;h.forEach(function(m){if(f===true){i.toState=m}f=false;var l=document.createElement("option");l.value=m;l.textContent=g[m].stateUserName;j.appendChild(l)})},_updateObjectListUI:function(g,f){if(this.objectsList!==null){this.objectsList.setObjects(f);this.setTitle(b.maturity+" - "+g[this.toState].length+" "+b.Objects);this.objectListDiv.show()}},_prepareAndSort:function(u,g,l,p){var s=JSON.parse(a);var j=[];for(var o in u){var h=u[o].current;var q=this.model.getPolicy(u[o].policy);var r=q.maturityGraph.transitions;var t=q.maturityGraph.states;var n=u[o].current;if(u[o].coretype=="Entity"){var k=r.length;for(var m=0;m<k;m++){if(r[m].sourceState!="Obsolete"&&r[m].targetState!="Obsolete"){r.push({targetState:r[m].sourceState,sourceState:r[m].targetState,signatures:r[m].signatures})}}}var f=u[o].excludeFromPromote;r.forEach(function(x){if(x.sourceState===h){var v=x.targetState;t.forEach(function(y){if(y.stateSysName===v){l[v]={};l[v].stateUserName=y.stateUserName}});var w={phid:o,excludeFromPromote:f,fromstate:n,};if(p.indexOf(v)===-1){var i=0;if(s.hasOwnProperty(v)){i=s[v].priority}j.push({name:v,priority:i});p.push(v);g[v]=[w]}else{if(g[v].findIndex(function(y){return y.phid==w.phid})===-1){g[v].push(w)}}}});j.sort(function(v,i){if(v.name==i.name){return 0}if(v.priority>i.priority){return 1}if(v.priority<i.priority){return -1}return 0});p.length=0;j.forEach(function(i){p.push(i.name)})}}})});define("DS/MaturityWidget/MaturityModel",["UWA/Controls/Abstract","DS/LifecycleServices/LifecycleServicesSettings","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(d,b,c){var a=d.extend({isSingleIRPCAssembly:false,init:function(){this.clear()},clear:function(){this.maturityGraphs={};this.objects={};this.policies={}},getAttribute:function(f,e){if(this.objects[f]!==undefined){return this.objects[f][e]}else{return undefined}},getAttributes:function(e){return this.objects[e]},setAttributes:function(f,e){this.objects[f]=e},setAttribute:function(g,f,e){if(this.objects[g]!==undefined){this.objects[g][f]=e}},setObjects:function(f){for(var e=0;e<f.length;e++){this.objects[f[e].physicalid]={}}},getObjects:function(){return this.objects},changeCurrentObjectState:function(e,h){var g=this.objects[e];if(!g){return}g.current=h;if(!g.maturityGraph){if(this.getMaturityGraph(g.policy)){var f=this.getMaturityGraph(g.policy).states[h];if(f){g.currentStateUserName=f.info.stateUserName}}return}if(!g.maturityGraph.states){return}g.maturityGraph.states.forEach(function(i){if(i.stateSysName===h){i.isCurrent=true;g.currentStateUserName=i.stateUserName}else{i.isCurrent=false}})},setMaturityGraph:function(v){this.clear();if(v.data.policies.length==0){console.log("ERROR: No policies in json");var o={};o.errorMsg=c.maturityGraphFailed;o.type="error";that.dispatchEvent("onError",o)}else{this.policies=v.data.policies;var s=false;for(var B=0;B<v.data.objects.length;B++){var h=v.data.objects[B].physicalid;var r=v.data.objects[B];this.objects[h]=r;this.objects[h].signatures={};this.objects[h].routes={};if(this.objects[h].isSingleIRPCAssembly!==undefined&&this.objects[h].isSingleIRPCAssembly!==null&&this.objects[h].hasOwnProperty("isSingleIRPCAssembly")){s=s||this.objects[h].isSingleIRPCAssembly}if(this.objects[h].hasOwnProperty("imageUrl")&&this.objects[h].imageUrl!==undefined&&this.objects[h].imageUrl!==null){var x=this.objects[h].imageUrl;if(x.startsWith("/")){this.objects[h].imageUrl=b.get3DSpaceBaseUrl(window.widget.getValue("x3dPlatformId"))+x}}this.objects[h].excludeFromPromote=r.isAggregateRep!=null&&r.isAggregateRep;if(!this.objects[h].excludeFromPromote){if((r.usage!=null&&r.usage=="3DPart")&&(r.isOnceInstantiable!=null&&r.isOnceInstantiable)){this.objects[h].excludeFromPromote=true}}var q=0;for(q=0;q<this.policies.length;q++){if(this.policies[q].name===r.policy){break}}var E=this.policies[q].maturityGraph.transitions;var n=this.policies[q].maturityGraph.states;for(var z=0;z<n.length;z++){if(n[z].isCurrent===true){this.setAttribute(h,"current",n[z].stateSysName)}this.objects[h].signatures[n[z].stateSysName]={};this.objects[h].routes[n[z].stateSysName]={}}for(var C=0;C<E.length;C++){var y=E[C].sourceState;var F=E[C].targetState;var A=E[C].signatures;this.objects[h].routes[y][F]=E[C].hasRoute;var e={};for(var D=0;D<A.length;D++){e[A[D].name]=A[D]}this.objects[h].signatures[y][F]=e}var u=r.policy;if(this.maturityGraphs[u]===undefined){var g={};for(var D=0;D<n.length;D++){var m=n[D].stateSysName;var f={connectors_out:{},connectors_in:{},info:{}};for(var C=0;C<E.length;C++){var y=E[C].sourceState;var F=E[C].targetState;if(y===m){f.connectors_out[F]={}}if(F===m){f.connectors_in[y]={}}}f.info=n[D];g[m]=f}var p=0;for(var D=0;D<n.length;D++){var m=n[D].stateSysName;if(typeof g[m]!=="undefined"){g[m].info.visuorder=p;p++}}this.maturityGraphs[u]={};this.maturityGraphs[u].states=g;this.maturityGraphs[u].infos={};var t=this.objects[h].coretype;var w=this.objects[h].isOnceInstantiable;this.maturityGraphs[u].infos.isPromoteAuthorized=false;this.maturityGraphs[u].infos.isDemoteAuthorized=false;if(t==="Entity"){this.maturityGraphs[u].infos.isDemoteAuthorized=true}if(t==="Entity"||(t==="Reference"&&!w)){this.maturityGraphs[u].infos.isPromoteAuthorized=true}}else{if(!this.maturityGraphs[u].infos.isPromoteAuthorized){var t=this.objects[h].coretype;var w=this.objects[h].isOnceInstantiable;if(t==="Entity"||(t==="Reference"&&!w)){this.maturityGraphs[u].infos.isPromoteAuthorized=true}}}}this.isSingleIRPCAssembly=s}},getMaturityGraph:function(e){return this.maturityGraphs[e]},getPolicy:function(f){for(var e=0;e<this.policies.length;e++){if(this.policies[e].name===f){return this.policies[e]}}},getAllStates:function(){var e=[];for(var h in this.maturityGraphs){if(this.maturityGraphs.hasOwnProperty(h)){var g=this.getMaturityGraph(h);for(var f in g.states){if(g.states.hasOwnProperty(f)){e.push(f)}}}}return e}});return a});define("DS/MaturityWidget/MaturityGraph",["UWA/Controls/Abstract","DS/LifecycleCmd/Dictionary","DS/LifecycleControls/AdaptiveLayout","DS/LifecycleServices/Utils","DS/UIKIT/Mask","DS/UIKIT/Tooltip","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(g,c,f,d,b,a,e){return g.extend({pendingUpdate:false,create:function(i,h){this.pendingTransition=false;this._injectHTML(i,h);this._setupAdaptiveUI(i)},destroy:function(){if(this!==undefined&&this!==null){if(this.adaptiveLayout!==undefined&&this.adaptiveLayout!==null){this.adaptiveLayout.stop();this.adaptiveLayout=null}if(this.SVG_container!==undefined&&this.SVG_container!==null){this.SVG_container.destroy();this.SVG_container=null}if(this.state_container!==undefined&&this.state_container!==null){this.state_container.destroy();this.state_container=null}this.paths=[];this.stateToElement=null}},updateGraph:function(h){this._updateStateElements(h);if(!this.pendingUpdate){this.pendingUpdate=true;this._deleteConnectors();this._createConnectors(h);this.adaptiveLayout.restart(["active-path","inactive-path"]);this._drawConnectors();this.pendingUpdate=false}},onStartTransition:function(h){this.pendingTransition=true;this._enableStateElements(false);var i=this.stateToElement.find(h);if(i){this.changeToMasked=i.element;this.changeToMasked.addClassName("lcm-state-pulse");b.mask(this.changeToMasked,"")}this._animatePath(h,false)},onEndTransition:function(h){this.pendingTransition=false;if(this.changeToMasked){this.changeToMasked.removeClassName("lcm-state-pulse");b.unmask(this.changeToMasked);this.changeToMasked=null}this._animatePath(h,true);this._enableStateElements(true)},_onStyleChanged:function(i,h){this.currentConnectorMargins=this.connectorMargins.find(i);this._drawConnectors();if(this.changeToMasked){b.unmask(this.changeToMasked);b.mask(this.changeToMasked,"")}this._enableStateTooltips(i==="lcm-state-s")},_setupAdaptiveConnectorMargins:function(){this.connectorMargins=new c();this.connectorMargins.add("lcm-state",{height:20,padding:5,connectorSize:20});this.connectorMargins.add("lcm-state-ml",{height:16,padding:4,connectorSize:15});this.connectorMargins.add("lcm-state-m",{height:14,padding:3,connectorSize:10});this.connectorMargins.add("lcm-state-sm",{height:10,padding:2,connectorSize:7});this.connectorMargins.add("lcm-state-s",{height:8,padding:2,connectorSize:4});this.connectorMargins.add("lcm-state-hidden",{height:0,padding:0,connectorSize:0})},_setupAdaptiveUI:function(i){this._setupAdaptiveConnectorMargins();var u=this._calcWidth(this.state_container,"lcm-state","lcm-state-connector",this.numStates);var z=this._calcWidth(this.state_container,"lcm-state-ml","lcm-state-connector-ml",this.numStates);var j=this._calcWidth(this.state_container,"lcm-state-m","lcm-state-connector-m",this.numStates);var v=this._calcWidth(this.state_container,"lcm-state-sm","lcm-state-connector-sm",this.numStates);var t=this._calcWidth(this.state_container,"lcm-state-s","lcm-state-connector-s",this.numStates);var m=this._calcHeight(this.state_container,"lcm-state");var x=this._calcHeight(this.state_container,"lcm-state-ml");var s=this._calcHeight(this.state_container,"lcm-state-m");var r=this._calcHeight(this.state_container,"lcm-state-sm");var o=this._calcHeight(this.state_container,"lcm-state-s");m+=this.connectorMargins.find("lcm-state").height*2;x+=this.connectorMargins.find("lcm-state-ml").height*2;s+=this.connectorMargins.find("lcm-state-m").height*2;r+=this.connectorMargins.find("lcm-state-sm").height*2;o+=this.connectorMargins.find("lcm-state-s").height*2;var n="max-width:"+t+";max-height:"+o;var y="max-width:"+v+";max-height:"+r;var p="max-width:"+j+";max-height:"+s;var k="max-width:"+z+";max-height:"+x;var q="max-width:"+u+";max-height:"+m;var l=this;this.adaptiveLayout=new f("lcm-state",i).query(n,"lcm-state-hidden").query(y,"lcm-state-s").query(p,"lcm-state-sm").query(k,"lcm-state-m").query(q,"lcm-state-ml").childGroup(new f("lcm-state-connector",i).query(n,"lcm-state-connector-hidden").query(y,"lcm-state-connector-s").query(p,"lcm-state-connector-sm").query(k,"lcm-state-connector-m").query(q,"lcm-state-connector-ml")).childGroup(new f("lcm-confirm-transition",i).query(n,"lcm-confirm-transition-hidden").query(y,"lcm-confirm-transition-s").query(p,"lcm-confirm-transition-sm").query(k,"lcm-confirm-transition-m").query(q,"lcm-confirm-transition-ml")).childGroup(new f("lcm-transition-confirm-button",i).query(n,"lcm-transition-confirm-button-hidden").query(y,"lcm-transition-confirm-button-s").query(p,"lcm-transition-confirm-button-sm").query(k,"lcm-transition-confirm-button-m").query(q,"lcm-transition-confirm-button-ml")).childGroup(new f("active-path",i).query(y,"active-path-s").query(p,"active-path-sm").query(k,"active-path-m").query(q,"active-path-ml")).childGroup(new f("inactive-path",i).query(y,"inactive-path-s").query(p,"inactive-path-sm").query(k,"inactive-path-m").query(q,"inactive-path-ml")).childGroup(new f("lcm-svg-container",i).query(n,"lcm-svg-container-hidden")).onSizeChanged(function(w,h){if(!w){l._drawConnectors()}if(l.confirmationUI.isVisible){l.confirmationUI.position()}}).onStyleChanged(function(w,h){l._onStyleChanged(w,h)}).start()},_injectHTML:function(i,h){this._createContainers(i);this._createStateElements(h);this._createTransitionConfirmationUI(i);this._createSVGCanvas();this._createSVGEndArrows();this._createConnectors(h)},_calcWidth:function(j,m,n,h){var l=function(t,u){var r=document.createElement("div");r.className=u;t.appendChild(r);var q=window.getComputedStyle(r);var p=parseInt(q.marginLeft,10)+parseInt(q.marginRight,10)+r.getBoundingClientRect().width;t.removeChild(r);return p};var o=l(j,m);var i=l(j,n);var k=(o*h)+(i*(h-1))+h*2;return k},_calcHeight:function(n,j){var m=document.createElement("div");m.className=j;n.appendChild(m);var l=window.getComputedStyle(m);var k=parseInt(l.marginTop,10)+parseInt(l.marginBottom,10)+m.getBoundingClientRect().height;n.removeChild(m);var i=this.connectorMargins.find(j);if(i&&i.height){k+=i.height}return k},_createContainers:function(j){var i=document.getElementsByClassName("lcm-svg-container");while(i.length>0){i[0].remove()}var h=document.getElementsByClassName("lcm-state-container");while(h.length>0){h[0].remove()}this.SVG_container=UWA.createElement("div",{"class":"lcm-svg-container"});this.state_container=UWA.createElement("div",{"class":"lcm-state-container"});this.SVG_container.inject(j);this.state_container.inject(j)},_getStateClass:function(h,i){if(h.info.isCurrent){return"lcm-state-current"}if(h.isDisabled){return"lcm-state-unreachable"}if(h.isDemote){return"lcm-state-transitionable"}for(var j in h.connectors_in){if(j===i){return"lcm-state-transitionable"}}return"lcm-state-unreachable"},_getCurrentState:function(h){for(var i in h){if(h[i].info.isCurrent){return i}}return""},_animatePath:function(k,i){if(this._isIE11()){return}var j='path[*|to="'+k+'"]';var l=this.SVGCanvas.querySelector(j);if(!l){return}var m=UWA.extendElement(l);if(i){m.removeAttribute("style","stroke-width");m.removeClassName("animate-path")}else{if(m.hasClassName("animate-path")){return}var h=getComputedStyle(m).strokeWidth;var n=parseFloat(h)+1;m.setAttribute("style","stroke-width:"+n+"px");m.addClassName("animate-path")}this._patchIEPathBug(m)},_getTransitionConfirmText:function(i,h){if(h[i].isDemote){return e.demoteTo+h[i].info.stateUserName+"?"}if(h[i].isPromote){return e.promoteTo+h[i].info.stateUserName+"?"}return e.changeMaturityTo+h[i].info.stateUserName+"?"},_createStateElements:function(q){var l=this;this.stateToElement=new c();var k=this._getCurrentState(q);var r=function(s,v){s.addEventListener("mouseover",function(){var w=s.getAttribute("data-disabled");if(w==="true"){return}l._animatePath(v,false)});s.addEventListener("mouseout",function(){if(!l.pendingTransition){l._animatePath(v,true)}})};var j=function(s,w,v){s.confirmText=w;s.action=v;s.addEventListener("click",function(){var x=s.getAttribute("data-disabled");if(x==="true"){return}var y=s.hasClassName("lcm-state-transitionable");if(!y){return}l.confirmationUI.show(s,s.confirmText,s.action)})};var h=0;for(var i in q){var p=this._getStateClass(q[i],k);if(h!==0){var n=UWA.createElement("div",{"class":"lcm-state-connector"});n.inject(this.state_container)}var u=UWA.createElement("div",{"class":"lcm-state-base lcm-state "+p});var o=UWA.createElement("span",{"class":"lcm-state-text",html:q[i].info.stateUserName});o.inject(u);u.inject(this.state_container);var m=this._getTransitionConfirmText(i,q);j(u,m,q[i].action);r(u,i);var t=new a({target:u,body:i,position:"bottom"});t.elements.container.style.display="none";t.elements.container.style.zIndex=99999;this.stateToElement.add(i,{element:u,tooltip:t,order:h++,numConnectors:{right:0,left:0,top:0,bottom:0}})}this.numStates=h},_updateStateElements:function(h){var j=this;var i=this._getCurrentState(h);this._forEachStateElement(function(k,l){k.removeClassName("lcm-state-unreachable");k.removeClassName("lcm-state-transitionable");k.removeClassName("lcm-state-current");var m=j._getStateClass(h[l],i);k.addClassName(m);k.confirmText=j._getTransitionConfirmText(l,h);k.action=h[l].action})},_enableStateTooltips:function(h){var i=this;this._forEachStateElement(function(k,l){var j=i.stateToElement.find(l);if(!j){return}j.tooltip.elements.container.style.display=h?"":"none"})},_enableStateElements:function(h){this._forEachStateElement(function(i){i.disabled=!h;i.setAttribute("data-disabled",(!h).toString());if(h){if(i.hasClassName("lcm-state-disabled")){i.removeClassName("lcm-state-disabled")}}else{if(i.hasClassName("lcm-state-transitionable")){i.addClassName("lcm-state-disabled")}}})},_forEachStateElement:function(h){var i=this;if(this.stateToElement!==undefined&&this.stateToElement!==null){this.stateToElement.each(function(k){var j=i.stateToElement.find(k).element;h(j,k)})}},_createTransitionConfirmationUI:function(l){var m=this;var k=function(){};var j=this._injectTransitionConfirmationUI(l,function(){k()},function(){m.confirmationUI.isVisible=false});var i=j.querySelector(".lcm-transition-confirm-button");var h=j.querySelector(".lcm-confirm-msg");this.confirmationUI={isVisible:false,show:function(n,p,o){k=o;j.style.display="inline-block";i.focus();h.innerText=p;this.currentEl=n;this.position();this.isVisible=true},hide:function(){this.currentEl=null;j.style.display="inline-block";this.isVisible=false},position:function(){if(!this.currentEl){return}j.style.left=(this.currentEl.offsetLeft-0)+"px";j.style.top=(this.currentEl.offsetTop-1)+"px"}}},_injectTransitionConfirmationUI:function(m,k,i){var j=d.htmlFromString("<div class='lcm-confirm-transition'><div class='lcm-confirm-msg'></div><button class='lcm-transition-confirm-button lcm-transition-confirm-button-base'>OK</button></div>");var l=j.querySelector(".lcm-confirm-transition");var h=j.querySelector(".lcm-transition-confirm-button");["click","touchstart"].forEach(function(n){h.addEventListener(n,function(o){if(l.style.display!=="inline-block"){return}o.stopPropagation();l.style.display="none";k()})});h.addEventListener("blur",function(){l.style.display="none";if(typeof i==="function"){i()}});m.appendChild(j);return l},_deleteConnectors:function(){this.paths.forEach(function(j){var i=j.path.parentNode;if(i){i.removeChild(j.path)}});this.paths=[];var h=this;this.stateToElement.each(function(i){h.stateToElement.find(i).numConnectors={right:0,left:0,top:0,bottom:0}})},_createSVGEndArrows:function(){this.SVGCanvas.appendChild(this._createSVGEndArrow("arrow-active"));this.SVGCanvas.appendChild(this._createSVGEndArrow("arrow-inactive"))},_createConnectors:function(r){this.paths=[];for(var t in r){var h=r[t];for(var n in h.connectors_out){var i=this._createSVGEl("path");this.SVGCanvas.appendChild(i);if(h.info.isCurrent||h.isDemote){i.setAttribute("marker-end","url(#arrow-active)");i.setAttribute("class","active-path");i.setAttributeNS("state","to",h.isDemote?t:n)}else{i.setAttribute("marker-end","url(#arrow-inactive)");i.setAttribute("class","inactive-path")}var l=h.connectors_in.hasOwnProperty(n);var o=this.stateToElement.find(n).order-this.stateToElement.find(t).order;var k,j;if(o===1){k="right";j="left"}else{if(o===-1){if(l){k="bottom";j="bottom"}else{k="left";j="right"}}else{if(o>1){k="top";j="top"}else{if(o<-1){k="bottom";j="bottom"}}}}var q=++this.stateToElement.find(t).numConnectors[k];var m=++this.stateToElement.find(n).numConnectors[j];this.paths.push({path:i,from:t,fromConnectOrder:q,to:n,toConnectOrder:m,opts:{connectFrom:k,connectTo:j}})}}},_drawConnectors:function(){if(!this.currentConnectorMargins){return}var i={ptsTop:[],ptsBottom:[],height:this.currentConnectorMargins.height,padding:this.currentConnectorMargins.padding,calcHeight:function(m,h){var l=0;var k=this.normalizePt(m);if(h==="top"){l=this.numIntersects(k,this.ptsTop);this.ptsTop.push(k)}else{if(h==="bottom"){l=this.numIntersects(k,this.ptsBottom);this.ptsBottom.push(k)}}return this.height+this.padding*l},numIntersects:function(l,h){var m=0;var k=function(o,n){return(o<n.p2&&o>n.p1)};h.forEach(function(n){if(k(l.p1,n)){m++}else{if(k(l.p2,n)){m++}else{if(k(n.p1,l)){m++}else{if(k(n.p2,l)){m++}}}}});return m},normalizePt:function(h){return{p1:Math.min(h.p1,h.p2),p2:Math.max(h.p1,h.p2)}}};var j=0;this.paths.forEach(function(n){var q=this.stateToElement.find(n.from);var o=q.element;var h=this.stateToElement.find(n.to);var m=h.element;var l={fromConnectorOrder:n.fromConnectOrder,toConnectorOrder:n.toConnectOrder,numConnectorsFrom:q.numConnectors[n.opts.connectFrom],numConnectorsTo:h.numConnectors[n.opts.connectTo],connectorSize:this.currentConnectorMargins.connectorSize,heightCalc:i};var k={};UWA.extend(k,n.opts);UWA.extend(k,l);this._drawLine(n.path,o,m,k)},this)},_drawLine:function(v,w,m,u){var y=function(C,E,B){var D=function(M,h,K){if(K.numConnectors===1){return M+h/2}var L=(h-K.numConnectors*K.size)/2;return M+L+K.size/2+K.size*(K.connectOrder-1)};var H={x:0,y:0};var A=C.getBoundingClientRect();var J=A.right-A.left;var F=A.bottom-A.top;var I=C.offsetLeft;var G=C.offsetTop;if(E==="right"){H.x=I+J;H.y=D(G,F,B)}else{if(E==="top"){H.x=D(I,J,B);H.y=G}else{if(E==="bottom"){H.x=D(I,J,B);H.y=G+F}else{if(E==="left"){H.x=I;H.y=D(G,F,B)}}}}return H};var n=function(h,A){return h+" "+A.x+" "+A.y+" "};var k=y(w,u.connectFrom,{connectOrder:u.fromConnectorOrder,numConnectors:u.numConnectorsFrom,size:u.connectorSize});var p=n("M",k);var j=y(m,u.connectTo,{connectOrder:u.toConnectorOrder,numConnectors:u.numConnectorsTo,size:u.connectorSize});var o=n("L",j);var i="";if(u.connectTo==="bottom"||u.connectTo==="top"){var x=u.heightCalc.calcHeight({p1:k.x,p2:j.x},u.connectTo);var r={};r.x=k.x;r.y=k.y+((u.connectTo==="top")?-x:x);var t=n("L",r);var q={};q.x=j.x;q.y=j.y+((u.connectTo==="top")?-x:x);var z=n("L",q);i=p+t+z+o}else{var s={x:0,y:0};var l="";if(k.y!==j.y&&k.x!==j.x){s.x=k.x;s.y=j.y}if(s.x!==0){l=n("L",s)}i=p+l+o}v.setAttribute("d",i);this._patchIEPathBug(v)},_isIE11:function(){var h=function(){return(/Trident\/7\./).test(navigator.userAgent)};this._browserCheck=this._browserCheck||{isIE11:h()};return this._browserCheck.isIE11},_patchIEPathBug:function(i){if(this._isIE11()){var h=i.parentNode;h.removeChild(i);h.appendChild(i)}},_createSVGEl:function(h){return document.createElementNS("http://www.w3.org/2000/svg",h)},_createSVGEndArrow:function(k){var i=this._createSVGEl("marker");var h=this._createSVGEl("defs");var j=this._createSVGEl("path");i.appendChild(j);h.appendChild(i);i.setAttribute("id",k);i.setAttribute("markerWidth","10");i.setAttribute("markerHeight","8");i.setAttribute("refX","9");i.setAttribute("refY","4");i.setAttribute("orient","auto");j.setAttribute("d","M 3 1 L 10 4 L 3 7");j.setAttribute("class",k);return h},_createSVGCanvas:function(){var h=this._createSVGEl("svg");h.setAttribute("id","svgCanvas");h.setAttribute("width","100%");h.setAttribute("height","100%");h.setAttribute("xmlns:state","http://www.lc.com/state");UWA.extendElement(h).inject(this.SVG_container);this.SVGCanvas=h}})});define("DS/MaturityWidget/MaturityController",["UWA/Controls/Abstract","UWA/Class/Promise","DS/PlatformAPI/PlatformAPI","DS/MaturityWidget/MaturityModel","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","DS/LifecycleServices/AssemblyJson","DS/LifecycleCmd/AssemblySelectionUtil","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(d,g,i,e,c,b,h,j,f,a){var k=d.extend({tenant:null,init:function(l){this._context=l;var m=this;this.model=new e();this.policy="VPLM_SMB_Definition";this.tenant=null},initGraph:function(n,m){var l=this;c.getSecurityContextPromise(this.tenant,this._context).then(function(o){if(o==null){l.dispatchEvent("onError",{errorMsg:a.ErrorSecurityContextEmpty})}l._getMaturityGraph(n,null,m,o,true)})},promote:function(m){var l=this;c.getSecurityContextPromise(this.tenant,this._context).then(function(n){l._changeMaturity("promote",m,n)})},demote:function(m){var l=this;c.getSecurityContextPromise(this.tenant,this._context).then(function(n){l._changeMaturity("demote",m,n)})},expandStructure:function(m,p,l,o){var n=this;c.getSecurityContextPromise(this.tenant,this._context).then(function(q){n._getExpandedAssembly(q,m,p,l,o)})},_getExpandedAssembly:function(q,l,p,s,o){var n=this;var r={intent:"explore_2D",debug:true,roots:[{id:l}],level:"-1",source:"cstorage",authored:p};var m=b.get3DSpaceWSUrl(this.tenant,"/resources/enopad/lwc/expand",null);var n=this;h.authenticatedRequest(m,{method:"POST",headers:b.getHeaders(q),timeout:600000,data:JSON.stringify(r),type:"json",onComplete:function(t){if(t.results&&t.results.length==0&&!p){console.log("expandStructure: No data in results, retrying with authored (non-index)");n._getExpandedAssembly(q,l,true,s,o)}var v=j.convertFromExpandFormat(t);var u=n._parseAssembly(v,q);n._getMaturityGraph({data:u},s,o,q,false)},onFailure:function(t){console.error("expandStructure: onFailure -> "+t);if(!p){console.log("expandStructure: Failure with index request, retrying with authored (non-index)");n._getExpandedAssembly(q,l,true,s,o)}else{throw LifecycleWidgetNls.timeout}if(typeof o==="function"){o()}},onTimeout:function(){var t={};t.errorMsg=a.connectionTimeout;t.type="warning";n.dispatchEvent("onError",t)},})},_parseAssembly:function(l,o){var p=null;if(l!==undefined&&l!==null&&l.hasOwnProperty("nodes")){var n=l.nodes;var m=new f();p=m.getSelection(o,n)}return p},_getMaturityGraph:function(m,l,n,s,q){var o=this;var t=b.get3DSpaceWSUrl(o.tenant,"/resources/lifecycle/maturity/getStateGraph",null);var r=function(u){if(typeof l==="function"){l(u)}};var p=function(u){if(typeof n==="function"){n(u)}};h.authenticatedRequest(t,{method:"POST",type:"json",headers:b.getHeaders(s),timeout:1000*60*60*1,data:JSON.stringify(m),onComplete:function(w){console.log("MaturityInfos: COMPLETED");console.log(w);var v=w.status;var u=v.code;if(v.hasOwnProperty("errorMsg")){if(v.errorMsg!==null){p(v.errorMsg)}else{if(u===0){o.model.setMaturityGraph(w);if(q){o.dispatchEvent("onGraphInfoChanged")}else{r(w)}}}}else{o.model.clear();p(a.maturityGraphFailed)}},onFailure:function(u,v){console.log("attributes:Failure..."+u);p(c.parseWebServiceError(u,v))},onTimeout:function(){var u={};u.errorMsg=a.connectionTimeout;u.type="warning";o.dispatchEvent("onError",u)}})},_changeMaturity:function(q,o,n){var m=this;var l="null";var p=b.get3DSpaceWSUrl(m.tenant,"/resources/lifecycle/maturity/"+q,null);console.log(q+":");console.log(o);h.authenticatedRequest(p,{method:"POST",type:"json",headers:b.getHeaders(n),timeout:600000,data:JSON.stringify(o),onComplete:function(z){console.log(q+": COMPLETED");console.log(z);l=z;var v=0;var A=0;var D=z.results;var E={};E.data=[];for(var x=0;x<D.length;x++){var y=m.model.getAttribute(D[x].physicalid,"current");if(y===undefined){y=D[x].current}var s=D[x].current;m.model.setAttribute(D[x].physicalid,"current",D[x].current);var B={physicalid:D[x].physicalid,tostate:s,fromstate:y};E.data.push(B)}var u={};if(z.status==="failure"){var r=z.report,C=r.length,t=[],w=10;for(var x=0;x<C&&x<w;x++){if(m.model.objects[r[x].physicalids]&&m.model.objects[r[x].physicalids].displayName&&!r[x].error.contains(m.model.objects[r[x].physicalids].displayName)){t.push(m.model.objects[r[x].physicalids].displayName+": "+r[x].error+"\n\n"+a.maturityFailure)}else{t.push(r[x].error+"\n\n"+a.maturityFailure)}}if(C>w){t.push(a.replace(a.maturityAdditionalErrorMessage,{maxErrors:w.toString(),lineBreak:"\n",numErrors:(C-w).toString()})+"\n\n"+a.maturityFailure)}u.errorMsg=t;u.type="error";m.dispatchEvent("onError",u);E.dontshowsuccess=true;if(E.data.length>0){m.dispatchEvent("onStateChanged",E)}}else{if(E.data.length>0){m.dispatchEvent("onStateChanged",E)}}},onFailure:function(r,t){console.log(q+":Failure..."+r);var s={};s.errorMsg=c.parseWebServiceError(r,t);s.type="error";m.dispatchEvent("onError",s)},onTimeout:function(){console.log(q+": A connection timeout occured.");var r={};r.errorMsg=a.timeout;r.type="warning";m.dispatchEvent("onError",r)}});return l},getGraphInfo:function(){return this.model.getGraphInfo()},getStateInfos:function(l){return this.model.getStateInfos(l)},setTenant:function(l){this.tenant=l}});return k});define("DS/MaturityWidget/MaturityWidget",["css!DS/MaturityWidget/MaturityWidget","UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","DS/MaturityWidget/MaturityController","DS/MaturityWidget/MaturityModel","DS/MaturityWidget/MaturityGraph","DS/MaturityWidget/MultiselUI","DS/LifecycleControls/CommandDialog","DS/LifecycleServices/Utils","DS/LifecycleCmd/MessageMediator","DS/LifecycleControls/ProgressDialog","DS/LifecycleServices/LifecycleAlert","DS/LifecycleServices/UUIDGenerator","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/UIKIT/Accordion","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(a,o,g,k,b,r,n,j,l,h,m,i,e,c,p,d,f){var q=true;return o.extend({displayWorkflowGraph:true,hostedInDialog:false,context:null,uuid:null,maskDelay:3000,onKeyDownHandler:null,multiSelUITitle:null,sizePrefKey:"maturityDlgSize",canPromoteOrDemote:true,numInitSelection:0,isEmbeddedUI:false,PADSession:null,hasRequestedPADSession:false,initialSelection:null,isMultipleSelection:false,optionsShown:false,sizebeforeadvanced:null,accordion:null,init:function(s){this.uuid=e.create();var t=s||{type:""};this._parent(t);this.elements.content=UWA.createElement("div",{"class":"lcm-maturity-content"});this.elements.container=UWA.createElement("div",{"class":"lcm-maturity-container"});this.elements.container.inject(this.elements.content,"top");if(typeof(t.context)!=="undefined"&&t.context!=null){this.context=t.context}this.controller=new k(this.context);this.model=this.controller.model;p.app_initialization(function(){});this._setupEventSubscriptions()},_setupEventSubscriptions:function(){var t=this;g.subscribe("Lifecycle.Modification",function(u){t._externalRefresh(JSON.parse(u))});this.addEvent("onPostInject",function(){t.isEmbeddedUI=true});var s=this.controller;s.addEvent("onStateChanged",function(z){document.body.style.cursor="default";if(!z.hasOwnProperty("dontshowsuccess")){this._showNotification("success",f.maturitySuccess)}if(this.maturityGraph&&this.displayWorkflowGraph){this.maturityGraph.onEndTransition(z.data[0].tostate);q=true;if(this.dialog){this.dialog.updateUI();this.dialog._disableOK();this.dialog.destroy()}}if(this.newStateInaccessible(z.data)){if(this.context.refresh){try{this.context.refresh()}catch(v){console.error(v)}}var w={created:[],deleted:[],modified:[]};w.context=this;z.data.forEach(function(C){var B={physicalid:C.physicalid,operation:"Promote"};w.deleted.push(B)});h.dispatchEvent("onModification",w);this._closeDialog();if(!this.isEmbeddedUI){this._onComplete()}}else{this._refresh(z.data);if(this.displayWorkflowGraph){var u;for(u=0;u<z.data.length;u++){var y=this.model.getAttribute(z.data[u].physicalid,"isAggregateRep");if(this.model.getAttribute(z.data[u].physicalid,"policy")&&!y){break}}if(u==z.data.length){u=0}var A=this.model.getAttribute(z.data[u].physicalid,"policy");var x=z.data[u].tostate;this._updateGraph(A,x)}if(!this.isEmbeddedUI){if(this.dialog){this.dialog.destroy()}this._onComplete()}}},this);s.addEvent("onError",function(u){document.body.style.cursor="default";this.displayError(u);this._closeDialog();if(this.maturityGraph){this.maturityGraph.onEndTransition();q=true;if(this.dialog){this.dialog.updateUI();this.dialog._disableOK();this.dialog.destroy()}}if(!this.isEmbeddedUI){this._onComplete()}else{this._refreshGraph()}},this);s.addEvent("onGraphInfoChanged",function(){this._postInitGraph();this._buildGraph();this._addOptionsAccordion()},this);this.model=this.controller.model},executeCmd:function(t,s,u){this.addEvent("onReady",function(v){this._showCommandUI(v.displayWorkflowGraph,v.policy)},this);this.addEvent("onComplete",function(){u()});this.context=s.context;this.controller._context=this.context;this.hostedInDialog=true;this.setObjects(t)},getUUID:function(){return this.uuid},_onOk:function(){if(this.onOkClicked){this.onOkClicked(this)}this._onComplete()},_onComplete:function(){this.dispatchEvent("onComplete");if(this.maturityGraph){this.maturityGraph.destroy()}if(this.onKeyDownHandler){document.onkeydown=this.onKeyDownHandler}if(this.refreshSub){this.refreshSub.unsubscribe();this.refreshSub=null}},_showCommandUI:function(x,y){this.displayWorkflowGraph=x;var u=x&&(!this.model.isSingleIRPCAssembly);var s=this;var w=new j();var z=w.create(this.elements.content,{title:f.maturity,className:"ENO_Maturity",closeButton:true,resizable:true,buttonStyle:u?w.buttonStyle.cancel:w.buttonStyle.okCancel,enableCmd:function(){return this.canPromoteOrDemote},onOk:function(){s._saveDlgSize();w._disableUI();s._onOk()},onClose:function(){s._saveDlgSize();s._onComplete();s._closeDialog()},onCloseOverride:function(){if(true==q){w._disableUI();w._onCloseHandler.apply(this._fnContext);w.destroy()}},events:{onResizeFloating:function(D){if(s.multiSelUI!==undefined&&s.multiSelUI!==null){s.multiSelUI.onPanelResize()}}}},this);z.inject(widget.body);var C=this._loadSize();var A=!this.displayWorkflowGraph?700:500;var v=!this.displayWorkflowGraph?500:250;var t=!this.displayWorkflowGraph?600:500;var B=!this.displayWorkflowGraph?400:250;z.setNewSize({width:A,height:v});setTimeout(function(){z.setMinSize(t,B)},10);this.dialog=w;this.floatingDlg=z;if(x){this._createSingleObjectGraphUI(this.model.getMaturityGraph(y));w.setTitle(this._getCurrentObjectTitleRevision());if(this.dialog._cancelButton){this.dialog._disableOK()}}else{this.elements.container.addClassName("lcm-maturity-container-multisel");this._createMultiSelectionUI(this.elements.container)}},_getCurrentObjectTitleRevision:function(){var w=f.maturity;var v=this.model.getObjects();if(v!==undefined&&v!==null){var t=Object.keys(v);var u=t[0];var s=v[u];if(s!==undefined&&s!==null&&s.hasOwnProperty("name")){w=w+" - "+s.name;if(s.hasOwnProperty("revision")&&s.revision!=null){w=w+" "+s.revision}}}return w},_saveDlgSize:function(){if(!this.floatingDlg){return}var s=this.floatingDlg.getModalBodySize();s.height=this.floatingDlg.getContainerHeight();this._storeSize(s)},_loadSize:function(){var s=widget.getValue(this.sizePrefKey);if(!s){return{width:500,height:275}}return JSON.parse(s)},_storeSize:function(s){if(!widget.getValue(this.sizePrefKey)){widget.addPreference({name:this.sizePrefKey,type:"hidden",defaultValue:"{}"})}widget.setValue(this.sizePrefKey,JSON.stringify(s))},_installCloseOnEscapePatch:function(){var s=this;this.onKeyDownHandler=document.onkeydown;document.onkeydown=function(t){t=t||window.event;var u=false;if("key" in t){u=(t.key=="Escape"||t.key=="Esc")}else{u=(t.keyCode==27)}if(u){s._closeDialog();if(!s.isEmbeddedUI){s._onComplete()}}}},_externalRefresh:function(t){if(!this.displayWorkflowGraph){return}if(!UWA.is(t.Refresh,"object")){return}if(!UWA.is(t.Refresh.modified,"array")){return}if(this.getUUID()===t.OriginID){return}if(t.Refresh.modified.length!=1){return}var s=t.Refresh.modified[0];if(s.operation!=="Promote"){return}var u=this.model.getObjects()[s.physicalid];if(u==null){return}if(u.current===s.state){return}this.model.changeCurrentObjectState(s.physicalid,s.state);this._updateGraph(s.policy,s.state)},_refresh:function(u){var s=this.model;var t={created:[],deleted:[],modified:[]};t.context=this;u.forEach(function(v){var w={physicalid:v.physicalid,operation:"Promote",state:v.tostate,policy:s.getAttribute(v.physicalid,"policy")};t.modified.push(w)});h.dispatchEvent("onModification",t)},_closeDialog:function(){if(this.progressDialog){this.progressDialog.close();this.progressDialog=null}if(this.dialog){this.dialog.destroy()}},newStateInaccessible:function(s){if(s[0].tostate===null||s[0].tostate===undefined){return true}return false},setTitle:function(s){if(this.dialog){this.dialog.setTitle(s)}},_postInitGraph:function(){var s=this;if(this.progressDialog){this.progressDialog.close();this.progressDialog=null}var t=this.model.getObjects()},_addOptionsAccordion:function(){var v=this;if(this.model.isSingleIRPCAssembly){v.optionsShown=true;var x=document.createElement("div");x.className="lifecycle-options";var u=null;this.accordion=new d({items:[{title:f.AdvancedTitle,content:UWA.createElement("div"),},],events:{onOpen:function(y){if(v.accordionId==y.accordionId){v._openExistingAccordion(this,y.elements.content)}else{v._openAccordion(this,y.elements.content)}v.accordionId=y.accordionId;v.dialog.updateUI()},onClose:function(y){v._closeAccordion(this,y)}},}).inject(x);var t=this.elements.container.getBoundingClientRect().height;if(widget&&!c.isInLifecycleWidget(widget)){var w=100-(100/(t/40));if(t<150){this.elements.container.style.height=w+"%"}}this.elements.content.appendChild(x);var s=v.dialog._dialog.elements.container.querySelector(".accordion-title");s.innerText=f.AdvancedTitle}},_setAdvancedModeSizeAndLabel:function(){var s=this.dialog._dialog.elements.container.querySelector(".accordion-title");s.innerText=f.BasicTitle;var t=40*8+225;this.dialog._dialog.setNewSize({width:"700",height:t})},_openExistingAccordion:function(t,s){this.displayWorkflowGraph=false;this.dialog.setTitle(this.multiSelUITitle);this.elements.container.style.display="none";this.accordion.setTitle(f.BasicTitle);this._setAdvancedModeSizeAndLabel()},getPADSessionPromise:function(){var s=this;return new UWA.Class.Promise(function(v,u){var t="DS/PADUtils/PADSession";require([t],function(w){s.hasRequestedPADSession=true;s.PADSession=w;v(s.PADSession)},function(w){s.hasRequestedPADSession=true;s.PADSession=null;v(s.PADSession)})})},_getPADSession:function(){if(this.hasRequestedPADSession){return UWA.Class.Promise.resolve(this.PADSession)}else{return this.getPADSessionPromise()}},_openAccordion:function(s,B){var w=this;w.sizebeforeadvanced=w.dialog._dialog.getModalBodySize();w.sizebeforeadvanced.height=w.dialog._dialog.getContainerHeight();console.log("opening accordion");this.displayWorkflowGraph=false;w.elements.container.style.display="none";var z=w.dialog._dialog.elements.container.querySelector(".accordion-title");z.style.position="absolute";z.style.bottom="0";this.progressDialog=new m();var y=w.dialog._dialog.elements.container;if(y){var v=y.querySelector("#lcm-maturity-content");if(!v){v=w.dialog._dialog.getBody()}if(v){this.progressDialog.showDelay(v,f.maturityGraphInit,1000)}}var t=null;var u=this.model.getObjects();for(var x in u){var A=u[x];if(A!==undefined&&A!==null&&A.hasOwnProperty("isSingleIRPCAssembly")&&A.isSingleIRPCAssembly){t=x;break}}if(t!==null){if(widget&&c.isInPSEditorWidget(widget)){this._getPADSession().then(function(C){var E=this;var D=true;if(C){D=C.determineAuthoredFlag()}E.controller.expandStructure(t,D,function(F){if(E.progressDialog){E.progressDialog.close();E.progressDialog=null}E._createMultiSelectionUI(B)},function(F){if(E.progressDialog){E.progressDialog.close();E.progressDialog=null}E.displayError(F,"primary")})}.bind(this))}else{this.controller.expandStructure(t,true,function(C){if(w.progressDialog){w.progressDialog.close();w.progressDialog=null}w._createMultiSelectionUI(B)},function(C){if(w.progressDialog){w.progressDialog.close();w.progressDialog=null}w.displayError(C,"primary")})}}else{if(w.progressDialog){w.progressDialog.close();w.progressDialog=null}}w._setAdvancedModeSizeAndLabel()},_closeAccordion:function(u,t){console.log("closing accordion");this.displayWorkflowGraph=true;if(this.progressDialog){this.progressDialog.close();this.progressDialog=null}this.dialog.setTitle(this._getCurrentObjectTitleRevision());this.elements.container.style.display="block";this.dialog._disableOK();this.dialog._dialog.setNewSize(this.sizebeforeadvanced);var s=this.dialog._dialog.elements.container.querySelector(".accordion-title");s.innerText=f.AdvancedTitle},empty:function(){if(this.maturityGraph){this.maturityGraph.destroy()}this.model.clear()},_showNotification:function(s,u){var t=this;if(!Array.isArray(u)&&typeof u==="string"){u=[u]}if(Array.isArray(u)&&u.length){u.forEach(function(w){var v={eventID:s,msg:w.split?w.split("\n").join("<br>"):w};if(t.context!=null&&(typeof t.context.displayNotification==="function")){t.context.displayNotification(v)}else{i.displayNotification(v)}})}},displayError:function(t,u){var s=t;if(t.hasOwnProperty("errorMsg")){s=t.errorMsg!==null?t.errorMsg:t}if(u===undefined&&t.hasOwnProperty("type")){u=t.type}else{if(u===undefined){u="warning"}}this._showNotification(u,s)},_getFilteredObjects:function(){return this.model.getObjects(function(s){return !s.isOnceInstantiable})},_isObjectsAlreadyLoaded:function(t){var s=false;var u=l.toMaturityArray(this._getFilteredObjects());if(u.length===0){return false}else{u=u[0]}if(t===undefined||t===null||t.length===0){return false}if(Array.isArray(t)){t.forEach(function(v){if(v.hasOwnProperty("physicalid")&&u.hasOwnProperty("physicalid")&&v.hasOwnProperty("current")&&u.hasOwnProperty("current")){if((v.physicalid==u.physicalid)&&(v.current==u.current)){s=true}}})}return s},setObject:function(s){return this.setObjects([s])},setObjects:function(u){if(this._isObjectsAlreadyLoaded(u)){return false}this.numInitSelection=u.length;this.initialSelection=u;if(this.isEmbeddedUI){this.empty()}if(u.length===0){throw f.noObject}var v={};v.data=u;var t=u[0];if(t.physicalid===""){throw f.epmtyPhysicalId}this.controller.setTenant(t.tenant);this.model.setObjects(u);if(this.progressDialog){this.progressDialog.close();this.progressDialog=null}this.progressDialog=new m();this.progressDialog.showDelay(document.body,f.maturityGraphInit,3000);var s=this;this.controller.initGraph(v,function(w){s._postInitGraph();s.displayError(w);s._onComplete()});return true},_createPromotePayload:function(s,u){var w=[];for(var t in u){w.push({physicalid:t,tostate:s,fromstate:u[t].current})}var v={};v.data=w;return v},_createGraphStates:function(w,C){var F=this._getFilteredObjects();var G=UWA.clone(w.states);var A=F[Object.keys(F)[0]].current;var u=l.toArray(G[A].connectors_in);u.contains=function(s){return this.find(function(I){return I===s})};var B=function(s){this._promote(s)};var y=function(s){this._promote(s)};var D=function(s){this._demote(s)};for(var t in G){var z=false;var x=false;var v=false;var E=this._createPromotePayload(t,F);if(w.infos.isDemoteAuthorized&&u.contains(t)&&G[t].info.stateSysName.toUpperCase()!="RELEASED"){G[t].action=D.bind(this,E);z=true}else{if(w.infos.isDemoteAuthorized){G[t].action=y.bind(this,E);x=true}else{if(w.infos.isPromoteAuthorized){G[t].action=B.bind(this,E);v=true}}}G[t].isDemote=z;G[t].isPromote=x;G[t].isDisabled=x||z||v?false:true;if(t===A){G[t].info.isCurrent=true}else{G[t].info.isCurrent=false}}if(C){for(var H in G){G[H].info.isCurrent=H===C}}return G},_buildGraph:function(){var t=[];var A=[];var H=this.model.getObjects();var D=true;var y=0;var G=null;for(var B in H){y++;var w=H[B].coretype;if(w!=="Reference"){G=true}var C=H[B].policy;if(t.indexOf(C)===-1){t.push(C)}var v=H[B].current;if(A.indexOf(v)===-1){A.push(v)}}var s=f.multipleSelection;if(G===true){var F=null;for(var x in t){if(F==null){F=this.model.getPolicy(t[x]).maturityGraph.states.length}if(F!=this.model.getPolicy(C).maturityGraph.states.length){D=false;s=f.multipleSelectionNotSimilar}}}if(y>this.numInitSelection&&!this.isEmbeddedUI){this._showNotification("info",f.maturityAddedAggReps)}var u=H[this.initialSelection[0].physicalid].policy;var z={displayWorkflowGraph:true,policy:u};if(y===1||(this.isEmbeddedUI&&y>0)){if(this.hostedInDialog){this.dispatchEvent("onReady",z)}else{this._createSingleObjectGraphUI(this.model.getMaturityGraph(u))}}else{if(D===true&&y>=1){z.displayWorkflowGraph=false;this.dispatchEvent("onReady",z)}else{if(y>=1){var E={};E.errorMsg=s;this.displayError(E,"primary");this._closeDialog();if(!this.isEmbeddedUI){this._onComplete()}}}}this.dispatchEvent("buildGraphComplete")},_createMultiSelectionUI:function(s){var t=this;this.isMultipleSelection=true;this.multiSelUI=new n();if(!this.multiSelUI.create(this.model,s,function(u){t.multiSelUITitle=u;t.setTitle(u)})){this.canPromoteOrDemote=false;this.dialog.updateUI()}else{this.onOkClicked=function(v){var w=this.multiSelUI.getPromotePayload();var u=this.multiSelUI.getDemotePayload();document.body.style.cursor="progress";if(w.data.length>0){v.controller.promote(w)}if(u.data.length>0){v.controller.demote(u)}}}},_objectHasWorkflow:function(t){var u=0;var s;for(s in t.states){if(t.states.hasOwnProperty(s)){u++}}if(u==0){return false}return true},_createSingleObjectGraphUI:function(u){if(this._objectHasWorkflow(u)){if(this.maturityGraph!==undefined&&this.maturityGraph!==null){this.maturityGraph.destroy()}this.maturityGraph=new r();var s=this._createGraphStates(u);this.maturityGraph.create(this.elements.container,s)}else{var t={};t.errorMsg=f.noMaturityGraph;this.displayError(t,"primary");this._closeDialog();if(!this.isEmbeddedUI){this._onComplete()}}},_updatePendingOperationUI:function(s){if(this.maturityGraph){if(this.dialog){this.dialog._disableUI()}q=false;this.maturityGraph.onStartTransition(s)}},_refreshGraph:function(){if(this.displayWorkflowGraph){var u=this._getFilteredObjects();for(var t in u){var v=u[t].policy;var s=u[t].current;this._updateGraph(v,s)}}},_promote:function(u){var s={data:[]};for(var t=0;t<u.data.length;t++){var v=u.data[t].physicalid;if(!this.model.objects[v].excludeFromPromote){s.data.push(u.data[t]);break}}this._updatePendingOperationUI(s.data[0].tostate);this.controller.promote(s)},_demote:function(u){var s={data:[]};for(var t=0;t<u.data.length;t++){var v=u.data[t].physicalid;if(!this.model.objects[v].excludeFromPromote){s.data.push(u.data[t]);break}}this._updatePendingOperationUI(s.data[0].tostate);this.controller.demote(s)},_updateGraph:function(v,u){var t=this.model.getMaturityGraph(v);var s=this._createGraphStates(t,u);this.maturityGraph.updateGraph(s)}})});