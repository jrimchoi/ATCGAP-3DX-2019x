define("DS/WAfrControls/WAfrContextualBar",["UWA/Core","UWA/Controls/Abstract","DS/CoreEvents/Events","DS/Selection/CSOManager","DS/Controls/Toolbar"],function(g,f,e,b,d){function c(j){var i=j.identifier;var l=j.modelList;var k,h=0;if(i!==undefined&&l!==undefined&&l.length!==0){for(h=0;h<l.length;h++){k=l[h].options.grid.identifier;if(i===k){return l[h].options.grid}}}}var a=f.singleton({defaultOptions:{subscribersOptions:[],executionContext:null,viewer:null,uiFrame:null,Xposition:null,Yposition:null,hideWithDistance:true,Xoffset:45,Yoffset:-45,samePosition:false,withContextMenu:false},init:function(k){this._parent(k);var l=this;this.elements.container=new g.Element("div",{"class":"wux-afr-contextual-bar"});var j=new g.Element("div",{styles:{width:"32px",height:"32px",backgroundColor:"blue"}});var i=new g.Element("div",{styles:{width:"32px",height:"32px",backgroundColor:"green"}});var h=new g.Element("div",{styles:{width:"32px",height:"32px",backgroundColor:"pink"}});var m=new g.Element("div",{styles:{width:"32px",height:"32px",backgroundColor:"white"}});l._row1=new d({direction:"horizontal"});l._row1.add("element",{element:j,position:"near"});l._row1.add("separator",{position:"near"});l._row2=new d({direction:"horizontal"});l._row2.add("element",{element:i,position:"near"});l._row2.add("element",{element:h,position:"near"});l._row2.add("element",{element:m,position:"near"});l._row3=new d({direction:"horizontal"});l._row3.getContent().inject(l.elements.container);l._row2.getContent().inject(l.elements.container);l._row1.getContent().inject(l.elements.container);l._isShown=false;l._opacityLocalListener=null;l._opacityListener=null},show:function(l){var A=this;if(l){A.options=g.extend(g.clone(A.defaultOptions),l)}if(A._hideForMultiselection){A.hide();A._clicWhenHideForMultiselection=true;return}var s=1;A.elements.container.setStyles({opacity:s});A._row1.clear();A._row2.clear();A._row3.clear();var x={};x.XmousePosition=A.options.Xposition;x.YmousePosition=A.options.Yposition;x.XmousePositionWithDevPxRatio=A.options.Xposition*window.devicePixelRatio;x.YmousePositionWithDevPxRatio=A.options.Yposition*window.devicePixelRatio;x.withContextMenu=A.options.withContextMenu;var p=A.options.subscribersOptions;var o=0;var B=b.get();var t=false;for(o=0;o<p.length;o++){var y=A.options.subscribersOptions[o];var w=y.onContextualBarReady.call(A,B,x);var v=y.executionContext;var k,n;if(v===undefined){v=A.options.executionContext;n=l.uiComponent._properties}else{n=v.getComponent("Afr_UIComponent")._properties}var j=v.getComponent("AFR_HandlerComponent");var u=j._private;var i=u._radioHdlrMap;var q=u._chkHdlrMap;var z=j.getLeafHandlerMaps();var r=z.actionHandlers;var h=z.commandHandlers;if(w){var C;if(w.WAfrCtxBarRow1!==undefined){C=A._fillRow({row:A._row1,model:w.WAfrCtxBarRow1.model,cmdHandlersList:h,radioHandlersList:i,checkHandlersList:q,actionHandlersList:r,uiComponentProperties:n});t=C===true?C:t}if(w.WAfrCtxBarRow2!==undefined){C=A._fillRow({row:A._row2,model:w.WAfrCtxBarRow2.model,cmdHandlersList:h,radioHandlersList:i,checkHandlersList:q,actionHandlersList:r,uiComponentProperties:n});t=C===true?C:t}if(w.WAfrCtxBarRow3!==undefined){C=A._fillRow({row:A._row3,model:w.WAfrCtxBarRow3.model,cmdHandlersList:h,radioHandlersList:i,checkHandlersList:q,actionHandlersList:r,uiComponentProperties:n});t=C===true?C:t}}}if(t){A.elements.container.inject(l.uiFrame);if(A.options.samePosition!==true){var m=0;if(l.uiFrame.getDimensions().outerWidth<A.options.Xposition+A.elements.container.getDimensions().outerWidth+A.options.Xoffset){m=A.options.Xposition-A.elements.container.getDimensions().outerWidth-A.options.Xoffset}else{m=A.options.Xposition+A.options.Xoffset}A.elements.container.setStyles({position:"absolute",top:Math.abs(A.options.Yposition-A.elements.container.getDimensions().outerHeight+A.options.Yoffset),left:m})}A._isShown=true;A._isOnBar=false;A._setBehaviors()}},hide:function(){var h=this;if(h.elements.container){h.elements.container.remove()}if(h._isShown){e.publish({event:"/WUX/AFR/ctxBarHidden"})}h._isShown=false},_setBehaviors:function(){var i=this;if(i._opacityLocalListenerEnter){i.elements.container.removeEventListener("mouseenter",i._opacityLocalListenerEnter)}i._opacityLocalListenerEnter=function(l){i._isOnBar=true};i.elements.container.addEventListener("mouseenter",i._opacityLocalListenerEnter);if(i._opacityLocalListenerLeave){i.elements.container.removeEventListener("mouseleave",i._opacityLocalListenerLeave)}i._opacityLocalListenerLeave=function(l){i._isOnBar=false;i.options.Xposition=l.clientX;i.options.Yposition=l.clientY};i.elements.container.addEventListener("mouseleave",i._opacityLocalListenerLeave);if(i._opacityListener){document.removeEventListener("mousemove",i._opacityListener)}var j;var k;var h;i._opacityListener=function(o){if(j===undefined){j=i.elements.container.getDimensions()}if(k===undefined){k=i.elements.container.getBoundingClientRect().left}if(h===undefined){h=i.elements.container.getBoundingClientRect().bottom}if(i._isShown&&i.options.hideWithDistance){var m=0;var p=50;var n=200;var q=0;var l={posElement:{x:k,y:h},posMouse:{x:o.clientX,y:o.clientY},dim:{height:j.height,width:j.width}};q=i._calculateDistanceFromMouse(l);if((q>=0&&q<=p)||i._isOnBar){m=1}else{if(q>p&&q<n){m=1-q/n}else{m=0;if(!i.elements.container.hasClassName("wux-ui-state-active")){i.elements.container.remove()}i._isShown=false}}i.elements.container.setStyles({opacity:m})}};document.addEventListener("mousemove",i._opacityListener);if(i._multiselectionStart){document.removeEventListener("keydown",i._multiselectionStart)}i._multiselectionStart=function(l){if(l.keyCode===17&&i._isShown){l.preventDefault();document.removeEventListener("keydown",i._multiselectionStart);document.addEventListener("keyup",i._multiselectionStop);i.elements.container.setStyles({opacity:0});i._isShown=false;i._hideForMultiselection=true;i._clicWhenHideForMultiselection=false}};document.addEventListener("keydown",i._multiselectionStart);if(i._multiselectionStop){document.removeEventListener("keyup",i._multiselectionStop)}i._multiselectionStop=function(n){if(n.keyCode===17&&!i._isShown&&i._hideForMultiselection){n.preventDefault();document.addEventListener("keydown",i._multiselectionStart);document.removeEventListener("keyup",i._multiselectionStop);i._hideForMultiselection=false;if(i._clicWhenHideForMultiselection){i.show(i.options)}else{i.elements.container.setStyles({opacity:1});if(i.options.withContextMenu){i.elements.container.setStyles({top:i.options.Yposition-i.elements.container.getDimensions().outerHeight-45,left:i.options.Xposition+45});var o=i.options.context;if(o===undefined&&i.options.subscribersOptions.length>=1){o=i.options.subscribersOptions[0].context}var l=FrameWindowsManager.getFrameWindow(o);var m={frameWindow:l,bar:i.elements.container,YmousePosition:i.options.Yposition,XmousePosition:i.options.Xposition};i._adjustPosition(m);i.options.hideWithDistance=true}i._isShown=true}}};document.addEventListener("keyup",i._multiselectionStop);if(i.options.eventCallback!==null&&i.options.eventCallback!==undefined){i.options.eventCallback()}},_calculateDistanceFromMouse:function(k){var n=0;var l=k.posElement;var j=k.posMouse;var m=k.dim;var i=0;var h=0;if(j.y>=l.y){h=j.y-l.y}else{if(j.y<=(l.y-m.height)){h=(l.y-m.height)-j.y}}if(j.x<=l.x){i=l.x-j.x}else{if(j.x>=l.x+m.width){i=j.x-(l.x+m.width)}}n=Math.sqrt((i*i)+(h*h));return n},_fillRow:function(q){var p=q.row;var j=q.model;var k=false;if(j!==undefined&&j.length!==0&&p!==undefined){var h=0;var l="";for(h=0;h<j.length;h++){var o=j[h];var m={identifier:o.identifier};if(o.type=="handler"){if(q.cmdHandlersList[o.identifier]!==undefined){m.handler=q.cmdHandlersList[o.identifier];l="commandHandler"}else{if(q.actionHandlersList[o.identifier]!==undefined){m.handler=q.actionHandlersList[o.identifier];l="actionHandler"}else{if(q.radioHandlersList[o.identifier]!==undefined){m.handler=q.radioHandlersList[o.identifier];l="radioHandler"}else{m.handler=q.checkHandlersList[o.identifier];l="checkHandler"}}}if(m.handler!==undefined){var n=new g.Element("div",{});n.style.display="inline-block";n.style.verticalAlign="middle";n.style.marginLeft="4px";q.uiComponentProperties._typeRepFactory.generateView(m.handler,{typePath:l,touchMode:false,onViewCreated:function(i){if(i!==undefined){n.addContent(i)}}});p.add("element",{element:n,position:"near"})}}else{if(o.type=="group"){}else{if(o.type=="container"){}}}k=true}}return k}});return a});define("DS/WAfrControls/WAfrFlyout",["UWA/Core","UWA/Event","DS/Controls/Abstract","DS/Controls/Button","DS/WebappsUtils/WebappsUtils","DS/Controls/Popup","text!DS/WAfrTweakers/assets/WAfrTypeRepresentations.json","text!DS/WAfrTweakers/assets/WAfrTypeTemplates.json","DS/Tweakers/TypeRepresentationFactory","DS/Utilities/Dom","DS/Controls/TooltipModel"],function(g,k,i,j,e,d,b,c,m,a,h){function l(n){var o=n.source;var p=n.target;if(o!==undefined&&p!==undefined){(o.title!==undefined)?p.title=o.title:null;(o.shortHelp!==undefined)?p.shortHelp=o.shortHelp:null;(o.longHelp!==undefined)?p.longHelp=o.longHelp:null;(o.shortHelpImage!==undefined)?p.shortHelpImage=o.shortHelpImage:null;(o.longHelpImage!==undefined)?p.longHelpImage=o.longHelpImage:null;(o.shortHelpImageDimension!==undefined)?p.shortHelpImageDimension=o.shortHelpImageDimension:null;(o.longHelpImageDimension!==undefined)?p.longHelpImageDimension=o.longHelpImageDimension:null;(o.moreHelpCB!==undefined)?p.moreHelpCB=o.moreHelpCB:null}}var f=i.inherit({name:"wafrflyout",publishedProperties:{actionOnClickFlag:{defaultValue:true,type:"boolean",category:"Behavior"},currentValue:{defaultValue:undefined,type:"object",category:"Appearance",advancedSetter:true},elementsList:{defaultValue:[],type:"array",category:"Model"},modifiablePresenterFlag:{defaultValue:true,type:"boolean",category:"Behavior"},orientation:{defaultValue:"top",type:"string",category:"Behavior"},popupVisibleFlag:{defaultValue:false,type:"boolean",category:"Appearance"},selfManagedPresenter:{defaultValue:true,type:"boolean",category:"Behavior"},showLabelFlag:{defaultValue:false,type:"boolean"}},addElement:function(o){var p=this;var n=o.element;if(p.elementsList!==undefined){p.elementsList.push(n)}p._updatePopupContentView()},addElements:function(o){var p=this;var n=o.elementsList;if(p.elementsList!==undefined&&n!==undefined){n.forEach(function(q){p.elementsList.push(q)})}p._updatePopupContentView()},buildView:function(){var n=this;n._parent();n.elements.container.addClassName("wafr-dropdown-container");if(this._typeRepFactory===undefined){this._typeRepFactory=new m();this._typeRepFactory.registerTypeRepresentations(b);this._typeRepFactory.registerTypeTemplates(c)}},getElement:function(n){var p=this;var q=n.identifier;var o;p.elementsList.forEach(function(r){if(r.identifier===q){o=r}});return o},getElementsList:function(){var n=this;return n.elementsList},handleEvents:function(){var n=this;if(n.elements.arrowButton!==undefined){n.elements.arrowButton.addEventListener("click",function(o){o.stopPropagation();if(n.disabled!==true){n.togglePopup()}})}if(n.elements.dropDownPopup!==undefined){n.elements.dropDownPopup.addEventListener("change",function(p){if(n.selfManagedPresenter===true){var q=p.dsModel;var o;n.elementsList.forEach(function(r){if(q===r.view){o=r}});if(o!==undefined){n.currentValue=o}}n.hidePopup()})}if(n.elements.presenterButton!==undefined){n.elements.presenterButton.addEventListener("click",function(r){if(n.actionOnClickFlag===false){r.stopPropagation();if(n.disabled!==true){n.togglePopup()}}if(n.actionOnClickFlag===true&&n.elements.presenterButton.type==="check"&&n.currentValue!==undefined&&n.disabled!==true){var o=(n.currentValue.identifier!==undefined)?n.currentValue:n.getElement({identifier:n.currentValue});var p=(n.currentValuePresenterLink!==undefined)?n.currentValuePresenterLink:o.presenterLink;var q=(o.tweakerType!==undefined)?o.view.elements.internalView:o.view;q[p.checkFlag]=n.elements.presenterButton.checkFlag}n.fire("presenterClick")})}},hidePopup:function(){var n=this;if(n.popupVisibleFlag===true){n.popupVisibleFlag=false;if(n.elements.dropDownPopup!==undefined){n.elements.dropDownPopup.hide();n._updateDocumentEvents()}n._updateTriggerButton()}},showPopup:function(){var n=this;if(n.popupVisibleFlag===false){n.popupVisibleFlag=true;if(n.elements.dropDownPopup!==undefined){n.elements.dropDownPopup.show();n._updateDocumentEvents()}n._updateTriggerButton()}},togglePopup:function(){(this.popupVisibleFlag===true)?this.hidePopup():this.showPopup()},setPresenterRessources:function(n){var o=this;if(o.modifiablePresenterFlag!==false||n===undefined||o.elements===undefined||o.elements.presenterButton===undefined){return}if(n.title!==undefined){o.elements.presenterButton.label=n.title;o.elements.presenterButton.showLabelFlag=o.touchMode}if(n.tootlipInfos!==undefined){o.elements.presenterButton.tootlipInfos=n.tootlipInfos}if(n.icon!==undefined){o.elements.presenterButton.icon=n.icon}},_applyTouchMode:function(){var p=this;p._parent();if(p.elements.presenterButton!==undefined){p.elements.presenterButton.touchMode=p.touchMode;if(p.elements.presenterButton&&p.currentValue!==undefined&&p.modifiablePresenterFlag!==false){if(p.touchMode===true){var n=p.currentValue;if(n===undefined){return}var o=(p.currentValuePresenterLink!==undefined)?p.currentValuePresenterLink:n.presenterLink;var q=(n.tweakerType!==undefined)?n.view.elements.internalView:n.view;if(o.title!==undefined){p.elements.presenterButton.label=" ";if(p.showLabelFlag){p.elements.presenterButton.label=a.createEllipsisText({label:q[o.title],nbLinesVisible:2,maxWidth:"67px",lineHeight:14,allowUnsafeHTMLLabel:false});p.elements.presenterButton.elements.text.setContent(p.elements.presenterButton.label)}else{p.elements.presenterButton.label=q[o.title]}}}}}if(p.elements.arrowButton!==undefined){p.elements.arrowButton.touchMode=p.touchMode}},_applyShowLabelFlag:function(){var p=this;p._parent();if(p.elements.presenterButton!==undefined){p.elements.presenterButton.showLabelFlag=p.showLabelFlag;if(p.elements.presenterButton&&p.currentValue!==undefined&&p.modifiablePresenterFlag!==false){if(p.showLabelFlag===true){var n=p.currentValue;if(n===undefined){return}var o=(p.currentValuePresenterLink!==undefined)?p.currentValuePresenterLink:n.presenterLink;var q=(n.tweakerType!==undefined)?n.view.elements.internalView:n.view;if(o.title!==undefined){p.elements.presenterButton.label=" ";p.elements.presenterButton.label=a.createEllipsisText({label:q[o.title],nbLinesVisible:2,maxWidth:"67px",lineHeight:14,allowUnsafeHTMLLabel:false});p.elements.presenterButton.elements.text.setContent(p.elements.presenterButton.label)}}}}if(p.elements.arrowButton!==undefined){p.elements.arrowButton.showLabelFlag=p.showLabelFlag;if(p.showLabelFlag===true){p.elements.arrowButton.elements.container.setAttributeNode(document.createAttribute("showlabel"))}else{p.elements.arrowButton.elements.container.removeAttribute("showlabel")}}},_applyActionOnClickFlag:function(){var n=this;if(n.elements.presenterButton!==undefined){return}if(this.actionOnClickFlag){n._buildSplitFlyout()}else{n._buildUnifiedFlyout()}},_applyOrientation:function(){var o=this;if(o.elements!==undefined&&o.elements.arrowButton!==undefined){if(o.elements.arrowButton){var n=e.getWebappsBaseUrl();if(o.orientation==="top"){n+="WAfrControls/assets/icons/arrow-t.png";o.elements.arrowButton.icon=n}else{if(o.orientation==="bottom"){n+="WAfrControls/assets/icons/arrow-b.png";o.elements.arrowButton.icon=n}}}if(o.elements.dropDownPopup){o.elements.dropDownPopup.orientation=o.orientation;if(o.orientation==="top"){o.elements.dropDownPopup.offset={x:0,y:-4}}else{if(o.orientation==="bottom"){o.elements.dropDownPopup.offset={x:0,y:4}}}}}},_applyPopupVisibleFlag:function(){var n=this;if(this.popupVisibleFlag){n.showPopup()}else{n.hidePopup()}},_applyProperties:function(n){this._parent(n);if(this.isDirty("orientation")){this._applyOrientation()}if(this.isDirty("actionOnClickFlag")){this._applyActionOnClickFlag()}if(this.isDirty("popupVisibleFlag")){this._applyPopupVisibleFlag()}},_buildPopup:function(){var o=this;var n={target:o.elements.container,position:o.orientation,offset:o.orientation==="top"?{x:0,y:-4}:{x:0,y:4},alignment:"left",constraint:"screen",visibleFlag:false,overlap:false,arrowBoxFlag:false,trigger:"",autoHide:true};o.elements.dropDownPopup=new d(n)},_buildSplitFlyout:function(){var o=this;this.elements.presenterButton=new j({touchMode:o.touchMode,displayStyle:"icon",showLabelFlag:o.showLabelFlag});this.elements.presenterButton.inject(this.elements.container);this.elements.presenterButton.getContent().addClassName("wafr-dropdown-presenterButtonSplit");var n=e.getWebappsBaseUrl();if(o.orientation==="top"){n+="WAfrControls/assets/icons/arrow-t.png"}else{if(o.orientation==="bottom"){n+="WAfrControls/assets/icons/arrow-b.png"}}this.elements.arrowButton=new j({touchMode:o.touchMode,preferredWidth:11,minWidth:11,displayStyle:"icon",icon:n});this.elements.arrowButton.inject(this.elements.container);this.elements.arrowButton.getContent().addClassName("wafr-dropdown-arrow")},_buildUnifiedFlyout:function(){var n=this;this.elements.presenterButton=new j({touchMode:n.touchMode,type:"check",preferredWidth:n.touchMode||n.showLabelFlag?86:47,minWidth:n.touchMode||n.showLabelFlag?86:47,displayStyle:"icon",icon:e.getWebappsBaseUrl()+"Tests_WAfrTweakers/assets/icons/I_Customize.png",showLabelFlag:n.showLabelFlag});this.elements.presenterButton.inject(this.elements.container)},_postBuildView:function(){var n=this;n._buildPopup()},_postEditCurrentValue:function(){var u=this;if(u.currentValue.identifier===undefined){u.currentValue=u.getElement({identifier:u.currentValue})}if(this.elements.presenterButton&&u.currentValue!==undefined&&u.modifiablePresenterFlag===true){var r=u.currentValue;if(r===undefined){return}var q=(u.currentValuePresenterLink!==undefined)?u.currentValuePresenterLink:r.presenterLink;var o=(r.tweakerType!==undefined)?r.view.elements.internalView:r.view;var s=q.type;var w=q.icon;var p=q.tooltipInfos;var t=q.checkFlag;var v=q.title;this.elements.presenterButton.type=o[s];this.elements.presenterButton.icon=o[w];var n={position:"top",mouseRelativePosition:false};l({source:o.tooltipInfos,target:n});this.elements.presenterButton.tooltipInfos=new h(n);if(o[p]){o[p].position="right"}this.elements.presenterButton.checkFlag=o[t];if(v!==undefined){this.elements.presenterButton.label=a.createEllipsisText({label:o[q.title],nbLinesVisible:2,maxWidth:"67px",lineHeight:14,allowUnsafeHTMLLabel:false});if(u.elements.presenterButton.elements.text){u.elements.presenterButton.elements.text.setContent(u.elements.presenterButton.label)}}}u.fire("change")},_updateDocumentEvents:function(){var o=this;function n(){o.hidePopup()}if(o.popupVisibleFlag===true){document.body.addEventListener("click",n)}else{document.body.removeEventListener("click",n)}},_updatePopupContentView:function(){var p=this;var o=p.elements.dropDownPopup;var n=new g.Element("div",{});p.elementsList.forEach(function(q){var r=new g.Element("div",{});n.addContent(r);r.addContent(q.view);if(p.currentValue===undefined||p.currentValue===null){p.currentValue=q}});o.setBody(n)},_updateTriggerButton:function(){var n=this;var o=n.popupVisibleFlag;if(n.actionOnClickFlag===false&&n.elements.presenterButton!==undefined&&n.elements.presenterButton.type==="check"){n.elements.presenterButton.checkFlag=o}else{if(n.actionOnClickFlag===true&&n.elements.arrowButton!==undefined){n.elements.arrowButton.checkFlag=o}}},_applyDisabled:function(){var n=this;this._parent();if(n.elementsList!==undefined){n.elementsList.forEach(function(o){if(o!==undefined&&o.view!==undefined){o.view.disabled=n.disabled}})}if(n.elements!==undefined){if(n.elements.presenterButton!==undefined){n.elements.presenterButton.disabled=n.disabled}}}});return f});