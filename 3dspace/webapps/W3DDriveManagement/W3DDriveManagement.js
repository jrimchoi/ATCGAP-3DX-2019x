define("DS/W3DDriveManagement/view/ShareTableLayout",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","UWA/Class/Promise","DS/UIKIT/Scroller","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/WAFData/WAFData","DS/Handlebars/Handlebars","text!DS/W3DDriveManagement/template/ShareTableLayout.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement","css!DS/UIKIT/UIKIT.css"],function(j,b,a,l,f,c,h,g,k,d,i,n){var e=new c({renderTo:document.body});var m=b.extend({searchString:"",lastFetchedIndex:0,paginationSize:50,pager:{},domEvents:{"click .restricted__available":"_showRestrictedEmails","click .revoke__access__icon":"_revokeAccess"},setup:function(o){var p=this;this.alert=o.alert;this.template=d.compile(i);this.listenTo(this.collection,"onChange",this.render);this.listenTo(this.collection,"onSync",this.render);this.listenTo(this.collection,"onAdd",this.render);this.listenTo(this.collection,"onRemove",this.render);this.pager=new a({limit:this.paginationSize,offset:0,type:1,showPageLinks:true,max:this.collection.length,events:{onOffsetChange:function(r){p.render();if(r+this.limit>=this.length){var q=p.lastFetchedIndex+1;p.fetchMoreSharedLinks({index:q}).then(function(){if(p.pager.length!==p.collection.length){p.lastFetchedIndex++;p.pager.setLength(p.collection.length);p.pager.onRefresh()}})}}}})},refresh:function(){var o=this;return new l(function(p){o.collection.fetch({onComplete:function(){o.pager.setLength(o.collection.length);o.pager.onRefresh();p()}})})},render:function(){var q=this.pager.offset;this.currentModel=this.collection;var p=this.collection.length>0;if(p){this.currentModel=this.collection.toJSON().slice(q,q+this.paginationSize)}this.container.innerHTML=this.template({isDataAvailable:p,links:this.currentModel,NLS:n});if(this.pager.elements.container.parentNode!==this.container.parentElement.querySelector(".pager")){var o=this.container.parentElement.querySelector(".pager");if(!o){return}o.appendChild(this.pager.elements.container)}},_revokeAccess:function(r){var q=this;var p=r.target;var s=p.dataset.modelId;var o=this.collection.findWhere({id:s});e.dialog({body:n.revokeAccessMessage,title:n.replace(n.revokeAccessFor,{name:o.get("sharedObjectName")}),buttons:[{className:"primary",value:n.revoke,action:function(t){t.hide();o.destroy({onComplete:function(){q.alert.add({message:n.revokeAccessSuccess,className:"success"})},onFailure:function(){q.alert.add({message:n.revokeAccessError,className:"error"})},wait:true})}},{className:"default",value:n.cancel,action:function(t){t.hide()}}]})},_showRestrictedEmails:function(r){var q=r.target;var s=q.dataset.modelId;var p=this.collection.findWhere({id:s});var o=document.createElement("div");if(p.get("restrictions").length===0){o.innerText=n.emptyRestrictions}else{p.get("restrictions").map(function(t){var u=document.createElement("div");u.innerText=t.mail;o.appendChild(u)})}e.dialog({body:o,title:n.replace(n.restrictionsFor,{name:p.get("sharedObjectName")}),buttons:[{className:"primary",value:n.ok,action:function(t){t.hide()}}]})},fetchMoreSharedLinks:function(p){var q=this;var o=p.index;g.mask(this.container);return new l(function(s,r){if(q.collection.last){g.unmask(q.container);return s({offset:q.collection.length-q.paginationSize})}o=typeof o==="number"&&isNaN(o)?0:o;q.collection.fetch({page:o,remove:false,onComplete:function(){g.unmask(q.container);s({offset:q.collection.length})},onFailure:function(){r(arguments)}})})}});return m});define("DS/W3DDriveManagement/Utils/WAFDataForDriveMgt",["DS/WAFData/WAFData"],function(a){var c;var b={};return{authenticatedRequest:function(f,e){var d=Object.assign({},e);d.headers=Object.assign({},d.headers);d.headers["X-DS-CSRFTOKEN"]=c||"";var g=d.onComplete;d.onComplete=function(k,j,i){var h=Object.keys(j).filter(function(l){return l.search(/x-ds-csrftoken/i)!==-1});c=h.length>0?j[h[0]]:c;if(typeof g==="function"){g(k,j,i)}};return a.authenticatedRequest(f,d)},getPlatform:function(){return b},setPlatform:function(d){b=d}}});define("DS/W3DDriveManagement/W3DDriveManagementWidget",["UWA/Array","UWA/Class/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformAPI/PlatformAPI","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(c,h,b,i,j){var a=false,k,e;function f(){return new h(function(m,l){b.getPlatformServices({onComplete:function(o){var n;if(o){n=o.filter(function(p){return p["3DDrive"]}).map(function(q){if(q){var p={tenant:q.platformId,displayName:q.displayName,url:q["3DDrive"],urlSwym:q["3DSwym"]};return p}})}m(n)},onFailure:l})})}function g(l){return new h(function(r,q){if(!l){q("Unexpected error")}var o,m={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[],onchange:"onStorageChange"},p=k.getValue("collab-storage");if(p===""){var n=k.getValue("x3dPlatformId");var o=c.detect(l,function(s){return s.tenant===n});if(!o){o=l[0]}if(o){k.setValue("collab-storage",o.tenant)}}else{o=c.detect(l,function(s){return s.tenant===p})}l.forEach(function(s){m.options.push({label:s.displayName,value:s.tenant})});if(l.length===1&&o){m.type="hidden"}k.addPreference(m);if(a){k.dispatchEvent("onEdit",["refreshPrefs"]);if(!o){o=l[0]}}i.subscribe("PlatformManagement.renamePlatformName",function(s){k.setTitle(s);o.set("displayName",s)});if(o){k.setTitle(o.displayName);r(o)}else{q(j.updatePreference)}})}var d={init:function(m,n){var l=this;k=m;require([n],function(o){e=new o({container:k.body});e.render();k.addEvents({onRefresh:function(){if(l.storageChange){var p=l.storageChange;delete l.storageChange;f().then(function(r){var q=c.detect(r,function(s){return s.tenant===p});k.setTitle(q.displayName);e.refresh({platform:q})})["catch"](function(q){e.error(q)})}else{e.refresh()}},onStorageChange:function(q,p){l.storageChange=p},onEdit:function(q){a=true;if(q!=="refreshPrefs"){var p={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[{label:"Loading",value:""}],onchange:"onStorageChange"};k.addPreference(p);k.dispatchEvent("onEdit",["refreshPrefs"]);f().then(g)["catch"](function(r){e.error(r)})}},endEdit:function(p){a=false}});f().then(g).then(function(p){e.refresh({platform:p})})["catch"](function(p){e.error(j.fetchError)})})}};return d});define("DS/W3DDriveManagement/Models/Usage",["UWA/Class/Model","DS/W3DContentApp/Utils/Helpers"],function(c,b){var a=c.extend({defaults:{user:"",username:"",email:"",usage:0,usageNLS:"",ratio:0,active:"",driveid:""},idAttribute:"user",parse:function(d,e){var g=1000000*e.quota.get("defaultquota");var f=Math.ceil(d.usage/g*100);return{user:d.user,username:d.username,email:d.email,usage:d.usage,usageNLS:b.computeNLSSize(d.usage),ratio:f,active:d.active,driveid:d.driveid}}});return a});define("DS/W3DDriveManagement/Models/Drive",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(c,b){var a=c.extend({defaults:{physicalid:"",fullnameowner:"",title:"",status:"",ownerstatus:"",actions:[]},idAttribute:"physicalid",url:function(d){var e=this.get("physicalid")?this.get("physicalid"):d.driveid;return b.getPlatform().url+"/resources/3ddrive/v1/admin/drives/"+e+"?withactions=true&tenant="+b.getPlatform().tenant},fetch:function(e){var d=Object.assign({ajax:b.authenticatedRequest,url:this.url(e)},e);return this._parent(d)},parse:function(d){return d},destroy:function(e){var d=Object.assign({method:"DELETE",ajax:b.authenticatedRequest},e);return this._parent(d)}});return a});define("DS/W3DDriveManagement/Collections/Drives",["UWA/Class/Collection","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Models/Drive"],function(d,c,a){var b=d.extend({model:a,date:"",url:function(){return c.getPlatform().url+"/resources/3ddrive/v1/admin/drives?tenant="+c.getPlatform().tenant+"&"+new Date().getTime()},fetch:function(f){var e=Object.assign({proxy:"passport"},f);return this._parent(e)},parse:function(e){this.date=e.update;return e.users}});return b});define("DS/W3DDriveManagement/Models/IterationsDays",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(c,a){var b=c.extend({defaults:{iterationsdays:0},idAttribute:"iterationsdays",url:function(){return a.getPlatform().url+"/resources/3ddrive/v1/admin/iterationsdays?tenant="+a.getPlatform().tenant},fetch:function(e){var d=Object.assign({ajax:a.authenticatedRequest,},e);return this._parent(d)},parse:function(d){return d}});return b});define("DS/W3DDriveManagement/Models/AccessCapacity",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(b,a){return b.extend({defaults:{quota:0,total:0},url:function(){return a.getPlatform().url+"/resources/share/admin/accesscapacity"},sync:function(f,e,d){var c=Object.assign({ajax:a.authenticatedRequest,},d);return this._parent(f,e,c)},parse:function(c){return c}})});define("DS/W3DDriveManagement/Collections/Usages",["UWA/Class/Collection","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Models/Usage"],function(d,c,b){var a=d.extend({model:b,date:"",url:function(){return c.getPlatform().url+"/resources/3ddrive/v1/admin/usages?tenant="+c.getPlatform().tenant+"&"+new Date().getTime()},fetch:function(f){var e=Object.assign({proxy:"passport"},f);return this._parent(e)},parse:function(e){this.date=e.update;return e.users}});return a});define("DS/W3DDriveManagement/view/TableLayout",["UWA/Core","UWA/Class/View","DS/UIKIT/Scroller","DS/Handlebars/Handlebars","DS/UIKIT/SuperModal","DS/UIKIT/DropdownMenu","DS/W3DDriveManagement/Models/Drive","text!DS/W3DDriveManagement/template/TableLayout.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(g,b,f,d,c,a,i,h,j){var e=b.extend({searchString:"",domEvents:{"click .sortable.fonticon":"_sort","click .fonticon-chevron-down":"_manageOptions"},setup:function(k){var l=this;l.alert=k.alert;l.template=d.compile(h);if(!("ifCond" in d.helpers)){d.registerHelper("ifCond",function(p,m,o,n){switch(m){case"==":return(p==o)?n.fn(this):n.inverse(this);case"===":return(p===o)?n.fn(this):n.inverse(this);case"!=":return(p!=o)?n.fn(this):n.inverse(this);case"!==":return(p!==o)?n.fn(this):n.inverse(this);case"<":return(p<o)?n.fn(this):n.inverse(this);case"<=":return(p<=o)?n.fn(this):n.inverse(this);case">":return(p>o)?n.fn(this):n.inverse(this);case">=":return(p>=o)?n.fn(this):n.inverse(this);case"&&":return(p&&o)?n.fn(this):n.inverse(this);case"||":return(p||o)?n.fn(this):n.inverse(this);default:return n.inverse(this)}})}this.listenTo(this.collection,"onAnyEvent",this.render)},render:function(){var l=this;l.currentModel=l.collection.toJSON();if(l.searchString!==""){l.currentModel=l.currentModel.filter(function(n){return(n.username.toLowerCase().indexOf(l.searchString.toLowerCase())>=0||n.email.toLowerCase().indexOf(l.searchString.toLowerCase())>=0)})}l.container.innerHTML=l.template({users:l.currentModel,NLS:j});var m=this.container;var k=this.getElement(".table-layout");new f({element:k}).inject(m)},_sort:function(l){var m=l.target.className;var k=m.substring(m.lastIndexOf(" ")+1);if(m.indexOf("expand-down")!==-1){this.collection.comparator=function(o){var n=o.get(k);if(typeof n==="string"){n=n.toLowerCase();n=n.split("");n=n.map(function(p){return String.fromCharCode(-(p.charCodeAt(0)))});return n}else{if(typeof n==="number"){return -n}else{console.log("type cannot be sorted")}}}}else{this.collection.comparator=k}this.collection.sort()},_search:function(l){var k=this;k.searchString=l;k.render()},_manageOptions:function(o){var n=this;var m=o.target;var q=m.dataset.modelId;var k=this.collection.findWhere({user:q});var l=[{text:j.manageDrive,fonticon:"cog",handler:function(){n._manageDrive(k)}}];if(k.get("active")!=="TRUE"){l.push({text:j.deleteText,fonticon:"trash",handler:function(){n._deleteDrive(k)}})}var p=new a({target:m,items:l,events:{onHide:function(){p.destroy()}}}).show()},_fetchDrive:function(k){var l=new i();return new Promise(function(n,m){l.fetch({driveid:k.get("driveid"),onComplete:function(q,o,p){n(q)},onFailure:function(p,q,o){m({errorType:p,errorCode:q,errorMsg:o,model:k})}})})},_handleFetchDriveError:function(k){var l=this;if(k.errorCode.indexOf("412")!==-1){l.alert.add({message:j.replace(j.alreadyDeletedDrive,{username:k.model.get("username")}),className:"warning"})}else{l.alert.add({message:j.fetchError,className:"error"})}},_manageDrive:function(k){var l=this;this._fetchDrive(k).then(function(m){if(m){require(["DS/W3DDriveManagement/view/DriveManager"],function(n){var o=new n({drive:m,alert:l.alert});o.render()})}},function(m){l._handleFetchDriveError(m)})},_deleteDrive:function(k){var l=this;this._fetchDrive(k).then(function(n){var m=new c({renderTo:document.body});m.dialog({title:j.replace(j.deleteDriveTitle,{username:n.get("fullnameowner")}),body:j.deleteDriveMessage,buttons:[{className:"primary",value:j.deleteText,action:function(o){o.hide();n.destroy({driveid:n.get("physicalid"),onComplete:function(){l.alert.add({message:j.replace(j.deleteDriveSuccess,{username:n.get("fullnameowner")}),className:"success"})},onFailure:function(){l.alert.add({message:j.replace(j.deleteDriveError,{username:n.get("fullnameowner")}),className:"error"})},wait:true})}},{className:"default",value:j.cancel,action:function(o){o.hide()}}]})},function(m){l._handleFetchDriveError(m)})}});return e});define("DS/W3DDriveManagement/Models/Quota",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(c,b){var a=c.extend({defaults:{defaultquota:0,quota:0},idAttribute:"defaultquota",url:function(){return b.getPlatform().url+"/resources/3ddrive/v1/admin/quota?tenant="+b.getPlatform().tenant},fetch:function(e){var d=Object.assign({ajax:b.authenticatedRequest,},e);return this._parent(d)},parse:function(d){return d}});return a});define("DS/W3DDriveManagement/Models/IterationsNumber",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(c,b){var a=c.extend({defaults:{iterationsnumber:0},idAttribute:"iterationsnumber",url:function(){return b.getPlatform().url+"/resources/3ddrive/v1/admin/iterationsnumber?tenant="+b.getPlatform().tenant},fetch:function(e){var d=Object.assign({ajax:b.authenticatedRequest,},e);return this._parent(d)},parse:function(d){return d}});return a});define("DS/W3DDriveManagement/Models/ShareAccess",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(c,a){var b=c.extend({defaults:{sharebylink:false},idAttribute:"sharebylink",url:function(){return a.getPlatform().url+"/resources/3ddrive/v1/admin/sharebylink?tenant="+a.getPlatform().tenant},parse:function(d){if(d){return{sharebylink:d.sharebylink==="true"}}},sync:function(f,e,d){if(f==="update"){d.data=JSON.stringify({sharebylink:e.get("sharebylink")?"true":"false"});d.headers={"Content-Type":"application/json"}}return this._parent(f,e,d)},fetch:function(e){var d=Object.assign({ajax:a.authenticatedRequest,},e);return this._parent(d)}});return b});define("DS/W3DDriveManagement/view/W3DDriveManagementUsage",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","DS/W3DDriveManagement/view/TableLayout","text!DS/W3DDriveManagement/template/W3DDriveManagementUsage.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(g,f,e,a,c,d){var b=f.extend({domEvents:{"click .search-button":"_search","submit form.usage-form":"_search"},setup:function(h){var i=this;this.alert=h.alert;i.template=e.compile(c);this.listenTo(this.collection,"onReset",this.render)},render:function(){var j=this;var i=j.collection.date;if(i){i=new Date(i);i=i.toLocaleDateString()+" "+i.toLocaleTimeString()}var h=j.collection.length>0;j.container.innerHTML=j.template({Date:i,hasDrives:h,NLS:d});if(h){j.tableLayout=new a({alert:j.alert,container:j.container.getElement(".drive__table"),collection:j.collection});j.tableLayout.render()}},_search:function(i){i.preventDefault();var h=this;h.tableLayout._search(h.container.getElement(".search-input").value)}});return b});define("DS/W3DDriveManagement/view/W3DDriveManagementSettings",["UWA/Core","UWA/Class/View","UWA/Class/Promise","DS/WAFData/WAFData","DS/Handlebars/Handlebars","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Models/AccessCapacity","DS/W3DDriveManagement/view/ShareTableLayout","DS/W3DDriveManagement/Models/IterationsDays","DS/W3DDriveManagement/Models/IterationsNumber","text!DS/W3DDriveManagement/template/W3DDriveManagementSettings.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(h,a,i,j,b,d,c,k,l,o,n,f,g,m){var e=a.extend({domEvents:{"change .shareaccess .toggle-switch":"_onChangeShareByLinkValue","click .save-button-quota":"_saveQuota","click .cancel-button-quota":"_cancelQuota","keyup .quota-input":"_onKeyupQuotas","click .iterations-number .save-button":"_saveIterationsNumber","click .iterations-number .cancel-button":"_cancelIterationsNumber","keyup .iterations-number input":"_onKeyupIterationsNumber","click .iterations-days .save-button":"_saveIterationsDays","click .iterations-days .cancel-button":"_cancelIterationsDays","keyup .iterations-days input":"_onKeyupIterationsDays"},setup:function(p){if(p){this.alert=p.alert}this.template=b.compile(g);this.sharedLinks=this.options.sharedLinks;this.shareAccess=this.options.shareAccess;this.iterationsDays=new n();this.iterationsNumber=new f();this.listenTo(this.model,"onChange",this._updateQuota);this.listenTo(this.shareAccess,"onChange",this._updateSharedLinksTable);this.listenTo(this.shareAccess,"onChange",this._updateAccessCapacity);this.listenTo(this.shareAccess,"onSync",this._updateToggleShareByLink);this.listenTo(this.iterationsDays,"onSync",this._updateIterationsDays);this.listenTo(this.iterationsNumber,"onSync",this._updateIterationsNumber);this.accessCapacity=new l()},refresh:function(){var p=this;this._updateAccessCapacity();return i.all([this._fetchIterationsDays(),this._fetchIterationsNumber(),this._fetchShareByLinkActivated().then(function(){if(p.shareAccess.get("sharebylink")===true&&p.shareTableLayout){p.shareTableLayout.refresh()}})])["catch"](function(){p.alert.add({message:m.fetchError,className:"error"})})},render:function(q){var r=this;this.buildView(q);var p=this.container.children[0];d.mask(p);return i.all([this._fetchShareByLinkActivated(),this._fetchIterationsDays(),this._fetchIterationsNumber()])["catch"](function(){r.alert.add({message:m.fetchError,className:"error"})})["finally"](function(){d.unmask(p)})},buildView:function(){this.container.innerHTML="";this.container.innerHTML=this.template({NLS:m});this._buildQuotaView();this._buildIterationsView();this._updateSharedLinksTable();this._updateAccessCapacity();this._addScroller()},_addScroller:function(){var q=this.container;var p=this.getElement(".drive__management__settings__content");new c({element:p}).inject(q)},_buildQuotaView:function(){var p=this.container.querySelector.bind(this.container);this.elements.quota={buttonCancel:p(".cancel-button-quota"),buttonValidation:p(".save-button-quota"),input:p(".quota-input"),};this._updateQuota()},_buildIterationsView:function(){var q=".iterations-number";var p=this.container.querySelector.bind(this.container);this.elements.iterationsNumber={buttonCancel:p(q+" .cancel-button"),buttonValidation:p(q+" .save-button"),input:p(q+" input"),};var r=".iterations-days";this.elements.iterationsDays={buttonCancel:p(r+" .cancel-button"),buttonValidation:p(r+" .save-button"),input:p(r+" input"),}},_cancelIterationsNumber:function(){this._disableButtonsIterationsNumber();this.elements.iterationsNumber.input.value=this.iterationsNumber.get("iterationsnumber")},_disableButtonsIterationsNumber:function(){this.elements.iterationsNumber.buttonCancel.disabled=true;this.elements.iterationsNumber.buttonValidation.disabled=true},_disableButtonValidationIterationsNumber:function(){this.elements.iterationsNumber.buttonValidation.disabled=true},_enableButtonValidationIterationsNumber:function(){this.elements.iterationsNumber.buttonValidation.disabled=false},_fetchIterationsNumber:function(){var p=this;return new i(function(r,q){p.iterationsNumber.fetch({onComplete:function(t,s){r(s)},onFailure:function(){q(arguments)}})})},_onKeyupIterationsNumber:function(p){if(this.elements.iterationsNumber.input.value===this.iterationsNumber.get("iterationsnumber")){this._disableButtonsIterationsNumber();return}if(p.key==="Enter"){this._saveIterationsNumber();return}this.elements.iterationsNumber.buttonCancel.disabled=false;if(this.elements.iterationsNumber.input.checkValidity()){this._enableButtonValidationIterationsNumber();return}this._disableButtonValidationIterationsNumber()},_saveIterationsNumber:function(){var q=this;var p=this.elements.iterationsNumber.input;var r=p.value;if(p.checkValidity()===false){this.alert.add({message:m.iterationsWrongValue,className:"error"});return}this._disableButtonsIterationsNumber();this.iterationsNumber.save({iterationsnumber:r},{ajax:k.authenticatedRequest,onComplete:function(){q.alert.add({message:m.saveSuccess,className:"success"})},onFailure:function(){q.alert.add({message:m.saveError,className:"error"});p.value=q.iterationsNumber.get("iterationsnumber")},wait:true})},_updateIterationsNumber:function(){this.elements.iterationsNumber.input.value=this.iterationsNumber.get("iterationsnumber")},_cancelIterationsDays:function(){this._disableButtonsIterationsDays();this.elements.iterationsDays.input.value=this.iterationsDays.get("iterationsdays")},_disableButtonsIterationsDays:function(){this.elements.iterationsDays.buttonCancel.disabled=true;this.elements.iterationsDays.buttonValidation.disabled=true},_disableButtonValidationIterationsDays:function(){this.elements.iterationsDays.buttonValidation.disabled=true},_enableButtonValidationIterationsDays:function(){this.elements.iterationsDays.buttonValidation.disabled=false},_fetchIterationsDays:function(){var p=this;return new i(function(r,q){p.iterationsDays.fetch({onComplete:function(t,s){r(s)},onFailure:function(){q(arguments)}})})},_onKeyupIterationsDays:function(p){if(this.elements.iterationsDays.input.value===this.iterationsDays.get("iterationsdays")){this._disableButtonsIterationsDays();return}if(p.key==="Enter"){this._saveIterationsDays();return}this.elements.iterationsDays.buttonCancel.disabled=false;if(this.elements.iterationsDays.input.checkValidity()){this._enableButtonValidationIterationsDays();return}this._disableButtonValidationIterationsDays()},_saveIterationsDays:function(){var q=this;var p=this.elements.iterationsDays.input;var r=p.value;if(p.checkValidity()===false){this.alert.add({message:m.iterationsWrongValue,className:"error"});return}this._disableButtonsIterationsDays();this.iterationsDays.save({iterationsdays:r},{ajax:k.authenticatedRequest,onComplete:function(){q.alert.add({message:m.saveSuccess,className:"success"})},onFailure:function(){q.alert.add({message:m.saveError,className:"error"});p.value=q.iterationsDays.get("iterationsdays")},wait:true})},_updateIterationsDays:function(){this.elements.iterationsDays.input.value=this.iterationsDays.get("iterationsdays")},_fetchShareByLinkActivated:function(){var p=this;return new i(function(r,q){p.shareAccess.fetch({onComplete:function(t,s){r(s)},onFailure:function(){q(arguments)}})})},_onChangeShareByLinkValue:function(r){var q=this;var s=r.target.checked;var p=!s;this.shareAccess.save({sharebylink:s},{ajax:k.authenticatedRequest,onComplete:function(u,t){var v="";if(s){v=m.shareByLinkActivationSuccess}else{v=m.shareByLinkDeactivationSuccess}q.alert.add({message:v,className:"success"})},onFailure:function(){var t="";var u=r.srcElement||r.target;u.checked=p;if(s){t=m.shareByLinkActivationError}else{t=m.shareByLinkDeactivationError}q.alert.add({message:t,className:"error"})},wait:true})},_updateSharedLinksTable:function(){var p=this.container.querySelector(".drive__share__table");if(!p){return}if(!this.shareAccess.get("sharebylink")){p.classList.add("drive__share__table--hidden");return}p.classList.remove("drive__share__table--hidden");if(this.shareTableLayout){this.shareTableLayout.refresh();return}this.shareTableLayout=new o({container:this.container.getElement(".drive__sharetable"),collection:this.sharedLinks,platform:k.getPlatform(),alert:this.alert});this.shareTableLayout.refresh()},_updateAccessCapacity:function(){var p=this;this.elements.accessCapacitySection=this.container.querySelector(".accesscapacity");this.elements.accessCapacityProgress=this.container.querySelector(".accesscapacity__progress");this.elements.accessCapacityProgressValue=this.container.querySelector(".accesscapacity__progress .progress-bar");this.elements.accessCapacityTotal=this.container.querySelector(".accesscapacity__total");if(!this.elements.accessCapacitySection){return}if(!this.shareAccess.get("sharebylink")){this.elements.accessCapacitySection.classList.add("accesscapacity--hidden");return}this.elements.accessCapacitySection.classList.remove("accesscapacity--hidden");this.accessCapacity.fetch({onComplete:function(q){var t=q.get("quota");var s=q.get("total");var r=p.mathTrunc(t*100/s);p.elements.accessCapacityTotal.innerText=m.replace(m.totalCapacity,{total:s});p.elements.accessCapacityProgress.classList.remove("w-0-percent");p.elements.accessCapacityProgress.classList.add("w-"+r+"-percent");p.elements.accessCapacityProgressValue.innerText=r+"%"},onFailure:function(){p.elements.accessCapacityProgress.classList.add("w-0-percent")}})},_toggleShareAccessTable:function(){var p=this.container.querySelector(".drive__share__table");if(!p){return}if(!this.shareAccess.get("sharebylink")){p.classList.add("drive__share__table--hidden");return}p.classList.remove("drive__share__table--hidden");if(this.shareTableLayout){this.shareTableLayout.refresh();return}this.shareTableLayout=new o({container:this.container.getElement(".drive__sharetable"),collection:this.sharedLinks,platform:k.getPlatform(),alert:this.alert});this.shareTableLayout.refresh()},_updateToggleShareByLink:function(){var p=this.container.querySelector(".shareaccess #checkbox-sharebylink");var q=this.container.querySelector(".shareaccess__label");if(!p||!q){return}if(this.shareAccess.get("sharebylink")){p.checked=true;return}p.checked=false},_cancelQuota:function(){this._disableButtonsQuota();this.elements.quota.input.value=this.model.get("defaultquota")},_disableButtonsQuota:function(){this.elements.quota.buttonCancel.disabled=true;this.elements.quota.buttonValidation.disabled=true},_disableButtonValidationQuota:function(){this.elements.quota.buttonValidation.disabled=true},_enableButtonValidationQuota:function(){this.elements.quota.buttonValidation.disabled=false},_onKeyupQuotas:function(p){if(this.elements.quota.input.value===this.model.get("defaultquota")){this._disableButtonsQuota();return}if(p.key==="Enter"){this._saveQuota();return}this.elements.quota.buttonCancel.disabled=false;if(this.elements.quota.input.checkValidity()){this._enableButtonValidationQuota();return}this._disableButtonValidationQuota()},_saveQuota:function(){var q=this;var r=this.elements.quota.input.value;var p=this.model.get("defaultquota");if(this.elements.quota.input.checkValidity()===false){this.alert.add({message:m.quotaWrongValue,className:"error"});return}this._disableButtonsQuota();this.model.save({defaultquota:r},{ajax:k.authenticatedRequest,onComplete:function(){q.alert.add({message:m.saveSuccess,className:"success"})},onFailure:function(){q.alert.add({message:m.saveError,className:"error"});q.elements.quota.input.value=p},wait:true})},_updateQuota:function(){this.elements.quota.input.value=this.model.get("defaultquota")},mathTrunc:function(p){if(Math.trunc){return Math.trunc(p)}return(function(q){if(isNaN(q)){return NaN}if(q>0){return Math.floor(q)}return Math.ceil(q)})(p)}});return e});define("DS/W3DDriveManagement/Models/Access",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(c,a){return c.extend({"default":{id:"",login:"",name:"",fname:"",lname:"",email:"",accessright:"",actions:[]},idAttribute:"id",url:function(f){var d=f||{};var e=a.getPlatform().url+"/resources/3ddrive/v1/admin/drives/"+d.driveid+"/shares";if(d.action==="delete"){e+="/"+d.userid}var g="?withactions=true";return e+g},parse:function(d){var e=b(d.login);return Object.assign(d,{picture:e})},save:function(e,d){var f=Object.assign({data:JSON.stringify({id:this.get("userid")}),ajax:a.authenticatedRequest,url:this.url(Object.assign(d,{userid:this.get("userid")})),headers:{"Content-Type":"application/json"},method:"POST"},d);this._parent(this,f)},destroy:function(e){var d=Object.assign({method:"DELETE",ajax:a.authenticatedRequest,url:this.url(Object.assign(e,{action:"delete"}))},e);return this._parent(d)}});function b(d){var e=a.getPlatform().urlSwym+"/api/user/getpicture/login/"+d+"/format/normal";return e}});define("DS/W3DDriveManagement/Models/SharedLink",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(b,a){return b.extend({"default":{expirationDate:"",id:"",modificationDate:"",platform:{},restricted:false,restrictions:[],service:"",sharedObjectName:"",sharer:"",sharerFullName:"",tenant:"",url:""},idAttribute:"id",url:function(){return a.getPlatform().url+"/resources/share/admin/accesses/"+this.get("id")},setup:function(c){var d=this.collection;if(d){this.platform=d.platform}return this._parent(c)},parse:function(c){return{expirationDate:new Date(c.expiration).toLocaleString(),id:c.objectid,modificationDate:new Date(c.modified).toLocaleString(),restricted:c.restricted,restrictions:c.restrictions,service:c.service,sharedObjectName:c.objectName,sharer:c.sharer,sharerFullName:c.sharerFullName,tenant:c.tenant,url:c.url}},destroy:function(d){var c=Object.assign({method:"DELETE",ajax:a.authenticatedRequest,},d);return this._parent(c)}})});define("DS/W3DDriveManagement/view/DriveInformationLayout",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","text!DS/W3DDriveManagement/template/DriveInformationLayout.html","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(g,f,e,c,a,d){var b=f.extend({domEvents:{"click .fonticon-pencil":"_renameDrive","click .btn-rename-drive .btn-primary":"_performRenameDrive","click .btn-rename-drive .btn-default":"_cancelRenameDrive","keyup #drive-rename input":"_onKeyUpRenameDrive"},setup:function(h){this.template=e.compile(c);this.alert=h.alert;this.drive=h.drive;this.listenTo(this.drive,"onAnyEvent",this.render)},render:function(){var h=this;var i=h.drive.toJSON();this.container.innerHTML=h.template({drive:i,NLS:d})},_renameDrive:function(){var i=this.container.querySelector("#drive-rename");i.style.display="initial";var h=this.container.querySelector("#drive-title");h.style.display="none";i.querySelector("input").focus()},_performRenameDrive:function(){var i=this;var h=this.container.querySelector("#drive-rename input").value;var j=this.drive.get("title");if(h===j){return}i.drive.save({title:h},{ajax:a.authenticatedRequest,onComplete:function(){i.alert.add({message:d.saveSuccess,className:"success"});i._cancelRenameDrive()},onFailure:function(){i.alert.add({message:d.saveError,className:"error"})},wait:true})},_onKeyUpRenameDrive:function(){var h=this.container.querySelector("#drive-rename input").value;var i=this.drive.get("title");if(h===i){this._disableRenameDriveButton();return}this._enableRenameDriveButtons();if(event.key==="Enter"){this._performRenameDrive();return}},_cancelRenameDrive:function(){var i=this.container.querySelector("#drive-rename");i.style.display="none";var h=this.container.querySelector("#drive-title");h.style.display=""},_disableRenameDriveButtons:function(){this.container.querySelector(".btn-rename-drive > .btn-primary").disabled=true;this.container.querySelector(".btn-rename-drive > .btn-default").disabled=true},_enableRenameDriveButtons:function(){this.container.querySelector(".btn-rename-drive > .btn-primary").disabled=false;this.container.querySelector(".btn-rename-drive > .btn-default").disabled=false},_enableRenameDriveButton:function(){this.container.querySelector(".btn-rename-drive > .btn-primary").disabled=false},_disableRenameDriveButton:function(){this.container.querySelector(".btn-rename-drive > .btn-primary").disabled=true}});return b});define("DS/W3DDriveManagement/Collections/SharedLinks",["UWA/Class/Collection","DS/W3DDriveManagement/Models/SharedLink","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(b,c,a){return b.extend({model:c,"default":{last:false,first:true,},url:function(f){var d=f||{};var h=a.getPlatform().url+"/resources/share/admin/accesses?";var e="limit=";var g="&page=";e+=d.limit?d.limit:51;g+=d.page?d.page:0;return h+e+g},fetch:function(e){var d=Object.assign({ajax:a.authenticatedRequest,url:this.url(e)},e);return this._parent(d)},parse:function(d){Object.assign(this,{last:d.last,first:d.first,});return d.content}})});define("DS/W3DDriveManagement/view/W3DDriveManagement",["UWA/Core","UWA/Class/View","UWA/Class/Promise","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/Handlebars/Handlebars","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Models/Quota","DS/W3DDriveManagement/Collections/Usages","DS/W3DDriveManagement/Collections/SharedLinks","DS/W3DDriveManagement/Models/ShareAccess","DS/W3DDriveManagement/view/W3DDriveManagementUsage","DS/W3DDriveManagement/view/W3DDriveManagementSettings","text!DS/W3DDriveManagement/template/W3DDriveManagement.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement","css!DS/W3DDriveManagement/W3DDriveManagement.css","css!DS/UIKIT/UIKIT.css"],function(i,b,l,f,d,c,n,p,a,m,k,j,e,h,o){var g=b.extend({domEvents:{"click .usage":"_renderUsage","click .settings":"_renderSetting"},classes:{driveManagementUsage:"drive-management-usage",driveManagementSettings:"drive-management-settings",active:"active",usage:"usage",settings:"settings"},dotClasses:function(q){return"."+this.classes[q]},setup:function(){this.template=c.compile(h);this.quota=new p();this.usages=new a();this.shareAccess=new k();this.sharedLinks=new m()},refresh:function(q){var r=this;d.mask(this.container);if(q&&q.platform){this.platform=q.platform}if(this.platform){n.setPlatform(this.platform);this._fetchQuota().then(function(){var s=[r._fetchUsages()];if(r.settingsView){s.push(r.settingsView.refresh())}l.all(s)})}},_fetchQuota:function(){var q=this;return new l(function(s,r){q.quota.fetch({onComplete:function(v,t,u){q.platform.csrf=u.responseHeaders;s()},onFailure:function(){q.error(o.fetchError);d.unmask(q.container);r()}})})},_fetchUsages:function(){var q=this;return new l(function(s,r){q.usages.fetch({reset:true,quota:q.quota,onComplete:function(){d.unmask(q.container);s()},onFailure:function(v,t,u){if(u.request&&u.request.xhr&&u.request.xhr.status===204){q.error(o.fetchEmpty)}else{q.error(o.fetchError)}d.unmask(q.container);r()}})})},render:function(){this.container.innerHTML=this.template({NLS:o});d.mask(this.container);this.alert=new f({className:"drive-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"error",maximumVisibleMessages:1});this._renderUsage()},error:function(q){this.alert.add({message:q,className:"error"})},_renderUsage:function(){if(!this.usageView){this.usageView=new j({alert:this.alert,container:this.container.getElement(this.dotClasses("driveManagementUsage")),collection:this.usages});this.usageView.render()}this.container.getElement(this.dotClasses("driveManagementSettings")).removeClassName(this.classes.active);this.container.getElement(this.dotClasses("driveManagementUsage")).addClassName(this.classes.active);this.container.getElement(this.dotClasses("settings")).removeClassName(this.classes.active);this.container.getElement(this.dotClasses("usage")).addClassName(this.classes.active)},_renderSetting:function(){if(!this.settingsView){this.settingsView=new e({alert:this.alert,container:this.container.getElement(this.dotClasses("driveManagementSettings")),model:this.quota,shareAccess:this.shareAccess,sharedLinks:this.sharedLinks});this.settingsView.render()}this.container.getElement(this.dotClasses("driveManagementUsage")).removeClassName(this.classes.active);this.container.getElement(this.dotClasses("driveManagementSettings")).addClassName(this.classes.active);this.container.getElement(this.dotClasses("usage")).removeClassName(this.classes.active);this.container.getElement(this.dotClasses("settings")).addClassName(this.classes.active)}});return g});define("DS/W3DDriveManagement/Collections/Accesses",["UWA/String","UWA/Class/Collection","DS/W3DDriveManagement/Models/Access","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],function(c,b,d,a){return b.extend({model:d,url:function(g){var e=g||{};var f=c.format("{0}/resources/3ddrive/v1/admin/drives/{1}/shares?withactions=true&tenant={2}",a.getPlatform().url,e.driveid,a.getPlatform().tenant);return f},fetch:function(f){var e=Object.assign({ajax:a.authenticatedRequest,url:this.url(f)},f);return this._parent(e)},parse:function(e){return e.accesses},create:function(e,f){return this._parent.call(this,{userid:e.userid},f)},})});define("DS/W3DDriveManagement/view/DriveAccessLayout",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Scroller","DS/UIKIT/DropdownMenu","DS/Handlebars/Handlebars","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DXComponents/Views/Item/PanelAddMemberView","DS/W3DDriveManagement/Collections/Accesses","text!DS/W3DDriveManagement/template/DriveAccessLayout.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(i,d,b,e,a,c,k,f,h,g,l){var j=b.extend({domEvents:{"click .fonticon-user-add":"_addAccess","click .paneladdmember-item-view-buttons .btn-default":"_cancelShare","click .fonticon-open-down":"_manageOptions"},setup:function(m){this.template=c.compile(g);this.alert=m.alert;this.drive=m.drive;this.accesses=new h();this.listenTo(this.accesses,"onAnyEvent",this.render);this._fetchAccesses()},render:function(){var p=this;var o=p.drive.toJSON();p.currentCollection=p.accesses;var n=p.accesses.length>0;if(n){p.currentCollection=p.currentCollection.toJSON()}this.container.innerHTML=p.template({drive:o,hasAccesses:n,accesses:p.currentCollection,NLS:l});this._addPanelMemberView();var q=this.getElement(".access-scroller-view");var m=this.getElement(".members-list");new e({element:m}).inject(q)},_fetchAccesses:function(){var m=this;return new Promise(function(o,n){m.accesses.fetch({driveid:m.drive.get("physicalid"),onComplete:function(q,p){o(p)},onFailure:function(){n(arguments)}})})},_addPanelMemberView:function(){var t=this;var m={categories:[{id:"giveEditAccess",name:l.editShareAccess}],suggestFormat:"{fname} {lname}",suggestKey:"login",labelFormat:"{fname} {lname}",placeholder:"",typeDelay:500,minLength:2,getSuggestions:r,saveProcess:u};var v;var w=(function q(){var z;return function(B){if(z){z.cancel();z=null}var A=d.format("{0}/resources/3ddrive/v1/peoples?filter={1}&limit=10&withme=true",k.getPlatform().url,encodeURIComponent(B));return new Promise(function(D,C){k.authenticatedRequest(A,{method:"get",type:"json",onComplete:D,onFailure:C})})}})();var y={};var p=new f(Object.assign(m,y));var s=p.container.querySelector("button.btn-primary");var o=p.container.querySelector("button.btn-default");s.textContent=l.share;o.textContent=l.cancel;var n=p.render;var x=n.apply(p,arguments);p.show();t.container.getElement("#access-members").appendChild(p.container);p.destroy=function(){if(typeof v==="function"){v()}return destroy.apply(this,arguments)};function u(z){var z=z;if(t.drive.get("title")==="My Files"){t.drive.save({title:t.drive.get("fullnameowner")+"'s files"},{ajax:k.authenticatedRequest,onComplete:function(){},onFailure:function(){t.alert.add({message:l.saveError,className:"error"})},wait:true})}return z.map(function(A){t.accesses.create({userid:A.item.id},{driveid:t.drive.get("physicalid"),ajax:k.authenticatedRequest,onComplete:function(){t.alert.add({message:l.replace(l.shareSuccess,{drive:t.drive.get("title")}),className:"success"})},onFailure:function(){t.alert.add({message:l.replace(l.shareError,{drive:t.drive.get("title")}),className:"error"})},wait:true})})}function r(B,z,A){v=function(){Object.keys(z).map(function(C){delete z[C]})};if(!B){return}if(z[B]){return A(z[B])}w(B).then(A,function(){})}return x},_addAccess:function(){this.container.querySelector(".paneladdmember-item-view-container").addClassName("expanded");var m=this.container.querySelector("#access-members");m.style.display="initial";this.container.querySelector(".access-scroller-view").addClassName("expanded");this.container.querySelector(".paneladdmember-item-view-body input").focus()},_cancelShare:function(){var m=this.container.querySelector("#access-members");m.style.display="none";this.container.querySelector(".access-scroller-view").removeClassName("expanded")},_manageOptions:function(q){var p=this;var o=q.target;var n=o.dataset.modelId;var m=this.accesses.findWhere({id:n});var r=new a({target:o,renderTo:o.parentNode,position:"bottom right",items:[{text:l.remove,fonticon:"cancel",handler:function(){p._removeAccess(m)}}],events:{onHide:function(){r.destroy()}}}).show()},_removeAccess:function(m){var n=this;m.destroy({driveid:n.drive.get("physicalid"),userid:m.id,onComplete:function(){n.alert.add({message:l.replace(l.shareRemoveSuccess,{username:m.get("name")}),className:"success"})},onFailure:function(){n.alert.add({message:l.replace(l.shareRemoveError,{username:m.get("name")}),className:"error"})},wait:true})}});return j});define("DS/W3DDriveManagement/view/DriveManager",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","DS/UIKIT/SuperModal","DS/W3DDriveManagement/view/DriveInformationLayout","DS/W3DDriveManagement/view/DriveAccessLayout","text!DS/W3DDriveManagement/template/DriveManager.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],function(f,a,c,b,e,i,g,h){var d=a.extend({domEvents:{"click .information":"_renderInformationView","click .access":"_renderAccessView"},classes:{informationTab:"information",accessTab:"access",informationView:"drive-manager-information",accessView:"drive-manager-access",active:"active"},dotClasses:function(j){return"."+this.classes[j]},setup:function(j){this.template=c.compile(g);this.alert=j.alert;this.drive=j.drive;this.listenTo(this.drive,"onSync",this._renderInformationView)},render:function(){this.container.innerHTML=this.template({NLS:h});var j=new b({renderTo:document.body});j.dialog({title:h.replace(h.manageDriveTitle,{username:this.drive.get("fullnameowner")}),body:this.container});this._renderInformationView()},_renderInformationView:function(){if(!this.informationView){this.informationView=new e({alert:this.alert,container:this.container.getElement(this.dotClasses("informationView")),drive:this.drive});this.informationView.render()}this.container.getElement(this.dotClasses("accessView")).removeClassName(this.classes.active);this.container.getElement(this.dotClasses("informationView")).addClassName(this.classes.active);this.container.getElement(this.dotClasses("accessTab")).removeClassName(this.classes.active);this.container.getElement(this.dotClasses("informationTab")).addClassName(this.classes.active)},_renderAccessView:function(){if(!this.accessView){this.accessView=new i({alert:this.alert,container:this.container.getElement(this.dotClasses("accessView")),drive:this.drive});this.accessView.render()}this.container.getElement(this.dotClasses("informationView")).removeClassName(this.classes.active);this.container.getElement(this.dotClasses("accessView")).addClassName(this.classes.active);this.container.getElement(this.dotClasses("informationTab")).removeClassName(this.classes.active);this.container.getElement(this.dotClasses("accessTab")).addClassName(this.classes.active)}});return d});