/*!  COPYRIGHT DASSAULT SYSTEMES 2016   */
define("DS/ENOPAD_v2/mixins/_PADKBInput",["UWA/Core","UWA/Class","UWA/Event","DS/ApplicationFrame/CommandsManager","DS/PADUtils/views/PADAlert","DS/Utilities/Dom","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(h,c,f,d,b,a,e){var g=c.extend({_component:null,init:function(i){this._parent(i);this._component=i.component;this._onKeyDown_binded=this._onKeyDown.bind(this)},startObservingKeyboard:function(i){h.Element.addEvent.call(document,"keydown",this._onKeyDown_binded)},_onKeyDown:function(m){var l=this;var k=f.whichKey(m);var j=function(){var n=document.activeElement;if(n&&n.tagName==="INPUT"){return true}else{return false}};var i=function(n,r){if(j()){if(n==="esc"){var q=a.firstParentWithClass(document.activeElement,"xnav_treelst");if(q&&l._component){var o=document.activeElement.getParent();l._component.getPADTreeListView().cancelModification(o.getAttribute("row-id"),o.getAttribute("column-id"))}}}else{var p=d.getCommand(r);if(p&&(p.isEnabled()||r==="Uncut")){p.begin();f.stop(m)}else{if(r==="Paste"){if(l._component.getEditMode()===false){b.displayNotification({msg:e.edit_mode_disabled,eventID:"warning"})}else{b.displayNotification({msg:e.must_select,eventID:"warning"})}}}}};switch(k){case"ctrl+a":i(k,"SelectAll");break;case"ctrl+c":i(k,"Copy");break;case"ctrl+x":i(k,"Cut");break;case"ctrl+v":i(k,"Paste");break;case"ctrl+z":case"esc":i(k,"Uncut");break;case"alt+return":case"alt+enter":i(k,"ActionBar_Attributes");break;default:break}}});return g});define("DS/ENOPAD_v2/commands/_PADActionBarCmds",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(c,d){var b=["Copy","Cut","PADOpen","DownloadStructure"];var a=c.extend({init:function(e){this._parent(e);var f=this;if(b.indexOf(this.options.ID)!==-1){this._check_select();d.get().options.model.getXSO().onChange(this._check_select.bind(this))}if(this.options.ID==="Paste"){require(["DS/PADUtils/PADClipboard"],function(g){d.get().getPADTreeDocument().getXSO().onChange(f._activate_paste.bind(f));g.addEvent("post_setData",f._activate_paste.bind(f));g.addEvent("post_clear",f._activate_paste.bind(f));f._activate_paste()})}if(this.options.ID!=="DownloadStructure"){if(d.get().getEditMode()!==true){f.disable()}d.get().addEvent("editModeModified",function(g){if(g===true){if(f.options.ID==="Paste"){f._activate_paste()}else{f._check_select()}}else{if(f.options.ID==="Paste"){f._activate_paste()}else{f._check_select()}}})}},execute:function(){var e=this;switch(this.options.ID){case"Copy":require(["DS/ENOPAD_v2/commands/edit/_Copy"],function(f){f.execute({command_id:e.options.ID,context:d.get()})});break;case"Cut":require(["DS/ENOPAD_v2/commands/edit/_Cut"],function(f){f.execute({command_id:e.options.ID,context:d.get()})});break;case"Paste":require(["DS/ENOPAD_v2/commands/edit/_Paste"],function(f){f.execute({command_id:e.options.ID,context:d.get()})});break;case"Uncut":require(["DS/ENOPAD_v2/commands/edit/_Uncut"],function(f){f.execute({command_id:e.options.ID,context:d.get()})});break;case"PADOpen":require(["DS/ENOPAD_v2/commands/edit/_OpenInV5"],function(f){f.execute({command_id:e.options.ID,context:d.get()})});break;case"DownloadStructure":require(["DS/ENOPAD_v2/commands/tools/DownloadStructure"],function(f){f.execute({command_id:e.options.ID,context:d.get()})});break;default:throw new Error("Unknown command")}},_check_select:function(){var e=!d.get().options.model.getXSO().isEmpty();if(d.get().getEditMode()===true){if(e===true&&(this.options.ID!=="DownloadStructure")){this.enable()}else{this.disable()}}else{this.disable()}},_activate_paste:function(){var e=require("DS/PADUtils/PADClipboard");var f=d.get().getPADTreeDocument().getXSO().get().length>0?true:false;var g=d.get().getEditMode();if(e.isEmpty(e.OBJECT)!==true&&f===true&&g===true){this.enable()}else{this.disable()}}});return a});define("DS/ENOPAD_v2/mixins/_PADDnD",["DS/ENXNav/mixins/_xNavDnD","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADDropConfirm","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,f,i,a,c,b,g,j,d){var h=e.extend({shouldAcceptDnDDrop:function(o,m,l,n){var k=true;if(n.isRoot===true){var p={shiftKey:n.modifiers===2};this._add_drop_invite(p)}else{this.dropInvitContainer.show("insert")}return k},doDnDDrop:function(o,l,k,n){var p={dataTransfer:o};var m=this;var q=m._parent;f.retrieveDroppedDataAsync(p,function(s){var A=true;var w=false;if(k&&k._parentNode&&l&&k._parentNode.options.resourceid===l.options.resourceid){w=true}var t=false;if(f.getWidgetId()===s.unserializedData.widgetId){t=true;A=false}var u=function(F){if(F){var D=false;s.unserializedData.data.items.forEach(function(H){if(l){var I=l.options.resourceid;if(H.path){for(var G=0;G<H.path.length;G++){if(I===H.path[G].resourceid){D=true;break}}}}});if(n.isRoot||(D&&!t)){o.params=s;m._parent=q;m._parent(o,l,k,n)}else{var E;if(s.authorized_objects&&s.authorized_objects.length>0){if(k&&k._parentNode&&l&&k._parentNode.options.resourceid===l.options.resourceid){E={dropInfos:{nodeModel:k,dropPosition:"top"},dropped_data:s.authorized_objects,source_data:s.source_data};if(s.authorized_objects.length===1){m._dropOnCellCompositeOrder(E)}else{a.displayNotification({msg:d.multi_reordering,eventID:"warning"});if(m.dropInvitContainer){m.dropInvitContainer.hide()}}}else{E={dropInfos:{nodeModel:l},dropped_data:s.authorized_objects,source_data:s.source_data};m._dropOnTreeColumn(E)}}else{if(m.dropInvitContainer){m.dropInvitContainer.hide()}}}}else{if(m.dropInvitContainer){m.dropInvitContainer.hide()}}};if(m.getEditMode()===true||n.isRoot){var x=m.getPADTreeDocument();var C=x._confirmDialog||false;if(n.isRoot){C=false}if(C){var r=x._copyMode;var y=d.all_selected_objects;var B=s.authorized_objects;if(B&&B.length===1){y=B[0].displayName}if(B.length!==0){var v=l.options.label||l.options.display;var z=new c({copyMode:r,isReordering:w,isOutsideWidget:A,dropName:y,targetName:v,callback:u})}}else{u(true)}}else{a.displayNotification({msg:j.editmodedeactivated,eventID:"info"})}})},onDragOverCell:function(l,k){if(l.dataTransfer){if(l.dataTransfer.effectAllowed==="copyMove"||l.dataTransfer.effectAllowed==="copy"){l.dataTransfer.dropEffect="copy";l.preventDefault()}}if(!this._isDroppableInBody()){return false}if(k.dataIndex==="find_in_ctx"){this.dropInvitContainer.show("find")}else{this.dropInvitContainer.show("insert")}l.preventDefault();return true},onDropCell:function(o,q){var n=this;var k=[];var r=false;var s=false;if(q.nodeModel._parentNode){s=q.nodeModel._parentNode.options._isTrueRoot||!q.nodeModel._parentNode.options.resourceid}function p(){return k}var l=q.dataIndex==="find_in_ctx"?true:false;var m=q.dropPosition==="top"||q.dropPosition==="bottom";if(m&&s){r=true}b.retrieveAuthorizedObjects({dnd_event:o,isFindInCtx:l,callback:function(u){var x=function(I){if(I){var H=g.getSetting("x3dPlatformId");var F;if(!m||l){var G=0;if(l){for(G=0;G<u.authorized_objects.length;G++){k.push([u.authorized_objects[G].objectId])}if(k.length){q.nodeModel.options.partialPreExpand=p;q.nodeModel.expand()}}else{if(u.authorized_objects[0]){F=u.authorized_objects[0].envId}else{F=""}if(H===F){n._dropOnTreeColumn({dropped_data:u.authorized_objects,source_data:u.source_data,dropInfos:q})}else{a.displayNotification({msg:d.Tenant_InsertError,eventID:"error"})}}}else{if(u.authorized_objects.length===1){F=u.authorized_objects[0].envId;if(H===F){n._dropOnCellCompositeOrder({dropped_data:u.authorized_objects,source_data:u.source_data,dropInfos:q})}else{a.displayNotification({msg:d.Tenant_InsertError,eventID:"error"})}}else{if(n.getPADTreeDocument()._active_cutting_nodes.length>0){n.uncut.call(n)}if(u.authorized_objects.length===0){a.displayNotification({msg:d.no_authorized_object,eventID:"warning"})}else{a.displayNotification({msg:d.multi_reordering,eventID:"warning"})}}}}};if(n.getEditMode()===true||l){var C=true;if(f.getWidgetId()===u.source_data.widgetId){C=false}var y=n.getPADTreeDocument();var D=y._confirmDialog||false;if(l||!D||r){x(true)}else{var t=y._copyMode;var z=d.all_selected_objects;var E=u.authorized_objects;var w="";if(E&&E.length===1){z=E[0].displayName;w=E[0].objectId}if(E.length!==0){var v=q.nodeModel.options.label||q.nodeModel.options.display;var B=q.nodeModel.options.resourceid;if(w===B){a.displayNotification({msg:d.msg_warning_dndnotsupported,eventID:"warning"})}else{var A=new c({copyMode:t,isReordering:m,isOutsideWidget:C,dropName:z,targetName:v,dropPosition:q.dropPosition,callback:x})}}}}else{a.displayNotification({msg:j.editmodedeactivated,eventID:"info"})}}});this.onDragLeaveCell(o);o.preventDefault();o.stopPropagation();return false},_distinguishInsideOutsideCases:function(n){var m=this;var k={insideView:[],outsideView:[]};var l=m.getPADTreeDocument();n.dropped_data.forEach(function(r){var q=r.path;if(q&&q.length>0&&UWA.is(q[0],"object")){var p=[];q.forEach(function(s){p.push(s.resourceid)});q=p}var o=q?l.getNodeByOccurencePath(q):null;if(o&&n.source_data&&f.getWidgetId()===n.source_data.widgetId){k.insideView.push(o)}else{k.outsideView.push(r)}});return k},_handleNodeNotInView:function(n,l,k){var m=this;var o;if(UWA.is(n.path)){o=n.path.map(function(p){return p.resourceid?p.resourceid:p})}else{o=[n.objectId]}if(k&&k.options._isTrueRoot){treeDocument.add({pids:[o],callback:function(){}});return}l.push(o)},_handleNodesNotInView:function(q,m){var n=this;var l=[];function k(s){var w={};var v=m.getID();w[v]=[];var r;for(r=0;r<s.length;r++){var u=s[r].relationid;var t=s[r].resourceid;w[v].push({resourceid:t,relationid:u})}n.insertNodes(w)}function p(r){n.getPADTreeDocument()._endBlockingTransaction();if(r&&UWA.is(r.messages,"array")){r.messages.forEach(function(s){a.displayNotification({msg:s,eventID:"error"})})}if(n.dropInvitContainer){n.dropInvitContainer.hide()}}q.forEach(function(r){n._handleNodeNotInView(r,l,m)});if(l.length>0){var o={parents:[m.getOccurencePath()],children:l,commit:true};n.getPADTreeDocument()._beginBlockingTransaction(j.inserting_nodes);require(["DS/ApplicationFrame/CommandsManager"],function(r){var s=r.getCommand("InsertExisting");s.execute({mode:"CopyPaste",internal_call:true,scenario:"externalDnD",data:o,onSuccess:k,onFailure:p})})}},_dropOnTreeColumn:function(o){var n=this;var l=n.getPADTreeDocument();if(l._active_cutting_nodes.length>0){n.uncut.call(this)}var k=n._distinguishInsideOutsideCases(o);if(k.insideView.length>0){l._onInsert(k.insideView,o.dropInfos.nodeModel,null)}if(k.outsideView.length>0){var m=o.dropInfos.nodeModel;n._handleNodesNotInView(k.outsideView,m)}},_handleNodesNotInViewOrder:function(q,m,r){var n=this;var l=[];function k(t){var x={};var w=m.getID();x[w]=[];var s;for(s=0;s<t.length;s++){var v=t[s].relationid;var u=t[s].resourceid;x[w].push({resourceid:u,relationid:v,ordering:r})}n.insertNodes(x)}function p(s){n.getPADTreeDocument()._endBlockingTransaction();if(s&&UWA.is(s.messages,"array")){s.messages.forEach(function(t){a.displayNotification({msg:t,eventID:"error"})})}if(n.dropInvitContainer){n.dropInvitContainer.hide()}}q.forEach(function(s){n._handleNodeNotInView(s,l,null)});if(l.length>0){var o={parents:[m.getOccurencePath()],children:l,ordering:r,commit:true};n.getPADTreeDocument()._beginBlockingTransaction(j.inserting_nodes);require(["DS/ApplicationFrame/CommandsManager"],function(s){var t=s.getCommand("InsertExisting");t.execute({mode:"CopyPaste",internal_call:true,scenario:"externalDnD",data:o,onSuccess:k,onFailure:p})})}},_dropOnCellCompositeOrder:function(p){var t=this;if(t.getPADTreeDocument()._active_cutting_nodes.length>0){t.uncut.call(this)}if(p.dropInfos&&p.dropInfos.nodeModel){var r=this.getPADTreeDocument();var z=p.dropped_data[0].path;if(z&&z.length>0&&UWA.is(z[0],"object")){var q=[];z.forEach(function(A){if(A.resourceid){q.push(A.resourceid)}});z=q}var o=z?r.getNodeByOccurencePath(z):null;var v=p.dropInfos.nodeModel._parentNode;var l={};if(v&&!v.options._isTrueRoot){var x=v.getChildren();var m=p.dropInfos.nodeModel.getRelationID();var y=v.getChildren().indexOf(p.dropInfos.nodeModel);var u=-1,s=-1;var k,n;if(y>-1){u=y-1;s=y+1}if(p.dropInfos.dropPosition==="top"){n=x?x[u]:null;if(!m&&o){v.insertBefore(o,p.dropInfos.nodeModel)}l.before=m;l.after=n?n.getRelationID():""}else{if(p.dropInfos.dropPosition==="bottom"){k=x?x[s]:null;if(!m&&o){v.addChild(o,v.getChildren().indexOf(p.dropInfos.nodeModel)+1)}l.after=m;l.before=k?k.getRelationID():""}else{a.displayNotification({msg:d.drop_between_lines,eventID:"warning"})}}if(m){if(o){r._compositeOrder(o,v,l)}else{var w=t._distinguishInsideOutsideCases(p);if(w.outsideView.length>0){t._handleNodesNotInViewOrder(w.outsideView,v,l)}}}}else{a.displayNotification({msg:d.drop_between_lines,eventID:"warning"})}if(t.dropInvitContainer){t.dropInvitContainer.hide()}}}});return h});define("DS/ENOPAD_v2/commands/edit/_Cut",["UWA/Class"],function(a){var b={execute:function(c){c.context.cut()}};return b});define("DS/ENOPAD_v2/commands/edit/_Paste",["UWA/Class",],function(b){var a={execute:function(c){c.context.paste()}};return a});define("DS/ENOPAD_v2/mixins/_PADRefresh",["UWA/Class","DS/PADUtils/PADSettingsMgt"],function(a,b){var c=c=a.extend({});if(b.getSetting("refresh_v2")!==true){c.prototype.refresh=function(e){var f=this;e=e===undefined?true:e;require(["DS/ApplicationFrame/CommandsManager"],function(g){g.getCommand("Uncut").begin()});if(e){this._commandProxy.refreshModel()}var d=f.getPADTreeListView();f.getPADTreeDocument().refresh({treelist:d,dispatch:false})}}return c});define("DS/ENOPAD_v2/commands/edit/_Uncut",["UWA/Class"],function(b){var a={execute:function(c){c.context.uncut()}};return a});define("DS/ENOPAD_v2/views/PADTreeListView",["css!DS/ENOPAD_v2/ENOPAD_v2","DS/ENXNav/views/xNavTreeListView","DS/Tree/TreeNodeView","DS/PADUtils/PADSettingsMgt"],function(b,d,e,c){var a=d.extend({padtreelst_def_file:{module:"ENOPAD_v2",asset:"padtreelst_def.json"},init:function(f){f.cellClass=e.extend({init:function(i){this._parent(i)},updateInternalParameters:function(){this._parent();var i=this.getCellInfos();if(!i.isHeader){if(i.nodeModel&&i.nodeModel.options.isBeingCut){i.cellView.getContent().addClassName("pad-state-is-being-cut")}else{i.cellView.getContent().removeClassName("pad-state-is-being-cut")}}}});if(c.getSetting("activateEditInTable")===true&&!UWA.is(f.shouldBeEditable)){var h=this,g=this._parent.bind(this);require(["DS/ENOPAD_v2/mixins/_PADEditInLst"],function(i){var k=Object.getOwnPropertyNames(i);for(var j=0;j<k.length;j++){a.prototype[k[j]]=i[k[j]].bind(h)}g(f)})}else{this._parent(f)}},});return a});define("DS/ENOPAD_v2/mixins/_PADCCP",["UWA/Class","DS/PADUtils/PADClipboard","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADDropConfirm","DS/PADUtils/PADContext","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(a,g,n,b,d,i,p,f){var m=a.extend({init:function(){this._parent(arguments);this._acceptedNodes={}},acceptNode:function(u){var v=false;var r=u.getPath();var s=r.length;var q=r[0].getID();if(this._acceptedNodes.hasOwnProperty(q)){var w=this._acceptedNodes[q];if(w.depth<=s){w.nodes.push(u)}else{var t=u.getFirstCommonAncestor(w.nodes[0]);w.nodes.length=0;w.nodes.push(t);w.depth=t.getPath().length;v=true}}else{this._acceptedNodes[q]={depth:s,nodes:[u]}}return v},applyOnAcceptedNodes:function(s){for(var r in this._acceptedNodes){if(UWA.is(r,"string")){var q=this._acceptedNodes[r].nodes;for(var t=0;t<q.length;t++){s(q[t])}}}}});function e(q,r){var s=Date.now();q.withBroadcastSelect(function(){var u=q.getXSO();if(!u.isEmpty()){var x=u.get();var y=false;x.sort(function(C,B){var A=C.getDepth();var z=B.getDepth();if(A===z){return 0}else{if(A<z){return -1}else{if(A>z){return 1}}}});var t=new m();x.forEach(function(z){y=t.acceptNode(z)||y});if(y){var v=Date.now();q.unselectAll();var w=Date.now();t.applyOnAcceptedNodes(function(A){var z=Date.now();A.select()});b.displayNotification({msg:p.reselectionFeedback,eventID:"warning"})}}})}function k(s,u){var q=s.getXSO();if(!q.isEmpty()){var t=q.get();var v={action:u,objects:[]};var r=[];t.forEach(function(w){v.objects.push({path:w.getOccurencePath(),labelPath:w.buildPath()});r.push(s.getNodeByOccurencePath(w.getOccurencePath()))});g.setData(g.OBJECT,v);if(u==="cut"){l(r)}}}function j(s,r){var q=[];s.objects.forEach(function(v){var t=r.getNodeByOccurencePath(v.path);if(t&&t.getOccurencePath().length===v.path.length){q.push(t)}else{var u=v.labelPath.replace(/\/$/,"");b.displayNotification({msg:u+p.pasteObjectNotInView,eventID:"error"})}});return q}var h=[];function l(q){h=q}function c(){return h}var o=a.extend({activeCutting:false,activeNodes:[],getActiveNodes:function(){return c()},setStateCuttingNodes:function(q){if(q){if(this.activeCutting){if(this.activeNodes.length>0){this.setStaUncuttingNodes(this.activeNodes)}}q.forEach(function(r){r.updateOptions({isBeingCut:true})});this.activeCutting=true;this.activeNodes=q}},setStaUncuttingNodes:function(q){if(q.length>0){q.forEach(function(r){if(r.options.isBeingCut){r.updateOptions({isBeingCut:false})}})}this.activeCutting=false;this.activeNodes=[]},copy:function(){var q=this.getPADTreeDocument();var r=q.getSelectedNodes();this.uncut();l([]);q.withBroadcastSelect(function(){q.withTransactionUpdate(function(){r.forEach(function(s){s.select()})})});e(q);k(q,"copy")},cut:function(){var q=this.getPADTreeDocument();e(q);k(q,"cut");this.options.model.setCuttingNodes(c());this.setStateCuttingNodes(c())},uncut:function(){if(this.activeCutting){this.options.model.setCuttingNodes([]);this.setStaUncuttingNodes(this.activeNodes)}this.getPADTreeDocument().unselectAll();if(!g.isEmpty(g.OBJECT)){g.clear(g.OBJECT)}},resetClipboard:function(){this.uncut()},_processTargets:function(r){var q=[];var t=[];var s,u;r.forEach(function(v){if(v.isRoot()){q.push(v)}else{u=v.getID();if(t.indexOf(u)<0){q.push(v);t.push(u)}}});return q},_inputData:function(q,r){var t=[];var s=[];var v=[];q.forEach(function(x){var w=x.getRelationID();if(w===""){t.push(x.getOccurencePath())}else{if(s.indexOf(w)===-1){s.push(w);t.push(x.getOccurencePath())}}});r.forEach(function(w){v.push(w.getOccurencePath())});var u={children:t,parents:v,commit:true};return u},_inputData2:function(t,q){var x,w;var s=[],v;var u=[];q.forEach(function(y){x={isInstanceOf:y.getID(),pathArray:y.getOccurencePath()};t.forEach(function(z){var A=z.getRelationID();if(A===""){w={isInstanceOf:z.getID(),pathArray:z.getOccurencePath(),instance:z.getOccurencePath()};v={mode:"CopyPaste",target:x,source:w};s.push(v)}else{if(u.indexOf(A)===-1){u.push(A);w={isInstanceOf:z.getID(),pathArray:z.getOccurencePath(),instance:z.getOccurencePath()};v={mode:"CopyPaste",target:x,source:w};s.push(v)}}})});var r={version:"1.0",bAllOrNothing:true,operations:s,};return r},_inputDataCopy:function(q,r){var s=[];var u=[];q.forEach(function(v){s.push(v.getOccurencePath())});r.forEach(function(v){u.push(v.getOccurencePath())});var t={children:s,parents:u,commit:true};return t},_inputDataCopy2:function(t,q){var w,v;var s=[],u;q.forEach(function(x){w={isInstanceOf:x.getID(),pathArray:x.getOccurencePath()};t.forEach(function(y){v={isInstanceOf:y.getID(),pathArray:y.getOccurencePath(),instance:y.getOccurencePath()};u={mode:"CopyPaste",target:w,source:v};s.push(u)})});var r={version:"1.0",bAllOrNothing:true,operations:s,};return r},_distinguishInsertReparentCases:function(r,t){var s=this;var q={insertExisting:[],reparent:[]};r.forEach(function(v){var w=v.getRelationID();var u=(w?false:true);if(u||t==="copy"){q.insertExisting.push(v)}else{q.reparent.push(v)}});return q},paste:function(){var y=this;var w;var A;var Q;function z(S){var U,T=[];S.forEach(function(V){if(V.getRelationID()){U=V.getParent().getID();if(T.indexOf(U)===-1){T.push(U)}}});return T}function v(S,V){var T;for(T=0;T<S.length;T++){var U=S[T];if(U.options.resourceid===V){S.splice(T,1);return U}}return null}function P(S,X){var U,W,T,V=S.length;if(!X){if(V===1){T=S[0]}}else{for(U=0;U<V;U++){W=S[U];if(W.options.resourceid===X){T=W;break}}}return T}function u(T,Z){var V,X,U,W=T.length;if(!Z){if(W===1){U=T[0]}}else{var Y=[];for(V=0;V<W;V++){X=T[V];if(X.options.resourceid===Z){Y.push(X)}}if(Y.length==1){U=Y[0]}else{if(Y.length>1){U=Y[0];var S=T.indexOf(U)}}}return U}function D(ae,am,aa){var ah,ad,aj,V,T,an;var ab=ae.length;var af=am.length;var ag=[];var ai=y.getPADTreeDocument();var W=[];var U,ak;for(ah=0;ah<ab;ah++){aj=ae[ah].hasParent;V=ae[ah].relationid;T=ae[ah].resourceid;an=ae[ah].instanceName?ae[ah].instanceName:"";U=aj+"_"+V+"_"+T;ad=v(w,T);if(ad){ag.push(ad)}else{ad=P(ag,T)}var S=ad.getID();var ac=ad.getRelationID();var Z=!Boolean(ac);var X,Y,al;ai.wrapInTransaction(function(){ai.withTransactionUpdate(function(){X=u(am,aj);if(X){Y=X.getID();al={node:ad,parent:X,behavior:Q,newRelationID:V,instanceName:an};ak=aj+"_"+X.options.relationid?X.options.relationid:"";U=ak+U;if(W.indexOf(U)<0){ai.instantiate(al,aa);W.push(U);var ap=[];var ao={transactions:[],origin:"CCP"};var ar={detach:{}};ao.transactions.push({insertExisting:{modified:[Y],inserted:[S],created:[V],withContext:!Z}});ap.push(V);if(ap.length){var aq=[];ap.forEach(function(au){var at=ai.getNodesByRelId(au);if(at){aq.push(at[0].getOccurencePath())}});ao.transactions[0].insertExisting.inserted=aq}if(Z||Q==="COPY"){y._commandProxy.padRefresh(ao)}else{ar.detach.deleted=[ac];y._commandProxy.padRefresh(ao);y._commandProxy.padRefresh(ar)}}else{console.log("already added to targets",al)}}},y);y.endBlockingTransaction()})}b.displayNotification({msg:p.pasteSucceeded,eventID:"info"})}function x(T){var S=[];var U=y.getPADTreeDocument();for(var V=0;V<T.length;V++){var W=T[V];var X=U.getNodeByOccurencePath(W);if(X){S.push(X.getLabel())}}return S}function t(T){var S=[];if(T&&T.targets){S=x(T.targets)}if(T&&UWA.is(T.messages,"array")){b.displayNotification({msg:T.messages.join(""),eventID:"error"})}else{if(S&&S.length>0){b.displayNotification({msg:"Failed insert operation in "+S.join(""),eventID:"error"})}}if(y.resetClipboard){y.resetClipboard()}y.endBlockingTransaction()}function K(al,au,ag){var ao,ab,Z,ak,aq,ad,ae,av;var V,aj,af;var ai=al.length;var am=au.length;var an=[];var ap=y.getPADTreeDocument();var ac=[];var aw=true;var aa,ar;var T=[];var W=[];var U=[];var Y=[];al.forEach(function(aA){var ay=aA.relationid,ax=aA.hasParent,az=aA.resourceid;if(ay&&T.indexOf(ay)===-1){T.push(ay)}if(ax&&W.indexOf(ax)===-1){W.push(ax)}if(az&&Y.indexOf(az)===-1){Y.push(az)}});var X={newRelationIDs:T,tgtParentIds:W,removedNodeIds:Y};var ah=0,S=0;for(ao=0;ao<ai;ao++){aq=al[ao].hasParent;ab=al[ao].relationid;Z=al[ao].resourceid;aa=aq+"_"+ab+"_"+Z;ak=v(w,Z);if(ak){an.push(ak)}else{ak=P(an,Z)}try{V=ak.getID();aj=ak.getRelationID();af=!Boolean(aj);ap.wrapInTransaction(function(){ap.withTransactionUpdate(function(){ad=u(au,aq);if(ad){ae=ad.getID();av={node:ak,parent:ad,behavior:Q,newRelationID:ab};ar=aq+"_"+ad.options.relationid?ad.options.relationid:"";aa=ar+aa;if(ac.indexOf(aa)<0){ap.instantiate(av,ag,X);ac.push(aa);var ay=[];var ax={transactions:[],origin:"CCP"};var aA={detach:{deleted:[]}};ax.transactions.push({insertExisting:{modified:[ae],inserted:[V],created:[ab],withContext:!af}});ay.push(ab);if(ay.length){var az=[];ay.forEach(function(aC){var aB=ap.getNodesByRelId(aC);if(aB){az.push(aB[0].getOccurencePath())}});ax.transactions[0].insertExisting.inserted=az}if(af||Q==="COPY"){y._commandProxy.padRefresh(ax)}else{y._commandProxy.padRefresh(ax);if(T.indexOf(aj)===-1){if(U.indexOf(aj)===-1){U.push(aj);aA.detach.deleted.push(aj);y._commandProxy.padRefresh(aA)}}}}else{console.log("already done ")}}},y)});y.endBlockingTransaction()}catch(at){y.endBlockingTransaction();if(y.resetClipboard){y.resetClipboard()}b.displayNotification({msg:p.pasteFailed,eventID:"error"});aw=false}}if(aw){b.displayNotification({msg:p.pasteSucceeded,eventID:"info"})}}function r(T){y.endBlockingTransaction();var S=[];if(T&&T.targets){S=x(T.targets)}if(T&&UWA.is(T.messages,"array")){b.displayNotification({msg:T.messages.join(""),eventID:"error"})}else{if(S&&S.length>0){b.displayNotification({msg:"Failed reparent operation in "+S.join(""),eventID:"error"})}}if(y.resetClipboard){y.resetClipboard()}}this.setStaUncuttingNodes(c());var J=this.getPADTreeDocument();var E=J._confirmDialog||false;var G=0,F=0,L=0;var s=J.getXSO();if(!s.isEmpty()){var O=s.get();O=this._processTargets(O);F=O.length;var B=f.selected_target;if(F>1){B=f.selected_targets}if(!g.isEmpty(g.OBJECT)){var q=false;if(c().length>0){q=true}var R=g.consumeData(g.OBJECT,q);var I=R.action;if(I){Q=(I==="copy"?"COPY":"MOVE");w=j(R,J)}if(w.length>0){var N=y._distinguishInsertReparentCases(w,I);G=N.reparent.length;L=N.insertExisting.length}if(F*G>1000){b.displayNotification({msg:f.limit_cut_paste,eventID:"error"});return}else{var H=function(S){if(S){if(L>0){y.beginBlockingTransaction(p.composite);require(["DS/ApplicationFrame/CommandsManager"],function(T){var U=T.getCommand("InsertExisting");var V=z(w);U.execute({mode:"CopyPaste",internal_call:true,data:y._inputDataCopy(w,O),onSuccess:function(W){D(W,O,V)},onFailure:function(W){t(W)}})})}if(G>0){y.beginBlockingTransaction(p.composite);require(["DS/ApplicationFrame/CommandsManager"],function(T){var U=T.getCommand("InsertExisting");var V=z(w);U.execute({mode:"CutPaste",internal_call:true,data:y._inputData(w.reverse(),O),onSuccess:function(W){K(W,O,V)},onFailure:function(W){r(W)}})})}}};if(E){var C=f.all_selected_objects;if(w.length===1){C=w[0]._options.display||w[0]._options.label}if(O.length===1){B=O[0]._options.display||O[0]._options.label}var M=new d({copyMode:Q,dropName:C,targetName:B,callback:H})}else{H(true)}}}}},resetPosition:function(){var q=[1,0,0,0,1,0,0,0,1,0,0,0];this._doMove(q,"RESETPOSITION")},pastePosition:function(){var s=g.getData(g.POSITION);var t=s.matrix.split(",");var q=[];for(var r=0;r<t.length;r++){q.push(parseFloat(t[r]))}this._doMove(q,"PASTEPOSITION");g.clear(g.POSITION)},_doMove:function(r,t){var s=this,q=s.getPADTreeDocument();require(["DS/UPSCommands/UPSCmdUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSession"],function(C,x,u){var E={instances:[],onComplete:function(J){if(J.status==="success"){var I=r.toString();for(var F=0;F<J.results.length;F++){var G=q.getNodesByRelId(J.results[F].instance);for(var L=0;L<G.length;L++){var H={relationId:J.results[F].instanceOut,grid:{instanceMatrix:x.checkNotIdentity(I)?I:null}};G[L].updateOptions(H)}}var K;switch(t){case"RESETPOSITION":K=p.resetPositionSucceeded;break;case"PASTEPOSITION":K=p.pastePositionSucceeded;break}b.displayNotification({msg:K,eventID:"info"});u.setAuthoringState(true,f.PADSession_disabling_index_authoring);q.pushUpdate();s._commandProxy.updatePosMatrix(s.newParams);delete s.newParams}else{if(J.status==="failure"){b.displayNotification({msg:J.message,eventID:"error"});q.pushUpdate()}}},onFailure:function(F){b.displayNotification({msg:p.pastePositionFailed,eventID:"error"});q.pushUpdate()}};var y=s.getPADTreeDocument();var D=y._confirmDialog||false;var w=y.getXSO();if(!w.isEmpty()){var B=w.get();for(var A=0;A<B.length;A++){var v=B[A];if((v.options.relationtype==="VPMInstance"||(v.options.relationtype===""&&v.options.type!=="3DShape"&&v.options.type!=="Drawing"))&&v.getRelationID()){E.instances.push({instance:v.getRelationID(),nodePath:v.getOccurencePath(),hasPositioningMatrix:r})}}if(E.instances.length){var z=function(F){if(F){q.prepareUpdate();s.newParams={instances:E.instances};C.move3D(E)}};z(true)}}})}});return o});define("DS/ENOPAD_v2/models/_PADModelParser",["DS/ENXNav/models/_xNavCVParser","DS/ENXNav/models/xNavNodeModel","DS/PADUtils/XNavSettings","DS/PADUtils/PADPredicatesNls"],function(b,c,a,d){b.process.insert_nodes=function(o){var A={insertExisting:{modified:[],inserted:[],created:[]}};var G={transactions:[]};var j=a.getAvailableColumns();var B=o.treedocument;var n=B.getRoots();var y=o.response.results;console.log("replace insert response_results",y);var f=UWA.clone(o.insert_parameters,false);var s=Object.keys(f);var F={};var J={};var C={};var g=Date.now();var p=0;var h,E,l,m,k;function q(){var i,L,N,O;for(var M=y.length;M--;){i=y[M];console.log("insert result",i);L=i.attributes;for(var K=L.length;K--;){N=L[K];if(N.name==="resourceid"){O=N.value;J[O]=i;break}}}}function v(){var i,K,M;for(var L=s.length;L--;){K=s[L];for(var N=n.length;N--;){i=n[N].getNodesById(K);if(i.length>0){F[K]=i;break}}}}function t(){var Y=function(af,ah){var ae={beforeNodes:[],afterNodes:[],afterPosition:-1};for(var i=af.length;i--;){m=af[i];var ag=m._options.relationid;if(ag===ah.after){ae.afterNodes=[m];ae.afterPosition=i;break}if(ag===ah.before){ae.beforeNodes=[m];break}}return ae};var N,P,aa,ab,S,R,K,O;for(var U=s.length;U--;){N=s[U];aa=F[N];for(var T=aa.length;T--;){ab=aa[T];P=ab.getChildren();if(!P||P.length===0){break}else{K=f[N];R=P[0];for(var W=K.length;W--;){O=K[W];S=O.resourceid;if(!O.ordering){break}var Q=O.ordering.before;var X=O.ordering.after;var ac=(Q&&Q!=="")?true:false;var Z=(X&&X!=="")?true:false;var ad=Y(P,O.ordering);var V=(ad.beforeNodes.length>0)?true:false;var L=(ad.afterPosition!==-1)?true:false;var M;if(ac&&Z){if(V){C[S]={before:ad.beforeNodes}}if(L){M=ad.afterPosition+2;C[S]={after:[M]}}}else{if(ac){if(V){C[S]={before:ad.beforeNodes}}else{if(R){C[S]={before:[R]}}}}else{if(Z){if(L){M=ad.afterPosition+2;C[S]={after:[M]}}}}}}}}}}function x(N){var i=N.relationid;var M,L;M=J[N.resourceid];if(M){L=b.parse_attributes(M.attributes,j);L.relationid=i;if(j.available_columns.indexOf("instanceName")!==-1){if(i&&J[i]){var K=b.parse_attributes(J[i].attributes,j);L.grid.instanceName=K.label}}}return UWA.clone(L,false)}v();q();t();var r=Date.now();var I;for(var z=s.length;z--;){I=s[z];var w=[];var H={insertExisting:{modified:[],inserted:[],created:[]}};var D=F[I];var e=f[I];B.withTransactionUpdate(function(){var L,O;for(var K=e.length;K--;){k=e[K];O=k.resourceid;L=x(k);for(var N=D.length;N--;){E=D[N];var M=new c(L);if(!k.ordering){E.addChild(M)}else{var i=C[O];if(!i){E.addChild(M)}else{if(i.before){E.insertBefore(M,i.before[0])}else{if(i.after){E.addChild(M,i.after[0])}else{E.addChild(M)}}}}if(E.options.padstate!=="expanded"){E.setState({state:"partiallyExpanded"});E.options.padstate="partiallyExpanded"}if(E.options.padstate==="noChildren"){E.setState({state:"expanded"});E.options.padstate="expanded"}if(E._isExpanded||E._expandState==="expandState"){E.options.padstate="expanded";E.setState({state:"expanded"})}H.insertExisting.modified.push(E.getID());H.insertExisting.inserted.push(M.getID());w.push(M.getRelationID());H.insertExisting.created.push(M.getRelationID());H.insertExisting.withContext=false;d.updateNLS(M);t()}}});G.transactions.push(H);if(w.length){var u=[];w.forEach(function(K){var i=B.getNodesByRelId(K);if(i){u.push(i[0].getOccurencePath())}});G.transactions[0].insertExisting.inserted=u}}return G};return b});define("DS/ENOPAD_v2/commands/EditMode",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt"],function(e,d,c,a){var b=d.extend({_triggerFromCmd:null,_context:null,init:function(f){this._parent(f,{});var g=this;this._context=c.get();if(this._context.getEditMode()===true){this.setState(true,false)}else{this.setState(false,false)}this.onStateChange(function(){g._triggerFromCmd=false;var h=g.getState();g._context.setEditMode(h)})}});return b});define("DS/ENOPAD_v2/commands/edit/_OpenInV5",["UWA/Class","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(b,f,c,e){var d=function(h){var i={expanded:"yes",collapsed:"no",partiallyExpanded:"partial"};return i[h]?i[h]:""};var a=function(n){var q={version:"01",selection:[]},l=[],m=0,k="",p=[],h=n.getPADTreeDocument()._selected_paths;h.forEach(function(i){p.push(i[i.length-1])});var o=function(i){var r=d(i.getState());if(i.getChildren()&&i.getChildren().length>0&&i.getState()==="collapsed"){r="partial"}return r};var j=function(r){var i=r.isSelected();if(p.length){if(p.indexOf(r.getID())!==-1){i=true}else{i=false}}return i};n.getSelectedNodes().forEach(function(r){var i=r.getParents(),s=r.getAllDescendants();for(m=0;m<i.length;m++){k=i[m].getID();if(l.indexOf(k)===-1){q.selection.push({physicalid:k,isroot:i[m].isRoot(),selected:j(i[m]),expanded:o(i[m])});l.push(k)}}k=r.getID();if(l.indexOf(k)===-1){q.selection.push({physicalid:k,isroot:r.isRoot(),selected:j(r),expanded:o(r)});l.push(k)}for(m=0;m<s.length;m++){k=s[m].getID();if(l.indexOf(k)===-1){q.selection.push({physicalid:k,isroot:s[m].isRoot(),selected:j(s[m]),expanded:o(s[m])});l.push(k)}}});return q};var g={execute:function(i){if(c.getSetting("settypes")===true){i.context.beginBlockingTransaction(e.padopen);f.launchWithSetTypes(i.context.getPADTreeDocument(),"ENOV5MA_AP",function(){i.context.endBlockingTransaction()})}else{if(c.getSetting("completeselection")===true){require(["DS/PADUtils/PADWSAccess"],function(l){i.context.beginBlockingTransaction(e.padopen);var j;if(c.getSetting("open_in_v5_v2")){j=f.buildOpenJson(i.context.getSelectedNodes(),i.context.getPADTreeDocument()._selected_paths)}else{j=a(i.context)}var k={data:j,onComplete:function(m){var n=UWA.is(m,"string")?JSON.parse(m):m;f.setStructure_4_open_in_cv5({completeselection:n});f.open_app({appId:"ENOV5MA_AP"},function(){i.context.endBlockingTransaction()})},onFailure:function(m){i.context.endBlockingTransaction()},timeout:0};l.completeselection(k)})}else{f.setStructure_4_open_in_cv5({nodes_2_open:i.context.getSelectedNodes()});var h=this;i.context.beginBlockingTransaction(e.padopen);f.open_app({appId:"ENOV5MA_AP"},function(){i.context.endBlockingTransaction()})}}}};return g});define("DS/ENOPAD_v2/commands/edit/InsertExisting",["UWA/Class","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","DS/PADUtils/PADSettingsMgt","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(b,d,e,c,a,g){var f=a.extend({init:function(h){this._parent(h);this._check_multiselect();g.get().options.model.getXSO().onChange(this._check_multiselect.bind(this))},execute:function(i){var h=this;if(i&&i.internal_call===true){if(i&&i.mode==="CopyPaste"){h.doInsertExisting.bind(h)(i)}else{if(i&&i.mode==="CutPaste"){h.doReparent.bind(h)(i)}}}else{require(["DS/PADUtils/views/PADModalChooser","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(j,n,l,m){var o=n.get().getSelectedNodes(),k=o.length?"(type:CATProduct OR type:CATPart)":'(type:"'+l.getSetting("authorized_types").join('" OR type:"')+'")';if(o.length>1){n.get().displayNotification({msg:m.insert_existing_multiselection,eventID:"warning"})}else{new j({position:"above_action_bar",in_apps_search:{precond:k,in_apps_callback:h._onSelectionDone.bind(h),multiSel:!o.length}})}})}},_check_multiselect:function(){var h=g.get().options.model.getXSO().get().length>1;if(!h){this.enable()}else{this.disable()}},_onSelectionDone:function(k){var j=this;function i(n,m){require(["DS/PADUtils/views/PADAlert"],function(o){o.displayNotification({msg:d.replace(d.get("unsupported_type"),{type:n,name:m}),eventID:"warning"})})}var l=c.getSetting("authorized_types");var h=k[0]["ds6w:type"];if(l.indexOf(h)===-1){i(h,k[0]["ds6w:label"])}else{require(["UWA/Core","DS/PADUtils/PADWSAccess","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(q,y,z){var m=g.get(),w=m.getSelectedNodes(),s;var u=function(E){m.author(true);var B={};B[s]=[{resourceid:E[0].resourceid,relationid:E[0].relationid}];m.insertNodes(B);g.get().displayNotification({msg:z.insert_existing_succeeded,eventID:"info"});w[0].unselect();var C=0,A=false,F=100;function D(){C++;var G=m.getPADTreeDocument().getNodesByRelId(E[0].relationid);if(G&&G.length>0){G[0].select();A=true}if(!A&&C<F){setTimeout(D,100)}}D()};var o=function(A){if(A&&q.is(A.messages,"array")){A.messages.forEach(function(B){g.get().displayNotification({msg:B,eventID:"error"})})}};if(w.length){s=w[0].getID();var n=[];k.forEach(function(A){n.push([A.resourceid])});var p={internal_call:false,data:{parents:[w[0].getOccurencePath()],children:n,commit:true},onSuccess:u,onFailure:o};j.doInsertExisting(p)}else{var t={};var v=[];k.forEach(function(A){v.push(A.resourceid)});t.pids=v;var x=function(){var A=true};var r=true;m.add(t,x,r)}})}},_getResourceId:function(h){if(h.length===0){return""}return h[h.length-1]},doInsertExisting:function(i){var h=this;require(["UWA/Core","DS/PADUtils/PADWSAccess","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(l,t,u){var s=h._getResourceId(i.data.parents[0]);var p=[];i.data.children.forEach(function(w){p.push(h._getResourceId(w))});if(!h.canInstantiate(s,p,u.operationAborted_Cycle)){if(i.onFailure){i.onFailure()}return}var o=i.data.children.length;var v=[];var j=[];var r=[];var m={child:null,parents:[s],commit:true};function q(){if(r.length>0){var x=[];var w;for(w=0;w<r.length;w++){x.push({resourceid:j[w],relationid:r[w]})}if(i.onSuccess){i.onSuccess(x)}}else{if(v.length>0){if(i.onFailure){i.onFailure({messages:v})}}}}var k=0;function n(){m.child=i.data.children[k];k=k+1;t.insertExisting({data:m,onComplete:function(x){var w=l.is(x,"string")?JSON.parse(x):x;if(w.status==="success"){var y=g.get();y.author(true);j.push(h._getResourceId(m.child));r.push(w.newNode.attributes[0].value)}else{var z;if(w.message&&w.message!==null){z=u.insert_existing_failed_with_reason+w.message}else{z=u.insert_existing_failed}if(v.indexOf(z)==-1){v.push(z)}}if(k<o){n()}else{q()}},onFailure:function(w){var x;if(w.message&&w.message!==null){x=w.message}else{x=u.insert_existing_failed}if(v.indexOf(x)==-1){v.push(x)}if(k<o){n()}else{q()}}})}n()})},doReparent:function(i){var h=this;require(["UWA/Core","DS/PADUtils/PADWSAccess","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(l,t,u){var s=h._getResourceId(i.data.parents[0]);var p=[];i.data.children.forEach(function(w){p.push(h._getResourceId(w))});if(!h.canInstantiate(s,p,u.operationAborted_Cycle)){if(i.onFailure){i.onFailure()}return}var o=i.data.children.length;var v=[];var j=[];var r=[];var m={childBus:null,newParent:i.data.parents[0],commit:true};function q(){if(r.length>0){var x=[];var w;for(w=0;w<r.length;w++){x.push({resourceid:j[w],relationid:r[w]})}if(i.onSuccess){i.onSuccess(x)}}else{if(v.length>0){if(i.onFailure){i.onFailure({messages:v})}}}}var k=0;function n(){m.childBus=i.data.children[k];k=k+1;t.reParent({data:m,onComplete:function(y){var w=l.is(y,"string")?JSON.parse(y):y;if(w.status==="success"){var x=g.get();x.author(true);j.push(h._getResourceId(m.childBus));r.push(w.newNode.attributes[0].value)}else{var z;if(w.message&&w.message!==null){z=u.reparent_failed_with_reason+w.message}else{z=u.reparent_failed}if(v.indexOf(z)==-1){v.push(z)}}if(k<o){n()}else{q()}},onFailure:function(w){var x;if(w.message&&w.message!==null){x=w.message}else{x=u.reparent_failed}if(v.indexOf(x)==-1){v.push(x)}if(k<o){n()}else{q()}}})}n()})},canInstantiate:function(k,j,h){var m=false;for(var l=0;l<j.length;l++){m=this._searchForCycle(k,j[l]);if(m){break}}if(h&&m){require(["DS/PADUtils/views/PADAlert"],function(i){i.displayNotification({msg:h,eventID:"warning"})})}return !m},_searchForCycle:function(t,v,u){var k=g.get();var q=k.getPADTreeDocument();if(!q){return false}if(!UWA.is(u,"array")){u=[]}var r=false;var m=q.getNodesById(t);if(m){for(var p=0;p<m.length&&!r;p++){var s=m[p];var h=s.getParents();if(h){for(var o=h.length-1;o>=0&&!r;o--){var n=h[o];var l=n.getID();if(u.indexOf(l)<0){r=this._searchForCycle(l,v,u);if(!r){u.push(l)}}}}if(!r){r=s.isDescendantOf(v)}}}return r},});return f});define("DS/ENOPAD_v2/mixins/_PADFolder",["UWA/Core","UWA/Class","DS/PlatformAPI/PlatformAPI","DS/PADUtils/PADSettingsMgt"],function(e,b,a,c){var d=b.extend({requestCurrentFolder:function(){a.publish("FolderEditor.RequestCurrentFolder")},setFolderCommunicationChannel:function(){a.subscribe("FolderEditor.CurrentFolder",this.setCurrentFolder.bind(this));this.requestCurrentFolder()},getCurrentFolder:function(){return this.getOption("current_folder")&&this.getOption("current_folder")!=={}?this.getOption("current_folder"):null},setCurrentFolder:function(f){this.setOption("current_folder",f);var g=JSON.parse(f);if(widget){widget.setValue("pad_security_ctx",g.SecurityContext);c.setSetting("pad_security_ctx",g.SecurityContext)}},getSecurityContext:function(){return{SecurityContext:c.getSetting("pad_security_ctx"),tenant:c.getSetting("x3dPlatformId")}},});return d});define("DS/ENOPAD_v2/utils/PADInlineEdit",[],function(){var a={};return a});define("DS/ENOPAD_v2/commands/edit/_Copy",["UWA/Class"],function(a){var b={execute:function(c){c.context.copy()}};return b});define("DS/ENOPAD_v2/mixins/_PADCtx",["UWA/Class","i18n!DS/ENXNav/assets/nls/ENXNav.json","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","DS/ApplicationFrame/CommandsManager","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADClipboard","DS/PADUtils/PADSettingsMgt"],function(b,g,i,a,d,e,f){var h={CUT:"url("+d.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_Cut.png")+")",COPY:"url("+d.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_Copy.png")+")",PASTE:"url("+d.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_Paste.png")+")",RENAME:"url("+d.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_Rename.png")+")",RESETPOS:"url("+d.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_ResetPosition.png")+")",COPYRELPOS:"url("+d.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_CopyPosition.png")+")",COPYABSPOS:"url("+d.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_CopyPosition.png")+")",PASTEPOS:"url("+d.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_PastePosition.png")+")"};var c=b.extend({ccpMenu:function(k,j){k.push({type:"SeparatorItem"});k.push({type:"PushItem",title:i.PAD_CMDCopy,icon:h.COPY,state:this.getEditMode()?"enabled":"disabled",action:{"this":this,context:j,callback:function(m){this._copy(m.context)}}});k.push({type:"PushItem",title:i.PAD_CMDCut,icon:h.CUT,state:this.getEditMode()?"enabled":"disabled",action:{"this":this,context:j,callback:function(m){this._cut(m.context)}}});if(e.isEmpty()===false){var l=this.getPADTreeDocument().getXSO().get();if(l&&l.length>0){k.push({type:"PushItem",title:i.PAD_CMDPaste,icon:h.PASTE,state:this.getEditMode()?"enabled":"disabled",action:{"this":this,context:j,callback:function(m){this._paste(m.context)}}})}}},pseTreeMenu:function(m,k,l){if(f.getSetting("activateEditInCtxMenu")===true&&f.getSetting("activateEditInTable")===true){var j=this.getPADTreeListView();if(j.canColumnBeEditable(l)===true){var n=this.options.model.getSelectedNodes();if(n.length>1&&f.getSetting("activateBulkEditEdit")===true){m.push({type:"PushItem",title:i.PAD_CMDRename,icon:h.RENAME,state:this.getEditMode()?"enabled":"disabled",action:{"this":this,context:{node:k,cellInfos:l},callback:function(p){var o=this.getPADTreeListView();var q=p.context.cellInfos.cellModel.getView();if(q){o.activateWriteMode(q.getCellInfos());o.giveFocus()}}},submenu:[{type:"PushItem",title:i.PAD_CMDRenameAll,icon:h.RENAME,state:this.getEditMode()?"enabled":"disabled",action:{"this":this,context:{nodes:n,cellInfos:l},callback:function(p){var o=this;require(["DS/ENOPAD_v2/utils/PADBulkEdit"],function(q){q.execute({padcomponent:o,cellInfos:l})})}}}]})}else{m.push({type:"PushItem",title:i.PAD_CMDRename,icon:h.RENAME,state:this.getEditMode()?"enabled":"disabled",action:{"this":this,context:{node:k,cellInfos:l},callback:function(p){var o=this.getPADTreeListView();var q=p.context.cellInfos.cellModel.getView();if(q){o.activateWriteMode(q.getCellInfos());o.giveFocus()}}}})}}}},psePositionCtxCmd:function(p){var m=this;var j={available:false,menu:[]};var l=p.treeview.nodeModel?p.treeview.nodeModel:p.treeview.cellModel,o=p.treeview.cellView.getCellInfos();if(l.isRoot()===false&&f.getSetting("ActivateCCPPosition")===true){j.available=true;var q=m.getPADTreeDocument().getSelectedNodes();var n=false;for(var k=0;k<q.length&&n===false;k++){if(q[k].options.grid.instanceMatrix){n=true}}if(n){j.menu.push({type:"PushItem",title:i.PAD_CMDResetPosition,icon:h.RESETPOS,state:this.getEditMode()?"enabled":"disabled",action:{"this":this,context:{node:l,cellInfos:o},callback:function(r){m.resetPosition()}}});if(q.length===1){j.menu.push({type:"PushItem",title:i.PAD_CMDCopyRelativePosition,icon:h.COPYRELPOS,state:this.getEditMode()?"enabled":"disabled",action:{"this":this,context:{node:l,cellInfos:o},callback:function(r){console.warn("Need to calculate the absolute matrix");var s={matrix:r.context.node.options.grid.instanceMatrix};e.setData(e.POSITION,s)}}})}}if(e.isEmpty(e.POSITION)===false&&(l.options.relationtype==="VPMInstance"||(l.options.relationtype===""&&l.options.type!=="3DShape"&&l.options.type!=="Drawing"))){j.menu.push({type:"PushItem",title:i.PAD_CMDPastePosition,icon:h.PASTEPOS,state:this.getEditMode()?"enabled":"disabled",action:{"this":this,context:{node:l,cellInfos:o},callback:function(r){m.pastePosition()}}})}if(j.menu.length===0){j.menu.push({type:"PushItem",title:i.PAD_CMDNoPositionAction,state:"disabled"})}}return j},addCCPMenu:function(l,m){var k=this;m.push({label:i.PAD_CMDCopy,icon:"url("+d.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_Copy.png")+")",data:l,callback:this._copy.bind(this)});m.push({label:i.PAD_CMDCut,icon:"url("+d.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_Cut.png")+")",data:l,callback:this._cut.bind(this)});if(e.isEmpty(e.OBJECT)===false){var j=this.getPADTreeDocument().getXSO().get();if(j&&j.length>0){m.push({label:i.PAD_CMDPaste,icon:"url("+d.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_Paste.png")+")",data:l,callback:this._paste.bind(this)})}}},});c.prototype._copy=function(){this._launchAction({command:"Copy"})};c.prototype._cut=function(){this._launchAction({command:"Cut"})};c.prototype._paste=function(){this._launchAction({command:"Paste"})};return c});define("DS/ENOPAD_v2/utils/PADBulkEdit",["css!DS/ENOPAD_v2/ENOPAD_v2","UWA/Core","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/UIKIT/Mask","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt",],function(k,i,h,e,g,p,a,b,j){var n="DS/ENOFloatingPanel/ENOFloatingPanel";var l=/^\d+$/;function f(s){var r=0;for(var q=0;q<s.length;q++){if(l.test(s[q])){r++}}return r===s.length}function d(r,q){var t=parseInt(r.valueItem);var s=parseInt(q.valueItem);return t-s}function m(){var q="500px";if(document.body.scrollHeight>40){q=document.body.scrollHeight+"px"}return q}function c(){var q=document.getElementsByClassName("xnav_component");if(q&&q.length===1){return q[0]}else{return document.body}}var o={execute:function(y){var s=y.padcomponent,u=s.getPADTreeListView(),t=s.getPADTreeDocument(),w=s.getSelectedNodes(),x=y.cellInfos,q=j.getSetting("bulkEditPCSLimit");if(w.length>q){a.displayNotification({msg:h.replace(h.get("bulkEditPCSLimitExceeded"),{limit:q}),eventID:"warning"});return}g.mask(u.getContent(),h.checkingRights);var A={lIds:[],busIDs:[],relIDs:[],attributes:"true"};var r=false;for(var v=0;v<w.length;v++){var z;if(x.dataIndex==="instanceName"){z=w[v].getRelationID();r=true;if(A.relIDs.indexOf(z)===-1){A.relIDs.push(z)}}else{z=w[v].getID();if(A.busIDs.indexOf(z)===-1){A.busIDs.push(z)}}}p.read({data:A,onComplete:function(G){var M=i.is(G,"string")?JSON.parse(G):G;g.unmask(u.getContent());var F=[];var E=false,H,D,L;for(var J=0;J<M.results.length;J++){var N=M.results[J];var B;if(r){B=t.getNodesByRelId(N.physicalID)}else{B=t.getNodesById(N.physicalID)}if(B.length){var C=B[0];var I=L=u._updateNodeModel(B[0],N,r);var K=true;if(I.isEditable){if(C.options.edit.editableColumns[x.dataIndex]&&C.options.edit.editableColumns[x.dataIndex].readOnly===false){K=false;F.push(N.physicalID)}}if(K){a.displayNotification({msg:h.replace(h.get("accessrightAttrenoteditable_2"),{attr:x.manager.getColumnOptions(x.dataIndex).text,label:B[0].getLabel()}),eventID:"warning"});delete B[0].options.edit}else{E=true;H=I.editableColumns[x.dataIndex].kind;D=I.editableColumns[x.dataIndex].maxLength}}}if(E){switch(H){case"integer":case"real":case"string":o.editStringAttribute({cellInfos:x,editableIds:F,model:t,treelist:u,editOptions:L,isInstance:r});break;case"timestamp":o.editDateAttribute({cellInfos:x,editableIds:F,model:t,treelist:u,editOptions:L});break;case"boolean":o.editBoolAttribute({cellInfos:x,editableIds:F,model:t,treelist:u,editOptions:L});break;case"enum":o.editEnumAttribute({cellInfos:x,editableIds:F,model:t,treelist:u,editOptions:L});break;default:console.error("Unknown kind of attribute");break}}},onTimeout:function(){a.displayNotification({msg:h.accessrightCheckTimeout,eventID:"error"});g.unmask(u.getContent())},onFailure:function(){a.displayNotification({msg:h.accessrightCheckFailed,eventID:"error"});g.unmask(u.getContent())}})},editStringAttribute:function(q){require([n,"DS/Controls/LineEditor","DS/Controls/Button"],function(x,t,A){var s="";var B;var D=i.createElement("div",{"class":"PADEditModalBody stringEdit"});var r=q.editOptions.editableColumns[q.cellInfos.dataIndex].mandatory;r=(r===undefined)?false:r;var y=q.editOptions.editableColumns[q.cellInfos.dataIndex].kind;var w=new t({placeholder:h.enterModification,requiredFlag:r,sizeInCharNumber:q.editOptions.editableColumns[q.cellInfos.dataIndex].maxLength}).inject(D);w.addEventListener("uncommittedChange",function(E){var F=true;s=E.dsModel.valueToCommit;if(y==="integer"||y==="real"){F=!isNaN(Number(s))}else{if(s===""&&E.dsModel.requiredFlag){F=false}}if(F){B.disabled=false}else{B.disabled=true}});var v=function(){o.updateModelOnServer({model:q.model,cellInfos:q.cellInfos,newValue:s,editableIds:q.editableIds,editOptions:q.editOptions,isInstance:q.isInstance});C.destroy()};var z=i.createElement("div",{"class":"PADEditModalFooter"});B=new A({label:h.apply,emphasize:"primary",touchMode:true,disabled:r,onClick:v});B.inject(z);var u=new A({label:h.cancel,touchMode:true,onClick:function(){C.destroy()}});u.inject(z);var C=new x({className:"PADEditModal stringEdit",title:h.replace(h.get("editAttribute"),{attr:q.cellInfos.manager.getColumnOptions(q.cellInfos.dataIndex).text}),body:D,footer:z,overlay:true,closable:true,animate:true,resizable:false,visible:true,autocenter:true,events:{onClose:function(){C.destroy()}}});document.addEventListener("keyup",function(E){if(E.keyCode===27&&C){C.destroy();C=null}});C.inject(c())})},editDateAttribute:function(r){var q=this;require([n,"DS/Controls/DatePicker","DS/Controls/Button"],function(z,y,C){var s;var D;var G=i.createElement("div",{"class":"PADEditModalBody dateEdit"});var t=new Date(Date.now());var F=r.cellInfos.nodeModel.options.grid[r.cellInfos.dataIndex];if(F){t=new Date(F)}var A=new y({value:t,timePickerFlag:true}).inject(G);A.addEventListener("change",function(H){s=H.dsModel.value;D.disabled=false});var w=q.buildCancelClosure(r.cellInfos.nodeModel);var v=function(){require([x],function(I){var H=I.convertDateToStandard(s,true);o.updateModelOnServer({model:r.model,cellInfos:r.cellInfos,newValue:H.valueDB,editableIds:r.editableIds,editOptions:r.editOptions})});E.destroy()};var B=i.createElement("div",{"class":"PADEditModalFooter"});D=new C({label:h.apply,emphasize:"primary",touchMode:true,disabled:true,onClick:v});var x="DS/WidgetServices/WidgetServices";D.inject(B);var u=new C({label:h.cancel,touchMode:true,onClick:function(){w();E.destroy()}});u.inject(B);var E=new z({className:"PADEditModal stringEdit",title:h.replace(h.get("editAttribute"),{attr:r.cellInfos.manager.getColumnOptions(r.cellInfos.dataIndex).text}),body:G,footer:B,overlay:true,closable:true,animate:true,resizable:false,visible:true,autocenter:true,events:{onClose:function(){w();E.destroy()}}});document.addEventListener("keyup",function(H){if(H.keyCode===27&&E){w();E.destroy();E=null}});E.inject(c())})},editBoolAttribute:function(r){var q=this;require([n,"DS/Controls/ButtonGroup","DS/Controls/Button"],function(x,s,A){var t;var B;var D=i.createElement("div",{"class":"PADEditModalBody boolEdit"});var y=new s().inject(D);y.addChild(new A({type:"radio",touchMode:true,label:h.True,value:true,displayStyle:"lite-borders",icon:{iconName:"check",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}}));y.addChild(new A({type:"radio",touchMode:true,label:h.False,value:false,displayStyle:"lite-borders",icon:{iconName:"wrong",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}}));y.addEventListener("change",function(E){t=E.dsModel.value;B.disabled=false});var w=q.buildCancelClosure(r.cellInfos.nodeModel);var v=function(){o.updateModelOnServer({model:r.model,cellInfos:r.cellInfos,newValue:t,editableIds:r.editableIds,editOptions:r.editOptions});C.destroy()};var z=i.createElement("div",{"class":"PADEditModalFooter"});B=new A({label:h.apply,emphasize:"primary",touchMode:true,disabled:true,onClick:v});B.inject(z);var u=new A({label:h.cancel,touchMode:true,onClick:function(){w();C.destroy()}});u.inject(z);var C=new x({className:"PADEditModal boolEdit",title:h.replace(h.get("editAttribute"),{attr:r.cellInfos.manager.getColumnOptions(r.cellInfos.dataIndex).text}),body:D,footer:z,overlay:true,closable:true,animate:true,resizable:false,visible:true,autocenter:true,events:{onClose:function(){w();C.destroy()}}});document.addEventListener("keyup",function(E){if(E.keyCode===27&&C){w();C.destroy();C=null}});C.inject(c())})},editEnumAttribute:function(r){var q=this;require([n,"DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/Toggle"],function(B,y,D,s,u){var A;var C;var G=r.editOptions.editableColumns[r.cellInfos.dataIndex];var z=i.createElement("div",{"class":"PADEditModalBody PADEditModalBody comboEdit"});var I=f(G.range);var v=[];for(var H=0;H<G.range.length;H++){v.push({labelItem:G.displayRange[H],valueItem:G.range[H]})}if(I){v.sort(d)}var w=q.buildCancelClosure(r.cellInfos.nodeModel);var E=new y({elementsList:v,currentValue:G.current,enableSearchFlag:false}).inject(z);var t=function(){var K=E.value;o.updateModelOnServer({model:r.model,cellInfos:r.cellInfos,newValue:K,editableIds:r.editableIds,editOptions:r.editOptions});J.destroy()};var F=i.createElement("div",{"class":"PADEditModalFooter"});C=new D({label:h.apply,emphasize:"primary",touchMode:true,disabled:false,onClick:t});C.inject(F);var x=new D({label:h.cancel,touchMode:true,onClick:function(){w();J.destroy()}});x.inject(F);var J=new B({className:"PADEditModal  PADEditModalBody comboEdit",title:h.replace(h.get("editAttribute"),{attr:r.cellInfos.manager.getColumnOptions(r.cellInfos.dataIndex).text}),body:z,footer:F,overlay:true,closable:true,animate:true,resizable:false,visible:true,autocenter:true,events:{onClose:function(){w();J.destroy()}}});document.addEventListener("keyup",function(K){if(K.keyCode===27&&J){w();J.destroy();J=null}});J.inject(c())})},buildCancelClosure:function(q){return function(){delete q._updateFromEdit;delete q._editDataIndex;delete q.options.edit}},updateModelOnServer:function(x){var q=[];var t=x.cellInfos.dataIndex;var r="model/bus/";if(t==="instanceName"){r="model/rel/"}var y=x.editOptions.editableColumns[t].path;var u=x.editOptions.editableColumns[t].selectable;for(var w=0;w<x.editableIds.length;w++){var v=r+x.editableIds[w];var s={path:v,method:"PATCH",body:[{op:"replace",path:y,value:x.newValue}],queryParams:{select:["physicalid","modified",u]}};q.push(s)}x.model._beginBlockingTransaction(h.updateAttribute);p.update({data:{requests:q},onComplete:function(B){x.model._endBlockingTransaction();b.setAuthoringState(true,e.PADSession_disabling_index_authoring);var J=i.is(B,"string")?JSON.parse(B):B;if(!J.results){throw new Error("Invalid update answer")}var E=x.model;for(var I=0;I<J.results.length;I++){var L=J.results[I];var D=L.body.physicalid;var z;if(x.isInstance){z=E.getNodesByRelId(D)}else{z=E.getNodesById(D)}var C=s.body[0].path;var K=Object.keys(L.body);var H;var G=[];for(var A=0;A<K.length;A++){var F=K[A];if(F.indexOf(C)!==-1){H=L.body[F];if(H.notification){G.push(H.notification)}}}if(L.body.errors&&L.body.errors.length>0){for(var A=0;A<L.body.errors.length;A++){G.push(L.body.errors[A])}}if(G&&G.length>0){for(var A=0;A<G.length;A++){a.displayNotification({msg:G[A].message,eventID:"warning"})}}else{if(z&&z.length>0){E.withTransactionUpdate(function(){var P,O=x.editOptions;for(var M=0;M<z.length;M++){var Q=z[M];if(!P){P={grid:{}};var T=Object.getOwnPropertyNames(O.editableColumns);for(var R=0;R<T.length;R++){if(O.editableColumns[T[R]].selectable&&L.body[O.editableColumns[T[R]].selectable]){if(T[R]==="tree"){P.label=L.body[O.editableColumns[T[R]].selectable].value[0];P.display=P.label;P.oldLabel=P.label}else{if(Q.options.grid.hasOwnProperty(T[R])){if(L.body[O.editableColumns[T[R]].selectable].value){P.grid[T[R]]=L.body[O.editableColumns[T[R]].selectable].value[0];if(O.editableColumns[T[R]].kind==="timestamp"){var S=require("DS/WidgetServices/WidgetServices");var N=S.formatDateObj(P.grid[T[R]]);P.grid[T[R]]=N.toUTCString()}}else{P.grid[T[R]]=""}}}}}if(Q.options.grid["ds6w:modified"]&&L.body.modified&&L.body.modified.value){P.grid["ds6w:modified"]=L.body.modified.value[0]}}if(Q._updateFromEdit){delete Q._updateFromEdit}if(Q._editDataIndex){delete Q._editDataIndex}if(Q.options.edit){delete Q.options.edit}Q.updateOptions(P)}})}}}}})}};return o});define("DS/ENOPAD_v2/PADComponent",["DS/ENXNav/XNavComponent","DS/PADUtils/PADSession","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","DS/ENOPAD_v2/mixins/_PADCCP","DS/ENOPAD_v2/mixins/_PADKBInput","DS/ENOPAD_v2/mixins/_PADCtx","DS/ENOPAD_v2/mixins/_PADFolder","DS/ENOPAD_v2/mixins/_PADDnD","DS/ENOPAD_v2/mixins/_PADRefresh","DS/ENXNav/mixins/xNavChangeAction"],function(k,c,e,l,m,g,d,b,j,a,i){c.softInit();var h=k.extend(m,g,d,b,j,a,i,{name:"pad_component",init:function(o){var n=f(o);var p=this._parent.bind(this);this.setFolderCommunicationChannel();require(["DS/PADUtils/XNavSettings","UWA/Utils/Client"],function(q,r){q.loadSettingsSync(o.settings.view_settings);if(n.layout.action_bar!==false){if(o.settings.action_bar.touch&&o.settings.action_bar.standard){n.action_bar_opts=r.Features.touchEvents&&!r.Features.pointerEvents?o.settings.action_bar.touch:o.settings.action_bar.standard}else{n.action_bar_opts=o.settings.action_bar}n.action_bar_opts.language=o.lang}p(n)})},render:function(){return this},getPADTreeListView:function(){return this.options.views.treelistview},getPADTileGridView:function(){return this.options.views.tileview},getPADThumbnailGridView:function(){return this.options.views.thumbnailview},getPADTreeGraph:function(){return this.options?this.options.views.graphview:null},getEditMode:function(){var n=require("DS/PADUtils/PADSettingsMgt");return n.getSetting("EditModeActivated")},setEditMode:function(o){var n=require("DS/PADUtils/PADSettingsMgt");n.setSetting("EditModeActivated",o,true);this.dispatchEvent("editModeModified",o)},add:function(p,q,n){var o=this;if(!p.content){p.content="idslist"}if(q===undefined&&p.callback){q=p.callback}if(n===undefined){n=p.broadcast}p.callback=function(s,r){if(q){q(s,r)}};p.broadcast=n;this._parent(p)},addRootNodes:function(n){if(!UWA.is(n,"array")){throw new Error("nodes parameter must be an array")}var q=this,r=[];this.dropInvitContainer.hide();var o=q.options.model;if(o){o.wrapInTransaction(function(){o.withTransactionUpdate(function(){o.addRoot(n);for(var s=0;s<n.length;s++){r.push(n[s].getID())}var t=o.getRoots().length;if(UWA.is(o.detachedRoots,"array")){t=t+o.detachedRoots.length}o.getModelEvents().publish({event:"onRootAdded",data:{nb_root:o.getRoots().length,added_node:n[o.getRoots().length-1]}})})})}var p={pids:r};q._commandProxy.drop(p)},addNodesFromContent:function(n,r,q,o){var p=this;require(["DS/PADUtils/PADTypesMgt"],function(s){s.retrieveAuthorizedObjects({version:"2.0",X3DContentId:n,callback:function(t){if(t.authorizedWithKind){if(t.authorizedWithKind.Product&&t.authorizedWithKind.Product.length>0){p.add({content:"3DXContent",authorized_objects:t.authorizedWithKind.Product,callback:r,behavior:q})}if(t.authorizedWithKind.Filter&&t.authorizedWithKind.Filter.length>0){p.addFilter({content:"3DXContent",filter_objects:t.authorizedWithKind.Filter,callback:r,behavior:undefined})}if(t.authorizedWithKind.Change&&t.authorizedWithKind.Change.length>0){if(p.loadChange){p.loadChange({content:"3DXContent",objects:t.authorizedWithKind.Change,callback:r,behavior:q})}}}else{p.add({content:"3DXContent",authorized_objects:t.authorized_objects,behavior:q},r,o)}}})})},getOrdering:function(n){return this.options.model.getOrdering(n)},replaceNodes:function(s){var r=this;var p=[];var o=s.toInsert;var n={deleted:s.toDelete};if(s.toDelete){s.toDelete.forEach(function(v){for(var u in v){p.push(v[u])}})}var t=function(){r.refreshView(n);var u={};u.detach={deleted:p};r._commandProxy.padRefresh(u)};var q=function(u){r.processExpand(u)};s.callack=t;s.callback2=q;this.options.model.insertNodesSplitFetch(s)},processExpand:function(w){var u=w.expandNodeIds;var v=w.expandLevels;var q=u.length;if(q>0){var p=[];for(var t=0;t<q;t++){var s=v[t];var r=u[t];if(s>0){var o=this.options.model.getNodesById(r);if(o&&o.length>0){p.push(o[0])}}}if(p.length===0){return}var n=Math.max.apply(null,v);if(p.length>1){this.options.model.expandMultiSelect({nodes2Expand:p,numberOfLevelsToExpand:n})}if(p.length===1){p[0].expandNLevels({numberOfLevelsToExpand:n})}}},insertNodes:function(n){this.options.model.insertNodes(n);if(this.options.active_view==="graphview"){this.options.views.graphview.reframeAll();if(this.dropInvitContainer){this.dropInvitContainer.hide()}}},author:function(n){c.setAuthoringState(n,e.PADSession_disabling_index_authoring)},setDnDBehavior:function(n){this.options.model.setDnDBehavior(n)},setConfirmdDialog:function(n){this.options.model.setConfirmdDialog(n)},displayNotification:function(n){require(["DS/PADUtils/views/PADAlert"],function(o){o.displayNotification(n)})},broadcastSelect:function(n){this.options.model.broadcastSelect(n)},getSelectedNodes:function(){return this.options.model.getSelectedNodes()},getActiveView:function(){return this.options?this.options.active_view:"treelistview"},refreshView:function(t){var s;var p=t.modified;if(p){s={};s.modified=p}var u=t.created;if(u){if(!s){s={}}s.created=[];u.forEach(function(v){s.created.push(v.physicalid)})}var o;var q;var n=t.deleted;if(n){var r=this;n.forEach(function(w){var x=w.physicalid;var v=r.getPADTreeDocument().getNodesById(x);if(!v||v.length===0){v=r.getPADTreeDocument().getNodesByRelId(x)}v.forEach(function(y){if(y.isRoot()){if(!o){o=[]}o.push(x)}else{if(!q){q=[]}q.push(y)}})})}if(s){this.getPADTreeDocument().refreshNodeById(s)}if(q){this.getPADTreeDocument().deleteNodes(q)}if(o){this._onRemoveRoot({pids:o})}},_dispatchReady:function(n){if((this.options.isReady.model===true)&&(this.options.isReady.PADmodel!==true)){this._buildENOPADModel();this.options.isReady.PADmodel=true}if(this.options.isReady.model===true){this._probes.probe_model.end()}if(this.options.isReady[this.options.active_view]===true){this._probes.probe_view.end()}if(this.options.isReady.actionbar===true&&this._probes.probe_actionbar){this._probes.probe_actionbar.end()}if(this._dispatchReady_NotDone===true&&this.options.isReady.model===true&&this.options.isReady.actionbar===true&&this.options.isReady[this.options.active_view]===true){this.dispatchEvent.call(this,"onReady",{addInView:n});this.dispatchEvent("onActionBarReadyToBuild");this._probes.probe_init.end();this._dispatchReady_NotDone=false}},_buildENOPADModel:function(){var n=this;if(n.options.layout.keyboard_inputs===true&&!n._keyboardListener){n._keyboardListener=new g({component:n});n._keyboardListener.startObservingKeyboard(this.elements.container)}var o=n.getContent();o.addEventListener("dragleave",function(s){var r=s.relatedTarget;var q=r?r.className:" ";var p=(q&&q.indexOf("paddnd_invite")!==-1)?true:false;if(p){s.preventDefault();s.stopPropagation();return false}if(n.dropInvitContainer){n.dropInvitContainer.hide()}if(n.options.model.getRoots().length===0){n.dropInvitContainer.show("drop")}},false)}});function f(o){var n={x3dAppId:"ENOPAD",widget:widget,amd_custo:{TreeDocument:"DS/ENOPAD_v2/models/PADTreeDocument",TreeListView:"DS/ENOPAD_v2/views/PADTreeListView",TileGridView:"DS/ENXNav/views/xNavResponsiveTilesView",ThumbnailGridView:"DS/ENXNav/views/xNavResponsiveThumbnailsView"},layout:{}};n.layout=UWA.clone(o.layout_opts);n=UWA.extend(n,o,true);delete n.layout_opts;return n}return h});define("DS/ENOPAD_v2/mixins/_PADEditInLst",["UWA/Core","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/UIKIT/Mask","DS/PADUtils/PADWSAccess","text!DS/ENOPAD_v2/assets/PADEditInList.json","DS/ApplicationFrame/CommandsManager","DS/PADUtils/PADSession","DS/PADUtils/views/PADAlert","DS/ENOPAD_v2/utils/PADBulkEdit","DS/PADUtils/XNavSettings"],function(i,h,f,g,p,c,a,d,b,n,j){function k(r,s){delete r._updateFromEdit;delete r._editDataIndex;delete r.options.edit;var q=r.getTreeDocument();q.withTransactionUpdate(function(){if(s==="tree"){r.updateOptions({label:r.options.oldLabel,grid:{}})}else{var t={grid:{}};t.grid[s]=r.previousValue;r.updateOptions(t)}})}var o=null;var m=JSON.parse(c);var l={addEditCB:function(r){var q=r;q.isEditable=true;q.shouldBeEditable=l.shouldBeEditable;return q},canColumnBeEditable:function(t){var q=false;if(t.nodeModel){if((j.isHardcodedColumn(t.dataIndex)===false&&(t.dataIndex.indexOf("ds6wg:XP_VPMReference_Ext")!==-1||t.dataIndex.indexOf("ds6w")===-1))&&m.editableColumnsDataIndex.indexOf(t.dataIndex)===-1){var s=t.dataIndex.split(":");var r=s[s.length-1];r=r.replace("XP_VPMReference_Ext.","");m.editableColumnsDataIndex.push(t.dataIndex);m.editableColumnsAttribute.push(r);m.editBehavior[t.dataIndex]={mode:"inline",attribute:r}}if(m.editableColumnsDataIndex.indexOf(t.dataIndex)!==-1&&m.editBehavior[t.dataIndex].mode==="inline"){if(t.dataIndex==="instanceName"){if(t.nodeModel.options.relationid){q=true}}else{q=true}}}return q},shouldBeEditable:function(r){var q=false;if(o===r.dataIndex){q=true}return q},setCurrentEdit:function(q){o=q},clearCurrentEdit:function(){o=null},activateWriteMode:function(w){var t=this,s=w.nodeModel;if((j.isHardcodedColumn(w.dataIndex)===false&&(w.dataIndex.indexOf("ds6wg:XP_VPMReference_Ext")!==-1||w.dataIndex.indexOf("ds6w")===-1))&&m.editableColumnsDataIndex.indexOf(w.dataIndex)===-1){var v=w.dataIndex.split(":");var r=v[v.length-1];r=r.replace("XP_VPMReference_Ext.","");m.editableColumnsDataIndex.push(w.dataIndex);m.editableColumnsAttribute.push(r);m.editBehavior[w.dataIndex]={mode:"inline",attribute:r}}if(m.editableColumnsDataIndex.indexOf(w.dataIndex)!==-1&&w.nodeModel._updateFromEdit!==true){var q={lIds:[s.getID()],attributes:"true"};var u=false;if(w.dataIndex==="instanceName"){if(w.nodeModel.options.relationid){q.lIds=[w.nodeModel.options.relationid];u=true}else{return}}g.mask(this.getContent(),h.checkingRights);p.read({data:q,onComplete:function(C){var z=i.is(C,"string")?JSON.parse(C):C;g.unmask(t.getContent());if(!z.results){throw new Error("Invalid read WS response: no Results")}if(z.results.length!==q.lIds.length){throw new Error("Invalid read WS response: Incoherent answer")}t._updateNodeModel(w.nodeModel,z.results[0],u);if(w.nodeModel.options.edit.isEditable){t.setCurrentEdit(w.dataIndex);if(w.nodeModel.options.edit.editableColumns[w.dataIndex]&&w.nodeModel.options.edit.editableColumns[w.dataIndex].readOnly===false){switch(w.nodeModel.options.edit.editableColumns[w.dataIndex].mode){case"inline":switch(w.nodeModel.options.edit.editableColumns[w.dataIndex].kind){case"integer":case"real":case"string":w.nodeModel._updateFromEdit=true;w.nodeModel._editDataIndex=w.dataIndex;w.nodeModel.previousValue=w.nodeModel.options.grid[w.dataIndex];w.cellView.switchToWriteView();break;case"boolean":w.nodeModel._updateFromEdit=true;w.nodeModel._editDataIndex=w.dataIndex;n.editBoolAttribute({cellInfos:w,editableIds:q.lIds,model:w.nodeModel.getTreeDocument(),treelist:t,editOptions:w.nodeModel.options.edit});break;case"timestamp":w.nodeModel._updateFromEdit=true;w.nodeModel._editDataIndex=w.dataIndex;n.editDateAttribute({cellInfos:w,editableIds:q.lIds,model:w.nodeModel.getTreeDocument(),treelist:t,editOptions:w.nodeModel.options.edit});break;case"enum":w.nodeModel._updateFromEdit=true;w.nodeModel._editDataIndex=w.dataIndex;n.editEnumAttribute({cellInfos:w,editableIds:q.lIds,model:w.nodeModel.getTreeDocument(),treelist:t,editOptions:w.nodeModel.options.edit})}break;case"command":var B=a.getCommand(w.nodeModel.options.edit.editableColumns[w.dataIndex].command);if(B){B.begin()}delete w.nodeModel.options.edit;break;case"commandByValue":var A=w.nodeModel.options.grid[w.dataIndex];var y;for(var x=0;x<w.nodeModel.options.edit.editableColumns[w.dataIndex].commands.length&&y===undefined;x++){if(w.nodeModel.options.edit.editableColumns[w.dataIndex].commands[x].value===A){y=w.nodeModel.options.edit.editableColumns[w.dataIndex].commands[x].name}}var B=a.getCommand(y);if(B){B.begin()}delete w.nodeModel.options.edit;break}}else{w.cellView.switchToReadView();delete w.nodeModel.options.edit}t.clearCurrentEdit()}else{w.cellView.switchToReadView();delete w.nodeModel.options.edit}},onFailure:function(){g.unmask(t.getContent());b.displayNotification({msg:h.accessrightfailed,eventID:"warning"});w.cellView.switchToReadView();delete w.nodeModel.options.edit}})}},onNodeModelUpdate:function(v){var q=v.data.nodeModel;if(q._updateFromEdit===true){var w=q._editDataIndex;delete q._updateFromEdit;delete q._editDataIndex;var u=m.editableColumnsDataIndex.indexOf(w);if(u!==-1){var r=q.options.edit;if(!r){r=m.editOptions}var y=r.editableColumns[w].kind;var C=r.editableColumns[w].path;var z=r.editableColumns[w].selectable;var t=q.getID();var B=w==="tree"?q.getLabel():q.options.grid[w];if(w==="tree"&&(B===null||B==="")){b.displayNotification({msg:h.attributeModificationWrongEmptyValue,eventID:"warning"});setTimeout(function(){k(q,w)},100)}else{if(w==="tree"&&B.length>100){b.displayNotification({msg:h.attributeModificationWrongTooLongValue,eventID:"warning"});setTimeout(function(){k(q,w)},100)}else{if((y==="integer"||y==="real")&&isNaN(Number(B))){b.displayNotification({msg:h.replace(h.get("attributeKindNumber"),{attr:m.editableColumnsAttribute[u]}),eventID:"warning"});setTimeout(function(){k(q,w)},100)}else{var A="model/bus/"+t;if(w==="instanceName"){A="model/rel/"+q.getRelationID()}var s={path:A,method:"PATCH",body:[{op:"replace",path:C,value:B}],queryParams:{select:["physicalid","modified",z]}};var x=this;this._beginBlockingTransaction(h.updateAttribute);p.update({data:{requests:[s]},onComplete:function(F){x._endBlockingTransaction();var M=i.is(F,"string")?JSON.parse(F):F;if(!M.results||M.results.length!==1){throw new Error("Invalid update answer")}var H=s.body[0].path;var E=M.results[0];var N=Object.keys(E.body);var K;var L=[];for(var G=0;G<N.length;G++){var J=N[G];if(J.indexOf(H)!==-1){K=E.body[J];if(K.notification){L.push(K.notification)}}}if(E.body.errors&&E.body.errors.length>0){for(var G=0;G<E.body.errors.length;G++){L.push(E.body.errors[G])}}if(L&&L.length>0){for(var G=0;G<L.length;G++){b.displayNotification({msg:L[G].message,eventID:"warning"})}k(q,w)}else{if(E.status!==200){e(q)}else{d.setAuthoringState(true,f.PADSession_disabling_index_authoring);var I=q.getTreeDocument();var D;if(w==="instanceName"){t=E.body.physicalid;D=I.getNodesByRelId(t)}else{D=I.getNodesById(t)}if(D&&D.length>0){I.withTransactionUpdate(function(){var Q,P=D.map(function(U){if(U.options.edit){return U.options.edit}}).filter(function(U){return U!==undefined})[0];if(!P){P=r}for(var O=0;O<D.length;O++){var R=D[O];if(!Q){Q={grid:{}};var T=Object.getOwnPropertyNames(P.editableColumns);for(var S=0;S<T.length;S++){if(P.editableColumns[T[S]].selectable&&E.body[P.editableColumns[T[S]].selectable]){if(T[S]==="tree"){Q.label=E.body[P.editableColumns[T[S]].selectable].value[0];Q.display=Q.label;Q.oldLabel=Q.label;I._triggerTitleUpdate()}else{if(i.is(R.options.grid[T[S]])){if(E.body[P.editableColumns[T[S]].selectable].value){Q.grid[T[S]]=E.body[P.editableColumns[T[S]].selectable].value[0]}else{Q.grid[T[S]]=""}}}}}if(R.options.grid["ds6w:modified"]&&E.body.modified&&E.body.modified.value){Q.grid["ds6w:modified"]=E.body.modified.value[0]}}if(R._updateFromEdit){delete R._updateFromEdit}if(R._editDataIndex){delete R._editDataIndex}if(R.options.edit){delete R.options.edit}R.updateOptions(Q)}})}}}},onFailure:function(){if(q._updateFromEdit){delete q._updateFromEdit}if(q._editDataIndex){delete q._editDataIndex}if(q.options.edit){delete q.options.edit}e(q);b.displayNotification({msg:h.attributeModificationFailed,eventID:"warning"})}})}}}}else{if(q._updateFromEdit){delete q._updateFromEdit}if(q._editDataIndex){delete q._editDataIndex}if(q.options.edit){delete q.options.edit}e(q);b.displayNotification({msg:h.attributeModificationFailed,eventID:"warning"})}}},_updateNodeModel:function(s,x,u){var t=s,z=0,y={isEditable:x.modifyAccess,editableColumns:{}};for(z=0;z<x.basicData.length;z++){var v=x.basicData[z];var r=u===true?"instanceName."+v.name:v.name;if(m.editableColumnsAttribute.indexOf(r)!==-1){y.editableColumns[m.editableColumnsDataIndex[m.editableColumnsAttribute.indexOf(r)]]={mandatory:v.mandatory,readOnly:v.readOnly,maxLength:v.maxlength,path:v.path,selectable:v.selectable,kind:v.type,mode:m.editBehavior[m.editableColumnsDataIndex[m.editableColumnsAttribute.indexOf(v.name)]].mode,command:m.editBehavior[m.editableColumnsDataIndex[m.editableColumnsAttribute.indexOf(v.name)]].command}}}for(z=0;z<x.data.length;z++){var v=x.data[z];var w=false;if(v.range){w=true}var r=u===true?"instanceName."+v.name:v.name;if(m.editableColumnsAttribute.indexOf(r)!==-1){var q={mandatory:v.mandatory,readOnly:v.readOnly,maxLength:v.maxlength,path:v.path,selectable:v.selectable,kind:v.type,mode:m.editBehavior[m.editableColumnsDataIndex[m.editableColumnsAttribute.indexOf(r)]].mode,command:m.editBehavior[m.editableColumnsDataIndex[m.editableColumnsAttribute.indexOf(r)]].command};if(w&&q.kind!=="boolean"){q.kind="enum";q.range=v.range.slice();q.displayRange=v.rangeNLS.slice();if(v.value){q.current=v.value[0]}else{q.current=""}}y.editableColumns[m.editableColumnsDataIndex[m.editableColumnsAttribute.indexOf(r)]]=q}}y.editableColumns["ds6w:reserved"]={mode:m.editBehavior["ds6w:reserved"].mode,commands:m.editBehavior["ds6w:reserved"].commands,readOnly:false};m.editOptions=y;t.options.edit=y;return y},hookCellReadonly:function(){var q=this.getManager();q._modelEvents.subscribe({event:"cell:read-only"},function(r){var s=r.nodeModel;if(s&&s._updateFromEdit===true){delete s._updateFromEdit;delete s._editDataIndex}})},cancelModification:function(t,s){var q=this.getManager().getDocument();var r=this.getManager().getActiveNode();q.withTransactionUpdate(function(){var u={label:r.options.oldLabel?r.options.oldLabel:r.options.label,grid:{}};u.grid[r._editDataIndex]=r.previousValue?r.previousValue:"";r.updateOptions(u);delete r._updateFromEdit;delete r._editDataIndex})}};var e=function(q){console.warn("need to do the reset node")};return l});define("DS/ENOPAD_v2/models/PADTreeDocumentRefresh",["UWA/Class","UWA/Class/Promise","DS/ENXNav/models/RefreshHandler","DS/ENOPAD_v2/models/_PADModelParser","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADProgressBar","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(a,k,j,c,i,d,q,b,h,p,g){var n=1;var f=-1;function m(r){if(r.options.isNotManagedByPS){return}if(!r.hasChildren()){r.setState({state:"collapsed"});r.childComputed=false}}function o(t){var s=t.getRoots();for(var u=0;u<s.length;u++){var r=s[u];m(r);r.processDescendants({processNode:function(v){m(this)}})}}var l=a.extend({});if(i.getSetting("refresh_v2")!==true){var e=function(t,u){var s=JSON.parse(JSON.stringify(u.results));var r=[];s.forEach(function(v){if(v.hasOwnProperty("attributes")){var w=false;v.attributes.forEach(function(x){if(x.name==="resourceid"||x.name==="physicalid"){if(t.indexOf(x.value)<0){var y=u.results.indexOf(v);u.results.splice(y,1);w=true}}if(x.name==="did"){if(w){if(r.indexOf(x.value)<0){r.push(x.value)}}}})}});s.forEach(function(v){if(v.hasOwnProperty("path")){v.path.forEach(function(x){if(r.indexOf(x)!==-1){var w=u.results.indexOf(v);u.results.splice(w,1)}})}});return u};l.prototype.refresh=function(v){var x=this;var z=[];var w=function(F){h.off();if(typeof F!=="array"||F.length===0){F=[{msg:p.refresh_ok}]}for(var E=0;E<F.length;E++){var D=F[E];if(v.cb===undefined){b.displayNotification(D)}else{v.cb(D)}}x.getModelEvents().publish({event:"titleRecalc"})};var u=p.refresh_ongoing;v=v||{};this._clearSortOrders(v);var A=v.roots||this.getRoots();if(A.length>0){if(v.dispatch){this._commandProxy.refreshModel()}h.on(u);var y=[];var s={results:[],full_path:true};var C=[];var B=[];if(A!==null&&A!==undefined){A.forEach(function(E){if(E.options.filtered===true){B.push(E)}else{var G=[];var D=[E];while(D.length){var F=D.pop();if(F!==undefined&&F!==null){G.push(F.getOccurencePath());var H=F.getOccurencePath();H.forEach(function(I){if(C.indexOf(I)<0){C.push(I)}});D=D.concat(F.getChildren())}}y.push(G)}})}if(y.length===0&&B.length===0){w()}else{var r=[];if(y.length>0){var t=new k(function(F,E){var G={session:y,intent:"explore_2D",debug:i.getSetting("enopad_webapis_debug"),type_filter_bo:i.getSetting("type_filter_bo")};var D;q.refresh({data:G,onComplete:function(K){try{var H=UWA.is(K,"string")?JSON.parse(K):K;if(H!==undefined){D=x.startTransaction("refresh");if(i.getSetting("supportPgpBasedOnDescription")===true){var I=new j({app_context:i.app_context,treeDocument:x});I.complete(true)}var M=d.determineAuthoredFlag();var J=false;if(M){J=true}c.process.expand({treedocument:x,root_nodes:A,starting_from_root:H.full_path,response:H,mode:"refresh",needNewStructure:J,expand_level:M?n:f,security_counts_HTML:null});if(M){o(x)}x.sortInTreeOrder(A);x.invalidateViewPort();if(D){D.end()}}F()}catch(L){var N="Exception thrown during the process of the refresh answer "+L.toString();z.push({msg:N,eventID:"error"});F()}},onFailure:function(H){z.push({msg:g.generic_service_failure,eventID:"error"});F()}})});r.push(t)}if(B.length>0){r.push(x.doRefreshCV(B,false))}k.all(r).then(function(){w(z)})}this.withTransactionUpdate(function(){var D=UWA.clone(A,false);while(D.length){var E=D.pop();if(E!==undefined&&E!==null){if(E.options.isPADHiddenFromServer===true){delete E.options.isPADHiddenFromServer}if(E.isSelected()){E.unselect()}D=D.concat(E.getChildren())}}})}}}return l});define("DS/ENOPAD_v2/models/PADTreeDocument",["UWA/Core","DS/ENXNav/models/xNavDocument","DS/ENXNav/models/xNavNodeModel","DS/ENOPAD_v2/models/PADTreeDocumentRefresh","DS/PADUtils/XNavSettings","DS/ENOPAD_v2/models/_PADModelParser","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/PADUtils/views/PADAlert","DS/PADUtils/utilsWS/WSUtils","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(i,g,l,n,j,d,k,e,o,f,b,h,a,c){var m=g.extend(n,{_active_cutting_nodes:[],init:function(q){var p=k.getSetting("activateEditInTable");if(p===true&&!i.is(q.shouldBeEditable)){q.shouldBeEditable=function(s){return true}}this._parent(q);var r=this;if(p===true){require(["DS/ENOPAD_v2/mixins/_PADEditInLst"],function(s){r.onNodeModelUpdate(s.onNodeModelUpdate.bind(r))})}if(this._commandProxy){this._commandProxy.addProxyEvents({onRefresh:function(t){if(i.is(t.authored.created,"array")||i.is(t.authored.modified,"array")){r.refreshNodeById({created:t.authored.created,modified:t.authored.modified})}if(i.is(t.authored.deleted,"array")){var s=[];t.authored.deleted.forEach(function(u){s=s.concat(r.getNodesById(u))});r.deleteNodes(s,true)}}})}},setDnDBehavior:function(p){this._copyMode=p},setConfirmdDialog:function(p){this._confirmDialog=p},setCuttingNodes:function(p){this._active_cutting_nodes=p},instantiate:function(K,J,s){var x=K.instanceName?K.instanceName:"";var p=s?s.newRelationIDs:[];var r=s?s.tgtParentIds:[];var I=s?s.removedNodeIds:[];var H={};var F=J?J:[];var G=K.node;var y=K.parent;var B=K.behavior;var t=K.newRelationID;var L=K.ordering;var z=y.getID();var M=i.clone(G.options,false);var q=i.clone(G.options.grid,false);M.grid=q;var E=G.getRelationID();var w=G.options.relationtype;var A=!Boolean(E);var v=this.getRoots();var u=false;var D=L?true:false;if((D||!A)&&B!=="COPY"){v.forEach(function(O){var N=[];if(!F||F.length===0){N=O.getNodesByRelId(E)}else{if(F.indexOf(O.getID())!==-1){N=O.getNodesByRelId(E)}else{if(r.length>0){if(r.indexOf(O.getID())===-1){if(p.length>0){if(p.indexOf(E)===-1){N=O.getNodesByRelId(E)}}else{N=O.getNodesByRelId(E)}}}else{N=O.getNodesByRelId(E)}}}if(N.length>0){N.forEach(function(Q){var R=Q.getParent();if(!Q.isRoot()){if(!F||F.length===0){R.removeChild(Q)}else{var P=F.indexOf(R.getID());if(P!==-1){R.removeChild(Q)}}}})}});G.setRelationID(t,w)}var C=function(Q,T,N){if(T&&T.before&&T.before!==""){var P=Q.getChildren();var O;for(O=0;O<P.length;O++){var S=P[O];if(S.options.relationid===T.before){try{Q.insertBefore(N,S);u=true}catch(R){console.log(R);throw R}break}}}if(!i.is(Q.options.relcount,"number")){Q.options.relcount=0}Q.options.relcount=Q.options.relcount+1;if(!u){Q.addChild(N)}};v.forEach(function(O){if(A){if(I.length>0){if(I.indexOf(O.getID())!==-1){H[O.getID()]=true}}}var N=O.getNodesById(z);if(!N||N.length===0){return}N.forEach(function(S){if(S===y||S.isExpanded()||S.options.children===null||S.options.children.length===0){if(!A&&B!=="COPY"&&S===y){if(r&&r.length>1){var R=i.clone(M,false);var Q=new l(R);var U=G.options.relationtype;Q.setRelationID(t,U);C(S,L,Q)}else{C(S,L,G)}}else{var V=i.clone(G.options,false);var W=i.clone(G.options.grid,false);if((i.is(V.relcount,"number")&&V.relcount>0)||(i.is(V.children,"array")&&V.children.length>0)){V.children=[]}if(F&&F.indexOf(S.getID())===-1){W.CurrentEvolutionEffectivity="";W.Effectivity="";W.ProjectedEvolutionEffectivity="";W.VariantEffectivity=""}if(x){W.instanceName=x}V.grid=i.clone(W,false);var T=new l(V);var P=V.relationtype;if(A||B==="COPY"||(r&&r.length>1)){T.setRelationID(t,P)}C(S,L,T)}if(!S.isExpanded()){if(!S.options.padstate||S.options.padstate!=="partiallyExpanded"){S.setState({state:"partiallyExpanded"});S.options.padstate="partiallyExpanded"}}}else{console.log("**3 =========",S)}})});if(!y.isExpanded()){if(!y.options.padstate||y.options.padstate!=="partiallyExpanded"){y.setState({state:"partiallyExpanded"});y.options.padstate="partiallyExpanded"}}e.setAuthoringState(true,c.PADSession_disabling_index_authoring);if(A&&B!=="COPY"){if(I.length===0){this.removeRoot(G)}else{if(H[G.getID()]){this.removeRoot(G)}}}this.invalidateViewPort()},_distinguishInsertReparentCases:function(q){var r=this;var p={insertExisting:[],reparent:[]};var s=this._copyMode;q.forEach(function(u){var v=u.getRelationID();var t=(v?false:true);if(t||s==="COPY"){p.insertExisting.push(u)}else{p.reparent.push(u)}});return p},_inputData:function(p,r){var q=[];p.forEach(function(t){q.push(t.getOccurencePath())});var s={children:q,parents:[r.getOccurencePath()],commit:true};return s},_onInsert:function(r,y,u){var q=this._copyMode;var A=null;if(typeof y.getID==="function"){A=y.getID()}var v=this;function t(B,E){var C;for(C=0;C<B.length;C++){var D=B[C];if(D.options.resourceid===E){return D}}return null}function s(B){var F;for(F=0;F<B.length;F++){var I=B[F].relationid;var K=B[F].resourceid;var C=t(r,K);if(!C){w();return}var E={node:C,parent:y,next:u,behavior:q,newRelationID:I};var H=C.getID();var J=y.getID();var D=C.getRelationID();var G=!Boolean(D);v._endBlockingTransaction();v.wrapInTransaction(function(){v.withTransactionUpdate(function(){v.instantiate(E);var L={transactions:[]};if(G||q==="COPY"){L.transactions.push({insertExisting:{modified:[J],inserted:[H],created:[I],withContext:!G}})}else{L.transactions.push({reParent:{modified:[J],inserted:[H],created:[I],deleted:[D]}})}v._commandProxy.padRefresh(L)},v)})}b.displayNotification({msg:a.insert_existing_succeeded,eventID:"info"})}function w(B){v._endBlockingTransaction();if(B&&i.is(B.messages,"array")){B.messages.forEach(function(C){b.displayNotification({msg:C,eventID:"error"})})}if(v.dropInvitContainer){v.dropInvitContainer.hide()}}function x(B){var F;for(F=0;F<B.length;F++){var J=B[F].relationid;var L=B[F].resourceid;var C=t(r,L);if(!C){p();return}try{var E={node:C,parent:y,next:u,behavior:q,newRelationID:J};var I=C.getID();var K=y.getID();var D=C.getRelationID();var G=!Boolean(D);v._endBlockingTransaction();v.wrapInTransaction(function(){v.withTransactionUpdate(function(){v.instantiate(E);var M={transactions:[]};if(G){M.transactions.push({insertExisting:{modified:[K],inserted:[I],created:[J],withContext:!G}})}else{M.transactions.push({reParent:{modified:[K],inserted:[I],created:[J],deleted:[D]}})}v._commandProxy.padRefresh(M)},v);b.displayNotification({msg:a.reparent_succeeded,eventID:"info"})})}catch(H){v._endBlockingTransaction();b.displayNotification({msg:c.generic_service_failure,eventID:"error"})}}}function p(B){v._endBlockingTransaction();if(B&&i.is(B.messages,"array")){B.messages.forEach(function(C){b.displayNotification({msg:C,eventID:"error"})})}}var z=v._distinguishInsertReparentCases(r);if(z.insertExisting.length>0){this._beginBlockingTransaction(a.inserting_nodes);require(["DS/ApplicationFrame/CommandsManager"],function(B){var C=B.getCommand("InsertExisting");C.execute({mode:"CopyPaste",internal_call:true,data:v._inputData(r,y),onSuccess:s,onFailure:w})})}if(z.reparent.length>0){this._beginBlockingTransaction(a.reparenting);require(["DS/ApplicationFrame/CommandsManager"],function(B){var C=B.getCommand("InsertExisting");C.execute({mode:"CutPaste",internal_call:true,data:v._inputData(r,y),onSuccess:x,onFailure:p})})}return false},getOrdering:function(w){var s={};if(!w){return ordering}var u=-1,q=-1,v=-1;var r,p,t;w.forEach(function(x){var y={};r=x.getParent().getChildren();if(r&&r.length>1){u=r.indexOf(x);if(u>-1){q=u-1;v=u+1}t=r[q];p=r[v];y.after=t?t.getRelationID():"";y.before=p?p.getRelationID():"";s[x.getRelationID()]=y}});return s},insertNodes:function(B,A){var w=this;var q=[];function u(C){if(q.indexOf(C.resourceid)===-1){q.push(C.resourceid)}if(q.indexOf(C.relationid)===-1){q.push(C.relationid)}}function t(){b.displayNotification({msg:c.generic_service_failure,eventID:"error"});w._endBlockingTransaction()}var y={transactions:[]};var s=[];var v=[],z=[],p=[];function r(){if(s.length){var C=[];s.forEach(function(E){var D=w.getNodesByRelId(E);if(D){C.push(D[0].getOccurencePath())}});y.transactions[0].insertExisting.inserted=C}}function x(F){var K=Object.keys(B);for(var J=0;J<K.length;J++){var G=K[J];if(i.is(B[G],"array")){var E={insertExisting:{modified:[],inserted:[],created:[]}};var M=B[G];for(var I=0,H=M.length;I<H;I++){var L=M[I];var D=[G,L.relationid,L.resourceid];if(v.indexOf(D)===-1){v.push(D);E.insertExisting.modified.push(G);E.insertExisting.inserted.push(L.resourceid);s.push(L.relationid);E.insertExisting.created.push(L.relationid);E.insertExisting.withContext=false}}if(z.indexOf(G)===-1){z.push(G);var C=w.getNodesById(G);if(C){p=p.concat(C)}}y.transactions.push(E)}}}this.wrapInTransaction(function(){var F;if(i.is(B.created,"array")||i.is(B.inserted,"array")){w.withTransactionUpdate(function(){if(B.created){var M=[];for(var N=0;N<B.created.length;N++){var O=d.parse_attributes(B.created[N].attributes,j.getAvailableColumns());if(O.children===undefined){O.children=null}if(i.is(O.relcount,"number")&&O.relcount>0){O.children=[]}var G=new l(O);w.addRoot(G);G.select();M.push(G.getID());var J=w.getRoots().length;if(i.is(w.detachedRoots,"array")){J=J+w.detachedRoots.length}w.getModelEvents().publish({event:"onRootAdded",data:{nb_root:J,added_node:G}});f.updateNLS(G)}var K={pids:M,already_added_in_PS:true};w._commandProxy.drop(K)}if(B.inserted){for(var I=0;I<B.inserted.length;I++){var L=[];var H={insertExisting:{modified:[],inserted:[],created:[]}};w.getRoots().forEach(function(P){L=L.concat(P.getNodesById(B.inserted[I].parent_id))});B.inserted[I].children.forEach(function(P){L.forEach(function(S){var Q=d.parse_attributes(P.attributes,j.getAvailableColumns());Q.relationid=P.relationid;if(Q.children===undefined){Q.children=null}if(i.is(Q.relcount,"number")&&(Q.relcount>0)){Q.children=[]}var R=new l(Q);S.addChild(R);S.setState({state:"partiallyExpanded"});S.options.padstate="partiallyExpanded";H.insertExisting.modified.push(S.getID());H.insertExisting.inserted.push(R.getOccurencePath());s.push(R.getRelationID());H.insertExisting.created.push(R.getRelationID());H.insertExisting.withContext=false;f.updateNLS(R)})});y.transactions.push(H)}w._commandProxy.padRefresh(y)}})}else{if(k.getSetting("useLWCWebServices")===true){w.unselectAll();x();F=B.noNotification;delete B.noNotification;w._beginBlockingTransaction(a.inserting_nodes);var E=i.extend({root_path_physicalid:v,expand_iter:"0",intent:"explore_2D"},k.getWebAPI_Options("navigate"),true);o.navigate({enopad_webapis:k.getSetting("enopad_webapis"),data:E,onComplete:function(I){var G;try{var H=i.is(I,"string")?JSON.parse(I):I;if(H.results){if(H.results.length>0&&!H.error){G=w.startTransaction("expand");d.process.expand({treedocument:w,response:H,root_nodes:p,expand_level:1,mode:"insert"});if(F!==true){b.displayNotification({msg:a.insert_existing_succeeded,eventID:"info"})}w._endBlockingTransaction();if(A){A()}r();w._commandProxy.padRefresh(y)}else{t()}}else{t()}}catch(J){t()}finally{if(G){G.end()}}},onFailure:function(G){t()}})}else{for(var D in B){if(B.hasOwnProperty(D)){if(i.is(B[D],"array")){B[D].forEach(u)}}}F=B.noNotification;delete B.noNotification;w._beginBlockingTransaction(a.inserting_nodes);var C={intent:"explore_2D",debug:k.getSetting("enopad_webapis_debug")};o.fetch({enopad_webapis:k.getSetting("enopad_webapis"),data:C,pids:q,onComplete:function(H){w.invalidateViewPort();var G=i.is(H,"string")?JSON.parse(H):H;if(G.results.length===0){throw new Error("Cannot find object with the physicalid "+q)}if(G.results.length!==q.length){throw new Error("More results than input objects")}w.wrapInTransaction(function(){var I=d.process.insert_nodes({treedocument:w,response:G,insert_parameters:B});w._commandProxy.padRefresh(I)},"insert_nodes");w._endBlockingTransaction();if(A){A()}if(F!==true){b.displayNotification({msg:a.insert_existing_succeeded,eventID:"info"})}},onFailure:function(G){b.displayNotification({msg:c.generic_service_failure,eventID:"error"});w._endBlockingTransaction()},})}}})},getFetches:function(p){var q=this;var r=i.clone(p,false);r.cbOnProcess=function(u,t){var s={intent:"explore_2D",debug:k.getSetting("enopad_webapis_debug")};var v={enopad_webapis:k.getSetting("enopad_webapis"),data:s,pids:t,onComplete:function(A){var x=(typeof A==="string")?JSON.parse(A):A;if(x.results){for(var y=0,w=x.results.length;y<w;y++){var z=x.results[y];u.setAnswer(t[y],z)}}else{console.log("handle error in the future")}},onFailure:function(w,x){console.log("getFetches.onFailure");u.reprocess()}};return o.fetch(v)};return new h.MassChunkedRequests(r)},getNavigates:function(p){var q=this;var r=i.clone(p,false);r.cbOnProcess=function(u,s){if(s&&s.length>0){var t=i.extend({root_path_physicalid:s,expand_iter:"0",intent:"explore_2D"},k.getWebAPI_Options("navigate"),true);var v={enopad_webapis:k.getSetting("enopad_webapis"),data:t,onComplete:function(x){var w=(typeof x==="string")?JSON.parse(x):x;if(w.results){u.setAnswers(s,w.results)}else{console.log("handle error in the future")}},onFailure:function(w,x){console.error("getNavigates.onFailure networkError",w);console.error("getNavigates.onFailure serverError ",x);u.reprocess()}};return o.navigate(v)}};return new h.MassChunkedRequestsLWC(r)},insertNodesSplitFetch:function(F,E){var t=F.toDelete,E=F.callack,v=F.callback2,F=F.toInsert;var y=this;var A=[];var r=y.getSelectedNodes();function w(){function G(I){if(!I.hasChildren()){return I.getDepth()}var J=1;var H=I.getChildren();H.forEach(function(L){var K=G(L);if(K>J){J=K}});return J}r.forEach(function(H){if(H){var I=G(H);var J=H.getDepth();var K=I-J;A.push(parseInt(K))}})}var q=[];function u(G){if(q.indexOf(G.resourceid)===-1){q.push(G.resourceid)}if(q.indexOf(G.relationid)===-1){q.push(G.relationid)}}var z=[];var C={transactions:[]};var x=[],D=[],p=[];function B(){var N=Object.keys(F);for(var M=0;M<N.length;M++){var J=N[M];if(i.is(F[J],"array")){var I={insertExisting:{modified:[],inserted:[],created:[]}};var O=F[J];for(var L=0,K=O.length;L<K;L++){var P=O[L];var H=[J,P.relationid,P.resourceid];if(x.indexOf(H)===-1){z.push(P.resourceid);x.push(H);I.insertExisting.modified.push(J);I.insertExisting.inserted.push(P.resourceid);I.insertExisting.created.push(P.relationid);I.insertExisting.withContext=false}}if(D.indexOf(J)===-1){D.push(J);var G=y.getNodesById(J);if(G){p=p.concat(G)}}C.transactions.push(I)}}}function s(){b.displayNotification({msg:c.generic_service_failure,eventID:"error"});y._endBlockingTransaction()}this.wrapInTransaction(function(){var I,J,G;if(k.getSetting("useLWCWebServices")===true){w();B();J=F.noNotification;delete F.noNotification;y._beginBlockingTransaction(a.inserting_nodes);G={chunkSize:1000,requests:x,cbOnComplete:function(M){var K;try{var N=M.getAnswers();var L=i.is(N,"string")?JSON.parse(N):N;if(L.results){if(L.results.length>0&&!L.error){K=y.startTransaction("expand");d.process.expand({treedocument:y,response:L,root_nodes:p,expand_level:1,mode:"insert"});if(J!==true){b.displayNotification({msg:a.insert_existing_succeeded,eventID:"info"})}y._endBlockingTransaction();y._commandProxy.padRefresh(C);if(E){E()}if(v){v({expandNodeIds:z,expandLevels:A})}}else{s()}}else{s()}}catch(O){s()}finally{if(K){K.end()}}},cbOnProgress:function(M,K,L){}};I=y.getNavigates(G)}else{for(var H in F){if(F.hasOwnProperty(H)){if(i.is(F[H],"array")){F[H].forEach(u)}}}J=F.noNotification;delete F.noNotification;y._beginBlockingTransaction(a.inserting_nodes);G={chunkSize:30,requests:q,cbOnComplete:function(N){var K=q.length;var O=N.getAnswers();var L=i.is(O,"string")?JSON.parse(O):O;var M=L.results.length;if(M===0){throw new Error("Cannot find object with the physicalid "+q)}if(M!==M){throw new Error("More results than input objects")}y.invalidateViewPort();y.wrapInTransaction(function(){var P=d.process.insert_nodes({treedocument:y,response:L,insert_parameters:F});y._commandProxy.padRefresh(P)},"insert_nodes");y._endBlockingTransaction();if(E){E()}if(J!==true){b.displayNotification({msg:a.insert_existing_succeeded,eventID:"info"})}},cbOnProgress:function(M,K,L){}};I=y.getFetches(G)}})},_clearSortOrders:function(q){if(!q||!q.treelist){return}var p=q.treelist.getManager();p.getColumns().forEach(function(r){var s=p.getColumnIDFromDataIndex(r.dataIndex);if(p.getColumnOrderState(s)!=="none"){p.setColumnOrderState(s,"none")}})},sortInTreeOrder:function(p){if(!p){return}p.forEach(function(q){q.sortChildren({isRecursive:true,sortFunction:function(s,r){if(s.options&&r.options){if(s.options.relationOrder<r.options.relationOrder){return -1}else{if(s.options.relationOrder>r.options.relationOrder){return 1}}}return 0}})})},_compositeOrder:function(t,w,q){var y=null;if(typeof w.getID()==="function"){y=w.getID()}else{y=w.options.resourceid}var u=t.getRelationID();var z=u?false:true;var p=this._copyMode;var v=this;function s(F){try{if(i.is(F)&&i.is(F,"array")&&F.length>0){F=F[0].relationid}var E={node:t,parent:w,behavior:p,newRelationID:F,ordering:q};var B=t.getID();var D=w.getID();var G=t.getRelationID();var C=!Boolean(G);v._endBlockingTransaction();v.wrapInTransaction(function(){v.withTransactionUpdate(function(){v.instantiate(E);var H={transactions:[]};if(C||p==="COPY"){H.transactions.push({insertExisting:{modified:[D],inserted:[B],created:[F],withContext:!C}})}else{H.transactions.push({reParent:{modified:[D],inserted:[B],created:[F],deleted:[G]}})}v._commandProxy.padRefresh(H)},v)})}catch(A){v._endBlockingTransaction();b.displayNotification({msg:c.generic_service_failure,eventID:"error"})}}function r(A){v._endBlockingTransaction();if(A&&i.is(A.messages,"array")){A.messages.forEach(function(B){b.displayNotification({msg:B,eventID:"error"})})}}var x;if(z||p==="COPY"){x={children:[t.getOccurencePath()],parents:[w.getOccurencePath()],ordering:q,commit:true};this._beginBlockingTransaction(a.inserting_nodes);require(["DS/ApplicationFrame/CommandsManager"],function(A){var B=A.getCommand("InsertExisting");B.execute({mode:"CopyPaste",internal_call:true,data:x,onSuccess:s,onFailure:r})})}else{x={children:[t.getOccurencePath()],parents:[w.getOccurencePath()],ordering:q,commit:true};this._beginBlockingTransaction(a.reparenting);require(["DS/ApplicationFrame/CommandsManager"],function(A){var B=A.getCommand("InsertExisting");B.execute({mode:"CutPaste",internal_call:true,data:x,onSuccess:s,onFailure:r})})}},_beginBlockingTransaction:function(p){this.getModelEvents().publish({event:"beginBlockingTransaction",data:p,context:this})},_endBlockingTransaction:function(){this.getModelEvents().publish({event:"endBlockingTransaction",context:this})},_triggerTitleUpdate:function(){var p=this.getRoots();this.getModelEvents().publish({event:"onRootAdded",data:{nb_root:p.length,added_node:p[p.length-1]}})}});return m});