define("DS/VCXWebDigger/VCXVisibilityDigger",["DS/VCXWebDressup/VCXVisibilityDressup"],function(b){var a=b.extend({init:function(){},GetType:function(){return"VCXVisibilityDigger"},SetVisibility:function(d){this._parent(d);var e=this.QueryInterface("W3AISGNodeHolder");if(e){var c=e.getSGNode();if(c){if(this.GetVisibility()){if(c.GetOpacity()!==0){c.addViewer()}c._divDigger.style.display=""}else{c.removeViewer();c._divDigger.style.display="none"}c.updateAnchorAttach(true,this.GetVisibility())}}},});return a});define("DS/VCXWebDigger/VCXDiggerUI",["DS/Core/Core","UWA/Class"],function(b,a){var c=a.extend({init:function(d){this.diggerComponent=null},dispose:function(){},drawImage:function(f,e,j,i,g){f.save();f.beginPath();var h=i.getPixelWidth()/2;f.arc(e,j,h,0,2*Math.PI,false);f.clip();var d=i.toCanvas();f.globalAlpha=g;f.drawImage(d,e-h,j-h,2*h,2*h);f.globalAlpha=1;f.restore()},drawBorder:function(f,e,h,d,g){f.beginPath();f.arc(e,h,d,0,2*Math.PI,false);f.fillStyle=this.diggerComponent.borderColor.GetStyle();f.globalAlpha=g*this.diggerComponent.borderColor.a;f.fill();f.lineWidth=this.diggerComponent.borderLineOuter;f.strokeStyle="black";f.globalAlpha=g*this.diggerComponent.borderLineOuterColor.a;f.stroke();f.globalAlpha=1},drawInnerBorder:function(e,d,h,g,f){e.beginPath();e.arc(d,h,g+1,0,2*Math.PI,false);e.lineWidth=this.diggerComponent.borderLineInner;e.strokeStyle="black";e.globalAlpha=f*this.diggerComponent.borderLineInnerColor.a;e.stroke();e.globalAlpha=1},drawAttach:function(d,e,g,f){d.lineWidth=1;d.beginPath();d.moveTo(e.x,e.y);d.lineTo(g.p1.x,g.p1.y);d.lineTo(g.p2.x,g.p2.y);d.lineTo(e.x,e.y);d.fillStyle="white";d.globalAlpha=f;d.fill();d.strokeStyle="black";d.globalAlpha=f*this.diggerComponent.borderLineOuterColor.a;d.stroke();d.globalAlpha=1},});return c});define("DS/VCXWebDigger/VCXComponentDigger",["DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebProperties/VCXColor"],function(c,b){var a=c.extend({init:function(){this._parent();this.IsAnchorDependent=true;this.IsDressupPropertiesChangeIndependent=true;this.IsViewPointDependent=true;this._tooltip="";this._dirtyPickability=false;this._DiggerDirtyMask=0;this.borderThickness=8;this.borderLineOuter=1;this.borderLineInner=1;this.borderColor=new b().FromRGBA(1,1,1,0.5);this.borderLineOuterColor=new b().FromRGBA(0,0,0,0.6);this.borderLineInnerColor=new b().FromRGBA(0,0,0,0.3)},isDirty:function(){return this._dirty||this._dirtyPickability}});a.EMode={Zoom:0,Onion:1,XRay:2,Detail:3};a.FDirty={Position:1<<0,Radius:1<<1,AnchorPosition:1<<2,ViewpointMoved:1<<3,Buttons:1<<4};Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentDigger"}});a.prototype._dressupFamily="Diggers";return a});"use strict";var VCXWebDiggerDictionary=function(){var a={VCXComponentDigger:{VCXIModifiable:"DS/VCXWebDigger/VCXDiggerModifiable",VCXIVisibility:"DS/VCXWebDigger/VCXVisibilityDigger",W3AISGNodeHolder:"DS/VCXWebDigger/VCXDiggerSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDigger",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIManipulable:"DS/VCXWebDressup/VCXManipulableDressup"},};var e={};var b={VCXComponentDigger:"DS/VCXWebDigger/VCXComponentDigger"};var d=["DS/WebExtensionServers/WebExtensionServer"];Object.keys(a).forEach(function(f){Object.keys(a[f]).forEach(function(g){d.push(a[f][g])})});Object.keys(e).forEach(function(f){d.push(e[f])});Object.keys(b).forEach(function(f){d.push(b[f])});var c=["VCXWebDigger/VCXWebDigger"];define("DS/VCXWebDigger/VCXWebDiggerDictionary",d,function(){var f=arguments;var h=f[0];var g={fillServer:function(){var k=new h();var i=0;var j=this;Object.keys(a).forEach(function(l){Object.keys(a[l]).forEach(function(n){i++;var m=f[i];if(!m){console.error("Error Loading "+n+" on component "+l)}var o=d[i];m.GetOrigin=function(){return o};k.AddExtension(l,n,m)})});Object.keys(e).forEach(function(m){i++;var l=f[i];k.AddInterface(m,l)});Object.keys(b).forEach(function(n){i++;var l=f[i];if(!l){console.error("Error Loading "+n)}var m=d[i];l.GetOrigin=function(){return m};k.AddComponent(n,l)});return k},getNLSModules:function(){return c}};return g})};VCXWebDiggerDictionary();define("DS/VCXWebDigger/VCXDiggerModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDigger/VCXComponentDigger","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValuePoint2D","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebVisualization/VCXAnchorHandle",],function(g,c,j,k,f,m,l,b,e,o,a,i,n,d){var h=g.extend({init:function(){this._parent()},Build:function(){this._parent();var p=45;var q=[{Name:"Digger.Position",Type:e,DefaultValue:new j.Vector2(297-p/2,0+p/2),NLSPath:"VCXWebDigger/VCXWebDigger"},{Name:"Digger.Radius",Type:o,DefaultValue:p,NLSPath:"VCXWebDigger/VCXWebDigger",Bounds:{Min:10,Step:1}},{Name:"Digger.Mode",Type:a,DefaultValue:c.EMode.Zoom,NLSPath:"VCXWebDigger/VCXWebDigger"},{Name:"Digger.ZoomFactor",Type:o,DefaultValue:0.5,NLSPath:"VCXWebDigger/VCXWebDigger",Bounds:{Min:0,Max:1,Step:0.01}},{Name:"Digger.DepthFactor",Type:o,DefaultValue:0,NLSPath:"VCXWebDigger/VCXWebDigger",Bounds:{Min:0,Max:1,Step:0.01}},{Name:"Digger.DepthZoom",Type:o,DefaultValue:0,NLSPath:"VCXWebDigger/VCXWebDigger",Bounds:{Min:0,Max:1,Step:0.01}},{Name:"Digger.TorchFilter",Type:b,DefaultValue:true,NLSPath:"VCXWebDigger/VCXWebDigger"},{Name:"Digger.Attach",Type:b,DefaultValue:true,NLSPath:"VCXWebDigger/VCXWebDigger"},{Name:"Actor.Anchor.0",Type:m,DefaultValue:new m().SetValueFrame(new l().SetValueFromVector(new j.Vector3(0,0,0))).GetValue()},{Name:"Collab.ListAnchorsIDs",Type:i,DefaultValue:[0]},{Name:"Digger.AssociatedPanelID",Type:n,DefaultValue:""}];this._BuildPropertyValues(q);this.SetPropertyInvisible("Collab.ListAnchorsIDs",true)},GetProperty:function(t){var v=null;if(t==="Digger.Mode"){var y=0;var p=this._parent(t);if(p){var z=p.Clone();var s=z.GetPropertyValue();y=s.GetValue()}var w=new a();w.SetValue(y);var q=new f(t,1,true,"VCXWebDigger/VCXWebDigger");var r=this._generateMapChoiceFromEnumAndId(c.EMode,"Digger",["Detail"]);q.SetMapChoiceEnum(r);q.SetNlsPathGroup("VCXWebModifiables/VCXWebModifiables");v=new k(q,w)}else{v=this._parent(t)}if(t==="Actor.IsAlwaysOnTop"||t==="Actor.ToolTip"||t==="Actor.Freeze"||t==="Actor.Anchor.0"||t==="Actor.Hyperlink"){var p=this._parent(t);if(p){var x=p.GetPropertyInfo();if(x){x.SetVisible(false)}}}if(t==="Digger.ZoomFactor"||t==="Digger.DepthFactor"||t==="Digger.DepthZoom"||t==="Digger.TorchFilter"){var A=this._parent("Digger.Mode");var u=null;if(A){var z=A.Clone();var s=z.GetPropertyValue();u=s.GetValue()}var p=this._parent(t);if(p){var x=p.GetPropertyInfo();if(x){if(u===0){x.SetVisible((t==="Digger.ZoomFactor")?true:false)}else{x.SetVisible((t!=="Digger.ZoomFactor")?true:false)}}}}return v}});return h});define("DS/VCXWebDigger/VCXDiggerNode",["UWA/Element","DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/VCXWebVisualization/VCXVisuManager","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebKernelTools/VCXPixelImage","DS/VCXWebDressup/VCXPickerTools","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXCmdChangeDressup","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebDigger/VCXComponentDigger","DS/VCXWebDiggerKernel/VCXDiggerKernel","DS/VCXWebDigger/VCXDiggerUI","DS/VCXWebVisualization/VCXInteractor","DS/VCXWebVisualization/VCXPublishRasterImage","DS/WebappsUtils/WebappsUtils","DS/Visualization/WebGLV6Viewer","DS/Visualization/Viewpoint","DS/Core/PointerEvents","DS/VCXWebProperties/VCXPropertyValuePoint2D","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernel/VCXCmdChangeSelection","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/VCXWebVisibility/VCXIVisibility"],function(s,D,t,i,F,v,o,h,c,a,p,z,j,m,E,d,l,q,k,u,x,y,B,b,n,C,w,A,f,r,g){var e=h.extend({init:function(G){this._parent(G);this._viewerDigger=null;this.DiggerKernel=null;this.DiggerUI=null;this._previousVPTarget=new D.Vector3(0,0,0);this._previousVPOrientation=new D.Quaternion(0,0,0,0);this._attachDiv1=null;this._attachDiv2=null;this._angleZoom=-135;this._angleDepth=-135;this._viewer=null;this._displayUI=true;this._displayButtons=false;this._modeButtonAngle=-70;this._modeButtonDelta=-1800;this._modeButtonAngleBottom=90;this._buttonMasterUI=null;this._buttonDelete=null;this._buttonResize=null;this._buttonResizeGhost=null;this._buttonSlider=null;this._buttonSliderShadow=null;this._buttonModeDetail=null;this._buttonModeXRay=null;this._buttonModeOnionSkin=null;this._buttonModeZoom=null;this._buttonAttachDisplay=null;this._buttonLockViewpoint=null;this._buttonLockPlanes=null;this._buttonSnapshot2D=null;this._modeBackgroundColor="linear-gradient(rgb(216,233,248) 0, rgb(216,233,248) 35%, rgb(160,202,241) 100%)";this._modeBackgroundColorDefault="rgba(239,239,239,1)";this._isDragged=null;this._updatePickabilityTimer=null;this._anchorVect3=new D.Vector3(0,0,0);var H=this;this.onPropertiesChanged=function(I){if(!H.isVisible()){return}if(H.projectionTypeChanged()){H._viewerDigger.render()}};this._tokenPropertiesChanged=t.subscribe({event:"VCX_PROPERTIES_CHANGED"},this.onPropertiesChanged);this.onStartPauseStopPlayBeginEndTransition=function(J){if(!H.isVisible()){return}var I=H.Modifiable.GetObject();I._DiggerDirtyMask|=p.FDirty.Buttons;I.setDirty()};this._tokenStartPlay=t.subscribe({event:"VCX_START_PLAY"},this.onStartPauseStopPlayBeginEndTransition);this._tokenPausePlay=t.subscribe({event:"VCX_PAUSE_PLAY"},this.onStartPauseStopPlayBeginEndTransition);this._tokenStopPlay=t.subscribe({event:"VCX_STOP_PLAY"},this.onStartPauseStopPlayBeginEndTransition);this._tokenScenarioEndReached=t.subscribe({event:"VCX_SCENARIO_END_REACHED"},this.onStartPauseStopPlayBeginEndTransition);this._tokenBeginTransition=t.subscribe({event:"VCX_BEGIN_TRANSITION"},this.onStartPauseStopPlayBeginEndTransition);this._tokenEndTransition=t.subscribe({event:"VCX_END_TRANSITION"},this.onStartPauseStopPlayBeginEndTransition)},disposeViewer:function(){var G=this.DiggerKernel._viewer.currentViewpoint;if(G&&G.control){G.control._mouseWheel=null;G.control._zoom=null}this.DiggerKernel.removeOverrides();this.removeViewer();if(this._viewerDigger){this._viewerDigger.removeNode(this._viewer.getRootNode());var H=this.ExperienceBase.getManager("VCXDressupManager");if(H){var I=H.QueryInterface("W3AISGNodeHolder");if(I){this._viewerDigger.removeNode(I.getSGNode())}}this._viewerDigger.removeViewpoint(0);this._viewerDigger.dispose();this._viewerDigger=null}},dispose:function(){this.disposeViewer();if(this._tokenPropertiesChanged){t.unsubscribe(this._tokenPropertiesChanged);this._tokenPropertiesChanged=null}if(this._tokenStartPlay){t.unsubscribe(this._tokenStartPlay);this._tokenStartPlay=null}if(this._tokenPausePlay){t.unsubscribe(this._tokenPausePlay);this._tokenPausePlay=null}if(this._tokenStopPlay){t.unsubscribe(this._tokenStopPlay);this._tokenStopPlay=null}if(this._tokenScenarioEndReached){t.unsubscribe(this._tokenScenarioEndReached);this._tokenScenarioEndReached=null}if(this._tokenBeginTransition){t.unsubscribe(this._tokenBeginTransition);this._tokenBeginTransition=null}if(this._tokenEndTransition){t.unsubscribe(this._tokenEndTransition);this._tokenEndTransition=null}if(this.DiggerKernel){this.DiggerKernel.dispose();this.DiggerKernel=null}if(this.DiggerUI){this.DiggerUI.dispose();this.DiggerUI=null}if(this._buttonMasterUI){if(this._buttonMasterUI_POINTERDOWN){this._buttonMasterUI.removeEventListener(k.POINTERDOWN,this._buttonMasterUI_POINTERDOWN);this._buttonMasterUI_POINTERDOWN=null}if(this._buttonMasterUI_POINTERUP){this._buttonMasterUI.removeEventListener(k.POINTERUP,this._buttonMasterUI_POINTERUP);this._buttonMasterUI_POINTERUP=null}this._buttonMasterUI=null}if(this._buttonDelete){if(this._buttonDelete_POINTERUP){this._buttonDelete.removeEventListener(k.POINTERUP,this._buttonDelete_POINTERUP);this._buttonDelete_POINTERUP=null}if(this._buttonDelete_POINTERDOWN){this._buttonDelete.removeEventListener(k.POINTERDOWN,this._buttonDelete_POINTERDOWN);this._buttonDelete_POINTERDOWN=null}this._buttonDelete=null}if(this._buttonModeZoom){if(this._buttonModeZoom_POINTERUP){this._buttonModeZoom.removeEventListener(k.POINTERUP,this._buttonModeZoom_POINTERUP);this._buttonModeZoom_POINTERUP=null}this._buttonModeZoom=null}if(this._buttonModeOnionSkin){if(this._buttonModeOnionSkin_POINTERUP){this._buttonModeOnionSkin.removeEventListener(k.POINTERUP,this._buttonModeOnionSkin_POINTERUP);this._buttonModeOnionSkin_POINTERUP=null}this._buttonModeOnionSkin=null}if(this._buttonModeXRay){if(this._buttonModeXRay_POINTERUP){this._buttonModeXRay.removeEventListener(k.POINTERUP,this._buttonModeXRay_POINTERUP);this._buttonModeXRay_POINTERUP=null}this._buttonModeXRay=null}if(this._buttonModeDetail){if(this._buttonModeDetail_POINTERUP){this._buttonModeDetail.removeEventListener(k.POINTERUP,this._buttonModeDetail_POINTERUP);this._buttonModeDetail_POINTERUP=null}this._buttonModeDetail=null}if(this._buttonSnapshot2D){if(this._buttonSnapshot2D_POINTERUP){this._buttonSnapshot2D.removeEventListener(k.POINTERUP,this._buttonSnapshot2D_POINTERUP);this._buttonSnapshot2D_POINTERUP=null}this._buttonSnapshot2D=null}if(this._buttonLockPlanes){if(this._buttonLockPlanes_POINTERUP){this._buttonLockPlanes.removeEventListener(k.POINTERUP,this._buttonLockPlanes_POINTERUP);this._buttonLockPlanes_POINTERUP=null}this._buttonLockPlanes=null}if(this._buttonLockViewpoint){if(this._buttonLockViewpoint_POINTERUP){this._buttonLockViewpoint.removeEventListener(k.POINTERUP,this._buttonLockViewpoint_POINTERUP);this._buttonLockViewpoint_POINTERUP=null}this._buttonLockViewpoint=null}if(this._buttonAttachDisplay){if(this._buttonAttachDisplay_POINTERUP){this._buttonAttachDisplay.removeEventListener(k.POINTERUP,this._buttonAttachDisplay_POINTERUP);this._buttonAttachDisplay_POINTERUP=null}this._buttonAttachDisplay=null}this.removeDiv();if(this._buttonResize){if(this._buttonResize_POINTERDOWN){this._buttonResize.removeEventListener(k.POINTERDOWN,this._buttonResize_POINTERDOWN);this._buttonResize_POINTERDOWN=null}this._buttonResize=null}if(this._buttonSlider){if(this._buttonSlider_POINTERDOWN){this._buttonSlider.removeEventListener(k.POINTERDOWN,this._buttonSlider_POINTERDOWN);this._buttonSlider_POINTERDOWN=null}this._buttonSlider=null}if(this._buttonSliderShadow){this._buttonSliderShadow=null}if(this._buttonResizeGhost){this._buttonResizeGhost=null}document.removeEventListener(k.POINTERMOVE,this._fctWhile);document.removeEventListener(k.POINTERUP,this._fctEnd);this._fctWhile=null;this._fctEnd=null;this._viewer=null;this._parent()},getProp:function(I){var K=-1;var H=this.Modifiable;var L=H.GetProperty(I);if(L){var J=L.Clone();var G=J.GetPropertyValue();K=G.GetValue()}return K},setProp:function(J,I,G){var H=this.Modifiable;if(G===null){return}G.SetValue(J);H.OnChangeProperty(I,G);H.OnChangePropertiesEnd()},getRadius:function(){var G=this.getProp("Digger.Radius");return G},setRadius:function(G){this.setProp(G,"Digger.Radius",new y())},getRadiusInPixel:function(){var G=this.getRadius();var I=this.ExperienceBase.getManager("VCXPaperManager").GetMmToPxRatio();var H=G*I;return H},setRadiusInPixel:function(G){var H=this.ExperienceBase.getManager("VCXPaperManager").GetMmToPxRatio();this.setRadius(G/H)},getPosition:function(){var G=this.getProp("Digger.Position");return G},setPosition:function(G){this.setProp(G,"Digger.Position",new u())},getPositionInPixel:function(){var G=this.getPosition();var H=this.ExperienceBase.getManager("VCXPaperManager").MMToPixel2(null,G);return H},setPositionInPixel:function(G){var H=this.ExperienceBase.getManager("VCXPaperManager").PixelToMM2(null,G);this.setPosition(H)},getMode:function(){var G=this.getProp("Digger.Mode");return G},setMode:function(G){this.setProp(G,"Digger.Mode",new B())},getZoomFactor:function(){var G=this.getProp("Digger.ZoomFactor");return G},setZoomFactor:function(G){this.setProp(G,"Digger.ZoomFactor",new y())},getDepthFactor:function(){var G=this.getProp("Digger.DepthFactor");return G},setDepthFactor:function(G){this.setProp(G,"Digger.DepthFactor",new y())},getDepthZoom:function(){var G=this.getProp("Digger.DepthZoom");return G},setDepthZoom:function(G){this.setProp(G,"Digger.DepthZoom",new y())},getAttachDisplay:function(){var G=this.getProp("Digger.Attach");return G},setAttachDisplay:function(G){this.setProp(G,"Digger.Attach",new x())},isVisible:function(){if(this.Modifiable&&this.Modifiable.GetObject()){var G=this.Modifiable.GetObject().QueryInterface("VCXIVisibility");if(G&&G.GetVisibility()===g.EVisState.Hidden){return false}else{if((this.GetOpacity()===0)&&(this._diggerPreviousOpacity===0)){return false}}}return true},getTorchFilter:function(){var G=this.getProp("Digger.TorchFilter");return G},setTorchFilter:function(G){this.setProp(G,"Digger.TorchFilter",new x())},convert3DPointToPxl:function(I,H){var G=null;if(H){G=H.currentViewpoint.project(I)}return G},convert3DPointToCanvasPxl:function(L,K,H){var G=null;if(K){var I=K.currentViewpoint.camera;var G=L.clone();var J=new D.Projector();J.projectVector(G,I);G.x=0.5*H.width*(G.x+1);G.y=0.5*H.height*(1-G.y)}return G},getAnchorVector:function(){var H=Object.keys(this.Anchors)[0];var G=new D.Vector3().getPositionFromMatrix(this.Modifiable.GetAnchorWorldMatrix(H,null));return G},getPaperCenter3D:function(){var O=this.ExperienceBase.getManager("VCXPaperManager");var L=0;var H=0;var M=O.Size.x;var N=O.Size.y;var P=new D.Vector2(0,0);P.x=L+M*0.5;P.y=H+N*0.5;var Q=O.MMToPixel2(null,P);var J=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(J){var G=J.canvas.getBoundingClientRect();Q.x+=G.left;Q.y+=G.top}var K=new o(this.ExperienceBase);var I=K.pick2DonGround(this.ExperienceBase.getManager("VCXContextManager").getMainViewer(),Q.x,Q.y);return I},calcDiggerPositionToAnchorAngle:function(H,G,K){var J=K.x-G.x;var I=K.y-G.y;var L=Math.sqrt(J*J+I*I)-H;if(L<0){return -1}var M;if(J===0){M=270}else{M=-Math.atan(I/J)*(180/Math.PI)}if(J<0){M+=180}else{if(J>0&&I>0){M+=360}}return M},calcDiggerAnchorPoints:function(H,G,K){var O=this.calcDiggerPositionToAnchorAngle(H,G,K);if(O===-1){return null}var J=new D.Vector2();J.x=G.x+H*this.myCos(O*Math.PI/180);J.y=G.y-H*this.mySin(O*Math.PI/180);var N=new D.Vector2();var L=new D.Vector2();var M=this.Modifiable.GetObject().borderThickness*3/2;N.x=J.x+M*this.myCos((O+90)*Math.PI/180);N.y=J.y-M*this.mySin((O+90)*Math.PI/180);L.x=J.x+M*this.myCos((O-90)*Math.PI/180);L.y=J.y-M*this.mySin((O-90)*Math.PI/180);return{p1:N,p2:L}},drawTriangle:function(G,Q,P,S,K,I){var N=this.getRadiusInPixel();var T=P.x-Q.x;var R=P.y-Q.y;var H=Math.sqrt(T*T+R*R)-N-this.Modifiable.GetObject().borderThickness+I;if(H<0){G.style.display="none";return}else{G.style.display=""}G.style.width="0px";G.style.height="0px";G.style.position="absolute";G.style.display="block";G.style.borderRight=S+"px solid transparent";G.style.borderBottom=H+"px solid "+K;G.style.borderLeft=G.style.borderRight;var J=Math.atan(R/T)*(180/Math.PI);if(T>0&&R<0){J-=90}else{if(T>0&&R>0){J-=90}else{J+=90}}var O=-S+N;var M=H*-0.5+N;var L=-(H*0.5+N)-this.Modifiable.GetObject().borderThickness+I;G.style.transform="translate("+O+"px, "+M+"px) rotate("+J+"deg) translateY("+L+"px)"},updateDiggerAttach:function(H){if(this.getAttachDisplay()&&this._attachDiv1&&this._attachDiv2){if(H===undefined){H=this.getAnchorVector()}var G=this.convert3DPointToPxl(H,this._viewer);var I=this.getPositionInPixel();this.drawTriangle(this._attachDiv1,G,I,12,"rgb(250,250,250)",0);this.drawTriangle(this._attachDiv2,G,I,13,"rgb(60,60,60)",1);this.DiggerKernel._attachP=G}},updateDiggerUI:function(){if(this._divDigger){var H=this.getRadiusInPixel();var G=this.getPositionInPixel();this._divDigger.style.left=G.x-H+"px";this._divDigger.style.top=G.y-H+"px";this._divDigger.style.height=H*2+"px";this._divDigger.style.width=this._divDigger.style.height;this._divDiggerContent.style.height=(H-this.Modifiable.GetObject().borderThickness)*2+"px";this._divDiggerContent.style.width=this._divDiggerContent.style.height;this.updateButtons()}},myCos:function(G){var H=0;if(G<-3.14159265){G+=6.28318531}else{if(G>3.14159265){G-=6.28318531}}G+=1.57079632;if(G>3.14159265){G-=6.28318531}if(G<0){H=1.27323954*G+0.405284735*G*G;if(H<0){H=0.225*(H*-H-H)+H}else{H=0.225*(H*H-H)+H}}else{H=1.27323954*G-0.405284735*G*G;if(H<0){H=0.225*(H*-H-H)+H}else{H=0.225*(H*H-H)+H}}return H},mySin:function(G){var H=0;if(G<-3.14159265){G+=6.28318531}else{if(G>3.14159265){G-=6.28318531}}if(G<0){H=1.27323954*G+0.405284735*G*G;if(H<0){H=0.225*(H*-H-H)+H}else{H=0.225*(H*H-H)+H}}else{H=1.27323954*G-0.405284735*G*G;if(H<0){H=0.225*(H*-H-H)+H}else{H=0.225*(H*H-H)+H}}return H},updateButton:function(J,L,K,M){var H=this.getRadiusInPixel();var I=H-22/2-(H+K)*this.myCos(L);var G=H-22/2+(H+K)*this.mySin(L);J.style.left=I+"px";J.style.top=G+"px";if(this._displayButtons&&this._displayUI){J.style.display=""}else{J.style.display="none"}if(M){J.style.backgroundImage=J.saveBackground+", "+this._modeBackgroundColor;J.style.backgroundColor="";J.style.border="1px solid #368ec4"}else{J.style.backgroundImage=J.saveBackground;J.style.backgroundColor=this._modeBackgroundColorDefault;J.style.border="thin solid lightgrey"}},updateButtons:function(){var O;if(this._displayUI){O=""}else{O="none"}this._buttonMasterUI.style.display=O;if(this._buttonDelete){this._buttonDelete.style.display=O}this._buttonResize.style.display=O;this._buttonResizeGhost.style.display=O;this._buttonSlider.style.display=O;this._buttonSliderShadow.style.display=O;if(!this._displayUI){this._buttonModeDetail.style.display=O;this._buttonModeXRay.style.display=O;this._buttonModeOnionSkin.style.display=O;this._buttonModeZoom.style.display=O;this._buttonAttachDisplay.style.display=O;this._buttonLockViewpoint.style.display=O;this._buttonLockPlanes.style.display=O;if(this._buttonSnapshot2D){this._buttonSnapshot2D.style.display=O}}if(!this._displayUI){return}var N=this.getRadiusInPixel();var I=-30;var L="translate("+(-3+N)+"px,"+(N-60/2)+"px)";L+=" rotate("+I+"deg)";L+="translateX("+-(4.5+N)+"px";this._buttonResize.style.transform=L;var M;if(this.getMode()===p.EMode.Zoom){M=this.factor2angle(this.getZoomFactor())}else{M=this.factor2angle(this.getDepthFactor())}var I=M;var L="translate("+(-14/2+N-0.2)+"px,"+(N-20/2)+"px)";L+=" rotate("+I+"deg)";L+="translateY("+(30/2-this.Modifiable.GetObject().borderThickness+N+1.2)+"px";this._buttonSlider.style.transform=L;var I=M;var L="translate("+(-19/2+N)+"px,"+(N-21/2)+"px)";L+=" rotate("+I+"deg)";L+="translateY("+(30/2-this.Modifiable.GetObject().borderThickness+N+2)+"px";this._buttonSliderShadow.style.transform=L;var I=this._modeButtonAngle*Math.PI/180;var H=this._modeButtonDelta/N*Math.PI/180;var K=N-22/2-(N-2)*this.myCos(I);var J=N-22/2+(N-2)*this.mySin(I);this._buttonMasterUI.style.left=K+"px";this._buttonMasterUI.style.top=J+"px";I+=H;var K=N-22/2-(N-2)*this.myCos(I);var J=N-22/2+(N-2)*this.mySin(I);if(this._buttonDelete){this._buttonDelete.style.left=K+"px";this._buttonDelete.style.top=J+"px"}var I=this._modeButtonAngle*Math.PI/180;I-=H*0.4;H*=0.8;var G=20;this.updateButton(this._buttonModeDetail,I,G,this.getMode()===p.EMode.Detail);this._buttonModeDetail.style.display="none";I-=H;this.updateButton(this._buttonModeXRay,I,G,this.getMode()===p.EMode.XRay);I-=H;this.updateButton(this._buttonModeOnionSkin,I,G,this.getMode()===p.EMode.Onion);I-=H;this.updateButton(this._buttonModeZoom,I,G,this.getMode()===p.EMode.Zoom);var I=this._modeButtonAngleBottom*Math.PI/180;this.updateButton(this._buttonAttachDisplay,I,G,this.getAttachDisplay());I-=H;this.updateButton(this._buttonLockViewpoint,I,G,this.DiggerKernel.getLockViewpoint());I-=H;this.updateButton(this._buttonLockPlanes,I,G,this.DiggerKernel.getLockPlanes());if(this._buttonSnapshot2D){I-=H;this.updateButton(this._buttonSnapshot2D,I,G,false)}},onBuildSGNode:function(){this.DiggerKernel=new z();this.DiggerUI=new j();var M=this.Modifiable.GetObject();this.DiggerUI.diggerComponent=M;this._viewer=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();var H=this.getRadiusInPixel();var Y=this.getPositionInPixel();this.DiggerKernel._radiusPx=H;this.DiggerKernel._positionPx=Y;this.cssStylesBorderDigger={position:"absolute",textAlign:"left",top:Y.x-H+"px",left:Y.y-H+"px",height:H*2+"px",width:H*2+"px",border:"1px solid "+M.borderLineOuterColor.GetStyle(),backgroundColor:M.borderColor.GetStyle(),borderRadius:"50%",boxShadow:"0px 0px 0px 1px "+M.borderLineInnerColor.GetStyle(),};this.cssStylesContentDigger={position:"absolute",height:(H-this.Modifiable.GetObject().borderThickness)*2+"px",width:(H-this.Modifiable.GetObject().borderThickness)*2+"px",borderRadius:"50%",boxShadow:"0px 0px 0px 1px "+M.borderLineInnerColor.GetStyle(),margin:"auto",top:"0",left:"0",bottom:"0",right:"0"};this._divDigger=new UWA.Element("div",{id:"divDigger",styles:this.cssStylesBorderDigger});this._divDigger.setAttribute("data-rec-id",this.Modifiable.GetObject().GetID()+"_divDigger");this._divDiggerContent=new UWA.Element("div",{id:"divDiggerContent",styles:this.cssStylesContentDigger});this._divDiggerContent.setAttribute("data-rec-id",this.Modifiable.GetObject().GetID()+"_divDiggerContent");this._divDiggerContent.inject(this._divDigger);this._divDigger.inject(this._viewer.div);this._attachDiv2=document.createElement("div");this._divDigger.appendChild(this._attachDiv2);this._attachDiv1=document.createElement("div");this._divDigger.appendChild(this._attachDiv1);this._attachDiv1.style.pointerEvents="none";this._attachDiv2.style.pointerEvents="none";this._attachDiv1.style.opacity="0.9";this._attachDiv2.style.opacity="0.5";this.updateAnchorAttach(false);this._buttonResizeGhost=document.createElement("canvas");this._buttonResizeGhost.style.margin="-4px";this._buttonResizeGhost.style.width="408px";this._buttonResizeGhost.style.height="408px";this._buttonResizeGhost.style.borderRadius="inherit";this._buttonResizeGhost.style.transform="rotate(0deg)";var P=this._buttonResizeGhost.getContext("2d");P.canvas.width=408;P.canvas.height=408;P.save();P.shadowBlur=1;P.shadowColor="gray";P.fillStyle="rgba(200, 200, 200, 0.95)";P.clearRect(0,0,P.canvas.width,P.canvas.height);P.beginPath();var X=Math.PI/27;var U=3;P.arc(204+U,204,188,Math.PI-X,Math.PI+X);var J=204+U+this.myCos(Math.PI+X)*200;var I=204+this.mySin(Math.PI+X)*200;P.lineTo(J,I);var W=2*X/30;var V=Math.PI+X;for(var K=0;K<30;K++){V-=W;J=204+U+this.myCos(V)*200;I=204+this.mySin(V)*200;P.lineTo(J,I)}P.closePath();P.fill();P.restore();P.beginPath();P.strokeStyle="#FFFFFF";P.arc(204+U,204,194,Math.PI-Math.PI/35,Math.PI+Math.PI/35);P.stroke();this._buttonResize=document.createElement("canvas");this._buttonResize.setAttribute("class","VCXsizeButton");this._buttonResize.style.margin="-4px";this._buttonResize.style.transform="translate(-5px,"+(H-60/2)+"px) rotate(0deg)";this._buttonResize.style.cursor="sw-resize";this._buttonResize.setAttribute("data-rec-id",this.Modifiable.GetObject().GetID()+"_VCXsizeButton");this._divDigger.appendChild(this._buttonResize);var R=this._buttonResize.getContext("2d");R.canvas.width=22;R.canvas.height=60;R.drawImage(this._buttonResizeGhost,0,-175);this._buttonSliderShadow=UWA.createElement("div",{html:"","class":"VCXDiggerButtonZoomShadow",styles:{height:0,width:"2px",borderBottom:"21px solid rgba(0,0,0,0.6)",borderLeft:"3px solid transparent",borderRight:"4px solid transparent",padding:"0 8px 0 0",position:"absolute",transform:"rotate(135deg) translate(-43px,-22px)",top:"0px",}});this._divDigger.appendChild(this._buttonSliderShadow);this._buttonSlider=UWA.createElement("div",{html:"","class":"VCXDiggerButtonZoom",styles:{height:0,width:"0px",borderBottom:"20px solid rgba(255,255,255,0.9)",borderLeft:"1px solid transparent",borderRight:"3px solid transparent",padding:"0 8px 0 0",position:"absolute",transform:"rotate(135deg) translate(-43px,-22px)",top:"0px",cursor:"s-resize",}});this._buttonSlider.setAttribute("data-rec-id",this.Modifiable.GetObject().GetID()+"_VCXDiggerButtonZoom");this._divDigger.appendChild(this._buttonSlider);this._cssStylesMain={position:"absolute",height:20+"px",width:20+"px",borderRadius:"50%",margin:"2px",top:"0",left:"0",backgroundColor:this._modeBackgroundColorDefault,backgroundRepeat:"no-repeat",backgroundSize:"contain",cursor:"pointer",border:"thin solid lightgrey"};this._cssStylesMode={position:"absolute",height:20+"px",width:20+"px",borderRadius:"50%",margin:"2px",top:"0",left:"0",backgroundRepeat:"no-repeat",backgroundSize:"contain",cursor:"pointer",border:"thin solid lightgrey"};this._buttonMasterUI=this.CreateButton("I_VCX_Digger_Master",this._cssStylesMain,"VCXDiggerButton VCXDiggerButtonMaster","I_VCX_Digger_MasterOpen");if(!this.ExperienceBase.getManager("VCXContextManager").getPlayerMode()){this._buttonDelete=this.CreateButton("I_VCX_Digger_Hide",this._cssStylesMain,"VCXDiggerButton VCXDiggerButtonHide")}this._buttonModeDetail=this.CreateButton("I_VCX_Digger_Mode_DetailView",this._cssStylesMode,"VCXDiggerButton VCXDiggerButtonMode");this._buttonModeXRay=this.CreateButton("I_VCX_Digger_Mode_XRay",this._cssStylesMode,"VCXDiggerButton VCXDiggerButtonMode");this._buttonModeOnionSkin=this.CreateButton("I_VCX_Digger_Mode_OnionSkin",this._cssStylesMode,"VCXDiggerButton VCXDiggerButtonMode");this._buttonModeZoom=this.CreateButton("I_VCX_Digger_Mode_Zoom",this._cssStylesMode,"VCXDiggerButton VCXDiggerButtonMode");this._buttonAttachDisplay=this.CreateButton("I_VCX_Digger_Tool_Focus",this._cssStylesMode,"VCXDiggerButton VCXDiggerButtonMode");this._buttonLockViewpoint=this.CreateButton("I_VCX_Digger_Tool_LockVP",this._cssStylesMode,"VCXDiggerButton VCXDiggerButtonMode");this._buttonLockPlanes=this.CreateButton("I_VCX_Digger_Tool_LockPlanes",this._cssStylesMode,"VCXDiggerButton VCXDiggerButtonMode");if(!this.ExperienceBase.getManager("VCXContextManager").getPlayerMode()){this._buttonSnapshot2D=this.CreateButton("I_VCX_Digger_Tool_2DSnapshot",this._cssStylesMode,"VCXDiggerButton VCXDiggerButtonMode")}var G=i.getViewerOptions();G.div=this._divDiggerContent;this._viewerDigger=new l(G);this._viewerDigger.displayPoints(true);this._viewerDigger._isDigger=true;this._viewerDigger.setOIT(true);var N=this.ExperienceBase.getManager("VCXContextManager").getMainViewer().ambience.clone({viewer:this._viewerDigger});this._viewerDigger.setAmbience(N);N.setEnvironmentLightMatrix(new D.Matrix4());var Q=this.Modifiable;var S=this.ExperienceBase.getManager("VCXContextManager").getRootNode();this._viewerDigger.addNode(S);var T=this.ExperienceBase.getManager("VCXDressupManager");if(T){var L=T.QueryInterface("W3AISGNodeHolder");if(L){this._viewerDigger.addNode(L.getSGNode())}}var O={viewer:this._viewerDigger,angle:45};this.DiggerKernel._diggerViewpoint=new q(O);this.DiggerKernel._diggerViewpoint.getControl().setRotationRolling(false);this._viewerDigger.addViewpoint(this.DiggerKernel._diggerViewpoint);if(S){var Z=this._viewerDigger.getSceneGraphOverrideSetManager();Z.pushSceneGraphOverrideSet(this.ExperienceBase.getManager("VCXContextManager").getSharedSceneGraphOverrideSet());this.DiggerKernel._SceneGraphOverrideSet=new r(S);Z.pushSceneGraphOverrideSet(this.DiggerKernel._SceneGraphOverrideSet)}this._viewerDigger.canvas.style.borderRadius="inherit";this._viewerDigger.canvas.style.textAlign="left";this.initDiggerDressup();this.addPointerEvents();this.updateButtons()},removeDiv:function(){if(this._divDigger){if(this._divDigger_POINTERDOWN){this._divDigger.removeEventListener(k.POINTERDOWN,this._divDigger_POINTERDOWN);this._divDigger_POINTERDOWN=null}this._viewer.div.removeChild(this._divDigger)}this._divDigger=null},CreateButton:function(M,L,I,H){var J=UWA.createElement("div",{html:"","class":I,styles:L,});J.setAttribute("data-rec-id",this.Modifiable.GetObject().GetID()+"_"+M);J.style.backgroundImage="url("+d.getWebappsAssetUrl("VCXWebDigger","icons/"+M+".png")+")";J.saveBackground=J.style.backgroundImage;if(H){J.saveBackgroundOn="url("+d.getWebappsAssetUrl("VCXWebDigger","icons/"+H+".png")+")"}this._divDigger.appendChild(J);var K=this.ExperienceBase.getManager("VCXNLSManager");if(K){var G=K.GetNLS(["VCXWebDigger/VCXWebDigger"]);if(G){J.title=G.getTitle({key:M,})}}return J},dragWhileFactory:function(H){var G=function(N){H.DiggerKernel._lockPickability=true;var K=H.Modifiable;if(K){var O=H;var M=N.clientX;var L=N.clientY;N.preventDefault();N.stopPropagation();var J=O.getRadiusInPixel();var I=new D.Vector2();I.x=(M-O._ondragDeltaX)+J;I.y=(L-O._ondragDeltaY)+J;O._divDigger.style.left=M-O._ondragDeltaX+"px";O._divDigger.style.top=L-O._ondragDeltaY+"px";O.setPositionInPixel(I)}};return G},dragEndFactory:function(H){var G=function(M){H.DiggerKernel._lockPickability=false;var N=H;document.removeEventListener(k.POINTERMOVE,N._fctWhile,true);document.removeEventListener(k.POINTERUP,N._fctEnd,true);var L=N.Modifiable.GetProperty("Digger.Position").Clone();var J=new u();var I=N.getPosition();J.SetValue(I);L.SetPropertyValue(J);var K=new A(N.ExperienceBase.getManager("VCXScenarioManager"),N.ExperienceBase.getManager("VCXCommandManager"));K.ChangeProperty(H.Modifiable,L);N.ExperienceBase.getManager("VCXCommandManager").Push(K);N.ExperienceBase.getManager("VCXContextManager").setAllViewerSensitive(true);M.stopPropagation();N._isDragged=null};return G},moveButtonWhileFactory:function(H){var G=function(V){var Y=H.Modifiable;if(Y){V.preventDefault();V.stopPropagation();var U=H;var P=V.clientX;var N=V.clientY;var S=U.getPositionInPixel();var K=U._viewer.canvas.getBoundingClientRect();S.x+=K.left;S.y+=K.top;U.ExperienceBase.getManager("VCXContextManager").setAllViewerSensitive(false);U.DiggerKernel._lockPickability=true;if(U._isDragged&&U._isDragged.className==="VCXDiggerButtonZoom"){var O;var R=0,Q=1,I=P-S.x,X=N-S.y;O=(Math.atan2(X,I)-Math.atan2(Q,R));if(O>0&&O<0.5*Math.PI){O=-1e-17}if(O<0){O+=2*Math.PI}O=Math.min(320,Math.max(O*180/Math.PI,204));if(U.getMode()===p.EMode.Zoom){var L=U.angle2factor(O);U.DiggerKernel.setZoom(L);U.setZoomFactor(L)}else{var J=U.angle2factor(O);U.DiggerKernel.setDepth(J);U.setDepthFactor(J)}U.updateButtons()}else{var M=P-S.x;M=Math.abs(M*M);var W=N-S.y;W=Math.abs(W*W);var T=Math.sqrt(M+W);U.setRadiusInPixel(T);U.updateDiggerUI()}}};return G},angle2factor:function(J){var I;var H=(1-0)/(320-204);var G=0-H*204;I=J*H+G;return I},factor2angle:function(I){var J;var H=(1-0)/(320-204);var G=0-H*204;J=(I-G)/H;return J},moveButtonEndFactory:function(H){var G=function(L){L.preventDefault();L.stopPropagation();var M=H;document.removeEventListener(k.POINTERMOVE,M._fctWhile,true);document.removeEventListener(k.POINTERUP,M._fctEnd,true);if(M._isDragged){var K=null;var I=null;if(M._isDragged.className==="VCXDiggerButtonZoom"){if(M.getMode()===p.EMode.Zoom){K=H.Modifiable.GetProperty("Digger.ZoomFactor").Clone();I=new y();I.SetValue(M.getZoomFactor())}else{K=H.Modifiable.GetProperty("Digger.DepthFactor").Clone();I=new y();I.SetValue(M.getDepthFactor())}M.DiggerKernel._lockPickability=false;M.DiggerKernel.updateDiggerContent()}else{K=H.Modifiable.GetProperty("Digger.Radius").Clone();I=new y();I.SetValue(M.getRadius())}K.SetPropertyValue(I);var J=new A(H.ExperienceBase.getManager("VCXScenarioManager"),H.ExperienceBase.getManager("VCXCommandManager"));J.ChangeProperty(H.Modifiable,K);H.ExperienceBase.getManager("VCXCommandManager").Push(J);M.ExperienceBase.getManager("VCXContextManager").setAllViewerSensitive(true);M._isDragged=null}};return G},distanceTo:function(J,I,H,G){return Math.sqrt(Math.pow(H-J,2)+Math.pow(G-I,2))},mouseOnBorder:function(M,L,K,I,H,J){var G=this.distanceTo(M,L,K,I);return(G<=H&&G>=J)},addPointerEvents:function(){var G=this;this._buttonMasterUI_POINTERDOWN=function(H){H.stopPropagation();H.stopImmediatePropagation()};this._buttonMasterUI.addEventListener(k.POINTERDOWN,this._buttonMasterUI_POINTERDOWN);this._buttonMasterUI_POINTERUP=function(H){H.stopPropagation();H.stopImmediatePropagation();G._displayButtons=!G._displayButtons;G.updateButtons();if(G._displayButtons){G._buttonMasterUI.style.backgroundImage=G._buttonMasterUI.saveBackgroundOn}else{G._buttonMasterUI.style.backgroundImage=G._buttonMasterUI.saveBackground}};this._buttonMasterUI.addEventListener(k.POINTERUP,this._buttonMasterUI_POINTERUP);if(this._buttonDelete){this._buttonDelete_POINTERDOWN=function(H){H.stopPropagation();H.stopImmediatePropagation()};this._buttonDelete.addEventListener(k.POINTERDOWN,this._buttonDelete_POINTERDOWN);this._buttonDelete_POINTERUP=function(K){K.stopPropagation();K.stopImmediatePropagation();G._divDigger.remove();G._divDigger=null;G.removeAnchorsInteractors();var H=G.Modifiable;var I=H.GetObject();G.ExperienceBase.getManager("VCXSelectionManager").removeComponentsFromSelection([I],false);this.disposeViewer();var J=new c(G.ExperienceBase.getManager("VCXCommandManager"),G.ExperienceBase.getManager("VCXDressupManager"),G.ExperienceBase.getManager("VCXScenarioManager"),G.ExperienceBase.ComponentsMap);var L=[];L.push(I);J.RemoveDressups(L);G.ExperienceBase.getManager("VCXCommandManager").Push(J)};this._buttonDelete.addEventListener(k.POINTERUP,this._buttonDelete_POINTERUP)}this._buttonModeZoom_POINTERUP=function(K){K.stopPropagation();K.stopImmediatePropagation();G.setMode(p.EMode.Zoom);var J=G.Modifiable.GetProperty("Digger.Mode").Clone();var H=new B();H.SetValue(G.getMode());J.SetPropertyValue(H);var I=new A(G.ExperienceBase.getManager("VCXScenarioManager"),G.ExperienceBase.getManager("VCXCommandManager"));I.ChangeProperty(G.Modifiable,J);G.ExperienceBase.getManager("VCXCommandManager").Push(I)};this._buttonModeZoom.addEventListener(k.POINTERUP,this._buttonModeZoom_POINTERUP);this._buttonModeOnionSkin_POINTERUP=function(K){K.stopPropagation();K.stopImmediatePropagation();G.setMode(p.EMode.Onion);var J=G.Modifiable.GetProperty("Digger.Mode").Clone();var H=new B();H.SetValue(G.getMode());J.SetPropertyValue(H);var I=new A(G.ExperienceBase.getManager("VCXScenarioManager"),G.ExperienceBase.getManager("VCXCommandManager"));I.ChangeProperty(G.Modifiable,J);G.ExperienceBase.getManager("VCXCommandManager").Push(I)};this._buttonModeOnionSkin.addEventListener(k.POINTERUP,this._buttonModeOnionSkin_POINTERUP);this._buttonModeXRay_POINTERUP=function(K){K.stopPropagation();K.stopImmediatePropagation();G.setMode(p.EMode.XRay);var J=G.Modifiable.GetProperty("Digger.Mode").Clone();var H=new B();H.SetValue(G.getMode());J.SetPropertyValue(H);var I=new A(G.ExperienceBase.getManager("VCXScenarioManager"),G.ExperienceBase.getManager("VCXCommandManager"));I.ChangeProperty(G.Modifiable,J);G.ExperienceBase.getManager("VCXCommandManager").Push(I)};this._buttonModeXRay.addEventListener(k.POINTERUP,this._buttonModeXRay_POINTERUP);this._buttonModeDetail_POINTERUP=function(K){K.stopPropagation();K.stopImmediatePropagation();G.setMode(p.EMode.Detail);var J=G.Modifiable.GetProperty("Digger.Mode").Clone();var H=new B();H.SetValue(G.getMode());J.SetPropertyValue(H);var I=new A(G.ExperienceBase.getManager("VCXScenarioManager"),G.ExperienceBase.getManager("VCXCommandManager"));I.ChangeProperty(G.Modifiable,J);G.ExperienceBase.getManager("VCXCommandManager").Push(I)};this._buttonModeDetail.addEventListener(k.POINTERUP,this._buttonModeDetail_POINTERUP);if(this._buttonSnapshot2D){this._buttonSnapshot2D_POINTERUP=function(H){H.stopPropagation();H.stopImmediatePropagation();G.createSnapshot2D(true)};this._buttonSnapshot2D.addEventListener(k.POINTERUP,this._buttonSnapshot2D_POINTERUP)}this._buttonLockPlanes_POINTERUP=function(H){H.stopPropagation();H.stopImmediatePropagation();G.DiggerKernel.lockPlanes(!G.DiggerKernel.getLockPlanes());G.DiggerKernel.sortFrontToBack();G.DiggerKernel.updateDiggerContent();G.updateButtons()};this._buttonLockPlanes.addEventListener(k.POINTERUP,this._buttonLockPlanes_POINTERUP);this._buttonLockViewpoint_POINTERUP=function(H){H.stopPropagation();H.stopImmediatePropagation();G.DiggerKernel.lockViewpoint(!G.DiggerKernel.getLockViewpoint());G.synchronizeDiggerViewpoint();G.setDiggerViewOffset();G.updateButtons()};this._buttonLockViewpoint.addEventListener(k.POINTERUP,this._buttonLockViewpoint_POINTERUP);this._buttonAttachDisplay_POINTERUP=function(M){M.stopPropagation();M.stopImmediatePropagation();G.setAttachDisplay(!G.getAttachDisplay());if(G.getAttachDisplay()){var J=G.getAnchorVector();if(J.equals(new D.Vector3())){var H=G.getPaperCenter3D();var N=new b();N.SetValueFrame(new n().SetValueFromVector(H));G.setProp(N.GetValue(),"Actor.Anchor.0",new b())}}var L=G.Modifiable.GetProperty("Digger.Attach").Clone();var I=new x();I.SetValue(G.getAttachDisplay());L.SetPropertyValue(I);var K=new A(G.ExperienceBase.getManager("VCXScenarioManager"),G.ExperienceBase.getManager("VCXCommandManager"));K.ChangeProperty(G.Modifiable,L);G.ExperienceBase.getManager("VCXCommandManager").Push(K)};this._buttonAttachDisplay.addEventListener(k.POINTERUP,this._buttonAttachDisplay_POINTERUP);this._divDigger_POINTERDOWN=function(N){N.stopPropagation();G._isDragged=G._divDigger;var K=N.clientX;var J=N.clientY;var M=G.getRadiusInPixel();var L=G.getPositionInPixel();var P=L.x-M;var O=L.y-M;var H=G._viewer.canvas.getBoundingClientRect();L.x+=H.left;L.y+=H.top;if(G.mouseOnBorder(L.x,L.y,K,J,M,M-G.Modifiable.GetObject().borderThickness)){var I=new f(G.ExperienceBase.getManager("VCXSelectionManager"));I.SetSelection(G.Modifiable.GetObject());G.ExperienceBase.getManager("VCXCommandManager").Do(I);G._ondragDeltaX=K-P;G._ondragDeltaY=J-O;G._isDragged=true;G.ExperienceBase.getManager("VCXContextManager").setAllViewerSensitive(false);G._fctWhile=G.dragWhileFactory(G);G._fctEnd=G.dragEndFactory(G);document.addEventListener(k.POINTERMOVE,G._fctWhile,true);document.addEventListener(k.POINTERUP,G._fctEnd,true)}};this._divDigger.addEvent(k.POINTERDOWN,this._divDigger_POINTERDOWN);this._buttonResize_POINTERDOWN=function(H){H.stopPropagation();G._isDragged=G._buttonResize;G._fctWhile=G.moveButtonWhileFactory(G);G._fctEnd=G.moveButtonEndFactory(G);document.addEventListener(k.POINTERMOVE,G._fctWhile,true);document.addEventListener(k.POINTERUP,G._fctEnd,true)};this._buttonResize.addEventListener(k.POINTERDOWN,this._buttonResize_POINTERDOWN);this._buttonSlider_POINTERDOWN=function(H){H.stopPropagation();G._isDragged=G._buttonSlider;G._fctWhile=G.moveButtonWhileFactory(G);G._fctEnd=G.moveButtonEndFactory(G);document.addEventListener(k.POINTERMOVE,G._fctWhile,true);document.addEventListener(k.POINTERUP,G._fctEnd,true)};this._buttonSlider.addEventListener(k.POINTERDOWN,this._buttonSlider_POINTERDOWN)},updateAnchorAttach:function(K,L){if(K===undefined){K=true}if(L===undefined){L=true}var I=this.Modifiable;if(I){var J=I.QueryInterface("VCXIManipulable");var G=J&&J.getAllInteractors();var H=G&&G["Interactor Anchor.0"];if(!H){H=this._createAnchorHandleInteractor();if(!H){console.log("Couldn't create interactor..")}J.addInteractor("Interactor Anchor.0",H)}if(this.getAttachDisplay()&&L){this._attachDiv1.style.display="";this._attachDiv2.style.display="";if(K){this.updateDiggerAttach()}H.handleInfos.stayVisible=true;H.visibility=m.EVisibility.Always;J._forceUpdate=true}else{this._attachDiv1.style.display="none";this._attachDiv2.style.display="none";H.handleInfos.stayVisible=false;H.visibility=m.EVisibility.NoChange}}},synchronizeDiggerViewport:function(){var G=this.ExperienceBase.getManager("VCXVisuManager").getActiveViewport();if(G){var H=G.QueryInterface("VCXIModifiable");if(H){var J=H.GetProperties();H._forceRefresh=true;J.onEachProperty(function(M,L){H.OnChangeProperty(M,L.GetPropertyValue())});H.OnChangePropertiesEnd();var K=H.QueryInterface("W3AISGNodeHolder");if(K){K.setSGNodeDirty(true)}H._forceRefresh=false;var I=H.GetObject();I.setLightingMode(H.GetPropertyValue("Render.Lighting.Mode"),H.GetPropertyValue("Render.Lighting.Intensity"),H.GetPropertyValue("Render.Lighting.Static"))}}},synchronizeDiggerGround:function(){var H=this.ExperienceBase.ComponentsMap.GetComponentFromType("VCXComponentGround");if(H&&H.length){var J=H[0].QueryInterface("VCXIModifiable");if(J){var G=J.GetProperties();J._forceRefresh=true;G.onEachProperty(function(L,K){J.OnChangeProperty(L,K.GetPropertyValue())});J.OnChangePropertiesEnd();var I=J.QueryInterface("W3AISGNodeHolder");if(I){I.setSGNodeDirty(true)}J._forceRefresh=false}}},addViewer:function(){var I=this.Modifiable;if(I){var G=this.ExperienceBase.getManager("VCXContextManager").getViewers();var J="viewer_"+I.GetObject().GetID();for(var H=0;H<G.length;H++){if(G[H].viewerID===J){console.log("VCXContextManager::addViewer "+J+" already added");return}}this.ExperienceBase.getManager("VCXContextManager").addViewer("viewer_"+I.GetObject().GetID(),this._viewerDigger);this.synchronizeDiggerViewport();this.synchronizeDiggerGround()}},removeViewer:function(){var G=this.Modifiable;if(G){this.ExperienceBase.getManager("VCXContextManager").removeViewer("viewer_"+G.GetObject().GetID())}},update:function(J){if(!this.isVisible()){return}this._parent(J);var U=this.Modifiable;this._displayUI=!this.ExperienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&!this.ExperienceBase.getManager("VCXVisuManager").isInTransitionMode();var P=U.GetObject();var O=false;var H=false;var W=false;if(this.ExperienceBase.getManager("VCXVisuManager").HasViewpointMoved){P._DiggerDirtyMask|=p.FDirty.ViewpointMoved;if(!(this.getAttachDisplay()&&this.DiggerKernel.getLockViewpoint())){this.synchronizeDiggerViewpoint();H=true}}if(this._divDigger){var I=this.GetOpacity();if(this._diggerPreviousOpacity!==I||(I===0&&this._diggerPreviousOpacity!==0)){if(I===0&&this._diggerPreviousOpacity!==0){this.removeViewer()}else{if(I!==0&&this._diggerPreviousOpacity===0){this.addViewer()}}this._diggerPreviousOpacity=I;this._divDigger.style.opacity=I;var X="inherit";if(I===0){X="hidden";this.DiggerKernel._lockUpdateDigger=true}else{this.DiggerKernel._lockUpdateDigger=false}if(this._divDigger.style){this._divDigger.style.visibility=X}if(this._viewerDigger&&this._viewerDigger.div&&this._viewerDigger.div.style){this._viewerDigger.div.style.visibility=X}var R=U.QueryInterface("VCXIManipulable");var T=R&&R.getAllInteractors();var N=T&&T["Interactor Anchor.0"];if(N){N.handleInfos.opacity=I;if(this.getAttachDisplay()){N.handleInfos.stayVisible=true;N.visibility===(I===0)?m.EVisibility.NoChange:m.EVisibility.Always}else{N.handleInfos.stayVisible=false;N.visibility===m.EVisibility.NoChange}}}}var K=this.getRadiusInPixel();if(this._previousRadius!==K){P._DiggerDirtyMask|=p.FDirty.Radius;W=true;this._previousRadius=K;this.DiggerKernel._radiusPx=K}if(this._divDigger){var Y=this.getPositionInPixel();if((this._previousPosition===undefined)||this._previousPosition.distanceTo(Y)>0.00001){var K=this.getRadiusInPixel();this._divDigger.style.left=Y.x-K+"px";this._divDigger.style.top=Y.y-K+"px";if(!this.getAttachDisplay()){W=true}this._previousPosition=Y;this.DiggerKernel._positionPx=Y;P._DiggerDirtyMask|=p.FDirty.Position}}var M=this.getAttachDisplay();if(this._previousAttachDisplay!==M){this.DiggerKernel.setAttach(M);this.updateAnchorAttach();this.DiggerKernel.resetTorchInfo();O=true;if(!this.DiggerKernel.getLockViewpoint()){W=true}this._previousAttachDisplay=M}var G=this.getTorchFilter();if(this._previousTorchFilter!==G){this.DiggerKernel.setTorchFilter(this.getTorchFilter());if(this.getMode()!==p.EMode.Zoom){this.DiggerKernel.resetTorchInfo();O=true}this._previousTorchFilter=G}if(this.getAttachDisplay()&&P._DiggerDirtyMask&(p.FDirty.Position|p.FDirty.Radius|p.FDirty.AnchorPosition|p.FDirty.ViewpointMoved)){this.updateDiggerAttach()}var S=this.getMode();if(this._previousMode!==S){this.DiggerKernel.resetDepth();this._previousDepthFactor=null;this.DiggerKernel.resetZoom();this._previousZoomFactor=null;if(S===z.EDigMode.Linear){this.DiggerKernel.removeOverrides()}else{if(((S===z.EMode.XRay)&&(this._previousMode!==z.EMode.Onion))||((S===z.EMode.Onion)&&(this._previousMode!==z.EMode.XRay))){H=true}}this.DiggerKernel.setMode(S);this._previousMode=S}var L=this.getZoomFactor();if(this._previousZoomFactor!==L){this.DiggerKernel.setZoom(L);O=true;W=true;P._DiggerDirtyMask|=p.FDirty.Buttons;this._previousZoomFactor=L}var V=this.getDepthFactor();if(this._previousDepthFactor!==V){this.DiggerKernel.setDepth(V);O=true;P._DiggerDirtyMask|=p.FDirty.Buttons;this._previousDepthFactor=V}var Q=this.getDepthZoom();if(this._previousDepthZoom!==Q){this.DiggerKernel.setDepthZoom(Q);O=true;W=true;this._previousDepthZoom=Q}if(P._DiggerDirtyMask&p.FDirty.Radius){this.updateDiggerUI()}else{if(P._DiggerDirtyMask&p.FDirty.Buttons){this.updateButtons()}}if((this.getMode()===p.EMode.XRay||this.getMode()===p.EMode.Onion)){if(H){this.DiggerKernel.resetArray(false);O=true}if(!this.getAttachDisplay()){if(P._DiggerDirtyMask&(p.FDirty.Position|p.FDirty.Radius)){if(this.getTorchFilter()){this.DiggerKernel.resetTorchInfo();O=true}}}else{if(P._DiggerDirtyMask&p.FDirty.AnchorPosition){if(this.getTorchFilter()){this.DiggerKernel.resetTorchInfo();O=true}}}}if(O&&J.time){this.DiggerKernel._lockPickability=true;this.DiggerKernel.updateDiggerContent();if(!P._dirtyPickability){P._dirtyPickability=true}this._dirtyPickabilityStartTime=J.time}if(P._dirtyPickability&&((J.time-this._dirtyPickabilityStartTime)>500)){this.DiggerKernel._lockPickability=false;this.DiggerKernel._lockOpacity=true;this.DiggerKernel.updateDiggerContent();this.DiggerKernel._lockOpacity=false;P._dirtyPickability=false;this._dirtyPickabilityStartTime=null}if(this.getAttachDisplay()&&!this.DiggerKernel.getLockViewpoint()&&P._DiggerDirtyMask&(p.FDirty.AnchorPosition|p.FDirty.ViewpointMoved)){W=true}if(W){this.setDiggerViewOffset()}if((P._DiggerDirtyMask&&P._DiggerDirtyMask!==p.FDirty.Position)||!this.getAttachDisplay()||O||H||W){this._viewerDigger.render()}P.setDirty(false);P._DiggerDirtyMask=0},initDiggerDressup:function(){this.DiggerKernel._experienceBase=this.ExperienceBase;this.DiggerKernel._viewer=this._viewerDigger;this.DiggerKernel._viewer.setSmallRenderTargetPicking(true);this.DiggerKernel.setMode(this.getMode());this.DiggerKernel.setZoom(this.getZoomFactor());this.DiggerKernel.setAttach(this.getAttachDisplay());this.synchronizeDiggerViewpoint();this.setDiggerViewOffset();this.DiggerKernel.updateDiggerContent(true);var G=this.DiggerKernel._viewer.currentViewpoint;if(G.control){var I=this;var H=G.control;G.control._zoom=function(J,M){H.update();var K,L;K=J.y-M.y;K*=0.5/this.radiusZoom;L=1+K*this.zoomSpeed;if(L!==1&&L>0){var N=(1-L)/5;I.zoom(N)}};G.control._mouseWheel=function(J){J.event.preventDefault();var K=UWA.Event.wheelDelta(J.getJSEvent());if(!I.DiggerKernel.getLockViewpoint()){var L=K/15;I.zoom(L)}}}},zoom:function(M){var H;if(this.DiggerKernel.getMode()===p.EMode.Zoom){H="Digger.ZoomFactor"}else{H="Digger.DepthZoom"}var J=this.getProp(H);J+=M;J=Math.min(J,1);J=Math.max(J,0);if(this.DiggerKernel.getMode()===p.EMode.Zoom){this.DiggerKernel.setZoom(J)}else{this.DiggerKernel.setDepthZoom(J)}var I=this.Modifiable;var G=new y();G.SetValue(J);var L=I.GetProperty(H).Clone();L.SetPropertyValue(G);var K=new A(this.ExperienceBase.getManager("VCXScenarioManager"),this.ExperienceBase.getManager("VCXCommandManager"));K.ChangeProperty(I,L);this.ExperienceBase.getManager("VCXCommandManager").Push(K)},setDiggerViewOffset:function(){var R=this.ExperienceBase.getManager("VCXPaperManager");var S=1;var H=0;if(this.DiggerKernel.getMode()===p.EMode.Zoom){H=this.getZoomFactor()}else{H=this.getDepthZoom()}H=Math.min(1,H);S=1-H;S=Math.max(S,1e-10);var N=this._viewerDigger.div.clientWidth*S;var M=this._viewerDigger.div.clientHeight*S;var Q=0;var P=0;if(this.getAttachDisplay()){var I=this.getAnchorVector();var L=null;if(this.DiggerKernel.getLockViewpoint()){L=this._viewerDigger}else{L=this._viewer}if(L===this._viewerDigger){var K=this.getPositionInPixel()}var U=this.convert3DPointToPxl(I,L);var G=this.convert3DPointToPxl(I,this._viewer);Q=R._ViewBoxPx.x-G.x+N/2;P=R._ViewBoxPx.y-G.y+M/2}else{var T=new D.Vector2(this._divDigger.offsetLeft,this._divDigger.offsetTop);Q=R._ViewBoxPx.x-T.x-this._viewerDigger.div.offsetLeft-1-N*(1/S-1)/2;P=R._ViewBoxPx.y-T.y-this._viewerDigger.div.offsetTop-1-M*(1/S-1)/2}var O=R._ViewBoxPxSize.x;var J=R._ViewBoxPxSize.y;this._viewerDigger.currentViewpoint.setViewOffset({fullWidth:O,fullHeight:J,x:-Q,y:-P,width:N,height:M})},projectionTypeChanged:function(){if(this._viewer&&this._viewerDigger){}else{return false}var G=this._viewer.currentViewpoint;var H=this._viewerDigger.currentViewpoint;if(H.getProjectionType()!==G.getProjectionType()){return true}return false},synchronizeDiggerViewpoint:function(){this.DiggerKernel._lockSynchronizeDiggerViewpoint=true;var G=this._viewer.currentViewpoint;var H=this._viewerDigger.currentViewpoint;if(this.projectionTypeChanged()){H.setProjectionType(G.getProjectionType());H.setPixelCulling(G.camera.pixelCulling)}H.setAngle(G.getAngle());H.setEyePosition(G.getEyePosition().clone());H.setTarget(G.getTarget().clone());H.setUpDirection(G.getUpDirection().clone());this.DiggerKernel._lockSynchronizeDiggerViewpoint=false},updateInteractors:function(J){this.updateAnchorsInteractors(J);if(!(this.isNodeBuilt&&this.isNodeBuilt())){return}var I=this.Modifiable.QueryInterface("VCXIManipulable");if(!I){return}var G=I.getAllInteractors();var H=G["Interactor Anchor.0"];if(H){if(H.visibility===m.EVisibility.Always){var K=new D.Vector3().getPositionFromMatrix(H.matrix);if(!K.equals(this._anchorVect3)){this.Modifiable.GetObject()._DiggerDirtyMask|=p.FDirty.AnchorPosition;this._anchorVect3.copy(K)}}}},_createAnchorHandleInteractor:function(){var I=this.Modifiable.QueryInterface("VCXIManipulable");if(!I){return}var H=I.getAllInteractors();var J="Interactor Anchor.0";var G=H[J];if(!G){G=this._parent(J,"0");G.application|=m.EApplication["3DPlayCATIAComposer"];I.addInteractor("Interactor Anchor.0",G)}if(!(G.application&m.EApplication["3DPlayCATIAComposer"])){G.application|=m.EApplication["3DPlayCATIAComposer"]}if(!G.handleInfos){G.handleInfos={size:10}}return G},isNodeBuilt:function(){return Boolean(this._divDigger)},doHiRes:function(I,H,J,G){var I=this.ExperienceBase;var K=new E();K._viewer=this.DiggerKernel._viewer;K._usePaperRatio=false;var L=this;K._doHiResImage(I,H,J,function(M){if(G!==undefined){G(M)}})},createSnapshot2D:function(J){var I=this.ExperienceBase;var H=1.5;var K=this.DiggerKernel._viewer.SCREEN_WIDTH*H;var G=this.DiggerKernel._viewer.SCREEN_HEIGHT*H;var L=this;this.doHiRes(I,K,G,function(N){L.createUpdatePanel(N,H);if(J){if(L.Modifiable&&L.Modifiable.GetObject()){var M=L.Modifiable.GetObject().QueryInterface("VCXIVisibility");if(M){M.SetVisibility(g.EVisState.Hidden)}}}})},createUpdatePanel:function(K,N){if(!K){return false}var L=this.ExperienceBase;var R=L.getManager("VCXPaperManager").GetMmToPxRatio()*N;var H=K.getPixelWidth()/R;var U=K.getPixelHeight()/R;var Q=H/2;var I=K.toCanvas();var G=I.toDataURL("image/jpeg");var T=null;var S=this.getProp("Digger.AssociatedPanelID");if(S){T=this._ExperienceBase.ComponentsMap.GetComponentFromID(S)}var P=this;var O=function(ak,ac){var af=ak.QueryInterface("VCXIModifiable");if(af){var ae=P.Modifiable.GetObject();var ai=new w(ae.GetID());af.OnChangeProperty("Collab.AssociatedObjectID",ai);var V=F.dataURLToBlob(G);if(V){var aa=window.URL.createObjectURL(V);var az=L.getManager("VCXDocManager").BuildPathFromString(aa);var ad=L.getManager("VCXDocManager").AddOrModifyDoc(az);af.OnChangeProperty("Collab.Image.Doc.ID",ad);var X=new y();X.SetValue(P.GetPropertyValue("Actor.Opacity"));af.OnChangeProperty("Actor.Opacity",X);if(!ac){var aq=new B();aq.SetValue(a.EBillboardType.Spherical);af.OnChangeProperty("Collab.3D.Paper.Billboard.Type",aq);var aA=new B();aA.SetValue(a.EBodyShape.Circle);af.OnChangeProperty("Collab.Body.Shape",aA);var ar=new x();ar.SetValue(true);af.OnChangeProperty("Collab.Border.Show",ar);var Y=new x(true);af.OnChangeProperty("Collab.Background.Show",Y);var an=new x();an.SetValue(true);af.OnChangeProperty("Collab.Body.Shadow.Show",an)}var ah=new x();ah.SetValue(P.getAttachDisplay());af.OnChangeProperty("Collab.Attach.Show",ah);var W=P.Modifiable.GetProperty("Actor.Anchor.0").Clone();var Z=W.GetPropertyValue();af.OnChangeProperty("Actor.Anchor.0",Z);var aw=new C();aw.SetValue([0]);af.OnChangeProperty("Collab.ListAnchorsIDs",aw);if(!ac){var ap=new B();ap.SetValue(a.ELeadType.Mustache);af.OnChangeProperty("Collab.Attach.LeadType",ap);var av=new B();av.SetValue(1000);af.OnChangeProperty("Collab.3D.Paper.Positioning.Type",av);var aB=new y();aB.SetValue(L.getManager("VCXDressupManager").GetDressupCount());af.OnChangeProperty("Collab.3D.Paper.Depth",aB);var am=new B();am.SetValue(1);af.OnChangeProperty("Collab.3D.Paper.Size.Control.Type",am)}var aC=P.getPosition();var ay=new y();ay.SetValue(aC.x-Q);af.OnChangeProperty("Collab.3D.Paper.Paper.Position.X",ay);var ax=new y();ax.SetValue(aC.y+Q);af.OnChangeProperty("Collab.3D.Paper.Paper.Position.Y",ax);var au=new y();au.SetValue(H);af.OnChangeProperty("Collab.Body.Width",au);var at=new y();at.SetValue(H);af.OnChangeProperty("Collab.Body.Height",at);var al=new c(L.getManager("VCXCommandManager"),L.getManager("VCXDressupManager"),L.getManager("VCXScenarioManager"),L.ComponentsMap);al.AddDressups(ak);L.getManager("VCXCommandManager").Push(al);var ai=new w(ak.GetID());P.Modifiable.OnChangeProperty("Digger.AssociatedPanelID",ai);var ao=af.GetProperties();L.getManager("VCXScenarioManager").AddNeutrals(af,ao);var ab=ak.QueryInterface("VCXIVisibility");if(ab){ab.SetVisibility(g.EVisState.Visible)}var aj=new f(L.getManager("VCXSelectionManager"));aj.SetSelection(ak);L.getManager("VCXCommandManager").Do(aj);var ag=P.ExperienceBase.getManager("VCXContextManager");ag.renderAll({updateInfinitePlane:true})}}};var M=true;if(!T){if(L.getManager("VCXCAT3DXModelManager")){var J=L.getManager("VCXContextManager").getRootComponent();if(J){L.getManager("VCXCAT3DXModelManager").CreateActor("VCXComponentDiggerPanel","Digger Panel",J).done(function(V){M=false;O(V,M)})}}else{T=L.Factory.BuildComponent("VCXComponentDiggerPanel");M=false;O(T,M)}}else{O(T,M)}return true},SetPropertiesFromPanel:function(K,G,J){var I=this.ExperienceBase.getManager("VCXPaperManager").GetMmToPxRatio();this.setRadius(K.internalSize.x/2+this.Modifiable.GetObject().borderThickness/I);this.setPosition(K.centerInPaper);this.setAttachDisplay(G);var H=new D.Vector3().getPositionFromMatrix(J);var L=new b();L.SetValueFrame(new n().SetValueFromVector(H));this.setProp(L.GetValue(),"Actor.Anchor.0",new b())},});Object.defineProperty(e.prototype,"DiggerKernel",{enumerable:true,get:function(){return this._diggerKernel},set:function(G){this._diggerKernel=G},});Object.defineProperty(e.prototype,"DiggerUI",{enumerable:true,get:function(){return this._diggerUI},set:function(G){this._diggerUI=G},});return e});define("DS/VCXWebDigger/VCXDiggerSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDigger/VCXDiggerNode"],function(a,b){var c=a.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Digger",modifiable:d,};this._sgNode=new b(e);this._sgNode.setIcon("../VCXWebDigger/assets/icons/32/I_VCX_Panel_Tree_DiggerLeaf.png");this._sgNode.onBuildSGNode()}return this._parent()},unreferenceSGNode:function(){if(this._sgNode){this._sgNode.dispose();delete this._sgNode}},});return c});