define("DS/MPFBankAccountFormComponent/BankAccountFormComponent",["UWA/Core","UWA/Element","UWA/Class/View","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFCountrySelectComponent/CountrySelectComponent","i18n!DS/MPFBankAccountFormComponent/assets/nls/BankAccountFormComponent","css!DS/MPFUI/MPFUI"],function(e,b,a,c,g,h,i,d){var f=a.extend({setup:function(j){j||(j={});if(!(e.is(j.constraints))){throw new Error("option.constraints parameter is required")}this.container.addClassName("mpf-bank-account-form");this.constraints=j.constraints;this.countrySelectComponent=new i({model:this.model});if(j.showCountry!==undefined){this.showCountry=j.showCountry}else{this.showCountry=true}this.inputs=[];this.validated=false;this.saveButton=null;this.editable=j.editable!==false;if(j.readOnly!==undefined){this.editable=j.readOnly!==true}this.showSaveSuccess=false;this.listenTo(this.model,"onChange:country",this.render);this.listenTo(this.model,"onSync",this.render)},domEvents:{"click .mpf-commands .btn-primary":"save"},render:function(){var n;var o;var m;var j;var l;var k;n=[];o=this._createMessageContainer();n.push(this._createValidationIcon());j=this._createEntries(this.model,this.constraints);Array.prototype.push.apply(n,j);if(this.showCountry){n.push(this.countrySelectComponent.render())}l=this._createCommandsContainer();n.push(l);k=e.createElement("form",{"class":"mpf-form",html:n});if(this.validated){k.addClassName("validated")}this.container.setContent([o,k]);if(this.showSaveSuccess){this.showSaveSuccess=false;m=e.createElement("p",{"class":"mpf-success",html:[{tag:"span","class":"fonticon fonticon-check"},{tag:"span",text:d.get("bankAccountSaved")}]});m.inject(o)}return this},destroy:function(){this.countrySelectComponent.destroy();this.countrySelectComponent=null;this.stopListening(this.model);this.model=null;this._parent();this.container=null},save:function(){var o=this;var p;var k;var m;var l;var j;var n;p=this.container.getElement(".mpf-messages");p.removeClassName("mpf-error");p.empty();this.validated=true;this.container.getElement(".mpf-form").addClassName("validated");k=this.container.getElements("input");m=k.reduce(function(q,r){q[r.name]=r.value.trim();return q},{});if(this.model.set(m)){this.saveButton.load(true);this._setFieldsEnabled(false);l=this.model.validate(this.model.toJSON());if(l&&(l.length>0)){j=l.length;for(n=0;n<j;n++){this._addErrorMessage(l[n])}this.saveButton.load(false);this._setFieldsEnabled(true)}else{this.model.save(null,{onComplete:function(){o.showSaveSuccess=true;o.saveButton.load(false);o.saveButton.disable()},onFailure:function(){o._addErrorMessage(d.get("saveFailure"));o.saveButton.load(false);o._setFieldsEnabled(true)}})}}},isReadOnly:function(){var j;j=!(this.editable)||!(this.model.isNew());return j},setReadOnly:function(j){this.editable=!j;this._setFieldsEnabled(this.editable);this.render()},_createValidationIcon:function(){var j;j=e.createElement("div",{"class":"mpf-kyc-validation-icon"});if(!(this.model.isNew())){j.addClassName("validated")}return j},_createMessageContainer:function(){var j;j=e.createElement("div",{"class":"mpf-messages"});return j},_addErrorMessage:function(j){var k;k=this.container.getElement(".mpf-messages");this.saveButton.load(false);k.addClassName("mpf-error");e.createElement("p",{text:d.get(j)}).inject(k)},_createEntries:function(){var k=this;var l;var m;var j=[];m=this.model.get("country");l=this.constraints.get(m)||this.constraints.get("DEFAULT");this.inputs=[];if(l){l.keys().filter(function(n){return((n!=="country")&&(k.model.get(n)!==undefined))}).forEach(function(o){var n;var p;n=l.get(o);if(n!==null){p=k.model.get(o);j.push(k._createEntry(d.get(o),o,p,n))}})}return j},_createEntry:function(l,k,n,o){var m;var j;if(o.required){l+='&nbsp;<em class="mpf-required">*</em>'}j=new c({name:k,value:n,pattern:o.pattern,required:o.required});if(this.isReadOnly()){j.disable()}this.inputs.push(j);m=e.createElement("div",{"class":"mpf-entry",html:[{tag:"label",html:[{tag:"span","class":"mpf-label",html:l},j]}]});return m},_createCommandsContainer:function(){var k;var j=[];if(!(this.isReadOnly())){this.saveButton=new g({value:d.get("Save"),className:"primary"});j.push(this.saveButton)}k=e.createElement("div",{"class":"mpf-commands",html:j});return k},_setFieldsEnabled:function(j){this.inputs.map(function(k){k.setDisabled(!(j))})}});return f});define("DS/MPFBankAccountFormComponent/BankAccountFormComponentV2",["UWA/Core","UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/MPFView/FieldTextInput","DS/MPFServices/ObjectService","DS/MPFBankAccountModel/BankAccountModel","DS/MPFError/BadArgumentError","DS/MPFError/ValidationError","i18n!DS/MPFBankAccountFormComponent/assets/nls/BankAccountFormComponent","css!DS/MPFUI/MPFUI"],function(c,b,d,e,g,h,f,j,i,k){var a=b.extend({className:"mpf-bank-account-form",setup:function(l){l=l||{};h.requiredOfPrototype(l.bankAccount,f,"BankAccountFormComponent expects options.bankAccount to be a BankAccountModel");this.bankAccount=l.bankAccount;if(c.is(l.constraints,"object")){this.bankAccountConstraints=l.constraints}else{if(c.is(this.bankAccount.constraints,"object")){this.bankAccountConstraints=this.bankAccount.constraints}else{throw new j("Constraints were not found in BankAccountModel")}}this.country=l.bankAccount.get("country");if(!c.is(this.country,"string")){throw new j("The country attribute in the passed BankAccountModel has to be set before creating the BankAccountFormComponentV2","BankAccountFormComponentV2",42)}this.readOnly=l.readOnly||false;this.alert=this._createAlert();this.inputs=this._createInputs();this.buttonContainer=this._createButtonContainer()},render:function(){var m=[];for(var l=0;l<this.inputs.length;l++){m.push(this.inputs[l].render())}this.container.setContent([this.alert,{tag:"div","class":"mpf-bank-account-form-input-container",html:m},this.buttonContainer]);return this},destroy:function(){this.stopListening();this.bankAccount=null;this.bankAccountConstraints=null;this.country=null;for(var l=0;l<this.inputs.length;l++){this.inputs[l].destroy();this.inputs[l]=null}this._parent();this.container=null},savePromise:function(){var l=this;if(this._validateInputs()){this.saveButton.load(true);return this.bankAccount.savePromise(this._getCurrentValues()).then(function(){l.alert.add({className:"success",message:k.get("bankAccountSaved")});l.saveButton.load(false);l.saveButton.disable();l.setReadOnly(true)})["catch"](function(m){var n=m.response&&m.response.errorMsg?m.response.errorMsg:m;console.error(n);l.alert.add({className:"error",message:k.get("saveFailure")});l.saveButton.load(false);return n})}else{this.alert.add({className:"error",message:k.get("saveFailure")});this.saveButton.load(false);return c.Promise.reject(new i(k.get("validationFailure")))}},setReadOnly:function(l){this.readOnly=l;this.buttonContainer=this._createButtonContainer();this.inputs.forEach(function(m){m.setDisabled(l)});this.render()},_onChange:function(){if(!this.readOnly){this._validateFilledInputs();if(this._validateModel()){this.saveButton.enable()}else{this.saveButton.disable()}}},_createAlert:function(){return new d({visible:true,autoHide:true,hideDelay:3000})},_createButtonContainer:function(){var l=c.createElement("div",{"class":"mpf-commands"});if(!this.readOnly){this.saveButton=new e({className:"primary",value:k.get("Save"),disabled:true,events:{onClick:this.savePromise.bind(this)}}).inject(l)}return l},_createInputs:function(){var l=[];var q=this;var n=this._getBankAccountConstraints();if(!c.is(n)||n.keys().length===0){return}var p=n.getConstraintKeyNames();for(var o=0;o<p.length;o++){var r=p[o];if(q.bankAccount.get(r)!==undefined){var m=new g({model:q.bankAccount,fieldName:r,fieldLabel:k.get(r),required:true,readOnly:q.readOnly,dynamicValidation:true,force:true,saveOnChange:false,silent:false});q.listenTo(m,"update",function(){q._onChange()});l.push(m)}}return l},_getBankAccountConstraints:function(){var l=this.bankAccountConstraints.get(this.country);return l||this.bankAccountConstraints.get("DEFAULT")},_validateInputs:function(){for(var l=0;l<this.inputs.length;l++){if(c.is(this.inputs[l].validate())){return false}}return true},_validateFilledInputs:function(){var n=true;for(var m=0;m<this.inputs.length;m++){var l=this.inputs[m].fieldName;var o=this.bankAccount.get(l);if(c.is(o,"string")&&o.length>0){if(c.is(this.inputs[m].validate())){n=false}}}return n},_validateModel:function(){var l=this.bankAccount.validate(this._getCurrentValues());if(c.is(l)&&l.length>0){return false}else{return true}},_getCurrentValues:function(){var l={};for(var n=0;n<this.inputs.length;n++){var m=this.inputs[n].fieldName;var o=this.bankAccount.get(m);l[m]=o}return l}});return a});