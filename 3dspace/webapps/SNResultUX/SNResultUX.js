/*!  COPYRIGHT DASSAULT SYSTEMES 2014   */
define("DS/SNResultUX/utils/FederatedSearch_parse",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(h,i,f,a,c,e,d,j){var g={};var b=i.extend(f,{name:"DS_SNResultUX_utils_FederatedSearch_parse",response_infos:{},results:[],summaryData:[],tagsData:{},ids:[],isReady:false,_isRecentSearch:false,_sourceErrorCodeToFilter:["FS_SOURCE_UNREACHABLE__DNS_UNKNOWN_HOST","FS_SOURCE_UNREACHABLE__TIMEOUT","FS_SOURCE_UNREACHABLE__HTTP_NOT_FOUND","FS_AUTHENTICATION_ERROR__FORBIDDEN"],init:function(k){this.setDebugMode(c.getDebugMode());this._tenant=k.tenant;if(c.getOption("internalProd")){this._sourceErrorCodeToFilter.push("FS_AUTHENTICATION_ERROR")}this._isRecentSearch=k.isRecentSearch;this.results=[];this.response_infos=k.federated_response.infos;this.summaryData=k.federated_response.facets;if(UWA.is(k.federated_response.results)){this._parse(k.federated_response.results)}this.isReady=true},getUserLevelAlerts:function(){a.log("getUserLevelAlerts on federated service parse");var t=[];var n={};if(UWA.is(this.response_infos.sources)){for(var z=0;z<this.response_infos.sources.length;z++){var k=this.response_infos.sources[z];var y=j.get(k.name+".displayName");if(!h.is(y)||0>=y.length){y=k.name}var v=new Error();var x=(h.is(v)&&h.is(v.stack))?v.stack:"";var m={};var B="";if(h.is(k.error)){if(h.is(k.error.errorCode)&&(true===this.debugMode||k.name==="3dspace"||k.name==="drive"||k.name==="scientificreferential"||k.name==="dashboard")){if("FS_AUTHENTICATION_ERROR"===k.error.errorCode&&k.error.errorMessage.indexOf("User has no preferred Security Context")>-1){m.message=j.get("FS_AUTHENTICATION_ERROR_UserHasNoPreferredSecurityContext");B+=j.get("FS_AUTHENTICATION_ERROR_UserHasNoPreferredSecurityContext")}else{m.errorCode=k.error.errorCode;m.nlsErrorCode=j.get(k.error.errorCode+".code");m.message=j.get(k.error.errorCode+".message");var l=j.get(k.error.errorCode+".code");var q=j.get(k.error.errorCode+".message");if(l!==k.error.errorCode+".code"){B+=j.replace(j.get("error_code"),{errorCode:l});m.nlsErrorCode=j.replace(j.get("error_code"),{errorCode:l})}else{B+=j.replace(j.get("error_code"),{errorCode:k.error.errorCode});m.nlsErrorCode=j.replace(j.get("error_code"),{errorCode:k.error.errorCode})}if(q!==k.error.errorCode+".message"){B+="<br>"+j.replace(j.get("error_msg"),{errorMessage:q});m.message=j.replace(j.get("error_msg"),{errorMessage:q})}else{if(h.is(k.error.errorMessage)){B+="<br>"+j.replace(j.get("error_msg"),{errorMessage:k.error.errorMessage});m.message=j.replace(j.get("error_msg"),{errorMessage:k.error.errorMessage})}}}}}if(k.status===false){if(h.is(k.error)){if(!h.is(k.error.errorCode)||-1===this._sourceErrorCodeToFilter.indexOf(k.error.errorCode)){if(!h.is(n[k.error.errorCode])){n[k.error.errorCode]={};if(true===this.debugMode){n[k.error.errorCode].message=B}else{n[k.error.errorCode].message=m.message}n[k.error.errorCode].messageObj=m}if(!h.is(n[k.error.errorCode].listDataSourcesHavingThisError,"array")){n[k.error.errorCode].listDataSourcesHavingThisError=[]}n[k.error.errorCode].listDataSourcesHavingThisError.push(y)}}}else{if(c.getOption("alert_on_sucess")===true){B=j.replace(j.get("fetch_succeed"),{displayName:y,message:B});t.push({className:"info",message:B})}}}if(h.is(n)){var r=Object.getOwnPropertyNames(n);if(h.is(r,"array")&&r.length>0){for(var A=0,p=r.length;A<p;A++){var w=n[r[A]];if(h.is(w,"object")&&h.is(w.listDataSourcesHavingThisError,"array")&&h.is(w.message,"string")){var u=w.listDataSourcesHavingThisError.join(",");B=j.replace(j.get("fetchFailure_partial_answer"),{displayName:u,message:w.message});t.push({className:"warning",message:B,messageObj:w.messageObj,dataSources:u})}}}}}else{var o={message:j.get("No_Source_Found"),className:"error"};t.push(o)}return t},getMatches:function(){if(UWA.is(this.response_infos)&&UWA.is(this.response_infos.nmatches)){return parseInt(this.response_infos.nmatches)}else{if(UWA.is(this.response_infos)&&UWA.is(this.response_infos.nhits)){return parseInt(this.response_infos.nhits)}else{return 0}}},getTags:function(){return{tagsData:this.tagsData,summaryData:this.summaryData}},getResults:function(){return this.results},getAttributesDefinition:function(){return g},getIds:function(){return this.ids},_parse:function(o){a.log("Parse the federated result");var x,p;if(h.is(c)&&h.is(c._tenantSettings)&&h.is(c._tenantSettings[this._tenant])&&h.is(c._tenantSettings[this._tenant].search_settings)){x=c._tenantSettings[this._tenant].search_settings}if(h.is(x,"object")&&h.is(x.defaultDateMode,"object")&&h.is(x.defaultDateMode.id,"string")){p=x.defaultDateMode}else{p={id:"basedOnLanguagePreference"}}var w=[],q=[],l={},r=this,m="Warning:Flattening",n="Warning:JPO",v=d.getRegion(),k=(h.is(e.dateDisplayMode,"object")&&h.is(e.dateDisplayMode.id,"string"))?e.dateDisplayMode:p,t=d.getLanguage(),y=c.getOption("dateFormatOption");if(k.id!=="basedOnAdminPreference"&&k.id!=="basedOnLanguagePreference"){t=k.value;y=k.options}else{if(k.id==="basedOnAdminPreference"){if(h.is(p,"object")&&h.is(p.id)&&p.id!=="basedOnLanguagePreference"){t=p.value;y=p.options}}}if(h.is(v)&&v.length>0){if(v.indexOf("-")>-1){t=v}else{t+="-"+v}}var u=0;if(c.getOption("timeZoneOffset")){u=parseInt(c.getOption("timeZoneOffset"));if(!Number.isInteger(u)){u=0}else{u*=60000}}o.forEach(function(A){var z={isRecentSearchResult:r._isRecentSearch},C=[],D="",H="",E="",B="",F="",I="";r._updateSnippetWithMarker(A);var G=A.attributes;G.forEach(function(Q){if(m===Q.value||n===Q.value){return}var J=Q.value,X=h.is(Q.dispValue)?Q.dispValue:Q.value;if((h.is(Q.format)&&Q.format==="snippet")&&(h.is(Q.type)&&Q.type==="text")&&(h.is(Q.text)&&h.is(Q.text,"array"))){J=JSON.stringify(Q)}var R=h.is(Q.type,"string")?Q.type.toLowerCase():"unknown_type";if((!h.is(Q.format)||Q.format!=="internal"||Q.type==="string")&&h.is(Q.value,"string")){if("ds6w:description"===Q.name&&X.indexOf("<br />")>-1){X=d.stripHtml(X)}else{X=d.escapeHtml(X)}}if("date"===R||Q.name==="ds6w:created"||Q.name==="ds6w:modified"){var T=Date.parse(J);if(isNaN(T)){X=J}else{var P=new Date(T+u);try{X=P.toLocaleString(t,y)}catch(O){console.warn("Error parsing date !",T,t,y);try{X=P.toLocaleString(d.getLanguage())}catch(O){console.warn("Error parsing date with current language!",T,d.getLanguage());X=P.toLocaleString()}}X=X.replace(",","")}}if(Q.name==="resourceid"){z.id=J}else{if(Q.name==="ds6w:when/ds6w:modified"){D=J}else{if(Q.name==="ds6w:modified"){H=J}else{if(Q.name==="ds6w:when/ds6w:created"){E=J}else{if(Q.name==="ds6w:created"){B=J}else{if(Q.name==="ds6w:type"){F=J}else{if(Q.name==="ds6w:what/ds6w:type"){I=J}else{if(Q.name==="ds6w:where/ds6w:source/ds6w:dataSource"){Q.type="string"}}}}}}}}var K=Q.name.match(/\/([^/]*)$/);if(h.is(K,"array")&&K.length>1){K=K[1]}else{K=Q.name}g[K]={type:h.is(Q.type,"string")?Q.type.toLowerCase():null,URI:Q.name,format:Q.format};if(Q.format==="ds6w_facet"){var W={object:h.clone(J),sixw:Q.name,field:Q.field,type:Q.type};if(typeof X==="undefined"||X===""){W.dispValue=h.clone(J)}else{W.dispValue=h.clone(X)}C.push(W)}if(z[Q.name]!==undefined){if(!(z[Q.name] instanceof Array)){var N=z[Q.name];z[Q.name]=[];z[Q.name].push(N);var U=z[Q.name+"_value"];z[Q.name+"_value"]=[];z[Q.name+"_value"].push(U)}if(typeof X==="undefined"||X===""){z[Q.name].push(J)}else{z[Q.name].push(X)}z[Q.name+"_value"].push(J)}else{if(h.is(X,"array")){z[Q.name]=[h.clone(J)];z[Q.name+"_value"]=[h.clone(J)]}else{if(typeof X==="undefined"||X===""){z[Q.name]=h.clone(J)}else{z[Q.name]=h.clone(X)}z[Q.name+"_value"]=h.clone(J)}}var V=null;if(Q.format==="ds6w"){V=Q.name.replace("ds6w:","")}else{if(Q.format==="ds6w_facet"&&Q.field!==undefined){V=Q.field.toLowerCase()}}var S=Q.name.lastIndexOf("/");if(S>=0){var K=Q.name.slice(Q.name.lastIndexOf("/")+1,Q.name.length);if(h.is(K)&&K.length){z[K]=z[Q.name];z[K+"_value"]=z[Q.name+"_value"]}}if(V!==null){if(z[V]!==undefined){if(!(z[V] instanceof Array)){var L=z[V];z[V]=[];z[V].push(L);var M=z[V+"_value"];z[V+"_value"]=[];z[V+"_value"].push(M)}if(typeof X==="undefined"||X===""){z[V].push(J)}else{z[V].push(X)}z[V+"_value"].push(J)}else{if(typeof X==="undefined"||X===""){z[V]=J}else{z[V]=X}z[V+"_value"]=J}}});if(D.length===0&&H.length>0){}else{if(D.length>0&&H.length===0){z["ds6w:modified"]=z["ds6w:when/ds6w:modified"];z["ds6w:modified_value"]=z["ds6w:when/ds6w:modified_value"]}}if(E.length===0&&B.length>0){}else{if(E.length>0&&B.length===0){z["ds6w:created"]=z["ds6w:when/ds6w:created"];z["ds6w:created_value"]=z["ds6w:when/ds6w:created_value"]}}if(F.length>0&&0===I.length){z["ds6w:what/ds6w:type"]=z["ds6w:type"];z["ds6w:what/ds6w:type_value"]=z["ds6w:type_value"]}if(UWA.is(z.id,"string")&&z.id.length>0){l[d.getTaggerSubject({id:z.id,source:z.sourceid_value})]=C;w.push(z);q.push(z.id)}else{a.log("Invalid result object "+JSON.stringify(A))}});this.tagsData=l;this.results=w;this.ids=q},_encryptSnippetForUX:function(l){var k="";l.forEach(function(m){if(h.is(m.highlighted)&&(m.highlighted=="true")){k+="\u21A6"}if(h.is(m.content)){k+=m.content}if(h.is(m.highlighted)&&(m.highlighted=="true")){k+="\u21A4"}k+=" "});return k},_updateSnippetWithMarker:function(m){var n=this;var l=m.attributes;var k;l.forEach(function(p){if((h.is(p.format)&&p.format==="snippet")&&(h.is(p.name)&&p.name==="snippet")&&h.is(p.text,"array")){k=n._encryptSnippetForUX(p.text)}});if(UWA.is(k,"string")&&k.length>0){k=k.split("*").join("");var o=false;l.forEach(function(p){if((false==o)&&(h.is(p.name)&&(p.name==="snippet")||p.name==="snippet_value")){p.value=k;o=true}});if(!o){m.attributes=m.attributes.concat({format:"attribute",name:"snippet",type:"string",value:k},{format:"attribute",name:"snippet_value",type:"string",value:k})}}return m}});return b});function SNResultMgt_Wdg(b){var a={widget:null,resources:null,searchcom_socket:null,pcs_uuid:null,_searchCom:null,events:{},css_view_class:"windowed",optionsInitDone:null,eventsRegistered:null,snTabManager:undefined,_widget_launch_mode:null,init:function(d){var c=this;this._widget_launch_mode="";this.eventsRegistered=false;this.optionsInitDone=false;c.pcs_uuid=Math.floor((Math.random()*100000)+1).toString();c.widget=d.widget;if(c.widget.data.reSearch){this.widget.setValue("tag_filter",c.widget.data.reSearch)}if(d.events&&d.events.onSNResultWdg_Ready){c.events.onSNResultWdg_Ready=d.events.onSNResultWdg_Ready}c.widget.addEvent("onLoad",c.onLoad,c);c.widget.addEvent("onResize",c.onResize,c);c.widget.addEvent("onViewChange",c.onViewChange,c);if(c.widget.body){c.widget.body.setStyle("transform","translateZ(0)")}c.widget.setMetas({helpPath:"SNResultUX/assets/help"});this.snTabManager=null},onResize:function(){var c=this;clearTimeout(c.resizeEventId);c.resizeEventId=setTimeout(function(){if(c.searchcom_socket){c.searchcom_socket.dispatchEvent("widgetResize")}},100)},onDestroy:function(){var c=this;c.widget.removeEvent("onLoad",c.onLoad,c);c.widget.removeEvent("onResize",c.onResize,c);c.widget.removeEvent("onViewChange",c.onViewChange,c);c.widget.removeEvent("onRefresh",c.onRefresh,c);c.widget.removeEvent("onSearch",c.onSearch,c);c.widget.removeEvent("onResetSearch",c.onResetSearch,c);if(UWA.is(c.snTabManager)){c.widget.removeEvent("onSearchWithOpts",c.snTabManager.onSearch,c.snTabManager);c.widget.removeEvent("onViewChangeResults",c.snTabManager._onViewChange,c.snTabManager)}c.widget.removeEvent("endEdit",c.onEndEdit,c);if(this.searchcom_socket!==null){this.searchcom_socket.removeListener("onSearchFromCompassInit");this.searchcom_socket.removeListener("setSelectedSource");this.searchcom_socket.removeListener("onSearchWdgUpd");this.searchcom_socket.removeListener("showAdvancedSearch");this.searchcom_socket.removeListener("hideAdvancedSearch");this.searchcom_socket.dispatchEvent("onResetMyRecent");this.searchcom_socket.dispatchEvent("onDestroyWidget",{widget_id:this.widget.id},["searchtopbar_socket_id"]);this.searchcom_socket.disconnect();if(UWA.is(this._searchCom)){this._searchCom.deleteSocket(this.searchcom_socket.id)}this.searchcom_socket=null}if(this.snTabManager){this.snTabManager.destroy();this.snTabManager=null}this.resources=null;this.widget.setValue("tag_filter","");this.widget=null},onLoad:function(){this.resources=this.widget.getValue("search_ressources");var e=this;e.widget.setValue("search_wdg_id",e.widget.id);var d=!UWA.is(this.resources),c=UWA.is(this.resources,"string")&&this.resources.length<1;if(d||c){require(["DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchUtils"],function(i,h){if(true===d){e.widget.setValue("transient_context","true");e._widget_launch_mode=h.widgetLaunchMode.COMPASS_TRANSIENT}else{if(true===c){e._widget_launch_mode=h.widgetLaunchMode.COMPASS_PINNED}}e._searchCom=i;e.searchcom_socket=i.createSocket({socket_id:"widget_socket_"+e.widget.id,widgetId:e.widget.id});e.searchcom_socket.addListener("onSearchFromCompassInit",function(j){if(false===e.optionsInitDone){console.log("init to do for 3DSearch from compass...");e.widget.setValue("search_ressources",j.ressources);e.resources=e.widget.getValue("search_ressources");e.widget.setValue("activeTenant",j.ressources.active_tenant);e.optionsInitDone=true;e.afterResourcesInit()}else{console.log("init DONE for 3DSearch from compass...")}});var f;if(UWA.is(e.widget)&&UWA.is(e.widget.getValue("source"))){var g=e.widget.getValue("source");if(UWA.is(g)&&g.length){if(g[0]==="swym"){if(e.widget.context){f=e.widget.context}}}}e.searchcom_socket.dispatchEvent("onWdgCreation",{widget_id:e.widget.id,tabid:f,transient_widget:false},["searchtopbar_socket_id"]);e.searchcom_socket.dispatchEvent("onSearchFromCompass",{widget_id:e.widget.id,x3dPlatformId:e.widget.data.x3dPlatformId,mode:d?"maximized":"windowed"},["searchtopbar_socket_id"])})}else{require(["DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings"],function(g,h){e._widget_launch_mode=g.widgetLaunchMode.TOPBAR_SEARCH;if(UWA.is(e.widget)){var f=e.widget.getValue("customization_options");var i=g.identifyClientInfo();if(i.identifier==="3DSwym"){e._widget_launch_mode=g.widgetLaunchMode.TOPBAR_SEARCH}else{if(UWA.is(f,"object")&&(UWA.is(f.app_socket_id,"string")||UWA.is(f.precond,"string"))){e._widget_launch_mode=g.widgetLaunchMode.INCONTEXT_TRANSIENT}else{if(UWA.is(e.widget.context)&&e.widget.context!="transient"){e._widget_launch_mode=g.widgetLaunchMode.PINNED}}}}e.optionsInitDone=true;e.afterResourcesInit()})}},afterResourcesInit:function(){var c=this,d=this.widget.getValue("settings_topbar");var f=false;if((typeof(d)==="string")&&d.length){try{d=JSON.parse(d)}catch(g){console.log("Cannot parse Topbar Settings from the preferences: "+g.toString())}}else{f=true}require(["UWA/Drivers/Alone","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/WebappsUtils/Performance"],function(i,h,j,e){e.mark('{"module":"DS/SNResultUX/SNResultUX", "name":"SNResultMgt_Wdg init","uuid":"'+c.pcs_uuid+'","drilldown":"OneSearch SNResultMgt_Wdg Init"}');e.mark('{"module":"DS/SNResultUX/SNResultUX", "name":"load_amd","uuid":"'+c.pcs_uuid+'","status":"start","drilldown_serie_id":"OneSearch SNResultMgt_Wdg Init"}');require(["DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/UIKIT/Mask","DS/UIKIT/SuperModal","DS/SNInfraUX/SearchRessources","DS/SNResultUX/SNTabbedResultMgt","DS/SNInfraUX/PredicatesNLS"],function(p,q,B,o,l,n,y,x){e.mark('{"module":"DS/SNResultUX/SNResultUX","name":"load_amd","uuid":"'+c.pcs_uuid+'","status":"end","drilldown_serie_id":"OneSearch SNResultMgt_Wdg Init"}');e.mark('{"module":"DS/SNResultUX/SNResultUX","name":"Preparing_Instantiation_new_SNResultMgt","uuid":"'+c.pcs_uuid+'","status":"start","drilldown_serie_id":"OneSearch SNResultMgt_Wdg Init","drilldown":"Preparing_Instantiation_new_SNResultMgt_Detail"}');e.mark('{"module":"DS/SNResultUX/SNResultUX","name":"SearchSettings.initialize","uuid":"'+c.pcs_uuid+'","status":"start","drilldown_serie_id":"Preparing_Instantiation_new_SNResultMgt_Detail"}');if(UWA.is(d)&&UWA.is(d.search_settings)){if(UWA.is(d.search_settings.topframe_search_delegation)){delete d.search_settings.topframe_search_delegation}if(c._widget_launch_mode===q.widgetLaunchMode.PINNED){delete d.search_settings.servicesData}}p.initialize(d);if(c._widget_launch_mode===q.widgetLaunchMode.PINNED){if(q.isInTheSimpleSearch()===true){p.changeSettingForBETA()}else{p.changeSettingForFD01()}}var m=c.widget.getValue("transient_context");e.mark('{"module":"DS/SNResultUX/SNResultUX","name":"SearchSettings.initialize","uuid":"'+c.pcs_uuid+'","status":"end","drilldown_serie_id":"Preparing_Instantiation_new_SNResultMgt_Detail"}');e.mark('{"module":"DS/SNResultUX/SNResultUX","name":"SearchCom init","uuid":"'+c.pcs_uuid+'","status":"start","drilldown_serie_id":"Preparing_Instantiation_new_SNResultMgt_Detail"}');require(["DS/SNInfraUX/SearchCom"],function(F){c._searchCom=F;if(!UWA.is(c.searchcom_socket)){c.searchcom_socket=F.createSocket({socket_id:"widget_socket_"+c.widget.id,widgetId:c.widget.id})}c.searchcom_socket.addListener("setSelectedSource",function(G){if((true===m||(UWA.is(c.widget._view)&&UWA.is(c.widget._view)&&UWA.is(c.widget._view.type)&&("maximized"===c.widget._view.type||"sidepanel"===c.widget._view.type)))){if(UWA.is(G)&&UWA.is(G.value)&&G.value!=="3DDashboard"){var H=c.widget.getValue("search_ressources");H.active_tenant=G.value;c.widget.setValue("search_ressources",H);c.widget.setValue("activeTenant",G.value);G.update_tab=false;if(UWA.is(c.snTabManager)){c.snTabManager.setActiveTenant(G)}}}});c.searchcom_socket.addListener("onSearchWdgUpd",function(L){if(UWA.is(L,"object")&&UWA.is(L.refine)){L.tag_filter=L.refine;L.refresh=false}if(m==="true"||c._isAmMaximized(L.active_tab)){if(L.value===q.SearchTypeEnum.FAVORITE_SEARCH){L.savedSearch=true;L.searchStringToDisplayInSearchField=B.get("my_fav_searches");L.resetLocalFilter=true;L.queryType=q.SearchTypeEnum.FAVORITE_SEARCH}var K=true;if(h.is(c.snTabManager)&&h.is(L.searchType)&&L.searchType==="#advancedSearch"&&h.is(L.adv_search_field)&&L.adv_search_field.length!==0){var I=c.snTabManager.getActiveAdvSearchMgr();if(h.is(I)&&p.options.search_settings.taggerClosed===false){K=false}}if(K===true){var N="SearchComServer_"+c.widget.id;if(h.is(arguments)){if(arguments.length>0&&h.is(arguments[1])&&h.is(arguments[1].origin)&&h.is(arguments[1].origin.server)){if(c.widget.id.indexOf("preview")!==-1||c.widget.id.indexOf("odt")!==-1){N="SearchComServer"}var M=q.identifyClientInfo();if(M.identifier==="3DSwym"){N="SearchComServer"}var J=arguments[1].origin.server;K=false;if(N===J){K=true}}}}if(K===true){if(h.is(c.snTabManager)&&c.snTabManager.navhistorycontextifcreateaNewTab()===true){L.removeHistory=true;if(h.is(L.searchType)&&L.searchType==="#advancedSearch"){c.widget.dispatchEvent("onSearch",L);if(UWA.is(c.widget.getValue("addinmode"),"string")){require(["DS/TransientWidget/TransientWidget"],function(O){O.showWidget(q.SEARCH_APP_ID,"",{})})}}else{var H=new l({renderTo:document.body,className:"WarningNewSearch"});H.confirm(B.get("relation.NewSearch.warning"),B.get("relation.NewSearch.warningTitle"),function(O){if(true===O){c.widget.dispatchEvent("onSearch",L);if(UWA.is(c.widget.getValue("addinmode"),"string")){require(["DS/TransientWidget/TransientWidget"],function(P){P.showWidget(q.SEARCH_APP_ID,"",{})})}}})}}else{var G=function(){c.widget.dispatchEvent("onSearch",L);if(UWA.is(c.widget.getValue("addinmode"),"string")){require(["DS/TransientWidget/TransientWidget"],function(O){O.showWidget(q.SEARCH_APP_ID,"",{})})}};if(L.active_tenant!=c.snTabManager.getActiveTab().getActiveTenant()){if(!c.snTabManager.isTabBarVisible()){c.snTabManager.removeTab(c.snTabManager.getActiveTab().getTabID())}c.snTabManager.addTab({search_ux_options:{events:{onReady:G}}})}else{G()}}}}});c.searchcom_socket.addListener("showAdvancedSearch",function(H){if(h.is(c.snTabManager)){var G=c.snTabManager.getActiveTab();if(UWA.is(G)){G.showAdvancedSearch(H)}}});c.searchcom_socket.addListener("hideAdvancedSearch",function(){if(h.is(c.snTabManager)){var G=c.snTabManager.getActiveTab();if(UWA.is(G)){G.hideAdvancedSearch()}}});var C;if(h.is(c.widget)&&h.is(c.widget.getValue("source"))){var D=c.widget.getValue("source");if(h.is(D,"array")&&D.length){if(D[0]==="swym"){if(c.widget.context){C=c.widget.context}}}}c.searchcom_socket.dispatchEvent("onWdgCreation",{widget_id:c.widget.id,tabid:C,transient_widget:m},["searchtopbar_socket_id"]);if(!f){if(c.widget){var E=c.widget.getValue("customization_options");if(UWA.is(E,"object")){if(false===E.default_with_precond){c.searchcom_socket.dispatchEvent("onSetFocusInSearchField",{},["searchtopbar_socket_id"])}}}}e.mark('{"module":"DS/SNResultUX/SNResultUX","name":"SearchCom init","uuid":"'+c.pcs_uuid+'","status":"end","drilldown_serie_id":"Preparing_Instantiation_new_SNResultMgt_Detail"}')});c.widget.setValue("appId",q.SEARCH_APP_ID);c.widget.setValue("stayOnSearch","true");c.widget.setValue("transient_context","false");c.widget.setValue("search_wdg_id",c.widget.id);if(m==="true"||m===true){c.css_view_class="maximized"}try{if(!UWA.is(c.searchResources)){c.searchResources=new n(c.resources)}}catch(r){console.log("SearchRessources not initialized!")}var u=c.widget.getValue("customization_options");if(UWA.is(u)&&UWA.is(u.mode)){var w=h.clone(u);delete w.mode;c.widget.setValue("customization_options",w)}var A=c._getOriginalSearchOpts();var z=(m==="false"||m===false)&&UWA.is(A)?A:c._getSearchOpts();var k=undefined;if(UWA.is(c.widget.getValue("pinToDashboard"))){k=c.widget.getValue("pinToDashboard")}c.widget.setValue("launch_mode",c._widget_launch_mode);var v={search_options:z,result_ux_customization:c.widget.getValue("result_ux_customization"),viewData:c.widget.getValue("viewData"),in_apps_search:u,events:{onReady:function(){if(UWA.is(c.widget._view)&&c.widget._view.type==="maximized"&&p.options.search_settings.taggerClosed===false){if(((UWA.is(window)&&UWA.is(window.innerWidth))?window.innerWidth>958:true)&&(UWA.is(c.widget.getValue("addinmode"),"string")?["solidworks","catiav5"].indexOf(c.widget.getValue("addinmode"))===-1:true)&&["iphone","ipad","android"].indexOf(q.getDeviceCategory())===-1&&p.getOption("search_compact_mode")===false&&p.options.search_settings.taggerClosed!=true){if(p.getOption("no_TopFrame_ODT")!==true){var C="DS/TopFrame/TopFrame";require([C],function(D){var E=false;if(UWA.is(D)){try{if(UWA.is(D.isTaggerVisible,"function")&&true===D.isTaggerVisible()){E=true}}catch(F){if(h.is(D._isTaggerVisible)&&true===D._isTaggerVisible){E=true}console.log(F)}}if(false===E){c.searchcom_socket.dispatchEvent("openTagger");q.setTaggerOpenedByCode(true)}})}}}if(false===c.eventsRegistered){c.eventsRegistered=true;c.widget.addEvent("onRefresh",c.onRefresh,c);c.widget.addEvent("onSearch",c.onSearch,c);c.widget.addEvent("onResetSearch",c.onResetSearch,c);c.widget.addEvent("onSearchWithOpts",c.snTabManager.onSearch,c.snTabManager);c.widget.addEvent("onViewChangeResults",c.snTabManager._onViewChange,c.snTabManager);c.widget.addEvent("endEdit",c.onEndEdit,c);if(UWA.is(c.events.onSNResultWdg_Ready,"function")){c.events.onSNResultWdg_Ready.call(null)}}e.mark('{"module":"DS/SNResultUX/SNResultUX","name":"new SNResultMgt","uuid":"'+c.pcs_uuid+'","status":"end","drilldown_serie_id":"Preparing_Instantiation_new_SNResultMgt_Detail"}');e.mark('{"module":"DS/SNResultUX/SNResultUX","name":"Preparing_Instantiation_new_SNResultMgt","uuid":"'+c.pcs_uuid+'","status":"end","drilldown_serie_id":"SNResultMgt init"}')}}};e.mark('{"module":"DS/SNResultUX/SNResultUX","name":"new SNResultMgt","uuid":"'+c.pcs_uuid+'","status":"start","drilldown_serie_id":"Preparing_Instantiation_new_SNResultMgt_Detail","drilldown":"SNResultMgt::init"}');if(!UWA.is(c.snTabManager)){var t={widget_id:c.widget.id,launch_mode:c._widget_launch_mode,resources:c.resources,itemViewClickHandler:c.widget.getValue("itemViewClickHandler"),source:c.widget.getValue("source"),addinMode:c.widget.getValue("addinmode"),updateTitle:function(C){if(UWA.is(c.widget)){c.widget.setTitle(C)}},transient_context:m,use_preexisting_call:c.widget.getValue("use_preexisting_call"),update_preference:function(C,D){if(c.widget){c.widget.setValue(C,D)}},css_view_class:c.css_view_class};if(h.is(c.widget)&&h.is(c.widget.metas)&&h.is(c.widget.metas.description,"string")&&c.widget.metas.description.contains("3DSwym")){t.swymContext=true;if(UWA.is(u,"object")){t.in_apps_search=u}}if(UWA.is(c.widget.getValue("tagger_context_id"))){t.tagger_context_id=c.widget.getValue("tagger_context_id")}var k=undefined;if(UWA.is(c.widget.getValue("pinToDashboard"))){t.pinToDashboard=c.widget.getValue("pinToDashboard")}c.snTabManager=new y(t);c.widget.setBody(c.snTabManager)}c.snTabManager.addTab({search_ux_options:v})})})},onSearch:function(c){if(!UWA.is(c)){throw new Error("Invalid arg in SNResultUX.onSearch!)")}if(UWA.is(this.snTabManager)&&UWA.is(this.snTabManager.getOption,"function")){if(this.snTabManager.getOption("transient_context")==="false"||this.snTabManager.getOption("transient_context")===false){if(!this._getOriginalSearchOpts()){this._setOriginalSearchOpts(this._getSearchOpts())}}}if(UWA.is(c.value)){this._onSearch.call(this,c)}else{var d=this;require(["DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredefinedQueries","DS/SNResultUX/utils/WildcardMgr"],function(g,f,e){if(!(g.getsearchType()===g.SearchTypeEnum.SEARCH_IN)){return}g.executeWithPQ({wait:function(){if(c&&c.indexOf(":")>0){f.fetchPQsFromServer(d.searchResources);return true}},run:function(){var h=e.manageWildcardAddtion(c);h=g.replacePQsWithCVPrefixes(h);d._onSearch({value:h,searchStringToDisplayInSearchField:c,searchInCriteria:h})}})})}},_onSearch:function(h){this.widget.setValue("search_criteria",h.value);this.widget.setValue("search_criteria_to_display",h.searchStringToDisplayInSearchField);this.widget.setValue("adv_search",h.adv_search);this.widget.setValue("advanced_criteria",h.advanced_criteria);this.widget.setValue("adv_search_field",h.adv_search_field);this.widget.setValue("tag_filter",h.tag_filter?h.tag_filter:"");this.widget.setValue("recent_filter",UWA.is(h.sFilter)?h.sFilter:"*");this.widget.setValue("queryType",UWA.is(h.queryType)?h.queryType:null);if(UWA.is(h.source)){this.widget.setValue("source",h.source)}var c=false;if(UWA.is(this.snTabManager)){var e=this.snTabManager.getActiveTaggerProxy();var f=null;if(UWA.is(e)){f=e.getCurrentFilter()}var d=null;if(UWA.is(f)){d=f.allfilters}if(UWA.is(f)&&UWA.is(d)&&Object.keys(d).length!==0){c=true}}if(!h.adv_search||!c){var i={};if(UWA.is(h)){i=UWA.clone(h)}i.refresh=(UWA.is(h.refresh))?h.refresh:true;var g=this._getSearchOpts(i);if(h.customization_options){g.in_apps_search=h.customization_options}this.widget.dispatchEvent("onSearchWithOpts",g)}this.widget.setValue("viewData",h.viewData)},onResetSearch:function(c){var d=this;var e=this._getOriginalSearchOpts();if(UWA.is(e)){d.widget.dispatchEvent("onSearchWithOpts",e)}},onRefresh:function(){if(this.snTabManager){this.snTabManager.onRefresh()}},onEndEdit:function(){if(UWA.is(this.snTabManager)){this.snTabManager.hideTabBar()}this.onLoad()},onViewChange:function(e){var d=require("DS/SNInfraUX/SearchUtils");if(e.type==="fullscreen"||e.type==="maximized"){if(e.height){this._setBodyHeight(e.height)}if(UWA.is(this.snTabManager)){var c=this.snTabManager.getActiveTaggerProxy();if(UWA.is(c)&&UWA.is(c.getDisplayStatus,"function")&&false===c.getDisplayStatus()){if(UWA.is(d)){d.setTaggerOpenedByCode(true)}this.searchcom_socket.dispatchEvent("openTagger")}}}else{this._setBodyHeight("100%");if(UWA.is(d)&&UWA.is(d.isTaggerOpenedByCode,"function")&&true===d.isTaggerOpenedByCode()){this.searchcom_socket.dispatchEvent("closeTagger");d.setTaggerOpenedByCode(false)}}if(this.searchcom_socket!==null){this.searchcom_socket.dispatchEvent("onViewChange",{widget_id:this.widget.id},["searchtopbar_socket_id"])}this.css_view_class=e.type;this.widget.dispatchEvent("onViewChangeResults",e)},_getSearchOpts:function(g){var f=false;var d=false;if(UWA.is(this.widget.getValue("advanced_criteria"))&&this.widget.getValue("advanced_criteria").length>0){f=true}if(UWA.is(this.widget.getValue("search_criteria"))&&(this.widget.getValue("search_criteria")==="#advancedSearch")){d=true}var c=this.widget.getValue("tag_filter");if(typeof c==="string"&&c.length>0){c=JSON.parse(c)}var e=this._getOriginalSearchOpts();if(UWA.is(g)&&g.searchType==="#search"&&UWA.is(e)){e.search_criteria=null}if(!d||(d&&!f)){return{search_criteria:this.widget.getValue("search_criteria"),adv_search:this.widget.getValue("adv_search"),search_criteria_to_display:this.widget.getValue("search_criteria_to_display"),advanced_criteria:d?undefined:this.widget.getValue("advanced_criteria"),recent_filter:this.widget.getValue("recent_filter"),source:this.widget.getValue("source"),search_mode:"index",tag_filter:c,refresh:UWA.is(g)?g.refresh:false,widget_search_criteria:(e&&!d)?e.search_criteria:undefined,order_by:this.widget.getValue("order_by"),order_field:this.widget.getValue("order_field"),searchInCriteria:UWA.is(g)?g.searchInCriteria:null,resetLocalFilter:UWA.is(g)?g.resetLocalFilter:null,queryType:UWA.is(g)?g.queryType:null,removeHistory:UWA.is(g)?g.removeHistory:false,addNewTab:UWA.is(g)?g.addNewTab:false}}else{return null}},_getOriginalSearchOpts:function(){var c=this.widget.getValue("original_search_options");if(UWA.is(c)){return{search_criteria:c.search_criteria,adv_search:c.adv_search,search_criteria_to_display:c.search_criteria_to_display,advanced_criteria:c.advanced_criteria,search_mode:c.search_mode,tag_filter:c.tag_filter,}}else{return null}},_setOriginalSearchOpts:function(c){this.widget.setValue("original_search_options",c)},_setBodyHeight:function(c){if(!UWA.is(c)){return}if(!isNaN(c)){c+="px"}this.widget.body.setStyle("height",c)},_isAmMaximized:function(c){if(!UWA.is(this.widget)){return}var d=false;if(this.widget.getView().type==="maximized"){d=true}if(UWA.is(c)&&UWA.is(this.widget.context)&&this.widget.context!="transient"){d=false;if(c===this.widget.context){d=true}}return d}};a.init(b);return a}define("DS/SNResultUX/collections/SearchCollection",["UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/Utilities/Utils","DS/WebappsUtils/Performance","DS/WebAppsFoundations/Collections/PageableCollection","DS/W3DXComponents/Collections/ActionsCollection","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/SNResultUX/models/SearchItemModel","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/FederatedSearch_parse","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess","UWA/Data","DS/WAFData/WAFData","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SNUnitConversion","DS/SNResultUX/utils/SearchCustoServices","DS/SNResultUX/utils/SearchServices","DS/i3DXSNDictionaryAPI/3DXSearchDictionaryAccess","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/SearchViewServices","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchVersioning","DS/SNResultUX/utils/ContentLocationServices","DS/Controls/TooltipModel","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/SNInfraUX/SWFiltering","DS/SNResultUX/utils/SearchTagsTransformation","DS/SNInfraUX/Logger"],function(A,i,g,C,o,b,j,v,p,h,z,L,B,F,u,J,f,q,e,m,d,r,H,a,n,k,I,x,D,E,G,l,y,w,t,K,c){return b.extend(i,g,u,{uwaClassName:"DS/SNResultUX/collections/SearchCollection",name:"DS_SNResultUX_collections_SearchCollection",model:h,totalCount:-1,snservices:"",search_ressources:null,service_parameters:null,_searchcom_socket:null,_search_in_progress:false,_fedSearchLabel:"",_pcs_uuid:0,_ctx_options:null,_attrToRetrieve:[],_attrDefinition:null,_recentCollectionArray:null,jetty_server_activated:false,sessionResponse:null,sessionResponse_received:false,_fedsearchResp:null,_fedsearchOptions:null,_predicateIntersection:null,_indexingDate:null,_snSkeleton:null,_treeDocument:null,_NLS_ds6wg:{},_isResponsive:true,_helperSubjectsTags:null,_helpertagValues:null,_CBOnComplete:null,_CBOnFailure:null,_failureView:false,_modelsTab:[],_tagsTransformer:null,defaultOptions:{mode:"data",state:{firstPage:0,lastPage:null,currentPage:0,pageSize:40,totalPages:null,totalRecords:null,sortKey:null,order:-1,tagsSet:0},queryParams:{currentPage:null,totalPages:null,totalRecords:null,pageSize:"nresults",}},_source:"",_required_predicates:["ds6w:modified","ds6w:created","ds6w:label","ds6w:identifier","ds6w:responsible","ds6w:type","ds6w:description","owner","ds6w:responsibleUid","ds6wg:filesize"],setup:function(N,O){var P=this;this.setOptions(O);P.generateTreeModel=C.debounce(function(){var S=J.getItem("activeLargeView")||(G.isActiveWithCurrentVersion({R2019x:"BETA2"})&&!J.getItem("deactiveLargeView"));var T=true;if(T){function R(Z){var W=Z.concat();for(var Y=0;Y<W.length;++Y){for(var X=Y+1;X<W.length;++X){if(W[Y]===W[X]){W.splice(X--,1)}}}return W}var V=x.getAllSelectClause(T);var U=R(P._required_predicates.concat(V));var Q=P.getNotLoadedPredicate(U);if(Q.length>0){w.getResourcesInfo(Q.join(","),{tenantId:P.search_ressources.active_tenant,lang:f.getLanguage(),apiVersion:"R2019x",onComplete:function(W){W&&P.saveNLS_ds6wg(W);P.asyncUpdateModels_predicate()},onFailure:function(W){W&&P.saveNLS_ds6wg(W);P.asyncUpdateModels_predicate()}})}}P.generateTreeModelAsync().then(function(){P.dispatchEvent("onInitTreeDocument_SelectFirstElt",P._treeDocument)})},500);if(A.is(O.service)){this.log("Setup done from the skeleton => set service parameters");this.setRequestCriteria(O.service,O.service_parameters);this.setSearchRessources(O.federated_source)}this._searchcom_socket=F.createSocket({socket_id:"search_collection_"+Math.floor((Math.random()*100000)+1)});this._searchcom_socket.addListener("onSetSessionResponse",this.setSessionResponse.bind(this));if(O.event&&O.event.onSetup){O.event.onSetup.call(null,this)}if(this.service_parameters&&!this.service_parameters.order_by){if(z.getOption("default_sort")){var M=z.getOption("default_sort");if(A.is(M,"object")&&A.is(M.order_by,"string")&&A.is(M.order_field,"string")){this.service_parameters.order_by=M.order_by;this.service_parameters.order_field=M.order_field}}else{if(z.getOption("apply_sort_on_modified_by_default")){this.service_parameters.order_field="ds6w:modified";this.service_parameters.order_by="desc"}}}return this._parent(N,O)},destroy:function(){this.log("Destroy the search collection");if(A.is(this.timeoutId)){clearTimeout(this.timeoutId)}if(this._searchcom_socket){this._searchcom_socket.removeListener("onSetSessionResponse");this._searchcom_socket.disconnect();F.deleteSocket(this._searchcom_socket.id);this._searchcom_socket=null}this._snSkeleton=null;this._recentCollectionArray=null;this.search_ressources=null;this.service_parameters=null;this._ctx_options=null;this._attrToRetrieve=null;this._attrDefinition=null;this.sessionResponse=null;this._fedsearchResp=null;this._fedsearchOptions=null;this._predicateIntersection=null;this._snSkeleton=null;if(A.is(this._treeDocument)&&A.is(this._treeDocument.destroy,"function")){this._treeDocument.destroy();this._treeDocument=null}this._NLS_ds6wg=null;this._helperSubjectsTags=null;this._helpertagValues=null;this._indexingDate=null;this._CBOnComplete=null;this._CBOnFailure=null;this.reset();this._parent()},_getRequiredPredicates:function(){return this._required_predicates},setTagsTransformer:function(M){this._tagsTransformer=M},_setTags:function(W,U){var O=this,Z=0,P=0;if(A.is(this.options.tagger_proxy)){this.log("Set the Tags on the tagger proxy");this.options.tagger_proxy.latest_subjectsTags=W;this.options.tagger_proxy.latest_tagValues=U;if(!z.getOption("activate_dictionary_NLS_computation")){this.options.tagger_proxy.setTags(W,U)}else{var N=A.clone(W);var T=A.clone(U);var Y={};var aa=/\w+:\w+\.\w+/;var M="";if(A.is(N)){var ad=Object.getOwnPropertyNames(N);if(A.is(ad,"array")){for(Z=0,P=ad.length;Z<P;Z++){for(var X=0,ac=N[ad[Z]].length;X<ac;X++){this._tagsTransformer.transformTagsValuesToDataSourceFacets(N,ad,Z,X);if(A.is(N[ad[Z]][X])&&A.is(N[ad[Z]][X].sixw)&&A.is(N[ad[Z]][X].object)){var V=N[ad[Z]][X].sixw.slice(N[ad[Z]][X].sixw.lastIndexOf("/")+1,N[ad[Z]][X].sixw.length);if(!A.is(Y[V])){Y[V]={}}var S=N[ad[Z]][X].object;if(A.is(S,"array")){if(S.length>0){M=S[0];for(var ae=0,ab=S.length;ae<ab;ae++){if(aa.test(M)){M=M.slice(M.lastIndexOf(".")+1)}M=this._tagsTransformer.prepareNlsPropertiesValueForServer(V,M);Y[V][M]=true;if(ae<ab-1){M+="/"+S[ae+1]}}}}else{M=N[ad[Z]][X].object;if(aa.test(M)){M=M.slice(M.lastIndexOf(".")+1)}Y[V][M]=true}}}}}}K.transformPredicateValuesWithMapping(T);if(A.is(T,"array")){for(Z=0,P=T.length;Z<P;Z++){this._tagsTransformer.transformFacets(T,Z);if(A.is(T[Z])&&A.is(T[Z].sixw)&&A.is(T[Z].object)){var V=T[Z].sixw.slice(T[Z].sixw.lastIndexOf("/")+1,T[Z].sixw.length);if(!A.is(T[Z].dispValue,"string")||0===T[Z].dispValue.length){if(!A.is(Y[V])){Y[V]={}}var S=T[Z].object;if(A.is(S,"array")){if(S.length>0){M=S[0];for(var ae=0,ab=S.length;ae<ab;ae++){if(aa.test(M)){var R=M.lastIndexOf("/");if(R>-1){M=M.slice(0,M.lastIndexOf("/")+1)+M.slice(M.lastIndexOf(".")+1)}else{M=M.slice(M.lastIndexOf(".")+1)}}M=this._tagsTransformer.prepareNlsPropertiesValueForServer(V,M);Y[V][M]=true;if(ae<ab-1){M+="/"+S[ae+1]}}}}else{M=T[Z].object;if(aa.test(M)){M=M.slice(M.lastIndexOf(".")+1)}Y[V][M]=true}}}}}var Q=Object.getOwnPropertyNames(Y);if(A.is(Q,"array")){for(Z=0,P=Q.length;Z<P;Z++){Y[Q[Z]]=Object.getOwnPropertyNames(Y[Q[Z]])}}if(z.getOption("search_web_in_win")===true&&!A.is(n._6WTagURL)&&(A.is(window.COMPASS_CONFIG)&&A.is(window.COMPASS_CONFIG.myAppsBaseUrl))){k.getServiceUrl({serviceName:"3DSpace",platformId:O.search_ressources.active_tenant,onComplete:function(af){n._6WTagURL=af;O.getNlsOfPropertiesValuesSearchTag(N,T,Y)},onFailure:function(af){console.error("Call to PlatformServices.getServiceUrl failed !")}})}else{O.getNlsOfPropertiesValuesSearchTag(N,T,Y)}}}else{this.log("Tagger proxy not defined")}},_addSubjects:function(M){if(A.is(this.options.tagger_proxy)){this.log("addSubjects on the tagger proxy");this.options.tagger_proxy.addSubjects(M)}else{this.log("Tagger proxy not defined")}},_mergeOldAndNewTagValues:function(U,Z,T){var O=[];if(A.is(T)&&A.is(T.allfilters)){for(var W in T.allfilters){for(var R=0;R<U.length;R++){var ac=U[R];if(ac.sixw===W){O.push(ac)}}}}if(!A.is(Z)){Z=[]}if(O.length>0){var Q,N;var aa=false;if(O.length>Z.length){N=O;Q=Z}else{N=Z;Q=O;aa=true}for(var P=0;P<Q.length;P++){var X=false;var V=Q[P];var S=V.count;V.count=0;var ab=JSON.stringify(V);V.count=S;var ad=false;for(var ae=0;ae<N.length;ae++){var af=N[ae];var Y=af.count;af.count=0;var M=JSON.stringify(af);af.count=Y;if(M===ab){X=true;if(Y===S){ad=true}break}}if(X===false){N.push(Q[P])}else{if(!aa&&X&&!ad){N[ae]=Q[P]}}}return N}return Z},setIsAPQSearch:function(P){var N=/[\s\b]*3dexp(\w+):/g;while(true){var M=N.exec(P);if(!M){break}var O=M[1];if(d.isAPQAbbrevation(O)){if(A.is(this.service_parameters)){this.service_parameters.isAPQSearch=true;break}}}},getPQSortOrder:function(N){var M;var Y="";var U="";var W=/[\s\b]*3dexp(\w+):/g;var T=W.exec(N);if(!T){return}var X=T[1];if(d.isAPQAbbrevation(X)){U=d.getSortOrder(X)}if(A.is(U,"array")){if(1<U.length){var Q=[];var V=[];for(var S in U){var Z=S;var O=U[S];for(var R in O){var aa=R;var P=O[R];Q.push(P);V.push(aa)}}M={sort_order_by:Q,sort_order_field:V}}}else{if(A.is(U,"object")){var Q;var V;Q=String(Object.values(U));V=String(Object.keys(U));M={sort_order_by:Q,sort_order_field:V}}}return M},fetch:function(V){this.log("SearchCollection fetch");V=V||{};if(A.is(V.no_fetch)&&V.no_fetch===true){this.log("no_fetch options = true ==> No fetch done");if(A.is(V.onComplete,"function")){V.onComplete.call(this)}return[]}else{if(!A.is(this.snservices,"string")||this.snservices===""){this.log("Service name not defined ==> No fetch done");if(A.is(V.onComplete,"function")){V.onComplete.call(this)}return[]}else{this.pcs_uuid=o.now().toString();o.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"OneSearch Query","uuid":"'+this.pcs_uuid+'","drilldown":"OneSearch Query '+this.pcs_uuid+'"}');o.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"fetch preparation","uuid":"'+this.pcs_uuid+'","status":"start","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}');var P='{"module":"DS/SNResultUX/collections/SearchCollection","name":"fetch preparation","uuid":"'+this.pcs_uuid+'","status":"end","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}';if(!A.is(this.search_ressources)){this.log("No search source defined. No fetch done.");o.mark(P);if(A.is(V.onComplete,"function")){V.onComplete.call(this)}return}if(A.is(this.service_parameters)&&A.is(this.service_parameters.refine)&&A.is(this.service_parameters.refine.allfilters)){var Q=this.service_parameters.refine.allfilters;for(var T in Q){if(A.is(Q[T],"array")&&Q[T].length>0&&A.is(Q[T][0])&&A.is(Q[T][0].type)&&Q[T][0].type==="date"){delete Q[T]}}}var M=[];if(l.isContentLocationActive()&&((!this._tagsTransformer&&this._isAHelper)||(this._tagsTransformer&&this._tagsTransformer.isTransientWidget()===true))){l.addSourceSpecificParameterToFilterData(this.service_parameters)}else{M.push("ds6w:dataSource")}V=this.search_ressources.getFetchOptions({service_name:this.snservices,service_data:this.service_parameters,original_options:V,state:this.state,context_options:this._ctx_options,attributesToRetrieve:this.getAttributesToRetrieve(),source:this._getSearchSource(),select_exclude_synthesis:M});if(A.is(this._searchcom_socket)&&A.is(this._searchcom_socket.dispatchEvent,"function")&&A.is(this.service_parameters,"object")&&this.service_parameters.originalSearchCriteria!==f.ADVANCED_SEARCH){this._searchcom_socket.dispatchEvent("Last_Tag_Filter",this.service_parameters.refine)}this._fedSearchLabel=this.search_ressources.getFedSearchLabel()}}this._search_in_progress=true;var S=this;this.timeoutId=setTimeout(function(){S._search_in_progress=false;S.timeoutId=null},15000);o.mark(P);o.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"fedsearch","uuid":"'+this.pcs_uuid+'","status":"start","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}');var O=V.onComplete,U=V.onFailure;var R=function(W){W.dispatchEvent("on_sync",W);O.apply(this,arguments)};if(f.isFUN072117Active()){var N=R;R=S.updateModelsWithPreferredUnits(N)}V.onComplete=function(Y){var W=arguments;if(A.is(S.service_parameters)&&A.is(S.service_parameters.query)&&f.SearchTypeEnum.MY_RECENT_CONTENT===S.service_parameters.query){S._recentCollectionArray=S.toArray();S.state.lastPage=0;S.state.totalPage=1;S.state.pageSize=S.totalCount;if(1000==S.totalCount){S._snSkeleton._searchActions._displayAlert({message:I.replace(I.get("recent_too_many_results")),className:"warning"})}if(A.is(S._snSkeleton)&&A.is(S._snSkeleton.options)&&A.is(S._snSkeleton.options.observable,"object")&&A.is(S._snSkeleton.options.observable._originalSearchCriteria,"string")){S.filterSearch({recent_filter:S._snSkeleton.options.observable.options.search_options.recent_filter})}return R.apply(this,arguments)}else{if(z.getOption("activate_dictionary_NLS_computation")){var X=0;if(!A.is(S._attrDefinition)){console.error("Undefined _attrDefinition !");X=500}if((S.sessionResponse_received!=false)||(z.getOption("search_web_in_win")!==true)){setTimeout(function(){S.getModelNLS(Y,R,W)},X)}else{return R.apply(this,arguments)}}else{return R.apply(this,arguments)}}};V.onFailure=function(W){return U.apply(this,arguments)};this._parent(V)},getModelNLS:function(aa,V,X){var R=this;var ah=/\w+:\w+\.\w+/;var ai=aa._models;var T={};var ab="";for(var N=0,am=ai.length;N<am;N++){var al=ai[N];var Z=al.pairs();for(var ac=0,O=Z.length;ac<O;ac++){if(!A.is(T[Z[ac][0]])){T[Z[ac][0]]={}}ab=Z[ac][1];if(A.is(ab,"array")&&ab.length>0){for(var ag=0,P=ab.length;ag<P;ag++){var W=ab[ag];if(A.is(W,"array")&&W.length>0){var U="";for(var Y=0,S=W.length;Y<S;Y++){if(0===Y){U=W[Y]}else{U+="/"+W[Y]}T[Z[ac][0]][U]=""}}else{if(ah.test(Z[ac][1][af])){Z[ac][1][af]=Z[ac][1][af].slice(Z[ac][1][af].lastIndexOf(".")+1)}T[Z[ac][0]][Z[ac][1][ag]]=""}}}else{if(A.is(ab,"string")){if(ah.test(Z[ac][1])){Z[ac][1]=Z[ac][1].slice(Z[ac][1].lastIndexOf(".")+1)}T[Z[ac][0]][Z[ac][1]]=""}}}}var ad={};var ak=Object.getOwnPropertyNames(T);var aj=R.getAttributesToRetrieve();var M={"ds6w:label":true,"ds6w:identifier":true,"ds6w:description":true,preview_url:true,resourceid:true,sourceid:true,type_icon_url:true,resourceid_tagger:true,taxonomies:true};for(var af=0,Q=ak.length;af<Q;af++){var ae=ak[af];if(A.is(T[ak[af]+"_value"])&&!A.is(M[ae])&&(A.is(R._attrDefinition[ak[af]])&&R._attrDefinition[ak[af]].type!=="date")){ad[ae]=Object.getOwnPropertyNames(T[ak[af]+"_value"])}}if(z.getOption("search_web_in_win")===true&&!A.is(n._6WTagURL)&&(A.is(window.COMPASS_CONFIG)&&A.is(window.COMPASS_CONFIG.myAppsBaseUrl))){k.getServiceUrl({serviceName:"3DSpace",platformId:R.search_ressources.active_tenant,onComplete:function(an){n._6WTagURL=an;R.getNlsOfPropertiesValuesSearch(aa,V,X,ad);if(A.is(R.state.currentPage)&&(R.state.currentPage===0)){R._setTags(R._helperSubjectsTags,R._helpertagValues)}},onFailure:function(an){console.error("Call to PlatformServices.getServiceUrl failed !");return onFailureOrig.apply(this,arguments)}})}else{R.getNlsOfPropertiesValuesSearch(aa,V,X,ad);if((A.is(R.state.currentPage)&&(R.state.currentPage===0))){R._setTags(R._helperSubjectsTags,R._helpertagValues)}}},getFirstPageOfResults:function(M){var N=this;E.login({resources:N.getSearchRessources(),onComplete:function(){N.getFirstPage(M)},onFailure:function(){N.getFirstPage(M)}})},getFirstPage:function(N){if(A.is(this.service_parameters)&&A.is(this.service_parameters.query)&&f.SearchTypeEnum.MY_RECENT_CONTENT!=this.service_parameters.query&&A.is(this._recentCollectionArray)){this._recentCollectionArray=null}this.initTreeDocument();this._resetState();if(z.getOption("search_web_in_win")&&(f.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query)){this.sessionResponse=null;this.sessionResponse_received=false;var O=A.is(z.getOption("tabbed_ui_support_level"));this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"sessionSearch",notif_parameters:O?(JSON.stringify({tabID:this._snSkeleton.getOption("observable").getTabID(),searchParams:this.service_parameters})):this.service_parameters},"search_web_in_win")}var M=this._parent(N);return M},parseResponseForStateUpdate:function(R,O,Q,N){var M={},P;if(this.snservices=="fed_search"){if(A.is(R.infos.nhits)){M.totalRecords=parseInt(R.infos.nhits)}M.totalPages=Math.ceil(M.totalRecords/Q.pageSize);M.lastPage=M.totalPages-1}else{if(this.snservices=="getSavedSearches"){M.totalRecords=parseInt(R.searches.length);M.totalPages=1;M.lastPage=0}}this._search_in_progress=false;return M},parseRecords:function(Q,N){this.log("inside parseRecords");var O=null;if(A.is(this.getSearchRessources)&&A.is(this.getSearchRessources())&&A.is(this.getSearchRessources().getActiveTenant)&&A.is(this.getSearchRessources().getActiveTenant())&&A.is(Q)&&A.is(Q.infos)&&A.is(Q.infos.sources)){E.updateServiceToSourceMapping(this.getSearchRessources().getActiveTenant(),Q.infos.sources)}if(z.getOption("search_web_in_win")){if(this.sessionResponse_received){this.log("session_response is received, so parse the results together");O=this.parseRecords2(Q,N);this._fedsearchResp=null;this.sessionResponse=null}else{this.log("session_response is not yet received, so we will wait for session to respond and then parse the results together");this._fedsearchResp=Q}}else{O=this.parseRecords2(Q,N)}this._fedsearchOptions=N;var M=A.is(O)?O.length:-1;var P="";if(0===M){P=I.get("no_result")}if(A.is(this._snSkeleton)&&A.is(this._snSkeleton._searchActions)&&A.is(this._snSkeleton._searchActions.setEmptyViewMessage,"function")){this._snSkeleton._searchActions.setEmptyViewMessage(P)}return O},parseRecords2:function(Z,P){this.log("SearchCollection parse");o.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"fedsearch","uuid":"'+this.pcs_uuid+'","status":"end","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}');o.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"parseRecords","uuid":"'+this.pcs_uuid+'","status":"start","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}');this.setFailureView(false);var U=this,ad=null;this._parse_alert=[];if(this.snservices=="fed_search"||this.snservices=="fed_search_odt"){var ab=false;if(A.is(P.url,"string")&&P.url.indexOf("/recent")>0){ab=true}var af=null,O={federated_response:Z,isRecentSearch:ab,tenant:this.getSearchRessources().getActiveTenant()};af=new L(O);this._parse_alert=af.getUserLevelAlerts();this.state.next_start=af.response_infos.next_start;this.totalCount=af.getMatches();this._attrDefinition=af.getAttributesDefinition();if(this._parse_alert.length>0){if(this.totalCount===0){this.setFailureView(true)}if(!this._isAHelper){var S={service:this.snservices,messages:this._parse_alert};this.dispatchEvent("failure_on_parse",S)}}ad=af.getResults();this._retrieveLastIndexingDate(af);var R=null;if(z.getOption("search_web_in_win")&&A.is(this.sessionResponse)){var ac={federated_response:this.sessionResponse,tenant:this.getSearchRessources().getActiveTenant(),};R=new L(ac);var ah=0;var T=R.getResults();if(A.is(T)){T.forEach(function(ak){++ah;ak.session_object=true;ad.unshift(ak)})}this.totalCount+=ah}if(ad.length>0){var W=af.getTags();var ae=W.tagsData,aa=W.summaryData;if(A.is(this.service_parameters)&&A.is(this.service_parameters.query)&&this.service_parameters.query===f.SearchTypeEnum.MY_CONTENT&&A.is(aa)){aa=a.handleMyContentTags(aa)}if(A.is(R)){var Y=R.getTags();var N=Y.tagsData;var M=Y.summaryData;if(!A.is(aa)||aa.length==0){aa=M}else{if(A.is(M)){var aj=[];M.forEach(function(ak){var am=false;for(var al=0;al<aa.length;al++){if(aa[al].sixw===ak.sixw&&aa[al].field===ak.field&&aa[al].object===ak.object){aa[al].count+=ak.count;am=true;break}}if(!am){aj.push(ak)}});aj.forEach(function(ak){aa.push(ak)})}}}if(A.is(U._isAHelper)){U._helperSubjectsTags=ae;U._helpertagValues=aa}else{var ag=U.getTaggerProxy();if(A.is(ag)){if(A.is(P.merge)&&true===P.merge){U._addSubjects(ae);U._helperSubjectsTags=ae;U._helpertagValues=aa}else{if(A.is(ag.latest_subjectsTags)&&A.is(ag.latest_tagValues)){ae=A.extend(ag.latest_subjectsTags,ae);if(A.is(this.service_parameters)&&A.is(this.service_parameters.refineSearch)&&true===this.service_parameters.refineSearch){var Q=ag.latest_tagValues;var V=ag.getCurrentFilter();aa=this._mergeOldAndNewTagValues(Q,aa,V)}}U._helperSubjectsTags=ae;U._helpertagValues=aa}if(A.is(ag)){if(A.is(U.service_parameters.localFilter,"object")){}}}}if(A.is(this.latest_tagValues)){U.options.tagValues=this.latest_tagValues}else{U.options.tagValues=W.summaryData}}else{if(A.is(P.merge)&&true===P.merge){this.log("No result found with merge")}else{this.log("No result found");if(A.is(U.options.tagger_proxy)){var ai=Z.subjectsTags,X=Z.tagValues;U._helperSubjectsTags=ai;U._helpertagValues=X;U._setTags(U._helperSubjectsTags,U._helpertagValues)}}UWA.Event.dispatchEvent(document,"no_result_found")}}else{if(this.snservices=="getSavedSearches"){this.totalCount=Z.searches.length;ad=Z.searches}}if(A.is(this.service_parameters)&&A.is(this.service_parameters.query)&&f.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query){this.dispatchEvent("response_treated",{data:ad,rawData:true})}o.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"parseRecords","uuid":"'+this.pcs_uuid+'","status":"end","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}');return ad},_resetState:function(){this.totalCount=-1;var M=z.getOption("results_perpage");if(A.is(M)&&(A.typeOf(M)!=="number")){M=parseInt(M)}this.state={firstPage:0,lastPage:null,currentPage:0,pageSize:M,totalPages:null,totalRecords:null,sortKey:null,order:-1,tagsSet:0};this._attrDefinition=null},getFailureView:function(){return(this._failureView)},setFailureView:function(M){this._failureView=M},setSearchRessources:function(M){this.search_ressources=M},getSearchRessources:function(){return this.search_ressources},cleanScriptSyntax:function(M){return(-1!=M.replace(/ /g,"").indexOf("<script"))?M.replace(/</g,"&lt;").replace(/>/g,"&gt;"):M},setRequestCriteria:function(N,P,O){this.snservices=N;if(A.is(P)&&A.is(P.query,"string")){if(P.query===f.SearchTypeEnum.FAVORITE_SEARCH){P.originalSearchCriteria=I.get("my_fav_searches");P.savedSearch=true;P.search_name=I.get("my_fav_searches");P.queryType=f.SearchTypeEnum.FAVORITE_SEARCH}this.service_parameters=P;var M=this.getPQSortOrder(this.service_parameters.query);if(A.is(M,"object")){this.service_parameters.order_by=M.sort_order_by;this.service_parameters.order_field=M.sort_order_field}if(!A.is(O)||false===O){this._isInContextMode=false}else{this._isInContextMode=true}this.setIsAPQSearch(this.service_parameters.query);this.service_parameters.query=this.cleanScriptSyntax(this.service_parameters.query)}this._attrToRetrieve=[]},getRequestCriteria:function(){return{service_name:this.snservices,service_params:this.service_parameters}},setTaggerProxy:function(M){this.options.tagger_proxy=M},getTaggerProxy:function(){return this.options.tagger_proxy},setSessionResponse:function(N){this.log("SearchCollection setSessionResponse");this.sessionResponse=N;this.sessionResponse_received=true;if(!this._search_in_progress){this.log("Fed search has already answered, so we will parse the fed search response now together with session response");var M=null;if(this._fedsearchResp){M=this.parseRecords2(this._fedsearchResp,this._fedsearchOptions)}if(A.is(M)){this.log("consolidatedParseRecords = "+M.length);var O=this;if(window.hasOwnProperty("sendNotificationWebInWin")&&A.is(sendNotificationWebInWin,"function")){sendNotificationWebInWin("QueryEnd",JSON.stringify({nb_results:O.totalCount,collection:O}))}M.forEach(function(P){O.unshift(P)});this.dispatchEvent("onSync",this,this._fedsearchResp,this._fedsearchOptions);this.dispatchEvent("on_sync",this,this._fedsearchResp,this._fedsearchOptions)}this._fedsearchResp=null;this.sessionResponse=null}else{this.log("Fed search has NOT yet answered, so we will parse the session response when fed search response is received")}},hasNextPage:function(){if(A.is(this.service_parameters)&&f.SearchTypeEnum.MY_RECENT_CONTENT===this.service_parameters.query){return false}return this._parent()},setAttributesToRetrieve:function(M){this._attrToRetrieve=M},getAttributesToRetrieve:function(Q){if(A.is(this._attrToRetrieve)&&this._attrToRetrieve.length===0||(A.is(Q)&&Q.length>0)){this._attrToRetrieve=[];var ac=[];if(A.is(Q)&&Q.length>0){ac=Q}else{if(A.is(this.service_parameters)){var M={isPQ:this.service_parameters.isAPQSearch?true:false,typeName:this.getPQ()};var O=H.getColumnCustomizationIdToUse(M);if(O.length>0){var Z="";if(A.is(this.search_ressources)&&A.is(this.search_ressources.getActiveTenant,"function")){Z=this.search_ressources.getActiveTenant()}ac=H.getColumnCustomizationDefinitionFromCustoId(O,Z)}}}for(var Y=0,ad=ac.length;Y<ad;Y++){if(A.is(ac[Y],"object")){var N=ac[Y].dataIndex;this._attrToRetrieve.push(N.slice(N.lastIndexOf("/")+1,N.length))}}}var T=[];if(!A.is(Q)){var ae=J.getItem("DataGridColumnCusto");var R=[];var aa;if(A.is(ae)){if(A.is(ae.activeView)){var S=ae.activeView;if(A.is(ae.views)){R=ae.views}for(var V=R.length-1;V>=0;V--){var U=R[V];if(U.viewId===S){aa=U.viewDefinition}}if(A.is(aa)){for(var Y=0,ad=aa.length;Y<ad;Y++){var W=aa[Y];T.push(W.dataIndex)}}}}}var X=[];if(A.is(this._attrToRetrieve,"array")){X=X.concat(this._attrToRetrieve)}var ab=this._getRequiredPredicates();if(A.is(ab,"array")){X=X.concat(ab)}if(A.is(T,"array")){X=X.concat(T)}var P=X.filter(function(ah,ag,af){return ag==af.indexOf(ah)});return P},setSearchSource:function(M){this._source=M},_getSearchSource:function(){return this._source},setSNSkeleton:function(M){this._snSkeleton=M},getSNSkeleton:function(){return this._snSkeleton},getPQ:function(){if(!A.is(this.service_parameters.isAPQSearch)||false===this.service_parameters.isAPQSearch){return null}var U=this.service_parameters.query;var N;var P;var T=/3dexp((\w+):[^ $)]+)/g;var S=T.exec(U);if(S){var V=S[1];N=d.getPQPrefix(d.isAPQSearch(V));P=d.getPQName(N);while(S=T.exec(U)){V=S[1];var O=d.getPQPrefix(d.isAPQSearch(V));var W=d.getPQName(O);if(W!=P){return null}}}var Q;if(A.is(P,"string")&&P.length>0){var Q=P;var R=d.getPQObjFromPQPrefix(N);var M=d.getPQNLS();if(A.is(M,"object")&&A.is(R,"object")&&A.is(R.pqid,"string")&&R.pqid.length>0&&A.is(M[R.pqid+".Title"],"string")&&M[R.pqid+".Title"].length>0){Q=M[R.pqid+".Title"]}}return{pqName:P,pqUsed:N,pqNLS:Q}},getIndexingDate:function(){return this._indexingDate},checkPQExpressionsForWildCardChars:function(){var S=this.service_parameters.query;var P=/[\s\b]*\w+[\s]*:/g;var Q;while((Q=P.exec(S))!==null){var R=Q[0].match(/\w+/g);if(R!==null){var M=R[0];if(M.indexOf("3dexp")===0){var M=M.substring(5,M.length);if(d.isAPQAbbrevation([M])){var O=S.substring(P.lastIndex).trim();var N=O.match(/^(#all|(\*)+)($|\s)/);if(N){return true}}}}}return false},filterSearch:function(M){if(!A.is(M)){throw new Error("Bad options given to SearchCollection.filterSearch !")}if(!A.is(this._recentCollectionArray)){return}var P=this._recentCollectionArray.length;var R=M.recent_filter;if(!A.is(R)||R==f.SearchTypeEnum.MY_CONTENT||R==f.SearchTypeEnum.ADVANCED_SEARCH){R=""}this.service_parameters.recent_filter=R;this.dispatchEvent("update_title",{originalSearchCriteria:R});if(0>=this._recentCollectionArray.length){this.dispatchEvent("showAllMyRecent",{isVisible:false});return}R=R.replace(/\*/g,"");R=R.toLowerCase();var Q=function(V){var W=V.values();var T=false;for(var U=0,S=W.length;U<S&&!T;U++){if(A.is(W[U],"string")&&W[U].toLowerCase().indexOf(R)>=0){T=true}}return T};if(R.length>0){var N=this._recentCollectionArray.filter(Q);P=N.length;if(0===N.length&&this._recentCollectionArray.length>0){var O=I.replace(I.get("recent_no_filtered_result"),{nbResult:""+this._recentCollectionArray.length,filterCriteria:M.recent_filter});if(A.is(this._snSkeleton)&&A.is(this._snSkeleton._searchActions)&&A.is(this._snSkeleton._searchActions.setEmptyViewMessage,"function")){this._snSkeleton._searchActions.setEmptyViewMessage(O)}}this.reset(N)}else{this.initTreeDocument();this.reset(this._recentCollectionArray);R="*"}this.state.totalRecords=P;this.state.pageSize=P;this.totalCount=P;if(P!=this._recentCollectionArray.length){this.dispatchEvent("showAllMyRecent",{isVisible:true})}else{this.dispatchEvent("showAllMyRecent",{isVisible:false})}this.dispatchEvent("onSync",this,this._fedsearchResp,this._fedsearchOptions);this.dispatchEvent("on_sync",this,this._fedsearchResp,this._fedsearchOptions);this.dispatchEvent("response_treated",{data:this._recentCollectionArray,rawData:false})},sortCollection:function(M){if(f.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query){throw new Error("SearchCollection.sortCollection must not be called if not in my recent content context !")}if(!A.is(M.order_field)||!A.is(M.order_by)){throw new Error("Bad options given to SearchCollection.sortCollection !")}if(!A.is(this._recentCollectionArray)){throw new Error("No _recentCollectionArray in SearchCollection.sortCollection !")}var Q=M.order_field,O=M.order_by,P="asc"===M.order_by?1:-1,N=this._recentCollectionArray.comparator;this._recentCollectionArray.comparator=function(T,S){var R=0;if(T.get(Q)<S.get(Q)){R=P*(-1)}else{if(T.get(Q)>S.get(Q)){R=P}}return R};this._recentCollectionArray.sort();this.reset(this._recentCollectionArray);this.dispatchEvent("onSync",this,this._fedsearchResp,this._fedsearchOptions);this.dispatchEvent("on_sync",this,this._fedsearchResp,this._fedsearchOptions);this._recentCollectionArray.comparator=N},getFedSearchLabel:function(){return this._fedSearchLabel},initTreeDocument:function(){if(A.is(this._treeDocument)&&A.is(this._treeDocument.destroy,"function")){this._treeDocument.destroy();this._treeDocument=null}this._treeDocument=new v({useAsyncPreExpand:true,shouldAcceptDrag:function(){return true},shouldAcceptDrop:function(){return false}});this.setFailureView(false);if(A.is(this.service_parameters)){if(f.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query){this._treeDocument._getTrueRoot().sortChildren=function M(){}}}this.dispatchEvent("onInitTreeDocument",this._treeDocument);return this._treeDocument},getTreeDocument:function(){return this._treeDocument||this.initTreeDocument()},generateTreeModel:function(){},getNotLoadedPredicate:function(N){var M=this;var P=[];var O=M.getSearchRessources();N.forEach(function(Q){if(!M._NLS_ds6wg[O.active_tenant+"/"+Q]){P.push(Q)}});return P},saveNLS_ds6wg:function(N){var M=this;var O=M.getSearchRessources();N.forEach(function(P){M._NLS_ds6wg[O.active_tenant+"/"+P.curi]=P})},asyncUpdateModels_predicate:function(){var M=this.getTreeDocument();var P=M.getRoots();var R=this;var O={};var Q=0;var N=z.getOption("snippet_unsupported_sources");M.prepareUpdate();P.forEach(function(T){if(A.is(T)&&!A.is(T.nlsAlreadyComputed)){var S=R.getCollectiveViewOptions(T.options,O,R._isResponsive,Q,N);T.updateOptions(S);T.nlsAlreadyComputed=true}Q++});M.pushUpdate()},getCollectiveViewOptions:function(ad,P,X,Z,Q){X=X||this._isResponsive;var ae=(ad.getServiceID&&ad.getServiceID())||ad.serviceID||"";var Y=ad.getSourceID?ad.getSourceID():ad.sourceID;var ac=this.getSearchRessources();var O=new Date().getTime();const R=60*60*24*1000;var S=this;if(!P[ae]){P[ae]=x.getViewSpecs(ae,["label","subLabel","description"])}var M=A.clone(P[ae]);if(f.isSnippetAvailable(this.search_ressources.getActiveTenant())===true&&A.is(ad.grid["ds6w:snippet"])&&(ad.grid["ds6w:snippet"].trim().length>0)){if((A.is(Q,"array")&&(Q.indexOf(Y)===-1))||(!A.is(Q))){M.description=["ds6w:snippet"]}}var T=ad.grid.toolTip;var W=true;if(true===W){T="";var aa=[];for(var V in M){aa=aa.concat(M[V])}var N=z.getOption("webUXTooltip");aa.forEach(function(aj,ai){var ag=aj;if(ag!=="ds6w:snippet"){if(D.getNLSValueForPredicate(aj)===aj){if(S._NLS_ds6wg[ac.active_tenant+"/"+aj]){ag=S._NLS_ds6wg[ac.active_tenant+"/"+aj].label}}else{ag=D.getNLSValueForPredicate(aj)}}else{var af=I.get("search_hit");if(A.is(af,"string")){ag=af}}var ah=(A.is(ad.withoutHtmlTag[aj])?ad.withoutHtmlTag[aj]:"");if(ah){if(T.length>0){T+=N?"<br>":"&#10;"}var ak=(A.is(ad.withoutHtmlTag[aj])?ad.withoutHtmlTag[aj]:"");if(ak.length>200){ak=ak.substring(0,200);ak+="..."}T+=ag+": "+ak;T=T.replace(/↦/g,"");T=T.replace(/↤/g,"")}});ad.grid.toolTip=T}var U=function(ah){var ai=M[ah];var ak="",aj="";var ag="";if(ah==="subLabel"){S._tagsTransformer.displaySourceInSearchView(ai,ad,S._NLS_ds6wg)}ai.forEach(function(ap,an){aj="";ag="";if(ad.grid[ap]!==undefined&&ad.withoutHtmlTag[ap]){var al=ap;if(D.getNLSValueForPredicate(ap)===ap){if(S._NLS_ds6wg[ac.active_tenant+"/"+ap]){al=S._NLS_ds6wg[ac.active_tenant+"/"+ap].label}}else{al=D.getNLSValueForPredicate(ap)}if("label"===ah){if(X){("ds6w:label"===ap)?aj=S._templateSearchItemSpan(Z,ap,ad.withoutHtmlTag[ap],ad.grid[ap]):aj=S._templateSearchItemSpan(Z,ap,ad.withoutHtmlTag[ap],ad.grid[ap],"onlyDisplayInLargeTileView")}else{if(ap==="ds6w:label"){aj=S._templateSearchItemSpan(Z,ap,ad.withoutHtmlTag[ap],ad.grid[ap])}}}else{if(ap==="ds6wg:revision"||ap==="ds6w:status"||ap==="ds6w:community"){ag='<span class="labelOnAttributeString">'+al+":</span>"}if("ds6w:modified"===ap){var aq=ad.withoutHtmlTag[ap].replace(",","").split(" ");var am=ad.withoutHtmlTag[ap];var ao=new Date(am).getTime();if(A.is(aq,"array")&&0<aq.length&&((O-ao)<=R)){am=aq.join(" ");if(aq.length>3){am=aq[aq.length-1]}else{aq.splice(0,1);am=aq.join(" ")}}else{if(aq.length>3){aq.pop();am=aq.join(" ")}else{am=aq[0]}}aj=S._templateSearchItemSpan(Z,ap,ad.withoutHtmlTag[ap],am)}else{aj=S._templateSearchItemSpan(Z,ap,ad.withoutHtmlTag[ap],ad.grid[ap])}}(ak.length>0)?ak+=(ak.length>0?" | ":""):null;(aj.length>0)?ak+=ag+aj:null}});if(ai.indexOf("ds6w:identifier")<0&&ah==="label"){ak+=S._templateSearchItemSpan(Z,"ds6w:identifier",ad.withoutHtmlTag["ds6w:identifier"],undefined,"onlyDisplayInLargeTileView")}if(ak.length===0&&ai.length>0){var af=I.get("no_access");if(A.is(ad)){if(A.is(ad.isAShowOnlyObject,"function")&&ad.isAShowOnlyObject()){ak=af}else{if(ad.grid.showonly!==undefined&&"true"===ad.grid.showonly){ak=af}}}}return(z.getOption("webUXTooltip"))?"<span>"+ak+"</span>":'<span title="'+T+'">'+ak+"</span>"};var ab={label:U("label"),subLabel:U("subLabel"),icons:[ad.grid.type_icon_url],thumbnail:ad.grid.preview_url,description:U("description"),contextualMenu:"active ctx menu",serviceID:ae,sourceID:Y,useAsyncPreExpand:true};if(z.getOption("webUXTooltip")){ab.customTooltip=ad.grid.toolTip;ab.customTooltip=new y({shortHelp:ad.grid.toolTip,shortHelpImage:ad.grid.preview_url,shortHelpImageDimension:{x:144,y:108},})}(true===X)?ab.multipleTitleLineNumber=true:null;return ab},_templateSearchItemSpan:function(P,N,M,O,Q){return'<span class="searchItemSpan'+((undefined!==Q)?" "+Q:"")+'" search-item-number="'+P+'" search-item-predicate="'+N+'" search-item-predicate-value="'+M+'">'+((undefined!==O)?O:"")+"</span>"},_checkAndBuildTooltipWithSearchHit:function(V){var R=[];var N={IsHighlightExist:false,SearchHitArray:R};if(!A.is(V)||!A.is(V.searchItemModel)||!A.is(V.snippetAttribute)){return N}var T=V.searchItemModel,M=V.snippetAttribute;var U=M+"_value";var Q=undefined;if(A.is(T)&&A.is(T.get,"function")){Q=T.get(M+"_value")}else{if(A.is(T._attributes[U])){Q=T._attributes[U]}}if(A.is(Q,"string")){var O=JSON.parse(Q);if(A.is(O,"object")&&A.is(O.text,"array")&&O.text.length>0){var P=0;for(var S=0;S<O.text.length;S++){if(A.is(O.text[S].highlighted)&&"true"===O.text[S].highlighted){N.IsHighlightExist=true;if(N!==undefined&&A.is(O.text[S].content,"string")){P++;R.push(O.text[S].content);if(P==1){N.SearchHit="";N.SearchHit+=O.text[S].content}else{N.SearchHit+=","+O.text[S].content}}}}}}return N},_getTooltipWithSearchHit:function(U){var P=this;var Q="";var S={globalToolTipWithSearchHit:Q};var O=undefined;if(A.is(U)&&A.is(U.searchItemModel)){O=U.searchItemModel}if(A.is(O)){var N=z.getOption("select_snippets");if(A.is(N)&&A.is(N,"object")){var M=Object.keys(N).map(function(V){return N[V]});if(A.is(M)&&A.is(M,"array")&&M.length>0){var T=false;var R=false;M.forEach(function(Y){var X={searchItemModel:O,snippetAttribute:Y};var W=P._checkAndBuildTooltipWithSearchHit(X);if(A.is(W)&&A.is(W.IsHighlightExist)&&true===W.IsHighlightExist){Q=O.grid.toolTip;if(A.is(Q,"string")){if(Q.length>0&&false==T){if(z.getOption("webUXTooltip")){Q+="<br>"}else{Q+="&#10;"}}if(A.is(W.SearchHit,"string")){var V="";if(false==T){V=I.get("search_hit");Q+=V+": ";T=true}if(true==R){Q+=","}Q+=W.SearchHit;R=true;O.grid.toolTip=Q}}}});S.globalToolTipWithSearchHit=Q}}}return S},generateTreeModelAsync:function(){var V=this._treeDocument||this.initTreeDocument();if(!A.is(V)){console.warn("!UWACore.is(Treedocument)");return}var au=this;var at=this._models;var W=V.getRoots().length;var R=J.getItem("activeLargeView")||(G.isActiveWithCurrentVersion({R2019x:"BETA2"})&&!J.getItem("deactiveLargeView"));var ay=true;var ah=true;var ak=f.isInTheSimpleSearch({tenant:this.search_ressources?this.search_ressources.getActiveTenant():""});if(ak===true||ak===false){ah=false}if(at.length>W){var aE=[];V.prepareUpdate();var N={};var ao=0;var O=[];if(f.SearchTypeEnum.MY_RECENT_CONTENT===au.service_parameters.query&&au.service_parameters.recent_filter){(au.service_parameters.recent_filter!=="*")?O.push(au.service_parameters.recent_filter):null}else{if(true===au.service_parameters.isAPQSearch){O.push(au.service_parameters.query.replace(/3dexp.*:/g,""))}else{if(A.is(au.service_parameters.search_criteria_to_display,"string")&&au.service_parameters.search_criteria_to_display.length>0){O.push(au.service_parameters.search_criteria_to_display)}else{if(A.is(au.service_parameters.originalSearchCriteria,"string")&&au.service_parameters.originalSearchCriteria.length>0&&au.service_parameters.originalSearchCriteria.length<2000){O.push(au.service_parameters.originalSearchCriteria)}else{if(A.is(au.service_parameters.query,"string")&&au.service_parameters.query.length>0&&au.service_parameters.query.length<2000){O.push(au.service_parameters.query)}}}}}if(A.is(au.service_parameters.searchInCriteria,"string")&&0<au.service_parameters.searchInCriteria.length){O.push(au.service_parameters.searchInCriteria);if(A.is(au.service_parameters.query,"string")&&0<au.service_parameters.query.length){O.push(au.service_parameters.query)}}var al=[];O.forEach(function(aL){al=al.concat(aL.split(" "))});this.updateSwymTypeIcon(at);var aB=this.extractAllMatchesFromSnippetInfos(at);aB.forEach(function(aL){al=al.concat(aL.split(" "))});if(false===z.getOption("HighlightWithUserQuery")&&(f.isSnippetAvailable(this.search_ressources.getActiveTenant())===true)){al=[]}O=al.filter(function(aL){return((aL!="OR")&&(aL!="AND"))});for(ao=O.length-1;ao>=0;ao--){var ar=O[ao];var X=ar.split(" OR ");ar=X.join("");X=ar.split(" AND ");ar=X.join("");X=ar.split("flattenedtaxonomies:");ar=X.join("");X=ar.split('"');if(X.length>1&&(X.length%2)==1){for(var S=0,aw=X.length;S<aw;S++){var ag=X[S];if(A.is(ag,"string")){ag=ag.trim()}if(ag.length>0&&ag!=="("&&ag!==")"){O.push(ag)}}O.splice(ao,1)}}if(O.length>1){var aD=0,T=O.length,ax=[],P={},ag="";for(aD=0;aD<T;aD++){ag=O[aD];if(A.is(ag)){ag=ag.trim();if(0<ag.length){ag=ag.toUpperCase();ag=ag.replace(/\*/g,"");P[ag]=0}}}O=Object.keys(P);if(O.length>1){O.sort(function(aM,aL){return(aL.length-aM.length)})}}var aA=[];for(var ao=0,aG=O.length;ao<aG;ao++){var aH=O[ao].replace(/\*/g,"");aH=f.escapeHtml(aH);aH=aH.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");aA.push(new RegExp(aH,"ig"))}if(true===z.getOption("noHighlight")){aA=[]}var ai=new RegExp("\u2700","ig");var aF=new RegExp("\u2710","ig");var aK=z.getOption("select_snippets");var ad=z.getOption("snippet_unsupported_sources");for(var aD=0;aD<at.length-W;aD++){var aI=at[W+aD];var U=null;if(A.is(aI)){U=aI.clone();U.collection=aI.collection}var aj={};if(A.is(U)){U.grid=A.clone(U._attributes);if(A.is(U.grid)){var aq=Object.keys(U.grid);if(A.is(aq,"array")){var Z=0,af=0;for(Z=0,af=aq.length;Z<af;Z++){if(A.is(U.grid[aq[Z]],"array")){U.grid[aq[Z]]=U.grid[aq[Z]].join(";")}}U.withoutHtmlTag=A.clone(U.grid);for(Z=0,af=aq.length;Z<af;Z++){var an={predicateName:aq[Z],select_snippets:aK};var ap=au._getSnippetAttributeCorrespondingToPredicate(an);if(A.is(ap,"object")&&ap.gotSnippetAttribute==true&&A.is(ap.snippetAttrName,"string")){var M=ap.snippetAttrName;var aa={searchItemModel:U,SnippetAttr:M};var aJ=au._getValueWithHighlightByConcatenationOfSnippet(aa);if(A.is(aJ)&&A.is(aJ.valueWithHighlight,"string")&&aJ.valueWithHighlight.length>0){U.grid[aq[Z]]=aJ.valueWithHighlight}}else{if(true===z.getOption("HighlightWithUserQuery")&&(f.isSnippetAvailable(this.search_ressources.getActiveTenant())===true)){for(var Q=0,av=aA.length;Q<av;Q++){var ae=U.grid[aq[Z]];if(A.is(ae,"string")){ae=au.highlightRegexInStringJustOnce(ae,aA[Q])}U.grid[aq[Z]]=ae}}else{if((aq[Z].lastIndexOf("_value")!==aq[Z].length-6&&aq[Z].indexOf(":")>-1)||(aq[Z]=="snippet"||aq[Z]=="snippet_value")){var ae=U.grid[aq[Z]];if(aq[Z]=="snippet"||aq[Z]=="snippet_value"){ae=ae.replace(/↦/g,'<span class="highlightedSearchCriteria">');ae=ae.replace(/↤/g,"</span>")}else{if(A.is(ae)){for(var Q=0,av=aA.length;Q<av;Q++){ae=ae.replace(aA[Q],"\u2700$&\u2710")}ae=ae.replace(ai,'<span class="highlightedSearchCriteria">');ae=ae.replace(aF,"</span>")}}U.grid[aq[Z]]=ae}}}}}}U.clickableTitle=ah}if(A.is(U)&&A.is(U.isAShowOnlyObject,"function")&&U.isAShowOnlyObject()){var ab=this.getAttributesToRetrieve();if(Array.isArray(ab)&&ab.length>0){for(var az=0;az<ab.length;az++){var ac=ab[az];if(!U.grid.hasOwnProperty(ac)){var aC=I.get("no_access");U.grid[ac]='<span class="NoAccessSearchCriteria">'+aC+"</span>"}}}}var am=au.getCollectiveViewOptions(U,N,ay,aD,ad);Object.assign(U,am);var Y=new p(U);V.addRoot(Y)}V.pushUpdate()}return new Promise(function(aM,aL){aM()})},_getSnippetAttributeCorrespondingToPredicate:function(P){var O={snippetAttrName:"",gotSnippetAttribute:false};if(f.isSnippetAvailable(this.search_ressources.getActiveTenant())===true){if(A.is(P,"object")){var M=P.predicateName;var N=P.select_snippets;if(A.is(M,"string")){if(!A.is(N,"object")){N=z.getOption("select_snippets")}if(A.is(N,"object")){if(N.hasOwnProperty(M)){O.snippetAttrName=N[M];O.gotSnippetAttribute=true}}}}}return O},highlightRegexInStringJustOnce:function(O,N){var M=O;if(A.is(O,"string")){var P=O.split(" ");P.forEach(function(R,Q){if(R.indexOf("highlightedSearchCriteria")<0){P[Q]=R.replace(N,'<span class="highlightedSearchCriteria">$&</span>')}});M=P.join(" ")}return M},extractAllMatchesFromSnippetInfos:function(N){var M=[];N.forEach(function(P){var O=P.get("snippet");if(A.is(O)){O.split("↦").forEach(function(Q){var R=Q.split("↤");if(R.length>1){M.push(R[0])}})}});return M},_getValueWithHighlightByConcatenationOfSnippet:function(T){var P={valueWithHighlight:""};var Q="";if(A.is(T)&&A.is(T.searchItemModel)&&A.is(T.SnippetAttr)){var M=T.SnippetAttr;var S=T.searchItemModel;if(A.is(S)){var O=undefined;if(A.is(S)&&A.is(S.get,"function")){O=S.get(M+"_value")}else{if(A.is(S.grid[M])){O=S.grid[M]}}if(A.is(O,"string")){var N=JSON.parse(O);if(A.is(N,"object")&&A.is(N.text,"array")&&N.text.length>0){for(var R=0;R<N.text.length;R++){if(A.is(N.text[R].content,"string")){var U=f.escapeHtml(N.text[R].content);if(A.is(N.text[R].highlighted)&&"true"===N.text[R].highlighted){Q+='<span class="highlightedSearchCriteria">'+U+"</span>"}else{Q+=U}}}}}}}P.valueWithHighlight=Q;return P},_sanitizePredicates:function(R){var Q=[];if(f.isSnippetAvailable(this.search_ressources.getActiveTenant())===true){var O=z.getOption("select_snippets");if(A.is(O)&&A.is(O,"object")){Q=Object.keys(O).map(function(S){return O[S]})}}var N={};if(A.is(R)){var P=Object.keys(R);if(P.length>0&&A.is(P,"array")){for(var M=0;M<P.length;M++){if(A.is(Q,"array")&&Q.indexOf(P[M])==-1){N[P[M]]=R[P[M]]}}}}return N},getNlsOfPropertiesValuesSearchTag:function(N,M,P){var O=this;P=O._sanitizePredicates(P);this._tagsTransformer.addSource(P,this.search_ressources.getActiveTenant());n.getNlsOfPropertiesValues(JSON.stringify(P),{tenantId:O.search_ressources.active_tenant,lang:f.getLanguage(),TagURL6WId:n._6WTagURL,onComplete:function(an){O._tagsTransformer.setNlsNameDetails(an);var ai=/\w+:\w+\.\w+/;if(A.is(N)){var al=Object.getOwnPropertyNames(N);if(A.is(al,"array")){for(var ah=0,W=al.length;ah<W;ah++){for(var af=0,ak=N[al[ah]].length;af<ak;af++){if(A.is(N[al[ah]][af])&&A.is(N[al[ah]][af].sixw)&&A.is(N[al[ah]][af].object)){var ad=N[al[ah]][af].sixw.slice(N[al[ah]][af].sixw.lastIndexOf("/")+1,N[al[ah]][af].sixw.length);if(A.is(an)&&A.is(an[ad])&&A.is(N[al[ah]][af].object)){var aa=N[al[ah]][af].object;if(A.is(aa,"array")){if(aa.length>0){var ab=aa[0],Q="";for(var ao=0,aj=aa.length;ao<aj;ao++){ab=O._tagsTransformer.prepareNlsPropertiesValueForServer(ad,ab);Q=an[ad][ab];if(Q===ab){Q=aa[ao]}N[al[ah]][af].dispValue[ao]=Q;if(ao<aj-1){ab+="/"+aa[ao+1]}}}}else{N[al[ah]][af].dispValue=an[ad][N[al[ah]][af].object];if("ds6w:status"===ad){var ac=null;if(A.is(aa,"string")){ac=aa.split(".")[0]}if(A.is(ac)&&A.is(an["ds6w:policy"])&&A.is(an["ds6w:policy"][ac])){var U=an["ds6w:policy"][ac];N[al[ah]][af].dispValue+=" ("+U+")"}}}}else{console.warn("Pb with "+ad)}}}}}if(A.is(M,"array")){var T={},Y={};for(var ah=0,W=M.length;ah<W;ah++){if(A.is(M[ah])){var ad=M[ah].sixw.slice(M[ah].sixw.lastIndexOf("/")+1,M[ah].sixw.length);if(A.is(an)&&A.is(an[ad])&&A.is(M[ah].object)){var aa=M[ah].object;if(A.is(aa,"array")){if(aa.length>0){var ab=aa[0],Q="";M[ah].dispValue=[];for(var ao=0,aj=aa.length;ao<aj;ao++){if(ai.test(ab)){var Z=ab.lastIndexOf("/");if(Z>-1){ab=ab.slice(0,ab.lastIndexOf("/")+1)+ab.slice(ab.lastIndexOf(".")+1)}else{ab=ab.slice(ab.lastIndexOf(".")+1)}}ab=O._tagsTransformer.prepareNlsPropertiesValueForServer(ad,ab);Q=an[ad][ab];if(Q===ab||!A.is(Q)){Q=aa[ao]}M[ah].dispValue[ao]=Q;if(ao<aj-1){ab+="/"+aa[ao+1]}}}}else{M[ah].dispValue=an[ad][M[ah].object]}if("ds6w:status"===ad){if(A.is(T[M[ah].dispValue])){T[M[ah].dispValue].push({index:ah,object:M[ah].object})}else{T[M[ah].dispValue]=[{index:ah,object:M[ah].object}]}}else{if("ds6w:policy"===ad){Y[M[ah].object]=M[ah].dispValue}}}else{console.warn("Pb with "+ad)}}}var X=Object.getOwnPropertyNames(T);for(var V=0,ag=X.length;V<ag;V++){for(var ae=0,S=T[X[V]].length;ae<S;ae++){var R=T[X[V]][ae].object;var am=null;if(A.is(R,"string")){am=R.split(".")}else{c.warn("ds6wStatus is not a string :",R)}if(A.is(am,"array")&&am.length>1){if(A.is(am[0],"string")&&A.is(Y[am[0]])){R=Y[am[0]]}}M[T[X[V]][ae].index].dispValue+=" ("+R+")"}}}O.options.tagger_proxy.setTags(N,M);O._setTagsPredicates(M)}},onFailure:function(){console.error("Failure calling DS/i3DXSNDictionaryAPI/3DXSearchDictionaryAccess.getNlsOfPropertiesValues !",arguments);O.options.tagger_proxy.setTags(N,M);O._setTagsPredicates(M)}})},getNlsOfPropertiesValuesSearch:function(P,Q,N,O){var M=this;O=M._sanitizePredicates(O);n.getNlsOfPropertiesValues(JSON.stringify(O),{tenantId:M.search_ressources.active_tenant,lang:f.getLanguage(),TagURL6WId:n._6WTagURL,onComplete:function(ae){var Z=P._models;M.log("getNlsOfPropertiesValuesSearch response:"+ae);var ah=Object.getOwnPropertyNames(ae);var aa=/\w+:\w+\.\w+/;for(var U=0,S=Z.length;U<S;U++){for(var af=0,V=ah.length;af<V;af++){var ad=Z[U]._attributes[ah[af]];if(A.is(ad,"array")){for(var ac=0,X=ad.length;ac<X;ac++){var R=Z[U]._attributes[ah[af]+"_value"][ac];var Y="";if(!A.is(R,"array")){if(aa.test(R)){R=R.slice(R.lastIndexOf(".")+1)}if(ae[ah[af]]){Y=ae[ah[af]][R]}}else{var ab=[];var W=R;for(var ag=0,T=W.length;ag<T;ag++){if(0===ag){R=W[ag]}else{R+="/"+W[ag]}ab.push(R)}for(ag=0,T=ab.length;ag<T;ag++){if(ag>0){Y+="/"}Y+=ae[ah[af]][ab[ag]]}}if(A.is(Y,"string")){if(0!==Y.indexOf("emxFramework.Range.")){Z[U]._attributes[ah[af]][ac]=f.escapeHtml(Y)}}else{console.error("Error, bad response from getNlsOfPropertiesValuesSearch !")}}}else{if(A.is(ad,"string")){var R=Z[U]._attributes[ah[af]+"_value"];if(aa.test(R)){R=R.slice(R.lastIndexOf(".")+1)}if(ae[ah[af]]){Y=ae[ah[af]][R]}if(A.is(Y,"string")){if(0!==Y.indexOf("emxFramework.Range.")){Z[U].set(ah[af],f.escapeHtml(Y))}}else{console.error("Error, bad response from getNlsOfPropertiesValuesSearch !")}}}}}if(A.is(Q,"function")&&A.is(N)){return Q.apply(this,N)}},onFailure:function(){console.error("Failure when calling 3DXSearchDictionaryAccess.getNlsOfPropertiesValuesSearch => Unable to retrieve NLS !");if(A.is(Q,"function")&&A.is(N)){return Q.apply(this,N)}}})},_setTagsPredicates:function(T){if(!A.is(T,"array")){return}if(A.is(this.options.tagger_proxy.setPredicates,"function")){var S=this.getSearchRessources();var N=z.getOption("relevant_tags",{tenant:S.active_tenant});var O=UWA.clone(N);var Q="";var R=z.getOption("alwaysEnableFreeInputInTagger");for(var P=0,M=T.length;P<M;P++){if(A.is(T[P])&&A.is(T[P].sixw)){Q=f.getURIToUse(T[P].sixw);if(A.is(Q)&&Q.length>0){if(!A.is(O[Q])){O[Q]={}}if(!A.is(O[Q].allowFreeInput)){O[Q].allowFreeInput=true}if(true!==R&&true===O[Q].allowFreeInput){if(T[P].dispValue!==T[P].object){O[Q].allowFreeInput=false}}}}}this.options.tagger_proxy.setPredicates(O)}},_retrieveLastIndexingDate:function(O){this._indexingDate=null;if(A.is(O)&&A.is(O.response_infos)&&A.is(O.response_infos.sources,"array")){var P={};for(var N=0,M=O.response_infos.sources.length;N<M;N++){var R=O.response_infos.sources[N];if(A.is(R,"object")&&A.is(R.indexingDate,"object")){P[R.name]=R.indexingDate}}if(A.is(P["3dspace"])){this._indexingDate=P["3dspace"]}else{if(A.is(P.drive)){this._indexingDate=P.drive}else{var Q=Object.keys(P);if(Q.length>0){this.log("no indexingDate info found for 3dspace or drive source, taking the info available for "+Q[0]);this._indexingDate=P[Q[0]]}else{this.log("no indexingDate info found in the FedSearch response")}}}}},updateModelsWithPreferredUnits:function(O){var N=this;var M=function(U){var Q=this;var R=arguments;var P=function(Y){var X={};var V={};var W={};Y.forEach(function(Z){var ac=Z.get("sourceid_value");if(ac&&ac=="3dspace"){var aa=Z.get("ds6w:type_value");if(aa){if(aa.indexOf(":")<1){aa="ds6wg:"+aa}var ab=Z.keys();ab.forEach(function(ad){if(/ds6wg:\w+\.\w+/.test(ad)&&Z.get(ad+"_value")){var ae=V[ad];if(!ae){V[ad]=[];ae=V[ad]}ae.push(Z.get(ad+"_value"));W[ad]=aa}})}}});X.data=V;X.predicate2Type=W;return X};var S=function(W,V){W.forEach(function(X){var Y=X.keys();Y.forEach(function(aa){if(aa.startsWith("ds6wg:")){var ac=V[aa];if(ac){var Z=X.get(aa+"_value");var ab=ac[Z];if(ab){X.set(aa,ab)}}}})})};var T=P.call(undefined,U._models);r.setResources(N.search_ressources);r.convertValues({toPreferredUnit:true,data:T.data,predicate2Type:T.predicate2Type,callback:function(V){S.call(undefined,U._models,V);if(O){return O.apply(Q,R)}}})};if(O){return M}else{M.call(this,{_models:this.toArray()})}},getSocketID:function(){if(A.is(this._searchcom_socket)){return this._searchcom_socket.id}},updateSwymTypeIcon:function(M){M.forEach(function(P){var N=P._attributes.sourceid_value;if(A.is(N)&&N.indexOf("swym")!==-1){var R=P.get("type_icon_url");if(A.is(R)){if(R.lastIndexOf("/large-icons")===-1){var S=R.lastIndexOf("/");var Q=R.substring(0,S);var O=Q+"/large-icons"+R.substring(S);P._attributes.type_icon_url=O}}}})}})});define("DS/SNResultUX/views/SearchDataGridView",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Debug","DS/Tree/TreeDocument","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SWFiltering","DS/SNResultUX/utils/SearchCustoServices","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchViewOptions","DS/SNResultUX/views/SearchGridView","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNResultUX/utils/SearchDataGridPreferences"],function(l,e,j,a,c,f,g,m,h,q,d,i,o,b,n,p,k){return n.extend({tagName:"div",className:"DataGridView",attributes:{styles:{width:"100%"},"data-rec-id":"DataGridView"},IDENTIFIER:"3dSearch-datagrid-identifier",_fixTh:["ds6w:label","ds6w:who/ds6w:responsible","ds6w:when/ds6w:created","ds6w:when/ds6w:modified","ds6w:responsible","ds6w:created","ds6w:modified"],_defaultColumnDef:{width:"auto",typeRepresentation:"string"},_columns:[],_columnsForDataGrid:[],_currentCustoViewId:null,_columnsAttributes:[],_subscriptions:[],_forcedCustoView:null,collection:null,oSearchDataGridPreferences:null,nestedView:null,init:function(r){var t=this;this._parent(r);this._columns=l.clone(this._columnsAttributes);if(l.is(this.collection&&this.collection.getSNSkeleton())){this._subscriptions.sortForAllView=c.subscribe({channel:this.collection.getSNSkeleton().getOption("messagingChannel"),topic:"sortForAllView",callback:function(u){if(!l.is(t.view)){throw new Error("[SarchDataGridView] : callback sort - datagrid object is undefined.")}t.view.sortModel=[{dataIndex:u.order_field,sort:u.order_by}];t.view._updateRenderedCellAttributes(t.view.layout.getCellIDFromCoordinates({rowID:-1,columnID:t.view.layout.getColumnIndex(u.order_field)}))}})}},setup:function(r){this._parent(r);var t=this;this.listenTo(this.collection,{onSync:function(){t.view&&t._updateAfterCollectionSync()}})},_updateAfterCollectionSync:function(){for(var r=0;r<this.view.columns.length;r++){this.view.columns[r].sortableFlag=(this.collection.state.totalRecords<=1000)?true:i.isColumnSortable(this.view.columns[r].dataIndex)}this.view._applyColumns()},_resizeColumn:function(r,t){if(!l.is(this.view)){return}this.view.layout.setColumnWidth(r,t,{isUserInteraction:false})},_reinitColums:function(v){var w=this;this._forcedCustoView=null;this._currentCustoViewId=this._lastSelectedCustoViewId;this._reinitColumnsWidth();if(l.is(this.collection.service_parameters)&&l.is(this.collection.options.tagger_proxy)){var u={isPQ:this.collection.service_parameters.isAPQSearch?true:false,typeName:this.collection.getPQ()};var t=(l.is(this.collection.service_parameters.isAPQSearch)&&true===this.collection.service_parameters.isAPQSearch&&l.is(this.collection.getPQ())&&l.is(this.collection.getPQ().pqName,"string")&&this.collection.getPQ().pqName.length>0)?true:false;var r=i.getColumnCustomizationIdToUse(u);if(l.is(r,"string")&&r.length>0){this._currentCustoViewId=r;this._columnsAttributes=i.getColumnCustomizationDefinitionFromCustoId(r)}if(l.is(this.collection.service_parameters)&&l.is(this.collection.options.tagger_proxy)){this._reinitColumsGetFilters(this.collection.options.tagger_proxy.getCurrentFilter(),this.collection.service_parameters.refine,t,u)}}if(!l.is(this._columnsAttributes)||(l.is(this._columnsAttributes)&&this._columnsAttributes.length<1)){this._columnsAttributes=b.getDataGridViewHeaders()}if(l.is(w.collection)&&l.is(w.collection.service_parameters)&&l.is(w.collection.service_parameters.query)&&g.SearchTypeEnum.MY_RECENT_CONTENT===w.collection.service_parameters.query){this._columnsAttributes.forEach(function(x){if(-1!==x.dataIndex.indexOf("/")){x.dataIndex=x.dataIndex.slice(x.dataIndex.indexOf("/")+1,x.dataIndex.length)}})}this._columns=l.clone(this._columnsAttributes);this.collection.getAttributesToRetrieve(this._columns);this._comptuteNewColumnsNLS()},_reinitColumnsWidth:function(){if(h.getItem("listColumnsWidth")&&this.view){try{var v=JSON.parse(h.getItem("listColumnsWidth"));var t=Object.keys(v);for(var r=0;r<this.view.columns.length;r++){if(-1!=t.indexOf(this.view.columns[r].dataIndex)){this.view.columns[r].width=v[this.view.columns[r].dataIndex]}}}catch(u){console.log(u)}}if("The_Default_Columns"===this._currentCustoViewId){if(h.getItem("listColumnsWidth")){try{var v=JSON.parse(h.getItem("listColumnsWidth"));var t=Object.keys(v);this._columnsAttributes.forEach(function(x,w){x.width=(t.indexOf(x.dataIndex)==-1)?"auto":v[x.dataIndex]})}catch(u){console.log(u)}}else{this._columnsAttributes.forEach(function(x,w){x.width="auto"})}}},_reinitColumsGetFilters:function(x,t,z,v){if((this.collection.service_parameters.query===g.SearchTypeEnum.ADVANCED_SEARCH)&&l.is(t)&&(""===t)){this._columnsAttributes=i.getColumnCustomizationDefinitionFromCustoId("The_Default_Columns")}else{if(l.is(x)&&l.is(x.allfilters)&&l.is(t)&&l.is(t.allfilters)){if(this.collection.service_parameters.query!==g.SearchTypeEnum.ADVANCED_SEARCH&&(Object.keys(x.allfilters).length>0&&(l.is(x.allfilters["ds6w:what/ds6w:type"])&&x.allfilters["ds6w:what/ds6w:type"].length>0||l.is(x.allfilters["ds6w:what/ds6w:kind"])&&x.allfilters["ds6w:what/ds6w:kind"].length>0))){var y=[];if(l.is(t.allfilters["ds6w:what/ds6w:type"])&&!l.is(t.allfilters["ds6w:what/ds6w:kind"])){y=t.allfilters["ds6w:what/ds6w:type"]}else{if(l.is(t.allfilters["ds6w:what/ds6w:kind"])&&!l.is(t.allfilters["ds6w:what/ds6w:type"])){y=t.allfilters["ds6w:what/ds6w:kind"]}else{if(l.is(t.allfilters["ds6w:what/ds6w:kind"])&&l.is(t.allfilters["ds6w:what/ds6w:type"])){y=t.allfilters["ds6w:what/ds6w:type"].concat(t.allfilters["ds6w:what/ds6w:kind"])}}}var u=[];for(var A=0;A<y.length;A++){var w=i.getColumnCustomizationAliasIdToUse(y[A].object);u.push(w)}var B=u.filter(function(E,D,C){return C.indexOf(E)===D});if(1===B.length&&l.is(B[0])){this._currentCustoViewId=B[0];this._columnsAttributes=i.getColumnCustomizationDefinitionFromAliasCustoId(this._currentCustoViewId);if(this._isCurrentView&&!(l.is(search_opts)&&l.is(search_opts.refresh))){o._displayAlert({message:p.get("SearchDataGridPreferences_modal_typeCusto"),className:"success",widgetId:this.getOption("widgetId")})}}}else{if(l.is(x.allfilters)&&((Object.keys(x.allfilters).length===1&&(l.is(x.allfilters["sixw:ds6w:what/ds6w:type"])))||Object.keys(x.allfilters).length===2&&(l.is(x.allfilters["sixw:ds6w:what/ds6w:type"])||l.is(x.allfilters["sixw:vpmextension"])))||(Object.keys(x.allfilters).length===3&&(l.is(x.allfilters["sixw:ds6w:what/ds6w:type"])||l.is(x.allfilters["sixw:vpmextension"])))){var y=[];if(l.is(x.allfilters["sixw:ds6w:what/ds6w:type"])&&!l.is(x.allfilters["sixw:vpmextension"])){y=x.allfilters["sixw:ds6w:what/ds6w:type"]}else{if(l.is(x.allfilters["sixw:vpmextension"])&&!l.is(x.allfilters["sixw:ds6w:what/ds6w:type"])){y=x["sixw:vpmextension"]}else{if(l.is(x.allfilters["sixw:vpmextension"])&&l.is(x.allfilters["sixw:ds6w:what/ds6w:type"])){y=x.allfilters["sixw:ds6w:what/ds6w:type"].concat(x.allfilters["sixw:vpmextension"])}}}var u=[];for(var A=0;A<y.length;A++){var w=i.getColumnCustomizationAliasIdToUse(y[A].object.slice(6));u.push(w)}var B=u.filter(function(E,D,C){return C.indexOf(E)===D});if(B.length===1&&l.is(B[0])){this._currentCustoViewId=B[0];this._columnsAttributes=i.getColumnCustomizationDefinitionFromAliasCustoId(this._currentCustoViewId);if(this._isCurrentView&&!(l.is(search_opts)&&l.is(search_opts.refresh))){o._displayAlert({message:p.get("SearchDataGridPreferences_modal_typeCusto"),className:"success",widgetId:this.getOption("widgetId")})}}}else{if(z){var r=i.getColumnCustomizationIdToUse(v);if(l.is(r,"string")&&r.length>0){this._currentCustoViewId=r;this._columnsAttributes=i.getColumnCustomizationDefinitionFromCustoId(r)}}else{this._columnsAttributes=i.getColumnCustomizationDefinitionFromCustoId(this._currentCustoViewId)}}}}else{this._columnsAttributes=i.getColumnCustomizationDefinitionFromCustoId(this._currentCustoViewId)}}},_comptuteNewColumnsNLS:function(){var E=this;var w={};var B=["ds6wg:PLMEntity"];if(l.is(this.collection.service_parameters)&&(this.collection.service_parameters.isAPQSearch)){var u=(l.is(this.collection.options.tagger_proxy))?this.collection.options.tagger_proxy.latest_tagValues:null;var B=[];if(l.is(u,"array")&&u.length>0){var H="";for(var G=0;G<u.length;G++){if("ds6w:what/ds6w:type"===u[G].sixw){B.push("ds6wg:"+u[G].object);H=u[G].dispValue}}B.push("ds6wg:PLMEntity");var F=B.filter(function(M,L,v){return v.indexOf(M)===L})}}var K={vocabIds:[]};for(var x=0,t=this._columnsAttributes.length;x<t;x++){if(this._columnsAttributes[x].dataIndex.startsWith("ds6wg")){if(l.is(this._columnsAttributes[x].dataType)&&!l.is(w[this._columnsAttributes[x].dataType])){w[this._columnsAttributes[x].dataType]=true;B.push(this._columnsAttributes[x].dataType)}else{var y=this._columnsAttributes[x].dataIndex;var I=y.indexOf(".");if(I>0){y=this._columnsAttributes[x].dataIndex.slice(0,I);if(!l.is(w[y])){w[y]=true;B.push(y)}}}}else{var r=this._columnsAttributes[x].dataIndex;var J=m.getVocabId(r);if(l.is(J)&&!m.isLoaded(J)){if(-1===K.vocabIds.indexOf(J)){K.vocabIds.push(J);K[J]=[]}K[J].push(r)}if(l.is(this._columnsAttributes[x].text)&&this._columnsAttributes[x].text.indexOf("ds6w")>-1){this._columnsAttributes[x].text=m.getNLSValueForPredicate(this._columnsAttributes[x].dataIndex)}}}var D=K.vocabIds.length;if(D>0){for(var C=0;C<D;C++){m.loadVocabulary(K.vocabIds[C],function(v){if(l.is(v)&&v.status==="success"){if(l.is(K[v.id])){for(var L=0;L<E._columnsAttributes.length;L++){if(-1!==K[v.id].indexOf(E._columnsAttributes[L].dataIndex)){E._columnsAttributes[L].text=m.getNLSValueForPredicate(E._columnsAttributes[L].dataIndex)}}E._updateColumnsNLS()}}else{console.warn("Error in PredicatesNLS.loadVocabulary !")}})}}if(B.length>0){m._asyncCallToPredicatesWS(B).then(function A(v){E._retrieveNewNLSSuccess(v)},function z(){console.log("promisePredicate fail !")})}},_retrieveNewNLSSuccess:function(v){if(!l.is(v.classPredicates)){console.error("Unexpected response from GetRelevantPredicates !");return null}var C=false;for(var B=0,t=this._columnsAttributes.length;B<t;B++){if(!this._columnsAttributes[B].dataIndex.startsWith("ds6wg:")){continue}for(var u=0,A=v.classPredicates.length;u<A;u++){if(!l.is(v.classPredicates[u].className)||!l.is(v.classPredicates[u].vocabularyPredicateInfo)){console.error("Unexpected response from GetRelevantPredicates !");return null}for(var z=0,r=v.classPredicates[u].vocabularyPredicateInfo.length;z<r;z++){if(v.classPredicates[u].vocabularyPredicateInfo[z].uri===this._columnsAttributes[B].dataIndex){if(this._columnsAttributes[B].text!==v.classPredicates[u].vocabularyPredicateInfo[z].nlsName){this._columnsAttributes[B].text=v.classPredicates[u].vocabularyPredicateInfo[z].nlsName;C=true}z=r;u=A}}}}var x={};for(var w=0,y=this._columnsAttributes.length;w<y;w++){if(!l.is(x[this._columnsAttributes[w].text])){x[this._columnsAttributes[w].text]=0}x[this._columnsAttributes[w].text]+=1}for(var w=0,y=this._columnsAttributes.length;w<y;w++){if(l.is(x[this._columnsAttributes[w].text])&&x[this._columnsAttributes[w].text]>1){this._columnsAttributes[w].text+=" ("+(l.is(this._columnsAttributes[w].dataType)?this._columnsAttributes[w].dataType:l.is(this._columnsAttributes[w].dataIndex)?this._columnsAttributes[w].dataIndex:w)+")";C=true}}if(true===C){h.commit();this._updateColumnsNLS()}},_updateColumnsNLS:function(){this.view.prepareUpdateView();for(var t=0;t<this._columnsAttributes.length;t++){for(var r=0;r<this.view.columns.length;r++){(this._columnsAttributes[t].dataIndex===this.view.columns[r].dataIndex)?this.view.columns[r].text=this._columnsAttributes[t].text:null}}this.view.pushUpdateView()},getMinNumberModel:function(t,r){t=t||this._rowMaxNumber;r=r||this._columnsMaxNumber;return t},onSearch:function(r){this._parent(r);this.view&&this.view.resetScrollPosition();if(l.is(this.colCustoPanel)&&l.is(this.colCustoPanel._requestClosePanel,"function")){this.colCustoPanel._requestClosePanel()}this.colCustoPanel=null;this._reinitColums(r)},_updateColumns:function(u,E,A){if(Array.isArray(u)&&this._searchcom_socket){this._searchcom_socket.dispatchEvent("checkNewColomnForSort",u);var r=u.map(function(L){return L.dataIndex});if(!l.is(this.view.sortModel)||"relevance"===this.view.sortModel[0].dataIndex){if(f.getOption("default_sort")){var w=f.getOption("default_sort");if(l.is(w,"object")&&l.is(w.order_by,"string")&&l.is(w.order_field,"string")){this.collection.service_parameters.order_field=w.order_field;this.collection.service_parameters.order_by=w.order_by}}else{if(f.getOption("apply_sort_on_modified_by_default")){this.collection.service_parameters.order_field="ds6w:modified";this.collection.service_parameters.order_by="desc"}else{this.collection.service_parameters.order_field="";this.collection.service_parameters.order_by=""}}}}var t="",H="",x,y=false;if(l.is(E,"string")){t=E;H=E}else{if(l.is(E,"object")){t=E.custoName;x=E.custoNLS;H=E.custoId;if(l.is(E.favPQ)&&true===E.favPQ){y=true}}}this._currentCustoViewId=H;var F=[];u=b.getCustoCellRequest(u);for(var D=0,J=u.length;D<J;D++){if(l.is(u[D],"object")){var C=u[D].dataIndex;F.push(C.slice(C.lastIndexOf("/")+1,C.length))}}this.collection.setAttributesToRetrieve(F);var K=h.getItem("DataGridColumnCusto");var z=[];if(l.is(K)){if(l.is(K.activeView)&&false===y){this._lastSelectedCustoViewId=K.activeView}if(l.is(K.views)){z=K.views}}var I=this.getOption("widgetId");if(H!=="The_Default_Columns"){if(true===A){for(var B=z.length-1;B>=0;B--){if(z[B].viewId===H){z.splice(B,1)}}z.push({viewId:H,viewDefinition:u,version:2})}var G={views:z};if(false===y){G.activeView=H}else{if(l.is(K)&&l.is(K.activeView)){G.activeView=K.activeView}}h.setItem("DataGridColumnCusto",G);h.commit();if(true===A&&H!=="TEMP_CUSTO"){o._displayAlert({message:p.replace(p.get("SearchDataGridPreferences_modal_saveSuccessful"),{custo_name:l.is(x,"string")?x:t}),className:"success",widgetId:I})}else{if(H!=="TEMP_CUSTO"){var v=t;if(v.endsWith("-ADMIN")){v=v.slice(0,-6)}if(v.startsWith("###")){v=p.replace(p.get("custo_PQ"),{PQ:v.substring(3,v.length)})}(v.endsWith("-HIDDEN"))?o._displayAlert({message:p.get("SearchDataGridPreferences_modal_resetDone"),className:"success",widgetId:I}):o._displayAlert({message:p.replace(p.get("SearchDataGridPreferences_modal_applySuccessful"),{custo_name:v}),className:"success",widgetId:I})}else{o._displayAlert({message:p.get("SearchDataGridPreferences_modal_applyTempCustoSuccessful"),className:"success",widgetId:I})}}}else{var K=h.getItem("DataGridColumnCusto");if(l.is(K)){K.activeView="The_Default_Columns"}this._lastSelectedCustoViewId="The_Default_Columns";h.setItem("DataGridColumnCusto",K);h.commit();o._displayAlert({message:p.get("SearchDataGridPreferences_modal_resetDone"),className:"success",widgetId:I})}this._columnsAttributes=u;this._columns=l.clone(this._columnsAttributes);this._forcedCustoView=H;this.view.destroy();this.render(true)},_removeColumnCustoMask:function(){if(l.is(this.collection)&&l.is(this.collection._snSkeleton)&&l.is(this.collection._snSkeleton.getSearchActions,"function")){var r=this.collection._snSkeleton.getSearchActions();if(l.is(r)&&l.is(r.removeMask,"function")){r.removeMask()}}},defineColumnCusto:function(){var y=this;var z=null;var x=this.getOption("widgetId");if(!l.is(this.zIndexToUse)){this.zIndexToUse=g.getZIndex(this.container)}if(this.collection.isEmpty()){o._displayAlert({message:p.get("ColumnCustomization_error_noResult"),className:"warning",widgetId:x});this._removeColumnCustoMask();return null}if(l.is(this.collection)&&l.is(this.collection.service_parameters)&&l.is(this.collection.service_parameters.query)&&g.SearchTypeEnum.MY_RECENT_CONTENT===this.collection.service_parameters.query){o._displayAlert({message:p.get("SearchDataGridPreferences_error_RecentModeNotSupported"),className:"warning",widgetId:x});this._removeColumnCustoMask();return null}var C=false;var E=[];var F=null;if(l.is(this.collection.options.tagger_proxy)){F=this.collection.options.tagger_proxy.latest_tagValues}if(l.is(this.collection.service_parameters.isAPQSearch)&&this.collection.service_parameters.isAPQSearch===true){var D=this.collection.getPQ();if(l.is(D)&&l.is(D.pqName,"string")&&D.pqName.length>0){C=true;z={typeName:D,isPQ:true};if(l.is(F,"array")&&F.length>0){for(var w=0;w<F.length;w++){var H=F[w];(H.sixw==="ds6w:what/ds6w:type")?E.push("ds6wg:"+H.object):null}}}}E.push("ds6wg:PLMEntity");var v=null;if(l.is(this.collection.options.tagger_proxy)){v=this.collection.options.tagger_proxy.getCurrentFilter()}if(!l.is(z)&&!(l.is(v)&&l.is(v.allfilters)&&((l.is(v.allfilters["ds6w:what/ds6w:type"])&&1===v.allfilters["ds6w:what/ds6w:type"].length)||(l.is(v.allfilters["ds6w:what/ds6w:kind"])&&1===v.allfilters["ds6w:what/ds6w:kind"].length)||(l.is(v.allfilters["sixw:ds6w:what/ds6w:type"])&&1===v.allfilters["sixw:ds6w:what/ds6w:type"].length)||(l.is(v.allfilters["sixw:ds6w:what/ds6w:kind"])&&1===v.allfilters["sixw:ds6w:what/ds6w:kind"].length)))&&!C){o._displayAlert({message:p.get("SearchDataGridPreferences_error_OnlyOneTypeOrSubTypeSupported"),className:"warning",widgetId:x});this._removeColumnCustoMask();return null}var t=false;var B=null;if(l.is(v)&&l.is(v.allfilters)){if(l.is(v.allfilters["ds6w:what/ds6w:kind"])&&1===v.allfilters["ds6w:what/ds6w:kind"].length&&l.is(v.allfilters["ds6w:what/ds6w:kind"][0].object)&&l.is(v.allfilters["ds6w:what/ds6w:kind"][0].disptext)){z={typeName:v.allfilters["ds6w:what/ds6w:kind"][0].disptext,isPQ:false};var A=["ds6wg:"+v.allfilters["ds6w:what/ds6w:kind"][0].object];E.push(A)}else{if(l.is(v.allfilters["ds6w:what/ds6w:type"])&&1===v.allfilters["ds6w:what/ds6w:type"].length&&l.is(v.allfilters["ds6w:what/ds6w:type"][0].object)&&l.is(v.allfilters["ds6w:what/ds6w:type"][0].disptext)){t=true;z={typeName:v.allfilters["ds6w:what/ds6w:type"][0].disptext,isPQ:false,className:"ds6wg:"+v.allfilters["ds6w:what/ds6w:type"][0].object};B=v.allfilters["ds6w:what/ds6w:type"][0].object;E.push(B)}else{if(l.is(v.allfilters["sixw:vpmextension"])&&1===v.allfilters["sixw:vpmextension"].length&&l.is(v.allfilters["sixw:vpmextension"][0].object)&&l.is(v.allfilters["sixw:vpmextension"][0].displayValue)){z={typeName:v.allfilters["sixw:vpmextension"][0].displayValue,isPQ:false};var u=[v.allfilters["sixw:vpmextension"][0].object];E.push(u)}else{if(l.is(v.allfilters["sixw:ds6w:what/ds6w:type"])&&1===v.allfilters["sixw:ds6w:what/ds6w:type"].length&&l.is(v.allfilters["sixw:ds6w:what/ds6w:type"][0].object)&&l.is(v.allfilters["sixw:ds6w:what/ds6w:type"][0].displayValue)){t=true;z={typeName:v.allfilters["sixw:ds6w:what/ds6w:type"][0].displayValue,isPQ:false,className:v.allfilters["sixw:ds6w:what/ds6w:type"][0].object};B=v.allfilters["sixw:ds6w:what/ds6w:type"][0].object;E.push(B)}}}}}if(t){q.loadRelevantInterfaces(B,function(M){var O=[];for(var L=0;L<M.interfaces.length;L++){if(UWA.is(M.interfaces[L]["automatic"])&&M.interfaces[L]["automatic"]==="Yes"||UWA.is(M.interfaces[L]["Automatic"])&&M.interfaces[L]["Automatic"]==="Yes"){var K="";K=K.concat("ds6wg:",M.interfaces[L]["name"]);E.push(K);O.push(K)}}E.filter(function(S,R,Q){return R==Q.indexOf(S)});var N=m._asyncCallToPredicatesWS(E).then(function P(Q){y.renderColumnsWithSuccess(Q,y,z,O)},function J(Q){y.renderColumnsWithFailure(y,z,Q)})})}else{E.filter(function(L,K,J){return K==J.indexOf(L)});var I=m._asyncCallToPredicatesWS(E).then(function G(J){y.renderColumnsWithSuccess(J,y,z)},function r(J){y.renderColumnsWithFailure(y,z,J)})}},renderColumnsWithSuccess:function(w,D,E,u){var B=[];var I={};var z={};for(var v=0,G=w.classPredicates.length;v<G;v++){if(!l.is(w.classPredicates[v].className)||!l.is(w.classPredicates[v].vocabularyPredicateInfo)){console.warn("Unexpected response from GetRelevantPredicates !");D._removeColumnCustoMask();return null}if(l.is(E.className)&&E.className.length>0){for(var H=0,t=w.classPredicates[v].vocabularyPredicateInfo.length;H<t;H++){if(l.is(w.classPredicates[v].vocabularyPredicateInfo[H],"object")&&l.is(w.classPredicates[v].vocabularyPredicateInfo[H].nlsName,"string")&&l.is(w.classPredicates[v].vocabularyPredicateInfo[H].uri,"string")&&l.is(w.classPredicates[v].vocabularyPredicateInfo[H].name,"string")&&w.classPredicates[v].className===E.className){if(!l.is(z[w.classPredicates[v].vocabularyPredicateInfo[H].nlsName])){z[w.classPredicates[v].vocabularyPredicateInfo[H].nlsName]=[]}if(!l.is(I[w.classPredicates[v].vocabularyPredicateInfo[H].uri])){z[w.classPredicates[v].vocabularyPredicateInfo[H].nlsName].push(w.classPredicates[v].vocabularyPredicateInfo[H].uri);B.push({dispValue:w.classPredicates[v].vocabularyPredicateInfo[H].nlsName,sixw:w.classPredicates[v].vocabularyPredicateInfo[H].uri,type:g._getPredicateTypeFromDataType(w.classPredicates[v].vocabularyPredicateInfo[H])||"string",relatedObjectType:w.classPredicates[v].className,name:w.classPredicates[v].vocabularyPredicateInfo[H].name});I[w.classPredicates[v].vocabularyPredicateInfo[H].uri]=true}}else{console.warn("Invalid data returned by Predicates WS for class "+w.classPredicates[v].className+" for index "+H+" !");console.warn(w.classPredicates[v].vocabularyPredicateInfo)}}}else{if(l.is(E.typeName)){for(var H=0,t=w.classPredicates[v].vocabularyPredicateInfo.length;H<t;H++){if(l.is(w.classPredicates[v].vocabularyPredicateInfo[H],"object")&&l.is(w.classPredicates[v].vocabularyPredicateInfo[H].nlsName,"string")&&l.is(w.classPredicates[v].vocabularyPredicateInfo[H].uri,"string")&&l.is(w.classPredicates[v].vocabularyPredicateInfo[H].name,"string")){if(!l.is(z[w.classPredicates[v].vocabularyPredicateInfo[H].nlsName])){z[w.classPredicates[v].vocabularyPredicateInfo[H].nlsName]=[]}if(!l.is(I[w.classPredicates[v].vocabularyPredicateInfo[H].uri])){z[w.classPredicates[v].vocabularyPredicateInfo[H].nlsName].push(w.classPredicates[v].vocabularyPredicateInfo[H].uri);B.push({dispValue:w.classPredicates[v].vocabularyPredicateInfo[H].nlsName,sixw:w.classPredicates[v].vocabularyPredicateInfo[H].uri,relatedObjectType:w.classPredicates[v].className,name:w.classPredicates[v].vocabularyPredicateInfo[H].name});I[w.classPredicates[v].vocabularyPredicateInfo[H].uri]=true}}else{console.warn("Invalid data returned by Predicates WS for class "+w.classPredicates[v].className+" for index "+H+" !");console.warn(w.classPredicates[v].vocabularyPredicateInfo)}}}}if(l.is(u)&&u.length>0){for(var H=0,t=w.classPredicates[v].vocabularyPredicateInfo.length;H<t;H++){for(var x=0,F=u.length;x<F;x++){if(l.is(w.classPredicates[v].vocabularyPredicateInfo[H],"object")&&l.is(w.classPredicates[v].vocabularyPredicateInfo[H].nlsName,"string")&&l.is(w.classPredicates[v].vocabularyPredicateInfo[H].uri,"string")&&l.is(w.classPredicates[v].vocabularyPredicateInfo[H].name,"string")&&w.classPredicates[v].className===u[x]){if(!l.is(z[w.classPredicates[v].vocabularyPredicateInfo[H].nlsName])){z[w.classPredicates[v].vocabularyPredicateInfo[H].nlsName]=[]}if(!l.is(I[w.classPredicates[v].vocabularyPredicateInfo[H].uri])){z[w.classPredicates[v].vocabularyPredicateInfo[H].nlsName].push(w.classPredicates[v].vocabularyPredicateInfo[H].uri);B.push({dispValue:w.classPredicates[v].vocabularyPredicateInfo[H].nlsName,sixw:w.classPredicates[v].vocabularyPredicateInfo[H].uri,relatedObjectType:w.classPredicates[v].className,name:w.classPredicates[v].vocabularyPredicateInfo[H].name});I[w.classPredicates[v].vocabularyPredicateInfo[H].uri]=true}}else{console.warn("Invalid data returned by Predicates WS for class "+w.classPredicates[v].className+" for index "+H+" !");console.warn(w.classPredicates[v].vocabularyPredicateInfo)}}}}}var C=d.getSelectPredicates();if(l.is(C,"array")){for(var r=B.length-1;r>=0;r--){if(-1===C.indexOf(B[r].sixw)){B.splice(r,1)}}}for(var y=0,A=B.length;y<A;y++){if(l.is(z[B[y].dispValue],"array")&&z[B[y].dispValue].length>1){B[y].dispValue+=" ("+B[y].relatedObjectType+":"+B[y].sixw+")"}}D._launchColumnCustoPanel(E,D._columnsAttributes,B)},renderColumnsWithFailure:function(v,r,t){console.error("promisePredicate fail !",arguments);var u=p.get("SearchDataGridPreferences_error_UnableToRetrievePredicates");if(l.is(t)){if(t.message){u+="<br>"+t.message}if(t.url){u+="<br>"+t.url}}o._displayAlert({message:u,className:"warning",widgetId:v.getOption("widgetId")});s;v._launchColumnCustoPanel(r,v._columnsAttributes,[])},_launchColumnCustoPanel:function(v,t,u){var x=this,w=l.clone(t),r=i._computeColToDisplayInCustoPanel(w,u);this.colCustoPanel=new k({spreadsheet:this.nestedView.view,availableColumns:r,searchDatagridView:this,predicateIntersection:u,typeToHandle:v,zIndexToUse:this.zIndexToUse,isNewDataGrid:true});this.colCustoPanel.addEvent("onCloseColumnCustomizationPanel",function(y){if(l.is(x.colCustoPanel)&&l.is(x.colCustoPanel.destroy,"function")){x.colCustoPanel.destroy()}x.colCustoPanel=null});this._removeColumnCustoMask()},_openColumnsCustoPanel:function(){if(l.is(this.collection._snSkeleton.getSearchActions,"function")){var r=this.collection._snSkeleton.getSearchActions();if(l.is(r)&&l.is(r.columnCustomizationDefinitionUI,"function")){r.columnCustomizationDefinitionUI()}}},render:function(r){this._parent();var t=this;require(["DS/SNResultUX/views/DataGridView"],function(v){t._reinitColums(t.options);var u=b.initColumnsDataGrid({columns:l.clone(t._columnsAttributes)},t._callBackActionMenu,t.getOptionCommon().onContextualEvent.callback);t._defaultColumnDef.allowUnsafeHTMLContent=t.getOptionCommon().allowUnsafeHTMLContent;t.view=new v({treeDocument:t._model,columns:u.columns,defaultColumnDef:t._defaultColumnDef,rowSelection:(t._canMultiSelect)?"multiple":"single",cellSelection:"none",onContextualEvent:function(w){t.view.scrollerPosition=t.view.getScrollerPosition();if(w&&w.cellInfos&&-1!==w.cellInfos.rowID){return t.getOptionCommon().onContextualEvent.callback(w)}else{return(w&&w.collectionView)?w.collectionView.buildDefaultContextualMenu(w):[]}},collection:t.collection,onDragStartCell:t.getOptionCommon().onDragStartCell,onDragEndCell:t.getOptionCommon().onDragEndCellDefault,cellDragEnabledFlag:true});t.view.inject(t.container);t._afterRender(r)});return this},_callBackActionMenu:function(t){if(t){t.cancelBubble=true}if(t&&t.stopPropagation){t.stopPropagation()}if(t&&t.preventDefault){t.preventDefault()}if(!l.is(t.target.attributes["data-rec-id"])||!l.is(t.target.attributes["data-rec-id"]["nodeValue"])||!l.is(b._domAttachedEvent[t.target.attributes["data-rec-id"]["nodeValue"]])){return}var r=b._domAttachedEvent[t.target.attributes["data-rec-id"]["nodeValue"]];r.callback.call(r.target.cellView.collectionView.onContextualEvent,{treeview:r.target})},_initializeIdentifier:function(){if(!l.is(localStorage.getItem(this.IDENTIFIER))){localStorage.setItem(this.IDENTIFIER,(Date.now()/1000|0)+(Math.floor((Math.random()*1000000)+1)))}return localStorage.getItem(this.IDENTIFIER)},_afterRender:function(u){this.view.afterRender&&this.view.afterRender(this);this._model.search_multiselMode?this.toggleMultiSelMode(true):this.toggleMultiSelMode(false);if(this.collection.getRequestCriteria().service_params&&this.collection.getRequestCriteria().service_params.adv_search){var t=UWA.is(this.getOption("advSearchMgr"),"function")?this.getOption("advSearchMgr").call():null;if(UWA.is(t)){var r=false;t.getAndDisplayAdvancedSearch(r)}}this._updateAfterCollectionSync();this._parent()},_destroyView:function(){if(l.is(this.view)&&l.is(this.view.destroy,"function")){this.view.destroy()}return this},destroy:function(){this._destroyView()._parent()}})});define("DS/SNResultUX/utils/SearchServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/UIKIT/Alert","DS/SNInfraUX/ServiceDelegationLoader","i18n!DS/SNResultUX/assets/nls/SNResultUX.json",],function(UWACore,UWAClass,UWADebug,UWAEvents,SearchSettings,SearchUtils,Alert,ServiceDelegationLoader,nlsKeys){var SearchServices=UWAClass.singleton(UWAEvents,UWADebug,{name:"DS_SNResultUX_utils_SearchServices",attributeToFilterForExport:["id","type_icon_url","preview_url","actions","resourceid","resourceid_tagger","actions"],globalActions:["exportToCmd","print","save_search","refresh_search","kpi_pcs_action","Grid_Custo"],current_collection:null,odtMode:false,informationPanel:undefined,previewPanel:undefined,no_result:false,_previousSlice:{start:-1,end:-1},_skeletonAlert:null,init:function(){this.setDebugMode(SearchSettings.getDebugMode())},setPreviousSlice:function(first,last){this._previousSlice.start=first;this._previousSlice.end=last},resetPreviousSlice:function(){this._previousSlice.start=-1;this._previousSlice.end=-1},isEqualPreviousSlice:function(first,last){return(this._previousSlice.start===first&&this._previousSlice.end===last)},getinformationPanel:function(){if(this.informationPanel===undefined){this.informationPanel=SearchSettings.getOption("informationsPanel");if(this.informationPanel===false){var clientInfo=SearchUtils.identifyClientInfo();if(clientInfo.identifier==="3DSwym"){this.informationPanel=true}}}return this.informationPanel},getpreviewPanel:function(options){var that=this;if(that.previewPanel===undefined){that.previewPanel=SearchSettings.getOption("previewPanel")}if(UWACore.is(options)&&UWACore.is(options.widgetId)&&UWACore.is(UWACore.Widgets)&&UWACore.is(UWACore.Widgets.instances)){that.previewPanel=true;UWACore.Widgets.instances.forEach(function(elem){if(elem.id===options.widgetId){var addinmodeValue=elem.getValue("addinmode");if(UWACore.is(addinmodeValue)&&(addinmodeValue==="catiav5")){that.previewPanel=false}}})}return that.previewPanel},setODTMode:function(ODTMode){this.odtMode=ODTMode},downloadFile:function(strData,strFileName,strMimeType){var D=document,a=D.createElement("a");if(!UWACore.is(strData)){return}if(!UWACore.is(strFileName)){return}if(!UWACore.is(strMimeType)){return}strMimeType=strMimeType||"application/octet-stream";if(navigator.msSaveBlob&&!this.odtMode){return navigator.msSaveBlob(new Blob([strData],{type:strMimeType}),strFileName)}var BOMChar="\uFEFF";if("download" in a){a.href="data:"+strMimeType+";charset=UTF-8,"+BOMChar+encodeURIComponent(strData);a.setAttribute("download",strFileName);a.innerHTML="downloading...";D.body.appendChild(a);setTimeout(function(){a.click();D.body.removeChild(a)},66);return true}var f=D.createElement("iframe");D.body.appendChild(f);f.src="data:"+strMimeType+";charset=UTF-8,"+BOMChar+encodeURIComponent(strData);setTimeout(function(){D.body.removeChild(f)},333);return true},_displayAlert:function(options){if(!UWACore.is(options)||!UWACore.is(options.message)){throw ("E_INVALIDARG: bad options given to _displayAlert method !")}var alertContainer=null;if(UWACore.is(options.widgetId)&&UWACore.is(UWACore.Widgets)&&UWACore.is(UWACore.Widgets.instances)){UWACore.Widgets.instances.forEach(function(elem){if(elem.id===options.widgetId){alertContainer=UWACore.extendElement(elem.elements.body).getElement(".onesearch_results")}})}else{if(!UWACore.is(UWACore.extendElement(document.body).getElement(".onesearch_results"))){return}}var message=options.message;var className="primary";if(UWACore.is(options.className,"string")){className=options.className}if(!UWACore.is(alertContainer)){alertContainer=UWACore.extendElement(document.body).getElement(".onesearch_results")}var alertOpts={visible:true,autoHide:true,hideDelay:8000,closable:true,messages:[{message:message,className:className}],attributes:{id:"search-alert"}};if(UWACore.is(options.events)){alertOpts.events=options.events}if(UWACore.is(this.skeleton)){if(this.skeleton._alert){this.skeleton._alert.destroy();this.skeleton._alert=null}this.skeleton._alert=new Alert(alertOpts).inject(alertContainer,"top")}else{new Alert(alertOpts).inject(alertContainer,"top")}},setDragData:function(event,info){var that=this;if(UWACore.is(event)&&UWACore.is(info)){var draggedItemModels=info.draggedModels;if(UWACore.is(draggedItemModels,"array")){var isWebInWin=UWACore.is(SearchSettings.getOption("search_web_in_win"))?SearchSettings.getOption("search_web_in_win"):false;var data={protocol:"3DXContent",version:"1.1",source:SearchUtils.SEARCH_APP_ID,widgetId:info.widgetId,data:{items:[]}};var draggedItems=[];var draggedItems_short=[];draggedItemModels.forEach(function(itemModel){var object={envId:itemModel.getPlatformID(),serviceId:itemModel.getServiceID(),contextId:"",objectId:itemModel.id,objectType:(itemModel.get("ds6w:type_value"))?itemModel.get("ds6w:type_value"):itemModel.get("ds6w:what/ds6w:type_value"),displayName:itemModel.get("ds6w:label"),displayType:(itemModel.get("ds6w:type"))?itemModel.get("ds6w:type"):itemModel.get("ds6w:what/ds6w:type")};if(isWebInWin){object.session_object=itemModel.hasOwnProperty("session_object")}draggedItems_short.push('"'+object.displayName+'"');draggedItems.push(object)});console.log("number of dragged objects "+draggedItems.length);data.data.items=draggedItems;if(event.dataTransfer&&event.dataTransfer.setData){event.dataTransfer.setData("text",JSON.stringify(data));var isIE=
/*@cc_on!@*/
false||!!document.documentMode;var isEdge=!isIE&&!!window.StyleMedia;var Ms=isIE||isEdge;if(!Ms){event.dataTransfer.setData("shortData",JSON.stringify(draggedItems_short))}try{event.dataTransfer.setData("text/searchitems",JSON.stringify(data))}catch(error){console.log("event.dataTransfer.setData DOES NOT accept text/searchitems")}if(isWebInWin){event.dataTransfer.setData("text/plain",JSON.stringify(data))}event.dataTransfer.effectAllowed="all"}}}},buildCompassSelectionData:function(info){var data={};if(UWACore.is(info)){var selectedItemModels=info.selectedModels;if(UWACore.is(selectedItemModels,"array")){data={protocol:"3DXContent",version:"1.1",source:SearchUtils.SEARCH_APP_ID,widgetId:info.widgetId,data:{items:[]}};var selectedItems=[];selectedItemModels.forEach(function(itemModel){var object={envId:itemModel.getPlatformID(),serviceId:itemModel.getServiceID(),contextId:"",objectId:itemModel.id,objectType:(itemModel.get("ds6w:type_value"))?itemModel.get("ds6w:type_value"):itemModel.get("ds6w:what/ds6w:type_value"),displayName:itemModel.get("ds6w:label"),displayType:(itemModel.get("ds6w:type"))?itemModel.get("ds6w:type"):itemModel.get("ds6w:what/ds6w:type")};var attributesPairs=itemModel.pairs();for(var idx=0;idx<attributesPairs.length;idx++){var title=attributesPairs[idx][0];var value=attributesPairs[idx][1];if(UWACore.is(title)&&title.indexOf("_value")!==-1&&(title.indexOf("ds6w:")!==-1||title.indexOf("ds6wg:")!==-1)){if(title.indexOf("status_value")!==-1||title.indexOf("policy_value")!==-1||title.indexOf("revision_value")!==-1||title.indexOf("reserved_value")!==-1||title.indexOf("cadMaster_value")!==-1||title.indexOf("kind_value")!==-1){var id=title.replace("_value","");object[id]=value}}}selectedItems.push(object)});data.data.items=selectedItems}}return data},handleMyContentTags:function(tagValues){var typeCount=0,favoriteSearches=0,favoriteContent=0;var categoryValues=[];for(var t=0;t<tagValues.length;t++){if(tagValues[t].sixw==="ds6w:what/ds6w:type"){typeCount+=tagValues[t].count;var typeName=tagValues[t].object;if(typeName==="PLMWspFavoriteSearch"||typeName==="SavedSearch"){favoriteSearches+=tagValues[t].count}else{if(typeName==="PLMWspFavoriteAuthoring"||typeName==="PLMWspFavoriteNavigation"){favoriteContent+=tagValues[t].count}}}}var myOtherContent=typeCount-favoriteSearches-favoriteContent;if(myOtherContent>0){var myOtherContent={count:myOtherContent,dispValue:nlsKeys.get("myContent_otherThanFav"),field:"implicit",object:"#myOtherContent",sixw:"ds6w:what/ds6w:category",type:"string"};tagValues.push(myOtherContent)}if(favoriteSearches>0){var myFavoriteSearches={count:favoriteSearches,dispValue:nlsKeys.get("myContent_searchFav"),field:"implicit",object:"#myFavoriteSearches",sixw:"ds6w:what/ds6w:category",type:"string"};tagValues.push(myFavoriteSearches)}if(favoriteContent>0){var myFavoriteSearches={count:favoriteContent,dispValue:nlsKeys.get("myContent_otherFav"),field:"implicit",object:"#myFavoriteContent",sixw:"ds6w:what/ds6w:category",type:"string"};tagValues.push(myFavoriteSearches)}return tagValues},getRelations:function(options){if(UWA.is(options,"object")){var model=options.model;if(UWA.is(model,"object")&&UWA.is(options.onComplete,"function")&&UWA.is(options.onFailure,"function")){ServiceDelegationLoader.load({serviceID:model.getServiceID(),platformID:model.getPlatformID()}).then(function(serviceDelegation){if(UWA.is(serviceDelegation.getRelations,"function")){serviceDelegation.getRelations({model:model,onComplete:options.onComplete,onFailure:options.onFailure})}else{options.onFailure.call(undefined,"service delegation not implemented")}},function(){options.onFailure.call(undefined,"service delegation not found")})}}}});return SearchServices});define("DS/SNResultUX/utils/SNResultTypeCustoHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/PredefinedQueries"],function(d,h,b,f,e,g,a){var c=h.singleton(b,f,{init:function(i){},getAdvancedSearchCustoTypeList:function(m,k,j){var i=g.getTypeCusto();if(d.is(i)){if(d.is(k)){var l=k.filter(function(n){if(i[n.uri]){return true}})}else{l=this.buildFromCustoTypeList(i,j)}return l}else{if(UWA.is(j)&&UWA.is(j.onFailure)&&UWA.is(j.onFailure,"function")){j.onFailure.call(this)}}return k},getAdvancedSearchCustoInterfaceList:function(l,i){var j=g.getTypeCusto();if(d.is(j)){var n=j[l];var k=n.interfaceURIs;if(k&&k.length>0){var m=i.filter(function(o){if(k.indexOf(o.name)>=0){return true}});return m}}return i},getGlobalSearchTypeCustoQuery:function(j){if(d.is(j)){if(!(j.trim().length==0||j===e.SearchTypeEnum.ADVANCED_SEARCH||j===e.SearchTypeEnum.MY_CONTENT||j===e.SearchTypeEnum.MY_RECENT_CONTENT||j===e.SearchTypeEnum.FAVORITE_SEARCH||0==j.indexOf(e.SearchTypeEnum.SIMILAR_SEARCH))){if(!(a.isAPrefixedPQSearch(j)||a.isAPQSearch(j)||j.indexOf("flattenedtaxonomies:")>=0||j.indexOf("type:")>=0)){var i=g.getSearchTypeCustoQuery();if(i.length>0){return" AND ("+i+")"}}}}},buildFromCustoTypeList:function(i,j){var l=[];if(!d.is(i)){return l}var k={};k.onComplete=function(q){for(var p in i){var m=p.split(":");if(m[0]==j.vocabId){var n=q[m[1]];var o={"abstract":false,description:"",name:m[1],nlsName:n.nlsName,type:i[p].typeRef,uri:p};l.push(o)}}if(UWA.is(j)&&UWA.is(j.onComplete)&&UWA.is(j.onComplete,"function")){j.onComplete.call(this,l)}};k.onFailure=function(){if(UWA.is(j)&&UWA.is(j.onFailure)&&UWA.is(j.onFailure,"function")){j.onFailure.call(this)}};g.getSearchTypeCustoListNLSNames(k)}});return c});define("DS/SNResultUX/utils/ResultUX_customization",["DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Collection","DS/WebappsUtils/Performance","require"],function(e,f,i,j,h,c,d,a,g){var b=j.singleton(c,h,{_type_customization:{},_skeleton_facets:[],_actions_customization:null,_addin_mode:null,_other_ux_options:{},init:function(k){this.setDebugMode(e.getDebugMode());this._actions_customization=new d();this._actions_customization_modules=new d();this._check_type_inheritance=e.getOption("add_taxonomies_in_select_clause")===true},addCustomization:function(m,r){var n=this,q=m.SearchCustomization,p=0,o=a.now().toString();a.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization","uuid":"'+o+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization","drilldown":"ResultUX_customization::addCustomization-Detail"}');function l(v,y){var x=false,u=false,w=false;function t(){if(w===true&&x===true&&u===true){p++;if(i.is(q)===false||(p===q.length)){a.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization","uuid":"'+o+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization"}');y.call(null)}}}a.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadTypeCustomization","uuid":"'+o+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}');n._loadTypeCustomization(v.type_customization,function(){a.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadTypeCustomization","uuid":"'+o+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}');w=true;t()});a.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadActionsCustomization","uuid":"'+o+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}');n._loadActionsCustomization(v.actions,function(){a.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadActionsCustomization","uuid":"'+o+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}');x=true;t()});a.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadViewsCustomization","uuid":"'+o+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}');n._loadViewsCustomization(v.views,function(){a.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadViewsCustomization","uuid":"'+o+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}');u=true;t()})}n.updateOtherUXOptions(m);if(i.is(q)){a.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization loop on custo","uuid":"'+o+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}');for(var k=0;k<q.length;k++){g([q[k]],function(u){var t=JSON.parse(u);l(t,r)},function(t){if(t.requireType!=="timeout"){console.warn("Cannot load view "+t.requireModules);p++;if(p===q.length){a.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization loop on custo","uuid":"'+o+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}');a.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization","uuid":"'+o+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization"}');r.call(null)}}})}}else{l(m,r)}},setAddinMode:function(k){if(UWA.is(k,"string")){this._addin_mode=k}else{}},updateOtherUXOptions:function(k){if(i.is(k.datagridview_columns)){this._other_ux_options.datagridview_columns=k.datagridview_columns}},getUXOption:function(k){return this._other_ux_options[k]},getDataGridViewColumns:function(){return this.getUXOption("datagridview_columns")},getAvailableActions:function(v,r,n){if(!i.is(v)||!i.is(v.attributes)){throw new Error("Invalid Arg in ResultUX_customization.getAvailableActions!")}var l=[],D=[];var A=v.attributes["ds6w:what/ds6w:type_value"];if(!UWA.is(A)){A=v.attributes["ds6w:type_value"]}var q=this._actions_customization.get({id:b._getModelTypeValue(A)});if(!i.is(q)&&i.is(A,"array")){for(var y=0;y<A.length&&!(i.is(q));y++){q=this._actions_customization.get({id:A[y]})}}if(this._check_type_inheritance){if(!i.is(q)){var k=v.attributes.taxonomies_value;var B=null;if(i.is(k,"string")){B=k}else{if(i.is(k,"array")){for(var y=0;y<k.length;y++){if(i.is(k[y],"string")&&k[y].indexOf("types/")===0){B=k[y];break}}}}if(i.is(B)){var x=B.split("/");if(i.is(x,"array")){for(var y=x.length-2;y>0&&!(i.is(q));y--){q=this._actions_customization.get({id:x[y]})}}}}}var p=function(t){r.call(null,t)};var w=[];if(i.is(q)){var u=q.get("available_impl");for(var z=0;z<u.length;z++){var l=u[z].getActionForObject(v.attributes,p,n);if(i.is(l,"array")){w=w.concat(l)}}}var m=this._actions_customization.get({id:"all"});if(i.is(m)){var o=m.get("available_impl");for(var C=0;C<o.length;C++){var l=o[C].getActionForObject(v.attributes,p,n);if(i.is(l,"array")){w=w.concat(l)}}}r.call(null,w)},availablefacets:function(){var n=[];var k=null;if(i.is(this.model)){k=this.model}else{k=this}var m=b._getModelTypeValue(k.get("ds6w:what/ds6w:type_value"));if(i.is(b._type_customization[m])===true){n.push.apply(n,b._type_customization[m].getAvailableFacetsIdAndOrder())}else{for(var l in b._skeleton_facets){if(b._skeleton_facets.hasOwnProperty(l)&&i.is(b._skeleton_facets[l])){if(b._skeleton_facets[l].is_facet_avalailable(this)===true){n.push(f.result(b._skeleton_facets[l],"facet_idcard"))}}}}return n},availableviews:function(){var l={};for(var k in b._skeleton_facets){if(b._skeleton_facets.hasOwnProperty(k)){l[f.result(b._skeleton_facets[k],"facet_name")]=f.result(b._skeleton_facets[k],"facet_options")}}return l},getMapping:function(){var k={image:function(){var m=this.model||this;var n=b._getModelTypeValue(m.get("ds6w:what/ds6w:type_value"));if(i.is(b._type_customization[n])&&i.is(b._type_customization[n].image)){return b._type_customization[n].image.call(m)}else{var l=m.get("preview_url");return l}},icon:function(){var l=this.model||this;var m=b._getModelTypeValue(l.get("ds6w:what/ds6w:type_value"));if(i.is(b._type_customization[m])&&i.is(b._type_customization[m].icon)){return b._type_customization[m].icon.call(l)}else{var n=l.get("type_icon_url");return n}}};return k},idcardOptions:function(m,l,k){var o={};var n;if(i.is(m)){n=b._getModelTypeValue(m.get("ds6w:what/ds6w:type_value")||m.get("ds6w:what/ds6w:type"))}if(i.is(n)&&i.is(b._type_customization[n])&&i.is(b._type_customization[n].getIdCardOpts)){b.log("ResultUX_customization specific IDCard options set");o=b._type_customization[n].getIdCardOpts(m)}else{if(i.is(l)){o=b._getResultContentsIdCard(l);if(i.is(k)){o.events=k}}else{o=b._getResultContentsIdCard()}}return o},_loadTypeCustomization:function(n,m){if(i.is(n,"array")&&n.length>0){var l=0;for(var k=0;k<n.length;k++){require([n[k]],function(q){var o=new q();if(i.is(o.name,"string")){b._type_customization[o.name]=o}else{if(i.is(o.names,"array")){for(var p=0;p<o.names.length;p++){b._type_customization[o.names[p]]=o}}else{throw new Error("Invalid type defined")}}l++;if(l===n.length){m.call(null)}},function(o){if(o.requireType!=="timeout"){console.warn("Cannot load type customization "+o.requireModules);l++;if(l===n.length){m.call(null)}}})}}else{this.log("No type customization loaded");m.call(null)}},_loadActionsCustomization:function(o,p){if(i.is(o)){var m=this,n=0;for(var l=0;l<o.length;l++){var k=o[l];if(!i.is(this._actions_customization_modules.get(k))){m._actions_customization_modules.add({id:o[l]});require([k],function(r){var v=new r({addinmode:m._addin_mode}),t=v.availableForTypes();for(var u=0;u<t.length;u++){var q=m._actions_customization.get({id:t[u]});if(i.is(q)){m.log("Update action model");q.get("available_impl").push(v)}else{m._actions_customization.add({id:t[u],available_impl:[v]})}}n++;if(n===o.length){p.call(null)}},function(q){if(q.requireType!=="timeout"){console.warn("Cannot load view "+q.requireModules);n++;if(n===o.length){p.call(null)}}})}else{n++;if(n===o.length){p.call(null)}}}}else{this.log("No actions loaded");p.call(null)}},_loadViewsCustomization:function(l,p){if(i.is(l)){var n=this,m=l.skeleton.facets,o=0;for(var k=0;k<m.length;k++){if(i.is(n._skeleton_facets[m[k].id])){this.log("View already added with the same id "+m[k].id);this.log("Do not load "+m[k].implementation);o++;if(o===m.length){p.call(null)}}else{n._skeleton_facets[m[k].id]=null;require([m[k].implementation],function(q){n._skeleton_facets[q.facet_name]=q;o++;if(o===m.length){p.call(null)}},function(q){if(q.requireType!=="timeout"){console.warn("Cannot load view "+q.requireModules);o++;if(o===m.length){p.call(null)}}})}}}else{this.log("No actions loaded");p.call(null)}},_getResultContentsIdCard:function(l){var k={},m=i.is(l)?i.extend(l.mapping,b.getMapping(),true):b.getMapping();k={thumbnailUrl:function(){return b._getValueWithMapping("image",this,m)},bannerUrl:"",attributesMapping:m,facets:b.availablefacets,nativeActionMenu:true,actions:function(){var o=[],n=this;this.actions.forEach(function(q,p){if(p<7){var r={text:q.get("title"),icon:q.get("icon"),handler:q.get("callback")};if(i.is(q.get("callback"))){r.handler=function(u){var t={model:u.model,action_id:q.get("id"),object_id:u.model.get("id"),collection:u.model.collection};q.get("callback").call(undefined,t,arguments)}}else{if(e.getOption("search_web_in_win")&&i.is(q.get("sourcejs"))){r.handler=function(){require([q.get("sourcejs")],function(u){var t={action_id:q.get("id"),object_id:n.get("id"),};u.executeAction.call(u,t)})}}}o.push(r)}});return o}};return k},_getValueWithMapping:function(m,l,k){var n;if(m in k&&i.is(k[m],"function")){var o={model:l};n=k[m].call(o)}else{n=l.get(m);if(n===undefined){n=""}}return n},_getModelTypeValue:function(k){return i.is(k,"array")?Array.prototype.join.call(k,"/"):k}});return b});define("DS/SNResultUX/utils/WildcardMgr",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchUtils"],function(d,g,c,f,b,e){var a=g.singleton(c,{init:function(){this.setDebugMode(true)},_specialSearchCriteria:["*","#all",e.SearchTypeEnum.MY_CONTENT,e.SearchTypeEnum.MY_RECENT_CONTENT,e.SearchTypeEnum.ADVANCED_SEARCH,e.SearchTypeEnum.FAVORITE_SEARCH],isASpecialCriteria:function(j){var h=false;for(var k=0;k<this._specialSearchCriteria.length;k++){if(this._specialSearchCriteria[k]===j){h=true;break}}return h},_operators:[":","(",")"," AND "," OR ","=","==","!=","<",">","<=",">="," NOT "," BUTNOT "," XOR "," OPT "," NEAR "," NEXT "," AFTER "," BEFORE "," INNERJOIN "," SPLIT "],isAnAdvancedCriteria:function(j){if(!d.is(j,"string")){throw new Error("Invalid arg in isAnAdvancedCriteria")}var h=false;for(var k=0;k<this._operators.length;k++){if(j.indexOf(this._operators[k])>0){h=true;break}}return h},isAnExactCriteria:function(i){var h=false;if(d.is(i)){if(i[0]==='"'&&i[i.length-1]==='"'){h=true}}return h},containsNonLatinChars:function(j){if(!d.is(d.is(j,"string"))){throw new Error("Invalid arg in WildcardMgr.containsNonLatinChars");return false}var h=false,k=0;for(k=0;k<j.length&&false===h;k++){if(j.charCodeAt(k)>255){h=true}}return h},getInfo:function(u){var p={searchCriteria:u,};if(d.is(u)){if(p.searchCriteria.trim().length>0){p.searchCriteria=p.searchCriteria.trim()}p.isAnExactCriteria=this.isAnExactCriteria(p.searchCriteria);p.isASpecialCriteria=this.isASpecialCriteria(p.searchCriteria);p.isAdvancedCriteria=this.isAnAdvancedCriteria(p.searchCriteria);p.indexOfTwoDots=p.searchCriteria.indexOf(":");p.pqAbbrevation=b.isAPQSearch(p.searchCriteria);p.indexOfwildChar=p.searchCriteria.indexOf("*");p.containsNonLatinChars=this.containsNonLatinChars(p.searchCriteria);var q=p.searchCriteria.split(" ");if(d.is(q)){for(var k=0,m=q.length;k<m;k++){if(d.is(q[k])){if(b.isAPQSearch(q[k])){var r=q[k].split(":");var n="";if(d.is(r)&&2===r.length){n=r[1];if(n.length===0){n="*"}if(f.getOption("wildcard_addition")){var j=this.isASpecialCriteria(n),l=this.isAnAdvancedCriteria(n),t=this.isAnExactCriteria(n),h=n.indexOf("*"),o=this.containsNonLatinChars(n);if(!t&&!j&&!l&&!o&&-1===h){n="*"+n+"*"}}r[1]=n;q[k]=r.join(":")}}}}}p.searchCriteria=q.join(" ");if(d.is(p.pqAbbrevation)&&false===p.isAdvancedCriteria){p.searchCriteria=p.searchCriteria.substring(p.indexOfTwoDots+1,p.searchCriteria.length);if(p.searchCriteria.trim().length>0){p.searchCriteria=p.searchCriteria.trim()}p.isASpecialCriteria=this.isASpecialCriteria(p.searchCriteria);p.isAdvancedCriteria=this.isAnAdvancedCriteria(p.searchCriteria);p.isAnExactCriteria=this.isAnExactCriteria(p.searchCriteria);p.indexOfwildChar=p.searchCriteria.indexOf("*")}}return p},manageWildcardAddtion:function(l){var m=function(r,q){var p=q;var o=1;while(o>0&&p<r.length){p++;var t=r.charAt(p);if(t==="("){o++}else{if(t===")"){o--}}}if(p>=r.length){p=-1}return p};if(l===e.SearchTypeEnum.ADVANCED_SEARCH||l===e.SearchTypeEnum.MY_CONTENT||l===e.SearchTypeEnum.MY_RECENT_CONTENT||l===e.SearchTypeEnum.FAVORITE_SEARCH){return l}if(l.trim().length>0){l=l.trim()}var i=false;var k=l.match(/\(([^()]+)\)/g);if(d.is(k,"array")&&1===k.length&&k[0]===l){i=true;l=l.substring(1,l.length-1)}while(l.startsWith("(")&&m(l,0)===l.length-1){i=true;l=l.substring(1,l.length-1)}var n=this.getInfo(l);var h=n.searchCriteria;var j=false;if(f.getOption("wildcard_addition")){if(d.is(n.pqAbbrevation)){if(n.isAnExactCriteria){}else{if(n.isASpecialCriteria){}else{if(n.isAdvancedCriteria){}else{if(n.containsNonLatinChars){}else{if(n.indexOfwildChar>-1){n.searchCriteria=n.pqAbbrevation+":"+n.searchCriteria}else{h=n.pqAbbrevation+":*"+n.searchCriteria+"*";j=true}}}}}}else{if(n.isAnExactCriteria){}else{if(n.isASpecialCriteria){}else{if(n.isAdvancedCriteria){}else{if(n.containsNonLatinChars){}else{if(n.indexOfwildChar>-1){}else{if(h.length){h="*"+n.searchCriteria+"*";j=true}}}}}}}}else{if(d.is(n.pqAbbrevation)){if(!n.isAnExactCriteria&&!n.isASpecialCriteria&&!n.isAdvancedCriteria&&!n.containsNonLatinChars&&-1===n.indexOfwildChar&&0===n.searchCriteria.length){h=n.pqAbbrevation+":*";j=true}}}if(!j){if(d.is(n.pqAbbrevation)&&false===n.isAdvancedCriteria){h=n.pqAbbrevation+":"+h}}if(i||n.isAdvancedCriteria){h="("+h+")"}return h}});return a});define("DS/SNResultUX/savedSearch/SavedSearch_ActionHandler",["UWA/Core","UWA/Class","DS/WAFData/WAFData","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchVersioning","DS/SNResultUX/utils/SearchServices","DS/UIKIT/Alert","DS/UIKIT/Popover","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(m,r,b,u,k,i,a,e,t,l,g,p,o,j,q,f,h){var n="socket_id_#saved_search_edit#",c="widget_id_#saved_search_edit#";var d=r.singleton(k,u,{executeAction:function(w,y){if(i.getOption("actionsProtocol_FUN065512")){if(!UWA.is(w,"object")||!UWA.is(w.object_ids,"array")||!UWA.is(w.action_id,"string")||!w.actionsHelper){throw ("invalid input to action handler")}switch(w.action_id){case"run_saved_search":if(w.object_ids.length===1){this._runSearch2(w)}else{throw ("run_saved_search is called with invalid object_ids information")}break;case"rename_saved_search":if(w.object_ids.length===1){this.renameSearchUI2(w)}else{throw ("rename_saved_search is called with invalid object_ids information")}break;case"delete_saved_search":this._deleteSearch2(w);break;case"share_saved_search":this._shareSearch(w);break;case"unshare_saved_search":this._unshareSearch(w);break;case"edit_saved_search":this._editSearch(w);break}}else{var z=null;if(!m.is(w)||!m.is(w.collection)){console.error("Missing collection arg !");return}z=w.collection;var x=this;var v=[];if(!Array.isArray(w)){v.push(w)}else{v=w}Array.prototype.forEach.call(v,function(A){switch(A.action_id||w.action_id){case"run_saved_search":x._runSearch(A.object_id,z);break;case"rename_saved_search":var F=z.getSNSkeleton();if(i.getOption("search_web_in_win")){var D=document.getElementById(A.object_cid);if(UWA.is(F)){var C=F.getIDCardStatus();if(C==="contracted"){if(F._isMultiselOn===true&&A.event_type==="btnGlobal"){D=y[0].view?y[0].view:F._skeleton.container.getElement(".set-detail-view-title");x.renameSearchUI(A.object_id,D,false,z)}else{if(F._skeleton.getViewAt(0).currentViewId=="table"){var B=F._skeleton.getViewAt(0).contentsViews.table.view.getManager();D=y[0].view?y[0].view:B._cellSpan;x.renameSearchUI(A.object_id,D,false,z)}else{D=y[0].view?y[0].view:D;x.renameSearchUI(A.object_id,D,false,z)}}}else{var E=m.extendElement(F._skeleton.container.parentElement).getElement(".right>.skeleton-panel>.facetviews");x.renameSearchUI(A.object_id,E,true,z)}}}else{if(UWA.is(y)){if(y.length>=2){if(y.length==2){x.renameSearchUI(A.object_id,y[0].getContent?y[0].getContent():y[0].view,(!y[1].data)?true:false,z)}else{if(m.is(y[1].getContent())){x.renameSearchUI(A.object_id,y[1].getContent?y[1].getContent():y[0].view,false,z)}}}else{if(F._skeleton.getViewAt(0).currentViewId=="table"&&!A.target){x.renameSearchUI(A.object_id,A.cellInfo.cellView.elements.container,false,z)}else{if(A.target){x.renameSearchUI(A.object_id,A.target,false,z)}else{throw ("invalid ui element data size for rename_saved_search !")}}}}else{throw ("invalid ui element data for rename_saved_search !")}}break;case"delete_saved_search":x._deleteSearch(A.object_id?A.object_id:A.id,z);break}})}},_displayAlert:function(v,x){if(!m.is(x)){console.error("Bad collection arg !");return}var w=x.getSNSkeleton().getOption("widgetId");v.widgetId=w;l._displayAlert(v)},renameSearchUI2:function(G){var y=this;G.actionsHelper.hidePopover();var z=new p({target:G.actionsHelper.getTarget(),className:"fav-search-popover",position:"bottom",title:f.get("rename_fav_search"),events:{onHide:function(){this.destroy()}}});G.actionsHelper.setPopover(z);var v=UWA.createElement("span",{id:"close-popover-icon",title:f.get("closeButton"),"class":"fonticon fonticon-cancel",events:{click:function(H){H.stopPropagation();G.actionsHelper.hidePopover()}}}).inject(z.getTitle());var C=UWA.createElement("form",{"class":"formSaveSearch form-inline"});var F=UWA.createElement("div",{"class":"divNewSearch form-group"});F.inject(C);var x=UWA.createElement("span",{id:"fav-search-clear-icon","class":"fonticon fonticon-cancel-circled",events:{click:function(H){H.stopPropagation();B.setValue("");this.hide()}}}).inject(F);var w=G.actionsHelper.getValue({id:G.object_ids[0],attribute:"ds6w:label"});var B=new o({placeholder:f.get("save_search_default_text"),value:w,"class":"newSaveSearchName",id:"newSaveSearchName",maxlength:256,events:{onKeyDown:function(H){if(!this.getValue()){x.hide()}else{x.show()}if(H.keyCode===13){H.preventDefault();H.stopPropagation();y._renameSearch2(G,this.getValue());G.actionsHelper.hidePopover()}},onChange:function(H){if(!this.getValue()){x.hide()}else{x.show()}}}}).inject(F);var E=UWA.createElement("div",{"class":"divBtn"});E.inject(C);var A=new j({value:f.get("OKButton"),className:"primary xsmall okSaveSearch",id:"okSaveSearch",events:{onClick:function(){y.log("Search name="+B.getValue());y._renameSearch2(G,B.getValue());G.actionsHelper.hidePopover()}}}).inject(E);var D=new j({value:f.get("CancelButton"),className:"default xsmall cancelSaveSearch",id:"cancelSaveSearch",events:{onClick:function(){y.log("Save canceled");G.actionsHelper.hidePopover()}}}).inject(E);z.setBody(C);z.show();B.focus()},renameSearchUI:function(v,D,y,z){if(!m.is(z)){console.error("Bad collection arg !");return}var A=this;if(z._snSkeleton.popover){z._snSkeleton.popover.hide();z._snSkeleton.popover=null}z._snSkeleton.popover=new p({target:D,className:"fav-search-popover",position:y?"top":"bottom",title:f.get("rename_fav_search"),events:{onHide:function(){this.destroy()}}});var w=UWA.createElement("span",{id:"close-popover-icon",title:f.get("closeButton"),"class":"fonticon fonticon-cancel",events:{click:function(I){I.stopPropagation();z._snSkeleton.popover.hide()}}}).inject(z._snSkeleton.popover.getTitle());var E=UWA.createElement("form",{"class":"formSaveSearch form-inline"});var H=UWA.createElement("div",{"class":"divNewSearch form-group"});H.inject(E);var x=UWA.createElement("span",{id:"fav-search-clear-icon","class":"fonticon fonticon-cancel-circled",events:{click:function(I){I.stopPropagation();C.setValue("");this.hide()}}}).inject(H);var C=new o({placeholder:f.get("save_search_default_text"),value:z.get(v).get("ds6w:label"),"class":"newSaveSearchName",id:"newSaveSearchName",maxlength:256,events:{onKeyDown:function(I){if(!this.getValue()){x.hide()}else{x.show()}if(I.keyCode===13){I.preventDefault();I.stopPropagation();A._renameSearch(v,z.get(v).get("ds6w:label"),this.getValue(),z);z._snSkeleton.popover.hide()}},onChange:function(I){if(!this.getValue()){x.hide()}else{x.show()}}}}).inject(H);var G=UWA.createElement("div",{"class":"divBtn"});G.inject(E);var B=new j({value:f.get("OKButton"),className:"primary xsmall okSaveSearch",id:"okSaveSearch",events:{onClick:function(){A.log("Search name="+C.getValue());A._renameSearch(v,z.get(v).get("ds6w:label"),C.getValue(),z);z._snSkeleton.popover.hide()}}}).inject(G);var F=new j({value:f.get("CancelButton"),className:"default xsmall cancelSaveSearch",id:"cancelSaveSearch",events:{onClick:function(){A.log("Save canceled");z._snSkeleton.popover.hide()}}}).inject(G);z._snSkeleton.popover.setBody(E);z._snSkeleton.popover.show();C.focus()},_renameSearch:function(C,x,w,B){var z=this;if(!m.is(B)){console.error("Bad collection arg !");return}var v=B.getSearchRessources().getFetchOptions({service_name:"renameSavedSearch",service_data:{id:C,name:w}});var y=v.url;var A={onComplete:function(D,F){z._displayAlert({message:f.replace(f.get("rename_search_successful"),{old_name:x,new_name:w}),className:"success"},B);var E=B.get(C);E.set("ds6w:label",w)},onFailure:function(D){z._displayAlert({message:f.replace(f.get("rename_search_failure"),{old_name:x,new_name:w}),className:"error"},B)}};A=UWA.extend(v,A,true);b.authenticatedRequest(y,A)},_renameSearch2:function(y,v){var z=this;var x=y.actionsHelper.getValue({id:y.object_ids[0],attribute:"ds6w:label"});function w(B){if(B.indexOf("<")>=0||B.indexOf(">")>=0){B=B.replace(/</g,"&lt;").replace(/>/g,"&gt;");B=B.replace(/&lt;/g,'<em style="color:red">&lt;</em>').replace(/&gt;/g,'<em style="color:red">&gt;</em>');var C=f.replace(f.get("rename_search_failure"),{old_name:x,new_name:B});C+="<br>"+f.get("save_search_invalid_character");y.actionsHelper.displayAlert({message:C,className:"error saveSearchAlert"});return false}return true}if(!w(v)){return false}var A={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({id:y.object_ids[0],name:v})};y.actionsHelper.getServiceURL({id:y.object_ids[0],onComplete:function(B){if(UWA.is(B,"string")){z._initSecurityContext(y,B);a.getSecurityContextPromise().then(function(){var C=a.getSecurityContext();if(C&&C.trim().length>0){A.headers.SecurityContext=C}A.url=B+"/resources/SNAPI/search_services/updateSearch";A.onComplete=function(D,E){y.actionsHelper.setLabel({id:y.object_ids[0],newLabel:v});y.actionsHelper.displayAlert({message:f.replace(f.get("rename_search_successful"),{old_name:x,new_name:v}),className:"success"})},A.onFailure=function(D){y.actionsHelper.displayAlert({message:f.replace(f.get("rename_search_failure"),{old_name:x,new_name:v}),className:"error"})};b.authenticatedRequest(A.url,A)})}}})},_runSearch:function(A,z){var y=this;if(!m.is(z)){console.error("Bad collection arg !");return}var B=z.get(A).get("ds6w:label");var v=z.getSearchRessources().getFetchOptions({service_name:"runSavedSearch",service_data:{id:A}});var x=v.url;var w={onComplete:function(C,H){var G=m.Json.decode(C);if(UWA.is(G)){var E={};var D={};try{D=m.Json.decode(G.searchstring);E.search_criteria=D.query;E.originalSearchCriteria=D.originalSearchCriteria}catch(F){E.search_criteria=G.searchstring}if(m.is(G.name)){E.search_name=G.name}E.tag_filter=m.Json.decode(G.taggerstring);if(m.is(G.searchOptions)){if(m.is(G.searchOptions.source)){E.source=G.searchOptions.source}}E.savedSearch=true;z.getSNSkeleton().getSearchActions().dispatchEvent("onRunSavedSearch",E);y._displayAlert({message:f.replace(f.get("run_search_successful"),{search_name:B}),className:"success"},z)}},onFailure:function(C){y._displayAlert({message:f.replace(f.get("run_search_failure"),{search_name:B}),className:"error"},z)}};w=UWA.extend(v,w,true);b.authenticatedRequest(x,w)},_runSearch2:function(v){var w=this;var x={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},data:"id="+v.object_ids[0]};v.actionsHelper.getServiceURL({id:v.object_ids[0],onComplete:function(y){if(UWA.is(y,"string")){w._initSecurityContext(v,y);a.getSecurityContextPromise().then(function(){var z=a.getSecurityContext();if(z&&z.trim().length>0){x.headers.SecurityContext=z}x.url=y+"/resources/SNAPI/search_services/savedSearch";var A=v.actionsHelper.getValue({id:v.object_ids[0],attribute:"ds6w:label"});x.onComplete=function(B,G){var F=m.Json.decode(B);if(UWA.is(F)){var D={};var C={};try{C=m.Json.decode(F.searchstring);D.search_criteria=C.query;D.originalSearchCriteria=C.originalSearchCriteria;D.search_criteria_to_display=C.search_criteria_to_display}catch(E){D.search_criteria=F.searchstring}if(C.originalSearchCriteria=="#advancedSearch"){w._startIncontextForFavorite(F,v,A);return}if(m.is(F.name)){D.search_name=F.name}try{D.tag_filter=m.Json.decode(F.taggerstring)}catch(E){console.log(E)}if(m.is(F.searchOptions)){if(m.is(F.searchOptions.source)){D.source=F.searchOptions.source}if(m.is(F.searchOptions.order_by)&&m.is(F.searchOptions.order_field)){D.order_by=F.searchOptions.order_by;D.order_field=F.searchOptions.order_field}}D.savedSearch=true;var H=q.getSubscriptions({channel:"3DSearch-TabManager-"+v.widget_id,topic:"addTab"});if(UWA.is(H,"array")&&H.length>0&&true!==v.actionsHelper.isInContextMode()&&v.actionsHelper.canOpenATab()){q.publish({channel:"3DSearch-TabManager-"+v.widget_id,topic:"addTab",data:{search_ux_options:{search_options:D,events:{onReady:function(){alert("Ready")}}}}})}else{v.actionsHelper.dispatchEvent({event:"onRunSavedSearch",params:D})}v.actionsHelper.displayAlert({message:f.replace(f.get("run_search_successful"),{search_name:A}),className:"success"})}},x.onFailure=function(B){v.actionsHelper.displayAlert({message:f.replace(f.get("run_search_failure"),{search_name:A}),className:"error"})};b.authenticatedRequest(x.url,x)})}}})},_editSearch:function(v){var w=this;var x={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},data:"id="+v.object_ids[0]};v.actionsHelper.getServiceURL({id:v.object_ids[0],onComplete:function(y){if(UWA.is(y,"string")){w._initSecurityContext(v,y);a.getSecurityContextPromise().then(function(){var z=a.getSecurityContext();if(z&&z.trim().length>0){x.headers.SecurityContext=z}x.url=y+"/resources/SNAPI/search_services/savedSearch";var A=v.actionsHelper.getValue({id:v.object_ids[0],attribute:"ds6w:label"});x.onComplete=function(B,D){var C=m.Json.decode(B);w._startIncontextForFavorite(C,v,A,true)},x.onFailure=function(B){v.actionsHelper.displayAlert({message:f.replace(f.get("fetch_search_failure"),{search_name:A}),className:"error"})};b.authenticatedRequest(x.url,x)})}}})},_startIncontextForFavorite:function(G,y,E,I){var D=this;if(UWA.is(G)){var C={};var J={};try{J=m.Json.decode(G.searchstring);C.search_criteria=J.query;C.originalSearchCriteria=J.originalSearchCriteria}catch(M){C.search_criteria=G.searchstring}var B=t.isActiveWithCurrentVersion([{R2018x:"FD05"},{R2019x:"FD01"},{R2020x:"GA"}]);if(I&&(B==false)&&(J.originalSearchCriteria=="#advancedSearch")){y.actionsHelper.displayAlert({message:f.get("modify_search_not_supported"),className:"error"});return}if(m.is(G.name)){C.search_name=G.name}try{C.tag_filter=m.Json.decode(G.taggerstring)}catch(M){console.log(M)}if(m.is(G.searchOptions)){if(m.is(G.searchOptions.source)){C.source=G.searchOptions.source}if(m.is(G.searchOptions.order_by)&&m.is(G.searchOptions.order_field)){C.order_by=G.searchOptions.order_by;C.order_field=G.searchOptions.order_field}}var w=q.getSubscriptions({channel:"3DSearch-TabManager-"+y.widget_id,topic:"activateInContextSearch"});var H=(false===y.actionsHelper.isAPinnedWidget())&&(UWA.is(w,"array")&&w.length>0);var x={widget_id:c,default_with_precond:true,default_search_criteria:C.search_criteria,precond:undefined,source:C.source,tenant:C.tenant,tag_filter:C.tag_filter,ORDER_BY:C.order_by,ORDER_FIELD:C.order_field,app_socket_id:n,title:I?f.replace(f.get("title_modify_savedsearch"),{search_name:E}):undefined,search_name:E,mode:I?"furtive":undefined,show_banned_types:false,searchable_types:true,furtive_options:{min_select:0},UXOptions:{menuMyFavorites:!I,menuMyContent:!I,dnD:!I,dblClk:!I,localActions:!I,searchRecentContent:!I,globalToolbarActions:{saveAsFavorite:!I,"export":!I,print:!I}},forceWidgetUXRecreation:false,closeTransient:!H,modifysavedsearch:true};if(J.originalSearchCriteria=="#advancedSearch"){x.advanced_search={showByDefault:false,exclusive:true,selection:{}};var L=G.taggerstring;var z=JSON.parse(L);for(var K in z.localfilters){var v=K.split("/");var F=v[v.length-1];if(v.length==1){F=F.substring(5)}if(!x.advanced_search.selection[F]){x.advanced_search.selection[F]=[]}if(m.is(z.localfilters[K],"array")){z.localfilters[K].forEach(function(N){x.advanced_search.selection[F].push(N.object)})}}x.displayValue=""}y.manageTabContainerHideShow=H;if(!m.is(D.socket)){D.socket=e.createSocket({socket_id:n,widgetId:y.actionsHelper.widget_id});y.service_id=y.actionsHelper.getServiceID({id:y.object_ids[0]});y.platform_id=y.actionsHelper.getPlatformID({id:y.object_ids[0]});y.search_name=y.actionsHelper.getValue({id:y.object_ids[0],attribute:"ds6w:label"});D.socket.addListener("InContextSearch_Response",D._modifySearch.bind(D,y,J));D.socket.addListener("onCloseTransient",function(N){if(N&&N.in_apps_search&&N.in_apps_search.widget_id==c){D.socket.dispatchEvent("UnregisterContext",{widget_id:c});e.deleteSocket(n);D.socket.disconnect();delete D.socket;D.socket=null}})}else{}if(i.getOption("search_web_in_win")===true){x.inContextProtocol_FUN073378=true;D.socket.addListener("InContextInit",function(){InContextSearch({searchString:C.search_criteria,tag_filter:C.tag_filter,search_name:E})});if(y.actionsHelper.isInContextMode()){deactivateInContextSearch({donotshowlastsearch:undefined,notify_to_cpp:false})}activateInContextSearch(x);if(window.hasOwnProperty("sendNotificationWebInWin")&&m.is(sendNotificationWebInWin,"function")){sendNotificationWebInWin("UpdateSearchField",JSON.stringify({search_criteria:C.search_criteria}))}}else{D.socket.dispatchEvent("RegisterContext",x);if(H){var A=q.subscribe({channel:"3DSearch-TabManager-"+y.widget_id,topic:"InContextInit",callback:function(){D.socket.dispatchEvent("InContextSearch",x);q.unsubscribe(A)}});q.publish({channel:"3DSearch-TabManager-"+y.widget_id,topic:"activateInContextSearch",data:x})}else{D.socket.dispatchEvent("InContextSearch",x)}}}},_modifySearch:function(E,y,B){var A=this;this.log("_modifySearch");if(B.selected_command=="in_app_ok"){var C=E.object_ids[0];if(!m.is(C,"string")){return}var v=E.search_name;this.log("searchName="+v);var z=B.search_params;var w=z.originalSearchCriteria;if(y.originalSearchCriteria=="#advancedSearch"){w="#advancedSearch"}var D={query:z.query,originalSearchCriteria:w};this.log("searchParam.search_criteria="+z.query);this.log("searchParam.tagger_criteria="+z.refine);var x={method:"POST",headers:{Accept:"application/json, application/xml","Content-Type":"application/json"},data:{name:v,id:C,searchSpec:D,taggerSpec:z.refine,searchOptions:{},originalSearchCriteria:w}};if(!x.data.taggerSpec){x.data.taggerSpec=""}if(z.source){x.data.searchOptions.source=z.source}if(z.order_by&&z.order_field){x.data.searchOptions.order_by=z.order_by;x.data.searchOptions.order_field=z.order_field}x.data=JSON.stringify(x.data);E.actionsHelper.getServiceURL({id:C,service_id:E.service_id,platform_id:E.platform_id,onComplete:function(F){if(UWA.is(F,"string")){A._initSecurityContext(E,F);a.getSecurityContextPromise().then(function(){var H=a.getSecurityContext();if(H&&H.trim().length>0){x.headers.SecurityContext=H}x.url=F+"/resources/SNAPI/search_services/updateSearch";var I=x.url;var G={onComplete:function(J,L){var M=m.Json.decode(J);if(UWA.is(M)){var K={visible:true,autoHide:true,closable:true,messages:[{message:f.replace(f.get("modify_search_successful"),{search_name:M.name}),className:"success saveSearchAlert"}]};new g(K).inject(m.extendElement(document.body),"top")}},onFailure:function(L,M){var K=f.replace(f.get("save_search_failure"),{search_name:v});if(m.is(M,"string")){try{var J=JSON.parse(M);if(m.is(J)&&m.is(J.Error)){K+="<br>"+J.Error}}catch(O){console.error("Error parsing errorObject:",O)}}var N={visible:true,autoHide:false,closable:true,messages:[{message:K,className:"error saveSearchAlert"}]};new g(N).inject(m.extendElement(document.body),"top")}};G=UWA.extend(x,G,true);b.authenticatedRequest(I,G)})}}})}if(i.getOption("search_web_in_win")===true){deactivateInContextSearch({donotshowlastsearch:undefined,notify_to_cpp:false})}else{A.socket.dispatchEvent("UnregisterContext",{widget_id:c});if(true===E.manageTabContainerHideShow){q.publish({channel:"3DSearch-TabManager-"+E.widget_id,topic:"deactivateInContextSearch"})}}e.deleteSocket(n);A.socket.disconnect();delete A.socket;A.socket=null},_deleteSearch:function(A,z){var x=this;if(!m.is(z)){console.error("Bad collection arg !");return}var y=z.get(A).get("ds6w:label");var v=z.getSearchRessources().getFetchOptions({service_name:"deleteSearch",service_data:{id:A}});var w=v.url;var B={onComplete:function(G,E){var L=z.size();var I=z.get(A);var H=z.indexOf(I);var F=z.getSNSkeleton();if(UWA.is(F)){var J=F.getIDCardStatus();if(J==="expanded"||J==="collapsed"){var K=F._skeleton;if(L==1){K.slideBack()}else{var C=0;if(H==L-1){C=H-1}else{C=H+1}if(C>=0){var D=z.at(C);if(UWA.is(D)){var M="/onesearch/";M+=D.id+"/?f=0";K.setRoute(M)}}}}z.remove(A)}x._displayAlert({message:f.replace(f.get("delete_search_successful"),{search_name:y}),className:"success"},z)},onFailure:function(C){x._displayAlert({message:f.replace(f.get("delete_search_failure"),{search_name:y}),className:"error"},z)}};B=UWA.extend(v,B,true);b.authenticatedRequest(w,B)},_deleteSearch2:function(v){var w=this;var x={method:"POST",headers:{Accept:"application/json, application/xml","Content-Type":"application/json"},data:JSON.stringify({id:v.object_ids.join()})};v.actionsHelper.getServiceURL({id:v.object_ids[0],onComplete:function(y){if(UWA.is(y,"string")){w._initSecurityContext(v,y);a.getSecurityContextPromise().then(function(){var z=a.getSecurityContext();if(z&&z.trim().length>0){x.headers.SecurityContext=z}x.url=y+"/resources/SNAPI/search_services/deleteSearch";var A=v.object_ids.length>1?true:false;var B=v.actionsHelper.getValue({id:v.object_ids[0],attribute:"ds6w:label"});x.onComplete=function(C,D){v.actionsHelper.deleteResults({ids:v.object_ids});v.actionsHelper.displayAlert({message:A?f.get("delete_search_successful_multi"):f.replace(f.get("delete_search_successful"),{search_name:B}),className:"success"})},x.onFailure=function(C){v.actionsHelper.displayAlert({message:A?f.get("delete_search_failure_multi"):f.replace(f.get("delete_search_failure"),{search_name:B}),className:"error"})};b.authenticatedRequest(x.url,x)})}}})},_shareSearch:function(w){var x=this;var z=w.object_ids[0];var v=w.actionsHelper.getValue({id:z,attribute:"ds6w:label"});var y={method:"POST",headers:{Accept:"application/json, application/xml","Content-Type":"application/json"}};y.data=JSON.stringify({id:z});w.actionsHelper.getServiceURL({id:z,onComplete:function(A){if(UWA.is(A,"string")){x._initSecurityContext(w,A);a.getSecurityContextPromise().then(function(){var C=a.getSecurityContext();if(C&&C.trim().length>0){y.headers.SecurityContext=C}y.url=A+"/resources/SNAPI/search_services/savedSearch/lifecycle/share";var B={onComplete:function(D,E){w.actionsHelper.displayAlert({message:f.replace(f.get("share_search_successful"),{search_name:v}),className:"success"})},onFailure:function(D){w.actionsHelper.displayAlert({message:f.replace(f.get("share_search_failure"),{search_name:v}),className:"error"})}};B=UWA.extend(y,B,true);b.authenticatedRequest(y.url,B)})}else{}}})},_unshareSearch:function(v){var x=this;var z=v.object_ids[0];var w=v.actionsHelper.getValue({id:z,attribute:"ds6w:label"});var y={method:"POST",headers:{Accept:"application/json, application/xml","Content-Type":"application/json"}};y.data=JSON.stringify({id:z});v.actionsHelper.getServiceURL({id:z,onComplete:function(A){if(UWA.is(A,"string")){x._initSecurityContext(v,A);a.getSecurityContextPromise().then(function(){var C=a.getSecurityContext();if(C&&C.trim().length>0){y.headers.SecurityContext=C}y.url=A+"/resources/SNAPI/search_services/savedSearch/lifecycle/unshare";var B={onComplete:function(D,E){v.actionsHelper.displayAlert({message:f.replace(f.get("unshare_search_successful"),{search_name:w}),className:"success"})},onFailure:function(D){v.actionsHelper.displayAlert({message:f.replace(f.get("unshare_search_failure"),{search_name:w}),className:"error"})}};B=UWA.extend(y,B,true);b.authenticatedRequest(y.url,B)})}else{}}})},_initSecurityContext:function(w,v){a.initSecurityContext({url:v,tenant:w.actionsHelper.getPlatformID({id:w.object_ids[0]})})}});return d});define("DS/SNResultUX/utils/ConfigActions",["UWA/Core","UWA/Controls/Abstract","UWA/Utils/InterCom","DS/SNResultUX/utils/SearchServices","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","UWA/Promise","DS/SNInfraUX/SearchPreferences"],function(h,c,i,j,d,e,k,a,g,f){var b=c.extend({name:"Config_Explore_Action",_compass_socket:null,_action_info:null,_role_check_promise:null,init:function(){this._action_info=[{title:"Tree View",icon:"network",id:"config_explore",multisel:false,callback:this.launchCustoAction.bind(this)}]},availableForTypes:function(){var l=[];if(f.getItem("nav_history")){l=["Product Configuration","Configuration Feature","Configuration Option","VPMCfgConfiguration","VPMReference"]}return l},getActionForObject:function(l,m){return this._action_info},launchCustoAction:function(m){if(UWA.is(m)){var o=m.actionsHelper;var p=m.object_ids[0];var l={protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",widgetId:m.widget_id,data:{items:[{envId:o.getPlatformID({id:p}),serviceId:o.getServiceID({id:p}),contextId:"",objectId:p,objectType:o.getValue({id:p,attribute:"ds6w:type"}),displayName:o.getValue({id:p,attribute:"ds6w:label"}),displayType:o.getValue({id:p,attribute:"ds6w:type"})}]}};var n="ConfigActions";if(this._compass_socket===null){this._compass_socket=new i.Socket(n);this._compass_socket.subscribeServer("com.ds.compass",window.parent)}this._compass_socket.dispatchEvent("onSetX3DContent",l,n);e.setContentVisibility("Explore");e.instantiateAppInSearch("ExploreList","ENOSC2D_AP",l,m);e.instantiateAppInSearch("Explore3D","ENOSC3D_AP",l,m)}else{throw new Error("INVALID data received while trying to execute the whereUsed action")}}});return b});define("DS/SNResultUX/SearchPQListUX",["UWA/Core","UWA/Class","DS/SNInfraUX/SearchDebug","DS/UIKIT/Modal","DS/UIKIT/Scroller","DS/UIKIT/Autocomplete","UWA/Promise","DS/SNInfraUX/SearchSettings","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/PredefinedQueries"],function(j,k,h,e,b,i,g,c,l,a){var d=i.extend({getSuggestions:function(m){f.filterPQs(m)},onHideSuggests:function(){if(this.elements.input.value==""){f.filterPQs("")}},reset:function(m){f.filterPQs("");this._parent(m)}});var f=k.singleton(h,{abbreviationsList:[],lAbbreviationsList:[],labelList:[],llabelList:[],liList:[],PQs:[],PQUxPC:g.deferred(),init:function(){},showPQSelector:function(m){var o=m.pqSelectionCallback;var q=m.pqAccessMap;var p=m.resources;var n=this;if(!this.PQUxBuilding){this.PQUxBuilding=true;a.getPQFetchPromise().then(function(){n.pqSelectionHandler=o;n.pqAccessMap=q;var z=a.getPQs();var v=a.getPQNLS();if(!j.is(z)||!j.is(v)){console.error("No PQ to display !");return}n.load(z,v);var y=UWA.createElement("div",{styles:{height:"100%"},});var B=UWA.createElement("table",{styles:{height:"100%",width:"100%"}}).inject(y);var u=UWA.createElement("tbody").inject(B);var w=UWA.createElement("tr").inject(u);var t=UWA.createElement("tr",{styles:{height:"100%"}}).inject(u);var r=UWA.createElement("div",{styles:{height:"100%","padding-top":"10px",},"class":"pqListDivP"}).inject(t);var x=UWA.createElement("div").inject(w);var A=new d().inject(x);n.createPQList(n.labelList,n.abbreviationsList,r);n.pqModalDialog=new e({id:"search-pq-help-panel",className:"search-pq-help-panel",closable:true,header:l.get("title_pq_ux_dialog"),body:y,footer:"",events:{onHide:function(){},onShow:function(){var C=this.elements.body.getDimensions().width;if(C<450){C=578}this.elements.body.setStyle("height",C);A.elements.input.focus()}}}).inject(document.body);n.PQUxPC.resolve()})}this.PQUxPC.promise.then(function(){n.pqModalDialog.show()})},load:function(n,r){if(!j.is(n)){throw new Error("Invalid value for PQs in SearchPQListUX.load !")}if(!j.is(r)){throw new Error("Invalid value for PQsNLS in SearchPQListUX.load !")}n.PQ.sort(function(w,u){var v=r[w.pqid+".Title"];var t=r[u.pqid+".Title"];if(w.custom==u.custom){return(v>t)-(t>v)}if(w.custom==true&&u.custom==undefined){return -1}if(w.custom==undefined&&u.custom==true){return 1}});for(var p=0,q=n.PQ.length;p<q;p++){var m=n.PQ[p];if(j.is(m)){this.abbreviationsList.push(m.abbreviations);this.lAbbreviationsList.push(m.abbreviations.toLowerCase());var o=r[m.pqid+".Title"];this.labelList.push(o);if(o){this.llabelList.push(o.toLowerCase())}else{this.llabelList.push(o)}this.PQs.push(m)}}},createPQList:function(y,q,r){var v=this;var z=function(N){v.setSelectedPrefix(N.target.getAttribute("prfix")+":")};var D=a.getPQNLS();var t=UWA.createElement("div",{styles:{height:"100%",},"class":"pqListDiv"}).inject(r);var B=UWA.createElement("table",{styles:{}}).inject(t);for(var H=0;H<q.length;H++){var u=true;if(UWA.is(v.pqAccessMap)&&UWA.is(v.pqAccessMap[v.PQs[H].pqid])){u=v.pqAccessMap[v.PQs[H].pqid]}if(u){var I=q[H].split(",");var w=y[H];var C={};if(H%2==0){C.background="#F0F0F0"}else{C.background="#FfFfFf"}var A=UWA.createElement("tr",{styles:C}).inject(B);var K=UWA.createElement("table",{styles:{width:"100%","table-layout":"fixed"}}).inject(A);this.liList[H]=A;var m=UWA.createElement("tbody").inject(K);var n=UWA.createElement("tr").inject(m);var x={"word-wrap":"break-word"};var p=UWA.createElement("td",{styles:x,"class":"pq-line",id:w}).inject(n);var o=UWA.createElement("span",{html:w,"class":"pq-label"}).inject(p);var M=UWA.createElement("span",{styles:{"float":"right","text-align":"right","word-break":"break-all"},"class":"pq-abreviation-list"}).inject(p);for(var G=I.length-1;G>=0;G--){var F=I[G];var J=UWA.createElement("span",{styles:{"float":"right",}}).inject(M);var E=UWA.createElement("span",{html:"&nbsp;&nbsp;",styles:{"float":"right",}}).inject(J);var L=UWA.createElement("a",{html:F+":",events:{click:z},styles:{},"class":"pq-abreviation",id:F+":"}).inject(J);L.setAttributes({prfix:F})}}}new b({element:t}).inject(r)},filterPQs:function(q){var p=this;var o=0;var n=[];if(!q||q.replace(/\s+/g,"")===""){this.liList.forEach(function(r,t){var u=p.abbreviationsList[t];if(j.is(u)){r.show();if(o%2==0){r.setStyle("background","#F0F0F0")}else{r.setStyle("background","#FfFfFf")}o++}})}else{var m=q.toLowerCase();this.liList.forEach(function(r,u){var v=p.lAbbreviationsList[u];var t=p.llabelList[u];if(j.is(t)&&j.is(v)){if(t.indexOf(m)>-1||v.indexOf(m)>-1){r.show();if(o%2==0){r.setStyle("background","#F0F0F0")}else{r.setStyle("background","#FfFfFf")}o++}else{r.hide()}}})}},setSelectedPrefix:function(m){this.pqModalDialog.hide();this.pqSelectionHandler.call(undefined,m)}});return f});define("DS/SNResultUX/views/SearchHeaderCmd",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/UIKIT/Tooltip","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(c,g,b,f,d,e){var a=g.extend(f,b,{render:function(h){if(!c.is(h)){return null}var j=this;j.headerscontent=UWA.createElement("div",{"class":"searchHeaderCmd_content"});j.headerscontent.inject(h,"before");j.headerhistory=UWA.createElement("div",{"class":"searchHeaderCmd_content_Header"});j.headerhistory.inject(j.headerscontent);var l=UWA.createElement("span",{id:"History","class":"fonticon fonticon-navigation-history"}).inject(j.headerhistory);var k=new d({position:"bottom",target:l,body:e.get("actions.History.toolTip")});l.addEvent("click",function(m){j.dispatchEvent("onHistoryAction");m.stopPropagation()});j.headerinformationpanel=UWA.createElement("div",{"class":"searchHeaderCmd_content_Header"});j.headerinformationpanel.inject(j.headerscontent);var i=UWA.createElement("span",{id:"InfoPanel","class":"fonticon fonticon-info"}).inject(j.headerinformationpanel);k=new d({position:"bottom",target:i,body:e.get("actions.InfoPanel.toolTip")});i.addEvent("click",function(m){j.dispatchEvent("onInformationPanelAction");m.stopPropagation()})}});return a});define("DS/SNResultUX/webinwin/WebInWinTaggerProxy",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom"],function(c,g,a,h,f,e){var d=false;var b=g.extend(a,{_index_notif:0,_searchcom_socket:null,_filters:null,_proxyId:"Universal_SearchCtx_Proxy",_contextId:null,_socket_id:"",init:function(i){if(!c.is(i,"object")||!c.is(i.widgetId,"string")||!c.is(i.events.addFilterChangeListener,"function")||!c.is(i.events.addCriteriaChangeListener,"function")){throw ("E_INVALIDARG: in init !")}var k=this;this.setDebugMode(f.getDebugMode());this._socket_id="webinwinproxy_socket_"+i.widgetId+"_"+i.proxyId;this._searchcom_socket=e.createSocket({socket_id:this._socket_id});i.event_id="createProxy";i.proxyId=i.proxyId||this._proxyId;this._proxyId=i.proxyId;this._contextId=i.contextId;var j={notif_name:"event4taggerWebInWin",notif_parameters:i};this._dispatchEvent(j);this._searchcom_socket.addListener("onFilterChange",function(l){if(!c.is(l)||!c.is(l.allfilters)||!c.is(l.localfilters)){console.warn("Error, expect to have parameters.allfilters and parameters.localfilter arg !!!")}k._filters=l;i.events.addFilterChangeListener.call(null,l)});this._searchcom_socket.addListener("_internalFilterChangeListener",function(l){if(!c.is(l)||!c.is(l.allfilters)||!c.is(l.localfilters)){console.warn("Error, expect to have parameters.allfilters and parameters.localfilter arg !!!")}k._filters=l});this._searchcom_socket.addListener("addFilterChangeListener",function(l){if(!c.is(l)||!c.is(l.allfilters)||!c.is(l.localfilters)){console.warn("Error, expect to have parameters.allfilters and parameters.localfilter arg !!!")}k._filters=l;i.events.addFilterChangeListener.call(null,l)});this._searchcom_socket.addListener("addPLMUpdateListener",function(l){if(!c.is(l)||!c.is(l.allfilters)||!c.is(l.localfilters)){console.warn("Error, expect to have parameters.allfilters and parameters.localfilter arg !!!")}k._filters=l;i.events.addPLMUpdateListener.call(null,l)});this._searchcom_socket.addListener("addRequestSuggestsListener",function(l){if(!c.is(l)||!c.is(l.allfilters)||!c.is(l.localfilters)){console.warn("Error, expect to have parameters.allfilters and parameters.localfilter arg !!!")}k._filters=l;i.events.addRequestSuggestsListener.call(null,l)});this._searchcom_socket.addListener("addCriteriaChangeListener",function(l){if(!c.is(l)){console.warn("Error, expect to have valid parameters arg !!!")}k._filters=l;i.events.addCriteriaChangeListener.call(null,l)});this._searchcom_socket.addListener("addVisibilityChangeListener",function(l){if(!c.is(l)){console.warn("Error, expect to have valid parameters arg !!!")}d=l});this.log("WebInWinTaggerProxy.createProxy sent")},toggleProxyFocus:function(i){this.log("WebInWinTaggerProxy.toggleProxyFocus sent");var k={event_id:"toggleProxyFocus",status_focus:i,proxyId:this._proxyId,contextId:this._contextId};var j={notif_name:"event4taggerWebInWin",notif_parameters:k};this._dispatchEvent(j)},getCurrentFilter:function(){this.log("WebInWinTaggerProxy.getCurrentFilter");return this._filters},getDisplayStatus:function(){this.log("WebInWinTaggerProxy.getDisplayStatus");return c.clone(d)},clearLocalFilter:function(){if(UWA.is(this._filters),"object"){this._filters={}}this.log("WebInWinTaggerProxy.clearLocalFilter sent");var i={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"clearLocalFilter",proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(i)},setLocalFilter:function(i,k){this.log("WebInWinTaggerProxy.setLocalFilter sent");var j={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"setLocalFilter",options:i,warn:k,proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(j)},setTags:function(j,i,l){this.log("WebInWinTaggerProxy.setTags sent");var k={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"setTags",tagsdata:j,summaryData:i,attribute:l,proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(k)},addSubjects:function(i){this.log("WebInWinTaggerProxy.addSubjects sent");var j={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"addSubjects",tagsdata:i,proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(j)},setCriteria:function(i){this.log("WebInWinTaggerProxy.setCriteria sent");var j={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"setCriteria",suggestedArray:i,proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(j)},updateCriteria:function(i){this.log("WebInWinTaggerProxy.updateCriteria sent");var j={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"updateCriteria",suggestedArray:i,proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(j)},updatePLMSuggestions:function(i){this.log("WebInWinTaggerProxy.updatePLMSuggestions sent");var j={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"updatePLMSuggestions",suggestedArray:i,proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(j)},updateSuggestions:function(i){this.log("WebInWinTaggerProxy.updateSuggestions sent");var j={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"updateSuggestions",suggestedArray:i,proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(j)},removeCriteria:function(i){this.log("WebInWinTaggerProxy.removeCriteria sent");var j={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"removeCriteria",predicatesToRemove:i,proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(j)},displayCriteria:function(j){this.log("WebInWinTaggerProxy.displayCriteria sent");var i={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"displayCriteria",proxyId:this._proxyId,contextId:this._contextId,checkIsACriteria:j}};this._dispatchEvent(i)},unsetTags:function(){this.log("WebInWinTaggerProxy.unsetTags sent");var i={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"unsetTags",proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(i)},focusOnSubjects:function(i,j,l){this.log("WebInWinTaggerProxy.focusOnSubjects sent");var k={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"focusOnSubjects",subjectsURI:i,persistTags:j,dataSources:l,proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(k)},unfocus:function(){this.log("WebInWinTaggerProxy.focusOnSubjects sent");var i={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"unfocus",proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(i)},die:function(){this.log("WebInWinTaggerProxy.die sent");var i={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"die",proxyId:this._proxyId,contextId:this._contextId}};var j;if(UWA.is(this._contextId)){i.notif_parameters.contextId=this._contextId;j=h.getSubscriptions({channel:this._contextId,topic:"WebInWinTaggerProxy_die"})}if(UWA.is(j,"array")&&j.length>0){h.publish({channel:this._contextId,topic:"WebInWinTaggerProxy_die",data:i})}else{this._dispatchEvent(i)}e.deleteSocket(this._socket_id)},setPredicates:function(i){this.log("WebInWinTaggerProxy.setPredicates sent");var j={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"setPredicates",predicates:i,proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(j)},toggleDisplayAll:function(j){this.log("WebInWinTaggerProxy.toggleDisplayAll sent");var i={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"toggleDisplayAll",force:j,proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(i)},toggleDisplayAllCriteria:function(j){this.log("WebInWinTaggerProxy.toggleDisplayAllCriteria sent");var i={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"toggleDisplayAllCriteria",force:j,proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(i)},activate:function(){this.log("WebInWinTaggerProxy.activate sent");var i={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"activate",proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(i);e.deleteSocket(this._socket_id)},deactivate:function(){this.log("WebInWinTaggerProxy.deactivate sent");var i={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"deactivate",proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(i);e.deleteSocket(this._socket_id)},_dispatchEvent:function(i){if(!c.is(i,"object")||!c.is(i.notif_parameters,"object")){throw ("E_INVALIDARG: in _dispatchEvent !")}var j=i;j.notif_parameters.index_notif=this._index_notif;this._searchcom_socket.dispatchEvent("onDispatchToWin",j);this._index_notif=this._index_notif+1}});return b});define("DS/SNResultUX/views/SearchContentSet",["UWA/Core","DS/W3DXComponents/ContentSet","DS/SNInfraUX/SearchSettings"],function(d,c,e){var b="search-content-set";function a(g,i){var h;if(g){h=g[i];if(d.is(h,"function")){h=h.call(g)}}return h}var f=c.extend({name:b,test:false,setup:function(){this.addEvent("onItemRendered",this._onItemRendered,this);this._parent()},buildMultiselOnCheck:function(h){if(this.multiselHeaderView){var l=this.contentsViews[this.currentViewId].nestedView;var m=l.getSelectionState();if(m.isActive){if(!d.is(h,"array")){(l.isSelected(h))?l.removeSelection(h):l.addSelection(h)}else{for(var k=0;k<h.length;k++){if(!l.isSelected(h[k])){l.addSelection(h[k])}}}}else{if(!d.is(h,"array")){if(d.is(h)&&!l.isSelected(h)){l.addSelection(h);l.activateMultisel(false)}else{l.deactivateMultisel();this.multiselHeaderView.dispatchEvent("onMultiselOff")}}else{for(var g=0;g<h.length;g++){if(d.is(h[g])&&!l.isSelected(h[g])){l.addSelection(h[g])}}}}this.multiselHeaderView.buildMultisel(m);if(l.selectionIsEmpty()&&!m.wasExplicitlyActivated){l.deactivateMultisel()}}},_initMultiselHeaderView:function(){if(!this.getOption("actions").collection){return}var k={},l="onItemViewSelect",j=this,h,i;var g=a(this,"multiselHeader");i=this._multiselHeaderViewEvents={onMultiselOn:function(){var n=this.contentsViews[this.currentViewId];if(this.currentViewId!=="table"&&UWA.is(this.contentsViews.table)){var m=this.contentsViews.table;m.nestedView.activateMultisel()}n.nestedView.activateMultisel(true);this.dispatchEvent("onMultiselOn",arguments)},onMultiselOff:function(){var n=this.contentsViews[this.currentViewId];if(this.currentViewId!=="table"&&UWA.is(this.contentsViews.table)){var m=this.contentsViews.table;m.nestedView.deactivateMultisel()}n.nestedView.deactivateMultisel();this.dispatchEvent("onMultiselOff",arguments)},onActionClick:function(){Array.prototype.unshift.call(arguments,this.actionsView);this.dispatchEvent("onActionClick",arguments)}};if(e.getOption("actionsProtocol_FUN065512")){i.onActionClickDotted=function(){var n=j.getSelection();if(UWA.is(n,"array")){if(UWA.is(j.collection)){var m=j.collection.getSNSkeleton();if(UWA.is(m)){m.buildMultiselActions(n)}}}}}h=this.multiselHeaderView=new g(this.getMultiselHeaderViewOptions());this.listenTo(h,i);return h},getMultiselHeaderViewOptions:function(){var g=this._parent.apply(this,arguments);if(!d.is(g)){g={}}g["data-rec-id"]=true;return g},getActionsViewOptions:function(){var h=this;var g=this._parent();g.filterer=function(j){var l=h.collection._snSkeleton._searchActions.displayMode;if(!d.is(l)){return true}var i=j.get("icon");var k=j.get("displayMode");var m=j.get("id");return(!d.is(k,"string"))?true:(k==="AllView")?true:(k.search(l)>=0)};return g},_onItemRendered:function(){var i=this.collection._snSkeleton._searchActions;if(d.is(i)){i.setSearchContentSetDivContainer(this.container);var h=i.displayMode;if(d.is(h,"string")){i.setDisplayMode(h)}}var g=d.extendElement(this.container).getElement(".search-content-set-header");this.collection._snSkeleton.options.observable.setSearchContentSetHeader(g);if(d.is(g)&&d.is(g.hide,"function")&&(!d.is(this.collection.totalCount)||this.collection.totalCount<0)&&!e.getOption("deactivateHideToolbar")){g.hide()}},destroy:function(){if(this.multiselHeaderView){this.stopListening(this.multiselHeaderView,this._multiselHeaderViewEvents)}this.removeEvent("onItemRendered",this._onItemRendered,this);this._parent()}});return f});define("DS/SNResultUX/views/WebUX/Tree/TreeNodeView",["DS/Tree/TreeNodeView","DS/Core/PointerEvents","DS/Utilities/Dom"],function(d,b,a){var c=300;return d.extend({_observeEvents:function(){var i=this;var l=0;var h;var g=false;this.elements.container.addEvent(b.POINTERDOWN,function e(m){a._increaseCurrentPositionInStack(i.elements.container);g=false;if(!m.touchFlag){g=i._uiNodeUpForTouchOrDownForMouse(m,"down")}a._decreaseCurrentPositionInStack()});this.elements.container.addEvent("click",function f(n){a._pushUserInteractionContext();var m=i.getGridEngine();var o=i.getCellInfos();var p=o.nodeModel;if(!g&&o.isHeader===false&&o.dataIndex!=="selection"&&o.dataIndex!=="actions"){i._uiNodeUpForTouchOrDownForMouse(n,"up")}g=false;if(h!==undefined){clearTimeout(h)}h=setTimeout(function(){l=0},c);l++;if(n.which===1){if(l===1||n.touchFlag&&n.detail===0){var o=i.getCellInfos();i.getGridEngine()._recordInteractionFromUI({event:"node:click",data:{nodeRecordPath:o.nodeModel&&o.nodeModel.getStructurePath?o.nodeModel.getStructurePath():o.nodeModel,virtualRowID:o.virtualRowID,virtualColumnID:o.virtualColumnID}});i.getGridEngine()._modelEvents.publish({event:"nodeclick",data:o})}if(l===2){i.getGridEngine()._modelEvents.publish({event:"nodeDblClick",data:i.getCellInfos()})}}a._popUserInteractionContext()});this._eventDetailDown=0;this._eventDetailDownTO;var j=function(m){a._pushUserInteractionContext();if(m.type==="touchend"){m.preventDefault()}if(m.which===1||m.type==="touchend"){i._uiExpandCollapse()}a._popUserInteractionContext()};this.elements.expanderContainer.addEvent("mouseup",j);this.elements.expanderContainer.addEvent("touchend",j);var k=function(m){m.stopPropagation();m.preventDefault()};this.elements.expanderContainer.addEventListener("contextmenu",k);this.elements.expanderContainer.addEventListener(b.LONGHOLD,k)},})});define("DS/SNResultUX/utils/ResultsUtils",["UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNVocabAccess"],function(b,c,d){var a={from_filters_to_uql:function(F,n){var C="",H,z,B,w;var f=0;var m=c.getOption("NLSMapping_3DSearch_Suggest_TACTICALOnly");for(var G in F){if(G.indexOf("sixw:")===0){var h=G.replace("sixw:","");h=h.split("/").pop();if("ds6w:dataSource"===h){continue}if(UWA.is(m)&&m.hasOwnProperty(h)){if(UWA.is(m[h])&&b.is(m[h],"string")&&0==m[h].indexOf("ds6wg:")){h=m[h]}}h="["+h+"]";H=F[G];var k="";if(0<f){k=" AND "}f++;var p=false;for(B=0;B<H.length;B++){z=H[B];if(!b.is(z.type)){continue}if(0===B){if(1<H.length){k+="( ";p=true}}if((0<B)&&p){k=" OR "}if(z.type==="string"){if(!b.is(z.object)){continue}var A=z.object;var r=false;var e=h;if(h==="[ds6w:type]"){if(0<=A.indexOf(":")){r=true}if(0==A.indexOf("ds6wg:")){if(c.getOption("SEARCH_INSTANCES")){var g=A.split(":");var v;if(g.length>2){v=g.pop();A=g.join(":");if(v==="Instance"){A=A.replace("ds6wg:","reltypes/")}else{if(v==="Class"){A=A.replace("ds6wg:","types/")}}}else{A=g.join(":");if(true===d.IsClassAnInstance(A)){A=A.replace("ds6wg:","reltypes/")}}}else{A=A.replace("ds6wg:","types/")}e="flattenedtaxonomies"}}if(h==="[vpmextension]"){if(0<=A.indexOf(":")){r=true}if(0==A.indexOf("ds6wg:")){A=A.replace("ds6wg:","interfaces/");e="flattenedtaxonomies"}}if(0==A.indexOf("enum|")){r=true;A=A.replace("enum|","")}if(r){w=e+':"'+A+'"'}else{w=e+":"+A}C+=k+w}else{if(z.type==="date"){if(!b.is(z.object)){continue}if(b.is(z.object.from)){var l=new Date(z.object.from+" 00:00:00");var y=new Date(l).toISOString();w=h+'>="'+y+'"';C+=k+w;if(b.is(z.object.to)){k=" AND "}}if(b.is(z.object.to)){var u=new Date(z.object.to+" 23:59:59");var t=new Date(u).toISOString();w=h+'<="'+t+'"';C+=k+w}}else{if(z.type==="double"||z.type==="integer"){if(!b.is(z.object)){continue}if(b.is(z.object.from)){w=h+">="+z.object.from;C+=k+w;if(b.is(z.object.to)){k=" AND "}}if(b.is(z.object.to)){w=h+"<="+z.object.to;C+=k+w}}else{if(z.type==="boolean"){if(!b.is(z.object)){continue}w=h+":"+z.object;C+=k+w}}}}if(p){if(H.length===(B+1)){C+=" )"}}}}else{if(b.is(F[G],"array")&&F[G].length>0&&b.is(F[G][0])&&b.is(F[G][0].type,"string")&&F[G][0].type==="date"){var j=F[G][0].object;if(!b.is(j,"string")){continue}var k="";if(0<f){k=" AND "}f++;var h=G.split("/").pop();h="["+h+"]";var E=j.split("/");var q=E.length;var l=null,u=null,t=null;var D=null,x=0,o=1;if(1===q){D=parseInt(j);if(!isNaN(D)){l=new Date(D,0);u=new Date(D+1,0)}}else{if(2===q){D=parseInt(E[0]);x=parseInt(E[1]);"";if(!isNaN(D)&&!isNaN(x)){l=new Date(D,x-1);u=new Date(D,x)}}else{if(3===q){D=parseInt(E[0]);x=parseInt(E[1]);o=parseInt(E[2]);if(!isNaN(D)&&!isNaN(x)&&!isNaN(o)){l=new Date(D,x-1,o);u=new Date(D,x-1,o+1)}}}}var y=new Date(l).toISOString();w=h+'>="'+y+'"';C+=k+w;k=" AND ";u=new Date(u.getTime()-1);t=u.toISOString();w=h+'<="'+t+'"';C+=k+w}}}return C}};return a});define("DS/SNResultUX/utils/SearchLocalActions",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchServices","UWA/Promise","UWA/Class/Collection","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/SearchUtils","DS/WAFData/WAFData","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/SearchLogin",],function(k,l,h,d,n,i,m,a,o,f,j,e,c){var b=UWA.Class.Model.extend({idAttribute:"id"});var g=l.singleton(h,{_action_Unselect_All:{sourcejs:"DS/SNResultUX/utils/Select_ActionHandler",icon:"select-none",multisel:true,id:"unselect_all",title:o.get("unselectAllTitle")},_action_Select_All:{sourcejs:"DS/SNResultUX/utils/Select_ActionHandler",icon:"select-all",multisel:true,id:"select_all",title:o.get("selectAllTitle")},_action_Preview:{sourcejs:"DS/SNResultUX/utils/Select_ActionHandler",icon:"eye",multisel:true,id:"new_preview",title:o.get("previewTitle")},_isGoodInput:function(q,p){if(!UWA.is(q,"array")||q.length<0){return false}if(!UWA.is(p,"object")||!UWA.is(p.skeleton)){return false}return true},_isSelectionFromSameSource:function(r){var p=new m([],{model:b});var q=new i(function(A,C){var v="",w="";var y=true;var x={appName:f.SEARCH_APP_ID,objects:[]};var z=function(D){var E=D.get("ds6w:type_value");var F={id:D.id,type:E,source:D.getSourceID()};x.objects.push(F);p.add(F)};var u=r.length;for(var t=0;t<u&&y;t++){var B=r[t];if(k.is(B)){z(B);if(t===0){w=B.getSourceID();v=B.getServiceID();x.platformId=B.getPlatformID()}else{if(v!==B.getServiceID()){y=false}}}}if(y){A({data:x,sourceID:w,serviceID:v,objectsToTreat:p,models:r})}else{C({data:x,sourceID:w,serviceID:v,objectsToTreat:p,models:r})}});return q},_buildEmptyAction:function(p){return{actions:[],id:p}},_buildEmptyActionsOnFailure:function(q){var p={actions:[],status:"failure"};for(var r=0;r<q.data.objects.length;r++){p.actions.push(this._buildEmptyAction(q.data.objects[r].id))}return p},_addEmptyActions:function(q,v){if(UWA.is(q)&&UWA.is(q.actions,"array")){if(v.objectsToTreat.size()!==q.actions.length){for(var p=0;p<q.actions.length;p++){var u=q.actions[p];v.objectsToTreat.remove(v.objectsToTreat.get(u.id))}var t=v.objectsToTreat.toArray();if(UWA.is(t,"array")){for(var r=0;r<t.length;r++){q.actions.push(this._buildEmptyAction(t[r].get("id")))}}}}},_addSelectUnselect:function(q,r){if(f.isFUNActive("FUN075064")){if(UWA.is(q)&&UWA.is(q.actions,"array")){for(var p=0;p<q.actions.length;p++){var t=q.actions[p].actions;if(r.add_unselectAll){t.unshift(this._action_Unselect_All)}if(r.add_selectAll){t.unshift(this._action_Select_All)}}}}},_addPreview:function(q,r){if(UWA.is(r)&&UWA.is(r.skeleton)){if(f.isInTheSimpleSearch()===false&&d.getOption("enableNewSearchViews")===true){if(UWA.is(q)&&UWA.is(q.actions,"array")){for(var p=0;p<q.actions.length;p++){var t=q.actions[p].actions;if(r.add_preview===true){t.push(this._action_Preview)}}}}}},_getLanguage:function(){var p=f.getLanguage();if("zh"==p){p+="_CN"}return p},_treatActionImages:function(p,q){if(p&&k.is(p.actions,"array")){p.actions.forEach(function(r){if(k.is(r.actions,"array")){var u=r.actions;for(var t=0;t<u.length;t++){if(u[t].iconImage){if(u[t].iconImage.indexOf("://")>0){u[t].image=u[t].iconImage}else{u[t].image=q+u[t].iconImage}}}}})}},executeWSAction:function(r){if(UWA.is(r)){var q=r.url,v=r.method;if(UWA.is(q,"string")&&UWA.is(v,"string")){var t=this;var u={};u.method=v;u.headers=r.headers||{};u.headers["Accept-Language"]=this._getLanguage();u.url=r.url+"/?oid="+r.selected_obj;if(UWA.is(r.data,"object")||UWA.is(r.data,"array")){u.data=JSON.stringify(r.data)}else{if(UWA.is(r.data,"string")){u.data=r.data}}var p=function(w){var z=null,y=null;try{var x=JSON.parse(w);z=x.message;if(!UWA.is(z,"string")){z="INVALID response";y="error"}y=x.status;if(!UWA.is(y)){y="success"}}catch(A){z="INVALID response";y="error"}r.displayAlert({message:z,className:y})};u.onComplete=function(w){t.log("WS execution done, inide onComplete");p(w)};u.onFailure=function(w){t.log("WS execution done, inide onFailure");p(w)};j.authenticatedRequest(u.url,u)}else{this.log("invalid execute options, url = "+q+", method="+v)}}},getActions:function(p){var q=this;if(UWA.is(p)){if(!UWA.is(p.data)||!UWA.is(p.data.objects)||(p.data.objects.length===0)){if(UWA.is(p.onFailure,"function")){p.onFailure.call(undefined,{type:"invalid_inputs",error:"invalid inputs"})}}else{var r=function(u){var t={};t.method="POST";t.headers=u.headers||{};t.headers.Accept="application/json";t.headers["Accept-Language"]=q._getLanguage();t.headers["Content-Type"]="application/json";t.url=u.url;t.data=JSON.stringify(p.data);t.onComplete=function(w){var v=k.is(w,"string")?(w.length>0?JSON.parse(w):{}):w;if(UWA.is(p.onComplete,"function")){p.onComplete.call(undefined,v)}};t.onFailure=function(v){if(UWA.is(p.onFailure,"function")){p.onFailure.call(undefined,{type:"web_service_failure",error:v})}};j.authenticatedRequest(t.url,t)};if(UWA.is(p.serviceID,"string")&&p.serviceID.length>0){a.getServiceUrl({serviceName:p.serviceID,platformId:p.data.platformId,onComplete:function(t){e.load({serviceID:p.serviceID,platformID:p.data.platformId,serviceURL:t}).then(function(v){if(UWA.is(v.getActions,"function")){var u={models:p.models,widget_id:p.widget_id,data:p.data,serviceURL:t,headers:{Accept:"application/json","Accept-Language":q._getLanguage()},onComplete:function(w){if(UWA.is(p.onComplete,"function")){q._treatActionImages(w,t);p.onComplete.call(undefined,w)}},onFailure:function(w){if(UWA.is(p.onFailure,"function")){p.onFailure.call(undefined,{type:"action_delegation_failure",error:w})}}};v.getActions(u)}else{if(UWA.is(v.getActionsPath,"function")){r({url:t+v.getActionsPath({sourceID:p.sourceID,platformID:p.data.platformId})})}else{if(UWA.is(p.onFailure,"function")){p.onFailure.call(undefined,{type:"action_delegation_not_impl",error:"service delegation for actions not implemented"})}}}},function(u){e.discover({platformID:p.data.platformId,sourceID:p.sourceID}).then(function(w){if(UWA.is(w,"object")&&UWA.is(w.APIs,"object")){var v=w.APIs.getActionsPath;if(UWA.is(v,"object")&&UWA.is(v.url,"string")){r({url:v.url,headers:v.headers})}}},function(){if(UWA.is(p.onFailure,"function")){p.onFailure.call(undefined,{type:"require_failure",error:u})}})})}})}else{e.discover({platformID:p.data.platformId,sourceID:p.sourceID}).then(function(u){if(UWA.is(u,"object")&&UWA.is(u.APIs,"object")){var t=u.APIs.getActionsPath;if(UWA.is(t,"object")&&UWA.is(t.url,"string")){r({url:t.url,headers:t.headers})}}},function(){if(UWA.is(p.onFailure,"function")){p.onFailure.call(undefined,{type:"require_failure",error:error})}})}}}},computeCtxActions:function(r,y){if(!this._isGoodInput(r,y)){throw ("input is not in expected format")}var t=this;var p=y.skeleton;var u=k.is(r,"array")?r.length:0;var q=k.is(p)&&k.is(p._onesearch_collection)&&k.is(p._onesearch_collection.totalCount)?p._onesearch_collection.totalCount:0;var w=undefined;var x=undefined;if(!d.getOption("search_web_in_win")&&(k.is(p)&&p._selectionMode_techno!=="oneToOne")&&!k.is(d.getOption("search_compact_mode"))){w={add_selectAll:u!==q,add_unselectAll:true}}var v=true;if(k.is(y)&&k.is(y.fromPreview)&&y.fromPreview===true){v=false}x={add_preview:v,skeleton:p};this._isSelectionFromSameSource(r).then(function(z){z.data.applicativeInfo={incontextMode:UWA.is(y.skeleton.getOption("in_apps_search"))?true:false,clientAppInfo:f.identifyClientInfo(y.skeleton.getOption("addinMode"))};if(UWA.is(p)){z.widget_id=p.getOption("widgetId")}z.onComplete=function(A){if(A.status==="success"){t._addEmptyActions(A,z);if(UWA.is(w)){t._addSelectUnselect(A,w)}if(UWA.is(x)){t._addPreview(A,x)}y.skeleton.setCtxMenuForItemViewOptions({actions_data:A,dropdownOptions:y})}else{var A=t._buildEmptyActionsOnFailure(z);if(UWA.is(w)){t._addSelectUnselect(A,w)}if(UWA.is(x)){t._addPreview(A,x)}y.skeleton.setCtxMenuForItemViewOptions({actions_data:A,dropdownOptions:y})}};z.onFailure=function(B){if(UWA.is(B)&&UWA.is(B.error)){console.warn("Error during action computation: "+B.error);if(!d.getOption("search_web_in_win")){if(B.type==="invalid_inputs"){var A={actions:[{actions:[]}]};t._addSelectUnselect(A,{add_selectAll:true})}else{var A=t._buildEmptyActionsOnFailure(z);if(UWA.is(w)){t._addSelectUnselect(A,w)}if(UWA.is(x)){t._addPreview(A,x)}}}y.skeleton.setCtxMenuForItemViewOptions({actions_data:A,dropdownOptions:y})}};t.getActions(z)},function(A){var z=t._buildEmptyActionsOnFailure(A);if(UWA.is(w)){t._addSelectUnselect(z,w)}if(UWA.is(x)){t._addPreview(z,x)}y.skeleton.setCtxMenuForItemViewOptions({actions_data:z,dropdownOptions:y});n._displayAlert({message:o.replace(o.get("localActions_multiSource")),className:"error"})})}});return g});define("DS/SNResultUX/views/PCSView",["UWA/Drivers/Alone","UWA/Core","UWA/Class/Model","UWA/Class/View","UWA/Class/Collection","DS/3DXHighcharts/3DXHighcharts","DS/HighChartsModules/HighCharts_drilldown","DS/WebappsUtils/Performance","DS/SNInfraUX/SearchUtils","text!DS/SNResultUX/assets/PCSView.json","i18n!DS/SNResultUX/assets/nls/SNResultUX_PCS.json"],function(l,j,e,a,h,g,f,c,i,b,m){var d=function(n){var w=e.extend({setup:function(){try{var z=JSON.parse(this._attributes.name);this._attributes=j.extend(this._attributes,z,true)}catch(y){}}});var p=JSON.parse(b),x={};switch(n){case"columnrange":var t=c.getEntriesByType("mark"),r=0,u=new h(t,{model:w,from_getEntries:true});x=j.extend(p[n],x,true);x.title.text=m.get("PCSView.columnrange.chart.title");x.subtitle.text=m.get("PCSView.columnrange.chart.subtitle");x.xAxis.title.text=m.get("PCSView.xAxis.title");x.yAxis.title.text=m.get("PCSView.yAxis.title");x.xAxis.labels.formatter=function(){return m.get("PCSView.labels."+this.value)};x.tooltip.formatter=function(){return m.replace(m.get("PCSView.tooltip."+this.key),{duration:(this.point.high-this.point.low)})};var v=[];u.forEach(function(z){var A=u.where({name:z.get("name"),uuid:z.get("uuid")}),D=A[0].clone();if(A.length===2&&z.get("status")==="start"){D.set({endTime:A[1].get("startTime")})}else{if(A.length===1){D.set({endTime:"NaN"})}}if(UWA.is(D.get("drilldown"))){D.set({drilldown:D.get("drilldown")+"_"+D.get("uuid")})}if(UWA.is(D.get("drilldown_serie_id"))){var y=D.get("endTime"),C=D.get("drilldown_serie_id"),B=u.filter(function(E){return !(E.get("startTime")>y)&&E.get("drilldown")===C});if(B.length>0){D.set({drilldown_serie_id:B[0].get("drilldown")+"_"+B[0].get("uuid")})}}if(z.get("status")!=="end"){v.push(D)}});u.reset(v);var q=u.pluck("drilldown");q.forEach(function(z){if(z===undefined){return}x.drilldown.series.push({id:z,data:[]});var A=x.drilldown.series.length-1,y=u.where({drilldown_serie_id:z});y.forEach(function(B){x.drilldown.series[A].data.push({id:z,name:B.get("name"),low:B.get("startTime"),high:B.get("endTime"),drilldown:B.get("drilldown")})})});var o=u.reject(function(y){return UWA.is(y.get("drilldown_serie_id"))});o.forEach(function(A){var y=A.get("drilldown"),z=u.max(function(C){return C.get("drilldown_serie_id")===y?C.get("endTime"):0}).get("endTime"),B={name:A.get("name"),low:A.get("startTime"),high:z,drilldown:A.get("drilldown")};x.series[0].data.push(B)});break;default:throw new Error("Invalid chart type")}return x};var k=a.extend({name:"search_pcs_view",highcharts_options:{},setup:function(p){var n=this;n._parent(p);var r=UWA.createElement("div",{"class":"pcs_result_action"}).inject(n.container),o=UWA.createElement("div",{"class":"pcs_result_charts"}).inject(n.container);UWA.createElement("span",{"class":"pcs_close_btn fonticon-2x fonticon fonticon-back",events:{click:function(){n.dispatchEvent("onClose");n.destroy()}}}).inject(r);n.highcharts_options=j.extend(d("columnrange"),n.highcharts_options,true);if(p.width&&p.height){n.highcharts_options.chart.width=p.width;n.highcharts_options.chart.height=p.height}else{if(p.renderTo){n.highcharts_options.chart.width=p.renderTo.getSize().width;n.highcharts_options.chart.height=p.renderTo.getSize().height}}n.highcharts_options.chart.renderTo=o;var q=new g.Chart(n.highcharts_options);if(p.renderTo){this.render().inject(p.renderTo)}},render:function(n){return this}});return k});define("DS/SNResultUX/utils/Select_ActionHandler",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events"],function(b,e,a,d){var c=e.singleton(d,a,{executeAction:function(f,h){if(!b.is(f,"object")||!b.is(f.object_ids,"array")||!b.is(f.action_id,"string")||!f.actionsHelper){throw ("invalid input to action handler")}switch(f.action_id){case"select_all":var g=f.actionsHelper;g.selectAll(f);break;case"unselect_all":var g=f.actionsHelper;g.unselectAll(f);break;case"new_preview":var g=f.actionsHelper;g.preview(f);break}},});return c});define("DS/SNResultUX/utils/ImageHelper",["UWA/Core","UWA/Class","UWA/Class/Debug"],function(b,c,a){var d=c.extend(a,{name:"DS_SNResultUX_utils_ImageHelper",_gridView:null,_cellInfos:null,_image:null,_onImageLoad:function(){var h=this._cellInfos.cellView;var e=this._image.height;var g=this._image.width;if(g>198||e>148){if(b.is(h.setPictureBackgroundSize,"function")){h.setPictureBackgroundSize("contain")}else{if(b.is(h.contentView)&&b.is(h.contentView.setPictureBackgroundSize,"function")){h.contentView.setPictureBackgroundSize(h,"contain")}}var f;if(b.is(this._cellInfos.virtualCellID)){f=this._cellInfos.virtualCellID}else{if(b.is(this._cellInfos.cellID)){f=this._cellInfos.cellID}}this._gridView.setAsBigPicture(f)}else{if(b.is(h.setPictureBackgroundSize,"function")){h.setPictureBackgroundSize("auto")}else{if(b.is(h.contentView)&&b.is(h.contentView.setPictureBackgroundSize,"function")){h.contentView.setPictureBackgroundSize(h,"auto")}}}},init:function(f,e){this._cellInfos=f;this._gridView=e;this._image=new Image();this._image.addEventListener("load",this._onImageLoad.bind(this),true);this._image.src=f.nodeModel.options.thumbnail},destroy:function(){if(this._image){this._image.removeEventListener("onload",this._onImageLoad.bind(this),true)}this._gridView=null;this._image=null;this._cellInfos=null}});return d});define("DS/SNResultUX/views/EmptyView",["DS/W3DXComponents/Views/Temp/TempItemView","UWA/Core","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","css!DS/SNResultUX/SNResultUX.css","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchDebug","DS/WebappsUtils/WebappsUtils"],function(c,g,i,e,d,f,b){var h="empty-view";var a=c.extend(f,{uwaClassName:"DS/SNResultUX/views/EmptyView",name:h,tagName:"div",defaultOptions:{icon:undefined,title:i.get("loading"),request_criteria:null},setup:function(j){this.container.addClassName(this.getClassNames())},template:function(){var n='<div class="'+this.getClassNames("-infos")+' search-empty-view">',q=this.options.icon,r=i.get("loading"),k=this.options.request_criteria_without_precond?this.options.request_criteria_without_precond.call():null,o=null;if(g.is(this.options.getCollection,"function")){o=this.options.getCollection()}var m=false;if(g.is(o,"object")&&g.is(o.getFailureView,"function")&&true===o.getFailureView()){m=true}if(true===m){n='<div style="padding-bottom: 15%" class="'+this.getClassNames("-infos")+' search-empty-view">'}if(g.is(o,"object")&&g.is(o.getSNSkeleton,"function")&&g.is(o.getSNSkeleton()._searchActions,"object")&&g.is(o.getSNSkeleton()._searchActions.getEmptyViewMessage,"function")){r=o.getSNSkeleton()._searchActions.getEmptyViewMessage()}if(q){n+='<span class="'+this.getClassNames("-icon")+" center-block fonticon fonticon-5x fonticon-"+q+'" ></span>'}if(true===m){q=[b.getWebappsAssetUrl("SNResultUX","images/Search_Error_Icon.png")];n+="<img src="+q+"></img>";r=i.get("error.msg.display");n+='<span class="'+this.getClassNames("-title")+' center-block">'+r+"</span>";var p=i.get("error.msg.display.cmd");if(g.is(o,"object")&&g.is(o._parse_alert,"array")&&1===o._parse_alert.length&&g.is(o._parse_alert[0])&&g.is(o._parse_alert[0].messageObj,"object")&&g.is(o._parse_alert[0].messageObj.message,"string")){p=o._parse_alert[0].messageObj.message}n+='<span style="color: #77797c;font-weight: unset" class="'+this.getClassNames("-subtitle")+' center-block">'+p+"</span>"}else{var l="";if(k&&k.service_params){l=k.service_params.query}if((l&&l.length&&l!==d.SearchTypeEnum.ADVANCED_SEARCH)||(l==d.SearchTypeEnum.MY_RECENT_CONTENT)){if(r&&r!==i.get("loading")){n+='<span class="'+this.getClassNames("-title")+' center-block">'+r+"</span>"}if(k.without_precond){l=k.without_precond}var j="";if(r=="*"){j=i.get("warning_star")}if(j!==""){n+='<span class="'+this.getClassNames("-subtitle")+' center-block">'+i.replace(i.get("qryStr_warning"),{warning:j})+"</span>"}}else{r=i.get("no_criteria");if(r){n+='<span class="'+this.getClassNames("-title")+' center-block">'+r+"</span>"}}}n+="</div>";return n},});return a});define("DS/SNResultUX/views/PropertiesServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/ServiceDelegationLoader","DS/i3DXSNDictionaryAPI/3DXSearchDictionaryAccess","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(h,i,e,a,b,d,c,g,j){var f=i.singleton(a,e,{name:"DS_SNResultUX_utils_PropertiesServices",_internal_attr:["type_icon_url","id","resourceid","resourceid_tagger","preview_url","image","icon","actions","subtitle","icon_source"],init:function(){this.setDebugMode(b.getDebugMode())},_HTMLDecode:function(k){if(!k){return k}k=k.replace(/&amp;/g,"&");k=k.replace(/&gt;/g,">");k=k.replace(/&lt;/g,"<");k=k.replace(/&quot;/g,'"');k=k.replace(/&#039;/g,"'");return k},displaySearchItemProperties:function(n,q,G,E,p,F,B){if(!h.is(n)||!h.is(q)||!h.is(p)){F(q)}var o=false;var r=p.getSupportedServicesArray();if(h.is(r)&&h.is(r.services)){if(r.services.indexOf(E)===-1){o=true}}if(UWA.is(n.isAShowOnlyObject,"function")){var y=n.isAShowOnlyObject();if(y===true){o=true}}if(h.is(B)){q.set("isTransient",true);var I={};var L=B.length;for(var H=0;H<L;H++){var m=new G();var z=B[H];m.set("name",z.id);m.set("path",z.id);m.set("label",z.title);m.set("value",z.value);I[z.id]=m}q.set(I);if(h.is(F,"function")){F(q)}return}if(o===false){F(q)}else{q.set("isTransient",true);q.set("type_icon_url",n.get("type_icon_url"));q.set("previewUrl",n.get("preview_url"));q.set("preview_url",n.get("preview_url"));var v=this;var w=n.pairs();w.sort(function(N,M){if(N[0]>M[0]){return 1}else{if(N[0]<M[0]){return -1}}return 0});var l=[],u=[],J=[],C=false,x=false;for(var A=0;A<w.length;A++){var K=w[A][0];var D=w[A][1];if(D){var t=K.match(/\/([^/]*)$/);if(t===null){t=K}else{t=t[1]}if(v._internal_attr.indexOf(K)===-1&&K.indexOf("_value")===-1&&(K.indexOf("ds6w:")!==-1||K.indexOf("ds6wg:")!==-1)&&l.indexOf(t)===-1){l.push(t);u.push(D)}}}var k=function(){var M={};var N=l.length;for(var S=0;S<N;S++){var O=new G();var P=l[S];O.set("name",P);O.set("path",P);var Q=P;if(h.is(v.nlsPredicate)&&h.is(v.nlsPredicate[P])&&h.is(v.nlsPredicate[P].nlsName)){Q=v.nlsPredicate[P].nlsName}if(!h.is(Q)||Q===""){Q=P}O.set("label",Q);var T=u[S];var U="";if(T instanceof Array){if(T.length>0){for(var R=0;R<T.length;R++){U+=v._HTMLDecode(T[R])+(R===T.length-1?"":" | ")}}O.set("value",U)}else{if(T.length>0){O.set("value",T);if(P==="ds6w:type"){O.set("urlIcon",n.get("type_icon_url"))}else{if(P==="ds6w:label"){O.set("sectionIdentityCard","title")}else{if(P==="ds6w:created"){O.set("sectionIdentityCard","date")}else{if(P==="ds6w:responsible"){O.set("sectionIdentityCard","ownerName")}}}}}}M[P]=O}M["ds6w:what/ds6w:type_value"]=n.get("ds6w:what/ds6w:type_value");q.set(M);x=true};g.getElementsNls(l.join(","),{tenantId:q.get("tenant"),lang:d.getLanguage(),onComplete:function(M){v.nlsPredicate=M;if(x===false){k.call()}if(h.is(F,"function")){F(q)}},onFailure:function(){if(x===false){k.call()}if(h.is(F,"function")){F(q)}}})}},getPropModelFromSearchItem:function(q,k,p,v,l,n){var m=[];if(!h.is(q)||!h.is(k)||!h.is(p)||!h.is(v)){l(m);return m}var o=this;var t=null;var u="businessobject";if(UWA.is(q.IsAnInstance,"function")){if(q.IsAnInstance()===true){u="relationship"}}var r=q.getServiceID();t=new k({metatype:u,objectId:q.id,source:r,tenant:q.getPlatformID()});o.displaySearchItemProperties(q,t,p,r,v,function(w){m.push(t);var x=q.getPlatformID();widget.setValue("x3dPlatformId",x);if(h.is(l)){l(m)}},n)},getOptions:function(l){var k={typeOfDisplay:l.EditPropConstants.ALL,selectionType:l.EditPropConstants.NO_SELECTION,readOnly:true,extraNotif:true,editMode:true};var n=function(){var o=[{text:j.get("section.properties.title"),name:l.EditPropConstants.FACET_PROPERTIES,icon:"attributes",expandedFlag:true}];if(b.getOption("propertyTabsAsAccordeon")===true){k.facets=[l.EditPropConstants.FACET_PROPERTIES]}else{k.facets=[l.EditPropConstants.FACET_PROPERTIES,l.EditPropConstants.FACET_SWYM_CONTENT,l.EditPropConstants.FACET_SWYM_USER_PROPERTIES,l.EditPropConstants.FACET_SWYM_COMMUNITY_PROPERTIES,l.EditPropConstants.FACET_SWYMCOMMENTS]}l.onComplete.call(undefined,k,o)};var m=this;if(UWA.is(l)&&UWA.is(l.model)){c.load({serviceID:l.model.getServiceID(),platformID:l.model.getPlatformID()}).then(function(o){if(UWA.is(o.getFacets,"function")){o.getFacets({model:l.model,constants:l.EditPropConstants,setContext:function(p){k.context=p},setReadOnly:function(p){k.readOnly=p},setFacets:function(q,p){if(UWA.is(q,"array")){k.facets=q;l.onComplete.call(undefined,k,p)}},addFacets:function(q,p){if(UWA.is(q,"array")){if(b.getOption("propertyTabsAsAccordeon")===true){k.facets=q;l.onAddFacets.call(undefined,k,p)}else{l.onAddFacets.call(undefined,q)}}}})}else{n()}},function(){n()})}else{n()}}});return f});define("DS/SNResultUX/views/SearchCounterView",["UWA/Core","DS/W3DXComponents/Views/Temp/TempItemView"],function(b,d){var a="set-detail-view";var c=d.extend({name:a,tagName:"div",_totalRecords:0,template:function(){return'{{#if title}}<span class="'+this.getClassNames("-title")+'">{{title}}</span><span class="'+this.getClassNames("-count")+'" id="search-nb-result">{{itemsLength}}</span>{{/if}}'},init:function(e){e=b.clone(e||{},false);["container","template","tagName"].forEach(function(f){delete e[f]});this._parent.call(this,e);if(!(b.is(e)&&b.is(e.collection)&&b.is(e.collection.totalCount)&&e.collection.totalCount>=0)){this.hide()}},setup:function(){this.container.addClassName(this.getClassNames("-container"))},mixinTemplateHelpers:function(){var f=this._parent.apply(this,arguments),g=this.collection,e=g.totalCount;!e&&(e=g.size());if(g.totalCount<g.length){e=g.length}else{e=g.totalCount}f.itemsLength=e;return f},setOptions:function(e){var f=this;this._parent.apply(this,arguments);var h=this.collection;if(e.title){var g=this.templateHelpers||(this.templateHelpers={});g.title=e.title||g.title;if(h){this.listenTo(h,{onAdd:function(){if(f._totalRecords!==f.collection.totalCount){this.render.apply(this,arguments);f.show();f.container.setStyle("visibility","visible")}},onRemove:function(){if(f._totalRecords!==f.collection.totalCount){this.render.apply(this,arguments);f.show();f.container.setStyle("visibility","visible")}},onReset:function(){f._totalRecords=0;this.render.apply(this,arguments);if(b.is(f.collection.totalCount)&&f.collection.totalCount>=0){f._totalRecords=f.collection.totalCount;f.show();f.container.setStyle("visibility","visible")}else{f.hide();f.container.setStyle("visibility","hidden")}},onSync:function(){f._totalRecords=0;this.render.apply(this,arguments);if(b.is(f.collection.totalCount)&&f.collection.totalCount>=0){f.show();f.container.setStyle("visibility","visible")}else{f.container.setStyle("visibility","hidden")}}})}}else{if(h){this.stopListening(h)}}return this}});return c});define("DS/SNResultUX/utils/SearchSortView",["UWA/Core","UWA/Class/Debug","UWA/Class","UWA/Controls/Abstract","UWA/Promise","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/WebappsUtils/Performance","DS/SNResultUX/utils/SearchServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/UIKIT/Iconbar","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(k,h,l,d,i,c,g,m,f,j,a,n,o,b,e){return d.extend(h,{_searchcom_socket:null,_view:null,_container:null,_body:null,_defaultItem:[{dataIndex:"ds6w:modified",type:"num"},{dataIndex:"ds6w:label",type:"alpha"},{dataIndex:"ds6w:created",type:"num"},{dataIndex:"ds6w:responsible",type:"alpha"},{dataIndex:"ds6w:type",type:"group"},],_listItemExtend:[],_activedItem:"",_activedItemId:"",_activedItemOrder:"",_menuIcon:"",_subscriptions:null,_nlsPromises:{},init:function(q){this._parent(q);this._subscriptions={};var r=this;if(!this._searchcom_socket){this._searchcom_socket=j.createSocket({socket_id:"sortView_socket_"+a.now(),widgetId:q.widgetId});this._subscriptions.setOrderInGridView=c.subscribe({channel:r.getOption("messagingChannel"),topic:"setOrderInGridView",callback:this.setOrderByExt.bind(this)});this._subscriptions.addSortItem=c.subscribe({channel:r.getOption("messagingChannel"),topic:"addSortItem",callback:this.updateRenderByExt.bind(this)});if(this._searchcom_socket){this._searchcom_socket.addListener("checkNewColomnForSort",this.checkNewColumnForSort.bind(this))}}if(q&&q.container){this._container=q.container;this._collection=q.collection;this.options=q;if(!q.defaultSort){if(f.getOption("default_sort")){var p=f.getOption("default_sort");if(k.is(p,"object")&&k.is(p.order_by,"string")&&k.is(p.order_field,"string")&&k.is(p.order_type,"string")){this.options.defaultSort={dataIndex:p.order_field,order:p.order_by,type:p.order_type}}}else{if(f.getOption("apply_sort_on_modified_by_default")){this.options.defaultSort={dataIndex:"ds6w:modified",order:"desc",type:"num"}}else{this.options.defaultSort={dataIndex:"relevance",order:"group",type:"pertinency"};this._activedItem="relevance"}}}r._setByDefaultSort();r.render()}},render:function(p){var q=this;this._view=new b({renderTo:q._container,styles:{padding:"0px",marginBottom:"0px",height:"45px",},events:{onClick:function(r){q._promiseVocabNLS("ds6w");i.all(q._getNLSPromises()).then(function(t){if(q.getDropdown()){q.getDropdown().elements.container.setHTML("");q.getDropdown().setBody(q._getBody())}else{setTimeout(function(){q.getDropdown().elements.container.setHTML("");q.getDropdown().setBody(q._getBody());q.updateStateInPanel()},50)}q.updateStateInPanel();return q._view},function(){return q._view})}},items:[{fonticon:q._menuIcon?q._menuIcon:q._getIconByTypeAndOrder("alpha","asc"),text:o.get("sortMenuLabel"),content:{type:"dropdown",tag:"ul",options:{className:"dropdown-menu dropdown-menu-root dropdown dropdown-root",events:{onClick:function(u){var t=u.target||u.srcElement;if(t.id&&q._allowSort(t.getAttribute("dataIndex"))){q._activedItemId=t.id;q._activedItem=t.getAttribute("dataIndex");q._activedItemOrder=t.getAttribute("order");q._menuIcon=t.className;this.options.target.children[0].className=t.className;var r=q._collection.service_parameters.query===g.SearchTypeEnum.MY_RECENT_CONTENT;c.publish({channel:q.getOption("messagingChannel"),topic:"sortForAllView",data:{order_field:t.getAttribute("dataIndex"),order_by:t.getAttribute("order"),isRecent:r}})}}},body:this._getBody()}}}]})},_promiseVocabNLS:function(p){if(!this._nlsPromises[p]){this._nlsPromises[p]=new i(function(r,q){m.loadVocabulary(p,function(t){if(k.is(t)&&t.status==="success"){r()}else{q()}})})}},_promisePredicateNLS:function(p){var q=this;if(m.getVocabId(p)!="ds6w"){this._nlsPromises[p]=new i(function(t,r){var v="";var u=this.getOption("collection");if(k.is(u)&&k.is(u.search_ressources)&&k.is(u.search_ressources.getActiveTenant,"function")){v=u.search_ressources.getActiveTenant()}e.getResourcesInfo(p,{tenantId:v,lang:g.getLanguage(),apiVersion:"R2019x",onComplete:function(w){for(var x=0;x<q._listItemExtend.length;x++){if(q._listItemExtend[x].dataIndex==p){q._listItemExtend[x].nlsName=w.vocabularyElementNLSInfo[0].nlsName}}t()},onFailure:t})})}},_getNLSPromises:function(){var p=this;return Object.keys(p._nlsPromises).map(function(q){return p._nlsPromises[q]})},updateStateInPanel:function(){if(this.getDropdown()){var t=this.getDropdown().elements.container.children[0].children;for(var q=0;q<t.length;q++){var r=t[q].children[1].children;for(var p=0;p<r.length;p++){r[p].removeClassName("sortActived");if(r[p].id===this._activedItemId){r[p].addClassName("sortActived")}}}}},updateMenu:function(){this._hide();this._i=this._i?this._i+1:1;var p=this;setTimeout(function(){if(p._i!==0){p._i=0;p.getDropdown()&&p.getDropdown().setBody(p._getBody())}},1000)},reinitMenu:function(){this._hide();this.emptyItemExtend();if(!f.getOption("search_web_in_win")){this._setByDefaultSort()}this.getDropdown()&&this.getDropdown().setBody(this._getBody())},getDropdown:function(){if(this._view){return this._view.menu.getItem(0).content.component}},_hide:function(){if(this.getDropdown()){this.getDropdown().hide()}},_getBody:function(){this._body={html:[]};this._initDefaultItems();this._addFromListExtend();return this._body},addItemExtend:function(q){var p=this;var t=this._listItemExtend.map(function(u){return u.dataIndex});var r=Array.isArray(q)?q:[q];r.forEach(function(u){if(t.indexOf(u.dataIndex)===-1){p._listItemExtend.push(u);p._promisePredicateNLS(u.dataIndex)}})},removeItemExtend:function(r){var t=this._listItemExtend.map(function(u){return u.dataIndex});var q=[];var p=Array.isArray(r)?r:[r];p.forEach(function(v,u){if(t.indexOf(v.dataIndex)!==-1){q.push(v.dataIndex)}});this._listItemExtend=this._listItemExtend.filter(function(u){return q.indexOf(u.dataIndex)===-1})},emptyItemExtend:function(){this._listItemExtend=[]},_allowSort:function(p){if(this._collection.state.totalRecords<=1000){return true}else{switch(p){case"relevance":case"ds6w:label":case"ds6w:who/ds6w:responsible":case"ds6w:when/ds6w:created":case"ds6w:when/ds6w:modified":case"ds6w:responsible":case"ds6w:created":case"ds6w:modified":return true;default:n._displayAlert({message:o.get("sortLimitByLessThen1000Results"),className:"warning"});return false}}},_setByDefaultSort:function(){if(!(this.options.defaultSort&&this.options.defaultSort.dataIndex&&this.options.defaultSort.order)){return}this._activedItemId=this.options.defaultSort.dataIndex+"-"+this.options.defaultSort.order;this._activedItem=this.options.defaultSort.dataIndex;this._activedItemOrder=this.options.defaultSort.order;this._menuIcon=this._getIconByTypeAndOrder(this.options.defaultSort.type,this.options.defaultSort.order)},_setOrder:function(q,r,p){this._activedItemId=this._getIdByTypeIndexAndOrder(r,q,p);this._activedItem=q;this._activedItemOrder=this.options.defaultSort.order;this._menuIcon=this._getIconByTypeAndOrder(r,p);if(this._view&&this._view.elements.container&&this._view.elements.container.children[0]&&this._view.elements.container.children[0].children[0]&&this._view.elements.container.children[0].children[0].children[0]){this._view.elements.container.children[0].children[0].children[0].className=this._menuIcon}this._hide()},setOrderByExt:function(p){this.updateRenderByExt(p);c.publish({channel:this.getOption("messagingChannel"),topic:"sortForAllView",data:{order_field:p.order_field,order_by:p.order_by}})},updateRenderByExt:function(q){this._hide();if(q.order_field&&q.order_by){var p;if("relevance"===q.order_field){p={dataIndex:"relevance",type:"pertinency",order_by:q.order_by}}else{p=this._defaultItem.filter(function(r){return(r.dataIndex.indexOf("/")!==-1)?(r.dataIndex.split("/")[1]===q.order_field):(r.dataIndex===q.order_field)});p=p?p[0]:""}if(p){this._setOrder(p.dataIndex,p.type,q.order_by)}else{if(!q.nlsName){this.addItemExtend({dataIndex:q.order_field})}else{this.addItemExtend({dataIndex:q.order_field,nlsName:q.nlsName})}this._setOrder(q.order_field,"",q.order_by);this.updateMenu()}}},checkNewColumnForSort:function(u){var t=this;if(Array.isArray(u)){if(u.length>0){var r=u.map(function(v){return v.dataIndex});var q=this._defaultItem.concat(this._listItemExtend);var p=[];q.forEach(function(v){if(r.indexOf(v.dataIndex)===-1){p.push(v.dataIndex)}});t._defaultItem=t._defaultItem.filter(function(v){return p.indexOf(v.dataIndex)===-1});t._listItemExtend=t._listItemExtend.filter(function(v){return p.indexOf(v.dataIndex)===-1});if(p.indexOf(t._activedItem)!==-1){t._setByDefaultSort()}}else{this._listItemExtend=[]}this.updateMenu()}},_addFromListExtend:function(){var p=this;var q=this._defaultItem.map(function(r){return r.dataIndex});this._listItemExtend.forEach(function(r){if(q.indexOf(r.dataIndex)===-1){p._addItem(r.dataIndex,r.type,r.nlsName)}})},_addItem:function(q,r,p){var t={tag:"li","class":"item item-template sortPanelRow",html:[{tag:"span","class":"item-text",text:p?p:m.getNLSValueForPredicate(q)},{tag:"div","class":"item-text item-icon-group",html:[]}]};switch(r){case"alpha":t.html[1].html=[{tag:"span",title:o.get("tooltip_SortAsc"),id:q+"-asc",order:"asc",dataIndex:q,"class":this._getIconByTypeAndOrder(r,"asc")},{tag:"span",title:o.get("tooltip_SortDesc"),id:q+"-desc",order:"desc",dataIndex:q,"class":this._getIconByTypeAndOrder(r,"desc")}];break;case"num":t.html[1].html=[{tag:"span",title:o.get("tooltip_SortAsc"),id:q+"-asc",order:"asc",dataIndex:q,"class":this._getIconByTypeAndOrder(r,"asc")},{tag:"span",title:o.get("tooltip_SortDesc"),id:q+"-desc",order:"desc",dataIndex:q,"class":this._getIconByTypeAndOrder(r,"desc")}];break;case"group":t.html[1].html=[{tag:"span",title:o.get("tooltip_SortGroup"),id:q+"-group",order:"asc",dataIndex:q,"class":this._getIconByTypeAndOrder(r,"asc")}];break;case"pertinency":t.html[1].html=[{tag:"span",title:o.get("tooltip_SortGroup"),id:q+"-group",order:"desc",dataIndex:q,"class":this._getIconByTypeAndOrder(r,"asc")}];break;default:t.html[1].html=[{tag:"span",title:o.get("tooltip_SortAsc"),id:q+"-asc",order:"asc",dataIndex:q,"class":this._getIconByTypeAndOrder(r,"asc")},{tag:"span",title:o.get("tooltip_SortDesc"),id:q+"-desc",order:"desc",dataIndex:q,"class":this._getIconByTypeAndOrder(r,"desc")}]}if(this._body&&this._body.html){this._body.html.push(t)}},_getIconByTypeAndOrder:function(q,p){switch(q){case"alpha":return"fonticon fonticon-sort-alpha-"+p;case"num":return"fonticon fonticon-sort-num-"+p;case"group":return"fonticon fonticon-tag-sorting";case"pertinency":return"fonticon fonticon-sorting";default:return(p)?"fonticon fonticon-sort-alpha-"+p:"fonticon fonticon-sort-alpha-asc"}},_getIdByTypeIndexAndOrder:function(r,q,p){switch(r){case"group":return q+"-group";case"pertinency":return("relevance"===q)?q+"-group":q+"-"+p;default:return q+"-"+p}},_initDefaultItems:function(){var q=this;var r=[];if(k.is(this._collection)&&k.is(this._collection.service_parameters,"object")&&this._collection.service_parameters.query!==g.SearchTypeEnum.MY_RECENT_CONTENT){r.push({dataIndex:"relevance",type:"pertinency",nls:g.isInTheSimpleSearch()?o.get("relevancySort"):o.get("defaultSort")})}var p=r.concat(this._defaultItem);p.forEach(function(t){q._addItem(t.dataIndex,t.type,t.nls)})},destroy:function(){this._searchcom_socket.removeListener("checkNewColomnForSort");this._searchcom_socket.disconnect();j.deleteSocket(this._searchcom_socket.id);this._searchcom_socket=null;if(k.is(this._view)&&k.is(this._view.destroy,"function")){this._view.destroy();delete this._view}this._parent()}})});define("DS/SNResultUX/views/SearchHistoryTree",["UWA/Core","UWA/Class/View","UWA/Utils/InterCom","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Tooltip","DS/etree/syncwidget","DS/egraph/core","DS/egraph/utils","DS/egraph/views","DS/etree/iact","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","css!egraph/views","css!etree/syncviews","css!etree/basicviews","css!egraph/views_default","css!DS/etree/overviewui.css"],function(n,d,o,g,l,m,f,b,e,c,a,h,j,i,q){var p=d.extend({_treeDocument:null,_graph:null,_lastNode:null,_searchNode:null,_currentSelectNode:null,_lastSelectNode:null,_listOfTreeGraph:null,_stopCreated:false,_ifHaveExploreOrRelatedNode:false,_fullsize:true,_container:null,_compass_socket:null,_AlReadyRender:false,customNodeView:function k(){var t=function(D){var B;var C=D.nodeView;var E=D.nodeModel;B=C.querySelector(".etree-sync-node-icon");if(n.is(B)){B.classList.remove("hidden")}if(E.options.icons&&E.options.icons.length>0){B.style.backgroundImage='url("'+E.options.icons[0]+'")'}else{if(B){B.classList.add("hidden")}}C.querySelector(".etree-sync-node-label").textContent=E.options.label;if(f.inPathSet(D.changes,"data","data","_isHighlighted")||f.inPathSet(D.changes,"data","data","_isSelected")){if(E._isHighlighted||E._isSelected){C.classList.add("highlighted")}else{C.classList.remove("highlighted")}}B=C.querySelector(".fonticon.fonticon-filter");if(n.is(B)&&n.is(E.options.filter)&&E.options.filter===true){B.style.visibility="visible"}else{if(n.is(B)){B.style.visibility="hidden"}}};var v={};var r=function r(){e.HTMLNodeView.call(this)};b.inherit(r,e.HTMLNodeView);r.prototype.buildNodeElement=function x(){var B=document.createElement("div");B.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget template1">','    <div class="etree-sync-node-header">','      <div class="etree-sync-node-icon"></div>','      <div class="etree-sync-node-label">noname</div>','      <div class="fonticon fonticon-filter"></div>',"    </div>",'    <div class="etree-sync-node-content">','       <div class="etree-sync-node-description">desc</div>',"    </div>","  </div>","</div>"].join("\n");return B.querySelector(".etree-sync-node").cloneNode(true)};r.prototype.onmodifyDisplay=function u(E,C){var B;var D=E.data.data;e.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments);B=n.extendElement(this.display.elt);t({nodeModel:D,nodeView:B,changes:C});B.querySelector(".etree-sync-node-description").textContent=D.options.description};var A=function A(){e.HTMLNodeView.call(this)};b.inherit(A,e.HTMLNodeView);A.prototype.buildNodeElement=function x(){var B=document.createElement("div");B.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget template2">','      <div class="fonticon fonticon-filter"></div>','      <div class="etree-sync-node-icon"></div>','      <div class="etree-sync-node-label">noname</div>','      <div class="etree-sync-node-content"></div>',"  </div>","</div>"].join("\n");return B.querySelector(".etree-sync-node").cloneNode(true)};A.prototype.onmodifyDisplay=function u(E,C){var B;var D=E.data.data;e.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments);B=n.extendElement(this.display.elt);t({nodeModel:D,nodeView:B,changes:C});B.querySelector(".etree-sync-node-content").textContent=D.options.description};var z=function z(){e.HTMLNodeView.call(this)};b.inherit(z,e.HTMLNodeView);z.prototype.buildNodeElement=function x(C){if(!n.is(C)||!n.is(C.data)){return}var B=document.createElement("div");B.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget template3">','      <div class="etree-sync-node-icon"></div>','      <div class="etree-sync-node-label">noname</div>','      <div class="etree-sync-node-firstcontent">','        <div class="etree-sync-node-firstcontent-label1">No Children</div>','        <div class="etree-sync-node-firstcontent-label2">No results</div>',"      </div>",'      <div class="etree-sync-node-secondcontent">','       <div class="etree-sync-node-secondcontent-label1">No Parents</div>','       <div class="etree-sync-node-secondcontent-label2">No results</div>',"      </div>","  </div>","</div>"].join("\n");return B.querySelector(".etree-sync-node").cloneNode(true)};z.prototype.onmodifyDisplay=function u(E,C){var B;var D=E.data.data;e.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments);B=n.extendElement(this.display.elt);t({nodeModel:D,nodeView:B,changes:C});if(D.options.childrenlabel&&D.options.childrenlabel.length>0){B.getElement(".etree-sync-node-firstcontent-label1").textContent=D.options.childrenlabel;B.getElement(".etree-sync-node-firstcontent-label2").textContent=D.options.childrenresults}if(D.options.parentslabel&&D.options.parentslabel.length>0){B.getElement(".etree-sync-node-secondcontent-label1").textContent=D.options.parentslabel;B.getElement(".etree-sync-node-secondcontent-label2").textContent=D.options.parentsresults}if(D.options.rootslabel&&D.options.rootslabel.length>0){B.getElement(".etree-sync-node-thirdcontent-label1").textContent=D.options.rootslabel;B.getElement(".etree-sync-node-thirdcontent-label2").textContent=D.options.rootsresults}};var y=function y(){e.HTMLNodeView.call(this)};b.inherit(y,e.HTMLNodeView);y.prototype.buildNodeElement=function x(C){if(!n.is(C)||!n.is(C.data)){return}var B=document.createElement("div");B.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget template4">','      <div class="etree-sync-node-label">noname</div>','      <div class="etree-sync-node-firstcontent">','        <span class="fonticon fonticon-network"></span>','        <span class="item-text-first" style="text-align: center;">Structure</span>',"      </div>",'      <div class="etree-sync-node-secondcontent">','        <span class="fonticon fonticon-component"></span>','        <span class="item-text-second" style="text-align: center;">Related</span>',"      </div>","  </div>","</div>"].join("\n");return B.querySelector(".etree-sync-node").cloneNode(true)};y.prototype.onmodifyDisplay=function u(E,C){var B;var D=E.data.data;e.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments);B=n.extendElement(this.display.elt);t({nodeModel:D,nodeView:B,changes:C});if(D.options.childrenlabel&&D.options.childrenlabel.length>0){B.getElement(".item-text-first").textContent=D.options.childrenlabel}if(D.options.parentslabel&&D.options.parentslabel.length>0){B.getElement(".item-text-second").textContent=D.options.parentslabel}};v.newNodeView=function w(B){var C=B.data;if(C.options.type==="type1"){return new r()}else{if(C.options.type==="type2"){return new A()}else{if(C.options.type==="type3"){return new z()}else{return new y()}}}};return v},render:function(r,w){var u=this;if(!n.is(r)||u._container!==null||u._AlReadyRender===true){return}u._listOfTreeGraph=[];u._AlReadyRender=true;u._container=r;u._graph=new m.SyncEGraphTree(u._container,{orientation:m.OrientationMode.ROOT_ON_LEFT,nodeView:u.customNodeView(),fittingArea:{paddingLeft:-25,paddingRight:0,paddingTop:-25,paddingBottom:0}});u._graph.widget.document.nodeHeight=90;u._graph.widget.document.nodeWidth=130;u._graph.setModel(u.getTreeDocument());u._graph.expandAll();u._graph.widget.sm.rootState.movePredicate=function v(){return false};u._graph.widget.sm.rootState.onmousedown=function(z,x){if(x.dom.className.contains("item-text-first")||x.dom.className.contains("fonticon fonticon-network")||x.dom.className.contains("item-text-second")||x.dom.className.contains("fonticon fonticon-component")){if(x.inside&&x.button===1){if(n.is(x.grElt)&&n.is(x.grElt.data)&&n.is(x.grElt.data.data)){var y=x.grElt.data.data;if(y){if(x.dom.className.contains("item-text-first")||x.dom.className.contains("fonticon fonticon-network")){if(n.is(y.options)&&n.is(y.options.onClickchildren,"function")){y.options.onClickchildren.call(u,y)}}else{if(x.dom.className.contains("item-text-second")||x.dom.className.contains("fonticon fonticon-component")){if(n.is(y.options)&&n.is(y.options.onClickparents,"function")){y.options.onClickparents.call(u,y)}}}}}}return{}}return c.RootState.prototype.onmousedown.apply(this,arguments)};var t=new UWA.Element("div",{"class":"fonticon fonticon-resize-full",});t.inject(u._container);new l({position:"bottom",target:t,body:q.get("relation.maxminTooltip")});t.onclick=function(){if(u._fullsize===true){u._container.style.height="100%";u._fullsize=false;this.removeClassName("fonticon fonticon-resize-full");this.addClassName("fonticon fonticon-resize-small")}else{u._container.style.height="100px";u._fullsize=true;this.removeClassName("fonticon fonticon-resize-small");this.addClassName("fonticon fonticon-resize-full")}}},getTreeDocument:function(){var r=this;if(r._treeDocument===null){this._treeDocument=new a({useAsyncPreExpand:true,shouldAcceptDrag:function(){return false},shouldAcceptDrop:function(){return false}});r._treeDocument.getXSO().onAdd(function(t){r.onSelected(t)})}return r._treeDocument},addSearchModel:function(t){var x=this;if(!n.is(t)){return}var r=x._treeDocument;if(!n.is(r)){r=x.getTreeDocument()}var y=false;if(n.is(t.refine)&&t.refine===true){y=true;if(n.is(t.searchParam)&&n.is(t.searchParam.adv_search)&&t.searchParam.adv_search===true){if(x._lastNode===null){y=false}else{if(x._lastNode&&x._lastNode._options.SNtype!=="Search"){y=false}}}}else{if(x._lastNode){if(x._lastNode._options.SNtype==="Search"){y=true}}}if(y===false){r.prepareUpdate();t.type="type1";t.icons=[g.getWebappsAssetUrl("SNResultUX","images/Box_Search.png")];t.useAsyncPreExpand=false;t.label=q.get("search.box");t.description=t.description;t.SNtype="Search";var u=new h(t);r.addRoot(u);r.pushUpdate();x._lastNode=u;x._searchNode=u;var w={SNtype:"Search",contextid:t.contextid,widgetAppId:t.widgetAppId};j.setContentVisibility(w);x._currentSelectNode=null;x._lastSelectNode=null;if(x._graph){x._graph.expandAll()}}else{if(x._currentSelectNode&&x._currentSelectNode._options.SNtype==="Children"){var v=x._currentSelectNode._options.description;if(n.is(t.count)){v=v.replace(/[0-9]/,t.count)}x._currentSelectNode.updateOptions({searchParam:t.searchParam,description:v,filter:t.filter,})}else{if(x._searchNode){x._searchNode.updateOptions({description:t.description,searchParam:t.searchParam,filter:t.filter});x._lastNode=x._searchNode}}}return x._lastNode},addSearchSelectModel:function(B){var A=this;var v=A._treeDocument;if(!n.is(v)){v=A.getTreeDocument()}var u=A._searchNodebyIdInSameBranch(B.id);if(n.is(u)&&u!==null){return}var x=false;var r=true;var w=false;if(UWA.is(B)&&!UWA.is(B,"object")){x=true;w=true;if(A._lastSelectNode){A._lastSelectNode.removeChildren();A._lastNode=A._lastSelectNode}}else{if(A._lastNode&&A._lastNode._options.SNtype==="Select"){if(A._lastNode.getChildren()===null){x=true}}else{if(A._currentSelectNode&&((A._currentSelectNode._options.SNtype==="Search")||(A._currentSelectNode._options.SNtype==="Children"))){A._lastNode=A._currentSelectNode}else{if(A._lastNode&&A._lastNode._options.SNtype==="Children"){if(A._lastNode.getChildren()===null&&!n.is(A._lastNode._isSelected)){x=true;if(A._lastSelectNode){A._lastSelectNode.removeChildren();A._lastNode=A._lastSelectNode}}}else{if(A._lastNode&&A._lastNode._options.SNtype===""){x=true;if(A._lastSelectNode){A._lastSelectNode.removeChildren();A._lastNode=A._lastSelectNode}}}}}}if(x===true){if(w===true){A._lastSelectNode.updateOptions({description:B+q.get("relation.selected"),id:null,model:null})}else{A._lastSelectNode.updateOptions({description:B.description,id:B.id,model:B.model})}A._lastNode=A._lastSelectNode;r=false}else{var y=i.getOption("nav_history_parallel");if(y===false){r=true;if(A._currentSelectNode&&A._currentSelectNode._options.SNtype==="Search"){if(A._currentSelectNode.hasChildren()){var t=A._currentSelectNode.getChildren()[0];A._removeAllNodeWithWidget(t);t.updateOptions({description:B.description,id:B.id,model:B.model});A._lastNode=t;r=false}}}if(r===true){B.SNtype="Select";B.type="type1";B.icons=[g.getWebappsAssetUrl("SNResultUX","images/Box_Select.png")];B.useAsyncPreExpand=false;B.description=B.description;B.label=q.get("select.box");v.prepareUpdate();var z=new h(B);A._lastNode.addChild(z);A._lastNode=z;A._lastSelectNode=A._lastNode;A._currentSelectNode=null;v.pushUpdate();if(A._graph){A._graph.expandAll()}}}return A._lastNode},removeLastSelectNode:function(){var t=this;if(t._lastNode){if(t._lastNode._options.SNtype==="Select"){var v=true;var x=t._lastNode.getChildren();if(x){var u=x.length;var w=null;for(var r=0;r<u;r++){w=x[r];if(w&&n.is(w._options)&&n.is(w._options.SNtype)&&w._options.SNtype==="Children"&&n.is(w._isSelected)){}}if(w){v=false}}if(v===true){t._lastNode=t._lastNode.getParent();t._lastNode.removeChildren()}}else{if(t._lastNode._options.SNtype==="Children"){v=true;if(t._currentSelectNode&&t._currentSelectNode._options.SNtype==="Children"){v=false}else{if(t._currentSelectNode&&t._currentSelectNode._options.SNtype==="Select"){v=false}else{if(!n.is(t._lastNode._isSelected)){v=true}}}if(v===true){if(t._lastSelectNode){t._lastNode=t._lastSelectNode.getParent();t._lastNode.removeChildren()}}}}}},addRelationsModel:function(x){var A=this;var H=function(S){if(!n.is(S)){return}var R=S.getParent();if(R){R.removeChild(S);A._lastNode=R}};var J=i.getOption("nav_history_related");if(J===false){if(n.is(x)&&n.is(x.model)&&n.is(x.model.fromApp)&&x.model.fromApp===true){var M=x.model;var G=null;var L={type:"type4",SNtype:"Children",useAsyncPreExpand:false,contextid:x.contextid,widgetAppId:x.widgetAppId,};L.label=M.displayName;L.childrenlabel=q.get("tree.box");L.parentslabel=q.get("graph.box");L.model=M;L.id=M.id;var P=function(T){var U=T.id;var R={protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",widgetId:x.widgetAppId,data:{items:[{envId:T.getPlatformID(),serviceId:T.getServiceID,contextId:"",objectId:U,objectType:T.get("ds6w:type_value"),displayName:T.displayName,displayType:T.get("ds6w:type")}]}};var S="HistoryActions";if(A._compass_socket===null){A._compass_socket=new o.Socket(S);A._compass_socket.subscribeServer("com.ds.compass",window.parent)}A._compass_socket.dispatchEvent("onSetX3DContent",R,S);return R};var E={description:M.displayName,widgetAppId:x.widgetAppId,contextid:x.contextid};L.onClickparents=function(T){if(!n.is(T)){return}H(T);var S=A.addRelationalModel(E);var U=P(T.options.model);var R={historyNode:S,nav_history:true};j.setContentVisibility("Relational");j.instantiateAppInSearch("Relational","ENORIPE_AP",U,R)};L.onClickchildren=function(T){if(!n.is(T)){return}H(T);var S=A.addExploreModel(E);var U=P(T.options.model);var R={historyNode:S,nav_history:true};j.setContentVisibility("Explore");j.instantiateAppInSearch("ExploreList","ENOSC2D_AP",U,R);j.instantiateAppInSearch("Explore3D","ENOSC3D_AP",U,R)};var y=null;var O=A._lastNode;if(n.is(A._lastNode._options.id)){y=A._lastNode._options.id}if(A._currentSelectNode!==null&&n.is(A._currentSelectNode._options.id)){y=A._currentSelectNode._options.id;O=A._currentSelectNode}if(!n.is(O)){return}if(!n.is(y)){return}if(y===x.model.id){if(A._lastNode.hasChildren()===true){var z=A._lastNode.getChildren();if(z){var D=z.length;var N=null;for(var K=0;K<D;K++){N=z[K];if(N&&n.is(N._options)){if(N._options.SNtype!=="Relational"||N._options.SNtype!=="Explore"){return}}}}}}var B=A.getTreeDocument();if(!n.is(B)){return}B.prepareUpdate();A._removeAllNodeWithWidget(O);G=new h(L);O.addChild(G);if(G!==null){A._lastNode=G}B.pushUpdate();A._currentSelectNode=null;if(A._graph){A._graph.expandAll()}return G}}else{if(J===true){var F=false;if(A._currentSelectNode&&A._currentSelectNode._options.SNtype==="Select"){F=false}else{if(A._lastNode&&!(A._lastNode._options.SNtype==="Select")){F=true}}if(F===true){return}if(!n.is(x)&&!n.is(x.model)){return}var y=null;var O=A._lastNode;if(n.is(A._lastNode._options.id)){y=A._lastNode._options.id}if(y===null&&A._currentSelectNode!==null&&n.is(A._currentSelectNode._options.id)){y=A._currentSelectNode._options.id;O=A._currentSelectNode}if(!n.is(O)){return}if(!n.is(y)){return}if(y!==x.model.id){return}var B=A.getTreeDocument();if(!n.is(B)){return}if(!n.is(x,"object")){return}var I=function(S){var T=[];var W=O.getChildren();if(W){var U=W.length;var V=null;for(var R=0;R<U;R++){V=W[R];if(V&&n.is(V._options)&&n.is(V._options.relation)){T.push(V._options.relation)}}}return T};var H=function(S){if(!n.is(S)){return}var R=S.getParent();if(R){R.removeChild(S);A._lastNode=R}};var C=I();if(n.is(C)){if(C.length===2){return}else{if(C.length===1){if(C[0]===""){return}}}}var w=function(S,T){var R=q.get("relation.result");if(S.info.length>1){R=q.get("relation.results")}switch(S.id){case"parents":T.parentslabel=q.get("relation.parents.label");T.parentsresults=S.info.length+R;T.parentsdescription=q.get("relation.parents.description");T.onClickparents=function(U){if(!n.is(U)){return}H(U);U.options.relation="parents";U.options.ids=U.options.relations[U.options.relation];A.onSelected(A.addRelationModel(U))};break;case"children":T.childrenlabel=q.get("relation.children.label");T.childrenresults=S.info.length+R;T.childrendescription=q.get("relation.children.description");T.onClickchildren=function(U){if(!n.is(U)){return}H(U);U.options.relation="children";U.options.ids=U.options.relations[U.options.relation];A.onSelected(A.addRelationModel(U))};break;case"simulations":T.label=q.get("relation.simulations.label");T.icons=[g.getWebappsAssetUrl("SNResultUX","images/Box_Simulations.png")];T.description=q.get("relation.simulations.description");break;case"configurations":T.label=q.get("relation.configurations.label");T.icons=[g.getWebappsAssetUrl("SNResultUX","images/Box_Configurations.png")];T.description=q.get("relation.configurations.description");break}};var G=null;var Q=null;var L={type:"type2",SNtype:"",ids:null,relation:"",relations:x,useAsyncPreExpand:false,contextid:x.contextid,widgetAppId:x.widgetAppId,description:q.get("relation.norelated")};L.label=x.model.get("ds6w:type");L.icons=[x.model.get("preview_url")];var u=false;for(var v in x){if(C.indexOf(v)===-1){var t=x[v];if(UWA.is(t,"array")&&t.length>0){var r=t.length;if(v==="drawings"){Q={SNtype:"Children",ids:t,type:"type2",relation:"drawings",useAsyncPreExpand:false,contextid:x.contextid,widgetAppId:x.widgetAppId,label:q.get("relation.drawings.label"),icons:[g.getWebappsAssetUrl("SNResultUX","images/Box_Drawings.png")],description:r+(r>1?q.get("relation.results"):q.get("relation.result"))};u=true}else{u=true;L.type="type3";L.SNtype="Children";w.call(undefined,{id:v,info:t},L)}}}}if(u===false&&C.length>0){return A._lastNode}B.prepareUpdate();G=new h(L);O.addChild(G);if(G!==null){A._lastNode=G}if(Q!==null){G=new h(Q);O.addChild(G);A._lastNode=G}B.pushUpdate();A._currentSelectNode=null;if(A._graph){A._graph.expandAll()}}}return G},addRelationModel:function(u){var x=this;var v=false;if(!n.is(u)||!n.is(u.options)||!n.is(u.options.relations)){return}var t=x.getTreeDocument();if(!n.is(t)){return}t.prepareUpdate();var A=function(E,F){var D=q.get("relation.result");if(E.info.length>1){D=q.get("relation.results")}switch(E.id){case"parents":F.label=q.get("relation.parents.label");F.icons=[g.getWebappsAssetUrl("SNResultUX","images/Box_Parents.png")];F.description=E.info.length+D;break;case"children":F.label=q.get("relation.children.label");F.icons=[g.getWebappsAssetUrl("SNResultUX","images/Box_Children.png")];F.description=E.info.length+D;break;case"drawings":F.label=q.get("relation.drawings.label");F.icons=[g.getWebappsAssetUrl("SNResultUX","images/Box_Drawings.png")];F.description=E.info.length+D;break;case"simulations":F.label=q.get("relation.simulations.label");F.icons=[g.getWebappsAssetUrl("SNResultUX","images/Box_Simulations.png")];F.description=E.info.length+D;break;case"configurations":F.label=q.get("relation.configurations.label");F.icons=[g.getWebappsAssetUrl("SNResultUX","images/Box_Configurations.png")];F.description=E.info.length+D;break}};var r=x._lastNode;var w=null;var B=u.options.relations;var z=u.options.relation;var C=B[z];if(UWA.is(C,"array")&&C.length>0){var y={SNtype:"Children",ids:C,type:"type2",relation:z,useAsyncPreExpand:false,contextid:B.contextid,widgetAppId:B.widgetAppId};A.call(undefined,{id:z,info:C},y);w=new h(y);r.addChild(w)}if(w!==null){x._lastNode=w}t.pushUpdate();x._currentSelectNode=null;if(x._graph){x._graph.expandAll()}return w},addExploreModel:function(t){var v=this;var r=v._treeDocument;v.HideContainers();if(!n.is(r)){r=v.getTreeDocument()}t.SNtype="Explore";t.type="type1";t.label=q.get("tree.box");t.icons=[g.getWebappsAssetUrl("SNResultUX","images/I_TreeListView.png")];t.useAsyncPreExpand=false;t.description=t.description;var u=new h(t);if(n.is(v._lastNode)){v._removeChildrenNode();r.prepareUpdate();v._lastNode.addChild(u);r.pushUpdate();v._lastNode=u;if(v._listOfTreeGraph===null){v._listOfTreeGraph=[]}v._listOfTreeGraph.push(u);v._ifHaveExploreOrRelatedNode=true;v._currentSelectNode=null;if(v._graph){v._graph.expandAll()}}return u},addRelationalModel:function(t){var v=this;var r=v._treeDocument;if(!n.is(r)){r=v.getTreeDocument()}v.HideContainers();t.SNtype="Relational";t.type="type1";t.label=q.get("graph.box");t.icons=[g.getWebappsAssetUrl("SNResultUX","images/I_GraphView.png")];t.useAsyncPreExpand=false;t.description=t.description;var u=new h(t);if(n.is(v._lastNode)){r.prepareUpdate();v._removeChildrenNode();v._lastNode.addChild(u);r.pushUpdate();v._lastNode=u;if(v._listOfTreeGraph===null){v._listOfTreeGraph=[]}v._listOfTreeGraph.push(u);v._ifHaveExploreOrRelatedNode=true;v._currentSelectNode=null;if(v._graph){v._graph.expandAll()}}return u},onSelected:function(v){if(!n.is(v)){return}var u=this;var t=v.options;if(n.is(t)){u._currentSelectNode=v;var r=v;while(r&&r._options&&!(r._options.SNtype==="Search")){r=r.getParent();if(r._options.SNtype==="Explore"||r._options.SNtype==="Relational"){u._ifHaveExploreOrRelatedNode=true}}if(r){u._searchNode=r}r=v;while(r&&r.getChildren()){r=r.getChildren()[0];if(r._options.SNtype==="Explore"||r._options.SNtype==="Relational"){u._ifHaveExploreOrRelatedNode=true}}if(r){u._lastNode=r}u.dispatchEvent("onSelected",t)}},HideContainers:function(){var r=this;if(!n.is(r._listOfTreeGraph)){return}r._listOfTreeGraph.forEach(function(t){if(n.is(t._options)&&n.is(t._options.containers)){t._options.containers.forEach(function(u){u.setStyle("display","none")})}})},ShowContainers:function(r){var t=this;if(!n.is(r)){return}t.HideContainers();if(n.is(r.containers)){r.containers.forEach(function(u){u.setStyle("display","block")})}},stopCreation:function(r){var t=this;t._stopCreated=r},ifcanCreated:function(){var r=this;return(!r._stopCreated)},_removeChildrenNode:function(){var t=this;if(n.is(t._lastNode)){if(t._lastNode._options.SNtype==="Children"||t._lastNode._options.SNtype===""){if(t._lastSelectNode){var r=t._lastSelectNode;while(r&&r.getChildren()){r=r.getChildren()[0];if(r._options.SNtype==="Children"&&n.is(r._isSelected)){r=null}}if(r){t._lastSelectNode.removeChildren();t._lastNode=t._lastSelectNode}}}}},_searchNodebyIdInSameBranch:function(u){if(!n.is(u)){return}var v=this;if(!n.is(v._lastNode)){return}var t=u;var r=v._lastNode;while(r){if(t&&n.is(r._options.id)&&r._options.id.indexOf(t)!==-1){return r}else{r=r.getParent()}}},_removeAllNodeWithWidget:function(u){var x=this;var r=u.getChildren();if(r){var t=r.length;var z=null;for(var v=0;v<t;v++){z=r[v];if(z&&n.is(z._options)){x._removeAllNodeWithWidget(z);if(n.is(z._options.widgets,"array")){var A=z._options.widgets.length;for(var v=A-1;v>=0;v--){var w=z._options.widgets[v];if(n.is(w)){w.destroy()}}}if(n.is(z._options.containers,"array")){var A=z._options.containers.length;for(var v=A-1;v>=0;v--){var y=z._options.containers[v];if(n.is(y)){y.remove()}}}u.removeChild(z)}}}},cleanAll:function(){var w=this;var r=w._treeDocument;if(r){var t=r.getRoots();if(t){var v=t[0];if(n.is(v)){var u={SNtype:"Search",contextid:v.options.contextid,widgetAppId:v.options.widgetAppId};j.setContentVisibility(u);w._removeAllNodeWithWidget(v)}}r.removeRoots();r.empty()}w._lastNode=null;w._searchNode=null;w._currentSelectNode=null;w._lastSelectNode=null;w._lastSelectNode=null;w._listOfTreeGraph=[]},navhistorycontextifcreateaNewTab:function(){var r=this;var t=false;if(n.is(r._listOfTreeGraph)&&r._listOfTreeGraph.length>0){t=true}return(t)}});return p});define("DS/SNResultUX/utils/SearchDoubleClickHandler",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","UWA/Promise","UWA/Class/Collection","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/ServiceDelegationLoader"],function(g,h,e,b,f,j,a,d,c){var i=h.singleton(e,{handle:function(x){if(UWA.is(x.skeleton)&&UWA.is(x.id)){var n=x.skeleton;this.log("double click event received for "+x.id);var y=n.getOption("in_apps_search");if(y&&y.UXOptions&&y.UXOptions.dblClk===false){return}var q=n.getCollection();if(UWA.is(q)){var r=this;var p=q.get(x.id);if(UWA.is(p)){var l=function(){r.onDoubleClick({appID:d.SEARCH_APP_ID,model:p,onComplete:function(z){if(UWA.is(z)&&UWA.is(z.id,"string")&&UWA.is(z.sourceJS,"string")){if(z.sourceJS.length>0){require([z.sourceJS],function(A){A.executeAction({action_id:z.id,actionsHelper:n._getActionsHelper(),object_ids:[x.id],widget_id:n.getOption("widgetId")})})}}else{r._logNoActionOrError({type:"bad JS impl",error:"BAD action information to handle double click"})}},onFailure:function(z){r._logNoActionOrError(z)}})};var m=UWA.is(n.getOption("in_apps_search"));if(m===true){if(g.is(x.force)&&x.force===true){m=false}}var v=b.getOption("search_web_in_win");var k=("SavedSearch"===p.get("ds6w:type_value"))&&("3DSpace"===p.getServiceID());var t=false;var u=p.getSourceID();if(v===true&&g.is(u)&&(u==="swym"||u==="dashboard"||u==="drive")){t=true}if(k){l()}else{if(t){l()}else{if(v){var o={objectId:p.get("id")};n._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onDoubleClick",notif_parameters:JSON.stringify(o),},"search_web_in_win")}else{if(m){if(g.is(y.multiSel)&&y.multiSel==false){var w=n.getOption("observable");if(w){w.dispatchInContextSelection(y.app_socket_id)}}else{r._logNoActionOrError({message:"no action on double click during in-context mode as the multi-selection is possible"})}}else{l()}}}}}}}},onDoubleClick:function(l){var m=this;if(UWA.is(l)){var k=l.model;if(UWA.is(k)){if((k.getServiceID,"function")&&(k.getPlatformID,"function")){var n=k.getServiceID(),o=k.getPlatformID();a.getServiceUrl({serviceName:n,platformId:o,onComplete:function(p){c.load({serviceID:n,platformID:o,serviceURL:p}).then(function(r){if(UWA.is(r.getDoubleClickAction,"function")){var q={model:k,appID:l.appID,onComplete:function(t){if(UWA.is(l.onComplete,"function")){l.onComplete.call(undefined,t)}},onFailure:function(t){if(UWA.is(l.onFailure,"function")){l.onFailure.call(undefined,{type:"double_click_action_delegation_failure",error:t})}}};r.getDoubleClickAction.call(undefined,q)}},function(q){if(UWA.is(l.onFailure,"function")){l.onFailure.call(undefined,{type:"require_failure",error:q})}})}})}}}},_logNoActionOrError:function(k){if(UWA.is(k.error)){console.log(k.type);console.log(k.error)}else{that.log(k.message)}}});return i});define("DS/SNResultUX/views/Play3DServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Promise","DS/SNInfraUX/SearchUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/ServiceDelegationLoader"],function(h,i,f,b,g,d,a,c){var e=i.singleton(b,f,{is3DPlayAvailable:function(j){return new g(function(p,o){if(!h.is(j)||!h.is(j.get,"function")){if(h.is(o,"function")){o()}}var n=j.getServiceID();var k=j.get("ds6w:type_value");if(!h.is(k)){if(h.is(o,"function")){o()}}var l=j.get("play3d");if(h.is(l)){if(h.is(p,"function")&&(h.is(o,"function"))){l?p():o()}}else{var q=j.getPlatformID();var m=function(r){require(["DS/3DPlay/ExperiencesList"],function(t){if(h.is(t.dtypes[k])){j.set("play3d",true);if(h.is(p,"function")){p()}}else{var u={provider:"EV6",tenant:q,serverurl:r.serviceURL,physicalid:j.id,dtype:j.get("ds6w:type_value"),requiredAuth:"passport",requestsOptions:{authentication:"passport"}};t.getExperienceFromPLMType(u,function(v){if(h.is(v)){j.set("play3d",true);if(h.is(p,"function")){p()}}else{j.set("play3d",false);if(h.is(o,"function")){o()}}})}})};a.getServiceUrl({serviceName:n,platformId:q,onComplete:function(r){if(UWA.is(r,"string")){c.load({serviceID:n,platformID:q,serviceURL:r}).then(function(t){if(UWA.is(t.is3DPlayAvailable,"function")){t.is3DPlayAvailable.call(undefined,{model:j,serviceURL:r,onComplete:function(u){if(UWA.is(u,"object")&&u.availability===true){j.set("play3d",true);p()}else{j.set("play3d",false);o()}}})}else{m({serviceURL:r})}},function(){m({serviceURL:r})})}}})}})},get3DPlayOptions:function(j,p){if(UWA.is(j)&&UWA.is(p,"function")){var l=j.getServiceID();var n=j.getPlatformID();if(UWA.is(l,"string")&&UWA.is(n,"string")){var o={input:{asset:{},usage:"preview"},options:{loading:"autoplay",tenant:n},lang:d.getLanguage()};var k=function(q){playOptions.input.asset.serverurl=q;playOptions.input.asset.provider="EV6",playOptions.input.asset.physicalid=j.id,playOptions.input.asset.dtype=j.get("ds6w:type_value"),playOptions.input.asset.requiredAuth="passport",playOptions.input.asset.requestsOptions={authentication:"passport"},playOptions.input.asset.filename=null,playOptions.input.asset.format=null};var m=function(q){k();if(l==="geoservice"){o.input.asset.provider="GEOVIA";p.call(undefined,o)}};a.getServiceUrl({serviceName:l,platformId:n,onComplete:function(q){if(UWA.is(q,"string")){c.load({serviceID:l,platformID:n,serviceURL:q}).then(function(r){if(UWA.is(r.get3DPlayOptions,"function")){r.get3DPlayOptions.call(undefined,{defaultPlayOptions:o,model:j,serviceURL:q,onComplete:function(t){p.call(undefined,t)},onFailure:function(t){console.log("get3DPlayOptions FAILED for "+l);p.call(undefined,o)}})}else{if(UWA.is(r.get3DPlayProvider,"function")){k(o,q);o.input.asset.provider=r.get3DPlayProvider.call(undefined);p.call(undefined,o)}else{k(q);p.call(undefined,o)}}},function(){k(q);p.call(undefined,o)})}}})}}}});return e});define("DS/SNResultUX/views/SearchGridScrollView",["UWA/Core","UWA/Class/Options","UWA/Class/Listener","DS/SNInfraUX/SearchCom","DS/SNResultUX/utils/SearchServices","DS/W3DXComponents/Views/Layout/GridScrollView","DS/WebappsUtils/Performance"],function(d,b,g,c,h,i,a){var e="search-grid_view";var f=i.extend(b,g,{name:e,_searchcom_socket:null,init:function(j){var k=this;this._parent.call(this,j);if(!d.is(this._searchcom_socket)){this._searchcom_socket=c.createSocket({socket_id:"search_skeleton_"+a.now()})}this._searchcom_socket.addListener("onSelectShift",k.onSelectShiftCallback.bind(k))},onSelectShiftCallback:function(n,j,q){console.log("DS/SNResultUX/views/SearchGridScrollView onSelectShiftCallback");var l=-1;var o=-1;var k=this.collection.find(function(r){return r.get("id")===n[0].id});l=this.collection.indexOf(k);var p=this.collection.find(function(r){return r.get("id")===n[1].id});o=this.collection.indexOf(p);var m=null;if(o<l){m=o;o=l;l=m}if((l===-1)||(o==-1)||h.isEqualPreviousSlice(l,o)){return}h.setPreviousSlice(l,o);this.dispatchEvent("onItemViewCheck",[null,this.collection.slice(l+1,o)]);if(this.collection._snSkeleton){this.collection._snSkeleton._shiftTransaction=false}}});return f});define("DS/SNResultUX/views/3DSpacePreview",["UWA/Core","UWA/Class","UWA/Promise","UWA/Class/Debug","DS/WAFData/WAFData","DS/SNInfraUX/SearchPreviewContainer","DS/SNResultUX/views/Play3DServices","DS/SNInfraUX/SearchUtils"],function(g,h,e,d,f,a,c,b){var i=a.extend({_OpenWith:null,init:function(j){this._OpenWith=null;this._parent(j)},getPrimaryContent:function(j){if(!g.is(j)||!g.is(j.searchmodel)){return}if(g.is(j.onFailure,"function")){c.is3DPlayAvailable(j.searchmodel).then(function(){j.onFailure.call()},function(){if(g.is(j.onCusto,"function")){var l={nopreview:"visible"};j.onCusto.call(null,l)}})}if(g.is(j.onCusto,"function")){var k={layout:"horizontal"};j.onCusto.call(null,k)}},});return i});define("DS/SNResultUX/views/LightBoxView",["UWA/Class/Debug","UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Spinner","DS/Utilities/Utils","DS/Tree/LightBoxView","DS/Controls/TooltipModel","DS/SNResultUX/views/Play3DServices","DS/SNResultUX/views/PropertiesServices","DS/SNInfraUX/SearchSettings","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(f,i,c,b,k,a,j,e,g,d,l){var h=c.extend(f,{_player3D:null,_LightBoxPanel:null,_model:null,_parentContainer:null,_treeDocument:null,_informationPanel:null,_channelView:null,_treeListView:null,_collection:null,_mySpinner:null,_viewerElement:null,_firstInit:true,_is3DPlay:false,_debounced3DPlayerLoad:null,_bottomdocking:true,_treemodel:null,_okNewModel:true,init:function(o){this._parent(o);var p=this;if(UWA.is(o.parentContainer)){p._parentContainer=o.parentContainer}if(UWA.is(o.model)){p._model=o.model}if(UWA.is(o.treeDocument)){p._treeDocument=o.treeDocument}if(UWA.is(o.treeListView)){p._treeListView=o.treeListView}if(UWA.is(o.collection)){p._collection=o.collection;if(p._treeDocument===null){p._treeDocument=p._collection.getTreeDocument()}}if(UWA.is(o.bottomdocking)){p._bottomdocking=o.bottomdocking}if(UWA.is(o.widget_id)){p._widget_id=o.widget_id}p._debounced3DPlayerLoad=k.debounce(function(r){if(!UWA.is(r)){return}if(r._is3DPlay){r.load3DPlayer(r._model)}},300);var n=p._collection.indexOf(p._model);if(n===-1){n=0}if(n>=0){var q=null;var m=p._treeDocument.getRoots();if(UWA.is(m,"array")){if(n<m.length){q=m[n];if(UWA.is(q)){q.select();e.is3DPlayAvailable(p._model).then(function(){console.warn("Selected object is 3DPlay available")},function(){console.warn("Selected object is NOT 3DPlay available")})}}}}},onDestroy:function(){if(i.is(this._informationPanel)&&i.is(this._informationPanel.destroy,"function")){this._informationPanel.destroy()}if(i.is(this._player3D)&&i.is(this._player3D.dispose,"function")){this._player3D.dispose()}this._player3D=null;this._LightBoxPanel=null;this._model=null;this._treemodel=null;this._informationPanel=null;this._parent()},destroy:function(){this.onDestroy()},_initPlayer:function(){var p=this;if(p._player3D!==null&&p._LightBoxPanel!==null){return}var n=[];n.push({type:"check",icon:{iconName:"info",fontIconFamily:WUXManagedFontIcons.font3DS,fontIconSize:"2x"},tooltipInfos:new j({shortHelp:l.get("actions.InfoPanel.toolTip"),mouseRelativePosition:false}),callback:p.onInfoclick.bind(this)});p._LightBoxPanel=new a({target:p._parentContainer,treeDocument:p._treeDocument,height:"auto",toolbar:n,bigPicturePath:p.CustoonbigPicturePath.bind(this),onRightViewRequest:p.onCustoonRightViewRequest.bind(this),onTitleRequest:p.onCustoTitleRequest.bind(this),onMainViewRequest:p.onCustoMainViewRequest.bind(this)});var q=p._LightBoxPanel.getRightDockingElement();if(i.is(q)){q.collapsibleFlag=false;q.dockingZoneSize=420;q.minSize=250;q.visibleDockingZoneFlag=false}if(p._bottomdocking===false){var o=p._LightBoxPanel.elements.dockingZoneContentForBottom;if(i.is(o)){o.setStyle("display","none")}o=p._LightBoxPanel.getBottomDockingElement();if(i.is(o)){o.visibleDockingZoneFlag=false}}p._treeDocument.getXSO().onAdd(function(r){p.onSelected(r)});p._LightBoxPanel.addEventListener("close",function(r){p.dispatchEvent("onLightBoxPanelClose")});p._channelView=p._LightBoxPanel.getGridView();if(p._channelView!==null){p._channelView.options.selection.canMultiSelect=false;p._channelView.onCellRequest(function(t){var r=t.nodeModel;t.cellView.elements.container.setAttribute("draggable","false");t.cellView.setTitle(r.options._attributes["ds6w:label"]);t.cellView.setSubtitle(r.options._attributes["ds6w:responsible"]);t.cellView.setPicture(r.options._attributes.preview_url);t.cellView.setIcon(r.options._attributes.type_icon_url);if(r.isSelected()){t.cellView.highlight()}});p._channelView.onInfiniteScrollAsync(function(){if(p._collection!==null){if(p._collection._search_in_progress===false){if(p._collection.hasNextPage()){p._collection.getNextPage({remove:false,onComplete:function(){p._channelView.infiniteScrollAsyncProcessDone();p._collection.generateTreeModel();p._toggleLoader()},onFailure:function(r){p._channelView.infiniteScrollAsyncProcessDone()}})}else{p._channelView.infiniteScrollAsyncProcessDone()}}}})}var m=p._LightBoxPanel.getBottomDockingElement();if(m!==null){m.addEventListener("collapse",function(){if(i.is(p._informationPanel)){p._informationPanel.onResize()}});m.addEventListener("expand",function(){if(i.is(p._informationPanel)){p._informationPanel.onResize()}})}},onInfoclick:function(){var o=this;if(o._LightBoxPanel!==null){var p=o._LightBoxPanel.getRightDockingElement();if(p!==null){if(o._informationPanel===null){o.onCustoonRightViewRequest()}var m=p.visibleDockingZoneFlag;p.visibleDockingZoneFlag=!m;if(p.visibleDockingZoneFlag===true){if(i.is(o._informationPanel)){o._informationPanel.onResize()}}var n=o._widget_id;if(i.is(n)&&i.is(UWA.Widgets)&&i.is(UWA.Widgets.instances)){UWA.Widgets.instances.forEach(function(q){if(q.id===n){if(!m===true){q.setValue("previewPanelState_Info",true)}else{q.setValue("previewPanelState_Info",false)}}})}else{if(!m===true){widget.setValue("previewPanelState_Info",true)}else{widget.setValue("previewPanelState_Info",false)}}}}},onCustoMainViewRequest:function(p){var o=this;if(o._okNewModel===false){return}if(p!==null&&p.nodeModel!==null){var n=p.nodeModel;o._model=n.options;o._treemodel=n.options;if(o._model!==null){var q={id:o._model.id};var m=o._model.collection.where(q);if(i.is(m)&&m.length>0){o._model=m[0]}}}if(o._viewerElement===null){o._viewerElement=UWA.createElement("div").inject(p.nodeView);o._viewerElement.setStyle("display","none")}if(o._LightBoxPanel!==null&&o._LightBoxPanel.visibleFlag===false){return}o.onMainViewDisplay(p)},onMainViewDisplay:function(n){var m=this;e.is3DPlayAvailable(m._model).then(function(){m._is3DPlay=true;if(m._viewerElement!==null){m._viewerElement.setStyle("display","inline")}if(m._player3D===null){e.get3DPlayOptions(m._model,function(o){require(["DS/3DPlayHelper/3DPlayHelper"],function(p){o.container=m._viewerElement;m._player3D=new p(o);if(m._firstInit===true){m.setChannelPosition()}m._firstInit=false})})}else{m._debounced3DPlayerLoad.call(m,m)}},function(){m._is3DPlay=false;if(m._viewerElement!==null){m._viewerElement.setStyle("display","none")}var o=n.view.bigPicturePath(n);n.nodeView.setStyles({backgroundImage:"url("+o+")",backgroundSize:"auto",backgroundRepeat:"no-repeat",backgroundPosition:"50% 50%"});if(m._firstInit===true){m.setChannelPosition()}m._firstInit=false})},load3DPlayer:function(m){if(!i.is(m)){return}var n=this;e.get3DPlayOptions(m,function(o){n._player3D.load(o)})},onCustoTitleRequest:function(o){var n=this;var m=o.nodeModel;o.nodeView.setContent(m.options._attributes["ds6w:label"])},onSelected:function(p){var n=this;n._okNewModel=true;if(n._model&&i.is(p)&&i.is(p.options)&&(n._model.id===p.options.id)){n._okNewModel=false;return}n._model=p.options;n._treemodel=p.options;if(n._model!==null){var o={id:n._model.id};var m=n._model.collection.where(o);if(i.is(m)&&m.length>0){n._model=m[0];e.is3DPlayAvailable(n._model).then(function(){console.warn("Selected object is 3DPlay available")},function(){console.warn("Selected object is NOT 3DPlay available")})}}},activate_deactivate:function(o){var q=this;if(q._LightBoxPanel===null){return}var p=q._LightBoxPanel.visibleFlag;if(p===true){q._LightBoxPanel.visibleFlag=false}else{var n=q._collection.indexOf(q._model);if(n>=0){var m=q._treeDocument.getRoots();if(UWA.is(m,"array")){if(n<m.length){var r=m[n];if(UWA.is(r)){r.unselect()}}}}q._model=null;q._treemodel=null;if(i.is(o)&&o!==null){q._model=o}var n=q._collection.indexOf(q._model);if(n===-1){n=0}if(n>=0){var r=null;var m=q._treeDocument.getRoots();if(UWA.is(m,"array")){if(n<m.length){r=m[n];q._treemodel=r;if(UWA.is(r)){r.select()}}}q.onMainViewDisplay({nodeModel:r,nodeView:q._LightBoxPanel.elements.mainViewContent,view:q._LightBoxPanel});q._LightBoxPanel.visibleFlag=true;q.setChannelPosition(r)}}},setChannelPosition:function(q){var r=this;var t=q;if(!i.is(t)){var p=r._collection.indexOf(r._model);if(p===-1){p=0}if(p>=0){var t=null;var o=r._treeDocument.getRoots();if(UWA.is(o,"array")){if(p<o.length){t=o[p]}}}}if(!i.is(r._channelView)){return}var n=r._channelView.getScroller();if(i.is(n)){var m=r._channelView.options.defaultCellWidth*r._channelView.options.model.indexOf(t);n.getContent().scrollLeft=m}},CustoonbigPicturePath:function(o){var n=this;var m=o.nodeModel;if(!i.is(m)){return(model._attributes.preview_url)}return m.options._attributes.preview_url},onCustoonRightViewRequest:function(n){if(d.getOption("propertyTabsAsAccordeon")===true){return}var m=this;if(i.is(m._informationPanel)){m._informationPanel.destroy();m._informationPanel=null}if(UWA.is(m._model)){require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/constants/ConstantsMapping"],function(t,r,q,o,p){g.getOptions({model:m._model,EditPropConstants:q,onComplete:function(v){m._informationPanel=new t(v);if(i.is(n)&&i.is(n.nodeView)&&i.is(n.nodeView.setContent)){n.nodeView.setContent(m._informationPanel)}var u=g.getPropModelFromSearchItem(m._model,r,o,p,function(w){m._informationPanel.initDatas(w)})},onAddFacets:function(u){if(UWA.is(m._informationPanel)){m._informationPanel.addFacets(u)}}})})}},_toggleLoader:function(){var n=this;var m=n._channelView.getContent();if(UWA.is(n._mySpinner)){n._mySpinner.toggle()}else{var o=UWA.createElement("div",{"class":"datagrid-loader"});o.setStyle("text-align","center");o.setStyle("position","relative");o.setStyle("top","-12px");o.inject(m);n._mySpinner=new b().inject(o).show()}},changeModel:function(m){var n=this;if(!UWA.is(m)||!n._LightBoxPanel){return}n._treeDocument=m;n._LightBoxPanel.setProperties({treeDocument:n._treeDocument});n._treeDocument.getXSO().onAdd(function(o){n.onSelected(o)})}});return h});define("DS/SNResultUX/views/InformationsPanelView",["UWA/Class/Debug","UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Alert","DS/Controls/Button","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNResultUX/views/PropertiesServices","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchDoubleClickHandler","DS/i3DXCompassServices/i3DXCompassPubSub","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/ServiceDelegationLoader","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(j,l,b,e,h,d,g,k,n,a,m,i,f,o){var c=b.extend(j,{_informationPanel:null,_informationPanelAcc:null,_rightDockingElement:null,_rootView:null,_lastSelectedItem:null,_width:420,_widgetId:null,_primary:null,_secondary:null,_infoHeaderContainer:null,_infoUserContainer:null,_skeleton:null,_lightBoxView:null,_lastwidth:420,_max:false,_lastpreview:null,_intervalTimer:1,_buttonOpen:null,_footerdiv:null,_informationViewdiv:null,_bNewUI:false,_bIsOnIphone:false,_infoContainer:null,_expandcollapseElement:null,_resizeCallback:null,_previouselement:null,_nextelement:null,_useAccordeon:false,_menuAction:null,_listOfDSEditPropWidget:[],_screenType:"desktop",_oneSearchPreviewAction:null,_informationNopreview:null,_informationPreviewContainer:null,_dockingZoneSize:0,init:function(p){this._parent(p);var r=this;r._lightBoxView=null;r._lastpreview=null;r._infoContainer=null;r._listOfDSEditPropWidget=[];r._informationNopreview=null;r._informationPreviewContainer=null;r._rootView=p.parentContainer;r._lastSelectedItem=p.lastSelectedItem;r._skeleton=p.parent;r._bNewUI=p.bNewUI;r._dockingZoneSize=0;if(r._bNewUI===true){r._useAccordeon=d.getOption("propertyTabsAsAccordeon");if(l.is(p.width)){var t=screen.availWidth;r._width=p.width*2/3;var q=g.getDeviceCategory();if(q==="iphone"||q==="android"){r._screenType="mobile";r._width=p.width;r._bIsOnIphone=true;r._oneSearchPreviewAction=p.oneSearchPreviewAction}else{if(d.getOption("search_compact_mode")===true&&q.length===0&&t<1279){r._screenType="mobile";r._width=p.width;r._bIsOnIphone=true;r._oneSearchPreviewAction=p.oneSearchPreviewAction}else{if(p.width<639){r._width=p.width;r._bIsOnIphone=true}}}if(q==="ipad"||q==="android"){if(l.is(t)){if(t>1023){r._screenType="desktop"}else{r._screenType="mobile";r._width=p.width;r._bIsOnIphone=true;r._oneSearchPreviewAction=p.oneSearchPreviewAction}}}}if(l.is(p.widgetId)){r._widgetId=p.widgetId}}else{if(l.is(p.width)){r._width=p.width}}},destroy:function(){var r=this;r.savePreferences();window.removeEventListener("resize",r._resizeCallback);r._rightDockingElement.removeEventListener("dockResize",r.resizeCallback);if(l.is(this._informationPanel)&&l.is(this._informationPanel.destroy,"function")){this._informationPanel.destroy()}if(l.is(this._listOfDSEditPropWidget)){var q=this._listOfDSEditPropWidget.length-1;for(var p=q;p>=0;p--){var t=this._listOfDSEditPropWidget[p];if(l.is(t)){t.destroyComponent();this._listOfDSEditPropWidget[p]=0}}}r._listOfDSEditPropWidget=[];if(l.is(this._informationPanelAcc)&&l.is(this._informationPanelAcc.destroy,"function")){this._informationPanelAcc.destroy()}if(l.is(this._lightBoxView)&&l.is(this._lightBoxView.destroy,"function")){this._lightBoxView.destroy()}if(l.is(this._lastpreview)&&l.is(this._lastpreview.dispose,"function")){this._lastpreview.dispose()}if(l.is(this._rightDockingElement)&&l.is(this._rightDockingElement.destroy,"function")){this._rightDockingElement.destroy()}this._rightDockingElement=null;this._informationPanel=null;this._informationPanelAcc=null;this._lastpreview=null;r._skeleton=null;r._lastSelectedItem=null;r._rootView=null;r._infoContainer=null;r._informationPreviewContainer=null;this._parent()},_initInformationsPanel:function(){var p=this;if(p._rootView===null){return}if(p._rightDockingElement!==null&&(p._useAccordeon?p._informationPanelAcc!==null:p._informationPanel!==null)){return}if(p._useAccordeon?p._informationPanelAcc===null:p._informationPanel===null){require(["DS/Windows/DockingElement"],function(z){var w;var r=340;var t=p._width;var q=true;if(p._bNewUI===true){q=true;if(p._screenType==="mobile"){q=false}var y=p.managePreferences();if(l.is(y)){w=y.maxSize;r=y.minSize;t=y.ZoneSize}else{w=p._width-340;if(p._width<639&&p._screenType!=="mobile"){w=p._width;r=w;t=w-24}if(d.getOption("search_web_in_win")===true){p._dockingZoneSize=t}}}else{r=320;w=undefined;if(t<520){t=p._width*2/3;r=p._width*1/3}else{p._width=420;t=p._width}}p._rightDockingElement=new z({side:WUXDockAreaEnum.RightDockArea,dockingZoneSize:t,minSize:r,maxSize:w,useBordersFlag:q});var v=null;if(i.getItem("nav_history")){var v=p._rootView.getParent();p._rightDockingElement.collapsibleFlag=false;p._rightDockingElement.freeZoneContent=p._rootView;p._rightDockingElement.inject(v)}else{var u=p._rootView.container;var x=p._rootView.getElement(".search-content-set-contents");var v=p._rootView.container.getParent();if(l.is(d.getOption("search_compact_mode"))&&l.is(p._skeleton)){v=x;u=p._skeleton.getCurrentView().container}if(null==x||undefined==x){x.setStyle("width","calc(100% - 8px)");x.addClassName("informationPanel_opened")}p._rightDockingElement.collapsibleFlag=false;p._rightDockingElement.freeZoneContent=u;p._rightDockingElement.inject(v)}if(p._bNewUI===true){p._infoContainer=p.createContainers();p._rightDockingElement.dockingZoneContent=p._infoContainer;if(p._resizeCallback){p._rightDockingElement.removeEventListener("dockResize",p.resizeCallback);window.removeEventListener("resize",p._resizeCallback)}else{p._resizeCallback=function(A){if(l.is(A)&&l.is(A.type)&&A.type==="dockResize"){p._dockingZoneSize=p._rightDockingElement.dockingZoneSize}var B=this;p.updateDimension()}}window.addEventListener("resize",p._resizeCallback);p._rightDockingElement.addEventListener("dockResize",p._resizeCallback)}p._updateInformationsPanel();p.dispatchEvent("onLightBoxPanelCreated")})}},_updateInformationsPanel:function(){var u=this;if(u._informationPanel){u._informationPanel.destroy();u._informationPanel=null}var z=u._listOfDSEditPropWidget.length-1;for(var r=z;r>=0;r--){var p=u._listOfDSEditPropWidget[r];if(UWA.is(p)){p.destroyComponent()}}u._listOfDSEditPropWidget.length=0;if(u._informationPanelAcc){u._informationPanelAcc.destroy();u._informationPanelAcc=null}var w=function(B,D){var A=function(E){var F=u._informationPanelAcc.getIndexFromId(E);if(F>=0){var G=u._informationPanelAcc.getExpanderFromIndex(F);if(l.is(G)){G.touchMode=true}}};var C=["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/constants/ConstantsMapping","DS/SNResultUX/views/PropertiesServices","DS/Controls/Accordeon"];require(C,function(L,J,H,E,F,K,G){if(u._useAccordeon&&!u._informationPanelAcc){u._informationPanelAcc=new G({exclusive:false,items:[],style:"divided",touchMode:true});u._informationPanelAcc.inject(u._secondary);u._informationPanelAcc.getContent().addEventListener("expand",function(R){if(l.is(R)&&l.is(R.options)&&l.is(R.options.expanderTarget)){var Z=R.options.expanderTarget.elements.bodyContainer;if(l.is(Z)){var O=Z.getAttribute("height");if(l.is(O)){if(O==="250px"){var V=R.options.expanderTarget.elements.bodyContainer.getElements(".scroller-root");var S=0;var Y="250px";if(l.is(V)){var X=V.length-1;for(S=X;S>=0;S--){var N=V[S];if(UWA.is(N)){var M=N.getDimensions();if(l.is(M)&&M.height>100){Y=M.height+10+"px";S=-2;break}}}if(S!==-2){S=-2}}if(S===-2){R.options.expanderTarget.elements.bodyContainer.setAttribute("height",Y);R.options.expanderTarget.elements.bodyContainer.setStyle("height",Y)}}else{if(O==="450px"){var Y="450px";var V=R.options.expanderTarget.elements.bodyContainer.getElements(".relations-accordion");if(l.is(V)){var X=V.length-1;for(S=X;S>=0;S--){var N=V[S];if(UWA.is(N)){var M=N.getDimensions();if(l.is(M)&&M.height>100){Y=M.height+75+"px";S=-2;break}}}if(S!==-2){S=-2}}if(S===-2){R.options.expanderTarget.elements.bodyContainer.setAttribute("height",Y);R.options.expanderTarget.elements.bodyContainer.setStyle("height",Y)}}else{R.options.expanderTarget.elements.bodyContainer.setStyle("height",O)}}}else{if(l.is(R.options.expanderTarget.header)){var U=R.options.expanderTarget.header;var P=u._listOfDSEditPropWidget.filter(function(aa){if(l.is(aa.header)&&aa.header===U){return(aa)}});if(l.is(P)&&P.length===1){var T=P[0];if(l.is(T)){var W=T.height;T.initDatas(T.data);var Q=T.getContent().getContent();if(l.is(Q)){R.options.expanderTarget.body=Q;var O=Q.getParent().getAttribute("height");var Y="250px";if(l.is(W,"string")&&W!=="error"){Y=W}if(!l.is(O)){Q.getParent().setAttribute("name",name);Q.getParent().setAttribute("height",Y);Q.getParent().setStyle("height",Y)}}}}}}}}});u._informationPanelAcc.getContent().addEventListener("collapse",function(N){if(l.is(N)&&l.is(N.options)&&l.is(N.options.expanderTarget)){var M=N.options.expanderTarget.elements.bodyContainer;if(l.is(M)){var O=M.getAttribute("height");if(l.is(O)){N.options.expanderTarget.elements.bodyContainer.setStyle("height","0px")}}}})}var I=function(Q,N){if(!l.is(u._informationPanelAcc)){return}if(l.is(Q,"object")){if(Q.facets,"array"){var P=true;u._listOfDSEditPropWidget.filter(function(T,S,R){if(l.is(T.options)&&l.is(T.options.facets)){var U=T.options.facets[0];if(l.is(U,"object")&&l.is(U.facet)&&l.is(Q.facets[0])&&l.is(Q.facets[0].facet)){if(U.facet.name===Q.facets[0].facet.name){P=false;return}}else{if(l.is(U,"string")){if(U===Q.facets[0]){P=false;return}}}}});if(P===true){var M=function(S,R,T){var U=undefined;if(l.is(N,"array")){if(N.length>R){U=N[R][T]}}if(!l.is(U)){if(l.is(S.facets,"array")&&S.facets.length>0){if(l.is(S.facets[0],"object")&&l.is(S.facets[0].facet,"object")){U=S.facets[0].facet[T]}else{if(l.is(S.facets[0],"string")){U=S.facets[0]}}}}return l.is(U)?U:"error"};var O=function(V){for(var aa=0;aa<Q.facets.length;aa++){var ab=l.clone(Q);ab.facets=[Q.facets[aa]];var R=M(ab,aa,"name");var X=M(ab,aa,"text");var Y=M(ab,aa,"expandedFlag");var ae=M(ab,aa,"height");var U;var W=new L(ab);if(Y===true){W.initDatas(V);U=W.getContent().getContent()}else{W.data=V;W.header=X;W.height=ae}var S={header:X,icon:{iconName:M(ab,aa,"icon"),fontIconFamily:1},content:U,expandedFlag:l.is(Y,"boolean")?Y:false};var ac=u._informationPanelAcc.addItem(S);u._listOfDSEditPropWidget.push(W);A(ac);if(l.is(U)&&l.is(U.getParent())){if(R==="properties"){var Z={webux:u._informationPanelAcc._expanderItems[0],tabContent:U};if(l.is(W.elements)&&l.is(W.elements.UI)){if(l.is(W.elements.container)&&l.is(W.elements.container.elements)&&l.is(W.elements.container.elements.container)){var ad=W.elements.container.elements.container.querySelector(".formSections.large");if(l.is(ad)){ad.addEvent("resize",function(){var am=this;var ag=am.tabContent;var al=am.webux;var ak=ag.getParent().getAttribute("height");if(l.is(ak)){var ai=ag.querySelector(".small");if(!l.is(ai)){ai=ag.querySelector(".medium")}if(l.is(ai)){var aj=ai.getDimensions();if(l.is(aj)&&aj.height>28){var ah=aj.height+32+"px";if(l.is(ak)&&ak!==ah&&l.is(al)&&l.is(al.expandedFlag)&&al.expandedFlag===true){ag.getParent().setAttribute("height",ah);ag.getParent().setStyle("height",ah)}}}}}.bind(Z))}}W.elements.UI.subscribeEvt(R+".switchDisplay",function(ai){var ak=this;var ao=ak.tabContent;var am=ak.webux;var an;var al=false;var aj=ao.getParent().getAttribute("height");var ah=ao.querySelector(".small");if(!l.is(ah)){ah=ao.querySelector(".medium")}if(l.is(ah)){var ag=ah.getDimensions();if(l.is(ag)&&ag.height>28){an=ag.height+32+"px"}else{an="250px"}}else{an="250px"}if(!l.is(aj)){al=true}else{if(l.is(aj)&&aj!==an){al=true}}if(al===true&&l.is(am)&&l.is(am.expandedFlag)&&am.expandedFlag===true){ao.getParent().setAttribute("name","properties");ao.getParent().setAttribute("height",an);ao.getParent().setStyle("height",an)}}.bind(Z))}}else{var T=U.getParent().getAttribute("height");var af="250px";if(l.is(ae,"string")&&ae!=="error"){af=ae}if(!l.is(T)){U.getParent().setAttribute("name",R);U.getParent().setAttribute("height",af);U.getParent().setStyle("height",af)}}}}}}K.getPropModelFromSearchItem(u._lastSelectedItem,J,E,F,O,D)}}};K.getOptions({model:u._lastSelectedItem,EditPropConstants:H,onComplete:function(O,P){if(!u._useAccordeon){u._informationPanel=new L(O);var M=function(Q){u._informationPanel.initDatas(Q);if(l.is(B)){B.empty();u._informationPanel.getContent().getContent().inject(B)}else{u._rightDockingElement.dockingZoneContent=u._informationPanel.getContent().getContent()}};var N=K.getPropModelFromSearchItem(u._lastSelectedItem,J,E,F,M,D)}else{I(O,P)}},onAddFacets:function(N,M){if(u._useAccordeon){I(N,M)}else{if(l.is(u._informationPanel)){u._informationPanel.addFacets(N)}}}})})};var t=function(){var A=["DS/SNResultUX/views/LightBoxView"];require(A,function(F){if(u._lightBoxView===null){var D={parentContainer:u._primary,model:u._lastSelectedItem,widget_id:u._skeleton.getOption("widgetId"),collection:u._skeleton.getCollection(),bottomdocking:false,};u._lightBoxView=new F(D);u._lightBoxView._initPlayer();if(l.is(u._infoUserContainer)){var E=u._infoUserContainer.querySelector(".user-subtitle");var B=l.extendElement(E);B.empty();if(l.is(u._getTreeModel())){B.setHTML(u._getTreeModel()._options.subLabel)}}}else{if(u._lightBoxView._LightBoxPanel!==null){var C=u._lightBoxView._LightBoxPanel.elements.wrapper;if(l.is(C)){if(C.getParent()===null){C.inject(u._primary)}}}}})};var q=function(){u._primary.removeClassName("information-primary-max");u._primary.removeClassName("information-primary-vertical")};var v=function(){u._secondary.removeClassName("information-secondary-max");u._secondary.removeClassName("information-secondary-vertical")};if(l.is(this._lastpreview)){u._lastpreview.dispose()}if(u._primary!==null){var y;if(l.is(u._informationViewdiv)){y=l.extendElement(u._informationViewdiv);if(l.is(y)){y.removeClassName("information-view-vertical");y.removeClassName("information-view-vertical-nopreview")}}if(l.is(u._primary)){q()}if(l.is(u._secondary)){v()}if(u._lastSelectedItem!==null){var x=u._lastSelectedItem.getServiceID();if(l.is(x)){f.load({serviceID:x,platformID:u._lastSelectedItem.getPlatformID()}).then(function(B){u._primary.empty();u._secondary.empty();u._secondary.setStyle("display","inline-block");u._primary.setStyle("display","inline-block");u._infoUserContainer.style.display="flex";if(l.is(B.getRenderPreview,"function")){B.getRenderPreview({searchmodel:u._lastSelectedItem,widget_id:u._skeleton.getOption("widgetId"),onComplete:function(E){u._lastpreview=E;if(l.is(E)){u._updateInformationsPanelContents();var D=false;var C=false;if(l.is(E.getPrimaryContent,"function")&&l.is(u._primary)){u._infoUserContainer.style.display="flex";u._primary.removeClassName("information-primary-max");u._secondary.removeClassName("information-secondary-max");E.getPrimaryContent({searchmodel:u._lastSelectedItem,parentContainer:u._primary,widget_id:u._skeleton.getOption("widgetId"),onComplete:function(F){if(l.is(F)){if(u._bIsOnIphone===true){u._infoContainer.setStyle("height","100%")}D=true;if(C===false){u._primary.addClassName("information-primary-max");u._secondary.setStyle("display","none")}u._primary.empty();F.inject(u._primary)}},onFailure:function(){var F={widgetId:u._skeleton.getOption("widgetId")};if(n.getpreviewPanel(F)===true){if(C===false){u._primary.addClassName("information-primary-max");u._secondary.setStyle("display","none")}else{u._secondary.removeClassName("information-secondary-max");u._primary.setStyle("display","inline-block")}if(u._width<=400){u._secondary.setStyle("height","50%")}D=true;t()}else{u._primary.setStyle("display","none");u._secondary.addClassName("information-secondary-max")}},onCusto:function(F){if(l.is(F)){if(l.is(F.informationUser)&&F.informationUser==="hide"){u._infoUserContainer.style.display="none";if(u._footerdiv.style.display==="none"){u._informationViewdiv.style.height="calc(100% - 144px)"}else{u._informationViewdiv.style.height="calc(100% - 96px)"}}if(l.is(F.layout)&&F.layout==="vertical"){if(l.is(u._rightDockingElement)){if(l.is(u._rightDockingElement.dockingZoneContent)){var G=u._rightDockingElement.dockingZoneSize;if(G>=850){if(l.is(y)){y.addClassName("information-view-vertical")}if(l.is(u._primary)){u._primary.addClassName("information-primary-vertical")}if(l.is(u._secondary)){u._secondary.addClassName("information-secondary-vertical")}}}}}if(l.is(F.nopreview)&&F.nopreview==="visible"){if(l.is(y)){y.addClassName("information-view-vertical-nopreview")}q();v()}}}})}if(l.is(E.getSecondaryContent,"function")&&l.is(u._secondary)){u._secondary.removeClassName("information-secondary-max");E.getSecondaryContent({searchmodel:u._lastSelectedItem,parentContainer:u._secondary,widget_id:u._skeleton.getOption("widgetId"),onComplete:function(F){if(l.is(F)){if(u._bIsOnIphone===true){u._infoContainer.setStyle("height","100%")}if(D===false){u._secondary.addClassName("information-secondary-max");u._primary.setStyle("display","none")}else{u._secondary.setStyle("display","inline-block");u._primary.removeClassName("information-primary-max")}u._secondary.empty();F.inject(u._secondary)}},onFailure:function(F){if(u._bIsOnIphone===true){u._infoContainer.setStyle("height","100%")}if(D===false){u._secondary.addClassName("information-secondary-max");u._primary.setStyle("display","none")}else{u._secondary.setStyle("display","inline-block");u._primary.removeClassName("information-primary-max")}u._secondary.empty();C=true;w(u._secondary,F)}})}}}})}else{var A={widgetId:u._skeleton.getOption("widgetId")};if(n.getpreviewPanel(A)===true){t();u._primary.setStyle("width","66%");u._secondary.setStyle("width","34%");u._primary.setStyle("display","inline-block");u._secondary.setStyle("display","inline-block")}else{u._primary.setStyle("display","none");u._secondary.setStyle("width","100%")}w(u._secondary)}},function(){if(l.is(y)){y.addClassName("information-view-vertical-nopreview")}if(l.is(u._primary)){u._primary.removeClassName("information-primary-vertical")}if(l.is(u._secondary)){u._secondary.removeClassName("information-secondary-vertical")}w(u._secondary)})}}return}if(u._lastSelectedItem===null){w()}else{w()}},setInfomationPanelObject:function(p){var q=this;if(q._lastSelectedItem===null&&p===null){return}q._lastSelectedItem=p;q._updateInformationsPanel();if(q._bNewUI===false&&q._lastSelectedItem===null&&q._skeleton&&UWA.is(q._skeleton.getOption("addinMode"),"string")){q._skeleton._searchActions.dispatchEvent("onInformationPanelAction")}},switchvisibleFlag:function(){var r=this;if(r._rightDockingElement!==null){if(r._rightDockingElement.visibleDockingZoneFlag===true){var t=r._rootView.getElement(".search-content-set-contents");t.setStyle("width","100%");r._rightDockingElement.visibleDockingZoneFlag=false;if(l.is(r._oneSearchPreviewAction)){r._oneSearchPreviewAction.setStyle("visibility","hidden");r._oneSearchPreviewAction.back.setStyle("display","none");var q=r._oneSearchPreviewAction.count;if(l.is(q)){var u=l.extendElement(q);u.setStyle("cursor","unset")}}if(l.is(r._lightBoxView)&&l.is(r._lightBoxView._LightBoxPanel)){this._lightBoxView._LightBoxPanel.visibleFlag=false}var p=r._rightDockingElement.freeZoneContent.getElement(".search-content-set-detail");if(l.is(p)){p.removeClassName("informationPanelSearchContent")}}else{var t=r._rootView.getElement(".search-content-set-contents");t.addClassName("informationPanel_opened");t.setStyle("width","calc(100% - 8px)");r._rightDockingElement.visibleDockingZoneFlag=true;r.setInfomationPanelObject(r._lastSelectedItem);if(l.is(r._oneSearchPreviewAction)){r._oneSearchPreviewAction.setStyle("visibility","visible");r._oneSearchPreviewAction.back.setStyle("display","flex");var q=r._oneSearchPreviewAction.count;if(l.is(q)){var u=l.extendElement(q);u.setStyle("cursor","pointer")}}}}},switchViewMode:function(p){var q=this;if(!l.is(q._rootView)){return}if(q._rightDockingElement!==null){q._rightDockingElement.freeZoneContent=null;if(i.getItem("nav_history")||i.getItem("integratedSearch")){if(l.is(d.getOption("search_compact_mode"))&&l.is(p)){q._rightDockingElement.freeZoneContent=p.container}else{q._rightDockingElement.freeZoneContent=q._rootView}}else{if(l.is(d.getOption("search_compact_mode"))&&l.is(p)){q._rightDockingElement.freeZoneContent=p.container}else{q._rightDockingElement.freeZoneContent=q._rootView.container}}q._rightDockingElement._applyFreeZoneContent()}},getvisibleFlag:function(){var p=this;var q=false;if(p._rightDockingElement!==null){q=p._rightDockingElement.visibleDockingZoneFlag}return q},hideAndclean:function(){var p=this;p.switchvisibleFlag();p.setInfomationPanelObject(null);if(l.is(p._lightBoxView)&&l.is(p._lightBoxView._LightBoxPanel)){this._lightBoxView._LightBoxPanel.visibleFlag=false}},updateDimension:function(p,r){var q=this;if(q._bNewUI!==true||q.getvisibleFlag()===false){return}clearTimeout(q.resizeEventId);q.resizeEventId=setTimeout(function(){if(!l.is(q._rightDockingElement)){return}var H;var v=false;var u;var A=r;if(!l.is(p)){if(l.is(q._skeleton)){var F=q._skeleton.getSearchWidget();if(l.is(F)&&l.is(F.body)){H=F.body;if(!l.is(A)&&l.is(F.getView,"function")&&l.is(F.getView().type)&&F.getView().type==="windowed"){A=24}}else{H=l.extendElement(document.body).getElement(".onesearch_results");v=true}}}else{H=p}if(l.is(H)&&l.is(H.getDimensions,"function")){var D=H.getDimensions();if(l.is(D)){u=D.width}}if(u<100){return}q._bIsOnIphone=false;if(u<639||q._screenType==="mobile"){q._bIsOnIphone=true;q._width=u;if(l.is(p)&&l.is(A)){q._width=u-A}if(v===true||p){var y=g.identifyClientInfo();if(y.identifier==="3DSwym"){q._width=u-20}}q._rightDockingElement.maxSize=q._width;q._rightDockingElement.minSize=q._width;q._rightDockingElement.dockingZoneSize=q._width;if(l.is(q._rightDockingElement.elements)){var w=q._rightDockingElement.elements.dockingZone;if(l.is(w)){w.setStyle("width",q._width+"px")}}}else{var C=u-340;var t=340;if(C<t){C=t}q._rightDockingElement.maxSize=C;q._rightDockingElement.minSize=t;var E=q._rightDockingElement.dockingZoneSize;if(l.is(A)&&A===-1){q._rightDockingElement.dockingZoneSize=u*2/3}else{if(E>C){if(q._max===false){q._rightDockingElement.dockingZoneSize=C}else{if(d.getOption("search_web_in_win")===true){q._rightDockingElement.dockingZoneSize=u}}}else{if(d.getOption("search_web_in_win")===true){q._rightDockingElement.dockingZoneSize=q._dockingZoneSize}}}}var G;if(l.is(q._rightDockingElement)){if(l.is(q._rightDockingElement.dockingZoneContent)){var x=q._rightDockingElement.dockingZoneSize;if(l.is(q._informationViewdiv)){G=l.extendElement(q._informationViewdiv)}if(x<850){q._rightDockingElement.dockingZoneContent.addClassName("searchContainerSmallWidth");if(G&&G.className.indexOf("information-view-vertical")===-1){G.addClassName("information-view-vertical");if(q._lastSelectedItem){var B=q._lastSelectedItem.getSourceID();if(B==="swym"||B==="dashboard"){q._primary.setStyle("height","unset")}else{q._primary.setStyle("height","50%");q._secondary.setStyle("height","50%")}}}}else{q._rightDockingElement.dockingZoneContent.removeClassName("searchContainerSmallWidth");if(G){G.removeClassName("information-view-vertical");if(q._lastSelectedItem){var B=q._lastSelectedItem.getSourceID();if(B==="swym"||B==="dashboard"){q._primary.setStyle("height","unset")}else{q._primary.setStyle("height","100%");q._secondary.setStyle("height","100%")}}}}}if(l.is(q._rightDockingElement.freeZoneContent)){var D=q._rightDockingElement.freeZoneContent.getDimensions();if(l.is(D)){var u=D.width;if(u<850){q._rightDockingElement.freeZoneContent.addClassName("searchContainerSmallWidth");if(l.is(q._informationPreviewContainer)){if(u===0){q._informationPreviewContainer.addClassName("information-view-search-empty")}else{q._informationPreviewContainer.removeClassName("information-view-search-empty")}}}else{if(l.is(q._informationPreviewContainer)){q._informationPreviewContainer.removeClassName("information-view-search-empty")}q._rightDockingElement.freeZoneContent.removeClassName("searchContainerSmallWidth")}var z=q._rightDockingElement.freeZoneContent.getElement(".search-content-set-detail");if(l.is(z)){if(u<=340){z.addClassName("informationPanelSearchContent")}else{z.removeClassName("informationPanelSearchContent")}}}}}},100)},createContainers:function(){var A=this;var v=false;if(l.is(A._oneSearchPreviewAction)){v=true}var C=g.identifyClientInfo();var w=document.createElement("div");var H;if(A._screenType==="mobile"){w.innerHTML=['<div class="information-container" style="border-right-style: solid;">','<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-collapse-panel" title="Maximize or restore"> </span>','<div class="information-main mobile">','<div class="information-header">','<div class="thumbnail-section"></div>','<div class="info-section">','<span class="title" ></span>',"</div>",'<div class="wux-controls-responsivetextualtileview-menu" has-menu="true"></div>',"</div>",'<div class="information-user">','<span class="user-picture-view-container">','<img class="e-nopicture" </img>',"</span>",'<div class="user-subtitle"> </div>',"</div>",'<div class="information-view" style="overflow: auto; flex-direction: unset;">','<div class="information-primary-nopreview" style="display: unset; width: 100%;" >','<div class="information-primary"></div>','<div class="information-secondary"> </div>',"</div>","</div>",'<div class="information-footer"></div>',"</div>","</div>"].join("");H=l.extendElement(w.querySelector(".information-container"))}else{w.innerHTML=['<div class="information-preview">','<div class="information-nopreview">','<span class="spannopreview">Select a result to preview</span>',"</div>",'<div class="information-container">','<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-collapse-panel" title="Maximize or restore"> </span>','<span class="wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-chevron-left" title="Previous"> </span>','<span class="wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-chevron-right" title="Next"> </span>','<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong search-preview-close" style="visibility: hidden;" title="Close"> </span>','<div class="information-main">','<div class="information-header">','<div class="thumbnail-section"></div>','<div class="info-section">','<span class="title" ></span>',"</div>",'<div class="wux-controls-responsivetextualtileview-menu" has-menu="true"></div>',"</div>",'<div class="information-user">','<span class="user-picture-view-container">','<img class="e-nopicture" </img>',"</span>",'<div class="user-subtitle"> </div>',"</div>",'<div class="information-view">','<div class="information-primary"></div>','<div class="information-secondary"> </div>',"</div>",'<div class="information-footer"></div>',"</div>","</div>","</div>"].join("");A._informationPreviewContainer=l.extendElement(w.querySelector(".information-container"));H=l.extendElement(w.querySelector(".information-preview"))}A._primary=l.extendElement(w.querySelector(".information-primary"));A._secondary=l.extendElement(w.querySelector(".information-secondary"));A._infoHeaderContainer=w.querySelector(".information-header");A._infoUserContainer=w.querySelector(".information-user");A._footerdiv=w.querySelector(".information-footer");A._informationViewdiv=w.querySelector(".information-view");A._informationNopreview=l.extendElement(w.querySelector(".information-nopreview"));if(v===true&&C.identifier==="3DDashboard"){var x=l.extendElement(w.querySelector(".information-main"));if(l.is(x)){x.addClassName("mobile3dd")}}A._hidefooter();if(l.is(A._footerdiv)&&d.getOption("search_web_in_win")!==true){A._buttonOpen=new h({name:"Open",label:o.get("InfoPanel.Open"),emphasize:"primary",onClick:function(){var T=A._lastSelectedItem.getServiceID();var S=A._lastSelectedItem.id;if(l.is(A._lastpreview)){if(l.is(A._lastpreview.getAppIdForOpen,"function")){var R={searchmodel:A._lastSelectedItem,widget_id:A._skeleton.getOption("widgetId"),};A._lastpreview.Open(R)}else{if(l.is(T)){f.load({serviceID:T,platformID:A._lastSelectedItem.getPlatformID()}).then(function(U){if(l.is(U.executeAction,"function")){U.executeAction({actionsHelper:A._skeleton._getActionsHelper(),action_id:"view",object_ids:[S],widget_id:A._skeleton.getOption("widgetId")})}},function(){a.handle({skeleton:A._skeleton,id:S,force:true})})}}}if(l.is(A._skeleton.options.observable)){A._skeleton.options.observable.manageinformationPanel(false)}A.savePreferences()}});A._buttonOpen.inject(A._footerdiv)}var E=w.querySelector(".wux-ui-3ds-wrong");if(l.is(E)){var F=l.extendElement(E);F.setAttribute("title",o.get("InfoPanel.Close"));F.addEventListener("click",function(){if(l.is(A._skeleton.options.observable)){A._skeleton.options.observable.manageinformationPanel(false);A._skeleton.options.observable.managepreviewPanel(false)}A.hideAndclean();if(A._max===true){A._expandcollapse(A._expandcollapseElement)}})}var t=function(){var R=this;A._expandcollapse(R)};var q=w.querySelector(".wux-ui-3ds-expand-collapse-panel");A._expandcollapseElement=l.extendElement(q);A._expandcollapseElement.addClassName("informationPanel_collapse");A._expandcollapseElement.setAttribute("title",o.get("InfoPanel.Expand"));A._expandcollapseElement.addEventListener("click",t.bind(q));var K=function(U){if(!l.is(U._skeleton)||!l.is(U._skeleton.getCollection())){M();return}var S=U._skeleton.getCollection().getTreeDocument();if(S){var R=S.getXSO();var W=R.get();if(W.length===0){S.getRoots()[0].select()}if(W.length>0){var T=W[W.length-1];var V=T.getPreviousVisibleNode();if(V){V.select(true)}}}};var G=function(U){if(!l.is(U._skeleton)||!l.is(U._skeleton.getCollection())){M();return}var S=U._skeleton.getCollection().getTreeDocument();if(S){var R=S.getXSO();var W=R.get();if(W.length===0){S.getRoots()[0].select()}if(W.length>0){var T=W[W.length-1];var V=T.getNextVisibleNode();if(V){V.select(true)}}}};var P;var Q;var M=function(){if(P){clearInterval(P)}if(Q){clearInterval(Q)}};var p=function(){M();K(A);Q=setTimeout(function(){P=setInterval(K,A,A._intervalTimer)},500)};var z=function(){M();G(A);Q=setTimeout(function(){P=setInterval(G,A,A._intervalTimer)},500)};var B=function(){p()};var D=function(){z()};var J=null;var u=null;var L=null;if(v===true){u=A._oneSearchPreviewAction.preview;if(l.is(u)){A._previouselement=l.extendElement(u);A._previouselement.addEventListener("click",B)}J=A._oneSearchPreviewAction.next;if(l.is(J)){A._nextelement=l.extendElement(J);A._nextelement.addEventListener("click",D)}L=A._oneSearchPreviewAction.back;if(l.is(L)){L.setStyle("display","flex");var y=A._oneSearchPreviewAction.count;if(l.is(y)){var I=l.extendElement(y);I.setStyle("cursor","pointer")}var O=l.extendElement(L);O.addEventListener("click",function(){var R=A._oneSearchPreviewAction.count;if(l.is(R)){var S=l.extendElement(R);S.setStyle("cursor","unset")}A.hideAndclean();if(A._skeleton){A._skeleton.resetMultisel()}})}var y=A._oneSearchPreviewAction.count;if(l.is(y)){var I=l.extendElement(y);I.addEventListener("click",function(){if(l.is(A._oneSearchPreviewAction.back)){var R=A._oneSearchPreviewAction.back;if(l.is(R)){var S=R.getStyle("visibility");if(l.is(S)&&S==="visible"){I.setStyle("cursor","unset");A.hideAndclean();if(A._skeleton){A._skeleton.resetMultisel()}}}}})}A._oneSearchPreviewAction.setStyle("visibility","visible")}else{u=w.querySelector(".wux-ui-3ds-chevron-left");A._previouselement=l.extendElement(u);A._previouselement.setAttribute("title",o.get("InfoPanel.Previous"));A._previouselement.addEventListener("click",B);J=w.querySelector(".wux-ui-3ds-chevron-right");A._nextelement=l.extendElement(J);A._nextelement.setAttribute("title",o.get("InfoPanel.Next"));A._nextelement.addEventListener("click",D);var N=w.querySelector(".spannopreview");if(N!==null){N.innerText=o.get("InfoPanel.noSelected")}}var r=w.querySelector(".wux-controls-responsivetextualtileview-menu");if(r){A._menuAction=l.extendElement(r);r.style.visibility="hidden";if(C.identifier!=="3DSwym"){r.addEventListener("mouseup",function(S){if(S){S.cancelBubble=true}if(S&&S.stopPropagation){S.stopPropagation()}if(S&&S.preventDefault){S.preventDefault()}var T=A._skeleton.getCurrentView();if(T){var R;if(T.id==="table"){R=T.view.options.onContextualEvent}else{R=T.view.onContextualEvent}if(R){R.callback.call(T,{forcemenu:true,fromPreview:true,data:{target:r},cellInfos:{nodeModel:A._getTreeModel(),cellView:{getContent:function(){return(S.currentTarget)}}}})}}})}}return H},_updateInformationsPanelContents:function(){var x=this;var z=x._getTreeModel();if(!l.is(z)||!l.is(x._lastSelectedItem)){return}x.updateDimension();var q=x._infoHeaderContainer.querySelector(".thumbnail-section");if(l.is(q)){q.style.backgroundImage="url("+x._lastSelectedItem.get("type_icon_url")+")"}var r=x._infoHeaderContainer.querySelector(".title");var t=l.extendElement(r);t.empty();t.setHTML(z._options.label);if(l.is(x._skeleton)){var B=x._skeleton.getCollection().getSearchRessources();if(l.is(B)){var y=x._lastSelectedItem.get("ds6w:responsibleUid");if(!l.is(y)){y=x._lastSelectedItem.get("owner")}var v=B.getUserPicture({login:y,format:"mini"});var u=x._infoUserContainer.querySelector(".e-nopicture");u.src=v}}var p=x._infoUserContainer.querySelector(".user-subtitle");var w=l.extendElement(p);w.empty();w.setHTML(z._options.subLabel);if(l.is(x._lightBoxView)&&l.is(x._lightBoxView._LightBoxPanel)){if(this._lightBoxView._LightBoxPanel.visibleFlag===false){x._lightBoxView.activate_deactivate(x._lastSelectedItem)}}if(l.is(x._menuAction)){x._menuAction.setStyle("visibility","hidden");if(x._lastSelectedItem.getSourceID()==="3dspace"){x._menuAction.setStyle("visibility","visible")}}if(x._lastSelectedItem!==null&&x._buttonOpen&&d.getOption("search_web_in_win")!==true){var A=x._lastSelectedItem.getServiceID();if(l.is(A)){if(x._lastpreview&&l.is(x._lastpreview.getAppIdForOpen,"function")){var C={searchmodel:x._lastSelectedItem,widget_id:x._skeleton.getOption("widgetId"),onComplete:function(){x._showfooter();x._buttonOpen.disabled=false},onFailure:function(){x._hidefooter();x._buttonOpen.disabled=true}};x._lastpreview.getAppIdForOpen(C)}else{f.load({serviceID:A,platformID:x._lastSelectedItem.getPlatformID()}).then(function(D){if(l.is(D.getDoubleClickAction,"function")){D.getDoubleClickAction({model:x._lastSelectedItem,appID:g.SEARCH_APP_ID,onFailure:function(){x._hidefooter();x._buttonOpen.disabled=true},onComplete:function(){x._showfooter();x._buttonOpen.disabled=false}})}else{console.log("InformationsPanelView : no getActions..");x._hidefooter();x._buttonOpen.disabled=true}},function(){console.log("InformationsPanelView : no ServiceDelegationLoader..");x._hidefooter();x._buttonOpen.disabled=true})}}}},_hidefooter:function(){var p=this;if(!l.is(p._footerdiv)){return}p._footerdiv.style.display="none";if(l.is(p._informationViewdiv)){if(p._infoUserContainer.style.display==="none"){p._informationViewdiv.style.height="calc(100% - 90px)"}else{p._informationViewdiv.style.height="calc(100% - 90px)"}}},_showfooter:function(){var p=this;if(!l.is(p._footerdiv)){return}p._footerdiv.style.display="inline-flex";if(l.is(p._informationViewdiv)){if(p._bIsOnIphone===false){p._informationViewdiv.style.height="calc(100% - 144px)"}else{var q=g.identifyClientInfo();if(p._screenType==="mobile"&&q.identifier==="3DDashboard"){p._informationViewdiv.style.height="calc(100% - 155px)"}else{p._informationViewdiv.style.height="calc(100% - 138px)"}}}},_expandcollapse:function(u){var v=this;if(!l.is(v._rightDockingElement)||!l.is(v._skeleton)||!l.is(u)){return}var t;var q=false;var y=v._skeleton.getSearchWidget();if(UWA.is(y)&&UWA.is(y.body)){var x=y.body.getDimensions();if(UWA.is(x)){t=x.width}}else{var r=l.extendElement(document.body).getElement(".onesearch_results");if(UWA.is(r)){var x=r.getDimensions();if(UWA.is(x)){t=x.width;q=true}}}if(UWA.is(t)&&t>639&&v._screenType!=="mobile"){if(v._max===true){u.removeClassName("informationPanel_expand");u.addClassName("informationPanel_collapse");var w=t-320;v._rightDockingElement.maxSize=w;v._rightDockingElement.dockingZoneSize=v._lastwidth;v._max=false;v._expandcollapseElement.setAttribute("title",o.get("InfoPanel.Expand"))}else{u.removeClassName("informationPanel_collapse");u.addClassName("informationPanel_expand");v._lastwidth=v._rightDockingElement.dockingZoneSize;var p=t-22;if(v._screenType==="mobile"){p=t}if(q===true){p=t}v._rightDockingElement.maxSize=p;v._rightDockingElement.dockingZoneSize=p;v._max=true;v._expandcollapseElement.setAttribute("title",o.get("InfoPanel.Collapsed"))}}},_getTreeModel:function(){var r=this;if(!l.is(r._skeleton)&&!l.is(r._skeleton.getCollection())){return}if(r._previouselement&&r._nextelement){r._previouselement.removeClassName("left-disable");r._nextelement.removeClassName("right-disable")}var q=r._skeleton.getCollection().indexOf(r._lastSelectedItem);if(q===-1){return}else{if(q===0){if(r._previouselement){r._previouselement.addClassName("left-disable")}if(q===(r._skeleton.getCollection().length-1)){if(r._nextelement){r._nextelement.addClassName("right-disable")}}else{if(r._nextelement){r._nextelement.setStyle("display","flex")}}}else{if(q===(r._skeleton.getCollection().length-1)){if(r._previouselement){r._previouselement.setStyle("display","flex")}if(r._nextelement){r._nextelement.addClassName("right-disable")}}else{if(r._previouselement){r._previouselement.setStyle("display","flex")}if(r._nextelement){r._nextelement.setStyle("display","flex")}}}}if(q>=0){var t=null;var p=r._skeleton.getCollection().getTreeDocument().getRoots();if(UWA.is(p,"array")){if(q<p.length){t=p[q];return t}}}},changeModel:function(p){var q=this;if(l.is(q._lightBoxView)){q._lightBoxView.changeModel(p)}},activate_deactivateNoPreview:function(p){var q=this;if(q._screenType==="mobile"&&l.is(p)&&p===true){q.hideAndclean()}if(!l.is(p)||q._informationNopreview===null||q._informationPreviewContainer===null){return}if(p===true){q._informationNopreview.setStyle("display","inline-block");q._informationPreviewContainer.setStyle("display","none")}else{q._informationNopreview.setStyle("display","none");q._informationPreviewContainer.setStyle("display","flex")}},savePreferences:function(){var p=this;if(!l.is(p._rightDockingElement)){return}var t=p._rightDockingElement.dockingZoneSize;var u=p._rightDockingElement.maxSize;var r=p._rightDockingElement.minSize;var q=p._skeleton.getSearchWidget();if(UWA.is(q)){q.setValue("previewZoneSize",t);q.setValue("previewmaxSize",u);q.setValue("previewminSize",r)}i.setItem("previewZoneSize",t);i.setItem("previewmaxSize",u);i.setItem("previewminSize",r);i.commit()},managePreferences:function(){var p=this;var t;var u;var r;var q=p._skeleton.getSearchWidget();if(UWA.is(q)){t=q.getValue("previewZoneSize");u=q.setValue("previewmaxSize");r=q.setValue("previewminSize")}if(!l.is(t)||!l.is(u)||!l.is(r)){t=i.getItem("previewZoneSize");u=i.getItem("previewmaxSize");r=i.getItem("previewminSize")}if(l.is(t)&&l.is(u)&&l.is(r)){return({ZoneSize:t,maxSize:u,minSize:r,})}}});return c});define("DS/SNResultUX/views/WebUX/Tree/TreeListView",["DS/Tree/TreeListView","DS/SNResultUX/views/WebUX/Tree/TreeNodeView"],function(a,b){return a.extend({defaultOptions:{cellClass:b}})});define("DS/SNResultUX/utils/SearchViewOptions",["UWA/Core","UWA/Class/Debug","UWA/Class","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/ResultUX_customization","DS/SNInfraUX/PredicatesNLS","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(h,g,i,d,e,c,j,k){var a=null;var f=null;var b=null;return i.singleton(g,{tmp_idx:0,_viewData:null,_domAttachedEvent:[],init:function(n){this._adminCusto=e.getAdminCustoDefinition();this._domAttachedEvent=[];if(h.is(this._adminCusto,"object")&&h.is(this._adminCusto.CustoAliasDefinitions,"array")){var l=this._adminCusto.CustoAliasDefinitions;b=[];for(var m=0;m<l.length;m++){if(h.is(l[m].aliasId,"string")){var q=l[m].viewDefinition;for(var p=0;p<q.length;p++){if(h.is(q[p].dataType)&&b.indexOf(q[p].dataType)===-1){b.push(q[p].dataType)}}}}}a=[{dataIndex:"ds6w:label",isSortable:true,text:j.getNLSValueForPredicate("ds6w:what/ds6w:label"),minWidth:40},{dataIndex:"ds6w:type",isSortable:true,text:j.getNLSValueForPredicate("ds6w:type"),minWidth:40},{dataIndex:"ds6w:description",isSortable:true,text:j.getNLSValueForPredicate("ds6w:what/ds6w:description"),minWidth:40},{dataIndex:"ds6w:identifier",isSortable:true,text:j.getNLSValueForPredicate("ds6w:what/ds6w:identifier"),minWidth:40},{dataIndex:"ds6w:modified",isSortable:true,text:j.getNLSValueForPredicate("ds6w:modified"),minWidth:40},{dataIndex:"ds6w:created",isSortable:true,text:j.getNLSValueForPredicate("ds6w:created"),minWidth:40},{dataIndex:"ds6w:responsible",isSortable:true,text:j.getNLSValueForPredicate("ds6w:responsible"),minWidth:40}];this.setDebugMode(d.options.search_settings.debug_mode);var o="";if(h.is(n)&&h.is(n.activeTenant,"string")&&n.activeTenant.length>0){o=n.activeTenant}if(h.is(this._cstoreSources,"array")&&this._cstoreSources.length>0){o=this._cstoreSources[0].tenantId}var r=this;e.isRoleAvailable(["CSV"],o,function(t){if(true==t){a=[{dataIndex:"ds6w:label",isSortable:true,text:j.getNLSValueForPredicate("ds6w:what/ds6w:label"),minWidth:40},{dataIndex:"ds6w:type",isSortable:true,text:j.getNLSValueForPredicate("ds6w:type"),minWidth:40},{dataIndex:"ds6w:description",isSortable:true,text:j.getNLSValueForPredicate("ds6w:what/ds6w:description"),minWidth:40},{dataIndex:"ds6w:identifier",isSortable:true,text:j.getNLSValueForPredicate("ds6w:what/ds6w:identifier"),minWidth:40},{dataIndex:"ds6w:modified",isSortable:true,text:j.getNLSValueForPredicate("ds6w:modified"),minWidth:40},{dataIndex:"ds6w:created",isSortable:true,text:j.getNLSValueForPredicate("ds6w:created"),minWidth:40},{dataIndex:"ds6wg:revision",isSortable:true,text:j.getNLSValueForPredicate("ds6wg:revision"),minWidth:40},{dataIndex:"ds6w:status",isSortable:true,text:j.getNLSValueForPredicate("ds6w:status"),minWidth:40},{dataIndex:"ds6w:responsible",isSortable:true,text:j.getNLSValueForPredicate("ds6w:responsible"),minWidth:40}]}a=r.getCustoCellRequest(a)});a=this.getCustoCellRequest(a)},setContextOptions:function(l){f=UWA.clone(l)},getContextOptions:function(){return f},getItemViewOptions:function(l){return{mapping:this._getMapping(),resources:l}},getDataGridViewHeaders:function(v){this._specificLoadPredicateNLS(v);var p=[];var t=null;if(h.is(f)){var o=f.columns;if(!h.is(o)){return a}if(o.length<=0||(o.length===1&&o[0]==="")){return a}for(var r=0;r<o.length;r++){var n=o[r];p.push({dataIndex:n,isSortable:true,minWidth:40,text:j.getNLSValueForPredicate(n)})}}else{if(c.getDataGridViewColumns()&&!(h.is(this._adminCusto,"object")&&h.is(this._adminCusto.CustoAliasDefinitions,"array"))){var o=c.getDataGridViewColumns();for(var r=0;r<o.length;r++){var n=o[r];var q=j.getNLSValueForPredicate(n);p.push({dataIndex:e.getURIToUse(n),isSortable:true,minWidth:40,text:q})}}else{if(h.is(this._adminCusto,"object")&&h.is(this._adminCusto.CustoAliasDefinitions,"array")){var o=[];var l=this._adminCusto.CustoAliasDefinitions;for(var r=0;r<l.length;r++){if(h.is(l[r].aliasId,"string")&&l[r].aliasId==="The_Default_Columns"){o=l[r].viewDefinition;break}}if(o.length>0){for(var r=0;r<o.length;r++){var n=o[r];var q=j.getNLSValueForPredicate(n.uri);p.push({dataIndex:n.uri,isSortable:true,minWidth:40,text:q,width:n.width})}if(b.length>0){var w=j._asyncCallToPredicatesWS(b).then(function u(x){for(var z=0;z<o.length;z++){var C=o[z];var B=j.getNLSValueForPredicate(C.uri);if(h.is(C.dataType)&&(B.startsWith("ds6wg")||B.startsWith("ds6w"))){if(h.is(x.classPredicates)){for(var A=0;A<x.classPredicates.length;A++){for(var y=0;y<x.classPredicates[A].vocabularyPredicateInfo.length;y++){if(x.classPredicates[A].vocabularyPredicateInfo[y].uri===C.uri){B=x.classPredicates[A].vocabularyPredicateInfo[y].nlsName;break}}}}}p.push({dataIndex:C.uri,isSortable:true,minWidth:40,text:B,width:C.width})}},function m(){console.log("promisePredicate fail !")})}}else{t=a}}else{t=a}}}if(!h.is(t)){t=this.getCustoCellRequest(p);if(!h.is(t)&&t.length<1){t=a}}if(UWA.is(v,"function")){v.call(undefined,t)}return t},getDataGridViewHeadersForInApps:function(r){this._specificLoadPredicateNLS(r);var p="ds6w";if(!j.isLoaded(p)){if(UWA.is(r,"function")){j.loadVocabulary(p,r)}}var q=[];var m=null;if(h.is(f)){var n=f.columns;if(!h.is(n)){return a}if(n.length<=0||(n.length===1&&n[0]==="")){return a}for(var l=0;l<n.length;l++){var o=n[l];q.push({dataIndex:o,isSortable:true,minWidth:40,text:j.getNLSValueForPredicate(o)})}}else{m=null}(!h.is(m))?m=this.getCustoCellRequest(q):null;(UWA.is(r,"function"))?r.call(undefined,m):null;return m},_specificLoadPredicateNLS:function(l){if(!j.isLoaded("ds6w")&&UWA.is(l,"function")){j.loadVocabulary("ds6w",l)}},getCustoCellRequest:function(m){if(d.getOption("enableDataGridView")){return m}if(!h.is(m,"array")){throw ("E_INVALIDARG: bad columns given to getCustoCellRequest method !")}var n=-1;for(var l=0;l<m.length&&-1===n;l++){("ds6w:label"===m[l].dataIndex)?n=l:null}if(-1!==n){m[n].onCellRequest=function(q){if(q.nodeModel instanceof Object){var o=(undefined!=q.nodeModel.options.grid.type_icon_url)?q.nodeModel.options.grid.type_icon_url:(undefined!=q.nodeModel.options.grid.type_icon_url_value)?q.nodeModel.options.grid.type_icon_url_value:null;var p=(undefined!=q.nodeModel.options.grid["ds6w:label"])?q.nodeModel.options.grid["ds6w:label"]:(undefined!=q.nodeModel.options.grid["ds6w:label_value"])?q.nodeModel.options.grid["ds6w:label_value"]:(undefined!=q.nodeModel.options.grid["ds6w:identifier"])?q.nodeModel.options.grid["ds6w:identifier"]:(undefined!=q.nodeModel.options.grid["ds6w:identifier_value"])?q.nodeModel.options.grid["ds6w:identifier_value"]:null;q.cellView.getContent().innerHTML=((null!==o)?'<img class="type-icon-datagrid" src="'+o+'" draggable="false"/>':"")+((null!==p)?p:"...")}}}return m},initColumnsTreeList:function(m,l){if(!h.is(m,"object")){throw ("E_INVALIDARG: bad gridOptions given to initColumnsTreeList method !")}if(!h.is(m.columns,"array")){throw ("E_INVALIDARG: bad gridOptions.columns given to initColumnsTreeList method !")}if(!h.is(l,"object")){throw ("E_INVALIDARG: bad options given to initColumnsTreeList method !")}m.columns.splice(0,0,{text:"",dataIndex:"tree",isHidden:true});if(!e.isFUNActive("FUN075064")){m.columns.splice(0,0,{text:"",dataIndex:"selection",type:"selection",width:24,isHidden:l.selectionMode_techno==="oneToOne"})}else{m.columns.splice(0,0,{dataIndex:"selection_search",width:24,isResizable:false,isSortable:false,isHidden:l.selectionMode_techno==="oneToOne",setValue:function(n){n.nodeModel.selectionChangeIsFromUI();if(n.value){n.manager.getNodesXSO().add(n.nodeModel)}else{n.manager.getNodesXSO().remove(n.nodeModel)}n.manager.updateRowViewWithException(n.nodeModel,n.dataIndex)},getValue:function(n){return n.nodeModel.isSelected()},onCellChange:function(n){return n.event.target.dsModel.checkFlag},onCellRequest:function(o){var n=o.cellView.reuseCellContent("checkbox_search");if(o.isHeader){n.currentNodeModel=null;n.ignoreUpdate=true;n.visibleFlag=false;n.visibleFlag=true;n.mixedState=o.manager.getNodesXSO().get().length>0&&!o.manager.isEveryVisibleNodeSelected();n.checkFlag=o.manager.isEveryVisibleNodeSelected()||(o.manager.getNodesXSO().get().length>0&&!o.manager.isEveryVisibleNodeSelected());n.ignoreUpdate=false}else{n.currentNodeModel=o.nodeModel;n.checkFlag=o.manager.getNodesXSO().isIn(o.nodeModel);n.mixedState=false}}})}m.columns.splice(2,0,{dataIndex:"actions",isSortable:false,isDraggable:false,text:k.get("actions.title"),actions:true,width:60});return m},initColumnsDataGrid:function(n,m,p){if(!h.is(n,"object")){throw ("E_INVALIDARG: bad gridOptions given to initColumnsDataGrid method !")}if(!h.is(n.columns,"array")){throw ("E_INVALIDARG: bad gridOptions.columns given to initColumnsDataGrid method !")}if("ds6w:label"!==n.columns[0].dataIndex){throw ("E_INVALIDARG: Column index 1 must be label !")}var o=this;var l=n.columns[0];l.pinned="left";l.onCellRequest=function(q){var r=(q.nodeModel instanceof Object&&h.is(q.nodeModel._options.icons[0]))?q.nodeModel._options.icons[0]:null;var u="3dsearch-datagrid-dropdown-icon-"+q.cellID;var t='<span style="font-size:18px;color:gray;cursor:pointer;" class="fonticon fonticon-2x fonticon-down-open" data-rec-id="'+u+'"></span>';q.cellModel=t+((q.nodeModel instanceof Object&&h.is(q.nodeModel._options.icons[0]))?'<img class="type-icon-datagrid" src="'+r+'" draggable="false"/>':"")+q.cellModel;this._setTweakerForCell(q);q.cellView.getContent().getChildren()[0].removeEvent("click",m,false);q.cellView.getContent().getChildren()[0].addEvent("click",m,false);o._domAttachedEvent[u]={target:q,callback:p};q.cellView.getContent().removeAttribute("no-tweaker")};return n},getTableViewHeaders:function(){return this.getDataGridViewHeaders()},getXMLViewOptions:function(){var l={default_mapping:function(n){var m=n;if(n.indexOf("/")!=-1){m=n.substring(n.lastIndexOf("/")+1)}return m}};return l},_getMapping:function(){var m=this,l=c.getMapping();l.title=function(){var n=this.model||this;return n.get("ds6w:label")};l.subtitle=function(){var p=this.model||this;var o="";var q=p.get("ds6w:who/ds6w:responsible");if(h.is(q,"string")&&q.length>0){o+=q}var n=p.get("ds6w:modified");if(h.is(n,"string")&&n.length>0){if(o.length>0){o+=" - "}o+=n}var r=m._retrieveSource(p);if(h.is(r,"string")&&r.length>0){if(o.length>0){o+=" - "}o+=r}return o};l.content=function(){var o=this.model||this;var q="";var n=o.get("ds6w:identifier"),p=o.get("ds6w:description");if(h.is(n,"string")&&n.length>0){q+=n}if(h.is(p,"string")&&p.length>0){if(q.length>0){q+="<br/>"}q+=p}return q};l.date=function(){var n=this.model||this;return n.get("ds6w:modified")};l.source=function(){var n=this.model||this;return m._retrieveSource(n)};l.ownerName=function(){var n=this.model||this;return n.get("owner")};l.icon_source=function(){var n=this.model||this,o=h.is(n)?n.get("source_icon_url"):"";if(!h.is(o,"string")){o=""}return o};return l},_retrieveSource:function(l){if(!h.is(l,"object")){throw ("E_INVALIDARG: bad model given to _retrieveSource method !")}var m=l.get("ds6w:where/ds6w:context/ds6w:project");if(m===undefined||!h.is(m,"string")||m.length===0){m=l.get("ds6w:where/ds6w:context/ds6w:community");if(!h.is(m,"string")||m.length===0){m=""}}return m},setViewData:function(l){this._viewData=l},getViewData:function(){return this._viewData},getNlsOfDataSources:function(m){if(!h.is(m)){return(null)}var n=[];if(UWA.is(m.dataSourceLists,"array")){var o=m.dataSourceLists;for(var l=0;l<o.length;l++){n.push(k.get("adv_search.source."+o[l]))}}return n},getAvailableViews:function(n){if(!h.is(n)){return(null)}var l=(h.is(n.simple_search_experience))?n.simple_search_experience:(h.is(n.activeTenant))?e.isInTheSimpleSearch({tenant:n.activeTenant}):false;var m=[];if(l===true){var o=d.getOption("search_compact_mode");if(!h.is(o)){o=false}if(o===false){m=[{id:"thumbnail",title:k.get("view.thumbnail.title"),icon:"view-small-thb",nlsKeys:"view.thumbnail.title"},{id:"tilebig",title:k.get("view.Textual.title"),icon:"view-big-tile",nlsKeys:"view.Textual.title","default":true},{id:"tile",title:k.get("view.tile.title"),icon:"view-small-tile",nlsKeys:"view.tile.title"},{id:"table",title:k.get("view.table.title"),icon:"view-list",nlsKeys:"view.table.title"}]}else{m=[{id:"thumbnail",nlsKeys:"view.thumbnail.title",icon:"view-small-thb",title:k.get("view.thumbnail.title")},{id:"tilebig",nlsKeys:"view.Textual.title",icon:"view-big-tile",title:k.get("view.Textual.title"),"default":true},{id:"tile",nlsKeys:"view.tile.title",icon:"view-small-tile",title:k.get("view.tile.title")}]}}else{if(d.getOption("enableNewSearchViews")!==true){m=[{id:"thumbnail",title:k.get("view.thumbnail.title"),icon:"view-small-thb",nlsKeys:"view.thumbnail.title","default":true},{id:"tile",title:k.get("view.tile.title"),icon:"view-small-tile",nlsKeys:"view.tile.title"},{id:"table",title:k.get("view.table.title"),icon:"view-list",nlsKeys:"view.table.title"}]}else{m=[{id:"thumbnail",title:k.get("view.thumbnail.title"),icon:"view-small-thb",nlsKeys:"view.thumbnail.title"},{id:"tilebig",title:k.get("view.Textual.title"),icon:"view-big-tile",nlsKeys:"view.Textual.title","default":true},{id:"tile",title:k.get("view.tile.title"),icon:"view-small-tile",nlsKeys:"view.tile.title"},{id:"table",title:k.get("view.table.title"),icon:"view-list",nlsKeys:"view.table.title"}]}}return m}})});define("DS/SNResultUX/views/Play3DView",["DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchViewOptions","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","UWA/Class/Debug","DS/Handlebars/Handlebars","UWA/Class/Collection","UWA/Promise","UWA/Core","DS/W3DXComponents/Views/Temp/TempItemView","DS/W3DXComponents/Skeleton","DS/SNInfraUX/SearchUtils"],function(f,c,m,h,b,e,j,k,d,a,g){var l="play3d";var i=d.extend(h,{name:l,tagName:"div",player3D:null,template:function(){var n='<div class="'+this.getClassNames("-sub-container")+'">';return n},init:function(n){var o=this;["container","template","tagName","domEvents"].forEach(function(p){delete n[p]});this._parent.call(this,n)},setup:function(){this.setDebugMode(f.getDebugMode());this.container.addClassName(this.getClassNames("-container"))},onRender:function(){this.log("onRender 3DPlay");this._initPlayer()},onDestroy:function(){if(k.is(this.player3D)){this.player3D.dispose()}this.container.empty();return this._parent.apply(this,arguments)},_initPlayer:function(){var n=this.model;var p={container:this.container,input:{asset:{provider:"EV6",serverurl:n.getFederatedSource().get3DSpaceUrl(),physicalid:n.id,dtype:n.get("ds6w:what/ds6w:type_value"),requiredAuth:"passport",requestsOptions:{authentication:"passport"}},usage:"preview"},options:{loading:"autoplay"},lang:g.getLanguage()};var o=this;require(["DS/3DPlayHelper/3DPlayHelper"],function(t){var q=n.getServiceID();var r=n.getPlatformID();if(UWA.is(q,"string")&&UWA.is(r,"string")){p.input.asset.tenant=r;if(f.getOption("search_web_in_win")){o.player3D=new t(p)}else{require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(u){u.getServiceUrl({serviceName:q,platformId:r,onComplete:function(v){if(UWA.is(v,"string")){p.input.asset.serverurl=v;o.player3D=new t(p)}}})})}}})}});i.facet_name=l;i.is_facet_avalailable=function(p){if(!k.is(p)){return false}if(k.is(p.collection)&&k.is(p.collection.service_parameters)&&(k.is(p.collection.service_parameters.query)&&g.SearchTypeEnum.MY_RECENT_CONTENT===p.collection.service_parameters.query)){console.warn("Play3D disabled as object is not indexed !");return false}var q=false;if(!k.is(p.get,"function")){return false}var n=p.get("ds6w:what/ds6w:type_value");if(!k.is(n)){n=p.get("ds6w:type_value")}if(!k.is(n)){return q}var o=p.get("play3d");if(k.is(o)){return o}else{if(p.play_status_computaion==="underway"){return q}}console.log("starting the 3dplay tab availability computation for this object");p.play_status_computaion="underway";require(["DS/3DPlay/ExperiencesList"],function(t){console.log("DS/3DPlay/ExperiencesList LOADED");if(k.is(t.dtypes[n])){p.set("play3d",true);p.play_status_computaion="ended"}else{var v=p.getServiceID();var w=p.getPlatformID();if(UWA.is(v,"string")&&UWA.is(w,"string")){var u={provider:"EV6",physicalid:p.id,dtype:p.get("ds6w:what/ds6w:type_value"),requiredAuth:"passport",requestsOptions:{authentication:"passport"}};var r=function(){var z=new j(function(B,A){t.getExperienceFromPLMType(u,function(C){if(k.is(C)){B()}else{A()}})}).then(function y(){p.set("play3d",true);p.play_status_computaion="ended"},function x(){p.set("play3d",false);p.play_status_computaion="ended"})};if(f.getOption("search_web_in_win")){if(k.is(p.getFederatedSource)&&k.is(p.getFederatedSource().get3DSpaceUrl())){u.serverurl=p.getFederatedSource().get3DSpaceUrl();u.tenant=w;r()}}else{require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(x){x.getServiceUrl({serviceName:v,platformId:w,onComplete:function(y){if(UWA.is(y,"string")){u.tenant=w;u.serverurl=y;r()}}})})}}}});return q};i.facet_idcard=function(){return{text:m.get("skeleton.facets.play3d"),icon:"eye",handler:a.getRendererHandler(l)}};i.facet_options=function(){return{view:i,collection:e,fetchMode:"never"}};return i});define("DS/SNResultUX/views/PropertiesView",["DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchViewOptions","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchUtils","DS/UIKIT/Alert","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","UWA/Core","UWA/Class/Debug","DS/Handlebars/Handlebars","UWA/Class/Collection","DS/W3DXComponents/Views/Temp/TempItemView","DS/W3DXComponents/Skeleton","UWA/Utils/Client","UWA/Controls/Scroller","css!DS/SNResultUX/SNResultUX.css"],function(k,b,p,a,i,j,h,o,r,e,t,g,c,m,n,f){var l="properties";var q=["type_icon_url","id","resourceid","resourceid_tagger","preview_url","image","icon","actions","subtitle","icon_source"];var d=g.extend(r,{name:l,tagName:"div",template:function(){var v=this;var u;if((v.model.id.indexOf("swym:")!==0)&&(k.getOption("search_web_in_win")!==true)&&(o.is(v._newEdit)&&v._newEdit===true)){u='<div class="'+v.getClassNames("-sub-container")+' propertiesDiv"><div class="properties-body"></div></div>'}else{u='<div class="'+v.getClassNames("-sub-container")+' propertiesDiv"><table class="table properties-body"></table></div>'}return u},setup:function(){this.setDebugMode(k.getDebugMode());this.container.addClassName(this.getClassNames("-container"));this.useNewEditProp(function(u){console.log("Use new Property tab="+u)})},_HTMLDecode:function(u){if(!u){return u}u=u.replace(/&amp;/g,"&");u=u.replace(/&gt;/g,">");u=u.replace(/&lt;/g,"<");u=u.replace(/&quot;/g,'"');u=u.replace(/&#039;/g,"'");return u},hasPARRole:function(x){var w=this;var u=k.getOption("PARRole");if(o.is(u)){if(true===u){w._hasPARRole=true}else{w._hasPARRole=false}x(w._hasPARRole);return}if(!o.is(w._hasPARRole)){w._hasPARRole=false;try{a.getGrantedRoles(function(z){for(var y=0;y<z.length;y++){if(z[y]&&z[y].id==="PAR"){w._hasPARRole=true;w._newPropertyReadOnly=false}}x(w._hasPARRole)})}catch(v){w._hasPARRole=false;x(w._hasPARRole)}}else{x(w._hasPARRole)}},useNewEditProp:function(w){var u=this;if(!o.is(u._newEdit)){u._newEdit=false;var v=k.getOption("NewPropertiesTabUIMode");if(o.is(v)){u._newEdit=true;u._newPropertyReadOnly=true;if("Edit"===v){u._newPropertyReadOnly=false}w(u._newEdit);return}u.hasPARRole(function(x){if(true===x){u._newEdit=true}w(u._newEdit);return})}else{w(u._newEdit)}},onRender:function(){this.log("onRender the PropertiesView");var u=this;u.useNewEditProp(function(E){if((u.model.id.indexOf("swym:")!==0)&&(k.getOption("search_web_in_win")!==true)&&(E===true)){var M=u.container.getElement(".properties-sub-container"),F=u.container.getElement(".properties-body");if(k.getOption("search_web_in_win")!==true){require(["DS/PlatformAPI/PlatformAPI"],function(R){var T={paths:[]};T.attributes={};T.version="1.1";var Q=[];Q[0]=u.model.id;T.paths[0]=Q;var S="DS/PADUtils/PADCommandProxy/select";R.publish(S,T)})}if(!o.is(M)){throw ("Unable to find scrollListContainer")}if(o.is(F)){u._container=F;require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel"],function(V,R,T){var Q=new V({typeOfDisplay:R.ONLY_EDIT_PROPERTIES,selectionType:R.NO_SELECTION,readOnly:u._newPropertyReadOnly,extraNotif:true,editMode:true,events:{onNotification:function(X){if(X.eventID==="error"){var W="You are not allowed to do that modification";if(X.msg.length>0){W=X.msg}if(W.length>0){u._alert=new i({className:"search-alert",visible:true,autoHide:false,closable:true,messages:W}).inject(u._container,"top")}}if(X.eventID==="success"){var W="You are allowed to do that modification";if(X.msg.length>0){W=X.msg}if(W.length>0){u._alert=new i({className:"search-alert",visible:true,autoHide:false,closable:true,messages:W}).inject(u._container,"top")}}}}});Q.inject(u._container);u._container.addEvents({resize:function(){Q.onResize()}});var U=[];var S=new T({metatype:"businessobject",objectId:u.model.id});U.push(S);Q.initDatas(U)})}else{throw new Error("Cannot find element editproperties-tbody in the DOM")}}else{console.log("swym data");var M=u.container.getElement(".properties-sub-container"),F=u.container.getElement(".properties-body"),K=o.createElement,D=K("thead",{html:{tag:"tr",html:[{tag:"th",text:h.get("skeleton.facets.properties.propertyKey")},{tag:"th",text:h.get("skeleton.facets.properties.valueKey")}]}}).inject(F),J=K("tbody").inject(F);if(!o.is(M)){throw ("Unable to find scrollListContainer")}M.addClassName("properties-sub-container-std");if(o.is(F)){var C=u.model.pairs();C.sort(function(R,Q){if(R[0]>Q[0]){return 1}else{if(R[0]<Q[0]){return -1}}return 0});var w=[],A=[],O=[],I=false;for(var H=0;H<C.length;H++){var P=C[H][0];var L=C[H][1];if(L){var B=P.match(/\/([^/]*)$/);if(B===null){B=P}else{B=B[1]}if(q.indexOf(P)===-1&&P.indexOf("_value")===-1&&(P.indexOf("ds6w:")!==-1||P.indexOf("ds6wg:")!==-1)&&w.indexOf(B)===-1){w.push(B);A.push(L);var N=p.getVocabId(B);if(o.is(N)){if(N.indexOf("ds6wg")!==-1){I=true}else{if(O.indexOf(N)===-1){if(!p.isLoaded(N)){O.push(N)}}}}}}}var v=function(){for(var S=0;S<w.length;S++){var R=p.getNLSValueForPredicate(w[S]);if(!o.is(R)||R===""){R=w[S]}var Q=K("tr",{html:{tag:"td",text:R}}).inject(J);var U="";var V=A[S];var T="";if(V instanceof Array){if(V.length>0){for(var W=0;W<V.length;W++){T+=u._HTMLDecode(V[W])+(W===V.length-1?"":" | ")}U=K("td",{title:T,text:T}).inject(Q)}}else{if(V.length>0){U=K("td",{title:u._HTMLDecode(V),text:u._HTMLDecode(V)}).inject(Q)}}}};if(I||O.length>0){var x=function(){if(O.length>0){var R=0;for(var Q=0;Q<O.length;Q++){p.loadVocabulary(O[Q],function(S){++R;if(R===O.length){v.call()}})}}else{v.call()}};if(I){var G=u.model.get("ds6w:what/ds6w:type_value");if(!o.is(G)){G=u.model.get("ds6w:type_value")}p._asyncCallToPredicatesWS(["ds6wg:"+G]).then(function z(Q){x.call()},function y(){x.call()})}else{x.call()}}else{v.call()}new n(M,{bounce:true,momentum:true,scrollableX:false,scrollbarH:false,scrollDrag:!(((m.Platform.windows||m.Platform.win32||m.Platform.win64)&&m.Engine.chrome&&!m.Features.touchEvents)||(m.Engine.ie&&m.Platform.tablet)),useNative:m.Engine.ie&&m.Platform.tablet,useTransform:(m.Platform.macintel||m.Platform.mac||m.Engine.ie)?false:n.prototype.defaultOptions.useTransform,scrollbar:{autoHide:false,opacity:1,padding:5,bgColor:"transparent",barColor:"#E2E4E3"},})}else{throw new Error("Cannot find element properties-tbody in the DOM")}}})},_getValueWithMapping:function(w,v,u){var x;if(w in u&&o.is(u[w],"function")){var y={model:v};x=u[w].call(y)}else{x=v.get(w);if(x===undefined){x=""}}return x}});d.facet_name=l;d.is_facet_avalailable=function(u){return true};d.facet_idcard=function(){return{text:h.get("skeleton.facets.properties"),icon:"doc-text",handler:c.getRendererHandler(l)}};d.facet_options=function(){return{view:d,collection:t,fetchMode:"never"}};return d});define("DS/SNResultUX/views/SearchGridView",["UWA/Core","UWA/Class/Options","UWA/Class/Listener","UWA/Class/View","DS/MessageBus/MessageBus","UWA/Class/Debug","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/views/EmptyView","DS/WebappsUtils/Performance","DS/W3DXComponents/Views/Plugins/Multisel","DS/SNInfraUX/SearchUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(l,e,i,d,c,j,k,f,m,b,a,h,g,n){return d.extend(e,j,h,{tagName:"div",className:"GridView",attributes:{styles:{width:"100%"},"data-rec-id":"GridView"},nestedView:null,_model:null,_viewRoot:null,_emptyView:null,_canMultiSelect:true,_columnsMaxNumber:0,_rowMaxNumber:0,_checkingMoreDate:false,_inAppsOptions:null,_lastselectedSearchId:null,_simpleSearch:false,_bOnDragStartState:false,_queueSkeletonMultiSel:null,init:function(o){this.setDebugMode(f.getDebugMode());var p=this;this.nestedView=this;this.collection=o.collection;this.initModel();p._canMultiSelect=o.selectionMode_techno!=="oneToOne";p._neverAction=o.neverAction;var q="";if(l.is(p.collection)&&l.is(p.collection.search_ressources)&&l.is(p.collection.search_ressources.getActiveTenant,"function")){q=p.collection.search_ressources.getActiveTenant()}if(g.isInTheSimpleSearch({tenant:q})===true){p._simpleSearch=true}this._parent(o);this._searchcom_socket=k.createSocket({socket_id:"search_grid_view_"+a.now(),widgetId:this.getOption("widgetId")});this._searchcom_socket.addListener("toggleMultiSelMode",this.toggleMultiSelMode.bind(this));this._queueSkeletonMultiSel=c.subscribe({channel:"Qchannel-searchgriview-"+this.className,topic:"Qtopic-searchgriview-disableMultiSelMode",callback:this._disableMultiSelMode.bind(this)})},initModel:function(o){var p=this;this._model=o||this.collection.getTreeDocument();this.modelEventTokenForOnAdd=this._model.getXSO().onAdd(function(q){p.onItemSelected(q)});this.modelEventTokenForOnRemove=this._model.getXSO().onRemove(function(q){p.onItemUnselected(q)});(this.view&&this.view._name==="GRIDENGINE")?this.view.loadGridViewModel&&this.view.loadGridViewModel(this._model):((this.view)?this.view.model=this._model:null);if(this.view&&this.view.getManager){this.view.getManager().loadDocument(this._model)}this.view&&"DataGridView"===this.className&&(this.view.treeDocument=this._model);if(this.view&&this.view.getManager){g.isFUNActive("FUN075064")&&this.initMultiCheckbox()}},onSearch:function(o){this._viewRoot=(this.collection._snSkeleton&&this.collection._snSkeleton._skeleton.getViewAt(0))?this.collection._snSkeleton._skeleton.getViewAt(0):{currentViewId:""}},onSwitch:function(o){this.checkToLoadMoreData()},onItemDblClick:function(p){var q=p.nodeModel?p.nodeModel._options.id:p._options.id;var o=this.collection.getSNSkeleton();if(UWA.is(o)){o.onItemDblClick(q)}},onItemSelected:function(o){var p=o._options.id;if(UWA.is(this.collection.getSNSkeleton())){(this._simpleSearch===true&&UWA.is(this._lastselectedSearchId)&&this._lastselectedSearchId===o._options.id)?this._searchcom_socket.dispatchEvent("onItemUnselected",p,this.collection.getSNSkeleton().getSocketID()):this._searchcom_socket.dispatchEvent("onItemSelected",p,this.collection.getSNSkeleton().getSocketID())}this._lastselectedSearchId=p},onItemUnselected:function(o){var p=o._options.id;this._lastselectedSearchId=null;if(UWA.is(this.collection.getSNSkeleton())){this._searchcom_socket.dispatchEvent("onItemSelected",p,this.collection.getSNSkeleton().getSocketID())}},onInfiniteScrollAsync:function(o,p){(o.reachBottom&&(this.collection.length<this.collection.totalCount))?this.collection._snSkeleton.loadMoreData(p,p):p&&p()},onResizeOrFirstLoaded:function(o,p){if(o){this._columnsMaxNumber=o.ColumnsMaxNumber;this._rowMaxNumber=o.RowMaxNumber;this.checkToLoadMoreData(p)}else{p&&p()}},checkToLoadMoreData:function(y){var t=this;var u=this.getMinNumberModel();var r=this.collection.length;var o=this.collection.state.pageSize;var v=this.collection.state.totalRecords;if(this.isCurrentView()&&this._checkingMoreDate===true){if(t._model&&l.is(t._model.getRoots())&&t._model.getRoots().length){r=t._model.getRoots().length}var w=v-r;var p=Math.min(w,u-r);var q=Math.ceil(p/o);if(w>=1){this._checkingMoreDate=false}}if(this.isCurrentView()&&!this._checkingMoreDate){var w=v-r;var p=Math.min(w,u-r);var q=Math.ceil(p/o);if(w>=1){t._checkingMoreDate=true;var x=function(){q--;if(q>=0){setTimeout(function(){t.collection._snSkeleton.loadMoreData(x,function(){console.warn("Failure load more Data!!")})},0)}else{t._checkingMoreDate=false;y&&y()}};x()}else{y&&y()}}else{y&&y()}},destroy:function(){this.stopListening(this.collection);if(l.is(this.modelEventTokenForOnAdd)&&l.is(this._model)&&l.is(this._model.getXSO,"function")&&l.is(this._model.getXSO())&&l.is(this._model.getXSO().unsubscribe,"function")){this._model.getXSO().unsubscribe(this.modelEventTokenForOnAdd);delete this.modelEventTokenForOnAdd}if(l.is(this.modelEventTokenForOnRemove)&&l.is(this._model)&&l.is(this._model.getXSO,"function")&&l.is(this._model.getXSO())&&l.is(this._model.getXSO().unsubscribe,"function")){this._model.getXSO().unsubscribe(this.modelEventTokenForOnRemove);delete this.modelEventTokenForOnRemove}this._model=null;this._searchcom_socket.removeListener("toggleMultiSelMode");this._searchcom_socket.disconnect();k.deleteSocket(this._searchcom_socket.id);this._searchcom_socket=null;this.collection=null;this._viewRoot=null;if(this._emptyView){this._emptyView.destroy();this._emptyView=null}c.unsubscribe(this._queueSkeletonMultiSel);this._parent()},setShadings:function(p){var q=this;if(this.collection&&this.collection.length&&this.view){var o=0;this.collection.forEach(function(u,t){if(!p){q._model.getNthRoot(t).options.color=""}else{for(var v=0;v<p.length;v++){if(p[v].criteria(u)){if(l.is(q._model.getNthRoot,"function")){var r=q._model.getNthRoot(t);if(l.is(r)){r.options.color=p[v].color}}}}}o++});q.updateView()}},updateView:function(){if(this.view){this.view.updateView&&this.view.updateView();this.view.invalidateLayout&&this.view.invalidateLayout({updateCellContent:true})}},isCurrentView:function(){if(this._viewRoot&&this._viewRoot.contentsViews){return this._viewRoot.contentsViews[this._viewRoot.currentViewId]===this}else{this._viewRoot=(this.collection._snSkeleton&&this.collection._snSkeleton._skeleton.getViewAt(0))?this.collection._snSkeleton._skeleton.getViewAt(0):{currentViewId:""};return true}},isMultiSelMode:function(){if(this.view._modeIsMultiSel!==undefined){var o=false;o=(l.is(this.view._isInMultiSelection,"function"))?this.view._isInMultiSelection():this.view.isInMultiSelection();return this.view.isInMultiSelection?o:this.view._interactiveCumulativeSelection}if(this.view.getManager){return this.view.getManager().isInMultiSelection()}},toggleMultiSelMode:function(o,q){var p=(o!==undefined&&o!==null)?o:!this.isMultiSelMode();this._model.search_multiselMode=p;if(this.view&&this.view._modeIsMultiSel!==undefined){if(this.view.activateInteractiveCumulativeSelection){p&&this.view.activateInteractiveCumulativeSelection();!p&&this.view.deactivateInteractiveCumulativeSelection()}else{this.view._modeIsMultiSel=p}}if(this.view&&this.view.getManager){this.view.getManager().forceMultiSelection(p);this.view.getManager()._multiSelModeHasBeenForced=false}if(this.isCurrentView()){!p&&this._model.getXSO().empty();var r=this._model.getXSO().get();if(UWA.is(this.collection.getSNSkeleton())){c.publish({channel:this.collection.getSNSkeleton().getOption("messagingChannel"),topic:"updateSelectionNumber",data:{number:r.length,isMultiSelMode:p}})}}},unSelectAll:function(){},_selectAll:function(o){},getOptionCommon:function(){var p=this;var o=this._canMultiSelect;return{model:this._model,pageScrollValueTriggeringInfiniteScroll:f.getOption("pageScrollValueTriggeringInfiniteScroll"),selection:{canMultiSelect:o,enableListSelection:o},enableActiveUI:true,enableKeyboardNavigation:true,infiniteScrolling:true,useSwipableMenu:false,onContextualEvent:{"this":p,callback:function(t,w){var z=f.getOption("search_compact_mode");if(p.options.neverAction===true){if(l.is(z)&&z===false){if(l.is(t)&&l.is(t.cellInfos)&&l.is(t.cellInfos.nodeModel)){var C=t.cellInfos.nodeModel._options._attributes.sourceid_value;if(l.is(C,"string")&&C.length>0){if(C.split(":")[0]==="3dspace"){console.log("onContextualEvent",w)}else{return}}}}else{return}}if(p._simpleSearch===true&&l.is(z)&&z===true){var q=true;if(UWA.is(t)&&UWA.is(t.forcemenu)&&t.forcemenu===true){q=false}if(q===true){return}}if(t){var D=t.cellInfos||t.treeview}if(UWA.is(p._inAppsOptions)){var r=p._inAppsOptions.UXOptions&&!p._inAppsOptions.UXOptions.localActions;if(r){return}}if(t&&D&&D.cellView){if(p.collection._snSkeleton&&D.cellView){p.collection._snSkeleton._ctxMenuTarget=D.cellView.getContent()}var u=[];var y=p;if(p.collection._snSkeleton){var x=p.collection._snSkeleton.ctxMenu;if(x&&x.isVisible){if(f.getOption("search_web_in_win")){p.collection._snSkeleton.ctxMenu.destroy()}else{p.collection._snSkeleton.ctxMenu.hide()}p.collection._snSkeleton.ctxMenu=null}}var E={};var B=("event" in window)?event:window.event;if(!B){if(t&&t.data&&t.data.windowPosition&&t.data.windowPosition.x&&t.data.windowPosition.y){var v=t.data.windowPosition;E.altPosition={x:v.x,y:v.y}}else{if(t&&t.data&&t.data.target){E.target=t.data.target}else{E.target=D.cellView.elements.container}}}else{if(B.clientX){E.altPosition={x:B.clientX,y:B.clientY}}else{E.target=B.target}}E.events={onHide:function(){this.destroy()},onClickOutside:function(){this.destroy()}};if(UWA.is(t)&&UWA.is(t.fromPreview)&&t.fromPreview===true){E.fromPreview=true;if(l.is(E)&&l.is(E.altPosition)){E.altPosition.y=E.altPosition.y+20}}var A=D.nodeModel||D.cellModel;p.launchContextMenu(A,E);return u}}},shouldAcceptDrag:function(r){if(UWA.is(p._inAppsOptions)){var q=p._inAppsOptions.UXOptions&&!p._inAppsOptions.UXOptions.dnD;return !q}return true},onDragStartCell:function(x,t){if(!l.is(t)||true===t.isHeader){x.preventDefault();x.stopPropagation();return}if(l.is(p._inAppsOptions)){var v=p._inAppsOptions.UXOptions&&!p._inAppsOptions.UXOptions.dnD;if(v){x.preventDefault();x.stopPropagation();return}}var q=[];var w=p._model.getXSO().get();if(l.is(w,"array")){w.forEach(function(A){var z=p._model.getRoots().indexOf(A);if(z>=0){var B=p.collection.get(A._options.id);if(B){q.push(B)}}})}if(q.length===0){var u=g.getDeviceCategory();if(["iphone","ipad","android"].indexOf(u)!==-1){if(l.is(t.cellModel)&&l.is(t.cellModel._options)&&l.is(t.cellModel._options.id)){var y=p.collection.get(t.cellModel._options.id);if(y){q.push(y)}}}}m.setDragData(x,{widgetId:p.getOption("widgetId"),draggedModels:q});var r=l.is(f.getOption("search_web_in_win"))?f.getOption("search_web_in_win"):false;if(!r){p._searchcom_socket.dispatchEvent("onDragStart")}},onDragEndCellDefault:function(t,r){var q=UWA.is(f.getOption("search_web_in_win"))?f.getOption("search_web_in_win"):false;if(!q){p._searchcom_socket.dispatchEvent("onReshow")}},onDragEndCell:function(t,r){var q=UWA.is(f.getOption("search_web_in_win"))?f.getOption("search_web_in_win"):false;if(!q){p._searchcom_socket.dispatchEvent("onReshow")}},height:"auto",allowUnsafeHTMLContent:true}},_afterRender:function(){var t=this;this.view.onPostCellRequest&&this.view.onPostCellRequest(this._onPostCellRequest.bind(this));var o=false;var q=false;var x=false;var v=f.getOption("search_compact_mode");if(t._simpleSearch===true){x=false;if(l.is(v)&&v===true){x=true}var r=g.identifyClientInfo();if(r.identifier==="3DSwym"){x=true}}this._inAppsOptions=this.collection.getSNSkeleton()&&this.collection.getSNSkeleton().getOption("in_apps_search");if(UWA.is(this._inAppsOptions)){q=this._inAppsOptions.UXOptions&&!this._inAppsOptions.UXOptions.dnD;o=this._inAppsOptions.UXOptions&&!this._inAppsOptions.UXOptions.localActions}this.view.onPostCellRequest&&this.view.onPostCellRequest(function(z){var y=null;if(o===true||x===true){y=z.cellView.elements.container.querySelector(".wux-controls-responsivethumbnailview-menu");if(!UWA.is(y)){y=z.cellView.elements.container.querySelector(".wux-controls-responsivetileview-menu")}if(!UWA.is(y)){y=z.cellView.elements.container.querySelector(".wux-controls-responsivetextualtileview-menu")}if(!UWA.is(y)){y=z.cellView.elements.container.querySelector(".wux-ui-3ds-open-down");if(y){y.style.display="none";y=undefined}}if(UWA.is(y)){y.setAttribute("has-menu","false")}}t._onPostCellRequest(z);if(q){z.cellView.elements.container.setAttribute("draggable","false")}});if(o===true){var w=this.view.displayedOptionalCellProperties;if(l.is(w,"array")){var u=w.indexOf("contextualMenu");if(-1<u){w.splice(u,1)}if(0===w.length){w.push("None")}}this.view.displayedOptionalCellProperties=w;if(this.view.getManager){this.view.options.columns[2].isHidden=true}}var p=t.collection.getSNSkeleton();if(p){p.refreshUIAfterRender()}this.checkToDisplayEmptyView()},_onPostCellRequest:function(q,o,p){if(l.is(q)&&l.is(o)&&l.is(p)){}},checkToDisplayEmptyView:function(){var o=false;if(this.collection&&this.collection._ctx_options&&this.collection._ctx_options.advanced_search&&this.collection._ctx_options.advanced_search.searchOnInit){o=true}if(!o&&(this.collection&&this.collection.service_parameters&&this.collection.service_parameters.adv_search&&!this.collection.service_parameters.advanced_criteria)){this.showEmptyView()}else{var p=this.collection.totalCount;if(p<=0&&l.is(this.collection)){p=this.collection.length}if(p<=0){this.showEmptyView()}else{if(l.is(this._emptyView)){this.hideEmptyView()}}}},hideEmptyView:function(){this._emptyView&&this._emptyView.hide();var o=null;if(l.is(this.collection)&&l.is(this.collection._snSkeleton)){if(l.is(this.collection._snSkeleton.options)&&l.is(this.collection._snSkeleton.options.observable)&&l.is(this.collection._snSkeleton.options.observable.getSearchContentSetHeader,"function")){o=this.collection._snSkeleton.options.observable.getSearchContentSetHeader()}if(!l.is(o)&&l.is(this.collection._snSkeleton._skeleton)&&l.is(this.collection._snSkeleton._skeleton.container)&&l.is(this.collection._snSkeleton._skeleton.container.getElement,"function")){o=this.collection._snSkeleton._skeleton.container.getElement(".search-content-set-header")}}if(l.is(o)){o.show();this._forcetoDisplayPreview()}},showEmptyView:function(){if(!l.is(this._emptyView)){var t=this.getOption("itemViewOptions");this._emptyView=new b(t)}var p=this.container;var o=this._emptyView.render();if(l.is(o)&&l.is(p)){o.inject(p);this._emptyView.show();if(l.is(o.container)&&l.is(o.container.getText,"function")){var r=o.container.getText();if(l.is(r)&&0===r.indexOf(n.get("no_result"))){var q=null;if(l.is(this.collection)&&l.is(this.collection._snSkeleton)&&l.is(this.collection._snSkeleton._skeleton)&&l.is(this.collection._snSkeleton._skeleton.container)&&l.is(this.collection._snSkeleton._skeleton.container.getElement,"function")){q=this.collection._snSkeleton._skeleton.container.getElement(".search-content-set-header")}if(l.is(q)){q.show();this._forcetoDisplayPreview()}}}}},_forcetoDisplayPreview:function(){if(l.is(this.collection._snSkeleton)&&l.is(this.collection._snSkeleton._previewState)&&l.is(this.collection._snSkeleton._informationPanel)&&this.collection._snSkeleton._informationPanel.getvisibleFlag()===false&&this.collection._snSkeleton._previewState===true){this.collection._snSkeleton._informationPanel.activate_deactivateNoPreview(true);this.collection._snSkeleton._informationPanel.switchvisibleFlag()}},launchContextMenu:function(x,A){var w=this;var r=w._model.getXSO().get();if(f.getOption("search_web_in_win")){var o={};if(r.indexOf(x)===-1){w.log('there might be an existing selection, but the "context" object is not there in it, clear the selection and use only the "context" object');w.collection._snSkeleton.resetMultisel();if(l.is(x)&&l.is(x._options)&&l.is(x._options.id)){var y=x._options.id;o.objets_name=[{id:y,session_object:w.collection.get(y).hasOwnProperty("session_object")}];w._model.getRoots()[x._localID]&&w._model.getRoots()[x._localID].select()}else{o.objets_name=[{id:"V_LocationWithoutSelectedObject",session_object:false}]}}else{w.log('there is a selection, and "context" object is one of them, use all the selected objects');if(w.collection.custoAction&&w.collection.custoAction.popover){w.collection.custoAction.popover.hide()}var z=[];for(var u=0;u<r.length;u++){var p=r[u]._options.id;z.push({id:p,session_object:w.collection.get(p).hasOwnProperty("session_object")})}o.objets_name=z}o.tabID=this.collection.getSNSkeleton().getOption("observable").getTabID(),w._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onActionClickDotted",notif_parameters:JSON.stringify(o)},"search_web_in_win")}else{if(r.indexOf(x)===-1){for(var u=0;u<r.length;u++){var v=w._model.getRoots().indexOf(r[u]);w._model.getNthRoot(v).unselect()}var p=w._model.getRoots().indexOf(x);(p!==-1)&&w._model.getRoots()[p].select()}if(f.getOption("actionsProtocol_FUN065512")){r=w._model.getXSO().get();var q=[];for(var u=0;u<r.length;u++){q.push(w.collection.get(r[u]._options.id))}var t=w.collection.getSNSkeleton();if(UWA.is(t)&&UWA.is(q,"array")&&q.length>=0){t.computeCtxActions2(q,A)}}}},setup:function(o){var p=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){p.checkToDisplayEmptyView();p.initModel();p.toggleMultiSelMode(false)},onSync:function(){p.checkToDisplayEmptyView();p._viewRoot=(p.collection._snSkeleton&&p.collection._snSkeleton._skeleton.getViewAt(0))?p.collection._snSkeleton._skeleton.getViewAt(0):{currentViewId:""};p.checkToLoadMoreData()},onInitTreeDocument:function(q,r){(true===r&&l.is(p.view)&&l.is(p.view.options)&&l.is(p.view.options.TreedocModel))?p.view.options.TreedocModel=null:null;p.initModel(q)},onInitTreeDocument_SelectFirstElt:function(q){if(l.is(p.view)&&l.is(p.view.model)){if(!l.is(p.view.getManager)&&"DataGridView"!==p.className){p.view.model.length>0&&(p.view.lastSelectedNode=p.view.model[0])}}},onError:function(){console.log("onError event received");p.checkToDisplayEmptyView()}});p.checkToDisplayEmptyView()},render:function(){this.log("GridView render");var o=this;o._viewRoot=(o.collection._snSkeleton&&o.collection._snSkeleton._skeleton.getViewAt(0))||{currentViewId:""};this.collection&&this.collection._snSkeleton&&this.collection._snSkeleton._modeIsMultiSel&&this.toggleMultiSelMode(true);return this},onItemTitleClick:function(q){var o=this;var t="";if(l.is(o.collection)&&l.is(o.collection.search_ressources)&&l.is(o.collection.search_ressources.getActiveTenant,"function")){t=o.collection.search_ressources.getActiveTenant()}if(g.isInTheSimpleSearch({tenant:t})===false&&m.getinformationPanel()===true){var r=q.nodeModel?q.nodeModel._options.id:q._options.id;var p=this.collection.getSNSkeleton();if(UWA.is(p)){p.onItemTitleClick(r)}}},_disableMultiSelMode:function(){if(!l.is(this.view)){return}if(l.is(this.view.deactivateInteractiveCumulativeSelection,"function")){this.view.deactivateInteractiveCumulativeSelection()}}})});define("DS/SNResultUX/utils/SearchCustoServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","require","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/PredefinedQueries","DS/SNResultUX/utils/SearchViewOptions","text!DS/SNInfraUX/assets/SearchColumnCustoDS.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(l,m,k,e,j,f,h,g,n,c,d,b,o){var a=function(q,p){var r=0;if(q.label>p.label){r=1}else{if(q.label<p.label){r=-1}}return r};var i=m.singleton(e,k,{name:"DS_SNResultUX_utils_SearchCustoServices",_adminCusto:null,_dsCusto:null,fixColumnSortable:["ds6w:label","ds6w:who/ds6w:responsible","ds6w:when/ds6w:created","ds6w:when/ds6w:modified","ds6w:responsible","ds6w:created","ds6w:modified"],init:function(){this.setDebugMode(f.getDebugMode());try{this._dsCusto=JSON.parse(b);this._addMissingPredicates(this._dsCusto);this._adminCusto=g.getAdminCustoDefinition();this._addMissingPredicates(this._adminCusto)}catch(p){console.error("Error parsing SearchColumnCustoAdmin.json:",p)}},_addMissingPredicates:function(q){if(l.is(q.SearchColumnCustoDSDefinition,"array")){for(var p=0;p<q.SearchColumnCustoDSDefinition.length;p++){var r=q.SearchColumnCustoDSDefinition[p].viewDefinition;this.addMandatoryPredicates(r)}}},addMandatoryPredicates:function(q){if(!l.is(q,"array")||0>=q.length){return}var u=["ds6w:identifier","ds6w:type"];for(var t=u.length-1;t>=0;t--){for(var p=0,r=q.length;p<r;p++){if(q[p].uri.endsWith(u[t])){u.splice(t,1);break}}}for(var t=u.length-1;t>=0;t--){q.push({uri:u[t],width:"auto"})}},getAvailableColumnCustomization:function(p){if(!l.is(p,"object")||!l.is(p.isPQ)){throw ("E_INVALIDARG: bad iContext given to getAvailableColumnCustomization method !")}var G=[];var N=h.getItem("DataGridColumnCusto");if(l.is(N,"object")&&l.is(N.views,"array")){var u=N.views;for(var z=0,E=u.length;z<E;z++){var M={label:u[z].viewId,value:u[z].viewId};if(0===u[z].viewId.indexOf("###")){var q=u[z].viewId.substring(3,u[z].viewId.length);var O;if(l.is(q,"string")&&q.length>0){var O=q;var t=c.getPQObjFromPQPrefix(q);var J=c.getPQNLS();if(l.is(J,"object")&&l.is(t,"object")&&l.is(t.pqid,"string")&&t.pqid.length>0&&l.is(J[t.pqid+".Title"],"string")&&J[t.pqid+".Title"].length>0){O=J[t.pqid+".Title"]}}M.label=o.replace(o.get("custo_PQ"),{PQ:O})}G.push(M)}G.sort(a)}var I=[];if(l.is(this._adminCusto,"object")&&l.is(this._adminCusto.SearchColumnCustoAdminDefinition,"array")){var P=this._adminCusto.SearchColumnCustoAdminDefinition;for(var z=0;z<P.length;z++){if(l.is(P[z].viewId,"string")&&P[z].viewId!=="The_Default_Columns"){var M={label:P[z].viewId,value:P[z].viewId+"-ADMIN"};if(0===P[z].viewId.indexOf("###")){if(l.is(P[z].viewDefinition,"array")){var q=P[z].viewId.substring(3,P[z].viewId.length);M.label=o.replace(o.get("custo_PQ"),{PQ:q})}else{if(l.is(P[z].custoAliasToUse,"string")){var r=P[z].viewId.substring(3,P[z].viewId.length);M.label=o.replace(o.get("custo_type"),{type:r})}}}I.push(M)}}I.sort(a)}if(G.length>0&&I.length>0){var v=o.get("SearchColumnCustoUserGroup"),B=o.get("SearchColumnCustoAdminGroup");for(var H=0,w=G.length;H<w;H++){G[H].group=v}for(var H=0,w=I.length;H<w;H++){I[H].group=B}}var x=G.concat(I);var y=false,A=false;var K=null;if(l.is(p.forcedCusto,"string")&&p.forcedCusto.length>0){K=p.forcedCusto}if(true===p.isPQ){if(l.is(p.typeName)&&l.is(p.typeName.pqName,"string")&&p.typeName.pqName.length>0){var D="###"+p.typeName.pqName;if(l.is(this._dsCusto,"object")&&l.is(this._dsCusto.SearchColumnCustoDSDefinition,"array")){var P=this._dsCusto.SearchColumnCustoDSDefinition;for(var z=0;z<P.length&&!A;z++){if(l.is(P[z].viewId,"string")){if(P[z].viewId===D&&(K===D)){A=true;K=D}}}}for(var z=0,E=x.length;z<E&&!y;z++){if((D===x[z].value||D+"-ADMIN"===x[z].value)){x[z].selected=true;y=true;K=D}}}if(l.is(p.typeName)&&l.is(p.typeName.pqName,"string")&&p.typeName.pqName.length>0){var L="###"+p.typeName.pqName;if(!l.is(K)||!K.startsWith(L)){if(l.is(this._dsCusto,"object")&&l.is(this._dsCusto.SearchColumnCustoDSDefinition,"array")){var P=this._dsCusto.SearchColumnCustoDSDefinition;for(var z=0;z<P.length;z++){if(l.is(P[z].viewId,"string")){if(P[z].viewId===L){K=L+"-HIDDEN";var M={label:"Customized PQ: "+p.typeName.pqName,value:K};x.push(M);break}}}}}if(!l.is(K)||!K.startsWith(L)){var C=d.getViewData();if(l.is(C)&&l.is(C.SearchColumnCustoDefinition)){var F=C.SearchColumnCustoDefinition;if(l.is(F)){if(l.is(F.viewId,"string")){if(F.viewId===L){K=L+"-HIDDEN";var M={label:"Customized PQ: "+p.typeName.pqName,value:K};x.push(M)}}}}}}}if(!y&&!A&&l.is(N,"object")&&l.is(N.activeView,"string")){if(p.isPQ&&(!l.is(p.forcedCusto,"string")||p.forcedCusto.length<=0)){if(!l.is(K)){K=N.activeView}}else{if(p.isPQ&&(l.is(p.forcedCusto,"string")&&p.forcedCusto.length>0)){K=p.forcedCusto}else{K=N.activeView}}for(var z=0,E=x.length;z<E&&!y;z++){if(K===x[z].value){x[z].selected=true;y=true}}}return x},getColumnCustomizationAliasIdToUse:function(t){var u="###"+t;if(l.is(this._adminCusto,"object")&&l.is(this._adminCusto.SearchColumnCustoAdminDefinition,"array")){var r=this._adminCusto.SearchColumnCustoAdminDefinition;for(var p=0;p<r.length;p++){if(l.is(r[p].viewId,"string")){if(r[p].viewId===u){var q=r[p].custoAliasToUse;if(l.is(q)){break}}}}}return q},getColumnCustomizationIdToUse:function(y){var v=i.getAvailableColumnCustomization(y);var q="The_Default_Columns";if(l.is(v,"array")&&v.length){for(var x=0,t=v.length;x<t;x++){if(l.is(v[x].selected)&&true===v[x].selected){q=v[x].value;break}}}if(true===y.isPQ){if(l.is(y.typeName)&&l.is(y.typeName.pqName,"string")&&y.typeName.pqName.length>0){var r="###"+y.typeName.pqName;if(!q.startsWith(r)){if(l.is(this._dsCusto,"object")&&l.is(this._dsCusto.SearchColumnCustoDSDefinition,"array")){var p=this._dsCusto.SearchColumnCustoDSDefinition;for(var z=0;z<p.length;z++){if(l.is(p[z].viewId,"string")){if(p[z].viewId===r){q=r+"-HIDDEN";break}}}}}if(!q.startsWith(r)){var u=d.getViewData();if(l.is(u)&&l.is(u.SearchColumnCustoDefinition)){var w=u.SearchColumnCustoDefinition;if(l.is(w)){if(l.is(w.viewId,"string")){if(w.viewId===r){q=r+"-HIDDEN"}}}}}}}return q},getColumnCustomizationDefinitionFromCustoId:function(F,J){var u=this;var I=[];var q=[];q=u._getDefaultColumnsForInApps(J);var G=[];for(var E=0,v=q.length;E<v;E++){G.push(q[E].dataIndex)}if("The_Default_Columns"===F){q=u._getDefaultColumns()}else{var H=l.clone(h.getItem("DataGridColumnCusto"));if(l.is(H,"object")&&l.is(H.views,"array")){var r=H.views;for(var E=0,v=r.length;E<v;E++){if(F===r[E].viewId){if(l.is(r[E].viewDefinition,"array")&&0<r[E].viewDefinition.length){q=r[E].viewDefinition;break}}}}if(!l.is(I,"array")||0===I.length){var r=this._adminCusto.SearchColumnCustoAdminDefinition;var w=this._adminCusto.CustoAliasDefinitions;for(var E=0,v=r.length;E<v;E++){if(F===r[E].viewId+"-ADMIN"){if(l.is(r[E].viewDefinition,"array")){I=l.clone(r[E].viewDefinition)}else{if(l.is(w,"array")&&0<w.length){for(var D=0,p=w.length;D<p;D++){if(w[D].aliasId===r[E].custoAliasToUse){I=l.clone(this._adminCusto.CustoAliasDefinitions[D].viewDefinition)}}}}if(l.is(I,"array")){for(var A=0;A<I.length;A++){I[A].dataIndex=I[A].uri;var t=I[A].uri.indexOf(":"),x=I[A].uri.indexOf(".");var C=null;if(t>0&&x>0&&x>t){C=I[A].uri.substring(0,x)}I[A].dataType=C;I[A].isSortable=true;I[A].minWidth=40;I[A].text=n.getNLSValueForPredicate(I[A].uri);I[A].visibility=true;I[A].visibilityEditable=false;var z=parseInt(I[A].width,10);if(isNaN(z)){I[A].width="auto"}else{I[A].width=z}}q=I}break}}}if(!l.is(I,"array")||0===I.length){var r=this._dsCusto.SearchColumnCustoDSDefinition;for(var E=0,v=r.length;E<v;E++){if(F===r[E].viewId+"-HIDDEN"){I=l.clone(r[E].viewDefinition);if(l.is(I,"array")){for(var A=0;A<I.length;A++){I[A].dataIndex=I[A].uri;var t=I[A].uri.indexOf(":"),x=I[A].uri.indexOf(".");var C=null;if(t>0&&x>0&&x>t){C=I[A].uri.substring(0,x)}I[A].dataType=C;I[A].isSortable=true;I[A].minWidth=40;I[A].text=n.getNLSValueForPredicate(I[A].uri);I[A].visibility=true;I[A].visibilityEditable=false;var z=parseInt(I[A].width,10);if(isNaN(z)){I[A].width="auto"}else{I[A].width=z}if(G.indexOf(I[A].dataIndex)==-1){q.push(I[A])}}}break}}}if(!l.is(I,"array")||0===I.length){var B=null;var y=d.getViewData();if(l.is(y)&&l.is(y.SearchColumnCustoDefinition)){B=d.getViewData().SearchColumnCustoDefinition}if(B){if(F===B.viewId+"-HIDDEN"){I=l.clone(B.viewDefinition);if(l.is(I,"array")){for(var A=0;A<I.length;A++){I[A].dataIndex=I[A].uri;var t=I[A].uri.indexOf(":"),x=I[A].uri.indexOf(".");var C=null;if(t>0&&x>0&&x>t){C=I[A].uri.substring(0,x)}I[A].dataType=C;I[A].isSortable=true;I[A].minWidth=40;I[A].text=n.getNLSValueForPredicate(I[A].uri);I[A].visibility=true;I[A].visibilityEditable=false;var z=parseInt(I[A].width,10);if(isNaN(z)){I[A].width="auto"}else{I[A].width=z}if(G.indexOf(I[A].dataIndex)==-1){q.push(I[A])}}}}}}}if(l.is(q)){for(var E=0,v=q.length;E<v;E++){if(l.is(q[E])&&l.is(q[E].dataIndex,"string")){q[E].dataIndex=g.getURIToUse(q[E].dataIndex)}}}return q},getColumnCustomizationDefinitionFromAliasCustoId:function(r){var x=this;var v=[];var z=[];if(!l.is(r,"string")||0===r.length){throw new Error("Invalid Arg in SearchCustoServices.getColumnCustomizationDefinitionFromAliasCustoId!")}v=x._getDefaultColumnsForInApps();var p=[];for(var u=0,w=v.length;u<w;u++){p.push(v[u].dataIndex)}if(l.is(this._adminCusto)){var D=this._adminCusto.CustoAliasDefinitions;if(l.is(D)){for(var u=0,w=D.length;u<w;u++){if(r===D[u].aliasId){var y=l.clone(D[u]);if(l.is(y.viewDefinition,"array")){z=y.viewDefinition;for(var C=0;C<z.length;C++){z[C].dataIndex=z[C].uri;var B=z[C].uri.indexOf(":"),t=z[C].uri.indexOf(".");var A=null;if(B>0&&t>0&&t>B){A=z[C].uri.substring(0,t)}z[C].dataType=A;z[C].isSortable=true;z[C].minWidth=40;z[C].text=n.getNLSValueForPredicate(z[C].uri);z[C].visibility=true;z[C].visibilityEditable=false;var q=parseInt(z[C].width,10);if(isNaN(q)){z[C].width="auto"}else{z[C].width=q}if(p.indexOf(z[C].dataIndex)==-1){v.push(z[C])}}}break}}}}return v},getColumnCustomizationDefinitionFromCustoIdWithNLSUpdated:function(t,w){var y=this;var z=this.getColumnCustomizationDefinitionFromCustoId(t);if(l.is(w,"function")){var H={};var E=["ds6wg:PLMEntity"];var p={vocabIds:[]};for(var D=0,q=z.length;D<q;D++){if(z[D].dataIndex.startsWith("ds6wg")){if(l.is(z[D].dataType)&&!l.is(H[z[D].dataType])){H[z[D].dataType]=true;E.push(z[D].dataType)}else{var r=z[D].dataIndex;var G=r.indexOf(".");if(G>0){r=z[D].dataIndex.slice(0,G);if(!l.is(H[z[D].dataType])){H[r]=true;E.push(r)}}}}else{var C=z[D].dataIndex;var A=n.getVocabId(C);if(l.is(A)){if(!n.isLoaded(A)){if(-1===p.vocabIds.indexOf(A)){p.vocabIds.push(A);p[A]=[]}p[A].push(C)}}z[D].text=n.getNLSValueForPredicate(z[D].dataIndex)}}var x=p.vocabIds.length;if(x>0){for(var B=0;B<x;B++){var A=p.vocabIds[B];n.loadVocabulary(A,function(v){if(l.is(v)&&v.status==="success"){var J=p[v.id];if(l.is(J)){for(var N=0;N<J.length;N++){var M=J[N];var L=n.getNLSValueForPredicate(M)}var K=z.length;for(var I=0;I<K;I++){var M=z[I].dataIndex;if(-1!==J.indexOf(M)){z[I].text=n.getNLSValueForPredicate(M)}}}}else{console.warn("Error in PredicatesNLS.loadVocabulary !")}})}}if(E.length>0){n._asyncCallToPredicatesWS(E).then(function F(K){if(!l.is(K.classPredicates)){console.error("Unexpected response from GetRelevantPredicates !");return null}var R=false;for(var Q=0,I=z.length;Q<I;Q++){if(z[Q].dataIndex.startsWith("ds6wg:")){for(var J=0,P=K.classPredicates.length;J<P;J++){if(!l.is(K.classPredicates[J].className)||!l.is(K.classPredicates[J].vocabularyPredicateInfo)){console.error("Unexpected response from GetRelevantPredicates !");return null}for(var O=0,v=K.classPredicates[J].vocabularyPredicateInfo.length;O<v;O++){if(K.classPredicates[J].vocabularyPredicateInfo[O].uri===z[Q].dataIndex){if(z[Q].text!==K.classPredicates[J].vocabularyPredicateInfo[O].nlsName){z[Q].text=K.classPredicates[J].vocabularyPredicateInfo[O].nlsName;R=true}O=v;J=P}}}}}var M={};for(var L=0,N=z.length;L<N;L++){if(!l.is(M[z[L].text])){M[z[L].text]=0}M[z[L].text]+=1}for(var L=0,N=z.length;L<N;L++){if(l.is(M[z[L].text])&&M[z[L].text]>1){z[L].text+=" ("+z[L].dataType+")";R=true}}w.call(undefined,z)},function u(){console.log("promisePredicate fail !");w.call(undefined,z)})}else{w.call(undefined,z)}}},_computeColToDisplayInCustoPanel:function(F,t){var B=[];if(!l.is(F,"array")||!l.is(t,"array")){console.error("Bad args in _computeColToDisplayInCustoPanel !");return B}var G={};for(var C=0,r=F.length;C<r;C++){if(!l.is(G[F[C].dataIndex])){var x=F[C].dataIndex;G[x]=true;G[x.slice(x.lastIndexOf("/")+1,x.length)]=true;var A=F[C];A.visibility=true;A.visibilityEditable=true;var E=false;for(var u=0,v=t.length;u<v&&!E;u++){if(A.text===t[u].dispValue||A.uri===t[u].sixw){E=true;A.dataType=t[u].relatedObjectType;A.name=t[u].name;A.text=t[u].dispValue;A.type=t[u].type}}B.push(A)}}var w=[];for(var z=0,q=t.length;z<q;z++){if(l.is(t[z].sixw)&&!l.is(G[t[z].sixw])){G[t[z].sixw]=true;w.push({dataIndex:t[z].sixw,dataType:t[z].relatedObjectType,name:t[z].name,text:(l.is(t[z].dispValue,"string")&&t[z].dispValue.length>0)?t[z].dispValue:n.getNLSValueForPredicate(t[z].sixw),isSortable:false,minWidth:40,width:"auto",type:t[z].type,visibility:false,visibilityEditable:true})}}var y=["ds6w:identifier","ds6w:type"];var D=0,p=0,C=0;for(D=0,p=B.length;D<p;D++){for(C=y.length-1;C>=0;C--){if(B[D].dataIndex===y[C]||B[D].dataIndex==="ds6w:what/"+y[C]){y.splice(C,1);B[D].visibility=true;B[D].visibilityEditable=false}}}for(D=0,p=w.length;D<p;D++){for(C=y.length;C>=0;C--){if(w[D].dataIndex===y[C]){y.splice(C,1);w[D].visibility=true;w[D].visibilityEditable=false}}}for(C=0;C<y.length;C++){w.push({dataIndex:y[C],dataType:null,name:y[C],text:n.getNLSValueForPredicate(y[C]),isSortable:false,minWidth:40,width:"auto",visibility:true,visibilityEditable:false})}w.sort(function(I,H){var J=0;if(I.text.toUpperCase()>H.text.toUpperCase()){J=1}else{if(I.text.toUpperCase()<H.text.toUpperCase()){J=-1}}return J});B=B.concat(w);return B},_getDefaultColumns:function(){var p=d.getDataGridViewHeaders();this._completeColumnDefinition(p);return p},_getDefaultColumnsForInApps:function(p){var q=d.getDataGridViewHeadersForInApps();this._completeColumnDefinition(q);return q},_completeColumnDefinition:function(q){var r=this;var p=h.getItem("listColumnsWidth");if(p){try{var u=JSON.parse(p);var v=Object.keys(u);q.forEach(function(w){w.width=(v.indexOf(w.dataIndex)===-1)?"auto":u[w.dataIndex];w.isSortable=r.isColumnSortable(w.dataIndex);w.sortableFlag=w.isSortable;w.editableFlag=false})}catch(t){console.log(t)}}else{q.forEach(function(w){w.width="auto";w.isSortable=r.isColumnSortable(w.dataIndex);w.sortableFlag=w.isSortable;w.editableFlag=false})}},isColumnSortable:function(p){return -1!==this.fixColumnSortable.indexOf(p)}});return i});define("DS/SNResultUX/utils/SearchDataGridPreferences",["css!DS/SNResultUX/SNResultUX.css","UWA/Core","UWA/Event","UWA/Class","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Events","DS/Spreadsheet/DataGrid","DS/Logger/Logger","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Spinner","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/UIKIT/Popover","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/PredefinedQueries","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchCustoServices","DS/Controls/Button","DS/Windows/Dialog","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(x,q,B,y,A,d,m,g,z,p,h,k,e,i,t,u,w,v,r,o,n,l,j,c,f){var b=null;var a=y.extend(m,A,d,{name:"SearchDataGridPreferences",_logger:null,_divCombo:null,_divGrid:null,_divFooter:null,defaultOptions:{spreadsheet:null,preferences_grid:null,move_to_do:null},gridInitValues:null,gridFinalValues:null,_columnCustoPreferenceDefinition:null,_custoCombo:null,_unmodifiedCusto:false,_predicateIntersection:null,_typeToHandle:null,_bFav:null,_bFavTooltip:null,_bDel:null,_bDelTooltip:null,_custoNameEdt:null,_zIndexToUse:0,init:function(C){if(b){b.destroy();b=null}this.gridInitValues=q.clone(C.availableColumns);this.gridFinalValues=q.clone(C.availableColumns);this._predicateIntersection=q.clone(C.predicateIntersection);this._typeToHandle=q.clone(C.typeToHandle);if(q.is(C.zIndexToUse)){this._zIndexToUse=C.zIndexToUse}this._logger=z.getLogger(a.prototype);this._logger.log("init");this._parent(C);this.setOptions(C);this._thingsToApply={};this._buildView();this._fillView()},destroy:function(){this.beingDestroyed=true;if(this._bFavTooltip){this._bFavTooltip.destroy()}this._bFavTooltip=null;if(this._bDelTooltip){this._bDelTooltip.destroy()}this._bDelTooltip=null;this._columnCustoPreferenceDefinition=null;this.gridInitValues=null;this.gridFinalValues=null;this._custoCombo=null;this._predicateIntersection=null;this._typeToHandle=null;this._bFav=null;this._bDel=null;this.defaultOptions=null;this._divCombo=null;this._divGrid=null;this._divFooter=null;if(q.is(b)){b.destroy();b=null}this._custoNameEdt=null;this._parent()},_buildView:function(){var E=this;if(!q.is(this._typeToHandle.typeName)){console.error("!UWACore.is(me._typeToHandle.typeName)")}this._logger.log("_buildView");var D=new UWA.Element("div",{"class":"global-column-custo-div"});this._divCombo=new UWA.Element("div",{"class":"column-custo-combo-div"});this._divCombo.inject(D);this._divGrid=new UWA.Element("div",{"class":"column-custo-grid-div"});this._divGrid.inject(D);this._divFooter=new UWA.Element("div",{"class":"column-custo-footer-div"});this._divFooter.inject(D);var G="";if(false===this._typeToHandle.isPQ){G=f.replace(f.get("SearchDataGridPreferences_modal_title"),{typeName:this._typeToHandle.typeName})}else{var C=this._typeToHandle.typeName.pqNLS;G=f.replace(f.get("SearchDataGridPreferences_modal_title_PQ"),{typeName:C})}var F=document.getElementsByClassName("onesearch_results onesearch_results-root maximized")[0];b=new c({identifier:"ColumnCustoPanel",title:G,content:D,resizableFlag:true,position:{at:"100 50",of:this.options.searchDatagridView.container,collision:"fit"},minHeight:440,minWidth:550,});b.elements.container.setStyle("z-index",parseInt(this._zIndexToUse)+1);b.elements.container.addClassName("search-column-custo-dialog");b.addEventListener("close",function(H){b=null;E.dispatchEvent("onCloseColumnCustomizationPanel")});b.inject(document.body);if(q.is(b.elements)&&q.is(b.elements._closeButton)){this._bCloseTooltip=new u({target:b.elements._closeButton,body:f.get("custo_close.tooltip"),});this._bCloseTooltip.getContent().style.zIndex=this._zIndexToUse+2}this._createFooter()},_createFooter:function(){this._logger.log("_createFooter");this._divFooter.innerHTML="";var E=this,F=new h({value:f.get("SearchDataGridPreferences_modal_apply"),className:"primary apply-button",id:"apply_customization_btn",events:{onClick:function(){E._logger.log("Click on apply Customization");if(E.options.move_to_do!==null){E.options.preferences_grid.getManager().getRows().forEach(function(G){E.options.move_to_do.push(G[0].options.value)})}if(E._unmodifiedCusto===true){E._applySetting(E._custoCombo.getValue()[0],false)}else{E._applySetting("TEMP_CUSTO",true)}E._requestClosePanel()}}}).inject(this._divFooter),D=new h({value:f.get("SearchDataGridPreferences_modal_reset"),className:"primary reset-button",id:"reset_customization_btn",events:{onClick:function(){E._logger.log("Click on reset Customization");E._applyReset();E._requestClosePanel()}}}).inject(this._divFooter),C=new h({value:f.get("SearchDataGridPreferences_modal_save"),className:"primary save-button",id:"save_customization_btn",events:{onClick:function(){E._logger.log("Click on save Customization");if(E.options.move_to_do!==null){E.options.preferences_grid.getManager().getRows().forEach(function(G){E.options.move_to_do.push(G[0].options.value)})}E._saveSetting(C);E._custoNameEdt.setFocus(true)}}}).inject(this._divFooter);return this._divFooter},_saveSetting:function(D){var H=this;var F,G;function J(V){var T=false,R="",Q=false,L=false,P=false,U="";if(V.endsWith("-ADMIN")||V.endsWith("-HIDDEN")){T=true;R=".InvalidCustoName";if(V.endsWith("-ADMIN")){U="-ADMIN"}else{if(V.endsWith("-HIDDEN")){U="-HIDDEN"}}P=true}var M=l.getAvailableColumnCustomization(H._typeToHandle);if(q.is(M,"array")&&M.length>0){for(var N=0,O=M.length;N<O&!T;N++){if(M[N].value===V){T=true;R=".AlreadyExistingCusto";Q=true;L=true}}}if(true==T){var S=new p({renderTo:document.body,className:"WarningSaveCustoDlg"});var K=[];if(Q){K.push({classname:"primary",id:"YesReplaceBtn",value:f.get("SearchColumnCusto.Warning.YES"),action:function(W){H._applySetting(V,true);W.destroy();H._requestClosePanel()}})}if(L){K.push({classname:"primary",id:"NoReplaceBtn",value:f.get("SearchColumnCusto.Warning.NO"),action:function(W){H._custoNameEdt.setFocus(true);W.destroy()}})}if(P){K.push({classname:"primary",id:"OKReplaceBtn",value:f.get("SearchColumnCusto.Warning.OK"),action:function(W){H._custoNameEdt.setFocus(true);W.destroy()}})}S.dialog({body:f.replace(f.get("SearchColumnCusto"+R+".Msg"),{columnCustoName:V,INVALID_EXT:U}),title:f.get("SearchColumnCusto"+R+".Title"),buttons:K})}else{H._applySetting(V,true);H._requestClosePanel()}}var I=q.createElement("div",{"class":"saveDiv"});H._custoNameEdt=new t({className:"SearchDataGridPreferences_txt",id:"CustomizationNameEdt",placeholder:f.get("SearchDataGridPreferences_modal_saveEditor"),attributes:{events:{keydown:function(K){F.setDisabled(false)},}},events:{onKeyDown:function(K){if(13==K.keyCode){if(this.getValue().length>0){F.setDisabled(false);if(H._custoCombo.getValue()!==this.getValue()){J(this.getValue())}}}}}});var C=this._custoCombo.getValue()[0];if(C&&C.length>0){if(!C.endsWith("-ADMIN")&&!C.startsWith("###")){H._custoNameEdt.setValue(C)}else{H._custoNameEdt.setValue(f.get("SearchColumnCustoDefaultNameForSave"));H._custoNameEdt.setFocus(true)}}var E=q.createElement("div",{"class":"btnDiv"});F=new h({value:f.get("SearchDataGridPreferences_save_ok"),className:"primary ok-button",id:"ok_save_custo",events:{onClick:function(){var L=H._custoNameEdt.getValue();var K=H._custoCombo.getValue()[0];if(K!==L){J(L)}else{H._applySetting(L,true);H._requestClosePanel()}}}});G=new h({value:f.get("SearchDataGridPreferences_save_cancel"),className:"primary cancel-button",id:"cancel_save_custo",events:{onClick:function(){H._createFooter()}}});H._custoNameEdt.inject(I);E.inject(I);F.inject(E);G.inject(E);this._divFooter.innerHTML="";I.inject(this._divFooter);if(C.length==0){F.setDisabled(true)}},_applySetting:function(E,G){this._logger.log("_applySetting");var F=[];for(var D=0,C=this.gridFinalValues.length;D<C;D++){var H=this.gridFinalValues[D];if(true===H.visibility){F.push({dataIndex:H.dataIndex,name:(q.is(H.name,"string")&&H.name.length>0)?H.name:null,dataType:H.dataType,text:H.text,width:H.width,type:H.type,isSortable:false,minWidth:40})}}this.options.searchDatagridView._updateColumns(F,E,G)},_applyReset:function(){var D=this._typeToHandle;if(q.is(D)){D.forcedCusto="The_Default_Columns"}v.setItem("listColumnsWidth","");v.commit();var C=l.getColumnCustomizationIdToUse(D);this.options.searchDatagridView._updateColumns(l.getColumnCustomizationDefinitionFromCustoId(C),C,false)},displayCusto:function(F){this._logger.log("displayCusto");if(!q.is(this.options.preferences_grid)){return}this.options.preferences_grid.getManager().empty();if(F===f.get("SearchDataGridPreferences_modal_unsavedCusto")){F="TEMP_CUSTO"}var E=[];var D=[];D=(q.is(F)&&F.length>0)?l.getColumnCustomizationDefinitionFromCustoId(F):this.options.searchDatagridView._columnsAttributes;this.gridFinalValues=l._computeColToDisplayInCustoPanel(D,this._predicateIntersection);for(var G=0,C=this.gridFinalValues.length;G<C;G++){E.push({colName:this.gridFinalValues[G].text,colWidth:this.gridFinalValues[G].width,origin_dataIndex:this.gridFinalValues[G].dataIndex,colVisibility:{isHidden:!this.gridFinalValues[G].visibility,isRemovable:true}})}this.options.preferences_grid.getManager().addRows(E);this.options.preferences_grid.getManager()._setColumnsWidth()},_fillView:function(){this._logger.log("_fillView");var C=[];var F=this.options.spreadsheet;var E=this.options.availableColumns;var H=this;E.forEach(function(N,L){if(N.isInPreference!==false){var K=N.text===""?(f["SearchDataGridPreferences_modal_"+N.dataIndex]?f["SearchDataGridPreferences_modal_"+N.dataIndex]:N.dataIndex):N.text;var J={colName:K,colColor:"#000000",colBackgroundColor:"#FFFFFF",colExport:N["export"],colWidth:N.width,origin_dataIndex:N.dataIndex};if(true!==H.options.isNewDataGrid){var M=F.getManager().getColumnIDFromDataIndex(N.dataIndex);if(q.is(M)){J.colVisibility={isHidden:F.getManager().isColumnHidden(M),isRemovable:(q.is(N.isRemovable)&&false==N.isRemovable)?false:true};J.colWidth=F.getManager().getColumnWidth(N.dataIndex)}else{J.colVisibility={isHidden:true,isRemovable:true}}}else{if(true===H.options.isNewDataGrid){if(undefined!==F.layout.getColumnIndex(N.dataIndex)){J.colVisibility={isHidden:!N.visibility,isRemovable:(q.is(N.visibilityEditable)&&false==N.visibilityEditable)?false:true};J.colWidth=N.width}else{J.colVisibility={isHidden:true,isRemovable:true}}}}C.push(J)}});this.options.preferences_grid=new g({enableScrollOnDrag:true,columns:[{dataIndex:"origin_dataIndex",width:0,idHidden:true},{text:f.get("SearchDataGridPreferences_modal_header_name"),dataIndex:"colName",width:"auto",minWidth:40,isDraggable:true},{text:f.get("SearchDataGridPreferences_modal_visible_column"),dataIndex:"colVisibility",width:80,minWidth:40},{text:f.get("SearchDataGridPreferences_modal_width"),dataIndex:"colWidth",width:80,minWidth:40}],data:C,defaultCellHeight:40,headersDimensions:{height:40},selection:{cells:false},show:{rowHeaders:true,columnHeaders:true},height:"auto",apiVersion:2,resize:{columns:true},isEditable:{switchToWriteView:{event:"dblclick",callback:function(J){this.switchToWriteView()},view:function(K){switch(K.dataIndex){case"colName":return new q.Element("div",{html:H.gridFinalValues[K.virtualRowID].text});case"colWidth":var J=H.gridFinalValues[K.virtualRowID].width;if(H.gridFinalValues[K.virtualRowID].width==="auto"){J=f.get("SearchColumnCusto.AutoSize")}return new q.Element("input",{type:"text",placeholder:J,events:{change:function(O){O.stopPropagation();var N=K.cellModel.getRowID();var L=K.manager.getCellModel(N,0).getCellContent();var M=this.value;if(isNaN(M)===false){M=parseInt(M,10);H.gridFinalValues[K.virtualRowID].width=M}else{H.gridFinalValues[K.virtualRowID].width="auto";this.value=f.get("SearchColumnCusto.AutoSize")}H._unmodifiedCusto=false}}})}},},switchToReadView:{event:"blur",callback:function(J){this.switchToReadView()},view:function(O){if(q.is(H.beingDestroyed)&&H.beingDestroyed==true){return}switch(O.dataIndex){case"colVisibility":var L=(q.is(H.gridFinalValues[O.virtualRowID])&&true==H.gridFinalValues[O.virtualRowID].visibilityEditable)?false:true;if("ds6w:what/ds6w:type"==H.gridFinalValues[O.virtualRowID].dataIndex||"ds6w:what/ds6w:identifier"==H.gridFinalValues[O.virtualRowID].dataIndex){L=true}var K=new k({type:"switch",label:"",value:"",disabled:L,events:{onChange:function(Q){Q.stopPropagation();var P=this.isChecked();O.cellModel.setCellContent({isHidden:!P,isRemovable:true});H.gridFinalValues[O.virtualRowID].visibility=P;H._unmodifiedCusto=false}}});var N=O.cellModel.getCellContent();if(N.isHidden===false){K.check()}if(N.isRemovable===false){K.disable()}return K;case"colWidth":var J=H.gridFinalValues[O.virtualRowID].width;if(isNaN(H.gridFinalValues[O.virtualRowID].width)===true){J=f.get("SearchColumnCusto.AutoSize")}return new q.Element("div",{text:J});case"colName":var M;if(q.is(H.gridFinalValues,"array")&&q.is(O.virtualRowID)){M=H.gridFinalValues[O.virtualRowID].text}return new q.Element("div",{html:M,attributes:{"data-index":H.gridFinalValues[O.virtualRowID].dataIndex},"class":"cell-grid"});default:break}},}},shouldAcceptDrag:function(L){var K=L.cellModel.getRowID();var J=L.manager.getCellModel(K,0).getCellContent();if(L.virtualRowID===-1){return false}else{if(L.virtualColumnID!==-1){return false}else{return true}}},onDragStart:function(J,M,L,K){},onDrop:function(J,M,L,K){return true},isSortable:false});this.options.preferences_grid.getContent().addClassName(this.name);this.options.preferences_grid.getContent().setAttribute("nbcells",C.length);this._bDel=new h({icon:"trash",id:"delete_custo_btn"}).inject(H._divCombo);this._custoCombo=new i({nativeSelect:true,id:"custo_selection",placeholder:f.get("dataGrid.columnCustoPanel.existingCustoComboPlaceHolder"),events:{onChange:function(){var J=this.getValue(),K="";if(q.is(J,"array")&&J.length>0){K=J[0]}if(0==K.length){return}H.displayCusto(K);H._unmodifiedCusto=true;if(q.is(H.options.preferences_grid)){H.options.preferences_grid.getManager().updateView(true)}if(q.is(H._bDel)){if(K.length>0&&!K.endsWith("-ADMIN")){H._bDel.show()}else{H._bDel.hide()}}}}}).inject(H._divCombo);if(q.is(H.options.searchDatagridView._forcedCustoView,"string")){H._typeToHandle.forcedCusto=H.options.searchDatagridView._forcedCustoView}var D=l.getAvailableColumnCustomization(H._typeToHandle);this._columnCustoPreferenceDefinition=v.getItem("DataGridColumnCusto");this._custoCombo.add(D);if(q.is(H._typeToHandle.isPQ)&&true===H._typeToHandle.isPQ){this._bFav=new h({icon:"star",id:"associate_to_pq"});this._bFavTooltip=new u({target:this._bFav.getContent(),body:f.get("custo_favorite.tooltip")});this._bFavTooltip.getContent().style.zIndex=this._zIndexToUse+2;this._bFav.inject(H._divCombo);this._bFav.addEvent("onClick",function(){H._applySetting({custoName:H._typeToHandle.typeName.pqName,custoId:"###"+H._typeToHandle.typeName.pqName,custoNLS:H._typeToHandle.typeName.pqNLS,favPQ:true},true);H._requestClosePanel()})}this._bDelTooltip=new u({target:this._bDel.getContent(),body:f.get("custo_delete.tooltip")});this._bDelTooltip.getContent().style.zIndex=this._zIndexToUse+2;this._bDel.inject(H._divCombo);this._bDel.addEvent("onClick",function(){var J=H._custoCombo.getValue()[0];if(q.is(J,"string")&&J.length>0){if(q.is(H._columnCustoPreferenceDefinition,"object")){var L=false;if(H.options.searchDatagridView._currentCustoViewId===J){L=true}if(q.is(H._columnCustoPreferenceDefinition.views,"array")){for(var K=H._columnCustoPreferenceDefinition.views.length-1;K>=0;K--){if(q.is(H._columnCustoPreferenceDefinition.views[K],"object")&&q.is(H._columnCustoPreferenceDefinition.views[K].viewId,"string")&&H._columnCustoPreferenceDefinition.views[K].viewId===J){H._columnCustoPreferenceDefinition.views.splice(K,1)}}}if(q.is(H._columnCustoPreferenceDefinition.activeView,"string")&&H._columnCustoPreferenceDefinition.activeView===J){delete H._columnCustoPreferenceDefinition.activeView}v.commit();H._custoCombo.remove(J);if(true==L){H._applyReset();H._requestClosePanel()}}}});var G=this._custoCombo.getValue(),I="";if(q.is(G,"array")&&G.length>0){I=G[0]}if(I.length>0&&!I.endsWith("-ADMIN")){H._bDel.show()}else{H._bDel.hide()}this.options.preferences_grid.inject(H._divGrid);this.options.preferences_grid.getManager().onRowHeaderRequest(function(K){var J=K.cellView.getContent();J.setStyles({paddingLeft:5,paddingRight:5,opacity:0.5,fontSize:"1.5em"});J.addClassName("wux-ui-hamburger")});this.options.preferences_grid.getManager().onMoveRow(function(K){if(!q.is(K.fromRowID)||!q.is(K.toRowID)){return}var J=H.gridFinalValues.splice(K.fromRowID,1);H.gridFinalValues.splice(K.toRowID,0,J[0]);H._unmodifiedCusto=false})},_requestClosePanel:function(){if(q.is(b)&&q.is(b.close,"function")){b.close();b=null}}});return a});define("DS/SNResultUX/utils/OneSearchActions",["UWA/Core","UWA/Class/Debug","UWA/Class","UWA/Controls/Abstract","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/UIKIT/DropdownMenu","DS/SNResultUX/utils/SearchViewOptions"],function(d,c,g,b,h,e,a,f){return b.extend(c,{_view:null,_container:null,_searchActions:null,_defaultItem:[],init:function(i){this._parent(i);this._defaultItem=[];if(i&&i.container){this._container=i.container;this._collection=i.collection;this._searchActions=i.searchActions;this.options=i;this.defaultItems();this.render()}},render:function(i){var j=this;if(!d.is(j._searchActions)||!d.is(j._container)){return}this._view=new a({className:"one_search_actions",target:j._container,events:{onClick:function(o,l){if(!d.is(l)){return}var p=l.id;var n=j._searchActions.snSkeletonMgt;if(p==="select_all"||p==="unselect_all"){if(d.is(n)){var m=[{id:p,sourcejs:"DS/SNResultUX/utils/Select_ActionHandler"}];n._handleAction(0,undefined,m)}}else{var k={actionItem:{model:{get:function(){return(p)}},getContent:function(){return(j._container)}},itemViewOptions:f.getItemViewOptions(n.getOption("resources"))};j._searchActions.onActionClick(k)}},onShow:function(){var l=j._searchActions.snSkeletonMgt;if(d.is(l)){var k=l._skeleton.getViewAt(0).currentViewId;if(d.is(k)){this.items.forEach(function(p){if(d.is(p)&&d.is(p.id)){if("exportToCmd"===p.id){if(k==="table"){p.elements.container.setStyle("display","inline-block")}else{p.elements.container.setStyle("display","none")}}else{if("select_all"===p.id||"unselect_all"===p.id){var o=l._model.getXSO().get();if(d.is(o)){var n=o.length;var m=d.is(l._onesearch_collection)&&d.is(l._onesearch_collection.totalCount)?l._onesearch_collection.totalCount:0;if("select_all"===p.id){if(n!==m){p.elements.container.setStyle("display","inline-block")}else{p.elements.container.setStyle("display","none")}}if("unselect_all"===p.id){if(n===0){p.elements.container.setStyle("display","none")}else{p.elements.container.setStyle("display","inline-block")}}}}}}})}}}},items:j._defaultItem})},defaultItems:function(){var k=this;if(!d.is(k._searchActions)||!d.is(k._container)){return}var i=k._searchActions.actionOneSearch;if(d.is(i)){var l=i._byId;if(d.is(l)){var j=l.refresh_search;if(d.is(j)){k._defaultItem.push({text:e.get("actions.refresh_search.title"),id:"refresh_search",fonticon:"fonticon fonticon-cw"})}j=l.Grid_Custo;if(d.is(j)){k._defaultItem.push({text:e.get("actions.Grid_Custo.title"),id:"Grid_Custo",fonticon:"fonticon fonticon-cog"})}j=l.save_search;if(d.is(j)){var m=j.get("visible");if(d.is(m)){if(m===true){k._defaultItem.push({text:e.get("actions.save_search.title"),id:"save_search",fonticon:"fonticon fonticon-star"})}}else{k._defaultItem.push({text:e.get("actions.save_search.title"),id:"save_search",fonticon:"fonticon fonticon-star"})}}j=l.exportToCmd;if(d.is(j)){k._defaultItem.push({text:e.get("actions.exportToCmd.title"),id:"exportToCmd",fonticon:"fonticon fonticon-export"})}j=l.BI_Activated;if(d.is(j)){k._defaultItem.push({text:e.get("actions.BI_Activated.title"),id:"BI_Activated",fonticon:"fonticon fonticon-chart-pie"})}j=l.kpi_pcs_action;if(d.is(j)){k._defaultItem.push({text:"PCS",id:"kpi_pcs_action",fonticon:"fonticon fonticon-chart-line"})}j=l.Pin;if(d.is(j)){k._defaultItem.push({text:e.get("actions.Pin.title"),id:"Pin",fonticon:"fonticon fonticon-publish"})}}}k._defaultItem.push({text:e.get("selectAllTitle"),id:"select_all",fonticon:"fonticon fonticon-select-on"});k._defaultItem.push({text:e.get("unselectAllTitle"),id:"unselect_all",fonticon:"fonticon fonticon-select-off"})},destroy:function(){if(d.is(this._view)&&d.is(this._view.destroy,"function")){this._view.destroy();delete this._view}this._parent()}})});define("DS/SNResultUX/views/SearchTileGridView",["DS/SNResultUX/views/SearchGridView","UWA/Core","DS/SNInfraUX/SearchSettings"],function(c,a,b){var d=c.extend({className:"TileGridView",attributes:{styles:{width:"100%",height:"100%"},"data-rec-id":"TileGridView"},bShowTooltip:false,_viewRoot:null,init:function(e){this._parent(e);this.bShowTooltip=a.is(b.getOption("webUXTooltip"))?b.getOption("showTooltip"):false;this.neverCheckbox=a.is(b.getOption("neverCheckbox"))?b.getOption("neverCheckbox"):false;this.neverAction=a.is(b.getOption("neverAction"))?b.getOption("neverAction"):false},onSearch:function(e){this._parent(e);var f=this},onSwitch:function(e){this._parent(e)},getMinNumberModel:function(f,e){f=f||this._rowMaxNumber;e=e||this._columnsMaxNumber;return f*e},destroy:function(){if(a.is(this.view)&&a.is(this.view.destroy,"function")){this.view.destroy()}this._parent()},render:function(){this.log("TileGridView render");var e=this;require(["DS/Tree/TileGridView"],function(g){var f=e.getOptionCommon();e.view=new g(f);e.view.setCheckboxVisibilityFlag("atCellHover");if(e.neverCheckbox===true){e.view.setCheckboxVisibilityFlag("never")}e.view.setTitleDisplayedOnTwoLines&&e.view.setTitleDisplayedOnTwoLines(true);e.view.options.responsiveWidthBehavior=true;e.view.options.shouldDisplayTooltipFlag=e.bShowTooltip;e.view.inject(e.container);e._model.search_multiselMode&&e.toggleMultiSelMode(true);e.view.onGridViewCellDoubleClick(function(h){e.onItemDblClick(h)});e.view.onInfiniteScrollAsync(function(h){e.onInfiniteScrollAsync(h,function(){e.view.infiniteScrollAsyncProcessDone()})});e.view.onEndResizeOrOnReadyModelRequestAsync&&e.view.onEndResizeOrOnReadyModelRequestAsync(function(h){e.onResizeOrFirstLoaded(h,function(){e.view.EndResizeOrOnReadyModelRequestAsyncDone()})});e._afterRender();e.onSearch()});return this}});return d});define("DS/SNResultUX/views/SearchRespThumbnailGridView",["DS/SNResultUX/views/SearchGridView","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/ImageHelper"],function(c,a,b,d){return c.extend({className:"RespThumbnailGridView",attributes:{styles:{width:"100%"},"data-rec-id":"RespThumbnailGridView"},bShowTooltip:false,_bigPicList:[],_picCheckedList:[],_imageHelpers:null,init:function(e){this._imageHelpers=[];this._bigPicList=[];this._picCheckedList=[];this._parent(e);this.bShowTooltip=a.is(b.getOption("showTooltip"))?b.getOption("showTooltip"):false;this.neverCheckbox=a.is(b.getOption("neverCheckbox"))?b.getOption("neverCheckbox"):false;this.neverAction=a.is(b.getOption("neverAction"))?b.getOption("neverAction"):false},onSearch:function(e){this._parent(e)},getMinNumberModel:function(f,e){f=f||this._rowMaxNumber;e=e||this._columnsMaxNumber;return f*e},setup:function(e){this._parent(e);var f=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){if(f._imageHelpers){f._imageHelpers.forEach(function(g){g.destroy()})}f._imageHelpers=[];f._bigPicList=[];f._picCheckedList=[]},onSync:function(){}})},destroy:function(){this._imageHelpers.forEach(function(e){e.destroy()});this._imageHelpers=null;if(a.is(this.view)&&a.is(this.view.destroy,"function")){this.view.destroy()}this._parent()},_updatePictureBackgroundSizeOnCell:function(f,e){if(a.is(f)&&a.is(f.contentView)&&a.is(f.contentView.setPictureBackgroundSize,"function")){f.contentView.setPictureBackgroundSize(e)}},setAsBigPicture:function(e){this._bigPicList.push(e)},_onPostCellRequest:function(j,e,f){var i=j.cellView;var g=(a.is(j.virtualCellID))?j.virtualCellID:(a.is(j.cellID))?j.cellID:null;if(null===g){return}(-1!==this._bigPicList.indexOf(g))?this._updatePictureBackgroundSizeOnCell(i,"contain"):this._updatePictureBackgroundSizeOnCell(i,"auto");if(!(-1!==this._picCheckedList.indexOf(g))){this._imageHelpers.push(new d(j,this));this._picCheckedList.push(g)}else{var h=this._imageHelpers[g];if(a.is(h)){h._cellInfos=j}}},render:function(){this.log("RespThumbnailGridView render");var e=this;require(["DS/CollectionView/ResponsiveThumbnailsCollectionView"],function(h){var f=e.getOptionCommon();f.height="inherit";f.useDragAndDrop=true;f.displayedOptionalCellProperties=["contextualMenu"];e.view=new h(f);var g=e._canMultiSelect;e.view.selectionBehavior.toggle=g;e.view.selectionBehavior.canMultiSelect=g;e.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=g;e.view.selectionBehavior.enableShiftSelection=g;e.view.selectionBehavior.enableFeedbackForActiveCell=g;e.view.onCellDoubleClick(function(i){e.onItemDblClick(i.cellModel)});if(a.is(e._simpleSearch)&&e._simpleSearch===true&&a.is(e.view.onCellTitleClick,"function")){e.view.onCellTitleClick(function(i){e.onItemTitleClick(i.cellModel)})}e.view.onContextualEvent=f.onContextualEvent;e.view.displayTitleTooltip=e.bShowTooltip;if(e.neverCheckbox===true){e.view.visibilityFlag=false}e.view.getContent().inject(e.container);e._model.search_multiselMode&&e.toggleMultiSelMode(true);e.view.onInfiniteScroll(function(i){e.onInfiniteScrollAsync(i,function(){e.view.infiniteScrollProcessDone()})});e.view.onEndResizeOrOnReadyModelRequest&&e.view.onEndResizeOrOnReadyModelRequest(function(i){e.onResizeOrFirstLoaded(i,function(){e.view.EndResizeOrOnReadyModelRequestDone()})});e._afterRender();e.onSearch()});return this}})});define("DS/SNResultUX/views/SearchRespTileGridView",["DS/SNResultUX/views/SearchGridView","UWA/Core","DS/SNInfraUX/SearchSettings"],function(c,a,b){return c.extend({className:"RespTileGridView",attributes:{styles:{width:"100%"},"data-rec-id":"RespTileGridView"},bShowTooltip:false,init:function(d){this._parent(d);this.bShowTooltip=a.is(b.getOption("webUXTooltip"))?b.getOption("showTooltip"):false;this.neverCheckbox=a.is(b.getOption("neverCheckbox"))?b.getOption("neverCheckbox"):false;this.neverAction=a.is(b.getOption("neverAction"))?b.getOption("neverAction"):false},onSearch:function(d){this._parent(d)},getMinNumberModel:function(e,d){e=e||this._rowMaxNumber;d=d||this._columnsMaxNumber;return e*d},setup:function(d){this._parent(d);var e=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){}})},destroy:function(){if(a.is(this.view)&&a.is(this.view.destroy,"function")){this.view.destroy()}this._parent()},_onPostCellRequest:function(f){var e=f.cellView;var d=(a.is(f.virtualCellID))?f.virtualCellID:(a.is(f.cellID))?f.cellID:null;if(null===d){return}if(a.is(e.contentView)&&a.is(e.contentView.setPictureBackgroundSize,"function")){e.contentView.setPictureBackgroundSize("79px")}},render:function(){this.log("RespTileGridView render");var d=this;require(["DS/CollectionView/ResponsiveTilesCollectionView"],function(g){var e=d.getOptionCommon();e.height="inherit";e.useDragAndDrop=true;e.displayedOptionalCellProperties=["contextualMenu","description"];d.view=new g(e);d.view.layout.columnMaxWidth=b.getOption("maxTileWidth")?b.getOption("maxTileWidth"):670;d.view.allowLargeItems=true;var f=d._canMultiSelect;d.view.selectionBehavior.canMultiSelect=f;d.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=f;d.view.selectionBehavior.enableShiftSelection=f;d.view.selectionBehavior.enableFeedbackForActiveCell=f;if(d.neverCheckbox===true){d.view.visibilityFlag=false}d.view.onCellDoubleClick(function(h){d.onItemDblClick(h.cellModel)});if(a.is(d._simpleSearch)&&d._simpleSearch===true&&a.is(d.view.onCellTitleClick,"function")){d.view.onCellTitleClick(function(h){d.onItemTitleClick(h.cellModel)})}d.view.onContextualEvent=e.onContextualEvent;d.view.displayTitleTooltip=d.bShowTooltip;d.view.getContent().inject(d.container);d._model.search_multiselMode&&d.toggleMultiSelMode(true);d.view.onInfiniteScroll(function(h){d.onInfiniteScrollAsync(h,function(){d.view.infiniteScrollProcessDone()})});d.view.onEndResizeOrOnReadyModelRequest&&d.view.onEndResizeOrOnReadyModelRequest(function(h){d.onResizeOrFirstLoaded(h,function(){d.view.EndResizeOrOnReadyModelRequestDone()})});d._afterRender();d.onSearch()});return this}})});define("DS/SNResultUX/views/SearchRespLargeTileGridView",["DS/SNResultUX/views/SearchGridView","UWA/Core","DS/SNInfraUX/SearchSettings"],function(d,b,c){var a=d.extend({className:"RespLargeTileGridView",attributes:{styles:{width:"100%"},"data-rec-id":"RespLargeTileGridView"},bShowTooltip:false,init:function(e){this._parent(e);this.bShowTooltip=b.is(c.getOption("webUXTooltip"))?c.getOption("showTooltip"):false;this.neverCheckbox=b.is(c.getOption("neverCheckbox"))?c.getOption("neverCheckbox"):false;this.neverAction=b.is(c.getOption("neverAction"))?c.getOption("neverAction"):false},onSearch:function(e){this._parent(e)},getMinNumberModel:function(f,e){f=f||this._rowMaxNumber;return f},setup:function(e){this._parent(e);var f=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){}})},destroy:function(){if(b.is(this.view)&&b.is(this.view.destroy,"function")){this.view.destroy()}this._parent()},render:function(){this.log("RespLargeTileGridView render");var e=this;require(["DS/CollectionView/ResponsiveLargeTilesCollectionView"],function(h){var f=e.getOptionCommon();f.height="inherit";f.useDragAndDrop=true;f.displayedOptionalCellProperties=["contextualMenu","description"];e.view=new h(f);var g=e._canMultiSelect;e.view.selectionBehavior.canMultiSelect=g;e.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=g;e.view.selectionBehavior.enableShiftSelection=g;e.view.selectionBehavior.enableFeedbackForActiveCell=g;if(e.neverCheckbox===true){e.view.visibilityFlag=false}e.view.onCellDoubleClick(function(i){e.onItemDblClick(i.cellModel)});if(b.is(e._simpleSearch)&&e._simpleSearch===true&&b.is(e.view.onCellTitleClick,"function")){e.view.onCellTitleClick(function(i){e.onItemTitleClick(i.cellModel)})}e.view.onContextualEvent=f.onContextualEvent;e.view.displayTitleTooltip=e.bShowTooltip;e.view.getContent().inject(e.container);e._model.search_multiselMode&&e.toggleMultiSelMode(true);e.view.onInfiniteScroll(function(i){e.onInfiniteScrollAsync(i,function(){e.view.infiniteScrollProcessDone()})});e.view.onEndResizeOrOnReadyModelRequest&&e.view.onEndResizeOrOnReadyModelRequest(function(i){e.onResizeOrFirstLoaded(i,function(){e.view.EndResizeOrOnReadyModelRequestDone()})});e._afterRender();e.onSearch()});return this}});return a});define("DS/SNResultUX/views/SearchRespTextualTileGridView",["DS/SNResultUX/views/SearchGridView","UWA/Core","DS/SNInfraUX/SearchSettings"],function(c,a,b){return c.extend({className:"RespTextualTileGridView",attributes:{styles:{width:"100%"},"data-rec-id":"RespTextualTileGridView"},bShowTooltip:false,init:function(d){this._parent(d);this.bShowTooltip=a.is(b.getOption("webUXTooltip"))?b.getOption("showTooltip"):false;this.neverCheckbox=a.is(b.getOption("neverCheckbox"))?b.getOption("neverCheckbox"):false;this.neverAction=a.is(b.getOption("neverAction"))?b.getOption("neverAction"):false},onSearch:function(d){this._parent(d)},getMinNumberModel:function(e,d){e=e||this._rowMaxNumber;return e},setup:function(d){this._parent(d);var e=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){}})},destroy:function(){if(a.is(this.view)&&a.is(this.view.destroy,"function")){this.view.destroy()}this._parent()},_onPostCellRequest:function(f){var e=f.cellView;var d=(a.is(f.virtualCellID))?f.virtualCellID:(a.is(f.cellID))?f.cellID:null;if(null===d){return}if(a.is(e.contentView)&&a.is(e.contentView.setPictureBackgroundSize,"function")){e.contentView.setPictureBackgroundSize("contain")}},render:function(){this.log("RespTextualTileGridView render");var d=this;require(["DS/CollectionView/ResponsiveLargeTextualTilesCollectionView"],function(g){var e=d.getOptionCommon();e.height="inherit";e.useDragAndDrop=true;e.displayedOptionalCellProperties=["contextualMenu","description"];d.view=new g(e);d.view.layout.gutter=10;var f=d._canMultiSelect;d.view.selectionBehavior.toggle=f;d.view.selectionBehavior.canMultiSelect=f;d.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=f;d.view.selectionBehavior.enableShiftSelection=f;d.view.selectionBehavior.enableFeedbackForActiveCell=f;if(d.neverCheckbox===true){d.view.visibilityFlag=false}d.view.onCellDoubleClick(function(h){d.onItemDblClick(h.cellModel)});if(a.is(d._simpleSearch)&&d._simpleSearch===true&&a.is(d.view.onCellTitleClick,"function")){d.view.onCellTitleClick(function(h){d.onItemTitleClick(h.cellModel)})}d.view.onContextualEvent=e.onContextualEvent;d.view.displayTitleTooltip=d.bShowTooltip;d.view.getContent().inject(d.container);d._model.search_multiselMode&&d.toggleMultiSelMode(true);d.view.onInfiniteScroll(function(h){d.onInfiniteScrollAsync(h,function(){d.view.infiniteScrollProcessDone()})});d.view.onEndResizeOrOnReadyModelRequest&&d.view.onEndResizeOrOnReadyModelRequest(function(h){d.onResizeOrFirstLoaded(h,function(){d.view.EndResizeOrOnReadyModelRequestDone()})});d._afterRender();d.onSearch()});return this}})});define("DS/SNResultUX/views/SearchTreeListView",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Debug","DS/UIKIT/Mask","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SNVocabAccess","DS/SNResultUX/utils/SearchViewOptions","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchCustoServices","DS/WebappsUtils/Performance","DS/SNResultUX/views/EmptyView","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/SWFiltering","DS/Core/PointerEvents","DS/SNResultUX/views/SearchGridView","DS/W3DXComponents/Collections/ActionsCollection","DS/Controls/Toggle","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(o,k,u,w,t,a,h,r,p,e,b,m,l,c,i,g,q,f,j,v,d,n){return j.extend({tagName:"div",className:"TreeListView",attributes:{styles:{width:"100%"},"data-rec-id":"TreeListView"},nestedView:null,_columns:null,_columnsAttributes:null,_model:null,multiselMode:false,checkedRows:0,_currentCustoViewId:"The_Default_Columns",_lastSelectedCustoViewId:"The_Default_Columns",_forcedCustoView:null,_typeAttrCache:[],_vocabularyClassesCache:[],_iShiftDown:false,_lastItemSelected:null,_shiftTransaction:false,_previousSlice:{start:-1,end:-1},_viewRoot:null,_cellSpan:null,_beginUnselectAll:false,_subscriptions:null,_actionsColumnViews:null,_currentViewManagerPostion:null,_currentTimestamp:null,_reDefColumns:function(){var B=this.collection;var z=this.view.getManager();var x=this._columns;if(B.state.totalRecords<=1000){var y=x.length;for(var C=0;C<y;C++){var A=x[C].dataIndex;z.setColumnOptions(A,{isSortable:true})}}else{var y=x.length;for(var C=0;C<y;C++){var A=x[C].dataIndex;switch(A){case"ds6w:label":case"ds6w:who/ds6w:responsible":case"ds6w:when/ds6w:created":case"ds6w:when/ds6w:modified":case"ds6w:responsible":case"ds6w:created":case"ds6w:modified":z.setColumnOptions(A,{isSortable:true});break;default:z.setColumnOptions(A,{isSortable:false})}}}},init:function(x){this._parent(x);this._subscriptions={};var y=this;this._columns=o.clone(this._columnsAttributes);this._actionsColumnViews=[];if(UWA.is(this.collection&&this.collection.getSNSkeleton())){this._subscriptions.sortForAllView=t.subscribe({channel:this.collection.getSNSkeleton().getOption("messagingChannel"),topic:"sortForAllView",callback:function(A){if(!y.view||!y.collection.service_parameters){return}if(o.is(A.isRecent)&&true===A.isRecent){if(y.view.getManager().getOrderedColumnState()){y.view.getManager().setColumnOrderState(y.view.getManager().getOrderedColumnState().dataIndex,"none")}y.view.getManager().sortColumnContent(A.order_field,{sortOrder:A.order_by,typeOfCell:"number"});return}else{var C,D;if(y.collection.service_parameters.order_by&&y.collection.service_parameters.order_field){C=y.collection.service_parameters.order_by;D=y.collection.service_parameters.order_field}else{C=A.order_by;D=A.order_field}if(y.view.getManager().getOrderedColumnState()){y.view.getManager().setColumnOrderState(y.view.getManager().getOrderedColumnState().dataIndex,"none")}y.view.getManager().setColumnOrderState(D,C);var z=h.getOption("NLSMapping_3DSearch_Sorting_TACTICALOnly");if(UWA.is(z)){for(var B in z){if(z[B]===D){y.view.getManager().setColumnOrderState(D,C);break}}}}}})}},getActionMenu:function(I,B){var D=this;var x=D._model.getXSO().get();var G,A;if(x.length===1){G=D.collection._models[I.virtualRowID];A=G.actions;if(o.is(A)&&A._models.length!==0){for(var C=0;C<A.length;C++){var z=A._models[C]._attributes;if(o.is(A._models[C])&&o.is(A._models[C]._attributes)){B.push({text:z.title,fonticon:z.icon,handler:A._models[C]._attributes.callback.bind(D,{action_id:z.id,object_id:D.collection.at(I.virtualRowID).get("id"),cellInfo:I,collection:D.collection,model:D.collection.at(I.virtualRowID)})})}}}else{B.push({text:g.get("noActionsAvailable")})}}else{var y=x.length;var H=function(J){if(y>1){return J.get("multisel")===true}else{return J}};G=[];for(var C=0;C<x.length;C++){G.push(D.collection._models[x[C]._localID])}var E=G[0].actions.filter(H);for(var C=1;C<y;C++){var F=G[C].actions.filter(H);E=E.filter(function(K){var J=F.some(function(L){return K.id===L.id});return J})}if(E&&E.length>0){E.forEach(function(J){var K={text:J.get("title"),fonticon:J.get("icon"),};if(UWA.is(J.get("callback"))){K.callback=function(){var L=[];Array.prototype.forEach.call(G,function(N){var M={model:N,action_id:J.get("id"),object_id:N.get("id"),collection:N.collection};L.push(M)});J.get("callback").call(D,L,arguments)}}B.push(K)})}else{B.push({text:g.get("noActionsAvailable")})}}},onSearch:function(x){this._parent(x);var y=this;if(o.is(this.colCustoPanel)&&o.is(this.colCustoPanel._requestClosePanel,"function")){this.colCustoPanel._requestClosePanel()}this.colCustoPanel=null;this._reinitialisationColums(x);this._columns=o.clone(this._columnsAttributes);this.collection.getAttributesToRetrieve(this._columns)},getMinNumberModel:function(y,x){y=y||this._rowMaxNumber;x=x||this._columnsMaxNumber;return y},_managerInit:function(){var y=this;var x=y.view.getManager();x.onColumnWidthUpdate(function(z){y.updateColumnWidth(z)});x.options.pageScrollValueTriggeringInfiniteScroll=h.getOption("pageScrollValueTriggeringInfiniteScroll");x.onMoveColumn(function(A,B){console.log("column moved");if(y.view&&y.view._datagrid.options.columns){var z=JSON.stringify(y.view._datagrid.options.columns);console.log("store new columns: "+z);localStorage.SNSearchGridColumns=z}});x.onRowHeaderRequest(function(A){var z=A.cellView.getContent();z.setContent((A.virtualRowID+1).toString())});x.onSortColumnContent(function(E,D){var z="sort request received on "+E.columnDataIndex+", order = "+E.sortOrder;console.log(z);y.log(z);var B="";var A=h.getOption("NLSMapping_3DSearch_Sorting_TACTICALOnly");if(y.view&&y.view.getManager()){B=y.view.getManager().getColumnOptions(E.columnDataIndex).text}t.publish({channel:y.collection.getSNSkeleton().getOption("messagingChannel"),topic:"setOrderInGridView",data:{order_by:E.sortOrder,order_field:(UWA.is(A)&&A.hasOwnProperty(E.columnDataIndex))?A[E.columnDataIndex]:E.columnDataIndex,nlsName:B}});var C=y.collection.getSNSkeleton();if(UWA.is(C)&&UWA.is(C._informationPanel)&&C._informationPanel.getvisibleFlag()===true){C._informationPanel.setInfomationPanelObject(null)}y._currentViewManagerPostion=-y.view.getManager().getScroller()._scrollPosition.x;y._currentTimestamp=parseInt(Date.now())});x.onPostUpdateView(function(){if(null===y._currentViewManagerPostion||!o.is(y.view.getManager().getScroller())){return}y.view.getManager().getScroller().elements.container.scrollLeft=y._currentViewManagerPostion;if(null!==y._currentTimestamp&&(parseInt(Date.now())-y._currentTimestamp)<1000){return}y._currentViewManagerPostion=null;y._currentTimestamp=null;return});x.onCellClick(function(z){if(h.getOption("search_web_in_win")&&z.dataIndex==="actions"){z.cellView._manager._cellSpan=z.cellView.getContent()}if(!(z.isHeader&&y.collection.state.totalRecords>1000)){return}switch(z.dataIndex){case"ds6w:label":case"ds6w:who/ds6w:responsible":case"ds6w:when/ds6w:created":case"ds6w:when/ds6w:modified":case"ds6w:responsible":case"ds6w:created":case"ds6w:modified":break;default:m._displayAlert({message:g.get("sortLimitByLessThen1000Results"),className:"warning"});break}});x.onNodeDblClick(function(z,A){(!z.nodeModel&&!z._options)?x.sizeColumnToFit(z.dataIndex):y.onItemDblClick(z,A)});x.onCellPointerDown(function(z){if(o.is(y._simpleSearch)&&y._simpleSearch===true&&UWA.is(z)&&UWA.is(z.dataIndex)&&z.dataIndex==="ds6w:label"&&UWA.is(z.isHeader)&&z.isHeader===false&&UWA.is(z.columnID)&&z.columnID===3){y.onItemTitleClick(z)}});x.onInfiniteScrollAsync(function(z){console.log("scroll");y.onInfiniteScrollAsync(z,function(){x.infiniteScrollAsyncProcessDone()})});x.onEndResizeOrOnReadyModelRequestAsync&&x.onEndResizeOrOnReadyModelRequestAsync(function(z){y.onResizeOrFirstLoaded(z,function(){x.EndResizeOrOnReadyModelRequestAsyncDone()})})},_reinitialisationColums:function(G){var E=this;E._forcedCustoView=null;this._currentCustoViewId=this._lastSelectedCustoViewId;if(r.getItem("listColumnsWidth")){if(this.view){try{var H=JSON.parse(r.getItem("listColumnsWidth"));var O=Object.keys(H);var z=this.view._datagrid.options.columns;for(var M=0;M<z.length;M++){if(O.indexOf(z[M].dataIndex)!=-1){z[M].width=H[z[M].dataIndex]}}}catch(P){console.log(P)}}}if(o.is(E.collection.service_parameters)&&o.is(E.collection.options.tagger_proxy)){var B={isPQ:E.collection.service_parameters.isAPQSearch?true:false,typeName:E.collection.getPQ()};var F=false;if(o.is(E.collection.service_parameters.isAPQSearch)&&E.collection.service_parameters.isAPQSearch===true){var A=E.collection.getPQ();if(o.is(A)&&o.is(A.pqName,"string")&&A.pqName.length>0){F=true}}var C=l.getColumnCustomizationIdToUse(B);if(o.is(C,"string")&&C.length>0){this._currentCustoViewId=C;this._columnsAttributes=l.getColumnCustomizationDefinitionFromCustoId(C)}var x=E.collection.options.tagger_proxy.getCurrentFilter();var y=E.collection.service_parameters.refine;if((E.collection.service_parameters.query===a.SearchTypeEnum.ADVANCED_SEARCH)&&o.is(y)&&(y==="")){this._columnsAttributes=l.getColumnCustomizationDefinitionFromCustoId("The_Default_Columns")}else{if(o.is(x)&&o.is(x.allfilters)&&o.is(y)&&o.is(y.allfilters)&&(""===this._currentCustoViewId||"The_Default_Columns"===this._currentCustoViewId)){if((E.collection.service_parameters.query!==a.SearchTypeEnum.ADVANCED_SEARCH)&&(Object.keys(x.allfilters).length>0&&(o.is(x.allfilters["ds6w:what/ds6w:type"])&&x.allfilters["ds6w:what/ds6w:type"].length>0||o.is(x.allfilters["ds6w:what/ds6w:kind"])&&x.allfilters["ds6w:what/ds6w:kind"].length>0))){var K=[];if(o.is(y.allfilters["ds6w:what/ds6w:type"])&&!o.is(y.allfilters["ds6w:what/ds6w:kind"])){K=y.allfilters["ds6w:what/ds6w:type"]}else{if(o.is(y.allfilters["ds6w:what/ds6w:kind"])&&!o.is(y.allfilters["ds6w:what/ds6w:type"])){K=y.allfilters["ds6w:what/ds6w:kind"]}else{if(o.is(y.allfilters["ds6w:what/ds6w:kind"])&&o.is(y.allfilters["ds6w:what/ds6w:type"])){K=y.allfilters["ds6w:what/ds6w:type"].concat(y.allfilters["ds6w:what/ds6w:kind"])}}}var I=[];for(var Q=0;Q<K.length;Q++){var R=l.getColumnCustomizationAliasIdToUse(K[Q].object);I.push(R)}var L=I.filter(function(U,T,S){return S.indexOf(U)===T});if(L.length===1&&o.is(L[0])){this._currentCustoViewId=L[0];this._columnsAttributes=l.getColumnCustomizationDefinitionFromAliasCustoId(this._currentCustoViewId);if(E._isCurrentView&&!(o.is(G)&&o.is(G.refresh))){m._displayAlert({message:g.get("SearchDataGridPreferences_modal_typeCusto"),className:"success",widgetId:E.getOption("widgetId")})}}}else{if(o.is(x.allfilters)&&((Object.keys(x.allfilters).length===1&&(o.is(x.allfilters["sixw:ds6w:what/ds6w:type"])))||Object.keys(x.allfilters).length===2&&(o.is(x.allfilters["sixw:ds6w:what/ds6w:type"])||o.is(x.allfilters["sixw:vpmextension"])))||(Object.keys(x.allfilters).length===3&&(o.is(x.allfilters["sixw:ds6w:what/ds6w:type"])||o.is(x.allfilters["sixw:vpmextension"])))){var K=[];if(o.is(x.allfilters["sixw:ds6w:what/ds6w:type"])&&!o.is(x.allfilters["sixw:vpmextension"])){K=x.allfilters["sixw:ds6w:what/ds6w:type"]}else{if(o.is(x.allfilters["sixw:vpmextension"])&&!o.is(x.allfilters["sixw:ds6w:what/ds6w:type"])){K=x["sixw:vpmextension"]}else{if(o.is(x.allfilters["sixw:vpmextension"])&&o.is(x.allfilters["sixw:ds6w:what/ds6w:type"])){K=x.allfilters["sixw:ds6w:what/ds6w:type"].concat(x.allfilters["sixw:vpmextension"])}}}var I=[];for(var Q=0;Q<K.length;Q++){var R=l.getColumnCustomizationAliasIdToUse(K[Q].object.slice(6));I.push(R)}var L=I.filter(function(U,T,S){return S.indexOf(U)===T});if(L.length===1&&o.is(L[0])){this._currentCustoViewId=L[0];this._columnsAttributes=l.getColumnCustomizationDefinitionFromAliasCustoId(this._currentCustoViewId);if(E._isCurrentView&&!(o.is(G)&&o.is(G.refresh))){m._displayAlert({message:g.get("SearchDataGridPreferences_modal_typeCusto"),className:"success",widgetId:E.getOption("widgetId")})}}}else{if(F){var C=l.getColumnCustomizationIdToUse(B);if(o.is(C,"string")&&C.length>0){this._currentCustoViewId=C;this._columnsAttributes=l.getColumnCustomizationDefinitionFromCustoId(C)}}else{this._columnsAttributes=l.getColumnCustomizationDefinitionFromCustoId(this._currentCustoViewId)}}}}else{this._columnsAttributes=l.getColumnCustomizationDefinitionFromCustoId(this._currentCustoViewId)}}b.getCustoCellRequest(this._columnsAttributes)}if(!o.is(this._columnsAttributes)||(o.is(this._columnsAttributes)&&this._columnsAttributes.length<1)){this._columnsAttributes=b.getDataGridViewHeaders(function(){if(E._columnsAttributes){var S=E._columnsAttributes.length;for(var U=0;U<S;U++){var T=E._columnsAttributes[U].dataIndex;E._columnsAttributes[U].text=p.getNLSValueForPredicate(T)}}if(E.view){E.updateColumnsNLS()}})}if(o.is(E.collection)&&o.is(E.collection.service_parameters)&&o.is(E.collection.service_parameters.query)&&a.SearchTypeEnum.MY_RECENT_CONTENT===E.collection.service_parameters.query){E._columnsAttributes.forEach(function(S){if(S.dataIndex.indexOf("/")!==-1){S.dataIndex=S.dataIndex.slice(S.dataIndex.indexOf("/")+1,S.dataIndex.length)}})}this._columns=o.clone(this._columnsAttributes);if(this.view&&this.view.options){this.reloadColumn()}this.collection.getAttributesToRetrieve(this._columns);if("The_Default_Columns"===this._currentCustoViewId){if(r.getItem("listColumnsWidth")){try{var H=JSON.parse(r.getItem("listColumnsWidth"));var O=Object.keys(H);this._columnsAttributes.forEach(function(T,S){if(O.indexOf(T.dataIndex)==-1){T.width="auto"}else{T.width=H[T.dataIndex]}})}catch(P){console.log(P)}}else{this._columnsAttributes.forEach(function(T,S){T.width="auto"})}}if(this.view){var D=this.view.options;D.columns.length=3;for(var N=0;N<=this._columnsAttributes.length-1;N++){if(this._columnsAttributes[N]){D.columns.push(this._columnsAttributes[N])}}}this.comptuteNewColumnsNLS();if(E.view&&this.collection.service_parameters&&this.collection.service_parameters.order_by&&this.collection.service_parameters.order_field){var J=E.view.getManager().getOrderedColumnState();if(J){E.view.getManager().setColumnOrderState(J.dataIndex,"none")}E.view.getManager().setColumnOrderState(E.collection.service_parameters.order_field,E.collection.service_parameters.order_by)}},updateColumnsNLS:function(){var z=this;var y=z.view.getManager();var x=z._columnsAttributes.length;for(var B=0;B<x;B++){var A=z._columnsAttributes[B].dataIndex;y.setColumnOptions(A,{text:z._columnsAttributes[B].text});if(A==="actions"){y.setColumnOptions(A,{text:"Actions"})}}z.view.getManager().updateView()},updateGridViewAfterSync:function(){var A=this;if(A.view&&A.collection.service_parameters&&A.collection.service_parameters.order_by&&A.collection.service_parameters.order_field){var B=A.view.getManager().getOrderedColumnState();if(B){A.view.getManager().setColumnOrderState(B.dataIndex,"none")}A.view.getManager().setColumnOrderState(A.collection.service_parameters.order_field,A.collection.service_parameters.order_by);var y=h.getOption("NLSMapping_3DSearch_Sorting_TACTICALOnly");if(UWA.is(y)){for(var z in y){if(y[z]===A.collection.service_parameters.order_field){A.view.getManager().setColumnOrderState(z,A.collection.service_parameters.order_by);break}}}}if(!A.isReady){A.view.getManager()._setColumnsWidth();A.isReady=true}var x=A.view.getManager().getNumberOfRows();A._setRowNumberWidth(A.view.getManager(),x,false);A._reDefColumns();A.updateColumnsNLS()},_emptyDataGridAndReloadFirstPage:function(D,F,x){var B=this;var z=D.getManager();var C=Math.floor((Math.random()*100000)+1);B._emptyDataGrid();B.collection._resetState();B.collection.reset();w.mask(B.container);if(UWA.is(x)){B.collection.service_parameters.order_by=x}if(UWA.is(F)){B.collection.service_parameters.order_field=null;var E=F.split("/");if(UWA.is(E)&&E.length>0){B.collection.service_parameters.order_field=E.pop()}}var y=function(){w.unmask(B.container);if(B.collection.getRequestCriteria().service_params.adv_search){var H=UWA.is(B.getOption("advSearchMgr"),"function")?B.getOption("advSearchMgr").call():null;if(UWA.is(H)){var G=false;H.getAndDisplayAdvancedSearch(G)}}if(B.view&&B.collection.service_parameters&&B.collection.service_parameters.order_by&&B.collection.service_parameters.order_field){var I=B.view.getManager().getOrderedColumnState();if(I){B.view.getManager().setColumnOrderState(I.dataIndex,"none")}B.view.getManager().setColumnOrderState(B.collection.service_parameters.order_field,B.collection.service_parameters.order_by)}c.mark("DS/SNResultUX/views/SearchTreeListView$_emptyDataGridAndReloadFirstPage$"+C+"$end")};var A=function(G){w.unmask(B.container);c.mark("DS/SNResultUX/views/SearchTreeListView$_emptyDataGridAndReloadFirstPage$"+C+"$end")};B.collection.getFirstPageOfResults({reset:true,onComplete:y,onFailure:A})},_setRowNumberWidth:function(z,y,x){var B=x?y.toString():(y+40).toString();var A=y.toString();if(B.length>A.length||x){if(B.length===3){z.options.headersDimensions.width=35}else{if(B.length===4){z.options.headersDimensions.width=45}else{if(B.length>4){z.options.headersDimensions.width=55}}}z._adjustLayout()}},_emptyDataGrid:function(){var A=this;if(A.view&&!o.is(A.view)){console.error("!UWACore.is(that.view)");return null}if(A.collection&&A.collection._snSkeleton&&A.collection._snSkeleton.resetMultisel&&A._viewRoot.currentViewId==="table"){A.collection._snSkeleton.resetMultisel()}var z=A.view.getManager();A._model.empty();z._setColumnsWidth();if(!o.is(A._emptyView)){var B=A.getOption("itemViewOptions");this._emptyView=new i(B)}var y;if(UWA.is(UWA.Widgets)&&UWA.is(UWA.Widgets.instances)){UWA.Widgets.instances.forEach(function(C){if(C.id===A.getOption("widgetId")){y=o.extendElement(C.elements.body).getElement(".wux-datagrid")}})}else{y=o.extendElement(document.body).getElement(".wux-datagrid");if(!UWA.is(y)){return}}var x=this._emptyView.render();if(o.is(x)&&o.is(y)){x.inject(y)}},setup:function(x){this._parent(x);var y=this;this.listenTo(this.collection,{onSync:function(){if(y.view){y.updateGridViewAfterSync()}}})},destroy:function(){this._actionsColumnViews.forEach(function(x){x.destroy()});this._actionsColumnViews=null;if(o.is(this._mySpinner)){this._mySpinner.destroy();this._mySpinner=null}if(o.is(this.colCustoPanel)&&o.is(this.colCustoPanel._requestClosePanel,"function")){this.colCustoPanel._requestClosePanel()}this.colCustoPanel=null;t.unsubscribe(this._subscriptions.sortForAllView);if(o.is(this.view)&&o.is(this.view.destroy,"function")){this.view.destroy()}this._parent()},_removeColumnCustoMask:function(){if(o.is(this.collection)&&o.is(this.collection._snSkeleton)&&o.is(this.collection._snSkeleton.getSearchActions,"function")){var x=this.collection._snSkeleton.getSearchActions();if(o.is(x)&&o.is(x.removeMask,"function")){x.removeMask()}}},defineColumnCusto:function(){var F=this;var L=null;var P=F.getOption("widgetId");if(!o.is(this.zIndexToUse)){this.zIndexToUse=a.getZIndex(this.container)}if(F.collection.isEmpty()){m._displayAlert({message:g.get("ColumnCustomization_error_noResult"),className:"warning",widgetId:P});F._removeColumnCustoMask();return null}if(o.is(F.collection)&&o.is(F.collection.service_parameters)&&o.is(F.collection.service_parameters.query)&&a.SearchTypeEnum.MY_RECENT_CONTENT===F.collection.service_parameters.query){m._displayAlert({message:g.get("SearchDataGridPreferences_error_RecentModeNotSupported"),className:"warning",widgetId:P});F._removeColumnCustoMask();return null}var G=false;var I=[];var x=null;if(o.is(F.collection.options.tagger_proxy)){x=F.collection.options.tagger_proxy.latest_tagValues}if(o.is(F.collection.service_parameters.isAPQSearch)&&F.collection.service_parameters.isAPQSearch===true){var z=F.collection.getPQ();if(o.is(z)&&o.is(z.pqName,"string")&&z.pqName.length>0){G=true;L={typeName:z,isPQ:true}}}var H=false;if(G){if(o.is(x,"array")&&x.length>0){var Q=0;for(var N=0;N<x.length;N++){var A=x[N];if(A.sixw==="ds6w:what/ds6w:type"){I.push("ds6wg:"+A.object);Q++}}if(Q===1){H=true}}}I.push("ds6wg:PLMEntity");var y=null;if(o.is(F.collection.options.tagger_proxy)){y=F.collection.options.tagger_proxy.getCurrentFilter()}if(!o.is(L)&&!(o.is(y)&&o.is(y.allfilters)&&((o.is(y.allfilters["ds6w:what/ds6w:type"])&&1===y.allfilters["ds6w:what/ds6w:type"].length)||(o.is(y.allfilters["ds6w:what/ds6w:kind"])&&1===y.allfilters["ds6w:what/ds6w:kind"].length)||(o.is(y.allfilters["sixw:ds6w:what/ds6w:type"])&&1===y.allfilters["sixw:ds6w:what/ds6w:type"].length)||(o.is(y.allfilters["sixw:ds6w:what/ds6w:kind"])&&1===y.allfilters["sixw:ds6w:what/ds6w:kind"].length)))){m._displayAlert({message:g.get("SearchDataGridPreferences_error_OnlyOneTypeOrSubTypeSupported"),className:"warning",widgetId:P});F._removeColumnCustoMask();return null}else{if(o.is(L)){var D=h.getOption("disable_PQ_multi_types_custo");if((o.is(D)&&D===true)&&G&&(o.is(H)&&H==false)){m._displayAlert({message:g.get("SearchDataGridPreferences_error_OnlyOneTypeOrSubTypeSupported_pq"),className:"warning",widgetId:P});F._removeColumnCustoMask();return null}}}var B=false;var O=null;if(o.is(y)&&o.is(y.allfilters)){if(o.is(y.allfilters["ds6w:what/ds6w:kind"])&&1===y.allfilters["ds6w:what/ds6w:kind"].length&&o.is(y.allfilters["ds6w:what/ds6w:kind"][0].object)&&o.is(y.allfilters["ds6w:what/ds6w:kind"][0].disptext)){L={typeName:y.allfilters["ds6w:what/ds6w:kind"][0].disptext,isPQ:false};var J=["ds6wg:"+y.allfilters["ds6w:what/ds6w:kind"][0].object];I.push(J)}else{if(o.is(y.allfilters["ds6w:what/ds6w:type"])&&1===y.allfilters["ds6w:what/ds6w:type"].length&&o.is(y.allfilters["ds6w:what/ds6w:type"][0].object)&&o.is(y.allfilters["ds6w:what/ds6w:type"][0].disptext)){B=true;L={typeName:y.allfilters["ds6w:what/ds6w:type"][0].disptext,isPQ:false,className:"ds6wg:"+y.allfilters["ds6w:what/ds6w:type"][0].object};O=y.allfilters["ds6w:what/ds6w:type"][0].object;I.push(O)}else{if(o.is(y.allfilters["sixw:vpmextension"])&&1===y.allfilters["sixw:vpmextension"].length&&o.is(y.allfilters["sixw:vpmextension"][0].object)&&o.is(y.allfilters["sixw:vpmextension"][0].displayValue)){L={typeName:y.allfilters["sixw:vpmextension"][0].displayValue,isPQ:false};var M=[y.allfilters["sixw:vpmextension"][0].object];I.push(M)}else{if(o.is(y.allfilters["sixw:ds6w:what/ds6w:type"])&&1===y.allfilters["sixw:ds6w:what/ds6w:type"].length&&o.is(y.allfilters["sixw:ds6w:what/ds6w:type"][0].object)&&o.is(y.allfilters["sixw:ds6w:what/ds6w:type"][0].displayValue)){B=true;L={typeName:y.allfilters["sixw:ds6w:what/ds6w:type"][0].displayValue,isPQ:false,className:y.allfilters["sixw:ds6w:what/ds6w:type"][0].object};O=y.allfilters["sixw:ds6w:what/ds6w:type"][0].object;I.push(O)}}}}}if(B){e.loadRelevantInterfaces(O,function(U){var W=[];for(var T=0;T<U.interfaces.length;T++){if(UWA.is(U.interfaces[T]["automatic"])&&U.interfaces[T]["automatic"]==="Yes"||UWA.is(U.interfaces[T]["Automatic"])&&U.interfaces[T]["Automatic"]==="Yes"){var S="";S=S.concat("ds6wg:",U.interfaces[T]["name"]);I.push(S);W.push(S)}}I.filter(function(aa,Z,Y){return Z==Y.indexOf(aa)});var V=p._asyncCallToPredicatesWS(I).then(function X(Y){F.renderColumnsWithSuccess(Y,F,L,W)},function R(Y){F.renderColumnsWithFailure(F,L,Y)})})}else{I.filter(function(T,S,R){return S==R.indexOf(T)});var K=p._asyncCallToPredicatesWS(I).then(function E(R){F.renderColumnsWithSuccess(R,F,L)},function C(R){F.renderColumnsWithFailure(F,L,R)})}},_launchColumnCustoPanel:function(A,y,z){var C=this,B=o.clone(y),x=l._computeColToDisplayInCustoPanel(B,z);require(["DS/SNResultUX/utils/SearchDataGridPreferences"],function(D){C.colCustoPanel=new D({spreadsheet:C.nestedView.view,availableColumns:x,searchDatagridView:C,predicateIntersection:z,typeToHandle:A,zIndexToUse:C.zIndexToUse});C.colCustoPanel.addEvent("onCloseColumnCustomizationPanel",function(E){if(o.is(C.colCustoPanel)&&o.is(C.colCustoPanel.destroy,"function")){C.colCustoPanel.destroy()}C.colCustoPanel=null})});C._removeColumnCustoMask()},renderColumnsWithSuccess:function(H,D,F,E){var O=D;var y=[];var x={};var G={};for(var J=0,z=H.classPredicates.length;J<z;J++){if(!o.is(H.classPredicates[J].className)||!o.is(H.classPredicates[J].vocabularyPredicateInfo)){console.warn("Unexpected response from GetRelevantPredicates !");O._removeColumnCustoMask();return null}if(o.is(F.className)&&F.className.length>0){for(var K=0,N=H.classPredicates[J].vocabularyPredicateInfo.length;K<N;K++){if(o.is(H.classPredicates[J].vocabularyPredicateInfo[K],"object")&&o.is(H.classPredicates[J].vocabularyPredicateInfo[K].nlsName,"string")&&o.is(H.classPredicates[J].vocabularyPredicateInfo[K].uri,"string")&&o.is(H.classPredicates[J].vocabularyPredicateInfo[K].name,"string")&&H.classPredicates[J].className===F.className){if(!o.is(G[H.classPredicates[J].vocabularyPredicateInfo[K].nlsName])){G[H.classPredicates[J].vocabularyPredicateInfo[K].nlsName]=[]}if(!o.is(x[H.classPredicates[J].vocabularyPredicateInfo[K].uri])){G[H.classPredicates[J].vocabularyPredicateInfo[K].nlsName].push(H.classPredicates[J].vocabularyPredicateInfo[K].uri);y.push({dispValue:H.classPredicates[J].vocabularyPredicateInfo[K].nlsName,sixw:H.classPredicates[J].vocabularyPredicateInfo[K].uri,type:a._getPredicateTypeFromDataType(H.classPredicates[J].vocabularyPredicateInfo[K])||"string",relatedObjectType:H.classPredicates[J].className,name:H.classPredicates[J].vocabularyPredicateInfo[K].name});x[H.classPredicates[J].vocabularyPredicateInfo[K].uri]=true}}else{console.warn("Invalid data returned by Predicates WS for class "+H.classPredicates[J].className+" for index "+K+" !");console.warn(H.classPredicates[J].vocabularyPredicateInfo)}}}else{if(o.is(F.typeName)){for(var K=0,N=H.classPredicates[J].vocabularyPredicateInfo.length;K<N;K++){if(o.is(H.classPredicates[J].vocabularyPredicateInfo[K],"object")&&o.is(H.classPredicates[J].vocabularyPredicateInfo[K].nlsName,"string")&&o.is(H.classPredicates[J].vocabularyPredicateInfo[K].uri,"string")&&o.is(H.classPredicates[J].vocabularyPredicateInfo[K].name,"string")){if(!o.is(G[H.classPredicates[J].vocabularyPredicateInfo[K].nlsName])){G[H.classPredicates[J].vocabularyPredicateInfo[K].nlsName]=[]}if(!o.is(x[H.classPredicates[J].vocabularyPredicateInfo[K].uri])){G[H.classPredicates[J].vocabularyPredicateInfo[K].nlsName].push(H.classPredicates[J].vocabularyPredicateInfo[K].uri);y.push({dispValue:H.classPredicates[J].vocabularyPredicateInfo[K].nlsName,sixw:H.classPredicates[J].vocabularyPredicateInfo[K].uri,relatedObjectType:H.classPredicates[J].className,name:H.classPredicates[J].vocabularyPredicateInfo[K].name});x[H.classPredicates[J].vocabularyPredicateInfo[K].uri]=true}}else{console.warn("Invalid data returned by Predicates WS for class "+H.classPredicates[J].className+" for index "+K+" !");console.warn(H.classPredicates[J].vocabularyPredicateInfo)}}}}if(o.is(E)&&E.length>0){for(var K=0,N=H.classPredicates[J].vocabularyPredicateInfo.length;K<N;K++){for(var L=0,A=E.length;L<A;L++){if(o.is(H.classPredicates[J].vocabularyPredicateInfo[K],"object")&&o.is(H.classPredicates[J].vocabularyPredicateInfo[K].nlsName,"string")&&o.is(H.classPredicates[J].vocabularyPredicateInfo[K].uri,"string")&&o.is(H.classPredicates[J].vocabularyPredicateInfo[K].name,"string")&&H.classPredicates[J].className===E[L]){if(!o.is(G[H.classPredicates[J].vocabularyPredicateInfo[K].nlsName])){G[H.classPredicates[J].vocabularyPredicateInfo[K].nlsName]=[]}if(!o.is(x[H.classPredicates[J].vocabularyPredicateInfo[K].uri])){G[H.classPredicates[J].vocabularyPredicateInfo[K].nlsName].push(H.classPredicates[J].vocabularyPredicateInfo[K].uri);y.push({dispValue:H.classPredicates[J].vocabularyPredicateInfo[K].nlsName,sixw:H.classPredicates[J].vocabularyPredicateInfo[K].uri,relatedObjectType:H.classPredicates[J].className,name:H.classPredicates[J].vocabularyPredicateInfo[K].name});x[H.classPredicates[J].vocabularyPredicateInfo[K].uri]=true}}else{console.warn("Invalid data returned by Predicates WS for class "+H.classPredicates[J].className+" for index "+K+" !");console.warn(H.classPredicates[J].vocabularyPredicateInfo)}}}}}var B=q.getSelectPredicates();if(UWA.is(B,"array")){for(var I=y.length-1;I>=0;I--){if(-1===B.indexOf(y[I].sixw)){y.splice(I,1)}}}for(var M=0,C=y.length;M<C;M++){if(o.is(G[y[M].dispValue],"array")&&G[y[M].dispValue].length>1){y[M].dispValue+=" ("+y[M].relatedObjectType+":"+y[M].sixw+")"}}O._launchColumnCustoPanel(F,O._columnsAttributes,y)},renderColumnsWithFailure:function(C,x,y){var B=C;console.error("promisePredicate fail !",arguments);var A=g.get("SearchDataGridPreferences_error_UnableToRetrievePredicates");if(o.is(y)){if(y.message){A+="<br>"+y.message}if(y.url){A+="<br>"+y.url}}m._displayAlert({message:A,className:"warning",widgetId:C.getOption("widgetId")});var z=[];B._launchColumnCustoPanel(x,B._columnsAttributes,z)},_deleteCustoPanel:function(){if(o.is(this.colCustoPanel)&&o.is(this.colCustoPanel._requestClosePanel,"function")){this.colCustoPanel._requestClosePanel()}},_updateColumns:function(A,N,I){var F=this;var R=F.getOption("widgetId");if(Array.isArray(A)&&F._searchcom_socket&&F.view.getManager()){F._searchcom_socket.dispatchEvent("checkNewColomnForSort",A);var x=A.map(function(U){return U.dataIndex});var B=F.view.getManager().getOrderedColumnState();if(B&&x.indexOf(B.dataIndex)===-1){if(h.getOption("default_sort")){var D=h.getOption("default_sort");if(o.is(D,"object")&&o.is(D.order_by,"string")&&o.is(D.order_field,"string")){F.collection.service_parameters.order_field=D.order_field;F.collection.service_parameters.order_by=D.order_by}}else{if(h.getOption("apply_sort_on_modified_by_default")){F.collection.service_parameters.order_field="ds6w:modified";F.collection.service_parameters.order_by="desc"}else{F.collection.service_parameters.order_field="";F.collection.service_parameters.order_by=""}}}}var y="",Q="",E,H=false;if(o.is(N,"string")){y=N;Q=N}else{if(o.is(N,"object")){y=N.custoName;E=N.custoNLS;Q=N.custoId;if(o.is(N.favPQ)&&true===N.favPQ){H=true}}}this._currentCustoViewId=Q;var O=[];A=b.getCustoCellRequest(A);for(var M=0,S=A.length;M<S;M++){if(o.is(A[M],"object")){var L=A[M].dataIndex;O.push(L.slice(L.lastIndexOf("/")+1,L.length))}}F.collection.setAttributesToRetrieve(O);var T=r.getItem("DataGridColumnCusto");var G;if(o.is(T)){if(o.is(T.activeView)&&false===H){this._lastSelectedCustoViewId=T.activeView}if(o.is(T.views)){G=T.views}}if(!o.is(G)){G=[]}if(Q!=="The_Default_Columns"){if(true===I){for(var K=G.length-1;K>=0;K--){var J=G[K];if(J.viewId===Q){G.splice(K,1)}}G.push({viewId:Q,viewDefinition:A,version:2})}var P={views:G};if(false===H){P.activeView=Q}else{if(o.is(T)&&o.is(T.activeView)){P.activeView=T.activeView}}r.setItem("DataGridColumnCusto",P);r.commit();if(true===I&&Q!=="TEMP_CUSTO"){m._displayAlert({message:g.replace(g.get("SearchDataGridPreferences_modal_saveSuccessful"),{custo_name:o.is(E,"string")?E:y}),className:"success",widgetId:R})}else{if(Q!=="TEMP_CUSTO"){var C=y;if(C.endsWith("-ADMIN")){C=C.slice(0,-6)}if(C.startsWith("###")){var z=C.substring(3,C.length);C=g.replace(g.get("custo_PQ"),{PQ:z})}if(C.endsWith("-HIDDEN")){m._displayAlert({message:g.get("SearchDataGridPreferences_modal_resetDone"),className:"success",widgetId:R})}else{m._displayAlert({message:g.replace(g.get("SearchDataGridPreferences_modal_applySuccessful"),{custo_name:C}),className:"success",widgetId:R})}}else{m._displayAlert({message:g.get("SearchDataGridPreferences_modal_applyTempCustoSuccessful"),className:"success",widgetId:R})}}}else{var T=r.getItem("DataGridColumnCusto");var G;if(o.is(T)){T.activeView="The_Default_Columns"}this._lastSelectedCustoViewId="The_Default_Columns";r.setItem("DataGridColumnCusto",T);r.commit();m._displayAlert({message:g.get("SearchDataGridPreferences_modal_resetDone"),className:"success",widgetId:R})}this._columnsAttributes=A;this._columns=o.clone(this._columnsAttributes);this.reloadColumn();F._reDefColumns();this.comptuteNewColumnsNLS();F._forcedCustoView=Q;F.collection._snSkeleton._loadFirstPage()},updateColumnWidth:function(E){var x=E.columnID;var z=E.width;var D=E.dataIndex;if(o.is(D)){if(o.is(localStorage)){if(this.view&&this.view._datagrid.options.columns){var y={};var G=r.getItem("listColumnsWidth");if(o.is(G,"string")&&G.length>0){try{var F=JSON.parse(G);for(var A=0;A<Object.keys(F).length;A++){y[Object.keys(F)[A]]=F[Object.keys(F)[A]]}}catch(C){console.log(C)}}y[D]=z;var B=JSON.stringify(y);r.setItem("listColumnsWidth",B);r.commit()}}}},reloadColumn:function(){var x=this.view.options;x.columns.length=3;var z=this._columns;for(var y=0;y<=z.length-1;y++){if(z[y]){x.columns.push(z[y])}}if(this._model.getChildren()&&this._model.getChildren().length>0){this._model.empty()}this.view.loadColumns(x.columns)},comptuteNewColumnsNLS:function(){var A=this;var C=[];for(var z=0,x=this._columnsAttributes.length;z<x;z++){C.push(this._columnsAttributes[z].dataIndex)}var B="";if(o.is(A.collection)&&o.is(A.collection.search_ressources)&&o.is(A.collection.search_ressources.getActiveTenant,"function")){B=A.collection.search_ressources.getActiveTenant()}if(C.length>0){var y=C.join("\r\n");n.getResourcesInfo(y,{tenantId:B,lang:a.getLanguage(),apiVersion:"R2019x",onComplete:function(E){console.log(E);if(!o.is(E)){console.error("Unexpected response from getResourcesInfo !");return null}var F=false;for(var D=0,G=A._columnsAttributes.length;D<G;D++){for(var I=0,H=E.length;I<H;I++){if(!o.is(E[I].curi)||!o.is(E[I].label)){console.error("Unexpected response from getResourcesInfo !");return null}if(E[I].curi===A._columnsAttributes[D].dataIndex){if(A._columnsAttributes[D].text!==E[I].label){A._columnsAttributes[D].text=E[I].label;F=true}}}}if(F){A.updateColumnsNLS()}},onFailure:function(D){console.warn("not able to load predicates")}})}},setShadings:function(z){this.log("DataGridView setShadings");if(this.collection&&this.collection.length&&this.view){var x=0;var y=this.view.getManager();if(y){y.prepareUpdateView();this.collection.forEach(function(A){if(!z){y.unstyleRow(x)}else{for(var B=0;B<z.length;B++){if(z[B].criteria(A)){y.styleRow(x,{"background-color":z[B].color})}}}x++});y.pushUpdateView()}}},updateView:function(){this.view&&this.view.getManager()&&this.view.getManager().updateView()},createMultiCheckbox:function(){var x=this;x.view.getManager().registerReusableCellContent({id:"checkbox_search",buildContent:function(){var y=new d();y.getContent().addEventListener(f.POINTERDOWN,function(A){A.stopPropagation()});y.getContent().addEventListener(f.POINTERUP,function(A){A.stopPropagation()});y.getContent().addEventListener("touchstart",function(A){A.stopPropagation()});y.getContent().addEventListener("touchend",function(A){A.stopPropagation()});y.getContent().addEventListener("focus",function(A){A.preventDefault();A.stopPropagation()});var z=x.view.getManager();y.getContent().addEventListener("change",function(A){if(!y.ignoreUpdate){if(y.currentNodeModel===null){if(UWA.is(x.collection&&x.collection.getSNSkeleton())){if(y.checkFlag&&z.getNodesXSO().get().length===0){t.publish({channel:x.collection.getSNSkeleton().getOption("messagingChannel"),topic:"onFetchAndSelectAll",data:{DoSelection:true}})}else{t.publish({channel:x.collection.getSNSkeleton().getOption("messagingChannel"),topic:"onResetMultisel",data:{}})}}}}});return y}});x.initMultiCheckbox()},initMultiCheckbox:function(){var y=this.view.getManager();var x=y.getNodesXSO();var z=this;x.onEmpty(function(){var A=y.getVirtualViewport();y.updateCellView(-1,"selection_search");for(var B=A.minRowID;B<=A.maxRowID;B++){y.updateCellView(B,"selection_search")}});x.onAdd(function(A){y.updateCellView(-1,"selection_search");y.updateCellView(A,"selection_search")});x.onRemove(function(A){y.updateCellView(-1,"selection_search");y.updateCellView(A,"selection_search")})},render:function(){var x=this;x._parent();require(["DS/SNResultUX/views/WebUX/Tree/TreeListView"],function(B){x._reinitialisationColums(x.options);var A=x._canMultiSelect;var y={columns:o.clone(x._columnsAttributes),treeDocument:x._model,height:"auto",headersDimensions:{width:35,height:30},defaultCellHeight:30,resize:{columns:true,rows:false},apiVersion:2,selection:{rowHeaders:false,columnHeaders:false,cells:false,unselectAllOnEmptyArea:true,canMultiSelect:A,enableListSelection:true,toggle:false},show:{rowHeaders:true,canMultiSelect:A},performances:{buildLinks:false,useRequestAnimationFrameRendering:false,debounceCellInternalUpdateTimer:0,},enableActiveUI:true,enableKeyboardNavigation:true,infiniteScrolling:true,rowsAreDraggable:true,nodesAreDraggable:false,useTransparentScroller:false,shouldDisplayTooltip:function(E){var D="";if(E.dataIndex==="selection"){return{longHelp:D}}if(E.isHeader&&o.is(E.manager.options.columns[E.virtualColumnID])){D=E.manager.options.columns[E.virtualColumnID].text}else{if(true===h.getOption("webUXTooltip")){if(o.is(E.nodeModel)&&o.is(E.nodeModel._options)&&o.is(E.nodeModel._options.customTooltip)){return E.nodeModel._options.customTooltip}}else{var C=null;if(o.is(E.cellModel)&&o.is(E.cellModel.options)&&o.is(E.cellModel.options.value)){C=E.cellModel.options.value}if(o.is(E.nodeModel)&&o.is(E.nodeModel._options)&&o.is(E.nodeModel._options._attributes)&&o.is(E.nodeModel._options._attributes[E.dataIndex])){C=E.nodeModel._options._attributes[E.dataIndex]}if(o.is(C)){if(o.is(C,"string")){D=a.decodeHtml(C)}else{if(o.is(C)&&o.is(C.toString,"function")){D=a.decodeHtml(C.toString())}}}}}return{longHelp:D}},onDragStartColumnHeaderDefault:function(D,C){if(D){D.preventDefault();D.stopPropagation()}}};y=b.initColumnsTreeList(y,x.options);if(UWA.is(y,"object")&&UWA.is(y.columns,"array")&&y.columns.length>1&&y.columns[2].dataIndex==="actions"){y.columns[2].onCellRequest=function(H){if(!(H.nodeModel instanceof Object&&H.virtualColumnID===2)||H.isHeader){return}var G=H.nodeModel.options.collection;var C=G.at(H.virtualRowID);if(!UWA.is(C)){return}var D='<span style="font-size:18px; color:gray;" class="fonticon fonticon-2x fonticon-down-open" data-rec-id="dropdown-icon-';if(o.is(H.virtualRowID)&&o.is(G.at(H.virtualRowID))){D+=G.at(H.virtualRowID).get("id")}D+='"></span>';H.cellView.getContent().setHTML(D);var F=H.cellView.getContent().getChildren()[0];x._actionsColumnViews.push(F);F.addEvent("mouseup",function(J){if(J){J.cancelBubble=true}if(J&&J.stopPropagation){J.stopPropagation()}if(J&&J.preventDefault){J.preventDefault()}var I=H.parent.options.onContextualEvent;I.callback.call(I["this"],{treeview:H})});var E=F.addClassName("column-action");E.style.display=(!H.manager.multiselMode)?"":"none"}}y.keymaps={"/":"treelistview:collapse-all-node","*":"treelistview:expand-all-node","+":"treelistview:expand-node","-":"treelistview:collapse-node","ctrl+space":"treelistview:toggle-selection","ctrl+right":"empty","shift+right":"empty",right:"empty","ctrl+left":"empty","shift+left":"empty",left:"empty","ctrl+up":"treelistview:go-to-previous-visible-node","shift+up":"treelistview:go-to-previous-visible-node",up:"treelistview:go-to-previous-visible-node","ctrl+down":"treelistview:go-to-next-visible-node","shift+down":"treelistview:go-to-next-visible-node",down:"treelistview:go-to-next-visible-node",esc:"treelistview:edit-cancel",pageup:"treelistview:go-to-previous-page-node",pagedown:"treelistview:go-to-next-page-node",home:"treelistview:go-to-first-visible-node",end:"treelistview:go-to-last-visible-node"};y.performances.renderingMode="adaptive";var z=x.getOptionCommon();z=Object.assign(z,y);x.view=new B(z);a.isFUNActive("FUN075064")&&x.createMultiCheckbox();x.updateGridViewAfterSync();x.view.inject(x.container);x._model.search_multiselMode&&x.toggleMultiSelMode(true);x._managerInit();x._afterRender()});return this},_afterRender:function(){this.view.empty=function(){return};this._parent()}})});define("DS/SNResultUX/utils/SearchActions",["UWA/Core","UWA/Promise","UWA/Controls/Abstract","UWA/Class","UWA/Utils/Client","UWA/Class/Debug","UWA/Class/Events","DS/MessageBus/MessageBus","DS/WAFData/WAFData","DS/SNResultUX/collections/SearchCollection","require","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchCustoServices","DS/UIKIT/Alert","DS/UIKIT/Autocomplete","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/UIKIT/Input/Select","DS/Controls/Toggle","DS/Controls/ComboBox","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/Controls/Button","DS/Windows/Dialog","DS/Controls/Tab","DS/W3DXComponents/Collections/ActionsCollection","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNResultUX/utils/SearchViewOptions","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/SNInfraUX/Logger","DS/Windows/ImmersiveFrame"],function(z,x,E,l,n,u,e,t,j,K,L,y,d,I,a,G,m,C,k,q,g,J,p,c,A,B,h,i,f,H,o,v,b,w){var D=H.get("loading");var F=function(N){if(isNaN(N)){return false}var M=parseFloat(N);return(M|0)===M};var r=l.extend(e,u,{name:"DS_SNResultUX_utils_SearchActions",CSVpromise:x.deferred(),attributeToFilterForExport:["id","type_icon_url","preview_url","actions","resourceid","resourceid_tagger","actions"],globalActions:["exportToCmd","print","save_search","refresh_search","kpi_pcs_action","Grid_Custo","Preview","InfoPanel","Pin"],current_collection:null,current_selected:null,displayMode:null,skeleton:null,snSkeletonMgt:null,initDateDiplayMode:null,searchContentSetDivContainer:null,maskedElement:null,actionCollectionUsedBySkeleton:null,actionCollectionOriginal:null,actionInitDone:false,_actionTooltips:null,actionOneSearch:null,init:function(M){this.setDebugMode(y.getDebugMode());if(z.is(M)&&z.is(M.SNSkeleton)){this.snSkeletonMgt=M.SNSkeleton}this._actionTooltips=[]},destroy:function(){if(this.popover){this.popover.hide()}this.current_collection=null;this.current_selected=null;this.displayMode=null;this.skeleton=null;this.snSkeletonMgt=null;this.searchContentSetDivContainer=null;this.actionCollectionUsedBySkeleton=null;this.actionCollectionOriginal=null;this.actionOneSearch=null;this._actionTooltips.forEach(function(M){M.destroy()});this._actionTooltips=null},setCollection:function(M){this.current_collection=M},setSelected:function(M){this.current_selected=M},setSkeleton:function(M){this.skeleton=M},setSearchContentSetDivContainer:function(M){this.searchContentSetDivContainer=M},setEmptyViewMessage:function(M){D=M},getEmptyViewMessage:function(){return D},setDisplayMode:function(N){var M=this;this.displayMode=N;if(!z.is(this.searchContentSetDivContainer)){return}if(!z.is(this.actionCollectionOriginal)){return}var O="";if(z.is(M.current_collection)&&z.is(M.current_collection.search_ressources)&&z.is(M.current_collection.search_ressources.getActiveTenant,"function")){O=M.current_collection.search_ressources.getActiveTenant()}d.getGrantedRoles(function(Y){M.log("Roles:"+Y);var T;var ag=false;var X=y.getOption("search_compact_mode");if(z.is(X)){ag=true;T=M.actionOneSearch}else{M.actionCollectionUsedBySkeleton.reset(M.actionCollectionOriginal.toArray());T=M.actionCollectionUsedBySkeleton}var ae=z.extendElement(M.searchContentSetDivContainer).getElements(".content-set-actions");if(z.is(ae)&&ae.length>0){for(var ad=T.size()-1;0<=ad;ad--){var ac=T.at(ad);var Q=ac.get("icon");var ab=ac.get("displayMode");var aa=ac.get("id");var R=ac.get("role");var U=true;if(!z.is(ab,"string")){U=true}else{if(ab==="AllView"){U=true}else{if(ab.search(N)>=0){U=true}else{U=false}}}if(U&&z.is(Y,"array")&&Y.length>0){if(z.is(R,"array")&&0<R.length){U=false;var P=0,S=R.length;for(P=0;P<S;P++){if(Y.some(function(ah){if(ah&&ah.id==R[P]){if(z.is(ah.platforms)){return ah.platforms.some(function(ai){return ai===O})}}else{if(ah&&ah.id==="InternalDS"){return true}}})){U=true}}}else{if(z.is(R,"string")&&R.length>0){U=Y.some(function(ah){if(ah&&ah.id==R){if(z.is(ah.platforms)){return ah.platforms.some(function(ai){return ai===O})}}else{if(ah&&ah.id==="InternalDS"){return true}}})}}}if(!U){if(ag===true){ac.set({visible:U})}else{T.remove(ac)}}var V=z.extendElement(ae[0]).getElements(".fonticon-"+Q);if(z.is(V)&&V.length>0){var af=V[0];if(z.is(af)&&z.is(af.getParent())&&z.is(af.getParent().getParent())){var Z=af.getParent().getParent();if(!M.actionInitDone){var W=aa;W=H.get("actions."+aa+".toolTip");M._actionTooltips.push(new q({position:"bottom",target:Z,body:W}))}}}}M.actionInitDone=true}})},_shouldBeAvailableIfInContextMode:function(P,O){var Q=true;if(UWA.is(P)){var N=P.in_apps_search;if(UWA.is(N)){if(O=="saveAsFavorite"){Q=false}if(UWA.is(N.UXOptions,"object")){if(UWA.is(N.UXOptions.globalToolbarActions,"object")){var M=N.UXOptions.globalToolbarActions[O];if(UWA.is(M,"boolean")){Q=M}}}else{if(O==="columnCusto"){if(UWA.is(N.columnCustoAvailable)){Q=N.columnCustoAvailable}}}}}return Q},getGlobalActions:function(O){var S=this;var ae=null;var Z=false;function T(af){return S._shouldBeAvailableIfInContextMode(O,af)}this.actionOneSearch=new f();this.actionCollectionUsedBySkeleton=new f();this.actionCollectionUsedBySkeleton["data-rec-id"]=true;var W=d.isInTheSimpleSearch({tenant:O.tenant});var ac=false;if(z.is(W)){var V=y.getOption("search_compact_mode");if(z.is(V)){ac=true;if(V===false){W=false}}}if(I.getItem("integratedSearch")===true){var X=true;if(window&&window.clntlang){X=false}else{if(y.getOption("search_web_in_win")===true){X=false}else{if(z.is(O)&&z.is(O.pinToDashboard)&&O.pinToDashboard===false){X=false}}}if(X===true&&T("pinToDashboard")){ae={id:"Pin",title:H.get("actions.Pin.title"),icon:"publish",overflow:false,displayMode:"AllView",attributes:{"data-rec-id":"Pin"}};if(ac===false){this.actionCollectionUsedBySkeleton.add(ae)}else{this.actionOneSearch.add(ae)}}}var U=d.identifyClientInfo();var Y=function(){var af=false;if(W===false){if(y.getOption("enableNewSearchViews")!==true){if(UWA.is(U)&&(U.identifier!=="3DSwym")){af=true}}}return af};var ab=Y();var Q=false;if(a.getpreviewPanel(O)===true&&T("preview")&&Y()===true){Q=true}if(z.is(y.getOption("search_compact_mode"))){Q=true}if(Q===true){ae={id:"Preview",title:H.get("actions.Preview.title"),icon:"eye",overflow:false,displayMode:"AllView",attributes:{"data-rec-id":"Preview"}};this.actionCollectionUsedBySkeleton.add(ae);this.actionOneSearch.add(ae)}if(T("informations")&&ab===true){ae={id:"InfoPanel",title:H.get("actions.InfoPanel.title"),icon:"info",overflow:false,displayMode:"AllView",attributes:{"data-rec-id":"InfoPanel"}};if(ac===false){this.actionCollectionUsedBySkeleton.add(ae)}else{this.actionOneSearch.add(ae)}}var N=true;if(W===true){N=false;if(I.getItem("integratedSearch")===true){N=true}}if(N===true){var aa="AllView";if(z.is(S.snSkeletonMgt)&&z.is(S.snSkeletonMgt.getSearchWidget,"function")&&z.is(S.snSkeletonMgt.getSearchWidget())&&z.is(S.snSkeletonMgt.getSearchWidget().getValue,"function")){var P=S.snSkeletonMgt.getSearchWidget().getValue("addinmode");if(z.is(P)&&P.length>0){var R=this._listUISettingsToDisplay();if(z.is(R)&&R.length>0){aa="table"}}}ae={id:"Grid_Custo",title:H.get("actions.Grid_Custo.title"),icon:"cog",overflow:false,displayMode:aa,attributes:{"data-rec-id":"Grid_Custo"}};if(ac===false){this.actionCollectionUsedBySkeleton.add(ae)}else{this.actionOneSearch.add(ae)}}if(y.getOption("global_action_save_search")&&T("saveAsFavorite")){Z=true;if(W===true&&I.getItem("NofavoritesOnBar")===true){Z=false}if(Z===true){ae={id:"save_search",title:H.get("actions.save_search.title"),icon:"star",overflow:false,displayMode:"AllView",role:["CSV","InternalDS"],attributes:{"data-rec-id":"save_search"}};if(ac===false){this.actionCollectionUsedBySkeleton.add(ae)}else{this.actionOneSearch.add(ae)}}}var ad=false;if(y.getOption("global_action_refresh_search")&&(y.getOption("search_web_in_win"))||I.getItem("integratedSearch")){ad=true;if(I.getItem("integratedSearch")){if(z.is(O)&&z.is(O.pinToDashboard)&&O.pinToDashboard===false){ad=false}}}if(z.is(y.getOption("search_compact_mode"))&&y.getOption("search_web_in_win")){ad=true}if(ad===true){ae={id:"refresh_search",title:H.get("actions.refresh_search.title"),icon:"cw",overflow:false,displayMode:"AllView",attributes:{"data-rec-id":"refresh_search"}};if(ac===false){this.actionCollectionUsedBySkeleton.add(ae)}else{this.actionOneSearch.add(ae)}}if((y.getOption("global_action_export_csv")||y.getOption("global_action_export_xml"))&&T("export")){Z=true;if(W===true&&I.getItem("NoexportOnBar")===true){Z=false}if(Z===true){ae={id:"exportToCmd",title:H.get("actions.exportToCmd.title"),icon:"export",overflow:false,displayMode:"AllView",attributes:{"data-rec-id":"exportToCmd"}};if(ac===false){this.actionCollectionUsedBySkeleton.add(ae)}else{this.actionOneSearch.add(ae)}}}if((y.getOption("global_action_default_print")||y.getOption("global_action_print_xsl"))&&T("print")){Z=true;if(W===true&&I.getItem("NoprintOnBar")===true){Z=false}if(Z===true){ae={id:"print",title:H.get("actions.print.title"),icon:"print",overflow:false,displayMode:"AllView",attributes:{"data-rec-id":"print"}};if(ac===false){this.actionCollectionUsedBySkeleton.add(ae)}else{this.actionOneSearch.add(ae)}}}if(y.getOption("search_web_in_win")){ae={id:"BI_Activated",title:H.get("actions.BI_Activated.title"),icon:"chart-pie",overflow:false,displayMode:"AllView",attributes:{"data-rec-id":"BI_Activated"}};if(ac===false){this.actionCollectionUsedBySkeleton.add(ae)}else{this.actionOneSearch.add(ae)}}if(y.getOption("no_kpi_pcs")){this.log("PCS view deactivated")}else{ae={id:"kpi_pcs_action",title:"PCS",icon:"chart-line",overflow:false,callback:function(){require(["DS/SNResultUX/views/PCSView"],function(af){var ah=z.extendElement(document.body).getElement(".onesearch_results"),ag=z.extendElement(ah).getElement(".onesearch_skeleton");ag.setStyle("display","none");new af({renderTo:ah,events:{onClose:function(){ag.setStyle("display","block")}}})})},attributes:{"data-rec-id":"kpi_pcs_action"}};if(ac===false){this.actionCollectionUsedBySkeleton.add(ae)}else{this.actionOneSearch.add(ae)}}var M={collection:this.actionCollectionUsedBySkeleton,events:{onActionClick:function(ah,af,ag){this.dropDown&&this.dropDown.hide();O.actionItem=af;S.onActionClick(O)},onActionClickDotted:function(){S.popover&&S.popover.destroy();S.popover=null}}};this.actionCollectionOriginal=this.actionCollectionUsedBySkeleton.clone();this.actionCollectionDefault=new f(this.actionCollectionUsedBySkeleton.toJSON());return M},isGlobalActions:function(O){var N=this.globalActions.length;var M=0;for(M=0;M<N;M++){if(O===this.globalActions[M]){return true}}return this.isNonDefaultGlobalAction(O)},updateGlobalActions:function(){if(!z.is(this.actionCollectionOriginal)){return}var M=new f(this.actionCollectionDefault.toJSON(),{comparator:"index"});this._addNonDefaultGlobalActions(M);this.actionCollectionUsedBySkeleton.reset();this.actionCollectionUsedBySkeleton.add(M.toArray());this.actionCollectionOriginal=this.actionCollectionUsedBySkeleton.clone();M=null;if(z.is(this.displayMode)){this.setDisplayMode(this.displayMode)}},_addNonDefaultGlobalActions:function(N){var M=this._getNonDefaultGlobalActions();if(z.is(M)){M.forEach(function(P){var O={id:P.id,title:P.title,icon:P.icon,overflow:P.overflow,displayMode:"AllView",index:P.index};if(z.is(P.displayMode)){O.displayMode=P.displayMode}N.add(O)})}},isNonDefaultGlobalAction:function(O){var M=this._getNonDefaultGlobalActions();if(z.is(M)){var N=M.some(function(P){if(O===P.id){return true}});return N}return false},_runNonDefaultGlobalAction:function(O,Q){var P=this;if(!z.is(O)){throw ("E_INVALIDARG: bad option given to _runNonDefaultGlobalAction method !")}var M=this._getNonDefaultGlobalActions();if(z.is(M)){var N=M.some(function(R){if(Q===R.id){var S=R.command_data;P.dispatchEvent("onNonDefaultGlobalAction",{id:Q,command_data:S});return true}});return N}return false},_getNonDefaultGlobalActions:function(){var M=o.getViewData();if(z.is(M)&&z.is(M.global_actions)){return M.global_actions.actions}},onActionClick:function(N){var P=this;if(z.is(P.popover)){P.popover.destroy();P.popover=null}if(!z.is(N)||!z.is(N.actionItem)){throw ("E_INVALIDARG: bad options given to onActionClick method !")}var O=N.actionItem,M=this.current_collection,Q=O.model.get("id");switch(Q){case"exportToCmd":this.log("exportToCmd in actionbar");P.exportToCmd(N);break;case"print":this.log("print in actionbar");P.print(N);break;case"save_search":this.log("save search in actionbar");P.saveSearchUI(O,M.service_parameters);break;case"refresh_search":this.log("refresh search pressed in global actionbar");P.dispatchEvent("onRefreshResultRequest");break;case"kpi_pcs_action":O.model.get("callback").call(null);break;case"BI_Activated":this.log("BI is Activated");this.current_collection._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"BI_Activated",notif_parameters:""},"search_web_in_win");break;case"Grid_Custo":this.log("Grid_Custo");P.searchSettingsUI(O);break;case"InfoPanel":this.log("InfoPanel");P.informationPanel(O);break;case"Preview":this.log("Preview");P.PreviewPanel(O);break;case"Pin":this.log("Pin");P.PinToDashboard(O);break;default:if(!this._runNonDefaultGlobalAction(N,Q)){this.log("multisel pressed in global actionbar");P.multisel(N)}break}},downloadFile:function(U,V,P){if(!z.is(U)){return}if(!z.is(P)){return}var N=document,R=N.createElement("a");var T=P;P=P||"application/octet-stream";P+=";charset=UTF-8,";var S;if(!V){var O=new Date();V="CSV Export - "+O.getFullYear()+(O.getMonth()+1)+O.getDate()+O.getHours()+O.getMinutes()+O.getSeconds()+".csv"}var Q="\ufeff";if(navigator.msSaveBlob&&!a.odtMode){return navigator.msSaveBlob(new Blob([Q+U],{type:P}),V)}if("download" in R){var M=new Blob([Q+U],{type:P});S=URL.createObjectURL(M);R.setAttribute("download",V)}else{if(n.Engine.safari&&n.Platform.ios){var M=new Blob([Q+U],{type:T});S=(window.URL?URL:window.webkitURL).createObjectURL(M)}else{S="data:"+P+Q+encodeURIComponent(U)}R.setAttribute("target","_blank");R.setAttribute("download",V)}R.href=S;R.setAttribute("style","display:none;");N.body.appendChild(R);setTimeout(function(){if(R.click){R.click()}else{if(document.createEvent){var W=document.createEvent("MouseEvents");W.initEvent("click",true,true);R.dispatchEvent(W)}}N.body.removeChild(R)},100)},exportToCmd:function(N,M){if(!z.is(N)||!z.is(N.actionItem)){throw ("E_INVALIDARG: bad options given to exportToCmd method !")}var O=this;var P={DoSelection:false,callback:this.exportToCmdCallback,exportToCmdCallback_options:N,exportToCmdCallback_cb:M,type:"action",subType:"export",context:O};if(y.getOption("select_all_export_print")&&(!z.is(O.current_selected)||(z.is(O.current_selected)&&(O.current_selected.length===0)))){this.snSkeletonMgt.fetchAll(P)}else{this.exportToCmdCallback(P)}},exportToCmdCallback:function(M){var N=M.exportToCmdCallback_options.actionItem;var O=this;if(y.options.search_settings.global_action_export_csv&&!y.options.search_settings.global_action_export_xml){O.exportToCSV(M.exportToCmdCallback_options,M.exportToCmdCallback_cb);return}else{if(!y.options.search_settings.global_action_export_csv&&y.options.search_settings.global_action_export_xml){O.exportToXML(M.exportToCmdCallback_options);return}else{b.warn("Not allowed to activate both export to CSV and export to XML options !!!");return}}},_formatLocalDate:function(){var M=new Date(),P=-M.getTimezoneOffset(),N=P>=0?"+":"-",O=function(Q){var R=Math.abs(Math.floor(Q));return(R<10?"0":"")+R};return M.getFullYear()+"-"+O(M.getMonth()+1)+"-"+O(M.getDate())+"T"+O(M.getHours())+":"+O(M.getMinutes())+":"+O(M.getSeconds())+N+O(P/60)+":"+O(P%60)},exportToCSV:function(W,P){if(!z.is(W)){throw ("E_INVALIDARG: bad options given to exportToCSV method !")}var Q=this;function O(Z){var X=Q.current_collection;var aa;if(z.is(Q.current_selected)&&(Q.current_selected.length>0)){aa=X._models.slice();X._models=Q.current_selected}var Y=y.getOption("exportFilename")?y.getOption("exportFilename"):"search_"+Q._formatLocalDate().slice(0,19);Q.downloadFile(N(Z,X),Y+".csv","text/csv");if(z.is(P)){P.call(this)}if(z.is(Q.current_selected)&&(Q.current_selected.length>0)){X._models=aa}}function V(X){if(z.is(X,"string")&&X.length>0){return X.split("&quot;").join('""')}else{return X}}function N(ac,Y){var ab=y.getOption("csvSeparator");var X="";for(var aa=0,Z=ac.length;aa<Z;aa++){if(Q.attributeToFilterForExport.indexOf(ac[aa].dataIndex)===-1){if(n.Platform.ios){X=X+'"'+ac[aa].text+'";'}else{X=X+'"'+ac[aa].text+'"'+ab}}}X=X+"\r\n";Y.forEach(function(af,ae){for(var ag=0,ad=ac.length;ag<ad;ag++){if(Q.attributeToFilterForExport.indexOf(ac[ag].dataIndex)===-1){var aj=Q._getValueWithMapping(ac[ag].dataIndex,af,W.itemViewOptions.mapping);if(z.is(aj,"array")){for(var ai=0,ah=aj.length;ai<ah;ai++){aj[ai]=V(aj[ai])}}else{aj=V(aj)}aj=d.decodeHtml(aj);if(n.Platform.ios){X=X+'"'+aj+'";'}else{X=X+'"'+aj+'"'+ab}}}X=X+"\r\n"});return X}var T=[];var M=o.getDataGridViewHeaders();if(z.is(Q.snSkeletonMgt)&&z.is(Q.snSkeletonMgt._myDatagridView)&&z.is(Q.snSkeletonMgt._myDatagridView._columns)&&(Object.keys(Q.snSkeletonMgt._myDatagridView._columns).length>0)){M=Q.snSkeletonMgt._myDatagridView._columns}for(var R=0,U=M.length;R<U;R++){T.push(M[R].dataIndex)}var S="";if(z.is(Q.current_collection)&&z.is(Q.current_collection.search_ressources)&&z.is(Q.current_collection.search_ressources.getActiveTenant,"function")){S=Q.current_collection.search_ressources.getActiveTenant()}v.getResourcesInfo(T.join(","),{tenantId:S,lang:d.getLanguage(),apiVersion:"R2019x",onComplete:function(aa){if(z.is(aa,"array")){var Y={};for(var Z=0,X=aa.length;Z<X;Z++){if(z.is(aa[Z],"object")&&z.is(aa[Z].curi,"string")){Y[aa[Z].curi]=aa[Z].label}}for(var Z=0,X=M.length;Z<X;Z++){if(z.is(M[Z],"object")&&z.is(M[Z].dataIndex),"string"){M[Z].text=Y[M[Z].dataIndex]}}}aa&&O.call(Q,M)},onFailure:function(X){b.info(X);X&&O.call(Q,M)}})},exportToXML:function(N,M){},print:function(U,P){this.log("print");var T=this;if(!z.is(U)||!z.is(U.actionItem)){throw ("E_INVALIDARG: bad options given to print method !")}var R=U.actionItem,N=this.current_collection;var M;if(!z.is(N)||!z.is(N.totalCount)||isNaN(N.totalCount)){throw ("Pb with searchCollection found for print method !")}if(z.is(T.current_selected)&&(T.current_selected.length>0)){M=N._models.slice();N._models=T.current_selected}var Q=N.totalCount;if(!z.is(N._models)||!z.is(N._models.length)||isNaN(N._models.length)){throw ("No searchCollection._models found for print method !")}var S=N._models.length;if(Q!==S){b.warn("Not all results are displayed, must refresh the search result, TO DO !!!")}var O={DoSelection:false,callback:this.printCallback,exportToCmdCallback_options:U,exportToCmdCallback_cb:P,type:"action",subType:"print",context:T};if(y.getOption("select_all_export_print")&&(!z.is(T.current_selected)||(z.is(T.current_selected)&&(T.current_selected.length===0)))){this.snSkeletonMgt.fetchAll(O)}else{this.printCallback(O)}if(z.is(T.current_selected)&&(T.current_selected.length>0)){N._models=M}},printCallback:function(M){var N=this;if(y.options.search_settings.global_action_default_print&&!y.options.search_settings.global_action_print_xsl){this._defaultPrint(M.exportToCmdCallback_options,M.exportToCmdCallback_cb);return}else{if(!y.options.search_settings.global_action_default_print&&y.options.search_settings.global_action_print_xsl){this.exportToXML(M.exportToCmdCallback_options,"SearchPrint.xsl");return}else{b.warn("Not allowed to activate both print options !!!");return}}},_printWindowOpen:function(){return(typeof this.printWindow!=="undefined"&&null!==this.printWindow&&this.printWindow.closed===false)},_defaultPrint:function(V,O){if(!z.is(V)){throw ("E_INVALIDARG: bad options given to _defaultPrint method !")}var Q=this;function M(aa){var W=Q.current_collection,Z="";var ab;if(z.is(Q.current_selected)&&(Q.current_selected.length>0)){ab=W._models.slice();W._models=Q.current_selected}if(z.is(Q.snSkeletonMgt)){Z=Q.snSkeletonMgt.getTitle()}if(true===V.ODT&&z.is(V.PrintWindow,"object")){Q.myPrintWindow=V.PrintWindow}var X="";if(Q._printWindowOpen()){Q.myPrintWindow.close()}var Y=function(){if(!(true===V.ODT&&z.is(V.PrintWindow,"object"))){Q.myPrintWindow=window.open("","PrintWindow","width=1024, height=768, scrollbars=yes")}if(typeof Q.myPrintWindow==="undefined"){this.log("Unable to open window !");return}Q.snSkeletonMgt.setPrintWindow(Q.myPrintWindow);X+="<html><head><title>Print Me</title></head><body>";X+="<h1>"+Z+"</h1>";X+='<table style="border:1px solid black; border-collapse:collapse; table-layout:fixed; width: -webkit-fill-available; word-break: break-all; font-size: xx-small; white-space: pre-wrap;"><thead><tr>';var ae="";for(var ad=0,ac=aa.length;ad<ac;ad++){if(Q.attributeToFilterForExport.indexOf(aa[ad].dataIndex)===-1){X+='<th  style="border:1px solid black; background-color:#A7C942; text-align:left; color:#FFFFFF; font-size:1.1em; padding-top:5px; paddingbottom:4px;"><div style="';if(z.is(aa[ad].width)&&F(aa[ad].width)){X+=" width:"+aa[ad].width+"px; overflow-wrap: break-word"}X+='">'+aa[ad].text+"</div></th>"}}X=X+"</tr></thead><tbody>";W.forEach(function(ah,ag){X=X+"<tr>";for(var ai=0,af=aa.length;ai<af;ai++){if(Q.attributeToFilterForExport.indexOf(aa[ai].dataIndex)===-1){var aj=Q._getValueWithMapping(aa[ai].dataIndex,ah,V.itemViewOptions.mapping);X=X+'<td style="border:1px solid black;"><div style="';if(z.is(aa[ai].width)&&F(aa[ai].width)){X+=" width:"+aa[ai].width+"px; overflow: hidden"}X+='">'+aj+"</div></td>"}}X=X+"</tr>"});X=X+"</tbody></table></body></html>";if(!z.is(Q.myPrintWindow)){Q._displayAlert({message:H.get("actions.print.window.popup.error"),className:"primary"})}else{Q.myPrintWindow.document.write(X);Q.myPrintWindow.document.close();Q.myPrintWindow.focus();if(!a.odtMode){Q.myPrintWindow.print()}}};setTimeout(Y,0);if(z.is(O)){O.call(this)}if(z.is(Q.current_selected)&&(Q.current_selected.length>0)){W._models=ab}}function P(){var W=o.getDataGridViewHeaders();if(z.is(Q.snSkeletonMgt)&&z.is(Q.snSkeletonMgt._myDatagridView)&&z.is(Q.snSkeletonMgt._myDatagridView._columns)&&(Object.keys(Q.snSkeletonMgt._myDatagridView._columns).length>0)){W=Q.snSkeletonMgt._myDatagridView._columns}M(W)}var T=[];var N=o.getDataGridViewHeaders();for(var R=0,U=N.length;R<U;R++){T.push(N[R].dataIndex)}var S="";if(z.is(Q.current_collection)&&z.is(Q.current_collection.search_ressources)&&z.is(Q.current_collection.search_ressources.getActiveTenant,"function")){S=Q.current_collection.search_ressources.getActiveTenant()}v.getResourcesInfo(T.join(","),{tenantId:S,lang:d.getLanguage(),apiVersion:"R2019x",onComplete:function(Z){if(z.is(Z,"array")){var X={};for(var Y=0,W=Z.length;Y<W;Y++){if(z.is(Z[Y],"object")&&z.is(Z[Y].curi,"string")){X[Z[Y].curi]=Z[Y].label}}for(var Y=0,W=N.length;Y<W;Y++){if(z.is(N[Y],"object")&&z.is(N[Y].dataIndex),"string"){N[Y].text=X[N[Y].dataIndex]}}}Z&&P.call(Q)},onFailure:function(W){b.info(W);W&&P.call(Q)}})},informationPanel:function(M){var N=this;N.dispatchEvent("onInformationPanelAction")},PreviewPanel:function(M){var N=this;N.dispatchEvent("onPreviewPanelAction")},PinToDashboard:function(M){var N=this;N.dispatchEvent("onPinToDashboardAction")},_listUISettingsToDisplay:function(){var T=this;var P=[];if(!z.is(T.snSkeletonMgt)){return P}var W=y.getSettingsToDisplayInUI();var V=z.is(T.snSkeletonMgt.getOption("in_apps_search"),"object");var S=T.snSkeletonMgt.getOption("transient_context")!=="true"&&T.snSkeletonMgt.getOption("transient_context")!==true;var O=y.getOption("nav_history");var U=y.getOption("integratedSearch");var N;if(z.is(T.snSkeletonMgt.getSearchWidget,"function")&&z.is(T.snSkeletonMgt.getSearchWidget())){N=T.snSkeletonMgt.getSearchWidget().getValue("launch_mode")}var R=function(aa,Z){var X=true;switch(aa){case"search_tabbed_ui":var Y=d.identifyClientInfo(Z.addinMode);if(z.is(Y,"object")){switch(Y.identifier){case"3DSpace":X=false;break;case"3DDashboard":if(V||S){X=false}break;case"3DEXPERIENCE":if(V){X=false}break}}break;case"nav_history":if(O===false){X=false;break}else{var Y=d.identifyClientInfo(Z.addinMode);if(z.is(Y,"object")){switch(Y.identifier){case"3DSpace":X=false;break;case"3DDashboard":if(V||S){X=false}break;case"3DSwym":case"3DEXPERIENCE":X=false;break}}}break;case"integratedSearch":if(z.is(U)&&U===false){X=false}else{if(N===d.widgetLaunchMode.COMPASS_TRANSIENT||N===d.widgetLaunchMode.COMPASS_PINNED){X=false}}var Y=d.identifyClientInfo(Z.addinMode);if(z.is(Y,"object")){switch(Y.identifier){case"3DSpace":X=false;break;case"3DDashboard":if(V||S){X=false}break;case"3DSwym":case"3DEXPERIENCE":X=false;break}}break;case"search_date_region":X=false;if(y.getOption("activate_search_date_region")===true){X=true}break}return X};var M={addinMode:T.snSkeletonMgt.getOption("addinMode"),inContextSearch:z.is(T.snSkeletonMgt.getOption("in_apps_search"),"object"),isPinnedWidget:(T.snSkeletonMgt.getOption("transient_context")!=="true"&&T.snSkeletonMgt.getOption("transient_context")!==true)};for(var Q=0;Q<=W.length;Q++){if(z.is(W[Q])&&z.is(W[Q].optionID)&&z.is(W[Q].optionLabel)){if(R(W[Q].optionID,M)){P.push(W[Q])}}}return P},searchSettingsUI:function(P){if(!z.is(P)){throw ("E_INVALIDARG: bad custoActionItem given to searchSettingsUI method !")}var ao=this;var Z=(ao.displayMode==="table")?false:true;var al=null;if(!z.is(this.immersiveFrame)){this.immersiveFrame=new w({});var am=document.body;this.immersiveFrame.inject(am)}var aw=P.getContent();if(P.model.get("visible")===false){var X=z.extendElement(this.searchContentSetDivContainer);if(z.is(X)){var ag=X.getElements(".fonticon-dot-3");if(z.is(ag,"array")&&1==ag.length){aw=ag[0]}}}var ac=UWA.createElement("div",{"class":"search-options-popover-container"});var ak=new B({domId:"applySettings",label:H.get("APPLYButton"),onClick:function(ay){var az=new c({renderTo:document.body,className:"WarningReloadPage"});al.disabled=true;az.confirm(H.get("actions.Options.warning"),H.get("actions.Options.warningTitle"),function(aA){if(true===aA){var aC=false;var aH=0;for(aH=0;aH<=ax.length;aH++){var aF=ax[aH];if(z.is(aF)&&z.is(aF.options)){I.setItem(aF.value,aF.checkFlag)}}for(aH=0;aH<=ap.length;aH++){var aG=ap[aH];if(z.is(aG)&&z.is(aG.options)){I.setItem(aG.getId(),aG.getValue())}}var aD=aj.currentValue;if(z.is(aD)){for(var aH=0;aH<V.length;aH++){var aJ=V[aH];if(aD===H.get(aJ.id+".title")){aD=aJ;I.setItem("revisionDisplayType",aD);break}}}I.commit();var aE=av.currentValue;al.destroy();ao.popover=null;if(y.getOption("search_web_in_win")){if(z.is(ao.snSkeletonMgt)&&z.is(ao.snSkeletonMgt.getCollection())&&z.is(ao.snSkeletonMgt.getCollection().getTaggerProxy())){ao.snSkeletonMgt.getCollection().getTaggerProxy().clearLocalFilter()}}t.publish({channel:ao.snSkeletonMgt.getOption("widgetId"),topic:"beforeSearchReload",data:{}});if(z.is(aE)){var aB=null;for(aH=0;aH<S.length;aH++){aB=S[aH];if(aE===H.get(aB.id+".title")){aC=true;try{I.setPreference({name:"dateDisplayMode",value:JSON.stringify(aB),onComplete:function(aK){b.log("data is saved successfully");location.reload()},onFailure:function(aK){b.error("Unable to fail to save date preferences :",aK);location.reload()}})}catch(aI){b.error("Error calling SearchPreferences:",aI);location.reload()}break}}}if(!aC){location.reload()}}else{al.disabled=false}})}});var M={my:"top right",at:"top right",of:this.immersiveFrame,offsetX:-300,offsetY:150};ak.disabled=true;this.popover=new h({immersiveFrame:this.immersiveFrame,title:H.get("custo_chooser_panel_title"),identifier:"search-options-popover",position:M,content:ac,minWidth:260,minHeight:250,resizableFlag:true,buttons:{Apply:ak}});al=this.popover;al.divCusto=ac;P.custoPanel=al;al.elements.container.addClassName("search-options-popover");al.elements.container.setStyle("z-index",4000);al.addEventListener("close",function(ay){ay.stopPropagation();al.destroy();ao.popover=null});if(!z.is(P.custoPanel)){ao.log("Error !!!");return}var Q=new i({reorderFlag:false,newTabButtonFlag:false,pinFlag:false,editableFlag:false,multiSelFlag:false,displayStyle:"strip"});Q.inject(al.divCusto);var N=new UWA.Element("div",{"class":"search-options-tab",id:"search-options-tab-general"});var ah=null;var R=new UWA.Element("div",{"class":"search-options",id:"search-options-general"});R.inject(N);var aq={};var S=y.getOption("date_display_mode_array");if(z.is(S)&&(S.length>0)){var O=[];for(var ar=0;ar<S.length;ar++){var ab=S[ar];if(z.is(ab,"object")&&z.is(ab.id,"string")){O.push(H.get(ab.id+".title"))}else{b.error("Bad definition of date_display_mode_array !!!",S)}}if(O.length>0){var au=new UWA.Element("div",{"class":"search_center_general_tab_div search_center_margin",id:"general-tab-date-mode"}).inject(N);var U=new UWA.Element("div",{"class":"search_center_div_left search_center_general_display_flex",id:"general-tab-date-mode-text",}).inject(au);var ai=new UWA.Element("div",{"class":"search_center_div_right",id:"general-tab-date-mode-combo",}).inject(au);new UWA.Element("p",{"class":"search_center_text",text:H.get("Default_Date_Mode")}).inject(U);var av=new p({elementsList:O,nbDisplayedElements:O.length,currentValue:null,enableSearchFlag:false,}).inject(ai);I.getPreference({name:"dateDisplayMode",onComplete:function(ay){av.value=H.get(ay.id+".title")},onFailure:function(ay){b.error("Failed to get dateDisplayMode preferences !",ay)}});ai.setStyle("display","grid");var at=false;av.addEventListener("change",function(ay){at=true;ak.disabled=false})}}var aq={};var aj;var V;var Y="";if(z.is(ao.current_collection)&&z.is(ao.current_collection.search_ressources)&&z.is(ao.current_collection.search_ressources.getActiveTenant,"function")){Y=ao.current_collection.search_ressources.getActiveTenant()}this._checkCSVAvailability(Y).then(function(){V=y.getOption("show_search_results_revision_array");if(z.is(V)&&(V.length>0)){var aC=[];for(var aA=0;aA<V.length;aA++){var ay=V[aA];if(z.is(ay,"object")&&z.is(ay.id,"string")){aC.push(H.get(ay.id+".title"))}else{b.error("Bad definition of show_search_results_revision_array !!!",V)}}if(aC.length>0){var aD=new UWA.Element("div",{"class":"search_center_general_tab_div search_center_margin",id:"general-tab-revision"}).inject(N);var aE=new UWA.Element("div",{"class":"search_center_div_left search_center_general_display_flex",id:"general-tab-revision-type-text",}).inject(aD);var aF=new UWA.Element("div",{"class":"search_center_div_right",id:"general-tab-revision-type-combo",}).inject(aD);new UWA.Element("p",{"class":"search_center_text",text:H.get("Show_Search_Results")}).inject(aE);var aG=I.getItem("revisionDisplayType");var az=y.getOption("defaultRevision",{tenant:Y});if(!z.is(aG)){aG=(az)?az:aC[0]}aj=new p({elementsList:aC,nbDisplayedElements:aC.length,currentValue:H.get(aG.id+".title"),enableSearchFlag:false,}).inject(aF);aF.setStyle("display","grid");var aB=false;aj.addEventListener("change",function(aH){aB=true;ak.disabled=false})}}});var W=null;var ae=ao._listUISettingsToDisplay();var ax=[];var ap=[];for(var ar=0;ar<=ae.length;ar++){if(z.is(ae[ar])&&z.is(ae[ar].optionID)&&z.is(ae[ar].optionLabel)){aq[ae[ar].optionID]=I.getItem(ae[ar].optionID);if("boolean"===ae[ar].optionType&&!z.is(ae[ar].father)){var af=new J({type:"checkbox",value:ae[ar].optionID,domId:ae[ar].optionID,label:ae[ar].optionLabel,checkFlag:aq[ae[ar].optionID]});if(z.is(ae[ar].disable)){af.disabled=ae[ar].disable}W=new UWA.Element("div",{"class":"search_center_div_left",});af.inject(W);W.inject(R);ax.push(af);if(af.value==="searchpreview"){if(z.is(ah)){if(af.checkFlag===true){ah.setStyle("display","block")}R=ah}}af.addEventListener("buttonclick",function(aA){var ay=aA.dsModel;var aC=false;var aD=0,az=ax.length;for(aD=0;aD<az&&false===aC;aD++){if(aq[ax[aD].value]!==ax[aD].checkFlag){aC=true}}if(true===aC||at===true){ak.disabled=false}else{ak.disabled=true}if(ay.value==="search_tabbed_ui"){var aB=ax.filter(function(aE){return(aE&&aE.value==="nav_history")}).pop();if(aB){if(ay.checkFlag===true){aB.disabled=false}else{aB.disabled=true;aB.checkFlag=false}return}}else{if(ay.value==="searchpreview"){if(ay.checkFlag===true){if(z.is(ah)){ah.setStyle("display","block")}}else{if(z.is(ah)){ah.setStyle("display","none")}}}}})}else{if("string"===ae[ar].optionType){var aa=new k({placeholder:ae[ar].optionLabel,"class":ae[ar].optionID,id:ae[ar].optionID,events:{onKeyDown:function(ay){ak.disabled=false}}}).inject(R);ap.push(aa);aa.setValue(aq[ae[ar].optionID])}}}}var T=ax.filter(function(ay){return(ay&&ay.value==="search_tabbed_ui")}).pop();if(T&&T.checkFlag===true){var an=ax.filter(function(ay){return(ay&&ay.value==="nav_history")}).pop();if(an){an.disabled=false}}Q.add({label:H.get("actions.Options.generalTab"),content:N});var ad=null;if(y.getOption("global_action_column_custo")&&ao._shouldBeAvailableIfInContextMode({in_apps_search:ao.snSkeletonMgt.getOption("in_apps_search")},"columnCusto")&&false===Z){var Y="";if(z.is(ao.current_collection)&&z.is(ao.current_collection.search_ressources)&&z.is(ao.current_collection.search_ressources.getActiveTenant,"function")){Y=ao.current_collection.search_ressources.getActiveTenant()}d.isRoleAvailable(["CSV","InternalDS"],Y,function(aB){if(true===aB){var aA={isPQ:false,typeName:""};if(z.is(ao.current_collection)){var aC=ao.current_collection.getPQ();if(z.is(aC)){aA={isPQ:true,typeName:aC}}}var aE=ao.snSkeletonMgt.getDataGridView();if(z.is(aE)&&z.is(aE._forcedCustoView,"string")){aA.forcedCusto=aE._forcedCustoView}var az=G.getAvailableColumnCustomization(aA);if(z.is(az)&&az.length>0){az.splice(0,0,{label:H.get("RESTORE_DEFAULT"),value:"The_Default_Columns"})}ad=new UWA.Element("div",{"class":"search-options-tab",id:"search-options-tab-custo"});var aD=new g({className:"search-options-custo-select",nativeSelect:true,placeholder:H.get("dataGrid.columnCustoPanel.existingCustoComboPlaceHolder"),options:az,events:{onChange:function(){var aF=ao._getDataGridView();var aI=this.getValue(),aK=null;if(z.is(aI,"array")&&aI.length>0){aK=aI[0]}if(0===aK.length){return}if("DEFAULT"===aK){if(z.is(aA)){aA.forcedCusto="DEFAULT"}aK=G.getColumnCustomizationIdToUse(aA)}var aJ={custoName:aK,custoId:aK};if(aJ.custoName.endsWith("-ADMIN")){aJ.custoName=aJ.custoName.slice(0,-6)}if(aK.startsWith("###")){var aG=aJ.custoName.substring(3,aJ.custoName.length);aJ.custoName=H.replace(H.get("custo_PQ"),{PQ:aG})}if(z.is(aF)&&z.is(aF.defineColumnCusto,"function")){var aH=G.getColumnCustomizationDefinitionFromCustoId(aK);aF._updateColumns(aH,aJ,false)}al.destroy();ao.popover=null}}});aD.inject(ad);var ay=UWA.createElement("a",{id:"show-custo-manager",title:H.get("custo_chooser_manage_custos_tooltip"),href:"#",html:H.get("custo_chooser_manage_custos")}).inject(ad);ay.addEvent("click",function(aF){aF.preventDefault();aF.stopPropagation();al.destroy();ao.popover=null;ao.columnCustomizationDefinitionUI()});Q.add({label:H.get("actions.Options.custoTab"),content:ad,index:0,isSelected:true})}else{Q.value=[0]}})}else{Q.value=[0]}al.show()},_getDataGridView:function(){var O=null;if(z.is(this.skeleton)&&z.is(this.skeleton.getViewAt,"function")){var N=this.skeleton.getViewAt(0);if(z.is(N)){var M=N.currentViewId;if(M==="table"&&z.is(N.contentsViews,"object")&&z.is(N.contentsViews[M])){O=N.contentsViews[M].nestedView}}}return O},columnCustomizationDefinitionUI:function(){var N=this;var M=N._getDataGridView();if(z.is(M)&&z.is(M.defineColumnCusto,"function")){N.maskedElement=N.snSkeletonMgt.options.renderTo;A.mask(N.maskedElement,H.get("SearchDataGridPreferences_modal_loading_attribute"));M.defineColumnCusto()}},removeMask:function(){if(z.is(this.maskedElement)){A.unmask(this.maskedElement)}this.maskedElement=null},logOut:function(){this.log("logOut");if(!z.is(this.current_collection)){return}if(!z.is(this.current_collection.getSearchRessources())){return}var M=this.current_collection.getSearchRessources().getFetchOptions({service_name:"logOut",});var O=M.url;var N={onComplete:function(P,Q){b.log("SearchAction: logout success")},onFailure:function(P){b.warn("SearchAction: logout failure")}};N=UWA.extend(M,N,true);j.authenticatedRequest(O,N)},saveSearchUI:function(Q,P){if(!z.is(Q)){throw ("E_INVALIDARG: bad saveActionItem given to saveSearchUI method !")}var S=this,W,T,Y,X,U,N=false;if(z.is(S.current_collection.service_parameters.query)&&d.SearchTypeEnum.MY_RECENT_CONTENT===S.current_collection.service_parameters.query){N=true}if(!N){Y=UWA.createElement("div",{"class":"divNewSearch form-group",html:{tag:"label","for":"newSaveSearchName","class":"saveSearchEdt",html:H.get("save_search_name")}});X=UWA.createElement("form",{"class":"formSaveSearch form-inline"});Y.inject(X);if(z.is(P)){var M=new C({placeholder:H.get("save_search_default_text"),"class":"newSaveSearchName",events:{onKeyDown:function(aa){if(aa.keyCode===13){aa.preventDefault();aa.stopPropagation();var Z=S.saveSearch(this.elements.input.value,P);if(false!==Z){T.destroy();S.popover=null}}}},}).setId("newSaveSearchName").inject(Y);M.getSuggestions=function(){}}}else{Y=UWA.createElement("div",{"class":"divNewSearch form-group",html:{"for":"newSaveSearchName",html:H.get("save_search_not_supported")}});Y.inject(X);UWA.createElement("hr").inject(X)}U=UWA.createElement("a",{id:"show-favorites-searches",title:H.get("my_fav_searches_tooltip"),"class":"saveSearchHyperlink",href:"#",html:H.get("my_fav_searches"),styles:{display:"block"}}).inject(X);U.addEvent("click",function(Z){Z.preventDefault();Z.stopPropagation();T.destroy();S.popover=null;S.dispatchEvent("onRefreshResultRequest",{criteria:{search_crit:d.SearchTypeEnum.FAVORITE_SEARCH,originalSearchCriteria:H.get("my_fav_searches"),search_name:H.get("my_fav_searches"),queryType:d.SearchTypeEnum.FAVORITE_SEARCH}})});var R=Q.getContent();if(Q.model.get("visible")===false){var V=z.extendElement(this.searchContentSetDivContainer);if(z.is(V)){var O=V.getElements(".fonticon-dot-3");if(z.is(O,"array")&&1==O.length){R=O[0]}}}this.popover=new h({title:H.get("save_search_panel_title"),identifier:"fav-search-popover",position:{at:"bottom",of:R,collision:"fit",offsetX:-150},content:Y.getParent(),buttons:{Ok:new B({domId:"okSaveSearch",label:H.get("OKButton"),onClick:function(Z){var aa=S.saveSearch(M.elements.input.value,P);if(false!==aa){S.popover.destroy();S.popover=null}}}),Cancel:new B({domId:"cancelSaveSearch",label:H.get("CancelButton"),onClick:function(Z){S.popover.destroy();S.popover=null}})}});T=this.popover;Q.savePanel=T;this.popover.elements.container.addClassName("fav-search-popover");T.elements.container.setStyle("z-index",4000);T.inject(document.body);T.addEventListener("close",function(Z){Z.stopPropagation();T.destroy();S.popover=null});T.show();if(z.is(M)){M.elements.input.focus()}},saveSearch:function(N,Q){var P=this;this.log("saveSearch");if(!z.is(N,"string")){return}function O(T,U){var S=H.replace(H.get("save_search_failure"),{searchId:N});if(z.is(U,"string")){try{var R=JSON.parse(U);if(z.is(R)&&z.is(R.Error)){S+="<br>"+R.Error}}catch(V){b.error("Error parsing errorObject:",V)}}P._displayAlert({message:S,className:"error saveSearchAlert"})}if(N.indexOf("<")>=0||N.indexOf(">")>=0){N=N.replace(/</g,"&lt;").replace(/>/g,"&gt;");N=N.replace(/&lt;/g,'<em style="color:red">&lt;</em>').replace(/&gt;/g,'<em style="color:red">&gt;</em>');O("invalid char in name",'{"Error": "'+H.get("save_search_invalid_character")+'"}');return false}var M={query:Q.query,originalSearchCriteria:Q.originalSearchCriteria,search_criteria_to_display:Q.search_criteria_to_display};this.log("searchName="+N);this.log("searchParam.search_criteria="+Q.query);this.log("searchParam.tagger_criteria="+Q.refine);if(!z.is(this.current_collection)){return}if(!z.is(this.current_collection.getSearchRessources())){return}d.initSecurityContext(P.current_collection.getSearchRessources());d.getSecurityContextPromise().then(function(){var S={service_name:"saveSearch",service_data:{name:N,searchSpec:M,taggerSpec:Q.refine,searchOptions:{source:Q.source},originalSearchCriteria:Q.originalSearchCriteria}};if(Q.order_by&&Q.order_field){S.service_data.searchOptions.order_by=Q.order_by;S.service_data.searchOptions.order_field=Q.order_field}var R=P.current_collection.getSearchRessources().getFetchOptions(S);var U=R.url;var T={onComplete:function(V,W){var X=z.Json.decode(V);if(UWA.is(X)){P._displayAlert({message:H.replace(H.get("save_search_successful"),{searchId:X.name}),className:"success saveSearchAlert"})}},onFailure:O};T=UWA.extend(R,T,true);j.authenticatedRequest(U,T)})},getSavedSearches:function(O,P){var Q=this;this.log("getSavedSearches");if(!z.is(this.current_collection)){return}if(!z.is(this.current_collection.getSearchRessources())){return}var N=this.current_collection.getSearchRessources().getFetchOptions({service_name:"getSavedSearches"});var M=N.url;var R={type:"json",authentication:{passport_target:"enovia"},onComplete:function(U,Y){if(z.is(U)){Q.log(U)}if(z.is(Y)){Q.log(Y)}var T=[];if(z.is(U.searches)){for(var W=0,S=U.searches.length;W<S;W++){var V=U.searches[W];var X={save_object:{}};if(z.is(V.name)){X.save_object.name=V.name}if(z.is(V.id)){X.save_object.id=V.id}if(z.is(V.searchstring)){X.save_object.search_criteria=V.searchstring}if(z.is(V.taggerstring)){X.save_object.tagger_criteria=decodeURIComponent(V.taggerstring)}T.push(X)}if(z.is(P,"function")){P(T)}}},onFailure:function(S){Q._displayAlert({message:H.replace(H.get("save_search_retrieval_failure"),{response:S}),className:"error"})}};UWA.extend(R,N,true);if(y.getOption("search_web_in_win")||this.jetty_server_activated){this.log("Jetty server activated or Search Web in Win context")}j.authenticatedRequest(M,R)},deleteSearch:function(O,N){var P=this;P.log("deleteSearch");if(!z.is(this.current_collection)){return}if(!z.is(this.current_collection.getSearchRessources)){return}var M=this.current_collection.getSearchRessources().getFetchOptions({service_name:"deleteSearch",service_data:{id:O,}});var Q={onComplete:function(R,S){N()},onFailure:function(R){P.log("Failed to delete search "+O+" !",R)},onCancel:function(){P.log("Search deletion canceled !")},onTimeout:function(R){P.log("Search deletion timeout !",R)}};Q=UWA.extend(M,Q,true);j.authenticatedRequest(Q.url,Q)},_getValueWithMapping:function(P,O,N){var R;if(!z.is(P)){return}if(P in N&&z.is(N[P],"function")){var S={model:O};R=N[P].call(S)}else{try{R=O.get(P)}catch(Q){}if(R===undefined){try{R=O.get(P.slice(P.lastIndexOf("/")+1,P.length))}catch(Q){}if(R===undefined){R="";if(z.is(O)&&UWA.is(O.isAShowOnlyObject,"function")&&O.isAShowOnlyObject()){var M=H.get("no_access");R=M}}}}return R},updatePopoverPosition:function(){if(!z.is(this.popover)){return}if(z.is(this.popover.options)&&z.is(this.popover.options.target)&&z.is(this.popover.options.target.getPosition,"function")){var M=this.popover.options.target.getPosition(document.body);(M.x!==0||M.y!==0)?this.popover.updatePosition():this.popover.hide()}else{if(z.is(this.popover._properties)&&z.is(this.popover._properties.position)&&z.is(this.popover._properties.position.value)&&z.is(this.popover._properties.position.value.of)&&z.is(this.popover._properties.position.value.of.container)&&z.is(this.popover._properties.position.value.of.container.getPosition,"function")){var M=this.popover._properties.position.value.of.container.getPosition(document.body);if(M.x!==0||M.y!==0){this.popover.updatePosition?this.popover.updatePosition():this.popover.setAbsolutePosition(M)}else{}}}},_displayAlert:function(M){if(!z.is(M)||!z.is(M.message)){throw ("E_INVALIDARG: bad options given to _displayAlert method !")}var O=M.message;var N="primary";if(z.is(M.className,"string")){N=M.className}var Q=this.snSkeletonMgt._skeleton.container;var P={visible:true,autoHide:N.indexOf("success")>-1?true:false,hideDelay:4000,closable:true,messages:[{message:O,className:N}]};if(z.is(M.events)){P.events=M.events}if(z.is(this.skeleton)){if(this.skeleton._alert){this.skeleton._alert.destroy();this.skeleton._alert=null}this.skeleton._alert=new m(P).inject(Q,"top")}else{new m(P).inject(Q,"top")}},_checkCSVAvailability:function(N){var M=this;if(y.getOption("search_web_in_win")){M.CSVpromise.resolve([]);return M.CSVpromise.promise}d.getGrantedRoles(function(P){var Q=false;for(var O=0;O<P.length;O++){var R=P[O];if(UWA.is(R)&&UWA.is(R.platforms,"array")){if(R.platforms.length===0||(R.platforms.indexOf(N)>=0)&&(R.id==="CSV")){Q=true;break}}}if(Q){M.CSVpromise.resolve(P)}else{M.CSVpromise.reject(P)}});return this.CSVpromise.promise},});return r});define("DS/SNResultUX/views/SearchThumbnailGridView",["DS/SNResultUX/views/SearchGridView","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/ImageHelper"],function(d,b,c,e){var a=d.extend({uwaClassName:"DS/SNResultUX/views/SearchThumbnailGridView",name:"SearchThumbnailGridView",className:"ThumbnailGridView",attributes:{styles:{width:"100%",height:"100%"},"data-rec-id":"ThumbnailGridView"},bShowTooltip:false,_bigPicList:null,_picCheckedList:null,_imageHelpers:null,init:function(f){this._parent(f);this.bShowTooltip=b.is(c.getOption("webUXTooltip"))?c.getOption("showTooltip"):false;this.neverCheckbox=b.is(c.getOption("neverCheckbox"))?c.getOption("neverCheckbox"):false;this.neverAction=b.is(c.getOption("neverAction"))?c.getOption("neverAction"):false;this._imageHelpers=[];this._bigPicList=[];this._picCheckedList=[]},destroy:function(){this.stopListening(this.collection);try{if(b.is(this.view)&&b.is(this.view.destroy,"function")){this.view.destroy()}}catch(f){console.log(f)}this._bigPicList=null;this._picCheckedList=null;this._imageHelpers.forEach(function(g){g.destroy()});this._imageHelpers=null;this._parent();this.options=null},onSearch:function(f){this._parent(f);var g=this},getMinNumberModel:function(g,f){g=g||this._rowMaxNumber;f=f||this._columnsMaxNumber;return g*f},setup:function(f){this._parent(f);var g=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){g._bigPicList=[];g._picCheckedList=[];g._imageHelpers.forEach(function(h){h.destroy()});g._imageHelpers=[]},onSync:function(){}})},setAsBigPicture:function(f){this._bigPicList.push(f)},_onPostCellRequest:function(i){var h=this;if(!b.is(i)||!b.is(i.cellView)){return}var f=this._bigPicList.indexOf(i.virtualCellID)!==-1;if(f){i.cellView.setPictureBackgroundSize("contain")}else{i.cellView.setPictureBackgroundSize("auto")}var j=this._picCheckedList.indexOf(i.virtualCellID)!==-1;if(!j){this._imageHelpers.push(new e(i,this));h._picCheckedList.push(i.virtualCellID)}else{var g=this._imageHelpers[i.virtualCellID];if(b.is(g)){g._cellInfos=i}}},render:function(){this.log("ThumbnailGridView render");var f=this;require(["DS/Tree/ThumbnailGridView"],function(h){var g=f.getOptionCommon();f.view=new h(g);f.view.setCheckboxVisibilityFlag("atCellHover");if(f.neverCheckbox===true){f.view.setCheckboxVisibilityFlag("never")}f.view.setAnimationOnCartoucheOver(true);f.view.setTitleDisplayedOnTwoLines&&f.view.setTitleDisplayedOnTwoLines(true);f.view.options.shouldDisplayTooltipFlag=f.bShowTooltip;f.view.onGridViewCellDoubleClick(function(i){f.onItemDblClick(i)});f.view.inject(f.container);f._model.search_multiselMode&&f.toggleMultiSelMode(true);f.view.onInfiniteScrollAsync(function(i){f.onInfiniteScrollAsync(i,function(){f.view.infiniteScrollAsyncProcessDone()})});f.view.onEndResizeOrOnReadyModelRequestAsync&&f.view.onEndResizeOrOnReadyModelRequestAsync(function(i){f.onResizeOrFirstLoaded(i,function(){f.view.EndResizeOrOnReadyModelRequestAsyncDone()})});f._afterRender();f.onSearch()});return this}});return a});define("DS/SNResultUX/utils/AdvSearchMgr",["UWA/Core","UWA/Class","UWA/Class/Options","DS/WAFData/WAFData","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SWFiltering","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/SNPLMDictionary","DS/SNResultUX/utils/SNResultTypeCustoHelper","DS/SNInfraUX/SearchLogin","DS/i3DXSNDictionaryAPI/3DXSearchDictionaryAccess","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/WildcardMgr","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SNAdvSearchCusto","DS/SNInfraUX/Logger"],function(m,r,g,b,t,j,c,p,h,f,e,n,i,a,l,o,k,q){var d=r.extend(t,g,{name:"DS_SNResultUX_utils_AdvSearchMgr",_status:false,_dynamicPredicateSetType:[],_dynamicPredicateSetKind:[],_dynamicExtPredicateSetType:[],_dataSetsForSource:{},_dataSetsForType:null,_dataSetsForExtension:null,_adv_search_field:null,_criteriaData:null,_currentDataSource:null,CORE_BASIC_SOURCE:"ds6w:where/ds6w:source/ds6w:dataSource",CORE_BASIC_TYPE:"ds6w:what/ds6w:type",CORE_BASIC_SUBTYPE:"vpmextension",CORE_BASIC_LABEL:"ds6w:what/ds6w:label",CORE_BASIC_IDENTIFIER:"ds6w:what/ds6w:identifier",CORE_BASIC_MODIFIED:"ds6w:when/ds6w:modified",EXT_BASIC_DESCRIPTION:"ds6w:what/ds6w:description",EXT_BASIC_RESPONSIBLE:"ds6w:who/ds6w:responsible",EXT_BASIC_CREATED:"ds6w:when/ds6w:created",BASIC_PREDICATES:null,BASIC_PREDICATES_leaf:null,_resources:null,_service:null,_uniqueDataSource:null,_fieldsToSet:null,_TypesListToSet:null,_incontextFixedPredicates:[],_suggestDisabledPredicates:[],init:function(u){if(m.is(j.options.search_settings.service,"string")){this._service=j.options.search_settings.service}this.setDebugMode(j.getDebugMode());this.setOptions(u);this._resources=u.resources;c.setResources({resources:this._resources});f.setResources({resources:u.resources});this.BASIC_PREDICATES=[this.CORE_BASIC_SOURCE,this.CORE_BASIC_TYPE,this.CORE_BASIC_SUBTYPE,this.CORE_BASIC_LABEL,this.CORE_BASIC_IDENTIFIER,this.CORE_BASIC_MODIFIED,this.EXT_BASIC_DESCRIPTION,this.EXT_BASIC_RESPONSIBLE,this.EXT_BASIC_CREATED];this.BASIC_PREDICATES_leaf=["ds6w:dataSource","ds6w:type","vpmextension","ds6w:label","ds6w:identifier","ds6w:modified","ds6w:description","ds6w:responsible","ds6w:created"];if(m.is(j.options.search_settings.adv_search_field,"string")&&j.options.search_settings.adv_search_field.length>0){this._adv_search_field=j.options.search_settings.adv_search_field}this._getSuggestDisabledPredicates()},destroy:function(){this._dynamicPredicateSetType=null;this._dynamicPredicateSetKind=null;this._dynamicExtPredicateSetType=null;this._dataSetsForSource=null;this._dataSetsForType=null;this._dataSetsForExtension=null;this._adv_search_field=null;this._criteriaData=null;this._currentDataSource=null;this.BASIC_PREDICATES=null;this.BASIC_PREDICATES_leaf=null;this._resources=null;this._service=null;this._uniqueDataSource=null;this._fieldsToSet=null;this._TypesListToSet=null;this._incontextFixedPredicates=null;this._suggestDisabledPredicates=null},setStatus:function(u){this._status=u},getStatus:function(){return this._status},addFilter:function(u){},clearFilters:function(u){if(!UWA.is(u)){u="type+kind";this._dynamicPredicateSetType=[];this._dynamicPredicateSetKind=[];this._dynamicExtPredicateSetType=[]}if(-1<=u.indexOf("kind")){this._dynamicPredicateSetKind=[]}},showSourceField:function(){var v=true;var u=this._InContextAdvancedSearch();if(u&&u.showSource===false){v=false}return v},getAndDisplayAdvancedSearch:function(){var u=arguments;if(this._isInContextSearch()){this.getAndDisplayAdvancedSearchCusto.apply(this,arguments)}else{var v=this;k.getCusto(v._resources.getActiveTenant()).then(function(){if(k.isCustoEnabled()){v._adv_search_field=j.options.search_settings.adv_search_field}v.getAndDisplayAdvancedSearchCusto.apply(v,u)})}},getAndDisplayAdvancedSearchCusto:function(w,G){var F=this;var D=this.getOption("tagger_proxy");var E=[];this._incontextFixedPredicates=[];var A=this._resources.getActiveTenant();var x=function(H){var K;if(UWA.is(H,"array")){var P=[];var S={dataSources:H};var J=a.getValidDatasources(S);if(m.is(J)){if(m.is(J.dataSourceNames,"array")){P=J.dataSourceNames}}for(var R=0;R<H.length;R++){var M=H[R];if(M.status===true){var L=M.name;if(L==k.getDefaultSelectedSource(A)&&!(m.is(F._adv_search_field,"string")&&F._adv_search_field.length>0)){K=L}else{if(m.is(F._adv_search_field,"string")&&F._adv_search_field.length>0){K="3dspace"}}}}P=F._filterIncontextSources(P);if(!F._isInContextSearch()){P=F._filterCustoExcludedSources(P,A)}var O;if((m.is(F._adv_search_field,"string")&&F._adv_search_field.length>0)){if(k.getSelectedTypeSource(F._adv_search_field)){K=k.getSelectedTypeSource(F._adv_search_field);O=[F._adv_search_field]}}var I=F._prepareSourcePredicate(P,undefined,{selectedByDefault:K});F._dataSetsForSource[A]=I;if(m.is(F)&&m.is(F._service)&&m.is(F._service,"string")){F._service=I}if(F.showSourceField()){D.updateCriteria([I])}if(w){D.displayCriteria()}if(I.options.datasets.items.length===1){K=I.options.datasets.items[0].value}if(K){var Q={internal:true,value:[],typeSelectedByDefault:O};Q.sixw=F.CORE_BASIC_SOURCE;Q.value[0]=K;var N=F;setTimeout(function(){F.handleCriteriaChange(Q);if(w){D.displayCriteria()}},500)}}};var v=F._dataSetsForSource[A];if(UWA.is(v)){if(F.showSourceField()){E.push(v)}if(k.isCustoEnabled()){var u;var z;if(!this._adv_search_field){u=k.getDefaultSelectedSource(A);z=k.getTypesSelectedByDefault(u)}else{if(k.getSelectedTypeSource(this._adv_search_field)){u=k.getSelectedTypeSource(this._adv_search_field);z=[this._adv_search_field]}}if(!u){if(UWA.is(this._dataSetsForSource)&&UWA.is(this._dataSetsForSource.options)&&UWA.is(this._dataSetsForSource.options.datasets)&&UWA.is(this._dataSetsForSource.options.datasets.items,"array")){if(v.options.datasets.items.length===1){u=v.options.datasets.items[0].value}}}if(u){if(this._currentDataSource!=u){if((UWA.is(this._dataSetsForSource))&&(UWA.is(this._dataSetsForSource.options))&&(UWA.is(this._dataSetsForSource.options.datasets))&&(UWA.is(this._dataSetsForSource.options.datasets.items))&&(this._dataSetsForSource.options.datasets.items.length>1)){this._dataSetsForSource.options.datasets.items.forEach(function(H){if(H.value==u){H.predefined=true}else{H.predefined=false}})}if(this.showSourceField()){D.updateCriteria([this._dataSetsForSource])}}var B={internal:true,value:[],typeSelectedByDefault:z};B.sixw=F.CORE_BASIC_SOURCE;B.value[0]=u;var y=F;setTimeout(function(){F.handleCriteriaChange(B);if(w){D.displayCriteria()}},500)}}}else{var v=this._prepareSourcePredicate([]);this._dataSetsForSource[A]=v;if(F.showSourceField()){E.push(v)}n.login({resources:F._resources,onComplete:x,onFailure:x})}E.push(w?this._prepareTypePredicates({typesList:[],options:G}):F._dataSetsForType);if(this._isExtensionAvailable()){E.push(w?this._prepareSubTypePredicates({subTypesList:[]}):F._dataSetsForExtension)}E=E.concat(this._getCoreBasicPredicates());E=E.concat(this._getExtendedBasics());E=E.concat(this._dynamicPredicateSetType);E=E.concat(this._dynamicPredicateSetKind);E=E.concat(this._dynamicExtPredicateSetType);this._fieldsToSet=E;D.setCriteria(E);if(w===true){D.displayCriteria()}var y=this;if(!k.isCustoEnabled()&&m.is(G)&&m.is(G.adv_search_field)&&m.is(G.adv_search_field,"string")){var B={internal:true,value:["3dspace"]};B.sixw=this.CORE_BASIC_SOURCE;if(m.is(this._uniqueDataSource)){B.value=this._uniqueDataSource}setTimeout(function(){y.handleCriteriaChange(B);B.value=this._uniqueDataSource;if(w){D.displayCriteria()}B={internal:true,value:[]};B.sixw=y.CORE_BASIC_TYPE;B.value[0]="ds6wg:";B.value[0]=B.value[0].concat(y._adv_search_field);setTimeout(function(){y.handleCriteriaChange(B);if(w){D.displayCriteria()}},2000)},1000)}else{if((m.is(this._adv_search_field,"string")&&this._adv_search_field.length>0)&&!k.isCustoEnabled()){B={internal:true,value:[]};B.sixw=y.CORE_BASIC_TYPE;B.value[0]="ds6wg:";B.value[0]=B.value[0].concat(y._adv_search_field);setTimeout(function(){y.handleCriteriaChange(B);D.displayCriteria()},2000)}else{if(w){if(F._isInContextSearch()||((!k.isCustoEnabled()))){var B={internal:true,value:["3dspace"]};B.sixw=this.CORE_BASIC_SOURCE;if((UWA.is(y._dataSetsForSource))&&(UWA.is(y._dataSetsForSource.options))&&(UWA.is(y._dataSetsForSource.options.datasets))&&(UWA.is(y._dataSetsForSource.options.datasets.items))&&(y._dataSetsForSource.options.datasets.items.length<=1)){B={internal:true,value:["3dspace"]};B.sixw=this.CORE_BASIC_SOURCE;if((UWA.is(y._dataSetsForSource.options.datasets.items[0]))&&(UWA.is(y._dataSetsForSource.options.datasets.items[0].value))&&(y._dataSetsForSource.options.datasets.items[0].value.length>0)&&(y._dataSetsForSource.options.datasets.items[0].value!=="3dspace")){B={value:[y._dataSetsForSource.options.datasets.items[0].value]}}B.sixw=this.CORE_BASIC_SOURCE;setTimeout(function(){if((UWA.is(y._dataSetsForSource))&&(UWA.is(y._dataSetsForSource.options))&&(UWA.is(y._dataSetsForSource.options.datasets))&&(UWA.is(y._dataSetsForSource.options.datasets.items))&&(y._dataSetsForSource.options.datasets.items.length<=1)||(y._dataSetsForSource.options.datasets.items[0].value==="3dspace")){y.handleCriteriaChange(B)}D.displayCriteria()},1000)}else{setTimeout(function(){y.handleCriteriaChange(B);D.displayCriteria()},2000)}}}}}if(w){D.displayCriteria()}f.loadDictionary();var C=this._InContextAdvancedSearch();if(C){this._getIncontextCommonPredicates(function(H){y._incontextFixedPredicates=[];H.forEach(function(I){y._incontextFixedPredicates.push(I.sixw)});D.updateCriteria(H)})}else{}},_isExtensionAvailable:function(){return p.isAVisiblePredicate("ds6w:kind")&&this.showInContextExtension()},getAndDisplayAdvancedSearchWithProxyFilterSettings:function(){var u=this;setTimeout(function(){u.getOption("tagger_proxy").displayCriteria()},100)},hideAdvancedSearchTab:function(){var u=this.getOption("tagger_proxy");var v=[];var w=true;v.push(this._prepareSourcePredicate([],w));v.push(this._prepareTypePredicates({typesList:[],toAllowEdit:w}));if(this._isExtensionAvailable()){v.push(this._prepareSubTypePredicates({subTypesList:[],toAllowEdit:w}))}u.setCriteria(v);u.setCriteria([]);if(true===u.getDisplayStatus()){u.displayCriteria(false)}},_internalTypeSelection:function(C){var z;var A=this._InContextAdvancedSearch();if(A){var x=A.selection;if(x){z=x["ds6w:type"];var y={internal:true,sixw:"ds6w:what/ds6w:type",value:[]};if(m.is(z,"array")&&z.length>0){y.value.push(z[0]);if(x.vpmextension){y.subTypesListSelected=x.vpmextension}this.handleCriteriaChange(y);for(var v=1;v<z.length;v++){y.value.push(z[v])}}if(y.value.length>1){this.handleCriteriaChange(y)}var B=this.getOption("tagger_proxy");if(B.toggleDisplayAllCriteria){B.toggleDisplayAllCriteria(true)}}}else{if(!this._isInContextSearch()){var w=k.getTypesSelectedByDefault(C.source);if(C.typeSelectedByDefault){w=C.typeSelectedByDefault}var y={internal:true,sixw:"ds6w:what/ds6w:type",value:[]};if(m.is(w,"array")&&w.length>0){y.value.push(w[0]);var u=k.getInterfacesSelectedByDefault(w[0]);y.subTypesListSelected=u;this.handleCriteriaChange(y);for(var v=1;v<w.length;v++){y.value.push(w[v])}}if(y.value.length>1){this.handleCriteriaChange(y)}}}},_internalSubtypeSelection:function(v){if(m.is(v,"array")&&v.length==1){var u={internal:true,sixw:"void/vpmextension",value:v};this.handleCriteriaChange(u)}},handleCriteriaChange:function(w){this._criteriaData=w;var M=this;var Q=this.getOption("tagger_proxy");var N=M._resources.getActiveTenant();if(UWA.is(w)){var B=w.sixw.split("/").pop();if(B==="ds6w:dataSource"){var A=w.value;if((UWA.is(A))&&(UWA.is(A.length))&&(1===A.length)){var S=c.getVocabularyName(A[0]);this._currentDataSource=A[0];var F=[];var E=this;var R=M._InContextAdvancedSearch();var L;if(R){L=R["ds6w:type"]}var G;if(R&&R.selection&&w.internal){G=R.selection["ds6w:type"]}if(m.is(L,"array")){var I=c.getVocabularyClasses(S);if(I){var v=M.getIncontextTypeList(I);F=F.concat(M._prepareTypePredicates({typesList:v,typesListSelected:G}));Q.updateCriteria(F)}else{var O=[];L.forEach(function(W){var V=W.uri.split(":");var U=V[1];O.push(U)});i.getNlsOfPropertiesValues(JSON.stringify({"ds6w:type":O}),{tenantId:N,lang:a.getLanguage(),TagURL6WId:i._6WTagURL,onComplete:function(V){var W=V["ds6w:type"];var U=[];L.forEach(function(Z){var Y=Z.uri.split(":");var X=Y[1];U.push({uri:Z.uri,nlsName:W[X]})});U=M._sortByKey(U,"nlsName");F=F.concat(M._prepareTypePredicates({typesList:U,typesListSelected:G}));Q.updateCriteria(F)}})}}else{var H={vocabId:S,source:A[0],tenantId:N};if(w.typeSelectedByDefault){H.typeSelectedByDefault=w.typeSelectedByDefault}else{if(!w.internal){H.typeSelectedByDefault=[]}}H.onComplete=function(U){F=F.concat(U);M._TypesListToSet=F;Q.updateCriteria(F);E._internalTypeSelection(H)};H.onFailure=function(){c.loadVocabularyClasses({vocabId:S},function(U){F=F.concat(M._prepareTypePredicates({typesList:U.classInfos,vocabId:S,typesListSelected:G}));M._TypesListToSet=F;Q.updateCriteria(F);if(G){E._internalTypeSelection(H)}})};E._prepareTypePredicatesFromCusto(H)}}else{var J=[];if(m.is(M)&&m.is(M._service)&&(M._service!=null)){J=M._service;Q.updateCriteria([J]);if(m.is(M._service.options)&&m.is(M._service.options.datasets)&&m.is(M._service.options.datasets.items)){if(M._service.options.datasets.items.length===1){var w={value:[]};w.sixw=M.CORE_BASIC_SOURCE;w.value[0]=M._service.options.datasets.items[0].value;var E=M;setTimeout(function(){M.handleCriteriaChange(w)},500)}}}else{J.push(this._prepareTypePredicates({typesList:[]}));Q.updateCriteria(J)}if(M._isExtensionAvailable()){var x=[];x.push(M._prepareSubTypePredicates({subTypesList:[]}));Q.updateCriteria(x)}}var y=M._dynamicPredicateSetType;y=y.concat(M._dynamicPredicateSetKind).concat(M._dynamicExtPredicateSetType);Q.removeCriteria(y);M.clearFilters("type+kind")}else{if(B==="ds6w:type"){var D=w.value;if(D.length==1){M._dynamicExtPredicateSetType=[];c.loadRelevantPredicates({className:D[0]},function(U){M._loadPLMDictionaryAndRun(function(){var X;if(!M._isInContextSearch()){X=k.getPredicatePreferredPosition(D[0],N)}if(!M._isInContextSearch()){var Y=k.getExcludedPredicatesForType(D[0],N);if(UWA.is(Y)&&Y.length){U.vocabularyPredicateInfo=U.vocabularyPredicateInfo.filter(function(Z){return(-1==Y.indexOf(Z.uri))})}}var V=M._prepareRelevantPredicates({dataPredicates:U.vocabularyPredicateInfo,pswitch:false,type:D[0],internal:w.internal,preferredPosition:X,exclusiveTaxonomies:k.isExclusiveTaxonomies(N)});if(m.is(V,"array")){M._dynamicPredicateSetType=V;V=M._sortByKey(V,"dispValue")}else{var W=V.preferredPredicates;var V=V.relevantPredicates;V=M._sortByKey(V,"dispValue");Q.removeCriteria(M._getExtendedBasics());M._dynamicPredicateSetType=W.concat(V);W=W.concat(M._getExtendedBasics());V=W.concat(V)}Q.updateCriteria(V)})});if(M._isExtensionAvailable()){var D=w.value;c.loadRelevantInterfaces(D[0],function(W){var Y=[];var aa="";var Z=[];for(var V=0;V<W.interfaces.length;V++){if(UWA.is(W.interfaces[V]["automatic"])&&W.interfaces[V]["automatic"]==="Yes"||UWA.is(W.interfaces[V]["Automatic"])&&W.interfaces[V]["Automatic"]==="Yes"){aa=aa.concat("ds6wg:",W.interfaces[V]["name"],",")}else{Z.push(W.interfaces[V])}}var U=w.subTypesListSelected;var ab;var X=Z;if(M._InContextAdvancedSearch()){X=M.getIncontextSubtypeList(D[0],X)}else{if(!k.isCustoEnabled()){X=e.getAdvancedSearchCustoInterfaceList(D[0],X)}}if(!M._isInContextSearch()){if(w.internal){U=k.getInterfacesSelectedByDefault(D[0],N)}ab=k.getInterfacePreferredPosition(D[0],N)}Y.push(M._prepareSubTypePredicates({subTypesList:X,subTypesListSelected:U,preferredPosition:ab,exclusiveTaxonomies:k.isExclusiveTaxonomies(N)}));Q.updateCriteria(Y);if(w.subTypesListSelected){M._internalSubtypeSelection(w.subTypesListSelected)}})}}else{if(D.length>1){var K=o._asyncCallToPredicatesWS(D).then(function C(U){Q.removeCriteria(M._dynamicPredicatesPreferred);Q.removeCriteria(M._dynamicExtPredicateSetType);Q.removeCriteria(M._dynamicPredicateSetType);M._clearExtensionList();M._dynamicPredicateSetKind=[];M._dynamicPredicateSetType=[];M._loadPLMDictionaryAndRun(function(){U.classPredicates.forEach(function(X){var W;if(!M._isInContextSearch()){W=k.getExcludedPredicatesForType(X.className)}var V=M._prepareRelevantPredicates({dataPredicates:X.vocabularyPredicateInfo,pswitch:false,excludedPredicates:W,type:X.className});if(X.className.indexOf("ds6wg:XP_")==-1){if(M._dynamicPredicateSetType.length>0){M._dynamicPredicateSetType=M.intersect_safe(M._dynamicPredicateSetType,V)}else{M._dynamicPredicateSetType=V}}});M._dynamicPredicateSetType=M._sortByKey(M._dynamicPredicateSetType,"dispValue");Q.updateCriteria(M._dynamicPredicateSetType)})},function z(){console.log("promisePredicate fail !")})}else{if(D.length===0){var P=[];P=P.concat(M._dynamicPredicateSetType);if(M._isExtensionAvailable()){var T=[];T.push(this._prepareSubTypePredicates({subTypesList:[]}));Q.updateCriteria(T);P=P.concat(M._dynamicPredicateSetKind)}Q.removeCriteria(P.concat(M._dynamicExtPredicateSetType));M._dynamicPredicateSetType=[];M._dynamicExtPredicateSetType=[];M.clearFilters("type+kind");M._adv_search_field=null}}}}else{if(B===M.CORE_BASIC_SUBTYPE){var u=w.value;if(u.length==1){c.loadRelevantPredicates({className:u[0]},function(U){M._loadPLMDictionaryAndRun(function(){var W=M._prepareRelevantPredicates({dataPredicates:U.vocabularyPredicateInfo,pswitch:false,internal:w.internal});var Y=W;for(var X=0;X<Y.length;X++){for(var V=0;V<M._dynamicPredicateSetType.length;V++){if(M._dynamicPredicateSetType[V].dispValue===Y[X].dispValue){Y.splice(X>0?X--:0,1)}}}M._dynamicPredicateSetKind=Y;Q.updateCriteria(W)})})}else{Q.removeCriteria(M._dynamicPredicateSetKind);M.clearFilters("kind")}}}}}},_clearExtensionList:function(){var u=this.getOption("tagger_proxy");if(this._isExtensionAvailable()){var v=[];v.push(this._prepareSubTypePredicates({subTypesList:[]}));u.updateCriteria(v);u.removeCriteria(this._dynamicPredicateSetKind)}},_sortByKey:function(v,u){return v.sort(function(A,z){var w=A[u];var B=z[u];return((w<B)?-1:((w>B)?1:0))})},_sortByKeyDesc:function(v,u){return v.sort(function(A,z){var w=A[u];var B=z[u];return((w>B)?-1:((w<B)?1:0))})},intersect_safe:function(z,v){var y=[];for(var A=0,x=z.length;A<x;A++){for(var w=0,u=v.length;w<u;w++){if(UWA.is(z[A].sixw)&&z[A].sixw===v[w].sixw){y.push(z[A]);break}}}return y},handlePLMCriteriaChange:function(w){if(!m.is(w)||!m.is(w.PLMTitle)){throw new Error("Invalid Arg in AdvSearchMgr.handlePLMCriteriaChange!")}var v=this;var u=this.getOption("tagger_proxy");c.loadPLMSuggestList(w.PLMTitle,function(y){var x=v._preparePLMParamData(y);u.updatePLMSuggestions(x)})},handleTypeSuggestListChange:function(C){var G=this.getOption("tagger_proxy");if(!G){return}var E=j.getOption("SUGGEST_ON_ADVANCEDSEARCH");var H=this;var y=j.getOption("NLSMapping_3DSearch_Suggest_TACTICALOnly");var u=C.suggestField;if((!UWA.is(y)||(UWA.is(y)&&y[u]!=="None"))&&E&&UWA.is(C)&&UWA.is(C.suggestField)&&UWA.is(C.suggestTitle)&&C.suggestTitle.length>2){if(!m.is(C)){throw new Error("Invalid Arg in AdvSearchMgr.handlePLMCriteriaChange!")}var B="";if(UWA.is(H._criteriaData)){var D=H._criteriaData.sixw.split("/").pop();if(D==="ds6w:type"||D==="[vpmextension]"){if(UWA.is(H._criteriaData)&&UWA.is(H._criteriaData.value)&&H._criteriaData.value.length===1){if(0==H._criteriaData.value[0].indexOf("ds6wg:")||0==H._criteriaData.value[0].indexOf(H._currentDataSource)){var w=H._criteriaData.value[0].split(":").pop();if(H._currentDataSource!="3dspace"){var A="";A=A.concat(H._currentDataSource,":",w);B=B.concat("[ds6w:type]:",'"',A,'"')}else{B="[ds6w:type]:("+w+")"}}}else{if(H._criteriaData.value.length>1){for(var x=0;x<H._criteriaData.value.length;x++){if(0==H._criteriaData.value[x].indexOf("ds6wg:")||0==H._criteriaData.value[0].indexOf(H._currentDataSource)){var w=H._criteriaData.value[x].split(":").pop();w="("+w+")";if(x!==H._criteriaData.value.length-1){B+="[ds6w:type]:"+w+" OR "}else{B+="[ds6w:type]:"+w}}}B="("+B+")"}}}}if(UWA.is(y)&&y.hasOwnProperty(u)){if(m.is(y[u],"string")&&0===y[u].indexOf("ds6wg:")){u=y[u];if(B.length>0){B=B.concat(" AND [",u,"]:*",C.suggestTitle,"*")}else{B=B.concat("[",u,"]:*",C.suggestTitle,"*")}if(H._InContextAdvancedSearch()){if(UWA.is(H._InContextPrecondition())&&H._InContextPrecondition().trim().length>0){B=B.concat(" AND ").concat(H._InContextPrecondition().trim())}}}else{if(UWA.is(y[u])&&m.is(y[u].PQToUse,"string")&&m.is(y[u].attributeToRead,"string")){B="3dexp"+y[u].PQToUse+":(*"+C.suggestTitle+"*)";u=y[u].attributeToRead}}}else{if(H._currentDataSource!="3dspace"){if(B.length>0){B=B.concat(" AND [",u,"]:(",C.suggestTitle,"*)")}else{B=B.concat("[",u,"]:*",C.suggestTitle,"*")}}else{if(B.length>0){B=B.concat(" AND [",u,"]:(",C.suggestTitle,"*)")}else{B=B.concat("[",u,"]:(",C.suggestTitle,"*)")}}if(H._InContextAdvancedSearch()){if(UWA.is(H._InContextPrecondition())&&H._InContextPrecondition().trim().length>0){B=B.concat(" AND ").concat(H._InContextPrecondition().trim())}}}B="("+B+")";B=l.manageWildcardAddtion(B);var F="";var v=new Date();F="3DSearch-"+a.getUserId()+"-"+v.getTime();var I={with_indexing_date:true,with_nls:false,query:B,refine:{},order_field:"relevance",order_by:"desc",select_predicate:[u],label:F,source:[H._currentDataSource||"3dspace"]};if(H._currentDataSource!=="3dspace"){var z="";if(H._currentDataSource==="swym"){z={swym:{additional_query:""}}}else{if(H._currentDataSource==="drive"){z={drive:{additional_query:""}}}}I.specific_source_parameter=z;I.with_indexing_date=true;I.with_nls=false}else{I.select_synthesis=[u]}c.loadSearchSuggestList(I,function(K){var J=H._prepareSearchSuggestData(C,K);G.updateSuggestions(J)},function(){G.updateSuggestions({datasets:{items:[]},suggestField:C.suggestField})})}else{G.updateSuggestions({datasets:{items:[]},suggestField:C.suggestField})}},_prepareSearchSuggestData:function(u,G){var E=[];var Q=false;var D=this;var O={suggestField:u.suggestField,datasets:{name:u.suggestField,items:E}};var w=j.getOption("NLSMapping_3DSearch_Suggest_TACTICALOnly");var y=u.suggestField;if(UWA.is(G)&&UWA.is(G.facets)&&G.facets.length>0){var F=G.facets;var B=[];for(var L=0;L<F.length;L++){var R=F[L];if(UWA.is(R.sixw)&&R.sixw.indexOf(u.suggestField)>=0){B.push(R)}}var K=D._sortByKeyDesc(B,"count");var I=[];var x=K.length>9?10:K.length;for(var N=0;N<x;N++){var P=K[N];var A=P.dispValue||P.object;var H={value:P.object||P.dispValue,label:P.dispValue||P.object,type:P.type};if(I.indexOf(A)==-1){I.push(A);E.push(H)}}}if(UWA.is(G)&&UWA.is(G.results)&&(G.results.length>0)){var x=G.results.length>9?10:G.results.length;var I=[];for(var N=0;N<x;N++){var P=G.results[N];var J="",v="string",S="",A="",C=null;for(var M=0;M<P.attributes.length;M++){var z=P.attributes[M];if(z.format==="internal"){continue}else{if(z.format==="attribute"){if(UWA.is(w)&&w.hasOwnProperty(u.suggestField)){if(m.is(w[y],"string")&&0===w[y].indexOf("ds6wg:")){y=w[y]}else{if(UWA.is(w[y])&&m.is(w[y].PQToUse,"string")&&m.is(w[y].attributeToRead,"string")){y=w[y].attributeToRead}}}if(y===z.name){A=z.value;S=z.dispValue;var H={value:z.value||z.dispValue,label:z.dispValue||z.value,type:z.type};if(I.indexOf(A)==-1&&I.indexOf(S)==-1){if(UWA.is(A)){I.push(A)}else{I.push(S)}E.push(H)}}}}}}}return O},_preparePLMParamData:function(B){var z=[];var J=false;var H={name:B.plmtitle,items:z,hasMore:J};var E=a.getLanguage();var w=j.getOption("PLMParamNLS");if(UWA.is(B)&&UWA.is(B.info)&&B.info.length>0){var v=B.info.length;if(v>100){J=true}for(var G=0;G<v;G++){var I=B.info[G];var D,u,A,y,K=null;for(var F=0;F<I.attributes.length;F++){var x=I.attributes[F];if(x.format==="internal"){continue}if(x.format==="attribute"&&x.name==="plmparam.title"){K=x.value}else{if(m.is(w,"object")&&m.is(w[E],"string")&&x.format==="attribute"&&x.name===w[E]){D=x.value}else{if(x.format==="attribute"&&x.name==="plmparam.itf"){var L=x.value.substring(0,x.value.length-9);A=x.value;if(UWA.is(L)){if(L==="String"){u="string"}else{if(L==="Real"){u="double"}else{if(L==="Integer"){u="integer"}else{if(L==="Boolean"){u="boolean"}else{u="double"}}}}}}else{if(x.format==="attribute"&&x.name==="plmparam.displayunit"){y=x.value}}}}}var C={};if(y===undefined||y===null){C={value:D||K,subLabel:A,type:u,title:K}}else{C={value:D||K,subLabel:A,type:u,unit:y,title:K}}z.push(C)}}return H},_getSuggestDisabledPredicates:function(){var u=j.getOption("NLSMapping_3DSearch_Suggest_TACTICALOnly");for(var v in u){if(m.is(u[v],"string")&&u[v].toLowerCase()==="none"){this._suggestDisabledPredicates.push(v)}}},convertPLMParamUnits:function(z,I){if(m.is(z)&&m.is(z.plmparam)&&m.is(z.plmparam["double"])){var u=z.plmparam["double"];var H={Data:[]};var x=[];for(var A in u){var C=A;var E=u[A]["interface"];var K=E.substring(0,E.length-9);var D=u[A].unit;var y=f.getMKSNLSNameForDimension(K);var J=u[A];delete J.unit;if(m.is(D)&&D!==f.getMKSNLSLableNameForDimension(K)){for(var B in J){if(B!=="interface"){var G=J[B];var v=C.concat(".").concat(B);for(var w in G){var L={address:null,value:null};var F={UnitFrom:D,UnitTo:y,Dimension:K,Values:G[w]};H.Data.push(F);L.address=v.concat(".").concat(w);L.value=G[w];x.push(L)}}}}}f.loadConvertedMKSValues(H,function(Q){var M=z.plmparam["double"];for(var O=0;O<Q.length;O++){var S=x[O].address;var T=S.split(".");var N=T[T.length-2];var R=T[T.length-1];var P=S.substring(0,S.length-R.length-N.length-2);M[P][N][R]=parseFloat(Q[O].ConvertedValues)}I.call(undefined,z)})}},_prepareFTSFieldPredicate:function(){var u={dispValue:h.get("adv_search.ftsfield"),sixw:"fts_value",type:"string",options:{showByDefault:true}};return u},_prepareSourcePredicate:function(z,y,w){var v=[];if(UWA.is(z)){z=z.filter(function(B){if(h.get("adv_search.source."+B)==="adv_search.source."+B){q.warn("Data source : "+B+" has no NLS defined, so filtering it as not validated !!!");return false}else{return true}});for(var u=0;u<z.length;u++){var A={value:z[u],label:h.get("adv_search.source."+z[u])};if(!k.isCustoEnabled()&&((m.is(w)&&m.is(w.adv_search_field)&&m.is(w.adv_search_field,"string"))||(m.is(this._adv_search_field)&&m.is(this._adv_search_field,"string")))){A.predefined=true}if(z.length===1){A.predefined=true}else{if(w&&(w.selectedByDefault==A.value)){A.predefined=true}}v.push(A)}}var x={dispValue:h.get("adv_search.dataSource"),sixw:this.CORE_BASIC_SOURCE,type:y?"string":"enum",options:{multiSelect:false,disabled:v.length>1?false:(y?false:true),placeholder:v.length?h.get("adv_search.dataSource.message"):h.get("adv_search.dataSource.noSourceMessage"),noResultsMessage:h.get("adv_search.dataSource.noSourceMessage"),onCriterionSelectEvent:true,allowFreeInput:false,showSuggestsOnFocus:true,datasets:{name:"Sources",items:v},showByDefault:true}};this._dataSetsForSource=x;return x},_prepareTypePredicates:function(J){var u=J.typesList;var x=J.toAllowEdit;var G=J.vocabId;var y=J.typesListSelected||[];var A=J.preferredPosition||{};var H=J.excludedTypes||[];var B=[];var F=Object.keys(A).length;var w=new Array(F);if(UWA.is(u)){for(var D=0;D<u.length;D++){var E=u[D].nlsName;var z=u[D].name;var C=u[D].uri;if(H.indexOf(C)>=0){continue}if(!UWA.is(E)){E=h.get("adv_search.rdfclass."+u[D].uri)}var I={value:u[D].uri,label:E};if((m.is(J)&&m.is(J.options)&&m.is(J.options.adv_search_field)&&m.is(J.options.adv_search_field,"string"))||(m.is(this._adv_search_field)&&m.is(this._adv_search_field,"string"))){if(m.is(z)&&((this._adv_search_field==z)||(J.adv_search_field==z))){I.predefined=true}}if(y.indexOf(C)>=0){I.predefined=true}if(m.is(A[C])){w.splice(A[C],1,I)}else{if(!J.exclusiveTaxonomies){B.push(I)}}}}B=w.concat(B);var v={dispValue:h.get("adv_search.type"),sixw:this.CORE_BASIC_TYPE,type:x?"string":"enum",multiSelect:true,options:{multiSelect:true,disabled:B.length?false:(x?false:true),placeholder:B.length?h.get("adv_search.type.message"):h.get("adv_search.type.noTypeMessage"),noResultsMessage:h.get("adv_search.type.noTypeMessage"),onCriterionSelectEvent:true,allowFreeInput:false,showSuggestsOnFocus:true,datasets:{name:"Types",items:B},showByDefault:true}};this._dataSetsForType=v;return v},_prepareSubTypePredicates:function(E){var B=E.subTypesList;var v=E.toAllowEdit;var C=E.subTypesListSelected||[];var x=E.preferredPosition||{};var y=[];var A=Object.keys(x).length;var u=new Array(A);if(UWA.is(B)){for(var z=0;z<B.length;z++){var w={value:"ds6wg:"+B[z].name,label:B[z].nlsName};if(C.indexOf(w.value)>=0){w.predefined=true}else{if(C.indexOf(B[z].name)>=0){w.predefined=true}}if(m.is(x[B[z].name])){u.splice(x[B[z].name],1,w)}else{if(!E.exclusiveTaxonomies){y.push(w)}}}}y=u.concat(y);var D={dispValue:h.get("adv_search.subtype"),sixw:this.CORE_BASIC_SUBTYPE,type:v?"string":"enum",multiSelect:true,options:{multiSelect:true,disabled:y.length?false:(v?false:true),placeholder:y.length?h.get("adv_search.subtype.message"):h.get("adv_search.subtype.noSubTypeMessage"),noResultsMessage:h.get("adv_search.subtype.noSubTypeMessage"),onCriterionSelectEvent:true,allowFreeInput:false,showSuggestsOnFocus:true,datasets:{name:"SubTypes",items:y},showByDefault:true}};this._dataSetsForExtension=D;return D},_prepareRelevantPredicates:function(K){var u=K.dataPredicates,x=K.pswitch,D=K.type,w=K.internal,I=K.skip_basics,z=K.preferredPosition?K.preferredPosition:{};var H=a.isFUN072117Active();var C=function(L){var M=L.nlsName;if(L.dimension){if(L.dimension.trim().length==0){}else{if(H&&L.manipulationUnit&&L.manipulationUnit.trim().length>0){M=M+" ("+f.getUnitNLSForDimension(L.dimension,L.manipulationUnit.trim())+")"}else{M=M+" ("+f.getMKSNLSForDimension(L.dimension)+")"}}}return M};var A=[];var G=Object.keys(z).length;var B=new Array(G);if(UWA.is(u)){u=this.getIncontextPredicateList(D,u);for(var E=0;E<u.length;E++){if(UWA.is(u[E].uri)){if(p.isAVisiblePredicate(u[E].uri)){var y=UWA.is(u[E].uri)?u[E].uri:u[E].lineage;if((I===false)||(-1===this._incontextFixedPredicates.indexOf(y))&&(-1===this.BASIC_PREDICATES.indexOf(y))&&(-1===this.BASIC_PREDICATES_leaf.indexOf(y))){var F;if(u[E].rangeValues&&(UWA.is(u[E].range)&&UWA.is(u[E].range.dataTypes)||(UWA.is(u[E].type)))&&(a._getPredicateTypeFromDataType(u[E])==="string"||a._getPredicateTypeFromDataType(u[E])==="boolean")){F=this._prepareRangePredicate(u[E],u[E].showByDefault===false?false:x,w)}else{F={dispValue:C(u[E]),sixw:UWA.is(u[E].uri)?u[E].uri:u[E].lineage,type:a._getPredicateTypeFromDataType(u[E]),options:{showByDefault:u[E].showByDefault===false?false:x},allowSuggestions:this._suggestDisabledPredicates.indexOf(u[E].uri)===-1};if(w){var J=this._getIncontextSelectedPredicateValue(F.sixw);if(J){if(F.type=="string"){F.options.defaultValue=J}else{F.options.defaultValue=J[0]}}}}if(m.is(z[F.sixw])){F.options.showByDefault=true;B.splice(z[F.sixw],1,F)}else{A.push(F)}}}}}}for(var v=B.length-1;v>=0;v--){if(!B[v]){B.splice(v,1)}}if(B.length>0){A={preferredPredicates:B,relevantPredicates:A}}return A},_prepareRangePredicate:function(v,u,w){var x=[];var z=this._getIncontextSelectedPredicateValue(v.uri);if(v&&v.rangeValues&&v.rangeValues.literalInfo){v.rangeValues.literalInfo.forEach(function(A){if((A.value==="0")&&(A.nlsValue==="0")||(UWA.is(A.value)&&A.value.trim().length<1)){}else{var B={value:"enum|"+A.value,label:A.nlsValue};if(w&&z&&z.indexOf(B.value)>=0){B.predefined=true}x.push(B)}})}var y={dispValue:v.nlsName,sixw:UWA.is(v.uri)?v.uri:v.lineage,type:"string",options:{disabled:false,multiSelect:true,datasets:{name:"ranges",items:x},onCriterionSelectEvent:true,allowFreeInput:false,showSuggestsOnFocus:true,showByDefault:u}};return y},_getCoreBasicPredicates:function(){var z=[];var y;var v;if(p.isAVisiblePredicate("ds6w:label")){v=this._isIncontextBasicAvailable({uri:"ds6w:label",showByDefault:true});if(v.available){var u={dispValue:h.get("adv_search.label"),sixw:this.CORE_BASIC_LABEL,type:"string",options:{showByDefault:v.showByDefault},allowSuggestions:this._suggestDisabledPredicates.indexOf("ds6w:label")===-1};y=this._getIncontextSelectedPredicateValue("ds6w:label");if(UWA.is(y,"array")&&y.length>0){u.options.defaultValue=y}z.push(u)}}if(p.isAVisiblePredicate("ds6w:identifier")){v=this._isIncontextBasicAvailable({uri:"ds6w:identifier",showByDefault:true});if(v.available){var x={dispValue:h.get("adv_search.identifier"),sixw:this.CORE_BASIC_IDENTIFIER,type:"string",options:{showByDefault:v.showByDefault},allowSuggestions:this._suggestDisabledPredicates.indexOf("ds6w:identifier")===-1};y=this._getIncontextSelectedPredicateValue("ds6w:identifier");if(UWA.is(y,"array")&&y.length>0){x.options.defaultValue=y}z.push(x)}}if(p.isAVisiblePredicate("ds6w:modified")){v=this._isIncontextBasicAvailable({uri:"ds6w:modified",showByDefault:true});if(v.available){var w={dispValue:h.get("adv_search.modified"),sixw:this.CORE_BASIC_MODIFIED,type:"date",options:{showByDefault:v.showByDefault}};y=this._getIncontextSelectedPredicateValue("ds6w:modified");if(UWA.is(y,"array")&&y.length>0){w.options.defaultValue=y[0]}z.push(w)}}return z},_getExtendedBasics:function(){var u=[];var z;var v;if(p.isAVisiblePredicate("ds6w:description")){v=this._isIncontextBasicAvailable({uri:"ds6w:description",showByDefault:false});if(v.available){var x={dispValue:h.get("adv_search.description"),sixw:this.EXT_BASIC_DESCRIPTION,type:"string",options:{showByDefault:v.showByDefault},allowSuggestions:this._suggestDisabledPredicates.indexOf("ds6w:description")===-1};z=this._getIncontextSelectedPredicateValue("ds6w:description");if(UWA.is(z,"array")&&z.length>0){x.options.defaultValue=z}u.push(x)}}if(p.isAVisiblePredicate("ds6w:responsible")){v=this._isIncontextBasicAvailable({uri:"ds6w:responsible",showByDefault:false});if(v.available){var y={dispValue:h.get("adv_search.responsible"),sixw:this.EXT_BASIC_RESPONSIBLE,type:"string",options:{showByDefault:v.showByDefault},allowSuggestions:this._suggestDisabledPredicates.indexOf("ds6w:responsible")===-1};z=this._getIncontextSelectedPredicateValue("ds6w:responsible");if(UWA.is(z,"array")&&z.length>0){y.options.defaultValue=z}u.push(y)}}if(p.isAVisiblePredicate("ds6w:created")){v=this._isIncontextBasicAvailable({uri:"ds6w:created",showByDefault:false});if(v.available){var w={dispValue:h.get("adv_search.created"),sixw:this.EXT_BASIC_CREATED,type:"date",options:{showByDefault:v.showByDefault}};z=this._getIncontextSelectedPredicateValue("ds6w:created");if(UWA.is(z,"array")&&z.length>0){w.options.defaultValue=z[0]}u.push(w)}}return u},_getIncontextCommonPredicates:function(B){var y=this;var A;var w;var x=this._InContextAdvancedSearch();if(x){A=x.common_predicates;w=x["ds6w:type"]}if(m.is(A,"array")&&A.length>0){if(A[0].type){var v=y._prepareRelevantPredicates({dataPredicates:A,pswitch:true,skip_basics:false});B.call(undefined,v)}else{if(m.is(w,"array")&&w.length>0){var z={};A.forEach(function(C){z[C.uri]=C});var u=w[0].uri;c.loadRelevantPredicates({className:u},function(C){y._loadPLMDictionaryAndRun(function(){var F={};C.vocabularyPredicateInfo.forEach(function(G){if(z[G.uri]){F[G.uri]=G;F[G.uri].showByDefault=z[G.uri].showByDefault}});var E=[];A.forEach(function(G){if(F[G.uri]){E.push(F[G.uri])}});var D=y._prepareRelevantPredicates({dataPredicates:E,pswitch:true,skip_basics:false});B.call(undefined,D)})})}}}},_loadPLMDictionaryAndRun:function(u){f.loadDictionary().then(function(){u.call()})},_filterIncontextSources:function(u){var x=this.getOption("collection");if(x){var w=x._ctx_options;if(w){var v=w.source;if(v){u=u.filter(function(y){return v.indexOf(y)>=0})}}}return u},_isInContextSearch:function(){var u=this.getOption("collection");if(u&&u._ctx_options){return true}},_InContextAdvancedSearch:function(){var u=this.getOption("collection");if(u&&u._ctx_options){return u._ctx_options.advanced_search}},_InContextPrecondition:function(){var u=this.getOption("collection");if(u&&u._ctx_options){return u._ctx_options.precond}},showInContextExtension:function(){var u=this._InContextAdvancedSearch();if(u&&u.showExtension===false){return false}return true},getIncontextTypeList:function(x){var v=this._InContextAdvancedSearch();if(v){var u=v["ds6w:type"];if(u){var w=x.filter(function(z){for(var y=0;y<u.length;y++){if(u[y].uri==z.uri){return true}}});return w}}return x},getIncontextSubtypeList:function(B,u){var z=this._InContextAdvancedSearch();if(z){var w=z["ds6w:type"];var A;if(w&&B){for(var x=0;x<w.length;x++){if(w[x].uri==B){A=w[x].interfaces;break}}if(A){var v={};A.forEach(function(C){v[C.name]=C});var y=u.filter(function(C){if(v[C.name]){return true}});return y}else{return u}}}return u},getIncontextPredicateList:function(A,z){var y=this._InContextAdvancedSearch();if(y){var w=y["ds6w:type"];var u;if(w&&A){for(var x=0;x<w.length;x++){if(w[x].uri==A){u=w[x].predicates}}if(u){if(m.is(u,"array")){var v=[];u.forEach(function(C){for(var B=0;B<z.length;B++){if(z[B].uri==C.uri){v.push(z[B]);break}}});return v}}else{return z}}}return z},_isIncontextBasicAvailable:function(v){var u={available:true,showByDefault:v.showByDefault};var x=this._InContextAdvancedSearch();if(x){var w=x.basic_predicates;if(w){u.available=w.some(function(y){if(y.uri==v.uri){if(m.is(y.showByDefault)){u.showByDefault=y.showByDefault}return true}})}}return u},_getIncontextSelectedPredicateValue:function(v){var u=this._InContextAdvancedSearch();if(u&&u.selection){return u.selection[v]}},_filterCustoExcludedSources:function(v,u){var w=k.getExcludedDataSources(u);if(w){v=v.filter(function(x){return w.indexOf(x)<0})}return v},_prepareTypePredicatesFromCusto:function(C){var w;var x=C.toAllowEdit;var B=C.vocabId;var u=C.source;var z=C.typeSelectedByDefault;var y=this;var v=C.tenantId;if(UWA.is(B)){var A={vocabId:B};if(k.isCustoEnabled()&&!y._isInContextSearch()){if(k.isExclusiveTaxonomies()){k.getCustoTypeListNLSNames({onComplete:function(H){var I=[];var J=k.getTypePreferredPosition(v,u);var D=Object.keys(J);var E=D.length;for(var K=0;K<E;K++){I.push(undefined)}for(var K=0;K<E;K++){var M=D[K];var F=J[M];var N=H[M];var L=M.split(":");var P="";if(UWA.is(N)&&UWA.is(N.nlsName)){P=N.nlsName}var O={"abstract":false,description:"",name:L.length>1?L[1]:L[0],nlsName:P,type:"Class",uri:M};I.splice(F,1,O)}var G=y._prepareTypePredicates({typesList:I,vocabId:B,typesListSelected:z?z:k.getTypesSelectedByDefault(u),preferredPosition:k.getTypePreferredPosition(v,u),exclusiveTaxonomies:k.isExclusiveTaxonomies()});if(UWA.is(C)&&UWA.is(C.onComplete)&&UWA.is(C.onComplete,"function")){C.onComplete.call(y,G)}}})}else{c.loadVocabularyClasses({vocabId:B},function(E){var D=y._prepareTypePredicates({typesList:E.classInfos,vocabId:B,typesListSelected:z?z:k.getTypesSelectedByDefault(u),preferredPosition:k.getTypePreferredPosition(v,u),exclusiveTaxonomies:k.isExclusiveTaxonomies(),excludedTypes:k.getExcludedTypes(v,u)});if(UWA.is(C)&&UWA.is(C.onComplete)&&UWA.is(C.onComplete,"function")){C.onComplete.call(y,D)}})}}else{A.onComplete=function(E){var H=[];if(UWA.is(E)){var D=j.getOption("SEARCH_INSTANCES");for(var I=0;I<E.length;I++){var J=E[I].nlsName;var G=E[I].name;var L=E[I].uri;if(UWA.is(D)&&D===true){L=E[I].uri+":"+E[I].type}if(!UWA.is(J)){J=h.get("adv_search.rdfclass."+E[I].uri)}var K={value:L,label:J};if((m.is(C)&&m.is(C.options)&&m.is(C.options.adv_search_field)&&m.is(C.options.adv_search_field,"string"))||(m.is(y._adv_search_field)&&m.is(y._adv_search_field,"string"))){if((y._adv_search_field==G)||(C.adv_search_field==G)){K.predefined=true}}H.push(K)}var F={dispValue:h.get("adv_search.type"),sixw:y.CORE_BASIC_TYPE,type:x?"string":"enum",multiSelect:true,options:{multiSelect:true,disabled:H.length?false:(x?false:true),placeholder:H.length?h.get("adv_search.type.message"):h.get("adv_search.type.noTypeMessage"),noResultsMessage:h.get("adv_search.type.noTypeMessage"),onCriterionSelectEvent:true,allowFreeInput:false,showSuggestsOnFocus:true,datasets:{name:"Types",items:H},showByDefault:true}};if(UWA.is(C)&&UWA.is(C.onComplete)&&UWA.is(C.onComplete,"function")){C.onComplete.call(y,F)}y._dataSetsForType=F}};A.onFailure=function(){if(UWA.is(C)&&UWA.is(C.onFailure)&&UWA.is(C.onFailure,"function")){C.onFailure.call(y)}};e.getAdvancedSearchCustoTypeList(B,w,A)}}return null}});return d});define("DS/SNResultUX/models/SearchItemModel",["UWA/Core","UWA/Class/Model","DS/W3DXComponents/Collections/ActionsCollection","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/ResultUX_customization","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchSettings"],function(d,c,b,e,a,g,f){var h=c.extend({_isRecentSearch:false,setup:function(j,k){var m=this;this.actions=new b([],{parent:this});this.action_ids=[];if(d.is(j)){if(j.hasOwnProperty("session_object")){this.session_object=true;delete j.session_object}if(j.hasOwnProperty("isRecentSearchResult")){this._isRecentSearch=j.isRecentSearchResult;delete j.isRecentSearchResult}}var i=true;var l=null;if(d.is(this.collection)){if(this.collection._isAHelper===true){i=false}l=this.collection._ctx_options}if(true==this.isAShowOnlyObject()){i=false}if(i){a.getAvailableActions({attributes:j},function(n){n.forEach(function(o){if(m.action_ids.indexOf(o.id)===-1){m.action_ids.push(o.id);m.actions.push(o)}});if(!m._attributes.actions||m._attributes.actions.length===0){m._attributes.actions=m.actions.pluck("title")}},{inCtxOptions:l})}this._parent(j,k)},getFederatedSource:function(){return d.is(this.collection)?this.collection.search_ressources:null},get:function(i){return this._parent(e.getURIToUse(i))},set:function(n,p,l){var k;if(d.is(n,"object")){var o=Object.keys(n);k={};for(var m=0,j=o.length;m<j;m++){k[e.getURIToUse(o[m])]=n[o[m]]}l=p||{}}else{k={};k[e.getURIToUse(n)]=p;l=l||{}}return this._parent(k,l)},getSourceID:function(){var i=this.get("sourceid_value");if(d.is(i,"string")&&i.length>0){return i.split(":")[0]}else{console.error("sourceid not found OR not in the expected format")}},getServiceID:function(){return g.getServiceFromSource(this.getSourceID())},getPlatformID:function(){var i="OnPremise";var j=this.get("sourceid_value");if(d.is(j,"string")&&j.length>0){var k=j.split(":");if(k.length>1){i=k[1]}}else{console.error("sourceid not found OR not in the expected format")}return i},getType:function(){return this.get("ds6w:type_value")},isARecentSearchResult:function(){return this._isRecentSearch},isAShowOnlyObject:function(){var i=this.get("showonly");if(true===f.getOption("showOnlySupport")){if(d.is(i,"string")&&"true"===i){return true}else{return false}}return false},IsAnInstance:function(){if(f.getOption("SEARCH_INSTANCES")===true){var i=this.get("ds6wg:isAnInstance_value");if(i==="Instance"){return true}}return false}});return h});define("DS/SNResultUX/utils/ContentLocationServices",["UWA/Core","UWA/Class","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchLogin","UWA/Utils/InterCom","DS/SNInfraUX/SearchPreferences","DS/SNResultUX/models/SearchItemModel","UWA/Class/Model","DS/SNResultUX/utils/ResultsUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(n,t,g,v,a,o,f,q,d,i,l,u){var b={R2019x:"BETA3"};var h="contentsLocation_FUN072059";var c="ds6w:where/ds6w:source/ds6w:dataSource";var p={};var r;var j;var e=[];var k=[];var m;m=t.singleton({init:function(){console.log("Initilization Content Location Services");r=this.getInternalSourceToPredicateMapping();j=this.getListOfExternalDataSources()},transformToDataSourceFacets:function(x,z){var w=x[z];var A="";var C=0;if(x.length>z){var y=w.object;if(w.sixw===c){w.sixw=c;w.dispValue=[];w.object=[y]}var B;r.forEach(function(D){if(D.uri===w.sixw){B=D}});if(n.is(B)){if(n.is(w.object,"array")===true){A=w.object;C=A.indexOf("_drv")}else{A=w.object;C=A.indexOf("_drv")}if(C>0){x.splice(z,1)}else{w.object=[B.service,w.object];w.sixw=c;w.dispValue=[]}}}},transformTagsValuesToDataSourceFacets:function(D,w,C,z){var E=D[w[C]][z];var B="";var y=0;if(D[w[C]].length>z){var x=E.object;if(E.sixw===c&&!(x==="GoogleDrive"||x==="DropBox")){E.sixw=c;E.dispValue=[]}var A;r.forEach(function(F){if(F.uri===E.sixw){A=F}});if(n.is(A)){if(n.is(E.object,"array")==true){B=E.object;y=B.indexOf("_drv")}else{B=E.object;y=B.indexOf("_drv")}if(y>0){D[w[C]].splice(z,1)}else{E.object=[A.service,E.object];E.sixw=c;E.dispValue=[]}}}},transformFilterSourceToProject:function(x){if(x.allfilters.hasOwnProperty(c)===true){var C=0;var w=0;var D="";if(n.is(x.allfilters[c],"array")===true&&x.allfilters[c].length>0){var A=0;var E=0;var B=x.allfilters[c].length;for(var z=0;z<B;z++){if(n.is(x.allfilters[c][z].object,"array")===true){D=[x.allfilters[c][z].object[0]];E=x.allfilters[c][z].object.length}else{D=[x.allfilters[c][z].object];E=1}if(E===2){D=[x.allfilters[c][z].object[0]];var y;r.forEach(function(F){if(F.service===D[0]){y=F}});if(n.is(y)){if(x.allfilters.hasOwnProperty(y.uri)===false){x.allfilters[y.uri]=[]}}if(D[0]==="3DSwym"){x.allfilters[y.uri].push(x.allfilters[c][z]);A=x.allfilters[y.uri][w].object.length;x.allfilters[y.uri][w].object=x.allfilters[y.uri][w].object[A-1];w=w+1;x.localfilters[c].splice(z,1);x.allfilters[c].splice(z,1);B=B-1;z=z-1}if(D[0]==="3DSpace"){x.allfilters[y.uri].push(x.allfilters[c][z]);A=x.allfilters[y.uri][C].object.length;x.allfilters[y.uri][C].object=x.allfilters[y.uri][C].object[A-1];C=C+1;x.localfilters[c].splice(z,1);x.allfilters[c].splice(z,1);B=B-1;z=z-1}}}if(x.allfilters.hasOwnProperty(c)===true&&x.allfilters[c].length===0){delete x.localfilters[c];delete x.allfilters[c]}}return true}else{}return false},updateFilter:function(x,w){},caseInsensitiveMatch:function(x){var w;if(x.toString()=="3DDrive"){x=["drive"];return x}var y=new RegExp(x,"gi");for(var z=0;z<e.length;z++){w=k[z].match(y);if(n.is(w)){w=e[z];return w}else{w=e[z].match(y);if(n.is(w)){w=e[z];return w}}}},getAvblSource:function(x){var w=o.getAvailableSources(x);if(n.is(w)){w.forEach(function(y){if(n.is(y.name)&&n.is(y.service)){e.push(y.name);k.push(y.service)}})}},getInternalSourceToPredicateMapping:function(){return[{source:"swym",predicate:"ds6w:community",uri:"ds6w:where/ds6w:context/ds6w:community",position:"I",service:"3DSwym"},{source:"3dspace",predicate:"ds6w:project",uri:"ds6w:where/ds6w:context/ds6w:project",position:"I",service:"3DSpace"}]},getListOfExternalDataSources:function(){},isContentLocationActive:function(){if(a.isInTheSimpleSearch()){if(g.getOption(h)){if(v.isActiveWithCurrentVersion(b)){return true}}}return false},addSourceSpecificParameterToFilterDataCreationUri:function(w){var x=Object.keys(w.refine.allfilters);if(!n.is(w.source)){w.source=[]}x.forEach(function(A){var B;r.forEach(function(C){if(C.uri===A){B=C}});if(n.is(B)){var z={};z["sixw:"+A]=w.refine.allfilters[A];var y=l.from_filters_to_uql(z,"#all");a.addSourceSpecificParameter(w,{sourceIds:[B.source],param:{id:"additional_query",value:"AND  ("+y+")"}});w.source.push(B.source);delete w.refine.allfilters[A]}})},addSourceSpecificParameterToFilterDataDriverForDataSrcUri:function(y){var B="";var w=[];var A=false;if(y.refine.allfilters.hasOwnProperty(c)===true){if(!n.is(y.source)){y.source=[]}if(y.refine.allfilters[c].length===1){B=y.refine.allfilters[c][0].object}else{for(var z=0;z<y.refine.allfilters[c].length;z++){w.push(y.refine.allfilters[c][z].object)}}if(n.is(w,"array")===true&&y.refine.allfilters[c].length>1){for(var z=0;z<w.length;z++){var x=this.caseInsensitiveMatch(w[z]).toString();w[z]=x}A=true}else{B=this.caseInsensitiveMatch(B).toString();A=false}if(A===true){w.forEach(function(C){y.source.push(C)})}else{if(y.source.length>0){y.source.push(B)}else{y.source=[B]}}delete y.refine.allfilters[c];delete y.refine.localfilters[c]}},addSourceSpecificParameterToFilterData:function(w){if(n.is(w.refine)&&n.is(w.refine.allfilters)){this.addSourceSpecificParameterToFilterDataCreationUri(w);this.addSourceSpecificParameterToFilterDataDriverForDataSrcUri(w)}},displaySourceInSearchView:function(x,y,w){var B="";var C="";var z=c.split("/");var D=0;for(D=0;D<z.length;D++){if(z[D]==="ds6w:dataSource"){break}}if(n.is(y.grid)&&n.is(y.grid.sourceid_value)){var A=y.grid.sourceid_value.indexOf(":");if(A>0){var G=y.grid.sourceid_value.split(":");C=G[1];B=G[0]}else{if(n.is(y.collection)&&n.is(y.collection.search_ressources)&&y.collection.search_ressources.active_tenant==="OnPremise"){C="OnPremise";B=y.grid.sourceid_value}}var F=o.getServiceFromSource(B);var E="";if(n.is(this.NLSNAMEDETAILS)&&true===this.NLSNAMEDETAILS.hasOwnProperty(z[D])&&(B==="3dspace"||B==="swym")){E=this.NLSNAMEDETAILS[z[D]][F];if(!n.is(y.grid[z[D]])){y.grid[z[D]]=E}if(!n.is(y.withoutHtmlTag[z[D]])){y.withoutHtmlTag[z[D]]=E}if(!n.is(y.grid[z[D]+"_value"])){y.grid[z[D]+"_value"]=E}if(!n.is(y.withoutHtmlTag[z[D]+"_value"])){y.withoutHtmlTag[z[D]+"_value"]=E}}else{if(!n.is(y.grid[z[D]])){y.grid[z[D]]=u.get(B+".displayName")}if(!n.is(y.withoutHtmlTag[z[D]])){y.withoutHtmlTag[z[D]]=u.get(B+".displayName")}if(!n.is(y.grid[z[D]+"_value"])){y.grid[z[D]+"_value"]=F}if(!n.is(y.withoutHtmlTag[z[D]+"_value"])){y.withoutHtmlTag[z[D]+"_value"]=F}}}},setNlsNameDetails:function(w){this.NLSNAMEDETAILS=w},addSource:function(C,y){var A=o.getAvailableSources(y);var x=c.split("/");var z=0;for(z=0;z<x.length;z++){if(x[z]==="ds6w:dataSource"){break}}if(C.hasOwnProperty(x[z])===true){var w=C[x[z]].length;for(var B=0;B<A.length;B++){if(A[B].status===true){if(C[x[z]].indexOf(A[B].service)<0){C[x[z]][w]=A[B].service;w=w+1}}}}}});return m});define("DS/SNResultUX/utils/SearchTagsTransformation",["UWA/Core","DS/SNResultUX/utils/ContentLocationServices","DS/SNInfraUX/SearchSettings","i18n!DS/SNInfraUX/assets/nls/SN6WOntology.json"],function(b,e,d,c){function a(f){this.prepareNlsPropertiesValueForServer=function(g,h){if(e.isContentLocationActive()===true&&f.isTransientWidget){}a.prepareTransformedFacetValuesToTranslate(g,h);return h};this.displaySourceInSearchView=function(i,g,h){if(e.isContentLocationActive()===true&&f.isTransientWidget){e.displaySourceInSearchView(i,g,h)}};this.addSource=function(h,g){if(e.isContentLocationActive()===true&&f.isTransientWidget){e.addSource(h,g)}};this.isTransientWidget=function(){return f.isTransientWidget};this.setNlsNameDetails=function(g){if(e.isContentLocationActive()===true&&f.isTransientWidget){e.setNlsNameDetails(g)}};this.transformFacets=function(g,i){if(e.isContentLocationActive()===true&&f.isTransientWidget){e.transformToDataSourceFacets(g,i)}var h=a.getPredicateMappingObject();var j=g[i].sixw.split("/").pop();if(h&&h.hasOwnProperty(j)){if(!b.is(g[i].object,"array")){g[i].dispValue=[];g[i].object=[g[i].object]}}};this.transformTagsValuesToDataSourceFacets=function(h,g,i,j){if(e.isContentLocationActive()===true&&f.isTransientWidget){e.transformTagsValuesToDataSourceFacets(h,g,i,j)}};this.transformFilterSourceToProject=function(j){if(e.isContentLocationActive()===true&&f.isTransientWidget){var h=e.transformFilterSourceToProject(j)}if("1"==a.getMappingVersion()){var g=j.localfilters;var i=j.allfilters;a.transformFilterOnMappedPredicates(i);a.transformFilterOnMappedPredicates(g)}};this.getAvblSource=function(g){if(e.isContentLocationActive()===true&&f.isTransientWidget){e.getAvblSource(g)}};this.updateFilter=function(h,g){if(e.isContentLocationActive()===true&&f.isTransientWidget){return e.updateFilter(h,g)}};return this}a.getMappingVersion=function(){return d.getOption("searchTypeOntology")};a.getPredicateMappingObject=function(){var g=null;if("1"==a.getMappingVersion()){var f=d.getOption("predicate_Mapping");if(b.is(f)&&(true===f.isActive)){g=f}}return g};a.transformPredicateValuesWithMapping=function(g){var f=a.getPredicateMappingObject();if(("1"==a.getMappingVersion())&&b.is(f)&&b.is(g)){g.forEach(function(k){var m=k.sixw.split("/").pop();if(b.is(m)){m=m.split("/").pop()}if(b.is(m)&&(true===f.hasOwnProperty(m))&&(b.is(f[m],"object"))){var h=k.object;if(f[m].hasOwnProperty(h)){var l=f[m][h];if(b.is(l,"array")){for(var j=0;j<l.length;j++){if(l[j]==="$"){l[j]=h}}}k.object=l}}})}};a.prepareTransformedFacetValuesToTranslate=function(f,h){var g=a.getPredicateMappingObject();if(("1"==a.getMappingVersion())&&b.is(g)){if(g.hasOwnProperty(f)){if(b.is(h,"array")){h=h[0]}else{h=h.split("/").pop()}}}return h};a.transformNlsForMappedPredicates=function(k){var g=a.getPredicateMappingObject();if(("1"==a.getMappingVersion())&&(b.is(g))){for(var i in k){if(g.hasOwnProperty(i)){for(var h in k[i]){if(0<h.indexOf("/")){var j=h.split("/").pop();if(b.is(k[i][j])){k[i][h]=k[i][j]}}else{if(0<h.indexOf(":")){var j=h.split(":").pop();if(b.is(k[i][j])){k[i][h]=k[i][j]}}else{var f=c.get(h);if(b.is(f)&&c.hasOwnProperty(h)){k[i][h]=f}}}}}}}};a._getAggregatedFacets=function(f,k){var i=[];var h=a.getPredicateMappingObject();if(("1"==a.getMappingVersion())&&b.is(h)&&h.hasOwnProperty(f)){var j=h[f];for(var m in j){var g=j[m];var l=false;if(b.is(g,"array")){g.forEach(function(n){if(n===k){l=true}})}if(l===true){i.push(m)}}}return i};a._buildAdditionalFacetsFromCategory=function(f,h){var g=f.split("/").pop();var i=[];h.forEach(function(n){var l=[];l.push(n);var m=n.object;var k=[];if(b.is(m)){var j=a._getAggregatedFacets(g,m);j.forEach(function(p){var o=b.clone(n);o.object=p;o.disptext=p;k.push(o)})}if(k.length){l=k}i=i.concat(l)});return i};a.transformFilterOnMappedPredicates=function(g){if(b.is(g,"object")){for(var f in g){g[f].forEach(function(h){if(b.is(h.object,"array")){h.object=h.object[h.object.length-1]}});g[f]=a._buildAdditionalFacetsFromCategory(f,g[f])}}};return a});define("DS/SNResultUX/SNSkeletonMgt_v2",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Class/Listener","DS/WAFData/WAFData","UWA/Utils/InterCom","DS/WebappsUtils/Performance","DS/MessageBus/MessageBus","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/Layout/ListView","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/UIKIT/Native/Dropdown","DS/UIKIT/DropdownMenu","DS/UIKIT/Spinner","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchCom","DS/Utilities/Utils","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchViewServices","DS/SNInfraUX/ServiceDelegationLoader","DS/SNResultUX/utils/SearchActions","DS/SNResultUX/utils/SearchLocalActions","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchViewOptions","DS/SNResultUX/utils/ResultUX_customization","DS/SNResultUX/utils/AdvSearchMgr","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNResultUX/views/SearchTreeListView","DS/SNResultUX/views/SearchDataGridView","DS/SNResultUX/views/SearchTileGridView","DS/SNResultUX/views/SearchRespTileGridView","DS/SNResultUX/views/SearchRespTextualTileGridView","DS/SNResultUX/views/SearchRespLargeTileGridView","DS/SNResultUX/views/SearchRespThumbnailGridView","DS/SNResultUX/views/SearchThumbnailGridView","DS/SNResultUX/SearchPQListUX","DS/SNResultUX/views/SearchCounterView","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassPlatformServices/OpenWith","DS/SNResultUX/utils/SearchDoubleClickHandler","DS/WebRecordEnabler/Adapter","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/Logger","DS/SNResultUX/utils/SearchTagsTransformation","css!DS/UIKIT/UIKIT.css"],function(I,P,h,f,n,o,R,v,D,V,K,t,J,u,m,z,E,H,U,N,L,e,G,F,C,r,a,w,x,p,S,M,b,i,q,O,y,B,A,j,k,T,d,l,g,Q,c,W){return P.extend(E,h,f,n,{uwaClassName:"DS/SNResultUX/SNSkeletonMgt_v2",name:"DS_SNResultUX_SNSkeletonMgt_v2",_skeleton:null,_onesearch_collection:null,_panelTitle:null,_searchcom_socket:null,_compass_socket:null,_WebInWinCtxActionSocket:null,_currentItemView:null,_myDatagridView:null,_isStartWithTableView:false,_isFirstTimeTableViewSwitch:true,_WidgetTitleObj:null,_advSearchMgr:null,_searchActions:null,_model:null,ctxMenu:null,_currentItemViewCid:null,_BI_Shades:null,_selectionMode_techno:"nullToMany",_neverAction:false,_informationPanel:null,_lastSelectedItem:null,_lightBoxView:null,_ctxMenuTarget:null,_IsFirstTimeDone:false,_IsFirstPageOfResultsDone:false,_lastSearchOptions:null,_firstPage:0,_default_results_perpage:0,_in_app_multiSel:null,_printWindow:null,_subscriptions:null,_previewState:true,_viewsId:[],_order_field:"",_order_by:"",init:function(Y){this.log("init");var ab=this;this.closePrintWindow=function(){if(I.is(ab._printWindow)){ab._printWindow.close()}return};window.addEventListener("beforeunload",this.closePrintWindow);this._subscriptions={};this._WidgetTitleObj={};if(I.is(Y)&&!I.is(Y._selectionMode_techno)&&I.is(Y.in_apps_search)&&I.is(Y.in_apps_search.multiSel)){Y._selectionMode_techno=(true===Y.in_apps_search.multiSel)?"nullToMany":"oneToOne"}if(I.is(H)&&I.is(H.options.search_settings)&&I.is(H.options.search_settings.multiSel)&&false===H.options.search_settings.multiSel){Y._selectionMode_techno="oneToOne"}Y._neverAction=false;if(I.is(H)&&I.is(H.options.search_settings)&&I.is(H.options.search_settings.neverAction)&&H.options.search_settings.neverAction===true){Y._neverAction=true}if(e.isInTheSimpleSearch({tenant:Y.resources.active_tenant})===true&&U.getItem("NomultiSelection")===true){Y._selectionMode_techno="oneToOne";var Z=H.getOption("search_compact_mode");if(I.is(Z)&&Z===false){Y._selectionMode_techno="nullToMany"}}this._parent(Y);var ae=this.getOption("in_apps_search");if(ae){w.setContextOptions(ae);if(I.is(ae.title,"string")){this._WidgetTitleObj.searchTitlePrefix=ae.title}}else{w.setContextOptions(null)}this._selectionMode_techno=Y._selectionMode_techno||"nullToMany";this._neverAction=Y._neverAction;this._skeleton=new V(this._buildSkeletonRenderers());if(I.is(this.getOption("renderTo"))){this.render().inject(this.getOption("renderTo"));var X="100%";if(this.getOption("furtive")===true){X="calc(100% - 48px)"}this._skeleton.setHeight(X);this._skeleton.container.addClassName("onesearch_skeleton")}if(I.is(this.getOption("observable"),"object")){this.listenTo(this.getOption("observable"),{onSearchSkeletonPQ:function(af){if(!I.is(ab._skeleton)){c.error("No skeleton !");return null}j.showPQSelector({pqSelectionCallback:function(ag){if(H.getOption("search_web_in_win")===true){if(window.hasOwnProperty("sendNotificationWebInWin")&&I.is(sendNotificationWebInWin,"function")){sendNotificationWebInWin("PQSelector",ag)}}}})},onSearchSkeleton:function(ao){ab._IsFirstTimeDone=false;ab._IsFirstPageOfResultsDone=false;if(!I.is(ab._skeleton)){c.error("No skeleton !");return null}if(ab._skeleton._alert){ab._skeleton._alert.destroy();ab._skeleton._alert=null}if(ab._searchActions.popover){ab._searchActions.popover.hide()}if(ab.getCollection().custoAction&&ab.getCollection().custoAction.popover){ab.getCollection().custoAction.popover.hide()}if("/onesearch/"!==ab._skeleton.getRoute()){ab._skeleton.slideBack()}ab._order_by=ao.order_by?ao.order_by:((ab._onesearch_collection&&ab._onesearch_collection.service_parameters)?ab._onesearch_collection.service_parameters.order_by:"");ab._order_field=ao.order_field?ao.order_field:((ab._onesearch_collection&&ab._onesearch_collection.service_parameters)?ab._onesearch_collection.service_parameters.order_field:"");var aj={query:ao.search_criteria,mode:ao.search_mode,refine:ao.tag_filter,adv_search:ao.adv_search,advanced_criteria:ao.advanced_criteria,source:ao.source,originalSearchCriteria:ao.originalSearchCriteria,specific_source_parameter:ao.specific_source_parameter,order_field:ab._order_field,order_by:ab._order_by,recent_search:ao.recent_search,context:ao.context,searchInCriteria:ao.searchInCriteria,idWaitLoading:ao.idWaitLoading,refineSearch:ao.refineSearch};if((H.getOption("search_web_in_win"))&&(I.is(ab.order_field))&&(I.is(ab.order_by))){aj.order_field=ab._order_field;aj.order_by=ab._order_by}var aq=ab.getCollection();var au=true;if(aj.query===e.SearchTypeEnum.ADVANCED_SEARCH&&!I.is(ao.advanced_criteria)){if(aq._ctx_options&&aq._ctx_options.advanced_search){if(aq._ctx_options.advanced_search.searchOnInit){if(I.is(aq._ctx_options.precond,"string")&&aq._ctx_options.precond.trim().length>0){ao.advanced_criteria=aq._ctx_options.precond}}if(aq._ctx_options.advanced_search.showByDefault===false){au=false}}}var af=false;if(I.is(ao.advanced_criteria)&&ao.advanced_criteria.length){if(aj.query===e.SearchTypeEnum.ADVANCED_SEARCH){aj.query="";af=true}if(aj.query.length){aj.query+=" AND "}aj.query+="("+ao.advanced_criteria+")"}if(I.is(ao.localFilter,"object")){aj.localFilter=ao.localFilter}var aw=false;var am=null;var an=null;var ak=ab.getCollection().getTaggerProxy();var ah=ak.getCurrentFilter();if(I.is(ah)){am=ah.localfilters}if(I.is(ao.tag_filter,"object")){an=ao.tag_filter.localfilters}if(!UWA.equals(am,an)){if(((I.is(am,"object")&&!Object.keys(am).length))||!I.is(am)){if(I.is(an)){if(true!=ao.refresh){if(I.is(ak)&&I.is(ak.setLocalFilter,"function")){ak.setLocalFilter(an,false);aw=true}}}}}if(ao.savedSearch&&!aw){ak.setLocalFilter(an,false)}if(I.is(ao.search_criteria_to_display,"string")&&ao.search_criteria_to_display.length>0){aj.search_criteria_to_display=ao.search_criteria_to_display}aj.incontext_precond_2=ao.incontext_precond_2;var ar=aq.getRequestCriteria().service_params;aq.setRequestCriteria("fed_search",aj);aq.setSearchSource(ao.source);var al=aq._ctx_options;var ax=aq.getRequestCriteria().service_params;var av=al&&ar&&ax.query==e.SearchTypeEnum.ADVANCED_SEARCH;if(!av){var at=ab._skeleton.getViewAt(0);if(at&&at.contentsViews){for(var ap in at.contentsViews){at.contentsViews[ap].onSearch&&at.contentsViews[ap].onSearch(ao)}}}var ai=false;var ag=true;if(I.is(ak.filters)&&I.is(ak.filters.allfilters)){if(Object.keys(ak.filters.allfilters).length!==0){ag=false}}if(I.is(ax)&&((ax.query===e.SearchTypeEnum.ADVANCED_SEARCH)||af)&&!(ax.query===e.SearchTypeEnum.MY_RECENT_CONTENT)&&ag){if(!(I.is(ax.refine)&&I.is(ax.refine.PLMParameters)&&I.is(ax.refine.PLMParameters.plmparam)&&I.is(ax.refine.PLMParameters.plmparam.length>0))){ai=true}}if(au&&ai){aq.getTaggerProxy().clearLocalFilter();if(I.is(ab._advSearchMgr)){ab._advSearchMgr.clearFilters();ab._advSearchMgr.getAndDisplayAdvancedSearch(true)}}if(!av){aq._resetState();aq.reset();this._updateWidgetTitleWithNbResult(ao);this._defineViews();this._loadFirstPage()}}})}var ad="com.ds."+this.getOption("widgetId");var ac="com.ds.compass";this._compass_socket=new R.Socket(ad);this._compass_socket.subscribeServer(ac,window.parent);this._searchcom_socket=N.createSocket({socket_id:"search_skeleton_"+v.now(),widgetId:this.options.widgetId});if(!I.is(this._WebInWinCtxActionSocket)){this._WebInWinCtxActionSocket=N.createSocket({socket_id:"_searchcom_socket_CtxAction"+Math.floor((Math.random()*100000)+1)})}var aa=this.getOption("messagingChannel");this._WebInWinCtxActionSocket.addListener("onSetCtxMenuForItemViewOptions",this.setCtxMenuForItemViewOptions.bind(this));this._subscriptions.onResetMultisel=D.subscribe({channel:aa,topic:"onResetMultisel",callback:this.resetMultisel.bind(this)});this._WebInWinCtxActionSocket.addListener("onLogout",this.logout.bind(this));this._searchcom_socket.addListener("onItemSelected",L.debounce(this.onItemSelected.bind(this),100));this._searchcom_socket.addListener("onItemUnselected",this.onItemUnselected.bind(this));this._searchcom_socket.addListener("onItemDblClick",this.onItemDblClick.bind(this));this._subscriptions.onFetchAndSelectAll=D.subscribe({channel:aa,topic:"onFetchAndSelectAll",callback:this.onFetchAndSelectAllCallback.bind(this)});this._searchcom_socket.addListener("widgetResize",function(){if(this._searchActions){this._searchActions.updatePopoverPosition()}var aj=I.extendElement(document.body).getElements(".dropdown-root");var ai=I.extendElement(document.body).getElements(".icon-dropdown");var af=null;if(I.is(aj,"array")&&I.is(ai,"array")){af=aj.concat(ai)}else{if(I.is(aj,"array")){af=aj}else{af=ai}}if(I.is(af,"array")){for(var ah=0,ag=af.length;ah<ag;ah++){if(I.is(af[ah])&&I.is(af[ah].hide,"function")){af[ah].hide()}}}}.bind(this));this._subscriptions.sortForAllView=D.subscribe({channel:aa,topic:"sortForAllView",callback:this.sortForAllView.bind(this)});this._searchActions=new C({SNSkeleton:this})},destroy:function(){this.log("destroy");U.setItem("previewDefautActivateState",this._previewState);U.commit();this.stopListening();window.removeEventListener("beforeunload",this.closePrintWindow);this.closePrintWindow=null;this._currentItemView=null;this._myDatagridView=null;if(I.is(this.indexedtimeMenu)){this.indexedtimeMenu=null}if(this._informationPanel!==null){this._informationPanel.destroy()}this._informationPanel=null;this._lastSelectedItem=null;if(I.is(this._mySpinner)){this._mySpinner.destroy();this._mySpinner=null}if(I.is(this._advSearchMgr)&&I.is(this._advSearchMgr.destroy,"function")){this._advSearchMgr.destroy();this._advSearchMgr=null}if(I.is(this._searchcom_socket)){this._searchcom_socket.dispatchEvent("clearSearch",{destroy:true})}if(this._onesearch_collection&&this._onesearch_collection.service_parameters){this._onesearch_collection.service_parameters.order_by="";this._onesearch_collection.service_parameters.order_field=""}var Y=this.getHelperCollectionId();var aa=e.getHelperCollection(Y);if(aa){e.deleteHelperCollection(Y)}D.unsubscribe(this._subscriptions.sortForAllView);D.unsubscribe(this._subscriptions.onFetchAndSelectAll);D.unsubscribe(this._subscriptions.onResetMultisel);if(this._skeleton&&this._skeleton.getViewAt(0).contentsViews.tile||this._skeleton.getViewAt(0).contentsViews.thumbnail){var X=this._skeleton.getViewAt(0).contentsViews.tile?this._skeleton.getViewAt(0).contentsViews.tile:this._skeleton.getViewAt(0).contentsViews.thumbnail;var Z=this._skeleton.getViewAt(0).contentsViews.thumbnail?this._skeleton.getViewAt(0).contentsViews.thumbnail:this._skeleton.getViewAt(0).contentsViews.tile;X._searchcom_socket.removeListener("onSelectAll");X._searchcom_socket.removeListener("onSelectShift");Z._searchcom_socket.removeListener("onSelectAll");Z._searchcom_socket.removeListener("onSelectShift")}if(I.is(this._skeleton)&&I.is(this._skeleton.destroy,"function")){this._skeleton.destroy();this._skeleton=null}if(I.is(this._onesearch_collection)&&I.is(this._onesearch_collection.setSNSkeleton)){this._onesearch_collection.setSNSkeleton(null)}if(I.is(this._onesearch_collection)){this._onesearch_collection.removeEvent("failure_on_parse");this._onesearch_collection.removeEvent("response_treated");this._onesearch_collection.removeEvent("update_title");this._onesearch_collection.removeEvent("onReset");this._onesearch_collection.destroy();this._onesearch_collection=null}if(I.is(this._searchcom_socket)){this._searchcom_socket.removeListener("onItemSelected");this._searchcom_socket.removeListener("onItemUnselected");this._searchcom_socket.removeListener("widgetResize");this._searchcom_socket.removeListener("onItemDblClick");this._searchcom_socket.disconnect();N.deleteSocket(this._searchcom_socket.id);this._searchcom_socket=null}if(I.is(this._compass_socket)){this._compass_socket.unsubscribeServer("com.ds.compass");this._compass_socket.disconnect();this._compass_socket=null}if(I.is(this._WebInWinCtxActionSocket)){this._WebInWinCtxActionSocket.removeListener("onSetCtxMenuForItemViewOptions");this._WebInWinCtxActionSocket.removeListener("onLogout");this._WebInWinCtxActionSocket.disconnect();N.deleteSocket(this._WebInWinCtxActionSocket.id);this._WebInWinCtxActionSocket=null}this._myDatagridView=null;this._WidgetTitleObj=null;this._dynamicPredicateSetType=null;this._dynamicPredicateSetKind=null;if(I.is(this._searchActions)){this._searchActions.removeEvent();this._searchActions.destroy();this._searchActions=null}if(I.is(this._printWindow)){this._printWindow.close();this._printWindow=null}if(I.is(this.ctxMenu)){this.ctxMenu.destroy();this.ctxMenu=null}this.options=null;this._parent()},render:function(){var X=this._skeleton.render();return X},getCollection:function(){if(this._onesearch_collection===null){throw new Error("Collection isn't defined yet")}return this._onesearch_collection},getContainer:function(){var X;var Y=this;if(this._skeleton&&this._skeleton.container){X=this._skeleton.container}else{if(I.is(UWA.Widgets)&&I.is(UWA.Widgets.instances)){UWA.Widgets.instances.forEach(function(Z){if(Z.id===Y.getOption("widgetId")){X=I.extendElement(Z.elements.body).getElement(".search-content-set-contents")}})}else{X=I.extendElement(document.body).getElement(".search-content-set-contents")}}return X},onSkeletonReady:function(){},onItemDblClick:function(X){l.handle({skeleton:this,id:X})},getCurrentScrollView:function(){if(I.is(this._skeleton)){var Y=this._skeleton.getViewAt(0);if(I.is(Y)&&I.is(Y.contentsViews)&&I.is(Y.currentViewId)&&Y.currentViewId!=="table"&&Y.contentsViews[Y.currentViewId]){if(I.is(Y.contentsViews[Y.currentViewId].nestedView.view)){var X=null;if(I.is(Y.contentsViews[Y.currentViewId].nestedView.view.getScroller,"function")){X=Y.contentsViews[Y.currentViewId].nestedView.view.getScroller()}else{if(I.is(Y.contentsViews[Y.currentViewId].nestedView.view._getScroller,"function")){X=Y.contentsViews[Y.currentViewId].nestedView.view._getScroller()}}}return X}}return null},getCurrentView:function(){return this._skeleton.getViewAt(0)?this._skeleton.getViewAt(0).contentsViews[this._skeleton.getViewAt(0).currentViewId]:null},scrollToCellAt:function(){var Z=this;var aa=this._skeleton.getViewAt(0);if(I.is(aa)&&I.is(aa.contentsViews)&&I.is(aa.currentViewId)&&(aa.currentViewId==="tilebig"||aa.currentViewId==="thumbnail"||aa.currentViewId==="tile")&&aa.contentsViews[aa.currentViewId]){if(I.is(aa.contentsViews[aa.currentViewId].nestedView.view)){if(I.is(Z._lastSelectedItem)){var Y=Z.getCollection().indexOf(Z._lastSelectedItem);if(Y===-1){Y=0}if(Y>=0){var ab=null;var X=Z.getCollection().getTreeDocument().getRoots();if(I.is(X,"array")){if(Y<X.length){ab=X[Y];if(I.is(aa.contentsViews[aa.currentViewId].nestedView.view.scrollToCellAt,"function")){aa.contentsViews[aa.currentViewId].nestedView.view.scrollToCellAt({cellID:ab._getRowID(true)})}else{if(I.is(aa.contentsViews[aa.currentViewId].nestedView.view._scrollToNode,"function")){aa.contentsViews[aa.currentViewId].nestedView.view._scrollToNode(ab,ab._getRowID(true))}}}}}}}}},getHelperCollectionId:function(){var X=null;var Y=this.getOption("transient_context");if(I.is(Y)){if(Y==="true"||Y===true){X=e.TRANSIENT_WIDGET_HELPER_ID}}if(!I.is(X)){var Z=this.getOption("use_preexisting_call");if(Z===true||Z==="true"){X=e.TRANSIENT_WIDGET_HELPER_ID}}if(!I.is(X)){X=this.getOption("widgetId")}return X},copyDataFromHelperCollection:function(Z,ab){if(I.is(Z)&&I.is(ab)){Z.totalCount=UWA.clone(ab.totalCount);if(Z.totalCount===0){if(I.is(ab.length)){Z.totalCount=ab.length}}Z.setFailureView(ab.getFailureView());if(I.is(ab._parse_alert)){Z._parse_alert=UWA.clone(ab._parse_alert)}if(Z.totalCount===0){var aa=S.get("no_result");if(I.is(aa)){this._searchActions.setEmptyViewMessage(aa)}}Z._indexingDate=UWA.clone(ab._indexingDate);Z._fedSearchLabel=UWA.clone(ab._fedSearchLabel);Z.state=UWA.clone(ab.state);var Y=Z._ctx_options;ab.forEach(function(ad){ad.collection=Z;var ac=false;if(I.is(ad.isAShowOnlyObject,"function")){ac=ad.isAShowOnlyObject()}if(ac===false){x.getAvailableActions({attributes:ad._attributes},function(ae){ae.forEach(function(af){if(ad.action_ids.indexOf(af.id)===-1){ad.action_ids.push(af.id);ad.actions.push(af)}});if(!ad._attributes.actions||ad._attributes.actions.length===0){ad._attributes.actions=ad.actions.pluck("title")}},{inCtxOptions:Y})}});ab._fedsearchOptions.parse=false;ab._fedsearchOptions.silent=false;var X=ab.toArray();Z.reset(X,ab._fedsearchOptions);Z._setTags(UWA.clone(ab._helperSubjectsTags),UWA.clone(ab._helpertagValues));if(!H.getOption("actionsProtocol_FUN065512")){this.computeCtxActions({data:X,rawData:false})}}},_isOpenWithMenuAsked:function(ab){var Y=null;if(I.is(ab,"array")&&!H.getOption("search_web_in_win")){for(var X=0;X<ab.length&&!I.is(Y);X++){var Z=ab[X];if(I.is(Z)){if(Z.id==="3DCompass_#OpenWith"){if(I.is(Z.internalHelper,"object")){var aa=Z.internalHelper.getCmdInfo();if(I.is(aa,"object")){if((I.is(aa.type,"string")&&aa.type.length>0)||(I.is(aa.type,"array")&&aa.type.length>0)){Y={data:{items:[{objectId:Z.internalHelper.getObjectID(),objectType:Z.internalHelper.getType(),envId:Z.internalHelper.getPlatformID(),serviceId:Z.internalHelper.getServiceID()}]}};if(I.is(aa.type,"string")){Y.data.items[0].objectTaxonomies=[aa.type]}else{Y.data.items[0].objectTaxonomies=aa.type}ab.splice(X,1)}}}}}}}return Y},_initDropDown:function(ac,Y){var Z=this;var ad=ac;if(!I.is(ad)){ad=[]}if(ad.length===0){ad.push({text:S.get("noActionsAvailable"),id:"noActionsAvailable"})}var X=this._isOpenWithMenuAsked(ac);var ab={items:ad};if(I.is(Y,"object")){ab.target=Y.target}if(!I.is(ab.target)){ab.target=this._ctxMenuTarget}if(!I.is(ab.target)){if(true!==H.getOption("search_web_in_win")){c.error("_initDropDown : ERROR, target div is not available for dropdown !")}}var aa=undefined;if(I.is(Y)&&I.is(Y.altPosition)){aa={pageX:Y.altPosition.x-20,pageY:Y.altPosition.y-20};ab.contextual=true}ab.bound=false;ab.removeOnHide=true;if(I.is(this.ctxMenu)){this.ctxMenu.destroy()}this.ctxMenu=null;if(H.getOption("search_web_in_win")){ab.target=I.extendElement(document.body);ab.id="SearchMenu";this.ctxMenu=new u(ab)}else{if(!I.is(Y)){ab.scrollMode=false}ab.events={onHide:function(){if(I.is(Z.ctxMenu)){this.destroy()}Z.ctxMenu=null},onClickOutside:function(){if(I.is(Z.ctxMenu)){this.destroy()}Z.ctxMenu=null},onMouseLeave:function(){if(I.is(Z.ctxMenu)){this.destroy()}Z.ctxMenu=null}};ab.className="search-ctx-actions-dropdown-container";this.ctxMenu=new m(ab)}if(I.is(X,"object")){new d().set3DXContent(X).render(this.ctxMenu)}if(I.is(aa)){this.ctxMenu.show(false,aa)}else{this.ctxMenu.show()}},setCtxMenuForItemViewOptions:function(Z){if(!I.is(Z)){return}var ac=this;if(I.is(Z.somethingSelected)){if(Z.somethingSelected=="0"){a._displayAlert({message:S.get("error_select_command"),className:"error",})}}var Y=Z.actions_data;var aj=Z.dropdownOptions;if(!(I.is(Y)&&I.is(Y.actions))){return}var ab=this.getCollection();var af=Y.actions.length;var ad=H.getOption("max_item_for_contextualPanel");if((af>ad)&&H.getOption("search_web_in_win")){a._displayAlert({message:S.get("warning_max_ctx_panel",{nb1:af}),className:"info"})}for(var ae=0;ae<af;ae++){var aa=ab.get(Y.actions[ae].id);if(I.is(aa)&&I.is(aa.actions)){if(!I.is(Y.actions[ae].actions)){Y.actions[ae].actions=[]}aa.actions.forEach(function(al){if(al._attributes.multisel&&Y.actions.length>1){Y.actions[ae].actions.push(al)}else{if(Y.actions.length===1){var ak=ac.chechActionToAddInMenu(al)}}if(ak===true){Y.actions[ae].actions.push(al)}})}}if(Y.actions.length>0){var ag=ac._parseContextualMenu(Y.actions);var ah=null;var X=ag.length;if(X==1){ah=ag[0]}else{ah=ac._menusIntersection(Y.actions,ag)}if(I.is(aj)&&I.is(aj.fromPreview)&&aj.fromPreview===true){function ai(an){var al=ah.length-1;for(var ak=al;ak>=0;ak--){var am=ah[ak];if(am&&am.id===an){ah.splice(ak,1);break}}}ai("unselect_all");ai("select_all")}ac._initDropDown(ah,aj)}},chechActionToAddInMenu:function(aa){var X=this;var Z=true;if(!I.is(aa)){return}var ab=H.getOption("nav_history");if(ab===true){if(aa.id==="config_explore"||aa.id==="whereUsed"){var Y=X.getOption("navHistory");if(Y===false){Z=false}}}return Z},fetchAll:function(aj){var ac=this;var af="fetch";var ai="fetch";if(I.is(aj)&&(I.is(aj.type))){af=aj.type}if(I.is(aj)&&(I.is(aj.subType))){af=aj.subType}if(I.is(aj)&&(I.is(aj.action_type))){ai=aj.action_type}if(I.is(aj)&&(I.is(aj.subType))){ai=aj.subType}if(I.is(ac._in_app_multiSel)&&(ac._in_app_multiSel!="nullToMany")&&(ai==="fetch")){a._displayAlert({message:S.get("error_select_all"),className:"info",});return}var aa=H.getOption("max_selection_for_selectall");ac.param=aj;if(I.is(ac._searchActions.setSelected,"function")){ac._searchActions.setSelected(ac._modelSelected)}var ah=H.getOption("max_selection_for_actions");var ad=aa;var ae=this._skeleton.getViewAt(0);if(!I.is(ae)){throw new Error("Error, rootView undefined in SNSkeletonMgt.fetchAll !")}var Y=ae.collection.totalCount;if((false===ae.collection.hasNextPage())||(ae.collection.length>=aa)){ac.resetMultisel();var ab=Math.max(aa,ae.collection.length);if(Y>ab){af="msgType_"+ai;af=S.replace(S.get(af),{action_type:S.get("msgType_"+ai)});a._displayAlert({message:S.get("warning_fetch_all",{nb1:ae.collection.length,nb2:ae.collection.totalCount,msgType:af}),className:"success",})}if(I.is(aj)&&I.is(aj.callback,"function")){aj.callback.call(aj.context,aj)}}else{ae.collection.state.pageSize=ad;var ag=H.serialize();var Z=JSON.parse(ag);ac._default_results_perpage=Z.search_settings.results_perpage;Z.search_settings.results_perpage=ad;H.initialize(Z);ae.collection.reset();var X=ac.getContainer();X&&J.mask(X);ae.collection.getFirstPageOfResults({reset:true,onComplete:function(){c.log("SNSkeletonMgt_v2.fetchAll->onComplete getFirstPageOfResults");var al=ae.collection.totalCount;var ak=Math.max(aa,ae.collection.length);if(al>ak){af="msgType_"+ai;af=S.replace(S.get(af),{action_type:S.get("msgType_"+ai)});a._displayAlert({message:S.get("warning_fetch_all",{nb1:ae.collection.length,nb2:ae.collection.totalCount,msgType:af}),className:"success",})}ae.collection.generateTreeModelAsync().then(function(){var an=H.serialize();var ao=JSON.parse(an);ao.search_settings.results_perpage=ac._default_results_perpage;H.initialize(ao);J.unmask(X);if(window.hasOwnProperty("sendNotificationWebInWin")&&I.is(sendNotificationWebInWin,"function")){var am=ac.getCollection().totalCount;sendNotificationWebInWin("QueryEnd",JSON.stringify({nb_results:am,collection:ae.collection}))}if(I.is(aj)&&I.is(aj.callback,"function")){aj.callback.call(aj.context,aj)}})},onFailure:function(){var ak=H.serialize();var al=JSON.parse(ak);al.search_settings.results_perpage=ac._default_results_perpage;H.initialize(al);J.unmask(X);if(I.is(aj)&&I.is(aj.callback,"function")){aj.callback.call(aj.context,{error:"TOO_MANY_RESULTS"})}}})}},onFetchAndSelectAllCallback:function(X){var Y=this;if(!I.is(X)){X={}}X.callback=function(Z){if(!I.is(Z.error)){Y._selectAll()}};Y.fetchAll(X)},notifyReset:function(){this.resetCompassSelection();var Z=this.getCollection().getTaggerProxy();I.is(Z)&&Z.unfocus();this.notifySelectionAddinMode();for(var Y in this._viewsId){var X="Qchannel-searchgriview-"+this._viewsId[Y];D.publish({channel:"Qchannel-searchgriview-"+this._viewsId[Y],topic:"Qtopic-searchgriview-disableMultiSelMode",data:{}})}},resetCompassSelection:function(){var X={objectId:"",envId:"",contextId:""};if(this._compass_socket){this._compass_socket.dispatchEvent("onSetObject",X);this._compass_socket.dispatchEvent("onResetX3DContent",{})}},clearWebInWinCSO:function(){if(true===H.getOption("search_web_in_win")){var X=[];var Y={objets_name:X,};this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onAddToCSO",notif_parameters:JSON.stringify(Y)},"search_web_in_win")}},resetMultisel:function(){this._model.unselectAll();this.notifyReset();this.clearWebInWinCSO()},logout:function(){(I.is(this._searchActions)&&(I.is(this._searchActions.logOut)))?this._searchActions.logOut():c.error("!UWACore.is(this._searchActions) && (UWACore.is(this._searchActions.logOut)")},_parseContextualMenu:function(aa){var Z=this;var ab=[];var X=0;var Y=aa.length;for(X=0;X<Y;X++){ab[X]=this._getActionsForOneObject(aa[X].id,aa[X].actions,"")}return ab},_getActionsForOneObject:function(ad,ac,aa){var ab=this;var X=[];var Y=0;var Z=ac.length;for(Y=0;Y<Z;Y++){X[Y]=this._getOneActionForOneObject(ad,ac[Y],aa)}return X},_getActionsHelper:function(Y){var Z=this;var X=this.getCollection();return{getModel:function(ab){var aa=X.get(ab.id);if(I.is(aa)){return aa}},getValue:function(ac){var aa=X.get(ac.id);var ab;if(I.is(aa)){var ad=ac.predicate?ac.predicate:ac.attribute;ab=aa.get(ad+"_value")}return ab},getNLSValue:function(ab){var aa=X.get(ab.id);if(I.is(aa)){return aa.get(ab.predicate)}},getAllValues:function(ab){var aa=X.get(ab.id);if(I.is(aa)){return aa.toJSON()}},setLabel:function(ad){var aa=X.get(ad.id);if(I.is(aa)){var ac=X.indexOf(aa);var ae=aa.get("ds6w:label");aa.set("ds6w:label",ad.newLabel);var ab=X.getTreeDocument().getNthRoot(ac)._options.label;X.getTreeDocument().getNthRoot(ac)._options.label=ab.split(ae).join(ad.newLabel);X.getTreeDocument().getNthRoot(ac)._options.grid["ds6w:label"]=ad.newLabel;X.getTreeDocument().getNthRoot(ac)._options.grid["ds6w:label_value"]=ad.newLabel;Z.getCurrentView().updateView()}},getCurrentViewID:function(){return Z._skeleton.getViewAt(0).currentViewId},deleteResults:function(ac){for(var ad=0;ad<ac.ids.length;ad++){var aa=X.get(ac.ids[ad]);if(I.is(aa)){var ab=X.indexOf(aa);X.remove(ac.ids[ad]);X.totalCount--;X.getTreeDocument().removeRoot(X.getTreeDocument().getNthRoot(ab));X.generateTreeModel();Z.getCurrentView().updateView()}}},displayAlert:function(aa){aa.widgetId=Z.getOption("widgetId");var ab=UWA.clone(aa,true);if(ab.level){ab.className=ab.level}a._displayAlert(ab)},getServiceID:function(ab){var aa=X.get(ab.id);if(I.is(aa)){return aa.getServiceID()}},getPlatformID:function(ab){var aa=X.get(ab.id);if(I.is(aa)){return aa.getPlatformID()}},getServiceURL:function(ab){var aa=X.get(ab.id);var ac=ab.service_id;var ad=ab.platform_id;if(I.is(aa)){ac=aa.getServiceID();ad=aa.getPlatformID()}if(ac&&ad){if(H.getOption("search_web_in_win")){switch(ac){case"3DSpace":ab.onComplete.call(undefined,X.getSearchRessources().get3DSpaceUrl());break;default:if(I.is(ab.onFailure,"function")){ab.onFailure.call(undefined,"unknown service ID in native context : "+ab.serviceID)}}}else{T.getServiceUrl({serviceName:ac,platformId:ad,onComplete:function(ae){if(I.is(ab.onComplete,"function")){ab.onComplete.call(undefined,ae)}},onFailure:function(){if(I.is(ab.onFailure,"function")){ab.onFailure.call()}}})}}},isMultiSelMode:function(){if(Y&&Y.selectedModels&&Y.selectedModels.length>1){return true}return false},getType:function(aa){var ab;if(aa){ab=this.getValue({id:aa,attribute:"ds6w:type"})}else{if(Y&&Y.id){ab=this.getValue({id:Y.id,attribute:"ds6w:type"})}else{if(Y&&Y.selectedModels&&Y.selectedModels.length>0){if(Y.selectedModels[0]){ab=this.getValue({id:Y.selectedModels[0].id,attribute:"ds6w:type"})}}}}return ab},getParentContainer:function(){var aa=null;if(I.is(Z)&&I.is(Z._skeleton)&&I.is(Z._skeleton.container)){aa=Z._skeleton.container.parentElement}return aa},getClientInfo:function(){return e.identifyClientInfo(Z.getOption("addinMode"))},isAPinnedWidget:function(){var ad=Z.getOption("widgetId");var ab=false;if(I.is(UWA.Widgets)&&I.is(UWA.Widgets.instances,"array")){for(var ac=0;ac<UWA.Widgets.instances.length;++ac){var aa=UWA.Widgets.instances[ac];if(aa.id==ad){if(I.is(aa.getView,"function")&&aa.getView().type==="windowed"){ab=true}break}}}return ab},canOpenATab:function(){var ab=false;var aa=Z.getOption("observable").getOption("isTabBarVisible");if(I.is(aa,"function")){ab=aa.call(undefined)}return ab},getTarget:function(){if(I.is(Z._ctxMenuTarget)){return Z._ctxMenuTarget}return null},dispatchEvent:function(aa){Z.getSearchActions().dispatchEvent(aa.event,aa.params)},setPopover:function(aa){Z.popover=aa},isInContextMode:function(ab){var aa=Z.getOption("in_apps_search");if(I.is(aa,"object")){return true}},hidePopover:function(){if(I.is(Z.popover)){Z.popover.hide();Z.popover=null}},selectAll:function(aa){Z.onFetchAndSelectAllCallback(aa)},unselectAll:function(aa){Z.resetMultisel()},preview:function(ab){if(!I.is(ab)){return}var ac=Z.getOption("observable");if(I.is(ac)){var aa=Z.ActivateDeactivatePreviewPanel();ac.managepreviewPanel(aa)}}}},_getOneActionForOneObject:function(ae,ac,aa){var ab=this;var Z;if(I.is(ac.items)){Z={text:ac.title,fonticon:ac.icon,};if((ac.id!==undefined)&&(ac.id!==null)){Z.actionId=ac.id;Z.id=ac.id}else{if((ac.title!==undefined)&&(ac.title!==null)){Z.id=ac.title}}Z.items=this._getActionsForOneObject(ae,ac.items,ac.title)}else{var ad=false,X=false,Y=false;if(ac.id=="action-id-separator"){Z={className:"divider"}}else{if(H.getOption("actionsProtocol_FUN065512")){if(I.is(ac.collection)){ad=true}else{if(I.is(ac.image)){Y=true}else{X=true}}}else{if(I.is(ac.collection)){if(I.is(ac.get("sourcejs"))){X=true}else{ad=true}}else{Y=true}}if(H.getOption("actionsProtocol_FUN065512")){Z={text:(Y||X)?ac.title:ac.get("title"),icon:Y?ac.image:(X?ac.icon:ac.get("icon")),multisel:(Y||X)?ac.multisel:ac.get("multisel"),sourcejs:(Y||X)?ac.sourcejs:ac.get("sourcejs")};if((X||ad)&&!H.getOption("search_web_in_win")){Z.fonticon=Z.icon;delete Z.icon}}else{Z={text:Y?ac.title:ac.get("title"),icon:Y?ac.image:ac.get("icon"),multisel:Y?ac.multisel:ac.get("multisel"),sourcejs:Y?ac.sourcejs:ac.get("sourcejs")}}if(Y===true){Z.availabilityMode=ac.availabilityMode}if(ac.id!==undefined){Z.actionId=ac.id;Z.data=ac.id;Z.id=ac.id}if(ac.accelerator!==undefined){Z.accelerator=Y?ac.accelerator:ac.get("accelerator")}if(I.is(ac.disabled)){Z.disabled=Y?ac.disabled:ac.get("disabled")}Z.handler=function(ah){var af={action_id:ac.id,object_id:ae,object_cid:ab._currentItemViewCid,collection:ab.getCollection(),model:ab.getCollection().get(ae),actionsHelper:ab._getActionsHelper({id:ae}),object_ids:[ae],widget_id:ab.getOption("widgetId"),nav_history:U.getItem("nav_history")};if(ad){ac.get("callback").call(undefined,af,arguments);ab.dispatchEvent("onExploreAction",af)}else{if(X){var ag=H.getOption("actionsProtocol_FUN065512")?ac.sourcejs:ac.get("sourcejs");if(I.is(ag,"string")){require([ag],function(aj){aj.executeAction(af,arguments)},function(aj){c.warn("Cannot load action handler "+aj.requireModules);requirejs.undef(ag);if(I.is(ag,"string")){var ak=ag.split("/");if(I.is(ak,"array")&&ak.length>2){af.actionsHelper.getServiceURL({id:ae,onComplete:function(ao){var am=F.getRealtivePath({serviceID:af.actionsHelper.getServiceID({id:ae})});var an=ak[0]+"/"+ak[1];var ap=ao+am;ap+="/"+ak[1];var al={};al[an]=ap;require.config({paths:al});require([ag],function(aq){aq.executeAction(af,arguments)},function(aq){c.warn("Cannot load action handler "+aq.requireModules)})}})}}})}else{c.log("action handler not provided");var ai=ac.executeOptions;if(I.is(ai,"object")){ai.selected_obj=af.object_id;ai.displayAlert=af.actionsHelper.displayAlert;r.executeWSAction(ai)}else{c.warn("no options provided to execute the action")}}}else{require([ac.sourcejs],function(aj){aj.executeAction(af,arguments)})}}};Z.internalHelper=function(){return{getCmdInfo:function(){var af=undefined;if(I.is(ac.get,"function")){af=ac.get("cmdInfo")}else{af=ac.cmdInfo}return af},getObjectID:function(){return ae},getPlatformID:function(){return(ab.getCollection().get(ae)).getPlatformID()},getServiceID:function(){return(ab.getCollection().get(ae)).getServiceID()},getType:function(){return(ab.getCollection().get(ae)).getType()}}}()}if(I.is(aa)){Z.menu=aa}}return Z},_menusIntersection:function(ab,af){var ah=[];var Z=af.length;if(Z===0){return ah}var ah=af[0];var ag=[];for(var ac=1;ac<Z;ac++){var ak=af[ac];var X=0;if(I.is(ak)&&I.is(ak.length)){X=ak.length}for(var aa=0;aa<X;aa++){var ae=ah.length;var aj=false;for(var Y=0;Y<ae;Y++){if(I.is(ak[aa].sourcejs)&&I.is(ak[aa].actionId)&&I.is(ah[Y].sourcejs)&&I.is(ah[Y].actionId)){if(ak[aa].actionId===ah[Y].actionId&&ak[aa].sourcejs===ah[Y].sourcejs){aj=true;break}}else{if(ak[aa].items&&ah[Y].items){if(ak[aa].text===ah[Y].text){aj=true;var ai=[];ai[0]=ak[aa].items;ai[1]=ah[Y].items;var ad=this._menusIntersection(ab,ai);ak[aa].items=ad;break}}}}if(aj===true){ag.push(ak[aa])}}ah=ag;ag=[]}this._updateHandler(ab,ah);return ah},_handleAction:function(Y,ab,aa){var Z=this;var X={action_id:aa[Y].id,actionsHelper:Z._getActionsHelper({selectedModels:ab}),collection:Z.getCollection(),object_ids:function(){var ad=[];if(I.is(ab,"array")){for(var ac=0;ac<ab.length;ac++){ad.push(ab[ac].id)}}return ad}(),widget_id:Z.getOption("widgetId")};require([aa[Y].sourcejs],function(ac){ac.executeAction(X,arguments)})},_updateHandler:function(ag,ae){var ac=this;var aa=ag.length;if(aa===0){return ae}var ab=0;if(I.is(ae)){ab=ae.length}if(aa>1){for(var Z=0;Z<ab;Z++){for(var Y=0;Y<1;Y++){if((ae[Z].handler!==undefined)&(ae[Z].handler!==null)){if(H.getOption("actionsProtocol_FUN065512")){ae[Z].handler=ac._handleAction.bind(ac,Z,ag,ae)}else{var af={object_id:ag[Y].id,};ae[Z].handler=function(ai){var aj=this;var ah=ag[0].actions[0].sourcejs||ag[0].actions[0]._attributes.sourcejs;require([ah],function(al){var am;for(var ak=0;ak<aj.items.length;ak++){if(ai.id===aj.items[ak].id){am=aj.items[ak].actionId;break}}ag.action_id=am;ag.collection=ac.getCollection();al.executeAction.call(al,ag,af)})}}}else{if((ae[Z].items!==undefined)&(ae[Z].items!==null)){var ad=ae[Z].items;var X=ad.length;ac._updateHandler(ag,ae[Z].items)}}}}}},_buildSkeletonRenderers:function(){var Y=this;var X={onesearch:{collection:"DS/SNResultUX/collections/SearchCollection",collectionOptions:function(){Y.log("onesearch renderer collection options");var Z=H.getOption("results_perpage");if(I.is(Z)&&(I.typeOf(Z)!=="number")){Z=parseInt(Z)}var aa={state:{pageSize:Z},event:{onSetup:function(ac){Y.log("onesearch renderer:onSetup of the collection");if(!I.is(Y._advSearchMgr)){Y._advSearchMgr=new p({collection:Y._onesearch_collection=ac,tagger_proxy:Y.getOption("tagger_proxy"),resources:Y.getOption("resources")})}Y._onesearch_collection=ac;Y.setup();Y._onesearch_collection.setSearchRessources(Y.getOption("resources"));Y._onesearch_collection.setTaggerProxy(Y.getOption("tagger_proxy"));Y._onesearch_collection.addEvent("failure_on_parse",function(ae){Y._failure(ac,ae,"failure_on_parse")});Y._onesearch_collection.addEvent("response_treated",function(ae){if(!H.getOption("actionsProtocol_FUN065512")){Y.computeCtxActions(ae)}});Y._onesearch_collection.addEvent("update_title",function(ae){Y._updateWidgetTitleWithNbResult(ae)});Y._onesearch_collection._ctx_options=Y.getOption("in_apps_search");Y._onesearch_collection.setSearchSource(Y.getOption("source"));Y._searchActions.setCollection(ac);Y._searchActions.setSkeleton(Y._skeleton);ac.setSNSkeleton(Y);var ab={isTransientWidget:true};var ad=e.identifyClientInfo();if(ad.identifier==="3DDashboard"){ab.isTransientWidget=Y.getOption("transient_context")==="true"?true:false}ac.setTagsTransformer(new W(ab));Y.dispatchEvent("onSkeletonReady");Y._model=Y._onesearch_collection.getTreeDocument();Y._previewState=U.getItem("previewDefautActivateState")}},transient_context:Y.getOption("transient_context")};return aa},view:"DS/SNResultUX/views/SearchContentSet",viewOptions:Y._onesearch_viewOptions.bind(Y),fetchMode:"never",swipe:false,cacheFacets:false}};I.merge(X,x.availableviews());return X},_onesearch_viewOptions:function(ae){this.log("_onesearch_viewOptions");var af=this,al=w.getItemViewOptions(this.getOption("resources"));al.request_criteria=af._retrieveRequestCriterias.bind(af);al.request_criteria_without_precond=af._retrieveRequestCriteriasWithoutPrecond.bind(af);al.getCollection=af.getCollection.bind(af);var ah=this.getOption("in_apps_search");var X=this.getOption("pinToDashboard");if(I.is(ah)&&I.is(ah.multiSel)&&ah.multiSel==false){af._selectionMode_techno="oneToOne"}af._in_app_multiSel=af._selectionMode_techno;var aa=af._searchActions.getGlobalActions({itemViewOptions:al,XMLViewOptions:w.getXMLViewOptions(),widgetId:af.getOption("widgetId"),in_apps_search:af.getOption("in_apps_search"),pinToDashboard:X,tenant:af.options.resources.active_tenant});var aj=[];if(H.getOption("keepOldSearchViews")){aj=[{id:"thumbnail",view:A,title:S.get("view.thumbnail.title")},{id:"tile",view:y,title:S.get("view.tile.title")},{id:"table",view:H.getOption("enableDataGridView")?b:M,title:S.get("view.table.title")}];this._viewsId=["ThumbnailGridView","RespLargeTileGridView"];H.getOption("enableDataGridView")?this._viewsId.push("DataGridView"):this._viewsId.push("TreeListView")}else{if(H.getOption("activeResponsiveView")){aj=[{id:"thumbnail",view:B,title:S.get("view.thumbnail.title")},{id:"tile",view:q,title:S.get("view.tile.title")},{id:"table",view:H.getOption("enableDataGridView")?b:M,title:S.get("view.table.title")}];this._viewsId=["RespThumbnailGridView","RespTileGridView"];H.getOption("enableDataGridView")?this._viewsId.push("DataGridView"):this._viewsId.push("TreeListView")}else{if(H.getOption("activeLargeView")&&H.getOption("OneSearch")===false){aj=[{id:"thumbnail",view:A,title:S.get("view.thumbnail.title")},{id:"tile",view:y,title:S.get("view.tile.title")},{id:"table",view:H.getOption("enableDataGridView")?b:M,title:S.get("view.table.title")}];this._viewsId=["ThumbnailGridView","RespLargeTileGridView"];H.getOption("enableDataGridView")?this._viewsId.push("DataGridView"):this._viewsId.push("TreeListView")}else{if(null!=(aj=UWA.clone(w.getAvailableViews({activeTenant:this.options.resources.active_tenant})))){this._viewsId=[];for(var ad=0;ad<aj.length;ad++){switch(aj[ad].id){case"thumbnail":aj[ad].view=B;this._viewsId.push("RespThumbnailGridView");break;case"tilebig":aj[ad].view=O;this._viewsId.push("RespTextualTileGridView");break;case"tile":aj[ad].view=q;this._viewsId.push("RespTileGridView");break;case"table":aj[ad].view=H.getOption("enableDataGridView")?b:M;H.getOption("enableDataGridView")?this._viewsId.push("DataGridView"):this._viewsId.push("TreeListView");break;default:break}}}}}}for(var am=0,Z=aj.length;am<Z;am++){if(I.is(aj[am])){aj[am].itemViewOptions=al;aj[am].widgetId=af.getOption("widgetId");aj[am].advSearchMgr=function(){return af.getAdvSearchMgr()}}}if(I.is(aj)){aj.push({id:"list",view:K,itemViewOptions:al,selectionMode:"oneToOne"})}var ai={name:"onesearch",lazyRender:true,detail:{title:S.get("TitleSkeleton"),view:k},actions:I.is(aa)?aa:{},contents:{useInfiniteScroll:true,usePullToRefresh:false,selectionMode:"oneToOne",selectionMode_techno:af._selectionMode_techno,neverAction:af._neverAction,views:aj,itemViewOptions:{getCurrentView:function(){var ao=null;var an=af._skeleton.getViewAt(0);if(I.is(an)&&I.is(an.currentViewId)&&I.is(an.contentsViews)){ao=an.contentsViews[an.currentViewId].nestedView}return ao},getWidgetId:function(){return af.getOption("widgetId")}}},events:{onSwitch:function(){af._defineViews();var ap=af.getOption("in_apps_search");var ao="LastSearchViewMode";if(I.is(ap)){ao="LastInAppsSearchViewMode"}U.setItem(ao,arguments[2]);U.commit();var aq=af._skeleton.getViewAt(0);if(aq){for(var an in aq.contentsViews){if(I.is(aq.contentsViews[an])&&I.is(aq.contentsViews[an].onSwitch,"function")){aq.contentsViews[an].onSwitch(aq.currentViewId)}}}var ar=arguments[2];af._searchActions.setDisplayMode(ar);if(I.is(af.options)&&I.is(af.options.observable)&&I.is(af.options.observable.options)&&I.is(af.options.observable.options.update_preference,"function")){af.options.observable.options.update_preference("searchViewMode",ar)}if(af._informationPanel!==null){af._informationPanel.switchViewMode(af.getCurrentView())}if(af._searchActions){af._searchActions.updatePopoverPosition()}if(I.is(af._myDatagridView)&&I.is(af._myDatagridView._deleteCustoPanel,"function")){af._myDatagridView._deleteCustoPanel()}if(af.popover){af.popover.hide()}if(af.getCollection().custoAction&&af.getCollection().custoAction.popover){af.getCollection().custoAction.popover.hide()}setTimeout(function(){af._BI_Shades&&af.setShadings(af._BI_Shades)},500)}}};var ag=null;if(I.is(UWA.Widgets)&&I.is(UWA.Widgets.instances)){UWA.Widgets.instances.forEach(function(an){if(an.id==af.getOption("widgetId")){if(I.is(an.data)&&I.is(an.data.searchViewMode,"string")){ag=an.data.searchViewMode}}})}var Y=af.getOption("in_apps_search");if(I.is(Y)&&I.is(Y.UXOptions)&&I.is(Y.UXOptions.viewMode,"string")&&Y.UXOptions.viewMode.length>0){ag=Y.UXOptions.viewMode}if(I.is(Y)&&(!I.is(ag)||!I.is(ag,"string")||0==ag.length)){ag=U.getItem("LastInAppsSearchViewMode")}if(!I.is(ag)||!I.is(ag,"string")||0==ag.length){ag=U.getItem("LastSearchViewMode")}if(!I.is(ag)||!I.is(ag,"string")||0==ag.length){ag=H.getOption("defaultViewModeAfterCacheCleaning",{tenant:this.getOption("resources").getActiveTenant()})}var ac=ai.contents.views;for(var ak=0,ab=ac.length;ak<ab;ak++){delete ac[ak]["default"];if(ac[ak].id===ag){ac[ak]["default"]=true}}ai.tempSingleIconOnMobile=true;ai["data-rec-id"]=true;return ai},_failure:function(af,ac,Z){if(!I.is(this._skeleton)){throw new Error("Error, this._skeleton undefined in SNSkeletonMgt._failure!")}var aa=[];if(H.getDebug()===false){if(I.is(af)&&I.is(af.getFailureView,"function")&&false===af.getFailureView()){var ab="error";var X="<b>"+S.get("error.msg.display")+"</b><br>"+S.get("error.msg.display.cmd");if(I.is(ac,"string")){X+="<br><br><b>"+S.replace(S.get("fetchFailure"),{error:ac})+"</b>";aa.push({message:X,className:ab})}else{if(I.is(ac,"object")){switch(ac.service){case"fed_search":if(I.is(ac.messages)){ac.messages.forEach(function(ak){if(I.is(ak.message)){X+="<br><br>"+(I.is(ak.dataSources,"string")?(ak.dataSources+"<br>"):"")+"<b>"+(I.is(ak.messageObj)&&I.is(ak.messageObj.message,"string")?ak.messageObj.message:ak.message)+"</b>";ab=ak.className}})}break;default:if(I.is(ac.error)){if(I.is(ac.error_description)){X+="<br><br><b>"+ac.error+"-"+ac.error_description+"</b>"}else{if(I.is(ac.error.errorCode)&&S.get(ac.error.errorCode)!==ac.error.errorCode){X+="<br><br><b>"+S.get(ac.error.errorCode)+"</b>"}else{if(I.is(ac.error.errorCode)&&I.is(ac.error.errorMessage)){X+="<br><br><b>"+S.get(ac.error.errorCode)+" : "+ac.error.errorMessage+"</b>"}}}if(ac.error.errorCode==="FS_CAS_AUTHENTICATION_ERROR"){if(I.is(this._searchActions)&&(I.is(this._searchActions.logOut))){this._searchActions.logOut()}else{c.error("!UWACore.is(this._searchActions) && (UWACore.is(this._searchActions.logOut)")}}}break}aa.push({message:X,className:ab})}}}else{var ah=this.getCurrentView();if(I.is(ah)&&I.is(ah.checkToDisplayEmptyView,"function")){ah.checkToDisplayEmptyView()}return}}else{var ag=null;if(I.is(af)&&I.is(af.search_ressources)&&I.is(af.search_ressources.active_tenant)&&I.is(af.search_ressources.available_tenants)&&I.is(af.search_ressources.available_tenants[af.search_ressources.active_tenant])&&I.is(af.search_ressources.available_tenants[af.search_ressources.active_tenant].sources)&&I.is(af.search_ressources.available_tenants[af.search_ressources.active_tenant].sources.search)&&I.is(af.search_ressources.available_tenants[af.search_ressources.active_tenant].sources.search.url)){ag=af.search_ressources.available_tenants[af.search_ressources.active_tenant].sources.search.url+"/debug/diag?tenant="+af.search_ressources.active_tenant+"&label="+af.getFedSearchLabel()}var Y="<b>"+S.get("downloadTraces")+": </b><a href="+ag+'><span title="'+S.get("downloadTracesTooltip")+'" class="fonticon fonticon-download site-icon"></span></a>';var ai=new Error();var aj=(I.is(ai)&&I.is(ai.stack))?ai.stack:null;var ae=Y;var ad=I.is(aj)?"<br>"+aj.toString():"";if(this._skeleton._alert){this._skeleton._alert.destroy();this._skeleton._alert=null}if(I.is(af)){af._search_in_progress=false}if(I.is(ac,"string")){aa.push({message:"<b><br>"+S.replace(S.get("fetchFailure"),{error:ac})+"</b>"+ae+ad,className:"error"})}else{if(I.is(ac,"object")){switch(ac.service){case"fed_search":ac.messages.forEach(function(ak){aa.push({message:"<b>"+ak.message+"</b><br>"+ae,className:ak.className})});break;default:if(I.is(ac.error)){if(I.is(ac.error_description)){aa.push({message:"<b>"+ac.error+"-"+ac.error_description+"</b><br>"+ae+ad,className:"error"})}else{if(I.is(ac.error.errorCode)&&S.get(ac.error.errorCode)!==ac.error.errorCode){aa.push({message:"<b>"+S.get(ac.error.errorCode)+"</b>",className:"error"})}else{if(I.is(ac.error.errorCode)&&I.is(ac.error.errorMessage)){aa.push({message:"<b>"+S.get(ac.error.errorCode)+" : "+ac.error.errorMessage+"</b><br>"+ae+ad,className:"error"})}}}if(ac.error.errorCode==="FS_CAS_AUTHENTICATION_ERROR"){if(I.is(this._searchActions)&&(I.is(this._searchActions.logOut))){c.log("SNSkeletonMgt: logOut");this._searchActions.logOut()}else{c.error("!UWACore.is(this._searchActions) && (UWACore.is(this._searchActions.logOut)")}}}break}}else{return}}}if(aa.length>0){this._skeleton._alert=new t({className:"search-alert",visible:true,autoHide:false,closable:true,closeOnClick:false,messages:aa,attributes:{"data-rec-id":"search-alert"}});if(this._skeleton.container.isInjected()){this._skeleton._alert.inject(this._skeleton.container,"top")}else{this._skeleton._alert.inject(document.body,"top")}}},_retrieveRequestCriterias:function(){var X={};if(I.is(this.getCollection())){X=this.getCollection().getRequestCriteria()}return X},_retrieveRequestCriteriasWithoutPrecond:function(){var Z={};if(I.is(this.getCollection())){Z=this.getCollection().getRequestCriteria()}var X=w.getContextOptions();if(I.is(X)&&I.is(X.precond)&&I.is(X.default_with_precond)&&I.is(X.show_precond)){if(X.default_with_precond===true&&X.show_precond===false){var Y=" AND "+X.precond;if(I.is(Z.service_params)&&I.is(Z.service_params.query)){if(Z.service_params.query.indexOf(Y,Z.service_params.query.length-Y.length)!==-1){Z.without_precond=Z.service_params.query.replace(new RegExp(Y+"$"),"")}}}}return Z},_getAndDisplayLastIndexTime:function(){var ab=this;if(!H.getOption("show_last_indexation_time")){return}if(I.is(this._onesearch_collection)&&I.is(this._onesearch_collection.service_parameters)&&I.is(this._onesearch_collection.service_parameters.query)&&e.SearchTypeEnum.MY_RECENT_CONTENT===this._onesearch_collection.service_parameters.query){return}var aa=ab.getCollection();if(I.is(aa)){var ah=aa.getIndexingDate();if(I.is(ah,"object")){var Z=null;var ag="";for(var Y in ah){if(I.is(ah[Y])&&ah[Y]!=-1){var af=new Date(ah[Y]*1000);var ad=af.toLocaleString();if(ag.length>0){ag+="<br>"}ag+=S.replace(S.get("lastVaultIndexedTime"),{vault:Y,time:ad});if(!Z){Z=ah[Y]}else{if(ah[Y]<Z){Z=ah[Y]}}}}var ac=null;if(Z){var af=new Date(Z*1000);var X=new Date();var ae=(X-af)/1000/3600;if(ae>24||af.getDay()!=X.getDay()){ac=af.toLocaleString()}else{ac=af.toLocaleTimeString()}}this.updateLastIndexInfo(af,ac)}}},_defineViews:function(){var X=this;var Y=X._skeleton.getViewAt(0);if(Y&&Y.currentViewId==="table"){if(!I.is(X._myDatagridView)){X._myDatagridView=Y.contentsViews.table}}else{if(Y&&Y.currentViewId==="tile"){if(!I.is(X._myTileGridView)){X._myTileGridView=Y.contentsViews.tile}}else{if(Y&&Y.currentViewId==="thumbnail"){if(!I.is(X._myThumbnailGridView)){X._myThumbnailGridView=Y.contentsViews.thumbnail}}}}},updateLastIndexInfo:function(X,aa){if(this.indexedtimeIcon){this.indexedtimeIcon.className="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock";var ac;var Y=this;if(this.indexedtimeIcon&&X){var ad=new Date()-X;var ab=H.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()});var Z=ab*60000;ac=S.replace(S.get("lastIndexedTime"),{indexTime:aa,recentDelta:ab});this.indexedtimeMenu.items[0].elements.container.setAttribute("timestampIndex",X.getTime());this.indexedtimeMenu.updateItem({id:this.indexedtimeMenu.items[0].id,text:ac});this.indexedtimeMenu.elements.container.setStyles({"max-width":"434px"});this.indexedtimeMenu.items[0].elements.container.setStyles({"text-transform":"none"});this.indexedtimeMenu.items[1].elements.container.setStyles({"text-transform":"none","font-weight":"bold"});setTimeout(function(){Y.updateByUXOptions(aa)},200)}else{setTimeout(function(){Y.updateLastIndexInfo(X,aa)},200)}}},updateByUXOptions:function(Z){if(I.is(this.options.observable)&&I.is(this.options.observable.onesearch_indexedtimeIcon)&&I.is(this.options.observable.onesearch_indexedtimeIcon.tooltip)&&I.is(this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody,"function")){var Y=this.getCollection().getSNSkeleton()&&this.getCollection().getSNSkeleton().getOption("in_apps_search");var X=Y&&Y.UXOptions&&!Y.UXOptions.searchRecentContent;var ac=Y&&Y.UXOptions&&!Y.UXOptions.lastIndexationTime;var ab=H.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()});var aa=S.replace(S.get("switchToRecentContent"),{recentDelta:ab});this.options.observable.indexedtimeMenu.enabled=!X;if(X&&!ac){this.options.observable.onesearch_indexedtimeIcon.style.cursor="default";this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody(S.replace(S.get("lastIndexedTimeTooltip"),{indexTime:Z}))}else{if(!X&&ac){this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody(S.replace(S.get("switchToRecentContent"),{recentDelta:ab}))}else{if(X&&ac){this.options.observable.onesearch_indexedtimeIcon.remove()}else{this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody(S.replace(S.get("switchToRecentContent"),{recentDelta:ab})+"<br>"+S.replace(S.get("lastIndexedTimeTooltip"),{indexTime:Z}))}}}}},_updateWidgetTitleWithNbResult:function(X){if(I.is(this._WidgetTitleObj)){if(I.is(X)){if(I.is(X.originalSearchCriteria)){this._WidgetTitleObj.search_criteria=X.originalSearchCriteria}if(I.is(X.search_criteria_to_display,"string")){this._WidgetTitleObj.search_criteria=X.search_criteria_to_display}if(X.search_name){this._WidgetTitleObj.replacingString={search_name:X.search_name,search_criteria:this._WidgetTitleObj.search_criteria}}else{if(X.in_apps_search&&X.in_apps_search.search_name){this._WidgetTitleObj.replacingString={search_name:X.in_apps_search.search_name,search_criteria:this._WidgetTitleObj.search_criteria}}else{this._WidgetTitleObj.replacingString=undefined}}if(I.is(X.applicativeTitle)){this._WidgetTitleObj.applicativeTitle=X.applicativeTitle;if(I.is(X.applicativeTitleWithResults)){this._WidgetTitleObj.applicativeTitleWithResults=X.applicativeTitleWithResults}}else{this._WidgetTitleObj.applicativeTitle="";this._WidgetTitleObj.applicativeTitleWithResults=""}}this._WidgetTitleObj.nb_results=(I.is(this._onesearch_collection)&&I.is(this._onesearch_collection.state)&&I.is(this._onesearch_collection.state.totalRecords))?this._onesearch_collection.state.totalRecords:this._WidgetTitleObj.nb_results=null}this.setTitle(this._WidgetTitleObj)},setTitle:function(ah){if(!I.is(ah,"object")){throw new Error("Invalid Arg in SNSkeleton.setTitle!")}var X=new Date();var al=new Date(X.getTime()-H.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()})*60000);var ag=(X-al)/1000/3600;var af=al.toLocaleTimeString();if(ag>24||al.getDay()!=X.getDay()){af=al.toLocaleString()}if(!I.is(ah.nb_results)&&(I.is(this._onesearch_collection)&&I.is(this._onesearch_collection.state)&&I.is(this._onesearch_collection.state.totalRecords))){ah.nb_results=this._onesearch_collection.state.totalRecords}this._WidgetTitleObj=ah;var ab=this;var Z=false;if(I.is(ab._onesearch_collection)&&I.is(ab._onesearch_collection.service_parameters)){if(e.SearchTypeEnum.ADVANCED_SEARCH===ab._onesearch_collection.service_parameters.query||(I.is(ab._onesearch_collection.service_parameters.adv_search)&&true==ab._onesearch_collection.service_parameters.adv_search)){ah.specialSearchKey="adv_search_launch"}else{if(e.SearchTypeEnum.FAVORITE_SEARCH===ab._onesearch_collection.service_parameters.query||e.SearchTypeEnum.FAVORITE_SEARCH===ah.search_criteria){ah.specialSearchKey="myContent_searchFav"}else{if(e.SearchTypeEnum.MY_CONTENT===ab._onesearch_collection.service_parameters.query){ah.specialSearchKey="myContentTitle"}else{if(e.SearchTypeEnum.MY_RECENT_CONTENT===ab._onesearch_collection.service_parameters.query){if(this._WidgetTitleObj.search_criteria==="*"||this._WidgetTitleObj.search_criteria===e.SearchTypeEnum.MY_RECENT_CONTENT){ah.specialSearchKey="AllRecentSearchTitle"}else{ah.specialSearchKey="RecentSearchTitle"}}else{if(ah.specialSearchKey==="SearchTitleSavedSearch"){Z=true}ah.specialSearchKey="SearchTitle"}}}}}var ae="";var ai;var ak=I.is(ah.searchTitlePrefix,"string")?ah.searchTitlePrefix:"";if(ak.length>0){ak+=" - "}if(!I.is(this._WidgetTitleObj.applicativeTitle)||this._WidgetTitleObj.applicativeTitle.length<=0){ai=I.is(ah.specialSearchKey,"string")?ah.specialSearchKey:"SearchTitle";if(I.is(this._WidgetTitleObj.nb_results)){ai+="WithResults"}if((I.is(ah.search_criteria_to_display,"string"))){ae=ah.search_criteria_to_display}else{if(I.is(ah.search_criteria,"string")&&ah.search_criteria.length>0){ae=ah.search_criteria}}if(ae.length>0){ak+=S.replace(S.get(ai),I.is(ah.replacingString,"object")?ah.replacingString:{search_criteria:ae,nb_results:ah.nb_results,date:af})}}else{ak+=S.replace(I.is(this._WidgetTitleObj.nb_results)?this._WidgetTitleObj.applicativeTitleWithResults:this._WidgetTitleObj.applicativeTitle,{search_criteria:(I.is(ah.search_criteria_to_display,"string")&&ah.search_criteria_to_display.length>0)?ah.search_criteria_to_display:ah.search_criteria,nb_results:ah.nb_results,date:af})}if(ah.replacingString!==undefined){if(I.is(ah.replacingString.search_name)){var aj=ah.replacingString.search_name;if(aj!==undefined){if(ak.length>0){ak=ak.replace(ah.replacingString.search_criteria,aj)}else{ak=S.replace(S.get(ai),{search_criteria:aj})}}}}if(ab._panelTitle!==ak){ab._panelTitle=ak}var ad="";if(I.is(ab._panelTitle,"string")&&ab._panelTitle.length>0){if(I.is(ab.getCollection())){var Y=ab.getCollection().getSearchRessources();if(I.is(Y)&&Y.getAvailableTenants().length>1){var ac=Y.getActiveTenant();if(I.is(ac,"string")){ad=Y.getTenantDisplayName(ac);if(I.is(ad,"string")&&ad.length>0){ab._panelTitle+=" ("+ad+")"}}}}}var aa=ab._panelTitle;if(ah.specialSearchKey==="SearchTitle"&&ae.length>0){aa=ae;if(I.is(ad,"string")&&ad.length>0){aa+=" ("+ad+")"}}if(ab._panelTitle&&ab._panelTitle.length>0){var am=ab.getOption("observable");if(UWA.is(am)){am.dispatchEvent("onTitleUpdate",{panelTitle:ab._panelTitle,tab_title:aa,tab_tooltip:ab._panelTitle,})}}},getTitle:function(){if(!I.is(this._panelTitle)){this.setTitle(this._WidgetTitleObj)}return this._panelTitle},getAdvSearchMgr:function(){return this._advSearchMgr},getSearchActions:function(){return this._searchActions},setShadings:function(X){this._BI_Shades=X;var Z=this.getCollection();if(Z.length&&this._skeleton){var Y=this._skeleton.getViewAt(0);X&&Y.setShadings(X)}},getDataGridView:function(){var Z=this._myDatagridView;if(!I.is(Z)){if(I.is(this._skeleton)&&I.is(this._skeleton.getViewAt,"function")){var Y=this._skeleton.getViewAt(0);if(I.is(Y)){var X=Y.currentViewId;if(X==="table"&&I.is(Y.contentsViews,"object")&&I.is(Y.contentsViews[X])){Z=Y.contentsViews[X].nestedView}}}}return Z},computeCtxActions:function(ab){if(!I.is(this._onesearch_collection)){throw ("invalid state: SNSkeletonMgt._onesearch_collection is null !")}var ac=this;if(I.is(ab.data,"array")){var Y=[];var aa=ab.data.length;for(var X=0;X<aa;X++){var af=ab.data[X];if(I.is(af)){var Z=ab.rawData?af["ds6w:what/ds6w:type_value"]:af.get("ds6w:what/ds6w:type_value");if(!I.is(Z)){Z=ab.rawData?af["ds6w:type_value"]:af.get("ds6w:type_value")}if(Z==="SavedSearch"){Y.push(af.id)}}}var ae=function(){if(I.is(ac._myDatagridView)&&I.is(ac._myDatagridView.view)){return ac._myDatagridView.view.getManager()}};if(Y.length>0){var ad=ac._onesearch_collection.getSearchRessources().getFetchOptions({service_name:"actions_for_results",service_data:{ids:Y},original_options:{onComplete:function(aj){var ap={},ai=0,ah="";if(I.is(aj,"string")&&aj.length>0){ap=I.Json.decode(aj)}else{ap=aj}if(ap.status==="success"){var am=UWA.Class.extend(h,{_collection:null,init:function(aq){this.setOptions(aq);this._collection=aq.collection},executeAction:function(){var ar=arguments;if(I.is(ar)&&I.is(ar.length)&&ar.length>0){ar[0].collection=this._collection}var aq=this.getOption("sourcejs");require([aq],function(at){ac._onesearch_collection.custoAction=at;at.executeAction.apply(at,ar)})}});var an=ae();for(var ai=0;ai<ap.actions.length;ai+=1){ah=ap.actions[ai].actions;var ao=ac._onesearch_collection.get(ap.actions[ai].id);if(ao){for(var ak=0;ak<ap.actions[ai].actions.length;ak++){var ag=ap.actions[ai].actions[ak];ag.collection=ac._onesearch_collection;var al=new am(ag);ag.callback=al.executeAction.bind(al);ao.actions.push(ag)}}}if(ae()){ae().updateView()}}},onFailure:function(ag){ac.log("Cannot retrieve the actions");ac.log(ag.message)}}});if(ac._onesearch_collection.getSearchRessources().is_odt_source()===true){c.warn("No action retrieved in ODT mode")}else{o.authenticatedRequest(ad.url,ad)}}}},getGlobalDownOpen:function(){if(I.is(this._skeleton)){var X=this._skeleton.getViewAt(0);return X.getElement(".fonticon-down-open")}},launchGlobalDropdown:function(){var X={target:this.getGlobalDownOpen(),events:{onHide:function(){this.destroy()},onClickOutside:function(){this.destroy()}}};if(this._model.getSelectedNodes().length>=0){this.getCurrentView().launchContextMenu(this._model.getSelectedNodes()[0],X)}},computeCtxActions2:function(Y,X){if(this.ctxMenu&&this.ctxMenu.isVisible){this.ctxMenu.hide();this.ctxMenu=null}(!I.is(X,"object"))?X={skeleton:this}:X.skeleton=this;r.computeCtxActions(Y,X)},ActivateDeactivateInformationsPanel:function(){var Z=this;var aa=true;var Y=function(){setTimeout(function(){Z.scrollToCellAt()},250)};if(Z._informationPanel===null){require(["DS/SNResultUX/views/InformationsPanelView"],function(ae){var al;var aj=Z.getSearchWidget();var ad=420;var ag="";if(I.is(aj)&&I.is(aj.body)){var ah=aj.body.getDimensions();if(I.is(ah)){ad=ah.width}ag=aj.id}else{var ac=I.extendElement(document.body).getElement(".onesearch_results");if(I.is(ac)){var ah=ac.getDimensions();if(I.is(ah)){ad=ah.width}}}if(U.getItem("nav_history")){if(I.is(aj)){var ak=I.extendElement(aj.elements.body).getElementsByClassName("searchContainer")[0];al={parentContainer:ak,lastSelectedItem:Z._lastSelectedItem,width:ad,widgetId:ag,parent:Z,bNewUI:false}}}else{var ab=true;var af=null;if(a.getinformationPanel()===false){ab=false}else{var ai=Z.getOption("observable");if(I.is(ai)){af=ai.getOneSearchPreviewAction()}}al={parentContainer:Z._skeleton.getViewAt(0),lastSelectedItem:Z._lastSelectedItem,width:ad,widgetId:ag,parent:Z,bNewUI:ab,oneSearchPreviewAction:af}}Z._informationPanel=new ae(al);Z._informationPanel._initInformationsPanel();Z.breturn=true;Z._informationPanel.addEvent("onLightBoxPanelCreated",function(an){if(I.is(H.getOption("search_compact_mode"))&&Z._lastSelectedItem===null){var ao=null;if(I.is(Z.getSearchContentSetHeader,"function")){ao=Z.getSearchContentSetHeader()}if(!I.is(ao)&&I.is(Z._skeleton)&&I.is(Z._skeleton.container)&&I.is(Z._skeleton.container.getElement,"function")){ao=Z._skeleton.container.getElement(".search-content-set-header")}if(I.is(ao)&&ao.isHidden()===true){Z._informationPanel.switchvisibleFlag()}else{Z._informationPanel.activate_deactivateNoPreview(true)}}else{var am=Y()}})})}else{if(Z._informationPanel!==null){if(I.is(H.getOption("search_compact_mode"))){aa=!Z._previewState}else{Z._informationPanel.switchvisibleFlag();aa=Z._informationPanel.getvisibleFlag()}if(aa===true){if(Z._lastSelectedItem){Z._informationPanel.setInfomationPanelObject(Z._lastSelectedItem);Z._informationPanel.switchvisibleFlag();Z._informationPanel.activate_deactivateNoPreview(false);var X=Y()}else{Z._informationPanel.activate_deactivateNoPreview(true);Z._informationPanel.switchvisibleFlag()}}else{Z._informationPanel.switchvisibleFlag()}}}return aa},ActivateDeactivatePreviewPanel:function(){var X=this;if(I.is(H.getOption("search_compact_mode"))){return(X.ActivateDeactivateInformationsPanel())}if(a.getpreviewPanel()===false){return}var Y=true;if(X._lightBoxView===null){require(["DS/SNResultUX/views/LightBoxView"],function(ab){var Z=X._skeleton.container.parentElement;var aa={parentContainer:Z,treeDocument:X._model,collection:X.getCollection(),model:X._lastSelectedItem,treeListView:X._myDatagridView,widget_id:X.getOption("widgetId")};X._lightBoxView=new ab(aa);X._lightBoxView._initPlayer();X._lightBoxView.addEvent("onLightBoxPanelClose",function(ad){X.log("onLightBoxPanelClose");var ac=false;X.options.observable.managepreviewPanel(ac)})})}else{if(X._lightBoxView!==null){X._lightBoxView.activate_deactivate(X._lastSelectedItem);Y=X._lightBoxView._LightBoxPanel.visibleFlag}}return Y},sortForAllView:function(Y){var Z=this;if(H.getOption("search_web_in_win")){Z._order_by=Y.order_by;Z._order_field=Y.order_field}var aa=this.getOption("observable").getOption("update_preference");if(I.is(aa)){aa.call(null,"order_by",Y.order_by);aa.call(null,"order_field",Y.order_field)}if(!I.is(Z._onesearch_collection)||!I.is(Z._onesearch_collection.service_parameters)){throw new Error("No collection or service_parameters in SNSkeletonMgt.sortForAllView!")}if(I.is(Z._onesearch_collection.service_parameters.query)&&e.SearchTypeEnum.MY_RECENT_CONTENT===Z._onesearch_collection.service_parameters.query){Z._onesearch_collection.sortCollection(Y)}else{var ab=Z._onesearch_collection;ab._resetState();ab.reset();ab.service_parameters.order_field=Y.order_field;ab.service_parameters.order_by=Y.order_by;var X=Z.getContainer();X&&J.mask(X);ab.getFirstPageOfResults({reset:true,onComplete:function(){Z.getCollection().generateTreeModel();J.unmask(X)},onFailure:function(){J.unmask(X)}})}},onItemSelected:function(ax){var ah=this;var ak=this.getCollection();if(!I.is(ak)){c.error("No collection in onItemSelect !");return}var am=ak.get(ax);if(am!==null){ah._lastSelectedItem=am}var au=[];var ao=ak.getTreeDocument();var al=ao.getXSO().get();var ai=al.length;var aa=this.getCurrentView().isMultiSelMode();D.publish({channel:this.getOption("messagingChannel"),topic:"updateSelectionNumber",data:{number:ai,isMultiSelMode:aa}});if(au.length===0){al.forEach(function(aA){au.push(ak.get(aA._options.id))})}if(au.length==0){ah._lastItemsSelected=[];ah._modelSelected=[];if(I.is(ah._searchActions.setSelected,"function")){ah._searchActions.setSelected(ah._modelSelected)}}else{if(I.is(ah._searchActions.setSelected,"function")){ah._searchActions.setSelected(au)}}var ae=ak.getSearchRessources();var ar=ak.getTaggerProxy();var X=[];if(au.length==0){ah.notifyReset()}else{var ay=[],av=[],at={},Y=null,az=null;for(var an=0,ag=au.length;an<ag;an++){var am=au[an];if(!I.is(am)){throw new Error("Invalid itemModel in SNSkeletonMgt.onItemSelect")}Y=am.get("id");if(!I.is(Y,"string")){throw new Error("Unable to get id of object in SNSkeletonMgt.onItemSelect")}ay.push({objectType:am.get("ds6w:type_value"),objectId:Y,envId:am.getPlatformID(),contextId:""});X.push({id:Y,session_object:am.hasOwnProperty("session_object")});az=e.getTaggerSubject({id:Y,source:am.getSourceID()});av.push(az);var ad=am.get("sourceid_value");if(I.is(ad,"string")){at[az]=(ad.indexOf("3dspace")>=0)?"3DSpace":"6WTagger"}}var ap=a.buildCompassSelectionData({widgetId:I.is(ah.getOption("widgetId"))?ah.getOption("widgetId"):"",selectedModels:au});if(1===au.length){var af=ay[0];if(I.is(ap)&&I.is(ap.data)&&I.is(ap.data.items,"array")&&ap.data.items.length===1){af=ap.data.items[0]}this._compass_socket.dispatchEvent("onSetObject",af)}this._compass_socket.dispatchEvent("onSetX3DContent",ap);this.notifySelectionAddinMode(ap);if(I.is(ar)){ar.focusOnSubjects(av,null,at)}}if(H.getOption("search_web_in_win")){var aw={objets_name:X,};this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onAddToCSO",notif_parameters:JSON.stringify(aw)},"search_web_in_win")}this.dispatchEvent("selected_obj",au);if(
/*!UWACore.is(selectedViewItems) && selectedViewItems === null &&*/
I.is(window.event)){ah._currentItemView=window.event.currentTarget;ah._currentItemView.container=window.event.currentTarget}var aq=false;var aj=0;if(I.is(au,"array")){aj=au.length}if(aj!==0){if(ah._lastSelectedItem!==null){au.forEach(function(aA){if(aA.id===ah._lastSelectedItem.id){aq=true}})}}if(aq===false){ah._lastSelectedItem=au[au.length-1]}var Z=e.isInTheSimpleSearch({tenant:ah.getActiveTenant()});var ac=H.getOption("search_compact_mode");var ab=false;if(Z===true&&a.getinformationPanel()===true&&!I.is(ac)){ab=true}if(I.is(ac)){if(ah._previewState===true){ab=true}else{if(!I.is(ah._previewState)&&ah._informationPanel!==null){if(ah.ActivatePreviewByClick()===true){ab=true}}}}if(ac===true){ab=true}if(ab===true){if(ah._informationPanel===null){ah.ActivateDeactivateInformationsPanel()}else{if(ah._informationPanel.getvisibleFlag()===false&&ah._lastSelectedItem!==undefined){ah._informationPanel.switchvisibleFlag()}}}if(ah._informationPanel!==null){if(aj===0){if(ah._informationPanel.getvisibleFlag()===true&&Z===true){ah._informationPanel.activate_deactivateNoPreview(true)}ah._informationPanel.setInfomationPanelObject(null)}else{if(ah._lastSelectedItem&&ah._informationPanel.getvisibleFlag()===true){ah._informationPanel.activate_deactivateNoPreview(false);ah._informationPanel.setInfomationPanelObject(ah._lastSelectedItem)}}}ah._lastSelectedItem=null;if(au.length){ah._lastSelectedItem=au[au.length-1]}am=ah._lastSelectedItem;ah.options.events.onItemViewClick&&ah.options.events.onItemViewClick(am)},restoreSelectionOnTabActivation:function(){var ad=this.getCollection();if(I.is(this._model)&&I.is(this._model.getXSO())){var Z=this._model.getXSO().get();var ag=[];Z.forEach(function(ak){ag.push(ad.get(ak._options.id))});var aj=[];if(ag.length==0){}else{var af=[],aa=[],ae=null;for(var ab=0,ac=ag.length;ab<ac;ab++){var ai=ag[ab];if(!I.is(ai)){throw new Error("Invalid itemModel in SNSkeletonMgt.onItemSelect")}ae=ai.get("id");if(!I.is(ae,"string")){throw new Error("Unable to get id of object in SNSkeletonMgt.onItemSelect")}af.push({objectType:ai.get("ds6w:type_value"),objectId:ae,envId:ai.getPlatformID(),contextId:""});aj.push({id:ae,session_object:ai.hasOwnProperty("session_object")})}var ah=a.buildCompassSelectionData({widgetId:I.is(this.getOption("widgetId"))?this.getOption("widgetId"):"",selectedModels:ag});if(1===ag.length){var Y=af[0];if(I.is(ah)&&I.is(ah.data)&&I.is(ah.data.items,"array")&&ah.data.items.length===1){Y=ah.data.items[0]}this._compass_socket.dispatchEvent("onSetObject",Y)}this._compass_socket.dispatchEvent("onSetX3DContent",ah);this.notifySelectionAddinMode(ah)}if(H.getOption("search_web_in_win")){var X={objets_name:aj,};this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onAddToCSO",notif_parameters:JSON.stringify(X)},"search_web_in_win")}}},onItemUnselected:function(X){},onItemTitleClick:function(aa,X){var ab=this;var Z=ab.ActivatePreviewByClick();if(Z===false){if(I.is(X)&&I.is(X.forcePreview)&&X.forcePreview===true){c.log("Launch Preview from contextual Menu")}else{return}}var ac=this.getCollection();var Y;if(I.is(X)&&I.is(X.model)){Y=X.model}else{if(I.is(aa)){Y=ac.get(aa)}else{if(I.is(X.object_ids)&&X.object_ids.length>0){Y=ac.get(X.object_ids[X.object_ids.length-1])}}}if(ab._informationPanel===null){ab.ActivateDeactivateInformationsPanel()}else{if(ab._informationPanel.getvisibleFlag()===false&&Y!==undefined){ab._informationPanel.switchvisibleFlag()}}if(ab._informationPanel!==null){if(!I.is(Y)){ab._informationPanel.setInfomationPanelObject(null)}else{if(Y){ab._informationPanel.setInfomationPanelObject(Y)}}}},_selectAll:function(){if(this._selectionMode_techno!=="oneToOne"&&this._model.getXSO().get().length!==this._model.getRoots().length){this._model.selectAll()}},_toggleLoader:function(){var Y=this;var X;var ab=Y.getCurrentView();if(I.is(ab)){X=ab.container}if(I.is(Y._mySpinner)&&I.is(Y._mySpinner.elements)){var Z=Y._mySpinner.elements.container.getParent().getParent();if(I.is(Z)&&Z!==X){Y._mySpinner.elements.container.getParent().inject(X)}Y._mySpinner.toggle()}else{var aa=UWA.createElement("div",{"class":"datagrid-loader"});aa.setStyle("text-align","center");aa.setStyle("position","absolute");aa.setStyle("left","calc(50% - 15px)");aa.setStyle("bottom","8px");aa.inject(X);Y._mySpinner=new z({className:"search-spinner"}).inject(aa).show()}},loadMoreData:function(Y,X){var Z=this;var ab=this.getCollection();if(((I.is(ab)&&ab.hasNextPage()))&&((!I.is(this._mySpinner))||(I.is(this._mySpinner)&&!this._mySpinner.isVisible))){this._toggleLoader()}c.log("Infinite scroll : loading more models...");if(ab._search_in_progress===false){if(ab.hasNextPage()){var aa=Math.floor((Math.random()*100000)+1);ab.getNextPage({remove:false,onComplete:function(){ab.generateTreeModel();Z._toggleLoader();Z._updateWidgetTitleWithNbResult();Z._getAndDisplayLastIndexTime();Y&&Y();v.mark("DS/SNResultUX/views/xxx$onInfiniteScrollAsync$getNextPage$group$"+aa+"$end")},onFailure:function(ac){Z.dispatchEvent("on_search_failure",S.get("on_search_failure"));X&&X();v.mark("DS/SNResultUX/views/xxx$onInfiniteScrollAsync$getNextPage$group$"+aa+"$end")}})}else{Y&&Y()}}else{Y&&Y()}},_loadFirstPage:function(ah){var ae=this;var ac=this.getCollection();var Y=this.getContainer();if(ac.service_parameters&&!ac.service_parameters.adv_search){!Y&&ae._skeleton.container&&J.mask(ae._skeleton.container)}var X=false;if(ac._ctx_options&&ac._ctx_options.advanced_search&&ac._ctx_options.advanced_search.searchOnInit){X=true}if((I.is(ac.getRequestCriteria().service_params)&&(ac.getRequestCriteria().service_params.query===e.SearchTypeEnum.ADVANCED_SEARCH)&&I.is(ac.getRequestCriteria().service_params.adv_search)&&!(I.is(ac.getRequestCriteria().service_params.refine)&&I.is(ac.getRequestCriteria().service_params.refine.PLMParameters)&&I.is(ac.getRequestCriteria().service_params.refine.PLMParameters.plmparam)&&I.is(ac.getRequestCriteria().service_params.refine.PLMParameters.plmparam.length>0)))&&!X){var ai=this._advSearchMgr;if(I.is(ai)&&!(I.is(ai._dataSetsForSource)&&I.is(ai._dataSetsForSource.options)&&I.is(ai._dataSetsForSource.options.datasets)&&I.is(ai._dataSetsForSource.options.datasets.items)&&Object.keys(ai._dataSetsForSource.options.datasets.items).length>0)){var Z=true;ai.clearFilters();ai.getAndDisplayAdvancedSearch(Z)}}else{Y&&J.mask(Y);var af=Math.floor((Math.random()*100000)+1);var ak=this;if(I.is(ak)){var aa=ak.getHelperCollectionId();var aj=function(al,an,am){if(I.is(al)&&true===al._isAHelper){ak.copyDataFromHelperCollection(ac,al);ac.dispatchAsEventListener("on_sync")();if(I.is(al._parse_alert,"array")&&al._parse_alert.length>0){ak._failure(al,{service:al.snservices,messages:al.parsing_alert})}e.deleteHelperCollection(aa)}ac.generateTreeModel();ak._updateWidgetTitleWithNbResult();ak._getAndDisplayLastIndexTime();ak.getContainer()&&J.unmask(ak.getContainer());if(ah&&I.is(ah.onComplete,"function")){ah.onComplete.call(this)}v.mark("DS/SNResultUX/views/xxx$_loadFirstPage$"+af+"$end");if(U.getItem("nav_history")){ae.dispatchEvent("onFedSearchComplete",ac.totalCount)}if(al.getRequestCriteria()&&al.getRequestCriteria().service_params){D.publish({channel:ae.getOption("messagingChannel"),topic:"addSortItem",data:{order_by:al.getRequestCriteria().service_params.order_by,order_field:al.getRequestCriteria().service_params.order_field,nlsName:undefined}})}};var ag=function(ap,ao,am){var ar="";if(I.is(ae._searchActions)&&I.is(ae._searchActions.setEmptyViewMessage,"function")){if(I.is(ao,"object")&&I.is(ao.error,"object")&&I.is(ao.error.errorMessage,"string")){var al=S.get(ao.error.errorMessage);if(I.is(al,"string")&&al.length>0){ar=S.get(ao.error.errorCode)}else{ar=ao.error.errorMessage}}ae._searchActions.setEmptyViewMessage(ar)}ap.dispatchAsEventListener("onError")();var aq=ae.getCurrentView();if(I.is(aq)&&I.is(aq.checkToDisplayEmptyView,"function")){aq.checkToDisplayEmptyView()}ak.getContainer()&&J.unmask(ak.getContainer());v.mark("DS/SNResultUX/views/xxx$_loadFirstPage$"+af+"$end");var an=e.getHelperCollection(aa);if(I.is(an)){ap._fedSearchLabel=UWA.clone(an._fedSearchLabel)}ak._failure(ap,ao);e.deleteHelperCollection(aa)};var ad=e.getHelperCollection(aa);if(I.is(ad)){if(ad._currentState===e.HelperCollectionStatus.SEARCH_IN_PROGRESS){c.log("helper search_in_progress");ad._CBOnComplete=aj;ad._CBOnFailure=ag}else{if(ad._currentState===e.HelperCollectionStatus.SEARCH_SUCCEEDED){c.log("helper search_succeeded");aj(ad)}else{if(ad._currentState===e.HelperCollectionStatus.SEARCH_FAILED){c.log("helper search_failed");if(I.is(ad.fedSearch_error)){ag(ad,ad.fedSearch_error)}}}}}else{ac.getFirstPageOfResults({reset:true,onComplete:aj,onFailure:ag})}}}var ab;if(I.is(ac.getRequestCriteria())&&I.is&&I.is(ac.getRequestCriteria().service_params)&&I.is(ac.getRequestCriteria().service_params.idWaitLoading)){ab=ac.getRequestCriteria().service_params.idWaitLoading;g.WaitManager.removeWaitCondition(ab)}},_updateResultsToNative:function(ac){if(H.getOption("search_web_in_win")){if(!I.is(ac)){ac=this.getCollection()}var ab=I.is(H.getOption("tabbed_ui_support_level"));if(I.is(ac)){var X=[];var aa=ac.pluck("id");for(var Z=0;Z<aa.length;Z++){if(ab){X.push({id:aa[Z]})}else{X.push(aa[Z])}}var Y={notif_name:"onResultsUpdate",notif_parameters:{tabID:this.getOption("observable").getTabID(),objects:X}};if(!ab){Y.notif_parameters=X}this._searchcom_socket.dispatchEvent("onDispatchToWin",Y,"search_web_in_win")}}},setup:function(X){var Y=this;this.listenTo(this.getCollection(),{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){var Z=Y.getContainer();Z&&J.mask(Z);if(Y.getCollection()&&Y.getCollection().service_parameters&&Y.getCollection().service_parameters.adv_search&&!Y.getCollection().advanced_criteria){Y._skeleton.container&&J.unmask(Y._skeleton.container);Z&&J.unmask(Z);Y.getCollection().initTreeDocument()}else{Y._skeleton.container&&J.unmask(Y._skeleton.container)}},on_sync:function(aa){var Z=Y.getContainer();Z&&J.unmask(Z);aa&&aa.generateTreeModel();Y._updateResultsToNative(aa)},onInitTreeDocument:function(Z){Y._model=Z;if(Y._lightBoxView){Y._lightBoxView.changeModel(Z)}if(Y._informationPanel){Y._informationPanel.changeModel(Z)}}})},notifySelectionAddinMode:function(X){if(I.is(this.getOption("addinMode"),"string")){var Y=this;if(!I.is(X)){X=a.buildCompassSelectionData({widgetId:this.getOption("widgetId"),selectedModels:[]})}require(["DS/PlatformAPI/PlatformAPI"],function(Z){var aa=JSON.stringify({event:"selection",source:X.source,version:X.version,content:X});Y.log("publishing webinwin:web:notification SELECTION event, data:"+aa);Z.publish("webinwin:web:notification",aa)})}},getSearchWidget:function(){var Y=this;var Z;var X=Y.getOption("widgetId");if(I.is(X)&&I.is(UWA.Widgets)&&I.is(UWA.Widgets.instances)){UWA.Widgets.instances.forEach(function(aa){if(aa.id===X){Z=aa}})}return Z},setPrintWindow:function(X){this._printWindow=X},getSocketID:function(Y){var X=I.is(Y)?this._WebInWinCtxActionSocket:this._searchcom_socket;if(X){return X.id}},handleKeyboardEvent:function(Z){var Y=this;var X=UWA.Event.whichKey(Z);if(X==="ctrl+a"){if(I.is(Y._in_app_multiSel)&&(Y._in_app_multiSel==="oneToOne")){a._displayAlert({message:S.get("error_select_all"),className:"info",});Z.preventDefault();Z.stopPropagation();return}if(I.is(Z)&&I.is(Z.currentTarget)&&I.is(Z.currentTarget.activeElement)&&(Y._skeleton.container.contains(Z.currentTarget.activeElement)||Z.currentTarget.activeElement===document.body)){Y._selectAll();Z.preventDefault();Z.stopPropagation()}}else{if(X==="ctrl+shift+a"){Y.onFetchAndSelectAllCallback({DoSelection:true})}else{if(Z.keyCode===116){if(H.getOption("search_web_in_win")){Z.returnValue=false;Z.preventDefault();Z.stopPropagation();this._searchActions.dispatchEvent("onRefreshResultRequest")}}}}},getActiveTenant:function(){if(this.getCollection()&&this.getCollection().getSearchRessources()){return this.getCollection().getSearchRessources().getActiveTenant()}},ActivatePreviewByClick:function(){var X=true;var Y=this.getOption("in_apps_search");if(I.is(Y,"object")){X=false}var Z=this.getOption("addinMode");if(I.is(Z,"string")&&Z.length>0){X=false}return(X)},refreshUIAfterRender:function(){var aa=this;var Y=H.getOption("search_compact_mode");if(!I.is(Y)){return}if(Y===true){return}else{var Z=false;if(!I.is(this._previewState)){Z=false;if(aa.ActivatePreviewByClick()===false){Z=false}var X=U.getItem("LastSearchPreview");if(I.is(X)){Z=X}}else{if(this._previewState===true){Z=true}}if(Z===true&&aa._informationPanel===null){var ab=this.getOption("observable");if(I.is(ab)){aa.ActivateDeactivateInformationsPanel();ab.managepreviewPanel(true)}}}}})});define("DS/SNResultUX/SNResultMgt",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Class/Collection","UWA/Utils/Client","UWA/Utils/InterCom","DS/WebappsUtils/Performance","DS/PlatformAPI/PlatformAPI","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","css!DS/SNResultUX/SNResultUX","DS/SNResultUX/SNSkeletonMgt_v2","DS/TagNavigatorProxy/TagNavigatorProxy","DS/SNResultUX/utils/ResultUX_customization","DS/SNResultUX/utils/ResultsUtils","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchViewOptions","text!DS/SNResultUX/assets/SNResultUX_custo.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SNUnitConversion","DS/SNResultUX/utils/WildcardMgr","DS/SNResultUX/utils/SNResultTypeCustoHelper","DS/SNResultUX/utils/SearchSortView","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/SNResultUX/views/SearchHistoryTree","DS/i3DXCompassServices/i3DXCompassPubSub","DS/SNInfraUX/SearchPreferences","DS/WebRecordEnabler/Adapter","DS/SNResultUX/utils/OneSearchActions"],function(z,E,h,f,b,q,F,p,m,w,A,x,C,y,e,i,k,j,t,D,a,r,H,G,c,u,d,K,B,l,v,J,o,I,g,n){return E.extend(h,f,x,{uwaClassName:"DS/SNResultUX/SNResultMgt",name:"onesearch_results",_resources:null,_taggerProxy:null,_searchcom_socket:null,_search_criteria:"",_originalSearchCriteria:"",_search_tag_filter:{},_selected_objects:null,_adv_search:false,_advanced_criteria:"",_ok_Button:null,_apply_Button:null,_adv_search_field:null,onesearch_indexedtimeIcon:null,indexedtimeMenu:null,_isMultiSelModeOnTouch:false,_historySearch:null,_headersSearch:null,_idWaitLoading:null,_compass_socket:null,_subscriptions:null,_keydownEventHandler:null,_minimizedSidePanel:false,_incontext_precond_2:null,_forceOnSearch:false,_oneSearchActions:null,_detailsviewSelected:null,init:function(M){var O=this,P=p.now().toString();this._subscriptions={};this._detailsviewSelected=null;p.mark('{"module":"DS/SNResultUX/SNResultMgt","name":"SNResultMgt::init","uuid":"'+P+'","status":"start","drilldown_serie_id":"SNResultMgt::init","drilldown":"SNResultMgt::init-DetailedView"}');if(!M.viewData){M.viewData={};M.viewData.global_actions=M.incontext_global_actions}O._parent(M);O.log("init");if(z.is(M)&&z.is(M.search_settings)){y.initialize({search_settings:M.search_settings})}window.addEventListener("resize",this.updateDimension.bind(this));e.checkCustomerConfigs({resources:new A(this.getOption("resources"))}).then(function(S){O.log("checkCustomerConfigs SUCCESS : "+S)},function(S){O.log("checkCustomerConfigs FAILURE : "+S)});this._searchcom_socket=C.createSocket({socket_id:this.getSocketID(),widgetId:this.getOption("widget_id")});if(this._searchcom_socket){this._searchcom_socket.addListener("toggleProxyFocus",this._toggleProxyFocus.bind(this));this._searchcom_socket.addListener("clearfilterbyclosesidepanel",this.clearfilterbyclosesidepanel.bind(this));this._searchcom_socket.addListener("manageActionIconOnSidePanel",this.manageActionIconOnSidePanel.bind(this));this._searchcom_socket.addListener("UpdateInContextSearch",this._updateInContextSearch.bind(this));this._searchcom_socket.addListener("widgetResize",this.updateDimension.bind(this))}this._subscriptions.updateSelectionNumber=w.subscribe({channel:this.getMessagingChannel(),topic:"updateSelectionNumber",callback:this.updateSelectionNumber.bind(this)});if(!z.is(this.getOption("getTabID"),"function")){this._subscribeToKeyboardEvents()}var L=function(Y){var S=y.getOption("enablePLM",{tenant:O._resources.getActiveTenant()});if(M.in_apps_search&&M.in_apps_search.advanced_search&&M.in_apps_search.advanced_search.showPLMParameter===false){S=false}var W;if(z.is(O._resources)&&z.is(O._resources.getActiveTenant())){W=O._resources.getActiveTenant()}if(y.getOption("ENO_BI_ON_TAGGER")){require(["DS/ENOFilterBIUX/FilterBIComponentProxy"],function(aa){var ab={enablePLM:S,tenant:W,processingMode:"appProcessing",colorize:true,events:{addFilterChangeListener:O.onFilterChange.bind(O),addCriteriaChangeListener:O.onCriteriaChange.bind(O),addPLMUpdateListener:O.onPLMUpdate.bind(O),addOpenTaggerListener:O.onOpenTagger.bind(O),addCloseTaggerListener:O.onCloseTagger.bind(O),addRequestSuggestsListener:O.OnSuggestUpdate.bind(O)}};if(z.is(O.getOption("tagger_context_id"))){ab.contextId=O.getOption("tagger_context_id")}else{if(I.getItem("integratedSearch")){var Z=O.getSearchWidget();if(z.is(Z)){ab.contextId=Z.context}}else{ab.widgetId=O.getOption("widget_id")}}O._taggerProxy=new aa(ab);O._taggerProxy.addEvent("FilterBIColorize",O.onTaggerColorization.bind(O));O._taggerProxy.addEvent("FilterBIUnColorize",O.onTaggerUnColorization.bind(O));Y.call()})}else{var V={enablePLM:S,tenant:W,filteringMode:"FilteringOnServer",disableAutoComplete:true,events:{addFilterChangeListener:O.onFilterChange.bind(O),addCriteriaChangeListener:O.onCriteriaChange.bind(O),addPLMUpdateListener:O.onPLMUpdate.bind(O),addCloseTaggerListener:O.onCloseTagger.bind(O),addOpenTaggerListener:O.onOpenTagger.bind(O),addRequestSuggestsListener:O.OnSuggestUpdate.bind(O)},freeInput:false,defaultDatePicker:true,preciseCount:y.getOption("preciseCount",{tenant:O.getActiveTenant()})};y.options.search_settings.taggerClosed=false;if(z.is(O.getOption("tagger_context_id"))){V.contextId=O.getOption("tagger_context_id")}else{if(I.getItem("integratedSearch")){var T=O.getSearchWidget();var X=true;if(z.is(T)){var U=T.getValue("launch_mode");if(z.is(T.data)&&!z.is(T.data.pinToDashboard)){V.contextId="RightPanelContext"}if(U===e.widgetLaunchMode.COMPASS_TRANSIENT||U===e.widgetLaunchMode.COMPASS_PINNED||U===e.widgetLaunchMode.INCONTEXT_TRANSIENT){V.contextId=""}V.widgetId=O.getOption("widget_id");X=false}if(X===true){V.widgetId=O.getOption("widget_id")}}else{V.widgetId=O.getOption("widget_id")}}if(y.getOption("search_web_in_win")===true){require(["DS/SNResultUX/webinwin/WebInWinTaggerProxy"],function(Z){V.proxyId=O.getTabID();V.contextId=e.TAGGERPROXY_CONTEXTID_WEB_IN_WIN;O._taggerProxy=new Z(V);if(!z.is(y.getOption("tabbed_ui_support_level"))){O._taggerProxy.clearLocalFilter()}Y.call()})}else{O._taggerProxy=j.createProxy(V);Y.call()}}};var R=function(){p.mark('{"module":"DS/SNResultUX/SNResultMgt","name":"SNResultMgt::ready_to_initialize","uuid":"'+P+'","status":"start","drilldown_serie_id":"SNResultMgt::AddCusto"}');L(function(){p.mark('{"module":"DS/SNResultUX/SNResultMgt","name":"SNResultMgt::createTaggerProxy","uuid":"'+P+'","status":"start","drilldown_serie_id":"SNResultMgt::init-DetailedView"}');var T=O.getOption("search_options");if(O._searchcom_socket&&z.is(T)&&z.is(T.tag_filter)){O._searchcom_socket.dispatchEvent("Last_Tag_Filter",O.options.search_options.tag_filter)}O._selected_objects=new b();var S={source:O.options.source,events:{selected_obj:function(){O._selected_objects.reset();if(z.is(arguments)){for(var W=0,U=arguments.length;W<U;W++){O._selected_objects.add(arguments[W])}}if(O._ok_Button){var V=O.getInContextMinSelect();O._ok_Button.setDisabled(O._selected_objects.size()<V)}if(O._apply_Button){O._apply_Button.setDisabled(O._selected_objects.size()==0)}},onItemViewClick:function(U){var V=O.options.itemViewClickHandler;if(z.is(V)){require([V],function(W){W.executeAction.call(W,{model:U})})}},onSkeletonReady:function(){if(z.is(O.getOption("renderTo"))){O.render().inject(O.getOption("renderTo"))}var V=O.getOption("search_options");if(z.is(V)){if(!z.is(V.viewData)){V.viewData=O.getOption("viewData")}O._forceOnSearch=true}else{if(!z.is(O.options.donotshowlastsearch)){if(z.is(O.options)&&z.is(O.options._lastSearchOptions)){O.dispatchEvent("onSearchSkeleton",O.options._lastSearchOptions)}}}if(z.is(O.elements)&&z.is(O.skeleton)&&z.is(O.skeleton.getSearchActions)&&z.is(O.skeleton.getSearchActions())){var Z=O.skeleton.getSearchActions();Z.addEvent("onRefreshResultRequest",function(ab){O.log("refreshSearchResult");var aa=undefined;if(z.is(ab)){aa={};if(z.is(ab.criteria)){if(z.is(ab.criteria.search_crit)){aa.search_criteria=ab.criteria.search_crit}if(z.is(ab.criteria.originalSearchCriteria)){aa.originalSearchCriteria=ab.criteria.originalSearchCriteria}if(z.is(ab.criteria.tagger_crit)){aa.tag_filter=ab.criteria.tagger_crit}if(z.is(ab.criteria.search_name)){aa.search_name=ab.criteria.search_name}if(z.is(ab.criteria.source)){aa.source=ab.criteria.source}if(z.is(ab.criteria.queryType)){aa.queryType=ab.criteria.queryType}}aa.savedSearch=true;if(window.hasOwnProperty("sendNotificationWebInWin")&&z.is(sendNotificationWebInWin,"function")){sendNotificationWebInWin("SaveSearch",JSON.stringify(aa))}}else{aa=z.clone(O.options.search_options);if(z.is(aa)){aa.refresh=true;if(z.is(aa.tag_filter,"object")){var ac=O._taggerProxy.getCurrentFilter();if(z.is(ac,"object")&&z.is(ac.allfilters,"object")&&0<Object.keys(ac.allfilters).length){O.log("refreshSearchResult with tagg filter")}else{aa.tag_filter=null}}}}if(z.is(aa)){if(O._historySearch){if(z.is(O.elements.containerProduct)){O.elements.containerProduct.empty()}if(z.is(O.elements.containerRelational)){O.elements.containerRelational.empty()}O._historySearch.cleanAll()}O.onSearch(aa)}});Z.addEvent("onRunSavedSearch",function(aa){O.log("onRunSavedSearch");if(z.is(aa)){if(z.is(O.getOption("update_preference"),"function")){var ab=O.getOption("update_preference");ab.call(null,"tag_filter",aa.tag_filter);ab.call(null,"search_criteria",aa.search_criteria);ab.call(null,"search_criteria_to_display",aa.search_criteria_to_display);ab.call(null,"originalSearchCriteria",aa.originalSearchCriteria);ab.call(null,"saved_search",true);ab.call(null,"search_name",aa.search_name);if(z.is(aa.originalSearchCriteria,"string")&&aa.originalSearchCriteria===e.SearchTypeEnum.ADVANCED_SEARCH){ab.call(null,"adv_search",true)}}aa.resetLocalFilter=true;O.onSearch(aa)}});if(true===I.getItem("nav_history")){Z.addEvent("onDisplayRelations",function(ac){O.log("onDisplayRelations");if(z.is(ac,"object")&&z.is(ac.relation,"string")&&z.is(ac.ids,"array")){var aa="";var af;if(z.is(O._taggerProxy.clearLocalFilter,"function")){O._taggerProxy.clearLocalFilter()}if(z.is(ac.searchParam)){af=ac.searchParam;af.fromSearchHistory=true;af.refresh=false}else{for(var ab=0;ab<ac.ids.length;ab++){aa+="physicalid:"+ac.ids[ab];if(ab<ac.ids.length-1){aa+=" OR "}}var ae="";switch(ac.relation){case"parents":ae=G.get("parents.box");break;case"children":ae=G.get("children.box");break;case"drawings":ae=G.get("drawings.box");break;case"simulations":ae=G.get("simulations.box");break;case"configurations":ae=G.get("configurations.box");break}af={search_criteria:aa,originalSearchCriteria:ae,tag_filter:{},source:["3dspace"],fromSearchHistory:true};if(z.is(O.getOption("update_preference"),"function")){var ad=O.getOption("update_preference");ad.call(null,"tag_filter",af.tag_filter);ad.call(null,"search_criteria",af.search_criteria);ad.call(null,"search_criteria_to_display",af.originalSearchCriteria);ad.call(null,"originalSearchCriteria",af.originalSearchCriteria);ad.call(null,"saved_search",false)}}O.onSearch(af)}})}Z.addEvent("onNonDefaultGlobalAction",function(ab){O.log("onNonDefaultGlobalAction");if(z.is(ab)&&z.is(ab.id)&&O._searchcom_socket){var ad;var aa=r.getViewData();if(z.is(aa)){ad=aa.global_actions}var ac;if(ad){ac=ad.app_socket_id}if(ac){O._searchcom_socket.dispatchEvent("Selected_global_action",{selected_objects:O._selected_objects.toArray(),id:ab.id,command_data:ab.command_data},ac)}}});Z.addEvent("onInformationPanelAction",function(ab){O.log("onInformationPanelAction");var aa=false;var ac=O.getSNSkeleton();aa=ac.ActivateDeactivateInformationsPanel();O.manageinformationPanel(aa)});Z.addEvent("onPreviewPanelAction",function(ab){O.log("onPreviewPanelAction");var aa=false;var ac=O.getSNSkeleton();aa=ac.ActivateDeactivatePreviewPanel();O.managepreviewPanel(aa)});Z.addEvent("onPinToDashboardAction",function(aa){O.log("onPinToDashboardAction");O.onPinToDashboardAction()})}else{console.error("Unable to retrieve skeleton !")}O.elements.container.addClassName(O.getOption("css_view_class"));if(true==O.getOption("swymContext")){O.elements.container.addClassName("swym")}O.elements.container.addClassName(O.getOption("css_view_class"));p.mark('{"module":"DS/SNResultUX/SNResultMgt","name":"SNResultMgt::init","uuid":"'+P+'","status":"end","drilldown_serie_id":"SNResultMgt::init"}');O.dispatchEvent.call(O,"onReady");var Y=I.getItem("nav_history");if(Y===true){O.managehistoryPanel(false)}if(Y===true||I.getItem("integratedSearch")){var X=O.getSNSkeleton();if(X!==null){var U=function(ab){var ae=ab;if(z.is(ae.source)&&(ae.source==="ENXScene_appId"||ae.source==="ENORIPE_AP")&&z.is(ae.data)&&z.is(ae.data.items)){var aa=ae.data.items;var ad=aa.length;var ag=null;if(ad>0){var af=aa[ad-1];if(z.is(af)&&z.is(af.displayName)){ag={displayName:af.displayName,id:af.objectId,getServiceID:function(){return("3DSpace")},getPlatformID:function(){return(af.envId)},get:function(ah){var ai;if(z.is(ah)){if(ah==="id"){ai=af.objectId}else{if(ah==="ds6w:type"){ai=af.displayType}else{if(ah==="ds6w:type_value"){ai=af.objectType}}}}return ai}}}}if(X._informationPanel!==null){X._informationPanel.setInfomationPanelObject(ag)}var ac={};ac.size=ad;ac.itemModel={};if(ag!==null){ac.itemModel.label=ag.displayName;ac.itemModel.id=ag.id;ac.itemModel.model=ag;ac.itemModel.model.fromApp=true;O._addNavHistorySelectBox(ac)}}};var W="HistoryListen";if(O._compass_socket===null){O._compass_socket=new F.Socket(W);O._compass_socket.subscribeServer("com.ds.compass",window.parent)}if(O._compass_socket){O._compass_socket.addListener("onSetX3DContent",function(aa){U(aa)})}o.subscribe("setX3DContentCallback",function(aa){U(aa)});o.subscribe("resetType",function(aa){if(X._informationPanel!==null){var ab=null;X._informationPanel.setInfomationPanelObject(ab)}})}}O.updateDimension()}}};O.opts_skeleton=S;O._buildSkeleton(S);p.mark('{"module":"DS/SNResultUX/SNResultMgt","name":"SNResultMgt::createTaggerProxy","uuid":"'+P+'","status":"end","drilldown_serie_id":"SNResultMgt::init-DetailedView"}');p.mark('{"module":"DS/SNResultUX/SNResultMgt","name":"SNResultMgt::ready_to_initialize","uuid":"'+P+'","status":"end","drilldown_serie_id":"SNResultMgt::AddCusto"}')})},N=function(){p.mark('{"module":"DS/SNResultUX/SNResultMgt","name":"SNResultMgt::ready_to_customized","uuid":"'+P+'","status":"start","drilldown_serie_id":"SNResultMgt::init-DetailedView","drilldown":"SNResultMgt::AddCusto"}');p.mark('{"module":"DS/SNResultUX/SNResultMgt","name":"SNResultMgt::AddCusto resultJSONParse","uuid":"'+P+'","status":"start","drilldown_serie_id":"SNResultMgt::AddCusto","drilldown":"ResultUX_customization::addCustomization"}');var S=JSON.parse(H);t.setAddinMode(O.getOption("addinMode"));t.addCustomization(S,function(){p.mark('{"module":"DS/SNResultUX/SNResultMgt","name":"SNResultMgt::AddCusto resultJSONParse","uuid":"'+P+'","status":"end","drilldown_serie_id":"SNResultMgt::AddCusto"}');if(z.is(M.result_ux_customization)){p.mark('{"module":"DS/SNResultUX/SNResultMgt","name":"SNResultMgt::AddCusto options.result_ux_customization","uuid":"'+P+'","status":"start","drilldown_serie_id":"SNResultMgt::AddCusto","drilldown":"ResultUX_customization::addCustomization"}');t.addCustomization(M.result_ux_customization,function(){p.mark('{"module":"DS/SNResultUX/SNResultMgt","name":"SNResultMgt::AddCusto options.result_ux_customization","uuid":"'+P+'","status":"end","drilldown_serie_id":"SNResultMgt::AddCusto"}');R(M)})}else{R(M)}p.mark('{"module":"DS/SNResultUX/SNResultMgt","name":"SNResultMgt::ready_to_customized","uuid":"'+P+'","status":"end","drilldown_serie_id":"SNResultMgt::init-DetailedView"}')})};if(M.resources instanceof A){O._resources=M.resources;y.getTenantSettings(O.getActiveTenant()).then(N)}else{try{O._resources=new A(M.resources,function(){O._resources=this instanceof A?this:O._resources;y.getTenantSettings(O.getActiveTenant()).then(N)})}catch(Q){console.log("SearchRessources not initialized!")}}if(y.getOption("load_PQs")){c.fetchPQsFromServer(O._resources)}},destroy:function(){this.log("destroy");window.removeEventListener("resize",this.updateDimension.bind(this));if(this.onesearch_selectionNumberDiv){this.onesearch_selectionNumberDiv.removeEvents()}if(this.onesearch_globalDropdownIcon){this.onesearch_globalDropdownIcon.removeEvents()}if(this.indexedtimeMenu){this.indexedtimeMenu.removeEvents()}this._beingDestroyed=true;if(this._contentSetHeader){this._contentSetHeader.removeEvent("contextmenu");this._contentSetHeader=null}if(this._resources){delete this._resources;this._resources=null}if(this.sortPanelView&&this.sortPanelView._view){w.unsubscribe(this.sortPanelView._subscriptions.setOrderInGridView);this.sortPanelView.destroy();this.sortPanelView=null}if(this._oneSearchActions&&this._oneSearchActions._view){if(this._oneSearchActions.tooltip){this._oneSearchActions.tooltip.destroy();this._oneSearchActions.tooltip=null}this._oneSearchActions.destroy();this._oneSearchActions=null}if(z.is(this.elements)&&z.is(this.elements.onesearchactionspreview)){if(z.is(this.elements.onesearchactionspreview.tooltipActionspreview)){this.elements.onesearchactionspreview.tooltipActionspreview.destroy();this.elements.onesearchactionspreview.tooltipActionspreview=null}if(z.is(this.elements.onesearchactionspreview.tooltipActionsnext)){this.elements.onesearchactionspreview.tooltipActionsnext.destroy();this.elements.onesearchactionspreview.tooltipActionsnext=null}if(z.is(this.elements.onesearchbacksearch.tooltipActionsback)){this.elements.onesearchbacksearch.tooltipActionsback.destroy();this.elements.onesearchbacksearch.tooltipActionsback=null}}if(this._searchcom_socket){this._searchcom_socket.removeListener("OnRefreshWebInWin");this._searchcom_socket.removeListener("toggleProxyFocus");this._searchcom_socket.removeListener("clearfilterbyclosesidepanel");this._searchcom_socket.removeListener("manageActionIconOnSidePanel");this._searchcom_socket.removeListener("UpdateInContextSearch");this._searchcom_socket.removeListener("widgetResize");w.unsubscribe(this._subscriptions.updateSelectionNumber);C.deleteSocket(this.getSocketID());if(e._isSearchWidgetTransientAvailable(this.getOption("widget_id"))===false){var L=z.is(this.getOption("getTabID"),"function");if(!L){var N=this.getOption("css_view_class")==="windowed"?true:false;if(true===e.isTaggerOpenedByCode()&&false===N){this._searchcom_socket.dispatchEvent("closeTagger")}var M=this.getOption("in_apps_search");this._searchcom_socket.dispatchEvent("onCloseTransient",{in_apps_search:M})}}this.log("Disconnect the socket from the server");this._searchcom_socket.disconnect();delete this._searchcom_socket}if(this._compass_socket){this._compass_socket.removeListener("onSetX3DContent");this._compass_socket.disconnect();delete this._compass_socket}if(this._taggerProxy){this._taggerProxy.die();delete this._taggerProxy}if(z.is(this.indexedtimeMenu)){if(z.is(this.indexedtimeMenu.destroy,"function")){this.indexedtimeMenu.destroy()}this.indexedtimeMenu=null}this.onesearch_selectionNumberDiv=null;this.onesearch_globalDropdownIcon=null;if(this.onesearch_indexedtimeIcon&&this.onesearch_indexedtimeIcon.tooltip){this.onesearch_indexedtimeIcon.tooltip.destroy();this.onesearch_indexedtimeIcon.tooltip=null}this._selected_objects=null;if(z.is(this._keydownEventHandler,"function")){UWA.Element.removeEvent.call(document,"keydown",this._keydownEventHandler)}if(z.is(this.skeleton)&&z.is(this.skeleton.destroy)){this.skeleton.destroy();this.skeleton=null}this.options=null;this.opts_skeleton=null;this._subscriptions={};this._parent()},getBAdvSearch:function(){return this._adv_search},getBAdvSearchField:function(){return this._adv_search_field},updateDimension:function(L){var M=this;clearTimeout(M.resizeEventId);M.resizeEventId=setTimeout(function(){if(z.is(M.skeleton)){var O=null;var Q=M.skeleton.getSearchWidget();var N=0;if(z.is(Q)&&z.is(Q.body)){O=Q.body;if(z.is(M.getOption("addinMode"),"string")||true===M.getOption("swymContext")){N=0}else{if(z.is(Q.getView,"function")&&z.is(Q.getView().type)&&Q.getView().type==="windowed"||Q.getView().type==="sidepanel"){N=24;if(z.is(L)){N=-1}}}}else{O=z.extendElement(document.body).getElement(".onesearch_results")}if(z.is(O)){var S=O.getDimensions();if(z.is(S)){var P=S.width;(P<850)?O.addClassName("searchContainerSmallWidth"):O.removeClassName("searchContainerSmallWidth");var R=M.getSNSkeleton();if(z.is(R)&&z.is(R._informationPanel)&&R._informationPanel.getvisibleFlag()===true){R._informationPanel.updateDimension(O,N)}}}}},100)},_updateInContextSearch:function(L){this._incontext_precond_2=(L.precond&&L.precond.length>0)?L.precond:null;if(!(L.refresh==false)){this.refreshSearch()}},getInContextMinSelect:function(){var L=1;var M=this.getOption("in_apps_search");if(M&&M.furtive_options&&z.is(M.furtive_options.min_select)){L=M.furtive_options.min_select}return L},getMessagingChannel:function(){var L=this.getTabID();var M=this.getOption("widget_id");return M+"-#-"+L},getSocketID:function(){var M="result_socket_"+this.getOption("widget_id");var L=this.getTabID();return(z.is(L,"string"))?M+"-"+L:M},getTabID:function(){return(z.is(this.getOption("getTabID"),"function"))?this.getOption("getTabID").call():"3DSearch-non-tabbed-ui"},_getSearchType:function(){var N=e.SearchTypeEnum.SEARCH;var M=this.getOption("search_options");if(z.is(M,"object")){var L=this.getOption("search_options").search_criteria;switch(L){case e.SearchTypeEnum.MY_CONTENT:return e.SearchTypeEnum.MY_CONTENT;break;case e.SearchTypeEnum.ADVANCED_SEARCH:return e.SearchTypeEnum.ADVANCED_SEARCH;break;case e.SearchTypeEnum.FAVORITE_SEARCH:return e.SearchTypeEnum.FAVORITE_SEARCH;break}}return N},getTabIcon:function(){var L={iconName:"search",fontIconFamily:1};switch(this._getSearchType()){case e.SearchTypeEnum.MY_CONTENT:L.iconName="user";break;case e.SearchTypeEnum.ADVANCED_SEARCH:L.iconName="search-cog";break;case e.SearchTypeEnum.FAVORITE_SEARCH:L.iconName="favorite-on";break}return L},_updateWdgPreferences:function(N){if(z.is(this.getOption("update_preference"))){var M=["tag_filter","search_criteria","search_criteria_to_display","originalSearchCriteria","search_mode","adv_search","advanced_criteria","source","searchViewMode","search_mode","order_by","order_field"];for(var L in N){-1!==M.indexOf(L)&&this.getOption("update_preference").call(null,L,N[L])}}},OnTabActivated:function(){var L=y.getOption("search_web_in_win");var M=this.getOption("search_options");if(z.is(M)){if(L&&window.hasOwnProperty("sendNotificationWebInWin")&&z.is(sendNotificationWebInWin,"function")){if(z.is(y.getOption("tabbed_ui_support_level"))){var O={search_criteria:UWA.is(M.originalSearchCriteria)?M.originalSearchCriteria:""};sendNotificationWebInWin("UpdateSearchField",JSON.stringify(O))}}else{this._searchcom_socket.dispatchEvent("onSearch",{parameters:{search_criteria:z.is(M.search_criteria)?M.search_criteria:"",originalSearchCriteria:M.originalSearchCriteria,search_criteria_to_display:M.search_criteria_to_display,adv_search:M.adv_search,},transient_widget:this.getOption("transient_context")=="true",widget_id:this.getOption("widget_id"),in_apps_search:this.getOption("in_apps_search"),tabInfo:{tenant:this._resources.getActiveTenant(),client_identifier:e.identifyClientInfo().identifier}})}}if(this._taggerProxy){this._taggerProxy.activate();if(L&&y.getOption("proxy_button_available")===true){this._taggerProxy.toggleProxyFocus(true)}if(this._getSearchType()!==e.SearchTypeEnum.ADVANCED_SEARCH){this.setTaggerMode("tags")}}var N=this.getSNSkeleton();if(z.is(N)){N.restoreSelectionOnTabActivation();if(z.is(y.getOption("tabbed_ui_support_level"))){this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onTabActivated",notif_parameters:{tabID:this.getTabID()},},"search_web_in_win")}else{N._updateResultsToNative()}this.managehistoryPanel(false);this.manageinformationPanel();this.manageActionIconOnSidePanel()}z.is(M)&&this._updateWdgPreferences(M)},OnTabDeactivated:function(){if(this._taggerProxy){this._taggerProxy.deactivate()}var L=this.getSNSkeleton();if(z.is(L)){L.resetCompassSelection();L.clearWebInWinCSO();if(L._searchActions.popover){L._searchActions.popover.destroy();L._searchActions.popover=null}if(z.is(L._informationPanel)&&z.is(L._previewState)){var M="LastSearchPreview";I.setItem(M,L._previewState);I.commit()}}},OnTabRemoved:function(){this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onTabRemoved",notif_parameters:{tabID:this.getTabID()},},"search_web_in_win")},onKeyboardEvent:function(M){var L=this.getSNSkeleton();if(z.is(L)){L.handleKeyboardEvent(M)}},_subscribeToKeyboardEvents:function(){var L=this;this._keydownEventHandler=function(M){L.onKeyboardEvent(M)};UWA.Element.addEvent.call(document,"keydown",this._keydownEventHandler)},onTaggerColorization:function(L){var M=[{criteria:function(N){this.color=L.coloredSubjects["pid://"+N.get("id")];return true}}];this.setShadings(M)},onTaggerUnColorization:function(L){var M=[{color:"initial",criteria:function(){return true}}];this.setShadings(M)},onReady:function(){},onRefresh:function(){var L={};L.search_criteria=this._search_criteria;L.originalSearchCriteria=this._originalSearchCriteria;L.tag_filter=this._search_tag_filter;L.adv_search=this._adv_search;L.advanced_criteria=this._advanced_criteria;L.source=this.options.source;this.onSearch(L)},onSearchPQ:function(L){this.log("onSearchPQ");var M=this;c.fetchPQsFromServer(M._resources).then(function(){M.dispatchEvent("onSearchSkeletonPQ",L)})},onSearch:function(L){var M=this;if(L.in_apps_search){var O=M.getOption("in_apps_search");if(!O){M.setOption("in_apps_search",L.in_apps_search);var N={search_criteria:L.search_criteria,originalSearchCriteria:L.originalSearchCriteria,search_criteria_to_display:L.search_criteria_to_display,source:L.source?L.source:this.source,search_mode:"index",tag_filter:L.tag_filter,adv_search:L.adv_search?L.adv_search:false};M.setOption("search_options",N);M._search_tag_filter=L.tag_filter;if(z.is(M.getOption("update_preference"),"function")){}M._rebuildSkeleton(M.opts_skeleton);return}}if(!z.is(this.getCollection())){console.log("Skeleton Not Ready..");return}if(L&&L.search_criteria&&z.is(L.search_criteria,"string")&&(L.search_criteria.indexOf(":")>0)&&!z.is(M.getOption("in_apps_search"),"object")){c.fetchPQsFromServer(M._resources).then(function(){M.onSearchAsyncPQ(L)})}else{this.onSearchAsyncPQ(L)}},onSearchAsyncPQ:function(R){this.log("onSearch");if(!z.is(R)){console.error("no options provided in SNResultMgt.onSearch !");return}if(z.is(R.removeHistory)&&R.removeHistory===true&&this._historySearch){if(z.is(this.elements.containerProduct)){this.elements.containerProduct.empty()}if(z.is(this.elements.containerRelational)){this.elements.containerRelational.empty()}this._historySearch.cleanAll()}if(!z.is(R.recent_filter)&&!z.is(R.search_criteria===e.SearchTypeEnum.MY_RECENT_CONTENT)){if(z.is(this._taggerProxy)&&z.is(this._taggerProxy.activate,"function")){this._taggerProxy.activate()}}if(z.is(R.adv_search)&&true===R.adv_search){if(R.search_criteria===e.SearchTypeEnum.ADVANCED_SEARCH){this.setTaggerMode("criteria");if(R.displayValue===undefined&&R.in_apps_search===undefined&&R.source===undefined&&R.search_mode===undefined){var ab={widgetId:this.getOption("widget_id")};this.showAdvancedSearch(ab);return}}}else{this.setTaggerMode("tags")}var O=this.getOption("in_apps_search");if(R.viewData||!O){r.setViewData(R.viewData)}this.skeleton._searchActions.setEmptyViewMessage(G.get("loading"));if(!z.is(R.originalSearchCriteria)){R.originalSearchCriteria=R.search_criteria}if(this._search_criteria===e.SearchTypeEnum.MY_RECENT_CONTENT){if(R.search_criteria===""){R.search_criteria=e.SearchTypeEnum.MY_RECENT_CONTENT}if(R.search_criteria!==e.SearchTypeEnum.MY_RECENT_CONTENT&&this._taggerProxy){this._taggerProxy.activate()}}if(z.is(R)&&z.is(R.search_mode)&&z.is(R.search_criteria)&&(e.SearchTypeEnum.MY_RECENT_CONTENT===R.search_criteria)&&z.is(this.skeleton)&&z.is(this.skeleton._onesearch_collection)&&z.is(this.skeleton._onesearch_collection.service_parameters)&&z.is(this.skeleton._onesearch_collection.service_parameters.mode)&&e.SearchTypeEnum.MY_RECENT_CONTENT===this.skeleton._onesearch_collection.service_parameters.query&&!(z.is(R.refresh)&&true===R.refresh)){console.log("Working on recent cache");this.skeleton._onesearch_collection.filterSearch(R);return}if((!z.is(R.search_criteria)||R.search_criteria==="")&&e.SearchTypeEnum.MY_RECENT_CONTENT!==R.search_criteria&&true!==R.adv_search){return}var Z=z.is(R.resetLocalFilter)?true:false;if(e.SearchTypeEnum.FAVORITE_SEARCH===R.search_criteria){var U={search_criteria:R.search_criteria,originalSearchCriteria:G.get("my_fav_searches"),adv_search:false,advanced_criteria:null};R=U}if(z.is(this._searchcom_socket)){this._searchcom_socket.dispatchEvent("onSearch",{parameters:R,transient_widget:this.getOption("transient_context")==="true",widget_id:this.getOption("widget_id"),in_apps_search:this.getOption("in_apps_search")})}if(!z.is(O)){R.search_criteria=d.manageWildcardAddtion(R.search_criteria)}var ae=false;if(z.is(R)&&z.is(R.savedSearch)&&R.savedSearch){ae=R.savedSearch}var W=false;if(O&&z.is(O.searchable_types)){W=O.searchable_types}if((O&&!W)){}else{var ad=K.getGlobalSearchTypeCustoQuery(R.search_criteria);if(z.is(ad)){e.addSourceSpecificParameter(R,{sourceIds:["3dspace"],param:{id:"additional_query",value:ad}})}}if(R.widget_search_criteria&&R.search_criteria!==e.SearchTypeEnum.MY_RECENT_CONTENT){var ac=d.manageWildcardAddtion(R.widget_search_criteria);R.search_criteria=ac}R.incontext_precond_2=this._incontext_precond_2;this.setOption("search_options",R);if(z.is(this._taggerProxy)&&z.is(this._search_criteria)){this._taggerProxy.unsetTags();if(y.getOption("search_web_in_win")&&y.getOption("proxy_button_available")===true){this._taggerProxy.toggleProxyFocus(true)}var af="";if(z.is(this._taggerProxy.options)&&z.is(this._taggerProxy.options.widgetId,"string")){af=this._taggerProxy.options.widgetId}else{if(z.is(this._taggerProxy.widgetId,"string")){af=this._taggerProxy.widgetId}}if(z.is(R.tag_filter,"object")&&z.is(R.tag_filter.allfilters,"object")&&0<Object.keys(R.tag_filter.allfilters).length&&af!=="IsNotInWidget"){R.localFilter=z.clone(R.tag_filter.allfilters)}if(true===ae||(true===Z)){if(af!=="IsNotInWidget"){if(y.getOption("search_web_in_win")===true){if(true===Z){this._taggerProxy.clearLocalFilter()}}else{this._taggerProxy.clearLocalFilter()}}}else{if((R.search_criteria===e.SearchTypeEnum.ADVANCED_SEARCH)||(UWA.is(this._adv_search)&&this._adv_search!=R.adv_search)){if(!(z.is(R.tag_filter)&&z.is(R.tag_filter.PLMParameters)&&z.is(R.tag_filter.PLMParameters.plmparam)&&z.is(R.tag_filter.PLMParameters.plmparam.length>0))){if(z.is(this._taggerProxy.clearLocalFilter,"function")){var Y=false;if(z.is(O)&&O.app_socket_id=="socket_id_#saved_search_edit#"&&z.is(O.advanced_search)){Y=true}if(!Y){this._taggerProxy.clearLocalFilter();var S=this.getSNSkeleton();if(S){S.getCollection()._resetState();S.getCollection().reset();S.getCollection().initTreeDocument();S._updateWidgetTitleWithNbResult()}}}}}else{if(!z.is(R.tag_filter,"object")){if(z.is(this._taggerProxy)){var ai=this._taggerProxy.getCurrentFilter();if(z.is(ai)){R.tag_filter=this._removeAdvancedFiltersFromTagFilter(ai);R.advanced_criteria=this._getSearchCriteriaForAdvancedFilters(ai,R._search_criteria);this._taggerProxy.filters=R.tag_filter}}}else{if(z.is(R.tag_filter,"object")){R.advanced_criteria=this._getSearchCriteriaForAdvancedFilters(R.tag_filter,R._search_criteria)}}}}}this._search_criteria=R.search_criteria;this._originalSearchCriteria=R.originalSearchCriteria;this._adv_search=R.adv_search;this._context=R.context;this._advanced_criteria=(z.is(R.adv_search)&&false===R.adv_search&&z.is(this._advanced_criteria))?"":R.advanced_criteria;this.options.source=R.source;if(z.is(this.elements)&&z.is(this.elements.recentcontent)){var ah=this.getOption("search_options")||{};var X=e.SearchTypeEnum.MY_RECENT_CONTENT===ah.search_criteria;if(X){var V=new Date();var P=new Date(V.getTime()-y.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()})*60000);var N=(V-P)/1000/3600;var L=P.toLocaleTimeString();if(N>24||P.getDay()!=V.getDay()){L=P.toLocaleString()}}else{if(this._taggerProxy){}}}if(z.is(O)){R.recent_search=O.recent_search;if(z.is(O.specific_source_parameter)){var T={specific_source_parameter:O.specific_source_parameter};R.context=T}}this._idWaitLoading=g.WaitManager.addWaitCondition(100*1000,"Wait loading search model");R.idWaitLoading=this._idWaitLoading;if(!this.getCollection()||this.getCollection().totalCount<0){if(UWA.is(O)){if(UWA.is(O.order_field)&&UWA.is(O.order_by)){R.order_field=O.order_field;R.order_by=O.order_by}}}this.dispatchEvent("onSearchSkeleton",R);if(window.hasOwnProperty("sendNotificationWebInWin")&&z.is(sendNotificationWebInWin,"function")){var aa=this.getSNSkeleton();if(z.is(aa)){console.log("SNSkeleton title: "+aa.getTitle())}var M=R.originalSearchCriteria;var ag=R.search_name;if(z.is(R.panelTitle)){ag=R.panelTitle;M=R.search_criteria}sendNotificationWebInWin("SaveSearch",JSON.stringify({search_name:ag,search_criteria:ag,originalSearchCriteria:M}));if(false===this._adv_search){this.hideAdvancedSearch()}}var S=this.getSNSkeleton();if(z.is(S)){var Q=S.getSearchActions();if(z.is(Q)){Q.updateGlobalActions()}}this.HideInformationLightboxPanel();if(this.sortPanelView){if(z.is(this.getSNSkeleton())&&z.is(this.getSNSkeleton()._order_field)&&this.getSNSkeleton()._order_field!==""){this.sortPanelView.updateRenderByExt({order_field:this.getSNSkeleton()._order_field,order_by:this.getSNSkeleton()._order_by})}this.sortPanelView.updateMenu()}},onViewChange:function(L){if(z.is(this.elements.container)){if(z.is(L.previous)&&z.is(L.previous.type)){this.elements.container.removeClassName(L.previous.type)}this.elements.container.addClassName(L.type)}},openTagger:function(L){(window.hasOwnProperty("sendNotificationWebInWin")&&z.is(sendNotificationWebInWin,"function"))?sendNotificationWebInWin("openTagger",JSON.stringify({})):this._searchcom_socket.dispatchEvent("openTagger","")},setTaggerMode:function(L){(window.hasOwnProperty("sendNotificationWebInWin")&&z.is(sendNotificationWebInWin,"function"))?sendNotificationWebInWin("setTaggerMode",L):(z.is(this._searchcom_socket))?this._searchcom_socket.dispatchEvent("setTaggerMode",L):null},render:function(){return this},getActiveTenant:function(){return this._resources.getActiveTenant()},getTagsTransformer:function(){return this.getCollection()._tagsTransformer},onFilterChange:function(N){if(true===this._beingDestroyed){return}this.log("onFilterChange");var L=this;var M=function(){L.getTagsTransformer().getAvblSource(L._resources.getActiveTenant());L.getTagsTransformer().transformFilterSourceToProject(N);if(!z.is(L.options)){return null}var af=L.getOption("search_options")||{};L.options.search_options.tag_filter=z.clone(N);var ac=L._removeAdvancedFiltersFromTagFilter(N);var aa=null;var T=false;var ad="";var U=[];var af=L.getOption("search_options")||{};var Y,ae,ab,Z;if(z.is(af)){U=L.getOption("source");aa=L._extractFTSFromFilter(N);if(z.is(aa)){var V=aa.search_criteria;T=(aa.search===true)?true:false;ad=L._getSearchCriteriaForAdvancedFilters(aa.new_filter,L._search_criteria);if(af.adv_search){if(z.is(L.getSNSkeleton,"function")&&z.is(L.getSNSkeleton().getAdvSearchMgr,"function")){Y=L.getSNSkeleton().getAdvSearchMgr();ae=!(N.localfilters["sixw:ds6w:what/ds6w:type"]&&N.localfilters["sixw:ds6w:what/ds6w:type"].some(function(ag){return ag.object.split(":").pop()===Y._adv_search_field}));if(z.is(Y)){ab=Y._dataSetsForType&&Y._dataSetsForType.options&&Y._dataSetsForType.options.datasets&&Y._dataSetsForType.options.datasets.items;if(ae&&ab){Y._adv_search_field=null;for(Z=0;Z<Y._dataSetsForType.options.datasets.items.length;Z++){if(Y._dataSetsForType.options.datasets.items[Z].predefined===true){delete Y._dataSetsForType.options.datasets.items[Z].predefined}}}}}U=aa.source;if(z.is(V)&&V.length){L._search_criteria=V}else{if(z.is(ad)&&ad.length){L._search_criteria=""}else{L._search_criteria=e.SearchTypeEnum.ADVANCED_SEARCH}}}}}if(!L._adv_search&&L._search_criteria!=="#myContent"){if(L._searchcom_socket){L._searchcom_socket.dispatchEvent("Last_Tag_Filter",L.options.search_options.tag_filter)}}if(af.adv_search){var Q=L.getOption("in_apps_search");if(Q&&Q.advanced_search){if(z.is(Q.precond,"string")&&Q.precond.trim().length>0){if(z.is(ad,"string")&&ad.trim().length>0){ad="("+ad+") AND "+Q.precond}else{if(Q.advanced_search&&Q.advanced_search.searchOnInit==true){ad=Q.precond}}}}}L._search_tag_filter=ac;var R={search_criteria:L._search_criteria,advanced_criteria:ad,adv_search:T,tag_filter:L._search_tag_filter,source:U,originalSearchCriteria:L._originalSearchCriteria,fromSearchHistory:true,refineSearch:true,viewData:r.getViewData()};if(z.is(L.options.search_options.search_criteria_to_display)){R.search_criteria_to_display=L.options.search_options.search_criteria_to_display}if(z.is(L.getOption("update_preference"),"function")){L.getOption("update_preference").call(null,"tag_filter",L._search_tag_filter);if(T){L.getOption("update_preference").call(null,"search_criteria",L._search_criteria);L.getOption("update_preference").call(null,"originalSearchCriteria",L._originalSearchCriteria);L.getOption("update_preference").call(null,"adv_search",true);L.getOption("update_preference").call(null,"advanced_criteria",ad);if(z.is(aa)&&z.is(aa.source)){L.getOption("update_preference").call(null,"source",aa.source)}}}var X=L.getCollection();if(z.is(X)){var S=X.getRequestCriteria();if(z.is(S)&&z.is(S.service_params)){R.adv_search=S.service_params.adv_search}}if(z.is(X)){if(z.is(X._search_in_progress)&&!X._search_in_progress){if(z.is(L.options.search_options.applicativeTitle)){R.applicativeTitle=L.options.search_options.applicativeTitle}if(z.is(L.options.search_options.applicativeTitleWithResults)){R.applicativeTitleWithResults=L.options.search_options.applicativeTitleWithResults}if(!y.getOption("enablePLM",{tenant:L.getActiveTenant()})){L.onSearch(R)}else{var W=L.options.search_options.tag_filter.PLMParameters;if(!(z.is(W)&&z.is(W.plmparam)&&z.is(W.plmparam["double"]))){ac.PLMParameters=W;L.onSearch(R)}else{if(z.is(L.getSNSkeleton,"function")&&z.is(L.getSNSkeleton().getAdvSearchMgr,"function")){var Y=L.getSNSkeleton().getAdvSearchMgr();if(z.is(Y)){Y.convertPLMParamUnits(W,function(ag){ac.PLMParameters=ag;L.onSearch(R)})}}}}if(z.is(L.options.search_options.tag_filter)){L.displayAllForTypeAttribut(L.options.search_options.tag_filter.allfilters)}}else{L.log("onFilterChange: this.onSearch not launched due to query already running...");return}}if(N&&N.localfilters){if(z.is(N.localfilters["sixw:ds6w:where/ds6w:source/ds6w:dataSource"])||z.is(N.localfilters["ds6w:where/ds6w:source/ds6w:dataSource"])){var O=N.localfilters["sixw:ds6w:what/ds6w:type"];if(O&&O.length>0){var P={sixw:"ds6w:what/ds6w:type",value:[]};O.forEach(function(ag){P.value.push(ag.object)});L.onCriteriaChange(P)}}}};(e.isFUN072117Active())?this.managePreferredUnitForAdvancedFilters(N,M):M.call(L,N)},_isIncontextSourceHidden:function(){var L=this.getOption("in_apps_search");return(L&&L.advanced_search&&z.is(L.advanced_search.showSource)&&L.advanced_search.showSource==false)?true:false},managePreferredUnitForAdvancedFilters:function(M,U){var O=this;var N={};var P={};var R=function(V){if(V){Object.keys(V).forEach(function(W){var Y=W.substring(5);if(Y.startsWith("ds6wg")){var X=V[W];if(!N[Y]){N[Y]=[]}X.forEach(function(aa){var Z=aa.object;if(Z){if(aa.type=="string"){N[Y].push(Z)}else{if(aa.type=="double"||aa.type=="integer"){if(Z.from){N[Y].push(Z.from)}if(Z.to){N[Y].push(Z.to)}}}P[Y]=Q}})}})}};var Q;if(M.localfilters){for(var S in M.localfilters){var T=S.split("/");if(T.pop()=="ds6w:type"){var L=M.localfilters[S];if(L&&L.length>0){Q=L[0].object}break}}}if(Q){R(M.allfilters);R(M.localfilters);u.setResources(O._resources);u.convertValues({data:N,predicate2Type:P,callback:function(W){var V=function(X){if(X){Object.keys(X).forEach(function(Y){var aa=Y.substring(5);var Z=X[Y];Z.forEach(function(ac){var ab=ac.object;if(W[aa]){if(ac.type=="string"){ab=W[aa][ab];if(ab){ac.object=ab}}else{if(ac.type=="double"||ac.type=="integer"){if(ab){if(ab.from){ab.from=W[aa][ab.from]}if(ab.to){ab.to=W[aa][ab.to]}}}}}})})}};if(Object.keys(W).length>0){V(M.allfilters);V(M.localfilters)}U.call(undefined,M)}})}else{U.call(undefined,M)}},displayAllForTypeAttribut:function(L){if(z.is(L)&&z.is(L["ds6w:what/ds6w:type"])){var M=this.getCollection().getTaggerProxy();if(M!==null){M.toggleDisplayAll(true)}}},onOpenTagger:function(L){y.options.search_settings.taggerClosed=false},onCloseTagger:function(L){y.options.search_settings.taggerClosed=true},onCriteriaChange:function(M){if(this.skeleton){var L=this.skeleton.getAdvSearchMgr();if(z.is(L)){L.handleCriteriaChange(M)}}},onPLMUpdate:function(M){if(this.skeleton){var L=this.skeleton.getAdvSearchMgr();if(z.is(L)){L.handlePLMCriteriaChange(M)}}},OnSuggestUpdate:function(M){if(this.elements&&this.skeleton){var L=this.skeleton.getAdvSearchMgr();if(z.is(L)){L.handleTypeSuggestListChange(M)}}},_extractFTSFromFilter:function(Q){var P=this;if(!z.is(Q)){return}if(!z.is(Q.allfilters)){return}var L={new_filter:{allfilters:{}},search_criteria:"",search:Q.search,source:[]};if(P._isIncontextSourceHidden()==false&&P._adv_search&&!Q.localfilters.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")&&!Q.allfilters.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")){return L}var O=null;for(var N in Q.allfilters){if(N.indexOf("sixw:fts_value")!==0){if(N==="sixw:ds6w:where/ds6w:source/ds6w:dataSource"){var R=Q.allfilters[N];for(var M=0;M<R.length;M++){if(M==0){L.source=[]}L.source.push(R[M].object)}}else{if(N==="ds6w:where/ds6w:source/ds6w:dataSource"){if(M==0){L.source=[]}L.source=Q.allfilters["ds6w:where/ds6w:source/ds6w:dataSource"][0].object}else{L.new_filter.allfilters[N]=Q.allfilters[N]}}}else{var R=Q.allfilters[N];for(var M=0;M<R.length;M++){if(0===M){if(1<R.length){L.search_criteria="("}}if(0<M){L.search_criteria+=" OR "}L.search_criteria+=R[M].object;if(R.length===(M+1)){if(1<R.length){L.search_criteria+=")"}}}}}return L},getCollection:function(){if(this.skeleton){return this.skeleton.getCollection()}},setShadings:function(L){this.getSNSkeleton().setShadings(L)},getItemsId:function(){var L=this.getCollection();if(L){return L.pluck("id")}},dispatchInContextSelection:function(O,L){var N=this;var Q=this.getOption("in_apps_search");if(y.getOption("search_web_in_win")===true){N._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onInContextAction",notif_parameters:JSON.stringify({action:L,selected_ids:N._selected_objects.pluck("id")})},O)}else{if(N._searchcom_socket){if(O&&N._selected_objects){(N._selected_objects.size())?N._searchcom_socket.dispatchEvent("Selected_Objects_search",N._selected_objects.toArray(),O):N.log("No object selected")}N._searchcom_socket.dispatchEvent("clearSearch",{destroy:true});if(!z.is(Q.closeTransient)||true===Q.closeTransient){N._searchcom_socket.dispatchEvent("closeTransient",{command_id:L})}}if(z.is(N.getOption("addinMode"),"string")&&N._selected_objects){if(N._selected_objects.size()>=N.getInContextMinSelect()){var M=a.buildCompassSelectionData({widgetId:N.getOption("widget_id"),selectedModels:N._selected_objects.toArray()});var P=JSON.stringify({event:"search_in_context_OK",source:M.source,version:M.version,content:M});N.log("publishing webinwin:web:notification SELECTION event, data:"+P);m.publish("webinwin:web:notification",P)}else{throw new Error("OK event fired without a selection !")}}}if(N._searchcom_socket&&O){N._searchcom_socket.dispatchEvent("InContextSearch_Response",{selected_data:a.buildCompassSelectionData({selectedModels:N._selected_objects.toArray()}),selected_objects:N._selected_objects?N._selected_objects.toArray():[],search_params:N.getCollection().service_parameters,selected_command:"in_app_ok"},O)}if(z.is(N._taggerProxy)){if(z.is(N._taggerProxy.clearLocalFilter,"function")){N._taggerProxy.clearLocalFilter()}N._taggerProxy.unsetTags()}},_rebuildSkeleton:function(L){this.log("_rebuildSkeleton");if(this.skeleton){this.skeleton.stopListening();this.skeleton.destroy();delete this.skeleton}this._search_criteria="";this._originalSearchCriteria="";this._selected_objects=new b();this._adv_search=false;this._advanced_criteria="";this._ok_Button=null;this._apply_Button=null;this._adv_search_field=null;this.onesearch_indexedtimeIcon=null;if(z.is(this.indexedtimeMenu)){if(z.is(this.indexedtimeMenu.destroy,"function")){this.indexedtimeMenu.destroy()}this.indexedtimeMenu=null}this._isMultiSelModeOnTouch=false;this._historySearch=null;this._headersSearch=null;this._idWaitLoading=null;if(this.elements.container){this.elements.container.remove()}this.elements.container=null;this._buildSkeleton(L)},_buildSkeleton:function(X){this.log("_buildSkeleton");var R=this,T=this.getOption("in_apps_search"),Q=false;if(z.is(T,"object")&&T.mode==="furtive"){Q=true}if(!z.is(this.elements.container)){var L=this.getClassNames();L.replace(" ","_");this.elements.container=UWA.createElement("div",{"class":this.getClassNames(),"data-rec-id":L})}var V=R.elements.container;var M=false;var P=R.getSearchWidget();if(P&&z.is(P.getView,"function")){if(z.is(P.getView().previous)&&z.is(P.getView().previous.type)&&P.getView().previous.type==="windowed"){M=true}else{if(z.is(P.getView().type)&&P.getView().type==="sidepanel"){M=true}}}if(z.is(T)){M=false}var O=false;if(I.getItem("nav_history")&&M===true){O=true;if(!I.getItem("integratedSearch")&&P){P.context="transient"}var S=R.getOption("pinToDashboard");if(S===true||S===undefined){}R.elements.containerContent=new UWA.Element("div",{"class":"searchContainer","data-rec-id":"searchContainer",});R.elements.containerContent.inject(R.elements.container);if(R._historySearch===null){R.elements.containerHistory=new UWA.Element("div",{"class":"history-div","data-rec-id":"history-div",styles:{display:"none"}});R.elements.containerHistory.inject(R.elements.containerContent,"bottom");R._historySearch=new J();R._historySearch.addEvent("onSelected",R.onhistorySearchSelect.bind(R))}R.elements.containerProduct=new UWA.Element("div",{"class":"product-div","data-rec-id":"product-div",styles:{display:"none",height:"100%"}});R.elements.containerProduct.inject(R.elements.containerContent);R.elements.containerRelational=new UWA.Element("div",{"class":"relational-div","data-rec-id":"relational-div",styles:{display:"none",height:"100%"}});R.elements.containerRelational.inject(R.elements.containerContent);V=R.elements.containerContent}var W=false;if(I.getItem("integratedSearch")&&V){V.addClassName("sideSearch");W=this.getOption("pinToDashboard");if(this.getOption("pinToDashboard")===undefined){var N=P.getValue("launch_mode");if(N===e.widgetLaunchMode.COMPASS_TRANSIENT||N===e.widgetLaunchMode.COMPASS_PINNED||N===e.widgetLaunchMode.INCONTEXT_TRANSIENT){W=false}}}if(z.is(this.skeleton)&&z.is(this.skeleton.destroy)){this.skeleton.destroy()}this.skeleton=new k({messagingChannel:R.getMessagingChannel(),renderTo:V,observable:this,resources:this._resources,tagger_proxy:this._taggerProxy,in_apps_search:T,furtive:Q,events:X.events,source:X.source,widgetId:this.getOption("widget_id"),transient_context:this.getOption("transient_context"),use_preexisting_call:this.getOption("use_preexisting_call"),viewData:this.getOption("viewData"),pinToDashboard:W,navHistory:O,addinMode:this.getOption("addinMode"),idWaitLoading:this._idWaitLoading});var U=this.getOption("transient_context");if(Q){this._createFurtiveControls()}if(I.getItem("nav_history")){R.getSNSkeleton().addEvent("onExploreAction",R.onExploreAction.bind(R));R.getSNSkeleton().addEvent("onFedSearchComplete",R.onAddSearchBox.bind(R));R.getSNSkeleton().addEvent("selected_obj",R.onSelected_obj.bind(R))}},_createFurtiveControls:function(){this.log("_buildSkeleton: furtive mode activated");var L=this;var O=this.getOption("in_apps_search");var N=O.app_socket_id;var P=false;var M="Apply";if(z.is(O,"object")&&O.showApplyButton===true){P=true}if(z.is(O,"object")&&O.applyButton_Nls){M=O.applyButton_Nls}require(["DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Button"],function(S,U){function R(Y){if(y.getOption("search_web_in_win")===true){L._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onInContextAction",notif_parameters:JSON.stringify({action:"in_app_cancel"})},Y)}else{if(L._searchcom_socket){L._searchcom_socket.dispatchEvent("clearSearch",{destroy:true});if(!z.is(O.closeTransient)||true===O.closeTransient){L._searchcom_socket.dispatchEvent("closeTransient",{command_id:"in_app_cancel"})}}if(z.is(L.getOption("addinMode"),"string")){var X=JSON.stringify({event:"search_in_context_CANCEL",source:e.SEARCH_APP_ID,version:"1.0",content:{}});L.log("publishing webinwin:web:notification search_in_context_CANCEL event, data:"+X);m.publish("webinwin:web:notification",X)}}if(Y){L._searchcom_socket.dispatchEvent("InContextSearch_Response",{selected_objects:L._selected_objects.toArray(),search_params:L.getCollection().service_parameters,selected_command:"in_app_cancel"},Y)}if(z.is(L._taggerProxy)){if(z.is(L._taggerProxy.clearLocalFilter,"function")){L._taggerProxy.clearLocalFilter()}L._taggerProxy.unsetTags()}}var V=new U({id:"id_in_app_cancel",value:G.get("CancelButton"),className:"default in_app_search_btn",events:{onClick:function(Y,X){R(N)}}}).inject(L.elements.container,"bottom");if(P){var Q=new U({id:"id_in_app_apply",value:G.get("APPLYButton"),className:"default in_app_search_btn",disabled:true,events:{onClick:function(Y,X){L.dispatchInContextSelection(N,"in_app_apply")}}}).inject(L.elements.container,"bottom");new v({position:"top",target:Q.getContent(),body:M})}var T=true;if(O.furtive_options&&O.furtive_options.min_select===0){T=false}var W=new U({id:"id_in_app_ok",value:G.get("OKButton"),className:"default in_app_search_btn primary",disabled:T,events:{onClick:function(Y,X){L.dispatchInContextSelection(N,"in_app_ok")}}}).inject(L.elements.container,"bottom");L._ok_Button=W;if(P){L._apply_Button=Q;Q.disable()}W.setDisabled(T)});L.elements.container.classes=L.elements.container.classes},_removeAdvancedFiltersFromTagFilter:function(L){var N=this;if(!z.is(L)){return L}if(!z.is(L.allfilters)){return L}var O={allfilters:{}};for(var M in L.allfilters){O.allfilters[M]=L.allfilters[M]}if(z.is(L.localfilters)){for(var M in L.localfilters){if(!z.is(O.localfilters)){O.localfilters={}}O.localfilters[M]=L.localfilters[M]}}if(N._adv_search&&z.is(L.localfilters)&&((L.localfilters.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")&&Object.keys(L.localfilters).length==1)||Object.keys(L.localfilters).length==0)){if(UWA.is(N._taggerProxy)&&UWA.is(N._taggerProxy.clearLocalFilter,"function")){N._taggerProxy.clearLocalFilter()}}return O},_getSearchCriteriaForAdvancedFilters:function(L,M){if(!z.is(L)){return M}if(!z.is(L.allfilters)){return M}return D.from_filters_to_uql(L.allfilters,M)},_toggleProxyFocus:function(L){if(z.is(this._taggerProxy)&&y.getOption("proxy_button_available")===true){var M=this._taggerProxy._attributes.widgetId;if(M===L.widgetId&&(["iphone","ipad","android"].indexOf(e.getDeviceCategory())===-1)&&y.options.search_settings.taggerClosed!=true){this._taggerProxy.toggleProxyFocus(L.maximized)}}},setTitle:function(M){var L=this.getSNSkeleton();if(z.is(L)){L.setTitle(M)}},getSNSkeleton:function(){var L;if(z.is(this.skeleton)){L=this.skeleton}return L},updateSelectionNumber:function(L){var Q=this.getSNSkeleton();if(!z.is(Q)){throw new Error("No skeleton in SNResultMgt.updateSelectionNumber !")}if(!z.is(this.onesearch_selectionNumber)){var N=y.getOption("search_compact_mode");if(z.is(N)&&N===false){if(z.is(this._detailsviewSelected)){if(L.number>0){this._detailsviewSelected.setStyle("display","flex");var O=this._detailsviewSelected.getElement(".set-detail-view-select");if(z.is(O)){O.setText(L.number)}}else{this._detailsviewSelected.setStyle("display","none")}}}return}this.onesearch_selectionNumber.style.display=(this._isMultiSelModeOnTouch||(L.number>0&&Q._selectionMode_techno==="nullToMany"))?"inline":"none";this.onesearch_selectionNumber.innerHTML=L.number;if(!L.isMultiSelMode&&L.number<=1&&!this._isMultiSelModeOnTouch){this.onesearch_selectionNumberDiv.style.color="rgb(180, 182, 186)"}else{if(this._isMultiSelModeOnTouch){this.onesearch_selectionNumberDiv.style.color="#368ec4"}}var P=Q.getOption("in_apps_search");var M=P&&P.UXOptions&&!P.UXOptions.localActions;(((L.isMultiSelMode)||Q._selectionMode_techno==="nullToMany")&&!M)?this.onesearch_globalDropdownIcon.style.display="inline":this.onesearch_globalDropdownIcon.style.display="none"},getSearchContentSetHeader:function(){return this._contentSetHeader},_injectRecentStuff:function(M){var U=this,R=this.getSNSkeleton();if(y.getOption("show_last_indexation_time")===true){this.elements.recentcontent=UWA.createElement("div",{"class":"onesearch_recentcontent","data-rec-id":"onesearch_recentcontent"});this.elements.recentcontent.inject(M);this.onesearch_indexedtimeIcon=UWA.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock","data-rec-id":"SNResultMgt_wux-ui-3ds_wux-ui-3ds-1x_wux-ui-3ds-clock",styles:{fontSize:"24px",}}).inject(this.elements.recentcontent);var S=y.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()});var N=G.replace(G.get("switchToRecentContent"),{recentDelta:S});this.onesearch_indexedtimeIcon.tooltip=new v({position:"bottom",target:this.elements.recentcontent,body:N});var T={},Q={},O={};if(e.isODTMode()){T={"data-rec-id":"recentMenu"};Q={"data-rec-id":"recent"};O={"data-rec-id":"allRecent"}}T.style="max-width: 600px;";Q.style="white-space: normal;";var L,P;var V=this.getOption("in_apps_search");if(z.is(V)&&z.is(V.recent_search)&&z.is(V.recent_search.types)&&V.recent_search.types.length>0){L=G.get("searchInMyRecentContentInContext");P=G.get("displayAllMyRecentContentInContext")}else{L=G.get("searchInMyRecentContent");P=G.get("displayAllMyRecentContent")}this.indexedtimeMenu=R.indexedtimeMenu=new l({className:"search_recent_container",target:this.elements.recentcontent,items:[{id:"last_index",text:G.replace(G.get("lastIndexedTimeTooltip"),{indexTime:G.get("indexTimeNotAvailable")}),className:"header",attributes:{style:"text-transform: none;"}},{id:"warning",name:"warning",className:"header",text:G.get("warningIndexed"),attributes:{style:"text-transform: none; display: none;"}},{id:"divider",className:"divider"},{id:"my_recent",name:"my_recent",text:L,fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search",selectable:true,attributes:Q},{id:"all_my_recent",name:"all_my_recent",text:P,fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search",selectable:true,attributes:O}],attributes:T,events:{onClick:function(Z,Y){if(U._taggerProxy){U._taggerProxy.deactivate()}var W=U.getOption("search_options")||{};if(U._adv_search===true){var X=R.getAdvSearchMgr();if(z.is(X)&&z.is(X.hideAdvancedSearchTab,"function")){X.hideAdvancedSearchTab()}}if(Y.name==="my_recent"){if(R._myDatagridView&&R._myDatagridView._model){R._myDatagridView._model.getXSO().empty()}R.getCollection().reset();U._searchcom_socket.dispatchEvent("onSearchModeSwitch",{new_mode:e.SearchTypeEnum.MY_RECENT_CONTENT,paramsFilter:W.search_criteria_to_display?W.search_criteria_to_display:this.last_search_criteria});if(W.search_criteria_to_display){this.last_search_criteria=W.search_criteria_to_display}if(y.getOption("search_web_in_win")===true){W.search_criteria=e.SearchTypeEnum.MY_RECENT_CONTENT;W.recent_filter=W.originalSearchCriteria;R._searchActions.dispatchEvent("onRefreshResultRequest")}}else{if(Y.name==="all_my_recent"){if(V){a._displayAlert({message:G.get("IncontextRecentWarning"),className:"success"})}if(e.SearchTypeEnum.MY_RECENT_CONTENT==W.search_criteria){if(window.hasOwnProperty("sendNotificationWebInWin")&&z.is(sendNotificationWebInWin,"function")){sendNotificationWebInWin("UpdateSearchField",JSON.stringify({search_criteria:e.SearchTypeEnum.MY_RECENT_CONTENT,search_mode:"index"}))}else{U._searchcom_socket.dispatchEvent("onRefreshSearchField","")}R.getCollection().filterSearch({recent_filter:"*"});W.recent_filter="*"}else{if(R._myDatagridView&&R._myDatagridView._model){R._myDatagridView._model.getXSO().empty()}R.getCollection().reset();U._searchcom_socket.dispatchEvent("onSearchModeSwitch",{new_mode:e.SearchTypeEnum.MY_RECENT_CONTENT,paramsFilter:"*"});if(y.getOption("search_web_in_win")===true){W.search_criteria=e.SearchTypeEnum.MY_RECENT_CONTENT;W.recent_filter="*";W.adv_search=false;W.advanced_criteria="";R._searchActions.dispatchEvent("onRefreshResultRequest");if(window.hasOwnProperty("sendNotificationWebInWin")&&z.is(sendNotificationWebInWin,"function")){sendNotificationWebInWin("UpdateSearchField",JSON.stringify({search_criteria:"#myRecentContent"}))}}}}}U.onesearch_indexedtimeIcon.className=Y.fonticon},onShow:function(){if(U.onesearch_indexedtimeIcon.className.indexOf("wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock")!==-1){var W=true;switch(U._getSearchType()){case e.SearchTypeEnum.MY_CONTENT:case e.SearchTypeEnum.ADVANCED_SEARCH:case e.SearchTypeEnum.FAVORITE_SEARCH:W=false;break}this.items.forEach(function(X){X.selected=false;X.elements.container.removeClassName("selected");if(z.is(X)&&"my_recent"===X.name){X.elements.container.setStyle("display","inline-block");if(W===false){X.elements.container.setStyle("display","none")}else{var Z="",Y=U.options.search_options.originalSearchCriteria;if(z.is(V)&&z.is(V.recent_search)&&z.is(V.recent_search.types)&&V.recent_search.types.length>0){Z=G.replace(G.get("searchInMyRecentContentInContext"),{searchCriteria:Y})}else{Z=G.replace(G.get("searchInMyRecentContent"),{searchCriteria:Y})}U.indexedtimeMenu.updateItem({id:U.indexedtimeMenu.items[3].id,text:Z})}}})}}}});R.indexedtimeIcon=this.onesearch_indexedtimeIcon}this.getSNSkeleton()&&this.getSNSkeleton().updateByUXOptions&&this.getSNSkeleton().updateByUXOptions(G.get("indexTimeNotAvailable"))},setSearchContentSetHeader:function(af){var U=this,R=this.getSNSkeleton();if(!z.is(R)){throw new Error("No skeleton in SNResultMgt.updateSelectionNumber !")}if(!z.is(af)){console.error("Unexpected error in setSearchContentSetHeader invalid iContentSetHeader !")}var S=y.getOption("search_compact_mode");if(z.is(S)&&S===true){af.setStyle("padding-left","0px");af.setStyle("padding-right","0px");af.setStyle("border-bottom","1px solid #d1d4d4");var W=af.getElement(".set-actions");if(z.is(W)){W.setStyle("display","none");U.elements.onesearchbacksearch=UWA.createElement("div",{"class":"onesearch_action_back_search",styles:{order:0},});U.elements.onesearchbacksearch.inject(af);var ae=UWA.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-chevron-left ",styles:{fontSize:"24px",display:"none"}}).inject(U.elements.onesearchbacksearch);var P=new v({position:"bottom",target:ae,body:G.get("InfoPanel.back")});U.elements.onesearchbacksearch.tooltipActionsback=P;U.elements.onesearchbacksearch.back=ae}}var ac=e.isInTheSimpleSearch({tenant:U._resources.active_tenant});var Z=I.getItem("NoindexOnBar");var X=I.getItem("NomultiSelection");var aj=I.getItem("NoSort");var ad=U.getOption("swymContext");if(ac===true||ad===true){if(X===true){af.setStyle("height","0px")}if(Z===true||ad===true){if(z.is(af.getElement(".set-multiselHeader"))){af.getElement(".set-multiselHeader").setStyle("height","0px")}}if(aj===false){var ai=6;if(z.is(S)&&S===true){ai=4}this.elements.sortcontent=UWA.createElement("div",{"class":"onesearch_sortcontent","data-rec-id":"onesearch_sortcontent",styles:{order:ai}});this.elements.sortcontent.inject(af);this.sortPanelView=new B({container:this.elements.sortcontent,collection:this.getCollection(),widgetId:this.getOption("widget_id"),messagingChannel:this.getMessagingChannel()})}if(true!==ad){var V=true;if(ac===true){V=false}if(z.is(S)){V=true;if(S===true){V=false}}if(V===true){this._injectRecentStuff(af)}}var ag=U.getOption("search_options");if(this._forceOnSearch&&z.is(ag)){this._forceOnSearch=false;this.onSearch(ag)}af.removeClassName("search_compact_mode");if(z.is(S)&&S===false){U.elements.onesearchactions=UWA.createElement("div",{"class":"onesearch_action",styles:{order:8,height:"40px",width:"30px"},});U.elements.onesearchactions.inject(af);var L=UWA.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-chevron-down ",styles:{fontSize:"24px","align-self":"center","margin-left":"-5px"}}).inject(U.elements.onesearchactions);var N=new v({position:"bottom",target:U.elements.onesearchactions,body:G.get("OneSeachActions")});U._oneSearchActions=new n({container:U.elements.onesearchactions,collection:U.getCollection(),searchActions:U.skeleton.getSearchActions(),messagingChannel:U.getMessagingChannel()});U._oneSearchActions.tooltip=N;af.addClassName("search_compact_mode");U._detailsviewSelected=UWA.createElement("div",{"class":"container-selectCount",styles:{order:0,display:"none"},});U._detailsviewSelected.inject(af);var Y=UWA.createElement("span",{"class":"set-detail-view-select",id:"search-multisel-count"}).inject(U._detailsviewSelected);var T=UWA.createElement("span",{"class":"set-detail-view-of"}).inject(U._detailsviewSelected);T.setText(G.get("setdetailviewof"))}if(z.is(S)&&S===true){U.elements.onesearchactionspreview=UWA.createElement("div",{"class":"onesearch_action_preview",styles:{order:3},});U.elements.onesearchactionspreview.setStyle("visibility","hidden");U.elements.onesearchactionspreview.inject(af);var ae=UWA.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-chevron-left ",styles:{fontSize:"24px",}}).inject(U.elements.onesearchactionspreview);U.elements.onesearchactionspreview.preview=ae;var aa=new v({position:"bottom",target:ae,body:G.get("InfoPanel.Previous")});U.elements.onesearchactionspreview.tooltipActionspreview=aa;var ah=UWA.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-chevron-right ",styles:{fontSize:"24px",}}).inject(U.elements.onesearchactionspreview);U.elements.onesearchactionspreview.next=ah;var M=new v({position:"bottom",target:ah,body:G.get("InfoPanel.Next")});U.elements.onesearchactionspreview.tooltipActionsnext=M;U.elements.onesearchactionspreview.back=U.elements.onesearchbacksearch.back;W=af.getElement(".set-detail");if(z.is(W)){U.elements.onesearchactionspreview.count=W}}return}U._contentSetHeader=af;UWA.Element.addEvent.call(U._contentSetHeader,"contextmenu",function(al){if(typeof dscef!=="undefined"){var ak=dscef.getEnv("CATCEF_DEVTOOLS");if(ak.length===0){al.preventDefault()}}});this._injectRecentStuff(af);var Q=y.getOption("neverCheckbox");if(!(z.is(Q)&&(true===Q))){this.onesearch_selectionNumberDiv=UWA.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-select-on","data-rec-id":"SNResultMgt_wux-ui-3ds_wux-ui-3ds-1x_wux-ui-3ds-select-on",styles:{fontSize:"22px",color:"#b4b6ba",marginRight:"0.1em",lineHeight:"40px"},events:{touchstart:function(ak){this.isTouchable=true},click:function(al){var ak=document.querySelector("html .touch")||this.isTouchable;if(ak){var am=U.getSNSkeleton()._model.getXSO().get();U._isMultiSelModeOnTouch=!U._isMultiSelModeOnTouch;if(!U._isMultiSelModeOnTouch){U._searchcom_socket.dispatchEvent("toggleMultiSelMode",false)}else{U._searchcom_socket.dispatchEvent("toggleMultiSelMode",true)}}}}}).inject(af.getElement(".set-multiselHeader"));this.onesearch_selectionNumber=UWA.createElement("span",{id:"search-multisel-count","data-rec-id":"search-multisel-count",styles:{fontSize:"15px",padding:"0 5px",color:"currentColor",display:"none"}}).inject(this.onesearch_selectionNumberDiv)}var ab=R.getOption("in_apps_search");var O=ab&&ab.UXOptions&&!ab.UXOptions.localActions;if(!(z.is(Q)&&(true===Q))){this.onesearch_globalDropdownIcon=UWA.createElement("span",{"class":"fonticon fonticon-2x fonticon-down-open","data-rec-id":"SNResultMgt_fonticon_fonticon-2x_fonticon-down-open",id:"search-multisel-dropdown",styles:{color:"#b4b6ba",display:(O||R._selectionMode_techno==="oneToOne")?"none":"inline",margin:"0",cursor:"pointer"},events:{click:function(ak){if(z.is(R)){R.launchGlobalDropdown()}}}}).inject(af.getElement(".set-multiselHeader"))}this.elements.sortcontent=UWA.createElement("div",{"class":"onesearch_sortcontent","data-rec-id":"onesearch_sortcontent",styles:{order:6}});this.elements.sortcontent.inject(af);this.sortPanelView=new B({container:this.elements.sortcontent,collection:this.getCollection(),widgetId:this.getOption("widget_id"),messagingChannel:this.getMessagingChannel()});var ag=U.getOption("search_options");if(this._forceOnSearch&&z.is(ag)){this._forceOnSearch=false;this.onSearch(ag)}},refreshSearch:function(){var M=z.clone(this.options.search_options);if(z.is(M)){if(this._historySearch){if(z.is(L.elements.containerProduct)){L.elements.containerProduct.empty()}if(z.is(L.elements.containerRelational)){L.elements.containerRelational.empty()}this._historySearch.cleanAll()}M.refresh=true;this.onSearch(M)}var L=this;L.HideInformationLightboxPanel()},hideAdvancedSearch:function(){if(this.skeleton){var L=this.skeleton.getAdvSearchMgr();L.hideAdvancedSearchTab()}},showAdvancedSearch:function(Y){if(!z.is(Y)||!z.is(Y.widgetId)){return}var R=this;var P=R.getOption("widget_id");if(z.is(P)&&P!==Y.widgetId){return}this._adv_search_field=null;if(this.skeleton){var V=this.skeleton.getAdvSearchMgr();if(!z.is(V)||!z.is(V.getAndDisplayAdvancedSearch,"function")){throw ("Error in showAdvancedSearch !")}var U=true;var Q=true;var O=null;var M=null;var T=this.getCollection().getTaggerProxy();var N=T.getCurrentFilter();if(z.is(N)){O=N.allfilters}if(z.is(T)&&z.is(N)&&z.is(O)){if(Object.keys(O).length!==0){if(z.is(Y)&&z.is(Y.adv_search_field)&&z.is(Y.adv_search_field,"string")||(Object.keys(O).length==1&&(O.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")||O.hasOwnProperty("ds6w:where/ds6w:source/ds6w:dataSource")))){V.clearFilters();V.getAndDisplayAdvancedSearch(true)}else{var X=this.getOption("in_apps_search");if(!X||V._fieldsToSet){Q=false}}}}if(this._originalSearchCriteria===e.SearchTypeEnum.ADVANCED_SEARCH){if(!Q){U=false}}else{if(!Q&&z.is(T.clearLocalFilter,"function")){T.clearLocalFilter()}V.getAndDisplayAdvancedSearch(true,Y)}if(!Q){V.getAndDisplayAdvancedSearchWithProxyFilterSettings()}else{V._adv_search_field=null;if(z.is(Y)&&z.is(Y.adv_search_field)&&z.is(Y.adv_search_field,"string")){var S=["3dspace"];this._adv_search_field=Y.adv_search_field;V._adv_search_field=Y.adv_search_field}V.getAndDisplayAdvancedSearch(true,Y)}if(U){var X=this.getOption("in_apps_search");if(!X){var L=this.getSNSkeleton();if(L){L.getCollection()._resetState();L.getCollection().reset();L.getCollection().initTreeDocument();L._updateWidgetTitleWithNbResult()}}var W={search_criteria:"#advancedSearch",adv_search:true,recent_filter:"*",source:[],search_mode:"index",tag_filter:"",refresh:false};this.onSearch(W)}}},manageinformationPanel:function(N){var M=this;var L=null;L=(z.is(this.getOption("getContainer"),"function"))?(this.getOption("getContainer")).call():z.extendElement(document.body);if(z.is(L)){var Q=null;if(I.getItem("nav_history")){if(L.parentElement){Q=L.parentElement.getElement(".searchHeaderCmd_content")}}else{Q=L.getElement(".search-content-set-container")}if(Q!==null){var P=N;var O=M.getSearchWidget();if(z.is(O)){if(!z.is(P)){P=O.getValue("informationPanelState"+M.getTabID())}if(P===true){Q.addClassName("informationPanel_Icon");O.setValue("informationPanelState"+M.getTabID(),true)}else{Q.removeClassName("informationPanel_Icon");O.setValue("informationPanelState"+M.getTabID(),false)}}}}},managepreviewPanel:function(N){var L=null;var M=this;L=(z.is(this.getOption("getContainer"),"function"))?(this.getOption("getContainer")).call():z.extendElement(document.body);if(z.is(L)){var Q=null;if(I.getItem("nav_history")){if(L.parentElement){Q=L.parentElement.getElement(".searchHeaderCmd_content")}}else{Q=L.getElement(".search-content-set-container")}if(Q!==null){var O=M.getSearchWidget();var P=M.getSNSkeleton();if(z.is(P)){if(N!==P._previewState){I.setItem("previewDefautActivateState",N);I.commit()}P._previewState=N}if(N===true){Q.addClassName("previewPanel_Icon")}else{Q.removeClassName("previewPanel_Icon")}}}},managehistoryPanel:function(N){var O=this;var R=null;var Q=O.getSearchWidget();var M;var Q=O.getSearchWidget();if(!z.is(Q)){return}R=z.extendElement(Q.elements.body).getElement(".searchHeaderCmd_content");M=z.extendElement(Q.elements.body).getElement(".history-div");if(R===null){var L=null;L=(z.is(this.getOption("getContainer"),"function"))?(this.getOption("getContainer")).call():L=z.extendElement(document.body);if(z.is(L)&&L.parentElement){R=L.parentElement.getElement(".searchHeaderCmd_content")}}var P=false;P=Q.getValue("navigationHistoryState"+O.getTabID());if(R!==null){if(N===true){if(P===false||P===undefined){R.addClassName("navigationHistory_Icon");if(N===true){Q.setValue("navigationHistoryState"+O.getTabID(),true)}if(z.is(M)){M.setStyle("display","inline-block")}if(P===undefined&&O._historySearch){O._historySearch.render(M)}}else{R.removeClassName("navigationHistory_Icon");if(N===true){Q.setValue("navigationHistoryState"+O.getTabID(),false)}if(z.is(M)){M.setStyle("display","none")}}}else{if(P===true){if(O._historySearch){O._historySearch.render(M)}R.addClassName("navigationHistory_Icon");if(z.is(M)){M.setStyle("display","inline-block")}}else{R.removeClassName("navigationHistory_Icon");if(z.is(M)){M.setStyle("display","none")}}}}},HideInformationLightboxPanel:function(){var M=this;var N=M.getSNSkeleton();if(N!==null){if(N._informationPanel!==null){var L=N._informationPanel.getvisibleFlag();if(L===true){N._informationPanel.activate_deactivateNoPreview(true);N._informationPanel.setInfomationPanelObject(null)}}if(N._lightBoxView!==null){var L=N._lightBoxView._LightBoxPanel.visibleFlag;if(L===true){L=N.ActivateDeactivatePreviewPanel();M.managepreviewPanel(L)}}}},getSearchWidget:function(){var M=this;var N;var L=M.getOption("widget_id");if(z.is(L)&&z.is(UWA.Widgets)&&z.is(UWA.Widgets.instances)){UWA.Widgets.instances.forEach(function(O){if(O.id===L){N=O}})}return N},onhistorySearchSelect:function(L){var M=this;if(z.is(L)&&z.is(L.SNtype)&&z.is(M._historySearch)){if(L.SNtype==="Children"){M.getSNSkeleton()._searchActions.dispatchEvent("onDisplayRelations",L);e.setContentVisibility(L)}var N=function(){e.setContentVisibility("Search");var O=M.getSNSkeleton();if(O){O.getCollection()._resetState();O.getCollection().reset();O.getCollection().initTreeDocument();O._updateWidgetTitleWithNbResult()}if(z.is(M._taggerProxy.clearLocalFilter,"function")){M._taggerProxy.clearLocalFilter()}M._taggerProxy.unsetTags()};if(L.SNtype==="Search"&&z.is(L.searchParam)){e.setContentVisibility(L);L.searchParam.fromSearchHistory=true;M.onSearch(L.searchParam)}else{if(L.SNtype==="Explore"){e.setContentVisibility(L);M._historySearch.ShowContainers(L)}else{if(L.SNtype==="Relational"){e.setContentVisibility(L);M._historySearch.ShowContainers(L)}else{if(L.SNtype==="Select"){N();a.getRelations({model:L.model,onComplete:function(O){O.contextid=L.contextid;O.widgetAppId=L.widgetAppId;M._historySearch.stopCreation(false);M._historySearch.addRelationsModel(O)},onFailure:function(){M._historySearch.stopCreation(false)}})}else{if(L.SNtype===""){N()}}}}}}},onAddSearchBox:function(W){if(!z.is(W)){return}var T=this;if(z.is(T.options)&&z.is(T.options.search_options)){if(z.is(T._historySearch)){var R=T.options.search_options;var Q=true;var U=false;var L=false;if((z.is(R.fromSearchHistory)&&R.fromSearchHistory===true)){Q=false;T.options.search_options.fromSearchHistory=false;if(z.is(R.refineSearch)&&R.refineSearch===true){U=true;Q=true;T.options.search_options.refineSearch=false}}var N=T._taggerProxy.getCurrentFilter();if(z.is(N,"object")&&z.is(N.allfilters,"object")&&0<Object.keys(N.allfilters).length){L=true}if(Q===true){var S;var P=T.getSearchWidget();if(z.is(P)){S=P.context;if(I.getItem("integratedSearch")){var M=P.getValue("launch_mode");if(z.is(P.data)&&!z.is(P.data.pinToDashboard)){S="RightPanelContext"}if(M===e.widgetLaunchMode.COMPASS_TRANSIENT||M===e.widgetLaunchMode.COMPASS_PINNED||M===e.widgetLaunchMode.INCONTEXT_TRANSIENT){S=""}}}var V=R.search_criteria_to_display;if(V===undefined){if(R.search_criteria==="#myContent"){V=G.get("myContentTitle")}else{if(R.search_criteria==="#myRecentContent"){V=G.get("searchInMyRecentContent")}else{if(R.originalSearchCriteria==="#advancedSearch"){V=G.get("adv_search_launch")}else{if(R.search_criteria==="#favoriteSearches"){V=G.get("my_fav_searches")}else{V=R.search_criteria}}}}}var O={description:V+" "+W+" results",searchParam:z.clone(R),widgetAppId:T.getOption("widget_id"),contextid:S,refine:U,count:W,filter:L};T._historySearch.addSearchModel(O)}}}},onExploreAction:function(P){var R=this;if(z.is(R._historySearch)&&z.is(P)&&z.is(P.model)){var O=R.getSearchWidget();var M;if(z.is(O)){M=O.context}if(P.action_id==="whereUsed"){var N=P.model._attributes["ds6w:label"];var Q={description:N,widgetAppId:P.widgetAppId,contextid:M};var L=R._historySearch.addRelationalModel(Q);if(z.is(L)){P.historyNode=L}}else{if(P.action_id==="config_explore"){var N=P.model._attributes["ds6w:label"];var Q={description:N,widgetAppId:P.widgetAppId,contextid:M};var L=R._historySearch.addExploreModel(Q);if(z.is(L)){P.historyNode=L}}}}},onSelected_obj:function(){var O=this;if(z.is(O._historySearch)){var L={};var M=0;var N=null;if(z.is(arguments)){M=arguments.length;if(M===1){N=arguments[0]}}L.size=M;L.itemModel={};if(N!==null){L.itemModel.label=N.get("ds6w:label");L.itemModel.id=N.id;L.itemModel.model=N}O._addNavHistorySelectBox(L)}},_addNavHistorySelectBox:function(O){var S=this;if(z.is(S._historySearch)&&z.is(O)){var N=S.getSearchWidget();var L;if(z.is(N)){L=N.context}var R=null;var P=0;if(z.is(O.size)){P=O.size;if(P===1&&z.is(O.itemModel)){R=O.itemModel}}if(R!==null){var M=R.label;var Q={description:M,contextid:L,id:R.id,model:R.model,widgetAppId:S.getOption("widget_id")};if(S._historySearch.addSearchSelectModel(Q)!==undefined){S._historySearch.stopCreation(true);a.getRelations({model:R.model,onComplete:function(T){T.contextid=L;T.widgetAppId=S.getOption("widget_id");T.model.fromApp=true;T.model.displayName=M;S._historySearch.stopCreation(false);S._historySearch.addRelationsModel(T)},onFailure:function(){S._historySearch.stopCreation(false)}})}}else{if(P>1){S._historySearch.addSearchSelectModel(P)}else{S._historySearch.removeLastSelectNode()}}}},onPinToDashboardAction:function(){var O=this;var N=O.getSNSkeleton();if(!z.is(N)){return}var M=O.getSearchWidget();if(!z.is(M)){return}var L={widgetIdOrUrl:M.uwaUrl,widgetAppId:e.SEARCH_APP_ID,widgetTitle:N.getTitle(),widgetId:O.getOption("widget_id"),widgetData:M.data,success:function(){if(O._searchcom_socket){O._searchcom_socket.dispatchEvent("hideSidePanel")}}};e.pinToDashboard(L)},setActiveTenant:function(M){if(z.is(this._resources)&&z.is(this._resources.setActiveTenant,"function")){try{this._resources.setActiveTenant(M)}catch(L){console.log("SearchRessources.setActiveTenant throw !")}}},clearfilterbyclosesidepanel:function(){var L=this;if(z.is(L._taggerProxy)&&z.is(L._taggerProxy.clearLocalFilter,"function")){L._taggerProxy.clearLocalFilter()}},manageActionIconOnSidePanel:function(N){var O=this;if(!z.is(O.elements)||!z.is(O.elements.container)){return}var P=false;if(z.is(O.skeleton)){P=O.skeleton.getOption("transient_context")!=="true"&&O.skeleton.getOption("transient_context")!==true}if(P===true){return}var M=O.getSearchWidget();if(z.is(M)&&z.is(M.getView,"function")){if(z.is(M.getView().type)&&M.getView().type!=="sidepanel"){return}else{if(z.is(N)&&z.is(N.position)){var L=N.position;if(L==="fitted"||L==="maximized"){O.updateDimension(-1)}else{O.updateDimension()}}}}},navhistorycontextifcreateaNewTab:function(){var L=false;if(z.is(this._historySearch)){L=this._historySearch.navhistorycontextifcreateaNewTab()}return L},getOneSearchPreviewAction:function(){var L=null;if(z.is(this.elements)&&z.is(this.elements.onesearchactionspreview)){L=this.elements.onesearchactionspreview}return(L)}})});define("DS/SNResultUX/SearchTab",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Collection","DS/UIKIT/Mask","DS/SNInfraUX/SearchDebug","DS/Controls/TooltipModel","DS/SNResultUX/SNResultMgt"],function(c,b,d,h,e,a,g){var f=b.extend(e,{uwaClassName:"DS/SNResultUX/SearchTab",name:"onesearch_results_tab",_snResultMgt:null,_onActivateEvents:null,init:function(i){this._parent(i);this._onActivateEvents={}},destroy:function(){this._snResultMgt=null;this._onActivateEvents=null;this._parent();this.options=null},render:function(i){var k=this;h.mask(this.getOption("renderTo"));if(UWA.is(i,"object")){var j=null;if(UWA.is(i.events)&&UWA.is(i.events.onReady,"function")){j=UWA.clone(i.events.onReady)}i.getTabID=function(){return k.getTabID()};i.isTabBarVisible=function(){return k.getOption("wuxTabBar").visibleFlag};i.getTabOption=function(l){return k.getOption(l)};i.setTabOption=function(l,m){k.setOption(l,m)};i.getContainer=function(){return k.getOption("renderTo")},i.events.onReady=function(){k._snResultMgt=this;k.onActivate();k.setIcon(k._snResultMgt.getTabIcon());h.unmask(k.getOption("renderTo"));if(UWA.is(j)){j.call(this)}k.dispatchEvent("onTabReady")};i.events.onTitleUpdate=function(l){k.setTitle(l.tab_title);k.setTooltip(l.tab_tooltip);k.dispatchEvent("updateWidgetTitle",l.panelTitle);k.setOption("panelTitle",l.panelTitle)};this.elements.container=new g(i)}return this},setTitle:function(k){var j=this.getOption("wuxTab");var i=this.getOption("wuxTabBar");i.updateTab(j.value,{label:k})},getTabID:function(){var i=this.getOption("wuxTab");if(UWA.is(i)){return i.value}},setTooltip:function(k){var j=this.getOption("wuxTab");var i=this.getOption("wuxTabBar");if(!j.tooltipInfos){j.tooltipInfos=new a({shortHelp:"",mouseRelativePosition:true,isEmpty:function(){return this.shortHelp.length>0},allowUnsafeHTMLTitle:i.allowUnsafeHTMLOnTabButton,allowUnsafeHTMLShortHelp:i.allowUnsafeHTMLOnTabButton,allowUnsafeHTMLLongHelp:i.allowUnsafeHTMLOnTabButton})}else{j.tooltipInfos.shortHelp=k}},setIcon:function(j){var k=this.getOption("wuxTab");var i=this.getOption("wuxTabBar");i.updateTab(k.value,{icon:j})},setActiveTenant:function(i){if(this._snResultMgt){this._snResultMgt.setActiveTenant(i)}},getActiveTenant:function(){if(this._snResultMgt){return this._snResultMgt.getActiveTenant()}},getTabType:function(){},getTabView:function(){return this._snResultMgt},getTaggerProxy:function(){if(UWA.is(this._snResultMgt)){return this._snResultMgt._taggerProxy}},getAdvSearchMgr:function(){if(UWA.is(this._snResultMgt)&&UWA.is(this._snResultMgt.getSNSkeleton,"function")&&UWA.is(this._snResultMgt.getSNSkeleton().getAdvSearchMgr,"function")){return this._snResultMgt.getSNSkeleton().getAdvSearchMgr()}},showAdvancedSearch:function(i){if(UWA.is(this._snResultMgt)){return this._snResultMgt.showAdvancedSearch(i)}},hideAdvancedSearch:function(){if(UWA.is(this._snResultMgt)){return this._snResultMgt.hideAdvancedSearch()}},onActivate:function(){if(this._snResultMgt){this.getOption("renderTo").setContent(this._snResultMgt);this._snResultMgt.OnTabActivated();for(var i in this._onActivateEvents){switch(i){case"unsetShading":this._snResultMgt.setShadings([{color:"initial",criteria:function(){return true}}]);break;case"refresh":this.onRefresh();break}}delete this._onActivateEvents;this._onActivateEvents={}}var j=this.getOption("panelTitle");if(!UWA.is(j,"string")){j=this.getOption("wuxTab").label}this.dispatchEvent("updateWidgetTitle",j);this.dispatchEvent("onTabActivated");if(this._snResultMgt.getBAdvSearch()){this.showAdvancedSearch({widgetId:this._snResultMgt.getOption("widget_id"),adv_search_field:this._snResultMgt.getBAdvSearchField()})}},onDeactivate:function(){if(this._snResultMgt){this._snResultMgt.OnTabDeactivated()}},onRemoval:function(){if(this._snResultMgt){this._snResultMgt.OnTabRemoved()}},updateOnActivate:function(i){if(UWA.is(i,"object")){for(var j in i){this._onActivateEvents[j]=i[j]}}},setSensitivity:function(i){this.getOption("wuxTab").disabled=!i},onSearch:function(i){if(UWA.is(this._snResultMgt)){this._snResultMgt.onSearch(i);this.setIcon(this._snResultMgt.getTabIcon())}},onRefresh:function(){if(UWA.is(this._snResultMgt)){this._snResultMgt.refreshSearch()}},onKeyboardEvent:function(i){if(UWA.is(this._snResultMgt)){this._snResultMgt.onKeyboardEvent(i)}},navhistorycontextifcreateaNewTab:function(){var i=false;if(UWA.is(this._snResultMgt)){i=this._snResultMgt.navhistorycontextifcreateaNewTab()}return(i)}});return f});define("DS/SNResultUX/SNTabbedResultMgt",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Class/Collection","UWA/Class/Model","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","css!DS/SNResultUX/SNResultUX","DS/SNResultUX/SearchTab","DS/SNResultUX/views/SearchHeaderCmd","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/PredicatesNLS","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/Controls/TabBar","DS/SNInfraUX/SearchPreferences"],function(n,k,g,l,v,i,u,c,p,j,a,t,b,q,d,o,h,e,r){var m=i.extend({idAttribute:"tabID"});var f=k.extend(g,l,p,{uwaClassName:"DS/SNResultUX/SNTabbedResultMgt",name:"onesearch_tabbed_results",_tabContainer:null,_disableTabbedUI:false,_currentTabContent:null,_searchcom_socket:null,_tabs:null,_valueOfCurrentTab:null,_tabIDCounter:null,_first_search_COMPASS_TRANSIENT:null,_messagingChannel:null,_subscriptions:null,_keydownEventHandler:null,_headersSearch:null,init:function(x){this._parent(x);this._tabIDCounter=0;this._first_search_COMPASS_TRANSIENT=false;this._messagingChannel="3DSearch-TabManager-"+x.widget_id;this._subscriptions={};this._keyboardEventsSubscription=false;var A=this;this._searchcom_socket=c.createSocket({socket_id:"widget_tabMgt_"+this.getOption("widget_id"),widgetId:this.getOption("widget_id")});o.setResources({resources:new d(this.getOption("resources"))});var B=this.getOption("launch_mode");this._disableTabbedUI=(true!==r.getItem("search_tabbed_ui"))||(UWA.is(B,"string")&&(B===a.widgetLaunchMode.COMPASS_PINNED||B===a.widgetLaunchMode.PINNED||B===a.widgetLaunchMode.COMPASS_TRANSIENT||B===a.widgetLaunchMode.INCONTEXT_TRANSIENT));if(B!==a.widgetLaunchMode.PINNED&&B!==a.widgetLaunchMode.COMPASS_PINNED){this._subscribeToKeyboardEvents()}if(!n.is(this.elements.container)){var y=this.getClassNames();y.replace(" ","_");this.elements.container=UWA.createElement("div",{"class":this.getClassNames(),"data-rec-id":y,styles:{position:"relative",height:"100%"}});this.elements.container.addClassName(this.getOption("css_view_class"))}this._tabContainer=new e({displayStyle:["strip"],centeredFlag:false,newTabButtonFlag:true,editableFlag:false,multiSelFlag:false,reorderFlag:false,touchMode:true,closeButtonFlag:true,showComboBoxFlag:true,allowUnsafeHTMLOnTabButton:false});this._tabContainer._endEditTab=function(){};if(this.isTabBarVisible()){this._subscriptions.addTab=u.subscribe({channel:this.getMessagingChannel(),topic:"addTab",callback:this.addTab.bind(this)})}this._subscriptions.activateInContextSearch=u.subscribe({channel:this.getMessagingChannel(),topic:"activateInContextSearch",callback:this._onActivateInContextSearch.bind(this)});this._subscriptions.deactivateInContextSearch=u.subscribe({channel:this.getMessagingChannel(),topic:"deactivateInContextSearch",callback:this._onDeactivateInContextSearch.bind(this)});this._tabContainer.inject(this.elements.container);this._tabs=new v([],{model:m});this._currentTabContent=UWA.createElement("div",{styles:{position:"relative",height:"100%",width:"100%"}});this._currentTabContent.inject(this.elements.container);(true===this._disableTabbedUI)?this.hideTabBar():this.showTabBar();if(r.getItem("nav_history")===true){var z=this._tabContainer.getContent();if(z){var w=z.getElementsByClassName("wux-controls-tabBar-buttonsContainer");if(w!==null){A._headersSearch=new q();A._headersSearch.render(w[0]);A._headersSearch.addEvent("onInformationPanelAction",function(D){var F=A.getActiveTab();if(F&&F._snResultMgt!==null){var C=false;var E=F._snResultMgt.getSNSkeleton();C=E.ActivateDeactivateInformationsPanel();F._snResultMgt.manageinformationPanel(C)}});A._headersSearch.addEvent("onHistoryAction",function(C){var D=A.getActiveTab();if(D&&D._snResultMgt!==null){D._snResultMgt.managehistoryPanel(true)}})}}}this._registerTabEventHandlers()},destroy:function(){var B=undefined;var z=this._getTabView();if(UWA.is(z)){B=z.getOption("in_apps_search")}this._searchcom_socket.dispatchEvent("onCloseTransient",{in_apps_search:B});for(var y=0;y<this._tabs.length;y++){var w=this._tabs.at(y);var x=w.get("tab");x.destroy()}this._tabs.reset();this._tab=null;for(var A in this._subscriptions){u.unsubscribe(this._subscriptions[A])}this._unsubscribeToKeyboardEvents();if(a._isSearchWidgetTransientAvailable(this.getOption("widget_id"))===false){var C=this.getOption("css_view_class")==="windowed"?true:false;if(true===a.isTaggerOpenedByCode()&&false===C){this._searchcom_socket.dispatchEvent("closeTagger")}}this._searchcom_socket.disconnect();c.deleteSocket(this._searchcom_socket.id);this._tabContainer.destroy();this._tabContainer=null;this.options=null;this._parent()},getMessagingChannel:function(){return this._messagingChannel},addTab:function(x){var A=this._tabContainer.getTabCount();if(true===this._disableTabbedUI){if(A>1){throw new Error("tabbed UI is deactivated and a tab is asked to be created when a one already exists")}}var z=this;var w=this._generateTabID();if(A===0){this._valueOfCurrentTab=w}var y=this._tabContainer.add({label:UWA.is(x.tabTitle,"string")?x.tabTitle:"",isSelected:true,icon:{iconName:"search",fontIconFamily:1},allowClosableFlag:A===0?false:true,value:w});this._setMinmumTabWidth(y);this._addCommonOptions(x.search_ux_options);this._tabs.add(new m({tabID:w,tab:new b({wuxTab:y,wuxTabBar:z._tabContainer,renderTo:this._currentTabContent,events:{updateWidgetTitle:function(C){var B=z.getOption("updateTitle");if(UWA.is(B,"function")){B.call(undefined,C)}}}}).render(x.search_ux_options)}));return this.getTabByID(w)},_addCommonOptions:function(w){if(!UWA.is(w.widget_id)){w.widget_id=this.getOption("widget_id")}w.css_view_class=this.getOption("css_view_class");w.pinToDashboard=this.getOption("pinToDashboard");if(!UWA.is(w.resources)){w.resources=this.getOption("resources")}if(!UWA.is(w.source)){w.source=this.getOption("source")}if(!UWA.is(w.itemViewClickHandler)){w.itemViewClickHandler=this.getOption("itemViewClickHandler")}if(!UWA.is(w.update_preference)){w.update_preference=this.getOption("update_preference")}if(!UWA.is(w.tagger_context_id)){w.tagger_context_id=this.getOption("tagger_context_id")}w.addinMode=this.getOption("addinMode");w.transient_context=this.getOption("transient_context");w.use_preexisting_call=this.getOption("use_preexisting_call");w.swymContext=this.getOption("swymContext");if(true===w.swymContext){w.in_apps_search=this.getOption("in_apps_search")}},onSearch:function(w){if(a.widgetLaunchMode.COMPASS_TRANSIENT===this.getOption("launch_mode")){if(false===this._first_search_COMPASS_TRANSIENT){this._first_search_COMPASS_TRANSIENT=true;if(true===r.getItem("search_tabbed_ui")){this._disableTabbedUI=false;this.showTabBar();if(!UWA.is(this._subscriptions.addTab)){this._subscriptions.addTab=u.subscribe({channel:this.getMessagingChannel(),topic:"addTab",callback:this.addTab.bind(this)})}}}}if(n.is(w)&&n.is(w.addNewTab)&&w.addNewTab===true){var x=this;x.addTab({search_ux_options:{events:{onReady:function(){x.getActiveTab().onSearch(w)}}}})}else{this.getActiveTab().onSearch(w)}},onRefresh:function(){this.getActiveTab().onRefresh()},_onViewChange:function(w){if(n.is(w.previous)&&n.is(w.previous.type)){this.elements.container.removeClassName(w.previous.type)}this.elements.container.addClassName(w.type);if(w.type==="maximized"){this._subscribeToKeyboardEvents()}else{this._unsubscribeToKeyboardEvents()}},getActiveTab:function(){if(UWA.is(this._tabContainer)){return this.getTabByID(this._valueOfCurrentTab?this._valueOfCurrentTab:"3DSearch-tab-1")}},getTabByID:function(x){var w=this._tabs.get(x);if(UWA.is(w)){return w.get("tab")}},_generateTabID:function(){++this._tabIDCounter;return"3DSearch-tab-"+(this._tabIDCounter)},isTabBarVisible:function(){return this._tabContainer.visibleFlag},hideTabBar:function(){this._tabContainer.visibleFlag=false;this._tabContainer.elements.container.addClassName("hidden");if(UWA.is(this._currentTabContent)){this._currentTabContent.setStyle("height","100%")}},showTabBar:function(){if(false==this._disableTabbedUI){this._tabContainer.visibleFlag=true;this._tabContainer.elements.container.removeClassName("hidden")}var x=n.extendElement(this._tabContainer.getContent());var w=x.getBoundingClientRect();var y=44;if(UWA.is(w,"object")&&w.height>15){y=w.height}if(UWA.is(this._currentTabContent)){this._currentTabContent.setStyle("height","calc(100% - "+y+"px)")}},removeTab:function(w){this._tabContainer.removeTab(w);var x=this;setTimeout(function(){x._tabContainer.modelEvent.publish({event:"removeTab",data:{value:w,isUserInteraction:false}})},100)},_getTabView:function(w){var x=null;if(UWA.is(w,"string")){x=this.getTabByID(w)}else{x=this.getActiveTab()}if(UWA.is(x)){return x.getTabView()}},_getAllTabs:function(){if(UWA.is(this._tabs)){return this._tabs.toArray()}},_setMinmumTabWidth:function(x){var w=j.getOption("miminumTabWith");if(!UWA.is(w,"number")||w>300){w=100}x.minWidth=w},_onPreNewTabHandler:function(y){var z=this._tabContainer.getButtonFromValue(y.value);this._setMinmumTabWidth(z);var x=z.value;var w=this._generateTabID();z.value=w;z.label=h.get("newTabTitle");this._tabContainer.newTabButtonFlag=false},_onNewTabHandler:function(z){var y=this;var w=this._tabContainer.getValueByIndex(z.index);var A=this._tabContainer.getButtonFromValue(w);this._tabContainer.updateTab(w,{allowClosableFlag:true});var x={search_ux_options:{search_options:{search_mode:"index",refresh:false,},events:{}}};this._addCommonOptions(x.search_ux_options);this._tabs.add(new m({tabID:w,tab:new b({wuxTab:A,wuxTabBar:y._tabContainer,isNewTab:true,renderTo:this._currentTabContent,events:{updateWidgetTitle:function(C){var B=y.getOption("updateTitle");if(UWA.is(B,"function")){B.call(undefined,C)}},onTabReady:function(){y._tabContainer.newTabButtonFlag=true}}}).render(x.search_ux_options)}))},_onRemoveTabHandler:function(x){var w=this.getTabByID(x.value);if(UWA.is(w)){w.onRemoval();w.destroy()}this._tabs.remove(x.value)},_onSelectTabHandler:function(x){var y=this._tabContainer.getValueByIndex(x.index);var A=this._valueOfCurrentTab;var z=this.getTabByID(y);var w=this.getTabByID(A);this._valueOfCurrentTab=y;if(UWA.is(w)){w.onDeactivate()}if(UWA.is(z)){z.onActivate()}if(this._tabContainer.getTabCount()===1){this._tabContainer.updateTab(y,{allowClosableFlag:false})}else{this._tabContainer.updateTab(A,{allowClosableFlag:true})}},_onContextualMenuEventHandler:function(x){var w=this;x.menu.push({type:"PushItem",title:h.get("closeOtherTabs"),action:{callback:function(){w._closeOtherTabs(w._valueOfCurrentTab)}}})},_registerTabEventHandlers:function(){this._tabContainer.onPreNewTab(this._onPreNewTabHandler.bind(this));this._tabContainer.onNewTab(this._onNewTabHandler.bind(this));this._tabContainer.onRemoveTabEvent(this._onRemoveTabHandler.bind(this));this._tabContainer.onSelectTab(this._onSelectTabHandler.bind(this));this._tabContainer.onContextualMenuEvent(this._onContextualMenuEventHandler.bind(this))},_closeOtherTabs:function(x){for(var z=0;z<this._tabs.length;z++){var w=this._tabs.at(z);var y=w.get("tabID");if(x!==y){this.removeTab(y)}}if(this._tabContainer.getTabCount()===1){this._tabContainer.updateTab(x,{allowClosableFlag:false})}},setActiveTenant:function(x){var y=this.getOption("resources");if(UWA.is(y)){y.active_tenant=x.value}if(!(x.update_tab===false)){var w=this.getActiveTab();if(UWA.is(w)){w.setActiveTenant(x.value)}}},getActiveTaggerProxy:function(x){var w=this.getActiveTab();if(UWA.is(w)){return w.getTaggerProxy()}},getActiveAdvSearchMgr:function(){var w=this.getActiveTab();if(UWA.is(w)){return w.getAdvSearchMgr()}},_isCV5OpenUsage:function(){return"catiav5"===this.getOption("addinMode")&&true===j.getOption("lockedapp")},_subscribeToKeyboardEvents:function(){if(!UWA.is(this._keydownEventHandler,"function")){var w=this;this._keydownEventHandler=function(y){var x=w.getActiveTab();if(UWA.is(x)){x.onKeyboardEvent(y)}};UWA.Element.addEvent.call(document,"keydown",this._keydownEventHandler)}},_unsubscribeToKeyboardEvents:function(){if(UWA.is(this._keydownEventHandler,"function")){UWA.Element.removeEvent.call(document,"keydown",this._keydownEventHandler);delete this._keydownEventHandler}},_onActivateInContextSearch:function(x){var y=this;var A=function(){u.publish({channel:y.getMessagingChannel(),topic:"InContextInit",data:{}})};var B=undefined;var z=UWA.is(this.getOption("addinMode"),"string")&&(this.getOption("addinMode").length>0);var w=UWA.is(x)&&(x.mode!="furtive"&&x.app_socket_id==="socket_id_#saved_search_edit#");if(z){A()}else{B=this.addTab({tabTitle:((UWA.is(x)&&UWA.is(x.title,"string")))?x.title:"",search_ux_options:{widget_id:this.getOption("widget_id"),resources:this.getOption("resources"),css_view_class:"maximized",in_apps_search:x,events:{onReady:function(){A()}}}})}if(!w){this.hideTabBar()}return B},_onDeactivateInContextSearch:function(y){var w=this.getActiveTab();if(UWA.is(w)){var z=w.getTabView();if(UWA.is(z)){this._searchcom_socket.dispatchEvent("onInContextSearchDeactivated",{in_apps_search:z.getOption("in_apps_search")})}var x=w.getTabID();this.removeTab(x)}this.showTabBar()},navhistorycontextifcreateaNewTab:function(){var y=false;if(r.getItem("integratedSearch")===false){var y=false}var x=this;var w=x.getActiveTab();if(UWA.is(w)){y=w.navhistorycontextifcreateaNewTab()}return(y)}});return f});