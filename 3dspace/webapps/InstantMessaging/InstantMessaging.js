define("DS/InstantMessaging/js/model/RTChatModel",["UWA/Class","DS/RTProxyDriver/RTLogger","UWA/Class/Events"],function(b,c,a){c.debug("RTChatModel load");var d=b.extend(a,{init:function(e){this.ListofMsg={};this.controller=e.controller;this.contact=e.contact},onMessageReceived:function(e){this.ListofMsg[e.timestamp]=e},onSendMessage:function(e){this.ListofMsg[e.timestamp]=e},getMsg:function(){return this.ListofMsg}});return d});define("DS/InstantMessaging/js/ressources/FileSaver",[],function(){
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var a=function(){var i=typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content;if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var t=i.document,n=function(){return i.URL||i.webkitURL||i},p=t.createElementNS("http://www.w3.org/1999/xhtml","a"),g="download" in p,l=function(v){if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){var w=window.open(v.href,"_blank");setTimeout(function(){w.document.title=v.download},1000)}else{var u=new MouseEvent("click");v.dispatchEvent(u)}},c=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),q=i.webkitRequestFileSystem,r=i.requestFileSystem||q||i.mozRequestFileSystem,o=function(u){(i.setImmediate||i.setTimeout)(function(){throw u},0)},d="application/octet-stream",m=0,j=1000*40,k=function(v){var u=function(){if(typeof v==="string"){n().revokeObjectURL(v)}else{v.remove()}};setTimeout(u,j)},s=function(v,u,y){u=[].concat(u);var x=u.length;while(x--){var z=v["on"+u[x]];if(typeof z==="function"){try{z.call(v,y||v)}catch(w){o(w)}}}},h=function(u){if(/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(u.type)){return new Blob(["\ufeff",u],{type:u.type})}return u},f=function(u,v,w){if(!w){u=h(u)}var x=this,D=u.type,G=false,z,y,C=function(){s(x,"writestart progress write writeend".split(" "))},F=function(){if(y&&c&&typeof FileReader!=="undefined"){var H=new FileReader();H.onloadend=function(){var J=H.result;y.location.href="data:attachment/file"+J.slice(J.search(/[,;]/));x.readyState=x.DONE;C()};H.readAsDataURL(u);x.readyState=x.INIT;return}if(G||!z){z=n().createObjectURL(u)}if(y){y.location.href=z}else{var I=i.open(z,"_blank");if(I===undefined&&c){i.location.href=z}}x.readyState=x.DONE;C();k(z)},B=function(H){return function(){if(x.readyState!==x.DONE){return H.apply(this,arguments)}}},A={create:true,exclusive:false},E;x.readyState=x.INIT;if(!v){v="download"}if(g){z=n().createObjectURL(u);setTimeout(function(){p.href=z;p.download=v;l(p);C();k(z);x.readyState=x.DONE});return}if(i.chrome&&D&&D!==d){E=u.slice||u.webkitSlice;u=E.call(u,0,u.size,d);G=true}if(q&&v!=="download"){v+=".download"}if(D===d||q){y=i}if(!r){F();return}m+=u.size;r(i.TEMPORARY,m,B(function(H){H.root.getDirectory("saved",A,B(function(I){var J=function(){I.getFile(v,A,B(function(K){K.createWriter(B(function(L){L.onwriteend=function(M){y.location.href=K.toURL();x.readyState=x.DONE;s(x,"writeend",M);k(K)};L.onerror=function(){var M=L.error;if(M.code!==M.ABORT_ERR){F()}};"writestart progress write abort".split(" ").forEach(function(M){L["on"+M]=x["on"+M]});L.write(u);x.abort=function(){L.abort();x.readyState=x.DONE};x.readyState=x.WRITING}),F)}),F)};I.getFile(v,{create:false},B(function(K){K.remove();J()}),B(function(K){if(K.code===K.NOT_FOUND_ERR){J()}else{F()}}))}),F)}),F)},e=f.prototype,b=function(v,w,u){return new f(v,w,u)};if(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob){return function(v,w,u){if(!u){v=h(v)}return navigator.msSaveOrOpenBlob(v,w||"download")}}e.abort=function(){var u=this;u.readyState=u.DONE;s(u,"abort")};e.readyState=e.INIT=0;e.WRITING=1;e.DONE=2;e.error=e.onwritestart=e.onprogress=e.onwrite=e.onabort=e.onerror=e.onwriteend=null;return b};return{saveAs:a()}});define("DS/InstantMessaging/js/view/RTLoginPanelView",["UWA/Class","UWA/Class/Events","DS/UIKIT/Input/Button","DS/RTProxyDriver/RTLogger","DS/UIKIT/Form","DS/UIKIT/Input/Text"],function(c,b,a,f,e,g){f.debug("RTLoginPanelView load");var d=c.extend(b,{init:function(i){var h=document.body.offsetWidth;this.globalView=UWA.createElement("div",{"class":"RTLoginPanel",id:"RTLoginPanel",styles:{width:"300px",height:"350px",background:"white",position:"fixed",border:"solid 1px ligthgray",padding:"20px",boxShadow:"0px 0px 10px 1px rgba(0, 0, 0, 0.1)",left:h/2-150+"px",top:"200px",borderRadius:"8px",zIndex:4000}});this.logForm=new e({fields:[{name:"login",type:"text",label:"Login",placeholder:"Login...",required:true,value:this.getCookie("3DIMLogin")},{name:"password",type:"password",label:"Password",placeholder:"Password...",required:true},{name:"server",type:"text",label:"Server to connect to",placeholder:"Server...",required:true,value:atob(this.getCookie("3DIMServer"))}],buttons:[{type:"submit",value:"Login"}],events:{onSubmit:function(j){document.cookie="3DIMLogin="+j.login;document.cookie="3DIMServer="+btoa(j.server);if(i.events&&i.events.click){i.events.click(j)}},onInvalid:function(){console.log("You have some errors")},onValid:function(){console.log("You have no errors")}}}).inject(this.globalView)},getView:function(){return this.globalView},getCookie:function(k){var j=k+"=";var h=document.cookie.split(";");for(var l=0;l<h.length;l++){var m=h[l];while(m.charAt(0)==" "){m=m.substring(1)}if(m.indexOf(j)==0){return m.substring(j.length,m.length)}}return""}});return d});define("DS/InstantMessaging/js/controller/RTEventBusController",["UWA/Class","UWA/Utils","UWA/Class/Events","DS/RTProxyDriver/RTLogger"],function(c,e,a,d){d.debug("RTEventBus load");var b={};b.eventName={STARTCHAT:"STARTCHAT",ONEDITMODECLICK:"ONEDITMODECLICK",ONADDGROUPCLICK:"ONADDGROUPCLICK",STARTVIDEO:"STARTVIDEO",PANELICONISED:"PANELICONISED",ONICONISEPANELCLICK:"ONICONISEPANELCLICK",ONMAXIMIZEDCLICK:"ONMAXIMIZEDCLICK",PANELMAXIMIZED:"PANELMAXIMIZED",ICONISEALLCLICK:"ICONISEALLCLICK",DISPLAYGLISTOFCONTACT:"DISPLAYGLISTOFCONTACT",ONCLICKNOTIFICATION:"ONCLICKNOTIFICATION",LISTSTATUSRECEIVED:"LISTSTATUSRECEIVED",ONADDCONTACT:"ONADDCONTACT",DISPLAYTRASHEDZONE:"DISPLAYTRASHEDZONE",ONELEMENTDRAGSTART:"ONELEMENTDRAGSTART",ONELEMENTDRAGSTOP:"ONELEMENTDRAGSTOP",LOCKDRAGONMAINVIEW:"LOCKDRAGONMAINVIEW",ACTIVEELEMENTDRAGANDDROP:"ACTIVEELEMENTDRAGANDDROP",RESTARTLOGIN:"RESTARTLOGIN",ACTIVEMINIZONE:"ACTIVEMINIZONE",ONPANELDRAGOVER:"ONPANELDRAGOVER",ONPANELDRAGLEAVE:"ONPANELDRAGLEAVE",SIGNOUT:"SIGNOUT",ACTIVEBUDDYSCROLLER:"ACTIVEBUDDYSCROLLER",ONPANELDROP:"ONPANELDROP"};var f=new a();b.dispatch=function(h,g){if(f){f.dispatchEvent(h,g)}};b.addEvent=function(h,g){if(f){f.addEvent(h,g)}};return b});define("DS/InstantMessaging/js/view/RTSearchView",["UWA/Class","UWA/Class/Events","DS/RTProxyDriver/RTLogger","i18n!DS/InstantMessaging/assets/nls/feed"],function(b,a,c,e){c.debug("RTSearchView load");var d=b.extend(a,{init:function(f){this.isForShareAPI=f.isForShareAPI;this.searchClearIconViewAction=f.searchClearIconViewAction;this.controller=f.controller;this.holderTxt=f.holderTxt;this.timerOn=undefined;var g=this;this.globalView=UWA.createElement("div",{"class":"RTSearch",id:"RTSearch"});this.searchInputView=UWA.createElement("input",{type:"text",placeholder:e.search||"Search ...",events:{focus:function(h){c.debug("RTSearchView Search focus")},blur:function(h){c.debug(g.searchInputView.value)},keyup:function(h){c.debug("RTSearchView keyup");g.searchClearIconView.style.visibility="visible";if(g.searchInputView.value===""){g.controller.clearAllElement();g.searchClearIconView.style.visibility="hidden"}if(g.timerOn){clearTimeout(g.timerOn);g.timerOn=undefined}g.timerOn=setTimeout(function(){if(g.searchInputView.value.length>1){g.controller.controller.searchContact(g.searchInputView.value,g.isForShareAPI)}},400)}}});this.searchInputView.inject(this.globalView);this.searchIconView=UWA.createElement("span",{"class":"fonticon handler fonticon-search",styles:{margin:"auto",color:"#555",fontSize:"1.6em","float":"right"},events:{click:function(){g.dispatchEvent(action.eventName,[]);c.debug(action.eventName)}}}).inject(this.globalView);this.searchClearIconView=UWA.createElement("span",{"class":"fonticon handler fonticon-cancel",styles:{margin:"4px",color:"#555",fontSize:"0.9em","float":"right",top:"3px",position:"relative",visibility:"hidden"},events:{click:function(){if(g.searchClearIconViewAction){g.searchClearIconViewAction()}if(!g.isForShareAPI){g.controller.clearAllElement()}g.searchInputView.value="";g.searchClearIconView.style.visibility="hidden"}}}).inject(this.globalView);if(this.searchParamIconView){this.searchParamIconView=UWA.createElement("img",{src:this.searchParamIconView});this.searchParamIconView.inject(this.globalView)}this.resultView=UWA.createElement("div",{"class":"RTSearchResultView",id:"RTSearchResultView"});this.resultView.inject(this.globalView)},getView:function(){return this.globalView},addContactToResultView:function(f){},showResultOfSearch:function(){var f=new UWA.Fx(this.resultView,{duration:250,transition:"linear"});f.start({height:"200px"})},hideResultOfSearch:function(){var f=new UWA.Fx(this.resultView,{duration:250,transition:"linear"});f.start({height:"0px"})},clearInput:function(){this.searchInputView.value=""}});return d});var prereqs=["UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Spinner","DS/UIKIT/Alert","DS/RTProxyDriver/RTLogger","DS/UIKIT/Modal","DS/3DPlayHelper/3DPlayHelper"];define("DS/InstantMessaging/InstantMessaging3DPlayer",prereqs,function(f,b,e,d,c,a,g){c.addLevel("IM3DPlayer","black");return f.extend({setup:function(h){c.IM3DPlayer("Init");this.room_id=h.room_id;if(!this.room_id){return c.error("InstantMessaging3DPlayer init without room_id")}this.ctrl=h.ctrl;this.leader=h.init;this._createContent()},launchCoreview:function(h){h.room_id=this.room_id;h.path=this.path;h.fileName=this.fileName;h.mime=this.mime;this.ctrl.sendToServer("coreview",h)},uploadFile:function(h){this.ctrl.sendToServer("uploadMedia",h)},_createContent:function(){var h=this;this.setContainer({tag:"div","class":"IM-3dplayer",styles:{display:"none"},html:[{tag:"div",id:"IMWActionBar","class":"IM-3dplayer-action",styles:{margin:"0px"},html:[{tag:"div","class":"IM-3dplayer-feedback",styles:{width:"170px",height:"40px"}},{tag:"span","class":"IM-3dplayer-close fonticon fonticon-2x fonticon-close",events:{click:this.display3dplayer.bind(this)}}]},{tag:"div","class":"IM-3dplayer-div",}]});return this},inject:function(h){this.container.inject(h);return this},startCoreview:function(){if(this.container.style.display!=="none"){var h=this;this._player.setCollabMode(true);this._player.addCollabCB(function(j,i){h.sendCoreviewAction({arg1:j,arg2:i})})}},sendCoreviewAction:function(h){this.launchCoreview({actions:h})},showModal:function(j){c.IM3DPlayer("Coreview invitation received");c.IM3DPlayer(j);var i=this;var h=new a({closable:true,header:"<h4>"+j.username+" wants to start a coreview with you</h4>",body:'<div class="thumbFile"><div><b>'+j.fileName+"</b></div></div>",footer:"<button type='button' id='coreviewRefuse' class='btn btn-default'>Refuse</button> <button type='button' id='coreviewAccept' class='btn btn-primary'>Accept</button>"}).inject(document.body);h.getContent().getElements("#coreviewRefuse")[0].addEvent("click",function(){h.hide();i.destroy()});h.getContent().getElements("#coreviewAccept")[0].addEvent("click",function(){h.hide();i.display3dplayer({mime:j.mime,path:j.path,room_id:j.room_id,fileName:j.fileName,coreview:true});i.coreviewAccepted=true});h.show()},onCoreview:function(h){if(!h.actions){this.showModal(h)}else{if(h.actions.accept!=undefined){if(h.actions.accept&&this.leader){this.startCoreview()}}else{if(!this.leader&&!this.coreviewAccepted){}else{this.onCoreviewAction(h.actions)}}}},onCoreviewAction:function(h){this._player.performAction(h.arg1,h.arg2)},send:function(){var j=this.getElement(".IM-3dplayer-feedback");var i=this.getElement(".IM-3dplayer-action");i.style.display="inline-flex";var h=this;this._player.getScreenshot({onSuccess:function(k){console.log("URL received");var l=new XMLHttpRequest();l.open("GET",k,true);l.send();l.onload=function(n){console.log("svg");var m=l.responseText;h.uploadFile({room_id:h.room_id,mime:"svg",name:h.fileName,file:l.responseText});var o=new d({visible:true}).inject(j);o.add({className:"success",message:"Model shared !"});setTimeout(function(p){j.innerHTML="";i.style.display="none"},3000)}}})},display3dplayer:function(i){if(this.container.style.display==="none"){if(i){this.mime=i.mime;this.room_id=i.room_id;this.fileName=i.fileName;this.coreview=this.leader;if(this.path!==i.path){this.path=i.path;this.createPlayer(i.fileName)}this.container.style.display="block";this.divTop=(this.container.offsetHeight+80);this.container.style.maxHeight="100%";if(this._player&&this.coreview){}}}else{this.container.style.maxHeight=0;var h=this;if(this._player&&this._player.setCollabMode&&this._player.removeCollabCB){this._player.setCollabMode(false);this._player.removeCollabCB()}setTimeout(function(){h.container.style.display="none"},600)}},createPlayer:function(j){var h=this.container.getElement(".IM-3dplayer-div");var i={collabmode:this.leader,container:h,input:{asset:this.path},options:{loading:"autoplay",callbacks:{experience:{ExperienceReady:this.onExperienceReady.bind(this)},asset:{LoadingFinished:this.onLoadingFinished.bind(this)}}}};if(this._player){this._player.dispose()}this._player=new g(i)},onExperienceReady:function(h){if(this.coreview){this._player.setCollabMode(false)}else{this.launchCoreview({actions:{accept:true}})}},onLoadingFinished:function(h){},destroy:function(){this.stopListening();this.model=null;this._parent()}})});define("DS/InstantMessaging/js/view/RTMinimizePanelView",["UWA/Class","UWA/Class/Events","DS/UIKIT/Tooltip","DS/RTColors/RTColors","DS/RTProxyDriver/RTLogger"],function(d,b,f,a,e){e.debug("RTMinimizePanelView load");var c=d.extend(b,{init:function(g){this.views=[];this.expand=true;this.elementDisplay=false;this.globalDisplay=true;this.buddyMinimize=true;this.displayCss=undefined;this.dontDisplayIcon=g.dontDisplayIcon;this.notifQtyIcon=g.notifQtyIcon;this.notificationStyle=g.notificationStyle;var h=this;if((navigator.platform.indexOf("iPhone")!=-1)||(navigator.platform.indexOf("iPod")!=-1)||(navigator.platform.indexOf("iPad")!=-1)){this.globalView=UWA.createElement("div",{"class":"RTMinimizePanel",id:"RTMinimizePanel",styles:{position:"absolute"}})}else{this.globalView=UWA.createElement("div",{"class":"RTMinimizePanel",id:"RTMinimizePanel"})}this.iconView=UWA.createElement("div",{styles:{padding:"2px"}}).inject(this.globalView);this.icon=UWA.createElement("div",{styles:{margin:"2px",width:"50px",height:"50px",borderRadius:"8px",border:"1px solid "+a.offline,boxShadow:"0px 0px 10px 1px rgba(0, 0, 0, 0.1)",background:"white","border-radius":"50px",position:"relative"},events:{mouseover:function(){h.icon.style.cursor="pointer"},mouseout:function(){h.icon.style.cursor="default"},click:function(){if(!h.views.length||h.dontDisplayIcon){if(g.OpenBuddyList||h.dontDisplayIcon){g.OpenBuddyList()}h.buddyMinimize=false}else{if(h.expand){h.collapseAll()}else{h.expandAll()}}}}}).inject(this.iconView);this.spanChat=UWA.createElement("span",{"class":"fonticon handler fonticon-chat",styles:{fontSize:"1.6em",color:"#005686",margin:"10px 12px"}}).inject(this.icon);this.statusIconMini=UWA.createElement("span",{id:"RTMiniPanelStatus",styles:{width:"16px",height:"16px",background:"grey",borderRadius:"16px",position:"absolute",top:"0px",left:"34px"},});this.statusIconMini.inject(this.icon);this.notifqtyIconMini=UWA.createElement("span",{id:"RTMiniPanelNotifqty",styles:{width:"16px",height:"16px",background:a.away,color:"white",borderRadius:"16px",position:"absolute",display:"none",bottom:"0px",left:"34px","text-align":"center","font-weight":"bold"},});if(this.notifQtyIcon){this.notifqtyIconMini.inject(this.icon)}this.statusIconMiniIcon=UWA.createElement("span",{"class":"",styles:{color:"white","font-size":"4px",position:"relative",top:"-6px","font-weight":"bold"}});this.statusIconMiniIcon.inject(this.statusIconMini);this.buddyIconView=UWA.createElement("div",{styles:{padding:"2px",marginRight:"-60px",overflow:"hidden",display:"none"}}).inject(this.globalView);this.buddyIcon=UWA.createElement("div",{styles:{margin:"2px",width:"50px",height:"50px",borderRadius:"50px",border:"1px solid "+a.offline,background:"white"},events:{mouseover:function(){h.buddyIcon.style.cursor="pointer"},mouseout:function(){h.buddyIcon.style.cursor="default"},click:function(){g.OpenBuddyList();h.activeBuddyIcon(false)}}}).inject(this.buddyIconView);UWA.createElement("span",{"class":"fonticon handler fonticon-users",styles:{fontSize:"1.6em",color:"rgb(0, 86, 134)",margin:"9px 12px"}}).inject(this.buddyIcon);this.arrowDownView=UWA.createElement("div",{styles:{margin:"2px",width:"50px",height:"14px",display:"none"},events:{mouseover:function(){h.spanDown.style.color="#3D3D3D";h.spanDown.style.cursor="pointer"},mouseout:function(){h.spanDown.style.color=a.offline;h.spanDown.style.cursor="default"},click:function(){var i=h.iconsListView.scrollTop;h.iconsListView.scrollTop+=100}}}).inject(this.globalView);this.spanDown=UWA.createElement("span",{"class":"fonticon handler fonticon-down-open",styles:{fontSize:"2em",color:a.offline,position:"relative",bottom:"13px",margin:"0px 11px"}}).inject(this.arrowDownView);this.iconsListView=UWA.createElement("div",{styles:{margin:"2px",maxHeight:"580px",overflow:"hidden",minWidth:"50px",padding:"2px"},events:{mousewheel:function(i){h.iconsListView.scrollTop+=i.deltaY}}}).inject(this.globalView);this.arrowUpView=UWA.createElement("div",{styles:{margin:"2px",width:"50px",height:"14",display:"none"},events:{mouseover:function(){h.spanUp.style.color="#3D3D3D";h.spanUp.style.cursor="pointer"},mouseout:function(){h.spanUp.style.color=a.offline;h.spanUp.style.cursor="default"},click:function(){var i=h.iconsListView.scrollTop;h.iconsListView.scrollTop-=100}}}).inject(this.globalView);this.spanUp=UWA.createElement("span",{"class":"fonticon handler fonticon-up-open",styles:{fontSize:"2em",color:a.offline,position:"relative",bottom:"13px",margin:"0px 11px"}}).inject(this.arrowUpView)},getView:function(){return this.globalView},removeAllElements:function(){for(var g=0;g<this.views.length;g++){this.removeElement(this.views[g].idElement)}},removeElement:function(j){var m=this;var h=-1;for(var k=0;k<this.views.length;k++){if(this.views[k].idElement===j){h=k;break}}if(h!==-1){var l=new UWA.Fx(this.views[h].view,{duration:200,transition:"linear",events:{onComplete:function(i){if(m.views[h]&&m.views[h].view){m.views[h].view.destroy()}m.views.splice(h,1)}}});l.start({height:0})}if(this.views.length===10){var g=new UWA.Fx(this.arrowDownView,{duration:200,transition:"linear",events:{onComplete:function(i){m.arrowDownView.style.display="none"}}});g.start({height:0});var n=new UWA.Fx(this.arrowUpView,{duration:200,transition:"linear",events:{onComplete:function(i){m.arrowUpView.style.display="none"}}});n.start({height:0})}},addContact:function(h){var g=-1;for(var j=0;j<this.views.length;j++){if(this.views[j].idElement===h.id){g=j;break}}if(g===-1){var k=this;var l=UWA.createElement("div",{styles:{width:"50px",height:"50px",marginTop:"6px",background:"white",borderRadius:"50px",border:"1px solid "+a.offline},events:{mouseover:function(){l.style.cursor="pointer"},mouseout:function(){l.style.cursor="default"},click:function(){h.events.click();l.tooltip.destroy();k.removeElement(h.id)}}});l.tooltip=new f({target:l,body:h.userName,position:"left"});l.tooltip.getContent().style.zIndex="30000";UWA.createElement("img",{styles:{width:"42px",borderRadius:"42px",margin:"3px"},src:h.pathPicture}).inject(l);this.addElement({idElement:h.id,view:l,contactView:l,position:"bottom",show:true})}},addNotification:function(n){var o=-1;for(var j=0;j<this.views.length;j++){if(this.views[j].idElement===n.id){o=j;break}}if(o===-1){var k=this;if(this.notificationStyle){var h="";var u={right:"15px","border-radius":"4px",width:"300px",height:"74px",marginTop:"6px",boxShadow:"0px 1px 2px 0px #77797c",overflow:"hidden"}}else{var h="";var u={width:"300px",height:"74px",marginTop:"6px",boxShadow:"0px 1px 2px 0px #77797c",overflow:"hidden"}}var q=UWA.createElement("div",{id:"RTNotifView","class":h,styles:u,events:{mouseover:function(){q.style.cursor="pointer"},mouseout:function(){q.style.cursor="default"},click:function(){n.events.click();k.removeElement(n.id)}}});var t=UWA.createElement("div",{styles:{width:"50px",height:"50px",margin:"13px 12px",background:"white",borderRadius:"100%",border:"1px solid "+a.offline,"float":"left"},events:{mouseover:function(){t.style.cursor="pointer"},mouseout:function(){t.style.cursor="default"},click:function(){}}}).inject(q);UWA.createElement("img",{styles:{width:"42px",borderRadius:"42px",margin:"3px"},src:n.pathPicture,}).inject(t);var p=UWA.createElement("div",{styles:{width:"300px",height:"38px",background:this.notificationStyle?"white":"#005686",textAlign:"left"}}).inject(q);var s=UWA.createElement("div",{styles:{height:"38px",display:"flex",flexDirection:"row"}}).inject(p);UWA.createElement("div",{text:n.userName,styles:{width:"150px",color:this.notificationStyle?"#77797c":"white",fontFamily:"arial",fontWeight:"bold",margin:"auto",whiteSpace:"nowrap",overflow:"hidden","float":"left",textOverflow:"ellipsis","margin-bottom":this.notificationStyle?0:"auto"}}).inject(s);UWA.createElement("span",{"class":"fonticon handler fonticon-popup",styles:{fontSize:"1.4em",color:"white",width:"38px","float":"left",margin:"auto"}}).inject(s);UWA.createElement("span",{"class":"fonticon handler fonticon-cancel",styles:{fontSize:"1.2em",color:"white",width:"38px","float":"left",margin:"auto"},events:{click:function(i){UWA.Event.stopPropagation(i);k.removeElement(n.id)}}}).inject(s);var r=UWA.createElement("div",{styles:{width:"300px",height:"36px",background:"white",textAlign:"left"}}).inject(q);var g=UWA.createElement("div",{styles:{margin:"auto",borderRadius:"4px",width:"294px",height:"33px",background:this.notificationStyle?"white":"#F1F1F1",paddingTop:this.notificationStyle?"0":"8px"}}).inject(r);UWA.createElement("div",{text:n.infoTxt,styles:{color:"#3D3D3D",fontFamily:"arial",width:"210px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}}).inject(g);this.addElement({idElement:n.id,view:q,contactView:t,position:"bottom",show:true});var l=new UWA.Fx(q,{duration:300,transition:"linear"});var m=new UWA.Fx(t,{duration:300,transition:"linear",events:{onComplete:function(i){p.style.display="none";r.style.display="none";q.style.boxShadow="rgb(119, 121, 124) 0px 0px 0px 0px";l.start({width:50,height:50,marginRight:0,borderRadius:"50px"});t.style.border="1px solid "+a.away;t.style.borderRadius="50px"}}});setTimeout(function(){l.start({marginRight:-250});m.start({margin:0})},3000)}else{this.receivedMessage(n.id)}},addElement:function(k){console.log(k.position);var n=this;this.elementDisplay=k.show;if(k.position==="top"){console.log("top");this.views.push({idElement:k.idElement,view:k.view,contactView:k.contactView,show:this.expand||k.show})}else{console.log("not top");this.views.unshift({idElement:k.idElement,view:k.view,contactView:k.contactView,show:this.expand||k.show})}console.log(this.iconsListView);k.view.inject(this.iconsListView,k.position);console.log(this.iconsListView);if(this.expand||k.show){var i=k.view.offsetWidth;var l=k.view.offsetHeight;k.view.style.marginRight=-i+"px";var m=false;var j=new UWA.Fx(k.view,{duration:200,transition:"linear",events:{onAnimate:function(h,q,p){if(!m){n.iconsListView.scrollTop+=5}},onComplete:function(h){if(!(k.position==="top")&&m){m=false;j.start({marginRight:[-i,0]})}}}});if(k.position==="top"){j.start({marginRight:[-i,0]})}else{m=true;j.start({height:[0,l]})}if(n.buddyMinimize&&!this.dontDisplayIcon){this.activeBuddyIcon(true)}}if(this.views.length===11){this.arrowDownView.style.display="block";this.arrowUpView.style.display="block";var g=new UWA.Fx(this.arrowDownView,{duration:200,transition:"linear"});g.start({height:[0,13],marginRight:2});var o=new UWA.Fx(this.arrowUpView,{duration:200,transition:"linear"});o.start({height:[0,13],marginRight:2})}},expandAll:function(){var h=this;this.expand=true;this.buddyIcon.style.display="block";var g=new UWA.Fx(this.buddyIcon,{duration:200,transition:"linear"});if(h.views.length){g.start((this.elementDisplay)?{height:[0,50],marginRight:2}:{marginRight:2});this.animeElement(0);if(this.views.length>10){this.arrowDownView.style.display="block";var g=new UWA.Fx(this.arrowDownView,{duration:200,transition:"linear"});g.start({height:[0,13],marginRight:2})}}else{g.start({marginRight:2})}},collapseAll:function(){var h=this;this.expand=false;this.elementDisplay=false;var g=new UWA.Fx(this.buddyIcon,{duration:200,transition:"linear",events:{onComplete:function(i){h.buddyIcon.style.display="none"}}});g.start({marginRight:-60});this.views.forEach(function(i){i.show=false;var j=new UWA.Fx(i.view,{duration:200,transition:"linear",events:{onComplete:function(k){i.view.style.display="none"}}});j.start({marginRight:-60})});var g=new UWA.Fx(this.arrowDownView,{duration:200,transition:"linear",events:{onComplete:function(i){h.arrowDownView.style.display="none"}}});g.start({marginRight:-60});var g=new UWA.Fx(this.arrowUpView,{duration:200,transition:"linear",events:{onComplete:function(i){h.arrowUpView.style.display="none"}}});g.start({marginRight:-60})},animeElement:function(g){var i=true;var k=this;if(!this.views[g].show){this.views[g].show=true;var h=this.views[g].view;h.style.display="block";var j=new UWA.Fx(h,{duration:200,transition:"linear",events:{onAnimate:function(m,p,o){var l=j.currentTime;if(l>30&&i){i=false;if(++g<k.views.length){k.animeElement(g)}else{if(k.views.length>10){k.arrowUpView.style.display="block";var n=new UWA.Fx(k.arrowUpView,{duration:200,transition:"linear"});n.start({height:[0,13],marginRight:2})}}}}}});j.start({marginRight:[-60,0]})}else{if(++g<k.views.length){k.animeElement(g)}}},updateStatus:function(g){this.statusIconMini.style.background=g},updateIcon:function(g){this.statusIconMiniIcon.className=g.name;this.statusIconMiniIcon.style["font-size"]=g.fontSize;this.statusIconMiniIcon.style.top=g.top;this.statusIconMiniIcon.style.left=g.left},updateStatusAndIcon:function(g){g=g.toLowerCase();if(g==="online"){this.updateStatus(a.online);this.updateIcon({fontSize:"9px",top:"-3px",left:"-1px",name:"fonticon handler fonticon-check"})}if(g==="offline"){this.updateStatus(a.offline);this.updateIcon({fontSize:"5px",top:"-4px",left:"-1px",name:""})}if(g==="away"){this.updateStatus(a.away);this.updateIcon({fontSize:"9px",top:"-3px",left:"-1px",name:"fonticon handler fonticon-cancel"})}if(g==="busy"){this.updateStatus(a.busy);this.updateIcon({fontSize:"9px",top:"-3px",left:"-1px",name:"fonticon handler fonticon-minus"})}if(g==="dnd"){this.updateStatus(a.busy);this.updateIcon({fontSize:"9px",top:"-3px",left:"-1px",name:"fonticon handler fonticon-minus"})}},receivedMessage:function(j){var m=this;var h=-1;for(var l=0;l<this.views.length;l++){if(this.views[l].idElement===j){h=l;break}}if(h!==-1){var n=0;var k=false;this.views[h].contactView.style.border="1px solid "+a.offline;var g=setInterval(function(){if(m.views&&m.views[h]&&m.views[h].contactView){m.views[h].contactView.style.border=k?"1px solid "+a.offline:"1px solid "+a.away;k=!k;n++;if(n===5){m.views[h].contactView.style.border="1px solid "+a.away;clearInterval(g)}}else{clearInterval(g)}},300)}},activeMiniZone:function(i){if(this.globalDisplay!==i){var h=this;if(i){this.globalDisplay=i;h.globalView.className="RTMinimizePanel";var g=new UWA.Fx(this.globalView,{duration:200,transition:"linear"});g.start({marginRight:0})}else{this.globalDisplay=i;var g=new UWA.Fx(this.globalView,{duration:200,transition:"linear",events:{onComplete:function(j){h.globalView.className="RTMinimizePanelNone"}}});g.start({marginRight:-60})}}},setNotifQty:function(g){this.notifqtyIconMini.innerText=g},incrementNotifQty:function(g){this.notifqty=Math.min((this.notifqty||0)+(g||1),99);this.setNotifQty(this.notifqty)},razNotifQty:function(g){this.notifqty=0;this.setNotifQty(this.notifqty)},hideNotifQty:function(g){this.notifqtyIconMini.hide()},showNotifQty:function(g){this.notifqtyIconMini.show()},activeBuddyIcon:function(i){var h=this;if(i){this.buddyMinimize=true;if(this.views.length){this.buddyIconView.style.display="block";var g=new UWA.Fx(this.buddyIcon,{duration:200,transition:"linear",events:{onComplete:function(j){var k=new UWA.Fx(h.buddyIconView,{duration:200,transition:"linear"});k.start({marginRight:0})}}});g.start({height:50})}}else{this.buddyMinimize=false;var g=new UWA.Fx(this.buddyIconView,{duration:200,transition:"linear",events:{onComplete:function(j){var k=new UWA.Fx(h.buddyIcon,{duration:200,transition:"linear",events:{onComplete:function(l){h.buddyIconView.style.display="none"}}});k.start({height:0})}}});g.start({marginRight:-60})}},destroy:function(){e.debug("RTMinimizePanelView destroy");this.globalView.destroy()},});return c});define("DS/InstantMessaging/js/controller/RTSettingController",[],function(d,b){var c={};var e={};var a=undefined;c.getSetting=function(f){return e[f]};c.setSetting=function(f,g){e[f]=g};return c});define("DS/InstantMessaging/js/view/RTMsgInfoContactView",["UWA/Class","UWA/Class/Events","DS/RTProxyDriver/RTLogger","i18n!DS/InstantMessaging/assets/nls/feed"],function(b,a,c,e){c.debug("RTMsgInfoContactView load");var d=b.extend(a,{init:function(f){this.isDisplayed=true;this.globalView=UWA.createElement("div",{"class":"RTMsgInfoContact",id:"RTMsgInfoContact",styles:{left:"0px",right:"0px",border:"solid 2px #D1D4D4",margin:"10px",padding:"4px",color:"#B4B6Ba"}});this.retryIcon=UWA.createElement("span",{"class":"fonticon handler fonticon-attention",styles:{fontSize:"2em","float":"left",margin:"4px"}}).inject(this.globalView);this.msgTextView=UWA.createElement("div",{"class":"RTMsgTextWarning",id:"RTMsgTextWarning",text:e.ContactOfflineMessage}).inject(this.globalView)},getView:function(){return this.globalView},display:function(i,g){if(this.isDisplayed!=i){this.isDisplayed=i;if(i){var f=new UWA.Fx(this.globalView,{duration:200,transition:"linear"});this.globalView.style.display="block";f.start({opacity:[0,1]})}else{var h=this;var f=new UWA.Fx(this.globalView,{duration:200,transition:"linear",events:{onComplete:function(j){h.globalView.style.display="none"}}});f.start({opacity:[1,0]})}}if(this.isDisplayed){if(g&&e[g]){this.msgTextView.innerText=e[g]}else{this.msgTextView.innerText=e.ContactOfflineMessage}}}});return d});define("DS/InstantMessaging/js/model/RTGroupModel",["UWA/Class","DS/RTProxyDriver/RTLogger","UWA/Class/Events"],function(b,c,a){c.debug("RTGroupModel load");var d=b.extend(a,{init:function(e){var f=this;this.listOfContact={};this.controller=e.controller;this.groupId=e.groupId;this.groupName=e.groupName;this.groupType=e.groupType},getId:function(){return this.groupId},setId:function(e){this.groupId=e},getName:function(){return this.groupName},setName:function(e){this.groupName=e},getType:function(){return this.groupType},setType:function(e){this.groupType=e},addContact:function(e){if(e.userId&&this.listOfContact[e.userId]===undefined){this.listOfContact[e.userId]=e;this.dispatchEvent("onContactAdded",[e])}},removeContact:function(e){if(e.userId&&this.listOfContact[e.userId]!==undefined){this.dispatchEvent("onContactRemoved",[e]);delete this.listOfContact[e.userId]}}});return d});define("DS/InstantMessaging/js/view/RTSendMsgView",["UWA/Class","UWA/Class/Events","DS/RTProxyDriver/RTLogger","i18n!DS/InstantMessaging/assets/nls/feed"],function(b,a,c,e){c.debug("RTSendMsgView load");var d=b.extend(a,{init:function(f){this.controller=f.controller;this.holderTxt=f.holderTxt;var g=this;this.globalView=UWA.createElement("div",{"class":"RTSendMsg",id:"RTSendMsg",events:{click:function(h){h.stopPropagation();g.sendInputView.focus()}}});this.holderTxtView=UWA.createElement("div",{id:"holderSendMsg",text:this.holderTxt,styles:{position:"absolute","padding-left":"2%","padding-top":"2%",color:"rgb(180, 182, 186)","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none","z-index":"0"}}).inject(this.globalView);this.sendInputView=UWA.createElement("p",{"class":"placeHolderView",contenteditable:"true",spellcheck:"true",events:{keydown:function(h){h.stopPropagation();if(g.sendInputView.textContent!==""){g.holderTxtView.style.display="none"}else{g.holderTxtView.style.display="block"}if(h.keyCode===13&&g.sendInputView.textContent!==""){g.sendMessage(g.sendInputView.textContent);g.sendInputView.textContent="";g.sendInputView.innerHTML=""}if(h.keyCode===27&&g.sendInputView.textContent===""){g.sendInputView.textContent="";g.sendInputView.innerHTML=""}},keyup:function(h){h.stopPropagation();if(g.sendInputView.textContent!==""){g.holderTxtView.style.display="none"}else{g.holderTxtView.style.display="block"}if(h.keyCode===13&&g.sendInputView.textContent===""){g.sendInputView.textContent="";g.sendInputView.innerHTML=""}},paste:function(h){var i=!!window.MSInputMethodContext&&!!document.documentMode;if(!i){return true}c.debug("pasted in IE11 ");h.preventDefault();var j=window.clipboardData.getData("text");g.sendInputView.textContent=j}}});this.sendInputView.inject(this.globalView)},getView:function(){return this.globalView},sendMessage:function(f){this.controller.sendMessage(f)},SendState:function(f){},focus:function(){this.sendInputView.focus()}});return d});define("DS/InstantMessaging/InstantMessagingManager",["DS/UWPClientCode/PublicAPI","DS/RTProxyDriver/RTLogger","DS/PlatformAPI/PlatformAPI","DS/RTProxyDriver/RTProxyDriver","DS/InstantMessaging/js/controller/RTSettingController","UWA/Class","UWA/Class/Events","UWA/Core","DS/WAFData/WAFData","DS/TopBarProxy/TopBarProxy","DS/TopBarProxy/MenuItem","DS/InstantMessaging/js/view/RTMinimizePanelView","DS/InstantMessagingWebRTC/InstantMessagingWebRTC","DS/RTColors/RTColors","DS/MessageBus/MessageBus","i18n!DS/InstantMessaging/assets/nls/feed","DS/InstantMessaging/InstantMessaging3DPlayer"],function(k,s,e,g,m,o,l,c,d,p,h,b,f,j,q,i,r){var n=o.extend(l,{init:function(){s.addLevel("Manager","maroon");s.Manager("InstantMessagingManager init 14/05/2019");this.channelToServer="fromwidgetim.ds.com";this.channelToWidget="towidgetim.ds.com";this.channelFromSwym="fromswym.im.ds.com";this.listOfStatus={Offline:"Offline",Away:"Away",Busy:"Busy",Online:"Online"};this.listOfSysStatus={};this.isTopBarInited=false;this.isWidgetLoaded=false;this.widget_identifier=m.getSetting("widget_identifier")||"X3DIMSG_AP";m.setSetting("widget_identifier",this.widget_identifier);if(UWA.Utils.getQueryString(document.URL,"coreview")||UWA.Utils.getQueryString(document.URL,"coreviewVR")||localStorage.getItem("enable3DPlayCollab")){this.coreview=true;localStorage.setItem("enable3DPlayCollab",true);if(UWA.Utils.getQueryString(document.URL,"coreviewVR")){this.coreviewVR=true}else{this.coreviewVR=false;window.sessionStorage.setItem("3DPlay.PersistedAnnotationsEnabled","true");window.sessionStorage.setItem("3DMessaging.PersistedAnnotationsEnabled","true")}}},fromWidgetListener:function(w){var x=w.evenement;var v=w.data;var u=w.action;if(x==="startX3DPhoto"){return s.Manager("todo")}if(x==="GETLOGINOKDATA"){this.isWidgetLoaded=true;if(!this.loginOKData){return true}this.publishToWidget("CONNECTED",this.loginOKData);for(var t=0;t<this.loginOKData.rooms.length;t++){this.publishToWidget("ROOM",this.loginOKData.rooms[t])}return true}if(x==="logger"){return s.Manager(w.data)}if(x!="CONNECTED"&&(u==="publish"||v)){g.dispatch(x,[v])}},fromSwymListener:function(t){s.Manager("Received from swym : "+JSON.stringify(t));if(!t||!t.action){return s.error("fromSwymListener bad format")}switch(t.action){case"start3DPlayCollab":this.initCoreview(t.data);break;default:return s.error("fromSwymListener unknown action "+t.action)}},initCoreview:function(u){if(!u||!u.users){return s.error("initCoreview bad args")}u.logins=[];for(var t in u.users){u.logins.push(u.users[t].login)}u.username=this.username;u.path=u.mediaUrl;u.mime=u.config3DPlay.input.asset.format;u.fileName=u.mediaTitle;u.init=true;delete u.action;this.sendToServer("coreview",u)},init3DPlayer:function(t){if(this.player3d){return}this.player3d=new r(Object.assign({},t,{ctrl:this}));this.player3d.inject(document.body)},initVRPlayer:function(t){s.Manager(" initVRPlayer not implemented yet")},initPlayer:function(t){if(this.coreviewVR){return this.initVRPlayer(t)}this.init3DPlayer(t)},displayPlayer:function(t){if(this.coreviewVR){return s.Manager(" display coreview VR not implemented yet")}this.player3d.display3dplayer(t)},giveDataToPlayer:function(t){if(this.coreviewVR){return s.Manager(" giveDataTo coreview VR not implemented yet")}this.player3d.onCoreview(t)},coreviewListnr:function(t){if(!this.coreview){return s.Manager("Received coreview but the feature is not enabled.")}this.initPlayer(t);if(t.init){this.displayPlayer(t);t.init=false;delete t.init;return this.sendToServer("coreview",t)}this.giveDataToPlayer(t)},sendToServer:function(u,t){if(!u||!t){return s.error("sendToServer misses args")}s.Manager("Sending "+u+" to server");s.Manager(t);g.dispatch(u,[t])},findCurrentTenant:function(){var w=window.sessionStorage.getItem("3DIMfavoriteTenant")||UWA.Utils.getQueryString(document.URL,"tenant3DIM");if(w){s.Manager("findCurrentTenant forced the tenant "+w);return w}else{if(this.resources.length==1&&this.resources[0].platformid){w=this.resources[0].platformid;s.Manager("findCurrentTenant selected the only tenant of instanciation params : "+w)}else{if(window.location.href.search(/https:\/\/([A-z0-9]+)-[A-z0-9]+-[A-z0-9]+-[A-z0-9]+/)===0){w=window.location.href.split(/https:\/\//)[1].split("-")[0];s.Manager("findCurrentTenant selected the tenant from url : "+w)}else{w=k.getApplicationConfiguration("app.mp.tenant");s.Manager("findCurrentTenant selected the PublicAPI.app.mp.tenant "+w)}}}if(!w){try{var u,t=JSON.parse(k.user.properties.dashboards)}catch(v){s.error("unable to parse user dahboards")}for(u in t){if(t[u].platformId){w=t[u].platformId;s.Manager("findCurrentTenant selected the first PublicAPI.user.properties.dashboards tenant "+w);break}}}s.Manager("findCurrentTenant ends with "+w);return w},getServicesInfos:function(y,t){this.passportUrl=(t?t.passportUrl:null)||e.getApplicationConfiguration("app.urls.passport");var u,w,v=[];if(t&&t.ressources){for(u in t.ressources.instantMessaging){w=t.ressources.instantMessaging[u];v.push({platformid:w.id.toLowerCase(),displayname:w.displayName,"3dmessaging":w.url,"3dswym":t.ressources.swym[u]?t.ressources.swym[u].url:null,"3dpassport":this.passportUrl})}}else{v=t}s.Manager("instanciation resources : ");s.table(v);this.resources=v;var x=this.findCurrentTenant();if(this.devEnv){return y({platformid:x,"3dswym":"none"})}require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(z){z.getPlatformServices({onComplete:function(D){try{D=JSON.parse(JSON.stringify(D).toLowerCase())}catch(E){for(var B=0;B<D.length;B++){for(var A in D[B]){if(D[B].hasOwnProperty(A)){D[B][A.toLowerCase()]=D[B][A];delete D[B][A]}}}}s.Manager("i3DXCompassPlatformServices resources : ");s.table(D);if(x){x=x.toLowerCase();var C=D.concat(v);s.Manager("all resources : ");s.table(C);for(var B in C){if(C[B].platformid&&C[B].platformid.toLowerCase()===x){s.Manager("getServicesInfos ends with resources of selected tenant : ");s.table(C[B]);return y(C[B])}}s.error("getServicesInfos failed to find the tenant "+x+" in resources. Using the first one "+C[0].platformid);return y(C[0])}else{if(y){s.Manager("getServicesInfos ends with resources of first tenant : ");s.Manager(D[0]);return y(D[0])}else{s.error("InstantMessagingManager no callback")}}}})})},standaloneSetup:function(t,v){this.devEnv=t.devEnv;this.noMiniPanels=t.noMiniPanels;var u=(function(w){return function(x){x.url=x["3dmessaging"]||t.url;x.passportUrl=w.passportUrl||x["3dpassport"];x.platformId=x.platformid;x.platformIdName=x.displayname;x.username=k.user.firstName+" "+k.user.lastName;x.login=k.user.login;x.swymUrl=x["3dswym"];x.topBarId=x.topBarId||"instantMessagingMenu";x.appName=e.getApplicationConfiguration("app.usage.service");x.tenants=x.allOptions;x.devEnv=t.devEnv;w.setup(x);w.connectToServer()}})(this);this.getServicesInfos(u,t)},setup:function(t){this.options=t;this.url=t.url;this.passportUrl=t.passportUrl;this.platformId=t.platformId;this.username=t.username;this.login=t.login;this.devEnv=t.devEnv;this.swymUrl=t.swymUrl;this.topBarId=t.topBarId;this.active3DIM=t.tenants;this.appName=t.appName;e.subscribe("fromx3dphoto.ds.com",function(w){var x=w.evenement;var v=w.data;if(x==="upload"){g.dispatch("uploadMedia",[v])}});e.subscribe(this.channelToServer,(function(v){return function(){v.fromWidgetListener(arguments[0])}})(this));e.subscribe(this.channelFromSwym,(function(v){return function(){v.fromSwymListener(arguments[0])}})(this));g.addEvent(g.eventName.CONNECTED,(function(v){return function(){v.connectedListnr(arguments[0])}})(this));g.addEvent(g.eventName.ONPRESENCERECEIVED,(function(v){return function(){v.presenceListnr(arguments[0])}})(this));g.addEvent(g.eventName.ONMESSAGERECEIVED,(function(v){return function(){v.messageListnr(arguments[0])}})(this));g.addEvent("ROOM",(function(v){return function(){v.roomListnr(arguments[0])}})(this));g.addEvent("COREVIEW",(function(v){return function(){v.coreviewListnr(arguments[0])}})(this));this.eventsFromDriver=["CONNECTED","GROUP","ROOM","ONMESSAGERECEIVED","ONDATARECEIVED","ONARCHIVERECEIVED","ONPRESENCERECEIVED","RESULTOFSEARCH","COREVIEW","miscellaneous","onLeaveRoom","onJoinRoom","mediaReceived","discovered"];for(var u in this.eventsFromDriver){(function(v,w){g.addEvent(v,function(x){w.publishToWidget(v,x)})})(this.eventsFromDriver[u],this)}this.webrtcCtrl=new f({nwayActivated:true,appName:this.appName,login:this.login,userName:this.userName,swymUrl:this.swymUrl,doLogRTC:false,url:"toremove",platformId:"toremove"});if(!this.noMiniPanels){this.initGlobalIcon()}},connectedListnr:function(t){if(!t.userId){s.error("unable to retrieve user's login")}this.login=t.userId;this.username=t.username;s.Manager("Connected to RTC server "+this.login);m.setSetting("userLogin",t.userId);this.loginOKData=t;this.loginOKData.options=this.options;this.publishToWidget("CONNECTED",t);this.isLoggedIn=true;this.selfPresenceListnr(t.status);if(!this.devEnv&&!this.isTopBarInited){this.initTopBar(this.noMiniPanels)}},roomListnr:function(t){this.loginOKData.rooms=this.loginOKData.rooms||[];this.loginOKData.rooms.push(t)},connectToServer:function(){if(!this.url){return s.error("no 3DMessaging url")}s.Manager("connectToServer NodeJS "+this.url+" user "+this.login+" on tenant "+this.platformId+" and passportUrl "+this.passportUrl);var t={nameApp:"3DIM",driverName:"NODE",url:this.url,domaineName:this.platformId,passportUrl:this.passportUrl,username:this.username,devEnv:this.devEnv,credentials:{jid:this.login||UWA.Utils.getQueryString(document.URL,"login3DIM")||"noLogin",user:this.login,password:null}};g.dispatch(g.eventName.SETDRIVER,[t])},publishToWidget:function(t,u){e.publish(this.channelToWidget,{evenement:t,data:u})},load3DIMW:function(){if(this.devEnv){return true}if(!this.noMiniPanels){this.miniPanels.razNotifQty()}this.hideGlobalIcon();this.openInSidePanel()},openInSidePanel:function(){window.location.href+="/sidepanel:"+this.widget_identifier},openInDiv:function(){var v=this;var x=require("DS/TopBar/TopBar");if(!this.w3DIM){this.w3DIM=UWA.createElement("div",{"class":"W3DIM-main-div",styles:{position:"absolute",top:"43px",left:"0px",right:"0px",bottom:"0px",heigth:"auto",width:"100%",background:"#ffffff","z-index":"15"},html:[{tag:"div","class":"W3DIM-player"}]});this.w3DIM.inject(document.body);this.loadWidget({app:this.widget_identifier,el:this.w3DIM.getElement(".W3DIM-player")});x.addEvent({events:{"click-extrabtn":function(){var y=document.body.offsetWidth;var z=document.body.offsetHeight;var A=new UWA.Fx(v.w3DIM,{duration:600,transition:"linear",events:{onComplete:function(){v.w3DIM.style.display="none";x.set("brand",v.oldBrand.brand);x.set("application",v.oldBrand.app);v.showGlobalIcon()}}});A.start({left:y});x.toggleExtraButton()}}})}else{this.w3DIM.style.display="block"}this.oldBrand={brand:x._model.get("brand"),app:x._model.get("application")};x.set("brand","3DMessaging");x.set("application","");x.setExtraButtonOptions({tooltip:"Exit 3DMessaging",fonticon:"fonticon-cancel"});x.toggleExtraButton();var t=document.body.offsetWidth;var u=document.body.offsetHeight;setTimeout(function(){var w=new UWA.Fx(v.w3DIM,{duration:400,transition:"linear"});w.start({left:[t,0]})},10)},loadWidget:function(v){var u=this;var t=require("DS/i3DXCompass/i3DXCompass");t.getAppInfo({appId:v.app,onComplete:function(y){UWA.log(y);if(y){var z=y.platformId,w={},A=c.merge(w,z),x={el:v.el,parent:false,preview:true,appId:v.app,data:A,header:false};if(y&&((y.checksum&&y.launchInfos)||(y.platforms&&y.platforms[0]&&y.platforms[0].checksum&&y.platforms[0].launchInfos))){x=c.extend(x,{widgetId:c.is(y.launchInfos)?y.launchInfos:y.platforms[0].launchInfos,isolationLevel:c.is(y.isolationLevel)?y.isolationLevel:y.platforms[0].isolationLevel,token:c.is(y.checksum)?y.checksum:y.platforms[0].checksum})}else{throw new Error("Could not get valid Config from MyApps for the App "+x.appId)}require("DS/TopFrame/TopFrame")._loadModules(["DS/UWPClientCode/WidgetFactory","DS/TopFrame/Environment"]).then(function(E){var B=E[0];var C=E[1];B.load(x,function(){},C)})}}})},initTopBar:function(A){s.Manager("initTopBar");var u=A?(i.myStatus||"Presence"):"3DMessaging";var x,v,t,y=this,w,C;this.topBarProxy=new p({id:this.topBarId});var z=function(D){return function(E){if(D===u){console.log("  .--,-``-.                              \n /   /     '.      ,---,      .--.--.    \n/ ../        ;   .'  .' `\\   /  /    '.  \n\\ ``\\  .`-    ',---.'     \\ |  :  /`. /  \n \\___\\/   \\   :|   |  .`\\  |;  |  |--`   \n      \\   :   |:   : |  '  ||  :  ;_     \n      /  /   / |   ' '  ;  : \\  \\    `.  \n      \\  \\   \\ '   | ;  .  |  `----.   \\ \n  ___ /   :   ||   | :  |  '  __ \\  \\  | \n /   /\\   /   :'   : | /  ;  /  /`--'  / \n/ ,,/  ',-    .|   | '` ,/  '--'.     /  \n\\ ''\\        ; ;   :  .'      `--'---'   \n \\   \\     .'  |   ,.'                   \n  `--`-,,-'    '---'")}else{if(D==="Signout"){RTEventBusController.dispatch(RTEventBusController.eventName.SIGNOUT,[]);y.isLoggedIn=false}else{if(y.isLoggedIn){g.dispatch(g.eventName.SETSTATUS,{myStatus:D,statusMsg:D})}}}}};this.subMenu=[];for(x in this.listOfStatus){if(x=="Offline"||x=="Away"){w="Appear"+x}else{w=x}var B=new h({label:i[w],checked:(x==="Online"),onExecute:z(x)});B.set("statusName",x);this.subMenu.push(B)}t=0;for(v in this.active3DIM){if(this.active3DIM[v].imActive){t++}}this.topBarProxy.setContent({profile:[{label:u,submenu:this.subMenu,onExecute:z(u)}]});g.addEvent(g.eventName.LOGOUT,function(){y.subMenu.forEach(function(D){D.set("disabled",true)});y.isTopBarInited=false});this.isTopBarInited=true},initGlobalIcon:function(){this.miniPanels=new b({dontDisplayIcon:true,notificationStyle:true,notifQtyIcon:true,OpenBuddyList:(function(t){return function(){t.load3DIMW()}})(this)});this.miniPanels.getView().inject(document.body);document.getElementById("RTMiniPanelStatus").style.textAlign="center"},showGlobalIcon:function(){if(this.noMiniPanels){return true}this.miniPanels.globalView.show()},hideGlobalIcon:function(){if(this.noMiniPanels){return true}this.miniPanels.globalView.hide();this.miniPanels.hideNotifQty()},isWidgetOpen:function(){if(this.noMiniPanels){return false}return this.miniPanels.globalView.isHidden()},selfPresenceListnr:function(t){s.Manager("Self presence received "+t);this.myStatus=t;m.setSetting("userStatus",t);if(!this.noMiniPanels){this.miniPanels.updateStatusAndIcon(t)}this.updateSubMenu(t)},updateSubMenu:function(t){if(this.subMenu){this.subMenu.forEach(function(u){if(u.get("statusName")==t){u.set("checked",true)}else{u.set("checked",false)}u.set("disabled",false)})}else{s.error("no subMenu")}},presenceListnr:function(t){var u=t.userId.split("@");if(u[0]===this.login){this.selfPresenceListnr(t.status)}},messageListnr:function(t){if(!this.isWidgetOpen()&&t.origin!="system"){this.addNotification(t)}},addNotification:function(t){if(this.noMiniPanels){return true}this.miniPanels.addNotification({id:t.roomId,pathPicture:this.swymUrl+"/api/user/getpicture/login/"+t.login,userName:t.username,infoTxt:(t.msg)?t.msg.unescapeHTML():((t.data)?"Content received.":"Error : No message."),events:{click:(function(u){return function(){s.Manager("click on notif "+t.roomId);u.openRoom(t)}})(this)}});this.miniPanels.incrementNotifQty();this.miniPanels.showNotifQty()},openRoom:function(t){if(!this.isWidgetOpen()){this.load3DIMW()}if(this.isWidgetLoaded){this.publishToWidget("DISPLAY_ROOM",t)}else{this.loginOKData.expectedRoom=t.roomId||t.room_id}},initFrameEvents:function(t){if(!t){return s.error("TopFrame not found")}t.addEvent("onRightPanelOpened",(function(u){return function(v){if(t._visibleXApp=="messaging"||window.location.href.indexOf("/sidepanel:"+u.widget_identifier)!=-1){u.hideGlobalIcon()}else{u.showGlobalIcon()}}})(this));t.addEvent("onRightPanelClosed",(function(u){return function(v){u.showGlobalIcon()}})(this))}});var a=document.RTCManager||new n();document.RTCManager=a;return a});document.callAlwaysAvailable=true;define("DS/InstantMessaging/InstantMessaging",["DS/UWPClientCode/PublicAPI","DS/RTProxyDriver/RTLogger","DS/PlatformAPI/PlatformAPI","DS/RTProxyDriver/RTProxyDriver","DS/InstantMessaging/js/controller/RTSettingController"],function(a,i,h,g,f){i.info("InstantMessaging load");var d={};var e=null;var c=false;var b=null;var j=function(n){if(!n){return null}if(!a||!a.user||!a.user.properties){return i.error("InstantMessaging can not find user properties via PublicAPI")}var m,q,l;q=window.sessionStorage.getItem("3DIMfavoriteTenant");if(q){i.info("InstantMessaging selected via sessionStorage the tenant "+q)}else{try{q=a.getApplicationConfiguration("app.mp.tenant");if(!q){l=JSON.parse(a.user.properties.dashboards);for(m in l){if(l[m].platformId){q=l[m].platformId;break}}}i.info("InstantMessaging selected via PublicAPI the tenant "+q)}catch(p){i.info("InstantMessaging can not find dashboards via PublicAPI")}}if(!q&&n.instantMessaging[0]){q=n.instantMessaging[0].id}var o;for(m in n.instantMessaging){if(n.instantMessaging[m].id==q){o=n.instantMessaging[m];break}}if(!o){return UWA.log("InstantMessaging init failed with ressources : "+JSON.stringify(n.instantMessaging),"error")}i.info("InstantMessaging selected the ressource "+JSON.stringify(o));var k;if(n.swym){for(m=0;m<n.swym.length;m++){k=n.swym[m];if(!k||!k.id){continue}if(k.id==q){break}}}o.swym=k.url;return o};d.init=function(x,w){var l=UWA.Utils.getQueryString(document.URL,"devEnv3diM")||x.devEnv3diM;var r="noprint";if(r&&t&&t.webrtc3DIM){f.setSetting("webrtc3DIM",r);var m=t&&t.webrtc3DIM||x.appName=="3DMake";require(["DS/InstantMessagingWebRTC/InstantMessagingWebRTC"],function(y){if(l){var z={url:x.url||"http://10.237.32.111:443"||"https://localhost:443"||"https://3dmessagingt1.ux.dsone.3ds.com:3480",login:UWA.Utils.getQueryString(document.URL,"login3DIM")||UWA.Utils.getQueryString(document.URL,"login3DIM"),credential:"osef",platformId:"hyper3dsy",devEnv:true,doLogRTC:m}}else{if(!t||!t.url){return i.error("InstantMessaging needs ressource")}var z={appName:x.appName,passportUrl:x.passportUrl,login:x.userId,credential:"osef",topBarId:x.topBarId,messaging:undefined,userName:x.userName,tenants:{},url:t.url.replace(":8081/rest",":443").replace("/rest","/"),platformId:t.id,swymUrl:t.swym,doLogRTC:m,nwayActivated:true}}b=new y(z);e=b});if(m){return true}}var q=true;if(UWA.Utils.getQueryString(document.URL,"alone3DIM")===false||UWA.Utils.getQueryString(document.URL,"alone3DIM")=="false"||a.getApplicationConfiguration("app.rtc.enable")===false||a.getApplicationConfiguration("app.rtc.enable")=="false"){q=false}if(q){f.setSetting("aloneManager",true);require(["DS/InstantMessaging/InstantMessagingManager"],function(y){if(l){t={url:x.url||"http://10.237.32.111:443"||"https://localhost:443"||"https://3dmessagingt1.ux.dsone.3ds.com:3480",id:"hyper3dsy",devEnv:true};x.login=UWA.Utils.getQueryString(document.URL,"login3DIM");x.devEnv=true}x.noMiniPanels=true;y.standaloneSetup(x)});return true}var t=j(x.ressources)||(x.ressources&&x.ressources.instantMessaging?x.ressources.instantMessaging[0]:null);c=UWA.Utils.getQueryString(document.URL,"force3DIM");if(c=="nope"){return i.info("InstantMessaging noped")}var u=UWA.Utils.getQueryString(document.URL,"widget3DIM");if(UWA.Utils.getQueryString(document.URL,"widget3DIM")=="nope"){u=false}if(u){f.setSetting("widget3DIM",true);require(["DS/InstantMessaging/InstantMessagingManager"],function(y){if(l){t={url:x.url||"http://10.237.32.111:443"||"https://localhost:443"||"https://3dmessagingt1.ux.dsone.3ds.com:3480",id:"hyper3dsy",devEnv:true};x.login=UWA.Utils.getQueryString(document.URL,"login3DIM");x.devEnv=true}x.ressource=t;x.url=t.url.replace(":8081/rest",":443").replace("/rest","/");x.platformId=t.id;x.swymUrl=t.swym;y.setup(x);y.connectToServer()});return true}if(l){require(["DS/InstantMessaging/js/view/RTLoginPanelView"],function(z){if(x.ODTMode){require(["DS/InstantMessaging/js/controller/InstantMessagingController"],function(A){e=new A({devMode:true,devOpt:{login:"p8d",password:"p8d"},noBuddylist:x.noBuddylist,ODTMode:x.ODTMode,devOptFct:x.devOptFct})})}else{var y=new z({events:{click:function(A){require(["DS/InstantMessaging/js/controller/InstantMessagingController"],function(B){e=new B({devMode:true,devOpt:A});e.webrtcCtrl=b;y.getView().destroy();w(e)})}}});y.getView().inject(document.body)}})}else{if(e===null){var p,k,n,s,v=false;var o={appName:x.appName,passport:x.passportUrl,userId:x.userId,topBarId:x.topBarId,messaging:undefined,userName:x.userName,tenants:{}};if(x&&x.ressources&&x.ressources.instantMessaging){if(i&&i.table){i.table(x.ressources.instantMessaging)}for(p=0;p<x.ressources.instantMessaging.length;p++){s=x.ressources.instantMessaging[p];o.messaging=s.url;o.tenants[s.id]={imActive:s.enabled||c,displayName:s.displayName,swym:undefined,url:s.url};if(s.enabled||c){v=true}else{delete o.tenants[s.id]}}o.favoriteTenant=window.sessionStorage.getItem("3DIMfavoriteTenant");if(x.ressources.swym){for(p=0;p<x.ressources.swym.length;p++){k=x.ressources.swym[p];if(!k||!k.id){continue}n=k.id;if(!o.tenants[n]){o.tenants[n]={swym:""}}else{if(p===0&&!o.favoriteTenant){o.favoriteTenant=n}}o.tenants[n].swym=k.url}}}else{i.info("InstantMessaging can not load : no ressources")}if(v&&(o.messaging&&o.messaging!=="IGNORE_RTC")){require(["DS/InstantMessaging/js/controller/InstantMessagingController"],function(y){e=new y(o)})}}}return e};return d});define("DS/InstantMessaging/js/view/RTElementView",["UWA/Class","UWA/Class/Events","DS/UIKIT/Spinner","DS/InstantMessaging/js/controller/RTSettingController","DS/RTProxyDriver/RTProxyDriver","DS/RTProxyDriver/RTLogger","DS/InstantMessaging/js/controller/RTEventBusController","DS/RTColors/RTColors","i18n!DS/InstantMessaging/assets/nls/feed"],function(b,j,c,f,g,i,e,a,h){i.debug("RTElementView load");var d=b.extend(j,{init:function(m){this.editMode=false;this.addBorder=false;this.lockDropData=false;this.controller=m.controller;this.statusElement=m.statusElement;this.pictureElement=m.pictureElement;this.pictureElement.picture.draggable=false;this.titleElement=m.titleElement;this.titleElement.txt=this.htmlDecode(this.titleElement.txt);this.subTitleElement=m.subTitleElement;this.expander=m.expander;this.fonticonElement=m.fonticonElement;this.groupId=m.groupId;var n=this;if(this.groupId==="searchChatId"){this.globalView=UWA.createElement("div",{"class":"RTElement",id:"RTElement",events:{mouseover:function(){if(!n.editMode){n.globalView.style.cursor="pointer";n.globalView.style.background="rgb(204,227,240)"}},mouseout:function(){if(!n.editMode){n.globalView.style.cursor="default";n.globalView.style.background="white"}}}});if(this.expander){this.RTElementExpander=UWA.createElement("span",{"class":"fonticon handler fonticon-right-open",styles:{position:"relative",left:"0px",margin:"auto",color:"#555",width:"20px",height:"20px",marginTop:"6px"},events:{click:function(){if(n.pictureElement.eventName){n.dispatchEvent(n.pictureElement.eventName,[])}i.debug("RTElementView  RTElementExpander Click : "+n.pictureElement.eventName)}}}).inject(this.globalView)}if(this.pictureElement){if(this.pictureElement.picture){this.RTElementPictureView=this.pictureElement.picture.cloneNode(true);this.RTElementPictureView.className="RTElementPicture";this.RTElementPictureView.draggable="false";this.globalView.appendChild(this.RTElementPictureView)}}if(this.fonticonElement){this.fonticonElementView=UWA.createElement("span",{"class":"fonticon handler "+this.fonticonElement,styles:{margin:"auto",color:"#555",fontSize:"1.2em",marginTop:"4px"}}).inject(this.globalView)}this.RTElementTxtInfoView=UWA.createElement("div",{"class":"RTElementTxtInfo",id:"RTElementTxtInfo",events:{click:function(){if(!n.editMode){if(n.titleElement.eventName){i.debug("RTElementView RTElementTxtInfoView Click : "+n.pictureElement.eventName);n.controller.dispatchEvent(n.pictureElement.eventName,[n.controller])}}}}});if(this.titleElement){if(this.titleElement.txt){this.RTTitleElementView=UWA.createElement("div",{"class":"RTTitleElement",id:"RTTitleElement",text:this.titleElement.txt});this.RTTitleElementView.inject(this.RTElementTxtInfoView)}}this.RTElementSubView=UWA.createElement("div",{"class":"RTElementSub",id:"RTElementSub"});this.RTElementStatusView=UWA.createElement("div",{"class":"RTElementStatus",id:"RTElementStatus",style:{background:a.offline}});this.RTElementStatusView.inject(this.globalView);this.RTElementStatusIcon=UWA.createElement("span",{"class":"",styles:{color:"white","font-size":"4px",position:"relative",top:"-6px","font-weight":"bold"}});this.RTElementStatusIcon.inject(this.RTElementStatusView);this.RTSubTitleElementView=UWA.createElement("div",{"class":"RTSubTitleElement",id:"RTSubTitleElement"});this.RTSubTitleElementView.inject(this.RTElementSubView);this.RTElementSubView.inject(this.RTElementTxtInfoView);this.RTElementTxtInfoView.inject(this.globalView);this.addIcon=UWA.createElement("span",{"class":"fonticon handler fonticon-plus",styles:{margin:"auto 5px",color:"#555",fontSize:"1em","float":"right",position:"relative",display:"none"},events:{click:function(){i.debug("RTElementView ONADDCONTACT"+n.id);var q={userId:n.controller.getId(),userName:n.controller.getUserName(),login:n.controller.getLogin(),status:n.controller.getStatus()};e.dispatch(e.eventName.ONADDCONTACT,[{user:q,group:"_"}])}}}).inject(this.globalView);this.removeIcon=UWA.createElement("span",{"class":"fonticon handler fonticon-cancel-circled",styles:{margin:"4px",color:"#555",fontSize:"0.9em","float":"right",top:"3px",position:"relative",display:"none"},events:{click:function(){i.debug("RTElementView Remove"+n.id);n.controller.sendRemove()}}}).inject(this.globalView);if(m.displayNumberOfcontact){this.numberOfContactView=UWA.createElement("div",{styles:{color:"#555",fontSize:"1em","float":"right",position:"relative",margin:"6px"}}).inject(this.globalView)}this.ChangeNameInputView=UWA.createElement("input",{type:"text",placeholder:"Add group...",styles:{height:"32px",width:"100%",flex:"1",webkitFlex:"1",msFlex:"1",textAlign:"left",marginLeft:"10px",display:"none",fontSize:"16px",margin:"1px",outline:"none",paddingLeft:"1%",border:"0px"},events:{blur:function(q){i.debug("RTElementView ChangeNameInputView - onblur");if(n.ChangeNameInputView.value!==""&&n.ChangeNameInputView.value!==n.ChangeNameInputView.placeholder){g.dispatch(g.eventName.CREATEGROUP,[n.ChangeNameInputView.value])}},keyup:function(q){i.debug("RTElementView ChangeNameInputView - keyup");if(q.keyCode===13&&n.ChangeNameInputView.value!==""&&n.ChangeNameInputView.value!==n.ChangeNameInputView.placeholder){g.dispatch(g.eventName.CREATEGROUP,[n.ChangeNameInputView.value])}}}});this.ChangeNameInputView.inject(this.globalView)}else{this.globalView=UWA.createElement("div",{"class":"RTContactElement",id:"RTContactElement",styles:{overflow:"hidden","float":"left",width:"84px",height:"84px",margin:"1px"},events:{mouseover:function(){if(!n.editMode){n.globalView.style.cursor="pointer"}},mouseout:function(){if(!n.editMode){n.globalView.style.cursor="default"}},click:function(){if(n.pictureElement.eventName){i.debug("RTElementView RTElementTxtInfoView Click : "+n.titleElement.eventName);n.controller.dispatchEvent(n.pictureElement.eventName,[n.controller])}}}});var l=f.getSetting("defaultAvatarURL")||"./resources/en/1/webapps/InstantMessaging/assets/avatarDefault.png";if(this.pictureElement.picture.complete){this.RTElementPictureView=this.pictureElement.picture.cloneNode(true);this.RTElementPictureView.style.width="48px";this.RTElementPictureView.style["border-radius"]="48px";this.RTElementPictureView.style.margin="4px"}else{this.pictureElement.picture.onload=function(){n.RTElementPictureView.destroy();n.RTElementPictureView=n.pictureElement.picture.cloneNode(true);n.RTElementPictureView.style.width="48px";n.RTElementPictureView.style["border-radius"]="48px";n.RTElementPictureView.style.margin="4px";n.RTElementPictureView.draggable=false;n.globalView.insertBefore(n.RTElementPictureView,n.globalView.firstChild)};this.pictureElement.picture.onerror=function(){i.debug("RTContactController : User avatar has not been found, setting the default one. User login:");n.RTElementPictureView.destroy();n.RTElementPictureView=UWA.createElement("img",{draggable:"false",src:l,styles:{height:"48px",margin:"4px","border-radius":"48px",draggable:"false"}});n.globalView.insertBefore(n.RTElementPictureView,n.globalView.firstChild)};var k=UWA.createElement("div",{styles:{height:"84px",padding:"10px"}});var o=new c().inject(k).show();this.RTElementPictureView=k}this.RTElementPictureView.className="RTContactPicture";this.RTElementPictureView.draggable="false";this.globalView.appendChild(this.RTElementPictureView);if(this.titleElement){if(this.titleElement.txt){this.RTTitleElementView=UWA.createElement("div",{"class":"RTTitleElement",id:"RTTitleElement",styles:{width:"100%",height:"25px",color:"black"},text:this.titleElement.txt});this.RTTitleElementView.inject(this.globalView)}}this.RTElementName=UWA.createElement("div",{"class":"RTElementName",id:"RTElementName",styles:{width:"90%",overflow:"hidden",textOverflow:"ellipsis",margin:"auto"}});this.RTElementName.inject(this.RTTitleElementView);this.RTElementStatusView=UWA.createElement("div",{"class":"RTContactStatus",id:"RTContactStatus",styles:{width:"24px",height:"24px",background:a.offline,"margin-top":"-80px","margin-left":"56px",position:"relative","border-radius":"100%",border:"2px solid white"}});this.RTElementStatusView.inject(this.globalView);this.RTElementStatusIcon=UWA.createElement("span",{"class":"",styles:{color:"white","font-size":"6px",position:"relative",top:"0px","font-weight":"bold"}});this.RTElementStatusIcon.inject(this.RTElementStatusView)}if(this.statusElement!==undefined){var p=f.getSetting("RTCStatus");this.subTitleElement=h.Offline||"Offline";this.RTElementStatusView.style.background=a.offline;this.RTElementStatusIcon.className="";this.RTElementStatusIcon.style["font-size"]=(this.groupId==="searchChatId")?"4px":"6px";if(p){if(this.statusElement===p.Online){this.RTElementStatusView.style.background=a.online;this.subTitleElement=h.Online||"Online";this.RTElementStatusIcon.className="fonticon handler fonticon-check";this.RTElementStatusIcon.style["font-size"]=(this.groupId==="searchChatId")?"8px":"10px"}if(this.statusElement===p.Busy){this.RTElementStatusView.style.background=a.busy;this.subTitleElement=h.Busy||"Busy";this.RTElementStatusIcon.className="fonticon handler fonticon-minus";this.RTElementStatusIcon.style["font-size"]=(this.groupId==="searchChatId")?"8px":"10px"}if(this.statusElement===p.Away){this.RTElementStatusView.style.background=a.away;this.subTitleElement=h.Away||"Away";this.RTElementStatusIcon.className="fonticon handler fonticon-cancel";this.RTElementStatusIcon.style["font-size"]=(this.groupId==="searchChatId")?"8px":"10px"}}}else{this.RTElementStatusView.style.display="none"}if(this.subTitleElement){if(this.RTSubTitleElementView){this.RTSubTitleElementView.setText(this.subTitleElement)}this.RTTitleElementView.style.top="0px"}else{if(this.RTSubTitleElementView){this.RTSubTitleElementView.style.display="none"}}this.initListner()},initListner:function(){var k=this;e.addEvent(e.eventName.ONELEMENTDRAGSTART,function(l){if(k.controller.getId()===l.userId){k.setDropData(false)}else{k.setDropData(true)}});e.addEvent(e.eventName.ACTIVEELEMENTDRAGANDDROP,function(l){if(l){k.lockDropData=!l;k.setDropData(l)}else{k.setDropData(l);k.lockDropData=!l}})},getView:function(){return this.globalView},setBorder:function(k){},updateStatus:function(l){if(l!==undefined){if(this.RTElementStatusView){if(this.RTElementStatusView.style.display==="none"){this.RTElementStatusView.style.display="inline-block";var k=new UWA.Fx(this.RTElementStatusView,{duration:200,transition:"linear"});k.start({opacity:[0,1]})}this.statusElement=l;this.subTitleElement=h.Offline||"Offline";this.RTElementStatusView.style.background=a.offline;this.RTElementStatusIcon.className="";this.RTElementStatusIcon.style["font-size"]=(this.groupId==="searchChatId")?"4px":"6px";var m=f.getSetting("RTCStatus");if(m){if(this.statusElement===m.Online){this.RTElementStatusView.style.background=a.online;this.subTitleElement=h.Online||"Online";this.RTElementStatusIcon.className="fonticon handler fonticon-check";this.RTElementStatusIcon.style["font-size"]=(this.groupId==="searchChatId")?"8px":"10px"}if(this.statusElement===m.Busy){this.RTElementStatusView.style.background=a.busy;this.subTitleElement=h.Busy||"Busy";this.RTElementStatusIcon.className="fonticon handler fonticon-minus";this.RTElementStatusIcon.style["font-size"]=(this.groupId==="searchChatId")?"8px":"10px"}if(this.statusElement===m.Away){this.RTElementStatusView.style.background=a.away;this.subTitleElement=h.Away||"Away";this.RTElementStatusIcon.className="fonticon handler fonticon-cancel";this.RTElementStatusIcon.style["font-size"]=(this.groupId==="searchChatId")?"8px":"10px"}}if(this.subTitleElement){if(this.RTSubTitleElementView){this.RTSubTitleElementView.style.display="inline-block";var k=new UWA.Fx(this.RTSubTitleElementView,{duration:200,transition:"linear"});k.start({opacity:[0,1]});if(this.RTSubTitleElementView&&this.subTitleElement){this.RTSubTitleElementView.setText(this.subTitleElement)}}if(this.RTTitleElementView){this.RTTitleElementView.style.top="0px"}}}}},setExpand:function(k){var l=0;if(k){l=90}this.RTElementExpander.style.mozTransform="rotate("+l+"deg)";this.RTElementExpander.style.webkitTransform="rotate("+l+"deg)";this.RTElementExpander.style.oTransform="rotate("+l+"deg)";this.RTElementExpander.style.transform="rotate("+l+"deg)"},setEditMode:function(k){this.editMode=k;if(this.editMode){this.removeIcon.style.display="block";this.globalView.style.background="#ffbb69";this.numberOfContactView.style.display="none"}else{this.removeIcon.style.display="none";this.numberOfContactView.style.display="block";if(this.addBorder){this.globalView.style.background="#f3f4f5"}else{this.globalView.style.background="#ffffff"}}},showRemoveElement:function(k){if(k){this.removeIcon.style.display="block"}else{this.removeIcon.style.display="none"}},showAddElement:function(k){if(k){this.addIcon.style.display="block"}else{this.addIcon.style.display="none"}},displayNumberOfContact:function(k){if(this.numberOfContactView){this.numberOfContactView.setText(k)}},setChangeName:function(k){this.editMode=k;if(this.editMode){this.ChangeNameInputView.style.display="block";this.RTElementTxtInfoView.style.display="none"}else{this.ChangeNameInputView.style.display="none";this.RTElementTxtInfoView.style.display="block"}},setDraggable:function(m,l){this.globalView.draggable=m;if(m){var k=this;this.globalView.ondragstart=function(o){e.dispatch(e.eventName.ONELEMENTDRAGSTART,[{userId:k.controller.getId(),groupId:k.controller.groupId}]);var n={userId:k.controller.getId(),userName:k.controller.getUserName(),login:k.controller.getLogin(),status:k.controller.getStatus(),contactGroupId:k.controller.groupId};var p={protocol:"3DXContent",version:"1.0",data:{items:[{serviceId:"3DMessaging",contact:n}]}};var q=JSON.stringify(p);i.debug("RTElementView Drag data : "+q);o.dataTransfer.setData("text",q);if(k.groupId!=="searchChatId"&&k.groupId!=="Recents"&&k.groupId!=="Support"){e.dispatch(e.eventName.DISPLAYTRASHEDZONE,[true])}};this.globalView.ondragend=function(n){i.debug("RTElementView Drag data end");e.dispatch(e.eventName.DISPLAYTRASHEDZONE,[false]);e.dispatch(e.eventName.ONELEMENTDRAGSTOP,[{userId:k.controller.getId(),groupId:k.groupId}])}}else{this.globalView.ondragstart=""}},setDropData:function(l){if(!this.lockDropData){if(l){var k=this;this.globalView.ondrop=function(n){i.debug("RTElementView Drop data");n.preventDefault();var o=n.dataTransfer.getData("text");var m=undefined;o=JSON.parse(o);if(o){if(o.data.items[0].serviceId==="3DMessaging"){m=o.data.items[0].contact}}if(m&&m.userId!==k.controller.getId()){g.dispatch(g.eventName.CREATEGROUP,["GROUPTMP"]);e.dispatch(e.eventName.ONADDCONTACT,[{user:m,group:"GROUPTMP"}]);g.dispatch(g.eventName.REMOVECONTACT,{user:m.userId,group:"_"});var p={userId:k.controller.getId(),userName:k.controller.getUserName(),login:k.controller.getLogin(),status:k.controller.getStatus()};g.dispatch(g.eventName.REMOVECONTACT,{user:p.userId,group:"_"});e.dispatch(e.eventName.ONADDCONTACT,[{user:p,group:"GROUPTMP"}]);e.dispatch(e.eventName.DISPLAYGLISTOFCONTACT,["GROUPTMP"])}};this.globalView.ondragover=function(m){m.preventDefault();k.dragEnter=true;k.RTElementPictureView.style.border="2px solid "+a.online;e.dispatch(e.eventName.LOCKDRAGONMAINVIEW,[true])};this.globalView.ondragleave=function(m){i.debug("RTElementView drag Leave");if(k.dragEnter){k.dragEnter=false;k.RTElementPictureView.style.border="";e.dispatch(e.eventName.LOCKDRAGONMAINVIEW,[false])}}}else{this.globalView.ondrop="";this.globalView.ondragover="";this.globalView.ondragleave=""}}},sendAddContact:function(k){e.dispatch(e.eventName.ONADDCONTACT,[k])},htmlDecode:function(k){if(!k){return null}var l=k.replace(/&gt;/g,">");l=l.replace(/&lt;/g,"<");l=l.replace(/&quot;/g,'"');l=l.replace(/&apos;/g,"'");l=l.replace(/&amp;/g,"&");return l}});return d});define("DS/InstantMessaging/js/view/RTBottomBarView",["UWA/Class","UWA/Class/Events","DS/InstantMessaging/js/controller/RTEventBusController","DS/RTProxyDriver/RTProxyDriver","DS/RTProxyDriver/RTLogger","i18n!DS/InstantMessaging/assets/nls/feed"],function(c,a,b,f,d,e){d.debug("RTBottomBarView load");var g=c.extend(a,{init:function(h){this.controller=h.controller;this.editMode=false;this.dragEnter=false;var i=this;this.globalView=UWA.createElement("div",{"class":"RTBottomBar",id:"RTBottomBar",styles:{height:"60px",border:"3px dashed #EA4F37",margin:"20px",borderRadius:"3px",display:"none",zIndex:3000}});this.iconTrashView=UWA.createElement("span",{"class":"fonticon handler fonticon-trash",styles:{margin:"12px",color:"grey",fontSize:"1.4em","float":"left",cursor:"default"}});this.iconTrashView.inject(this.globalView);this.divTrashView=UWA.createElement("div",{styles:{"float":"left",color:"#EA4F37",width:"170px",height:"100%",position:"relative"}});this.divTrashView.inject(this.globalView);this.textTrashView=UWA.createElement("p",{text:e.DropContactHere,styles:{margin:"0",position:"absolute",top:"50%",transform:"translate(0, -50%)"}});this.textTrashView.inject(this.divTrashView);b.addEvent(b.eventName.DISPLAYTRASHEDZONE,function(j){if(j===true){setTimeout(function(){i.globalView.style.display="block";var k=new UWA.Fx(i.globalView,{duration:200,transition:"linear"});k.start({opacity:[0,1]})},200)}else{i.globalView.style.display="none"}});this.globalView.ondrop=function(j){var l=j.dataTransfer.getData("text");if(l){l=JSON.parse(l);if(l){if(l.data&&l.data.items&&l.data.items[0].serviceId==="3DMessaging"){var k=l.data.items[0].contact;if(k){if(k.idGroup){f.dispatch(f.eventName.REMOVEGROUP,k.idGroup)}else{f.dispatch(f.eventName.REMOVECONTACT,{user:k.userId,group:k.contactGroupId})}}i.dragEnter=false;i.globalView.style.border="3px dashed #EA4F37";i.iconTrashView.style.color="#EA4F37";i.textTrashView.style.color="#EA4F37"}}}};this.globalView.ondragover=function(j){j.preventDefault();i.dragEnter=true;i.globalView.style.border="3px dashed #844138";i.iconTrashView.style.color="#844138";i.textTrashView.style.color="#844138"};this.globalView.ondragleave=function(j){d.debug("RTBottomBarView ondragleave ondragleave");if(i.dragEnter){i.dragEnter=false;i.globalView.style.border="3px dashed #EA4F37";i.iconTrashView.style.color="#EA4F37";i.textTrashView.style.color="#EA4F37"}}},getView:function(){return this.globalView}});return g});define("DS/InstantMessaging/js/view/RTPanelView",["UWA/Class","UWA/Class/Events","DS/RTProxyDriver/RTLogger","DS/InstantMessaging/js/controller/RTEventBusController","DS/InstantMessaging/js/controller/RTSettingController"],function(c,a,d,b,e){d.debug("RTPanelView load");var f=c.extend(a,{init:function(g){d.debug("RTPanelView init");this.controller=g.controller;this.sizeOnY=g.sizeOnY;this.originXPos=g.originXPos;this.originYPos=g.originYPos;this.oldXPos=g.originXPos;this.oldYPos=g.originYPos;this.minimumSize=g.minimumSize;this.minimumResize=g.minimumResize;this.panelLarger=g.panelLarger;this.panelId=g.panelId;this.iconeIconise=g.iconeIconise;this.isMinimize=true;this.isIconise=false;this.dragEnter;var h=this;this.globalView=UWA.createElement("div",{"class":"RTPanel",id:"RTPanel",styles:{bottom:this.originYPos+"px",right:this.originXPos+"px",height:this.minimumSize+"px",width:this.panelLarger+"px"}});var h=this;this.globalView.ondrop=function(i){i.stopPropagation();i.preventDefault()};this.globalView.ondragover=function(j){if(j.dataTransfer&&((j.dataTransfer.files&&j.dataTransfer.files.length>0)||(j.dataTransfer.items&&j.dataTransfer.items.length>0)||j.dataTransfer.types.length>0)){if(!e.getSetting("activeShareFile")&&j.dataTransfer.items[0].kind=="file"){return d.debug("File Sharing not activated")}var l=true;for(var k=0;k<j.dataTransfer.types.length;k++){if(j.dataTransfer.types[k]=="webrtc"){l=false}}if(!l){return true}j.preventDefault();h.dragEnter=true;b.dispatch(b.eventName.ONPANELDRAGOVER,[h.panelId])}};this.globalView.ondragend=function(i){if(h.dragEnter){h.dragEnter=false;b.dispatch(b.eventName.ONPANELDRAGLEAVE,[h.panelId])}}},getView:function(){d.debug("RTPanelView getView");return this.globalView},addElement:function(h){d.debug("RTPanelView addElement");if(h){h.inject(this.globalView);var g=new UWA.Fx(h,{duration:250,transition:"linear"})}},minimize:function(){d.debug("RTPanelView minimize")},iconise:function(h){d.debug("RTPanelView iconise");this.isMinimize=true;this.isIconise=true;this.globalView.style.display="block";if(!h){var g=new UWA.Fx(this.globalView,{duration:200,transition:"linear"});g.start({height:42,width:42,bottom:88,right:13,borderRadius:48})}else{this.setHeight(this.minimumSize);this.setWidth(this.minimumSize)}},maximize:function(){d.debug("RTPanelView maximize");this.isMinimize=false;this.isIconise=false;this.originYPos=0;this.globalView.style.display="flex";var g=new UWA.Fx(this.globalView,{duration:200,transition:"linear"});g.start({height:this.sizeOnY,width:this.panelLarger,borderRadius:"3px",bottom:this.originYPos+"px"})},resizeOn:function(h){d.debug("RTPanelView resizeOn");var g=this;window.onmousemove=function(k){var j=g.globalView.getBoundingClientRect();g.sizeOnY=(j.height+(j.top-k.clientY+20));if(g.sizeOnY<=g.minimumResize){g.sizeOnY=g.minimumResize}var i=document.body.offsetHeight;if(g.sizeOnY>=(i-100)){g.sizeOnY=i-100}g.globalView.style.height=g.sizeOnY+"px";g.controller.dispatchEvent("panelIsResized",[])};window.onmouseup=function(i){window.onmousemove=null}},resizeOff:function(){d.debug("RTPanelView resizeOff");document.onmousemove=null},getOriginPosition:function(){d.debug("RTPanelView getOriginPosition");return{xPosition:this.originXPos,yPosition:this.originYPos}},getOldPosition:function(){d.debug("RTPanelView getOldPosition");return{xPosition:this.oldXPos,yPosition:this.oldYPos}},setOriginPosition:function(g){d.debug("RTPanelView setOriginPosition");this.oldXPos=this.originXPos;this.oldYPos=this.originYPos;if(g.originXPos!=undefined){this.originXPos=g.originXPos}if(g.originYPos!=undefined){this.originYPos=g.originYPos}},move:function(j,h){d.debug("RTPanelView move");var i=this.panelLarger+10;if(h.buddyIcon||(h.buddyIcon&&h.chatIsIconise)){i=36}if(j==="right"){i=-i}this.originXPos=(this.originXPos+i>0)?this.originXPos+i:this.originXPos;var g=new UWA.Fx(this.globalView,{duration:250,transition:"linear"});g.start({right:this.originXPos+"px",bottom:this.originYPos+"px"})},moveToOrigin:function(){d.debug("RTPanelView moveToOrigin");var g=new UWA.Fx(this.globalView,{duration:250,transition:"linear"});g.start({right:this.originXPos+"px",bottom:this.originYPos+"px"})},closePanel:function(){d.debug("RTPanelView closePanel");this.globalView.destroy()},setDisplayPanel:function(g){d.debug("RTPanelView setDisplayPanel");if(g){this.globalView.style.display="block";this.globalView.classList.add("RTPanelSafariFix");this.globalView.style.right=this.originXPos+"px"}else{this.globalView.style.display="none";this.globalView.classList.remove("RTPanelSafariFix")}},getDisplayPanel:function(){d.debug("RTPanelView getDisplayPanel");return this.globalView.style.display!=="none"},getSizeOnY:function(){d.debug("RTPanelView getSizeOnY");return this.sizeOnY},setNotif:function(g){d.debug("RTPanelView setNotif")},setZindex:function(g){d.debug("RTPanelView setZindex");this.globalView.style.zIndex=g},setHeight:function(g){d.debug("RTPanelView setHeight");that.globalView.style.height=g+"px"},setWidth:function(g){d.debug("RTPanelView setWidth");that.globalView.style.width=g+"px"},isAnIcon:function(){d.debug("RTPanelView isAnIcon");return this.isIconise},getWidth:function(){return this.panelLarger}});return f});define("DS/InstantMessaging/js/view/RTSendDataView",["UWA/Class","UWA/Class/Events","DS/InstantMessaging/js/controller/RTEventBusController","DS/RTProxyDriver/RTLogger","DS/W3DXComponents/Views/Item/TileView","UWA/Class/Model","i18n!DS/InstantMessaging/assets/nls/feed"],function(c,a,b,d,f,h,g){d.debug("RTSendDataView load");var e=c.extend(a,{init:function(i){this.isDisplayed=false;this.dragEnter=false;this.panelId=i.panelId;this.timeToClose=undefined;this.globalView=UWA.createElement("div",{"class":"RTSendData",id:"RTSendData",styles:{left:"0px",right:"0px","border-radius":"3px","flex-direction":"row",position:"absolute",top:"42px",bottom:"32px",background:"white",opacity:"0.9",display:"none"}});this.borderView=UWA.createElement("div",{"class":"RTSendDataBorder",id:"RTSendDataBorder",styles:{margin:"20px",position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px",border:"3px dashed #B4B6BA",color:"#B4B6BA"}}).inject(this.globalView);this.infoView=UWA.createElement("div",{"class":"RTSendDataBorder",id:"RTSendDataBorder",styles:{position:"absolute",margin:"0px",top:"50%",transform:"translate(0, -50%)",width:"100%"}}).inject(this.borderView);this.sendDataView=UWA.createElement("span",{"class":"fonticon handler fonticon-popup",styles:{fontSize:"2em",marginLeft:"10px"}}).inject(this.infoView);this.msgTextView=UWA.createElement("div",{"class":"RTSendDataText",id:"RTSendDataText",text:g.SendDataMsg}).inject(this.infoView);var j=this;this.globalView.ondrop=function(k){i.events.ondrop(k);j.dragEnter=false;j.borderView.style.border="3px dashed #B4B6BA";j.borderView.style.color="#B4B6BA";j.display(false)};this.globalView.ondragover=function(k){j.dragEnter=true;j.borderView.style.border="3px dashed #368ec4";j.borderView.style.color="#368ec4";if(j.timeToClose){clearTimeout(j.timeToClose);j.timeToClose=undefined}j.timeToClose=setTimeout(function(){j.display(false)},1000)};this.globalView.ondragleave=function(k){d.debug("Leave");if(j.dragEnter){j.dragEnter=false;j.borderView.style.border="3px dashed #B4B6BA";j.borderView.style.color="#B4B6BA"}}},getView:function(){return this.globalView},generateViewFromNetvibes:function(o){if(!o){return false}var t,r,s,k,l,m,j,i=new DOMParser();try{t=i.parseFromString(o,"text/xml");r=t.getElementsByClassName("item-title")[0].innerHTML;s=t.getElementsByClassName("item-preview")[0].innerHTML;j=t.getElementsByClassName("item-feedinfo-image")[0];m=j&&j.getAttribute?j.getAttribute("style"):null;l=m?m.substring(m.indexOf('"')+1,m.lastIndexOf('"')):null;k=t.getElementsByClassName("item-time")[0].innerHTML}catch(p){d.debug(p);return false}if(!r||typeof r!="string"){return false}try{var n=new h({image:l,title:r,subtitle:k,content:s});var q=new f({model:n});q=q.render().getContent();if(!l){q.getElementsByClassName("tile-header")[0].style.display="none"}q.getElementsByClassName("tile-sub-container")[0].style.width="100%";q.getElementsByTagName("progress")?q.getElementsByTagName("progress")[0].style.display="none":null;return q.innerHTML}catch(p){d.debug("RTSendDataView unable to construct TileView : "+p);return false}},generateViewFromTile:function(m){if(!m){return false}var l=document.activeElement.contentWindow.document.getElementsByClassName(" tile-title");for(var k=0;k<l.length;k++){var j=l[k];if(j.innerHTML===m.displayName){var n=l[k].parentElement.parentElement.parentElement.cloneNode(true);n=n.children[1];n.removeChild(n.children[2]);n.children[1].removeChild(n.children[1].children[3]);n.children[1].removeChild(n.children[1].children[3]);if(n.children[1].children[3]){n.children[1].removeChild(n.children[1].children[3])}return n.innerHTML}}return false},generateViewFromJson:function(o,n){var j=new h({image:o.displayPreview,icon:o.displayIcon,title:o.displayName,subtitle:o.objectType,content:o.content});var m=new f({model:j});m=m.render().getContent();if(!(j.image||j._attributes.image)){m.getElementsByClassName("tile-header")[0].style.display="none"}else{if(m.getElementsByTagName("img")&&m.getElementsByTagName("img")[0]){m.getElementsByTagName("img")[0].setAttribute("onerror",'this.onerror=null; this.parentElement.style.display="none"')}}m.getElementsByClassName("tile-sub-container")[0].style.width="100%";if(m.getElementsByTagName("progress")){n?m.getElementsByTagName("progress")[0].style.width="100%":m.getElementsByTagName("progress")[0].style.display="none"}var l=m.getElementsByClassName("tile-icon");for(var k=0;k<l.length;k++){if(l[k].src.indexOf("fonticon:")==0){l[k].outerHTML="<span style='position:absolute' class='fonticon fonticon-"+l[k].src.replace("fonticon:","")+"'></span>"}}return m.innerHTML},generateViewFromUrl:function(i){if(!i||typeof i!="string"){return false}else{return'<a href="'+i+'" target="_blank" >'+i+"</a>"}},generateViewFromImage:function(i){if(!i||typeof i!="string"){return false}if(i.indexOf("<img")==0){var j=document.createElement("div");j.innerHTML=i;i=j.firstChild.src}return'<img onerror="this.onerror=null; this.style.display=\'none\';" src="'+i+'"/>'},getURLFromImageString:function(j){if(!j||typeof j!="string"){return false}if(j.indexOf("<img")!=0){return false}var i=document.createElement("div");i.innerHTML=j;return i.firstChild.src},generateViewFromLink:function(k){if(!k||typeof k!="string"){return false}var l=document.createElement("div");l.innerHTML=k;var j=l.getElementsByTagName("a");var i=j&&j.length?j[0]:null;if(!i){return false}i.target="_blank";l=document.createElement("div");l.appendChild(i);return l.innerHTML},generateViewFromFile:function(j){if(!j||!j.fileId||!j.fileName||!j.fileLength){return d.debug("RTSendDataView generateViewFromFile bad args")}var i=this.generateViewFromJson({displayIcon:"fonticon:doc-text-inv",displayName:g.fileTransfer,subtitle:j.fileName,content:j.fileName},false);i="<div id='"+j.fileId+"' style='width:100%'>"+i+"</div>";return i},display:function(k){if(this.isDisplayed!==k){this.isDisplayed=k;if(k){var i=new UWA.Fx(this.globalView,{duration:200,transition:"linear"});this.globalView.style.display="block";i.start({opacity:[0,0.9]})}else{var j=this;var i=new UWA.Fx(this.globalView,{duration:200,transition:"linear",events:{onComplete:function(l){j.globalView.style.display="none"}}});i.start({opacity:[0.9,0]})}}}});return e});define("DS/InstantMessaging/js/view/RTGroupView",["UWA/Class","UWA/Class/Events","DS/InstantMessaging/js/view/RTSearchView","DS/InstantMessaging/js/view/RTElementView","DS/InstantMessaging/js/controller/RTEventBusController","DS/RTProxyDriver/RTProxyDriver","DS/RTProxyDriver/RTLogger","DS/UIKIT/Input/Text","DS/UIKIT/Scroller","i18n!DS/InstantMessaging/assets/nls/feed","DS/InstantMessaging/js/controller/RTSettingController","DS/RTColors/RTColors"],function(b,m,e,f,g,j,l,d,c,k,h,a){l.debug("RTGroupView load");var i=b.extend(m,{init:function(n){this.numberOfContact=0;this.pictureListPreview=[];this.expand=0;this.controller=n.controller;this.groupType=n.groupType;this.idGroup=n.idElement;this.isDraggable=n.isDraggable;this.isHidden=false;this.dragEnter=false;this.displayNumberOfcontact=n.displayNumberOfcontact;this.isLocked=n.isLocked;this.titleElement=undefined;this.resizeViewFX=undefined;var p=this;if(this.idGroup==="searchChatId"){this.globalView=UWA.createElement("div",{"class":"RTGroupSearch",id:"RTGroupSearch"})}else{this.globalView=UWA.createElement("div",{"class":"RTGroupContact",id:"RTGroupContact"});this.globalPreview=UWA.createElement("div",{"class":"RTGroupPreview",id:"RTGroupPreview",events:{mouseover:function(q){q.stopPropagation();p.globalView.style.cursor="pointer"},mouseout:function(q){q.stopPropagation();p.globalView.style.cursor="default"},click:function(q){q.stopPropagation();l.debug("Group");g.dispatch(g.eventName.ACTIVEELEMENTDRAGANDDROP,[false]);g.dispatch(g.eventName.ACTIVEBUDDYSCROLLER,[false]);p.setDisplayListOfContact(true)}}});this.globalPreview.inject(this.globalView);this.picturePreview=UWA.createElement("div",{"class":"RTGroupPicturePreview",id:"RTGroupPicturePreview"});this.picturePreview.inject(this.globalPreview);this.pView=[];for(var o=0;o<4;o++){this.pView.push(UWA.createElement("img",{draggable:false,styles:{width:"50%",height:"50%","float":"left",border:"1px solid white",display:"none"}}));this.pView[o].inject(this.picturePreview)}this.groupNameView=UWA.createElement("div",{"class":"RTGroupNamePreview",id:"RTGroupNamePreview",text:this.htmlDecode(this.idGroup)});this.groupNameView.inject(this.globalPreview);this.listOfContactView=UWA.createElement("div",{"class":"RTGroupListContact",id:"RTGroupListContact"});this.scrollerView=new c({element:UWA.createElement("div",{"class":"scrollable-body",styles:{height:"100%",margin:"auto",background:"white",position:"absolute",left:"0px",right:"0px",bottom:"0px","margin-left":"300px",display:"none","z-index":"1"},html:this.listOfContactView})}).inject(this.globalView);if(this.listOfContactView){this.closeListOfContactView=UWA.createElement("div",{events:{mouseover:function(){p.closeListOfContactView.style.cursor="pointer"},mouseout:function(){p.closeListOfContactView.style.cursor="default"},click:function(){l.debug("Group");if(p.groupNameInput){if(p.expand&&p.groupNameInput.getValue()!==""&&p.groupNameInput.getValue()!=="Add Name"){g.dispatch(g.eventName.ACTIVEELEMENTDRAGANDDROP,[true]);g.dispatch(g.eventName.ACTIVEBUDDYSCROLLER,[true]);p.setDisplayListOfContact(false);if(p.groupNameInput.getValue()!==p.htmlDecode(p.idGroup)){j.dispatch(j.eventName.RENAMEGROUPVIEW,[{oldName:p.idGroup,newName:p.groupNameInput.getValue()}])}}else{p.groupNameInput.elements.container.style.border="1px solid "+a.busy}}}}});this.leftArrowIcon=UWA.createElement("span",{"class":"fonticon handler fonticon-left-open",styles:{fontSize:"2em","float":"left",color:"#77797c",marginTop:"6px"}});this.leftArrowIcon.inject(this.closeListOfContactView);this.closeListOfContactView.inject(this.listOfContactView);this.groupNameInput=new d({placeholder:k.AddName,value:this.htmlDecode(this.idGroup),events:{onKeyDown:function(q){p.groupNameInput.elements.container.style.border=""}}});if(this.isLocked){this.groupNameInput.disable()}this.groupNameInput.inject(this.listOfContactView);this.contactsView=UWA.createElement("div",{"class":"RTGroupContactsView",id:"RTGroupContactsView"});this.contactsView.inject(this.listOfContactView);if(this.isDraggable){this.setDraggable(true)}}}if(n.isHidden!==undefined){this.setIsHidden(n.isHidden)}this.displayMsg=undefined;this.initListner()},initListner:function(){var n=this;g.addEvent(g.eventName.DISPLAYGLISTOFCONTACT,function(o){if(n.idGroup===o&&n.idGroup==="GROUPTMP"){n.setDisplayListOfContact(true);g.dispatch(g.eventName.ACTIVEBUDDYSCROLLER,[false]);l.debug("RTGroupView : Group creation => rename GROUPTMP.")}});g.addEvent(g.eventName.ACTIVEELEMENTDRAGANDDROP,function(o){n.setDropData(o)});g.addEvent(g.eventName.ONELEMENTDRAGSTART,function(o){if(n.idGroup===o.groupId&&n.idGroup==="searchChatId"){n.setActiveResultOfSearch(false)}});g.addEvent(g.eventName.ONELEMENTDRAGSTOP,function(o){if(n.idGroup===o.groupId&&n.idGroup==="searchChatId"){n.setActiveResultOfSearch(true)}})},getView:function(){return this.globalView},addTitle:function(n){var o=this;if(this.groupType==="search"){this.titleGroup=new e(n);if(this.titleGroup){var p=this.titleGroup.getView();p.inject(this.globalView)}}},addContact:function(n,o){if(n){this.numberOfContact++;this.pictureListPreview.push({idElement:n.getId(),src:n.pathPictureUser,view:undefined});var p=n.getView();if(this.idGroup==="searchChatId"){p.inject(this.globalView);if(o){this.expand=1}}else{p.inject(this.contactsView);this.renderPreview()}}},renderPreview:function(){if(this.pictureListPreview.length<7){var o=UWA.createElement("img",{draggable:false,src:this.pictureListPreview[this.pictureListPreview.length-1].src,styles:{width:"30%",height:"30%","float":"left",maxWidth:"48px",maxHeight:"48px","border-radius":"48px",margin:"1px"}});var n={handleEvent:function(q){var p=h.getSetting("defaultAvatarURL")||"./resources/en/1/webapps/InstantMessaging/assets/avatarDefault.png";l.debug("RTGroupView : User avatar has not been found, setting the default one.");if(p&&o.src){o.src=p}o.removeEvent("error",this)}};o.addEvent("error",n);this.pictureListPreview[this.pictureListPreview.length-1].view=o;if(this.picturePreview.children.length<10){o.inject(this.picturePreview)}}},dislayMessage:function(n){if(this.displayMsg!==undefined){this.removeMessage()}this.displayMsg=UWA.createElement("div",{text:n,styles:{fontStyle:"italic",margin:"8px"}});this.displayMsg.inject(this.globalView);this.expand=1;this.numberOfContact++},removeMessage:function(){if(this.displayMsg){this.displayMsg.destroy()}},removeMember:function(s){var r=this;if(s){this.numberOfContact--;var o=s.getView();var q=new UWA.Fx(o,{duration:200,transition:"linear",events:{onComplete:function(){o.destroy();r.displayNumberOfContact()}}});q.start({height:"0px",opacity:0});var n=-1;for(var p=0;p<this.pictureListPreview.length;p++){if(this.pictureListPreview[p].idElement===s.getId()){n=p}}if(n>-1&&this.pictureListPreview[n].view){this.pictureListPreview[n].view.parentNode.removeChild(this.pictureListPreview[n].view);this.pictureListPreview.splice(n,1)}}},resizeView:function(){var o=this;var n="34px";if(this.isHidden){n="0px"}if(this.numberOfContact===0){this.expand=0}if(this.expand){n=(34+this.numberOfContact*40)+"px"}if(!this.resizeViewFX){this.resizeViewFX=new UWA.Fx(this.globalView,{duration:200,transition:"linear"})}if(this.titleElement){if(!o.isHidden&&n!=="34px"){this.titleElement.setExpand(true)}else{this.titleElement.setExpand(false)}}this.resizeViewFX.stop();this.resizeViewFX.start({height:n})},displayNumberOfContact:function(){if(this.titleElement){var n=this.controller.getNumberOfContact();if(n===0){n=""}this.titleElement.displayNumberOfContact(n)}},setIsHidden:function(n){var p=this;if(this.isHidden!==n){this.isHidden=n;this.expand=0;if(this.idGroup==="searchChatId"){this.resizeView()}else{if(n){this.globalView.style.display="none"}else{this.globalView.style.display="block";var o=new UWA.Fx(this.globalView,{duration:200,transition:"linear"});o.start({opacity:[0,1]})}}}},setDropData:function(o){if(o&&!this.isLocked){var n=this;this.globalView.ondrop=function(p){n.controller.onDragOver(p);n.dragEnter=false;n.picturePreview.style.border="1px solid "+a.offline};this.globalView.ondragover=function(p){p.preventDefault();n.dragEnter=true;if(!n.expand){if(n.picturePreview){n.picturePreview.style.border="2px solid limegreen"}g.dispatch(g.eventName.LOCKDRAGONMAINVIEW,[true])}};this.globalView.ondragleave=function(p){l.debug("Leave");if(n.dragEnter){n.dragEnter=false;if(n.picturePreview){n.picturePreview.style.border="1px solid "+a.offline}g.dispatch(g.eventName.LOCKDRAGONMAINVIEW,[false])}}}else{this.globalView.ondrop="";this.globalView.ondragover="";this.globalView.ondragleave=""}},setEditMode:function(n){if(this.titleElement){this.titleElement.setEditMode(n)}},setChangeName:function(n){this.titleElement.setChangeName(n);this.globalView.style.border="solid 1px rgb(0, 86, 134)"},setDisplayListOfContact:function(o){this.expand=!this.expand;var n=new UWA.Fx(this.scrollerView.getContent(),{duration:300,transition:"linear"});if(o){this.setDraggable(false);if(this.idGroup==="GROUPTMP"){if(this.groupNameInput){this.groupNameInput.setValue("")}}this.scrollerView.getContent().style.display="block";n.start({marginLeft:[300,0]})}else{if(this.isDraggable){this.setDraggable(true)}n.start({marginLeft:[0,300]})}},setDraggable:function(o){this.globalView.draggable=o;if(o){var n=this;this.globalView.ondragstart=function(p){var s={idGroup:n.idGroup};var q={protocol:"3DXContent",version:"1.0",data:{items:[{serviceId:"3DMessaging",contact:s}]}};var r=JSON.stringify(q);p.dataTransfer.setData("text",r);g.dispatch(g.eventName.DISPLAYTRASHEDZONE,[true]);g.dispatch(g.eventName.ACTIVEELEMENTDRAGANDDROP,[false])};this.globalView.ondragend=function(p){g.dispatch(g.eventName.DISPLAYTRASHEDZONE,[false]);g.dispatch(g.eventName.ACTIVEELEMENTDRAGANDDROP,[true])}}else{this.globalView.ondragstart=""}},setActiveResultOfSearch:function(q){var p=this;var n="32px";if(q===true){n=(38+this.controller.getNumberOfContact()*38)+"px"}var o=new UWA.Fx(this.globalView,{duration:200,transition:"linear"});o.start({height:n})},clearInput:function(){this.titleGroup.clearInput()},htmlDecode:function(n){var o=n.replace(/&gt;/g,">");o=o.replace(/&lt;/g,"<");o=o.replace(/&quot;/g,'"');o=o.replace(/&apos;/g,"'");o=o.replace(/&amp;/g,"&");return decodeURIComponent(o)}});return i});define("DS/InstantMessaging/js/view/RTOfflineView",["UWA/Class","UWA/Class/Events","DS/UIKIT/Spinner","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/RTProxyDriver/RTLogger","DS/InstantMessaging/js/controller/RTSettingController","DS/InstantMessaging/js/controller/RTEventBusController","i18n!DS/InstantMessaging/assets/nls/feed"],function(b,j,c,a,d,i,f,e,h){i.debug("RTOfflineView load");var g=b.extend(j,{init:function(k){var l=this;this.SignInIsDisplayed=false;this.globalView=UWA.createElement("div",{"class":"RTOffline",id:"RTOffline",styles:{width:"100%",height:"100%",background:"white",position:"absolute",zIndex:"1"}});this.spinnerView=UWA.createElement("div",{"class":"RTOfflineSpinner",id:"RTOfflineSpinner",styles:{marginTop:"50%"}}).inject(this.globalView);this.spinner=new c({visible:true,className:"large"});this.spinner.inject(this.spinnerView);this.offlineView=UWA.createElement("div",{"class":"RTOfflineInfoView",id:"RTOfflineInfoView",styles:{display:"none",top:"80px",bottom:"0px",right:"0px",left:"0px",width:"100%"}}).inject(this.globalView);this.InfoView=UWA.createElement("div",{"class":"RTInfoOffline",id:"RTInfoOffline",styles:{marginTop:"70px"}}).inject(this.offlineView);this.TxtView=UWA.createElement("div",{"class":"RTInfoTxtOffline",id:"RTInfoTxtOffline",text:h.OfflineMessage,styles:{fontSize:"1.1em",color:"#77797c"}}).inject(this.InfoView)},buildSignInView:function(k){var m=this;this.signInView=UWA.createElement("div",{"class":"RTSignInView",id:"RTSignInView",styles:{display:"none",top:"80px",bottom:"0px",right:"0px",left:"0px",margin:"10px",marginTop:"10px"}}).inject(this.globalView);var q=[];for(var n in k){q.push({value:n,label:k[n].displayname})}if(q.length==1){q[0].selected=true}var o=new a({nativeSelect:false,custom:true,placeholder:h.SelectPlatform,options:q,styles:{margin:"5px"}});o.elements.container.style.margin="10px";o.inject(this.signInView);var l=new d({value:h.Signin,icon:"play",className:"primary"}).inject(this.signInView);l.addEvent("onClick",function(){var p=o.getValue();if(p[0]){f.setSetting("currentPlateformId",p[0]);window.sessionStorage.setItem("3DIMfavoriteTenant",p[0]);e.dispatch(e.eventName.RESTARTLOGIN,[]);m.activeOfflineView(false)}})},getView:function(){return this.globalView},activeOfflineView:function(m){var l=this;if(m){this.globalView.style.display="block";var k=new UWA.Fx(this.globalView,{duration:200,transition:"linear"});k.start({opacity:[0,1]})}else{var k=new UWA.Fx(this.globalView,{duration:200,transition:"linear",events:{onComplete:function(n){l.globalView.style.display="none"}}});k.start({opacity:[1,0]})}},activeSpinner:function(k){if(k){this.offlineView.style.display="none";this.signInView.style.display="none";this.spinnerView.style.display="block"}else{this.spinnerView.style.display="none"}},activeOffline:function(k){if(!this.SignInIsDisplayed){if(k){if(this.spinnerView&&this.spinnerView.style){this.spinnerView.style.display="none"}if(this.signInView&&this.signInView.style){this.signInView.style.display="none"}if(this.offlineView&&this.offlineView.style){this.offlineView.style.display="block"}}else{if(this.offlineView&&this.offlineView.style){this.offlineView.style.display="none"}}}},activeSignIn:function(l,k){if(!this.signInView){this.buildSignInView(k)}if(l){this.spinnerView.style.display="none";this.offlineView.style.display="block";this.signInView.style.display="block"}else{this.signInView.style.display="none"}this.SignInIsDisplayed=l}});return g});define("DS/InstantMessaging/js/view/RTAddContactView",["UWA/Class","UWA/Class/Events","DS/InstantMessaging/js/controller/RTEventBusController","DS/RTProxyDriver/RTProxyDriver","DS/RTProxyDriver/RTLogger","i18n!DS/InstantMessaging/assets/nls/feed"],function(c,a,b,g,e,f){e.debug("RTAddContactView load");var d=c.extend(a,{init:function(h){this.dragEnter=false;var i=this;this.globalView=UWA.createElement("div",{"class":"RTAddContact",id:"RTAddContact",styles:{height:"84px",width:"84px",border:"3px dashed #B4B6BA",margin:"1px",borderRadius:"3px"}});this.iconPlusView=UWA.createElement("span",{"class":"fonticon handler fonticon-user-add",styles:{marginTop:"4px",color:"#B4B6BA",fontSize:"1.6em"}});this.iconPlusView.inject(this.globalView);this.textAddView=UWA.createElement("div",{text:f.AddContactHere,styles:{"float":"left",color:"#B4B6BA",padding:"1px"}});this.textAddView.inject(this.globalView);this.globalView.ondrop=function(k){e.debug("RTAddContactView Drop data");k.preventDefault();var l=k.dataTransfer.getData("text");var j=undefined;l=JSON.parse(l);if(l){if(l.data.items[0].serviceId==="3DMessaging"){j=l.data.items[0].contact}}if(j){b.dispatch(b.eventName.ONADDCONTACT,[{user:j,group:"_"}])}};this.globalView.ondragover=function(j){j.preventDefault();i.dragEnter=true;i.globalView.style.border="3px dashed #368ec4";i.iconPlusView.style.color="#368ec4";i.textAddView.style.color="#368ec4"};this.globalView.ondragleave=function(j){e.debug("RTAddContactView ondragleave");if(i.dragEnter){i.dragEnter=false;i.globalView.style.border="3px dashed #B4B6BA";i.iconPlusView.style.color="#B4B6BA";i.textAddView.style.color="#B4B6BA"}}},getView:function(){return this.globalView},destroy:function(){this.globalView.destroy()}});return d});define("DS/InstantMessaging/js/view/RTTitleView",["UWA/Class","UWA/Class/Events","DS/InstantMessaging/js/controller/RTSettingController","DS/InstantMessaging/js/controller/RTEventBusController","DS/RTProxyDriver/RTLogger","DS/UIKIT/DropdownMenu","DS/RTProxyDriver/RTProxyDriver","i18n!DS/InstantMessaging/assets/nls/feed","DS/RTColors/RTColors","DS/UIKIT/Tooltip"],function(c,k,e,d,j,b,g,i,a,f){j.debug("RTTitleView load");var h=c.extend(k,{init:function(m){j.debug("RTTitleView init");this.panelId=m.panelId;this.titleName=m.titleName;this.titleName.txt=this.htmlDecode(decodeURI(this.titleName.txt));this.eventResizePanel=m.eventResizePanel;this.iconActions=m.iconActions;this.minimizeButton=m.minimizeButton;this.closeButton=m.closeButton;this.menuButton=m.menuButton;this.iconPath=m.iconPath;this.noAction=m.noAction;this.iconiseAll=m.iconiseAll;this.picture=m.picture;this.status=m.status;this.activeMenu=m.activeMenu;this.active3DIM=m.active3DIM;this.isMaximize=true;var p=this;this.globalView=UWA.createElement("div",{"class":"RTTitle",id:"RTTitle"});this.resizeView=UWA.createElement("div",{"class":"RTTitleResize",id:"RTTitleResize",events:{mousedown:function(t){t=t||window.event;p.dispatchEvent(p.eventResizePanel.MouseDown,t);j.debug(p.eventResizePanel.MouseDown);t.preventDefault();UWA.Event.stop(t)},mouseup:function(){p.dispatchEvent(p.eventResizePanel.MouseUp,[]);j.debug(p.eventResizePanel.MouseUp)}}});if(this.iconPath){this.iconTitleView=UWA.createElement("span",{"class":"fonticon handler "+this.iconPath,styles:{margin:"3px 0px 0px 6px",color:"white",fontSize:"1.2em","float":"left"},events:{click:function(){if(!p.isMaximize){p.maximize()}else{p.iconise()}}}})}else{this.iconTitleView=UWA.createElement("div",{styles:{margin:"12px",background:a.offline,"float":"left",borderRadius:"16px",width:"16px",height:"16px",marginRight:"0px","text-align":"center"},events:{click:function(){if(!p.isMaximize){p.maximize()}else{p.iconise()}}}})}this.iconTitleViewIcon=UWA.createElement("span",{"class":"",styles:{color:"white","font-size":"5px",position:"relative",top:"-4px","font-weight":"bold"}});this.iconTitleViewIcon.inject(this.iconTitleView);this.iconTitleView.inject(this.globalView);if(this.activeMenu){this.statusMenuIcon=UWA.createElement("span",{"class":"fonticon handler fonticon-down-open",styles:{margin:"10px 0px","float":"left",background:"#005686",opacity:"0.2",color:"white"},events:{mouseover:function(t){p.statusMenuIcon.style.opacity=1},mouseout:function(){p.statusMenuIcon.style.opacity=0.1}}});this.statusMenuIcon.inject(this.globalView)}if(this.status){var s=e.getSetting("RTCStatus");if(s){if(this.status===s.Online){this.iconTitleView.style.background=a.online;this.iconTitleViewIcon.className="fonticon handler fonticon-check";this.iconTitleViewIcon.style["font-size"]="8px";this.iconTitleViewIcon.style.top="-3px"}if(this.status===s.Busy){this.iconTitleView.style.background=a.busy;this.iconTitleViewIcon.className="fonticon handler fonticon-minus";this.iconTitleViewIcon.style["font-size"]="8px";this.iconTitleViewIcon.style.top="-3px"}if(this.status===s.Away){this.iconTitleView.style.background=a.away;this.iconTitleViewIcon.className="fonticon handler fonticon-cancel";this.iconTitleViewIcon.style["font-size"]="8px";this.iconTitleViewIcon.style.top="-3px"}}}if(this.titleName){this.titleNameView=UWA.createElement("div",{"class":"RTTitleName",id:"RTTitleName",text:this.titleName.txt,events:{click:function(){if(!p.isMaximize){p.maximize()}else{p.iconise()}}}});this.titleNameView.inject(this.globalView)}if(!this.noAction){this.actionsView=UWA.createElement("div",{"class":"RTTitleAction",id:"RTTitleAction"});if(this.minimizeButton){UWA.createElement("span",{"class":"fonticon handler fonticon-minus",styles:{margin:"5px",color:"white",fontSize:"1.2em","float":"right",verticalAlign:"sub",display:"none"},events:{click:function(){p.iconise()}}}).inject(this.actionsView)}if(this.iconiseAll){UWA.createElement("span",{"class":"fonticon handler fonticon-resize-small",events:{click:function(){d.dispatch(d.eventName.ICONISEALLCLICK,[])}}}).inject(this.actionsView)}this.coreviewButton=UWA.createElement("span",{"class":"fonticon handler fonticon-monitor ",styles:{display:"none"},events:{}}).inject(this.actionsView);this.coreviewButton.tooltip=new f({target:this.coreviewButton,position:"bottom",body:i.TooltipCoreview||"Coreview"});this.coreviewButton.tooltip.getContent().style.zIndex="30000";if(this.menuButton){this.buttonMenu=UWA.createElement("span",{"class":"fonticon handler fonticon-down-open ",styles:{},events:{}}).inject(this.actionsView);var l=(function(t,u){return function(){console.log("start video call from "+t+" to "+u);g.dispatch("startCall",[{login:u,type:"video"}])}})(e.getSetting("userLogin"),this.panelId.split("@")[0]);var n=(function(t,u){return function(){console.log("start video call from "+t+" to "+u);g.dispatch("startCall",[{login:u,type:"audio"}])}})(e.getSetting("userLogin"),this.panelId.split("@")[0]);var r=true;var q=true;if(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0){r=false}if(e.getSetting("webrtc3DIM")){this.dropdownMenuArchive=new b({target:this.buttonMenu,items:[{id:"DownloadHistoryOption",text:i.buttonSendHistory||"Download history",fonticon:"download",className:"historyButton",handler:q?function(){p.mail()}:null},{text:i.buttonClearHistory||"Clean history",fonticon:"trash",className:"historyButton",handler:function(){p.trash()}},{className:"divider"},{id:"VideoCallOption",text:i.videoCall||"Video Call",className:"callButton",fonticon:"videocamera",handler:r?l:null},{id:"AudioCallOption",text:i.audioCall||"Audio Call",className:"callButton",fonticon:"phone",handler:r?n:null}]});if(!r){this.dropdownMenuArchive.getContent().getElementsByClassName("callButton")[0].style.opacity=0.5;this.dropdownMenuArchive.getContent().getElementsByClassName("callButton")[1].style.opacity=0.5;this.notCompatibleTooltip=new f({target:this.dropdownMenuArchive.getContent().children[0].children.VideoCallOption,position:"left",trigger:"click touch hover",body:i.notCompatible});this.notCompatibleTooltip.getContent().style.zIndex="30000";this.notCompatibleTooltip=new f({target:this.dropdownMenuArchive.getContent().children[0].children.AudioCallOption,position:"left",trigger:"click touch hover",body:i.notCompatible});this.notCompatibleTooltip.getContent().style.zIndex="30000"}if(!q){this.dropdownMenuArchive.getContent().getElementsByClassName("historyButton")[0].style.opacity=0.5;this.notCompatibleTooltip=new f({target:this.dropdownMenuArchive.getContent().children[0].children.DownloadHistoryOption,position:"left",trigger:"click touch hover",body:i.notCompatible});this.notCompatibleTooltip.getContent().style.zIndex="30000"}}else{this.dropdownMenuArchive=new b({target:this.buttonMenu,items:[{text:i.buttonSendHistory||"Download history",fonticon:"download",className:"historyButton",handler:function(){p.mail()}},{text:i.buttonClearHistory||"Clean history",fonticon:"trash",className:"historyButton",handler:function(){p.trash()}}]})}this.dropdownMenuArchive.getContent().style.zIndex="3000";var o=this.buttonMenu;this.dropdownMenuArchive.activateCallButtons=function(){if(!this.elements||!this.elements.container||!this.elements.container.getElementsByClassName("callButton")||!this.elements.container.getElementsByClassName("callButton").item(0)){return true}var t=this.elements.container.getElementsByClassName("callButton");for(var u=0;u<t.length;u++){t.item(u).show()}o.show()};this.dropdownMenuArchive.deactivateCallButtons=function(){if(!this.elements||!this.elements.container||!this.elements.container.getElementsByClassName("callButton")||!this.elements.container.getElementsByClassName("callButton").item(0)){return true}var t=this.elements.container.getElementsByClassName("callButton");for(var u=0;u<t.length;u++){t.item(u).hide()}if(!this.elements.container.getElementsByClassName("historyButton")||!this.elements.container.getElementsByClassName("historyButton").item(0)||this.elements.container.getElementsByClassName("historyButton").item(0).isHidden()){o.hide()}};this.dropdownMenuArchive.activateHistoryButtons=function(){if(!this.elements||!this.elements.container||!this.elements.container.getElementsByClassName("historyButton")||!this.elements.container.getElementsByClassName("historyButton").item(0)){return true}var t=this.elements.container.getElementsByClassName("historyButton");for(var u=0;u<t.length;u++){t.item(u).show()}o.show()};this.dropdownMenuArchive.deactivateHistoryButtons=function(){if(!this.elements||!this.elements.container||!this.elements.container.getElementsByClassName("historyButton")||!this.elements.container.getElementsByClassName("historyButton").item(0)){return true}var t=this.elements.container.getElementsByClassName("historyButton");for(var u=0;u<t.length;u++){t.item(u).hide()}if(!this.elements.container.getElementsByClassName("callButton")||!this.elements.container.getElementsByClassName("callButton").item(0)||this.elements.container.getElementsByClassName("callButton").item(0).isHidden()){o.hide()}};this.dropdownMenuArchive.deactivateHistoryButtons()}if(this.closeButton){UWA.createElement("span",{"class":"fonticon handler fonticon-cancel",events:{click:function(){p.close()}}}).inject(this.actionsView)}this.actionsView.inject(this.globalView)}this.resizeView.inject(this.globalView);if(this.activeMenu){g.addEvent(g.eventName.SETSTATUS,function(t){p.setStatus(t)});g.addEvent(g.eventName.ONPRESENCERECEIVED,function(t){j.debug("RTTitleView : ONPRESENCERECEIVED");var v=t.userId.split("@");var u=e.getSetting("userLogin");if(v[0]===u){var w=e.getSetting("RTCStatus");p.setStatus({myStatus:t.status});p.iconTitleView.style.background=a.offline;p.iconTitleViewIcon.className="";p.iconTitleViewIcon.style["font-size"]="5px";p.iconTitleViewIcon.style.top="-3px";if(p.dropdownMenuArchive&&!document.callAlwaysAvailable){p.dropdownMenuArchive.deactivateCallButtons()}if(w){if(t.status===w.Online){p.iconTitleView.style.background=a.online;p.iconTitleViewIcon.className="fonticon handler fonticon-check";p.iconTitleViewIcon.style["font-size"]="8px";p.iconTitleViewIcon.style.top="-3px";if(p.dropdownMenuArchive&&(e.getSetting("userStatus")=="Online"||document.callAlwaysAvailable)){p.dropdownMenuArchive.activateCallButtons()}}if(t.status===w.Busy){p.iconTitleView.style.background=a.busy;p.iconTitleViewIcon.className="fonticon handler fonticon-minus";p.iconTitleViewIcon.style["font-size"]="8px";p.iconTitleViewIcon.style.top="-3px"}if(t.status===w.Away){p.iconTitleView.style.background=a.away;p.iconTitleViewIcon.className="fonticon handler fonticon-cancel";p.iconTitleViewIcon.style["font-size"]="8px";p.iconTitleViewIcon.style.top="-3px"}}}})}this.initListner()},initListner:function(){var l=this;d.addEvent(d.eventName.ONMAXIMIZEDCLICK,function(m){if(m===l.panelId){l.isMaximize=true}});d.addEvent(d.eventName.ONICONISEPANELCLICK,function(m){if(m===l.panelId){l.isMaximize=false}});if(this.statusMenuIcon){d.addEvent(d.eventName.LISTSTATUSRECEIVED,function(m){l.buildDropDownMenu()});g.addEvent(g.eventName.DISCONNECTED,function(m){l.statusMenuIcon.style.display="none";l.setStatus({myStatus:"Offline"});g.dispatch(g.eventName.SETSTATUS,{myStatus:"Offline",statusMsg:"Offline"});d.dispatch(d.eventName.SIGNOUT,[])});g.addEvent(g.eventName.CONNECTED,function(m){l.statusMenuIcon.style.display="block"})}},buildDropDownMenu:function(){j.debug("RTTitleView buildDropDownMenu");var n=this;if(this.statusMenuIcon){this.statusMenuIcon.style.display="";this.dropdownMenu=new b({target:this.statusMenuIcon,items:[],events:{onClick:function(t,s){if(s["data-id"]==="signOutAction"){j.debug("Clik menu signOutAction");d.dispatch(d.eventName.SIGNOUT,[])}else{j.debug("Clik menu");g.dispatch(g.eventName.SETSTATUS,{myStatus:s.name,statusMsg:s.name})}}}});this.dropdownMenu.getContent().style.zIndex="3000";var r=e.getSetting("RTCStatus");var m;for(var l in r){if(l=="Offline"||l=="Away"){m="Appear"+l;if(!i[m]){m=l}}else{m=l}this.dropdownMenu.addItem({text:i[m],name:l,icon:(l==="Online")?"fonticon fonticon-check":""})}if(this.active3DIM&&Object.keys(this.active3DIM).length>1){var q=this.active3DIM;var o=0;for(var p in q){if(q[p].imActive==true){o++}if(o>1){this.dropdownMenu.addItem({className:"divider"});this.dropdownMenu.addItem({text:i.Signout,name:"SignoutLIname","data-id":"signOutAction"});break}}}}},getView:function(){j.debug("RTTitleView getView");return this.globalView},setTitle:function(l){j.debug("RTTitleView setTitle to "+l);if(this.titleNameView&&l){this.titleNameView.setText(decodeURI(l))}},setNotif:function(l){j.debug("RTTitleView setNotif");if(l){this.globalView.style.background=a.away}else{this.globalView.style.background="#005686"}},close:function(){j.debug("RTTitleView close");this.dispatchEvent(this.panelId+"ClosedClick",[])},mail:function(){j.debug("RTTitleView mail");this.dispatchEvent(this.panelId+"MailClick",[])},trash:function(){j.debug("RTTitleView trash");this.dispatchEvent(this.panelId+"TrashClick",[])},minimize:function(){j.debug("RTTitleView minimize");this.dispatchEvent(this.panelId+"MinimizedClick",[])},maximize:function(){j.debug("RTTitleView maximize");this.actionsView.style.visibility="";if(!this.isMaximize){this.isMaximize=true;d.dispatch(d.eventName.ONMAXIMIZEDCLICK,[this.panelId])}},iconise:function(){j.debug("RTTitleView iconise");this.actionsView.style.visibility="hidden";this.isMaximize=false;d.dispatch(d.eventName.ONICONISEPANELCLICK,[this.panelId])},changeIconColor:function(l){j.debug("RTTitleView changeIconColor");this.iconTitleView.style.background=l},changeIconClassName:function(l){this.iconTitleViewIcon.className=l},setBackgroundColor:function(l){j.debug("RTTitleView setBackgroundColor");this.globalView.style.background=l},display:function(l){if(l){this.globalView.style.display="block"}else{this.globalView.style.display="none"}},setTenantName:function(l){if(this.tenantNameView){this.tenantNameView.setText(l)}else{this.tenantNameView=UWA.createElement("div",{"class":"RTTenantName",id:"RTTenantName",text:l});this.tenantNameView.inject(this.globalView);this.titleNameView.style.marginTop="0px"}},setStatus:function(n){var m=this;if(m.dropdownMenu){var l=m.dropdownMenu.items;l.forEach(function(o){if(o.name=="SignoutLIname"){return}if(o.name===n.myStatus){m.dropdownMenu.updateItem({id:o.id,text:o.text,name:o.name,icon:"fonticon fonticon-check"})}else{m.dropdownMenu.updateItem({id:o.id,text:o.text,name:o.name,icon:""})}if(o.elements&&o.elements.container&&o.elements.container.firstChild&&!o.elements.container.firstChild.className){o.elements.container.firstChild.destroy()}})}},htmlDecode:function(l){var m=l.replace(/&gt;/g,">");m=m.replace(/&lt;/g,"<");m=m.replace(/&quot;/g,'"');m=m.replace(/&apos;/g,"'");m=m.replace(/&amp;/g,"&");return m},injectCoreviewMenu:function(){this.globalView.addClassName("RTTitleWithCoreviewMenu")},destroyCoreviewMenu:function(){this.globalView.removeClassName("RTTitleWithCoreviewMenu")}});return h});define("DS/InstantMessaging/js/controller/RTPanelController",["UWA/Class","UWA/Class/Events","DS/UIKIT/Alert","DS/InstantMessaging/js/view/RTPanelView","DS/InstantMessaging/js/view/RTOfflineView","DS/InstantMessaging/js/view/RTTitleView","DS/RTProxyDriver/RTLogger","DS/RTProxyDriver/RTProxyDriver","DS/InstantMessaging/js/controller/RTEventBusController","DS/InstantMessaging/js/view/RTSearchView","i18n!DS/InstantMessaging/assets/nls/feed"],function(a,l,d,e,g,i,k,h,f,c,j){k.debug("RTPanelController load");var b=a.extend(l,{init:function(m){this.id=m.id;this.controller=m.controller;this.initPanel(m);this.initListner()},initPanel:function(m){var o=this;var n={controller:this,originXPos:m.originXPos,originYPos:m.originYPos,sizeOnY:m.sizeOnY,minimumSize:m.minimumSize,minimumResize:m.minimumResize,panelLarger:m.panelLarger,panelId:this.id,iconeIconise:m.iconeIconise};this.panel=new e(n);this.panelView=this.panel.getView();if(m.titleOpt){m.titleOpt.panelId=this.id;m.titleOpt.active3DIM=m.active3DIM;this.titlePanel=new i(m.titleOpt);f.addEvent(f.eventName.ONMAXIMIZEDCLICK,function(p){if(o.id===p&&!o.titlePanel.noAction){o.maximized()}});if(m.titleOpt.minimizeButton){this.titlePanel.addEvent(this.id+"MinimizedClick",function(){o.minimize()})}if(m.titleOpt.closeButton){this.titlePanel.addEvent(this.id+"ClosedClick",function(){o.closePanel()})}if(m.titleOpt.menuButton){this.titlePanel.addEvent(this.id+"TrashClick",this.ArchiveTrash.bind(this));this.titlePanel.addEvent(this.id+"MailClick",this.ArchiveMail.bind(this));f.addEvent(this.id+"DisplayArchiveMenu",this.DisplayArchiveMenu.bind(this));f.addEvent(this.id+"HideArchiveMenu",this.HideArchiveMenu.bind(this))}f.addEvent(f.eventName.ONICONISEPANELCLICK,function(p){if(p===o.id){o.iconise()}});if(m.titleOpt.eventResizePanel){if(m.titleOpt.eventResizePanel.MouseDown){this.titlePanel.addEvent(m.titleOpt.eventResizePanel.MouseDown,function(p){o.panel.resizeOn(p)})}if(m.titleOpt.eventResizePanel.MouseUp){this.titlePanel.addEvent(m.titleOpt.eventResizePanel.MouseUp,function(){o.panel.resizeOff()})}}this.titlePanel.getView().inject(this.panelView);this.offlineView=new g({spinnerOn:true});this.offlineView.getView().inject(this.panelView);if(!m.showOfflineView){o.offlineView.activeOfflineView(false)}}},ArchiveMail:function(){this.dispatchEvent(this.id+"ArchiveMail",this.id)},ArchiveTrash:function(){this.dispatchEvent(this.id+"ArchiveTrash",this.id)},HideArchiveMenu:function(){this.titlePanel.dropdownMenuArchive.deactivateHistoryButtons()},DisplayArchiveMenu:function(){this.titlePanel.dropdownMenuArchive.activateHistoryButtons()},alert:function(m){if(this.alertBox&&this.alertBox.isVisible){this.alertBox.destroy()}this.alertBox=new d({visible:true}).inject(this.offlineView.globalView);this.alertBox.add({className:m.className||"primary",message:m.message||"Done."})},initListner:function(){var m=this;h.addEvent(h.eventName.DISCONNECTED,function(n){m.offlineView.activeOffline(true);m.offlineView.activeOfflineView(true);if(n.forced){m.alert({className:"error",message:j.networkDisconnected})}});h.addEvent(h.eventName.CONNECTED,function(n){m.offlineView.activeOfflineView(false)})},render:function(m){this.panelView.inject(m)},move:function(n,m){this.panel.move(n,m)},moveToOrigin:function(){this.panel.moveToOrigin()},getOriginPosition:function(){return this.panel.getOriginPosition()},getOldPosition:function(){return this.panel.getOldPosition()},setOriginPosition:function(m){return this.panel.setOriginPosition(m)},maximize:function(){f.dispatch(f.eventName.PANELMAXIMIZED,[this.id])},maximized:function(){this.titlePanel.setNotif(false);this.panel.setNotif(false);if(this.titlePanel){this.titlePanel.display(true);if(this.titlePanel.actionsView){this.titlePanel.actionsView.style.visibility=""}}this.panel.maximize();this.maximize()},minimize:function(){this.panel.minimize();this.dispatchEvent(this.id+"Minimized",[])},iconise:function(m){this.panel.iconise(m);if(this.titlePanel){this.titlePanel.display(false);if(this.titlePanel.actionsView){this.titlePanel.actionsView.style.visibility="hidden"}}f.dispatch(f.eventName.PANELICONISED,[this.id])},closePanel:function(m){this.minimize();this.panel.setDisplayPanel(false);this.dispatchEvent(this.id+"Closed",[m])},addElement:function(m){this.panel.addElement(m)},setTitle:function(m){if(this.titlePanel){this.titlePanel.setTitle(m)}},getLarger:function(){return this.panel.panelLarger},setDisplayPanel:function(m){this.panel.setDisplayPanel(m)},getDisplayPanel:function(){return this.panel.getDisplayPanel()},getView:function(){return this.panel.getView()},setNotif:function(m){if(this.panel.isMinimize){this.panel.setNotif(m);this.titlePanel.setNotif(m)}},showPanel:function(){this.panel.setDisplayPanel(true)},isMinimize:function(){return this.panel.isMinimize},getSizeOnY:function(){return this.panel.getSizeOnY()},setZindex:function(m){this.panel.setZindex(m)},setTitleBackgroundColor:function(m){this.titlePanel.setBackgroundColor(m)},changeTitleMainIconColor:function(m){this.titlePanel.changeIconColor(m)},changeTitleMainIconClassName:function(m){this.titlePanel.changeIconClassName(m)},isAnIcon:function(){return this.panel.isAnIcon()},getWidth:function(){return this.panel.getWidth()},activeSignInView:function(n,m){if(this.offlineView){this.offlineView.activeSignIn(n,m);this.titlePanel.setTenantName("");this.offlineView.activeOfflineView(n)}},activeOfflineView:function(m){if(this.offlineView){this.offlineView.activeOfflineView(m)}},destroy:function(){this.panel.closePanel()},setTenantName:function(m){this.titlePanel.setTenantName(m)}});return b});define("DS/InstantMessaging/js/view/RTListOfGroupView",["UWA/Class","UWA/Class/Events","DS/InstantMessaging/js/view/RTAddContactView","DS/RTProxyDriver/RTProxyDriver","DS/RTProxyDriver/RTLogger","DS/InstantMessaging/js/controller/RTEventBusController","i18n!DS/InstantMessaging/assets/nls/feed","DS/UIKIT/Scroller","DS/RTColors/RTColors"],function(c,j,d,g,i,f,h,e,a){i.debug("RTListOfGroupView load");var b=c.extend(j,{init:function(k){this.pageView=[];this.nbEleme=0;this.addContactView=undefined;this.globalView=UWA.createElement("div",{"class":"RTListOfGroup",id:"RTListOfGroup"});this.noElementView=UWA.createElement("div",{"class":"RTNoElement",id:"RTNoElement",styles:{display:"none",top:"80px",bottom:"0px",right:"0px",left:"0px",width:"100%"}}).inject(this.globalView);this.noElementInfoView=UWA.createElement("div",{"class":"RTNoElementInfo",id:"RTNoElementInfo",styles:{marginTop:"70px"}}).inject(this.noElementView);this.addUserView=UWA.createElement("span",{"class":"fonticon handler fonticon-user-add",styles:{fontSize:"4em",color:a.offline}}).inject(this.noElementInfoView);this.noElementTxtView=UWA.createElement("div",{"class":"RTNoElementInfoTxt",id:"RTNoElementInfoTxt",text:h.FirstMessage,styles:{fontSize:"1.1em",color:a.offline}}).inject(this.noElementInfoView);this.initListner();this.scrollerView=new e({element:UWA.createElement("div",{"class":"scrollable-body",styles:{flex:"1"},html:this.globalView})})},initListner:function(){var k=this;f.addEvent(f.eventName.ACTIVEBUDDYSCROLLER,function(o){var m=k.getView();var l=m.children;k.scrollerView.scrollTo(0,0);for(var n=0;n<l.length;n++){var p=l[n];if(o){if(n===1){p.style.display="block"}else{p.style.overflow="scroll"}}else{p.style.overflow="hidden";if(n===1){p.style.display="none"}}}});f.addEvent(f.eventName.ONELEMENTDRAGSTART,function(l){if(l.groupId==="searchChatId"){if(!k.addContactView){k.globalView.scrollTop=k.globalView.scrollHeight;k.addContactView=new d();k.addElement(k.addContactView.getView())}}});f.addEvent(f.eventName.ONELEMENTDRAGSTOP,function(l){if(l.groupId==="searchChatId"){if(k.addContactView){k.addContactView.destroy();delete k.addContactView}}});g.addEvent(g.eventName.REMOVECONTACT,function(l){if(l.group==="_"){k.nbEleme--;if(k.globalView.childElementCount===3&&k.globalView.childNodes[1].style.display==="none"){k.setNoElement(true)}}});g.addEvent(g.eventName.REMOVEGROUP,function(l){k.nbEleme--;if(k.globalView.childElementCount===3&&k.globalView.childNodes[1].style.display==="none"){k.setNoElement(true)}})},getView:function(){return this.scrollerView.getContent()},addElement:function(l,k){if(l){this.setNoElement(false);l.inject(this.globalView,k||"top");var m=new UWA.Fx(l,{duration:250,transition:"linear"});m.start({opacity:["O","1"]});this.nbEleme++}},setNoElement:function(k){if(k){this.noElementView.style.display="block"}else{this.noElementView.style.display="none"}},mouveUp:function(k){var l=this.scrollerView.elements.content.scrollTop;if(l>0){this.scrollerView.elements.content.scrollTop=l-50}},mouveDownp:function(k){var m=this.scrollerView.elements.content.scrollTop;var l=this.scrollerView.elements.content.scrollHeight;if(m<l){this.scrollerView.elements.content.scrollTop=m+50}},setDropData:function(k){}});return b});define("DS/InstantMessaging/js/model/RTContactModel",["UWA/Class","UWA/Class/Events","DS/RTProxyDriver/RTLogger","DS/InstantMessaging/js/controller/RTSettingController",],function(c,a,d,e){d.debug("RTContactModel load");var b=c.extend(a,{init:function(f){var g=this;this.userId=f.contact.userId;this.userName=f.contact.userName;this.login=(f.contact.login)?f.contact.login:this.userId.substring(0,this.userId.indexOf("@"));this.controller=f.controller;this.listOfStatus=e.getSetting("RTCStatus");if(f.contact.status){this.status=f.contact.status}else{this.status=(this.listOfStatus)?this.listOfStatus.Offline:undefined}},getId:function(){return this.userId},setId:function(f){this.userId=f},getStatus:function(){return this.status},setStatus:function(f){this.status=f},getEmail:function(){return this.email},setEmail:function(f){this.email=f},getLogin:function(){return this.login},setLogin:function(f){this.login=f},getUserName:function(){return this.userName},setUserName:function(f){this.userName=f}});return b});define("DS/InstantMessaging/js/controller/RTContactController",["UWA/Class","UWA/Class/Events","DS/InstantMessaging/js/view/RTElementView","DS/InstantMessaging/js/model/RTContactModel","DS/RTProxyDriver/RTProxyDriver","DS/RTProxyDriver/RTLogger","DS/InstantMessaging/js/controller/RTSettingController","DS/InstantMessaging/js/controller/RTEventBusController"],function(a,h,b,i,f,g,e,c){g.debug("RTContactController load");var d=a.extend(h,{init:function(j){this.controller=j.controller;this.connection=j.connection;this.groupId=j.groupId;this.addIcon=false;this.imgContact=undefined;if(j.contact.addIcon){this.addIcon=true}this.contactView=undefined;this.contactModel=undefined;if(j.contact){this.initContact(j.contact)}},initContact:function(p){var n=this;this.contactModel=new i({contact:p,connection:this.connection,controller:this});if(this.contactModel){var q=this.contactModel.getLogin()||this.contactModel.getId();var r=this.contactModel.getUserName()||q;var l=this.contactModel.getStatus();var t=e.getSetting("currentPlateformId");var o=e.getSetting("plateformsInfo");var s=e.getSetting("defaultAvatarURL")||"./resources/en/1/webapps/InstantMessaging/assets/avatarDefault.png";var k=(t&&o&&o[t])?o[t].swym:undefined;this.imgContact=new Image();this.pathPictureUser=(k)?k+"/api/user/getpicture/login/"+q+"/format":undefined;this.imgContact.src=this.pathPictureUser||s;this.imgContact.id=escape(this.contactModel.login+"_avatar");var m=0;while(document.getElementById(this.imgContact.id)&&m<100){this.imgContact.id+=m;m++}var n=this;this.imgContact.onerror=function(){g.debug("RTContactController : User avatar has not been found, setting the default one. User login:"+q);n.imgContact.onerror=null;var u=document.getElementById(n.imgContact.id);if(u&&u.src&&s){u.src=s}n.pathPictureUser=s;n.imgContact.src=n.pathPictureUser};var j={groupId:this.groupId,controller:this,statusElement:l,pictureElement:{picture:this.imgContact,eventName:"onStartChat"},titleElement:{txt:r,eventName:"onStartChat"},subTitleElement:undefined};this.contactView=new b(j);if(this.groupId==="_"){this.contactView.setDraggable(true);this.contactView.setDropData(true)}if(this.contactView){var n=this;if(!p.noClick){this.addEvent(j.pictureElement.eventName,function(u){g.debug("RTContactController CLICK Picture");c.dispatch(c.eventName.STARTCHAT,[u])})}if(this.addIcon){this.contactView.showAddElement(this.addIcon)}}f.addEvent(f.eventName.ONPRESENCERECEIVED,function(u){if(u.userId===n.getId()){n.setStatus(u.status);if(u.username){n.contactView.RTTitleElementView.innerText=u.username}}})}},getView:function(){if(this.contactView){return this.contactView.getView()}return undefined},setBorder:function(j){this.contactView.setBorder(j)},getId:function(){return this.contactModel.getId()},getStatus:function(){return this.contactModel.getStatus()},setStatus:function(j){if(this.getStatus()!==j){this.contactModel.setStatus(j);this.contactView.updateStatus(j)}},getEmail:function(){return this.contactModel.getEmail()},setEmail:function(j){this.contactModel.setEmail(j)},getLogin:function(){return this.contactModel.getLogin()},setLogin:function(j){this.contactModel.setLogin(j)},getUserName:function(){return this.contactModel.getUserName()},setUserName:function(j){this.contactModel.setUserName(j)},setDraggable:function(j){this.contactView.setDraggable(j)},setEditMode:function(j){this.contactView.setEditMode(j)},sendRemove:function(j){f.dispatch(f.eventName.REMOVECONTACT,{user:this.getId(),group:this.groupId})},sendAddContact:function(){},getPathPicture:function(){return this.pathPictureUser},getGroupNumberOfContact:function(){if(this.controller&&this.controller.getNumberOfContact){return this.controller.getNumberOfContact()}return -1},getPicture:function(){return this.imgContact}});return d});define("DS/InstantMessaging/js/view/RTMsgView",["UWA/Class","UWA/Class/Events","DS/UIKIT/DropdownMenu","DS/RTProxyDriver/RTLogger","DS/InstantMessaging/js/controller/RTSettingController","DS/InstantMessaging/js/ressources/FileSaver","DS/i3DXCompassPlatformServices/OpenWith","i18n!DS/InstantMessaging/assets/nls/feed","UWA/Utils/InterCom"],function(c,j,a,i,f,b,d,h,g){i.debug("RTMsgView load");var e=c.extend(j,{init:function(n){this.controller=n.controller;this.message=n.msg;this.msgType=n.msgType;this.activePicture=n.activePicture;this.contactPicture=n.contactPicture;if(this.msgType===undefined){this.msgType="received"}var q=this;this.globalView=UWA.createElement("div",{"class":"RTMsg"+this.msgType,id:"RTMsg"+this.msgType});if(this.msgType==="received"&&this.activePicture){this.contactPicture.className="RTImgReceived";this.contactPicture.draggable="false";this.globalView.appendChild(this.contactPicture.cloneNode(true))}this.msgTextView=UWA.createElement("div",{"class":"RTMsgText"+this.msgType,id:"RTMsgText"+this.msgType,});var t=this.message.msg;var o=UWA.createElement("div",{});o.textContent="";var w=(function(F){if(!F.data){return false}for(var E in F.data){return true}return false})(n.msg);if(!w){var D=this.urlify(t);for(var y=0;y<D.split.length;y++){if(D.split[y]&&D.split[y].length>0){var x=UWA.createElement("span");x.textContent+=D.split[y];x.inject(this.msgTextView)}if(D.url&&D.split.length>1&&D.split.length-1!==y){var B=UWA.createElement("a",{text:D.url,target:"_blank",href:D.url});B.inject(this.msgTextView)}}}this.msgTextView.inject(this.globalView);if(w){if(this.msgType==="received"){this.msgTextView.className="RTMsgTextreceivedData"}else{this.msgTextView.className="RTMsgTextsentData"}var k="File received :";var r=n.msg.fileName;var s=undefined;var z=undefined;var u=[];var v={};var l=undefined;var p;try{var C=atob(n.msg.data);l=JSON.parse(C);z=l.datahtml;z=decodeURIComponent(escape(window.atob(z)));C=decodeURIComponent(l.data);this.data=C;p=l.uri}catch(A){i.debug("RTMsgView Error parsing data "+A)}if(n.msg.typeData==="DS3DXContent"){k=undefined;this.msgTextView.draggable=true;try{l=JSON.parse(C);try{l.data=JSON.parse(JSON.parse(decodeURIComponent(l.data)));l.data=l.data.data||l.data;z=l.datahtml;z=decodeURIComponent(escape(window.atob(z)))}catch(A){console.error(A)}s=l.data.items[0].serviceId;if(s==="3DSpace"){r=l.data.items[0].displayName}else{if(s==="3DSwym"){r=l.data.items[0].objectType}}}catch(A){i.debug("RTMsgView Error parsing data "+A)}this.msgTextView.ondragstart=function(E){var H=C;try{H=atob(l.data)}catch(G){H=C}E.dataTransfer.setData("text",H);try{var F=new UWA.Widget();F.socket=new g.Socket("SwymMyCommunities-"+F.id);F.socket.subscribeServer("ifweServer",window.parent);F.socket.dispatchEvent("SwymContentDragStarted",JSON.parse(C))}catch(G){i.debug("RTMsgView while dispatching SwymContentDragStarted "+G)}}}else{if(n.msg.typeData==="fileTransfer"){UWA.createElement("span",{"class":"fonticon handler fonticon-doc-text-inv",styles:{fontSize:"2.8em",color:" #B4B6BA",marginTop:"3px"}}).inject(this.msgTextView);this.msgIconData=UWA.createElement("div",{"class":"RTMsgIconData"+this.msgType,id:"RTMsgIconData"+this.msgType,text:r,styles:{background:"white",borderRadius:"3px",margin:"auto","max-width":"180px"}}).inject(this.msgTextView);u.push({text:h.Save||"Save",name:"Save"});v.Save=function(){q.SaveToDisk(n.msg.data,r)}}else{if(n.msg.typeData==="fileTransferInvitation"){this.fileTransferInvitation=true}else{if(n.msg.typeData==="coreviewInvitation"){this.coreviewInvitation=true}}}}if(!p&&l){if(l.uri&&typeof l.uri=="string"&&(l.uri.indexOf("http")!=-1||l.uri.indexOf("www")!=-1)){p=l.uri}else{if(l.data&&l.data.items&&l.data.items.length>0&&l.data.items[0].urlContent){p=l.data.items[0].urlContent}else{if(typeof l.data=="string"&&(l.data.indexOf("http")===0||l.data.indexOf("www")===0)){p=l.data}else{if(l.data.data&&l.data.data.items&&l.data.data.items.length>0&&l.data.data.items[0].urlContent){p=l.data.data.items[0].urlContent}else{i.debug("3DIM RTMsgView init - no url found in parsed data")}}}}}if(p){u.push({text:h.Open||"Open",name:"Open"});v.Open=function m(E){if(E&&E.preventDefault){E.preventDefault()}var F=p;var H=f.getSetting("appName");if(H==="3DDashboard"&&p["3DD"]){F=p["3DD"]}else{if(p["3DSwym"]){F=p["3DSwym"]}}if(typeof F!="string"){return i.debug("RTMsgView unable to open link attached to dropped data")}if(F.contains(window.location.hostname)){if(F.indexOf("#app")!=-1){window.open(F.substr(F.indexOf("#app"),F.length),"_self")}else{if(F.indexOf("#community")!=-1&&window.location.hostname.contains("3dswym")){var G=F.substr(F.indexOf("#community"),F.length);if(window.location.toString().contains("#home")){window.location=window.location.toString().replace("#home",G)}else{window.open(G,"_self")}}}}else{window.open(F,"_blank")}}}if(z){this.msgDetailsData=UWA.createElement("div",{"class":"RTMsgDetailsData"+this.msgType,id:"RTMsgDetailsData"+this.msgType,html:z});if(p&&v.Open){this.msgDetailsData.addEvent("click",v.Open);this.msgDetailsData.setStyle("cursor","pointer")}this.msgDetailsData.inject(this.msgTextView)}if(this.msgType==="received"){if(u.length>0){this.MenuIcon=UWA.createElement("span",{"class":"fonticon handler fonticon-down-open",styles:{margin:"auto 0px","float":"left",color:"#B4B6BA",fontSize:"large",opacity:"0.4",},events:{mouseover:function(E){q.MenuIcon.style.opacity=1},mouseout:function(){q.MenuIcon.style.opacity=0.2}}});this.MenuIcon.inject(this.msgTextView);this.shareDropdownMenu=new a({target:this.MenuIcon,items:u,events:{onClick:function(F,E){v[E.name]()}}});this.shareDropdownMenu.getContent().style.zIndex="3000"}}}},htmlDecode:function(k){var l=document.createElement("div");l.innerHTML=k;return l.childNodes.length===0?"":l.childNodes[0].nodeValue},urlify:function(o){try{var n=/(https?:\/\/[^\s]+)/g;var k=o.match(n);if(Array.isArray(k)){k=k[0]}if(k){var l=o.split(k);return{url:k,split:l}}}catch(m){i.debug("RTMsgView error urlify")}return{split:[o]}},getView:function(){return this.globalView},getType:function(){return this.msgType},SaveToDisk:function(q,D){var n=(q);var u=n.split(";");var p=u[1].split(",");var l=u[0].split(":")[1];var E=p[1];var B=l;var m=512;var C=atob(E);var w=[];for(var o=0;o<C.length;o+=m){var v=C.slice(o,o+m);var t=new Array(v.length);for(var z=0;z<v.length;z++){t[z]=v.charCodeAt(z)}var r=new Uint8Array(t);w.push(r)}var k=new Blob(w,{type:B});b.saveAs(k,D);return true;var s=URL.createObjectURL(k);if(!window.ActiveXObject){var A=document.createElement("a");A.href=s;A.target="_blank";A.download=D||"unknown";var x=document.createEvent("Event");x.initEvent("click",true,true);A.dispatchEvent(x);(window.URL||window.webkitURL).revokeObjectURL(A.href)}else{if(!!window.ActiveXObject&&document.execCommand){var y=window.open(s,"_blank");y.document.close();y.document.execCommand("SaveAs",true,D||s);y.close()}}}});return e});define("DS/InstantMessaging/js/view/RTShareContentView",["UWA/Class","UWA/Class/Events","DS/RTProxyDriver/RTLogger","DS/InstantMessaging/js/view/RTSearchView","DS/InstantMessaging/js/controller/RTEventBusController","DS/UIKIT/Input/Button","DS/RTProxyDriver/RTProxyDriver","DS/InstantMessaging/js/controller/RTSettingController","DS/UIKIT/SuperModal","DS/PlatformAPI/PlatformAPI","DS/InstantMessaging/js/controller/RTContactController","i18n!DS/InstantMessaging/assets/nls/feed"],function(a,p,n,d,f,e,l,i,b,k,h,m){n.debug("RTShareContentView load");var j=function(q,r){return function(){console.log("RTShareContentView share with "+q.login);var s={login:q.login,tenant:i.getSetting("currentPlateformId").toLowerCase(),username:q.username||q.userName,presence:q.presence||q.status,action:"startChat",share:r};k.publish("im.ds.com",s)}};var c=function(v,x,y){var s,u,D=[];if(!Array.isArray(x)){var E=Object.keys(x);for(u=0;s=E[u];u++){D.push(x[s].contactModel)}}else{D=x}if(D.length>0){var B=i.getSetting("userLogin"),r,A,q,C,t,w;for(u=0;u<D.length;u++){t=D[u];if(!t||!t.userId){continue}var z=t.userId.indexOf("@")!=-1?t.userId.substring(0,t.userId.indexOf("@")):t.userId;if(z!==B&&decodeURI(z)!==B){w={userId:t.userId,userName:decodeURI(t.userName),login:decodeURI(z),addIcon:false,where:"3DIMWeb",status:t.status,noClick:true};if(v.getElementsByTagName("li")[w.login]){continue}C=new h({contact:w,groupId:"searchChatId"});r=C.getView();A=UWA.createElement("li",{"class":"RTShareContentListElement",id:w.login});r.inject(A);r.addEvent("click",j(w,y));A.inject(v)}}}else{return n.debug("RTShareContentView addListOfContacts : list of contacts is empty")}};var o=function(q,r){return function(s){n.debug("RTShareContentView : add contacts. qty="+s.length);return c(q,s,r)}};var g=a.extend(p,{init:function(q){if(!q.controller){return n.debug("RTShareContentView needs a controller (RTChatController)")}this.dragEnter=false;this.globalView=UWA.createElement("div",{"class":"RTShareContent",id:"RTShareContent"});this.searchPart=UWA.createElement("section",{"class":"RTShareWithPart",id:"RTShareWithPartSearch"});this.searchPart.inject(this.globalView);this.searchView=new d({isForShareAPI:true,holderTxt:"Search",controller:q.controller,searchClearIconViewAction:(function(s){return function(){s.receiversListSearch.innerHTML=""}})(this)});this.searchView.getView().inject(this.searchPart);this.receiversListSearch=UWA.createElement("ul",{"class":"RTShareContentList"});this.receiversListSearch.inject(this.searchPart);this.addContactListToSearchResults=o(this.receiversListSearch,q.content);l.addEvent(l.eventName.RESULTOFSEARCHFORSEARCHAPI,this.addContactListToSearchResults);this.rosterPart=UWA.createElement("section",{"class":"RTShareWithPart",id:"RTShareWithPartRoster"});this.rosterPart.inject(this.globalView);this.receiversListRoster=UWA.createElement("ul",{"class":"RTShareContentList"});this.receiversListRoster.inject(this.rosterPart);this.receiversListRoster.setAttribute("name",m.Recents||"Recents");this.addContactListToRosterResults=o(this.receiversListRoster,q.content);if(q.controller.controller&&q.controller.controller.listOfGroup&&q.controller.controller.listOfGroup.Recents){this.addContactListToRosterResults(q.controller.controller.listOfGroup.Recents.listOfContact)}else{n.debug("RTShareContentView can not find group Recents ")}var r=new b({renderTo:document.body});r.dialog({body:this.globalView,title:m.ShareWith,buttons:[{className:"primary",value:m.Cancel,action:function(s){s.hide()}}]});return true},destroy:function(){this.globalView.destroy()}});return g});define("DS/InstantMessaging/js/view/RTChatHistoryView",["UWA/Date","UWA/Class","UWA/Class/Events","DS/UIKIT/Scroller","DS/UWPClientCode/I18n","DS/InstantMessaging/js/view/RTMsgView","DS/UIKIT/Spinner","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/RTProxyDriver/RTLogger","DS/UIKIT/Alert","i18n!DS/InstantMessaging/assets/nls/feed"],function(j,b,m,d,g,i,e,c,f,l,h,k){l.debug("RTChatHistoryView load");var a=b.extend(m,{init:function(n){this.controller=n.controller;this.lastMsg=undefined;this.lastMsgTime=undefined;this.contactPicture=n.contactPicture;this.spinner=new e();this.messages=[];this.globalView=UWA.createElement("div",{"class":"RTChatHistory",id:"RTChatHistory"});this.scrollerView=new d({element:UWA.createElement("div",{"class":"scrollable-body",styles:{flex:"1"},html:this.globalView})})},getView:function(){return this.globalView},mailInUri:function(q){if(!q.me||!q.him){return false}var o=null;var n="";for(var p=0;p<this.messages.length;p++){(function(s,r){if(s.messages[r].typeData){return false}n+="%0D%0A";if(s.messages[r].isSend===undefined){s.messages[r].isSend=s.messages[r].username===q.me?true:false}if(o!==s.messages[r].isSend){o=s.messages[r].isSend;n+="%0D%0A";n+="%09%09%09%09%09%09";n+=encodeURI(s.messages[r].isSend?q.me:q.him);n+="%0D%0A"}n+="%20%5B"+encodeURI(j.strftime((new Date(s.messages[r].dateMsg)),"%Y-%m-%d %H:%M:%S"))+"%5D";n+="%09";n+=encodeURI(s.htmlDecode(s.messages[r].msg))})(this,p)}n={body:n,subject:("3DExperience Platform - Conversation history between "+q.him+" and "+q.me)};return n},mail:function(q){if(!q.me||!q.him){return false}var o=null;var n="";for(var p=0;p<this.messages.length;p++){(function(s,r){if(s.messages[r].typeData){return false}n+="\r\n ";if(s.messages[r].isSend===undefined){s.messages[r].isSend=s.messages[r].username===q.me?true:false}if(o!==s.messages[r].isSend){o=s.messages[r].isSend;n+="\r\n ";n+="\t\t\t\t\t\t";n+=(s.messages[r].isSend?q.me:q.him);n+="\r\n "}n+=" ["+(j.strftime((new Date(s.messages[r].dateMsg)),"%Y-%m-%d %H:%M:%S"))+"]";n+="\t";n+=s.messages[r].msg})(this,p)}n={body:n,subject:("3DExperience Platform - Conversation history between "+q.me+" and "+q.him)};return n},htmlDecode:function(n){var o=document.createElement("div");o.innerHTML=n.escapeHTML();return o.childNodes.length===0?"":o.childNodes[0].nodeValue.replace(/&/g,"%26")},addMessageDates:function(u,s,x,w,n,y,r){var o;var t=0;if(s){var p=UWA.createElement("div",{"class":"RTMsgTimeLineDay",id:"RTMsgTimeLineDay",text:w?w+", "+n:n,styles:{fontSize:"10px",fontFamily:"arial",marginTop:"18px"}});o=u.getElementsByClassName("RTMsgTimeLineDay");for(var q=0;q<o.length;q++){if(o[q].innerHTML===p.innerHTML){if(r=="top"){o[q].remove()}else{s=false}}}}if(x){var v=UWA.createElement("div",{"class":"RTMsgTimeLine",id:"RTMsgTimeLine",date:n,text:y,styles:{fontSize:"10px",fontFamily:"arial",marginTop:s?"0px":"18px"}});o=u.getElementsByClassName("RTMsgTimeLine");for(var q=0;q<o.length;q++){if(o[q].innerHTML===v.innerHTML&&o[q].getAttribute("date")===n){}}}if(r=="bottom"){if(s){p.inject(u,r)}if(x){v.inject(u,r)}}else{if(r=="top"){if(x){v.inject(u,r)}if(s){p.inject(u,r)}}else{l.debug("A message does not have a position")}}return true},addMessage:function(q,y,I,v){if(q.origin=="media"){return true}if(!q){return l.debug("RTChatHistoryView addMessage has been called without message !")}if(q.typeMsg==="offlinemsg"){return true}if(this.lastMsg&&this.lastMsg.message&&this.lastMsg.message.msg_id&&this.lastMsg.message.msg_id===q.msg_id){return l.debug("RTChatHistoryView addMessage doublon received !")}var r=undefined;if(q.timestamp){r=new Date(q.timestamp);q.dateMsg=new Date().toISOString()}else{if(q.dateMsg){r=new Date(q.dateMsg)}else{r=new Date();q.dateMsg=new Date().toISOString()}}var p=g.getCurrentLanguage();var t=j.strftime(r,"%H:%M");var z=r.getMinutes();var s=r.getHours();var B=r.getDay();var H=0;var I=I||"bottom";if(!p){p=window.navigator.language}var C=r.toLocaleString(p,{weekday:"long"});if(C.indexOf(",")!=-1||C.indexOf(":")!=-1||C.length>10){C=null}var A=r.toLocaleDateString(p);var x=false;var D=false;if(v||I==="top"){x=true;D=true;this.lastMsgTime=r}else{if(this.lastMsgTime){var E=this.lastMsgTime.getMinutes();var G=this.lastMsgTime.getHours();var o=this.lastMsgTime.getDay();if(o!==B){D=true}if(E!==z||G!==s){this.lastMsgTime=r;x=true}}else{this.lastMsgTime=r;x=true;D=true}}if(I=="bottom"){H+=this.addMessageDates(this.globalView,D,x,C,A,t,I)}var n={controller:this,msg:q,msgType:y,activePicture:true,contactPicture:this.contactPicture};if(this.lastMsg&&y==="received"&&this.lastMsg.getType()==="received"){n.activePicture=false}var w=new i(n);this.lastMsg=w;var F=this.lastMsg.getView();F.inject(this.globalView,I);if(I=="top"){H+=this.addMessageDates(this.globalView,D,x,C,A,t,I)}else{this.scrollToBottom()}if(!this.messages){this.messages=[]}if(I==="top"){this.messages.unshift(q)}else{this.messages.push(q)}if(this.alertBox&&this.alertBox.isVisible&&y==="sent"&&(!q.typeMsg||q.typeMsg!="result")){this.alertBox.destroy()}if(w.fileTransferInvitation&&y==="received"){var u=this;this.displayModalConfirm({content:k.confirmReceiveFileContent+" "+w.message.fileName,header:k.confirmReceiveFileHeader},function(J){if(J){return u.controller.acceptFile(w.message)}if(J===false){u.controller.refuseFile(w.message)}},true)}return H},injectSpinner:function(n){this.spinner.inject(this.globalView,n||"top").show()},removeSpinner:function(){this.spinner.remove()},injectMessage:function(p,n){var o=UWA.createElement("div",{"class":"RTMsgTimeLineDay",id:"RTMsgTimeLineDay",text:p,styles:{fontSize:"10px",fontFamily:"arial",marginTop:"18px"}});o.inject(this.globalView,n)},displayModalConfirm:function(o,s,n){var q=!this.controller.isRender;this.controller.show();if(!this.superModal){this.superModal=new c({renderTo:this.globalView});this.superModal.callbacks=[]}if(s){if(this.superModal.callbacks&&this.superModal.callbacks.length&&n){this.superModal.callbacks.push(s);this.superModal.callback=(function(t){return function(u){if(u===undefined){return true}for(var v in t){t[v](u)}t.length=0}})(this.superModal.callbacks)}else{this.superModal.callback=s}}if(!n||!this.superModal.modals.current){this.superModal.confirm(o.content||"Are you sure?",o.header||"Confirmation",this.superModal.callback||function(t){l.debug(t)})}else{var r=this.superModal.modals.current.getBody().innerText+o.content;this.superModal.modals.current.destroy();this.superModal.confirm(r,o.header||"Confirmation",this.superModal.callback||function(t){l.debug(t)})}try{this.globalView.getElementsByClassName("modal modal-root")[0].setStyle("position","relative");this.globalView.getElementsByClassName("modal-wrap")[0].setStyle("width","100%");this.globalView.getElementsByClassName("modal-overlay in")[0].setStyle("position","relative")}catch(p){l.debug("tried to display a modal in a ChatPanl that has never be opened")}if(q){this.controller.getPanel().panelView.style.display="none";this.controller.displayChat=false}else{this.scrollToBottom()}},mask:function(n){if(n){f.mask(this.scrollerView.getContent())}else{f.unmask(this.scrollerView.getContent())}return true},alert:function(n){if(this.alertBox&&this.alertBox.isVisible){this.alertBox.destroy()}this.alertBox=new h({visible:true}).inject(this.scrollerView.getContent());this.alertBox.add({className:n.className||"primary",message:n.message||"Done."})},scrollToBottom:function(){this.scrollerView.scrollTo(0,this.globalView.scrollHeight)}});return a});define("DS/InstantMessaging/js/controller/RTGroupController",["UWA/Class","UWA/Class/Events","DS/InstantMessaging/js/view/RTGroupView","DS/InstantMessaging/js/model/RTGroupModel","DS/InstantMessaging/js/controller/RTContactController","DS/RTProxyDriver/RTProxyDriver","DS/InstantMessaging/js/controller/RTSettingController","DS/RTProxyDriver/RTLogger","DS/InstantMessaging/js/controller/RTEventBusController","i18n!DS/InstantMessaging/assets/nls/feed"],function(a,j,f,b,d,g,e,i,c,h){i.debug("RTGroupController load");var k=a.extend(j,{init:function(l){this.numberOfContact=0;this.listOfContact={};this.groupId=l.groupId;this.groupType=l.groupType;this.connection=l.connection;this.controller=l.controller;this.fonticonElement=l.fonticonElement;this.displayNumberOfcontact=l.displayNumberOfcontact;this.group=undefined;this.groupView=undefined;if(this.groupId){this.initGroup(l)}},initGroup:function(l){var m=this;l.controller=this;this.group=new b(l);if(this.group){g.addEvent(g.eventName.REMOVECONTACT,function(n){i.debug("RTGroupController : REMOVECONTACT received");if((n.group===m.groupId||n.name===m.groupId)&&(m.listOfContact[n.user]||m.listOfContact[n.user.login])){m.removeMember(m.listOfContact[n.user]||m.listOfContact[n.user.login])}});this.group.addEvent("onContactRemoved",function(n){m.removeMember(m.listOfContact[n.userId])});var l={controller:this,groupType:this.groupType,isHidden:l.isHidden,idElement:this.groupId,displayNumberOfcontact:this.displayNumberOfcontact,isDraggable:l.isDraggable,isLocked:l.isLocked};this.groupView=new f(l);this.addTitle()}this.addEvent("RT_"+this.groupId+"_onGroupPictureClick",function(n){if(n.getNumberOfContact()>0){n.groupView.expand=!n.groupView.expand;n.groupView.resizeView()}});if(this.groupType==="rtc"){this.groupView.setDropData(true);this.controller.addEvent("RTSwitchToEditMode",function(p){for(var n in m.listOfContact){var o=m.listOfContact[n];o.setEditMode(p)}})}},onDragOver:function(m){if(this.groupType==="rtc"){m.preventDefault();var n=m.dataTransfer.getData("text");n=JSON.parse(n);if(n.data.items[0].serviceId==="3DMessaging"){var l=n.data.items[0].contact;this.addContact(l,true);c.dispatch(c.eventName.ONADDCONTACT,[{user:l,group:this.groupId}]);if(m.srcElement.id=="RTGroupPicturePreview"){g.dispatch(g.eventName.REMOVECONTACT,{user:l.userId,group:"_"})}}}},getView:function(){return this.groupView.getView()},setIsHidden:function(l){this.groupView.setIsHidden(l)},getNumberOfContact:function(){return this.numberOfContact},addContact:function(l,o){if(this.listOfContact[l.userId]===undefined){this.numberOfContact++;this.group.addContact(l);var n={controller:this,connection:this.connection,groupId:this.groupId,contact:l};var m=new d(n);m.setDraggable(true);this.listOfContact[l.userId]=m;if(m.status&&m.status!="Offline"){this.listOfContact[l.userId].setStatus(l.status)}if(this.groupId!=="_"){this.groupView.addContact(m,o)}}else{this.listOfContact[l.userId].setStatus(l.status)}},addTitle:function(){var l={controller:this,connection:this.connection,fonticonElement:this.fonticonElement,pictureElement:{eventName:"RT_"+this.groupId+"_onGroupPictureClick"},titleElement:{txt:this.group.getName(),eventName:"RT_"+this.groupId+"_onGroupPictureClick"}};if(this.groupType==="search"){l={controller:this,connection:this.connection,holderTxt:h.SearchField}}this.groupView.addTitle(l)},removeMember:function(n){this.numberOfContact--;var l=n.getId();var m=this.listOfContact[l];this.groupView.removeMember(m);delete this.listOfContact[l]},removeGroup:function(){this.clearAllElement();var l=this.groupView.getView();l.destroy();c.dispatch(c.eventName.DISPLAYTRASHEDZONE,[false])},clearAllElement:function(n){this.numberOfContact=0;this.groupView.removeMessage();for(var l in this.listOfContact){var m=this.listOfContact[l];this.groupView.removeMember(m);delete this.listOfContact[l]}this.listOfContact={};this.groupView.numberOfContact=0;if(!n){this.groupView.resizeView()}},setConnection:function(l){this.connection=l},dislayMessage:function(l){this.numberOfContact++;this.groupView.dislayMessage(l)},setEditMode:function(l){this.groupView.setEditMode(l)},setChangeName:function(l){this.groupView.setChangeName(l)},sendRemove:function(l){i.debug("RTGroupController : REMOVEGROUP sendRemove"+this.groupId);g.dispatch(g.eventName.REMOVEGROUP,this.groupId)},getMember:function(l){return this.listOfContact[l]},getId:function(){return this.groupId},setId:function(m){this.groupId=m;this.group.setId(m);this.groupView.idGroup=m;for(var l in this.listOfContact){this.listOfContact[l].groupId=m}},getName:function(){return this.group.getName()},setName:function(l){this.group.setName(l);if(this.groupView&&this.groupView.groupNameView&&this.groupView.groupNameView.textContent){this.groupView.groupNameView.textContent=l}if(this.groupView&&this.groupView.groupNameInput&&this.groupView.groupNameInput.elements&&this.groupView.groupNameInput.elements.input){this.groupView.groupNameInput.elements.input.value=l}else{i.debug("RTGroupController unable to rename the view of group "+l)}},clearInput:function(){this.groupView.clearInput()},resizeView:function(){this.groupView.resizeView()}});return k});define("DS/InstantMessaging/js/controller/RTChatController",["UWA/Class","UWA/Class/Events","DS/PlatformAPI/PlatformAPI","DS/InstantMessaging/js/ressources/FileSaver","DS/InstantMessaging/js/controller/RTPanelController","DS/InstantMessaging/js/controller/RTContactController","DS/InstantMessaging/js/model/RTChatModel","DS/InstantMessaging/js/view/RTElementView","DS/InstantMessaging/js/view/RTSendMsgView","DS/InstantMessaging/js/view/RTChatHistoryView","DS/InstantMessaging/js/view/RTMsgInfoContactView","DS/InstantMessaging/js/view/RTSendDataView","DS/RTProxyDriver/RTProxyDriver","DS/InstantMessaging/js/controller/RTEventBusController","DS/InstantMessaging/js/controller/RTSettingController","i18n!DS/InstantMessaging/assets/nls/feed","DS/RTColors/RTColors","DS/UIKIT/DropdownMenu","DS/RTProxyDriver/RTLogger","UWA/Class/Model","DS/UIKIT/Tooltip","DS/W3DXComponents/Views/Item/TileView","DS/UIKIT/Spinner"],function(t,n,b,f,l,p,k,q,u,d,v,a,c,m,r,e,h,o,x,j,s,i,g){x.debug("RTChatController load");var w=t.extend(n,{init:function(y){x.debug("RTChatController init");this.controller=y.controller;this.connection=y.connection;this.id=y.id;this.shareSizeLimit=9000000;this.roomId=y.roomId;this.contact=undefined;this.chatModel=undefined;this.displayChat=false;this.activeShare=r.getSetting("activeShare");this.activeArchive=r.getSetting("activeArchive");this.activeShareFile=r.getSetting("activeShareFile");this.listOfMember={};this.initChat(y)},initChat:function(y){x.debug("RTChatController initChat");var A=this;this.contact=new p(y);if(this.contact){var z={id:this.id,controller:this,originXPos:y.originXPos,originYPos:y.originYPos,sizeOnY:y.sizeOnY,minimumSize:y.minimumSize,titleOpt:y.titleOpt,minimumResize:y.minimumResize,panelLarger:y.panelLarger,iconeIconise:y.iconeIconise};this.chat=new l(z);if(this.chat){this.contact.setDraggable(true);this.id=this.contact.getId();var z={connection:this.connection,controller:this,contact:this.contact};this.chatModel=new k(z);this.chat.addEvent(this.id+"Closed",function(B){A.displayChat=false;A.controller.closeChatPanel(A.id,A.contact,B);A.chat.setOriginPosition({originXPos:345})});this.chat.addEvent(this.id+"Minimized",function(B){A.chat.setTitle(A.contact.getUserName());A.sendChatView.getView().style.display="none"});this.chat.addEvent(this.id+"ArchiveTrash",function(B){x.debug("RTChatController ArchiveTrash");m.dispatch(A.id+"HideArchiveMenu",{});A.historyOfChat.displayModalConfirm({header:e.Confirmation,content:e.ConfirmCleanArchive},function(C){if(C){A.historyOfChat.mask(true);var E=false;for(var D=0;D<A.historyOfChat.messages.length;D++){if(!A.historyOfChat.messages[D].typeData){E=true;break}}if(!E){return A.onArchiveReceived({type:"archiveCleaned",roomID:A.id,qty:66})}if(A.historyOfChat.messages[A.historyOfChat.messages.length-1]){c.dispatch(c.eventName.CLEANARCHIVES,{interlocuteur:B,lastMessageID:A.historyOfChat.messages[A.historyOfChat.messages.length-1].msg_id,uuid:A.uuid})}else{c.dispatch(c.eventName.CLEANARCHIVES,{interlocuteur:B})}}else{m.dispatch(A.id+"DisplayArchiveMenu",{})}})});this.chat.addEvent(this.id+"ArchiveMail",function(){x.debug("RTChatController ArchiveMail "+this.id+"ArchiveMail");var C=A.historyOfChat.mail({me:r.getSetting("userName"),him:A.contact.contactModel.getUserName()});A.controller.lockMail=true;var B=new Blob([C.body],{type:"text/plain;charset=utf-8"});f.saveAs(B,(C.subject)+".txt")});this.historyOfChat=new d({controller:this,contactPicture:this.contact.getPicture()});if(this.historyOfChat){this.chat.addElement(this.historyOfChat.scrollerView.getContent())}this.msgUserInfo=new v();if(this.msgUserInfo){this.chat.addElement(this.msgUserInfo.getView());if(this.contact.getStatus()!=="Offline"){this.msgUserInfo.display(false)}}if(this.activeShare){this.sendGeneratedView=function(H,G,E,D,C){if(!H){if(H===null){return x.debug("RTChatController - dropped widget format is not supported")}else{if(H===false){return x.debug("RTChatController - can not generate html view from dropped widget")}}return x.debug("RTChatController - unknown error about generatedStringView")}else{var B;try{B=btoa(unescape(encodeURIComponent(H)))}catch(I){return x.debug("RTChatController - unable to btoa generated view")}if(D=="coreviewInvitation"){G=JSON.stringify(G)}var F={data:btoa(unescape(encodeURIComponent(G))),datahtml:B,uri:E};F=btoa(JSON.stringify(F));A.sendData({data:F,typeData:D,options:C})}};this.displayAlertSizeLimitReached=(function(B){return function(){B.alert({className:"error",message:e.ShareSizeLimitReached+" "+(this.shareSizeLimit/1000000)+(e.MegaOctet||"MB")})}})(this.historyOfChat);this.displayAlertError=(function(B){return function(C){B.alert({className:"error",message:C||e.canceled})}})(this.historyOfChat);this.sendDataFromDrop=function(L){var J=r.getSetting("shareSizeLimit")||9000000;L.stopPropagation();L.preventDefault();var E=!L?null:L.dataTransfer?L.dataTransfer.files:L.target?L.target.files:null;var K=[];var I;var G;var F;var P=null;if(E&&E.length>0&&(L.dataTransfer.types.length==1||L.dataTransfer.types[0]&&L.dataTransfer.types[0].indexOf("moz")!=-1)){I="fileTransfer";if(!A.activeShareFile){return x.debug("File sharing is not activated")}var M,N,R="";for(M=0;N=E[M];M++){R=E[M].name;K[R]=new FileReader();K[R].fileName=R;var Q="3DIMfiletransfer"+Date.now();K[R].fileId=Q;K[R].size=E[M].size;if(K[R].size>J){A.displayAlertSizeLimitReached();continue}K[R].onloadend=function(T){x.debug("RTChatController : file loaded : "+T.target.fileName);if(!A.sendDataView.files){A.sendDataView.files={}}A.sendDataView.files[T.target.fileId]={data:T.target.result,fileName:T.target.fileName,fileId:T.target.fileId};G={fileId:T.target.fileId,fileName:T.target.fileName,fileLength:T.target.size};P=A.sendDataView.generateViewFromFile(G);A.sendGeneratedView(P,G,F,"fileTransferInvitation",G);A.replaceProgressBar(T.target.fileId,e.Waiting,h.away);delete K[R]};K[R].readAsDataURL(E[M])}}else{I="DS3DXContent";var D,C;if(L.dataTransfer&&L.dataTransfer.getData&&L.dataTransfer.types){if(!Array.prototype.contains){if(Array.prototype.includes){Array.prototype.contains=Array.prototype.includes}else{Array.prototype.contains=function(T){if(L.dataTransfer.types.indexOf(T)!=-1){return true}return false}}}if(L.dataTransfer.types.contains("text")||L.dataTransfer.types.contains("Text")){G=L.dataTransfer.getData("text")}else{if(L.dataTransfer.types.contains("text/plain")){G=L.dataTransfer.getData("text/plain")}else{return x.debug("RTChatController ondrop senddata view : no data found in dataTransfer")}}if(L.dataTransfer.types.contains("text/plain")){D=L.dataTransfer.getData("text/plain")}else{D=G}if(L.dataTransfer.types.contains("text/uri-list")){F=L.dataTransfer.getData("text/uri-list")}else{if(L.dataTransfer.types.contains("Url")){F=L.dataTransfer.getData("Url")}else{F=G.url?G.url:null}}if(L.dataTransfer.types.contains("text/html")){C=L.dataTransfer.getData("text/html")}else{C=G}}else{if(L.detail){G=L.detail;D=G;C=G;F=G.url?G.url:L.detail.data&&L.detail.data.items&&L.detail.data.items[0]?L.detail.data.items[0].urlContent:null}else{return x.debug("RTChatController ondrop senddata view : no data attached")}}var S=undefined;if(typeof G=="object"){S=G}else{try{S=JSON.parse(decodeURIComponent(G));if(!F){F=S.data.items&&S.data.items[0]?S.data.items[0].urlContent:null}}catch(O){x.debug(O);S=undefined}}if(S&&S.data&&S.data.items&&S.data.items[0]){if(S.data.items[0].serviceId=="3DDrive"){A.displayAlertError(e.actionNotSupported||"This action is not supported");return false}else{if(S.data.items[0].serviceId=="3DSwym"||S.data.items[0].serviceId=="3DSpace"||(S.source==="X3DCSMA_AP"||S.source==="X3DMCTY_AP"||S.source=="X3DWNEW_AP"||S.source=="X3DDRIV_AP"||S.source=="X3PDRIV_AP")){P=A.sendDataView.generateViewFromJson(S.data.items[0]);if(!P){P=A.sendDataView.generateViewFromTile(S.data.items[0])}}}}else{if(S&&S.type&&S.type=="coreview"){if(!S.channel){return x.debug("RTChatController sendDataFromDrop received a coreview without channel !")}this.initCoreview(S.channel,true);P=null;A.sendGeneratedView("<div></div>",S,null,"coreviewInvitation",S);A.historyOfChat.alert({message:e.collabInvitationSent,className:"success"});return true}else{if(C&&C.indexOf("item-title")!=-1){P=A.sendDataView.generateViewFromNetvibes(C)}}}if(!P){if(C&&typeof C=="string"){var H=C.slice(C.length-3);if(C.indexOf("<img")===0){var B=D;if(B.indexOf("thumb")!=-1){B=C}P=A.sendDataView.generateViewFromImage(B);F=A.sendDataView.getURLFromImageString(P)}else{if(C.indexOf("http")==0&&(H=="jpg"||H=="png"||H=="gif"||H=="bmp")){P=A.sendDataView.generateViewFromImage(C)}else{if(C.indexOf("<a")!=-1){P=A.sendDataView.generateViewFromLink(C)}}}}if(!P&&F&&F.length>0){P=A.sendDataView.generateViewFromUrl(F)}}if(P&&P.length>J){this.displayAlertSizeLimitReached();return false}if(P){A.sendGeneratedView(P,G,F,I)}else{A.displayAlertError(e.formatNotSupported||"This content type is not supported");return false}}};this.sendDataView=new a({panelId:this.id,events:{ondrop:this.sendDataFromDrop}});if(this.sendDataView){this.chat.addElement(this.sendDataView.getView())}}this.sendChatView=new u({controller:this,holderTxt:e.PlaceHolderInputMsgSend});if(this.sendChatView){this.chat.addElement(this.sendChatView.getView())}if(this.contact.getStatus()===undefined){this.sendChatView.SendState(false)}c.addEvent(c.eventName.ONMESSAGERECEIVED,function(B){x.debug("RTChatController : ONMESSAGERECEIVED");if(B.from===A.contact.getId()||B.to===A.uuid){A.onMessageReceived(B)}});c.addEvent("onLeaveRoom",function(B){if(B.user.login===A.contact.getId()||B.room_id===A.uuid){x.debug("RTChatController : roomLeft room_id : "+B.room_id+" user : "+B.user.login);A.msgUserInfo.display(true,"ContactRemovedMessage")}});c.addEvent(c.eventName.ONPRESENCERECEIVED,function(B){x.debug("RTChatController : ONPRESENCERECEIVED");var C=r.getSetting("userLogin");if(B.userId===A.contact.getId()){if(B.username){A.chat.titlePanel.titleNameView.innerText=B.username}var E=r.getSetting("RTCStatus");var D="white";if(A.chat.titlePanel.dropdownMenuArchive&&!document.callAlwaysAvailable){A.chat.titlePanel.dropdownMenuArchive.deactivateCallButtons()}if(B.status==="Offline"){A.chat.changeTitleMainIconColor(h.offline);A.chat.changeTitleMainIconClassName("");A.msgUserInfo.display(true);A.stopCoreview(true)}else{A.msgUserInfo.display(false)}if(B.status==="Online"){A.chat.changeTitleMainIconColor(h.online);A.chat.changeTitleMainIconClassName("fonticon handler fonticon-check");if(A.chat.titlePanel.dropdownMenuArchive&&(r.getSetting("userStatus")=="Online"||document.callAlwaysAvailable)){A.chat.titlePanel.dropdownMenuArchive.activateCallButtons()}}if(B.status==="Away"){A.chat.changeTitleMainIconColor(h.away);A.chat.changeTitleMainIconClassName("fonticon handler fonticon-cancel")}if(B.status==="Busy"){A.chat.changeTitleMainIconColor(h.busy);A.chat.changeTitleMainIconClassName("fonticon handler fonticon-minus")}if(B.status==="DND"){A.chat.changeTitleMainIconColor(h.busy);A.chat.changeTitleMainIconClassName("fonticon handler fonticon-minus")}}else{if(C===B.userId&&A.chat.titlePanel.dropdownMenuArchive){if(B.status==="Online"&&r.getSetting("userStatus")=="Online"||document.callAlwaysAvailable){A.chat.titlePanel.dropdownMenuArchive.activateCallButtons()}else{A.chat.titlePanel.dropdownMenuArchive.deactivateCallButtons()}}}});m.addEvent(m.eventName.PANELICONISED,function(B){x.debug("RTChatController : PANELICONISED");if(B===A.id){A.sendChatView.getView().style.display="none"}});m.addEvent(m.eventName.PANELMAXIMIZED,function(B){x.debug("RTChatController : PANELMAXIMIZED");if(B===A.id){if(A.isAnIcon()){A.startChatWith(A.contact)}A.sendChatView.getView().style.display="block";A.sendChatView.focus()}});if(this.activeShare){m.addEvent(m.eventName.ONPANELDRAGOVER,function(B){if(B===A.id){if(A.sendDataView&&!A.sendDataView.isDisplayed){A.sendDataView.display(true)}}});m.addEvent(m.eventName.ONPANELDRAGLEAVE,function(B){x.debug("RTChatController : ONPANELDRAGOVER");if(B===A.id){if(A.sendDataView&&A.sendDataView.isDisplayed){A.sendDataView.display(false)}}});m.addEvent(m.eventName.ONPANELDROP,function(B){if(B===A.id){if(A.sendDataView&&!A.sendDataView.isDisplayed){A.sendDataView.dispatch("ondrop",B)}}})}if(this.activeArchive){this.historyOfChat.injectSpinner();c.dispatch(c.eventName.GETARCHIVES,[{from:A.id,uuid:A.uuid,roomid:A.id,archive_qty:r.getSetting("archive_qty")||10}])}c.addEvent(c.eventName.ONARCHIVERECEIVED,function(B){x.debug("RTChatController : ONARCHIVESRECEIVED");if(B.dateMsg){B.dateMsg=B.dateMsg.replace(/ /g,"T")}A.onArchiveReceived(B)})}}},initCoreview:function(z,y){if(!z||typeof z!="string"){return x.debug("RTChatController initCoreview received a coreview without channel !")}this.coreviewChannel=z;x.debug("RTChatController : initCoreview");b.subscribe(this.coreviewChannel,(function(A){return function(B){if(B.action=="dataCollab"){if(typeof B!="object"){return x.debug("RTChatController received bad dataCollab")}A.sendData({data:btoa(JSON.stringify(B)),typeData:"dataCollab"})}}})(this))},endCoreview:function(y){if(!y||y!=this.coreviewChannel){return x.debug("RTChatController endCoreview coreview channel does not match the current one!")}this.stopCoreview();this.hideCoreviewMenu();this.coreviewChannel=null},displayCoreviewMenu:function(y){if(!this.coreviewChannel){return x.debug("ChatController displayCoreviewMenu called without channel")}this.chat.titlePanel.injectCoreviewMenu();this.chat.titlePanel.coreviewButton.style.display="inline-block";this.chat.titlePanel.coreviewDropDownMenu=new o({target:this.chat.titlePanel.coreviewButton,items:[{text:e.CoreviewStop||"Stop Coreview",name:"wtf",icon:"fonticon fonticon-stop",handler:(function(z){return function(){z.stopCoreview()}})(this)}]});this.chat.titlePanel.coreviewDropDownMenu.getContent().style.zIndex="3000";if(!y){this.chat.titlePanel.coreviewDropDownMenu.addItem({text:e.CoreviewRequestMaster||"Request control",name:"wtf",icon:"fonticon fonticon-switch",handler:(function(z){return function(){z.historyOfChat.alert("not implemented yet")}})(this)})}},hideCoreviewMenu:function(){this.chat.titlePanel.destroyCoreviewMenu();if(!this.chat.titlePanel.coreviewDropDownMenu){return true}this.chat.titlePanel.coreviewDropDownMenu.destroy();this.chat.titlePanel.coreviewButton.style.display="none"},onDataCollabReceived:function(y){b.publish(this.coreviewChannel,{action:"dataCollabReceived",data:y})},acceptCoreview:function(y){if(!y){x.debug("acceptCoreview without channel")}this.displayCoreviewMenu();this.sendData({data:"accept",typeData:"coreviewInvitation",options:{accept:true,channel:y}});this.coreviewChannel=y;this.initCoreview(y,false);this.startCoreview(false);b.publish(this.coreviewChannel,{action:"subscribeToChannelAndStartCollab",channel:y})},refuseCoreview:function(y){this.sendData({data:"refuse",typeData:"coreviewInvitation",options:{accept:false,channel:y}})},startCoreview:function(y){if(!this.coreviewChannel){return x.debug("startCoreview without channel")}this.displayCoreviewMenu(y);c.dispatch(c.eventName.SETSTATUS,{myStatus:"Busy",statusMsg:"Busy"});b.publish(this.coreviewChannel,{action:"startCollab",isMaster:y})},stopCoreview:function(y){if(!this.coreviewChannel){return x.debug("stopCoreview without channel")}this.hideCoreviewMenu();this.historyOfChat.alert({message:e.collabStopped,className:"warning"});b.publish(this.coreviewChannel,{action:"stopCollab"});c.dispatch(c.eventName.SETSTATUS,{myStatus:"Online",statusMsg:"Online"});if(y!==true){this.sendData({data:"stop",typeData:"coreviewInvitation",options:{channel:this.coreviewChannel}})}},onArchiveReceived:function(B){if(this.historyOfChat&&(this.id==B.roomID||this.uuid&&this.uuid===B.uuid)){if(!this.historyOfChat.messagestemp){this.historyOfChat.messagestemp=[]}if(!this.uuid){this.uuid=B.uuid}if(B.type){if(B.type=="archive_qty"&&(B.archive_qty||B.archive_qty===0)){if(this.historyOfChat.messagestemp_qty){return true}this.historyOfChat.messagestemp_qty=B.archive_qty;if((this.historyOfChat.messagestemp_qty==="0"||this.historyOfChat.messagestemp_qty===0)&&!this.historyOfChat.NoMoreArchive){this.historyOfChat.NoMoreArchive=true;this.historyOfChat.scrollerView.getInnerElement().onscroll=null;this.historyOfChat.removeSpinner();if(this.historyOfChat.messages.length>1){this.historyOfChat.injectMessage(e.NoMoreArchive,"top")}}return true}else{if(B.type=="archiveCleaned"){x.debug("3DIM RTChatController - archiveCleaned stanza received");this.historyOfChat.mask(false);if(!B.qty||B.qty===-1||B.qty==="-1"){this.historyOfChat.alert({message:e.CleanArchiveFailed,className:"error"})}else{this.historyOfChat.globalView.empty();this.historyOfChat.messages.length=0;delete this.historyOfChat.lastMsgTime;this.historyOfChat.alert({message:e.CleanArchiveConfirmed,className:"success"})}return true}}}if(this.historyOfChat.messagestemp_qty===undefined){this.historyOfChat.messagestemp_qty=0}if(B.msg==="3DIMmessages3DIMsoon3DIMdeleted3DIM"){if(B.isSend){this.historyOfChat.alert({message:e.SoonPurgeArchive,className:"warning"})}this.historyOfChat.messagestemp_qty--;this.historyOfChat.removeSpinner();return true}if(B.msg==="3DIMmessages3DIMdeleted3DIM"){if(B.isSend){this.historyOfChat.alert({message:e.PurgeArchive,className:"info"})}this.historyOfChat.messagestemp_qty--;this.historyOfChat.removeSpinner();return true}this.historyOfChat.messagestemp.push(B);if(this.historyOfChat.messagestemp.length>=this.historyOfChat.messagestemp_qty){this.historyOfChat.messagestemp_qty=0;this.historyOfChat.messagestemp.sort(function(D,C){if(D.msg_id&&C.msg_id&&!isNaN(D.msg_id)){if(D.msg_id<C.msg_id){return -1}else{if(D.msg_id>C.msg_id){return 1}}}else{if(D.dateMsg&&C.dateMsg){var F=new Date(D.dateMsg.replace(/ /g,"T"));var E=new Date(C.dateMsg.replace(/ /g,"T"));if(F<E){return -1}if(F>E){return 1}}else{return 1}}return 0});var z=this.historyOfChat.messages?(this.historyOfChat.messages.length?false:true):true;var y=z?0:this.historyOfChat.lastMsg.globalView;for(var A=this.historyOfChat.messagestemp.length-1;A>=0;A--){this.historyOfChat.addMessage(this.historyOfChat.messagestemp[A],this.historyOfChat.messagestemp[A].isSend?"sent":"received","top",(A?false:false))}this.historyOfChat.removeSpinner();m.dispatch(this.id+"DisplayArchiveMenu",{});if(!z){this.historyOfChat.scrollerView.scrollTo(0,y.getBoundingClientRect().top-this.historyOfChat.getView().getBoundingClientRect().top)}else{this.historyOfChat.scrollToBottom()}this.historyOfChat.lastMessageID=this.historyOfChat.messagestemp[0].msg_id||0;this.historyOfChat.messagestemp.length=0;delete this.historyOfChat.messagestemp_qty;this.canGetArchive=true}}},onMessageReceived:function(C){x.debug("RTChatController onMessageReceived");if(this.historyOfChat){if(C.fileId){if(C.numpart&&C.nbpart){if(C.typeData=="fileTransfer"&&C.data==="progress"){if(C.numpart>=C.nbpart&&this.sendDataView.files){this.sendDataView.files[C.fileId]=null}return this.setProgressBar(C.fileId,C.nbpart,C.numpart)}if(C.typeData!="fileTransferInvitation"){var A=parseInt(C.numpart,10);var D=parseInt(C.nbpart,10);this.setProgressBar(C.fileId,D,A);this.sendData({data:"progress",typeData:"fileTransfer",options:{numpart:A,nbpart:D,fileName:C.fileName,fileId:C.fileId}});if(A<D){return true}if(A>D){return x.debug("RTChatController onMessageReceived - a file transfer is taking too much parts !!! (severe error)")}}}if(C.typeData=="fileTransferInvitation"&&(C.data=="accept"||C.data=="refuse")){var z=this.sendDataView.files[C.fileId];if(!z){return x.debug("ERROR file not found : "+C.fileId+C.fileName)}if(C.data=="accept"){x.debug("fileTransfer accepted "+C.fileName);this.replaceProgressBar(C.fileId,e.InProgress,h.away);this.sendData({data:z.data,typeData:"fileTransfer",options:z})}else{if(C.data=="refuse"){x.debug("fileTransfer refused "+C.fileName);this.replaceProgressBar(C.fileId,e.canceled);delete this.sendDataView.files[C.fileId]}}return true}}else{if(C.typeData==="coreviewInvitation"){switch(C.data){case"accept":this.historyOfChat.alert({message:e.collabAccepted,className:"success"});this.startCoreview(true);break;case"refuse":this.historyOfChat.alert({message:e.collabRefused,className:"error"});break;case"stop":this.stopCoreview(true);default:var y;try{y=JSON.parse(decodeURIComponent(atob(JSON.parse(atob(C.data)).data))).channel}catch(B){return x.debug("RTChatController received a coreviewInvitation but can not find the channel ")}this.historyOfChat.displayModalConfirm({content:e.confirmReceiveCoreview,header:e.confirmReceiveCoreviewHeader},(function(E){return function(F){if(F){return E.acceptCoreview(y)}if(F===false){E.refuseCoreview(y)}}})(this),true);break}return true}else{if(C.typeData==="dataCollab"){this.onDataCollabReceived(C.data);return true}}}m.dispatch(this.id+"DisplayArchiveMenu",{});this.historyOfChat.addMessage(C,C.from===r.getSetting("userLogin")?"sent":"received","bottom",this.historyOfChat.messages?(this.historyOfChat.messages.length>0?false:true):true)}if(this.chatModel){this.chatModel.onMessageReceived(C)}},setProgressBar:function(y,B,A){if(!y||isNaN(B)||isNaN(A)){return x.debug("RTChatController setProgressBar bad args")}if(B==A){return this.replaceProgressBar(y,e.fileTransferComplete,h.online)}var z=document.getElementById(y);if(!z){return x.debug("setProgressBar : div of the file not found")}this.historyOfChat.injectSpinner("bottom");this.historyOfChat.scrollToBottom()},replaceProgressBar:function(y,E,A){if(!y||!E){return x.debug("RTChatController replaceProgressBar bad args")}this.historyOfChat.removeSpinner();var C=document.getElementById(y);if(!C){return x.debug("replaceProgressBar : div of the file not found")}var B=C.getElementsByTagName("progress")[0];if(!B){return x.debug("replaceProgressBar : div of the progress bar not found")}var D=y+"RTProgressStatus";var F=document.getElementById(D);if(F){if(F.remove){F.remove()}else{if(F.removeNode){F.removeNode()}else{x.debug("replaceProgressBar did not find a function to remove the dom element of progress bar Status")}}}var z=document.createElement("div");z.id=D;z.appendChild(document.createTextNode(E));z.style.color=A||h.busy;B.parentElement.appendChild(z)},sendMessage:function(B,F){x.debug("RTChatController sendMessage");if(this.historyOfChat){var y=new Date();var D=UWA.Date.strftime(y,"%Y-%m-%d %H:%M:%S");var C=y.getTime();var z=r.getSetting("userLogin");var E=r.getSetting("userName");var G={dateMsg:D,timestamp:C,to:this.contact.getId(),username:E,login:z,status:this.contact.getStatus(),activeArchive:this.activeArchive,where:"3DIMWeb",msg:B,room:this.id,uuid:this.uuid};var A={dateMsg:D,timestamp:C,to:this.contact.getId(),username:E,login:z,status:this.contact.getStatus(),activeArchive:this.activeArchive,where:"3DIMWeb",msg:B};this.historyOfChat.addMessage(A,"sent");m.dispatch(this.id+"DisplayArchiveMenu",{});c.dispatch(c.eventName.SENDMSG,[G])}},acceptFile:function(y){this.historyOfChat.injectSpinner("bottom");this.historyOfChat.scrollToBottom();this.sendData({data:"accept",typeData:"fileTransferInvitation",options:{accept:true,fileName:y.fileName,fileId:y.fileId}})},refuseFile:function(y){this.sendData({data:"refuse",typeData:"fileTransferInvitation",options:{accept:false,fileName:y.fileName,fileId:y.fileId}});this.replaceProgressBar(y.fileId,e.canceled)},sendData:function(D){x.debug("RTChatController sendData");if(this.historyOfChat){var E=new Date();var C=UWA.Date.strftime(E,"%Y-%m-%dT%H:%M:%S");var B=E.getTime();var z=r.getSetting("userLogin");var A=r.getSetting("userName");var y={crdate:C,timestamp:B,to:this.contact.getId(),username:A,login:z,status:this.contact.getStatus(),where:"3DIMWeb",data:D.data,persisted:D.persisted,typeData:D.typeData,fileName:D.options?D.options.fileName:null,fileId:D.options?D.options.fileId:null,nbpart:D.options?D.options.nbpart:null,numpart:D.options?D.options.numpart:null,accept:D.options?D.options.accept:null,roomId:this.uuid};if(D.data!="accept"&&D.data!="refuse"&&D.data!="progress"&&D.typeData!="coreviewInvitation"&&D.typeData!="dataCollab"){if(D.typeData=="fileTransfer"){if(y.nbpart>=y.numpart){this.historyOfChat.addMessage(y,"sent")}}else{this.historyOfChat.addMessage(y,"sent")}}m.dispatch(this.id+"DisplayArchiveMenu",{});c.dispatch(c.eventName.SENDDATA,[y])}},move:function(z,y){x.debug("RTChatController move");this.chat.move(z,y)},getOldPosition:function(){x.debug("RTChatController getOldPosition");return this.chat.getOldPosition()},getOriginPosition:function(){x.debug("RTChatController getOriginPosition");return this.chat.getOriginPosition()},render:function(y){x.debug("RTChatController render");this.chat.render(y);this.chat.maximized();this.displayChat=true;this.isRender=true},maximize:function(){x.debug("RTChatController maximize");if(this.chat){this.chat.maximized()}},iconise:function(){x.debug("RTChatController iconise");this.sendChatView.getView().style.display="none";this.chat.iconise()},getPanelLarger:function(){x.debug("RTChatController getPanelLarger");return this.chat.getLarger()},isDisplay:function(){x.debug("RTChatController isDisplay");return this.displayChat},isAnIcon:function(){x.debug("RTChatController isAnIcon");return this.chat.isAnIcon()},getContact:function(){x.debug("RTChatController getContact");return this.contact},getPanel:function(){x.debug("RTChatController getPanel");return this.chat},show:function(){x.debug("RTChatController show");if(!this.displayChat){var y={userName:this.contact.getUserName(),login:this.contact.getLogin(),userId:this.contact.getId(),status:this.contact.getStatus()};this.controller.addContactToRecentChat(y);if(this.isRender){this.displayChat=true;this.chat.setDisplayPanel(this.displayChat);m.dispatch(m.eventName.ONMAXIMIZEDCLICK,[this.chat.id])}else{this.displayChat=true;this.render(document.body)}var z=this.historyOfChat.getView().scrollHeight;this.historyOfChat.scrollerView.scrollTo(0,z);c.dispatch(c.eventName.GETSTATUS,[y]);if(this.activeArchive){this.historyOfChat.scrollerView.getInnerElement().onscroll=function(){if(this.historyOfChat.NoMoreArchive){return false}var A=this.historyOfChat.scrollerView.getInnerElement();if(!A.scrollTop&&this.historyOfChat.messages&&this.historyOfChat.messages.length&&this.canGetArchive){this.canGetArchive=false;this.historyOfChat.injectSpinner();c.dispatch(c.eventName.GETARCHIVES,[{to:this.id,uuid:this.uuid,archive_qty:r.getSetting("archive_qty")||10,roomid:this.id,lastMessageID:this.historyOfChat.lastMessageID}])}}.bind(this)}}},setNotif:function(y){x.debug("RTChatController setNotif");this.chat.setNotif(y)},getNumberOfIconiseChat:function(){x.debug("RTChatController getNumberOfIconiseChat");return this.controller.getNumberOfIconiseChat()},startChatWith:function(y){x.debug("RTChatController startChatWith");m.dispatch(m.eventName.STARTCHAT,[y])},getWidth:function(){return this.chat.getWidth()},setDisplayPanel:function(y){this.chat.setDisplayPanel(this.displayPanel)}});return w});define("DS/InstantMessaging/js/controller/RTBuddyListController",["UWA/Class","UWA/Class/Events","UWA/Utils","DS/InstantMessaging/js/controller/RTPanelController","DS/InstantMessaging/js/view/RTListOfGroupView","DS/InstantMessaging/js/view/RTBottomBarView","DS/InstantMessaging/js/controller/RTGroupController","DS/RTProxyDriver/RTProxyDriver","DS/InstantMessaging/js/controller/RTEventBusController","DS/InstantMessaging/js/controller/RTSettingController","i18n!DS/InstantMessaging/assets/nls/feed","DS/RTProxyDriver/RTLogger","DS/RTColors/RTColors"],function(c,m,g,d,b,j,n,i,e,f,l,k,a){k.debug("RTBuddyListController load");var h=c.extend(m,{init:function(o){var p=this;this.editMode=false;this.listOfGroup={};this.listOfCurrent={};this.listOfRecent={};this.activeEditMode=false;this.connected=false;this.id=o.id;this.controller=o.controller;this.sizeOnY=o.sizeOnY;this.originXPos=o.originXPos;this.originYPos=o.originYPos;this.minimumSize=o.minimumSize;this.titleOpt=o.titleOpt;this.minimumResize=o.minimumResize;this.panelLarger=o.panelLarger;this.active3DIM=o.active3DIM;this.searchString="";this.initBuddylistPanel();this.initEventListener();this.groups3DIM=UWA.Utils.getQueryString(document.URL,"groups3DIM");this.updateNotDone=true},initBuddylistPanel:function(){var s=this;var q={id:this.id,controller:this,originXPos:this.originXPos,originYPos:this.originYPos,sizeOnY:this.sizeOnY,minimumSize:this.minimumSize,titleOpt:this.titleOpt,minimumResize:this.minimumResize,panelLarger:this.panelLarger,iconeIconise:{type:"span",src:"fonticon handler fonticon-list",activeMiniStatus:true,hiddenAfterClick:true},showOfflineView:true,active3DIM:this.active3DIM};this.buddyList=new d(q);var p=UWA.Utils.getQueryString(document.URL,"maxi3DIM");if(p){this.buddyList.maximized()}else{e.dispatch(e.eventName.ONICONISEPANELCLICK,[s.getId()])}var q={groupId:"searchChatId",controller:this,groupType:"search"};this.searchController=new n(q);this.listOfGroup.searchChatId=this.searchController;var u=this.searchController.getView();if(u){k.debug("RTBuddyListController : Add search View done.");this.buddyList.addElement(u)}else{k.debug("RTBuddyListController : Error Add search view.")}this.listOfGroupView=new b();var r=UWA.createElement("div",{styles:{width:"100%",height:"5px"},events:{}});r.ondragover=function(v){k.debug("RTBuddyListController : Scroller test.");s.listOfGroupView.mouveUp()};this.buddyList.addElement(r);this.buddyList.addElement(this.listOfGroupView.getView());q={groupId:"Recents",titleGroup:"Recents",fonticonElement:"fonticon-clock",isHidden:true,connection:this.connection,controller:this,groupType:"rtc",displayNumberOfcontact:true,isDraggable:false,isLocked:true};this.recentChatController=new n(q);this.listOfGroup.Recents=this.recentChatController;var t=this.recentChatController.getView();if(t){this.listOfGroupView.addElement(t)}else{k.debug("RTBuddyListController : Error get recentChatControllerView controller view.")}var o=UWA.createElement("div",{styles:{width:"100%",height:"5px"},events:{}});o.ondragover=function(v){s.listOfGroupView.mouveDownp()};this.buddyList.addElement(o);this.bottomBarView=new j({controller:this});this.buddyList.addElement(this.bottomBarView.getView());this.listOfGroupView.setNoElement(true)},initEventListener:function(){var o=this;i.addEvent(i.eventName.STATUSUPDATED,function(q){k.debug("RTBuddyListController : STATUSUPDATED received");var r=f.getSetting("RTCStatus");var p="white";if(q==="Online"){o.buddyList.changeTitleMainIconColor(a.online)}if(q==="Offline"){o.buddyList.changeTitleMainIconColor(a.offline)}if(q==="Away"){o.buddyList.changeTitleMainIconColor(a.away)}if(q==="Busy"){o.buddyList.changeTitleMainIconColor(a.busy)}if(q==="DND"){o.buddyList.changeTitleMainIconColor(a.busy)}});i.addEvent(i.eventName.BUDDYLISTBUILT,function(v){k.debug("RTBuddyListController : BUDDYLISTBUILT received");var u,q,p,s,r;o.removeAll(true);var t=false;for(r in v){o.addGroup(r,"rtc");u=v[r];if(u.toRemove){o.removeGroup(r);continue}if(r=="_"){continue}for(s in u.users){p=u.users[s];if(p.toRemove){o.removeContact(r,p)}else{o.addContact(r,p)}}}if(u=v._){for(s in u.users){p=u.users[s];if(p.toRemove){o.removeContact("_",p)}else{o.addContact("_",p)}}}if(v.GROUPTMP){e.dispatch(e.eventName.DISPLAYGLISTOFCONTACT,["GROUPTMP"])}});i.addEvent(i.eventName.RESULTOFSEARCH,function(r){k.debug("RTBuddyListController : RESULTOFSEARCH received");var t=o.listOfGroup.searchChatId;if(t){t.clearAllElement();if(r.length>0){var u,q,s,p=f.getSetting("userLogin");for(var v=0;v<(r.length<7?r.length:7);v++){u=r[v];s=u.userId.indexOf("@")!=-1?u.userId.substring(0,u.userId.indexOf("@")):u.userId;if(s!==p){q={userId:u.userId,userName:decodeURI(u.userName),login:decodeURI(s),addIcon:true,where:"3DIMWeb",status:u.status};i.dispatch(i.eventName.GETSTATUS,[q]);t.addContact(q,true)}}if(r.length>=7){t.dislayMessage(l.RefineSearchResult)}t.resizeView()}else{t.dislayMessage(l.NoResultFound);t.resizeView()}}});i.addEvent(i.eventName.CREATEGROUP,function(p){if(o.listOfGroup.addGroupID){o.removeGroup("addGroupID")}o.addGroup(p,"rtc");if(o.listOfGroup[p]){o.listOfGroup[p].setEditMode(o.editMode)}});i.addEvent(i.eventName.REMOVEGROUP,function(p){if(o.listOfGroup[p]){o.removeGroup(p)}});this.buddyList.addEvent(this.id+"Closed",function(p){e.dispatch(e.eventName.ICONISEALLCLICK,[]);e.dispatch(e.eventName.ACTIVEMINIZONE,[false])});e.addEvent(e.eventName.ONADDGROUPCLICK,function(s){if(!o.listOfGroup.addGroupID){var q={groupId:"addGroupID",titleGroup:l.ChangeTitleName,fonticonElement:"fonticon-users",controller:this,groupType:"rtc",displayNumberOfcontact:true};var r=new n(q);r.setChangeName(true);o.listOfGroup[q.groupId]=r;var p=r.getView();if(p){o.listOfGroupView.addElement(p)}}});e.addEvent(e.eventName.ONADDCONTACT,function(q){k.debug("Add contact from plus button.");var p={userId:q.user.userId,userName:q.user.userName,login:q.user.login,status:q.user.status};i.dispatch(i.eventName.ADDCONTACT,{user:p,group:q.group});o.addContact(q.group,p,true)});i.addEvent(i.eventName.RENAMEGROUPVIEW,function(p){o.renameGroup(p.oldName,p.newName)})},render:function(o){this.buddyList.render(o)},addGroup:function(s,q){if(s==="undefined"){return false}if(this.listOfGroup[s]===undefined){var t=s;var p={groupId:s,titleGroup:t,fonticonElement:"fonticon-users",connection:this.connection,controller:this,groupType:q,displayNumberOfcontact:true,isDraggable:true};if(s==="Support"){p.isLocked=true}var r=new n(p);this.listOfGroup[s]=r;if(s!=="_"){var o=r.getView();if(o){k.debug("Get recentChatControllerView controller view done.");this.listOfGroupView.addElement(o,"bottom")}else{k.debug("Error get recentChatControllerView controller view.")}}}},removeAll:function(p){this.searchController.clearAllElement();this.searchController.clearInput();if(!p){this.recentChatController.clearAllElement(true);this.setRecentChatIsHidden(true)}for(var o in this.listOfGroup){if(o!=="searchChatId"&&o!=="Recents"&&o!=="Support"){this.removeGroup(o)}}this.listOfGroupView.setNoElement(true)},removeGroup:function(o){this.listOfGroup[o].removeGroup();delete this.listOfGroup[o];if(this.listOfGroup.length===0){this.listOfGroupView.setNoElement(true)}},renameGroup:function(s,r){if(!r||!s){k.debug("RTBuddyListController renameGroup bad args")}if(!this.listOfGroup[s]){k.debug("RTBuddyListController renameGroup oldGroupName does not exist")}var q,p=encodeURIComponent(r),o=p;for(q=1;this.listOfGroup[o]||q>100;q++){o=p+"_"+q}this.listOfGroup[o]=this.listOfGroup[s];this.listOfGroup[o].setName(decodeURIComponent(o));this.listOfGroup[o].setId(o);delete this.listOfGroup[s];i.dispatch(i.eventName.RENAMEGROUP,[{oldName:s,newName:o}])},addContact:function(s,o,q){var r=this;var p=this.listOfGroup[s];if(p){p.addContact(o,q);if(s==="_"){this.listOfGroupView.addElement(p.getMember(o.userId).getView(),"bottom")}}},removeContact:function(r,q){var p=this;var o=this.listOfGroup[r];if(o){o.removeMember(q)}},setRecentChatIsHidden:function(o){this.recentChatController.setIsHidden(o)},addNotif:function(o){},searchContact:function(o,p){if(!p){i.dispatch(i.eventName.SEARCHCONTACT,o)}else{i.dispatch(i.eventName.SEARCHCONTACT,{name:o,isForShareAPI:true})}},addContactToRecentChat:function(o){k.debug("RTBuddyListController addContactToRecentChat");var s=o.userId;if(this.listOfRecent[s]===undefined){this.listOfGroupView.setNoElement(false);var p=this;var t=Date.now();k.debug("RTBuddyListController addContactToRecentChat see the comment");this.recentChatController.addContact(o,false);this.listOfRecent[s]={contact:this.recentChatController.listOfContact[s],timestamp:t};p.recentChatController.setIsHidden(false);try{var q=p.recentChatController.getView();q.parentElement.removeChild(q);p.listOfGroupView.addElement(q);k.debug("RTBuddyListController  addContactToRecentChat group Recents has been set at the top of the listofgroupview")}catch(r){k.debug("RTBuddyListController addContactToRecentChat unable to set Recents group at the top")}}},removeContactFromRecentChat:function(o){delete this.listOfRecent[o.getId()];this.removeContact("Recents",o)},getEditMode:function(){return this.editMode},startChatWith:function(o){if(this.controller){this.controller.startChatWith(o)}},setNotif:function(o){this.buddyList.setNotif(o)},cleanAll:function(){for(var o in this.listOfGroup){this.removeGroup(o)}},showBuddyList:function(){if(this.isAnIcon()||!this.getDisplayPanel()){this.buddyList.showPanel();e.dispatch(e.eventName.ONMAXIMIZEDCLICK,[this.id])}},closeBuddyList:function(){this.buddyList.closePanel()},isAnIcon:function(){return this.buddyList.isAnIcon()},isMinimize:function(){return this.buddyList.isMinimize()},getId:function(){return this.id},getDisplayPanel:function(){return this.buddyList.getDisplayPanel()},setDisplayPanel:function(o){this.buddyList.setDisplayPanel(o)},activeSignInView:function(p,o){this.buddyList.activeSignInView(p,o)},activeOfflineView:function(o){this.buddyList.activeOfflineView(o)},setTenantName:function(o){this.buddyList.setTenantName(o)},destroy:function(){this.buddyList.destroy()}});return h});define("DS/InstantMessaging/js/controller/InstantMessagingController",["UWA/Class","UWA/Class/Events","UWA/Utils","UWA/Core","DS/WAFData/WAFData","DS/TopBarProxy/TopBarProxy","DS/TopBarProxy/MenuItem","DS/InstantMessaging/js/controller/RTBuddyListController","DS/InstantMessaging/js/controller/RTChatController","DS/InstantMessaging/js/controller/RTContactController","DS/InstantMessaging/js/controller/RTSettingController","DS/RTProxyDriver/RTProxyDriver","DS/InstantMessaging/js/controller/RTEventBusController","DS/InstantMessaging/js/controller/RTPanelController","DS/InstantMessaging/js/view/RTMinimizePanelView","DS/InstantMessaging/js/view/RTShareContentView","DS/UWPClientCode/PublicAPI","DS/PlatformAPI/PlatformAPI","i18n!DS/InstantMessaging/assets/nls/feed","DS/RTColors/RTColors","DS/UIKIT/Input/Button","DS/RTProxyDriver/RTLogger","css!InstantMessaging/InstantMessaging.css"],function(u,q,g,c,d,w,i,t,x,r,s,h,p,m,b,l,n,f,j,k,o,y){y.debug("InstantMessagingController load 2");var e=undefined;var a="NODE";var v=u.extend(q,{init:function(H){y.debug("InstantMessagingController init");var C=this;this.expanded=false;this.lockIconise=false;this.iconExpanded={};this.listOfChat={};this.listOfSysStatus={};this.activeChatPanel=[];this.active3DIM=H.tenants;this.myStatus=undefined;this.lockMail=false;this.appName=H.appName?H.appName:n.getApplicationConfiguration("app.build.name");this.favoriteTenant=H.favoriteTenant;this.logger=y;this.x3DPhotoWidgetLoaded=false;s.setSetting("appName",this.appName);this.isDevMode=H.devMode&&!H.ODTMode;if(this.isDevMode){UWA.debug=true;s.setSetting("defaultAvatarURL","./assets/avatarDefault.png");this.login=H.devOpt.login.split("@")[0];document.getElementById("postlogin")?document.getElementById("postlogin").style.display="inline-block":null;document.getElementById("prelogin")?document.getElementById("prelogin").style.display="none":null;var A="login : "+H.devOpt.login;A+="<br>server : <a href='"+H.devOpt.server+"' target='_blank'>"+H.devOpt.server+"</a>";var E=UWA.Utils.getQueryString(document.URL,"driver3DIM")||a;this.nameApp=E;A+="<br>driver : "+E;var F=document.getElementById("userInfos");F?F.innerHTML=A:console.log(A);var z=document.getElementById("btnLogout");if(z){var B=new o({value:"Logout"}).inject(z);B.addEvent("onClick",function(){h.dispatch(h.eventName.LOGOUT,[{nameApp:E}])})}}else{s.setSetting("defaultAvatarURL","./resources/en/1/webapps/InstantMessaging/assets/avatarDefault.png");this.login=H.userId?H.userId:n.user.login}this.isInitTopBar=false;this.topBarId=H.topBarId;s.setSetting("imPort","5281");s.setSetting("archive_qty",20);s.setSetting("shareSizeLimit",9000000);var G=UWA.Utils.getQueryString(document.URL,"imPort3DIM");if(G){s.setSetting("imPort",G)}this.activeArchive=UWA.Utils.getQueryString(document.URL,"archive3DIM")||H.activeArchive;if(this.activeArchive){s.setSetting("activeArchive",false)}else{s.setSetting("activeArchive",true)}this.activeShare=UWA.Utils.getQueryString(document.URL,"share3DIM");this.activeShare=true;if(this.activeShare){s.setSetting("activeShare",true)}else{s.setSetting("activeShare",false)}this.activeShareFile=true;if(this.activeShareFile){s.setSetting("activeShareFile",true)}else{s.setSetting("activeShareFile",false)}var D=UWA.Utils.getQueryString(document.URL,"driver3DIM");if(D&&(D==="XMPP"||D==="NODE")){s.setSetting("driver",D)}else{s.setSetting("driver",a)}s.setSetting("userLogin",this.login);s.setSetting("userName",n.user.firstName+" "+n.user.lastName);if(H.devMode){s.setSetting("userName",H.devOpt.login.split("@")[0])}else{if(H.userName){s.setSetting("userName",H.userName)}else{s.setSetting("userName",n.user.firstName+" "+n.user.lastName)}}this.addEvent("onTenantChanged",function(I){y.debug("Tenant changed");e.cleanAll();C.getRTCServerInfo(H)});this.initBuddyList();this.showBuddylist();this.initGlobalIcon();if(H.devMode){this.initDevEnv(H);e.activeOfflineView(false)}else{this.getRTCServerInfo(H)}this.initEventListener();if(H.devOptFct){H.devOptFct(this)}},initGlobalIcon:function(){this.miniPanels=new b({OpenBuddyList:function(){e.showBuddyList()}});this.miniPanels.getView().inject(document.body)},initBuddyList:function(){y.debug("InstantMessagingController initBuddyList");if(e===undefined){var z={titleName:{txt:"3DMessaging",eventName:"onBuddylistNameClick"},eventResizePanel:{MouseDown:"onResizeBLPanelMouseDown",MouseUp:"onResizeBLPanelMouseUp"},minimizeButton:true,closeButton:true,iconiseAll:true,activeMenu:true};var A={controller:this,id:"RTBuddyListID",originXPos:66,originYPos:0,sizeOnY:400,minimumSize:42,minimumResize:380,panelLarger:270,titleOpt:z,active3DIM:this.active3DIM};e=new t(A)}},showBuddylist:function(){y.debug("InstantMessagingController showBuddylist");if(e){e.render(document.body);var z=UWA.Utils.getQueryString(document.URL,"maxi3DIM");if(!z){e.closeBuddyList()}}},initTopBar:function(z){y.debug("InstantMessagingController initTopBar");var D,B,A,E=this;this.topBarProxy=new w({id:this.topBarId});var G=this.topBarProxy.callback=function(I){var J=I.get("label");if(s.getSetting("widget3DIM")&&J==="3DMessaging"){if(E.appName==="3DSwym"){E.load3DIMW()}else{window.location.href+="/sidepanel:MAP-DRCMQIWVY"}}else{if(J==="3DMessaging"){if(e){if(e.isMinimize()&&E.miniPanels.globalDisplay===true){e.showBuddyList()}else{p.dispatch(p.eventName.ACTIVEMINIZONE,[true]);e.showBuddyList()}}}else{if(J===j.Signout){p.dispatch(p.eventName.SIGNOUT,[]);E.isLoggedIn=false}else{if(E.isLoggedIn){h.dispatch(h.eventName.SETSTATUS,{myStatus:E.listOfSysStatus[J],statusMsg:E.listOfSysStatus[J]})}}}}};this.subMenu=[];var C,H;for(D in z){this.listOfSysStatus[j[D]]=D;if(D=="Offline"||D=="Away"){C="Appear"+D;H="Appear "+D;this.listOfSysStatus[H]=D}else{C=D}this.subMenu.push(new i({label:j[C],checked:(D==="Online"),onExecute:G}))}A=0;for(B in this.active3DIM){if(this.active3DIM[B].imActive){A++}}if(A>1){this.subMenu.push(new i({label:j.Signout,checked:false,onExecute:G}))}this.topBarProxy.setContent({profile:[{label:"3DMessaging",submenu:this.subMenu,onExecute:G}]});var F=this.topBarProxy;h.addEvent(h.eventName.LOGOUT,function(){E.subMenu.forEach(function(I){I.set("disabled",true)})})},initEventListener:function(){y.debug("InstantMessagingController initEventListener");var z=this;h.addEvent(h.eventName.ONMESSAGERECEIVED,function(G){y.debug("InstantMessagingController : ONMESSAGERECEIVED");e.setNotif(true);var C;if(s.getSetting("userLogin")===G.from){for(var E in z.listOfChat){if(z.listOfChat[E].uuid===G.to){C=z.listOfChat[E];break}}if(!C){return false}}if(!C){C=z.listOfChat[G.from]}if(C===undefined){var A={userName:G.username,login:G.login,userId:G.from,status:G.status};var D={controller:z,connection:z.connection,groupId:undefined,contact:A};var B=new r(D);var F=z.createChat(B,false,G.roomId);if(!G.activeArchive){F.onMessageReceived(G)}z.miniPanels.addNotification({id:B.getId(),pathPicture:B.getPathPicture(),userName:B.getUserName(),infoTxt:(G.msg)?G.msg.unescapeHTML():((G.data)?"Content received.":"Error : No message."),events:{click:function(){p.dispatch(p.eventName.STARTCHAT,[B])}}})}else{if(!C.isDisplay()){var F=C;var B=F.getContact();z.miniPanels.addNotification({id:B.getId(),pathPicture:B.getPathPicture(),userName:B.getUserName(),infoTxt:(G.msg)?G.msg.unescapeHTML():((G.data)?"Content received.":"Error : No message."),events:{click:function(){p.dispatch(p.eventName.STARTCHAT,[B])}}})}else{z.miniPanels.receivedMessage(G.from);C.setNotif(true)}}});p.addEvent(p.eventName.PANELICONISED,function(C){y.debug("InstantMessagingController : PANELICONISED");if(C!=="RTBuddyListID"){var B=z.listOfChat[C];var A=B.getContact();z.miniPanels.addContact({id:A.getId(),pathPicture:A.getPathPicture(),userName:A.getUserName(),events:{click:function(){p.dispatch(p.eventName.ONMAXIMIZEDCLICK,[C])}}})}else{z.miniPanels.activeBuddyIcon(true)}z.organizeChatPanel(C)});p.addEvent(p.eventName.PANELMAXIMIZED,function(A){y.debug("InstantMessagingController : PANELMAXIMIZED");z.organizeChatPanel(A)});p.addEvent(p.eventName.ICONISEALLCLICK,function(C){y.debug("InstantMessagingController : ICONISEALLCLICK");z.lockIconise=true;for(var B in z.listOfChat){var A=z.listOfChat[B];if(A.isDisplay()){p.dispatch(p.eventName.ONICONISEPANELCLICK,[B])}}p.dispatch(p.eventName.ONICONISEPANELCLICK,[e.getId()]);z.lockIconise=false});p.addEvent(p.eventName.STARTCHAT,function(B,A){y.debug("InstantMessagingController : STARTCHAT");z.startChatWith(B,A)});h.addEvent(h.eventName.SETSTATUS,function(A){y.debug("InstantMessagingController : SETSTATUS");z.subMenu.forEach(function(B){if(B.get("label").indexOf(j[A.myStatus])!=-1){B.set("checked",true)}else{B.set("checked",false)}})});h.addEvent(h.eventName.ONPRESENCERECEIVED,function(A){y.debug("InstantMessagingController : ONPRESENCERECEIVED");var C=A.userId.split("@");if(A&&A.status&&A.status.toLowerCase){var B=k[A.status.toLowerCase()];if(B){f.publish(A.userId,{login:C[0],action:"setStatus",status:A.status,color:B})}else{y.debug("InstantMessagingController ONPRESENCERECEIVED : status unknown : "+A.status)}}if(C[0]===z.login){z.myStatus=A.status;z.subMenu.forEach(function(F){if(F.get("label").indexOf(j[A.status])!=-1){F.set("checked",true)}else{F.set("checked",false)}F.set("disabled",false)});var E=s.getSetting("RTCStatus");var D="white";if(A.status==="Online"){z.miniPanels.updateStatus(k.online);z.miniPanels.updateIcon({fontSize:"9px",top:"-3px",left:"-1px",name:"fonticon handler fonticon-check"})}if(A.status==="Offline"){z.miniPanels.updateStatus(k.offline);z.miniPanels.updateIcon({fontSize:"5px",top:"-4px",left:"-1px",name:""})}if(A.status==="Away"){z.miniPanels.updateStatus(k.away);z.miniPanels.updateIcon({fontSize:"9px",top:"-3px",left:"-1px",name:"fonticon handler fonticon-cancel"})}if(A.status==="Busy"){z.miniPanels.updateStatus(k.busy);z.miniPanels.updateIcon({fontSize:"9px",top:"-3px",left:"-1px",name:"fonticon handler fonticon-minus"})}if(A.status==="DND"){z.miniPanels.updateStatus(k.busy);z.miniPanels.updateIcon({fontSize:"9px",top:"-3px",left:"-1px",name:"fonticon handler fonticon-minus"})}s.setSetting("userStatus",A.status)}});h.addEvent(h.eventName.DISCONNECTED,function(A){z.subMenu.forEach(function(B){B.set("disabled",true)})});h.addEvent(h.eventName.CONNECTED,function(A){if(!A.userId){y.error("InstantMessaging unable to retrieve user's login")}z.login=A.userId;s.setSetting("userLogin",A.userId);h.dispatch("ONPRESENCERECEIVED",[A]);z.subMenu.forEach(function(B){B.set("disabled",false)})});p.addEvent(p.eventName.ONCLICKNOTIFICATION,function(C){if(z.expanded){for(var B in z.listOfChat){if(z.listOfChat[B].isAnIcon()){var A=z.listOfChat[B];A.chat.setOriginPosition({originXPos:5,originYPos:A.getOriginPosition().yPosition-46});A.chat.moveToOrigin();z.iconExpanded[B]=A.getOriginPosition()}}}});h.addEvent(h.eventName.LOGOUT,function(){f.publish("im.ds.com",{action:"logout"})});h.addEvent(h.eventName.STATUSUPDATED,function(B){y.debug("RTBuddyListController : STATUSUPDATED received");var C=s.getSetting("RTCStatus");var A="white";if(B==="Online"){z.miniPanels.updateStatus(k.online);z.miniPanels.updateIcon({fontSize:"9px",top:"-3px",left:"-1px",name:"fonticon handler fonticon-check"})}if(B==="Offline"){z.miniPanels.updateStatus(k.offline);z.miniPanels.updateIcon({fontSize:"5px",top:"-4px",left:"-1px",name:""})}if(B==="Away"){z.miniPanels.updateStatus(k.away);z.miniPanels.updateIcon({fontSize:"9px",top:"-3px",left:"-1px",name:"fonticon handler fonticon-cancel"})}if(B==="Busy"){z.miniPanels.updateStatus(k.busy);z.miniPanels.updateIcon({fontSize:"9px",top:"-3px",left:"-1px",name:"fonticon handler fonticon-minus"})}if(B==="DND"){z.miniPanels.updateStatus(k.busy);z.miniPanels.updateIcon({fontSize:"9px",top:"-3px",left:"-1px",name:"fonticon handler fonticon-minus"})}});p.addEvent(p.eventName.RESTARTLOGIN,function(A){z.activeConnection()});p.addEvent(p.eventName.ACTIVEMINIZONE,function(D){if(D){for(var C=0;C<z.activeChatPanel.length;C++){z.activeChatPanel[C].setDisplayPanel(D)}}else{for(var B in z.listOfChat){var A=z.listOfChat[B];if(A.isDisplay()){A.setDisplayPanel(D);z.activeChatPanel.push(A)}}e.setDisplayPanel(D)}z.miniPanels.activeMiniZone(D)});p.addEvent(p.eventName.SIGNOUT,function(D){var C=s.getSetting("plateformsInfo");e.activeSignInView(true,C);y.info("IMController SIGNOUT");h.dispatch(h.eventName.LOGOUT,[{nameApp:"3DIM"}]);h.dispatch(h.eventName.ONPRESENCERECEIVED,[{status:"Offline",userId:s.getSetting("userLogin")+"@im"}]);for(var B in z.listOfChat){var A=z.listOfChat[B];A.getPanel().destroy();delete z.listOfChat[B]}z.miniPanels.removeAllElements();e.removeAll()});f.subscribe("im.ds.com",function(F){var E=F.login+"@"+s.getSetting("currentPlateformId").toLowerCase()+".im.3ds.com";switch(F.action){case"shareContent":F.controller=e.searchController;z.sharecontentView=new l(F);break;case"getStatus":var A={userName:F.username,login:F.login,userId:E};h.dispatch(h.eventName.GETSTATUS,[A]);break;case"startChat":if(s.getSetting("userLogin")===F.login){y.debug("InstantMessagingController starChat with self forbidden");break}if(s.getSetting("currentPlateformId").toLowerCase()!=(F.tenant.displayName||F.tenant).toLowerCase()){y.debug("InstantMessagingController starChat with user on other tenant forbidden");break}if(z.listOfChat[E]===undefined&&z.listOfChat[F.login]===undefined){var A={userName:F.username,login:F.login,userId:s.getSetting("driver")==="NODE"?F.login:E,status:F.presence};var C={controller:z,connection:z.connection,groupId:undefined,contact:A};var B=new r(C);p.dispatch(p.eventName.STARTCHAT,[B,F.share])}else{var D=z.listOfChat[E]||z.listOfChat[F.login];var B=D.getContact();p.dispatch(p.eventName.STARTCHAT,[B,F.share])}break}});window.onbeforeunload=function(A){if(!z.lockMail){h.dispatch(h.eventName.LOGOUT,[{nameApp:"3DIM"}]);y.debug("Leave page !!")}else{z.lockMail=!z.lockMail}}},startX3DPhoto:function(B){var A=this;this.x3DPhotoData=B;if(!this.x3DPhotoDiv){this.x3DPhotoDiv=UWA.createElement("div",{"class":"X3DPHOTO-main-div",html:[{tag:"div","class":"X3DPHOTO-toolbar",styles:{position:"absolute",right:"30px",top:"10px","z-index":"20"}},{tag:"div","class":"X3DPHOTO-player"}]});this.x3DPhotoDiv.inject(document.body);var z=new o({value:"Close"});z.addEvent("onClick",function(){A.x3DPhotoWidgetLoaded=false;A.x3DPhotoDiv.style.top=(A.x3DPhotoDiv.offsetHeight+59)+"px";setTimeout(function(){A.x3DPhotoDiv.style.display="none";A.x3DPhotoDiv.destroy();A.x3DPhotoDiv=undefined},600)});z.inject(this.x3DPhotoDiv.getElement(".X3DPHOTO-toolbar"));f.subscribe("fromx3dphoto.ds.com",function(D){var E=D.evenement;var C=D.data;if(E==="WidgetLoaded"&&!A.x3DPhotoWidgetLoaded){A.x3DPhotoWidgetLoaded=true;f.publish("tox3dphoto.ds.com",{evenement:"loadPhoto",data:A.x3DPhotoData})}else{if(E==="upload"){h.dispatch("uploadMedia",[C])}}});this.loadWidget({app:"CAT3DSH_AP",el:this.x3DPhotoDiv.getElement(".X3DPHOTO-player")});this.x3DPhotoDiv.style.top="103px"}else{this.x3DPhotoDiv.style.display="block";f.publish("tox3dphoto.ds.com",{evenement:"loadPhoto",data:A.x3DPhotoData})}},getRTCServerInfo:function(B){y.debug("InstantMessagingController getRTCServerInfo");var G=this;var H={};var I=B.appName;var M=false;var E=undefined;var D=function(N){if(!N||typeof N!="string"){return null}return N.replace(":8081/rest","").replace(":8081/rest/","").replace("http:","https:").replace(":8081","").replace("/rest","").replace("/rest/","")};var J=D(B.messaging);var L=B.passport;for(var A in B.tenants){var K=A;if(!B.tenants[K]){continue}var z=B.tenants[K].swym;var C=B.tenants[K].displayName;var F=B.tenants[K].url;if(!z){continue}if(K&&B.tenants[K]&&B.tenants[K].imActive){H[K]={im:D(F)||J,swym:z.replace(":443/",""),passport:L,displayname:C};M=true}}if(M){s.setSetting("plateformsInfo",H);if(!G.favoriteTenant||!H[G.favoriteTenant]){s.setSetting("currentPlateformId",Object.keys(H)[0])}else{s.setSetting("currentPlateformId",G.favoriteTenant)}y.info("will now launch connection to RTC server on tenant "+s.getSetting("currentPlateformId"));G.activeConnection()}else{e.destroy();G.miniPanels.destroy()}},activeConnection:function(){y.debug("InstantMessagingController activeConnection");var D=this;this.login=this.login||"noMoreNeeded";if(this.login){var I=s.getSetting("currentPlateformId");var E=s.getSetting("plateformsInfo");var A=s.getSetting("imPort");var G=E[I].passport;var C=E[I].im;var B=G+"/login?service=3DSIM";var H=C.replace(":443/rest","");var z=function(L){var J=JSON.parse(L);if(J.access_token){D.isLoggedIn=true;var K={nameApp:"3DIM",driverName:s.getSetting("driver")||a,credentials:{jid:D.login+"@"+I.toLowerCase()+".im.3ds.com",user:D.login,password:J.access_token},url:H,domaineName:I,passportUrl:G};if(Object.keys(D.active3DIM).length>1){e.setTenantName(I)}e.listOfRecent={};h.addEvent(h.eventName.GETSTATUSLIST,function(M){if(!D.isInitTopBar){D.isInitTopBar=true;s.setSetting("RTCStatus",M);D.initTopBar(M);p.dispatch(p.eventName.LISTSTATUSRECEIVED,[])}});h.dispatch(h.eventName.SETDRIVER,[K])}};var F={onComplete:z,onFailure:function(J){y.debug(J)},onTimeout:function(J){y.debug(J)}};if(D.isDevMode||true){return z('{"access_token":"osef"}')}d.authenticatedRequest(B,F)}else{y.error("InstantMessagingController activeConnection failed without userId")}},startChatWith:function(A,C){y.debug("InstantMessagingController startChatWith");if(!e.getEditMode()){var D=A.getId();var B;if(this.listOfChat[D]){y.debug("InstantMessagingController : Notify startChatWith - "+D);B=this.listOfChat[D];if(!B.isDisplay()){B.show()}}else{B=this.createChat(A,true)}if(C){var z=document.createEvent("CustomEvent");z.dataTransfer={types:["text"],getData:function(E){if(E&&typeof E=="string"&&E.toLowerCase().indexOf("url")!=-1){return C.urlContent}return C},target:{files:{}}};B.sendDataFromDrop(z)}}},createChat:function(E,G,B,H){y.debug("InstantMessagingController createChat");var F=E.getId();var I=E.getLogin();var J=s.getSetting("currentPlateformId");var D=s.getSetting("plateformsInfo");var C=(D&&D[J])?D[J].swym:undefined;var K=C+"/api/user/getpicture/login/"+I+"/format";var z={controller:this,connection:this.connection,roomId:B,contact:{userId:F,userName:E.getUserName(),login:E.getLogin(),email:E.getEmail(),status:E.getStatus()},id:F,originXPos:345,originYPos:0,sizeOnY:400,minimumSize:32,minimumResize:400,panelLarger:270,titleOpt:{titleName:{txt:E.getUserName(),eventName:"on"+F+"NameClick"},status:E.getStatus(),eventResizePanel:{MouseDown:"onResize"+F+"PanelMouseDown",MouseUp:"onResize"+F+"PanelMouseUp"},minimizeButton:true,closeButton:true,menuButton:s.getSetting("activeArchive"),picture:K}};var A=new x(z,H);if(A){this.listOfChat[F]=A;if(G){A.show();if(e){e.setRecentChatIsHidden(false)}}}return A},closeChatPanel:function(E,z,B){y.debug("InstantMessagingController closeChatPanel");var C=this.listOfChat[E];if(!C){return y.debug("IMcontroller closeChatPanel : chatpanel already closed")}var A=C.getOriginPosition();var D=0;this.organizeChatPanel(E)},organizeChatPanel:function(F){y.debug("InstantMessagingController organizeChatPanel");if(!this.lockIconise){var E=undefined;var K=false,D=false;var B=this.getNumberOfIconiseChat();var G=this.getNumberOfDisplayChat();var A=undefined;if(e.getId()===F){D=true}else{A=this.listOfChat[F];if(A){E=A.getOriginPosition()}}if(A&&!A.isAnIcon()&&A.isDisplay()){var C=66;if(!e.isAnIcon()&&e.getDisplayPanel()){C=345}A.chat.setOriginPosition({originXPos:C,originYPos:0});A.chat.moveToOrigin();E=A.getOriginPosition()}for(var I in this.listOfChat){if(F!==I){var J=this.listOfChat[I];if(D){if(e.isAnIcon()){if(J.isDisplay()&&!J.isAnIcon()){var z=J.chat.getOriginPosition();if((z.xPosition-279)>=66){J.chat.setOriginPosition({originXPos:z.xPosition-279});J.chat.moveToOrigin()}}}else{if(J.isDisplay()&&!J.isAnIcon()){var z=J.chat.getOriginPosition();J.chat.setOriginPosition({originXPos:z.xPosition+279});J.chat.moveToOrigin();z=J.chat.getOriginPosition();var L=document.body.offsetWidth;if((z.xPosition+J.getWidth())>L){var M=I;setTimeout(function(){p.dispatch(p.eventName.ONICONISEPANELCLICK,[M])},400)}}}}else{if(J.isDisplay()&&!J.isAnIcon()){var H=J.getOriginPosition();if(H.xPosition>=E.xPosition){var z=J.chat.getOriginPosition();if(A.isAnIcon()||!A.isDisplay()){if((z.xPosition-279)>=((e.isAnIcon())?66:345)){J.chat.setOriginPosition({originXPos:z.xPosition-279});J.chat.moveToOrigin()}}else{var z=J.chat.getOriginPosition();J.chat.setOriginPosition({originXPos:z.xPosition+279});J.chat.moveToOrigin();z=J.chat.getOriginPosition();var L=document.body.offsetWidth;if((z.xPosition+J.getWidth())>L){var M=I;setTimeout(function(){p.dispatch(p.eventName.ONICONISEPANELCLICK,[M])},400)}}}}}}}}},getNumberOfIconiseChat:function(){y.debug("InstantMessagingController getNumberOfIconiseChat");var z=0;for(var A in this.listOfChat){if(this.listOfChat[A].isAnIcon()){z++}}return z},getNumberOfDisplayChat:function(){y.debug("InstantMessagingController getNumberOfDisplayChat");var z=0;for(var A in this.listOfChat){if(this.listOfChat[A].isDisplay()&&!this.listOfChat[A].isAnIcon()){z++}}return z},setRecentChatIsHidden:function(z){y.debug("InstantMessagingController setRecentChatIsHidden");e.setRecentChatIsHidden(z)},addContactToRecentChat:function(z){y.debug("InstantMessagingController addContactToRecentChat");e.addContactToRecentChat(z)},buddylistIsAnIcon:function(){y.debug("InstantMessagingController buddylistIsAnIcon");return e.isAnIcon()},initDevEnv:function(A){if(!A.ODTMode){var D=this;h.addEvent(h.eventName.GETSTATUSLIST,function(F){if(!D.isInitTopBar){D.isInitTopBar=true;s.setSetting("RTCStatus",F);D.initTopBar(F);p.dispatch(p.eventName.LISTSTATUSRECEIVED,[])}});var C={nameApp:"3DIM",devEnv:true,driverName:s.getSetting("driver")||a,credentials:{jid:A.devOpt.login,user:A.devOpt.login,password:A.devOpt.password},url:A.devOpt.server,domaineName:A.devOpt.login.split("@")[1].split(".")[0]};if(C.domaineName==="im"){C.domaineName="3DIMprivatenant"}s.setSetting("currentPlateformId",C.domaineName);this.active3DIM={count:2};this.active3DIM[C.domaineName]={imActive:true};this.login=A.devOpt.login.split("@")[0];var B={global:{im:A.devOpt.server,displayname:"global"},hyper3dsy:{im:A.devOpt.server,displayname:"hyper3dsy"}};for(var z in B){this.active3DIM[z]={imActive:true}}s.setSetting("plateformsInfo",B);h.dispatch(h.eventName.SETDRIVER,[C])}else{var E={Away:"Away",Busy:"Busy",Offline:"Offline",Online:"Online"};this.subMenu=[];this.login="odt";s.setSetting("currentPlateformId","ODTTENANT");s.setSetting("userLogin","odt");s.setSetting("RTCStatus",E);p.dispatch(p.eventName.LISTSTATUSRECEIVED,[]);e.groups3DIM=true}},getBuddylist:function(){return e}});return v});