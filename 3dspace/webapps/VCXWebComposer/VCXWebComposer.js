define("DS/VCXWebComposer/VCXExperience",["DS/CoreEvents/Events","DS/WebApplicationBase/W3AAManager","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebDressup/VCXCmdChangeDressup","DS/VCXWebKernelCommands/VCXCmdChangeComponent","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebSequenceManager/VCXCmdChangeSequence","DS/VCXWebSequenceManager/VCXCmdChangeScenarioSequence","DS/VCXWebKernelCommands/VCXCmdReplaceScenario","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelTools/VCXFileServices","DS/WebappsUtils/WebappsUtils","DS/VCXWebKernelTools/VCXLogServices","DS/VCXKeyFramer/VCXScenario","DS/RuntimeView/NLSManager","DS/VCXWebVisualization/VCXPublishRasterImage"],function(o,e,r,l,i,p,n,k,a,j,g,d,s,t,q,w,v,u,x,z,A,h,f,c,m,y){var b=e.extend({BuildNewExperience:function(B){this._ManagerSet.unInitialize();this.unInitialize();this._ManagerSet.initialize();this.initialize();this._ManagerSet.postInitialize();this.postInitialize();return this},init:function(){this._parent();this._bPreviewMode=false;this._viewMode=0;this.volatileNotSaved=false},initialize:function(){var C=null;var B=-1;this._cpt=0;this._time=0;this._moy=0;var D=this;this.event_VCX_PROPERTIES_CHANGED=o.subscribe({event:"VCX_PROPERTIES_CHANGED"},function(F){var E=D._experienceBase.getManager("VCXScenarioManager");if(E){if(E.GetAutoKey()===false){D.SetVolatileNotSaved(true)}}})},SetVolatileNotSaved:function(B){this.volatileNotSaved=B;if(this.volatileNotSaved){}else{}},postInitialize:function(){this._viewer=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(!this._experienceBase.getManager("VCXContextManager")._UseOverrideSet){if(this._viewer.getCurrentSceneGraphState()===null){var B=this._viewer.createSceneGraphState();this._viewer.setCurrentSceneGraphState(B)}}this._viewer.setLightOnViewpoint(true);this._viewer.setAutoUpdateLights(true);if(this._loadingOption){this._loadingOption.quickLoad(this._experienceBase);this._loadingOption.HideVCXGUI()}this.InitDocumentProperties()},unInitialize:function(){delete this._viewer;o.unsubscribe(this.event_VCX_PROPERTIES_CHANGED);delete this.event_VCX_PROPERTIES_CHANGED;if(this.debugTools){this.debugTools.unInitialize();this.debugTools=null}},OnEndLoading:function(N,ah){console.log("VCXExperience::OnEndLoading begin");var D=N;if(this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentCamera").length===0){var B=this._experienceBase.Factory.BuildComponent("VCXComponentCamera");B.SetID("CameraActorId");this._experienceBase.ComponentsMap.AddComponent(B)}else{D=false}if(this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentViewport").length===0){var O=this._experienceBase.Factory.BuildComponent("VCXComponentViewport");O.SetID("ViewportActorId");this._experienceBase.ComponentsMap.AddComponent(O)}if(this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentGround").length===0){var R=this._experienceBase.Factory.BuildComponent("VCXComponentGround");R.SetID("GroundActorId");this._experienceBase.ComponentsMap.AddComponent(R)}var P=this._experienceBase.getManager("VCXContextManager");var X="exterior_parking";var C=h.getWebappsAssetUrl("VCXWebVisualization","ambiences/");var E=C+X+"/"+X;var J=this._experienceBase.odt;P.applyToViewers(function(aj){if(!J){aj.setEnvMap({roughnessMap:E,IBLMap:E})}});if(N&&ah){for(var aa=0;aa<ah.length;aa++){var F=ah[aa];var ai=F.QueryInterface("W3AISGNodeHolder");var af=ai.getSGNode();var ac=ai.getPathElement();var ag={attributeToUse:"productType",componentTypeForRootNode:"VCXComponentOccurrenceComposer",Instance3D:"VCXComponentOccurrenceComposer",InstanceRep:"VCXComponentMesh",defaultType:null};var ae=F.QueryInterface("VCXIModelNavigable");this._experienceBase.BuildComponentsFromNodeEXT(af,ac,ae,ag);o.publish({event:"VCX_ADD_ASSET",data:F,})}}if(D){this._experienceBase.getManager("VCXGUIManager").InitGUI();this._experienceBase.getManager("VCXExperience").InitImagePanels()}this._experienceBase.getManager("VCXGUIManager").RefreshGUI();this._experienceBase.getManager("VCXPaperManager").updatePaper({propagateEvent:true});if(this._experienceBase.getManager("SUIManager")){this._experienceBase.getManager("SUIManager").syncCameraSystemModifiables()}this.EndLoadingDressups();this.EndLoadingViewpoints();var H=false;var Z="";var Y=this._experienceBase.getManager("VCXScenarioManager").QueryInterface("VCXIModifiable");if(D){var K=this._experienceBase.Factory.BuildComponent("VCXScenarioSequence");K.SetName("Sequence 1");var ab=new a(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);ab.PushSequence(K);this._experienceBase.getManager("VCXCommandManager").Do(ab);var M=true;var T=this.CreateNewScenario(M);Z=T.GetID()}else{f.memoryLog("RestoreNeutralProperties",true);this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties();f.memoryLog("RestoreNeutralProperties",false);Z=Y.GetProperty("ScenarioManager.startScenarioId").GetPropertyValue().GetValue();if(Z){H=true}else{var S=this._experienceBase.getManager("VCXSequenceManager");var L=S.GetListSequences();Z=L[0].GetListScenariosId()[0];if(this.GetViewMode()===1){var G=S.GetListSequencesFromType(0);if(G.length>1){var I=G[1];if(I.GetName()!=="Views"){console.warn("Unexpected sequence tag")}if(I.GetListScenariosId().length){Z=I.GetListScenariosId()[0]}}}}}if(!H){var ad=new v(Z);var Q=new s(new t("ScenarioManager.startScenarioId",2),ad);var W=new x(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"),true);W.ChangeProperty(Y,Q);this._experienceBase.getManager("VCXCommandManager").Do(W)}f.memoryLog("GoToScenario",true);var V=new r(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"));V.GoToScenario(Z);this._experienceBase.getManager("VCXCommandManager").Do(V);f.memoryLog("GoToScenario",false);f.memoryLog("VCXGUIManager setUpTrees",true);this._experienceBase.getManager("VCXGUIManager").setUpTrees();f.memoryLog("VCXGUIManager setUpTrees",false);console.log("VCXExperience::OnEndLoading end");console.log(" VCXStatNb3DNodes = "+VCXStatNb3DNodes);setTimeout(function(){document.querySelector("div.wux-windows-immersive-frame").dispatchEvent(new Event("resize"))},500);if(document.waitConditionModel){var U="DS/WebRecordEnabler/Adapter";require([U],function(aj){aj.TraceManager.debug("REMOVE document.waitConditionModel");aj.WaitManager.removeWaitCondition(document.waitConditionModel);document.waitConditionModel=null})}},EndLoadingDressups:function(){f.memoryLog("VCXCmdChangeDressup",true);var D=new i(this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.getManager("VCXDressupManager"),this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.ComponentsMap);f.memoryLog("VCXCmdChangeDressup",false);var B=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentDressup");for(var C=0;C<B.length;C++){D.AddDressups(B[C])}this._experienceBase.getManager("VCXCommandManager").Do(D);f.memoryLog("VCXDressupManager UpdateDressupList",true);this._experienceBase.getManager("VCXDressupManager").UpdateDressupList();f.memoryLog("VCXDressupManager UpdateDressupList",false)},EndLoadingViewpoints:function(){this._viewer.displayPoints(true);var C=this._viewer.getViewpoints();for(var B=0;B<C.length;B++){C[B].setDefaultController(true,"SIMPLE");C[B].getControl().setRotationRolling(false);C[B].reframe("iso",0);C[B].reframe(null,0)}},GetViewer:function(){return this._viewer},RefreshGUI:function(){this._experienceBase.getManager("VCXGUIManager").RefreshGUI();this._experienceBase.getManager("VCXPaperManager").updatePaper({propagateEvent:true})},GoToScenario:function(B){this._experienceBase.getManager("VCXScenarioManager").SetCurrentScenario(B);this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties();this._experienceBase.getManager("VCXScenarioManager").ApplyScenarioVisibility(B);this.SetFrameAndRefresh(0)},GoToNeutrals:function(){this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties();this.SetFrameAndRefresh(0)},GoToScenarioWithInterpolation:function(D,F){var E=this;var C=function(){var J=E._experienceBase.getManager("VCXScenarioManager");var K=J.GetScenarios();var H=K[D];if(H){}else{console.log("SCENARIO NOT FOUND : "+D);if(F){F()}return}var G=true;if(J.GetTransitionTime()==0){G=false}if(G){var I=new l(J,E._experienceBase.ComponentsMap,E._experienceBase.getManager("VCXCommandManager"));I.BuildTransitionTo(H);I.SetCallback(F);E._experienceBase.getManager("VCXCommandManager").Push(I)}else{o.publish({event:"VCX_BEGIN_TRANSITION",data:{maxframe:10,scenario:H}});var I=new r(J,E._experienceBase.getManager("VCXCommandManager"));I.GoToScenario(D);E._experienceBase.getManager("VCXCommandManager").Push(I);o.publish({event:"VCX_END_TRANSITION"})}};var B=this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();if(B){this._experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(false)}if(this._bPreviewMode&&this._experienceBase.getManager("VCXPulseManager")){this._experienceBase.getManager("VCXPulseManager").StopPulse(C)}else{C()}},SetFrameAndRefresh:function(B,C){if(this._FrameLastScenarioID===this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()){if(this._FrameLastRender===B){return}}this._FrameLastScenarioID=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this._FrameLastRender=B;this._experienceBase.getManager("VCXScenarioManager").SetCurrentFrame(B);this._experienceBase.getManager("VCXScenarioManager").UpdateProperties();if(!C){this._experienceBase.getManager("VCXContextManager").getMainViewer().render()}},capturePixels:function(){var G=this._experienceBase;var F=G.getManager("VCXContextManager").getMainViewer();var I=G.getManager("VCXPaperManager");var D=0.5;var B=new y();var H=[165,118];var J=H[0]*1.5;var E=H[1]*1.5;var C=B.doThumbnailToDataUrl(G,J,E);return C},CaptureScenarioWithThumbnail:function(O){var N=this._experienceBase.getManager("VCXContextManager").getActiveCamera();if(N){}else{console.log("No Camera, scenario does not capture viewpoint..")}var G=null;if(N){G=N.QueryInterface("VCXIModifiable");var L=N.QueryInterface("VCXIViewpointController");if(L){L.fromViewpoint()}var K=this._experienceBase.getManager("VCXScenarioManager")._keyframer._Neutrals;var J=K.GetPropertySet(G.GetHashing());var I=G.GetProperties();if(J&&Object.keys(J._map).equals(Object.keys(I._map))){}else{this._experienceBase.getManager("VCXScenarioManager").AddNeutrals(G,I)}}var P={bIsPartialView:false,visibilityMode:1,scenarioType:c.EScenarioType.Scenario,persistency:0};if(this._experienceBase.getManager("VCXContextManager").getCityMode()){P.visibilityMode=2}var S=this._experienceBase.getManager("VCXScenarioManager").CaptureCurrentView(P);var E;if(O){E=O}else{var D=this._experienceBase.getManager("VCXScenarioManager")._maxIndex+1;E="New Scenario "+D.toString()}S.SetName(E);var R=this.capturePixels();var B=A.dataURLToBlob(R);if(B){var F=window.URL.createObjectURL(B);var Q=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(F);var H=this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(Q,R);S.SetDocId(H.GetValue())}var C=S.QueryInterface("VCXIModifiable");var M=new z(this._experienceBase.getManager("VCXScenarioManager"));M.CaptureNeutralProperties(C);M.Do();return S},UpdateScenario:function(C){var B=this.CaptureScenarioWithThumbnail(C.GetName());var D=new g(this._experienceBase.getManager("VCXScenarioManager"));D.ReplaceScenario(C,B);this._experienceBase.getManager("VCXCommandManager").Push(D)},CreateNewScenario:function(H){var O=this.CaptureScenarioWithThumbnail();var J="";var E="";var K=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection();for(var I=0;I<K.length;I++){var L=K[I];if(L.IsKindOf("VCXScenarioSequence")){}else{if(L.IsKindOf("VCXScenario")){E=L.GetID()}}}var G={};var D=new j(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);var M=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(E);if(M){var C=this._experienceBase.getManager("VCXSequenceManager").GetPreviousScenarioId(E);D.InsertScenarioInSequence(O,M.GetID(),C);G={scenario:O,sequenceId:M.GetID(),prevIndex:M.GetIndexOfScenario(C)}}else{J=this._experienceBase.getManager("VCXGUIManager").GetActiveSequenceId();if(J){}else{var F=this._experienceBase.getManager("VCXSequenceManager").GetListSequences();if(F[0]){J=F[0].GetID()}else{return}}D.PushScenarioInSequence(O,J);var N=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(J);var B=N.GetListScenariosId().length;G={scenario:O,sequenceId:J,prevIndex:B-1}}if(H){this._experienceBase.getManager("VCXCommandManager").Do(D)}else{this._experienceBase.getManager("VCXCommandManager").Push(D)}this._experienceBase.getManager("VCXContextManager").renderAll();return O},InitImagePanels:function(){var D=this._experienceBase.getManager("VCXDocManager").GetDefaultImageIndex();if(D!=-1){return}var E=this;var C=h.getWebappsAssetUrl("VCXWebVisualization","texture/I_VCX_DefaultTexture.png");var B=new Image();B.crossOrigin="Anonymous";B.onload=function(){if(!E._experienceBase.Factory){return}var H=document.createElement("CANVAS");var Q=H.getContext("2d");H.height=this.height;H.width=this.width;Q.drawImage(this,0,0);var I=H.toDataURL("image/png");var F=A.dataURLToBlob(I);var O=window.URL.createObjectURL(F);var G="I_VCX_DefaultTexture.png";var M=E._experienceBase.getManager("VCXDocManager").BuildPathFromString(O,G);var K=E._experienceBase.getManager("VCXDocManager").AddOrModifyDocInt(M);var P=new q(K);var J=new s(new t("DocManager.defaultIndex",2),P);var L=E._experienceBase.getManager("VCXDocManager").QueryInterface("VCXIModifiable");var N=new x(E._experienceBase.getManager("VCXScenarioManager"),E._experienceBase.getManager("VCXCommandManager"),true);N.ChangeProperty(L,J);E._experienceBase.getManager("VCXCommandManager").Do(N);H=null;o.publish({event:"VCX_IMAGE_INIT_DONE"})};B.src=C},InitDocumentProperties:function(){var D=new z(this._experienceBase.getManager("VCXScenarioManager"));var E=this._experienceBase.getManager("VCXScenarioManager").QueryInterface("VCXIModifiable");D.ChangeProperty(E,"ScenarioManager.FPS",new w(30));D.ChangeProperty(E,"ScenarioManager.InterFramesMax",new q(10));D.ChangeProperty(E,"ScenarioManager.startScenarioId",new v(""));var C=this._experienceBase.getManager("VCXDocManager").QueryInterface("VCXIModifiable");D.ChangeProperty(C,"DocManager.defaultIndex",new q(-1));var B=this._experienceBase.getManager("VCXCommandManager").QueryInterface("VCXIModifiable");D.ChangeProperty(B,"CommandManager.maxSize",new q(500));this._experienceBase.getManager("VCXCommandManager").Do(D)},SetPreviewMode:function(B){this._bPreviewMode=B;o.publish({event:"VCX_PREVIEW_MODE_CHANGED",data:this._bPreviewMode})},GetPreviewMode:function(){return this._bPreviewMode},SetViewMode:function(B){this._viewMode=B},GetViewMode:function(){return this._viewMode},loadNLS:function(B){var E=this._experienceBase.getManager("VCXNLSManager");var D=[];for(var C=0;C<B.length;C++){var F=new UWA.Promise(function(H,G){m.onResourceLoaded({resourceFile:B[C]},function(){H({resourceKey:this._resourceKey,nlsManager:this})});m.loadResource({resourceFile:B[C]})});F.then(function(G){E.AddNLS(G.resourceKey,G.nlsManager)});D.push(F)}return UWA.Promise.allSettled(D)},addApplicationManagers:function(){var ad=this._experienceBase.getManager("VCXContextManager").getCityMode();var af=this._experienceBase.getManager("VCXContextManager").getPlayerMode();var I=this._experienceBase.getManager("VCXContextManager").getProdHighMode();var R=this._experienceBase.Factory.BuildComponent("VCXGUIManager");R.SetID("VCXGUIManagerID");R.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXGUIManager",R);var O=this._experienceBase.Factory.BuildComponent("VCXSelectionManager");O.SetID("VCXSelectionManagerID");O.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXSelectionManager",O);var V=this._experienceBase.Factory.BuildComponent("VCXSelectManager");V.SetID("VCXSelectManagerID");V.SetPersistency(2);this._experienceBase._ManagerSet.addManager("VCXSelectManager",V);var F=this._experienceBase.Factory.BuildComponent("VCXMultiUserInputManager");F.SetID("VCXMultiUserInputManagerID");F.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXMultiUserInputManager",F);var C=this._experienceBase.Factory.BuildComponent("VCXMaterialManager");C.SetID("VCXMaterialManagerID");C.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXMaterialManager",C);var N=this._experienceBase.Factory.BuildComponent("VCXPaperManager");N.SetID("VCXPaperManagerID");N.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXPaperManager",N);var P=this._experienceBase.Factory.BuildComponent("VCXDressupManager");P.SetID("VCXDressupManagerID");P.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXDressupManager",P);var ab=this._experienceBase.Factory.BuildComponent("VCXImageManager");ab.SetID("VCXImageManagerID");ab.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXImageManager",ab);var G=this._experienceBase.Factory.BuildComponent("VCXHyperlinkManager");G.SetID("VCXHyperlinkManagerID");G.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXHyperlinkManager",G);var X=this._experienceBase.Factory.BuildComponent("VCXSequenceManager");X.SetID("VCXSequenceManagerID");X.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXSequenceManager",X);var T=this._experienceBase.Factory.BuildComponent("VCXStylesManager");T.SetID("VCXStylesManagerID");T.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXStylesManager",T);var ah=this._experienceBase.Factory.BuildComponent("VCXVisuManager");ah.SetID("VCXVisuManagerID");ah.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXVisuManager",ah);var D=this._experienceBase.Factory.BuildComponent("VCXDragDropManager");D.SetID("VCXDragDropManagerID");D.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXDragDropManager",D);var E=this._experienceBase.Factory.BuildComponent("VCXNLSManager");E.SetID("VCXNLSManagerID");E.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXNLSManager",E);var Y=this._experienceBase.Factory.BuildComponent("VCXAPIManager");Y.SetID("VCXAPIManagerID");Y.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXAPIManager",Y);var H=this._experienceBase.Factory.BuildComponent("VCXMarkerManager");H.SetID("VCXMarkerManagerID");H.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXMarkerManager",H);var M=this._experienceBase.Factory.BuildComponent("VCXDRMManager");M.SetID("VCXDRMManagerID");M.SetPersistency(1);this._ManagerSet.addManager("VCXDRMManager",M);var W=this._experienceBase.Factory.BuildComponent("VCXPulseManager");W.SetID("VCXPulseManagerID");W.SetPersistency(1);W.SetPreviewMode(this.GetPreviewMode());this._experienceBase._ManagerSet.addManager("VCXPulseManager",W);var ai=this._experienceBase.Factory.BuildComponent("VCXManipulatorManager");ai.SetID("VCXManipulatorManagerID");ai.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXManipulatorManager",ai);var J=this._experienceBase.getManager("VCXContextManager").getCat3DXIntegration();if(J){var ae=this._experienceBase.Factory.BuildComponent("VCXCAT3DXModelManager");ae.SetID("VCXCAT3DXModelManagerID");ae.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXCAT3DXModelManager",ae);var ag=this._experienceBase.Factory.BuildComponent("VCXAuthoringServicesManager");ag.SetID("VCXAuthoringServicesManagerID");ag.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXAuthoringServicesManager",ag)}if(af||I){var Q=this._experienceBase.Factory.BuildComponent("VCXSectionManager");Q.SetID("VCXSectionManagerID");Q.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXSectionManager",Q);var aj=this._experienceBase.Factory.BuildComponent("VCXRobotAdapter");aj.SetID("VCXRobotAdapterID");aj.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXRobotAdapter",aj);var B=this._experienceBase.Factory.BuildComponent("VCXComponentBomManager");B.SetID("VCXBomManagerID");B.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXComponentBomManager",B);var K=this._experienceBase.Factory.BuildComponent("VCXVolatileGhostingManager");K.SetID("VCXVolatileGhostingManagerID");K.SetPersistency(1);K.setKeepGhostCommand(true);this._experienceBase._ManagerSet.addManager("VCXVolatileGhostingManager",K);var aa=this._experienceBase.Factory.BuildComponent("VCXExplodeBoxManager");aa.SetID("VCXExplodeBoxManagerID");aa.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXExplodeBoxManager",aa);var Z="VCXQueryEngine";var S=this._experienceBase.Factory.BuildComponent(Z);S.SetID(Z+"ID");S.SetPersistency(1);this._experienceBase._ManagerSet.addManager(Z,S);var ac=this._experienceBase.Factory.BuildComponent("VCXHotspotManager");ac.SetID("VCXHotspotManagerID");ac.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXHotspotManager",ac);var U=this._experienceBase.Factory.BuildComponent("VCXSelectionSetManager");U.SetID("VCXSelectionSetManagerID");U.SetPersistency(1);this._experienceBase._ManagerSet.addManager("VCXSelectionSetManager",U)}var L=new p(this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);L.AddComponents([R,O,F,C,N,P,ab,G,X,T,ah,D,E,ai,Q,aj,B,K,aa,W,S,ac,U,Y,V,H,ae]);this._experienceBase.getManager("VCXCommandManager").Do(L)}});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXExperience"}});return b});define("DS/VCXWebComposer/VCXASensible",["UWA/Class"],function(b){var a=b.extend({init:function(){},_getMeshesFromPathElement:function(c){var d=c.getLastElement(true);var e=[];if(d.excludeFromCSO){e.push(d)}else{var f=function f(g){if(g.excludeFromCSO){e.push(g)}return false};d.traverse(f,false)}return e},_setOrGetXSOAble:function(c,n,k){if(typeof c!=="boolean"){console.log("First argument should be a boolean");return}if(n!=="CSO"&&n!=="HSO"&&n!=="PSO"){console.log("Second argument should be one of the following : CSO | HSO | PSO");return}if(c&&typeof k!=="boolean"){console.warn("A boolean is required as third argument for this method when first is defined as 'set'.");return}var l=this.GetObject().QueryInterface("W3AISGNodeHolder");if(!l){console.warn("Object do not possess a nodeHolder interface");return}var j=l.getPathElement();var d=this._getMeshesFromPathElement(j);var m=null;for(var g=0;g<d.length;++g){var h=d[g];if(c){n==="CSO"?h.excludeFromCSO(!k):n==="HSO"?h.excludeFromHSO(!k):h.excludeFromPSO(!k)}else{var f=n==="CSO"?h._excludeFromCSO:n==="HSO"?h._excludeFromHSO:h._excludeFromPSO;var e=!f;m=(typeof m!=="boolean")?e:(m===e)?m:null;if(m===null){break}}}if(!c){return m}},_setXSOAble:function(d,c){this._setOrGetXSOAble(true,d,c)},_getXSOAble:function(c){return this._setOrGetXSOAble(false,c)},setSelectable:function(c){this._setXSOAble("CSO",c)},setHighlightable:function(c){this._setXSOAble("HSO",c)},setPreHighlightable:function(c){this._setXSOAble("PSO",c)},getSelectable:function(){return this._getXSOAble("CSO")},getHighlightable:function(){return this._getXSOAble("HSO")},getPreHighlightable:function(){return this._getXSOAble("PSO")}});return a});define("DS/VCXWebComposer/VCXISelectBehavior",["DS/WebComponentModeler/CATWebInterface"],function(b){var a=b.singleton({interfaceName:"VCXISelectBehavior",required:{SetSelectMode:function(c){},GetSelectMode:function(){},GetListForSelection:function(){}},optional:{}});return a});define("DS/VCXWebComposer/VCXISensible",["DS/WebComponentModeler/CATWebInterface"],function(a){var b=a.singleton({interfaceName:"VCXISensible",required:{setSelectable:function(c){},setHighlightable:function(c){},setPreHighlightable:function(c){},getSelectable:function(){},getHighlightable:function(){},getPreHighlightable:function(){}},optional:{}});return b});define("DS/VCXWebComposer/VCXBlobDumper",["UWA/Class","DS/VCXWebKernelTools/VCXFileServices"],function(c,a){var b=c.extend({init:function(){this._mapDataB64={}},ConvertBlobsFromDocManager:function(j,h){this._mapDataB64={};var l={};var f=j.getManager("VCXDocManager");var k=f.GetDocMapClone();for(var e in k){if(k.hasOwnProperty(e)){var g=k[e];var i=g.GetPathType().GetValue();if(i===0){var d=g.GetValueURL().GetValue();if(d.indexOf("blob:")>=0){l[e]=g}}}}this.BlobsToB64(l,h)},BlobsToB64:function(j,h){var k=Object.keys(j).length;if(k===0){h();return}var i=this;var l=function(m,n){k--;if(m&&n){i._mapDataB64[n]=m}if(k===0){h()}};for(var e in j){if(j.hasOwnProperty(e)){var f=j[e];var g=f.GetValueURL().GetValue();var d=f.GetFileName().GetValue();a.BlobURLToBase64(g,d,l,e)}}},GetMapOfData:function(){return this._mapDataB64}});return b});"use strict";var VCXWebDictionary=function(){var a={VCXComponentCamera:{VCXIModifiable:"DS/VCXWebDressup/VCXCameraModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCameraSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIViewpointController:"DS/VCXWebDressup/VCXAViewpointController"},VCXActorDocManager:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableActorDocManager"},VCXComponentAssetOccurrenceComposer:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiableAssetOccurrenceComposer",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",W3AISGNodeHolder:"DS/VCXWeb3DMaster/VCXNodeHolderAssetOccurrenceComposer",VCXIModelNavigable:"DS/VCXWeb3DMaster/VCXNavigableAssetOccurrenceComposer"},VCXComponentOccurrenceComposer:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiableOccurrenceComposer",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",W3AISGNodeHolder:"DS/WebApplicationBase/W3AASGNodeHolder",VCXIModelNavigable:"DS/WebApplicationBase/VCXAModelNavigable"},VCXComponentMesh:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiableMesh",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",W3AISGNodeHolder:"DS/WebApplicationBase/W3AASGNodeHolder",VCXIModelNavigable:"DS/WebApplicationBase/VCXAModelNavigable"},VCXComponentMeshPrimitive:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiableMeshPrimitive",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",W3AISGNodeHolder:"DS/WebApplicationBase/W3AASGNodeHolder",VCXIModelNavigable:"DS/WebApplicationBase/VCXAModelNavigable"},VCXComponentCompositePmi:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiableCompositePmi",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",W3AISGNodeHolder:"DS/WebApplicationBase/W3AASGNodeHolder",VCXIModelNavigable:"DS/WebApplicationBase/VCXAModelNavigable"},VCXComponentCurveWire:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiableCurveWire",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",W3AISGNodeHolder:"DS/WebApplicationBase/W3AASGNodeHolder",VCXIModelNavigable:"DS/WebApplicationBase/VCXAModelNavigable"},VCXComponentPoint:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiablePoint",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",W3AISGNodeHolder:"DS/WebApplicationBase/W3AASGNodeHolder",VCXIModelNavigable:"DS/WebApplicationBase/VCXAModelNavigable"},VCXScenarioSequence:{VCXIModifiable:"DS/VCXWebSequenceManager/VCXModifiableSequence",VCXISensible:"DS/VCXWebComposer/VCXASensible"},VCXComponentViewport:{VCXIModifiable:"DS/VCXWebDressup/VCXViewportModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXViewportSGNodeHolder",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIViewpointController:"DS/VCXWebDressup/VCXAViewpointController"},VCXComponentGround:{VCXIModifiable:"DS/VCXWebDressup/VCXGroundModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXGroundSGNodeHolder",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",},AmbienceModel_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXAmbienceModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXAmbienceSGNodeHolder",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeAmbience",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",},VCXComponentArrowLinear:{VCXIModifiable:"DS/VCXWebDressup/VCXArrowLinearModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXArrowLinearSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIManipulable:"DS/VCXWebDressup/VCXManipulableArrowLinear"},VCXComponentArrowCircular:{VCXIModifiable:"DS/VCXWebDressup/VCXArrowCircularModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXArrowCircularSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIManipulable:"DS/VCXWebDressup/VCXManipulableDressup"},VCXComponentArrowCorner:{VCXIModifiable:"DS/VCXWebDressup/VCXArrowCornerModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXArrowCornerSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIManipulable:"DS/VCXWebDressup/VCXManipulableDressup"},VCXComponentCircle:{VCXIModifiable:"DS/VCXWebDressup/VCXCircleModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCircleSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIManipulable:"DS/VCXWebDressup/VCXManipulableCircle"},VCXComponentRedLine:{VCXIModifiable:"DS/VCXWebDressup/VCXRedLineModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXRedLineSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",},VCXComponentCompass:{VCXIModifiable:"DS/VCXWebDressup/VCXCompassModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCompassSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable"},VCXComponentPanel:{VCXIModifiable:"DS/VCXWebDressup/VCXPanelModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXPanelSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIManipulable:"DS/VCXWebDressup/VCXManipulablePanel"},VCXComponentDiggerPanel:{VCXIModifiable:"DS/VCXWebDressup/VCXDiggerPanelModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXDiggerPanelSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIManipulable:"DS/VCXWebDressup/VCXManipulablePanel"},VCXComponentLabel:{VCXIModifiable:"DS/VCXWebDressup/VCXLabelModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXLabelSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIManipulable:"DS/VCXWebDressup/VCXManipulablePanel"},VCXComponentMeasurement:{VCXIModifiable:"DS/VCXWebDressup/VCXMeasurementModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXMeasurementSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIManipulable:"DS/VCXWebDressup/VCXManipulablePanel"},VCXComponentSection:{VCXIModifiable:"DS/VCXWebDressup/VCXSectionModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXSectionSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIManipulable:"DS/VCXWebDressup/VCXManipulableDressup"},VCXComponentCallout:{VCXIModifiable:"DS/VCXWebDressup/VCXCalloutModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCalloutSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIManipulable:"DS/VCXWebDressup/VCXManipulablePanel"},VCXComponentPolyline:{VCXIModifiable:"DS/VCXWebDressup/VCXPolylineModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXPolylineSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIManipulable:"DS/VCXWebDressup/VCXManipulableDressup"},VCXComponentAssociativePath:{VCXIModifiable:"DS/VCXWebDressup/VCXAssociativePathModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXAssociativePathSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable"},VCXComponentPath:{VCXIModifiable:"DS/VCXWebDressup/VCXPathModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXPathSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable"},VCXComponentBOM:{VCXIModifiable:"DS/VCXWebDressup/VCXBOMModifiable",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXBOMSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable"},VCXBOMInfoComponent:{VCXIModifiable:"DS/VCXWebDressup/VCXBOMInfoModifiable",},VCXComponentDressupGrp:{VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressupGrp",W3AISGNodeHolder:"DS/VCXWebDressup/VCXDressupGrpSGNodeHolder",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable"},VCXComponentMarker:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableMarker"},VCXComponentHotspot:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableHotspot",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList"},VCXComponentSelectionSet:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableSelectionSet",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeSelectionSet",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList",VCXISelectBehavior:"DS/VCXWebComposer/VCXASelectBehavior"},VCXComponentGroupSelectionSet:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableGroupActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeSelectionSet",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList",VCXISelectBehavior:"DS/VCXWebComposer/VCXASelectBehavior"},VCXComponentGroupHotspot:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableGroupActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList",VCXISelectBehavior:"DS/VCXWebComposer/VCXASelectBehavior"},VCXExperience:{W3AIManager:"DS/VCXWebComposer/VCXExperience"},VCXDressupManager:{W3AISGNodeHolder:"DS/VCXWebDressup/VCXDressupManagerSGNodeHolder",W3AIManager:"DS/VCXWebDressup/VCXDressupManager",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable"},VCXSectionManager:{W3AIManager:"DS/VCXWebDressup/VCXSectionManager",},VCXImageManager:{W3AIManager:"DS/VCXWebVisualization/VCXImageManager"},VCXComponentBomManager:{VCXIModifiable:"DS/VCXWebDressup/VCXBomManagerModifiable",W3AIManager:"DS/VCXWebDressup/VCXComponentBomManager"},VCXGUIManager:{W3AIManager:"DS/VCXWebGUI/VCXGUIManager",VCXIModifiable:"DS/VCXWebGUI/VCXModifiableGUIManager",},VCXSelectionManager:{W3AIManager:"DS/VCXWebKernel/VCXSelectionManager",VCXIModifiable:"DS/VCXWebKernel/VCXModifiableSelectionManager",},VCXSelectManager:{W3AIManager:"DS/VCXWebKernel/VCXSelectManager",},VCXWebSelectionManager:{W3AIManager:"DS/VCXWebKernel/VCXWebSelectionManager",},VCXMultiUserInputManager:{W3AIManager:"DS/VCXWebKernel/VCXMultiUserInputManager"},VCXMaterialManager:{W3AIManager:"DS/VCXWebVisualization/VCXMaterialManager"},VCXPaperManager:{W3AIManager:"DS/VCXWebVisualization/VCXPaperManager"},VCXManipulatorManager:{W3AIManager:"DS/VCXWebVisualization/VCXManipulatorManager"},VCXHyperlinkManager:{W3AIManager:"DS/VCXWebComposer/VCXHyperlinkManager"},VCXSequenceManager:{W3AIManager:"DS/VCXWebSequenceManager/VCXSequenceManager"},VCXStylesManager:{W3AIManager:"DS/VCXWebStyles/VCXStylesManager"},VCXComponentStyle:{VCXIModifiable:"DS/VCXWebStyles/VCXModifiableStyle",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeStyle"},VCXVisuManager:{W3AIManager:"DS/VCXWebVisualization/VCXVisuManager"},VCXDragDropManager:{W3AIManager:"DS/VCXWebComposer/VCXDragDropManager"},VCXRobotAdapter:{W3AIManager:"DS/VCXWebVisualization/VCXRobotAdapter"},VCXVolatileGhostingManager:{W3AIManager:"DS/VCXWebVolatileGhosting/VCXVolatileGhostingManager"},VCXExplodeBoxManager:{W3AIManager:"DS/VCXWebExplodeServices/VCXExplodeBoxManager"},VCXNLSManager:{W3AIManager:"DS/VCXWebExperienceBase/VCXNLSManager"},VCXQueryEngine:{W3AIManager:"DS/VCXWebQueryEngine/VCXQueryEngine"},VCXPulseManager:{W3AIManager:"DS/VCXWebPulseManager/VCXPulseManager"},VCXAPIManager:{W3AIManager:"DS/VCXWebKernel/VCXAPIManager"},VCXMarkerManager:{W3AIManager:"DS/VCXWebKernel/VCXMarkerManager"},VCXHotspotManager:{W3AIManager:"DS/VCXWebComposer/VCXHotspotManager"},VCXSelectionSetManager:{W3AIManager:"DS/VCXWebComposer/VCXSelectionSetManager"},VCXDRMManager:{W3AIManager:"DS/VCXWebKernel/VCXDRMManager"},};var e={W3AIManager:"DS/WebApplicationBase/W3AIManager",VCXITreeNode:"DS/VCXWebTreeGUI/VCXITreeNode",VCXISensible:"DS/VCXWebComposer/VCXISensible",VCXIManipulable:"DS/VCXWebVisualization/VCXIManipulable",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXIPulseBehavior",VCXIVisibility:"DS/VCXWebVisibility/VCXIVisibility",VCXIViewpointController:"DS/VCXWebVisualization/VCXIViewpointController",VCXISelectBehavior:"DS/VCXWebComposer/VCXISelectBehavior"};var b={VCXActorDocManager:"DS/VCXWebKernel/VCXActorDocManager",VCXComponentViewport:"DS/VCXWebDressup/VCXComponentViewport",VCXComponentGround:"DS/VCXWebDressup/VCXComponentGround",AmbienceModel_Spec:"DS/VCXWebDressup/AmbienceModel_Spec",VCXComponentArrowLinear:"DS/VCXWebDressup/VCXComponentArrowLinear",VCXComponentArrowCircular:"DS/VCXWebDressup/VCXComponentArrowCircular",VCXComponentArrowCorner:"DS/VCXWebDressup/VCXComponentArrowCorner",VCXComponentCircle:"DS/VCXWebDressup/VCXComponentCircle",VCXComponentPolyline:"DS/VCXWebDressup/VCXComponentPolyline",VCXComponentAssociativePath:"DS/VCXWebDressup/VCXComponentAssociativePath",VCXComponentPath:"DS/VCXWebDressup/VCXComponentPath",VCXComponentBOM:"DS/VCXWebDressup/VCXComponentBOM",VCXBOMInfoComponent:"DS/VCXWebDressup/VCXBOMInfoComponent",VCXComponentPanel:"DS/VCXWebDressup/VCXComponentPanel",VCXComponentDiggerPanel:"DS/VCXWebDressup/VCXComponentDiggerPanel",VCXComponentLabel:"DS/VCXWebDressup/VCXComponentLabel",VCXComponentMeasurement:"DS/VCXWebDressup/VCXComponentMeasurement",VCXComponentSection:"DS/VCXWebDressup/VCXComponentSection",VCXComponentCallout:"DS/VCXWebDressup/VCXComponentCallout",VCXScenarioSequence:"DS/VCXWebSequenceManager/VCXScenarioSequence",VCXComponentOccurrenceComposer:"DS/VCXWeb3DMaster/VCXComponentOccurrenceComposer",VCXComponentAssetOccurrenceComposer:"DS/VCXWeb3DMaster/VCXComponentAssetOccurrenceComposer",VCXComponentMesh:"DS/VCXWeb3DMaster/VCXComponentMesh",VCXComponentMeshPrimitive:"DS/VCXWeb3DMaster/VCXComponentMeshPrimitive",VCXComponentCompositePmi:"DS/VCXWeb3DMaster/VCXComponentCompositePmi",VCXComponentDressupGrp:"DS/VCXWebDressup/VCXComponentDressupGrp",VCXComponentCurveWire:"DS/VCXWeb3DMaster/VCXComponentCurveWire",VCXComponentPoint:"DS/VCXWeb3DMaster/VCXComponentPoint",VCXComponentRedLine:"DS/VCXWebDressup/VCXComponentRedLine",VCXComponentCompass:"DS/VCXWebDressup/VCXComponentCompass",VCXComponentMarker:"DS/VCXWebKernel/VCXComponentMarker",VCXComponentHotspot:"DS/VCXWebKernel/VCXComponentHotspot",VCXComponentSelectionSet:"DS/VCXWebKernel/VCXComponentSelectionSet",VCXComponentGroupHotspot:"DS/VCXWebKernel/VCXComponentGroupHotspot",VCXComponentGroupSelectionSet:"DS/VCXWebKernel/VCXComponentGroupSelectionSet",VCXComponentCamera:"DS/VCXWebDressup/VCXComponentCamera",VCXExperience:"DS/VCXWebComposer/VCXExperience",VCXDressupManager:"DS/VCXWebDressup/VCXDressupManager",VCXSectionManager:"DS/VCXWebDressup/VCXSectionManager",VCXImageManager:"DS/VCXWebVisualization/VCXImageManager",VCXPaperManager:"DS/VCXWebVisualization/VCXPaperManager",VCXManipulatorManager:"DS/VCXWebVisualization/VCXManipulatorManager",VCXHyperlinkManager:"DS/VCXWebComposer/VCXHyperlinkManager",VCXHyperlinkManagerBase:"DS/VCXWebExperienceBase/VCXHyperlinkManagerBase",VCXSequenceManager:"DS/VCXWebSequenceManager/VCXSequenceManager",VCXStylesManager:"DS/VCXWebStyles/VCXStylesManager",VCXComponentStyle:"DS/VCXWebStyles/VCXComponentStyle",VCXSelectionManager:"DS/VCXWebKernel/VCXSelectionManager",VCXSelectManager:"DS/VCXWebKernel/VCXSelectManager",VCXWebSelectionManager:"DS/VCXWebKernel/VCXWebSelectionManager",VCXMultiUserInputManager:"DS/VCXWebKernel/VCXMultiUserInputManager",VCXMaterialManager:"DS/VCXWebVisualization/VCXMaterialManager",VCXGUIManager:"DS/VCXWebGUI/VCXGUIManager",VCXVisuManager:"DS/VCXWebVisualization/VCXVisuManager",VCXDragDropManager:"DS/VCXWebComposer/VCXDragDropManager",VCXComponentBomManager:"DS/VCXWebDressup/VCXComponentBomManager",VCXRobotAdapter:"DS/VCXWebVisualization/VCXRobotAdapter",VCXVolatileGhostingManager:"DS/VCXWebVolatileGhosting/VCXVolatileGhostingManager",VCXExplodeBoxManager:"DS/VCXWebExplodeServices/VCXExplodeBoxManager",VCXNLSManager:"DS/VCXWebExperienceBase/VCXNLSManager",VCXQueryEngine:"DS/VCXWebQueryEngine/VCXQueryEngine",VCXPulseManager:"DS/VCXWebPulseManager/VCXPulseManager",VCXHotspotManager:"DS/VCXWebComposer/VCXHotspotManager",VCXSelectionSetManager:"DS/VCXWebComposer/VCXSelectionSetManager",VCXAPIManager:"DS/VCXWebKernel/VCXAPIManager",VCXDRMManager:"DS/VCXWebKernel/VCXDRMManager",VCXMarkerManager:"DS/VCXWebKernel/VCXMarkerManager"};var d=["DS/WebExtensionServers/WebExtensionServer"];Object.keys(a).forEach(function(f){Object.keys(a[f]).forEach(function(g){d.push(a[f][g])})});Object.keys(e).forEach(function(f){d.push(e[f])});Object.keys(b).forEach(function(f){d.push(b[f])});var c=["VCXWebComposer/VCXWebComposer","VCXWebVolatileGhosting/VCXWebVolatileGhosting","VCXWebModifiables/VCXWebModifiables","VCXWebUnits/VCXWebUnits","VCXWebSequenceManager/VCXWebSequenceManager","VCXWebScenarioManager/VCXWebScenarioManager","VCXWebDressup/VCXWebDressup","VCXWebPulseManager/VCXWebPulseManager","VCXWebInteropSMG/VCXWebInteropSMG","VCXWebProducts/VCXWebProducts","VCXWebGUI/VCXWebGUI","VCXWebGUICommands/VCXWebGUICommands","VCXWebTreeGUI/VCXWebTreeGUI","VCXWebLevelExploderGUI/VCXWebLevelExploderGUI","VCXWebVisualization/VCXWebVisualization"];define("DS/VCXWebComposer/VCXWebDictionary",d,function(){var f=arguments;var h=f[0];var g={fillServer:function(){var k=new h();var i=0;var j=this;Object.keys(a).forEach(function(l){Object.keys(a[l]).forEach(function(n){i++;var m=f[i];if(!m){console.error("Error Loading "+n+" on component "+l)}var o=d[i];m.GetOrigin=function(){return o};k.AddExtension(l,n,m)})});Object.keys(e).forEach(function(m){i++;var l=f[i];k.AddInterface(m,l)});Object.keys(b).forEach(function(n){i++;var l=f[i];if(!l){console.error("Error Loading "+n)}var m=d[i];l.GetOrigin=function(){return m};k.AddComponent(n,l)});return k},getNLSModules:function(){return c}};return g})};VCXWebDictionary();define("DS/VCXWebComposer/VCXASelectBehavior",["UWA/Class"],function(a){var b=a.extend({init:function(){this._selectMode=0},GetSelectMode:function(){return this._selectMode},SetSelectMode:function(c){this._selectMode=c},GetListForSelection:function(){var j=[];var d=this.GetObject();if(this._selectMode===0){j.push(d)}else{if(this._selectMode!==null&&typeof this._selectMode!=="undefined"){var c=d.QueryInterface("VCXIModelNavigable");if(c){var f=c.getChildren();for(var e=0;e<f.length;e++){var h=f[e];if(h){var g=h.GetObject();j.push(g)}}}if(this._selectMode===1){}else{if(this._selectMode===2){j.push(d)}}}}return j}});return b});define("DS/VCXWebComposer/VCXCursor",["DS/WebappsUtils/WebappsUtils","UWA/Class","DS/Core/PointerEvents","DS/Visualization/ThreeJS_DS"],function(e,a,b,c){var d=a.extend({init:function(f){this._experienceBase=f;this._experienceBase.getManager("VCXContextManager").loadCssFile("VCXWebComposer/VCXCursor.css",1);this._x=0;this._y=0;this._text="";this._isDisplay=false;this._isInAnimation=false;this._delayAnmiation=1000;this._delayBeforeStartAnimation=1000;this._imgR=new UWA.Controls.Img({url:e.getWebappsAssetUrl("VCXWebComposer","cursor/I_VCX_ArrowRight.png"),});this._imgL=new UWA.Controls.Img({url:e.getWebappsAssetUrl("VCXWebComposer","cursor/I_VCX_ArrowLeft.png"),});this._imgUp=new UWA.Controls.Img({url:e.getWebappsAssetUrl("VCXWebComposer","cursor/I_VCX_ArrowUp.png"),});this._imgDown=new UWA.Controls.Img({url:e.getWebappsAssetUrl("VCXWebComposer","cursor/I_VCX_ArrowDown.png"),});this._containImgR=UWA.createElement("div",{"class":"imgCursorR",html:this._imgR,styles:{pointerEvents:"none"}});this._containImgL=UWA.createElement("div",{"class":"imgCursorL",html:this._imgL,styles:{pointerEvents:"none"}});this._containImgUp=UWA.createElement("div",{"class":"imgCursorUp",html:this._imgUp,styles:{pointerEvents:"none"}});this._containImgDown=UWA.createElement("div",{"class":"imgCursorDown",html:this._imgDown,styles:{pointerEvents:"none"}});this._uiLayer=this._experienceBase.getManager("VCXContextManager").getUIFrame();this._containImgR.inject(this._uiLayer);this._containImgL.inject(this._uiLayer);this._containImgUp.inject(this._uiLayer);this._containImgDown.inject(this._uiLayer);document.vcxCursor=this;document.addEventListener(b.POINTERMOVE,d.mouseMoveCB)},Clean:function(){document.removeEventListener(b.POINTERMOVE,d.mouseMoveCB);document.vcxCursor=null;this._containImgR.parentNode.removeChild(this._containImgR);this._containImgL.parentNode.removeChild(this._containImgL);this._containImgUp.parentNode.removeChild(this._containImgUp);this._containImgDown.parentNode.removeChild(this._containImgDown);this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebComposer/VCXCursor.css")},dispose:function(){},startAnimIfNotMove:function(){window.clearTimeout(this._waitStartAnim);this._xBeforeStartAnim=this._x;this._yBeforeStartAnim=this._y;var f=this;this._waitStartAnim=window.setTimeout(function(){var h=Math.abs(f._x-f._xBeforeStartAnim)+Math.abs(f._y-f._yBeforeStartAnim);if(h<6){var g=new c.Vector2(f._x,f._y);f.startAnim(g)}},this._delayBeforeStartAnimation)},startAnim:function(f){this.updateImagePosition(f.x,f.y);this._containImgR.classList.add("animTranslateR");this._containImgL.classList.add("animTranslateL");this._containImgUp.classList.add("animTranslateUp");this._containImgDown.classList.add("animTranslateDown");var g=this;this._isInAnimation=true;window.setTimeout(function(){g.stopAnim(g)},this._delayAnmiation)},stopAnim:function(f){f._containImgR.classList.remove("animTranslateR");f._containImgL.classList.remove("animTranslateL");f._containImgUp.classList.remove("animTranslateUp");f._containImgDown.classList.remove("animTranslateDown");f._isInAnimation=false},updateImagePosition:function(f,g){if(this._isInAnimation){return}if(this._containImgR!==null&&this._containImgR!==undefined){this._containImgR.setStyle("top",(g-6)+"px");this._containImgR.setStyle("left",(f+2)+"px")}if(this._containImgL!==null&&this._containImgL!==undefined){this._containImgL.setStyle("top",(g-6)+"px");this._containImgL.setStyle("left",(f-15)+"px")}if(this._containImgUp!==null&&this._containImgUp!==undefined){this._containImgUp.setStyle("top",(g-13)+"px");this._containImgUp.setStyle("left",(f-5)+"px")}if(this._containImgDown!==null&&this._containImgDown!==undefined){this._containImgDown.setStyle("top",(g+1)+"px");this._containImgDown.setStyle("left",(f-5)+"px")}},updateTextPosition:function(f,g){if(this._containDivForText!==null&&this._containDivForText!==undefined){this._containDivForText.textContent=this._text;this._containDivForText.setStyle("top",g+"px");this._containDivForText.setStyle("left",f+"px")}},displayText:function(f){this._text=f;if(this._text===""){if(this._isDisplay){this._containDivForText.remove();this._isDisplay=false}}else{if(!this._isDisplay){this._containDivForText=UWA.createElement("div",{html:"<p></p>",styles:{position:"absolute",paddingTop:"10px",paddingLeft:"20px",top:"0px",left:"0px",pointerEvents:"none"}});this._containDivForText.inject(this._uiLayer);this._isDisplay=true}}this._containDivForText.textContent=this._text}});d.mouseMoveCB=function(g){var h=g.currentTarget||g.srcElement;var j=h.vcxCursor;if(j){var f=g.clientX;var i=g.clientY;j._x=f;j._y=i;j.updateImagePosition(f,i);j.updateTextPosition(f,i)}};return d});define("DS/VCXWebComposer/VCXExperienceLoader",["UWA/Utils","DS/CoreEvents/Events","DS/VCXWebExperienceLoader/VCXExperienceLoaderBase","DS/VCXWebSequenceManager/VCXCmdChangeScenarioSequence","DS/VCXWebSequenceManager/VCXCmdChangeSequence","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties"],function(e,b,f,d,i,a,h){var c=false;var g=f.extend({InitLoader:function(j){var k=this;this._parent(j.experienceBase);this._options=j},Load:function(m){if(!m){console.error("Have to use iOptions");return}this.InitLoader(m);var o=this;b.subscribe({event:"VCX_ASSET_LOADED"},function(p){m=null;o.on3dxmlLoaded(o,p)});this._experienceBase._mapAssetsBlob=m.mapAssets;if(m.jsonFile){this.LoadJSON(function(){var q=o._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentAssetOccurrenceComposer");o._numOfAsset=q.length;o._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties();var p=o._experienceBase.getManager("VCXContextManager");if(p.getCityMode()||(p.getProdHighMode()&&p.getCat3DXIntegration())){o.EndLoadJSON(m.endCB)}else{m.endCB()}})}else{this._arrayAssets=[];if(m.urb){this._bIsCityLoading=true}else{this._bIsCADLoading=true}if(m.mapAssets){var j=m.mapAssets;this._numOfAsset=Object.keys(j).length;for(var l in j){if(j.hasOwnProperty(l)){var n=this.CreateAsset(l);this._arrayAssets.push(n);var k=n.QueryInterface("VCXIModifiable");if(k){this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralPropertiesOneModifiable(k.GetHashing())}}}this._experienceBase.getManager("VCXScenarioManager").UpdateProperties()}}},CreateAsset:function(v){var r="VCXComponentAssetOccurrenceComposer";var m=0;var u=v.split(".")[1];if(u==="3dxml"){}else{if(u.toLowerCase()==="smggeom"){m=1}else{if((u.toLowerCase()==="urb")||(u.toLowerCase()==="ctxp")){m=2;r="CIDComponentAsset"}}}var s=this._experienceBase.Factory.BuildComponent(r);if(!s){console.error("Can't create component");return}this._experienceBase.ComponentsMap.AddComponent(s);s.SetAssetID(v);var o=v.split(".")[0];var l=e.getUUID().substr(0,18);var q=o+"-"+l;s.SetNodeID(q);s.SetAssetType(m);var k=this._experienceBase.getManager("VCXContextManager").getRootComponent();var t=k.QueryInterface("VCXIModelNavigable");var p=s.QueryInterface("VCXIModelNavigable");p.setParent(t);var n=s.QueryInterface("VCXIModifiable");var j=new h(this._experienceBase.getManager("VCXScenarioManager"));j.CaptureNeutralProperties(n);j.Do();return s},BuildComponentsFromAssetsCityMode:function(j){this._experienceBase.getManager("CityUrbanManager").TraverseDataModel()},BuildComponentsFromAssets:function(q){for(var m=0;m<q.length;m++){var n=q[m];var o=n.QueryInterface("W3AISGNodeHolder");var r=o.getSGNode();var j=o.getPathElement();var p=n.QueryInterface("VCXIModelNavigable");var l=function(w){if(!w){return null}var t=null;switch(w.productType){case"Instance3D":var s=w.getChildren();if(!s||!s.length){return null}for(var v=0;v<s.length;v++){var u=s[v];if(u.productType==="InstanceRep"){return"VCXComponentMesh"}}if(s[0]&&s[0].children&&s[0].children[0]){if(s[0].children[0].productType==="InstanceRep"){return"VCXComponentMesh"}}t="VCXComponentOccurrenceComposer";break;default:console.log("Unknown DS type");break}return t};var k={attributeToUse:"productType",componentTypeForRootNode:"VCXComponentOccurrenceComposer",Instance3D:"VCXComponentOccurrenceComposer",Reference3D:null,InstanceRep:"VCXComponentMesh",defaultType:null,componentTypeFromFunction:l};this._experienceBase.BuildComponentsFromNodeEXT(r,j,p,k)}b.publish({event:"VCX_ASSETS_ADDED",data:q})},on3dxmlLoaded:function(l,m){l._numOfAsset--;if(l._numOfAsset===0){delete this._experienceBase._mapAssetsBlob;if(l._bIsCADLoading){l.BuildComponentsFromAssets(l._arrayAssets);var k=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();if(k){}else{l._experienceBase.getManager("VCXExperience").OnEndLoading(true)}}else{if(l._bIsCityLoading){}else{l.EndLoadJSON()}}var j=l._options.endCB;if(j!==undefined){j()}}l._options=null;l._experienceBase=null;l._factory=null;l._scenarioManager=null;l._ComponentsMap=null;l._arrayAssets=null},LoadJSON:function(l){var k=this;var j=new FileReader();j.onload=function(){k.filevarJson=JSON.parse(j.result);var m=k._experienceBase.getManager("VCXScenarioManager");m.SetCurrentFrame(0);m.SetDefaultInterpolator("Actor.Hyperlink",0);m.SetDefaultInterpolator("Collab.Image.Doc.ID",0);k.LoadComponents(k.filevarJson.VCXObjects).done(function(){k.LoadVCXIModelNavigable(k.filevarJson.VCXIModelNavigable);k.LoadMetaPropertiesDef(k.filevarJson.MetaPropertiesDef);k.LoadPropertiesLinks(k.filevarJson.PropertiesLinks);k.LoadNeutrals(k.filevarJson.neutrals);k._experienceBase.getManager("VCXGUIManager").InitGUI();if(k._experienceBase.getManager("VCXContextManager").getCityMode()){k.ResolveCityExternalAssetsHolder(k.filevarJson.VCXAssetsHolder,l)}else{k.ResolveProductAssetsHolder(k.filevarJson.VCXAssetsHolder,l)}})};j.readAsText(this._options.jsonFile)},LoadComponents:function(q,j){var s=UWA.Promise.deferred();var n=[];var o=this._experienceBase.getManager("VCXContextManager");if(o.getCat3DXIntegration()){if(q){for(var k=0;k<q.length;k++){var m=q[k].objectID;var l=q[k].objectType;var p=this._factory.BuildComponent(l);if(p){p.SetID(m);this._ComponentsMap.AddComponent(p);var r=q[k].objectData;if(r){p.SetLoadData(r)}}else{n.push({objectType:l,objectID:m})}}}this.BuilComponentsAsync(n).done(function(){s.resolve()})}else{this._parent(q);s.resolve()}return s.promise},BuilComponentsAsync:function(l){var k=UWA.Promise.deferred();var n=this._experienceBase.getManager("VCXCAT3DXModelManager").GetCAT3DXModel();var o=[];for(var m=0;m<l.length;m++){var q=l[m];var j=q.objectType;var p=q.objectID;o.push(n.getFactory().BuildComponent(j,p))}UWA.Promise.all(o).done(function(){k.resolve()});return k.promise},LoadScenarioSequences:function(l){for(var j=0;j<l.length;j++){var k=l[j].objectID;var m=this._experienceBase.ComponentsMap.GetComponentFromID(k);var q=new i(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);q._bIsLoading=true;q.PushSequence(m);this._experienceBase.getManager("VCXCommandManager").Do(q);var n=l[j].listScenarioID;for(var r=0;r<n.length;r++){var s=n[r];var o=this._experienceBase.ComponentsMap.GetComponentFromID(s);var p=new d(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);p._bIsLoading=true;p.PushScenarioInSequence(o,m.GetID());this._experienceBase.getManager("VCXCommandManager").Do(p)}}},ResolveProductAssetsHolder:function(n,u){var s=[];var t=false;var l=this._experienceBase.getManager("VCXContextManager").getRootNode();for(var j=0;j<n.length;j++){var k=n[j].objectID;var o=this._reformatObjectIDForPathOfId(k);var q=this._ComponentsMap.GetComponentFromID(o);if(q){if(q.IsKindOf("Model_VPMReference_Spec")||q.IsKindOf("VCXComponentVPMReference")){var p=q.QueryInterface("W3AISGNodeHolder").getSGNode();var r=n[j].linkDescription;var m=q.QueryInterface("CATI3DXAssetHolder");m.setLinkDescription(r);if(r){s.push(this._experienceBase.getManager("VCXCAT3DXModelManager").LoadProduct(q,false))}}}}UWA.Promise.all(s).done(function(){if(u){u()}})},ResolveCityExternalAssetsHolder:function(o,t){if(o){for(var j=0;j<o.length;j++){var l=o[j].objectID;var p=this._reformatObjectIDForPathOfId(l);var r=this._ComponentsMap.GetComponentFromID(p);if(r){if(r.IsKindOf("CIDComponentCityAsset")){var m=this._experienceBase.getManager("CityUrbanManager");if(m){var n=r.QueryInterface("CATI3DXAssetHolder");var s=o[j].linkDescription;n.setLinkDescription(s);r.SetAssetID(s);var k=o[j].linkContextDescription;if(k){var u=this._experienceBase.getManager("CAT3DXLinkManager").getLinkContextFromJSONDescription(k);n.setLinkContext(u);var q=this;n.resolveAsset().done(function(v){if(v){q._experienceBase.getManager("CityUrbanManager").LoadModel(v,function(){q.LoadVCXAssetsHolder(q.filevarJson.VCXAssetsHolder).done(function(){if(t){t()}});var w=q._experienceBase.getManager("VCXGUIManager").getGettingStartedUI();w.endLoadingExperience()})}})}}}}}}},LoadVCXAssetsHolder:function(m){var r=UWA.Promise.deferred();if(this._experienceBase.getManager("VCXContextManager").getCat3DXIntegration()){}else{r.resolve()}if(m){var n=[];for(var j in m){if(m.hasOwnProperty(j)){var k=m[j].objectID;var o=this._reformatObjectIDForPathOfId(k);var p=this._ComponentsMap.GetComponentFromID(o);if(p){var l=p.QueryInterface("CATI3DXAssetHolder");if(l){var q=m[j].linkDescription;if(q){l.setLinkDescription(q);n.push(l.resolveAsset())}}}}}UWA.Promise.all(n).done(function(){r.resolve()})}return r.promise},EndLoadJSON:function(l){var m=this._experienceBase.getManager("VCXContextManager").getMainViewer().getRootNode();this.LoadW3AISGNodeHolder(this.filevarJson.W3AISGNodeHolder);this.LoadScenarios(this.filevarJson.listScenarios);if(this.filevarJson.DocManager){var k=this.filevarJson.DocManager.array;if(k&&k.length!==0){for(var o=0;o<k.length;o++){var t=k[o];var x=t.type;var z=t.value;var w=this.BuildVCXPropertyValue(x,z);if(w!==null){this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(w)}}}}var y=this.filevarJson.EmbeddedData;if(y&&y.length!==0){for(var n in y){if(y.hasOwnProperty(n)){var q=this._experienceBase.getManager("VCXDocManager").GetPropPath(n);if(q){var u=y[n];var j=a.dataURLToBlob(u);var v=window.URL.createObjectURL(j);q.GetValueURL().SetValue(v)}else{console.log("unable to get propPath of "+n)}}}}var s=this.filevarJson.ScenarioSequences;this.LoadScenarioSequences(s);var p=this._experienceBase.getManager("VCXContextManager");if(p.getCityMode()){var r=p.getRootComponent();this._experienceBase.getManager("VCXCAT3DXModelManager").TraverseNavigableToVariable(r);this._experienceBase.getManager("CityUrbanManager").OnEndLoadingCity(true).done(function(){l()})}else{if(p.getProdHighMode()&&p.getCat3DXIntegration()){this._experienceBase.getManager("VCXCAT3DXModelManager").OnEndLoading().done(function(){l()})}else{this._experienceBase.getManager("VCXExperience").OnEndLoading(false)}}}});return g});define("DS/VCXWebComposer/VCXWebActorListManager",["DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebProperties/VCXPropertyValueLink","DS/WebApplicationBase/W3AAManager",],function(b,a,d){var c=d.extend({initialize:function(){},postInitialize:function(){},unInitialize:function(){},disposeComponentsActorListFromType:function(g){var f=this._experienceBase.ComponentsMap.GetComponentFromType(g);for(var h=0;h<f.length;++h){var e=f[h];if(e){e.CallDispose()}}},associateComponentAndActorListToMapCache:function(h,g){var f=h.GetID();var e=this.getComponentsActorListMapCache();if(!e){return}if(!e[f]){e[f]={}}var i=g.GetID();if(!e[f][i]){e[f][i]=g}},dissociateComponentAndActorListFromMapCache:function(h,g){var f=h.GetID();var e=this.getComponentsActorListMapCache();if(!e||!e[f]){return}if(g){var i=g.GetID();if(e[f][i]){delete e[f][i];if(Object.keys(e[f]).length===0){delete e[f]}}}else{delete e[f]}},addActorsListToComponentActorList:function(j,h){var o="";var i=h.GetID();var v=h.QueryInterface("VCXIModifiable");var m=v.GetProperty("Actor.ListActors");var r=m.GetPropertyValue().GetValue();var e=[];for(var q=0;q<r.length;++q){var s=r[q];e.push(s.Value)}var l=[];for(var w=0;w<j.length;++w){var n=j[w];var o=n.GetID();if(e.indexOf(o)<0){l.push(o)}}if(l.length>0){for(var p=0;p<l.length;++p){var o=l[p];var k=new a();k.SetValue(o);r.push(k);this.associateComponentAndActorListToMapCache(o,hotspotID)}var f=m.Clone();f.GetPropertyValue().SetValue(r);var g=this._experienceBase.getManager("VCXScenarioManager");var t=this._experienceBase.getManager("VCXCommandManager");var u=new b(g,t);u.ChangeProperty(v,f);t.Push(u);return true}else{return false}},removeActorsListFromComponentActorList:function(j,h){var i=h.GetID();var x=h.QueryInterface("VCXIModifiable");var l=x.GetProperty("Actor.ListActors");var r=l.GetPropertyValue().GetValue();var f=[];for(var q=0;q<r.length;++q){var s=r[q];f.push(s.Value)}var m=0;for(var p=0;p<j.length;++p){var n=j[p];var o=n.GetID();var v=f.indexOf(o);if(v!==-1){r[v]=null;this.dissociateComponentAndActorListFromMapCache(n,h);++m}}if(m>0){var w=r.filter(function k(y){return y!==null});var g=l.Clone();g.GetPropertyValue().SetValue(w);var e=this._experienceBase.getManager("VCXScenarioManager");var t=this._experienceBase.getManager("VCXCommandManager");var u=new b(e,t);u.ChangeProperty(x,g);t.Push(u);return true}else{return false}},removeActorsListFromAllComponentsActorListOfAKind:function(i,l){var g=[];var f=this.getComponentsActorListMapCache();var h=this._experienceBase.ComponentsMap.GetComponentFromType(l);for(var e=0;e<h.length;++e){var j=h[e];var k=this.removeActorsListFromComponentActorList(i,j);k&&g.push(j)}return g},isComponentBelongingToMapCache:function(f){var e=this.getComponentsActorListMapCache();if(!e){return}if(e[f.GetID()]){return true}else{return false}},getListOfComponentActorListOwningComponent:function(i){var g=[];var f=this.getComponentsActorListMapCache();if(!f){return}var h=i.GetID();if(f[h]){var k=Object.keys(f[h]);for(var j=0;j<k;++k){var e=k[j];f[h][e]&&g.push(f[h][e])}}return g},});Object.defineProperty(c.prototype,"componentType",{enumerable:true,get:function(){return"VCXWebActorListManager"}});return c});define("DS/VCXWebComposer/VCXUIHyperlink",["UWA/Class","DS/VisuEvents/EventsManager","UWA/Controls/Lightbox","DS/UIBehaviors/ContextualMenuManager","DS/VCXWebKernelTools/VCXFileWriter","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VCXWebKernelTools/VCXFileServices"],function(b,d,a,h,f,i,g,c){var e=b.extend({init:function(j){var n=this;this._experienceBase=j;this._vcxGuiManager=j.getManager("VCXGUIManager");this._cursorStyle=document.body.style.cursor;this.onVisuEventMouse=function k(u){var p=n._experienceBase.getManager("VCXExperience").GetPreviewMode();if(p){var q=n._experienceBase.getManager("VCXHyperlinkManager");if(q){if(q.GetActiveInteraction()){var o=false;var v=q.GetSortedInteractableObjects();for(var r=0;r<v.length;r++){var s=n._experienceBase.ComponentsMap.GetComponentFromID(v[r]);var w=s.QueryInterface("VCXIModifiable");var t=g.getDisplayPriority(w);if(t<-7){break}if(t<=6||t>=10){o=true;break}if(g.isModifiableUnderMouse(w,u)){n.onChangeMouseStyle(w);return}}if(o){var w=i.GetModifiableFromEvent(u,n._experienceBase);if(w){n.onChangeMouseStyle(w);return}}}}}n.onChangeMouseStyle(null)};var l=this._experienceBase.getManager("VCXContextManager");var m=l.getMainViewer().canvas;d.addEvent(m,"onPrimaryPointerMoveUnique",this.onVisuEventMouse)},UnsubscribeEvent:function(){d.removeEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerMoveUnique",this.onVisuEventMouse)},onChangeMouseStyle:function(q){var p=false;if(q){var n=null;var j=q.GetObject().GetID();var r=false;if(this._experienceBase.getManager("VCXHotspotManager")){r=this._experienceBase.getManager("VCXHotspotManager").IsHotspot(j)}if(r){var m=this._experienceBase.getManager("VCXHotspotManager").GetHotspotFromComponentID(j);var o=m.QueryInterface("VCXIModifiable");n=o.GetProperty("Actor.Hyperlink").GetPropertyValue().GetValue()}else{var l=q.GetProperty("Actor.Hyperlink").GetPropertyValue().GetValue();n=parseInt(l,10)}if(n>=0){p=true}}var k=this._experienceBase.getManager("VCXExperience").GetPreviewMode();if(p&&k){this._oldCursor=this._vcxGuiManager.GetCursor();this._vcxGuiManager.SetCursor("pointer")}else{if(this._oldCursor){this._vcxGuiManager.SetCursor(this._oldCursor);this._oldCursor=null}}},CreateMediaDiv:function(j,m){var l=this;var k=function(o){var n="";if(o.indexOf("data:image")>-1){n="img";l.OpenImage(j,m)}else{if(o.indexOf("data:application/octet-stream")>-1){var p=new f();p.saveAs(o,m)}else{window.open(j,"Download")}}};c.BlobURLToBase64(j,m,k)},OpenImage:function(k,n){var m=this;var j=function(p){var o=m.CreateDiv(k,n,p);o.styles.width=p.width;o.styles.height=p.height;m._myMedia=UWA.createElement("img",{id:o.id,title:o.title,src:o.src,styles:o.styles});h.onReady({target:m._myMedia,nodes:o.nodes});m._myMedia.addEventListener("click",function(q){if(q.stopPropagation){q.stopPropagation()}});m._lightbox.addContent(m._myMedia)};var l=c.getImageSizeFromBlobUrl(k,j)},CreateDiv:function(l,o,m){var k=this._vcxGuiManager._uiLayer;this._lightbox=new a();this._lightbox.inject(k);this._lightbox.getInnerElement().style.zIndex="15";this._lightbox.open();var n=this;var j={id:"myMedia",title:"Click right to save",src:l,styles:{position:"absolute",left:"50%",bottom:"50%",color:"#888888",width:m.width+"px",height:m.height+"px",marginLeft:m.width*-0.5+"px",marginBottom:m.height*-0.5+"px",zIndex:"15",},nodes:[{label:"Save  as...",callback:function(){n.LaunchContextMenu(0,l,o)}},{label:"Open  in new tab...",callback:function(){n.LaunchContextMenu(1,l,o)}}]};return j},LaunchContextMenu:function(m,j,l){if(m===0){var k=new f();k.saveAs(j,l)}else{if(m===1){window.open(j)}}}});return e});define("DS/VCXWebComposer/VCXDragDropManager",["DS/WebApplicationBase/W3AAManager","DS/DataDragAndDrop/DataDragAndDrop","DS/Controls/Loader","DS/VCXWebInteropSMG/VCXSmgLoader","DS/VCXWebComposer/VCXExperienceLoader","DS/VCXWebKernelCommands/VCXCmdChangeComponent","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebDressup/VCXCmdChangeDressup","DS/VCXWebDressup/VCXComponentViewport","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebKernelTools/VCXFileServices"],function(b,e,v,d,a,k,j,r,u,f,i,l,m,o,p,s,q,t,c,g,w){var n=function(y,x){return y.indexOf(x.toLowerCase(),y.length-x.length)!==-1};var h=b.extend({postInitialize:function(){var x=this._experienceBase;var z=x.getManager("VCXContextManager");if(!z.getMainViewer().canvas){console.error("No canvas !!");return}if(z.getExperienceIn3DPlay()){return}var y=document.getElementById(z.getMainViewer().canvas.id);var A={over:function(I,E,H){var G=E.dataTransfer;var C=G.types;var F=false;if(C!==undefined){for(var D=0;D<C.length;D++){if((C[D]==="Files")||(C[D]==="text/plain")){F=true;break}}}if(F){G.dropEffect="copy"}else{G.dropEffect="none"}return true},enter:function(G,D,F){if(D&&D.dataTransfer&&D.dataTransfer.types){var H=D.dataTransfer.types;var E=H.length;for(var C=0;C<E;C++){if(H[C]==="Files"||H[C]==="text/plain"){x.getManager("VCXGUIManager").AddDropZone();return}}}},leave:function(){x.getManager("VCXGUIManager").RemoveDropZone()},drop:function(am,N,an){console.log(am);if(am&&(typeof(widget.onRefresh)!=="undefined")){var S=x.getManager("VCXContextManager").CheckInputFile(true);if(!S.supported){var H={level:"warning",title:"Loading",subtitle:S.message,sticky:true};z.addNotification(H);x.getManager("VCXGUIManager").getGettingStartedUI().dropZoneOFF();return}var J={};var G="text/plain";if(x.getManager("VCXContextManager").isIE11()){G="text"}J.data=an.dataTransfer.getData(G);J.getData=function(){return J.data};J.files=[];x.getManager("VCXGUIManager").RemoveDropZone();var O=x.getManager("VCXGUIManager").getGettingStartedUI();if(O){var F=JSON.parse(J.data).data;var af=F.items[0].objectType;console.log("Dropped object type : "+af);x.getManager("VCXCAT3DXModelManager").CheckTenant(F.items[0]).done(function(){if(af==="Document"){x.getManager("VCXCAT3DXModelManager").IsDocumentSupported(J).done(function(at){if(at){var av=F.items[0].contextId;O.onDropDocument(function(aw){aw.getManager("VCXCAT3DXModelManager").InitLocalFactoryOptions(F.items[0]).done(function(){aw.getManager("VCXCAT3DXModelManager").LoadLinkFromCollabSpace(J).done(function(){O.endLoadingExperience()})})},af,av,F.items[0])}else{console.log("Document extension not supported");var ar=x.getManager("VCXContextManager");if(ar){var au={level:"warning",title:"Loading",subtitle:"Extension not supported.",sticky:true};ar.addNotification(au)}O.failLoadingExperience()}})}else{if(af==="VPMReference"||af==="CATPart"||af==="CAT_Distiller_Ref"||((af.indexOf("Aec")>=0||af==="Building")&&(localStorage.getItem("DS_PRODUCTHIGHLIGHT_CCT_IMPORT")!=="null"))){if(x.getManager("VCXContextManager").getSupportOpenProduct()){}else{console.log("Products are not supported.");var ap=x.getManager("VCXContextManager");if(ap){var aq={level:"warning",title:"Loading",subtitle:"Products not supported.",sticky:true};ap.addNotification(aq)}return}O.onDropProduct(function(ar){ar.getManager("VCXCAT3DXModelManager").InitLocalFactoryOptions(F.items[0]).done(function(){ar.getManager("VCXCAT3DXModelManager").InsertProduct(F.items[0].displayName,F.items[0].objectId).done(function(){O.endLoadingExperience();console.log("Product added.")})})},F.items[0].contextId)}else{if(af==="AmbienceEnvironment"){if(x.getManager("VCXContextManager").getSupportOpenAmbience){}else{console.log("Ambiences are not supported.");return}O.onDropAmbience(function(ar){ar.getManager("VCXCAT3DXModelManager").InitLocalFactoryOptions(F.items[0]).done(function(){ar.getManager("VCXCAT3DXModelManager").CreateExperience().done(function(){ar.getManager("VCXCAT3DXModelManager").InsertAmbience(F.items[0].displayName,J,F.items[0].objectId).done(function(aA){var au=ar.getManager("VCXContextManager");var aH=ar.getManager("VCXCommandManager");var ay=ar.getManager("VCXScenarioManager");var aC=ar.getManager("VCXDressupManager");var at=ar.getManager("VCXGUIManager");var aF=ar.ComponentsMap;var az=ar.Factory;var aD=aA.QueryInterface("VCXIModifiable");var ax=new f(aH,aC,ay,aF);ax.AddDressups(aA);aH.Push(ax);var aw=new u(ay);aw.ChangeProperty(aD,"Environment.Background.Map",new s(VCXViewport_Spec.EEnvironment.PLM));aH.Do(aw);aD.OnChangeProperty("Environment.Background.Map",new s(VCXViewport_Spec.EEnvironment.PLM));var aG=aA.QueryInterface("VCXIVisibility");if(aG){aG.SetVisibility(g.EVisState.Visible)}var av=new l(new m("Viewport.ActiveAmbience",1),new o(aA.GetID()));if(av){var aB=au.getActiveViewport();var aE=aB.QueryInterface("VCXIModifiable");var ax=new r(ay,aH,false);ax.ChangeProperty(aE,av);aH.Push(ax)}O.endLoadingExperience();console.log("Ambience added.")})})})})}else{if(af==="Stu3DExperience"){O.onDropExperience(function(ar){ar.getManager("VCXCAT3DXModelManager").LoadLinkFromCollabSpace(J).done(function(au){ar.getManager("VCXCAT3DXModelManager").LoadExperienceModel(au).done(function(){O.endLoadingExperience()})})["catch"](function at(av){console.log(av);var au=ar.getManager("VCXContextManager");if(au){var aw={level:"warning",title:"Loading",subtitle:av,sticky:true};au.addNotification(aw)}O.failLoadingExperience()})})}else{console.log("VCXDragDropManager : Object type not found");var ap=x.getManager("VCXContextManager");if(ap){var aq={level:"warning",title:"Loading",subtitle:"Object type not supported",sticky:true};ap.addNotification(aq)}}}}}})["catch"](function Z(aq){if(aq==="multi-tenant"){var ap=x.getManager("VCXContextManager");if(ap){var ar={level:"warning",title:"Tenant",subtitle:"Multi-tenant is not supported.",sticky:true};ap.addNotification(ar)}}return})}}var Q=an.dataTransfer.files;var ai=false;if(Q.length){ai=true;for(var U=0;U<Q.length;U++){var T=Q[U];if(typeof T!=="undefined"){var M=T.name;var L=T.type;if(!T.type){ai=false}}}}if(Q.length>0){var S=x.getManager("VCXContextManager").CheckInputFile(false);if(!ai&&!S.supported){var H={level:"warning",title:"Loading",subtitle:S.message,sticky:true};z.addNotification(H);x.getManager("VCXGUIManager").getGettingStartedUI().dropZoneOFF();return}}var al="";var V="";var C="";var P=null;var aa="";var R="";var ad=null;var ak={};var D="";var X=null;var W=false;if(Q.length===1&&x.odt==="record"){var T=Q[0];var O=x.getManager("VCXGUIManager").getGettingStartedUI();return x.getManager("VCXAPIManager").OpenModel(T,function(){O.endLoadingExperience()})}x.getManager("VCXGUIManager").RemoveDropZone();for(var U=0;U<Q.length;U++){var T=Q[U];if(typeof T!=="undefined"){var M=T.name;if(typeof M!=="undefined"){var ao=M.slice(M.lastIndexOf(".")+1);ao=ao.toLowerCase();var S=x.getManager("VCXContextManager").CheckInputExtension(ao);if(S.supported){}else{z.addNotification({level:"warning",title:"Action not supported",message:S.message,});continue}if(ao==="json"||ao==="exprd"){al=T}else{if(ao==="ctps"){V=T}else{if(ao==="3dxml"){C=T;P=window.URL.createObjectURL(T);ak[T.name]=P}else{if(ao==="smgxml"){aa=T}else{if(ao==="smg"||ao==="smgs"){R=T}else{if(ao==="smggeom"){ak[T.name]=T;ad=T}else{if((ao==="urb")||(ao==="ctxp")){D=T.name;X=T;ak[T.name]=X;W=true}}}}}}}}}}var aj=x.getManager("VCXContextManager").getCityMode();var ab=x.getManager("VCXContextManager").getFileMode();var O=x.getManager("VCXGUIManager").getGettingStartedUI();if(R){var ag=new d();var ac=new v({text:"Preparing..."});ac.inject(widget.body);ac.getContent().setStyles({margin:"auto",position:"absolute",top:"110px",left:"0",bottom:"0",right:"0",width:"60px",height:"60px"});if(!aj&&(O.tstProvider===true||ab)){if(x&&x.webApplication){var E=x.webApplication;E.requestNewExperienceBaseAsync().then(function(ap){O.startLoadingExperience();if(ap.odt==="record"){ap.getManager("VCXODTManager").SetModelSMG(R)}ag._progressBar=ac;ag.Load(ap,z.getMainViewer(),R,function(){O.endLoadingExperience()})})}}else{}}else{if(al){var I=new a();I.Load({experienceBase:x,mapAssets:ak,jsonFile:al,urb:true,endCB:function(){O.endLoadingExperience()}})}else{if(ad){if(x.odt==="record"){x.getManager("VCXODTManager").SetModelForZip(ad)}var I=new a();I.Load({experienceBase:x,mapAssets:ak,jsonFile:"",endCB:function(){if(O){O.endLoadingExperience()}}})}else{if(C){if(x.odt==="record"){x.getManager("VCXODTManager").SetModelForZip(C)}var I=new a();I.Load({experienceBase:x,mapAssets:ak,jsonFile:"",endCB:function(){if(O){O.endLoadingExperience()}}})}else{if(D||V){if(O){var ah=function(ap){if(V){O.onDropExperience(function(aq){aq.getManager("VCXCAT3DXModelManager").InitLocalFactoryOptions().done(function(){var ar=new a();ar.Load({experienceBase:aq,mapAssets:ak,jsonFile:V,urb:true,endCB:function(){O.endLoadingExperience()}})})})}else{ap.getManager("VCXCAT3DXModelManager").CreateExperience().done(function(){var aq=ap.getManager("VCXContextManager").getRootComponent();ap.getManager("VCXCAT3DXModelManager").CreateActor("CIDComponentCityAsset","CIDComponentCityAsset",aq).then(function(ar){ar.QueryInterface("CATI3DXAssetHolder").setLinkDescription(D);ar.SetAssetID(D);ap.getManager("CityUrbanManager").LoadAndTraverse(T,function(){O.endLoadingExperience();if(n(D,".urb")){console.warn("WARNING CITY: NEW FILE FORMAT .CTXP (deprecated .URB)")}})})})}};O.onDropExperience(ah)}}else{for(var Y=0;Y<Q.length;Y++){var T=Q[Y];var L=T.type;if(L.length){var ae=T.name;var K=new window.FileReader();K.onloadend=function(){var at=K.result;var ap=new Blob([at],{type:T.type});var av=window.URL.createObjectURL(ap);var aO=x.getManager("VCXDocManager").BuildPathFromString(av,ae);var au=x.getManager("VCXSelectionManager").GetComponentsFromSelection("PSO");if(au.length===1){var ay=au[0];var aB=ay.QueryInterface("VCXIModifiable");var aC=ay.IsKindOf("VCXComponentMesh");if(aC&&(L==="image/jpeg"||L==="image/png"||L==="image/bitmap")){var ax=x.getManager("VCXDocManager").AddOrModifyDoc(aO);var aA=new l(new m("Actor.Texture.Map.Path",1),ax);if(aA){var aG=new r(x.getManager("VCXScenarioManager"),x.getManager("VCXCommandManager"));aG.ChangeProperty(aB,aA);x.getManager("VCXCommandManager").Push(aG)}}else{var aA=null;var aq=x.getManager("VCXDocManager").AddOrModifyHyperlink(aO);aA=new l(new m("Actor.Hyperlink",0),aq);if(aA){var aG=new r(x.getManager("VCXScenarioManager"),x.getManager("VCXCommandManager"));aG.ChangeProperty(aB,aA);x.getManager("VCXCommandManager").Push(aG)}}}else{if(au.length===0){var aD=x.Factory.BuildComponent("VCXComponentPanel");var az=aD.QueryInterface("VCXIModifiable");if(az){var ax=x.getManager("VCXDocManager").AddOrModifyDoc(aO);az.OnChangeProperty("Collab.Image.Doc.ID",ax);var aI=new s();aI.SetValue(2);az.OnChangeProperty("Collab.3D.Paper.Billboard.Type",aI);var aP=new s();aP.SetValue(0);az.OnChangeProperty("Collab.Body.Shape",aP);var aF=new p();aF.SetValue(true);az.OnChangeProperty("Collab.Body.Shadow.Show",aF);var aJ=new s();aJ.SetValue(1000);az.OnChangeProperty("Collab.3D.Paper.Positioning.Type",aJ);var aQ=new q();aQ.SetValue(x.getManager("VCXDressupManager").GetDressupCount());az.OnChangeProperty("Collab.3D.Paper.Depth",aQ);var aE=new s();aE.SetValue(1);az.OnChangeProperty("Collab.3D.Paper.Size.Control.Type",aE);var aN=new q();aN.SetValue(x.getManager("VCXPaperManager").PixelToMMX(an.clientX));az.OnChangeProperty("Collab.3D.Paper.Paper.Position.X",aN);var aL=new q();aL.SetValue(x.getManager("VCXPaperManager").PixelToMMY(an.clientY));az.OnChangeProperty("Collab.3D.Paper.Paper.Position.Y",aL);var aN=new q();aN.SetValue(74.25);az.OnChangeProperty("Collab.Body.Width",aN);var aL=new q();aL.SetValue(52.5);az.OnChangeProperty("Collab.Body.Height",aL);var aK=new p(false);az.OnChangeProperty("Collab.Attach.Show",aK);var aM=new t();aM.SetValue([0]);az.OnChangeProperty("Collab.ListAnchorsIDs",aM);var ar=new c();az.OnChangeProperty("Actor.Anchor.0",ar);var aG=new f(x.getManager("VCXCommandManager"),x.getManager("VCXDressupManager"),x.getManager("VCXScenarioManager"),x.ComponentsMap);aG.AddDressups(aD);x.getManager("VCXCommandManager").Push(aG);var aH=az.GetProperties();x.getManager("VCXScenarioManager").AddNeutrals(az,aH);var aw=aD.QueryInterface("VCXIVisibility");if(aw){aw.SetVisibility(g.EVisState.Visible)}z.renderAll({updateInfinitePlane:true})}}}x.getManager("VCXGUIManager").RemoveDropZone()};K.readAsArrayBuffer(T)}else{}}}}}}}}};e.droppable(y,A);var B=document.getElementsByClassName("vcx-Curtain-Home")[0];e.droppable(B,A)},unInitialize:function(){var y=this._experienceBase.getManager("VCXContextManager");if(y.getMainViewer().canvas){var x=document.getElementById(y.getMainViewer().canvas.id);e.clean(x)}},getVersion:function(){return"1.0.2"}});Object.defineProperty(h.prototype,"componentType",{enumerable:true,get:function(){return"VCXDragDropManager"}});return h});define("DS/VCXWebComposer/VCXHyperlinkManager",["DS/Core/Core","DS/CoreEvents/Events","DS/VCXWebExperienceBase/VCXHyperlinkManagerBase","DS/VCXWebComposer/VCXUIHyperlink","DS/VCXWebKernel/VCXCmdGoToMarker","DS/WebRBTree/WebRBIterator"],function(f,a,d,c,e,b){var g=d.extend({initialize:function(){this._parent();this._strEventToListen="onPrimaryPointerClick"},postInitialize:function(){this._parent();this._vcxUIHyperlink=new c(this._experienceBase);this._bPreviewMode=this._experienceBase.getManager("VCXExperience").GetPreviewMode();var h=this;this._previewModeEvent=a.subscribe({event:"VCX_PREVIEW_MODE_CHANGED"},function(i){h._bPreviewMode=i})},unInitialize:function(){this._parent();if(this._vcxUIHyperlink){this._vcxUIHyperlink.UnsubscribeEvent();this._vcxUIHyperlink=null}a.unsubscribe(this._previewModeEvent)},ObjectHasHyperlink:function(k){var j=k.QueryInterface("VCXIModifiable");var h=null;if(j){h=j.GetProperty("Actor.Hyperlink")}if(h){var i=parseInt(h.GetPropertyValue().GetValue(),10);return i>=0}else{return false}},OpenHyperlink:function(i,u){var m=this._bPreviewMode;if(!m){return}var q=null;var k=i.GetObject().GetID();var v=false;if(this._experienceBase.getManager("VCXHotspotManager")){v=this._experienceBase.getManager("VCXHotspotManager").IsHotspot(k)}if(v){var p=this._experienceBase.getManager("VCXHotspotManager").GetHotspotFromComponentID(k);var t=p.QueryInterface("VCXIModifiable");q=this._getPropertyPathFromModifiable(t)}else{q=this._getPropertyPathFromModifiable(i)}var r=-1;if(q){var h=q.GetPathType();r=h.GetValue()}if(r===0){var n="";var j=q.GetValueURL().GetValue();if(j.indexOf("blob:")<0&&j.indexOf("ftp:")<0){n=j.toLowerCase()}if(n.indexOf("scenario://")>=0){this.OpenScenarioFromOrder(n,u)}else{this.OpenDocument(r,q,u)}}else{if(r===1){var s=this._experienceBase.ComponentsMap.GetComponentFromLink(q.GetValueLink());if(s){this.OpenScenario(s.GetID(),u)}}else{if(r===2){var l=this._experienceBase.ComponentsMap.GetComponentFromLink(q.GetValueLink());if(l.IsKindOf("VCXComponentMarker")){this.GoToMarker(l,false,true,u)}else{if(l.IsKindOf("VCXScenario")){this.PlayScenario(l,u)}}}else{if(r===3){var o=this._experienceBase.ComponentsMap.GetComponentFromLink(q.GetValueLink());if(o){this.GoToMarker(o,false,false,u)}}else{if(r===4){var l=this._experienceBase.ComponentsMap.GetComponentFromLink(q.GetValueLink());if(l&&l.IsKindOf("VCXComponentMarker")){this.GoToMarker(l,true,false,u)}else{if(l&&l.IsKindOf("VCXScenario")){this.PlayMarkerSequence(l,u)}}}else{console.log("[VCXHyperlinkeManager]: mode not found. Failed launch hyperlink.")}}}}}},OpenDocument:function(m,l,n){var k=this._getHyperlinkInfosFromProperty(l);var i=k.url;var j=k.filename;if(i.indexOf("blob:")>-1){var h=this._vcxUIHyperlink;h.CreateMediaDiv(i,j)}else{if(i.indexOf("ftp://")>-1){window.open(i)}else{window.open(i)}}if(n){n(i)}},OpenScenarioFromOrder:function(m,p){var i=m.substring(11);var k=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();var l=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(k);if(l){}else{console.log("Sequence not found !");return}var j=this._experienceBase.getManager("VCXSequenceManager").GetListSequencesFromType(0);var o="";var h=i.toLowerCase();if(h==="previous"){o=this._experienceBase.getManager("VCXSequenceManager").GetPreviousScenarioId(k)}else{if(h==="next"){o=this._experienceBase.getManager("VCXSequenceManager").GetNextScenarioId(k)}else{if(h==="first"){o=l.GetListScenariosId()[0]}else{if(h==="last"){var n=l.GetListScenariosId();var q=n.length;o=n[q-1]}}}}if(o!==""){this.OpenScenario(o,p)}},OpenScenario:function(h,i){if(this._experienceBase.getManager("VCXGUIManager").GoToScenarioContext()){this._experienceBase.getManager("VCXExperience").GoToScenarioWithInterpolation(h,i)}},PlayScenario:function(i,m){var l=this;if(i){}else{var j=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();i=this._experienceBase.ComponentsMap.GetComponentFromID(j)}var h=function(){if(i.HasAnimation()){f.Selection.PSOManager.empty();a.publish({event:"VCX_START_PLAY",});if(l._experienceBase.getManager("VCXContextManager")){if(l._experienceBase.getManager("VCXContextManager").getUrlVars().boost=="0"){}else{i.BuildAnimatedModifiablesSets(l._experienceBase.getManager("VCXScenarioManager")._keyframer)}}l._experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(true);var n=a.subscribe({event:"VCX_Timeline_STOP_PLAY"},function(){a.unsubscribe(n);i.SetSequenceMaxFrame(null)});var o=a.subscribe({event:"VCX_SCENARIO_END_REACHED"},function(){a.unsubscribe(o);if(m){m()}})}};var k=function(){var n=l._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();if(n!==i.GetID()){l.OpenScenario(i.GetID(),h)}else{h()}};if(this._bPreviewMode&&this._experienceBase.getManager("VCXPulseManager")){this._experienceBase.getManager("VCXPulseManager").StopPulse(k)}else{k()}},PlayMarkerSequence:function(k,r){var o=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();var l=this._experienceBase.ComponentsMap.GetComponentFromID(o);var i=0;if(k.IsKindOf("VCXComponentMarker")){i=k.QueryInterface("VCXIModifiable").GetProperty("Actor.TimePos").GetPropertyValue().GetValue()}else{if(k.IsKindOf("VCXScenario")){l=k}else{i=this._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame()}}var n=null;var j=l.GetTrackMarkers();if(j){var m=0;var s=j._treekeys;var p=new b(s);var q=p.next();while(q!==null){var h=q.GetFrame();if(h>i){n=h;q===null}else{m++;q=p.next()}}}if(n){l.SetSequenceMaxFrame(n)}this.PlayScenario(l,r)},GoToMarker:function(h,i,k,m){var l=this;var j=new e(l._experienceBase.getManager("VCXScenarioManager"),l._experienceBase.getManager("VCXCommandManager"),l._experienceBase.ComponentsMap);j.GoToMarker(h.GetID());j.SetCallback(m);l._experienceBase.getManager("VCXCommandManager").Push(j);if(i){l.PlayMarkerSequence(h,m)}else{if(k){l.PlayScenario(null,m)}}}});Object.defineProperty(g.prototype,"componentType",{enumerable:true,get:function(){return"VCXHyperlinkManager"}});return g});define("DS/VCXWebComposer/VCXWebAppHelper",["UWA/Class","DS/Core/Core","DS/CoreEvents/Events","DS/VCXWebComposer/VCXWebDictionary","DS/VCXWebKernelCommands/VCXCmdChangeComponent","DS/VCXWebVisualization/VCXVisuManager","DS/RuntimeView/NLSManager","DS/CoreEvents/Events","UWA/Promise"],function(a,e,d,b,f,i,j,c,g){var h=a.extend({init:function(k){this._parent();this._nlsToLoad=[];this.options=UWA.extend({},k,true)},disposeExperienceBase:function(){this._managersInitialized=false;return new g(function(k){k()})},onActionBarReady:function(){this._actionBarReady=true;if(this._actionBarReady&&this._managersInitialized){var k=this._experienceBase.getManager("VCXContextManager").getActionBar();this.onVCXActionBarReady(k)}},onVCXActionBarReady:function(k){this._experienceBase.getManager("VCXGUIManager").onVCXActionBarReady(k)},onPostInitialize:function(k){this._managersInitialized=true;if(this._actionBarReady&&this._managersInitialized){var l=this._experienceBase.getManager("VCXContextManager").getActionBar();this.onVCXActionBarReady(l)}},onFinished:function(k){var l=UWA.Promise.deferred();var n=this;this._RunLoopStarted=d.subscribe({event:"/W3A/ManagerSet/RunLoopStarted",},function(){if(n.options.onAppInitialize){n.options.onAppInitialize(n,n._experienceBase);n.options.onAppInitialize=null}d.unsubscribe(n._RunLoopStarted);delete n._RunLoopStarted});e.setFullscreen();if(n._experienceBase&&n._experienceBase._ManagerSet&&n._experienceBase._ManagerSet.getVersions){console.log(this._experienceBase._ManagerSet.getVersions())}var m=this._experienceBase.getManager("VCXGUIManager").getGettingStartedUI();if(m){m.clearInitWidget()}l.resolve();return l.promise}});h.getOptions=function(){window.useAsyncExperienceBase=true;window.enableNewTrapSelection=true;window.IR551190=true;window.IR551201=true;window.WUXEnableGSSOCache=true;var k={viewerOptions:i.getViewerOptions(),uiOptions:{displayTree:false,preserveActionBarHeight:true}};return k};return h});define("DS/VCXWebComposer/VCXHotspotManager",["DS/Core/Core","DS/CoreEvents/Events","DS/VCXWebComposer/VCXWebActorListManager","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueList","DS/VisuEvents/EventsManager","DS/WebApplicationBase/W3AAManager","DS/WebRBTree/WebRBIterator",],function(f,a,j,i,k,h,g,c,e,d){var b=j.extend({initialize:function(){this._mapHotspotsHLFromTree={};this._mapHotspotsHLFromViewport={};this._mapCacheForPreghlight={}},postInitialize:function(){var l=this;if(!this._eventTokens){this._eventTokens={}}this._eventTokens._tokenScenarioChanged=a.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(){for(var m in l._mapHotspotsHLFromTree){if(l._mapHotspotsHLFromTree.hasOwnProperty(m)){var n=l._experienceBase.ComponentsMap.GetComponentFromID(m);l.DeactivateAllHotspots();l.ActivateHotspotFromTree(n)}}});this._eventTokens._tokenPSO=a.subscribe({event:"/VISU/"},function(m){if(m.eventType==="@onMoveEvent"){if(m.from){l.onMouseOver(m,l)}else{if(m.eventID==="@pickNothing"){l.DeactivateAllHotspots(true)}}}})},unInitialize:function(){this.DeactivateAllHotspots();this._mapHotspotsHLFromTree={};this._mapHotspotsHLFromViewport={};this._mapCacheForPreghlight={};if(this._eventTokens){for(var l in this._eventTokens){if(this._eventTokens.hasOwnProperty(l)&&this._eventTokens[l]){a.unsubscribe(this._eventTokens[l])}}delete this._eventTokens}this.disposeComponentsActorListFromType(this.getConcernedComponentActorListType())},getConcernedComponentActorListType:function(){return"VCXComponentHotspot"},getComponentsActorListMapCache:function(){return this._mapCacheForPreghlight},addComponentToMapPrehighlight:function(l,n){var m=this._experienceBase.ComponentsMap.GetComponentFromID(l);this.associateComponentAndActorListToMapCache(m,n)},removeComponentFromMapPrehighlight:function(l,n){var m=this._experienceBase.ComponentsMap.GetComponentFromID(l);this.dissociateComponentAndActorListfromMapCache(m,n)},addActorsListToHotspot:function(l,m){},removeActorsListFromHotspot:function(m,n){var l=this.removeActorsListFromComponentActorList(m,n)},removeActorsListFromAllHotspots:function(l){var m=this.removeActorsListFromAllComponentsActorListOfAKind(l,this.getConcernedComponentActorListType())},getHotspotsListFromComponent:function(l){return this.getListOfComponentActorListOwningComponent(l)},IsHotspot:function(l){if(this._mapCacheForPreghlight[l]){var n=this.GetHotspotFromComponentID(l);var m=n.QueryInterface("VCXIModifiable").GetProperty("Actor.Enable").GetPropertyValue().GetValue();if(m){return true}}return false},GetHotspotFromComponentID:function(n){var o=this.getComponentsActorListMapCache()[n];var m=Object.keys(o);if(m.length>0){var l=m[0];var p=this._experienceBase.ComponentsMap.GetComponentFromID(l);return p}},onMouseOver:function(q,m){var o=q.from;if(o){var p=k.CleanPathElement(o);var n=this._experienceBase.ComponentsMap.GetComponentFromExternalPath(p);if(n){var l=this._experienceBase.getManager("VCXHotspotManager").IsHotspot(n.GetID());if(l){var s=this.GetHotspotFromComponentID(n.GetID());var r=s.QueryInterface("VCXIModifiable").GetProperty("Actor.Enable").GetPropertyValue().GetValue();if(r){f.Selection.PSOManager.empty(true);if(this._mapHotspotsHLFromViewport[s.GetID()]){}else{this.DeactivateAllHotspots(true);this.ActivateHotspotFromViewport(s)}}}else{this.DeactivateAllHotspots(true)}}}},onClickEmptySpace:function(n,l){var m=k.GetPathElementFromEvent(n,l._experienceBase);if(m){}else{l.DeactivateAllHotspots()}},ActivateHotspotFromTree:function(o){if(o&&o.IsKindOf("VCXComponentActorList")){}else{return}var m=this;var u=o.QueryInterface("VCXIModifiable");c.addEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerClick",function(v){m.onClickEmptySpace(v,m)});var r=new i(this._experienceBase.getManager("VCXSelectionManager"));r.AddToSelection(o);this._experienceBase.getManager("VCXCommandManager").Do(r);var q=u.GetProperty("Actor.Enable").GetPropertyValue().GetValue();if(!q){this._mapHotspotsHLFromTree[o.GetID()]=null;return}var n=u.GetProperty("Actor.Color").GetPropertyValue();var s=u.GetProperty("Actor.ListActors").GetPropertyValue();if(n&&s){var l=n.GetThreeColor();var t=this.createColorHL(l);this._mapHotspotsHLFromTree[o.GetID()]=t;this.addActorsToColorHL(t,s);var p=new h([t]);u.OnChangeProperty("highlight.color",p)}},ActivateHotspotFromViewport:function(n){if(n&&n.IsKindOf("VCXComponentHotspot")){}else{return}var q=n.QueryInterface("VCXIModifiable");var m=q.GetProperty("Actor.Enable").GetPropertyValue().GetValue();if(!m){return}var o=q.GetProperty("Actor.Color").GetPropertyValue();var l=q.GetProperty("Actor.ListActors").GetPropertyValue();if(o&&l){var r=o.GetThreeColor();var p=this.createColorHL(r);this.AddToMapViewport(n.GetID(),p);this.addActorsToColorHL(p,l)}},createColorHL:function(o){var l=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(l&&o){var n={color:o,outlineColor:o,intensity:0.5};var m=l.createHighlightSet(n,false);return m}},addActorsToColorHL:function(r,n){if(r){}else{return}var s=r.getColorHighlight();var m=n.GetValue();for(var p=0;p<m.length;p++){var l=m[p];var o=this._experienceBase.ComponentsMap.GetComponentFromLink(l);var q=o.QueryInterface("W3AISGNodeHolder").getPathElement();r.add(q,{highlightColor:s})}},DeactivateAllHotspots:function(m){if(m){for(var l in this._mapHotspotsHLFromViewport){if(this._mapHotspotsHLFromViewport.hasOwnProperty(l)){if(this._mapHotspotsHLFromTree[l]){}else{var n=this._experienceBase.ComponentsMap.GetComponentFromID(l);this.DeactivateHotspotFromViewport(n)}}}}else{for(var l in this._mapHotspotsHLFromTree){if(this._mapHotspotsHLFromTree.hasOwnProperty(l)){var n=this._experienceBase.ComponentsMap.GetComponentFromID(l);this.DeactivateHotspotFromTree(n)}}}},DeactivateHotspotFromTree:function(l){if(l.selected){l.selected=false;var n=new i(this._experienceBase.getManager("VCXSelectionManager"));n.RemoveFromSelection(l);this._experienceBase.getManager("VCXCommandManager").Do(n)}var m=this._mapHotspotsHLFromTree[l.GetID()];if(m){this.removeActorsFromColorHL(m);this._experienceBase.getManager("VCXContextManager").renderAll()}delete this._mapHotspotsHLFromTree[l.GetID()];if(Object.keys(this._mapHotspotsHLFromTree).length===0){c.removeEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerClick",this.onVisuEvent)}},DeactivateHotspotFromViewport:function(l){var m=this._mapHotspotsHLFromViewport[l.GetID()];if(m){this.removeActorsFromColorHL(m);this._experienceBase.getManager("VCXContextManager").renderAll()}this.RemoveFromMapViewport(l.GetID())},removeActorsFromColorHL:function(l){if(l){}else{return}l.clearAll()},UpdateHotspotsHyperlinks:function(){var s=this._experienceBase.getManager("VCXScenarioManager").GetScenarios();var n={};var o=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentHotspot");for(var B=0;B<o.length;B++){var C=o[B];var r=C.QueryInterface("VCXIModifiable");var q=this._experienceBase.getManager("VCXScenarioManager").GetNeutrals(r.GetHashing());var p=q.GetProperty("Actor.Hyperlink");if(p){var y=this._experienceBase.getManager("VCXDocManager").GetPropPath(p.GetPropertyValue().GetValue());if(y){var D=y.GetPathType().GetValue();if(D===1){var F=y.GetValueLink().GetValue();var t=this._getScenarioIDFromName(F);y.GetValueLink().SetValue(t)}}}for(var t in s){if(s.hasOwnProperty(t)){var x=s[t];var l=x.GetObjectAnimation(r.GetHashing());if(l){var w=l.GetTrack("Actor.Hyperlink");if(w){var v=w._treekeys;var A=new d(v);var E=A.next();while(E!==null){var z=E.GetValue().GetValue();var m=this._experienceBase.getManager("VCXDocManager").GetPropPath(z);if(m){var u=m.GetPathType().GetValue();if(u===1){var F=m.GetValueLink().GetValue();var t=this._getScenarioIDFromName(F);m.GetValueLink().SetValue(t)}}E=A.next()}}}}}}},_getScenarioIDFromName:function(n){var o=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);if(o[n]){return n}for(var m in o){if(o.hasOwnProperty(m)){var l=o[m].GetName();if(n===l){return m}}}},AddToMapViewport:function(m,l){this._mapHotspotsHLFromViewport[m]=l},RemoveFromMapViewport:function(l){delete this._mapHotspotsHLFromViewport[l]}});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXHotspotManager"}});return b});define("DS/VCXWebComposer/VCXExperienceSaver",["DS/VCXWebExperienceLoader/VCXExperienceSaverBase","DS/VCXWebKernelTools/VCXFileWriter","DS/VCXWebComposer/VCXBlobDumper"],function(d,c,b){var a=d.extend({init:function(){this._parent();this._blobDumper=new b()},Save:function(f,h){var g=this;var e=function(){g.SaveToJson(f,h)};this._blobDumper.ConvertBlobsFromDocManager(f,e)},SaveToJson:function(l,o){var e={};e.FileVersion=1;e.VCXObjects=this._ComponentsMapToJson(l);e.VCXAssetsHolder=this._AssetHolderMapToJson(l);if(!l.getManager("VCXContextManager").getCityMode()){e.W3AISGNodeHolder=this._W3AISGNodeHolderToJson(l)}e.VCXIModelNavigable=this._VCXIModelNavigableToJson(l);e.MetaPropertiesDef=this._MetaPropertiesDefToJson(l);e.ScenarioSequences=this._SequencesToJson(l);e.neutrals=this._NeutralsToJson(l);e.listScenarios=this._ScenariosToJson(l);e.DocManager=this._DocManagerToJson(l);e.EmbeddedData=this._EmbeddedDataToJson();var n=JSON.stringify(e,null,4);var g="data:text/json;charset=utf8,"+encodeURIComponent(n);var f="SaveExperience";if(l&&l.getManager("VCXContextManager")){var k=l.getManager("VCXContextManager").getRootComponentName();if(k){f=k}else{var i=new Date();f+="-";f+=i.getUTCFullYear();f+=i.getUTCMonth();f+=i.getUTCDate();f+=i.getUTCHours();f+=i.getUTCMinutes();f+=i.getUTCSeconds()}}if(l.getManager("VCXContextManager").getCityMode()){f+=".ctps"}else{if(l.getManager("VCXContextManager").getProdHighMode()){f+=".exprd"}else{f+=".json"}}var m=l.getManager("VCXCAT3DXModelManager");if(m){var j=m.GetApplicationMode();if(m&&j===2){m.PushStream(g,f).done(function(){console.log("Experience "+f+" Saved");if(o){o()}});return}}var h=new c();h.saveAs(g,f);if(o){o()}},_AssetHolderMapToJson:function(m){var j=[];var n=m.ComponentsMap.GetComponentTable();for(var f in n){if(n.hasOwnProperty(f)){var l=n[f];var k=l.GetPersistency();if(k!==0){continue}var h=l.QueryInterface("CATI3DXAssetHolder");if(!h){continue}var g={};g.objectID=f;g.linkDescription=h.getLinkDescription();if(g.linkDescription===null){continue}var o=h.getLinkContext();if(o){var e=o.getJSONDescription();if(e){g.linkContextDescription=e}}var i=null;if(l.BuildLoadData){i=l.BuildLoadData()}if(i){g.objectData=i}j.push(g)}}return j},_GetStartingScenario:function(e){var l="";var k=e.getManager("VCXSequenceManager").GetListSequences();if(k.length!==0){var j=k[0].GetListScenariosId();for(var h=0;h<j.length;h++){var g=j[h];var f=e.ComponentsMap.GetComponentFromID(g);if(f.GetPersistency()===0){return g}}}else{console.log("VCXExperienceSaver: The sequence list is empty !")}return l},_SequencesToJson:function(e){var j=[];var l=e.getManager("VCXSequenceManager").GetListSequences();for(var g=0;g<l.length;g++){var m=l[g];var f=m.GetID();var k=m.GetListScenariosId();var h={objectID:f,listScenarioID:k};j.push(h)}return j},_ScenariosToJson:function(k){var j=[];var e=k.getManager("VCXScenarioManager").GetScenarios();for(var l in e){if(e.hasOwnProperty(l)){var f=e[l];var i=f.GetPersistency();if(i!==0){continue}var g=this._ScenarioToJson(k,f);var h=f.GetVisibility();var m=this._VisibilityToJson(h,k);g.visibility=m;j.push(g)}}return j},_DocManagerToJson:function(m){var f={};var n=[];var e=m.getManager("VCXDocManager").NumberOfDoc();for(var k=0;k<e;k++){var j=m.getManager("VCXDocManager").GetPropPath(k);if(j){if(j.GetValueBool()){var l=j.GetValueBool().GetValue();if(l){var h=this._PropertyToJson(j,m);n.push({type:"VCXPropertyValuePath",value:h})}}}}var g=m.getManager("VCXDocManager").QueryInterface("VCXIModifiable");f.array=n;return f},_EmbeddedDataToJson:function(){var e=this._blobDumper.GetMapOfData();return e},DumpScenario:function(m,k){var i=this._ScenarioToJson(m,k);var j=k.GetVisibility();var l=this._VisibilityToJson(j,m);var f={Scenario:i,Visibility:l};var n=JSON.stringify(f,null,4);var g="data:text/json;charset=utf8,"+encodeURIComponent(n);var e="Scenario.json";var h=new c();h.saveAs(g,e)},DumpComponentsMapContent:function(p,h){var m=[];var l=[];var j=[];var g=p.ComponentsMap.GetComponentTable();for(var t in g){if(g.hasOwnProperty(t)){var s=g[t];var e=s.GetType();var f=s.GetLoadData();var w={};w.objectID=t;w.objectType=e;var f=null;var r=s.QueryInterface("W3AISGNodeHolder");if(r){var q=r.getPathElement();f=this._BuildArrayIDsFromPathElement(q)}if(f&&f.length>0){w.objectData=f}var v=s.GetPersistency();if(v===0){m.push(w)}else{if(v===1){l.push(w)}else{if(v===2){j.push(w)}}}}}var o={Persistency0:m,Persistency1:l,Persistency2:j};var n=JSON.stringify(o,null,4);var i="data:text/json;charset=utf-8,"+encodeURIComponent(n);var u="";if(h){u=h+".json"}else{u="ComponentsMap.json"}if(p.odt==="record"){}else{var k=new c();k.saveAs(i,u)}return{obj:o,url:i,filename:u}},DumpArray:function(e,h,f){var g={MyArray:h};return this.DumpObject(e,g,f)},DumpPropertyMap:function(e,h,g){var f=this._PropMapToJson(e,h);return this.DumpObject(e,f,g)},DumpObject:function(e,j,h){var i=new Object();j.toJSON=function(){var m=Object.keys(this);m.sort();for(var o=0;o<m.length;o++){var n=m[o];if(n!=="toJSON"){i[n]=this[n]}}return i};var l=JSON.stringify(j,null,4);var g="data:text/json;charset=utf-8,"+encodeURIComponent(l);var f="";if(h){f=h+".json"}else{f="MapObject.json"}if(e.odt==="record"||e.odt==="replay"){}else{var k=new c();k.saveAs(g,f)}return{obj:i,url:g,filename:f}},_DumpPropMapDiff:function(g,e,j){var f={};for(var m in g){if(g.hasOwnProperty(m)){var i=g[m];for(var h in i){if(i.hasOwnProperty(h)){var k=i[h].vcxPropertyRef;var l=i[h].vcxProperty;g[m][h].vcxPropertyRef=this._PropertyToJson(k.GetPropertyValue(),j);g[m][h].vcxProperty=this._PropertyToJson(l.GetPropertyValue(),j)}}}}this.DumpObject(g,e)},});return a});define("DS/VCXWebComposer/VCXSelectionSetManager",["DS/CoreEvents/Events","DS/VCXWebComposer/VCXWebActorListManager","DS/WebApplicationBase/W3AAManager",],function(a,b,d){var c=b.extend({initialize:function(){this._mapCacheComponentSelectionSet=null},postInitialize:function(){var e=this;this._mapCacheComponentSelectionSet={};if(!this._eventTokens){this._eventTokens={}}},unInitialize:function(){for(var e in this._eventTokens){if(this._eventTokens.hasOwnProperty(e)&&this._eventTokens[e]){a.unsubscribe(this._eventTokens[e])}}this.disposeComponentsActorListFromType(this.getConcernedComponentActorListType());this._mapCacheComponentSelectionSet=null},getConcernedComponentActorListType:function(){return"VCXComponentSelectionSet"},getComponentsActorListMapCache:function(){return this._mapCacheComponentSelectionSet},addComponentToMapSelectionSet:function(e,f){this.associateComponentAndActorListToMapCache(e,f)},removeComponentFromMapSelectionSet:function(e,f){this.dissociateComponentAndActorListfromMapCache(e,f)},addActorsListToSelectionSet:function(e,f){},removeActorsListFromSelectionSet:function(f,g){var e=this.removeActorsListFromComponentActorList(f,g)},removeActorsListFromAllSelectionSets:function(f){var e=this.removeActorsListFromAllComponentsActorListOfAKind(f,this.getConcernedComponentActorListType())},isComponentBelongingToASelectionSet:function(e){return this.isComponentBelongingToMapCache(e)},getSelectionSetListFromComponent:function(e){return this.getListOfComponentActorListOwningComponent(e)},});Object.defineProperty(c.prototype,"componentType",{enumerable:true,get:function(){return"VCXSelectionSetManager"}});return c});