/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define("DS/PIMwebUX/PIMwebOpacitySlider",["UWA/Core","UWA/Class","DS/Controls/Slider","DS/Controls/Button","DS/WebappsUtils/WebappsUtils"],function(c,f,d,a,e){var b=e.getWebappsAssetUrl("PIMwebUX","icons/32/");return f.extend({init:function(q){var l=this,g=q.parent,h,n,p,m,i=false,k=q.userValue,j=q.checkedButton===1?1:q.checkedButton===2?2:0,o=j===1?0:j===2?100:k;h=new c.Element("div",{"class":"pimWebOpacitySlider","data-rec-id":"pimWebOpacitySlider",styles:{position:"absolute",display:"none",margin:"1px auto"}});g.appendChild(h);n=new a({label:"",checkFlag:j===1,icon:b+"I_PIMOpacity0.png",displayStyle:"icon",recId:"btn1"}).inject(h);n.onClick=function(){n.checkFlag=!n.checkFlag;j=n.checkFlag?1:0;p.checkFlag=false;i=true;m.value=n.checkFlag?0:k};m=new d({minValue:0,maxValue:100,stepValue:1,value:o,disabled:false,recId:"slider"}).inject(h);m.elements.container.setStyle("display","inline-flex");m.elements.container.setStyle("margin","1px 10px 2px 10px");m.elements.container.setStyle("width","300px");m.elements.container.getChildren()[0].setStyle("width","100%");m.addEventListener("change",function(s){if(!i){p.checkFlag=false;n.checkFlag=false;j=0;k=s.dsModel.value}i=false;if(o!==s.dsModel.value){var r=o;o=s.dsModel.value;if(typeof l.onOpacityChange==="function"){l.onOpacityChange({oldValue:r,newValue:o,userValue:k,checkedButton:j})}}m.elements.container.getChildren()[0].setStyle("width","100%");m.elements.container.getChildren()[0].setStyle("width","100%")});p=new a({label:"",checkFlag:j===2,icon:b+"I_PIMOpacity1.png",displayStyle:"icon",recId:"btn2"}).inject(h);p.onClick=function(){p.checkFlag=!p.checkFlag;j=p.checkFlag?2:0;n.checkFlag=false;i=true;m.value=p.checkFlag?100:k};this.show=function(){h.setStyle("display","inline-block")};this.hide=function(){h.setStyle("display","none")};this.onOpacityChange=null;this.setPosition=function(r){h.setStyles(r)};this.destroy=function(){if(h&&h.parentNode){h.parentNode.removeChild(h)}l.onOpacityChange=null;l=h=g=n=p=m=null}}})});define("DS/PIMwebUX/PIMwebItfListUI",["UWA/Core","UWA/Class","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/Tweakers/TypeRepresentationFactory","DS/Core/PointerEvents","DS/TreeModel/TreeNodeModel","i18n!DS/PIMwebUX/assets/nls/PIMwebItfListUI","css!DS/PIMwebUX/assets/css/PIMwebItfListUI"],function(i,j,f,c,b,g,e,h){var a=new b(),d=["onDragStartCell","onDragEndCell","onDragCell","onDragOverCell","onDragOverBlank","onDragEnterBlank","onDragLeaveBlank","onDragStartColumnHeader","onDragEndColumnHeader"];a.onReady=function(){var k={},m={},l={};k[h.itfClash]="Clash";k[h.itfContact]="Contact";k[h.itfClearance]="Clearance";k[h.itfNoInterference]="NoInterference";k[h.itfUndefined]="Undefined";a.registerEnum("EnumItfType",k);m[h.itfOK]="OK";m[h.itfKO]="KO";m[h.itfToAnalyze]="NotAnalyzed";a.registerEnum("EnumItfStatus1",m);l[h.itfOK]="OK";l[h.itfKO]="KO";l[h.itfToReAnalyze]="NotAnalyzed";a.registerEnum("EnumItfStatus2",l)};return j.extend({init:function(l){var r,p="tree",q="asc",n={},z,k,B=l.readOnly,A=l.cbDnD?l.cbDnD:{},v=l.parent,y=this,m=Object.keys(A);m.forEach(function(D){if(d.indexOf(D)===-1||typeof A[D]!=="function"){delete A[D]}});this.onShowColumnComplete=function(D){k.getManager().showColumn(D)};function x(F){if(B){return}var D=[],E={};E[F.dataIndex]=F.value;if(F.dataIndex==="tree"){F.nodeModel.updateOptions({label:F.value});D.push(F.nodeModel)}else{if(F.dataIndex==="itfUserType"||F.dataIndex==="itfAnalysis"){var G=this;D=G.getSelectedRows().map(function(H){return G.getTreeNodeModelFromRowID(H)});z.withTransactionUpdate(function(){D.forEach(function(H){H.updateOptions({grid:E})})})}else{F.nodeModel.updateOptions({grid:E});D.push(F.nodeModel)}}D.forEach(function(H){if(typeof H.onAttributeChangeFromUI==="function"){H.onAttributeChangeFromUI({dataIndex:F.dataIndex,newValue:F.value})}})}function o(I){var F=I.dataIndex,D,E="EnumItfType",G=I.cellModel.options.value;if((F!=="itfAnalysis"&&F!=="itfUserType")||I.isHeader||!G){return}var J=document.createElement("div"),H=document.createElement("div");J.setAttribute("style","display:flex");J.appendChild(H);H.className="pimWebColor"+G;H.setAttribute("style","position:relative;left:-3px;min-width: 5px;");if(I.dataIndex==="itfAnalysis"){D=I.nodeModel.options.grid.itfPrevAnalysis;E=D==="OK"||D==="KO"?"EnumItfStatus2":"EnumItfStatus1"}a.generateView(I.cellModel.options.value,{typePath:E,readOnly:B,onViewCreated:function(K){K.getContent().setStyles({width:"100%",position:"relative",left:"-1px"});K.addEventListener(g.POINTERDOWN,function(M){var L=I.manager.getSelectedRows();if(L.indexOf(I.data.rowID)>-1){M.stopPropagation()}});K.addEventListener(g.POINTERUP,function(M){var L=I.manager.getSelectedRows();if(L.indexOf(I.data.rowID)>-1){M.stopPropagation()}});J.appendChild(K.getContent());I.cellView.getContent().setContent(J)}})}function w(D){setTimeout(function(){if(Array.isArray(D)&&typeof y.onSelect==="function"){D.forEach(function(E){y.onSelect(E.options.grid.itfuid)})}},0)}function u(D){setTimeout(function(){if(Array.isArray(D)&&typeof y.onUnselect==="function"){D.forEach(function(E){y.onUnselect(E.options.grid.itfuid)})}},0)}function t(){var D=k.getManager().getColumns().map(function(E){return{dataIndex:E.dataIndex,width:E.width,isHidden:E.isHidden===true?true:undefined}});localStorage.setItem("PIMwebItfListColPref",JSON.stringify({version:0,columns:D,sort:p+"-"+q}))}function s(){if(r){return}var E={tree:{dataIndex:"tree",text:h.tree,isEditable:!B,setValue:x,width:"15%"},itfSystemType:{dataIndex:"itfSystemType",text:h.itfSystemType,isEditable:false,width:"auto"},itfUserType:{dataIndex:"itfUserType",text:h.itfUserType,isEditable:false,onCellRequest:o,setValue:x,width:"auto"},itfAnalysis:{dataIndex:"itfAnalysis",text:h.itfAnalysis,isEditable:false,onCellRequest:o,setValue:x,width:"auto"},itfInstance1Label:{dataIndex:"itfInstance1Label",text:h.itfInstance1Label,isEditable:false,width:"auto"},itfInstance2Label:{dataIndex:"itfInstance2Label",text:h.itfInstance2Label,isEditable:false,width:"auto"},itfQuantifier:{dataIndex:"itfQuantifier",text:h.itfQuantifier,isEditable:false,width:"auto"},itfDescription:{dataIndex:"itfDescription",text:h.itfDescription,isEditable:!B,setValue:x,width:"auto"},itfPrevAnalysis:{dataIndex:"itfPrevAnalysis",text:h.itfPrevAnalysis,isEditable:false,width:"auto"},itfTolerance:{dataIndex:"itfTolerance",text:h.itfTolerance,isEditable:false,width:"auto"},itfOwner:{dataIndex:"itfOwner",text:h.itfOwner,isEditable:false,width:"auto"},itfMetricName:{dataIndex:"itfMetricName",text:h.itfMetricName,isEditable:!B,setValue:x,width:"auto"},itfCurrent:{dataIndex:"itfCurrent",text:h.itfCurrent,isEditable:false,width:"auto"}},D=["tree","itfSystemType","itfUserType","itfAnalysis","itfPrevAnalysis","itfInstance1Label","itfInstance2Label","itfQuantifier","itfDescription","itfTolerance","itfOwner","itfMetricName","itfCurrent"];var J=JSON.parse(localStorage.getItem("PIMwebItfListColPref")),I=[],G=J&&J.columns?J.columns:null;if(Array.isArray(G)){for(var H=0;H<G.length;++H){if(D.indexOf(G[H].dataIndex)===-1){G.splice(H,1);H--}else{i.merge(G[H],E[G[H].dataIndex]);I.push(G[H].dataIndex)}}D.forEach(function(K){if(I.indexOf(K)===-1){G.push(i.merge({},E[K]))}})}else{G=D.map(function(K){return E[K]})}r=G;if(J&&J.sort){var F=J.sort.split("-");if(F&&F.length!==2){F=null}if(F){if(D.indexOf(F[0])>-1){p=F[0]}if(F[1]==="asc"||F[1]==="desc"){q=F[1]}}}}function C(){s();var I=Object.keys(A),G=I.length>0;z=new c({useAsyncPreExpand:false,shouldAcceptDrag:function(){return G},shouldAcceptDrop:function(){return false}});var F={treeDocument:z,columns:r,isSortable:true,enableActiveUI:true,enableKeyboardNavigation:true,isEditable:true,allowUnsafeHTMLContent:false,selection:{toggle:false,preSelection:true,enableListSelection:true},resize:{columns:true,rows:false},show:{rowHeaders:false,columnHeaders:true},height:"auto",shouldAcceptDrag:function(){return G},shouldAcceptDrop:function(){return false},onContextualEvent:{callback:function E(L){var K=[];if(L&&L.treeview){if(L.treeview.virtualRowID===-1){K.push({type:"PushItem",title:h.itfFitColumn,action:{callback:function(){L.treeview.manager.sizeColumnToFit(L.treeview.dataIndex);t()}}});K.push({type:"PushItem",title:h.itfHideColumn,action:{callback:function(){L.treeview.manager.hideColumn(L.treeview.dataIndex)}}});var J=L.treeview.manager.getColumns();J=J.filter(function(M){return L.treeview.manager.isColumnHidden(M.dataIndex)});if(J.length>0){K.push({type:"PushItem",title:h.itfShowAllColumns,action:{callback:function(){var M=L.treeview.manager.getColumns();M.forEach(function(N){if(L.treeview.manager.isColumnHidden(N.dataIndex)){L.treeview.manager.showColumn(N.dataIndex)}})}}});K.push({type:"PushItem",title:h.itfShowColumn,action:{callback:function(){var M=J.map(function(N){return{label:N.text,value:N.dataIndex}});y.onShowColumn(M)}}})}}}return K}}};I.forEach(function(J){F[J]=A[J]});A=null;k=new f(F);k.getContent().addClassName("pimWebTreeListView");v.content=k;var H=k.getManager();k.getManager().onReady(function(){H.sortColumnContent(p,{sortOrder:q});H.onMoveColumn(t);H.onColumnVisibilityChange(t);H.onSortColumnContent(function(J){p=J.columnDataIndex;q=J.sortOrder;t()})});var D=H.getNodesXSO();D.onPostAdd(w);D.onPostRemove(u)}this.addInterferences=function(F,D){if(!F||!Array.isArray(F)){return}var E=[];F.forEach(function(H){if(!n.hasOwnProperty(H.itfuid)){var G=new e({label:H.itfCtxName,grid:H});if(D){if(typeof D.onAttributeChange==="function"){G.onAttributeChangeFromUI=function(I){var J={id:H.itfuid,param:I.dataIndex==="tree"?"itfCtxName":I.dataIndex,newValue:I.newValue};D.onAttributeChange(J)}}}n[H.itfuid]=G;E.push(G)}});z.withTransactionUpdate(function(){z.addRoot(E);k.getManager().sortColumnContent(p,{sortOrder:q})})};this.updateInterferences=function(F,D){var E=[];z.withTransactionUpdate(function(){F.forEach(function(G){if(n.hasOwnProperty(G.itfuid)){n[G.itfuid].updateOptions({label:G.itfCtxName,grid:G})}else{E.push(G)}});if(E.length>0){y.addInterferences(E,D)}})};this.removeInterferences=function(D){var E=Array.isArray(D)?D:[D];z.withTransactionUpdate(function(){E.forEach(function(F){if(n.hasOwnProperty(F)){z.removeRoot(n[F]);delete n[F]}})})};this.getSelectedInterferences=function(){var D=k.getManager();return D.getSelectedRows().map(function(E){return D.getTreeNodeModelFromRowID(E).options.grid.itfuid})};this.getSelectedRows=function(){return k.getManager().getSelectedRows()};this.selectRows=function(E){var F=k.getManager(),D=E.map(function(G){return F.getTreeNodeModelFromRowID(G)});z.withTransactionUpdate(function(){F.getNodesXSO().empty();F.getNodesXSO().add(D)})};this.getNumberOfRows=function(){return k.getManager().getNumberOfRows()};this.toggleReadOnly=function(){z.withTransactionUpdate(function(){B=!B;r.forEach(function(D){if(D.dataIndex==="tree"||D.dataIndex==="itfDescription"||D.dataIndex==="itfMetricName"){D.isEditable=!B}})})};this.onSelect=null;this.onUnselect=null;this.onShowColumn=null;C()}})});