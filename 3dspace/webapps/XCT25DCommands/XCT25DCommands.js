define("DS/XCT25DCommands/XCT25DExperienceSearch",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Utils/InterCom"],function(h,f,e,c){var d="default_search_criteria";var b="widget_id";var a="app_socket_id";var g=f.extend({init:function(i){this.options={OPT_DEFAULT_SEARCH_CRITERIA:"#all",default_with_precond:true,idcard_activated:false,itemViewClickHandler:"",mode:"default",multiSel:false,precond:"",role:"",search_delegation:"3dsearch",select_result_max_idcard:false,show_precond:false,title:"Fast Search for Media Images"};this.options[b]=i[b];this.options[a]=i[a];this.socket=new c.Socket(this.options[a],{dispatchRetryInterval:0});this.socket.subscribeServer("SearchComServer");this.registerContext()},registerContext:function(){this.socket.dispatchEvent("RegisterContext",this.options);this.socket.addListener("Selected_Objects_search",this.handleSelectedObjects.bind(this))},triggerSearch:function(){if(h.is(this.socket)){this.socket.dispatchEvent("InContextSearch",this.options)}else{}},triggerSearchWithCriteria:function(j,i){this.options[d]=j;this.callback=i;this.triggerSearch()},unregisterSearchContext:function(){this.socket.dispatchEvent("UnregisterContext",{OPT_WIDGET_ID:this.options.widget_id});this.socket.disconnect();delete this.socket},handleSelectedObjects:function(i){this.callback(i)}});return g});define("DS/XCT25DCommands/XCT25DFullscreenFunction",["UWA/Core","UWA/Class"],function(c,b){var a=b.extend({init:function(e){this._handleKeyEvent=this._handleKeyEvent.bind(this);this._onFullscreenChange=this._onFullscreenChange.bind(this);this._updateElements=this._updateElements.bind(this);if(widget.id){this._document=parent.document;this._frame=this._document.getElementById("frame-"+widget.id);this._element=this._frame.parentNode}else{this._document=document;var d=e.getViewer||e.getViewerFrame;d=d.bind(e);this._findParentWrapper(d().canvas)}document.addEventListener("keypress",this._handleKeyEvent,false);this._listenFullscreenChange()},execute:function(){this._toggleFullScreen(this._element)},_findParentWrapper:function(d){if(d.id==="canvas-div"){this._element=d}else{this._findParentWrapper(d.getParent())}},_getFullscreenElement:function(){return this._document.fullscreenElement||this._document.msFullscreenElement||this._document.mozFullScreenElement||this._document.webkitFullscreenElement},_getFullscreenEnabled:function(){return this._document.fullscreenEnabled||this._document.mozFullScreenEnabled||this._document.webkitFullscreenEnabled},_handleKeyEvent:function(d){if((d.keyCode===0)||(d.keyCode===32)){this._toggleFullScreen(this._element)}},_toggleFullScreen:function(d){if(this._getFullscreenElement()){this._exitFullscreen()}else{if(d.requestFullscreen){d.requestFullscreen()}else{if(d.msRequestFullscreen){d.msRequestFullscreen()}else{if(d.mozRequestFullScreen){d.mozRequestFullScreen()}else{if(d.webkitRequestFullscreen){d.webkitRequestFullscreen()}}}}}},_exitFullscreen:function(){if(this._document.exitFullscreen){this._document.exitFullscreen()}else{if(this._document.msExitFullscreen){this._document.msExitFullscreen()}else{if(this._document.mozCancelFullScreen){this._document.mozCancelFullScreen()}else{if(this._document.webkitExitFullscreen){this._document.webkitExitFullscreen()}}}}widget.requestView({type:"windowed"})},_listenFullscreenChange:function(){var d=this;this._document.addEventListener("fullscreenchange",function(){d._onFullscreenChange()},false);this._document.addEventListener("mozfullscreenchange",function(){d._onFullscreenChange()},false);this._document.addEventListener("webkitfullscreenchange",function(){d._onFullscreenChange()},false);this._document.addEventListener("MSFullscreenChange",function(){d._onFullscreenChange()},false)},_onFullscreenChange:function(){if(!this._frame){return}this._updateElements()},_updateElements:function(){if(this._getFullscreenElement()){widget.body.setStyle("width",screen.width+"px");widget.body.setStyle("height",screen.height+"px");this.origWidth=this._frame.width;this.origHeight=this._frame.height;this._frame.width=screen.width;this._frame.height=screen.height}else{widget.body.setStyle("width","inherit");widget.body.setStyle("height",this.origHeight+"px");this._frame.width=this.origWidth;this._frame.height=this.origHeight}},onEnd:function(){document.removeEventListener("keypress",this.handleKeyEvent,false)}});return a});define("DS/XCT25DCommands/XCT25DSwitchVariantsFunction",["UWA/Core","UWA/Class","DS/ApplicationFrame/Command","DS/Layouts/ListView","DS/Controls/TileCellView","DS/Controls/ThumbnailCellView","css!DS/XCT25DExperience/XCT25DExperience"],function(g,f,b,a,e){const c=100;var d=f.extend({init:function(h){this._cellClickHandler=this._cellClickHandler.bind(this);this.updateList=this.updateList.bind(this);this.frameWindow=h;var i=h.getViewer||h.getViewerFrame;i=i.bind(h);this.viewer=i();this._listenFullscreenChange()},updateList:function(){var h=this;if(this.hasVariants()){this._generateGridData(this.getVariants(),function(i){h.gridData=i})}else{this.gridData=null}},_listenFullscreenChange:function(){var h=this;document.addEventListener("fullscreenchange",function(){h._calculateVariantListPosition()},false);document.addEventListener("mozfullscreenchange",function(){h._calculateVariantListPosition()},false);document.addEventListener("webkitfullscreenchange",function(){h._calculateVariantListPosition()},false);document.addEventListener("msfullscreenchange",function(){h._calculateVariantListPosition()},false)},_generateGridData:function(h,q){var o=this.getPlayer();var n=o.loader;var k=o.asset;var r=[];var l=[];for(var p in h){if(p!=="name"){var m=h[p];var i=this._getFirstStateIndexByTransition(k.transitions,m,0);var j=k.states[i][0];l.push(j);r.push({title:p,picture:j})}}n.makeFilePaths(l,function(t){for(var s=0;s<t.length;s++){r[s].picture=URL.createObjectURL(new Blob([t[s]]))}q(r)})},_getFirstStateIndexByTransition:function(k,h,i){var j;i=i||0;if(k[i].hasOwnProperty(h)){j=k[i][h];return j}else{i=i>0?i+1:1;return this._getFirstStateIndexByTransition(k,h,i)}},beginExecute:function(){this.doSwitchVariants=true;this.mySwitchVariantsContainer=new g.Element("div",{Class:"CmdSwitchVariants-Container"});this.listView=new a({model:this.gridData,defaultCellHeight:c,cellClass:e}).inject(this.mySwitchVariantsContainer);var h=this;this.listView.onCellRequest(function(i){if(h.gridData[i.virtualRowID]!==undefined){i.cellView.getContent().setStyles({width:"100%"});i.cellView.getContent().getChildren()[0].setStyles({minWidth:"100%"});i.cellView.setPicture(i.cellModel.picture);i.cellView.setTitle(i.cellModel.title)}});this.listView.onCellClick(this._cellClickHandler);this.mySwitchVariantsContainer.inject(this.getFrameWindow().getUIFrame());this._calculateVariantListPosition();this.mySwitchVariantsContainer.toggleClassName("open")},_calculateVariantListPosition:function(){var i=document.getElementsByClassName("CmdSwitchVariants-Container")[0];if(i){var h=c*this.gridData.length+2;var j=this.frameWindow.elements.container.clientHeight;if(h>j){h=j-120}i.style.height=h+"px";i.style.top=(j-h)/2+"px"}},_cellClickHandler:function(h){this.getPlayer().switchVariant(h.cellModel.title)},endExecute:function(){this.doSwitchVariants=false;if(this.mySwitchVariantsContainer){this.mySwitchVariantsContainer.toggleClassName("close");this.cleanUp()}},cleanUp:function(){if(!this.doSwitchVariants){if(this.mySwitchVariantsContainer.parentNode){this.getFrameWindow().getUIFrame().removeChild(this.mySwitchVariantsContainer)}}},getFrameWindow:function(){return this.frameWindow},getPlayer:function(){return this.frameWindow.experience.player},getVariants:function(){var h=this.getPlayer();if(h&&h.sequence){return h.sequence.variants}return false},hasVariants:function(){var h=this.getVariants();if(!h){return false}else{return Object.getOwnPropertyNames(h).length>0}}});return d});define("DS/XCT25DCommands/XCT25DCommands",[],function(){});define("DS/XCT25DCommands/XCT25DFullscreenCmd",["DS/ApplicationFrame/Command","DS/XCT25DCommands/XCT25DFullscreenFunction"],function(b,a){return b.extend({init:function(c){this._parent(c,{isAsynchronous:false,isEnabled:true,mode:"shared"});this.frameWindow=this.getFrameWindow();this.exp=new a(this.frameWindow)},execute:function(){return this.exp.execute()}})});define("DS/XCT25DCommands/XCT25DExperienceSearchCmd",["DS/ApplicationFrame/Command","DS/XCT25DCommands/XCT25DExperienceSearch","DS/XCT25DCommands/XCT25DFullscreenFunction","DS/XCT25DExperience/XCTModelLoader","DS/XCT25DExperience/XCT25DConfig"],function(d,e,a,c,b){return d.extend({init:function(f){this._parent(f,{isAsynchronous:false,mode:"shared"});this.widget=f;if(this.widget.ID){this.search=new e({widget_id:this.widget.ID,app_socket_id:"25d_viewer_experience_search_socket"})}this.modelLoader=new c(this);this.exp=new a(this.getFrameWindow())},execute:function(){return this._openExperienceBrowser(undefined,this._handleSelectedExperience.bind(this))},_openExperienceBrowser:function(g,f){if(this.exp._getFullscreenElement()){this.exp._exitFullscreen()}if(g){this.search.triggerSearchWithCriteria(g,f)}else{this.search.triggerSearchWithCriteria(b.SEARCH_STRING_MEDIA_TYPE,f)}},_handleSelectedExperience:function(){if(this.fullscreen){this.exp._toggleFullScreen(this.exp._element)}}})});define("DS/XCT25DCommands/XCT25DSwitchVariantsCmd",["DS/Core/Core","DS/ApplicationFrame/Command","DS/XCT25DCommands/XCT25DSwitchVariantsFunction"],function(c,b,a){return b.extend({init:function(d){this._parent(d,{isAsynchronous:true,isEnabled:false,mode:"shared"});this.frameWindow=this.getFrameWindow();this.onLoadingStarted=this.onLoadingStarted.bind(this);this.onActionBarOpen=this.onActionBarOpen.bind(this);this.onActionBarClose=this.onActionBarClose.bind(this);c.Events.subscribe({event:"ASSET/LOADINGSTARTED"},this.onLoadingStarted);this.frameWindow.getActionBar().onActionBarOpen(this.onActionBarOpen);this.frameWindow.getActionBar().onActionBarClose(this.onActionBarClose);this.exp=new a(this.frameWindow)},updateEnabled:function(){this.disable();this.end(true);if(this.exp.hasVariants()){this.enable();this.exp.updateList()}},beginExecute:function(){return this.exp.beginExecute()},endExecute:function(){if(this._isRunning){return this.exp.endExecute()}return false},onLoadingStarted:function(){this.updateEnabled()},onActionBarOpen:function(){},onActionBarClose:function(){this.end(true)}})});