define("DS/Units/Units",["UWA/Controls/Abstract","UWA/Core","DS/WebappsUtils/WebappsUtils"],function(h,j,d){var k=false;var a={usi:[{unit:"g",useSubUnits:true},{unit:"m",useSubUnits:true},{unit:"deg",useSubUnits:false},{unit:"rad",useSubUnits:false}],listOfUnits:{},usiConversion:{from:["rad","deg"],to:["deg","radian"],factor:[function l(n){return n*180/Math.PI%360},function b(n){return(n%360)*Math.PI/180}]}};var e={from:["miles","radian","degree","degree","degree"],to:["kilometer","degree","grade","quadrant","radian"],factor:[1.609344,function l(n){return n*180/Math.PI%360},1,1111,function b(n){return(n%360)*Math.PI/180}]};var c=["k","h","da","","d","c","m"];var m={k:1000,h:100,da:10,d:0.1,c:0.01,m:0.001};a.usi.forEach(function(o,n){if(o.useSubUnits){c.forEach(function(q,p){var r=q+o.unit;a.listOfUnits[r]=o.unit})}else{a.listOfUnits[o.unit]=o.unit}});var i;function g(o,p){var n=o.charAt(o.indexOf("value")+1);var q=parseFloat(o.substr(o.indexOf(n)+1));switch(n){case"*":return p*q;case"/":return p/q;default:console.log("Operateur non reconnu")}}var f=h.extend({defaultOptions:{unit:"",_unitIndex:null,value:null},init:function(n){this._parent(n);this.options.unit=this.options.unit.toLowerCase()},to:function(q){var v=this.options.unit;var o=q;var p=a.listOfUnits[v];var C=a.listOfUnits[o];var n=parseFloat(this.options.value,10);var A;var z,r,t;if(p){if(v!==p){var y=v.replace(new RegExp(p+"$"),"");if(k){console.info("Unit",v,"is a subunit of",p,"with prefix:",y)}z=m[y]*n;if(k){console.warn("[1]",n,v,"-->",z,p)}}else{z=n}if(p!==C){var s,B;for(var x=0;x<a.usiConversion.from.length&&!B;x++){if(a.usiConversion.from[x]===p&&a.usiConversion.to[x]===C){s=x;B=true}}if(B){if(k){console.warn("Will convert from",p,"to",a.usiConversion.to[s],s,"with conversion factor",a.usiConversion.factor[s])}if(s>=0){switch(typeof a.usiConversion.factor[s]){case"function":t=a.usiConversion.factor[s](parseFloat(this.options.value,10));break;default:t=parseFloat(this.options.value,10)/a.usiConversion.factor[s];break}if(k){console.warn(parseFloat(this.options.value,10),a.usiConversion.from[s],"-->",t,a.usiConversion.to[s])}}}else{throw"Conversion factor not found for : "+p+"-->"+C}}else{t=z}if(o!==C){var u=o.replace(new RegExp(C+"$"),"");if(k){console.info("Unit",o,"is a subunit of",C,"with prefix:",u)}r=t/m[u];if(k){console.warn("[3]",t,C,"-->",r,o)}}else{r=t}var w;w=new f({value:r,unit:o});return w}else{throw"unit√© non reconnu : "+q}},toString:function(){return this.options.value+" "+this.options.unit},_getUnitIndex:function(o){var n=a[i].units_names.indexOf(o),p=a[i].units_names_short.indexOf(o);if(n!==-1){return n}else{return p}},convert:function(o,p){var q=this.options.knowledge;for(var n in q.UNITS_KNOWLEDGE){console.log(n);if(o===n.description){g(n.description,p)}}},addUnitRule:function(p,o,n){e.from.push(p);e.to.push(o);e.factor.push(n)}});return f});