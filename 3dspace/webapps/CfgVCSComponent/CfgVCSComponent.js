define("DS/CfgVCSComponent/Presenter/CustomTableUtilities",[],function(){var a={PIXEL_STEP:10,LINE_HEIGHT:40,PAGE_HEIGHT:800,maxWheelDelta:function(b){return{y:10,x:10}},normalizeWheel:function(d){var f=0,e=0,c=0,b=0;if("detail" in d){e=d.detail}if("wheelDelta" in d){e=-d.wheelDelta/120}if("wheelDeltaY" in d){e=-d.wheelDeltaY/120}if("wheelDeltaX" in d){f=-d.wheelDeltaX/120}if("axis" in d&&d.axis===d.HORIZONTAL_AXIS){f=e;e=0}c=f*this.PIXEL_STEP;b=e*this.PIXEL_STEP;if("deltaY" in d){b=d.deltaY}if("deltaX" in d){c=d.deltaX}if((c||b)&&d.deltaMode){if(d.deltaMode===1){c*=this.LINE_HEIGHT;b*=this.LINE_HEIGHT}else{c*=this.PAGE_HEIGHT;b*=this.PAGE_HEIGHT}}if(c&&!f){f=(c<1)?-1:1}if(b&&!e){e=(b<1)?-1:1}return{spinX:f,spinY:e,pixelX:c,pixelY:b}}};return a});define("DS/CfgVCSComponent/Presenter/DgvCfgVCSTablePresenter",["UWA/Class/View","DS/DataGridView/DataGridView","DS/Tree/TreeNodeModel","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/TreeModel/DataModelSet","DS/Controls/Button","DS/Core/ModelEvents","DS/UIKIT/DropdownMenu","DS/Controls/Toggle","DS/Controls/SpinBox","DS/Core/PointerEvents","DS/CfgVCSComponent/Presenter/CustomTableUtilities","text!DS/CfgVCSComponent/assets/DataGridColumnAttributeMapping.json","i18n!DS/xDimensionManager/assets/nls/xUnitLabelLong","i18n!DS/CfgVCSComponent/assets/nls/VariabilityCriteriaSelector","css!DS/UIKIT/UIKIT.css","css!DS/CfgVCSComponent/View/CfgVCSTablePresenter"],function(View,DataGridView,TreeNodeModel,TreeListView,TreeDocument,DataModelSet,WUXButton,ModelEvents,IconDropdown,Toggle,SpinBox,PointerEvents,CustomTableUtilities,ColumnAttributeMapping,NLS_xUnitLabel,NLS){var ATTR_DISABLED="attrDisabled";var ATTR_AXIS_ID="attrAxis";var tableView=View.extend({tagName:"div",className:"dgv-vcs-table-presenter",params:{},init:function(options){var that=this;UWA.extend(options,this.defaults,true);this._parent(options);this.options.selectionData={totalCount:0,displayCount:0,selectionCount:0};this._modelEvents=new ModelEvents();this.contentFilter=options.contentFilter;this._currAxisId=this.options.axisId||undefined;this._createAndSetupDataGridView();this.subscribeToEvents();this._loadDictionaryJsonUpdated(options.dictionaryJSON);this._addInternalEventHandlerOnActions()},_createAndSetupDataGridView:function(){var that=this;this._dataModelSet=new DataModelSet();this._treeDocument=new TreeDocument({dataModelSet:this._dataModelSet,useAsyncPreExpand:true,shouldAcceptDrop:function(options){return false},shouldAcceptDrag:function(draggedNode){return false},shouldBeEditable:function(nodeModel){return false},shouldBeSelected:function(nodeModel){return true}});this.createColumnDefinitions();this.dgvBasedListView=new DataGridView({identifier:this.options.identifier,treeDocument:this._treeDocument,columns:this._colsDef,cellSelection:"none",defaultColumnDef:{width:"auto",typeRepresentation:"string"},allowUnsafeHTMLContent:false,onContextualEvent:function(params){var menu=[];if(params&&params.collectionView&&params.cellInfos){var colCount=params.collectionView.columns.length;var colId=params.cellInfos.columnID;if(colId!=0){menu=params.collectionView.buildDefaultContextualMenu(params,{pin:true,firstColumnsVisibility:true,columnsManagement:false,sizeColumnToFit:false})}}return menu}});this.dgvBasedListView.getTypeRepresentationFactory().registerTypeRepresentations({customMandatory:{stdTemplate:"switch"},customUint64:{stdTemplate:"spinEdit",semantics:{valueType:"integer",minValue:1,stepValue:1,allowUnsafeHTMLContent:false}}});this.customRegisterReusableCellContent();this._treeDocument.getXSO().onAdd(function(nodeModel){if(nodeModel.options&&nodeModel.options.id){that._modelEvents.publish({event:"dgv-item-on-add-selection",data:{model:nodeModel.options.dictionaryItem,items:that._treeDocument.getXSO().get()},context:nodeModel})}else{console.log();nodeModel.unselect()}});this._treeDocument.getXSO().onRemove(function(nodeModel){if(nodeModel.options&&nodeModel.options.id){var selectedNodes=that._treeDocument.getSelectedNodes();if(selectedNodes&&selectedNodes.length===0){that._modelEvents.publish({event:"dgv-item-on-empty-selection"})}else{that._modelEvents.publish({event:"dgv-item-on-remove-selection",data:{model:nodeModel.options.dictionaryItem,items:that._treeDocument.getXSO().get()},context:nodeModel})}}})},_addInternalEventHandlerOnActions:function(){var that=this;if(UWA.is(this.options.actions,"array")){this.options.actions.forEach(function(action){var eventName=action.event;if(eventName){that.subscribe("internal_"+eventName,function(eventData){if(that._currAxisId===undefined){console.log("Internal On Event Action : "+eventData.toString());var subDico=that.getSubDicoFromNodeDetails(eventData);var item={};if(eventData){var actionNode=eventData.nodeModel?eventData.nodeModel:undefined;if(actionNode){item=actionNode.options.dictionaryItem}}UWA.merge(subDico,{item:item});that._modelEvents.publish({event:eventName,data:subDico,context:null})}else{that._modelEvents.publish({event:eventName,data:{nodeModel:eventData.nodeModel,axisId:that._currAxisId},context:null})}})}})}},getDocument:function(){return this._treeDocument},getSubDicoFromNodeDetails:function(nodeDetails){var that=this;var subDicoObj=that.emptyDicoObject();subDicoObj.clickedId=null;if(nodeDetails){var nodeToAdd=nodeDetails.nodeModel?nodeDetails.nodeModel:undefined;subDicoObj.clickedId=nodeToAdd.options.id}if(that.dicoVersion=="1.0"){if(nodeToAdd._parentNode&&nodeToAdd._parentNode._isTrueRoot()){switch(nodeToAdd.options.criteriaType){case"Features":subDicoObj.dictionary.features.push({id:nodeToAdd.options.id,name:nodeToAdd.options.label,options:that.getArrayOfChildren(nodeToAdd)});break}}else{var parentNode=nodeToAdd._parentNode;if(parentNode){subDicoObj.dictionary.features.push({id:parentNode.options.id,name:parentNode.options.label,options:[{id:nodeToAdd.options.id,name:nodeToAdd.options.label}]})}}}else{if(that.dicoVersion=="2.0"){if(nodeToAdd._parentNode&&nodeToAdd._parentNode._isTrueRoot()){switch(nodeToAdd.options.criteriaType){case"Variants":var dictionaryItem=nodeToAdd.options.dictionaryItem;subDicoObj.dictionary.variantClasses.push(dictionaryItem);break;case"Options":var dictionaryItem=nodeToAdd.options.dictionaryItem;subDicoObj.dictionary.options.push(dictionaryItem);break;case"Packs":var dictionaryItem=nodeToAdd.options.dictionaryItem;subDicoObj.dictionary.packs.push(dictionaryItem);break}}else{var parentNode=nodeToAdd._parentNode;if(parentNode){var dictionaryItem=UWA.clone(parentNode.options.dictionaryItem);dictionaryItem.variants=[nodeToAdd.options.dictionaryItem];subDicoObj.dictionary.variantClasses.push(dictionaryItem)}}}else{if(that.dicoVersion=="3.0"){console.log();var keys=["id","idref","pid","lid","attributes","isInherited","constraint"];var subDico={};var paths=UWA.Json.path(that.options.dictionaryJSON,'$..[?(@.id==decodeURIComponent("'+encodeURIComponent(nodeToAdd.options.id)+'"))]',{resultType:"PATH"});if(UWA.is(paths,"array")){var path=paths[0];var regexpe=new RegExp("(\\w+)","g");var parts=path.match(regexpe);var dictionaryItem=UWA.clone(that.options.dictionaryJSON);var subpath="";for(var i=0;i<parts.length;i++){if(UWA.is(dictionaryItem,"object")){subpath+="['"+parts[i]+"']";var keysToInclude=keys.concat([parts[i]]);Object.keys(dictionaryItem).forEach(function(key){if(keysToInclude.indexOf(key)==-1){delete dictionaryItem[key]}});dictionaryItem=dictionaryItem[parts[i]];eval("subDico"+subpath+" = dictionaryItem")}else{if(UWA.is(dictionaryItem,"array")){var part=parseInt(parts[i]);if(UWA.is(part,"number")){dictionaryItem=dictionaryItem[part];eval("subDico"+subpath+" = [dictionaryItem]");subpath+="[0]"}}}}}UWA.extend(subDico,{_version:"3.0"});UWA.extend(subDicoObj,{dictionary:subDico})}}}return subDicoObj},getDictionaryContent:function(options){var treeDocument=this._treeDocument;var contentType=options.type;var dictionaryContent={};if(treeDocument){if(this.dicoVersion=="3.0"){if(contentType=="criteria"){var rootNode=treeDocument._getTrueRoot();if(rootNode.getChildren()){rootNode.getChildren().forEach(function(treeNode){var attributes=treeNode.options.grid;var dictionaryItem=UWA.clone(treeNode.options.dictionaryItem);dictionaryItem.includeNot=attributes._includeNot;if(treeNode.options.criteriaType=="Variants"){if((attributes._include&&attributes._include!=0)||attributes._includeNot==true){dictionaryItem.values=[];if(treeNode.getChildren().length>0){treeNode.getChildren().forEach(function(subNode){var include=subNode.options.grid._include;var variant=UWA.clone(subNode.options.dictionaryItem);variant.include=include==1;dictionaryItem.values.push(variant)});if(!dictionaryContent.variants){dictionaryContent.variants=[]}dictionaryContent.variants.push(dictionaryItem)}}}else{if(treeNode.options.criteriaType=="VariabilityGroups"){dictionaryItem.options=[];var childrenNodes=treeNode.getChildren();if(childrenNodes&&childrenNodes.length>0){childrenNodes.forEach(function(subNode){if(subNode.options.criteriaType=="Options"){var include=subNode.options.grid._include;var includeNot=subNode.options.grid._includeNot;if(include||includeNot){var option=UWA.clone(subNode.options.dictionaryItem);option.include=include==1;option.includeNot=includeNot;dictionaryItem.options.push(option)}}});if(!dictionaryContent.variabilityGroups){dictionaryContent.variabilityGroups=[]}if(dictionaryItem.options.length>0){dictionaryContent.variabilityGroups.push(dictionaryItem)}}}}})}}}}return dictionaryContent},loadDictionary:function(dictionary){console.log("loadDictionary");if(dictionary){this.options.dictionaryJSON=dictionary;this._loadDictionaryJsonUpdated(dictionary)}},render:function(){var that=this;var tableListViewDiv=UWA.createElement("div",{styles:{width:"100%",height:"100%",display:"inline-block"},"class":"content-tree-section"});this.dgvBasedListView.inject(this.container);this.publish("onDisplayAndSelCountUpdate",this.options.selectionData,null);return this},subscribe:function(eventName,callback){if(this._modelEvents){this._modelEvents.subscribe({event:eventName},callback)}},unsubscribeAll:function(eventName){if(this._modelEvents){this._modelEvents.unsubscribeAll({event:eventName})}},publish:function(eventName,eventData,context){if(this._modelEvents){this._modelEvents.publish({event:eventName,data:eventData,context:context})}},emptyDicoObject:function(){function dicoObj(dicoVersion){var jsonDictionary=undefined;if(dicoVersion&&dicoVersion=="1.0"){jsonDictionary={dictionary:{_version:"1.0",features:[],options:[],}}}else{if(dicoVersion&&dicoVersion=="2.0"){jsonDictionary={dictionary:{_version:"2.0",variantClasses:[],options:[],packs:[]}}}else{if(dicoVersion&&dicoVersion=="3.0"){jsonDictionary={dictionary:{_version:"3.0",portfolioClass:{}}}}}}return jsonDictionary}return new dicoObj(this.dicoVersion)},getArrayOfChildren:function(parentNode){var objArray=[];if(parentNode){var children=parentNode.getChildren()||[];children.forEach(function(childNode){if(childNode&&false==childNode.isHidden()){objArray.push({id:childNode.options.id,name:childNode.options.label})}})}return objArray},customRegisterReusableCellContent:function(){var that=this;var reusableCntId="_reusableActionsContent";if(UWA.is(this.options.actions,"array")){if(this.options.actions.length==1){var action=this.options.actions[0];that.dgvBasedListView.registerReusableCellContent({id:reusableCntId,buildContent:function(){var actionBtn=new WUXButton({icon:action.fonticon,displayStyle:"lite",label:action.title,showLabelFlag:false,allowUnsafeHTMLLabel:false});actionBtn.getContent().setStyle("margin-right","10");actionBtn.getContent().addEvent("click",function(){if(this.hasAttribute("disabled")==false){var cellId=this.parentElement.getAttribute("cell-id");var cellInfos=that.dgvBasedListView.getCellInfosAt(cellId);if(cellInfos){that._modelEvents.publish({event:"internal_"+action.event,data:{nodeRowID:undefined,nodeModel:cellInfos.nodeModel},context:null})}}});return actionBtn}})}else{var subActions=[];this.options.actions.forEach(function(action){subActions.push({selected:action.selected?action.selected:false,fonticon:action.fonticon,description:action.description,title:action.title?action.title:"",text:action.text?action.text:action.title?action.title:"",event:action.event?action.event:undefined})});this.dgvBasedListView.registerReusableCellContent({id:reusableCntId,buildContent:function(cellView){var actionBtn=new WUXButton({icon:{iconName:"angle-down"},displayStyle:"lite",allowUnsafeHTMLLabel:false,showLabelFlag:false});actionBtn.getContent().setStyle("margin-right","10");actionBtn.addEventListener("buttonclick",function(event){var actionButton=event.dsModel;var cellId=this.parentElement.getAttribute("cell-id");var cellInfos=that.dgvBasedListView.getCellInfosAt(cellId);if(cellInfos){var data={nodeRowID:undefined,nodeModel:cellInfos.nodeModel};actionButton.actionDropdown.data=data}});actionBtn.actionDropdown=new IconDropdown({target:actionBtn.getContent(),renderTo:widget?widget.body:document.body,items:subActions,bound:true,position:"bottom left",offset:{x:0,y:0},events:{onClick:function(e,item){if(item.event&&this.data){var subDico=that.getSubDicoFromNodeDetails(this.data);var nodeModel=this.data.nodeModel;var dicoItem=(nodeModel&&nodeModel.options&&nodeModel.options.dictionaryItem)?nodeModel.options.dictionaryItem:{};UWA.merge(subDico,{item:dicoItem});that._modelEvents.publish({event:item.event,data:subDico,context:null})}}}});return actionBtn}})}}return"_reusableActionsContent"},applyCriteriaFilter_v2:function(event){var that=this;var filterVisible=false;event=event||{};if(!event.filterData&&this.options.filterData){event.filterData=this.options.filterData}event.filterData=event.filterData||{};filterVisible=event.filter==true?true:false;var searchText=UWA.is(event.filterData.searchValue,"array")?(event.filterData.searchValue.length==1?event.filterData.searchValue[0]:""):event.filterData.searchValue;searchText=searchText?searchText.toLowerCase():"";var checkBoxSts=event.filterData.typeFilter?event.filterData.typeFilter:undefined;var id;var depth=UWA.is(event.depth,"number")?event.depth:-1;if(UWA.is(event.filterData.TaggerValues)){id=event.filterData.TaggerValues}else{if(UWA.is(event.filterData.GlobalSearchValues)){id=event.filterData.GlobalSearchValues}else{if(UWA.is(event.filterData.ContextSearchValues)){id=event.filterData.ContextSearchValues}}}this.options.filterData=event.filterData;var dataFilter={_name:searchText,id:id};var rootNodesArr=this._treeDocument.getRoots();var tmpTotalNodes=0;var tmpTotalChildNodes=0;var hiddenNodeCount=0;tmpTotalNodes=rootNodesArr.length;var filterNode=function(node){var attributeMap=node.options.dictionaryItem.attributes;if(attributeMap===undefined||attributeMap===null){return}for(var key in dataFilter){if(dataFilter.hasOwnProperty(key)){var values=dataFilter[key];values=UWA.is(values,"array")?values:(values!==undefined)?[values]:false;if(values){if(key=="id"){if(!(values.indexOf(node.options.dictionaryItem.id)!=-1||values.indexOf(node.options.dictionaryItem.idref)!=-1)){return false}}if(attributeMap.hasOwnProperty(key)){var attributeValue=attributeMap[key];if(attributeValue){var isFiltered=values.some(function(value){if(value!=null&&value!=undefined){return attributeValue.toLowerCase().contains(value.toLowerCase())}else{return true}});if(!isFiltered){return false}}}}}}return true};var processNodes=function(node,level){var matchedNodesCnt=0;level=UWA.is(level,"number")?level:0;if(node&&(depth<0||level<depth)&&node.hasChildren()){level++;node.getChildren().forEach(function(child){matchedNodesCnt+=processNodes(child,level)})}if(node._isTrueRoot()!=true){if(filterNode(node)||matchedNodesCnt>0){if(!(filterVisible&node.isHidden())){node.show();matchedNodesCnt++}}else{node.hide()}}return matchedNodesCnt};this._treeDocument.prepareUpdate();var displayedNodesCount=processNodes(this._treeDocument._getTrueRoot());this._treeDocument.pushUpdate();this.options.selectionData.displayCount=displayedNodesCount;this._modelEvents.publish({event:"onDisplayAndSelCountUpdate",data:that.options.selectionData,context:null})},applyCriteriaFilter_v3_global:function(event){var that=this;var taggerData=event.filterData.TaggerValues;var ContextSearchData=event.filterData.ContextSearchValues;var GlobalSearchData=event.filterData.GlobalSearchValues;var rootNodesArr=this._treeDocument.getRoots();console.log("applyCriteriaFilter_v3_global: Root Nodes Count: "+rootNodesArr.length);var tmpTotalNodes=0;var tmpTotalChildNodes=0;var hiddenNodeCount=0;tmpTotalNodes=rootNodesArr.length;var filterType=null;var filterValues=null;if(taggerData){filterType="TaggerValues";filterValues=taggerData}else{if(ContextSearchData){filterType="ContextSearchValues";filterValues=ContextSearchData}else{if(GlobalSearchData){filterType="GlobalSearchValues";filterValues=GlobalSearchData}}}if(rootNodesArr&&rootNodesArr.length>0){rootNodesArr.filter(function(rootNode){if(filterType!==null){if(!rootNode.xFiltersMerge){rootNode.xFiltersMerge={}}var pid=rootNode.options.dictionaryItem.idref;if(filterValues.indexOf(pid)!=-1){rootNode.xFiltersMerge[filterType]=true}else{rootNode.xFiltersMerge[filterType]=false}}});if(filterType!==null){that.applyAllFilters()}that.options.selectionData.displayCount=that.getVisibleNodeCount();that._modelEvents.publish({event:"onDisplayAndSelCountUpdate",data:that.options.selectionData,context:null})}},applyAllFilters:function(){var rootNodesArr=this._treeDocument.getRoots();if(rootNodesArr&&rootNodesArr.length>0){rootNodesArr.filter(function(rootNode){if(rootNode.xFiltersMerge){var isFiltered=true;Object.keys(rootNode.xFiltersMerge).forEach(function(key){if(rootNode.xFiltersMerge[key]==false){isFiltered=false}});if(isFiltered){rootNode.show()}else{rootNode.hide()}}})}},applyTagsFilter:function(filterDataPid){var rootNodesArr=this._treeDocument.getRoots();if(rootNodesArr&&rootNodesArr.length>0){rootNodesArr.filter(function(rootNode){var pid=rootNode.options.dictionaryItem.idref;if(filterDataPid.filterData.indexOf(pid)!=-1){rootNode.show()}else{rootNode.hide()}});this.options.selectionData.displayCount=this.getVisibleNodeCount();this._modelEvents.publish({event:"onDisplayAndSelCountUpdate",data:this.options.selectionData,context:null})}},getNodeCount:function(){function _countNodes(inputNode){var count=0;if(inputNode&&inputNode.hasChildren()){var count=inputNode.getChildren().length;inputNode.getChildren().forEach(function(node){count+=_countNodes(node)})}return count}var nodeCount=0;if(this._treeDocument){var nodeCount=_countNodes(this._treeDocument._getTrueRoot())}return nodeCount},getVisibleNodeCount:function(){function _countVisibleNodes(inputNode){var count=0;if(inputNode.getParent()!=null&&!inputNode.isHidden()){count++}var childNodesArr=inputNode.getChildren();if(childNodesArr){childNodesArr=(UWA.is(childNodesArr,"array")&&childNodesArr.length>0)?childNodesArr:null;childNodesArr.forEach(function(childNode){if(childNode&&!childNode.isHidden()){if(childNode.getChildren()&&(childNode.getChildren().length>0)){count+=_countVisibleNodes(childNode)}else{count+=1}}})}return count}var nodeCount=0;if(this._treeDocument){nodeCount=_countVisibleNodes(this._treeDocument._getTrueRoot())}return nodeCount},getTotalNodeCount:function(){var nodeCount=0;if(this._treeDocument){var descendants=this._treeDocument.getAllDescendants();nodeCount=(descendants&&descendants instanceof Array)?descendants.length:0}return nodeCount},_loadDictionaryJsonUpdated:function(dictionary){console.log("Loading dictionary");var that=this;if(dictionary){this.options.dictionaryJSON=dictionary;this._setCurrentDicoVersion(this.options)}if(this.dicoVersion){this._treeDocument.prepareUpdate();if(this.options.actionsTreeListView){this.options.actionsTreeListView._treeDocument.prepareUpdate()}switch(this.dicoVersion){case"v1":case"V1":case"1.0":var featuresArr=this.options.dictionaryJSON.features?this.options.dictionaryJSON.features:[];var actionsTreeRootNode=this.options.actionsTreeListView?this.options.actionsTreeListView._treeDocument._getTrueRoot():undefined;var contentTreeRootNode=this._treeDocument._getTrueRoot();this.getTreeNodeModelFromDicoObject_v02(contentTreeRootNode,actionsTreeRootNode,"Features","Configuration Feature",featuresArr);break;case"v2":case"V2":case"2.0":var optionsArr=this.options.dictionaryJSON.options;var packsArr=this.options.dictionaryJSON.packs;var variantclassArr=this.options.dictionaryJSON.variantClasses;var actionsTreeRootNode=this.options.actionsTreeListView?this.options.actionsTreeListView._treeDocument._getTrueRoot():undefined;var contentTreeRootNode=this._treeDocument._getTrueRoot();this._treeDocument.empty();if(actionsTreeRootNode){this.options.actionsTreeListView._treeDocument.empty()}this.getTreeNodeModelFromDicoObject_v02(contentTreeRootNode,actionsTreeRootNode,"Options",NLS.Option,optionsArr);this.getTreeNodeModelFromDicoObject_v02(contentTreeRootNode,actionsTreeRootNode,"Packs",NLS.Pack,packsArr);this.getTreeNodeModelFromDicoObject_v02(contentTreeRootNode,actionsTreeRootNode,"Variants",NLS.VariantClass,variantclassArr);break;case"3.0":var actionsTreeRootNode=undefined;var contentTreeRootNode=this._treeDocument._getTrueRoot();var dictionaryItems=this.getDictionaryItemFromDictionary(this.options.dictionaryJSON);this.getTreeNodeModelFromDicoObject_v04(contentTreeRootNode,actionsTreeRootNode,dictionaryItems);break;default:console.log("Incorrect dictionary version/format: "+this.options.dictionaryJSON._version);break}this._treeDocument.pushUpdate();if(this.options.actionsTreeListView){this.options.actionsTreeListView._treeDocument.pushUpdate()}this.options.selectionData.displayCount=this.getVisibleNodeCount();this.publish("onDisplayAndSelCountUpdate",this.options.selectionData,null)}},getDictionaryItemFromDictionary:function(dictionary,dictionaryData){var dictionaryItems=[];if(dictionary.portfolioClasses){if(dictionary.portfolioClasses.member&&dictionary.portfolioClasses.member.length>0){dictionary.portfolioClasses.member.forEach(function(portfolioClass){var className=portfolioClass["class"];if(portfolioClass.portfolioComponents){var portfolioComponents=UWA.is(portfolioClass.portfolioComponents.member,"array")?portfolioClass.portfolioComponents.member:false;if(portfolioComponents&&portfolioComponents.length>0){for(var i=0;i<portfolioComponents.length;i++){var componentId=portfolioComponents[i]["id"];var componentAttributes=portfolioComponents[i]["attributes"];var variabilityGroups=portfolioComponents[i]["variabilityGroups"]?portfolioComponents[i]["variabilityGroups"]["member"]:undefined;var variants=portfolioComponents[i]["variants"]?portfolioComponents[i]["variants"]["member"]:undefined;var options=portfolioComponents[i]["options"]?portfolioComponents[i]["options"]["member"]:undefined;var parameters=portfolioComponents[i]["parameters"]?portfolioComponents[i]["parameters"]["member"]:undefined;var portfolioClasses=portfolioComponents[i]["portfolioClass"]?{portfolioClass:portfolioComponents[i]["portfolioClass"]}:undefined;var data={className:className,componentId:componentId,componentAttributes:componentAttributes};if(variabilityGroups){dictionaryItems.push({type:"VariabilityGroups",text:NLS.VariabilityGroupType,item:variabilityGroups,data:data})}if(variants){dictionaryItems.push({type:"Variants",text:NLS.VariantType,item:variants,data:data})}if(options){dictionaryItems.push({type:"Options",text:NLS.OptionType,item:options,data:data})}if(parameters){dictionaryItems.push({type:"Parameters",text:NLS.ParameterType,item:parameters,data:data})}if(portfolioClasses){dictionaryItems.push({type:"PortfolioClass",text:"PortfolioClass",item:portfolioClasses,data:data})}}}}})}}if(dictionary.portfolioClass){var className=dictionary.portfolioClass["class"];if(dictionary.portfolioClass.portfolioComponents){var portfolioComponents=UWA.is(dictionary.portfolioClass.portfolioComponents.member,"array")?dictionary.portfolioClass.portfolioComponents.member:false;if(portfolioComponents&&portfolioComponents.length>0){for(var i=0;i<portfolioComponents.length;i++){var componentId=portfolioComponents[i]["id"];var componentAttributes=portfolioComponents[i]["attributes"];var variabilityGroups=portfolioComponents[i]["variabilityGroups"]?portfolioComponents[i]["variabilityGroups"]["member"]:undefined;var variants=portfolioComponents[i]["variants"]?portfolioComponents[i]["variants"]["member"]:undefined;var options=portfolioComponents[i]["options"]?portfolioComponents[i]["options"]["member"]:undefined;var parameters=portfolioComponents[i]["parameters"]?portfolioComponents[i]["parameters"]["member"]:undefined;var portfolioClasses=portfolioComponents[i]["portfolioClass"]?{portfolioClass:portfolioComponents[i]["portfolioClass"]}:undefined;var data={className:className,componentId:componentId,componentAttributes:componentAttributes};if(variabilityGroups){dictionaryItems.push({type:"VariabilityGroups",text:NLS.VariabilityGroupType,item:variabilityGroups,data:data})}if(variants){dictionaryItems.push({type:"Variants",text:NLS.VariantType,item:variants,data:data})}if(options){dictionaryItems.push({type:"Options",text:NLS.OptionType,item:options,data:data})}if(parameters){dictionaryItems.push({type:"Parameters",text:NLS.ParameterType,item:parameters,data:data})}if(portfolioClasses){dictionaryItems.push({type:"PortfolioClass",text:"PortfolioClass",item:portfolioClasses,data:data})}}}}}if(dictionary.variabilityGroups){if(dictionary.variabilityGroups.member&&dictionary.variabilityGroups.member.length>0){dictionary.variabilityGroups.member.forEach(function(variabilityGroup){var variants=variabilityGroup.variants?variabilityGroup.variants["member"]:undefined;var options=variabilityGroup.options?variabilityGroup.options["member"]:undefined;var variabilityGroups=variabilityGroup.variabilityGroups?variabilityGroup.variabilityGroups["member"]:undefined;if(variants){dictionaryItems.push({type:"Variants",text:NLS.VariantType,item:variants,data:dictionaryData})}if(options){dictionaryItems.push({type:"Options",text:NLS.OptionType,item:options,data:dictionaryData})}if(variabilityGroups){dictionaryItems.push({type:"VariabilityGroups",text:NLS.VariabilityGroupType,item:variabilityGroups,data:dictionaryData})}})}}if(dictionary.variants){if(dictionary.variants.member&&dictionary.variants.member.length>0){dictionary.variants.member.forEach(function(variant){var options=variant.options?variant.options["member"]:undefined;if(options){dictionaryItems.push({type:"Options",text:NLS.OptionType,item:options,data:dictionaryData})}})}}if(dictionary.options){var options=dictionary.options?dictionary.options["member"]:undefined;if(options){dictionaryItems.push({type:"Options",text:NLS.OptionType,item:options,data:dictionaryData})}}if(dictionary.parameters){var parameters=dictionary.parameters?dictionary.parameters["member"]:undefined;if(parameters){dictionaryItems.push({type:"Parameters",text:NLS.ParameterType,item:parameters,data:dictionaryData})}}if(dictionary.values){var values=dictionary.values?dictionary.values["member"]:undefined;if(values){dictionaryItems.push({type:"Values",text:NLS.ValueType,item:values,data:dictionaryData})}}return dictionaryItems},addDictionaryCriteria:function(criteria,addPromiseCallback,actionsStatusUpdater){var clickedId=criteria.clickedId;var subDico=criteria.dictionary;if(subDico){var version=subDico._version;if(version=="3.0"){this._modelEvents.publish({event:"loading-view-start"});var dictionaryItems=this.getDictionaryItemFromDictionary(subDico);var that=this;if(UWA.is(dictionaryItems,"array")){dictionaryItems.forEach(function(dictionaryItem){if(dictionaryItem.type=="Variants"){var items=dictionaryItem.item;if(UWA.is(items,"array")){items.forEach(function(item){var variantClassInstance=UWA.Json.path(that.options.dictionaryJSON,'$..variants.member[?(@.idref=="'+item.id+'")]');if(variantClassInstance){variantClassInstance=variantClassInstance[0]}var createValueInstance=function(instanceId,instanceToCreate){console.log("vc instance id : "+instanceId);var contentNodeModel;var actionNodeModel;var bActionTreeExists=that.options.actionsTreeListView?true:false;var matchedModels=that.getDocument().search({match:function(nodeInfos){if(nodeInfos.nodeModel.options.id==instanceId){return true}}});if(matchedModels.length==0){var itemReference=UWA.clone(item);var itemInstance=UWA.clone(item);UWA.merge(itemReference,{kind:"reference"});UWA.extend(itemInstance,{kind:"instance",id:instanceId,idref:item.id,attributes:{_mandatory:{name:"mandatory",value:true}}},true);var variantMembers=that.getDictionaryItem("$..variants.member");if(UWA.is(variantMembers,"array")){variantMembers.push(itemReference);variantMembers.push(itemInstance)}var valueMembers=that.getDictionaryItem('$..variants.member[?(@.kind=="reference" && @.id== "'+item.id+'")].values.member');if(UWA.is(valueMembers,"array")){valueMembers.forEach(function(value){value.idref=value.id;delete value.id})}var valueInstanceMembers=that.getDictionaryItem('$..variants.member[?(@.kind=="instance" && @.id== "'+instanceId+'")].values.member');if(UWA.is(valueInstanceMembers,"array")){valueInstanceMembers.splice(0,valueInstanceMembers.length)}contentNodeModel=that._createAndAddTreeNodeForItemInstance(dictionaryItem,itemInstance,undefined)}else{contentNodeModel=matchedModels[0];actionNodeModel=bActionTreeExists?contentNodeModel.options.actionNode:undefined}dictionaryItem=that.getDictionaryItemFromDictionary(item);if(UWA.is(dictionaryItem,"array")){var valueItems=[];dictionaryItem.forEach(function(dicoItem){if(dicoItem.type=="Values"){for(var i=0;i<dicoItem.item.length;i++){if(instanceToCreate){if(instanceToCreate!=dicoItem.item[i].id){continue}}var valueItem=that.getDictionaryItem('$..variants.member[?(@.id=="'+instanceId+'")].values.member[?(@.idref=="'+dicoItem.item[i].id+'")]');if(!valueItem){valueItems.push({id:dicoItem.item[i].id,attributes:{},parentId:instanceId})}}}});if(valueItems.length>0){addPromiseCallback({type:"Value",action:"create",data:{items:valueItems}}).then(function(valueInstanceIds){if(UWA.is(valueInstanceIds,"array")){var itemObjectIndex=0;var itemIndex=0;valueInstanceIds.forEach(function(valueInstanceId,index){console.log(valueItems);var valueInstances=that.getDictionaryItem('$..variants.member[?(@.id=="'+valueItems[index].parentId+'")].values.member');var valueInstance=dictionaryItem[itemObjectIndex].item[itemIndex];var idref=valueInstance.id;while(idref!=valueItems[index].id){itemIndex++;if(itemIndex>dictionaryItem[itemObjectIndex].item.length){itemObjectIndex++;itemIndex=0}valueInstance=dictionaryItem[itemObjectIndex].item[itemIndex];idref=valueInstance.id}UWA.extend(valueInstance,{idref:idref,id:valueInstanceId,},true);valueInstances.push(valueInstance);that._createAndAddTreeNodeForItemInstance(dictionaryItem[itemObjectIndex],valueInstance,contentNodeModel);itemIndex++;if(itemIndex>dictionaryItem[itemObjectIndex].item.length){itemObjectIndex++;itemIndex=0}});that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})}})}else{that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})}}};var startValueInstanceCreation=function(instanceId){if(instanceId){if(item.id==clickedId){createValueInstance(instanceId)}else{createValueInstance(instanceId,clickedId)}}};if(variantClassInstance){var instanceId=variantClassInstance.id;startValueInstanceCreation(instanceId)}else{addPromiseCallback({type:"Variant",action:"create",data:{id:item.id,attributes:{}}}).then(startValueInstanceCreation)}})}}else{if(dictionaryItem.type=="VariabilityGroups"){var items=dictionaryItem.item;if(UWA.is(items,"array")){items.forEach(function(item){var instanceToCreate;if(item.id!=clickedId){instanceToCreate=clickedId}var optionsDictionaryItem=that.getDictionaryItemFromDictionary(item);if(UWA.is(optionsDictionaryItem,"array")){var optionItems=[];optionsDictionaryItem.forEach(function(dicoItem){if(dicoItem.type=="Options"){for(var i=0;i<dicoItem.item.length;i++){if(instanceToCreate){if(instanceToCreate!=dicoItem.item[i].id){continue}}var optionItem=that.getDictionaryItem('$..variabilityGroups.member[?(@.id=="'+item.id+'")].options.member[?(@.idref=="'+dicoItem.item[i].id+'")]');if(!optionItem){optionItems.push({id:dicoItem.item[i].id,attributes:{}})}}}});if(optionItems.length>0){addPromiseCallback({type:"Option",action:"create",data:{items:optionItems}}).then(function(optionInstanceIds){if(UWA.is(optionInstanceIds,"array")){var contentNodeModel;var actionNodeModel;var bActionTreeExists=that.options.actionsTreeListView?true:false;var matchedModels=that.getDocument().search({match:function(nodeInfos){if(nodeInfos.nodeModel.options.id==item.id){return true}}});if(matchedModels.length==0){var itemInstance=UWA.clone(item);UWA.extend(itemInstance,{id:item.id,options:{totalItems:0,member:[]}},true);var variabilityGroupMembers=that.getDictionaryItem("$..variabilityGroups.member");if(UWA.is(variabilityGroupMembers,"array")){variabilityGroupMembers.push(itemInstance)}contentNodeModel=that._createAndAddTreeNodeForItemInstance(dictionaryItem,itemInstance,undefined)}else{contentNodeModel=matchedModels[0];actionNodeModel=bActionTreeExists?contentNodeModel.options.actionNode:undefined}var itemObjectIndex=0;var itemIndex=0;optionInstanceIds.forEach(function(optionInstanceId,index){console.log(optionItems);var optionInstances=that.getDictionaryItem('$..variabilityGroups.member[?(@.id=="'+item.id+'")].options.member');var optionInstance=optionsDictionaryItem[itemObjectIndex].item[itemIndex];var idref=optionInstance.id;UWA.extend(optionInstance,{idref:idref,id:optionInstanceId,kind:"instance",},true);optionInstances.push(optionInstance);that._createAndAddTreeNodeForItemInstance(optionsDictionaryItem[itemObjectIndex],optionInstance,contentNodeModel);itemIndex++;if(itemIndex>optionsDictionaryItem[itemObjectIndex].item.length){itemObjectIndex++;itemIndex=0}});that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})}})}else{that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})}}})}}else{if(dictionaryItem.type=="Parameters"){var items=dictionaryItem.item;if(UWA.is(items,"array")){items.forEach(function(item){var parameterInstance=UWA.Json.path(that.options.dictionaryJSON,'$..parameters.member[?(@.id=="'+item.id+'" && @.kind=="instance")]');if(parameterInstance){parameterInstance=parameterInstance[0]}if(!parameterInstance){addPromiseCallback({type:"Parameter",action:"create",data:{id:item.id,attributes:{}}}).then(function(parameterInstanceId){var itemReference=UWA.clone(item);var itemInstance=UWA.clone(item);UWA.merge(itemReference,{kind:"reference"});UWA.extend(itemInstance,{kind:"instance",id:parameterInstanceId,idref:item.id,},true);var parameterMembers=that.getDictionaryItem("$..parameters.member");if(UWA.is(parameterMembers,"array")){parameterMembers.push(itemReference);parameterMembers.push(itemInstance)}var contentNodeModel=that._createAndAddTreeNodeForItemInstance(dictionaryItem,itemInstance,undefined);that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})})}else{that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})}})}}}}})}}}},_createAndAddTreeNodeForItemInstance:function(dictionaryItem,itemInstance,parentNode){this._treeDocument.prepareUpdate();this.dgvBasedListView.prepareUpdateView();var createdNodeModel=this.createTreeNodeFromDicoItem_v04(dictionaryItem.type,dictionaryItem.text,itemInstance,dictionaryItem.data);var contentTreeRootNode=(parentNode!=undefined&&parentNode!=null)?parentNode:this._treeDocument._getTrueRoot();contentTreeRootNode.addChild(createdNodeModel);this._treeDocument.pushUpdate();this.dgvBasedListView.pushUpdateView({updateCellContent:true},true);return createdNodeModel},removeDictionaryCriteria:function(criteria,removePromiseCallback){console.log("remove criteria..");var clickedId=criteria.clickedId;var subDico=criteria.dictionary;if(subDico){this._modelEvents.publish({event:"loading-view-start"});var version=subDico._version;if(version=="3.0"){var dictionaryItems=this.getDictionaryItemFromDictionary(subDico);var that=this;if(UWA.is(dictionaryItems,"array")){dictionaryItems.forEach(function(dictionaryItem){if(dictionaryItem.type=="Variants"){var items=dictionaryItem.item;if(UWA.is(items,"array")){items.forEach(function(item){var variantClassInstance=UWA.Json.path(that.options.dictionaryJSON,'$..variants.member[?(@.id=="'+item.id+'")]');if(variantClassInstance){variantClassInstance=variantClassInstance[0]}var removeValueInstance=function(instanceId,instanceToRemove){console.log("vc instance id : "+instanceId);var matchedModels=that.getDocument().search({match:function(nodeInfos){if(nodeInfos.nodeModel.options.id==instanceId){return true}}});if(matchedModels.length>0){var contentNodeModel=matchedModels[0];var bActionTreeExists=that.options.actionsTreeListView?true:false;var actionNodeModel=bActionTreeExists?contentNodeModel.options.actionNode:undefined;dictionaryItem=that.getDictionaryItemFromDictionary(item);if(UWA.is(dictionaryItem,"array")){var valueItems=[];dictionaryItem.forEach(function(dicoItem){if(dicoItem.type=="Values"){for(var i=0;i<dicoItem.item.length;i++){if(instanceToRemove){if(instanceToRemove!=dicoItem.item[i].id){continue}}var valueItem=that.getDictionaryItem('$..variants.member[?(@.id=="'+instanceId+'")].values.member[?(@.id==decodeURIComponent("'+encodeURIComponent(dicoItem.item[i].id)+'"))]');if(valueItem){valueItems.push(dicoItem.item[i].id)}}}});if(valueItems.length>0){removePromiseCallback({type:"Value",action:"remove",data:{items:valueItems}}).then(function(){var valueNodeModels=contentNodeModel.search({match:function(nodeInfos){if(valueItems.indexOf(nodeInfos.nodeModel.options.id)>-1){return true}}});if(valueNodeModels.length>0){valueNodeModels.forEach(function(nodeModel){if(nodeModel.options.actionNode){nodeModel.options.actionNode.remove()}nodeModel.remove()});var valueMembers=that.getDictionaryItem('$..variants.member[?(@.id=="'+instanceId+'")].values.member');var filteredValues=valueMembers.filter(function(valueMember){return valueItems.indexOf(valueMember.id)==-1});valueMembers.splice(0,valueMembers.length);filteredValues.forEach(function(valueMember){valueMembers.push(valueMember)});if(!contentNodeModel.getChildren()||contentNodeModel.getChildren().length==0){if(actionNodeModel){actionNodeModel.remove()}contentNodeModel.remove()}that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})}else{that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})}})}else{removePromiseCallback({type:"Variant",action:"remove",data:{items:[instanceId]}}).then(function(){if(actionNodeModel){actionNodeModel.remove()}contentNodeModel.remove();that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})})}}}};var startValueInstanceRemoval=function(instanceId){if(instanceId){if(item.id==clickedId){removeValueInstance(instanceId)}else{removeValueInstance(instanceId,clickedId)}}};if(variantClassInstance){var instanceId=variantClassInstance.id;startValueInstanceRemoval(instanceId)}})}}else{if(dictionaryItem.type=="VariabilityGroups"){var items=dictionaryItem.item;if(UWA.is(items,"array")){items.forEach(function(item){var variabilityGroupInstance=UWA.Json.path(that.options.dictionaryJSON,'$..variabilityGroups.member[?(@.id=="'+item.id+'")]');if(variabilityGroupInstance){variabilityGroupInstance=variabilityGroupInstance[0]}var removeOptionInstance=function(instanceId,instanceToRemove){console.log("vg instance id : "+instanceId);var matchedModels=that.getDocument().search({match:function(nodeInfos){if(nodeInfos.nodeModel.options.id==instanceId){return true}}});if(matchedModels.length>0){var contentNodeModel=matchedModels[0];var bActionTreeExists=that.options.actionsTreeListView?true:false;var actionNodeModel=bActionTreeExists?contentNodeModel.options.actionNode:undefined;dictionaryItem=that.getDictionaryItemFromDictionary(item);if(UWA.is(dictionaryItem,"array")){var optionItems=[];dictionaryItem.forEach(function(dicoItem){if(dicoItem.type=="Options"){for(var i=0;i<dicoItem.item.length;i++){if(instanceToRemove){if(instanceToRemove!=dicoItem.item[i].id){continue}}var optionItem=that.getDictionaryItem('$..variabilityGroups.member[?(@.id=="'+instanceId+'")].options.member[?(@.kind=="instance" && @.id==decodeURIComponent("'+encodeURIComponent(dicoItem.item[i].id)+'"))]');if(optionItem){optionItems.push(dicoItem.item[i].id)}}}});if(optionItems.length>0){removePromiseCallback({type:"Option",action:"remove",data:{items:optionItems}}).then(function(){var optionNodeModels=contentNodeModel.search({match:function(nodeInfos){if(optionItems.indexOf(nodeInfos.nodeModel.options.id)>-1){return true}}});if(optionNodeModels.length>0){optionNodeModels.forEach(function(nodeModel){if(nodeModel.options.actionNode){nodeModel.options.actionNode.remove()}nodeModel.remove()});var optionMembers=that.getDictionaryItem('$..variabilityGroups.member[?(@.id=="'+instanceId+'")].options.member');var filteredOptions=optionMembers.filter(function(optionMember){return optionItems.indexOf(optionMember.id)==-1});optionMembers.splice(0,optionMembers.length);filteredOptions.forEach(function(optionMember){optionMembers.push(optionMember)});if(!contentNodeModel.getChildren()||contentNodeModel.getChildren().length==0){if(actionNodeModel){actionNodeModel.remove()}contentNodeModel.remove()}that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})}})}else{that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})}}}};var startOptionInstanceRemoval=function(instanceId){if(instanceId){if(item.id==clickedId){removeOptionInstance(instanceId)}else{removeOptionInstance(instanceId,clickedId)}}};if(variabilityGroupInstance){var instanceId=variabilityGroupInstance.id;startOptionInstanceRemoval(instanceId)}})}}else{if(dictionaryItem.type=="Parameters"){var items=dictionaryItem.item;if(UWA.is(items,"array")){items.forEach(function(item){var parameterInstance=UWA.Json.path(that.options.dictionaryJSON,'$..parameters.member[?(@.id=="'+item.id+'" && @.kind=="instance")]');if(parameterInstance){parameterInstance=parameterInstance[0]}if(parameterInstance){var instanceId=parameterInstance.id;var matchedModels=that.getDocument().search({match:function(nodeInfos){if(nodeInfos.nodeModel.options.id==instanceId){return true}}});if(matchedModels.length>0){var contentNodeModel=matchedModels[0];var bActionTreeExists=that.options.actionsTreeListView?true:false;var actionNodeModel=bActionTreeExists?contentNodeModel.options.actionNode:undefined;var parameterItems=[instanceId];removePromiseCallback({type:"Parameter",action:"remove",data:{items:parameterItems}}).then(function(){var parameterMembers=that.getDictionaryItem("$..parameters.member");var filteredParameters=parameterMembers.filter(function(parameterMember){return parameterItems.indexOf(parameterMember.id)==-1});parameterMembers.splice(0,parameterMembers.length);filteredParameters.forEach(function(parameterMember){parameterMembers.push(parameterMember)});if(actionNodeModel){actionNodeModel.remove()}contentNodeModel.remove();that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})})}else{that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})}}else{that._modelEvents.publish({event:"loading-view-complete",data:that.getTotalNodeCount()})}})}}}}})}}}},updateDictionaryItem:function(path,dictionaryItem){var item=UWA.Json.path(this.options.dictionaryJSON,path);eval("that.options.dictionaryJSON"+path+" = dictionaryItem")},getDictionaryItem:function(path){var item=UWA.Json.path(this.options.dictionaryJSON,path);return item?item[0]:false},setEditMode:function(isEditable){this.options.isEditable=isEditable==true;this._modelEvents.publish({event:"_updateEditionMode",data:{isEditable:this.options.isEditable}})},setAttributes:function(dictionaryItems){if(UWA.is(dictionaryItems,"object")){dictionaryItems=[dictionaryItems]}var that=this;if(UWA.is(dictionaryItems,"array")){dictionaryItems.forEach(function(dictionaryItem){var filterKeys=Object.keys(dictionaryItem);if(filterKeys){var matchedNodes=that._treeDocument.search({match:function(nodeInfos){var isMatched=false;for(var i=0;i<filterKeys.length;i++){if(filterKeys[i]!="attributes"){if(nodeInfos.nodeModel.options.dictionaryItem[filterKeys[i]]==dictionaryItem[filterKeys[i]]){isMatched=true}}}return isMatched}});if(matchedNodes&&matchedNodes.length>0){var treeNode=matchedNodes[0];var attributes=dictionaryItem.attributes;if(attributes){treeNode.prepareUpdate();for(var key in attributes){if(attributes.hasOwnProperty(key)){treeNode.setAttribute(key,attributes[key]);if(key=="_include"){var checkFlag=attributes[key];var siblingNodeModels=treeNode.getBrothers();if(UWA.is(siblingNodeModels,"array")){var isAllChecked=2;if(siblingNodeModels.length==0){isAllChecked=checkFlag}for(var i=0;i<siblingNodeModels.length;i++){if((siblingNodeModels[i].options.grid[key]||0)==checkFlag){isAllChecked=checkFlag}else{isAllChecked=2;break}}var parentNode=treeNode.getParent();if(parentNode&&parentNode.options.id){parentNode.prepareUpdate();parentNode.setAttribute(key,isAllChecked);parentNode.pushUpdate()}}}}}treeNode.pushUpdate()}}}})}},setAttributesForBuildtimeVCS:function(dataSet){var dictionaryItems=dataSet&&dataSet.criteriaList?dataSet.criteriaList:{};var axisId=dataSet&&dataSet.axisId?dataSet.axisId:undefined;if(UWA.is(dictionaryItems,"object")){dictionaryItems=[dictionaryItems]}var that=this;var filteredIdsArray=[];if(UWA.is(dictionaryItems,"array")){dictionaryItems.forEach(function(dictionaryItem){var filterKeys=Object.keys(dictionaryItem);if(filterKeys){var matchedNodes=that._treeDocument.search({match:function(nodeInfos){var isMatched=false;for(var i=0;i<filterKeys.length;i++){if(filterKeys[i]!="attributes"){if(nodeInfos.nodeModel.options.dictionaryItem[filterKeys[i]]==dictionaryItem[filterKeys[i]]){filteredIdsArray.push(dictionaryItem[filterKeys[i]]);isMatched=true}}}return isMatched}});if(matchedNodes&&matchedNodes.length>0){var treeNode=matchedNodes[0];var attributes=dictionaryItem.attributes;if(attributes){treeNode.prepareUpdate();for(var key in attributes){if(attributes.hasOwnProperty(key)){treeNode.setAttribute(ATTR_AXIS_ID,axisId);if(key=="_include"){var checkFlag=attributes[key];if(checkFlag==2||checkFlag==1){treeNode.setAttribute(ATTR_DISABLED,true)}else{if(checkFlag==0){treeNode.setAttribute(ATTR_DISABLED,false)}}var parentNode=treeNode.getParent();parentNode.prepareUpdate();var siblingNodeModels=treeNode.getBrothers();if(UWA.is(siblingNodeModels,"array")&&siblingNodeModels.length>0){parentNode.setAttribute(ATTR_AXIS_ID,axisId);siblingNodeModels.forEach(function(siblingNode){siblingNode.prepareUpdate();siblingNode.setAttribute(ATTR_AXIS_ID,axisId);siblingNode.pushUpdate()})}var atleastOneNodeAvailabel=false;var disabledNodeCount=0;var availableNodeCount=0;var disabledNodeAxis=undefined;var childrenNodes=parentNode.getChildren();for(var i=0,len=childrenNodes.length;i<len;i++){var child=childrenNodes[i];var childDisabled=child.options.grid.attrDisabled;if(child&&(childDisabled==undefined||childDisabled==false)){availableNodeCount+=1}else{if(child&&(childDisabled==true)){disabledNodeCount+=1}}}if(availableNodeCount>0){parentNode.setAttribute(ATTR_DISABLED,false)}else{parentNode.setAttribute(ATTR_DISABLED,true)}parentNode.pushUpdate()}}}treeNode.pushUpdate()}}}})}},createColumnDefinitions:function(){var that=this;this._colsDef=[];var columnsArr=this.options.contentTreeOptions.columns;if(columnsArr&&columnsArr.length>0){for(var itr=0,arrLength=columnsArr.length;itr<arrLength;itr++){var colKind=columnsArr[itr].kind;if(colKind===undefined||colKind.indexOf(that.options.kind)!=-1){that._colsDef.push(UWA.clone(columnsArr[itr]))}}this._colsDef.forEach(function(column){if(column.dataIndex=="_mandatory"){column.onCellChange=function(cellInfos){console.log("On Change Request of Mandatory Column.")};column.onCellRequest=function(cellInfos){if(cellInfos.rowID>=0){if(cellInfos.nodeModel.options.grid._mandatory!=undefined){that.dgvBasedListView.getTypeRepresentationFactory().generateView(cellInfos.cellModel,{typePath:"customMandatory",readOnly:false,touchMode:false,escapeHTML:false,context:"stdTemplate",visibleFlag:true,onViewCreated:function(tweakerView){tweakerView.value=cellInfos.nodeModel.options.grid._mandatory;cellInfos.cellView._setReusableContent(tweakerView)}})}else{cellInfos.cellView._setReusableContent(null)}}};column.setCellValue=function(cellInfos,newValue){cellInfos.nodeModel.options.grid._mandatory=newValue;var changeObject={id:cellInfos.nodeModel.options.id,name:"_mandatory",value:newValue};that.onChangeAttribute(changeObject,cellInfos.nodeModel.options);console.log("setCellValue : MANDATORY: On Change Attribute Handler!!!")};column.setValue=function(cellInfos){cellInfos.nodeModel.options.grid._mandatory=cellInfos.event.dsModel.checkFlag;var changeObject={id:cellInfos.nodeModel.options.id,name:"_mandatory",value:cellInfos.event.dsModel.checkFlag};that.onChangeAttribute(changeObject,cellInfos.nodeModel.options)};column.getValue=function(cellInfos){var value=cellInfos.nodeModel.options.grid._mandatory;if(UWA.is(value,"string")){try{value=JSON.parse(value)}catch(e){value=""}}else{if(!UWA.is(value,"boolean")){value=""}}return value}}else{if(column.dataIndex=="_default"){column.setValue=function(cellInfos){var checkFlag=cellInfos.event.dsModel.checkFlag;cellInfos.nodeModel.options.grid._default=checkFlag;var starType=checkFlag?"star":"star-o";cellInfos.event.dsModel.icon={iconName:starType};var parentNode=cellInfos.nodeModel.getParent();var parentCriteriaType=parentNode&&parentNode.options?parentNode.options.criteriaType:"";if(checkFlag&&parentCriteriaType!=="VariabilityGroups"){var siblingNodeModels=cellInfos.nodeModel.getBrothers();if(UWA.is(siblingNodeModels,"array")){siblingNodeModels.forEach(function(nodeModel){if(nodeModel.options.grid._default==true){nodeModel.prepareUpdate();nodeModel.options.grid._default=false;nodeModel.pushUpdate();that.onChangeAttribute({id:nodeModel.options.id,name:cellInfos.dataIndex,value:false},nodeModel.options)}})}}var changeObject={id:cellInfos.nodeModel.options.id,name:cellInfos.dataIndex,value:checkFlag};that.onChangeAttribute(changeObject,cellInfos.nodeModel.options)};column.getValue=function(cellInfos){var value=cellInfos.nodeModel.options.grid._default;if(UWA.is(value,"string")){try{value=JSON.parse(value)}catch(e){value=""}}else{if(!UWA.is(value,"boolean")){value=""}}return value}}else{if(column.dataIndex=="_range"){column.getCellValue=function(cellInfos){var range="";var minValue=cellInfos.nodeModel.options.grid._minValue;var maxValue=cellInfos.nodeModel.options.grid._maxValue;if(minValue&&maxValue){if(minValue.inputunit&&maxValue.inputunit){range=minValue.inputvalue+" "+NLS_xUnitLabel.get(minValue.inputunit)+NLS.RangeValueDelimiter+maxValue.inputvalue+" "+NLS_xUnitLabel.get(maxValue.inputunit)}else{range=minValue.inputvalue+NLS.RangeValueDelimiter+maxValue.inputvalue}}return range}}else{if(column.dataIndex=="_sequenceNumber"){column.onCellRequest=function(cellInfos){if(cellInfos.rowID<0){return}if(cellInfos.nodeModel.options.criteriaType&&cellInfos.nodeModel.options.criteriaType!=="Parameters"){that.dgvBasedListView.getTypeRepresentationFactory().generateView(cellInfos.cellModel,{typePath:"customUint64",readOnly:false,touchMode:false,escapeHTML:false,context:"stdTemplate",semantics:{allowUnsafeHTMLContent:true},visibleFlag:true,onViewCreated:function(tweakerView){var seqNo=cellInfos.nodeModel.options.grid._sequenceNumber;try{seqNo=parseInt(seqNo)}catch(e){seqNo=1}if(!UWA.is(seqNo,"number")){seqNo=1}tweakerView.value=seqNo;cellInfos.cellView._setReusableContent(tweakerView)}})}else{cellInfos.cellView._setReusableContent(null)}};column.setCellValue=function(cellInfos,newValue){cellInfos.nodeModel.options.grid._sequenceNumber=newValue;var changeObject={id:cellInfos.nodeModel.options.id,name:"_sequenceNumber",value:newValue};that.onChangeAttribute(changeObject,cellInfos.nodeModel.options);console.log("setCellValue : MANDATORY: On Change Attribute Handler!!!")};column.getValue=function(cellInfos){var value=cellInfos.nodeModel.options.grid._sequenceNumber;return value};column.sortFunction=function(a,b){var aValue=a.options.grid._sequenceNumber;var bValue=b.options.grid._sequenceNumber;if(aValue>bValue){return 1}else{if(aValue<bValue){return -1}}return 0}}else{if(column.dataIndex=="_include"){column.onCellRequest=function(cellInfos){if(cellInfos.rowID>=0){that.dgvBasedListView.getTypeRepresentationFactory().generateView(cellInfos.cellModel,{typePath:"customIncludeBoolean",readOnly:false,touchMode:false,escapeHTML:false,context:"stdTemplate",semantics:{allowUnsafeHTMLContent:true},visibleFlag:true,onViewCreated:function(tweakerView){cellInfos.cellView._setReusableContent(tweakerView)}})}};column.getValue=function(cellInfos){var value=cellInfos.nodeModel.options.grid._include;if(UWA.is(value,"string")){value=JSON.parseInt(value)}return UWA.is(value,"number")?value:0};column.setCellValue=function(cellInfos,newValue){var booleanValue=newValue;var checkFlag=booleanValue?1:0;cellInfos.nodeModel.options.grid._include=checkFlag;var siblingNodeModels=cellInfos.nodeModel.getBrothers();if(UWA.is(siblingNodeModels,"array")){var isAllChecked=2;if(siblingNodeModels.length==0){isAllChecked=checkFlag}for(var i=0;i<siblingNodeModels.length;i++){if((siblingNodeModels[i].options.grid._include||0)==checkFlag){isAllChecked=checkFlag}else{isAllChecked=2;break}}var parentNode=cellInfos.nodeModel.getParent();if(parentNode&&parentNode.options.id){parentNode.prepareUpdate();parentNode.setAttribute("_include",isAllChecked);parentNode.pushUpdate()}}var childNodeModels=cellInfos.nodeModel.getChildren();if(UWA.is(childNodeModels,"array")){for(var i=0;i<childNodeModels.length;i++){if(childNodeModels[i].options.grid._include!=checkFlag){childNodeModels[i].prepareUpdate();childNodeModels[i].setAttribute("_include",checkFlag);childNodeModels[i].pushUpdate()}}}var changeObject={id:cellInfos.nodeModel.options.id,name:"_include",value:booleanValue};that.onChangeAttribute(changeObject,cellInfos.nodeModel.options)}}else{if(column.dataIndex=="_includeNot"){column.setValue=function(cellInfos){cellInfos.nodeModel.options.grid._includeNot=cellInfos.event.dsModel.checkFlag;var changeObject={id:cellInfos.nodeModel.options.id,name:"_includeNot",value:cellInfos.event.dsModel.checkFlag};that.onChangeAttribute(changeObject,cellInfos.nodeModel.options)};column.getValue=function(cellInfos){var value=cellInfos.nodeModel.options.grid._includeNot;if(UWA.is(value,"string")){try{value=JSON.parse(value)}catch(e){value=""}}else{if(!UWA.is(value,"boolean")){value=""}}return value}}}}}}}});if(UWA.is(this.options.actions,"array")&&this.options.actions.length>0){this._colsDef.push({text:"Actions",dataIndex:"actionCol",width:"30",pinned:"right",alwaysVisibleFlag:true,isSortable:false,isEditable:false,isSelectable:false,onCellRequest:function(cellInfos){if(cellInfos.rowID>=0){var reusableContent=that.dgvBasedListView._reuseCellContent("_reusableActionsContent",cellInfos.cellView);if(that._currAxisId!=undefined){var nodeIsDisabled=cellInfos.nodeModel.options.grid[ATTR_DISABLED];var nodeAxisId=cellInfos.nodeModel.options.grid[ATTR_AXIS_ID];var nodeCritType=cellInfos.nodeModel.options.criteriaType;if(nodeIsDisabled===true||(nodeIsDisabled==false&&nodeAxisId&&nodeAxisId!=that._currAxisId)||(nodeIsDisabled==undefined&&nodeAxisId&&nodeAxisId!=that._currAxisId)||(that._currAxisId==="driving"&&(nodeCritType=="Options"||nodeCritType=="VariabilityGroups"))){reusableContent.disabled=true}else{reusableContent.disabled=false}}}}})}}},subscribeToEvents:function(){var that=this;this.subscribe("internal_onAddAction",function(eventData){var subDico=that.getSubDicoFromNodeDetails(eventData)});this.subscribe("loadDictionary",function(data){that.loadDictionary(data)});this._modelEvents.subscribe({event:"onContentFilterCriteriaChange"},function(event){if(UWA.is(that.options.filterer,"function")){that.filterDictionaryItem(that.options.filterer);event.filter=true}that._treeDocument.prepareUpdate();that.applyCriteriaFilter_v2.call(that,event);that._treeDocument.pushUpdate()});this._modelEvents.subscribe({event:"onGlobalContentFilterCriteriaChange"},function(event){that._treeDocument.prepareUpdate();that.options.applyCriteriaFilter_v3_global.call(that,event);that._treeDocument.pushUpdate()});this._modelEvents.subscribe({event:"setEditMode"},function(isEditable){that.setEditMode(isEditable)});this._modelEvents.subscribe({event:"addDictionaryCriteria"},function(eventData){if(eventData.item){var criteria=eventData.item;var addPromise=eventData.promise;that.addDictionaryCriteria(criteria,addPromise)}});this._modelEvents.subscribe({event:"removeDictionaryCriteria"},function(eventData){if(eventData.item){var criteria=eventData.item;var addPromise=eventData.promise;that.removeDictionaryCriteria(criteria,addPromise)}});this._modelEvents.subscribe({event:"filterDictionaryItem"},function(eventData){if(eventData.filterer){var filterer=eventData.filterer;that.options.filterer=filterer;that.filterDictionaryItem(filterer);that.applyCriteriaFilter_v2.call(that,{filter:true})}});this._modelEvents.subscribe({event:"processDicoItemsForBuildTimeVCS"},function(eventData){console.log("[DGVCfgVCSTablePresenter: processDicoItemsForBuildTimeVCS] Handler!!!");if(eventData&&eventData.dataSet){that.setAttributesForBuildtimeVCS(eventData.dataSet)}});this._modelEvents.subscribe({event:"buildtime-axis-change"},function(axisId){if(that.dgvBasedListView._isReady===false){that._currAxisId=axisId}if(that.dgvBasedListView._isReady&&(that._currAxisId==undefined||that._currAxisId!=axisId)){that.dgvBasedListView.prepareUpdateView();that._currAxisId=axisId;that._treeDocument.collapseAll();that._treeDocument.expandAll();that.dgvBasedListView.pushUpdateView({updateCellContent:true},true)}});this._modelEvents.subscribe({event:"dgv-prepare-update-view"},function(){that.dgvBasedListView.prepareUpdateView()});this._modelEvents.subscribe({event:"dgv-push-update-view"},function(options){that.dgvBasedListView.pushUpdateView({updateCellContent:options.updateCellConent?options.updateCellConent:true},true)});this._modelEvents.subscribe({event:"setAttributes"},function(data){that.setAttributes(data)})},getTreeNodeModelFromDicoObject_v02:function(contentsParentNode,actionsParentNode,typeOfCriteria,colTypeText,dico){console.log("[DgvCfgVCSTablePresenter: getTreeNodeModelFromDicoObject_v02] Error!!! This shouldnt be called with Dico format v3!!!")},createTreeNodeFromDicoItem:function(typeOfCriteria,colTypeText,dicoItem){console.log("[DgvCfgVCSTablePresenter: createTreeNodeFromDicoItem] Error!!! This shouldnt be called with Dico format v3!!!")},getTreeNodeModelFromDicoObject_v04:function(contentsParentNode,actionsParentNode,dictionaryObjects){var that=this;if(dictionaryObjects&&UWA.is(dictionaryObjects,"array")){var treeNodeArr=[];dictionaryObjects.forEach(function(dictionaryObject){var dictionaryItems=dictionaryObject.item;if(dictionaryObject.type=="PortfolioClass"){var items=that.getDictionaryItemFromDictionary(dictionaryItems);that.getTreeNodeModelFromDicoObject_v04(contentsParentNode,actionsParentNode,items)}else{var itemDataMapping={};var filteredDictionaryItems=[];dictionaryItems.forEach(function(dictionaryItem){var includeItem=true;if(UWA.is(that.contentFilter,"function")){includeItem=that.contentFilter(dictionaryItem)}if(includeItem){filteredDictionaryItems.push(dictionaryItem)}if(dictionaryItem.idref&&dictionaryItem.attributes){itemDataMapping[dictionaryItem.idref]={attributes:dictionaryItem.attributes}}});filteredDictionaryItems.forEach(function(dictionaryItem){var data=dictionaryObject.data?UWA.clone(dictionaryObject.data):{};if(itemDataMapping[dictionaryItem.id]){UWA.merge(data,itemDataMapping[dictionaryItem.id])}var contentNode=that.createTreeNodeFromDicoItem_v04(dictionaryObject.type,dictionaryObject.text,dictionaryItem,data);if(contentNode){contentsParentNode.addChild(contentNode);if(actionsParentNode&&contentNode.options.actionNode){actionsParentNode.addChild(contentNode.options.actionNode)}var items=that.getDictionaryItemFromDictionary(dictionaryItem,data);that.getTreeNodeModelFromDicoObject_v04(contentNode,undefined,items)}})}})}},createTreeNodeFromDicoItem_v04:function(type,type_nsl,dictionaryItem,data){var that=this;var colsArray=this._colsDef;var treeColVal="";var gridValue={};var dicoItem=dictionaryItem;colsArray.forEach(function(colObj){var valAttrbs=colObj.valueAttribute;if(valAttrbs){if(!UWA.is(valAttrbs,"array")){valAttrbs=[valAttrbs]}valAttrbs.forEach(function(valAttrb){if(colObj&&colObj.dataIndex=="tree"){treeColVal=dicoItem[valAttrb]?dicoItem[valAttrb]:(dicoItem.attributes?(UWA.is(dicoItem.attributes[valAttrb],"object")?dicoItem.attributes[valAttrb].value:dicoItem.attributes[valAttrb]):(UWA.is(dicoItem.get,"function")?dicoItem.get(valAttrb):""))}else{if(colObj&&colObj.dataIndex=="actionCol"){gridValue[colObj.dataIndex]=""}else{if(valAttrb&&(valAttrb.toLowerCase()==="type"||valAttrb.toLowerCase()==="_type")){gridValue[valAttrb]=type_nsl}else{gridValue[valAttrb]=dicoItem[valAttrb]?dicoItem[valAttrb]:(dicoItem.attributes?(UWA.is(dicoItem.attributes[valAttrb],"object")&&dicoItem.attributes[valAttrb].value?dicoItem.attributes[valAttrb].value:dicoItem.attributes[valAttrb]):(UWA.is(dicoItem.get,"function")?dicoItem.get(valAttrb):""))}}}})}});var image="";if(dicoItem.attributes&&dicoItem.attributes._image){image=(dicoItem.attributes._image.value!=undefined)?dicoItem.attributes._image.value:dicoItem.attributes._image}var tmpTreeNode=TreeNodeModel.createTreeNodeDataModel(this._dataModelSet,{id:dicoItem.id,label:treeColVal,icons:image?[image]:[],criteriaType:type,dictionaryItem:UWA.clone(dicoItem),children:null,grid:gridValue,data:data});return tmpTreeNode},onChangeAttribute:function(changeObject,options){console.log();var data=changeObject;var type="";switch(options.criteriaType){case"Variants":type="variant";break;case"Values":type="value";break;case"VariabilityGroups":type="variabilityGroup";break;case"Options":type="option";break}UWA.merge(data,{changedObject:options.dictionaryItem,type:type});this._modelEvents.publish({event:"onChangeAttribute",data:data})},filterDictionaryItem:function(filterer){if(UWA.is(filterer,"function")){var treeDocument=this.getDocument();var filter=function(treeNode){if(treeNode.options.id){var nodeData={id:treeNode.options.id,attributes:treeNode.options.grid};return filterer(nodeData)}else{return true}};var filterNode=function(node){if(node){var isFiltered=filter(node);var children=node.getChildren();var filterChild=true;if(UWA.is(isFiltered,"object")){if(isFiltered.filter==false||isFiltered.child==false){filterChild=false}isFiltered=isFiltered.filter}if(filterChild){if(UWA.is(children,"array")&&children.length>0){children.forEach(function(child){if(filterNode(child)){if(!isFiltered){isFiltered=true}}})}}if(isFiltered){if(UWA.is(node.show,"function")){node.show()}}else{if(UWA.is(node.hide,"function")){node.hide()}}}return isFiltered};treeDocument.prepareUpdate();filterNode(treeDocument);this.options.selectionData.displayCount=this.getVisibleNodeCount();this._modelEvents.publish({event:"onDisplayAndSelCountUpdate",data:this.options.selectionData,context:null});treeDocument.pushUpdate()}},clearFilter:function(){},persistCellAttributeChange:function(evt,dataIndex,newValue){var that=this;var cellId=(dataIndex!="_sequenceNumber")?evt.target.parentElement.getAttribute("cell-id"):(evt.target.parentElement.parentElement?evt.target.parentElement.parentElement.getAttribute("cell-id"):null);if(cellId!=null&&cellId!=undefined){var cellInfos=this.dgvBasedListView.getCellInfosAt(cellId);evt.dsModel.value=newValue;if(cellInfos.nodeModel&&cellInfos.nodeModel.options){cellInfos.nodeModel.options.grid[dataIndex]=newValue;var changeObject={id:cellInfos.nodeModel.options.id,name:dataIndex,value:newValue};this.onChangeAttribute(changeObject,cellInfos.nodeModel.options)}}},_setCurrentDicoVersion:function(options){if(options.dictionaryJSON){if(this.options.dictionaryJSON._version=="3.0"){this.dicoVersion="3.0"}else{if(this.options.dictionaryJSON._version==undefined||this.options.dictionaryJSON._version=="1.0"||this.options.dictionaryJSON._version=="v1"||this.options.dictionaryJSON._version=="V1"){this.dicoVersion="1.0"}else{if(this.options.dictionaryJSON._version=="2.0"||this.options.dictionaryJSON._version=="v2"||this.options.dictionaryJSON._version=="V2"){this.dicoVersion="2.0"}}}}else{throw new Error("Error! Dictionary JSON is either undefined or incorrect!")}}});return tableView});define("DS/CfgVCSComponent/Presenter/DgvCfgVCSMainContainer",["UWA/Class/View","UWA/Class/Collection","DS/Core/ModelEvents","DS/CfgVCSComponent/Presenter/DgvCfgVCSTablePresenter","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBar","DS/UIKIT/Mask","text!DS/CfgVCSComponent/assets/DataGridColumnAttributeMapping.json","i18n!DS/CfgVCSComponent/assets/nls/VariabilityCriteriaSelector","css!DS/UIKIT/UIKIT.css","css!DS/CfgVCSComponent/View/CfgVCSMainContainer.css"],function(a,e,c,i,g,f,j,k,m,h){var b=false;var l=JSON.parse(j);var d=a.extend({className:"criteria-selector-container",init:function(n){var p=this;n=n?n:{};this._currSearchText="";this.searchOptions={};this.showCloseAction=false;this.showSwitchViewAction=false;this.showSortAtion=false;this.showKpiAction=false;this.actions=[];this.itemActions=[];this._tablePresenterME=n.modelEvents?n.modelEvents:new c();if(n.showCloseAction==true){this.showCloseAction=true}if(n.showSwitchViewAction==true){this.showSwitchViewAction=true}if(n.showSortAtion==true){this.showSortAtion=true}if(n.actions){this.actions=n.actions}if(n.itemActions){this.itemActions=n.itemActions}if(n.title){this.title=n.title}this.itemCount=0;this.kind=n.kind?n.kind:"reference";if(n.dictionaryJSON&&!n.dictionaryJSON._version){n.dictionaryJSON._version="1.0"}var o=[{text:k.TitleColLabel,dataIndex:"tree",width:"50%",valueAttribute:"_name",alwaysVisibleFlag:true,pinned:"left"},{text:k.TypeColLabel,dataIndex:"_type",valueAttribute:"_type",width:100,isSortable:true,},{text:k.DescriptionColLabel,dataIndex:"_description",valueAttribute:"_description",width:"auto",isSortable:true}];if(n.dictionaryJSON._version=="3.0"){o=UWA.clone(l["3.0"]);o.forEach(function(t,s){if(t){var u=t.text;t.text=k[u]}})}var r={identifier:n.identifier?n.identifier:undefined,contentTreeOptions:{viewIdentifier:"table",isEditable:true,columns:o,resize:{rows:false,columns:true,},selectionData:{totalCount:0,displayCount:0,selectionCount:0},countParentSelection:false,}};var q={dictionaryJSON:n.dictionaryJSON,kind:this.kind,axisId:n.axisId||undefined,getAllChildrenOnParentSelection:(n.getAllChildrenOnParentSelection===false)?false:true,getParentOnChildSelection:(n.getParentOnChildSelection===false)?false:true,countParentSelection:false,actions:this.itemActions,contentFilter:n.contentFilter,isEditable:n.isEditable};this.contentViews=[{id:"table",view:i,options:UWA.merge(r,q)}];this._initActionbarOptions();this._parent(n)},_initActionbarOptions:function(){this._actionbarOptions={modelEvents:this._tablePresenterME,showItemCount:true,withmultisel:false,filter:{},actions:[],searchOptions:{layout:"inline",enableCache:true,allowMultipleSearch:true,attributeFilter:[{id:"name",text:k.NameColLabel,selected:true},{id:"type",text:k.TypeColLabel,selected:false},{id:"description",text:k.DescriptionColLabel,selected:false}],typeFilter:[{id:"Variants",text:"Variant",selected:true},{id:"Options",text:"Option",selected:true}]}};if(this.showSortAtion){this._actionbarOptions.sortOptions={attributes:[{id:"description",text:k.DescriptionColLabel,selected:true},{id:"name",text:k.NameColLabel,selected:false}],order:"ASC"}}if(this.showSwitchViewAction){this._actionbarOptions.switchViews=[{id:"table",text:"Thumbnail",fonticon:"view-small-tile",selected:false},{id:"table",text:"Table",fonticon:"view-list",selected:false}]}if(this.actions){this._actionbarOptions.actions=this.actions}},render:function(){var p=this;this.container.setContent("");if(this.title&&this.title.trim().length!=0){var n=UWA.createElement("div",{html:this.title,styles:{fontFamily:"Arial",fontSize:"16px",color:"#77797c",margin:"5px 0 3px 8px",fontWeight:"normal"}});n.inject(this.container)}var o=this.buildFilterHeaderSection();o.inject(this.container);this.contentSection=this.buildContentView();this.contentSection.inject(this.container);this.initializeContentViews();this.subscribe("loading-view-start",function(){p.maskContent()});this.subscribe("loading-view-complete",function(q){p.unMaskContent();if(q!=undefined&&(typeof q==="number")){p._tablePresenterME.publish({event:"enox-collection-toolbar-items-count-update",data:q});p.itemCount=q}});this.switchView("table");return this},viewSorter:function(n){console.log("View Sorter!!!")},buildFilterHeaderSection:function(){var o=this;var n=UWA.createElement("div",{id:"headerCtrlSection","class":"header-ctrl-section"});this._actionbarOptions.onSwitch=function(){o.switchView.apply(o,arguments)};this._actionbarOptions.onSearch=function(p){o.publishViewEvent("onContentFilterCriteriaChange",{filterData:p});console.log("View Filterer!!!")};this._actionbarOptions.onSort=this.viewSorter;this._stdActionbar=new g(o._actionbarOptions);o._tablePresenterME.subscribe({event:"enox-collection-toolbar-filter-search-value"},function(p){o.publishViewEvent("onContentFilterCriteriaChange",{filterData:p})});this._stdActionbar.inject(n);return n},buildContentView:function(){var o=this.options;var n=UWA.createElement("div",{id:"contentSection","class":"content-section"});return n},initializeContentViews:function(){if(this.contentViews&&this.contentViews.length>0){this._contentViews={};var n=this;this.contentViews.forEach(function(r,q){var p=r.options?r.options:{};var o=new r.view(p);if(q==0){n._contentViews.currentView=r.id;n._contentViews.view={}}n._contentViews.view[r.id]=o;o.subscribe("onDisplayAndSelCountUpdate",function(s){n._tablePresenterME.publish({event:"enox-collection-toolbar-items-count-update",data:s.displayCount});n.itemCount=s.displayCount});o.render()})}},switchView:function(n){if(this._contentViews){this.contentSection.setContent(this._contentViews.view[n]);this._contentViews.currentView=this._contentViews.view[n]}},publishViewEvent:function(o,p){if(this._contentViews){for(var q in this._contentViews.view){if(!(p.eventOrigin&&q===p.eventOrigin)){var n=this._contentViews.view[q];if(UWA.is(n.publish,"function")){n.publish(o,p,n)}}}}},subscribeViewEvent:function(p,q){if(this._contentViews){for(var n in this._contentViews.view){var o=this._contentViews.view[n];if(UWA.is(o.subscribe,"function")&&UWA.is(q,"function")){o.subscribe(p,q)}}}},unsubscribeAllViewEvent:function(p){if(this._contentViews){for(var n in this._contentViews.view){var o=this._contentViews.view[n];if(UWA.is(o.unsubscribeAll,"function")){o.unsubscribeAll(p)}}}},subscribe:function(n,o){this.subscribeViewEvent(n,o)},publish:function(n,o){this.publishViewEvent(n,o)},unsubscribeAll:function(n){this.unsubscribeAllViewEvent(n)},changeView:function(n){this.switchView(n)},setEditable:function(n){this.publishViewEvent("setEditMode",n)},addDictionaryCriteria:function(o,n){this.publishViewEvent("addDictionaryCriteria",{item:o,promise:n})},removeDictionaryCriteria:function(n,o){this.publishViewEvent("removeDictionaryCriteria",{item:n,promise:o})},filter:function(n){this.publishViewEvent("filterDictionaryItem",{filterer:n})},processDicoItemsForBuildTimeVCS:function(n,o){this.publishViewEvent("processDicoItemsForBuildTimeVCS",{dataSet:n,filterer:(typeof(o)==="function")?o:undefined})},maskContent:function(){f.mask(this.container)},unMaskContent:function(){f.unmask(this.container)},showAttribute:function(n){this.publishViewEvent("showAttribute",{attribute:n})},hideAttribute:function(n){this.publishViewEvent("hideAttribute",{attribute:n})},sortBy:function(o,n){this.publishViewEvent("sortBy",{attribute:o,isAccending:n})},loadDictionary:function(n){this.publishViewEvent("loadDictionary",n)},setAttributes:function(n){this.publishViewEvent("setAttributes",n)},getDictionary:function(n){var o={};this.getDictionaryContent(n);return o},getDictionaryContent:function(n){var o={};if(this._contentViews.view.table&&UWA.is(this._contentViews.view.table.getDictionaryContent,"function")){o=this._contentViews.view.table.getDictionaryContent(n)}return o},getTreeDocument:function(){if(this._contentViews.view.table){return this._contentViews.view.table.getDocument()}},getCount:function(){return this.itemCount}});return d});define("DS/CfgVCSComponent/Presenter/CfgVCSTablePresenter",["UWA/Class/View","UWA/Class/Listener","DS/Tree/TreeNodeModel","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/Controls/Button","DS/Core/ModelEvents","DS/UIKIT/DropdownMenu","DS/Controls/Toggle","DS/Controls/SpinBox","DS/Core/PointerEvents","DS/CfgVCSComponent/Presenter/CustomTableUtilities","text!DS/CfgVCSComponent/assets/DataGridColumnAttributeMapping.json","i18n!DS/CfgVCSComponent/assets/nls/VariabilityCriteriaSelector","css!DS/UIKIT/UIKIT.css","css!DS/CfgVCSComponent/View/CfgVCSTablePresenter"],function(View,Listener,TreeNodeModel,TreeListView,TreeDocument,WUXButton,ModelEvents,IconDropdown,Toggle,SpinBox,PointerEvents,CustomTableUtilities,ColumnAttributeMapping,NLS){var tableView=View.extend({tagName:"div",className:"vcs-table-presenter",params:{},init:function(options){var that=this;UWA.extend(options,this.defaults,true);this._modelEvents=new ModelEvents();if(options.modelEvents){this.modelEvents=options.modelEvents}if(undefined==options.withActionsTree){options.withActionsTree=true}if(UWA.is(options.actions,"array")&&options.actions.length==0){options.withActionsTree=false}if(options.actions&&options.withActionsTree){this.actionsTreeListView=new ActionsTreeListView({actions:options.actions,withActionsTree:options.withActionsTree,_modelEvents:this._modelEvents,registerActionsCellContent:this.customRegisterReusableCellContent,showScrollbarsOnHover:false})}if(options.dictionaryJSON){if(options.dictionaryJSON._version=="3.0"){this.dicoVersion="3.0"}else{if(options.dictionaryJSON._version==undefined||options.dictionaryJSON._version=="1.0"||options.dictionaryJSON._version=="v1"||options.dictionaryJSON._version=="V1"){this.dicoVersion="1.0"}else{if(options.dictionaryJSON._version=="2.0"||options.dictionaryJSON._version=="v2"||options.dictionaryJSON._version=="V2"){this.dicoVersion="2.0"}}}}this.tableListView=new contentTreeListView(UWA.merge({viewIdentifier:options.viewIdentifier,dicoVersion:this.dicoVersion,dictionaryJSON:options.dictionaryJSON,kind:options.kind,actionsTreeListView:(options.withActionsTree&&this.actionsTreeListView)?this.actionsTreeListView:undefined,_modelEvents:this._modelEvents,getAllChildrenOnParentSelection:options.getAllChildrenOnParentSelection,getParentOnChildSelection:options.getParentOnChildSelection,actions:options.actions,registerActionsCellContent:this.customRegisterReusableCellContent,withActionsTree:options.withActionsTree,contentFilter:options.contentFilter,isEditable:options.isEditable,showScrollbarsOnHover:false,performances:{resizeDebounceTimeout:100,}},options.contentTreeOptions));this._parent(options);this.tableListView._loadDictionaryJsonUpdated.call(this.tableListView);this.tableListView.options.selectionData.displayCount=this.tableListView.options.selectionData.totalCount=this.tableListView.getNodeCount(this.tableListView);this.manageTreeListViewScrolling();if(UWA.is(options.actions,"array")){options.actions.forEach(function(action){var eventName=action.event;if(eventName){that.subscribe("internal_"+eventName,function(eventData){console.log("Internal On Event Action : "+eventData.toString());var subDico=that.getSubDicoFromNodeDetails(eventData);var item={};if(eventData){var actionNode=eventData.nodeModel?eventData.nodeModel:that.tableListView.getManager().getTreeNodeModelFromRowID(eventData.nodeRowID);if(actionNode){item=actionNode.options.dictionaryItem}}UWA.merge(subDico,{item:item});that._modelEvents.publish({event:eventName,data:subDico,context:null})})}})}this.subscribe("internal_onAddAction",function(eventData){console.log("Internal On Add Action : "+eventData.toString());var subDico=that.getSubDicoFromNodeDetails(eventData)});this.subscribe("loadDictionary",function(data){that.loadDictionary(data)})},getSubDicoFromNodeDetails:function(nodeDetails){var that=this;var subDicoObj=that.emptyDicoObject();subDicoObj.clickedId=null;if(nodeDetails){var nodeToAdd=nodeDetails.nodeModel?nodeDetails.nodeModel:that.tableListView.getManager().getTreeNodeModelFromRowID(nodeDetails.nodeRowID);subDicoObj.clickedId=nodeToAdd.options.id}if(that.dicoVersion=="1.0"){if(nodeToAdd._parentNode&&nodeToAdd._parentNode._isTrueRoot()){switch(nodeToAdd.options.criteriaType){case"Features":subDicoObj.dictionary.features.push({id:nodeToAdd.options.id,name:nodeToAdd.options.label,options:that.getArrayOfChildren(nodeToAdd)});break}}else{var parentNode=nodeToAdd._parentNode;if(parentNode){subDicoObj.dictionary.features.push({id:parentNode.options.id,name:parentNode.options.label,options:[{id:nodeToAdd.options.id,name:nodeToAdd.options.label}]})}}}else{if(that.dicoVersion=="2.0"){if(nodeToAdd._parentNode&&nodeToAdd._parentNode._isTrueRoot()){switch(nodeToAdd.options.criteriaType){case"Variants":var dictionaryItem=nodeToAdd.options.dictionaryItem;subDicoObj.dictionary.variantClasses.push(dictionaryItem);break;case"Options":var dictionaryItem=nodeToAdd.options.dictionaryItem;subDicoObj.dictionary.options.push(dictionaryItem);break;case"Packs":var dictionaryItem=nodeToAdd.options.dictionaryItem;subDicoObj.dictionary.packs.push(dictionaryItem);break}}else{var parentNode=nodeToAdd._parentNode;if(parentNode){var dictionaryItem=UWA.clone(parentNode.options.dictionaryItem);dictionaryItem.variants=[nodeToAdd.options.dictionaryItem];subDicoObj.dictionary.variantClasses.push(dictionaryItem)}}}else{if(that.dicoVersion=="3.0"){console.log();var keys=["id","idref","pid","lid","attributes","isInherited","constraint"];var subDico={};var paths=UWA.Json.path(that.options.dictionaryJSON,'$..[?(@.id==decodeURIComponent("'+encodeURIComponent(nodeToAdd.options.id)+'"))]',{resultType:"PATH"});if(UWA.is(paths,"array")){var path=paths[0];var regexpe=new RegExp("(\\w+)","g");var parts=path.match(regexpe);var dictionaryItem=UWA.clone(that.options.dictionaryJSON);var subpath="";for(var i=0;i<parts.length;i++){if(UWA.is(dictionaryItem,"object")){subpath+="['"+parts[i]+"']";var keysToInclude=keys.concat([parts[i]]);Object.keys(dictionaryItem).forEach(function(key){if(keysToInclude.indexOf(key)==-1){delete dictionaryItem[key]}});dictionaryItem=dictionaryItem[parts[i]];eval("subDico"+subpath+" = dictionaryItem")}else{if(UWA.is(dictionaryItem,"array")){var part=parseInt(parts[i]);if(UWA.is(part,"number")){dictionaryItem=dictionaryItem[part];eval("subDico"+subpath+" = [dictionaryItem]");subpath+="[0]"}}}}}UWA.extend(subDico,{_version:"3.0"});UWA.extend(subDicoObj,{dictionary:subDico})}}}return subDicoObj},getDictionaryContent:function(options){var treeDocument=this.tableListView.options.treeDocument;var contentType=options.type;var dictionaryContent={};if(treeDocument){if(this.dicoVersion=="3.0"){if(contentType=="criteria"){var rootNode=treeDocument._getTrueRoot();if(rootNode.getChildren()){rootNode.getChildren().forEach(function(treeNode){var attributes=treeNode.options.grid;var dictionaryItem=UWA.clone(treeNode._options.dictionaryItem);dictionaryItem.includeNot=attributes._includeNot;if(treeNode._options.criteriaType=="Variants"){if((attributes._include&&attributes._include!=0)||attributes._includeNot==true){dictionaryItem.values=[];if(treeNode.getChildren().length>0){treeNode.getChildren().forEach(function(subNode){var include=subNode.options.grid._include;var variant=UWA.clone(subNode._options.dictionaryItem);variant.include=include==1;dictionaryItem.values.push(variant)});if(!dictionaryContent.variants){dictionaryContent.variants=[]}dictionaryContent.variants.push(dictionaryItem)}}}else{if(treeNode._options.criteriaType=="VariabilityGroups"){dictionaryItem.options=[];var childrenNodes=treeNode.getChildren();if(childrenNodes&&childrenNodes.length>0){childrenNodes.forEach(function(subNode){if(subNode._options.criteriaType=="Options"){var include=subNode.options.grid._include;var includeNot=subNode.options.grid._includeNot;if(include||includeNot){var option=UWA.clone(subNode._options.dictionaryItem);option.include=include==1;option.includeNot=includeNot;dictionaryItem.options.push(option)}}});if(!dictionaryContent.variabilityGroups){dictionaryContent.variabilityGroups=[]}if(dictionaryItem.options.length>0){dictionaryContent.variabilityGroups.push(dictionaryItem)}}}}})}}}}return dictionaryContent},loadDictionary:function(dictionary){console.log("loadDictionary");if(dictionary){this.options.dictionaryJSON=dictionary;if(this.options.dictionaryJSON){if(this.options.dictionaryJSON._version=="3.0"){this.dicoVersion="3.0"}else{if(this.options.dictionaryJSON._version==undefined||this.options.dictionaryJSON._version=="1.0"||this.options.dictionaryJSON._version=="v1"||this.options.dictionaryJSON._version=="V1"){this.dicoVersion="1.0"}else{if(this.options.dictionaryJSON._version=="2.0"||this.options.dictionaryJSON._version=="v2"||this.options.dictionaryJSON._version=="V2"){this.dicoVersion="2.0"}}}}this.tableListView._loadDictionaryJsonUpdated(dictionary);this.tableListView.options.selectionData.displayCount=this.tableListView.getVisibleNodeCount();this.publish("onDisplayAndSelCountUpdate",this.tableListView.options.selectionData,null)}},render:function(){var that=this;var tableListViewDiv=UWA.createElement("div",{styles:{width:"100%",height:"100%",display:"inline-block"},"class":"content-tree-section"});tableListViewDiv.addContent(this.tableListView);this.container.addContent(tableListViewDiv);if(this.options.withActionsTree&&this.actionsTreeListView){tableListViewDiv.setStyle("width","calc( 100% - 30px )");var actionsListViewDiv=UWA.createElement("div",{styles:{width:"30px",height:"100%",display:"inline-block"},"class":"action-tree-section"});actionsListViewDiv.addContent(this.actionsTreeListView);this.actionsTreeListView.elements.container.setStyle("display","inline");this.container.addContent(actionsListViewDiv);this.actionsTreeListView.getManager().onReady(function(){var scrollerContainer=that.actionsTreeListView.getContent().getElement(".wux-layouts-gridengine-scroller-container");var observer=new MutationObserver(function(records){records.forEach(function(record){if(record.attributeName=="has-overflow-y"){if(record.target.attributes["has-overflow-y"].nodeValue=="true"){tableListViewDiv.setStyle("width","calc( 100% - 26px )");actionsListViewDiv.setStyles({width:"46px",marginLeft:"-20px"})}else{tableListViewDiv.setStyle("width","calc( 100% - 30px )");actionsListViewDiv.setStyles({width:"30px",marginLeft:"0px"})}}})});observer.observe(scrollerContainer,{attributes:true})});this.tableListView.getManager().onReady(function(){var scrollerContainer=that.tableListView.getContent().getElement(".wux-layouts-gridengine-scroller-container");var observer=new MutationObserver(function(records){records.forEach(function(record){if(record.attributeName=="has-overflow-x"){if(record.target.attributes["has-overflow-x"].nodeValue=="true"){actionsListViewDiv.addClassName("content-overflow-x")}else{actionsListViewDiv.removeClassName("content-overflow-x")}}})});observer.observe(scrollerContainer,{attributes:true})})}this.publish("onDisplayAndSelCountUpdate",this.tableListView.options.selectionData,null);return this},manageTreeListViewScrolling:function(){var that=this;if(!this.options.actions||(UWA.is(this.options.actions,"array")&&this.options.actions.length===0)||!this.options.withActionsTree){return}var contentTableManager=this.tableListView.getManager();var actionsTableManager=this.actionsTreeListView?this.actionsTreeListView.getManager():undefined;var contentReadyPromise=new UWA.Promise(function(resolve,reject){contentTableManager.onReady(resolve)});var actionsReadyPromise=new UWA.Promise(function(resolve,reject){actionsTableManager.onReady(resolve)});UWA.Promise.all([contentReadyPromise,actionsReadyPromise]).then(function(){var contentScroller=that.tableListView.getManager().elements.scroller;var actionsScroller=that.actionsTreeListView.getManager().elements.scroller;contentScroller.elements.container.setStyle("overflow-y","hidden");actionsScroller.elements.container.setStyle("overflow-x","disabled");contentScroller.elements.container.addEvent("wheel",function(event){event.preventDefault();if(contentTableManager.getPoolNumberOfRows()==(contentTableManager.getNumberOfRows()-1)){return}var delta=UWA.Event.wheelDelta(event);var normalizedScroll=CustomTableUtilities.normalizeWheel(event);var deltaToScrollY=Math.abs(normalizedScroll.pixelY);var maxDeltaY=CustomTableUtilities.maxWheelDelta(event).y;var currentDeltaY=0;while(currentDeltaY<=deltaToScrollY){currentDeltaY=currentDeltaY+maxDeltaY;var newScrollTop=actionsScroller.elements.container.scrollTop+(normalizedScroll.spinY*maxDeltaY);actionsScroller.elements.container.scrollTop=newScrollTop}actionsScroller.setPosition({x:0,y:-actionsScroller.elements.container.scrollTop},false);actionsScroller._modelEvents.publish({event:"SCROLL",context:actionsScroller,})});actionsScroller.onScroll(function(event){var actionPos=this.getPosition();var contentPos=that.tableListView.getManager().elements.scroller.getPosition();that.tableListView.getManager().elements.scroller.setPosition({x:0,y:actionPos.y},false);that.tableListView.getManager().elements.scroller.elements.container.scrollTop=Math.abs(actionPos.y);that.tableListView.getManager().elements.scroller.elements.container.scrollLeft=Math.abs(contentPos.x);that.tableListView.getManager().elements.scroller._modelEvents.publish({event:"SCROLL",data:{originatedFrom:"ActionScroller",},context:that.tableListView.getManager().elements.scroller,})})})},subscribe:function(eventName,callback){if(this._modelEvents){this._modelEvents.subscribe({event:eventName},callback)}},unsubscribeAll:function(eventName){if(this._modelEvents){this._modelEvents.unsubscribeAll({event:eventName})}},publish:function(eventName,eventData,context){if(this._modelEvents){this._modelEvents.publish({event:eventName,data:eventData,context:context})}},emptyDicoObject:function(){function dicoObj(dicoVersion){var jsonDictionary=undefined;if(dicoVersion&&dicoVersion=="1.0"){jsonDictionary={dictionary:{_version:"1.0",features:[],options:[],}}}else{if(dicoVersion&&dicoVersion=="2.0"){jsonDictionary={dictionary:{_version:"2.0",variantClasses:[],options:[],packs:[]}}}else{if(dicoVersion&&dicoVersion=="3.0"){jsonDictionary={dictionary:{_version:"3.0",portfolioClass:{}}}}}}return jsonDictionary}return new dicoObj(this.dicoVersion)},getArrayOfChildren:function(parentNode){var objArray=[];if(parentNode){var children=parentNode.getChildren()||[];children.forEach(function(childNode){if(childNode&&false==childNode.isHidden()){objArray.push({id:childNode.options.id,name:childNode.options.label})}})}return objArray},customRegisterReusableCellContent:function(){var that=this;var reusableCntId="_reusableActionsContent";if(UWA.is(this.options.actions,"array")){if(this.options.actions.length==1){var action=this.options.actions[0];that.getManager().registerReusableCellContent({id:reusableCntId,buildContent:function(){var actionBtn=new WUXButton({icon:action.fonticon,displayStyle:"lite",label:action.title,showLabelFlag:false,allowUnsafeHTMLLabel:false});actionBtn.getContent().setStyle("margin-right","10");actionBtn.getContent().addEvent("click",function(){var cellInfos=this.parentNode.dsView.getCellInfos();if(cellInfos){that.options._modelEvents.publish({event:"internal_"+action.event,data:{nodeRowID:that.options.withActionsTree?cellInfos.virtualRowID:undefined,nodeModel:!that.options.withActionsTree?target.parentNode.dsView._getNodeModel():undefined,},context:null})}});return actionBtn}})}else{var subActions=[];this.options.actions.forEach(function(action){subActions.push({selected:action.selected?action.selected:false,fonticon:action.fonticon,description:action.description,title:action.title?action.title:"",text:action.text?action.text:action.title?action.title:"",event:action.event?action.event:undefined})});this.getManager().registerReusableCellContent({id:reusableCntId,buildContent:function(cellView){var actionBtn=new WUXButton({icon:{iconName:"angle-down"},displayStyle:"lite",showLabelFlag:false,allowUnsafeHTMLLabel:false});actionBtn.getContent().setStyle("margin-right","10");actionBtn.addEventListener("buttonclick",function(event){console.log("on event");var actionButton=event.dsModel;var cellInfos=this.parentNode.dsView.getCellInfos();if(cellInfos){var data={nodeRowID:that.options.withActionsTree?cellInfos.virtualRowID:undefined,nodeModel:!that.options.withActionsTree?this.parentNode.dsView._getNodeModel():undefined,};actionButton.actionDropdown.data=data}});actionBtn.actionDropdown=new IconDropdown({target:actionBtn.getContent(),renderTo:widget?widget.body:document.body,items:subActions,bound:true,position:"bottom left",offset:{x:0,y:0},events:{onClick:function(e,item){if(item.event){that.options._modelEvents.publish({event:"internal_"+item.event,data:this.data,context:null})}}}});return actionBtn}})}}return"_reusableActionsContent"}});var ActionsTreeListView=TreeListView.extend(Listener,{defaults:{allowUnsafeHTMLContent:false,apiVersion:2,height:"100%",width:"10%",display:"inline",columns:[{text:"",dataIndex:"tree",isHidden:true,widh:"0",},{text:"",dataIndex:"actionCol",width:"29",isSortable:false,isEditable:false,isSelectable:false,onCellRequest:function(cellInfos){if(!cellInfos.isHeader){var reusableContent=cellInfos.cellView.reuseCellContent("_reusableActionsContent")}}}],selection:{nodes:false,cells:false,rowHeaders:false,columnHeaders:false,unselectAllOnEmptyArea:false,toggle:true,canMultiSelect:false},},init:function(options){var that=this;UWA.extend(options,this.defaults,true);options.treeDocument=new TreeDocument({useAsyncPreExpand:true,shouldAcceptDrop:function(options){return false},shouldAcceptDrag:function(draggedNode){return false},shouldBeEditable:function(nodeModel){return false},shouldBeSelected:function(nodeModel){return false}});this._parent(options);this.options._actionsRegContentId=this.options.registerActionsCellContent.call(this)},});var contentTreeListView=TreeListView.extend(Listener,{defaults:{allowUnsafeHTMLContent:false,treeDocument:{},apiVersion:2,height:"100%",width:"80%",expanderStyle:"triangle",selection:{nodes:true,cells:false,rowHeaders:true,columnHeaders:true,unselectAllOnEmptyArea:true,toggle:true,canMultiSelect:true},node:[],criteriaFilters:{searchData:{},searchText:"",checkBoxSts:{Variants:true,Options:true,Packs:true},},events:{onChangeSelection:function(selCount){var that=this;this.options._modelEvents.publish({event:"onDisplayAndSelCountUpdate",data:this.options.selectionData,context:null})},},onDragStartCell:function(e,dragInfos){if(dragInfos){var dico={};if(this._parentObject.options.treeDocument){var nodesSelected=this._parentObject.options.treeDocument.getSelectedNodes();if(nodesSelected&&UWA.is(nodesSelected,"array")){nodesSelected.forEach(function(node){var nodeType=node.options.criteriaType;var nodeId=node.options.id;var nodeLabel=node.getLabel();if(node.isRoot()){if(node.hasChildren()){var childArr=[];var children=node.getChildren();children.forEach(function(child){if(nodesSelected.indexOf(child)!=-1){childArr.push({name:child.getLabel(),id:child.options.id})}});if(nodeType=="Variants"){if(dico.variantClasses==undefined){dico.variantClasses=[]}dico.variantClasses.push({name:nodeLabel,id:nodeId,variants:childArr})}else{if(nodeType=="Features"){if(dico.features==undefined){dico.features=[]}dico.features.push({name:nodeLabel,id:nodeId,options:childArr})}}}else{var nodetypeLw=nodeType.toLowerCase();if(dico[nodetypeLw]==undefined){dico[nodetypeLw]=[]}dico[nodetypeLw].push({name:nodeLabel,id:nodeId})}}})}if(this._parentObject.options.dicoVersion){dico._version=this._parentObject.options.dicoVersion}else{dico._version="1.0"}console.log("Dragged Items Dico: "+JSON.stringify(dico));if(navigator.userAgent.indexOf("Trident")!==-1&&navigator.userAgent.indexOf("MSIE")===-1){e.dataTransfer.setData("Text",JSON.stringify(dico))}else{e.dataTransfer.setData("Text",JSON.stringify(dico))}e.dataTransfer.effectAllowed="all"}}e.dataTransfer.effectAllowed="all"},applyCriteriaFilter_v2:function(event){var that=this;var filterVisible=false;event=event||{};if(!event.filterData&&this.options.filterData){event.filterData=this.options.filterData}event.filterData=event.filterData||{};filterVisible=event.filter==true?true:false;var searchText=UWA.is(event.filterData.searchValue,"array")?(event.filterData.searchValue.length==1?event.filterData.searchValue[0]:""):event.filterData.searchValue;searchText=searchText?searchText.toLowerCase():"";var checkBoxSts=event.filterData.typeFilter?event.filterData.typeFilter:undefined;var id;var depth=UWA.is(event.depth,"number")?event.depth:-1;if(UWA.is(event.filterData.TaggerValues)){id=event.filterData.TaggerValues}else{if(UWA.is(event.filterData.GlobalSearchValues)){id=event.filterData.GlobalSearchValues}else{if(UWA.is(event.filterData.ContextSearchValues)){id=event.filterData.ContextSearchValues}}}this.options.filterData=event.filterData;var dataFilter={_name:searchText,id:id};var rootNodesArr=this.options.treeDocument.getRoots();console.log("applyCriteriaFilter_v2:Root Nodes Count: "+rootNodesArr.length);var tmpTotalNodes=0;var tmpTotalChildNodes=0;var hiddenNodeCount=0;tmpTotalNodes=rootNodesArr.length;var filterNode=function(node){var attributeMap=node.options.grid;for(var key in dataFilter){if(dataFilter.hasOwnProperty(key)){var values=dataFilter[key];values=UWA.is(values,"array")?values:values?[values]:false;if(values){if(key=="id"){if(!(values.indexOf(node.options.dictionaryItem.id)!=-1||values.indexOf(node.options.dictionaryItem.idref)!=-1)){return false}}if(attributeMap.hasOwnProperty(key)){var attributeValue=attributeMap[key];if(attributeValue){var isFiltered=values.some(function(value){if(value){return attributeValue.toLowerCase().contains(value.toLowerCase())}else{return true}});if(!isFiltered){return false}}}}}}return true};var processNodes=function(node,level){var matchedNodesCnt=0;level=UWA.is(level,"number")?level:0;if(node&&(depth<0||level<depth)&&node.hasChildren()){level++;node.getChildren().forEach(function(child){matchedNodesCnt+=processNodes(child,level)})}if(node._isTrueRoot()!=true){if(filterNode(node)||matchedNodesCnt>0){if(!(filterVisible&node.isHidden())){node.show();matchedNodesCnt++}}else{node.hide()}}return matchedNodesCnt};var displayedNodesCount=processNodes(this.options.treeDocument._getTrueRoot());console.log(" Displayed Node count from processNodes: "+displayedNodesCount);this.options.selectionData.displayCount=displayedNodesCount;this.options._modelEvents.publish({event:"onDisplayAndSelCountUpdate",data:that.options.selectionData,context:null})},applyCriteriaFilter_v3_global:function(event){var that=this;var taggerData=event.filterData.TaggerValues;var ContextSearchData=event.filterData.ContextSearchValues;var GlobalSearchData=event.filterData.GlobalSearchValues;var rootNodesArr=this.options.treeDocument.getRoots();console.log("applyCriteriaFilter_v3_global: Root Nodes Count: "+rootNodesArr.length);var tmpTotalNodes=0;var tmpTotalChildNodes=0;var hiddenNodeCount=0;tmpTotalNodes=rootNodesArr.length;var filterType=null;var filterValues=null;if(taggerData){filterType="TaggerValues";filterValues=taggerData}else{if(ContextSearchData){filterType="ContextSearchValues";filterValues=ContextSearchData}else{if(GlobalSearchData){filterType="GlobalSearchValues";filterValues=GlobalSearchData}}}if(rootNodesArr&&rootNodesArr.length>0){rootNodesArr.filter(function(rootNode){if(filterType!==null){if(!rootNode.xFiltersMerge){rootNode.xFiltersMerge={}}var pid=rootNode._options.dictionaryItem.idref;if(filterValues.indexOf(pid)!=-1){rootNode.xFiltersMerge[filterType]=true}else{rootNode.xFiltersMerge[filterType]=false}}});if(filterType!==null){that.applyAllFilters()}that.options.selectionData.displayCount=that.getVisibleNodeCount();that.options._modelEvents.publish({event:"onDisplayAndSelCountUpdate",data:that.options.selectionData,context:null})}}},applyAllFilters:function(){var rootNodesArr=this.options.treeDocument.getRoots();if(rootNodesArr&&rootNodesArr.length>0){rootNodesArr.filter(function(rootNode){if(rootNode.xFiltersMerge){var isFiltered=true;Object.keys(rootNode.xFiltersMerge).forEach(function(key){if(rootNode.xFiltersMerge[key]==false){isFiltered=false}});if(isFiltered){rootNode.show()}else{rootNode.hide()}}})}},applyTagsFilter:function(filterDataPid){var rootNodesArr=this.options.treeDocument.getRoots();if(rootNodesArr&&rootNodesArr.length>0){rootNodesArr.filter(function(rootNode){var pid=rootNode._options.dictionaryItem.idref;if(filterDataPid.filterData.indexOf(pid)!=-1){rootNode.show()}else{rootNode.hide()}});this.options.selectionData.displayCount=this.getVisibleNodeCount();this.options._modelEvents.publish({event:"onDisplayAndSelCountUpdate",data:this.options.selectionData,context:null})}},getNodeCount:function(){function _countNodes(inputNode){var count=0;if(inputNode&&inputNode.hasChildren()){var count=inputNode.getChildren().length;inputNode.getChildren().forEach(function(node){count+=_countNodes(node)})}return count}var nodeCount=0;if(this.options.treeDocument){var nodeCount=_countNodes(this.options.treeDocument._getTrueRoot())}return nodeCount},getVisibleNodeCount:function(){function _countVisibleNodes(inputNode){var count=0;if(inputNode.getParent()!=null&&!inputNode.isHidden()){count++}var childNodesArr=inputNode.getChildren();if(childNodesArr){childNodesArr=(UWA.is(childNodesArr,"array")&&childNodesArr.length>0)?childNodesArr:null;childNodesArr.forEach(function(childNode){if(childNode&&!childNode.isHidden()){if(childNode.getChildren()&&(childNode.getChildren().length>0)){count+=_countVisibleNodes(childNode)}else{count+=1}}})}return count}var nodeCount=0;if(this.options.treeDocument){nodeCount=_countVisibleNodes(this.options.treeDocument._getTrueRoot())}return nodeCount},getTotalNodeCount:function(){var nodeCount=0;if(this.options.treeDocument){var descendants=this.options.treeDocument.getAllDescendants();nodeCount=(descendants&&descendants instanceof Array)?descendants.length:0}return nodeCount},_loadDictionaryJsonUpdated:function(dictionary){console.log("Loading dictionary");var that=this;if(dictionary){this.options.dictionaryJSON=dictionary;if(this.options.dictionaryJSON){if(this.options.dictionaryJSON._version=="3.0"){this.dicoVersion="3.0"}else{if(this.options.dictionaryJSON._version==undefined||this.options.dictionaryJSON._version=="1.0"||this.options.dictionaryJSON._version=="v1"||this.options.dictionaryJSON._version=="V1"){this.dicoVersion="1.0"}else{if(this.options.dictionaryJSON._version=="2.0"||this.options.dictionaryJSON._version=="v2"||this.options.dictionaryJSON._version=="V2"){this.dicoVersion="2.0"}}}}}if(this.dicoVersion){this.options.treeDocument.prepareUpdate();if(this.options.actionsTreeListView){this.options.actionsTreeListView.options.treeDocument.prepareUpdate()}switch(this.dicoVersion){case"v1":case"V1":case"1.0":var featuresArr=this.options.dictionaryJSON.features?this.options.dictionaryJSON.features:[];var actionsTreeRootNode=this.options.actionsTreeListView?this.options.actionsTreeListView.options.treeDocument._getTrueRoot():undefined;var contentTreeRootNode=this.options.treeDocument._getTrueRoot();this.getTreeNodeModelFromDicoObject_v02(contentTreeRootNode,actionsTreeRootNode,"Features","Configuration Feature",featuresArr);break;case"v2":case"V2":case"2.0":var optionsArr=this.options.dictionaryJSON.options;var packsArr=this.options.dictionaryJSON.packs;var variantclassArr=this.options.dictionaryJSON.variantClasses;var actionsTreeRootNode=this.options.actionsTreeListView?this.options.actionsTreeListView.options.treeDocument._getTrueRoot():undefined;var contentTreeRootNode=this.options.treeDocument._getTrueRoot();this.options.treeDocument.empty();if(actionsTreeRootNode){this.options.actionsTreeListView.options.treeDocument.empty()}this.getTreeNodeModelFromDicoObject_v02(contentTreeRootNode,actionsTreeRootNode,"Options",NLS.Option,optionsArr);this.getTreeNodeModelFromDicoObject_v02(contentTreeRootNode,actionsTreeRootNode,"Packs",NLS.Pack,packsArr);this.getTreeNodeModelFromDicoObject_v02(contentTreeRootNode,actionsTreeRootNode,"Variants",NLS.VariantClass,variantclassArr);break;case"3.0":var actionsTreeRootNode=this.options.actionsTreeListView?this.options.actionsTreeListView.options.treeDocument._getTrueRoot():undefined;var contentTreeRootNode=this.options.treeDocument._getTrueRoot();this.options.treeDocument.empty();if(actionsTreeRootNode){this.options.actionsTreeListView.options.treeDocument.empty()}var dictionaryItems=this.getDictionaryItemFromDictionary(this.options.dictionaryJSON);this.getTreeNodeModelFromDicoObject_v04(contentTreeRootNode,actionsTreeRootNode,dictionaryItems);break;default:console.log("Incorrect dictionary version/format: "+this.options.dictionaryJSON._version);break}this.options.treeDocument.pushUpdate();if(this.options.actionsTreeListView){this.options.actionsTreeListView.options.treeDocument.pushUpdate()}}},getDictionaryItemFromDictionary:function(dictionary,dictionaryData){var dictionaryItems=[];if(dictionary.portfolioClasses){if(dictionary.portfolioClasses.member&&dictionary.portfolioClasses.member.length>0){dictionary.portfolioClasses.member.forEach(function(portfolioClass){var className=portfolioClass["class"];if(portfolioClass.portfolioComponents){var portfolioComponents=UWA.is(portfolioClass.portfolioComponents.member,"array")?portfolioClass.portfolioComponents.member:false;if(portfolioComponents&&portfolioComponents.length>0){for(var i=0;i<portfolioComponents.length;i++){var componentId=portfolioComponents[i]["id"];var componentAttributes=portfolioComponents[i]["attributes"];var variabilityGroups=portfolioComponents[i]["variabilityGroups"]?portfolioComponents[i]["variabilityGroups"]["member"]:undefined;var variants=portfolioComponents[i]["variants"]?portfolioComponents[i]["variants"]["member"]:undefined;var options=portfolioComponents[i]["options"]?portfolioComponents[i]["options"]["member"]:undefined;var portfolioClasses=portfolioComponents[i]["portfolioClass"]?{portfolioClass:portfolioComponents[i]["portfolioClass"]}:undefined;var data={className:className,componentId:componentId,componentAttributes:componentAttributes};if(variabilityGroups){dictionaryItems.push({type:"VariabilityGroups",text:NLS.VariabilityGroupType,item:variabilityGroups,data:data})}if(variants){dictionaryItems.push({type:"Variants",text:NLS.VariantType,item:variants,data:data})}if(options){dictionaryItems.push({type:"Options",text:NLS.OptionType,item:options,data:data})}if(portfolioClasses){dictionaryItems.push({type:"PortfolioClass",text:"PortfolioClass",item:portfolioClasses,data:data})}}}}})}}if(dictionary.portfolioClass){var className=dictionary.portfolioClass["class"];if(dictionary.portfolioClass.portfolioComponents){var portfolioComponents=UWA.is(dictionary.portfolioClass.portfolioComponents.member,"array")?dictionary.portfolioClass.portfolioComponents.member:false;if(portfolioComponents&&portfolioComponents.length>0){for(var i=0;i<portfolioComponents.length;i++){var componentId=portfolioComponents[i]["id"];var componentAttributes=portfolioComponents[i]["attributes"];var variabilityGroups=portfolioComponents[i]["variabilityGroups"]?portfolioComponents[i]["variabilityGroups"]["member"]:undefined;var variants=portfolioComponents[i]["variants"]?portfolioComponents[i]["variants"]["member"]:undefined;var options=portfolioComponents[i]["options"]?portfolioComponents[i]["options"]["member"]:undefined;var portfolioClasses=portfolioComponents[i]["portfolioClass"]?{portfolioClass:portfolioComponents[i]["portfolioClass"]}:undefined;var data={className:className,componentId:componentId,componentAttributes:componentAttributes};if(variabilityGroups){dictionaryItems.push({type:"VariabilityGroups",text:NLS.VariabilityGroupType,item:variabilityGroups,data:data})}if(variants){dictionaryItems.push({type:"Variants",text:NLS.VariantType,item:variants,data:data})}if(options){dictionaryItems.push({type:"Options",text:NLS.OptionType,item:options,data:data})}if(portfolioClasses){dictionaryItems.push({type:"PortfolioClass",text:"PortfolioClass",item:portfolioClasses,data:data})}}}}}if(dictionary.variabilityGroups){if(dictionary.variabilityGroups.member&&dictionary.variabilityGroups.member.length>0){dictionary.variabilityGroups.member.forEach(function(variabilityGroup){var variants=variabilityGroup.variants?variabilityGroup.variants["member"]:undefined;var options=variabilityGroup.options?variabilityGroup.options["member"]:undefined;var variabilityGroups=variabilityGroup.variabilityGroups?variabilityGroup.variabilityGroups["member"]:undefined;if(variants){dictionaryItems.push({type:"Variants",text:NLS.VariantType,item:variants,data:dictionaryData})}if(options){dictionaryItems.push({type:"Options",text:NLS.OptionType,item:options,data:dictionaryData})}if(variabilityGroups){dictionaryItems.push({type:"VariabilityGroups",text:NLS.VariabilityGroupType,item:variabilityGroups,data:dictionaryData})}})}}if(dictionary.variants){if(dictionary.variants.member&&dictionary.variants.member.length>0){dictionary.variants.member.forEach(function(variant){var options=variant.options?variant.options["member"]:undefined;if(options){dictionaryItems.push({type:"Options",text:NLS.OptionType,item:options,data:dictionaryData})}})}}if(dictionary.options){var options=dictionary.options?dictionary.options["member"]:undefined;if(options){dictionaryItems.push({type:"Options",text:NLS.OptionType,item:options,data:dictionaryData})}}if(dictionary.values){var values=dictionary.values?dictionary.values["member"]:undefined;if(values){dictionaryItems.push({type:"Values",text:NLS.ValueType,item:values,data:dictionaryData})}}return dictionaryItems},updateDictionaryItem:function(path,dictionaryItem){var item=UWA.Json.path(this.options.dictionaryJSON,path);eval("that.options.dictionaryJSON"+path+" = dictionaryItem")},getDictionaryItem:function(path){var item=UWA.Json.path(this.options.dictionaryJSON,path);return item?item[0]:false},setEditMode:function(isEditable){this.options.isEditable=isEditable==true;this._modelEvents.publish({event:"_updateEditionMode",data:{isEditable:this.options.isEditable}})},addCriteria:function(contentTreeDocument,actionTreeDocument,typeOfCriteria,colTypeText,dictionaryItem){var that=this;var colsArray=this.options.columns;var bActionTreeExists=this.options.actionsTreeListView?true:false;var treeColVal="";var gridValue={};colsArray.forEach(function(colObj){var valAttrb=colObj.valueAttribute;if(colObj&&colObj.dataIndex=="tree"){treeColVal=dictionaryItem[valAttrb]?dictionaryItem[valAttrb]:(dictionaryItem.attributes?(UWA.is(dictionaryItem.attributes[valAttrb],"object")?dictionaryItem.attributes[valAttrb].value:dictionaryItem.attributes[valAttrb]):(UWA.is(dictionaryItem.get,"function")?dictionaryItem.get(valAttrb):""))}else{if(valAttrb&&(valAttrb.toLowerCase()==="type"||valAttrb.toLowerCase()==="_type")){gridValue[valAttrb]=colTypeText}else{gridValue[valAttrb]=dictionaryItem[valAttrb]?dictionaryItem[valAttrb]:(dictionaryItem.attributes?(UWA.is(dictionaryItem.attributes[valAttrb],"object")?dictionaryItem.attributes[valAttrb].value:dictionaryItem.attributes[valAttrb]):(UWA.is(dictionaryItem.get,"function")?dictionaryItem.get(valAttrb):""))}}});var matchedModels=contentTreeDocument.search({match:function(nodeInfos){if(dictionaryItem.id&&nodeInfos.nodeModel.options.id==dictionaryItem.id){return true}}});var contentNodeModel;var actionNodeModel;if(matchedModels.length==0){if(bActionTreeExists){actionNodeModel=new TreeNodeModel({id:dictionaryItem.id,label:"",children:[],grid:{actionCol:"",}});if(actionTreeDocument){actionTreeDocument.addChild(actionNodeModel)}}var image="";if(dictionaryItem.attributes&&dictionaryItem.attributes._image){image=(dictionaryItem.attributes._image.value!=undefined)?dictionaryItem.attributes._image.value:dictionaryItem.attributes._image}var dictionaryItemNode=UWA.clone(dictionaryItem);if(dictionaryItemNode.variants){dictionaryItemNode.variants=[]}contentNodeModel=new TreeNodeModel({id:dictionaryItem.id,label:treeColVal,icons:image?[image]:[],criteriaType:typeOfCriteria,children:null,grid:gridValue,actionNode:actionNodeModel,dictionaryItem:dictionaryItemNode});contentTreeDocument.addChild(contentNodeModel)}else{contentNodeModel=matchedModels[0];actionNodeModel=bActionTreeExists?contentNodeModel.options.actionNode:undefined}if(dictionaryItem.variants){dictionaryItem.variants.forEach(function(variant){var dictionaryItem=variant;var criteriaType="Variants";var colTypeText=NLS.Variant;that.addCriteria(contentNodeModel,actionNodeModel,criteriaType,colTypeText,dictionaryItem)})}},removeCriteria:function(subDictionary){var getNode=function(treeNode,id,toBeRemoved){var matchedModels=treeNode.search({match:function(nodeInfos){if(nodeInfos.nodeModel.options.id==id){return true}}});var childNode;if(matchedModels&&matchedModels.length==1){childNode=matchedModels[0]}if(toBeRemoved&&childNode){if(childNode.options.actionNode){childNode.options.actionNode.remove()}treeNode.removeChild(childNode)}return childNode};var removeData=[];if(UWA.is(subDictionary,"object")){if(subDictionary.variantClasses){subDictionary.variantClasses.forEach(function(variantClass){var nodeId=variantClass.id;if(variantClass.variants&&variantClass.variants.length>0){variantClass.variants.forEach(function(variant){var subNode=variant.id;var item=[nodeId,subNode];removeData.push(item)})}else{removeData.push([nodeId])}})}else{if(subDictionary.options){subDictionary.options.forEach(function(option){var nodeId=option.id;removeData.push([nodeId])})}else{if(subDictionary.packs){subDictionary.packs.forEach(function(pack){var nodeId=pack.id;removeData.push([nodeId])})}}}}else{if(UWA.is(subDictionary,"array")){removeData.push(subDictionary)}}var rootNode=this.options.treeDocument._getTrueRoot();removeData.forEach(function(items){if(UWA.is(items,"array")){var node=rootNode;items.forEach(function(itemId,index){node=getNode(node,itemId,(index==items.length-1))})}})},setAttributes:function(dictionaryItems){if(UWA.is(dictionaryItems,"object")){dictionaryItems=[dictionaryItems]}var that=this;if(UWA.is(dictionaryItems,"array")){dictionaryItems.forEach(function(dictionaryItem){var filterKeys=Object.keys(dictionaryItem);if(filterKeys){var matchedNodes=that.options.treeDocument.search({match:function(nodeInfos){var isMatched=false;for(var i=0;i<filterKeys.length;i++){if(filterKeys[i]!="attributes"){if(nodeInfos.nodeModel.options.dictionaryItem[filterKeys[i]]==dictionaryItem[filterKeys[i]]){isMatched=true}}}return isMatched}});if(matchedNodes&&matchedNodes.length>0){var treeNode=matchedNodes[0];var attributes=dictionaryItem.attributes;if(attributes){treeNode.prepareUpdate();for(var key in attributes){if(attributes.hasOwnProperty(key)){treeNode.setAttribute(key,attributes[key]);if(key=="_include"){var checkFlag=attributes[key];var siblingNodeModels=treeNode.getBrothers();if(UWA.is(siblingNodeModels,"array")){var isAllChecked=2;if(siblingNodeModels.length==0){isAllChecked=checkFlag}for(var i=0;i<siblingNodeModels.length;i++){if((siblingNodeModels[i].options.grid[key]||0)==checkFlag){isAllChecked=checkFlag}else{isAllChecked=2;break}}var parentNode=treeNode.getParent();if(parentNode&&parentNode.options.id){parentNode.prepareUpdate();parentNode.setAttribute(key,isAllChecked);parentNode.pushUpdate()}}}}}treeNode.pushUpdate()}}}})}},init:function(options){var that=this;UWA.extend(options,this.defaults,true);options.treeDocument=new TreeDocument({useAsyncPreExpand:true,shouldAcceptDrop:function(options){return false},shouldAcceptDrag:function(draggedNode){return true},shouldBeEditable:function(nodeModel){return false},shouldBeSelected:function(nodeModel){return true},});this.isEditable=options.isEditable==false?false:true;if(options.columns){var columns=UWA.clone(options.columns);columns.forEach(function(column){if(column.kind){if(column.kind.indexOf(options.kind)!=-1){column.isHidden=false}else{column.isHidden=true}}if(column.dataIndex=="_mandatory"){column.onCellRequest=function(cellInfos){if(!cellInfos.isHeader){var isMandatory=cellInfos.model.getCellContent();if(UWA.is(isMandatory,"boolean")){var mandatoryToggle=cellInfos.cellView.reuseCellContent("mandatoryCellComponent");mandatoryToggle.checkFlag=isMandatory==true}else{var noValueComponent=cellInfos.cellView.reuseCellContent("stringCellComponent");noValueComponent.setContent(isMandatory)}}};column.setValue=function(cellInfos){cellInfos.nodeModel.options.grid[cellInfos.dataIndex]=cellInfos.event.dsModel.checkFlag;var changeObject={id:cellInfos.nodeModel.options.id,name:cellInfos.dataIndex,value:cellInfos.event.dsModel.checkFlag};that.onChangeAttribute(changeObject,cellInfos.nodeModel.options)};column.getValue=function(cellInfos){var value=cellInfos.nodeModel.options.grid[cellInfos.dataIndex];if(UWA.is(value,"string")){try{value=JSON.parse(value)}catch(e){value=""}}else{if(!UWA.is(value,"boolean")){value=""}}return value}}else{if(column.dataIndex=="_default"){column.onCellRequest=function(cellInfos){if(!cellInfos.isHeader){var isDefault=cellInfos.nodeModel.options.grid[cellInfos.dataIndex];if(UWA.is(isDefault,"string")){try{isDefault=JSON.parse(isDefault)}catch(e){isDefault=""}}else{if(!UWA.is(isDefault,"boolean")){isDefault=""}}if(UWA.is(isDefault,"boolean")){var defaultComponent=cellInfos.cellView.reuseCellContent("defaultCellComponent");var starType=isDefault==true?"star":"star-o";defaultComponent.icon={iconName:starType};defaultComponent.checkFlag=isDefault==true}else{var noValueComponent=cellInfos.cellView.reuseCellContent("stringCellComponent");noValueComponent.setContent(isDefault)}}};column.setValue=function(cellInfos){var checkFlag=cellInfos.event.dsModel.checkFlag;cellInfos.nodeModel.options.grid[cellInfos.dataIndex]=checkFlag;var starType=checkFlag?"star":"star-o";cellInfos.event.dsModel.icon={iconName:starType};var parentNode=cellInfos.nodeModel.getParent();var parentCriteriaType=parentNode&&parentNode.options?parentNode.options.criteriaType:"";if(checkFlag&&parentCriteriaType!=="VariabilityGroups"){var siblingNodeModels=cellInfos.nodeModel.getBrothers();if(UWA.is(siblingNodeModels,"array")){siblingNodeModels.forEach(function(nodeModel){if(nodeModel.options.grid[cellInfos.dataIndex]==true){nodeModel.prepareUpdate();nodeModel.options.grid[cellInfos.dataIndex]=false;nodeModel.pushUpdate();that.onChangeAttribute({id:nodeModel.options.id,name:cellInfos.dataIndex,value:false},nodeModel.options)}})}}var changeObject={id:cellInfos.nodeModel.options.id,name:cellInfos.dataIndex,value:checkFlag};that.onChangeAttribute(changeObject,cellInfos.nodeModel.options)};column.getValue=function(cellInfos){var value=cellInfos.nodeModel.options.grid[cellInfos.dataIndex];if(UWA.is(value,"string")){try{value=JSON.parse(value)}catch(e){value=""}}else{if(!UWA.is(value,"boolean")){value=""}}return value}}else{if(column.dataIndex=="_sequenceNumber"){column.onCellRequest=function(cellInfos){if(!cellInfos.isHeader){var seqNoComponent=cellInfos.cellView.reuseCellContent("seqenceNoCellComponent");var seqNo=cellInfos.model.getCellContent();try{seqNo=parseInt(seqNo)}catch(e){seqNo=1}if(!UWA.is(seqNo,"number")){seqNo=1}seqNoComponent.reset(seqNo)}};column.setValue=function(cellInfos){cellInfos.nodeModel.options.grid[cellInfos.dataIndex]=cellInfos.event.dsModel.value;var changeObject={id:cellInfos.nodeModel.options.id,name:cellInfos.dataIndex,value:cellInfos.event.dsModel.value};that.onChangeAttribute(changeObject,cellInfos.nodeModel.options)};column.getValue=function(cellInfos){var value=cellInfos.nodeModel.options.grid[cellInfos.dataIndex];return value};column.sortFunction=function(a,b){var aValue=a.options.grid._sequenceNumber;var bValue=b.options.grid._sequenceNumber;if(aValue>bValue){return 1}else{if(aValue<bValue){return -1}}return 0}}else{if(column.dataIndex=="_include"){column.onCellRequest=function(cellInfos){if(!cellInfos.isHeader){var isInclude=0;var atrbValue=cellInfos.nodeModel.options.grid[cellInfos.dataIndex];isInclude=(atrbValue===undefined?0:atrbValue);if(UWA.is(isInclude,"number")){var includeToggle=cellInfos.cellView.reuseCellContent("includeCellComponent");includeToggle.checkFlag=isInclude==true;includeToggle.mixedState=isInclude==2;includeToggle.disabled=!that.options.isEditable;if(includeToggle.mixedState&&!includeToggle.disabled){includeToggle.checkFlag=true}}else{var noValueComponent=cellInfos.cellView.reuseCellContent("stringCellComponent");noValueComponent.setContent("")}}};column.getValue=function(cellInfos){var value=cellInfos.nodeModel.options.grid[cellInfos.dataIndex];if(UWA.is(value,"string")){value=JSON.parseInt(value)}return UWA.is(value,"number")?value:0};column.setValue=function(cellInfos){var booleanValue=cellInfos.event.dsModel.checkFlag;var checkFlag=booleanValue?1:0;cellInfos.nodeModel.options.grid[cellInfos.dataIndex]=checkFlag;var siblingNodeModels=cellInfos.nodeModel.getBrothers();if(UWA.is(siblingNodeModels,"array")){var isAllChecked=2;if(siblingNodeModels.length==0){isAllChecked=checkFlag}for(var i=0;i<siblingNodeModels.length;i++){if((siblingNodeModels[i].options.grid[cellInfos.dataIndex]||0)==checkFlag){isAllChecked=checkFlag}else{isAllChecked=2;break}}var parentNode=cellInfos.nodeModel.getParent();if(parentNode&&parentNode.options.id){parentNode.prepareUpdate();parentNode.setAttribute(cellInfos.dataIndex,isAllChecked);parentNode.pushUpdate()}}var childNodeModels=cellInfos.nodeModel.getChildren();if(UWA.is(childNodeModels,"array")){for(var i=0;i<childNodeModels.length;i++){if(childNodeModels[i].options.grid[cellInfos.dataIndex]!=checkFlag){childNodeModels[i].prepareUpdate();childNodeModels[i].setAttribute(cellInfos.dataIndex,checkFlag);childNodeModels[i].pushUpdate()}}}var changeObject={id:cellInfos.nodeModel.options.id,name:cellInfos.dataIndex,value:booleanValue};that.onChangeAttribute(changeObject,cellInfos.nodeModel.options)}}else{if(column.dataIndex=="_includeNot"){column.onCellRequest=function(cellInfos){if(!cellInfos.isHeader){var isIncludeNot=cellInfos.model.getCellContent();if(cellInfos.nodeModel.options.criteriaType=="Options"){if(!UWA.is(isIncludeNot,"boolean")){isIncludeNot=false;cellInfos.nodeModel.options.grid[cellInfos.dataIndex]=false}}else{if(cellInfos.nodeModel.options.criteriaType=="Variants"){if(cellInfos.nodeModel.options.data&&cellInfos.nodeModel.options.data.attributes){if(cellInfos.nodeModel.options.data.attributes._mandatory==true){isIncludeNot=""}else{if(!UWA.is(isIncludeNot,"boolean")){isIncludeNot=false;cellInfos.nodeModel.options.grid[cellInfos.dataIndex]=false}}}}}if(UWA.is(isIncludeNot,"boolean")){var includeNotToggle=cellInfos.cellView.reuseCellContent("includeCellComponent");includeNotToggle.checkFlag=isIncludeNot==true;includeNotToggle.disabled=!that.options.isEditable;includeNotToggle.mixedState=false}else{var noValueComponent=cellInfos.cellView.reuseCellContent("stringCellComponent");noValueComponent.setContent(isIncludeNot)}}};column.setValue=function(cellInfos){cellInfos.nodeModel.options.grid[cellInfos.dataIndex]=cellInfos.event.dsModel.checkFlag;var changeObject={id:cellInfos.nodeModel.options.id,name:cellInfos.dataIndex,value:cellInfos.event.dsModel.checkFlag};that.onChangeAttribute(changeObject,cellInfos.nodeModel.options)};column.getValue=function(cellInfos){var value=cellInfos.nodeModel.options.grid[cellInfos.dataIndex];if(UWA.is(value,"string")){try{value=JSON.parse(value)}catch(e){value=""}}else{if(!UWA.is(value,"boolean")){value=""}}return value}}}}}}});options.columns=columns}if(options.withActionsTree==false){if(UWA.is(options.actions,"array")&&options.actions.length>0){if(options.columns){options.columns.push({text:"",dataIndex:"actionCol",valueAttribute:"actionCol",width:"auto",isSortable:false,isEditable:false,isSelectable:false,onCellRequest:function(cellInfos){if(!cellInfos.isHeader){var reusableContent=cellInfos.cellView.reuseCellContent("_reusableActionsContent")}}})}}}this._parent(options);this.options._actionsRegContentId=this.options.registerActionsCellContent.call(this);var reusableContents=[{id:"mandatoryCellComponent",buildContent:function(){return new Toggle({type:"switch",multiSelFlag:true,allowUnsafeHTMLLabel:false})}},{id:"defaultCellComponent",buildContent:function(){var defaultButton=new WUXButton({icon:{iconName:"star"},displayStyle:"lite",label:"default",type:"check",showLabelFlag:false,allowUnsafeHTMLLabel:false,onClick:function(){console.log()}});defaultButton.getContent().addEventListener(PointerEvents.POINTERDOWN,function(e){e.stopPropagation()});defaultButton.getContent().addEventListener(PointerEvents.POINTERUP,function(e){e.stopPropagation()});return defaultButton}},{id:"seqenceNoCellComponent",buildContent:function(){var sequenceNoView=View.extend({className:"sequence-no-cell",setup:function(){this.isEditable=false;this.spinBox=new SpinBox({value:1,minValue:1,maxValue:100,stepValue:1});var that=this;this.textPanel=UWA.createElement("div",{styles:{cursor:"text"},events:{click:function(){console.log();that.isEditable=true;that.render()}}});this.spinBox.addEventListener(PointerEvents.POINTERDOWN,function(e){e.stopPropagation()});this.spinBox.addEventListener(PointerEvents.POINTERUP,function(e){e.stopPropagation()});this.spinBox.addEventListener("change",function(e){that.setValue(e.dsModel.value)});this.textPanel.addEventListener(PointerEvents.POINTERDOWN,function(e){e.stopPropagation()});this.textPanel.addEventListener(PointerEvents.POINTERUP,function(e){e.stopPropagation()});this.listenTo(document,"click",function(event){var target=event.target;if(that.isEditable&&target.isInjected()){if(!target.isInjected(that.container)&&target!==that.container){that.reset()}}})},render:function(){var value=UWA.is(this.value,"number")?this.value:"";if(this.isEditable){var seqNo;try{seqNo=parseInt(value)}catch(e){}if(UWA.is(seqNo,"number")){this.spinBox.lastValueWhenEnter=null;this.spinBox.value=seqNo}this.container.setContent(this.spinBox);if(this.spinBox.elements.inputField){this.spinBox.elements.inputField.click();this.spinBox.elements.inputField.focus()}}else{this.textPanel.setContent(value);this.container.setContent(this.textPanel)}return this.container},setValue:function(value){this.value=parseInt(value)},getValue:function(){return this.value},setEditMode:function(isEditable){this.isEditable=isEditable==true},reset:function(value){if(UWA.is(value)){this.setValue(value)}this.setEditMode(false);this.render()}});var sequenceNoComponent=new sequenceNoView();sequenceNoComponent.render();return sequenceNoComponent}},{id:"includeCellComponent",buildContent:function(){var toggleControl=new Toggle({multiSelFlag:true,allowUnsafeHTMLLabel:false});toggleControl.disabled=!that.options.isEditable;that._modelEvents.subscribe({event:"_updateEditionMode"},function(eventData){toggleControl.disabled=!eventData.isEditable});return toggleControl}},{id:"stringCellComponent",buildContent:function(){return UWA.createElement("span")}},];reusableContents.forEach(function(component){that.getManager().registerReusableCellContent(component)});this.registerSelectionEvents();this.dicoVersion=this.options.dicoVersion;this.elements.container.style.height="100%";this.options._modelEvents.subscribe({event:"onContentFilterCriteriaChange"},function(event){if(UWA.is(that.options.filterer,"function")){that.filterDictionaryItem(that.options.filterer);event.filter=true}that.options.treeDocument.prepareUpdate();that.options.applyCriteriaFilter_v2.call(that,event);that.options.treeDocument.pushUpdate()});this.options._modelEvents.subscribe({event:"onGlobalContentFilterCriteriaChange"},function(event){that.options.treeDocument.prepareUpdate();that.options.applyCriteriaFilter_v3_global.call(that,event);that.options.treeDocument.pushUpdate()});this.options._modelEvents.subscribe({event:"setEditMode"},function(isEditable){that.setEditMode(isEditable)});this.options._modelEvents.subscribe({event:"filterDictionaryItem"},function(eventData){if(eventData.filterer){var filterer=eventData.filterer;that.options.filterer=filterer;that.filterDictionaryItem(filterer);that.options.treeDocument.prepareUpdate();that.options.applyCriteriaFilter_v2.call(that,{filter:true});that.options.treeDocument.pushUpdate()}});this.options._modelEvents.subscribe({event:"setAttributes"},function(data){that.setAttributes(data)});if(this.options.withActionsTree){this.options.treeDocument._bindEventOnDocument("postExpand",function(modelEvt){if(modelEvt.parent){modelEvt.parent.options.actionNode.expand()}});this.options.treeDocument._bindEventOnDocument("postCollapse",function(modelEvt){if(modelEvt.parent){modelEvt.parent.options.actionNode.collapse()}});this.options.treeDocument._bindEventOnDocument("hide",function(modelEvt){if(modelEvt.data.nodeModel.options.actionNode){}modelEvt.data.nodeModel.options.actionNode.hide()});this.options.treeDocument._bindEventOnDocument("show",function(modelEvt){if(modelEvt.data.nodeModel.options.actionNode){}modelEvt.data.nodeModel.options.actionNode.show()})}this.contentFilter=options.contentFilter;this.isEditable=options.isEditable==false?false:true},registerSelectionEvents:function(){var executeThis=true;var that=this;if(executeThis){var xso=this.getManager().getDocument().getXSO();var gridEngine=this.getManager();xso.onAdd(function(node){var isEmpty=xso.isEmpty();var critType=node.options.criteriaType;var eventData=undefined;if(node.isSelectionChangeFromUI()){if(node.hasChildren()){var childNodesArr=[];if(that.options.getAllChildrenOnParentSelection){node.selectAll();node.getChildren().forEach(function(child){childNodesArr.push({id:child.options.id,children:[]})});console.log(">> After node.selectall() call")}eventData={selection:[{id:node.options.id,children:childNodesArr}],eventOrigin:that.options.viewIdentifier,}}else{if(node.getParent().isRoot()){if(that.options.getParentOnChildSelection){var parent=node.getParent();if(false==parent.isSelected()){parent.select()}eventData={selection:[{id:parent.options.id,children:[{id:node.options.id,children:[]}]},],eventOrigin:that.options.viewIdentifier}}else{eventData={selection:[{id:node.options.id,children:[]}],eventOrigin:that.options.viewIdentifier}}}}}});xso.onUpdate(that._onSelectionChange.bind(that))}},_onSelectionChange:function(){this.options._modelEvents.publish({event:"onSelectionChange",data:this.options.treeDocument.getSelectedNodes()})},getTreeNodeModelFromDicoObject_v02:function(contentsParentNode,actionsParentNode,typeOfCriteria,colTypeText,dico){var that=this;if(dico&&UWA.is(dico,"array")){var treeNodeArr=[];dico.forEach(function(dicoItem){var includeItem=true;if(UWA.is(that.contentFilter,"function")){includeItem=that.contentFilter(dicoItem)}if(includeItem){var contentNode=that.createTreeNodeFromDicoItem(typeOfCriteria,colTypeText,dicoItem);contentsParentNode.addChild(contentNode);if(actionsParentNode&&contentNode.options.actionNode){actionsParentNode.addChild(contentNode.options.actionNode)}}})}},createTreeNodeFromDicoItem:function(typeOfCriteria,colTypeText,dicoItem){var that=this;var colsArray=this.options.columns;var bActionTreeExists=this.options.actionsTreeListView?true:false;var treeColVal="";var gridValue={};colsArray.forEach(function(colObj){var valAttrb=colObj.valueAttribute;if(colObj&&colObj.dataIndex=="tree"){treeColVal=dicoItem[valAttrb]?dicoItem[valAttrb]:(dicoItem.attributes?(UWA.is(dicoItem.attributes[valAttrb],"object")?dicoItem.attributes[valAttrb].value:dicoItem.attributes[valAttrb]):(UWA.is(dicoItem.get,"function")?dicoItem.get(valAttrb):""))}else{if(valAttrb&&(valAttrb.toLowerCase()==="type"||valAttrb.toLowerCase()==="_type")){gridValue[valAttrb]=colTypeText}else{gridValue[valAttrb]=dicoItem[valAttrb]?dicoItem[valAttrb]:(dicoItem.attributes?(UWA.is(dicoItem.attributes[valAttrb],"object")?dicoItem.attributes[valAttrb].value:dicoItem.attributes[valAttrb]):(UWA.is(dicoItem.get,"function")?dicoItem.get(valAttrb):""))}}});var image="";if(dicoItem.attributes&&dicoItem.attributes._image){image=(dicoItem.attributes._image.value!=undefined)?dicoItem.attributes._image.value:dicoItem.attributes._image}var tmpTreeNode=new TreeNodeModel({id:dicoItem.id,label:treeColVal,icons:image?[image]:[],criteriaType:typeOfCriteria,dictionaryItem:UWA.clone(dicoItem),children:null,grid:gridValue,actionNode:bActionTreeExists?new TreeNodeModel({id:dicoItem.id,label:"",children:[],grid:{actionCol:"",}}):undefined,});if(typeOfCriteria=="Variants"&&UWA.is(dicoItem.variants,"array")&&dicoItem.variants.length>0){this.getTreeNodeModelFromDicoObject_v02(tmpTreeNode,tmpTreeNode.options.actionNode,typeOfCriteria,NLS.Variant,dicoItem.variants)}else{if(typeOfCriteria=="Features"&&UWA.is(dicoItem.options,"array")&&dicoItem.options.length>0){this.getTreeNodeModelFromDicoObject_v02(tmpTreeNode,tmpTreeNode.options.actionNode,"Options","Configuration Option",dicoItem.options)}}return tmpTreeNode},getTreeNodeModelFromDicoObject_v04:function(contentsParentNode,actionsParentNode,dictionaryObjects){var that=this;if(dictionaryObjects&&UWA.is(dictionaryObjects,"array")){var treeNodeArr=[];dictionaryObjects.forEach(function(dictionaryObject){var dictionaryItems=dictionaryObject.item;if(dictionaryObject.type=="PortfolioClass"){var items=that.getDictionaryItemFromDictionary(dictionaryItems);that.getTreeNodeModelFromDicoObject_v04(contentsParentNode,actionsParentNode,items)}else{var itemDataMapping={};var filteredDictionaryItems=[];dictionaryItems.forEach(function(dictionaryItem){var includeItem=true;if(UWA.is(that.contentFilter,"function")){includeItem=that.contentFilter(dictionaryItem)}if(includeItem){filteredDictionaryItems.push(dictionaryItem)}if(dictionaryItem.idref&&dictionaryItem.attributes){itemDataMapping[dictionaryItem.idref]={attributes:dictionaryItem.attributes}}});filteredDictionaryItems.forEach(function(dictionaryItem){var data=dictionaryObject.data?UWA.clone(dictionaryObject.data):{};if(itemDataMapping[dictionaryItem.id]){UWA.merge(data,itemDataMapping[dictionaryItem.id])}var contentNode=that.createTreeNodeFromDicoItem_v04(dictionaryObject.type,dictionaryObject.text,dictionaryItem,data);if(contentNode){contentsParentNode.addChild(contentNode);if(actionsParentNode&&contentNode.options.actionNode){actionsParentNode.addChild(contentNode.options.actionNode)}var items=that.getDictionaryItemFromDictionary(dictionaryItem,data);that.getTreeNodeModelFromDicoObject_v04(contentNode,contentNode.options.actionNode,items)}})}})}},createTreeNodeFromDicoItem_v04:function(type,type_nsl,dictionaryItem,data){var that=this;var colsArray=this.options.columns;var bActionTreeExists=this.options.actionsTreeListView?true:false;var treeColVal="";var gridValue={};var dicoItem=dictionaryItem;colsArray.forEach(function(colObj){var valAttrb=colObj.valueAttribute;if(colObj&&colObj.dataIndex=="tree"){treeColVal=dicoItem[valAttrb]?dicoItem[valAttrb]:(dicoItem.attributes?(UWA.is(dicoItem.attributes[valAttrb],"object")?dicoItem.attributes[valAttrb].value:dicoItem.attributes[valAttrb]):(UWA.is(dicoItem.get,"function")?dicoItem.get(valAttrb):""));gridValue[valAttrb]=treeColVal}else{if(valAttrb&&(valAttrb.toLowerCase()==="type"||valAttrb.toLowerCase()==="_type")){gridValue[valAttrb]=type_nsl}else{gridValue[valAttrb]=dicoItem[valAttrb]?dicoItem[valAttrb]:(dicoItem.attributes?(UWA.is(dicoItem.attributes[valAttrb],"object")?dicoItem.attributes[valAttrb].value:dicoItem.attributes[valAttrb]):(UWA.is(dicoItem.get,"function")?dicoItem.get(valAttrb):""))}}});var image="";if(dicoItem.attributes&&dicoItem.attributes._image){image=(dicoItem.attributes._image.value!=undefined)?dicoItem.attributes._image.value:dicoItem.attributes._image}var tmpTreeNode=new TreeNodeModel({id:dicoItem.id,label:treeColVal,icons:image?[image]:[],criteriaType:type,dictionaryItem:UWA.clone(dicoItem),children:null,grid:gridValue,data:data,actionNode:bActionTreeExists?new TreeNodeModel({id:dicoItem.id,label:"",children:[],grid:{actionCol:"",}}):undefined,});return tmpTreeNode},onChangeAttribute:function(changeObject,options){console.log();var data=changeObject;var type="";switch(options.criteriaType){case"Variants":type="variant";break;case"Values":type="value";break;case"VariabilityGroups":type="variabilityGroup";break;case"Options":type="option";break}UWA.merge(data,{changedObject:options.dictionaryItem,type:type});this.options._modelEvents.publish({event:"onChangeAttribute",data:data})},filterDictionaryItem:function(filterer){console.log("in filter function");if(UWA.is(filterer,"function")){var treeDocument=this.getDocument();var filter=function(treeNode){if(treeNode.options.id){var nodeData={id:treeNode.options.id,attributes:treeNode.options.grid};return filterer(nodeData)}else{return true}};var filterNode=function(node){if(node){var isFiltered=filter(node);var children=node.getChildren();var filterChild=true;if(UWA.is(isFiltered,"object")){if(isFiltered.filter==false||isFiltered.child==false){filterChild=false}isFiltered=isFiltered.filter}if(filterChild){if(UWA.is(children,"array")&&children.length>0){children.forEach(function(child){if(filterNode(child)){if(!isFiltered){isFiltered=true}}})}}if(isFiltered){if(UWA.is(node.show,"function")){node.show()}}else{if(UWA.is(node.hide,"function")){node.hide()}}}return isFiltered};treeDocument.prepareUpdate();filterNode(treeDocument);this.options.selectionData.displayCount=this.getVisibleNodeCount();this.options._modelEvents.publish({event:"onDisplayAndSelCountUpdate",data:this.options.selectionData,context:null});treeDocument.pushUpdate()}},clearFilter:function(){}});return tableView});define("DS/CfgVCSComponent/Presenter/CfgVCSMainContainer",["UWA/Class/View","UWA/Class/Collection","DS/Core/ModelEvents","DS/CfgVCSComponent/Presenter/CfgVCSTablePresenter","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBar","DS/UIKIT/Mask","text!DS/CfgVCSComponent/assets/DataGridColumnAttributeMapping.json","i18n!DS/CfgVCSComponent/assets/nls/VariabilityCriteriaSelector","css!DS/UIKIT/UIKIT.css","css!DS/CfgVCSComponent/View/CfgVCSMainContainer.css"],function(a,e,c,i,g,f,j,k,m,h){var b=false;var l=JSON.parse(j);var d=a.extend({className:"criteria-selector-container",init:function(o){var q=this;o=o?o:{};this._currSearchText="";this.searchOptions={};this.showCloseAction=false;this.showSwitchViewAction=false;this.showSortAtion=false;this.showKpiAction=false;this.actions=[];this.itemActions=[];if(o.showCloseAction==true){this.showCloseAction=true}if(o.showSwitchViewAction==true){this.showSwitchViewAction=true}if(o.showSortAtion==true){this.showSortAtion=true}if(o.actions){this.actions=o.actions}if(o.itemActions){this.itemActions=o.itemActions}if(o.title){this.title=o.title}this.kind=o.kind?o.kind:"reference";if(o.dictionaryJSON&&!o.dictionaryJSON._version){o.dictionaryJSON._version="1.0"}var p=[{text:k.TitleColLabel,dataIndex:"tree",width:"50%",valueAttribute:"_name"},{text:k.TypeColLabel,dataIndex:"_type",valueAttribute:"_type",width:100,isSortable:true,},{text:k.DescriptionColLabel,dataIndex:"_description",valueAttribute:"_description",width:"auto",isSortable:true}];if(o.dictionaryJSON._version==="3.0"){p=UWA.clone(l["3.0"]);var n;p.forEach(function(u,t){if(u){if(u.dataIndex!=="_range"){var v=u.text;u.text=k[v]}else{n=t}}});if(n!==undefined){p.splice(n,1)}}var s={contentTreeOptions:{viewIdentifier:"table",isEditable:true,columns:p,resize:{rows:false,columns:true,},selectionData:{totalCount:0,displayCount:0,selectionCount:0},countParentSelection:false,}};var r={dictionaryJSON:o.dictionaryJSON,kind:this.kind,getAllChildrenOnParentSelection:(o.getAllChildrenOnParentSelection===false)?false:true,getParentOnChildSelection:(o.getParentOnChildSelection===false)?false:true,countParentSelection:false,actions:this.itemActions,contentFilter:o.contentFilter,isEditable:o.isEditable};this.contentViews=[{id:"table",view:i,options:UWA.merge(s,r)}];this._initActionbarOptions();this._parent(o)},_initActionbarOptions:function(){this._actionbarOptions={showItemCount:true,withmultisel:false,filter:{},actions:[],searchOptions:{layout:"inline",enableCache:true,allowMultipleSearch:true,attributeFilter:[{id:"name",text:k.NameColLabel,selected:true},{id:"type",text:k.TypeColLabel,selected:false},{id:"description",text:k.DescriptionColLabel,selected:false}],typeFilter:[{id:"Variants",text:"Variant",selected:true},{id:"Options",text:"Option",selected:true}]}};if(this.showSortAtion){this._actionbarOptions.sortOptions={attributes:[{id:"description",text:k.DescriptionColLabel,selected:true},{id:"name",text:k.NameColLabel,selected:false}],order:"ASC"}}if(this.showSwitchViewAction){this._actionbarOptions.switchViews=[{id:"table",text:"Thumbnail",fonticon:"view-small-tile",selected:false},{id:"table",text:"Table",fonticon:"view-list",selected:false}]}if(this.actions){this._actionbarOptions.actions=this.actions}},render:function(){var p=this;this.container.setContent("");if(this.title&&this.title.trim().length!=0){var n=UWA.createElement("div",{html:this.title,styles:{fontFamily:"Arial",fontSize:"16px",color:"#77797c",margin:"5px 0 3px 8px",fontWeight:"normal"}});n.inject(this.container)}var o=this.buildFilterHeaderSection();o.inject(this.container);this.contentSection=this.buildContentView();this.contentSection.inject(this.container);this.initializeContentViews();this.subscribe("loading-view-start",function(){p.maskContent()});this.subscribe("loading-view-complete",function(q){p.unMaskContent();if(q!=undefined&&(typeof q==="number")){p._stdActionbar._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:q})}});this.switchView("table");return this},viewSorter:function(n){console.log("View Sorter!!!")},buildFilterHeaderSection:function(){var o=this;var n=UWA.createElement("div",{id:"headerCtrlSection","class":"header-ctrl-section"});this._actionbarOptions.onSwitch=function(){o.switchView.apply(o,arguments)};this._actionbarOptions.onSearch=function(p){o.publishViewEvent("onContentFilterCriteriaChange",{filterData:p});console.log("View Filterer!!!")};this._actionbarOptions.onSort=this.viewSorter;this._stdActionbar=new g(o._actionbarOptions);o._stdActionbar._modelEvents.subscribe({event:"enox-collection-toolbar-filter-search-value"},function(p){o.publishViewEvent("onContentFilterCriteriaChange",{filterData:p})});this._stdActionbar.inject(n);return n},buildContentView:function(){var o=this.options;var n=UWA.createElement("div",{id:"contentSection","class":"content-section"});return n},initializeContentViews:function(){if(this.contentViews&&this.contentViews.length>0){this._contentViews={};var n=this;this.contentViews.forEach(function(r,q){var p=r.options?r.options:{};var o=new r.view(p);if(q==0){n._contentViews.currentView=r.id;n._contentViews.view={}}n._contentViews.view[r.id]=o;o.subscribe("onDisplayAndSelCountUpdate",function(s){console.log("onDisplayAndSelCountUpdate callback: "+arguments.toString());n._stdActionbar._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:s.displayCount})});o.render()})}},switchView:function(n){if(this._contentViews){this.contentSection.setContent(this._contentViews.view[n]);this._contentViews.currentView=this._contentViews.view[n]}},publishViewEvent:function(o,p){if(this._contentViews){for(var q in this._contentViews.view){if(!(p.eventOrigin&&q===p.eventOrigin)){var n=this._contentViews.view[q];if(UWA.is(n.publish,"function")){n.publish(o,p,n)}}}}},subscribeViewEvent:function(p,q){if(this._contentViews){for(var n in this._contentViews.view){var o=this._contentViews.view[n];if(UWA.is(o.subscribe,"function")&&UWA.is(q,"function")){o.subscribe(p,q)}}}},unsubscribeAllViewEvent:function(p){if(this._contentViews){for(var n in this._contentViews.view){var o=this._contentViews.view[n];if(UWA.is(o.unsubscribeAll,"function")){o.unsubscribeAll(p)}}}},subscribe:function(n,o){this.subscribeViewEvent(n,o)},publish:function(n,o){this.publishViewEvent(n,o)},unsubscribeAll:function(n){this.unsubscribeAllViewEvent(n)},changeView:function(n){this.switchView(n)},setEditable:function(n){this.publishViewEvent("setEditMode",n)},filter:function(n){this.publishViewEvent("filterDictionaryItem",{filterer:n})},maskContent:function(){f.mask(this.container)},unMaskContent:function(){f.unmask(this.container)},showAttribute:function(n){this.publishViewEvent("showAttribute",{attribute:n})},hideAttribute:function(n){this.publishViewEvent("hideAttribute",{attribute:n})},sortBy:function(o,n){this.publishViewEvent("sortBy",{attribute:o,isAccending:n})},loadDictionary:function(n){this.publishViewEvent("loadDictionary",n)},setAttributes:function(n){this.publishViewEvent("setAttributes",n)},getDictionary:function(n){var o={};this.getDictionaryContent(n);return o},getDictionaryContent:function(n){var o={};if(this._contentViews.view.table&&UWA.is(this._contentViews.view.table.getDictionaryContent,"function")){o=this._contentViews.view.table.getDictionaryContent(n)}return o}});return d});