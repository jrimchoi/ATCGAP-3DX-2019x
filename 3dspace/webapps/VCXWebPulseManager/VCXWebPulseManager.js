define("DS/VCXWebPulseManager/VCXAPulseBehavior",["UWA/Class","DS/CoreEvents/Events","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(d,a,f,g,b,e,h){var c=d.extend({init:function(){this._type=0;this._condition=0;this._conditionChanged=false;this._period=1;this._loop=true;this._sinusMode=true;this._pauseAnim=true;this._isPulsing=false;this._isDirty=false},OnChangeProperty:function(l,j,k){var i=j.GetValue();switch(l){case"Actor.Pulse.Type":if(this._type!==i){this._type=i}if(k&&k.rangeChanged){var n=this;a.publish({event:"VCX_CHANGE_PULSE_PROPERTY",data:n})}break;case"Actor.Pulse.Condition":if(this._condition!==i){this._condition=i;var m=this.GetObject()._experienceBase.getManager("VCXPulseManager");if(m){if(this._condition===c.ECondition.OnHighlight){m.RegisterInteractableObject(this.GetObject())}else{m.UnRegisterInteractableObject(this.GetObject())}}}break;case"Actor.Pulse.Period":if(this._period!==i){this._period=i}break;case"Actor.Pulse.Loop":if(this._loop!==i){this._loop=i}break;case"Actor.Pulse.Sinus":if(this._sinusMode!==i){this._sinusMode=i}break;case"Actor.Pulse.PauseAnim":if(this._pauseAnim!==i){this._pauseAnim=i}break;default:return false}return true},GetProperty:function(m){var k=null;var i=this.GetObject()._experienceBase.getManager("VCXContextManager").getPlayerMode();if(m==="Actor.Pulse.Type"){var l=new e();l.SetValue(this._type);var n=new b(m,0,true,"VCXWebPulseManager/VCXWebPulseManager");var p=this.GetMapChoices();n.SetMapChoiceEnum(p);n.SetGroupId("Group.Effect");if(i){n.SetVisible(false)}k=new f(n,l)}else{if(m==="Actor.Pulse.Condition"){var l=new e();l.SetValue(this._condition);var n=new b(m,1,true,"VCXWebPulseManager/VCXWebPulseManager");var p={0:"effect.condition.onStart",1:"effect.condition.onHighlight"};n.SetMapChoiceEnum(p);n.SetGroupId("Group.Effect");if(i){n.SetVisible(false)}k=new f(n,l)}else{if(m==="Actor.Pulse.Period"){var l=new e();l.SetValue(this._period);var n=new b(m,0,true,"VCXWebPulseManager/VCXWebPulseManager");var p={0:"effect.period.high",1:"effect.period.medium",2:"effect.period.low"};n.SetMapChoiceEnum(p);n.SetGroupId("Group.Effect");k=new f(n,l)}else{if(m==="Actor.Pulse.Loop"){var o=new h();o.SetValue(this._loop);var j=new g(m,1,true,"VCXWebPulseManager/VCXWebPulseManager");j.SetGroupId("Group.Effect");if(i){j.SetVisible(false)}k=new f(j,o)}else{if(m==="Actor.Pulse.Sinus"){var o=new h();o.SetValue(this._sinusMode);var j=new g(m,1,true,"VCXWebPulseManager/VCXWebPulseManager");j.SetGroupId("Group.Effect");if(i){j.SetVisible(false)}k=new f(j,o)}else{if(m==="Actor.Pulse.PauseAnim"){var o=new h();o.SetValue(this._pauseAnim);var j=new g(m,1,true,"VCXWebPulseManager/VCXWebPulseManager");j.SetGroupId("Group.Effect");if(i){j.SetVisible(false)}k=new f(j,o)}else{k=null}}}}}}return k},GetProperties:function(j){j.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Type"));if(this._type!==0){j.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Condition"));j.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Period"));j.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Loop"));j.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Sinus"));if(this._condition===c.ECondition.OnStart){j.AddOrModifyProperty(this.GetProperty("Actor.Pulse.PauseAnim"))}var m=this.GetVectorProperties();for(var k=0;k<m.length;k++){var l=m[k];j.AddOrModifyProperty(this.GetProperty(l))}}},SetIsPulsing:function(i){this._isPulsing=i},GetIsPulsing:function(){return this._isPulsing},SetIsDirty:function(i){this._isDirty=i},GetIsDirty:function(){return this._isDirty},GetVectorProperties:function(){},GetMapChoices:function(){}});c.ECondition={OnStart:0,OnHighlight:1};return c});define("DS/VCXWebPulseManager/VCXPulseManager",["DS/CoreEvents/Events","DS/VCXWebExperienceBase/VCXInteractableObjectsManager","DS/VisuEvents/EventsManager","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdPlayScenario","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile",],function(a,h,g,f,c,b,e){var d=h.extend({initialize:function(){this._parent();this._tokenPreviewMode=null;this._tokenCurrentScenario=null;this._tokenPulseProperty=null;this._tokenStartPlay=null;this._tokenStartPlayTimeline=null;this._tokenStopPlayTimeline=null;this._tokenChangeTimePos=null;this._tokenScenarioChanged=null;this._tokenUndoRedoDone=null;this._modUnderMouse=null;this._mapOfPulseBeh={};this._tokenFrameBackward=null;this._tokenFrameForward=null;this._tokenPrevmarker=null;this._tokenNextMarker=null},postInitialize:function(){var k=this;this._tokenPreviewMode=a.subscribe({event:"VCX_PREVIEW_MODE_CHANGED"},function(l){k.SetPreviewMode(l);if(l){var m=k._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();if(!m){k.onActivateOnStart()}}else{k.StopPulseAllObjects()}});this._tokenStartPlay=a.subscribe({event:"VCX_START_PLAY"},function(){if(k._bPreviewMode){k.StopPulseAllObjects()}});this._tokenStartPlayTimeline=a.subscribe({event:"VCX_Timeline_START_PLAY"},function(){if(k._bPreviewMode){k.StopPulseAllObjects()}});this._tokenStopPlayTimeline=a.subscribe({event:"VCX_Timeline_STOP_PLAY"},function(){if(k._bPreviewMode){k.StopPulseAllObjects()}});var j=function(m){if(k._bPreviewMode){if(Object.keys(k._mapOfPulseBeh).length===0||!m){k.onActivateOnStart()}else{k.StopPulseAllObjects();var l=a.subscribe({event:"VCX_PULSE_STOPPED"},function(){a.unsubscribe(l);if(!m){k.onActivateOnStart()}})}}};this._tokenChangeTimePos=a.subscribe({event:"VCX_TIMEPOS_CHANGED"},function(){if(k._bPreviewMode){j()}});this._tokenUndoRedoDone=a.subscribe({event:"VCX_UNDOREDO_DONE"},function(){if(k._bPreviewMode){j()}});this._tokenScenarioChanged=a.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(){var l=k._experienceBase.getManager("VCXCommandManager");if(l._isUnDoRunning||l._isReDoRunning){return}j()});this._tokenFrameBackward=a.subscribe({event:"VCX_Timeline_STEPBACKWARD_PLAY"},function(){j()});this._tokenFrameForward=a.subscribe({event:"VCX_Timeline_STEPFORWARD_PLAY"},function(){j()});this._tokenPrevmarker=a.subscribe({event:"VCX_Timeline_PREVIOUSMARKER_PLAY"},function(){j()});this._tokenNextMarker=a.subscribe({event:"VCX_Timeline_NEXTMARKER_PLAY"},function(){j()});this._tokenPulseProperty=a.subscribe({event:"VCX_CHANGE_PULSE_PROPERTY"},function(p){var n=null;var r=p;if(r&&k._bPreviewMode){n=r.GetProperty("Actor.Pulse.Type").GetPropertyValue().GetValue();if(n===0){if(r.GetIsPulsing()){k.StopPulseOneObject(r)}return}}else{return}var q=k._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();var m=r.GetProperty("Actor.Pulse.PauseAnim").GetPropertyValue().GetValue();if(q&&m){if(!k._bPassed){k._bPassed=true;var o=k._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();var l=k.GetFrameForStop(r,o);if(l===0){return}if(l!==o){k._experienceBase.getManager("VCXScenarioManager").SetCurrentFrame(l)}k._experienceBase.getManager("VCXScenarioManager").UpdateProperties()}k.onActivateOnStart(true);k._experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(false);a.publish({event:"VCX_PAUSE_PLAY",data:l});k._bPassed=false}});var k=this;this._onVisuEvent=function i(m){if(k._bPreviewMode&&k.GetActiveInteraction()){var l=f.GetModifiableFromEvent(m,k._experienceBase);if(l){k.StopPulseOnHighlight(l);k.onActivateOnHighlight(l)}else{k.StopPulseOnHighlight();k._modUnderMouse=null}}};g.addEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerMoveUnique",this._onVisuEvent)},unInitialize:function(){this._parent();if(this._tokenPreviewMode){a.unsubscribe(this._tokenPreviewMode);this._tokenPreviewMode=null}if(this._tokenStartPlay){a.unsubscribe(this._tokenStartPlay);this._tokenStartPlay=null}if(this._tokenStartPlayTimeline){a.unsubscribe(this._tokenStartPlayTimeline);this._tokenStartPlayTimeline=null}if(this._tokenStopPlayTimeline){a.unsubscribe(this._tokenStopPlayTimeline);this._tokenStopPlayTimeline=null}if(this._tokenChangeTimePos){a.unsubscribe(this._tokenChangeTimePos);this._tokenChangeTimePos=null}if(this._tokenScenarioChanged){a.unsubscribe(this._tokenScenarioChanged);this._tokenScenarioChanged=null}if(this._tokenPulseProperty){a.unsubscribe(this._tokenPulseProperty);this._tokenPulseProperty=null}if(this._tokenUndoRedoDone){a.unsubscribe(this._tokenUndoRedoDone);this._tokenUndoRedoDone=null}if(this._tokenUndoRedoDone){a.unsubscribe(this._tokenUndoRedoDone);this._tokenUndoRedoDone=null}if(this._tokenFrameBackward){a.unsubscribe(this._tokenFrameBackward);this._tokenFrameBackward=null}if(this._tokenFrameForward){a.unsubscribe(this._tokenFrameForward);this._tokenFrameForward=null}if(this._tokenPrevmarker){a.unsubscribe(this._tokenPrevmarker);this._tokenPrevmarker=null}if(this._tokenNextMarker){a.unsubscribe(this._tokenNextMarker);this._tokenNextMarker=null}g.removeEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerMoveUnique",this._onVisuEvent)},SetPreviewMode:function(i){this._bPreviewMode=i},GetFrameForStop:function(o,l){var m=l;var i=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();var n=this._experienceBase.ComponentsMap.GetComponentFromID(i);var q=o.QueryInterface("VCXIModifiable");var p=n.GetObjectAnimation(q.GetHashing());var k=p.GetTrack("Actor.Pulse.Type");var j=k.GetPreviousKey(l,j);if(j.GetValue()){m=j.GetFrame()}return m},StopPulseOnHighlight:function(i){if(this._modUnderMouse){var k="";var j=this._modUnderMouse.GetHashing();if(i){k=i.GetHashing()}if(j!==k){this.StopPulseOneObject(this._modUnderMouse.QueryInterface("VCXIPulseBehavior"))}}},ReturnPulsingObjects:function(){return this._mapOfPulseBeh},StopPulse:function(l,k){var j=Object.keys(this.ReturnPulsingObjects()).length;if(this._bPreviewMode&&j!==0){var i=a.subscribe({event:"VCX_PULSE_STOPPED"},function(){a.unsubscribe(i);if(l){l(k)}});this.StopPulseAllObjects()}else{if(l){l(k)}}},StopPulseAllObjects:function(){for(var k in this._mapOfPulseBeh){if(this._mapOfPulseBeh.hasOwnProperty(k)){var j=this._experienceBase.ComponentsMap.GetComponentFromID(k);if(j){var l=j.QueryInterface("VCXIPulseBehavior");l.SetIsDirty(true);var i=this._mapOfPulseBeh[k];if(i){i.StopPlayingScenario()}}}}},StopPulseOneObject:function(l){if(l){l.SetIsDirty(true);var j=l.GetObject();if(j){var k=j.GetID();var i=this._mapOfPulseBeh[k];if(i){i.StopPlayingScenario()}}}},onActivateOnHighlight:function(i){var j=this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();var l=i.GetObject().QueryInterface("VCXIPulseBehavior");if(l&&!j){var k=l.GetProperty("Actor.Pulse.Condition").GetPropertyValue().GetValue();if(k===1){this._modUnderMouse=i;this.UpdatePulse(l)}}},onActivateOnStart:function(t){var j=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();var q=this._experienceBase.ComponentsMap.GetComponentFromID(j);var l=this._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();var o=[];if(q){q.GetListModifiables(o)}for(var p=0;p<o.length;p++){var u=o[p];var v=this._experienceBase.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(u);var n=v.GetObject();var r=n.QueryInterface("VCXIPulseBehavior");if(r){var m=r.GetProperty("Actor.Pulse.Condition").GetPropertyValue().GetValue();if(m===0){if(t){var s=q.GetObjectAnimation(u);var k=s.GetTrack("Actor.Pulse.Type");if(k&&k.GetKey(l)){}else{continue}}this.UpdatePulse(r)}}}},UpdatePulse:function(I){var n=0;var o=true;if(I){o=I.GetIsPulsing();n=I.GetProperty("Actor.Pulse.Type").GetPropertyValue().GetValue()}if(n!==0&&!o){var E=I.GetVectorProperties();if(E.length){var y=this._experienceBase.Factory.BuildComponent("VCXScenario");y.SetApplyNeutralAtGoToScenario(false);var H=I.GetProperty("Actor.Pulse.Period").GetPropertyValue().GetValue();var u=0,t=25,s=50;if(H===1){t=40;s=80}else{if(H===2){t=50;s=100}}var B=new e();B.SetLockEvents(true);var z=new e();var j=new c(this._experienceBase.getManager("VCXScenarioManager"));j.SetLockEvents(true);var D=I.GetObject().QueryInterface("VCXIModifiable");var x=I.GetProperty("Actor.Pulse.Sinus").GetPropertyValue().GetValue();for(var G=0;G<E.length;G++){var v=E[G];var k=D.GetProperty(v).Clone();var m=k.GetPropertyValue();var A=v.substr(6);var q=D.GetProperty(A).Clone();var C=q.GetPropertyValue();z.ChangeProperty(D,q);var w=q.Clone();w.SetPropertyValue(m);B.ChangeProperty(D,w);j.ChangeKey(y,D,A,u,m);j.ChangeKey(y,D,A,t,C);if(x){j.ChangeKey(y,D,A,s,m)}}this._experienceBase.getManager("VCXCommandManager").Do(j);var F=this;var r=function(){I.SetIsPulsing(false);I.SetIsDirty(false);F.RemovePulsingObject(I);if(Object.keys(F._mapOfPulseBeh).length===0){a.publish({event:"VCX_PULSE_STOPPED"})}};var l=function(i){F._experienceBase.getManager("VCXCommandManager").Do(i);r()};var J=new b(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.ComponentsMap,this._experienceBase.getManager("VCXCommandManager"));J.PlayScenario(y,0,true);var p=function(i){var L=I.GetIsDirty();if(!L){var K=I.GetProperty("Actor.Pulse.Loop").GetPropertyValue().GetValue();if(K){i.SetCallback(p,i)}else{i.SetCallback(l,z)}F._experienceBase.getManager("VCXCommandManager").Do(i)}else{l(z)}};I.SetIsPulsing(true);this.AddPulsingObject(I,J);B.SetCallback(p,J);this._experienceBase.getManager("VCXCommandManager").Do(B)}}},AddPulsingObject:function(j,i){this._mapOfPulseBeh[j.GetObject().GetID()]=i},RemovePulsingObject:function(j){var i=j.GetObject().GetID();delete this._mapOfPulseBeh[i]}});Object.defineProperty(d.prototype,"componentType",{enumerable:true,get:function(){return"VCXPulseManager"}});return d});define("DS/VCXWebPulseManager/VCXIPulseBehavior",["DS/WebComponentModeler/CATWebInterface"],function(a){var b=a.singleton({interfaceName:"VCXIPulseBehavior",required:{OnChangeProperty:function(d,c){},GetProperty:function(c){},GetProperties:function(c){},SetIsPulsing:function(c){},GetIsPulsing:function(){},GetVectorProperties:function(){},GetMapChoices:function(){}},optional:{}});return b});define("DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",["DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebPulseManager/VCXAPulseBehavior","DS/VCXWebProperties/VCXPropertyValueColor",],function(a,c,f,b,e){var d=b.extend({init:function(){this._parent();this._imageColor=new a();this._imageColor.SetRGBA(1,0,0,1);this._backgroundColor=new a();this._backgroundColor.SetRGBA(1,0,0,1)},OnChangeProperty:function(j,h,i){var g=h.GetValue();if(j==="Pulse.Collab.Image.Color"){if(g.r!==this._imageColor.r||g.g!==this._imageColor.g||g.b!==this._imageColor.b){this._imageColor=g}}else{if(j==="Pulse.Collab.Background.Color"){if(g.r!==this._backgroundColor.r||g.g!==this._backgroundColor.g||g.b!==this._backgroundColor.b){this._backgroundColor=g}}else{return this._parent(j,h,i)}}return true},GetProperty:function(j){var i=null;if(j==="Pulse.Collab.Image.Color"){var h=new e();h.SetValue(this._imageColor);var g=new f(j,0,true,"VCXWebPulseManager/VCXWebPulseManager");g.SetGroupId("Group.Effect");i=new c(g,h)}else{if(j==="Pulse.Collab.Background.Color"){var h=new e();h.SetValue(this._backgroundColor);var g=new f(j,0,true,"VCXWebPulseManager/VCXWebPulseManager");g.SetGroupId("Group.Effect");i=new c(g,h)}else{i=this._parent(j)}}return i},GetMapChoices:function(){var g={0:"effect.type.none",1:"effect.type.pulse.color",};return g},GetVectorProperties:function(){var g=[];if(this._type===1){g.push("Pulse.Collab.Image.Color");g.push("Pulse.Collab.Background.Color")}return g}});return d});define("DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",["DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebPulseManager/VCXAPulseBehavior","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor"],function(b,d,f,c,a,e){var g=c.extend({init:function(){this._parent();this._color=new b();this._color.SetRGBA(1,0,0,1);this._opacity=1},OnChangeProperty:function(k,i,j){var h=i.GetValue();switch(k){case"Pulse.Actor.Color":if(h.r!==this._color.r||h.g!==this._color.g||h.b!==this._color.b){this._color=h}break;case"Pulse.Actor.Opacity":if(h!==this._opacity){this._opacity=h}break;default:return this._parent(k,i,j)}return true},GetProperty:function(k){var j=null;if(k==="Pulse.Actor.Color"){var i=new e();i.SetValue(this._color);var h=new f(k,0,true,"VCXWebPulseManager/VCXWebPulseManager");h.SetGroupId("Group.Effect");j=new d(h,i)}else{if(k==="Pulse.Actor.Opacity"){var l=new a();l.SetValue(this._opacity);var h=new f(k,1,true,"VCXWebPulseManager/VCXWebPulseManager");h.SetGroupId("Group.Effect");h.SetBounds(0,1,0.1);j=new d(h,l)}else{j=this._parent(k)}}return j},GetMapChoices:function(){var h={0:"effect.type.none",1:"effect.type.pulse.color",};return h},GetVectorProperties:function(){var h="Pulse.Actor.Color";var i=[];if(this._type===1){i.push(h)}return i},SetIsPulsing:function(k){this._isPulsing=k;var j=this.QueryInterface("VCXIModifiable");if(j){}else{return}var i=j.GetProperty("Actor.Color.Defined").GetPropertyValue();if(i){var h=i.Clone();if(k){this._currentColorDefined=i.GetValue();h.SetValue(true)}else{h.SetValue(this._currentColorDefined)}j.OnChangeProperty("Actor.Color.Defined",h);j.OnChangePropertiesEnd()}},});return g});