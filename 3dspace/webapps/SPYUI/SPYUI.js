/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/SPYUI/commands/CATSPYInfoAccessCmd",["UWA/Core","DS/Core/Core","DS/ApplicationFrame/CommandCheckHeader"],function(d,c,a){var b=a.extend({init:function(e){this._parent(e);this.onStateChange(function(){if(!this._processingStateChange){this._processingStateChange=true;var h=this.getState();if(this.getFrameWindow().SPMUI){this.getFrameWindow().SPMUI.setInformationStatus(h);if(h){var f=c.Selection.CSOManager.get();if(f.length>0){var g=f[0].pathElement;c.Selection.CSOManager.empty();c.Selection.HSOManager.empty();c.Selection.CSOManager.unique({pathElement:g});c.Selection.HSOManager.unique({pathElement:g})}}}this._processingStateChange=undefined}}.bind(this))}});return b});define("DS/SPYUI/commands/CATSPYMSRAccessCmd",["css!DS/SPYUI/commands/CATSPYMSRAccessCmd.css","UWA/Core","DS/CoreEvents/Events","DS/WebSystem/Nls","DS/ApplicationFrame/Command","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/SPYLoader/SPYLoader"],function(b,f,e,i,c,g,d,h){var a=c.extend({init:function(j){this._parent(j,{isAsynchronous:true,mode:"exclusive"});this._loadCb=e.subscribe({event:j.context+"/MODEL/LOADINGFINISHED"},function(){if(this._GlobalContainer){this._GlobalContainer.remove();delete this._GlobalContainer;this._GlobalContainer=null}}.bind(this))},destroy:function(){if(this._loadCb){e.unsubscribe(this._loadCb)}},beginExecute:function(){this._scrollerDrag=false},endExecute:function(){this.getFrameWindow().getActionBar().open();if(this._GlobalContainer){this._GlobalContainer.remove()}},_createReport:function(v){var k=h.getReport();if(k){var o=k.noStream;var t=!isNaN(k.streamTimeOut);var w=!isNaN(k.invalidStreamNb);var l=k.filteredContent;var x=(!l&&!isNaN(k.filteredDDNb)&&k.filteredDDNb>0);if(o||t||w||l||x){this._errorReport=new f.Element("div",{"class":"spy-report-container"}).inject(v);var u=function(F,G,C){var I="wux-ui-3ds wux-ui-3ds-1x spy-report-icon";var E;if(F==="warning"){I+=" wux-ui-3ds-alert spy-report-alertIcon";E="spy-report-alert"}else{I+=" wux-ui-3ds-info spy-report-infoIcon";E="spy-report-info"}var B=new f.Element("div",{"class":E}).inject(this._errorReport);var H=new f.Element("span",{"class":I}).inject(B);var D=new f.Element("span",{"class":"spy-report-text"}).inject(B);i.nls("SPYUI/ContentReport",G,function(J){D.setText(C?C+" "+J:J)})}.bind(this);if(o){u("warning","noStream")}else{if(t){var q=new f.Element("div",{"class":"spy-report-alert"}).inject(this._errorReport);var m=new f.Element("span",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-alert spy-report-icon spy-report-alertIcon"}).inject(q);var y=new f.Element("span",{"class":"spy-report-text"});var A=new f.Element("a",{"class":"spy-report-text"});var r=new f.Element("ul");var s=function(B){B.stopPropagation();r.show();m.hide();y.hide();A.hide()};y.inject(q);i.nls("SPYUI/ContentReport","timeOut",function(B){y.setText(B)});A.addEvent("click",s);q.addEvent("click",s);A.inject(q);r.addEvent("click",function(B){B.stopPropagation();r.hide();m.show();y.show();A.show()});r.inject(q);r.hide();i.nls("SPYUI/ContentReport","timeOutMore",function(B){A.setText(B)});var z=navigator.userAgent.indexOf("Trident")>=0;if(z){var j=new f.Element("li",{"class":"spy-report-text"}).inject(r);i.nls("SPYUI/ContentReport","timeOutCause1",function(B){j.setText(B)})}var n=new f.Element("li",{"class":"spy-report-text"}).inject(r);i.nls("SPYUI/ContentReport","timeOutCause2",function(B){n.setText(B)});var p=new f.Element("li",{"class":"spy-report-text"}).inject(r);i.nls("SPYUI/ContentReport","timeOutCause3",function(B){p.setText(B)})}if(w){u("info",k.invalidStreamNb>1?"invalid":"invalid1",k.invalidStreamNb.toString())}if(l){u("info","filteredContent")}if(x){u("info",k.filteredDDNb>1?"partialFiltered":"partialFiltered1",k.filteredDDNb.toString())}}}}},handleResponsive:function(){var l=this.getFrameWindow().elements.container;if(!l.querySelector(".spy-msr-globalcontainer")){return}var k=l.querySelector(".spy-sequence-container");var j=l.querySelector(".spy-msr-centerzone");k.removeClassName("smaller");j.removeClassName("smaller");if(6*k.offsetHeight>l.offsetHeight){k.addClassName("smaller");if(j.offsetHeight<120){j.addClassName("smaller")}}},execute:function(){var O=this.getFrameWindow();O.getActionBar().close();var x=O.SPMUI;var I=x.spm;if(this._GlobalContainer){this._GlobalContainer.inject(O.getUIFrame());var z=this._GlobalContainer.getElementsByClassName("spy-msr-thumbnailcontainer");var w=z[x.getActiveSequence()];if(w){var o=w.getElementsByClassName("spy-msr-thumbnail");var C=parseInt(x.activeDD);for(var M=0;M<o.length;M++){var J=o[M];if(J){J.setAttributes({activated:(C===M)?"true":"false"})}}}}else{var s=[];var E=[];this._GlobalContainer=new f.Element("div",{"class":"spy-msr-globalcontainer",styles:{backgroundColor:"rgba(200,200,200, 0.7)"}}).inject(O.getUIFrame());var F=new f.Element("div",{"class":"spy-msr-reportzone"}).inject(this._GlobalContainer);d.subscribe({event:this._ctx+"/SPY/VIEWERRESIZE"},this.handleResponsive.bind(this));var l=new f.Element("div",{"class":"spy-sequence-container",events:{click:function(R){var S=R.target;if(S.hasClassName("spy-sequence-container")){this.end()}}.bind(this)}}).inject(this._GlobalContainer);var u=new f.Element("div",{"class":"spy-msr-centerzone",events:{click:function(R){var S=R.target;if(S.hasClassName("spy-msr-thumbnailcontainer")||S.hasClassName("spy-msr-centerzone")||S.hasClassName("-wrapper")){this.end()}}.bind(this)}}).inject(this._GlobalContainer);var r=function(){this._scrollerStartY=this._scroller.position.y;this._scrollerDrag=false}.bind(this);var y=function(){if(this._scrollerStartY!==this._scroller.position.y){this._scrollerDrag=true}}.bind(this);var P=function(){};var n=I.getNbSequences();for(var p=0;p<n;p++){var N=I.getDataDisplayList(p);var D=N.length;var m=[];var L=I.getZipEntries(p);for(var H=0;H<D;H++){var v=N[H];if(v){var Q={idx:H,name:v.name,subName:v.subName,thumbnail:v.thumbnail,category:v.category,animated:v.isAnimated(),activated:v.activated};m.push(Q)}}var k=new f.Element("div",{"class":"spy-msr-thumbnailcontainer"}).inject(u);this.loadThumbnails(m,k,L,x);var K=new f.Controls.Scroller(k,{snap:false,bounce:false,momentum:true,lockDirection:true,scrollDrag:true,scrollableX:false,scrollableY:true,scrollbarH:false,scrollbarV:true,events:{onScrollInit:r,onScrollStop:y}});K.elements.ghost.remove();K.updateGhostPosition=P;E.push(K);this._scroller=K;s.push(k);k.hide()}var t=function(T){var U=T.currentTarget;var aa=parseInt(U.id);x.activateSequence(aa);var Z;var R=U.getParent();if(R){Z=R.getChildren()}for(var ae=0;ae<Z.length;ae++){var X=Z[ae];if(X){X.removeClassName("spy-sequence-current")}var Y=s[ae];if(Y){Y.hide()}var S=E[ae];if(S){S.elements.scroller.hide()}}U.addClassName("spy-sequence-current");this._scroller=E[aa];if(this._scroller){var W=s[aa];if(W){W.show();var ad=I.getDataDisplayList(aa);var ac=0;while(ac<ad.length&&!ad[ac].activated){ac++}var V=W.getChildren();for(var ab=0;ab<V.length;ab++){V[ab].setAttributes({activated:(ac===ab)?"true":"false"})}}this._scroller.elements.scroller.show()}}.bind(this);for(var A=0;A<I.getNbSequences();A++){var j=I.getDataDisplayList(A);if(j.length>0){var B=new f.Element("div",{id:A,"class":"spy-sequence",events:{click:t}}).inject(l);var q=new f.Element("p").inject(B);q.setText(I.getSequenceName(A));if(A===x.getActiveSequence()){this._scroller=E[A];B.addClassName("spy-sequence-current");var G=s[A];if(G){G.show()}}else{B.removeClassName("spy-sequence-current")}}}this._createReport(F)}this.handleResponsive()},loadThumbnails:function(y,t,l,m){if(y.length===0){return}var k="image/PNG";var x=null;var v=y.shift();var u=v.thumbnail;if(u){x=l.find(u)}var r=v.name;var j=v.subName;var n=v.category;var q=v.activated;var w=v.idx;var p=v.animated;var s=this;var o=function(C){var z=new f.Element("div",{id:w,"class":"spy-msr-thumbnail",activated:q,events:{click:function(){if(!s._scrollerDrag){m.activateDD(this.id);s.end()}}}}).inject(t);z.addClassName("spy-msr-thumbnail-background");if(C===undefined){var D=new f.Element("img",{"class":"spy-msr-nothumbnail-category-image",category:n}).inject(z);D.addClassName("spy-msr-thumbnail-image")}else{var G=new f.Element("img",{"class":"spy-msr-thumbnail-image"}).inject(z);G.src=C}var A=g.getWebappsBaseUrl();if(p){var F=new f.Element("img",{"class":"spy-msr-thumbnail-play-decoration"}).inject(z);F.src=A+"SPYUI/assets/I_SimNavPlayDeco.png"}var H=new f.Element("img",{"class":"spy-msr-thumbnail-category-decoration"}).inject(z);switch(n){case"Model":H.src=A+"SPYUI/assets/icons/32/I_SimNavCategory_M_decoration.png";break;case"Scenario":H.src=A+"SPYUI/assets/icons/32/I_SimNavCategory_S_decoration.png";break;case"Result":H.src=A+"SPYUI/assets/icons/32/I_SimNavCategory_R_decoration.png";break;default:break}var E=new f.Element("div",{"class":"spy-msr-thumbnail-header"}).inject(z);var B=new f.Element("div",{"class":"spy-msr-thumbnail-header-background"}).inject(E);var J=new f.Element("p",{"class":"spy-msr-thumbnail-title"}).inject(B);J.setText(r);J.setAttributes({title:r});if(j){var I=new f.Element("p",{"class":"spy-msr-thumbnail-title"}).inject(B);I.setText(j);I.setAttributes({title:j})}s.loadThumbnails(y,t,l,m)};if(x){x.getBlob(k,function(A){var z=URL.createObjectURL(A);o(z)})}else{o()}}});return a});define("DS/SPYUI/commands/CATSPYResetCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core","DS/CoreEvents/Events"],function(e,a,d,b){var c=a.extend({init:function(f){this._parent(f,{isAsynchronous:true,mode:"shared"})},beginExecute:function(){this._viewer=this.getFrameWindow().getViewer();b.publish({event:this._ctx+"/SPY/SELECTION/KEEPONLY_STOP"})},endExecute:function(){d.Selection.CSOManager.empty();d.Selection.HSOManager.empty()}});return c});define("DS/SPYUI/GuidanceMsg",["css!DS/SPYUI/Guidance.css","UWA/Core","UWA/Class","DS/WebSystem/Nls","DS/WebappsUtils/WebappsUtils"],function(f,e,c,d,b){var a=c.extend({_expand:function(){this._expanded=true;this._extButton.removeClassName("wux-ui-3ds-open-down");this._extButton.addClassName("wux-ui-3ds-open-up")},_collapse:function(){this._expanded=false;this._extButton.removeClassName("wux-ui-3ds-open-up");this._extButton.addClassName("wux-ui-3ds-open-down")},init:function(i){this._parent();if(i&&i.msgData&&i.nlsModule&&i.nlsFile&&i.parentContainer){this._extendedMsg=i.extendedMsg;if(this._extendedMsg){this._extendedMsg.onHide=function(){this._collapse()}.bind(this)}this._expanded=false;this._container=new e.Element("div",{"class":"guidance-msg-container",events:{click:function(){if(this._extendedMsg){if(this._expanded){this._extendedMsg.hide();this._collapse()}else{this._extendedMsg.show();this._expand()}}}.bind(this)}}).inject(i.parentContainer);var g=new e.Element("span",{"class":"guidance-msg-text"}).inject(this._container);d.nls(i.nlsModule+"/"+i.nlsFile,i.msgData.text,function(j){g.setText(j)});var h=new e.Element("span",{"class":"guidance-msg-image"}).inject(this._container);h.style["background-image"]='url("'+b.getWebappsBaseUrl()+i.msgData.image+'")';if(i.extendedMsg){this._extButton=new e.Element("span",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-down guidance-extend-symbol",}).inject(this._container)}}},remove:function(){if(this._container){this._container.remove();this._container.destroy()}}});return e.namespace("DS/SPYUI/GuidanceMsg",a)});define("DS/SPYUI/commands/CATSPYToggleStreamsCmd",["UWA/Core","DS/CoreEvents/Events","DS/ApplicationFrame/CommandCheckHeader"],function(d,b,a){var c=a.extend({init:function(e){this._parent(e);this.onStateChange(function(){if(!this._processingStateChange){this._processingStateChange=true;var i=this.getState();var h=this.getFrameWindow();if(h&&h.SPMUI){var g=h.SPMUI.frameStreamlines;if(g){g.style.display=i?"block":"none";if(i){b.publish({event:this._context+"/SPY/STREAMLINESMGR/SHOW"})}else{b.publish({event:this._context+"/SPY/STREAMLINESMGR/HIDE"})}var f=h.SPMUI.streamsManager;if(f){if(i){f.startSync()}else{f.stopSync()}}}}this._processingStateChange=undefined}}.bind(this))}});return c});define("DS/SPYUI/commands/CATSPYCameraSelectorCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader"],function(c,a){var b=a.extend({init:function(d){this._parent(d);this.onStateChange(function(){if(!this._processingStateChange){this._processingStateChange=true;var e=this.getState();if(this.getFrameWindow().SPMUI){this.getFrameWindow().SPMUI.setCameraBrowsingStatus(e)}this._processingStateChange=undefined}}.bind(this))},});return b});define("DS/SPYUI/controllers/CATSimNavDataOverlaysManager",["css!DS/SPYUI/controllers/CATSimNavDataOverlaysManager.css","i18n!DS/SPYUI/assets/nls/CATSimNavDataOverlaysManager","UWA/Core","UWA/Class","DS/Core/Core","DS/CoreEvents/Events","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Visualization/PathElement"],function(c,j,g,l,i,e,h,a,f,d){var b=function(m,n){if(m){m.setAttribute("visibility",n);if(m.spyVisIcon){m.spyVisIcon.setAttribute("visFlag",n?"shown":"hidden")}}};var k=l.extend({init:function(n){this._parent();if(n&&n.parentContainer&&n.viewer&&n.model&&n.model.streamlines){this._viewer=n.viewer;this._eventId=n.model.eventId;this._onVisibilityChange=n.onVisibilityChange;var m="visibility";var v=j.get("nameAttr");var o="";var p=function(x){var s=new g.Element("div",{"class":"spy-overlay-iconCell spy-overlay-visibiltyIcon",visFlag:x?"shown":"hidden"});return s};this._treeListOptions={apiVersion:2,performances:{renderingMode:"adaptive"},defaultCellHeight:40,iconsSize:0,isEditable:true,shouldBeEditable:false,columns:[{text:o,dataIndex:m,width:30,onCellRequest:function(s){if(!s.isHeader){var x=s.nodeModel.options.grid.visibility;var y=p(x);s.cellView.getContent().setContent(y);s.nodeModel.spyVisIcon=y}}},{text:v,dataIndex:"tree"}],roots:[]};this._treeListOptions.show={columnHeaders:false};this._treeListOptions.height=150;this._treeListOptions.useAsyncPreExpand=true;this._treeListOptions.selection={nodes:false,rowHeaders:false,columnHeaders:false,toggle:false,canMultiSelect:false};this._treeModel=new a({shouldAcceptDrop:function(){return false}});var q=n.model.streamlines;for(var w=0;w<q.length;w++){var u=q[w];var r=new f({label:u.name,grid:{visibility:u.visibility,tree:u.name}});r.spmElement=u;u.treeNode=r;this._treeModel.addRoot(r)}this._container=new g.Element("div",{"class":"spy-overlay-container"}).inject(n.parentContainer);this._containerHeader=new g.Element("div").inject(this._container);this._titleIcon=new g.Element("span",{"class":"spy-overlay-titleIcon"}).inject(this._containerHeader);this._title=new g.Element("span",{"class":"spy-overlay-title"}).inject(this._containerHeader);this._title.setText(j.get("title"));this._treeListOptions.treeDocument=this._treeModel;this._treeListView=new h(this._treeListOptions).inject(this._container);this._treeListView.getContent().addClassName("spy-overlay-treelistview-theme");var t=function(x){if(x&&x.spmElement){var s=x.spmElement;if(s&&s.isActive&&s.isActive()&&this._viewer){s.QI("CATISimNavDataSpecUI",function(y){var z=new d([y.node.getParents()[0],y.node]);this._viewer.addToCSOHSO({path:[z]},{multiSel:false,trapSel:false});setTimeout(function(){x.unhighlight()},300)}.bind(this))}}}.bind(this);this._treeListView.onNodeClick(function(s){t(s.nodeModel)})}},startSync:function(){if(this._eventId){this._visChangeCallback=e.subscribe({event:this._eventId},this._visibilityChanged.bind(this))}},stopSync:function(){if(this._visChangeCallback){e.unsubscribe(this._visChangeCallback)}},showAll:function(){var n=this._treeModel.getRoots();for(var m=0;m<n.length;m++){b(n[m],true)}},setRightOffset:function(m){if(!isNaN(m)){if(m>0){this._container.style.right=(m+40).toString()+"px"}else{this._container.style.right=""}}},_visibilityChanged:function(m){if(m.isAStreamLine&&m.treeNode){b(m.treeNode,!m.treeNode.options.grid.visibility)}}});return g.namespace("DS/SPYUI/controllers/CATSimNavDataOverlaysManager",k)});define("DS/SPYUI/CATSimNavDataWatermark",["css!DS/SPYUI/CATSimNavDataWatermark.css","UWA/Core","UWA/Class"],function(c,d,b){var a=b.extend({init:function(e){this._parent();if(e&&e.imageURL&&e.parentContainer){this._container=new d.Element("div",{"class":"spy-watermark-container"}).inject(e.parentContainer);this._image=new d.Element("img",{"class":"spy-watermark-image"}).inject(this._container);this._image.src=e.imageURL;if(e.actionBarManager){e.actionBarManager.addToActionBarEvent(this._container)}}},setRightOffset:function(e){if(!isNaN(e)){if(e>0){this._container.style.right=(e+30).toString()+"px"}else{this._container.style.right=""}}},setBottomOffset:function(e){if(!isNaN(e)){if(e>0){this._container.style.bottom=(e+50).toString()+"px"}else{this._container.style.bottom=""}}},show:function(){if(this._image){this._image.show()}},hide:function(){if(this._image){this._image.hide()}},drawToCanvas:function(e){if(e&&this._container&&this._image){e.drawImage(this._image,this._container.offsetLeft,this._container.offsetTop,this._image.width,this._image.height)}}});return d.namespace("DS/SPYUI/CATSimNavDataWatermark",a)});define("DS/SPYUI/CATSimNavDataSpeedControl",["css!DS/SPYUI/CATSimNavDataSpeedControl.css","i18n!DS/SPYUI/assets/nls/CATSimNavDataSpeedControl","UWA/Core","DS/CoreEvents/Events","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Windows/ImmersiveFrame","DS/Windows/Panel"],function(j,i,g,e,k,b,h,d){const a=-120;const c=-150;var f=g.Class.extend({_setPanelPosition:function(l){if(this._panel&&this._panel.elements.container){this._panel.setProperties({position:{my:"bottom left",at:"bottom left",offsetY:l}})}},init:function(m){this._parent();var n=new g.Element("div",{"class":"spy-speedcontrol-container",id:"speed"});this._label=new g.Element("span",{"class":"spy-speedcontrol-label"}).inject(n);this._label.setText(i.get("title"));this._buttonGroup=new b();this._buttonGroup.inject(n);this._buttonGroup.elements.container.addClassName("spy-speedcontrol-buttongroup");this._buttonGroup.addChild(new k({type:"radio",label:"1/8",value:0.125}));this._buttonGroup.addChild(new k({type:"radio",label:"1/4",value:0.25}));this._buttonGroup.addChild(new k({type:"radio",label:"1/2",value:0.5}));this._buttonGroup.addChild(new k({type:"radio",label:"x1",value:1}));this._buttonGroup.addChild(new k({type:"radio",label:"x2",value:2}));this._buttonGroup.addChild(new k({type:"radio",label:"x4",value:4}));this._buttonGroup.addChild(new k({type:"radio",label:"x8",value:8}));this._buttonGroup.multiSelFlag=false;this._buttonGroup.addEventListener("change",function l(r){m.onChange(r.dsModel.value[0])});var p=this._buttonGroup.getButtonFromValue(m.speedFactor);if(p){this._buttonGroup.selectIndex(this._buttonGroup.getButtonIndex(p))}var o=new h({identifier:"SPY_SpeedControlFrame"});this._panel=new d({titleBarVisibleFlag:false,visibleFlag:false,content:n,position:{my:"bottom left",at:"bottom left",offsetY:-120},resizableFlag:false,allowedDockAreas:0,identifier:"SPY_SpeedControl_Panel"});this._setPanelPosition(a);if(m.actionBar){var q=m.actionBar;if(q.getLabelsVisibility()){this._setPanelPosition(c)}q.onShowLabels(function(){this._setPanelPosition(c)}.bind(this));q.onHideLabels(function(){this._setPanelPosition(a)}.bind(this))}o.addWindow(this._panel);o.inject(m.container);if(m.resizeEvent){this.resizeCallback=e.subscribe({event:m.resizeEvent},this.updateSizeResponsive.bind(this))}this.updateSizeResponsive(m.initialLayoutId);setTimeout(function(){this._panel.show()}.bind(this),150)},destroy:function(){this._panel.close();this._parent();e.unsubscribe(this.resizeCallback)},updateSizeResponsive:function(l){if(l==="small"){this._label.hide();this._buttonGroup.minButtonWidth=40}else{this._label.show();this._buttonGroup.minButtonWidth=65}}});return g.namespace("DS/SPYUI/CATSimNavDataSpeedControl",f)});define("DS/SPYUI/commands/CATSPYKeepOnlyCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/CoreEvents/Events"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e);this.onStateChange(function(){if(!this._processingStateChange){this._processingStateChange=true;var f=this.getState();b.publish({event:this._context+"/SPY/SELECTION/KEEPONLY"+(f?"_ON":"_OFF"),data:this});this._processingStateChange=undefined}}.bind(this))}});return c});define("DS/SPYUI/controllers/CATSimNavDataSyncManager",["css!DS/SPYUI/controllers/CATSimNavDataSyncManager.css","UWA/Core","UWA/Utils","UWA/Utils/InterCom","DS/PlatformAPI/PlatformAPI","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS"],function(j,e,f,h,k,m,r){var a="CATSimNav.ViewpointChanged";var i="CATSimNav.Probing";var s="CATSimNav.AnimationPlay";var d="CATSimNav.AnimationClear";var q="CATSimNav.AnimationFrameChanged";var n="CATSimNav.FrameNavigation";var o="CATSimNav.SyncSubscribe";var p="CATSimNav.SyncListUpdate";var l="CATSimNav.InstanceDispose";var b="CATSimNav.LegendMinEdited";var u="CATSimNav.LegendMaxEdited";var c="CATSimNav.LegendDataRequest";var t="CATSimNav.LegendDataResponse";var g=e.Class.extend({_isSyncDomainOn:function(v){var w=false;for(var x in this.syncWith){if(this.syncWith[x][v]){w=true}}return w},_isViewSyncOn:function(){return this._isSyncDomainOn("viewchange")},_isFrameNavSyncOn:function(){return this._isSyncDomainOn("framenav")},_isLegendSyncOn:function(){return this._isSyncDomainOn("legendminmax")},_syncSubscribe:function(y,z){if(z.origin.tabId===this._syncSocket.tabId){if(y.id===this._syncOptions.widgetId){}else{if(y.title===this._syncOptions.widgetTitle&&!y.refreshing){if(y.nbDuplicate===0){if(this.duplicateTitleId===0){this.duplicateTitleId=1;this._syncOptions.newDuplicateCallback(this.duplicateTitleId)}this.nbDuplicateTitle+=1;y.duplicateTitleId=this.nbDuplicateTitle+1}else{if(this.nbDuplicateTitle===0){this.nbDuplicateTitle=y.nbDuplicate;this.duplicateTitleId=y.nbDuplicate+1;this._syncOptions.newDuplicateCallback(this.duplicateTitleId)}}}var x,w=false,v=this.allOtherSync.length;for(x=0;x<v;x++){if(this.allOtherSync[x].id===y.id){if(y.title===this.allOtherSync[x].title&&this.allOtherSync[x].duplicateTitleId===y.duplicateTitleId){return}else{this.allOtherSync[x]=y;w=true}}}if(!w){this.allOtherSync.push(y)}}this._syncOptions.newConnectionCallback(y);if(y.id!==this._syncOptions.widgetId){this._syncSocket.dispatchEvent(o,{id:this._syncOptions.widgetId,title:this._syncOptions.widgetTitle,duplicateTitleId:this.duplicateTitleId,nbDuplicate:this.nbDuplicateTitle,refreshing:y.refreshing,syncOn:this._syncOn})}}},_syncListUpdate:function(v,w){if(w.origin.tabId===this._syncSocket.tabId){if(this._syncOptions&&this._syncOptions.updateSyncListCallback){this._syncOptions.updateSyncListCallback(v)}}},_viewpointChange:function(){if(this._viewerToSync){if(this._viewpoint){var x=this._viewpoint;if(x&&x.getControl()&&!x._SPYsyncInProgress){var z=x.getEyePosition();var v=x.getSightDirection();var w=x.getUpDirection();if(z&&v&&w){var y={cameraCheckValue:this._checkCamera?x[this._checkCamera]:undefined,cameraPosition:{x:z.x.toString(),y:z.y.toString(),z:z.z.toString()},cameraTarget:{x:v.x.toString(),y:v.y.toString(),z:v.z.toString()},cameraUp:{x:w.x.toString(),y:w.y.toString(),z:w.z.toString()},targetDistance:x.getTargetDistance(),angle:x.getAngle(),projectionType:x.getProjectionType(),modelBoundingSphere:x.getBoundingSphere().radius};this._syncSocket.dispatchEvent(a,y)}}}}},_probingDetection:function(w){if(this._viewerToSync&&typeof(w)==="object"&&w.position2D&&!isNaN(w.position2D.x)&&!isNaN(w.position2D.y)){var v={position2D:{x:w.position2D.x.toString(),y:w.position2D.y.toString()}};this._syncSocket.dispatchEvent(i,v)}},_playCmd:function(x){var y=parseInt(x.position);var v=parseInt(x.totalNumberOfFrames);if(!isNaN(y)&&!isNaN(v)){var w={position:y.toString(),totalNumberOfFrames:v.toString(),totalComputedFramesNumber:parseInt(x.totalComputedFramesNumber).toString()};this._syncSocket.dispatchEvent(s,w)}},_startLegendSync:function(v){if(this._legendMinMaxRequestCallback&&this._legendMinMaxResponseCallback){if(v&&!this._integratingLegend){this._integratingLegend=true;this._integratingLegendDataList=[];this._syncSocket.dispatchEvent(c)}}},init:function(v){this._parent();this._syncOptions=v;this._syncOn=false;this.allOtherSync=[];this.syncWith=[];this.duplicateTitleId=0;this.nbDuplicateTitle=0;if(v&&v.server){if(v.server==="PubSub"){this._syncSocket={id:"pubSubPseudoSocket_"+f.getUUID(),widgetId:v.widgetId,tabId:v.tabId,_subs:[],dispatchEvent:function(w,x){var y=x?x:{};if(y){y._SPYsyncPseudoSocketID=this.id;y._SPYsyncWidgetID=this.widgetId;y._SPYsyncTabID=this.tabId}k.publish(w,y)},addListener:function(w,x){this._subs[w]=k.subscribe(w,function(y){if(x){var z={event:w,origin:{server:"PubSub",socket:y._SPYsyncPseudoSocketID,widgetId:y._SPYsyncWidgetID,tabId:y._SPYsyncTabID}};x(y,z)}})},removeListener:function(w){if(this._subs[w]){k.unsubscribe(this._subs[w])}}}}else{this._syncSocket=new h.Socket();this._syncSocket.subscribeServer(v.server,window.__karma__?window:window.parent)}this._initServer=v.server;if(!v.interactive){this.startSync()}}},destroy:function(){this._parent();this._syncSocket.removeListener(o);this._syncSocket.removeListener(p);this._syncSocket.removeListener(l);this._syncSocket.removeListener(b);this._syncSocket.removeListener(u);this._syncSocket.removeListener(c);this._syncSocket.removeListener(t);delete this._syncSocket;this._syncSocket=undefined},resetComponentsToSync:function(){if(this._viewpoint){this._viewpoint.unsubscribe(this._viewpointChangeCallback)}this._viewpointChangeCallback=undefined;m.unsubscribe(this._probingDetectionCallback);this._probingDetectionCallback=undefined;m.unsubscribe(this._probingDetectionCallback);this._probingDetectionCallback=undefined;m.unsubscribe(this._instanceDisposeCallback);this._instanceDisposeCallback=undefined;m.unsubscribe(this._playCmdCallback);this._playCmdCallback=undefined;m.unsubscribe(this._clearCmdCallback);this._clearCmdCallback=undefined;m.unsubscribe(this._frameChgCallback);this._frameChgCallback=undefined;m.unsubscribe(this._frameSelectionCallback);this._frameSelectionCallback=undefined;m.unsubscribe(this._lgdMinEditCallback);this._lgdMinEditCallback=undefined;m.unsubscribe(this._lgdMaxEditCallback);this._lgdMaxEditCallback=undefined;this._viewerToSync=undefined;this._probingEvent=undefined;this._probingCallback=undefined;this._infoToggleEvent=undefined;this._infoToggleCallback=undefined;this._navFrameEvent=undefined;this._navFrameCallback=undefined;this._animPlayEvent=undefined;this._animPlayCallback=undefined;this._animClearEvent=undefined;this._animClearCallback=undefined;this._animFrameChangedEvent=undefined;this._animFrameChangedCallback=undefined;this._legendMinEvent=undefined;this._legendMinMaxRequestCallback=undefined;this._legendMinMaxResponseCallback=undefined;this._legendMinEditedCallback=undefined;this._legendMaxEvent=undefined;this._legendMaxEditedCallback=undefined},addComponentsToSync:function(w){if(w){if(w.viewpoint){this._viewerToSync=w.viewpoint.viewer?w.viewpoint.viewer:this._viewerToSync;this._checkCamera=w.viewpoint.cameraCheck;this._viewpoint=this._viewerToSync.getViewpoints()[0]}if(w.probing){this._probingEvent=w.probing.event?w.probing.event:this._probingEvent;this._probingCallback=w.probing.callback?w.probing.callback:this._probingCallback}if(w.instanceDispose){this._instanceDisposeEvent=w.instanceDispose.event?w.instanceDispose.event:this._instanceDisposeEvent}if(w.frameNavigation){this._navFrameEvent=w.frameNavigation.event?w.frameNavigation.event:this._navFrameEvent;this._navFrameCallback=w.frameNavigation.callback?w.frameNavigation.callback:this._navFrameCallback}if(w.animation){this._animPlayEvent=w.animation.play.event?w.animation.play.event:this._animPlayEvent;this._animPlayCallback=w.animation.play.callback?w.animation.play.callback:this._animPlayCallback;this._animClearEvent=w.animation.clear.event?w.animation.clear.event:this._animClearEvent;this._animClearCallback=w.animation.clear.callback?w.animation.clear.callback:this._animClearCallback;this._animFrameChangedEvent=w.animation.frameChanged.event?w.animation.frameChanged.event:this._animFrameChangedEvent;this._animFrameChangedCallback=w.animation.frameChanged.callback?w.animation.frameChanged.callback:this._animFrameChangedCallback}if(w.legendMinMaxRequest){this._legendMinMaxRequestCallback=w.legendMinMaxRequest.callback?w.legendMinMaxRequest.callback:this._legendMinMaxRequestCallback}if(w.legendMinMaxResponse){this._legendMinMaxResponseCallback=w.legendMinMaxResponse.callback?w.legendMinMaxResponse.callback:this._legendMinMaxResponseCallback}if(w.legendMinEdited){this._legendMinEvent=w.legendMinEdited.event?w.legendMinEdited.event:this._legendMinEvent;this._legendMinEditedCallback=w.legendMinEdited.callback?w.legendMinEdited.callback:this._legendMinEditedCallback}if(w.legendMaxEdited){this._legendMaxEvent=w.legendMaxEdited.event?w.legendMaxEdited.event:this._legendMaxEvent;this._legendMaxEditedCallback=w.legendMaxEdited.callback?w.legendMaxEdited.callback:this._legendMaxEditedCallback}}if(!this._viewerToSync&&!this._playerToSync&&!this._navFrameEvent&&!this._navFrameCallback&&!this._animPlayEvent&&!this._animPlayCallback&&!this._legendMaxEvent&&!this._legendMinEvent){if(this._container){this._container.style.display="none"}}else{if(this._container){this._container.style.display="block"}if(this._legendMinEvent&&this._legendMinEditedCallback){this._syncSocket.removeListener(b);this._syncSocket.addListener(b,this.onLegendMinEdited.bind(this))}if(this._legendMaxEvent&&this._legendMaxEditedCallback){this._syncSocket.removeListener(u);this._syncSocket.addListener(u,this.onLegendMaxEdited.bind(this))}if(this._legendMinMaxRequestCallback&&this._legendMinMaxResponseCallback){this._syncSocket.removeListener(c);this._syncSocket.removeListener(t);this._syncSocket.addListener(c,this.onLegendMinMaxRequest.bind(this));this._syncSocket.addListener(t,this.onLegendMinMaxResponse.bind(this))}if(this._syncOptions.widgetId){var v=this._syncOptions;this._syncSocket.dispatchEvent(o,{id:v.widgetId,title:v.widgetTitle,duplicateTitleId:this.duplicateTitleId,nbDuplicate:this.nbDuplicateTitle,refreshing:this._syncOptions.isRefreshing?this._syncOptions.isRefreshing():false});this._syncSocket.addListener(o,this._syncSubscribe.bind(this));this._syncSocket.addListener(l,(function(x,y){if(y&&y.event===l&&y.origin.server===this._initServer){this._syncOptions.removeConnectionCallback(y.origin.widgetId);if(this.allOtherSync.length>0){for(var z=this.allOtherSync.length-1;z>=0;z--){if(this.allOtherSync[z].id===y.origin.widgetId){this.allOtherSync.splice(z,1)}}}}}).bind(this));this._syncSocket.addListener(p,this._syncListUpdate.bind(this));this._syncSocket.addListener(n,this.onNavigateToFrame.bind(this))}if(this._instanceDisposeEvent&&this._syncSocket){m.unsubscribe(this._instanceDisposeCallback);this._instanceDisposeCallback=m.subscribe({event:this._instanceDisposeEvent},function(){this._syncSocket.dispatchEvent(l)}.bind(this))}if(this._viewerToSync&&this._syncSocket&&this._viewpoint){this._viewpoint.unsubscribe(this._viewpointChangeCallback);this._viewpointChangeCallback=this._viewpoint.onMove(this._viewpointChange.bind(this))}if(this._probingEvent&&this._syncSocket){if(this._probingEvent&&this._syncSocket){m.unsubscribe(this._probingDetectionCallback);this._probingDetectionCallback=m.subscribe({event:this._probingEvent},this._probingDetection.bind(this))}}if(this._animPlayEvent&&this._syncSocket){m.unsubscribe(this._playCmdCallback);this._playCmdCallback=m.subscribe({event:this._animPlayEvent},this._playCmd.bind(this))}if(this._animClearEvent&&this._syncSocket){m.unsubscribe(this._clearCmdCallback);this._clearCmdCallback=m.subscribe({event:this._animClearEvent},function(){this._syncSocket.dispatchEvent(d)}.bind(this))}if(this._animFrameChangedEvent&&this._syncSocket){m.unsubscribe(this._frameChgCallback);this._frameChgCallback=m.subscribe({event:this._animFrameChangedEvent},function(y){if(typeof(y)==="object"&&!isNaN(y.position)&&!isNaN(y.totalNumberOfFrames)&&typeof(y.forward)==="boolean"){var x={position:y.position.toString(),totalNumberOfFrames:y.totalNumberOfFrames.toString(),totalComputedFramesNumber:y.totalComputedFramesNumber,forward:y.forward?"true":"false"};this._syncSocket.dispatchEvent(q,x)}}.bind(this))}if(this._navFrameEvent&&this._navFrameCallback){m.unsubscribe(this._frameSelectionCallback);this._frameSelectionCallback=m.subscribe({event:this._navFrameEvent},function(y){if(!isNaN(y)){var x={frame:y.toString()};this._syncSocket.dispatchEvent(n,x)}}.bind(this))}if(this._legendMinEvent&&this._legendMinEditedCallback){m.unsubscribe(this._lgdMinEditCallback);this._lgdMinEditCallback=m.subscribe({event:this._legendMinEvent},function(x){if(x.syncFlag){x.syncList=this.syncWith;this._syncSocket.dispatchEvent(b,x)}}.bind(this))}if(this._legendMaxEvent&&this._legendMaxEditedCallback){m.unsubscribe(this._lgdMaxEditCallback);this._lgdMaxEditCallback=m.subscribe({event:this._legendMaxEvent},function(x){if(x.syncFlag&&this._syncOn){x.syncList=this.syncWith;this._syncSocket.dispatchEvent(u,x)}}.bind(this))}if(this.isSyncOn()){this.startSync()}}},_updateViewpoint:function(z){if(typeof(z.cameraPosition)==="object"&&typeof(z.cameraTarget)==="object"&&typeof(z.cameraUp)==="object"){if(this._viewerToSync){var v=this._viewerToSync.getViewpoints();if(v.length>0){var w=v[0];if(!this._checkCamera||w[this._checkCamera]===z.cameraCheckValue){w._SPYsyncInProgress=true;if(!isNaN(z.projectionType)){if(w.getProjectionType()!==z.projectionType){w.setProjectionType(z.projectionType)}}var x;if(z.modelBoundingSphere){x=w.getBoundingSphere().radius/z.modelBoundingSphere}else{x=1}var y=function(A){return new r.Vector3(x*parseFloat(A.x),x*parseFloat(A.y),x*parseFloat(A.z))};w.setSightDirection(y(z.cameraTarget));w.setUpDirection(y(z.cameraUp));w.setEyePosition(y(z.cameraPosition));if(!isNaN(z.targetDistance)){w.setTargetDistance(z.targetDistance)}if(!isNaN(z.angle)){w.setAngle(z.angle)}w._SPYsyncInProgress=undefined}}}}},onViewpointChanged:function(v,w){if(this._syncOn&&w&&w.event===a&&w.origin.server===this._initServer){if(this.testSourceId(w.origin,"viewchange")){if(typeof(v)==="object"){this._updateViewpoint(v)}}else{if(this._syncSocket.widgetId&&w.origin!==this._syncSocket.widgetId){this._lastViewpointEvent={data:v,info:w}}}}},onProbing:function(v,x){if(this._syncOn&&!this._synchingAnimation&&x.origin){if(x&&x.event===i&&x.origin.server===this._initServer){if(this.testSourceId(x.origin,"viewchange")){var w;if(v.position2D){w=new r.Vector2(parseInt(v.position2D.x),parseInt(v.position2D.y))}if(
/*!isNaN(x) && !isNaN(y) && */
this._probingCallback&&w){this._probingCallback(w)}}}}},onNavigateToFrame:function(v,w){if(w&&w.event===n&&w.origin.server===this._initServer){var x;if(this._syncSocket.tabId===w.origin.tabId){x=parseInt(v.frame);this._lastFrameNav=x}if(this._syncOn&&this.testSourceId(w.origin,"framenav")){if(!isNaN(x)&&this._navFrameCallback){this._navFrameCallback(x)}}}},onPlay:function(x,y){if(y&&y.event===s&&y.origin.server===this._initServer){if(this.testSourceId(y.origin,"animation")&&this._animPlayCallback){var z=parseInt(x.position);var w=parseInt(x.totalNumberOfFrames);var v=parseInt(x.totalComputedFramesNumber);if(!isNaN(z)&&!isNaN(w)){this._animPlayCallback({position:z,totalNumberOfFrames:w,totalComputedFramesNumber:v});this._synchingAnimation=true}}}},onClear:function(v,w){if(w&&w.event===d&&w.origin.server===this._initServer){if(this.testSourceId(w.origin,"animation")&&this._animClearCallback){this._animClearCallback();this._synchingAnimation=false}}},onFrameChanged:function(y,z){if(z&&z.event===q&&z.origin.server===this._initServer){if(this.testSourceId(z.origin,"animation")&&this._animFrameChangedCallback){var A=parseInt(y.position);var x=parseInt(y.totalNumberOfFrames);var w=y.totalComputedFramesNumber?parseInt(y.totalComputedFramesNumber):1;if(!isNaN(A)&&!isNaN(x)){if(!this._synchingAnimation&&this._animPlayCallback){this._animPlayCallback({position:A,totalNumberOfFrames:x,totalComputedFramesNumber:w});this._synchingAnimation=true}var v=(y.forward==="true");this._animFrameChangedCallback({position:A,totalFrames:x,forward:v,totalComputedFramesNumber:w})}}}},onLegendMinMaxRequest:function(w,x){if(x&&x.event===c&&x.origin.server===this._initServer){if((this.testSourceId(x.origin,"legendminmax")||this.testTabId(x.origin))&&this._legendMinMaxRequestCallback){if(this._syncOn){this._integratingLegend=true;this._integratingLegendDataList=[];var v=this._legendMinMaxRequestCallback();v.targetId=x.origin.socket;this._syncSocket.dispatchEvent(t,v)}else{}}}},onLegendMinMaxResponse:function(v,w){if(w&&w.event===t&&w.origin.server===this._initServer){if((this.testSourceId(w.origin,"legendminmax")||this.testTabId(w.origin))&&this._legendMinMaxResponseCallback){if(v.targetId===this._syncSocket.id){this._integratingLegendDataList.push(v);this._legendMinMaxResponseCallback(this._integratingLegendDataList)}}}},onLegendMinEdited:function(v,w){if(w&&w.event===b&&w.origin.server===this._initServer){if((this.testSourceId(w.origin,"legendminmax")||this.testTabId(w.origin))&&this._legendMinEditedCallback){if(this._syncOn){this._integratingLegend=false;this._legendMinEditedCallback(v)}}}},onLegendMaxEdited:function(v,w){if(w&&w.event===u&&w.origin.server===this._initServer){if((this.testSourceId(w.origin,"legendminmax")||this.testTabId(w.origin))&&this._legendMaxEditedCallback){if(this._syncOn){this._integratingLegend=false;this._legendMaxEditedCallback(v)}}}},startSync:function(w,v){this._syncOn=true;if(w){this.updateSyncList(w,v,true)}else{if(undefined===this._syncOptions.widgetId){this._startLegendSync(true)}}this._synchingAnimation=false;if(this._viewerToSync&&this._syncSocket){this._syncSocket.removeListener(a);this._syncSocket.addListener(a,this.onViewpointChanged.bind(this))}if(this._probingEvent&&this._syncSocket){this._syncSocket.removeListener(i);this._syncSocket.addListener(i,this.onProbing.bind(this))}if(this._animPlayEvent&&this._syncSocket){this._syncSocket.removeListener(s);this._syncSocket.addListener(s,this.onPlay.bind(this))}if(this._animClearEvent&&this._syncSocket){this._syncSocket.removeListener(d);this._syncSocket.addListener(d,this.onClear.bind(this))}if(this._animFrameChangedEvent&&this._syncSocket){this._syncSocket.removeListener(q);this._syncSocket.addListener(q,this.onFrameChanged.bind(this))}if(this._navFrameEvent&&this._navFrameCallback){this._syncSocket.removeListener(n);this._syncSocket.addListener(n,this.onNavigateToFrame.bind(this));if(!isNaN(this._lastFrameNav)&&this._navFrameCallback&&this._isFrameNavSyncOn()){this._navFrameCallback(this._lastFrameNav)}}},stopSync:function(){this._syncOn=false;this._syncSocket.removeListener(a);this._syncSocket.removeListener(i);this._syncSocket.removeListener(s);this._syncSocket.removeListener(d);this._syncSocket.removeListener(q);this._syncSocket.removeListener(n);this._integratingLegend=false;if(this._synchingAnimation&&this._animClearCallback){this._animClearCallback()}},isSyncOn:function(){return this._syncOn},attachSyncButton:function(v){this.detachSyncButton();if(this._container&&v){this._container.inject(v);this._containerParent=v}},detachSyncButton:function(){if(this._containerParent&&this._containerParent.removeChild&&this._container){if(this._container.getParent()===this._containerParent){this._containerParent.removeChild(this._container)}}},updateSyncList:function(w,y,z){var x=this._isViewSyncOn();var v=this._isFrameNavSyncOn();var D=this._isLegendSyncOn();this.syncWith=w;var A=this._isViewSyncOn();var C=this._isFrameNavSyncOn();var B=this._isLegendSyncOn();if(A&&!x&&this._lastViewpointEvent){this.onViewpointChanged(this._lastViewpointEvent.data,this._lastViewpointEvent.info)}if(C&&!v){if(!isNaN(this._lastFrameNav)&&this._navFrameCallback){this._navFrameCallback(this._lastFrameNav)}}if(y){this._syncSocket.dispatchEvent(p,{id:this._syncOptions.widgetId,list:w})}if((this._syncOn&&B&&!D)||(z&&B)){this._startLegendSync(true)}if(D&&!B){this._integratingLegend=false}},testSourceId:function(w,y){var v=false;if(typeof(w)==="object"){if(this._syncSocket.widgetId){if(this._syncSocket.widgetId!==w.widgetId&&this._syncSocket.tabId===w.tabId){var x=this._syncOptions.widgetPrefix+w.widgetId;v=(this.syncWith[x]!==undefined)?this.syncWith[x][y]:false}}else{v=(w.socket!==this._syncSocket.id)}}return v},testTabId:function(w,y){var v=false;if(typeof(w)==="object"&&this._syncSocket.tabId&&this._syncSocket.tabId===w.tabId&&this._syncSocket.widgetId!==w.widgetId){var x=this._syncOptions.widgetPrefix+this._syncOptions.widgetId;v=(this.syncWith[x]!==undefined)?this.syncWith[x][y]:false}return v}});return e.namespace("DS/SPYUI/controllers/CATSimNavDataSyncManager",g)});define("DS/SPYUI/commands/CATSPYHideShowLegendCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(c,a){var b=a.extend({init:function(d){this._parent(d,{isAsynchronous:true,mode:"shared"})},execute:function(){var e=this.getFrameWindow().SPMUI;if(e){var d=e.getActiveDD();if(d){var f=d.getLegend();if(f){f.visibility=!f.visibility;e.setLegendFrameVisibility(f.visibility)}}}this.end()}});return b});define("DS/SPYUI/CATSimNavDataMaxiPlayer",["css!DS/SPYUI/CATSimNavDataMaxiPlayer.css","UWA/Core","DS/CoreEvents/Events","DS/ApplicationFrame/AfrPlayerService","DS/Controls/Timeline","DS/ApplicationFrame/PlayerStyle"],function(e,g,a,b,d,f){var c=g.Class.extend({_setAfrPlayerLoopMode:function(i){for(var h=0;h<b._playerModel.elements.length;h++){var j=b._playerModel.elements[h].id;if(j==="loopRCBF"||j==="loopRC"||j==="loopRO"){if(j===i){b._playerModel.elements[h].hiddenByDefault=undefined}else{b._playerModel.elements[h].hiddenByDefault=true}}}},_computeAfrProgress:function(i){var h=NaN;if(i>=this.minValue&&i<=this.maxValue){h=(i-this.minValue)/(this.maxValue-this.minValue)}return h},_computeIndex:function(h){return(Math.round(h*(this.maxValue-this.minValue))+this.minValue)},_formatterLabel:function(h){return this._computeIndex(h).toString()},_conditionalUpdate:function(h){if(this.canPlayerChangeTo){this.canPlayerChangeTo(h,this._realUpdate.bind(this),function(){this._loopToReset=undefined!==this._animationLoop;if(this._loopToReset){clearInterval(this._animationLoop);this._animationLoop=undefined}}.bind(this),function(i){this._realUpdate(i);if(this._loopToReset&&this._animatingFlag){this._animationLoop=setInterval(this._loopFunction.bind(this),this.intervalMS/this._speedFactor);this._loopToReset=false}}.bind(this))}else{this._realUpdate(h)}},_realUpdate:function(i){if(this.onPlayerChange){this.onPlayerChange(i,this.playerForwardDirection)}if(this.playerTimeline){var h=b.getState().state;b.setState({state:h,progress:this._computeAfrProgress(i)})}},_loopFunction:function(){if(this.playerValue===this.maxValue){this.playerForwardDirection=this._loopMode!=="loopRCBF"}else{if(this.playerValue===this.minValue){this.playerForwardDirection=true}}var h=true;if(this.playerForwardDirection){this.playerValue++;if(this.playerValue>this.maxValue){if(this._loopMode==="loopRO"){this.end();h=false}else{if(this._loopMode==="loopRC"){this.playerValue=this.minValue}}}}else{this.playerValue--}if(h){this._conditionalUpdate(this.playerValue)}},init:function(k){this._parent();this._speedFactor=1;this._loopMode="loopRC";this.container=new g.Element("div",{"class":"spy-maxiplayer-container",id:"player",debug:true});this.playerDiv=new g.Element("div",{"class":"playerBorder spy-maxiplayer-afrtuning"});this.playerDiv.insertPlayer=function(m){m.inject(this.playerDiv);this.container.playerView=m}.bind(this);this.playerDiv.removePlayer=function(m){if(m&&m.remove){m.remove()}this.container.playerView=null}.bind(this);this.playerDiv.inject(this.container);if(k){this.minValue=k.minValue?k.minValue:1;this.maxValue=k.maxValue?k.maxValue:1;this.playerValue=k.initValue?k.initValue:1;this.intervalMS=k.intervalMS?k.intervalMS:200;this.canPlayerChangeTo=k.canPlayerChangeTo;this.onPlayerChange=k.onPlayerChange;this.onBegin=k.onBegin;this.onPrevious=k.onPrevious;this.onNext=k.onNext;this.onStop=k.onStop;this.onPause=k.onPause;this.onPlay=k.onPlay;this.onEnd=k.onEnd;this.onLoopOnce=k.onLoopOnce;this.onLoopRepeat=k.onLoopRepeat;this.onLoopBounce=k.onLoopBounce;this.onOptions=k.onOptions;this.onExit=k.onExit;this._loopModeButtons=[];if(k){var i=k.device==="phone"?[2,5,6,7,11]:[2,5,11];var h={style:f.SIMULATION,excludedElements:i,useTotal:false,editableLabel:false,callbacks:{},formatterLabel:this._formatterLabel.bind(this)};h.callbacks[b.actions.FIRST]=function(m){this.begin(m)}.bind(this);h.callbacks[b.actions.BACK]=function(m){this._processingPrevNext=true;this.previous(m);this._processingPrevNext=false}.bind(this);h.callbacks[b.actions.STOP]=function(m){this.stop(m)}.bind(this);h.callbacks[b.actions.PAUSE]=function(m){this.pause(m)}.bind(this);h.callbacks[b.actions.PLAY]=function(m){this.play(m)}.bind(this);h.callbacks[b.actions.NEXT]=function(m){this._processingPrevNext=true;this.next(m);this._processingPrevNext=false}.bind(this);h.callbacks[b.actions.LAST]=function(m){this.end(m)}.bind(this);h.callbacks[b.actions.LOOPRC]=function(m){this.loopBounce(m)}.bind(this);h.callbacks[b.actions.LOOPRCBF]=function(m){this.loopOnce(m)}.bind(this);h.callbacks[b.actions.LOOPRO]=function(m){this.loopRepeat(m)}.bind(this);h.callbacks[b.actions.OPTIONS]=function(){this.onOptions()}.bind(this);h.callbacks[b.actions.EXIT]=function(){this.onExit()}.bind(this);h.callbacks[b.actions.SLIDER_CHANGE]=function(m){if(!this._processingPrevNext){this.playerValue=this._computeIndex(m.data.value);if(this.onPlayerChange){this.onPlayerChange(this.playerValue,this.playerForwardDirection)}}}.bind(this);g.debug=true;b.registerPlayerContainer(this.playerDiv);g.debug=false;b.createPlayer(h);this._loopMode=k.loopMode?k.loopMode:this._loopMode;this._setAfrPlayerLoopMode(this._loopMode);this.setCurrentSpeedFactor(k.speedFactor);b.showPlayer();this.playerTimeline=true;b.setState({state:"play",progress:this._computeAfrProgress(this.playerValue)});this.container.addEventListener("contextmenu",function(m){m.preventDefault()},false)}if(k.resizeManager){k.resizeManager.addToResizeEvent(this.container)}if(k.actionBarManager){k.actionBarManager.addToActionBarEvent(this.container)}if(k.actionBar){var l=k.actionBar;if(l.getLabelsVisibility()){this.container.addClassName("show-labels")}var j=function(){if(this.container){this.container.toggleClassName("show-labels")}};l.onShowLabels(j.bind(this));l.onHideLabels(j.bind(this))}}},setRightOffset:function(h){if(!isNaN(h)){if(h>0){this.container.style.right=(h+30).toString()+"px"}else{this.container.style.right=""}}},setLeftOffset:function(h){if(!isNaN(h)){if(h>0){this.container.style.left=(h+30).toString()+"px"}else{this.container.style.left=""}}},begin:function(){this.stop();this.playerValue=this.minValue;this._conditionalUpdate(this.playerValue);if(this.onBegin){this.onBegin(this.playerValue)}},previous:function(){this.playerValue=Math.max(--this.playerValue,this.minValue);this._conditionalUpdate(this.playerValue);if(this.onPrevious){this.onPrevious(this.playerValue)}},stop:function(){b.setState({state:"stop",progress:this._computeAfrProgress(this.playerValue)});if(this._pauseButton){this._pauseButton.hide()}if(this._playButton){this._playButton.show()}clearInterval(this._animationLoop);this._animationLoop=undefined;this._animatingFlag=false;if(this.onStop){this.onStop(this.playerValue)}},pause:function(){b.setState({state:"pause",progress:this._computeAfrProgress(this.playerValue)});if(this._pauseButton){this._pauseButton.hide()}if(this._playButton){this._playButton.show()}clearInterval(this._animationLoop);this._animationLoop=undefined;this._animatingFlag=false;if(this.onPause){this.onPause(this.playerValue)}},play:function(){if(this._pauseButton){this._pauseButton.show()}if(this._playButton){this._playButton.hide()}if(this._animationLoop){clearInterval(this._animationLoop)}if(this.playerValue===this.maxValue&&this._loopMode==="loopRO"){this.playerValue=this.minValue;if(this.playerTimeline){}else{if(this.onPlayerChange){this.onPlayerChange(this.playerValue,this.playerForwardDirection)}}}b.setState({state:"play",progress:this._computeAfrProgress(this.playerValue)});if(!this._slaveMode){this._animationLoop=setInterval(this._loopFunction.bind(this),this.intervalMS/this._speedFactor)}this._animatingFlag=true;if(this.onPlay){this.onPlay()}},next:function(){this.playerValue=Math.min(++this.playerValue,this.maxValue);this._conditionalUpdate(this.playerValue);if(this.onNext){this.onNext(this.playerValue)}},end:function(){this.stop();this.playerValue=this.maxValue;this._conditionalUpdate(this.playerValue);if(this.onEnd){this.onEnd(this.playerValue)}},loopOnce:function(){this._loopMode="loopRO";if(this.onLoopOnce){this.onLoopOnce()}},loopRepeat:function(){this._loopMode="loopRC";if(this.onLoopRepeat){this.onLoopRepeat()}},loopBounce:function(){this._loopMode="loopRCBF";if(this.onLoopBounce){this.onLoopBounce()}},slowDown:function(){if(this.onSlowDown){this.onSlowDown()}},speedUp:function(){if(this.onSpeedUp){this.onSpeedUp()}},show:function(){b.showPlayer()},hide:function(){b.hidePlayer()},clear:function(){clearInterval(this._animationLoop);this._animationLoop=undefined;this._animatingFlag=false;if(this.onClear){this.onClear()}},inject:function(h){if(this.container&&h){this.container.inject(h)}},removeFrom:function(h){if(h&&h.removeChild){h.removeChild(this.container)}},updateBoundaries:function(j,k,i){if(!isNaN(j)&&!isNaN(k)){this.minValue=j;this.maxValue=k;if(!isNaN(i)&&i<=k&&i>=j){this.playerValue=i}else{this.playerValue=k}if(this.playerTimeline){var h=b.getState().state;b.setState({state:h,progress:this._computeAfrProgress(this.playerValue)})}}},switchToSlaveMode:function(){this._slaveMode=true},switchToDefaultMode:function(){this._slaveMode=undefined},getCurrentSpeedFactor:function(){return this._speedFactor},setCurrentSpeedFactor:function(h){this._speedFactor=isNaN(h)?this._speedFactor:h;if(this._animationLoop&&this._animatingFlag){clearInterval(this._animationLoop);this._animationLoop=setInterval(this._loopFunction.bind(this),this.intervalMS/this._speedFactor)}},getLoopMode:function(){return this._loopMode}});return g.namespace("DS/SPYUI/CATSimNavDataMaxiPlayer",c)});define("DS/SPYUI/CATSimNavDataSpecColorShading",["UWA/Core"],function(b){var a=b.Class.extend({init:function(){},setShadingColor:function(e){var d=false;var f={red:255,green:255,blue:255};for(var c=0;c<e.length&&!d;c++){if(e[c].matchId===this.implementation.getId()){f=e[c].color;d=true}}this.shadingColor=f},getShadingColor:function(){return this.shadingColor},activateShading:function(){this.active=true},deactivateShading:function(){this.active=false},isShadingActive:function(){return this.active},resetOverride:function(){},});return b.namespace("DS/SPYUI/CATSimNavDataSpecColorShading",a)});define("DS/SPYUI/commands/CATSPYSelectAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Visualization/PathElement","DS/Core/Core","DS/CoreEvents/Events"],function(f,a,d,e,b){var c=a.extend({init:function(g){this._parent(g,{isAsynchronous:true,mode:"shared"})},beginExecute:function(){this._viewer=this.getFrameWindow().getViewer();b.publish({event:this._ctx+"/SPY/SELECTION/KEEPONLY_STOP"})},execute:function(){var g=this.getFrameWindow().experience.getRootBag();var h=[];g.traverse(function(i){if(i.SPObj&&i.SPObj.isActive&&i.SPObj.isActive()){h.push(new d([i.getParents()[0],i]))}});h.forEach(function(i){this._viewer.addToCSOHSO({path:[i]},{multiSel:false,trapSel:false})}.bind(this));this.end()},endExecute:function(){e.Selection.CSOManager.empty();e.Selection.HSOManager.empty()}});return c});define("DS/SPYUI/ExtendedGuidanceMsg",["css!DS/SPYUI/Guidance.css","UWA/Core","UWA/Class","DS/WebSystem/Nls","DS/WebappsUtils/WebappsUtils"],function(f,e,c,d,b){var a=c.extend({init:function(g){this._parent();if(g&&g.msgData&&g.nlsModule&&g.nlsFile&&g.parentContainer){this._wrapper=new e.Element("div",{"class":"guidance-extmsg-wrapper"}).inject(g.parentContainer);this._container=new e.Element("div",{"class":"guidance-extmsg-container",events:{click:this.hide.bind(this)}}).inject(this._wrapper);this._wrapper.hide();g.msgData.content.forEach(function(k){var j=new e.Element("div",{"class":"guidance-extmsg-line"}).inject(this._container);if(k.image){var i=new e.Element("img",{"class":"guidance-extmsg-image"}).inject(j);i.src=b.getWebappsBaseUrl()+k.image}var h=new e.Element("span",{"class":"guidance-extmsg-text"}).inject(j);d.nls(g.nlsModule+"/"+g.nlsFile,k.text,function(l){h.setText(l)})}.bind(this))}},show:function(){if(this._wrapper){this._wrapper.show()}},hide:function(){if(this._wrapper){this._wrapper.hide()}if(this.onHide){this.onHide()}},remove:function(){if(this._wrapper){this._wrapper.remove();this._wrapper.destroy()}},updateSizeResponsive:function(h){var g=["responsive-small","responsive-medium"];g.forEach(function(i){this._container.removeClassName(i)}.bind(this));if(h==="small"){this._container.addClassName(g[0])}else{if(h==="medium"){this._container.addClassName(g[1])}}}});return e.namespace("DS/SPYUI/ExtendedGuidanceMsg",a)});define("DS/SPYUI/commands/CATSPYShowHideExtremaCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(c,a){var b=a.extend({init:function(d){this._parent(d,{isAsynchronous:true,mode:"exclusive"})},execute:function(){this.getFrameWindow().SPMUI.toggleExtrema();this.end()}});return b});define("DS/SPYUI/commands/CATSPYAnimateCmd",["UWA/Core","DS/CoreEvents/Events","DS/ApplicationFrame/Command","DS/Selection/HSOManager"],function(d,a,b){var c=b.extend({init:function(e){this._parent(e,{isAsynchronous:true,mode:"exclusive"})},beginExecute:function(){var e=this.getFrameWindow().SPMUI;if(e){if(!e.running){e.initAnimation(true);var f={position:e.getAnimationPosition(),totalNumberOfFrames:e.getActiveDD().getTotalNumberOfFrames(),totalComputedFramesNumber:e.getActiveDD().getAnimationStructure().totalComputedFramesNumber};a.publish({event:e.getContext()+"/SPY/ANIM/PLAY",data:f})}else{this.end()}}},endExecute:function(){var e=this.getFrameWindow().SPMUI;if(e){e.clearAnimation();a.publish({event:e.getContext()+"/SPY/ANIM/CLEAR"});a.publish({event:e.getContext()+"/SPY/PROGRESS/END"})}}});return c});define("DS/SPYUI/CATSimNavDataDisplayColorShadingManager",["UWA/Core","DS/SPY/CATSimNavDataFrameViewCompValue","DS/SPY/CATSimNavDataFrameView","DS/SPY/CATSimNavDataLink"],function(h,a,f,g){var d=function(j,k,q,l){if(j){var o=j.getNavData3DViewList();o=o.concat(j.getNavDataFrameViewList());var m=function(i){if(i){if(undefined===i.isShadingActive()||k===i.isShadingActive()||l){if(k){i.activateShading({overrideSet:q})}else{i.deactivateShading({overrideSet:q})}}}};for(var n=0;n<o.length;n++){var p=o[n];if(p){p.QI("CATISimNavDataColorShading",m)}}}};var b=function(n,k){var p={};var m=n>360?(Math.floor(n)%360)+(n-Math.floor(n)):n;var i=k<0?0:(k>1?1:k);var q=510;var r=i<=0.5?Math.floor(q*i):255;var j=i<=0.5?0:Math.floor(q*(i-0.5));var o=(r-j)/60;if(m<=60){p.red=r;p.green=j+o*m;p.blue=j}else{if(m>60&&m<=120){p.red=r-Math.round(o*(m-60));p.green=r;p.blue=j}else{if(m>120&&m<=180){p.red=j;p.green=r;p.blue=j+Math.round(o*(m-120))}else{if(m>180&&m<=240){p.red=j;p.green=r-Math.round(o*(m-180));p.blue=r}else{if(m>240&&m<=300){p.red=j+Math.round(o*(m-240));p.green=j;p.blue=r}else{if(m>300&&m<=360){p.red=r;p.green=j;p.blue=r-Math.round(o*(m-300))}}}}}}p.red=Math.round(p.red);p.green=Math.round(p.green);p.blue=Math.round(p.blue);return p};var e=function(o){var u=[];var v=o.hueDivision;var j=o.lightDivision;var p=o.lightMin;var t=o.lightMax;if(p>t||p<0||p>1||t<0||t>1||v<=0||j<=0){return u}var x=360/v;var k=0;var w=(t-p)/j;var n=p;if(j===1){n=(t+p)/2}var q;var i=1;while(i<=j){var r=0;var m=1;while(m<=v){var s=r+k;q=b(s,n);u.push({color:q});r+=x;m++}k+=x*(0.5+Math.floor(v/3));if(k>360){k=k-360}n+=w;i++}return u};var c=h.Class.extend({init:function(i){this.implementation=i;this.active=false;this.support=false;this.supportInitDone=false},getImpl:function(){return this.implementation},supportsShading:function(){if(!this.supportInitDone){var l=this.implementation;if(l){this.support=l.type==="Material";if(this.support){var r=l.getNavData3DViewList("plotContentOnly");var k=l.getNavDataFrameViewList();for(var n=0;n<r.length;n++){var s=r[n];if(s){var q=false;for(var m=0;m<k.length&&!q;m++){q=(k[m].getId()===s.getId())}if(!q){var p=new f(undefined,l);p.id=s.getId();p.name=s.getName();var o=new g(undefined,l);o.setPointedData(s.getId());p.addLink("Frameto3D",o);var t=new a(undefined,l);t.id="NoInfo";p.children.push(t);l.listFrameViews.push(p)}}}}this.supportInitDone=true}}return this.support},computeColors:function(p,m){if(this.supportsShading()){var k=this.implementation.getNavDataFrameViewList();p=k.length;var j=0;var r=0;if(p<=10){j=p;r=1}else{var u=Math.sqrt(p);var q=Math.floor(u);if(u===q){j=q;r=q}else{if(q===Math.floor(u+0.5)){j=q+1;r=q}else{j=Math.floor(u)+1;r=Math.floor(u)+1;if(j*r<p){j++}}}}var o={hueDivision:j,lightDivision:r,lightMin:0.2,lightMax:0.8};var n=e(o);if(n.length>=p){for(var x=0;x<k.length;x++){var s=k[x];var w=n[x];if(s&&w){w.matchId=s.getId()}}var y=function(i,D,C,B){if(i&&C&&D){i.setShadingColor(D);C.count--;if(C.count===0&&C.loopEnded&&B){B()}}};var v=function(){var C={count:0,loopEnded:false};var B=function(D){y(D,n,C,m)};for(var i=0;i<k.length;i++){C.count++;k[i].QI("CATISimNavDataColorShading",B)}C.loopEnded=true;if(C.count===0){m()}};var t={count:0,loopEnded:false};var z=function(i){y(i,n,t,v)};var l=this.implementation.getNavData3DViewList();for(var A=0;A<l.length;A++){t.count++;l[A].QI("CATISimNavDataColorShading",z)}t.loopEnded=true;if(t.count===0){v()}}}},toggleElementShading:function(i){if(i&&this._overrideSet){var j=this.implementation.getNavDataFrameViewList();i.QI("CATISimNavDataColorShading",function(o){var k=!o.isShadingActive();if(k){o.activateShading({overrideSet:this._overrideSet})}else{o.deactivateShading({overrideSet:this._overrideSet})}var l=o.getShadingColor();var n=false;var q=function(r){if(r){var s=r.getShadingColor();n=(l.red===s.red&&l.green===s.green&&l.blue===s.blue);if(n){if(k){r.activateShading()}else{r.deactivateShading()}}}};for(var m=0;m<j.length&&!n;m++){var p=j[m];if(p){p.QI("CATISimNavDataColorShading",q)}}}.bind(this))}},activateShading:function(i){if(this.supportsShading()){if(i&&i.overrideSet){this._overrideSet=i.overrideSet}if(this._overrideSet){d(this.implementation,true,this._overrideSet,i&&i.forceFlag);this.active=true;if(i&&i.viewer){i.viewer.render();this._viewer=i.viewer}if(this._viewer){this._viewer.render()}}}},deactivateShading:function(){if(this.supportsShading()){if(this._overrideSet){d(this.implementation,false,this._overrideSet,true);this.active=false;if(this._viewer){this._viewer.render()}}}},isShadingActive:function(){return this.active},resetOverride:function(){var l=this.implementation.getNavData3DViewList();var j=function(i){if(i){i.resetOverride()}};for(var k=0;k<l.length;k++){var m=l[k];if(m){m.QI("CATISimNavDataColorShading",j)}}}});return h.namespace("DS/SPYUI/CATSimNavDataDisplayColorShadingManager",c)});define("DS/SPYUI/CATSimNavDataDisclaimer",["css!DS/SPYUI/CATSimNavDataDisclaimer.css","UWA/Core","UWA/Class"],function(a,d,b){var c=b.extend({init:function(e){this._parent();if(e&&e.text&&e.parentContainer){this._container=new d.Element("div",{"class":"spy-disclaimer-wrapper"}).inject(e.parentContainer);var f=new d.Element("div",{"class":"spy-disclaimer-container"}).inject(this._container);this._msg=new d.Element("p",{"class":"spy-disclaimer-text"}).inject(f);this._msg.setText(e.text)}},setLeftOffset:function(e){if(!isNaN(e)){if(e>0){this._container.style.left=(e+30).toString()+"px"}else{this._container.style.left=""}}},setText:function(e){if(this._container&&this._msg){if(e!==""){this._msg=e;this._container.show()}else{this._msg="";this._container.hide()}}},remove:function(){if(this._container){this._container.remove()}},getHeight:function(){var e;if(this._container){e=this._container.clientHeight}return e},drawToCanvas:function(f){if(f&&this._container&&this._msg){var e=12;f.font=e.toString()+"px Arial";f.fillText(this._msg.getText(),this._msg.offsetLeft,this._container.offsetTop+this._msg.offsetTop)}}});return d.namespace("DS/SPYUI/CATSimNavDataDisclaimer",c)});define("DS/SPYUI/CATSimNavData3DExtremaNode",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/Canvas2DNode","DS/SceneGraphNodes/CanvasNodeTexture","DS/Visualization/ThreeJS_DS","DS/VisuEvents/EventsManager"],function(h,c,d,A,B,z,u){var x=window.devicePixelRatio||1;var b=44;var g=44;var k=200;var y=65;var j=32;var i=18;var a=4;var s=28;var q=16;var v=12;var p=c.getProxifiedWebappsBaseUrl()?c.getProxifiedWebappsBaseUrl():c.getWebappsBaseUrl();var l="SPYUI/assets/icons/extrema/";var o="I_SimNavExtrema";var f="I_SimNavExtremaReframe";var w="I_SimNavExtremaUndo";var t=30;var e=50;var m=5;var r=function(L,H,G,C,I,D,J,K){if(typeof K==="undefined"){K=true}if(typeof D==="undefined"){D=5}if(typeof D==="number"){D={tl:D,tr:D,br:D,bl:D}}else{var F={tl:0,tr:0,br:0,bl:0};for(var E in F){D[E]=D[E]||F[E]}}L.beginPath();L.moveTo(H+D.tl,G);L.lineTo(H+C-D.tr,G);L.quadraticCurveTo(H+C,G,H+C,G+D.tr);L.lineTo(H+C,G+I-D.br);L.quadraticCurveTo(H+C,G+I,H+C-D.br,G+I);L.lineTo(H+D.bl,G+I);L.quadraticCurveTo(H,G+I,H,G+I-D.bl);L.lineTo(H,G+D.tl);L.quadraticCurveTo(H,G,H+D.tl,G);L.closePath();if(J){L.fill()}if(K){L.stroke()}};var n=A.extend({_updateTagImage:function(){var C=this._type.indexOf("Partial")!==-1?"Hidden":"";var D=this._type.indexOf("Max")!==-1?"Max":"Min";this._tagImg.src=p+l+o+C+D+"Tag.png"},_requestTextureUpdate:function(){this._extremaTexture.requestRedraw();this._viewer.render()},init:function(G,D,C){this._initDone=false;this._viewer=G;this._type=D;this._expandFlag=false;this._antiConflictFlag=false;this._reframed=false;this._tagImg=new h.Element("img",{attributes:{width:b*x,height:g*x}});this._reframeImg=new h.Element("img",{attributes:{width:t*x,height:t*x,src:p+l+f+".png"}});this._restoreImg=new h.Element("img",{attributes:{width:t*x,height:t*x,src:p+l+w+".png"}});this._extremaTexture=new B({width:k*x,height:g*x,drawCB:function(I,Q){if(!this._initDone){return}if(this._expandFlag&&this.extremaValue){var J=this.extremaValue.length*v;Q.fillStyle=(this._type.indexOf("Max")!==-1)?"rgba(255,100,100,0.6)":"rgba(100, 100, 255, 0.6)";var N=i*x;var M=a*x;var P=(y+J)*x;var O=j*x;r(Q,N,M,P,O,10*x,true,false);Q.font="bold "+(q*x).toString()+"pt Arial";Q.fillStyle="black";Q.fillText(this.extremaValue,b*x,s*x);Q.globalAlpha=1;Q.strokeStyle="black";Q.lineWidth=2;var K=this._reframed?this._restoreImg:this._reframeImg;this._xReframeRestore=e+J;this._yReframeRestore=m;Q.drawImage(K,this._xReframeRestore*x,this._yReframeRestore*x,t*x,t*x)}if(this._antiConflictFlag){var L=b*x/2;var H=g*x/2;Q.translate(L,H);Q.rotate(Math.PI);Q.drawImage(this._tagImg,-1*H,-1*H,b*x,g*x);Q.rotate(-1*Math.Pi);Q.translate(-1*L,-1*H)}else{Q.drawImage(this._tagImg,0,0,b*x,g*x)}}.bind(this)});this._tagImg.onload=this._requestTextureUpdate.bind(this);var F={name:C+"_"+this._viewer.id.toString(),hotspot:new z.Vector2(b*x/2,this._antiConflictFlag?g*x:0),canvasNodeTexture:this._extremaTexture};this._parent(F,d);var E=this;this._onClick=function(S){if(S){var L=E._viewer.getMousePosition(S.from[0].getCurrentPosition(E._viewer.canvas));var O=new z.Vector2(L.xPix,L.yPix);var N=new z.Vector3().getPositionFromMatrix(E.getMatrix());var T=E._viewer.getViewpoints();if(T.length>0){var M=T[0];var R=new z.Projector();R.projectVector(N,M.camera);N.x=(N.x+1)/2;N.y=(-N.y+1)/2;var P=new z.Vector2(N.x*E._viewer.canvas.width,N.y*E._viewer.canvas.height);var K=O.sub(P);var Q=K.multiplyScalar(1/(window.devicePixelRatio||1));Q.x=Q.x+b/2;var J=E._antiConflictFlag?0:-1*g;var U=E._antiConflictFlag?g:0;var H=E._antiConflictFlag?g-E._yReframeRestore:-1*E._yReframeRestore;var I=E._antiConflictFlag?g-E._yReframeRestore-t:-1*(E._yReframeRestore+t);if(Q.x>=0&&Q.y<=U){if(Q.x<=b&&Q.y>=J){E.setExpandFlag(!E._expandFlag)}else{if(E._expandFlag&&Q.x>=E._xReframeRestore&&Q.x<=(E._xReframeRestore+t)&&Q.y<=H&&Q.y>=I){if(E._reframed){E.onRestore()}else{E.onReframe()}}}}}}};u.addEvent(this._viewer.canvas,"onLeftMouseUp",this._onClick);u.addEvent(this._viewer.canvas,"onTap",this._onClick);this.setPickable("Mesh.NOPICKABLE");this._initDone=true},clean:function(){if(this._viewer){u.removeEvent(this._viewer.canvas,"onLeftMouseUp",this._onClick);u.removeEvent(this._viewer.canvas,"onTap",this._onClick)}},setAssociatedComponent:function(C){this.cmp3D=C},getAssociatedComponent:function(){return this.cmp3D},getConnectionOffset:function(){var C={x:10,y:10};return C},setExtremaType:function(C){this._type=C;this._updateTagImage()},setAntiConflictFlag:function(C){this._antiConflictFlag=C;this.hotspot=new z.Vector2(b*x/2,this._antiConflictFlag?g*x:0);this.material.uniforms.hotspot.value=this.hotspot;this._requestTextureUpdate()},setExtremaValue:function(C){this.extremaValue=C;this._requestTextureUpdate()},getExtremaValue:function(){return this.extremaValue},setExpandFlag:function(C){this._expandFlag=C;this._requestTextureUpdate()},applyOffset:function(){},setPosition:function(D){if(D){var C=new z.Matrix4();C.setPosition(D);this.setMatrix(C);this.applyOffset()}},setNormalVector:function(C){this.normalVector=C},getNormalVector:function(){return this.normalVector},getExpandFlag:function(){return this._expandFlag},onReframe:function(){if(this._viewer){var D=this._viewer.getViewpoints();if(D.length>0){var E=D[0];var G=E.getEyePosition();var H=E.getSightDirection();var C=E.getUpDirection();if(G&&H&&C){this._backupViewpoint={mainViewpoint:E,cameraPosition:{x:G.x,y:G.y,z:G.z},cameraTarget:{x:H.x,y:H.y,z:H.z},cameraUp:{x:C.x,y:C.y,z:C.z}};var I=new z.Vector3().getPositionFromMatrix(this.getMatrix());if(I){if(this.normalVector){if(this.normalVector.x===0&&this.normalVector.y===0&&this.normalVector.z===0){this.normalVector.x=1}var F=new z.Vector3();F.addVectors(I,this.normalVector.clone().normalize().multiplyScalar(500));E.setSightDirection(new z.Vector3().subVectors(I,F));E.setUpDirection(new z.Vector3(0,0,1));E.setEyePosition(F);this._reframed=true;this._requestTextureUpdate();setTimeout(function(){this._moveCBToken=E.onMove(this.onUserViewModification.bind(this))}.bind(this),200)}}}}}},onRestore:function(){if(this._backupViewpoint){var C=this._viewer.getViewpoints();if(C.length>0){var D=C[0];if(D){D.setSightDirection(new z.Vector3(this._backupViewpoint.cameraTarget.x,this._backupViewpoint.cameraTarget.y,this._backupViewpoint.cameraTarget.z));D.setUpDirection(new z.Vector3(this._backupViewpoint.cameraUp.x,this._backupViewpoint.cameraUp.y,this._backupViewpoint.cameraUp.z));D.setEyePosition(new z.Vector3(this._backupViewpoint.cameraPosition.x,this._backupViewpoint.cameraPosition.y,this._backupViewpoint.cameraPosition.z));D.unsubscribe(this._moveCBToken);this._moveCBToken=undefined;this._reframed=false;this._requestTextureUpdate()}}}},onUserViewModification:function(){if(this._moveCBToken){var C=this._viewer.getViewpoints();if(C.length>0){var D=C[0];if(D){D.unsubscribe(this._moveCBToken);this._moveCBToken=undefined}}this._reframed=false;this._requestTextureUpdate()}}});return h.namespace("DS/SPYUI/CATSimNavData3DExtremaNode",n)});define("DS/SPYUI/controllers/CATSimNavDataCameraSelector",["i18n!DS/SPYUI/assets/nls/CATSimNavDataCameraSelector","UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/TreeModel/TreeNodeModel","DS/Tree/TreeDocument","DS/Tree/ThumbnailGridView"],function(d,h,f,e,g,a,b){var c=f.extend({_selClick:function(i){this._camerasRoot.setCurrentCamera(i.virtualCellID);this.updateViewPoint()},init:function(i,k,j){this._camerasRoot=i;this._viewer=k;this._zip=j},loadScrollingPanel:function(r,p){var l=this._camerasRoot.getCurrentCameraIdx();this._cellsModel=new a({shouldAcceptDrop:function(){return false}});var q=e.getWebappsBaseUrl()+"SPYUI/assets/icons/camera";for(var n=0;n<this._camerasRoot.getListCamera().length;++n){var o=this._camerasRoot.getCamera(n);var m=o.getLinks("CamerasToPart")!==undefined;var k=new g({label:o.getName(),sublabel:m?d.get("tracking"):d.get("static"),thumbnail:"",icons:[q+"/I_SimNavCam"+(m?"Tracking.png":"Static.png")],description:o.getDescription()});var j=o.getThumbnail();if(j){this.loadThumbnail(n,j)}else{k.options.thumbnail=q+"/I_SimNavCamDefaultThumbnail.png"}this._cellsModel.addRoot(k)}this._cameraGrid=new b({model:this._cellsModel,defaultCellWidth:225,defaultCellHeight:170,height:"auto",numberOfColumns:1,selection:{canMultiSelect:false,enableListSelection:false},checkboxVisibilityFlag:"never",enableActiveUI:true,enableKeyboardNavigation:true,performances:{preloadPool:true,useRequestAnimationFrameRendering:false}}).inject(r);this._cameraGrid.elements.container.setStyles({width:"255px"});this._cameraGrid.onCellClick(this._selClick.bind(this));this._cellsModel.getNthRoot(l).select();if(p){p()}},loadThumbnail:function(j,l){var k="image/PNG";var i=this._zip.find(l);if(i){i.getBlob(k,function(m){this._cellsModel.getNthRoot(j).options.thumbnail=URL.createObjectURL(m);this._cellsModel.getNthRoot(j).updateOptions()}.bind(this))}},updateViewPoint:function(i){this._camerasRoot.QI("CATISimNavDataAnimation",function(j){j.animate(undefined,{forceUpdateCamera:i===true})})}});return h.namespace("DS/SPYUI/controllers/CATSimNavDataCameraSelector",c)});define("DS/SPYUI/CATSimNavDataDisplayAnimation",["UWA/Core"],function(b){var a=b.Class.extend({init:function(c){this.implementation=c;this.nbSteps=0;this.listObjectsToAnimate=[]},getImpl:function(){return this.implementation},isFrameLoaded:function(e){var d=true;var f=function(c){if(c){d=(c.status==="loaded")}};for(var g=0;g<this.listObjectsToAnimate.length&&d;g++){if(this.listObjectsToAnimate[g].getLoadingDescription){this.listObjectsToAnimate[g].getLoadingDescription(e,f)}}return d},loadFrame:function(j,g){if(!this.implementation){return}if(this.isFrameLoaded(j)){if(g){g()}}else{var e={statusList:[],filesList:[],fatherNodes:[],matrices:[],};var d=function(k){if(k){if(k.status!=="loaded"){e.statusList.push(k.status);e.filesList.push(k.file);e.fatherNodes.push(k.fatherNode);e.matrices.push(k.matrix)}}};for(var c=0;c<this.listObjectsToAnimate.length;c++){if(this.listObjectsToAnimate[c].getLoadingDescription){this.listObjectsToAnimate[c].getLoadingDescription(j,d)}}var f=function(m){if(m){for(var l=0;l<e.fatherNodes.length;l++){var k=e.fatherNodes[l];for(var n=0;n<k.children.length;n++){if(k.children[n]._SPYFrameIndex===j){m(k.children[n],k,l)}}}}};f(function(l,k){if(k&&l){k.remove(l)}});var i=this.implementation.getSPM();var h=this.implementation.getSequence();i.loadFiles({filesList:e.filesList,frameIndex:j,fatherNodes:e.fatherNodes,sequence:h,callback:function(){f(function(o,m,n){if(o&&!isNaN(n)){o.setMatrix(e.matrices[n])}});for(var l=0;l<this.listObjectsToAnimate.length;l++){var k=this.listObjectsToAnimate[l].getImpl();if(k&&k.setLoadingStatus){k.setLoadingStatus(j,"loaded")}}if(g){g()}}.bind(this),resetProgress:true});i.processLoadFiles()}},initAnimation:function(c){if(!this.implementation){return}this.listObjectsToAnimate=[];var j=this.implementation.getNavData3DViewList();var g=this.implementation.getNavData2DViewList();var e=this.implementation.getNavDataFrameViewList();var h=j.concat(g);var d=[];for(var k=0;k<h.length;k++){if(h[k].active){d.push(h[k])}}if(this.implementation.spm.window&&this.implementation.spm.window.SPMUI&&this.implementation.spm.window.experience){if(this.implementation.spm.window.SPMUI._isAFullExperience(this.implementation.spm.window.experience)){d=d.concat(e)}}var f=0;var m=false;var i=function(n){if(n){f++;n.initAnimation(function(){this.listObjectsToAnimate.push(n);f--;if(f===0&&m&&c){c()}}.bind(this))}}.bind(this);for(var l=0;l<d.length;l++){d[l].QI("CATISimNavDataAnimation",i)}m=true;if(f===0&&this.listObjectsToAnimate.length>0&&c){c()}},animate:function(e,d){if(!this.implementation){return}if(!this.isFrameLoaded(e)){this.loadFrame(e,function(){this.animate(e,d)}.bind(this))}else{this.currentStep=e;for(var c=0;c<this.listObjectsToAnimate.length;c++){this.listObjectsToAnimate[c].animate(e,d)}if(!d||!d.navigateMode){this.implementation.spm.window.SPMUI.updateTextures(e,true,{animationScope:d.animationScope})}this.implementation.spm.window.getViewer().render()}},stopAnimation:function(){this.animate(this.nbSteps-1)},getCurrentAnimationStep:function(){return this.currentStep},});return b.namespace("DS/SPYUI/CATSimNavDataDisplayAnimation",a)});define("DS/SPYUI/CATSimNavDataSpecUI",["UWA/Core","DS/Visualization/PathElement","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D"],function(f,a,c,b){var e="SP_REAMAT_ID";var d=f.Class.extend({init:function(g){this.node=null;this.implementation=g;this._overrideManager=null},getImpl:function(){return this.implementation},clean:function(){if(this.node){this.node.removeChildren();delete this.node}delete this.implementation;if(this._overrideManager){delete this._overrideManager}if(this._Rmaterial){delete this._Rmaterial}if(this._matFatherNode){delete this._matFatherNode}},build2D:function(){},build3D:function(){},buildFrame:function(){},updateFrame:function(){},getNode:function(){return this.node},getReferenceNode:function(){return(this.node?this.node.children[0]:undefined)},drawToCanvas:function(){},applyTransparency:function(u){var g=u?u:function(){};var k=this.getNode();var p=k?k.SPObj:undefined;var v=p?p.getDataDisplay():undefined;if(k&&k.getParents()&&k.getParents().length>0&&p){var x=new a([k.getParents()[0].getParents()[0],k.getParents()[0],k]);var n=p.transparent?0.6:null;var w;if(this._overrideManager){var j=this._overrideManager.getOverrideSet("SPMUI");if(j){var r=j.getOverridesFromPathElement(x);if(r){var h;for(var m=0;m<r.length&&!h;m++){h=r[m].getOpacity()!==null;if(!h){var l=r[m].getMaterial();h=(l&&l.spTranspId==="SP_TRANSPMAT_ID")}if(h){w=r[m]}}}if(!w){w=j.createOverride(x)}}}var s=function(i){if(w){w.setOpacity(i)}};var t=function(){if(w&&n!==null){var i=new c.MeshPhongMaterial({color:"rgb(255,255,255)"});i.spTranspId="SP_TRANSPMAT_ID";w.setMaterial(i,true);w.setOpacity(0.7,true)}};var o=w.getMaterial();if(o&&o.spTranspId==="SP_TRANSPMAT_ID"){if(n===null&&w){w.setMaterial(null,true);w.setOpacity(null,true)}g()}else{var q=this.getReferenceNode();o=o?o:(q.material?q.material:(q.children[0]?q.children[0].mesh3js.material:undefined));if(o){if(o instanceof c.ShaderMaterial){t();g()}else{if(v.type==="Mesh"||((v.plotType||v.category==="Result")&&p.supportedModes.indexOf("ENG")!==-1)){s(n);g()}else{p.QI("CATISimNavDataColorShading",function(i){if(i&&i.isShadingActive()){s(n)}else{t()}g()})}}}else{s(n);g()}}}},loadRenderingMaterial:function(l){if(this.implementation.matRendering&&this.implementation.matRendering.length>4){var j=[];j.push(this.implementation.matRendering);var k=this.implementation.getDataDisplay().getSPM();var i=this.implementation.getDataDisplay().getSequence();this._matFatherNode=new b();var g=function(o){var n;if(o){var q=o.getPrimitives?o.getPrimitives():undefined;if(q){for(var p=0;p<q.length&&!n;p++){var m=q[p];if(m&&m.sgNode&&m.sgNode.group&&m.sgNode.group.geomType==="FACE"){n=m.sgNode.group.material?m.sgNode.group.material:undefined}}}}return n};var h=function(){var m=this._matFatherNode.children.length>0?this._matFatherNode.children[0]:undefined;if(m){if(m.children.length>0){this._Rmaterial=g(m.children[0])}else{this._Rmaterial=g(m)}}else{}if(this._Rmaterial){this._Rmaterial.mpwMatID=e;this._hasRMat=true}else{}if(l){l()}}.bind(this);k.loadFiles({filesList:j,fatherNode:this._matFatherNode,sequence:i,callback:h,resetProgress:false})}},initRenderingMaterial:function(h){var g=function(){if(this._isRMatApplied&&this._Rmaterial&&this._overrideManager){var i=this.getNode();this._overrideManager.applyMaterialOverride("SPMUI",i,this._Rmaterial,e)}}.bind(this);if(this._hasRMat===false||(this._hasRMat&&this._Rmaterial)){g()}else{if(this._hasRMat===undefined){this._hasRMat=false;this._isRMatApplied=false;this._Rmaterial=null}this.loadRenderingMaterial(g)}if(h){h()}},hasRenderingMaterial:function(){return(this._hasRMat&&this._Rmaterial)},isRenderingMaterialApplied:function(){return this._isRMatApplied},applyRenderingMaterial:function(){if(this._overrideManager&&!this._isRMatApplied){var g=this.getNode();this._overrideManager.applyMaterialOverride("SPMUI",g,this._Rmaterial,e);this._isRMatApplied=true}},removeRenderingMaterial:function(){if(this._overrideManager){this._overrideManager.removeMaterialOverride("SPMUI",this.getNode(),this._isRMatApplied,e);this._isRMatApplied=false}},applyPassFailMaterial:function(){if(this._overrideManager){var g=this.getNode();this._overrideManager.applyPassFailMaterial("SPMUI",g)}},removePassFailMaterial:function(){if(this._overrideManager){this._overrideManager.removePassFailMaterial("SPMUI",this.getNode())}},updateSizeResponsive:function(){}});return f.namespace("DS/SPYUI/CATSimNavDataSpecUI",d)});define("DS/SPYUI/CATSimNavData3DCamerasRootAnimationUI",["UWA/Core","DS/SPYUI/CATSimNavDataSpecUI","DS/SPY/CATSimNavData3DCamerasRoot","DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events"],function(h,b,c,e,d){var g=function(l,o,n){var k=new e.Vector3();var i=o.clone().normalize();var m=n.clone().normalize();k.crossVectors(i,m).normalize();var j=i.angleTo(m);if(j<0.02){l.set(0,0,0,1)}else{l.setFromAxisAngle(k,j)}};var f=function(m,n,o){var j,l,k;var i=0;o=n.getCGRList();while(o!==null){j=o.getMatrix();if(j){l=j}if(i===m){k=j?j:l}i++;o=o.getNextSpec()}return k};var a=b.extend({_integrateUserTranformation:function(l){var k=new e.Vector3();if(this._userManipulationDefined&&this._userManipulationReference){k.subVectors(this._viewpointManipulation.cameraEye,this._userManipulationReference.cameraEye);l.eyes.add(k);var j=new e.Quaternion();g(j,this._userManipulationReference.cameraSight,this._viewpointManipulation.cameraSight);l.sightDir.applyQuaternion(j).normalize();var i=new e.Quaternion();g(i,this._userManipulationReference.cameraUp,this._viewpointManipulation.cameraUp);l.upDir.applyQuaternion(i).normalize();l.targetDistance=undefined;l.angle=undefined}},_resetUserManipulation:function(){this._userManipulationReference=undefined;this._viewpointManipulation={};this._userManipulationDefined=false},_setUserManipulationReference:function(i){this._userManipulationReference={cameraEye:i.cameraEye.clone(),cameraUp:i.cameraUp.clone(),cameraSight:i.cameraSight?i.cameraSight.clone():i.viewpoint.getSightDirection().clone()}},init:function(){},initAnimation:function(j){var k=this.implementation.getDataDisplay().getSPM().window.getViewer();if(k){var i=k.getViewpoints();if(i.length>0){this._mainViewpoint=i[0];this._camControl=this._mainViewpoint.getControl()}}if(this._viewpointChangeCallback){d.unsubscribe(this._viewpointChangeCallback)}this._resetUserManipulation();this._viewpointChangeCallback=d.subscribe({event:"/VISU/"},function(l){if(l.eventType==="@onViewpointBeginMove"){this._userManipulationDefined=true;if(!this._userManipulationReference){this._setUserManipulationReference(l)}}if(l.eventType==="@onViewpointChange"){this._viewpointManipulation.cameraEye=l.cameraEye.clone();this._viewpointManipulation.cameraUp=l.cameraUp.clone();this._viewpointManipulation.cameraSight=l.viewpoint.getSightDirection().clone();this._viewpointManipulation.cameraAngle=l.viewpoint.getAngle();this._viewpointManipulation.cameraDistance=l.viewpoint.getTargetDistance()}if(l.eventType==="@onViewpointEndMove"){}}.bind(this));if(j){j()}},getLoadingDescription:function(k,i){if(i){var j=this.implementation.getLoadingDescription(k);i(j)}},animate:function(n,z){this._processingAnimate=true;var u=this.implementation.getCurrentCamera();if(u!==this._currentCamera){this._resetUserManipulation()}else{if(!u.isTracking()&&!(z&&z.forceUpdateCamera)){return}}this._currentCamera=u;var l={};l.eyes=u.getEyePosition().clone();l.sightDir=u.getSightDirection().clone();l.upDir=u.getUpDirection().clone();l.targetDistance=u.getTargetDistance();l.angle=u.getAngle();var v=u.getLockedDOF();var o;var w=u.getLinks("CamerasToPart");var x;if(w){x=u.getLinks("CamerasToPart").getPointedData();var k=x.getCGRList();var t=0;if(isNaN(this.animationIndex)){while(k!==null){t++;k=k.getNextSpec()}this.animationIndex=t-1}if(isNaN(n)){n=this.animationIndex}else{this.animationIndex=n}var r=f(n,x,k);if(r){o=r.clone();if(v){var i=new e.Quaternion();var j=new e.Vector3();var y=new e.Vector3();o.decompose(j,i,y);if(v){j.x=v.Tx?0:j.x;j.y=v.Ty?0:j.y;j.z=v.Tz?0:j.z;i.x=v.Rx?0:i.x;i.y=v.Ry?0:i.y;i.z=v.Rz?0:i.z}o.compose(j,i,y)}}}var m;if(o){m={cameraEye:l.eyes.clone().applyMatrix4(o),cameraUp:l.upDir.clone().transformDirection(o),cameraSight:l.sightDir.clone().transformDirection(o)}}this._integrateUserTranformation(l);if(o){this._setUserManipulationReference(m);l.sightDir.transformDirection(o);l.upDir.transformDirection(o);l.eyes.applyMatrix4(o)}this.updateViewPoint(l);this._processingAnimate=false},updateViewPoint:function(j){var l=this.implementation.getDataDisplay().getSPM().window.getViewer();if(l&&j){var i=l.getViewpoints();if(i.length>0){var k=i[0];k._SPYCameraId=this._currentCamera.getId();k.setSightDirection(j.sightDir);k.setUpDirection(j.upDir);k.setEyePosition(j.eyes);if(!isNaN(j.targetDistance)){k.setTargetDistance(j.targetDistance)}if(!isNaN(j.angle)){k.setAngle(j.angle)}}}}});return h.namespace("DS/SPYUI/CATSimNavData3DCamerasRootAnimationUI",a)});define("DS/SPYUI/CATSimNavDataDisplayUI",["UWA/Core","DS/Visualization/Node3D","DS/SPY/CATSimNavDataDisplay","DS/CoreEvents/Events","DS/SPYUI/CATSimNavData3DExtremaNode"],function(g,d,f,a,b){var c=1;var e=g.Class.extend({init:function(h){this.node=null;this.implementation=h;this.allItemsHidden=true;this.extremaRequested=false},getImpl:function(){return this.implementation},clean:function(){var p=function(){delete this.node;this.cleanExtrema();if(this.selectCallback){a.unsubscribe(this.selectCallback)}}.bind(this);var k={count:0,loopEnded:false};var l=function(i){if(i){k.count--;if(this.node){this.node.remove(i.getNode())}i.clean();if(k.count===0&&k.loopEnded){p()}}}.bind(this);var s=function(i){if(i){k.count--;i.clean();if(k.count===0&&k.loopEnded){p()}}};var r=this.implementation.getNavData3DViewList();var o=this.implementation.getNavData2DViewList();var h=r.length;var q=o.length;for(var n=0;n<h;n++){if(r[n].impl.CATISimNavDataSpecUI){k.count++;r[n].QI("CATISimNavDataSpecUI",l)}}for(var m=0;m<q;m++){if(o[m].impl.CATISimNavDataSpecUI){k.count++;o[m].QI("CATISimNavDataSpecUI",s)}}k.loopEnded=true;if(k.count===0){p()}},build2D:function(n){if(!this.implementation){return}var l=this.implementation.getNavData2DViewList();if(l.length===0){if(n){n()}return}var m=new g.Element("div");var j=0;var i=false;var k=function(o){if(o){o.build2D(function(p){j--;if(p){p.inject(m)}if(j===0&&i&&n){n(m)}})}};for(var h=0;h<l.length;h++){j++;l[h].QI("CATISimNavDataSpecUI",k)}i=true;if(j===0&&n){n(m)}},build3D:function(r){if(!this.implementation||!r||!r.parentNode){return}var o=this.implementation.getNavData3DViewList();var h=o.length;if(h===0){if(r.callback){r.callback()}return}this.node=new d(this.implementation.name);r.parentNode.addChild(this.node);this.node.SPObj=this.implementation;var l=function(){var t=this.getImpl().getSPM();if(t){t.processLoadFiles()}}.bind(this);var n=function(){if(r.callback){r.callback()}};var k={count:0,loopEnded:false};var m=function(){if(k.count===0&&k.loopEnded){l()}};var j={count:0,loopEnded:false};var q=function(){if(j.count===0&&j.loopEnded){n()}};var i=function(t){if(t){t.loadRenderingMaterial();t.build3D({initProgressFromCurrent:r.initProgressFromCurrent,overrideManager:r.overrideManager,postLoadingCallback:function(u){this.node.addChild(t.node);t.initRenderingMaterial(function(){if(t.getImpl().transparent){t.applyTransparency()}});var v=t.getImpl();if(v){if(v.setLoadingStatus){v.setLoadingStatus(u,"loaded")}}j.count--;q()}.bind(this),callback:function(){k.count--;m()}})}else{k.count--;j.count--}}.bind(this);for(var p=0;p<h;p++){var s=o[p].isActive();if(s){k.count++;j.count++;o[p].QI("CATISimNavDataSpecUI",i)}}k.loopEnded=true;j.loopEnded=true;if(k.count===0){l()}},updateFrame:function(i,k){if(!this.implementation){return}var j=this.implementation.getNavDataFrameViewList();if(!j||j.length===0){return}var l=function(m){if(m){m.updateFrame(i,k)}};for(var h=0;h<j.length;h++){j[h].QI("CATISimNavDataSpecUI",l)}},buildFrame:function(i,q){var j;if(!this.implementation){return j}var p=this.implementation.getNavDataFrameViewList();if(!p||p.length===0){return j}j=new g.Element("div");var r=[];var h=function(){if(this.selectCallback){a.subscribe(this.selectCallback)}var s=function(u){var t=function(w,y){if(w&&w!==y){w.setHighlightFlag(false);var x=w.implementation.children;var v=function(z){t(z,y)};if(x){x.forEach(function(z){z.QI("CATISimNavDataSpecUI",v)})}}};if(u){r.forEach(function(v){t(v,u)})}};this.selectCallback=a.subscribe({event:this.getImpl().getSPM().getContext()+"/SPY/FRAMEVIEW/SELECT"},s.bind(this));a.publish({event:this.getImpl().getSPM().getContext()+"/SPY/DATADISPLAY/FRAMEBUILT"});if(q){q()}}.bind(this);var k=function(v,w,s,u){if(v&&w){r.push(v);var t=v.buildFrame(i,s,function(){w.count--;if(w.count===0&&w.loopEnded&&u){u()}});if(t){t.inject(j)}}};var n={count:0,loopEnded:false};var m=true;var l=function(s){k(s,n,m,h);m=false};for(var o=0;o<p.length;o++){n.count++;p[o].QI("CATISimNavDataSpecUI",l)}n.loopEnded=true;if(n.count===0){h()}return j},getNode:function(){return this.node},computeExtrema:function(p,j){var k=false;var z=false;this.allItemsHidden=true;var o=[];var w=[];var s=[];var r=[];var t;var q;var m=function(B,F,J,E){var H={extremum:undefined,isHidden:false};if(B.length===J.length){var C=-1;var D=false;var K=false;for(var G=0;G<=B.length;G++){D=false;var I=B[G];if(I){if(!E||(E&&J[G])){var L=parseFloat(I.getExtremaValue());if(!K){C=L;H.extremum=I;H.isHidden=!J[G];K=true}D=(F&&L>C)||(!F&&L<C);if(D){C=L;H.extremum=I;H.isHidden=!J[G]}}}}}return H};var h=function(){var i=this.implementation.spm.window.SPMUI.getValueDisplayPrecision();var D=true;var B=m(w,D,r,false);t=B.extremum;z=B.isHidden;if(z&&t){var H=parseFloat(t.getExtremaValue());B=m(w,D,r,true);t=B.extremum;if(t){z=(H.toPrecision(i)!==parseFloat(t.getExtremaValue()).toPrecision(i))}}D=false;B=m(o,D,s,false);q=B.extremum;k=B.isHidden;if(k){var I=parseFloat(q.getExtremaValue());B=m(o,D,s,true);q=B.extremum;if(q){k=(I.toPrecision(i)!==parseFloat(q.getExtremaValue()).toPrecision(i))}}var G=this.implementation.spm.window.getViewer();if(G){var C=G.getRootNode();var E;if(q){E=q.getPosition()}if(t){var F=t.getPosition();if(!this.maxExtremum){this.maxExtremum=new b(G,z?"PartialMax":"GlobalMax","SimNavMax")}if(this.maxExtremum){if(this.maxExtremum.parents.length===0){C.add(this.maxExtremum)}this.maxExtremum.setExtremaType(z?"PartialMax":"GlobalMax");this.maxExtremum.setAssociatedComponent(t.getComponent());this.maxExtremum.setExtremaValue(parseFloat(t.getExtremaValue()).toPrecision(i));this.maxExtremum.setNormalVector(t.getNormalVector());this.maxExtremum.setPosition(F);this.maxExtremum.setAntiConflictFlag(F.distanceTo(E)<=c)}}else{if(this.maxExtremum){this.maxExtremum.setExtremaValue("");this.maxExtremum.setAssociatedComponent();this.maxExtremum.setAntiConflictFlag(false)}}if(q){if(!this.minExtremum){this.minExtremum=new b(G,k?"PartialMin":"GlobalMin","SimNavMin")}if(this.minExtremum){if(this.minExtremum.parents.length===0){C.add(this.minExtremum)}this.minExtremum.setExtremaType(k?"PartialMin":"GlobalMin");this.minExtremum.setAssociatedComponent(q.getComponent());this.minExtremum.setExtremaValue(parseFloat(q.getExtremaValue()).toPrecision(i));this.minExtremum.setNormalVector(q.getNormalVector());this.minExtremum.setPosition(E)}}else{if(this.minExtremum){this.minExtremum.setExtremaValue("");this.minExtremum.setAssociatedComponent()}}j()}}.bind(this);var A=this.implementation.getNavData3DViewList("plotContentOnly");var l=0;var n=false;var x=function(C){var i=false;if(C){i=C.visibility;if(!i){var B=C.getSibling();i=B&&B.visibility}}return i};var v=function(i){l--;var E=i?i.getExtrema(p):undefined;if(E){var D=E.listMin;var C=E.listMax;if(D&&D.length<=1&&C&&C.length<=1){var B=x(i.getImpl());if(this.allItemsHidden&&B){this.allItemsHidden=false}if(D&&D.length===1&&D[0]){o.push(D[0]);s.push(B)}if(C&&C.length===1&&C[0]){w.push(C[0]);r.push(B)}}}if(l===0&&n){h()}}.bind(this);for(var y=0;y<A.length;y++){var u=A[y];if(u.supportedModes&&u.supportedModes.indexOf("ENG")!==-1&&u.getType()!=="CATSimNavData3DExtremasRoot"){l++;u.QI("CATISimNavDataExtremaProvider",v)}}n=true;if(l===0){h()}},setExtremaVisibility:function(h){if(this.minExtremum){this.minExtremum.setVisibility(h&&this.minExtremum.getExtremaValue().length>0&&!this.allItemsHidden)}if(this.maxExtremum){this.maxExtremum.setVisibility(h&&this.maxExtremum.getExtremaValue().length>0&&!this.allItemsHidden)}},getVisibleExtrema:function(){var h=[];if(this.minExtremum&&this.minExtremum.isVisible()){h.push(this.minExtremum)}if(this.maxExtremum&&this.maxExtremum.isVisible()){h.push(this.maxExtremum)}return h},cleanExtrema:function(){if(this.minExtremum){this.minExtremum.clean()}if(this.maxExtremum){this.maxExtremum.clean()}this.minExtremum=null;this.maxExtremum=null},getExtremaRequestedFlag:function(){return this.extremaRequested},setExtremaRequestedFlag:function(h){this.extremaRequested=h}});return g.namespace("DS/SPYUI/CATSimNavDataDisplayUI",e)});define("DS/SPYUI/CATSimNavData3DStaticColorShading",["UWA/Core","DS/Visualization/ThreeJS_DS","DS/SPYUI/CATSimNavDataSpecColorShading","DS/Visualization/PathElement"],function(f,c,e,d){var a=function(k,l){var g;if(k&&l){var m=k.getOverridesFromPathElement(l);if(m){var h;for(var j=0;j<m.length&&!h;j++){h=(null!==m[j].getColor());if(h){g=m[j]}}}}return g};var b=e.extend({init:function(){this._parent()},setShadingColor:function(g){this._parent(g)},activateShading:function(g){if(g&&g.overrideSet){this._sgOverrideSet=g.overrideSet}if(this._sgOverrideSet){this._parent();if(this.shadingColor&&!isNaN(this.shadingColor.red)){var h="rgb("+this.shadingColor.red+","+this.shadingColor.green+","+this.shadingColor.blue+")";this.implementation.QI("CATISimNavDataSpecUI",function(j){var m=j.getNode();if(m&&m.getParents()&&m.getParents().length>0&&m.getParents()[0].getParents()){var n=new d([m.getParents()[0].getParents()[0],m.getParents()[0],m]);var k=a(this._sgOverrideSet,n);if(!k){k=this._sgOverrideSet.createOverride(n)}if(k){var l=k.getMaterial();if(l&&!l.spColorCode){this._appliedMatToRestore=l}this._appliedMatToRestore=this._appliedMatToRestore?this._appliedMatToRestore.clone():null;var i=new c.MeshPhongMaterial({color:h});i.spColorCode=true;k.setMaterial(i,true);k.setColor(h,true);j.applyTransparency()}else{}}}.bind(this))}}},deactivateShading:function(g){this._parent();if(g&&g.overrideSet){this._sgOverrideSet=g.overrideSet}if(this._sgOverrideSet){this.implementation.QI("CATISimNavDataSpecUI",function(h){var j=h.getNode();if(j&&j.getParents()&&j.getParents().length>0&&j.getParents()[0].getParents()){var k=new d([j.getParents()[0].getParents()[0],j.getParents()[0],j]);var i=a(this._sgOverrideSet,k);if(i){i.setMaterial(this._appliedMatToRestore,true);i.setColor(null,true);if(this.implementation.transparent){h.applyTransparency()}}}}.bind(this))}this.resetOverride()},resetOverride:function(){this._sgOverrideSet=undefined},});return f.namespace("DS/SPYUI/CATSimNavData3DStaticColorShading",b)});define("DS/SPYUI/CATSimNavData2DLegendUI",["UWA/Core","DS/SPYUI/CATSimNavDataSpecUI","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/SMAMpwControls/SMAMpwLegend"],function(f,c,e,b,d){var a=c.extend({_isFullExperience:function(){var h=false;var g=this.implementation.getDataDisplay();if(g&&g.spm.window){h=g.spm.window.SPMUI._isAFullExperience(g.spm.window.experience)}return h},clean:function(){if(this._legendUI){this._legendUI.destroy()}delete this._legendUI;delete this.div},build2D:function(n){this.div=new f.Element("div");var l={hasMinMax:function(){return(this.implementation.localMax.length>0&&this.implementation.localMin.length>0)}.bind(this),getGlobalComputedMin:function(){return this.implementation.min}.bind(this),getGlobalComputedMax:function(){return this.implementation.max}.bind(this),getUserMin:function(){return this.implementation.userMin}.bind(this),getUserMax:function(){return this.implementation.userMax}.bind(this),getDefaultFrameId:function(){var g=this.implementation.animRawData.length-1;if(!isNaN(this._defaultStep)){g=this._defaultStep}return g}.bind(this),updateDefaultFrameId:function(g){this._defaultStep=g}.bind(this),getLocalComputedMin:function(g){return this.implementation.localMin[g]}.bind(this),getLocalComputedMax:function(g){return this.implementation.localMax[g]}.bind(this),hasDeformationScales:function(){return(this.implementation.deformationScales.length>0)}.bind(this),getDeformationScaleFactor:function(g){return this.implementation.deformationScales[g]}.bind(this),getInvertedFlag:function(){return this.implementation.inverseState}.bind(this),hasScanAnimation:function(){return this.implementation.hasScanAnimation}.bind(this),loadColorsImage:function(g){var u=this.implementation.getDataDisplay();if(u){var v=u.spm.getZipEntries(u.seq);var w;var x;if(v&&this.implementation.palette){x="image/PNG";w=v.find(this.implementation.palette)}if(w){w.getBlob(x,function(y){if(g.nodeName.toUpperCase()==="IMG"){g.src=URL.createObjectURL(y)}else{g.style["background-image"]="url("+URL.createObjectURL(y)+")"}})}else{var t=this.implementation.inverseState==="1"?"SMAMpwControls/assets/legend_na_inverted.png":"SMAMpwControls/assets/legend_na.png";if(g.nodeName.toUpperCase()==="IMG"){g.src=e.getWebappsBaseUrl()+t}else{g.style["background-image"]="url("+e.getWebappsBaseUrl()+t+")"}}}}.bind(this),getTitle:function(){return this.implementation.title}.bind(this),getFrameSelectorEntries:function(){var w=[];var u=this.implementation.getDataDisplay();if(!u){return w}var D=u.getAnimationStructure();var B;for(var x=0;x<D.groupList.length;x++){var C=D.groupList[x];var y=C.rootName;if(C.numberComputedFrames<=1){y=C.loadCaseName?y+" - "+C.loadCaseName:y}else{if(C.frameList.length>1){y=C.name}}for(var A=0;A<C.frameList.length;A++){var t=C.frameList[A];var v=C.isMode?C.name:C.name+" - "+t.name;B=t.globalIndex;var z=t.isScaledPosition;if(!z){w.push({value:B.toString(),label:v,group:y})}}}return w}.bind(this),getScopeBlocks:function(){var z=[];var v=this.implementation.getDataDisplay();if(!v){return z}var w=v.getAnimationStructure();var u=w.totalFrameNumber;for(var x=0;x<w.groupList.length;x++){var y=w.groupList[x];if(y){var t=y.frameList.length;z.push({id:y.id,name:y.name,percentSize:100*t/u})}}return z}.bind(this),getScopeBlocksIds:function(){var g=[];var t=this.implementation.getDataDisplay();if(!t){return g}var u=t.isPartialAnimationMode()?t.getAnimationScope(this._currentStep):t.getDefaultAnimationScope(this._currentStep);if(u){g=u.groupIDs}return g}.bind(this)};var r;var i=this.implementation.getDataDisplay();if(i){r=i.getSPM().getContext()}var s={onPostBuildCallback:function(){if(n){n(this.div)}}.bind(this),onFrameSelectorChange:function(g){if(!this._animationMode&&this._publishSelectEvent){b.publish({event:r+"/SPY/FRAME/SELECT",data:g});this._currentStep=g-1}}.bind(this),getCurrentFrameId:function(){return this._currentStep}.bind(this),getCurrentScopeStartFrameId:function(){var g;var t=this.implementation.getDataDisplay();if(t){var u=t.getAnimationScope(this._currentStep);if(u){g=u.globalStart}}return g}.bind(this),getCurrentScopeEndFrameId:function(){var u;var g=this.implementation.getDataDisplay();if(g){var t=g.getAnimationScope(this._currentStep);if(t){u=t.globalEnd}}return u}.bind(this),getLockAvailability:function(){var u;var g=this.implementation.getDataDisplay();if(g){var t=g.getAnimationScope(this._currentStep);if(t){var w=!this._animationMode&&t&&t.canBePartial&&t.length>1;var v=this._animationMode&&g.isPartialAnimationMode();u=w||v}}return u}.bind(this),getLockStatus:function(){var g;var t=this.implementation.getDataDisplay();if(t){g=t.isPartialAnimationMode()}return g}.bind(this),onLock:function(){var g=this.implementation.getDataDisplay();g.setPartialAnimationMode(true)}.bind(this),onUnLock:function(){var g=this.implementation.getDataDisplay();g.setPartialAnimationMode(false)}.bind(this),getCurrentScopeBlockId:function(){var g;var u=this.implementation.getDataDisplay();if(!u){return g}var t=u.getGroupForFrame(this._currentStep);if(t&&t.group){g=t.group.id}return g}.bind(this),checkEditability:function(){var g=false;var t=this.implementation.getDataDisplay();g=this._isFullExperience()&&!t.spm.window.SPMUI.isAnimationRunning();return g}.bind(this),onMinChanged:function(g){this.implementation.setUserMin(g,this._currentStep)}.bind(this),onMaxChanged:function(g){this.implementation.setUserMax(g,this._currentStep)}.bind(this),getUserMinMdlEventId:function(){return r+"/SPY/LEGEND/EDIT/USERMIN"},getUserMaxMdlEventId:function(){return r+"/SPY/LEGEND/EDIT/USERMAX"},getAnimationModeEventId:function(){return r+"/SPY/FRAME/DISABLESELECT"},onAnimationMode:function(){this._animationMode=true}.bind(this),getNavigationModeEventId:function(){return r+"/SPY/FRAME/ENABLESELECT"},onNavigationMode:function(){this._animationMode=false}.bind(this),isInAnimationMode:function(){return this._animationMode}.bind(this),areCursorsVisible:function(){var g=false;var t=this.implementation.getDataDisplay();var u=t&&t.getAnimationStructure();var v=t&&u&&u.computedFramesOnlyForDefault&&!t.isPartialAnimationMode();g=this._animationMode&&!v&&!this.implementation.hasScanAnimation;return g}.bind(this),getPostDOMInsertEventId:function(){return r+"/SPY/DATADISPLAY/ACTIVATED"},getResponsiveEventId:function(){return r+"/SPY/VIEWERRESIZE"}};var q=i.getAnimationStructure();var h=false;for(var j=0;j<q.groupList.length;j++){if(j>0){h=true}var m=q.groupList[j];for(var k=0;k<m.frameList.length&&!h;k++){if(k>0){h=true}}}this._publishSelectEvent=h;var p={readOnly:!this._isFullExperience(),valuePrecision:i.spm.window.SPMUI.getValueDisplayPrecision(),displayFrameSelector:q.totalFrameNumber>0,enableFrameSelector:h,displayBlocks:true,displayLock:true,colorBarSize:198,legendDataProvider:l,legendControler:s};var o=l.getDefaultFrameId();this._currentStep=o;this._legendUI=new d(p).inject(this.div);return this.div},drawToCanvas:function(i,g,k){if(i&&this.div&&this._legendUI){var h=this.div.offsetLeft+g;var j=this.div.offsetTop+k;this._legendUI.drawToCanvas(i,h,j)}},initAnimation:function(g){if(this.div&&g){g()}},animate:function(i,h){this._animationMode=!h||!h.navigateMode;this._currentStep=i;var g=this._publishSelectEvent;this._publishSelectEvent=!(h&&h.noEvent);if(this.div&&this._legendUI){this._legendUI.animate(i)}this._publishSelectEvent=g},updateSizeResponsive:function(){if(this._legendUI.updateSizeResponsive){this._legendUI.updateSizeResponsive()}}});return f.namespace("DS/SPYUI/CATSimNavData2DLegendUI",a)});define("DS/SPYUI/commands/CATSPYRHESwitchResetCmd",["UWA/Core","DS/SPYUI/commands/CATSPYResetCmd"],function(c,a){var b=a.extend({init:function(d){this._parent(d)},execute:function(){var e=this.getFrameWindow().experience.getRootBag();var d=this.getFrameWindow().SPMUI.getActiveDD();var f=this;d.QI("CATISimNavDataColorShadingManager",function(j){if(j.supportsShading()){j.activateShading({forceFlag:true});f._viewer.render()}else{var g=e.getChildByName(d.name);var n,m=g.children.length;var o=new Array(m);for(var l=0;l<m;l++){o[l]=g.children[l]}var p=function(i){if(i){if(i.hasRenderingMaterial()){i.removeRenderingMaterial();f._viewer.render()}}};for(n=0;n<m;n++){var h=o[n];if(h.SPObj){var k=h.SPObj;if(k.supportedModes.search(d.defaultMode)===-1){f.switchMode(k,h,g)}else{if(k.supportedModes.search("ENG")>=0&&k.supportedModes.search("REA")>=0){k.QI("CATISimNavDataSpecUI",p)}}}}}});this.end()},switchMode:function(g,h,d){var f=this.getFrameWindow()?this.getFrameWindow().SPMUI:undefined;var j=f?f.getAnimationPosition():undefined;var e=f?f.getActiveDD():undefined;var i=g.getSibling();if(i&&e){g.setActive(false);if(g.setLoadingStatus&&!isNaN(j)){g.setLoadingStatus(j,"notLoaded")}i.setActive(true);i.transparent=g.transparent;d.remove(h);i.QI("CATISimNavDataSpecUI",function(k){var l=e.getSPM();if(l){k.build3D({animationIndex:j,overrideManager:f.getOverrideManager(),postLoadingCallback:function(){d.addChild(k.node);k.applyTransparency();if(!isNaN(j)){k.getImpl().setLoadingStatus(j,"loaded");this._viewer.render()}}.bind(this)});l.processLoadFiles()}}.bind(this))}}});return b});define("DS/SPYUI/CATSimNavData3DRepStaticViewUI",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/PathElement","DS/SPYUI/CATSimNavDataSpecUI"],function(e,c,d,a){var b=a.extend({init:function(){},build3D:function(f){if(!this.implementation||!f){return}this._overrideManager=f.overrideManager;this.node=new c(this.implementation.getId());this.node.SPObj=this.implementation;this.node.productType="Reference3D";this.implementation.getDataDisplay().QI("CATISimNavDataDisplayUI",function(i){var h=this.implementation.visibility;var l=this.implementation.isActive();var n=this.implementation.getCGRList();var m=[];while(n){m.push(n.getPointedResource());n=n.getNextSpec()}var g=this.implementation.getDataDisplay().getSPM();var o=this.implementation.getDataDisplay().getSequence();var k=function(q){if(q){for(var r=0;r<q.children.length;r++){k(q.children[r])}q.setPickParent(true)}};var j=function(){for(var p=0;p<this.node.children.length;p++){k(this.node.children[p])}if(f.postLoadingCallback){f.postLoadingCallback()}}.bind(this);g.loadFiles({initProgressFromCurrent:f.initProgressFromCurrent,filesList:m,fatherNode:this.node,sequence:o,callback:function(){this.node.setVisibility(h&&l);for(var q=0;q<this.node.children.length;q++){this.node.children[q].setVisibility(true);k(this.node.children[q]);for(var p=0;p<this.node.children[q].children.length;p++){this.node.children[q].children[p].exludeFromBounding(false);if(this.node.children[q].children[p].hasExplicitBE&&!isFinite(this.node.children[q].children[p].explicitBBox.max.x)){this.node.children[q].children[p].forceBoundingBox({max:{x:0,y:0,z:0},min:{x:0,y:0,z:0}})}}}j()}.bind(this),resetProgress:false});if(f.callback){f.callback()}}.bind(this))},});return e.namespace("DS/SPYUI/CATSimNavData3DRepStaticViewUI",b)});define("DS/SPYUI/commands/CATSPYHideShowResetCmd",["UWA/Core","DS/SPYUI/commands/CATSPYResetCmd"],function(c,a){var b=a.extend({init:function(d){this._parent(d)},execute:function(){var e=this.getFrameWindow().experience.getRootBag();e.traverse(function(g){if(g.SPObj){g.setVisibility(g.SPObj.isActive?g.SPObj.isActive():true);g.SPObj.visibility=true;if(g.SPObj.getSibling){var f=g.SPObj.getSibling();if(f){f.visibility=true}}}});var d=this.getFrameWindow().SPMUI.streamsManager;if(d){d.showAll()}this._viewer.render();this.getFrameWindow().SPMUI.updateExtrema();this.end()}});return b});define("DS/SPYUI/controllers/SimulationPlayerUI",["css!DS/SPYUI/controllers/SimulationPlayerUI.css","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandsManager","DS/Core/Core","DS/CoreEvents/Events","DS/Panels/PanelBase","DS/Panels/SidePanel","DS/Controls/Scroller","DS/WebUtils/ContextedSingleton","DS/Visualization/ThreeJS_DS","DS/QualityManager/QMController","DS/SMAMpwManagers/SMAMpwMatOverrideManager","DS/SMAMpwManagers/SMAMpwTextureMapProcessor","DS/SMAMpwManagers/SMAMpwResultProbingManager","DS/SMAMpwPDSFX/SMAMpwShaderFactory","DS/SPYUI/CATSimNavDataMaxiPlayer","DS/SPYUI/CATSimNavDataSpeedControl","DS/SPYUI/controllers/CATSimNavDataSyncManager","DS/SPYUI/CATSimNavDataWatermark","DS/SPYUI/CATSimNavDataDisclaimer","DS/SPYUI/controllers/CATSimNavDataOverlaysManager","DS/SPYUI/controllers/CATSimNavDataCameraSelector"],function(p,i,h,e,g,s,j,o,v,f,w,d,t,c,k,u,n,r,q,m,l,x,b){var y={small:{w:640,h:480},medium:{w:1024,h:768},large:{w:1440,h:900}};var a=i.Class.extend({_onViewerResize:function(){var z=this.window.getViewerFrame().getDimensions();this._layoutId="large";if(z.width<y.medium.w||z.height<y.medium.h){this._layoutId="medium"}if(z.width<y.small.w||z.height<y.small.h){this._layoutId="small"}s.publish({event:this.ctx+"/SPY/VIEWERRESIZE",data:this._layoutId})},_animateSingleCamera:function(A){var B=this.spm.getDataDisplayList(this.activeSequence);var D=B[this.activatingDD];var z=D.getCameraRoot();if(z){var C=z.getListCamera().length;if(C===1){z.QI("CATISimNavDataAnimation",function(E){E.animate(undefined,{forceUpdateCamera:A})})}}},_startProbing:function(){if(this.probingMgr){this.probingMgr.stopProbing();var A=this.getActiveDD();if(A){var B=A.getGroupInfo(A.isAnimated()?this.animationPosition:0);var C={};C.labels=A.getLegend()?A.getLegend().labels:undefined;if(!C.labels){var z=A.getRetexturingMode(this.animationPosition);switch(z){case"NEUTRAL":C.textureMin=B.localMin;C.textureMax=B.localMax;break;default:C.textureMin=B.groupMin;C.textureMax=B.groupMax;break}}this.probingMgr.startProbing(C)}}},init:function(A){this.spm=A.spm;this.window=A.window;this.ctx=A.context?A.context:"ctxUndefined";this.device=A.device?A.device:"deviceUndefined";this.activeSequence=-1;this.activeDD=-1;this.activatingDD=-1;this.frame=null;this._currentInfoPaneRatioIdx=0;this._infoPaneRatios=[0.2,0.5,1];this._camerasPanel=null;this.frame2D=null;this.frameStreamlines=null;this._cameraSelector=null;this._scrollers=[];this.running=false;this.window.SPMUI=this;this.buildTreeView();this.infoPaneExpandStatus=false;this.xcrosshighlightActive=false;this.cmdCtx=this.window.experience?this.window.experience.args.ctx:this.window.options.context;var z=e.getCommand("CATSPYMSRAccessCmdHdr",this.cmdCtx);if(z&&z.isRunning()){z.end()}this.syncOptions=undefined;if(this.window.experience&&this.window.experience.args.options){if(this.window.experience.args.options.simNavSyncServer){this.syncOptions={simNavSyncDomain:{legend:true,viewpoint:true,frameNavigation:true,animation:true}};var B=this.window.experience.args.options.simNavSyncServer;if(typeof(B)==="object"){Object.assign(this.syncOptions,B);if(typeof(B.simNavSyncDomain)==="object"){Object.assign(this.syncOptions.simNavSyncDomain,B.simNavSyncDomain)}}else{console.warn(" deprecated PSR argument format: please use an object for simNavSyncServer");this.syncOptions.server=B;this.syncOptions.interactive=this.window.experience.args.options.simNavSyncInteractive}}}this.noReframe=this.window.experience?(this.window.experience.args.options?this.window.experience.args.options.simNavNoReframe:undefined):undefined;s.subscribe({event:this.getContext()+"/SPY/PROGRESS/INIT"},function(F){if(this.window&&this.window.experience&&this.window.experience.progress){this.previousProgressPosition=(F.fromPreviousValue&&this.window.experience.progress.state.visible)?parseInt(this.window.experience.progress.state.value):0;var E=F&&!isNaN(F.value)&&!isNaN(F.total);var G=E?Math.round(this.previousProgressPosition+F.value*(100-this.previousProgressPosition)/F.total):this.previousProgressPosition;this.window.experience.progress.visible();this.window.experience.progress._SPYBeingHiden=false;this.window.experience.progress.updateProgression(G);var D=this.window.experience.progress.spinnerContainer;D.style.overflow="visible"}}.bind(this));s.subscribe({event:this.getContext()+"/SPY/PROGRESS/END"},function(D){if(this.window&&this.window.experience&&this.window.experience.progress){this.window.experience.progress.hide();this.window.experience.progress._SPYBeingHiden=true;if(D){if(!isNaN(D.value)){this.window.experience.progress.updateProgression(D.value)}}}}.bind(this));s.subscribe({event:this.getContext()+"/SPY/PROGRESS/UPDATE"},function(D){if(this.window&&this.window.experience&&this.window.experience.progress){if(!this.window.experience.progress._SPYBeingHiden){this.window.experience.progress.visible()}this.window.experience.progress.updateProgression(Math.round(this.previousProgressPosition+D.value*(100-this.previousProgressPosition)/D.total))}}.bind(this));var C=this.window.getViewer();if(C){this._resizeCb=C.onViewerResize(this._onViewerResize.bind(this));this._onViewerResize()}if(u){u.registerOnPDSFXMaterial()}this._loopMode="loopRC"},getLayoutId:function(){return this._layoutId},isTouch:function(){return("ontouchstart" in window)},_isAFullExperience:function(B){var z=false;if(B&&B.args&&B.args.workbenchs&&B.args.workbenchs[0]){var A=B.args.workbenchs[0];z=(A.name==="FullSimulationPlayer"||A.name==="FullMeshingReview"||A.name==="FemFileImport")}return z},_updateScrollersHeight:function(){if(this._scrollers){this._scrollers.forEach(function(B){if(B.panel&&B.panel.getContent){var A=B.panel.getContent();if(A&&!A.isHidden()&&B.panel.elements){var z=(B.panel.elements.panel.clientHeight-10).toString()+"px";if(B.scroller){B.scroller.setStyle("height",z)}if(B.panelContent){B.panelContent.setStyle("height",z)}}}})}},_updateFrameWidth:function(A,D){var C=this.window;if(C){var z=C.getUIFrame();if(A&&z){var B=this._infoPaneRatios[this._currentInfoPaneRatioIdx]*C.getUIFrame().getDimensions().width;A.updateFrame(B,D);if(this._currentInfoPaneRatioIdx<this._infoPaneRatios.length-1){if(this._legendToRestore){this.setLegendFrameVisibility(true)}this._onInfoPaneWidthChange()}else{this._legendToRestore=this.frame2D&&this.frame2D.style.display==="block";this.setLegendFrameVisibility(false);if(this.watermark){this.watermark.setRightOffset(0)}}}}this._updateExtendButtons()},_updateExtendButtons:function(){if(this._reduceOnceButton&&this._extendOnceButton){this._extendOnceButton.style.display=(this._currentInfoPaneRatioIdx<this._infoPaneRatios.length-1)?"block":"none";this._reduceOnceButton.style.display=(this._currentInfoPaneRatioIdx>0)?"block":"none";var A=this.getActiveDD();if(A){var B=A.containsCharts();var z=A.containsImages();if(!B&&!z){this._extendOnceButton.hide();this._reduceOnceButton.hide()}}}},_buildFrame:function(O,N){var A=e.getCommandCheckHeader("CATSPYInfoAccessCmdHdr",this.cmdCtx);if(A&&O){if(this.expandCallback){s.unsubscribe(this.expandCallback)}if(this.resizeCallback){s.unsubscribe(this.resizeCallback)}if(this.animScopeCallback){s.unsubscribe(this.animScopeCallback)}if(this.switchStartCallback){s.unsubscribe(this.switchStartCallback)}if(this.switchEndCallback){s.unsubscribe(this.switchEndCallback)}var K=this.window;if(this._no3Dflag){this._currentInfoPaneRatioIdx=this._infoPaneRatios.length-1;this.infoPaneExpandStatus=true;if(K){K.getActionBar().close()}}var I=this._infoPaneRatios[this._currentInfoPaneRatioIdx]*K.getUIFrame().getDimensions().width;var B=O.buildFrame(I,function(){this._updateScrollersHeight();this._updateExtendButtons();if(N){N()}}.bind(this));if(B){var H=K.getUIFrame();var E=H.getElementsByClassName("spy-maxiplayer-container");var F=H;var J="bottom";if(E.length>0){F=E[0];J="before"}this.frame=new o({title:"",side:"right"}).inject(F,J);var L=new j({title:""}).inject(this.frame);this.frame.getContent().set("styles",{"background-color":"rgba(245,245,245,0.6)"});this.frame.elements.panel.set("styles",{"background-color":"rgba(245,245,245,0.6)"});L.getContent().set("styles",{border:"0px","background-color":"rgba(255,255,255,0)"});L.elements.panel.set("styles",{border:"0px","background-color":"rgba(255,255,255,0)"});var M=new i.Element("div",{id:"infoPaneContainer","class":"spy-infopane-container"}).inject(L);var D=new i.Element("div",{id:"infoPaneSizeControl"}).inject(M);var z=function(Q){this._updateFrameWidth(O,Q);this._updateScrollersHeight()}.bind(this);var C=function(){z(this.animationPosition)}.bind(this);this._extendOnceButton=new i.Element("div",{"class":"spy-infopane-sizecontrol",html:'<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-left"></span>',events:{click:function(){if(this._currentInfoPaneRatioIdx+1<this._infoPaneRatios.length){this._currentInfoPaneRatioIdx++;z()}}.bind(this)}}).inject(D);this._reduceOnceButton=new i.Element("div",{"class":"spy-infopane-sizecontrol",html:'<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-right"></span>',events:{click:function(){if(this._currentInfoPaneRatioIdx-1>=0){this._currentInfoPaneRatioIdx--;z()}}.bind(this)}}).inject(D);this._updateExtendButtons();var G=new v(B);this._scrollers.push({scroller:G.getContent(),panel:this.frame});G.inject(M);G.getContent().style.position="";this.expandCallback=s.subscribe({event:this.getContext()+"/SPY/FRAMEVIEW/EXPAND"},this._updateScrollersHeight.bind(this));this.resizeCallback=s.subscribe({event:"SPY/WIDGETRESIZED"},z);this.animScopeCallback=s.subscribe({event:this.getContext()+"/SPY/ANIMSCOPECHANGE"},C);this.frame.onSlideOut(function(){if(this.frame2D){this.frame2D.style.right=""}if(this.streamsManager){this.streamsManager.setRightOffset(0)}if(this.watermark){this.watermark.setRightOffset(0)}if(this.maxiPlayer){this.maxiPlayer.setRightOffset(0)}this.infoPaneExpandStatus=false;if(A){A.setState(false)}}.bind(this));this.frame.onSlideIn(function(){this.infoPaneExpandStatus=true;this._onInfoPaneWidthChange();if(A){A.setState(true)}}.bind(this));this.switchStartCallback=s.subscribe({event:this.getContext()+"/SPY/SWITCH_CMD_STARTED"},function(){if(this.frame){this.frame.hide()}}.bind(this));this.switchEndCallback=s.subscribe({event:this.getContext()+"/SPY/SWITCH_CMD_ENDED"},function(){if(this.frame){this.frame.show();if(this.infoPaneExpandStatus){this._onInfoPaneWidthChange()}}}.bind(this))}if(A){if(this.frame){A.enable();if(this.infoPaneExpandStatus){this.frame.slideIn()}else{this.frame.slideOut()}var P=e.getCommand("AnnotationCommands",this.cmdCtx);if(P){P.onBegin(function(){if(this.frame){this.frame.hide()}}.bind(this));P.onEnd(function(){if(this.frame){this.frame.show()}}.bind(this))}}else{A.disable()}}}},_onInfoPaneWidthChange:function(){if(this.infoPaneExpandStatus&&this.frame){var z=this.frame.elements.panel.clientWidth+30;if(this.frame2D){this.frame2D.style.right=z+50+"px"}if(this.streamsManager){this.streamsManager.setRightOffset(z)}if(this.watermark){this.watermark.setRightOffset(z)}if(this.maxiPlayer){this.maxiPlayer.setRightOffset(z)}}},getContext:function(){return this.ctx},buildTreeView:function(){},getActiveSequence:function(){return this.activeSequence},getActiveDD:function(){var z;if(this.activeDD!==-1&&this.activeSequence!==-1){var A=this.spm.getDataDisplayList(this.activeSequence);z=A[this.activeDD]}return z},getValueDisplayPrecision:function(){return 3},clean:function(C){if((this.activeDD>=0||this.activatingDD>=0)&&this.activeSequence>=0){var B=this.getActiveDD();this.activeDD=-1;this.activatingDD=-1;this.clearAnimation();if(!C&&this.syncMgr){this.syncMgr.stopSync();this.syncMgr.resetComponentsToSync();this.syncMgr.destroy();delete this.syncMgr;this.syncMgr=undefined}if(this.probingMgr){if(this.probingMgr.isProbingActive()){this.probingMgr.stopProbing()}}if(B){B.resetLoadingStatus();B._animationIsInitializing=false;B.QI("CATISimNavDataDisplayUI",function(F){F.clean()});B.QI("CATISimNavDataColorShadingManager",function(F){if(F&&F.supportsShading()){F.resetOverride()}})}if(this.disclaimer){this.disclaimer.remove();delete this.disclaimer}if(this.frame){this.frame.remove();this.frame.destroy();delete this.frame}if(this._camerasPanel){this._camerasPanel.remove();this._camerasPanel.destroy();delete this._camerasPanel}this._scrollers=[];if(this.frame2D){this.frame2D.remove();this.frame2D.destroy();delete this.frame2D}if(this.frameStreamlines){this.frameStreamlines.remove();this.frameStreamlines.destroy();delete this.frameStreamlines}if(this.frameSelectionCallback){s.unsubscribe(this.frameSelectionCallback)}if(this.legendEditMinCallback){s.unsubscribe(this.legendEditMinCallback)}if(this.legendEditMaxCallback){s.unsubscribe(this.legendEditMaxCallback)}if(this.legendPassFailSwitchCallback){s.unsubscribe(this.legendPassFailSwitchCallback)}if(this.window.removeReviewModel){this.window.removeReviewModel()}f.remove(this.getContext(),"ANNOTATION_MANAGER");var D=this.window.getViewer();if(D){if(this._matOverrideManager){this._matOverrideManager.cleanOverrideSet("SPMUI")}D.empty();if(D.clearScene&&this.window.experience.getRootBag){D.clearScene();var A=D.getRootNode();if(A){var z=this.window.experience.getRootBag();for(var E=0;E<z.children.length;E++){if(z.children[E].SPObj){z.removeChild(z.children[E])}}A.addChild(z)}}D.render()}}},activateSequence:function(A,z){if(A<this.spm.getNbSequences()){if(A!==this.activeSequence){this.clean();this.activeSequence=A;this.activateDD(-1,z)}else{if(z){z()}}}},activateDD:function(D,E){if(this.activeSequence===-1){return}var G=this.spm.getDataDisplayList(this.activeSequence);var H,F;if(D===-1){for(H=0;H<G.length;H++){F=G[H];if(F.activated){D=H;break}}}if(D===-1){for(H=0;H<G.length;H++){F=G[H];if(F&&F.category==="Result"){D=H;break}}}if(D===-1){for(H=0;H<G.length;H++){F=G[H];if(F&&F.category==="Scenario"){D=H;break}}}if(D===-1){for(H=0;H<G.length;H++){F=G[H];if(F&&F.category==="Model"){D=H;break}}}if(G&&D>=0&&D<G.length){var z=e.getCommandCheckHeader("CATSPYInfoAccessCmdHdr",this.cmdCtx);if(z){z.disable()}var B=e.getCommand("CATSPYAnimateCmdHdr",this.cmdCtx);if(B){B.disable()}var L=e.getCommandCheckHeader("CATSPYCameraSelectorCmdHdr",this.cmdCtx);if(L){L.disable()}var M=e.getCommand("CATSPYHideShowCmdHdr",this.cmdCtx);if(M){M.disable()}if(this.datadisplayActivatedCallback){s.unsubscribe(this.datadisplayActivatedCallback)}this.datadisplayActivatedCallback=s.subscribe({event:this.getContext()+"/SPY/DATADISPLAY/ACTIVATED"},function(R){var Z=this.window;this.activeDD=(-1!==this.activatingDD)?this.activatingDD:this.activeDD;this.activatingDD=-1;s.unsubscribe(this.datadisplayActivatedCallback);this.updatePlayAvailability({initValue:1});var T=this.getActiveDD();var ab=T?T.getLegend():undefined;if(T.isAnimated()||(ab&&(ab.userMax||ab.userMin))){this.updateTextures(this.animationPosition)}this.updateExtrema();if(this.frameStreamlines){this.frameStreamlines.destroy();this.frameStreamlines=null;this.streamsManager=null}var Y=T.getStreamlines();if(Y.length>=1){this.frameStreamlines=new i.Element("div",{id:"SP_Overlays_Cont"}).inject(Z.getUIFrame());this.streamsManager=new x({parentContainer:this.frameStreamlines,model:{streamlines:Y,eventId:this.getContext()+"/SPY/VISIBILITY/CHANGE"},viewer:this.window.getViewer()});this.frameStreamlines.style.display="none"}if(M){M.enable()}if(T.getCameraRoot()&&L){L.enable()}if(!this.watermark){this.spm.getLogoUrl(function(af){if(af.length>0){var ae=(this.window.experience&&this.window.experience.UIManager)?this.window.experience.UIManager:undefined;this.watermark=new m({imageURL:af,parentContainer:Z.getUIFrame(),actionBarManager:ae})}}.bind(this))}if(this.watermark){this.watermark.show()}var S=this.spm.getDisclaimer();if(!this.disclaimer){if(S&&S.length>0){this.disclaimer=new l({text:S,parentContainer:Z.getUIFrame()})}}else{this.disclaimer.setText(S)}if(this.frame2D){if(ab){var ad=this.frame2D.clientWidth;var P=this.window.getViewer().divCss3DElement.clientWidth;if(this._no3Dflag||P<2.5*ad){ab.visibility=false}if(this.window.experience&&this.window.experience.isDefaultExperience()){ab.visibility=false}this.setLegendFrameVisibility(ab.visibility)}}var X=R;if(X&&T){this.frameSelectionCallback=s.subscribe({event:this.getContext()+"/SPY/FRAME/SELECT"},function(ae){if(!isNaN(ae)){this.navigateToFrame(ae)}}.bind(this));if(this._isAFullExperience(this.window.experience)){var ac=function(){this.updateTextures(this.animationPosition);this.window.getViewer().render()}.bind(this);this.legendEditMinCallback=s.subscribe({event:this.getContext()+"/SPY/LEGEND/EDIT/USERMIN"},ac);this.legendEditMaxCallback=s.subscribe({event:this.getContext()+"/SPY/LEGEND/EDIT/USERMAX"},ac);var V=this.window.getViewer();if(V){d.setAttribute("Static","High","Transparency","Transparency","WeightedAverage");d.commitToDB();var U=T.isAnimated();var W=false;var aa=(ab&&ab.localMin&&ab.localMin.length>0);if(T.category==="Result"||T.plotType&&T.plotType!==""){var O=T.getGroupInfo(U?this.animationPosition:0);if(undefined!==O){if(k&&!this.probingMgr){this.probingMgr=new k({viewer:V,rootNode:this.window.experience.getRootBag(),valueDisplayPrecision:this.getValueDisplayPrecision(),syncEvent:this.getContext()+"/SPY/PROBING"})}if(this.probingMgr){if(this.probingMgr.isProbingActive()){this.probingMgr.stopProbing()}this._startProbing();W=true}}}else{if(this.probingMgr){this.probingMgr.stopProbing()}}this.initSynchro({viewer:V,hasCameras:T.getCameraRoot(),animation:U,probing:W,legend:aa})}T.QI("CATISimNavDataColorShadingManager",function(ag){if(ag&&ag.supportsShading()){var ak=0;ag.computeColors(ak,function(){this._buildFrame(X,function(){ag.activateShading({overrideSet:this._matOverrideManager.getOverrideSet("SPMUI"),viewer:V})}.bind(this))}.bind(this))}else{this._buildFrame(X)}var ah=e.getCommand("CATSPYRHESwitchCmdHdr",this.cmdCtx);var ai=e.getCommand("CATSPYRHESwitchResetCmdHdr",this.cmdCtx);if(ah&&ai){ah.disable();ai.disable();var aj=T.getNavData3DViewList();if(aj){var af=ag&&ag.supportsShading();if(!af&&(T.category==="Result"||(T.plotType&&T.plotType!==""))){for(var ae=0;!af&&ae<aj.length;ae++){af=aj[ae].supportedModes&&aj[ae].supportedModes.search("REA")>=0}}if(af){ah.enable();ai.enable()}}}}.bind(this))}var Q=e.getCommand("CATSPYHideShowLegendCmdHdr",this.cmdCtx);if(Q){if(this.frame2D){Q.enable()}else{Q.disable()}}}if(E){E()}}.bind(this));if(D===this.activatingDD){return}if(D===this.activeDD){s.publish({event:this.getContext()+"/SPY/DATADISPLAY/ACTIVATED"})}else{this.spm.clearLoadingQueue(this.activeDD===-1);this.spm.clearLoadingMap();this.clean(true);this.activatingDD=D;var C=G[D];this.spm.initLoadingMap(C.getMultiInstanciatedFiles());var I=this.spm.getDataDisplayList(this.activeSequence);for(H=0;H<I.length;H++){I[H].activated=false}C.activated=true;this._no3Dflag=C.list3DViews.length===0;var K=this.window;this.animationPosition=C.getTotalNumberOfFrames()-1;if(C.isAnimated()){C.QI("CATISimNavDataAnimation",function(O){if(O){var P=O.getCurrentAnimationStep();if(!isNaN(P)){this.animationPosition=P}}this.animationScope=C.getDefaultAnimationScope(this.animationPosition);C.updateLegend(this.animationScope)}.bind(this))}if(this.watermark){this.watermark.hide()}var A=C.getCameraRoot();if(A){var N=A.getListCamera().length;if(N>1){var J=this.getCameraSelectorView();this.updateCameraSelector(A,J);this.setCameraBrowsingStatus(false);this._cameraSelector.updateViewPoint()}this._animateSingleCamera()}C.QI("CATISimNavDataDisplayUI",function(O){var P=function(Q){if(Q){this.frame2D=new i.Element("div",{"class":"spy-immersivepanel"+(this.isTouch()?" spy-immersivepanel-touch":""),id:"SP_2D_Cont"}).inject(K.getUIFrame());Q.inject(this.frame2D)}this.spm.clearLoadingQueue(this.activeDD===-1);this.visuLoadingFinishedCallback=s.subscribe({event:this.getContext()+"/SPY/VISULOADING/FINISHED"},function(){s.unsubscribe(this.visuLoadingFinishedCallback);setTimeout(function(){var S=O.getImpl();if(S){if(!this._no3Dflag&&!S.getCameraRoot()&&!this.noReframe){this.window.getViewpoint().reframe()}}s.publish({event:this.getContext()+"/SPY/DATADISPLAY/ACTIVATED",data:O})}.bind(this),500)}.bind(this));var R=this.window.getViewer();if(R){if(!this._matOverrideManager){this._matOverrideManager=new t()}s.publish({event:this.getContext()+"/SPY/PROGRESS/INIT",data:{red:false,fromPreviousValue:true}});if(this._no3Dflag){s.publish({event:this.getContext()+"/SPY/VISULOADING/FINISHED"});s.publish({event:this.getContext()+"/SPY/PROGRESS/END"});this.createFakeSphere();this.window.experience.markAssetLoaded()}else{O.build3D({initProgressFromCurrent:true,parentNode:this.window.experience.getRootBag(),overrideManager:this._matOverrideManager,callback:function(){s.publish({event:this.getContext()+"/SPY/VISULOADING/FINISHED"});s.publish({event:this.getContext()+"/SPY/PROGRESS/END"});this.window.experience.markAssetLoaded();if(this._cameraSelector){this._cameraSelector.updateViewPoint(true)}this._animateSingleCamera(true)}.bind(this)});if(this._matOverrideManager&&R&&O.node){this._matOverrideManager.cleanOverrideSet("SPMUI");this._matOverrideManager.createOverrideSet({id:"SPMUI",viewer:R,root:this.window.experience.getRootBag()})}}}}.bind(this);O.build2D(P)}.bind(this))}}},setLegendFrameVisibility:function(B){var z=this.frame2D;var D;var F;if(z){if(B){z.style.display="block";D="I_SimNavShowLegend";F="I_SimNavHideLegend";var A=this.getActiveDD().getLegend();A.QI("CATISimNavDataSpecUI",function(G){G.updateSizeResponsive()})}else{z.style.display="none";D="I_SimNavHideLegend";F="I_SimNavShowLegend"}}var E=this.window.getActionBar();if(E){var C=E.getContent().querySelectorAll('*[style*="'+D+'"]')[0];if(C){C.style.backgroundImage=C.style.backgroundImage.replace(D,F)}}},initSynchro:function(z){if(q&&z&&z.viewer&&this.syncOptions){if(!this.syncMgr){this.syncMgr=new q(this.syncOptions)}else{this.syncMgr.resetComponentsToSync()}if(this.syncMgr){this.syncMgr.attachSyncButton(this.frame2D);var A={};if(this.syncOptions.simNavSyncDomain.viewpoint){A.viewpoint={viewer:z.viewer,cameraCheck:z.hasCameras?"_SPYCameraId":undefined}}if(this.syncOptions.simNavSyncDomain.viewpoint&&z.probing){A.probing={event:this.getContext()+"/SPY/PROBING",callback:function(B){if(this.probingMgr&&this.probingMgr.isProbingActive()){this.probingMgr.processProbingPosition(B)}}.bind(this)}}A.instanceDispose={event:this.getContext()+"/SPY/INSTANCEDISPOSE"};if(z.animation){if(this.syncOptions.simNavSyncDomain.frameNavigation){A.frameNavigation={event:this.getContext()+"/SPY/FRAME/SELECT",callback:function(B){if(!isNaN(B)){this.navigateToFrame(B,null,false)}}.bind(this)}}if(this.syncOptions.simNavSyncDomain.animation){A.animation={play:{event:this.getContext()+"/SPY/ANIM/PLAY",callback:function(E){var F=E.position;var B=E.totalNumberOfFrames;if(!isNaN(F)&&!isNaN(B)){var D=this.getActiveDD();if(D){if(D&&D.isAnimated()){this.updatePlayAvailability({forceToDisabledFlag:true});s.publish({event:this.getContext()+"/SPY/FRAME/DISABLESELECT"});if(this.probingMgr){this.probingMgr.stopProbing()}var C=function(){this.animationPosition=F;this.animationScope=D.getAnimationScope(F);if(this.animationScope.length>1){D.updateLegend(this.animationScope)}}.bind(this);if(!D.isAnimationInitialized()){this.initAnimation(false,C)}else{C()}}}}}.bind(this)},clear:{event:this.getContext()+"/SPY/ANIM/CLEAR",callback:function(){this.clearAnimation(this.animationForwardFlag);this.updatePlayAvailability()}.bind(this)},frameChanged:{event:this.getContext()+"/SPY/ANIM/FRAMECHANGED",callback:function(B){var C=this.getActiveDD();if(C&&C.isAnimated()&&this.animationScope.length>1&&C.isAnimationInitialized()){C.QI("CATISimNavDataAnimation",function(D){var E=C.getTotalNumberOfFrames();if(B.position<E){D.animate(B.position,{navigateMode:false,forward:B.forward,animationScope:this.animationScope});this.animationPosition=B.position;this.animationForwardFlag=B.forward}}.bind(this))}}.bind(this)}}}}if(this.syncOptions.simNavSyncDomain.legend&&z.legend){A.legendMinMaxRequest={callback:function(){var D;var B=this.getActiveDD();if(B){var C=B.getLegend();if(C){D=C.getMinMaxData(this.animationPosition)}}return D}.bind(this)};A.legendMinMaxResponse={callback:function(D){var B=this.getActiveDD();if(B){var C=B.getLegend();if(C){C.integrateMinMaxData(D,this.animationPosition)}}}.bind(this)};A.legendMinEdited={event:this.getContext()+"/SPY/LEGEND/EDIT/USERMIN",callback:function(D){var B=this.getActiveDD();if(B){var C=B.getLegend();if(C){if(C.unit===D.unit){var E=!isNaN(D.value)?D.value:D.computed;C.setUserMin(E,this.animationPosition,false)}}}}.bind(this)};A.legendMaxEdited={event:this.getContext()+"/SPY/LEGEND/EDIT/USERMAX",callback:function(D){var B=this.getActiveDD();if(B){var C=B.getLegend();if(C){if(C.unit===D.unit){var E=!isNaN(D.value)?D.value:D.computed;C.setUserMax(E,this.animationPosition,false)}}}}.bind(this)}}if(Object.keys(A).length>0){this.syncMgr.addComponentsToSync(A)}}}},initAnimation:function(A,z){var C=this.getActiveDD();if(!C._animationIsInitializing){C._animationIsInitializing=true;var B=this.window.getViewer();if(this.watermark){this.watermark.hide()}C.QI("CATISimNavDataAnimation",function(D){D.initAnimation(function(){if(isNaN(this.animationPosition)){this.animationPosition=C.getTotalNumberOfFrames()-1}if(C.isPartialAnimationMode()){this.animationScope=C.getAnimationScope(this.animationPosition);if(this.animationScope.length<=1||!this.animationScope.canBePartial){this.animationScope=C.getDefaultAnimationScope(this.animationPosition);C.setPartialAnimationMode(false)}}else{this.animationScope=C.getDefaultAnimationScope(this.animationPosition)}C.updateLegend(this.animationScope);C._animationIsInitializing=false;C.setAnimationAsInitialized();this._currentAnimDD=D;if(A){var E=1;var H=function(K,J){if(this._currentAnimDD){var L=this.animationScope.frames[K-1].globalIndex-1;if(this.animationPosition!==L){if(!this._currentAnimDD.isFrameLoaded(this.animationPosition)){this.spm.clearLoadingQueue()}this.animationPosition=this.animationScope.frames[K-1].globalIndex-1;if(K===1){J=true}var I=this.getActiveDD();s.publish({event:this.getContext()+"/SPY/ANIM/FRAMECHANGED",data:{position:this.animationPosition,totalNumberOfFrames:I.getTotalNumberOfFrames(),totalComputedFramesNumber:I.getAnimationStructure().totalComputedFramesNumber,forward:J}});this._currentAnimDD.animate(this.animationPosition,{navigateMode:false,forward:J,animationScope:this.animationScope});B.render()}}}.bind(this);var F=function(){if(!this.maxiPlayer){var J=(this.window.experience&&this.window.experience.UIManager)?this.window.experience.UIManager:undefined;var K=this.window?this.window.getActionBar():undefined;var I=-0.38*((this.animationScope.length-E)-5)+200;I=(I>=200)?200:(I<=50)?50:I;this.maxiPlayer=new n({device:this.device,resizeManager:J,actionBarManager:J,actionBar:K,minValue:E,maxValue:this.animationScope.length,initValue:E,intervalMS:I,canPlayerChangeTo:function(M,O,P,L){if(this._currentAnimDD){var N=this.animationScope.frames[M-1].globalIndex-1;if(this._currentAnimDD.isFrameLoaded(N)){if(O){O(M)}}else{if(P){P()}this._currentAnimDD.loadFrame(N,function(){L(M)})}}}.bind(this),onPlayerChange:H,onStop:function(){this.pause()}.bind(this),onPlay:function(){s.publish({event:this.getContext()+"/SPY/FRAME/DISABLESELECT"});this.play()}.bind(this),onPause:function(){this.pause()}.bind(this),onOptions:function(){if(!this._playerSpeedOptionDlg){this._playerSpeedOptionDlg=new r({container:this.window.getUIFrame(),actionBar:K,initialLayoutId:this._layoutId,resizeEvent:this.ctx+"/SPY/VIEWERRESIZE",speedFactor:this._speedFactor,onChange:this.maxiPlayer.setCurrentSpeedFactor.bind(this.maxiPlayer)})}else{this._playerSpeedOptionDlg.destroy();this._playerSpeedOptionDlg=undefined}}.bind(this),onExit:function(){var L=e.getCommand("CATSPYAnimateCmdHdr",this.cmdCtx);if(L){L.end()}}.bind(this),loopMode:this._loopMode,speedFactor:this._speedFactor});if(this.watermark){this.watermark.setBottomOffset(80)}this.maxiPlayer.inject(this.window.getUIFrame());if(this.infoPaneExpandStatus){if(this.frame){this.frame.slideIn()}}if(this._camBrowsing){if(this._camerasPanel){this._camerasPanel.slideIn()}}}this.maxiPlayer.show();this.maxiPlayer.play()}.bind(this);var G=this.animationScope.frames[E-1].globalIndex-1;if(D.isFrameLoaded(G)){H(E);F()}else{D.loadFrame(G,function(){H(E);F()})}}if(this.watermark){this.watermark.show()}if(z){z()}}.bind(this))}.bind(this))}},play:function(){var z=this.getActiveDD();if(z&&z.isAnimationInitialized()&&!this.running){this.running=true;if(this.probingMgr){this.probingMgr.stopProbing()}this.updateExtrema()}},pause:function(){this.running=false},clearAnimation:function(z){this.pause();this.spm.clearLoadingQueue(this.activeDD===-1);if(this.maxiPlayer){z=this.maxiPlayer.playerForwardDirection;this._loopMode=this.maxiPlayer.getLoopMode();this._speedFactor=this.maxiPlayer.getCurrentSpeedFactor();this.maxiPlayer.clear();this.maxiPlayer.hide();this.maxiPlayer.removeFrom(this.window.getUIFrame());this.maxiPlayer=null;if(this.watermark){this.watermark.setBottomOffset(0)}}if(this._playerSpeedOptionDlg){this._playerSpeedOptionDlg.destroy();this._playerSpeedOptionDlg=undefined}var A=this.getActiveDD();if(A){var B=A.getGroupForFrame(this.animationPosition);if(B&&B.group){if(B.group.scaledAnimation){var C=A.getClosestComputedFrameInGroup(this.animationPosition,z);this.navigateToFrame(C)}else{this.updateTextures(this.animationPosition);this.window.getViewer().render();this._startProbing();this.updateExtrema()}s.publish({event:this.getContext()+"/SPY/FRAME/ENABLESELECT"})}}this._currentAnimDD=undefined},isAnimationRunning:function(){return this.running},getAnimationPosition:function(){return this.animationPosition},updatePlayAvailability:function(B){var A=this.getActiveDD();var z=e.getCommand("CATSPYAnimateCmdHdr",this.cmdCtx);if(z&&A){if(undefined!==B&&undefined!==B.forceToDisabledFlag){z.disable()}else{if(A.isAnimated()&&this.animationScope.length>1){z.enable();if(this.maxiPlayer){var C=undefined!==B?B.initValue:undefined;this.maxiPlayer.updateBoundaries(1,this.animationScope.length,C)}}else{z.disable()}}}},navigateToFrame:function(B,C,z){if(this._processingNavFrame!==B){this._processingNavFrame=B;var A=this.getActiveDD();if(B>0&&B<=A.getTotalNumberOfFrames()){A.QI("CATISimNavDataAnimation",function(E){var D=function(){if(!E.isFrameLoaded(this.animationPosition)){this.spm.clearLoadingQueue()}this.animationPosition=B-1;if(A.isPartialAnimationMode()){var G=true;var F=A.getAnimationScope(this.animationPosition);if(F.length<=1||!F.canBePartial){F=A.getDefaultAnimationScope(this.animationPosition);A.setPartialAnimationMode(false)}else{G=(F.globalStart!==this.animationScope.globalStart||F.globalEnd!==this.animationScope.globalEnd)}this.animationScope=F;if(G){s.publish({event:this.getContext()+"/SPY/ANIMSCOPECHANGE"})}}else{this.animationScope=A.getDefaultAnimationScope(this.animationPosition)}this.updatePlayAvailability();var H=function(){A.updateLegend(this.animationScope);E.animate(this.animationPosition,{navigateMode:true,animationScope:this.animationScope,noEvent:z===false});this.updateTextures(this.animationPosition);this._startProbing();this.updateExtrema();this._processingNavFrame=undefined;if(C){C()}}.bind(this);if(!E.isFrameLoaded(this.animationPosition)){E.loadFrame(this.animationPosition,H)}else{H()}}.bind(this);if(!A.isAnimationInitialized()){E.initAnimation(function(){D()})}else{D()}}.bind(this))}}},setInformationStatus:function(z){if(this.frame){if(z!==this.infoPaneExpandStatus){this.frame.slideToggle()}this.xcrosshighlightActive=z;var A=this.getActiveDD();if(A){var C=A.getNavDataFrameViewList();if(C){var D=function(F){if(F){if(this.xcrosshighlightActive){F.enableCrossHighlight()}else{F.disableCrossHighlight()}}}.bind(this);for(var B=0;B<C.length;B++){var E=C[B];if(E){E.QI("CATISimNavDataSpecUI",D)}}}}}},toggleExtrema:function(){var z=this.getActiveDD();if(z){z.QI("CATISimNavDataDisplayUI",function(A){A.setExtremaRequestedFlag(!A.getExtremaRequestedFlag());this.updateExtrema()}.bind(this))}},updateExtrema:function(){var B=false;var D=false;var C=this.isAnimationRunning();var z=this.getActiveDD();if(z&&z.category==="Result"){z.QI("CATISimNavDataDisplayUI",function(E){var G=function(){E.setExtremaVisibility(D);var J=D?"I_SimNavShowMinMax":"I_SimNavHideMinMax";var L=D?"I_SimNavHideMinMax":"I_SimNavShowMinMax";var K=this.window.getActionBar();if(K){var I=K.getContent().querySelectorAll('*[style*="'+J+'"]')[0];if(I){I.style.backgroundImage=I.style.backgroundImage.replace(J,L)}}this.window.getViewer().render()}.bind(this);if(C){G()}else{var F=z.getTotalNumberOfFrames();var H=(this.animationPosition===undefined)?F-1:this.animationPosition;B=z.hasExtremaAvailable(H);if(B){D=E.getExtremaRequestedFlag();if(D){E.computeExtrema(H,function(){G()})}else{G()}}else{G()}}}.bind(this))}var A=e.getCommand("CATSPYShowHideExtremaCmdHdr",this.cmdCtx);if(A){if(B){A.enable()}else{A.disable()}}},onUpdatePsoProbing:function(){},getOverrideManager:function(){return this._matOverrideManager},updateTextures:function(B,A,N){var F=this.getActiveDD();if(F&&F.hasMinMax()){if(!this._textureMapProcessor){this._textureMapProcessor=new c()}if(this._textureMapProcessor){var E=N&&N.animationScope?N.animationScope:F.getAnimationScope(B);var z=F.getGroupInfo(B);if(E&&!isNaN(E.min)&&!isNaN(E.max)&&z&&!isNaN(z.groupMin)&&!isNaN(z.groupMax)){var G=A?E.min:z.groupMin;var L=A?E.max:z.groupMax;var J={};var I={};if(!isNaN(z.userMin)||!isNaN(z.userMax)){I.from={min:!isNaN(z.userMin)?z.userMin:z.localMin,max:!isNaN(z.userMax)?z.userMax:z.localMax};I.to={min:z.localMin,max:z.localMax}}var D=F.getRetexturingMode(B,A);switch(D){case"NEUTRAL":J.from=undefined;J.to=undefined;break;case"EXTEND":J.from={min:z.localMin,max:z.localMax};J.to={min:G,max:L};break;case"REDUCE":J.from={min:!isNaN(z.userMin)?z.userMin:G,max:!isNaN(z.userMax)?z.userMax:L};J.to={min:z.localMin,max:z.localMax};I=undefined;break;default:break}var M;var C=this.window.experience.getRootBag();if(C){for(var H=0;H<C.children.length&&!M;H++){M=C.children[H].SPObj?C.children[H]:null}}var K={node:M,childCondition:function(O){return(O&&O.SPObj&&O.SPObj.supportedModes.search("ENG")>=0)},frameCondition:function(O,R){var Q=N?(N.visibleFrameOnly?O.children[R].visible:true):true;var P=N?(N.specificFrameOnly?N.frameIndex===R:true):true;return(Q&&P)},rangeTransformations:[J,I],precision:this.getValueDisplayPrecision()};this._textureMapProcessor.applyToNode(K)}}}},setCameraBrowsingStatus:function(z){this.getCameraSelectorView();if(this._camerasPanel){if(this._camBrowsing!==z){this._camBrowsing=z;this._camerasPanel.slideToggle()}}},getCameraBrowsingStatus:function(){return this._camBrowsing},getCameraSelectorView:function(){if(!this._camerasPanel){this._camerasPanel=new o({title:"",side:"left"}).inject(this.window.getUIFrame());var A=new j({title:""}).inject(this._camerasPanel);this._camPanelContent=new i.Element("div",{"class":"spy-camerapane-container"}).inject(A);this._camBrowsing=true;var z=e.getCommandCheckHeader("CATSPYCameraSelectorCmdHdr",this.cmdCtx);this._camerasPanel.onSlideIn(function(){var B=this._camerasPanel.elements.panel.clientWidth+30;this._camBrowsing=true;if(z){z.setState(true)}if(this.maxiPlayer){this.maxiPlayer.setLeftOffset(B)}if(this.disclaimer){this.disclaimer.setLeftOffset(B)}}.bind(this));this._camerasPanel.onSlideOut(function(){this._camBrowsing=false;if(z){z.setState(false)}if(this.maxiPlayer){this.maxiPlayer.setLeftOffset(0)}if(this.disclaimer){this.disclaimer.setLeftOffset(0)}}.bind(this));if(this.resizeCallback2){s.unsubscribe(this.resizeCallback2)}this.resizeCallback2=s.subscribe({event:this.getContext()+"/SPY/VIEWERRESIZE"},this._updateScrollersHeight.bind(this))}return this._camPanelContent},updateCameraSelector:function(z,A){if(!this._cameraSelector){this._cameraSelector=new b(z,this.window.getViewer(),this.spm.getZipEntries(0))}this._cameraSelector.loadScrollingPanel(A,function(){this._scrollers.push({scroller:this._camerasPanel.getContent().querySelector(".wux-scroller"),panel:this._camerasPanel,panelContent:this._camPanelContent});this._updateScrollersHeight()}.bind(this))},createFakeSphere:function(){var z=new w.Sphere();z.radius=10;this.window.getViewer().getRootNode()._bsShow=z}});return i.namespace("DS/SPYUI/controllers/SimulationPlayerUI",a)});define("DS/SPYUI/CATSimNavDataFrameViewColorShading",["UWA/Core","DS/SPYUI/CATSimNavDataSpecColorShading"],function(c,a){var b=a.extend({init:function(){this._parent()},setShadingColor:function(d){this._parent(d);if(this.active){this.activateShading()}},activateShading:function(){this._parent();if(this.shadingColor&&!isNaN(this.shadingColor.red)){var d="rgba("+this.shadingColor.red+", "+this.shadingColor.green+", "+this.shadingColor.blue+", 1)";this.implementation.QI("CATISimNavDataSpecUI",function(e){if(e.colorCodedElement){e.colorCodedElement.style.backgroundColor=d}})}},deactivateShading:function(){this._parent();this.implementation.QI("CATISimNavDataSpecUI",function(d){if(d.colorCodedElement){d.colorCodedElement.style.backgroundColor="inherit"}})},});return c.namespace("DS/SPYUI/CATSimNavDataFrameViewColorShading",b)});define("DS/SPYUI/commands/CATSPYTranspResetCmd",["UWA/Core","DS/SPYUI/commands/CATSPYResetCmd"],function(c,a){var b=a.extend({init:function(d){this._parent(d)},execute:function(){var f=this.getFrameWindow().experience.getRootBag();var d=0;var h=false;var g=function(){this._viewer.render()}.bind(this);var e=function(){d--;if(d===0&&h){g()}};f.traverse(function(i){if(i.SPObj){if(i.SPObj.transparent){d++;i.SPObj.transparent=false;i.SPObj.QI("CATISimNavDataSpecUI",function(j){if(j){j.applyTransparency(e)}})}}});h=true;if(d===0){g()}this.end()}});return b});define("DS/SPYUI/CATSimNavDataFrameViewCompUI",["UWA/Core","DS/SPYUI/CATSimNavDataSpecUI","DS/Core/Core","DS/CoreEvents/Events","DS/Visualization/PathElement"],function(f,c,e,b,d){var a=c.extend({init:function(){this._parent()},buildFrame:function(g){alert("error: call to buildFrame on CATSimNavDataFrameViewCompUI")},enableCrossHighlight:function(){var j=this.implementation.getLinks("Frameto3D");if(j){this.pointedData=j.getPointedData();this.addToCsoCallback=e.Selection.CSOManager.onAdd(this.addToCso.bind(this));this.removeFromCsoCallback=e.Selection.CSOManager.onRemove(this.removeFromCso.bind(this));this.highlightFlag=false;this.renderHighlight(this.highlightFlag);if(this.selectableWidget){this.selectableClickListener=function(i){this.highlightFlag=!this.highlightFlag;if(this.highlightFlag){this.addPointedToCSO();b.publish({event:this.getImpl().getDataDisplay().getSPM().getContext()+"/SPY/FRAMEVIEW/SELECT",data:this})}else{this.removePointedFromCSO()}this.renderHighlight(this.highlightFlag)};this.selectableWidget.addEvent("click",this.selectableClickListener.bind(this))}}else{var h=this.implementation.children;if(h){var k=function(i){if(i){i.enableCrossHighlight()}};for(var g=0;g<h.length;g++){var l=h[g];if(l){l.QI("CATISimNavDataSpecUI",k)}}}}},disableCrossHighlight:function(){this.highlightFlag=false;this.renderHighlight(this.highlightFlag);if(this.addToCsoCallback){e.Selection.CSOManager.unsubscribe(this.addToCsoCallback)}if(this.removeFromCsoCallback){e.Selection.CSOManager.unsubscribe(this.removeFromCsoCallback)}if(this.emptyCsoCallback){e.Selection.CSOManager.unsubscribe(this.emptyCsoCallback)}if(this.selectableWidget){this.selectableWidget.removeEvent("click")}var j=this.implementation.children;if(j){var g=function(i){if(i){i.disableCrossHighlight()}};for(var h=0;h<j.length;h++){var k=j[h];if(k){k.QI("CATISimNavDataSpecUI",g)}}}},setHighlightFlag:function(g){if(g!==this.highlightFlag){this.highlightFlag=g;this.renderHighlight(g)}},renderHighlight:function(g){if(this.selectableWidget){var h="spy-info-highlight";if(g){this.selectableWidget.addClassName(h)}else{this.selectableWidget.removeClassName(h)}}},addPointedToCSO:function(){var g=null;if(this.pointedData){this.pointedData.QI("CATISimNavDataSpecUI",function(i){var h=i.getNode();if(h&&h.getParents()&&h.getParents().length>0){g=new d([h.getParents()[0],h])}})}if(g){e.Selection.CSOManager.unique({pathElement:g});e.Selection.HSOManager.unique({pathElement:g})}},removePointedFromCSO:function(){var g=null;if(this.pointedData){this.pointedData.QI("CATISimNavDataSpecUI",function(i){var h=i.getNode();if(h&&h.getParents()&&h.getParents().length>0){g=new d([h.getParents()[0],h])}})}if(g){e.Selection.CSOManager.remove({pathElement:g,infoClick:true});e.Selection.HSOManager.remove({pathElement:g})}},addToCso:function(i){if(i&&!i.infoClick){var g=null;var j=i.pathElement;if(j){var h=j.getLength()-1;while(!g&&h>0){if(j.getElement(h--).SPObj){g=j.getElement(h+1).SPObj}}if(g){this.setHighlightFlag(g===this.pointedData)}}}},removeFromCso:function(i){if(i&&!i.infoClick){var h=null;var j=i.pathElement;if(j){var g=j.getLength()-1;while(!h&&g>0){if(j.getElement(g--).SPObj){h=j.getElement(g+1).SPObj}}if(h&&h===this.pointedData){this.setHighlightFlag(false)}}}},onExpanderChange:function(){}});return f.namespace("DS/SPYUI/CATSimNavDataFrameViewCompUI",a)});define("DS/SPYUI/CATSimNavDataFrameViewTextUI",["UWA/Core","DS/SPYUI/CATSimNavDataFrameViewCompUI"],function(d,a){var b=0.8;var c=a.extend({init:function(){this._parent()},buildFrame:function(g,f,j){if(!this.implementation){return}var i=new d.Element("tr",{"class":"spy-infopane-content-table-scalar"});this._valueCell=new d.Element("td",{"class":"spy-infopane-content-text-value",styles:{"max-width":""+b*g+"px"}}).inject(i);var h=new d.Element("b").inject(this._valueCell);var e=this.implementation.getValues();if(e&&e.value){h.setText(e.value)}this.selectableWidget=i;if(j){j(i)}return i},updateFrame:function(e,f){if(this._valueCell){this._valueCell.style["max-width"]=""+b*e+"px"}}});return d.namespace("DS/SPYUI/CATSimNavDataFrameViewTextUI",c)});define("DS/SPYUI/CATSimNavDataFrameViewUI",["UWA/Core","DS/SPYUI/CATSimNavDataFrameViewCompUI","DS/CoreEvents/Events","DS/Controls/Expander"],function(e,c,b,a){var d=c.extend({_processExpandCollapse:function(g){b.publish({event:this.getImpl().getDataDisplay().getSPM().getContext()+"/SPY/FRAMEVIEW/EXPAND",data:this});if(!this.implementation){return}var i=this.implementation.getChildren();var h=function(j){if(j){j.onExpanderChange(g)}};for(var f=0;f<i.length;f++){i[f].QI("CATISimNavDataSpecUI",h)}},init:function(){this._parent();this.animationInitialized=false},setExpandStatus:function(f){this.expandFlag=f;if(this._expander){if(f){this._expander.expand()}else{this._expander.close()}}},updateFrame:function(g,i){if(!this.implementation){return}var h=this.implementation.getChildren();var j=function(k){if(k){k.updateFrame(g,i)}};for(var f=0;f<h.length;f++){h[f].QI("CATISimNavDataSpecUI",j)}},buildFrame:function(r,t,h,m,l){if(!this.implementation){return undefined}m=typeof m!=="undefined"?m:true;l=typeof l!=="undefined"?l:false;var v=new e.Element("table",{"class":"spy-infopane-content-table"});var x=new e.Element("tr").inject(v);this.colorCodedElement=new e.Element("td",{"class":"spy-infopane-colorcode"}).inject(x);var n=new e.Element("td").inject(x);var o=new e.Element("div",{"class":"spy-infopane-content"}).inject(n);var g=this.implementation.getChildren();if(g.length>0){var j=null;if(!m&&!l){j=new e.Element("p",{"class":"spy-infopane-content-section-title"}).inject(o);j.setText(this.implementation.getName())}var w=new e.Element("table",{"class":"spy-infopane-content-table"}).inject(o);if(m){this._expander=new a({header:this.implementation.getName(),body:w}).inject(o);this._expander.addEventListener("expand",function(){this._processExpandCollapse(true)}.bind(this));this._expander.addEventListener("collapse",function(){this._processExpandCollapse(false)}.bind(this))}this.expandableZone=w;this.setExpandStatus(m&&t);var i=[];var k=function(){for(var y=0;y<i.length;y++){i[y].inject(w)}if(h){h(v)}};var s=this.implementation.getId();var u=function(B,z,A){if(B,z){var y=t;if(B.implementation.getChildren&&B.implementation.getChildren().length>0&&B.implementation._spyRank!==0){y=false}if(!this._expander){y=true}B.buildFrame(r,y,function(C){z.count--;i[B.implementation._spyRank]=C;if(z.count===0&&z.loopEnded&&A){A()}},B.implementation.isComplex(),B.implementation.getId()===s)}}.bind(this);var q={count:0,loopEnded:false};var f=function(y){u(y,q,k)};for(var p=0;p<g.length;p++){q.count++;g[p]._spyRank=p;g[p].QI("CATISimNavDataSpecUI",f)}q.loopEnded=true;if(q.count===0){k()}}else{if(h){h(v)}}this.selectableWidget=o;return v},renderHighlight:function(f){if(this.selectableWidget){var g="spy-info-highlight";if(f){this.selectableWidget.addClassName(g)}else{this.selectableWidget.removeClassName(g)}}if(this.expandableZone&&f){this.setExpandStatus(true)}},initAnimation:function(k){if(this.animationInitialized){if(k){k()}return}if(!this.implementation){return}var i=0;var h=false;var j=function(l){i--;if(l){l.initAnimation()}if(i===0&&h&&k){this.animationInitialized=true;k()}}.bind(this);var g=this.implementation.getChildren();for(var f=0;f<g.length;f++){i++;g[f].QI("CATISimNavDataAnimation",j)}h=true;if(i===0){this.animationInitialized=true;if(k){k()}}},animate:function(j,g){if(!this.implementation){return}if(this.animationInitialized){var i=function(k){if(k){k.animate(j,g)}};var h=this.implementation.getChildren();for(var f=0;f<h.length;f++){h[f].QI("CATISimNavDataAnimation",i)}}}});return e.namespace("DS/SPYUI/CATSimNavDataFrameViewUI",d)});define("DS/SPYUI/CATSimNavDataFrameViewImageUI",["UWA/Core","DS/SPYUI/CATSimNavDataFrameViewCompUI","DS/Controls/TooltipModel","DS/SMAMpwControls/SMAMpwTooltipedImage"],function(e,d,c,a){var b=d.extend({init:function(){this._parent()},buildFrame:function(g,f,m){if(!this.implementation){return}var l=new e.Element("tr",{"class":"spy-infopane-content-table-scalar"});var i=new e.Element("td",{"class":"spy-infopane-content-image-cell",styles:{"max-width":g.toString()+"px"}}).inject(l);var h=[];h.push(this.implementation.getPNGList()[0]);if(h.length>0){var j=new c({shortHelp:this.implementation.getTooltip()});var k=this.implementation.getTitle();this._loadImage(h[0],function(n){new a({imageUrl:n,tooltipInfos:j,title:k}).inject(i)})}this.selectableWidget=l;if(m){m(l)}return l},_loadImage:function(j,k){var f=this.implementation.getDataDisplay();if(f){var g=f.spm.getZipEntries(f.seq);var h;var i;if(g&&j){i="image/PNG";h=g.find(j)}if(h&&k){h.getBlob(i,function(l){k(URL.createObjectURL(l))})}}},});return e.namespace("DS/SPYUI/CATSimNavDataFrameViewImageUI",b)});define("DS/SPYUI/CATSimNavDataFrameViewCompValueUI",["UWA/Core","DS/SPYUI/CATSimNavDataFrameViewCompUI"],function(c,a){var b=a.extend({init:function(){this._parent()},buildFrame:function(d,j,m){if(!this.implementation){return}var n=new c.Element("tr",{"class":"spy-infopane-content-table-scalar"});var k=new c.Element("td",{"class":"spy-infopane-content-scalar-name"}).inject(n);var i=new c.Element("td").inject(n);var h=new c.Element("td",{"class":"spy-infopane-content-scalar-value"}).inject(n);var f=new c.Element("b").inject(h);var l=new c.Element("td",{"class":"spy-infopane-content-scalar-unit"}).inject(n);var g=new c.Element("td",{"class":"spy-infopane-content-scalar-spacer"}).inject(n);var e=this.implementation.getValues();if(this.implementation.getId()==="NoInfo"&&e&&e.value===undefined&&e.unit===undefined){e.name="No detailed information could be produced"}k.setText(e.name);if(e.type){i.setText(e.type)}if(e.value){f.setText(e.value)}if(e.unit){l.setText(e.unit)}this.selectableWidget=n;if(m){m(n)}return n},});return c.namespace("DS/SPYUI/CATSimNavDataFrameViewCompValueUI",b)});define("DS/SPYUI/CATSimNavData2DViewUI",["UWA/Core","DS/SPYUI/CATSimNavDataSpecUI"],function(c,a){var b=a.extend({init:function(){this._parent()},build2D:function(i){if(!this.implementation){return}var f=this.implementation.getPNGList();var g=[];this._images=[];while(f){g.push(f.getPointedResource());f=f.getNextSpec()}var h=new c.Element("div",{styles:{margin:"10px"}});for(var d=0;d<g.length;d++){var e=new c.Element("img").inject(h);e.src=g[d];this._images.push(e);this._loadImageFromZip(e,g[d])}this._initImagesVisibility();if(i){i(h)}},_loadImageFromZip:function(d,i){var e=this.implementation.getDataDisplay();if(e){var f=e.spm.getZipEntries(e.seq);var g;var h;if(f&&i){h="image/PNG";g=f.find(i)}if(g&&d){g.getBlob(h,function(j){d.src=URL.createObjectURL(j)})}}},_initImagesVisibility:function(){for(var d=0;d<this._images.length;d++){this._images[d].show()}}});return c.namespace("DS/SPYUI/CATSimNavData2DViewUI",b)});define("DS/SPYUI/CATSimNavData2DRepStaticViewUI",["UWA/Core","DS/SPYUI/CATSimNavData2DViewUI"],function(c,b){var a=b.extend({init:function(){this._parent()},});return c.namespace("DS/SPYUI/CATSimNavData2DRepStaticViewUI",a)});define("DS/SPYUI/CATSimNavData2DAnimationViewUI",["UWA/Core","DS/SPYUI/CATSimNavData2DViewUI"],function(c,a){var b=a.extend({init:function(){this._parent()},_initImagesVisibility:function(){for(var d=0;d<this._images.length;d++){this._images[d].hide()}this.animationIndex=this._images.length-1;this._images[this.animationIndex].show()},initAnimation:function(d){if(d){d()}},animate:function(f,d){this.animationIndex=f;for(var e=0;e<this._images.length;e++){if(e===f){this._images[e].show()}else{this._images[e].hide()}}},});return c.namespace("DS/SPYUI/CATSimNavData2DAnimationViewUI",b)});define("DS/SPYUI/CATSimNavData3DAnimationViewUI",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/PathElement","DS/SPYUI/CATSimNavDataSpecUI"],function(e,b,c,a){var d=a.extend({init:function(){},build3D:function(k){if(!this.implementation||!k){return}this._overrideManager=k.overrideManager;this.node=new b(this.implementation.getId());this.node.SPObj=this.implementation;this.node.productType="Reference3D";var i=this.implementation.visibility;var l=this.implementation.isActive();var n=this.implementation.getCGRList();var m=[];var g=[];if(!isNaN(k.animationIndex)){this.animationIndex=k.animationIndex}var j;var h=this.implementation.getAllLoadingDescription();m=h.cgrs;if(isNaN(this.animationIndex)){this.animationIndex=m.length-1}g[0]=m[this.animationIndex];j=h.matrices[this.animationIndex];var f=this.implementation.getDataDisplay().getSPM();var o=this.implementation.getDataDisplay().getSequence();f.loadFiles({initProgressFromCurrent:k.initProgressFromCurrent,filesList:g,framesIndices:[this.animationIndex],fatherNode:this.node,sequence:o,callback:function(){if(this.node.children.length===1){if(j){this.node.children[0].setMatrix(j)}this.node.setVisibility(i&&l);this.node.children[0].setVisibility(true)}if(k.postLoadingCallback){k.postLoadingCallback(this.animationIndex)}}.bind(this),resetProgress:false});if(k.callback){k.callback()}},initAnimation:function(f){if(f){f()}},getLoadingDescription:function(h,f){if(f){var g=this.implementation.getLoadingDescription(h);g.fatherNode=this.node;f(g)}},animate:function(f){this.animationIndex=f;for(var g=0;g<this.node.children.length;g++){this.node.children[g].setVisibility(this.node.children[g]._SPYFrameIndex===this.animationIndex)}},});return e.namespace("DS/SPYUI/CATSimNavData3DAnimationViewUI",d)});define("DS/SPYUI/CATSimNavData3DVirtualComponentUI",["DS/Visualization/Node3D","DS/SPYUI/CATSimNavData3DAnimationViewUI"],function(b,c){var a=c.extend({init:function(){},build3D:function(i){var h=this.getImpl();if(!h||!i){return}this._overrideManager=i.overrideManager;this.node=new b(this.implementation.getId());this.node.setVisibility(false);this.node.SPObj=this.implementation;if(!isNaN(i.animationIndex)){this.animationIndex=i.animationIndex}var g=h.getCGRList();var e=0;while(g){var f=g.getMatrix();g=g.getNextSpec();var d=new b();d.setMatrix(f);d.setVisibility(false);this.node.addChild(d);h.setLoadingStatus(e,"loaded");e++}if(i.callback){i.callback()}if(i.postLoadingCallback){i.postLoadingCallback(this.animationIndex)}}});return UWA.namespace("DS/SPYUI/CATSimNavData3DVirtualComponentUI",a)});define("DS/SPYUI/controllers/GuidanceManager",["UWA/Core","UWA/Class","DS/CoreEvents/Events","DS/SPYUI/GuidanceMsg","DS/SPYUI/ExtendedGuidanceMsg"],function(h,f,c,d,g){var a="DS/SPYUI/assets/xml/";var e="SPYUI";var b=f.singleton({_onViewerResize:function(i){if(this._currentExtMessage){this._currentExtMessage.updateSizeResponsive(i)}},setOptions:function(i){if(i.parentContainer){this._msgDico={};this._msgContainer=i.parentContainer}if(i.resizeEventId){this._resizeCallback=c.subscribe({event:i.resizeEventId},this._onViewerResize.bind(this))}this._initialLayoutId=i.layoutId},loadGuidanceFile:function(i,k){this._currentGuidanceFileName=i;if(this._msgDico){if(!this._msgDico[i]){var j={};this._msgDico[i]=j;require(["text!"+a+i+".xml"],function(v){j.nlsModule=e;var l=new DOMParser();var o=l.parseFromString(v,"text/xml");var u=o.firstChild;if(u.nodeName==="HelpMessage"){for(var q=0;q<u.childNodes.length;q++){var s=u.childNodes[q];if(s.nodeName==="State"){var w=s.getAttribute("name");j[w]={};for(var p=0;p<s.childNodes.length;p++){var x=s.childNodes[p];var m={};if(x.nodeName==="Message"){m.text=x.getAttribute("text");m.image=x.getAttribute("image");j[w].msg=m}else{if(x.nodeName==="MessageExtended"){m.content=[];for(var n=0;n<x.childNodes.length;n++){var t=x.childNodes[n];var r={};if(t.nodeName==="Content"){r.text=t.getAttribute("text");r.image=t.getAttribute("image");m.content.push(r)}}j[w].extMsg=m}}}}}}if(k){k()}})}else{if(k){k()}}}},displayMessage:function(k){this.hideMessage();if(this._msgDico&&this._currentGuidanceFileName){var j=this._msgDico[this._currentGuidanceFileName];if(j){var i=j[k];this._currentExtMessage=new g({msgData:i.extMsg,nlsModule:j.nlsModule,nlsFile:this._currentGuidanceFileName,parentContainer:this._msgContainer});if(this._initialLayoutId){this._currentExtMessage.updateSizeResponsive(this._initialLayoutId)}this._currentMessage=new d({msgData:i.msg,nlsModule:j.nlsModule,nlsFile:this._currentGuidanceFileName,parentContainer:this._msgContainer,extendedMsg:this._currentExtMessage})}}},hideMessage:function(){if(this._currentMessage){this._currentMessage.remove();delete this._currentMessage}if(this._currentExtMessage){this._currentExtMessage.remove();delete this._currentExtMessage}}});return h.namespace("DS/SPYUI/controllers/GuidanceManager",b)});define("DS/SPYUI/commands/CATSPYSwitchCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core","DS/CoreEvents/Events","DS/SPYUI/controllers/GuidanceManager"],function(f,a,e,d,b){var c=a.extend({_preRequisites:function(g){this._spmUI=this.getFrameWindow()?this.getFrameWindow().SPMUI:undefined;this._activeDD=this._spmUI?this._spmUI.getActiveDD():undefined;if(g){g()}},_postRequisites:function(){},_isInDefaultState:function(){},_filterItemsWithDefaultState:function(g,l,k){var j={totalCount:g.length};var h=[];var i=function(m,n){j.totalCount--;if(m===l){h.push(n)}if(j.totalCount===0&&k){k(h)}};g.forEach(function(m){this._isInDefaultState(m,i)}.bind(this))},_listAllOthersInDefaultState:function(j){var i=[];var h=[];if(this._activeDD){h=this._activeDD.getNavData2DViewList();h=h.concat(this._activeDD.getNavData3DViewList());var g=[];h.forEach(function(k){if(k.type!=="CATSimNavData3DExtremasRoot"&&k.type!=="CATSimNavData3DCamerasRoot"&&k.type!=="CATSimNavData2DLegend"){g.push({spObj:k})}});this._filterItemsWithDefaultState(g,true,function(l){l.forEach(function(q){if(q.spObj.isActive()){var p=false;var s,t;t=q.spObj.getId();for(var o=0;o<this._listKeepOnly.length&&!p;o++){var r=this._listKeepOnly[o].spObj;if(r){s=r.getId()}p=(s===t)}if(!p){i.push({spObj:q.spObj})}}}.bind(this));var n={totalCount:i.length};var m=function(){if(j){j(i)}};if(i.length===0){m()}else{var k=function(o){return function(p){if(p){o.node=p.node}n.totalCount--;if(n.totalCount===0){m()}}};i.forEach(function(o){o.spObj.QI("CATISimNavDataSpecUI",k(o))})}}.bind(this))}},_switch:function(g,h){if(h){h()}},_setContextualBarLabels:function(k,j){var i=k.getContent().querySelector("div.wux-afr-view");if(i){var g=j?"wux-afr-state-nolabels":"wux-afr-state-labels";var h=j?"wux-afr-state-labels":"wux-afr-state-nolabels";i.removeClassName(g);i.addClassName(h)}},_onViewerResize:function(){var h=this.getFrameWindow();if(h){var g=h.getContent().getDimensions();var i=h.getContextualUIManager();if(i){var l=this._spmUI.getLayoutId()==="small";var m=i.getContextualBar();if(m){var k=g.width-(l?50:100);var j=(g.height/2)-(l?80:130);m.setPosition({x:k,y:j});this._setContextualBarLabels(m,!l)}}}},init:function(g,h){this._parent(g,h)},beginExecute:function(){d.publish({event:this._ctx+"/SPY/SWITCH_CMD_STARTED"});this._spmUI=this.getFrameWindow()?this.getFrameWindow().SPMUI:undefined;var o=this.getHelpMessageContent();if(o){b.setOptions({parentContainer:this.getFrameWindow().getUIFrame(),resizeEventId:this._ctx+"/SPY/VIEWERRESIZE",layoutId:this._spmUI.getLayoutId()});b.loadGuidanceFile(o.xmlFilename,function(){b.displayMessage(o.stateName)})}var k=this.getFrameWindow();var j=k.getContent().getDimensions();var i=this.getContextualBarDefinition();if(i){var h=k.getContextualUIManager();if(h!==undefined){var g=this._spmUI.getLayoutId()==="small";var n={subscriberId:"SPY_DUM_Ctx",workbenchName:"BasicSimulationPlayer",module:"3DPlayBasicSimulation",cmdPrefix:"",fileName:"BasicSimulationPlayer.xml",onContextualBarReady:function(){var s=h.getContextualBar();if(s){this._hideToRestore=s.hide;this._showToRestore=s.show;s.hide=function(){};s.show=function(){};var r=s.getContent().querySelectorAll("div.wux-afr-cmdstarter");for(var p=0;p<r.length;p++){r[p].style.display="block"}this._setContextualBarLabels(s,!g);var q=s.getContent().querySelector("div.wux-afr-cmdContainer");if(q){q.style.height="auto"}}return{}}.bind(this)};var m={fillingList:[i,n],hideWithDistance:false,x:j.width-(g?50:100),y:(j.height/2)+(g?40:140)};h.activateContextualBarOnLeftClicAfterCSOChange();h.showContextualBar(m);this._resizeCallback=d.subscribe({event:this._ctx+"/SPY/VIEWERRESIZE"},this._onViewerResize.bind(this))}}this._viewer=k.getViewer();this._CSOcb=e.Selection.CSOManager.onAdd(this.elementAdded.bind(this));this.elementAdded();var l=function(p,q,r){this._keepOnlyMode=p;this._listKeepOnly=[];if(r&&this._keepOnlyCmd){this._keepOnlyCmd.setState(false)}this._keepOnlyCmd=q}.bind(this);this._keepOnCallback=d.subscribe({event:this._ctx+"/SPY/SELECTION/KEEPONLY_ON"},function(p){l(true,p)});this._keepOffCallback=d.subscribe({event:this._ctx+"/SPY/SELECTION/KEEPONLY_OFF"},function(p){l(false,p)});this._keepStopCallback=d.subscribe({event:this._ctx+"/SPY/SELECTION/KEEPONLY_STOP"},function(){l(false,undefined,true)})},elementAdded:function(){this._preRequisites(function(){var m=e.Selection.CSOManager.get();var l=[];for(var h=0;h<m.length;h++){var k=null,j=null;this._currentFatherNode=null;var n=m[h].pathElement||m[h].options.pathElement;var g=n.getLength()-1;while(!k&&g>0){if(n.getElement(g--).SPObj){this._currentFatherNode=n.getElement(g);k=n.getElement(g+1);j=n.getElement(g+1).SPObj}}if(j&&k){if(this._keepOnlyMode){this._listKeepOnly.push({spObj:j,node:k})}else{l.push({spObj:j,node:k})}}}if(this._keepOnlyMode){this._filterItemsWithDefaultState(this._listKeepOnly,false,function(i){this._switch(i,function(){this._listAllOthersInDefaultState(function(o){this._switch(o,this._postRequisites.bind(this))}.bind(this))}.bind(this))}.bind(this))}else{this._switch(l,this._postRequisites.bind(this))}}.bind(this))},endExecute:function(){e.Selection.CSOManager.unsubscribe(this._CSOcb);b.hideMessage();var g=this.getFrameWindow().getContextualUIManager();if(g&&this._hideToRestore&&this._showToRestore){g.getContextualBar().show=this._showToRestore;g.getContextualBar().hide=this._hideToRestore;g.getContextualBar().hide()}if(this._keepOnlyCmd){this._keepOnlyCmd.setState(false)}this._listKeepOnly=[];d.publish({event:this._ctx+"/SPY/SWITCH_CMD_ENDED"});d.unsubscribe(this._keepOnCallback);d.unsubscribe(this._keepOffCallback);d.unsubscribe(this._keepStopCallback);d.unsubscribe(this._resizeCallback)},getHelpMessageContent:function(){return undefined},getContextualBarDefinition:function(){return undefined}});return c});define("DS/SPYUI/commands/CATSPYTranspCmd",["UWA/Core","DS/SPYUI/commands/CATSPYSwitchCmd","DS/Core/Core","text!DS/SPYUI/assets/json/SIM_TransparencySwitchToolbar.json"],function(e,a,c,d){var b=a.extend({_preRequisites:function(f){this._spmUI=this.getFrameWindow()?this.getFrameWindow().SPMUI:undefined;this._pos=this._spmUI?this._spmUI.getAnimationPosition():undefined;this._activeDD=this._spmUI?this._spmUI.getActiveDD():undefined;if(this._activeDD){if(this._ddShadingManager){if(f){f()}}else{this._activeDD.QI("CATISimNavDataColorShadingManager",function(g){this._ddShadingManager=g;if(f){f()}}.bind(this))}}},_postRequisites:function(){this._viewer.render()},_applyTransparencyOnNodeUI:function(f,g){if(f){f.applyTransparency(g)}},_isInDefaultState:function(f,g){if(f&&f.spObj&&g){g(!f.spObj.transparent,f)}},_switch:function(g,j){var h={totalCount:g.length};var f=function(){if(j){j()}};if(g.length===0){f()}var i=function(){h.totalCount--;if(h.totalCount===0){f()}};g.forEach(function(k){k.spObj.transparent=!k.spObj.transparent;k.spObj.QI("CATISimNavDataSpecUI",function(l){this._applyTransparencyOnNodeUI(l,i)}.bind(this))}.bind(this))},init:function(f){this._parent(f,{isAsynchronous:true,mode:"exclusive"})},getHelpMessageContent:function(){return{xmlFilename:"CATSimNavSwitchHelpMessages",stateName:"Transparency"}},getContextualBarDefinition:function(){var f={subscriberId:"SPY_Transp_Ctx",workbenchName:"FullSimulationPlayer",module:"3DPlayFullSimulation",cmdPrefix:"",fileName:"FullSimulationPlayer.xml",onContextualBarReady:function(){return JSON.parse(d)}};return f}});return b});define("DS/SPYUI/commands/CATSPYHideShowCmd",["UWA/Core","DS/SPYUI/commands/CATSPYSwitchCmd","DS/Core/Core","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","text!DS/SPYUI/assets/json/SIM_HideShowToolbar.json","text!DS/SPYUI/assets/json/SIM_HideShow_withStreamlines_Toolbar.json"],function(h,e,g,d,b,a,c){var f=e.extend({_postRequisites:function(){g.Selection.CSOManager.empty();g.Selection.HSOManager.empty();this._viewer.render();this._spmUI.updateExtrema()},_isInDefaultState:function(i,j){if(i&&i.spObj&&j){j(i.spObj.visibility,i)}},_switch:function(j,k){var i=this._ctx;j.forEach(function(m){if(m.node){m.node.setVisibility(!m.node.isVisible())}m.spObj.visibility=!m.spObj.visibility;d.publish({event:i+"/SPY/VISIBILITY/CHANGE",data:m.spObj});var l=m.spObj.getSibling();if(l){l.visibility=m.spObj.visibility}});if(k){k()}},_updateLegendDisplayForStreams:function(n){var m=this._spmUI.getActiveDD().getLegend();if(m){var j=this._spmUI.frameStreamlines;var i=this._spmUI.frame2D;if(!n){this._legendDisplayedBeforeStreams=m.visibility}if(m.visibility!==n){var k=i.clientHeight+i.offsetTop;var l=j.firstElementChild.offsetTop;if(n||l<k){m.visibility=n;this._spmUI.setLegendFrameVisibility(m.visibility)}}}},init:function(i){this._parent(i,{isAsynchronous:true,mode:"exclusive"});this.window=this.getFrameWindow()},getHelpMessageContent:function(){return{xmlFilename:"CATSimNavSwitchHelpMessages",stateName:this._streamFlag?"HideShow_withStreamlines":"HideShow"}},getContextualBarDefinition:function(){var i=this._streamFlag;var j={subscriberId:"SPY_HS_Ctx",workbenchName:"BasicSimulationPlayer",module:"3DPlayBasicSimulation",cmdPrefix:"",fileName:"BasicSimulationPlayer.xml",onContextualBarReady:function(){return JSON.parse(i?c:a)}};return j},beginExecute:function(){this._spmUI=this.getFrameWindow().SPMUI;this._streamFlag=(null!==this._spmUI.frameStreamlines);if(this._streamFlag){this._streamsMgrShowCb=d.subscribe({event:this._ctx+"/SPY/STREAMLINESMGR/SHOW"},function(){this._updateLegendDisplayForStreams(false)}.bind(this));this._streamsMgrHideCb=d.subscribe({event:this._ctx+"/SPY/STREAMLINESMGR/HIDE"},function(){this._updateLegendDisplayForStreams(this._legendDisplayedBeforeStreams)}.bind(this))}this._parent();this._viewer.setPicking({displayHL:false})},endExecute:function(){this._parent();var i=b.getCommandCheckHeader("CATSPYStreamlinesCmdHdr",this._ctx);if(i){i.setState(false)}this._viewer.setPicking({displayHL:true});d.unsubscribe(this._streamsMgrShowCb);d.unsubscribe(this._streamsMgrHideCb)}});return f});define("DS/SPYUI/commands/CATSPYRHESwitchCmd",["UWA/Core","DS/SPYUI/commands/CATSPYSwitchCmd","DS/Core/Core","text!DS/SPYUI/assets/json/SIM_RHESwitchToolbar.json"],function(e,a,d,c){var b=a.extend({_preRequisites:function(f){this._parent();this._pos=this._spmUI?this._spmUI.getAnimationPosition():undefined;if(this._activeDD){if(this._ddShadingManager){if(f){f()}}else{this._activeDD.QI("CATISimNavDataColorShadingManager",function(g){this._ddShadingManager=g;if(f){f()}}.bind(this))}}},_postRequisites:function(){this._viewer.render()},_processReplacementObj:function(f,h){if(f&&this._spmUI&&this._activeDD&&!isNaN(this._pos)){var g=this._activeDD.getSPM();if(g){f.build3D({animationIndex:this._pos,overrideManager:this._spmUI.getOverrideManager(),postLoadingCallback:function(){this._currentFatherNode.addChild(f.node);f.applyTransparency();if(!isNaN(this._pos)){f.getImpl().setLoadingStatus(this._pos,"loaded");if(h){h()}}}.bind(this)});g.processLoadFiles()}}},_processRenderingMaterialToggle:function(f,g){if(f){if(f.hasRenderingMaterial()){if(f.isRenderingMaterialApplied()){f.removeRenderingMaterial()}else{f.applyRenderingMaterial()}}if(g){g()}}},_isInDefaultState:function(g,h){if(g&&g.spObj&&h){if(this._ddShadingManager.supportsShading()){g.spObj.QI("CATISimNavDataColorShading",function(i){h(i.isShadingActive(),g)})}else{var f=g.spObj.getSibling();if(f){h(g.spObj.isActive()&&g.spObj.supportedModes.search("ENG")>=0,g)}else{if(g.spObj.supportedModes.search("ENG")>=0&&g.spObj.supportedModes.search("REA")>=0){g.spObj.QI("CATISimNavDataSpecUI",function(i){h(!i.isRenderingMaterialApplied(),g)})}}}}},_switch:function(g,j){var h={totalCount:g.length};var f=function(){if(j){j()}};if(g.length===0){f()}var i=function(){h.totalCount--;if(h.totalCount===0){f()}};g.forEach(function(k){if(this._ddShadingManager.supportsShading()){this._ddShadingManager.toggleElementShading(k.spObj);i()}else{var l=k.spObj.getSibling();if(l){k.spObj.setActive(false);if(k.spObj.setLoadingStatus&&!isNaN(this._pos)){k.spObj.setLoadingStatus(this._pos,"notLoaded")}k.spObj.QI("CATISimNavDataSpecUI",function(m){if(m){this._currentFatherNode.remove(m.node)}}.bind(this));l.setActive(true);l.transparent=k.spObj.transparent;l.QI("CATISimNavDataSpecUI",function(m){this._processReplacementObj(m,i)}.bind(this))}else{if(k.spObj.supportedModes.search("ENG")>=0&&k.spObj.supportedModes.search("REA")>=0){k.spObj.QI("CATISimNavDataSpecUI",function(m){this._processRenderingMaterialToggle(m,i)}.bind(this))}}}}.bind(this))},init:function(f){this._parent(f,{isAsynchronous:true,mode:"exclusive"})},getHelpMessageContent:function(){return{xmlFilename:"CATSimNavSwitchHelpMessages",stateName:"Material"}},getContextualBarDefinition:function(){var f={subscriberId:"SPY_RHE_Ctx",workbenchName:"FullSimulationPlayer",module:"3DPlayFullSimulation",cmdPrefix:"",fileName:"FullSimulationPlayer.xml",onContextualBarReady:function(){return JSON.parse(c)}};return f},endExecute:function(){this._parent();this._ddShadingManager=undefined;this._spmUI=undefined;this._pos=undefined;this._activeDD=undefined}});return b});