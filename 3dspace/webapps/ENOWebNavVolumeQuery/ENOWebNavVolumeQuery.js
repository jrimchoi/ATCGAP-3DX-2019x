/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/ENOWebNavVolumeQuery/ENOWebNavVolumeQueryRobot",["UWA/Class","DS/Robot/FreeRobot","DS/Ruler/Ruler","DS/Visualization/ThreeJS_DS","DS/Selection/HSOManager","DS/SceneGraphNodes/AxisSystemNode","DS/Mesh/MeshUtils","DS/Core/ModelEvents","DS/VisuEvents/EventsManager","DS/VisuEvents/ScreenEvent","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/ContextualBar","DS/RuntimeView/NLSManager","DS/LevelSelector/LevelSelector","DS/ApplicationFrame/CommandsManager","DS/Visualization/PathElement"],function(b,c,o,n,f,m,k,e,i,l,a,p,q,j,d,h){var g=b.extend({init:function(r){var t=this;this._window=r.window;this._sceneGraph=r.sceneGraph;this._viewer=r.viewer;this._modelEvent=new e();this._robot=new c("robotVolumeQuery",this._viewer,true);var s=new h([this._sceneGraph,r.target]);this._robot.setTarget(s);this._sceneGraph.addChild(this._robot);this._ruler=new o(this._window,{offset:95});this._ruler.subscribe("RulerManipulate",function(u){onRulerValueModified(u)});this._onLocalTransfo=function(u){t.onLocalTransoEvents(u)};i.addEvent(this._viewer.canvas,"onMiddleMouseUp",this._onLocalTransfo);i.addEvent(this._viewer.canvas,"onMiddleMouseDown",this._onLocalTransfo)},setTarget:function(r){this._robot.setTarget(r)},onLocalTransoEvents:function(r){var s=this;if(r.eventType=="@onMiddleMouseUpEvent"){s.displayRobotAndRuler()}else{if(r.eventType=="@onMiddleMouseDownEvent"){s.hideRobotAndRuler()}}s._viewer.render()},hideRobotAndRuler:function(){var r=this;if(r._robot.isConnected){r._robot.setVisibility(false)}r._rulerWasVisibleBeforeLocalTransfo=r._ruler.getVisibleFlag();r._ruler.setVisibleFlag(false)},displayRobotAndRuler:function(){var r=this;if(r._robot.isConnected){r._robot.setVisibility(true)}if(r._rulerWasVisibleBeforeLocalTransfo){r._ruler.refresh();r._ruler.setVisibleFlag(true)}},updateRobotFromMatrix:function(r){this._ruler.initOrigin=new n.Vector3().getPositionFromMatrix(r);this._ruler.origin=this._ruler.initOrigin;this._robot.updateCenterPosition(this._ruler.initOrigin);var u=new n.Vector3(r.elements[0],r.elements[1],r.elements[2]).normalize();var t=new n.Vector3(r.elements[4],r.elements[5],r.elements[6]).normalize();var s=new n.Vector3(r.elements[8],r.elements[9],r.elements[10]).normalize();this._robot.updateAxis(u,t,s);this._robot.setMatrix(r);this._ruler.direction=null;this._ruler.value=0},setVisibility:function(r){var s=this;s._robot.setVisibility(r);if(r==true){i.addEvent(s._viewer.canvas,"onMiddleMouseUp",s._onLocalTransfo);i.addEvent(s._viewer.canvas,"onMiddleMouseDown",s._onLocalTransfo)}else{s._ruler.setVisibleFlag(false);i.removeEvent(s._viewer.canvas,"onMiddleMouseUp",s._onLocalTransfo);i.removeEvent(s._viewer.canvas,"onMiddleMouseDown",s._onLocalTransfo)}}});return g});define("DS/ENOWebNavVolumeQuery/ENOWebNavVolumeQueryPanel",["css!DS/ENOWebNavVolumeQuery/ENOWebNavVolumeQuery","i18n!DS/ENOWebNavVolumeQuery/assets/nls/ENOWebNavVolumeQuery.json","DS/PADUtils/PADSettingsMgt","UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Windows/Panel","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/LineEditor","DS/Controls/Expander","DS/Controls/TooltipModel","DS/Controls/SpinBox","DS/WebappsUtils/WebappsUtils"],function(o,i,g,e,q,f,j,n,b,a,r,k,h,d,c){var p=8,l=false,s=12;var m=q.extend({init:function(w){var B=this;this._controller=w.controller;this._parameters={minX:false,minY:false,minZ:false,maxX:false,maxY:false,maxZ:false,centerX:false,centerY:false,centerZ:false,radius:false,offset:false,startObject:false};if(widget.id=="enopad_odt_wgd"){p=1;s=15;if(widget.volumeFilter!==true){g.setSetting("activateVolumeFilter",false)}}this._table=new e.Element("table",{"class":"panelTable"});this._tbody=new e.Element("tbody",{"class":"paneltBody"});var J=new e.Element("tr",{}).inject(this._table);new e.Element("td",{text:i.shapeTypeLabel,"class":"panelTdSeparator"}).inject(J);var I=new e.Element("tr",{}).inject(this._table);var t=new e.Element("td",{"class":"panelTd"}).inject(I);var y=new a({touchMode:false});y.inject(t);this._boxStarter=new n({label:i.boxShape,showLabelFlag:false,icon:c.getWebappsAssetUrl("ENOWebNavVolumeQuery","icons/32/I_ENOWebNavVolumeQuery_Box.png"),displayStyle:"icon",type:"radio",checkFlag:w.defaultShape===0,touchMode:false,allowUnsafeHTMLLabel:false,onClick:function(){if(!(B._controller._context.getRoots().length)){B._controller.displayBoxHandleFilter()}else{B._controller.switchVolumeQueryShape("Box")}B.displayShapeParams(0,B._table)}});this._boxStarter.tooltipInfos=new h({shortHelp:i.boxShape,mouseRelativePosition:true,allowUnsafeHTMLLabel:false});this._sphereStarter=new n({label:i.sphereShape,showLabelFlag:false,icon:c.getWebappsAssetUrl("ENOWebNavVolumeQuery","icons/32/I_ENOWebNavVolumeQuery_Sphere.png"),displayStyle:"icon",type:"radio",checkFlag:w.defaultShape===1,touchMode:false,allowUnsafeHTMLLabel:false,onClick:function(){if(!(B._controller._context.getRoots().length)){B._controller.displaySphereHandleFilter()}else{B._controller.switchVolumeQueryShape("Sphere")}B.displayShapeParams(1,B._table)}});this._sphereStarter.tooltipInfos=new h({shortHelp:i.sphereShape,mouseRelativePosition:true,allowUnsafeHTMLLabel:false});this._proximityStarter=new n({label:i.proximityShape,showLabelFlag:false,icon:c.getWebappsAssetUrl("ENOWebNavVolumeQuery","icons/32/I_ENOWebNavVolumeQuery_Proximity.png"),displayStyle:"icon",type:"radio",checkFlag:w.defaultShape===2,touchMode:false,allowUnsafeHTMLLabel:false,onClick:function(){B._controller.switchVolumeQueryShape("Proximity");B.displayShapeParams(2,B._table)}});this._proximityStarter.tooltipInfos=new h({shortHelp:i.proximityShape,mouseRelativePosition:true,allowUnsafeHTMLLabel:false});y.addChild(this._boxStarter);y.addChild(this._sphereStarter);if(this._controller._proximityAvailable){y.addChild(this._proximityStarter)}else{if(w.defaultShape===2){w.defaultShape=0;this._boxStarter.checkFlag=true}}var H=new e.Element("tr",{}).inject(this._table);new e.Element("td",{text:i.intersectionModeLabel,"class":"panelTdSeparator"}).inject(H);var G=new e.Element("tr",{}).inject(this._table);var u=new e.Element("td",{"class":"panelTd"}).inject(G);var C=new a({touchMode:false});C.inject(u);this._fullyInStarter=new n({label:i.fullyInMode,showLabelFlag:false,icon:c.getWebappsAssetUrl("ENOWebNavVolumeQuery","icons/32/I_ENOWebNavVolumeQuery_FullyIn.png"),displayStyle:"icon",type:"radio",checkFlag:w.defaultIntersection===1,touchMode:false,allowUnsafeHTMLLabel:false,onClick:function(){B._controller.switchVolumeQueryInOutRule("FullIn")}});this._fullyInStarter.tooltipInfos=new h({shortHelp:i.fullyInMode,mouseRelativePosition:true,allowUnsafeHTMLLabel:false});this._partlyInStarter=new n({label:i.partlyInMode,showLabelFlag:false,icon:c.getWebappsAssetUrl("ENOWebNavVolumeQuery","icons/32/I_ENOWebNavVolumeQuery_PartlyIn.png"),displayStyle:"icon",type:"radio",checkFlag:w.defaultIntersection===0,touchMode:false,allowUnsafeHTMLLabel:false,onClick:function(){B._controller.switchVolumeQueryInOutRule("PartlyIn")}});this._partlyInStarter.tooltipInfos=new h({shortHelp:i.partlyInMode,mouseRelativePosition:true,allowUnsafeHTMLLabel:false});this._partlyOutStarter=new n({label:i.partlyOutMode,showLabelFlag:false,icon:c.getWebappsAssetUrl("ENOWebNavVolumeQuery","icons/32/I_ENOWebNavVolumeQuery_PartlyOut.png"),displayStyle:"icon",type:"radio",checkFlag:w.defaultIntersection===2,touchMode:false,allowUnsafeHTMLLabel:false,onClick:function(){B._controller.switchVolumeQueryInOutRule("PartlyOut")}});this._partlyOutStarter.tooltipInfos=new h({shortHelp:i.partlyOutMode,mouseRelativePosition:true});this._fullyOutStarter=new n({label:i.fullyOutMode,showLabelFlag:false,icon:c.getWebappsAssetUrl("ENOWebNavVolumeQuery","icons/32/I_ENOWebNavVolumeQuery_FullyOut.png"),displayStyle:"icon",type:"radio",checkFlag:w.defaultIntersection===3,touchMode:false,allowUnsafeHTMLLabel:false,onClick:function(){B._controller.switchVolumeQueryInOutRule("FullOut")}});this._fullyOutStarter.tooltipInfos=new h({shortHelp:i.fullyOutMode,mouseRelativePosition:true,allowUnsafeHTMLLabel:false});C.addChild(this._fullyInStarter);C.addChild(this._partlyInStarter);C.addChild(this._partlyOutStarter);C.addChild(this._fullyOutStarter);var D=new e.Element("tr",{}).inject(this._table);var K=new e.Element("td",{}).inject(D);this._shapeExpander=new k({style:"simple",header:i.shapeParametersLabel,expandedFlag:l,allowUnsafeHTMLHeader:false,body:this._tbody,}).inject(K);this._shapeExpander.addEventListener("expand",function(M){l=!l});var F=new e.Element("tr",{}).inject(this._table);new e.Element("td",{"class":"panelBottomTdSeparator"}).inject(F);this._minLine=new e.Element("tr",{id:"minLine"}).inject(this._tbody);this._minLine=new e.Element("tr",{id:"minLineTD"}).inject(this._tbody);this._maxLine=new e.Element("tr",{id:"maxLine"}).inject(this._tbody);this._maxLine=new e.Element("tr",{id:"maxLineTD"}).inject(this._tbody);this._minX=new d({value:1,stepValue:1,decimals:2,units:"mm"});this._minY=new d({value:2,stepValue:1,decimals:2,units:"mm",});this._minZ=new d({value:3,stepValue:1,decimals:2,units:"mm",});this._maxX=new d({value:4,stepValue:1,decimals:2,units:"mm",});this._maxY=new d({value:5,stepValue:1,decimals:2,units:"mm",});this._maxZ=new d({value:6,stepValue:1,decimals:2,units:"mm",});this._centerX=new d({value:1,stepValue:1,decimals:2,units:"mm",});this._centerY=new d({value:2,stepValue:1,decimals:2,units:"mm",});this._centerZ=new d({value:3,stepValue:1,decimals:2,units:"mm",});this._radius=new d({value:4,stepValue:1,decimals:2,minValue:1,units:"mm",});this._offset=new d({value:0,stepValue:1,minValue:0,decimals:2,units:"mm",});this._startObject=new r({placeholder:i.proximityPlaceholder,displayClearFieldButtonFlag:true});this.displayShapeParams(w.defaultShape,this._table);if(g.getSetting("activateVolumeFilter")===true){this._filterBody=new a();this._updateFilter=new b({type:"radio","class":"panelTd",label:i.updateFilter,allowUnsafeHTMLLabel:false});this._addFilter=new b({type:"radio","class":"panelTd",label:i.addFilter,checkFlag:true,allowUnsafeHTMLLabel:false});this._filterButton=new n({label:i.filterButton,allowUnsafeHTMLLabel:false,onClick:function(){B._controller.updateVolumeQuery()}});this._filterBody.addChild(this._updateFilter);this._filterBody.addChild(this._addFilter);this._filterBody.addChild(this._filterButton);var L=new e.Element("tr",{}).inject(this._table);var x=new e.Element("td",{}).inject(L);this._filterExpander=new k({style:"simple",header:i.FilterTitle,allowUnsafeHTMLHeader:false,body:this._filterBody,}).inject(x)}var A=new e.Element("tr",{}).inject(this._table);new e.Element("td",{"class":"panelBottomTdSeparator"}).inject(A);var z=new e.Element("tr",{}).inject(this._table);var E=new e.Element("td",{"class":"panelBottomTd"}).inject(z);var v=new a();v.inject(E);this.okButton=new n({label:g.getSetting("activateVolumeFilter")===true?i.selectButton:i.okButton,emphasize:"primary",allowUnsafeHTMLLabel:false,onClick:function(){B._controller.applyVolumeQuery()}});this.cancelButton=new n({label:g.getSetting("activateVolumeFilter")===true?i.closeButton:i.cancelButton,allowUnsafeHTMLLabel:false,onClick:function(){B._controller.displayNotification("cancel");B._controller.end();if(g.getSetting("activateVolumeFilter")===true){B._controller.updateVolumeQuery({action:"cancel"})}}});v.addChild(this.okButton);v.addChild(this.cancelButton);this._panelMain=new j({title:i.panelTitle,immersiveFrame:w.immersiveFrame,content:this._table,width:260,height:"auto",maxHeight:660,position:{offsetX:w.immersiveFrame.elements.container.offsetWidth/2-100,offsetY:w.immersiveFrame.elements.container.offsetHeight/2-115},currentDockArea:p,allowedDockAreas:s,collapsibleFlag:false,verticallyStretchableFlag:true,closeButtonFlag:false});this._panelMain.addEventListener("stopWindowDrag",function(M){p=B._panelMain.currentDockArea});document.body.addEventListener("keyUp",function(M){if(M.keyCode==27){this._panelMain.close();this._panelMain.destroy()}});this._parent(w)},destroy:function(){var t=this;if(this._panelMain){this._parent();this._panelMain.close();this._panelMain.destroy();delete this._panelMain}t._controller._panelCreation=0},hide:function(){if(this._panelMain){this._panelMain.hide()}},show:function(){if(this._panelMain){this._panelMain.show()}},displayShapeParams:function(x,B){var y=this;switch(x){case 0:var w=this._tbody.rows.minLine;while(w.cells.length>0){w.deleteCell(0)}new e.Element("td",{text:i.minValueLabel,}).inject(w);var v=this._tbody.rows.minLineTD;while(v.cells.length>0){v.deleteCell(0)}var A=new e.Element("td",{"class":"panelTd",}).inject(v);new e.Element("span",{text:"X:",}).inject(A);this._minX.inject(A);new e.Element("span",{text:"Y:",}).inject(A);this._minY.inject(A);new e.Element("span",{text:"Z:",}).inject(A);this._minZ.inject(A);this._minX.addEventListener("change",function(C){var D={direction:"min",minX:C.dsModel.value,minY:y._minY.value,minZ:y._minZ.value,maxX:y._maxX.value,maxY:y._maxY.value,maxZ:y._maxZ.value};y._controller.updateBox3D(D,y._parameters.minX,"minX")});this._minY.addEventListener("change",function(C){var D={direction:"min",minX:y._minX.value,minY:C.dsModel.value,minZ:y._minZ.value,maxX:y._maxX.value,maxY:y._maxY.value,maxZ:y._maxZ.value};y._controller.updateBox3D(D,y._parameters.minY,"minY")});this._minZ.addEventListener("change",function(C){var D={direction:"min",minX:y._minX.value,minY:y._minY.value,minZ:C.dsModel.value,maxX:y._maxX.value,maxY:y._maxY.value,maxZ:y._maxZ.value};y._controller.updateBox3D(D,y._parameters.minZ,"minZ")});var z=this._tbody.rows.maxLine;while(z.cells.length>0){z.deleteCell(0)}new e.Element("td",{text:i.maxValueLabel,}).inject(z);var u=this._tbody.rows.maxLineTD;while(u.cells.length>0){u.deleteCell(0)}var t=new e.Element("td",{"class":"panelTd"}).inject(u);new e.Element("span",{text:"X:",}).inject(t);this._maxX.inject(t);new e.Element("span",{text:"Y:",}).inject(t);this._maxY.inject(t);new e.Element("span",{text:"Z:",}).inject(t);this._maxZ.inject(t);this._maxX.addEventListener("change",function(C){var D={direction:"max",minX:y._minX.value,minY:y._minY.value,minZ:y._minZ.value,maxX:C.dsModel.value,maxY:y._maxY.value,maxZ:y._maxZ.value};y._controller.updateBox3D(D,y._parameters.maxX,"maxX")});this._maxY.addEventListener("change",function(C){var D={direction:"max",minX:y._minX.value,minY:y._minY.value,minZ:y._minZ.value,maxX:y._maxX.value,maxY:C.dsModel.value,maxZ:y._maxZ.value};y._controller.updateBox3D(D,y._parameters.maxY,"maxY")});this._maxZ.addEventListener("change",function(C){var D={direction:"max",minX:y._minX.value,minY:y._minY.value,minZ:y._minZ.value,maxX:y._maxX.value,maxY:y._maxY.value,maxZ:C.dsModel.value};y._controller.updateBox3D(D,y._parameters.maxZ,"maxZ")});break;case 1:var w=this._tbody.rows.minLine;while(w.cells.length>0){w.deleteCell(0)}new e.Element("td",{text:i.centerValueLabel,}).inject(w);var v=this._tbody.rows.minLineTD;while(v.cells.length>0){v.deleteCell(0)}var A=new e.Element("td",{"class":"panelTd"}).inject(v);new e.Element("span",{text:"X:",}).inject(A);this._centerX.inject(A);this._centerX.addEventListener("change",function(C){var D={centerX:C.dsModel.value,centerY:y._centerY.value,centerZ:y._centerZ.value};y._controller.updateSphere3D(D,y._parameters.centerX,"centerX")});new e.Element("span",{text:"Y:",}).inject(A);this._centerY.inject(A);this._centerY.addEventListener("change",function(C){var D={centerX:y._centerX.value,centerY:C.dsModel.value,centerZ:y._centerZ.value};y._controller.updateSphere3D(D,y._parameters.centerY,"centerY")});new e.Element("span",{text:"Z:",}).inject(A);this._centerZ.inject(A);this._centerZ.addEventListener("change",function(C){var D={centerX:y._centerX.value,centerY:y._centerY.value,centerZ:C.dsModel.value};y._controller.updateSphere3D(D,y._parameters.centerZ,"centerZ")});var z=this._tbody.rows.maxLine;while(z.cells.length>0){z.deleteCell(0)}new e.Element("td",{text:i.radiusValueLabel,}).inject(z);var u=this._tbody.rows.maxLineTD;while(u.cells.length>0){u.deleteCell(0)}var t=new e.Element("td",{"class":"panelTd"}).inject(u);this._radius.inject(t);this._radius.addEventListener("change",function(C){var D={radius:C.dsModel.value};if(C.dsModel.value>y._radius.minValue){y._controller.updateSphere3D(D,y._parameters.radius,"radius")}});break;case 2:var w=this._tbody.rows.minLine;while(w.cells.length>0){w.deleteCell(0)}new e.Element("td",{text:i.offsetValueLabel,}).inject(w);var v=this._tbody.rows.minLineTD;while(v.cells.length>0){v.deleteCell(0)}var A=new e.Element("td",{"class":"panelTd"}).inject(v);this._offset.inject(A);this._offset.addEventListener("change",function(C){if(C.dsModel.value>0){y._controller.updateProximity3D(C.dsModel.value,y._parameters.offset,"offset")}});var z=this._tbody.rows.maxLine;while(z.cells.length>0){z.deleteCell(0)}var u=this._tbody.rows.maxLineTD;while(u.cells.length>0){u.deleteCell(0)}if(g.getSetting("proximityEvolution")==true){new e.Element("td",{text:i.startObject,}).inject(z);var t=new e.Element("td",{"class":"panelTdProximity"}).inject(u);this._startObject.inject(t);this._startObject._clearFieldButton.addEventListener("click",function(C){C.stopPropagation();if(y._controller._pickCount===0){y._controller._pickCount++;y._startObject.value="";y._controller.changePickableobject()}})}break}},setShapeParameters:function(t){if(t.box){if(!t.filterDrop){if(this._minX.value!==t.box.min.x){this._parameters.minX=true}if(this._minY.value!==t.box.min.y){this._parameters.minY=true}if(this._minZ.value!==t.box.min.z){this._parameters.minZ=true}if(this._maxX.value!==t.box.max.x){this._parameters.maxX=true}if(this._maxY.value!==t.box.max.y){this._parameters.maxY=true}if(this._maxZ.value!==t.box.max.z){this._parameters.maxZ=true}this._minX.value=(isFinite(t.box.min.x))?t.box.min.x:1;this._minY.value=(isFinite(t.box.min.y))?t.box.min.y:2;this._minZ.value=(isFinite(t.box.min.z))?t.box.min.z:3;this._maxX.value=(isFinite(t.box.max.x))?t.box.max.x:4;this._maxY.value=(isFinite(t.box.max.y))?t.box.max.y:5;this._maxZ.value=(isFinite(t.box.max.z))?t.box.max.z:6}else{if(t.filterDrop==true){this._parameters.minX=false;this._minX.value=0;this._parameters.minY=false;this._minY.value=0;this._parameters.minZ=false;this._minZ.value=0;this._parameters.maxX=false;this._maxX.value=100;this._parameters.maxY=false;this._maxY.value=100;this._parameters.maxZ=false;this._maxZ.value=100}}}if(t.center&&t.radius){if(!t.filterDrop){if(this._centerX.value!==t.center.x){this._parameters.centerX=true}if(this._centerY.value!==t.center.y){this._parameters.centerY=true}if(this._centerZ.value!==t.center.z){this._parameters.centerZ=true}if(this._radius.value!==t.radius){this._parameters.radius=true}this._centerX.value=(isFinite(t.center.x))?t.center.x:1;this._centerY.value=(isFinite(t.center.y))?t.center.y:2;this._centerZ.value=(isFinite(t.center.z))?t.center.z:3;this._radius.value=(isFinite(t.radius))?t.radius:4}else{if(t.filterDrop==true){this._parameters.centerX=false;this._centerX.value=0;this._parameters.centerY=false;this._centerY.value=0;this._parameters.centerZ=false;this._centerZ.value=0;this._parameters.radius=false;this._radius.value=100}}}if(t.offset){if(this._offset.value!==t.offset){this._parameters.offset=true}this._offset.value=(isFinite(t.offset))?t.offset:0}},});return m});define("DS/ENOWebNavVolumeQuery/ENOWebNavHandleArrow",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Mesh/MeshUtils","DS/Core/Events","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/SceneGraphFactory"],function(h,f,b,i,c,e,a,j,g){var d=f.extend({init:function(u){this._parent(u.name);this._width=u.width;this._height=this._width*95/60;this._fixedArrowNode=new j({name:"arrowFixedSizeNode3D",ratio:1});var s={width:this._width,height:this._height,fill:true,fillColor:null,noEdge:true,layerNb:1};var o=new i();var q=o.createRectangle(s);var p=this;var m=function(){p.onAsyncDependancyCompleted()};this.addAsyncDependancies(1);var t=b.getWebappsAssetUrl("ENOWebNavVolumeQuery","");var r=new h.ImageUtils.loadTexture(t+"textures/I_ENOWebNavVolumeQueryTextureArrow.png",undefined,m,m,true);r.flipY=false;this.mat=new h.MeshBasicMaterial({map:r,side:h.DoubleSide,transparent:true,alphaTest:0.05,enableClipPlanes:false});this.mat.force=true;var k=g.createMeshNode(q,this.mat);k.setShadow(false);k.setFrustumCulled(false);k.excludeFromCSO(true);k.excludeFromHighlight(true,true);k.setMatrix(new h.Matrix4().rotateX(-0.5*Math.PI).translate(new h.Vector3(-this._width/2,0,0)));var l={position:new h.Vector3(0,0,0),name:"billBoardNode",type:"Cylindrical",viewpoint:u.viewer.currentViewpoint};var n=new c(l);n.add(k);this._fixedArrowNode.add(n);this.add(this._fixedArrowNode);this.setVisibilityInTree(false);this.exludeFromBounding(true);n.setPickable(e.NODRAWHL);this._fixedArrowNode.setPickable(e.NODRAWHL)},getScaledHeight:function(){return this._height*this._fixedArrowNode.scaleFactor}});return UWA.namespace("DS/ENOWebNavVolumeQuery/ENOWebNavHandleArrow",d)});define("DS/ENOWebNavVolumeQuery/ENOWebNavShapeManipulator",["DS/Visualization/ThreeJS_DS","DS/Core/Events","DS/Manipulators/Manipulator"],function(d,a,c){var b=c.extend({init:function(e){this._parent(e);this.projector=new d.Projector();this.setExclusive(true);return this},BeginManipulate:function(g,e,h){this._parent(g,e,h);var f={eventChannel:"BeginManipulate",paths:this.manipulatedPaths,intersection:h};this.publish("BeginManipulate",f);this._initialPositionProjected=e.from[0].getCurrentPosition(this.viewer.canvas);this._initial3dIntersectionPoint=h.position;this._initial3dIntersectionPointTranslated=new d.Vector3().copy(this._initial3dIntersectionPoint);this._initial3dIntersectionPointTranslated.add(h.normal)},Manipulate:function(m,l,e){this._parent(m,l,e);var h=new d.Vector2().copy(l.from[0].getCurrentPosition(this.viewer.canvas));h.x=(2*h.x-this.viewer.canvas.width)/this.viewer.canvas.width;h.y=-(2*h.y-this.viewer.canvas.height)/this.viewer.canvas.height;var g=new d.Vector3(h.x,h.y,1);this.projector.unprojectVector(g,this.viewer.currentViewpoint.camera);var k=new d.Ray(this.viewer.currentViewpoint.camera.position,g.sub(this.viewer.currentViewpoint.camera.position).normalize());var j=k.computeShortestPointToLine(this._initial3dIntersectionPoint,this._initial3dIntersectionPointTranslated);var f=new d.Vector3().subVectors(j,this._initial3dIntersectionPoint);var i={eventChannel:"Manipulate",paths:this.manipulatedPaths,translationVector:f,intersection:e};this.publish("Manipulate",i)},EndManipulate:function(g,e,h){var f={eventChannel:"EndManipulate",paths:this.manipulatedPaths,intersection:h};this.publish("EndManipulate",f);this._parent(g,e,h)},BeginPreactivate:function(f,e,h){var g={eventChannel:"BeginPreactivate",preactivated:this.preactivated,intersection:h};this.publish("BeginPreactivate",g)},Preactivate:function(f,e,h){var g={eventChannel:"Preactivate",preactivated:this.preactivated,intersection:h};this.publish("Preactivate",g)},EndPreactivate:function(f,e,h){var g={eventChannel:"EndPreactivate",preactivated:this.preactivated,intersection:h};this.publish("EndPreactivate",g)}});return UWA.namespace("DS/ENOWebNavVolumeQuery/ENOWebNavShapeManipulator",b)});define("DS/ENOWebNavVolumeQuery/ENOWebNavVolumeQueryInternalCmd",["UWA/Core","DS/Core/Core","DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/PADUtils/PADContext"],function(f,d,b,c,e){var a=b.extend({init:function(g){f.log("ENOWebNavVolumeQueryInternalCmd: init");this._parent(g,{mode:"shared",isAsynchronous:true});this.setRepeatMode(false)},beginExecute:function(){f.log("ENOWebNavVolumeQueryInternalCmd: BeginExecute");var j=this;var h=c._getCurrent(this.options.context);var g=e.get().getCommandContext();var i=c.getCommand("VolumeQueryHdr",g);if(h=="ApplyVolumeQueryHdr"){i.applyVolumeQuery()}else{if(h=="CancelVolumeQueryHdr"){setTimeout(function(){i.displayNotification("cancel");i.end()})}else{if(h=="BoxQueryHdr"){i.switchVolumeQueryShape("Box")}else{if(h=="SphereQueryHdr"){i.switchVolumeQueryShape("Sphere")}else{if(h=="ProximityQueryHdr"){i.switchVolumeQueryShape("Proximity")}else{if(h=="VolumeQueryFullInHdr"){i.switchVolumeQueryInOutRule("FullIn")}else{if(h=="VolumeQueryPartlyInHdr"){i.switchVolumeQueryInOutRule("PartlyIn")}else{if(h=="VolumeQueryFullOutHdr"){i.switchVolumeQueryInOutRule("FullOut")}else{if(h=="VolumeQueryPartlyOutHdr"){i.switchVolumeQueryInOutRule("PartlyOut")}else{if(h=="FilteringModeHdr"){i.switchFilteringMode(true)}else{if(h=="SelectionModeHdr"){i.switchFilteringMode(false)}}}}}}}}}}}j.end()},endExecute:function(){f.log("ENOWebNavVolumeQueryInternalCmd: endExecute")}});return f.namespace("DS/ENOWebNavVolumeQuery/ENOWebNavVolumeQueryInternalCmd",a)});define("DS/ENOWebNavVolumeQuery/ENOWebNavBoxHandle",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement","DS/Core/Events","DS/VisuEvents/EventsManager","DS/Visualization/GeometryHelper","DS/Visualization/Node3D","DS/Manipulators/LineTranslationManipulator","DS/Core/ModelEvents","DS/Mesh/MeshUtils","DS/Selection/HSOManager","DS/ENOWebNavVolumeQuery/ENOWebNavHandleArrow","DS/Ruler/Ruler","DS/ENOWebNavVolumeQuery/ENOWebNavVolumeQueryRobot","DS/Selection/CSOManager","DS/Manipulators/ScreenPlaneManipulator","DS/Visualization/SceneGraphFactory","DS/PADUtils/PADContext"],function(e,r,c,u,q,n,l,p,i,g,j,f,h,b,o,m,s,a,d,k){var t=r.extend({init:function(z,y,v){this._fstAxis=z.fstAxis;this._sndAxis=z.sndAxis;this._thdAxis=z.thdAxis;this._cornerPoint=z.cornerPoint;this._matrix=v;this.isModifiedByUser=false;this._context=k.get();this._boxUpdate=true;this._viewer=y.getViewer();this._sceneGraph=new i("VolumeRoot");this._sceneGraph.setVisibilityFree(true);this._context.getDecorationBag().add(this._sceneGraph);this._faceNodes=new Array(6);this._token=new Array(6);this._faceNodeBag=new i("BoxVolumeSelector");this._sceneGraph.add(this._faceNodeBag);this._manips=new Array(6);this._overManager=null;this._geomHelper=new p();this._previousTranslate=null;this._modelEvent=new j();var x=this;this._robot=new m({window:y,viewer:x._viewer,sceneGraph:x._sceneGraph,target:x._faceNodeBag});this._tokenRobotRuler=this._robot._ruler.subscribe("RulerManipulate",function(A){x.updateBoxFromRobotRulerValue(A)});this._robotToken=new Array(13);this._savedCornerPoint=new u.Vector3();this._savedFstAxis=new u.Vector3();this._savedSndAxis=new u.Vector3();this._savedThdAxis=new u.Vector3();this._rotationCenter=new u.Vector3();this._preactivatedFaceId=-1;this._preactivatedFace=new i("preactivatedFace");this._sceneGraph.addChild(this._preactivatedFace);var w=60;this._arrow=new b({name:"arrowBoxHandle",sceneGraph:this._sceneGraph,width:w,viewer:this._viewer});this._sceneGraph.addChild(this._arrow);this._arrow.setVisibility(false);this._whileManipulation=false;this._arrowInverted=false;this._manipulatedFace=0;this._ruler=new o(y,{displayOrigin:true,hideDuringLocalTransfo:true,startPoint:0,startValue:0});this._tokenLocalRuler=this._ruler.subscribe("RulerManipulate",function(A){x.updateBoxFromRulerValue(A)})},getBag:function(){return this._faceNodeBag},updateBoxFromRulerValue:function(B){var A=null;var G=this.getFaceNormal(this._manipulatedFace);if(this.colinear(G,this._fstAxis)){A=this._fstAxis}else{if(this.colinear(G,this._sndAxis)){A=this._sndAxis}else{if(this.colinear(G,this._thdAxis)){A=this._thdAxis}}}var y=B.value;var v=new u.Vector3().copy(A);var E=A.length();if(y<0){this._ruler.value=E;this._ruler.refresh();return}var w=y-E;if(w<0){w=(-1)*w;v.setLength(w).multiplyScalar(-1)}else{v.setLength(w)}this._previousTranslate.add(v);if(0==this._manipulatedFace){var z=new u.Vector3().copy(this._thdAxis).add(v);if(0==z.length()){return}this._thdAxis.copy(z)}else{if(1==this._manipulatedFace){var z=new u.Vector3().copy(this._fstAxis).add(v);if(0==z.length()){return}this._fstAxis.copy(z)}else{if(2==this._manipulatedFace){var z=new u.Vector3().copy(this._sndAxis).add(v);if(0==z.length()){return}this._sndAxis.copy(z)}else{if(3==this._manipulatedFace){var z=new u.Vector3().copy(this._fstAxis).add(v);if(0==z.length()){return}this._fstAxis.copy(z)}else{if(4==this._manipulatedFace){var z=new u.Vector3().copy(this._sndAxis).add(v);if(0==z.length()){return}this._sndAxis.copy(z)}else{if(5==this._manipulatedFace){var z=new u.Vector3().copy(this._thdAxis).add(v);if(0==z.length()){return}this._thdAxis.copy(z)}}}}}}if(0==this._manipulatedFace||1==this._manipulatedFace||2==this._manipulatedFace){this._cornerPoint.sub(v)}this.refreshAfterManipulation();var D=new u.Vector3().copy(this._fstAxis).multiplyScalar(0.5);var F=new u.Vector3().copy(this._sndAxis).multiplyScalar(0.5);var x=new u.Vector3().copy(this._thdAxis).multiplyScalar(0.5);var C=new u.Vector3().copy(this._cornerPoint);C.add(D);C.add(F);C.add(x);this._matrix.setPosition(C);this._robot.updateRobotFromMatrix(this._matrix);this._viewer.render();this._boxUpdate=false;this.publish("EndBoxChanged")},getParams:function(){var v=new u.Matrix4().copy(this._matrix).setPosition(this._cornerPoint);var w=this._faceNodeBag.getBoundingBox();return{cornerPoint:this._cornerPoint,fstAxis:this._fstAxis,sndAxis:this._sndAxis,thdAxis:this._thdAxis,box:w,matrix:v}},colinear:function(x,w){var z=new u.Vector3().copy(x);var y=new u.Vector3().copy(w);var v=z.cross(y).length();if(Math.round(v*100)==0){return true}return false},display:function(){if(this.colinear(this._fstAxis,this._sndAxis)||this.colinear(this._fstAxis,this._thdAxis)||this.colinear(this._sndAxis,this._thdAxis)){console.warn("Some axis are colinear. Box cannot be created.");return}for(var v=0;v<6;v++){this.createFaceAndEdge(v,9689341,6543615)}this._robot.setVisibility(true);var x=new q();x.setFromArray([this._sceneGraph,this._faceNodeBag]);this._robot.setTarget(x);this._robot.updateRobotFromMatrix(this._matrix);this._viewer.render();var w=this;this._robotToken[0]=this._robot._robot.subscribe("LineTranslationBegin",function(y){w.BeginRobotManipulationCB(y)});this._robotToken[1]=this._robot._robot.subscribe("RotationBegin",function(y){w.BeginRobotManipulationCB(y)});this._robotToken[2]=this._robot._robot.subscribe("PlaneTranslationBegin",function(y){w.BeginRobotManipulationCB(y)});this._robotToken[3]=this._robot._robot.subscribe("ScalingBegin",function(y){w.BeginRobotManipulationCB(y)});this._robotToken[4]=this._robot._robot.subscribe("LineTranslationManipulation",function(y){w.RobotTranslationManipulationCB(y)});this._robotToken[5]=this._robot._robot.subscribe("RotationManipulation",function(y){w.RobotRotationManipulationCB(y)});this._robotToken[6]=this._robot._robot.subscribe("PlaneTranslationManipulation",function(y){w.RobotTranslationManipulationCB(y)});this._robotToken[7]=this._robot._robot.subscribe("ScalingManipulation",function(y){w.RobotScalingManipulationCB(y)});this._robotToken[8]=this._robot._robot.subscribe("LineTranslationEnd",function(y){w.RobotEndTranslationManipulationCB(y)});this._robotToken[9]=this._robot._robot.subscribe("RotationEnd",function(y){w.RobotRotationEndCB(y)});this._robotToken[10]=this._robot._robot.subscribe("PlaneTranslationEnd",function(y){w.RobotEndTranslationManipulationCB(y)});this._robotToken[11]=this._robot._robot.subscribe("ScalingEnd",function(y){w.RobotEndScalingManipulationCB(y)})},BeginRobotManipulationCB:function(v){this._savedCornerPoint.copy(this._cornerPoint);this._savedFstAxis.copy(this._fstAxis);this._savedSndAxis.copy(this._sndAxis);this._savedThdAxis.copy(this._thdAxis);this._preactivatedFace.removeChildren();this._whileManipulation=true;this._ruler.setVisibleFlag(false);this._ruler.clear()},RobotTranslationManipulationCB:function(v){this._cornerPoint.copy(this._savedCornerPoint);this._cornerPoint.add(v.translationVector)},RobotRotationManipulationCB:function(v){this._cornerPoint.copy(this._savedCornerPoint);this._fstAxis.copy(this._savedFstAxis);this._sndAxis.copy(this._savedSndAxis);this._thdAxis.copy(this._savedThdAxis);this._cornerPoint.applyMatrix4(v.rotationMatrix);this._fstAxis.applyMatrix4(v.rotationMatrix);this._sndAxis.applyMatrix4(v.rotationMatrix);this._thdAxis.applyMatrix4(v.rotationMatrix);this._rotationCenter.copy(v.rotationCenter)},RobotRotationEndCB:function(z){var x=new u.Vector3().copy(this._fstAxis).multiplyScalar(0.5);var w=new u.Vector3().copy(this._sndAxis).multiplyScalar(0.5);var y=new u.Vector3().copy(this._thdAxis).multiplyScalar(0.5);var v=new u.Vector3().copy(this._cornerPoint);v.add(x);v.add(w);v.add(y);var A=new u.Vector3().copy(v).sub(this._rotationCenter);this._cornerPoint.sub(A);this.refreshAfterManipulation();this.publish("EndBoxChanged")},RobotScalingManipulationCB:function(y){this._fstAxis.copy(this._savedFstAxis);this._sndAxis.copy(this._savedSndAxis);this._thdAxis.copy(this._savedThdAxis);this._cornerPoint.copy(y.scalingCenter);this._fstAxis.multiplyScalar(y.scalingFactor);this._sndAxis.multiplyScalar(y.scalingFactor);this._thdAxis.multiplyScalar(y.scalingFactor);var w=new u.Vector3().copy(this._fstAxis).multiplyScalar(0.5);var v=new u.Vector3().copy(this._sndAxis).multiplyScalar(0.5);var x=new u.Vector3().copy(this._thdAxis).multiplyScalar(0.5);this._cornerPoint.sub(w);this._cornerPoint.sub(v);this._cornerPoint.sub(x)},RobotEndScalingManipulationCB:function(v){this.refreshAfterManipulation();this.publish("EndBoxChanged")},RobotEndTranslationManipulationCB:function(v){this.refreshAfterManipulation();this.publish("EndBoxChanged")},createFaceAndEdge:function(w,C,v){if(this._faceNodes[w]){this._faceNodes[w].removeChildren()}var B=null,x=null,D=null;switch(w){case 0:B=this._cornerPoint;x=this._sndAxis;D=this._fstAxis;break;case 1:B=this._cornerPoint;x=this._thdAxis;D=this._sndAxis;break;case 2:B=this._cornerPoint;x=this._fstAxis;D=this._thdAxis;break;case 3:B=new u.Vector3().copy(this._cornerPoint).add(this._fstAxis);x=this._sndAxis;D=this._thdAxis;break;case 4:B=new u.Vector3().copy(this._cornerPoint).add(this._sndAxis);x=this._thdAxis;D=this._fstAxis;break;case 5:B=new u.Vector3().copy(this._cornerPoint).add(this._thdAxis);x=this._fstAxis;D=this._sndAxis;break}var z=this.createRectangle(B,x,D,C,v);var A=d.createMeshNode(z);A.excludeFromCSO(true);A.excludeFromHighlight(true);A.setSSAO(false);A.setShadow(false,false);if(!this._faceNodes[w]){this._faceNodes[w]=new i("Face"+w);this._faceNodeBag.add(this._faceNodes[w])}this._faceNodes[w].add(A);if(this._manips[w]){this._manips[w].unlink(this._token[w])}this._manips[w]=null;if(!this._manips[w]){this._manips[w]=this.createManip(w,new u.Vector3().copy(x).cross(D).normalize());this._token[w]=this._manips[w].linkToNode(this._faceNodes[w])}var y=this;this._overManager=this.createManip(-1,new u.Vector3())},refreshAfterManipulation:function(){this._matrix.copy(this._robot._robot.getMatrix());this._preactivatedFace.removeChildren();this._whileManipulation=false;for(var v=0;v<6;v++){if(this._manips[v]){this._manips[v].unlink(this._token[v])}this._manips[v]=null;if(this._faceNodes[v]){this._faceNodes[v].removeChildren()}this._faceNodes[v]=null}if(this._faceNodeBag){this._faceNodeBag.removeChildren();this._sceneGraph.remove(this._faceNodeBag)}this._faceNodes=new Array(6);this._faceNodeBag=new i("BoxVolumeSelector");this._sceneGraph.addChild(this._faceNodeBag);this._manips=new Array(6);for(var v=0;v<6;v++){this.createFaceAndEdge(v,9689341,6543615)}var w=new q();w.setFromArray([this._sceneGraph,this._faceNodeBag]);this._robot.setTarget(w);this._robot.updateRobotFromMatrix(this._matrix);this._viewer.render()},createRectangle:function(z,E,w,N,x){var H,F,B,v,D,M,K,J,L,A,C,G,I;H=new f.PrimitiveGroup();H.fillAttr=new f.FillAttributes();H.lineAttr=new f.LineAttributes();H.pointAttr=new f.PointAttributes();F=new f.Buffer();F.size=12;F.component=f.VertexComponentEnum.POSITION;F.format=f.DataTypeEnum.FLOAT;F.dimension=3;F.data=new Float32Array(12);v=new f.Buffer();v.indexBuffer=true;v.size=9;v.format=f.DataTypeEnum.UINT;v.dimension=1;v.data=new Uint16Array(9);B=new f.Buffer();B.size=3;B.component=f.VertexComponentEnum.NORMAL;B.format=f.DataTypeEnum.FLOAT;B.dimension=3;B.data=new Float32Array(3);D=new f.Buffer();D.indexBuffer=true;D.size=4;D.format=f.DataTypeEnum.UINT;D.dimension=1;D.data=new Uint16Array(4);H.addBuffer(0,F);H.addBuffer(1,v);H.addBuffer(2,B);H.addBuffer(3,D);M=F.data;K=0;M[K++]=z.x;M[K++]=z.y;M[K++]=z.z;I=new u.Vector3().copy(z).add(E);M[K++]=I.x;M[K++]=I.y;M[K++]=I.z;I=new u.Vector3().copy(z).add(E).add(w);M[K++]=I.x;M[K++]=I.y;M[K++]=I.z;I=new u.Vector3().copy(z).add(w);M[K++]=I.x;M[K++]=I.y;M[K++]=I.z;M=v.data;M[0]=0;M[1]=1;M[2]=3;M[3]=2;M=B.data;M[0]=0;M[1]=0;M[2]=1;M=D.data;M[0]=0;M[1]=0;M[2]=0;M[3]=0;A=new f.Primitive();A.nbIndices=4;A.connectivity=f.ConnectivityTypeEnum.TRIANGLE_STRIP;A.material=new u.MeshBasicMaterial({side:u.DoubleSide,color:N,opacity:0.5,transparent:true});C=new f.VertexComponent();C.component=f.VertexComponentEnum.POSITION;C.nbVertices=4;C.nbValuesPerVertex=3;C.format=f.DataTypeEnum.FLOAT;C.cardinality=0;C.bufferId=0;C.indices=new f.IndexArray();C.indices.format=f.DataTypeEnum.UINT;C.indices.bufferId=1;C.indices.offset=0;A.addVertexComponent(C);G=new f.VertexComponent();G.component=f.VertexComponentEnum.NORMAL;G.nbVertices=4;G.nbValuesPerVertex=3;G.format=f.DataTypeEnum.FLOAT;G.cardinality=0;G.bufferId=2;G.indices=new f.IndexArray();G.indices.format=f.DataTypeEnum.UINT;G.indices.bufferId=3;G.indices.offset=0;A.addVertexComponent(G);H.addPrimitive(A);M=v.data;K=4;M[K++]=0;M[K++]=1;M[K++]=2;M[K++]=3;M[K++]=0;var y=new f.Primitive();y.nbIndices=4;y.connectivity=f.ConnectivityTypeEnum.LINE_STRIP;y.attr={fill:new f.FillAttributes(),line:new f.LineAttributes(new f.Color(x)),point:new f.PointAttributes()};C=new f.VertexComponent();C.component=f.VertexComponentEnum.POSITION;C.nbVertices=5;C.nbValuesPerVertex=3;C.format=f.DataTypeEnum.FLOAT;C.cardinality=0;C.bufferId=0;C.indices=new f.IndexArray();C.indices.format=f.DataTypeEnum.UINT;C.indices.bufferId=1;C.indices.offset=4;y.addVertexComponent(C);H.addPrimitive(y);H.noz=false;return H},createManip:function(x,v){var y=this;var w=new g({axis:new u.Vector3().copy(v)});w.setExclusive(true);if(x>=0){w.subscribe("BeginManipulate",function(z){y.beginManipulateCB(x,z)});w.subscribe("Manipulate",function(z){y.manipulateCB(x,z)});w.subscribe("EndManipulate",function(z){y.endManipulateCB(x,z)});w.subscribe("BeginPreactivate",function(z){y.beginPreactivateCB(x,z)});w.subscribe("Preactivate",function(z){y.PreactivateCB(x,z)});w.subscribe("EndPreactivate",function(z){y.endPreactivateCB(x,z)})}return w},getFaceNormal:function(x){var v=null,w=null;switch(x){case 0:v=new u.Vector3().copy(this._sndAxis);w=new u.Vector3().copy(this._fstAxis);break;case 1:v=new u.Vector3().copy(this._thdAxis);w=new u.Vector3().copy(this._sndAxis);break;case 2:v=new u.Vector3().copy(this._fstAxis);w=new u.Vector3().copy(this._thdAxis);break;case 3:v=new u.Vector3().copy(this._sndAxis);w=new u.Vector3().copy(this._thdAxis);break;case 4:v=new u.Vector3().copy(this._thdAxis);w=new u.Vector3().copy(this._fstAxis);break;case 5:v=new u.Vector3().copy(this._fstAxis);w=new u.Vector3().copy(this._sndAxis);break}return new u.Vector3().copy(w).cross(v).normalize()},positionArrow:function(F,x){var E=null,y=null,G=null;switch(F){case 0:E=new u.Vector3().copy(this._cornerPoint);y=new u.Vector3().copy(this._sndAxis);G=new u.Vector3().copy(this._fstAxis);break;case 1:E=new u.Vector3().copy(this._cornerPoint);y=new u.Vector3().copy(this._thdAxis);G=new u.Vector3().copy(this._sndAxis);break;case 2:E=new u.Vector3().copy(this._cornerPoint);y=new u.Vector3().copy(this._fstAxis);G=new u.Vector3().copy(this._thdAxis);break;case 3:E=new u.Vector3().copy(this._cornerPoint).add(this._fstAxis);y=new u.Vector3().copy(this._sndAxis);G=new u.Vector3().copy(this._thdAxis);break;case 4:E=new u.Vector3().copy(this._cornerPoint).add(this._sndAxis);y=new u.Vector3().copy(this._thdAxis);G=new u.Vector3().copy(this._fstAxis);break;case 5:E=new u.Vector3().copy(this._cornerPoint).add(this._thdAxis);y=new u.Vector3().copy(this._fstAxis);G=new u.Vector3().copy(this._sndAxis);break}var w=this._arrow._width;var I=this._arrow.getScaledHeight();var D=y.length();if(G.length()>D){D=G.length()}var B=new u.Vector3().copy(y).setLength((y.length())/2);var z=new u.Vector3().copy(G).setLength(G.length()/2);E.add(B).add(z);var A=new u.Vector3().copy(G).cross(y).normalize();var C=new u.Matrix4();y.normalize();G.normalize();var v=C.elements;if(x){A.applyAxisAngle(y,Math.PI);var H=new u.Vector3().copy(A).setLength(I)}v[0]=y.x;v[1]=y.y;v[2]=y.z;v[4]=G.x;v[5]=G.y;v[6]=G.z;v[8]=A.x;v[9]=A.y;v[10]=A.z;C.setPosition(E);this._arrow.setMatrix(C);this._arrowInverted=x},beginManipulateCB:function(C,x){this._previousTranslate=new u.Vector3(0,0,0);this.positionArrow(C);this._arrow.setVisibility(true);this._preactivatedFace.removeChildren();this._whileManipulation=true;this.isModifiedByUser=true;this._ruler.clear();var B=new u.Vector3().getPositionFromMatrix(this._matrix);var y=this.getFaceNormal(C);var A=null;if(this.colinear(y,this._fstAxis)){A=this._fstAxis}else{if(this.colinear(y,this._sndAxis)){A=this._sndAxis}else{if(this.colinear(y,this._thdAxis)){A=this._thdAxis}}}var w=null,v=null;switch(C){case 0:w=new u.Vector3().copy(this._cornerPoint);v=this._fstAxis;break;case 1:w=new u.Vector3().copy(this._cornerPoint);v=this._sndAxis;break;case 2:w=new u.Vector3().copy(this._cornerPoint).sub(this._thdAxis);v=this._thdAxis;break;case 3:w=new u.Vector3().copy(this._cornerPoint).add(this._fstAxis).sub(this._thdAxis);v=this._thdAxis;break;case 4:w=new u.Vector3().copy(this._cornerPoint).add(this._sndAxis);v=this._fstAxis;break;case 5:w=new u.Vector3().copy(this._cornerPoint).add(this._thdAxis);v=this._sndAxis;break}var z=new u.Vector3().copy(y).setLength(A.length()).add(new u.Vector3().copy(v).setLength(v.length()));this._ruler.origin=new u.Vector3().copy(w).add(z);this._ruler.initValue=A.length();this._ruler.value=this._ruler.initValue;this._ruler.direction=y.multiplyScalar(-1);this._ruler.setVisibleFlag(true);this._ruler.display();this._ruler.beginManipulation();this._robot.setVisibility(false);this._viewer.render()},manipulateCB:function(J,D){if(J<0||J>5){console.warn("Invalid callback index.");return}var C=this._ruler.getSnappedTranslationVector(D);if(C.returnCode!==0){return null}var y=this._ruler.getSnappedTranslationVector(D).snappedTranslationVector;var v=new u.Vector3().copy(y).sub(this._previousTranslate);var x=v.dot(this.getFaceNormal(J));var w=this._ruler.value+v.length()*(x<0?1:-1);if(w<=0){return}this._previousTranslate.add(v);if(0==J){var A=new u.Vector3().copy(this._thdAxis).sub(v);if(0==A.length()){return}this._thdAxis.copy(A)}else{if(1==J){var A=new u.Vector3().copy(this._fstAxis).sub(v);if(0==A.length()){return}this._fstAxis.copy(A)}else{if(2==J){var A=new u.Vector3().copy(this._sndAxis).sub(v);if(0==A.length()){return}this._sndAxis.copy(A)}else{if(3==J){var A=new u.Vector3().copy(this._fstAxis).add(v);if(0==A.length()){return}this._fstAxis.copy(A)}else{if(4==J){var A=new u.Vector3().copy(this._sndAxis).add(v);if(0==A.length()){return}this._sndAxis.copy(A)}else{if(5==J){var A=new u.Vector3().copy(this._thdAxis).add(v);if(0==A.length()){return}this._thdAxis.copy(A)}}}}}}if(0==J||1==J||2==J){this._cornerPoint.add(v)}var I;if(D.paths!==undefined&&D.paths.length===1){I=D.paths[0].getMatrix()}else{I=new u.Matrix4()}var H=new u.Vector3().getPositionFromMatrix(I).add(v);I.setPosition(H);D.paths[0].getLastElement(true).setMatrix(I);this.refresh(J);if(x>0&&!this._arrowInverted){this.positionArrow(J,true)}else{if(x<0&&this._arrowInverted){this.positionArrow(J,false)}}var B=new u.Vector3().getPositionFromMatrix(this._arrow.getMatrix()).add(v);var K=new u.Matrix4().copy(this._arrow.getMatrix()).setPosition(B);this._arrow.setMatrix(K);this._viewer.render();this._ruler.value+=v.length()*(x<0?1:-1);this._ruler.refresh();var F=new u.Vector3().copy(this._fstAxis).multiplyScalar(0.5);var G=new u.Vector3().copy(this._sndAxis).multiplyScalar(0.5);var z=new u.Vector3().copy(this._thdAxis).multiplyScalar(0.5);var E=new u.Vector3().copy(this._cornerPoint);E.add(F);E.add(G);E.add(z);this._matrix.setPosition(E);this._robot.updateRobotFromMatrix(this._matrix);this.publish("BoxChanged")},endManipulateCB:function(w,v){if(this._arrow){this._arrow.setVisibility(false)}this._ruler.snapping=false;this._ruler.endManipulation();this._ruler.display();this._robot.setVisibility(true);this._whileManipulation=false;this._viewer.render();this._manipulatedFace=w;this.publish("EndBoxChanged")},beginPreactivateCB:function(B,w){if(this._whileManipulation){return true}var C=null,v=null,D=null;switch(B){case 0:C=this._cornerPoint;v=this._sndAxis;D=this._fstAxis;break;case 1:C=this._cornerPoint;v=this._thdAxis;D=this._sndAxis;break;case 2:C=this._cornerPoint;v=this._fstAxis;D=this._thdAxis;break;case 3:C=new u.Vector3().copy(this._cornerPoint).add(this._fstAxis);v=this._sndAxis;D=this._thdAxis;break;case 4:C=new u.Vector3().copy(this._cornerPoint).add(this._sndAxis);v=this._thdAxis;D=this._fstAxis;break;case 5:C=new u.Vector3().copy(this._cornerPoint).add(this._thdAxis);v=this._fstAxis;D=this._sndAxis;break}var x=new u.Vector3().copy(v);x.cross(D);x.normalize();x.setLength(0.05);var y=new u.Vector3().copy(C).sub(x);var z=this.createRectangle(y,v,D,9689341,6543615);var A=d.createMeshNode(z);A.excludeFromCSO(true);A.excludeFromHighlight(true);A.setSSAO(false);A.setShadow(false,false);this._preactivatedFace.removeChildren();this._preactivatedFace.add(A);this._preactivatedFaceId=B;this.positionArrow(B);this._arrow.setVisibility(true);this._viewer.render();this.publish("onPreactivate");return true},PreactivateCB:function(w,v){if(this._whileManipulation){return true}},endPreactivateCB:function(w,v){if(this._whileManipulation){return true}this._arrow.setVisibility(false);this._preactivatedFace.removeChildren();this._preactivatedFaceId=-1;this._viewer.render();this.publish("onEndPreactivate");return true},refresh:function(v){for(var w=0;w<6;w++){if(w!=v){this.createFaceAndEdge(w,9689341,6543615)}}},clean:function(){for(var v=0;v<6;v++){if(this._manips[v]){this._manips[v].unlink(this._token[v])}this._manips[v]=null;if(this._faceNodes[v]){this._faceNodes[v].removeChildren()}this._faceNodes[v]=null}if(this._faceNodeBag){this._faceNodeBag.removeChildren();this._sceneGraph.remove(this._faceNodeBag)}if(this._preactivatedFace){this._preactivatedFace.removeChildren();this._sceneGraph.remove(this._preactivatedFace)}if(this._arrow){this._sceneGraph.remove(this._arrow)}this._context.getDecorationBag().remove(this._sceneGraph);this._arrow=null;this._preactivatedFace=null;this._preactivatedFaceId=-1;this._faceNodeBag=null;this._sceneGraph.remove(this._robot._robot);this._robot.setVisibility(false);this._robot._ruler.setVisibleFlag(false);this._robot._ruler.clear();this._ruler.setVisibleFlag(false);this._ruler.clear();var w=this;this._robotToken.forEach(function(x){w._robot._robot.unsubscribe(x)});w._robot._ruler.unsubscribe(this._tokenRobotRuler);w._ruler.unsubscribe(this._tokenLocalRuler);this._viewer.render();delete this._robot;delete this._ruler;delete this._faceNodes;delete this._token;delete this._faceNodeBag;delete this._manips;delete this._geomHelper;delete this._modelEvent;delete this._tokenRobotRuler;delete this._robotToken;delete this._savedCornerPoint;delete this._savedFstAxis;delete this._savedSndAxis;delete this._savedThdAxis;delete this._rotationCenter;delete this._preactivatedFace;delete this._arrow},subscribe:function(v,w){return this._modelEvent.subscribe({event:v},w)},unsubscribe:function(v){this._modelEvent.unsubscribe(v)},publish:function(v){return this._modelEvent.publish({event:v,context:this})}});return t});define("DS/ENOWebNavVolumeQuery/ENOWebNavProximityHandle",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/Core/Events","DS/Visualization/GeometryHelper","DS/Visualization/Node3D","DS/Core/ModelEvents","DS/ENOWebNavVolumeQuery/ENOWebNavShapeManipulator","DS/ENOWebNavVolumeQuery/ENOWebNavHandleArrow","DS/Ruler/Ruler","DS/Visualization/Mesh3D","DS/Visualization/SceneGraphFactory","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADContext"],function(g,a,n,d,p,i,c,l,h,m,o,k,e,b,j){var f=a.extend({init:function(q){this._offset=0;this._node3D=q.node;this._matrix=q.matrix;this._window=q.window;this._initPath=q.initPath;this._viewer=this._window.getViewer();this._sceneGraph=new i("VolumeRoot");this._sceneGraph.setVisibilityFree(true);this._context=j.get();this._context.getDecorationBag().add(this._sceneGraph);this._geomHelper=new p();this._topCircleBag=new i("TopCircleBag");this._sceneGraph.addChild(this._topCircleBag);this._dashedLinesBag=new i("DashedLinesBag");this._sceneGraph.addChild(this._dashedLinesBag);this._bottomCircleBag=new i("BottomCircleBag");this._sceneGraph.addChild(this._bottomCircleBag);this._modelEvent=new c();this._manips=null;this._token=0;var r=60;this._arrow=new h({name:"arrowBoxHandle",sceneGraph:this._sceneGraph,width:r,viewer:this._viewer});this._sceneGraph.addChild(this._arrow);this._arrow.setVisibility(false);this._normalVector=null;this._intersectionPosition=null;this._topDiskNode=null;this._previousTranslate=null;this._manipulatorCreated=false;var t=this;this._ruler=new m(this._window,{displayOrigin:true,hideDuringLocalTransfo:true});this._tokenLocalRuler=this._ruler.subscribe("RulerManipulate",function(u){t.updateProximityHandleFromRulerValue(u)});var s=this},getParams:function(){return{offset:this._offset,node:this._node3D}},updateProximityHandleFromRulerValue:function(u){var s=u.value;if(s<0){this._ruler.value=this._previousTranslate.length();this._ruler.refresh();return}var r=new n.Vector3();if(this._previousTranslate){if(this._offset>s){r.copy(this._previousTranslate).setLength(this._offset-s).multiplyScalar(-1)}else{r.copy(this._previousTranslate).setLength(s-this._offset)}var q=r.dot(this._normalVector);this._previousTranslate.add(r);this._offset=s;var t=new n.Vector3().copy(this._normalVector).setLength(this._offset);var v=new n.Vector3().copy(this._intersectionPosition).add(t);if(q>0){this.positionArrow(this._normalVector,v,false)}else{this.positionArrow(this._normalVector,v,true)}this.updateLine(this._intersectionPosition,this._normalVector,this._offset);this.updateGeometryPosition(this._normalVector,v);this.publish("EndBoxChanged");this._viewer.render()}else{this._offset=s}},display:function(){this._manip=this.createManip();this._manip.setExclusive(true);this._token=this._manip.linkToNode(this._initPath);this._viewer.render();this._whileManipulation=false},createProximityBottomCircle:function(v,y){if(this._bottomCircleBag){this._bottomCircleBag.removeChildren()}var B=this.retrievePositionMatrix(v,y);var A=this._node3D.getBoundingSphere().clone();var w=this._geomHelper.createCircle({radius:A.radius/4,segments:32,fill:true});var E=new n.MeshBasicMaterial({side:n.DoubleSide,color:9689341,opacity:0.5,transparent:true});E.force=true;var x=k.createMeshNode(w,E);x.excludeFromCSO(true);x.excludeFromHighlight(true);x.setSSAO(false);x.setShadow(false,false);var s=new i("BottomDiskNode");s.addChild(x);s.setMatrix(B);this._bottomCircleBag.addChild(s);var t=new n.Vector3(1,0,0).cross(v).setLength(A.radius/10);var u=new n.Vector3().copy(y).add(t);var z=new n.Vector3().copy(y).sub(t);var D=[u,z];var q=this._geomHelper.createLine({points:D});E=new n.MeshBasicMaterial({color:0});E.force=true;var C=k.createMeshNode(q,E);C.excludeFromCSO(true);C.excludeFromHighlight(true);C.setSSAO(false);C.setShadow(false,false);this._bottomCircleBag.addChild(C);var r=new n.Vector3().copy(t).cross(v).setLength(A.radius/10);u=new n.Vector3().copy(y).add(r);z=new n.Vector3().copy(y).sub(r);D=[u,z];q=this._geomHelper.createLine({points:D});E=new n.MeshBasicMaterial({color:0});E.force=true;C=k.createMeshNode(q,E);C.excludeFromCSO(true);C.excludeFromHighlight(true);C.setSSAO(false);C.setShadow(false,false);this._bottomCircleBag.addChild(C)},createProximityTopCircle:function(){if(this._topCircleBag){this._topCircleBag.removeChildren()}var s=this._node3D.getBoundingSphere().clone();var q=this._geomHelper.createCircle({radius:s.radius/2,segments:32,fill:true});var r=new n.MeshBasicMaterial({side:n.DoubleSide,color:9689341,opacity:0.5,transparent:true});r.force=true;var t=k.createMeshNode(q,r);t.excludeFromCSO(true);t.excludeFromHighlight(true);t.setSSAO(false);t.setShadow(false,false);this._topDiskNode=new i("TopDiskNode");this._topDiskNode.addChild(t);this._topCircleBag.addChild(this._topDiskNode);this._manipulatorCreated=true},colinear:function(s,r){var u=new n.Vector3().copy(s);var t=new n.Vector3().copy(r);var q=u.cross(t).length();if(Math.round(q*100)===0){return true}return false},retrievePositionMatrix:function(x,w){var v=new n.Vector3(1,0,0).cross(x).normalize();if(this.colinear(new n.Vector3(1,0,0),v)){v=new n.Vector3(0,1,0).cross(x).normalize()}var t=new n.Vector3().copy(x);var u=new n.Vector3().copy(v).cross(t).normalize();t.applyAxisAngle(u,Math.PI);var s=new n.Matrix4();var q=new n.Vector3().copy(w);var r=s.elements;r[0]=v.x;r[1]=v.y;r[2]=v.z;r[4]=u.x;r[5]=u.y;r[6]=u.z;r[8]=t.x;r[9]=t.y;r[10]=t.z;s.setPosition(q);return s},updateGeometryPosition:function(s,r){var q=this.retrievePositionMatrix(s,r);this._topDiskNode.setMatrix(q)},updateLine:function(u,t,s){if(this._dashedLinesBag){this._dashedLinesBag.removeChildren()}var y=new n.Vector3().copy(u);var q=new n.Vector3().copy(t).setLength(s);var x=new n.Vector3().copy(y).add(q);var w=[y,x];var r=this._geomHelper.createLine({points:w});var z=new n.LineBasicMaterial({color:"black",dashSize:7,gapSize:4});z.depthTest=false;z.force=true;var v=k.createMeshNode(r,z);this._dashedLinesBag.addChild(v);v.excludeFromCSO(true);v.excludeFromHighlight(true);v.setSSAO(false);v.setShadow(false,false)},createManip:function(){var r=this;var q=new l(this._viewer);q.subscribe("BeginManipulate",function(s){r.beginManipulateCB(s)});q.subscribe("Manipulate",function(s){r.manipulateCB(s)});q.subscribe("EndManipulate",function(s){r.endManipulateCB(s)});q.subscribe("BeginPreactivate",function(s){r.beginPreactivateCB(s)});q.subscribe("Preactivate",function(s){r.preactivateCB(s)});q.subscribe("EndPreactivate",function(s){r.endPreactivateCB(s)});return q},positionArrow:function(s,y,r){var x=new n.Vector3(0,0,1);var w=new n.Vector3().copy(s).applyAxisAngle(x,Math.PI/2);var u=new n.Vector3().copy(s);var v=new n.Vector3().copy(w).cross(u).normalize();u.applyAxisAngle(v,Math.PI);var z=new n.Matrix4();var t=new n.Vector3().copy(y);if(r){u.applyAxisAngle(v,Math.PI);var A=new n.Vector3().copy(s).setLength(this._arrow._height)}var q=z.elements;q[0]=w.x;q[1]=w.y;q[2]=w.z;q[4]=v.x;q[5]=v.y;q[6]=v.z;q[8]=u.x;q[9]=u.y;q[10]=u.z;z.setPosition(t);this._arrow.setMatrix(z)},beginManipulateCB:function(r){if(!this._normalVector){this._normalVector=new n.Vector3().copy(r.intersection.normal);this._intersectionPosition=new n.Vector3().copy(r.intersection.position)}var q=new n.Vector3().copy(this._normalVector).setLength(this._offset);var s=new n.Vector3().copy(this._intersectionPosition).add(q);this.positionArrow(r.intersection.normal,s);this._previousTranslate=new n.Vector3(0,0,0);if(!this._manipulatorCreated){this.createProximityTopCircle();this.updateGeometryPosition(r.intersection.normal,s);this.createProximityBottomCircle(r.intersection.normal,this._intersectionPosition);this._ruler.clear();this._ruler.origin=new n.Vector3().copy(this._intersectionPosition);this._ruler.initValue=0;this._ruler.value=this._offset;this._ruler.direction=this._normalVector}this._ruler.setVisibleFlag(true);this._ruler.display();this._ruler.beginManipulation();this._arrow.setVisibility(true);this._viewer.render();this._whileManipulation=true},manipulateCB:function(w){var u=new n.Vector3().copy(w.translationVector);var s=new n.Vector3().copy(u).sub(this._previousTranslate);if(s.x===0&&s.y===0&&s.z===0){return}this._ruler.snapping=false;if(w.intersection.path.length){if(w.intersection.path[0].externalPath.length>1){if(w.intersection.path[0].externalPath[1].name=="ruler"){this._ruler.snapping=true;var v=this._ruler.initValue+w.translationVector.length()*(this._ruler.direction.dot(w.translationVector)>0?1:-1);v=Math.round(v/10)*10;v-=this._ruler.initValue;u=new n.Vector3().copy(this._ruler.direction).multiplyScalar(v)}}else{return null}}var q=s.dot(this._normalVector);s=new n.Vector3().copy(u).sub(this._previousTranslate);var r=this._ruler.value+s.length()*(q>0?1:-1);if(r<=0){return}this._ruler.value=r;this._ruler.refresh();this._previousTranslate.add(s);var t=new n.Vector3().copy(this._normalVector).setLength(this._offset).add(s);this._offset=t.length();var x=new n.Vector3().copy(this._intersectionPosition).add(t);if(q>0){this.positionArrow(this._normalVector,x,false)}else{this.positionArrow(this._normalVector,x,true)}this.updateLine(this._intersectionPosition,this._normalVector,this._offset);this.updateGeometryPosition(this._normalVector,x);this._viewer.render();this.publish("EndBoxChanged")},endManipulateCB:function(q){if(this._manip){this._manip.unlink(this._token)}this._manip=this.createManip();if(this._manipulatorCreated){this._token=this._manip.linkToNode(this._topCircleBag)}else{this._token=this._manip.linkToNode(this._initPath)}this._arrow.setVisibility(false);this._ruler.snapping=false;this._ruler.endManipulation();this._ruler.display();this._viewer.render();this._whileManipulation=false;var r=this.getParams();this.publish("EndBoxChanged",r)},beginPreactivateCB:function(q){if(this._whileManipulation){return true}this.publish("onPreactivate")},preactivateCB:function(r){if(this._whileManipulation){return}if(!this._manipulatorCreated){this.positionArrow(r.intersection.normal,r.intersection.position)}else{var q=new n.Vector3().copy(this._normalVector).setLength(this._offset);var s=new n.Vector3().copy(this._intersectionPosition).add(q);this.positionArrow(this._normalVector,s)}this._arrow.setVisibility(true);this._viewer.render();return true},endPreactivateCB:function(q){if(this._whileManipulation){return}this._arrow.setVisibility(false);this._viewer.render();return true},clean:function(){this._ruler.setVisibleFlag(false);this._ruler.clear();if(this._manip){this._manip.unlink(this._token)}if(this._arrow){this._sceneGraph.remove(this._arrow)}this._arrow=null;if(this._bottomCircleBag){this._bottomCircleBag.removeChildren()}if(this._topCircleBag){this._topCircleBag.removeChildren()}if(this._dashedLinesBag){this._dashedLinesBag.removeChildren()}this._sceneGraph.remove(this._dashedLinesBag);this._sceneGraph.remove(this._topCircleBag);this._sceneGraph.remove(this._bottomCircleBag);this._context.getDecorationBag().remove(this._sceneGraph);this._bottomCircleBag=null;this._topCircleBag=null;this._dashedLinesBag=null;var q=this;q._ruler.unsubscribe(this._tokenLocalRuler);delete this._geomHelper;delete this._topCircleBag;delete this._dashedLinesBag;delete this._bottomCircleBag;delete this._modelEvent;delete this._arrow;delete this._ruler;delete this._tokenLocalRuler;this._viewer.render()},subscribe:function(q,r){return this._modelEvent.subscribe({event:q},r)},unsubscribe:function(q){this._modelEvent.unsubscribe(q)},publish:function(q,r){return this._modelEvent.publish({event:q,data:r,context:this})}});return f});define("DS/ENOWebNavVolumeQuery/ENOWebNavSphereHandle",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement","DS/Core/Events","DS/Visualization/GeometryHelper","DS/Visualization/Node3D","DS/Core/ModelEvents","DS/ENOWebNavVolumeQuery/ENOWebNavShapeManipulator","DS/ENOWebNavVolumeQuery/ENOWebNavHandleArrow","DS/Ruler/Ruler","DS/ENOWebNavVolumeQuery/ENOWebNavVolumeQueryRobot","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/PADUtils/PADContext"],function(h,a,f,p,g,e,q,j,c,n,i,o,l,b,m,k){var d=a.extend({init:function(v,u,r){this._savedCenter=new p.Vector3();this._savedRadius=new p.Vector3();this._radius=v.radius;this._center=v.center;this._matrix=new p.Matrix4().copy(r);this._sceneGraph=new j("VolumeRoot");this._sceneGraph.setVisibilityFree(true);this._viewer=u.getViewer();this._context=k.get();this._context.getDecorationBag().add(this._sceneGraph);this._sphereNode=null;this._sphereBag=new j();this._sphereBag.name="SphereVolumeSelector";this._sceneGraph.addChild(this._sphereBag);this._geomHelper=new q();this.isModifiedByUser=false;var t=this;this._robot=new l({window:u,viewer:t._viewer,sceneGraph:t._sceneGraph,target:t._sphereBag});this._tokenRobotRuler=this._robot._ruler.subscribe("RulerManipulate",function(w){t.updateSphereFromRobotRulerValue(w)});this._robotToken=new Array(9);this._modelEvent=new c();this._manips=null;this._token=0;this._previousTranslate=null;this._normalVector=null;this._sphere=null;var s=60;this._arrow=new i({name:"arrowBoxHandle",sceneGraph:this._sceneGraph,width:s,viewer:this._viewer});this._sceneGraph.addChild(this._arrow);this._arrow.setVisibility(false);this._ruler=new o(u,{displayOrigin:true,hideDuringLocalTransfo:true,startPoint:0,startValue:0});this._tokenLocalRuler=this._ruler.subscribe("RulerManipulate",function(w){t.updateSphereFromRulerValue(w)})},getParams:function(){return{center:this._center,radius:this._radius}},getBag:function(){return this._sphereBag},updateSphereFromRulerValue:function(s){if(s.value<0){this._ruler.value=this._previousTranslate.length();this._ruler.refresh();return}var r=new p.Vector3().copy(s.translationVector);if(r.x==0&&r.y==0&&r.z==0){return}this._previousTranslate.add(r);this._radius=s.value;this.createSphere();this._manip.unlink(this._token);this._manip=this.createManip();this._token=this._manip.linkToNode(this._sphereBag);this.publish("EndBoxChanged");this._viewer.render()},display:function(){this.createSphere();this._manip=this.createManip();this._token=this._manip.linkToNode(this._sphereBag);this._robot.setVisibility(true);var s=new g();s.setFromArray([this._sceneGraph,this._sphereBag]);this._robot._robot.target=s;this._robot.updateRobotFromMatrix(this._matrix);this._viewer.render();var r=this;this._robotToken[0]=this._robot._robot.subscribe("LineTranslationBegin",function(t){r.BeginRobotManipulationCB(t)});this._robotToken[1]=this._robot._robot.subscribe("PlaneTranslationBegin",function(t){r.BeginRobotManipulationCB(t)});this._robotToken[2]=this._robot._robot.subscribe("ScalingBegin",function(t){r.BeginRobotManipulationCB(t)});this._robotToken[3]=this._robot._robot.subscribe("LineTranslationManipulation",function(t){r.RobotTranslationManipulationCB(t)});this._robotToken[4]=this._robot._robot.subscribe("PlaneTranslationManipulation",function(t){r.RobotTranslationManipulationCB(t)});this._robotToken[5]=this._robot._robot.subscribe("ScalingManipulation",function(t){r.RobotScalingManipulationCB(t)});this._robotToken[6]=this._robot._robot.subscribe("LineTranslationEnd",function(t){r.RobotEndTranslationManipulationCB(t)});this._robotToken[7]=this._robot._robot.subscribe("PlaneTranslationEnd",function(t){r.RobotEndTranslationManipulationCB(t)});this._robotToken[8]=this._robot._robot.subscribe("ScalingEnd",function(t){r.RobotEndScalingManipulationCB(t)})},BeginRobotManipulationCB:function(r){this._savedCenter.copy(this._center);this._savedRadius=this._radius;this._ruler.setVisibleFlag(false);this._ruler.clear()},RobotTranslationManipulationCB:function(r){this._center.copy(this._savedCenter);this._center.add(r.translationVector)},RobotScalingManipulationCB:function(r){this._radius=this._savedRadius;this._radius*=r.scalingFactor},RobotEndTranslationManipulationCB:function(r){this.refreshAfterManipulation();this.publish("EndBoxChanged")},RobotEndScalingManipulationCB:function(r){this.refreshAfterManipulation();this.publish("BoxChanged");this.publish("EndBoxChanged")},refreshAfterManipulation:function(){this._matrix=new p.Matrix4().copy(this._robot._robot.getMatrix());if(this._sphereNode){this._sphereNode.removeChildren()}this._sphereNode=null;if(this._sphereBag){this._sphereBag.removeChildren();this._sceneGraph.remove(this._sphereBag)}this._sphereBag=null;this._sphereBag=new j();this._sceneGraph.addChild(this._sphereBag);this._manip=null;this.createSphere();this._manip=this.createManip();this._token=this._manip.linkToNode(this._sphereBag);var r=new g();r.setFromArray([this._sceneGraph,this._sphereBag]);this._robot._robot.target=r;this._viewer.render()},createSphere:function(){if(this._sphere){this._sphere.radius=this._radius}if(this._sphereNode){this._sphereNode.removeChildren()}var s=new p.Matrix4().copy(this._matrix);this._sphere=this._geomHelper.CreateVis3DSphere({matrix:s,radius:this._radius});var u=new p.MeshBasicMaterial({side:p.DoubleSide,color:9689341,opacity:0.5,transparent:true});u.force=true;var v=m.createMeshNode(this._sphere,u);if(!this._sphereNode){this._sphereNode=new j();this._sphereBag.add(this._sphereNode)}v.excludeFromCSO(true);v.excludeFromHighlight(true);v.setSSAO(false);v.setShadow(false,false);this._sphereNode.add(v);var w=this._geomHelper.createCircle({radius:this._radius,segments:64,fill:false,color:new b.Color(99/255,216/255,1,1)});var r=new p.LineBasicMaterial({color:9689341,linewidth:1,opacity:1});var t=m.createMeshNode(w,r);t.setMatrix(s);t.excludeFromCSO(true);t.excludeFromHighlight(true);t.setSSAO(false);t.setShadow(false,false);this._sphereNode.add(t)},createManip:function(){var s=this;var r=new n(this._viewer);r.subscribe("BeginManipulate",function(t){s.beginManipulateCB(t)});r.subscribe("Manipulate",function(t){s.manipulateCB(t)});r.subscribe("EndManipulate",function(t){s.endManipulateCB(t)});r.subscribe("Preactivate",function(t){s.preactivateCB(t)});r.subscribe("EndPreactivate",function(t){s.endPreactivateCB(t)});return r},positionArrow:function(t,z,s){var y=new p.Vector3(0,0,1);var x=new p.Vector3().copy(t).applyAxisAngle(y,Math.PI/2);var v=new p.Vector3().copy(t);var w=new p.Vector3().copy(x).cross(v).normalize();v.applyAxisAngle(w,Math.PI);var A=new p.Matrix4();var u=new p.Vector3().copy(z);if(s){v.applyAxisAngle(w,Math.PI);var B=new p.Vector3().copy(t).setLength(this._arrow.getScaledHeight());u.add(B)}var r=A.elements;r[0]=x.x;r[1]=x.y;r[2]=x.z;r[4]=w.x;r[5]=w.y;r[6]=w.z;r[8]=v.x;r[9]=v.y;r[10]=v.z;A.setPosition(u);this._arrow.setMatrix(A);this._arrow.setVisibility(true)},beginManipulateCB:function(r){this.positionArrow(r.intersection.normal,r.intersection.position);this._previousTranslate=new p.Vector3(0,0,0);this._normalVector=new p.Vector3().copy(r.intersection.normal);this._ruler.clear();this._ruler.origin=new p.Vector3().copy(this._center);this._ruler.initValue=this._radius;this._ruler.value=this._ruler.initValue;this._ruler.direction=r.intersection.normal;this._ruler.setVisibleFlag(true);this._ruler.display();this._ruler.beginManipulation();this._robot.setVisibility(false);this._viewer.render();this.isModifiedByUser=true},manipulateCB:function(x){var u=this._ruler.getSnappedTranslationVector(x);if(u.returnCode!==0){return null}var w=this._ruler.getSnappedTranslationVector(x).snappedTranslationVector;var t=new p.Vector3().copy(w).sub(this._previousTranslate);if(t.x==0&&t.y==0&&t.z==0){return}var r=t.dot(this._normalVector);t=new p.Vector3().copy(w).sub(this._previousTranslate);var s=this._ruler.value+t.length()*(r>0?1:-1);if(s<=0){return}this._ruler.value=s;this._ruler.refresh();this._previousTranslate.add(t);var v=new p.Vector3().copy(this._normalVector).setLength(this._radius).add(t);this._radius=v.length();this.createSphere();var y=new p.Vector3().copy(this._center).add(v);if(r>0){this.positionArrow(this._normalVector,y,false)}else{this.positionArrow(this._normalVector,y,true)}this._viewer.render();this.publish("EndBoxChanged")},endManipulateCB:function(r){this._manip.unlink(this._token);this._manip=this.createManip();this._token=this._manip.linkToNode(this._sphereBag);this._arrow.setVisibility(false);this._ruler.snapping=false;this._ruler.endManipulation();this._ruler.display();this._robot.setVisibility(true);this._viewer.render();this.publish("EndBoxChanged")},preactivateCB:function(r){this.positionArrow(r.intersection.normal,r.intersection.position);this._arrow.setVisibility(true);this._viewer.render();this.publish("onPreactivate");return true},endPreactivateCB:function(r){this._arrow.setVisibility(false);this._viewer.render();this.publish("onEndPreactivate");return true},clean:function(){if(this._sphereNode){this._sphereNode.removeChildren()}this._sphereNode=null;if(this._sphereBag){this._sphereBag.removeChildren();this._sceneGraph.remove(this._sphereBag)}this._sphereBag=null;this._sceneGraph.remove(this._robot._robot);this._robot.setVisibility(false);this._robot._ruler.setVisibleFlag(false);this._robot._ruler.clear();this._ruler.setVisibleFlag(false);this._ruler.clear();var r=this;this._robotToken.forEach(function(s){r._robot._robot.unsubscribe(s)});r._robot._ruler.unsubscribe(this._tokenRobotRuler);r._ruler.unsubscribe(this._tokenLocalRuler);this._manip.unlink(this._token);if(this._arrow){this._sceneGraph.remove(this._arrow)}this._context.getDecorationBag().remove(this._sceneGraph);this._arrow=null;delete this._savedCenter;delete this._savedRadius;delete this._matrix;delete this._sphereBag;delete this._geomHelper;delete this._robot;delete this._tokenRobotRuler;delete this._robotToken;delete this._modelEvent;delete this._arrow;delete this._ruler;delete this._tokenLocalRuler;this._viewer.render()},subscribe:function(r,s){return this._modelEvent.subscribe({event:r},s)},unsubscribe:function(r){this._modelEvent.unsubscribe(r)},publish:function(r){return this._modelEvent.publish({event:r,context:this})}});return d});define("DS/ENOWebNavVolumeQuery/ENOWebNavVolumeQueryCmd",["UWA/Core","DS/Core/Core","DS/Core/Events","DS/ApplicationFrame/Command","DS/Visualization/ThreeJS_DS","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/ApplicationFrame/ContextualBar","DS/VisuEvents/EventsManager","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADAlert","DS/PADUtils/PADPromise","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/ENOWebNavVolumeQuery/ENOWebNavVolumeQueryPanel","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADUtilsServices","i18n!DS/ENOWebNavVolumeQuery/assets/nls/ENOWebNavVolumeQuery.json"],function(c,a,q,e,t,s,j,g,p,h,n,d,r,b,o,m,k,i,f){var l=e.extend({_availableForRole:true,init:function(v){c.log("ENOWebNavVolumeQueryCmd: init");var w=this;this._parent(v,{mode:"exclusive",isAsynchronous:true});function u(){w._selectedObjsPathElt=[];w._CBTokens=[];w._volumeSelectionShape=null;w._endBoxManipulation=false;w.setRepeatMode(false);w._panelCreation=0;w._pickCount=0;w._completionNeeded=true;w._sceneGraphOverrideSet=null;w._volumeType=0;w._volumeShape=1;w._intersectionMode=0;w._selectionMode=0;w._lockContextBarPosition=false;w._onlyRepSelected=true;w._proximityAvailable=true;w.selectObjName="Please select an Object";w._authoringMode=false;w._shape=0;w._window=w.getFrameWindow();w._shapeHdrList=["BoxQueryHdr","SphereQueryHdr","ProximityQueryHdr"];w._inOutHdrList=["VolumeQueryPartlyInHdr","VolumeQueryFullInHdr","VolumeQueryPartlyOutHdr","VolumeQueryFullOutHdr"];w._context=n.get(w.options.context);if(typeof w._context.getWidget()!=="undefined"&&w._context.getWidget()!==null&&w._context.getWidget().widgetDomain&&w._context.getWidget().widgetDomain.indexOf("volume_query_filtering")>0){w._selectionModeHdrList=["PADSelectionModeHdr","PADFilteringModeHdr"]}if(w._context.name==="ENOPAD3DViewer"){w._CBTokens.push(w._context.subscribe({event:"onIndexAvalabilityChange"},function(x){if(x.availability){w._authoringMode=false}else{w._authoringMode=true}}));w._CBTokens.push(w._context.subscribe({event:"onVolumeOpen"},function(x){w._context._volumePanel=w._panelCreation;if(x){if(x.changeType!==undefined){if(x.changeType.type=="box"){w._volumeType=0}else{if(x.changeType.type=="sphere"){w._volumeType=1}else{if(x.changeType.type=="proximity"){w._volumeType=2}}}}else{if(x.biData){w.ngfilterVolumeUpdate(x.biData)}else{if(x.closePanel===true){if(w._panelCreation>0){w.end()}}}}if(x.error==true){w.updateVolumeQuery({action:"cancel"});w.displayNotification("InvalidProximityData")}}}));w._CBTokens.push(w._context.subscribe({event:"onAuthoringSwitch"},function(x){w._authoringMode=x.state}));w._CBTokens.push(w._context.subscribe({event:"onRootAdded"},function(){if(w._availableForRole){w.enable()}}));w._CBTokens.push(w._context.subscribe({event:"onRootRemoved"},function(){if((w._context.getRoots().length===0&&(!w._context._controller.getHiddenRootIds().length))||!w._availableForRole){w.disable()}}));if((w._context.getRoots().length===0&&(!w._context._controller.getHiddenRootIds().length))||!w._availableForRole){w.disable()}else{w.enable()}}w.addToCsoCallback=null}i.getGrantedRoles(function(y){w._availableForRole=false;for(var x=0;x<y.length;x++){if(y[x].id==="PAU"||y[x].id==="E19"||y[x].id==="UWE"||y[x].id==="InternalDS"){w._availableForRole=true;break}}if(w._availableForRole){u()}else{w.disable()}})},_isFilterOpen:function(){var u=this;u._context._controller.isFilterOpen(function(y){if(y.filterAvailable!==true){if(u._panel._filterExpander){u._panel._filterExpander.disabled=true;u._panel._filterExpander.close()}u._panel.okButton.label=f.okButton;u._panel.cancelButton.label=f.cancelButton}else{if(u._vfId==undefined){u._panel._updateFilter.disabled=true}var w=false;var v=u._context.getController();var x=v.buildArrayFromPath(u._selectedObjsPathElt[0]);u._selectedObjsPathElt.forEach(function(z){var A=v.buildArrayFromPath(z);if(A[0]!==x[0]){w=true}u._rootIdsArray.push(A)});if(u._panel._filterExpander&&w==true){u._panel._filterButton.disabled=true;u._rootIdsArray=[]}else{u._panel._filterButton.disabled=false}}})},ngfilterVolumeUpdate:function(y){var x=this;x._setId=y.setId;x._vfId=y.id;x._vfDispName=y.displayName;x._volumeShape=1;if(y.action=="update"){x._panel._updateFilter.checkFlag=true;x._panel._updateFilter.disabled=false;x._panel._updateFilter.label=f.updateFilter+": "+x._vfDispName}else{x._panel._addFilter.checkFlag=true;x._panel._updateFilter.label=f.updateFilter}x._panel._filterExpander.expandedFlag=true;if(y.volume){if(y.volume.intersection_mode==="partly_in"){x._intersectionMode=0;x._panel._partlyInStarter.checkFlag=true}else{if(y.volume.intersection_mode=="fully_in"){x._intersectionMode=1;x._panel._fullyInStarter.checkFlag=true}else{if(y.volume.intersection_mode=="partly_out"){x._intersectionMode=2;x._panel._partlyOutStarter.checkFlag=true}else{if(y.volume.intersection_mode=="fully_out"){x._intersectionMode=3;x._panel._fullyOutStarter.checkFlag=true}}}}switch(y.volume.type){case"box":if(x._volumeShape!==0){x._panel._boxStarter.onClick();x._panel._boxStarter.checkFlag=true}break;case"sphere":if(x._volumeShape!==0){x._panel._sphereStarter.checkFlag=true;x._panel._sphereStarter.onClick()}break;case"proximity":s.empty();j.empty();var u=[],v=[];var w=x._context.unstreamPath(y.volume.root_path_physicalid[0]);u.push({pathElement:w});v.push(u[0].pathElement);x._selectedObjsPathElt=v;x._panel._proximityStarter.checkFlag=true;x._panel._proximityStarter.onClick();break;default:break}setTimeout(function(){if(y.volume.type=="box"){x._panel._minX.value=Number(y.volume.transformation_matrix[9]);x._panel._minY.value=Number(y.volume.transformation_matrix[10]);x._panel._minZ.value=Number(y.volume.transformation_matrix[11]);x._panel._maxX.value=Number(+y.volume.corner_max[0]+ +y.volume.transformation_matrix[9]);x._panel._maxY.value=Number(+y.volume.corner_max[1]+ +y.volume.transformation_matrix[10]);x._panel._maxZ.value=Number(+y.volume.corner_max[2]+ +y.volume.transformation_matrix[11])}else{if(y.volume.type=="sphere"){x._panel._centerX.value=Number(y.volume.center[0]);x._panel._centerY.value=Number(y.volume.center[1]);x._panel._centerZ.value=Number(y.volume.center[2]);x._panel._radius.value=Number(y.volume.radius)}else{if(y.volume.type=="proximity"){x._panel._offset.value=Number(y.volume.distance)}}}},200)}},destroy:function(){if(this._context){for(var u=0;u<this._CBTokens.length;u++){this._context.unsubscribe(this._CBTokens[u])}}if(this._panel){this._panel.destroy();delete this._panel}this._CBTokens=null;this._context=null},_onMouseEvents:function(x){if(x.eventType!=="@onMouseMoveEvent"){return}var v=this;var w=x.from[0];var u=v._window.getViewer().getMousePosition(w.getCurrentPosition(v._window.getViewer()));v._mousePosition.x=u.xPix-v._context.elements.container.offsetLeft;v._mousePosition.y=u.yPix-v._context.elements.container.offsetTop},displayNotification:function(u,w){if(this._context.name==="ENOPAD3DViewer"){var x="";var v;if(u==="cancel"){x=f.commandCanceled;v="info"}else{if(u==="wrongInput"){x=f.incorrectInput;v="warning"}else{if(u==="validate"){if(w!==undefined&&w===1){x=w+" "+f.singleValidSelection;v="info"}else{if(w!==undefined&&w>1){x=w+" "+f.validSelection;v="info"}else{x=f.emptySelection;v="info"}}}else{if(u==="badProximityInput"){x=f.badProximityInput;v="error"}else{if(u==="badProximitySelection"){x=f.badProximitySelection;v="error"}else{if(u==="queryFailed"){x=f.queryFailed;v="error"}else{if(u==="multipleRoots"){x=f.multipleRoots;v="warning"}else{if(u==="proximityOnAssembly"){x=f.proximityOnAssembly;v="warning"}else{if(u==="proximityOnMultisel"){x=f.proximityOnMultisel;v="warning"}else{if(u==="InvalidProximityData"){x=f.InvalidProximityData;v="warning"}else{if(u==="wrongSelection"){x=f.wrongSelection;v="warning"}else{if(u==="authoringModeOn"){x=f.authoringModeOn;v="warning"}else{if(u==="VQDisabled"){x=f.queryFailed_VQDisabled;v="warning"}}}}}}}}}}}}}this._context.displayNotification({eventID:v,msg:x})}},beginExecute:function(){if(this._availableForRole){c.log("ENOWebNavVolumeQueryCmd: BeginExecute");this.layoutActivated=false;if(this._authoringMode===true){this.displayNotification("authoringModeOn")}if(this._context.name==="ENOPAD3DViewer"){this._context.setRobotVisibility(false);var v=this._context.getRoots();this.layoutActivated=this._context.deactivateCurrentLayout({disableCommand:true});if(!this._sceneGraphOverrideSet){this._sceneGraphOverrideSet=new o(this._context.getController().getRootBagPath().externalPath[0])}}this.defaultContextualBarInitialyDisplayed=this._context.isDefaultContextualBarVisible();if(this.defaultContextualBarInitialyDisplayed){this._context.setDefaultContextualBarVisibility(false)}this.defaultContextualMenuInitialyDisplayed=this._context.isDefaultContextualMenuVisible();if(this.defaultContextualMenuInitialyDisplayed){this._context.setDefaultContextualMenuVisibility(false)}var x=this;x._selectedObjsPathElt=[];x._rootIdsArray=[];x._lockContextBarPosition=false;x._initialized=false;x._onlyRepSelected=true;x._proximityAvailable=true;x._cleanHandle();x._onRemoveCB=x._context.subscribe({event:"onRootRemoved"},function(){if(x._isRunning){x.end()}});x._mousePosition=new t.Vector2();x._position=new t.Vector2();x._onMouseNotification=function(z){x._onMouseEvents(z)};p.addEvent(x._window.getViewer().canvas,"onMouseMove",x._onMouseNotification);x._CSOAddCB=function(){w()};var y=b.getPromises().slice();b.createPromise(function(A,z){Promise.all(y).then(function(B){y=null;var C=s.get();if(!C.length){if(x._context._filterDrop==true){u()}else{x.addToCsoCallback=s.onAdd(x._CSOAddCB)}}else{w()}A()})},"initiateCSO");function w(){if(d.getSetting("activateVolumeFilter")==true){x._isFilterOpen()}x._tokenHandle=new Array(2);var A=s.get();var z=[];A.forEach(function(C){if(!C.pathElement.getLastElement(true)._excludeFromCSO&&k.isAModelPath(C.pathElement)){x._selectedObjsPathElt.push(C.pathElement);var B=C.pathElement.getLastElement(true);z.push(B);x.event=C.event}});if(x._selectedObjsPathElt.length){x._proximityAvailable=x._onlyRepSelected&&A.length<2;if(!x._onlyRepSelected){x.displayNotification("proximityOnAssembly")}else{if(A.length>1){x.displayNotification("proximityOnMultisel")}}if(x._panelCreation==0){x._proximityAvailable=x._context._filterDrop==true?false:x._proximityAvailable;x._panelCreation++;x._panel=new m({immersiveFrame:x._context.getFrameWindow().getImmersiveFrame(),defaultShape:x._volumeType,defaultIntersection:x._intersectionMode,controller:x});if(x._context._filterDrop==true){x._panel.okButton.disabled=true}}s.unsubscribe(x.addToCsoCallback);x.addToCsoCallback=null;if(x._volumeType===0){x._displayBoxHandle(z)}else{if(x._volumeType===1){x._displaySphereHandle(z)}else{if(x._volumeType===2){if(x._proximityAvailable){x._displayProximityHandle(z)}else{x._volumeType=0;x._displayBoxHandle(z)}}}}}else{x.displayNotification("wrongSelection");if(!x.addToCsoCallback){x.addToCsoCallback=s.onAdd(x._CSOAddCB)}}}function u(){x._tokenHandle=new Array(2);x._proximityAvailable=false;if(x._panelCreation==0){x._panelCreation++;x._panel=new m({immersiveFrame:x._context.getFrameWindow().getImmersiveFrame(),defaultShape:x._volumeType,defaultIntersection:x._intersectionMode,controller:x});if(x._context._filterDrop==true){x._panel.okButton.disabled=true}}if(x._volumeType===0||x._volumeType===2){x._volumeType=0;x.displayBoxHandleFilter()}else{if(x._volumeType===1){x.displaySphereHandleFilter()}}}}else{this.end()}},displayBoxHandleFilter:function(){var u=this;require(["DS/ENOWebNavVolumeQuery/ENOWebNavBoxHandle"],function(w){u._volumeShape=0;u._volumeType=0;var v=new t.Matrix4();u._cleanHandle();u._volumeSelectionShape=new w({cornerPoint:null,fstAxis:null,sndAxis:null,thdAxis:null},u._window,v);u._tokenHandle[0]=u._volumeSelectionShape.subscribe("EndBoxChanged",function(){u._panel.setShapeParameters(u._volumeSelectionShape.getParams())});u._tokenHandle[1]=u._volumeSelectionShape.subscribe("onPreactivate",function(){if(g._isShown===false){u._displayContextBar()}});u._panel.setShapeParameters({box:true,filterDrop:true})})},displaySphereHandleFilter:function(){var u=this;require(["DS/ENOWebNavVolumeQuery/ENOWebNavSphereHandle"],function(y){u._volumeShape=0;u._volumeType=1;var w=new t.Vector3(0,0,0);var v=0;var x=new t.Matrix4().identity().setPosition(w);u._cleanHandle();u._volumeSelectionShape=new y({center:w,radius:v},u._window,x);u._tokenHandle[0]=u._volumeSelectionShape.subscribe("EndBoxChanged",function(){u._panel.setShapeParameters(u._volumeSelectionShape.getParams())});u._tokenHandle[1]=u._volumeSelectionShape.subscribe("onPreactivate",function(){if(g._isShown===false){u._displayContextBar()}});u._panel.setShapeParameters({center:true,radius:true,filterDrop:true})})},retreiveVolumeData:function(z){var B=this;var A;if(B._intersectionMode===0){A="partly_in"}else{if(B._intersectionMode==1){A="fully_in"}else{if(B._intersectionMode==2){A="partly_out"}else{if(B._intersectionMode==3){A="fully_out"}}}}var v=B._volumeSelectionShape.getParams();var H=B._context.getRoots();var x=B._context.getController();var C,I;var u=[];H.forEach(function(J){u.push([k.getNodeID(J)])});if(B._volumeType===0){v.matrix.setPosition(new t.Vector3(0,0,0));var D=new t.Matrix4().getInverse(v.matrix);var G=v.fstAxis.clone().applyMatrix4(D);var E=v.sndAxis.clone().applyMatrix4(D);var y=v.thdAxis.clone().applyMatrix4(D);v.matrix.setPosition(v.cornerPoint);var F=G.clone();F.add(E);F.add(y);C={root_path_physicalid:u,volume_filter:{box:{corner_min:["0.0","0.0","0.0"],corner_max:[F.x.toFixed(3),F.y.toFixed(3),F.z.toFixed(3)],transformation_matrix:[v.matrix.elements[0].toFixed(3),v.matrix.elements[1].toFixed(3),v.matrix.elements[2].toFixed(3),v.matrix.elements[4].toFixed(3),v.matrix.elements[5].toFixed(3),v.matrix.elements[6].toFixed(3),v.matrix.elements[8].toFixed(3),v.matrix.elements[9].toFixed(3),v.matrix.elements[10].toFixed(3),v.matrix.elements[12].toFixed(3),v.matrix.elements[13].toFixed(3),v.matrix.elements[14].toFixed(3)],intersection_mode:A}},intent:"volumeQuery",fcs_url_mode:d.getSetting("enopad3dviewer_useStaticURL")?"REDIRECT":undefined};I={root_path_physicalid:B._rootIdsArray,type:"box",intersection_mode:A,corner_min:C.volume_filter.box.corner_min,corner_max:C.volume_filter.box.corner_max,transformation_matrix:C.volume_filter.box.transformation_matrix}}else{if(B._volumeType==1){C={root_path_physicalid:u,volume_filter:{sphere:{center:[v.center.x.toFixed(3),v.center.y.toFixed(3),v.center.z.toFixed(3)],radius:v.radius.toFixed(3),intersection_mode:A}},intent:"volumeQuery",fcs_url_mode:d.getSetting("enopad3dviewer_useStaticURL")?"REDIRECT":undefined};I={root_path_physicalid:B._rootIdsArray,type:"sphere",intersection_mode:A,center:C.volume_filter.sphere.center,radius:C.volume_filter.sphere.radius}}else{if(B._volumeType==2){s.empty();j.empty();B._window.getViewer().render();var w=x.buildArrayFromPath(B._selectedObjsPathElt[0]);C={root_path_physicalid:u,volume_filter:{assemblyshape:{root_path_physicalid:[w],distance:v.offset.toFixed(3),intersection_mode:A}},intent:"volumeQuery",fcs_url_mode:d.getSetting("enopad3dviewer_useStaticURL")?"REDIRECT":undefined};I={root_path_physicalid:[w],type:"proximity",intersection_mode:A,distance:C.volume_filter.assemblyshape.distance}}}}if(z==="filter"){return I}else{return C}},updateVolumeQuery:function(y){var w=this;var v=w._context.getBIController().getBIProxy();var u={};w._context._filterDrop=false;var x=w._panel._addFilter.checkFlag==true?"add":"update";if(y&&y.action=="cancel"){u={appId:i.getSharedId(),widgetId:i.getWidgetId(),action:"cancel"}}else{u={appId:i.getSharedId(),widgetId:i.getWidgetId(),action:x,setId:w._setId,id:w._vfId,displayName:w._vfDispName,volume:w.retreiveVolumeData("filter")};if(!(w._context.getRoots().length)){u.volume.root_path_physicalid.push(w._context._physicalId)}}if(v){v.setVolume(u)}w._volumeShape=1},applyVolumeQuery:function(){var w=this;var u=w.retreiveVolumeData();var y=Math.random().toString();var x=y.substr(y.indexOf("."));var v=u.root_path_physicalid[0][0]+x;if(d.getSetting("activateVolumeFilter")!==true){w._cleanHandle()}else{s.empty();j.empty()}w._context.getController().volumeQuery({data:u,completion:w._completionNeeded,callbacks:{onComplete:function(A){if(A.selectedPaths){var z=[];A.selectedPaths.forEach(function(C){var B=w._context.unstreamPath(C);z.push({pathElement:B,event:w.event})});if(A.querySuccess==false){w._context._controller._querySuccess=true;w.displayNotification("wrongInput")}else{w.displayNotification("validate",z.length)}s.add(z);s.get().forEach(function(B){j.add(B)});if(w._selectionMode===1){w._context.getHideShowController().exclusiveShow(A)}setTimeout(function(){if(d.getSetting("activateVolumeFilter")!==true){w.end()}})}},onFailure:function(D,A,C){if(D&&D.errors){var z=true;for(var B=0;B<D.errors.length;B++){if(D.errors[B].errorCode==="VOLUME_QUERIES_DISABLED"){w.displayNotification("VQDisabled");z=false}}if(z){w.displayNotification("queryFailed")}}else{if(A&&A.indexOf("shape_invalid_rep")>0){w.displayNotification("badProximityInput")}else{w.displayNotification("queryFailed")}}w.end()}}})},_cleanHandle:function(){var u=this;if(u._volumeSelectionShape){if(u._tokenHandle){u._tokenHandle.forEach(function(v){u._volumeSelectionShape.unsubscribe(v)})}u._volumeSelectionShape.clean();delete u._volumeSelectionShape}},changePickableobject:function(){var u=this;s.empty();j.empty();u._resetPicking();u._cleanHandle();u._panel._filterButton.disabled=true;u._panel._boxStarter.disabled=true;u._panel._sphereStarter.disabled=true;u._panel.okButton.disabled=true;u._panel._offset.value=0;u.proximitySelection=function(){var w=s.get();var v=[];u._selectedObjsPathElt=[];w.forEach(function(y){if(!y.pathElement.getLastElement(true)._excludeFromCSO&&k.isAModelPath(y.pathElement)){u._selectedObjsPathElt.push(y.pathElement);var x=y.pathElement.getLastElement(true);v.push(x);u.event=y.event}});s.unsubscribe(u.wait4CSOSelection);u.wait4CSOSelection=null;u._panel._filterButton.disabled=false;u._panel._boxStarter.disabled=false;u._panel._sphereStarter.disabled=false;u._panel.okButton.disabled=false;u._displayProximityHandle(v)};u.wait4CSOSelection=s.onAdd(u.proximitySelection)},_resetPicking:function(){var u=this;if(u._context.name==="ENOPAD3DViewer"&&u._sceneGraphOverrideSet){u._context.getViewer().getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(u._sceneGraphOverrideSet);delete u._sceneGraphOverrideSet}},updateSphere3D:function(x,u,w){var v=this;if(!u){if(x.radius){v._volumeSelectionShape._radius=x.radius}else{v._volumeSelectionShape._center.x=x.centerX;v._volumeSelectionShape._center.y=x.centerY;v._volumeSelectionShape._center.z=x.centerZ;v._volumeSelectionShape._matrix.setPosition(v._volumeSelectionShape._center);v._volumeSelectionShape._robot.updateRobotFromMatrix(v._volumeSelectionShape._matrix)}v._volumeSelectionShape.refreshAfterManipulation();v._volumeSelectionShape._ruler.value=x.radius;v._volumeSelectionShape._ruler.refresh()}else{v._panel._parameters[w]=false}},_displaySphereHandle:function(w,x,v){var u=this;require(["DS/ENOWebNavVolumeQuery/ENOWebNavSphereHandle"],function(z){if(u._context.name==="ENOPAD3DViewer"){u._context.getRoots().forEach(function(H){var J=u._context.getController().buildPathFromArray([k.getNodeID(H)]);if(J){if(u._sceneGraphOverrideSet){var I=u._sceneGraphOverrideSet.getUniqueOverrideFromPathElement(J);if(!I){I=u._sceneGraphOverrideSet.createOverride(J)}I.setPickability("NOT_PICKABLE");u._context.getViewer().getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(u._sceneGraphOverrideSet)}}})}s.empty();setTimeout(function(){j.empty();u._window.getViewer().render()});var y=new t.Vector3(0,0,0);var D=0;if(w.length==1){var G=w[0].getBoundingSphere().clone();var C=u._selectedObjsPathElt[0].getWorldMatrix();D=v?v:G.radius;if(!x){y.copy(G.center);y.applyMatrix4(C)}else{y.copy(new t.Vector3().getPositionFromMatrix(x))}}else{if(w.length>1){var A=new t.Vector3(0,0,0),E=new t.Vector3(0,0,0);var B=0;w.forEach(function(J){var L=J.getBoundingBox().clone();var I=u._selectedObjsPathElt[B].getWorldMatrix();L.applyMatrix4(I);var K=L.min,H=L.max;if(B===0){A.x=Math.min(K.x,H.x);A.y=Math.min(K.y,H.y);A.z=Math.min(K.z,H.z);E.x=Math.max(K.x,H.x);E.y=Math.max(K.y,H.y);E.z=Math.max(K.z,H.z)}else{A.x=Math.min(Math.min(K.x,H.x),A.x);A.y=Math.min(Math.min(K.y,H.y),A.y);A.z=Math.min(Math.min(K.z,H.z),A.z);E.x=Math.max(Math.max(K.x,H.x),E.x);E.y=Math.max(Math.max(K.y,H.y),E.y);E.z=Math.max(Math.max(K.z,H.z),E.z)}B++});D=Math.sqrt(Math.pow(E.x-A.x,2)+Math.pow(E.y-A.y,2)+Math.pow(E.z-A.z,2))/2;if(x===null||x===undefined){y.add(A).add(E);y.divideScalar(2)}else{y.copy(new t.Vector3().getPositionFromMatrix(x))}}}var F=new t.Matrix4().identity().setPosition(y);u._cleanHandle();u._volumeSelectionShape=new z({center:y,radius:D},u._window,F);u._tokenHandle[0]=u._volumeSelectionShape.subscribe("EndBoxChanged",function(){u._panel.setShapeParameters(u._volumeSelectionShape.getParams());u._displayContextBar()});u._tokenHandle[1]=u._volumeSelectionShape.subscribe("onPreactivate",function(){if(g._isShown===false){u._displayContextBar()}});u._volumeSelectionShape.display();u._panel.setShapeParameters(u._volumeSelectionShape.getParams());if(u._context._filterDrop===true){u._panel.setShapeParameters({center:true,radius:true,filterDrop:true})}})},updateRulerOrigin:function(w,v){var u=this;switch(v){case 0:w.origin=new t.Vector3(w.minX,w.maxY,w.minZ);break;case 1:w.origin=new t.Vector3(w.minX,w.minY,w.minZ);break;case 2:w.origin=new t.Vector3(w.maxX,w.minY,w.minZ);break;case 3:w.origin=new t.Vector3(w.maxX,w.maxY,w.minZ);break;case 4:w.origin=new t.Vector3(w.minX,w.maxY,w.minZ);break;case 5:w.origin=new t.Vector3(w.maxX,w.minY,w.maxZ);break}},updateBox3D:function(A,E,H){var D=this;if(!E){D._panel._minX.maxValue=A.maxX;D._panel._minY.maxValue=A.maxY;D._panel._minZ.maxValue=A.maxZ;D._panel._maxX.minValue=A.minX;D._panel._maxY.minValue=A.minY;D._panel._maxZ.minValue=A.minZ;var u=true;A.origin=null;var I=new t.Vector3(A.minX,A.minY,A.minZ);var y=new t.Vector3(A.maxX,A.minY,A.minZ);var z=new t.Vector3(A.minX,A.maxY,A.minZ);var J=new t.Vector3(A.minX,A.minY,A.maxZ);D._volumeSelectionShape._fstAxis=new t.Vector3(y.x-I.x,y.y-I.y,y.z-I.z);D._volumeSelectionShape._sndAxis=new t.Vector3(z.x-I.x,z.y-I.y,z.z-I.z);D._volumeSelectionShape._thdAxis=new t.Vector3(J.x-I.x,J.y-I.y,J.z-I.z);D._volumeSelectionShape._cornerPoint=I;var w=new t.Matrix4();var C=new t.Vector3().copy(D._volumeSelectionShape._fstAxis).multiplyScalar(0.5);var F=new t.Vector3().copy(D._volumeSelectionShape._sndAxis).multiplyScalar(0.5);var v=new t.Vector3().copy(D._volumeSelectionShape._thdAxis).multiplyScalar(0.5);var B=new t.Vector3().copy(I);B.add(C);B.add(F);B.add(v);w.setPosition(B);var G=D._volumeSelectionShape.getFaceNormal(D._volumeSelectionShape._manipulatedFace);var x=null;if(D._volumeSelectionShape.colinear(G,D._volumeSelectionShape._fstAxis)){x=D._volumeSelectionShape._fstAxis}else{if(D._volumeSelectionShape.colinear(G,D._volumeSelectionShape._sndAxis)){x=D._volumeSelectionShape._sndAxis}else{if(D._volumeSelectionShape.colinear(G,D._volumeSelectionShape._thdAxis)){x=D._volumeSelectionShape._thdAxis}}}if(A.direction=="min"&&D._volumeSelectionShape._manipulatedFace>2){D._volumeSelectionShape._ruler.clear()}else{if(A.direction=="max"&&D._volumeSelectionShape._manipulatedFace<=2){D._volumeSelectionShape._ruler.clear()}}D._volumeSelectionShape._ruler.value=x.length();D._volumeSelectionShape._ruler.direction=G.multiplyScalar(-1);D._volumeSelectionShape._ruler.refresh();D._volumeSelectionShape._robot.updateRobotFromMatrix(w);D._volumeSelectionShape.refreshAfterManipulation()}else{D._panel._parameters[H]=false}},_displayBoxHandle:function(y,z,v,x,u){var w=this;require(["DS/ENOWebNavVolumeQuery/ENOWebNavBoxHandle"],function(P){if(w._context.name==="ENOPAD3DViewer"){w._context.getRoots().forEach(function(S){var U=w._context.getController().buildPathFromArray([k.getNodeID(S)]);if(U){if(w._sceneGraphOverrideSet){var T=w._sceneGraphOverrideSet.getUniqueOverrideFromPathElement(U);if(!T){T=w._sceneGraphOverrideSet.createOverride(U)}T.setPickability("NOT_PICKABLE");w._context.getViewer().getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(w._sceneGraphOverrideSet)}}})}s.empty();setTimeout(function(){j.empty();w._window.getViewer().render()});var F=null;var N=null;var D=null;var Q=null;var O=new t.Matrix4();if(y.length==1){var G=y[0].getBoundingBox().clone();O=w._selectedObjsPathElt[0].getWorldMatrix();F=new t.Vector3(G.min.x,G.min.y,G.min.z);F.applyMatrix4(O);var I=new t.Vector3(G.max.x,G.min.y,G.min.z);I.applyMatrix4(O);var H=new t.Vector3(G.min.x,G.max.y,G.min.z);H.applyMatrix4(O);var C=new t.Vector3(G.min.x,G.min.y,G.max.z);C.applyMatrix4(O);if(!v){N=new t.Vector3(I.x-F.x,I.y-F.y,I.z-F.z)}else{N=new t.Vector3().copy(v);N.setLength(v.length())}if(!x){D=new t.Vector3(H.x-F.x,H.y-F.y,H.z-F.z)}else{D=new t.Vector3().copy(x);D.setLength(x.length())}if(!u){Q=new t.Vector3(C.x-F.x,C.y-F.y,C.z-F.z)}else{Q=new t.Vector3().copy(u);Q.setLength(u.length())}var R=new t.Vector3().copy(N).multiplyScalar(0.5);var K=new t.Vector3().copy(D).multiplyScalar(0.5);var A=new t.Vector3().copy(Q).multiplyScalar(0.5);if(z){O.setPosition(new t.Vector3().getPositionFromMatrix(z));F=new t.Vector3().getPositionFromMatrix(z);F.sub(R);F.sub(K);F.sub(A)}else{var E=new t.Vector3().copy(F);E.add(R);E.add(K);E.add(A);O.setPosition(E)}}else{if(y.length>1){var J=new t.Vector3(0,0,0),L=new t.Vector3(0,0,0),M=0;y.forEach(function(U){var T=U.getBoundingBox().clone();O=w._selectedObjsPathElt[M].getWorldMatrix();T.applyMatrix4(O);var V=T.min,S=T.max;if(M===0){J.x=Math.min(V.x,S.x);J.y=Math.min(V.y,S.y);J.z=Math.min(V.z,S.z);L.x=Math.max(V.x,S.x);L.y=Math.max(V.y,S.y);L.z=Math.max(V.z,S.z)}else{J.x=Math.min(Math.min(V.x,S.x),J.x);J.y=Math.min(Math.min(V.y,S.y),J.y);J.z=Math.min(Math.min(V.z,S.z),J.z);L.x=Math.max(Math.max(V.x,S.x),L.x);L.y=Math.max(Math.max(V.y,S.y),L.y);L.z=Math.max(Math.max(V.z,S.z),L.z)}M++});var B=new t.Matrix4();F=new t.Vector3(J.x,J.y,J.z);F.applyMatrix4(B);var I=new t.Vector3(L.x,J.y,J.z);I.applyMatrix4(B);var H=new t.Vector3(J.x,L.y,J.z);H.applyMatrix4(B);var C=new t.Vector3(J.x,J.y,L.z);C.applyMatrix4(B);N=null;if(!v){N=new t.Vector3(I.x-F.x,I.y-F.y,I.z-F.z)}else{N=new t.Vector3().copy(v);N.setLength(v.length())}D=null;if(!x){D=new t.Vector3(H.x-F.x,H.y-F.y,H.z-F.z)}else{D=new t.Vector3().copy(x);D.setLength(x.length())}Q=null;if(!u){Q=new t.Vector3(C.x-F.x,C.y-F.y,C.z-F.z)}else{Q=new t.Vector3().copy(u);Q.setLength(u.length())}var R=new t.Vector3().copy(N).multiplyScalar(0.5);var K=new t.Vector3().copy(D).multiplyScalar(0.5);var A=new t.Vector3().copy(Q).multiplyScalar(0.5);if(z){B.setPosition(new t.Vector3().getPositionFromMatrix(z));F=new t.Vector3().getPositionFromMatrix(z);F.sub(R);F.sub(K);F.sub(A)}else{var E=new t.Vector3().copy(F);E.add(R);E.add(K);E.add(A);B.setPosition(E)}O=B}}w._cleanHandle();w._volumeSelectionShape=new P({cornerPoint:F,fstAxis:N,sndAxis:D,thdAxis:Q},w._window,O);w._tokenHandle[0]=w._volumeSelectionShape.subscribe("EndBoxChanged",function(){w._panel.setShapeParameters(w._volumeSelectionShape.getParams());w._displayContextBar()});w._tokenHandle[1]=w._volumeSelectionShape.subscribe("onPreactivate",function(){if(g._isShown===false){w._displayContextBar()}});w._volumeSelectionShape.display();w._panel.setShapeParameters(w._volumeSelectionShape.getParams());if(w._context._filterDrop===true){w._panel.setShapeParameters({box:true,filterDrop:true})}})},updateProximity3D:function(y,u,x){var v=this;if(!u){var w={value:y};v._volumeSelectionShape.updateProximityHandleFromRulerValue(w);v._volumeSelectionShape._ruler.value=y;v._volumeSelectionShape._ruler.refresh()}else{v._panel._parameters[x]=false}},_displayProximityHandle:function(v){var u=this;require(["DS/ENOWebNavVolumeQuery/ENOWebNavProximityHandle"],function(A){if(u._context.name==="ENOPAD3DViewer"){u._context.getRoots().forEach(function(C){var E=u._context.getController().buildPathFromArray([k.getNodeID(C)]);if(E){if(u._sceneGraphOverrideSet){var D=u._sceneGraphOverrideSet.getUniqueOverrideFromPathElement(E);if(!D){D=u._sceneGraphOverrideSet.createOverride(E)}D.setPickability("PICKABLE");if(u._selectedObjsPathElt[0]){var F=u._sceneGraphOverrideSet.getUniqueOverrideFromPathElement(u._selectedObjsPathElt[0]);if(!F){F=u._sceneGraphOverrideSet.createOverride(u._selectedObjsPathElt[0])}F.setPickability("PICKABLE")}u._context.getViewer().getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(u._sceneGraphOverrideSet)}}})}if(v.length>0){var B=[],z=[];var x={};var y={version:"1.1",paths:B,attributes:x};j.add({pathElement:u._selectedObjsPathElt[0]});var w=u._selectedObjsPathElt[0].getWorldMatrix();if(k.isAModelPath(u._selectedObjsPathElt[0])){u._context.streamPathWithType(u._selectedObjsPathElt[0],B,x)}if(y.paths.length==1){y.paths.forEach(function(C){u._selectedObjID=C[C.length-1];z.push(u._selectedObjID)})}u._context.getController().getAttributes({ids:z,attributes:["ds6w:label","type_icon_url"],callbacks:{onComplete:function(C){u._panel._startObject.value=C[u._selectedObjID]["ds6w:label"];u._pickCount=0},onFailure:function(){u._pickCount=0;u.displayNotification("badProximitySelection")}}});u._cleanHandle();u._volumeSelectionShape=new A({node:v[0],matrix:w,window:u._window,initPath:u._selectedObjsPathElt[0]});u._tokenHandle[0]=u._volumeSelectionShape.subscribe("EndBoxChanged",function(){u._panel.setShapeParameters(u._volumeSelectionShape.getParams());u._displayContextBar()});u._tokenHandle[1]=u._volumeSelectionShape.subscribe("onPreactivate",function(){if(g._isShown===false){u._displayContextBar()}});u._volumeSelectionShape.display();u._panel.setShapeParameters(u._volumeSelectionShape.getParams())}})},_displayContextBar:function(){},switchVolumeQueryShape:function(v){var z=this;var B=[];z._resetPicking();if(z._volumeSelectionShape){var A=z._volumeSelectionShape.isModifiedByUser;if(v!=="Proximity"&&A){B.push(z._volumeSelectionShape.getBag())}else{for(var x=0;x<z._selectedObjsPathElt.length;x++){B.push(z._selectedObjsPathElt[x].getLastElement(true))}}var w=null;if(z._volumeSelectionShape&&z._volumeType!==2){w=new t.Matrix4().copy(z._volumeSelectionShape._matrix)}z._lockContextBarPosition=true;if(v=="Box"){z._volumeType=0;z._displayBoxHandle(B,w)}else{if(v=="Sphere"){var u=null;if(z._volumeType===0){var y=z._volumeSelectionShape.getParams();u=y.box.max.distanceTo(y.box.min)/2}z._volumeType=1;z._displaySphereHandle(B,w,u)}else{if(v=="Proximity"){z._volumeType=2;z._displayProximityHandle(B)}}}z._volumeSelectionShape.isModifiedByUser=A;z._displayContextBar();z._lockContextBarPosition=false}else{if(v=="Box"){z._volumeType=0}else{if(v=="Sphere"){z._volumeType=1}else{if(v=="Proximity"){z._volumeType=2}}}}},switchVolumeQueryInOutRule:function(u){var v=this;v._lockContextBarPosition=true;if(u=="PartlyIn"){v._intersectionMode=0}else{if(u=="FullIn"){v._intersectionMode=1}else{if(u=="PartlyOut"){v._intersectionMode=2}else{if(u=="FullOut"){v._intersectionMode=3}}}}v._displayContextBar();v._lockContextBarPosition=false},switchFilteringMode:function(u){var v=this;v._lockContextBarPosition=true;if(u){v._selectionMode=1}else{v._selectionMode=0}v._displayContextBar();v._lockContextBarPosition=false},cancelExecute:function(){c.log("ENOWebNavVolumeQueryCmd: cancelExecute");this.displayNotification("cancel")},endExecute:function(){c.log("ENOWebNavVolumeQueryCmd: endExecute");if(this._availableForRole){if(this._context.name==="ENOPAD3DViewer"){this._context.setRobotVisibility(true)}var u=this;u._context.unsubscribe(u._onRemoveCB);this._resetPicking();s.unsubscribe(u.addToCsoCallback);u.addToCsoCallback=null;s.unsubscribe(u.wait4CSOSelection);u.wait4CSOSelection=null;u._cleanHandle();if(this._panel){this._panel.destroy()}p.removeEvent(u._window.getViewer().canvas,"onMouseMove",u._onMouseNotification);delete u._savedBoxFstAxis;delete u._savedBoxSndAxis;delete u._savedBoxThdAxis;delete u._tokenHandle;delete u._mousePosition;delete u._position;delete u._vfId;delete u._setId;delete u._vfDispName;u._context.activateCurrentLayout();u._context.setDefaultContextualBarVisibility(u.defaultContextualBarInitialyDisplayed);u._context.setDefaultContextualMenuVisibility(u.defaultContextualMenuInitialyDisplayed)}}});return c.namespace("DS/ENOWebNavVolumeQuery/ENOWebNavVolumeQueryCmd",l)});define("ENOWebNavVolumeQuery/ENOWebNavVolumeQueryCmd",["DS/ENOWebNavVolumeQuery/ENOWebNavVolumeQueryCmd","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("ENOWebNavVolumeQuery/ENOWebNavVolumeQueryCmd");return b});