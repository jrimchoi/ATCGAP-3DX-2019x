define("DS/CfgRules/scripts/CfgRuleUtility",["DS/WAFData/WAFData"],function(a){var b={createRule:function(d,c,f,g){var e=b.getHostUrl()+"/resources/modeler/model/pid:"+c+"/configurationrule";b.makeWebServiceCall(e,"POST","application/json",d,f,g)},getHostUrl:function(){var c=location.pathname.substring(0,location.pathname.indexOf("/",1));var d=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");var e=d.concat(c);return e},updateRuleExpression:function(f,j,e,h,d,i,g){var k={};k.version=j;k.configurationRule={};k.configurationRule.attributes={};k.configurationRule.attributes.LayoutData={};k.configurationRule.attributes.LayoutData=e;k.configurationRule.mathematicalExpression=h;if(g!="undefined"&&g!=null){k.cloneSharedRuleForObj=g}k=JSON.stringify(k);var c=b.getHostUrl()+"/resources/modeler/configurationrule/pid:"+f;b.makeWebServiceCall(c,"PUT","application/json",k,d,i)},getRule:function(e,f,g){var c="";var d=b.getHostUrl()+"/resources/modeler/configurationrule/pid:"+e+"?attributes=1";b.makeWebServiceCall(d,"GET","application/json",c,f,g)},hasClass:function(d,c){return(" "+d.className+" ").indexOf(" "+c+" ")>-1},makeWebServiceCall:function(c,e,g,j,f,i,h){var m=new Date();var k=m.getTime();if(c.indexOf("?")===-1){c=c+"?timestamp="+k}else{c=c+"&timestamp="+k}h=typeof h!=="undefined"?h:true;var l={};l.method=e;l.async=h;l.timeout=60000;l.type=g;l.headers={Accept:g,"Content-Type":g,};l.data=j;l.onComplete=f;l.onFailure=i;a.handleRequest(c,l)}};return b});define("DS/CfgRules/scripts/dictionaryCfgUtils",["DS/UIKIT/Mask"],function(b){var a={};a.generateFeaturesOfTypeFromJsonMatrixRules=function(f,d,e){if(f===null){return[]}var c=0;var j;var g=[];var h=[];if(e==="driving"){g=f.drivingFeatures}else{if(e==="constrained"){g=f.constrainedFeatures}}for(c=0;c<g.length;c+=1){j=g[c].id;h.push(a.getFeatureInDicoWithLogicalId(j,d))}return h};a.getFeatureInDicoWithId=function(e,d){var c=0;for(c=0;c<d.features.length;c+=1){if(d.features[c].id===e){return d.features[c]}}return null};a.getFeatureIndexInListWithId=function(e,d){var c=0;for(c=0;c<d.length;c+=1){if(d[c].id===e){return c}}return -1};a.isOptionFromFeature=function(g,f,e){var d=0,c=0;for(d=0;d<e.features.length;d+=1){if(e.features[d].id===g){break}}if(d>=e.features.length){return false}for(c=0;c<e.features[d].options.length;c+=1){if(e.features[d].options[c].id===f){return true}}return false};a.getOptionFromId=function(g,e){var f=e.features;var d=0,c=0;for(d=0;d<f.length;d+=1){for(c=0;c<f[d].options.length;c+=1){if(f[d].options[c].id===g){return f[d].options[c]}}}return null};a.getFeatureInDicoWithLogicalId=function(e,d){var c=0;for(c=0;c<d.features.length;c+=1){if(d.features[c].logicalId===e){return d.features[c]}}return null};a.getNbOptionsForFeatureLogicalId=function(e,d){var c=0;for(c=0;c<d.length;c+=1){if(d[c].logicalId===e||d[c].id===e){return d[c].options.length}}return -1};a.getFeatureIndexInListWithLogicalId=function(e,d){var c=0;for(c=0;c<d.length;c+=1){if(d[c].logicalId===e||d[c].id===e){return c}}return -1};a.removeFeatureInListWithLogicalId=function(e,d){var c=a.getFeatureIndexInListWithLogicalId(e,d);if(c!==-1){d.splice(c,1);return 0}return -1};a.getFeatureFromOptionLogicalId=function(f,d){var c=0;var e=d.features;for(c=0;c<e.length;c+=1){if(a.isOptionLogicalIdFromLogicalFeature(f,e[c].logicalId,d)){return e[c]}}return null};a.isOptionLogicalIdFromLogicalFeature=function(f,g,e){var d=0,c=0;for(d=0;d<e.features.length;d+=1){if(e.features[d].logicalId===g){break}}if(d>=e.features.length){return false}for(c=0;c<e.features[d].options.length;c+=1){if(e.features[d].options[c].parentRelLogicalId===f){return true}}return false};a.getOptionFromParentRelLogicaId=function(g,e){var f=e.features;var d=0,c=0;for(d=0;d<f.length;d+=1){for(c=0;c<f[d].options.length;c+=1){if(f[d].options[c].parentRelLogicalId===g){return f[d].options[c]}}}return null};a.hasClass=function(d,c){return(" "+d.className+" ").indexOf(" "+c+" ")>-1};a.maskContainer=function(c){UWA.extendElement(c);b.mask(c)};a.unmaskContainer=function(c){UWA.extendElement(c);b.unmask(c)};a.getRuleFromId=function(f,d){var c=0;var e=f.substring(0,32);if(!d.rules){return null}for(c=0;c<d.rules.length;c+=1){if(d.rules[c].id===e){return d.rules[c]}}return null};a.areCriteriaOfCombinationsInDico=function(f,e){var c={};c._rc=0;c._listIds=[];var d=0;for(d=0;d<f.combinationOptions.length;d+=1){if(a.getOptionFromParentRelLogicaId(f.combinationOptions[d].id,e)==null){c._listIds.push(f.combinationOptions[d].id);c._rc=-1}}return c};return a});define("DS/CfgRules/scripts/traceCfgUtils",[],function(){var b={};b.typeMessage={CRITICAL_ERROR:5,ERROR:4,WARNING:3,INFO:2,DEBUG:1,};var f=true;var c=b.typeMessage.DEBUG;b.critical_error=function(g){if(c<=b.typeMessage.CRITICAL_ERROR){b.log(g,b.typeMessage.CRITICAL_ERROR)}};b.error=function(g){if(c<=b.typeMessage.ERROR){b.log(g,b.typeMessage.ERROR)}};b.warning=function(g){if(c<=b.typeMessage.WARNING){b.log(g,b.typeMessage.WARNING)}};b.info=function(g){if(c<=b.typeMessage.INFO){b.log(g,b.typeMessage.INFO)}};b.debug=function(g){if(c<=b.typeMessage.DEBUG){b.log(g,b.typeMessage.DEBUG)}};b.isDebugEnabled=function(){return f};b.getLevel=function(){return c};b.setLevel=function(g){c=g;b.info("logger at level "+d(g))};b.enable=function(){b.log("enabling LOGGER",b.typeMessage.INFO);f=true};b.disable=function(){b.log("disabling LOGGER",b.typeMessage.WARNING);f=false};b.log=function(g,i){if(!f){return}var h="";h=a(i);switch(i){case b.typeMessage.CRITICAL_ERROR:if(typeof(g)==="string"){console.error(Date.now()+" ----- "+h+" ----- "+g)}else{console.error(Date.now()+" ----- "+h+" ----- ");console.error(g)}break;case b.typeMessage.ERROR:if(typeof(g)==="string"){console.error(Date.now()+" ----- "+h+" ----- "+g)}else{console.error(Date.now()+" ----- "+h+" ----- ");console.error(g)}break;case b.typeMessage.WARNING:if(typeof(g)==="string"){console.warn(Date.now()+" ----- "+h+" ----- "+g)}else{console.warn(Date.now()+" ----- "+h+" ----- ");console.warn(g)}break;case b.typeMessage.INFO:if(typeof(g)==="string"){console.info(Date.now()+" ----- "+h+" ----- "+g)}else{console.info(Date.now()+" ----- "+h+" ----- ");console.info(g)}break;case b.typeMessage.DEBUG:if(typeof(g)==="string"){console.debug(Date.now()+" ----- "+h+" ----- "+g)}else{console.debug(Date.now()+" ----- "+h+" ----- ");console.debug(g)}break}};var e=[];b.getListMessages=function(){return e};b.setListMessages=function(g){e=g};b.pushMessage=function(g){e.push(g)};b.logDebugPurpose=function(g,i){b.log(g,i);var h=" ----- "+a(i)+" ----- "+g;b.pushMessage(h)};b.saveTraces=function(g){};var a=function(h){var g="";switch(h){case b.typeMessage.CRITICAL_ERROR:g="CRIT_ERROR";break;case b.typeMessage.ERROR:g="  ERROR   ";break;case b.typeMessage.WARNING:g="  WARNING ";break;case b.typeMessage.INFO:g="  INFO    ";break;case b.typeMessage.DEBUG:g="  DEBUG   ";break;default:break}return g};var d=function(h){var g="";switch(h){case b.typeMessage.CRITICAL_ERROR:g="CRITICAL_ERROR";break;case b.typeMessage.ERROR:g="ERROR";break;case b.typeMessage.WARNING:g="WARNING";break;case b.typeMessage.INFO:g="INFO";break;case b.typeMessage.DEBUG:g="DEBUG";break;default:break}return g};return b});define("DS/CfgRules/scripts/generateCfgMatrixRulesExpression",["DS/CfgRules/scripts/dictionaryCfgUtils"],function(d){var e={};e.generateBCR=function(k,j,l){var m={};m.rightExpression=e.generateRightExpression(k,j,l);m.defaultExpression=e.generateDefaultExpression(k,j);var i={};i.version=k.version;i.defaultExpression=m.defaultExpression;i.expression=m.rightExpression;var h=JSON.stringify(i);m.fullExpression="MREV1:"+h;return m};e.generateDefaultExpression=function(l,k){var h="";var m="";var i=0;for(i=0;i<l.drivingCombinations.length;i++){h=g(i,l,k);if(h!==""){break}}for(i=i+1;i<l.drivingCombinations.length;i++){m=g(i,l,k);if(m!==""){h=h+" ; "+m}}return h};var g=function(i,n,m){var l=[];var h="";var k=0;for(k=0;k<n.constrainedCombinations.length;k++){if(n.states.charAt(i+k*n.drivingCombinations.length)==="D"){l.push(n.constrainedCombinations[k].combinationOptions[0].id)}}if(l.length!==0){h=l[0]}for(k=1;k<l.length;k++){h=h+" , "+l[k]}if(h!==""){h="( "+h+" )";h="DEFAULT ( "+h+" , ( "+f(n.drivingCombinations[i])+" ) )"}return h};e.generateRightExpression=function(n,m,p){var h="";var l=0;var k="";var o="";var j="";if((n.drivingCombinations.length===0)||(n.constrainedCombinations.length===0)){return""}for(l=0;l<n.drivingCombinations.length;l++){o=f(n.drivingCombinations[l]);if(p){j=b(l,n,m)}else{j=c(l,n,m)}k=a(o,j);if(k!==""){h="( "+k+" )";break}}for(l=l+1;l<n.drivingCombinations.length;l++){o=f(n.drivingCombinations[l]);if(p){j=b(l,n,m)}else{j=c(l,n,m)}k=a(o,j);if(k!==""){h=h+" AND ( "+k+" )"}}return h};var f=function(l){var h="";var j="";var k=0;if(l.combinationOptions.length===0){return""}h=l.combinationOptions[0].id;for(k=1;k<l.combinationOptions.length;k++){h=h+" AND "+l.combinationOptions[k].id}return h};var b=function(k,t,o){var s=[];var v="";var u=t.states;var p="";var n=0,m=0;var r="";var l="";var h=false;var q="";for(m=0;m<t.constrainedCombinations.length;m++){if(u.charAt(k+m*t.drivingCombinations.length)==="N"){q=t.constrainedCombinations[m].combinationOptions[0].id;if(v===""){v="NOT ( "+q+" )"}else{v="NOT ( "+q+" ) AND "+v}}}return v};var c=function(k,s,o){var r=[];var u="";var t=s.states;var p="";var n=0,m=0;var q="";var l="";var h=false;for(m=0;m<s.constrainedFeatures.length;m++){p="";r=[];l=s.constrainedFeatures[m].id;h=false;for(n=0;n<s.constrainedCombinations.length;n++){q=s.constrainedCombinations[n].combinationOptions[0].id;if(d.isOptionFromFeature(l,q,o)){if(t.charAt(k+n*s.drivingCombinations.length)!=="N"){r.push(s.constrainedCombinations[n].combinationOptions[0].id)}else{h=true}}}if(r.length!==0){p=r[0];for(n=1;n<r.length;n++){p=p+" OR "+r[n]}if(p!==""){p=p+" OR NOT ( "+l+" )";if(""===u){u=p}else{u="( "+u+" ) AND ( "+p+" )"}}}else{if(""===u){u="NOT ( "+l+" )"}else{u="( "+u+" ) AND ( NOT ( "+l+" ) )"}}}return u};var a=function(h,i){if(h===""||i===""){return""}return("NOT ( "+h+" ) OR ( "+i+" )")};return e});define("DS/CfgRules/scripts/CfgMatrixRulesWebServices",["UWA/Core","UWA/Data","UWA/Drivers/Alone","UWA/Element","DS/UIKIT/Mask","DS/CfgRules/scripts/traceCfgUtils","i18n!DS/CfgRules/assets/nls/MatrixRule"],function(e,i,f,h,g,l,k){var c={};var b=true;c.getDictionary=function(p,o,r,n){var q=a()+"/resources/modeler/model/pid:"+p+"/configurationdictionary";q+="?features=1";q+="&image=1";q+="&attributes=1";q+="&Rules=1";if(n){q+="&solver=1"}q+="&version=1.1";q+="&random="+Math.random();l.info("url to retrieve Dictionary and Solver : "+q);UWA.Data.request(q,{method:"POST",type:"application/ds-json",async:true,timeout:120000,processData:false,onComplete:function(s){o(s,r)},data:{evolutionCriteria:n},onFailure:function(s){o(s,"error");l.log("failed while getting computeAnswer result ="+s)}})};c.createEvolutionExpressionAsJson=function(r,q,w){var y={};var t=document.createElementNS("urn:com:dassault_systemes:config","CfgFilterExpression");t.setAttribute("xmlns:xs","http://www.w3.org/2001/XMLSchema-instance");t.setAttribute("xmlns","urn:com:dassault_systemes:config");t.setAttribute("xs:schemaLocation","urn:com:dassault_systemes:config CfgFilterExpression.xsd");var x=document.createElementNS("urn:com:dassault_systemes:config","FilterSelection");x.setAttribute("SelectionMode","Strict");var p=document.createElementNS("urn:com:dassault_systemes:config","Context");p.setAttribute("HolderType","Model");p.setAttribute("HolderName",r);var n=document.createElementNS("urn:com:dassault_systemes:config","TreeSeries");n.setAttribute("Type","ProductState");n.setAttribute("Name",r);var v=document.createElementNS("urn:com:dassault_systemes:config","Single");v.setAttribute("Name",q);v.setAttribute("Revision",w);n.appendChild(v);p.appendChild(n);x.appendChild(p);t.appendChild(x);y.filterExpression='<?xml version="1.0" encoding="UTF-8"?>'+t.outerHTML;y=JSON.stringify(y);if(navigator.userAgent.indexOf("Trident")!=-1&&navigator.userAgent.indexOf("MSIE")==-1){var u='<?xml version="1.0" encoding="UTF-8"?><CfgFilterExpression xs:schemaLocation="urn:com:dassault_systemes:config CfgFilterExpression.xsd" xmlns="urn:com:dassault_systemes:config" xmlns:xs="http://www.w3.org/2001/XMLSchema-instance"> <FilterSelection SelectionMode="Strict">';u=u+'<Context HolderName="'+r+'" HolderType="Model">';u=u+'<TreeSeries Name="'+r+'" Type="ProductState">';u=u+'<Single Revision="'+w+'" Name="'+q+'">';u=u+"</Single></TreeSeries></Context></FilterSelection></CfgFilterExpression>";var o='{"filterExpression":';var s='}"';u=JSON.stringify(u);o=o+u+s;return o}else{return y}};c.getObjectIDFromURL=function(q){var p=window.location.search.substring(1);var s="&";var o=p.split(s);if(o.length<=1){s="%26";o=p.split(s)}for(var n=0;n<o.length;n+=1){var r=o[n].split("=");if(r[0]===q){l.debug(q+" : "+r[1]);return decodeURIComponent(r[1])}}return null};c.saveRule=function(t,o,u,n,q){var s=null;if(window.XMLHttpRequest){s=new XMLHttpRequest()}else{s=new ActiveXObject(Microsoft.XMLHTTP)}var p=a()+"/resources/modeler/configurationrule/pid:"+t;s.open("PUT",p,false);var r={};r.version=o;r.configurationRule={};r.configurationRule.attributes={};r.configurationRule.attributes.LayoutData={};r.configurationRule.attributes.LayoutData=u;r.configurationRule.mathematicalExpression=n;if(q!="undefined"&&q!=null){r.cloneSharedRuleForObj=q}r=JSON.stringify(r);s.setRequestHeader("Content-Type","application/ds-json");s.send(r);if(s.status===200&&s.readyState===4){return s.responseText}else{return null}};var a=function(){var n=location.pathname.substring(0,location.pathname.indexOf("/",1));var o=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");var p=o.concat(n);return p};c.createRule=function(q,n){var p=a()+"/resources/modeler/model/pid:"+n+"/configurationrule";var o=m(p,q,"application/ds-json");if(o!==null){return o.configurationRule.id}return null};c.getRule=function(o){var n=a()+"/resources/modeler/configurationrule/pid:"+o+"?attributes=1&random="+Math.random();return j(n)};var j=function(n){var o;if(window.XMLHttpRequest){o=new XMLHttpRequest()}else{o=new ActiveXObject(Microsoft.XMLHTTP)}o.open("GET",n,false);o.send(null);return o.responseText};var d=function(n,r,q){var o=null;var p=null;if(window.XMLHttpRequest){o=new XMLHttpRequest()}else{o=new ActiveXObject(Microsoft.XMLHTTP)}o.open("POST",n,false);o.setRequestHeader("Content-type",q);o.onreadystatechange=function(){if(o.readyState===4&&o.status===200){p=JSON.parse(o.responseText)}else{alert(o.responseText)}};o.send(JSON.stringify(r));return p};c.releaseSolver=function(q){var o=a()+"/resources/cfg/configurator/solver/release";UWA.Data.request(o,{method:"POST",type:null,timeout:5000,aysnc:false,onComplete:p,onFailure:n,data:{solverKey:q}});function p(r){l.info("SolverNode Released")}function n(r){l.error("Failed in Releasing Solver")}};c.setRuleActivationOnSolver=function(q,n,p){var o=a()+"/resources/cfg/configurator/solver/computeAnswer";var r={solverId:p,selectedCriteria:{_from:"matrixRuleWebApp",_to:"solverRule",_data:{ruleId:q,ruleActivation:n},_request:"ruleActivation"}};UWA.Data.request(o,{method:"POST",type:"application/ds-json",async:false,timeout:60000,onComplete:function(s){},onFailure:function(s){l.log("failed while getting computeAnswer result ="+s)},data:{solverId:r.solverId,selectedCriteria:(JSON.stringify(r.selectedCriteria)).replace(/pid:/g,"")}})};c.checkRulesConsistency=function(q,o){var n=a()+"/resources/cfg/configurator/solver/computeAnswer";var p=null;UWA.Data.request(n,{method:"POST",type:"text/html",async:false,timeout:60000,onComplete:function(r){console.log(r);p=r;return r},onFailure:function(r){console.log("failed while getting computeAnswer result ="+r);p=-1;return -1},data:{solverId:o,selectedCriteria:q}});return p};c.activateSolverTraces=function(p,r,o){var n=a()+"/resources/cfg/configurator/solver/computeAnswer";var s=(p)?"yes":"no";var q={_from:"matrixRuleWebApp",_to:"solver",_request:"tracesActivation",_data:{activation:s,path:r,level:"messages"}};UWA.Data.request(n,{method:"POST",type:"application/ds-json",async:false,timeout:60000,onComplete:function(t){},onFailure:function(t){l.error("failed while getting computeAnswer result ="+t)},data:{solverId:o,selectedCriteria:JSON.stringify(q)}})};c.combiSolverOk2=function(q,u,p,o,t,v){var n=a()+"/resources/cfg/configurator/solver/computeAnswer";var r={};var s=null;l.debug("Calling ComputeAnswer to abort solve");s={solverId:u.solverId,selectedCriteria:{_from:u.selectedCriteria._from,_to:"solver",_request:"abortRequest",_data:""}};UWA.Data.request(n,{method:"POST",type:"application/ds-json",async:false,timeout:300000,onComplete:function(w){l.debug("Aborting the SOLVE")},onFailure:function(w){l.error("failed while trying to abort the solver")},data:{solverId:s.solverId,selectedCriteria:(JSON.stringify(s.selectedCriteria))}});l.debug("Calling ComputeAnswer with async param = "+p);UWA.Data.request(n,{method:"POST",type:"application/ds-json",async:p,timeout:300000,onComplete:function(w){r=w;r=JSON.parse(r);if(r._rc!=undefined&&r._rc==="OK"){if(o!=undefined){o.addToolTips(r._data,q);o.setReasonCalculated(true);l.debug("current state calculation finished : "+o.getReasonCalculated())}t(r._data,v);return r._data}else{if(r._rc==="ABORTED"){t(null,"error");l.warning("full solve aborted");return null}else{t(null,"error");l.error("SOLVE failed, returned : ");l.error(r);return null}}},onTimeout:function(){t(null,"error");l.debug("isBeingComputed = "+isBeingComputed)},onFailure:function(w){t(null,"error");l.error("failed while getting computeAnswer result = "+w)},data:{solverId:u.solverId,selectedCriteria:(JSON.stringify(u.selectedCriteria)).replace(/pid:/g,"")}})};var m=function(n,p,r){var s=1500789;var o=null;var q=null;if(window.XMLHttpRequest){o=new XMLHttpRequest()}else{o=new ActiveXObject(Microsoft.XMLHTTP)}o.open("POST",n,false);o.setRequestHeader("Content-type",r);o.onreadystatechange=function(){if(o.readyState===4&&o.status===200){q=JSON.parse(o.responseText)}else{var t=JSON.parse(o.responseText);if(t!=undefined){t=t.errorID;if(t!=undefined&&t===s){alert(k.MR_NON_UNIQUE);return null}}alert(k.MR_ERROR);return null}};o.send(p);return q};return c});define("DS/CfgRules/scripts/selectionCfgMatrixRulesTable",["DS/CfgRules/scripts/dictionaryCfgUtils","DS/CfgRules/scripts/traceCfgUtils"],function(b,d){var a={};a.updateWrappedTableAndJSONFromInteraction=function(g,n,l,h){var m=a.getIdxConstrainedCombinationInJSONFromTd(g,n.getJSONObject(),l);var k=a.getIdxDrivingCombinationInJSONFromTd(g,n.getJSONObject(),l);var f=k+m*n.getDrivingCombinations().length;var i=g.getAttribute("idxstate");if(f!==parseInt(i)){d.error("not the same index in model & in view")}var j=a.updateStateFromInteraction(f,n,h);e(g,j)};a.getIdxConstrainedCombinationInJSONFromTd=function(m,h,l){var f=0;if(b.hasClass(m,"firstline")){f=1}var j=m.parentElement.childNodes[f].getAttribute("idOption");var g=0;for(g=0;g<h.constrainedCombinations.length;g++){if(h.constrainedCombinations[g].combinationOptions[0].id===j){return g}}return undefined};a.getIdxDrivingCombinationInJSONFromTd=function(i,f,g){var h=a.getDrivingCombinationIdsFromTd(i,g);return a.getIdxDrivingCombinationInJSONFromIds(h,f)};a.getDrivingCombinationIdsFromTd=function(f,m){var n=f.getAttribute("nb");var o=[];var k=m.getElementsByTagName("thead")[0];var j=0;var g=0;var h="";var l=0;for(j=0;j<k.childElementCount;j++){g=k.childNodes[j].childNodes[2].getAttribute("originalcolspan");l=Math.floor(n/g);h=k.childNodes[j].childNodes[2+l].getAttribute("idOption");o.push(h)}return o};a.getIdxDrivingCombinationInJSONFromIds=function(h,g){var f=0;for(f=0;f<g.drivingCombinations.length;f++){if(a.isSameCombination(h,g.drivingCombinations[f])){return f}}return undefined};a.isSameCombination=function(m,f){var h=JSON.parse(JSON.stringify(f.combinationOptions));var k=0,g=0;var l=false;if(h.length!==m.length){return false}for(k=0;k<h.length;k++){l=false;for(g=0;g<m.length;g++){if(m[g]==h[k].id){l=true;break}}if(!l){return false}}return true};a.updateStateFromInteraction=function(p,r,n){var g=Math.floor(p/r.getDrivingCombinations().length);var s=r.getConstrainedCombinations()[g].combinationOptions[0].id;var f=b.getFeatureFromOptionLogicalId(s,n);var l=0;var j=[];var o="";var q="";var h=0;var m=f.selectionType;var k=f.id;if(m==="Multiple"){switch(r.getStates().charAt(p)){case"N":o="A";break;case"A":o="D";break;case"D":o="N";break}}else{h=p%r.getDrivingCombinations().length;for(l=0;l<r.getConstrainedCombinations().length;l++){if(l!==g){q=r.getStates().charAt(h+l*r.getDrivingCombinations().length);s=r.getConstrainedCombinations()[l].combinationOptions[0].id;if(b.getFeatureFromOptionLogicalId(s,n).id===k){j.push(q)}}}if(j.indexOf("D")!=-1){o=(r.getStates().charAt(p)==="A")?"N":"A"}else{switch(r.getStates().charAt(p)){case"N":o="A";break;case"A":o="D";break;case"D":o="N";break}}}r.setStates(r.getStates().substr(0,p)+o+r.getStates().substr(p+1));return o};a.updateAllLineWrappedTableAndJSONFromInteraction=function(h,s,p,q,m){var n=0,l=0;var t=null;var g=null;var k=h.getAttribute("idxconstrainedstate");var f=null;var r=null;var o=p.getElementsByTagName("td");if(k==null){d.debug("updateAllLineWrappedTableAndJSONFromInteraction without no index (weird)")}k=k.split(",");for(n=0;n<k.length;n++){f=k[n];for(l=0;l<o.length;l++){if(!b.hasClass(o[l],"tdth")&&!b.hasClass(o[l],"tdth1")&&!b.hasClass(o[l],"displaynone")){r=o[l].getAttribute("idxconstrainedstate");if(f===r){c(o[l],s,m)}}}}};a.updateAllColumnWrappedTableAndJSONFromInteraction=function(h,s,o,p,l){var m=0,k=0;var t=null;var g=null;var q=h.getAttribute("idxdrivingstate");var f=null;var r=null;var n=o.getElementsByTagName("td");if(q==null){d.debug("updateAllLineWrappedTableAndJSONFromInteraction without no index (weird)")}q=q.split(",");for(m=0;m<q.length;m++){f=q[m];for(k=0;k<n.length;k++){if(!b.hasClass(n[k],"tdth")&&!b.hasClass(n[k],"tdth1")){r=n[k].getAttribute("idxdrivingstate");if(f===r){c(n[k],s,l)}}}}};var c=function(l,k,f){var h=parseInt(l.getAttribute("idxstate"));var i=k.getStates()[h];var j=k.getJSONObject().statesValidity[h];var g=null;g=f;k.setStates(k.getStates().substr(0,h)+g+k.getStates().substr(h+1));e(l,g)};a.updateStateFromLeftClickInteraction=function(i,j,g){var h=j.getJSONObject().states[i];var f=null;switch(h){case"S":case"A":case"D":f="N";break;case"N":f="A";break;default:d.error("char "+f+" unexpected in json.states");throw new Error("char unexpected in json.states in updateStateFromLeftClickInteraction")}j.setStates(j.getStates().substr(0,i)+f+j.getStates().substr(i+1));return f};a.updateWrappedTableAndJSONFromLeftClickInteraction=function(k,j,i,g){if(k.getAttribute("editable")==="false"){return}var h=parseInt(k.getAttribute("idxstate"));var f=a.updateStateFromLeftClickInteraction(h,j,g);e(k,f)};a.updateWrappedTableAndJSONFromContextMenuInteraction=function(i,s,q,n,f){if(i.getAttribute("editable")==="false"){return}var g=parseInt(i.getAttribute("idxstate"));var r=parseInt(i.getAttribute("idxconstrainedstate"));var o=parseInt(i.getAttribute("idxdrivingstate"));var h=a.updateStateFromContextMenuInteraction(g,r,o,s,n,f);var l=0;var m=0;var p=q.getElementsByTagName("td");for(l=0;l<h.length;l++){for(m=0;m<p.length;m++){if(parseInt(p[m].getAttribute("idxstate"))===h[l]){if(h[l]===g){e(p[m],f)}else{e(p[m],"A")}break}}}};var e=function(g,f){g.classList.remove("available");g.classList.remove("default");g.classList.remove("nonavailable");g.classList.remove("internal_conflict");g.classList.remove("mr_current_highlight");switch(f){case"S":break;case"A":g.classList.add("available");break;case"N":g.classList.add("nonavailable");break;case"D":g.classList.add("available");g.classList.add("default");break;default:d.error("char "+newChar+" unexpected in interaction");throw new Error("weird new char in updateStateFromContextMenuInteraction")}g.classList.remove("conflict");g.setAttribute("conflict","false");g.setAttribute("internal_conflict","false");if(g.getAttribute("isinvalidatedext")&&f==="D"){g.classList.add("conflict");g.setAttribute("conflict","true")}else{if(g.getAttribute("isrequiredext")&&f==="N"){g.classList.add("conflict");g.setAttribute("conflict","true")}}};a.updateStateFromContextMenuInteraction=function(h,l,q,p,k,f){var g=[];var j=0;var n=0;switch(f){case"S":break;case"A":p.setStates(p.getStates().substr(0,h)+"A"+p.getStates().substr(h+1));break;case"N":p.setStates(p.getStates().substr(0,h)+"N"+p.getStates().substr(h+1));break;case"D":var m=p.getJSONObject();var o=b.getFeatureFromOptionLogicalId(m.constrainedCombinations[l].combinationOptions[0].id,k);if(o.selectionType==="Single"){for(j=0;j<m.constrainedCombinations.length;j++){n=j*m.drivingCombinations.length+q;if(o===b.getFeatureFromOptionLogicalId(m.constrainedCombinations[j].combinationOptions[0].id,k)){if(m.states[n]==="D"){p.setStates(p.getStates().substr(0,n)+"A"+p.getStates().substr(n+1));g.push(n)}}}p.setStates(p.getStates().substr(0,h)+"D"+p.getStates().substr(h+1))}else{p.setStates(p.getStates().substr(0,h)+"D"+p.getStates().substr(h+1))}break;default:d.error("char "+newChar+" unexpected in interaction");throw new Error("weird new char in updateStateFromContextMenuInteraction")}if(g.indexOf(h)<0){g.push(h)}return g};a.updateAllMatrix=function(l,h,k,f){var g=0;var i=h.getElementsByTagName("td");for(g=0;g<i.length;g++){if(!b.hasClass(i[g],"tdth")&&!b.hasClass(i[g],"tdth1")){c(i[g],l,f)}}};return a});define("DS/CfgRules/scripts/CfgMatrixRulesSettings",["DS/CfgRules/scripts/traceCfgUtils","DS/CfgRules/scripts/CfgMatrixRulesWebServices","i18n!DS/CfgRules/assets/nls/MatrixRule"],function(c,b,d){var a=function(){var f=true;var j=null;var k=null;var s=null;var h=null;var g=null;var o=null;var e=null;var n=true;var m=null;var p=null;var r=null;this.getSolverDebugUI=function(){return n};this.setParentDiv=function(t){j=t};this.getImageButton=function(){return g};this.getConflictCheckButton=function(){return e};this.init=function(u,v,t){s=document.createElement("div");s.classList.add("MRsettingsLegend");i();k=document.createElement("div");k.classList.add("MRsettingsContent");l(u,v);n=(window.sessionStorage.DS_MRCookie_DebugActivated==="true")||(window.sessionStorage.DS_MRCookie_DebugActivated===true);if(n){h=document.createElement("div");h.classList.add("MRSolverTracesContent");c.info("using solver traces, check settings to enable/disable it");q(t)}};var q=function(t){p=document.createElement("input");p.setAttribute("type","text");p.setAttribute("name","path_name");p.style.marginLeft="20px";r=document.createElement("button");r.textContent="enable traces";r.style.display="block";r.style.marginLeft="20px";m=true;h.appendChild(p);h.appendChild(r);r.addEventListener("click",function(){b.activateSolverTraces(m,p.value,t);if(m){c.info("enabling traces on solver on path : "+p.value);r.textContent="disable traces";m=false}else{c.info("disabling traces on solver");r.textContent="enable traces";m=true}})};this.draw=function(){j.appendChild(s);j.appendChild(k);if(n){j.appendChild(h)}};var l=function(v,w){var z=document.createElement("span");z.textContent=d.MR_Settings;z.style.paddingLeft="-10px";z.style.backgroundColor="white";var x=document.createElement("h1");x.style.paddingLeft="10px";x.style.marginTop="-10px";x.style.fontSize="15px";x.appendChild(z);k.appendChild(x);var u=document.createElement("div");g=document.createElement("input");g.setAttribute("type","checkbox");g.setAttribute("name","picture");g.style.display="inline-block";g.checked=v;if(v){g.setAttribute("value","true")}else{g.setAttribute("value","false")}var y=document.createElement("p");y.style.display="inline-block";y.style.paddingLeft="5px";y.textContent=d.MR_displayPic;e=document.createElement("input");e.setAttribute("type","checkbox");e.setAttribute("name","internalsolverenable");e.style.display="inline-block";e.checked=w;if(w){e.setAttribute("value","true")}else{e.setAttribute("value","false")}var t=document.createElement("p");t.style.display="inline-block";t.style.paddingLeft="5px";t.textContent=d.MR_CheckInternalConflicts;u.appendChild(y);u.appendChild(g);u.appendChild(document.createElement("br"));u.appendChild(t);u.appendChild(e);u.style.paddingLeft="20px";z.style.marginTop="10px";z.style.backgroundColor="white";u.appendChild(document.createElement("br"));k.appendChild(u)};var i=function(){var y=document.createElement("table");y.classList.add("tableLegend");var w=document.createElement("table");w.classList.add("tableLegend");var x=document.createElement("table");x.classList.add("tableLegend");var F=document.createElement("table");F.classList.add("tableLegend");var t=document.createElement("tr");var C=document.createElement("tr");var B=document.createElement("tr");t.classList.add("MRsettingsLegend");C.classList.add("MRsettingsLegend");B.classList.add("MRsettingsLegend");var u=document.createElement("td");var G=document.createElement("td");var I=document.createElement("td");t.appendChild(u);C.appendChild(G);B.appendChild(I);u.appendChild(w);G.appendChild(x);I.appendChild(F);var v=document.createElement("td");var E=document.createElement("tr");var A=document.createElement("tbody");A.style.height="100%";A.style.paddingLeft="20px";A.style.paddingRight="20px";var z=document.createElement("img");z.classList.add("legendAvailable");v.appendChild(z.cloneNode(true));E.appendChild(v.cloneNode(true));v=document.createElement("td");v.setAttribute("rowspan",2);v.textContent=d.MR_Availability;v.style.paddingLeft="3px";E.appendChild(v.cloneNode(true));A.appendChild(E.cloneNode(true));E=document.createElement("tr");v=document.createElement("td");z=document.createElement("img");z.classList.add("legendNonAvailable");v.appendChild(z.cloneNode(true));E.appendChild(v.cloneNode(true));A.appendChild(E.cloneNode(true));w.appendChild(A.cloneNode(true));v=document.createElement("td");E=document.createElement("tr");A=document.createElement("tbody");A.style.height="100%";A.style.paddingLeft="20px";A.style.paddingRight="20px";E.appendChild(v.cloneNode(true));v=document.createElement("td");z=document.createElement("img");z.setAttribute("src","assets/images/legendExternalRequirement.png");z.classList.add("legendExternalRequirement");v.appendChild(z.cloneNode(true));v.setAttribute("rowspan",2);E.appendChild(v.cloneNode(true));v=document.createElement("td");v.textContent=d.MR_Ext_Req;E.appendChild(v.cloneNode(true));A.appendChild(E.cloneNode(true));E=document.createElement("tr");v=document.createElement("td");v.textContent=d.MR_local_def;E.appendChild(v.cloneNode(true));v=document.createElement("td");E.appendChild(v.cloneNode(true));A.appendChild(E.cloneNode(true));x.appendChild(A.cloneNode(true));v=document.createElement("td");E=document.createElement("tr");A=document.createElement("tbody");A.style.height="100%";A.style.paddingLeft="20px";A.style.paddingRight="20px";z=document.createElement("img");z.classList.add("legendDefault");z.setAttribute("src","assets/images/Default.png");v.appendChild(z.cloneNode(true));E.appendChild(v.cloneNode(true));v=document.createElement("td");v.textContent=d.MR_defaultValue;E.appendChild(v.cloneNode(true));A.appendChild(E.cloneNode(true));F.appendChild(A.cloneNode(true));t.appendChild(u);C.appendChild(G);B.appendChild(I);y.appendChild(t);y.appendChild(C);y.appendChild(B);var H=document.createElement("span");H.textContent=d.MR_legend;H.style.paddingLeft="-10px";H.style.backgroundColor="white";var D=document.createElement("h1");D.style.paddingLeft="10px";D.style.marginTop="-10px";D.style.fontSize="15px";D.appendChild(H);s.appendChild(D);s.appendChild(y)}};return a});define("DS/CfgRules/scripts/generateCfgMatrixRulesXMLExpression",["DS/CfgRules/scripts/dictionaryCfgUtils"],function(d){var i={};var e="1.0.1";i.generateFullExpression=function(l,k){var j=document.createElement("CfgRuleExpression");j.setAttribute("version",e);j.setAttribute("xmlns:xs","http://www.w3.org/2001/XMLSchema-instance");j.setAttribute("xmlns","urn:com:dassault_systemes:config");j.setAttribute("xs:schemaLocation","urn:com:dassault_systemes:config CfgRuleExpression.xsd");var m=i.generateDependencies(l,k);var n=i.generateExpression(l,k);j.appendChild(m);j.appendChild(n);return j};i.generateDependencies=function(n,m){var k=document.createElement("dependencies");var j=[];var l=0;for(l=0;l<n.drivingFeatures.length;l++){j.push(n.drivingFeatures[l])}for(l=0;l<n.constrainedFeatures.length;l++){j.push(n.constrainedFeatures[l])}var o=null;for(l=0;l<j.length;l++){o=h(j[l].id,m);k.appendChild(o.cloneNode(true))}return k};i.generateExpression=function(n,m){var l=0;var k;var o=document.createElement("and");var j=document.createElement("expression");for(l=0;l<n.drivingCombinations.length;l++){k=b(l,n,m);if(k.innerHTML!==""){o.appendChild(k.cloneNode(true))}}if(o.childElementCount>1){j.appendChild(o)}else{if(o.childElementCount===1){j.appendChild(o.firstChild)}}return j};var f=function(n,m,l){var j=document.createElement("if");var p=undefined;var k=0;if(m.drivingCombinations[n].combinationOptions.length>1){p=document.createElement("and");j.appendChild(p)}for(k=0;k<m.drivingCombinations[n].combinationOptions.length;k++){var o=g(m.drivingCombinations[n].combinationOptions[k].id,l);if(p!==undefined){p.appendChild(o.cloneNode(true))}else{j.appendChild(o.cloneNode(true))}}if(p!==undefined){j.appendChild(p)}return j};var c=function(l,s,p){var t=document.createElement("then");var k=null;var r=null;var o=0;var q=0;var m=null;var j=l;var n=null;for(o=0;o<s.constrainedCombinations.length;o++){j=l+o*s.drivingCombinations.length;if(s.states[j]==="N"){q+=1}}if(q>1){m=document.createElement("and")}for(o=0;o<s.constrainedCombinations.length;o++){k=document.createElement("not");j=l+o*s.drivingCombinations.length;if(s.states[j]==="N"){n=s.constrainedCombinations[o].combinationOptions[0].id;r=g(n,p);k.appendChild(r.cloneNode(true));if(q>1){m.appendChild(k.cloneNode(true))}else{t.appendChild(k.cloneNode(true))}}}if(q>1){t.appendChild(m.cloneNode(true))}return t};var a=function(k,r,o){var s=document.createElement("default");var n=0,p=0;var j=0;var l=null;var m=null;var q=null;for(n=0;n<r.constrainedCombinations.length;n++){j=k+n*r.drivingCombinations.length;if(r.states[j]==="D"){p+=1}}if(p>1){l=document.createElement("and")}for(n=0;n<r.constrainedCombinations.length;n++){j=k+n*r.drivingCombinations.length;if(r.states[j]==="D"){m=r.constrainedCombinations[n].combinationOptions[0].id;q=g(m,o);if(p>1){l.appendChild(q.cloneNode(true))}else{s.appendChild(q.cloneNode(true));break}}}if(p>1){s.appendChild(l.cloneNode(true))}return s};var b=function(p,n,m){var o=f(p,n,m);var l=c(p,n,m);var k=a(p,n,m);var j=document.createElement("imply");if(l.innerHTML!==""||k.innerHTML!==""){j.appendChild(o);if(l.innerHTML!==""){j.appendChild(l)}if(k.innerHTML!==""){j.appendChild(k)}}return j};var g=function(n,j){var l=document.createElement("feature");var m=document.createElement("option");var o=d.getFeatureFromOptionLogicalId(n,j);if(o!==null){l.setAttribute("type","type_"+o.type);l.setAttribute("name",o.name);l.setAttribute("revision",o.revision);l.setAttribute("physicalid",o.id);l.setAttribute("logicalid",o.logicalId)}var k=d.getOptionFromParentRelLogicaId(n,j);m.setAttribute("type","type_"+k.type);m.setAttribute("name",k.name);m.setAttribute("physicalid",k.id);if(k.parentRelId){m.setAttribute("relationphysicalid",k.parentRelId)}else{if(k.parentRelPhysicalId){m.setAttribute("relationphysicalid",k.parentRelPhysicalId)}}m.setAttribute("relationlogicalid",k.parentRelLogicalId);l.appendChild(m);return l};var h=function(m,k){var l=document.createElement("feature");var j=d.getFeatureInDicoWithLogicalId(m,k);l.setAttribute("type","type_"+j.type);l.setAttribute("name",j.name);l.setAttribute("revision",j.revision);l.setAttribute("physicalid",j.id);l.setAttribute("logicalid",j.logicalId);return l};return i});define("DS/CfgRules/scripts/generateCfgMatrixRulesWrappedTableObj",["DS/CfgRules/scripts/dictionaryCfgUtils","DS/CfgRules/scripts/traceCfgUtils","i18n!DS/CfgRules/assets/nls/MatrixRule"],function(a,b,c){var d=function(){var q=null;var i=null;var n=null;var h=null;var g=null;var j=null;var e=null;var l=null;var f=true;var r=null;var p=false;this.setReasonCalculated=function(t){p=t};this.getReasonCalculated=function(){return p};this.getTopLeftTable=function(){return q};this.getTopRightTable=function(){return i};this.getBotLeftTable=function(){return n};this.getBotRightTable=function(){return h};this.getId=function(){return r};this.getTopLeftDiv=function(){return g};this.getTopRightDiv=function(){return j};this.getBotLeftDiv=function(){return e};this.getBotRightDiv=function(){return l};this.init=function(w,u){r=w;q=document.createElement("table");q.setAttribute("id",r+"-top-left-table");q.classList.add("wrapped-table");q.classList.add("top-left-table");i=document.createElement("table");i.setAttribute("id",r+"-top-right-table");i.classList.add("wrapped-table");i.classList.add("top-right-table");n=document.createElement("table");n.setAttribute("id",r+"-bot-left-table");n.classList.add("wrapped-table");n.classList.add("bot-left-table");h=document.createElement("table");h.setAttribute("id",r+"-bot-right-table");h.classList.add("wrapped-table");h.classList.add("bot-right-table");g=document.createElement("div");g.appendChild(q);g.setAttribute("id",r+"-top-left-div");g.classList.add("top-left-div");g.classList.add("close");j=document.createElement("div");j.appendChild(i);j.setAttribute("id",r+"-top-right-div");j.classList.add("top-right-div");j.classList.add("close");e=document.createElement("div");e.appendChild(n);e.setAttribute("id",r+"-bot-left-div");e.classList.add("bot-left-div");e.classList.add("close");if(navigator.userAgent&&navigator.userAgent.contains("Firefox")||navigator.userAgent.contains("Edge")||navigator.userAgent.contains("Trident")){e.classList.add("firefoxscroll")}l=document.createElement("div");l.appendChild(h);l.setAttribute("id",r+"-bot-right-div");l.classList.add("bot-right-div");l.classList.add("close");if(navigator.userAgent&&navigator.userAgent.contains("Firefox")||navigator.userAgent.contains("Edge")||navigator.userAgent.contains("Trident")){l.classList.add("firefoxscroll")}if(!u){l.classList.add("withoutpicture");e.classList.add("withoutpicture");j.classList.add("withoutpicture");g.classList.add("withoutpicture")}var v=function(){e.scrollTop=l.scrollTop;j.scrollLeft=l.scrollLeft};var t=function(){g.scrollTop=j.scrollTop;l.scrollLeft=j.scrollLeft};b.debug("adding scroll event on divBotRight for "+r);l.addEventListener("scroll",v);j.addEventListener("scroll",t)};this.loadTableIn=function(t){m(t);o(t);s(t);k(t)};this.generateAllTables=function(t){r=t.getTable().getAttribute("id");m(t);o(t);s(t);k(t)};this.drawInDiv=function(t){t.appendChild(g);t.appendChild(j);t.appendChild(e);t.appendChild(l)};this.drawTopIn=function(t){t.appendChild(g);t.appendChild(j)};this.drawBotIn=function(t){t.appendChild(e);t.appendChild(l)};var m=function(A){var z=A.getTable().getElementsByTagName("thead")[0];var w=0,u=0;var v=document.createElement("tbody");var y;var x=document.createElement("th");var t;for(w=0;w<z.childElementCount;w+=1){y=document.createElement("tr");for(u=0;u<=1;u+=1){t=(z.childNodes[w]).childNodes[u];x=t.cloneNode(true);y.appendChild(x)}v.appendChild(y)}q.appendChild(v)};var o=function(A){var z=A.getTable().getElementsByTagName("thead")[0];var w=0,u=0;var v=document.createElement("tbody");var y;var x=document.createElement("th");var t;for(w=0;w<z.childElementCount;w+=1){y=document.createElement("tr");for(u=2;u<z.childNodes[w].childElementCount;u+=1){t=(z.childNodes[w]).childNodes[u];x=t.cloneNode(true);y.appendChild(x)}v.appendChild(y)}i.appendChild(v)};var k=function(A){var t=A.getTable().getElementsByTagName("tbody")[0];var x=0,w=0;var y=document.createElement("tbody");var z;var v=document.createElement("td");var u;var B=1;for(x=0;x<t.childElementCount;x+=1){z=document.createElement("tr");if(a.hasClass(t.childNodes[x].childNodes[1],"firstline")){B=1}else{B=0}for(w=0;w<=B;w+=1){u=(t.childNodes[x]).childNodes[w];v=u.cloneNode(true);z.appendChild(v)}y.appendChild(z)}n.appendChild(y)};var s=function(C){var u=C.getTable().getElementsByTagName("tbody")[0];var v=C.getTable().getElementsByTagName("thead")[0];var y=0,x=0;var z=document.createElement("tbody");var B;var w=document.createElement("td");var t;var A=1;for(y=0;y<u.childElementCount;y+=1){B=document.createElement("tr");if(a.hasClass(u.childNodes[y].childNodes[1],"firstline")){A=2}else{A=1}for(x=0;x<A;x+=1){t=(u.childNodes[y]).childNodes[x];w=document.createElement("td");w=t.cloneNode(true);w.classList.add("invisible_td");B.appendChild(w)}for(x=A;x<u.childNodes[y].childElementCount;x+=1){t=(u.childNodes[y]).childNodes[x];w=t.cloneNode(true);B.appendChild(w)}z.appendChild(B)}v.classList.add("invisible_header");h.appendChild(v);h.appendChild(z)};this.addToolTips=function(x,C){var w=true;if(w){var u=new Date().getTime()}b.info("adding tooltips on matrix");var E=h.getElementsByTagName("td");var B=0,A=0,z=0;var G="";var D=0;var t=null;var F=null;for(B=0;B<x.statesCausingRules.length;B+=1){t=x.statesValidity[B];if(t==="I"||t==="R"||t==="E"||t==="T"){for(A=0;A<E.length;A+=1){D=E[A].getAttribute("idxstate");if(D==B){G="";if(x.statesCausingRules[B].length===0){G=c.MR_UnkReason}for(z=0;z<x.statesCausingRules[B].length;z+=1){if(z>0){G+=", "}if(a.getRuleFromId(x.statesCausingRules[B][z],C)){G+=a.getRuleFromId(x.statesCausingRules[B][z],C).name}else{G+=x.statesCausingRules[B][z]}}if(t==="I"||t==="T"){E[A].setAttribute("title",c.MR_Invalid_Comb+G)}else{E[A].setAttribute("title",c.MR_Req_Comb+G)}break}}}}if(w){var y=new Date().getTime();var v=y-u;b.debug("Execution time for adding tooltips : "+v)}}};return d});define("DS/CfgRules/scripts/generateCfgMatrixRulesTableObj",["DS/CfgRules/scripts/dictionaryCfgUtils","DS/CfgRules/scripts/traceCfgUtils","DS/CfgRules/scripts/selectionCfgMatrixRulesTable","i18n!DS/CfgRules/assets/nls/MatrixRule"],function(a,c,b,d){var e=function(){var p=null;var o=null;var t=null;var v="assets/images/no_image.png";var j=23;var i=10;var A=9;var l=true;this.getTable=function(){return p};var g=function(E,J,H){var G=z(o);p.appendChild(G);var I=1;var F=C(E,I,p,H);r(J,F,p,H)};var C=function(E,N,L,J){var F=document.createElement("thead");var I=document.createElement("thead");var G=0;var M=1;var H=1;for(G=0;G<E.length;G++){H*=E[G].options.length}var K=H;for(G=E.length-1;G>=0;G--){H/=E[G].options.length;F.appendChild(y(E[G],H,M,N,J));M*=E[G].options.length}F.childNodes[0].classList.add("lastline");for(G=F.childElementCount-1;G>=0;G--){I.appendChild(F.childNodes[G])}L.appendChild(I);return K};var z=function(F){var E=document.createElement("caption");E.innerHTML=F;return E};var y=function(U,H,R,E,T){var F=document.createElement("tr");var V=document.createElement("th");var P=document.createElement("th");var L=document.createElement("th");var G=U.options.length;var S=0,Q=0;V.classList.add("invisible_but_hidden");var M=document.createElement("div");V.appendChild(M);if(!T){V.classList.add("withoutpicture")}for(S=0;S<E;S++){F.appendChild(V.cloneNode(true))}if(U.displayValue.length>j){var O=U.displayValue.substring(0,i);O=O+"...";O=O+U.displayValue.substring(U.displayValue.length-1-A)}else{O=U.displayValue}var K=document.createElement("div");var J=document.createElement("img");J.classList.add("cellimage");var N=document.createElement("div");if(U.image===""||U.image==undefined){J.setAttribute("src",v)}else{J.setAttribute("src",U.image)}if(T){J.classList.remove("hidden")}else{J.classList.add("hidden")}N.textContent=O;N.classList.add("worldwrap_as_breakword");K.appendChild(J);K.appendChild(N);P.appendChild(K.cloneNode(true));P.setAttribute("title",U.displayValue);P.setAttribute("idfeature",U.logicalId);P.classList.add("lastline");P.classList.add("featureName");P.classList.add("drivingFeature");P.classList.add("draggableitem");P.setAttribute("container","drivingFeatureContainer");P.setAttribute("featuretype","driving");P.setAttribute("draggable",true);if(!T){P.classList.add("withoutpicture")}F.appendChild(P.cloneNode(true));for(S=0;S<H;S++){for(Q=0;Q<G;Q++){L=document.createElement("th");L.setAttribute("colspan",R);L.setAttribute("originalcolspan",R);L.classList.add("optionName");L.classList.add("drivingOption");L.classList.add("lastline");if(!T){L.classList.add("withoutpicture")}var I;if(U.options[Q].displayValue.length>j*R){var I=U.options[Q].displayValue.substring(0,i*R);I=I+"...";I=I+U.options[Q].displayValue.substring(U.options[Q].displayValue.length-1-A*R)}else{I=U.options[Q].displayValue}K=document.createElement("div");J=document.createElement("img");J.classList.add("cellimage");var N=document.createElement("div");if(U.options[Q].image===""||U.options[Q].image==undefined){J.setAttribute("src",v)}else{J.setAttribute("src",U.options[Q].image)}if(T){J.classList.remove("hidden")}else{J.classList.add("hidden")}I=w(I);N.innerHTML=I;N.classList.add("worldwrap_as_breakword");K.appendChild(J);K.appendChild(N);L.appendChild(K.cloneNode(true));L.setAttribute("title",U.options[Q].displayValue);L.setAttribute("idfeature",U.logicalId);L.setAttribute("idOption",U.options[Q].parentRelLogicalId);F.appendChild(L.cloneNode(true))}}return F};var D=function(L,J,R,N,Q){var I=0,H=0;var P=document.createElement("tr");var G=document.createElement("td");var O=L.options.length;if(O===0){return -1}if(N){var F;if(L.displayValue.length>j*O){var F=L.displayValue.substring(0,i*O);F=F+"...";F=F+L.displayValue.substring(L.displayValue.length-1-O*A)}else{F=L.displayValue}G.setAttribute("rowspan",O);var K=document.createElement("div");var E=document.createElement("img");E.classList.add("cellimage");var M=document.createElement("div");if(L.image===""||L.image==undefined){E.setAttribute("src",v)}else{E.setAttribute("src",L.image)}if(Q){E.classList.remove("hidden")}else{E.classList.add("hidden")}F=w(F);M.innerHTML=F;M.classList.add("worldwrap_as_breakword");K.appendChild(E);K.appendChild(M);G.appendChild(K.cloneNode(true));G.setAttribute("title",L.displayValue);G.setAttribute("idfeature",L.logicalId);G.setAttribute("container","constrainedFeatureContainer");G.setAttribute("featuretype","constrained");G.classList.add("featureName");G.classList.add("constrainedFeature");G.classList.add("draggableitem");G.classList.add("firstline");G.classList.add("lastline");G.classList.add("tdth");if(!Q){G.classList.add("withoutpicture")}G.setAttribute("draggable",true);P.appendChild(G.cloneNode(true));G=document.createElement("td");G.classList.add("tdth1");G.setAttribute("idfeature",L.logicalId);if(L.options[0].displayValue.length>j){var F=L.options[0].displayValue.substring(0,i);F=F+"...";F=F+L.options[0].displayValue.substring(L.options[0].displayValue.length-1-A)}else{F=L.options[0].displayValue}K=document.createElement("div");E=document.createElement("img");E.classList.add("cellimage");var M=document.createElement("div");if(L.options[0].image===""||L.options[0].image==undefined){E.setAttribute("src",v)}else{E.setAttribute("src",L.options[0].image)}if(Q){E.classList.remove("hidden")}else{E.classList.add("hidden")}F=w(F);M.innerHTML=F;M.classList.add("worldwrap_as_breakword");K.appendChild(E);K.appendChild(M);G.appendChild(K.cloneNode(true));G.setAttribute("title",L.options[0].displayValue);G.setAttribute("idOption",L.options[0].parentRelLogicalId);G.classList.add("optionName");G.classList.add("constrainedOption");G.classList.add("firstline");if(!Q){G.classList.add("withoutpicture")}P.appendChild(G.cloneNode(true));G=document.createElement("td");G.classList.add("firstline");for(I=0;I<J;I++){G.setAttribute("nb",I);if(!Q){G.classList.add("withoutpicture")}P.appendChild(G.cloneNode(true))}R.appendChild(P.cloneNode(true));G=document.createElement("td");for(H=1;H<O;H++){G=document.createElement("td");P=document.createElement("tr");if(H===O-1){G.classList.add("lastline")}G.classList.add("tdth");G.setAttribute("idfeature",L.logicalId);if(L.options[H].displayValue.length>j){var F=L.options[H].displayValue.substring(0,i);F=F+"...";F=F+L.options[H].displayValue.substring(L.options[H].displayValue.length-1-A)}else{F=L.options[H].displayValue}K=document.createElement("div");E=document.createElement("img");E.classList.add("cellimage");M=document.createElement("div");if(L.options[H].image===""||L.options[H].image==undefined){E.setAttribute("src",v)}else{E.setAttribute("src",L.options[H].image)}if(Q){E.classList.remove("hidden")}else{E.classList.add("hidden")}F=w(F);M.innerHTML=F;M.classList.add("worldwrap_as_breakword");K.appendChild(E);K.appendChild(M);G.appendChild(K.cloneNode(true));G.setAttribute("title",L.options[H].displayValue);G.setAttribute("idfeature",L.logicalId);G.setAttribute("idOption",L.options[H].parentRelLogicalId);if(!Q){G.classList.add("withoutpicture")}G.classList.add("optionName");G.classList.add("constrainedOption");G.classList.add("tdth1");P.appendChild(G.cloneNode(true));G=document.createElement("td");for(I=0;I<J;I++){G.setAttribute("nb",I);if(!Q){G.classList.add("withoutpicture")}if(H===O-1){G.classList.add("lastline")}P.appendChild(G.cloneNode(true))}R.appendChild(P.cloneNode(true))}}};var r=function(I,J,G,H){var E=document.createElement("tbody");var F=0;for(F=0;F<I.length;F++){D(I[F],J,E,true,H)}G.appendChild(E)};var u=function(H,Y,N,P){var U=0,T=0;var E=0,K=0;var J=Y.getDrivingCombinations();var Q=Y.getConstrainedCombinations();var I=Y.getStates();var O=Y.getStatesValidity();var G=H.getTable().getElementsByTagName("tbody")[0].getElementsByTagName("tr");var X=undefined;var L="";var W="";var M="";var V=null;var F=null;var S=J.length;var R=Q.length;for(U=0,V=J.length;U<V;U++){K=U+2;for(T=0,F=Q.length;T<F;T++){E=T;if(K!==undefined&&E!==undefined){if(!a.hasClass(G[E].childNodes[1],"firstline")){X=G[E].childNodes[K-1]}else{X=G[E].childNodes[K]}L=m(I,T,U,S);W=m(O,T,U,S);M=Y.getStatesCausingRules()[T*S+U];H.updateSingleTdFromCorrespondingStatesInJson(X,L,W,M)}}}};var B=function(I,G,J){var F=I.getElementsByTagName("tbody")[0];var H=0;var E=F.childElementCount;var K=undefined;for(H=0;H<E;H++){K=F.childNodes[H];if(h(K,G)){return H}}return undefined};var h=function(G,E){var F=0;for(F=0;F<2;F++){if(a.hasClass(G.childNodes[F],"constrainedOption")){if(G.childNodes[F].getAttribute("idOption")===E.combinationOptions[0].id){return true}}}return false};var k=function(Q,L,E){var O=-1;var N=0,R=0,I=0,H=0;var G=Q.getElementsByTagName("thead")[0];var K=JSON.parse(JSON.stringify(L));R=G.childNodes[H].childElementCount-1;var J=null;var M=null;var F=K.length;var P=K.combinationOptions;for(H=0,J=G.childElementCount;H<J;H++){for(I=0,M=K.combinationOptions.length;I<M;I++){O=x(N,R,G.childNodes[H],P[I].id);if(O!=-1){P.splice(I,1);if(P.length!==0){N=(O-2)*a.getNbOptionsForFeatureLogicalId(G.childNodes[H+1].childNodes[1].getAttribute("idfeature"),E)+2;R=N+(a.getNbOptionsForFeatureLogicalId(G.childNodes[H+1].childNodes[1].getAttribute("idfeature"),E)-1)}break}else{if(I===F-1){return undefined}}}}if(P.length!==0){O=undefined}return O};var x=function(I,G,H,F){var E=0;for(E=I;E<=G;E++){if(H.childNodes[E].getAttribute("idOption")===F){return E}}return -1};this.createTableFromJSON=function(M,H,L,I){var G=a.generateFeaturesOfTypeFromJsonMatrixRules(M.getJSONObject(),H,"driving");var K=a.generateFeaturesOfTypeFromJsonMatrixRules(M.getJSONObject(),H,"constrained");if(window.localStorage.DS_Debug_MatrixRule_Performance){var J=performance.now()}g(G,K,L);if(window.localStorage.DS_Debug_MatrixRule_Performance){var F=performance.now()}u(this,M,G,K);if(window.localStorage.DS_Debug_MatrixRule_Performance){var E=performance.now()}q(M,H,I);if(window.localStorage.DS_Debug_MatrixRule_Performance){var N=performance.now();console.log("----- Generate Table Timer----");console.log("---- total UI time = "+(N-J)+" ms");console.log("----- generate empty table time = "+(F-J)+" ms");console.log("----- loadjson in table time = "+(E-F)+" ms");console.log("----- post process table time = "+(N-E)+" ms");console.log("---------------------------------")}};this.init=function(E,F){p=document.createElement("table");p.setAttribute("id",E);p.setAttribute("cellspacing","0");o=F};this.reset=function(){p=document.createElement("table");p.setAttribute("id",t);p.setAttribute("cellspacing","0")};var m=function m(H,G,F,E){return H.charAt(G*E+F)};var n=function n(F,E){F.classList.remove("available");F.classList.remove("default");F.classList.remove("nonavailable");switch(E){case"_":case"N":F.classList.add("nonavailable");break;case"D":F.classList.add("available");F.classList.add("default");break;case"A":F.classList.add("available");break;default:c.warning("char unexpected in jsonStates : "+E);break}};var f=function(E,H,I){E.classList.remove("invalidated");E.classList.remove("required");var F=0;var G="";switch(H){case"R":case"E":E.classList.add("required");E.setAttribute("isrequiredext",true);for(F=0;F<I.length;F++){if(F>0){G+=", "}G+=I[F]}E.setAttribute("title",d.MR_Req_Comb+d.MR_Undercomputation);break;case"I":case"T":E.setAttribute("isinvalidatedext",true);E.classList.add("invalidated");for(F=0;F<I.length;F++){if(F>0){G+=", "}G+=I[F]}E.setAttribute("title",d.MR_Invalid_Comb+d.MR_Undercomputation);break;case"V":break;case"U":case"A":case"C":break;default:c.warning("char unexpected in jsonValidityStates : "+newChar);break}};var s=function(E,F,G){E.classList.add("showconflict");E.classList.remove("conflict");E.setAttribute("conflict",false);if(((F==="N")&&((G==="R")||(G==="E")))){E.classList.add("conflict");E.setAttribute("conflict",true)}if((F==="D")&&((G==="I")||(G==="T"))){E.classList.add("conflict");E.setAttribute("conflict",true)}};this.updateSingleTdFromCorrespondingStatesInJson=function(E,F,G,H){n(E,F);f(E,G,H);s(E,F,G)};var q=function(ah,O,H){var ac=p;var ab=ah.getJSONSimplifiedObject();var E=ac.childNodes[2];var Y=0,X=0,W=0;var L=0;var ae=0;var R=0,N=0;var I=null;var G=null;var P=null;var aa=ab.drivingCombinations.length;var Z=ac.childNodes[1];var M=[];var G=E.childNodes[0];var Q=0;for(Y=2;Y<G.childElementCount;Y++){Q=b.getIdxDrivingCombinationInJSONFromTd(G.childNodes[Y],ab,ac);M.push(Q)}for(Y=Z.childElementCount-1;Y>=0;Y--){var V=Z.childNodes[Y].childNodes[2].getAttribute("originalcolspan");for(W=2;W<Z.childNodes[Y].childElementCount;W++){I=null;for(X=0;X<V;X++){if(I!==null){I=I+","+M[(W-2)*V+X]}else{I=M[(W-2)*V+X]}}Z.childNodes[Y].childNodes[W].setAttribute("idxdrivingstate",I)}}var ag=null;for(Y=0;Y<E.childElementCount;Y++){G=E.childNodes[Y];ae=1;if(a.hasClass(G.childNodes[0],"firstline")){ae=2;ag=G.childNodes[0]}R=b.getIdxConstrainedCombinationInJSONFromTd(G.childNodes[ae],ab,ac);G.childNodes[ae-1].setAttribute("idxconstrainedstate",R);if(ag.getAttribute("idxconstrainedstate")!==null){ag.setAttribute("idxconstrainedstate",ag.getAttribute("idxconstrainedstate")+","+R)}else{ag.setAttribute("idxconstrainedstate",R)}for(X=ae;X<G.childElementCount;X++){N=M[X-ae];L=N+R*aa;G.childNodes[X].setAttribute("idxstate",L);G.childNodes[X].setAttribute("idxconstrainedstate",R);G.childNodes[X].setAttribute("idxdrivingstate",N)}}var K=null;var U=0;var F=-1;var J=[];var S=ah.getJSONObject().drivingCombinationsValidity.length;G=null;W=0;var ai=false;var ad=true;var af=false;if(ah.getJSONObject().statesValidity!=undefined&&ah.getJSONObject().drivingCombinationsValidity!=undefined){for(Y=0;Y<ah.getJSONObject().drivingCombinationsValidity.length;Y+=1){if(ah.getJSONObject().drivingCombinationsValidity[Y]==="I"){ad=true}else{ad=false;break}}if(ad&&Y>=ah.getJSONObject().drivingCombinationsValidity.length){c.warning("all columns are invalid");return}}if(ah.getJSONObject().statesValidity!=undefined&&ah.getJSONObject().drivingCombinationsValidity!=undefined){for(Y=0;Y<ah.getJSONObject().drivingCombinationsValidity.length;Y+=1){if(ah.getJSONObject().drivingCombinationsValidity[Y]==="I"){ai=true;for(X=0;X<ah.getJSONObject().constrainedCombinations.length;X+=1){if(H){ai=true;break}else{if(ah.getJSONObject().states[Y+X*S]!=="A"){ai=false;break}}}if(ai){F=k(ac,ah.getJSONObject().drivingCombinations[Y],O.features);for(X=0;X<Z.childElementCount;X+=1){K=Z.childNodes[X];U=2;for(W=2;W<K.childElementCount;W+=1){U+=parseInt(K.childNodes[W].getAttribute("originalcolspan"));if(U>F){K.childNodes[W].setAttribute("colspan",parseInt(K.childNodes[W].getAttribute("colspan"))-1);if(parseInt(K.childNodes[W].getAttribute("colspan"))===0){K.childNodes[W].classList.add("displaynone")}break}}}for(X=0;X<E.childElementCount;X+=1){G=E.childNodes[X];var T=0;if(a.hasClass(G.childNodes[0],"firstline")){T=0}else{T=-1}G.childNodes[F+T].classList.add("displaynone")}}}}}};var w=function(K){var N="";var J=true;var H=0;var M=10+3;var E=4;var L,I;while(J){var G=K.substr(H,M);if(G.length<M){N+=G;J=false;return N}var F=G.substr(G.length-E,E);L=F.indexOf(" ");I=F.indexOf("...");if(I>=0){N+=G.substr(0,M-I+1)+"<br>";H=H+M-I+1}else{if(L>0){N+=G.substr(0,M-L+1)+"<br>";H=H+M-L+1}else{N+=G+"<br>";H+=M}}}}};return e});define("DS/CfgRules/scripts/generateCfgMatrixRulesJSONObj",["DS/CfgRules/scripts/dictionaryCfgUtils","DS/CfgRules/scripts/traceCfgUtils","DS/CfgRules/scripts/CfgMatrixRulesWebServices","DS/UIKIT/Mask","UWA/Core","UWA/Element","UWA/Drivers/Alone"],function(f,d,c,h,e,a,g){var b=function(){var i=null;var B="1.0.1";var l=null;var t=null;var z=null;var v=null;var D=null;var x=null;var m=null;var o=null;var q=null;var r=null;var y=null;var s=this;var n=1;this.getNumberColumns=function(){return n};this.setNumberColumns=function(H){n=H};this.getDrivingFeatures=function(){return t};this.getConstrainedFeatures=function(){return z};this.getDrivingCombinations=function(){return v};this.getConstrainedCombinations=function(){return D};this.getStates=function(){return x};this.setStates=function(H){x=H};this.getStatesValidity=function(){return m};this.getDrivingCombinationsValidity=function(){return o};this.getUIDrivingOrder=function(){return q};this.setUIDrivingOrder=function(H){q=H};this.getUIConstrainedOrder=function(){return r};this.setUIConstrainedOrder=function(H){r=H};this.getStatesCausingRules=function(){return y};this.getId=function(){return i};this.init=function(H){i=H;l=[];t=[];z=[];v=[];D=[];x="";m="";o="";q=[];r=[];y=[]};this.getJSONObject=function(){var H={};H.constrainedCombinations=D;H.drivingCombinations=v;H.states=x;H.drivingFeatures=t;H.constrainedFeatures=z;H.statesValidity=m;H.drivingCombinationsValidity=o;H.statesCausingRules=y;H.version=B;return H};this.getJSONSimplifiedObject=function(){var H={};H.constrainedCombinations=D;H.drivingCombinations=v;H.states=x;H.drivingFeatures=t;H.constrainedFeatures=z;H.version=B;return H};this.createEmptyFromFeatures=function(J,I){var H=0;n=0;t=p(J);z=p(I);J.reverse();v=A(J);D=[];for(H=0;H<I.length;H+=1){D=D.concat(A([I[H]]))}x=C(v.length,D.length);m=C(v.length,D.length);o=C(v.length,1);for(H=0;H<t.length;H+=1){q.push(H)}for(H=0;H<z.length;H+=1){r.push(H)}if(J.length>0){n=1;for(H=0;H<J.length;H+=1){n=n*J[H].options.length}}return this.getJSONObject()};this.loadJsonIn=function(K){if(K===null){return}var J=0,I=0;var H=undefined;var L=undefined;var M=undefined;for(J=0;J<K.constrainedCombinations.length;J+=1){for(I=0;I<K.drivingCombinations.length;I+=1){L=I+J*K.drivingCombinations.length;M=K.states.charAt(L);H=F(K.drivingCombinations[I].combinationOptions,K.constrainedCombinations[J].combinationOptions,this.getJSONObject());if(H===undefined||H===-1){d.warning("could not find a combination in the given JSON")}else{x=x.substr(0,H)+M+x.substr(H+1)}}}};this.addDrivingFeature=function(O,T){var P=x;var N=JSON.parse(JSON.stringify(v));var V=N.length;var J=D.length;var S=f.getFeatureInDicoWithId(O,T);if(S==null){S=f.getFeatureInDicoWithLogicalId(O,T)}if(S==null){return null}t.push({id:S.logicalId});var Q=[];for(var M=0;M<t.length;M+=1){Q.push(f.getFeatureInDicoWithLogicalId(t[M].id,T))}Q.reverse();v=A(Q);var R=S.options.length;x="";var M=0,L=0,K=0;for(M=0;M<J;M+=1){var I=P.substr(M*V,V);var U="";for(L=0;L<I.length;L+=1){var H=I[L];for(K=0;K<R;K+=1){x+=H}}}m="";for(var M=0;M<x.length;M+=1){m+="V"}o="";for(var M=0;M<v.length;M+=1){o+="V"}};this.addConstrainedFeature=function(L,M,S,Z,P,R,T,H,O,N){var J=true;var X=0,W=0,V=0;var I={};I.id=M.logicalId;z.push(JSON.parse(JSON.stringify(I)));for(X=0;X<M.options.length;X+=1){I={};I.combinationOptions=[];I.combinationOptions.push({id:M.options[X].parentRelLogicalId});D.push(JSON.parse(JSON.stringify(I)));for(W=0;W<v.length;W+=1){x+="?"}}if(Z!==null&&Z!==undefined){d.debug("solve for new feature");var Y={};if(T){if(H){Y.buildtimeCheck="validityWithCause"}else{Y.buildtimeCheck="validity"}}else{Y.buildtimeCheck="none"}if(R){if(H){Y.runtimeCheck="validityWithCause"}else{Y.runtimeCheck="validity"}}else{Y.runtimeCheck="none"}Y.matrixDefinition={};Y.matrixDefinition.drivingCombinations=v;Y.matrixDefinition.constrainedCombinations=[];for(X=0;X<M.options.length;X+=1){I={};I.combinationOptions=[];I.combinationOptions.push({id:M.options[X].parentRelLogicalId});Y.matrixDefinition.constrainedCombinations.push(JSON.parse(JSON.stringify(I)))}Y.matrixDefinition.constrainedFeatures=[];Y.matrixDefinition.constrainedFeatures.push({id:M.logicalId});Y.matrixDefinition.drivingFeatures=s.getDrivingFeatures();var U={solverId:Z,selectedCriteria:{_from:"matrixRuleWebApp",_to:"solverRule",_data:Y,_request:"checkMatrixRuleValidity"}};var Q=function(aa,ab){if(ab!=null&&ab[0]!=null){UWA.extendElement(ab[0]);h.unmask(ab[0])}if(ab==="error"){d.error("error in solve WebServices");return null}var ac=aa;if(ac!=null){m+=ac.statesValidity;for(V=0;V<ac.statesCausingRules.length;V+=1){y.push(ac.statesCausingRules[V])}}else{if(!O){alert("solve failed, processing matrix without solving");d.error("solve failed, processing matrix "+i+" without solving");for(X=0;X<M.options.length;X+=1){for(W=0;W<v.length;W+=1){m+="?";y.push([])}}}}return 0};var K=null;if(N!=null){K=[N];UWA.extendElement(K[0]);h.mask(K[0])}S.combiSolverOk2(L,U,O,null,Q,K)}else{for(X=0;X<M.options.length;X+=1){for(W=0;W<v.length;W+=1){m+="?";y.push([])}}}};var w=function(J){var I=-1,H=0;for(H=0;H<D.length;H+=1){if(D[H].combinationOptions[0].id===J){I=H;break}}return I};this.removeConstrainedFeature=function(S,R,Z,P,Q,T,I,N,M,L){var K=true;var W=0,V=0,U=0;var H={};var aa=v.length;H.id=S.logicalId;for(W=0;W<z.length;W+=1){if(z[W].id===H.id){z.splice(W,1);W-=1;break}}var X=null;var Y=null;var J=null;var O=null;for(U=0;U<D.length;U+=1){X=f.getFeatureFromOptionLogicalId(D[U].combinationOptions[0].id,L).logicalId;Y=D[U].combinationOptions[0].id;if(X===H.id){J=x.substring(0,w(Y)*aa);O=x.substring(w(Y)*aa+aa);x=J+O;J=m.substring(0,w(Y)*aa);O=m.substring(w(Y)*aa+aa);m=J+O;D.splice(U,1);U-=1}}};var G=null;this.getInternalStatus=function(){return G};this.solveInternalNoReason=function(L,K,J,M,O){if(J!=undefined){d.debug("solve");var I={};I.matrixDefinition=this.getJSONSimplifiedObject();I.runtimeCheck="validity";var N={solverId:J,selectedCriteria:{_from:"matrixRuleWebApp",_to:"solverRule",_data:I,_request:"checkMatrixRuleValidity"}};var H=function(P,Q){if(Q!=null&&Q[0]!=null){UWA.extendElement(Q[0]);h.unmask(Q[0])}if(Q==="error"){d.error("error in solve");return}if(P!=null){G=P}if(O){O()}};K.combiSolverOk2(L,N,M,null,H,null)}};this.solve=function(K,I,U,M,T,L,P,O,H,J){if(U!==null&&U!==undefined){d.debug("solve");var N={};N.matrixDefinition=this.getJSONSimplifiedObject();if(T){if(P){N.runtimeCheck="validityWithCause"}else{N.runtimeCheck="validity"}}else{N.runtimeCheck="none"}if(L){if(P){N.buildtimeCheck="validityWithCause"}else{N.buildtimeCheck="validity"}}else{N.buildtimeCheck="none"}var S={solverId:U,selectedCriteria:{_from:"matrixRuleWebApp",_to:"solverRule",_data:N,_request:"checkMatrixRuleValidity"}};var Q=function(V,Y){if(Y!=null&&Y[0]!=null){UWA.extendElement(Y[0]);h.unmask(Y[0])}if(Y==="error"){d.error("error in solve");return}var X=(V);if(X!=null&&!O){m=X.statesValidity;o=X.drivingCombinationsValidity;y=X.statesCausingRules}else{if(!O){alert("solve failed, processing matrix without solving");d.error("solve failed, processing matrix "+i+" without solving");var W=0;m="";for(W=0;W<x.length;W+=1){m+="?"}o="";for(W=0;W<v.length;W+=1){o+="?"}}}if(J!=null&&J.getInternalSolverAvailability()===true){d.debug("re-calculating internal reason once after reason calculation");s.solveInternalNoReason(K,I,U,false,null);J.handleInternalConflict(s.getInternalStatus());J.getConflicts()}};var R=null;if(M==null){R=[H];UWA.extendElement(R[0]);h.mask(R[0])}I.combiSolverOk2(K,S,O,M,Q,R)}};this.postProcess=function(){var H=0;var I="";for(H=0;H<x.length;H+=1){if(x.charAt(H)==="?"){if(m.charAt(H)==="R"||m.charAt(H)==="V"||m.charAt(H)==="U"||m.charAt(H)==="E"||m.charAt(H)==="?"){I="A"}else{I="A"}x=x.substr(0,H)+I+x.substr(H+1)}}m=m.replace(/\?/g,"V");o=o.replace(/\?/g,"V");if(m.length!==y.length){y=[];for(H=0;H<m.length;H+=1){y.push([])}}};this.simplifyJSON=function(){var Q=this.getJSONSimplifiedObject();var J=JSON.parse(JSON.stringify(Q));var L=0,K=0;var M=0;var H=true;var N=[];for(L=0;L<J.drivingCombinations.length;L+=1){H=true;for(K=0;K<J.constrainedCombinations.length;K+=1){M=L+K*J.drivingCombinations.length;if(J.states.charAt(M)!=="A"){H=false;break}}if(H){N.push(L)}}var I=0;for(L=0;L<N.length;L+=1){k(J,N[L]-I);I+=1}var P=true;var O=[];for(K=0;K<J.constrainedCombinations.length;K+=1){P=true;for(L=0;L<J.drivingCombinations.length;L+=1){M=L+K*J.drivingCombinations.length;if(J.states.charAt(M)!=="A"){P=false;break}}if(P){O.push(K)}}I=0;for(L=0;L<O.length;L+=1){u(J,O[L]-I);I+=1}return J};var p=function(K){var J=0;var I={};var H=[];for(J=0;J<K.length;J+=1){I.id=K[J].logicalId;H.push(JSON.parse(JSON.stringify(I)))}return H};var C=function(I,J){var H="";var K=0;for(K=0;K<I*J;K+=1){H+="?"}return H};var A=function(L){if(L.length===0){return[]}var P=[];var M={};var J={};var O=[];var N=[];var K=0,I=0;for(K=0;K<L.length;K+=1){O.push(0);N.push(L[K].options.length-1)}var H=1;for(K=0;K<N.length;K+=1){H*=(N[K]+1)}for(K=0;K<H;K+=1){M.combinationOptions=[];for(I=0;I<O.length;I+=1){J.id=L[I].options[O[I]].parentRelLogicalId;M.combinationOptions.push(JSON.parse(JSON.stringify(J)))}O=j(O,N);P.push(JSON.parse(JSON.stringify(M)))}return P};var j=function(K,I){var J=0;var H=true;for(J=0;J<K.length;J+=1){if(H&&K[J]===I[J]){K[J]=0}else{H=false;break}}K[J]+=1;return K};var F=function(H,P,N){var L=undefined;var I=0;var M=N.drivingCombinations.length;var J=N.constrainedCombinations.length;var O=undefined;var K=undefined;for(I=0;I<M;I+=1){if(E(H,N.drivingCombinations[I].combinationOptions)){O=I;break}}for(I=0;I<J;I+=1){if(E(P,N.constrainedCombinations[I].combinationOptions)){K=I;break}}if(K!==undefined&&O!==undefined){L=O+K*N.drivingCombinations.length}return L};var E=function(K,I){var J=0,H=0;var L=false;if(K.length!==I.length){return false}for(J=0;J<K.length;J+=1){L=false;for(H=0;H<I.length;H+=1){if(K[H].id===I[J].id){L=true;break}}if(!L){return false}}return true};var k=function(L,H){var N="";var J="";var I=0;var M,K;for(I=0;I<L.constrainedCombinations.length;I+=1){M=L.states.substr(I*L.drivingCombinations.length,H);K=L.states.substr(I*L.drivingCombinations.length+H+1,L.drivingCombinations.length-H-1);N=M+K;J+=N}L.drivingCombinations.splice(H,1);L.states=J};var u=function(M,H){var J="";var I=0;var L=M.drivingCombinations.length;var N=M.states.substr(0,L*H);var K=M.states.substr(L*(H+1),M.states.length-L*(H+1));M.states=N+K;M.constrainedCombinations.splice(H,1)};this.createFromJSON=function(N,L,K,P,J){t=f.generateFeaturesOfTypeFromJsonMatrixRules(N,L,"driving");z=f.generateFeaturesOfTypeFromJsonMatrixRules(N,L,"constrained");this.createEmptyFromFeatures(t,z);if(window.localStorage.DS_Debug_MatrixRule_Performance){var I=performance.now()}this.loadJsonIn(N);if(window.localStorage.DS_Debug_MatrixRule_Performance){var H=performance.now()}this.solve(L,K,P,null,false,true,false,false,J,null);if(window.localStorage.DS_Debug_MatrixRule_Performance){var O=performance.now()}this.postProcess();if(window.localStorage.DS_Debug_MatrixRule_Performance){var M=performance.now();console.log("-----  Load JSON Object Timer----");console.log("----- total time = "+(M-I)+" ms");console.log("----- load json time = "+(H-I)+" ms");console.log("----- solve json time = "+(O-H)+" ms");console.log("----- post process json time = "+(M-O)+" ms");console.log("---------------------------------")}}};return b});define("DS/CfgRules/scripts/CfgMatrixRulesController",["UWA/Core","UWA/Element","UWA/Drivers/Alone","DS/CfgRules/scripts/generateCfgMatrixRulesJSONObj","DS/CfgRules/scripts/generateCfgMatrixRulesTableObj","DS/CfgRules/scripts/generateCfgMatrixRulesWrappedTableObj","DS/CfgRules/scripts/dictionaryCfgUtils","DS/CfgRules/scripts/selectionCfgMatrixRulesTable","DS/CfgRules/scripts/CfgMatrixRulesSettings","DS/CfgRules/scripts/CfgMatrixRulesWebServices","DS/CfgRules/scripts/traceCfgUtils","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/UIKIT/DropdownMenu","i18n!DS/CfgRules/assets/nls/MatrixRule"],function(c,h,l,n,b,f,d,p,o,k,j,g,e,a,i){var m=function(){var X=true;var Q=null;var ap=null;var F=null;var A=null;var w=null;var K=null;var S=null;var Z=null;var ay=null;var V=null;var H=null;var E=false;var y=600;var ao=null;var ae=0;var ad=null;var D=null;var at=null;var ac=null;var au=null;var C=true;var aa=this;var ag=null;var ai=null;var q=null;var x=null;var al=null;var av=null;var J=null;var ab=null;var v=null;var N=null;var aq=null;var P=null;var R=null;var ax=0;var G=null;var u=null;var af="assets/images/no_image.png";var O=true;var s=null;var U=null;var ah=null;var M=null;var T=null;this.setInternalSolverAvailability=function(az){T=az};this.getInternalSolverAvailability=function(){return T};this.getContentDiv=function(){return av};this.getSettingsButton=function(){return J};this.getMatrixRulesTableObj=function(){return F};this.getDrivingUL=function(){return w};this.getConstrainedUL=function(){return S};this.setConfigurationFeatureComponent=function(az){ay=az};this.getMatrixRulesWrappedTableObj=function(){return A};this.getModel=function(){return ap};this.getDrivingList=function(){return D};this.getConstrainedList=function(){return at};this.setDrivingList=function(az){D=az};this.setConstrainedList=function(az){at=az};this.setView=function(az){u=az};this.getView=function(){return u};this.getWithPicture=function(){return C};this.loadJsonIn=function(aD,aA,az){D=d.generateFeaturesOfTypeFromJsonMatrixRules(aD,aA,"driving");at=d.generateFeaturesOfTypeFromJsonMatrixRules(aD,aA,"constrained");if(D.length>0&&at.length>0){UWA.extendElement(ai);e.mask(ai);ap.createFromJSON(aD,aA,k,az,ai);e.unmask(ai);j.log(ap.getJSONObject(),j.typeMessage.INFO);F.createTableFromJSON(ap,aA,C,true);if(window.localStorage.DS_Debug_MatrixRule_Performance){var aC=performance.now()}A.generateAllTables(F);if(window.localStorage.DS_Debug_MatrixRule_Performance){var aB=performance.now();console.log("-----  Gen. Wrapped Table Timer ----");console.log("----- time = "+(aB-aC)+" ms");console.log("---------------------------------")}if(T===true){var aE=function(){aa.handleInternalConflict(ap.getInternalStatus());aa.getConflicts();A.setReasonCalculated(false);ap.solve(aA,k,az,A,false,true,true,true,ai,aa)};ap.solveInternalNoReason(aA,k,s,true,aE)}else{aa.getConflicts();A.setReasonCalculated(false);ap.solve(aA,k,az,A,false,true,true,true,ai,aa)}}aa.initUL()};this.displayDiscrepancyList=function(aA){var az=i.MR_InconsistencyCriteria_WarningMessage;ao.add({className:"warning MR_message",message:az});ao.show()};this.checkAndRemoveDiscrepancy=function(aD,aJ){console.log("check discrepancy");var aI={};aI._rc=0;aI._discrepancyIds=[];aI._simplifiedModel={};var aS=null;aS={};aS.addedConstrainedValues=[];aS.addedDrivingCombination=[];var aH=null;var aK=null;var aR=null;var aP=0,aO=0,aN=0;if(aD.drivingFeatures){aI._simplifiedModel.drivingFeatures=[];for(aP=0;aP<aD.drivingFeatures.length;aP+=1){aK={};aR={};aR=d.getFeatureInDicoWithLogicalId(aD.drivingFeatures[aP].id,aJ);if(aR==null){aI._rc=-1;aI._discrepancyIds.push(aD.drivingFeatures[aP].id)}else{aK.id=aR.logicalId;aI._simplifiedModel.drivingFeatures.push(aK)}}}if(aD.constrainedFeatures){aI._simplifiedModel.constrainedFeatures=[];for(aP=0;aP<aD.constrainedFeatures.length;aP+=1){aK={};aR={};aR=d.getFeatureInDicoWithLogicalId(aD.constrainedFeatures[aP].id,aJ);if(aR==null){aI._rc=-1;aI._discrepancyIds.push(aD.constrainedFeatures[aP].id)}else{aK.id=aR.logicalId;aI._simplifiedModel.constrainedFeatures.push(aK)}}}aI._simplifiedModel.states="";if(aD.states){aI._simplifiedModel.states=aD.states}aI._simplifiedModel.drivingCombinations=[];var az=[];var aB=null;var aM=null;if(aD.drivingCombinations){aI._simplifiedModel.drivingCombinations=aD.drivingCombinations;for(aP=0;aP<aD.drivingCombinations.length;aP+=1){aB=aD.drivingCombinations[aP];aM=d.areCriteriaOfCombinationsInDico(aB,aJ);if(aM._rc!==0){aI._rc=-1;az.push(aP);for(aO=0;aO<aM._listIds.length;aO+=1){if(aI._discrepancyIds.indexOf(aM._listIds[aO])<0){aI._discrepancyIds.push(aM._listIds[aO])}}}}}var aE=[];aI._simplifiedModel.constrainedCombinations=[];if(aD.constrainedCombinations){aI._simplifiedModel.constrainedCombinations=aD.constrainedCombinations;for(aP=0;aP<aD.constrainedCombinations.length;aP+=1){aB=aD.constrainedCombinations[aP];aM=d.areCriteriaOfCombinationsInDico(aB,aJ);if(aM._rc!==0){aI._rc=-1;aE.push(aP);for(aO=0;aO<aM._listIds.length;aO+=1){if(aI._discrepancyIds.indexOf(aM._listIds[aO])<0){aI._discrepancyIds.push(aM._listIds[aO])}}}}}var aA="";var aF="";var aQ=null;var aC=JSON.parse(JSON.stringify(aI._simplifiedModel.drivingCombinations));if(az.length>0){var aG=aI._simplifiedModel.states;for(aP=0;aP<az.length;aP+=1){aA="";aQ=az[aP];var aL=aC.length;for(aN=0;aN<aI._simplifiedModel.constrainedCombinations.length;aN+=1){aA+=aG.substr(aN*aL,aQ)+aG.substr(aN*aL+aQ+1,aL-aQ-1)}aF+=aA;aC.splice(aQ,1);for(aO=aP;aO<az.length;aO+=1){az[aO]-=1}aG=aA}aI._simplifiedModel.states=aG;aI._simplifiedModel.drivingCombinations=aC}aC=JSON.parse(JSON.stringify(aI._simplifiedModel.constrainedCombinations));for(aP=0;aP<aE.length;aP+=1){aQ=aE[aP];aQ-=aP;aA="";aA=aI._simplifiedModel.states.substr(0,(aQ*aI._simplifiedModel.drivingCombinations.length));aA+=aI._simplifiedModel.states.substr((aQ+1)*aI._simplifiedModel.drivingCombinations.length);aI._simplifiedModel.states=aA;aC.splice(aQ,1)}aI._simplifiedModel.constrainedCombinations=aC;return aI};var aw=function(az,aD,aB,aA){ap=az;F.init(aB);A.init(aB,C);F.createTableFromJSON(az,aD,C,true);A.generateAllTables(F);if(T===true){var aC=function(){aa.handleInternalConflict(ap.getInternalStatus());aa.getConflicts();A.setReasonCalculated(false);ap.solve(aD,k,aA,A,false,true,true,true,ai,aa)};ap.solveInternalNoReason(aD,k,s,true,aC)}else{aa.getConflicts();A.setReasonCalculated(false);ap.solve(aD,k,aA,A,false,true,true,true,ai,aa)}aa.addInteraction(aD,aA)};this.init=function(aE,az,aD,aA,aC,aB){ap=new n();ap.init(aE);F=new b();F.init(aE,"n"+aE,false);A=new f();A.init(aE,aC);Q=aE;ad=aB;C=aC;ai=az;Z=document.createElement("div");K=document.createElement("div");K.setAttribute("container","drivingFeatureContainer");Z.setAttribute("container","constrainedFeatureContainer");K.classList.add("driving_container");Z.classList.add("constrained_container");av=document.createElement("div");av.classList.add("content95");av.setAttribute("id","contentdivid");ai.appendChild(av);V=document.createElement("div");H=document.createElement("div");V.textContent=i.MR_DRIVING_CRITERIA;H.textContent=i.MR_CONSTRAINED_CRITERIA;V.classList.add("driving_container_title");H.classList.add("constrained_container_title");av.appendChild(V);av.appendChild(H);av.appendChild(K);av.appendChild(Z);ac=document.createElement("div");ac.classList.add("mid-left-div");au=document.createElement("div");au.classList.add("mid-right-div");w=document.createElement("ol");S=document.createElement("ol");w.classList.add("featureList");w.classList.add("js-sortable-connected");S.classList.add("featureList");S.classList.add("js-sortable-connected");K.appendChild(w);K.setAttribute("container","drivingFeatureContainer");Z.appendChild(S);Z.setAttribute("container","constrainedFeatureContainer");D=[];at=[];ai=az;x=document.createElement("div");x.classList.add("content95");x.classList.add("settingsdiv");x.classList.add("displaynone");ab=new o();T=(window.localStorage.DS_FTR_Matrixrule_InternalConflictSetting==="false")?false:true;ab.init(C,T,aA);ab.setParentDiv(x);ab.draw();q=document.createElement("div");q.setAttribute("id","idSettingsBarDiv");q.classList.add("content5");q.classList.add("settingsbar");P=document.createElement("div");P.setAttribute("id","idConflictDiv");P.style.marginLeft="165px";P.style.marginBottom="10px";P.style.fontWeight="bold";P.style.display="none";u="editView";aj();aa.showStruct();ai.appendChild(q);ai.appendChild(av);ai.appendChild(x);A.drawInDiv(av);ag=aD;I(aD,aA);s=aA;ak(aD);ao=new g({visible:false,autoHide:true,hideDelay:3000,closeOnClick:true,maximumVisibleMessages:3,className:"MRAlert"});ao.inject(av)};var t=false;var aj=function(){J=document.createElement("button");J.classList.add("button_settings");J.classList.add("btn");J.classList.add("btn-default");var aA=document.createElement("span");aA.classList.add("fonticon");aA.classList.add("fonticon-cog");aA.classList.add("matrixrulespan");J.setAttribute("title",i.MR_Settings);J.appendChild(aA);q.appendChild(J);J.addEventListener("click",function(){t=!t;j.debug("settings button clicked");av.classList.toggle("displaynone");x.classList.toggle("displaynone");P.classList.toggle("displaynone");v.classList.toggle("displaynone");N.classList.toggle("displaynone");aq.classList.toggle("displaynone");G.classList.toggle("displaynone");if(d.hasClass(G,"displaynone")<0){H.classList.toggle("displaynone");V.classList.toggle("displaynone")}if(t){if(document.getElementById("idcancelMR")){document.getElementById("idcancelMR").disabled=true}if(document.getElementById("idsaveMR")){document.getElementById("idsaveMR").disabled=true}}else{if(ad){if(document.getElementById("idcancelMR")){document.getElementById("idcancelMR").disabled=false}if(document.getElementById("idsaveMR")){document.getElementById("idsaveMR").disabled=false}}}W()});R=document.createElement("div");R.setAttribute("id","MRconflictDiv");R.style.cssFloat="right";v=document.createElement("button");v.setAttribute("id","idConflictNext");var aB=document.createElement("span");aB.classList.add("fonticon");aB.classList.add("fonticon-right");aB.classList.add("matrixrulespan");v.appendChild(aB);v.classList.add("button_settings");v.classList.add("btn");v.classList.add("btn-default");R.appendChild(v);v.addEventListener("click",aa.getNextConflicts,true);N=document.createElement("button");N.setAttribute("id","idConflictPrev");var az=document.createElement("span");az.classList.add("fonticon");az.classList.add("fonticon-left");az.classList.add("matrixrulespan");N.appendChild(az);N.classList.add("button_settings");N.classList.add("btn");N.classList.add("btn-default");R.appendChild(N);N.addEventListener("click",aa.getPrevConflicts,true);aq=document.createElement("i");aq.setAttribute("id","idConflictAlert");aq.classList.add("fonticon");aq.classList.add("fonticon-alert");aq.style.fontSize="larger";aq.style.marginTop="4px";aq.style.cssFloat="right";aq.style.color="red";R.appendChild(aq);P=document.createElement("div");P.setAttribute("id","idConflictDiv");P.innerHTML="0";P.style.cssFloat="right";P.style.marginTop="4px";P.style.padding="2px";P.style.marginRight="2px";R.appendChild(P);q.appendChild(R);G=document.createElement("button");G.classList.add("button_settings");G.classList.add("btn");G.classList.add("btn-default");var aA=document.createElement("span");G.appendChild(aA);aA.classList.add("fonticon");aA.classList.add("matrixrulespan");G.setAttribute("title",i.MR_SwitchView);G.addEventListener("click",aa.toggleView,true);if(u==="structView"){aA.classList.add("fonticon-layout")}else{aA.classList.add("fonticon-list")}if(X){q.appendChild(G)}};this.initUL=function(){var az=0;for(az=0;az<D.length;az+=1){w.appendChild(z(D[az],"driving"))}for(az=0;az<at.length;az+=1){S.appendChild(z(at[az],"constrained"))}};var z=function(aB,aC){var az=document.createElement("li");az.setAttribute("id","li_"+aB.logicalId);az.setAttribute("idfeature",aB.logicalId);az.setAttribute("featuretype",aC);az.setAttribute("draggable","true");az.setAttribute("title",aB.displayValue);az.classList.add("draggableitem");az.classList.add("matrixrulesli");var aE=document.createElement("div");aE.textContent=aB.displayValue;if(aB.displayValue.length>=40){var aD=aB.displayValue.substring(0,15);aD=aD+"...";aD=aD+aB.displayValue.substring(aB.displayValue.length-15);aE.textContent=aD}var aA=document.createElement("img");if(aB.image===""||aB.image==undefined){aA.setAttribute("src",af)}else{aA.setAttribute("src",aB.image)}aA.classList.add("cellimage");aA.setAttribute("id","img_"+aB.logicalId);if(!C){az.classList.add("withoutpicture");aA.classList.add("hidden")}az.appendChild(aA);az.appendChild(aE);return az};this.addInteraction=function(aA,az){j.debug("adding interaction for wrapped table "+A.getId());this._addClickInteractionForWrappedTable(aA);T=(window.localStorage.DS_FTR_Matrixrule_InternalConflictSetting==="false")?false:true;ar();I(aA,az);W();(ab.getImageButton()).onchange=aa.togglePicture;(ab.getConflictCheckButton()).onchange=function(){aa.changeInternalStatus(aA)}};this.draw=function(){A.drawTopIn(av);A.drawBotIn(av)};this.getNextConflicts=function(){var aD=false;var aF=false;var aC=A.getBotRightTable();var aB=aC.getElementsByTagName("td");var aG=0;var aA=0;var aE=null;var az=null;for(aG=0;aG<aB.length;aG+=1){aB[aG].classList.remove("mr_current_highlight");if(aB[aG].getAttribute("navigate")==="true"){aB[aG].setAttribute("navigate","false");aG+=1;break}}if(aG===aB.length){aG=0;aF=true}for(aA=aG;aA<aB.length;aA+=1){aE=aB[aA].getAttribute("conflict");az=aB[aA].getAttribute("internal_conflict");if(aE==="true"||az==="true"){aB[aA].setAttribute("navigate","true");aD=true;aa.showCell(aB[aA]);break}}if((aF===false)&&(aD===false)){for(aA=0;aA<aG;aA+=1){aE=aB[aA].getAttribute("conflict");az=aB[aA].getAttribute("internal_conflict");if(aE==="true"||az==="true"){aB[aA].setAttribute("navigate","true");aD=true;aa.showCell(aB[aA]);break}}}};this.getPrevConflicts=function(){var aD=false;var aF=false;var aC=A.getBotRightTable();var aB=aC.getElementsByTagName("td");var aG=0;var aA=0;var aE=null;var az=null;for(aG=0;aG<aB.length;aG+=1){aB[aG].classList.remove("mr_current_highlight");if(aB[aG].getAttribute("navigate")==="true"){aB[aG].setAttribute("navigate","false");break}}if(aG===0){aG=aB.length;aF=true}for(aA=aG-1;aA>0;aA-=1){aE=aB[aA].getAttribute("conflict");az=aB[aA].getAttribute("internal_conflict");if(aE==="true"||az==="true"){aB[aA].setAttribute("navigate","true");aD=true;aa.showCell(aB[aA]);break}}if((aF===false)&&(aD===false)){for(aA=aB.length-1;aA>=aG;aA-=1){aE=aB[aA].getAttribute("conflict");az=aB[aA].getAttribute("internal_conflict");if(aE==="true"||az==="true"){aB[aA].setAttribute("navigate","true");aD=true;aa.showCell(aB[aA]);break}}}};this.showCell=function(az){var aB=az.offsetLeft-window.scrollX;var aA=az.offsetTop-window.scrollY;$("html,#IDTABLE-bot-right-div").animate({scrollLeft:aB},200);$("html,#IDTABLE-bot-right-div").animate({scrollTop:aA},200);az.classList.add("mr_current_highlight");return true};this.getConflicts=function(){ax=0;var aC=A.getBotRightTable();var aB=aC.getElementsByTagName("td");var aA=0;var aE=null;var az=null;var aD=false;for(aA=0;aA<aB.length;aA+=1){aE=aB[aA].getAttribute("conflict");az=aB[aA].getAttribute("internal_conflict");aD=d.hasClass(aB[aA],"displaynone");if(!aD){if(aE==="true"||az==="true"){ax+=1}}}P.innerHTML=ax;ae=ax;if(ax===0){aq.style.color="grey";N.style.color="grey";v.style.color="grey"}else{aq.style.color="red";N.style.color="black";v.style.color="black"}return ax};this.setNavigationConflictsAvailability=function(az){if(az){N.disabled=true;v.disabled=true;if(document.getElementById("idinternalsolveMR")){document.getElementById("idinternalsolveMR").disabled=true}}else{N.disabled=false;v.disabled=false;if(document.getElementById("idinternalsolveMR")){document.getElementById("idinternalsolveMR").disabled=false}}};this._addInteractionBotleftHeader=function(aC,az,aB){var aA=aC&&aC.rowSpan>=2?i.MR_Set_Rows:i.MR_Set_Row;aC.addEventListener("click",function(){if(this.getAttribute("editable")==="false"){return}var aD=new a({className:"mr-dropdown-header-interaction",target:aC,items:[{text:aA+" : ",className:"header"},{status:"A",text:i.MR_Available,fonticon:"stop",className:"mr-dropdown-available"},{status:"N",text:i.MR_NonAvailable,fonticon:"stop",className:"mr-dropdown-nonavailable"}],events:{onClick:function(aF,aE){p.updateAllLineWrappedTableAndJSONFromInteraction(aC,ap,A.getBotRightTable(),aB,aE.status);if(A.getReasonCalculated()===true&&T===true){var aG=function(){aa.handleInternalConflict(ap.getInternalStatus());aa.getConflicts()};ap.solveInternalNoReason(aB,k,s,true,aG)}else{aa.getConflicts()}aD.hide();aD.destroy()},onClickOutside:function(aE){aD.hide();aD.destroy()}}});aD.show()})};this._addInteractionTopRightHeader=function(aC,az,aB){var aA=aC&&aC.colSpan>=2?i.MR_Set_Columns:i.MR_Set_Column;aC.addEventListener("click",function(){if(this.getAttribute("editable")==="false"){return}var aD=new a({target:aC,items:[{text:aA+" : ",className:"header"},{status:"A",text:i.MR_Available,fonticon:"stop",className:"mr-dropdown-available"},{status:"N",text:i.MR_NonAvailable,fonticon:"stop",className:"mr-dropdown-nonavailable"}],events:{onClick:function(aF,aE){p.updateAllColumnWrappedTableAndJSONFromInteraction(aC,ap,A.getBotRightTable(),aB,aE.status);if(A.getReasonCalculated()===true&&T===true){var aG=function(){aa.handleInternalConflict(ap.getInternalStatus());aa.getConflicts()};ap.solveInternalNoReason(aB,k,s,true,aG);aD.destroy()}else{aa.getConflicts()}},onClickOutside:function(aE){aD.hide();aD.destroy()}}});aD.show()})};this._addInteractionTopLeftHeader=function(az,aA){az.addEventListener("click",function(){if(this.getAttribute("editable")==="false"){return}var aB=new a({target:az,items:[{text:i.MR_SET_MATRIX+" : ",className:"header"},{status:"A",text:i.MR_Available,fonticon:"stop",className:"mr-dropdown-available"},{status:"N",text:i.MR_NonAvailable,fonticon:"stop",className:"mr-dropdown-nonavailable"}],events:{onClick:function(aD,aC){p.updateAllMatrix(ap,A.getBotRightTable(),aA,aC.status);if(A.getReasonCalculated()===true&&T===true){var aE=function(){aa.handleInternalConflict(ap.getInternalStatus());aa.getConflicts()};ap.solveInternalNoReason(aA,k,s,true,aE);aB.destroy()}else{aa.getConflicts()}},onClickOutside:function(aC){aB.hide();aB.destroy()}}});aB.show()})};this._addClickInteractionForWrappedTable=function(aF){var aB=this;j.debug("adding click event on each cell of mBotRightTable for "+A.getId());var aE=A.getBotRightTable().getElementsByTagName("td");var az=0;for(az=0;az<aE.length;az+=1){aE[az].addEventListener("click",function(){p.updateWrappedTableAndJSONFromLeftClickInteraction(this,ap,A.getBotRightTable(),aF);if(A.getReasonCalculated()===true&&T===true){var aG=function(){aB.handleInternalConflict(ap.getInternalStatus());aB.getConflicts()};ap.solveInternalNoReason(aF,k,s,true,aG)}else{aB.getConflicts()}});aE[az].oncontextmenu=function(aG){if(this.getAttribute("editable")==="false"){return}U=this;am(this,aG);ah.focus();return false}}if(X){var aC=A.getBotLeftTable().getElementsByTagName("td");for(az=0;az<aC.length;az+=1){aB._addInteractionBotleftHeader(aC[az],az,aF)}var aA=A.getTopRightTable().getElementsByTagName("th");for(az=0;az<aA.length;az+=1){aB._addInteractionTopRightHeader(aA[az],az,aF)}var aD=A.getTopLeftTable().getElementsByClassName("invisible_but_hidden");for(az=0;az<aD.length;az+=1){aB._addInteractionTopLeftHeader(aD[az],aF)}}};var W=function(){j.debug("header resized for "+A.getId());var aI=D.length;var aC=av.clientHeight;j.debug("height size : "+aC);var aH=A.getTopRightDiv().style.height;var aH=A.getTopRightDiv().clientHeight;M=(aH)?aH:M;var aD="calc(100% - "+M+"px)";A.getBotLeftDiv().style.maxHeight=aD;A.getBotRightDiv().style.maxHeight=aD;if(window.ActiveXObject||"ActiveXObject" in window){A.getBotLeftDiv().style.height=aD;A.getBotRightDiv().style.height=aD}var az=A.getTopRightDiv();if(az.firstChild&&az.firstChild.firstChild&&az.firstChild.firstChild.childNodes){var aF=az.firstChild.firstChild.childNodes;var aA=0;var aB=[];for(aA=0;aA<aF.length;aA+=1){aB.push(aF[aA].clientHeight)}var aE=A.getTopLeftDiv();var aG=aE.firstChild.firstChild.childNodes;for(aA=0;aA<aG.length;aA+=1){aG[aA].style.height=aB[aA]+"px"}}};var I=function(aA,az){aa.generateContainer(A.getTopLeftDiv(),aA,az,"drivingFeatureContainer");aa.generateContainer(A.getTopRightDiv(),aA,az,"drivingFeatureContainer");aa.generateContainer(A.getBotLeftDiv(),aA,az,"constrainedFeatureContainer");if(!E){aa.generateContainer(K,aA,az,"drivingFeatureContainer");aa.generateContainer(Z,aA,az,"constrainedFeatureContainer");E=true}};var ar=function(){var az=document.querySelectorAll(".draggableitem");var aA=0;for(aA=0;aA<az.length;aA+=1){az[aA].addEventListener("dragstart",r,true);az[aA].addEventListener("dragend",Y,true);az[aA].addEventListener("dragover",L,true)}};this.generateContainer=function(az,aC,aA,aB){az.setAttribute("container",aB);az.ondragover=L;az.ondrop=function(aE){var aD=this;B(aE,aC,aA,aD)}};var an=null;this.triggerDrop=function(aC,az,aD,aA,aB){an=az;B(aC,aD,aA,aB)};var r=function(az){an=this;this.style.opacity="0.5";az.dataTransfer.effectAllowed="move";az.dataTransfer.setData("MRidfeature",this.getAttribute("idfeature"));j.debug("id feature dragged = "+this.getAttribute("idfeature"))};var L=function(az){if(az.preventDefault){az.preventDefault()}az.dataTransfer.dropEffect="move";return false};var Y=function(az){this.style.opacity="1.0"};var B=function(aK,aM,aO,aC){if(aC.getAttribute("editable")==="false"){an=null;if(aK.preventDefault){aK.preventDefault()}return}if(an===null||an.getAttribute("draggable")==="false"){if(aK.preventDefault){aK.preventDefault()}return}j.debug("item dropped");if(aK.preventDefault){aK.preventDefault()}if(aK.stopPropagation){aK.stopPropagation()}var aE;var aB;if(aC.getAttribute("container")==="drivingFeatureContainer"){aE="driving"}else{if(aC.getAttribute("container")==="constrainedFeatureContainer"){aE="constrained"}else{aE="noType"}}var az=an.getAttribute("idfeature");if((d.getFeatureInDicoWithId(az,aM))!==null){az=(d.getFeatureInDicoWithId(az,aM)).logicalId;an.setAttribute("idfeature",az)}if(an.getAttribute("featuretype")==="driving"){aB="driving"}else{if(an.getAttribute("featuretype")==="constrained"){aB="constrained"}else{aB="noType"}}if(aE===aB){an=null;return}if(aB==="noType"){var aI=0;var aF=undefined;for(aI=0;aI<w.childElementCount;aI+=1){aF=w.childNodes[aI];if(aF.getAttribute("idfeature")===an.getAttribute("idfeature")){aB="driving";break}}for(aI=0;aI<S.childElementCount;aI+=1){aF=S.childNodes[aI];if(aF.getAttribute("idfeature")===an.getAttribute("idfeature")){aB="constrained";break}}}var aJ={id:az,newType:aE,previousType:aB};j.debug("DnD : id = "+az+" - newType = "+aE+" - previousType = "+aB);if(aJ.newType===aJ.previousType){an=null;return}var aG=d.getFeatureInDicoWithLogicalId(az,aM);if(aJ.newType==="driving"&&aG.selectionType==="Multiple"){j.error("dragging Feature "+aG.displayValue+" is not allowed in Driving Features because the feature is multiple");ao.add({className:"error MR_message",message:aG.displayValue+" "+i.NotAllowForMultiple});ao.show();an=null;return}if(aJ.newType==="driving"&&(ap.getNumberColumns()*aG.options.length>y)){ao.add({className:"primary MR_message",message:i.Too_Many_Columns});ao.show();an=null;return}var aN=document.createElement("li");if(aJ.previousType==="driving"){d.removeFeatureInListWithLogicalId(aJ.id,D);w.removeChild(document.getElementById("li_"+aJ.id))}else{if(aJ.previousType==="constrained"){d.removeFeatureInListWithLogicalId(aJ.id,at);S.removeChild(document.getElementById("li_"+aJ.id))}}var aH=null;var aD=null;var aL=null;if(aJ.newType==="driving"){if((d.getFeatureIndexInListWithLogicalId(aJ.id,D)===-1)&&(d.getFeatureIndexInListWithLogicalId(aJ.id,at)===-1)){ap.setNumberColumns(ap.getNumberColumns()*aG.options.length);j.info("new column 'potential' number : "+ap.getNumberColumns());D.push(d.getFeatureInDicoWithLogicalId(aJ.id,aM));aN=z(d.getFeatureInDicoWithLogicalId(aJ.id,aM),"driving");w.appendChild(aN)}}else{if(aJ.newType==="constrained"){if((d.getFeatureIndexInListWithLogicalId(aJ.id,at)===-1)&&(d.getFeatureIndexInListWithLogicalId(aJ.id,D)===-1)){at.push(d.getFeatureInDicoWithLogicalId(aJ.id,aM));aN=z(d.getFeatureInDicoWithLogicalId(aJ.id,aM),"constrained");S.appendChild(aN)}}}if(aJ.previousType==="driving"){ap.setNumberColumns(ap.getNumberColumns()/aG.options.length)}if(D.length===0||at.length===0){j.info("there should be at least one driving & one constrained feature when trying to generate a new table");aa.showStruct();ar();ae=0;P.innerHTML=ae;aq.style.color="grey";N.style.color="grey";v.style.color="grey";an=null;return}else{j.debug(ap.getJSONObject());j.debug("creating NEW TABLE");if(aJ.newType==="constrained"&&aJ.previousType==="noType"&&at.length!==1&&ap.getDrivingFeatures().length!==0){ap.addConstrainedFeature(aM,d.getFeatureInDicoWithLogicalId(aJ.id,aM),k,aO,null,false,true,false,false,ai)}else{if(aJ.newType==="noType"&&aJ.previousType==="constrained"&&ap.getDrivingFeatures().length!==0){ap.removeConstrainedFeature(d.getFeatureInDicoWithLogicalId(aJ.id,aM),k,aO,null,false,true,false,false,ai,aM)}else{if(aJ.newType==="driving"&&d.getFeatureIndexInListWithLogicalId(aJ.id,D)!==0&&d.getFeatureIndexInListWithLogicalId(aJ.id,at)!==0){if(aJ.previousType==="constrained"){ap.removeConstrainedFeature(d.getFeatureInDicoWithLogicalId(aJ.id,aM),k,aO,null,false,true,false,false,ai,aM);ap.addDrivingFeature(aJ.id,aM);ap.solve(aM,k,aO,null,false,true,false,false,ai,null)}else{if(aJ.previousType==="noType"){ap.addDrivingFeature(aJ.id,aM);ap.solve(aM,k,aO,null,false,true,false,false,ai,null)}}}else{ap.createEmptyFromFeatures(D,at);ap.solve(aM,k,aO,null,false,true,false,false,ai,null)}}}var aA=ap.getId();if(document.getElementById(aA+"-top-left-div")){av.removeChild(document.getElementById(aA+"-top-left-div"));av.removeChild(document.getElementById(aA+"-top-right-div"));av.removeChild(document.getElementById(aA+"-bot-left-div"));av.removeChild(document.getElementById(aA+"-bot-right-div"))}ap.postProcess();aw(ap,aM,aA,aO);aa.showCurrentView();aa.draw();ar();j.debug(ap.getJSONObject())}an=null;W();aa.getConflicts();return false};this.togglePicture=function(){C=!C;window.localStorage.setItem("DS_MatrixruleCookie_ImgSetting",C);var az=av.querySelectorAll(".cellimage");var aB=0;for(aB=0;aB<az.length;aB+=1){az[aB].classList.toggle("hidden")}var aC=av.querySelectorAll(".wrapped-table td");for(aB=0;aB<aC.length;aB+=1){aC[aB].classList.toggle("withoutpicture")}var aA=av.querySelectorAll(".wrapped-table th");for(aB=0;aB<aA.length;aB+=1){aA[aB].classList.toggle("withoutpicture")}if(window.localStorage.DS_MatrixruleCookie_ImgSetting==="false"){if(ay!=null){ay.showHideFeatureOptionImages(false)}}else{if(ay!=null){ay.showHideFeatureOptionImages(true)}}for(aB=0;aB<D.length;aB+=1){w.childNodes[aB].classList.toggle("withoutpicture")}for(aB=0;aB<at.length;aB+=1){S.childNodes[aB].classList.toggle("withoutpicture")}A.getBotLeftDiv().classList.toggle("withoutpicture");A.getBotRightDiv().classList.toggle("withoutpicture");A.getTopLeftDiv().classList.toggle("withoutpicture");A.getTopRightDiv().classList.toggle("withoutpicture");W()};this.toggleShowConflict=function(){var aA=A.getBotRightTable().getElementsByTagName("td");var az=0;for(az=0;az<aA.length;az+=1){aA[az].classList.toggle("showconflict")}};this.showTable=function(){A.getBotRightDiv().classList.remove("displaynone");A.getBotLeftDiv().classList.remove("displaynone");A.getTopLeftDiv().classList.remove("displaynone");A.getTopRightDiv().classList.remove("displaynone");K.classList.add("displaynone");Z.classList.add("displaynone");V.classList.add("displaynone");H.classList.add("displaynone");j.debug("current View : "+u);aa.setNavigationConflictsAvailability(false);W()};this.showStruct=function(){A.getBotRightDiv().classList.add("displaynone");A.getBotLeftDiv().classList.add("displaynone");A.getTopLeftDiv().classList.add("displaynone");A.getTopRightDiv().classList.add("displaynone");K.classList.remove("displaynone");Z.classList.remove("displaynone");V.classList.remove("displaynone");H.classList.remove("displaynone");j.debug("current View : "+u);aa.setNavigationConflictsAvailability(true)};this.toggleView=function(){if(u==="structView"&&D!=undefined&&at!=undefined&&D.length!==0&&at.length!==0){u="editView";G.firstChild.classList.remove("fonticon-layout");G.firstChild.classList.remove("fonticon-list");G.firstChild.classList.add("fonticon-list")}else{u="structView";G.firstChild.classList.remove("fonticon-layout");G.firstChild.classList.remove("fonticon-list");G.firstChild.classList.add("fonticon-layout");N.disabled=true;v.disabled=true}aa.showCurrentView()};this.showCurrentView=function(){if(u==="structView"){aa.showStruct()}else{aa.showTable()}};this.getSettingsContent=function(){return ab};this.handleInternalConflict=function(aD){var aA=0,az=0;if(aD==null){return}var aB=[];for(aA=0;aA<aD.statesValidity.length;aA+=1){if(aD.statesValidity[aA]==="C"){aB.push(aA)}}var aC=A.getBotRightTable().getElementsByTagName("td");for(aA=0;aA<aC.length;aA+=1){aC[aA].setAttribute("internal_conflict",false);aC[aA].classList.remove("internal_conflict")}for(az=0;az<aC.length;az+=1){for(aA=0;aA<aB.length;aA+=1){if(aB[aA]===parseInt(aC[az].getAttribute("idxstate"))){aC[az].setAttribute("internal_conflict","true");aC[az].classList.add("internal_conflict");break}}}};var ak=function(aF){ah=document.createElement("div");ah.setAttribute("id","mrdropdownmenu");ah.setAttribute("tabIndex",0);ah.classList.add("dropdown");ah.classList.add("dropdown-menu");ah.classList.add("displaynone");ah.onblur=function(aG){ah.classList.add("displaynone");U=null;return false};var aE=document.createElement("ul");aE.classList.add("dropdown-menu-wrap");var aC=document.createElement("li");aC.classList.add("item");aC.onclick=function(aG){j.debug(i.MR_Available+" clicked");ah.classList.add("displaynone");p.updateWrappedTableAndJSONFromContextMenuInteraction(U,ap,A.getBotRightTable(),aF,"A");if(A.getReasonCalculated()===true&&T===true){var aH=function(){aa.handleInternalConflict(ap.getInternalStatus());aa.getConflicts()};ap.solveInternalNoReason(aF,k,s,true,aH)}else{aa.getConflicts()}};var aD=document.createElement("span");aD.innerHTML=i.MR_Available;aC.appendChild(aD.cloneNode(true));var aB=document.createElement("li");aB.classList.add("item");aB.onclick=function(aG){j.debug(i.MR_NonAvailable+" clicked");ah.classList.add("displaynone");p.updateWrappedTableAndJSONFromContextMenuInteraction(U,ap,A.getBotRightTable(),aF,"N");if(A.getReasonCalculated()===true&&T===true){var aH=function(){aa.handleInternalConflict(ap.getInternalStatus());aa.getConflicts()};ap.solveInternalNoReason(aF,k,s,true,aH)}else{aa.getConflicts()}};aD=document.createElement("span");aD.innerHTML=i.MR_NonAvailable;aB.appendChild(aD.cloneNode(true));var aA=document.createElement("li");aA.classList.add("item");aA.onclick=function(aG){j.debug(i.MR_Default+" clicked");ah.classList.add("displaynone");p.updateWrappedTableAndJSONFromContextMenuInteraction(U,ap,A.getBotRightTable(),aF,"D");if(A.getReasonCalculated()===true&&T===true){var aH=function(){aa.handleInternalConflict(ap.getInternalStatus());aa.getConflicts()};ap.solveInternalNoReason(aF,k,s,true,aH)}else{aa.getConflicts()}};aD=document.createElement("span");aD.innerHTML=i.MR_Default;aA.appendChild(aD.cloneNode(true));var az=document.createElement("li");az.classList.add("item");az.onclick=function(aG){j.debug(i.MR_Standard+" clicked");j.warning(i.MR_Standard+" is not handled yet");ah.classList.add("displaynone");if(A.getReasonCalculated()===true&&T===true){var aH=function(){aa.handleInternalConflict(ap.getInternalStatus());aa.getConflicts()};ap.solveInternalNoReason(aF,k,s,true,aH)}else{aa.getConflicts()}};aD=document.createElement("span");aD.innerHTML=i.MR_Standard;az.appendChild(aD.cloneNode(true));aE.appendChild(aC);aE.appendChild(aB);aE.appendChild(aA);ah.appendChild(aE);ai.appendChild(ah)};var am=function(aA,az){ah.classList.remove("displaynone");ah.style.left=az.pageX+"px";ah.style.top=az.pageY+"px"};this.removeInteractionOnTable=function(aD,aB){j.debug("removing interaction on table & container");K.setAttribute("editable","false");Z.setAttribute("editable","false");var aE=A.getBotRightTable().getElementsByTagName("td");var aC=0;for(aC=0;aC<aE.length;aC+=1){aE[aC].setAttribute("editable","false");aE[aC].classList.add("noneditable")}var aA=A.getBotLeftTable().getElementsByTagName("td");aC=0;for(aC=0;aC<aA.length;aC+=1){aA[aC].setAttribute("editable","false");aA[aC].classList.add("noneditable")}var az=A.getTopRightTable().getElementsByTagName("th");aC=0;for(aC=0;aC<az.length;aC+=1){az[aC].setAttribute("editable","false");az[aC].classList.add("noneditable")}A.getBotLeftTable().setAttribute("editable","false");A.getBotLeftDiv().setAttribute("editable","false");A.getTopRightDiv().setAttribute("editable","false");A.getTopRightTable().setAttribute("editable","false");A.getTopLeftDiv().setAttribute("editable","false");A.getTopLeftTable().setAttribute("editable","false");A.getBotLeftTable().classList.remove("editable");A.getBotLeftDiv().classList.remove("editable");A.getTopRightDiv().classList.remove("editable");A.getTopRightTable().classList.remove("editable");A.getTopLeftDiv().classList.remove("editable");A.getTopLeftTable().classList.remove("editable")};this.addInteractionOnTable=function(aD,aB){j.debug("adding interaction on table & container");K.setAttribute("editable","true");Z.setAttribute("editable","true");var aE=A.getBotRightTable().getElementsByTagName("td");var aC=0;for(aC=0;aC<aE.length;aC+=1){aE[aC].setAttribute("editable","true");aE[aC].classList.remove("noneditable")}var aA=A.getBotLeftTable().getElementsByTagName("td");aC=0;for(aC=0;aC<aA.length;aC+=1){aA[aC].setAttribute("editable","true");aA[aC].classList.remove("noneditable")}var az=A.getTopRightTable().getElementsByTagName("td");aC=0;for(aC=0;aC<az.length;aC+=1){az[aC].setAttribute("editable","true");az[aC].classList.remove("noneditable")}A.getBotLeftTable().setAttribute("editable","true");A.getBotLeftDiv().setAttribute("editable","true");A.getTopRightDiv().setAttribute("editable","true");A.getTopRightTable().setAttribute("editable","true");A.getTopLeftDiv().setAttribute("editable","true");A.getTopLeftTable().setAttribute("editable","true");A.getBotLeftTable().classList.add("editable");A.getBotLeftDiv().classList.add("editable");A.getTopRightDiv().classList.add("editable");A.getTopRightTable().classList.add("editable");A.getTopLeftDiv().classList.add("editable");A.getTopLeftTable().classList.add("editable")};this.changeInternalStatus=function(aB){var az=0;T=!T;window.localStorage.DS_FTR_Matrixrule_InternalConflictSetting=(T===false)?"false":"";if(A.getReasonCalculated()===true&&T===true){ap.solveInternalNoReason(aB,k,s,false,null);aa.handleInternalConflict(ap.getInternalStatus())}else{var aA=A.getBotRightTable().getElementsByTagName("td");for(az=0;az<aA.length;az+=1){aA[az].setAttribute("internal_conflict",false);aA[az].classList.remove("internal_conflict");aA[az].classList.remove("mr_current_highlight")}}aa.getConflicts()}};return m});define("DS/CfgRules/scripts/CfgMatrixRulesHighLevelController",["DS/CfgRules/scripts/CfgMatrixRulesController","DS/EffectivityWebExternalJS/scripts/CriteriaLibs","DS/CfgBaseUX/scripts/ConfigurationFeatureCriteria","DS/CfgRules/scripts/CfgMatrixRulesWebServices","DS/CfgRules/scripts/generateCfgMatrixRulesXMLExpression","i18n!DS/CfgRules/assets/nls/MatrixRule","DS/CfgRules/scripts/traceCfgUtils","DS/CfgRules/scripts/dictionaryCfgUtils","DS/UIKIT/Alert","DS/UIKIT/Mask","UWA/Core","UWA/Element","UWA/Drivers/Alone","css!DS/UIKIT/UIKIT.css"],function(f,k,l,o,j,m,n,c,i,g,e,h,b,d){var a=function(){var G=true;var s=false;var x;var q=null;var z=null;var t=null;var C=null;var r=null;var E=null;var p=null;var F=null;var y=null;var J=null;var H=null;var I=null;var D=null;var v=null;var B=this;var A=null;var u=null;var K=null;this.setPidRule=function(L){D=L};this.setVersionRule=function(L){v=L};this.getMatrixRulesController=function(){return x};this.getSliderContentDiv=function(){return r};this.getSliderToggleDiv=function(){return t};this.init=function(M,L,S,U,P,T,R,O){var N=false||!!document.documentMode;var Q=UWA.createElement("div");D=P;v=T;s=O;p=L;F=document.createElement("div");q=document.createElement("div");q.classList.add("close");if(N){q.classList.add("matrixRulesDivIESpecific")}else{q.classList.add("matrixRulesDiv")}t=document.createElement("div");r=document.createElement("div");E=document.createElement("div");E.classList.add("content5");E.setAttribute("id",M+"-legend");t=document.createElement("div");t.classList.add("sliderToggleDivStyle");t.classList.add("close");C=document.createElement("span");C.classList.add("arrow");C.classList.add("fonticon");C.classList.add("fonticon-right-dir");C.classList.add("close");t.appendChild(C);r=document.createElement("div");if(N){r.classList.add("sliderContentDivIESpecific")}else{r.classList.add("sliderContentDiv")}r.classList.add("close");r.setAttribute("id",M+"-sliderContentId");z=document.createElement("div");z.classList.add("close");if(N){z.classList.add("matrixRulesDivIESpecific")}else{z.classList.add("matrixRulesDiv")}z.classList.add("preferences");z.classList.add("hidden");x=new f();x.init(M,q,S,U,R,O);F.appendChild(r);F.appendChild(t);F.appendChild(q);F.appendChild(z);F.classList.add("content95");y=document.createElement("button");y.setAttribute("id","idcancelMR");y.textContent=m.MR_Reset;y.classList.add("button_bottom");y.classList.add("btn");y.classList.add("btn-default");J=document.createElement("button");J.setAttribute("id","idsaveMR");J.textContent=m.MR_Save;J.classList.add("button_bottom");J.classList.add("btn");J.classList.add("btn-default");H=document.createElement("button");H.setAttribute("id","idinternalsolveMR");H.textContent=m.MR_InternalSolve;H.classList.add("button_bottom");H.classList.add("btn");H.classList.add("btn-default");H.classList.add("displaynone");E.appendChild(J);E.appendChild(y);E.appendChild(H);A=S;I=new i({visible:false,autoHide:true,hideDelay:3000,closeOnClick:true,maximumVisibleMessages:3,className:"MRAlert"});I.inject(F);u=U;if(!O){H.disabled=true;J.disabled=true;y.disabled=true}};this.draw=function(){p.appendChild(F);p.appendChild(E);if(A.id){l.init("IDTABLE-sliderContentId",A.id,A,false)}else{l.init("IDTABLE-sliderContentId","random",A,false)}x.setConfigurationFeatureComponent(l);x.generateContainer(r,A,u,"notype");if(window.localStorage.DS_MatrixruleCookie_ImgSetting==="false"){l.showHideFeatureOptionImages(false)}else{l.showHideFeatureOptionImages(true)}};this.getConflicts=function(){x.getConflicts()};this.displayAlertMessage=function(N,M){console.log("an alert from Solver inconsistency");var O="";var L=0;for(L=0;L<N.length;L+=1){O+=N[L]+" MR_message"}I.add({className:O,message:M});I.show()};this.addInteraction=function(M,L){x.addInteraction(A,L);t.onclick=function(){t.classList.toggle("close");t.classList.toggle("open");r.classList.toggle("close");r.classList.toggle("open");C.classList.toggle("fonticon-right-dir");C.classList.toggle("fonticon-left-dir");q.classList.toggle("open");q.classList.toggle("close");z.classList.toggle("open");z.classList.toggle("close")};J.onclick=function(){c.maskContainer(p);var T=false;if(B.getMatrixRulesController().getDrivingList().length===0||B.getMatrixRulesController().getConstrainedList().length===0){T=true}var Q=B.getMatrixRulesController().getModel().simplifyJSON();if(T){var U=0;Q.drivingFeatures=[];Q.constrainedFeatures=[];for(U=0;U<B.getMatrixRulesController().getDrivingList().length;U+=1){Q.drivingFeatures.push({id:B.getMatrixRulesController().getDrivingList()[U].logicalId})}for(U=0;U<B.getMatrixRulesController().getConstrainedList().length;U+=1){Q.constrainedFeatures.push({id:B.getMatrixRulesController().getConstrainedList()[U].logicalId})}}var Z=j.generateFullExpression(Q,A);n.debug("json to save : ");n.debug(Q);n.debug("mathematical Expression : ");n.debug(Z);n.info("saving rule "+D);var P=null;var ac=o.getObjectIDFromURL("&productPID=");if(ac==null){var X=Z.baseURI.indexOf("&productPID=");if(X!=-1){var W=Z.baseURI.indexOf("&",X+12);if(W==-1){W=Z.baseURI.length}ac=Z.baseURI.substr(X+12,W-(X+12))}}if(!T){P=o.saveRule(D,v,Q,Z.outerHTML,ac)}else{P=o.saveRule(D,v,Q,"",ac)}if(P){var S=JSON.parse(P);if(S.details){var O=S.details.id.substring(4);if(O!=D){if(window.parent.parent.name=="content"){var N=window.parent.parent.location.search;var ab=N.indexOf("objectId=");if(ab!=-1){ab+=9;var V=N.indexOf("&",ab);if(V==-1){V=N.length}var aa=N.substring(ab,V);N=N.replace(aa,O);var Y=window.parent.parent.getTopWindow();Y.bclist.setPosition(Y.bclist.currentPosition()-1);window.parent.parent.location.href="../../common/emxTree.jsp"+N}else{var Y=window.parent.parent.getTopWindow();Y.bclist.setPosition(Y.bclist.currentPosition()-1);window.parent.parent.location.href="../../common/emxTree.jsp?objectId="+O+"&mode=insert&DefaultCategory=RuleTable&AppendParameters=true"}}}}}B.setFirstModel(Q);if(T){B.setFirstModel({})}c.unmaskContainer(p);var U=0;var R=true;for(U=0;U<I.getMessages().length;U+=1){if(c.hasClass(I.elements.container.childNodes[U],"mrsaved_conflict")){R=false;break}}if(R&&!T){if(P!==null&&B.getMatrixRulesController().getConflicts()!==0){I.add({className:"warning mrsaved_conflict MR_message",message:m.MR_SAVE_CONFLICT})}}R=true;for(U=0;U<I.getMessages().length;U+=1){if(c.hasClass(I.elements.container.childNodes[U],"mrsaved")){R=false;break}}if(R){if(P===null){I.add({className:"error mrsaved MR_message",message:m.MR_SAVE_ERROR})}else{I.add({className:"success mrsaved MR_message",message:m.MR_SAVE_OK})}}I.show()};y.onclick=function(){n.debug("cancel clicked");B.getMatrixRulesController().getMatrixRulesWrappedTableObj().getTopLeftTable().innerHTML="";B.getMatrixRulesController().getMatrixRulesWrappedTableObj().getTopRightTable().innerHTML="";B.getMatrixRulesController().getMatrixRulesWrappedTableObj().getBotLeftTable().innerHTML="";B.getMatrixRulesController().getMatrixRulesWrappedTableObj().getBotRightTable().innerHTML="";B.getMatrixRulesController().getDrivingUL().innerHTML="";B.getMatrixRulesController().getConstrainedUL().innerHTML="";B.getMatrixRulesController().setConstrainedList([]);B.getMatrixRulesController().setDrivingList([]);B.getMatrixRulesController().getMatrixRulesTableObj().reset();r.innerHTML="";var N=true;if(window.localStorage.DS_MatrixruleCookie_ImgSetting==="false"){N=false}if(w&&w.drivingCombinations){if(w.drivingCombinations.length==0){B.getMatrixRulesController().getModel().setNumberColumns(1)}else{B.getMatrixRulesController().getModel().setNumberColumns(w.drivingCombinations.length)}}else{B.getMatrixRulesController().getModel().setNumberColumns(1)}if(w!==null&&w.drivingFeatures!==null&&w.constrainedFeatures!==null&&w.drivingFeatures!==undefined&&w.constrainedFeatures!==undefined){if(w.drivingFeatures.length>0&&w.constrainedFeatures.length>0){w=B.getMatrixRulesController().checkAndRemoveDiscrepancy(w,M)._simplifiedModel;B.getMatrixRulesController().loadJsonIn(w,M,L);B.getMatrixRulesController().showCurrentView()}else{B.getMatrixRulesController().setView("structView");w=B.getMatrixRulesController().checkAndRemoveDiscrepancy(w,M)._simplifiedModel;B.getMatrixRulesController().loadJsonIn(w,M,L);B.getMatrixRulesController().showCurrentView()}B.draw();if(s){B.addInteraction(M,L);B.addInteractionOnTable(M,L)}else{B.addInteraction(M,L);B.removeInteractionOnTable(M,L)}B.getConflicts()}else{B.getMatrixRulesController().setView("structView");B.getMatrixRulesController().initUL();B.getMatrixRulesController().showCurrentView();B.draw();B.getMatrixRulesController().setView("editView");if(s){B.addInteraction(M,L);B.addInteractionOnTable(M,L)}else{B.addInteraction(M,L);B.removeInteractionOnTable(M,L)}B.getConflicts()}}};this.removeInteractionOnTable=function(M,L){r.setAttribute("editable",false);r.classList.remove("editable");y.disabled=true;J.disabled=true;x.removeInteractionOnTable(M,L)};this.addInteractionOnTable=function(M,L){r.setAttribute("editable",true);r.classList.add("editable");x.addInteractionOnTable(M,L)};var w=null;this.setFirstModel=function(L){w=L};this.getFirstModel=function(){return w}};return a});