define("DS/Spreadsheet/CellModel",["UWA/Core","UWA/Event","DS/Core/Core"],function(e,a,d){var c=-1;function b(g,f){this.defaultOptions={isHeader:false,isStatic:false,isHidden:false,isEditable:undefined,isResizable:true,value:undefined,rowID:0,columnID:0,manager:null,width:100,height:28,rowSpan:1,colSpan:1};this.options=g;this._parentElement=f;this._manager=this.options.manager;this._style=null;this._cellCssClasses=null;this._highlightClass="wux-datagrid-cell-highlighted";this._isActive=false;this._isHighlighted=false;this._isSelected=false;this._isInWriteMode=undefined;this._viewIsUpdated=false;this._id=c++}b.prototype.destroy=function(){this.defaultOptions=null};b.prototype._getID=function(){return this._id};b.prototype.isMerged=function(){return this.options.rowSpan===0&&this.options.colSpan===0};b.prototype.isEdited=function(){return this._isInWriteMode};b.prototype.setMergeState=function(f){if(!f){this.options.rowSpan=1;this.options.colSpan=1}else{this.options.rowSpan=0;this.options.colSpan=0}};b.prototype.resetSpan=function(){var m={virtualRowID:this.getRowID(),virtualColumnID:this.getColumnID()};var k=this.getRowSpan();var l=this.getColSpan();for(var h=0;h<k;h++){for(var f=0;f<l;f++){var g=this._manager.getCell(m.virtualRowID+h,m.virtualColumnID+f);g.setMergeState(false);g._show()}}};b.prototype.setRowSpan=function(g,f){this.options.rowSpan=g;this.options.shiftRowSpan=f};b.prototype.getRowSpan=function(){return this.options.rowSpan};b.prototype.setColSpan=function(g,f){this.options.colSpan=g;this.options.shiftColSpan=f};b.prototype.getColSpan=function(){return this.options.colSpan};b.prototype.notifyModelUpdate=function(){this._manager._modelEvents.publish({event:"cellModelUpdate",data:{},context:this})};b.prototype.setCellContent=function(f){this.options.oldValue=this.options.value;this.options.value=f};b.prototype.getCellContent=function(){return this.options.value!==undefined?this.options.value:""};b.prototype.setCoordinates=function(g,f){this.options.rowID=g;this.options.columnID=f};b.prototype.getRowID=function(){return this.options.rowID};b.prototype.getColumnID=function(){return this.options.columnID};b.prototype.getView=function(){return this._view};b.prototype.setView=function(f){this._view=f};b.prototype.setCellStyle=function(f){this._style=f};b.prototype.removeClass=function(f){if(this._cellCssClasses){var g=this._cellCssClasses.indexOf(f);if(g!==-1){this._cellCssClasses.splice(g,1);if(this._cellCssClasses.length===0){this._cellCssClasses=null}}}};b.prototype.hasClass=function(f){if(this._cellCssClasses){var g=this._cellCssClasses.indexOf(f);return(g!==-1)}else{return false}};b.prototype.addClass=function(f){if(this._cellCssClasses===null){this._cellCssClasses=[]}if(this._cellCssClasses.indexOf(f)===-1){this._cellCssClasses.push(f)}};b.prototype.getCssClasses=function(){return this._cellCssClasses||[]};b.prototype.active=function(){this._isActive=true};b.prototype.inactive=function(){this._isActive=false};b.prototype.isActive=function(){return this._isActive};b.prototype.isHighlighted=function(){return this._isHighlighted};b.prototype.highlight=function(){this._isHighlighted=true};b.prototype.unhighlight=function(){this._isHighlighted=false};b.prototype.isSelected=function(){return this._isSelected};b.prototype.select=function(){this._isSelected=true;this.highlight()};b.prototype.unselect=function(){this._isSelected=false;this.unhighlight()};b.prototype.getCellStyle=function(){return this._style};b.prototype._show=function(){this.options.isHidden=false};b.prototype._hide=function(){this.options.isHidden=true};b.prototype.isHidden=function(){return this.options.isHidden};b.prototype._getPositionInViewPort=function(){return{x:this._x,y:this._y}};b.prototype._getDimensions=function(){var g=this._manager.getColumnsManager().getColumnWidth(this.options.columnID);var f=this._manager.getRowsManager().getRowHeight(this.options.rowID);return{width:g,height:f}};return b});define("DS/Spreadsheet/CellView",["UWA/Core","UWA/Controls/Abstract","DS/Core/PointerEvents","DS/Layouts/GridEngineCellAbstract","DS/UIBehaviors/ContextualMenuManager","DS/Utilities/Dom","DS/Utilities/Utils","DS/Menu/ContextualMenu","css!DS/Menu/assets/css/Menu.css"],function(d,f,e,c,j,a,h,g){var i=-1;function k(r){var q=r.target||r.srcElement,n=q.currentStyle||window.getComputedStyle(q,null),m=parseInt(n.borderLeftWidth,10),p=parseInt(n.borderTopWidth,10),o=q.getBoundingClientRect(),l=r.clientX-m-o.left,s=r.clientY-p-o.top;return{offsetX:l,offsetY:s}}var b=c.extend({defaultOptions:{isHeader:false},init:function(n){this._parent(n);this.getGridEngine()._enableInteractiveSort();this._dataGrid=this.options.parent;this._manager=this.options.gridEngine;this._isFlaggedForEdition=false;this._cellProps={};this._cellInfos=null;this.elements.container.setAttribute("wux-uuid",this._uxid);if(this.options.isHeader){if(this._manager.options.resize.rows||this._manager.options.resize.columns){this._manageResize()}}if(this._dataGrid.options.enableDragAndDrop===true){this._manageDragAndDrop()}var p=this;var m=this.getGridEngine()._getParent().options.onContextualEvent;if(m){var q=g.addEventListener(this.elements.container,{callback:function(r){return m.callback.call(m["this"],{context:r.context,infos:r.info,data:r.data,treeview:p.getCellInfos()})}})}else{var o=this.getGridEngine().options.onContextualMenuReady;var l=o;if(typeof o==="function"){l=function(){console.warn("[DS/Tree/TreeListView] onContextualMenuReady is now deprecated, please use the new onContextualEvent option instead");var r=p.getCellInfos();return o.call(p,r)}}j.listen({target:this.elements.container,nodes:l})}this._debouncedUpdateInternalParameters=h.debounce((function(){this.updateInternalParameters()}).bind(this),this.getGridEngine().options.performances.debounceCellInternalUpdateTimer)},destroy:function(){a.removeAllEventsOnElement(this);this._debouncedUpdateInternalParameters=null;delete this._debouncedUpdateInternalParameters;for(var l in this.elements){if(this.elements[l].dsView){this.elements[l].dsView=null;delete this.elements[l].dsView}if(this.elements[l].destroy){this.elements[l].destroy()}}j.forget({target:this.elements.container});this._cellInfos=null;this._manager=null;this._parent()},getCellInfos:function(){if(this._cellInfos===null){var o=this.getVirtualCoordinates();var l=this.getGridEngine();var n=l.getColumnOptions(o.virtualColumnID);var m=n.dataIndex;this._cellInfos={virtualRowID:o.virtualRowID,virtualColumnID:o.virtualColumnID,cellModel:l.getCell(o.virtualRowID,o.virtualColumnID),cellView:this,dataIndex:m,typeRepresentation:n.typeRepresentation,manager:l,isHeader:o.virtualRowID===-1||o.virtualColumnID===-1};return this._cellInfos}else{return this._cellInfos}},getCellModel:function(){var l=this.getVirtualCoordinates();return this.getGridEngine().getCellModel(l.virtualRowID,l.virtualColumnID)},getDragAndDropInfos:function(){return this._dataToBeTransferred},_clean:function(){this.elements.container.removeAttribute("virtual-row-id");this.elements.container.removeAttribute("virtual-column-id");if(this._cellModel){this._cellModel.setView(undefined);this._cellModel=undefined}},switchToWriteView:function(){var l=this.getCellInfos();this._isFlaggedForEdition=true;l.cellModel._isInWriteMode=true;this._updateView();this.getGridEngine()._modelEvents.publish({event:"cell:write",data:l})},isInEditionMode:function(){var m=this.getCellInfos();var l=m.cellModel;return l._isInWriteMode},_buildWriteView:function(){var r=this.getCellInfos();var m=r.cellModel;var l=document.createAttribute("is-edited");this.getContent().setAttributeNode(l);if(m._isInWriteMode===true){var q=this.getVirtualCoordinates().virtualColumnID;var p=this.getGridEngine()._getViewForCell({cellView:this,virtualColumnID:q});var n=p.switchToWriteView.view.call(this,this.getCellInfos());if(n!==undefined){this._cellReadWriteView=n;this.elements.container.empty();if(this._cellReadWriteView instanceof f){this.elements.container.appendChild(this._cellReadWriteView.getContent())}else{this.elements.container.appendChild(this._cellReadWriteView)}this._cellReadWriteView.focus()}var o=this}},_saveChanges:function(){var l=this._cellModel;var n=this.getVirtualCoordinates().virtualColumnID;var m=this.getGridEngine()._getViewForCell({cellView:this,virtualColumnID:n});l._isInWriteMode=false;var o=this.getCellInfos();m.switchToReadView.callback.call(this,o);this.notifyModelUpdate()},notifyModelUpdate:function(){return this.getCellInfos().cellModel.notifyModelUpdate()},getWriteView:function(){return this._cellReadWriteView},switchToReadView:function(){var l=this.getCellInfos();this._isFlaggedForEdition=false;if(l.cellModel){l.cellModel._isInWriteMode=false;l.manager.updateCellView(l.virtualRowID,l.virtualColumnID)}this.getGridEngine()._modelEvents.publish({event:"cell:read-only",data:l})},_onChange:function(l){var m=this.getCellInfos();m.manager.setCellContent(m.virtualRowID,m.virtualColumnID,l.target.value);m.cellModel.notifyModelUpdate()},_buildReadView:function(){this.getContent().removeAttribute("is-edited");var m=this;if(this._cellModel){var p=this.getCellInfos();var o=this.getGridEngine().getColumnOptions(p.virtualColumnID);if(this.getGridEngine()._getParent()._getEditionMode()!==2&&o&&typeof o.onCellRequest==="function"){m.getGridEngine()._isRequestingCell=true;this._cellReadWriteView=o.onCellRequest.call(p.manager,p);m.getGridEngine()._isRequestingCell=false}else{var n=m.getGridEngine()._getViewForCell({cellView:m,virtualColumnID:p.virtualColumnID});if(n){var l=n.switchToReadView.view.call(this._cellModel,this.getCellInfos());if(l!==undefined){this._cellReadWriteView=l;if(typeof this._cellReadWriteView==="string"){if(h.getUnsafeHTMLContentValueToApply(m.getGridEngine().options.shouldCellAllowUnsafeHTMLContentAt(p))===false){this.elements.container.textContent=this._cellReadWriteView}else{this.elements.container.innerHTML=this._cellReadWriteView}}else{this.elements.container.setContent(this._cellReadWriteView)}this._cellModel._isInWriteMode=false}}}}},_updateView:function(){var m=this.getCellInfos();var l=m.cellModel;if(l._isInWriteMode){this._buildWriteView()}else{this._buildReadView()}},active:function(){this._cellModel.active();this.elements.container.addClassName("wux-ui-state-active")},inactive:function(){this._cellModel.inactive();this.elements.container.removeClassName("wux-ui-state-active")},beginEdition:function(){this._isFlaggedForEdition=true;this.getGridEngine().updateView()},endEdition:function(){this._isFlaggedForEdition=true;this.getGridEngine().updateView()},highlight:function(){if(this._cellModel){this._cellModel._isHighlighted=true}this._isHighlighted=true;this.elements.container.addClassName(this._cellModel._highlightClass)},unhighlight:function(){if(this._cellModel){this._cellModel._isHighlighted=false}if(this._isHighlighted){this._isHighlighted=false;this.elements.container.removeClassName(this._cellModel._highlightClass)}},select:function(){this._lastClickTime=Date.now();this._cellModel._isSelected=true;this.highlight()},unselect:function(){this._lastClickTime=0;this._cellModel._isSelected=false;this.unhighlight()},_manageResize:function(){var u=this;u.getGridEngine()._enableInteractiveSort();var o=5;var v=this.elements.container;var y=false;var B,p,A,n;a.addEventOnElement(this,v,e.POINTERMOVE,function(E){if(!x){var D=u.getCellInfos();B=D;p=D.manager;n=p.getColumnWidth(B.virtualColumnID);A=p.getRowHeight(B.virtualRowID);var C=k(E);if(B.virtualRowID===i&&p.options.resize.columns){if(C.offsetX<n+o&&C.offsetX>n-o){u._setResizeStyle("r");y=true}else{u._setResizeStyle();y=false}}if(B.virtualColumnID===i&&p.options.resize.rows){if(C.offsetY<A+o&&C.offsetY>A-o){u._setResizeStyle("b");y=true}else{u._setResizeStyle();y=false}}}});var s=false;var x=false;var t={};var q={};var r;var l;var w=d.extendElement(document);var m=0;var z=Infinity;a.addEventOnElement(this,v,e.POINTERDOWN,function(E){if(E.originalEvent.type==="touchstart"){y=true;o=32;B=u.getCellInfos();p=u.getGridEngine();n=p.getColumnWidth(B.virtualColumnID);A=p.getRowHeight(B.virtualRowID)}var C=k(E);if(y){if(((B.virtualColumnID===i)&&(C.offsetY<A+o&&C.offsetY>A-o))||((B.virtualRowID===i)&&(C.offsetX<n+o&&C.offsetX>n-o))){E.preventDefault();p.getScroller().getContent().addClassName("wux-ui-locked");p.lockUI();t={x:E.clientX,y:E.clientY};r=n;l=A;x=true;var D=u.getGridEngine()._getColumnOptionValue(B.virtualColumnID,"maxWidth");z=D!==undefined?D:Infinity;m=u.getGridEngine()._getColumnOptionValue(B.virtualColumnID,"minWidth");u.getGridEngine()._disableInteractiveSort(true)}}});a.addEventOnElement(this,document,e.POINTERMOVE,function(C){if(x&&y){if(!s){u.getGridEngine()._disableInteractiveSort()}s=true;q.x=C.clientX-t.x;q.y=C.clientY-t.y;if(B.virtualRowID===i){if((n+q.x)>=m&&(n+q.x)<=z){r=n+q.x;u._manager._updateViewOptions={detachAllViews:false,updateCells:false,updateColumnsHeaders:true};p._instance._showColumnInsertionMark(p.getScroller().getPosition().x+p.getHeadersDimensions().width+p.getColumnPosition(B.virtualColumnID)+r)}}if(B.virtualColumnID===i){l=A+q.y;if(l>=0){p._instance._showRowInsertionMark(p.getScroller().getPosition().y+p.getHeadersDimensions().height+p.getRowPosition(B.virtualRowID)+l)}}}});a.addEventOnElement(this,document,e.POINTERUP,function(C){if(x){C.preventDefault();C.stopPropagation();u._setResizeStyle();if(u.elements.container){u.elements.container.removeClassName("wux-ui-state-active")}setTimeout(function(){u.getGridEngine()._enableInteractiveSort()},300);if(B.virtualRowID!==-1){p.setRowHeight(B.virtualRowID,l)}if(B.virtualColumnID!==-1){p.prepareUpdateView();p.setColumnWidth(B.virtualColumnID,r);p._requireFullUpdate();u._manager._updateViewOptions={detachAllViews:true,updateCells:true,updateColumnsHeaders:true};p._recordInteractionFromUI({event:"column:resize",data:{dataIndex:B.dataIndex,width:r}});p.pushUpdateView(true)}p._instance._hideRowInsertionMark();p._instance._hideColumnInsertionMark();p.unlockUI();x=false;y=false}})},_setResizeStyle:function(m){var l=this.elements.container;if(m){l.addClassName("wux-datagrid-header-resize-"+m)}else{l.removeClassName("wux-datagrid-header-resize-l");l.removeClassName("wux-datagrid-header-resize-r");l.removeClassName("wux-datagrid-header-resize-t");l.removeClassName("wux-datagrid-header-resize-b")}},_manageDragAndDrop:function(){this.getContent().setAttribute("draggable",true)},getPosition:function(){var m=this.getGridEngine();var q=this.getVirtualCoordinates();var o=q.virtualRowID;var n=q.virtualColumnID;var l=m.getCellModel(q.virtualRowID,q.virtualColumnID);if(l){if(l.options.shiftRowSpan){o=o+l.options.shiftRowSpan}if(l.options.shiftColSpan){n=n+l.options.shiftColSpan}}var p=m.getCellPosition(o,n);if(p.top<0){p.top=0}if(p.left<0){p.left=0}return p},getDimensions:function(){var l=this.getGridEngine();var m=this.getVirtualCoordinates();return{width:l.getColumnWidth(m.virtualColumnID),height:l.getRowHeight(m.virtualRowID)}},_setVirtualCoordinates:function(q){this._virtualRowID=q.virtualRowID;this._virtualColumnID=q.virtualColumnID;this._dataGrid=this.options.parent;this._manager=this._dataGrid._cellsManager;this._cellInfos=null;var p=this.getVirtualCoordinates();var o=this.getCellInfos();this._cellModel=o.cellModel;var n=this.getGridEngine().getDataIndexFromColumnID(q.virtualColumnID);if(q.rowID!==undefined){this.elements.container.setAttribute("row-id",q.rowID)}if(q.columnID!==undefined){this.elements.container.setAttribute("column-id",q.columnID)}this.elements.container.setAttribute("data-index",n);this.elements.container.setAttribute("virtual-row-id",this._virtualRowID);this.elements.container.setAttribute("virtual-column-id",this._virtualColumnID);if(this.getGridEngine().options.performances.use2PassRendering){this.elements.container.addClassName("wux-ui-tombstone")}var l=this.getCellInfos();l.data={rowID:q.virtualRowID,columnID:q.virtualColumnID};l.model=this._cellModel;l.view=this.elements.container;l.parent=this._dataGrid;this._dataToBeTransferred={from:l,data:{rowID:p.virtualRowID,columnID:p.virtualColumnID}};if(this._drag){this._drag.updateDataToBeTransferred(this._dataToBeTransferred)}var m=this.getCellModel();if(m){m.options.rowID=q.virtualRowID;m.options.columnID=q.virtualColumnID;m.options.virtualRowID=q.virtualRowID;m.options.virtualColumnID=q.virtualColumnID;m._view=this}},_free:function(){if(this._reusableContent){this._reusableContent.__disposable__.dispose();this._reusableContent=undefined;this._parent()}},_resetCell:function(){var l=this.elements.container;var m=this.getCellInfos();if(!m.isHeader){m.cellModel._isInWriteMode=false}if(m.virtualRowID===-1){l.removeClassName("wux-ui-sort-desc");l.removeClassName("wux-ui-sort-asc")}},updateInternalParameters:function(){var v=this;var z=this.getCellInfos();var q=this.elements.container;var t=z.cellModel;var p=true;this._resetCell();this._dataGrid=this.options.parent;this._manager=z.manager;this._cellModel=t;if(t){if(z.virtualRowID===-1&&q.hasClassName("wux-ui-sort-desc")){q.removeClassName("wux-ui-sort-desc")}if(z.virtualRowID===-1&&q.hasClassName("wux-ui-sort-asc")){q.removeClassName("wux-ui-sort-asc")}if(z.virtualRowID%2===0){q.addClassName("wux-datagrid-cell-even")}else{q.removeClassName("wux-datagrid-cell-even")}q.dsView=this;t.setView(v);var m=t.getCssClasses();if(m.length>0){m.forEach(function(B){q.removeClassName(B)});q.addClassName(m.join(" "))}if(v._cellProps.isActive!==t.isActive()){if(t.isActive()){v.active()}else{v.inactive()}v._cellProps.isActive=t.isActive()}if(t.isHighlighted()){v.highlight()}else{v.unhighlight()}v._cellProps.isHighlighted=t.isHighlighted();if(t.getCellStyle()){q.setStyles(t.getCellStyle())}if(!t._isInWriteMode&&z.virtualRowID!==-1&&z.virtualColumnID!==-1){v._updateView()}if(t.isHidden()){p=true}else{p=false}var w=t.getRowSpan();var s=t.getColSpan();var o=0;var A=0;if(w>1){for(var r=0;r<w;r++){A=A+this._manager.getRowHeight(z.virtualRowID+r)}}else{A=this.getDimensions().height}if(s>1){for(var r=0;r<s;r++){var l=this._manager.getColumnWidth(z.virtualColumnID+r+t.options.shiftColSpan);o=o+l}}else{o=this.getDimensions().width}var x,u;var n={};if(o!==this._cellProps.width){this._cellProps.width=o;x=o;n.width=x}if(A!==this._cellProps.height){this._cellProps.height=A;u=A;n.height=u;n.lineHeight=(u-1)+"px"}a.setStyles(q,n);if((A===0||o===0||p)&&z.virtualColumnID!==i){var y=document.createAttribute("is-hidden");q.setAttributeNode(y)}else{q.removeAttribute("is-hidden")}}this._parent();if(this.getGridEngine().options.performances.use2PassRendering){q.removeClassName("wux-ui-tombstone")}},hide:function(){this.elements.container.hide()},updateView:function(){var l=this.getVirtualCoordinates();this.getGridEngine().updateCellView(l.virtualRowID,l.virtualColumnID)},_cancelChanges:function(){}});return b});define("DS/Spreadsheet/Manager",["UWA/Core","UWA/Event","UWA/Controls/Abstract","DS/Core/Core","DS/Spreadsheet/CellView","UWA/Class","DS/CoreEvents/ModelEvents","DS/Spreadsheet/CellModel","UWA/Utils","DS/Selection/XSO","DS/Layouts/GridEngine","DS/Utilities/Dom","DS/Core/PointerEvents","DS/UIBehaviors/ContextualMenuManager","DS/Core/ActionsStack","DS/Utilities/Data","DS/Utilities/Array","DS/Utilities/Debug","DS/Controls/Switch","DS/SmartInputs/Number","DS/SmartInputs/Angle","DS/SmartInputs/EulerOrientation","DS/SmartInputs/Distance","DS/SmartInputs/Vector3","DS/Controls/Button","DS/Controls/Toggle","DS/Utilities/Utils","DS/Menu/ContextualMenu","DS/WebRecordEnabler/Adapter","css!DS/Menu/assets/css/Menu.css"],function(h,D,L,n,C,d,s,o,k,J,u,x,l,B,H,z,t,f,v,j,c,b,m,p,G,e,E,q,y){var w=false;var K=false;var g={click:"click",dblClick:"dblClick"};function a(O,M){var Q={},P={},N;N=M.offsetParent;Q.x=O.touches?O.touches[0].pageX:O.pageX;Q.y=O.touches?O.touches[0].pageY:O.pageY;P.left=M.offsetLeft;P.top=M.offsetTop;while(N){P.left+=N.offsetLeft;P.top+=N.offsetTop;N=N.offsetParent}return{x:Q.x-P.left,y:Q.y-P.top}}function A(O,N){var M=O;if(M){var P=(" "+M.className+" ").replace(/[\n\t]/g," ").indexOf(" "+N+" ")>-1;if(P){return M}else{return A(M.parentNode,N)}}else{}}function F(N,M){var O=(" "+N.className+" ").replace(/[\n\t]/g," ").indexOf(" "+M+" ")>-1;return O}var r=function(O,M){if(M===undefined){M=0}var N=O.slice(0);return{getCurrent:function(){return N[M]},getNext:function(){M=++M%N.length;return this.getCurrent()},getPrevious:function(){if(--M<0){M+=N.length}return this.getCurrent()}}};var i=t.optimizedForEach;var I=u.extend({defaultOptions:{onCellChange:function(M){return M.event.target.value},scroller:null,viewport:null,sortFunction:function(R,O,N,Q){var P;var S=O[R].getCellContent();var M=N[R].getCellContent();if(S===M){P=0}else{if(Q!=="desc"){P=S<M?-1:1}else{P=S>M?-1:1}}return P}},init:function(N,M){var R=this;if(N.isEditable){var P={switchToWriteView:{event:"dblclick",callback:function(S){this.switchToWriteView()},view:function(U){if(!U.isHeader){var T=U.cellModel.getCellContent().toString();var S=new h.Element("input",{type:"text",value:T,"class":"wux-layouts-treeview-label"});setTimeout(function(){S.setSelectionRange(0,S.value.length)},10);return S}}},switchToReadView:{event:"blur",callback:function(S){this.switchToReadView()},view:function(U){if(!U.isHeader){var T;var S=U.cellModel.getCellContent().toString();if(typeof S==="string"){T=S}else{T=S.toString()}switch(U.dataIndex){default:return T}}}},nodesAreDraggable:true,cells:true};if(N.isEditable===true){N.isEditable=P}else{N.isEditable=h.extend(P,N.isEditable,true)}}this._parent(N);var R=this;this._instance=M;this._highlightedRows=new J({eventChannel:"/MANAGER/"+k.getUUID()});this._selectedRows=new J({useUniqueID:true,getElementID:function(S){return S},publishOnlyPrePostEvents:true,eventChannel:"/MANAGER/"+k.getUUID(),areEquals:function(S,T){return S===T}});this._selectedColumns=new J({eventChannel:"/MANAGER/"+k.getUUID()});this._selectedCells=new J({useUniqueID:true,publishOnlyPrePostEvents:true,eventChannel:"/MANAGER/"+k.getUUID(),areEquals:function(T,S){return T._getID()===S._getID()}});this._modeIsMultiSel=false;this._modeIsRange=false;this._allowSettingMultiSelMode=false;this._multiSelModeHasBeenForced=false;this._selectedRows.empty();this._selectedColumns.empty();this._selectedCells.empty();this._scroller=null;this._viewport=null;this._leftStaticContainer=null;this._topStaticContainer=null;this._cellsContainer=null;this._isPreparingView=0;this._abortComputing=false;this._listOfColumnIsEditableOptionsCached=[];this.options.model=[];this._cellsContentList=[];this._rowsList=[];this._columnsList=[];this._rowIndexes=[];this._listOfColumns=[];this._listOfColumnStates=[];this._listOfCellsInViewPort=[];this._listOfRowsPosition=[];this._listOfColumnPosition=[];this._listOfRowsHeight=[];this._listOfRowsPreviousHeight=[];this._listOfColumnsWidth=[];this._listOfColumnsPreviousWidth=[];this._listOfEditedCells=[];this._columnsReverseIndex=null;this._currentViewPort={rowMin:0,rowMax:0,columnMin:0,columnMax:0};this._previousViewPort={rowMin:0,rowMax:0,columnMin:0,columnMax:0};this._minVisibleCellCoordinates={rowID:1,columnID:1};this._maxVisibleCellCoordinates={rowID:1,columnID:1};this._lastScrollPos={x:0,y:0};this._deltaScrollPos={x:0,y:0};this.registerReusableCellContent({id:"picture",buildContent:function(){var S=R.options.defaultCellHeight-10;return new x.createElement("div",{align:"center",styles:{width:S,height:S,borderRadius:2,backgroundSize:"cover",backgroundPosition:"center",display:"inline-block",border:"1px solid rgb(157, 157, 157)",verticalAlign:"middle",position:"absolute",top:"50%",marginTop:-S/2,left:"50%",marginLeft:-S/2}})}});this.registerReusableCellContent({id:"color",buildContent:function(){var S=R.options.defaultCellHeight-10;return new h.Element("div",{align:"center","class":"wux-datagrid-cell-type-color",styles:{width:S/2,height:S,marginTop:-S/2,marginLeft:-S/4}})}});this.onPoolCellCreation(this._onPoolCellCreation.bind(this));this.onPoolCellDestruction(this._onPoolCellDestruction.bind(this));this._observeSelMultiSel();var O=this;var Q=false;this.onReady(function(){if(Q===false){x.addEventOnElement(this,this.elements.container,l.POINTERDOWN,function(){O._giveFocus()},true);var W=this;var Y;x.addEventOnElement(this,this.getScroller().getContent(),"mouseover",function(aa){var Z=F(aa.target,"wux-datagrid-cell")?aa.target:A(aa.target,"wux-datagrid-cell");if(Z&&Z!==Y){W._modelEvents.publish({event:"newActiveCell",data:Z.dsView.getCellInfos()});Y=Z}});x.addEventOnElement(this,this.getScroller().getContent(),"mouseleave",function(Z){if(F(Z.target,"wux-scroller")){W._modelEvents.publish({event:"newActiveCell",data:null})}});var T=this._getParent().options.onContextualEvent;if(T){q.addEventListener(this.elements.container,{callback:function(Z){return T.callback.call(T["this"],{context:Z.context,infos:Z.info,data:Z.data,treeview:{manager:O}})}})}else{var V=this.options.onContextualMenuReady;var S=V;if(typeof V==="function"){S=function(){console.warn("[DS/Tree/TreeListView] onContextualMenuReady is now deprecated, please use the new onContextualEvent option instead");return V.call(O,{manager:O})}}B.onReady({target:this.elements.container,nodes:S})}if(this.options.selection.unselectAllOnEmptyArea){this._listenToClickOnEmptyArea()}this._listOfEditedCells=[];this._modelEvents.subscribe({event:"cell:write"},function(aa){if(O._listOfEditedCells.length>0){O._listOfEditedCells.forEach(function(ab){if(aa.virtualRowID!==ab.virtualRowID&&aa.virtualColumnID!==ab.virtualColumnID){aa.cellView.switchToReadView()}});O._listOfEditedCells=[]}var Z=document.createAttribute("is-edited");aa.cellView.getContent().setAttributeNode(Z);O._listOfEditedCells.push(aa)});this._modelEvents.subscribe({event:"cell:read-only"},function(Z){Z.cellView.getContent().removeAttribute("is-edited");if(O._listOfEditedCells.length>0){O._listOfEditedCells=[]}});this._getParent()._datagrid.getContent().addEvent("blur",function(aa){setTimeout(function(){if(document.activeElement){var ab=F(document.activeElement,"wux-afr-actionbar")?document.activeElement:A(document.activeElement,"wux-afr-actionbar");var ac=F(document.activeElement,"wux-datagrid")?document.activeElement:A(document.activeElement,"wux-datagrid");if(ac&&(ac.getAttribute("wux-uuid")===O._instance._uxid)&&!ab){O._giveFocus()}else{O._lostFocus()}}},1);if(aa.relatedTarget){var Z=x.firstParentWithClass(aa.relatedTarget,"wux-datagrid");if((!Z||Z!==this)&&!W._multiSelModeHasBeenForced){W._modeIsListSel=false;W._modeIsMultiSel=false}}else{if(!W._multiSelModeHasBeenForced){W._modeIsListSel=false;W._modeIsMultiSel=false}}},true);this._getParent()._datagrid.getContent().addEvent("mouseleave",function(Z){if(!W._multiSelModeHasBeenForced){W._modeIsListSel=false;W._modeIsMultiSel=false}W._allowSettingMultiSelMode=false},true);this._getParent()._datagrid.getContent().addEvent("mouseenter",function(Z){W._allowSettingMultiSelMode=false},true);this._getParent()._datagrid.getContent().addEvent("mousemove",function(Z){W._allowSettingMultiSelMode=true},true);var U;this._getParent()._datagrid.getContent().addEvent("focus",function(ac){if(O.elements.container){var Z=F(ac.target,"wux-datagrid-cell")?ac.target:A(ac.target,"wux-datagrid-cell");var aa=O.elements.container.querySelector(".wux-datagrid-cell[is-edited]");if(aa){var ab=O._getCellViewFromDom(aa);if((Z&&ab.getContent().getAttribute("wux-uuid")!==Z.getAttribute("wux-uuid"))||Z===undefined){ab.switchToReadView()}}if(Z){U=Z.getAttribute("wux-uuid")}O._giveFocus()}},true);this._getParent().elements.formContainer.addEvent("blur",function X(Z){setTimeout(function(){var ab=F(document.activeElement,"wux-datagrid-cell")?Z.target:A(document.activeElement,"wux-datagrid-cell");if(ab){if(ab&&U!==ab.getAttribute("wux-uuid")){O._onCellBlur.call(O,Z)}}else{var aa=F(document.activeElement,"wux-afr-actionbar")?document.activeElement:A(document.activeElement,"wux-afr-actionbar");if(!aa){O._lostFocus()}}},1)},true);this._getParent().elements.formContainer.addEvent("change",this._onCellChange.bind(this));this._getParent().elements.formContainer.addEvent("submit",function(aa){aa.stopPropagation();aa.preventDefault();var Z=document.createEvent("CustomEvent");Z.initCustomEvent("change",true,true,null);if(document.activeElement.tagName!=="BUTTON"&&A(document.activeElement,"wux-datagrid-cell")){document.activeElement.dispatchEvent(Z)}O._giveFocus();return false},true);x.addEventOnElement(this,document,"keydown",function(aa){var Z=h.Event.whichKey(aa);if(Z==="esc"){if(O._listOfEditedCells.length>0){O._listOfEditedCells[0].cellView._cancelChanges()}}});this.getScroller().onScroll(function(){O.__preventDragAndDropOnBlankDuringScrollFlag=true;if(O.__preventDragAndDropOnBlankDuringScroll){clearTimeout(O.__preventDragAndDropOnBlankDuringScroll)}O.__preventDragAndDropOnBlankDuringScroll=setTimeout(function(){O.__preventDragAndDropOnBlankDuringScrollFlag=false},500)})}Q=true})},destroy:function(){x.removeAllEventsOnElement(this);this._instance=null;delete this._instance;this._selectedCells.empty();this._selectedCells=null;if(this.elements.container){B.forget({target:this.elements.container});this.processPoolCells(function(M){B.forget({target:M.cellView.elements.container})});t.clear(this._listOfColumnIsEditableOptionsCached);t.clear(this._cellsContentList);t.clear(this._rowsList);t.clear(this._columnsList);t.clear(this._rowIndexes);t.clear(this._listOfColumns);t.clear(this._listOfColumnStates);t.clear(this._listOfCellsInViewPort);t.clear(this._listOfRowsPosition);t.clear(this._listOfColumnPosition);t.clear(this._listOfRowsHeight);t.clear(this._listOfRowsPreviousHeight);t.clear(this._listOfColumnsWidth);t.clear(this._listOfColumnsPreviousWidth);this._parent()}},_onCellBlur:function(O){var M=A(O.target,"wux-datagrid-cell");if(M){var N=this._getCellViewFromDom(M);N.switchToReadView()}},_onCellChange:function(Q){var N=this;var M=A(Q.target,"wux-datagrid-cell");if(M){var P=N._getCellViewFromDom(M);var R=P.getCellInfos();var O=N._getViewForCell({cellView:P,virtualColumnID:R.virtualColumnID});N.setCellContent(R.virtualRowID,R.virtualColumnID,Q.target.value);R.event=Q;O.switchToReadView.callback.call(P,R);P.notifyModelUpdate();if(K){console.warn("[manager:change]",P,Q.target.value)}return false}},_computePoolSize:function(U,N){var R=this._computeModelSize();if(U===undefined){U=this._poolDimensions.numberOfRows!==undefined?this._poolDimensions.numberOfRows:R.numberOfRows}if(N===undefined){N=this._poolDimensions.numberOfColumns!==undefined?this._poolDimensions.numberOfColumns:R.numberOfColumns}var S=this.getViewportDimensions();var O=1;var T,Q,P,M;P=Math.ceil(O*parseInt(S.height/this._getCellHeight(),10)*this.options.performances.numberOfRowsFactor);M=Math.ceil(O*parseInt(S.width/this._getCellWidth(),10)*this.options.performances.numberOfColumnsFactor);if(this.options.virtualView){T=Math.ceil(Math.max(1,Math.min(P,U))+this._numberOfRowsToRemove);if(!this.options.performances.enableColumnVirtualization){Q=this.getNumberOfColumns()}else{Q=Math.ceil(Math.max(1,Math.max(Math.min(M,N),1))+this._numberOfColumnsToRemove)}}else{T=R.numberOfRows;Q=R.numberOfColumns}this._poolSizeMax={numberOfRows:P,numberOfColumns:M};this._poolSize={numberOfRows:T,numberOfColumns:Q};if(w){console.warn(this.options.id,"Viewport size",S.width,"x",S.height,"px");console.warn(this.options.id,"Generate a pool of ",T,"x",Q,"cells")}},needToIndexRowsPositions:function(){return true},_onPoolCellCreation:function(P){if(!P.cellView){P=P.data}var N=this;var O=P.cellView;var R={screenX:0,screenY:0};P.cellView.getContent().addEvent(l.POINTERDOWN,function(S){R={screenX:S.screenX,screenY:S.screenY}});P.cellView.getContent().addEvent(l.POINTERUP,function(S){if(Math.abs(S.screenX-R.screenX)<5||Math.abs(S.screenY-R.screenY)<5){N._cellViewBindings.onCellPointerUp.call(P,S)}});P.cellView.getContent().addEvent("dblclick",N._cellViewBindings.onCellDblClick.bind(P));if(N.options.isEditable){var Q=O.getVirtualCoordinates();var M=N._getMergedOption("isEditable",Q.virtualColumnID);P.cellView.getContent().addEvent(M.switchToWriteView.event,N._cellViewBindings.onEdition.bind(P))}},_onPoolCellDestruction:function(P){var N=this;if(!P.cellView){P=P.data}var O=P.cellView;P.cellView.getContent().removeEvent(l.POINTERUP,N._cellViewBindings.onCellPointerUp.bind(P));P.cellView.getContent().removeEvent("dblclick",N._cellViewBindings.onCellDblClick.bind(P));if(N.options.isEditable){var Q=O.getVirtualCoordinates();var M=N._getMergedOption("isEditable",Q.virtualColumnID);if(M){P.cellView.getContent().removeEvent(M.switchToWriteView.event,N._cellViewBindings.onEdition)}}},_cellViewBindings:{onCellPointerUp:function(O){var Q=this.cellView.getCellInfos();var N=Q.manager;if(!Q.cellView){Q=Q.data}var P=Q.cellView;if(O.button===0){var R=P.getVirtualCoordinates();var M=N.getCell(R.virtualRowID,R.virtualColumnID);N._modelEvents.publish({event:g.click,context:M,data:{model:M,view:P,cellModel:M,cellView:P,dataIndex:N.getDataIndexFromColumnID(R.virtualColumnID),virtualRowID:R.virtualRowID,virtualColumnID:R.virtualColumnID,isHeader:!(R.virtualColumnID>-1&&R.virtualRowID>-1)}})}},onCellDblClick:function(O){var Q=this.cellView.getCellInfos();var N=Q.manager;if(!Q.cellView){Q=Q.data}var P=Q.cellView;var R=P.getVirtualCoordinates();var M=N.getCell(R.virtualRowID,R.virtualColumnID);N._modelEvents.publish({event:g.dblClick,context:M,data:P.getCellInfos()})},onEdition:function(O){var P=this.cellView.getCellInfos();var M=P.manager;if(P.cellView.getContent().getAttributeNode("is-edited")){return}var N=M._getViewForCell({cellView:P.cellView,virtualColumnID:P.virtualColumnID});P.event=O;N.switchToWriteView.callback.call(P.cellView,P)}},loadModel:function(M,N){this._parent(M,N)},appendToModel:function(M,O){var N=this;N.prepareUpdateView();i(M.data,function(P){N.addRow(P)});N.pushUpdateView();if(O){O.call(this)}},exportColumnsPreferences:function(){return JSON.stringify(this.options.columns)},restoreColumnsPreferences:function(N){var O=this;var P=JSON.parse(N);var M={};P.forEach(function(R,Q){M[R.dataIndex]=Q});this.options.columns.forEach(function(R,Q){h.extend(O.options.columns[Q],P[M[R.dataIndex]],true)});this.updateView(true)},_postInitialization:function(){this.options.model=this.options.model.length?this.options.model:this.options.model;this._rowsList=[];var N=this.options.model.length;for(var P=0;P<N;P++){this._rowsList[P]=new o({isHeader:true,isStatic:false,isEditable:false,rowID:P,columnID:-1,value:"",manager:this})}this._columnsList=[];var M=this.getNumberOfColumns();for(var O=0;O<M;O++){this._columnsList[O]=new o({isHeader:true,isStatic:false,isEditable:false,rowID:-1,columnID:O,value:this.options.columns[O].text,manager:this})}this._listenEvents()},_endResizeCallback:function(){if(this.getContent()){this._setColumnsWidth();this._parent()}},scrollToRow:function(P,M){var O=this;var N=this.getRowPosition(P);var Q;switch(M){case"top":Q=Math.max(N,0);break;default:case"middle":Q=Math.max(N-O._viewportDimensions.height/2,0);break;case"bottom":Q=Math.max(N-O._viewportDimensions.height+this.options.defaultCellHeight,0);break}O.getScroller().setPosition({y:Q},true)},getCellModel:function(N,M){if(M===-1){if(!this._rowsList[N]){this._rowsList[N]=new o({isHeader:true,isStatic:false,isEditable:false,rowID:N,columnID:-1,value:null,manager:this})}return this._rowsList[N]}else{if(N===-1){if(!this._columnsList[M]){this._columnsList[M]=new o({isHeader:true,isStatic:false,isEditable:false,rowID:-1,columnID:M,value:null,manager:this})}return this._columnsList[M]}else{if(this.options.model[N]&&this.options.model[N][M]){return this.options.model[N][M]}}}},_getCellsModel:function(){return this.options.model},_initialize:function(){},updateRowViewWithException:function(N,M){if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}var O=this;this.processCellsOfRow(N,function(P,R,Q){if(Q!==M){O.updateCellView(R,Q)}});this._preventNextRowUpdateView=false},updateRowView:function(M){if(!this._preventNextRowUpdateView){this._preventNextRowUpdateView=false;this._renderRow(M)}},preventNextUpdateRowView:function(){console.log("prevent next update view");this._preventNextRowUpdateView=true},_doesCellNeedToDisplayed:function(N){var M=N.cellModel;if(M.isMerged()){return false}else{return true}},updateCellView:function(R,Q){if(typeof Q==="string"){Q=this.getColumnIDFromDataIndex(Q)}var M=this.getVirtualViewport(false);if((M.minRowID<=R&&R<=M.maxRowID&&M.minColumnID<=Q&&Q<=M.maxColumnID)||(R===-1||Q===-1)){var O=this.getCell(R,Q);if(O){var N=O.getView();var P=this;if(N){N.updateInternalParameters();if(R===-1){P._onRequestColumnHeaderCB.call(P,N.getCellInfos())}else{if(Q===-1){P._onRequestRowHeaderCB.call(P,N.getCellInfos())}else{P._onRequestCellCB.call(P,N.getCellInfos())}}}}}},_observeSelMultiSel:function(){var M=this;if(!this._multiSelModeHasBeenForced){this._modeIsMultiSel=false;this._modeIsListSel=false}x.addEventOnElement(this,document,"keydown",function(O){var N=h.Event.whichKey(O);switch(N){case"alt+ctrl+shift":case"shift+alt":case"alt+shift":case"ctrl+shift":case"shift+ctrl":case"shift":M._modeIsListSel=true;if(M._allowSettingMultiSelMode&&!M._multiSelModeHasBeenForced){M._modeIsMultiSel=true}break;case"ctrl":if(M._allowSettingMultiSelMode&&!M._multiSelModeHasBeenForced){M._modeIsMultiSel=true}break;default:}});x.addEventOnElement(this,document,"keyup",function(O){var N=h.Event.whichKey(O);switch(N){case"alt+ctrl+shift":case"shift+alt":case"alt+shift":case"ctrl+shift":case"shift+ctrl":case"shift":if(!M._multiSelModeHasBeenForced){M._modeIsListSel=false;M._modeIsMultiSel=false}break;case"ctrl":if(!M._multiSelModeHasBeenForced){M._modeIsMultiSel=false}break;default:}if(N==="enter"&&M._isInEdition){M._isInEdition=false}})},isInMultiSelection:function(){return(this._modeIsMultiSel||this._modeIsListSel)&&this.options.selection.canMultiSelect},isInListSelection:function(){return(this._modeIsMultiSel&&this._modeIsListSel)&&this.options.selection.canMultiSelect},forceMultiSelection:function(M){if(M===undefined){M=true}this._modeIsMultiSel=M&&this.options.selection.canMultiSelect;this._multiSelModeHasBeenForced=true},_listenToClickOnEmptyArea:function(){var M=this;x.addEventOnElement(this,this.elements.container,"click",function(N){if(N.target.className.indexOf("wux-scroller")!==-1){M.unselectAll()}})},_listenEvents:function(){var M=this;this.onMoveRow(function(N){M.processCellsOfRow(N.toRowID,function(O){if(O.options.rowID===N.fromRowID){O.options.rowID=N.toRowID}})});this._selectedCells.onPostAdd(function(N){N.forEach(function(O){O.highlight();if(O._view&&parseInt(O._view.elements.container.getAttribute("virtual-row-id"),10)===O.options.rowID&&parseInt(O._view.elements.container.getAttribute("virtual-column-id"),10)===O.options.columnID){O._view.highlight()}})});this._selectedCells.onPostRemove(function(N){N.forEach(function(O){O.unhighlight();if(O._view&&parseInt(O._view.elements.container.getAttribute("virtual-row-id"),10)===O.options.rowID&&parseInt(O._view.elements.container.getAttribute("virtual-column-id"),10)===O.options.columnID){O._view.unhighlight()}})});x.addEventOnElement(this,document,"keydown",function(O){var N=h.Event.whichKey(O);if(N==="ctrl"&&!M._modeIsMultiSel&&M._allowSettingMultiSelMode&&!M._multiSelModeHasBeenForced){M._modeIsMultiSel=true}if(N==="shift"&&!M._modeIsRange){M._modeIsRange=true}});x.addEventOnElement(this,document,"keyup",function(O){var N=h.Event.whichKey(O);if(N==="ctrl"&&!M._multiSelModeHasBeenForced){M._modeIsMultiSel=false}if(N==="shift"&&M._modeIsRange){M._modeIsRange=false}});this.onCellPointerDown(function(Q){var N=Q.cellView;var R=N.getVirtualCoordinates();var P=R.virtualRowID;var O=R.virtualColumnID;if(w){console.log("----->",this,Q,P,O)}if(!M.__disableInteractiveSort){if(O===-1){if(M.options.selection.rowHeaders){if(M.options.selection.canMultiSelect){if(!M.isRowSelected(P)){M.prepareUpdateView();if(!Q.event.ctrlKey){M._selectedCells.empty()}M.selectRow(P,!Q.event.ctrlKey);M.pushUpdateView()}}else{M.prepareUpdateView();M._selectedCells.empty();M.selectRow(P);M.pushUpdateView()}}}}});x.addEventOnElement(M,M.getContent(),"click",function(){M._hasBeenClicked=true;setTimeout(function(){M._hasBeenClicked=false},200)});this.onCellClick(function(N){var R=N.cellModel;var Z=N.cellView;var ac=Z.getVirtualCoordinates();var P=ac.virtualRowID;var ad=ac.virtualColumnID;if(!M.__disableInteractiveSort){if(P===-1){var ag=M._getColumnOptionValue(ad,"isSortable");var Y=["sort:asc","sort:desc"];var ah=M._getColumnState(ad);var W=r(Y,Y.indexOf(ah));var V=W.getNext();switch(V){case"sort:desc":if(ag){M.prepareUpdateView();M.sortColumnContent(ad,{typeOfCell:"number",sortOrder:"desc"});M.pushUpdateView()}break;case"sort:asc":if(ag){M.prepareUpdateView();M.sortColumnContent(ad,{typeOfCell:"number",sortOrder:"asc"});M.pushUpdateView()}break}}if(P!==-1&&ad!==-1&&M.options.selection.cells){M.prepareUpdateView();M._preventNextUpdateView();M.unselectAll({cells:true,updateView:false});if(M._modeIsRange){var ai=R;var X=M._selectedCells.get()[0];M._selectedCells.empty();M._selectedCells.add(X);var af,ae;var S,U,O,Q;var ab=X.getView().getVirtualCoordinates();var T=ai.getView().getVirtualCoordinates();if(ab.virtualRowID<T.virtualRowID){S=ab.virtualRowID;U=T.virtualRowID}else{U=ab.virtualRowID;S=T.virtualRowID}for(af=S;af<=U;af++){if(ab.virtualColumnID<T.virtualColumnID){O=ab.virtualColumnID;Q=T.virtualColumnID}else{Q=ab.virtualColumnID;O=T.virtualColumnID}for(ae=O;ae<=Q;ae++){if(!(af===ab.virtualRowID&&ae===ab.virtualColumnID)){var aa=M.getCell(af,ae);M._selectedCells.add(aa)}}}}else{if(M._modeIsMultiSel){M._selectedCells.add(R)}else{M._selectedCells.unique(R)}}M.pushUpdateView()}}})},_enableDisableInteractiveSort:E.debounce(function(){this.__disableInteractiveSort=this.__disableInteractiveSortNext;if(this.__disableInteractiveSort===false){}else{}},1000),_disableInteractiveSort:function(M){if(M===true){this.__disableInteractiveSort=true;this.__disableInteractiveSortNext=true}else{this.__disableInteractiveSortNext=true;this._enableDisableInteractiveSort()}},_enableInteractiveSort:function(){this.__disableInteractiveSortNext=false;this._enableDisableInteractiveSort()},getCell:function(O,N){if(typeof N==="string"){N=this.getColumnIDFromDataIndex(N)}if(N!==undefined){var M=this.getCellModel(O,N);if(M){if(M.options.shiftRowSpan){O=O+M.options.shiftRowSpan}if(M.options.shiftColSpan){N=N+M.options.shiftColSpan}}if(N===-1){if(!this._rowsList[O]){this._rowsList[O]=new o({isHeader:true,isStatic:false,isEditable:false,rowID:O,columnID:-1,value:null,manager:this})}return this._rowsList[O]}else{if(O===-1){if(!this._columnsList[N]){this._columnsList[N]=new o({isHeader:true,isStatic:false,isEditable:false,rowID:-1,columnID:N,value:null,manager:this})}return this._columnsList[N]}else{if(this.options.model[O]&&this.options.model[O][N]){return this.options.model[O][N]}}}}},_getCellViewFromDom:function(N,M){if(M){var O=A(N,"wux-datagrid-cell");if(O){return O.dsView}else{}}else{return N.dsView}},_getCellViewDom:function(N,M){if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}return this.elements.container.querySelector('.wux-datagrid-cell[virtual-row-id="'+N+'"][virtual-column-id="'+M+'"]')},_getCellView2:function(N,M){if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}return this.elements.container.querySelector('.wux-datagrid-cell[virtual-row-id="'+N+'"][virtual-column-id="'+M+'"]').dsView},_getCellView:function(N,M){if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}if(N===-1){return this._listOfRenderedColumnHeaders[N+"_"+M]}else{if(M===-1){return this._listOfRenderedRowHeaders[N+"_"+M]}else{return this._listOfRenderedCells[N+"_"+M]}}},getCellContent:function(O,N){var M=this.getCell(O,N);if(M){return M.getCellContent()}},setCell:function(O,M,N){if(M===-1){this._rowsList[O]=N}else{if(O===-1){this._columnsList[M]=N}else{if(this.options.model[O]===undefined){this.options.model[O]=[]}this.options.model[O][M]=N}}},_getColumnIdentifiers:function(O){var M,N;if(typeof O==="string"){N=O;M=this.getColumnIDFromDataIndex(O)}else{M=O;N=this.getDataIndexFromColumnID(O)}return{literalColumnID:N,numericalColumnID:M}},setCellContent:function(R,P,Q){var N=this.getCell(R,P);if(N){var M,O;if(typeof P==="string"){O=P;M=this.getColumnIDFromDataIndex(P)}else{M=P;O=this.getDataIndexFromColumnID(P)}N.setCellContent(Q);this._modelEvents.publish({event:"changeContent",data:{cellModel:N,rowID:R,columnID:M,virtualRowID:R,virtualColumnID:M,dataIndex:O,value:Q}})}},onCellContentChange:function(M){return this._modelEvents.subscribe({event:"changeContent"},M)},getRow:function(O,P){var M;if(O===-1){M=this._columnsList}else{M=this.options.model[O]}if(P===undefined){P=0}switch(P){default:case 0:return M;case 1:var N={};i(this.options.columns,function(R,Q){N[R.dataIndex]=M[Q].getCellContent()});return N}},getRows:function(O){switch(O){case 1:var N=[];var M=this;this.processRows(function(Q,P){N.push(M.getRow(P,1))});return N;default:return this.options.model}},getNumberOfColumns:function(){return this.options.columns.length},getNumberOfVisibleColumns:function(){var N=0;var M=this;this.options.columns.forEach(function(O){if(M.getColumnWidth(O.dataIndex)>0){N++}});return N},getLastVisibleColumnDataIndex:function(){var N;var M=this;this.options.columns.forEach(function(O){if(M.getColumnWidth(O.dataIndex)>0){N=O.dataIndex}});return N},getColumns:function(){return this._instance.options.columns||[]},getColumn:function(O,M){if(typeof O==="string"){O=this.getColumnIDFromDataIndex(O)}if(M===undefined){M=false}var N=[];this.processCellsOfColumn({columnID:O,updateView:false},function(P){N.push(P)});return N},getColumnOptions:function(M){if(M!==-1){if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}return this.options.columns[M]}else{return{}}},setColumnOptions:function(N,M){if(N!==-1){if(typeof N==="string"){N=this.getColumnIDFromDataIndex(N)}h.extend(this.options.columns[N],M)}},_getMergedOption:function(P,Q){if(typeof Q==="string"){Q=this.getColumnIDFromDataIndex(Q)}var S=this.getColumnOptions(Q);var N=S?S[P]:{};var M=this.options[P];if(N!==undefined){var O={opt:N};var R={opt:M};return h.extend(R,O,true).opt}else{return M}},_getColumnOptionValue:function(P,O){if(typeof P==="string"){P=this.getColumnIDFromDataIndex(P)}if(P>-1){var M=this.options[O];var N=this.getColumnOptions(P)[O];if(M!==undefined){if(N!==undefined){return N}else{return M}}else{if(N!==undefined){return N}}}},getColumnContent:function(P,M){if(typeof P==="string"){P=this.getColumnIDFromDataIndex(P)}if(M===undefined){M=false}var O=[];var N=0;i(this.options.model,function(Q){if(N>0&&!M){O.push(Q[P])}N++});return O},setColumn:function(M,N){if(typeof N==="string"){N=this.getColumnIDFromDataIndex(N)}this.processCellsOfColumn(N,function(O,Q,P){if(Q>0){O.setCellContent(M[Q-1].getCellContent())}})},setColumnContent:function(M,N){if(typeof N==="string"){N=this.getColumnIDFromDataIndex(N)}this.processCellsOfColumn(N,function(O,Q,P){if(Q>0){O.setCellContent(M[Q-1])}})},setRow:function(N,M){this.processCellsOfRow(M,function(O,Q,P){O.setCellContent(N[P])})},setRowModel:function(O,P){var N=this;N.prepareUpdateView();for(var M in P){N.setCellContent(O,M,P[M])}N.pushUpdateView()},getRowModel:function(M){return this.getRow(M,1)},_getParent:function(){return this._instance._parentObject||this._instance},setColumnOrderState:function(M,N){this._setColumnState(M,"sort:"+N);this._updateViewColumnSort(M)},getColumnOrderState:function(M){var N=this._getColumnState(M);return N?N.replace("sort:",""):"none"},getOrderedColumnState:function(){var M;var N=this;this.options.columns.forEach(function(O,P){var Q=N.getColumnOrderState(O.dataIndex);if(Q==="asc"||Q==="desc"){M={columnID:P,dataIndex:O.dataIndex,sortOrder:Q}}});return M},_updateViewColumnSort:function(O){if(typeof O==="string"){O=this.getColumnIDFromDataIndex(O)}var N=this._getColumnState(O);var M=this.getCellModel(-1,O);this.prepareUpdateView();switch(N){case"sort:none":M.removeClass("wux-ui-sort-desc");M.removeClass("wux-ui-sort-asc");break;case"sort:desc":M.addClass("wux-ui-sort-desc");M.removeClass("wux-ui-sort-asc");break;case"sort:asc":M.removeClass("wux-ui-sort-desc");M.addClass("wux-ui-sort-asc");break}this.pushUpdateView()},_setColumnState:function(N,O){if(typeof N==="string"){N=this.getColumnIDFromDataIndex(N)}var M=this.getOrderedColumnState();if(M){this._listOfColumnStates[M.columnID]=null}this._listOfColumnStates[N]=O},_getColumnState:function(M){if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}return this._listOfColumnStates[M]},sortColumnContent:function(R,N){var Q=this;this.prepareUpdateView();if(typeof R==="string"){R=this.getColumnIDFromDataIndex(R)}var P=this._getColumnIdentifiers(R);var S=this.getColumnOptions(P.numericalColumnID);N=h.extend({sortOrder:"asc",sortFunction:S.sortFunction||function(V,U){var X;var Y=V[R].getCellContent();var T=U[R].getCellContent();if(Y===T){X=0}else{var Z=Number(Y);var W=Number(T);if(isNaN(Z)||isNaN(W)){X=Y<T?-1:1}else{X=Z<W?-1:1}}return X}},N);if(N.sortFunction){this._setColumnState(R,"sort:"+N.sortOrder);for(var O=0;O<this.getRow(-1).length;O++){if(O!==R){var M=Q.getRow(-1)[O];if(M._view){M._view.getContent().removeClassName("wux-ui-sort-desc");M._view.getContent().removeClassName("wux-ui-sort-asc")}M.removeClass("wux-ui-sort-desc");M.removeClass("wux-ui-sort-asc")}}this.getCell(-1,R).removeClass("wux-ui-sort-desc");this.getCell(-1,R).removeClass("wux-ui-sort-asc");this.getCell(-1,R).addClass("wux-ui-sort-"+N.sortOrder);this.options.model.sort(function(V,U){var T=N.sortOrder==="asc"?1:-1;return T*N.sortFunction(V,U)});this._modelEvents.publish({event:"sort",data:{columnID:R,columnDataIndex:this.getDataIndexFromColumnID(R),sortOrder:N.sortOrder}});this._computeVirtualViewport();this.pushUpdateView(true)}},onSortColumnContent:function(M){return this._modelEvents.subscribe({event:"sort"},M)},_setColumnsWidth:function(){var U=false;if(U){console.log("[] --- Compute columns width ---")}var S=this;this.setCellsContainerSize({width:0},false);var O=Math.floor(S.getContent().getBoundingClientRect().width);var Q=(O-S.getHeadersDimensions().width);if(this.getCellsContainerSize().width>Q){Q=this.getCellsContainerSize().width}var P=0;if(this.getScroller()){P=this.getCellsContainerSize().height>this.getScroller().getContent().getDimensions().height?20:0}var M=Q-P;var N=[];this._columnsReverseIndex={};i(S.options.columns,function(Z,W){var Y=S.options.defaultCellWidth;S._columnsReverseIndex[Z.dataIndex]=W;if(!S.isColumnHidden(W)||Z.isHidden!==true){if(Z.width===undefined){Z.width=S.options.defaultCellWidth}if(Z.width!==undefined){if(Z.width==="minimal"){var X=S._computeMinimalColumnWidth(Z.dataIndex);if(X){Y=X;if(U){console.log(W,Z.dataIndex,"->",X,"min",M)}}else{N.push(W)}}else{if(Z.width!=="auto"){if(typeof Z.width!=="number"&&Z.width.indexOf("%")!==-1){var V=Math.floor(Q*parseInt(Z.width,10)/100)-1;if(V<=0){V=S.options.defaultCellWidth}Y=V;if(U){console.log(W,Z.dataIndex,Z.width,"->",V,"px",M)}}else{Y=Z.width;if(U){console.log(W,Z.dataIndex,Z.width,"->",Z.width,"px",M)}}}else{Y=0;N.push(W)}}}}else{Y=0;if(U){console.log(W,Z.dataIndex,Z.width,"->",0,"px",M)}}if(!S.isColumnHidden(W)&&Z.width!=="auto"){var X=(Z.minWidth!==null&&Z.minWidth!==undefined)?Z.minWidth:0;var aa=(Z.maxWidth!==null&&Z.maxWidth!==undefined)?Z.maxWidth:Infinity;Y=Math.min(aa,Math.max(X,Y))}M=M-Y;S._setColumnWidth(W,Y,false)});i(N,function(Z,V){var Y=S.options.columns[Z];var ab=Math.floor((M)/(N.length-V));var X=Math.max(S.options.defaultCellWidth,ab);if(!S.isColumnHidden(V)){var W=(Y.minWidth!==null&&Y.minWidth!==undefined)?Y.minWidth:0;var aa=(Y.maxWidth!==null&&Y.maxWidth!==undefined)?Y.maxWidth:Infinity;X=Math.min(aa,Math.max(W,X))}M=M-X;S._setColumnWidth(Z,X,false);if(U){console.log(Z,S.getDataIndexFromColumnID(Z),"->",X,"auto",M)}});this._indexColumnsPosition({fromColumnID:0,async:false});var R=S.getLastVisibleColumnDataIndex();var T=S.getColumnPosition(R)+S.getColumnWidth(R);S.setCellsContainerSize({width:T},true);if(U){console.log(this.options.columns)}},_applyCellsContainerSizeIfNeeded:function(){if(this._needToApplyCellContainerSizer===true){this._setColumnsWidth()}this._parent()},_computeMinimalColumnWidth:function(S,X){if(X===undefined){X=true}if(typeof S==="string"){S=this.getColumnIDFromDataIndex(S)}var M=0;var V=new h.Element("div",{styles:{display:"inline-block",position:"relative",opacity:1}}).inject(this.elements.poolContainerRel,"top");var T;if(X){T=this.getContent().querySelectorAll('.wux-datagrid-cell[virtual-column-id="'+S+'"]')}else{T=this.elements.poolContainerRel.querySelectorAll('.wux-datagrid-cell[virtual-column-id="'+S+'"]')}var O=T.length;for(var R=0;R<O;R++){var Q=T[R];var U=Q.cloneNode(true);U.style.display="inline-block";U.style.transform="";U.style.position="static";U.style.width="";U.style.top="";U.style.left="";var W=U.querySelector(".wux-layouts-treeview-node");if(W){W.style.position="static"}V.setHTML(U);var P=V.getDimensions().width;if(P>M){M=P}}V.remove();var N=M+10;return N},sizeColumnToFit:function(M,N){if(N===undefined){N=true}if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}this.onPostUpdateViewOnce(function(){this.prepareUpdateView();this.setColumnWidth(M,this._computeMinimalColumnWidth(M,N));this.pushUpdateView()});this.prepareUpdateView();this.setColumnWidth(M,this._computeMinimalColumnWidth(M,N));this.pushUpdateView()},getCellMinimalDimensions:function(Q,P){if(typeof P==="string"){P=this.getColumnIDFromDataIndex(P)}var O=new h.Element("div",{styles:{display:"inline-block",opacity:0}}).inject(this.elements.container);var N=this.elements.container.querySelector('.wux-datagrid-cell[virtual-row-id="'+Q+'"][virtual-column-id="'+P+'"]');if(N){var M=N.parentNode;O.setHTML(N);var R=O.getDimensions();M.appendChild(N)}return R},setColumnWidth:function(P,M,O){if(P!==undefined){if(M<0){M=0}if(typeof P==="string"){P=this.getColumnIDFromDataIndex(P)}this.options.columns[P].width=M;this._requireFullUpdate();this._invalidateLayout();var N=this;setTimeout(function(){N._instance._hideColumnInsertionMark()},100);this._setColumnsWidth();this._modelEvents.publish({event:"/MANAGER/COLUMN/WIDTH",data:{dataIndex:this.getDataIndexFromColumnID(P),columnID:P,width:M}})}},_setColumnWidth:function(P,N,O){if(O===undefined){O=true;this.prepareUpdateView()}if(P===-1){this._setHeadersDimensions({width:N})}else{if(typeof P==="string"){P=this.getColumnIDFromDataIndex(P)}var M=this.getColumnWidth(P);this.setCellsContainerSize({width:this.getCellsContainerSize()-M+N},false);this._listOfColumnsWidth[P]=N;this._modelEvents.publish({event:"/MANAGER/COLUMN/WIDTH",data:{columnID:P,width:N}});if(O){this._indexColumnsPosition({fromColumnID:P,onVisibleComplete:this.pushUpdateView.bind(this),async:false})}}},getCellPosition:function(N,M){if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}var P=this.getRowPosition(N);var O=this.getColumnPosition(M);return{top:P,left:O}},getColumnWidth:function(M){if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}if(M===-1){return this.getHeadersDimensions().width}else{return this._listOfColumnsWidth&&this._listOfColumnsWidth[M]!==undefined?this._listOfColumnsWidth[M]:this.options.defaultCellWidth}},isColumnHidden:function(M){if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}return this.options.columns[M].isHidden||this.getColumnWidth(M)===0},_renderCell:function(N){if(window.__karma__===undefined){var M=this.getDataIndexFromColumnID(N.virtualColumnID);if(N.virtualColumnID===-1||M!==undefined){if(N.virtualColumnID===-1||this.isColumnHidden(M)===false){return this._parent(N)}}}else{return this._parent(N)}},onColumnWidthUpdate:function(M){return this._modelEvents.subscribe({event:"/MANAGER/COLUMN/WIDTH"},M)},setCellSpan:function(S,R,O){this.prepareUpdateView();O=h.extend({rowSpan:1,colSpan:1,shiftRowSpan:0,shiftColSpan:0},O);var N=this.getCell(S,R);N.resetSpan();for(var Q=0;Q<O.rowSpan;Q++){for(var M=0;M<O.colSpan;M++){var P=this.getCell(S+Q,R+M);P.setRowSpan(O.rowSpan,-Q);P.setColSpan(O.colSpan,-M)}}this.pushUpdateView()},setRowHeight:function(O,M,N){if(N===undefined){N=true}this.prepareUpdateView();this._invalidateLayout();this._instance._hideRowInsertionMark();var P=this.getRowHeight(O);this.setCellsContainerSize({height:this.getCellsContainerSize().height-P+M},false);this._listOfRowsHeight[O]=M;this._modelEvents.publish({event:"/MANAGER/ROW/HEIGHT",data:{rowID:O,height:M}});if(this.needToIndexRowsPositions()&&N){this._needToIndexRowsPosition();this.pushUpdateView()}else{this.pushUpdateView()}},_needToIndexRowsPosition:function(){this._updateViewOptions.onPreUpdate=function(){this._indexRowsPosition({fromRowID:0,async:false})}},_indexRowsPosition:function(O){var Q=this;if(this._timeoutRowsPosIndexation){clearTimeout(this._timeoutRowsPosIndexation)}O=h.extend({fromRowID:0,toRowID:Q.getNumberOfRows(),oncomplete:null,onVisibleComplete:null,async:true},O);var M=this.getVisibleViewport();var P=false;var N=function(){var S="[Manager] - Index row position";f.beginMeasure(S);for(var R=O.fromRowID;R<O.toRowID+1;R++){var T=0;if(R>0){T=Q.getRowHeight(R-1)+Q.getRowPosition(R-1)}Q._listOfRowsPosition[R]=T;if(R===M.maxRowID){if(O.onVisibleComplete){P=true;O.onVisibleComplete.call(Q)}}}if(P===false){if(O.onVisibleComplete){P=true;O.onVisibleComplete.call(Q)}}f.endMeasure(S);if(O.oncomplete){O.oncomplete.call(Q)}};if(O.async){this._timeoutRowsPosIndexation=setTimeout(N,1)}else{N()}},_getVirtualPositionFromScrollPosition:function(P){if(P===undefined){if(this.getScroller()){P=this.getScrollerPosition()}else{P={x:0,y:0}}}var O=Math.floor(P.y/this.options.defaultCellHeight);var N=Math.floor(P.x/this.options.defaultCellWidth);var M={rowID:O,columnID:N};if(this.getRowPosition(M.rowID)<P.y){while(this.getRowPosition(M.rowID)<P.y){M.rowID++}M.rowID--}else{if(this.getRowPosition(M.rowID)>P.y){while(this.getRowPosition(M.rowID)>P.y){M.rowID--}}}if(this.options.performances.enableColumnVirtualization){if(this.getColumnPosition(M.columnID)<P.x){while(this.getColumnPosition(M.columnID)<P.x){M.columnID++}M.columnID--}else{if(this.getColumnPosition(M.columnID)>P.x){while(this.getColumnPosition(M.columnID)>P.x){M.columnID--}}}}return M},getRowPosition:function(M){if(M===0){return 0}else{if(this.needToIndexRowsPositions()&&this._listOfRowsPosition[M]!==undefined){return this._listOfRowsPosition[M]}else{return(M)*this.options.defaultCellHeight}}},_indexColumnsPosition:function(O){var Q=this;O=h.extend({fromColumnID:0,toColumnID:this.getNumberOfColumns(),oncomplete:null,onVisibleComplete:null,async:true},O);if(this._timeoutColumnsPosIndexation){clearTimeout(this._timeoutColumnsPosIndexation)}var M=this.getVisibleViewport();var P=false;var N=function(){for(var R=O.fromColumnID;R<=O.toColumnID+1;R++){var S=0;if(R>0){S=Q.getColumnWidth(R-1)+Q.getColumnPosition(R-1)}Q._listOfColumnPosition[R]=S;if(R===M.maxColumnID){if(O.onVisibleComplete){P=true;O.onVisibleComplete.call(Q)}}}if(P===false){if(O.onVisibleComplete){P=true;O.onVisibleComplete.call(Q)}}if(O.oncomplete){O.oncomplete.call(Q)}};if(O.async){this._timeoutColumnsPosIndexation=setTimeout(N,1)}else{N()}},getColumnPosition:function(M){if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}if(M===0){return 0}else{if(this._listOfColumnPosition[M]!==undefined&&this._listOfColumnPosition[M]!==null){return this._listOfColumnPosition[M]}else{return(M)*this.options.defaultCellWidth}}},getRowHeight:function(M){if(M===-1){return this.getHeadersDimensions().height}else{return this._listOfRowsHeight&&this._listOfRowsHeight[M]!==undefined?this._listOfRowsHeight[M]:this.options.defaultCellHeight}},onRowHeightUpdate:function(M){return this._modelEvents.subscribe({event:"/MANAGER/ROW/HEIGHT"},M)},removeRows:function(N){var M=this;i(N,function(O){M.removeRow(O)})},removeRow:function(M){this.prepareUpdateView();this.hideRow(M);this.unselectRow(M);this.processCells(function(N,O,P){N.options.rowID=O-1},{minRowID:M+1,minColumnID:0});this.options.model.splice(M,1);this._listOfRowsPosition.splice(M,1);this._listOfRowsHeight.splice(M,1);this._listOfRowsPreviousHeight.splice(M,1);this._listOfRowsPreviousHeight.splice(M,1);this._needToIndexRowsPosition();this.pushUpdateView(true);this._processRowModel(M,function(N){N.destroy()});this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"});this._modelEvents.publish({event:"/MANAGER/ROWS/REMOVE",data:{rowID:M}})},onRemoveRow:function(M){this._modelEvents.subscribe({event:"/MANAGER/ROWS/REMOVE"},M)},removeColumn:function(N){if(typeof N==="string"){N=this.getColumnIDFromDataIndex(N)}this.prepareUpdateView();var M=this;this.hideColumn(N);this.unselectColumn(N);this.processCellsOfColumn(N,function(O,P,Q){M._onDetachFromView(P,Q,true)});this.processCells(function(O,P,Q){O.options.columnID=Q-1},{minRowID:0,minColumnID:N});this.processRows(function(P,O){M.options.model[O].splice(N,1)});this._setColumnsWidth();M.options.columns.splice(N,1);this.updateView(true);this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"});this._modelEvents.publish({event:"/MANAGER/COLUMNS/REMOVE",data:{columnID:N}});this.pushUpdateView()},processCellsOfColumn:function(Q,T){var R=0;var N={columnID:0,minRowID:0,maxRowID:this.options.model.length,updateView:true};var P={};if(typeof Q==="object"){P=Q}else{P.columnID=Q}P=h.extend(N,P);if(typeof P.columnID==="string"){P.columnID=this.getColumnIDFromDataIndex(P.columnID)}var O=this.options.model;var M=O.length;for(R=0;R<M;R++){var S=O[R];if(T&&S[P.columnID]!==undefined){if(T&&R>=P.minRowID&&R<=P.maxRowID){T.call(S[P.columnID],S[P.columnID],R,P.columnID)}}}if(P.updateView){this.updateView()}},_processRowModel:function(Q,R){var O=this.options.model[Q];if(O!==undefined){var M=O.length;var N=this.getCell(Q,-1);R.call(N,N);for(var P=0;P<M;P++){var N=this.getCell(Q,P);R.call(N,N)}}},processCellsOfRow:function(R,S){var Q=0;if(!S){return}var M={rowID:0,minColumnID:0,maxColumnID:this.options.model[0]?this.options.model[0].length:0};var O={};if(typeof R==="object"){O=R}else{O.rowID=R}O=h.extend(M,O);if(O.rowID!==-1){var N=this.options.model[O.rowID];if(N!==undefined){for(Q=O.minColumnID;Q<O.maxColumnID;Q++){var P=this.getCell(O.rowID,Q);if(P){S.call(P,P,O.rowID,Q)}}}}},enableDebug:function(){w=true},disableDebug:function(){w=false},isDebug:function(){return w},processRows:function(O,M){var N=0;i(this.options.model,function(P){if(O){O.call(P,P,N)}N++})},styleRow:function(N,M){this.processCellsOfRow(N,function(O,Q,P){O.setCellStyle(M)});this.updateView(true)},_selectRowProcessCB:function(M,Q,P,O){this.selectCell(Q,P,O);M.addClass("wux-datagrid-row-highlighted");var N=M.getView();if(N){N.getContent().addClassName("wux-datagrid-row-highlighted")}},selectRows:function(M,R){if(!M||M.length===0){return}if(R===undefined){R=true}if((!this._selectedColumns.isEmpty()||!this._selectedRows.isEmpty())&&R){this.unselectAll({updateView:false})}var P=[];var O=[];var Q=this;var N=Q.options.model[0]?Q.options.model[0].length:0;M.forEach(function(U){if(U!==null&&U!==undefined&&U>=0&&O.indexOf(U)===-1){O.push(U);P.push(Q.getCell(U,-1));Q.selectCell(U,-1,true);if(Q.options.model[U]!==undefined){for(var T=0;T<N;T++){var S=Q.getCell(U,T);if(S){P.push(S);Q._selectRowProcessCB(S,U,T,true)}}}}});this._selectedCells.add(P);this._modelEvents.publish({context:this,event:"/MANAGER/SELECT/ROWS",data:O});this._selectedRows.add(O);this._modelEvents.publish({event:"selectionChange",context:this,data:{}})},selectRow:function(O,N){if(O===null||O===undefined||O<0){return}if(N===undefined){N=true}if((!this._selectedColumns.isEmpty()||!this._selectedRows.isEmpty())&&N){this.unselectAll({updateView:false})}this.selectCell(O,-1);var M=this;this.processCellsOfRow({rowID:O,minColumnID:0},function(P,R,Q){M._selectRowProcessCB(P,R,Q)});this._modelEvents.publish({context:this,event:"/MANAGER/SELECT/ROW",data:O});this._selectedRows.add(O);this._modelEvents.publish({event:"selectionChange",context:this,data:{}})},isRowSelected:function(M){return this._selectedRows.isIn(M)},_unselectRowProcessCB:function(M,O,N){if(M&&M.isSelected()){this.unselectCell(O,N)}},unselectRow:function(N){if(N===null||N===undefined||N<0){return}this.unhighlightRow(N);var M=this;this.processCellsOfRow({rowID:N,minColumnID:0},function(O,Q,P){M._unselectRowProcessCB(O,Q,P)});this.removeRowClass(N,"wux-datagrid-row-highlighted");this._modelEvents.publish({context:this,event:"/MANAGER/UNSELECT/ROW",data:N});this._selectedRows.remove(N);this._modelEvents.publish({event:"selectionChange",context:this,data:{}})},getSelectedRows:function(){return this._selectedRows.get()},selectColumn:function(M,N){if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}if(N===undefined){N=true}if(N){this.unselectAll({updateView:false})}this.highlightColumn(M,true);this._modelEvents.publish({context:this,event:"/MANAGER/SELECT/COLUMN",data:M});this._selectedColumns.add(M);this._setColumnState(M,"select");this._modelEvents.publish({event:"selectionChange",context:this,data:{}})},unselectAllColumns:function(){if(this._selectedColumns.get().length>0){this.withUpdate(function(){while(this._selectedColumns.get().length>0){this.unselectColumn(this._selectedColumns.get()[0])}})}},unselectColumn:function(M){if(typeof M==="string"){M=this.getColumnIDFromDataIndex(M)}this.unhighlightColumn(M,true);this._modelEvents.publish({context:this,event:"/MANAGER/UNSELECT/COLUMN",data:M});this._selectedColumns.remove(M);this._setColumnState(M);this._modelEvents.publish({event:"selectionChange",context:this,data:{}})},getSelectedColumns:function(){return this._selectedColumns.get()},_focusCell:function(P,N){var M=this.getCell(P,N);this._focusedCell=M;M.select();var O=M.getView();if(O){O.select()}},selectCell:function(Q,O,N){var M=this.getCell(Q,O);if(!M){return}var P=this._getCellView(Q,O);if(P){M._view=P;M._view._cellModel=M}if(!N){this._selectedCells.add(M)}M.select();var P=M.getView();if(P&&parseInt(P.elements.container.getAttribute("virtual-row-id"),10)===Q&&parseInt(P.elements.container.getAttribute("virtual-column-id"),10)===O){P.select()}if(!N){this._modelEvents.publish({event:"selectionChange",context:this,data:{}})}},unselectCell:function(P,N){var M=this.getCell(P,N);if(!M){return}this._selectedCells.remove(M);M.unselect();var O=M.getView();if(O){O.unselect()}this._selectedCells.remove(M);this._modelEvents.publish({event:"selectionChange",context:this,data:{}})},getSelectedCells:function(){return this._selectedCells.get()},selectAll:function(){var M=this;this.prepareUpdateView();this.processRows(function(O,N){M.selectRow(N,false)});this.pushUpdateView()},unselectAll:function(O){O=h.extend({rows:true,columns:true,cells:true,updateView:true},O);if(O&&O.updateView){this.prepareUpdateView()}var P=this;if(O.columns){var N=this.getSelectedColumns();while(N[0]!==undefined){P.unselectColumn(N[0])}}if(O.rows){var Q=this.getSelectedRows();for(var M=0;M<Q.length;M++){P.unselectRow(Q[M])}}this._selectedCells.empty();if(O&&O.updateView){this.pushUpdateView()}},highlightRow:function(N){var M=this.getCell(N,-1);if(M){if(M.getView()){M.getView().highlight()}}this.processCellsOfRow(N,function(O,Q,P){O.highlight();if(O.getView()){O.getView().highlight()}});this._highlightedRows.add(N)},unhighlightRow:function(N){var M=this.getCell(N,-1);if(M){if(M.getView()){M.getView().unhighlight()}}this.processCellsOfRow(N,function(O,Q,P){O.unhighlight();if(O.getView()){var R=O.getView().getCellInfos();if(R.virtualRowID===Q&&R.virtualColumnID===P){O.getView().unhighlight()}}});this._highlightedRows.remove(N)},isRowHighlighted:function(M){return this._highlightedRows.isIn(M)},highlightColumn:function(O,M){var N=this;if(typeof O==="string"){O=this.getColumnIDFromDataIndex(O)}N.processCellsOfColumn(O,function(P,S,Q){if(M){P.select()}else{P.highlight()}var R=P.getView();if(R){if(M){R.select()}else{R.highlight()}}})},unhighlightColumn:function(O,M){var N=this;if(typeof O==="string"){O=this.getColumnIDFromDataIndex(O)}N.processCellsOfColumn(O,function(P,S,Q){if(M){this._manager.getCell(S,-1).inactive();P.unselect()}else{P.unhighlight()}var R=P.getView();if(R){if(M){R.unselect()}else{R.unhighlight()}}})},hideRow:function(M){if(!this.isRowHidden(M)){this.prepareUpdateView();var N=this.getRowHeight(M);this._listOfRowsPreviousHeight[M]=N;this.setRowHeight(M,0);this.getCell(M,-1)._hide();this.processCellsOfRow(M,function(O,Q,P){O._hide()});this.getCell(M,-1)._hide();this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"});this._requireFullUpdate();this.pushUpdateView()}},showRow:function(M){this.prepareUpdateView();var N=this._listOfRowsPreviousHeight[M]!==undefined?this._listOfRowsPreviousHeight[M]:this.options.defaultCellHeight;this.setRowHeight(M,N);this.getCell(M,-1)._show();this.processCellsOfRow(M,function(O,Q,P){O._show()});this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"});this._requireFullUpdate();this.pushUpdateView()},isRowHidden:function(M){return this.getRowHeight(M)===0},hideColumn:function(N){if(!this.isColumnHidden(N)){if(typeof N==="string"){N=this.getColumnIDFromDataIndex(N)}this.options.columns[N].isHidden=true;this.prepareUpdateView();var M=this.getColumnWidth(N);this._listOfColumnsPreviousWidth[N]=M;this._listOfColumnsWidth[N]=0;this._setColumnsWidth();this.getCell(-1,N)._hide();this.processCellsOfColumn(N,function(O,Q,P){O._hide()});this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"});this._modelEvents.publish({event:"hideColumn",data:{columnID:N}});this._modelEvents.publish({event:"columnVisibilityChanged",data:{columnID:N,isHidden:true}});this._requireFullUpdate();this.pushUpdateView(true)}},showColumn:function(N){if(typeof N==="string"){N=this.getColumnIDFromDataIndex(N)}this.options.columns[N].isHidden=false;this.prepareUpdateView();var M=this._listOfColumnsPreviousWidth[N];this._listOfColumnsWidth[N]=M;this._setColumnsWidth();this.getCell(-1,N)._show();this.processCellsOfColumn(N,function(O,Q,P){O._show()});this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"});this._modelEvents.publish({event:"showColumn",data:{columnID:N}});this._modelEvents.publish({event:"columnVisibilityChanged",data:{columnID:N,isHidden:false}});this._heavyDataColumnModelRequest("showColumn",{columnID:N});this._requireFullUpdate();this.pushUpdateView(true)},onShowColumn:function(M){return this._modelEvents.subscribe({event:"showColumn"},M)},onHideColumn:function(M){return this._modelEvents.subscribe({event:"hideColumn"},M)},onColumnVisibilityChange:function(M){return this._modelEvents.subscribe({event:"columnVisibilityChanged"},M)},unstyleRow:function(M){this.processCellsOfRow(M,function(N,P,O){N.setCellStyle({background:"",color:""})});this.updateView(true)},styleColumn:function(N,M){this.processCellsOfColumn(N,function(O,Q,P){O.setCellStyle(M)});this.updateView(true)},addColumnClass:function(Q,N,P){if(P===undefined){P=false}var O=function(R,U,T){R.addClass(N);var S=R.getView();if(S){S.getContent().addClassName(N)}};if(P){var M=this.getVisibleViewport();this.processCellsOfColumn({minRowID:M.minRowID,maxRowID:M.maxRowID,updateView:false},O)}else{this.prepareUpdateView();this.processCellsOfColumn(Q,O);this.pushUpdateView()}},removeColumnClass:function(Q,N,P){if(P===undefined){P=false}var O=function(R,U,T){R.addClass(N);var S=R.getView();if(S){S.getContent().removeClassName(N)}};if(P){var M=this.getVisibleViewport();this.processCellsOfColumn({minRowID:M.minRowID,maxRowID:M.maxRowID,updateView:false},O)}else{this.prepareUpdateView();this.processCellsOfColumn(Q,O);this.pushUpdateView()}},addRowClass:function(O,M,N){this.processCellsOfRow({rowID:O,minColumnID:N?-1:0},function(P,S,R){P.addClass(M);var Q=P.getView();if(Q){Q.getContent().addClassName(M)}})},removeRowClass:function(O,M,N){this.processCellsOfRow({rowID:O,minColumnID:N?-1:0},function(P,S,R){P.removeClass(M);var Q=P.getView();if(Q){Q.getContent().removeClassName(M)}})},unstyleColumn:function(M){this.processCellsOfColumn(M,function(N,P,O){N.setCellStyle({background:"",color:""})});this.updateView(true)},_processCells:function(T,S,N){var R=h.extend({minRowID:1,minColumnID:1,maxRowID:this.getNumberOfRows(),maxColumnID:this.getNumberOfColumns()},N);for(var P=R.minRowID;P<R.maxRowID;P++){for(var O=R.minColumnID;O<R.maxColumnID;O++){var Q=T[P];if(Q){var M=Q[O];if(M){S.call(M,M,P,O)}}}}},processCells:function(N,M){this._processCells(this.options.model,N,M)},getVisibleViewport:function(){return this._viewportBbox},_computeModelSize:function(R){var P=this;var M=P.options.model.length;var N=P.getLastVisibleColumnDataIndex();var Q=P.getColumnPosition(N)+P.getColumnWidth(N);var O=P.getRowPosition(M-1)+P.getRowHeight(M-1);P.setCellsContainerSize({width:Q,height:O},R!==undefined);P._modelSize={numberOfRows:M,numberOfColumns:this.options.columns.length};return P._modelSize},_computeVirtualViewport:function(){var U=this.getViewportDimensions();var V=this.getScrollerPosition();var Q=this.getModelSize();var R=Q.numberOfRows;var M=1;var W=this._getVirtualPositionFromScrollPosition();var S=this._getVirtualPositionFromScrollPosition({x:V.x+U.width,y:V.y+U.height});var T=W.rowID-M;var N=S.rowID+M;var P=this.options.performances.enableColumnVirtualization?(W.columnID-M):0;var O=this.options.performances.enableColumnVirtualization?(S.columnID+M):(this.options.columns.length-1);T=Math.max(0,T);N=Math.min(N,R-1);P=Math.max(0,P);O=Math.min(O,this.options.columns.length-1);this._viewportBbox={minRowID:T,maxRowID:N,minColumnID:P,maxColumnID:O};this._virtualPos={virtualRowID:this._viewportBbox.minRowID,virtualColumnID:this._viewportBbox.minColumnID};return this._viewportBbox},moveColumn:function(O,N,M){if(typeof O==="string"){O=this.getColumnIDFromDataIndex(O)}if(typeof N==="string"){N=this.getColumnIDFromDataIndex(N)}this.prepareUpdateView();this.unselectAll({updateView:false});t.array2dMove(this.options.columns,O,N);this.options.model=t.array2dTranspose(this.options.model);t.array2dMove(this.options.model,O,N);this.options.model=t.array2dTranspose(this.options.model);t.array2dMove(this._listOfColumnsWidth,O,N);t.array2dMove(this._columnsList,O,N);this._setColumnsWidth();this.pushUpdateView(true);this._modelEvents.publish({event:"/MANAGER/COLUMNS/MOVE",data:{fromColumnID:O,toColumnID:N}})},onMoveColumn:function(M){return this._modelEvents.subscribe({event:"/MANAGER/COLUMNS/MOVE"},M)},moveRow:function(O,M){console.log("move",O,M);this.prepareUpdateView();t.array2dMove(this.options.model,O,M);if(this._selectedRows.isIn(O)){this.unselectCell(O,-1);this.selectCell(M,-1)}this._modelEvents.publish({event:"/MANAGER/ROWS/MOVE",data:{fromRowID:O,toRowID:M}});var N=this._doINeedToGeneratePool();this.pushUpdateView(N)},onMoveRow:function(M){this._modelEvents.subscribe({event:"/MANAGER/ROWS/MOVE"},M)},getColumnIndexFromColumnID:function(M){console.warn("[deprecated] - please use getColumnIDFromDataIndex()");return this.getDataIndexFromColumnID(M)},getDataIndexFromColumnID:function(N){var M=this.options.columns;if(N>=0&&N<M.length){return M[N].dataIndex}},getColumnIDFromColumnIndex:function(M){console.warn("[deprecated] - please use getColumnIDFromDataIndex()");return this.getColumnIDFromDataIndex(M)},_needToComputeColumnReverseDataIndexes:function(){this._columnsReverseIndex=null},getColumnIDFromDataIndex:function(N){var Q;if(this._columnsReverseIndex&&this._columnsReverseIndex[N]!==undefined){Q=this._columnsReverseIndex[N]}else{var M=this.getNumberOfColumns();var P=this.options.columns;for(var O=0;O<M;O++){if(P[O].dataIndex===N){Q=O;break}}}return Q},addRow:function(M,S){this.prepareUpdateView();var W=this.getNumberOfRows();var T=this;var V=new o({isHeader:true,isStatic:true,rowID:W,columnID:-1,value:"",scroller:this._scroller,viewport:this._viewport,manager:this},this._leftStaticContainer);this._register({rowID:W,columnID:-1,cell:V});var O=this.getColumns();for(var P=0;P<O.length;P++){var N=O[P].dataIndex;var Q=this.getColumnIDFromDataIndex(N);var U=this.isColumnHidden(Q);V=new o({isHeader:false,isStatic:false,isHidden:U,isEditable:this.options?this.options.isEditable:this._isEditable,rowID:W,columnID:Q,value:M?M[N]:"",scroller:this._scroller,viewport:this._viewport,manager:this},this._cellsContainer);this._register({rowID:W,columnID:Q,cell:V})}if(S!==undefined&&S!==W){this.moveRow(W,S)}i(this.getSelectedRows(),function(X){if(X>=S){T.unselectRow(X);T.selectRow(X+1)}});var R=this._doINeedToGeneratePool();this.pushUpdateView(R);this._modelEvents.publish({event:"/MANAGER/DIMENSIONS/UPDATE"});this._modelEvents.publish({event:"/MANAGER/ROWS/ADD"});return W},addColumn:function(M){M=h.extend({column:{text:"First Name",dataIndex:"firstname"},data:[]},M);var O=this.options.columns.push(M.column)-1;this._instance._listOfColumns.push(M.column.dataIndex);var N=this;this.processRows(function(R,Q){var S=M.data;var P=new o({isHeader:false,isStatic:false,isHidden:false,isEditable:N.options?N.options.isEditable:N._isEditable,rowID:Q,columnID:O,value:S?S[Q]:"",scroller:N._scroller,viewport:N._viewport,manager:N},N._cellsContainer);N._register({rowID:Q,columnID:O,cell:P})});this._setupColumnType(M.column);this._setColumnsWidth();this._generatePool(true);this.updateView(true)},addRows:function(V){var R=this;var U=this.getNumberOfRows();for(var O=0;O<V.length;O+=1){var T=new o({isHeader:true,isStatic:true,rowID:U,columnID:-1,value:"",scroller:this._scroller,viewport:this._viewport,manager:this},this._leftStaticContainer);this._register({rowID:U,columnID:-1,cell:T});var N=this.getColumns();for(var P=0;P<N.length;P++){var M=N[P].dataIndex;var Q=this.getColumnIDFromDataIndex(M);var S=this.isColumnHidden(Q);T=new o({isHeader:false,isStatic:false,isHidden:S,isEditable:this.options?this.options.isEditable:this._isEditable,rowID:U,columnID:Q,value:V[O]?V[O][M]:"",scroller:this._scroller,viewport:this._viewport,manager:this},this._cellsContainer);this._register({rowID:U,columnID:Q,cell:T})}U+=1}if(this.getNumberOfRows()!==this.getPoolNumberOfRows()){this._generatePool()}this.updateView();i(this.getSelectedRows(),function(W){if(W>=U){R.unselectRow(W);R.selectRow(W+1)}})},onAddRow:function(M){this._modelEvents.subscribe({event:"/MANAGER/ROWS/ADD"},M)},_onDetachFromView:function(O,N,P){if(P===undefined){P=false}var M=this.getCell(O,N);if(M){if(M._view){M._view.elements.container.remove();M._view=null}}},onCellClick:function(M){return this._modelEvents.subscribe({event:g.click},M)},onCellDblClick:function(M){return this._modelEvents.subscribe({event:g.dblClick},M)},_dump:function(){var N=this;var M="\n";i(N.options.model,function(P,O){if(O===0){M=M+"   ";i(P,function(Q,R){M=M+"\t\t["+R+"]"});M=M+"\n"}M=M+"["+O+"]";i(P,function(Q){M=M+"\t\t"+Q.getCellContent()});M=M+"\n"});return M},_register:function(M){this.setCell(M.rowID,M.columnID,M.cell);this.updateModelSize({numberOfRows:this.getNumberOfRows(),numberOfColumns:this.getNumberOfColumns()})},withUpdate:function(M){this.prepareUpdateView();M.call(this);this.pushUpdateView()},prepareUpdateView:function(){if(this._isPreparingView===undefined){this._isPreparingView=0}this._isPreparingView++;if(w){console.log("prepare",this._isPreparingView)}this._parent()},pushUpdateView:function(M){if(this._isPreparingView>0){this._isPreparingView--}if(w){console.log("push",this._isPreparingView)}this._parent(M)},_doesRowNeedToBeRequested:function(M){return !this.isRowHidden(M)},_doesColumnNeedToBeRequested:function(M){return M<this.options.columns.length},empty:function(){this.prepareUpdateView();for(var M=this.getNumberOfRows()-1;M>=0;M--){this.removeRow(M)}t.clear(this.options.model);t.clear(this._cellsContentList);t.clear(this._rowsList);t.clear(this._rowIndexes);t.clear(this._listOfCellsInViewPort);t.clear(this._listOfRowsPosition);t.clear(this._listOfRowsHeight);t.clear(this._listOfRowsPreviousHeight);this._viewportBbox={};this._previousViewPort={rowMin:0,rowMax:0,columnMin:0,columnMax:0};this._minVisibleCellCoordinates={rowID:1,columnID:1};this._maxVisibleCellCoordinates={rowID:1,columnID:1};this._lastScrollPos={x:0,y:0};this._deltaScrollPos={x:0,y:0};this.pushUpdateView(true)},showLoadIndicator:function(M){this._instance.elements.loader.on(M)},hideLoadIndicator:function(){this._instance.elements.loader.off()},updateLoadIndicator:function(M){this._instance.elements.loader.update(M)},_update:function(M){},_requireFullUpdate:function(){this.__preventNextUpdateViewCounter=0;this._needFullUpdate=true},updateView:function(M){if(M===true){this._setColumnsWidth();this._updateViewOptions.generatePool=M}if(this._isPreparingView===0){if(w){if(this._updateViewOptions.generatePool){console.warn("------------- [update view & generate pool] --------------")}else{console.warn("------------- [update view] --------------")}}if(this._updateViewOptions&&this._updateViewOptions.detachAllViews){this._beginUpdate()}this._parent();if(this._debugPerformanceIssues){this._listOfColumnPerformances={}}if(this._updateViewOptions&&this._updateViewOptions.detachAllViews){this._endUpdate()}}},_getEditView:function(T,O){var R=this;var N;var M=T.getValue||function(U){return U.cellModel.getCellContent()};var S=T.setValue||function(V,U){V.cellModel.setCellContent(U)};var P=T.onChange||function(U){console.log("change",U.cellModel.getCellContent())};switch(T.type){case"picture":N=function(V){if(V.virtualRowID>-1){var U=V.manager._reuseCellContent("picture",V.cellView);if(U){U.style.backgroundImage=M.call(R,O.cellView.getCellInfos())}}};break;case"boolean":N=function(V){if(V.virtualRowID>-1){var U=new v({size:"mid",value:M.call(R,O.cellView.getCellInfos())});U.getContent().setStyles({verticalAlign:"middle"});U.onChange(function(W){var X=this.getValue();S.call(R,O.cellView.getCellInfos(),X);if(P){P.call(R,O.cellView.getCellInfos())}});return U}};break;case"color":N=function(V){if(V.virtualRowID>-1){var U=V.manager._reuseCellContent("color",V.cellView);if(U){U.style.backgroundColor=M.call(R,O.cellView.getCellInfos())}}};break;case"datetime":N=function(V){if(V.virtualRowID>-1){var U=M.call(R,O.cellView.getCellInfos()).toString().split(" ").splice(0,5).join(" ");return U}};break;case"smartinput-distance":case"smartinput-orientation":case"smartinput-angle":case"smartinput-vector":case"smartinput-number":var Q={"smartinput-distance":m,"smartinput-orientation":b,"smartinput-angle":c,"smartinput-vector":p,"smartinput-number":j};N=function(V){if(V.virtualRowID>-1){var U=new Q[T.type]({value:M.call(R,O.cellView.getCellInfos()),units:""});x.addEventOnElement(this,U,"change",function(){S.call(R,O.cellView.getCellInfos(),this.getValue())});return U}};break;default:case"string":N=function(V){if(V.virtualRowID>-1){var U=new h.Element("input",{type:"text",value:M.call(R,O.cellView.getCellInfos())});return U}};break}return N},_getViewForCell:function(N){var P=this;var S=this.getColumnOptions(N.virtualColumnID);var R=S?S.isEditable:{};function M(V,U){if(V.virtualRowID>-1){var T=new x.createElement("div");S.commands.forEach(function(X){if(!X.viewScope||X.viewScope===U){var W=new G({label:X.label,emphasize:X.isPrimary?"primary":undefined,icon:X.icon});W.getContent().setAttribute("internalCommand",X.command);x.addEventOnElement(this,W.getContent(),l.POINTERDOWN,function(Y){Y.stopPropagation();Y.preventDefault()});x.addEventOnElement(this,W.getContent(),l.POINTERUP,function(Y){Y.stopPropagation();Y.preventDefault();P._modelEvents.publish({event:"command:"+X.command,data:N.cellView.getCellInfos()})});T.appendChild(W.getContent())}});return T}}if(N.virtualColumnID>-1&&S.isEditable===undefined&&S.type!==undefined){switch(S.type){case"commands":R={switchToWriteView:{event:"",view:function(T){return M(T,"write")}},switchToReadView:{view:function(T){return M(T,"read")}}};break;case"boolean":R={switchToWriteView:{event:"",view:this._getEditView(S,N)},switchToReadView:{}};break;case"picture":R={switchToWriteView:{event:"",callback:function(){}},switchToReadView:{view:this._getEditView(S,N)}};break;case"color":R={switchToWriteView:{event:"",callback:function(){}},switchToReadView:{view:this._getEditView(S,N)}};break;case"datetime":R={switchToWriteView:{event:"",callback:function(){}},switchToReadView:{view:this._getEditView(S,N)}};break;case"smartinput-distance":case"smartinput-orientation":case"smartinput-angle":case"smartinput-vector":case"smartinput-number":R={switchToWriteView:{event:"",callback:function(){},view:this._getEditView(S,N)},switchToReadView:{event:"blur",callback:function(T){this.switchToReadView()}}};break;default:case"string":R={switchToWriteView:{event:"",callback:function(){},view:this._getEditView(S,N)},switchToReadView:{}};break}}var O=h.clone(this.options.isEditable);var Q=O;if(O!==false){Q=h.extend(O,R,true)}return Q},_setupColumnType:function(M){switch(M.type){case"selection":M.onCellChange=function(N){return N.event.target.parentNode.dsModel.checkFlag};M.onCellRequest=function(O){if(!O.isHeader){var N=new e({type:"checkbox",checkFlag:Boolean(O.manager.isRowSelected(O.virtualRowID))});x.addEventOnElement(this,N.getContent(),l.POINTERDOWN,function(P){P.stopPropagation()});x.addEventOnElement(this,N.getContent(),l.POINTERUP,function(P){P.stopPropagation()},true);x.addEventOnElement(this,N.getContent(),"change",function(P){if(P.dsModel.checkFlag){O.manager.selectRow(O.virtualRowID,false)}else{O.manager.unselectRow(O.virtualRowID,false)}O.manager._giveFocus()});O.cellView.getContent().setHTML(N)}};break;default:}},getDistinctValuesFromColumns:function(){var M={};var N={};var O=this;this.processRows(function(U,T){var R=O.getNumberOfColumns();for(var S=0;S<R;S++){var Q=O.getDataIndexFromColumnID(S);var P=O.getCellContent(T,S);if(M[Q]===undefined){M[Q]=[];N[Q]={}}if(N[Q][P]===undefined){N[Q][P]=true;M[Q].push(P)}}});return M},_giveFocus:function(M){this._instance.elements.container.addClassName("wux-ui-state-focused");if(M){this._instance.elements.container.focus()}},_lostFocus:function(){if(this._instance.options.changeColorOnFocus){this._instance.elements.container.removeClassName("wux-ui-state-focused")}if(this._listOfEditedCells&&this._listOfEditedCells.length>0){this._listOfEditedCells.forEach(function(M){M.cellView.switchToReadView()});t.clear(this._listOfEditedCells)}},_removeAllInteractiveUIFeedBacks:function(){},_recordInteractionFromUI:function(M){var N=this;y.addCustomInteraction(N._instance._parentObject.getContent(),{type:"webUX_event",reason:M.reason||"",event:M.event||"",data:M.data||{},eventOptions:{}},"DS/SpreadsheetRec/DataGridRec",{checkAbstract:false,checkVisibility:false})},enableDragOverStateForBlank:function(){this.disableDragOverStateForRow();if(this.getScroller()){this.getScroller().getContent().addClassName("wux-ui-state-drag-over")}},disableDragOverStateForBlank:function(){if(this.getScroller()){this.getScroller().getContent().removeClassName("wux-ui-state-drag-over")}},disableDragOverStateForRow:function(){this._instance._hideRowInsertionMark()},enableDragAutoScroll:function(){return this._enableDragAutoScroll()},_enableDragAutoScroll:function(){this.__enableDragAutoScroll=true;this._enableAutoScroll()},disableDragAutoScroll:function(){return this._disableDragAutoScroll()},_disableDragAutoScroll:function(){this.__enableDragAutoScroll=false;this._disableAutoScroll()},_scrollToPosition:function(R,S){var M=Boolean(window.chrome)&&Boolean(window.chrome.webstore);if(M&&!this.__enableDragAutoScroll){return}var O=a(R,this.getScroller().elements.container);var N=O.y;var U=this._scrollerDimensions.height;var P=50;var Q=0;var T=30;if(N<=P){Q=-(P-N)/P*T}else{if(U-P<=N){Q=(N-(U-P))/P*T}}this._setAutoScrollVelocity({x:0,y:Q})}});return h.namespace("WUX/Controls/SpreadsheetManager",I)});define("DS/Spreadsheet/DataGrid",["UWA/Core","UWA/Controls/Abstract","DS/Controls/Loader","DS/Spreadsheet/Manager","DS/Spreadsheet/CellModel","DS/Core/ActionsStack","DS/Spreadsheet/CellView","DS/Utilities/Data","UWA/Utils/Client","UWA/Utils","DS/Utilities/Utils"],function(f,n,u,r,h,j,b,m,p,g,c){var d=false;var i=false;var s="wux-ui-state-drag-over";var q=p.Engine;var e=-1;function t(x,w){var v=x;if(v){var y=(" "+v.className+" ").replace(/[\n\t]/g," ").indexOf(" "+w+" ")>-1;if(y){return v}else{return t(v.parentNode,w)}}else{}}function a(w,v){var x=(" "+w.className+" ").replace(/[\n\t]/g," ").indexOf(" "+v+" ")>-1;return x}function l(y,C){var z=y.target;if(C!==undefined){z=t(z,C)}var v=z.currentStyle||window.getComputedStyle(z,null),D=parseInt(v.borderLeftWidth,10),B=parseInt(v.borderTopWidth,10),A=z.getBoundingClientRect(),x=y.clientX-D-A.left,w=y.clientY-B-A.top;return{offsetX:x,offsetY:w}}var o=n.extend({defaultOptions:{managerClass:r,data:null,headersDimensions:{width:undefined,height:25},defaultCellMouseWidth:null,defaultCellMouseHeight:null,defaultCellTouchWidth:null,defaultCellTouchHeight:null,defaultCellWidth:100,defaultCellHeight:50,showScrollbarsOnHover:false,show:{rowHeaders:true,columnHeaders:true},resize:{rows:false,columns:false},selection:{cells:true,rowHeaders:true,columnHeaders:false,unselectAllOnEmptyArea:true,canMultiSelect:true},enableDragAndDrop:true,showLoaderIndicator:false,showVerticalLines:false,alternateRowColor:false,useTransparentScroller:false,isEditable:false,rowsAreDraggable:true,allowUnsafeHTMLContent:undefined,shouldCellAllowUnsafeHTMLContentAt:function(v){return v.manager.options.allowUnsafeHTMLContent},onDragStartColumnHeaderDefault:function(w,x){var v="'"+x.dataIndex+"'";w.dataTransfer.setData("Text",v);w.dataTransfer.effectAllowed="move";x.manager.__draggedAreaVirtualColumnID=x.virtualColumnID;x.manager.__draggedArea="column";x.manager.__draggedColumnID=x.virtualColumnID;x.manager.lockUI()},onDragEnterColumnHeaderDefault:function(v,w){if(w.manager.__draggedArea==="column"){if(w.virtualColumnID>w.manager.__draggedAreaVirtualColumnID){this._showColumnInsertionMark(w.manager.getScroller().getPosition().x+w.manager.getHeadersDimensions().width+w.manager.getColumnPosition(w.dataIndex)+w.manager.getColumnWidth(w.dataIndex))}else{this._showColumnInsertionMark(w.manager.getScroller().getPosition().x+w.manager.getHeadersDimensions().width+w.manager.getColumnPosition(w.dataIndex))}}},onDragLeaveColumnHeaderDefault:function(w,v){this._hideColumnInsertionMark()},onDragEndColumnHeaderDefault:function(w,v){delete v.manager.__draggedAreaVirtualColumnID;delete v.manager.__draggedArea;this._hideColumnInsertionMark();v.manager.unlockUI()},onDropColumnHeaderDefault:function(x,w){if(w.manager.__draggedAreaVirtualColumnID!==undefined){var v=x.dataTransfer.getData("Text");if((v.length>=2)&&(v.charAt(0)==="'")&&(v.charAt(v.length-1)==="'")){v=v.slice(1,v.length-1)}this._hideRowInsertionMark();w.manager.moveColumn(v,w.dataIndex);w.manager._recordInteractionFromUI({event:"drop:move-column",data:{fromVirtualColumnID:v,toVirtualColumnID:w.dataIndex}});w.manager.unlockUI()}},onDragStartRowHeaderDefault:function(v,w){this.serializeDragAndDropEvent(v,{data:{"dswebux/x-spreadsheet.datagrid.rows+json":[w.manager.getRow(w.virtualRowID,1)]}});v.dataTransfer.effectAllowed="move";w.manager.__draggedVirtualRowID=w.virtualRowID},onDragOverRowHeaderDefault:function(v,w){if(w.dropPosition==="top"){this._showRowInsertionMark(w.manager.getScroller().getPosition().y+w.manager.getHeadersDimensions().height+w.manager.getRowPosition(w.virtualRowID))}else{this._showRowInsertionMark(w.manager.getScroller().getPosition().y+w.manager.getHeadersDimensions().height+w.manager.getRowPosition(w.virtualRowID)+w.manager.getRowHeight(w.virtualRowID))}},onDragLeaveRowHeaderDefault:function(v,w){this._hideRowInsertionMark()},onDropRowHeaderDefault:function(y,x){var w=this.unserializeDragAndDropEvent(y);if(w.source.uuid===this._uxid){if(x.manager.__draggedVirtualRowID<x.virtualRowID){if(x.dropPosition==="top"){x.manager.moveRow(x.manager.__draggedVirtualRowID,Math.max(0,x.virtualRowID-1))}else{x.manager.moveRow(x.manager.__draggedVirtualRowID,x.virtualRowID)}}else{if(x.dropPosition==="top"){x.manager.moveRow(x.manager.__draggedVirtualRowID,x.virtualRowID)}else{x.manager.moveRow(x.manager.__draggedVirtualRowID,x.virtualRowID+1)}}}else{var v=w.data["dswebux/x-spreadsheet.datagrid.rows+json"];if(v){if(x.dropPosition==="top"){v.forEach(function(A,z){console.log("+",Math.max(0,x.virtualRowID-1+z));x.manager.addRow(A,Math.max(0,x.virtualRowID+z))})}else{v.forEach(function(A,z){console.log("+",x.virtualRowID+z);x.manager.addRow(A,x.virtualRowID+1+z)})}}}},onDragEndRowHeaderDefault:function(v,w){delete w.manager.__draggedVirtualRowID},onDragStartCellDefault:function(v,w){},onDropCellDefault:function(w,v){},onDragEnterBlankDefault:function(v,w){this._hideColumnInsertionMark();this._hideRowInsertionMark();this.getManager().getScroller().getContent().addClassName("wux-ui-state-drag-over")},onDragLeaveBlankDefault:function(v,w){this._hideColumnInsertionMark();this._hideRowInsertionMark();this.getManager().getScroller().getContent().removeClassName("wux-ui-state-drag-over")},onDropBlankDefault:function(y,x){var w=this.unserializeDragAndDropEvent(y);if(w.source.uuid===this._uxid){x.manager.moveRow(x.manager.__draggedVirtualRowID,x.manager.getNumberOfRows()-1)}else{var v=w.data["dswebux/x-spreadsheet.datagrid.rows+json"];if(v){v.forEach(function(z){x.manager.addRow(z,x.virtualRowID)})}}},performances:{numberOfRowsFactor:2,numberOfColumnsFactor:1.2,fullUpdateFactor:2,enableColumnVirtualization:false,debounceCellInternalUpdateTimer:0},isSortable:true,showTaskManager:false,apiVersion:2},init:function(w,v){this._parent(w);this._uxid=g.getUUID();this._parentObject=v;this._listOfColumns=[];this.buildView();var x=this;this._buildGrid();if(this.options.enableDragAndDrop===true){this.elements.container.addEvent("dragstart",this._onDragStart.bind(this));this.elements.container.addEvent("drop",this._onDrop.bind(this));this.elements.container.addEvent("dragover",this._onDragOver.bind(this));this.elements.container.addEvent("drag",this._onDrag.bind(this));this.elements.container.addEvent("dragend",this._onDragEnd.bind(this));this.elements.container.addEvent("dragleave",this._onDragLeave.bind(this));this.elements.container.addEvent("dragenter",this._onDragEnter.bind(this))}this.elements.container.addEvent("mouseleave",function(){x._hideRowInsertionMark();x._hideColumnInsertionMark();x._cellsManager._removeAllInteractiveUIFeedBacks()});this._onBlurCB=function(z){var y=x._cellsManager;setTimeout(function(){if(y&&y._instance){var C=document.activeElement;if(C){var A=a(C,"wux-afr-actionbar")?C:t(C,"wux-afr-actionbar");var B=a(C,"wux-datagrid")?C:t(C,"wux-datagrid");if(B&&(B.getAttribute("wux-uuid")===y._instance._uxid)&&!A){y._giveFocus()}else{if(!B&&!A){y._lostFocus()}}}}},1)};f.Element.addEvent.call(document.body,"blur",this._onBlurCB,true);this.elements.container.addEvent("focus",function(y){x._cellsManager._giveFocus()});if(this.options.alternateRowColor){this.elements.container.setAttribute("alternate-row-color","true")}if(this.options.showVerticalLines){this.elements.container.setAttribute("show-vertical-lines","true")}else{this.elements.container.setAttribute("show-vertical-lines","false")}},destroy:function(){if(this._onBlurCB){f.Element.removeEvent.call(document.body,"blur",this._onBlurCB,true);this._onBlurCB=null}this._cellsManager.destroy();this._cellsManager=null;this._parent()},serializeDragAndDropEvent:function(w,v){v=f.extend({source:{uuid:this._uxid,amd:"DS/Spreadsheet/DataGrid"},data:{"dswebux/x-spreadsheet.datagrid.data+json":""}},v);w.dataTransfer.setData("Text",JSON.stringify(v));return JSON.stringify(v)},unserializeDragAndDropEvent:function(v){var w=v.dataTransfer.getData("Text");try{return JSON.parse(w)}catch(v){console.warn('the element being in dataTransfer type "text" is not parsable usable JSON.parse')}},_buildGrid:function(w){if(w){f.extend(this.options,w)}var x=this;x.elements.container.setAttribute("wux-uuid",this._uxid);if(x._cellsManager){x._cellsManager.destroy();x._cellsManager=null;delete x._cellsManager}x._cellsManager=new this.options.managerClass({allowUnsafeHTMLContent:this.options.allowUnsafeHTMLContent,shouldCellAllowUnsafeHTMLContentAt:this.options.shouldCellAllowUnsafeHTMLContentAt,allowTextCopy:this.options.allowTextCopy,touchMode:this.options.touchMode,onContextualMenuReady:this.options.onContextualMenuReady,selection:this.options.selection,isEditable:this.options.isEditable,iconsSize:this.options.iconsSize,columns:this.options.columns,parent:this,headersDimensions:this.options.headersDimensions,cellClass:this.options.cellClass,defaultCellMouseWidth:this.options.defaultCellMouseWidth,defaultCellMouseHeight:this.options.defaultCellMouseHeight,defaultCellTouchWidth:this.options.defaultCellTouchWidth,defaultCellTouchHeight:this.options.defaultCellTouchHeight,defaultCellWidth:this.options.defaultCellWidth,defaultCellHeight:this.options.defaultCellHeight,manageHeight:this.options.manageHeight,showRowsHeader:this.options.show.rowHeaders,showColumnsHeader:this.options.show.columnHeaders,isSortable:this.options.isSortable,infiniteScrolling:this.options.infiniteScrolling,height:this.options.height,maxHeight:this.options.maxHeight,resize:this.options.resize,useTransparentScroller:this.options.useTransparentScroller,showScrollbarsOnHover:this.options.showScrollbarsOnHover,performances:this.options.performances||{}},this);if(this.options.data&&this.options.columns){var v=this._loadInternalModel();if(d){console.log("- model loaded in datagrid",v)}x._cellsManager.loadModel(v,true);x._cellsManager._postInitialization();x.elements.container.empty();if(x.options.showLoaderIndicator){x.elements.loader.inject(x.elements.container);x.elements.loaderOverlay.inject(x.elements.container)}x._cellsManager.inject(this.elements.container);x._cellsManager.onReady(function(){x._parentObject.elements.container.setAttribute("wux-api-version",x.options.apiVersion)});x._manageCellRequests()}},_processDragAndDropCallback_v2:function(A){var D=this;if(A.type==="dragend"||A.type==="drop"||A.type==="dragcancel"){if(this.options.enableScrollOnDrag&&(q.ie||q.firefox)){D._cellsManager._disableDragAutoScroll();setTimeout(function(){D._cellsManager._removeAllInteractiveUIFeedBacks()},10)}D._cellsManager.disableDragOverStateForBlank();D._cellsManager.disableDragOverStateForRow()}if(A.type==="dragleave"){if(!(a(A.target,"wux-scroller")||a(A.target,"wux-datagrid-cell"))){if(!t(A.target,"wux-datagrid-cell")&&!t(A.target,"wux-scroller")){return}}}if(A.type==="drop"||A.type==="dragend"){if(D._currentDropCellView){D._currentDropCellView.removeAttribute("wux-ui-drop-position")}}var E={dragstart:"onDragStart",dragend:"onDragEnd",dragenter:"onDragEnter",dragleave:"onDragLeave",drag:"onDrag",dragover:"onDragOver",drop:"onDrop"};var G=E[A.type];var F=this._getDragAndDropInfos(A);if(A.type==="dragstart"){var B=this._parentObject._shouldAcceptDrag(F);if(B){if(A.dataTransfer){var y=A.target.getBoundingClientRect();var x=A.clientX-y.left;var v=A.clientY-y.top;if(typeof(A.dataTransfer.setDragImage)==="function"){A.dataTransfer.setDragImage(A.target,x,v)}}}else{A.preventDefault()}}function w(N,I){var M=false;var H=z?z[N+I]:false;var K=F.parent.options[N+I];var J=H||K;if(J){M=J.call(F.parent,A,F);if(i&&N!=="onDragOver"){console.info("[dnd]",N+I,">",M,A.target)}}else{if(i){console.warn("[dnd]","cannot find",N+I,"callback")}}var L=D.options[N+I+"Default"];if(L){if(J===undefined||(K&&M)){if(i){if(K&&M){console.info("\t>[dnd]","dev want to continue to the default behavior for ",N+I," callback")}else{console.info("\t>[dnd]","use the default behavior for ",N+I," callback")}}L.call(F.parent,A,F)}}}if(F.cellView){var C=F.cellView.getVirtualCoordinates();var z=F.cellView.getGridEngine().getColumnOptions(C.virtualColumnID);if(F.isHeader){if(F.virtualColumnID===-1){w(G,"RowHeader")}if(F.virtualRowID===-1){w(G,"ColumnHeader")}}else{if(A.type==="dragover"){if(this.options.enableScrollOnDrag&&(q.ie||q.firefox)){if(!D._cellsManager.__enableDragAutoScroll){D._cellsManager._enableDragAutoScroll()}D._cellsManager._scrollToPosition(A)}if(q.firefox){D._cellsManager.__preventFFLockUIWhenScrollOnDragOver=true}if(D.__toStopDragScroll){window.clearTimeout(D.__toStopDragScroll)}D.__toStopDragScroll=window.setTimeout(function(){if(D._cellsManager){D._cellsManager._disableDragAutoScroll();D._cellsManager.__preventFFLockUIWhenScrollOnDragOver=false}},300)}w(G,"Cell")}}else{if(!D._cellsManager.__preventDragAndDropOnBlankDuringScrollFlag){w(G,"Blank")}}if(A.type==="drop"||A.type==="dragend"){F.manager.disableDragOverStateForRow();F.manager.disableDragOverStateForBlank()}},_computeDragPosition:function(A,B){A=A||window.event;var y=l(A,"wux-datagrid-cell");var C=y.offsetY;if(B&&B.cellView){var v="middle";var w=B.cellView.getDimensions();var x=w.height*1/4;var z=w.height*3/4;if(C<x){v="top"}else{if(C>=x&&C<z){v="middle"}else{v="bottom"}}if(this._currentDropCellView!==B.view){if(this._currentDropCellView){this._currentDropCellView.removeAttribute("wux-ui-drop-position")}this._currentDropCellView=B.view}if(B.cellView._currentDropPosition!==v){B.cellView._currentDropPosition=v;B.view.setAttribute("wux-ui-drop-position",v)}return v}},_getDragAndDropInfos:function(w){var v=t(w.target,"wux-datagrid-cell");if(v){var x=this.getManager()._getCellViewFromDom(v).getDragAndDropInfos().from;if((w.type==="dragover"||w.type==="dragenter"||w.type==="dragleave")&&x&&x.cellView){x.dropPosition=this._computeDragPosition(w,x)}if(x===undefined){x={manager:this.getManager(),parent:this.getManager()._instance}}return x}else{return{manager:this.getManager(),parent:this.getManager()._instance}}},_onDragStart:function(y){var z=this.getManager()._getCellInfosFromDom(y.target);var A=true;if(z.isHeader&&z.virtualRowID===-1){A=this.getManager().getColumnOptions(z.dataIndex).isDraggable;if(A!==false){A=true}}else{var w=true;if(z&&z.nodeModel){w=z.nodeModel.isSelected()}if(!w){A=false;var v=t(y.target,"wux-datagrid-cell");if(v){var x=this.getManager()._getCellViewFromDom(v);if(x){A=x._uiNodeUpForTouchOrDownForMouse(y,"up")}}}if(A){A=this.options.shouldAcceptDrag(z)}}if(!A){y.preventDefault();if(i){console.warn("dragstart prevented")}}else{this._processDragAndDropCallback_v2(y)}},_onDrag:function(w){this._processDragAndDropCallback_v2(w);var v=this._getDragAndDropInfos(w);if(this.options.onDrag){this.options.onDrag.call(this,w,v)}},_onDragEnd:function(v){var w=this.getManager()._getCellInfosFromDom(v.target);var x=this.options.shouldAcceptDrag(w);if(!x){v.preventDefault()}else{this._processDragAndDropCallback_v2(v)}},_onDrop:function(v){v.preventDefault();v.stopPropagation();this._hideColumnInsertionMark();this._hideRowInsertionMark();this._processDragAndDropCallback_v2(v)},_onDragOver:function(v){v.preventDefault();this._processDragAndDropCallback_v2(v)},_onDragLeave:function(v){this._processDragAndDropCallback_v2(v)},_onDragEnter:function(v){v.preventDefault();v.stopPropagation();this._processDragAndDropCallback_v2(v)},_showRowInsertionMark:function(v){var w=this;setTimeout(function(){if(w._insertRowMark===undefined){w._insertRowMark=new f.Element("div",{"class":"wux-datagrid-row-insertion-mark",styles:{position:"absolute",top:v,left:0,height:2,right:0,zIndex:400010}}).inject(w.elements.container)}else{w._insertRowMark.setStyles({display:"block",top:v})}},10)},_hideRowInsertionMark:function(){if(this._insertRowMark!==undefined){var v=this;v._insertRowMark.hide()}},_showColumnInsertionMark:function(v){var w=this;setTimeout(function(){if(w._insertMark===undefined){w._insertMark=new f.Element("div",{"class":"wux-datagrid-column-insertion-mark",styles:{position:"absolute",top:0,left:v,width:2,bottom:0,zIndex:400010}}).inject(w.elements.container)}else{w._insertMark.setStyles({display:"block",left:v});if(!w._insertMark.parentNode){w._insertMark.inject(w.elements.container)}}},1)},_hideColumnInsertionMark:function(){if(this._insertMark!==undefined){var v=this;v._insertMark.hide()}},_highlightDropArea:function(v){this._unhighlightDropArea();this._currentDropArea=v;this._currentDropArea.elements.container.addClassName(s)},_unhighlightDropArea:function(){if(this._currentDropArea){this._currentDropArea.elements.container.removeClassName(s).removeAttribute("wux-ui-drop-position")}},_getGlobalIsEditableOptions:function(){var v=this._cellsManager.options.isEditable;if(v===true){return true}if(v===false){return false}if(typeof v==="object"){return{switchToWriteView:v.switchToWriteView,switchToReadView:v.switchToReadView,rowsHeaders:v.rowsHeaders,columnsHeaders:v.columnsHeaders,cells:v.cells,columnsAreDraggable:v.columnsAreDraggable,rowsAreDraggable:v.rowsAreDraggable}}},_manageCellRequests:function(){var w=this;this._cellsManager._listOfColumnPerformances={};function v(F){var x;if(w._cellsManager._debugPerformanceIssues){if(w._cellsManager._listOfColumnPerformances[F.dataIndex]===undefined){w._cellsManager._listOfColumnPerformances[F.dataIndex]=[]}x=window.performance?performance.now():Date.now()}var C=F.virtualRowID;var A=F.virtualColumnID;var G=F.cellModel;if(G){var E=G.getCellContent();var B=w._getGlobalIsEditableOptions();var D=w._cellsManager.getColumnOptions(A);if(!D.onCellRequest){var z=D?D.isEditable:{};var y=f.extend(B,z,true);if(y.switchToReadView){F.cellView._virtualRowID=C;F.cellView._virtualColumnID=A}else{F.cellView._virtualRowID=C;F.cellView._virtualColumnID=A;if(c.getUnsafeHTMLContentValueToApply(F.cellView.getGridEngine().options.shouldCellAllowUnsafeHTMLContentAt(F)===false)){F.cellView.getContent().textContent=E}else{F.cellView.getContent().innerHTML=E}}}}if(w._cellsManager._debugPerformanceIssues){var H=window.performance?performance.now():Date.now();w._cellsManager._listOfColumnPerformances[F.dataIndex].push(H-x)}}w._cellsManager.onCellRequest(v);w._cellsManager.onColumnHeaderRequest(w._columnHeaderRequest.bind(w))},_columnHeaderRequest:function(y){var w=this;var v=y.virtualColumnID;var x=w.options.columns[v];var A;if(x){A=w.options.columns[v].text;y.cellView.getContent().setContent(A);y.isHeader=true;var z=w._cellsManager.getColumnOptions(v);if(z.onCellRequest){w._cellsManager._isRequestingCell=true;z.onCellRequest.call(w._cellsManager,y);w._cellsManager._isRequestingCell=false}}},updateHeight:function(v){this.elements.container.setStyle("height",v==="auto"?"":v);if(v==="auto"){this.elements.container.setStyles({position:"absolute",top:0,left:0,bottom:0,width:"100%"})}else{this.elements.container.setStyle("position","relative")}this.getManager().updateHeight(v)},buildView:function(){var v=this;this.elements.container=new f.Element("div",{"class":"wux-datagrid",tabindex:0,styles:{position:"relative",height:this.options.height==="auto"?"":this.options.height}});if(this.options.height==="auto"){this.elements.container.setStyles({position:"absolute",top:0,left:0,bottom:0,width:"100%"})}if(v.options.showLoaderIndicator){this.elements.loader=new u({asyncUpdate:false});this.elements.loaderOverlay=new f.Element("div",{"class":"wux-datagrid-overlay"});this.elements.loaderOverlay.inject(this.elements.container);this.elements.loader.inject(this.elements.container);this.elements.loader.getContent().setStyles({position:"absolute",top:"50%",left:"50%",zIndex:10000000})}},_loadInternalModel:function(F){this._cellsManager.prepareUpdateView();var B=new j();var z=[];var G=this.options;var A=0;var E;var x=G.data.length;var y=G.columns.length;var C=this;var D=0;var w=0;this._cellsManager.empty();this.options.columns.forEach(function(I,H){C._listOfColumns.push(I.dataIndex);if(C.options.columns[H].minWidth===undefined){C.options.columns[H].minWidth=0}if(C.options.columns[H].width===undefined){C.options.columns[H].width=C.options.defaultCellWidth}C.getManager()._setupColumnType(I);C._cellsManager._columnsList[H]=new h({isHeader:true,rowID:-1,columnID:H,value:I.text,manager:this})});var v=(x)*(y);if(C.options.showLoaderIndicator){this.elements.loader.on(0,true);this.elements.loaderOverlay.addClassName("wux-ui-state-on")}m.forEach(G.data,function(N,K){A++;var L=parseInt(A*y/v*100,10).toString()+"%";if(C.options.showLoaderIndicator){setTimeout(function(){C.elements.loader.update(L)},0)}if(!z[K+D]){z[K+D]=[]}var M=C._readRowData(G.data,K);for(var J=0;J<M.length-1;J++){var H;var I=M[J];if(typeof I==="object"&&I.properties){H=f.extend({isHeader:false,isEditable:C.options.isEditable,rowID:K+D,columnID:J+w,value:I.value,manager:C._cellsManager},I);if(I.properties.rowSpan!==1||I.properties.colSpan!==1){B.pushAction({actionObj:C._cellsManager,actionFunc:C._cellsManager.setCellSpan,actionParamsList:[K+D,J+w,{rowSpan:I.properties.rowSpan,colSpan:I.properties.colSpan}]})}}else{H={isHeader:false,isEditable:C.options.isEditable,rowID:K+D,columnID:J+w,value:M[J],manager:C._cellsManager}}E=new h(H,C.elements.cellsContainer);z[K+D][J+w]=E}},100,function(){C._cellsManager.pushUpdateView();if(F){F.call(C)}if(C.options.showLoaderIndicator){C.elements.loader.off();C.elements.loaderOverlay.removeClassName("wux-ui-state-on")}C.__loadOverlayTimeOut=window.setTimeout(function(){if(C.elements&&C.elements.loaderOverlay){C.elements.loaderOverlay.remove();C.__loadOverlayTimeOut=null}},500)});this._cellsManager.onReady(function(){B.play();C.options.columns.forEach(function(I,H){if(I.isHidden){C._cellsManager.hideColumn(I.dataIndex)}})});return z},getManager:function(){return this._cellsManager},_readRowData:function(y,A){var z=[];var x=A;var w=this.options.columns.length;for(var v=0;v<w;v++){if(y[x][this._listOfColumns[v]]!==undefined){z.push(y[x][this._listOfColumns[v]])}else{z.push("")}}if(y[x]._rowProperties){z.push(y[x]._rowProperties)}else{z.push({rowIndex:null,isHidden:false})}return z}});var k=n.extend({defaultOptions:{data:[],useHeaders:true,useFormulaBar:false,useDynamicLoading:true,headersAreStatic:true,_autoDisplay:true,onDrop:null,onDragOver:null,onDragLeave:null,height:300,isEditable:false,headersDimensions:{width:50,height:25},defaultCellHeight:50,settings:null,alternateRowColor:false,cellClass:b,shouldAcceptDrag:function(v){return true}},init:function(w,v){this._parent(w);if(v===undefined){v=this}this.elements.container=new f.Element("div");this._datagrid=new o(this.options,v);this._setEditionMode(1);this.buildView()},updateHeight:function(v){this._datagrid.updateHeight(v)},_setEditionMode:function(v){this._editionMode=v},_getEditionMode:function(v){return this._editionMode},destroy:function(){this._datagrid.destroy();this._datagrid=null;if(this.__loadOverlayTimeOut){window.clearTimeout(this.__loadOverlayTimeOut)}this._parent()},_shouldAcceptDrag:function(w){var y=this.getManager().getColumnOptions(w.dataIndex);if(!w.isHeader){var v=y.isColumnDraggable;if(v===undefined){v=true}if(v){return this.options.shouldAcceptDrag(w)}else{return false}}else{if(w.virtualRowID===-1){var x=y.isColumnMovable;if(x===undefined){x=true}return x}else{return this._datagrid.options.rowsAreDraggable}}},getManager:function(){return this._datagrid._cellsManager},loadModel:function(v){this._datagrid._buildGrid(v);this._datagrid._manageCellRequests()},reloadModel:function(){var v=this._datagrid._loadInternalModel();this.loadModel(v)},buildView:function(){this.elements.formContainer=new f.Element("form",{styles:{height:"100%",margin:0,padding:0}}).inject(this.elements.container);var v=document.createAttribute("novalidate");this.elements.formContainer.setAttributeNode(v);this.elements.formSubmitButton=new f.Element("input",{type:"submit",styles:{display:"none"}}).inject(this.elements.formContainer);this._datagrid.inject(this.elements.formContainer)},giveFocus:function(){this._datagrid.elements.container.focus()},lostFocus:function(){this._datagrid.elements.container.blur()}});return f.namespace("WUX/Controls/Spreadsheet",k)});define("DS/Spreadsheet/RulesEditor",["UWA/Core","UWA/Event","UWA/Controls/Abstract","DS/Core/Core","DS/Spreadsheet/DataGrid","DS/Core/ActionsStack","DS/Core/PointerEvents"],function(h,a,g,f,c,b,e){var d=g.extend({defaultOptions:{spreadsheet:null},init:function(i){this._parent(i);console.warn("Do not use","Spreadsheet/RulesEditor");this._rules={};this._actionStack=new b();this._buildView();this._fillView();this._buildBottomHeader()},_buildView:function(){this.elements.container=new h.Element("div",{styles:{position:"absolute",top:5,bottom:5,right:5,left:5,padding:20,backgroundColor:"rgba(255,255,255,1)",border:"1px solid white",zIndex:1000}}).inject(document.body);this.elements.topHeader=new h.Element("h1",{"class":"wux-datagrid-preference-topheader",html:"Rules"}).inject(this.elements.container);this.elements.body=new h.Element("div",{"class":"wux-datagrid-preference-body",styles:{overflow:"hidden"}}).inject(this.elements.container);this.elements.bottomHeader=new h.Element("div",{"class":"wux-datagrid-preference-bottomheader",styles:{textAlign:"right"}}).inject(this.elements.container)},show:function(){this._actionStack.clear();this.elements.container.show()},_buildBottomHeader:function(){var i=new h.Element("button",{"class":"wux-controls-button",html:"Apply"}).inject(this.elements.bottomHeader);var k=new h.Element("button",{"class":"wux-controls-button",html:"Cancel"}).inject(this.elements.bottomHeader);var j=this;i.addEventListener(e.POINTERUP,function(){j.applySetting();j.elements.container.hide()});k.addEventListener(e.POINTERUP,function(){j.elements.container.hide()})},applySetting:function(){var j=this.options.spreadsheet;var i=j.getManager();var k=this._rulesGrid.getManager();var l=[];k.getRows().forEach(function(n,m){var o={};n.forEach(function(p,q){o[k.getDataIndexFromColumnID(q)]=p.getCellContent()});if(o.active){l.push({match:function(p){if(p.dataIndex===o.column){switch(o.operator){case"is":if(p.cellModel.getCellContent()===o.value){return true}break;case"contains":if(p.cellModel.getCellContent().indexOf(o.value)!==-1){return true}break;case"greater":if(p.cellModel.getCellContent()>o.value){return true}break;case"lower":if(p.cellModel.getCellContent()<o.value){return true}break}}},onMatch:function(p){switch(o.ruleAction){case"hide":i.hideRow(p.virtualRowID);break;case"show":i.showRow(p.virtualRowID);break;case"remove":i.removeRow(p.virtualRowID);break;case"highlight":i.highlightRow(p.virtualRowID);break;case"unhighlight":i.unhighlightRow(p.virtualRowID);break}},stopProcessingRowAtMatch:true})}});i.applyRules(l)},_fillView:function(){var n=[];var o=this.options.spreadsheet;var m=o.getManager().options.columns;var i=function(s){var r=new h.Element("select");s.options.forEach(function(u){var t=new h.Element("option",{html:u.label,value:u.value}).inject(r)});s.cellModel.setCellContent(r.value);r.addEventListener("change",function(t){s.cellModel.setCellContent(this.value)});return r};var q=function(r){var s=[];m.forEach(function(t){s.push({label:t.text,value:t.dataIndex})});return new i({options:s,cellModel:r.cellModel})};var j=function(r){var s=[{label:"is",value:"is"},{label:"contains",value:"contains"},{label:"is greater than",value:"greater"},{label:"is lower than",value:"lower"}];return new i({options:s,cellModel:r.cellModel})};var k=function(r){var s=[{label:"highlight",value:"highlight"},{label:"unhighlight",value:"unhighlight"},{label:"show",value:"show"},{label:"hide",value:"hide"},{label:"remove",value:"remove"}];return new i({options:s,cellModel:r.cellModel})};m.forEach(function(t,s){var r={colVisibility:!o.getManager().isColumnHidden(s),colName:t.text,colColor:"#FFFFFF"};n.push(r)});var l=new c({columns:[{text:"Enable/Disable",dataIndex:"active",width:"10%"},{text:"Column value",dataIndex:"column",width:"20%"},{text:"Operator",dataIndex:"operator",width:"10%"},{text:"Value to match",dataIndex:"value",width:"20%"},{text:"Action",dataIndex:"ruleAction",width:"20%"},{text:"",dataIndex:"editRules",width:"20%"}],data:n,selection:{cells:false},headersDimensions:{width:40,height:20},isEditable:{switchToWriteView:{event:"",callback:function(r){},view:function(r){},},switchToReadView:{event:"blur",callback:function(r){this.switchToReadView()},view:function(v){switch(v.dataIndex){case"column":return new q({cellModel:v.cellModel});case"operator":return new j({cellModel:v.cellModel});case"ruleAction":return new k({cellModel:v.cellModel});case"value":return new h.Element("input",{type:"text",value:v.cellModel.getCellContent(),events:{change:function(w){v.cellModel.setCellContent(this.value)}}});case"active":var t=new h.Element("input",{type:"checkbox",events:{change:function(w){v.cellModel.setCellContent(this.checked)}}});if(v.cellModel.getCellContent()===true){t.setAttribute("checked","true")}return t;case"editRules":var s=new h.Element("div");var u=new h.Element("div",{html:"+",styles:{height:16,width:16,minWidth:16,textAlign:"center",padding:0,lineHeight:"16px",borderRadius:"50%",fontWeight:800,color:"grey",fontSize:"14px"},"class":"wux-controls-button wux-ui-state-no-selection",events:{click:function(w){v.manager.addRow(undefined,v.virtualRowID)}}}).inject(s);var r=new h.Element("div",{html:"-",styles:{height:16,width:16,minWidth:16,textAlign:"center",padding:0,lineHeight:"16px",borderRadius:"50%",fontWeight:800,color:"grey",fontSize:"14px"},"class":"wux-controls-button wux-ui-state-no-selection",events:{click:function(w){v.manager.removeRow(v.virtualRowID)}}}).inject(s);return s;default:return new h.Element("div",{html:v.cellModel.getCellContent()})}},},rowsHeaders:false,columnsHeaders:false,cells:true,columnsAreDraggable:false,rowsAreDraggable:true},height:"auto"}).inject(this.elements.body);this._rulesGrid=l;l.getManager().onRowHeaderRequest(function(u){var s=this._getCellsModel();var t=u.virtualRowID;u.cellView.getContent().setStyles({paddingLeft:5,paddingRight:5});if(s[t]){var v=s[t][0];var r;if(v){r=new h.Element("div",{"class":"wux-ui-hamburger",styles:{opacity:0.5,margin:5,fontSize:"1.5em"}})}if(u.cellView.getContent){u.cellView.getContent().setHTML(r)}}});l.elements.container.setStyles({width:800});var p=this;l.getManager().onMoveRow(function(r){p._actionStack.pushAction({actionObj:o.getManager(),actionFunc:o.getManager().moveColumn,actionParamsList:[r.fromRowID,r.toRowID]})})}});return d});define("DS/Spreadsheet/Preferences",["UWA/Core","UWA/Event","UWA/Controls/Abstract","DS/Core/Core","DS/Spreadsheet/DataGrid","DS/Core/ActionsStack","DS/Core/PointerEvents"],function(h,a,g,f,c,b,d){var e=g.extend({defaultOptions:{spreadsheet:null},init:function(i){this._parent(i);this._thingsToApply={};this._actionStack=new b();this._buildView();this._fillView();this._buildBottomHeader()},_buildView:function(){this.elements.container=new h.Element("div",{styles:{position:"absolute",top:5,bottom:5,right:5,left:5,padding:20,backgroundColor:"rgba(255,255,255,1)",border:"1px solid white",zIndex:1000}}).inject(document.body);this.elements.topHeader=new h.Element("h1",{"class":"wux-datagrid-preference-topheader",html:"Grid preferences"}).inject(this.elements.container);this.elements.body=new h.Element("div",{"class":"wux-datagrid-preference-body"}).inject(this.elements.container);this.elements.bottomHeader=new h.Element("div",{"class":"wux-datagrid-preference-bottomheader",styles:{textAlign:"right"}}).inject(this.elements.container)},show:function(){this._actionStack.clear();this.elements.container.show()},_buildBottomHeader:function(){var i=new h.Element("button",{"class":"wux-controls-button",html:"Apply"}).inject(this.elements.bottomHeader);var k=new h.Element("button",{"class":"wux-controls-button",html:"Cancel"}).inject(this.elements.bottomHeader);var j=this;i.addEventListener(d.POINTERUP,function(){j.applySetting();j.elements.container.hide()});k.addEventListener(d.POINTERUP,function(){j.elements.container.hide()})},applySetting:function(){var l=this;var j=this.options.spreadsheet;for(var k in l._thingsToApply){var i=l._thingsToApply[k];if(i.bgColor!==undefined){l._actionStack.pushAction({actionObj:j.getManager(),actionFunc:j.getManager().styleColumn,actionParamsList:[parseInt(k,10),{backgroundColor:i.bgColor}]})}if(i.visibility!==undefined){var m;if(i.visibility){m=j.getManager().showColumn}else{m=j.getManager().hideColumn}l._actionStack.pushAction({actionObj:j.getManager(),actionFunc:m,actionParamsList:[parseInt(k,10)]})}}l._actionStack.play()},_fillView:function(){var i=[];var l=this.options.spreadsheet;var k=l.getManager().options.columns;k.forEach(function(p,o){var n={colVisibility:!l.getManager().isColumnHidden(o),colName:p.text,colColor:"#FFFFFF"};i.push(n)});var j=new c({columns:[{text:"Column",dataIndex:"colName"},{text:"Hide/Show",dataIndex:"colVisibility"},{text:"Color",dataIndex:"colColor"}],data:i,selection:{cells:false},headersDimensions:{width:40,height:20},isEditable:{switchToWriteView:{event:"dblclick",callback:function(n){this.switchToWriteView()},view:function(n){return new h.Element("input",{type:"text",value:n.getCellContent(),})},},switchToReadView:{event:"blur",callback:function(n){this.switchToReadView()},view:function(o){switch(o.cellModel.getColumnID()){case 2:var p=l.getManager().getColumnOptions(o.cellModel.getRowID());return new h.Element("input",{type:"color",value:p._bgcolor||"#FFFFFF",events:{change:function(s){console.log(this.value);var r=this.value;var q=o.cellModel.getRowID();p._bgcolor=r;if(!m._thingsToApply[q]){m._thingsToApply[q]={}}m._thingsToApply[q].bgColor=r}}});case 1:var n=new h.Element("input",{type:"checkbox",events:{change:function(r){var q=o.cellModel.getView().getVirtualCoordinates().virtualRowID;if(!m._thingsToApply[q]){m._thingsToApply[q]={}}m._thingsToApply[q].visibility=this.checked}}});if(o.cellModel.getCellContent()===true){n.setAttribute("checked","true")}return n;default:return new h.Element("div",{html:o.cellModel.getCellContent()})}},},rowsHeaders:false,columnsHeaders:false,cells:true,columnsAreDraggable:false,rowsAreDraggable:true}}).inject(this.elements.body);j.getManager().onRowHeaderRequest(function(o){o.cellView.getContent().setStyles({paddingLeft:5,paddingRight:5});var n;n=new h.Element("div",{"class":"wux-ui-fa wux-ui-fa-bars"});if(o.cellView.getContent){o.cellView.getContent().setHTML(n)}});j.elements.container.setStyles({width:440});var m=this;j.getManager().onMoveRow(function(n){m._actionStack.pushAction({actionObj:l.getManager(),actionFunc:l.getManager().moveColumn,actionParamsList:[n.fromRowID,n.toRowID]})})}});return e});