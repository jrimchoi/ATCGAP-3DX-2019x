(function(a){define("DS/WAFData/WAFData",["module","require","DS/Logger/Logger"],function(c,e,z){var O={},w=/OPTIONS|GET|HEAD|POST|PUT|PATCH|DELETE|TRACE|CONNECT/i,k=/^((https?|ftp|file):)?\/\//,x=z.getLogger(c),R=(a.location&&a.location.protocol)?a.location.protocol:"http:",Q=null,J=null,j=[a.Blob,a.FormData,a.Int8Array,a.Uint8Array,a.Uint8ClampedArray,a.Int16Array,a.Uint16Array,a.Int32Array,a.Uint32Array,a.Float32Array,a.Float64Array,a.DataView].filter(function(T){return T}),l,I="access_token",f="x3ds_auth_url",m="x3ds_service_url",o="X-Requested-With",h="xrequestedwith",u="xmlhttprequest",v=/^(async|cors|data|headers|method|onComplete|onFailure|onTimeout|responseType|responseTypeSupport|url|type)$/,q=/^(json|document|blob|arraybuffer|text)$/,C=a.XMLHttpRequest.DONE||4,g=a.XMLHttpRequest.HEADERS_RECEIVED||2;function s(V,W){var U,T=String(W).toLowerCase();for(U in V){if(U.toLowerCase()===T){return U}}return false}function P(Z){var V,U,T,Y,X,W,aa={};if(Z){Z=Z.trim();W=Z.split("\u000d\u000a");for(V=0;V<W.length;V++){X=W[V];U=X.indexOf("\u003a\u0020");if(U>0){T=X.substring(0,U);Y=X.substring(U+2);aa[T]=Y}}}return aa}function i(X,V){var T,W,U=V.responseTypeSupport?X.responseType:V.responseType;if(V.responseTypeSupport){if(U==="text"||U===""){T=X.responseText}else{try{T=X.response}catch(Y){W=Y;T=null}}}else{if(U==="text"||U===""){T=X.responseText}else{if(U==="json"){T=String(X.responseText).trim();if(T.length===0){T=null}else{T=JSON.parse(T)}}else{if(U==="document"){T=X.responseXML}else{if(U==="arraybuffer"){T=(function(ad){var ab,ac,aa=new a.ArrayBuffer(ad.length*2),Z=new a.Uint16Array(aa);for(ab=0,ac=ad.length;ab<ac;ab++){Z[ab]=ad.charCodeAt(ab)}return aa}(X.responseText))}else{if(U==="blob"){T=new a.Blob([X.responseText],{type:X.getResponseHeader("Content-Type")})}}}}}}if(T===null&&["json","document"].indexOf(U)===-1){throw new Error('InvalidResponseError: request has probably invalid "Content-type" header require by responseType "'+X.responseType+'" causing: "'+W+'".')}return T}function y(V){var U=[];function T(W){if(W==="/.."){U.pop()}else{U.push(W)}}V.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,T);return U.join("").replace(/^\//,V.charAt(0)==="/"?"/":"")}function F(X){var T=["source","subprotocol","protocol","authority","user","password","domain","port","path","directoryPath","fileName","query","anchor"],Y=new RegExp("^(?:(?:(?:([^#.:]+):)?([^#.:]+):)?//)?((?:([^:]+)(?::(.*?))?@)?([^:/?#]*)(?::(\\d*))?)?((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?"),V,U=Y.exec(X),W={};for(V=0;V<T.length;V++){W[T[V]]=(U[V]||"")}if(W.subprotocol){W.source=W.source.substr(W.subprotocol.length+1)}if(!W.port){W.port=W.protocol==="https"?"443":"80"}if(W.directoryPath&&W.directoryPath.length>0){W.directoryPath=W.directoryPath.replace(/\/?$/,"/")}W.domain=W.domain.toLocaleLowerCase();W.protocol=W.protocol.toLocaleLowerCase();return W}function K(U){var T="";if(U.protocol){T=U.protocol+"://";if(U.subprotocol){T=U.subprotocol+":"+T}}if(U.domain){T+=U.domain;if(U.port&&(U.protocol!=="http"||parseInt(U.port,10)!==80)&&(U.protocol!=="https"||parseInt(U.port,10)!==443)){T+=":"+U.port}}else{if(U.authority){T+=U.authority}}if(U.path){T+=U.path}if(U.query){T+="?"+U.query}if(U.anchor){T+="#"+U.anchor}return T}function b(V,Y){var X,U,W=false,T=k.test(V),Z=k.test(Y);if(!T&&!Z){W=true}else{if(!T){V=p(Y,V)}else{if(!Z){Y=p(V,Y)}}X=F(V);U=F(Y);W=["domain","protocol","port"].every(function(aa){return X[aa]===U[aa]||(aa==="protocol"&&(X[aa]===""||U[aa]===""))})}return W}function p(T,U){T=String(T);U=String(U);if(!k.test(T)){throw new Error("First argument should be a absolute URL.")}if(T.substring(0,2)==="//"){T=R+T}var aa,Y,ab=String(T).split("://"),W=ab[0],X=ab[1],V=X.split("/"),Z=V[0],ac="";if(U.substring(0,2)==="//"){T=W+":"+U}else{if(U.split("://").length>1){T=U}else{if(U.substring(0,1)==="/"){T=W+"://"+Z+U}else{for(aa=1,Y=V.length-1;aa<Y;aa++){ac+="/"+V[aa]}T=W+"://"+Z+y(ac+"/"+U)}}}return T}function r(T){return Function.prototype.call.bind(Object.prototype.toString)(T)==="[object Array]"}l=typeof/./!="function"&&typeof a.Int8Array!="object"?function(T){return typeof T=="function"||false}:function(T){return Function.prototype.call.bind(Object.prototype.toString)(T)==="[object Function]"};function H(U){var T=typeof U;return T==="function"||T==="object"&&!!U}function E(T){return j.some(function(U){return T instanceof U})}function D(W,V){var U=W.substring((W.indexOf("?"))+1).split(/[&;]/),T={};if(U.length){U.forEach(function(ab){var X=ab.indexOf("=")+1,Z=X?ab.substr(X):"",Y=[ab],aa=T;if(X){Y=V?([ab.substr(0,X-1)]):(ab.substr(0,X-1).match(/([^\]\[]+|(\B)(?=\]))/g))}if(Y){Z=decodeURIComponent(Z);Y.forEach(function(ad,ac){ad=decodeURIComponent(ad);var ae=aa[ad];if(ac<Y.length-1){aa=aa[ad]=ae||{}}else{if(r(ae)){ae.push(Z)}else{aa[ad]=ae?[ae,Z]:Z}}})}})}return T}function d(T){return encodeURIComponent(T).replace(/\./g,"%2e")}function M(W,Y,Z){var V,X,U,T,aa;if(typeof W==="string"){aa=W}else{if(l(W.toQueryString)){aa=W.toQueryString()}else{aa=[];for(V in W){if(W.hasOwnProperty(V)){X=W[V];U=typeof X;if(Y){V=Z?Y:Y+"["+V+"]"}if(U==="number"?!isNaN(X):undefined!==X&&X!==null){if(!l(X)){if(H(X)||r(X)){T=M(X,V,Z)}else{T=(d(V)+"="+d(X))}}}if(T){aa.push(T)}T=undefined}}aa=aa.join("&")}}return aa}function L(T,U){x.info("onComplete received: ",T," and headers: ",U)}function B(){x.info("onCancel",arguments)}function S(U,T,V){x.warn("onFailure received error: ",U," with content: ",T," and headers: ",V);throw U}function G(T){x.warn("onTimeout received error: ",T.message)}function n(X,ad){var W,U,ab,V,Z,aa;if(g===X.readyState){if(X.status===400&&ad.responseType==="arraybuffer"){X.responseType=""}}else{if(X.aborted){ad.onCancel(X,ad)}else{if(X.timedout){ad.onTimeout(new Error("The request has timedout after "+X.timeout+"ms"))}else{if(C===X.readyState){if(X.timeoutTimer){clearTimeout(X.timeoutTimer)}if(X.status<=0?["http","https"].indexOf(F(p(a.location,ad.url)).protocol)===-1:X.status<400){U=P(X.getAllResponseHeaders());try{W=i(X,ad)}catch(ac){ab=ac;ad.onFailure(ac,W,U)}finally{if(!ab){ad.onComplete(W,U,X)}}}else{Z=X.responseType===""||X.responseType==="text"?X.responseText:String(X.response);V=false;switch(X.status){case 400:try{aa=X.responseType==="json"?X.response:JSON.parse(Z)}catch(Y){aa={}}if(aa&&aa.error==="invalid_grant"&&typeof aa[f]==="string"){t(aa[f],{onComplete:function(ae){var af,ag,ah=JSON.parse(ae);if(ah&&ah[I]&&ah[m]){ag=F(ah[m]);if(ag.query===""){ag.query="ticket="+ah[I]}else{af=D(ag.query,true);af.ticket=ah[I];ag.query=M(af,null,true)}t(K(ag),ad)}},headers:{Accept:"application/json"},withCredentials:true});V=true}break;case 401:try{aa=X.responseType==="json"?X.response:JSON.parse(Z)}catch(Y){aa={}}if(Z.indexOf("Invalid, expired or missing CASTGC")!==-1||(aa&&aa.error==="invalid_client"&&typeof aa[f]==="string")){V=true;x.error("onReadyStateChange : Passport proxy PGT error, please reload your page");if(Q){Q(new Error("NetworkError: Invalid, expired or missing CASTGC"),aa[f])}}break;case 403:if(Z==="PGT is no more valid"){V=true;x.error("onReadyStateChange : Lost proxy passport auth session, please reload your page");if(Q){Q(new Error("NetworkError: PGT is no more valid"))}}break;default:}if(!V){U=P(X.getAllResponseHeaders());try{W=i(X,ad)}catch(T){}ad.onFailure(new Error('NetworkError: URL "'+ad.url+'" return ResponseCode with value "'+(X.status||0)+'".'),W,U)}}}}}}}function A(T){if(e&&e.defined){return e.defined(T)}else{try{e(T);return true}catch(U){return false}}}function N(){var U="DS/PlatformAPI/PlatformAPI",T="com.3ds.wp.passport.cors";if(J===null){J=!(A(U)&&String(e(U).getApplicationConfiguration(T))==="disabled");if(!J){x.info("Passport CORS authentication is not supported")}}return J}function t(V,af){if(!V){throw new Error("Bad or missing URL argument.")}var ae=new a.XMLHttpRequest(),U=af||{},Y=typeof U.async!=="undefined"?!!U.async:true,aa=U.data||null,Z=U.cache===false||U.cache&&U.cache<0,W=U.headers||{},T=U.method||"GET",ad=U.type,ac,ab;T=w.test(T)?T.toUpperCase():T;if(aa){if(typeof aa!=="string"&&!E(aa)){U.data=aa=M(aa)}if(T==="GET"){V+=((V.indexOf("?")>-1)?"&":"?")+aa;U.data=aa=null}}if(Z){V+=((V.indexOf("?")>-1)?"&":"?")+"_="+Date.now()}if(!s(W,o)){if(b(V,a.location)){W[o]="XMLHttpRequest"}else{if(!(D(F(V).query)[h])){V+=((V.indexOf("?")>-1)?"&":"?")+h+"="+u}}}ae.open(T,V,Y);if(Y){U.timeout=typeof U.timeout!=="undefined"?U.timeout:25000}else{delete U.timeout}U.onComplete=U.onComplete||L;U.onCancel=U.onCancel||B;U.onTimeout=U.onTimeout||U.onFailure||G;U.onFailure=U.onFailure||S;U.url=V;switch(ad){case"json":if(!s(W,"Accept")){W.Accept="application/json,text/javascript,*/*"}break;case"text":if(!s(W,"Accept")){W.Accept="text/plain"}if(U.withCredentials&&W.Accept.indexOf("application/json")===-1){W.Accept+=",application/json"}break;case"xml":if(!s(W,"Accept")){W.Accept="application/xml,text/xml,*/*"}if(typeof U.responseType==="undefined"){U.responseType="document"}break;default:break}if(typeof U.responseType==="undefined"&&q.test(ad)){U.responseType=ad}U.responseTypeSupport="responseType" in ae&&U.responseType!=="json"&&(Y||typeof window==="undefined");for(ac in U){if(U.hasOwnProperty(ac)&&!v.test(ac)){ae[ac]=U[ac]}}if(U.responseTypeSupport){try{ae.responseType=U.responseType||"text"}catch(X){ae.responseType="text"}}if(U.mimeType&&ae.overrideMimeType){ae.overrideMimeType(U.mimeType)}if(T==="POST"&&!s(W,"Content-Type")&&!E(aa)){W["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8"}if(ae.setRequestHeader){for(ab in W){if(W.hasOwnProperty(ab)&&W[ab]){ae.setRequestHeader(ab,W[ab])}}}if(ae.addEventListener&&af.onProgress){ae.addEventListener("progress",function(ag){af.onProgress(ag)})}if(ae.upload&&ae.upload.addEventListener&&af.onUploadProgress){ae.upload.addEventListener("progress",function(ag){af.onUploadProgress(ag)})}ae.onreadystatechange=n.bind(O,ae,U);if(U.timeout){ae.timeoutTimer=setTimeout(function(){ae.timedout=true;ae.abort()},U.timeout)}ae.send(aa);return{cancel:function(){ae.aborted=true;ae.abort()},xhr:ae}}O.setErrorHandler=function(T){if(T){Q=T}};O.request=function(U,T){var V,W={};T=T||{};for(V in T){if(T.hasOwnProperty(V)){W[V]=T[V]}}return t(U,W)};O.authenticatedRequest=function(U,T){var W,V=T||{};if(N()||b(U,a.location)){V.withCredentials=true;W=O.request(U,V)}else{if(A("UWA/Data")){V.proxy="passport";V.onComplete=V.onComplete||L;V.onCancel=V.onCancel||B;V.onFailure=V.onFailure||S;V.onTimeout=V.onTimeout||S;W=e("UWA/Data").request(U,V)}else{(V.onFailure||S)(new Error("No CORS support and passport proxy unavailable"),null,{})}}return W};O.proxifiedRequest=function(U,T){var W,V=T||{};if(A("UWA/Data")){V.proxy=V.proxy||"ajax";V.useJsonpRequest=false;V.onComplete=V.onComplete||L;V.onCancel=V.onCancel||B;V.onFailure=V.onFailure||S;V.onTimeout=V.onTimeout||S;W=e("UWA/Data").request(U,V)}else{(V.onFailure||S)(new Error("Proxy unavailable"),null,{})}return W};O.handleRequest=function(U,T){var V;if(T.authentication&&T.authentication==="passport"){V=this.authenticatedRequest(U,T)}else{if((T.proxy!=="none")&&(!b(U,a.location)||T.proxy||T.auth||T.authentication)){V=this.proxifiedRequest(U,T)}else{V=this.request(U,T)}}return V};return O})}(this));