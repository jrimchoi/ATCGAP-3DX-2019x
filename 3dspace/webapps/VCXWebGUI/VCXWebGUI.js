define("DS/VCXWebGUI/VCXToolbarCtrl",["UWA/Class","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/RuntimeView/RSCManager","DS/ApplicationFrame/CommandsManager"],function(a,e,c,f,b){var d=a.extend({init:function(g){var h=this;this.options=g;if(g.parent===undefined){return}h._listFixedItem={};h._listItem={};h._listMainItem={};h.listCmdCreated=[];h._titleName=new UWA.Element("div",{html:g.title,"class":"vcxToolbarTitle",}).inject(g.parent);h._titleMenu=new UWA.Element("div",{styles:{"float":"right",width:"24px",},}).inject(g.parent);h._titleMenuExpandable=new UWA.Element("div",{"class":"vcxToolbarMenuExpandable",}).inject(h._titleMenu);if(g.controller&&g.controller._vcxGuiManager&&g.controller._vcxGuiManager._experienceBase.getManager("VCXContextManager").isIE11()){h._titleMenuExpandable.addClassName("IE11")}h._titleToolbar=new UWA.Element("div",{"class":"vcxTitleToolbar",}).inject(g.parent);h._toolBarEdit=new UWA.Element("div",{"class":"vcxToolbarEdit vcxHidden",styles:{"float":"right",overflow:"hidden",whiteSpace:"nowrap",},}).inject(g.parent);h._listDisplayMainCmd=[];h._listDisplayExpandedCmd=[];h._toggleDisplayEditToolbar=false},unInitialize:function(){for(var g in this.listCmdCreated){var h=this.listCmdCreated[g];if(h.cmdId){h.removeEventListener(c.POINTERUP,this.pointerDownOnCommandButtonStarterCB,false);h.vcxCallBack&&h.removeEventListener(c.POINTERUP,h.vcxCallBack,false);h.flagPointerDown&&h.removeEventListener(c.POINTERDOWN,h.flagPointerDown);h.toggleMenu&&h.removeEventListener(c.POINTERUP,h.toggleMenu);h._experienceBase=null;h.cmdId=null;h.checkedButton=null;h.cbPointerDown=null;h.vcxCallBack=null;h.flagPointerDown=null;h.toggleMenu=null}if(h.cbPointerUp){h.removeEventListener(c.POINTERUP,h.cbPointerUp);h.cbPointerUp=null}h.remove()}this.listCmdCreated=null;this._titleName.remove();this._titleName=null;this._titleMenu.remove();this._titleMenu=null;this._titleMenuExpandable.remove();this._titleMenuExpandable=null;this._titleToolbar.remove();this._titleToolbar=null;this._toolBarEdit.remove();this._toolBarEdit=null;this._listDisplayMainCmd=[];this._listDisplayExpandedCmd=[];this._listFixedItem={};this._listItem={};this._listMainItem={};this.options=null},getTextContainer:function(){return this._titleName},activateEditMode:function(h){var j=this;if(h){j=h}j._toggleDisplayEditToolbar=true;if(typeof(j._toolbarTitle)==="undefined"){j._toolbarTitle=j._titleName.innerHTML}var i=j.options.controller.getNbSelectedItems();var g=j.options.controller.getNbItems();j.options.parent.addClassName("vcxToolbarEdit");j._titleName.innerHTML=i+" / "+g;j._titleName.addClassName("edit");j._toolBarEdit.removeClassName("vcxHidden");j._titleToolbar.addClassName("vcxHidden");j._titleMenu.addClassName("vcxHidden")},getEditToolbar:function(){return this._toolBarEdit},isEditMode:function(){return this._toggleDisplayEditToolbar},exitEditMode:function(g){var h=this;if(g){h=g}h._toggleDisplayEditToolbar=false;if(typeof(h._toolbarTitle)!=="undefined"){h._titleName.innerHTML=h._toolbarTitle}else{h._toolbarTitle=h._titleName.innerHTML}h.options.parent.removeClassName("vcxToolbarEdit");h._titleName.removeClassName("edit");h._toolBarEdit.addClassName("vcxHidden");h._titleToolbar.removeClassName("vcxHidden");h._titleMenu.removeClassName("vcxHidden")},updateToolbar:function(){this._titleName.style.width="";this._titleToolbar.style.width="";if(this.options.panel.elements){var u=this.options.panel.elements.panel.offsetWidth-24-(this.options.controller.getFrame().getGoToParent()?this.options.controller.getFrame().getGoToParent().offsetWidth:0)}else{var u=this.options.panel.offsetWidth-24-(this.options.controller.getFrame().getGoToParent()?this.options.controller.getFrame().getGoToParent().offsetWidth:0)}var x=this._titleName.offsetWidth;var z=this._titleToolbar.offsetWidth;var s=3;var g=28;var m=335;if(this._titleMenu.childNodes[1]){this._titleMenu.childNodes[1].style.display=""}if(this._titleMenu.childNodes[2]){this._titleMenu.childNodes[2].style.display="none"}var n=null;if(((false)||(x>u-s*g))){z=g*(s-1);x=u-g*s;this._titleName.style.overflow="hidden";this._titleName.style.width=x+"px";this._titleToolbar.style.width=z+"px";for(var t=s-1;t<this._listDisplayMainCmd.length;t++){n=this._listDisplayMainCmd[t];n.style.display="none"}for(var r=0;r<this._listDisplayExpandedCmd.length;r++){var y=this._listDisplayExpandedCmd[r];y.style.display="table-row"}}else{var v=false;if(u<=m){x=248;v=true;u=x+s*g}var w=u-x-(g*s);var h=Math.floor(w/g);var q=Math.max(g*(s-1),Math.min(z,(h+(s-1))*g)+1);this._titleToolbar.style.width=q+"px";if(q>z&&!v){if(this._titleMenu.childNodes[2]){this._titleMenu.childNodes[2].style.display=""}if(this._titleMenu.childNodes[1]){this._titleMenu.childNodes[1].style.display="none"}}for(var p=s-1;p<this._listDisplayMainCmd.length;p++){n=this._listDisplayMainCmd[p];if(p<h+s-1){n.style.display="inline-block"}else{n.style.display="none"}}for(var o=0;o<this._listDisplayExpandedCmd.length;o++){n=this._listDisplayExpandedCmd[o];if(o<h){n.style.display="none"}else{n.style.display="table-row"}}}},addMainItemFixed:function(o,p,m,h,j,l,i,n,k){var g=this.onCreateToolbarButton(o,p,m,h,l,i,n,k);if(!j){j=this._titleToolbar;this._listDisplayMainCmd.push(g);this._listMainItem[m]=g}if(j){j.appendChild(g)}},addMainItem:function(g,i,j,h,l){this.addMainItemFixed(g,i,j,h,null,l);var k=this.addSubItem(g,i,j,h,l);this._listItem[j]=k},addSubItemFixed:function(g,i,k,h,n,m){if(m){var j=this._titleMenuExpandable.childNodes;if(j.length>0){j[j.length-1].addClassName("vcxToolbarMenuExpandedRowLast")}}var l=this.addSubItem(g,i,k,h,n,"",true);this._listItem[k]=l;this._listFixedItem[k]=l;if(Object.keys(this._listFixedItem).length===1){l.addClassName("activated")}},activeItem:function(g){this.activeMainItem(g);this.activeSubItem(g)},desactiveItem:function(g){this.desactiveMainItem(g);this.desactiveSubItem(g)},setItem:function(g,h){if(h){this.activeItem(g)}else{this.desactiveItem(g)}},toggleItem:function(g){this.toggleMainItem(g);this.toggleSubItem(g)},activeMainItem:function(g){var h=this._listMainItem[g];if(h){h.addClassName("activated")}},activeSubItem:function(g){var h=this._listItem[g];if(h){h.addClassName("activated")}},desactiveMainItem:function(g){var h=this._listMainItem[g];if(h){h.removeClassName("activated")}},desactiveSubItem:function(g){var h=this._listItem[g];if(h){h.removeClassName("activated")}},toggleMainItem:function(g){var h=this._listMainItem[g];if(h){if(h.hasClassName("activated")){h.removeClassName("activated")}else{h.addClassName("activated")}}},toggleSubItem:function(g){var h=this._listItem[g];if(h){if(h.hasClassName("activated")){h.removeClassName("activated")}else{h.addClassName("activated")}}},activeSubItemFixed:function(h){var j=this._listItem[h];if(j){if(j.hasClassName("activated")){return}else{for(var g in this._listFixedItem){var k=this._listFixedItem[g];var i=k.childNodes[0].childNodes[0].childNodes[0];if(i.hasClassName(h)){k.addClassName("activated")}else{k.removeClassName("activated")}}}}},addSubItem:function(r,t,o,k,n,g,j){var h=this.onCreateToolbarButton(r,t,o,k,n);var s=new UWA.Element("div",{"class":"vcxToolbarMenuExpandedRow"}).inject(this._titleMenuExpandable);var m=this;s.addEventListener(c.POINTERDOWN,function(v){if(typeof r==="function"){r(n)}else{if(r!==""){var u=null;var w=m.options.controller._vcxGuiManager._experienceBase.getManager("VCXContextManager");if(w){u=w.getContext()}if(b.getCommand(r,u)){b.getCommand(r,u).begin();v.stopImmediatePropagation();v.stopPropagation()}}}},true);if(!j){this._listDisplayExpandedCmd.push(s)}var l=new UWA.Element("div",{"class":"vcxToolbarMenuExpandedCellCmd",}).inject(s);l.appendChild(h);if(r&&typeof r!=="function"){var q=m.options.controller._vcxGuiManager._experienceBase.getManager("VCXNLSManager");if(q){var i=q.GetNLS([k]);if(i){var p=new UWA.Element("div",{html:i.getTitle({key:r,}),"class":"vcxToolbarMenuExpandedCellTitle",}).inject(s)}}}else{var p=new UWA.Element("div",{html:n,"class":"vcxToolbarMenuExpandedCellTitle",}).inject(s)}return s},addMenu:function(g,j,m,h,n,l){var k=this.onCreateToolbarButton(g,j,m,h,n);if(!l){l=this._titleMenu}l.appendChild(k);var i=this;k.vcxCallBack=function(){i._titleMenuExpandable.removeClassName("expanded");document.removeEventListener(c.POINTERUP,k.vcxCallBack,false)};k.flagPointerDown=function(o){k._pointerDown=true};k.toggleMenu=function(o){if(!k._pointerDown){return}k._pointerDown=false;o.stopPropagation();if(i._titleMenuExpandable.hasClassName("expanded")){document.removeEventListener(c.POINTERUP,k.vcxCallBack,false)}else{document.addEventListener(c.POINTERUP,k.vcxCallBack,false)}i._titleMenuExpandable.toggleClassName("expanded")};k.addEventListener(c.POINTERDOWN,k.flagPointerDown);k.addEventListener(c.POINTERUP,k.toggleMenu)},onCreateToolbarButton:function(v,w,q,l,p,n,s,o){var m=new UWA.Element("div",{"class":w,styles:{backgroundSize:"cover",display:"inline-block",verticalAlign:"top","float":"right",},html:[]});var g=false;var h=false;var j="";if(Array.isArray(q)){h=true;j=q[0].split("Checked")[0];g=q[0].search("Checked")}else{j=q.split("Checked")[0];g=q.search("Checked")}g=(g>0)?true:false;var i=new UWA.Element("div",{"class":j,styles:{},html:[]});m.commandButton=i;i.lockedWhile=o|false;if(h){var r=new UWA.Element("span",{"class":"wux-ui-fa wux-ui-fa-stack vcx-toolbar-stack"}).inject(i);UWA.createElement("i",{"class":"wux-ui-fa wux-ui-fa-lg "+q[1]}).inject(r);UWA.createElement("i",{"class":"wux-ui-fa wux-ui-fa-lg "+q[2]}).inject(r)}m.appendChild(i);if(g&&n){this._evtStart=e.subscribe({event:n,},function(x){i.setAttribute("checked","")})}if(g&&s){this._evtEnd=e.subscribe({event:s,},function(x){i.removeAttribute("checked")})}if(p==="MENU"||p==="VCXScenarioToolbarDisplayLayout"){}else{m._experienceBase=this.options.controller._vcxGuiManager._experienceBase;m.cmdId=v;m.checkedButton=g;m.addEventListener(c.POINTERUP,this.pointerDownOnCommandButtonStarterCB,false);m.cbPointerUp=function(x){x.stopImmediatePropagation();x.stopPropagation()};m.addEventListener(c.POINTERUP,m.cbPointerUp)}var t=typeof v==="string"&&v!==""?v:(p&&(v===""||Array.isArray(v)))?p:"";f.onResourceLoaded({resourceFile:l,},this.onResourceLoadedCBgen(t,i));var u=this.options.controller._vcxGuiManager._experienceBase.getManager("VCXNLSManager");if(u){var k=u.GetNLS([l]);if(k){m.title=k.getTitle({key:t,})}}this.listCmdCreated.push(m);return m},onResourceLoadedCBgen:function(i,g){return function h(){var j=this.getIcon({key:i,size:"Normal"});if(j){g.style.backgroundImage="url("+j+")"}}},pointerDownOnCommandButtonStarterCB:function(g){g.preventDefault();var m=this.commandButton;var i=g.currentTarget||g.srcElement;var l=false;if(i.checkedButton){if(m.getAttribute("checked")!==null){if(!m.lockedWhile){m.removeAttribute("checked");l=true}else{return}}else{m.setAttribute("checked","")}}var p=i.cmdId;if(Array.isArray(p)){var o=p[0];var k=p[1];var j=p[2];if(l){}else{k.call(o,j)}}else{if(p!==""){var h=null;var n=i._experienceBase.getManager("VCXContextManager");if(n){h=n.getContext()}if(b.getCommand(p,h)){if(l){b.getCommand(p,h).end()}else{b.getCommand(p,h).begin()}}}}g.stopImmediatePropagation();g.stopPropagation()},pointerUpOnCommandButtonStarterCB:function(i){i.preventDefault();var h=i.currentTarget||i.srcElement;var g=h.cmdId;if(typeof g==="function"){}else{return}i.preventDefault();g();i.stopImmediatePropagation();i.stopPropagation()},});return d});
/*!
#include "VCXUISequence.h"
  Script: VCXUISequence.js

    This file is part of UWA JS Runtime.

  About: License

    Copyright 2006-2012 Netvibes, a Dassault Systemes company.
    All rights reserved.
*/
define("DS/VCXWebGUI/VCXUISequence",["UWA/Core","UWA/Controls/Accordion","DS/Core/PointerEvents","DS/VCXWebKernel/VCXCmdChangeSelection"],function(e,a,c,d){var b=a.extend({className:"VCXUISequence",defaultOptions:{className:"",title:null,multiSelect:true,constantItemWidth:false,contentPosition:"bottom"},init:function(h,f,g){this._parent(g);this.elements.container.addClassName(this.className);this._experience=h;this._panel=f;this.sequenceSelectedItems={};this.sequenceOpenedItems={}},unInitialize:function(){var g=this.elements.items;for(var f in g){if(g[f].titleDiv){g[f].titleDiv.removeEvent(c.POINTERUP);g[f].titleDiv.remove();g[f].titleDiv=null}}this._panel=null;this.sequenceSelectedItems=null;this.sequenceOpenedItems=null;this._experience=null},str2DOMElement:function(f){var h=document.createElement("iframe");h.style.display="none";document.body.appendChild(h);h.contentDocument.open();h.contentDocument.write(f);h.contentDocument.close();var g=h.contentDocument.body.firstChild;document.body.removeChild(h);return g},addItem:function(g,n){var q=this;var f=this.elements,l=f.items=f.items||{},j=f.containers=f.containers||{};this._parent(g,n);j[g]=e.createElement("div",{"class":this.className+"-content"}).inject(l[g],(this.options.contentPosition==="top")?"top":"bottom");j[g].parentNode.addClassName("VCXUISequence-item");if(n.content){this.setContent(g,n.content)}var k=g+"-title";var h=f.items[g].getElementsByClassName(k)[0];f.items[g].removeChild(h);var t=n.text;var p=e.createElement("div",{"class":"VCXUISequence-title",});f.items[g].appendChild(p);var m=g+"-title "+this.className+"-item-arrow";var s=e.createElement("div",{"class":m,events:{click:function(u){var i=f.items[g];q._panel.activeSequence(i)},}});p.appendChild(s);f.items[g].titleDiv=e.createElement("span",{"class":k+" VCXUISequence-item-title",text:t,});f.items[g].titleDiv.addEvent(c.POINTERUP,function(i){if(!i.changedTouches){q.sequenceOpenedItem(g)}});p.appendChild(f.items[g].titleDiv);var r=[];for(var o=0;o<f.items[g].children.length;o++){r[o]=f.items[g].children[o]}f.items[g].removeChild(r[0]);f.items[g].removeChild(r[1]);f.items[g].appendChild(r[1])},deleteItem:function(f){var g=this.elements;g.itemContainer.removeChild(g.itemContainer.childNodes[f]);delete g.containers[f];delete g.items[f]},unset:function(m,f,h){var l=f;f={};l[m]=null;delete l[m];var g=0;if(h){g=-1}for(var k in l){if(typeof(l[k])!=="undefined"){if(h){g++}else{g=k}f[g]=l[k]}}return f},isSequenceOpened:function(f){return this.sequenceOpenedItems[f]},sequenceOpenedItem:function(g,f){this.setSequenceItemOpenedState(g,!this.isSequenceOpened(g),f)},setSequenceItemOpenedState:function(l,k,j){var f=this.elements.items[l];j=(!e.is(j)?true:j);var h=f.getElementsByClassName("vcx-controls-thumbnail");if(k&&h.length===0){var g=this;if(k){var h=f.getElementsByClassName("vcx-controls-thumbnail");if(h.length===0){f.addClassName("failOpened",k);var i=0.5;setTimeout(function(){f.removeClassName("failOpened",k)},i*1000)}}}else{if(this.sequenceOpenedItems[l]!==k){if(f){f.toggleClassName("opened",k)}this.sequenceOpenedItems[l]=k}}},getOpenedItems:function(){var h=[];for(var f in this.sequenceOpenedItems){if(this.sequenceOpenedItems.hasOwnProperty(f)){var g=this.sequenceOpenedItems[f];if(g){h.push(f)}}}return h},getSelectedItems:function(){var h=[];for(var f in this.sequenceSelectedItems){if(this.sequenceSelectedItems.hasOwnProperty(f)){var g=this.sequenceSelectedItems[f];if(g){h.push(f)}}}return h},isSequenceSelected:function(f){return this.sequenceSelectedItems[f]},sequenceSelectItem:function(g,f){this.setSequenceItemSelectedState(g,!this.isSequenceSelected(g),f)},setSequenceItemSelectedState:function(n,f,o){var k=this.elements.items[n];o=(!e.is(o)?true:o);if(k||this.sequenceSelectedItems[n]!==f){if(!document._ctrlDown){for(var m in this.sequenceSelectedItems){if(this.sequenceSelectedItems.hasOwnProperty(m)){var l=this.sequenceSelectedItems[m];if(l){var h=this.elements.items[m];h.toggleClassName("selected",false);this.sequenceSelectedItems[m]=false}}}}k.toggleClassName("selected",f);this.sequenceSelectedItems[n]=f;var i=this._experience.getManager("VCXSequenceManager").GetListSequences();var j=i[n];if(f){var g=new d(this._experience.getManager("VCXSelectionManager"));if(document._ctrlDown){g.AddToSelection(j)}else{g.SetSelection(j)}this._experience.getManager("VCXCommandManager").Do(g)}else{var g=new d(this._experience.getManager("VCXSelectionManager"));g.RemoveFromSelection(j);this._experience.getManager("VCXCommandManager").Do(g)}}},addDragOver:function(g){this._dragOverIndex=g;var f=this.elements.items[g];f.toggleClassName("dragover",true)},removeDragOver:function(){if(typeof this._dragOverIndex!=="undefined"){var f=this.elements.items[this._dragOverIndex];f.toggleClassName("dragover",false)}}});return b});define("DS/VCXWebGUI/VCXASmartUpdatable",["UWA/Class"],function(a){var b=a.extend({init:function(){this._bLocked=true;this._xDirtyMask=-1},Update:function(){},CheckUpdate:function(){if(this.IsLocked()){return false}return this.Update()},Lock:function(d){var c=this._bLocked;this._bLocked=d;return c},IsLocked:function(){return this._bLocked},IsDirty:function(c){c=c||0;return this._xDirtyMask&c!=0},Dirtify:function(c){this._xDirtyMask|=c},Undirtify:function(c){this._xDirtyMask&=~c},});Object.defineProperty(b.prototype,"Value",{enumerable:true,get:function(){return this.GetValue()},set:function(c){this.SetValue(c)}});return b});define("DS/VCXWebGUI/VCXGettingStartedUI",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/Core/PointerEvents","DS/CoreEvents/Events","DS/UIKIT/Mask","DS/UIKIT/SuperModal",],function(c,e,d,b,g,a){var f=c.singleton({init:function(h){this._experienceName=null;this._collabSpace=null},initialize:function(h){this.home=UWA.Element("div",{html:"","class":"vcx-Curtain-Home",});this.tstProvider=h.tstProvider;this.createDropZone()},unInitialize:function(){this.dropZone.remove();this.dropZone=null;this.dndObjectOverlay.remove();this.dndObjectOverlay=null;this.dndForbiddenOverlay.remove();this.dndForbiddenOverlay=null;this.home.remove();this.home=null},IsTstProvider:function(){return this.tstProvider},setParentNode:function(h){this.parentNode=h},createDropZone:function(){var h=e.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_G_NXGDragAndDrop.png");this.dropZone=UWA.Element("div",{html:"","class":"vcx-DropZone-Main",});this.dndObjectOverlay=new UWA.Element("div",{id:"xphoto-full-page-dnd-overlay"});this.dndObjectOverlay.inject(this.dropZone);new UWA.Element("div",{id:"xphoto-image-dnd-icon","class":"xphoto-image-dnd-icon",html:[{tag:"img","class":"",src:h},{tag:"span","class":"",html:"Drop your item here"}]}).inject(this.dndObjectOverlay);this.dndObjectOverlay.hide();this.dndForbiddenOverlay=new UWA.Element("div",{id:"xphoto-full-page-dnd-overlay",html:[{tag:"span","class":"wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-wrong xphoto-image-dnd-icon",styles:{color:"#b4b6ba",}}]});this.dndForbiddenOverlay.inject(this.dropZone);this.dndForbiddenOverlay.hide()},startLoadingPage:function(h){this.initWidget=UWA.Element("div",{html:"Initializing ...","class":"vcx-Curtain-InitWidget"}).inject(this.parentNode);UWA.Element("div",{html:"","class":"vcx-Curtain-InitWidget-BrandImage",styles:{backgroundImage:h,}}).inject(this.initWidget)},clearInitWidget:function(){var h=document.getElementsByClassName("vcx-Curtain")[0];if(h){h.destroy()}},startLoadingExperience:function(){g.mask(this.home,"Initializing...")},failLoadingExperience:function(){if(this.home){g.unmask(this.home);if(this.experiencePage){this.experiencePage.removeClassName("vcx-Curtain-Fade")}}},endLoadingExperience:function(){this.dropZoneOFF();this.home.hide();this.experiencePage.removeClassName("vcx-Curtain-Fade");g.unmask(this.home)},startExperiencePage:function(p,k,q,s,n,m,l){this.brandImage=k;this.backgroundImage=q;var u=this;this.home.inject(this.parentNode);this.dropZone.inject(this.parentNode);if(l){this.home.addClassName("vcx-Curtain-MixedLayer")}this.experiencePage=UWA.Element("div",{html:"","class":"vcx-Curtain-Experience-container",}).inject(this.home);var j=UWA.Element("div",{html:"","class":"vcx-Curtain-Experience-Title-Header"}).inject(this.experiencePage);UWA.Element("div",{html:p,"class":"vcx-Curtain-Experience-Title"}).inject(j);var v=UWA.Element("div",{html:"","class":"vcx-Curtain-Experience-Row"}).inject(this.experiencePage);var o=UWA.Element("div",{html:"","class":"vcx-Curtain-Experience-Tile"+(n?"":" vcxFreezed")}).inject(v);var u=this;if(n){o.addEvent(d.POINTERUP,function(w){u.initializeNewExperience(function(){u._experienceBase.getManager("VCXCAT3DXModelManager").CreateExperienceEmpty().done(function(){u.endLoadingExperience()})},"empty")})}var h=UWA.Element("img",{html:"","class":"vcx-Curtain-Experience-Image"+(n?"":" vcxFreezed"),src:e.getWebappsAssetUrl("VCXWebGUI","texture/gui/"+k),}).inject(o);if(!m){h.style.boxShadow="unset"}var r=UWA.Element("div",{html:"","class":"vcx-Curtain-Experience-Footer"}).inject(o);var t=UWA.Element("div",{html:"","class":"vcx-Curtain-Experience-Text"}).inject(r);UWA.Element("span",{html:s,"class":"vcx-Curtain-Experience-Text2"}).inject(t);var r=UWA.Element("div",{html:"","class":"vcx-Curtain-Footer"+(n?"":" vcxAnimate")}).inject(this.experiencePage);if(!m){r.hide()}var i=UWA.Element("div",{html:"","class":"vcx-Curtain-Footer-row"}).inject(r);UWA.Element("img",{html:"",src:e.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_draganddrophp.png"),"class":"vcx-Curtain-Footer-Image"}).inject(i);UWA.Element("span",{html:(n?"Or d":"D")+"rop your content here","class":"vcx-Curtain-Footer-Text"}).inject(i)},setExperienceBase:function(h){this._experienceBase=h},getHomeNode:function(){return this.home},dropZoneON:function(){this.dropZone.addClassName("vcx-DropZone-Display");this.dndObjectOverlay.show();var h=document.getElementsByClassName("vcx-Curtain-Experience-Tile");for(var j=0;j<h.length;j++){h[j].style.pointerEvents="none"}},dropZoneOFF:function(){var h=document.getElementsByClassName("vcx-Curtain-Experience-Tile");for(var j=0;j<h.length;j++){h[j].style.pointerEvents=""}this.dropZone.removeClassName("vcx-DropZone-Display");this.dndObjectOverlay.hide()},addTile:function(k,n,i,h,p){var l=UWA.Element("div",{html:"","class":"vcx-Curtain-Experience-Tile"+(h?"":" vcxFreezed")}).inject(k);if(h){l.addEvent(d.POINTERUP,function(q){p()})}var j=UWA.Element("img",{html:"","class":"vcx-Curtain-Experience-Image"+(h?"":" vcxFreezed"),src:e.getWebappsAssetUrl("VCXWebGUI","texture/gui/"+i),}).inject(l);j.style.animation="unset";var m=UWA.Element("div",{html:"","class":"vcx-Curtain-Experience-Footer"}).inject(l);var o=UWA.Element("div",{html:"","class":"vcx-Curtain-Experience-Text"}).inject(m);UWA.Element("span",{html:n,"class":"vcx-Curtain-Experience-Text2"}).inject(o)},displayOpenOrPlayExperience:function(o){var i=this;var l="vcxOpenPlayExperience";var k=new a({renderTo:document.querySelector("vcx-Curtain-Home"),animate:true,className:l});var n=UWA.Element("div",{html:"","class":"vcx-Curtain-Experience-Row"});var j=true;var m="Open Experience";var h=this.brandImage;this.addTile(n,m,h,j,function(){k.next();i.initializeNewExperience(o,"openExperience")});m="Play";h="I_VCX_SplashPlay.png";this.addTile(n,m,h,j,function(){k.next();i.initializeNewExperience(o,"playMode")});k.dialog({title:"",body:UWA.Element("div",{html:[n],}),})},onDropDocument:function(m,j,l,k){var i=this;var h=i._experienceBase.getManager("VCXCAT3DXModelManager").IsLocalMode();if(h&&j==="Document"){i.displayOpenOrPlayExperience(m);return}i.initializeNewExperience(m,j,l)},initializeNewExperience:function(n,j,m){if(j==="playMode"){widget.simulatePlay=true}this.experiencePage.addClassName("vcx-Curtain-Fade");var k=this;var l=this._experienceBase.getManager("VCXAuthoringServicesManager");if(l){var i=function(p,o){k.startLoadingExperience();k._experienceName=p;k._collabSpace=o;k._experienceBase.getManager("VCXCAT3DXModelManager").NewExperienceBaseAsync(p,o).done(function(q){if(q){if(j==="playMode"){q.getManager("VCXContextManager").setPlayerMode();q.getManager("VCXExperience").SetPreviewMode(true)}n(q);q.getManager("VCXGUIManager").getGettingStartedUI().startLoadingExperience()}else{console.error("create experience base failed")}})};if((j==="openExperience")||(j==="playMode")){i()}else{var h=l.getGettingStartedServices();if(h){h.projectInfoDisplay(i,m,j)}}}},displaySaveBeforeClose:function(k){var i=this;var j=this._experienceBase.getManager("VCXAuthoringServicesManager");if(j){var h=j.getGettingStartedServices();if(h){h.projectInfoDisplaySaveBeforeClose(k)}}else{k[1]()}},onDropProduct:function(k,j){var i=this._experienceBase.getManager("VCXCAT3DXModelManager").Get3dxExperience();if(i){k(this._experienceBase)}else{var h="noCollabSpaceChoice";this.onDropDocument(k,h,j)}},onDropAmbience:function(i){var h=this._experienceBase.getManager("VCXCAT3DXModelManager").Get3dxExperience();if(h){i(this._experienceBase)}else{this.onDropDocument(i)}},onDropExperience:function(h){this.displayOpenOrPlayExperience(h)}});return f});define("DS/VCXWebGUI/VCXGUIServices",["UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/VCXWebKernel/VCXDRMManager"],function(a,c,b,d){var e=a.singleton({displaySignature:function(k,h,z){var q=h.strSignaturePicturePath;var o=h.ulSignatureCRC;var l=k.getManager("VCXContextManager");var w=l.getFrameWindow();var n=w.getUIFrame();var r=w.getImmersiveFrame();k.getManager("VCXContextManager").loadCssFile("VCXWebGUI/VCXWebSignature.css",1);var y=h.strAgreement.replace(/#@/g,"</p><p>");y="<p>"+y+"</p>";var p=null;if(h.resources){var s=h.strSignaturePicturePath;var t=s.replace(/^.*[\\\/]/,"").toLowerCase();p=h.resources[t]}var g='<img src="'+p+'" style="max-width:100%"/>';var f=new UWA.Element("div",{"class":"Signature"});var j=new UWA.Element("div",{"class":"Signature_Cell",html:g});j.inject(f);var x=new UWA.Element("div",{"class":"Signature_Cell",html:y});x.inject(f);var v={};if(h.ulAgreementMode===d.LitSignatureMode.LIT_SIGNATURE_DISPLAY_AND_PASS){v.Ok=new b({onClick:function(C){document.getElementsByClassName("wux-windows-modalDialog")[0].remove();var A=C.dsModel;var B=A.dialog;B._closeOK=true;B.remove();B.close()}})}else{v.Ok=new b({label:"I Agree",onClick:function(C){var A=C.dsModel;var B=A.dialog;B._closeOK=true;B.remove();B.close()}});v.Cancel=new b({label:"I Disagree",onClick:function(C){var A=C.dsModel;var B=A.dialog;B._closeOK=false;B.remove();B.close()}})}var u=new c({title:"Signature",content:f,modalFlag:true,resizableFlag:true,usePaddingFlag:false,width:400,closeButtonFlag:false,immersiveFrame:r,buttons:v});u.elements.container.parentNode.parentNode.removeChild(u.elements.container.parentNode);widget.body.appendChild(u.elements.container.parentNode);var m=h;var i=z;u.addEventListener("close",function(A){if(u._closeOK){m.LoadGeometriesBody(i);m._pause=false;m.launchsmgXMLCB(m)}else{m.launchsmgXMLCB(null)}})},});return e});define("DS/VCXWebGUI/VCXISmartUpdatable",["DS/WebComponentModeler/CATWebInterface"],function(b){var a=b.singleton({interfaceName:"VCXISmartUpdatable",required:{Update:function(){},CheckUpdate:function(){},Lock:function(c){},IsLocked:function(){},IsDirty:function(c){},Dirtify:function(c){},Undirtify:function(c){}}});return a});define("DS/VCXWebGUI/VCXModifiableGUIManager",["DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueBoolean",],function(b,f,c,d,e){var a=b.extend({init:function(){this._parent()},OnChangeProperty:function(h,g){if(h==="GUIManager.DisplayScenarioImmersiveUI"){this.GetObject().SetDisplayScenarioImmersiveUI(g.GetValue())}else{console.log("property not found!");return false}return true},GetProperty:function(i){var g=null;if(i==="GUIManager.DisplayScenarioImmersiveUI"){var h=new e();h.SetValue(this.GetObject().GetDisplayScenarioImmersiveUI());g=new c(new d(i,d.EBehaviorType.Singleton),h)}return g},GetProperties:function(){var g=new f();g.AddOrModifyProperty(this.GetProperty("GUIManager.DisplayScenarioImmersiveUI"));return g}});return a});define("DS/VCXWebGUI/VCXFontBoxing",["UWA/Class","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueEnum"],function(c,h,f,i,j,b,d,e,a){var g=c.extend({initialize:function(k){this._experienceBase=k},unInitialize:function(k){this._experienceBase=null},FontPropertyForGUI:function(m){var r={propertyName:null,propertyHeight:null,propertyItalic:null,propertyBold:null,};var t=new a();t.SetValue(13);var q=new e("Collab.Text.Font_Name",null,false,"VCXWebDressup/VCXWebDressup");var u={0:"Arial",1:"Arial Black",2:"Comic Sans MS",3:"Courier New",4:"Georgia",5:"Impact",6:"Lucida Console",7:"Lucida Sans Unicode",8:"Palatino Linotype",9:"Tahoma",10:"Times New Roman",11:"Trebuchet MS",12:"Verdana"};q.SetMapChoiceEnum(u);for(var n in u){if(u.hasOwnProperty(n)){var l=u[n];if(m.GetFamily().GetValue()===l){t.SetValue(parseInt(n));break}}}if(t.GetValue()===13){u[13]=m.GetFamily().GetValue()}r.propertyName=new h(q,t);var p=new f("Collab.Text.Font_Height",null,false,"VCXWebDressup/VCXWebDressup");var o=new i();o.SetValue(Number((m.GetHeight().GetValue())));r.propertyHeight=new h(p,o);var k=new f("Collab.Text.Font_Italic",null,false,"VCXWebDressup/VCXWebDressup");var s=new b();s.SetValue(m.GetItalic().GetValue());r.propertyItalic=new h(k,s);k=new f("Collab.Text.Font_Bold",null,false,"VCXWebDressup/VCXWebDressup");s=new b();s.SetValue(m.GetWeight().GetValue()===700);r.propertyBold=new h(k,s);return r},UpdateMapForGUI:function(n,u){var r=u.propName;var m=u.std;var s=u.typeRep;if(r==="Collab.Text.Font_Name"){var l=n.propertyName;var v=l.GetPropertyInfo().GetMapChoiceEnum();l.GetPropertyValue().SetValue(13);for(var q in v){if(v.hasOwnProperty(q)){var p=v[q];if(m===p){l.GetPropertyValue().SetValue(parseInt(q));break}}}}else{if(r==="Collab.Text.Font_Height"){var o=n.propertyHeight;o.GetPropertyValue().SetValue(m)}else{if(r==="Collab.Text.Font_Italic"){var t=n.propertyItalic;t.GetPropertyValue().SetValue(m)}else{if(r==="Collab.Text.Font_Bold"){var k=n.propertyBold;k.GetPropertyValue().SetValue(m)}}}}return n},BuildNewValueForGUI:function(p){var m=new d();var n=new j();n.SetValue(p.propertyName.GetPropertyInfo()._mapChoiceEnum[p.propertyName.GetPropertyValue().GetValue()]);var k=p.propertyHeight.GetPropertyValue();var l=p.propertyItalic.GetPropertyValue();var o=p.propertyBold.GetPropertyValue();m.SetFamily(n);m.SetHeight(k);m.SetItalic(l);m.GetWeight().SetValue(o.GetValue()?700:400);return m.ToString()}});return g});define("DS/VCXWebGUI/VCXTreeViewCellAbstract",["DS/Tree/TreeNodeView","DS/Core/PointerEvents",],function(d,a){function c(l){var k=l.currentTarget||l.srcElement,h=k.currentStyle||window.getComputedStyle(k,null),g=parseInt(h.borderLeftWidth,10),j=parseInt(h.borderTopWidth,10),i=k.getBoundingClientRect(),f=l.clientX-g-i.left,m=l.clientY-j-i.top;return{offsetX:f,offsetY:m}}var b=d.extend({init:function(e){this._parent(e);if(this._manager.options.resize.rows||this._manager.options.resize.columns){this._manageResize()}},updateInternalParameters:function(){this._parent();var f=this.getCellInfos();if(f){var g=f.nodeModel;var e=g.getNextNode();((g.getState()==="collapsed")||(e&&e.getState()!=="noChildren"))?this.getContent().addClassName("wux-controls-propertylistview-expander"):this.getContent().removeClassName("wux-controls-propertylistview-expander");(g.options.children&&g.options.children.length==0)?this.getContent().addClassName("vcx-controls-propertylistview-expander-hide"):this.getContent().removeClassName("vcx-controls-propertylistview-expander-hide")}},destroy:function(){this._parent()},_manageResize:function(){var n=this;n.getGridEngine()._enableInteractiveSort();var h=5;var o=this.elements.container;var r=false;var u,i,t,g;o.addEvent(a.POINTERMOVE,function(x){if(!q){var w=n.getCellInfos();u=w;i=w.manager;g=i.getColumnWidth(u.virtualColumnID);t=i.getRowHeight(u.virtualRowID);var v=c(x);if(i.options.resize.columns){if(v.offsetX<g+h&&v.offsetX>g-h){n._setResizeStyle("r");r=true}else{n._setResizeStyle();r=false}}if(i.options.resize.rows){if(v.offsetY<t+h&&v.offsetY>t-h){n._setResizeStyle("b");r=true}else{n._setResizeStyle();r=false}}}});var l=false;var q=false;var m={};var j={};var k;var e;var p=UWA.extendElement(document);var f=0;var s=Infinity;o.addEvent(a.POINTERDOWN,function(x){if(x.originalEvent.type==="touchstart"){r=true;h=32;u=n.getCellInfos();i=n.getGridEngine();g=i.getColumnWidth(u.virtualColumnID);t=i.getRowHeight(u.virtualRowID)}var v=c(x);if(r){if(((v.offsetY<t+h&&v.offsetY>t-h))||((v.offsetX<g+h&&v.offsetX>g-h))){x.preventDefault();i.getScroller().getContent().addClassName("wux-ui-locked");i.lockUI();m={x:x.clientX,y:x.clientY};k=g;e=t;q=true;var w=n.getGridEngine()._getColumnOptionValue(u.virtualColumnID,"maxWidth");s=w!==undefined?w:Infinity;f=n.getGridEngine()._getColumnOptionValue(u.virtualColumnID,"minWidth");n.getGridEngine()._disableInteractiveSort(true)}}});UWA.Element.addEvent.call(document,a.POINTERMOVE,function(v){if(q&&r){if(!l){n.getGridEngine()._disableInteractiveSort()}l=true;j.x=v.clientX-m.x;j.y=v.clientY-m.y;if((g+j.x)>=f&&(g+j.x)<=s){k=g+j.x;n._manager._updateViewOptions={detachAllViews:false,updateCells:false,updateColumnsHeaders:true};i._instance._showColumnInsertionMark(i.getScroller().getPosition().x+i.getHeadersDimensions().width+i.getColumnPosition(u.virtualColumnID)+k)}}});UWA.Element.addEvent.call(document,a.POINTERUP,function(v){if(q){v.preventDefault();v.stopPropagation();n._setResizeStyle();if(n.elements.container){n.elements.container.removeClassName("wux-ui-state-active")}setTimeout(function(){n.getGridEngine()._enableInteractiveSort()},300);if(u.virtualRowID!==-1){i.setRowHeight(u.virtualRowID,e)}if(u.virtualColumnID!==-1){i.prepareUpdateView();i.setColumnWidth(u.virtualColumnID,k);i._requireFullUpdate();n._manager._updateViewOptions={detachAllViews:true,updateCells:true,updateColumnsHeaders:true};i.pushUpdateView(true)}i._instance._hideRowInsertionMark();i._instance._hideColumnInsertionMark();i.unlockUI();q=false;r=false}})},});return b});define("DS/VCXWebGUI/VCXUndoRedoCtrl",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Spreadsheet/DataGrid"],function(d,c,a,b){var e=d.extend({init:function(f){this.bIsDirty=false;this._vcxGuiManager=f;var h=this;this._tokenUpdate=a.subscribe({event:"VCX_UNDOREDO_STACK_UPDATE"},function(){h.Redraw()});this._tokenUndoRedo=a.subscribe({event:"VCX_UNDOREDO_DONE"},function(){h.Redraw()});this._mainPanel=new UWA.Element("div",{html:"","class":"VCXUndoRedoCtrl",styles:{display:"none",margin:"",height:"300px",width:"300px",bottom:"100px",left:"100px",position:"absolute",border:"1px dotted black"},}).inject(h._vcxGuiManager._uiLayer);var g={apiVersion:2,height:"auto",headersDimensions:{width:15,height:15},show:{rowHeaders:false,columnHeaders:true},resize:{columns:true,rows:true},isSortable:false,className:"stack",columns:[{text:"Undo",dataIndex:"undoCmd",width:150},{text:"Redo",dataIndex:"redoCmd",width:150}]};g.selection={cells:false};h.datagrid=new b(g);h.datagrid.inject(this._mainPanel)},unInitialize:function(){a.unsubscribe(this._tokenUpdate);delete this._tokenUpdate;a.unsubscribe(this._tokenUndoRedo);delete this._tokenUndoRedo},Redraw:function(){var m=this;var p=m._vcxGuiManager._vcxexperience.getManager("VCXCommandManager");var n=[];var q=0;for(var j=p._stackCmd.length-1;j>=0;j--){if(q>20){break}var g=p._stackCmd[j];if(g&&!g.IsLinkedCmd()){var k="UnknownCommand";if(typeof g.GetTitle!=="undefined"){k=g.GetTitle()}n.push(k);q++}}var s=[];q=0;for(var r=p._stackCmdUndo.length-1;r>=0;r--){if(q>20){break}var g=p._stackCmdUndo[r];if(g&&!g.IsLinkedCmd()){var f="UnknownCommand";if(typeof g.GetTitle!=="undefined"){f=g.GetTitle()}s.push(f);q++}}if(n.length===0&&s.length===0){var h=this.datagrid.getManager();h.prepareUpdateView();for(var j=h.getNumberOfRows()-1;j>=0;j--){h.removeRow(j)}h.pushUpdateView()}else{var h=this.datagrid.getManager();h.prepareUpdateView();for(var j=h.getNumberOfRows()-1;j>=0;j--){h.removeRow(j)}var t=Math.max(n.length,s.length);for(var j=0;j<t;j++){var o="";if(j<n.length){o=n[j]}var l="";if(j<s.length){l=s[j]}h.addRow({undoCmd:o,redoCmd:l})}h.pushUpdateView()}m.bIsDirty=false}});return e});define("DS/VCXWebGUI/VCXDocManagerCtrl",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Spreadsheet/DataGrid"],function(e,d,b,c){var a=e.extend({init:function(f){var h=this;h.bIsDirty=false;this._vcxGuiManager=f;this._tokenDocAdded=b.subscribe({event:"VCX_DOC_ADDED"},function(){h.onRedraw()});this._mainPanel=new UWA.Element("div",{html:"","class":"VCXDocManagerCtrl",styles:{display:"none",margin:"",height:"300px",width:"300px",bottom:"100px",left:"100px",position:"absolute",border:"1px dotted black"},}).inject(h._vcxGuiManager._uiLayer);var g={apiVersion:2,height:"auto",headersDimensions:{width:15,height:15},show:{rowHeaders:true,columnHeaders:true},resize:{columns:true,rows:true},isSortable:false,className:"documentManager",columns:[{text:"Id",dataIndex:"id",width:130},{text:"Document",dataIndex:"document",width:130}]};g.selection={cells:false};h.datagrid=new c(g);h.datagrid.inject(this._mainPanel)},unInitialize:function(){b.unsubscribe(this._tokenDocAdded);delete this._tokenDocAdded},onRedraw:function(){var q=this;if(this._mainPanel.style.display==="none"){return}console.log("redrawPanel");var r=q._vcxGuiManager._vcxexperience.getManager("VCXDocManager");if(r.IsEmpty()){var j=this.datagrid.getManager();j.prepareUpdateView();for(var l=j.getNumberOfRows()-1;l>=0;l--){j.removeRow(l)}j.pushUpdateView()}else{var j=this.datagrid.getManager();j.prepareUpdateView();for(var l=j.getNumberOfRows()-1;l>=0;l--){j.removeRow(l)}var t=r.NumberOfDoc();for(var l=0;l<t;l++){var n=r.GetPropPath(l);var p=n.GetPathType().GetValue();if(p===0){var f=n.GetValueURL().GetValue();if(f.indexOf("blob:")>=0){f=n.GetFileName().GetValue()}j.addRow({id:l.toString(),document:f})}else{if(p===1){var h=n.GetValueLink().GetValue();var m=q._vcxGuiManager._vcxexperience.ComponentsMap.GetComponentFromID(h);if(m){var k=m.GetName();j.addRow({id:l.toString(),document:k})}}else{if(p===2){var o=n.GetValueLink().GetValue();var g=q._vcxGuiManager._vcxexperience.ComponentsMap.GetComponentFromID(o);if(g){var s=g.GetName();j.addRow({id:l.toString(),document:s})}}}}}j.pushUpdateView()}}});return a});define("DS/VCXWebGUI/VCXTimelineController",["DS/CoreEvents/Events","DS/WebRBTree/WebRBIterator","DS/VCXWebTimeline/VCXWebTimelineController","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeTimePos","DS/VCXWebKernel/VCXCmdGoToMarker","DS/ApplicationFrame/CommandsManager","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXPropertySet"],function(d,f,j,c,k,e,b,a,i,h){var g=j.extend({init:function(m){this._parent(m);var l=this;this._VCX_Timeline_MODEL_STOP_PLAY=d.subscribe({event:"VCX_STOP_PLAY"},function(o){if(l.options.experienceBase.getManager("VCXContextManager")){l.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(true)}for(var n=0;n<l._timelines.length;n++){l._timelines[n].timeline.playGUIMode()}l.updateTimelineFromModel()});this._VCX_Timeline_MODEL_PAUSE_PLAY=d.subscribe({event:"VCX_PAUSE_PLAY"},function(o){if(l.options.experienceBase.getManager("VCXContextManager")){l.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(true)}for(var n=0;n<l._timelines.length;n++){l._timelines[n].timeline.playGUIMode()}});this._VCX_Timeline_MODEL_START_PLAY=d.subscribe({event:"VCX_START_PLAY"},function(o){if(l.options.experienceBase.getManager("VCXContextManager")){l.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(false)}for(var n=0;n<l._timelines.length;n++){l._timelines[n].timeline.pauseGUIMode()}});this._VCX_SCENARIO_END_REACHED=d.subscribe({event:"VCX_SCENARIO_END_REACHED"},function(){l.onScenarioEnd()});this._VCX_GOTO_MARKER=d.subscribe({event:"VCX_GOTO_MARKER"},function(n){l.goToMarker(n)});this._VCX_KEYS_CHANGED=d.subscribe({event:"VCX_KEYS_CHANGED"},function(p){if(l._nodeClass===null||p===null){return}var n=[];for(var o in p.setModifiablesTrackModified){n.push(o)}l._updateListOfMarkers("update",n,p.keysForDo)});this._VCX_TIMEPOS_CHANGED=d.subscribe({event:"VCX_TIMEPOS_CHANGED"},function(n){l.updateTimelineFromModel()})},RemoveTimelineEvents:function(){this._parent();d.unsubscribe(this._VCX_SCENARIO_END_REACHED);d.unsubscribe(this._VCX_GOTO_MARKER);d.unsubscribe(this._VCX_KEYS_CHANGED);d.unsubscribe(this._VCX_TIMEPOS_CHANGED);d.unsubscribe(this._VCX_Timeline_MODEL_START_PLAY);d.unsubscribe(this._VCX_Timeline_MODEL_PAUSE_PLAY);d.unsubscribe(this._VCX_Timeline_MODEL_STOP_PLAY);this._VCX_SCENARIO_END_REACHED=0;this._VCX_GOTO_MARKER=0;this._VCX_KEYS_CHANGED=0;this._VCX_TIMEPOS_CHANGED=0;this._VCX_Timeline_MODEL_START_PLAY=0;this._VCX_Timeline_MODEL_PAUSE_PLAY=0;this._VCX_Timeline_MODEL_STOP_PLAY=0},onScenarioEnd:function(){var l=this;if(l.options.experienceBase.getManager("VCXContextManager")){l.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(true)}l.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(false);for(var m=0;m<l._timelines.length;m++){l._timelines[m].timeline.playGUIMode()}},actionOnKey:function(n,q,r,s,o,u,t,m){var l=this.getModifiableFromHashing(r);this._parent(n,q,l,s,o,u,t);var p=false;if(m===undefined){p=true;m=new c(this.options.experienceBase.getManager("VCXScenarioManager"))}if(n=="move"){m.MoveKey(q,l,s,o,u)}else{if(n=="copy"){m.ChangeKey(q,l,s,u,key.GetValue())}else{if(n=="delete"){m.ChangeKey(q,l,s,o,null)}}}if(p){this.options.experienceBase.getManager("VCXCommandManager").Push(m)}},ChangeTimePos:function(n,l){this._parent(n,l);if(this.options.experienceBase.odt==="record"){if(this.getFrameFromModel()!==n){this.options.experienceBase.getManager("VCXODTManager").LogAPI("VCXChangeTimePos",n)}}var m=new e(this.options.experienceBase.getManager("VCXScenarioManager"));var p=undefined;var o=undefined;if(typeof n.from!=="undefined"){p=n.from;o=n.to}else{if(typeof n==="number"){o=n}}m.ChangeTimePos(o,p);this.options.experienceBase.getManager("VCXCommandManager").Push(m)},onTimelineGoToMarker:function(n){this._parent(n);var l=this;var o=l.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();if(o){if(l.options.experienceBase.getManager("VCXContextManager")){l.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(true)}l.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(false)}var m=new b(l.options.experienceBase.getManager("VCXScenarioManager"),l.options.experienceBase.getManager("VCXCommandManager"),l.getComponentsMap());m.GoToMarker(n.id);l.options.experienceBase.getManager("VCXCommandManager").Push(m)},goToMarker:function(m){this._parent();var l=this;l.options.experienceBase.getManager("VCXScenarioManager").SetCurrentFrame(m);l.updateTimelineFromModel()},onTimelineNextMarker:function(){this._parent();var l=this;var n=l.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();if(n){if(l.options.experienceBase.getManager("VCXContextManager")){l.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(true)}l.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(false)}var m=new b(l.options.experienceBase.getManager("VCXScenarioManager"),l.options.experienceBase.getManager("VCXCommandManager"),l.getComponentsMap());m.GoToNextMarker();l.options.experienceBase.getManager("VCXCommandManager").Push(m)},OnTimelinePreviousMarker:function(){this._parent();var l=this;var n=l.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();if(n){if(l.options.experienceBase.getManager("VCXContextManager")){l.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(true)}l.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(false)}var m=new b(l.options.experienceBase.getManager("VCXScenarioManager"),l.options.experienceBase.getManager("VCXCommandManager"),l.getComponentsMap());m.GoToPreviousMarker();l.options.experienceBase.getManager("VCXCommandManager").Push(m)},onTimelineCamera:function(o){this._parent(o);var l=this;var m=null;var p=l.options.experienceBase.getManager("VCXContextManager");if(p){m=p.getContext()}var n=a.getCommandCheckHeader("VCXCameraPlayModeCmd",m);if(n){n.setState(o)}l.updateTimelineFromModel()},onTimePosChangeStart:function(){this._parent()},onTimePosChangeWhile:function(l){if(this._startChangeTime){this.options.experienceBase.getManager("VCXCommandManager").StartTransaction()}this._parent(l);this._startChangeTime=false},onTimePosChangeEnd:function(l){this._parent(l);this._startChangeTime=true;if(this._startChangeTime){this.options.experienceBase.getManager("VCXCommandManager").EndTransaction()}},onStartPlay:function(){var l=this;var m=l.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();if(m){return}var m=l.options.experienceBase.getManager("VCXAPIManager").PlayAnimation()},onStopPlay:function(){var l=this;if(l.options.experienceBase.getManager("VCXContextManager")){l.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(true)}l.ChangeTimePos(0,false);l.options.experienceBase.getManager("VCXScenarioManager").SetIsBouncing(false);l.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(false);d.publish({event:"VCX_STOP_PLAY"});l.updateTimelineFromModel();l._parent()},onPausePlay:function(){var l=this;var m=l.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();if(m){if(l.options.experienceBase.getManager("VCXContextManager")){l.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(true)}l.options.experienceBase.getManager("VCXAPIManager").PauseAnimation()}l._parent()},setPropertyOnScenario:function(q,p){var r=this.options.experienceBase.getManager("VCXScenarioManager");var n=this.getScenarioM(r.GetCurrentScenario()).QueryInterface("VCXIModifiable");var o=new k(r,this.options.experienceBase.getManager("VCXCommandManager"));var s=n.GetProperty(q);var m=null;m=s.Clone();var l=m.GetPropertyValue();l.SetValue(p);m.SetPropertyValue(l);o.ChangeProperty(n,m);this.options.experienceBase.getManager("VCXCommandManager").Push(o)},setScenarioAnimationLoop:function(l){this.setPropertyOnScenario("Scenario.bIsLoop",l)},setScenarioAnimationBounce:function(l){this.setPropertyOnScenario("Scenario.bIsBounce",l)},setScenarioAnimationReverse:function(l){this.setPropertyOnScenario("Scenario.bIsReverse",l)},onTimelineStepForward:function(){this._parent();var l=this;var n=l.getFrameFromModel();if(n>l.options.maxFrame){if(l.options.experienceBase.getManager("VCXContextManager")){l.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(true)}l.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(false);for(var m=0;m<l._timelines.length;m++){l._timelines[m].timeline.playGUIMode()}return}var o=l.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();if(o){if(l.options.experienceBase.getManager("VCXContextManager")){l.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(true)}l.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(false)}n++;l.ChangeTimePos(n,true);l.updateTimelineFromModel()},onTimelineStepBackward:function(){this._parent();var l=this;var m=l.getFrameFromModel();if(m==0){return}var n=l.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();if(n){if(l.options.experienceBase.getManager("VCXContextManager")){l.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(true)}l.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(false)}m--;l.ChangeTimePos(m,true);l.updateTimelineFromModel()},getFrameFromModel:function(){var l=this.options.experienceBase.getManager("VCXScenarioManager");return l.GetCurrentFrame()},getSelection:function(){if(!this._isFilterOnSelectionMode){return[]}return this.getCurrentSelection()},getCurrentSelection:function(){return this.options.experienceBase.getManager("VCXSelectionManager").GetCurrentSelection()},getScenarioM:function(l){return this.options.experienceBase.getManager("VCXScenarioManager")._Scenarios[l]},getComponentsMap:function(){return this.options.experienceBase.ComponentsMap},getModifiableFromHashing:function(l){return this.options.experienceBase.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(l)},getTrackModelFromTrackNode:function(l){},convertTrackNameToDisplayName:function(m,n){var o=this.convertTrackToId(m,n);var l="";switch(o){case 0:l="Position";break;case 4:l="Properties";break;case 2:l="Opacity";break;case 1:l="Materials";break;case 5:l="Links";break;case 8:l="Others";break;case 6:l="Viewport";break;case 3:l="Camera";break;case 7:l="Digger";break;default:l="unknown"}return l},removeTrackFromModel:function(v,u,x){var n=new c(this.options.experienceBase.getManager("VCXScenarioManager"));var s=this.getScenarioM(this.options.scenarioID);var t=this.options.experienceBase.getManager("VCXScenarioManager").ModifiableServer;for(var p=0;p<v.length;p++){var w=v[p].getParent().options._hash;var y=t.GetModifiableFromHashing(w);var o=v[p].getChildren()||[];for(var r=0;r<o.length;r++){var l=o[r];var q=l.options.strPropertyName;var m=l.options.key._frame;n.ChangeKey(s,y,q,m,null)}}this.options.experienceBase.getManager("VCXCommandManager").Push(n)},removeTrackFromModelFlatten:function(F,s,n){var G=new c(this.options.experienceBase.getManager("VCXScenarioManager"));var C=this.getScenarioM(this.options.scenarioID);var o=this.options.experienceBase.getManager("VCXScenarioManager").ModifiableServer;var m=[];this.modifiables=this.getSelection();if(this.modifiables.length!==0){this.modifiables.forEach(function(N){var M=N.GetObject().GetID();if(M){m.push(M)}else{console.log("VCXTimelineExtCtrl: hashing is empty !")}})}var t=[];if(m&&m.length!==0){var D=m.length;for(var J=0;J<D;J++){var v=this.getComponentsMap();var I=m[J];var w=v.GetComponentFromID(I);if(w){var E=w.QueryInterface("VCXIModifiable");var r=E.GetHashing();t.push(r)}else{console.log("component not found here !")}}}else{if(!this.getFilterOnSelectionMode()){C.GetListModifiables(t)}}var l=t.length;this.flattenKeysArray=[];for(var A=0;A<l;A++){var y=t[A];var E=o.GetModifiableFromHashing(y);var u=C.GetObjectAnimation(y);var q=[];u.GetListTrackNames(q);for(var K=0;K<q.length;K++){var p=this.convertTrackNameToDisplayName(q[K],E.GetObject().GetType());if(p===F.options.label){var B=u.GetTrack(q[K]);if(B){var z=B._treekeys;var H=new f(z);var L=H.next();while(L!==null){var x=L.GetFrame();if(s&&n&&(x<s||x>n)){L=H.next();continue}G.ChangeKey(C,E,q[K],x,null);L=H.next()}}}}}this.options.experienceBase.getManager("VCXCommandManager").Push(G)},generateListOfMarkers:function(m,u,n,N){if(m===undefined){m="Add"}var J=this;var T=[];var R=false;var o=[];if(u===undefined){this.modifiables=this.getSelection()}if(this.modifiables.length!==0){this.modifiables.forEach(function(V){var U=V.GetObject().GetID();if(U){o.push(U)}else{console.log("VCXTimelineExtCtrl: hashing is empty !")}})}if(this.options.scenarioID){}else{if(R){return}}var G=this.getScenarioM(J.options.scenarioID);var r=0;if(G){if(u===undefined){u=[];if(o&&o.length!==0&&R===false){var H=o.length;for(var O=0;O<H;O++){var w=this.getComponentsMap();var M=o[O];var y=w.GetComponentFromID(M);if(y){var I=y.QueryInterface("VCXIModifiable");var t=I.GetHashing();u.push(t)}else{console.log("component not found here !")}}}else{if(!this.getFilterOnSelectionMode()){G.GetListModifiables(u)}}}var l=u.length;this.flattenKeysArray=[];for(var E=0;E<l;E++){var A=u[E];var v=G.GetObjectAnimation(A);var x=null;var I=this.getModifiableFromHashing(A);if(I){x=I.GetObject().GetID()}if(v&&x){var q=[];v.GetListTrackNames(q);var L=null;var p=-1;var s=-1;for(var P=0;P<q.length;P++){L="#cccccc";var Q=q[P];var F=v.GetTrack(Q);if(F){var D="";if(this.options.flattenKeys===true){D=this.convertTrackToId(Q,I.GetObject().GetType())}else{D=E}var C=F._treekeys;var K=new f(C);var S=K.next();while(S!==null){var z=S.GetFrame();s=z;p=D;if(D===1&&this.options.flattenKeys===true&&S&&S.GetValue()&&S.GetValue()&&S.GetValue().Clone()._value.GetColorHexString){L="#"+S.GetValue().Clone()._value.GetColorHexString()}var B=null;if(B){}else{B={length:1,keyColor:L,componentHash:A,strPropertyName:Q,data:S};if(this.options.flattenKeys===true){}J._addKey(z,1,B.keyColor,D,B.componentHash,B.strPropertyName,B.data,N)}S=K.next()}}}}}}return T},generateClientTreeTracks:function(p){var q=[];var r=this.getScenarioM(this.options.scenarioID);r.GetListModifiables(q);var m=0;var v=q.length;for(var t=0;t<v;t++){var s=q[t];var w=r.GetObjectAnimation(s);if(w){var y=this.getModifiableFromHashing(s);var u=this.getModifiableName(y);var n=this._createTrackNode(this._nodeClass,u,m,p._getTrueRoot());n._options._hash=s;m=1+n.options.id;var x=[];w.GetListTrackNames(x);for(var o=0;o<x.length;o++){var l=this._createTrackNode(this._nodeClass,x[o],m,n);m=1+l.options.id;l._options.preventDisplayChilds=true}}}},getTrackTreeListView:function(){for(var l=0;l<this._timelines.length;l++){var m=this._timelines[l].timeline.getTrackTreeListView();if(m){return m}}return null},getTimelineModel:function(){for(var l=0;l<this._timelines.length;l++){var m=this._timelines[l].timeline.getTimelineModel();if(m){return m}}return null},getModifiableName:function(o){var m=o&&o.GetProperty("Actor.Name");var l=m&&m.GetPropertyValue().GetValue();if(l===""){var n=o.GetHashing();l=n+" (no name)"}return l},onAddTracksKey:function(o){if(o.trackId===3){if(a.getCommand("VCXAddCameraKeyCmd",this.options.experienceBase.getManager("VCXContextManager").getContext())){a.getCommand("VCXAddCameraKeyCmd",this.options.experienceBase.getManager("VCXContextManager").getContext()).begin()}}else{this.modifiables=this.getCurrentSelection();if(o.trackId===6){var s=this.options.experienceBase.getManager("VCXContextManager").getActiveViewport();this.modifiables=[];this.modifiables.push(s.QueryInterface("VCXIModifiable"))}if(this.modifiables.length!==0){var u=new i();for(var p=0;p<this.modifiables.length;p++){var n=new h();var q=this.modifiables[p];var r=q.GetProperties();if(r){for(var l in r._map){if(this.convertTrackToId(l,q.GetObject().GetType())===o.trackId){n.AddOrModifyProperty(r.GetProperty(l).Clone())}}u.AddOrModifyPropertySet(q.GetHashing(),n)}}var t=true;var m=new k(this.options.experienceBase.getManager("VCXScenarioManager"),this.options.experienceBase.getManager("VCXCommandManager"),t);m.ChangePropertiesFromMap(u);this.options.experienceBase.getManager("VCXCommandManager").Push(m)}}},onSelectionAreaMoveFlatten:function(p){this.getTimelineModel().lock++;var m=Math.round(p.timeInitStart*p.timeToFrame);var t=Math.round(p.timeInitEnd*p.timeToFrame);var u=Math.round(p.timeFinalStart*p.timeToFrame);var l=Math.round(p.timeFinalEnd*p.timeToFrame);var o=t-m;var z=l-u;var n=new c(this.options.experienceBase.getManager("VCXScenarioManager"));var r={};r._options={};for(var w=0;w<p.tracks.length;w++){var s=p.tracks[w]._rowID||p.tracks[w]._localID+5;var y=this.flattenKeysArray[s];if(y){for(var v in y){if(v<m||v>t){continue}var q=v;var x=Math.round(u+((v-m)*z/o));this.actionsOnKeys(null,"move",null,q,x,p.scenarioID,s,n)}}}this.getTimelineModel().lock--;this.options.experienceBase.getManager("VCXCommandManager").Push(n)},});return g});define("DS/VCXWebGUI/VCXSidePanelExtendable",["UWA/Core","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/Panels/SidePanel"],function(e,a,c,d){var b=d.extend({defaultOptions:{className:"VCXSidePanelExtendable"},mItemList:[],dragWhileFactory:function(g){var f=function(j){var h=g;var i=j.clientX;j.preventDefault();h.elements.panel.style.transition="";if(h.options.side==="left"){h.elements.panel.style.width=i-h.marginX+"px"}else{h.elements.panel.style.width=h.screenX-i-h.marginX+"px"}if(h.options.usecallback){h.options.usecallback(h.options.controller,Math.max(parseInt(h.elements.panel.style.minWidth),parseInt(h.elements.panel.style.width)))}if(h.options.controller&&typeof(h.options.controller.updateToolbar)=="function"){h.options.controller.updateToolbar()}};return f},dragEndFactory:function(g){var f=function(){var h=g;document.removeEventListener(c.POINTERMOVE,h._fctWhile,false);document.removeEventListener(c.POINTERUP,h._fctEnd,false);h._isDragged=false;h.elements.panel.style.boxShadow="0px 0px 0px 0px #888888";h.elements.panel.style.transition=h._savedTransition;h._bLockRecord=false;if(h.options.controller&&h.options.controller._vcxGuiManager){h.options.controller._vcxGuiManager.updateUsableArea()}};return f},addPointerEvents:function(){var f=this;f._leftSensor.addEvent(c.POINTERDOWN,function(h){f.screenX=document.body.clientWidth;var g=h.clientX;var i=f.elements.panel.getBoundingClientRect().width;if(f.options.side==="left"){f.marginX=g-i}else{f.marginX=f.screenX-g-i}if(f._bLockRecord){document.removeEventListener(c.POINTERMOVE,f._fctWhile,false);document.removeEventListener(c.POINTERUP,f._fctEnd,false);f._isDragged=false;f._bLockRecord=false}document.addEventListener(c.POINTERMOVE,f._fctWhile);document.addEventListener(c.POINTERUP,f._fctEnd);f._bLockRecord=true;f._isDragged=true;f.elements.panel.style.transition=""})},getvalueCSS:function(i,g){var h=null,f=i,j=null;if(window.getComputedStyle){if(f.ownerDocument.defaultView.opener){j=f.ownerDocument.defaultView.getComputedStyle(f,null)}else{j=window.getComputedStyle(f,null)}h=j.getPropertyValue(g)}else{if(document.documentElement.currentStyle){j=f.currentStyle;if(typeof j.getPropertyValue!="undefined"){h=j.getPropertyValue(g)}else{h=j[g]}}}return h},init:function(f){var i=this;i._parent(f);i._bLockRecord=false;i._fctWhile=i.dragWhileFactory(i);i._fctEnd=i.dragEndFactory(i);var h=f.title;i.elements.title.innerHTML="";i.elements.title.addClassName("vcx-panels-panelbase-title");i.elements.panel.addClassName("vcx-panels-panelbase-panel");i.elements.panel.addClassName(f["class"]);var g=i.getvalueCSS(i.elements.panel,"z-index");i._leftSensor=new e.Element("div",{"class":"SidePanelExtendableSensor",styles:{height:"100%",left:"-11px",width:"12px",position:"absolute",cursor:"col-resize",zIndex:g+1,},events:{mouseover:function(){if(i.options.side==="left"){i.elements.panel.style.boxShadow="2px -2px 2px 0px #D3D3D3"}else{i.elements.panel.style.boxShadow="-2px -2px 2px 0px #D3D3D3"}i.elements.panel.style.transition=""},mouseout:function(){if(i._isDragged===false){i.elements.panel.style.boxShadow="0px 0px 0px 0px #888888";i.elements.panel.style.transition=i._savedTransition}},}});if(i.options.side==="left"){i._leftSensor.style.right=i._leftSensor.style.left;i._leftSensor.style.left=""}i._isDragged=false;i._savedTransition=this.elements.panel.style.transition;i.elements.panel.insertBefore(i._leftSensor,i.elements.panel.firstChild);i.addPointerEvents()},slideIn:function(){this._parent();var f=parseFloat(this.elements.panel.style.transitionDuration);setTimeout(function(){a.publish({event:"VCX_GUI_PANEL_SLIDE_IN",})},f*1000)},slideOut:function(){this._parent();var f=parseFloat(this.elements.panel.style.transitionDuration);setTimeout(function(){a.publish({event:"VCX_GUI_PANEL_SLIDE_OUT",})},f*1000)},});return b});define("DS/VCXWebGUI/VCXHyperlinkBoxing",["UWA/Class","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueHyperlinkId","DS/WebRBTree/WebRBIterator"],function(c,h,f,e,b,i,a,d,g){var j=c.extend({initialize:function(k){this._experienceBase=k},unInitialize:function(k){this._experienceBase=null},HyperlinkPropertyToString:function(l){var n="";if(l){var k=this._experienceBase.getManager("VCXDocManager").GetPropPath(l.GetValue());if(k){var m=k.GetFileName().GetValue();if(m){return m}n=k.GetValueURL().GetValue()}}return n},FillMapChoiceScenarios:function(q,p){var l=null;var n=Object.keys(q).length;var o=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);for(var m in o){if(o.hasOwnProperty(m)){var k=o[m].GetName();q[n]=k;if(m===p){l=n}n++}}return l},FillMapChoiceMarkers:function(m,v){var o=null;var r=Object.keys(m).length;var k=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);for(var t in k){if(k.hasOwnProperty(t)){var n=k[t].GetTrackMarkers();if(n){var r=0;var w=n._treekeys;var s=new g(w);var u=s.next();while(u!==null){var q=u.GetValue();var p=this._experienceBase.ComponentsMap.GetComponentFromID(q);var l=p.GetName();m[r]=l;if(q===v){o=r}r++;u=s.next()}}}}return o},HyperlinkPropertyForGUI:function(D){var G={propertyAction:null,propertyType:null,propertyHyperlink:null};var q=new f("Actor.Hyperlink_Action",null,false,"VCXWebModifiables/VCXWebModifiables");var k=new a();k.SetValue(false);G.propertyAction=new h(q,k);var C=new b();C.SetValue(1);var l=new e("Actor.Hyperlink_Type",null,false,"VCXWebModifiables/VCXWebModifiables");var F={1:"Web Address",2:"Ftp",3:"Go to scenario",4:"Play scenario",5:"Go to marker",6:"Play marker sequence"};l.SetMapChoiceEnum(F);G.propertyType=new h(l,C);var s=new e("Actor.Hyperlink_Hyperlink",null,false,"VCXWebModifiables/VCXWebModifiables");var t=new i();t.SetValue("http://www.3ds.com");G.propertyHyperlink=new h(s,t);var n=null;if(D){n=this._experienceBase.getManager("VCXDocManager").GetPropPath(D.GetValue())}if(n){}else{l.SetVisible(false);s.SetVisible(false);return G}var E="";var v=n.GetPathType().GetValue();if(v===0){E=this.HyperlinkPropertyToString(D);if(E.indexOf("scenario://")>=0){v=1;E=E.slice(11)}else{if(E.indexOf("http")>=0){C.SetValue(1)}else{if(E.indexOf("ftp")>=0){C.SetValue(2)}else{C.SetValue(0)}}var t=new i();t.SetValue(E);G.propertyHyperlink.SetPropertyValue(t)}}var p=false;var u={};var A=new b();var y=n.GetValueLink().GetValue();if(v===1){C.SetValue(3);var x=["Previous","Next","First","Last"];var z=false;for(var B=0;B<x.length;B++){var r=x[B]+" scenario";u[B.toString()]=r;if(E===x[B].toLowerCase()){A.SetValue(B);z=true}}var o=this.FillMapChoiceScenarios(u,y);if(z){}else{if(o!==null){A.SetValue(o)}}p=true}else{if(v===2){C.SetValue(4);var w=this.FillMapChoiceMarkers(u,y);var m=this.FillMapChoiceScenarios(u,y);if(w!==null){A.SetValue(w)}else{if(m!==null){A.SetValue(m)}}p=true}else{if(v===3){C.SetValue(5);var o=this.FillMapChoiceMarkers(u,y);if(o!==null){A.SetValue(o)}p=true}else{if(v===4){C.SetValue(6);var w=this.FillMapChoiceMarkers(u,y);var m=this.FillMapChoiceScenarios(u,y);if(w!==null){A.SetValue(w)}else{if(m!==null){A.SetValue(m)}}p=true}}}}if(p){s.SetMapChoiceEnum(u);G.propertyHyperlink.SetPropertyValue(A)}k.SetValue(true);return G},UpdateMapForGUI:function(l,m){var r=m.propName;var p=m.std;var z=m.typePath;if(r==="Actor.Hyperlink_Action"){var B=l.propertyAction;B.GetPropertyValue().SetValue(p);l.propertyHyperlink.GetPropertyInfo().SetVisible(p);l.propertyType.GetPropertyInfo().SetVisible(p)}else{if(r==="Actor.Hyperlink_Type"){var u=l.propertyType;var A=u.GetPropertyInfo().GetMapChoiceEnum();for(var k in A){if(A.hasOwnProperty(k)){var v=A[k];if(p===v){u.GetPropertyValue().SetValue(parseInt(k));break}}}var x=null;if(p==="Web Address"){var x=new i("http://www.3ds.com")}else{if(p==="Ftp"){var x=new i()}else{var o=l.propertyHyperlink.GetPropertyInfo();var q={};switch(p){case"Go to scenario":var t=["Previous","Next","First","Last"];for(var w=0;w<t.length;w++){var n=t[w]+" scenario";q[w.toString()]=n}this.FillMapChoiceScenarios(q);break;case"Play scenario":this.FillMapChoiceScenarios(q);this.FillMapChoiceMarkers(q);break;case"Go to marker":this.FillMapChoiceMarkers(q);break;case"Play marker sequence":this.FillMapChoiceMarkers(q);this.FillMapChoiceScenarios(q);break;default:break}o.SetMapChoiceEnum(q);var x=new b(0)}}l.propertyHyperlink.SetPropertyValue(x)}else{if(r==="Actor.Hyperlink_Hyperlink"){var y=l.propertyHyperlink;if(z==="editor"){y.GetPropertyValue().SetValue(p)}else{var s=y.GetPropertyInfo().GetMapChoiceEnum();for(var k in s){if(s.hasOwnProperty(k)){var v=s[k];if(p===v){y.GetPropertyValue().SetValue(parseInt(k));break}}}}}}}return l},BuildPropPathFromScenario:function(n,p){var o=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);for(var m in o){if(o.hasOwnProperty(m)){var k=o[m].QueryInterface("VCXIModifiable").GetProperty("Actor.Name").GetPropertyValue().GetValue();if(k===n){var l=this._experienceBase.getManager("VCXDocManager").BuildPathFromLink(m,p);return l}}}},BuildPropPathFromMarker:function(n,q){var k=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);for(var s in k){if(k.hasOwnProperty(s)){var m=k[s].GetTrackMarkers();if(m){var r=0;var w=m._treekeys;var t=new g(w);var u=t.next();while(u!==null){var v=u.GetValue();var o=this._experienceBase.ComponentsMap.GetComponentFromID(v);var l=o.GetName();if(l===n){var p=this._experienceBase.getManager("VCXDocManager").BuildPathFromLink(v,q);return p}u=t.next()}}}}},BuildNewValueForGUI:function(m){var q=new d();var t=m.propertyAction.GetPropertyValue();if(t.GetValue()){var r=null;var u=m.propertyHyperlink;var w=m.propertyType.GetPropertyInfo().GetMapChoiceEnum();var n=m.propertyType.GetPropertyValue().GetValue();if(w[n]==="Open Document"){}else{if(w[n]==="Web Address"){r=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(u.GetPropertyValue().GetValue())}else{if(w[n]==="Ftp"){r=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(u.GetPropertyValue().GetValue())}else{var k=u.GetPropertyInfo().GetMapChoiceEnum();var p=u.GetPropertyValue().GetValue();var o=k[p];switch(w[n]){case"Go to scenario":r=this.BuildPropPathFromScenario(o);if(!r){var v=o.split(" ");var l="scenario://"+v[0].toLowerCase();r=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(l)}break;case"Play scenario":var s=2;r=this.BuildPropPathFromScenario(o,s);if(r){}else{r=this.BuildPropPathFromMarker(o,s)}break;case"Go to marker":var s=3;r=this.BuildPropPathFromMarker(o,s);break;case"Play marker sequence":var s=4;r=this.BuildPropPathFromMarker(o,s);if(r){}else{r=this.BuildPropPathFromScenario(o,s)}break;default:break}}}}if(r){q=this._experienceBase.getManager("VCXDocManager").AddOrModifyHyperlink(r)}}else{q.SetValue(-1)}return q}});return j});define("DS/VCXWebGUI/VCXPaperCtrl",["UWA/Class","DS/CoreEvents/Events","UWA/Element","DS/Core/PointerEvents","DS/Controls/Timeline","DS/RuntimeView/RSCManager"],function(c,e,b,d,f,g){var a=c.extend({init:function(h){var l=this;l._vcxGuiManager=h;l._experience=null;l._touchCompliant=l._vcxGuiManager.isTouchActivated();l._zoomFactorButtons=l._touchCompliant?2:1;l._paneHeight=l._touchCompliant?50:42;l._timeoutStartHideAnimation=2000;l._speedDisplayAnimation=200;l._speedHideAnimation=700;l._iconPaperExpander="";l._iconPaperExpanderOver="";l._iconPaperBackgroundOver="rgb(231, 241, 248)";l._animateUI={};l._zoomChangedToken=null;l._panChangedToken=null;var m=l._vcxGuiManager._vcxexperience.getManager("VCXContextManager").getActionBar();var p=l._vcxGuiManager._vcxexperience.getManager("VCXNLSManager");var n="VCXWebGUI/VCXWebGUI";var i=p.GetNLS([n]);l._actionBar_sectionChangeToken=m._modelEvents.subscribe({event:"EVT_SECTION_CHANGE"},function(){l.CheckSize(m,l.mainPanel)});l._actionBar_openToken=m._modelEvents.subscribe({event:"ACTIONBAR_OPEN"},function(){l.CheckSize(m,l.mainPanel)});l._actionBar_closeToken=m._modelEvents.subscribe({event:"ACTIONBAR_CLOSE"},function(){l.CheckSize(m,l.mainPanel)});l.mainPanel=new UWA.Element("div",{html:"","class":"VCXPaperCtrl",styles:{width:45*5+135+20,height:l._paneHeight,},events:{touchstart:function(){l.mainPanel.addClassName("hover")},touchend:function(){l.mainPanel.removeClassName("hover")},},}).inject(this._vcxGuiManager._uiLayer);var o="VCX_UI_Paper_Ctrl_Up";var j="VCX_UI_Paper_Ctrl_Bottom";if(document.querySelector('div[data-type="ui-frame-2d"]').style.bottom==="0px"){o+="_3DPlay";j+="_3DPlay"}l.mainPanel._styleUp=o;l.mainPanel._styleBottom=j;var k="";if(i){k=i.getTitle({key:"PaperCtrl.DisplayPaperButton",})}this.buttonShowPaper=new UWA.Element("div",{html:"","class":"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-discovery-project wux-ui-3ds-lg wux-afr-cmdstarter",title:k,events:{click:function(){var q=!(l._experience.getManager("VCXPaperManager").getPaperVisibility());l._experience.getManager("VCXPaperManager").setPaperVisibility(q);q?l.buttonShowPaper.addClassName("wux-ui-state-active"):l.buttonShowPaper.removeClassName("wux-ui-state-active")},mouseover:function(){this.style.backgroundColor=l._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""},}}).inject(l.mainPanel);if(l._vcxGuiManager._vcxexperience.getManager("VCXPaperManager")._autoFit){l.buttonShowPaper.addClassName("wux-ui-state-active")}l.buttonShowPaper.addEvent(d.POINTERDOWN,function(){this.style.backgroundColor=l._iconPaperBackgroundOver});l.buttonShowPaper.addEvent(d.POINTERUP,function(){this.style.backgroundColor=""});k="";if(i){k=i.getTitle({key:"PaperCtrl.FitPaperButton",})}this.buttonZoomFit=new UWA.Element("div",{html:"","class":"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-arrow-double-combo wux-ui-3ds-lg wux-afr-cmdstarter",title:k,events:{click:function(){var q=l._experience.getManager("VCXPaperManager").ToggleAutoFit();q?l.buttonZoomFit.addClassName("wux-ui-state-active"):l.buttonZoomFit.removeClassName("wux-ui-state-active");l._vcxGuiManager.updateUsableArea()},mouseover:function(){this.style.backgroundColor=l._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""},}}).inject(l.mainPanel);if(l._vcxGuiManager._vcxexperience.getManager("VCXPaperManager")._autoFit){l.buttonZoomFit.addClassName("wux-ui-state-active")}l.buttonZoomFit.addEvent(d.POINTERDOWN,function(){this.style.backgroundColor=l._iconPaperBackgroundOver});l.buttonZoomFit.addEvent(d.POINTERUP,function(){this.style.backgroundColor=""});k="";if(i){k=i.getTitle({key:"PaperCtrl.PanPaperButton",})}if(false){l.buttonPan=new UWA.Element("div",{html:"","class":"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-zoom-fit wux-ui-3ds-lg wux-afr-cmdstarter",title:k,events:{click:function(){if(l._experience.getManager("VCXPaperManager").ToggleTouchControl()){l.buttonPan.addClassName("wux-ui-state-active")}else{l.buttonPan.removeClassName("wux-ui-state-active")}},mouseover:function(){this.style.backgroundColor=l._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""},}}).inject(l.mainPanel);if(l._vcxGuiManager._vcxexperience.getManager("VCXPaperManager")._autoFit){l.buttonPan.addClassName("wux-ui-state-active")}l.buttonPan.addEvent(d.POINTERDOWN,function(){this.style.backgroundColor=l._iconPaperBackgroundOver});l.buttonPan.addEvent(d.POINTERUP,function(){this.style.backgroundColor=""})}k="";if(i){k=i.getTitle({key:"PaperCtrl.ZoomMinusButton",})}l.buttonZoomMinus=l.createButton("wux-ui-3ds wux-ui-3ds-minus","url("+l._iconPaperZoomMinus+")",k);l.buttonZoomMinus.inject(l.mainPanel);l.AddEvents(l.buttonZoomMinus,"Minus",l,-1);k="";if(i){k=i.getTitle({key:"PaperCtrl.ZoomPlusButton",})}l.buttonZoomPlus=l.createButton("wux-ui-3ds wux-ui-3ds-plus","url("+l._iconPaperZoomPlus+")",k);l.buttonZoomPlus.inject(l.mainPanel);l.AddEvents(l.buttonZoomPlus,"Plus",l,1);this._timelineDiv=new UWA.Element("div",{html:"","class":"VCXPaperCtrlTimelineDiv",styles:{},}).inject(l.mainPanel);this._timeline=new f({minValue:0,maxValue:100,value:50,dynamicGraduations:false,dynamicGaugeColor:false,graduationsLabel:false,graduations:0,eventsList:[{label:"100",value:100,onEvent:function(){}}],activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"});this._timeline.elements.container.style.margin="initial";this._timeline.inject(l._timelineDiv);this._buttonExpander=new UWA.Element("div",{html:"","class":"VCXPaperCtrlTimelineArrow",styles:{backgroundImage:"url("+l._iconPaperExpander+")",},}).inject(l.mainPanel);document.querySelectorAll(".wux-Gauge-scale",".VCXPaperCtrlTimelineDiv")[0].style.opacity=0;this.UpdatePercentage(this);this._timeline.addEvent("change",function(){l.UpdatePercentage(l,0)});if(window.attachEvent){this._onresizeToken=window.attachEvent("onresize",function(){l.CheckSize(m,l.mainPanel)})}else{if(window.addEventListener){this._onresizeToken=this.checksizeFct.bind(this);window.addEventListener("resize",this._onresizeToken,true)}}g.onResourceLoaded({resourceFile:"VCXWebAuthoringApp/VCXWebAuthoringApp"},function(){l._iconPaperExpander=this.getIcon({key:"VCXPaperExpander",size:"Normal"});l._buttonExpander.style.backgroundImage="url("+l._iconPaperExpander+")";l._iconPaperExpanderOver=this.getIcon({key:"VCXPaperExpanderOver",size:"Normal"})});this._zoomChangedToken=e.subscribe({event:"/VCX/Paper/ZoomChanged",},function(q){if(q){q.autoFit?l.buttonZoomFit.addClassName("wux-ui-state-active"):l.buttonZoomFit.removeClassName("wux-ui-state-active")}if(q&&!q.updatePaper){l._lockupdatePaper=true}l.SetZoomFactor(q);l._lockupdatePaper=false});this._panChangedToken=e.subscribe({event:"/VCX/Paper/PanChanged",},function(q){if(q){q.autoFit?l.buttonZoomFit.addClassName("wux-ui-state-active"):l.buttonZoomFit.removeClassName("wux-ui-state-active")}})},checksizeFct:function(){var h=this._vcxGuiManager._vcxexperience.getManager("VCXContextManager").getActionBar();this.CheckSize(h,this.mainPanel)},unInitialize:function(){if(this._zoomChangedToken){e.unsubscribe(this._zoomChangedToken);this._zoomChangedToken=null}if(this._panChangedToken){e.unsubscribe(this._panChangedToken);this._panChangedToken=null}var h=this._vcxGuiManager._vcxexperience.getManager("VCXContextManager").getActionBar();if(h){if(this._actionBar_sectionChangeToken){h._modelEvents.unsubscribe(this._actionBar_sectionChangeToken)}if(this._actionBar_openToken){h._modelEvents.unsubscribe(this._actionBar_openToken);this._actionBar_openToken=null}if(this._actionBar_closeToken){h._modelEvents.unsubscribe(this._actionBar_closeToken);this._actionBar_closeToken=null}h=null}this.buttonZoomFit.removeEvent(d.POINTERDOWN);this.buttonZoomFit.removeEvent(d.POINTERUP);this.buttonShowPaper.removeEvent(d.POINTERDOWN);this.buttonShowPaper.removeEvent(d.POINTERUP);if(this.buttonPan){this.buttonPan.removeEvent(d.POINTERDOWN);this.buttonPan.removeEvent(d.POINTERUP)}this.RemoveEvents(this.buttonZoomMinus);this.RemoveEvents(this.buttonZoomPlus);this._timeline.removeEvent("change");if(window.attachEvent){window.detachEvent("onresize",this._onresizeToken)}else{if(window.addEventListener){window.removeEventListener("resize",this._onresizeToken,true)}}this._onresizeToken=null;if(this.mainPanel.parentNode){this.mainPanel.parentNode.removeChild(this.mainPanel)}this.mainPanel=null},createButton:function(h,k,i){var j=new UWA.Element("div",{html:"","class":h+" vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds-lg wux-afr-cmdstarter",title:i});return j},AddEvents:function(j,i,h,k){var l=this;j._useTouch=false;j.addEvent("touchstart",function(){j.style.backgroundColor=l._iconPaperBackgroundOver;j._useTouch=true;var m=j;m.delta=5*k;h.UpdateSlider(h,m.delta,false);m.delta+=5*k;m.waitPressTimer=window.setTimeout(function(){m.pressTimer=window.setInterval(function(){h.UpdateSlider(h,m.delta,false);m.delta+=5*k},100)},300);return false});j.addEvent("mouseover",function(){if(j._useTouch){return false}j.style.backgroundColor=l._iconPaperBackgroundOver});j.addEvent("mousemove",function(){});j.addEvent("mouseup",function(){if(j._useTouch===true){return false}window.clearTimeout(j.waitPressTimer);window.clearInterval(j.pressTimer);j.style.backgroundColor=""});j.addEvent("mousedown",function(){if(j._useTouch===true){return false}var m=j;m.delta=5*k;j.style.backgroundColor=l._iconPaperBackgroundOver;h.UpdateSlider(h,m.delta,false);m.waitPressTimer=window.setTimeout(function(){m.pressTimer=window.setInterval(function(){h.UpdateSlider(h,m.delta,false);m.delta+=5*k},100)},300);return false});j.addEvent("touchend",function(){window.clearTimeout(j.waitPressTimer);window.clearInterval(j.pressTimer);j.style.backgroundColor=""});j.addEvent("mouseout",function(){j._useTouch=false;window.clearTimeout(j.waitPressTimer);window.clearInterval(j.pressTimer);j.style.backgroundColor=""})},RemoveEvents:function(h){h.removeEvent("touchstart");h.removeEvent("mouseover");h.removeEvent("mousemove");h.removeEvent("mouseup");h.removeEvent("mousedown");h.removeEvent("touchend");h.removeEvent("mouseout")},UpdatePercentage:function(i){var h=i._timeline.getValue();var j=0;if(h<=49){j=(90/49)*h+10}else{if(h>=51){j=(300/50)*h-200}else{j=100}}i.zoomPaper=j/100;if(i._experience!==null&&!i._lockupdatePaper){i._experience.getManager("VCXPaperManager").Zoom=i.zoomPaper}i._timeline.elements.container.children[2].children[0].children[0].innerHTML=Math.floor(j)+" %"},UpdateSlider:function(i,l,j){var h=i._timeline.getValue();var k=0;if(h<=49){k=(90/49)*h+10}else{if(h>=51){k=(300/50)*h-200}else{k=100}}if(!j){k+=l}else{k=l}i.zoomPaper=k/100;if(k<=99){h=(k-10)/(90/49)}else{if(k>=101){h=(k+200)/(300/50)}else{h=50}}i._timeline.setValue(h)},CheckSize:function(j,l){var i=document.querySelectorAll("div.wux-ui-state-close");if(i.length!==1){var k=0;if(j.elements.sectionsBar){k=j.elements.sectionsBar.getDimensions().outerWidth+2*25}else{var h=j.elements.container.childNodes[0].childNodes[2];if(h){k=h.getBoundingClientRect().left}else{}}l.className="VCXPaperCtrl";if(k-parseInt(l.style.width)<0||(j._isShownWhenLarge==false&&j._isShownWhenSmall==false)){l.classList.add(l._styleUp)}else{l.classList.add(l._styleBottom)}}else{l.classList.add(l._styleBottom)}},SetZoomFactor:function(h){this.UpdateSlider(this,h.value*100,true)},updatePaperArea:function(h){this.mainPanel.style.left=h.left+"px"},});return a});(function(){if(typeof window.Event==="function"){return false}function a(c,d){d=d||{bubbles:false,cancelable:false,detail:undefined};var b=document.createEvent("CustomEvent");b.initCustomEvent(c,d.bubbles,d.cancelable,d.detail);return b}a.prototype=window.Event.prototype;window.Event=a})();define("DS/VCXWebGUI/VCXGUIManager",["DS/WebApplicationBase/W3AAManager","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Core/PointerEvents","DS/Controls/Tooltip","DS/Controls/TooltipModel","DS/WebappsUtils/WebappsUtils","DS/VCXWebGUI/VCXScenarioCtrlExt","DS/VCXWebGUI/VCXPaperCtrl","DS/VCXWebGUI/VCXPropertiesCtrlExt","DS/VCXWebGUI/VCXUndoRedoCtrl","DS/VCXWebGUI/VCXDocManagerCtrl","DS/VCXWebGUI/VCXLinkedPropCtrl","DS/VCXWebGUI/VCXStatsCtrl","DS/VCXWebTreeGUI/VCXWebTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebAssemblyTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebDressupTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebStylesTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebAssemblyTreeCtrl","DS/VCXWebTreeGUI/VCXWebSelectionSetsTreeCtrl","DS/VCXWebTreeGUI/VCXWebHotspotsTreeCtrl","DS/VCXWebTreeGUI/VCXWebDressupTreeCtrl","DS/VCXWebTreeGUI/VCXWebStylesTreeCtrl","DS/Windows/WindowManager","DS/ApplicationFrame/CommandsManager","DS/VCXWebGUI/VCXTimelineController","DS/VCXWebGUI/VCXGUIServices","DS/VCXWebGUI/VCXGettingStartedUI","DS/VCXWebKernelTools/VCXLogServices","DS/VCXWebModifiablesServices/VCXModifiablesAccess"],function(h,y,v,p,z,q,n,c,i,D,x,E,r,d,b,A,t,s,C,B,g,o,w,u,e,f,m,l,j,k){var a=h.extend({GetSelectedProperties:function(){if(this._vcxPropertiesCtrl){return this._vcxPropertiesCtrl.GetSelectedProperties()}},CopyProperties:function(F,G){this._copyProperties=F;this._copyModifiables=G},GetCopiedProperties:function(){var F={};F.properties=this._copyProperties;F.arrayMod=this._copyModifiables;return F},getUsableArea:function(){if(this._experienceBase.getManager("VCXContextManager").getDisplayPaper()===false){return this.GetCanvasView()}return document.getElementsByClassName("wux-windows-docking-element-free-zone wux-docking-element-bottom")[0]},updateUsableArea:function(){if(this._experienceBase.getManager("VCXContextManager").getDisplayPaper()===false){}var L=this.getUsableArea();var G=document.getElementsByClassName("wux-controls-abstract wux-windows-immersive-frame")[0];if(L===undefined||G===undefined){return}var K=G.getBoundingClientRect();var I={};var H=L.getBoundingClientRect();I.left=H.left-K.left;I.top=H.top-K.top;I.right=K.right-H.right;I.bottom=H.bottom;I.width=H.width;I.height=H.height;var J=5;I.left+=J;I.top+=J;I.right-=J;I.width-=2*J;I.bottom-=J;I.height-=2*J;var F=document.querySelector('div[data-type="action-bar"]');if(F&&this._experienceBase.getManager("VCXContextManager").getDisplayPaper()!==false){F.style.left=I.left+"px";F.style.right=I.right+"px"}if(this._vcxPaperCtrl){this._vcxPaperCtrl.updatePaperArea(I)}if(this._experienceBase.getManager("VCXContextManager").getUrlVars().optimViewportPaper){this.GetCanvasView().style.position="absolute";this.GetCanvasView().style.left=I.left+"px";this.GetCanvasView().style.right=I.right+"px";this.GetCanvasView().style.top=I.top+"px";this.GetCanvasView().style.bottom=I.bottom+"px";this.GetCanvasView().style.width=I.width+"px";this.GetCanvasView().style.height=I.height+"px"}y.publish({event:"VCX_GUI_USABLEAREA_UPDATE",data:I})},unInitialize:function(){this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXGUIManager.css");this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXUISequence.css");this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebTreeGUI/VCXWebTreeGUI.css");this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXWebSignature.css");var J=this._vcxexperience.getManager("VCXContextManager").getActionBar();if(this._ACTIONBAR_OPEN_timeout){clearTimeout(this._ACTIONBAR_OPEN_timeout);this._ACTIONBAR_OPEN_timeout=null}if(this._ACTIONBAR_CLOSE_timeout){clearTimeout(this._ACTIONBAR_CLOSE_timeout);this._ACTIONBAR_CLOSE_timeout=null}J._modelEvents.unsubscribe(this._ACTIONBAR_OPEN);J._modelEvents.unsubscribe(this._ACTIONBAR_CLOSE);this._ACTIONBAR_OPEN=0;this._ACTIONBAR_CLOSE=0;this.actionBarReady=false;if(this._frmWindow){var I=this._frmWindow._sceneGraphTree.tree._sidePanel;if(this._VCX_GUI_PANEL_SLIDE_IN&&I){I._modelEvents.unsubscribe(this._VCX_GUI_PANEL_SLIDE_IN)}if(this._VCX_GUI_PANEL_SLIDE_OUT&&I){I._modelEvents.unsubscribe(this._VCX_GUI_PANEL_SLIDE_OUT)}}this._VCX_GUI_PANEL_SLIDE_IN=0;this._VCX_GUI_PANEL_SLIDE_OUT=0;y.unsubscribe(this.event_VCX_BEGIN_TRANSITION);y.unsubscribe(this.event_VCX_END_TRANSITION);y.unsubscribe(this._evtPreHLRemoveToken);y.unsubscribe(this._evtPreHLAddToken);if(window.detachEvent){window.detachEvent("onresize",this._updateUsableAreaFct)}else{if(window.removeEventListener){window.removeEventListener("resize",this._updateUsableAreaFct,true)}}if(this.immersiveFrame){var K=this.immersiveFrame.dockingElements;for(var G=0;G<K.length;G++){var H=K[G];H.removeEventListener(p.POINTERUP,this._updateDockingAreaCB)}}this._frmWindow=null;this._uiLayer=null;this.immersiveFrame=null;this._isIE11=null;this._init=0;this._destroyed=0;if(this._vcxGettingStartedUI){this._vcxGettingStartedUI.unInitialize();this._vcxGettingStartedUI=null}if(this._vcxScenarioCtrl){this._vcxScenarioCtrl.unInitialize();this._vcxScenarioCtrl=null}this.unInitTreesTabFrames();if(this._vcxPaperCtrl){this._vcxPaperCtrl.unInitialize();this._vcxPaperCtrl=null}if(this._vcxPropertiesCtrl){this._vcxPropertiesCtrl.unInitialize();this._vcxPropertiesCtrl=null}if(this._vcxTimelineCtrl){this._vcxTimelineCtrl.unInitialize();this._vcxTimelineCtrl=null}this._forceDisplayTimeline=null;if(this._vcxUndoRedoCtrl&&this._vcxUndoRedoCtrl._mainPanel&&this._vcxUndoRedoCtrl._mainPanel.parentNode){this._vcxUndoRedoCtrl._mainPanel.parentNode.removeChild(this._vcxUndoRedoCtrl._mainPanel);this._vcxUndoRedoCtrl.unInitialize();this._vcxUndoRedoCtrl=null}if(this._vcxDocManagerCtrl&&this._vcxDocManagerCtrl._mainPanel&&this._vcxDocManagerCtrl._mainPanel.parentNode){this._vcxDocManagerCtrl._mainPanel.parentNode.removeChild(this._vcxDocManagerCtrl._mainPanel);this._vcxDocManagerCtrl.unInitialize();this._vcxDocManagerCtrl=null}if(this._vcxLinkedPropCtrl&&this._vcxLinkedPropCtrl._mainPanel&&this._vcxLinkedPropCtrl._mainPanel.parentNode){this._vcxLinkedPropCtrl._mainPanel.parentNode.removeChild(this._vcxLinkedPropCtrl._mainPanel);this._vcxLinkedPropCtrl.unInitialize();this._vcxLinkedPropCtrl=null}if(this._vcxSampleCtrl){this._vcxSampleCtrl.unInitialize();this._vcxSampleCtrl=null}if(this._usableArea&&this._usableArea.parentNode){this._usableArea.parentNode.removeChild(this._usableArea)}this._usableArea=null;this._modelEvent.publish({event:"unInitialize",data:{}});removeEventListener("keydown",this._onKeydownEvent);var F=document.querySelectorAll(".wux-controls-abstract.wux-windows-window.wux-windows-windowgroup");for(var G=0;G<F.length;G++){F[G].remove()}},initialize:function(){this._modelEvent=new v();this._forceDisplayTimeline=false;this._experienceBase.getManager("VCXContextManager").loadCssFile("VCXWebGUI/VCXGUIManager.css",1);this._experienceBase.getManager("VCXContextManager").loadCssFile("VCXWebGUI/VCXUISequence.css",1);this._experienceBase.getManager("VCXContextManager").loadCssFile("VCXWebTreeGUI/VCXWebTreeGUI.css",1);this._vcxDisplayScenarioImmersiveUI=false;this._vcxGettingStartedUI=this.getGettingStartedUI();if(this._vcxGettingStartedUI){var N=false;if(typeof widget!=="undefined"&&widget.isTstProvider||window.isTstProvider){N=true}this._vcxGettingStartedUI.initialize({tstProvider:N})}var H=this._experienceBase.getManager("VCXContextManager");var T=this._experienceBase.getManager("VCXNLSManager");this._vcxGettingStartedUI.setExperienceBase(this._experienceBase);if(typeof widget!=="undefined"){this._vcxGettingStartedUI.setParentNode(widget.body)}else{this._vcxGettingStartedUI.setParentNode(document.body)}var R=this._experienceBase.getManager("VCXContextManager").getPlayerMode();var K=this._experienceBase.getManager("VCXContextManager").getExperienceIn3DPlay()===true?true:false;var G=this._experienceBase.getManager("VCXContextManager").getCityMode();var O=this._experienceBase.getManager("VCXContextManager").getProdHighMode();var Q="";var S="";var P="";var F="I_VCX_SplashComposer"+Math.floor(Math.random()*(5-1+1)+1)+"_.png";var I=!G;var M=true;var L=false;if(T){var J=T.GetNLS(["VCXWebGUI/VCXWebGUI"]);P=J?J.getTitle({key:"VCXGettingStartedUI.CreateExperience"}):"CATNLS error";S=J?J.getTitle({key:"VCXGettingStartedUI.WelcomeMessageAuthoring"}):"CATNLS error"}if(R&&K){Q="url("+n.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Player_BackgroundLogo_In3DPlay.png")+")";S="";P="";F="I_VCX_Player_BackgroundLogo_In3DPlay.png";I=false;M=false}else{if(R){S=J?J.getTitle({key:"VCXGettingStartedUI.WelcomeMessagePlay"}):"CATNLS error";Q="url("+n.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Player_BackgroundLogo_CATIA.png")+")";I=false;P="Open an smg";L=true}else{if(O){if(this._experienceBase.getManager("VCXContextManager").getFileMode()){L=true}}else{if(G){Q="url("+n.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_City_BackgroundLogo_GEOVIA.png")+")";F="I_City_BackgroundLogo_ExperienceCity.jpg"}else{Q="url("+n.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_BackgroundLogo_3DEXCITE_XPC.png")+")"}}}}this._vcxGettingStartedUI.startExperiencePage(S,F,Q,P,I,M,L);this._firstLoad=true;this._publishRasterImageAdvancedDisplay=false;this._vcxSampleCtrl=null;this._isPlayingGoTo=0;this._isAnimationLoop=false;this._isCameraPlayMode=false;this._vcxScenarioCtrl=null;this._vcxWebAssemblyTreeCtrl=null;this._vcxWebDressupTreeCtrl=null;this._vcxWebStylesTreeCtrl=null;this._vcxPublishRasterImageCtrl=null;this._vcxPaperCtrl=null;this._vcxPropertiesCtrl=null;this._vcxUndoRedoCtrl=null;this._vcxDocManagerCtrl=null;this._vcxLinkedPropCtrl=null;this._frmWindow=null;this._uiLayer=null;this.immersiveFrame=null;this._backgroundDrop=null;this._backgroundDropText=null;this._dropZone=null;this._usableArea=null;this._touchAvailable=true;this._init=0},setPublishRasterImageAdvancedDisplay:function(F){this._publishRasterImageAdvancedDisplay=F;this._vcxPublishRasterImageCtrl.updateAdvancedDisplay()},getPublishRasterImageAdvancedDisplay:function(){return this._publishRasterImageAdvancedDisplay},onVCXActionBarReady:function(I){if(this.actionBarReady){return}this.actionBarReady=true;if(!this.actionBarMerged&&this._experienceBase.getManager("VCXContextManager").getUrlVars().debug!==undefined){this.actionBarMerged=true;I.loadModel({file:"VCXWebDebug.xml",module:"VCXWebDebug",merge:true,})}if(this._experienceBase.getManager("VCXContextManager").getUrlVars().XPlore==="0"){var F=document.getElementsByClassName("wux-afr-cmdstarter");for(var H in F){var J=F[H];if(J&&J.dataset&&J.dataset.command==="VCXExploreCmd"){J.style.display="none"}}}var G=document.createEvent("UIEvents");G.initUIEvent("resize",true,false,window,0);window.dispatchEvent(G);this.recordActionBarEvent()},recordActionBarEvent:function(){var I=this._vcxexperience.getManager("VCXContextManager").getActionBar();if(I){if(this._experienceBase.getManager("VCXContextManager").getPlayerMode()){I.close()}var H=parseFloat(I.elements.container.style.transitionDuration);var G=this;if(!this._ACTIONBAR_OPEN){this._ACTIONBAR_OPEN=I._modelEvents.subscribe({event:"ACTIONBAR_OPEN"},function F(){G._ACTIONBAR_OPEN_timeout=setTimeout(function(){G.updateUsableArea()},parseFloat(0.2)*1000)})}if(!this._ACTIONBAR_CLOSE){this._ACTIONBAR_CLOSE=I._modelEvents.subscribe({event:"ACTIONBAR_CLOSE"},function F(){G._ACTIONBAR_CLOSE_timeout=setTimeout(function(){G.updateUsableArea()},parseFloat(0.2)*1000)})}}},postInitialize:function(){var Y=this;this._vcxexperience=this._experienceBase;if(this._experienceBase.getManager("VCXCAT3DXModelManager")){this._experienceBase.getManager("VCXCAT3DXModelManager").InitApplicationMode()}if(this._experienceBase.getManager("VCXContextManager").getUrlVars().debug!==undefined){window.onerror=function(aq,ap,am){var ao="";var ar="";var an=Y._experienceBase.getManager("VCXNLSManager");if(an){var al=an.GetNLS(["VCXWebGUI/VCXWebGUI"]);ao=al?al.getTitle({key:"Notification.Unstable"}):"CATNLS error";ar=al?al.getTitle({key:"Notification.Crash"}):"CATNLS error"}var at={level:"error",title:ar,message:ao,};Y._experienceBase.getManager("VCXContextManager").addNotification(at)}}if(this._experienceBase.getManager("VCXContextManager").getUrlVars().DSWebRecord!==undefined){document.experienceBase=this._experienceBase}if(this._experienceBase.odt!=="record"&&this._experienceBase.odt!=="replay"){if(this._vcxexperience.getManager("VCXContextManager")&&this._vcxexperience.getManager("VCXContextManager").getProdHighMode()){if(this._experienceBase.getManager("VCXContextManager").getUrlVars().debug===undefined){if(widget.simulatePlay!==undefined){var ai=this._vcxexperience.getManager("VCXContextManager").getActionBar();ai.loadModel({file:"VCXWebSimulatePlay.xml",module:"VCXWebAuthoringApp",merge:false,});widget.simulatePlay=undefined}else{var ai=this._vcxexperience.getManager("VCXContextManager").getActionBar();ai.loadModel({file:"VCXWebAuthoringApp.xml",module:"VCXWebAuthoringApp",merge:false,})}}}}var O=this._vcxexperience.getManager("VCXContextManager");this._frmWindow=O.getFrameWindow();this._uiLayer=this._frmWindow.getUIFrame();this.immersiveFrame=this._frmWindow.getImmersiveFrame();u._activeWindow=null;if(this.isTouchActivated()){this._uiLayer.addClassName("vcxTouchMode")}var Q=this.GetGraphicCard();var L=Q===null;var ah=!L&&Q.indexOf("Intel(R) HD Graphics")>=0;if(L||ah){this._uiLayer.addClassName("vcxNoGraphiCard");var J=this._vcxexperience.getManager("VCXNLSManager");if(J){var H=J.GetNLS(["VCXWebGUI/VCXWebGUI"]);if(L){var R="Notification.NoGraphicCardDetected";if(this.IsFirefox()){R="Notification.FirefoxActivateWebGL"}this._vcxexperience.getManager("VCXContextManager").addNotification({level:"error",title:"error",message:H?H.getTitle({key:R}):"CATNLS error",})}else{var G=localStorage?localStorage.getItem("DS_COMPOSER_GUI_DONT_SHOW_AGAIN_LOW_GRAPHIC_CARD_DETECTED"):false;if(G!=="true"&&G!=="1"){console.log("Card Detected : "+Q);this._vcxexperience.getManager("VCXContextManager").addNotification({level:"warning",title:"warning",message:H?H.getTitle({key:"Notification.LowGraphicCardDetected"}):"CATNLS error",action:{label:H?H.getTitle({key:"Notification.DontShowMeAgain"}):"Notification.DontShowMeAgain",callback:function(){if(localStorage){localStorage.setItem("DS_COMPOSER_GUI_DONT_SHOW_AGAIN_LOW_GRAPHIC_CARD_DETECTED",true);if(this.getParent()){this.getParent().destroy()}}}}})}}}}if(this._frmWindow._sceneGraphTree){this._frmWindow._sceneGraphTree.tree.slideOut()}this._updateUsableAreaFct=function(){Y.updateUsableArea()};if(window.attachEvent){window.attachEvent("onresize",Y._updateUsableAreaFct)}else{if(window.addEventListener){window.addEventListener("resize",Y._updateUsableAreaFct,true)}}var Z=new Event("resize");document.querySelector("div.wux-windows-immersive-frame").dispatchEvent(Z);var ac=Y.GetCanvasView();ac.addClassName("vcx-canvas-view");var ae=O.getCityMode();var T=400;var N="(Choose a Sample or Drop your contents here)";if(ae){this._uiLayer.addClassName("cid-cityApp");T=600;N="(Drop your contents here)"}var K=T;var ak="100px";var S=-0.5*T;var ag="-50px";var P=N;var ab=false;if(O.getExperienceIn3DPlay()===true){K="275px";ak="250px";S="-125px";ag="-120px";P="";ab=true}var af=O.getPlayerMode();this.recordActionBarEvent();var V=(this._experienceBase.getManager("VCXContextManager").getUrlVars().noSample==="1"||(!(this._experienceBase.getManager("VCXContextManager").getFileMode())&&!af));Y=this;if(O.getExperienceIn3DPlay()===false&&ae===false&&!V){var U="DS/VCXWebDebug/VCXSampleCtrl";require([U],function(al){if(Y._destroyed===undefined){Y._vcxSampleCtrl=new al(Y,[])}})}Y._updateDockingAreaCB=function(al){setTimeout(function(){Y.updateUsableArea()},305)};var ad=Y.immersiveFrame.dockingElements;for(var aa=0;aa<ad.length;aa++){var X=ad[aa];X.addEventListener(p.POINTERUP,Y._updateDockingAreaCB)}if(Y._frmWindow._sceneGraphTree){var M=Y._frmWindow._sceneGraphTree.tree._sidePanel;var aj=parseFloat(M.elements.panel.style.transitionDuration);this._VCX_GUI_PANEL_SLIDE_IN=M.onSlideIn(function(){setTimeout(function(){y.publish({event:"VCX_GUI_PANEL_SLIDE_IN",})},aj*1000)});this._VCX_GUI_PANEL_SLIDE_OUT=M.onSlideOut(function(){setTimeout(function(){y.publish({event:"VCX_GUI_PANEL_SLIDE_OUT",})},aj*1000)})}this.event_VCX_BEGIN_TRANSITION=y.subscribe({event:"VCX_BEGIN_TRANSITION"},function(){Y.SetIsPlaying()});this.event_VCX_END_TRANSITION=y.subscribe({event:"VCX_END_TRANSITION"},function(){Y.UnSetIsPlaying()});var I=new z({target:Y.GetCanvasView(),});I._lastShowPosition={x:0,y:0};this._evtPreHLRemoveToken=y.subscribe({event:"VCX_PREHIGHLIGHT_REMOVE"},function W(al){I.hide();if(I){I.tooltipInfos=undefined}Y.GetCanvasView().tooltipInfos=undefined});this._evtPreHLAddToken=y.subscribe({event:"VCX_PREHIGHLIGHT_ADD"},function F(aq){if(aq[0].event){var ap="";if(aq&&Array.isArray(aq)){for(var ao=0;ao<aq.length;++ao){var an=aq[ao]&&aq[ao].pathElement;var al=k.GetModifiableFromPathElement(an,Y._experienceBase);if(al){var am=al.GetProperty("Actor.ToolTip._ComputedText");ap=am.GetPropertyValue().GetValue()}else{console.log("no modifiable associated to pathElement.")}}}Y.GetCanvasView().tooltipInfos=new q({shortHelp:ap,initialDelay:"1000"});I.mousePosition=aq[0].event.currentPosition;I.target=Y.GetCanvasView();I.show()}});if(this._experienceBase&&this._experienceBase.webApplication&&this._experienceBase.webApplication.app&&this._experienceBase.webApplication.app.onPostInitialize){this._experienceBase.webApplication.app.onPostInitialize(this._experienceBase)}},update:function(F){if(this._firstLoad){this._firstLoad=false}if(this._vcxTimelineCtrl){this._vcxTimelineCtrl.updateTimelineFromModel()}},removeDropText:function(){},InitGUI:function(){if(this._init===1){console.log("VCXGUIManager::InitGUI has already been done");return}this._init=1;j.memoryLog("InitGUI",true);var O=this._experienceBase.getManager("VCXContextManager").getPlayerMode();var H=this._experienceBase.getManager("VCXContextManager").getCityMode();var M=this._experienceBase.getManager("VCXContextManager").getDisplayUIMode();if(M===0){this._vcxPaperCtrl=new i(this);j.memoryLog("InitGUI",false);return}if(this._experienceBase.getManager("VCXContextManager").getDisplayUIMode()!==false){var I="SequenceFolder.Scenarios";var F="Sequence.CADViews";var L="Sequence.CADCaptures";var N="Sequence.Layers";var P=this._vcxexperience.getManager("VCXNLSManager");if(P){var J=P.GetNLS(["VCXWebInteropSMG/VCXWebInteropSMG"]);I=J.getTitle({key:I});F=J.getTitle({key:F});L=J.getTitle({key:L});N=J.getTitle({key:N})}var K=[I];if(this._experienceBase.getManager("VCXContextManager").getCityMode()){}else{K=[I,F+"|"+L,N]}if(this._experienceBase.getManager("VCXContextManager").getDisplayUIScenariosPanelMode()!==false){this._vcxScenarioCtrl=new c(this,K,O)}}if(this._experienceBase.getManager("VCXContextManager").getDisplayPaper()!==false){this._vcxPaperCtrl=new i(this);this._vcxPaperCtrl._experience=this._experienceBase}if(this._experienceBase.getManager("VCXContextManager").getDisplayUIMode()!==false){var Q=this._experienceBase.getManager("VCXContextManager").getUrlVars().ForcePropertiesWriteMode;if(this._experienceBase.getManager("VCXContextManager").getDisplayUIPropertiesPanelMode()!==false){this._vcxPropertiesCtrl=new D(this,!Q&&O)}if(!O&&!H){}this._vcxUndoRedoCtrl=new x(this);this._vcxDocManagerCtrl=new E(this);this._vcxLinkedPropCtrl=new r(this);if(this._vcxScenarioCtrl){this._vcxScenarioCtrl.loadScenariosFromExperience()}if(!H){this.InitTimelineCtrl(this._vcxexperience.getManager("VCXScenarioManager").GetCurrentScenario(),0)}if(this._vcxScenarioCtrl){this._vcxScenarioCtrl.onCurrentScenarioChanged(this._vcxexperience.getManager("VCXScenarioManager").GetCurrentScenario())}this.initTreesTabFrames();this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).minSize=300;if(!H&&this._vcxScenarioCtrl){if(this._vcxScenarioCtrl._tabPageFrame._panelMaster.windowGroup){this._vcxScenarioCtrl._tabPageFrame._panelMaster.windowGroup.multiSelFlag=false;this._vcxScenarioCtrl._tabPageFrame._panelMaster.windowGroup.currentWindows=[this._vcxScenarioCtrl._tabPageFrame._panelMaster]}}this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).elements.collapser.setAttribute("data-rec-id","right-dock");this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).elements.collapser.setAttribute("data-rec-id","left-dock");this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).elements.collapser.setAttribute("data-rec-id","top-dock");this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).minSize=300;this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).dockingZoneSize=300;this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).minSize=271;this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).dockingZoneSize=271;var G=this;this._onKeydownEvent=function(R){G.onKeydownEvent(R)};addEventListener("keydown",this._onKeydownEvent);document.querySelector("div.wux-windows-immersive-frame").dispatchEvent(new Event("resize"))}j.memoryLog("InitGUI",false);this._modelEvent.publish({event:"initGUIEnd",data:{}})},subscribe:function(F,G){return this._modelEvent.subscribe({event:F},G)},onInitEnd:function(F){return this.subscribe("initGUIEnd",F)},onUnInitialize:function(F){return this.subscribe("unInitialize",F)},unsubscribe:function(F){this._modelEvent.unsubscribe(F)},initTreesTabFrames:function(){var G=this._experienceBase.getManager("VCXDRMManager");if(this._experienceBase.getManager("VCXContextManager").getUrlVars().tree!=="0"&&G.GetDisplayTree()&&this._experienceBase.getManager("VCXContextManager").getDisplayUIAssemblyPanelMode()){this._vcxWebAssemblyTabFrameCtrl=new A(this._experienceBase);this._vcxWebAssemblyTreeCtrl=new C(this._experienceBase);this._vcxWebSelectionSetsTreeCtrl=new B(this._experienceBase);this._vcxWebHotspotsTreeCtrl=new g(this._experienceBase)}if(this._experienceBase.getManager("VCXContextManager").getUrlVars().dressuptree!=="0"&&G.GetDisplayTree()&&this._experienceBase.getManager("VCXContextManager").getDisplayUIDressupsPanelMode()){this._vcxWebDressupTabFrameCtrl=new t(this._experienceBase);this._vcxWebDressupTreeCtrl=new o(this._experienceBase)}if(this._experienceBase.getManager("VCXContextManager").getUrlVars().stylestree=="1"){this._vcxWebStylesTabFrameCtrl=new s(this._experienceBase);this._vcxWebStylesTreeCtrl=new w(this._experienceBase)}if(this._vcxWebDressupTabFrameCtrl){if(this._vcxWebAssemblyTabFrameCtrl){this._vcxWebDressupTabFrameCtrl.getFrame().tabWith(this._vcxWebAssemblyTabFrameCtrl.getFrame())}if(this._vcxScenarioCtrl){this._vcxScenarioCtrl.getFrame().tabWith(this._vcxWebDressupTabFrameCtrl.getFrame())}}else{if(this._vcxWebAssemblyTabFrameCtrl&&this._vcxScenarioCtrl){this._vcxScenarioCtrl.getFrame().tabWith(this._vcxWebAssemblyTabFrameCtrl.getFrame())}}if(this._vcxSampleCtrl&&this._vcxScenarioCtrl){this._vcxSampleCtrl.getFrame().tabWith(this._vcxScenarioCtrl.getFrame())}if(this._vcxWebStylesTabFrameCtrl&&this._vcxSampleCtrl){this._vcxWebStylesTabFrameCtrl.getFrame().tabWith(this._vcxSampleCtrl.getFrame())}if(this._vcxScenarioCtrl&&this._vcxScenarioCtrl.getFrame()._panelMaster.windowGroup){for(var F=0;F<this._vcxScenarioCtrl.getFrame()._panelMaster.windowGroup._tab._tabContent.length;F++){if(this._vcxScenarioCtrl.getFrame()._panelMaster.windowGroup._tab._tabContent[F].content===this._vcxScenarioCtrl.getFrame()._panelMaster.elements.container){this._vcxScenarioCtrl.getFrame()._panelMaster.windowGroup._tab.value=[F];break}}}},unInitTreesTabFrames:function(){if(this._vcxWebAssemblyTabFrameCtrl){this._vcxWebAssemblyTabFrameCtrl.unInitialize();this._vcxWebAssemblyTreeCtrl&&this._vcxWebAssemblyTreeCtrl.unInitialize();this._vcxWebSelectionSetsTreeCtrl&&this._vcxWebSelectionSetsTreeCtrl.unInitialize();this._vcxWebHotspotsTreeCtrl&&this._vcxWebHotspotsTreeCtrl.unInitialize();this._vcxWebAssemblyTabFrameCtrl=null;this._vcxWebAssemblyTreeCtrl=null;this._vcxWebSelectionSetsTreeCtrl=null;this._vcxWebHotspotsTreeCtrl=null}if(this._vcxWebDressupTabFrameCtrl){this._vcxWebDressupTabFrameCtrl.unInitialize();this._vcxWebDressupTreeCtrl.unInitialize();this._vcxWebDressupTabFrameCtrl=null;this._vcxWebDressupTreeCtrl=null}if(this._vcxWebStylesTabFrameCtrl){this._vcxWebStylesTabFrameCtrl.unInitialize();this._vcxWebStylesTreeCtrl.unInitialize();this._vcxWebStylesTabFrameCtrl=null;this._vcxWebStylesTreeCtrl=null}},setUpTrees:function(){if(this._vcxWebAssemblyTabFrameCtrl instanceof b){this._setUpTree(this._vcxWebAssemblyTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,1);this._setUpTree(this._vcxWebSelectionSetsTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,2);this._setUpTree(this._vcxWebHotspotsTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,3)}if(this._vcxWebDressupTabFrameCtrl instanceof b){this._setUpTree(this._vcxWebDressupTreeCtrl,this._vcxWebDressupTabFrameCtrl,1)}if(this._vcxWebStylesTabFrameCtrl instanceof b){this._setUpTree(this._vcxWebStylesTreeCtrl,this._vcxWebStylesTabFrameCtrl,1)}},_setUpTree:function(H,I,G){if(H&&!H.tree){H.setTabFrameCtrl(I);H.setSlidingViewIndex(G);var F=H.createTree();if(!F){console.warn("Creation of "+H._type+" tree UI failed!")}F&&F.inject(I.getFrame()._slidingViews.getView(G))}},onKeydownEvent:function(G){if(G.keyCode===83&&this.immersiveFrame&&document.activeElement.nodeName==="BODY"){if(this._statsCtrl){this._statsCtrl.destroy();delete this._statsCtrl}else{var F={};F.currentDockArea=WUXDockAreaEnum.BottomDockArea;F.immersiveFrame=this.immersiveFrame;this._statsCtrl=new d(F)}}},toggleTouch:function(){this._touchAvailable=!this._touchAvailable;if(this._vcxPaperCtrl){this._vcxPaperCtrl.mainPanel.parentNode.removeChild(this._vcxPaperCtrl.mainPanel);this._vcxPaperCtrl=null}if(this.isTouchAvailable()){this._uiLayer.addClassName("vcxTouchMode")}else{this._uiLayer.removeClassName("vcxTouchMode")}this._vcxPaperCtrl=new i(this);this._vcxPaperCtrl._experience=this._vcxexperience;this.RefreshGUI()},isTouchAvailable:function(){return this._touchAvailable},isTouchActivated:function(){return this.isTouchCompliantDevice()&&this.isTouchAvailable()},isTouchCompliantDevice:function(){return this._experienceBase.getManager("VCXContextManager").isTouchCompliantDevice()},GetGraphicCard:function(){var F=false;var I=document.createElement("canvas");var J=I.getContext("experimental-webgl",{stencil:true});var G=J.getExtension("WEBGL_debug_renderer_info");var H=G&&J.getParameter(G.UNMASKED_RENDERER_WEBGL);return H},IsFirefox:function(){return(navigator.userAgent.toLowerCase().indexOf("firefox")>-1)},IsChrome:function(){return(navigator.userAgent.toLowerCase().indexOf("firefox")>-1)},lockLoading:function(){document.body.addClassName("waiting");if(document.querySelector(".moduleContent")){document.querySelector(".moduleContent").dataset.lockLoading="true"}},islockLoading:function(){if(document.querySelector(".moduleContent")){return document.querySelector(".moduleContent").lockLoading==="true"}else{return false}},unlockLoading:function(){if(document.querySelector(".moduleContent")){document.querySelector(".moduleContent").dataset.lockLoading=""}document.body.removeClassName("waiting")},RefreshGUI:function(){if(!this._init){return}j.memoryLog("RefreshGUI",true);var F=new Event("resize");document.querySelector("div.wux-windows-immersive-frame").dispatchEvent(F);if(this._vcxPaperCtrl&&this._vcxScenarioCtrl){this._vcxPaperCtrl._experience=this._vcxScenarioCtrl._vcxGuiManager._vcxexperience}if(this._vcxScenarioCtrl){this._vcxScenarioCtrl.onCurrentScenarioChanged(this._vcxexperience.getManager("VCXScenarioManager").GetCurrentScenario());if(this._vcxexperience.getManager("VCXExperience").GetViewMode()===1){this._vcxScenarioCtrl.setSequenceState("Animation",false)}}j.memoryLog("RefreshGUI",false);this.unlockLoading()},RefreshPourcent:function(F){},ChangeTimePos:function(G,F){if(this._vcxTimelineCtrl){this._vcxTimelineCtrl.ChangeTimePos(G,F)}},InitTimelineCtrl:function(I,X){if(this._vcxScenarioCtrl===null){return}var Q=this._experienceBase.getManager("VCXContextManager").getContext();var L=e.getCommandCheckHeader("VCXAutoKeyCmd",Q);if(L){L.setState(true)}if(this._vcxTimelineCtrl){this._vcxTimelineCtrl.unInitialize();this._vcxTimelineCtrl=null}var G=this._experienceBase.getManager("VCXContextManager");if(G.getCityMode()){return}var F={frmWindow:this._frmWindow,experienceBase:this._experienceBase,scenarioID:I,flattenKeys:true};this._vcxTimelineCtrl=new f(F);if(I===""){return}var H=null;if(G){H=G.getContext()}var ad=e.getCommandCheckHeader("VCXCameraPlayModeCmd",H);var S=e.getCommandCheckHeader("VCXAutoKeyCmd",H);var ab=Math.round(this._experienceBase.getManager("VCXScenarioManager").GetMaxFrame(I));if(ab===0){ab=500}var K={frmWindow:this._frmWindow,parent:this._vcxScenarioCtrl.getFrame().getFooter(),displayToolbar:true,displaySlider:true,displayPlayBack:false,displayLoop:true,displayBounce:true,displayReverse:true,displayMarkers:true,displayCamera:(ad?true:false),displayCameraMode:this._isCameraPlayMode=(ad?ad.getState():false),maxFrame:ab,timelineGUI:VCXWebTimelineGUIEnum.Light,title:"Light Timeline"};this._vcxTimelineCtrl.createTimeline(K);if(!this._vcxexperience.getManager("VCXContextManager").getPlayerMode()){var Y=this;var J={timelineGUI:VCXWebTimelineGUIEnum.Main,maxFrame:ab,numberOfTracks:5,step_time_min:0.1,scenario:this._vcxexperience.getManager("VCXScenarioManager").GetScenarios()[I],propertiesTreeWidth:130,};var M=K;M.displayAutoKey=(S?true:false);M.displayAutoKeyMode=this._isAutoKeyMode=(S?S.getState():false);M.displayRemoveTracks=true;M.parent=null;M.displaySlider=false;M.displayPlayBack=false;M.displayFilterOnSelection=true;M.filterOnSelectionMode=false;var ac=this;M.customButtons=[];J.toolbar=M;this._vcxTimelineCtrl.createTimeline(J)}var aa=this._vcxexperience.getManager("VCXScenarioManager").GetScenarios()[I];var U=aa.QueryInterface("VCXIModifiable");var ag=U.GetProperty("Actor.Scenario.Markers");var W={};var af=[];var P=ag.GetPropertyValue().GetValue();for(var ae=0;ae<P.length;ae++){var O={};var N=P[ae];if(N.GetType()==="VCXPropertyValueLink"){var T=N.GetValue();var Z=this._experienceBase.ComponentsMap.GetComponentFromID(T);var V="choice "+ae.toString();if(Z&&Z.GetName){O.name=Z.GetName();O.id=Z.GetID();O.component=Z;var R=Z.QueryInterface("VCXIModifiable");O.type=R.GetProperty("Actor.IsMilestone").GetPropertyValue().GetValue()?"milestone":"marker";O.frame=R.GetProperty("Actor.TimePos").GetPropertyValue().GetValue();af.push(O)}}}this._vcxTimelineCtrl.addMarkers(af);this._vcxTimelineCtrl.setIndexValue(X)},deleteTimeline:function(){if(this._vcxTimelineCtrl){this._vcxTimelineCtrl.unInitialize();this._vcxTimelineCtrl=null;var F=this._experienceBase.getManager("VCXContextManager").getContext();var G=e.getCommandCheckHeader("VCXAutoKeyCmd",F);if(G){G.setState(false)}}},GoToScenarioContext:function(){var F=this._vcxexperience.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();if(F){}if(this._isPlayingGoTo){return false}return true},SetIsPlaying:function(){this._isPlayingGoTo=1},UnSetIsPlaying:function(){this._isPlayingGoTo=0},SetPropertiesPanelVisibility:function(F){if(F){this._vcxPropertiesCtrl._mainPanel.style.display=""}else{this._vcxPropertiesCtrl._mainPanel.style.display="none"}},SetUndoRedoPanelVisibility:function(F){if(F){this._vcxUndoRedoCtrl._mainPanel.style.display=""}else{this._vcxUndoRedoCtrl._mainPanel.style.display="none"}},SetDocManagerPanelVisibility:function(F){if(F){this._vcxDocManagerCtrl._mainPanel.style.display="";this._vcxDocManagerCtrl.onRedraw()}else{this._vcxDocManagerCtrl._mainPanel.style.display="none"}},SetLinkedPropPanelVisibility:function(F){if(F){this._vcxLinkedPropCtrl._mainPanel.style.display="";this._vcxLinkedPropCtrl.onRedraw()}else{this._vcxLinkedPropCtrl._mainPanel.style.display="none"}},AddDropZone:function(){this._vcxGettingStartedUI.dropZoneON()},RemoveDropZone:function(){this._vcxGettingStartedUI.dropZoneOFF()},GetCanvasView:function(){return this._vcxexperience.getManager("VCXContextManager").getMainViewer().canvas},SetCursor:function(G){var F=this.GetCanvasView();if(F){F.setStyle("cursor",G)}},GetCursor:function(){var F=this.GetCanvasView();if(F){return F.style.cursor}else{console.log("viewer.canvas not found !!")}},GetActiveSequenceId:function(){if(this._vcxScenarioCtrl){return this._vcxScenarioCtrl.GetActiveSequenceId()}return null},getGUIServices:function(){return m},getGettingStartedUI:function(){return l},getGettingStartedNode:function(){return this._vcxGettingStartedUI.getHomeNode()},GetDisplayScenarioImmersiveUI:function(){return this._vcxDisplayScenarioImmersiveUI},SetDisplayScenarioImmersiveUI:function(F){if(this._vcxDisplayScenarioImmersiveUI!=F){if(this._vcxScenarioCtrl){this._vcxDisplayScenarioImmersiveUI=F;this._vcxScenarioCtrl.setImmersiveUIState(F)}}}});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXGUIManager"}});return a});define("DS/VCXWebGUI/VCXStatsCtrl",["UWA/Class","DS/CoreEvents/Events","DS/Windows/Panel"],function(b,a,c){var d=b.extend({init:function(e){var h=this;h.dataMaster={};h.dataMaster.fps="";this.options=e;h.statsContent=new UWA.Element("div");this._panelMaster=new c({immersiveFrame:e.immersiveFrame,currentDockArea:e.currentDockArea||1<<2,title:"Stats",content:h.statsContent});e.immersiveFrame.addWindow(this._panelMaster);var f=new Stats();var g=function(){f.update();h.dataMaster.fps=f.domElement.childNodes[0].childNodes[0].childNodes[0].data;h.updateUI();h.fpsReq=requestAnimationFrame(g)};this.fpsReq=requestAnimationFrame(g);this._tokenChanged=a.subscribe({event:"VCX_STATS_UPDATE"},function(i){h.updateStatsFromData(i)});this._tokenRemove=a.subscribe({event:"VCX_STATS_REMOVE"},function(i){h.removeTrackingData(i)});this._tokenEmpty=a.subscribe({event:"VCX_STATS_EMPTY"},function(){h.emptyTrackingData()})},destroy:function(){window.cancelAnimationFrame(this.fpsReq);this.options.immersiveFrame.removeWindow(this._panelMaster);a.unsubscribe(this._tokenChanged);this._tokenChanged=null;a.unsubscribe(this._tokenRemove);this._tokenRemove=null;a.unsubscribe(this._tokenEmpty);this._tokenEmpty=null},removeTrackingData:function(e){delete this.dataMaster[e.id]},emptyTrackingData:function(e){this.dataMaster={}},updateStatsFromData:function(e){this.dataMaster[e.id]=e.value;this.updateUI()},updateUI:function(){var e="";for(var f in this.dataMaster){e+=""+f+": "+this.dataMaster[f]+", "}this.statsContent.innerHTML=e},});return d});define("DS/VCXWebGUI/VCXLinkedPropCtrl",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Spreadsheet/DataGrid","DS/VCXWebGUI/VCXToolbarCtrl",],function(d,c,a,b,e){var f=d.extend({init:function(g){var l=this;this._vcxGuiManager=g;this._tokenLinkAdded=a.subscribe({event:"VCX_LINKS_ADDED"},function(){l.onRedraw()});this._tokenLinkRemoved=a.subscribe({event:"VCX_LINKS_REMOVED"},function(){l.onRedraw()});this._mainPanel=new UWA.Element("div",{html:"","class":"VCXLinkedPropCtrl",styles:{display:"none",margin:"",height:"300px",width:"400px",bottom:"100px",left:"300px",position:"absolute",border:"1px dotted black",backgroundColor:"white"},}).inject(l._vcxGuiManager._uiLayer);this._toolbarContainer=new UWA.Element("div",{html:"","class":"wux-panels-panelbase-title vcx-panels-panelbase-title",}).inject(this._mainPanel);this._toolbar=new e({controller:l,title:"Linked Properties panel",parent:this._toolbarContainer,panel:this._mainPanel,});this._toolbar.addMainItemFixed("VCXDeleteLinkedPropCmd","","vcxToolbarButtonIcon","VCXWebDebug/VCXWebDebug");var h={apiVersion:2,height:"auto",headersDimensions:{width:15,height:15},show:{rowHeaders:true,columnHeaders:true},resize:{columns:true,rows:true},isSortable:false,className:"linkedProperties",columns:[{text:"In",dataIndex:"inValue",width:180},{text:"Out",dataIndex:"outValue",width:180}]};h.selection={nodes:true,cells:false,rowHeaders:true,columnHeaders:false,unselectAllOnEmptyArea:true,toggle:true,canMultiSelect:true,canMultiRowSelect:true};l.datagrid=new b(h);var j=l.datagrid.getManager();var i;var k=function(m){if(event.changedTouches){return}var q=m.cellModel;var y=m.cellView;var B=y.getVirtualCoordinates();var o=B.virtualRowID;var C=B.virtualColumnID;if(!y._isBeingResized){if(C===-1){if(j.options.selection.rowHeaders){j.prepareUpdateView();if(j.options.selection.canMultiRowSelect){if(j.isRowSelected(o)){j.unselectRow(o,false)}else{j.selectRow(o,false)}}else{j._selectedCells.empty();j.selectRow(o)}i=o;j.pushUpdateView()}}if(o===-1){var F=j._getColumnOptionValue(C,"isSortable");var x=["sort:asc","sort:desc"];var G=j._getColumnState(C);var v=cyclicIterator(x,x.indexOf(G));var u=v.getNext();switch(u){case undefined:case"select":j.prepareUpdateView();if(j.options.selection.rowHeaders){q.removeClass("wux-ui-sort-desc");q.removeClass("wux-ui-sort-asc");j.selectColumn(C,true)}j.pushUpdateView();break;case"sort:desc":if(F){j.prepareUpdateView();j.sortColumnContent(C,{typeOfCell:"number",sortOrder:"desc"});j.pushUpdateView()}break;case"sort:asc":if(F){j.prepareUpdateView();j.sortColumnContent(C,{typeOfCell:"number",sortOrder:"asc"});j.pushUpdateView()}break}}if(o!==-1&&C!==-1&&j.options.selection.cells){j.prepareUpdateView();j._preventNextUpdateView();j.unselectAll({cells:true,updateView:false});if(j._modeIsRange){var H=q;var w=j._selectedCells.get()[0];j._selectedCells.empty();j._selectedCells.add(w);var E,D;var r,t,n,p;var A=w.getView().getVirtualCoordinates();var s=H.getView().getVirtualCoordinates();if(A.virtualRowID<s.virtualRowID){r=A.virtualRowID;t=s.virtualRowID}else{t=A.virtualRowID;r=s.virtualRowID}for(E=r;E<=t;E++){if(A.virtualColumnID<s.virtualColumnID){n=A.virtualColumnID;p=s.virtualColumnID}else{p=A.virtualColumnID;n=s.virtualColumnID}for(D=n;D<=p;D++){if(!(E===A.virtualRowID&&D===A.virtualColumnID)){var z=j.getCell(E,D);j._selectedCells.add(z)}}}}else{if(j._modeIsMultiSel){j._selectedCells.add(q)}else{j._selectedCells.unique(q)}}j.pushUpdateView()}}};l.datagrid.getManager().onCellClick=function(m){return this._modelEvents.subscribe({event:"click",},k)};l.datagrid.inject(this._mainPanel);l.datagrid.elements.formContainer.childNodes[1].style.top="30px"},GetSelectedLinks:function(){if(this.datagrid){var k=[];var h=this.datagrid.getManager().getSelectedRows();for(var j=0;j<h.length;j++){var g=this._mapToFill[j];k.push(g)}return k}},unInitialize:function(){a.unsubscribe(this._tokenLinkAdded);delete this._tokenLinkAdded;a.unsubscribe(this._tokenLinkRemoved);delete this._tokenLinkRemoved;this._toolbar.unInitialize();this._toolbar=null;this.datagrid.getManager().onCellClick=null;this.datagrid.destroy();this._mainPanel.remove()},onRedraw:function(){var q=this;if(this._mainPanel.style.display==="none"){return}var k=this.datagrid.getManager();k.empty();var t=q._vcxGuiManager._vcxexperience.getManager("VCXLinkedPropertyManager");this._mapToFill={};var g=true;var m=0;for(var s in t._links){if(t._links.hasOwnProperty(s)){var l=t._links[s];if(l){for(var o in l){if(l.hasOwnProperty(o)){var p=l[o];if(p){for(var n in p){if(p.hasOwnProperty(n)){var j=p[n];for(var u in j){if(j.hasOwnProperty(u)){var h=s+"#"+o;var v=n+"#"+u;if(g){g=false;k.prepareUpdateView();k.empty()}k.addRow({inValue:h,outValue:v,});var r={inID:s,inProp:o,outID:n,outProp:u};this._mapToFill[m]=r;m++}}}}}}}}}}if(!g){k.pushUpdateView();k._endResizeCallback()}}});return f});define("DS/VCXWebGUI/VCXTabPageFrame",["UWA/Class","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/Layouts/SlidingViews","DS/VCXWebGUI/VCXSidePanelExtendable","DS/VCXWebGUI/VCXToolbarCtrl","DS/Windows/Panel",],function(c,a,d,f,h,e,g){var b=c.extend({init:function(u){var n=this;this.options=u;u.slidingViews._vcxuiSequencesMaster[0]={};u.slidingViews._vcxuiSequencesMaster[0].Menu=new UWA.Element("div",{"class":"vcxuiSequencesMaster"});var i="Menu";if(this.options._experienceBase){var t=this.options._experienceBase.getManager("VCXNLSManager");var p="VCXWebGUI/VCXWebGUI";var l=t.GetNLS([p]);if(l){i=l.getTitle({key:"VCXProperties.Menu",})}}u.slidingViews.views.unshift({title:i,content:{html:u.slidingViews._vcxuiSequencesMaster[0].Menu,iframe:false}});if(u.immersiveFrame){this._panelMaster=new g({collapsibleFlag:true,closeButtonFlag:false,resizableFlag:true,immersiveFrame:u.immersiveFrame,currentDockArea:u.sidePanel.currentDockArea,title:u.sidePanel.title,minWidth:(u.sidePanel.minWidth?u.sidePanel.minWidth:271),verticallyStretchableFlag:true,movableFlag:true,icon:u.sidePanel.icon,recId:u.recId});u.immersiveFrame.addWindow(this._panelMaster);this._panel=this._panelMaster.elements._contentDiv;this._panel.style.width="inherit";var j=this._panelMaster.elements.container.parentNode;this.observer=new MutationObserver(function(v){v.forEach(function(w){if(u.sidePanel.usecallback){u.sidePanel.usecallback(u.sidePanel.controller,Math.max(parseInt(0),parseInt(n._panelMaster.elements.container.parentNode.offsetWidth)))}a.publish({event:"VCX_PANEL_RESIZED",});if(u.sidePanel.controller&&typeof(u.sidePanel.controller.updateToolbar)=="function"){u.sidePanel.controller.updateToolbar()}})});var r={attributes:true,childList:false,characterData:true,subtree:false,attributeOldValue:true,attributeFilter:["style"]};if(j){this.observer.observe(j,r)}}else{this._panel=new h(u.sidePanel);this._panel.inject(u._uiLayer)}this._header=new UWA.Element("div",{html:"","class":u.classBaseNameCSS+"Header VCXPanelCtrlHeader",}).inject(n._panel);this._headerSeparator=new UWA.Element("div",{html:"","class":u.classBaseNameCSS+"HeaderSeparator VCXPanelCtrlHeaderSeparator",}).inject(this._header);this._wrapper=new UWA.Element("div",{html:"","class":u.classBaseNameCSS+"Wrapper VCXPanelCtrlWrapper",styles:{},}).inject(this._panel);this._footer=new UWA.Element("div",{html:"","class":u.classBaseNameCSS+"Footer VCXScenarioCtrlFooter",styles:{visibility:"visible",height:"0px",bottom:"0px",width:"100%",transition:"height 0.5s, visibility 0.5s",overflow:"hidden",},}).inject(this._panel);u.slidingViews.showPager=false;if(u.immersiveFrame){u.slidingViews.prevPage=this._panelMaster.elements._titleP}else{u.slidingViews.prevPage=this._panel.elements.title}u.slidingViews.kinetic=false;for(var o in u.slidingViews._vcxuiSequencesMaster){if(parseInt(o)===0){continue}if(u.slidingViews._vcxuiSequencesMaster.hasOwnProperty(o)){for(var s in u.slidingViews._vcxuiSequencesMaster[o]){if(u.slidingViews._vcxuiSequencesMaster[o].hasOwnProperty(s)){this.addCreateMasterItem(s,parseInt(o))}}}}this._slidingViews=new f(u.slidingViews).inject(this._wrapper);this._slidingViews.getContent().setStyles({height:"100%"});this._divSelectorGoToParent=new UWA.Element("div",{"class":"vcxSlidingViewDirection vcxSlidingViewPrevious",});if(u.immersiveFrame){this._panel.childNodes[0].insertBefore(this._divSelectorGoToParent,this._panel.childNodes[0].firstChild)}else{this._panel.elements.title.insertBefore(this._divSelectorGoToParent,this._panel.elements.title.firstChild)}var m=function(){n._display=0;n._panel.childNodes[0].firstChild.style.display="none";n._slidingViews.goToNthView(n._display);n._toolbar._titleName.innerHTML=n._slidingViews.options.views[0].title;n._toolbar.updateToolbar()};this._divSelectorGoToParent.addEvent(d.POINTERUP,function(v){m(v)});this._slidingViews.goToNthView(u.slidingViews.displayTabAtStart);if(u.slidingViews.disableSlindingMenu===1){this.getGoToParent().style.display="none"}this.onResizeCB=function(){if(n.options._experienceBase){var v=n.options._experienceBase.getManager("VCXGUIManager").getUsableArea();if(v){n._wrapper.style.height=document.getElementsByClassName("wux-windows-docking-element-collapser wux-docking-element-left")[0].clientHeight-54-2+"px"}}};if(window.attachEvent){this._tokenScreenResize=window.attachEvent("onresize",this.onResizeCB)}else{if(window.addEventListener){this._tokenScreenResize=window.addEventListener("resize",this.onResizeCB,true)}}var k=u.sidePanel.title;var q="";if(this.options._experienceBase){var t=this.options._experienceBase.getManager("VCXNLSManager");var p=this.options._nlsPath||"VCXWebGUI/VCXWebGUI";var l=t.GetNLS([p]);if(l){if(u.appID){q=l.getTitle({key:u.appID+k+".PanelTitle",})}if(q===""){q=l.getTitle({key:"VCX"+k+".PanelTitle",})}}}this._toolbar=new e({controller:u.sidePanel.controller,title:q,parent:u.immersiveFrame?this._header:this._panel.elements.title,panel:this._panel,});if(u.slidingViews.disableSlindingMenu!==1){this._toolbar.getTextContainer().addEvent(d.POINTERUP,function(v){m(v)});this._toolbar.getTextContainer().style.cursor="pointer"}},unInitialize:function(){if(window.attachEvent){window.detachEvent(this._tokenScreenResize);delete this._tokenScreenResize}else{if(window.addEventListener){window.removeEventListener("resize",this.onResizeCB,true);delete this._tokenScreenResize}}this._divSelectorGoToParent.removeEvent(d.POINTERUP);this._divSelectorGoToParent.remove();this._divSelectorGoToParent=null;if(this.observer){this.observer.disconnect()}this._slidingViews=null;this._toolbar.getTextContainer().removeEvent(d.POINTERUP);this._toolbar.unInitialize();this._toolbar=null;if(this._panelMaster){if(this.options.immersiveFrame){this.options.immersiveFrame.removeWindow(this._panelMaster)}this._panelMaster=null}else{this.getPanel().elements.container.parentNode.removeChild(this.getPanel().elements.container);this._panel.remove();this._panel=null}for(var j in this.options.slidingViews._vcxuiSequencesMaster){if(this.options.slidingViews._vcxuiSequencesMaster.hasOwnProperty(j)){for(var i in this.options.slidingViews._vcxuiSequencesMaster[j]){if(this.options.slidingViews._vcxuiSequencesMaster[j].row){this.options.slidingViews._vcxuiSequencesMaster[j].row.removeEvent(d.POINTERUP);this.options.slidingViews._vcxuiSequencesMaster[j].row.remove();this.options.slidingViews._vcxuiSequencesMaster[j].row=null}if(this.options.slidingViews._vcxuiSequencesMaster[j].hasOwnProperty(i)&&this.options.slidingViews._vcxuiSequencesMaster[j][i]&&this.options.slidingViews._vcxuiSequencesMaster[j][i].unInitialize){this.options.slidingViews._vcxuiSequencesMaster[j][i].unInitialize()}}}}this.options.slidingViews=null;this.options=null;this._panel=null;this.observer=null;this._header=null;this._headerSeparator=null;this._wrapper=null;this._footer=null;this.onResizeCB=null},tabWith:function(i){if(!this._panelMaster){return}this._panelMaster.attachToWindow(i._panelMaster,WUXSnapAreaEnum.InsideArea);if(this._panelMaster.windowGroup){}},getPanel:function(){return this._panel},getToolbar:function(){return this._toolbar},getContent:function(){return this._wrapper},getFooter:function(){return this._footer},getGoToParent:function(){return this._divSelectorGoToParent},addCreateMasterItem:function(k,j){var o=new UWA.Element("div",{"class":"vcxuiSequencesMasterRow"});o.inject(this.options.slidingViews._vcxuiSequencesMaster[0].Menu);this.options.slidingViews._vcxuiSequencesMaster[j].row=o;var i=new UWA.Element("div",{html:k,"class":"vcxuiSequencesMasterCell"});i.inject(o);var m=new UWA.Element("div",{"class":"vcxSlidingViewNext"});m.inject(o);var n=j;var p=this;var l=function(q){p._display=q;p._panel.childNodes[0].firstChild.style.display="";p._slidingViews.goToNthView(p._display);p._toolbar._titleName.innerHTML=p.options.slidingViews.views[p._display].title;p._toolbar.updateToolbar()};o.addEvent(d.POINTERUP,function(q){l(n)})},});return b});define("DS/VCXWebGUI/VCXPropertiesCtrlExt",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeLinkedProperties","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebGUI/VCXTabPageFrame","DS/Tweakers/TypeRepresentationFactory","DS/Tweakers/TweakerUtils","DS/Tree/TreeListView","DS/Tree/TreeNodeModel","DS/Controls/Button","DS/Controls/LineEditor","DS/Utilities/Array","DS/Utilities/Utils","DS/VCXWebGUI/VCXTreeViewCellAbstract","DS/VCXWebGUI/VCXHyperlinkBoxing","DS/VCXWebGUI/VCXFontBoxing","DS/WebappsUtils/WebappsUtils","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebExperienceLoader/VCXExperienceSaverBase"],function(y,s,t,i,D,m,v,w,q,C,B,x,A,a,u,z,k,o,n,e,p,d,l,f,r,g,E,h){var c=20;var j="";var b=y.extend({init:function(G,P){var N=this;if(P){b.PlayerMode=P}else{b.PlayerMode=false}this._vcxGuiManager=G;this._hyperLinkBoxing=new f();this._hyperLinkBoxing.initialize(this._vcxGuiManager._vcxexperience);this._fontBoxing=new r();this._fontBoxing.initialize(this._vcxGuiManager._vcxexperience);var H=this.onCSOChange.bind(this);this._tokenSelectionAdd=t.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},H);this._tokenSelectionRemove=t.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},H);this._tokenPropertiesChanged=t.subscribe({event:"VCX_PROPERTIES_CHANGED"},this.onPropertiesChanged.bind(this));this._tokenTimePosChanged=t.subscribe({event:"VCX_TIMEPOS_CHANGED"},H);var I={};var F={iconName:"attributes",fontIconFamily:WUXManagedFontIcons.Font3DS};I.sidePanelInfos={classBaseNameCSS:"vcx-properties-",title:"Properties",icon:F,side:"right"};I.slidingViewsTitles=["Properties"];I.slidingViewsContainerIDs=["vcx-propertiesContainer"];this.createTabFrameAndSlidingViews(I);var S=this._vcxGuiManager._experienceBase.getManager("VCXNLSManager");var J=S.GetNLS(["VCXWebGUI/VCXWebGUI"]);if(J){this._searchView=new e({placeholder:J.getTitle({key:"VCXProperties.TypeYourSearch",}),selectAllOnFocus:true,autoCommitFlag:true,recId:"LineEditor"})}this._searchView.getContent().addEvent("change",this._search.bind(this));this._searchView.getContent().setStyle("display","inline-block");this._tabPageFrame._toolbar._titleToolbar.appendChild(this._searchView.getContent());if(!b.PlayerMode){this._tabPageFrame._toolbar.addMainItemFixed("VCXRestoreNeutralsCmd","","vcxToolbarButtonIcon","VCXWebAuthoringCommands/VCXWebAuthoringCommands");this._tabPageFrame._toolbar.addMainItemFixed("VCXCaptureInNeutralsCmd","","vcxToolbarButtonIcon","VCXWebAuthoringCommands/VCXWebAuthoringCommands");if(this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().linkedProperties=="1"){this._tabPageFrame._toolbar.addMainItemFixed("VCXLinkedPropCopyCmd","","vcxToolbarButtonIcon","VCXWebDebug/VCXWebDebug");this._tabPageFrame._toolbar.addMainItemFixed("VCXLinkedPropPasteCmd","","vcxToolbarButtonIcon","VCXWebDebug/VCXWebDebug")}if(this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().stylestree=="1"){this._tabPageFrame._toolbar.addMainItemFixed("VCXCreateStyleFromSelectedPropertiesCmd","","vcxToolbarButtonIcon","VCXWebDebug/VCXWebDebug")}}this._container=new UWA.Element("div",{html:"","class":"wux-panels-panelbase-content",styles:{height:"100%",}}).inject(this.options.slidingViews._vcxuiSequencesMaster[1][this.panelCreationOptions.sidePanelInfos.title]);this._startEdit=false;this.typeRepFactory=new u();var O={defaultCellHeight:35,cellClass:l,height:"auto",apiVersion:2,isSortable:false,expanderStyle:"triangle",enableDragAndDrop:false,show:{rowHeaders:false,columnHeaders:false},resize:{columns:true},selection:{toggle:false},useAsyncPreExpand:false,columns:[{dataIndex:"std",text:"Value",width:"55%",setValue:b.setValueStd,onCellChange:this.changeCB,onCellRequest:b.onCellRequestStd(this.typeRepFactory)},{dataIndex:"modifiable",text:"Modifiable",isHidden:true,isEditable:false,width:"auto"},{dataIndex:"link",text:"Link",isHidden:false,isEditable:false,width:30,onCellRequest:b.onCellRequestLinkCB,}]};this.treeList=new k(O);z.enableLiveChangeOnTreeListView(this.treeList);this.treeList.inject(this._container);var Q;var L=500;var R=this.treeList.getDocument();this.treeList.getManager().addEventListener(i.POINTERUP,b.WrappedCbkLink,false);var M=this.treeList;var K=[];this._buttonOptions={callback:function(W,V){R.prepareUpdate();if(V===""){var T=R.getChildren();for(var U=0;U<T.length;U++){T[U].show();T[U].showChildNodes()}R.pushUpdate();return}var T=R.getChildren();for(var U=0;U<T.length;U++){T[U].hide();T[U].hideChildNodes()}p.optimizedForEach(K,function(Y,X){});K=M.getManager().search({shouldStop:function(X){return false},match:function(X){if(V&&(X.nodeModel.options.label.toLowerCase().indexOf(V)!==-1||(X.nodeModel.options.grid.data&&(X.nodeModel.options.grid.data.toString().toLowerCase().indexOf(V)!==-1||X.nodeModel.options.grid.propName.toString().toLowerCase().indexOf(V)!==-1)))){return true}}});p.optimizedForEach(K,function(Y,X){if(Y._parentNode!==null){Y._parentNode.show()}Y.show()});R.pushUpdate()}};this.treeList.getDocument().onUpdate(function(){});this.treeList.getManager().addEventListener("preEdit",function(T,U){N.modifyWhile=true;N._vcxGuiManager._vcxexperience.getManager("VCXCommandManager").StartTransaction()});this.treeList.getManager().addEventListener("postEdit",function(Z,ab){var X=ab.nodeModel._getNodeInfos();var T={};T.target=X.nodeModel;T.target.options.grid.data=Z.target.dsModel.value;N.modifyWhile=false;N.onNodeModelUpdate(T,ab);var aa=N._vcxGuiManager._vcxexperience.getManager("VCXCommandManager");aa.EndTransaction();if(typeof N._vcxGuiManager._vcxexperience.odt!=="undefined"){var ad=null;for(var Y=aa._stackCmd.length-1;Y>=0;Y--){var ac=aa._stackCmd[Y];if(ac){var W=ac.IsLinkedCmd();if(!W){ad=ac;break}}}if(ad.GetType()==="VCXCmdChangePropertiesAutokey"){var U=new h();var V=U._PropMapToJson(N._vcxGuiManager._vcxexperience,ad._propertyMap);console.log(V);N._vcxGuiManager._vcxexperience.getManager("VCXAPIManager").ChangeProperties(V)}}});this.treeList.getManager().addEventListener("liveChange",function(V,W){var U=W.nodeModel._getNodeInfos();var T={};T.target=U.nodeModel;T.target.options.grid.data=V.target.dsModel.value;N.onNodeModelUpdate(T,W)});this.treeList.getManager().addEventListener("change",function(V,W){var U=W.nodeModel._getNodeInfos();var T={};T.target=U.nodeModel;T.target.options.grid.data=V.target.dsModel.value;N.modifyWhile=true;N.onNodeModelUpdate(T,W);N.modifyWhile=false});this.treeList.getDocument().onNodeModelUpdate(function(T,U){N.onNodeModelUpdate(T,U)})},onNodeModelUpdate:function(ad,F){var ab=this;if(ad&&ad.target){var O=ad.target.options.grid;if(ab.modifyWhile){O.std=O.data}var I={};var aa=ab._vcxGuiManager._vcxexperience;var Z=ab._hyperLinkBoxing;var X=ab._fontBoxing;ab.getCID4Property(O,I);var P=I.vcxValue;var ag=I.propertyName;var V=new D(aa.getManager("VCXScenarioManager"),aa.getManager("VCXCommandManager"));var ac=0;var L=aa.getManager("VCXSelectionManager").GetCurrentSelection();for(var ae=0;ae<L.length;ae++){var Y=L[ae];if(ag.search("Hyperlink_")!=-1){ag="Actor.Hyperlink";var S=Y.GetProperty(ag).GetPropertyValue();var J=Z.HyperlinkPropertyForGUI(S);var N=Z.UpdateMapForGUI(J,O);P=Z.BuildNewValueForGUI(N).GetValue();ab._currentPropSet._map=[]}else{if(ag.search("Text.Font")!=-1){ag="Collab.Text.Font";var S=Y.GetProperty(ag).GetPropertyValue();var J=X.FontPropertyForGUI(S);var N=X.UpdateMapForGUI(J,O);P=X.BuildNewValueForGUI(N)}}var ah=false;var W=Y.GetProperty(ag);if(W.GetPropertyValue()._bUndefined===true){var G=W.GetPropertyValue().ToString();if(P===G){ah=true}}var U=null;if(!ah){U=W.Clone();var af=U.GetPropertyValue();af.FromString(P)}if(ag==="Actor.Color"){var M=Y.GetProperty("Actor.Color.Defined");if(M&&M.GetPropertyValue().Value===false){var af=new C();af.Value=true;M.SetPropertyValue(af);V.ChangeProperty(Y,M)}}var H=Y.RequestModification(U);if(H){j=U._propertyInfo.GetGroupId();for(var R in H._map){if(H._map.hasOwnProperty(R)){var M=H._map[R];var T=M.GetPropertyValue().GetType();if(T==="VCXPropertyValueColor"||R==="Actor.Opacity"){V.ChangeProperty(Y,M);ab._currentPropSet._map[R]=M}else{V.ChangeProperty(Y,M)}ac++}}}}if(O.typePath==="fgx_color"){if(W){var K=W.GetPropertyValue().ToString();var Q=P;if(Q.substr(0,Q.lastIndexOf(","))===K.substr(0,K.lastIndexOf(","))){return}}else{return}}if(ac>0){aa.getManager("VCXCommandManager").Push(V)}}},_search:d.debounce(function(F){this._buttonOptions.callback(null,this._searchView.valueToCommit.toLowerCase())},500),createTabFrameAndSlidingViews:function(G){if(!(G&&G.sidePanelInfos&&G.slidingViewsTitles&&G.slidingViewsContainerIDs)){console.warn("Unable to create tree Panel");return}this.panelCreationOptions=G;this.options={};this.options._experienceBase=this._vcxGuiManager._experienceBase;if(this._vcxGuiManager.immersiveFrame){this.options.immersiveFrame=this._vcxGuiManager.immersiveFrame}this.options._uiLayer=this._vcxGuiManager._uiLayer;this.options.classBaseNameCSS=G.sidePanelInfos.classBaseNameCSS;this.options.sidePanel={title:G.sidePanelInfos.title,icon:G.sidePanelInfos.icon,side:G.sidePanelInfos.side,controller:this,usecallback:this.onresizePanel,currentDockArea:WUXDockAreaEnum.RightDockArea,};this.options.slidingViews={displayTabAtStart:1,disableSlindingMenu:1,activateViewOn:1,_vcxuiSequencesMaster:{},};this.options.slidingViews.views=[];for(var F=0;F<G.slidingViewsTitles.length;++F){var H=new UWA.Element("div",{id:G.slidingViewsContainerIDs[F],});this.options.slidingViews._vcxuiSequencesMaster[F+1]={};this.options.slidingViews._vcxuiSequencesMaster[F+1][G.slidingViewsTitles[F]]=H;this.options.slidingViews.views.push({title:G.slidingViewsTitles[F],content:{html:this.options.slidingViews._vcxuiSequencesMaster[1][G.slidingViewsTitles[F]],}})}this.options.recId="propertiesCtrlRec";this._tabPageFrame=new a(this.options);this.onCreateToolBarButtons(this.getFrame().getPanel());this.updateToolbar()},getFrame:function(){return this._tabPageFrame},updateToolbar:function(){},onCreateToolBarButtons:function(F){},unInitialize:function(){t.unsubscribe(this._tokenSelectionAdd);delete this._tokenSelectionAdd;t.unsubscribe(this._tokenSelectionRemove);delete this._tokenSelectionRemove;t.unsubscribe(this._tokenTimePosChanged);delete this._tokenTimePosChanged;t.unsubscribe(this._tokenPropertiesChanged);delete this._tokenPropertiesChanged;if(this.getFrame()){this.getFrame().unInitialize();delete this.getFrame()}this.treeList.getManager().removeEventListener(i.POINTERUP,b.WrappedCbkLink,false);this.treeList.getManager().unloadDocument();this.treeList=null;this._container.remove();if(this._hyperLinkBoxing){this._hyperLinkBoxing.unInitialize();this._hyperLinkBoxing=null}if(this._fontBoxing){this._fontBoxing.unInitialize();this._fontBoxing=null}delete b.PlayerMode;if(this.options){delete this.options}if(this._vcxGuiManager){delete this._vcxGuiManager}},stringifyValue:function(F){var G="";(this.toString()==="[object Object]")?G=JSON.stringify(this):G=this.toString();if(F!==undefined&&F!==""){G=F+": "+G}return G},setValue:function(H,F){var G=H.nodeModel.options;G.grid.data=H.value;G.grid[H.dataIndex]=H.value;if(H.value){G.label=F.stringifyValue.call(H.value,G.grid.propName)}H.manager.updateRowViewWithException(H.nodeModel,H.dataIndex)},changeCB:function(F){if(F.event&&F.event.dsModel){return F.event.dsModel.value}},GetSelectedProperties:function(){if(this.treeList){var J=[];var G=this.treeList.getManager().getSelectedRows();for(var H=0;H<G.length;H++){var F=G[H];var I=this.treeList.getManager().getCell(F,0).options.value.options.grid.propName;J.push(I)}return J}},getCID4Property:function(ai,L){L.propertyName=ai.propName;L.vcxValue=ai.std+"";if(ai.propName.endsWith(".Availability")){L.vcxValue=ai.std?3:4}else{if(ai.typePath&&ai.typePath.search&&ai.typePath.search("VCX_Prop_Enum_")!=-1){var ag=this._vcxGuiManager._experienceBase.getManager("VCXNLSManager");var X=ai.std;var Y=this._vcxGuiManager._vcxexperience.getManager("VCXSelectionManager").GetCurrentSelection();var ah=Y[0];var T={};var M=ah.GetProperty(L.propertyName);if(M){var Q=M.GetPropertyInfo();T=Q.GetMapChoiceEnum()}for(var aa in T){if(T.hasOwnProperty(aa)){var W=T[aa];var S=W;var G=S;if(ag){if(this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().noNLS!="1"){var K=ag.GetNLS(Q.GetNlsPath());if(K){G=K.getTitle({key:S,})}if(G===undefined){var ad=this._vcxGuiManager._experienceBase.getManager("VCXStylesManager");if(ad){var V=ad.GetModuleName();K=ag.GetNLS(V+"/"+V);if(K){G=K.getTitle({key:S,})}}}if(G===undefined){G=S}}}if(G===X){L.vcxValue=aa;break}}}}else{if(ai.typePath==="blob"){var H=E.dataURLToBlob(L.vcxValue);var N=window.URL.createObjectURL(H);var af=this._vcxGuiManager._experienceBase.getManager("VCXDocManager").BuildPathFromString(N);var ab=af.GetValueURL();var R=this._vcxGuiManager._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(af);L.vcxValue=R.GetValue()+""}else{if(ai.typePath==="fgx_color"){var J="#"+L.vcxValue;var O=new q();O.GetValue().FromHexString(J);var P=O.ToString();L.vcxValue=P}else{if(ai.typePath==="vector3"||ai.typePath==="vector2"){var F=[],U,Z=0;for(U in ai.std){if(ai.std.hasOwnProperty(U)){F[Z++]=ai.std[U]}}L.vcxValue="/"+F.join(",")+"/"}else{if(ai.typePath==="string"){if(ai.propName.includes("StipplingMotif")&&ai.std.length>0){if(ai.std===""+parseFloat(ai.std)){L.vcxValue=ai.std}else{var I=/\d+(?:\.\d+)?/g;var ae=ai.std.match(I);var ac=ae&&ae.map(function(aj){return parseFloat(aj)});if(ac){L.vcxValue=ac.join(" ")}else{L.vcxValue="0"}}}else{L.vcxValue=ai.std}}}}}}}},getProperty4CID:function(aa,O,U,ae,L,M){var af={};af.propName=U;af.data=ae;af.disabled=L;af.touch=false;var Q=aa.GetType();if(!this._tableMaping){this._tableMaping={};this._tableMaping.VCXPropertyValueFloat="float";this._tableMaping.VCXPropertyValueInt="integer";this._tableMaping.VCXPropertyValueBoolean="switch";this._tableMaping.VCXPropertyValueString=L?"string":"editor";this._tableMaping.VCXPropertyValueColor="fgx_color";this._tableMaping.VCXPropertyValueDate="date";this._tableMaping.VCXPropertyValuePoint="vector3";this._tableMaping.VCXPropertyValuePoint2D="vector2";this._tableMaping.VCXPropertyValueDocId=L?"string":"blob"}var I=this._tableMaping[Q];var H;if(Q==="VCXPropertyValueDocId"){if(L){af.data=""}else{var P=aa.GetValue();var J=this._vcxGuiManager._experienceBase.getManager("VCXDocManager").GetPropPath(P);if(J){var ab=J.GetValueURL();af.data=ab.GetValue();if(af.data.indexOf("data:")===-1){af.data="data:text/plain;base64,"+btoa("empty")}}else{af.data="data:text/plain;base64,"+btoa("empty")}}af.semantics={placeholder:"MyTest"}}if(Q==="VCXPropertyValueDate"){I="string";af.data=aa.ToString()}if(Q==="VCXPropertyValueColor"){if(L){I="color"}else{this.typeRepFactory.typeReps.fgx_color={detailedTemplate:"colorBar",stdTemplate:"color"};af.context="detailedTemplate";H=I}if(M){af.data=null}else{af.data="#"+aa.GetValue().GetColorHexString()}}if(Q==="VCXPropertyValueFloat"&&U.search("Opacity")!=-1){this.typeRepFactory.typeReps.gfx_transparency={stdTemplate:"slider",semantics:{minValue:0,maxValue:1,stepValue:0.1}};H="gfx_transparency";af.context="detailedTemplate";af.data=aa.GetValue()}if(Q==="VCXPropertyValueHyperlinkId"){I="boolean";af.data=aa.GetValue()}if(I===M){I=""}af.typePath=H||I;af.dataType=UWA.typeOf(af.data);if(Q==="VCXPropertyValueBoolean"){this.typeRepFactory.typeReps.VCXPropertyValueBoolean={stdTemplate:"switch"};af.typePath="boolean";af.data=aa.GetValue();af.dataType="boolean";af.touch=false}if(Q==="VCXPropertyValueString"){af.dataType="editor";af.context="inlinedTemplate"}if(Q==="VCXPropertyValuePoint"||Q==="VCXPropertyValuePoint2D"){af.data=aa.GetValue().clone()}if(O.GetMapChoiceEnum&&O.GetMapChoiceEnum()){var T=O.GetMapChoiceEnum();if(Object.keys(T).length!==0){af.dataType="string";var G="VCX_Prop_Enum_"+U.split(".").join("_");var W=[];var S=[];if(O){var ad=this._vcxGuiManager._experienceBase.getManager("VCXNLSManager");for(var Y in T){if(T.hasOwnProperty(Y)){var R=T[Y];var F=R;if(ad){if(this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().noNLS!="1"){var K=ad.GetNLS(O.GetNlsPath());if(K){F=K.getTitle({key:R,});if(F===M){var ac=this._vcxGuiManager._experienceBase.getManager("VCXStylesManager");if(ac){var X=ac.GetModuleName();K=ad.GetNLS(X+"/"+X);if(K){F=K.getTitle({key:R,})}}if(F===M){F=R}}}}}W.push(F);S[Y]=F}}this.typeRepFactory.typeReps[G]={stdTemplate:"comboSelector",semantics:{possibleValues:W,}}}af.data=S[aa.GetValue()];af.typePath=G}}if((I==="float"&&!(Q==="VCXPropertyValueFloat"&&U.search("Opacity")!=-1))||I==="integer"){af.data=aa.GetValue();af.dataType=UWA.typeOf(af.data);if(O.IsBounded&&O.IsBounded()){var N=O.GetBounds().step;var V=O.GetBounds().valueMin;var Z=O.GetBounds().valueMax;var G="VCX_Prop_Slider_"+I+"_"+V+"_"+Z+"_"+N*1000;if(N===Z){N/=10}this.typeRepFactory.typeReps[G]={stdTemplate:"slider",semantics:{minValue:V,maxValue:Z,stepValue:N}};af.typePath=G}else{if(af.dataType==="number"){var N=O===""?1:O.GetBounds().step;if(N){}else{N=0.1}var V=O===""?null:O.GetBounds().valueMin;var Z=O===""?null:O.GetBounds().valueMax;var G="VCX_Prop_Number";af.typePath=G;this.typeRepFactory.typeReps[G]={stdTemplate:"spinEdit",semantics:{minValue:V,maxValue:Z,stepValue:N}}}}}return af},onPropertiesChanged:function(){this.onCSOChange()},onCSOChange:function(){var G=this;var F=true;if(this._refreshTimer){window.clearTimeout(this._refreshTimer);this._refreshTimer=null;F=false;this._hasBeenOverloaded=true}if(F){this.onCSOChangeREAL();this._hasBeenOverloaded=false}this._refreshTimer=window.setTimeout(function(){window.clearTimeout(G._refreshTimer);G._refreshTimer=null;if(G._hasBeenOverloaded){G.onCSOChangeREAL()}},250)},onCSOChangeREAL:function(){var H=this;var ad=[];if(this._vcxGuiManager){ad=this._vcxGuiManager._vcxexperience.getManager("VCXSelectionManager").GetCurrentSelection()}else{return}if(ad.length===0){this.treeList.getDocument().prepareUpdate();this.treeList.getManager().empty();this._currentPropSet=null;this.modifyWhile=false}else{var am=this.BuildIntersection(ad).Clone();if(this._currentPropSet&&this._currentPropSet.IsEqualTo(am)||this.modifyWhile===true){return}else{this._currentPropSet=am}if(this._currentPropSet){if(this._vcxGuiManager._vcxexperience.ModifiablesAdvancedProperties){var Z=new w();Z.SetValue(ad.length);var U=new A("Selection.Count",1,false,"VCXWebModifiables/VCXWebModifiables");U.SetGroupId("Group.Introspection");var F=new x(U,Z);this._currentPropSet.AddOrModifyProperty(F)}}else{return}this.treeList.getDocument().prepareUpdate();this.treeList.getDocument().empty();var ao=c;var R={};var ae={};ae.name="none";ae.arrayProps=[];R.none=ae;var Y=null;for(var K in am._map){var aj=this._currentPropSet._map[K].GetPropertyValue();var U=this._currentPropSet._map[K].GetPropertyInfo();if(!aj||(aj&&(this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().propertiesNoFilter||aj.GetType()==="VCXPropertyValueVector"||aj.GetType()==="VCXPropertyValueAnchor"||aj.GetType()==="VCXPropertyValuePoint"||aj.GetType()==="VCXPropertyValueMap"))){continue}var S=K;var ah=this._vcxGuiManager._experienceBase.getManager("VCXNLSManager");if(ah){var aa=U.GetMetaPropertyDef();if(aa){var X=aa.GetDefaultLabel();if(X){S=X}}else{if(this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().noNLS!="1"){var ai=ah.GetNLS(U.GetNlsPath());if(ai){S=ai.getTitle({key:U.GetNLSID(),});if(S===undefined){S=K}}}}}var W=U.GetGroupId();if(W===""){W="none"}if(!(W in R)){var al="";var P=ah.GetNLS(U.GetNlsPathGroup());if(P&&W){al=P.getTitle({key:W,})}var ae={};ae.name=al;ae.arrayProps=[];R[W]=ae}var T=false;if(ad.length==1){T=this._vcxGuiManager._vcxexperience.getManager("VCXLinkedPropertyManager").IsLinkedAndNotInFollow(ad[0].GetObject().GetID(),K)?true:false}if(U.GetControlsGroupVisibility()&&U.IsVisible()){var af=aj.GetValue();R[W].checkbox=af;R[W].available=K}else{if(K==="Actor.Hyperlink"||K==="Collab.Text.Font"){var an=null;var ab=false;if(K==="Actor.Hyperlink"){an=this._hyperLinkBoxing.HyperlinkPropertyForGUI(aj);ab=!an.propertyAction.GetPropertyValue().GetValue();R[W].checkbox=an.propertyAction.GetPropertyValue().GetValue()}else{if(K==="Collab.Text.Font"){an=this._fontBoxing.FontPropertyForGUI(aj)}}var G=0;for(var O in an){if(O==="propertyAction"){continue}if(an.hasOwnProperty(O)){var ag=an[O];if(ag){var U=ag.GetPropertyInfo();var I=U.IsVisible();if(I){var M=ag.GetPropertyValue();var ai=ah.GetNLS(U.GetNlsPath());if(ai){S=ai.getTitle({key:U.GetPropertyName(),});if(S===undefined){S=U.GetPropertyName()}}var N=new o({label:S,grid:this.getProperty4CID(M,U,U.GetPropertyName(),M.ToString(),((G===0)?(false||T):ab)),modifiable:ad,link:T});R[W].arrayProps.push(N)}}}}}else{if(U.IsDefined()){var N=new o({label:S,grid:this.getProperty4CID(aj,U,K,aj.ToString(),b.PlayerMode||T),modifiable:ad,link:T});if(U.IsVisible()||this._vcxGuiManager._vcxexperience.odt==="record"){R[W].arrayProps.push(N)}}else{var ac=aj.Clone();var N=new o({label:S,grid:this.getProperty4CID(aj,"",K,"",b.PlayerMode||T,true),modifiable:"",link:T});if(U.IsVisible()||this._vcxGuiManager._vcxexperience.odt==="record"){R[W].arrayProps.push(N)}}}}}for(var V in R){var Q=R[V];var L=null;if(R[V].hide||((R[V].arrayProps.length===0)&&!("checkbox" in R[V]))){continue}else{if(V==="none"){L=this.treeList.getDocument()._getTrueRoot()}else{if(V==="Group.Actions"){L=new o({label:Q.name,grid:{typePath:"VCXPropertyValueBoolean",data:Q.checkbox,dataType:"switch",touch:true,propName:"Actor.Hyperlink_Action",},children:[],modifiable:ad,link:false})}else{if(Q.checkbox!=undefined){L=new o({label:Q.name,grid:{typePath:"VCXPropertyValueBoolean",data:Q.checkbox,dataType:"switch",touch:true,propName:Q.available,},children:[],modifiable:ad,link:false});if(!Q.checkbox){this.treeList.getDocument()._getTrueRoot().addChild(L);continue}}else{L=new o({label:Q.name,grid:{},modifiable:"",link:false})}}this.treeList.getDocument()._getTrueRoot().addChild(L);if(V===j){Y=L}}}for(var ak=0;ak<R[V].arrayProps.length;ak++){var J=R[V].arrayProps[ak];L.addChild(J);ao--}}}if(this._searchView.valueToCommit!==""){}if(ao>0){this.treeList.getDocument().expandAll()}if(Y!=null){Y.expandAll()}if(this._searchView.valueToCommit!==""){this._search()}this.treeList.getDocument().pushUpdate()},BuildIntersection:function(K){var H=[];for(var I=0;I<K.length;I++){var J=K[I];var G=J.GetProperties();if(G){H.push(G)}}var F=new v();F.Intersection(H);return F}});b.setValueStd=function(F){if(F.nodeModel){F.nodeModel.options.grid[F.dataIndex]=F.value;F.manager._preventNextUpdateView(F.virtualRowID)}};b.onCellRequestStd=function(G){return function F(H){b.generateCellView(H,G)}};b.onCellRequestLinkCB=function(H){if(H.nodeModel.options&&H.nodeModel.options.link===true){var G=new UWA.Element("div",{"class":"vcxPropertyButtonIconLink wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-link",});var F=H.cellView;F.getContent().setContent(G)}};b.generateCellView=function(K,G){var F=K.cellView;var I={readOnly:false,touchMode:false};if(K.nodeModel&&K.nodeModel.options){var H=K.nodeModel.options.grid;I.readOnly=0;I.readOnlyReal=H.disabled|=b.PlayerMode;I.touchMode=H.touch;if(I.popup===undefined){if(H.data===undefined){return}G.generateView(H.data,{context:H.context,typePath:H.typePath,readOnlyReal:I.readOnlyReal,readOnly:I.readOnly,touchMode:I.touchMode,semantics:H.semantics,onViewCreated:function(L,M){L.elements.container.setAttribute("data-rec-id",F.getCellInfos().nodeModel.options.grid.propName);if(L!==undefined){if(this.readOnlyReal){L.elements.internalView.disabled=true}F.getContent().setContent(L)}}})}else{var J=new n({label:"Edit..."});F.getContent().setContent(J)}}};b.WrappedCbkLink=function(N,S){if(!S||S.data.columnID!=3){return}var P=S.nodeModel.options.modifiable[0].GetObject()._experienceBase;var L=S.nodeModel.options.grid.propName;var O=[];var G=P.getManager("VCXSelectionManager").GetCurrentSelection();if(L.search("Text.Font")!=-1){L="Collab.Text.Font"}if(L.search("Hyperlink_")!=-1){L="Actor.Hyperlink"}var F=G[0].GetProperty(L);j=F.GetPropertyInfo().GetGroupId();var I=P.getManager("VCXStylesManager");if(I){var H=new D(P.getManager("VCXScenarioManager"),P.getManager("VCXCommandManager"),false);for(var K=0;K<G.length;K++){var R=new B();R.SetValue("");var M=new A("Modifiable.StyleID",A.EBehaviorType.Singleton,true,"VCXWebModifiables/VCXWebModifiables");var J=new x(M,R);H.ChangeProperty(G[K],J)}P.getManager("VCXCommandManager").Push(H)}S.cellView.elements.container.style.display="none";if(S.manager.getCellModel(S.data.rowID,1)){var T=S.manager.getCellModel(S.data.rowID,1).getView();var Q=T.getCellInfos();Q.nodeModel.options.grid=P.getManager("VCXGUIManager")._vcxPropertiesCtrl.getProperty4CID(F.GetPropertyValue(),F.GetPropertyInfo(),L,F.GetPropertyValue().ToString(),false);S.manager.getCellModel(S.data.rowID,1).getView().updateView()}};return b});var VCXThumbnailDisplayModeEnum={List:0,Small:1,Big:2,Extended:3};define("DS/VCXWebGUI/VCXScenarioCtrlExt",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/VCXWebGUI/VCXUISequence","DS/VCXKeyFramer/VCXScenario","DS/VisuEvents/EventsManager","DS/Controls/ThumbnailView","DS/WebappsUtils/WebappsUtils","DS/VCXWebGUI/VCXTabPageFrame","DS/Layouts/GridEngine","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisualization/VCXPublishRasterImage","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebSequenceManager/VCXCmdChangeScenarioSequence","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyInfo",],function(o,j,k,h,i,b,n,m,d,a,c,f,g,s,t,u,e,l,q,p){var r=o.extend({onresizePanel:function(F,v){var B=0;var C=0;var y;var w=0;for(y in F._thumbnailsList){var A=F._thumbnailsList[y];if(A.length>C){C=A.length;w=y}}var z;if(C>0){var x=F.getThumbnailDisplaySize()[0]+15;z=Math.floor(v/x);B=z*x}if(C>=z){for(var D in F._sequenceContent){var E=F._sequenceContent[D];if(E){E.style.width=B+"px"}}}F.updateToolbar()},isIE11:function(){return this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isIE11()},getItemDisplaySize:function(){var x=this.getThumbnailDisplaySize();var w=x[0];var v=x[1];switch(this._displayMode){case VCXThumbnailDisplayModeEnum.List:return[w*0.7+50,v*0.7];case VCXThumbnailDisplayModeEnum.Small:return[w,v];case VCXThumbnailDisplayModeEnum.Big:return[w*2,v*2];case VCXThumbnailDisplayModeEnum.Extended:return[w*2+50,v]}},getThumbnailDisplaySize:function(){return[165,118]},init:function(y,A,E){var B=this;if(E){this.playerMode=E}else{this.playerMode=false}this._displayMode=VCXThumbnailDisplayModeEnum.Small;this._vcxGuiManager=y;this._sequenceContent={};this._thumbnailsList={};this.options={};this.options._experienceBase=this._vcxGuiManager._experienceBase;if(this._vcxGuiManager.immersiveFrame){this.options.immersiveFrame=this._vcxGuiManager.immersiveFrame}this.options._uiLayer=this._vcxGuiManager._uiLayer;this.options.classBaseNameCSS="vcx-scenarios-";var w={iconName:"render",fontIconFamily:WUXManagedFontIcons.Font3DS};this.options.sidePanel={title:"Scenarios",icon:w,side:"left",minWidth:271,styles:{height:"100%",},controller:this,usecallback:this.onresizePanel,currentDockArea:1<<2};this.options.slidingViews={displayTabAtStart:1,activateViewOn:1,_vcxuiSequencesMaster:{}};this.options.onResizeCb=this.onResize;this.options.slidingViews.views=[];var D=1;for(var z=0;z<A.length;z++){this.options.slidingViews._vcxuiSequencesMaster[D]={};this.options.slidingViews._vcxuiSequencesMaster[D][A[z]]=new i(this._vcxGuiManager._vcxexperience,this);D++;this.options.slidingViews.views.push({title:A[z],content:{html:B.options.slidingViews._vcxuiSequencesMaster[z+1][A[z]],iframe:false}})}this.options.recId="scenarioCtrlRec";this._tabPageFrame=new a(this.options);this._tabPageFrame._header.addClassName("vcxNoMenu");this.onCreateToolBarButtons(this.getFrame().getPanel());this.updateToolbar();this._bSelectionMode=false;this._activeSequence=null;this._currentScenarioId=null;if(this.options.immersiveFrame){this.getFrame().getPanel().style.minHeight="100%";this.getFrame().getPanel().style.minWidth="271px";this.getFrame().getPanel().style.width="271px"}else{this.getFrame().getPanel().elements.content.style.minHeight="100%";this.getFrame().getPanel().elements.panel.style.minWidth="271px";this.getFrame().getPanel().elements.panel.style.width="271px"}var C=B._vcxGuiManager._vcxexperience;var x=C.getManager("VCXSequenceManager");this.onResizeCB=function(){var F=C.getManager("VCXScenarioManager").GetScenarios()[B._currentScenarioId];B.ChangeTimelinePosition(F,B._currentScenarioId)};if(window.attachEvent){this._tokenResize=window.attachEvent("onresize",this.onResizeCB)}else{if(window.addEventListener){this._tokenResize=window.addEventListener("resize",this.onResizeCB,true)}}this._tokenCreateThumb=k.subscribe({event:"VCX_CREATE_THUMBNAIL"},function(F){B.onCreateThumbnail(B,F)});this._tokenScChanged=k.subscribe({event:"VCX_SCENARIO_CHANGED"},function(F){B.onScenarioChanged(B,F)});this._tokenScMoved=k.subscribe({event:"VCX_SCENARIO_MOVED"},function(F){B.onScenarioMoved(B,F)});this._tokenCurrentScenario=k.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(F){B.onCurrentScenarioChanged(F.GetID(),F)});this._tokenBeginTrans=k.subscribe({event:"VCX_BEGIN_TRANSITION"},function(F){document.body.addClassName("waiting");B.onCurrentScenarioChanged(F.scenario._ID,F.scenario);B.onBeginEndTransition(B,F)});this._tokenBeginEndTrans=k.subscribe({event:"VCX_END_TRANSITION"},function(F){var G={};G.maxframe=F||0;B.onBeginEndTransition(B,G);document.body.removeClassName("waiting")});this._tokenSeqNameChanged=k.subscribe({event:"VCX_SEQUENCE_NAME_CHANGED"},function(F){B.onSequenceNameRefresh(B,F)});this._tokenScenarioNameChanged=k.subscribe({event:"VCX_SCENARIO_NAME_CHANGED"},function(F){B.onScenarioNameRefresh(B,F)});this._tokenScenarioReplaced=k.subscribe({event:"VCX_SCENARIO_REPLACED"},function(F){B.onScenarioReplaced(F.GetID(),F)});this._tokenSeqChanged=k.subscribe({event:"VCX_SEQUENCE_CHANGED"},function(F){B.onSequenceChanged(B,F)});this._tokenRefreshIcon=k.subscribe({event:"VCX_REFRESH_ICON"},function(F){B.RefreshAnimIcon(B,F)});this.addImmersiveUIArrows();var v=this._vcxGuiManager.GetDisplayScenarioImmersiveUI();this.setImmersiveUIState(v)},unInitialize:function(){window.focus();for(var x in this._sequenceContent){var v=this._sequenceContent[x];if(v.cbonPrimaryPointerUpUnique){n.removeEventFromToken(v.cbonPrimaryPointerUpUnique)}v.removeEvent("dragend");v.removeEvent("dragover");if(v.grid){v.grid.onCellRequest(null)}}for(var x in this._thumbnailsList){var v=this._thumbnailsList[x];for(var w=0;w<v.length;w++){var y=v[w];if(y._pointerDownToken){n.removeEventFromToken(y._pointerDownToken);y._pointerDownToken=null}if(y._pointerUpToken){n.removeEventFromToken(y._pointerUpToken);y._pointerUpToken=null}if(y.cbdragstart){y.elements.picture.removeEventListener("dragstart",y.cbdragstart);y.cbdragstart=null}if(y.cbdragenter){y.elements.picture.removeEventListener("dragenter",y.cbdragenter);y.cbdragenter=null}if(y.cbdragend){y.elements.picture.removeEventListener("dragend",y.cbdragend);y.cbdragend=null}if(y.cbdragover){y.elements.picture.removeEventListener("dragover",y.cbdragover);y.cbdragover=null}if(y.cbCheckBoxChange){y.elements.checkbox.removeEventListener("change",y.cbCheckBoxChange);y.cbCheckBoxChange=null}if(y.cbEditScenario){y.elements.container.removeEventListener("keydown",y.cbEditScenario,true);y.elements.picture.removeEventListener("keydown",y.cbEditScenario,true);y.cbEditScenario=null}if(y.cbOnClickScenario){y.elements.container.removeEventListener("click",y.cbOnClickScenario);y.elements.title.removeEventListener("click",y.cbOnClickScenario);y.cbOnClickScenario=null}}}this._sequenceContent=[];this._thumbnailsList=[];k.unsubscribe(this._tokenCreateThumb);delete this._tokenCreateThumb;k.unsubscribe(this._tokenScChanged);delete this._tokenScChanged;k.unsubscribe(this._tokenScMoved);delete this._tokenScMoved;k.unsubscribe(this._tokenCurrentScenario);delete this._tokenCurrentScenario;k.unsubscribe(this._tokenScenarioReplaced);delete this._tokenScenarioReplaced;k.unsubscribe(this._tokenBeginTrans);delete this._tokenBeginTrans;k.unsubscribe(this._tokenBeginEndTrans);delete this._tokenBeginEndTrans;k.unsubscribe(this._tokenSeqNameChanged);delete this._tokenSeqNameChanged;k.unsubscribe(this._tokenScenarioNameChanged);delete this._tokenScenarioNameChanged;k.unsubscribe(this._tokenSeqChanged);delete this._tokenSeqChanged;k.unsubscribe(this._tokenRefreshIcon);delete this._tokenRefreshIcon;if(this._vcxGuiManager._vcxTimeline){this.getFrame().getFooter().removeChild(this._vcxGuiManager._vcxTimeline.getView().getContainer());this._vcxGuiManager._vcxTimeline.unInitialize();this._vcxGuiManager.RemoveTimelineEvents();this._vcxGuiManager._vcxTimeline=null}if(this._vcxGuiManager._vcxTimelineMain){this._vcxGuiManager._vcxTimelineMain.unInitialize();this._vcxGuiManager._vcxTimelineMain=null}if(window.attachEvent){window.detachEvent(this._tokenResize);delete this._tokenResize}else{if(window.addEventListener){window.removeEventListener("resize",this.onResizeCB,true);delete this._tokenResize}}this.onResizeCB=null;this._UIpreviousScenario.removeEventListener(h.POINTERDOWN,this.pointerDownOnCommandGoToPreviousScenarioCB);this._UInextScenario.removeEventListener(h.POINTERDOWN,this.pointerDownOnCommandGoToNextScenarioCB);this._UI_dot_Container.remove();this._UIpreviousScenario.remove();this._UInextScenario.remove();this.getFrame().unInitialize()},getFrame:function(){return this._tabPageFrame},updateToolbar:function(){this.getFrame().getToolbar().updateToolbar()},onCreateToolBarButtons:function(B){var E=this;var A=this.getFrame().getToolbar();var v=this._vcxGuiManager._vcxexperience.getManager("VCXContextManager").getCityMode();if(this.playerMode||v){A.addMainItemFixed("VCXPlayGuidedTourCmd","","vcxToolbarButtonIconChecked","VCXWebProducts/VCXWebProducts",null,null,"VCX_PLAY_GUIDED_TOUR_START","VCX_PLAY_GUIDED_TOUR_END",true)}if(!this.playerMode){A.addMainItemFixed("VCXCreateScenarioCmd","","vcxToolbarButton vcxToolbarButtonAdd","VCXWebAuthoringCommands/VCXWebAuthoringCommands");var x=[];x[0]=this;x[1]=this.setVisibilityAllChexkBox;x[2]=true;A.addMainItemFixed(x,"","vcxToolbarButton vcxToolbarButtonSelect","VCXWebGUICommands/VCXWebGUICommands",null,"VCXSetVisibilityAllChexkBoxCmd");A.addMainItem("VCXCreateSequenceCmd","","vcxToolbarButton vcxToolbarButtonFolder","VCXWebAuthoringCommands/VCXWebAuthoringCommands");if(this._vcxGuiManager._vcxexperience.getManager("VCXContextManager").getCityMode()){}else{A.addMainItem("VCXDisplayTimelineCmd","","vcxToolbarButton vcxToolbarButtonTimeline","VCXWebAuthoringAppGUICommands/VCXWebAuthoringAppGUICommands")}A.addMainItemFixed("VCXDeleteSelectionCmd","","vcxToolbarButton vcxToolbarButtonDelete","VCXWebAuthoringCommands/VCXWebAuthoringCommands",A.getEditToolbar());A.addMainItemFixed("VCXReplaceScenarioCmd","","vcxToolbarButton vcxToolbarButtonUpdate","VCXWebAuthoringCommands/VCXWebAuthoringCommands",A.getEditToolbar())}var C=function(I){var H=E._vcxGuiManager.GetDisplayScenarioImmersiveUI();I=!H;A.setItem("vcxToolbarButton vcxToolbarButtonImmersiveUI Checked",I);var J=new q(I);var G=new l(new p("GUIManager.DisplayScenarioImmersiveUI",2),J);var F=E._vcxGuiManager.QueryInterface("VCXIModifiable");var K=new s(E._vcxGuiManager._vcxexperience.getManager("VCXScenarioManager"),E._vcxGuiManager._vcxexperience.getManager("VCXCommandManager"),true);K.ChangeProperty(F,G);E._vcxGuiManager._vcxexperience.getManager("VCXCommandManager").Push(K)};var z=function(F){E.activateDisplayStyle(F)};var D=E._vcxGuiManager._experienceBase.getManager("VCXNLSManager");if(D){var w=D.GetNLS(["VCXWebGUI/VCXWebGUI"]);if(w){A.addSubItemFixed(C,"","vcxToolbarButton vcxToolbarButtonImmersiveUI Checked","",w.getTitle({key:"VCXScenario.DisplayImmersiveUI",}));A.activeItem("vcxToolbarButton vcxToolbarButtonImmersiveUI");A.addSubItemFixed(z,"","vcxToolbarButton vcxToolbarButtonDisplayList","",w.getTitle({key:"VCXScenario.Display.List",}));A.addSubItemFixed(z,"","vcxToolbarButton vcxToolbarButtonDisplaySmall","",w.getTitle({key:"VCXScenario.Display.Small",}));A.addSubItemFixed(z,"","vcxToolbarButton vcxToolbarButtonDisplayLarge","",w.getTitle({key:"VCXScenario.Display.Large",}));A.addSubItemFixed(z,"","vcxToolbarButton vcxToolbarButtonDisplayTile","",w.getTitle({key:"VCXScenario.Display.Tile",}))}}A.addMenu("","vcxToolbarButtonStarterMenuRight","vcxToolbarButton vcxToolbarButtonMenu","","MENU");A.addMenu("","vcxToolbarButtonStarterMenuRight","vcxToolbarButton vcxToolbarButtonLayout","VCXWebGUI/VCXWebGUI","VCXScenarioToolbarDisplayLayout");var y=[];y[0]=this;y[1]=this.setThumbnailCheckBox;y[2]=false;A.addMenu(y,"vcxToolbarButtonStarterMenuRight vcxToolbarButtonStarterMenuRightEdit","vcxToolbarButton vcxToolbarButtonExit","VCXWebGUI/VCXWebGUI","VCXScenarioToolbarExit",A.getEditToolbar());A.activeSubItemFixed("vcxToolbarButton vcxToolbarButtonDisplaySmall")},activateDisplayStyle:function(v){this.getFrame().getToolbar().activeSubItemFixed("vcxToolbarButton vcxToolbarButtonDisplay"+v);this.getFrame().getPanel().removeClassName("vcx-displayTile");this.getFrame().getPanel().removeClassName("vcx-displayList");this.getFrame().getPanel().removeClassName("vcx-displayLarge");this.getFrame().getPanel().addClassName("vcx-display"+v)},loadScenariosFromExperience:function(){var x=this;var v=x._vcxGuiManager._vcxexperience;var w=v.getManager("VCXSequenceManager").GetListSequences();x.addSequences(x,w)},addSequences:function(w,y){for(var x=0;x<y.length;x++){var z=y[x];var v=x-1;w.createSequence(z,v,w)}},getUISequenceTarget:function(z){for(var y in this.options.slidingViews._vcxuiSequencesMaster){for(var x in this.options.slidingViews._vcxuiSequencesMaster[y]){if(z===x){return this.options.slidingViews._vcxuiSequencesMaster[y][x]}else{var w=x.split("|");for(var v in w){if(z===w[v]){return this.options.slidingViews._vcxuiSequencesMaster[y][x]}}}}}return this.options.slidingViews._vcxuiSequencesMaster[1][Object.keys(this.options.slidingViews._vcxuiSequencesMaster[1])[0]]},getUISequenceIndex:function(x,y){var w=0;for(w in x.elements.items){var v=x.elements.items[w].childNodes[0].childNodes[1].innerHTML;if(v===y){break}}return w},createSequence:function(z,x,I){var G=z.GetID();var J=z.GetName();if(J==="CAD Captures"||J==="CAD Views"){I._tabPageFrame._header.removeClassName("vcxNoMenu")}var D=x+1;var y=this.getUISequenceTarget(J);if(D===0){D=y.itemLength}y.addItem(D,{text:J});var A=I._sequenceContent[G]=new UWA.Element("div",{"class":"VCX container-fluid hidden-print vcx-fluid-content",html:[]});A.sequenceIndex=D;y.setContent(D,A);A.addEvent("dragover",function(L){if(!L.target.hasClassName("VCX container-fluid")){return}var K="";if(I.amIBefore(I.dragged.elements.container,I.dropTarget)){K="afterend"}else{K="beforeBegin"}if(I.dropTarget&&I.isThereBrotherAround(L)){}else{I.dropSequence=I.getSequenceDrop(L);I.dropTarget=I.getLastThumnbailFromSequence(I.dropSequence);K="afterend"}I.dropTarget.elements.container.insertAdjacentElement(K,I.dragged.elements.container);L.preventDefault()});A.addEvent("dragend",function(N){var K=I._vcxGuiManager._experienceBase;var M=K.getManager("VCXSequenceManager").GetSequenceFromScenarioId(I.dragged.scenarioID);var P="";if(M){P=M.GetID()}var O=-1;if(I.dropTarget){I.dropSequence=I.dropTarget.elements.container.parentNode.getAttribute("sequenceid");O=Array.prototype.indexOf.call(I.dropTarget.elements.container.parentNode.children,I.dragged.elements.container)}else{}I.moveScenarioView(I.dragged.scenarioID,P,I.dropSequence,O);var L=new e(K.getManager("VCXSequenceManager"),K.getManager("VCXCommandManager"),K.ComponentsMap);L.MoveScenario(I.dragged.scenarioID,I.dropSequence,O);K.getManager("VCXCommandManager").Push(L)});var H=y.elements.items[D];H.sequenceId=G;var w=H.getElementsByClassName("VCXUISequence-title")[0];H.counterThumbs=new UWA.Element("div",{html:"0","class":"VCXcounterThumbs",styles:{},});H.counterThumbs.inject(w);if(y.itemLength===1){y.elements.container.childNodes[0].childNodes[0].style.opacity="0";y.elements.container.childNodes[0].childNodes[0].style.marginBottom="-15px"}else{y.elements.container.childNodes[0].childNodes[0].style.opacity="";y.elements.container.childNodes[0].childNodes[0].style.marginBottom=""}I.activeSequence(H);A.cbonPrimaryPointerUpUnique=n.addEvent(A.parentNode,"onPrimaryPointerUpUnique",function(){I.activeSequence(H)});A.sequenceID=G;A.setAttribute("SequenceID",G);var C=I._vcxGuiManager._vcxexperience.getManager("VCXScenarioManager").GetScenarios();var v=z.GetListScenariosId();var B=I._thumbnailsList[G]=[];for(var F=0;F<v.length;F++){var E=v[F];I.createScenarioView(C[E],I,z.GetID(),F)}this.setSequenceState(J,true);A.grid=new c({model:I._thumbnailsList[G],defaultCellWidth:300,defaultCellHeight:200,showRowsHeader:true,showColumnsHeader:true,headersDimensions:{width:20,height:20}});A.grid.onCellRequest(function(N,K){var M=N.virtualColumnID;if(K._thumbnailsList[M]){var L=K._thumbnailsList[M];N.cellView.getContent().setHTML(L)}})},createScenarioView:function(L,K,w,R){var N=K._vcxGuiManager._vcxexperience;var A=N.getManager("VCXSequenceManager");if(w){}else{var I=N.getManager("VCXSequenceManager").GetListSequences();w=I[0].GetID()}var P=0;if(R!==-1){P=R}var Q=this._thumbnailsList[w];var v=Q[P];var D=false;if(v){if(v.scenarioID&&v.scenarioID!==L.GetID()){}else{D=true;return}}if(!D){v=K.createThumbnailView(L,K,w,R)}var K=this;if(K.playerMode){v.elements.picture.draggable=false}else{v.elements.picture.draggable=true}v.cbdragstart=function(S){if(!this.draggable){S.preventDefault();S.stopPropagation();return}K.dropTarget=v;K.dragged=v;K.dragged.elements.container.classList.add("vcxDrag")};v.elements.picture.addEventListener("dragstart",v.cbdragstart,false);v.cbdragenter=function(T){K.dropTarget=v;T.preventDefault();if(K.dragged===undefined){K.dragged=v}if(K.dragged.elements.picture===T.toElement){return}var S="";if(K.amIBefore(K.dragged.elements.container,v.elements.container)){S="afterend"}else{S="beforeBegin"}v.elements.container.insertAdjacentElement(S,K.dragged.elements.container);K.dropTarget=v};v.elements.picture.addEventListener("dragenter",v.cbdragenter,false);v.cbdragover=function(S){if(!this.draggable){S.preventDefault();S.stopPropagation();return}S.stopPropagation();S.stopImmediatePropagation();S.preventDefault()};v.elements.picture.addEventListener("dragover",v.cbdragover,false);v.cbdragend=function(S){K.dragged.elements.container.classList.remove("vcxDrag")};v.elements.picture.addEventListener("dragend",v.cbdragend,false);var B=L.GetName();v.setTitle(B);v.scenarioID=L.GetID();v.scenarioIndex=P;v.elements.thumbnail._scenarioID=L.GetID();if(L.HasAnimation()){v.elements.title.style.left="30px !important";v.elements.subtitle.style.left=v.elements.title.style.left;v.elements.icon.addClassName("hasAnimation")}var M=null;var H=L.GetDocId();var z=N.getManager("VCXDocManager").GetPropPath(H);if(z){var C=z.GetValueURL();M=C.GetValue()}if(B==="Animation smg"){v.setPicture(d.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png"))}else{if(M){var E=new XMLHttpRequest();E.open("GET",M,true);E.responseType="blob";E.onload=function(U){if(this.status==200){var T=this.response;var S=new FileReader();S.onload=function(V){v.setPicture(V.target.result)};S.readAsDataURL(T)}};E.send()}else{if(L.GetScenarioType()===b.EScenarioType.CADView){v.setPicture(d.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_CADViews.png"))}else{if(L.GetScenarioType()===b.EScenarioType.CADCapture){v.setPicture(d.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_CADCaptures.png"))}else{if(L.GetScenarioType()===b.EScenarioType.Layer){v.setPicture(d.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Layer.png"))}else{this.onScenarioReplaced(L.GetID(),L)}}}}}var x=this._vcxGuiManager._vcxexperience.getManager("VCXSequenceManager");var G=x.GetSequenceFromId(w);var y=G.GetName();var F=this.getUISequenceTarget(y);var O=this._vcxGuiManager._vcxexperience.getManager("VCXContextManager").getShowRoomMode();if(O){}else{K.targetInteraction=null;v._pointerDownToken=n.addEvent(v.elements.container,"onPrimaryPointerDownUnique",function(T){var S=F.elements.items[K._sequenceContent[w].sequenceIndex];v.elements.checkbox.elements.container.focus()});v.cbEditScenario=function(S){if(S.key==="F2"){if((L.GetID()===K._currentScenarioId)||(v.elements.container.hasClassName("vcxItemSelected"))){setTimeout(function(){console.log("F2");v.elements.title.focus()},0)}}};v.cbOnClickScenario=function(X){var Z=function(ab){var aa=(X.path&&X.path[0])||X.currentTarget;if(aa.hasClassName("vcx-controls-thumbnail-title")){return}K.endRenameScenario();document.removeEventListener(h.POINTERDOWN,Z);document.removeEventListener("keydown",U)};var U=function(aa){if(aa.key==="Enter"){K.endRenameScenario();document.removeEventListener(h.POINTERDOWN,Z);document.removeEventListener("keydown",U);v.elements.title.contentEditable=false;v.elements.title.contentEditable=true}else{if(aa.key==="Escape"){K.endRenameScenario(true);document.removeEventListener(h.POINTERDOWN,Z);document.removeEventListener("keydown",U)}}};var Y=(X.path&&X.path[0])||X.currentTarget;if(Y.hasClassName("vcx-controls-thumbnail-title")&&!K.playerMode&&((L.GetID()===K._currentScenarioId)||(v.elements.container.hasClassName("vcxItemSelected")))){document.addEventListener(h.POINTERDOWN,Z);document.addEventListener("keydown",U);K.startEditScenarioID=L.GetID();return}if(K.startEditScenarioTitle!==""){K.endRenameScenario();document.removeEventListener(h.POINTERDOWN,Z);document.removeEventListener("keydown",U)}X.preventDefault();X.stopImmediatePropagation();X.stopPropagation();var Y=X.target;K.targetInteraction=Y;if(!K.targetInteraction||K.targetInteraction!=Y){K.targetInteraction=null;return}if(X&&X.gesture&&X.gesture.currentEvent[0]&&X.gesture.currentEvent[0].currentPosition.distanceTo(X.gesture.currentEvent[0].startPosition)>8){K.targetInteraction=null;return}if(Y.hasClassName("wux-ui-fa")||Y.hasClassName("vcx-controls-checkbox")){K.targetInteraction=null;return false}K.targetInteraction=null;K.activeSequence(F.elements.items[K._sequenceContent[w].sequenceIndex]);var W=L.GetID();var S=L;if(K.getFrame().getToolbar().isEditMode()){v.elements.checkbox.toggle()}else{if(K._vcxGuiManager.GoToScenarioContext()){K.setVisibilityAllChexkBox(false);K.onCurrentScenarioChanged(W,L);if(K._vcxGuiManager._vcxexperience.getManager("VCXContextManager").getUrlVars().DSWebRecord!==undefined){var V="DS/WebRecordEnabler/Adapter";require([V],function(aa){aa.TraceManager.debug("ADD document.waitConditionScenario");document.waitConditionScenario=aa.WaitManager.addWaitCondition(20*1000,"Wait go to scenario");K._vcxGuiManager._vcxexperience.getManager("VCXAPIManager").GoToScenario(W,function(){aa.TraceManager.debug("REMOVE document.waitConditionScenario");aa.WaitManager.removeWaitCondition(document.waitConditionScenario);document.waitConditionScenario=null})})}else{K._vcxGuiManager._vcxexperience.getManager("VCXAPIManager").GoToScenario(W)}if(K._vcxGuiManager._vcxTimelineExtCtrl&&K._vcxGuiManager._vcxTimelineExtCtrl._mainPanel){var T=K._vcxGuiManager._vcxTimelineExtCtrl._mainPanel.style.display;K._vcxGuiManager._uiLayer.removeChild(K._vcxGuiManager._vcxTimelineExtCtrl._mainPanel);K._vcxGuiManager.InitTimelineExtCtrl(W);K._vcxGuiManager._vcxTimelineExtCtrl._mainPanel.style.display=T}}}};v.elements.container.addEventListener("click",v.cbOnClickScenario);v.elements.title.addEventListener("click",v.cbOnClickScenario);v.elements.container.addEventListener("keydown",v.cbEditScenario,true);v.elements.picture.addEventListener("keydown",v.cbEditScenario,true);var J=F.elements.items[K._sequenceContent[w].sequenceIndex];J.counterThumbs.innerHTML=parseInt(J.counterThumbs.innerHTML)+1}},endRenameScenario:function(D){if(D){for(var z in this._thumbnailsList){var A=this._thumbnailsList[z];for(var y=0;y<A.length;y++){var v=A[y];if(v.scenarioID===this.startEditScenarioID){var E=this._vcxGuiManager._vcxexperience.getManager("VCXScenarioManager").GetScenarios()[v.scenarioID].QueryInterface("VCXIModifiable");var C=E.GetProperty("Actor.Name");var B=C.GetPropertyValue().GetValue();v.elements.title.innerHTML=B;this.startEditScenarioID="";return}}}}else{for(var z in this._thumbnailsList){var A=this._thumbnailsList[z];for(var y=0;y<A.length;y++){var v=A[y];if(v.scenarioID===this.startEditScenarioID){var w=v.elements.title.innerHTML;var x=new s(this._vcxGuiManager._vcxexperience.getManager("VCXScenarioManager"),this._vcxGuiManager._vcxexperience.getManager("VCXCommandManager"));var E=this._vcxGuiManager._vcxexperience.getManager("VCXScenarioManager").GetScenarios()[v.scenarioID].QueryInterface("VCXIModifiable");var C=E.GetProperty("Actor.Name");C.GetPropertyValue().SetValue(w);x.ChangeProperty(E,C);this._vcxGuiManager._vcxexperience.getManager("VCXCommandManager").Push(x);this.startEditScenarioID="";return}}}}},isThereBrotherAround:function(z){var C=20;var B=[{x:C,y:C},{x:C,y:-C},{x:-C,y:-C},{x:-C,y:C}];var y=z.clientX;var w=z.clientY;var v=null;for(var x in B){var A=B[x];y+=A.x;w+=A.y;v=document.elementsFromPoint(y,w)[0];if(v&&(v.hasClassName("vcx-controls-thumbnail-picture")||v.hasClassName("vcx-controls-thumbnail-title"))){return this.getThumbnailFromDiv(v)}}return null},getSequenceDrop:function(v){for(var w in this._sequenceContent){if(this._sequenceContent[w]===v.target){return w}}},getLastThumnbailFromSequence:function(w){var v=this._vcxGuiManager._vcxexperience.getManager("VCXSequenceManager");var y=v.GetSequenceFromId(w);var x=y.GetListScenariosId();var C=x.slice(-1)[0];for(var A in this._thumbnailsList){var D=this._thumbnailsList[A];for(var z=0;z<D.length;z++){var B=D[z];if(B.scenarioID===C){return B}}}return null},getThumbnailFromDiv:function(z){for(var x in this._thumbnailsList){var v=this._thumbnailsList[x];for(var w=0;w<v.length;w++){var y=v[w];if(y.elements.picture===z||y.elements.title===z){return y}}}return null},amIBefore:function(x,v){var w=v;while(w=w.previousElementSibling){if(w===x){return true}}return false},RefreshAnimIcon:function(v,y){var w=v._vcxGuiManager._vcxexperience.getManager("VCXSequenceManager");var B=w.GetSequenceFromScenarioId(y.GetID());var x=B.GetIndexOfScenario(y.GetID());var z=v._thumbnailsList[B.GetID()];var A=z[x];if(y.HasAnimation()){A.elements.title.style.left="30px !important";A.elements.subtitle.style.left=A.elements.title.style.left;A.elements.icon.addClassName("hasAnimation")}},RefreshTimeline:function(w,y){var x=document.getElementsByClassName("wux-windows-docking-element-collapser wux-docking-element-left")[0].clientHeight-54-2;this._vcxGuiManager.deleteTimeline();if(w&&w.HasAnimation()){this.getFrame().getContent().style.maxHeight=(x-61)+"px";this.getFrame().getFooter().style.height="50px";this.getFrame().getFooter().style.visibility="visible";var z=this._vcxGuiManager._vcxexperience.getManager("VCXScenarioManager").GetCurrentFrame();this._vcxGuiManager.InitTimelineCtrl(y,z);if(this._vcxGuiManager._vcxTimelineCtrl._timelines&&this._vcxGuiManager._vcxTimelineCtrl._timelines[1]){var v=this._vcxGuiManager._vcxTimelineCtrl._timelines[1].timeline.getView().getParentPanel().currentDockArea;this._vcxGuiManager._vcxTimelineCtrl.options.frmWindow.getImmersiveFrame().getDockingElement(v).collapseDockingZoneFlag=false}this._vcxGuiManager._forceDisplayTimeline=true}else{this.getFrame().getContent().style.maxHeight=x+"px";this.getFrame().getFooter().style.height="0px";this.getFrame().getFooter().style.visibility="hidden"}},ChangeTimelinePosition:function(v,x){var w=document.getElementsByClassName("wux-windows-docking-element-collapser wux-docking-element-left")[0].clientHeight-54-2;if(v&&v.HasAnimation()){var y=this._vcxGuiManager._vcxexperience.getManager("VCXScenarioManager").GetCurrentFrame();if(this._vcxGuiManager._vcxTimelineCtrl===null){this._vcxGuiManager.InitTimelineCtrl(x,y)}this.getFrame().getContent().style.maxHeight=(w-61)+"px";this.getFrame().getFooter().style.height="50px";this.getFrame().getFooter().style.visibility="visible"}else{this.getFrame().getContent().style.maxHeight=w+"px";this.getFrame().getFooter().style.height="0px";this.getFrame().getFooter().style.visibility="hidden"}},onCreateThumbnail:function(I,A){var D=I._vcxGuiManager._vcxexperience;var C=A.scenario;var G=A.sequenceId;var y=parseInt(A.prevIndex);var F=I._thumbnailsList[G];var B=F[y+1];I.createThumbnailView(C,I,G,y,B);B=F[y+1];if(C._name&&C._name==="Animation smg"){B.setPicture(d.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png"))}else{var w=I.capturePixels();var v=u.dataURLToBlob(w);var E=window.URL.createObjectURL(v);if(B){B.setPicture(w);var H=E;var x=D.getManager("VCXDocManager").BuildPathFromString(H);var J=D.getManager("VCXDocManager").AddOrModifyDoc(x);var z=C.QueryInterface("VCXIModifiable");C.SetDocId(J._value);D.getManager("VCXScenarioManager").AddNeutrals(z,z.GetProperties())}}},GetActiveSequenceId:function(){if(this._activeSequence){return this._activeSequence.sequenceId}else{return null}},activeSequence:function(v){if(v===this._activeSequence){return}if(this._activeSequence){this._activeSequence.removeClassName("vcxActiveSequence")}this._activeSequence=v;this._activeSequence.addClassName("vcxActiveSequence")},setSequenceState:function(x,y){var w=this.getUISequenceTarget(x);if(w){var v=this.getUISequenceIndex(w,x);if(v){w.setSequenceItemOpenedState(v,y)}}},setDescription:function(y,C){var A=this._vcxGuiManager._vcxexperience;var w=A.getManager("VCXSequenceManager");sequenceId=w.GetSequenceFromScenarioId(y).GetID();var x=A.getManager("VCXSequenceManager").GetSequenceFromId(sequenceId);var E=x.GetName();var D=this._thumbnailsList[sequenceId];for(var z in D){var B=D[z].scenarioID;if(B===y){var v=D[z];v.elements.container.removeClassName("vcx-no-description");v.elements.subtitle.innerHTML=C;break}}},editDescription:function(v){},createThumbnailView:function(B,F,E,C,v){if(F._activeSequence){var y=F._activeSequence;F.activeSequence(y)}var A=v;if(A){}else{A=new m({size:"small"}).inject(F._sequenceContent[E]);A.elements.transition=new UWA.Element("div",{html:"","class":"vcxTransition",}).inject(A.elements.container);A.elements.transitionBack=new UWA.Element("div",{html:"","class":"vcxTransitionBack",}).inject(A.elements.container);A.elements.container.id=B.GetID();A.elements.container.setAttribute("data-rec-id",B.GetID());A.elements.container.addClassName("vcx-controls-thumbnail");A.elements.container.getCheckpointData=this.getThumbnailDataForRecord;A.elements.picture.setAttribute("data-rec-id",B.GetID()+"-picture");A.elements.picture.addClassName("vcx-controls-thumbnail-picture");A.elements.cartouche.setAttribute("data-rec-id",B.GetID()+"-cartouche");A.elements.cartouche.addClassName("vcx-controls-thumbnail-cartouche");A.elements.cartouche.getChildren()[0].setAttribute("data-rec-id",B.GetID()+"-cartouche-content");A.elements.title.setAttribute("data-rec-id",B.GetID()+"-title");A.elements.title.addClassName("vcx-controls-thumbnail-title");A.elements.subtitle.setAttribute("data-rec-id",B.GetID()+"-subtitle");A.elements.subtitle.addClassName("vcx-controls-thumbnail-subtitle");A.elements.subtitle.innerHTML="";A.elements.container.addClassName("vcx-no-description");A.elements.icon.addClassName("vcx-controls-thumbnail-icon");A.elements.picture.childNodes[0].addClassName("vcx-controls-checkbox");var H=0;if(C!==-1){H=C;F.insertIndex(A.elements.thumbnail,H)}var D=F._thumbnailsList[E];D.splice(H,0,A);A.elements.menu.innerHTML="";A.elements.menu.addClassName("vcx-controls-thumbnail-menu");var w=F._vcxGuiManager._vcxexperience.getManager("VCXSequenceManager");var z=w.GetSequenceFromId(E);var G=z.GetName();var x=this.getUISequenceTarget(G);if(F.playerMode){A.elements.checkbox.elements.container.style.display="none"}A.cbCheckBoxChange=function(K){if(F.playerMode){return}F.activeSequence(x.elements.items[F._sequenceContent[E].sequenceIndex]);var I=K.dsModel.checkFlag;if(I){F.setVisibilityAllChexkBox(true);A.elements.container.addClassName("vcxItemSelected");if(!F.playerMode){A.elements.title.contentEditable=true}}else{A.elements.container.removeClassName("vcxItemSelected");F.getFrame().getToolbar().activateEditMode();if(A.elements.container.id!==F._currentScenarioId){A.elements.title.contentEditable=false}}var J=new f(F._vcxGuiManager._vcxexperience.getManager("VCXSelectionManager"));if(I){J.AddToSelection(B)}else{J.RemoveFromSelection(B)}F._vcxGuiManager._vcxexperience.getManager("VCXCommandManager").Do(J)};A.elements.checkbox.addEventListener("change",A.cbCheckBoxChange)}if(F.options.immersiveFrame){F.onresizePanel(F,Math.max(parseInt(F.getFrame().getPanel().style.minWidth),parseInt(F.getFrame().getPanel().style.width)))}else{F.onresizePanel(F,Math.max(parseInt(F.getFrame().getPanel().elements.panel.style.minWidth),parseInt(F.getFrame().getPanel().elements.panel.style.width)))}return A},getThumbnailDataForRecord:function(w){var v={};v.value=this.getAttributeNames();w(v,true)},onResize:function(w){var v=w||this;v.onresizePanel(v,Math.max(parseInt(0),parseInt(v.getFrame()._panelMaster.elements.container.parentNode.offsetWidth)))},index:function(x){var y=x.parentNode.childNodes;for(var w=0;w<y.length;w++){var v=y[w];if(v===x){return w}}return 0},insertIndex:function(x,v){var w=x.parentNode.childNodes[v];if(this.index(x)>v){x.parentNode.insertBefore(x,w)}else{x.parentNode.insertBefore(x,w.nextSibling)}return x},checkAllCheckBox:function(){for(var w in this._thumbnailsList){var y=this._thumbnailsList[w];for(var x=0;x<y.length;x++){var v=y[x];if(v.elements.checkbox.checkFlag){return true}}}return false},setVisibilityAllChexkBox:function(A){var B,y;if(A){B="VCXCheckBoxOn";y="VCXCheckBoxOff"}else{B="VCXCheckBoxOff";y="VCXCheckBoxOn"}for(var w in this._thumbnailsList){var z=this._thumbnailsList[w];for(var x=0;x<z.length;x++){var v=z[x];v.elements.container.addClassName(B);v.elements.container.removeClassName(y)}}if(A){this.getFrame().getToolbar().activateEditMode()}else{this.getFrame().getToolbar().exitEditMode()}},getNbItems:function(){var w=0;for(var v in this._thumbnailsList){var x=this._thumbnailsList[v];w+=x.length}return w},getNbSelectedItems:function(){var x=0;for(var w in this._thumbnailsList){var z=this._thumbnailsList[w];for(var y=0;y<z.length;y++){var v=z[y];if(v.elements.checkbox.checkFlag){x++}}}return x},setThumbnailCheckBox:function(w,A){var C=this._activeSequence;var x,D;if(w){x="VCXCheckBoxOn";D="VCXCheckBoxOff"}else{x="VCXCheckBoxOff";D="VCXCheckBoxOn"}for(var z in this._thumbnailsList){var B=this._thumbnailsList[z];for(var y=0;y<B.length;y++){var v=B[y];if(!v.elements.container.hasClassName(x)){v.elements.container.removeClassName(D);v.elements.container.addClassName(x);if(v!=A){v.elements.checkbox.checkFlag=false;v.elements.container.removeClassName("vcxItemSelected");v.elements.title.contentEditable=false}}}}if(w){this.getFrame().getToolbar().activateSelectionMode()}else{this.getFrame().getToolbar().exitEditMode();this.activeSequence(C)}},onScenarioMoved:function(v,w){v.moveScenarioView(w.scenarioToAdd.GetID(),w.sequenceIdForRemove,w.sequenceIdForAdd,w.scenarioAddIdx)},onScenarioChanged:function(G,M){var I=G._vcxGuiManager._vcxexperience;if(M.scenarioToAdd){var C=I.getManager("VCXSequenceManager").GetSequenceFromId(M.sequenceIdForAdd);var D=C.GetIndexOfScenario(M.scenarioToAdd.GetID());G.createScenarioView(M.scenarioToAdd,G,M.sequenceIdForAdd,D);var A=I.getManager("VCXSequenceManager").GetIndexOfSequence(C);var w=C.GetName();var B=G.getUISequenceTarget(w);var x=B.isSequenceOpened(A);if(!x){var y=G.getUISequenceIndex(B,w);B.sequenceOpenedItem(y)}if(M.bLinked&&G._selectedScenarioIds){var z=I.getManager("VCXScenarioManager").GetScenarios();for(var K=0;K<G._selectedScenarioIds.length;K++){var E=G._selectedScenarioIds[K];var H=z[E];if(H){var J=new f(I.getManager("VCXSelectionManager"));J.RemoveFromSelection(H);I.getManager("VCXCommandManager").Do(J)}}}}else{if(M.scenarioToRemove){G.removeScenarioView(M.scenarioToRemove.GetID(),M.sequenceIdForRemove);var F=I.getManager("VCXSequenceManager").GetSequenceFromId(M.sequenceIdForRemove);if(!I.getManager("VCXCommandManager")._isUnDoRunning&&!M.bLinked){var v=new f(I.getManager("VCXSelectionManager"));var L=F.FindScenario(M.scenarioRemovedIdx);if(L){v.SetSelection(L)}I.getManager("VCXCommandManager").Do(v)}}}},removeScenarioView:function(z,C){var w=this._vcxGuiManager._vcxexperience.getManager("VCXSequenceManager");if(C){}else{C=w.GetSequenceFromScenarioId(z).GetID()}var y=w.GetSequenceFromId(C);var F=y.GetName();var x=this.getUISequenceTarget(F);var E=this._thumbnailsList[C];for(var A in E){var B=E[A].scenarioID;if(B===z){var v=E[A];this._sequenceContent[C].removeChild(v.elements.thumbnail);this._thumbnailsList[C].splice(A,1);var D=x.elements.items[this._sequenceContent[C].sequenceIndex];D.counterThumbs.innerHTML=parseInt(D.counterThumbs.innerHTML)-1;break}}},moveScenarioView:function(D,w,v,B){var x=this._vcxGuiManager._vcxexperience.getManager("VCXSequenceManager");if(w){}else{var H=x.GetSequenceFromScenarioId(D);if(H!==null){w=H.GetID()}else{console.log("error - Scenario "+D+" unknown in Sequence Manager");return}}var C=x.GetSequenceFromId(w);var y=C.GetName();var K=this.getUISequenceTarget(y);var N=x.GetSequenceFromId(v);var z=N.GetName();var A=this.getUISequenceTarget(z);var I=this._thumbnailsList[w];for(var J in I){var G=I[J].scenarioID;if(G===D){var O=I[J];if(B<0){B=this._thumbnailsList[v].length}this._thumbnailsList[v].splice(B,0,this._thumbnailsList[w].splice(J,1)[0]);if(w!==v){var M="afterBegin";if(this._sequenceContent[v].childNodes.length===0){this._sequenceContent[v].insertAdjacentElement(M,O.elements.container)}else{if(B>=this._sequenceContent[v].childNodes.length){this._sequenceContent[v].insertAdjacentElement("beforeend",O.elements.container)}else{this._sequenceContent[v].childNodes[B].insertAdjacentElement("beforeBegin",O.elements.container)}}}else{if(this._sequenceContent[v].childNodes[B]._scenarioID!==D){var E;if(this.amIBefore(O.elements.container,this._sequenceContent[v].childNodes[B])){E="afterend"}else{E="beforeBegin"}this._sequenceContent[v].childNodes[B].insertAdjacentElement(E,O.elements.container)}}var F=K.elements.items[this._sequenceContent[w].sequenceIndex];F.counterThumbs.innerHTML=parseInt(F.counterThumbs.innerHTML)-1;var L=A.elements.items[this._sequenceContent[v].sequenceIndex];L.counterThumbs.innerHTML=parseInt(L.counterThumbs.innerHTML)+1;break}}},onCurrentScenarioChanged:function(H,C){if((H==="VCX_Scenario_Transition")){return}this.addImmersiveUIDotsFromCurrentSequence();var F=0;var G=0;for(var A in this._thumbnailsList){var E=this._thumbnailsList[A];for(var z=0;z<E.length;z++){var v=E[z];v.elements.transition.removeClassName("vcxActiveScenario");v.elements.transitionBack.removeClassName("vcxActiveScenarioBack");v.elements.transition.style.webkitTransition="";v.elements.transition.style.transition="";v.elements.transition.style.mozTransition="";v.elements.title.contentEditable=false;if(v.scenarioID===H){F=v;G=A}}}if(F){F.elements.transition.addClassName("vcxActiveScenario");F.elements.transitionBack.addClassName("vcxActiveScenarioBack");if(!this.playerMode){F.elements.title.contentEditable=true}this.scrollToThumbnail(F);var B=this._vcxGuiManager._vcxexperience;var y=B.getManager("VCXSequenceManager").GetSequenceFromId(G);var w=B.getManager("VCXSequenceManager").GetIndexOfSequence(y);var I=y.GetName();var x=this.getUISequenceTarget(I);var D=parseInt(this.getUISequenceIndex(x,I));this.activeSequence(x.elements.items[D])}if(C){if((H!==this._currentScenarioId)&&(H!=="VCX_Scenario_Transition")){this._currentScenarioId=H;this.RefreshTimeline(C,H)}}this._currentScenarioId=H},scrollToThumbnail:function(v){var x=500;var D=this;var B=v.elements.container.getBoundingClientRect();var z=this.getFrame().getContent().getBoundingClientRect();var C=0;var A;if(B.top<z.top){C=Math.abs(B.top-z.top);A=-1}else{if(B.bottom>z.bottom){C=B.bottom-z.bottom;A=1}else{if(D._scrollInterval){clearInterval(D._scrollInterval);delete D._scrollInterval}return}}if(D._scrollInterval){clearInterval(D._scrollInterval);delete D._scrollInterval}if(D._scrollTicks){}else{D._scrollTicks=(x/50)}var w=C/D._scrollTicks*A;var y=D.getFrame().getContent().scrollTop;D._scrollInterval=setInterval(function(){if(D._scrollTicks<0){clearInterval(D._scrollInterval);delete D._scrollInterval;delete D._scrollTicks;return}y+=w;D.getFrame().getContent().scrollTop=y;D._scrollTicks--},50)},onBeginEndTransition:function(E,y){var A=document.getElementsByClassName("VCXScenarioUI_loading");for(var z=0;z<A.length;z++){A[z].style.animation="mask "+(y.maxframe+0.25)+"s steps(1, end) infinite, morepos "+(y.maxframe+0.25)+"s steps(1, end) infinite";if(y.maxframe===0){A[z].addClassName("hide")}}if(y.maxframe!==0){A=document.getElementsByClassName("VCXspinner");for(var z=0;z<A.length;z++){A[z].style.animation="rota "+(y.maxframe+0.25)+"s linear infinite"}A=document.getElementsByClassName("VCXfiller");for(var z=0;z<A.length;z++){A[z].style.animation="opa "+(y.maxframe+0.25)+"s steps(1, end) infinite"}}if(E._currentScenarioId){for(var z in E._thumbnailsList){var F=E._thumbnailsList[z];for(var x in F){var w=F[x];if(w.scenarioID===E._currentScenarioId){w.elements.transition.removeClassName("vcxActiveScenario");var C=w.elements.transition.offsetTop;w.elements.transition.removeClassName("vcxNOTransition");var B="height "+y.maxframe+"s linear";w.elements.transition.style.webkitTransition=B;w.elements.transition.style.transition=B;w.elements.transition.style.mozTransition=B;w.elements.transition.addClassName("vcxActiveScenario");if(y.maxframe===0){w.elements.transition.addClassName("vcxNOTransition");var D=w.elements.transition.offsetTop;w.elements.transition.removeClassName("vcxNOTransition")}}}}}},onScenarioNameRefresh:function(D,A){var B=D._vcxGuiManager._vcxexperience;var w=B.getManager("VCXSequenceManager").GetSequenceFromScenarioId(A.GetID());if(w){var v=A.GetName();var C=this._thumbnailsList[w.GetID()];for(var x=0;x<C.length;x++){var z=C[x];var y=z.scenarioID;if(y===A.GetID()){z.setTitle(v);break}}}},onScenarioReplaced:function(B,z){this.onScenarioNameRefresh(this,z);var D=this;var A=this._vcxGuiManager._vcxexperience;var y=z.GetDocId();var w=A.getManager("VCXDocManager").GetPropPath(y);if(w){var x=w.GetValueURL();var v=x.GetValue();if(v){var C=new XMLHttpRequest();C.open("GET",v,true);C.responseType="blob";C.onload=function(G){if(this.status==200){var F=this.response;var E=new FileReader();E.onload=function(J){var H=A.getManager("VCXSequenceManager");var L=H.GetSequenceFromScenarioId(B).GetID();var N=A.getManager("VCXSequenceManager").GetSequenceFromId(L);var I=N.GetIndexOfScenario(B);var K=D._thumbnailsList[L];var M=K[I];M.setPicture(J.target.result)};E.readAsDataURL(F)}};C.send()}}},onSequenceNameRefresh:function(v,y){var w=v._vcxGuiManager._vcxexperience;var x=w.getManager("VCXSequenceManager").GetIndexOfSequence(y);if(y){}},onSequenceChanged:function(w,A){var y=w._vcxGuiManager._vcxexperience;var B=y.getManager("VCXSequenceManager").GetListSequences();if(A&&A.sequenceToRemove){var v=A.sequenceToRemove;var C=v.GetName();var x=w._sequenceContent[v.GetID()].sequenceIndex-1;var z=w.getUISequenceTarget(C);z.deleteItem(x);w._sequenceContent[v.GetID()]=null;delete w._thumbnailsList[v.GetID()];w.activeSequence(z.elements.items[0])}if(A&&A.sequenceToAdd){w.createSequence(A.sequenceToAdd,A.previousSeqIndex,w)}},capturePixels:function(){var A=this._vcxGuiManager._vcxexperience;var z=A.getManager("VCXContextManager").getMainViewer();var C=A.getManager("VCXPaperManager");var x=0.5;var v=new t();var B=this.getThumbnailDisplaySize();var D=B[0]*2;var y=B[1]*2;var w=v.doThumbnailToDataUrl(A,D,y);return w},pointerDownOnCommandGoToPreviousScenarioCB:function(){var A=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();var w=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetPreviousScenarioId(A);if(w===""){var v=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(A);var z=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetPreviousSequence(v,this.generateSequenceTypeArray(v._sequenceType));if(z){var y=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetListScenariosInSequence(z);var x=y[y.length-1];if(x){w=x.GetID()}}}if(w!==""){this._UIpreviousScenario.getChildren()[0].removeClassName("hide")}this.OpenScenario(w)},pointerDownOnCommandGoToNextScenarioCB:function(){var A=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();var x=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetNextScenarioId(A);if(x===""){var w=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(A);var y=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetNextSequence(w,this.generateSequenceTypeArray(w._sequenceType));if(y){var z=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetListScenariosInSequence(y);var v=z[0];if(v){x=v.GetID()}}}if(x!==""){this._UInextScenario.getChildren()[0].removeClassName("hide")}this.OpenScenario(x)},generateSequenceTypeArray:function(v){var w=[];w.push(v);if(v===2||v===3){w.push(2);w.push(3)}return w},OpenScenario:function(x,A){if(x===""){return}var y=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager");var w=new g(y,this._vcxGuiManager._experienceBase.ComponentsMap,this._vcxGuiManager._experienceBase.getManager("VCXCommandManager"));var z=y.GetScenarios();var v=z[x];w.BuildTransitionTo(v);w.SetCallback(A);this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").Push(w)},addImmersiveUIArrows:function(){var v=this;var w=document.getElementsByClassName("wux-windows-docking-element-free-zone wux-docking-element-bottom")[0];if(w){this._UIpreviousScenario=new UWA.Element("div",{"class":"VCXScenariosUIArrow VCXleftArrow hide",html:[]}).inject(w);var y=new UWA.Element("div",{"class":"VCXScenarioUI_loading hide",html:[]}).inject(this._UIpreviousScenario);new UWA.Element("div",{"class":"VCXpie VCXspinner",html:[]}).inject(y);new UWA.Element("div",{"class":"VCXpie VCXfiller",html:[]}).inject(y);this._UIpreviousScenario.addEventListener(h.POINTERDOWN,this.pointerDownOnCommandGoToPreviousScenarioCB.bind(this),false);this._UInextScenario=new UWA.Element("div",{"class":"VCXScenariosUIArrow VCXrightArrow hide",html:[]}).inject(w);var y=new UWA.Element("div",{"class":"VCXScenarioUI_loading hide",html:[]}).inject(this._UInextScenario);new UWA.Element("div",{"class":"VCXpie VCXspinner",html:[]}).inject(y);new UWA.Element("div",{"class":"VCXpie VCXfiller",html:[]}).inject(y);this._UInextScenario.addEventListener(h.POINTERDOWN,this.pointerDownOnCommandGoToNextScenarioCB.bind(this),false);this._UI_dot_Container=new UWA.Element("div",{"class":"VCXScenariosUIDots_container hide",html:[]}).inject(w);this._UI_dot_Container_clone=new UWA.Element("div",{"class":"VCXScenariosUIDots_clone",html:[]}).inject(this._UI_dot_Container);this._UI_dot_Container_child=new UWA.Element("div",{html:[]}).inject(this._UI_dot_Container);this._UI_dot_Container.addEventListener(h.POINTERUP,function(A){A.preventDefault();A.stopImmediatePropagation();A.stopPropagation();var z=A.path?A.path[0].dataset.scenarioid:undefined;if(z===undefined){return}v.OpenScenario(z);return true});var x=null;this._UI_dot_Container.addEventListener("mouseover",function(B){B.preventDefault();B.stopImmediatePropagation();B.stopPropagation();var z=B.path?B.path[0].dataset.scenarioid:undefined;if(z===undefined){return}var C=document.getElementsByClassName("vcx-controls-thumbnail");for(var A=0;A<C.length;A++){if(C[A].id===z){x=C[A].cloneNode(true);v._UI_dot_Container_clone.innerHTML="";v._UI_dot_Container_clone.appendChild(x);break}}return true});this._UI_dot_Container.addEventListener("mouseout",function(A){A.preventDefault();A.stopImmediatePropagation();A.stopPropagation();var z=A.path?A.path[0].dataset.scenarioid:undefined;if(z===undefined){return}v._UI_dot_Container_clone.innerHTML="";return true});this.addImmersiveUIDotsFromCurrentSequence()}},addImmersiveUIDotsFromCurrentSequence:function(){var v=this;if(this._UI_dot_Container===undefined){return}this._UI_dot_Container_child.innerHTML="";var B=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();if(B===""){return}var y=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(B);var z=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetListScenariosInSequence(y);if(z.length<=1){return}for(var w=0;w<z.length;w++){var x=z[w];var A=new UWA.Element("span",{"class":"VCXScenariosUIDots_dot",html:[]}).inject(this._UI_dot_Container_child);A.dataset.scenarioid=x.GetID();if(B===A.dataset.scenarioid){A.addClassName("active")}}},setImmersiveUIState:function(y){var x=document.getElementsByClassName("VCXScenariosUIArrow");for(var w=0;w<x.length;w++){var v=x[w];y?v.removeClassName("hide"):v.addClassName("hide")}var z=document.getElementsByClassName("VCXScenariosUIDots_container")[0];y?z.removeClassName("hide"):z.addClassName("hide");this.getFrame().getToolbar().setItem("vcxToolbarButton vcxToolbarButtonImmersiveUI Checked",y);this._vcxGuiManager.SetDisplayScenarioImmersiveUI(y);return y},});return r});