define("DS/XCADSTEPDocument/STEPTessellatedRepresentation",["DS/XCADInputDocuments/XCADTessellatedRepresentation","DS/XCADInputDocuments/XCADRepresentation","DS/XCADInputDocuments/XCADFaceData"],function(d,f,b){var a={COMPLEX_TRIANGULATED_FACE:d.KindOfNode.NOD_GP,TESSELLATED_SOLID:d.KindOfNode.NOD_SolidNode,TESSELLATED_SHELL:d.KindOfNode.NOD_SolidNode,TESSELLATED_WIRE:d.KindOfNode.NOD_SurfacicNode,TRIANGULATED_FACE:d.KindOfNode.NOD_GP};var c={COMPLEX_TRIANGULATED_FACE:d.KindOfGP.GP_Face,TRIANGULATED_FACE:d.KindOfGP.GP_Face};var e=d.extend(function e(g,i){this._associatedDocument=g;this._stepTokenizeArgs=g.stepTokenizeArgs;this._representationType=f.XCAD_TESSELLATED_REPRESENTATION;this._stepRepresentationIndex=i;var h=[];g.stepTokenizeArgs(g.stepEntities[i],h);this._rootNodes=[];g.stepTokenizeArgs(h[1],this._rootNodes);this._verticelist={}},{_fillVerticesList:function(k){var i=[];var h=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[k],h);var g=[];var l=[];this._stepTokenizeArgs(h[2],g);for(var j=0;j<g.length;j++){this._stepTokenizeArgs(g[j],l);if(l.length==3){i.push(l[0],l[1],l[2])}}return i},_processTriangleStrips:function(l,n,h){var g=[];this._stepTokenizeArgs(n,g);var p=(1===h.length);for(var o=0;o<g.length;o++){var i=[];this._stepTokenizeArgs(g[o],i);for(var j=0;j<i.length;j++){var m=i[j]-1;l.stripTrianglesIndices.push(l.getStripTrianglesVertexPosition(m));if(!p){var k=[];this._stepTokenizeArgs(h[m],k);l.setNormalAt(m,Number(k[0]),Number(k[1]),Number(k[2]))}}l.nbVertexPerStripTriangle.push(i.length)}},_processTriangleFans:function(m,h,i){var g=[];this._stepTokenizeArgs(h,g);var p=(1===i.length);for(var o=0;o<g.length;o++){var j=[];this._stepTokenizeArgs(g[o],j);for(var k=0;k<j.length;k++){var n=j[k]-1;m.fanTrianglesIndices.push(m.getFanTrianglesVertexPosition(n));if(!p){var l=[];this._stepTokenizeArgs(i[n],l);m.setNormalAt(n,l[0],l[1],l[2])}}m.nbVertexPerFanTriangle.push(j.length)}},getChild:function(j,g){var i=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[j],i);var h=[];this._stepTokenizeArgs(i[1],h);return h[g]},getChildCount:function(i){var h=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[i],h);var g=[];this._stepTokenizeArgs(h[1],g);return g.length},getCircleData:function(g){throw"Error: not implemented method"},getConeData:function(g){throw"Error: not implemented method"},getCoordinateSystem:function(g){throw"Error: not implemented method"},getCylinderData:function(g){throw"Error: not implemented method"},getEdgeData:function(g){throw"Error: not implemented method"},getFaceData:function(p){var h=new b();if("COMPLEX_TRIANGULATED_FACE"===this._associatedDocument._stepGetEntityType(p)){var m=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[p],m);if(this._verticelist[m[1]]===undefined){this._verticelist[m[1]]=this._fillVerticesList(m[1])}var g=[];this._stepTokenizeArgs(m[3],g);if(1===g.length){var l=[];this._stepTokenizeArgs(g[0],l);for(var o=0;o<m[2];o++){h.normals.push(l[0],l[1],l[2])}}var k=[];this._stepTokenizeArgs(m[5],k);if((k.length>0)&&(k.length!==m[2])){for(var o=0;o<k.length;o++){for(var n=0;n<3;n++){h.vertices[o*3+n]=this._verticelist[m[1]][(k[o]-1)*3+n]}}}else{h.vertices=this._verticelist[m[1]]}if(m[6].length>2){this._processTriangleStrips(h,m[6],g)}if(m[7].length>2){this._processTriangleFans(h,m[7],g)}}return h},getGPType:function(h){var i=this._associatedDocument._stepGetEntityType(h);var g=c[i];return g},getNodeBoundingSphere:function(g){throw"Error: not implemented method"},getNodeColor:function(h){var g=this._associatedDocument.overridingFaceColors[h];return(g!==undefined)?g:this._associatedDocument.bodyColors[h]},getNodeOrientationMatrix:function(g){throw"Error: not implemented method"},getNodeType:function(h){var i=this._associatedDocument._stepGetEntityType(h);var g=a[i];return g},getNodeUID:function(g){throw"Error: not implemented method"},getPlaneData:function(g){throw"Error: not implemented method"},getPointData:function(g){throw"Error: not implemented method"},getPolyLineData:function(g){throw"Error: not implemented method"},getRootNode:function(i){var h=this._rootNodes[i];if(this._associatedDocument._stepGetEntityType(h)==="[COMPLEX_STEP_ENTITY]"){var g=h;h=this._associatedDocument.stepGetNodeIdFromCpxEntity(g)}return h},getRootNodesCount:function(){return this._rootNodes.length},getSAG:function(g){throw"Error: not implemented method"},getSphereData:function(g){throw"Error: not implemented method"}});return e});define("DS/XCADSTEPDocument/STEPProductInstance",["DS/XCADInputDocuments/XCADProductInstance"],function(b){var a=b.extend(function a(d,c){this._document=d;this._stepProductInstance=c},{getGeometricProperties:function(){throw"Error: not implemented method"},getInstanceAttributes:function(){throw"Error: not implemented method"},getReferenceProduct:function(){var c=this._document.getProductReference(this._stepProductInstance.productReferenceIdx);return c},getUID:function(){throw"Error: not implemented method"},getTransformation:function(){var f;var e=this._stepProductInstance.transfo;if(e!==undefined){var d=e.rotation.elements;var g=e.translation;var h=[[d[0],d[1],d[2]],[d[3],d[4],d[5]],[d[6],d[7],d[8]]];var c=[g.x,g.y,g.z];f=[h,c]}return f}});return a});define("DS/XCADSTEPDocument/STEPProductRepresentation",["DS/XCADInputDocuments/XCADProductRepresentation"],function(a){var b=a.extend(function b(c,e,d){this._name=d;this._associatedDocument=c;this._representationType=e;this._rootProducts=[]},{addRootProduct:function(c){this._rootProducts.push(c)}});return b});define("DS/XCADSTEPDocument/STEPProduct",["exports","DS/XCADInputDocuments/XCADProduct","DS/XCADSTEPDocument/STEPProductInstance"],function(b,c,a){var d=c.extend(function d(f,e){this._document=f;this._stepProduct=e},{getDocument:function(){var e;var f=this._stepProduct.geomRep;if((f!==undefined)&&(f!==null)&&(f.type==="internal")){e=this._document;e._internalRepresentationIndex=f.location}return e},getFilePath:function(){var e;if((this._stepProduct.geomRep!==undefined)&&(this._stepProduct.geomRep!==null)&&(this._stepProduct.geomRep.type==="external")){e=this._stepProduct.geomRep.location}return e},getGeometricProperties:function(){throw"Error: not implemented method"},getInstanceList:function(){var h=[];var g=this._stepProduct.childrenList.length;for(var f=0;f<g;f++){var e=new a(this._document,this._stepProduct.childrenList[f]);if((e!==undefined)&&(e!==null)){h.push(e)}}return h},getProductAttributes:function(){var e=[];e.push(this._stepProduct.referenceName);e.push("");e.push("");e.push("");e.push("");e.push(c.SourceTypes.Unknown);return e},getUID:function(){throw"Error: not implemented method"}});b.STEPProduct=d;return d});define("DS/XCADSTEPDocument/STEPInputDocument",["DS/XCADInputDocuments/XCADInputDocument","DS/XCADInputDocuments/XCADRepresentation","DS/XCADSTEPDocument/STEPTessellatedRepresentation","DS/XCADSTEPDocument/STEPProductRepresentation","DS/XCADSTEPDocument/STEPProduct","DS/XCADInputDocuments/XCADFaceData","DS/Visualization/ThreeJS_DS","DS/XCADLoader/XCADError"],function(d,h,b,e,i,j,g,f){var c={TESSELLATED_SHAPE_REPRESENTATION:h.XCAD_TESSELLATED_REPRESENTATION,"AUTRES REPRESENTATIONS":"A REMPLACER PAR LA CONSTANTE XCAD ADEQUATE"};var a=d.extend(function a(){this.bodyColors=[];this.overridingFaceColors=[];this.assyProducts=[];this.tesselatedReps=[];this.stepEntities=[];this.nbCpxTriFace=0},{zipped:false,requestResponseType:"text",stepTokenizeComplexEntity:function(k,o){var n=0;var m="";o.length=0;for(var l=0;l<k.length;l++){if("("===k[l]){if(n>=1){m=m+k[l]}n++}else{if(")"===k[l]){n--;if(n>=1){m=m+k[l];if(1===n){o.push(m);m=""}}}else{m=m+k[l]}}}},stepGetNodeIdFromCpxEntity:function(l){var m=this.stepEntities[l];var o=[];this.stepTokenizeComplexEntity(m,o);var k=[];this.stepTokenizeArgs(o[3],k);var n=[];this.stepTokenizeArgs(k[0],n);return n[0]},_stepGetEntityType:function(k){var m;var n=this.stepEntities[k];if(n!==undefined){if("("===n[0]){m="[COMPLEX_STEP_ENTITY]"}else{var l=n.match(/^\w+/);m=l[0]}}return m},close:function(){if(this._internalRepresentationIndex!==undefined){delete this._internalRepresentationIndex}},getProductReference:function(k){return new i(this,this.assyProducts[k])},getRepresentation:function(n){var m;if(this._internalRepresentationIndex!==undefined){if(n===h.XCAD_TESSELLATED_REPRESENTATION){m=new b(this,this._internalRepresentationIndex)}}else{if((Object.keys(this.assyProducts).length===0)&&(this.tesselatedReps.length!==0)&&(n===h.XCAD_TESSELLATED_REPRESENTATION)){m=new b(this,this.tesselatedReps[0])}else{if((Object.keys(this.assyProducts).length!==0)&&(n===h.XCAD_PRODUCT_REPRESENTATION)){m=new e(this,h.XCAD_PRODUCT_REPRESENTATION,"root");for(var k in this.assyProducts){if(this.assyProducts[k].isRoot){var l=this.getProductReference(k);m.addRootProduct(l);break}}}}}return m},stepTokenizeArgs:function(o,p){var n=0;var m="";if(o===undefined){return}var k=o.length;p.length=0;for(var l=0;l<k;l++){if("("===o[l]){if(n>=1){m=m+o[l]}n++}else{if(")"===o[l]){if(1===n){if(m.length>0){if(("'"===m[0])&&("'"===m[m.length-1])){m=m.slice(1,-1)}p.push(m)}else{if(p.length>0){p.push()}}}else{if(n>1){m=m+o[l]}}n--}else{if(","===o[l]){if(1===n){if(("'"===m[0])&&("'"===m[m.length-1])){m=m.slice(1,-1)}p.push(m);m=""}else{m=m+o[l]}}else{if(n>=1){m=m+o[l]}}}}}},initialize:function(r){if(r===""){return}r=r.replace(/\r?\n/g,"");var D=r.split(";");r="";var n=this;var F=[];var z=[];var t=[];var l=[];var A=[];var G=[];var o=[];var E=[];var I=[];var m=false;for(var x=0;x<D.length;x++){if((!m)&&(D[x].match(/^(FILE_SCHEMA)/)!==null)){if(D[x].match(/^(FILE_SCHEMA\(\(\'AP242)/)===null){console.error("Only STEP AP242 file are supported");var p=new f();p.setError("XCADSTEPDocument/STEPInputDoc_errors",null,"E_UNSUPPORT","error");return p}else{m=true}}var y=D[x].match(/^(#[0-9]+)\=(.*)$/);if(y!==null){var C=y[2].match(/^\w+/);if(null===C){if("("===y[2][0]){C=["[COMPLEX_STEP_ENTITY]"]}}if(H(C[0])){this.stepEntities[y[1]]=y[2];switch(C[0]){case"TESSELLATED_SHAPE_REPRESENTATION":this.tesselatedReps.push(y[1]);break;case"STYLED_ITEM":F.push(y[1]);break;case"OVER_RIDING_STYLED_ITEM":z.push(y[1]);break;case"CONTEXT_DEPENDENT_SHAPE_REPRESENTATION":t.push(y[1]);break;case"SHAPE_REPRESENTATION_RELATIONSHIP":l.push(y[1]);break;case"PROPERTY_DEFINITION_REPRESENTATION":A.push(y[1]);break;case"SHAPE_DEFINITION_REPRESENTATION":G.push(y[1]);break;case"APPLIED_EXTERNAL_IDENTIFICATION_ASSIGNMENT":o.push(y[1]);break;case"COMPLEX_TRIANGULATED_FACE":this.nbCpxTriFace++;break}}else{this.stepEntities[y[1]]=y[2]}}else{}}D.length=0;for(var x=0;x<F.length;x++){q(F[x],true)}for(var x=0;x<z.length;x++){q(z[x],false)}if(t.length>0){for(var x=0;x<l.length;x++){B(l[x],false)}for(var x=0;x<o.length;x++){s(o[x])}for(var x=0;x<A.length;x++){B(A[x],true)}for(var x=0;x<o.length;x++){s(o[x])}for(var x=0;x<t.length;x++){u(t[x])}}function H(K){var J=["TESSELLATED_SHAPE_REPRESENTATION","STYLED_ITEM","OVER_RIDING_STYLED_ITEM","TESSELLATED_SOLID","TESSELLATED_SHELL","COMPLEX_TRIANGULATED_FACE","COORDINATES_LIST","PRESENTATION_STYLE_ASSIGNMENT","SURFACE_STYLE_USAGE","SURFACE_SIDE_STYLE","SURFACE_STYLE_FILL_AREA","FILL_AREA_STYLE","FILL_AREA_STYLE_COLOUR","COLOUR_RGB","DRAUGHTING_PRE_DEFINED_COLOUR","PRODUCT","PRODUCT_DEFINITION","PRODUCT_DEFINITION_SHAPE","PRODUCT_DEFINITION_FORMATION_WITH_SPECIFIED_SOURCE","NEXT_ASSEMBLY_USAGE_OCCURRENCE","SHAPE_DEFINITION_REPRESENTATION","SHAPE_REPRESENTATION","CONTEXT_DEPENDENT_SHAPE_REPRESENTATION","PROPERTY_DEFINITION_REPRESENTATION","SHAPE_REPRESENTATION_RELATIONSHIP","PROPERTY_DEFINITION","DOCUMENT_FILE","APPLIED_EXTERNAL_IDENTIFICATION_ASSIGNMENT","CONTEXT_DEPENDENT_SHAPE_REPRESENTATION","ITEM_DEFINED_TRANSFORMATION","AXIS2_PLACEMENT_3D","DIRECTION","CARTESIAN_POINT","[COMPLEX_STEP_ENTITY]"];if(-1===J.indexOf(K)){return false}else{return true}}function w(J){var L;var M=n.stepEntities[J];if(M!==undefined){if("("===M[0]){L="[COMPLEX_STEP_ENTITY]"}else{var K=M.match(/^\w+/);L=K[0]}}return L}function q(O,N){var P=[];n.stepTokenizeArgs(n.stepEntities[O],P);var ae=P[2];var Y=[];n.stepTokenizeArgs(P[1],Y);ANALY_STYLE:for(var S=0;S<Y.length;S++){var V=Y[S];if("PRESENTATION_STYLE_ASSIGNMENT"===w(V)){var U=[];n.stepTokenizeArgs(n.stepEntities[V],U);var T=[];n.stepTokenizeArgs(U[0],T);for(var Z=0;Z<T.length;Z++){V=T[Z];if("SURFACE_STYLE_USAGE"===w(V)){var W=[];n.stepTokenizeArgs(n.stepEntities[V],W);V=W[1];if("SURFACE_SIDE_STYLE"===w(V)){var X=[];n.stepTokenizeArgs(n.stepEntities[V],X);var aa=[];n.stepTokenizeArgs(X[1],aa);for(var M=0;M<aa.length;M++){V=aa[M];if("SURFACE_STYLE_FILL_AREA"===w(V)){var ab=[];n.stepTokenizeArgs(n.stepEntities[V],ab);V=ab[0];if("FILL_AREA_STYLE"===w(V)){var L=[];n.stepTokenizeArgs(n.stepEntities[V],L);var Q=[];n.stepTokenizeArgs(L[1],Q);for(var R=0;R<Q.length;R++){V=Q[R];if("FILL_AREA_STYLE_COLOUR"===w(V)){var ad=[];n.stepTokenizeArgs(n.stepEntities[V],ad);V=ad[1];if("COLOUR_RGB"===w(V)){var K=[];n.stepTokenizeArgs(n.stepEntities[V],K);if(N){n.bodyColors[ae]=[K[1],K[2],K[3]]}else{n.overridingFaceColors[ae]=[K[1],K[2],K[3]]}}else{if("DRAUGHTING_PRE_DEFINED_COLOUR"===w(V)){var J=[];n.stepTokenizeArgs(n.stepEntities[V],J);var af=J[0];var ac=new g.Color();ac.setStyle(af);if(N){n.bodyColors[ae]=[ac.r,ac.g,ac.b]}else{n.overridingFaceColors[ae]=[ac.r,ac.g,ac.b]}}}break ANALY_STYLE}}}}}}}}}}}function v(J,N){var Q={};var K=[];var P=[];var R=[];var M=[];var X=[];var O=[];var U=[];var L=[];var W=[];n.stepTokenizeArgs(n.stepEntities[J],K);n.stepTokenizeArgs(n.stepEntities[K[1]],P);n.stepTokenizeArgs(P[1],M);n.stepTokenizeArgs(n.stepEntities[K[2]],P);n.stepTokenizeArgs(P[1],X);n.stepTokenizeArgs(n.stepEntities[K[3]],P);n.stepTokenizeArgs(P[1],O);n.stepTokenizeArgs(n.stepEntities[N],K);n.stepTokenizeArgs(n.stepEntities[K[1]],P);n.stepTokenizeArgs(P[1],U);n.stepTokenizeArgs(n.stepEntities[K[2]],P);n.stepTokenizeArgs(P[1],L);n.stepTokenizeArgs(n.stepEntities[K[3]],P);n.stepTokenizeArgs(P[1],W);Q.rotation=new g.Matrix3();var V=new g.Vector3(X[0],X[1],X[2]);var T=new g.Vector3(O[0],O[1],O[2]);var S=new g.Vector3();S.crossVectors(V,T);Q.rotation.set(O[0],O[1],O[2],S.x,S.y,S.z,X[0],X[1],X[2]);Q.translation=new g.Vector3(M[0]-U[0],M[1]-U[1],M[2]-U[2]);return Q}function u(V){var P=[];n.stepTokenizeArgs(n.stepEntities[V],P);var N=P[0];var U=P[1];var ac;var T=[];n.stepTokenizeComplexEntity(n.stepEntities[N],T);var X=[];n.stepTokenizeArgs(T[0],X);var S=X[2];var aa=X[3];var L=[];n.stepTokenizeArgs(T[1],L);if("ITEM_DEFINED_TRANSFORMATION"===w(L[0])){var Z=[];n.stepTokenizeArgs(n.stepEntities[L[0]],Z);var ad=Z[2];var M=Z[3];ac=v(M,ad)}var Q=[];n.stepTokenizeArgs(n.stepEntities[U],Q);var W=[];n.stepTokenizeArgs(n.stepEntities[Q[2]],W);var R=W[0];var J=k(W[3]);var ab=J[0];var Y=J[1];J=k(W[4]);var K=J[0];var O=J[1];if((ab!==null)&&(K!==null)){if(!(ab in n.assyProducts)){n.assyProducts[ab]={referenceName:Y,isRoot:true,childrenList:[],geomRep:I[aa]}}if(K in n.assyProducts){n.assyProducts[K].isRoot=false}else{n.assyProducts[K]={referenceName:O,isRoot:false,childrenList:[],geomRep:I[S]}}n.assyProducts[ab].childrenList.push({instanceName:R,productReferenceIdx:K,transfo:ac})}}function k(P){var O=null;var L=null;if("PRODUCT_DEFINITION"===w(P)){var M=[];n.stepTokenizeArgs(n.stepEntities[P],M);var J=M[2];if("PRODUCT_DEFINITION_FORMATION_WITH_SPECIFIED_SOURCE"===w(J)){var N=[];n.stepTokenizeArgs(n.stepEntities[J],N);if("PRODUCT"===w(N[2])){var K=[];n.stepTokenizeArgs(n.stepEntities[N[2]],K);O=N[2];L=K[0]}}}return[O,L]}function s(K){var J=[];n.stepTokenizeArgs(n.stepEntities[K],J);var L=[];n.stepTokenizeArgs(J[3],L);if("DOCUMENT_FILE"===w(L[0])){E[L[0]]=J[0]}}function B(K,N){if(N){var J=[];n.stepTokenizeArgs(n.stepEntities[K],J);if(("PROPERTY_DEFINITION"===w(J[0]))&&("SHAPE_REPRESENTATION"===w(J[1]))){var L=[];n.stepTokenizeArgs(n.stepEntities[J[0]],L);I[J[1]]={type:"external",location:E[L[2]]}}}else{var M=[];n.stepTokenizeArgs(n.stepEntities[K],M);I[M[2]]={type:"internal",location:M[3]}}}}});return a});