define("DS/SceneGraphNodes/SphereLightNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/LightNode3D"],function(b,a){var c=a.extend({init:function(f,e){var d=new b.SphereLight(f.color,f.intensity,f.radius);this._radius=d.radius;this._parent(d,e);return this},setRadius:function(d){if(d){this._radius=d}this._updateRadius()},_updateRadius:function(){var e,f,d;this.light3js.radius=this._radius;e=this._occurrences.length;for(var d=0;d<e;d++){f=this._occurrences[d];f.renderable.radius=this._radius}},getNodeType:function(){return"LightNode3D"},getLightNodeType:function(){return"SphereLightNode3D"}});return UWA.namespace("THREEDS/Nodes/SphereLight",c)});define("SceneGraphNodes/SphereLightNode",["DS/SceneGraphNodes/SphereLightNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/SphereLightNode");return b});define("DS/SceneGraphNodes/CSSSVGNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/SVGLoader/SVGToNode3D","DS/Visualization/GetSVGMode"],function(d,f,e,b,a){var c;c=f.extend({init:function(k,g,m){this._parent(g);this._webGLMode=a.getWebGLMode();if(this._webGLMode){var l=new b(k);var j=l.buildNode3D();this.addChild(j);this._cssSVGNode=true;this.setPickable(e.NODRAWHL)}else{this._gNode=document.createElementNS(m.getSvgNS(),"g");this._gNode.svgV6Node=this;this._gNode.appendChild(k);this.exludeFromBounding(true);this.forbidChildren=true;var i=this._occurrences[0];var h=this.createRenderable();i.renderable=h;i.renderable.name=this.name;i.renderable._occurrence=i;this._cssSVGNode=true;this.viewer=m;this._updateSVGVisibility()}},setVisibility:function(g){if(this._webGLMode){return this._parent.apply(this,arguments)}this._setVisible(g?true:false);this._updateSVGVisibility()},setVisibilityFree:function(g){if(this._webGLMode){return this._parent.apply(this,arguments)}this._setVisibilityFree(g?true:false);this._updateSVGVisibility()},getNodeType:function(){if(this._webGLMode){return this._parent.apply(this,arguments)}return"CSSSVGNode"},createRenderable:function(){if(this._webGLMode){return this._parent.apply(this,arguments)}var g=new d.CSSSVGNode(this._gNode);g.matrixAutoUpdate=false;g.matrixWorldNeedsUpdate=false;g.pickable=false;return g},addChild:function(){if(this._webGLMode){return this._parent.apply(this,arguments)}},_updateSVGVisibility:function(){if(this._webGLMode){return}var g;if(this._getVisibilityFree()){g=this._getVisible()}else{if(this.viewer.visibleSpace){g=this._getVisible()}else{g=!this._getVisible()}}this._gNode.setAttributeNS(null,"visibility",g?"visible":"hidden")},_onLinkedToSceneGraph:function(){if(this._webGLMode){return this._parent.apply(this,arguments)}this.viewer.svgRoot.appendChild(this._gNode)},_onUnlinkedToSceneGraph:function(){if(this._webGLMode){return this._parent.apply(this,arguments)}this.viewer.svgRoot.removeChild(this._gNode)}});return c});define("DS/SceneGraphNodes/InstancedCylinderImpostorsNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/Mesh3D","DS/Mesh/MeshUtils"],function(c,e,a,d){var b=e.extend({init:function(m){this._isIE11=((new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)!=null));this._name=m.name||"cylinderImpostors";this._parent(this._name);var D=m.material?m.material:new c.MeshPhongMaterial({force:true});D.transparent=true;var v=this._createMaterial(D);var r=m.nbInstances||1;var x=null;if(this._isIE11){x=this._createCoarseImpostor(6,v)}else{x=this._createFlatImpostor(0,v)}var y=new a(x,"");var E=m.positions;var o=m.radii;var l=m.axes;var A=m.colors;var s=function(L,J,M,H){var N=M.dot(M);var I=new c.Vector3(H*Math.sqrt(1-M.x*M.x/N),H*Math.sqrt(1-M.y*M.y/N),H*Math.sqrt(1-M.z*M.z/N));var K=new c.Vector3().subVectors(L,I);K.min(new c.Vector3().subVectors(J,I));var i=new c.Vector3().addVectors(L,I);i.max(new c.Vector3().addVectors(J,I));return new c.Box3(K,i)};var w=new c.Vector3(Infinity,Infinity,Infinity);var B=new c.Vector3(-Infinity,-Infinity,-Infinity);var u=new Float32Array(r*4);var p=new Float32Array(r*2);var C=new Float32Array(r*3);var j=new c.Vector3();var h=new c.Vector3();var g=new c.Vector3();var f;for(var z=0;z<r;z++){u[4*z]=E[3*z];u[4*z+1]=E[3*z+1];u[4*z+2]=E[3*z+2];u[4*z+3]=o[z];C[3*z]=l[3*z];C[3*z+1]=l[3*z+1];C[3*z+2]=l[3*z+2];j.set(C[3*z],C[3*z+1],C[3*z+2]);g.addVectors(new c.Vector3(E[3*z],E[3*z+1],E[3*z+2]),new c.Vector3(0.5*l[3*z],0.5*l[3*z+1],0.5*l[3*z+2]));h.subVectors(new c.Vector3(E[3*z],E[3*z+1],E[3*z+2]),new c.Vector3(0.5*l[3*z],0.5*l[3*z+1],0.5*l[3*z+2]));f=s(h,g,j,o[z]);w.min(f.min);B.max(f.max);p[2*z]=Math.floor(255*A[4*z])+Math.floor(255*A[4*z+1])*256+Math.floor(255*A[4*z+2])*65536;p[2*z+1]=A[4*z+3]}var F=new c.Vector3().addVectors(w,B).multiplyScalar(0.5);var q=new c.Vector3().addVectors(F,new c.Vector3().subVectors(w,F).multiplyScalar(1.05));var t=new c.Vector3().addVectors(F,new c.Vector3().subVectors(B,F).multiplyScalar(1.05));var f=new c.Box3(q,t);var n={data:u,type:"v4",isFlattened:true,attribName:"instancePositionAndRadius"};var G={data:C,type:"v3",isFlattened:true,attribName:"cylinderAxis"};var k={data:p,type:"v2",isFlattened:true,attribName:"instanceColor"};y.setMaterial(v);y.setInstancingParameters(r,[n,G,k],"instance");y.forceBoundingBox(f);this.addChild(y);return this},_createFlatImpostor:function(g){var j=[];var l=new c.BufferGeometryDS();l.drawingGroups=[];var k=new d.DrawingGroup(g,g,4,0,6);k.geometry=l;l.drawingGroups.push(k);var m=4;var i=new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0]);l.vertexPositionArray=i;var h=(6);var f=new Uint16Array([0,1,2,0,2,3]);l.vertexIndexArray=f;j.push(l);var n=new c.Mesh(j,g);n.matrixAutoUpdate=false;return n},_createCoarseImpostor:function(u,n){var r=[];var t=new c.BufferGeometryDS();t.drawingGroups=[];var o=12*u;var s=new d.DrawingGroup(n,n,4,0,o);s.geometry=t;t.drawingGroups.push(s);var v=2*u+2;var p=new Float32Array(v*3);var h=0;var f=0;p[h++]=0;p[h++]=0;p[h++]=-1;for(var l=0;l<u;l++){f=l/u;p[h++]=Math.cos(f*2*Math.PI);p[h++]=Math.sin(f*2*Math.PI);p[h++]=-1;p[h++]=Math.cos(f*2*Math.PI);p[h++]=Math.sin(f*2*Math.PI);p[h++]=+1}p[h++]=0;p[h++]=0;p[h++]=+1;t.vertexPositionArray=p;var m=new Uint16Array(o);var g=0;for(var l=0;l<u*2;l+=2){var q=v-1;if(l===10){q=v-2}m[g++]=0;m[g++]=(l+3)%q;m[g++]=l+1;m[g++]=l+1;m[g++]=(l+3)%q;m[g++]=l+2;m[g++]=(l+3)%q;m[g++]=(l+4)%q;m[g++]=l+2;m[g++]=v-1;m[g++]=l+2;m[g++]=(l+4)%q}t.vertexIndexArray=m;r.push(t);var w=new c.Mesh(r,n);w.matrixAutoUpdate=false;return w},_createMaterial:function(h){var i=h;i.activatePDSFX();i.setPDSFXVaryings({viewCenterPos:{type:"v3"},radius:{type:"f"},radius2:{type:"f"},vaColor:{type:"v4"},viewAxis:{type:"v3"},half_height:{type:"f"},rightAndLeft:{type:"v2"}});i.setPDSFXGlobalShaderCode(["vec3 _viewCenterPos;"].join("\n"),["vec3 viewPositionOnCylinder;","vec3 viewNormalOnCylinder;","bool toDiscard;","bool isPerspective;","vec2 viewport;","void intersectionWithCylinderPERSP() {","float minDistance;","float minDistance2;","vec3 viewPos = vGetViewPosition();","vec3 ray = normalize(viewPos);","vec3 cameraToCenter = viewCenterPos;","vec3 D = cross(ray, viewAxis);","float lengthD = length(D);","if (lengthD == 0.0) {","float adjacentInTriangle = dot(ray, cameraToCenter);","minDistance2 = dot(cameraToCenter, cameraToCenter) - adjacentInTriangle*adjacentInTriangle;","if (minDistance2 > radius2) {","	toDiscard = true;","	return;","}","viewNormalOnCylinder = -ray;","viewPositionOnCylinder = adjacentInTriangle*ray;","return;","}","D = normalize(D);","minDistance = abs(dot(-cameraToCenter, D));","if (minDistance > radius) {","	toDiscard = true;","	return;","}","float t = -dot(cross(-cameraToCenter, viewAxis), D)/lengthD;","vec3 O = normalize(cross(D, viewAxis));","float s = abs(sqrt(radius2 - minDistance*minDistance)/dot(ray, O));","vec3 intersection_in = (t-s)*ray;","vec3 intersection_out = (t+s)*ray;","vec3 intersectionToCenter_in = viewCenterPos - intersection_in;","vec3 intersectionToCenter_out = viewCenterPos - intersection_out;","float dot_in_axis = abs(dot(intersectionToCenter_in, viewAxis));","if (dot_in_axis > half_height) {","if (abs(dot(intersectionToCenter_out, viewAxis)) > half_height && ","dot(intersectionToCenter_in, viewAxis)*dot(intersectionToCenter_out, viewAxis) > 0.0) {","toDiscard = true;","return;","}","float diff = dot_in_axis - half_height;","float _dot = dot(ray, viewAxis);","viewNormalOnCylinder = - sign(_dot) * viewAxis;","float x;","x = diff/abs(_dot);","viewPositionOnCylinder = intersection_in + x*ray;","return;","} ","vec3 intersectionProj;","intersectionProj = viewCenterPos + dot(-intersectionToCenter_in, viewAxis)*viewAxis;","viewNormalOnCylinder = normalize(intersection_in - intersectionProj);","viewPositionOnCylinder = intersection_in;","}","void intersectionWithCylinderORTHO() {","float minDistance;","vec3 ray = vec3(0.0,0.0, -1.0);","vec3 viewRayBase = vec3((2.0*(gl_FragCoord.xy/viewport.xy) - 1.0)*rightAndLeft.xy, 0.0);","vec3 cameraToCenter = vec3(0.0,0.0,viewCenterPos.z);","vec3 D = cross(ray, viewAxis);","float lengthD = length(D);","if (lengthD == 0.0) {","minDistance = length(viewRayBase.xy - viewCenterPos.xy);","if (minDistance > radius) {","	toDiscard = true;","	return;","}","viewNormalOnCylinder = -ray;","viewPositionOnCylinder = viewRayBase + cameraToCenter + vec3(0.0,0.0,half_height);","return;","}","D = normalize(D);","minDistance = abs(dot(viewCenterPos - viewRayBase, D));","if (minDistance > radius) {","	toDiscard = true;","	return;","}","float t = -dot(cross(viewRayBase - viewCenterPos, viewAxis), D)/lengthD;","vec3 O = normalize(cross(D, viewAxis));","float s = abs(sqrt(radius2 - minDistance*minDistance)/dot(ray, O));","vec3 intersection_in = viewRayBase + (t-s)*ray;","vec3 intersection_out = viewRayBase + (t+s)*ray;","vec3 intersectionToCenter_in = viewCenterPos - intersection_in;","vec3 intersectionToCenter_out = viewCenterPos - intersection_out;","float dot_in_axis = abs(dot(intersectionToCenter_in, viewAxis));","if (dot_in_axis > half_height) {","if (abs(dot(intersectionToCenter_out, viewAxis)) > half_height && ","dot(intersectionToCenter_in, viewAxis)*dot(intersectionToCenter_out, viewAxis) > 0.0) {","toDiscard = true;","return;","}","float diff = dot_in_axis - half_height;","float _dot = dot(ray, viewAxis);","viewNormalOnCylinder = - sign(_dot) * viewAxis;","float x;","x = diff/abs(_dot);","viewPositionOnCylinder = intersection_in + x*ray;","return;","} ","vec3 intersectionProj;","intersectionProj = viewCenterPos + dot(-intersectionToCenter_in, viewAxis)*viewAxis;","viewNormalOnCylinder = normalize(intersection_in - intersectionProj);","viewPositionOnCylinder = intersection_in;","}"].join("\n"));var g={ComputeCommonValues:["void ComputeCommonValues() {","radius = instancePositionAndRadius.w;","radius2 = radius * radius;","viewAxis = normalize(vec3(vGetViewMatrix()*vec4(cylinderAxis, 0.0)));","half_height = length(cylinderAxis)/2.0;","viewCenterPos = vec3(vGetViewMatrix() * vec4(instancePositionAndRadius.xyz, 1.0));","}"].join("\n"),ComputeVaryingValues:["void ComputeVaryingValues() {","vec4 color;","color.a = instanceColor.y;","color.b = floor(instanceColor.x / 65536.0);","float tmp = instanceColor.x - color.b * 65536.0;","color.g = floor(tmp / 256.0);","color.r = floor(tmp - color.g * 256.0);","color.xyz /= 255.0;","#ifdef GAMMA_INPUT","vaColor = color * color;","#else","vaColor = color;","#endif","mat4 pMatrix = vGetProjectionMatrix();","rightAndLeft = vec2(1.0/pMatrix[0][0], 1.0/pMatrix[1][1]);","}"].join("\n")};if(this._isIE11){g.ProcessViewTangentSpace=["void ProcessViewTangentSpace(inout TangentSpace ioWorldViewTS) {","vec3 zVec = vec3(0.0,0.0,1.0);","vec3 n_cylinderAxis = normalize(cylinderAxis);","vec3 rotAxis = cross(n_cylinderAxis, zVec);","float s = length(rotAxis);","float c = dot(n_cylinderAxis, zVec);","float t = 1.0 - c;","rotAxis = normalize(rotAxis);","float x = rotAxis.x;","float y = rotAxis.y;","float z = rotAxis.z;","float tx = t*x;","float ty = t*y;","mat4 rotMat = mat4(","vec4(tx * x + c, tx * y - s * z, tx * z + s * y, 0),","vec4(tx * y + s * z, ty * y + c, ty * z - s * x, 0),","vec4(tx * z - s * y, ty * z + s * x, t * z * z + c, 0),","vec4(0.0,0.0,0.0,1.0)",");","vec3 localPosition = vGetAttribPosition();","localPosition.xy *= radius*1.1547;","localPosition.z *= half_height;","localPosition = vec3(rotMat*vec4(localPosition,1.0));","ioWorldViewTS.Position = vec3(vGetWorldViewMatrix()*vec4(instancePositionAndRadius.xyz + localPosition, 1.0));","}"].join("\n")}else{g.ProcessViewTangentSpace=["void ProcessViewTangentSpace(inout TangentSpace ioWorldViewTS) {","vec3 localPosition = vGetAttribPosition() - vec3(0.5, 0.5, 0.0);","mat4 pMatrix = vGetProjectionMatrix();","bool isPersp = pMatrix[2][3] == -1.0;","vec3 _z;","_z = -sign(dot( -viewCenterPos, viewAxis))*viewAxis;","vec3 C0 = viewCenterPos - half_height*_z;","vec3 C1 = viewCenterPos + half_height*_z;","if (isPersp) {","vec3 v =  - C0;","vec3 _x = normalize(cross(v, _z));","vec3 _y = normalize(cross(_z, _x));","vec3 y_1;","vec3 x_2;","float cos_alpha;","float sin_alpha;","float tan_alpha;","vec3 O_1 = C0 + dot(-C0, _y)*_y;","float OC_L = length(C0 - O_1);","sin_alpha = radius/OC_L;","bool rectBillboard = true;","if (sin_alpha <= 0.5) {","cos_alpha = sqrt(1.0 - sin_alpha*sin_alpha);","tan_alpha = sin_alpha/cos_alpha;","y_1 = radius*_y;","x_2 = (OC_L -radius)*tan_alpha*_x;","rectBillboard = false;","}","float flatCylCoeff = -1.0;","vec3 C0Plus_y = C0+radius*_y;","float z_plane = viewCenterPos.z;","vec3 C0_n = normalize(C0);","vec3 C0_plane = (z_plane/C0_n.z) * C0_n;","vec3 C1_n = normalize(C1);","vec3 C1_plane = (z_plane/C1_n.z) * C1_n;","vec3 Y_y_n = normalize(C0Plus_y);","vec3 Y_plane = (z_plane/Y_y_n.z) * Y_y_n;","float dot_C0_C1_y = dot(C1_plane - C0_plane, Y_plane - C0_plane);","if (dot_C0_C1_y*_y.z < 0.0)","if (dot_C0_C1_y < 0.0) flatCylCoeff = 1.0;","vec3 newMvPosition;","float sgn = sign(localPosition.y);","float inc_coeff = 1.03;","_x*=inc_coeff;","_y*=inc_coeff;","y_1*=inc_coeff;","x_2*=inc_coeff;","if (localPosition.x < 0.0) {","if (rectBillboard) {","newMvPosition = C0 - radius*_y + sgn* radius*_x;","}","else newMvPosition = C0 + flatCylCoeff * radius*_y + sgn* tan_alpha*(radius+OC_L)*_x;","} else {","vec3 point;","if (rectBillboard) {","vec3 ray = normalize(C1 + radius*_y);","float len = dot(viewAxis, C0)/dot(viewAxis, ray);","vec3 intsc = len*ray;","if (dot(intsc, _y) > dot(C0Plus_y, _y)) {","point = intsc;","} else {","point = C0Plus_y;","}","newMvPosition = point + sgn* radius*_x;","}","else newMvPosition = C1 + y_1 + sgn* x_2;","}","ioWorldViewTS.Position = newMvPosition;","} else {","vec3 _y = normalize(vec3(C1.xy-C0.xy,0.0));","vec3 _x = vec3(-_y.y, _y.x, 0.0);","float medZ = 0.5*(C0.z+C1.z);","C0.z = medZ;","C1.z = medZ;","float coeff = 1.03;","float y_radius = 0.0;","if (viewAxis.z != 0.0) {","vec3 orthAxis = normalize(vec3(viewAxis.xy, -dot(viewAxis.xy,viewAxis.xy)/viewAxis.z));","y_radius = radius*abs(dot(orthAxis, _y));","}","if (localPosition.x < 0.0) {","ioWorldViewTS.Position = C0 +coeff*(sign(localPosition.y) *_x*radius - _y*y_radius);","} else {","ioWorldViewTS.Position = C1 + coeff*(sign(localPosition.y) *_x*radius + _y*y_radius);","}","}","}"].join("\n")}var f={ComputeCommonValues:["void ComputeCommonValues() {","mat4 pMatrix = vGetProjectionMatrix();","isPerspective = pMatrix[2][3] == -1.0;","toDiscard = false;","viewport = vec2(vGetViewportSize());","if (isPerspective) intersectionWithCylinderPERSP();","else intersectionWithCylinderORTHO();","}"].join("\n"),ComputeDiscard:["bool ComputeDiscard() {","return toDiscard;","}"].join("\n"),ComputeAlbedo:["vec3 ComputeAlbedo() {","	return vaColor.xyz;","}"].join("\n"),ComputeViewNormal:["vec3 ComputeViewNormal() {","return viewNormalOnCylinder;","}"].join("\n")};if(this._isIE11){f.ComputeViewPosition=["vec3 ComputeViewPosition() {","return viewPositionOnCylinder;","}"].join("\n")}else{f.ComputeViewPosition=["vec3 ComputeViewPosition() {","float linearDepth = -viewPositionOnCylinder.z;","vec3 near_far = vGetNearFarLogFactor();","float near = near_far.x;","float far = near_far.y;","float fragDepth;","if (isPerspective) {","fragDepth = (1.0/linearDepth - 1.0/near)/(1.0/far - 1.0/near);","} else {","fragDepth = (linearDepth - near)/(far - near);","}","vSetFragDepth(fragDepth);","return viewPositionOnCylinder;","}"].join("\n")}i.setPDSFXOverridableFunctions(g,f);return i},setName:function(f){this._name=f},});return UWA.namespace("THREEDS/Nodes/InstancedCylinderImpostorsNode",b)});define("SceneGraphNodes/InstancedCylinderImpostorsNode",["DS/SceneGraphNodes/InstancedCylinderImpostorsNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/InstancedCylinderImpostorsNode");return b});define("DS/SceneGraphNodes/InstancedSphereImpostorsNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/Mesh3D","DS/Mesh/MeshUtils"],function(c,e,b,d){var a=e.extend({init:function(h){this._isIE11=((new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)!=null));this._name=h.name||"sphereImpostors";this._parent(this._name);var w=h.material?h.material:new c.MeshPhongMaterial({force:true});w.transparent=true;var r=this._createMaterial(w);var n=h.nbInstances||1;var t=null;if(this._isIE11){t=this._createCoarseImpostor(8,r)}else{t=this._createFlatImpostor(6,r)}var m=new b(t,"");var y=h.positions;var k=h.radii;var u=h.colors;var s=new c.Vector3(Infinity,Infinity,Infinity);var v=new c.Vector3(-Infinity,-Infinity,-Infinity);var q=new Float32Array(n*4);var l=new Float32Array(n*2);for(var x=0;x<n;x++){q[4*x]=y[3*x];q[4*x+1]=y[3*x+1];q[4*x+2]=y[3*x+2];q[4*x+3]=k[x];l[2*x]=Math.floor(255*u[4*x])+Math.floor(255*u[4*x+1])*256+Math.floor(255*u[4*x+2])*65536;l[2*x+1]=u[4*x+3];s.x=Math.min(s.x,y[3*x]-k[x]);s.y=Math.min(s.y,y[3*x+1]-k[x]);s.z=Math.min(s.z,y[3*x+2]-k[x]);v.x=Math.max(v.x,y[3*x]+k[x]);v.y=Math.max(v.y,y[3*x+1]+k[x]);v.z=Math.max(v.z,y[3*x+2]+k[x])}var z=new c.Vector3().addVectors(s,v).multiplyScalar(0.5);var o=new c.Vector3().addVectors(z,new c.Vector3().subVectors(s,z).multiplyScalar(1.05));var p=new c.Vector3().addVectors(z,new c.Vector3().subVectors(v,z).multiplyScalar(1.05));var f=new c.Box3(o,p);var j={data:q,type:"v4",isFlattened:true,attribName:"instancePositionAndRadius"};var g={data:l,type:"v2",isFlattened:true,attribName:"instanceColor"};m.setMaterial(r);m.setInstancingParameters(n,[j,g],"instance");m.forceBoundingBox(f);this.addChild(m);return this},_createFlatImpostor:function(t,n){var q=[];var s=new c.BufferGeometryDS();s.drawingGroups=[];var o=t*3;var r=new d.DrawingGroup(n,n,4,0,o);r.geometry=s;s.drawingGroups.push(r);var u=t+1;var p=new Float32Array(u*3);var h=0;var f;p[h++]=0;p[h++]=0;p[h++]=0;for(var l=0;l<t;l++){f=l/t;p[h++]=Math.cos(f*2*Math.PI);p[h++]=Math.sin(f*2*Math.PI);p[h++]=0}s.vertexPositionArray=p;var m=new Uint16Array(o);var g=0;for(var l=0;l<t;l++){m[g++]=0;m[g++]=l+1;m[g++]=(l+2)>6?(l+2)%t:(l+2)}s.vertexIndexArray=m;q.push(s);var v=new c.Mesh(q,n);v.matrixAutoUpdate=false;return v},_createCoarseImpostor:function(p,q){var o=[];var r=new c.BufferGeometryDS();r.drawingGroups=[];var n=6*p*(p-1);var w=new d.DrawingGroup(q,q,4,0,n);w.geometry=r;r.drawingGroups.push(w);var z=2+(p-1)*p;var t=new Float32Array(z*3);var s=0;var h=0;var g=0;t[s++]=0;t[s++]=0;t[s++]=-1;var l=0;var x=0;for(var v=0;v<p;v++){for(var u=-p/2+1;u<=p/2-1;u++){h=v/p;g=u/p;l=h*2*Math.PI;x=(g)*Math.PI;t[s++]=Math.cos(l)*Math.cos(x);t[s++]=Math.sin(l)*Math.cos(x);t[s++]=Math.sin(x)}}t[s++]=0;t[s++]=0;t[s++]=1;r.vertexPositionArray=t;var m=new Uint16Array(n);s=0;var y=0;for(var v=0;v<p;v++){y=v===(p-1)?(z-2):(z-1);m[s++]=0;m[s++]=((v+1)*(p-1)+1)%y;m[s++]=v*(p-1)+1;for(var u=1;u<p-1;u++){m[s++]=((v+1)*(p-1)+u)%y;m[s++]=v*(p-1)+u+1;m[s++]=v*(p-1)+u;m[s++]=((v+1)*(p-1)+u)%y;m[s++]=((v+1)*(p-1)+u+1)%y;m[s++]=v*(p-1)+u+1}m[s++]=((v+1)*(p-1)+p-1)%y;m[s++]=z-1;m[s++]=v*(p-1)+p-1}r.vertexIndexArray=m;o.push(r);var f=new c.Mesh(o,q);f.matrixAutoUpdate=false;return f},_createMaterial:function(f){var g=f;g.activatePDSFX();g.setPDSFXVaryings({viewCenterPos:{type:"v3"},radius:{type:"f"},radius2:{type:"f"},vaColor:{type:"v4"},rightAndLeft:{type:"v2"}});g.setPDSFXGlobalShaderCode(["float _radius;","float _radius2;","vec4 instancePosition;",].join("\n"),["vec3 newViewPosition;","bool toDiscard;","bool isPerspective;","vec2 viewport;","vec3 intersectionWithSpherePERSP(in vec3 ray) {","vec3 cameraToCenter = viewCenterPos;","float adjacentInTriangle = dot(cameraToCenter, ray);","float distRayToCenter2 = dot(cameraToCenter, cameraToCenter) - adjacentInTriangle * adjacentInTriangle;","if (distRayToCenter2 > (radius*radius)) {","toDiscard = true;","return vec3(0.0,0.0,0.0);","}","float projToIntersection = sqrt(radius*radius - distRayToCenter2);","float cameraToIntersection = adjacentInTriangle - projToIntersection;","return cameraToIntersection * ray;","}","vec3 intersectionWithSphereORTHO(in vec3 ray) {","vec3 viewRayBase = vec3((2.0*(gl_FragCoord.xy/viewport.xy) - 1.0)*rightAndLeft.xy, 0.0);","vec2 projToCenter = viewCenterPos.xy - viewRayBase.xy;","float distRayToCenter2 = dot(projToCenter,projToCenter);","if (distRayToCenter2 > radius2) {","toDiscard = true;","return vec3(0.0,0.0,0.0);","}","float projToIntersection = sqrt(radius2 - distRayToCenter2);","vec3 projRayOnImpostor = vec3(viewRayBase.xy, viewCenterPos.z);","return projRayOnImpostor - projToIntersection*ray;","}"].join("\n"));var i={ComputeCommonValues:["void ComputeCommonValues() {","_radius = instancePositionAndRadius.w;","_radius2 = _radius * _radius;","instancePosition = vec4(instancePositionAndRadius.xyz, 0.0);","}"].join("\n"),ComputeVaryingValues:["void ComputeVaryingValues() {","radius = _radius;","radius2 = _radius2;","vec4 color;","color.a = instanceColor.y;","color.b = floor(instanceColor.x / 65536.0);","float tmp = instanceColor.x - color.b * 65536.0;","color.g = floor(tmp / 256.0);","color.r = floor(tmp - color.g * 256.0);","color.xyz /= 255.0;","#ifdef GAMMA_INPUT","vaColor = color * color;","#else","vaColor = color;","#endif","mat4 pMatrix = vGetProjectionMatrix();","rightAndLeft = vec2(1.0/pMatrix[0][0], 1.0/pMatrix[1][1]);","}"].join("\n")};if(this._isIE11){i.ProcessViewTangentSpace=["void ProcessViewTangentSpace(inout TangentSpace ioWorldViewTS) {","viewCenterPos = vec3(vGetViewMatrix()*vec4(instancePosition.xyz,1.0));","vec3 localPos = 1.1*_radius*vGetAttribPosition();","ioWorldViewTS.Position = vec3(vGetWorldViewMatrix() * vec4( instancePosition.xyz + localPos, 1.0));","}"].join("\n")}else{i.ProcessViewTangentSpace=["void ProcessViewTangentSpace(inout TangentSpace ioWorldViewTS) {","vec3 localPos = vGetAttribPosition();","mat4 pMatrix = vGetProjectionMatrix();","bool isPersp = pMatrix[2][3] == -1.0;","float minScale;","viewCenterPos = vec3(vGetViewMatrix()*vec4(instancePosition.xyz,1.0));","if (isPersp) {","vec3 CR = - viewCenterPos;","float CR_L = length(CR);","float CR_L_2 = CR_L*CR_L;","float d = sqrt(CR_L_2 - _radius2);","vec3 CP = localPos;","float dotCRCP = dot(CR,CP);","vec3 CR_y = CR - dotCRCP*CP;","vec2 _R = vec2(dotCRCP, length(CR_y));","float _Y1 = _radius*(_radius*_R.y + d*_R.x)/CR_L_2;","float _X1 = (_radius2 - _Y1*_R.y)/_R.x;","float _Y2 = _radius*(_radius*_R.y - d*_R.x)/CR_L_2;","float _X2 = (_radius2 - _Y2*_R.y)/_R.x;","float minScale1 = abs(_radius2/_X1);","float minScale2 = abs(_radius2/_X2);","minScale = max(minScale1, minScale2);","float bonusCoeff = (minScale - _radius)*0.1547005/(0.4*_radius) + 1.0;","minScale = minScale*1.1547005*bonusCoeff;","minScale = min(_radius*1.8, minScale);","if (abs(dotCRCP) < 0.0001) minScale = _radius*1.1547;","} else {","minScale = _radius*1.1547;","}","ioWorldViewTS.Position = vec3( viewCenterPos + minScale * localPos);","}"].join("\n")}var h={ComputeCommonValues:["void ComputeCommonValues() {","toDiscard = false;","mat4 pMatrix = vGetProjectionMatrix();","viewport = vec2(vGetViewportSize());","isPerspective = pMatrix[2][3] == -1.0;","if(isPerspective) {","vec3 ray = normalize(vGetViewPosition());","newViewPosition = intersectionWithSpherePERSP(ray);","} else {","vec3 ray = vec3(0.0, 0.0, -1.0);","newViewPosition = intersectionWithSphereORTHO(ray);","}","}"].join("\n"),ComputeDiscard:["bool ComputeDiscard() {","return toDiscard;","}"].join("\n"),ComputeAlbedo:["vec3 ComputeAlbedo() {","	return vaColor.xyz;","}"].join("\n"),ComputeViewNormal:["vec3 ComputeViewNormal() {","return normalize(newViewPosition - viewCenterPos);","}"].join("\n")};if(this._isIE11){h.ComputeViewPosition=["vec3 ComputeViewPosition() {","return newViewPosition;","}"].join("\n")}else{h.ComputeViewPosition=["vec3 ComputeViewPosition() {","float linearDepth = -newViewPosition.z;","vec3 near_far= vGetNearFarLogFactor();","float near = near_far.x;","float far = near_far.y;","float fragDepth;","if (isPerspective) {","fragDepth = (1.0/linearDepth - 1.0/near)/(1.0/far - 1.0/near);","} else {","fragDepth = (linearDepth - near)/(far - near);","}","vSetFragDepth(fragDepth);","return newViewPosition;","}"].join("\n")}g.setPDSFXOverridableFunctions(i,h);return g},setName:function(f){this._name=f},});return UWA.namespace("THREEDS/Nodes/InstancedSphereImpostorsNode",a)});define("SceneGraphNodes/InstancedSphereImpostorsNode",["DS/SceneGraphNodes/InstancedSphereImpostorsNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/InstancedSphereImpostorsNode");return b});define("DS/SceneGraphNodes/CSS3DNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D"],function(b,c){var a=c.extend({init:function(h,k,g){this._parent(g);this.scale=k?k:1;this.css3DNode=new b.CSS3DNode(h);var f=this.createRenderable();var i=h.style.width;i=i.substring(0,i.length-2);var e=h.style.height;e=e.substring(0,e.length-2);var d=0.5*k*Math.sqrt(i*i+e*e);this.hasExplicitBE=true;this.explicitBSphere=new b.Sphere(new b.Vector3(0,0,0),d);this.explicitBBox=null;f.matrixAutoUpdate=false;f.visible=this.css3DNode.visible;var j=this._occurrences[0];j.renderable=f;j.renderable.name=this.name;j.renderable._occurrence=j;j.renderable.scaleCSS=new b.Matrix4().scale(new b.Vector3(this.scale,this.scale,this.scale));if(document.getElementById("camera")){document.getElementById("camera").appendChild(this.css3DNode.element)}return this},createRenderable:function(){var d=new b.CSS3DNode(this.css3DNode.element);d.matrixAutoUpdate=false;d.matrixWorldNeedsUpdate=false;d.pickable=true;d.visible=this.css3DNode.visible;return d},setPickability:function(d){this.css3DNode.element.style.pointerEvents=(d?"auto":"none")},add:function(){return false},getNodeType:function(){return"CSS3DNode"},clone:function(){var d=new b.CSS3DNode(this.css3DNode.element);return new THREEDS.Nodes.CSS3DNode(d.element,this.name)}});return UWA.namespace("THREEDS/Nodes/CSS3DNode",a)});define("SceneGraphNodes/CSS3DNode",["DS/SceneGraphNodes/CSS3DNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/CSS3DNode");return b});define("DS/SceneGraphNodes/DirectionalLightNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/LightNode3D"],function(c,a){var b=a.extend({init:function(f,e){if(!f){f={}}var d=new c.DirectionalLight(f.color,f.intensity);if(!f.target){d.target=null}else{d.target=new c.Object3D();d.target.position=f.target}this._previousTarget=d.target;this._parent(d,e);return this},castShadows:function(e,g){var j=this._occurrences.length;if(e){this.light3js.castShadow=true;if(g){var d=false;if(g.bias){this.light3js.shadowBias=g.bias}if(g.left){this.light3js.shadowCameraLeft=g.left}if(g.right){this.light3js.shadowCameraRight=g.right}if(g.bottom){this.light3js.shadowCameraBottom=g.bottom}if(g.top){this.light3js.shadowCameraTop=g.top}if(g.near){this.light3js.shadowCameraNear=g.near}if(g.far){this.light3js.shadowCameraFar=g.far}if(g.darkness){this.light3js.shadowDarkness=g.darkness}if(g.mapWidth){this.light3js.shadowMapWidth=g.mapWidth;d=true}if(g.mapHeight){this.light3js.shadowMapHeight=g.mapHeight;d=true}if(this.light3js.shadowMap&&d){this.light3js.shadowMap.dispose();this.light3js.shadowMap=null;this.light3js.updateShadowMap=true}}for(var h=0;h<j;h++){var f=this._occurrences[h].renderable;f.castShadow=true;if(g){var d=false;if(g.bias){f.shadowBias=g.bias}if(g.left){f.shadowCameraLeft=g.left}if(g.right){f.shadowCameraRight=g.right}if(g.bottom){f.shadowCameraBottom=g.bottom}if(g.top){f.shadowCameraTop=g.top}if(g.near){f.shadowCameraNear=g.near}if(g.far){f.shadowCameraFar=g.far}if(g.darkness){f.shadowDarkness=g.darkness}if(g.mapWidth){f.shadowMapWidth=g.mapWidth;d=true}if(g.mapHeight){f.shadowMapHeight=g.mapHeight;d=true}if(f.shadowMap&&d){f.shadowMap.dispose();f.shadowMap=null;f.updateShadowMap=true}}}}else{this.light3js.castShadow=false;for(var h=0;h<j;h++){this._occurrences[h].renderable.castShadow=false}}},attachToViewpoint:function(d){if(this._attachedToVpt!=d){var f=this._occurrences.length;if(!d){this.light3js.target=this._previousTarget;for(var e=0;e<f;e++){this._occurrences[e].renderable.target=this._previousTarget}}else{this.light3js.target=new c.Object3D();this.light3js.target.position=new c.Vector3(0,0,0);for(var e=0;e<f;e++){this._occurrences[e].renderable.target=new c.Object3D();this._occurrences[e].renderable.target.position=new c.Vector3(0,0,0)}}}this._attachedToVpt=d},setTarget:function(g){var f=null;if(g){var f=new c.Object3D();f.position=g}this.light3js.target=f;this._previousTarget=f;if(!this._attachedToVpt){var e=this._occurrences.length;for(var d=0;d<e;d++){this._occurrences[d].renderable.target=f}}},getNodeType:function(){return"LightNode3D"},getLightNodeType:function(){return"DirectionalLightNode3D"}});return UWA.namespace("THREEDS/Nodes/DirectionalLight",b)});define("SceneGraphNodes/DirectionalLightNode",["DS/SceneGraphNodes/DirectionalLightNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/DirectionalLightNode");return b});define("DS/SceneGraphNodes/PolyLineSectionUtils",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/OccurrenceRenderingOverride"],function(b,i,g,j){var h={makeClosedPolyLine:function(m,l,r){var o=new i.Vector3();o.subVectors(l.center,m.planeOrigin);var n=new i.Vector2(o.dot(m.planeU),o.dot(m.planeV));var p={xmin:n.x-l.radius,ymin:n.y-l.radius,xmax:n.x+l.radius,ymax:n.y+l.radius};var q=new d(p,m,r);var k=q.buildPolyLine();return k}};function c(k,p,o,n){var m=new i.Vector2();m.subVectors(p,k);var l=new i.Vector2();l.subVectors(o,n);return a(k,m,o,l)}function a(o,A,n,z){var w=A.y,s=-A.x,q=A.x*o.y-A.y*o.x;var l=z.y,k=-z.x,p=z.x*n.y-z.y*n.x;var m=w*k-s*l;if(m===0){return null}var t=(s*p-q*k)/m;var r=-(w*p-q*l)/m;return new i.Vector2(t,r)}function e(k,o,m){var n=new i.Vector2();n.subVectors(o,k);var l=new i.Vector2();l.subVectors(m,k);return n.dot(l)>=0}function f(k,q,p){var o=new i.Vector2();o.subVectors(q,k);var n=new i.Vector2();n.subVectors(p,k);var l=o.dot(n);var m=o.lengthSq();if(l>=0||l<=m){return true}return false}var d=function(l,o,n){this.bounds=l;this.points=[];this.normalExtrapolation=n;this.center=new i.Vector2((this.bounds.xmin+this.bounds.xmax)/2,(this.bounds.ymin+this.bounds.ymax)/2);this.polyLine=o;var m=[new i.Vector2(this.bounds.xmin,this.bounds.ymin),new i.Vector2(this.bounds.xmin,this.bounds.ymax),new i.Vector2(this.bounds.xmax,this.bounds.ymax),new i.Vector2(this.bounds.xmax,this.bounds.ymin)];var k;for(k=0;k<m.length;k++){this.addPoint(m[k],"corner")}};d.prototype.addPointFromLine=function(o,l,u,m,p){var s=o,n=l;if(m){s=l;n=new i.Vector2(l.x+p*(o.y-l.y),l.y-p*(o.x-l.x))}var t=false;var k=null;var r=[new i.Vector2(this.bounds.xmin,this.bounds.ymin),new i.Vector2(this.bounds.xmin,this.bounds.ymax),new i.Vector2(this.bounds.xmax,this.bounds.ymax),new i.Vector2(this.bounds.xmax,this.bounds.ymin),new i.Vector2(this.bounds.xmin,this.bounds.ymin)];var q;for(q=0;q<r.length-1&&!t;q++){k=c(s,n,r[q],r[q+1]);if(k&&e(s,n,k)){if(f(r[q],r[q+1],k)){this.addPoint(k,u);t=true}}}};d.prototype.addPoint=function(m,l){var o=new i.Vector2();o.subVectors(m,this.center);o.normalize();var r,n;if(o.y>=0){n=-1}else{n=1}r=n*Math.acos(o.x);var p,q;var k={point:m,angle:r,tag:l};for(p=0;p<this.points.length&&!q;p++){if(this.points[p].angle<r){this.points.splice(p,0,k);q=true}}if(!q){this.points.push(k)}};d.prototype.buildPolyLine=function(){var r=this.polyLine;this.addPointFromLine(new i.Vector2(r.polyLinePoints[1].x,r.polyLinePoints[1].y),new i.Vector2(r.polyLinePoints[0].x,r.polyLinePoints[0].y),"start",this.normalExtrapolation,-1);var k=r.polyLinePoints.length;this.addPointFromLine(new i.Vector2(r.polyLinePoints[k-2].x,r.polyLinePoints[k-2].y),new i.Vector2(r.polyLinePoints[k-1].x,r.polyLinePoints[k-1].y),"end",this.normalExtrapolation,+1);var l,q=-1,p=-1;for(l=0;l<this.points.length&&(q<0||p<0);l++){if(this.points[l].tag==="start"){q=l}if(this.points[l].tag==="end"){p=l}}if(q<0||p<0){return null}var n={polyLinePoints:[],planeOrigin:r.planeOrigin,planeU:r.planeU,planeV:r.planeV};n.polyLinePoints.push(this.points[q].point);var o=this.normalExtrapolation?0:1;for(l=o;l<r.polyLinePoints.length-o;l++){n.polyLinePoints.push(new i.Vector2(r.polyLinePoints[l].x,r.polyLinePoints[l].y))}n.polyLinePoints.push(this.points[p].point);var m=q<p?q+this.points.length:q;for(l=p+1;l<m;l++){n.polyLinePoints.push(this.points[l%this.points.length].point)}return n};return UWA.namespace("THREEDS/Nodes/PolyLineSectionUtils",h)});define("DS/SceneGraphNodes/PointLightNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/LightNode3D"],function(c,b){var a=b.extend({init:function(f,e){if(!f){f={}}var d=f.intensity;if(d===undefined){d=f.power?f.power/(4*Math.PI):1}var g=new c.PointLight(f.color,d,f.distance);if(f.physicalAttenuation){g.isPhysicallyAttenuated=true;g.attenuationScale=f.attenuationScale?f.attenuationScale:1/1000000}this._parent(g,e);return this},setPower:function(e){var d=e/(4*Math.PI);this.setIntensity(d)},setPhysicalAttenuation:function(d){this.light3js.isPhysicallyAttenuated=d;var f=this._occurrences.length;for(var e=0;e<f;e++){this._occurrences[e].renderable.isPhysicallyAttenuated=d}},setPhysicalAttenuationScale:function(f){this.light3js.attenuationScale=f;var e=this._occurrences.length;for(var d=0;d<e;d++){this._occurrences[d].renderable.attenuationScale=f}},castShadows:function(e,g){var j=this._occurrences.length;if(e){this.light3js.castShadow=true;if(g){var d=false;if(g.bias){this.light3js.shadowBias=g.bias}if(g.near){this.light3js.shadowCameraNear=g.near}if(g.far){this.light3js.shadowCameraFar=g.far}if(g.darkness){this.light3js.shadowDarkness=g.darkness}if(g.mapWidth){this.light3js.shadowMapWidth=g.mapWidth;d=true}if(g.mapHeight){this.light3js.shadowMapHeight=g.mapHeight;d=true}if(this.light3js.shadowMap&&d){this.light3js.shadowMap.dispose();this.light3js.shadowMap=null;this.light3js.updateShadowMap=true}}for(var h=0;h<j;h++){var f=this._occurrences[h].renderable;f.castShadow=true;if(g){var d=false;if(g.bias){f.shadowBias=g.bias}if(g.near){f.shadowCameraNear=g.near}if(g.far){f.shadowCameraFar=g.far}if(g.darkness){f.shadowDarkness=g.darkness}if(g.mapWidth){f.shadowMapWidth=g.mapWidth;d=true}if(g.mapHeight){f.shadowMapHeight=g.mapHeight;d=true}if(f.shadowMap&&d){f.shadowMap.dispose();f.shadowMap=null;f.updateShadowMap=true}}}}else{this.light3js.castShadow=false;for(var h=0;h<j;h++){this._occurrences[h].renderable.castShadow=false}}},getNodeType:function(){return"LightNode3D"},getLightNodeType:function(){return"PointLightNode3D"}});return UWA.namespace("THREEDS/Nodes/PointLight",a)});define("SceneGraphNodes/PointLightNode",["DS/SceneGraphNodes/PointLightNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/PointLightNode");return b});define("DS/SceneGraphNodes/AreaLightNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/LightNode3D"],function(c,a){var b=a.extend({init:function(e,d){var f=new c.AreaLight(e.color,e.intensity,e.width,e.height);this._areaWidth=f.width;this._areaHeight=f.height;this._parent(f,d);return this},attachToViewpoint:function(d){return null},setAreaSize:function(e,d){if(e){this._areaWidth=e}if(d){this._areaHeight=d}this._updateAreaSize()},_updateAreaSize:function(){var e,f,d;this.light3js.width=this._areaWidth;this.light3js.height=this._areaHeight;e=this._occurrences.length;for(var d=0;d<e;d++){f=this._occurrences[d];f.renderable.width=this._areaWidth;f.renderable.height=this._areaHeight}},getNodeType:function(){return"LightNode3D"},getLightNodeType:function(){return"AreaLightNode3D"}});return UWA.namespace("THREEDS/Nodes/AreaLight",b)});define("SceneGraphNodes/AreaLightNode",["DS/SceneGraphNodes/AreaLightNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/AreaLightNode");return b});define("DS/SceneGraphNodes/BillBoardNode3D",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events"],function(h,g,a){var f=new h.Projector();var e=new h.Vector3();var i=new h.Matrix4();var d=new h.Matrix4();var c=new h.Matrix4();var b=g.extend({init:function(j){this._parent(j.name);this._isDynamic=true;this.BillBoardType=j.type;this.constraintAxis=null;if(j.constraintAxis){this.constraintAxis=j.constraintAxis.clone()}if(j.attachedPoint){this.attachedPoint=j.attachedPoint.clone()}var k=this;this.cbChange=function(p){var u;if(k.isInstance()){for(var q=0;q<k._occurrences.length;q++){var o=k._occurrences[q];var l=o.parent;if(!o.scene3js){continue}var s=o.scene3js.viewer;var n=true;if(o._getVisibilityFree()){n=o._getVisible()}else{n=s.getVisibleSpace()?o._getVisible():!o._getVisible()}if(n){if(p&&p.viewpoint&&p.viewpoint.viewer){if(s!==p.viewpoint.viewer){continue}}var t=s.currentViewpoint;u=k._getDynamicMatrix(l.matrix,p,t);o.matrix.multiplyMatrices(l.matrix,u);for(var m=0;m<o.children.length;m++){k._updateOccurrences(o,o.children[m],true)}}}}else{var r=k.parents[0];if(r){var o=r._occurrences[0];if(!o.scene3js){return}var s=o.scene3js.viewer;var n=true;if(o._getVisibilityFree()){n=o._getVisible()}else{n=s.getVisibleSpace()?o.visible:!o.visible}if(n){if(p&&p.viewpoint&&p.viewpoint.viewer){if(s!==p.viewpoint.viewer){return}}var t=s.currentViewpoint;u=k._getDynamicMatrix(r.getMatrixWorld(),p,t);k.setMatrix(u)}}}};this.tokenChange=null;return this},isPointOfViewDependant:function(){return true},_onLinkedToSceneGraph:function(){var j=this;this.tokenChange=a.subscribe({event:"/VISU/"},function(k){if(k.eventType==="@onViewpointChange"){j.cbChange(k)}})},_onUnlinkedToSceneGraph:function(){a.unsubscribe(this.tokenChange)},setBillboardType:function(j){this.BillBoardType=j;this.cbChange()},getNodeType:function(){return"BillBoardNode3D"},_getDynamicMatrix:function(j,m,o){if(!j){i.identity();j=i}var l=o?o:m.viewpoint;var k=l.camera;var n=k.getLookAt();n.add(k.position);c.identity();c.extractRotation(j);if(this.BillBoardType==="Spherical"){d.identity();d.lookAt(k.position,n,k.up)}else{this._ComputeCylindricalTransform(k,k.position,n,j,(this.BillBoardType==="PseudoSpherical"))}i.getInverse(c);c.multiplyMatrices(i,d);if(this._matrix){c.setPosition(e.getPositionFromMatrix(this._matrix))}return c},_ComputeCylindricalTransform:function(){var o=new h.Vector3();var m=new h.Vector3();var l=new h.Vector3();var k=new h.Vector3();var p=new h.Vector3();var n=new h.Vector3();var j=new h.Vector3();return function(u,q,t,s,v){if(this.constraintAxis){m.copy(this.constraintAxis).transformDirection(s).normalize()}else{m.set(s.elements[8],s.elements[9],s.elements[10]).normalize()}if(v){j.getPositionFromMatrix(s);o.subVectors(j,q);n.addVectors(j,m);var r=j.clone();f.projectVector(r,u);f.projectVector(n,u);n.z=r.z;f.unprojectVector(n,u);n.sub(j);n.normalize();m.copy(n)}else{o.subVectors(t,q)}o.normalize();l.crossVectors(o,m);if(l.lengthSq()<1e-10){var w=Math.abs(o.z)<0.999?p.set(0,0,1):p.set(1,0,0);l.crossVectors(w,o)}l.normalize();k.crossVectors(m,l);k.normalize();d.set(l.x,k.x,m.x,0,l.y,k.y,m.y,0,l.z,k.z,m.z,0,0,0,0,1);return d}}(),setConstraintAxis:function(j){this.constraintAxis=j}});return UWA.namespace("THREEDS/Nodes/BillBoard",b)});define("SceneGraphNodes/BillBoardNode3D",["DS/SceneGraphNodes/BillBoardNode3D","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/BillBoardNode3D");return b});define("DS/SceneGraphNodes/CanvasNodeTexture",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events","DS/Mesh/MeshUtils"],function(c,g,a,f){var e=["map","transparent","alphaTest","force","canvasNodeTextureSize","canvasNodeTextureSaveParams"];var d=true;var b=g.extend({init:function(h){this.width=h.width;this.height=h.height;this.longestEdge=this.width>=this.height?"width":"height";this.maxZoom=h.maxZoom||null;this.maxPow=this.maxZoom?Math.floor(Math.log(this.maxZoom)/Math.log(2)):null;this.drawCB=h.drawCB;this.rectangleTexture=h.rectangleTexture||false;this.viewer=h.webGLV6Viewer;this.alphaTest=h.alphaTest;this.depthWrite=h.depthWrite;this.tick=0;this.materials={};this.lastTexture=null;this._canvas2DTexture=null;this._canvas2DCanvas=null;this.setMaterialParams(h.materialParams)},setMaterialParams:function(i){this.materialParams=i||{};var h;for(h in this.materials){this._updateMaterialWithParams(this.materials[h].material,this.materialParams)}},requestRedraw:function(){this._requestRedraw()},_updateMaterialWithParams:function(i,j){var h;if(i.canvasNodeTextureSaveParams){for(h in i.canvasNodeTextureSaveParams){i[h]=i.canvasNodeTextureSaveParams[h]}}for(h in j){if(e.indexOf(h)===-1){if(!i.canvasNodeTextureSaveParams){i.canvasNodeTextureSaveParams={}}i.canvasNodeTextureSaveParams[h]=i[h];i[h]=j[h]}}},startAnimation:function(h,i){this.animationDeltaTime=h;this.tick=-1;this._animationStep(i)},_animationStep:function(h){this.tick++;this.requestRedraw();if(h){h.render()}setTimeout(this._animationStep.bind(this,h),this.animationDeltaTime)},_requestRedraw:function(){var h;for(h in this.materials){this.materials[h].redrawRequested=true}if(this._canvas2DTexture){this._canvas2DTexture.redrawRequested=true}},_getCanvas2DTexture:function(){if(!this._canvas2DTexture){var h=document.createElement("canvas");h.width=this.width;h.height=this.height;this._canvas2DTexture=new c.Texture(h,undefined,c.ClampToEdgeWrapping,c.ClampToEdgeWrapping,c.NearestFilter,c.NearestFilter);this._canvas2DCanvas=h;this._redrawCanvas2DTexture()}return this._canvas2DTexture},_redrawCanvas2DTexture:function(){this._drawToCanvas(this._canvas2DCanvas,this.width,this.height);this._canvas2DTexture.needsUpdate=true;this._canvas2DTexture.redrawRequested=false},_buildMaterial:function(l,j,h,k){var i={};i.canvas=document.createElement("canvas");i.canvas.width=j;i.canvas.height=h;b.totalAllocatedTextures+=i.canvas.width*i.canvas.height;i.useCount=0;this._drawToCanvas(i.canvas,j,h);i.texture=new c.Texture(i.canvas,undefined,c.ClampToEdgeWrapping,c.ClampToEdgeWrapping,c.LinearFilter,c.LinearMipMapLinearFilter);i.texture.anisotropy=16;i.texture.needsUpdate=true;if(k){k.map=i.texture;c.cleanDeferredCache(k.id);k.updateDeferredMaterials();i.material=k}else{i.material=new c.MeshBasicMaterial({transparent:true,force:true,map:i.texture})}if(this.alphaTest!==undefined){i.material.alphaTest=this.alphaTest}if(this.depthWrite!==undefined){i.material.depthWrite=this.depthWrite}i.material.canvasNodeTextureSize=l;this._updateMaterialWithParams(i.material,this.materialParams);i.redrawRequested=false;return i},_drawToCanvas:function(l,m,h){var i=l.getContext("2d");i.setTransform(1,0,0,1,0,0);i.clearRect(0,0,m,h);i.globalAlpha=1;var j=Math.max(m,h)/Math.max(this.width,this.height);i.scale(j,j);this.drawCB(this,i,this.tick,j)},_getNewMaterial:function(w,k){var n=(k&&k.canvasNodeTextureSize)?k:null;var o=w;var l=11;if(this.maxPow!==null){l=this.maxPow}var p=0.01024;if(this.rectangleTexture){o=w/this[this.longestEdge];if(this.maxPow===null){var h=Math.ceil(Math.log(this[this.longestEdge])/Math.log(2)+p);l=Math.max(0,l-h)}}var q=Math.ceil(Math.log(o)/Math.log(2)+p);q=Math.min(q,l);var v=Math.pow(2,q);var i=this.rectangleTexture?Math.floor(v*this.width):v;var u=this.rectangleTexture?Math.floor(v*this.height):v;if(i===0||u===0){i=16;u=16}var j=n?this.materials[n.canvasNodeTextureSize]:null;var m=j?j.canvas.width:0;var t=j?j.canvas.height:0;if(!this.materials[v]&&b.totalAllocatedTextures+i*u-m*t>b.maxAllocatedTextures){if(d){console.warn("CanvasNodeTexture: max amount of allowed texture allocation has been exceeded")}if(j){v=n.canvasNodeTextureSize;i=j.canvas.width;u=j.canvas.height}else{v=this.rectangleTexture?1:512;i=this.rectangleTexture?this.width:v;u=this.rectangleTexture?this.height:v}}var s=this.materials[v];var r;if(!n||n.canvasNodeTextureSize!==v){if(n){r=this._releaseMaterial(n)}if(!s){this.materials[v]=this._buildMaterial(v,i,u,r);s=this.materials[v]}s.useCount++;if(r&&s.material!==r){r.dispose()}}if(s&&s.redrawRequested){this._drawToCanvas(s.canvas,i,u);s.texture.needsUpdate=true;s.redrawRequested=false}return s?s.material:null},_releaseMaterial:function(i){if(i.canvasNodeTextureSize){var h=i?this.materials[i.canvasNodeTextureSize]:null;var i;h.useCount--;if(h.useCount<=0){b.totalAllocatedTextures-=h.canvas.width*h.canvas.height;i=this.materials[i.canvasNodeTextureSize].material;i.map.dispose();i.map=null;delete this.materials[i.canvasNodeTextureSize];return i}}return null}});b.totalAllocatedTextures=0;b.maxAllocatedTextures=4096*4096;b.enableMemoryWarning=function(h){d=h};return b});define("DS/SceneGraphNodes/Canvas2DNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events","DS/Mesh/MeshUtils"],function(c,e,a,d){var b=e.extend({init:function(i,g){this._parent(i.name);this.hotspot=i.hotspot||new c.Vector2(0,0);this.canvasNodeTexture=i.canvasNodeTexture;var h=this.canvasNodeTexture._getCanvas2DTexture();this.material=new c.ShaderMaterialDS({transparent:true,side:c.DoubleSide,depthTest:false,uniforms:{hotspot:{type:"v2",value:this.hotspot},pixelSize:{type:"v2",value:new c.Vector2(2/400,2/400)},size:{type:"v2",value:new c.Vector2(this.canvasNodeTexture.width,this.canvasNodeTexture.height)},map:{type:"t",value:h},highlight:{type:"i",value:0}},vertexShaderPars:["uniform vec2 pixelSize;","uniform vec2 hotspot;","uniform vec2 size;","varying vec2 vUv;","varying vec2 screenPosition;"].join("\n"),vertexShaderBody:["vUv = uv;",c._DefaultShaderChunk.model_view_transformation_vertex,"vec3 mvNormal = normalMatrix * normal;","gl_Position = projectionMatrix * mvPosition;","gl_Position.x += gl_Position.w * (pixelSize.x*(-hotspot.x + vUv.x*size.x));","gl_Position.y += gl_Position.w * (pixelSize.y*(-hotspot.y + vUv.y*size.y));"].join("\n"),fragmentShaderPars:["varying vec2 vUv;","uniform sampler2D map;","uniform bool highlight;"].join("\n"),fragmentShaderBody:["gl_FragColor = texture2D(map, vUv);","if(highlight) {","  float norm = length(gl_FragColor.xyz);","  gl_FragColor.xyz = (norm/1.73205)*vec3(0.0, 0.6, 1.0);","}"].join("\n")});this.material.refreshUniforms=function(o,m){var k;if(o._smallTargetPicking&&(o.materialToUse===c.MaterialToUse.pickingMaterial||o.materialToUse===c.MaterialToUse.pickingMaterialInstancing||o.materialToUse===c.MaterialToUse.normalMaterial||o.materialToUse===c.MaterialToUse.depthMaterial)){var n=o._gpuPickingTolerance*2+1;k=new c.Vector2(2/n,2/n)}else{k=new c.Vector2(2/o.domElement.width,2/o.domElement.height)}this.uniforms.pixelSize.value=k;if(window.activateCanvas2DSuperHighlight){var l=m._occurrence.node._occurrences.length>1;this.uniforms.highlight.value=!l&&m.highlight?1:0}};this.material.force=true;this.rectangle=f(this.material,g);this.rectangle.setFrustumCulled(false);this.rectangle.setMirror(false);this.rectangle.setShadow(false,false);this.addChild(this.rectangle);this.rectangle.setRenderPasses(["canvas2D"]);this.exludeFromBounding(true);var j=this;this.rectangle._setBeforeRenderCB(function(l,k){if(h.redrawRequested){j.canvasNodeTexture._redrawCanvas2DTexture()}});return this},excludeFromHighlight:function(h,g){this.rectangle.excludeFromHighlight(h,g)}});function f(p,k){var r,u,q,m,h,g,o,y,l,n,s,z,t,w,v,x;r=10;u=new d.PrimitiveGroup();u.fillAttr=new d.FillAttributes();u.lineAttr=new d.LineAttributes();u.pointAttr=new d.PointAttributes();q=new d.Buffer();q.size=12;q.component=d.VertexComponentEnum.POSITION;q.format=d.DataTypeEnum.FLOAT;q.dimension=3;q.data=new Float32Array(q.size);m=new d.Buffer();m.size=3;m.component=d.VertexComponentEnum.NORMAL;m.format=d.DataTypeEnum.FLOAT;m.dimension=3;m.data=new Float32Array(m.size);h=new d.Buffer();h.size=12;h.component=d.VertexComponentEnum.TEX_COORD_0;h.format=d.DataTypeEnum.FLOAT;h.dimension=3;h.data=new Float32Array(h.size);g=new d.Buffer();g.indexBuffer=true;g.size=4;g.format=d.DataTypeEnum.UINT;g.dimension=1;g.data=new Uint16Array(g.size);o=new d.Buffer();o.indexBuffer=true;o.size=4;o.format=d.DataTypeEnum.UINT;o.dimension=1;o.data=new Uint16Array(o.size);y=new d.Buffer();y.indexBuffer=true;y.size=4;y.format=d.DataTypeEnum.UINT;y.dimension=1;y.data=new Uint16Array(y.size);u.addBuffer(0,q);u.addBuffer(1,m);u.addBuffer(2,g);u.addBuffer(3,o);u.addBuffer(4,h);u.addBuffer(5,y);x=g.data;w=0;x[w++]=0;x[w++]=1;x[w++]=3;x[w++]=2;x=o.data;w=0;for(v=0;v<1;v++){x[w++]=v;x[w++]=v;x[w++]=v;x[w++]=v}x=y.data;w=0;x[w++]=0;x[w++]=1;x[w++]=3;x[w++]=2;x=q.data;w=0;for(w=0;w<12;w++){x[w]=0}x=m.data;w=0;x[w++]=0;x[w++]=0;x[w++]=1;x=h.data;w=0;x[w++]=0;x[w++]=0;x[w++]=0;x[w++]=1;x[w++]=0;x[w++]=0;x[w++]=1;x[w++]=1;x[w++]=0;x[w++]=0;x[w++]=1;x[w++]=0;for(v=0;v<1;v++){l=new d.Primitive();l.nbIndices=4;l.connectivity=d.ConnectivityTypeEnum.TRIANGLE_STRIP;l.attr={fill:new d.FillAttributes(new d.Color(1-v/6,0,v/6,1),1),line:new d.LineAttributes(),point:new d.PointAttributes()};n=new d.VertexComponent();n.component=d.VertexComponentEnum.POSITION;n.nbVertices=4;n.nbValuesPerVertex=3;n.format=d.DataTypeEnum.FLOAT;n.cardinality=0;n.bufferId=0;n.indices=new d.IndexArray();n.indices.format=d.DataTypeEnum.UINT;n.indices.bufferId=2;n.indices.offset=4*v;s=new d.VertexComponent();s.component=d.VertexComponentEnum.NORMAL;s.nbVertices=4;s.nbValuesPerVertex=3;s.format=d.DataTypeEnum.FLOAT;s.cardinality=0;s.bufferId=1;s.indices=new d.IndexArray();s.indices.format=d.DataTypeEnum.UINT;s.indices.bufferId=3;s.indices.offset=4*v;z=new d.VertexComponent();z.component=d.VertexComponentEnum.TEX_COORD_0;z.nbVertices=4;z.nbValuesPerVertex=3;z.format=d.DataTypeEnum.FLOAT;z.cardinality=0;z.bufferId=4;z.indices=new d.IndexArray();z.indices.format=d.DataTypeEnum.UINT;z.indices.bufferId=5;z.indices.offset=0;l.addVertexComponent(n);l.addVertexComponent(s);l.addVertexComponent(z);u.addPrimitive(l)}t=k.createMeshNode(u,p);t.setShadow(false);return t}return UWA.namespace("THREEDS/Nodes/Canvas2DNode",b)});define("DS/SceneGraphNodes/TubeLightNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/LightNode3D"],function(b,a){var c=a.extend({init:function(e,d){var f=new b.TubeLight(e.color,e.intensity,e.radius,e.width);this._radius=f.radius;this._width=f.width;this._parent(f,d);return this},setRadius:function(d){if(d){this._radius=d}this._updateRadius()},_updateRadius:function(){var e,f,d;this.light3js.radius=this._radius;e=this._occurrences.length;for(var d=0;d<e;d++){f=this._occurrences[d];f.renderable.radius=this._radius}},setWidth:function(d){if(d){this._width=d}this._updateWidth()},_updateWidth:function(){var e,f,d;this.light3js.width=this._width;e=this._occurrences.length;for(var d=0;d<e;d++){f=this._occurrences[d];f.renderable.width=this._width}},getNodeType:function(){return"LightNode3D"},getLightNodeType:function(){return"TubeLightNode3D"}});return UWA.namespace("THREEDS/Nodes/TubeLight",c)});define("SceneGraphNodes/TubeLightNode",["DS/SceneGraphNodes/TubeLightNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/TubeLightNode");return b});define("DS/SceneGraphNodes/CSS2DNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D"],function(b,c){var a=c.extend({defaultOptions:{},init:function(j,m,f,l){var i=null;var k=null;var e=null;var h=null;if(j.hasOwnProperty("html")){i=j.html;k=j.position;e=j.name;h=j.offset}else{console.warn("DEPRECATED : create your CSS2DNode with a litteral object");i=j;k=m;e=f;h=l}if(!k){k=new b.Vector3()}this._parent(e);this._element=i;var d=document.createElement("div");d.appendChild(i);d.style.display="none";d.ondragstart=function(){return false};this.css2DNode=new b.CSS2DNode(d,k,h);this.hasExplicitBE=true;this.explicitBSphere=new b.Sphere(new b.Vector3(0,0,0),1);this.explicitBBox=null;this.css2DNode.matrixAutoUpdate=false;this.css2DNode.applyMatrix(new b.Matrix4().setPosition(k));this._alwaysOnTopIndex=null;var g=this._occurrences[0];g.renderable=this.css2DNode;g.renderable.name=this.name;g.renderable._occurrence=g;if(document.getElementById("divCss2DElement")){document.getElementById("divCss2DElement").appendChild(this.css2DNode.element)}this._matrix=this.css2DNode.matrix;this._updateMatrix();this.rank=0;this.vanish=false;return this},setPickability:function(d){this.css2DNode.element.style.pointerEvents=(d?"auto":"none")},getElement:function(){return this._element},add:function(){return false},getNodeType:function(){return"CSS2DNode"},setOffset:function(d){if(d instanceof b.Vector2){this.css2DNode.offset=d.clone();this._occurrences[0].node.css2DNode.offset=this.css2DNode.offset}},getOffset:function(){return this.css2DNode.offset},setAlwaysOnTopIndex:function(d){this._alwaysOnTopIndex=d},getAlwaysOnTopIndex:function(){return this._alwaysOnTopIndex},updatePosition:function(){var i=this._getViewer();if(i){var f=this.css2DNode;var e=i.canvas;var g=i.currentViewpoint.camera;var d=new b.Vector3();d.copy(this.css2DNode.position);if(g.getLookAt().dot(g.position.clone().sub(d))<0){var h=new b.Projector();h.projectVector(d,g);f.element.style.display="block";f.element.style.left=(this.css2DNode.offset.x+(d.x+1)/2*e.width)/(window.devicePixelRatio||1)+"px";f.element.style.top=(this.css2DNode.offset.y+(-d.y+1)/2*e.height)/(window.devicePixelRatio||1)+"px"}else{f.element.style.display="none"}}},clone:function(){return new THREEDS.Nodes.CSS2DNode(this.css2DNode.element,this.css2DNode.position,this.name)}});return UWA.namespace("THREEDS/Nodes/CSS2DNode",a)});define("SceneGraphNodes/CSS2DNode",["DS/SceneGraphNodes/CSS2DNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/CSS2DNode");return b});define("DS/SceneGraphNodes/HemisphereLightNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/LightNode3D"],function(c,a){var b=a.extend({init:function(f,e){var d=new c.HemisphereLight(f.color,f.groundColor,f.intensity);this._groundColor=f.groundColor;this._parent(d,e);return this},attachToViewpoint:function(d){return null},setGroundColor:function(d){if(!d instanceof c.Color){this._groundColor=new c.Color(hex)}else{this._groundColor=d}this._updateGroundColor()},_updateGroundColor:function(){var e,f,d;this.light3js.groundColor=this._groundColor;e=this._occurrences.length;for(var d=0;d<e;d++){f=this._occurrences[d];f.renderable.groundColor=this._groundColor}},getNodeType:function(){return"LightNode3D"},getLightNodeType:function(){return"HemisphereLightNode3D"}});return UWA.namespace("THREEDS/Nodes/HemisphereLight",b)});define("SceneGraphNodes/HemisphereLightNode",["DS/SceneGraphNodes/HemisphereLightNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/HemisphereLightNode");return b});define("DS/SceneGraphNodes/FixedSizeNode3D",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events"],function(e,f,b){var d=new e.Vector3();var g=new e.Matrix4();var a=new e.Matrix4();var c=f.extend({init:function(h){var i;if(arguments.length>1){console.log("[WARNING] DEPRECATED FixedSizeNode3D construction: "+(new Error()).stack);i={name:arguments[0],ratio:arguments[1],cameraName:arguments[3],}}else{i=h||{}}this._parent(i.name);this.cameraName=i.cameraName||"camera";this._isDynamic=true;this.ratio=i.ratio;this.scaleFactor=1;var j=this;this.cbChange=function(p){if(j.isInstance()){for(var q=0;q<j._occurrences.length;q++){var o=j._occurrences[q];var l=o.parent;if(!o.scene3js||!l){continue}var s=o.scene3js.viewer;var n=true;if(o._getVisibilityFree()){n=o._getVisible()}else{n=s.getVisibleSpace()?o._getVisible():!o._getVisible()}if(n){if(p&&p.viewpoint&&p.viewpoint.viewer){if(s!==p.viewpoint.viewer){continue}}var t=s.currentViewpoint;var k=j._getDynamicMatrix(l.matrix,p,t);o.matrix.multiplyMatrices(l.matrix,k);for(var m=0;m<o.children.length;m++){j._updateOccurrences(o,o.children[m],true,true)}}}}else{var r=j.parents[0];if(!r){return}var o=r._occurrences[0];if(!o.scene3js){return}var s=o.scene3js.viewer;var n=true;if(o._getVisibilityFree()){n=o._getVisible()}else{n=s.getVisibleSpace()?o.visible:!o.visible}if(n){if(p&&p.viewpoint&&p.viewpoint.viewer){if(s!==p.viewpoint.viewer){return}}var t=s.currentViewpoint;var k=j._getDynamicMatrix(r.getMatrixWorld(),p,t);j.setMatrix(k,true)}}};this.tokenChange=null;return this},setRatio:function(h){if(h!==this.ratio){this._invalidateBoundingElements()}this.ratio=h;this.cbChange()},getRatio:function(){return this.ratio},getScaleFactor:function(){return this.scaleFactor},isPointOfViewDependant:function(){return true},_onLinkedToSceneGraph:function(){var h=this;this.tokenChange=b.subscribe({event:"/VISU/"},function(i){if(i.eventType==="@onViewpointChange"){h.cbChange(i)}})},_onUnlinkedToSceneGraph:function(){b.unsubscribe(this.tokenChange)},_getDynamicMatrix:function(i,j,m){if(!i){g.identity();i=g}var h=m?m:j.viewpoint;var l=h[this.cameraName];if(this._matrix){a.multiplyMatrices(i,this._matrix)}else{a.copy(i)}var k=a.getMaxScaleOnAxis();d.getPositionFromMatrix(a);var p=k/l.getWorldSizeFromPixelSize(1,d,h.viewer.div.clientHeight);var n=p/this.ratio;var o=n!==0?1/n:1;if(!o){o=1}if(l.fullWidth){o*=l.height/l.fullHeight}g.makeScale(o,o,o);this.scaleFactor=(this._matrix?this._matrix.getMaxScaleOnAxis():1)*o;if(this._matrix){a.multiplyMatrices(this._matrix,g);return a}else{return g}},setCameraName:function(h){this.cameraName=h||"camera"}});return UWA.namespace("THREEDS/Nodes/FixedSizeNode3D",c)});define("SceneGraphNodes/FixedSizeNode3D",["DS/SceneGraphNodes/FixedSizeNode3D","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/FixedSizeNode3D");return b});define("DS/SceneGraphNodes/DiskLightNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/LightNode3D"],function(c,b){var a=b.extend({init:function(e,d){var f=new c.DiskLight(e.color,e.intensity,e.radius);this._radius=f.radius;this._parent(f,d);return this},attachToViewpoint:function(d){return null},setRadius:function(d){if(d){this._radius=d}this._updateRadius()},_updateRadius:function(){var e,f,d;this.light3js.radius=this._radius;e=this._occurrences.length;for(var d=0;d<e;d++){f=this._occurrences[d];f.renderable.radius=this._radius}},getNodeType:function(){return"LightNode3D"},getLightNodeType:function(){return"DiskLightNode3D"}});return UWA.namespace("THREEDS/Nodes/DiskLightNode",a)});define("SceneGraphNodes/DiskLightNode",["DS/SceneGraphNodes/DiskLightNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/DiskLightNode");return b});define("DS/SceneGraphNodes/SpotLightNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/LightNode3D"],function(c,a){var b=a.extend({init:function(g,f){if(!g){g={}}var e;if(g.outerAngle!==undefined&&g.outerAngle!==null){e=Math.max(Math.min(g.outerAngle,Math.PI/2),0)}else{e=Math.PI/2}var h;if(g.innerAngle!==undefined&&g.innerAngle!==null){h=Math.max(Math.min(g.innerAngle,e-0.001),0)}else{h=e-0.001}this._outerAngle=e;this._innerAngle=h;var d=g.intensity;if(d===undefined){if(g.power){d=g.power/(Math.PI*((1-Math.cos(this._outerAngle))+(1-Math.cos(this._innerAngle))))}else{d=1}}var i=new c.SpotLight(g.color,d,g.distance,e,h);if(!g.target){i.target=null}else{i.target=new c.Object3D();i.target.position=g.target}this._previousTarget=i.target;if(g.physicalAttenuation){i.isPhysicallyAttenuated=true;i.attenuationScale=g.attenuationScale?g.attenuationScale:1/1000000}this._parent(i,f);return this},attachToViewpoint:function(d){if(this._attachedToVpt!=d){var f=this._occurrences.length;if(!d){this.light3js.target=this._previousTarget;for(var e=0;e<f;e++){this._occurrences[e].renderable.target=this._previousTarget}}else{this.light3js.target=new c.Object3D();this.light3js.target.position=new c.Vector3(0,0,0);for(var e=0;e<f;e++){this._occurrences[e].renderable.target=new c.Object3D();this._occurrences[e].renderable.target.position=new c.Vector3(0,0,0)}}}this._attachedToVpt=d},setTarget:function(g){var f=null;if(g){var f=new c.Object3D();f.position=g}this.light3js.target=f;this._previousTarget=f;if(!this._attachedToVpt){var e=this._occurrences.length;for(var d=0;d<e;d++){this._occurrences[d].renderable.target=f}}},castShadows:function(e,g){var j=this._occurrences.length;if(e){this.light3js.castShadow=true;this.light3js.shadowCameraFov=this.light3js.angle*180/Math.PI*2;if(g){var d=false;if(g.bias){this.light3js.shadowBias=g.bias}if(g.near){this.light3js.shadowCameraNear=g.near}if(g.far){this.light3js.shadowCameraFar=g.far}if(g.darkness){this.light3js.shadowDarkness=g.darkness}if(g.mapWidth){this.light3js.shadowMapWidth=g.mapWidth;d=true}if(g.mapHeight){this.light3js.shadowMapHeight=g.mapHeight;d=true}if(this.light3js.shadowMap&&d){this.light3js.shadowMap.dispose();this.light3js.shadowMap=null;this.light3js.updateShadowMap=true}}for(var h=0;h<j;h++){var f=this._occurrences[h].renderable;f.castShadow=true;f.shadowCameraFov=f.angle*180/Math.PI*2;if(g){var d=false;if(g.bias){f.shadowBias=g.bias}if(g.near){f.shadowCameraNear=g.near}if(g.far){f.shadowCameraFar=g.far}if(g.darkness){f.shadowDarkness=g.darkness}if(g.mapWidth){f.shadowMapWidth=g.mapWidth;d=true}if(g.mapHeight){f.shadowMapHeight=g.mapHeight;d=true}if(f.shadowMap&&d){f.shadowMap.dispose();f.shadowMap=null;f.updateShadowMap=true}}}}else{this.light3js.castShadow=false;for(var h=0;h<j;h++){this._occurrences[h].renderable.castShadow=false}}},setAngles:function(d,e,g){if(g){var f=this._intensity*(Math.PI*((1-Math.cos(this._outerAngle))+(1-Math.cos(this._innerAngle))))}if(d!==undefined&&d!==null){d=Math.max(Math.min(d,Math.PI/2),0)}else{d=Math.PI/2}if(e!==undefined&&e!==null){e=Math.max(Math.min(e,d-0.001),0)}else{e=d-0.001}this._outerAngle=d;this._innerAngle=e;if(g){this.setIntensity(f/(Math.PI*((1-Math.cos(this._outerAngle))+(1-Math.cos(this._innerAngle)))))}this._updateAngles();this.updateShadowMap()},_updateAngles:function(){var e,f,d;this.light3js.angle=this._outerAngle;this.light3js.innerAngle=this._innerAngle;e=this._occurrences.length;for(var d=0;d<e;d++){f=this._occurrences[d];f.renderable.angle=this._outerAngle;f.renderable.innerAngle=this._innerAngle}},setPower:function(e){var d=e/(Math.PI*((1-Math.cos(this._outerAngle))+(1-Math.cos(this._innerAngle))));this.setIntensity(d)},setPhysicalAttenuation:function(d){this.light3js.isPhysicallyAttenuated=d;var f=this._occurrences.length;for(var e=0;e<f;e++){this._occurrences[e].renderable.isPhysicallyAttenuated=d}},setPhysicalAttenuationScale:function(f){this.light3js.attenuationScale=f;var e=this._occurrences.length;for(var d=0;d<e;d++){this._occurrences[d].renderable.attenuationScale=f}},getNodeType:function(){return"LightNode3D"},getLightNodeType:function(){return"SpotLightNode3D"}});return UWA.namespace("THREEDS/Nodes/SpotLight",b)});define("SceneGraphNodes/SpotLightNode",["DS/SceneGraphNodes/PointLightNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/SpotLightNode");return b});define("DS/SceneGraphNodes/IESLightNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/LightNode3D"],function(b,a){var c=a.extend({init:function(e,d){var f=new b.IESLight(e.color,e.intensity,e.distance,e.texture);this._texture=e.texture;this._parent(f,d);return this},setIESTexture:function(d){this._texture=d;this._updateTexture()},_updateTexture:function(){var e,f,d;this.light3js.iesTexture=this._texture;e=this._occurrences.length;for(var d=0;d<e;d++){f=this._occurrences[d];f.renderable.iesTexture=this._texture}},getNodeType:function(){return"LightNode3D"},getLightNodeType:function(){return"IESLightNode3D"}});return UWA.namespace("THREEDS/Nodes/IESLight",c)});define("SceneGraphNodes/IESLightNode",["DS/SceneGraphNodes/IESLightNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/IESLightNode");return b});define("DS/SceneGraphNodes/RefPlaneNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events","DS/SceneGraphNodes/FixedSizeNode3D","WebappsUtils/WebappsUtils","DS/Mesh/MeshUtils","DS/Visualization/GeometryHelper","DS/Visualization/SceneGraphFactory","DS/Visualization/TextNode","DS/Visualization/MaterialApplication"],function(i,g,c,l,d,f,j,h,a,b){var k=new i.Matrix4();var e=g.extend({init:function(p){this._parent(p.name);this._isDynamic=true;this.matInherit=window.newMaterialInheritance;this.fixedSize=p.fixedSize;var t=this;this.cbChange=function(x){for(var u=0;u<t._occurrences.length;u++){var w=t._occurrences[u];var v=w.parent;if(!w.scene3js||!v){continue}var z=w.scene3js.viewer;var A=true;if(w._getVisibilityFree()){A=w._getVisible()}else{A=z.getVisibleSpace()?w.visible:!w.visible}if(A){if(x&&x.viewpoint&&x.viewpoint.viewer){if(z!==x.viewpoint.viewer){continue}}var y=z.currentViewpoint;t._updateNode(w.matrix,x,y)}}};this.tokenChange=null;this._length=new i.Vector2(10,10);this._frontBorderMaterial=new i.LineBasicMaterial({color:new i.Color("green"),opacity:0.7,lineWidth:2,side:2,polite:true,force:!this.matInherit,forceSide:true,enableClipPlanes:false});this._frontBorderMaterial.line=this._frontBorderMaterial;var o=this._frontBorderMaterial.color.getHSL();var q=o.h+20/255;var s=Math.min(1,1.3*o.l);this._backBorderMaterial=new i.LineBasicMaterial({color:new i.Color().setHSL(q,o.s,s),opacity:0.7,lineWidth:2,side:2,polite:true,force:!this.matInherit,forceSide:true,enableClipPlanes:false});this._backBorderMaterial.line=this._backBorderMaterial;this._frontPlaneMaterial=new i.MeshBasicMaterial({color:new i.Color("green"),opacity:0.2,side:0,polygonOffset:true,polygonOffsetFactor:0.5,force:!this.matInherit,forceSide:true,enableClipPlanes:false});var r=this._frontPlaneMaterial.color.getHSL();q=r.h+20/255;s=Math.min(1,1.3*r.l);this._backPlaneMaterial=new i.MeshBasicMaterial({color:new i.Color().setHSL(q,r.s,s),opacity:0.2,side:1,polygonOffset:true,polygonOffsetFactor:0.5,force:!this.matInherit,forceSide:true,enableClipPlanes:false});this._xIndicatorMaterial=new i.MeshBasicMaterial({color:new i.Color("green"),opacity:0.5,side:2,force:!this.matInherit,forceSide:true,depthTest:false,enableClipPlanes:false});this._margin=0.02;this._frontText={data:"",color:new i.Color("green"),opacity:0.7,size:0.5,token:null,textNode:new g()};this._backText={data:"",color:new i.Color("green"),opacity:0.7,size:0.5,token:null,textNode:new g()};this._frontPlane=this._buildEditableRectangle(false,this._frontPlaneMaterial.color,this._frontPlaneMaterial.opacity);this._frontPlaneGAS=this._frontPlane._occurrences[0].renderable.geometry[0].drawingGroups[0].gas;if(this.matInherit){var n=new b({faceMaterial:this._frontPlaneMaterial,layer:0,mergeWithGAS:true});this._frontPlane.setMaterialApplication(n);this._frontPlane.setMaterialMode(true)}else{this._frontPlane.setMaterial(this._frontPlaneMaterial)}this._frontPlane.setShadow(false);this._frontPlane.setSSAO(false);this._frontPlane.setFrustumCulled(false);this._frontPlane.setPickParent(true);this._frontPlane.excludeFromHighlight(true,true);this._backPlane=this._buildEditableRectangle(false,this._backPlaneMaterial.color,this._backPlaneMaterial.opacity);this._backPlaneGAS=this._backPlane._occurrences[0].renderable.geometry[0].drawingGroups[0].gas;if(this.matInherit){var n=new b({faceMaterial:this._backPlaneMaterial,layer:0,mergeWithGAS:true});this._backPlane.setMaterialApplication(n);this._backPlane.setMaterialMode(true)}else{this._backPlane.setMaterial(this._backPlaneMaterial)}this._backPlane.setShadow(false);this._backPlane.setSSAO(false);this._backPlane.setFrustumCulled(false);this._backPlane.setPickParent(true);this._backPlane.excludeFromHighlight(true,true);this._frontBorder=this._buildEditableRectangle(true,this._frontBorderMaterial.color,this._frontBorderMaterial.opacity);this._frontBorderGAS=this._frontBorder._occurrences[0].renderable.geometry[0].drawingGroups[0].gas;if(this.matInherit){var n=new b({lineMaterial:this._frontBorderMaterial,layer:0,mergeWithGAS:true});this._frontBorder.setMaterialApplication(n);this._frontBorder.setMaterialMode(true)}else{this._frontBorder.setMaterial(this._frontBorderMaterial)}this._frontBorder.setShadow(false);this._frontBorder.setSSAO(false);this._frontBorder.setFrustumCulled(false);this._frontBorder.setPickParent(true);this._frontBorder.setPickingPriorityId({edges:"RefPlaneEdges"});this._backBorder=this._buildEditableRectangle(true,this._backBorderMaterial.color,this._backBorderMaterial.opacity);this._backBorderGAS=this._backBorder._occurrences[0].renderable.geometry[0].drawingGroups[0].gas;if(this.matInherit){var n=new b({lineMaterial:this._backBorderMaterial,layer:0,mergeWithGAS:true});this._backBorder.setMaterialApplication(n);this._backBorder.setMaterialMode(true)}else{this._backBorder.setMaterial(this._backBorderMaterial)}this._backBorder.setShadow(false);this._backBorder.setSSAO(false);this._backBorder.setFrustumCulled(false);this._backBorder.setPickParent(true);this._backBorder.setPickingPriorityId({edges:"RefPlaneEdges"});this._fixedSizeFrontText=new l({name:"fixedSizeNodeFrontText",ratio:1});this._fixedSizeBackText=new l({name:"fixedSizeNodeBackText",ratio:1});this._fixedSizeArrowIndicator=new l({name:"fixedSizeNodeArrowIndicator",ratio:20});this._fixedSizeFrontText.setPickable(f.NOPICKABLE);this._fixedSizeBackText.setPickable(f.NOPICKABLE);this._fixedSizeArrowIndicator.setPickable(f.NOPICKABLE);this._xArrowIndicator=this._buildXIndicator(this._xIndicatorMaterial.color,this._xIndicatorMaterial.opacity);this._xArrowIndicator.setShadow(false);this._xArrowIndicator.setSSAO(false);this._xArrowIndicatorGAS=this._xArrowIndicator._occurrences[0].renderable.geometry[0].drawingGroups[0].gas;this._displayArrowOrientation=true;if(this.matInherit){var n=new b({faceMaterial:this._xIndicatorMaterial,layer:0,mergeWithGAS:true});this._xArrowIndicator.setMaterialApplication(n);this._xArrowIndicator.setMaterialMode(true)}else{this._xArrowIndicator.setMaterial(this._xIndicatorMaterial)}this._xArrowIndicator.excludeFromHighlight(true,true);this._fixedSizeArrowIndicator.addChild(this._xArrowIndicator);this._fixedSizeArrowIndicator.setMatrix(new i.Matrix4().makeTranslation(0.5*this._length.x,0,0));this.setParameters(p);var m=new g("RefPlaneNode");m.setPickParent(true);m.addChild(this._frontPlane);m.addChild(this._backPlane);m.addChild(this._frontBorder);m.addChild(this._backBorder);if(this.fixedSize){this._frontPlane._setRatio(1);this._backPlane._setRatio(1);this._frontBorder._setRatio(1);this._backBorder._setRatio(1);this._subNode=new l({name:"FixedSizeForText&Arrow",ratio:1});this._subNode.addChild(this._fixedSizeFrontText);this._subNode.addChild(this._fixedSizeBackText);this._subNode.addChild(this._fixedSizeArrowIndicator);m.addChild(this._subNode)}else{m.addChild(this._fixedSizeFrontText);m.addChild(this._fixedSizeBackText);m.addChild(this._fixedSizeArrowIndicator)}this._fixedSizeFrontText.addChild(this._frontText.textNode);this._fixedSizeBackText.addChild(this._backText.textNode);this._updateTextPosition();this.addChild(m);return this},_updateTextPosition:function(C){var v=0;if(C){var E=C.camera;var A=new i.Vector3();var m=new i.Vector3();var D=new i.Vector3();var o=new i.Vector3();var r=new i.Vector3();var q=new i.Vector3();var p=new i.Vector3();var n=new i.Vector3();var s=this._subNode?this._subNode._occurrences[0].matrix:this._occurrences[0].matrix;s.extractBasis(A,m,D);A.multiplyScalar(0.5*this._length.x);m.multiplyScalar(0.5*this._length.y);o.getPositionFromMatrix(s);r.addVectors(A,m);r.negate();r.addVectors(r,o);q.subVectors(A,m);q.addVectors(q,o);p.addVectors(A,m);p.addVectors(p,o);n.subVectors(m,A);n.addVectors(n,o);var B=C.project(r,E);var y=C.project(q,E);var x=C.project(p,E);var w=C.project(n,E);var z=0;var F=y.x-B.x;if(F>0){v=0;z=F}F=x.x-y.x;if(F>0){if(F>z){z=F;v=1}}F=w.x-x.x;if(F>0){if(F>z){z=F;v=2}}F=B.x-w.x;if(F>0){if(F>z){z=F;v=3}}}var u=(v%2)?this._length.y:this._length.x;var t=(v%2)?this._length.x:this._length.y;k.makeRotationAxis(new i.Vector3(0,0,1),0.5*Math.PI*v);k.translate(new i.Vector3(-(0.5-this._margin)*u,-(0.5-this._margin)*t,0));this._fixedSizeFrontText.setMatrix(k);k.makeRotationAxis(new i.Vector3(0,0,1),Math.PI+0.5*Math.PI*v);k.rotateY(Math.PI);k.translate(new i.Vector3(-(0.5-this._margin)*u,-(0.5-this._margin)*t,0));this._fixedSizeBackText.setMatrix(k)},setParameters:function(r){if(r.size){this._length.copy(r.size);this._updateRectangleSize(this._frontPlane);this._updateRectangleSize(this._backPlane);this._updateRectangleSize(this._frontBorder);this._updateRectangleSize(this._backBorder);this._updateTextPosition();this._fixedSizeArrowIndicator.setMatrix(new i.Matrix4().makeTranslation(0.5*this._length.x,0,0))}var n=r.planeAttributes;if(n){if(n.front){if(n.front.color){this._frontPlaneMaterial.color.copy(n.front.color);this._xIndicatorMaterial.color.copy(n.front.color);this.matInherit&&this._frontPlaneGAS._color.copy(n.front.color);this.matInherit&&this._xArrowIndicatorGAS._color.copy(n.front.color);if(!n.back||!n.back.color){var s=this._frontPlaneMaterial.color.getHSL();var q=s.h+20/255;var t=Math.min(1,1.3*s.l);this._backPlaneMaterial.color.setHSL(q,s.s,t);this.matInherit&&this._backPlaneGAS._color.copy(this._backPlaneMaterial.color)}}if(n.front.opacity){this._frontPlaneMaterial.opacity=n.front.opacity;if(this.matInherit){this._frontPlaneGAS._alpha=n.front.opacity}}}if(n.back){if(n.back.color){this._backPlaneMaterial.color.copy(n.back.color);this.matInherit&&this._backPlaneGAS._color.copy(n.back.color)}if(n.back.opacity){this._backPlaneMaterial.opacity=n.back.opacity;if(this.matInherit){this._backPlaneGAS._alpha=n.back.opacity}}}}var m=r.borderAttributes;if(m){if(m.front){if(m.front.color){this._frontBorderMaterial.color.copy(m.front.color);this.matInherit&&this._frontBorderGAS._color.copy(m.front.color);if(!m.back||!m.back.color){var p=this._frontBorderMaterial.color.getHSL();var q=p.h+20/255;var t=Math.min(1,1.3*p.l);this._backBorderMaterial.color.setHSL(q,p.s,t);this.matInherit&&this._backBorderGAS._color.copy(this._backBorderMaterial.color)}}if(m.front.opacity){this._frontBorderMaterial.opacity=m.front.opacity;if(this.matInherit){this._frontBorderGAS._alpha=m.front.opacity}}if(m.front.width){this._frontBorderMaterial.lineWidth=m.front.width}}if(m.back){if(m.back.color){this._backBorderMaterial.color.copy(m.back.color);this.matInherit&&this._backBorderGAS._color.copy(m.front.color)}if(m.back.opacity){this._backBorderMaterial.opacity=m.back.opacity;if(this.matInherit){this._backBorderGAS._alpha=m.back.opacity}}if(m.back.width){this._backBorderMaterial.lineWidth=m.back.width;this._backBorderMaterial.needsUpdate=true}}}var o=r.textAttributes;if(o){if(o.front){if(o.front.data){this._frontText.data=o.front.data}if(o.front.size){this._frontText.size=o.front.size}if(o.front.opacity){this._frontText.opacity=o.front.opacity}if(o.front.color){this._frontText.color.copy(o.front.color)}}if(o.back){if(o.back.data){this._backText.data=o.back.data}if(o.back.size){this._backText.size=o.back.size}if(o.back.opacity){this._backText.opacity=o.back.opacity}if(o.back.color){this._backText.color.copy(o.back.color)}}this._frontText.token&&this._frontText.textNode.removeChild(this._frontText.token);this._backText.token&&this._backText.textNode.removeChild(this._backText.token);if(this._frontText.data!==""){this._frontText.token=h.createTextNode({text:this._frontText.data,font:"Trebuchet MS",fontSize:this._frontText.size,color:this._frontText.color,depthWrite:false});this._frontText.token.children[0].excludeFromHighlight(true,true);this._frontText.textNode.addChild(this._frontText.token)}if(this._backText.data!==""){this._backText.token=h.createTextNode({text:this._backText.data,font:"Trebuchet MS",fontSize:this._backText.size,color:this._backText.color,depthWrite:false});this._backText.token.children[0].excludeFromHighlight(true,true);this._backText.textNode.addChild(this._backText.token)}}if(r.orientationArrow!==undefined){if(this._displayArrowOrientation!==r.orientationArrow){if(r.orientationArrow){this._fixedSizeArrowIndicator.addChild(this._xArrowIndicator)}else{this._fixedSizeArrowIndicator.removeChild(this._xArrowIndicator)}this._displayArrowOrientation=r.orientationArrow}}},_onLinkedToSceneGraph:function(){var m=this;this.tokenChange=c.subscribe({event:"/VISU/"},function(n){if(n.eventType==="@onViewpointChange"){m.cbChange(n)}})},_onUnlinkedToSceneGraph:function(){c.unsubscribe(this.tokenChange)},_getDynamicMatrix:function(){return null},_updateNode:function(u,v,w){var t=w?w:v.viewpoint;this._updateTextPosition(t);var z=t.getEyePosition();var r=u.elements;var q=new i.Vector3();q.set(r[12],r[13],r[14]);var s=new i.Vector3();s.subVectors(z,q);s.normalize();var y=new i.Vector3();y.set(r[8],r[9],r[10]);var o=s.dot(y);var n=(o>0);this._fixedSizeFrontText.setVisibility(n);this._fixedSizeBackText.setVisibility(!n);this._frontBorder.setVisibility(n);this._backBorder.setVisibility(!n);this._fixedSizeArrowIndicator.setVisibility(true);var x=(2*this._fixedSizeFrontText.getBoundingSphere().radius*this._fixedSizeFrontText.getScaleFactor()<0.9*Math.min(this._length.x,this._length.y));var p=(2*this._fixedSizeBackText.getBoundingSphere().radius*this._fixedSizeBackText.getScaleFactor()<0.9*Math.min(this._length.x,this._length.y));var m=this._fixedSizeArrowIndicator.getScaleFactor()<0.3*Math.min(this._length.x,this._length.y);this._fixedSizeFrontText.setVisibility(n&&x);this._fixedSizeBackText.setVisibility(!n&&p);this._fixedSizeArrowIndicator.setVisibility(m)},_buildXIndicator:function(){var n=new f.PrimitiveGroup();n.fillAttr=new f.FillAttributes();var r=new f.Buffer({component:f.VertexComponentEnum.POSITION,data:new Float32Array(9)});var s=new f.Buffer({component:f.VertexComponentEnum.NORMAL,data:new Float32Array(9)});n.addBuffer(0,r);n.addBuffer(1,s);var p=r.data;var q=0;p[q++]=-1;p[q++]=-0.3;p[q++]=0;p[q++]=-0.25;p[q++]=0;p[q++]=0;p[q++]=-1;p[q++]=0.3;p[q++]=0;p=s.data;q=0;for(var o=0;o<3;o++){p[q++]=0;p[q++]=0;p[q++]=1}var m=new f.Primitive({nbIndices:3,connectivity:f.ConnectivityTypeEnum.TRIANGLES,fillGAS:new f.FillAttributes()});var t=new f.VertexComponent({nbVertices:3,bufferId:0});var u=new f.VertexComponent({nbVertices:3,bufferId:1});m.addVertexComponent(t);m.addVertexComponent(u);n.addPrimitive(m);return h.createMeshNode(n)},_buildEditableRectangle:function(t,o,n){var y=new f.PrimitiveGroup();y.editable=true;y.fillAttr=new f.FillAttributes();y.lineAttr=new f.LineAttributes();y.pointAttr=new f.PointAttributes();var s=new f.Buffer({component:f.VertexComponentEnum.POSITION,data:new Float32Array(12)});var u=new f.Buffer({component:f.VertexComponentEnum.NORMAL,data:new Float32Array(12)});var v=new f.Buffer({indexBuffer:true,data:new Uint16Array(t?8:6)});y.addBuffer(0,s);y.addBuffer(1,u);y.addBuffer(2,v);var r=v.data;var q=0;if(t){r[0]=0;r[1]=1;r[2]=1;r[3]=2;r[4]=2;r[5]=3;r[6]=3;r[7]=0}else{r[q++]=0;r[q++]=1;r[q++]=2;r[q++]=0;r[q++]=2;r[q++]=3}r=s.data;q=0;r[q++]=0.5*this._length.x;r[q++]=-0.5*this._length.y;r[q++]=0;r[q++]=0.5*this._length.x;r[q++]=0.5*this._length.y;r[q++]=0;r[q++]=-0.5*this._length.x;r[q++]=0.5*this._length.y;r[q++]=0;r[q++]=-0.5*this._length.x;r[q++]=-0.5*this._length.y;r[q++]=0;r=u.data;q=0;for(var p=0;p<4;p++){r[q++]=0;r[q++]=0;r[q++]=1}var m=new f.Primitive({nbIndices:t?8:6,connectivity:t?f.ConnectivityTypeEnum.LINES:f.ConnectivityTypeEnum.TRIANGLES,fillGAS:new f.FillAttributes(new f.Color(o.r,o.g,o.b,n)),lineGAS:new f.LineAttributes(new f.Color(o.r,o.g,o.b,n))});var w=new f.VertexComponent({nbVertices:4,bufferId:0,indices:new f.IndexArray({bufferId:2,offset:0})});var x=new f.VertexComponent({nbVertices:4,bufferId:1,indices:new f.IndexArray({bufferId:2,offset:0})});m.addVertexComponent(w);m.addVertexComponent(x);y.addPrimitive(m);return h.createMeshNode(y)},_updateRectangleSize:function(n){var q=n.getBuffer(f.VertexComponentEnum.POSITION);q[0]=0.5*this._length.x;q[1]=-0.5*this._length.y;q[3]=0.5*this._length.x;q[4]=0.5*this._length.y;q[6]=-0.5*this._length.x;q[7]=0.5*this._length.y;q[9]=-0.5*this._length.x;q[10]=-0.5*this._length.y;n.updateBuffer(f.VertexComponentEnum.POSITION,0,4);var m=Math.sqrt(0.25*this._length.x*this._length.x+0.25*this._length.x*this._length.x);var p=new i.Sphere(new i.Vector3(0,0,0),m);var o=new i.Box3(new i.Vector3(-0.5*this._length.x,-0.5*this._length.y,0),new i.Vector3(0.5*this._length.x,0.5*this._length.y,0));n.forceBoundingElements(true,{sphere:p,box:o})}});return UWA.namespace("THREEDS/Nodes/RefPlaneNode",e)});define("DS/SceneGraphNodes/CanvasNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events","DS/Mesh/MeshUtils","DS/SceneGraphNodes/CanvasNodeTexture"],function(c,e,a,d,b){var g=e.extend({init:function(i,h){this._parent(i.name);this._isDynamic=true;this.bottomLeftCorner=i.bottomLeftcorner;this.vectors={};this.vectors.width=i.widthVector;this.vectors.height=i.heightVector;this.canvasNodeTexture=i.canvasNodeTexture;this.requestTextureUpdate=true;this.rectangle=f(null,this.bottomLeftCorner,this.vectors.width,this.vectors.height,i.canvasNodeTexture.rectangleTexture,h);var j=this;this.rectangle._setBeforeRenderCB(function(l,k){if(j.requestTextureUpdate&&k.viewpoint){j._textureUpdate(l,k.viewpoint,k.camera)}});this.rectangle.setSSAO(false);this.rectangle.setMirror(false);this.addChild(this.rectangle);this.cbChange=function(k){if(k.eventType==="@onViewpointChange"){j._onViewpointChange()}};this.tokenChange=null;return this},setFrustumCulled:function(){this.rectangle.setFrustumCulled.apply(this.rectangle,arguments)},_onLinkedToSceneGraph:function(){this.tokenChange=a.subscribe({event:"/VISU/"},this.cbChange)},_onUnlinkedToSceneGraph:function(){a.unsubscribe(this.tokenInit);a.unsubscribe(this.tokenChange);var h;for(h=0;h<this.rectangle._occurrences.length;h++){var j=this.rectangle._occurrences[h].renderable;if(j.material){this.canvasNodeTexture._releaseMaterial(j.material);j.material=null;if(j.highlight){j.highlight.material=null}if(j.preHighlight){j.preHighlight.material=null}}}},_getDynamicMatrix:function(h,i,j){this._onViewpointChange();return this.getMatrix()},_onViewpointChange:function(){this.requestTextureUpdate=true},_textureUpdate:function(k,n,o){var l=o.position;var j=this.bottomLeftCorner.clone();var q=this.vectors[this.canvasNodeTexture.longestEdge];var i=new c.Vector3(j.x+q.x,j.y+q.y,j.z+q.z);var p=k._getMMMatrix();j.applyMatrix4(p);i.applyMatrix4(p);var t=n.project(j,o);var s=n.project(i,o);var h=t.distanceTo(s);var r=k.material;var m=this.canvasNodeTexture._getNewMaterial(h,r);if(m){k._gsso_cache=null;k.material=m;if(k.highlight){k.highlight.material=m}if(k.preHighlight){k.preHighlight.material=m}}}});function f(t,n,x,w,s,l){var v,A,u,p,k,h,r,E,o,q,y,F,z,C,B,D;v=10;A=new d.PrimitiveGroup();A.fillAttr=new d.FillAttributes();A.lineAttr=new d.LineAttributes();A.pointAttr=new d.PointAttributes();u=new d.Buffer();u.size=12;u.component=d.VertexComponentEnum.POSITION;u.format=d.DataTypeEnum.FLOAT;u.dimension=3;u.data=new Float32Array(u.size);p=new d.Buffer();p.size=3;p.component=d.VertexComponentEnum.NORMAL;p.format=d.DataTypeEnum.FLOAT;p.dimension=3;p.data=new Float32Array(p.size);k=new d.Buffer();k.size=12;k.component=d.VertexComponentEnum.TEX_COORD_0;k.format=d.DataTypeEnum.FLOAT;k.dimension=3;k.data=new Float32Array(k.size);h=new d.Buffer();h.indexBuffer=true;h.size=4;h.format=d.DataTypeEnum.UINT;h.dimension=1;h.data=new Uint16Array(h.size);r=new d.Buffer();r.indexBuffer=true;r.size=4;r.format=d.DataTypeEnum.UINT;r.dimension=1;r.data=new Uint16Array(r.size);E=new d.Buffer();E.indexBuffer=true;E.size=4;E.format=d.DataTypeEnum.UINT;E.dimension=1;E.data=new Uint16Array(E.size);A.addBuffer(0,u);A.addBuffer(1,p);A.addBuffer(2,h);A.addBuffer(3,r);A.addBuffer(4,k);A.addBuffer(5,E);D=h.data;C=0;D[C++]=0;D[C++]=1;D[C++]=3;D[C++]=2;D=r.data;C=0;for(B=0;B<1;B++){D[C++]=B;D[C++]=B;D[C++]=B;D[C++]=B}D=E.data;C=0;D[C++]=0;D[C++]=1;D[C++]=3;D[C++]=2;D=u.data;C=0;D[C++]=n.x;D[C++]=n.y;D[C++]=n.z;D[C++]=n.x+x.x;D[C++]=n.y+x.y;D[C++]=n.z+x.z;D[C++]=n.x+x.x+w.x;D[C++]=n.y+x.y+w.y;D[C++]=n.z+x.z+w.z;D[C++]=n.x+w.x;D[C++]=n.y+w.y;D[C++]=n.z+w.z;D=p.data;C=0;D[C++]=0;D[C++]=0;D[C++]=1;var m=s?1:w.length()/x.length();D=k.data;C=0;D[C++]=0;D[C++]=1-m;D[C++]=0;D[C++]=1;D[C++]=1-m;D[C++]=0;D[C++]=1;D[C++]=1;D[C++]=0;D[C++]=0;D[C++]=1;D[C++]=0;for(B=0;B<1;B++){o=new d.Primitive();o.nbIndices=4;o.connectivity=d.ConnectivityTypeEnum.TRIANGLE_STRIP;o.attr={fill:new d.FillAttributes(new d.Color(1-B/6,0,B/6,1),1),line:new d.LineAttributes(),point:new d.PointAttributes()};q=new d.VertexComponent();q.component=d.VertexComponentEnum.POSITION;q.nbVertices=4;q.nbValuesPerVertex=3;q.format=d.DataTypeEnum.FLOAT;q.cardinality=0;q.bufferId=0;q.indices=new d.IndexArray();q.indices.format=d.DataTypeEnum.UINT;q.indices.bufferId=2;q.indices.offset=4*B;y=new d.VertexComponent();y.component=d.VertexComponentEnum.NORMAL;y.nbVertices=4;y.nbValuesPerVertex=3;y.format=d.DataTypeEnum.FLOAT;y.cardinality=0;y.bufferId=1;y.indices=new d.IndexArray();y.indices.format=d.DataTypeEnum.UINT;y.indices.bufferId=3;y.indices.offset=4*B;F=new d.VertexComponent();F.component=d.VertexComponentEnum.TEX_COORD_0;F.nbVertices=4;F.nbValuesPerVertex=3;F.format=d.DataTypeEnum.FLOAT;F.cardinality=0;F.bufferId=4;F.indices=new d.IndexArray();F.indices.format=d.DataTypeEnum.UINT;F.indices.bufferId=5;F.indices.offset=0;o.addVertexComponent(q);o.addVertexComponent(y);o.addVertexComponent(F);A.addPrimitive(o)}z=l.createMeshNode(A,t);z.setShadow(false);return z}return UWA.namespace("THREEDS/Nodes/CanvasNode",g)});define("DS/SceneGraphNodes/ArrowNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/BillBoardNode3D","WebappsUtils/WebappsUtils","DS/Mesh/MeshUtils","DS/Visualization/GeometryHelper","DS/Visualization/SceneGraphFactory"],function(j,h,a,n,c,b,e,l,i){var g=new j.Vector3();var m=new j.Matrix4();var f=new j.Matrix4();var d=new j.Matrix4();var k=h.extend({init:function(q){this._parent(q.name);this._isDynamic=true;this._headLength=q.headLength?q.headLength:20;this.viewpoint=q.viewpoint;this._initialPoint=q.initialPoint;this._finalPoint=q.finalPoint;this._head=q.head?q.head:0;this._noZ=q.removeNoZ?false:true;this.direction=new j.Vector3().subVectors(this._finalPoint,this._initialPoint);this.constraintAxis=new j.Vector3().copy(this.direction).normalize();this.arrowLength=this.direction.length();var p=null;var o=b.getWebappsAssetUrl("SceneGraphNodes","");this.mapHead=new j.ImageUtils.loadTexture(o+"models/textures/head.png",undefined,null,null,j.ImageUtils.crossOriginPolicy);this.mapHeadDisk=new j.ImageUtils.loadTexture(o+"models/textures/headDisk.png",undefined,null,null,j.ImageUtils.crossOriginPolicy);this.mapHead.anisotropy=8;this.materialArrow=new j.LineBasicMaterial({side:j.DoubleSide,color:q.color,scale:q.arrowScale?q.arrowScale:6.666,lineWidth:q.arrowWidth?q.arrowWidth:1,dashType:q.arrowDashType?q.arrowDashType:"None",linecap:"butt",transparent:true,isCPUPattern:true,alphaTest:0.05});this.materialArrow.force=true;this.materialHead=new j.MeshBasicMaterial({map:null,side:j.DoubleSide,color:q.color,transparent:true,alphaTest:0.05});this.materialHead.force=true;var u=new l();this.nodeArrowBody=i.createLineNode({points:[new j.Vector3(0,0,0),new j.Vector3(0,0,1)],material:this.materialArrow,layerNb:this._noZ?1:0});this.nodeArrowBody.setShadow(false);this.nodeArrowBody.setFrustumCulled(false);this.nodeArrowBody.setPickParent(true);this.nodeArrowBody.name="tronc de la flche";var s={constraintAxis:this.constraintAxis,name:"billBoardNode_body",type:"Cylindrical",viewpoint:this.viewpoint};this.billBoardArrowBody=new c(s);this.billBoardArrowBody.addChild(this.nodeArrowBody);this.billBoardArrowBody.setPickParent(true);this.addChild(this.billBoardArrowBody);var r=u.createRectangle({width:1,height:1,fill:true,fillColor:null,noEdge:true,layerNb:this._noZ?1:0});this.nodeArrowHead=i.createMeshNode(r,this.materialHead);this.nodeArrowHead.setShadow(false);this.nodeArrowHead.setFrustumCulled(false);this.nodeArrowHead.setPickParent(true);this.nodeArrowHead.name="tte de la flche";this.billBoardArrowHead=new c({name:"billBoardNode_head",viewpoint:this.viewpoint});this.billBoardArrowHead.addChild(this.nodeArrowHead);this.billBoardArrowHead.setPickParent(true);this.nodeArrowHeadParent=new h();this.nodeArrowHeadParent.setPickParent(true);this.addChild(this.nodeArrowHeadParent);this.nodeArrowHeadParent.addChild(this.billBoardArrowHead);this._updateData();this.setMatrix(new j.Matrix4().setPosition(this._initialPoint));this.name="CustomizableArrow";var t=this;this.cbChange=function(v){if(t.viewpoint&&(t.viewpoint!==v.viewpoint)){return}if(v.eventType==="@onViewpointChange"){t._CallBackEventHandler(v)}};this.tokenChange=null;return this},_onLinkedToSceneGraph:function(){var o=this;this.tokenChange=a.subscribe({event:"/VISU/"},this.cbChange)},_onUnlinkedToSceneGraph:function(){a.unsubscribe(this.tokenChange)},_getDynamicMatrix:function(o,p,q){this._CallBackEventHandler(p,q);return this.getMatrix()},_CallBackEventHandler:function(r,v){var q=this.getMatrixWorld();var t=q.getMaxScaleOnAxis();g.getPositionFromMatrix(this.nodeArrowHead.getMatrixWorld());var p=v?v:r.viewpoint;var u=p.camera;var w=t/u.getWorldSizeFromPixelSize(1,g,p.viewer.div.clientHeight);var x=1/w;var s=x*(this._head?this._headLength:0);var o=(this._head===2)?this.arrowLength-s/2:this.arrowLength-s;m.makeScale(s,s,s);f.makeScale(1,1,o);if(this._head===1){this.nodeArrowHeadParent.setMatrix(d);g.set(-s/2,0,0);this.nodeArrowHead.setMatrix(m.rotateX(0.5*Math.PI).setPosition(g));g.copy(this.constraintAxis).multiplyScalar(o);m.identity();this.nodeArrowHeadParent.setMatrix(m.setPosition(g))}else{if(this._head===2){g.set(-s/2,-s/2,0);this.nodeArrowHead.setMatrix(m.setPosition(g));g.copy(this.constraintAxis).multiplyScalar(o);m.identity();this.nodeArrowHeadParent.setMatrix(m.setPosition(g))}}this.nodeArrowBody.setMatrix(f);this.billBoardArrowBody.cbChange(r);this.billBoardArrowHead.cbChange(r)},updateInitialPosition:function(o){this._initialPoint=o;this.setMatrix(new j.Matrix4().setPosition(this._initialPoint));this._updateData();this._CallBackEventHandler({viewpoint:this.viewpoint})},updateFinalPosition:function(o){this._finalPoint=o;this._updateData();this._CallBackEventHandler({viewpoint:this.viewpoint})},updateColor:function(o){this.materialArrow.color=o;this.materialHead.color=o},setArrowWidth:function(o){this.materialArrow.setLineWidth(o);this._CallBackEventHandler({viewpoint:this.viewpoint})},setArrowPattern:function(o){this.materialArrow.setDashPatternType(o);this._CallBackEventHandler({viewpoint:this.viewpoint})},setArrowPatternScale:function(o){this.materialArrow.setScale(o);this._CallBackEventHandler({viewpoint:this.viewpoint})},setHeadSize:function(o){this._headLength=o;this._CallBackEventHandler({viewpoint:this.viewpoint})},setHeadType:function(o){this._head=o;this._updateData();this._CallBackEventHandler({viewpoint:this.viewpoint})},getNodeType:function(){return"ArrowNode"},_updateData:function(){this.direction.subVectors(this._finalPoint,this._initialPoint);this.constraintAxis.copy(this.direction).normalize();this.arrowLength=this.direction.length();this.billBoardArrowBody.setConstraintAxis(this.constraintAxis);switch(this._head){case 0:this.billBoardArrowHead.setVisibility(false);this.billBoardArrowHead.setVisibilityFree(true);break;case 1:this.billBoardArrowHead.setVisibility(true);this.billBoardArrowHead.setVisibilityFree(false);this.billBoardArrowHead.setConstraintAxis(this.constraintAxis);this.billBoardArrowHead.setBillboardType("PseudoSpherical");this.materialHead.map=this.mapHead;break;case 2:this.billBoardArrowHead.setVisibility(true);this.billBoardArrowHead.setVisibilityFree(false);this.billBoardArrowHead.setBillboardType("Spherical");this.materialHead.map=this.mapHeadDisk;break;default:break}}});k.types={NONE:0,ARROW:1,DISK:2};return UWA.namespace("THREEDS/Nodes/ArrowNode",k)});define("SceneGraphNodes/ArrowNode",["DS/SceneGraphNodes/ArrowNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/ArrowNode");return b});define("DS/SceneGraphNodes/FixedSizeArrowNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/BillBoardNode3D","WebappsUtils/WebappsUtils","DS/Mesh/MeshUtils","DS/Visualization/GeometryHelper","DS/Visualization/SceneGraphFactory","DS/Visualization/MaterialApplication"],function(i,g,b,k,d,c,e,j,h,a){var f=g.extend({init:function(s){this._parent(s.name);this.matInherit=window.newMaterialInheritance;this._arrowWidth=s.arrowWidth;this._headLength=s.headLength;this._arrowLength=s.arrowLength;this.viewpoint=s.viewpoint;this.globalSelection=s.globalSelection;var D=new i.Vector3(0,0,1);this._color=s.color;this._head=s.head;this._noZ=s.removeNoZ?false:true;this._pickable=s.pickable?true:false;var l=null;var w=c.getWebappsAssetUrl("SceneGraphNodes","");var x=null;if(this._head){this._headLength=(this._headLength)?this._headLength:this._arrowLength/8;x={name:"billBoardNode",viewpoint:this.viewpoint};var t=this;var B=function(){};if(this._head===1){x.constraintAxis=D;x.type="Cylindrical";l=new i.ImageUtils.loadTexture(w+"models/textures/head.png",undefined,B,B,i.ImageUtils.crossOriginPolicy)}if(this._head===2){x.type="Spherical";l=new i.ImageUtils.loadTexture(w+"models/textures/headDisk.png",undefined,B,B,i.ImageUtils.crossOriginPolicy)}}else{this._headLength=0}var y=this._arrowLength-this._headLength;var o=new j();var p=this._noZ?1:0;var n=o.createRectangle({width:this._arrowWidth,height:y,fill:true,color:new e.Color(0,0,0,1),noEdge:true,layerNb:p});var q=o.createRectangle({width:this._headLength,height:this._headLength,fill:true,color:new e.Color(0,0,0,1),noEdge:true,layerNb:p});var A=new i.MeshBasicMaterial({map:l,side:i.DoubleSide,transparent:true,alphaTest:0.05,color:this._color,force:!this.matInherit});var z=h.createMeshNode(q,!this.matInherit?A:undefined);z.setShadow(false);z.setFrustumCulled(false);if(this.globalSelection){z.setPickParent(true)}if(this.matInherit){z.setMaterialApplication(new a({faceMaterial:A,layer:0,mergeWithGAS:true}));z.setMaterialMode(true)}if(!this._pickable){z.setPickable(e.NOPICKABLE)}z.name="Arrow's head";var r=new i.MeshBasicMaterial({side:i.DoubleSide,transparent:true,alphaTest:0.05,color:this._color,force:!this.matInherit});var u=h.createMeshNode(n,!this.matInherit?r:undefined);u.setShadow(false);u.setFrustumCulled(false);if(this.globalSelection){u.setPickParent(true)}if(this.matInherit){u.setMaterialApplication(new a({faceMaterial:r,layer:0,mergeWithGAS:true}));u.setMaterialMode(true)}if(!this._pickable){u.setPickable(e.NOPICKABLE)}u.name="Arrow's body";u.setMatrix(new i.Matrix4().rotateX(0.5*Math.PI).translate(new i.Vector3(-this._arrowWidth/2,0,0)));var F={constraintAxis:D,name:"billBoardNode",type:"Cylindrical",viewpoint:this.viewpoint};var v=new d(F);if(this.globalSelection){v.setPickParent(true)}v.addChild(u);if(this._head===2){z.setMatrix(new i.Matrix4().translate(new i.Vector3(-this._headLength/2,-this._headLength/2,0)))}else{if(this._head===1){z.setMatrix(new i.Matrix4().rotateX(0.5*Math.PI).translate(new i.Vector3(-this._headLength/2,0,0)))}}if(x){var m=new d(x);if(this.globalSelection){m.setPickParent(true)}m.addChild(z);var E=new k({name:"myFixedSizeNode",ratio:1});if(this.globalSelection){E.setPickParent(true)}E.addChild(m);E.setMatrix(new i.Matrix4().setPosition(new i.Vector3().copy(D).multiplyScalar(y/D.length())))}var C=new k({name:"myFixedSizeNodeG",ratio:1});if(this.globalSelection){C.setPickParent(true)}if(x){C.addChild(E)}C.addChild(v);this.addChild(C);return this},setColor:function(l){this._color=l},setName:function(l){this._name=l},getNodeType:function(){return"FixedSizeArrowNode"}});f.types={NONE:null,ARROW:1,DISK:2};return UWA.namespace("THREEDS/Nodes/FixedSizeArrowNode",f)});define("SceneGraphNodes/FixedSizeArrowNode",["DS/SceneGraphNodes/FixedSizeArrowNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/FixedSizeArrowNode");return b});define("DS/SceneGraphNodes/FixedSizePlaneNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/BillBoardNode3D","WebappsUtils/WebappsUtils","DS/Mesh/MeshUtils","DS/Visualization/GeometryHelper","DS/Visualization/SceneGraphFactory"],function(h,f,a,j,d,c,e,i,g){var b=f.extend({init:function(s){this._parent(s.name);this.setColor(s.color);this.setName(s.name);var l=s.length?s.length:10;var r=s.origin?s.origin:new h.Vector3();var n=s.direction1?s.direction1.normalize():new h.Vector3(0,1,0);var m=s.direction2?s.direction2.normalize():new h.Vector3(1,0,0);var k=new h.Vector3().crossVectors(n,m);var p=g.createRectangleNode({color:this._color,width:l,height:l,fill:s.fill,sharing:s.sharing,cornerPoint:new h.Vector2(-l/2,-l/2)});p.setShadow(false);p.setFrustumCulled(false);var q=new h.Matrix4();q.makeBasis(n,m,k);q.setPosition(r);var o=new f("NodeForPlane");o.setMatrix(q);o.addChild(p);this.addChild(o);o._setRatio(1);return this},setColor:function(k){this._color=k},setName:function(k){this._name=k},});return UWA.namespace("THREEDS/Nodes/FixedSizePlaneNode",b)});define("DS/SceneGraphNodes/CSS2DNodeManager",["UWA/Class","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/Visualization/Viewpoint","DS/SceneGraphNodes/CSS2DNode"],function(c,a,e,d,b){var f=c.extend({options:{},init:function(g){this.billboards=[];this._divLayers=[];this.mainLayer=document.createElement("div");this.mainLayer.id="HTMLBillboards";g.divCss2DElement.appendChild(this.mainLayer);this.viewer=g;this.rank=4;this._subscribe();this.update()},add:function(h,g){if(!(h instanceof b)){return error.log("This is not a CSS2DNode")}h.rank=g?g.rank||0:0;h.vanish=g?g.vanish||false:false;this.billboards.push(h);if(!this._divLayers[h.rank]){this._divLayers[h.rank]=document.createElement("div");this._divLayers[h.rank].id="layer-"+h.rank;this.mainLayer.appendChild(this._divLayers[h.rank])}this._divLayers[h.rank].appendChild(h.css2DNode.element);this.update()},remove:function(g){if(this.billboards.indexOf(g)!==-1){this.billboards.splice(this.billboards.indexOf(g),1)}},update:function(){this.cameraPosition=this.viewer.viewpoints[0].camera.position;var j=this.viewer.getSceneBoundingSphere();this.centerScene=j.center;this.fadingDistance=j.radius;var h=0;var g=this.billboards.length;for(h=0;h<g;++h){this._follow3D(this.billboards[h])}this._zIndexManager()},_subscribe:function(){var g=this;a.subscribe({event:"/VISU/"},function(h){if(h.eventType==="@onViewpointChange"){g.update.call(g)}});a.subscribe({event:"/VISU/onWindowResized"},function(h){g.update.call(g)})},_follow3D:function(i){if(i.css2DNode.visible){i.css2DNode.element.style.display="initial";if(i.rank>this.rank){i.css2DNode.element.style.display="none";return}if(i.vanish){var h=i.css2DNode.position.clone().distanceTo(this.cameraPosition);var g=1-(h-this.fadingDistance*5)/(this.fadingDistance*15-this.fadingDistance*5);if(g<0){i.css2DNode.element.style.display="none"}else{if(g<1){i.css2DNode.element.style.opacity=g}}}}},_zIndexManager:function(){var k=this.cameraPosition;this.billboards.sort(function(i,l){return k.distanceTo(l.css2DNode.position)-k.distanceTo(i.css2DNode.position)});var h=0;var g=this.billboards.length;var j=null;for(h=0;h<g;++h){this.billboards[h].css2DNode.element.style["z-index"]=h}}});return f});define("SceneGraphNodes/CSS2DNodeManager",["DS/SceneGraphNodes/CSS2DNodeManager","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/CSS2DNodeManager");return b});define("DS/SceneGraphNodes/AxisSystemNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/BillBoardNode3D","WebappsUtils/WebappsUtils","DS/Mesh/MeshUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/FixedSizeArrowNode","DS/SceneGraphNodes/ArrowNode"],function(h,f,a,k,c,b,d,j,e,i){var g=f.extend({init:function(r){this._parent(r.name);this._sgRep=r.sgRep?r.sgRep:null;this.headLength=r.headLength;this.arrowLength=r.arrowLength;this.arrowWidth=r.arrowWidth;this.sceneGraph=r.sceneGraph;this.viewpoint=r.viewpoint;this.zoomable=r.zoomable||false;this._colorX=new d.Color(1,0,0,0);this._colorY=new d.Color(0,1,0,0);this._colorZ=new d.Color(0,0,1,0);if(r.colors){this._colorX=(r.colors.colorX)?r.colors.colorX:this._colorX;this._colorY=(r.colors.colorY)?r.colors.colorY:this._colorY;this._colorZ=(r.colors.colorZ)?r.colors.colorZ:this._colorZ}this._nameX="X";this._nameY="Y";this._nameZ="Z";if(r.names){this._nameX=(r.names.nameX)?r.names.nameX:this._nameX;this._nameY=(r.names.nameY)?r.names.nameY:this._nameY;this._nameZ=(r.names.nameZ)?r.names.nameZ:this._nameZ}this.head=r.head;var q={sceneGraph:this.sceneGraph,headLength:this.headLength,color:this._colorZ,arrowLength:this.arrowLength,arrowWidth:this.arrowWidth,head:this.head,name:this._nameZ,pickable:true,viewpoint:this.viewpoint,removeNoZ:true};var n=null;if(this.zoomable){q.initialPoint=new h.Vector3();q.finalPoint=new h.Vector3(0,0,this.arrowLength);n=new i(q)}else{n=new e(q)}var p={sceneGraph:this.sceneGraph,headLength:this.headLength,direction:new h.Vector3(1,0,0),color:this._colorX,arrowLength:this.arrowLength,arrowWidth:this.arrowWidth,head:this.head,name:this._nameX,pickable:true,viewpoint:this.viewpoint,removeNoZ:true};var m=null;if(this.zoomable){p.initialPoint=new h.Vector3();p.finalPoint=new h.Vector3(this.arrowLength,0,0);m=new i(p)}else{m=new e(p);m.setMatrix(new h.Matrix4().rotateY(Math.PI/2))}var o={sceneGraph:this.sceneGraph,headLength:this.headLength,color:this._colorY,arrowLength:this.arrowLength,arrowWidth:this.arrowWidth,head:this.head,name:this._nameY,pickable:true,viewpoint:this.viewpoint,removeNoZ:true};var l=null;if(this.zoomable){o.initialPoint=new h.Vector3();o.finalPoint=new h.Vector3(0,this.arrowLength,0);l=new i(o)}else{l=new e(o);l.setMatrix(new h.Matrix4().rotateX(-Math.PI/2))}this.addChild(l);this.addChild(m);this.addChild(n);this.setNoZ(true);return this},getNodeType:function(){return"AxisSystemNode"},getSGRep:function(){return this._sgRep}});g.types={NONE:null,ARROW:1,DISK:2};return UWA.namespace("THREEDS/Nodes/AxisSystemNode",g)});define("SceneGraphNodes/AxisSystemNode",["DS/SceneGraphNodes/AxisSystemNode","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("SceneGraphNodes/AxisSystemNode");return b});