define("DS/DMUSection/DMUCreateSectionCmd",["DS/DMUBaseCommands/EXPCommand"],function(k){var c,i,g,f,j,e,b,a,h,d;var l=k.extend({init:function(m){this._parent(m);if(this._arguments[0].ID==="ProgressiveVisuLoading"){this._sectionCommandMode="ProgressiveVisuLoading"}require(["DS/DMUPlaySection/DMUToolsSection","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseUI/DMUInitialization","DS/DMUPlaySection/DMUSection","DS/DMUBaseExperience/EXPNls","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseCommands/EXPToolsWUX","DS/ApplicationFrame/CommandsManager","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(q,o,n,v,u,w,t,p,r,s){c=q;i=o;g=n;f=v;j=u;e=w;b=t;a=p;h=r;d=s;if(!j.getLocalResource("DMUBaseUI/CAT3DPlayProReview")){j.setLocalResource("DMUBaseUI/CAT3DPlayProReview",function(){})}h.setAuthoringFeatureTypes("Section")})},begin:function(){if(!this._isRunning){var n=a.getCommand(a.getCurrentCmdId(this._ctx),this._ctx);var m=(n&&n.getRequestedCommandMode)?n.getRequestedCommandMode({cmd:"Section"}):"exclusive";this._mode=m==="shared"?"shared":"exclusive"}this._parent.apply(this,arguments)},setCommandMode:function(m){this._sectionCommandMode=undefined;if(m==="ProgressiveVisuLoading"){this._sectionCommandMode="ProgressiveVisuLoading"}},beginExecute:function(){if(this._bProfiling&&window.console&&window.console.profile){window.console.profile("Section")}var o=this._arguments[0].ID;var q=h.getReviewContext({viewer:this.getFrameWindow().getViewer()});if(q&&q.getCurrentReview()&&q.isSwitchedReviewCtx&&(o==="3dPlay"||o==="3dAuthoring"||o==="Geovia"||this._sectionCommandMode==="ProgressiveVisuLoading")){var p=q.getCurrentReview().getChildren("DMUSection");for(var n=p.length-1;n>=0;n--){p[n].remove()}}var m=h.getContextViewer({viewer:this.getFrameWindow().getViewer()});if(o==="3dPlay"||o==="3dAuthoring"||o==="Geovia"||this._sectionCommandMode==="ProgressiveVisuLoading"){g.startSwitchExperience({context:m})}else{g.createReviewContext({context:m})}},endExecute:function(){if(this._bProfiling&&window.console&&window.console.profile){console.profileEnd()}},_performCallback:function(){var s=this._arguments[0].ID;var t;if(e.isEnvActivated("psection",true)||s==="3dPlayPro"){t=b.getCSO()}var p=i.computeBoundingBox(this._viewer,t);if(undefined===p){return}var n=h.getReviewContext({viewer:this.getFrameWindow().getViewer()});var q=n?n.getCurrentReview():null;var r;if(this._viewer._lockUnlockCmd){r=this._viewer._lockUnlockCmd.getState();this._viewer._lockUnlockCmd.setState(false)}var u=new f(this._viewer,n);if(this._sectionCommandMode==="ProgressiveVisuLoading"){u.setAttribute("bSectionCurvesVisible",false)}u.initComponent({context:q,appType:s,modeType:this._sectionCommandMode});if(t&&t.length>0){u.setObjects(t,true)}if(q&&u){var o=q.getChildren("DMUSection");if(o.length>6){this.sendNotify("info",u._nls._sectioncutlimitation)}}u._sID=n.computeNewID();u._sType="Section";u._sName=q.computeNewName("Section");var m=Math.max(p.max.x-p.min.x,p.max.y-p.min.y,p.max.z-p.min.z);u.setCreationState({mPlaneReferential:c.computeSectionPlaneReferencial(this._viewer,p),fXDirSize:m,fYDirSize:m,sDisplayPlaneMode:"Plane",sDisplayContourMode:"Contour",sSectionRender:"CutOneSide",sPartialClippingMode:false,sUpdateAndFreezeMode:"Update",fXDirGridStep:m/20,fYDirGridStep:m/20,sPlaneBoxMode:"NormalMode",fSliceOffset:0,bVisible:true,fOpacity:0.2});u.buildNode();u._userLockUnlockState=r;d.empty();this.addInCSO(u);this._viewer.render()}});return l});define("DS/DMUSection/DMUSectionContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseCommands/EXPToolsWUX","DS/Selection/CSOManager"],function(b,e,d,c){var a=b.extend({getSharedContextualCommandList:function(g){var f=[];if(g&&g.length){g.forEach(function(h){if(f.indexOf(h.GetType())===-1){f.push(h.GetType())}})}if(f.length===1&&f[0].indexOf("DMUSection")!==-1){return this.getContextualCommandList(g[0])}return[]},getContextualCommandList:function(g){var f=null;if(!g.isReadOnly()){if(g&&c.get().length===1){if(g._typeApps==="3dPlay"||g._typeApps==="3dAuthoring"||g._typeApps==="Geovia"||g._sectionObjectMode==="ProgressiveVisuLoading"){f=[{name:"Flip",line:1,hdr_list:["DMUSectionFlipHdr"]},{name:"Dropdown_switchXYZ",line:1,hdr_list:["DMUSectionNormalToXHdr","DMUSectionNormalToYHdr","DMUSectionNormalToZHdr"]},{name:"NormalToView",line:1,hdr_list:["DMUSectionMoveHdr"]},{name:"Delete",line:1,hdr_list:["DMUSectionDeleteSectionHdr"]}]}else{if(g._typeApps==="3dReview"&&e.isEnvActivated("psection",true)){f=[{name:"Dropdown_Cut",line:1,hdr_list:["DMUSectionCutHdr","DMUSectionNoCutHdr"]},{name:"Grid",line:1,hdr_list:["DMUSectionGridHdr"]},{name:"Flip",line:1,hdr_list:["DMUSectionFlipHdr"]},{name:"Dropdown_switchXYZ",line:1,hdr_list:["DMUSectionNormalToXHdr","DMUSectionNormalToYHdr","DMUSectionNormalToZHdr"]},{name:"NormalToView",line:1,hdr_list:["DMUSectionMoveHdr"]},{name:"secondaryViewer",line:1,hdr_list:["DMUSectionSecondaryViewerHdr"]},{name:"SectiveSection",line:1,hdr_list:["DMUSelectiveSectionContextCmdHdr"]},{name:"FillColor",line:1,hdr_list:["Section_DMUFillGraphicPropHdr"]}]}else{f=[{name:"Flip",line:1,hdr_list:["DMUSectionFlipHdr"]},{name:"Dropdown_switchXYZ",line:1,hdr_list:["DMUSectionNormalToXHdr","DMUSectionNormalToYHdr","DMUSectionNormalToZHdr"]},{name:"NormalToView",line:1,hdr_list:["DMUSectionMoveHdr"]},{name:"secondaryViewer",line:1,hdr_list:["DMUSectionSecondaryViewerHdr"]},{name:"FillColor",line:1,hdr_list:["Section_DMUFillGraphicPropHdr"]}]}}}else{if(g._typeApps!=="3dPlay"&&g._typeApps!=="3dAuthoring"&&g._typeApps!=="Geovia"){f=[{name:"FillColor",line:1,hdr_list:["Section_DMUFillGraphicPropHdr"]}]}}}return f},getSharedHeaderTypes:function(){return{}},register:function(f){this._parent({type:"DMUSection",module:"DMUSection",workbenchName:"DMUSection",frmWindow:f.frmWindow})}});return a});define("DS/DMUSection/DMULockUnlockSection",["DS/ApplicationFrame/CommandCheckHeader","DS/Core/Events","DS/DMUBaseExperience/DMUContextManager","DS/ApplicationFrame/CommandsManager"],function(e,c,b,a){var d=e.extend({init:function(g){this._parent(g);var f=this.getFrameWindow().getViewer();f._lockUnlockCmd=this;this.onStateChange(function(){var n=false;var j=a.getCommand("Explode",this._context);if(j){n=j.isRunning()}if(false===n){var m=b.getReviewContext({viewer:f});var k=m?m.getCurrentReview():null;if(k){if(!this._bIsToggled||(this._bIsToggled&&!k.isReadOnly())){var l=k.getChildren("DMUSection");for(var h=0;h<l.length;h++){l[h].manageLock(this.getState())}this.getFrameWindow().getViewer().render();m.getCurrentReview()._isDirty=1;c.publish({event:"/DMULOCKUNLOCKSECTION/"})}}}});this.setState(true)},toggleState:function(){this._bIsToggled=true;this.setState(!this.getState(),false);var j=b.getReviewContext({viewer:this.getFrameWindow().getViewer()});var f=j?j.getCurrentReview():null;if(f){var h=f.getChildren("DMUSection");if(h.length){for(var g=0;g<h.length;g++){h[g]._userLockUnlockState=this.getState()}}}this._bIsToggled=undefined}});return d});define("DS/DMUSection/DMUSelectiveSectionContextCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUMeasurableElementAgent","DS/DMUBaseExperience/EXPNls","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUControls/EXPLevelSelector","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager"],function(e,h,f,i,a,b,c,g){var d=e.extend({init:function(j){this._parent(j,"exclusive",true)},beginExecute:function(){var k=g.getReviewContext({viewer:this.getFrameWindow().getViewer()});if(k){var j=k.getCurrentReview();this._section=j.getDMUObjectFromPathElement(c._items[0].pathElement);this._pathElementAgentForSection=null;this._firstSelectedPathElement=null;this._selectedPathElement=null;this._pathElementAgentForSection=new f({agentId:"_pathElementAgentForSection",frameWindow:this._frmWindow,pickingMode:"primHybrid",prePickingMode:"primHybrid",valuedFromCSO:true,saveToCSO:false,multiAcquisition:true,multiAcquisitionCtrl:true,acceptedGeometries:[]})}this._parent()},endExecute:function(){this._parent();this._pathElementAgentForSection=null;if(this._levelSelector){this._levelSelector.clean()}this._firstSelectedPathElement=null;this._selectedPathElement=null;this._section=null;this._viewer.render()},buildGraph:function(){var l=this.createInitialState("initialState");var m=this.getFinalState();var n=this;var r=function(v,u){if(n._levelSelector){n._levelSelector.clean()}n._firstSelectedPathElement=u[0].pathElement.clone();n._selectedPathElement=u[0].pathElement.clone();var s=function(w){if(w){if(n._section){n._section.setObjects(w);a.addInCSO(n._section,false);n._section._viewer.render()}}},t=function(){var w=[];w.push(n._selectedPathElement);s(w)};n._levelSelector=new b({iFrameWindow:this._frmWindow,iGetPathElementCB:function(){var w=h.getLastReference(n._firstSelectedPathElement);return w},iFilterNodeCB:function(w){return h.isReference(w)},iGet3DPositionCB:function(){var w=n._selectedPathElement.getBoundingSphere(n._viewer).center;w.x=w.x-60;w.y=w.y-60;return w},iOnLevelSelectCB:function(w){n._selectedPathElement=w.pathElement.clone();t()}});t();if(v){v()}},q=function(v){var x=false;if(v){var w=v[0].pathElement.getLastElement().sgNode;if(w!==undefined){var t=v[0].pathElement;if(t!==undefined){var s=h.getLastReference(t);if(s){var u=s.getLastElement();if(h.isReference(u)){x=true}}}}}return x},k=function(){var s=i.getNls("DMUBaseUI.CAT3DPlayProReview.notifyobjectselection");this._notify=this.sendNotify("info",s)},p=function(){this.cleanNotify(this._notify);this._notify=null},o=function(s){if(this._section._itfContextbar){this._section._itfContextbar.clear()}if(s){s()}};this.setEnterStateAction(l,k);this.setExitStateAction(l,p);var j={iEvent:this._pathElementAgentForSection,iInitialState:l,iFinalState:l,iCondition:q,iAction:r};this.addTransition(j);this.addEmptySelectionTransition(l,m,o)}});return d});define("DS/DMUSection/DMUSectionExport",["UWA/Class"],function(a){return a.extend({init:function(b){this.exportData=function(c,d){if(c&&b){c.writeObjectAttributes(b,d)}}}})});define("DS/DMUSection/DMUSectionSecondaryViewer",["DS/DMUControls/EXPSecondaryViewer","DS/DMUMeasurable/DMUToolsMaths","DS/Visualization/ThreeJS_DS","DS/Visualization/Viewpoint","DS/DMUBaseExperience/EXPToolsVisualization","DS/WebappsUtils/WebappsUtils","DS/DMUBaseExperience/EXPNls","i18n!DS/DMUControls/assets/nls/DMUControls"],function(b,f,h,g,d,a,i,c){var e=b.extend({init:function(k){var j=this._setupOptions(k);this._sectionObj=k;this._parent(j);this._setupViewer(k);this.addCommands();this.show()},_setupOptions:function(l){var m=l._frmWindow.getUIFrame();var j=i.getNls("DMUBaseUI.CAT3DPlayProReview.sectionsecondaryviewer");var k={body:m,height:"378",width:"360",title:j,position:{top:"50",left:"50"}};return k},_setupViewer:function(r){var q=r._viewer.backgroundColor;this._viewerSecondary.setBackgroundColor(q);this._bgColorDefault=true;var k=r.getSectionCurvesFor2DViwer();this._viewerSecondary.addNode(k);var o={viewer:this._viewerSecondary};this._viewpointSec=new g(o);this._viewpointSec.onMove(this._viewerSecondary.render);this._viewerSecondary.addViewpoint(this._viewpointSec);this._viewpointSec.setDefaultController(true,"CATIA");this._viewpointSec.control.setRotationActive(false);var p=this._viewpointSec.getAngle();var n=k.bSphere;var m=n.center;var l=n.radius;var j=l*1.5/(Math.tan(p/2));d.moveViewpoint(this._viewerSecondary,null,m,new h.Vector3(0,0,1),new h.Vector3(0,1,0),j,0)},render:function(){this._viewerSecondary.render()},addCommands:function(){var l=a.getWebappsAssetUrl("DMUBaseCommands","icons/32/");var k=[{className:"secondaryViewerRotateCWCmd",nls:c.rotateClockwise,url:l+"I_3DSHAREPRORotateCW.png",callback:function(m){var n=0.5*Math.PI;m._rotateViewpoint(n)}},{className:"secondaryViewerRotateCCWCmd",nls:c.rotateCounterClockwise,url:l+"I_3DSHAREPRORotateCCW.png",callback:function(m){var n=-0.5*Math.PI;m._rotateViewpoint(n)}},{className:"secondaryViewerFlipVerticalCmd",nls:c.flipVertical,url:l+"I_SectionWebInvertVertical.png",callback:function(p){var m=p.options.viewer.currentViewpoint;var s=m.getTarget();var q=m.control.orientation.clone();var r=m.getUpDirection();var t=Math.PI;var o=(new h.Quaternion()).setFromAxisAngle(r,t);q.multiplyQuaternions(o,q.clone());var n=m.control.distanceToTarget;m.control.moveTo({target:s,orientation:q,distanceToTarget:n,duration:400})}},{className:"secondaryViewerFlipHorizontalCmd",nls:c.flipHorizontal,url:l+"I_SectionWebInvertHorizontal.png",callback:function(v){var o=v.options.viewer.currentViewpoint;var s=o.getTarget();var n=o.control.orientation.clone();var r=o.getUpDirection();var u=o.getSightDirection();var p=(new h.Vector3()).crossVectors(r,u).normalize();var q=Math.PI;var m=(new h.Quaternion()).setFromAxisAngle(p,q);n.multiplyQuaternions(m,n.clone());var t=o.control.distanceToTarget;o.control.moveTo({target:s,orientation:n,distanceToTarget:t,duration:400})}},{className:"secondaryViewerBgColorCmd",nls:c.switchBgColor,url:l+"I_MldColor2.png",callback:function(m){if(m._bgColorDefault){var n=m._sectionObj.getAttribute("cFillStyleColor");m._viewerSecondary.setBackgroundColor(n.getHex())}else{var o=m._sectionObj._viewer.backgroundColor;m._viewerSecondary.setBackgroundColor(o)}m._bgColorDefault=!m._bgColorDefault}}];for(var j=0;j<k.length;j++){this.addButton(k[j])}},_rotateViewpoint:function(q){var k=this.options.viewer.currentViewpoint;var p=k.getTarget();var j=k.getEyePosition();var n=k.control.orientation.clone();var o=(new h.Vector3()).subVectors(j,p).normalize();var m=(new h.Quaternion()).setFromAxisAngle(o,q);n.multiplyQuaternions(m,n.clone());var l=k.control.distanceToTarget;k.control.moveTo({target:p,orientation:n,distanceToTarget:l,duration:400})}});return e});define("DS/DMUSection/DMUSectionSecondaryViewerlImpl",["UWA/Class","DS/DMUSection/DMUSectionSecondaryViewer"],function(c,b){var a=c.extend({init:function(e){var d=null;this.isBuilt=function(){return d!==null};this.build=function(){if(!d){d=new b(e)}return d};this.isShow=function(){if(d){return d.isShow()}else{return false}};this.show=function(){if(d){d.show()}};this.noShow=function(){if(d){d.noShow()}};this.render=function(){if(d){d.render()}};this.clear=function(){if(d){d.clear();d=null}}}});return a});define("DS/DMUSection/DMUSectionContextCmd",["DS/ApplicationFrame/Command","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUSection/DMUSectionSecondaryViewerlImpl"],function(d,b,c,a){return d.extend({init:function(f){var e=f||{};e.mode=e.ID!=="DMUSectionDeleteSectionHdr"?"shared":"exclusive";this._parent(e)},beginExecute:function(){var f=function(i){if(!i._iViewerSecondaryWindow){i._iViewerSecondaryWindow=new a(i);if(i._iViewerSecondaryWindow){i._iViewerSecondaryWindow.build()}}else{if(i._iViewerSecondaryWindow.isBuilt()){if(i._iViewerSecondaryWindow.isShow()){i._iViewerSecondaryWindow.noShow()}else{i._iViewerSecondaryWindow.show();i.computeCurves()}}else{i._iViewerSecondaryWindow.build()}}};var e=b.get();if(e.length===1){var h=c.getReviewContext({viewer:this.getFrameWindow().getViewer()});var g=h.getCurrentReview().getDMUObjectFromPathElement(e[0].pathElement);if(g&&g.GetType()==="DMUSection"){switch(this._id){case"DMUSectionCutHdr":g.sectionCut(true);break;case"DMUSectionNoCutHdr":g.sectionCut(false);break;case"DMUSectionGridHdr":g.sectionGrid();break;case"DMUSectionFlipHdr":g.sectionFlip();break;case"DMUSectionNormalToXHdr":g.sectionToX();break;case"DMUSectionNormalToYHdr":g.sectionToY();break;case"DMUSectionNormalToZHdr":g.sectionToZ();break;case"DMUSectionMoveHdr":g.sectionViewpoint();break;case"DMUSectionSecondaryViewerHdr":f(g);break;case"DMUSectionDeleteSectionHdr":g.sectionCancel();break;default:break}}}}})});