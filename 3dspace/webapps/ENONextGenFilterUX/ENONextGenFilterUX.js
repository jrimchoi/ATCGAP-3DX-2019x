define("DS/ENONextGenFilterUX/views/StrDropView",["UWA/Core","UWA/Class/View",],function(c,b){var a=b.extend({name:"Str-drop",_zonesCounter:{add:0,replace:0},className:function(){return this.getClassNames("-container")},setup:function(){this._addContentDiv=c.createElement("div",{"class":"drop-zone add-content",html:{tag:"div",html:[{tag:"span","class":"fonticon fonticon-popup"},{tag:"p",html:"dropAddContent"}]}});this._addContentDiv.addEventListener("drop",this._onDrop.bind(this));this.container.addEventListener("dragover",this._onDragOver);this.container.setContent(this._addContentDiv)},show:function(e,d){console.log("RCIII show de StrDropView");if(this.container.getStyle("display")==="none"){this.container.setStyle("width",e+"px");if(sessionStorage.getItem("ENOStr_currentDrag")==="extract"||d===true){this._addContentDiv.addClassName("full")}else{this._addContentDiv.removeClassName("full")}}this.container.show()},hide:function(){console.log("RCIII hide de StrDropView");this.container.hide();this._zonesCounter.add=0;this._zonesCounter.replace=0;this.dispatchEvent("ENOStr_hide",[])},updateHeight:function(d){console.log("RCIII updateheight de StrDropView");this._addContentDiv.setStyle("height",d+"px")},_onDragOver:function(d){console.log("RCIII dragOver de StrDropView");d.stopPropagation();d.preventDefault()},_onDrop:function(i){i.stopPropagation();i.preventDefault();this.hide();var g=c.is(i.dataTransfer.types.indexOf,"function")?"indexOf":"contains",j="",k=["text/searchitems","text/plain","Text"],l=i.currentTarget,h=(l.hasClassName("add-content"))?"add":"replace",f,d,n;for(var m=0;m<k.length&&j==="";m++){n=i.dataTransfer.types[g](k[m]);if((c.is(n,"number")&&n>=0)||(c.is(n,"boolean")&&n===true)){j=k[m]}}d=i.dataTransfer.getData(j);if(d.length){f=JSON.parse(d);h=(f.action)?f.action:h}this.dispatchEvent("ENOStr_drop",[h,f]);sessionStorage.removeItem("ENOStr_currentDrag")}});return a});define("DS/ENONextGenFilterUX/views/FilterActiveCriteria",["UWA/Class","DS/WebappsUtils/WebappsUtils","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX"],function(d,b,c){var a=d.extend({init:function(e){},setActiveCriteria:function(g,f){var e={localfilters:g};return e},criteriaToHTML:function(p,r){var o="";r.widgetId=r.widgetId||this.widgetId;r.proxyId=r.proxyId||this.proxyId;var m=undefined;if(r.getProxyFilters){m=r.getProxyFilters(p,r);if(undefined===m){r.proxyId=this.proxyId;m=r.getProxyFilters(p,r)}}else{m=p&&p[r.widgetId]?p[r.widgetId][r.proxyId]:undefined}if(undefined!==m){var g=m.filterName;if(g!==""){var j=r.contextId||"";var i=r.widgetId||"";var q="NGFilter";var f=q+"-_-"+j;var h=c.get("filterPredicate");var e="fonticon fonticon-filter";var n=new Date();var l=g+"_"+i+"_"+n.getTime().toString();var k='<div id="'+f+'" class="appCriteria"><ul class="active-predicate-list"><li class="predicate selected"><div class="predicate-header"><div class="predicate-label"><span class="'+e+'"></span>'+h+'</div></div></li><li class="tag selected" id="'+l+'"><div class="tag-label">'+g+"</div></li></ul></div>";o='<div class="'+q+"_"+i+'">'+k+"</div>"}}this.widgetId=r.widgetId;this.proxyId=r.proxyId;return o},});return a});define("DS/ENONextGenFilterUX/utils/NGFSecurityCtxConverter",["UWA/Class","UWA/Promise"],function(c,a){var b=c.singleton({init:function(){},buildSecurityContext:function(e,d,f){return"ctx::"+f+"."+d+"."+e},buildDisplayString:function(e,d,f){return f+"."+d+"."+e},extractCouple:function(g){var i="",h="",f="";for(var d in g){var e=g[d];switch(d){case"organization":i=e.name;break;case"role":h=e.name;if(e.nls){f=e.nls}else{f=h}break}}return{org:i,role:h,roleNls:f}},prepareForStorage:function(s){var e="ctx:";var g=s.pid;var l=[];var r,f,d,u;for(var t in s.preferredcredentials){var h=s.preferredcredentials[t];switch(t){case"collabspace":r=h.name;f=h.title?h.title:r;break;case"organization":d=h.name;break;case"role":u=h.name;break}}e=this.buildSecurityContext(f,d,u);for(var m in s.collabspaces){var p=s.collabspaces[m];for(var n=0;n<p.couples.length;n++){var i=this.extractCouple(p.couples[n]);var q=this.buildSecurityContext(p.name,i.org,i.role);var j=p.title?p.title:p.name;var o=this.buildDisplayString(j,i.org,i.roleNls);var k={csName:j,label:o,value:q};if(e===q){k.isDefault=true}l.push(k)}}return{userId:g,securityContext:e,cspaces:l}},getSecurityContext:function(f){var e=UWA.is(f,"string")?JSON.parse(f):f;var d=this.prepareForStorage(e);return d},});return b});define("DS/ENONextGenFilterUX/utils/FilterUIService",["UWA/Class","UWA/Core","UWA/Class/Options","UWA/Promise","UWA/Date","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/ENONextGenFilterUX/utils/NGFSecurityCtxConverter","DS/ENOFilterBIUX/NGFServices","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/i3DXSNDictionaryAPI/3DXSearchDictionaryAccess","text!DS/ENONextGenFilterUX/assets/ENOStrRefinementUX_supportedTypes.json","DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/ENOFilterBIUX/FBIServices"],function(r,n,f,c,p,a,g,e,d,q,l,i,k,h,s,b,m,j){var o=r.singleton(f,{TOUCH_MODE:true,HEIGTH_UI_COMPONENT:38,MAX_DEEP_ATTRIBUTE_GROUP:4,MAX_FILTER_SPECIFICATION:4,MAX_CAR_FOR_CONFIG:200,MAX_DEEP_VOLUME_GROUP:2,ATTRIBUTE_NOT_VALUATED:"NotValuated",MAX_MRU_ATTRIBUTE:5,NAME_RULES:{notAllowedChars:["/",'"',"#","$","@","%","*",",","?","\\","<",">","[","]","|",":"],maxLength:127},init:function(){this._vocabURL=null;this._nlsNames=[];this._notificationsManager=e;d.setNotificationManager(this._notificationsManager);d.setStackingPolicy(1+4)},setTenantId:function(t){this._tenantId=t},getTenantId:function(){return this._tenantId},getPlatformServices:function(v){this.setTenantId(v);var t=this;var u=new c(function(x,w){g.getPlatformServices({onComplete:function(y){t.setOption("str_platformServices",y);x()},onFailure:function(y){w()}})});return u},getPlatformUrlAccordingToTenant:function(){var v;var u=this.getOption("str_platformServices");for(var t=0;t<u.length;t++){if(this._tenantId===u[t].platformId){v=u[t]}}return v},getExpandUrl:function(){if(!n.is(this.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return this.getPlatformUrlAccordingToTenant(this._tenantId)["3DSpace"]+"/cvservlet/expand"},getFetchUrl:function(){if(!n.is(this.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return this.getPlatformUrlAccordingToTenant(this._tenantId)["3DSpace"]+"/cvservlet/fetch/v2"},getRepairPathsUrl:function(){if(!n.is(this.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return this.getPlatformUrlAccordingToTenant(this._tenantId)["3DSpace"]+"/resources/FilterBIAPI/ExplicitMgt/getGoodVersionsIds"},getMultiExpandUrl:function(){if(!n.is(this.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return this.getPlatformUrlAccordingToTenant(this._tenantId)["3DSpace"]+"/cvservlet/multiexpand"},getVocabularyClassesUrl:function(){if(!n.is(this.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return this.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/6WVocab/access/VocabularyClasses?name=ds6wg"},getInterfacesUrl:function(){if(!n.is(this.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return this.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/dictionary/class/interfaces"},getPredicatesUrl:function(){if(!n.is(this.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return this.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/6WVocab/access/Predicates"},getPreferredSecurityContextUrl:function(){if(!n.is(this.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return this.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/pno/person/getsecuritycontext"},getAllSecurityContextsUrl:function(){if(!n.is(this.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return this.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces"},getPreferredSecurityContext:function(){return new c(function(u,t){a.authenticatedRequest(o.getPreferredSecurityContextUrl(),{headers:o.getRESTHeaders(),method:"GET",type:"json",proxy:"passport",onComplete:function(v){if(null!==v){u(v.SecurityContext)}},onFailure:function(v){t(v)}})})},getAllSecurityContexts:function(){return new c(function(u,t){a.authenticatedRequest(o.getAllSecurityContextsUrl(),{headers:o.getRESTHeaders(),method:"GET",type:"json",proxy:"passport",onComplete:function(v){if(null!==v){u(q.getSecurityContext(v))}},onFailure:function(v){t(v)}})})},showNotification:function(t){this.displayNotification(t)},displayNotification:function(t){t.sticky=t.sticky||false;this._notificationsManager.addNotif(t)},getPlatformId:function(){var t=null;t=this.getPlatformUrlAccordingToTenant().platformId;return t},getRESTHeaders:function(){var t={Accept:"application/json","Content-Type":"application/json","Accept-Language":j.getLanguage().toLowerCase()};return t},isFilterCmdHeaderActivated:function(){var t=window.location.href;var u=(-1!==t.indexOf("NGFilter")||-1!==t.indexOf("debug"))?1:0;return u},checkAndGetListOfAttributesFromSelectedFilter:function(w){var y=this;var v=[],E=[],C=[],A=[];var x=[],t=[];var D=l.getFilterSpecifications(w);var B=D.length;var z=1;for(var u=z;u<B;u++){var N=D[u].toFeedUI;for(var H=0;H<N.length;H++){var L=N[H];if("attribute"===L.criteriaType){if("null"===L.extension||undefined===L.extension){L.extension="";L.nlsExtension=""}if(-1===x.indexOf(L.type)){x.push(L.type)}if(-1===t.indexOf(L.extension)){t.push(L.extension)}}else{if("config"===L.criteriaType){}else{if("Sequence"===L.criteriaType){if("attribute"===L.sequenceType){var M=L.allAttributes;for(var G=0;G<M.length;G++){var K=M[G];if("null"===K.extension){K.extension="";K.nlsExtension=""}if(-1===x.indexOf(K.type)){x.push(K.type)}if(-1===t.indexOf(K.extension)){t.push(K.extension)}}}}else{if("context"===L.criteriaType){}}}}}}function J(O,P){return new c(function(S,R){var Q='{"classes":["'+O+'"]}';a.authenticatedRequest(o.getInterfacesUrl(),{headers:o.getRESTHeaders(),method:"POST",data:Q,type:"json",proxy:"passport",onComplete:function(V){if(V&&V.results&&V.results.length){var X=V.results[0].interfaces;if(X){var W=X.length;var Y=0;for(var U=0;U<W&&!Y;U++){if(X[U].name===P){Y=1;if(!y.isCustomizedAttribute(X[U])){var T="ds6wg:"+P;if(1===o.getDictionaryAccessLevel()){m.getPropertiesForClass(T,{tenantId:o.getTenantId(),lang:j.getLanguage().toLowerCase(),apiVersion:"R2019x",onComplete:function(Z){var aa=(Z.length)?Z[0].properties:[];S(aa)},onFailure:function(Z){S([])}})}else{a.authenticatedRequest(o.getPredicatesUrl(),{headers:o.getRESTHeaders(),method:"POST",data:T,type:"json",proxy:"passport",onComplete:function(Z){S(Z.classPredicates[0].vocabularyPredicateInfo)},onFailure:function(Z){S([])}})}}else{S([])}}}}}else{S([])}},onFailure:function(T){R(T)}})})}function I(O){return new c(function(R,Q){var P='{"classes":["'+O+'"]}';a.authenticatedRequest(o.getInterfacesUrl(),{headers:o.getRESTHeaders(),method:"POST",data:P,type:"json",proxy:"passport",onComplete:function(W){if(W&&W.results){var Z=[];if(W.results.length){var Y=W.results[0].interfaces;if(Y){var X=Y.length;for(var T=0;T<X;T++){if(y.isCustomizedAttribute(Y[T])){Z.push(Y[T].name)}}}}var U=Z.length;var S="ds6wg:"+O;for(var V=0;V<U;V++){S+=",ds6wg:"+Z[V]}if(1===o.getDictionaryAccessLevel()){m.getPropertiesForClass(S,{tenantId:o.getTenantId(),lang:j.getLanguage().toLowerCase(),apiVersion:"R2019x",onComplete:function(ac){var ad=ac.length;var aa=[];for(var ab=0;ab<ad;ab++){aa=aa.concat(ac[ab].properties)}R(aa)},onFailure:function(aa){Q(aa)}})}else{a.authenticatedRequest(o.getPredicatesUrl(),{headers:o.getRESTHeaders(),method:"POST",data:S,type:"json",proxy:"passport",onComplete:function(ac){var ad=ac.classPredicates.length;var aa=[];for(var ab=0;ab<ad;ab++){aa=aa.concat(ac.classPredicates[ab].vocabularyPredicateInfo)}R(aa)},onFailure:function(aa){Q(aa)}})}}else{R([])}},onFailure:function(S){Q(S)}})})}for(var F=0;F<x.length;F++){if(undefined!==x[F]){E.push(I(x[F]))}if(undefined!==x[F]&&t[F]){E.push(J(x[F],t[F]))}}return c.all(E).then(function(P){for(var O=0;O<x.length;O++){v[x[O]]=P[O];if(t[O]){v[t[O]]=P[O+1]}}return v})},checkForBadCharacters:function(v){var t=true;var w=o.NAME_RULES.notAllowedChars;for(var u=0;u<w.length;u++){if(v.indexOf(w[u])!=-1){t=false;break}}return t},getAttributeButtonStyle:function(u){var t={touchMode:o.TOUCH_MODE,displayStyle:"normal",showLabelFlag:false,icon:{iconName:u,fontIconFamily:WUXManagedFontIcons.Font3DS},};return t},getAttributeValidateButtonStyle:function(){var t=o.getAttributeButtonStyle("check");t.displayStyle="normal";return t},getExpandSynthesisInfos:function(u,t){return this._getExpandSynthesis(o.getMultiExpandUrl(),u,t)},refreshExpandSynthesisInfos:function(v,t){var u=this;return new c(function(x,w){u._getExpandSynthesis(o.getMultiExpandUrl(),v,{},t).then(function(y){if(y&&0===y.length){u.displayNotification({level:"info",message:i.get("ExpandSynthesisWithEmptyResult")})}x(y)},function(y){w(y)})})},_getExpandSynthesis:function(w,x,t,u){var v=this;return new c(function(E,G){var A={no_type_filter_bo:["PLMPort","PLMConnection"]};var F=t||A;var z=new p();var C=n.Date.strftime(z,"%Y-%m-%dT%H:%M:%S%z");C="FilterUI_ExpandSynthesis_"+C;var D={};D.label=C;D.synthesis_mode="flat";D.max_count_path="1";if(!u){var B={};B.expand_iter="-1";B.root_physicalid=x.rootID;n.merge(B,F);D.union={};D.union.expand=[];D.union.expand.push(B)}else{n.merge(D,u)}var y=o.getRESTHeaders();y.SecurityContext=x.securityContext||"preferred";a.authenticatedRequest(w,{label:C,headers:y,method:"POST",data:JSON.stringify(D),type:"json",proxy:"passport",onComplete:function(I){var H=I.facets||[];if(0===H.length){E([])}else{j.getNlsInfosForFacets(H).then(function(Q){var P=[];for(var K=0;K<Q.length;K++){var O=Q[K];if(O.sixw){var N=O.sixw.split("/");var L=N.length-1;if(!P[N[L]]){P[N[L]]=[]}P[N[L]].push({value:O.object,nlsvalue:O.dispValue})}}var J=[];for(var M in P){if(P.hasOwnProperty(M)){J.push({property:M,values:P[M].sort(function(S,R){var T=(S&&R)?((S.nlsvalue<=R.nlsvalue)?-1:1):0;return T})})}}E(J)})}},onFailure:function(){s.error(" ==> Expand synthesis failed : "+C);G()}})})},getTypesOfSynthesis:function(w){var t=[];for(var v=0;v<w.length;v++){if("ds6w:type"===w[v].property){for(var u=0;u<w[v].values.length;u++){t.push({name:w[v].values[u].value,nlsName:w[v].values[u].nlsvalue,uri:w[v].property})}}}return t},upgradeAndCompleteQuery:function(t){return l.upgradeAndCompleteQuery(t)},getCombinationQuery:function(t){return l.getCombinationQuery(t)},getQueryExpandType:function(t){return l.getQueryExpandType(t)},resetSelectedVolumeOf3D:function(u,t){if(u&&t){var v={appId:u,widgetId:t,};b.publish("NGFilter_Volume",v)}},isModelActivated:function(u){var t=(u&&"1"===u.get("isActivated"))?true:false;return t},buildGlobalUnionCVQuery:function(t){return l.buildGlobalUnionCVQuery(t)},isCustomizedAttribute:function(v){var t=v.automatic||v.Automatic;var u=(t&&"Yes"===t)?true:false;return u},getDictionaryAccessLevel:function(){return j.DICTIONARY_ACCESS_LEVEL},_getRootFilterContainer:function(t){var u=document.getElementById("NGF_"+t)||document.getElement(".f-globalFilter-container");return u},getGlobalEditContainer:function(u){var v;var t=this._getRootFilterContainer(u);if(t){v=t.getElement("#globalEditContainer_"+u)||t.getElement(".globalEdit-container")}return v},showFilterContainer:function(v,z){var u=this._getRootFilterContainer(v);if(u){var y=u.getElement(".globalEdit-container");var x=u.getElement(".filter-Commands");var w=u.getElement(".ActiveCriteria-container");var t=u.getElement(".globalFilterView-container");if(y&&(x&&w&&t)){if(z){n.extendElement(y).hide();n.extendElement(x).show();n.extendElement(w).show();n.extendElement(t).show()}else{n.extendElement(y).show();n.extendElement(x).hide();n.extendElement(w).hide();n.extendElement(t).hide()}}}},_executeFetch_LogicalID:function(t){return new c(function(w,v){var u={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({label:"NGF_ExecuteFetch",physicalid:t,select_file:["icon","thumbnail_2d","thumbnail_3d"],select_predicate:["logicalid","type","coretype","ds6w:label","flattenedtaxonomies"]}),onComplete:function(x){w(x)},onFailure:function(x){v(x)}};a.authenticatedRequest(o.getFetchUrl(),u)})}});return o});define("DS/ENONextGenFilterUX/utils/EditToReadManager",["UWA/Class","UWA/Core","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/ENONextGenFilterUX/utils/FilterUIService"],function(e,c,d,a){var b={init:function(){},toStringAttribute:function(g){var t=this.getAttributeValues(g);var o="";if(!t.inSequence){if(true===t.Keep){o="Keep"}else{o="Remove"}}var p;if(t.nlsType){p=t.nlsType}else{g.set("state","edit");return{level:"error",message:d.get("attrNotCompleted"),sticky:false}}var j;if(t.nlsExtension){j=t.nlsExtension}var k=(g.get("allAttributes"))[0];var r=this._buildAttributeString(k);var l=d.get(o.toLowerCase())+" "+d.get(p);if(j){l+=" ("+d.get("extension")+" : "+j+") "}var s=[];s.push(l);var f=r.length;if(0<f){if(1<f||(1===f&&c.is(r[0],"array"))){if(0===this._isSingleGroupOfAttribute(k)){var n=" "+(("all"===k.get("combination"))?d.get("AllCombination"):d.get("AnyCombination"));n+=" "+d.get("FollowingCombination");l+=" "+d.get("with")+" "+n}else{var n=r[0].shift();var m=[];r[0].forEach(function(i){m.push(i)});for(var h=1;h<r.length;h++){m.push(r[h])}r=m;f=r.length;l+=" "+n}}else{l+=" "+d.get("with")+" :"}s[0]=l;if(1===f&&!c.is(r[0],"array")){s[0]+=" "+r[0]}else{var q=s.concat(r);s=q}}return s},toStringContext:function(i){var s="";var n=i.get("addedNodesList");var o=i.get("excludedNodesList");var g=n.length;var f=o.length;if(g||f){var u='<span class="f-criterion-deactivated">';var h="</span>";var k=(1===g)?"ContextReadViewSingleAdd":"ContextReadViewMultiAdd";var r=g+" "+d.get(k);var q=i.get("AddNodeActivated");r=(q)?r:(u+r+h);var p=(1===f)?"ContextReadViewSingleExclude":"ContextReadViewMultiExclude";var m=f+" "+d.get(p);var j=i.get("ExcludeNodeActivated");m=(j)?m:(u+m+h);if(g>0&&f>0){s=" ("+r+", "+m+")"}else{if(g>0){s=" ("+r+")"}else{if(f>0){s=" ("+m+")"}}}}else{s=d.get("contextFilterTitle")}var l=c.createElement("span",{});l.addClassName("fonticon fonticon-dropbox");var t=[];t.push(s);return t},_isSingleGroupOfAttribute:function(h){var i=0;var g=this.getAttributeValues(h);var f=g.allAttributes||[];if(1===f.length&&this.getAttributeValues(f[0]).allAttributes){i=1}return i},attributeToHTML:function(h){var f=this.toStringAttribute(h);var g=this._getAttributeHTML(f);return g},_getAttributeHTML:function(g){var k="";for(var j=0;j<g.length;j++){if(c.is(g[j],"array")){var f=g[j];k+="<li>"+f[0];k+="<ul >";f.shift();var h=this._getAttributeHTML(f);k+=h;k+="</ul></li>"}else{k+="<li>"+g[j]+"</li>"}}return k},configToString:function(g){var f=g.get("displayExpression");return f},volumeToString:function(f){var j=(f.get("allVolumes"))[0];var o=this._volumeAsString(j);var p=[];var g=o.length;if(0<g){var k="";if(1<g||(1===g&&c.is(o[0],"array"))){if(0===this._isSingleGroupOfVolume(j)){var l=" "+(("all"===j.get("combination"))?d.get("AllCombination"):d.get("AnyCombination"));l+=" "+d.get("FollowingCombination");k+=" "+d.get("with")+" "+l}else{var l=o[0].shift();var m=[];o[0].forEach(function(i){m.push(i)});for(var h=1;h<o.length;h++){m.push(o[h])}o=m;g=o.length;k+=" "+l}}p[0]=k;if(1===g&&!c.is(o[0],"array")){p[0]+=" "+o[0]}else{var n=p.concat(o);p=n}}return p},_volumeAsString:function(l){var n=[];var f=l.get("allVolumes")||[];var j=0;for(var k=0;k<f.length;k++){var g=f[k];j++;if(!g.get("allVolumes")){var o=g.get("displayName");if(o&&o.length){n.push(o)}}else{var h=d.get("with")+" ";h+=("all"===g.get("combination"))?d.get("AllCombination"):d.get("AnyCombination");h+=" "+d.get("FollowingCombination");var m=this._volumeAsString(g);m.unshift(h);n.push(m)}}return n},_isSingleGroupOfVolume:function(f){var g=0;var h=f.get("allVolumes")||[];if(1===h.length&&h[0].get("allVolumes")){g=1}return g},groupToString:function(h){var i=h.get("subGroupCollection");var g=[];i.forEach(function(k,j){g.push(k.criterionToHTML())});var f=g.join("");return f},_buildAttributeString:function(j){var m=[];var o=this.getAttributeValues(j);var g=o.allAttributes||[];for(var h=0;h<g.length;h++){var k=g[h];o=this.getAttributeValues(k);if(undefined===o.allAttributes){var n=this._buildSingleAttribute(k);if(n.length){m.push(n)}}else{var f=d.get("with")+" ";f+=("all"===o.combination)?d.get("AllCombination"):d.get("AnyCombination");f+=" "+d.get("FollowingCombination");var l=this._buildAttributeString(k);l.unshift(f);m.push(l)}}return m},getAttributeValues:function(g){var f={};if(undefined!==g){f={Keep:g.get("Keep"),type:g.get("type"),nlsType:g.get("nlsType"),extension:g.get("extension"),nlsExtension:g.get("nlsExtension"),inSequence:g.get("inSequence")};if(undefined===g.get("combination")){f.attribute=g.get("attribute");f.nlsAttribute=g.get("nlsAttribute");f.attrOp=g.get("attrOp");f.nlsAttrOp=g.get("nlsAttrOp");f.attrValue=g.get("attrValue");f.attrValue_1=g.get("attrValue_1");f.attrValue_2=g.get("attrValue_2")}else{f.combination=g.get("combination");f.allAttributes=g.get("allAttributes")}}return f},setAttributeValues:function(g,f){if(undefined!==g&&undefined!==f){g.set("Keep",f.Keep);g.set("type",f.type);g.set("nlsType",f.nlsType);g.set("extension",f.extension);g.set("nlsExtension",f.nlsExtension);g.set("inSequence",f.inSequence);if(undefined===f.combination){g.set("attribute",f.attribute);g.set("nlsAttribute",f.nlsAttribute);g.set("attrOp",f.attrOp);g.set("nlsAttrOp",f.nlsAttrOp);g.set("attrValue",f.attrValue);g.set("attrValue_1",f.attrValue_1);g.set("attrValue_2",f.attrValue_2)}else{g.set("combination",f.combination);g.set("allAttributes",f.allAttributes)}}},_buildSingleAttribute:function(j){var l="";var f=this.getAttributeValues(j);var k=f.nlsAttribute||"";var h=f.nlsAttrOp||"";var m="";if(undefined!==f.attrValue){m=f.attrValue;var i=f.attribute.type;var o=f.attribute.rangeValues;if(o){m=this._buildAttributeValue(m,o,h,", ")}else{if("boolean"===i){m=("true"===m)?d.get("true"):d.get("false")}}}if(h&&-1!==h.indexOf("between")&&undefined!==f.attrValue_1){var n=[f.attrValue_1,f.attrValue_2];var g=" "+d.get("AND").toLowerCase()+" ";m=this._buildAttributeValue(n,f.attribute.rangeValues,h,g)}if(undefined!==k&&k.length){l=k+" "+d.get(h);if(""===m){l+="<span class=f-criterion-unset> "+d.get("NoValueEntered")+"</span>"}else{l+=" "+m}}return l},_buildAttributeValue:function(n,u,s,m){var p="";var f=(c.is(n,"array"))?n:[n];var g=f.length;var o=0;if(u&&0!==u.length){var r=(!u.literalInfo)?u:u.literalInfo;var h=r.length;for(var l=0;l<g;l++){for(var k=0;k<h;k++){var t=r[k];if(t.value===f[l]){var q=t.nlsValue||t.nlsvalue;p+=((q)?q:t.value)+m;o++;break}}}}if(!p.length){for(var l=0;l<g;l++){p+=f[l]+m;o++}}if(1<o&&-1===s.indexOf("between")){p=d.get("AnyOf")+"  "+p}p=(p.endsWith(m))?p.slice(0,-(m.length)):p;return p}};return b});define("DS/ENONextGenFilterUX/utils/FilterPersistencyServices",["UWA/Class","UWA/Core","UWA/Class/Options","UWA/Promise","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENOFilterBIUX/NGFServices","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX"],function(j,i,c,f,h,a,g,d,b){var e=j.singleton(c,{NEW_SAVE:(-1!==window.location.href.indexOf("NGFNewSave"))?0:1,FILTER_DESCRIPTION:(-1===window.location.href.indexOf("NGFDescription"))?0:1,init:function(){},namesRetrievedFiltersOnRoot:[],getCreateFilterUrl:function(){var k;if(i.is(g.getOption("str_platformServices"),"array")){k=g.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/FilterBIAPI/Filter/createFilter"}return k},getUpdateFilterUrl:function(){var k;if(i.is(g.getOption("str_platformServices"),"array")){k=g.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/FilterBIAPI/Filter/updateFilter"}return k},getGetFiltersUrl:function(){var k;if(i.is(g.getOption("str_platformServices"),"array")){k=g.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/FilterBIAPI/Filter/getFilters"}return k},getRetrieveFiltersForRootsUrl:function(){var k;if(i.is(g.getOption("str_platformServices"),"array")){k=g.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/FilterBIAPI/Filter/retrieveFiltersForRoots"}return k},getDefaultFilterNameUrl:function(l){var k;if(i.is(g.getOption("str_platformServices"),"array")){k=g.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/FilterBIAPI/Filter/getDefaultName"}return k},getCheckExistingFilterNameUrl:function(l){var k;if(i.is(g.getOption("str_platformServices"),"array")){k=g.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/FilterBIAPI/Filter/checkExistingFilterName"}return k},getRetrieveFiltersUrl:function(k){return d.getRetrieveFiltersUrl(k)},saveFilter:function(l,n,p,r,q,m){var o=this;if(1===e.FILTER_DESCRIPTION){m[0].filterDescription=p}var k={filterName:n,filterDescription:q,rootPhysicalId:r,filterCVQuery:q,filterUIComponents:m};return new f(function(t,s){h.authenticatedRequest(o.getCreateFilterUrl(),{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:l},method:"POST",data:JSON.stringify(k),type:"json",proxy:"passport",onComplete:function(u){t(u)},onFailure:function(u){t(u)}})})},updateFilter:function(l,n,p,q,m){var o=this;if(1===e.FILTER_DESCRIPTION){m[0].filterDescription=p}var k={filterName:n,filterDescription:q,filterCVQuery:q,filterUIComponents:m};return new f(function(s,r){h.authenticatedRequest(o.getUpdateFilterUrl(),{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:l},method:"POST",data:JSON.stringify(k),type:"json",proxy:"passport",onComplete:function(t){s(t)},onFailure:function(t){s(t)}})})},retrieveAllFiltersOnRoot:function(n){var m=this,l=[];m.namesRetrievedFiltersOnRoot=[];var k=new f(function(p,o){h.authenticatedRequest(m.getGetFiltersUrl(),{headers:g.getRESTHeaders(),method:"GET",type:"json",proxy:"passport",onComplete:function(s){if(s.filters){for(var r=0;r<s.filters.length;r++){for(var q=0;q<n.length;q++){if(n[q]===s.filters[r].rootPhysicalId){l.push(s.filters[r]);m.namesRetrievedFiltersOnRoot.push(s.filters[r].filterName)}}}}p(l)},onFailure:function(q){o(q)}})});return k},retrieveFiltersForRoots:function(m){var l=this,n=[];m=i.is(m,"array")?m:[m];var k=new f(function(p,o){h.authenticatedRequest(l.getRetrieveFiltersForRootsUrl(),{headers:g.getRESTHeaders(),method:"POST",data:JSON.stringify(m),type:"json",proxy:"passport",onComplete:function(s){if(s.success){for(var r=0;r<s.success.length;r++){for(var q=0;q<m.length;q++){if(s.success[r][m[q]]){n.push(s.success[r][m[q]])}}}}p(n)},onFailure:function(q){o(q)}})});return k},getDefaultFilterName:function(m){var l=this;var k=new f(function(o,n){h.authenticatedRequest(l.getDefaultFilterNameUrl()+"?filterName="+encodeURIComponent(m),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET",type:"json",proxy:"passport",onComplete:function(p){o(p.defaultName)},onFailure:function(p){n(p)}})});return k},checkExistingFilterName:function(m){var l=this;var k=new f(function(p,o){if(l.namesRetrievedFiltersOnRoot&&l.namesRetrievedFiltersOnRoot.length){for(var n=0;n<l.namesRetrievedFiltersOnRoot.length;n++){if(m===l.namesRetrievedFiltersOnRoot[n]){p(true);break}}}h.authenticatedRequest(l.getCheckExistingFilterNameUrl()+"?filterName="+encodeURIComponent(m),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET",type:"json",proxy:"passport",onComplete:function(q){l.namesRetrievedFiltersOnRoot.push(m);p(q)},onFailure:function(q){o(q)}})});return k},keepComponentsToFeedConfigUI:function(k){var l={};l.criteriaType=k.criteriaType;l.config_filter=k.config_filter;l.displayExpression=k.displayExpression;l.filterName=k.filterName;l.expression=k.expression;if("0"===k.isActivated){l.isActivated=k.isActivated}return l},keepComponentsToFeedAttrUI:function(k){var l={};l.criteriaType=k.criteriaType;l=k._attributes;return l},_keepComponentsToFeedAttrSeqUI:function(l){var n=[];var k=l.get("subGroupCollection")._models;if(k){k.forEach(function(p){var o=e.keepComponentsToFeedAttrUI(p);n.push(o)})}var m={};m.criteriaType=l.get("criteriaType");m.sequenceType=l.get("sequenceType");m.allAttributes=n;return m},keepComponentsToFeedContextUI:function(m){var n={};var l=(m.get("addedNodesList")&&m.get("addedNodesList").length);var k=(m.get("excludedNodesList")&&m.get("excludedNodesList").length);if(l||k){n=m;n.criteriaType=m._attributes.criteriaType}return n},keepComponentsToFeedTagUI:function(k){var l={};l=k.get("tagData");l.criteriaType=k.get("criteriaType");return l},keepComponentsToFeedVolumeUI:function(k){var l={};if("0"===k.get("isActivated")){l.isActivated=k.get("isActivated")}l.criteriaType=k.get("criteriaType");l=k._attributes;return l},keepToFeedConfig:function(k){var l={};l.criteriaType=k.criteriaType;l.config_filter=k.config_filter;l.displayExpression=k.displayExpression;l.filterName=k.filterName;l.expression=k.expression;if("0"===k.isActivated){l.isActivated=k.isActivated}return l},keepToFeedAttr:function(k){var l={};l.criteriaType=k.get("criteriaType");l.type=k.get("type");if(false===k.get("Keep")){l.Keep=k.get("Keep")}if("0"===k.get("isActivated")){l.isActivated=k.get("isActivated")}if(""!==k.get("extension")){l.extension=k.get("extension")}var n=(k.get("allAttributes"));if(n&&n.length){var m=this._keepToFeedAttr(n[0]);l.allAttributes=[];l.allAttributes.push(m)}return l},_keepToFeedAttr:function(p){var k=p.get("allAttributes")||[];var s=k.length;var m=[];for(var o=0;o<s;o++){var r=k[o];var n=r.get("allAttributes");var q;if(!n){if(r.get("attribute")){q={type:r.get("attribute").type,uri:r.get("attribute").uri,attrOp:r.get("attrOp"),};if(r.get("attrValue")){q.attrValue=r.get("attrValue")}else{q.attrValue_1=r.get("attrValue_1");q.attrValue_2=r.get("attrValue_2")}}}else{q=this._keepToFeedAttr(r)}if(q){m.push(q)}}var l={combination:p.get("combination"),allAttributes:m};return l},keepToFeedContext:function(n){var k={};var m=(n.get("addedNodesList")&&n.get("addedNodesList").length);var l=(n.get("excludedNodesList")&&n.get("excludedNodesList").length);if(m||l){k.criteriaType=n.get("criteriaType");if(m){if(false===n.get("AddNodeActivated")){k.AddNodeActivated=n.get("AddNodeActivated")}k.addedNodesList=n.get("addedNodesList");k.addedNodesLabels=n.get("addedNodesLabels")}if(l){if(false===n.get("ExcludeNodeActivated")){k.ExcludeNodeActivated=n.get("ExcludeNodeActivated")}k.excludedNodesList=n.get("excludedNodesList");k.excludedNodesLabels=n.get("excludedNodesLabels")}}return k},keepToFeedTag:function(p){var k={};var o=p.get("tagData")||undefined;if(o){var q=(o.allfilters)?Object.keys(o.allfilters):[];var m=(o.localfilters)?Object.keys(o.localfilters):[];var n=q.length;var l=m.length;if(n||l){k.criteriaType=p.get("criteriaType");if(n){k.allfilters={};k.allfilters=o.allfilters}if(l){k.localfilters={};k.localfilters=o.localfilters}}}return k},keepToFeedVolume:function(m){var l={};l.criteriaType=m.get("criteriaType");if("0"===m.get("isActivated")){l.isActivated=m.get("isActivated")}var n=m.get("allVolumes");if(n&&n.length){var k=this._keepToFeedVolume(n[0]);l.allVolumes=[];l.allVolumes.push(k)}return l},_keepToFeedVolume:function(q){var t=b.get("defaultVolumeName");var l=q.get("allVolumes")||[];var u=l.length;var p=[];for(var o=0;o<u;o++){var m=l[o];var r=m.get("allVolumes");var k;if(!r){k={parameters:m.get("parameters")};if("0"===m.get("isActivated")){k.isActivated=m.get("isActivated")}var s=m.get("displayName");if(-1!==s.startsWith(t+" ")){k.displayName=s}}else{k=this._keepToFeedVolume(m)}p.push(k)}var n={combination:q.get("combination"),allVolumes:p};return n},keepComponentsToFeedSequenceUI:function(k){var l={};if("attribute"===k.get("sequenceType")){if(0===e.NEW_SAVE){l=this._keepComponentsToFeedAttrSeqUI(k)}else{l=this._keepToFeedAttrSeq(k)}}return l},_keepToFeedAttrSeq:function(m){var n=[];var l=m.get("subGroupCollection")._models;if(l){l.forEach(function(o){var p=e.keepToFeedAttr(o);n.push(p)})}var k={};k.criteriaType=m.get("criteriaType");k.sequenceType=m.get("sequenceType");k.allAttributes=n;return k}});return e});define("DS/ENONextGenFilterUX/utils/CVManager",["UWA/Core","DS/ENONextGenFilterUX/utils/FilterUIService","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX",],function(c,b,d){var a={init:function(){},buildCVQueryForContext:function(f,m){var j;if("root_path_physicalid"==m){j=false;var p=f.get("AddNodeActivated");if(p){var l=f.get("addedNodesList");var n=l.length;if(n){var e="[";for(var k=0;k<n;k++){e+='["'+l[k].toString().split(",").join('","')+'"],'}e=e.slice(0,-1)+"]";j=e}}}else{j="";var h=f.get("ExcludeNodeActivated");var o=[];if(h){o=f.get("excludedNodesList");var n=o.length;var g="[";for(var k=0;k<n;k++){g+='["'+o[k].toString().split(",").join('","')+'"],'}g=(g.endsWith(","))?g.slice(0,-1):g;g+="]";if(o.length>0){j='"find_path_filter":[{"option": ["remove"],"path_physicalid":'+g+"}]"}}}return j},buildCVQueryForAttribute:function(j,h){var e="";if(j.get("Keep")){e=(false===h)?"seq_cut":"seq_keep"}else{e="seq_remove"}var g=j.get("type");var l="";if(j.get("extension")){l=j.get("extension")}var i="";var k=(j.get("allAttributes"));if(k&&k.length){i=this._buildAttributeQuery(k[0]);i=(i.length)?i:"#all"}var f="";if(i.length){f='{"option":["'+e+'"],"definition":[{"type_filter_bo":["'+g+'"],"type_filter_rel":["'+g+'"],"q.query":"'+i;if(l.length){f+=" AND [ds6w:kind]:"+l}f+='"}]}'}return f},buildCVQueryForConfig:function(f){var e="";if(f){e='"config_filter":"'+f+'"'}return e},buildCVQueryForGroup:function(i,f){var h="";var g=i.get("subGroupCollection")._models;if("attribute"===i.get("sequenceType")){var n=(g&&g.length)?g[0]:undefined;if(n){var m="";if(n.get("Keep")){m=("false"===f)?"seq_cut":"seq_keep"}else{m="seq_remove"}var l='{"option":["'+m+'"],"definition":[';var e="]}";var k=this;var j="";g.forEach(function(q){var p=q.get("isActivated");if("1"===p){var r=q.get("type");var t=q.get("extension")||"";var s="";var o=(q.get("allAttributes"));if(o&&o.length){s=k._buildAttributeQuery(o[0]);s=(s.length)?s:"#all"}if(s.length){j+='{"type_filter_bo":["'+r+'"],"type_filter_rel":["'+r+'"],"q.query":"'+s;if(t.length){j+=" AND [ds6w:kind]:"+t}j+='"},'}}});if(j.length){j=j.slice(0,-1);h=l+j+e}}}return h},buildCVQueryForVolume:function(f){var g="";var e="";var h=(f.get("allVolumes"));if(h&&h.length){e=this._buildVolumeQuery(h[0])}if(e.length){g='"volume_filter":{'+e+"}"}return g},_buildVolumeQuery:function(m){var n="";var e=m.get("allVolumes")||[];var q=e.length;var h="";var k="";var p=m.get("combination");if(p){var f=("all"===p)?"and":"or";n='"'+f+'":[';h="{";k="}"}var j=0;for(var l=0;l<q;l++){var g=e[l];if("1"===g.get("isActivated")){j++;var o=g.get("allVolumes");if(!o){n+=h+this._buildSingleVolume(g)+k}else{n+=h+this._buildVolumeQuery(g)+k}n+=","}}if(j){n=n.slice(0,n.length-1);if(p){n+="]"}}else{n=""}return n},_buildSingleVolume:function(f){var e="";var i=f.get("parameters");if(i){var h=i.type;switch(h){case"box":e='"box":{';e+='"corner_min":["'+i.corner_min.toString().split(",").join('","')+'"],';e+='"corner_max":["'+i.corner_max.toString().split(",").join('","')+'"],';e+='"transformation_matrix":["'+i.transformation_matrix.toString().split(",").join('","')+'"],';e+='"intersection_mode":"'+i.intersection_mode+'"';e+="}";break;case"sphere":e='"sphere":{';e+='"center":["'+i.center.toString().split(",").join('","')+'"],';e+='"radius":"'+i.radius+'",';e+='"intersection_mode":"'+i.intersection_mode+'"';e+="}";break;case"proximity":var g=i.root_path_physicalid[0];g=(UWA.is(g,"array"))?g:[g];e='"assemblyshape":{';e+='"root_path_physicalid":[["'+g.toString().split(",").join('","')+'"]],';e+='"distance":"'+i.distance+'",';e+='"intersection_mode":"'+i.intersection_mode+'"';e+="}";break}}return e},_buildAttributeQuery:function(j){var e=j.get("allAttributes")||[];var n=e.length;var m=("all"===j.get("combination"))?" AND ":" OR ";var k=(n)?"":"#all";for(var h=0;h<n;h++){var l=e[h];var f=l.get("allAttributes");var g;if(undefined===f){g=this._buildSingleAttribute(l);if(g.length){k+=g}}else{g=this._buildAttributeQuery(l);if(g.length){k+=" ("+g+")"}}if(g.length){k+=m}}k=(k.endsWith(m))?k.slice(0,-(m.length)):k;return k},_buildSingleAttribute:function(e){var f="";var h=true;if(undefined===e.get("attrValue")&&(undefined===e.get("attrValue_1")&&undefined===e.get("attrValue_2"))){h=false}if(h){var g=(e.get("attribute"))?e.get("attribute").type:e.get("type");switch(g){case"string":f+=this._buildStringAttr(e);break;case"boolean":f+=this._buildBooleanAttr(e);break;case"number":case"integer":case"real":f+=this._buildNumericalAttr(e);break;case"dateTime":case"timestamp":f+=this._buildDateAttr(e);break}}return f},_buildDateAttr:function(f){var e="";var g=(f.get("attribute"))?f.get("attribute").uri:f.get("uri");var n=f.get("attrOp");var o=[];if("between"!==n){var m=f.get("attrValue")||b.ATTRIBUTE_NOT_VALUATED;o=(UWA.is(m,"array"))?m:[m]}else{var q=f.get("attrValue_1")||b.ATTRIBUTE_NOT_VALUATED;var p=f.get("attrValue_2")||b.ATTRIBUTE_NOT_VALUATED;o.push(q);o.push(p)}var l="";var j=o.length;for(var k=0;k<j;k++){var h=o[k];l=" OR ";switch(n){case"on":e+="["+g+"] = "+h;break;case"after":e+="["+g+"] >= "+h;break;case"strictlyAfter":e+="["+g+"] > "+h;break;case"before":e+="["+g+"] <= "+h;break;case"strictlyBefore":e+="["+g+"] < "+h;break;case"between":if(0===k){e+="["+g+"] >= "+h;l=" AND "}else{e+="["+g+"] <= "+h}break}e+=l}if(e.length){e=(e.endsWith(l))?e.slice(0,-(l.length)):e;e="("+e+")"}return e},_buildNumericalAttr:function(f){var o="";var e=(f.get("attribute"))?f.get("attribute").uri:f.get("uri");var h=f.get("attrOp");var q=[];if("between"!==h){var l=f.get("attrValue")||b.ATTRIBUTE_NOT_VALUATED;q=(UWA.is(l,"array"))?l:[l]}else{var n=f.get("attrValue_1")||b.ATTRIBUTE_NOT_VALUATED;var m=f.get("attrValue_2")||b.ATTRIBUTE_NOT_VALUATED;q.push(n);q.push(m)}var k="";var g=q.length;for(var j=0;j<g;j++){var p=q[j];k=" OR ";switch(h){case"equals":o+="["+e+"] = "+p;break;case"notEqual":o+="["+e+"] != "+p;break;case"lowerThan":o+="["+e+"] <= "+p;break;case"greaterThan":o+="["+e+"] >= "+p;break;case"strictlyLowerThan":o+="["+e+"] < "+p;break;case"strictlyGreaterThan":o+="["+e+"] > "+p;break;case"between":if(0===j){o+="["+e+"] >= "+p;k=" AND "}else{o+="["+e+"] <= "+p}break}o+=k}if(o.length){o=(o.endsWith(k))?o.slice(0,-(k.length)):o;o="("+o+")"}return o},_buildBooleanAttr:function(g){var f;var h=(g.get("attribute"))?g.get("attribute").uri:g.get("uri");var e=g.get("attrValue")||b.ATTRIBUTE_NOT_VALUATED;f="["+h+"]:"+e;f="("+f+")";return f},_buildStringAttr:function(f){var m="";var e=(f.get("attribute"))?f.get("attribute").uri:f.get("uri");var h=f.get("attrOp");var l=f.get("attrValue")||b.ATTRIBUTE_NOT_VALUATED;var n=(UWA.is(l,"array"))?l:[l];var k=" OR ";var g=n.length;for(var j=0;j<g;j++){var o=n[j];switch(h){case"equals":m+="["+e+']:\\"'+o+'\\"';break;case"contains":m+="["+e+"]:*"+o+"*";break;case"startsWith":m+="["+e+"]:"+o+"*";break;case"endsWith":m+="["+e+"]:*"+o;break}m+=k}if(m.length){m=(m.endsWith(k))?m.slice(0,-(k.length)):m;m="("+m+")"}return m},buildCVQueryForTags:function(h){var f;var e=h.get("tagData")||{allfilters:h.get("allfilters")||undefined};if(Object.keys(e.allfilters).length||Object.keys(e.localfilters).length){f='{ "option":["seq_keep"], "definition":[';var g=function(j){var k=[];for(var i in j){if(j.hasOwnProperty(i)){var l='{"q.query":"';var m=Object.keys(j[i]).length;var n=0;for(var q in j[i]){if(j[i].hasOwnProperty(q)){var p;if(-1!==i.lastIndexOf("/")){p=i.substring(i.lastIndexOf("/")+1)}var o=(UWA.is(j[i][q].object,"array"))?j[i][q].object.join("/"):j[i][q].object;l+="["+p+"]:"+o;n++;l+=(n<m)?" OR ":""}}l+='"}';k.push(l)}}return k};if(e.allfilters&&Object.keys(e.allfilters).length){f+=g(e.allfilters)}f+="]}";return f}else{return f}},_checkCVFilterForRoot:function(h,k){var j=false;if(h){j=h.root_physicalid===k?true:false;var g=b.getCombinationQuery(h);if(!j&&g){var f=b.getQueryExpand(g);if(f){for(var e=0;e<f.length;e++){j=f[e].root_physicalId===k?true:false;if(j){return j}}}}else{console.log("RCIIII CVManager._checkCVFilterForRoot, non supported case")}}return j},_completeCVFilterWithCVTags:function(n,o,l){var m=b.getCombinationQuery(n);if(m){var h=b.getQueryExpand(m);if(h){for(var g=0;g<h.length;g++){if(h[g].sequence_filter){for(var f=0;f<h[g].sequence_filter.definition.length;f++){h[g].sequence_filter.definition[f].append(l.sequence_filter.definition)}}else{h[g].append(l)}}}}if(n.root_physicalid){if(n.sequence_filter){for(var e=0;e<n.sequence_filter.length;e++){n.sequence_filter[e].definition.push(l.sequence_filter[0].definition)}}else{n.push(l)}}return n},};return a});define("DS/ENONextGenFilterUX/models/CriterionModel",["UWA/Core","UWA/Data","UWA/Class/Model","DS/ENONextGenFilterUX/utils/CVManager","DS/ENONextGenFilterUX/utils/EditToReadManager","DS/ENONextGenFilterUX/utils/FilterPersistencyServices"],function(g,d,f,a,c,e){var b=f.extend({defaults:{name:"elementaryCriteria-model",isActivated:"1"},setup:function(){},toCVQuery:function(j){var h;var i=this.get("criteriaType");if("attribute"===i){h=a.buildCVQueryForAttribute(this,j)}else{if("config"===i){h=a.buildCVQueryForConfig(this.get("config_filter"))}else{if("context"===i){h=a.buildCVQueryForContext(this,j)}else{if("tag"===i){h=a.buildCVQueryForTags(this)}else{if("volume"===i){h=a.buildCVQueryForVolume(this,j)}else{console.log(" !! CriterionModel.toCVQuery : non supported case - "+i)}}}}}return h},criterionToString:function(){var i;var h=this.get("criteriaType");if("attribute"===h){i=c.toStringAttribute(this)}else{if("config"===h){i=c.configToString(this)}else{if("context"===h){i=c.toStringContext(this)}else{if("volume"===h){i=c.volumeToString(this)}else{console.log(" !! CriterionModel.criterionToString : non supported case - "+h)}}}}return i},criterionToHTML:function(){var j="";var i=this.get("criteriaType");if("attribute"===i){var k=this.criterionToString(this);var h=this.get("isActivated");var l=("0"===h)?"f-criterion-deactivated":"";if("1"===h){j+="<li>"+k[0]+'<ul class="attrRead-multi-attr"><div>'}else{j+='<li><span class="'+l+'">'+k[0]+'</span><ul class="attrRead-multi-attr '+l+'"><div>'}if(1<k.length){k.shift();j+=this._getAttributeHTML(k)}j+="</div></ul></li>"}else{if("config"===i){j=c.configToString(this)}else{if("context"===i){j=c.toStringContext(this)}else{if("volume"===i){j=c.volumeToString(this)}else{console.log(" !! CriterionModel.criterionToString : non supported case - "+i)}}}}return j},keepComponentsToFeedUI:function(j){var i={};var h=this.get("criteriaType");if(1===e.NEW_SAVE){if("attribute"===h){i=e.keepToFeedAttr(this,j)}else{if("config"===h){i=e.keepToFeedConfig(this._attributes)}else{if("context"===h){i=e.keepToFeedContext(this)}else{if("volume"===h){i=e.keepToFeedVolume(this)}else{if("tag"===h){i=e.keepToFeedTag(this)}else{console.log(" !! CriterionModel.keepToFeed : non supported case - "+h)}}}}}}else{if("attribute"===h){i=e.keepComponentsToFeedAttrUI(this,j)}else{if("config"===h){i=e.keepComponentsToFeedConfigUI(this._attributes)}else{if("context"===h){i=e.keepComponentsToFeedContextUI(this)}else{if("volume"===h){i=e.keepComponentsToFeedVolumeUI(this)}else{if("tag"===h){i=e.keepComponentsToFeedTagUI(this)}else{console.log(" !! CriterionModel.keepComponentsToFeedUI : non supported case - "+h)}}}}}}return i},_getAttributeHTML:function(j){var m="";for(var l=0;l<j.length;l++){if(g.is(j[l],"array")){var h=j[l];m+="<li>"+h[0];m+="<ul>";h.shift();var k=this._getAttributeHTML(h);m+=k;m+="</ul></li>"}else{m+="<li>"+j[l]+"</li>"}}return m}});return b});define("DS/ENONextGenFilterUX/views/CriteriaAbstractView",["UWA/Core","UWA/Class/View","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/Handlebars/Handlebars","DS/ENONextGenFilterUX/models/CriterionModel","text!DS/ENONextGenFilterUX/templates/configurationViewTemplate.html","text!DS/ENONextGenFilterUX/assets/ENOStrRefinementUX_require.json","DS/UIKIT/DropdownMenu","DS/ENONextGenFilterUX/utils/FilterUIService"],function(k,e,g,d,c,i,f,h,a,j){var b=e.extend({isCriterionValidate:function(){return true},viewFromMdl:function(l){},isThereCriteria:function(){return false},_getCallbackToEditCriterion:function(){var l;return l},isCriterionValid:function(){return true},_getDOMElementToUpdateOnActivateChange:function(){var l=[];return l},tagName:"li",setup:function(l){this._childGroupId=l.childGroupId||1;this._filterId=l.filterId;this._viewId="activeSubgroup_"+this._childGroupId;this.container.setAttribute("id",this._viewId);this._dropdownCtxMenu=null;this.listenTo(this.model,"onChange:isActivated",this._onActivateChange.bind(this))},_getId:function(){return this._viewId},_checkBeforeEdit:function(){var l=this._getCallbackToEditCriterion();if(l){this.dispatchEvent("NGF_Criterion_ValidateEdited",{callback:l})}},_createCriterionCtxMenu:function(l,p){if(!l||this._dropdownCtxMenu){return}var o=[{id:"edit-item-DDCtx",text:g.get("editCriteria"),fonticon:"pencil",handler:this._checkBeforeEdit.bind(this)},{id:"activate-item-DDCtx",text:g.get("deactivatedCriteria"),fonticon:"eye-off",handler:this._switchCriterionState.bind(this)}];var m=(p)?p.length:0;for(var n=0;n<m;n++){if(p[n]){o.push(p[n])}}o.push({id:"delete-item-DDCtx",text:g.get("deleteCriteria"),fonticon:"trash",handler:this.destroy.bind(this)});this._dropdownCtxMenu=new a({target:l,items:o})},_switchCriterionState:function(){var l=(j.isModelActivated(this.model))?"0":"1";this.model.set("isActivated",l)},_onActivateChange:function(m,l){var o=(j.isModelActivated(this.model));var p=this._dropdownCtxMenu;if(p){var u=p.getItem("activate-item-DDCtx");if(u){var t=(o)?"deactivatedCriteria":"activatedCriteria";u.elements.container.getElement(".item-text").innerHTML=g.get(t);var n="fonticon fonticon-"+((o)?"eye-off":"eye");u.elements.container.getElement(".fonticon").className=n}}var r=this._getDOMElementToUpdateOnActivateChange();var s=r.length;for(var q=0;q<s;q++){if(r[q]){if(o){r[q].removeClassName("f-criterion-deactivated")}else{r[q].addClassName("f-criterion-deactivated")}}}this.dispatchEvent("NGF_Criterion_Activated",{})},_hideFilterContainer:function(){j.showFilterContainer(this._filterId,false)},_showFilterContainer:function(){j.showFilterContainer(this._filterId,true)},_showCtxItem:function(l){this._hideShowCtxItem(l,true)},_hideCtxItem:function(l){this._hideShowCtxItem(l,false)},_hideShowCtxItem:function(m,q){if(this._dropdownCtxMenu){var o=k.is(m,"array")?m:[m];var l=o.length;for(var n=0;n<l;n++){var p=this._dropdownCtxMenu.getItem(o[n]+"-item-DDCtx");p=p||this._dropdownCtxMenu.getItem(o[n]);if(p){if(q){p.elements.container.show()}else{p.elements.container.hide()}}}}}});return b});define("DS/ENONextGenFilterUX/models/GlobalFilterModel",["UWA/Class/Model","DS/ENONextGenFilterUX/utils/CVManager",],function(c,a){var b=c.extend({name:"globalFilter-model",setup:function(){},});return b});define("DS/ENONextGenFilterUX/collections/FilterUIGroupCollection",["UWA/Core","UWA/Class/Collection","DS/ENONextGenFilterUX/models/CriterionModel","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX"],function(e,a,b,d){var c=a.extend({model:b,setup:function(g,f){this.add(g);this._widgetId=f.widgetId||null;this._isActivated="1";this._filterSpecificationName=d.get("defaultGroupName")},sync:function(){return this.model.prototype.sync.apply(this,arguments)},setActivated:function(f){this._isActivated=f},isActivated:function(){return this._isActivated},setFilterSpecificationName:function(f){this._filterSpecificationName=f},getFilterSpecificationName:function(){return this._filterSpecificationName},});return c});define("DS/ENONextGenFilterUX/models/GroupModel",["UWA/Class/Model","DS/ENONextGenFilterUX/utils/CVManager","DS/ENONextGenFilterUX/utils/EditToReadManager","DS/ENONextGenFilterUX/utils/FilterPersistencyServices"],function(e,a,b,d){var c=e.extend({defaults:{state:"edit",operatorCV:"AND",isActivated:"1"},setup:function(){},toCVQuery:function(f){var g="";if("Sequence"===this.get("criteriaType")){g=a.buildCVQueryForGroup(this,f)}return g},groupToString:function(){var f=b.groupToString(this);return f},keepComponentsToFeedUI:function(g){var f={};if("Sequence"===this.get("criteriaType")){f=d.keepComponentsToFeedSequenceUI(this)}return f}});return c});define("DS/ENONextGenFilterUX/collections/FilterUIGlobalFilterCollection",["UWA/Core","UWA/Class/Collection","DS/ENONextGenFilterUX/models/GlobalFilterModel","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENOFilterBIUX/NGFServices","DS/WAFData/WAFData","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX"],function(g,e,d,c,h,b,f){var a=e.extend({model:d,setup:function(j,i){this.add(j);this._widgetId=i.widgetId||null;this._groupCollectionArray=[];this.model=i.model},addGroupCollection:function(i){this._groupCollectionArray.push(i)},removeGroupCollection:function(j){var i=this._groupCollectionArray.indexOf(j);if(-1!==i){this._groupCollectionArray.splice(i,1)}},buildCVQuery:function(S,A,n){var z=[];var J=0;var s=this.model.get("combinationOfSpecification")||"union";var p=false;var D=0;var K=true;var C=this._groupCollectionArray.length;if("minus"===s&&"0"===this.model.get("minusIndex")){D=C-1;K=false}while(0<=D&&!p){var L=D;var r="";var M=[];var m=[];var t=[];var P=[];var E=[];if("1"===this._groupCollectionArray[L].isActivated()){var x=this._groupCollectionArray[L]._models;for(var I=0;I<x.length;I++){if("1"===x[I].get("isActivated")){var N=x[I].get("criteriaType");if("attribute"===N){M.push(x[I].toCVQuery(A))}else{if("config"===N){m.push(x[I].toCVQuery())}else{if("Sequence"===N||"subGroup"===N){M.push(x[I].toCVQuery(A))}else{if("context"===N){t.push(x[I].toCVQuery());t.push(x[I].toCVQuery("root_path_physicalid"))}else{if("tag"===N&&x[I].toCVQuery()){P.push(x[I].toCVQuery())}else{if("volume"===N){E.push(x[I].toCVQuery())}}}}}}}}r+='{"root_path_physicalid":';var H=t[t.length-1];if(!H||false===H){r+='[["'+S+'"]]'}else{r+=H}if(M.length||P.length){r+=',"sequence_filter": [';for(var G=0;G<M.length;G++){r+=M[G];if(G<M.length-1){r+=","}}r+="]"}if(m.length){r+=",";r+=m[m.length-1]}if(t.length){if(t[t.length-2]){r+=",";r+=t[t.length-2]}}var B=E.length;J=(!J)?B:J;if(B&&E[0].length){r+=",";r+=E[0]}r+="}";if(P.length){var w=JSON.parse(r);var y=JSON.parse(P);var v=[];if(w.sequence_filter.length){if(y.definition&&y.definition.length){for(var F=0;F<w.sequence_filter.length;F++){v=w.sequence_filter[F].definition.concat(y.definition);w.sequence_filter[F].definition=v}}}else{v=w.sequence_filter.concat(y);w.sequence_filter=v}r=JSON.stringify(w)}z.push(r)}var Q=(K)?D++:D--;p=(C===D||-1===D)}var o="";var O=z.length;o='{"specVersion":"'+h.getCurrentSpecificationVersion()+'"';var q=(J)?"expand3d":"expand";o+=', "'+s+'":{"'+q+'":[';for(var L=0;L<O;L++){o+=z[L]+((L!==O-1)?",":"")}o+="]}}";var R={};R.CVQuery=o;var u=c.upgradeAndCompleteQuery(R);console.log("CVQuery = "+JSON.stringify(u));return JSON.stringify(u)},keepComponentsToFeedUI:function(w,m){var v=[];v.push({toFeedUI:{combinationOfSpecification:this.model.get("combinationOfSpecification"),minusIndex:this.model.get("minusIndex"),keepChildren:m,specVersion:h.getCurrentSpecificationVersion()}});var x=f.get("defaultGroupName");for(var s=0;s<this._groupCollectionArray.length;s++){var p=this._groupCollectionArray[s];if(p){var t=[];var u=p._models;for(var q=0;q<u.length;q++){var l=u[q].keepComponentsToFeedUI(m);var y=Object.keys(l);if(y.length){var n=(g.is(l,"array"))?l:[l];for(var o=0;o<n.length;o++){t.push(n[o])}}}var r={toFeedUI:t};if("0"===p.isActivated()){r.isActivated="0"}if(-1===p.getFilterSpecificationName().indexOf(x)){r.filterSpecificationName=p.getFilterSpecificationName()}v.push(r)}}return v},sync:function(m,l,k){var j;try{switch(m){case"read":b.authenticatedRequest(k.url,{headers:c.getRESTHeaders(),method:"POST",data:k.data,type:"json",onComplete:k.onComplete,onFailure:function(n){console.log(n)}});break;case"create":break;case"update":case"patch":break;case"delete":break;default:throw new Error('Unsupported method "{0}"'.format(m))}}catch(i){j=i.message}return{cancel:function(){return}}}});return a});define("DS/ENONextGenFilterUX/utils/FilterCollectionServices",["UWA/Class","UWA/Core","UWA/Class/Options","DS/ENOFilterBIUX/NGFServices","DS/ENONextGenFilterUX/collections/FilterUIGlobalFilterCollection","DS/ENONextGenFilterUX/collections/FilterUIGroupCollection","DS/ENONextGenFilterUX/models/GlobalFilterModel","DS/ENONextGenFilterUX/models/GroupModel","DS/ENONextGenFilterUX/models/CriterionModel"],function(i,h,b,c,j,a,d,f,e){var g=i.singleton(b,{init:function(){this._isNGFdebug=(-1===window.location.href.indexOf("NGFdebug"))?0:1},buildCVQueryFromModel:function(l){var k=this._buildCVQueryFromModel(l);if(l.filterCVQuery===k){l.filterCVQuery=k}else{if(this._isNGFdebug){console.log("---------------------------------------  ContainerFilterView  ----------------------------------------");console.log("filterCVQuery = "+l.filterCVQuery);console.log(" ");console.log("Computed filterCVQuery = "+k);console.log("------------------------------------------------------------------------------------------------------")}l.filterCVQuery=k}return k},_buildCVQueryFromModel:function(n){var l="";var x=c.getFilterSpecifications(n);var u=x.length;var s=new d({state:"init"});var v=new j(null,{model:s});var z=x[0];s.set("combinationOfSpecification",z.toFeedUI.combinationOfSpecification);s.set("minusIndex",z.toFeedUI.minusIndex);s.set("keepChildren",z.toFeedUI.keepChildren||true);s.set("specVersion",z.toFeedUI.specVersion||c.getCurrentSpecificationVersion());for(var A=1;A<u;A++){var p=x[A];var E=new a([],{});E.setActivated(p.isActivated||"1");var D=p.toFeedUI;var k=D.length;for(var y=0;y<k;y++){var B=D[y];var C=B.criteriaType;var r;if("config"===C||"tag"===C){r=new e();var t=Object.keys(B);t.forEach(function(F){var G=("null"===B[F])?"":B[F];r.set(F,G)});if(!r.get("isActivated")){r.set("isActivated","1")}}else{if("context"===C){r=new e();var t=Object.keys(B);t.forEach(function(F){var G=("null"===B[F])?"":B[F];r.set(F,G)});if(undefined===r.get("addedNodesList")){r.set("addedNodesList",[])}if(undefined===r.get("excludedNodesList")){r.set("excludedNodesList",[])}if(undefined===r.get("AddNodeActivated")){r.set("AddNodeActivated",true)}if(undefined===r.get("ExcludeNodeActivated")){r.set("ExcludeNodeActivated",true)}}else{if("attribute"===C){r=new e();var t=Object.keys(B);var o=this;t.forEach(function(F){if("allAttributes"===F){var H=o._buildForComplexAttribute(F,B[F]);r.set(F,H)}else{var G=("null"===B[F])?"":B[F];r.set(F,G)}});if(!r.get("isActivated")){r.set("isActivated","1")}if(undefined===r.get("Keep")){r.set("Keep",true)}if(!r.get("extension")){r.set("extension","")}}else{if("volume"===C){r=new e();var t=Object.keys(B);var o=this;t.forEach(function(F){if("allVolumes"===F){var H=o._buildForComplexVolume(F,B[F]);r.set(F,H)}else{var G=("null"===B[F])?"":B[F];r.set(F,G)}});if(!r.get("isActivated")){r.set("isActivated","1")}}else{if("Sequence"===C){var m=new a([],{});r=new f({subGroupCollection:m,});if("attribute"===B.sequenceType){var t=Object.keys(B);var o=this;t.forEach(function(F){if("allAttributes"===F){var H=o._buildForComplexAttribute(F,B[F]);if(undefined===H[0].get("Keep")){H[0].set("Keep",true)}r.get("subGroupCollection").add(H)}else{var G=("null"===B[F])?"":B[F];r.set(F,G)}})}}}}}}if(r){E.add(r)}}v.addGroupCollection(E)}var q=s.get("keepChildren");var w=n.rootPhysicalId;l=v.buildCVQuery(w,q);return l},_buildForComplexAttribute:function(p,k){var l=[];var r=k.length;for(var m=0;m<r;m++){var q=k[m];var o=new e();var s=Object.keys(k[m]);var n=this;s.forEach(function(u){if(p===u){var t=n._buildForComplexAttribute(u,q[u]);o.set(u,t)}else{var v=("null"===q[u])?"":q[u];o.set(u,v)}});l.push(o)}return l},_buildForComplexVolume:function(p,k){var l=[];var r=k.length;for(var m=0;m<r;m++){var q=k[m];var o=new e();var s=Object.keys(k[m]);var n=this;s.forEach(function(u){if(p===u){var t=n._buildForComplexVolume(u,q[u]);o.set(u,t)}else{var v=("null"===q[u])?"":q[u];o.set(u,v);if(!o.get("isActivated")){o.set("isActivated","1")}}});l.push(o)}return l}});return g});define("DS/ENONextGenFilterUX/views/CriteriaTagView",["DS/ENONextGenFilterUX/views/CriteriaAbstractView","UWA/Core","UWA/Class/View","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/Handlebars/Handlebars","DS/ENONextGenFilterUX/models/CriterionModel","text!DS/ENONextGenFilterUX/templates/configurationViewTemplate.html","text!DS/ENONextGenFilterUX/assets/ENOStrRefinementUX_require.json","DS/UIKIT/DropdownMenu","DS/ENONextGenFilterUX/utils/FilterUIService"],function(l,k,e,g,d,b,i,f,h,a,j){var c=l.extend({className:"tagCriterion",setup:function(m){this._parent(m)},render:function(){return this},isCriterionValidate:function(){return true},viewFromMdl:function(m){console.log("RCIIIII CriteriaTagView.veiwFromMMdl")},isThereCriteria:function(){var n=false;var m=this.model.get("tagData");if(m){if(Object.keys(m.allfilters).length||Object.keys(m.localfilters).length){n=true}return n}},});return c});define("DS/ENONextGenFilterUX/views/VolumeView",["UWA/Core","UWA/Class/View","UWA/Class/Model","DS/ENONextGenFilterUX/utils/FilterUIService","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/Controls/Button","DS/Controls/LineEditor","css!DS/ENONextGenFilterUX/ENONextGenFilterUX.css","DS/Controls/TooltipModel","DS/UIKIT/DropdownMenu"],function(j,d,l,h,f,c,k,b,g,i,a){var e=d.extend({domEvents:{"click .innerVolumeFilterHeader":"_onVolumeSelected","click .innerVolumeFilter":"_onVolumeSelected"},tagName:"div",className:"attr-edit-inputs-Volume-Master",setup:function(m){this._filterSpecId=m.filterSpecId;this._isVolumeAvailable=m.volumeAvailable;this._volSetId=m.volSetId||0;this._idVol=m.idVol;this._volumeId="volume_"+this._filterSpecId+"-"+this._volSetId+"-"+this._idVol;this._masterDiv=this.container;this._masterDiv.id=this._volumeId;this._volDiv=j.createElement("div",{"class":"attr-edit-inputs-Attribute"});this._volDiv.inject(this._masterDiv);this.container.addEvent("click",function(n){n.stopPropagation();return false});this.listenTo(this.model,"onChange:isActivated",this._onActivateChange.bind(this));this.listenTo(this.model,"onChange:state",this._onStateChange.bind(this));this.listenTo(this.model,"onChange:displayName",this._onFilterNameChange.bind(this))},render:function(){this._createVolumeUI();var m=j.createElement("div",{"class":"volume-edit-command"});m.inject(this._masterDiv);this._createVolumeCriterionCtxMenu(m);return this},getValues:function(){var m={filterSpecId:this._filterSpecId,setId:this._volSetId,id:this.model.get("id"),displayName:this.model.get("displayName"),parameters:this.model.get("parameters"),};return m},_createVolumeUI:function(){this.model.set("id",this._volumeId);var p=f.get("defaultVolumeName")+" ";if(this._idVol){if(this._volSetId){p+="("+this._idVol+")"}else{p+="("+this._idVol+")"}}this.model.set("displayName",p);this._volumeUL=j.createElement("ul",{});this._volumeUL.inject(this._volDiv);this._volumeName=j.createElement("label",{"class":"innerVolumeFilterHeader",html:this.model.get("displayName"),id:"name_"+this._volumeId});this._volumeName.inject(this._volumeUL);this._waitngForDiv=j.createElement("div",{"class":"volume-edit-WaitingFor",id:"waitngForDiv_"+this._volumeId});this._waitngForDiv.inject(this._volumeUL);var m=j.createElement("label",{"class":"volume-edit-WaitingFor-Label",html:f.get("WaitingForVolumeSpecifications")+" (",id:"labelVolSpec1_"+this._volumeId});m.inject(this._waitngForDiv);var n=new k({touchMode:true,displayStyle:"lite",label:f.get("CancelVolumeSpecifications"),id:"cancelVolSpec_"+this._volumeId});n.getContent().addClassName("filter-anchor-style");n.inject(this._waitngForDiv);m=j.createElement("label",{"class":"volume-edit-WaitingFor-Label",html:")",id:"labelVolSpec2_"+this._volumeId});m.inject(this._waitngForDiv);var o=this;n.addEventListener("buttonclick",function(q){o._cancelEditVolume()});this._renameEditor=this._createRenameVolumeUI(this._volumeName);this._renameEditor.hide()},_onStateChange:function(p,o){if("read"===o){var r=this._volumeUL.getElements("li");var B=r.length-1;for(var u=B;u>=0;u--){r[u].remove();r[u].removeClassName("f-group-deactivated")}var q=this.model.get("parameters");if(q){var x=f.get(q.type)+",  "+f.get(q.intersection_mode);var A=j.createElement("li",{"class":"innerVolumeFilter",text:x});A.inject(this._waitngForDiv,"before");switch(q.type){case"box":var t=[parseFloat(q.transformation_matrix[9]),parseFloat(q.transformation_matrix[10]),parseFloat(q.transformation_matrix[11])];var n=3;var z=[(parseFloat(q.corner_max[0])+t[0]).toFixed(n),(parseFloat(q.corner_max[1])+t[1]).toFixed(n),(parseFloat(q.corner_max[2])+t[2]).toFixed(n)];A=j.createElement("li",{"class":"innerVolumeFilter",text:f.get("corner_min")+this._formatValue(t).join(" , ")});A.inject(this._waitngForDiv,"before");A=j.createElement("li",{"class":"innerVolumeFilter",text:f.get("corner_max")+this._formatValue(z).join(" , ")});A.inject(this._waitngForDiv,"before");break;case"sphere":A=j.createElement("li",{"class":"innerVolumeFilter",text:f.get("center")+this._formatValue(q.center).join(" , ")});A.inject(this._waitngForDiv,"before");A=j.createElement("li",{"class":"innerVolumeFilter",text:f.get("radius")+this._formatValue(q.radius)});A.inject(this._waitngForDiv,"before");break;case"proximity":var w=" ...";if(q.root_path_alias){var s=q.root_path_alias.length;w=q.root_path_alias[s-1]||" ..."}A=j.createElement("li",{"class":"innerVolumeFilter volume-li-proximity-reference",text:f.get("reference")});A.inject(this._waitngForDiv,"before");var m=j.createElement("div",{});var y=j.createElement("label",{"class":"innerVolumeFilter volume-li-proximity-reference-alias",html:w,});y.inject(m);m.inject(A);A=j.createElement("li",{"class":"innerVolumeFilter",text:f.get("distance")+this._formatValue(q.distance)});A.inject(this._waitngForDiv,"before");break}if(!h.isModelActivated(this.model)){this._switchCriterionState()}}this._waitngForDiv.hide();this._dropdownCtxMenu.getItem("edit-item-DDCtx").elements.container.show();var v=this._dropdownCtxMenu.getItem("edit-item-DDCtx").elements.container;if(v){if(this._isVolumeAvailable){v.show()}else{v.hide()}}this._dropdownCtxMenu.getItem("rename-item-DDCtx").elements.container.show();this._dropdownCtxMenu.getItem("activate-item-DDCtx").elements.container.show();this._dropdownCtxMenu.getItem("cancel-item-DDCtx").elements.container.hide()}else{var r=this._volumeUL.getElements("li");var B=r.length-1;for(var u=B;u>=0;u--){r[u].addClassName("f-group-deactivated")}this._waitngForDiv.show();this._dropdownCtxMenu.getItem("edit-item-DDCtx").elements.container.hide();this._dropdownCtxMenu.getItem("rename-item-DDCtx").elements.container.hide();this._dropdownCtxMenu.getItem("activate-item-DDCtx").elements.container.hide();this._dropdownCtxMenu.getItem("cancel-item-DDCtx").elements.container.show()}},_formatValue:function(n){var m;if(UWA.is(n,"array")){m=n;m.forEach(function(o){o=Number(o).toFixed(2)})}else{m=Number(n).toFixed(2)}return m},_onVolumeSelected:function(){if(this._isVolumeAvailable){this.dispatchEvent("NGF_VolumeSelected",{filterSpecId:this._filterSpecId,setId:this._volSetId,id:this.model.get("id"),displayName:this.model.get("displayName"),parameters:this.model.get("parameters")});this.model.set("state","edit")}else{h.showNotification({level:"info",message:f.get("VolumeCanNotBeModified"),sticky:false})}},isEmpty:function(){var m=this.model.get("parameters");return(!m)?true:false},setFocus:function(){},showAddButtons:function(m){},showRemoveButton:function(m){},_createVolumeCriterionCtxMenu:function(o){var m=j.createElement("span",{});m.addClassName("fonticon fonticon-chevron-down volumeDropDown");m.addClassName("attribute-edit-remove-btn");m.inject(o);this._dropdownCtxMenu=null;var n=[{id:"edit-item-DDCtx",text:f.get("editCriteria"),fonticon:"pencil",handler:this._onVolumeSelected.bind(this)},{id:"rename-item-DDCtx",text:f.get("renameVolume"),fonticon:"feather",handler:this._renameVolume.bind(this)},{id:"activate-item-DDCtx",text:f.get("deactivatedCriteria"),fonticon:"eye-off",handler:this._switchCriterionState.bind(this)},{id:"cancel-item-DDCtx",text:f.get("cancelEdit"),fonticon:"cancel",handler:this._cancelEditVolume.bind(this)},{id:"delete-item-DDCtx",text:f.get("deleteCriteria"),fonticon:"trash",handler:this._removeVolume.bind(this)}];this._dropdownCtxMenu=new a({target:m,items:n});return},_renameVolume:function(){this._volumeName.hide();this._renameEditor.show();this._renameEditor._giveFocus()},_cancelEditVolume:function(){this.model.set("state","read");if(!this.model.get("parameters")){this._removeVolume({volId:this._volumeId})}},_removeVolume:function(){this.dispatchEvent("NGF_RemoveVolume",{volId:this._volumeId})},_switchCriterionState:function(){var m=(h.isModelActivated(this.model))?"0":"1";this.model.set("isActivated",m)},_onActivateChange:function(q,r){var n=h.isModelActivated(this.model);var p=(n)?"deactivatedCriteria":"activatedCriteria";this._dropdownCtxMenu.getItem("activate-item-DDCtx").elements.container.getElement(".item-text").innerHTML=f.get(p);var o="fonticon fonticon-"+((n)?"eye-off":"eye");this._dropdownCtxMenu.getItem("activate-item-DDCtx").elements.container.getElement(".fonticon").className=o;var m=this.getContent();if("1"===r){m.removeClassName("f-criterion-deactivated")}else{m.addClassName("f-criterion-deactivated")}},_onFilterNameChange:function(){if(this._volumeName){this._volumeName.setHTML(this.model.get("displayName"))}},_createRenameVolumeUI:function(m){var o=new b({touchMode:true,"class":"innerVolumeFilterHeader",placeholder:f.get("placeHolderVolumeName"),domId:"rename_"+this._volumeId});o.value=this.model.get("displayName");o.inject(m,"after");var n=this;o.addEventListener("focus",function(p){p.target.value=n.model.get("displayName")});o.addEventListener("change",function(p){p.target.hide();if(""!==p.dsModel.value){n.model.set("displayName",p.dsModel.value)}n._volumeName.show()});o.addEventListener("blur",function(p){p.target.hide();if(""!==p.dsModel.value){n.model.set("displayName",p.dsModel.value)}n._volumeName.show()});return o},volumeViewFromMdl:function(m){this.model.set("parameters",m.parameters);this.model.set("state","read");if("0"===m.isActivated){this._switchCriterionState()}}});return e});define("DS/ENONextGenFilterUX/views/CriteriaConfigurationView",["DS/ENONextGenFilterUX/views/CriteriaAbstractView","UWA/Core","UWA/Class/View","UWA/Promise","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/Handlebars/Handlebars","DS/ENONextGenFilterUX/models/CriterionModel","text!DS/ENONextGenFilterUX/templates/configurationViewTemplate.html","text!DS/ENONextGenFilterUX/assets/ENOStrRefinementUX_require.json","DS/UIKIT/DropdownMenu","DS/ENONextGenFilterUX/utils/FilterUIService","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/TooltipModel"],function(o,n,e,k,g,d,c,j,f,i,a,l,p,b,m){var h=o.extend({className:"configurationCriterion",tagName:"li",domEvents:{"click .configCriterion-read .confRead":"_checkBeforeEdit"},setup:function(q){this._parent(q);this._configFactory=undefined;this._rootID=q.rootId;this._template=c.compile(f);this._hasConf=false;this.listenTo(this.model,"onChange:state",this.onStateChange.bind(this))},render:function(){this.container.setContent(this._template({stateClass:this.model.get("state"),titleClass:g.get("titleConfigurationUX"),iconHeader:d.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_ConfigurationFilter.png")}));this._createHeaderCtxMenu();return this},onStateChange:function(q,z){var u=this.getElement(".f-configuration-container");u.setAttribute("class","f-configuration-container "+z);var s=["edit","activate"];var r=["cancel"];if("read"===z){var x=this.model.criterionToString()||"";var t=x;var w=l.MAX_CAR_FOR_CONFIG;var y=this.getElement(".confRead");if(w<=t.length){if(!this._extensionText){this._extensionText=new p({touchMode:l.TOUCH_MODE,displayStyle:"lite",label:g.get("ShowMore"),id:"ShowMoreOrLess_"+this._childGroupId,checkFlag:false});this._extensionText.inject(y,"after");this._extensionText.getContent().addClassName("filter-anchor-style");var v=this;this._extensionText.addEventListener("buttonclick",function(A){A.dsModel.checkFlag=!A.dsModel.checkFlag});this._extensionText.addEventListener("change",function(B){var A=v.model.criterionToString();var C=A;if(!B.dsModel.checkFlag){B.dsModel.label=g.get("ShowMore");C=C.substr(0,w)+" ..."}else{B.dsModel.label=g.get("ShowLess")}v._displayConfigValue(y,C,A)})}if(!this._extensionText.checkFlag){t=t.substr(0,w)+" ...";this._displayConfigValue(y,t,x)}else{this._extensionText.checkFlag=false}this._extensionText.show()}else{if(this._extensionText){this._extensionText.hide()}this._displayConfigValue(y,t,x)}this._showCtxItem(s);this._hideCtxItem(r)}else{this.dispatchEvent("NGF_Criterion_SwitchedToEdit");this._launchConf();this._showCtxItem(r);this._hideCtxItem(s)}},_displayConfigValue:function(q,r,s){q.setContent([{tag:"span",html:r}]);if(!q.tooltipInfos){q.tooltipInfos=new m({shortHelp:s,mouseRelativePosition:false})}else{q.tooltipInfos.shortHelp=s}},_getDOMElementToUpdateOnActivateChange:function(){var q=[];q.push(this.getElement("#"+this._getId()+" .configCriterion-read"));return q},destroy:function(){this._hasConf=false;this.dispatchEvent("NGF_RemoveCriterion",{idxView:this.cid,hasConf:this._hasConf});this.stopListening();this.model=null;this._parent();this.container=null},_getCallbackToEditCriterion:function(){var q=this.editConfiguration.bind(this);return q},editConfiguration:function(){this.model.set("state","edit")},_launchConf:function(t){var r=this;var q=JSON.parse(i);var s=q.conf;require([s],function(v){r._configFactory=v;var w;if(false===r._hasConf){w={}}else{w=r.model.get("expression")}var u={rootId:r._rootID,callback:r._onConfigFilterCB.bind(r),expression:w,tenant:l.getPlatformId(),renderTo:r.getElement(".configCriterion-edit"),renderToApp:l.getGlobalEditContainer(r._filterId),hideFilter:r._hideFilterContainer.bind(r),showFilter:r._showFilterContainer.bind(r)};r._configFactory.begin(u)})},_onConfigFilterCB:function(v){if(0===v.length){var s={};s.action="remove";s.displayMode=1;this.dispatchEvent("NGF_Criterion_Config",s)}else{var t=v[0][this._rootID].filterName;var u=v[0][this._rootID].compiledBinary;var r=v[0][this._rootID].displayExpression;var x=v[0][this._rootID].expression;var q=this.model;q.set("displayExpression",r);q.set("config_filter",u);q.set("filterName",t);q.set("expression",x);var w=true;if(w){this._hasConf=true;var s={criteriaType:q.get("criteriaType"),action:"update",model:q,hasConf:this._hasConf,displayMode:1};this.dispatchEvent("NGF_Criterion_Config",s);if(!l.isModelActivated(q)&&true===this._isCriterionModified()){this._switchCriterionState()}this.dispatchEvent("NGF_Criterion_Validation",{criteriaType:q.get("criteriaType"),})}if("none"!==l.getGlobalEditContainer(this._filterId).getStyle("display")){l.showFilterContainer(true)}}},_isCriterionModified:function(){var q=true;return q},isCriterionValidate:function(){var q;if(this._configFactory&&this._configFactory.validateConfigurationFilter){q=("edit"===this.model.get("state"))?this._configFactory.validateConfigurationFilter():true}else{q=("read"===this.model.get("state"))?true:false}return q},viewFromMdl:function(q){this.model.set("displayExpression",q.displayExpression);this.model.set("config_filter",q.config_filter);this.model.set("filterName",q.filterName);this.model.set("expression",q.expression);if("0"===q.isActivated){this._switchCriterionState()}},isThereCriteria:function(){return this._hasConf},_createHeaderCtxMenu:function(){var q=[{id:"cancel-item-DDCtx",text:g.get("cancelEditCriteria"),fonticon:"cancel",handler:this._cancelEditCriteria.bind(this)}];this._createCriterionCtxMenu(this.getElement(".criterionDropDown"),q);this._hideCtxItem(["edit","activate"])},_cancelEditCriteria:function(){if(!this._hasConf){var q=this.model;q.set("displayExpression","");q.set("config_filter","");q.set("filterName","");q.set("expression","")}this._launchConf()}});return h});define("DS/ENONextGenFilterUX/utils/AttributeChecker",["UWA/Class","UWA/Core","UWA/Class/Options","DS/UIKIT/Input/Select","DS/Controls/ComboBox","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/ENONextGenFilterUX/utils/FilterUIService"],function(r,D,f,m,q,v,o){var N="equals",e="notEqual",I="contains",j="startsWith",g="endsWith",z="lowerThan",k="greaterThan",s="strictlyLowerThan",l="strictlyGreaterThan",A="between",J="notBetween",C="on",c="before",w="after",d="strictlyBefore",n="strictlyAfter";var y=v.get(N),L=v.get(e),x=v.get(I),b=v.get(j),K=v.get(g),i=v.get(z),a=v.get(k),F=v.get(s),t=v.get(l),u=v.get(A),B=v.get(J),M=v.get(C),G=v.get(c),E=v.get(w),H=v.get(d),p=v.get(n);var h=r.singleton(f,{init:function(){this._checkInputString=(-1===window.location.href.indexOf("NGFInputString"))?0:1},getAttributeOperators:function(Q,R){var P=R.type,O;switch(P){case"string":O={elementsList:[{labelItem:y,valueItem:N},{labelItem:x,valueItem:I},{labelItem:b,valueItem:j},{labelItem:K,valueItem:g}],selectedIndex:1};break;case"boolean":O={elementsList:[{labelItem:y,valueItem:N}],selectedIndex:0};break;case"real":case"integer":O={elementsList:[{labelItem:y,valueItem:N},{labelItem:i,valueItem:z},{labelItem:a,valueItem:k},{labelItem:F,valueItem:s},{labelItem:t,valueItem:l},{labelItem:u,valueItem:A}],placeholder:v.get("selectOp"),selectedIndex:0};break;case"dateTime":case"timestamp":O={elementsList:[{labelItem:M,valueItem:C},{labelItem:E,valueItem:w},{labelItem:p,valueItem:n},{labelItem:G,valueItem:c},{labelItem:H,valueItem:d},{labelItem:u,valueItem:A}],placeholder:v.get("selectOp"),selectedIndex:0};break;case"enumeration":O={elementsList:[{labelItem:y,valueItem:N},],selectedIndex:0};break}O.touchMode=o.TOUCH_MODE;O.enableSearchFlag=false;return new q(O)},getForbiddenCharacter:function(S,R,Q){var P=[];switch(S){case"string":P=["'",'"',"","\\","(",")","[","]","{","}","?","*"];var O=P.concat(["+","=",":","<",">"]);switch(R){case N:break;case I:P=O.concat(["|","$"]);break;case j:P=O.concat(["-"]);break;case g:P=O.concat(["|","$"]);break;default:}break}return P},checkOperatorAndValue:function(U,W,V,Q){var X=true;var O="";var T=this.getForbiddenCharacter(U,W,Q);switch(U){case"string":var P=T.length;for(var S=0;S<P;S++){if(-1!==V.indexOf(T[S])){O+=T[S];X=false}}break}var R={isValid:X,forbidden:O};return R},getForbiddenCharacterAsRegExp:function(S,R,P){var Q="[^]+";var O=this.getForbiddenCharacter(S,R,P);if(O.length){Q=O.join("");Q=Q.replace("\\","\\\\");Q=Q.replace("[","\\[");Q=Q.replace("]","\\]");Q="[^"+Q+"]+";Q=(1===this._checkInputString)?Q:"[^]+"}return Q}});return h});define("DS/ENONextGenFilterUX/views/AttributeView",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Date","DS/Controls/DatePicker","DS/ENONextGenFilterUX/utils/FilterUIService","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/ENONextGenFilterUX/utils/AttributeChecker","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Controls/SpinBox","DS/Controls/Button","css!DS/ENONextGenFilterUX/ENONextGenFilterUX.css","DS/Controls/TooltipModel","DS/ENOFilterBIUX/FBISettings"],function(o,c,q,n,k,j,f,b,d,i,e,l,p,h,m,g){var a=c.extend({domEvents:{},tagName:"div",className:"attr-edit-inputs-Attribute-Master",setup:function(r){this.idAttr=r.idAttr;this.selectedType=r.selectedType;this.selectedExtension=r.selectedExtension;this.attributes=r.xAttributes;this.model.set("attrSetId",r.attrSetId);this._isMultiSelActivated=g.getOption("attribute_MultiSelOnValue")||0;this._maxSuggestedValue=g.getOption("attribute_MaxSuggestedValue")||100;this._maxSuggestedValue=Number.MAX_VALUE;this._updateMRUMode=0;this._separatorMRU={labelItem:"",iconItem:{iconName:"list"}};this.displayRemoveButton=r.displayRemoveButton;this._disableAddGroupButton=r.disableAddGroupButton;this._lastSelectedIndex=-1;this._attrDiv=this.getContent();this._attrDiv.id=this._getId();if(j.TOUCH_MODE){this._attrDiv.removeClassName("filter-no-touch-mode")}else{this._attrDiv.addClassName("filter-no-touch-mode")}this.container.addEvent("click",function(s){s.stopPropagation();return false})},render:function(){this._cmdDiv=o.createElement("div",{"class":"attribute-edit-command"});this._cmdDiv.inject(this._attrDiv);var r=this._cmdDiv;if(this.selectedType&&this.attributes){this._createAttributeUI()}if(j.TOUCH_MODE){r.removeClassName("filter-no-touch-mode")}else{r.addClassName("filter-no-touch-mode")}this._removeAttributeBtn=this._createRemoveAttributeButton(r);if(!this.displayRemoveButton){}this._addAttributeGroupBtn=this._createAddAttributeGroupButton(r);if(!this.displayAddGroupButtons){this._addAttributeGroupBtn.hide()}this._addAttributeGroupBtn.disabled=(this._disableAddGroupButton)?true:false;this._addAttributeGroupBtn.active=(this._addAttributeGroupBtn.disabled)?false:true;this._addAttributeBtn=this._createAddAttributeButton(r);if(!this.displayAddButtons){this._addAttributeBtn.hide()}return this},_getId:function(r){var s="attribute_"+((undefined===r)?this.idAttr:r);return s},_cleanAttributes:function(){if(this.attributeCombo&&this.attributeCombo.elements){this.attributeCombo.elements.container.remove();delete this.attributeCombo;this._cleanOperator()}},_cleanOperator:function(){if(this.opCombo&&this.opCombo.elements){this.opCombo.elements.container.remove();delete this.opCombo;this._cleanAttrValuation()}},_createAttributeUI:function(){var r=this;r._cleanAttributes();r.attributeCombo=r._buildAndFeedCombo("attribute",r.attributes,r.idAttr);r.attributeCombo.addEventListener("change",function(v){if(1!==r._getMRUMode()){var t=r.attributeCombo.elementsList[v.dsModel.selectedIndex];if(t&&r._separatorMRU.labelItem===t.labelItem&&r._separatorMRU.iconItem.iconName===t.iconItem.iconName){r._setMRUMode(1);r.attributeCombo.selectedIndex=r._lastSelectedIndex;r._setMRUMode(0)}else{r._lastSelectedIndex=v.dsModel.selectedIndex;var s=v.dsModel.currentLabel;var u=r.keepAttrInfosFromLabel[s];if(u){r.model.set("attribute",u);r.model.set("nlsAttribute",s);r.buildAttrOperator(s,u);r.dispatchEvent("NGF_AttributeSelected",{attrSetId:r._attrSetId})}else{r._cleanOperator();r.model.set("attribute","");r.model.set("nlsAttribute","");r.attributeCombo.selectedIndex=-1}}}})},buildAttrOperator:function(t,s){var v=this;var u=s.type;var r=s.rangeValues||[];this._cleanOperator();this.opCombo=d.getAttributeOperators(this.model,s);this.opCombo.inject(this._cmdDiv,"before");if(v.opCombo.currentValue){v.model.set("attrOp",v.opCombo.currentValue);v.model.set("nlsAttrOp",v.opCombo.currentLabel);v._buildAttrValue(u,r,v.opCombo.currentValue,true)}this.opCombo.addEventListener("change",function(){var x=v.model.get("attrOp");v.model.set("attrOp",v.opCombo.currentValue);v.model.set("nlsAttrOp",v.opCombo.currentLabel);var w=false;if("between"!==x&&"between"===v.opCombo.currentValue){w=true}else{if("between"===x&&"between"!==v.opCombo.currentValue){w=true}}v._buildAttrValue(u,r,v.opCombo.currentValue,w)});return this.opCombo},_cleanAttrValuation:function(){var s="",u="";var t=this._attrDiv;if(this.getElement("#attrValue")){try{t.removeChild(this.getElement("#attrValue"))}catch(r){s=r.message;try{t.removeChild(this.getElement("#attrValue").getParent())}catch(v){u=v.message}}this.attrValuation=null;this.model.set("attrValue",undefined)}else{if(this.getElement("#attrValue_1")){try{t.removeChild(this.getElement("#attrValue_2"));t.removeChild(this.getElement("#attrValue_1"))}catch(r){s=r.message;try{t.removeChild(this.getElement("#attrValue_1").getParent());t.removeChild(this.getElement("#attrValue_2").getParent())}catch(v){u=v.message}}this.attrValuation1=null;this.attrValuation2=null;this.model.set("attrValue_1",undefined);this.model.set("attrValue_2",undefined)}}},_buildAttrValue:function(u,B,s,v,z){var w=this;if(undefined===v||v){this._cleanAttrValuation();switch(u){case"string":var A=(!B.literalInfo)?B:B.literalInfo;var t=(A)?A.length:0;var y=(this._maxSuggestedValue>=t)?0:1;var x=0;if(!y){if(0===t){x=(z&&o.is(z,"array"))?1:x}else{x=1}}if(0===x){var r=d.getForbiddenCharacterAsRegExp(u,s);this.attrValuation=new e({touchMode:j.TOUCH_MODE,placeholder:f.get("placeHolderAttrValue"),domId:"attrValue",pattern:r});this.attrValuation.inject(this._cmdDiv,"before");if(y){this.attrValuation.getContent().addClassName("max-suggested-value")}this.attrValuation.addEventListener("change",function(C){w.model.set("attrValue",C.dsModel.value||C.dsModel.currentValue||undefined)});if(z){this.attrValuation.value=z}}else{this.attrValuation=this._buildEnumComboBox(u,"attrValue",B,z)}break;case"boolean":this.attrValuation=this._buildEnumComboBox(u,"attrValue",B,z);break;case"integer":case"real":if(-1!==s.indexOf("between")){this.attrValuation1=this._buildNumSection(u,"attrValue_1",B,((z)?z[0]:undefined));this.attrValuation2=this._buildNumSection(u,"attrValue_2",B,((z)?z[1]:undefined))}else{this.attrValuation=this._buildNumSection(u,"attrValue",B,z)}break;case"dateTime":case"timestamp":if(-1!==s.indexOf("between")){this.attrValuation1=this.buildDateSection("attrValue_1",((z)?z[0]:undefined));this.attrValuation2=this.buildDateSection("attrValue_2",((z)?z[1]:undefined))}else{this.attrValuation=this.buildDateSection("attrValue",z)}break}if(undefined!==this.attrValuation&&null!==this.attrValuation){}if(undefined!==this.attrValuation1&&null!==this.attrValuation1){}if(undefined!==this.attrValuation2&&null!==this.attrValuation2){}}},buildDateSection:function(x,u){var w=new k({touchMode:j.TOUCH_MODE,domId:x});w.inject(this._cmdDiv,"before");var s=w.value;var t=n.parse(s);var r=new n(t).strftime("%m/%d/%Y").toLocaleString();this.model.set(x,r);var v=this;w.addEventListener("change",function(B){var z=B.dsModel.value;var A=n.parse(z);var y=new n(A).strftime("%m/%d/%Y").toLocaleString();w.currentValue=y;v.model.set(x,y)});if(u){w.value=u}return w},_buildNumSection:function(t,u,C,z){var B=(!C.literalInfo)?C:C.literalInfo;var s=(B)?B.length:0;var A=(this._maxSuggestedValue>=s)?0:1;var y=0;if(!A){if(0===s){y=(z&&o.is(z,"array"))?1:y}else{y=1}}var r;if(0===y){var w=j.HEIGTH_UI_COMPONENT;var x=0;r=new l({touchMode:j.TOUCH_MODE,domId:u,value:x,stepValue:1,decimals:("integer"===t)?0:8,pageStepValue:1,minWidth:w,minHeight:w,preferredWidth:w,preferredHeight:w});r.inject(this._cmdDiv,"before");var v=this;r.addEventListener("change",function(D){v.model.set(u,D.dsModel.value||D.dsModel.currentValue||undefined)});if(z){r.value=z}this.model.set(u,r.value)}else{r=this._buildEnumComboBox(t,u,C,z)}return r},_buildAndFeedCombo:function(s,w,t){var v=this;var r=this._buildAttributesComboItems(w);var u=new i({touchMode:j.TOUCH_MODE,elementsList:r.items,preselectedIndex:r.indexToSelect,placeholder:UWA.String.format(f.get("placeHolderSelectEntity"),f.get(s)),autocompleteFlag:false,generateRegexpString:function(x){return x}});u.inject(this._cmdDiv,"before");return u},_alphabeticSort:function(s,r){var t=0;if(undefined!==s&&undefined!==r){t=(s.labelItem<=r.labelItem)?-1:1}return t},destroy:function(){this.stopListening();this.model=null;this._parent();this.container=null},_buildEnumComboBox:function(u,y,F,C){var E=[];var z=false;var w=false;if("boolean"===u&&(undefined===F||undefined===F.literalInfo||0===F.literalInfo.length)){E=[{labelItem:f.get("true"),valueItem:"true"},{labelItem:f.get("false"),valueItem:"false"}];z=true}else{var s={};var B=(!F.literalInfo)?F:F.literalInfo;var v=B.length;for(var x=0;x<v;x++){var G={valueItem:UWA.is(B[x].value,"array")?B[x].value.join("/"):B[x].value,labelItem:B[x].nlsValue||B[x].nlsvalue||valueItem};E.push(G);var D=G.labelItem;if(!s[D]){s[D]=[]}s[D].push(x)}z=F.editable||false;var t=g.getOption("attribute_MultiSelOnValue");if(1===t&&this.opCombo&&"between"!==this.opCombo.currentValue){w=(1<E.length)?true:false;z=(w)?false:z}}var r=new i({touchMode:j.TOUCH_MODE,placeholder:(z)?f.get("placeHolderAttrValue"):f.get("placeHolderSelectAttrValue"),elementsList:E,enableSearchFlag:z,autocompleteFlag:false,multiSelFlag:w,domId:y,_validateOnBlurForTMCAndFilterApp:true});r.inject(this._cmdDiv,"before");if(z){r.generateRegexpString=function(H){return H}}if(w){r.getContent().addClassName("attribute-edit-combo-enum")}var A=this;r.addEventListener("change",function(H){A.model.set(y,H.dsModel.value||H.dsModel.currentValue||undefined)});if(C){if(w){r.value=(o.is(C,"array"))?C:[C]}else{r.value=(o.is(C,"array")&&C.length)?C[0]:C}}return r},_setMRUMode:function(r){this._updateMRUMode=(r)?r:0;this._updateMRUMode=(0!==this._updateMRUMode)?1:0},_getMRUMode:function(){return this._updateMRUMode},_updateMRU:function(){var w=this;var C=this.selectedType||"";var r=this.selectedExtension||"NoExtension";var B=w.model.get("nlsAttribute")||"";var t=(w.model.get("attribute"))?w.model.get("attribute").value:"";var v={label:(B.length)?B:t,name:t};if(0!==C.length&&0!==B.length&&w.attributeCombo){var z="NGF_"+C+"_"+r;var x=JSON.parse(window.localStorage.getItem(z))||[];var y=-1;var s=x.length;for(var u=0;u<s;u++){if(x[u].label===B){y=u;break}}if(-1===y){x.push(v);if(x.length>j.MAX_MRU_ATTRIBUTE){x.shift()}}else{var A=x[y];x.push(A);x.splice(y,1)}window.localStorage.setItem(z,JSON.stringify(x))}},updateMRUOfAttrCombo:function(){var C=this.selectedType||"";var u=this.selectedExtension||"NoExtension";if(0!==C.length&&this.attributeCombo){var z=this.attributeCombo.elementsList.slice();var s=(-1!==this.attributeCombo.selectedIndex)?z[this.attributeCombo.selectedIndex]:"";var A="NGF_"+C+"_"+u;var x=JSON.parse(window.localStorage.getItem(A))||[];var w=-1;var r=this._separatorMRU.labelItem;var t=this._separatorMRU.iconItem.iconName;for(var v=0;v<j.MAX_MRU_ATTRIBUTE+1;v++){if(v<z.length){if(r===(z[v].labelItem)&&t===z[v].iconItem.iconName){w=v;break}}}for(var v=0;v<x.length;v++){var B={labelItem:x[v].label,iconItem:{iconName:"clock"}};z.unshift(B)}if(0<w){z.splice(x.length,w)}this._setMRUMode(1);this.attributeCombo.elementsList=z;var y=-1;for(var v=0;v<z.length;v++){if(s.labelItem===z[v].labelItem){y=v;break}}this.attributeCombo.selectedIndex=y;this._setMRUMode(0)}},_checkBounds:function(){var t=true;if(undefined!==this.model.get("attrValue_1")){var s=this.model.get("attrValue_1")||this.attrValuation1.value;var r=this.model.get("attrValue_2")||this.attrValuation2.value;var u="";switch(this.model.get("attribute").type){case"string":break;case"integer":case"real":if(parseFloat(r)<parseFloat(s)){t=false;u=f.get("badValueDefined")}break;case"dateTime":case"timestamp":if(((new n(r).getTime())<(new Date(s).getTime()))){t=false;u=f.get("badValueDefined")}break;default:}}return t},_createAddAttributeButton:function(r){var u=new p(j.getAttributeButtonStyle("plus"));u.inject((r)?r:this._attrDiv);u.tooltipInfos=new m({shortHelp:f.get("AddAttribute"),mouseRelativePosition:false});var t="attribute-edit-button-style"+((j.TOUCH_MODE)?"":" filter-no-touch-mode");u.getContent().addClassName(t+" attribute-edit-add-btn");var s=this;u.addEventListener("click",function(v){s.dispatchEvent("NGF_AddAttribute",{})});return u},_createAddAttributeGroupButton:function(r){var u=new p(j.getAttributeButtonStyle("group-add"));u.inject((r)?r:this._attrDiv);u.tooltipInfos=new m({shortHelp:f.get("AddAttributeGroup"),mouseRelativePosition:false});var t="attribute-edit-button-style"+((j.TOUCH_MODE)?"":" filter-no-touch-mode");u.getContent().addClassName(t+" attribute-edit-addGroup-btn");var s=this;u.addEventListener("click",function(v){if(!s._disableAddGroupButton){s.dispatchEvent("NGF_AddAttributeGroup",{})}else{}});return u},_createRemoveAttributeButton:function(r){var u=new p(j.getAttributeButtonStyle("close"));u.inject((r)?r:this._attrDiv);u.tooltipInfos=new m({shortHelp:f.get("RemoveAttribute"),mouseRelativePosition:false});var t="attribute-edit-button-style"+((j.TOUCH_MODE)?"":" filter-no-touch-mode");u.getContent().addClassName(t+" attribute-edit-remove-btn");var s=this;u.addEventListener("click",function(v){s.dispatchEvent("NGF_RemoveAttribute",{attrId:s._getId(),idx:s.idAttr})});return u},attrViewFromMdl:function(s){if(!o.is(s,"object")){return}var t=(s.attribute)?s.attribute.uri:s.uri;if(this.attributeCombo){this.attributeCombo.currentValue=this.keepAttrInfosFromName[t]||-1}if(this.opCombo&&s.attrOp){this.opCombo.currentValue=s.attrOp}var r=j.ATTRIBUTE_NOT_VALUATED;if(this.attrValuation&&s.attrValue){if(r!==s.attrValue){this.attrValuation.value=s.attrValue}}else{if((this.attrValuation1&&s.attrValue_1)||(this.attrValuation2&&s.attrValue_2)){if(undefined!==this.attrValuation1.value||undefined!==this.attrValuation2.value){if(this.attrValuation1&&s.attrValue_1){if(r!==s.attrValue_1){this.attrValuation1.value=s.attrValue_1}}if(this.attrValuation2&&s.attrValue_2){if(r!==s.attrValue_2){this.attrValuation2.value=s.attrValue_2}}}}else{if(!this.opCombo||(this.opCombo&&"between"!==this.opCombo.currentValue)){if(this.attrValuation){this.attrValuation.value=undefined}}else{if(this.attrValuation1){this.attrValuation1.value=undefined;this.attrValuation2.value=undefined}}}}},isAttrValid:function(){var s="";var z="";var D=this.getAttrParam();var v=true;var y=false;var u=D.values.length;var r=f.get("InvalidCharInLabel");for(var x=0;x<u;x++){var A=(o.is(D.values[x],"array"))?D.values[x].join(""):D.values[x];var w=d.checkOperatorAndValue(D.type,D.op,A,D.synthesisValue);if(!w.isValid){s="InvalidCharInValue";z="' "+w.forbidden+" '  "+r+"  "+D.nlsName+" "+D.nlsOp+" "+D.values[0];y=true;break}}var t=this._checkBounds();if(!t){s="badValueDefined";z=D.nlsName+" "+D.nlsOp+" "+D.values[0]+" "+D.values[1]}var C=v&&!y&&t;if(C){this._updateMRU()}var B={isValid:C,errorKey:s,errorMsg:z};if(C){if(this.getElement("#attrValue")){this.getElement("#attrValue").removeClassName("attr-edit-inputs-Attribute-Error")}else{if(this.getElement("#attrValue_1")){this.getElement("#attrValue_2").removeClassName("attr-edit-inputs-Attribute-Error")}}}else{if(this.getElement("#attrValue")){this.getElement("#attrValue").addClassName("attr-edit-inputs-Attribute-Error")}else{if(this.getElement("#attrValue_1")){this.getElement("#attrValue_2").addClassName("attr-edit-inputs-Attribute-Error")}}}return B},getAttrParam:function(){var t=[];if(undefined!==this.model.get("attrValue")){t.push(this.model.get("attrValue"))}else{if(undefined!==this.model.get("attrValue_1")){t.push(this.model.get("attrValue_1"));t.push(this.model.get("attrValue_2"))}}var r=(this.model.get("nlsAttribute"))?this.model.get("nlsAttribute"):"";var w=this.keepAttrInfosFromLabel[r];var v=(r.length)?w.type:"";var u=(w&&w.rangeValues)?w.rangeValues.editable:undefined;var s={type:v,name:(this.model.get("attribute"))?this.model.get("attribute").value:"",nlsName:r,op:this.model.get("attrOp"),nlsOp:this.model.get("nlsAttrOp"),values:t,synthesisValue:u};return s},isAttrEmpty:function(){var r=this.model.get("attribute");return(undefined===r||""===r)?true:false},setFocus:function(){if(undefined!==this.attributeCombo){this.attributeCombo._getMainElement().focus()}},initParams:function(){this.attributeCombo.selectedIndex=-1},getParams:function(){var r={attribute:this.model.get("attribute"),attrOp:this.model.get("attrOp"),attrValue:this.model.get("attrValue"),attrValue1:this.model.get("attrValue_1"),attrValue2:this.model.get("attrValue_2"),attributes:this.attributes,elementsList:this.attributeCombo.elementsList,keepAttrInfosFromLabel:this.keepAttrInfosFromLabel};return r},setParams:function(t){this.attributes=t.attributes;this.keepAttrInfosFromLabel=t.keepAttrInfosFromLabel;this.attributeCombo.elementsList=t.elementsList;if(undefined===t.attribute){this.attributeCombo.selectedIndex=-1}else{var s=Object.keys(this.keepAttrInfosFromLabel);for(var r=0;r<s.length;r++){if(t.attribute.label===this.keepAttrInfosFromLabel[s[r]].label){this.attributeCombo.currentValue=s[r];break}}if(this.opCombo){this.opCombo.currentValue=t.attrOp}if(this.attrValuation){if(undefined!==this.attrValuation.value){this.attrValuation.value=t.attrValue}else{this.attrValuation.currentValue=t.attrValue}if(this.getElement("#attrValue_1")){this.attrEditInputs.removeChild(this.getElement("#attrValue_2"));this.attrEditInputs.removeChild(this.getElement("#attrValue_1"))}}else{if(undefined!==this.attrValuation1){if(undefined!==this.attrValuation1.value){this.attrValuation1.value=t.attrValue1;this.attrValuation2.value=t.attrValue2}else{this.attrValuation1.currentValue=t.attrValue1;this.attrValuation2.currentValue=t.attrValue2}if(this.getElement("#attrValue")){this.attrEditInputs.removeChild(this.getElement("#attrValue"))}}}}},compareParams:function(s){var r=false;if(!r){if(s.attribute&&this.model.get("attribute")){if(this.model.get("attribute").value!==s.attribute.value){r=true}}else{if(s.attribute||this.model.get("attribute")){r=true}}}if(!r){if(s.attrOp&&this.model.get("attrOp")){if(this.model.get("attrOp")!==s.attrOp){r=true}}else{if(s.attrOp||this.model.get("attrOp")){r=true}}}if(!r){if(s.attrValue&&this.model.get("attrValue")){if(this.model.get("attrValue")!==s.attrValue){r=true}}else{if(s.attrValue||this.model.get("attrValue")){r=true}else{if(s.attrValue1&&this.model.get("attrValue_1")){if(this.model.get("attrValue_1")!==s.attrValue1||this.model.get("attrValue_2")!==s.attrValue2){r=true}}else{if(s.attrValue1||this.model.get("attrValue_1")){r=true}}}}}return r},showAddButtons:function(r){if(r){this._addAttributeBtn.show();this._addAttributeGroupBtn.show()}else{this._addAttributeBtn.hide();this._addAttributeGroupBtn.hide()}},showRemoveButton:function(r){if(r){this._removeAttributeBtn.show()}else{this._removeAttributeBtn.hide()}},reBuildAttributesInfos:function(v){var r=this.attributeCombo.currentValue;var w;var t;if(r){w=this.opCombo.currentValue;if(this.model.get("attrValue")){t=this.model.get("attrValue")}else{if(this.model.get("attrValue_1")){t=[];t.push(this.model.get("attrValue_1"));t.push(this.model.get("attrValue_2"))}}}var s=this._buildAttributesComboItems(v);this.attributeCombo.elementsList=s.items;if(r&&r.length){var u=this.keepAttrInfosFromLabel[r];if(u){this.attributeCombo.currentValue=r;this.opCombo.currentValue=w;this._buildAttrValue(u.type,u.rangeValues,w,true,t)}else{this.attributeCombo.selectedIndex=-1}}},_buildAttributesComboItems:function(v){var x=this._buildAttributesInfos(v);this.keepAttrInfosFromLabel=x.infosFromLabel||{};this.keepAttrInfosFromName=x.infosFromName||{};var t=x.maxItemLength;var u=x.items;var s=[];var A="NGF_"+this.selectedType+"_"+(this.selectedExtension||"NoExtension");var z=JSON.parse(window.localStorage.getItem(A))||[];if(0!==z.length){z.reverse();var w=this;z.forEach(function(B){if(w.keepAttrInfosFromName[B.name]){s.push({labelItem:w.keepAttrInfosFromName[B.name],iconItem:{iconName:"clock"}})}})}this._separatorMRU.labelItem="-".repeat(t);s.push(this._separatorMRU);var r=(1===u.length)?0:-1;var y=s.concat(u.sort(this._alphabeticSort));return{items:y,indexToSelect:r}},_buildAttributesInfos:function(v){var t=[];var u=0;var s={};var r={};v.forEach(function(C){var w;if(C.range&&C.range.dataTypes[0]){w=C.range.dataTypes[0].split("#")[1]}else{if(C.dataTypes){w=C.dataTypes}else{if(C.dataType){w=C.dataType.split("#")[1]}}}var z=C.label||C.nlsName;var B=C.curi||C.uri;var A=B;var E=1;var D=z;if(!r[D]){r[D]={}}else{E=0;var y=r[D];if(y&&y.uri!==B){D=y.label+"("+y.uri+")";r[D]={type:y.type,uri:y.uri,label:y.label,value:y.value,rangeValues:y.rangeValues||[]};delete r[z];for(var x=0;x<t.length;x++){if(t[x].labelItem===y.label){t[x].labelItem=D;break}}D=z+"("+B+")";E=1}}if(1===E){r[D]={type:w,uri:B,label:z,value:A,rangeValues:C.rangeValues||[]};s[A]=D;t.push({labelItem:D});u=Math.max(u,D.length)}});return{infosFromLabel:r,infosFromName:s,items:t,maxItemLength:u}}});return a});define("DS/ENONextGenFilterUX/views/VolumeCombinationView",["UWA/Core","UWA/Event","UWA/Class/View","UWA/Class/Model","DS/ENONextGenFilterUX/views/VolumeView","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/TooltipModel","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENONextGenFilterUX/models/CriterionModel","DS/PlatformAPI/PlatformAPI"],function(l,h,c,n,d,f,o,m,k,i,g,j){var b=0;var e=0;var a=c.extend({domEvents:{},tagName:"div",className:"attribute-edit-group",setup:function(p){this._appId=p.appId;this._widgetId=p.widgetId;this._filterId=p.filterId;this._isVolumeAvailable=p.volumeAvailable;this._filterSpecId=p.filterSpecId;this._volSetId=p.volSetId||0;this._deepGroup=p.deepGroup||0;this._displayMode=p.displayMode||"light";this._sendEvent=p.sendEvent;this._initCombination=p.initCombination||0;this._volEditInputs=p.volEditInputs;this._listOfVolumes=[];this._subscribe0=j.subscribe("NGFilter_VolumeDefined",this._onVolumeDefined.bind(this));this._subscribe1=j.subscribe("NGFilter_VolumeDefined_Init",this._onVolumeDefinedInit.bind(this));this._subscribe2=j.subscribe("NGFilter_CancelVolumeDefined",this._onCancelVolumeDefined.bind(this))},render:function(){var p="combinationVolume_"+this._filterSpecId+this._volSetId;this.container.setAttribute("id",p);var q=this.getContent();this._divCombination=l.createElement("div",{"class":"attribute-edit-group-Combination"});this._divCombination.inject(this._volEditInputs||q);var r="withAttribute";this._withLabel=this._createCombinationLabel(r,"with");this._withLabel.inject(this._divCombination);this._combinationCombo=this._createCombinationCombo(this._initCombination);this._combinationCombo.inject(this._divCombination);r="FollowingCombination";this._followingLabel=this._createCombinationLabel(r,"following");this._followingLabel.inject(this._divCombination);this._removeBtn=this._createRemoveGroupButton();this._removeBtn.inject(this._divCombination);this._setDisplayMode(this._displayMode||"light");this._createVolume();return this},destroy:function(){this._divCombination.destroy();this._removeVolume();if(0===this._deepGroup&&!this._listOfVolumes.length){b=(0===this._deepGroup)?0:b;e=0;if(this._subscribe0){this._subscribe0.unsubscribe("NGFilter_VolumeDefined");this._subscribe0=undefined}if(this._subscribe1){this._subscribe1.unsubscribe("NGFilter_VolumeDefined_Init");this._subscribe1=undefined}if(this._subscribe2){this._subscribe2.unsubscribe("NGFilter_CancelVolumeDefined");this._subscribe2=undefined}}this.stopListening();this.model=null;this._parent();this.container=null},_setDisplayMode:function(p){switch(p){case"none":this._divCombination.hide();break;case"light":this._divCombination.hide();break;case"middle":this._divCombination.show();this._withLabel.show();this._combinationCombo.show();this._followingLabel.show();this._removeBtn.hide();break;case"full":this._divCombination.show();this._withLabel.show();this._combinationCombo.show();this._followingLabel.show();break;default:}},_createCombinationLabel:function(p,r){var q=l.createElement("label",{"class":"innerfiltertypecombo",text:f.get(p),id:"combination-"+r+"_"+this._volSetId});return q},_createCombinationCombo:function(s){var p=[{labelItem:f.get("AllCombination"),valueItem:"all"},{labelItem:f.get("AnyCombination"),valueItem:"any"}];var r=new o({touchMode:true,elementsList:p,enableSearchFlag:false,domId:"combination-combo_"+this._volSetId});var t=this;r.addEventListener("change",function q(v){var u=v.dsModel.currentValue;t.model.set("combination",u);t._initCombination=v.dsModel.selectedIndex});this.model.set("combination",p[s].valueItem);r.selectedIndex=s;return r},_createRemoveGroupButton:function(){var q=new m(i.getAttributeButtonStyle("close"));q.tooltipInfos=new k({shortHelp:f.get("RemoveVolumeGroup"),mouseRelativePosition:false});q.getContent().addClassName("attribute-edit-button-style attribute-edit-group-remove-btn");var p=this;q.addEventListener("click",function(r){p.dispatchEvent("NGF_RemoveVolumeGroup",{volId:p.container.getAttribute("id")})});return q},_createVolume:function(t){var s=1;var q=this.getElement("#actions_"+this._volSetId);if(!q){s=0;q=this.getContent()}if(0===this._deepGroup){this._updateVolumeUI("volume")}var r=new g();r.set("state","edit");var u=this.model.get("allVolumes")||[];u.push(r);this.model.set("allVolumes",u);this.model.set("state","edit");var p=new d({model:r,filterSpecId:this._filterSpecId,volSetId:this._volSetId,idVol:b,volumeAvailable:this._isVolumeAvailable});b++;p.render().inject(q,(s)?"before":"");p.setFocus();this._showAddButtons(false);this._listOfVolumes.push(p);this._highlightVolumeGroup();if(t){p.model.set("parameters",t.volume);p.model.set("state","read")}this.listenTo(p,"NGF_RemoveVolume",this._onRemoveVolume.bind(this));this.listenTo(p,"NGF_VolumeSelected",this._onSelectedVolume.bind(this));if(!t){if(this._sendEvent){this._onSelectedVolume(p.getValues());p.model.set("state","edit")}}},_highlightVolumeGroup:function(){var q=document.body.getElement(".f-volume-container.edit");if(q){var p=q.getElement(".attribute-edit-group-selected");if(p){p.removeClassName("attribute-edit-group-selected")}}if(0!==this._deepGroup){this.getContent().addClassName("attribute-edit-group-selected")}},_onAddVolumeGroup:function(){this._onValidateEditedVolume();var t=1;var r=this.getElement("#actions_"+this._volSetId);if(!r){t=0;r=this.getContent()}if(0===this._deepGroup){this._updateVolumeUI("group")}var s=new n();s.set("isActivated","1");s.set("state","edit");var u=this.model.get("allVolumes")||[];u.push(s);this.model.set("allVolumes",u);this.model.set("state","read");e++;var p=new a({appId:this._appId,widgetId:this._widgetId,filterId:this._filterId,model:s,volSetId:e,initCombination:(this._initCombination)?0:1,displayMode:"full",deepGroup:this._deepGroup+1,sendEvent:this._sendEvent,filterSpecId:this._filterSpecId,volumeAvailable:this._isVolumeAvailable});p.render().inject(r,(t)?"before":"");this._showAddButtons(true);p.getContent().addClassName("subgroupdivborder");p._highlightVolumeGroup();var q=p._listOfVolumes.length;if(q){p._listOfVolumes[q-1].setFocus()}this._listOfVolumes.push(p);this.listenTo(p,"NGF_RemoveVolumeGroup",this._onRemoveVolume.bind(this));this.listenTo(p,"NGF_ValidateEditedVolume",this._onValidateEditedVolume.bind(this));p._divAction=l.createElement("div",{"class":"attr-edit-actions",id:"actions_"+e});p._divAction.inject(p.getContent());p.addVolumeBtn=p._createAddVolumeButton(p);p.addVolumeBtn.inject(p._divAction);p.addVolumeGroupBtn=p._createAddVolumeGroupButton(p);p.addVolumeGroupBtn.inject(p._divAction);if(i.MAX_DEEP_VOLUME_GROUP===p._deepGroup){p.addVolumeGroupBtn.disabled=true;p.addVolumeGroupBtn.active=false}},_showAddButtons:function(p){if(0===this._deepGroup){this.dispatchEvent("NGF_DisplayAddActions",{display:p})}},_onRemoveVolume:function(p){this._onValidateEditedVolume();this._removeVolumeAndUpdateUI(p);i.resetSelectedVolumeOf3D(this._appId,this._widgetId)},_removeVolumeAndUpdateUI:function(s){var t=s.volId;for(var r=0;r<this._listOfVolumes.length;r++){if(this._listOfVolumes[r].container.id===t){this._removeVolume(r);if(1>=this._listOfVolumes.length){if(0===this._deepGroup){this._switchToSingleVolume()}}if(0===this._listOfVolumes.length){if(0!==this._deepGroup){this.dispatchEvent("NGF_RemoveVolumeGroup",{volId:this.getContent().id})}else{b=0;this._setDisplayMode("none");this.dispatchEvent("NGF_RemoveCriterion",{})}}break}}var p=this._listOfVolumes.length;if(1<=p){var q=this._listOfVolumes[p-1];if(!this._isGroup(q)&&0!==this._deepGroup){q.showAddButtons(true);this._highlightVolumeGroup()}else{this._showAddButtons(false)}}},_removeVolume:function(q){var p=q||0;var s=q+1||this._listOfVolumes.length;for(var r=s-1;r>=p;r--){this._listOfVolumes[r].destroy()}this._listOfVolumes.splice(p,(s-p));var t=this.model.get("allVolumes");if(t){t.splice(p,(s-p))}this.model.set("allVolumes",t)},_onVolumeDefinedInit:function(p){this._onVolumeDefined(p)},_onCancelVolumeDefined:function(){if(0===this._deepGroup){this.removeEmptyVolume();this.model.set("state","edit");i.resetSelectedVolumeOf3D(this._appId,this._widgetId)}},_onVolumeDefined:function(v){if(this._filterId===v.filterId){if("edit"===this.model.get("state")){if(undefined===v.specId||this._filterSpecId===v.specId){if(undefined===v.setId||this._volSetId===v.setId){var q=v.action;var u;if(v.id){var t=this._listOfVolumes.length;for(var s=0;s<t;s++){var p=this._listOfVolumes[s];if(p&&p.model.get("id")===v.id){u=p.model;if("add"===q){if("edit"===u.get("state")&&p.isEmpty()){q="update";break}}}}}if("add"===q){this._onValidateEditedVolume();this.createVolume(v);i.resetSelectedVolumeOf3D(this._appId,this._widgetId)}else{if("update"===q){if(!u&&1===this._listOfVolumes.length){u=this._listOfVolumes[0].model}u.set("state","edit");u.set("parameters",v.volume);u.set("state","read")}}j.publish("Frame3DXInfra.Open",{id:"volume_"+Date.now()})}}}else{if("add"===v.action&&0===this._deepGroup){var w=this._listOfVolumes.length;var r;for(var s=0;s<w;s++){var p=this._listOfVolumes[s];if(p&&"edit"===p.model.get("state")){r=p;break}}if(!r){this.dispatchEvent("NGF_SwitchToEdit",{});this.createVolume(v);i.resetSelectedVolumeOf3D(this._appId,this._widgetId);j.publish("Frame3DXInfra.Open",{id:"volume_"+Date.now()})}}}}},_onValidateEditedVolume:function(){if(0===this._deepGroup){var p=this.model;this._validateEditedVolume_X(p)}else{this.dispatchEvent("NGF_ValidateEditedVolume",{})}},_validateEditedVolume_X:function(p){var u=0;if(p){var v=p.get("allVolumes")||[];var q=v.length;for(var s=0;s<q&&!u;s++){var t=v[s];var r=t.get("allVolumes");if(!r){if("edit"===t.get("state")){t.set("state","read");u=1}}else{u=this._validateEditedVolume_X(t)}}p.set("state","read")}},_onSelectedVolume:function(p){this._onValidateEditedVolume();this.model.set("state","edit");var q={appId:this._appId,widgetId:this._widgetId,action:"update",id:p.id,displayName:p.displayName,volume:p.parameters};j.publish("NGFilter_Volume",q)},_updateVolumeUI:function(p){if(0===this._listOfVolumes.length){if("volume"===p){this._setDisplayMode("light")}else{if("group"===p){this._divCombination.addClassName("attribute-edit-group");this.getContent().removeClassName("attribute-edit-group");this._setDisplayMode("none");this.dispatchEvent("NGF_SwitchDisplayContext",{context:1,combination:this._divCombination,view:this})}}}else{if(1===this._listOfVolumes.length&&!this._isGroup(this._listOfVolumes[0])){this._divCombination.addClassName("attribute-edit-group");this.getContent().removeClassName("attribute-edit-group");this._listOfVolumes[0].showRemoveButton(true);this._listOfVolumes[0].showAddButtons(false);this._setDisplayMode("middle");this.dispatchEvent("NGF_SwitchDisplayContext",{context:1,combination:this._divCombination,view:this})}else{this._setDisplayMode("full")}}},_switchToSingleVolume:function(){if(0===this._listOfVolumes.length){this._divCombination.removeClassName("attribute-edit-group");this.getContent().addClassName("attribute-edit-group");this.dispatchEvent("NGF_SwitchDisplayContext",{context:0,view:this})}else{if(1===this._listOfVolumes.length){if(this._isGroup(this._listOfVolumes[0])){this._setDisplayMode("none")}else{this._divCombination.removeClassName("attribute-edit-group");this.getContent().addClassName("attribute-edit-group");var p=this._listOfVolumes[0];p.showRemoveButton(true);p.showAddButtons(false);this._setDisplayMode("light");this.dispatchEvent("NGF_SwitchDisplayContext",{context:0,view:this})}}}},isVolumeValid:function(){var s=[];var r=this._listOfVolumes.length;for(var u=0;u<r;u++){var t=this._listOfVolumes[u];if(!this._isGroup(t)){var q=t.isVolumeValid();if(!q.isValid){var p=q.errorKey;if(undefined===s[p]){s[p]=""}s[p]+="<br>   "+q.errorMsg}}else{s=t.isVolumeValid()}}return s},_isGroup:function(p){var q=(p._listOfVolumes)?true:false;return q},removeEmptyVolume:function(){this._onValidateEditedVolume();this._removeEmptyVolume_X()},_removeEmptyVolume_X:function(){var q=this._listOfVolumes.length;for(var r=q-1;r>=0;r--){var p=this._listOfVolumes[r];if(!this._isGroup(p)){if(p.isEmpty()){this._removeVolumeAndUpdateUI({volId:this._listOfVolumes[r].getContent().id})}}else{p._removeEmptyVolume_X()}}},viewFromMdl:function(q){var p=this._sendEvent;this._sendEvent=0;var r=q.allVolumes;this._buildVolumeFromModel(r[0]);this._sendEvent=p},_buildVolumeFromModel:function(s){var v=s.allVolumes;this._combinationCombo.currentValue=s.combination;var r=v.length;for(var t=0;t<r;t++){var u=v[t];var p=u.allVolumes;if(!p){if(this._listOfVolumes.length<t+1){this._createVolume()}var q=this._listOfVolumes[t];q.volumeViewFromMdl(v[t])}else{if(this._listOfVolumes.length<t+1){this._onAddVolumeGroup()}var q=this._listOfVolumes[t];q._buildVolumeFromModel(v[t])}}},createVolume:function(p){this._createVolume(p)},createVolumeGroup:function(){this._onAddVolumeGroup()},_createAddVolumeButton:function(p){var r=new m(i.getAttributeButtonStyle("plus"));r.tooltipInfos=new k({shortHelp:f.get("AddVolume"),mouseRelativePosition:false});r.getContent().addClassName("attribute-edit-button-style attribute-edit-add-btn2");var q=p;r.addEventListener("click",function(s){q._createVolume()});return r},_createAddVolumeGroupButton:function(p){var r=new m(i.getAttributeButtonStyle("group-add"));r.tooltipInfos=new k({shortHelp:f.get("AddVolumeGroup"),mouseRelativePosition:false});r.getContent().addClassName("attribute-edit-button-style attribute-edit-addGroup-btn2");var q=p;r.addEventListener("click",function(s){q._onAddVolumeGroup()});return r}});return a});define("DS/ENONextGenFilterUX/views/CriteriaContextMgmtView",["DS/ENONextGenFilterUX/views/CriteriaAbstractView","UWA/Core","UWA/Class/View","UWA/Class/Model","DS/WAFData/WAFData","DS/UIKIT/DropdownMenu","DS/UIKIT/IconDropdown","DS/UIKIT/Input/Button","DS/ENONextGenFilterUX/utils/FilterUIService","DS/Handlebars/Handlebars","text!DS/ENONextGenFilterUX/templates/groupViewTemplate.html","text!DS/ENONextGenFilterUX/templates/contextMgmtViewTemplate.html","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/ENONextGenFilterUX/utils/EditToReadManager","DS/Controls/ComboBox","DS/Controls/Button","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/Controls/Loader","DS/PlatformAPI/PlatformAPI","css!DS/ENONextGenFilterUX/ENONextGenFilterUX.css","DS/ENONextGenFilterUX/views/AttributeView","DS/Controls/Tooltip","DS/Controls/TooltipModel"],function(f,v,k,q,c,s,j,o,w,g,b,a,n,e,p,x,r,z,i,y,d,m,l,u,h){var t=f.extend({className:"contextCriterion",tagName:"li",domEvents:{"click .contextCriterion-read .contextRead":"_checkBeforeEdit","click .contextCriterion-edit .addContextCriterion .displayNumberOfNodesAdded":"_manageExpandCollapse","click .contextCriterion-edit .excludeContextCriterion .displayNumberOfNodesExcluded":"_manageExpandCollapse",},setup:function(A){this._parent(A);this.groupView=A.groupView;this._rootID=A.rootId;this._template=g.compile(a);this.listenTo(this.model,"onChange:state",this.onStateChange.bind(this));d.subscribe("NGFilter.OccPath",this._onPathSelect.bind(this));this.container.addEvent("click",function(B){B.stopPropagation();return false});this._allAddedNodes=[];this._allExcludedNodes=[];this._allAddedNodesLabels=[];this._allExcludedNodesLabels=[];this.model.set("addedNodesList",this._allAddedNodes);this.model.set("excludedNodesList",this._allExcludedNodes);this.model.set("addedNodesLabels",this._allAddedNodesLabels);this.model.set("excludedNodesLabels",this._allExcludedNodesLabels);this.listenTo(this,"updateAddDisplay",this._updateAddDisplay.bind(this));this.listenTo(this,"updateExcludeDisplay",this._updateExcludeDisplay.bind(this));this.model.set("AddNodeActivated",true);this.model.set("ExcludeNodeActivated",true)},render:function(A){this.container.setContent(this._template({stateClass:this.model.get("state"),}));this.createContextFilterUI();this._ctxMenuContextAdd=null;this._ctxMenuContextExclude=null;this._createContextCtxMenuAdd();this._createContextCtxMenuExclude();if(A!=null){this.model.set("state","edit");this._InsertPathInDiv(A,"InsertAllPathsAtOnce");this._InsertExcludedPathInDiv(A,"InsertAllPathsAtOnce");this._setStateOfNodesFromModel();this._updateContextualmenuFromModel()}return this},updateContextMgmtView:function(A){this.model._attributes=A;this._allAddedNodes=A.addedNodesList||[];this._allExcludedNodes=A.excludedNodesList||[];this._allAddedNodesLabels=A.addedNodesLabels||[];this._allExcludedNodesLabels=A.excludedNodesLabels||[];this.model.set("isActivated","1");this.model.set("addedNodesList",this._allAddedNodes);this.model.set("excludedNodesList",this._allExcludedNodes);this.model.set("addedNodesLabels",this._allAddedNodesLabels);this.model.set("excludedNodesLabels",this._allExcludedNodesLabels);this.model.set("AddNodeActivated",(A.AddNodeActivated||true));this.model.set("ExcludeNodeActivated",(A.ExcludeNodeActivated||true))},editContext:function(A){this.model.set("state","edit");this.dispatchEvent("NGF_Criterion_SwitchedToEdit");this._manageAddNodesView()},_manageAddNodesView:function(){this.getElement(".nodesExcludeDisplay").addClassName("node-collapse");this.getElement(".nodesExcludeDisplay").removeClassName("node-expand");this.getElement(".nodesAddDisplay").addClassName("node-expand");this.getElement(".nodesAddDisplay").removeClassName("node-collapse");var B=this.getElement(".context-nodesToExclude-expander");B.addClassName("fonticon-expand-right");B.removeClassName("fonticon-expand-down");var A=this.getElement(".context-nodesToAdd-expander");A.addClassName("fonticon-expand-down");A.removeClassName("fonticon-expand-right")},_onPathSelect:function(B){if(this.getElement(".nodesAddDisplay").hasClassName("node-expand")){var A=this.model.get("AddNodeActivated");if(A){if((!this._checkIfPathIsAlreadyAdded(B))&&(!this._checkIfPathIsAlreadyExcluded(B))){this._allAddedNodes.push(B.selectedPath);this._allAddedNodesLabels.push(B.pathAlias);if(this.getElement(".nodesAddedList")){this._InsertPathInDiv(B)}}}}else{if(this.getElement(".nodesExcludeDisplay").hasClassName("node-expand")){var A=this.model.get("ExcludeNodeActivated");if(A){if((!this._checkIfPathIsAlreadyAdded(B))&&(!this._checkIfPathIsAlreadyExcluded(B))){this._allExcludedNodes.push(B.selectedPath);this._allExcludedNodesLabels.push(B.pathAlias);if(this.getElement(".nodesExcludedList")){this._InsertExcludedPathInDiv(B)}}}}}},_checkIfPathIsAlreadyAdded:function(F){var D;var E=F.selectedPath;var I=this._checkRootAndPath(E);if(!I){w.showNotification({level:"info",message:n.get("ObjectNotUnderRoot"),sticky:false});D=true}else{var A=false;var H=false;for(var G=0;G<this._allAddedNodes.length;G++){var B=false;for(var C=0;C<=E.length&&!B;C++){if(E[C]&&E[C]!=this._allAddedNodes[G][C]){B=true}}if(!B&&E.length<this._allAddedNodes[G].length){A=true}else{if(!B){H=true;break}}}if(H){w.showNotification({level:"info",message:n.get("AlreadyAdded"),sticky:false});D=true}else{if(A){D=false}}}return D},_checkIfPathIsAlreadyExcluded:function(E){var D=false;var A=E.selectedPath;var G=this._checkRootAndPath(A);if(!G){w.showNotification({level:"info",message:n.get("ObjectNotUnderRoot"),sticky:false});D=true}else{for(var C=0;C<this._allExcludedNodes.length;C++){var F=false;for(var B=0;B<=A.length;B++){if((this._allExcludedNodes[C][B])&&(A[B]!=this._allExcludedNodes[C][B])){F=true}}if(!F){w.showNotification({level:"info",message:n.get("AlreadyExcluded"),sticky:false});D=true;break}}}return D},_checkRootAndPath:function(A){if(this._rootID==A[0]){return true}else{return false}},_InsertPathInDiv:function(E,F){if(!document.querySelector(".wux-chip-cell-addlabel")){if(document.querySelector(".nodesAddedList")){document.querySelector(".nodesAddedList").empty()}}if("InsertAllPathsAtOnce"==F){for(var C=0;C<E.addedNodesLabels.length;C++){var A=new UWA.Element("div",{"class":"wux-chip-cell-container",});var B=new UWA.Element("li",{"class":"wux-chip-cell-close fonticon fonticon-wrong","font-family":"DSFontIcon"});var D=new UWA.Element("li",{"class":"wux-chip-cell-addlabel",html:E.addedNodesLabels[C]});D.setAttribute("occid",E.addedNodesList[C]);A.appendChild(D);D.appendChild(B);this.getElement(".nodesAddedList").addContent(A);this.getElement(".nodesAddedList").removeClassName("nodes-color");this.dispatchEvent("updateAddDisplay");B.onclick=this._removePathFromSelectionList.bind(this)}}else{var A=new UWA.Element("div",{"class":"wux-chip-cell-container",});var B=new UWA.Element("li",{"class":"wux-chip-cell-close fonticon fonticon-wrong","font-family":"DSFontIcon"});var D=new UWA.Element("li",{"class":"wux-chip-cell-addlabel",html:E.pathAlias});D.setAttribute("occid",E.selectedPath);A.appendChild(D);D.appendChild(B);this.getElement(".nodesAddedList").addContent(A);this.getElement(".nodesAddedList").removeClassName("nodes-color");this.dispatchEvent("updateAddDisplay");B.onclick=this._removePathFromSelectionList.bind(this)}},_removePathFromSelectionList:function(E){if(this.model.get("AddNodeActivated")){var D=E.target.parentElement.getAttribute("occid").split(",");for(var B=0;B<this._allAddedNodes.length;B++){var C=true;if(D.length==this._allAddedNodes[B].length){for(var A=0;A<D.length&&true==C;A++){if(D[A]!=this._allAddedNodes[B][A]){C=false}}if(C){this._allAddedNodes.splice(B,1);this._allAddedNodesLabels.splice(B,1);E.target.parentElement.parentElement.remove();this.dispatchEvent("updateAddDisplay")}}}}},_updateAddDisplay:function(){var A=this._allAddedNodes.length;if(A<=1){this.getElement(".numberOfNodesToAdd").setContent(A+n.get("AddSingleNode"))}else{this.getElement(".numberOfNodesToAdd").setContent(A+n.get("AddMultiNode"))}if(A==0){this.getElement(".nodesAddedList").setContent(n.get("DisplayText"));this.getElement(".nodesAddedList").addClassName("nodes-color")}},_InsertExcludedPathInDiv:function(E,F){if(!document.querySelector(".wux-chip-cell-excludelabel")){if(document.querySelector(".nodesExcludedList")){document.querySelector(".nodesExcludedList").empty()}}if("InsertAllPathsAtOnce"==F){for(var C=0;C<E.excludedNodesLabels.length;C++){var A=new UWA.Element("div",{"class":"wux-chip-cell-container",});var B=new UWA.Element("li",{"class":"wux-chip-cell-close fonticon fonticon-wrong","font-family":"DSFontIcon"});var D=new UWA.Element("li",{"class":"wux-chip-cell-excludelabel",html:E.excludedNodesLabels[C]});D.setAttribute("occid",E.excludedNodesList[C]);A.appendChild(D);D.appendChild(B);this.getElement(".nodesExcludedList").addContent(A);this.dispatchEvent("updateExcludeDisplay");B.onclick=this._removePathFromExcludedList.bind(this)}}else{var A=new UWA.Element("div",{"class":"wux-chip-cell-container",});var B=new UWA.Element("li",{"class":"wux-chip-cell-close fonticon fonticon-wrong","font-family":"DSFontIcon"});var D=new UWA.Element("li",{"class":"wux-chip-cell-excludelabel",html:E.pathAlias});D.setAttribute("occid",E.selectedPath);A.appendChild(D);D.appendChild(B);this.getElement(".nodesExcludedList").addContent(A);this.dispatchEvent("updateExcludeDisplay");B.onclick=this._removePathFromExcludedList.bind(this)}},_removePathFromExcludedList:function(E){if(this.model.get("ExcludeNodeActivated")){var D=E.target.parentElement.getAttribute("occid").split(",");for(var B=0;B<this._allExcludedNodes.length;B++){var C=true;if(D.length==this._allExcludedNodes[B].length){for(var A=0;A<D.length&&true==C;A++){if(D[A]!=this._allExcludedNodes[B][A]){C=false}}if(C){this._allExcludedNodes.splice(B,1);this._allExcludedNodesLabels.splice(B,1);E.target.parentElement.parentElement.remove();this.dispatchEvent("updateExcludeDisplay")}}}}},_updateExcludeDisplay:function(){var A=this._allExcludedNodes.length;if(A<=1){this.getElement(".numberOfNodesToExclude").setContent(A+n.get("ExcludeSingleNode"))}else{this.getElement(".numberOfNodesToExclude").setContent(A+n.get("ExcludeMultiNode"))}if(A==0){this.getElement(".nodesExcludedList").setContent(n.get("DisplayText"));this.getElement(".nodesExcludedList").addClassName("nodes-color")}},createContextFilterUI:function(){this.getElement(".contextCriterion-edit .addContextCriterion .numberOfNodesToAdd").setContent([{tag:"span",html:n.get("AddNodesTitle")}]);this.getElement(".contextCriterion-edit .excludeContextCriterion .numberOfNodesToExclude").setContent([{tag:"span",html:n.get("ExcludeNodesTitle")}]);this.getElement(".contextCriterion-edit .excludeContextCriterion .selectablesDivToExclude .nodesExcludedList").setContent([{tag:"span",html:n.get("DisplayText")}]);this.getElement(".contextCriterion-edit .addContextCriterion .selectablesDivToAdd .nodesAddedList").setContent([{tag:"span",html:n.get("DisplayText")}]);this.getElement(".nodesAddedList").addClassName("nodes-color");this.getElement(".nodesExcludedList").addClassName("nodes-color");var A=this;this.ConfirmCxtFilterButton=new o({icon:"fonticon fonticon-check",className:"block excludeNodeButton buttonCSS",events:{onClick:function(B){A._collapseNodesDisplay();A.dispatchEvent("NGF_Criterion_Validation",{criteriaType:A.model.get("criteriaType")})}}});this.ConfirmCxtFilterButton.inject(this.getElement("#"+this._getId()+" .buttonToValidate"))},_getDOMElementToUpdateOnActivateChange:function(){var A=[];A.push(this.getElement("#"+this._getId()+" .contextCriterion-read .contextRead"));return A},_getCallbackToEditCriterion:function(){return this.editContext.bind(this)},_manageExpandCollapse:function(C){C.stopPropagation();var B=this.getElement(".context-nodesToAdd-expander");B.toggleClassName("fonticon-expand-down");B.toggleClassName("fonticon-expand-right");var A=this.getElement(".context-nodesToExclude-expander");A.toggleClassName("fonticon-expand-down");A.toggleClassName("fonticon-expand-right");if(B.hasClassName("fonticon-expand-right")){this.getElement(".nodesAddDisplay").addClassName("node-collapse");this.getElement(".nodesAddDisplay").removeClassName("node-expand");this.getElement(".nodesExcludeDisplay").addClassName("node-expand");this.getElement(".nodesExcludeDisplay").removeClassName("node-collapse")}else{if(B.hasClassName("fonticon-expand-down")){this.getElement(".nodesAddDisplay").addClassName("node-expand");this.getElement(".nodesAddDisplay").removeClassName("node-collapse");this.getElement(".nodesExcludeDisplay").addClassName("node-collapse");this.getElement(".nodesExcludeDisplay").removeClassName("node-expand")}}},_collapseNodesDisplay:function(){this.getElement(".nodesAddDisplay").addClassName("node-collapse");this.getElement(".nodesAddDisplay").removeClassName("node-expand");this.getElement(".nodesExcludeDisplay").addClassName("node-collapse");this.getElement(".nodesExcludeDisplay").removeClassName("node-expand")},onStateChange:function(E,F){var C=this.getElement(".f-context-container");var G=this.model.criterionToString();if(v.is(G,"string")||v.is(G,"array")){C.setAttribute("class","f-context-container "+F);var A=(v.is(G,"array"))?G:[G];var D="";for(var B=1;B<A.length;B++){D+="<li>"+A[B]+"</li>"}this.groupView.getElement(".context-filter").innerHTML=A;if("read"===F){this.groupView.getElement(".context-filter").removeClassName("node-collapse");this._collapseNodesDisplay()}else{this.groupView.getElement(".context-filter").addClassName("node-collapse")}}else{if(v.is(G,"object")){this.dispatchEvent("NGF_Criterion_Notification",["Error in context"])}}},isCriterionValidate:function(){return true},isThereCriteria:function(){var A=this.model.get("addedNodesList")||[];var B=this.model.get("excludedNodesList")||[];return(A.length||B.length)?true:false},_createContextCtxMenuAdd:function(){if(this._ctxMenuContextAdd){return}var C=this;var B=[{id:"activate-item-DDCtx",text:n.get("deactivatedCriteria"),fonticon:"eye-off",handler:function(E){var D=C.model.get("AddNodeActivated");C._setStateOfAddNodes(D);C.model.set("AddNodeActivated",!D);C._updateContextualmenuFromModel("Add")}},{id:"reset-item-DDCtx",text:n.get("ResetNodes"),fonticon:"reset",handler:function(){C._allAddedNodes.splice(0);C._allAddedNodesLabels.splice(0);var E=C.getElement(".numberOfNodesToAdd");E.removeClassName("f-criterion-deactivated");var D=C.getElement(".nodesAddedList").getElements(".wux-chip-cell-container");D.forEach(function(F){F.remove()});C.dispatchEvent("updateAddDisplay");C.model.set("AddNodeActivated",true)}}];var A=this.getElement(".contextDropDown-add");this._ctxMenuContextAdd=new s({target:A,items:B})},_createContextCtxMenuExclude:function(){if(this._ctxMenuContextExclude){return}var C=this;var B=[{id:"activate-item-DDCtx",text:n.get("deactivatedCriteria"),fonticon:"eye-off",handler:function(E){var D=C.model.get("ExcludeNodeActivated");C._setStateOfExcludeNodes(D);C.model.set("ExcludeNodeActivated",!D);C._updateContextualmenuFromModel("Exclude")}},{id:"reset-item-DDCtx",text:n.get("ResetNodes"),fonticon:"reset",handler:function(){C._allExcludedNodes.splice(0);C._allExcludedNodesLabels.splice(0);var E=C.getElement(".numberOfNodesToExclude");E.removeClassName("f-criterion-deactivated");var D=C.getElement(".nodesExcludedList").getElements(".wux-chip-cell-container");D.forEach(function(F){F.remove()});C.dispatchEvent("updateExcludeDisplay");C.model.set("ExcludeNodeActivated",true)}}];var A=this.getElement(".contextDropDown-exclude");this._ctxMenuContextExclude=new s({target:A,items:B})},_setStateOfNodesFromModel:function(){var A=this.model.get("AddNodeActivated");this._setStateOfAddNodes(!A);this.dispatchEvent("updateAddDisplay");A=this.model.get("ExcludeNodeActivated");this._setStateOfExcludeNodes(!A);this.dispatchEvent("updateExcludeDisplay")},_setStateOfAddNodes:function(A){var B=this.getElement(".nodesAddedList").getElements(".wux-chip-cell-container");var C=this.getElement(".numberOfNodesToAdd");B.push(C);B.forEach(function(D){if(A){D.addClassName("f-criterion-deactivated")}else{D.removeClassName("f-criterion-deactivated")}})},_setStateOfExcludeNodes:function(A){var B=this.getElement(".nodesExcludedList").getElements(".wux-chip-cell-container");var C=this.getElement(".numberOfNodesToExclude");B.push(C);B.forEach(function(D){if(A){D.addClassName("f-criterion-deactivated")}else{D.removeClassName("f-criterion-deactivated")}})},_updateContextualmenuFromModel:function(E){if(!E||"Add"===E){var C=this._ctxMenuContextAdd.getItem("activate-item-DDCtx");if(C){var A=!this.model.get("AddNodeActivated");var D=(A)?"activatedCriteria":"deactivatedCriteria";C.elements.container.getElement(".item-text").innerHTML=n.get(D);var B="fonticon fonticon-"+((A)?"eye":"eye-off");C.elements.container.getElement(".fonticon").className=B}}if(!E||"Exclude"===E){var C=this._ctxMenuContextExclude.getItem("activate-item-DDCtx");if(C){var A=!this.model.get("ExcludeNodeActivated");var D=(A)?"activatedCriteria":"deactivatedCriteria";C.elements.container.getElement(".item-text").innerHTML=n.get(D);var B="fonticon fonticon-"+((A)?"eye":"eye-off");C.elements.container.getElement(".fonticon").className=B}}},updateFromRepair:function(G){var J=this;var K=G[0];var C=[];var L=[];if(G[1].length){G[1].forEach(function(P){P.attributes.forEach(function(Q){if(Q.name=="logicalid"){L.push(Q.value)}})})}var H=false;var F=this.model._attributes.repairFilterInfo.logicalID_OfAddedPaths.length;for(var D=0;D<F;D++){var N=this.model._attributes.repairFilterInfo.logicalID_OfAddedPaths[D];var I=L.indexOf(N);if(I!=-1){var A=G[1][I].attributes[0].value;var M=G[1][I].attributes[5].value;for(var B=0;B<K.length;B++){if(K[B].indexOf(A)!=-1){if(J.IsPathPresent(this.model._attributes.addedNodesList,K[B])==false){this.model._attributes.addedNodesList.push(K[B]);this.model._attributes.addedNodesLabels.push(M);H=true}}}}}var O=this.model._attributes.repairFilterInfo.logicalID_OfExcludedPaths.length;for(var D=0;D<O;D++){var N=this.model._attributes.repairFilterInfo.logicalID_OfExcludedPaths[D];var I=L.indexOf(N);if(I!=-1){var A=G[1][I].attributes[0].value;var M=G[1][I].attributes[5].value;for(var B=0;B<K.length;B++){if(K[B].indexOf(A)!=-1){if(J.IsPathPresent(this.model._attributes.excludedNodesList,K[B])==false){this.model._attributes.excludedNodesList.push(K[B]);this.model._attributes.excludedNodesLabels.push(M);H=true}}}}}if(H){var E={modelUpdated:true,attributes:this.model._attributes};J.dispatchEvent("RepairFilter_updateRepairedPathsInUI",E)}},IsPathPresent:function(D,E){var B=false;for(var C=0;C<D.length;C++){B=true;for(var A=0;A<D[C].length;A++){if(D[C][A]!=E[A]){B=false}}if(B==true){return B}}return B}});return t});define("DS/ENONextGenFilterUX/views/FilterRepairView",["UWA/Core","DS/ENOFilterExplicitWebInWin/views/filterRepairUI","UWA/Promise","UWA/Class/View","DS/WAFData/WAFData","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/Handlebars/Handlebars","DS/ENONextGenFilterUX/models/CriterionModel","text!DS/ENONextGenFilterUX/templates/filterRepairViewTemplate.html","i18n!DS/ENOFilterExplicitWebInWin/assets/nls/ENOStrRefinementUX.json","DS/PlatformAPI/PlatformAPI","DS/UIKIT/SuperModal","DS/ENONextGenFilterUX/utils/FilterUIService"],function(n,k,i,d,l,g,b,h,c,e,m,a,j){var f=d.extend({setup:function(o){var p=this;this.filterUIComponents=o.options.filterUIComponents;this.options=o.options;this._template=b.compile(c);this.container.addEvent("click",function(q){q.stopPropagation();return false});this._parent(o)},logWebServiceOptions:function(o){this.optionsWebservice=o},fetchRepairedPathsFromWebService:function(o){var p=this;this.brokenPaths=o;this.filterUIObj=new k({brokenPaths:p.brokenPaths,url:p.optionsWebservice.url,ctx:p.optionsWebservice.ctx});this.filterUIObj.RepairFilterInWidget();return new i(function(q){p.filterUIObj.fetchData().then(function(r){q(r)})})},render:function(){var o=this;o.DisplayFilterPanel(false);if(UWA.is(o.brokenPaths,"object")){this.container.setContent(this._template({stateClass:"Read",}));o.filterUIObj.render().inject(o.getElement(".filterRepairView-mainContainer"));o.listenTo(o.filterUIObj,"NGF_RepairFilter",function(p){this.repairFilter(p)});o.listenTo(o.filterUIObj,"NGF_CancelRepairFilter",function(p){if(p.listOfList=="CancelRepair"){o.DisplayFilterPanel(true)}o.dispatchEvent("NGF_CancelRepairFilter",p)});return this}return this},logBrokenFiltersInfo:function(o){this.toFeedUI=o},_checkForBrokenLinksInFilter:function(s){var q=this;if(s.filterUIComponents){this.filterUIComponents=s.filterUIComponents}else{this.filterUIComponents=s.filterData[s.filterNames[0]].filterUIComponents}var p=[];var r=[];var o=[];return new i(function(v,u){for(var t=1;t<q.filterUIComponents.length;t++){if(q.filterUIComponents[t].toFeedUI[0].criteriaType=="context"){r.push(q.filterUIComponents[t].toFeedUI[0]);o.push(t)}}if(r.length==0){v("NoContextFilter");return}q._checkForBrokenLinksInEachGroupView(r).then(function(R){if(R!="PathsOK"){var K=[];R.results.forEach(function(V){K.push(V.attributes[0].value)});var C=[];var G=[];var E=[];var y=false;for(var Q=0;Q<r.length;Q++){var U=[];var M=[];if(r[Q].addedNodesList){var H=r[Q].addedNodesList;for(var O=0;O<H.length;O++){var J=H[O];y=false;var P="";for(var N=0;N<J.length;N++){var D=J[N];var B=K.indexOf(D);if(B==-1){y=true}else{R.results[B].attributes.forEach(function(V){if(V.name=="logicalid"){P=V.value}})}}if(y){G.push(J);U.push(P)}}}if(r[Q].excludedNodesList){var w=r[Q].excludedNodesList;for(var O=0;O<w.length;O++){var J=w[O];y=false;var P="";for(var N=0;N<J.length;N++){var D=J[N];var B=K.indexOf(D);if(B==-1){y=true}else{R.results[B].attributes.forEach(function(V){if(V.name=="logicalid"){P=V.value}})}}if(y){E.push(J);M.push(P)}}}if(G.length){G.forEach(function(V){C.push(V)})}if(E.length){E.forEach(function(V){C.push(V)})}var x=[];var F=[];var T=[];var A=[];for(var O=0;O<C.length;O++){if(r[Q].addedNodesList){var L=r[Q].addedNodesList.indexOf(C[O]);if(L!=-1){T.push(r[Q].addedNodesList.splice(L,1));A.push(r[Q].addedNodesLabels.splice(L,1))}}if(r[Q].excludedNodesList){var I=r[Q].excludedNodesList.indexOf(C[O]);if(I!=-1){x.push(r[Q].excludedNodesList.splice(I,1));F.push(r[Q].excludedNodesLabels.splice(I,1))}}}var z={brokenAddedNodes:T,brokenAddedLabels:A,brokenExcludedNodes:x,brokenExcludedLabels:F,allPathsInfo:R,logicalID_OfAddedPaths:U,logicalID_OfExcludedPaths:M};if(z){r[Q].repairFilterInfo=z}}var S={pathsToFeedUI:r,indexOfGroupViewToRepair:o};v(S)}else{v(R)}})})},_checkForBrokenLinksInEachGroupView:function(o){var p=this;var q=o;return new i(function(v){var u=[];for(var t=0;t<o.length;t++){if(o[t].addedNodesList){for(var s=0;s<o[t].addedNodesList.length;s++){for(var r=0;r<o[t].addedNodesList[s].length;r++){if(u.indexOf(o[t].addedNodesList[s][r])==-1){u.push(o[t].addedNodesList[s][r])}}}}if(o[t].excludedNodesList){for(var s=0;s<o[t].excludedNodesList.length;s++){for(var r=0;r<o[t].excludedNodesList[s].length;r++){if(u.indexOf(o[t].excludedNodesList[s][r])==-1){u.push(o[t].excludedNodesList[s][r])}}}}}if(u.length){j._executeFetch_LogicalID(u).then(function(w){if(w.results.length!=u.length){v(w)}else{v("PathsOK")}})}else{v("PathsOK")}})},_createJSONForRepairWebservice:function(){var t=this;var o=[];for(var F=0;F<t.toFeedUI.length;F++){var A=t.toFeedUI[F].repairFilterInfo.allPathsInfo.results;var x=t.toFeedUI[F].repairFilterInfo.brokenAddedNodes;if(x.length>0){for(var E=0;E<x.length;E++){var z=x[E][0];var B=[];for(var D=0;D<z.length;D++){var H=z[D];var w=false;var p={};for(var C=0;C<A.length;C++){var s="";var I="";var v="";var K="";var r="";var J="";var u="";if(H==(A[C].attributes[0].value)){var y=A[C].attributes;y.forEach(function(L){if(L.value=="types/PLMCoreReference"){s="PLMCoreReference"}else{if(L.value=="reltypes/PLMCoreInstance"){s="PLMCoreInstance"}else{if(L.value=="reltypes/PLMCoreRepInstance"){s="PLMCoreRepInstance"}else{if(L.value=="types/3DShape"){s="PLMCoreRepReference"}}}}if(L.name=="resourceid"){v=L.value}if(L.name=="logicalid"){I=L.value}if(L.name=="ds6w:label"){K=L.value}if(L.name=="type_icon_url"){r=L.value}if(L.name=="preview_url"){u=L.value}if(L.name=="type"){J=L.value}});p={coretype:s,logicalid:I,name:K,physicalid:v,type_icon_url:r,preview_url:u,trueType:J};w=true}}if(!w){p={coretype:"PLMCoreInstance",logicalid:H,name:"",physicalid:H,}}B.push(p)}o.push(B)}}var q=t.toFeedUI[F].repairFilterInfo.brokenExcludedNodes;if(q.length>0){for(var E=0;E<q.length;E++){var z=q[E][0];var B=[];for(var D=0;D<z.length;D++){var H=z[D];var w=false;var p={};for(var C=0;C<A.length;C++){var s="";var I="";var v="";var K="";var r="";var J="";var u="";if(H==(A[C].attributes[0].value)){var y=A[C].attributes;y.forEach(function(L){if(L.value=="types/PLMCoreReference"){s="PLMCoreReference"}else{if(L.value=="reltypes/PLMCoreInstance"){s="PLMCoreInstance"}else{if(L.value=="reltypes/PLMCoreRepInstance"){s="PLMCoreRepInstance"}else{if(L.value=="types/3DShape"){s="PLMCoreRepReference"}}}}if(L.name=="resourceid"){v=L.value}if(L.name=="logicalid"){I=L.value}if(L.name=="ds6w:label"){K=L.value}if(L.name=="type_icon_url"){r=L.value}if(L.name=="preview_url"){u=L.value}if(L.name=="type"){J=L.value}});p={coretype:s,logicalid:I,name:K,physicalid:v,type_icon_url:r,preview_url:u,trueType:J};w=true}}if(!w){p={coretype:"PLMCoreInstance",logicalid:H,name:"",physicalid:H}}B.push(p)}o.push(B)}}}var G={paths:o};return G},repairFilter:function(q){var p=this;if(q.listOfList=="CancelRepair"){p.DisplayFilterPanel(true)}else{p.DisplayFilterPanel(true);p.removeInvalidPaths(q.listOfList);if(q.listOfList.length>0){var o=[];q.listOfList.forEach(function(r){r.forEach(function(s){if(o.indexOf(s)==-1){o.push(s)}})});if(!(o.length==1&&o[0]=="null")){j._executeFetch_LogicalID(o,q.listOfList).then(function(u){var r=u.results;var s=[];s.push(q.listOfList);s.push(r);var t={data:s};p.dispatchEvent("RepairFilter_UpdateContextUI",t)})}}}},removeInvalidPaths:function(o){for(var q=0;q<o.length;q++){var p=o[q].indexOf("null");if(p!=-1||o[q].length==0){o.splice(q,1);q--}}},IsPathPresent:function(r,s){var p=false;for(var q=0;q<r.length;q++){p=true;for(var o=0;o<r[q].length;o++){if(r[q][o]!=s[o]){p=false}}if(p==true){return p}}return p},DisplayFilterPanel:function(t){if(document.querySelector(".f-globalFilter-container")!=null){var p=document.querySelector(".f-globalFilter-container");var s=p.querySelector(".globalFilterView-container");var o=p.querySelector(".globalEdit-container");var q=p.querySelector(".ActiveCriteria-container");var r=p.querySelector(".filter-Commands");if(t){n.extendElement(s).show();n.extendElement(o).hide();n.extendElement(q).show()}else{n.extendElement(r).show();n.extendElement(s).hide();n.extendElement(o).show();n.extendElement(q).hide()}}}});return f});define("DS/ENONextGenFilterUX/views/CriteriaVolumeView",["DS/ENONextGenFilterUX/views/CriteriaAbstractView","UWA/Core","UWA/Class/View","UWA/Class/Model","DS/WAFData/WAFData","DS/UIKIT/DropdownMenu","DS/UIKIT/IconDropdown","DS/ENONextGenFilterUX/utils/FilterUIService","DS/Handlebars/Handlebars","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/ENONextGenFilterUX/utils/EditToReadManager","DS/Controls/ComboBox","DS/Controls/Button","DS/UIKIT/Mask","DS/Controls/Loader","css!DS/ENONextGenFilterUX/ENONextGenFilterUX.css","DS/Controls/TooltipModel","DS/ENONextGenFilterUX/views/VolumeCombinationView","text!DS/ENONextGenFilterUX/templates/volumeViewTemplate.html","DS/PlatformAPI/PlatformAPI"],function(f,q,j,n,a,p,i,r,g,l,e,m,s,o,v,u,k,h,t,d,b){var c=f.extend({className:"volumeCriterion",tagName:"li",domEvents:{"click .volumeCriterion-read .volumeRead":"_checkBeforeEdit","click .volumeCriterion-read .volumeRead-multi-attr":"_checkBeforeEdit"},setup:function(w){this._parent(w);this._appId=w.appId;this._widgetId=w.widgetId;this._filterSpecId=w.filterSpecId;this._isVolumeAvailable=w.volumeAvailable;this._template=g.compile(d);this.listenTo(this.model,"onChange:state",this.onStateChange.bind(this));this._sendEvent=w.sendEvent;this.SaveAttrBeforeEdit={}},render:function(){this.container.setContent(this._template({stateClass:this.model.get("state")}));this._createCriterionCtxMenu(this.getElement(".criterionDropDown"),[]);this.attrEditInputs=this.getElement(".attributeCriterion-edit .attr-edit-inputs");this.attrEditInputsAttr=this.getElement(".attributeCriterion-edit .attr-edit-inputs-allAttributes");this.attrEditActions=this.getElement(".attributeCriterion-edit .attr-edit-actions");this.attrEditInputsAttr.hide();this.addVolumeBtn=this._createAddVolumeButton(this.attrEditActions);this.addVolumeGroupBtn=this._createAddVolumeGroupButton(this.attrEditActions);this._validateButton=this._createValidateButton();this._createVolumeCombination();this.listenTo(this._combinationView,"NGF_RemoveCriterion",this.destroy.bind(this));return this},destroy:function(){r.resetSelectedVolumeOf3D(this._appId,this._widgetId);if(this._combinationView){this._combinationView.destroy()}this.dispatchEvent("NGF_RemoveCriterion",{idxView:this.cid,isVolume:true});this.stopListening();this.model=null;this._parent();this.container=null},onStateChange:function(w,C){var y=this.getElement(".f-volume-container");y.setAttribute("class","f-volume-container "+C);if("read"===C){var z="";var x="";var D=this._isThereVolumeActivated(this._combinationView.model);if(D){var E=this.model.criterionToString();z=E.shift();x=this._getVolumeHTML(E)}else{z=l.get("noVolumeActivated")}var A=[];A.push({tag:"img",src:e.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_VolumeFilter.png")});A.push({tag:"span",html:z});var B=this.getElement(".volumeRead");B.setContent(A);this.getElement(".volumeRead-multi-attr").setContent([{html:x}]);if(!D){this._switchCriterionState()}}else{this.dispatchEvent("NGF_Criterion_SwitchedToEdit")}},_isThereVolumeActivated:function(w){var A=0;var C=w.get("allVolumes")||[];var x=C.length;for(var z=0;z<x&&!A;z++){var B=C[z];var y=B.get("allVolumes");if(!y){if("1"===B.get("isActivated")){A=1}}else{A=this._isThereVolumeActivated(B)}}return A},_getVolumeHTML:function(C){var y="";var E=[];E.box=e.getWebappsAssetUrl("ENONextGenFilterUX","icons/16/Box.png");E.sphere=e.getWebappsAssetUrl("ENONextGenFilterUX","icons/16/Sphere.png");E.proximity=e.getWebappsAssetUrl("ENONextGenFilterUX","icons/16/Proximity.png");for(var x=0;x<C.length;x++){if(q.is(C[x],"array")){var z=C[x];y+="<li>"+z[0];y+='<ul class="volumeRead-multi-attr"><div>';z.shift();var A=this._getVolumeHTML(z);y+=A;y+="</div></ul></li>"}else{var w=this._getInfosVolumeFromName(C[x],this._combinationView.model);var B=(w.type)?'<img src="'+E[w.type]+'">':"";var D=("0"===w.isActivated)?' class="f-criterion-deactivated"':"";y+="<li"+D+">"+B+C[x]+"</li>"}}return y},_getInfosVolumeFromName:function(C,D){var A={};var w=D.get("allVolumes")||[];var E=w.length;for(var z=0;z<E&&!A.type;z++){var x=w[z];var B=x.get("allVolumes");if(!B){if(x.get("displayName")===C){var y=x.get("parameters");A={isActivated:x.get("isActivated"),type:y.type}}}else{A=this._getInfosVolumeFromName(C,x)}}return A},_getDOMElementToUpdateOnActivateChange:function(){var w=[];w.push(this.getElement("#"+this._getId()+" .volumeCriterion-read .volumeRead"));w.push(this.getElement("#"+this._getId()+" .volumeCriterion-read .volumeRead-multi-attr"));return w},_getCallbackToEditCriterion:function(){var w=this._editVolume.bind(this);return w},_editVolume:function(){this.SaveAttrBeforeEdit.queryCV=this.model.toCVQuery(true);this.model.set("state","edit");this._combinationView.model.set("state","edit")},_isCriterionModified:function(){var w=false;if(this.model){var x=this.model.toCVQuery(true);w=(this.SaveAttrBeforeEdit.queryCV===x)?false:true}return w},isCriterionValidate:function(){var w=("read"===this.model.get("state"))?true:false;w=true;this._combinationView.removeEmptyVolume();r.resetSelectedVolumeOf3D(this._appId,this._widgetId);if(!r.isModelActivated(this.model)&&true===this._isCriterionModified()){this._switchCriterionState()}return w},viewFromMdl:function(x){this._combinationView.viewFromMdl(x);var w=x.isActivated;if("0"===w){this._switchCriterionState()}},_createVolumeCombination:function(){if(this._combinationView){this._combinationView.destroy();this.model.set("allVolumes",[])}var w=new n();w.set("isActivated","1");w.set("state","edit");var x=[];x.push(w);this.model.set("allVolumes",x);this._combinationView=new t({appId:this._appId,widgetId:this._widgetId,filterId:this._filterId,model:w,attrEditInputs:this.attrEditInputs,attrEditInputsAttr:this.attrEditInputsAttr,sendEvent:this._sendEvent,filterSpecId:this._filterSpecId,volumeAvailable:this._isVolumeAvailable});this._combinationView.render().inject(this.attrEditInputs);this.listenTo(this._combinationView,"NGF_SwitchDisplayContext",this._onSwitchDisplayContext.bind(this));this.listenTo(this._combinationView,"NGF_DisplayAddActions",this._onDisplayAddActions.bind(this));this.listenTo(this._combinationView,"NGF_SwitchToEdit",this._checkBeforeEdit.bind(this));this._combinationView._sendEvent=1;this._sendEvent=1},_onSwitchDisplayContext:function(w){if(1===w.context){w.combination.inject(this.attrEditInputs);w.view.inject(this.attrEditInputsAttr);this.attrEditInputsAttr.show()}else{w.view.inject(this.attrEditInputs);this.attrEditInputsAttr.hide()}var x=this.getElement(".attribute-edit-add-btn2");x.inject(this.attrEditActions);x=this.getElement(".attribute-edit-addGroup-btn2");x.inject(this.attrEditActions);x=this.getElement(".attributeCriterion-edit-validate");x.inject(this.attrEditActions)},_onDisplayAddActions:function(y){var x=this.attrEditActions.getElement(".attribute-edit-add-btn2");var w=this.attrEditActions.getElement(".attribute-edit-addGroup-btn2");if(x&&w){if(y.display){x.show();w.show()}else{}}},_createAddVolumeButton:function(w){if(this.addVolumeBtn){return this.addVolumeBtn}var y=new o(r.getAttributeButtonStyle("plus"));y.inject(w);y.tooltipInfos=new h({shortHelp:l.get("AddVolume"),mouseRelativePosition:false});y.getContent().addClassName("attribute-edit-button-style attribute-edit-add-btn2");var x=this;y.addEventListener("click",function(z){x._cleanSelected();x._combinationView.createVolume()});return y},_createAddVolumeGroupButton:function(w){if(this.addVolumeGroupBtn){return this.addVolumeGroupBtn}var y=new o(r.getAttributeButtonStyle("group-add"));y.inject(w);y.tooltipInfos=new h({shortHelp:l.get("AddVolumeGroup"),mouseRelativePosition:false});y.getContent().addClassName("attribute-edit-button-style attribute-edit-addGroup-btn2");var x=this;y.addEventListener("click",function(z){x._cleanSelected();x._combinationView.createVolumeGroup()});return y},_cleanSelected:function(){var w=this.getElement(".attribute-edit-group-selected");if(w){w.removeClassName("attribute-edit-group-selected")}},_createValidateButton:function(){var x=new o(r.getAttributeValidateButtonStyle());x.inject(this.attrEditActions);x.tooltipInfos=new h({shortHelp:l.get("ValidateCriteria"),mouseRelativePosition:false});x.getContent().addClassName("attribute-edit-button-style  attributeCriterion-edit-validate"+((this.sequenceMode)?"":" colorized"));var w=this;x.addEventListener("buttonclick",function(){var y=w.isCriterionValidate();if(y&&w.model){w.SaveAttrBeforeEdit={};w.dispatchEvent("NGF_Criterion_Validation",{criteriaType:w.model.get("criteriaType")})}});return x},isThereCriteria:function(){return(this._combinationView)?true:false}});return c});define("DS/ENONextGenFilterUX/views/AttributeCombinationView",["UWA/Core","UWA/Event","UWA/Class/View","UWA/Class/Model","DS/ENONextGenFilterUX/views/AttributeView","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/TooltipModel","DS/ENONextGenFilterUX/utils/FilterUIService"],function(h,e,b,j,a,c,k,i,g,f){var d=b.extend({domEvents:{},tagName:"div",className:"attribute-edit-group",setup:function(l){this._attrSetId=l.attrSetId||0;this._combinationId=this._attrSetId;this._deepGroup=l.deepGroup||0;this._displayMode=l.displayMode||"light";this._selectedType=l.selectedType;this._selectedSubType=l.selectedSubType;this._attributes=l.attributesUsed;this._initCombination=l.initCombination||0;this._attrEditInputs=l.attrEditInputs;this._idAttr=0;this._listOfAttributes=[]},render:function(){var l="combinationAttribute_"+this._combinationId;this.container.setAttribute("id",l);var m=this.getContent();this._divCombination=h.createElement("div",{"class":"attribute-edit-group-Combination"+((f.TOUCH_MODE)?"":" filter-no-touch-mode")});this._divCombination.inject(this._attrEditInputs||m);var n="withAttribute";this._withLabel=this._createCombinationLabel(n,"with");this._withLabel.inject(this._divCombination);this._combinationCombo=this._createCombinationCombo(this._initCombination);this._combinationCombo.inject(this._divCombination);n="FollowingCombination";this._followingLabel=this._createCombinationLabel(n,"following");this._followingLabel.inject(this._divCombination);this._removeBtn=this._createRemoveGroupButton();this._removeBtn.inject(this._divCombination);this._setCombinationDisplayMode(this._displayMode||"light");this.createAttribute();return this},destroy:function(){this.cleanAttributes();this.stopListening();this.model=null;this._parent();this.container=null},_setCombinationDisplayMode:function(l){switch(l){case"none":this._divCombination.hide();break;case"light":this._divCombination.show();this._withLabel.show();this._combinationCombo.hide();this._followingLabel.hide();this._removeBtn.hide();break;case"middle":this._divCombination.show();this._withLabel.show();this._combinationCombo.show();this._followingLabel.show();this._removeBtn.hide();break;case"full":this._divCombination.show();this._withLabel.show();this._combinationCombo.show();this._followingLabel.show();this._removeBtn.show();break;default:}},createAttribute:function(){this._onAddAttribute()},createAttributeGroup:function(){this._onAddAttributeGroup()},_createCombinationLabel:function(l,n){var m=h.createElement("label",{"class":"innerfiltertypecombo",text:c.get(l),id:"combination-"+n+"_"+this._combinationId});return m},_createCombinationCombo:function(o){var l=[{labelItem:c.get("AllCombination"),valueItem:"all"},{labelItem:c.get("AnyCombination"),valueItem:"any"}];var n=new k({touchMode:f.TOUCH_MODE,elementsList:l,enableSearchFlag:false,domId:"combination-combo_"+this._combinationId});var p=this;n.addEventListener("change",function m(r){var q=r.dsModel.currentValue;p.model.set("combination",q);p._initCombination=r.dsModel.selectedIndex});this.model.set("combination",l[o].valueItem);n.selectedIndex=o;return n},_createRemoveGroupButton:function(){var n=new i(f.getAttributeButtonStyle("close"));n.tooltipInfos=new g({shortHelp:c.get("RemoveAttributeGroup"),mouseRelativePosition:false});var m="attribute-edit-button-style"+((f.TOUCH_MODE)?"":" filter-no-touch-mode");n.getContent().addClassName(m+" attribute-edit-group-remove-btn");var l=this;n.addEventListener("click",function(p){var o=l.getContent().getAttribute("id");l.dispatchEvent("NGF_Remove_AttributeGroup",{attrId:o})});return n},_createAttribute:function(){var q=this.getContent();if(0===this._deepGroup){this._switchDisplayToMultiAttribute("attribute")}var p=new j();var l=this.model.get("allAttributes")||[];l.push(p);this.model.set("allAttributes",l);var m=new a({model:p,attrSetId:this._attrSetId,idAttr:this._idAttr,selectedType:this._selectedType,selectedExtension:this._selectedSubType,displayRemoveButton:(this._attrSetId||this._listOfAttributes.length)?1:0,disableAddGroupButton:(f.MAX_DEEP_ATTRIBUTE_GROUP===this._deepGroup)?1:0,xAttributes:this._attributes});this._idAttr+=1;m.render().inject(q);m.setFocus();this._showAddButtons(false);this._listOfAttributes.push(m);this._highlightAttributeGroup();var o=this._listOfAttributes.length;if(0!==this._deepGroup){if(2<=o){for(var n=o-2;n>=0;n--){if(!this._isGroup(this._listOfAttributes[n])){this._listOfAttributes[n].showAddButtons(false);break}}}this._listOfAttributes[o-1].showAddButtons(true)}else{}this.listenTo(m,"NGF_AddAttribute",this._onAddAttribute.bind(this));this.listenTo(m,"NGF_AddAttributeGroup",this._onAddAttributeGroup.bind(this));this.listenTo(m,"NGF_RemoveAttribute",this._onRemoveAttribute.bind(this));this.listenTo(m,"NGF_AttributeSelected",this._onSelectedAttribute.bind(this))},_onAddAttribute:function(){this._createAttribute()},_highlightAttributeGroup:function(){var m=document.body.getElement(".f-attribute-container.edit");if(m){var l=m.getElement(".attribute-edit-group-selected");if(l){l.removeClassName("attribute-edit-group-selected")}}if(0!==this._deepGroup){this.getContent().addClassName("attribute-edit-group-selected")}},_onAddAttributeGroup:function(){var o=this.getContent();if(0===this._deepGroup){this._switchDisplayToMultiAttribute("group")}var m=new j();var l=this.model.get("allAttributes")||[];l.push(m);this.model.set("allAttributes",l);this._attrSetId+=1;var n=new d({model:m,attrSetId:this._attrSetId,selectedType:this._selectedType,selectedExtension:this._selectedSubType,attributesUsed:this._attributes,initCombination:(this._initCombination)?0:1,displayMode:"full",deepGroup:this._deepGroup+1});n.render().inject(o);n._highlightAttributeGroup();this._showAddButtons(true);this.listenTo(n,"NGF_Remove_AttributeGroup",this._onRemoveAttribute.bind(this));var p=n._listOfAttributes.length;if(p){n._listOfAttributes[p-1].setFocus()}this._listOfAttributes.push(n);if(0===this._deepGroup){if(2===this._listOfAttributes.length&&!this._isGroup(this._listOfAttributes[0])&&this._listOfAttributes[0].isAttrEmpty()){this._onRemoveAttribute({attrId:this._listOfAttributes[0].getContent().id});this._setCombinationDisplayMode("none")}}},_showAddButtons:function(l){if(0===this._deepGroup){this.dispatchEvent("NGF_DisplayAddActions",{display:l})}},_onRemoveAttribute:function(p){var o=p.attrId;for(var n=0;n<this._listOfAttributes.length;n++){if(o===this._listOfAttributes[n].container.id){this._removeAttribute(n);if(1>=this._listOfAttributes.length){if(0===this._deepGroup){this._switchDisplayToSingleAttribute()}}if(0===this._listOfAttributes.length){if(0!==this._deepGroup){this.dispatchEvent("NGF_Remove_AttributeGroup",{attrId:this.getContent().id})}else{this._idAttr=0;this._setCombinationDisplayMode("none")}}break}}var m=this._listOfAttributes.length;if(1<=m){var l=this._listOfAttributes[m-1];if(!this._isGroup(l)&&0!==this._deepGroup){l.showAddButtons(true);this._highlightAttributeGroup()}else{this._showAddButtons(false)}}},_removeAttribute:function(n){var m=n||0;var p=n+1||this._listOfAttributes.length;for(var o=p-1;o>=m;o--){this._listOfAttributes[o].destroy()}this._listOfAttributes.splice(m,(p-m));var l=this.model.get("allAttributes");if(undefined!==l){l.splice(m,(p-m))}this.model.set("allAttributes",l)},_onSelectedAttribute:function(l){},_switchDisplayToMultiAttribute:function(l){if(0===this._listOfAttributes.length){if("attribute"===l){this._setCombinationDisplayMode("light")}else{if("group"===l){this._divCombination.addClassName("attribute-edit-group");this.getContent().removeClassName("attribute-edit-group");this._setCombinationDisplayMode("none");this.dispatchEvent("NGF_SwitchDisplayContext",{context:1,combination:this._divCombination,view:this})}}}else{if(1===this._listOfAttributes.length&&!this._isGroup(this._listOfAttributes[0])){this._divCombination.addClassName("attribute-edit-group");this.getContent().removeClassName("attribute-edit-group");this._listOfAttributes[0].showRemoveButton(true);this._listOfAttributes[0].showAddButtons(false);this._setCombinationDisplayMode("middle");this.dispatchEvent("NGF_SwitchDisplayContext",{context:1,combination:this._divCombination,view:this})}else{this._setCombinationDisplayMode("middle")}}},_switchDisplayToSingleAttribute:function(){if(0===this._listOfAttributes.length){this._divCombination.removeClassName("attribute-edit-group");this.getContent().addClassName("attribute-edit-group");this.dispatchEvent("NGF_SwitchDisplayContext",{context:0,view:this})}else{if(1===this._listOfAttributes.length){if(this._isGroup(this._listOfAttributes[0])){this._setCombinationDisplayMode("none")}else{this._divCombination.removeClassName("attribute-edit-group");this.getContent().addClassName("attribute-edit-group");var l=this._listOfAttributes[0];l.showRemoveButton(true);l.showAddButtons(false);this._setCombinationDisplayMode("light");this.dispatchEvent("NGF_SwitchDisplayContext",{context:0,view:this})}}}},isAttrValid:function(){var o=[];var q=this._listOfAttributes.length;for(var p=0;p<q&&!Object.keys(o).length;p++){var l=this._listOfAttributes[p];if(!this._isGroup(l)){var n=l.isAttrValid();if(!n.isValid){var m=n.errorKey;if(undefined===o[m]){o[m]=""}o[m]+="<br>   "+n.errorMsg}}else{o=l.isAttrValid()}}return o},_isGroup:function(l){var m=(l._listOfAttributes)?true:false;return m},removeEmptyAttribute:function(){this._removeEmptyAttribute()},_removeEmptyAttribute:function(){var n=this._listOfAttributes.length;for(var m=n-1;m>=0;m--){var l=this._listOfAttributes[m];if(!this._isGroup(l)){if(l.isAttrEmpty()){this._onRemoveAttribute({attrId:this._listOfAttributes[m].getContent().id})}}else{l._removeEmptyAttribute()}}},updateMRUOfAttribute:function(){var n=this._listOfAttributes.length;for(var m=0;m<n;m++){var l=this._listOfAttributes[m];if(!this._isGroup(l)){l.updateMRUOfAttrCombo()}else{l.updateMRUOfAttribute()}}},cleanAttributes:function(){this._divCombination.destroy();this._removeAttribute()},viewFromMdl:function(m){var n=m.allAttributes;if(1<n.length||(1===n.length&&undefined===n[0].allAttributes)){var l={};l.allAttributes=n;l.combination="all";this._buildAttributeFromModel(l)}else{this._buildAttributeFromModel(n[0])}},_buildAttributeFromModel:function(p){var n=p.allAttributes;this._combinationCombo.currentValue=p.combination;if(undefined!==n){var r=n.length;for(var q=0;q<r;q++){var m=n[q];var o=m.allAttributes;if(undefined===o){if(this._listOfAttributes.length<q+1){this._createAttribute()}var l=this._listOfAttributes[q];l.attrViewFromMdl(n[q])}else{if(this._listOfAttributes.length<q+1){this._onAddAttributeGroup()}var l=this._listOfAttributes[q];l._buildAttributeFromModel(n[q])}}}},saveBeforeEdit:function(){return this._saveBeforeEdit(this)},_saveBeforeEdit:function(m){var r=[];var q=m._listOfAttributes.length;for(var p=0;p<q;p++){var l=m._listOfAttributes[p];if(!this._isGroup(l)){r.push({combination:this.model.get("combination"),attributes:l.getParams()})}else{var o=this.model.get("combination");var n=this._saveBeforeEdit(l);r.push({combination:o,attributes:n})}}return r},restoreBeforeEdit:function(l){this._restoreBeforeEdit(this,l)},_restoreBeforeEdit:function(m,n){m._removeAttribute();if(undefined===n){m.createAttribute()}else{for(var p=0;p<n.length;p++){if(h.is(n[p].attributes,"array")){m._onAddAttributeGroup()}else{m.createAttribute()}}var o=m._listOfAttributes.length;for(var p=0;p<o;p++){var l=m._listOfAttributes[p];if(!this._isGroup(l)){this.model.set("combination",n[p].combination);l.setParams(n[p].attributes)}else{this.model.set("combination",n[p].combination);this._restoreBeforeEdit(l,n[p].attributes)}}}},updateAttributes:function(l){this._attributes=l;this._updateAttributes(l)},_updateAttributes:function(o){var n=this._listOfAttributes.length;for(var m=n-1;m>=0;m--){var l=this._listOfAttributes[m];if(!this._isGroup(l)){l.reBuildAttributesInfos(o)}else{l.updateAttributes(o)}}},});return d});define("DS/ENONextGenFilterUX/views/CriteriaAttributeView",["DS/ENONextGenFilterUX/views/CriteriaAbstractView","UWA/Core","UWA/Class/View","UWA/Class/Model","DS/WAFData/WAFData","DS/UIKIT/DropdownMenu","DS/UIKIT/IconDropdown","DS/ENONextGenFilterUX/utils/FilterUIService","DS/Handlebars/Handlebars","text!DS/ENONextGenFilterUX/templates/attributeViewTemplate.html","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/WebappsUtils/WebappsUtils","DS/ENONextGenFilterUX/utils/EditToReadManager","DS/Controls/ComboBox","DS/Controls/Button","DS/UIKIT/Mask","DS/Controls/Loader","css!DS/ENONextGenFilterUX/ENONextGenFilterUX.css","DS/ENONextGenFilterUX/views/AttributeCombinationView","DS/Controls/TooltipModel","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/ENOFilterBIUX/FBIServices"],function(c,r,h,m,a,o,g,s,d,f,j,b,l,u,n,w,v,i,t,e,q,k){var p=c.extend({domEvents:{"click .attributeCriterion-read .attrRead":"_checkBeforeEdit","click .attributeCriterion-read .attrRead-multi-attr":"_checkBeforeEdit"},className:"attributeCriterion",tagName:"li",setup:function(x){this._parent(x);this.types=x.types;this._synthesisInfos=x.synthesisInfos;this.customizeCtxMenu=x.customizeCtxMenu;this.sequenceMode=x.sequenceMode;this.keepValue=x.keepValue||1;this._template=d.compile(f);this.listenTo(this.model,"onChange:state",this.onStateChange.bind(this));this.listenTo(this.model,"onChange:Keep",this.onKeepChange.bind(this));this.listenTo(this.model,"onChange:type",this.onTypeChange.bind(this));this.container.addEvent("click",function(y){y.stopPropagation();return false});this._selectedType="";this._selectedSubType="";this._needToQueryServer=true;this.isCancelEditCrteriaActivated=false;if(x.listAttrFromType){this.subTypes=x.fromCriterionMdl.subTypes;this.attributesOfTypes=x.listAttrFromType;this.attributes=this.attributesOfTypes;this._needToQueryServer=false;this._keepRemoveCombo=x.fromCriterionMdl.Keep;this._selectedType=x.fromCriterionMdl.type;this._selectedSubType=x.fromCriterionMdl.extension;if(undefined!==x.listAttrFromSubType){this.attributes=this.attributesOfTypes.concat(x.listAttrFromSubType)}this._updateAttributesWithSynthesis(this.attributes,this._synthesisInfos)}this.SaveAttrBeforeEdit={}},render:function(){var x="filter-no-touch-mode";this.container.setContent(this._template({stateClass:this.model.get("state"),titleClass:j.get("titleAttributeUX"),touchMode:(s.TOUCH_MODE)?"":x}));this.attrEditInputs=this.getElement(".attributeCriterion-edit .attr-edit-inputs");this.attrEditInputsAttr=this.getElement(".attributeCriterion-edit .attr-edit-inputs-allAttributes");this.attrEditActions=this.getElement(".attributeCriterion-edit .attr-edit-actions");if(s.TOUCH_MODE){this.attrEditActions.removeClassName(x)}else{this.attrEditActions.addClassName(x)}this.attrEditInputsAttr.hide();this._createHeaderCtxMenu();this._createHeaderIcon();this._refeshSynthesisBtn=this._createRefeshSynthesisButton(this.attrEditActions);this.addAttributeBtn=this._createAddAttributeButton(this.attrEditActions);this.addAttributeGroupBtn=this._createAddAttributeGroupButton(this.attrEditActions);this._addAttributeSequenceBtn=this._createAddAttrSequenceButton(this.attrEditActions);this._validateButton=this._createValidateButton();this._setEnableButtons(false);if(this.sequenceMode){this._refeshSynthesisBtn.hide();this._addAttributeSequenceBtn.hide()}this.createKeepRemoveDropDown(this.keepValue);this.setSequenceMode(this.sequenceMode);return this},onTypeChange:function(x,y){if(this._validateButton&&y){this._validateButton.disabled=false}},_createValidateButton:function(){var z=new n(s.getAttributeValidateButtonStyle());z.inject(this.attrEditActions);z.tooltipInfos=new e({shortHelp:j.get("ValidateCriteria"),mouseRelativePosition:false});var y="attribute-edit-button-style"+((s.TOUCH_MODE)?"":" filter-no-touch-mode");z.getContent().addClassName(y+" attributeCriterion-edit-validate"+((this.sequenceMode)?"":" colorized"));var x=this;z.addEventListener("buttonclick",function(){var A=x.isCriterionValidate();if(A){x.SaveAttrBeforeEdit={};x.dispatchEvent("NGF_Criterion_Validation",{criteriaType:x.model.get("criteriaType")})}});return z},_createAddAttrSequenceButton:function(x){var A=new n(s.getAttributeButtonStyle("list-ordered"));A.inject(x);A.tooltipInfos=new e({shortHelp:j.get("AddAttributeSequence"),mouseRelativePosition:false});var z="attribute-edit-button-style"+((s.TOUCH_MODE)?"":" filter-no-touch-mode");A.getContent().addClassName(z+" attributeCriterion-edit-addSequence-btn");var y=this;A.addEventListener("buttonclick",function(B){y.dispatchEvent("NGF_SwitchCriterionToSequence",{type:y.model.get("criteriaType"),idxView:y.cid,attributeKeep:y.model.get("Keep")})});return A},isCriterionValid:function(){var A=("read"===this.model.get("state"))?true:false;if(!A){var x=this._attrCombinationView.isAttrValid();var B=Object.keys(x);A=(!B.length)?true:false;if(!A){for(var z=0;z<B.length;z++){var y=B[z];this.dispatchEvent("NGF_Criterion_Notification",[{level:"error",message:j.get(y)+x[y]}])}}}return A},isCriterionValidate:function(){var y=this;var x=("read"===this.model.get("state"))?true:false;if(!x){x=this.isCriterionValid();if(x){this._attrCombinationView.removeEmptyAttribute();if(!s.isModelActivated(y.model)&&true===y._isCriterionModified()){y._switchCriterionState()}}}return x},_getCallbackToEditCriterion:function(){var x=this.editAttribute.bind(this);return x},editAttribute:function(){this.SaveAttrBeforeEdit.queryCV=this.model.toCVQuery(true);this.SaveAttrBeforeEdit=l.getAttributeValues(this.model);this.SaveAttrBeforeEdit.types=this.types;this.SaveAttrBeforeEdit.subTypes=this.subTypes;this.SaveAttrBeforeEdit.attributes=this.attributes;if(this.subTypeCombo){this.SaveAttrBeforeEdit.elementsListExtension=this.subTypeCombo.elementsList}this.SaveAttrBeforeEdit.typeInfosLabel=this.keepTypeInfosFromLabel;this.SaveAttrBeforeEdit.subTypeInfosLabel=this.keepSubTypeInfosFromLabel;var x=this._attrCombinationView.saveBeforeEdit();this.SaveAttrBeforeEdit.saveAttributes=x;this.model.set("state","edit");this.dispatchEvent("NGF_Criterion_SwitchedToEdit")},_cancelEditCriteria:function(){if(this._isCriterionModified()){this.isCancelEditCrteriaActivated=true;if(undefined===this.SaveAttrBeforeEdit.type){this._keepRemoveCombo.currentValue="Keep";this.typeCombo.selectedIndex=0;this.subTypeCombo.selectedIndex=-1;this.subTypeCombo.hide();this._extensionBtn.show();this._attrCombinationView.restoreBeforeEdit(this.SaveAttrBeforeEdit.saveAttributes)}else{this._keepRemoveCombo.currentValue=this.SaveAttrBeforeEdit.Keep||"true";this.types=this.SaveAttrBeforeEdit.types;this.keepTypeInfosFromLabel=this.SaveAttrBeforeEdit.typeInfosLabel;var y=Object.keys(this.keepTypeInfosFromLabel);for(var x=0;x<y.length;x++){if(this.SaveAttrBeforeEdit.type===this.keepTypeInfosFromLabel[y[x]].value){this.typeCombo.currentValue=y[x];break}}this.subTypes=this.SaveAttrBeforeEdit.subTypes;this.keepSubTypeInfosFromLabel=this.SaveAttrBeforeEdit.subTypeInfosLabel;this.subTypeCombo.elementsList=this.SaveAttrBeforeEdit.elementsListExtension;if(undefined===this.SaveAttrBeforeEdit.extension){this._extensionBtn.show();this.subTypeCombo.hide();this.subTypeCombo.selectedIndex=-1}else{var y=Object.keys(this.keepSubTypeInfosFromLabel);for(var x=0;x<y.length;x++){if(this.SaveAttrBeforeEdit.extension===this.keepSubTypeInfosFromLabel[y[x]].value){this.subTypeCombo.currentValue=y[x];break}}}this._attrCombinationView.restoreBeforeEdit(this.SaveAttrBeforeEdit.saveAttributes);if(this.SaveAttrBeforeEdit){l.setAttributeValues(this.model,this.SaveAttrBeforeEdit)}}this.isCancelEditCrteriaActivated=false}},_createHeaderIcon:function(){var x=r.createElement("img",{src:b.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_AttributeFilter.png"),height:"22px"});x.inject(this.getElement(".attributeCriterion-edit .criteriaIcon"))},_createHeaderCtxMenu:function(){var x=[{id:"cancel-item-DDCtx",text:j.get("cancelEditCriteria"),fonticon:"cancel",handler:this._cancelEditCriteria.bind(this)}];this._createCriterionCtxMenu(this.getElement(".criterionDropDown"),x);x=(this.customizeCtxMenu)?["edit","activate","delete"]:["edit","activate"];this._hideCtxItem(x)},onKeepChange:function(x){if(false===x.get("Keep")){this.dispatchEvent("NGF_AttrKeepToRemoveMode")}else{this.dispatchEvent("NGF_AttrRemoveToKeepMode")}},onStateChange:function(x,G){var B=this.model.criterionToString();if(r.is(B,"string")||r.is(B,"array")){var y=this.getElement(".f-attribute-container");y.setAttribute("class","f-attribute-container "+G);var A=(this.customizeCtxMenu)?["edit"]:["edit","activate"];var z=["cancel"];if("read"===G){var H=(r.is(B,"array"))?B:[B];var E=H[0];H.shift();var C=this._getAttributeHTML(H);var D=[];D.push({tag:"img",src:b.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_AttributeFilter.png")});D.push({tag:"span",html:E});var F=this.getElement(".attrRead");F.setContent(D);if(this.sequenceMode){F.getElement("img").hide()}else{F.getElement("img").show()}this.getElement(".attrRead-multi-attr").setContent([{html:C}]);this._showCtxItem(A);this._hideCtxItem(z)}else{if(this.sequenceMode){this.getElement("#"+this._getId()+" .criteriaIcon").hide()}this._showCtxItem(z);this._hideCtxItem(A);this._buildExtensionUI();this._attrCombinationView.updateMRUOfAttribute()}}else{if(r.is(B,"object")){this.dispatchEvent("NGF_Criterion_Notification",[B])}}},_getAttributeHTML:function(y){var B="";for(var A=0;A<y.length;A++){if(r.is(y[A],"array")){var x=y[A];B+="<li>"+x[0];B+='<ul class="attrRead-multi-attr"><div>';x.shift();var z=this._getAttributeHTML(x);B+=z;B+="</div></ul></li>"}else{B+="<li>"+y[A]+"</li>"}}return B},createKeepRemoveDropDown:function(x){var y=[{labelItem:j.get("keep"),valueItem:true},{labelItem:j.get("remove"),valueItem:false}];this._keepRemoveCombo=new u({touchMode:s.TOUCH_MODE,elementsList:y,placeholder:j.get("keepRemoveLabel"),enableSearchFlag:false,selectedIndex:(x)?0:1});var B=(this.sequenceMode)?false:true;this.setEnableKeepRemove(B);this._keepRemoveCombo.inject(this.attrEditInputs);this.model.set("Keep",((x)?true:false));var A=this;this._keepRemoveCombo.addEventListener("change",function z(C){A.model.set("Keep",C.dsModel.currentValue)})},selectTypes:function(D,x){var C=this;var F=function(J){var H=J.dsModel.currentLabel;var I=C.keepTypeInfosFromLabel[H];if(I){I=I.value;C._needToQueryServer=(!C.isCancelEditCrteriaActivated&&C._selectedType!==I);C._selectedType=I;C.model.set("type",I);C.model.set("nlsType",H);C._buildExtensionUI();C.selectAttributes(I);C._setEnableButtons(true)}else{C._cleanTypes();C._setEnableButtons(false)}C._selectedSubType="";C.model.set("extension","");C.model.set("nlsExtension","")};if(D){this.types=D}if(this.types){this.typeCombo=this._buildAndFeedCombo("type",this.types,this._childGroupId);this.typeCombo.addEventListener("change",F);if(undefined===x){x=-1;var y=this.types.length;var B=this.typeCombo.elementsList.length;var G=0;for(var A=0;A<y&&!G;A++){var E=this.types[A];if(E&&"VPMReference"===E.name){for(var z=0;z<B&&!G;z++){if(E.nlsName===this.typeCombo.elementsList[z].labelItem){x=z;G=1}}}}x=(!G&&y)?0:x}this.typeCombo.selectedIndex=x}},_setEnableButtons:function(y){var x=!y;this._refeshSynthesisBtn.disabled=x;this.addAttributeBtn.disabled=x;this.addAttributeGroupBtn.disabled=x;this._addAttributeSequenceBtn.disabled=x;this._validateButton.disabled=x},_buildExtensionUI:function(){var y=this;if(undefined===this.subTypeCombo||-1===this.subTypeCombo.selectedIndex){var x=document.getElementById("No_Extenion_Available");if(x){x.remove()}if(this._extensionBtn){this._extensionBtn.show();if(!this.subTypeCombo){this.subTypeCombo=this._buildAndFeedCombo("extension",[],this._childGroupId)}this.subTypeCombo.hide()}else{this._extensionBtn=new n({touchMode:s.TOUCH_MODE,displayStyle:"lite",label:j.get("SelectExtension"),domId:"SelectExtension_"+this._childGroupId});this._extensionBtn.inject(this.attrEditInputs);this._extensionBtn.getContent().addClassName("attributeCriterion-edit-SelectExtension");this._extensionBtn.addEventListener("buttonclick",function(z){y._extensionBtn.hide();if(y.subTypeCombo){y.subTypeCombo.show("slow")}y._computeExtensionsAndUpdateUI(y.keepTypeInfosFromLabel[y.typeCombo.currentLabel].value)});this.subTypeCombo=this._buildAndFeedCombo("extension",[],this._childGroupId);this.subTypeCombo.hide()}}},_computeExtensionsAndUpdateUI:function(z){if(!z){return}if(false===this._needToQueryServer&&this.subTypes){this._updateExtensionUI()}else{if(this.subTypeCombo){w.mask(this.attrEditInputs)}var y=this;var x='{"classes":["'+z+'"]}';a.authenticatedRequest(s.getInterfacesUrl(),{headers:s.getRESTHeaders(),method:"POST",data:x,type:"json",proxy:"passport",onComplete:function(B){y.subTypes=[];var A=B.results;if(A&&A.length){var C=B.results[0].interfaces;if(C){y.subTypes=y._updateExtensionWithSynthesis(C,y._synthesisInfos)}}y._updateExtensionUI();if(1===y.subTypes.length&&y.subTypeCombo){y.subTypeCombo.selectedIndex=0}}})}},_updateExtensionUI:function(){var z=document.getElementById("No_Extenion_Available");if(z){z.remove()}if(!this.subTypes.length){this._extensionBtn.hide();this.subTypeCombo.hide();z=document.getElementById(this._extensionBtn.domId);if(z){var x=r.createElement("label",{"class":"innerfiltertypecombo No-Extension-Available",text:j.get("NoExtensionAvailable"),id:"No_Extenion_Available"});x.inject(z,"after")}w.unmask(this.attrEditInputs)}else{if(this.subTypeCombo){this._buildAndFeedCombo("extension",this.subTypes,this._childGroupId,this.subTypeCombo);w.unmask(this.attrEditInputs)}var y=this;this.subTypeCombo.addEventListener("change",function(E){var C="";var D=y._selectedType;var F=E.dsModel.currentLabel;var B=y.keepSubTypeInfosFromLabel[F];if(B){C=B.value;D=C;y._needToQueryServer=(!y.isCancelEditCrteriaActivated&&y._selectedSubType!==C)}y._selectedSubType=C;y.model.set("extension",C);y.model.set("nlsExtension",((""===C)?C:F));if(!y.isCancelEditCrteriaActivated){var A="ds6wg:"+D;if(1===s.getDictionaryAccessLevel()){q.getPropertiesForClass(A,{tenantId:s.getTenantId(),lang:k.getLanguage().toLowerCase(),apiVersion:"R2019x",onComplete:function(G){var H=(G.length)?G[0].properties:[];y.attributes=y.attributesOfTypes.concat(H);y.updateSynthesis(y._synthesisInfos)},onFailure:function(G){}})}else{a.authenticatedRequest(s.getPredicatesUrl(),{headers:s.getRESTHeaders(),method:"POST",data:A,type:"json",proxy:"passport",onComplete:function(G){if(null!==G){var H=G.classPredicates[0].vocabularyPredicateInfo;y.attributes=y.attributesOfTypes.concat(H);y.updateSynthesis(y._synthesisInfos)}},onFailure:function(G){}})}}})}},_cleanTypes:function(){if(this.typeCombo&&this.typeCombo.elements){this.typeCombo.selectedIndex=-1;this._cleanSubTypes();this._attrCombinationView.cleanAttributes()}},_cleanSubTypes:function(){if(this.subTypeCombo&&this.subTypeCombo.elements){this.subTypeCombo.elements.container.remove();delete this.subTypeCombo}if(this._extensionBtn){this._extensionBtn.remove();delete this._extensionBtn}},_displayLoader:function(x){if(this.loaderAttributes){if("on"===x){this.loaderAttributes.on()}else{this.loaderAttributes.off()}}},selectAttributes:function(z){if(!z){return}if(false===this._needToQueryServer&&this.attributes){this._createAttributeCombinationView()}else{var y=this;if(undefined===this.loaderAttributes){this.loaderAttributes=new v({touchMode:s.TOUCH_MODE,text:j.get("LoaderForAttributes"),showButtonFlag:false}).inject(this.attrEditInputs);this._displayLoader("on")}else{this._displayLoader("on")}var A=y.model.get("extension");if(!A||""===A){if(1===s.getDictionaryAccessLevel()){var x="ds6wg:"+z;q.getPropertiesForClass(x,{tenantId:s.getTenantId(),lang:k.getLanguage().toLowerCase(),apiVersion:"R2019x",onComplete:function(E){y._displayLoader("off");var F=E.length;y.attributes=[];for(var D=0;D<F;D++){var C=E[D].properties;for(var B=0;B<C.length;B++){if(C[B].rangeValues){C[B].rangeValues={literalInfo:C[B].rangeValues}}}y.attributes=y.attributes.concat(E[D].properties)}y.attributesOfTypes=y.attributes;y._needToQueryServer=y.isCancelEditCrteriaActivated;y._updateAttributesWithSynthesis(y.attributes,y._synthesisInfos);y._createAttributeCombinationView()},onFailure:function(B){y._displayLoader("off");y._updateAttributesWithSynthesis(y.attributes,y._synthesisInfos);y._createAttributeCombinationView()}})}else{var x='{"classes":["'+z+'"]}';a.authenticatedRequest(s.getInterfacesUrl(),{headers:s.getRESTHeaders(),method:"POST",data:x,type:"json",proxy:"passport",onComplete:function(D){if(D&&D.results){x="ds6wg:"+z;var C=D.results;if(C.length){var E=C[0].interfaces}var B=s.getPredicatesUrl()+"?extensions=true";a.authenticatedRequest(B,{headers:s.getRESTHeaders(),method:"POST",data:x,type:"json",proxy:"passport",onComplete:function(G){y._displayLoader("off");if(null!==G){var H=G.classPredicates.length;y.attributes=[];for(var F=0;F<H;F++){y.attributes=y.attributes.concat(G.classPredicates[F].vocabularyPredicateInfo)}y.attributesOfTypes=y.attributes;y._needToQueryServer=y.isCancelEditCrteriaActivated;y._updateAttributesWithSynthesis(y.attributes,y._synthesisInfos);y.subTypes=y._updateExtensionWithSynthesis(E,y._synthesisInfos);y._createAttributeCombinationView()}},onFailure:function(F){y._displayLoader("off");y._updateAttributesWithSynthesis(y.attributes,y._synthesisInfos);y._createAttributeCombinationView()}})}else{y._displayLoader("off")}},onFailure:function(B){y._displayLoader("off")}})}}else{}}},_buildAndFeedCombo:function(A,B,z,E){var F=0;switch(A){case"type":this.keepTypeInfosFromLabel={};break;case"extension":this.keepSubTypeInfosFromLabel={};F=1;break}var D=this;var C=[];B.forEach(function(I){var H=I.nlsName;switch(A){case"type":if(!D.keepTypeInfosFromLabel[H]){D.keepTypeInfosFromLabel[H]={}}D.keepTypeInfosFromLabel[H]={value:I.name};break;case"extension":if(!D.keepSubTypeInfosFromLabel[H]){D.keepSubTypeInfosFromLabel[H]={}}D.keepSubTypeInfosFromLabel[H]={value:I.name};break}C.push({valueItem:I.name,labelItem:H})});if(E){E.elementsList=(F)?C.sort(D._alphabeticSort):C;return}else{var y=(1===C.length)?0:-1;var G=r.String.format(j.get("placeHolderSelectEntity"),j.get(A));var x=new u({touchMode:s.TOUCH_MODE,actionOnClickFlag:true,elementsList:(F)?C.sort(D._alphabeticSort):C,preselectedIndex:y,placeholder:G,autocompleteFlag:false,generateRegexpString:function(H){return H}});x.inject(this.attrEditInputs);x.getContent().addClassName("attributeCriterion-edit-"+A);return x}},_alphabeticSort:function(y,x){var z=0;if(undefined!==y&&undefined!==x){z=(y.labelItem<=x.labelItem)?-1:1}return z},_getDOMElementToUpdateOnActivateChange:function(){var x=[];x.push(this.getElement("#"+this._getId()+" .attributeCriterion-read .attrRead"));x.push(this.getElement("#"+this._getId()+" .attributeCriterion-read .attrRead-multi-attr"));return x},destroy:function(){if(this._attrCombinationView){this._attrCombinationView.destroy()}this.dispatchEvent("NGF_RemoveCriterion",{idxView:this.cid});this.stopListening();this.model=null;this._parent();this.container=null},_isCriterionModified:function(){var y=this.model.toCVQuery(true);var x=(this.SaveAttrBeforeEdit.queryCV===y)?false:true;return x},viewFromMdl:function(x){if(undefined===x.Keep){x.Keep=this.model.get("Keep")}if(!x.isActivated){x.isActivated=this.model.get("isActivated")}if(!x.extension){x.extension=this.model.get("extension")}if(undefined!==this._keepRemoveCombo){this._keepRemoveCombo.currentValue=x.Keep}this.typeCombo.currentValue=x.type;if(x.extension){this._extensionBtn.hide();this.subTypeCombo.show();this._computeExtensionsAndUpdateUI(x.type);this.subTypeCombo.currentValue=x.extension}this._attrCombinationView.viewFromMdl(x);if("0"===x.isActivated){this._switchCriterionState()}},_createAttributeCombinationView:function(){if(this._attrCombinationView){this._attrCombinationView.destroy();var y=this.model.get("allAttributes")||[];y.splice(0);this.model.set("allAttributes",y)}var x=new m();var y=this.model.get("allAttributes")||[];y.push(x);this.model.set("allAttributes",y);this._attrCombinationView=new t({model:x,selectedType:(undefined!==this.model.get("nlsType")&&undefined!==this.keepTypeInfosFromLabel)?this.keepTypeInfosFromLabel[this.model.get("nlsType")].value:"",selectedExtension:this._selectedSubType,attributesUsed:this.attributes,attrEditInputs:this.attrEditInputs,attrEditInputsAttr:this.attrEditInputsAttr});this._attrCombinationView.render().inject(this.attrEditInputs);var z=this._attrCombinationView._listOfAttributes.length;if(z){this._attrCombinationView._listOfAttributes[z-1].setFocus()}this.listenTo(this._attrCombinationView,"NGF_SwitchDisplayContext",this._onSwitchDisplayContext.bind(this));this.listenTo(this._attrCombinationView,"NGF_DisplayAddActions",this._onDisplayAddActions.bind(this))},_onSwitchDisplayContext:function(x){if(1===x.context){x.combination.inject(this.attrEditInputs);x.view.inject(this.attrEditInputsAttr);this.attrEditInputsAttr.show()}else{x.view.inject(this.attrEditInputs);this.attrEditInputsAttr.hide()}var y=this.getElement(".attributeCriterion-edit-refresh-btn");y.inject(this.attrEditActions);y=this.getElement(".attribute-edit-add-btn2");y.inject(this.attrEditActions);y=this.getElement(".attribute-edit-addGroup-btn2");y.inject(this.attrEditActions);y=this.getElement(".attributeCriterion-edit-addSequence-btn");y.inject(this.attrEditActions);y=this.getElement(".attributeCriterion-edit-validate");y.inject(this.attrEditActions)},_onDisplayAddActions:function(z){var y=this.attrEditActions.getElement(".attribute-edit-add-btn2");var x=this.attrEditActions.getElement(".attribute-edit-addGroup-btn2");if(y&&x){if(z.display){y.show();x.show()}else{}}},_createRefeshSynthesisButton:function(x){var A=new n(s.getAttributeButtonStyle("refresh"));A.inject((x)?x:this._Div);A.tooltipInfos=new e({shortHelp:j.get("RefreshSynthesisInfosTooltip"),mouseRelativePosition:false});var z="attribute-edit-button-style"+((s.TOUCH_MODE)?"":" filter-no-touch-mode");A.getContent().addClassName(z+" attributeCriterion-edit-refresh-btn");var y=this;A.addEventListener("buttonclick",function(B){y.dispatchEvent("NGF_RefreshSynthesis")});return A},_createAddAttributeButton:function(x){if(this.addAttributeBtn){return this.addAttributeBtn}var A=new n(s.getAttributeButtonStyle("plus"));A.inject((x)?x:this._Div);A.tooltipInfos=new e({shortHelp:j.get("AddAttribute"),mouseRelativePosition:false});var z="attribute-edit-button-style"+((s.TOUCH_MODE)?"":" filter-no-touch-mode");A.getContent().addClassName(z+" attribute-edit-add-btn2");var y=this;A.addEventListener("buttonclick",function(B){y._cleanSelected();y._attrCombinationView.createAttribute()});return A},_createAddAttributeGroupButton:function(x){if(this.addAttributeGroupBtn){return this.addAttributeGroupBtn}var A=new n(s.getAttributeButtonStyle("group-add"));A.inject((x)?x:this._Div);A.tooltipInfos=new e({shortHelp:j.get("AddAttributeGroup"),mouseRelativePosition:false});var z="attribute-edit-button-style"+((s.TOUCH_MODE)?"":" filter-no-touch-mode");A.getContent().addClassName(z+" attribute-edit-addGroup-btn2");var y=this;A.addEventListener("buttonclick",function(B){y._cleanSelected();y._attrCombinationView.createAttributeGroup()});return A},_cleanSelected:function(){var x=this.getElement(".attribute-edit-group-selected");if(x){x.removeClassName("attribute-edit-group-selected")}},reDrawCriterion:function(){if("read"===this.model.get("state")){this.model.set("state","edit");this.model.set("state","read")}else{this.model.set("state","read");this.model.set("state","edit")}if(this._validateButton){this._validateButton.getContent().addClassName("attributeCriterion-edit-validate"+((this.sequenceMode)?"":" colorized"))}},setSequenceMode:function(x){this.sequenceMode=(x)?true:false;this.model.set("inSequence",this.sequenceMode);if(this.sequenceMode){this._refeshSynthesisBtn.hide();this._addAttributeSequenceBtn.hide()}else{this._refeshSynthesisBtn.show();this._addAttributeSequenceBtn.show()}var y=this.getElement(".criteriaIcon img");if(y){if(this.sequenceMode){y.hide()}else{y.show()}}},setEnableKeepRemove:function(x){if(this._keepRemoveCombo){this._keepRemoveCombo.disabled=!x}},initKeepRemove:function(y){var x=("Keep"===y)?0:1;this._keepRemoveCombo.selectedIndex=x;this.reDrawCriterion()},switchCriterionToSequence:function(){this.setSequenceMode(true);this.setEnableKeepRemove(true);this.reDrawCriterion()},switchSequenceToCriterion:function(){this.setSequenceMode(false);this.setEnableKeepRemove(true);this.reDrawCriterion()},updateSynthesis:function(x){this._synthesisInfos=x;this._updateAttributesWithSynthesis(this.attributes,this._synthesisInfos);if(this._attrCombinationView){this._attrCombinationView.updateAttributes(this.attributes)}},_updateAttributesWithSynthesis:function(x,E){if(E&&x){var D=E.length;var A=x.length;if(A){if(D){for(var z=0;z<D;z++){var C=0;for(var y=0;y<A&&!C;y++){var B=x[y].curi||x[y].uri;if(E[z].property===B){x[y].rangeValues={editable:true,literalInfo:E[z].values};C=1}}}}else{x.forEach(function(F){if(F.rangeValues){F.rangeValues=undefined}})}}else{}}else{}},_updateExtensionWithSynthesis:function(C,G){var F=[];if(C&&G){var B=C.length;if(B){var x=G.length;for(var A=0;A<x;A++){if("ds6w:kind"===G[A].property){var H=G[A].values;var D=H.length;for(var z=0;z<D;z++){var E=0;for(var y=0;y<B&&!E;y++){if(!s.isCustomizedAttribute(C[y])){if(H[z].value===C[y].name){F.push(C[y]);E=1}}}}}}}if(B&&-1!==window.location.href.indexOf("NGFDebugExtension")){F.splice(0);C.forEach(function(I){F.push(I)})}}return F},isThereCriteria:function(){return(this._attrCombinationView)?true:false}});return p});define("DS/ENONextGenFilterUX/views/FilterViewManager",["UWA/Class","UWA/Core","DS/PlatformAPI/PlatformAPI","DS/Logger/Logger","DS/ENONextGenFilterUX/views/ContainerFilterView"],function(g,e,c,b,d){var h=null;var f={};var a=g.extend({init:function(i){if(null===h){h=this._initManager()}this._initDisplay=i.display;c.subscribe("NGFilter.RemoveFilter",this._onRemoveFilter.bind(this));c.subscribe("NGFilter_ViewChange",this._onViewChange.bind(this))},get3DXView:function(v){var m;if(undefined===v.createFilterView||(undefined!==v.createFilterView&&true===v.createFilterView)){var l=v.filterId||v.widgetId;m=h.get(l);var k="NGF_isUXBuilt_"+v.rootID;var p="NGF_tagMgtRunning_"+v.rootID;if(null===m){f[v.appId]=0;var o=sessionStorage.length;for(var n=0;n<o;n++){var u=sessionStorage.key(n);if(-1!==u.indexOf("NGFilter_Volume_"+v.appId)){if("true"===sessionStorage.getItem(u)){if(0===f[v.appId]){f[v.appId]=true;break}}}}v.volumeUsed=f[v.appId]||false;sessionStorage.setItem(k,false);if(v.tagData){sessionStorage.setItem(p,true)}var r=new d(v);h.add(l,r);h.display(l);m=h.get(l)}else{if("false"===sessionStorage.getItem(k)){return}if("true"===sessionStorage.getItem(p)){return}if("drop"===v.NGFState||"dropOnFilter"===v.NGFState){var q=this;var t={success:[{rootId:v.rootID,filter:"tbd",rootType:"VPMReference",filterId:(Array.isArray(v.filterIds))?v.filterIds:[v.filterIds],filterName:(Array.isArray(v.filterNames))?v.filterNames:[v.filterNames],NGFState:v.NGFState,}],failure:[]};c.publish("NGFilter.ApplyDroppedFilters",t)}var s=(undefined===v.display)?true:v.display;if(s){h.display(l)}if(v.tagData){sessionStorage.setItem(p,true);m.setTagsDataOnNGF(v)}c.publish("NGFilter.Redraw",{filterId:l,widgetId:v.widgetId});var j=v.filterToApply;if(j){c.publish(j.event,j.data)}}}return m},_onViewChange:function(j){if(j.type==="maximized"){var i=this._computeFilterId(j);if(false===h.isThereViewWithId(i)){c.publish("Frame3DXInfra.Close",{})}}},_onRemoveFilter:function(j){var i=this._computeFilterId(j);h.remove(i,j.rootIds);c.publish("Frame3DXInfra.Close",{})},_computeFilterId:function(i){var j=i.appId;return j},_initManager:function(){var i={_listView:{},_currentFilterId:"",get:function(j){var k=(j&&this._listView[j])?this._listView[j]:null;return k},getCurrent:function(){var j=(""!==this._currentFilterId)?this._listView[this._currentFilterId]:null;return j},isThereViewWithId:function(k){var l=false;for(var m in this._listView){if(this._listView.hasOwnProperty(m)){var j=this._listView[m];if(j&&j.appId){l=(-1!==k.indexOf(j.appId))}}}return l},add:function(k,j){if(k&&j){if(!this._listView[k]){this._listView[k]=j}}},display:function(k){if(k){var j=this._currentFilterId;if(j!==k){if(""!==j){if(this._listView[j]){this._listView[j].hide()}}if(this._listView[k]){this._currentFilterId=k;this._listView[k].show()}}}},remove:function(q,n){if(q){if(n){var o=(Array.isArray(n))?n:[n];var m=o.length-1;for(var l=m;l>=0;l--){var j=q+"_"+o[l];this._remove(j)}}else{var p=Object.keys(this._listView);var k=p.length-1;for(var l=k;l>=0;l--){if(-1!==p[l].indexOf(q)){this._remove(p[l])}}}if(0===Object.keys(this._listView).length||!this._listView[this._currentFilterId]){this._currentFilterId=""}}},_remove:function(j){var k=h.get(j);if(k){k.remove();delete this._listView[j]}}};return i}});return a});define("DS/ENONextGenFilterUX/views/GroupView",["UWA/Core","UWA/Class/View","UWA/Class/Model","DS/WAFData/WAFData","UWA/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Autocomplete","DS/UIKIT/DropdownMenu","DS/UIKIT/Input/Text","DS/UIKIT/Input/Number","DS/UIKIT/Input/Date","DS/UIKIT/Tooltip","DS/UIKIT/Mask","DS/ENONextGenFilterUX/utils/FilterUIService","DS/Handlebars/Handlebars","text!DS/ENONextGenFilterUX/templates/groupViewTemplate.html","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/ENONextGenFilterUX/views/CriteriaAttributeView","DS/ENONextGenFilterUX/models/CriterionModel","DS/ENONextGenFilterUX/collections/FilterUIGroupCollection","DS/WebappsUtils/WebappsUtils","DS/ENONextGenFilterUX/views/GroupView","DS/ENONextGenFilterUX/views/CriteriaTagView","DS/ENONextGenFilterUX/models/GroupModel","css!DS/ENONextGenFilterUX/ENONextGenFilterUX.css","DS/ENONextGenFilterUX/views/CriteriaConfigurationView","DS/Logger/Logger","DS/Controls/Button","DS/Controls/TooltipModel","DS/Controls/LineEditor","DS/ENONextGenFilterUX/views/CriteriaContextMgmtView","DS/PlatformAPI/PlatformAPI","DS/ENONextGenFilterUX/views/CriteriaVolumeView"],function(z,k,t,b,g,q,r,y,u,B,G,A,C,H,D,h,a,p,v,m,c,f,e,j,l,o,n,F,s,i,E,x,d,w){var e=k.extend({className:"filtergroup-topdiv",domEvents:{"click .f-group-container .group-header .filter-name-icon":"expandCollapse","click .f-group-container .filter-applies .context-filter":"_contextFilterEdit","click .f-group-container .Sequence-read":"editSubGroup","click .f-group-container .group-header2":"editSubGroup"},setup:function(I){this.hasConf=false;this._filterId=I.filterId||"";this._groupId=I.groupId||0;this._childGroupId=I.childGroupId||0;this.types=I.types||null;this._synthesisInfos=I.synthesisInfos||null;if(this._synthesisInfos&&!this.types){this.types=D.getTypesOfSynthesis(this._synthesisInfos)}this._securityContext=I.securityContext;this._rootID=I.rootID||p.get("root");this._rootAlias=I.rootAlias||"?";this._subGroupId=I.subGroup||0;this._savedRootID=I.savedRootID;this._template=h.compile(a);this.listenTo(this.model,"onChange:state",this.onStateChange.bind(this));this.listenTo(this.model,"onChange:isActivated",this._onActivateChange.bind(this));this._cfgView=null;this._configUsed=I.conf;this._isVolumeAvailable=I.volumeAvailable;this._filterToApply=I.filterToApply;this._listView=[];this._listViewId=[];this.filterViewToClone=I.filterViewToClone;this._subGroupKeepRemoveMode=1;this._defaultSpecName=p.get("defaultGroupName");if(this._defaultSpecName===this.collection.getFilterSpecificationName()){if(this._groupId){this._defaultSpecName=UWA.String.format(p.get("defaultGroupNameWithValue"),this._groupId)}this.collection.setFilterSpecificationName(this._defaultSpecName)}this._tagData=I.tagData;if(this._tagData&&(0===this._subGroupId)){this.createTagNGF(this._tagData)}this._subscribe0=d.subscribe("NGFilter_VolumeDefined",this._onVolumeDefined.bind(this));this._globalFilterState="New"},render:function(){this.container.setAttribute("id","topgroupdiv"+this._getId());this.container.setContent(this._template({stateClass:this.model.get("state"),filterAppliesTo:p.get("filterAppliesTo"),target:this._rootAlias,contextfilter:p.get("contextFilterTitle"),groupId:this._getId(),subGroup:(this._subGroupId)?"sequence":"",groupName:(0===this._subGroupId)?this._defaultSpecName:p.get("headerAttributeSequenceEdit"),iconHeader:(0===this._subGroupId)?"filter":f.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_AttributeFilter.png"),}));if(0===this._subGroupId){this.createAddCriterionButton();this._createContextMgmtView("create")}else{var J=this.getElement(this._getCSSId()+" .subGroup-edit-actions");if(false===D.TOUCH_MODE){J.addClassName("filter-no-touch-mode")}this.addRefeshSynthesisBtn=this._createRefeshSynthesisButton(J);this.addAttributeButton=this._createAddAttributeSequenceButton(J);this._createValidateButton(J);this._dropdownCtxMenu=this._createDropdownMenu();this._dropDownCreated=true}var I=this.getElement(".group-header .filter-name-icon");if(I){I.tooltipInfos=new i({shortHelp:p.get("ExpandCollapseFilterSpecification"),mouseRelativePosition:false})}var K=this.getElement(".group-header .fonticon-chevron-down");if(K){K.tooltipInfos=new i({shortHelp:p.get("Menu"),mouseRelativePosition:false})}this._filterSpecNameEditor=this._createRenameFilterSpecLineEditor();this._filterSpecNameEditor.hide();if(this._filterToApply){this._onVolumeDefined(this._filterToApply.data);this._filterToApply=undefined}return this},_getId:function(I){var J="grp_"+this._groupId;J+=(!I&&0!==this._subGroupId)?this._subGroupId:"";return J},_getCSSId:function(I){var J="#"+this._getId(I);return J},isThereCriteria:function(){var K=false;var J=this._listView.length;for(var I=0;I<J;I++){if(this._listView[I].isThereCriteria()){K=true;break}}return K},_onEditCriterion:function(){this.switchToEdit();this.dispatchEvent("NGF_UpdateApplySaveSaveAsState",{buttonsStatus:"ValidOK"})},switchToEdit:function(){if("read"===this.model.get("state")){this.model.set("state","edit");this.model.set("isActivated","1");if(0!==this._subGroupId){this.dispatchEvent("NGF_Criterion_SwitchedToEdit")}else{this.dispatchEvent("NGF_Group_SwitchedToEdit",{groupId:this._groupId})}}},expandCollapse:function(J){J.stopPropagation();var I=this.getElement(".filter-group-expander");if(I){I.toggleClassName("fonticon-expand-down");I.toggleClassName("fonticon-expand-right");var K=this._getCSSId();if(I.hasClassName("fonticon-expand-right")){this.getElement(K).addClassName("group-collapse");this.getElement(K).removeClassName("group-expand")}else{if(I.hasClassName("fonticon-expand-down")){this.getElement(K).addClassName("group-expand");this.getElement(K).removeClassName("group-collapse")}}}},setFilterState:function(I){this._globalFilterState=I},editReadMgt:function(K){if(this.collection){var I=this.collection.findWhere({state:"edit"});var L;if(undefined!==I){var J=I.get("criteriaType");L=("Sequence"===J)?I.groupToString():I.criterionToString();this._onCriterionActivated()}if(z.is(L,"string")||z.is(L,"array")){I.set("state","read");this.dispatchEvent("NGF_UpdateApplySaveSaveAsState",{buttonsStatus:"ValidOK"})}else{if(z.is(L,"object")){D.displayNotification(L)}}this.dispatchEvent("NGF_AddSpecificationState",{})}},setTypes:function(I){this.types=I},setSynthesisInfos:function(O,L){if(!O){var M=this._listView.length;for(var K=0;K<M;K++){var J=this._listView[K];var N=J.model.get("criteriaType");var I=J.model.get("sequenceType");if("attribute"===N||("Sequence"===N&&"attribute"===I)){L.show();break}}}else{this._updateSynthesis(O,this);this._setEnableAddCriterionButtons(true)}},_updateSynthesis:function(P,J){J._synthesisInfos=P;J.types=D.getTypesOfSynthesis(P);var O=(J._createAttributeBtn)?J._createAttributeBtn.disabled:false;var M=J._listView.length;for(var L=0;L<M;L++){var K=J._listView[L];var N=K.model.get("criteriaType");var I=K.model.get("sequenceType");if("attribute"===N||"attribute"===I){if("Sequence"===N){this._updateSynthesis(P,K)}else{K.updateSynthesis(P)}if(O){K.selectTypes(J.types);H.unmask(K.getElement(".f-attribute-container"))}}}},_setEnableAddCriterionButtons:function(K){var I=(false===K)?true:false;var J=(false===K)?false:true;this._createAttributeBtn.disabled=I;this._createAttributeBtn.active=J;if(this._createConfigBtn){this._createConfigBtn.disabled=I;this._createConfigBtn.active=J}if(this._createVolumeBtn){this._createVolumeBtn.disabled=I;this._createVolumeBtn.active=J}},onStateChange:function(J,I){var R=this.getElement(this._getCSSId());var Q=" "+I;var N=(this._subGroupId)?" sequence":"";var S=(R.hasClassName("group-collapse"))?" group-collapse":"";R.setAttribute("class","f-group-container"+Q+N+S);if(0!==this._subGroupId){var P=this._getCSSId();if("read"===I){var K=this.model.groupToString();this.getElement(P+" .Sequence-read .subGroup-read-criterion").setContent([{html:K}]);this._dropdownCtxMenu.getItem("editSequence-item-DDCtx").elements.container.show();this._dropdownCtxMenu.getItem("activate-item-DDCtx").elements.container.show()}else{this._dropdownCtxMenu.getItem("editSequence-item-DDCtx").elements.container.hide();this._dropdownCtxMenu.getItem("activate-item-DDCtx").elements.container.hide()}var M="";if("read"===I){var L=(this._subGroupKeepRemoveMode)?p.get("keep"):p.get("remove");M=L+" "+p.get("headerAttributeSequenceRead")}else{M=p.get("headerAttributeSequenceEdit")}var O=this.getElement(P+" .group-name").setContent({tag:"span",html:M})}},createTagNGF:function(J){var I=this.collection.findWhere({criteriaType:"tag"});if(I&&this._rootID===I.get("rootID")){if(Object.keys(J.allfilters).length||Object.keys(J.localfilters).length){I.set("tagData",J)}else{this._onRemoveCriterion({idxView:this.tagView.cid,})}}else{I=new m({criteriaType:"tag",tagData:J,rootID:this._rootID,widget:this._filterId});this.collection.add(I);this.tagView=new j({filterId:this._filterId,childGroupId:this._childGroupId,model:I});this._listView.push(this.tagView);this._listViewId.push(this.tagView.cid)}},createAttribute:function(N,L,K,I,O){if("create"===L){this.attrMdl=new m({criteriaType:"attribute",state:"edit"});this.collection.add(this.attrMdl);this.attrView=new v({filterId:this._filterId,childGroupId:this._childGroupId,model:this.attrMdl,types:N,fromCriterionMdl:K,listAttrFromType:I,listAttrFromSubType:O,customizeCtxMenu:false,sequenceMode:((0!==this._subGroupId)?true:false),keepValue:this._subGroupKeepRemoveMode,synthesisInfos:this._synthesisInfos});if(0===this._subGroupId){this.attrView.render().inject(this.getElement(this._getCSSId(this._groupId)+">ul>.criterionButtonLi"),"before")}else{var M=this.getElement(this._getCSSId()+" .Sequence-edit>ul");this.attrView.render().inject(M);this.attrView.getElement(".criteriaIcon").hide()}this._addCriterionView(this.attrView);if(!N){H.mask(this.attrView.getElement(".f-attribute-container"));if(this.criterionButton){var J=this.criterionButton.getContent();J.disabled=true;J.active=false}else{this._setEnableAddCriterionButtons(false)}}else{this.attrView.selectTypes(N,this._selectedTypeIndex)}}else{if("update"===L){this.attrView.selectTypes(N,this._selectedTypeIndex)}else{console.log("RCI - GroupView : unknown status for createAttribute: "+L)}}return this.attrView},_createContextMgmtView:function(I){if("create"===I){this._contextModel=new m({criteriaType:"context",state:"read"});this.collection.add(this._contextModel);this.contextMgmtView=new x({filterId:this._filterId,childGroupId:this._childGroupId+2,rootId:this._rootID,model:this._contextModel,groupView:this,});this._addCriterionView(this.contextMgmtView);this.contextMgmtView.render().inject(this.getElement(this._getCSSId()+">ul>.contextViewLi"))}return this.contextMgmtView},_updateContextFilterView:function(I){if(this.contextMgmtView){this.contextMgmtView.updateContextMgmtView(I);this.contextMgmtView.render(I);this.contextMgmtView.model.set("state","read")}},_contextFilterEdit:function(){if(this.contextMgmtView){this._checkBeforeAdd("context");this.contextMgmtView.editContext(this.contextMgmtView)}},_onSwitchCriterionToSequence:function(O){var K=this.isCriterionValidate(O);if(K){var L=this._createSubGroupView(O.type);var M=this._listViewId.indexOf(O.idxView);var I=this._listView[M];var N=I.container;var J=N.getElement(".colorized");if(J){J.removeClassName("colorized")}L.collection.add(I.model);L._listView[0]=I;L._listViewId[0]=I.cid;L._subGroupKeepRemoveMode=(O.attributeKeep)?1:0;this.stopListening(I);L._initCriterionViewEvents(I);var Q=this.collection.indexOf(I.model);this.collection.remove(I.model);this.collection.add(L.model,{at:Q});this._listView[M]=L;this._listViewId[M]=L.cid;this._listView.pop();this._listViewId.pop();var P=z.createElement("li").inject(N,"after");L.render().inject(P);N.remove().inject(L.getElement(".Sequence-edit>ul"));if(z.is(I.switchCriterionToSequence,"function")){I.switchCriterionToSequence()}L._addNewCriterion({type:I.model.get("criteriaType")})}},_onSwitchSequenceToCriterion:function(N){var J=this._listViewId.indexOf(N.idxView);var L=this._listView[J];var K=L.container.getParent();var M=L._listView[0];this.stopListening(L);this._initCriterionViewEvents(M);var I=this.collection.indexOf(L.model);this.collection.remove(L.model);this.collection.add(M.model,{at:I});this._listView[J]=M;this._listViewId[J]=M.cid;M.container.remove().inject(K,"after");if(z.is(M.switchSequenceToCriterion,"function")){M.switchSequenceToCriterion()}L.stopListening();L._listView.splice(0);L._listViewId.splice(0);L.collection.reset();K.remove()},_createSubGroup:function(I){var K=this._createSubGroupView(I);if(K){var J=z.createElement("li").inject(this.getElement(this._getCSSId(this._groupId)+" .criterionButtonLi"),"before");K.render().inject(J)}return K},_createSubGroupView:function(I){var J;if(I){this.nbGroup=(undefined===this.nbGroup)?1:this.nbGroup+1;var K=new c([],{widgetId:this._bodyContainer,});var M=new l({subGroupCollection:K,criteriaType:"Sequence",sequenceType:I,subGroupId:this.nbGroup});this.collection.add(M);J=new e({appId:this.options.appId,widgetId:this.options.widgetId,groupId:this._groupId,childGroupId:this._childGroupId,collection:K,subGroup:this.nbGroup,model:M,types:this.types,rootID:this._rootID,savedRootID:this._savedRootID,synthesisInfos:this._synthesisInfos,securityCtx:this._securityContext});this._addCriterionView(J);this.listenTo(J,"NGF_SwitchSequenceToCriterion",this._onSwitchSequenceToCriterion.bind(this));var L=this;this.listenTo(J,"NGF_RefreshSynthesis",function(){L.dispatchEvent("NGF_RefreshSynthesis")})}return J},_onCriterionActivated:function(){if(0!==this._subGroupId&&"edit"===this.model.get("state")){var I=this.collection.findWhere({isActivated:"1"});if(I){if(!D.isModelActivated(this.model)){this._switchCriterionState({updateChildren:false})}}else{this._switchCriterionState({updateChildren:false})}}},createAddCriterionButton:function(){if(this._dropDownCreated){return}var I=this.getElement(this._getCSSId(this._groupId)+" .criterionButtonLi");this._createAddCriterionWithButtons(I);this._dropdownCtxMenu=this._createDropdownMenu();this._dropDownCreated=true},_createAddCriterionWithDropdownButton:function(I){var K=[];K.push({id:"add_attr_criterion",name:"attribute",text:p.get("addAttributeCriterion"),icon:f.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_AttributeFilter.png"),});if(this._configUsed){K.push({id:"add_conf_criterion",name:"config",text:p.get("addConfigurationCriterion"),icon:f.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_ConfigurationFilter.png"),})}if(this._isVolumeAvailable){K.push({id:"add_volume_criterion",name:"volume",text:p.get("addVolumeCriterion"),icon:f.getWebappsAssetUrl("ENONextGenFilterUX","icons/22/I_VolumeFilter.png"),})}var J=this;this.criterionButton=new q({value:p.get("addCriterionLabel"),icon:"plus",className:"block criterionButton",dropdown:{renderTo:(document.getElement)?document.getElement(".f-globalFilter-container"):document.body,items:K,events:{onClick:function(M,L){J._checkBeforeAdd(L.name)}}},dropdownCaret:false});this.criterionButton.inject(I)},_createAddCriterionWithButtons:function(I){var J=z.createElement("div",{"class":"filter-groups-cmd",id:"actions_gv_"+this._childGroupId});J.inject(I);this._createAttributeBtn=this._createAddCriterionButton("attribute",J);if(this._configUsed){this._createConfigBtn=this._createAddCriterionButton("config",J)}if(this._isVolumeAvailable){this._createVolumeBtn=this._createAddCriterionButton("volume",J)}},_createAddCriterionButton:function(O,J){var N;var P,I;var K;var M;switch(O){case"attribute":P="add_attr_criterion";I=p.get("addAttributeCriterion");M=p.get("addAttributeCriterionTooltip");K=f.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterAddAttribute.png");break;case"config":P="add_config_criterion";I=p.get("addConfigurationCriterion");M=p.get("addConfigurationCriterionTooltip");K=f.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterAddConfiguration.png");break;case"volume":P="add_volume_criterion";I=p.get("addVolumeCriterion");M=p.get("addVolumeCriterionTooltip");K=f.getWebappsAssetUrl("ENONextGenFilterUX","icons/32/filterAddVolume.png");break;default:}if(undefined!==P){N=new s({touchMode:true,displayStyle:"normal",showLabelFlag:true,id:P,label:I,icon:K});N.inject(J);N.tooltipInfos=new i({shortHelp:M,mouseRelativePosition:false});var L=this;N.addEventListener("click",function(Q){L._checkBeforeAdd(O)})}return N},editSpecification:function(I){I.stopPropagation();this.getElement(".group-name").hide();this._filterSpecNameEditor.show();this._filterSpecNameEditor._giveFocus()},editSubGroup:function(I){I.stopPropagation();this._checkBeforeEdit({callback:this._editSubGroup.bind(this)})},_editSubGroup:function(I){this.switchToEdit()},_addNewCriterion:function(I){if("attribute"===I.type){if(!this.types||this._savedRootID!==this._rootID){this._savedRootID=this._rootID;this._addAnyCriterion(I)}else{this._addAnyCriterion(I)}}else{this._addAnyCriterion(I)}},_onVolumeDefined:function(J){var I=false;if(this.criterionButton){I=this.criterionButton.getContent().disabled}else{if(this._createVolumeBtn){I=this._createVolumeBtn.disabled}}if(false===I){if(this._filterId===J.filterId){if(!this._volumeView&&(undefined===J.specId||this._groupId===J.specId)){var K=(!this._volumeView)?1:0;var L=0;this._createVolume(L);J.action=(K)?"update":J.action;d.publish("NGFilter_VolumeDefined_Init",J);if(K){d.publish("Frame3DXInfra.Open",{id:"First_Volume_Defined_"+this._groupId})}}}}},_addAnyCriterion:function(I){this.switchToEdit();var J=I.type;switch(J){case"attribute":this.createAttribute(this.types,"create");break;case"config":this._createConfig();break;case"volume":this._createVolume();break;default:}this.dispatchEvent("NGF_UpdateApplySaveSaveAsState",{buttonsStatus:"ValidOK"})},_checkBeforeAdd:function(I){this.dispatchEvent("NGF_Criterion_ValidateEdited",{type:I,callback:this._addNewCriterion.bind(this)})},_checkBeforeEdit:function(I){this.dispatchEvent("NGF_Criterion_ValidateEdited",I)},isCriterionValidate:function(M){var K=(this._listView)?this._listView.length:0;var I=(K)?false:true;if(K){I=true;for(var J=0;J<K;J++){var L=this._listView[J];if(null!==L&&"edit"===L.model.get("state")){if(undefined===L._subGroupId||0===L._subGroupId){if(z.is(L.isCriterionValidate,"function")){I=L.isCriterionValidate();if(I){if(L.model){L.model.set("state","read")}}}else{I=false;D.displayNotification({level:"error",message:p.get("NeedToValidateCrirerion")});break}}else{I=L.isCriterionValidate();if(I){L.dispatchEvent("NGF_Criterion_Validation",{criteriaType:L.model.get("criteriaType"),viewId:L._getCSSId()})}}}}}return I},areCriteriaValid:function(){var K=true;var J=(this._listView)?this._listView.length:0;for(var I=0;I<J&&K;I++){var L=this._listView[I];if(null!==L&&"edit"===L.model.get("state")){if(undefined===L._subGroupId||0===L._subGroupId){if(z.is(L.isCriterionValid,"function")){K=L.isCriterionValid()}}else{K=L.areCriteriaValid()}}}return K},setDeactivateVisible:function(I){if(this._dropdownCtxMenu){if(I){this._dropdownCtxMenu.getItem("activate-item-DDCtx").elements.container.show()}else{if(0===this._subGroupId){this._dropdownCtxMenu.getItem("activate-item-DDCtx").elements.container.hide()}}}},_createDropdownMenu:function(){if(this._dropdownCtxMenu){return}var I=[];if(0===this._subGroupId){I.push({id:"edit-item-DDCtx",text:p.get("renameFilterSpecification"),fonticon:"pencil",handler:this.editSpecification.bind(this)})}else{I.push({id:"editSequence-item-DDCtx",text:p.get("editCriteria"),fonticon:"pencil",handler:this.editSubGroup.bind(this)})}I.push({id:"activate-item-DDCtx",text:p.get("deactivatedCriteria"),fonticon:"eye-off",handler:this._checkBeforeChangeState.bind(this)});I.push({id:"delete-item-DDCtx",text:p.get("deleteFilterGroup"),fonticon:"trash",handler:this._removeGroup.bind(this)});var J=new u({target:this.getElement(this._getCSSId()+" .ctx-group-menu"),position:"bottom right",className:"block",items:I});if(0!==this._subGroupId){J.getItem("editSequence-item-DDCtx").elements.container.hide()}J.getItem("activate-item-DDCtx").elements.container.hide();return J},_createConfig:function(J){if(!this.hasConf){var I=new m({criteriaType:"config",state:(!J)?"read":"edit"});this.collection.add(I);this._cfgView=new n({filterId:this._filterId,childGroupId:this._childGroupId,model:I,rootId:this._rootID,fromConfig:J});this.listenTo(this._cfgView,"NGF_Criterion_Config",this._onConfigCriterionCB.bind(this));this._cfgView.render().inject(this.getElement(this._getCSSId(this._groupId)+">ul>.criterionButtonLi"),"before");this._addCriterionView(this._cfgView);if(!J){this._cfgView.editConfiguration()}}else{if(undefined!==this._cfgView&&null!==this._cfgView){this._cfgView.editConfiguration()}}},_onConfigCriterionCB:function(M){var L=M.displayMode||0;if(0===L){switch(M.action){case"cancel":if(this.hasConf){this.editReadMgt()}else{var J=this.collection.indexOf(M.model);if(-1!==J){this.collection.remove(M.model);this._cfgView.destroy()}}break;case"remove":var J=this.collection.indexOf(M.model);if(-1!==J){this.collection.remove(M.model)}if(this.hasConf){var I=this.collection.findWhere({criteriaType:"config"});if(I){this.collection.remove(M.model)}this._cfgView.destroy()}this.hasConf=false;if(this.criterionButton){var K=this.criterionButton.dropdown.getItem("add_conf_criterion");if(K){K.elements.container.show()}}else{if(this._createConfigBtn){this._createConfigBtn.disabled=false;this._createConfigBtn.active=true}}break;case"update":if(this.criterionButton){var K=this.criterionButton.dropdown.getItem("add_conf_criterion");if(K){K.elements.container.hide()}}else{if(this._createConfigBtn){this._createConfigBtn.disabled=true;this._createConfigBtn.active=false}}this.hasConf=M.hasConf;break;default:}}else{switch(M.action){case"remove":this.hasConf=false;if(this._cfgView){this._cfgView.destroy()}break;case"update":if(this.criterionButton){var K=this.criterionButton.dropdown.getItem("add_conf_criterion");if(K){K.elements.container.hide()}}else{if(this._createConfigBtn){this._createConfigBtn.disabled=true;this._createConfigBtn.active=false}}this.hasConf=M.hasConf;break;default:}}},_createVolume:function(K){if(!this._volumeView){var J=new m({criteriaType:"volume",state:"edit"});this.collection.add(J);this._volumeView=new w({filterId:this._filterId,appId:this.options.appId,widgetId:this.options.widgetId,childGroupId:this._childGroupId,model:J,sendEvent:(0!==K)?1:0,filterSpecId:this._groupId,volumeAvailable:this._isVolumeAvailable});if(this.criterionButton){var I=this.criterionButton.dropdown.getItem("add_volume_criterion");if(I){I.elements.container.hide()}}else{if(this._createVolumeBtn){this._createVolumeBtn.disabled=true;this._createVolumeBtn.active=false}}this._volumeView.render().inject(this.getElement(this._getCSSId(this._groupId)+">ul>.criterionButtonLi"),"before");this._addCriterionView(this._volumeView)}return this._volumeView},_removeGroup:function(){if(0!==this._subGroupId){this._onRemoveCriterion({idxView:this.cid,subgGroupId:this._subGroupId})}else{this.dispatchEvent("NGF_RemoveGroup",{groupId:this.cid,initFilterUI:1})}},destroy:function(){var K=this._listView.length;for(var J=K-1;J>=0;J--){var I=this._listView[J];if(undefined!==I&&null!==I){I.destroy()}}if(0===this._subGroupId){this._listView.splice(0,K);this._listViewId.splice(0,K);var L=this.collection.toArray();this.collection.remove(L);if(this._subscribe0){this._subscribe0.unsubscribe("NGFilter_VolumeDefined");this._subscribe0=undefined}this._volumeView=undefined;this.stopListening();this.model=null;this._parent();this.container=null}},_displayNotification:function(I){D.displayNotification(I)},_onRemoveCriterion:function(O){var N;if(0===this._subGroupId){N=this._listViewId.length;var L=this._listViewId.indexOf(O.idxView);if(-1!==L){var Q=this._listView[L].model;this.collection.remove(Q);this._listView.splice(L,1);this._listViewId.splice(L,1);N-=1}if(undefined!==O.hasConf){this.hasConf=O.hasConf;if(false===this.hasConf){if(this.criterionButton){var V=this.criterionButton.dropdown.getItem("add_conf_criterion");if(V){V.elements.container.show()}}else{if(this._createConfigBtn){this._createConfigBtn.disabled=false;this._createConfigBtn.active=true}}}}var J=this.collection.findWhere({criteriaType:"volume"});if(!J){if(this._subscribe0){this._subscribe0.unsubscribe("NGFilter_VolumeDefined");this._subscribe0=undefined}this._volumeView=undefined;if(this.criterionButton){var W=this.criterionButton.dropdown.getItem("add_volume_criterion");if(W){W.elements.container.show()}}else{if(this._createVolumeBtn){this._createVolumeBtn.disabled=false;this._createVolumeBtn.active=true}}}if(0===this._subGroupId){}var K=document.getElementsByClassName(".keepChildren");if(undefined!==K[0]){K.hide()}if(1===N){var S=this.collection.findWhere({criteriaType:"context"});if(S&&0===S.get("addedNodesLabels").length&&0===S.get("excludedNodesLabels").length){N=0}}this.dispatchEvent("NGF_UpdateApplySaveSaveAsState",{buttonsStatus:(N)?"ValidOK":"New"});this.dispatchEvent("NGF_AddSpecificationState",{})}else{var L=this._listViewId.indexOf(O.idxView);var U,P,I;if(-1!==L){I=[this._listView[L].model];U=L;P=1}else{I=this.collection.toArray();U=0;P=this._listView.length}this.collection.remove(I);this._listView.splice(U,P);this._listViewId.splice(U,P);var M=this._listView.length;if(0!==M){var R=this._listView[0].model.get("criteriaType");var T=this._listView[0].model.get("sequenceType");if("attribute"===R||("Sequence"===R&&"attribute"===T)){this._listView[0].setEnableKeepRemove(true)}if(1===this._listView.length){this.dispatchEvent("NGF_SwitchSequenceToCriterion",{idxView:this.cid,})}}else{this.dispatchEvent("NGF_RemoveCriterion",{idxView:O.idxView});this.stopListening();this.model=null;this._parent();this.container.getParent().remove()}}},_checkBeforeChangeState:function(){this.dispatchEvent("NGF_Criterion_ValidateEdited",{callback:this._switchCriterionState.bind(this)})},_switchCriterionState:function(I){var K=(D.isModelActivated(this.model))?"0":"1";this.model.set("isActivated",K);this.collection.setActivated(K);if(!I||(I&&false!==I.updateChildren)){this.collection.forEach(function(L){L.set("isActivated",K)})}if(0===this._subGroupId){this.dispatchEvent("NGF_SpecificationActivateChange",{viewId:this._getId()})}else{var J=this.getElement(this._getCSSId()+" .Sequence-read .subGroup-read-criterion");if(J){if("1"===K){J.removeClassName("f-criterion-deactivated")}else{J.addClassName("f-criterion-deactivated")}}}},_onActivateChange:function(M,J){var O=D.isModelActivated(M);var R=(O)?"deactivatedCriteria":"activatedCriteria";this._dropdownCtxMenu.getItem("activate-item-DDCtx").elements.container.getElement(".item-text").innerHTML=p.get(R);var N="fonticon fonticon-"+((O)?"eye-off":"eye");this._dropdownCtxMenu.getItem("activate-item-DDCtx").elements.container.getElement(".fonticon").className=N;if(0===this._subGroupId){var Q=this.getElement(this._getCSSId()+" .tree-v2");var P=this.getElement(this._getCSSId()+" .group-header");var I=P.getElement(".group-name");var L=this.getElement(".filter-applies");var S=this.getElement(".filter-groups-cmd");var K=1;if("1"===J){if(K){Q.removeClassName("f-group-deactivated");I.removeClassName("f-group-deactivated")}else{I.removeClassName("f-group-deactivated");L.removeClassName("f-group-deactivated");S.removeClassName("f-group-deactivated")}}else{if(K){Q.addClassName("f-group-deactivated");I.addClassName("f-group-deactivated")}else{I.addClassName("f-group-deactivated");L.addClassName("f-group-deactivated");S.addClassName("f-group-deactivated")}}}else{var P=this.getElement(this._getCSSId()+" .group-header2");if("1"===J){P.removeClassName("f-group-deactivated")}else{P.addClassName("f-group-deactivated")}}},_addCriterionView:function(I){this._listView.push(I);this._listViewId.push(I.cid);this._childGroupId++;this._initCriterionViewEvents(I)},_initCriterionViewEvents:function(J){this.listenTo(J,"NGF_RemoveCriterion",this._onRemoveCriterion.bind(this));this.listenTo(J,"NGF_Criterion_SwitchedToEdit",this._onEditCriterion.bind(this));this.listenTo(J,"NGF_Criterion_Validation",this.editReadMgt.bind(this));this.listenTo(J,"NGF_Criterion_ValidateEdited",this._checkBeforeEdit.bind(this));this.listenTo(J,"NGF_Criterion_Notification",this._displayNotification.bind(this));var K=this;var L=J.model.get("criteriaType");var I=J.model.get("sequenceType");if("attribute"===L||("Sequence"===L&&"attribute"===I)){this.listenTo(J,"NGF_AttrKeepToRemoveMode",function(){if(K._subGroupId){K._subGroupKeepRemoveMode=0;var N=K._listView.length;for(var M=1;M<N;M++){K._listView[M].initKeepRemove("Remove")}}this.dispatchEvent("NGF_AttrKeepToRemoveMode")});this.listenTo(J,"NGF_AttrRemoveToKeepMode",function(){if(K._subGroupId){K._subGroupKeepRemoveMode=1;var N=K._listView.length;for(var M=1;M<N;M++){K._listView[M].initKeepRemove("Keep")}}this.dispatchEvent("NGF_AttrRemoveToKeepMode")});if("attribute"===L){this.listenTo(J,"NGF_SwitchCriterionToSequence",this._onSwitchCriterionToSequence.bind(this));this.listenTo(J,"NGF_RefreshSynthesis",function(){K.dispatchEvent("NGF_RefreshSynthesis",{})});if(0!==this._subGroupId){this.listenTo(J,"NGF_Criterion_Activated",this._onCriterionActivated.bind(this))}}}},_filterViewFromModel:function(I,U,R){var J=false;this.switchToEdit();if(I.isActivated&&"0"===I.isActivated){this._switchCriterionState({updateChildren:true})}if(I.filterSpecificationName){this.updateFilterSpecificationName(I.filterSpecificationName)}for(var Q=0;Q<I.toFeedUI.length;Q++){var L=I.toFeedUI[Q];if(null!==L){var K=L.criteriaType;var T=null;if("attribute"===K){this.types=R;var M=[];for(var O=0;O<this.types.length;O++){M.push(this.types[O].name)}this._selectedTypeIndex=M.indexOf(L.type);T=this.createAttribute(this.types,"create",L,U[L.type],U[L.extension]);T.viewFromMdl(L)}else{if("config"===K){this._createConfig(L);T=this._cfgView;T.viewFromMdl(L);this._onConfigCriterionCB({hasConf:true,action:"update",model:L})}else{if("Sequence"===K){var S=L.sequenceType;if("attribute"===S){var N=L.allAttributes;var P={filterSpecificationName:this.collection.getFilterSpecificationName(),isActivated:"1",toFeedUI:N};if(N){T=this._createSubGroup(S);T._filterViewFromModel(P,U,R,J)}}}else{if("context"===K){if(this.contextMgmtView){T=this.contextMgmtView;this._updateContextFilterView(L)}}else{if("volume"===K){var V=0;T=this._createVolume(V);T.viewFromMdl(L)}else{if("tag"===K){J=true;this.createTagNGF(L);d.publish("NGFilter.updateTags",{appId:this.options.appId,widgetId:this.options.widgetId,tags:L.allfilters})}}}}}}if(null!==T){T.model.set("state","read")}}}return J},_createRefeshSynthesisButton:function(I){var L=new s(D.getAttributeButtonStyle("refresh"));L.inject((I)?I:this._Div);L.tooltipInfos=new i({shortHelp:p.get("RefreshSynthesisInfosTooltip"),mouseRelativePosition:false});var K="attribute-edit-button-style"+((D.TOUCH_MODE)?"":" filter-no-touch-mode");L.getContent().addClassName(K+" attributeCriterion-edit-refresh-btn");var J=this;L.addEventListener("click",function(M){J.dispatchEvent("NGF_RefreshSynthesis")});return L},_createAddAttributeSequenceButton:function(I){var L=new s(D.getAttributeButtonStyle("list-ordered"));L.inject(I);L.tooltipInfos=new i({shortHelp:p.get("addAttributeInSeqenceTooltip"),mouseRelativePosition:false});var K="attribute-edit-button-style"+((D.TOUCH_MODE)?"":" filter-no-touch-mode");L.getContent().addClassName(K+" attributeCriterion-edit-addSequence-btn");var J=this;L.addEventListener("click",function(Q){var O=(J._listView)?J._listView.length:0;var M=(O)?false:true;if(O){M=true;for(var N=0;N<O;N++){var P=J._listView[N];if(null!==P&&"edit"===P.model.get("state")){if(undefined===P._subGroupId||0===P._subGroupId){if(z.is(P.isCriterionValidate,"function")){M=P.isCriterionValidate();if(M){P.model.set("state","read")}}else{M=false;D.displayNotification({level:"error",message:p.get("NeedToValidateCrirerion")});break}}}}}if(M){J._addNewCriterion({type:"attribute"})}});return L},_createValidateButton:function(I){this._validateButton=new s(D.getAttributeValidateButtonStyle());this._validateButton.inject(I);this._validateButton.tooltipInfos=new i({shortHelp:p.get("validateAttributeSequenceCriterionTooltip"),mouseRelativePosition:false});var K="attribute-edit-button-style"+((D.TOUCH_MODE)?"":" filter-no-touch-mode");this._validateButton.getContent().addClassName(K+" attributeCriterion-edit-validate colorized");var J=this;this._validateButton.addEventListener("buttonclick",function(){var L=J.isCriterionValidate();if(L){J.dispatchEvent("NGF_Criterion_Validation",{criteriaType:J.model.get("criteriaType"),viewId:J._getCSSId()})}})},_createRenameFilterSpecLineEditor:function(){var J=new E({touchMode:D.TOUCH_MODE,placeholder:p.get("placeHolderFilterName")});J.value=this.collection.getFilterSpecificationName()||p.get("defaultGroupName");J.inject(this.getElement(".group-name"),"after");var I=this;J.addEventListener("focus",function(K){J.value=I.collection.getFilterSpecificationName()});J.addEventListener("change",function(K){I._onChangeOrBlurCB(K)});J.addEventListener("blur",function(K){I._onChangeOrBlurCB(K)});return J},_onChangeOrBlurCB:function(I){var J=I.dsModel.value;J=(""===J)?this._defaultSpecName:J;this.updateFilterSpecificationName(J)},updateFilterSpecificationName:function(I){this.collection.setFilterSpecificationName(I);this._filterSpecNameEditor.hide();var J=this.getElement(".group-name");J.setText(" "+I);J.show();this.dispatchEvent("NGF_UpdateSpecificationName",{name:I})},isViewEdited:function(){var I=this.collection.findWhere({state:"edit"});var J=("edit"===this.model.get("state"))?1:0;return(J||I)?true:false},updateUIWithDisplayDensity:function(P){var J=this.getElements(".f-attribute-container .attributeCriterion-edit")||[];var O=this.getElement(".Sequence-edit .subGroup-edit-actions");var K=J.concat(O||[]);if(O){if(0===P){O.addClassName("filter-no-touch-mode")}}var M=K.length;for(var Q=0;Q<M;Q++){var N=K[Q];if(N){if(0===P){var I=N.getElements("[touch-mode]");I.forEach(function(R){R.setAttribute("no-touch-mode","");R.removeAttribute("touch-mode")});var L=".attr-edit-inputs-Attribute-Master, .attr-edit-inputs-Attribute-Master .attribute-edit-command, .attributeCriterion-edit .attr-edit-inputs, .attributeCriterion-edit .attr-edit-actions, .attribute-edit-group-Combination, .attribute-edit-button-style";I=N.getElements(L);I.forEach(function(R){R.addClassName("filter-no-touch-mode")})}else{if(1===P){var I=N.getElements(".wux-controls-abstract");I.forEach(function(R){R.setAttribute("touch-mode","");R.removeAttribute("no-touch-mode")});var L=".filter-no-touch-mode";I=N.getElements(L);I.forEach(function(R){R.removeClassName("filter-no-touch-mode")})}}}}if(O){if(1===P){O.removeClassName("filter-no-touch-mode")}}},updateContextFilterView:function(J){var I=this;if(this.contextMgmtView){this.listenTo(this.contextMgmtView,"RepairFilter_updateRepairedPathsInUI",function(K){I.dispatchEvent("RepairFilter_updateRepairedPathsInUI",K)});this.contextMgmtView.updateFromRepair(J)}}});return e});define("DS/ENONextGenFilterUX/views/GlobalFilterView",["UWA/Class","UWA/Class/View","UWA/Core","UWA/Promise","UWA/Utils/InterCom","DS/WAFData/WAFData","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/Handlebars/Handlebars","text!DS/ENONextGenFilterUX/templates/globalViewTemplate.html","DS/ENONextGenFilterUX/views/StrDropView","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENONextGenFilterUX/utils/FilterPersistencyServices","DS/UIKIT/Spinner","DS/UIKIT/Tooltip","DS/ENONextGenFilterUX/views/GroupView","DS/ENONextGenFilterUX/views/FilterRepairView","DS/ENONextGenFilterUX/collections/FilterUIGlobalFilterCollection","DS/ENONextGenFilterUX/collections/FilterUIGroupCollection","DS/ENONextGenFilterUX/models/GroupModel","css!DS/ENONextGenFilterUX/ENONextGenFilterUX.css","DS/ENOFilterBIUX/NGFServices","DS/ENOFilterBIUX/FBIServices","DS/PlatformAPI/PlatformAPI","DS/TagNavigator/ActiveCriteria","DS/Windows/Dialog","DS/UIKIT/Modal","DS/Windows/ImmersiveFrame","DS/Controls/LineEditor","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ComboBox","DS/UIKIT/Mask","DS/WebappsUtils/WebappsUtils","DS/UIKIT/DropdownMenu","DS/UIKIT/Popover","DS/Controls/TooltipModel","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/UIKIT/Alert","DS/ENOFilterBIUX/FBIProxyServices","DS/Controls/Editor","DS/ENONextGenFilterUX/utils/FilterCollectionServices",],function(b,Q,F,q,N,n,t,L,H,c,j,i,u,y,f,G,m,A,O,K,k,g,r,C,h,a,D,e,J,R,w,z,I,l,x,E,B,s,o,d,p,M){var v="";var P=Q.extend({_filterACProxy:null,domEvents:{"click .applyFilterButtonLabel":"onApplyFilter","click .saveFilterButtonLabel":"onSaveFilter","click .saveAsFilterButtonLabel":"onSaveAsFilter","click .global-header-filtername":"_renameFilter","click .run_btn_search_filters":"_retrieveFilters",},setup:function(U){var V=this;this._template=L.compile(H);if(this.options.filterData){this._filterState="SaveOK";this._droppedFilterData=this.options.filterData}else{this._filterState="New"}this._appId=this.options.appId;this._appWidget=this.options.widget;this._filterId=this.options.filterId;this._appliedFilterName="";this._filterName="";this._types=null;this._rootID=U.rootID;this._rootAlias=U.rootAlias||"?";this._displayDensity=undefined;var T=sessionStorage.getItem("NGF_DisplayDensity");var S=(null===T)?1:Number(T);this._switchDisplayDensity(S);this._configUsed=U.configUsed||0;this._isVolumeAvailable=U.volumeUsed;this._filterToApply=U.filterToApply;this._listGroupView=[];this._listGroupViewId=[];this.nbGroupView=0;this.idxGFV=U.idxGFV;this.collection=new m(null,{appId:this._appId,widgetId:this._appWidget,model:this.model,});this.filterRepairView=new G({options:this.options,});this.listenTo(this.filterRepairView,"RepairFilter_UpdateContextUI",function(W){V._updateContextFilterModel_FromRepairPanel(W.data)});this.listenTo(this.filterRepairView,"NGF_CancelRepairFilter",function(W){V._onResetFilter();V._onACTrash()});this.IsFilterBroken=false;this._tenant=U.widgetTenant;this._tagData=U.tagData;this._arrayRootIDs=U.arrayRooIDs;z.mask(V.container);if(V._rootID){j.getPlatformServices(this._tenant).then(function(){i.retrieveFiltersForRoots(V._rootID).then(function(W){if(W.length){V._initFilterName();i.getDefaultFilterName(V._filterName).then(function(X){V._defaultFilterName=X;V._filterName=V._defaultFilterName;V._initFilterName();z.unmask(V.container);V.render(W.length)})}else{V.render(W.length)}})})}else{V.render(0)}if(this._filterACProxy===null){this._filterACProxy=C.setupActiveCriteria({id:"NGFilter",container:"FilterActiveCriteria_"+this._filterId,appId:this._appId,widgetId:this._appWidget,module:"DS/ENONextGenFilterUX/views/FilterActiveCriteria"});if(null!==this._filterACProxy){this._filterACProxy.addEvent("onTrashClick",this._onACTrash.bind(this));this._filterACProxy.addEvent("onCriteriaClick",this._onACCriteria.bind(this))}}this.listenTo(this.model,"onChange:state",this._onStateChange.bind(this));r.subscribe("NGFilter.RemoveFilter",this._onRemoveFilter.bind(this));r.subscribe("NGFilter.Redraw",this._onRedraw.bind(this));this._keepAttributeChildren=true;this._keepFilters={};if(sessionStorage.getItem("NGF_toggleWarningOverwrite")){this._toggleWarningOverwrite=sessionStorage.getItem("NGF_toggleWarningOverwrite")}else{sessionStorage.setItem("NGF_toggleWarningOverwrite",false)}this._toDisplay=this.options.display?this.options.display:true},checkBrokenFilter:function(){var T=this;var S=new q(function(U){T._checkFilter_RepairIfNeeded().then(function(V){var W={isBroken:T.IsFilterBroken,filterinfo:V};U(W)})});return S},render:function(S){var V=this;j.getPreferredSecurityContext().then(function(Y){V._preferredSC=Y;if(V._droppedFilterData){j.getExpandSynthesisInfos(V._getExpandContext(),k.getAppQueryParam()).then(function(Z){V._synthesisInfos=Z;V._initFilterGroup();V._buildViewFromDroppedFilter(V._droppedFilterData)},function(Z){V._initFilterGroup();V._buildViewFromDroppedFilter(V._droppedFilterData);V._buildSynthesisAlert()})}else{var X;j.getExpandSynthesisInfos(V._getExpandContext(),k.getAppQueryParam()).then(function(Z){V._synthesisInfos=Z;V.groupView.setSynthesisInfos(V._synthesisInfos)},function(Z){V._buildSynthesisAlert();V.groupView.setSynthesisInfos(undefined,V._alertSynthesisFailed)});V._initFilterGroup();V._onRedraw({filterId:V._filterId,widgetId:V._appWidget})}});this.container.setContent(this._template({attributeChildrenHiddenLabel:t.get("AttributeChildrenHidden"),applyFilterButtonLabel:t.get("applyFilterButtonLabel"),saveFilterButtonLabel:t.get("saveFilterButtonLabel"),saveAsFilterButtonLabel:t.get("saveAsFilterButtonLabel"),globalHeaderFilter:t.get("headerFilterTitle")}));this._initFilterName();var W=this.getElement(".global-header-filtername");if(W){new y({target:W,position:"bottom left",body:t.get("ClickToRenameFilter"),delay:{show:750}})}this._createRenameFilterUI();this.getElement(".global-header-filtername").innerHTML=this._filterName;this._createGlobalCtxMenu();this._createKeepAttributeChildrenUI();this._updateKeepAttributeChildrenUI(this._keepAttributeChildren);if(!S){V.getElement(".run_btn_search_filters").hide()}else{var T=V.getElement(".run_btn_search_filters.fonticon.fonticon-search-filter");if(T){new y({position:"top",target:T,body:t.get("WarnExistingFilters")+"<p>"+t.get("ReuseExistingFilter")+"</p>"})}}this._divCombination=this._createCombination();this._divCombination.hide();var U=this.getElement("#filter-groups-cmd");this._addNewSpecBtn=this._createNewSpecificationBtn(U);this._addExisitingSpecBtn=this._createExistingSpecificationBtn(U);if(!S){this._addExisitingSpecBtn.disabled=true}this._addNewSpecBtn.hide();this._addExisitingSpecBtn.hide();sessionStorage.setItem("NGF_isUXBuilt_"+this._rootID,true);return this},_buildSynthesisAlert:function(S){var T=this;if(!this._alertSynthesisFailed){this._alertSynthesisFailed=new o({visible:true,events:{onClick:function(){T._removeSynthesisAlert()},}});this._alertSynthesisFailed.inject(this.getElement(".global-header"),"before")}var U=t.get("ExpandSynthesisFailed")+"<a> ("+t.get("RefreshSynthesis")+")</a>";this._alertSynthesisFailed.add({className:"primary",message:U});this._alertSynthesisFailed.getContent().getElement("a").addEventListener("click",function(V){T._refreshSynthesisInfos(S||true)});this._alertSynthesisFailed.hide()},_removeSynthesisAlert:function(){if(this._alertSynthesisFailed&&this._alertSynthesisFailed.isVible){this._alertSynthesisFailed.getContent().remove();this._alertSynthesisFailed.destroy();this._alertSynthesisFailed=undefined}},_buildViewFromDroppedFilter:function(T){var S=this;this.retrieveFilter=false;this.droppedFilter=true;this._filterState="SaveOK";S.setGlobalButtonsStatus(this._filterState);if(this.groupView){this.groupView.setFilterState(this._filterState)}this._checkFiltersToKeep(T).then(function(V){S._keepFilters=V;var Y=T.length;for(var X=0;X<Y;X++){var W=T[X].filterName;var U=X;j.checkAndGetListOfAttributesFromSelectedFilter(S._keepFilters[W]).then(function(Z){S.groupView.setFilterState(S._filterState);S.groupView.setSynthesisInfos(S._synthesisInfos);S._buildFilterUIFromSelectedFilter(W,Z,j.getTypesOfSynthesis(S._synthesisInfos));S._updateFilterNameUI(W);if((Y-1)===U){S._updateCombinationCombo();S._updateAddSpecificationButton()}});if(!S.options.fromDropOnFilter){S._updateActiveCriteria(W,true);S._filterApplied=true}}})},_initFilterName:function(){if(!this._defaultFilterName){this._defaultFilterName=t.get("defaultFilterName")+"-"+this.idxGFV}this._filterName=this._defaultFilterName},_initFilterGroup:function(){this.addGroupView();this._applyFilterButton=this.getContent().getElementsByClassName("applyFilterButtonLabel")[0];this._saveFilterButton=this.getContent().getElementsByClassName("saveFilterButtonLabel")[0];this._saveAsFilterButton=this.getContent().getElementsByClassName("saveAsFilterButtonLabel")[0];this._applyFilterButton.disabled=true;this._saveFilterButton.disabled=true;this._saveAsFilterButton.disabled=true},addGroupView:function(){var T=new A([],{widgetId:this._bodyContainer,});this.groupView=new f({appId:this._appId,widgetId:this._appWidget,collection:T,groupId:this.nbGroupView,rootID:this._rootID,rootAlias:this._rootAlias,model:new O({}),conf:this._configUsed,filterId:this._filterId,synthesisInfos:this._synthesisInfos,securityContext:this._preferredSC,volumeAvailable:this._isVolumeAvailable,filterToApply:this._filterToApply,tagData:this._tagData,});this.nbGroupView+=1;this.groupView.render().inject(this.getElement("#filter-groups"));this.collection.addGroupCollection(T);this.listenTo(this.groupView,"NGF_AttrKeepToRemoveMode",function(){if(false===this._checkDisplayKeepChildren()){this._updateKeepAttributeChildrenUI()}});this.listenTo(this.groupView,"NGF_AttrRemoveToKeepMode",function(){this._updateKeepAttributeChildrenUI(this._keepAttributeChildren)});var U=this;this.listenTo(this.groupView,"NGF_RefreshSynthesis",function(){if(U._isFilterValid()){U._refreshSynthesisInfos(true)}else{j.displayNotification({level:"warning",message:t.get("RefreshOnCriteriaNotValid")})}});this._listGroupView.push(this.groupView);this._listGroupViewId.push(this.groupView.cid);this.listenTo(this.groupView,"NGF_RemoveGroup",this._onRemoveGroup.bind(this));this.listenTo(this.groupView,"NGF_Criterion_ValidateEdited",this.validateEditedCriterion.bind(this));this.listenTo(this.groupView,"NGF_Group_SwitchedToEdit",this._onEditGroup.bind(this));this.listenTo(this.groupView,"NGF_AddSpecificationState",this._updateAddSpecificationButton.bind(this));this.listenTo(this.groupView,"NGF_UpdateSpecificationName",this._buildCombinationComboWithMinusAndSpec.bind(this));this.listenTo(this.groupView,"NGF_UpdateApplySaveSaveAsState",this._updateApplySaveSaveAsState.bind(this));this.listenTo(this.groupView,"NGF_SpecificationActivateChange",this._onSpecificationStateChange.bind(this));var S=this._listGroupView.length;if(1<S){this._listGroupView.forEach(function(W){W.setDeactivateVisible(true)});if(this._divCombination){this._divCombination.show()}}if(this._tagData){var V;if(Object.keys(this._tagData.allfilters).length||Object.keys(this._tagData.localfilters).length){V=this.collection.buildCVQuery(this._rootID,this._keepAttributeChildren.toString())}else{V=this._buildEmptyFilter()}this._applyFilter(this._appliedFilterName,V,false);this._tagData=undefined}this._filterToApply=undefined;if(1<S){}},_refreshSynthesisInfos:function(V,Z){var U=(undefined===Z)?true:Z;if(U){z.mask(this.container)}var W=this;var X=function(aa){W._synthesisInfos=aa;W._listGroupView.forEach(function(ab){ab.setSynthesisInfos(W._synthesisInfos)});if(U){z.unmask(W.container)}W._removeSynthesisAlert()};var T=function(ab,aa){if(aa){z.unmask(W.container)}W._buildSynthesisAlert(ab);W._alertSynthesisFailed.show()};if(V){var S=this.collection.buildCVQuery(this._rootID,this._keepAttributeChildren);var Y=d.completeCVQueryWithAppParams(JSON.parse(S),undefined,false);j.refreshExpandSynthesisInfos(this._getExpandContext(),Y.CVQuery).then(function(aa){X(aa)},function(aa){T(V,U)})}else{j.getExpandSynthesisInfos(this._getExpandContext(),k.getAppQueryParam()).then(function(aa){X(aa)},function(aa){T(V,U)})}},_setKeepChildrenItemVisibilty:function(T,U){var S=this._dropdownCtxMenu.getItem("global-HideAttributeChildren-item-DDCtx").elements.container;var V=(T)?S.show():S.hide();S=this._dropdownCtxMenu.getItem("global-ShowAttributeChildren-item-DDCtx").elements.container;V=(U)?S.show():S.hide()},_checkDisplayKeepChildren:function(){var S=false;for(var V=0;V<this.collection._groupCollectionArray.length;V++){var U=this.collection._groupCollectionArray[V]._models;for(var T=0;T<U.length;T++){if("attribute"===U[T].get("criteriaType")){if(true===U[T].get("Keep")){S=true;break}}}}return S},_onSelectObject:function(S){this._rootID=S.rootID;this._rootAlias=S.rootAlias;if(this.groupView){this.groupView._rootID=this._rootID;this.groupView._rootAlias=this._rootAlias}if(this.getElement(".filter-applies")){this.getElement(".filter-applies-root").setContent(this._rootAlias)}},onSaveFilter:function(){var T=(this.groupView&&"edit"===this.groupView.model.get("state"))?1:0;var S=(T)?this.validateEditedCriterion():true;if(S){var V=this.collection.buildCVQuery(this._rootID,this._keepAttributeChildren,false);var U=this.collection.keepComponentsToFeedUI(this._rootID,this._keepAttributeChildren);if("ValidOK"===this._filterState){this._displayRenameDialogAndCreateFilter("SaveTitle",V,U)}else{this._checkFilterNameAndUpdateFilter(this._filterName,V,U)}}this.groupView.switchToEdit()},onSaveAsFilter:function(){var T=(this.groupView&&"edit"===this.groupView.model.get("state"))?1:0;var S=(T)?this.validateEditedCriterion():true;if(S){var V=this.collection.buildCVQuery(this._rootID,this._keepAttributeChildren);var U=this.collection.keepComponentsToFeedUI(this._rootID,this._keepAttributeChildren);this._displayRenameDialogAndCreateFilter("SaveAsTitle",V,U)}this.groupView.switchToEdit()},_checkFilterNameAndUpdateFilter:function(T,V,S){var U=this;this._getListSecurityContext().then(function(W){U._NGFDefaultSC=sessionStorage.getItem("NGF_selectedSecurityContext");i.checkExistingFilterName(T).then(function(Z){if(true===Z){var aa=(U._keepFilters[T])?U._keepFilters[T].filterDescription:"";if("false"===sessionStorage.getItem("NGF_toggleWarningOverwrite")){var Y=new F.Element("div",{html:"<p>"+t.get("OverwriteExistingFilter")+"</p><p>"+t.get("ProceedValidation")+"</p>"});U.renameUIModal=new a({header:t.get("SaveTitle"),className:"site-reset",closable:true,body:Y,footer:'<button type="button" class="btn btn-primary">'+t.get("SaveButton")+'</button> <button type="button" class="btn btn-default">'+t.get("CancelSaveUI")+"</button>"}).inject(document.body);U.renameUIModal.show();U.renameUIModal.getContent().getElements(".btn-primary").forEach(function(ab){ab.addEvent("click",function(){U._updateFilter(U._NGFDefaultSC,T,aa,V,S).then(function(ac){if(ac){U.renameUIModal.hide()}})})});U.renameUIModal.getContent().getElements(".btn-default").forEach(function(ab){ab.addEvent("click",function(){U.renameUIModal.hide()})});var X=new R({label:t.get("DoNotShowAgain"),checkFlag:false});X.inject(Y);X.addEventListener("buttonclick",function(ab){U._toggleWarningOverwrite=true;sessionStorage.setItem("NGF_toggleWarningOverwrite",U._toggleWarningOverwrite)})}else{U._updateFilter(U._NGFDefaultSC,T,filtreDescription,V,S)}}else{j.displayNotification({level:"info",message:t.get("SaveExistingNoNewName")})}})})},_displayRenameDialogAndCreateFilter:function(aa,U,W){var Y=this;var Z=new F.Element("div",{});var T=new F.Element("div",{"class":"wux-element-Save-filterName",html:"<p>"+t.get("FilterNameToSave")+"</p>"}).inject(Z,"top");var V=new e({touchMode:j.TOUCH_MODE,placeholder:t.get("placeHolderFilterName"),domId:"SaveName"});V.value=this._filterName;V.inject(T);i.getDefaultFilterName(this._filterName).then(function(ag){V.value=ag?ag:Y._filterName;X=V.value;V.addEventListener("focus",function(ah){if(Y.emptyName){Y.emptyName.hide()}if(Y.badCharacters){Y.badCharacters.hide()}if(Y.saveUIModal){Y.saveUIModal.getContent().getElement("#SaveName").removeClassName("attr-edit-inputs-Attribute-Error")}});V.addEventListener("change",function(ah){if(Y.saveUIModal){Y.saveUIModal.getContent().getElements(".btn-primary")[0].disabled=false}X=ah.dsModel.value;if(X){i.checkExistingFilterName(X).then(function(ai){if(ai){Y.saveUIModal.getContent().getElement("#SaveName").addClassName("attr-edit-inputs-Attribute-Error");j.displayNotification({level:"info",message:t.get("FilterNameAlreadyUsed")});if(Y.saveUIModal){Y.saveUIModal.getContent().getElements(".btn-primary")[0].disabled=true}}});if(false===j.checkForBadCharacters(X)){Y.saveUIModal.getContent().getElement("#SaveName").addClassName("attr-edit-inputs-Attribute-Error");Y.badCharacters=new F.Element("div",{"class":"wux-control-inline-saveName",html:"<p>"+t.get("BadCharactersInFilterName")+"</p><p>"+t.get("BadCharacters")+"</p>"+j.NAME_RULES.notAllowedChars}).inject(Y.saveUIModal.getContent().getElement("#SaveName"),"bottom");if(Y.saveUIModal){Y.saveUIModal.getContent().getElements(".btn-primary")[0].disabled=true}}}else{Y.saveUIModal.getContent().getElement("#SaveName").addClassName("attr-edit-inputs-Attribute-Error");Y.emptyName=new F.Element("div",{"class":"wux-control-inline-saveName",html:"<p>"+t.get("FilterNameMustBeFeed")+"</p>"}).inject(Y.saveUIModal.getContent().getElement("#SaveName"),"bottom");if(Y.saveUIModal){Y.saveUIModal.getContent().getElements(".btn-primary")[0].disabled=true}}})});var af;var S=128;if(1===i.FILTER_DESCRIPTION){if(1===i.NEW_SAVE){var ae=new F.Element("div",{"class":"wux-element-Save-filterName",html:"<p>"+F.String.format(t.get("FilterDescriptionToSave"),S)+"</p>"});ae.inject(Z);var ad=t.get("FilterDescriptionToSavePlaceHolder");af=new e({touchMode:j.TOUCH_MODE,placeholder:ad,displayClearFieldButtonFlag:false,domId:"SaveDescription"});var ab=af.getContent().getElement('[placeholder="'+ad+'"]');if(ab){ab.addClassName("wux-element-Save-Description");ab.addEventListener("change",function(ah){var ai=ah.target;var ag=ai.value.slice(0,S-1);if(undefined===ai.tooltipInfos){ai.tooltipInfos=new E({shortHelp:ag,mouseRelativePosition:false})}else{ai.tooltipInfos.shortHelp=ag}})}af.value=(this._keepFilters[this._filterName])?this._keepFilters[this._filterName].filterDescription:"";af.inject(ae)}}var ac=new F.Element("div",{"class":"wux-element-Save-SecurityContext",html:"<p>"+t.get("getCurrentSecurityContext")+"</p>"}).inject(Z,"bottom");this._getListSecurityContext().then(function(ah){Y._securityContextCombo=new w({touchMode:j.TOUCH_MODE,elementsList:ah,enableSearchFlag:false,selectedIndex:0}).inject(ac,"bottom");Y._selectedSecurityContext=Y._securityContextCombo.currentValue;Y._securityContextCombo.addEventListener("change",function ag(aj){var ai=aj.dsModel.currentValue;Y._selectedSecurityContext=ai;Y._NGFDefaultSC=Y._selectedSecurityContext;sessionStorage.setItem("NGF_selectedSecurityContext",Y._NGFDefaultSC)});Y._NGFDefaultSC=Y._selectedSecurityContext;sessionStorage.setItem("NGF_selectedSecurityContext",Y._NGFDefaultSC)});var X=this._filterName;this.saveUIModal=new a({className:"site-reset",closable:true,header:t.get(aa),body:Z,footer:'<button type="button" class="btn btn-primary">'+t.get("SaveButton")+'</button> <button type="button" class="btn btn-default">'+t.get("CancelSaveUI")+"</button>"}).inject(document.body);Y.saveUIModal.show();this.saveUIModal.getContent().getElements(".btn-primary").forEach(function(ag){ag.addEvent("click",function(){if(X){Y._filterState="New";var ah=(af)?af.value.slice(0,S-1):"";Y._saveFilter(Y._NGFDefaultSC,X,ah,U,W).then(function(ai){if(ai){Y._filterState="SaveOK";Y.setGlobalButtonsStatus(Y._filterState);Y.groupView.setFilterState(Y._filterState);Y.saveUIModal.hide()}else{Y._filterState="ValidOK";Y.setGlobalButtonsStatus(Y._filterState);Y.groupView.setFilterState(Y._filterState)}})}else{Y.saveUIModal.getContent().getElement("#SaveName").addClassName("attr-edit-inputs-Attribute-Error");Y.saveUIModal.hide()}})});this.saveUIModal.getContent().getElements(".btn-default").forEach(function(ag){ag.addEvent("click",function(){Y.saveUIModal.hide();Y.setGlobalButtonsStatus(Y._filterState)})});return this.saveUIModal},_getListSecurityContext:function(){var S=this;return new q(function(U,T){if(sessionStorage.getItem("NGF_listSecurityContext")){S._listSecurityContext=JSON.parse(sessionStorage.getItem("NGF_listSecurityContext"));U(S._listSecurityContext)}else{j.getAllSecurityContexts().then(function(X){S._NGFDefaultSC="";var W=[];var Y=X.cspaces;if(Array.isArray(Y)){for(var V=0;V<Y.length;V++){W[V]={labelItem:Y[V].label,valueItem:Y[V].value};if(S._preferredSC===Y[V].label){S._NGFDefaultSC=Y[V].value}}}S._listSecurityContext=JSON.stringify(W);sessionStorage.setItem("NGF_listSecurityContext",S._listSecurityContext);if(S._NGFDefaultSC){sessionStorage.setItem("NGF_selectedSecurityContext",JSON.stringify(S._NGFDefaultSC))}U(W)})}})},onApplyFilter:function(){var T=(this.groupView&&"edit"===this.groupView.model.get("state"))?1:0;var S=(T)?this.validateEditedCriterion():true;if(S){this._refreshSynthesisInfos(false,false);var U=this.collection.buildCVQuery(this._rootID,this._keepAttributeChildren);this._applyFilter(this._filterName,U,false);v=this._filterId;this._appliedFilterName=this._filterName}this.groupView.switchToEdit()},_computeFilterId:function(S){var T=S.appId+"_"+this.widgetId;T=S.appId;return T},_onRemoveFilter:function(W){var X=this._computeFilterId(W);if(X){var V=0;if(W.rootIds){var U=(Array.isArray(W.rootIds))?W.rootIds:[W.rootIds];for(var T=0;T<U.length;T++){var S=X+"_"+U[T];if(S===this._filterId){V=1;break}}}else{V=(-1!==this._filterId.indexOf(X))?1:V}if(V){this._resetFilter();this._updateActiveCriteria("",false)}}},_emptyFilter:function(W){var V=this._listGroupView.length;if(0!==V){var T=(W&&W.initFilterUI)?W.initFilterUI:undefined;for(var S=V-1;S>=0;S--){var U=this._listGroupView[S];if(undefined!==U&&null!==U){this._removeGroup({groupId:U.cid,},T)}}}this._addNewSpecBtn.hide();this._addExisitingSpecBtn.hide();this._filterState="New";if(this.groupView){this.groupView.setFilterState(this._filterState)}this.setGlobalButtonsStatus(this._filterState)},_saveFilter:function(S,U,X,Y,T){var W=this;var V=new q(function(aa,Z){i.saveFilter(S,U,X,W._rootID,Y,T).then(function(ab){if(ab&&ab.filter){if(ab.filter[0].filterName){j.displayNotification({level:"success",message:t.get("FilterCreationSuccessfull")});W._updateFilterName(U);aa(true)}else{j.displayNotification({level:"error",message:t.get("FilterCreationFailed")});aa(false)}}else{j.displayNotification({level:"error",message:t.get("FilterUpdateFailed")});aa(false)}})});return V},_updateFilter:function(S,U,X,Y,T){var W=this;var V=new q(function(aa,Z){i.updateFilter(S,U,X,Y,T).then(function(ab){if(ab&&ab.filter){if(ab.filter[0]&&ab.filter[0].filterName){j.displayNotification({level:"success",message:t.get("FilterUpdateSuccessfull")});W._updateFilterName(U);aa(true)}else{j.displayNotification({level:"error",message:t.get("FilterUpdateFailed")});aa(false)}}else{j.displayNotification({level:"error",message:t.get("FilterUpdateFailed")});aa(false)}})});return V},_applyFilter:function(T,W,V){var U=this;var X=true;if(false!==this._toDisplay){this._updateActiveCriteria(T,X)}if(W){W=UWA.is(W,"string")?JSON.parse(W):W}var S={empty:V,appId:U._appId,widget:U._appWidget,CVQuery:W.CVQuery,CVQuery3D:W.CVQuery3D,filterRootIds:[U._rootID],filterName:T};r.publish("onApplyNGFilter",S);this._filterApplied=true},_onRedraw:function(S){if(this._filterACProxy&&this._filterId===S.filterId){if(!this.IsFilterBroken||this.IsFilterBroken===undefined){this._filterACProxy.redrawCriteria({proxyId:this._filterId,widgetId:S.widgetId})}v=this._filterId}},_updateActiveCriteria:function(T,V){if(this._filterACProxy!==null){var U={filterName:T,appId:this._appId,widgetId:this._appWidget,widgetIdent:this._filterId};var S={proxyId:this._filterId};this._filterACProxy.setActiveCriteria(U,S);if(true===V){this._filterACProxy.redrawCriteria(S)}else{if(F.is(this._filterACProxy.getDisplayStatus,"function")&&true===this._filterACProxy.getDisplayStatus()){this._filterACProxy.redrawCriteria(S)}}}},_buildEmptyFilter:function(){var U='"CVQuery":{"root_physicalid":"'+this._rootID+'"}';var T=U;T=T.replace('"CVQuery"','"CVQuery3D"');T=T.replace('"expand"','"expand3d"');var S="{"+U+","+T+"}";return S},_onACTrash:function(S){if(v===this._filterId){this._onACEvent()}},_onACCriteria:function(S){if(S&&-1!==S.indexOf(this._filterName)){this._onACEvent()}},_onACEvent:function(){this._appliedFilterName="";this._applyFilter(this._appliedFilterName,this._buildEmptyFilter(),true);v="";if(this.groupView){this.groupView.setFilterState(this._filterState)}sessionStorage.setItem("NGF_tagMgtRunning_"+this._rootID,false);this._filterApplied=false},_onResetFilter:function(){this._resetFilter({initFilterUI:1})},_resetFilter:function(T){var S=(T&&T.widgetIdent)?T.widgetIdent:this._filterId;if(this._filterId===S){this._emptyFilter(T)}this._filterState="New";if(this.groupView){this.groupView.setFilterState(this._filterState)}this.setGlobalButtonsStatus(this._filterState);this._updateFilterNameUI(this._defaultFilterName)},_onRemoveGroup:function(S){this._removeGroup(S,S.initFilterUI)},_removeGroup:function(Y,T){var S=this._listGroupViewId.indexOf(Y.groupId);if(-1!==S){var W=this._listGroupView[S];this._listGroupView.splice(S,1);this._listGroupViewId.splice(S,1);var V=W.collection;this.collection.removeGroupCollection(V);W.destroy();var Z=this._listGroupView.length;if(0!==Z){this.groupView=this._listGroupView[Z-1];if(1===Z){if(j.isModelActivated(this.groupView.model)){this.groupView.setDeactivateVisible(false)}this.groupView.switchToEdit();if(this._divCombination){this._divCombination.hide()}}}else{var U=this.getElement("#filter-groups");if(null!==U){while(U.hasChildNodes()){U.removeChild(U.firstChild)}}delete this.groupView;this.nbGroupView=0;if(1===T){this.getElement(".global-header-filtername").innerHTML=this._defaultFilterName;sessionStorage.removeItem("FBI_droppedFilters");this._updateFilterNameUI(this._defaultFilterName);this._filterState="New";if(this.groupView){this.groupView.setFilterState(this._filterState)}this.setGlobalButtonsStatus(this._filterState);var X=this;j.getExpandSynthesisInfos(this._getExpandContext(),k.getAppQueryParam()).then(function(aa){X._synthesisInfos=aa;X._initFilterGroup()},function(aa){X._buildSynthesisAlert();X._initFilterGroup()})}}this._buildCombinationComboWithMinusAndSpec();this._updateCombinationCombo();this._updateAddSpecificationButton()}},_renameFilter:function(){if("SaveOK"!==this._filterState){this.model.set("state","edit")}else{j.displayNotification({level:"info",message:t.get("UseSaveAsToRenameExistingFilter")})}},_onStateChange:function(S,T){if("edit"===T){this.getElement(".global-header").addClassName("global-header-edit");if(null!==this._renameFilterLineEditor){this._renameFilterLineEditor._giveFocus()}}else{this.getElement(".global-header").removeClassName("global-header-edit");this.getElement(".global-header-name").removeClassName("global-header-edit")}},_createRenameFilterUI:function(){this._renameFilterLineEditor=this._createRenameFilterLineEditor()},_createRenameFilterLineEditor:function(){var S=this;var T=new e({touchMode:j.TOUCH_MODE,placeholder:t.get("placeHolderFilterName")});T.value=S._defaultFilterName;T.inject(this.getElement(".global-header-filtername"),"after");T.addEventListener("focus",function(U){if(!S._renameFilterLineEditor.getContent().hasClassName("attr-edit-inputs-Attribute-Error")){S._renameFilterLineEditor.value=S._filterName}});T.addEventListener("change",function(V){var U=V.dsModel.value;if(true===j.checkForBadCharacters(U)){S._updateFilterName(U);S._renameFilterLineEditor.getContent().removeClassName("attr-edit-inputs-Attribute-Error")}else{j.displayNotification({level:"error",message:UWA.String.format(t.get("InvalidCharacters"),j.NAME_RULES.notAllowedChars.join(" "))});S._renameFilterLineEditor.getContent().addClassName("attr-edit-inputs-Attribute-Error")}});T.addEventListener("blur",function(V){var U=V.dsModel.value;if(true===j.checkForBadCharacters(U)){S._updateFilterName(U);S._renameFilterLineEditor.getContent().removeClassName("attr-edit-inputs-Attribute-Error")}else{S._renameFilterLineEditor.getContent().addClassName("attr-edit-inputs-Attribute-Error");S._renameFilterLineEditor._giveFocus()}});return T},_updateFilterName:function(S){this._updateFilterNameUI(S);this._updateActiveCriteria(this._filterName,false);this.model.set("state","read")},_updateFilterNameUI:function(S){var T;if("New"===this._filterState){T=(0!==S.length)?S:this._defaultFilterName}else{T=S}this._filterName=T;this.getElement(".global-header-filtername").innerHTML=T},_createGlobalCtxMenu:function(){if(this._ctxMenu){return}var S=[{id:"global-renameFilter-item-DDCtx",text:t.get("RenameFilterItem"),fonticon:"pencil",handler:this._renameFilter.bind(this)},{id:"global-HideAttributeChildren-item-DDCtx",text:t.get("HideAttributeChildrenItem"),fonticon:"flow-children-eye-off",handler:this._onKeepAttributeChildren.bind(this)},{id:"global-ShowAttributeChildren-item-DDCtx",text:t.get("ShowAttributeChildrenItem"),fonticon:"flow-children-eye",handler:this._onKeepAttributeChildren.bind(this)},{id:"global-reset-item-DDCtx",text:t.get("ResetFilterItem"),fonticon:"reset",handler:this._onResetFilter.bind(this),}];S.push({className:"divider"},{text:t.get("DisplayDensityItem"),className:"header"},{id:"global-density-comfortable-item2-DDCtx",text:t.get("DisplayDensityComfortableItem"),fonticon:"view-big-tile",handler:this._switchDisplayDensityToComfortable.bind(this),selectable:true,selected:(1===this._displayDensity)?true:false},{id:"global-density-compact-item2-DDCtx",text:t.get("DisplayDensityCompactItem"),fonticon:"view-list",handler:this._switchDisplayDensityToCompact.bind(this),selectable:true,selected:(0===this._displayDensity)?true:false});this._dropdownCtxMenu=new l({target:this.getElement(".globalHeaderDropDown"),items:S})},_createKeepAttributeChildrenUI:function(){this._showKeepAttrChildren=new J({touchMode:j.TOUCH_MODE,displayStyle:"lite",label:t.get("ShowAttributeChildren"),id:"ShowKeepAttrChildren"});this._showKeepAttrChildren.inject(this.getElement("#keepAttributeChildren"));this._showKeepAttrChildren.getContent().addClassName("keepAttributeChildrenShowButton");var S=this;this._showKeepAttrChildren.addEventListener("buttonclick",function(T){S._onKeepAttributeChildren()})},_onKeepAttributeChildren:function(){this._keepAttributeChildren=(true===this._keepAttributeChildren)?false:true;this.model.set("isKeepChildrenChecked",this._keepAttributeChildren);this._updateKeepAttributeChildrenUI(this._keepAttributeChildren)},_updateKeepAttributeChildrenUI:function(S){if(undefined===S){this.getElement("#keepAttributeChildren").hide();this._setKeepChildrenItemVisibilty(false,false)}else{if(true===S){this.getElement("#keepAttributeChildren").hide();this._setKeepChildrenItemVisibilty(true,false)}else{this.getElement("#keepAttributeChildren").show();this._setKeepChildrenItemVisibilty(false,true)}}},_buildFilterUIFromSelectedFilter:function(ae,Y,X){var aa=this;if(!aa._NGFDefaultSC){j.getPreferredSecurityContext().then(function(ak){aa._preferredSC=ak;aa._NGFDefaultSC=ak;sessionStorage.setItem("NGF_selectedSecurityContext",aa._preferredSC)})}var Z=this._keepFilters[ae];var ac=k.getFilterSpecifications(Z);var aj=ac.length;var V=ac[0].toFeedUI.combinationOfSpecification||"union";V+=("minus"===V)?("-"+ac[0].toFeedUI.minusIndex):"";var ab=1;var ad=false;for(var ai=ab;ai<aj;ai++){var ah=this.groupView._filterViewFromModel(ac[ai],Y,X,ad);if(ah){ad=true}if(ai!==aj-1){var U=this._listGroupView.length-1;this._listGroupView[U].model.set("state","read");this.addGroupView()}}if(aa.IsFilterBroken){z.mask(aa.container);var W=new F.Element("div",{html:"<p>"+t.get("BrokenFilterWarning")+"</p>"});var S=new a({header:t.get("RepairFilterTitle"),className:"site-reset",closable:true,body:W,footer:'<button type="button" class="repair-solve btn btn-primary">'+t.get("SolveButton")+'</button> <button type="button" class="repair-cancel btn btn-default">'+t.get("CancelSolveUI")+"</button>"}).inject(document.body);S.show();S.getContent().getElement(".repair-solve").addEvent("click",function(){S.hide();aa.BrokenPathForRender=aa.filterRepairView._createJSONForRepairWebservice();j.getAllSecurityContexts().then(function(ak){aa.optionsWebservice={url:j.getPlatformUrlAccordingToTenant()["3DSpace"],ctx:ak.securityContext};if(document.querySelector(".f-globalFilter-container")!=null){aa.filterRepairView.logWebServiceOptions(aa.optionsWebservice);aa.filterRepairView.fetchRepairedPathsFromWebService(aa.BrokenPathForRender).then(function(am){if(am!="RepairFilterFetchData_FAILURE"){var an=document.querySelector(".f-globalFilter-container");var al=an.querySelector(".globalEdit-container");var ao=aa.filterRepairView.render();al.empty();ao.getContent().inject(al)}z.unmask(aa.container)})}});aa._onRedraw({filterId:aa.options.filterId,widgetId:aa.options.widget});aa._onACTrash();if(aa.droppedFilter){r.publish("Frame3DXInfra.Open",{id:aa.options.filterId})}});S.getContent().getElement(".repair-cancel").addEvent("click",function(){z.unmask(aa.container);S.hide();aa._onRedraw({filterId:aa.options.filterId,widgetId:aa.options.widget});if(aa.droppedFilter){r.publish("Frame3DXInfra.Open",{id:aa.options.filterId})}aa._onResetFilter();aa._onACTrash()})}if(this._combinationCombo){this._combinationCombo.currentValue=V}var T=this.collection._groupCollectionArray.length;if(1===T){var ag=ac[0].toFeedUI.keepChildren;if(undefined!==ag&&(this._keepAttributeChildren!==ag)){this._onKeepAttributeChildren()}}if(ad){var af=this.collection.buildCVQuery(this._rootID,this._keepAttributeChildren.toString());this._appliedFilterName=ae;this._applyFilter(this._appliedFilterName,af,false)}},_cancelSearch:function(S){r.publish("Frame3DXInfra.Update",{type:"Filter",display:true,options:S})},_checkFiltersToKeep:function(U){var T=this;this._keepFilters={};this._keepFilterNames=[];function V(X){if(1===i.NEW_SAVE){X.forEach(function(Y){if(!T._keepFilters[Y.filterName]){T._keepFilters[Y.filterName]={}}T._keepFilters[Y.filterName].rootPhysicalId=Y.rootPhysicalId;T._keepFilters[Y.filterName].filterUIComponents=Y.filterUIComponents;T._keepFilters[Y.filterName].filterDescription=Y.filterDescription;T._keepFilterNames.push(Y.filterName);M.buildCVQueryFromModel(Y);T._keepFilters[Y.filterName].filterCVQuery=Y.filterCVQuery})}else{for(var W=0;W<X.length;W++){if(!T._keepFilters[X[W].filterName]){T._keepFilters[X[W].filterName]={}}T._keepFilters[X[W].filterName].rootPhysicalId=X[W].rootPhysicalId;T._keepFilters[X[W].filterName].filterCVQuery=X[W].filterCVQuery;T._keepFilters[X[W].filterName].filterUIComponents=X[W].filterUIComponents}}}var S=new q(function(W){if(UWA.is(U,"array")&&UWA.is(U[0],"object")){V(U);W(T._keepFilters)}else{g.getPlatformServices(T._tenant).then(function(){k.getAllDataFromFilterIds(U,T._tenant).then(function(X){V(X.success);if(T.retrieveFilter){T._checkFilter_RepairIfNeeded().then(function(){W(T._keepFilters)})}else{W(T._keepFilters)}})})}});return S},_retrieveFilters:function(S,W){var V=this;V.retrieveOptions=W;var U=1;var T=1;this.retrieveFilter=true;this.droppedFilter=false;j.getPlatformServices(this._tenant).then(function(){i.retrieveFiltersForRoots(V._rootID).then(function(Z){if(Z.length){var aa="";for(var Y=0;Y<Z.length;Y++){for(var X=0;X<Z[Y].length;X++){aa+="physicalid:"+Z[Y][X].filterId;if(X<Z[Y].length-1){aa+=" OR "}}}V.in_apps_search({precond:aa,title:"Search filters",fts_value:"type:ENOStrRefinementSpecification",callback:function(ad){U=(V.retrieveOptions&&!V.retrieveOptions.resetFilter)?0:1;if(U){V._resetFilter({initFilterUI:1});V._filterState="SaveOK"}var ab="";for(var ac=0;ac<Z.length;ac++){for(var ae=0;ae<Z[ac].length;ae++){if(ad===Z[ac][ae].name){ab=Z[ac][ae].filterId}}}this._checkFiltersToKeep(ab).then(function(af){V._keepFilters=af;j.checkAndGetListOfAttributesFromSelectedFilter(V._keepFilters[ad]).then(function(al){var ao=V._keepFilters[ad];var am=j.upgradeAndCompleteQuery(JSON.parse(ao.filterCVQuery));ao.filterCVQuery=am;var aj=V._listGroupView.length;var ah=ao.filterUIComponents.length-1;var ak=ao.filterUIComponents;if(ak&&1>=ak&&!ak[1].filterSpecificationName){ah--}var an=(V.retrieveOptions)?0:1;T=(aj+ah)-an;if(j.MAX_FILTER_SPECIFICATION>=T){if(U){j.getExpandSynthesisInfos(V._getExpandContext(),k.getAppQueryParam()).then(function(ap){V._synthesisInfos=ap;V._buildFromSelectedFilter(ad,al,V._synthesisInfos,U,T);V.setGlobalButtonsStatus(V._filterState)},function(ap){V._buildFromSelectedFilter(ad,al,V._synthesisInfos,U,T);V.setGlobalButtonsStatus(V._filterState);V._buildSynthesisAlert()})}else{V._buildFromSelectedFilter(ad,al,V._synthesisInfos,U,T)}}else{if(!U){var ag=V.retrieveOptions.editedModel;if(ag){ag.set("state","edit")}}var ai=UWA.String.format(t.get("maxFilterSpecOnRetrieveFilter"),j.MAX_FILTER_SPECIFICATION);j.displayNotification({level:"warning",message:ai})}V.setGlobalButtonsStatus(V._filterState);if(V.groupView){V.groupView.setFilterState(V._filterState)}})})},cancel:function(){V._cancelSearch.call(V,V.options)}})}})});V.optionsFilter=undefined},_buildFromSelectedFilter:function(V,S,Y,U,T){var W=this;if(!U){W.addGroupView();W._updateCombinationCombo()}W.groupView.setSynthesisInfos(Y);W._buildFilterUIFromSelectedFilter(V,S,j.getTypesOfSynthesis(Y));if(U){r.publish("NGFilter.updateTags",{appId:this._appId,widgetId:W._appWidget,tags:undefined});W._updateFilterNameUI(V)}else{}if(j.MAX_FILTER_SPECIFICATION===T){W._updateAddSpecificationButton();var X=UWA.String.format(t.get("maxFilterSpecDefined"),j.MAX_FILTER_SPECIFICATION);j.displayNotification({level:"info",message:X})}W._addNewSpecBtn.show();W._addExisitingSpecBtn.show()},in_apps_search:function(T){var V=this;this._internals={registrationOpts:function(){var W={title:t.get("SearchFilters"),mode:"furtive",default_with_precond:true,show_precond:false,widget_id:V._appWidget,app_socket_id:"NGFilter_"+V._appWidget,idcard_activated:false,multiSel:false,UXOptions:{dnD:false,localActions:false,searchRecentContent:false,globalToolbarActions:{saveAsFavorite:false,"export":false,print:false}}};return W}};var U=F.extend(this._internals.registrationOpts(),T);var S=new N.Socket(U.app_socket_id,{dispacthRetryInterval:0});if(T.debug_mode===true){S.setDebugMode(true)}F.is(T.parent_window)?S.subscribeServer("SearchComServer",window):S.subscribeServer("SearchComServer");S.dispatchEvent("RegisterContext",U);if(F.is(T.context_name)){U.context_title=T.context_name}U.default_search_criteria=T.fts_value;S.dispatchEvent("InContextSearch",U);S.addListener("Selected_Objects_search",function(W){if(W.length>1){console.log("No MultiSel allowed")}else{if(F.is(T.callback,"function")){T.callback.call(V,W[0]["ds6w:label_value"])}}});S.addListener("onCloseTransient",function(W){if(F.is(T.cancel,"function")){T.cancel(null)}S.dispatchEvent("UnregisterContext",U.widget_id)})},_onEditGroup:function(U){var T=this._listGroupView.length;for(var S=0;S<T;S++){if(this._listGroupView[S].cid===U.groupId){this.groupView=this._listGroupView[S];break}}this.setGlobalButtonsStatus(this._filterState)},_isFilterValid:function(){var V=true;var T=this._listGroupView.length;for(var S=0;S<T&&V;S++){var U=this._listGroupView[S];if(null!==U&&U.isViewEdited()){if(F.is(U.areCriteriaValid,"function")){V=U.areCriteriaValid()}}}return V},validateEditedCriterion:function(W){var U=this._listGroupView.length;var S=(U)?false:true;if(U){S=true;for(var T=0;T<U&&S;T++){var X=this._listGroupView[T];if(null!==X&&X.isViewEdited()){if(F.is(X.isCriterionValidate,"function")){var V=X.isCriterionValidate(W);if(!V){S=V}else{X.model.set("state","read")}}else{S=false;j.displayNotification({level:"error",message:t.get("NeedToValidateCrirerion")})}}}if(S&&(W&&F.is(W.callback,"function"))){W.callback(W)}}return S},_onAddNewFilterSpecification:function(){var S=this.validateEditedCriterion();if(S){this.addGroupView();this._buildCombinationComboWithMinusAndSpec();this._updateCombinationCombo();if(j.MAX_FILTER_SPECIFICATION===this._listGroupView.length){this._updateAddSpecificationButton();var T=UWA.String.format(t.get("maxFilterSpecDefined"),j.MAX_FILTER_SPECIFICATION);j.displayNotification({level:"info",message:T})}}},_onAddExistingFilterSpecification:function(){var S=undefined;for(var V=0;V<this._listGroupView.length;V++){if("edit"===this._listGroupView[V].model.get("state")){S=this._listGroupView[V].model;break}}var T=this.validateEditedCriterion();if(T){var U={resetFilter:false,editedModel:S};this._retrieveFilters(null,U)}},_createCombination:function(){var S=F.createElement("div",{"class":"filter-groups-Combination"});S.inject(this.getElement("#filter-groups"),"before");this._followingLabel=this._createCombinationLabel();this._followingLabel.inject(S);this._combinationCombo=this._createCombinationComboWithMinus();this._combinationCombo.inject(S);return S},_createCombinationLabel:function(){var S=F.createElement("label",{"class":"innerfiltertypecombo",text:t.get("FollowingCombination"),id:"global-combination-specification-label"});return S},_createCombinationComboWithMinus:function(U,T){var S=U;if(!S){T=(undefined!==T)?T:1;T=Math.min(T,1);S=[{labelItem:t.get("AllCombination"),valueItem:"intersection"},{labelItem:t.get("AnyCombination"),valueItem:"union"}]}var V=this._buildCombinationCombo("combination-specification_comboWithMinus",S);V.selectedIndex=(undefined!==T)?T:1;return V},_buildCombinationCombo:function(S,V){var T=new w({touchMode:j.TOUCH_MODE,elementsList:V,preselectedIndex:-1,enableSearchFlag:false,domId:S});var U=this;T.addEventListener("change",function(X){var W=X.dsModel.currentValue;if(-1===W.indexOf("minus")){U.model.set("combinationOfSpecification",W);U.model.unset("minusIndex");U._followingLabel.show()}else{var Y=W.split("-");U.model.set("combinationOfSpecification",Y[0]);U.model.set("minusIndex",Y[1]);U._followingLabel.hide()}U._updateAddSpecificationButton(W)});return T},_createNewSpecificationBtn:function(S){var U=new J({touchMode:true,displayStyle:"normal",label:t.get("addNewSpecification"),icon:"plus"});U.inject(S);U.tooltipInfos=new E({shortHelp:t.get("addNewSpecificationTooltip"),mouseRelativePosition:false});var T=this;U.addEventListener("buttonclick",function(V){T._onAddNewFilterSpecification()});return U},_createExistingSpecificationBtn:function(S){var U=new J({touchMode:true,displayStyle:"normal",label:t.get("addExistingSpecification"),icon:{iconName:"search-filter",fontIconFamily:WUXManagedFontIcons.Font3DS}});U.inject(S);U.tooltipInfos=new E({shortHelp:t.get("addExistingSpecificationTooltip"),mouseRelativePosition:false});var T=this;U.addEventListener("buttonclick",function(V){T._onAddExistingFilterSpecification()});return U},_updateCombinationCombo:function(){if(this._combinationCombo){this._combinationCombo.show()}},_buildCombinationComboWithMinusAndSpec:function(){var Z=undefined;var Y=0;var X=this.collection._groupCollectionArray;for(var aa=0;aa<X.length;aa++){var S=X[aa];Y+=("1"===S.isActivated())?1:0}if(2===Y){Z=[{labelItem:t.get("AllCombination"),valueItem:"intersection"},{labelItem:t.get("AnyCombination"),valueItem:"union"}];var W=t.get("MinusCombination")+" ";var T=X.length;for(var V=0;V<T;V++){if("1"===X[V].isActivated()){Z.push({labelItem:W+X[V].getFilterSpecificationName(),valueItem:"minus-"+V})}}}var U=this._combinationCombo.selectedIndex;this._combinationCombo.remove();delete this._combinationCombo;this._combinationCombo=this._createCombinationComboWithMinus(Z,U);this._combinationCombo.inject(this._followingLabel,"before")},_updateAddSpecificationButton:function(W){if(this._addNewSpecBtn&&this._addExisitingSpecBtn){var T=false;var V=this._listGroupView.length;for(var U=0;U<V;U++){var X=this._listGroupView[U];if(X.isThereCriteria()){T=true;break}}if(T){this._addNewSpecBtn.show();this._addExisitingSpecBtn.show()}else{this._addNewSpecBtn.hide();this._addExisitingSpecBtn.hide()}if(2===this._listGroupView.length&&"minus"===W){this._addNewSpecBtn.disabled=true;this._addExisitingSpecBtn.disabled=true}else{if(j.MAX_FILTER_SPECIFICATION===this._listGroupView.length){this._addNewSpecBtn.disabled=true;this._addExisitingSpecBtn.disabled=true}else{this._addNewSpecBtn.disabled=false;var S=this.getElement(".run_btn_search_filters").isHidden();this._addExisitingSpecBtn.disabled=(S)?true:false}}}},setTagsDataOnNGF:function(S){if(this._listGroupView){var U=true;for(var T=0;T<this._listGroupView.length;T++){this._listGroupView[T].createTagNGF(S.tagData,S.arrayRootIDs);if(this._listGroupView[T].isThereCriteria()){U=false;break}}if(!this._filterApplied){U=true;this._applyFilter(this._appliedFilterName,this._buildEmptyFilter(),U)}else{var V=this.collection.buildCVQuery(this._rootID,this._keepAttributeChildren.toString());this._applyFilter(this._appliedFilterName,V,U)}}else{console.log("RCIII GlobalFilterView : should have group view in existing GlobalFilterView")}},updateDataOnNGF:function(S){this._toDisplay=true;var T={};T.rootID=S.rootID;T.rootAlias=S.rootAlias;this._onSelectObject(T)},_onSpecificationStateChange:function(){var V;var U=this._listGroupView.length;for(var T=0;T<U;T++){var S=this._listGroupView[T].model;if(j.isModelActivated(S)){V=S;break}}if(V){this.setApplySelectable()}else{this.setApplyUnselectable()}this._buildCombinationComboWithMinusAndSpec()},setGlobalButtonsStatus:function(T){var S=this._dropdownCtxMenu.getItem("global-renameFilter-item-DDCtx").elements.container;if(S&&"SaveOK"===T){S.hide()}else{S.show()}switch(T){case"New":this.setApplyUnselectable();this.setSaveUnselectable();this.setSaveAsUnselectable();break;case"ValidOK":this.setApplySelectable();this.setSaveSelectable();this.setSaveAsUnselectable();break;case"SaveOK":this.setApplySelectable();this.setSaveSelectable();this.setSaveAsSelectable();break}},setApplySelectable:function(){this._applyFilterButton.disabled=false;this._applyFilterButton.active=true},setApplyUnselectable:function(){this._applyFilterButton.disabled=true;this._applyFilterButton.active=false},setSaveSelectable:function(){this._saveFilterButton.disabled=false;this._saveFilterButton.active=true},setSaveUnselectable:function(){this._saveFilterButton.disabled=true;this._saveFilterButton.active=false},setSaveAsSelectable:function(){this._saveAsFilterButton.style.display="inline";this._saveAsFilterButton.disabled=false;this._saveAsFilterButton.active=true},setSaveAsUnselectable:function(){this._saveAsFilterButton.style.display="inline";this._saveAsFilterButton.disabled=true;this._saveAsFilterButton.active=false},_updateApplySaveSaveAsState:function(T){var S=T.buttonsStatus;this._filterState=("ValidOK"===S&&"SaveOK"===this._filterState)?this._filterState:S;this.groupView.setFilterState(this._filterState);this.setGlobalButtonsStatus(this._filterState)},_getExpandContext:function(){var S={rootID:this._rootID,securityContext:this._preferredSC,tenant:this._tenant};return S},_switchDisplayDensityToComfortable:function(){this._switchDisplayDensity(1)},_switchDisplayDensityToCompact:function(){this._switchDisplayDensity(0)},_switchDisplayDensity:function(S){if(this._displayDensity!==S){this._displayDensity=S;sessionStorage.setItem("NGF_DisplayDensity",this._displayDensity);j.TOUCH_MODE=(S)?true:false;j.HEIGTH_UI_COMPONENT=(j.TOUCH_MODE)?38:22;if(this._listGroupView){var T=this;this._listGroupView.forEach(function(U){U.updateUIWithDisplayDensity(T._displayDensity)})}}},_checkFilter_RepairIfNeeded:function(){var T=this;var S=new q(function(U){if(T._keepFilterNames&&T._keepFilterNames.length){var V={filterUIComponents:T._keepFilters[T._keepFilterNames[0]].filterUIComponents}}else{var V={filterUIComponents:T.options.filterUIComponents}}T.filterRepairView._checkForBrokenLinksInFilter(V).then(function(Y){if(UWA.is(Y.pathsToFeedUI,"array")){var X=0;for(var W=1;W<V.filterUIComponents.length;W++){if(Y.indexOfGroupViewToRepair.indexOf(W)!=-1){V.filterUIComponents[W].toFeedUI[0]=Y.pathsToFeedUI[X];X++}}T.IsFilterBroken=true;T.filterRepairView.logBrokenFiltersInfo(Y.pathsToFeedUI);U(V)}else{if(Y=="PathsOK"){U()}else{if(Y=="NoContextFilter"){U()}}}})});return S},_updateContextFilterModel_FromRepairPanel:function(U){var T=this;for(var S=0;S<this._listGroupView.length;S++){this.listenTo(this._listGroupView[S],"RepairFilter_updateRepairedPathsInUI",function(V){if(V.modelUpdated){T._listGroupView[S]._updateContextFilterView(V.attributes);T._filterState="SaveOK";T.setGlobalButtonsStatus(T._filterState);if(T.groupView){T.groupView.setFilterState(T._filterState)}}});this._listGroupView[S].updateContextFilterView(U)}},});return P});define("DS/ENONextGenFilterUX/views/ContainerFilterView",["UWA/Class","UWA/Class/View","UWA/Core","UWA/Utils","DS/WAFData/WAFData","DS/ENONextGenFilterUX/views/GlobalFilterView","DS/ENONextGenFilterUX/models/GlobalFilterModel","DS/ENONextGenFilterUX/utils/FilterPersistencyServices","DS/Handlebars/Handlebars","text!DS/ENONextGenFilterUX/templates/containerViewTemplate.html","css!DS/ENONextGenFilterUX/ENONextGenFilterUX.css","DS/PlatformAPI/PlatformAPI","DS/WebappsUtils/WebappsUtils","DS/ENONextGenFilterUX/utils/FilterUIService","DS/ENOFilterBIUX/NGFServices","i18n!DS/ENONextGenFilterUX/assets/nls/ENONextGenFilterUX","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENOFilterBIUX/FBIServices","DS/ENONextGenFilterUX/utils/FilterCollectionServices"],function(s,o,n,f,a,t,u,c,g,m,q,d,e,r,k,i,h,j,p){var l=1;var b=o.extend({domEvents:{"click .filter-cmd-close":"_onCloseFilterPanel","click .filter-cmd-expandPanel":"_expandFilterPanel",},setup:function(){this.appId=this.options.appId;this.widget=this.options.widgetId;this.filterId=this.options.filterId;this.rootID=this.options.rootID;this.rootAlias=this.options.rootAlias||"?";this._template=g.compile(m);k.setAppQueryParam(this.options.appQueryParam);this._filterToApply=this.options.filterToApply;this._dropedFilterNames=[];if(this.options.filterNames){this._dropedFilterNames=(Array.isArray(this.options.filterNames))?this.options.filterNames:[this.options.filterNames]}this._dropedFilterIds=[];if(this.options.filterIds){this._dropedFilterIds=(Array.isArray(this.options.filterIds))?this.options.filterIds:[this.options.filterIds]}if(this.options.widgetTenant){this._widgetTenant=this.options.widgetTenant}if(this.options.tagData){this._tagData=this.options.tagData}this._toDisplay=this.options.display?this.options.display:true;if(undefined===this.options.configUsed){this.options.configUsed=0}this.render()},render:function(){var v=this;this.container.setContent(this._template({filterId:this.filterId,closeFilterPanel:i.get("CloseFilterPanel"),containerHeightClass:"f-globalFilter-container-height"+(("safari"===f.Client.Engine.name)?"-Safari":"")}));if(1!==r.isFilterCmdHeaderActivated()){var w=this.getElements(".filter-ExtraCommands");w.forEach(function(x){x.hide()})}this._globalMdl=new u({state:"init"});j.getPlatformServices(this._widgetTenant).then(function(){if(v._dropedFilterNames&&v._dropedFilterNames.length){k.getFilterDataFromFilterNames(v._dropedFilterNames).then(function(y){v._fromFilterDataToAppAndUXView(y)})}else{if(v._dropedFilterIds.length&&v._dropedFilterIds.length){k.getAllDataFromFilterIds(v._dropedFilterIds,v._widgetTenant).then(function(y){v._fromFilterDataToAppAndUXView(y)})}else{var x={model:v._globalMdl,appId:v.appId,widget:v.widget,filterId:v.filterId,widgetTenant:v._widgetTenant,rootID:v.rootID,rootAlias:v.rootAlias,container:v.getElement(".globalFilterView-container"),configUsed:v.options.configUsed,volumeUsed:v.options.volumeUsed,filterToApply:v._filterToApply,idxGFV:l++,fromDropOnFilter:v.options.fromDropOnFilter};if(sessionStorage.getItem("FBI_droppedFilters")){x.filterData=JSON.parse(sessionStorage.getItem("FBI_droppedFilters"))[v.rootID]}else{x.tagData=v._tagData;x.display=v._toDisplay}v.globalViewFilter=new t(x);v._filterToApply=undefined}}});return this},_fromFilterDataToAppAndUXView:function(z){if(!z){console.log("ContainerFilterVIew.render, issue in getAllDataFromFilterIds")}var B=this;this.retrieveFiltersRes=z;var C={};C.success=[];C.failure=[];if(z.success){for(var A=0;A<z.success.length;A++){var v=z.success[A];if(1===c.NEW_SAVE){p.buildCVQueryFromModel(v)}var D=r.upgradeAndCompleteQuery(JSON.parse(v.filterCVQuery));D.appId=B.appId;D.widget=B.widget;D.filterRootIds=[v.rootPhysicalId];var y={rootId:v.rootPhysicalId,rootType:"VPMReference",filterId:B._dropedFilterIds[A],filterName:v.filterName,filter:D,fromDropOnFilter:B.options.fromDropOnFilter};C.success.push(y);var w=y.rootId;var E=[];E[w]={};E[w]=z.success[0];E[w].filterName=z.success[0].filterName;E[w].model=B._globalMdl;E[w].filterData=z.success;E[w].appId=B.appId;E[w].widget=B.widget;E[w].rootID=w;E[w].widgetTenant=B._widgetTenant;E[w].container=B.getElement(".globalFilterView-container");E[w].display=B._toDisplay;E[w].configUsed=B.options.configUsed;E[w].volumeUsed=B.options.volumeUsed;E[w].filterToApply=B._filterToApply;E[w].idxGFV=l++;E[w].filterId=B.filterId;E[w].rootAlias=B.rootAlias;E[w].fromDropOnFilter=B.options.fromDropOnFilter;B.globalViewFilter=new t(E[w]);B._filterToApply=undefined}}if(z.failure){for(var x=0;x<z.failure.length;x++){C.failure.push(z.failure[x])}}B.globalViewFilter.checkBrokenFilter().then(function(G){if(G.isBroken==true){var H=G.filterinfo;var F=B._updateDataForAppCB(H);d.publish("NGFilter.ApplyDroppedFilters",F)}else{d.publish("NGFilter.ApplyDroppedFilters",C)}})},_updateDataForAppCB:function(v){var B=this;var A={};A.success=[];A.failure=[];if(this.retrieveFiltersRes.success){for(var w=0;w<this.retrieveFiltersRes.success.length;w++){var z=this.retrieveFiltersRes.success[w];var y=p.buildCVQueryFromModel(z);if(1===c.NEW_SAVE){p.buildCVQueryFromModel(z)}var x=r.upgradeAndCompleteQuery(JSON.parse(y));x.appId=B.appId;x.widget=B.widget;x.filterRootIds=[z.rootPhysicalId];var C={rootId:z.rootPhysicalId,rootType:"VPMReference",filterId:B._dropedFilterIds[w],filterName:z.filterName,filter:x,fromDropOnFilter:B.options.fromDropOnFilter};A.success.push(C)}}return A},_onCloseFilterPanel:function(){if(""!==this.widget){d.publish("Frame3DXInfra.Close",{appId:this.appId,widgetId:this.widget,rootID:this.rootID})}sessionStorage.setItem("NGF_tagMgtRunning_"+this.rootID,false)},setTagsDataOnNGF:function(v){this.globalViewFilter.setTagsDataOnNGF(v)},updateDataOnNGF:function(v){this.globalViewFilter.updateDataOnNGF(v)},_expandFilterPanel:function(){function w(B){var z=document.querySelector(".column.left"),A=z.firstChild,y=-parseInt(z.style.transform.replace("translateX(",""));if(0!==B){z.style.width=(B+y)+"px";A.style.width=B+"px"}else{z.style.width="";A.style.width=""}}var x=window.document.getElement(".column_NGF");if(!x){var v=window.document.getElement(".column.left.shown");v.addClassName("column_NGF");w(950);x=this.getElement(".filter-cmd-expandPanel");x.addClassName("fonticon-resize-small");x.removeClassName("fonticon-resize-full")}else{x.removeClassName("column_NGF");w(0);x=this.getElement(".filter-cmd-expandPanel");x.addClassName("fonticon-resize-full");x.removeClassName("fonticon-resize-small")}}});return b});