define("DS/VCXWebDressup/VCXPickerTools",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/Viewpoint","DS/VCXWebVisualization/VCXPickInfo","DS/VCXWebVisualization/VCXPickerCanonics"],function(b,e,c,f,a){var d=b.extend({init:function(g){this._experienceBase=g?g:null;this._verticalDecay=0;this._useNormalConstraintToCamera=false;this._useNormalConstraint=false;this._usePointConstraint=false;this._canonicsMode=a.Canonic.None;this._pickerGeom=null},clear:function(){this._experienceBase=null;if(this._pickerGeom){this._pickerGeom.clear();delete this._pickerGeom}},useCanonicsDetection:function(g){this._canonicsMode=g},setVerticalDecay:function(g){this._verticalDecay=g},useNormalConstraintToCamera:function(g){this._useNormalConstraintToCamera=g},useNormalConstraint:function(g,h){this._useNormalConstraint=g?true:false;if(g){this._normalConstraint=new e.Vector3().copy(h)}this.useNormalConstraintToCamera(false)},usePointConstraint:function(g,h){this._usePointConstraint=g?true:false;if(g){this._pointConstraint=new e.Vector3().copy(h)}},pick2DonGround:function(j,i,g){var h=this.pick(j,{pageX:i,pageY:g});return h.pickInfo.globalPosition},pick:function(w,u){var j={mouse:{},viewer:w};var l=w.canvas.getBoundingClientRect();var p=u.pageX-l.left;var r=u.pageY-l.top-this._verticalDecay;j.mouse=w.getMousePosition(new e.Vector2(p,r));if(j.pickInfo){j.pickInfo.reset()}else{j.pickInfo=new f(w,this._experienceBase)}var k=null;var n=j.pickInfo;if(!this._usePointConstraint){k=w.pick(j.mouse,"mesh",true);if(k&&k.path&&k.path.length>0&&k.path[0]){n.pathElement=k.path[0].clone();if(w.multiViewerFix===false){n.pathElement.externalPath.splice(0,1)}var m=n.modifiable;if(!m||(m&&!m.GetObject().IsDressup)){if(k.position){n.globalPosition=k.position.clone();this._lastValidPosition=n.globalPosition}if(k.normal){n.globalNormal=k.normal.clone()}}else{k=null}}}if(!k||k.path.length===0){var t=this._lastValidPosition?this._lastValidPosition:new e.Vector3();if(this._usePointConstraint){t=this._pointConstraint}var s=new e.Vector3().subVectors(w.currentViewpoint.target,w.currentViewpoint.position);if(this._useNormalConstraint){s=this._normalConstraint}if(this._useNormalConstraintToCamera){var o=w.currentViewpoint.getControl();var z=new e.Vector3().subVectors(o.target,w.currentViewpoint.camera.position);s=z.normalize()}var x=new e.Plane(s,0).setFromNormalAndCoplanarPoint(s,t);var v=new e.Vector3(j.mouse.x,j.mouse.y,1);var i=new e.Projector();i.unprojectVector(v,w.currentViewpoint.camera);var q=null;if(w.currentViewpoint.getProjectionType()===c.PERSPECTIVE){q=new e.Ray(w.currentViewpoint.getEyePosition(),v.sub(w.currentViewpoint.getEyePosition()).normalize())}else{q=new e.Ray(v,w.currentViewpoint.getSightDirection())}var y=q.intersectPlane(x);if(y){n.globalPosition=y}n.globalNormal=new e.Vector3().subVectors(w.currentViewpoint.target,w.currentViewpoint.position).normalize()}n.smartMouse.x=j.mouse.xPix;n.smartMouse.y=j.mouse.yPix;if(this._canonicsMode!==a.Canonic.None){if(!this._pickerGeom){this._pickerGeom=new a()}this._pickerGeom.pick(n,this._canonicsMode);if(n._smartMode&&n._canonics.length){if(n._canonics[0].pathElement){n.pathElement=n._canonics[0].pathElement}if(n._canonics[0].point){n.globalPosition=n._canonics[0].point;if(n.viewer&&n.viewer.currentViewpoint){var h=n.viewer.currentViewpoint.project(n._canonics[0].point);n.smartMouse.x=Math.round(h.x);n.smartMouse.y=Math.round(h.y)}}if(n._canonics[0].normal){n.globalNormal=n._canonics[0].normal}}}else{if(this._pickerGeom){this._pickerGeom.clear();this._pickerGeom=null}}if(this._useNormalConstraint){n.globalNormal=this._normalConstraint}if(this._useNormalConstraintToCamera){var o=w.currentViewpoint.getControl();var g=new e.Vector3().subVectors(o.target,w.currentViewpoint.camera.position);n.globalNormal=g.normalize()}return j}});return d});define("DS/VCXWebDressup/VCXDressupModelNavigable",["UWA/Class","DS/WebApplicationBase/VCXAModelNavigable"],function(a,b){var c=b.extend({isSelfOrganized:function(){return true}});return c});define("DS/VCXWebDressup/VCXDressupOrganisationShape",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(a,c,d){var b=a.extend({init:function(e){this.sizeView=e;this.fHalfSizeX=this.sizeView.x*0.5;this.fHalfSizeY=this.sizeView.y*0.5;this.iCurrent=0},next:function(){this.iCurrent++;if(this.iCurrent>=this.iNbPt){this.iCurrent=this.iNbPt-1}return false},rewind:function(){this.iCurrent=0;this.iNbPt=(Math.floor(this.sizeView.x/this.fCellSize)+1)*(Math.floor(this.sizeView.y/this.fCellSize)+1)},getPoint:function(){}});return b});define("DS/VCXWebDressup/VCXBomManagerModifiable",["DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueMap",],function(e,k,h,g,a,l,m,f){var d=0;var j=1;var i=2;var c=3;var b=e.extend({init:function(n){this._Properties=[]},BuildProp:function(o,p,r){var q=new h(o,1);var n=new p();n.Value=r;this._Properties[o]=new k(q,n);this.SetProperty(o,n)},BuildColumn:function(s,r,q,p){var o=new f();var n=new m();n.SetValue(s);o.SetValueAtIndex(d,n);n=new l();n.SetValue(r);o.SetValueAtIndex(j,n);n=new l();n.SetValue(q);o.SetValueAtIndex(i,n);n=new m();n.SetValue(p);o.SetValueAtIndex(c,n);return o},Build:function(){this._parent();this.BuildProp("BOM.Filter",l,0);this.BuildProp("BOM.Sort.Ascendant",a,true);this.BuildProp("BOM.Sort.PropertyName",m,"Bom.Description");var o=new f();o.SetValueAtIndex(0,this.BuildColumn("Bom.Description",100,0,""));o.SetValueAtIndex(1,this.BuildColumn("Actor.BomId",50,0,""));o.SetValueAtIndex(2,this.BuildColumn("Bom.Quantity",40,0,""));var n=new h("ColumnTreeList.ColumnList",1);this._Properties["ColumnTreeList.ColumnList"]=new k(n,o);this.SetProperty("ColumnTreeList.ColumnList",o)},SetProperty:function(p,o){var n=new h(p,0);this._Properties[p]=new k(n,o.Clone())},OnChangeProperty:function(p,n,o){if(o){}else{o={}}if(o.fromChildClass){}else{if(this.OnChangePropertyBegin(p,n)){return true}}this.SetProperty(p,n)},OnChangePropertiesEnd:function(){if(this.GetObject().update){this.GetObject().update()}},GetProperty:function(o){var n=null;var p=this._Properties[o];if(p!==undefined){n=new k(this._Properties[o].GetPropertyInfo(),this._Properties[o].GetPropertyValue().Clone())}return n},GetProperties:function(o){var n=new g();for(var p in this._Properties){if(this._Properties.hasOwnProperty(p)){n.AddOrModifyProperty(this.GetProperty(p))}}return n},});return b});define("DS/VCXWebDressup/VCXCmdChangeDressup",["DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeModifiable","DS/VCXWebKernelCommands/VCXCmdChangeComponent"],function(d,c,b){var a=d.extend({init:function(e,f,h,g){this._parent();this._commandManager=e;this._dressupManager=f;this._scenarioManager=h;this._ComponentsMap=g;this._dressupsToAdd=[];this._dressupsToRemove=[];this._bLockEvents=false},GetType:function(){return"VCXCmdChangeDressup"},GetTitle:function(){return"Change Dressup"},RemoveDressups:function(e){this._dressupsToRemove=this._dressupsToRemove.concat(e)},AddDressups:function(e){this._dressupsToAdd=this._dressupsToAdd.concat(e)},Do:function(){var h=this;var e=new b(this._commandManager,this._ComponentsMap);e.AddComponents(this._dressupsToAdd);e.RemoveComponents(this._dressupsToRemove);this._commandManager.Push(e);var g=new c(this._scenarioManager);g.SetLockEvents(this._bLockEvents);this._dressupsToAdd.forEach(function(i){g.AddModifiables(i.QueryInterface("VCXIModifiable"))});this._dressupsToRemove.forEach(function(i){g.RemoveModifiables(i.QueryInterface("VCXIModifiable"))});this._commandManager.Push(g);if(this._dressupsToAdd.length!==0){h._dressupManager.AddDressups(this._dressupsToAdd)}if(this._dressupsToRemove.length!==0){h._dressupManager.RemoveDressups(this._dressupsToRemove)}if(this._bLockEvents){}else{h._dressupManager.RefreshVisuAfterDressupChange()}var f=h._dressupManager._experienceBase.getManager("VCXCAT3DXModelManager");if(f&&this._dressupsToRemove.length!==0){this._dressupsToRemove.forEach(function(i){f.DeleteActor(i)})}},Undo:function(){var e=this;if(this._dressupsToAdd.length!==0){e._dressupManager.RemoveDressups(this._dressupsToAdd)}if(this._dressupsToRemove.length!==0){e._dressupManager.AddDressups(this._dressupsToRemove)}if(this._bLockEvents){}else{e._dressupManager.RefreshVisuAfterDressupChange()}},Redo:function(){var e=this;if(this._dressupsToAdd.length!==0){e._dressupManager.AddDressups(this._dressupsToAdd)}if(this._dressupsToRemove.length!==0){e._dressupManager.RemoveDressups(this._dressupsToRemove)}if(this._bLockEvents){}else{e._dressupManager.RefreshVisuAfterDressupChange()}},SetLockEvents:function(e){this._bLockEvents=e}});return a});define("DS/VCXWebDressup/VCXSectionManager",["DS/WebApplicationBase/W3AAManager","DS/Visualization/ClippingContext","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/VCXWebModifiables/VCXModelChangeListener"],function(e,b,a,d){var c=e.extend({init:function(){this._clippingContext=null},initialize:function(){},postInitialize:function(){this._activeSections={}},getUpdatePriority:function(){return 3},unInitialize:function(){if(this._overrideSet){delete this._overrideSet}if(this._activeSections){delete this._activeSections}if(this._clippingContext){delete this._clippingContext}if(this._cutObjects){delete this._cutObjects}if(this._clippingOverride){delete this._clippingOverride}},update:function(i){if(this.Dirty){this.Dirty=false;var p=[];if(this._overrideSet){var q=this._overrideSet;this._experienceBase.getManager("VCXContextManager").applyToViewers(function(y){var z=y.getSceneGraphOverrideSetManager();z.removeSceneGraphOverrideSet(q)});this._overrideSet=null}var w=1;var n=0;var f=false;for(var j in this._activeSections){var l=this._activeSections[j];p.push(l._plane);var o=l.QueryInterface("VCXIModifiable");if(o.GetPropertyValue("Section.SpaceBackAlpha")<o.GetPropertyValue("Section.SpaceFrontAlpha")){w=0;n=1}if(o.GetPropertyValue("Section.Capping")){f=true}}if(this._cappingActive!==f){this._cappingActive=f;this._experienceBase.getManager("VCXContextManager").applyToViewers(function(y){if(f){y.setRenderPriority(false);y.setSectionCapping(true)}else{y.setSectionCapping(false)}})}if(p.length===0){return}this._clippingContext=new b();this._clippingContext.setPlanes(p);this._clippingContext.setFrontAndBackOpacity(w,n);for(var j in this._activeSections){var l=this._activeSections[j];this._clippingContext.setSectionCappingMaterial(l._cappingMaterial,l._plane)}this._cutObjects=[];for(var j in this._activeSections){var l=this._activeSections[j];var v=false;var s=l.QueryInterface("VCXIModifiable");var x=s.GetProperty("Actor.ListActors");if(x){var h=x.GetPropertyValue().GetValue();if(h&&h.length){for(var g=0;g<h.length;g++){var u=this._experienceBase.ComponentsMap.GetComponentFromID(h[g].GetValue());if(u&&!u.IsKindOf("VCXComponentDressup")){var m=u.QueryInterface("W3AISGNodeHolder");var t=m.getPathElement();if(this._cutObjects.indexOf(t)===-1){this._cutObjects.push(t)}v=true}}}}if(!v){var r=this._experienceBase.getManager("VCXContextManager").getRootPathElement();this._cutObjects.push(r)}}if(!this._overrideSet){var k=this._experienceBase.getManager("VCXContextManager").getRootNode();this._overrideSet=new a(k);var q=this._overrideSet;this._experienceBase.getManager("VCXContextManager").applyToViewers(function(y){var z=y.getSceneGraphOverrideSetManager();z.pushSceneGraphOverrideSet(q)})}this._clippingOverride=this._overrideSet.createOverride(this._cutObjects);this._clippingOverride.setClippingContext(this._clippingContext)}},registerSection:function(f){this._activeSections[f.GetID()]=f;this.Dirty=true},unregisterSection:function(g){var f=g.GetID();if(this._activeSections&&this._activeSections[f]){delete this._activeSections[f];this.Dirty=true}},postUpdate:function(f){this._parent(f)},isCut:function(h,g){for(var f in this._activeSections){var i=this._activeSections[f];if(i.isCut(h,g)){return true}}return false},preRender:function(f){},postRender:function(f){},getVersion:function(){return"1.0.1"}});Object.defineProperty(c.prototype,"Dirty",{enumerable:true,get:function(){return this._Dirty},set:function(f){this._Dirty=f}});Object.defineProperty(c.prototype,"componentType",{enumerable:true,get:function(){return"VCXSectionManager"}});return c});define("DS/VCXWebDressup/VCXComponentDressupGrp",["UWA/Class",],function(a){var b=a.extend({init:function(){this._parent();this._name="Others"},GetType:function(){return this.componentType},setName:function(c){this._name=c},getName:function(){return this._name}});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentDressupGrp"}});return b});define("DS/VCXWebDressup/VCXBOMInfoComponent",["UWA/Class",],function(a){var b=a.extend({init:function(){this._name="";this.treeBomInfo={}},smartCompare:function(g,f){var e=true;var h=g;var j=f;if(h!==j){var k=Number(h),i=Number(j);if(k==h&&i==j){return(k-i)*e}else{if(h.toLowerCase){h=h.toLowerCase()}if(j.toLowerCase){j=j.toLowerCase()}return(h>j)?e:-e}}return 0},GetType:function(){return this.componentType},SetName:function(c){if(this._name!==c){this._name=c}},GetName:function(){return this._name},getDescription:function(c){var d=c in this.treeBomInfo;if(d){return this.treeBomInfo[c]}else{return null}},addBomInfoRow:function(c,d){this.treeBomInfo[c]=d},});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXBOMInfoComponent"}});return b});define("DS/VCXWebDressup/VCXAmbience3DExperienceObject",["DS/CAT3DExpModel/extensions/CATE3DExperienceObject","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueFloat"],function(d,a,b){var c=d.extend({SetValueByName:function(f,h,g){this._parent(f,h,g);var e=this.QueryInterface("VCXIModifiable");switch(f){case"_varName":e.OnChangeProperty("Actor.Name",new a(h));break;case"Dome Radius":e.OnChangeProperty("Environment.Background.Radius",new b(h));break;case"Dome Rotation Z":e.OnChangeProperty("Environment.Background.Rotation",new b(h));break;case"Exposure":e.OnChangeProperty("Environment.Background.Exposure",new b(h));break;case"Ground Glossiness":e.OnChangeProperty("Environment.Ground.Glossiness",new b(h));break;case"Ground Offset":e.OnChangeProperty("Environment.Ground.Offset",new b(h));break;case"Ground Reflectivity":e.OnChangeProperty("Environment.Ground.Reflectivity",new b(h));break;case"Ground Scale Ratio":e.OnChangeProperty("Environment.Ground.Scaleratio",new b(h));break}},});return c});define("DS/VCXWebDressup/VCXAManipulable",["UWA/Class","DS/CoreEvents/Events","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebVisualization/VCXInteractor",],function(d,a,c,b){var e=d.extend({init:function(){this._interactors={};this._inManipulation=false},isManipulated:function(){return this._inManipulation},getAllInteractors:function(){return this._interactors},getActiveInteractors:function(){var f=this.getAllInteractors();var g={};for(var h in f){if(f.hasOwnProperty(h)){if(f[h].active===true){g[h]=f[h]}}}return g},isActive:function(){var i=this.GetObject();var f=i.GetID();var n=this.QueryInterface("VCXIVisibility");if(n&&n.GetVisibility()===c.EVisState.Hidden){return false}var l=this.getActiveInteractors();var m=Object.keys(l);if(m.length===0){return false}var j={selection:false,hoveringObject:false,hoveringHandle:false};var h=this.GetObject()._experienceBase.getManager("VCXSelectionManager");for(var o=0;o<m.length;++o){var k=m[o];var g=l[k];if(g.handleInfos&&g.handleInfos.stayVisible){return true}if(!j.selection&&(!g.visibility||g.visibility&&(g.visibility&b.EVisibility.OnObjectSelected))){if(h.isIn(i)){return true}j.selection=true}if(!j.hoveringObject&&(!g.visibility||g.visibility&&(g.visibility&b.EVisibility.OnObjectOver))){var p=h.GetComponentsFromSelection("PSO");if(p.includes(i)){return true}j.hoveringObject=true}if(!j.hoveringHandle&&(!g.visibility||g.visibility&&(g.visibility&b.EVisibility.OnInteractorOver))){j.hoveringHandle=true}}return false},addInteractor:function(g,f){if(f&&!this._interactors[g]){this._interactors[g]=f;a.publish({event:"VCX_INTERACTOR_ADDED",data:{interactor:f,manipulable:this}});return true}else{return false}},removeInteractor:function(f){if(this._interactors[f]){delete this._interactors[f];return true}else{return false}},enableInteractors:function(f){this._switchInteractors(f,true)},disableInteractors:function(f){this._switchInteractors(f,false)},_switchInteractors:function(f,g){if(!Array.isArray(f)){console.log("Methods of VCXAManipulable enableInteractors & disableInteractors require an array as input !");return}for(var k=0;k<f.length;++k){var j=f[k];var h=this._interactors[j];if(h){h.disabledByManipulable=!g}var i=h.handle;if(i&&i.isDisplayed()&&!h.active){i.Hide(true)}}},interact:function(){}});return e});define("DS/VCXWebDressup/VCXAViewpointController",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/Viewpoint","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebTracks/VCXInterpolatorLinear","DS/VCXWebTracks/VCXInterpolatorCubic","DS/VCXWebTracks/VCXInterpolatorSpherical"],function(a,g,f,e,h,b,c,d){var i=a.extend({init:function(){this._parent()},GetInterpolator:function(l){if(l==="Camera.Position"){if(this.shouldUseSphericalInterpolator()){var m=new d();m.setPositionPropertyName("Actor.Anchor.1");m.setTargetPropertyName("Actor.Anchor.2");return m}else{return null}}else{if(l==="Actor.Anchor.1"||l==="Actor.Anchor.2"){var k=this.GetObject()._experienceBase.getManager("VCXVisuManager");var j=this.QueryInterface("VCXIModifiable");if(l==="Actor.Anchor.1"&&(k.isInTransitionMode()||(j.GetPropertyValue("Camera.Arcball")&&j.GetPropertyValue("Actor.Interpolation.Type")===e.EInterpolationType.Linear))){return new b()}else{if(j.GetPropertyValue("Actor.Interpolation.Type")===e.EInterpolationType.Linear){return new b()}else{return new c()}}}else{return null}}},toViewpoint:function(){var l=this.GetObject()._experienceBase.getManager("VCXVisuManager");if(!l.getUpdateViewport()){return}var k=this.GetObject()._experienceBase.getManager("VCXContextManager");var j=this.QueryInterface("VCXIModifiable");if(k&&j){var m=k.getMainViewer().currentViewpoint;if(m){if(!this.__translation){this.__translation=new g.Vector3()}if(!this.__quaternion){this.__quaternion=new g.Quaternion()}var n=this.getMatrixAndDOI();n.matrix.decompose(this.__translation,this.__quaternion,undefined);m.moveTo({eyePosition:this.__translation,orientation:this.__quaternion,distanceToTarget:n.doi});var p=m.camera.pixelCulling;m.setProjectionType(j.GetPropertyValue("Camera.Ortho")?f.ORTHOGRAPHIC:f.PERSPECTIVE);m.setPixelCulling(p);var o=45;if(j.GetPropertyValue("Camera.Ortho")){if(n.doi){o=Math.atan(j.GetPropertyValue("Camera.Height")*0.5/n.doi)*(2*180)/Math.PI}}else{if(j.GetPropertyValue("Camera.Angle")>0){o=j.GetPropertyValue("Camera.Angle")}}o=Math.max(0.001,Math.min(o,179));m.setAngle(o)}}},fromViewpoint:function(x){var y=this.GetObject()._experienceBase.getManager("VCXContextManager");var s=this.QueryInterface("VCXIModifiable");if(y&&s){var u=y.getMainViewer().currentViewpoint;if(u){var l=u.getEyePosition();var t=u.getTarget();var z=u.getSightDirection();z.negate();var C=u.getUpDirection();var k=new g.Vector3().crossVectors(C,z);var r=new g.Matrix4().makeBasis(k,C,z).setPosition(l);var v=s.GetProperty("Actor.Anchor.1");var q=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(v.GetPropertyValue().GetValueLink());if(!q){q=this.GetObject().getWorkingRootComponent()}var B=q.QueryInterface("W3AISGNodeHolder").getWorldMatrix(y.getMainViewer());var m=new g.Matrix4().getInverse(B);var w=new g.Matrix4().multiplyMatrices(m,r);var p=s.GetProperty("Camera.Position");var E=new h(w);p.SetPropertyValue(E);if(x){x.AddOrModifyProperty(p)}else{s.OnChangeProperty("Camera.Position",E)}var p=s.GetProperty("Actor.Anchor.1");var E=p.GetPropertyValue();E.SetValueFrame(new h(w));p.SetPropertyValue(E);if(x){x.AddOrModifyProperty(p)}else{s.OnChangeProperty("Actor.Anchor.1",E)}var j=new g.Matrix4().makeBasis(k,C,z).setPosition(t);var o=new g.Matrix4().multiplyMatrices(m,j);p=s.GetProperty("Actor.Anchor.2");var E=p.GetPropertyValue();E.SetValueFrame(new h(o));p.SetPropertyValue(E);if(x){x.AddOrModifyProperty(p)}else{s.OnChangeProperty("Actor.Anchor.2",E)}p=s.GetProperty("Camera.Ortho");var E=p.GetPropertyValue();E.SetValue(u.getProjectionType()===f.ORTHOGRAPHIC?true:false);p.SetPropertyValue(E);if(x){x.AddOrModifyProperty(p)}else{s.OnChangeProperty("Camera.Ortho",E)}var D=u.getAngle();p=s.GetProperty("Camera.Angle");var E=p.GetPropertyValue();E.SetValue(D);p.SetPropertyValue(E);if(x){x.AddOrModifyProperty(p)}else{s.OnChangeProperty("Camera.Angle",E)}D/=(2*180)/Math.PI;var n=Math.tan(D);var A=n*u.getTargetDistance();A*=2;p=s.GetProperty("Camera.Height");var E=p.GetPropertyValue();E.SetValue(A);p.SetPropertyValue(E);if(x){x.AddOrModifyProperty(p)}else{s.OnChangeProperty("Camera.Height",E)}}}},resetMatrixAndDOI:function(){this._matrixAndDOI=null},shouldUseSphericalInterpolator:function(){var j=this.QueryInterface("VCXIModifiable");var k=this.GetObject()._experienceBase.getManager("VCXVisuManager");return(k.isInTransitionMode()||(!j.GetPropertyValue("Camera.Ortho")&&j.GetPropertyValue("Camera.Arcball")&&j.GetPropertyValue("Actor.Interpolation.Type")===e.EInterpolationType.Linear))},getMatrixAndDOI:function(){if(this._matrixAndDOI){return this._matrixAndDOI}var l=this.QueryInterface("VCXIModifiable");if(l){var y=this.shouldUseSphericalInterpolator();var m;if(y){var q=this.GetObject()._experienceBase.getManager("VCXContextManager");var p=l.GetProperty("Actor.Anchor.1");var k=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(p.GetPropertyValue().GetValueLink());if(!k){k=this.GetObject().getWorkingRootComponent()}var x=k.QueryInterface("W3AISGNodeHolder").getWorldMatrix(q.getMainViewer());m=x.multiply(l.GetPropertyValue("Camera.Position"))}else{m=l.GetAnchorWorldMatrix(1,null)}var o=l.GetAnchorWorldMatrix(2,null);var j=new g.Vector3().getPositionFromMatrix(o);var r=new g.Vector3().getPositionFromMatrix(m);if(l.GetPropertyValue("Camera.Ortho")){var u=l.GetPropertyValue("Camera.Height");var C=u;r=new g.Vector3(0,0,C).applyMatrix4(o);m.setPosition(r)}if(!y){if(!l.GetPropertyValue("Camera.Pitch")&&!l.GetPropertyValue("Camera.Yaw")){if(l.GetPropertyValue("Camera.LockDistCOI")){var w=new g.Vector3();var v=new g.Vector3();var s=new g.Vector3();m.extractBasis(w,v,s);m.setPosition(new g.Vector3().addVectors(j,s.multiplyScalar(Math.abs(l.GetPropertyValue("Camera.DistCOI")))))}}if(!l.GetPropertyValue("Camera.Pitch")){var n=new g.Matrix3().copy(m);var E=new g.Matrix3().getInverse(m);var r=new g.Vector3().getPositionFromMatrix(m);var z=new g.Vector3().subVectors(j,r);z.applyMatrix3(E);z.y=0;z.applyMatrix3(n);m.setPosition(new g.Vector3().subVectors(j,z))}if(!l.GetPropertyValue("Camera.Yaw")){var n=new g.Matrix3().copy(m);var E=new g.Matrix3().getInverse(m);var r=new g.Vector3().getPositionFromMatrix(m);var z=new g.Vector3().subVectors(j,r);z.applyMatrix3(E);z.x=0;z.applyMatrix3(n);m.setPosition(new g.Vector3().subVectors(j,z))}var r=new g.Vector3().getPositionFromMatrix(m);if(l.GetPropertyValue("Camera.Roll")){var w=new g.Vector3();var v=new g.Vector3();var s=new g.Vector3();m.extractBasis(w,v,s);var A=new g.Vector3().subVectors(r,j);if(A.length()){A.normalize();var D=new g.Vector3().crossVectors(v,A).normalize();var B=new g.Vector3().crossVectors(A,D).normalize();var t=new g.Vector3().crossVectors(D,B).normalize();var F=new g.Vector3().crossVectors(t,D);m.makeBasis(D,F,t).setPosition(r)}}else{var A=new g.Vector3().subVectors(r,j);var D=new g.Vector3().crossVectors(new g.Vector3(0,0,1),A);var B=new g.Vector3();if(D.length()===0){D=new g.Vector3(1,0,0);B=new g.Vector3(0,1,0)}else{B.crossVectors(A,D)}var t=new g.Vector3().crossVectors(D,B).normalize();D.normalize();var F=new g.Vector3().crossVectors(t,D);m.makeBasis(D,F,t);m.multiplyMatrices(new g.Matrix4().makeRotationAxis(t,l.GetPropertyValue("Camera.Roll.Angle")/180*Math.PI),m);m.setPosition(r)}if(l.GetPropertyValue("Camera.LockDistCOI")){var w=new g.Vector3();var v=new g.Vector3();var s=new g.Vector3();m.extractBasis(w,v,s);m.setPosition(new g.Vector3().addVectors(j,s.multiplyScalar(Math.abs(l.GetPropertyValue("Camera.DistCOI")))))}}r.getPositionFromMatrix(m);var C=r.distanceTo(j);l._matrixAndDOI={matrix:m,target:j,doi:C};return l._matrixAndDOI}}});return i});define("DS/VCXWebDressup/VCXPropertyValueHTMLFormater",["UWA/Class",],function(b){var a=b.extend({init:function(){},});a.dumpDate=function(d,e){var c="";if(e){if(e[0]==="%"){c=d.strftime(e)}else{c=d.toLocaleDateString(e)}}else{c=d.toUTCString()}return c};a.format=function(g){var e=g.GetPropertyValue();var h="left";var f;var d;switch(e.GetType()){case"VCXPropertyValueColor":d="border:1px solid #000;background:#"+e.GetThreeColor().getHexString()+";";break;case"VCXPropertyValueFloat":h="right";f=e.Value.toFixed(2);break;case"VCXPropertyValueDate":h="right";f=a.dumpDate(e.Value,"%d/%m/%Y");break;case"VCXPropertyValueInt":h="right";default:f=e.ToString()}var c="<div style='width:100%;height:100%;text-align:"+h+";";if(d){c+=d}c+="'>";if(f){c+=f}c+="</div>";return c};return a});define("DS/VCXWebDressup/VCXPropertyValueUnitFormater",["UWA/Class",],function(a){var b=a.extend({init:function(){},});b.setNLSManager=function(c){b._nlsManager=c};b.format=function(c,l){var f=c.GetPropertyValue();var h=c.GetPropertyInfo();var m;switch(f.GetType()){case"VCXPropertyValueFloat":var i=h.GetUnitType();if(i){var k=l.getManager("VCXUnitManager");if(k){return k.getString(f.Value,i)}}return f.Value.toFixed(2);break;case"VCXPropertyValueEnum":m=f.ToString();var g=h.GetMapChoiceEnum();if(g){m=g[f.Value];var d=l.getManager("VCXNLSManager");if(d){var e=d.GetNLS(h.GetNlsPath());if(e){var j=e.getTitle({key:m,});if(j===undefined){m=""}else{m=j}}}}break;default:m=f.ToString()}return m};return b});define("DS/VCXWebDressup/VCXComponentDressup",["DS/VCXWebExperienceBase/VCXComponentOccurrenceExperience","DS/VCXWebKernelTools/VCXMathTools"],function(a,c){var b=a.extend({init:function(){this._parent();if(this.componentType.startsWith("VCXComponent")){this._name=this.componentType.slice(12)}this._IsDressupPropertiesChangeIndependent=false;this._IsViewPointDependent=false;this._IsAnchorDependent=false;this._dirty=false;this._postUpdateShouldBeDone=false},GetType:function(){return this.componentType},hasPointedObjectMoved:function(d){var f=this.QueryInterface("VCXIModifiable");var e=f&&f._Anchors;if(!(e&&Object.keys(e).length>0)){return false}if(!this._previousAnchors){this._previousAnchors=[]}if(this._pointedObjectMoved===null){this._pointedObjectMoved=false;var g=this;f.processAnchorsIDs(function(i){var j=false;var h=f.GetAnchorWorldMatrix(i,d);if(!c.IsMat1EqualsToMat2(g._previousAnchors[i],h)){g._previousAnchors[i]=h;g._pointedObjectMoved=true;return j}})}return this._pointedObjectMoved},getWorkingRootComponent:function(){var d=this.QueryInterface("VCXIModelNavigable");if(d){var e=d.getWorkingRoot();if(e){return e.GetObject()}else{console.error("No working root for modifiable ??");return null}}console.warn("Not a navigable ??")},getWorkingRootPathElement:function(){var d=this.getWorkingRootComponent();if(d){return d.QueryInterface("W3AISGNodeHolder").getPathElement()}},setDirty:function(d){if(d===undefined){this._dirty=true}else{this._dirty=d}var e=this.QueryInterface("W3AISGNodeHolder");if(e){e.setSGNodeDirty(this._dirty)}if(this._dirty){this._experienceBase.getManager("VCXDressupManager").SetDirty()}},isDirty:function(){return this._dirty},update:function(d){this._postUpdateShouldBeDone=true;var e=this.QueryInterface("W3AISGNodeHolder");if(e&&e.update&&e.update(d)){this._experienceBase.getManager("VCXContextManager").renderAll()}},postUpdate:function(d){this._pointedObjectMoved=null;if(!this._postUpdateShouldBeDone){return}this._postUpdateShouldBeDone=false;var e=this.QueryInterface("W3AISGNodeHolder");if(e&&e.postUpdate){e.postUpdate(d)}if(this.isDirty()){this.setDirty(false)}this._dirtyMask=0},preRender:function(d){var e=this.QueryInterface("W3AISGNodeHolder");if(e&&e.preRender&&e.preRender(d)){}},postRender:function(d){var e=this.QueryInterface("W3AISGNodeHolder");if(e&&e.postRender&&e.postRender(d)){}}});b.EFreeze={NoFreeze:0,Freeze:1,FreezeInPlay:2};Object.defineProperty(b.prototype,"IsDressupPropertiesChangeIndependent",{enumerable:true,configurable:true,get:function(){return this._IsDressupPropertiesChangeIndependent},set:function(d){this._IsDressupPropertiesChangeIndependent=d}});Object.defineProperty(b.prototype,"IsViewPointDependent",{enumerable:true,get:function(){return this._IsViewPointDependent},set:function(d){this._IsViewPointDependent=d}});Object.defineProperty(b.prototype,"IsAnchorDependent",{enumerable:true,get:function(){return this._IsAnchorDependent},set:function(d){this._IsAnchorDependent=d}});Object.defineProperty(b.prototype,"IsDressup",{enumerable:true,writable:false,value:true,});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentDressup"}});return b});define("DS/VCXWebDressup/VCXComponentBomManager",["DS/WebApplicationBase/W3AAManager","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebModifiables/VCXModelChangeListener"],function(f,i,d,l,a,m,e,k){var c=0;var h=1;var g=2;var b=3;var j=f.extend({init:function(){},postUpdate:function(n){this.filterHasChanged=false},GetColumn:function(o){var n=this.QueryInterface("VCXIModifiable");if(n){var q=n.GetProperty("ColumnTreeList.ColumnList");var p=q.GetPropertyValue();if(o>=p._value.length){return undefined}return p.GetValueAtIndex(o)}return undefined},GetColumnName:function(n){var o=this.GetColumn(n);return o===undefined?undefined:o.GetValueAtIndex(c)},GetColumnWidth:function(n){var o=this.GetColumn(n);return o===undefined?undefined:o.GetValueAtIndex(h)},GetColumnCommonRoot:function(n){var o=this.GetColumn(n);return o===undefined?undefined:o.GetValueAtIndex(g)},GetColumnLabel:function(n){var o=this.GetColumn(n);return o===undefined?undefined:o.GetValueAtIndex(b)},GetPropertyValueAt:function(n,p){var o=this.GetColumn(n);return o===undefined?undefined:o.GetValueAtIndex(p)},GetPropertyValueIdentifierAt:function(n,p){var o=undefined;switch(p){case 0:o="ColumnTree.Name";break;case 1:o="ColumnTree.Width";break;case 2:o="ColumnTree.CommonRoot";break;case 3:o="ColumnTree.Label";break;default:break}return o},GetColumnNumber:function(){var n=this.QueryInterface("VCXIModifiable");if(n){var p=n.GetProperty("ColumnTreeList.ColumnList");var o=p.GetPropertyValue();return o._value.length}return 0},SetSortOption:function(r){var n=this.QueryInterface("VCXIModifiable");if(n){var p=new l();p.SetValue(r.propertyName);var o=new i(new d("BOM.Sort.PropertyName",0),p);var q=new m(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"),true);q.ChangeProperty(n,o);this._experienceBase.getManager("VCXCommandManager").Push(q);p=new a();p.SetValue(r.ascendant);o=new i(new d("BOM.Sort.Ascendant",0),p);q=new m(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"),true);q.ChangeProperty(n,o);this._experienceBase.getManager("VCXCommandManager").Push(q)}},GetSortOption:function(){var p=this.QueryInterface("VCXIModifiable");if(p){var q=p.GetProperty("BOM.Sort.Ascendant");var o=q.GetPropertyValue().Value;q=p.GetProperty("BOM.Sort.PropertyName");var n=q.GetPropertyValue().Value;return{propertyName:n,ascendant:o}}return 0},GetColumnPropertyValuesNumber:function(){return 4},GetBOMId:function(p){var n=this.GetBOMContent(false);var q=p.GetObject();var o=q.QueryInterface("W3AISGNodeHolder").getPathElement().getLastElement();for(var r=1;true;r++){if(!n[r]){return r}else{if(n[r].element===o){return r}}}},GetBOMContent:function(q){var A=false;var D=[];var x=this._experienceBase.getManager("VCXDressupManager");var n=x.getDressupsFromGroup("Callouts");for(var v=0;v<n.length;v++){var p=n[v];if(p){var w=p.QueryInterface("VCXIVisibility");if(w&&w.GetVisibility()!==e.EVisState.Hidden){var s=p.QueryInterface("VCXIModifiable");if(s){var C;var B=s.GetAttachedOccurences();for(var z=0;z<B.length;z++){var r=B[z];if(r){var y=r.QueryInterface("VCXIModifiable");if(y){var o=y.GetProperty("Actor.BomId");if(o){C=o.GetPropertyValue().Value;if(C){A=true;if(!D[C]){D[C]={};D[C].calloutComponents=[];D[C].itemComponents=[]}D[C].calloutComponents.push(p);if(D[C].itemComponents.indexOf(r)<0){D[C].itemComponents.push(r)}D[C].element=r.QueryInterface("W3AISGNodeHolder").getPathElement().getLastElement()}}}}}}}}}if(!A){q=false}var u=this._experienceBase.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence");for(var t=0;t<u.length;t++){var r=u[t];if(r){var y=r.QueryInterface("VCXIModifiable");if(y){var o=y.GetProperty("Actor.BomId");if(o){var C=o.GetPropertyValue().Value;if(C){if(!q){if(!D[C]){D[C]={};D[C].itemComponents=[]}}if(D[C]&&D[C].itemComponents.indexOf(r)<0){D[C].itemComponents.push(r);D[C].element=r.QueryInterface("W3AISGNodeHolder").getPathElement().getLastElement()}}}}}}return D}});Object.defineProperty(j.prototype,"filterHasChanged",{enumerable:true,get:function(){return this._filterHasChanged},set:function(n){this._filterHasChanged=n}});Object.defineProperty(j.prototype,"ListHasChanged",{enumerable:true,get:function(){var n=false;var o=this._experienceBase.getManager("VCXModelChangeListener");if(o){n|=o.hasChanged(k.FChangeFlag.BomID);n|=o.hasChanged(k.FChangeFlag.DressupVisibility)}n|=this.filterHasChanged;return n}});Object.defineProperty(j.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentBomManager"}});return j});define("DS/VCXWebDressup/VCXBOMInfoModifiable",["UWA/Core","DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueMap"],function(g,b,c,e,f,d){var a=b.extend({init:function(){this._parent()},GetType:function(){return"VCXBOMInfoModifiable"},OnChangeProperty:function(p,n,t){if(t){}else{t={}}if(t.fromChildClass){}else{if(this.OnChangePropertyBegin(p,n)){return true}}switch(p){case"GroupInfoPropSet":var r=n.GetValue();for(var q=0;q<r.length;q++){var k=r[q];var s=k.GetValue();var m=null;var h=null;for(var o=0;o<s.length;o++){var l=s[o];switch(l.name){case"Id":m=l.GetValue();break;case"Name":h=l.GetValue();break}}this.GetObject().addBomInfoRow(m,h)}break;default:t.fromChildClass=true;return this._parent(p,n,t)}return true},OnChangePropertiesEnd:function(){},GetProperty:function(i){var h=null;if(i==="GroupInfoPropSet"){}else{h=this._parent(i)}return h},GetProperties:function(){var h=this._parent();h.AddOrModifyProperty(this.GetProperty("Actor.Opacity"));return h}});return a});define("DS/VCXWebDressup/VCXVisibilityDressup",["DS/VCXWebVisibility/VCXVisibility"],function(a){var b=a.extend({init:function(){this._parent();this._visible=0},GetType:function(){return"VCXVisibilityDressup"},SetVisibility:function(c){var d=c;if(typeof c==="boolean"){console.warn("Method SetVisibility use only a number as unique parameter");d=(typeof c==="number"&&(c===1||c===0))?c:(c===true)?1:(c===false)?0:-1}else{if(typeof c!=="number"){console.warn("Method SetVisibility use only a number as unique parameter");return}}this._parent(d);this.GetObject().setDirty()},});return b});define("DS/VCXWebDressup/VCXPropertiesObserver",["UWA/Class"],function(a){var b=a.extend({init:function(c){this._observedProperties=[];this._dirtyProperties=0},add:function(f,e){var d=f.QueryInterface("VCXIModifiable");if(d&&e){var g=d.GetProperty(e);var c=null;if(g){c=g.GetPropertyValue()}this._observedProperties.push({modifiable:d,propertyName:e,previousPropertyValue:null,currentPropertyValue:c,dirty:true});this._dirtyProperties++}},update:function(){for(var d=0;d<this._observedProperties.length;d++){var f=false;var c=this._observedProperties[d].modifiable.GetProperty(this._observedProperties[d].propertyName);var e=null;if(c){e=c.GetPropertyValue()}var g=this._observedProperties[d].currentPropertyValue;if(g){if(!g.IsEqualTo(e)){f=true}}else{if(e){f=true}}if(f){this._observedProperties[d].previousPropertyValue=g;this._observedProperties[d].currentPropertyValue=e;this._dirtyProperties++}}},dirtify:function(){this._dirtyProperties++},postUpdate:function(){this._dirtyProperties=0;for(var c=0;c<this._observedProperties.length;c++){this._observedProperties[c].dirty=false}},isDirty:function(){return(this._dirtyProperties>0)}});return b});define("DS/VCXWebDressup/VCXComponentCamera",["DS/VCXWebDressup/VCXComponentDressup"],function(a){var b=a.extend({init:function(){this._parent();this.IsViewPointDependent=false;this.IsAnchorDependent=true;this._tooltip=""},updatePosition:function(){var d=this.GetObject()._experienceBase.getManager("VCXVisuManager");var e=this.QueryInterface("VCXIViewpointController");if(e){e.resetMatrixAndDOI();if(d.CameraControlsViewpoint&&this.QueryInterface("VCXIModifiable").GetProperty("Actor.IsActive").GetPropertyValue().Value){e.toViewpoint()}}var c=d.getActiveViewport();if(c){var e=c.QueryInterface("VCXIViewpointController");if(e){e.fromViewpoint()}}}});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentCamera"}});b.prototype._dressupFamily="Cameras";return b});define("DS/VCXWebDressup/VCXComponentPolyline",["DS/VCXWebDressup/VCXComponentDressup"],function(b){var a=b.extend({init:function(){this._parent();this.IsAnchorDependent=true},});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentPolyline"}});a.prototype._dressupFamily="Markups";return a});define("DS/VCXWebDressup/VCXComponentCompass",["DS/VCXWebDressup/VCXComponentDressup"],function(b){var a=b.extend({init:function(){this._parent()}});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentCompass"}});a.prototype._dressupFamily="Environment";return a});define("DS/VCXWebDressup/VCXComponentSection",["DS/VCXWebDressup/VCXComponentDressup","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXColor","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebVisibility/VCXIVisibility"],function(f,d,c,e,b){var a=f.extend({init:function(){this._parent();this.IsAnchorDependent=true;this._keyValues={};this._plane=null;this._planeClipped=false;this._cappingMaterial=null;this._previousSectionActive=false;this.alpha=0.15},isCut:function(i,h){var g=false;var j=this;if(this._plane&&this.sectionActive&&i.GetPropertyValue("Collab.Attach.3DAttach")){g=true;i.processAnchorsIDs(function(k){var o=false;var n=i._Anchors[k];if(n){var l=i.GetAnchorWorldMatrix(k,h).clone();var p=j._plane.distanceToPoint(new d.Vector3().getPositionFromMatrix(l));if(p>0){g=false;return o}else{var m=n.GetValueLink();if(m&&m.Value){if(!j.isInCuttedObjectList(m.Value)){g=false;return o}}}}});return g}return g},isInCuttedObjectList:function(j){var g=false;var i=this.QueryInterface("VCXIModifiable");var k=i.GetProperty("Actor.ListActors");if(k){var h=k.GetPropertyValue().GetValue();if(h&&h.length){for(var l=0;l<h.length;l++){g=true;if(h[0].GetValue()===j){return true}}}}if(!g){return true}return false},preRender:function(i){if(this._plane){var h=this.QueryInterface("VCXIModifiable");var j=this.QueryInterface("W3AISGNodeHolder");var g=j.getWorldMatrix(i.viewer);this._plane.set(new d.Vector3(0,0,1),0).applyMatrix4(g);if(h.GetPropertyValue("Section.AutoFlip")){if(i.viewpoint.getSightDirection().dot(this._plane.normal)<0){this._plane.negate()}}}this._parent(i)},isActive:function(){var g=this.QueryInterface("VCXIVisibility");if(g&&g.GetVisibility()!==b.EVisState.Hidden){var h=this.QueryInterface("VCXIModifiable");if(h&&h.GetPropertyValue("Section.Enable")&&h.GetPropertyValue("Actor.Visibility.Opacity")>0.5){return true}}return false},update:function(k){if(this.recomputeSectionManager){this.recomputeSectionManager.update();if(this.recomputeSectionManager.isDirty()){if(this._experienceBase.getManager("VCXSectionManager")){this._experienceBase.getManager("VCXSectionManager").Dirty=true}}}this.sectionActive=this.isActive();if(this._previousSectionActive!==this.sectionActive){this._previousSectionActive=this.sectionActive;if(this.sectionActive){this._experienceBase.getManager("VCXSectionManager").registerSection(this)}else{this._experienceBase.getManager("VCXSectionManager").unregisterSection(this)}}if(!this._plane){this._plane=new d.Plane(new d.Vector3(0,0,-1),0)}if(this.sectionActive){if(!this.recomputeSectionManager){this.recomputeSectionManager=new e();var i=this.QueryInterface("VCXIModifiable");this.recomputeSectionManager.add(i,"Section.Enable");this.recomputeSectionManager.add(i,"Section.SpaceBackAlpha");this.recomputeSectionManager.add(i,"Section.Capping");this.recomputeSectionManager.add(i,"Section.Capping.ActorColor")}if(!this._cappingMaterial){var i=this.QueryInterface("VCXIModifiable");var m=this._experienceBase.getManager("VCXContextManager").getMainViewer();m.setClippingPlaneUpVector(this._plane,new d.Vector3(0,0,1));var j=Math.cos(i.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180);var l=Math.sin(i.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180);var g=i.GetColorPropertyValue("Section.Capping");var h=i.GetColorPropertyValue("Section.Hatching");this._cappingMaterial=new d.HatchingMeshMaterial({stripesDirection:new d.Vector2(j+l,l-j),spaceWidth:10,stripesWidth:1.5,spaceColor:g.GetThreeColor(),stripesColor:new c().FromRGBA(1,0,0).GetThreeColor(),})}}return this._parent(k)},postUpdate:function(g){this._parent();if(this.sectionActive){if(this.recomputeSectionManager){this.recomputeSectionManager.postUpdate()}}},Dispose:function(){this._experienceBase.getManager("VCXSectionManager").unregisterSection(this)}});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentSection"}});a.prototype._dressupFamily="CuttingPlanes";return a});define("DS/VCXWebDressup/VCXComponentRedLine",["DS/VCXWebDressup/VCXComponentDressup"],function(a){var b=a.extend({init:function(){this._parent();this.IsAnchorDependent=true}});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentRedLine"}});b.prototype._dressupFamily="Markups";return b});define("DS/VCXWebDressup/VCXComponentGround",["DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebVisibility/VCXIVisibility"],function(c,a){var b=c.extend({init:function(){this._parent()},updatePosition:function(){var d=this.QueryInterface("VCXIVisibility");if(d&&d.GetVisibility()!==a.EVisState.Hidden){var f=this._experienceBase.getManager("VCXContextManager");if(f){var i={};var g=f.getRootPathElement();if(g){var h=g.getBoundingBox(null,f.getMainViewer());var e=g.getBoundingSphere(f.getMainViewer());if(h&&e){h.applyMatrix4(g.getWorldMatrix());var j=this.QueryInterface("VCXIModifiable");if(j){if(j.GetPropertyValue("Environment.Ground.Diameter.Auto")){i.groundSize=3*e.radius}else{i.groundSize=j.GetPropertyValue("Environment.Ground.Diameter")}i.groundCenter=e.center.clone();i.groundCenter.z=h.min.z;f.applyToViewers(function(k){k.setAutomaticPlaneUpdate(false);k.setGroundOptions(i)})}}}}}}});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentGround"}});b.prototype._dressupFamily="Environment";return b});define("DS/VCXWebDressup/VCXComponentBOM",["DS/VCXWebDressup/VCXComponentDressup"],function(a){var b=a.extend({init:function(){this._parent()},isDirty:function(){if(!this._dirty){if(this._experienceBase.getManager("VCXComponentBomManager")){return this._experienceBase.getManager("VCXComponentBomManager").ListHasChanged}}return this._dirty}});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentBOM"}});b.prototype._dressupFamily="Panels";return b});define("DS/VCXWebDressup/AmbienceModel_Spec",["DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebKernelTools/VCXFileServices","DS/Visualization/ThreeJS_DS"],function(e,b,a,c){var d=e.extend({init:function(){this._parent()},updatePosition:function(){if(!this._ambience){return false}var g=this.QueryInterface("VCXIVisibility");if(g&&g.GetVisibility()!==b.EVisState.Hidden){var i=this._experienceBase.getManager("VCXContextManager");if(i){var f=i.getRootPathElement();if(f){var o=f.getBoundingBox(null,i.getMainViewer());var k=f.getBoundingSphere(i.getMainViewer());if(o&&k){if(!Number.isFinite(o.max.x)){o.max.set(1,1,1);o.min.set(-1,-1,-1);k.radius=1}o.applyMatrix4(f.getWorldMatrix());var j=this.QueryInterface("VCXIModifiable");if(j){var l={};var m=1;if(j.GetPropertyValue("Environment.Ground.Disc.Diameter.Auto")){l.groundSize=3*k.radius}else{l.groundSize=j.GetPropertyValue("Environment.Ground.Disc.Diameter")}this._ambience.setAutoGroundOffset(false);this._ambience.setGroundScale(j.GetPropertyValue("Environment.Ground.Scale"));this._ambience.setGroundHeight(new c.Vector3(0,0,j.GetPropertyValue("Environment.Ground.Scaleratio")/6));this._ambience.setGroundRadius(j.GetPropertyValue("Environment.Background.Radius"));var h=k.center.clone();h.z=o.min.z;this._ambience.setGroundPosition(h);var n=j.GetPropertyValue("Environment.Ground.Offset")*j.GetPropertyValue("Environment.Background.Radius");this._ambience.setGroundOffset(n);if(this._ambience.setGroundOptions){this._ambience.setGroundOptions(l)}this._ambience.setEnvMapOffset(j.GetPropertyValue("Environment.Background.Rotation")/180*Math.PI);this._ambience.setFiniteMode(j.GetPropertyValue("Environment.Background.Radius")>0)}}}}}}});Object.defineProperty(d.prototype,"componentType",{enumerable:true,get:function(){return"AmbienceModel_Spec"}});d.prototype._dressupFamily="Environment";return d});define("DS/VCXWebDressup/VCXComponentMarkup",["DS/VCXWebDressup/VCXComponentDressup"],function(b){var a=b.extend({init:function(c){this._parent(c);this.fontHeight=12}});a.EHAlignment={Left:0,Middle:1,Right:2};a.EVAlignment={Top:0,Middle:1,Bottom:2};a.EBodyShape={None:0,Rectangle:10,RoundedRectangle:1,Square:20,RoundedSquare:2,Ellipse:4,Circle:3,Rhombus:5,RemoveBorder:6,User:7,CircumscribedCircle:8,};a.ESizeControlType={None:0,Paper:1};a.EBillboardType={None:0,Spherical:2,AlongX_yInCamUp:4};a.EPositionType={Perimetric:0,Circle:1,Rectangle:2,Bottom:3,BottomAndLeft:4,BottomAndRight:5,BottomAndTop:6,Top:7,TopAndLeft:8,TopAndRight:9,Left:10,LeftAndRight:11,Right:12,EndOfAutomaticPositionning:100,RelativeToReferential:101,Free2D:1000,Free3D:1001,};a.EAttachType={None:0,Model:1,Vertex:2,GradientTooltip:3,TooltipStyle:4,Line:5,User:6,Simple:7,ArcTooltip:8,Arrow:9,Modern:100,Custom:101};a.EExtremityType={None:0,Sphere:1,FullArrow_1:2,FullArrow_2:3,HalfArrow_B1:4,HalfArrow_T1:5,HalfArrow_T2:6,HalfArrow_B2:7,Dot:20,Yellow:10,Red:40,Line:45,SmallRed:50,};a.ELeadType={None:0,Middle:10,Bent:20,Line:30,Mustache:40};Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentMarkup"}});Object.defineProperty(b.prototype,"IsDressupPropertiesChangeIndependent",{enumerable:true,get:function(){if(this._IsDressupPropertiesChangeIndependent){return true}else{var c=this.QueryInterface("VCXIModifiable");if(c&&c.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<a.EPositionType.EndOfAutomaticPositionning){return true}}return this._IsDressupPropertiesChangeIndependent}});return a});define("DS/VCXWebDressup/VCXDressupManipulator",["DS/WebApplicationBase/W3AAManager","DS/VisuEvents/EventsManager","DS/Manipulators/ScreenPlaneManipulator","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebDressup/VCXComponentMarkup"],function(h,g,d,a,c,f,b){var e=h.extend({initialize:function(){this._locationTargetedOnDressup={outside:-1,center:0,topLeft:1,top:2,topRight:3,right:4,bottomRight:5,bottom:6,bottomLeft:7,left:8};this.marginWidthInMM=10;this.dressupManipulators={};this._mouveMoveCBlist={};this._activeManipulatorDressupID=null},postInitialize:function(){this._experienceBase=this._experienceBase;var j=this;var i=function(k){var l=function l(n){if(j.dressupManipulators[k.GetObject().GetID()].manipulator.manipulatedPaths.length===0){var m=j._getCursorLocationOnDressup(k,n.from[0].currentPosition);if(m===null){return}if(j._experienceBase.getManager("VCXExperience").GetPreviewMode()&&j._modifiableHasHyperlink(k)){}else{if(k.GetPropertyValue("Collab.Body.FitToText")&&k.GetComputedStringProperty("Collab.Text")===""){j._renderCursorFeedback(m)}else{if(m!==j._locationTargetedOnDressup.outside){j._renderCursorFeedback(j._locationTargetedOnDressup.center)}else{j._renderCursorFeedback(m)}}}}};return l};this._tokenPrehilightAdd=a.subscribe({event:"VCX_PREHIGHLIGHT_ADD"},function(m){var k=f.GetModifiableFromPathElement(m.pathElement,j._experienceBase);if(k&&k.GetObject().IsDressup){if(k.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=b.EPositionType.Free2D){if(!(k.GetPropertyValue("Collab.3D.Paper.Paper.Position.X"))||!(k.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y"))){console.warn("Dressup is in paper but don't have supported in-paper positionning properties.");return}if(!(j.dressupManipulators[k.GetObject().GetID()])||k.GetObject().GetID()!==j._activeManipulatorDressupID){if(j._activeManipulatorDressupID!==null&&k.GetObject().GetID()!==j._activeManipulatorDressupID){g.removeEvent(j._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerMoveUnique",j._mouveMoveCBlist[j._activeManipulatorDressupID]);delete j._mouveMoveCBlist[j._activeManipulatorDressupID];var n=j.dressupManipulators[j._activeManipulatorDressupID];n.manipulator.deactivate(n.token)}if(!(j.dressupManipulators[k.GetObject().GetID()])){j._createPaperDressupManipulator(k.GetObject())}else{var l=j.dressupManipulators[k.GetObject().GetID()];l.manipulator.activate(l.token)}j._activeManipulatorDressupID=k.GetObject().GetID()}if(!(j._mouveMoveCBlist[k.GetObject().GetID()])){j._mouveMoveCBlist[k.GetObject().GetID()]=i(k);g.addEvent(j._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerMoveUnique",j._mouveMoveCBlist[k.GetObject().GetID()])}}}});this._tokenDressupChanged=a.subscribe({event:"VCX_DRESSUPS_REMOVED"},function(m){if(Array.isArray(m)){for(var k=0;k<m.length;++k){var l=m[k]._ID;if(j.dressupManipulators[l]){var n=j.dressupManipulators[l];n.manipulator.unlink(n.token);delete j.dressupManipulators[l];if(j._activeManipulatorDressupID===l){j._activeManipulatorDressupID=null}if(j._mouveMoveCBlist[l]){g.removeEvent(j._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerMoveUnique",j._mouveMoveCBlist[l]);delete j._mouveMoveCBlist[l]}j._renderCursorFeedback()}}}});this._tokenScenarioChange=a.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(k){if(k.GetID()==="VCX_Scenario_Transition"){return}j.unInitialize(true)})},unInitialize:function(i){for(var j in this.dressupManipulators){if(this.dressupManipulators.hasOwnProperty(j)){var k=this.dressupManipulators[j];k.manipulator.unlink(k.token);if(this._mouveMoveCBlist[j]){g.removeEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerMoveUnique",this._mouveMoveCBlist[j])}}}this.dressupManipulators={};this._mouveMoveCBlist={};this._activeManipulatorDressupID=null;if(!i){a.unsubscribe(this._tokenPrehilightAdd);a.unsubscribe(this._tokenDressupChanged);a.unsubscribe(this._tokenScenarioChange)}},_renderCursorFeedback:function(j){var i="auto";switch(j){case this._locationTargetedOnDressup.center:i="grab";break;case this._locationTargetedOnDressup.topLeft:i="nw-resize";break;case this._locationTargetedOnDressup.top:i="n-resize";break;case this._locationTargetedOnDressup.topRight:i="ne-resize";break;case this._locationTargetedOnDressup.right:i="e-resize";break;case this._locationTargetedOnDressup.bottomRight:i="se-resize";break;case this._locationTargetedOnDressup.bottom:i="s-resize";break;case this._locationTargetedOnDressup.bottomLeft:i="sw-resize";break;case this._locationTargetedOnDressup.left:i="w-resize";break;default:break}this._experienceBase.getManager("VCXGUIManager").SetCursor(i)},_getCursorLocationOnDressup:function(r,n){var q=r.GetPropertyValue("Collab.Body.Height");var s=r.GetPropertyValue("Collab.Body.Width");var i=r.GetPropertyValue("Collab.3D.Paper.Paper.Position.X");var w=r.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y");if(!(q&&s&&i&&w)){console.error("A property is missing to get cursor location..");return null}var v=new c.Vector2(i+s/2,w+q/2);var j=this._experienceBase.getManager("VCXPaperManager").PixelToMM2(null,n);var o=j.y>v.y-q/2&&j.y<v.y+q/2&&j.x>v.x-s/2&&j.x<v.x+s/2;if(!o){return this._locationTargetedOnDressup.outside}var l=(q>4*this.marginWidthInMM)?this.marginWidthInMM:q/4;var m=(s>4*this.marginWidthInMM)?this.marginWidthInMM:s/4;var p=j.y>v.y-q/2&&j.y<v.y-q/2+l;var u=j.y>v.y+q/2-l&&j.y<v.y+q/2;var t=j.x>v.x-s/2&&j.x<v.x-s/2+m;var k=j.x>v.x+s/2-m&&j.x<v.x+s/2;if(p){if(t){return this._locationTargetedOnDressup.topLeft}else{if(k){return this._locationTargetedOnDressup.topRight}else{return this._locationTargetedOnDressup.top}}}else{if(u){if(t){return this._locationTargetedOnDressup.bottomLeft}else{if(k){return this._locationTargetedOnDressup.bottomRight}else{return this._locationTargetedOnDressup.bottom}}}else{if(t){return this._locationTargetedOnDressup.left}else{if(k){return this._locationTargetedOnDressup.right}else{return this._locationTargetedOnDressup.center}}}}},_createPaperDressupManipulator:function(j){if(!(this.dressupManipulators[j.GetID()])){this.dressupManipulators[j.GetID()]={}}var i=j.QueryInterface("VCXIModifiable");if(i&&(i.GetPropertyValue("Collab.Body.FitToText")&&i.GetComputedStringProperty("Collab.Text")===""||!(i.GetPropertyValue("Collab.Body.FitToText")))){this._createPaperGlobalManipulator(j)}else{this._createPaperTranslationManipulator(j)}},_createPaperTranslationManipulator:function(l){var o=l.QueryInterface("W3AISGNodeHolder");var n=o&&o.getPathElement();var j=l.QueryInterface("VCXIModifiable");if(!n||!j){console.log("Issue during translation manipulator creation: PathElement or modifiable not found for this component");return}var m={cameraName:"camera"};var i=new d(m);i.setExclusive(true);var k=i.linkToPath(n);i.setPickingInManipulation(true);this.dressupManipulators[l.GetID()].manipulator=i;this.dressupManipulators[l.GetID()].token=k;var p=this;i.onBeginManipulate(function(q){if(p._experienceBase.getManager("VCXGUIManager")._isPlayingGoTo){return}if(!(p._experienceBase.getManager("VCXExperience").GetPreviewMode()&&p._modifiableHasHyperlink(j))){p._renderCursorFeedback(p._locationTargetedOnDressup.center);p._experienceBase.getManager("VCXCommandManager").StartTransaction();p._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint.setControlActive({picking:false})}});i.onManipulate(function(q){if(p._experienceBase.getManager("VCXGUIManager")._isPlayingGoTo){return}if(!(p._experienceBase.getManager("VCXExperience").GetPreviewMode()&&p._modifiableHasHyperlink(j))){p._manipulateDressupTranslate(q,j);p._renderCursorFeedback(p._locationTargetedOnDressup.center)}});i.onEndManipulate(function(r){if(p._experienceBase.getManager("VCXGUIManager")._isPlayingGoTo){return}if(!(p._experienceBase.getManager("VCXExperience").GetPreviewMode()&&p._modifiableHasHyperlink(j))){p._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint.setControlActive({picking:true});p._experienceBase.getManager("VCXCommandManager").EndTransaction();var q=p._getCursorLocationOnDressup(j,r.event.from[0].currentPosition);p._renderCursorFeedback(q);p._experienceBase.getManager("VCXContextManager").renderAll({updateInfinitePlane:true})}})},_createPaperGlobalManipulator:function(j){var p=this;var m=j.QueryInterface("W3AISGNodeHolder");var l=m&&m.getPathElement();var i=j.QueryInterface("VCXIModifiable");if(!l||!i){console.log("Issue during global manipulator creation: PathElement or modifiable not found for this component");return}var k={cameraName:"camera"};var o=new d(k);var n=o.linkToPath(l);o.setExclusive(true);o.setPickingInManipulation(true);this.dressupManipulators[j.GetID()].manipulator=o;this.dressupManipulators[j.GetID()].token=n;o.onBeginManipulate(function(t){if(p._experienceBase.getManager("VCXGUIManager")._isPlayingGoTo){p.initDressupManipInfo={doNotManipulate:true};return}var u=i.GetPropertyValue("Collab.Body.Shape");var y=i.GetPropertyValue("Collab.Body.Height");var z=i.GetPropertyValue("Collab.Body.Width");var B=p._experienceBase.getManager("VCXPaperManager").MMToPixel(y);var C=p._experienceBase.getManager("VCXPaperManager").MMToPixel(z);var q=i.GetPropertyValue("Collab.3D.Paper.Paper.Position.X");var D=i.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y");if(!y||!z||!q||!D){console.error("Property not found, the manipulation cannot be processed. Aborted.");p.initDressupManipInfo={doNotManipulate:true};return}var A=new c.Vector2(q+z/2,D+y/2);var s=new c.Vector2(p._experienceBase.getManager("VCXPaperManager").MMToPixelX(A.x),p._experienceBase.getManager("VCXPaperManager").MMToPixelY(A.y));var r=t.event.from[0].currentPosition.clone();p.initDressupManipInfo={shape:u,height:{mm:y,px:B},width:{mm:z,px:C},center:{mm:A,px:s},manipulationType:null,doNotManipulate:false};switch(u){case 0:case 1:case 2:case 6:p.initDressupManipInfo.manipulationType=p._getCursorLocationOnDressup(i,r);break;case 3:p.initDressupManipInfo.doNotManipulate=true;return;case 4:var x=new c.Vector2().subVectors(r,s);var w=p._experienceBase.getManager("VCXPaperManager").PixelToMM(x);var v=(y>4*p.marginWidthInMM)?p.marginWidthInMM:y/4;if((w<y/2)&&(w>y/2-v)){p.initDressupManipInfo.manipulationType=1}else{if(w<y/2-v){p.initDressupManipInfo.manipulationType=p._locationTargetedOnDressup.center}else{p.initDressupManipInfo.doNotManipulate=true;return}}break;default:p.initDressupManipInfo.doNotManipulate=true;return}if(p._experienceBase.getManager("VCXExperience").GetPreviewMode()&&p._modifiableHasHyperlink(i)&&p.initDressupManipInfo.manipulationType===p._locationTargetedOnDressup.center){p._renderCursorFeedback()}else{p._renderCursorFeedback(p.initDressupManipInfo.manipulationType)}p._experienceBase.getManager("VCXCommandManager").StartTransaction();p._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint.setControlActive({picking:false})});o.onManipulate(function(x){if(p.initDressupManipInfo.doNotManipulate===true){return}p._renderCursorFeedback(p.initDressupManipInfo.manipulationType);if(!(p._experienceBase.getManager("VCXExperience").GetPreviewMode()&&p._modifiableHasHyperlink(i))&&p.initDressupManipInfo.manipulationType===p._locationTargetedOnDressup.center){p._manipulateDressupTranslate(x,i)}else{var v=function(A){var z=new c.Vector2(A.pageX,A.pageY);var y=p._experienceBase.getManager("VCXContextManager").getMainViewer().getMousePosition(z);return new c.Vector2(y.xPix,y.yPix)};var r;for(var t=0;t<x.event.from.length;++t){var u=x.event.from[t].type;if(u==="Mouse"){r=v(x.event.from[t].event);break}else{if(u==="Touch"){r=v(x.event.from[t].event.changedTouches[0]);break}}}if(!r){console.log("cursorCurrPosInPx not found !");return}switch(p.initDressupManipInfo.shape){case 0:p._resizeRectangleManip(i,p.initDressupManipInfo,r);break;case 1:p._resizeRectangleManip(i,p.initDressupManipInfo,r);break;case 2:p._resizeSquareManip(i,p.initDressupManipInfo,r);break;case 4:if(!(i.GetPropertyValue("Collab.Body.Height")&&i.GetPropertyValue("Collab.Body.Width"))){break}var w=new c.Vector2().subVectors(r,p.initDressupManipInfo.center.px).length;var q=p._experienceBase.getManager("VCXPaperManager").PixelToMM(w);var s=i.GetProperty("Collab.Body.Height").GetPropertyValue().Clone();s.SetValue(q*2);i.OnChangeProperty("Collab.Body.Height",s);i.OnChangeProperty("Collab.Body.Width",s);a.publish({event:"VCX_PROPERTIES_CHANGED"});break;default:return}}p._experienceBase.getManager("VCXContextManager").renderAll()});o.onEndManipulate(function(r){if(p.initDressupManipInfo){if(p.initDressupManipInfo.doNotManipulate===true){p.initDressupManipInfo=null;return}if(p.initDressupManipInfo.manipulationType!==p._locationTargetedOnDressup.center){o.unlink(n);n=o.linkToPath(l);p.dressupManipulators[j.GetID()].token=n}p._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint.setControlActive({picking:true});p._experienceBase.getManager("VCXCommandManager").EndTransaction();var q=p._getCursorLocationOnDressup(i,r.event.from[0].currentPosition);p._renderCursorFeedback(q);p._experienceBase.getManager("VCXContextManager").renderAll({updateInfinitePlane:true});p.initDressupManipInfo=null}})},_resizeRectangleManip:function(j,m,w){var v=this._experienceBase.getManager("VCXPaperManager").PixelToMM2(null,w);var A=null;var z=null;var s=null;var y=null;var r=m.manipulationType===this._locationTargetedOnDressup.topLeft||m.manipulationType===this._locationTargetedOnDressup.bottomLeft||m.manipulationType===this._locationTargetedOnDressup.left;var t=m.manipulationType===this._locationTargetedOnDressup.topRight||m.manipulationType===this._locationTargetedOnDressup.bottomRight||m.manipulationType===this._locationTargetedOnDressup.right;if(r){var l=m.center.mm.x-m.width.mm/2;var C=v.x-l;var s=m.width.mm-C;if(s<0){A=l+m.width.mm;s=-s}else{A=l+C}}else{if(t){var q=m.center.mm.x+m.width.mm/2;var i=v.x-q;var s=m.width.mm+i;if(s<0){A=q+i;s=-s}else{A=q-m.width.mm}}}var F=m.manipulationType===this._locationTargetedOnDressup.topLeft||m.manipulationType===this._locationTargetedOnDressup.topRight||m.manipulationType===this._locationTargetedOnDressup.top;var E=m.manipulationType===this._locationTargetedOnDressup.bottomLeft||m.manipulationType===this._locationTargetedOnDressup.bottomRight||m.manipulationType===this._locationTargetedOnDressup.bottom;if(F){var o=m.center.mm.y-m.height.mm/2;var u=v.y-o;var y=m.height.mm-u;if(y<0){z=o+m.height.mm;y=-y}else{z=o+u}}else{if(E){var p=m.center.mm.y+m.height.mm/2;var x=v.y-p;var y=m.height.mm+x;if(y<0){z=p+x;y=-y}else{z=p-m.height.mm}}}if(s!==null&&j.GetProperty("Collab.Body.Width")){var B=j.GetProperty("Collab.Body.Width").GetPropertyValue();B.SetValue(s);j.OnChangeProperty("Collab.Body.Width",B)}if(y!==null&&j.GetProperty("Collab.Body.Height")){var k=j.GetProperty("Collab.Body.Height").GetPropertyValue();k.SetValue(y);j.OnChangeProperty("Collab.Body.Height",k)}if(A!==null&&j.GetProperty("Collab.3D.Paper.Paper.Position.X")){var D=j.GetProperty("Collab.3D.Paper.Paper.Position.X").GetPropertyValue();D.SetValue(A);j.OnChangeProperty("Collab.3D.Paper.Paper.Position.X",D)}if(z!==null&&j.GetProperty("Collab.3D.Paper.Paper.Position.Y")){var n=j.GetProperty("Collab.3D.Paper.Paper.Position.Y").GetPropertyValue();n.SetValue(z);j.OnChangeProperty("Collab.3D.Paper.Paper.Position.Y",n)}a.publish({event:"VCX_PROPERTIES_CHANGED"})},_resizeSquareManip:function(u,p,n){var m=this._experienceBase.getManager("VCXPaperManager").PixelToMM2(null,n);var o={height:u.GetProperty("Collab.Body.Height").GetPropertyValue().Clone(),width:u.GetProperty("Collab.Body.Width").GetPropertyValue().Clone(),paperPosX:u.GetProperty("Collab.3D.Paper.Paper.Position.X").GetPropertyValue().Clone(),paperPosY:u.GetProperty("Collab.3D.Paper.Paper.Position.Y").GetPropertyValue().Clone()};var j=null;var r=o.paperPosX.GetValue();var q=o.paperPosY.GetValue();var w=o.height.GetValue();var i=p.manipulationType===this._locationTargetedOnDressup.bottomLeft||p.manipulationType===this._locationTargetedOnDressup.bottomRight||p.manipulationType===this._locationTargetedOnDressup.topLeft||p.manipulationType===this._locationTargetedOnDressup.topRight;var s=p.manipulationType===this._locationTargetedOnDressup.left||p.manipulationType===this._locationTargetedOnDressup.right;var l=p.manipulationType===this._locationTargetedOnDressup.top||p.manipulationType===this._locationTargetedOnDressup.bottom;switch(p.manipulationType){case this._locationTargetedOnDressup.topLeft:j=new c.Vector2(p.center.mm.x+p.width.mm/2,p.center.mm.y+p.height.mm/2);break;case this._locationTargetedOnDressup.topRight:j=new c.Vector2(p.center.mm.x-p.width.mm/2,p.center.mm.y+p.height.mm/2);break;case this._locationTargetedOnDressup.bottomRight:j=new c.Vector2(p.center.mm.x-p.width.mm/2,p.center.mm.y-p.height.mm/2);break;case this._locationTargetedOnDressup.bottomLeft:j=new c.Vector2(p.center.mm.x+p.width.mm/2,p.center.mm.y-p.height.mm/2);break;case this._locationTargetedOnDressup.top:j=new c.Vector2(p.center.mm.x,p.center.mm.y+p.height.mm/2);break;case this._locationTargetedOnDressup.bottom:j=new c.Vector2(p.center.mm.x,p.center.mm.y-p.height.mm/2);break;case this._locationTargetedOnDressup.left:j=new c.Vector2(p.center.mm.x+p.width.mm/2,p.center.mm.y);break;case this._locationTargetedOnDressup.right:j=new c.Vector2(p.center.mm.x-p.width.mm/2,p.center.mm.y);break;default:break}var t=null;if(i){var v=new c.Vector2().subVectors(m,j);w=Math.min(Math.abs(v.x),Math.abs(v.y));t=new c.Vector2();t.setX(v.x<0?-w:w);t.setY(v.y<0?-w:w)}else{if(s||l){if(s){t=new c.Vector2(m.x-j.x,0);w=Math.abs(m.x-j.x)}else{t=new c.Vector2(0,m.y-j.y);w=Math.abs(m.y-j.y)}}}var k=new c.Vector2().addVectors(j,t.clone().divideScalar(2));r=k.x-w/2;q=k.y-w/2;o.paperPosX.SetValue(r);o.paperPosY.SetValue(q);o.width.SetValue(w);o.height.SetValue(w);u.OnChangeProperty("Collab.Body.Width",o.width);u.OnChangeProperty("Collab.Body.Height",o.height);u.OnChangeProperty("Collab.3D.Paper.Paper.Position.X",o.paperPosX);u.OnChangeProperty("Collab.3D.Paper.Paper.Position.Y",o.paperPosY);a.publish({event:"VCX_PROPERTIES_CHANGED"})},_manipulateDressupTranslate:function(i,l){var k={x:l.GetProperty("Collab.3D.Paper.Paper.Position.X").GetPropertyValue().Clone(),y:l.GetProperty("Collab.3D.Paper.Paper.Position.Y").GetPropertyValue().Clone()};var j=i.event.from[0].deltaPosition;var n=this._experienceBase.getManager("VCXPaperManager").PixelToMM(j.x);var m=this._experienceBase.getManager("VCXPaperManager").PixelToMM(j.y);k.x.SetValue(k.x.GetValue()+n);k.y.SetValue(k.y.GetValue()+m);l.OnChangeProperty("Collab.3D.Paper.Paper.Position.X",k.x);l.OnChangeProperty("Collab.3D.Paper.Paper.Position.Y",k.y);a.publish({event:"VCX_PROPERTIES_CHANGED"});this._experienceBase.getManager("VCXContextManager").renderAll()},_modifiableHasHyperlink:function(k){var j=k.GetProperty("Actor.Hyperlink");if(j){var i=parseInt(j.GetPropertyValue().GetValue(),10);return i>=0}else{return false}},});Object.defineProperty(e.prototype,"componentType",{enumerable:true,get:function(){return"VCXDressupManipulator"}});return e});define("DS/VCXWebDressup/VCXComponentCallout",["DS/VCXWebDressup/VCXComponentMarkup"],function(a){var b=a.extend({init:function(){this._parent();this._IsAnchorDependent=true},});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentCallout"}});b.prototype._dressupFamily="Callouts";return b});define("DS/VCXWebDressup/VCXDressupNode",["DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebModifiables/VCXModelChangeListener","DS/VCXWebVisualization/VCXInteractor",],function(g,d,c,f,b,a){var e=g.extend({init:function(h){this._parent(h.name);this._globalOpacity=null;var i=this;this._Modifiable=h.modifiable;if(this._Modifiable){this._ExperienceBase=this._Modifiable.ExperienceBase}else{this._ExperienceBase=h.experience}this.Dirty=true;if(this.Modifiable){this.layerObserver=new f();this.layerObserver.add(this.Modifiable,"Actor.IsAlwaysOnTop");this.layerObserver.add(this.Modifiable,"Collab.3D.Paper.Positioning.Type");this.layerObserver.add(this.Modifiable,"Collab.3D.Paper.Is.Background")}this._handles={};return this},dispose:function(){delete this._ExperienceBase;delete this._Modifiable;delete this.layerObserver;this._parent()},GetPropertyValue:function(h){return this.Modifiable.GetPropertyValue(h)},GetFontPropertyValue:function(h){return this.Modifiable.GetFontPropertyValue(h)},GetColorPropertyValue:function(h){return this.Modifiable.GetColorPropertyValue(h)},GetFramePropertyValue:function(h){return this.Modifiable.GetFramePropertyValue(h)},GetAnchorValue:function(h){return this.Modifiable.GetAnchorValue(h)},GetAnchorWorldMatrix:function(i,h){return this.Modifiable.GetAnchorWorldMatrix(i,h)},GetPropertyGroupVisibility:function(h){return this.Modifiable.GetPropertyGroupVisibility(h)},GetOpacity:function(){return this.Modifiable.GetOpacity()},RecursiveSetRenderDepth:function(h){this.traverse(function(i,j){if(i.setRenderDepth&&typeof j!=="undefined"){i.setRenderDepth(j)}else{i.renderDepth=j}return false},h)},RecursiveSetPickParent:function(h){this.traverse(function(j,i){if(j.setPickParent){j.setPickParent(i)}return false},h)},RecursiveSetRenderPasses:function(h){this.traverse(function(j,i){if(j.setRenderPasses){j.setRenderPasses(i)}return false},h)},update:function(j){var i=this.GlobalOpacity;if(i<=0){this.lastAlwaysOnTop=null}var h=false;if(this._previousOpacity!==i&&(this._previousOpacity===0||i===0)){var k=this._ExperienceBase.getManager("VCXModelChangeListener");if(k){k.hasChanged(b.FChangeFlag.DressupVisibility,true);k.hasChanged(b.FChangeFlag.Visibility,true)}this._previousOpacity=i;h=true}if((i||h)){if(this.layerObserver){this.layerObserver.update();if(this.layerObserver.isDirty()){this.needToChangeLayer=true}}}},postUpdate:function(h){if(this.layerObserver){this.layerObserver.postUpdate(h)}},preRender:function(m){var h=this.Modifiable.ExperienceBase;this.viewpointVisibility=true;if(this.GlobalOpacity){var l=h.getManager("VCXVisuManager");if(l.isInFrustum(m,this.Modifiable)){var k=h.getManager("VCXSectionManager");if(k){this.viewpointVisibility=!k.isCut(this.Modifiable,m)}}else{this.viewpointVisibility=false}}var i=h.getManager("VCXManipulatorManager");var j=this.Modifiable.QueryInterface("VCXIManipulable");if(i&&j){if(this.GlobalOpacity&&this.viewpointVisibility){this.updateInteractors(m)}i.refreshHandlesVisAndPositions(j)}},handleLayers:function(j){this.alwaysOnTop=this.GetPropertyValue("Actor.IsAlwaysOnTop");if(this.ExperienceBase.getManager("SUIManager")&&this.ExperienceBase.getManager("SUIManager").isNoZToBan()){this.alwaysOnTop=false}if(this.lastAlwaysOnTop!==this.alwaysOnTop||j||this.needToChangeLayer){this.needToChangeLayer=false;var i=this.ExperienceBase.getManager("VCXVisuManager");var h=this.Modifiable.QueryInterface("W3AISGNodeHolder").giveSGNode();if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=c.EPositionType.Free2D){if(this.GetPropertyValue("Collab.3D.Paper.Is.Background")){this.RecursiveSetRenderPasses([i.getRenderList("VCXBackground2DDressups")])}else{if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<c.EPositionType.EndOfAutomaticPositionning){this.RecursiveSetRenderPasses([i.getRenderList("VCXPre2DDressups"),i.getRenderList("VCX2DDressups")])}else{this.RecursiveSetRenderPasses([i.getRenderList("VCXPre2DDressups"),i.getRenderList("VCX2DDressups2"),"PassToCheckAvailableSpace"])}}}else{if(this.alwaysOnTop){this.RecursiveSetRenderPasses([i.getRenderList("VCXNOc3DDressups")])}else{this.RecursiveSetRenderPasses(["main"])}}}this.lastAlwaysOnTop=this.alwaysOnTop},updateInteractors:function(h){this.updateAnchorsInteractors(h)},updateAnchorsInteractors:function(j){var i=this.Modifiable.QueryInterface("VCXIManipulable");if(!i){return}if(this.isNodeBuilt&&this.isNodeBuilt()){var h=i.getAllInteractors();var k=this;this.Modifiable.processAnchorsIDs(function(m){var o="Interactor Anchor."+m;var n=h[o];if(!n){n=k._createAnchorHandleInteractor(o,m);i.addInteractor(o,n)}if(k.Modifiable.GetProperty("Collab.Attach.Availability")){n.active=k.Modifiable.GetPropertyGroupVisibility("Group.Attach")}if(n.active){var l=k.GetAnchorWorldMatrix(m,j);if(!(n.matrix&&n.matrix.equals(l))){n.matrix=l}}})}else{this.removeAnchorsInteractors()}},_createAnchorHandleInteractor:function(j,h){var i=new a(this.Modifiable.GetObject());i.id=j;if(typeof this.Anchors[h].is2DAnchor!=="boolean"){this.Modifiable.updateAnchorsType()}i.data={anchorID:h,is2DAnchor:this.Anchors[h].is2DAnchor};i.manipulatorType=a.EManipulatorType.Handle;i.constraint=a.EConstraint.Pick;i.constraintReferential=a.EConstraintReferential.World;i.visibility=a.EVisibility.OnObjectOver|a.EVisibility.OnObjectSelected|a.EVisibility.OnInteractorOver;i.application=a.EApplication["3DIllustration"]|a.EApplication.CityIllustration;i.cursorPreactivate="grab";i.cursorManipulate="grabbing";return i},removeAnchorsInteractors:function(){var j=this.Modifiable.QueryInterface("VCXIManipulable");var h=j.getAllInteractors();var m=Object.keys(h);for(var l=0;l<m.length;++l){var k=m[l];var i=h[k];if(i&&i.node&&i.node.handle){i.handle.remove();i.handle=null}}},isNodeBuilt:function(){var h=this.Modifiable.QueryInterface("W3AISGNodeHolder").giveSGNode();return Boolean(h)},});e.prototype.EStrHandleResize={TopLeft:0,Top:1,TopRight:2,Right:3,BottomRight:4,Bottom:5,BottomLeft:6,Left:7};Object.defineProperty(e.prototype,"ExperienceBase",{enumerable:true,get:function(){if(this._ExperienceBase){return this._ExperienceBase}else{if(this._Modifiable){return this._Modifiable.ExperienceBase}}}});Object.defineProperty(e.prototype,"Modifiable",{enumerable:true,get:function(){return this._Modifiable}});Object.defineProperty(e.prototype,"Anchors",{enumerable:true,get:function(){return this.Modifiable._Anchors}});Object.defineProperty(e.prototype,"GlobalOpacity",{enumerable:true,get:function(){return this.GetOpacity()}});return e});define("DS/VCXWebDressup/VCXDressupGrpSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/VCXWebDressup/VCXDressupNode"],function(b,a){var c=b.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e=this.GetObject().QueryInterface("VCXIModifiable");var h={name:this.GetObject().getName(),modifiable:e,};this._sgNode=new a(h)}this._sgNode.setVisibilityInTree(false);var f=this.QueryInterface("VCXIModelNavigable");if(f){var g=f.getParent();var d=g.QueryInterface("W3AISGNodeHolder");if(d){d.getSGNode().addChild(this._sgNode);this._pathElement=d.getPathElement().clone();this._pathElement.addElement(this._sgNode)}}return this._sgNode},isSelfManagedPathElement:function(){return true},});return c});define("DS/VCXWebDressup/VCXDressupManagerSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/PathElement","DS/VCXWebDressup/VCXDressupNode"],function(d,c,b){var a=d.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Design",};this._sgNode=new b(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_DressupManagerLeaf.png")}this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._sgNode);this._pathElement=new c();this._pathElement.setFromArray([this._sgNode]);return this._sgNode},isSelfManagedPathElement:function(){return true},});return a});define("DS/VCXWebDressup/VCXDressupSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXComponentMarkup"],function(d,c,b){var a=d.extend({init:function(){},buildSGNode:function(){if(this._sgNode){this._sgNode.setVisibilityInTree(true);this._sgNode._isDressupNode=true;var f=this.QueryInterface("VCXIModelNavigable");if(f){var g=f.getParent();var e=g.QueryInterface("W3AISGNodeHolder");if(e){e.getSGNode().addChild(this._sgNode);this._pathElement=e.getPathElement().clone();this._pathElement.addElement(this._sgNode)}}}return this._sgNode},getWorldMatrix:function(f,e){return this.getAnchorReferential(e)},getAnchorReferential:function(j){var e=new c.Matrix4();var k=this.QueryInterface("VCXIModifiable");if(k){var f=this.GetObject()._experienceBase.getManager("VCXContextManager");var m=j;if(!m){var g=f.getMainViewer();m={viewer:g,viewpoint:g.currentViewpoint}}var l=k.getAnchorsCount();if(l===0){return this.getCenterSceneBoundingSphereMat(m)}if(!k.GetPropertyValue("Collab.3D.Paper.UsesBarycenter")){l=1}var h=new c.Vector3();var i=this;k.processAnchorsIDs(function(o){var t=false;if(!k.GetPropertyValue("Collab.3D.Paper.Referential.In.World")&&l===1){e=k.GetAnchorWorldMatrix(o,m)}else{var u=k.GetAnchorWorldMatrix(o,m);var q=new c.Vector3().getPositionFromMatrix(u);q.divideScalar(l);h.add(q);var n=i.GetObject().getWorkingRootPathElement();e.makeTranslation(h.x,h.y,h.z).extractRotation(n.getWorldMatrix(f.getMainViewer()))}var v=k.GetPropertyValue("Collab.3D.Paper.Positioning.Type");var s=v<=b.EPositionType.Free2D;var r=v===b.EPositionType.RelativeToReferential;var p=k.GetProperty("Collab.Attach.Show")&&k.GetPropertyGroupVisibility("Group.Attach")&&(k.GetPropertyValue("Collab.Attach.LeadType")||k.GetPropertyValue("Collab.Measurement.Attach.Type"));if(!p&&s&&!r){i.getCenterSceneBoundingSphereMat(m,e)}if(!k.GetPropertyValue("Collab.3D.Paper.UsesBarycenter")){return t}},{sort:true})}return e},getCenterSceneBoundingSphereMat:function(j,l){var m=(l instanceof c.Matrix4)?l:new c.Matrix4();var k=this.GetObject()._experienceBase.getManager("VCXPaperManager");if(!k){console.warn("Couldn't find the PaperManager, return input matrix");return m}var g=j.viewer.getSceneBoundingSphere().center.clone();var f=k.ModelToMM2(j,g);var i=new c.Vector3().getPositionFromMatrix(m);var h=k.ModelToMM2(j,i);h.z=f.z;i=k.MMToModel2(j,f);var e=new c.Matrix4().setPosition(i);return e},getPathElement:function(){if(this._pathElement){return this._pathElement}else{if(this._sgNode){console.warn("???? Ask ITY");return this._pathElement}else{return null}}},unreferenceSGNode:function(){if(this._sgNode){if(this._sgNode.dispose){this._sgNode.dispose()}delete this._sgNode}},isSelfManagedPathElement:function(){return true},});return a});define("DS/VCXWebDressup/VCXSmart3DPaperNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXComponentMarkup","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(d,b,c,e){var a=d.extend({init:function(f){this._parent(f);this._Depth=0;this._VerticalToUse=1;this._BillboardDirectionType=0;this._Position2D=new c.Vector2();this._Position=new c.Vector3();this._PositioningType=b.EPositionType.Free3D;this._PositionRadius=0;this._ScalingFactor=1;this._SizeControlType=0;this._BillboardType=0;this._Opacity=1;this._ModifiableProperties=true;return this},_ComputeBillboardMatrix:function(h,j,r){var k=new c.Matrix4().extractRotation(this.GetReferential(h));var l=h.viewpoint.getEyePosition();var u=h.viewpoint.getSightDirection().clone();u.normalize();u=u.negate();var p;if(this.VerticalToUse===1&&(!this.ExperienceBase.getManager("SUIManager")||!this.ExperienceBase.getManager("SUIManager")._isTracked)){p=h.viewpoint.getUpDirection()}else{p=new c.Vector3(0,0,1)}var q=new c.Matrix4();var w;if(this.BillboardDirectionType===0){w=new c.Vector3().subVectors(j,u)}else{if(this.BillboardDirectionType===1){w=l.clone().negate()}}if(this.BillboardType===1){}else{if(this.BillboardType===2){k=new c.Matrix4().lookAt(j,w,p)}else{if(this.BillboardType===3||this.BillboardType===4){var g;if(this.BillboardXAxis){g=this.BillboardXAxis}else{g=e.getVxFromMatrix(r).normalize()}var s=h.viewpoint.getSightDirection();var i=new c.Vector3().crossVectors(p,s).normalize();k=new c.Matrix4().lookAt(j,w,p);var t=this.ExperienceBase.getManager("VCXPaperManager");if(t){var o=t.ModelToMM2(h,j);var n=t.ModelToMM2(h,new c.Vector3().addVectors(j,g)).sub(o).normalize();var v=t.ModelToMM2(h,new c.Vector3().addVectors(j,i)).sub(o).normalize();var m=new c.Vector3().crossVectors(n,v);var f=new c.Quaternion(0,0,m.z,1+n.dot(v));f.normalize();k.multiply(new c.Matrix4().makeRotationFromQuaternion(f));if(this.BillboardType===4&&v.dot(n)<0.001){k.multiply(new c.Matrix4().makeRotationZ(Math.PI))}}}}}return k},_Build:function(){},GetReferential:function(f){if(this._referential){return this._referential}else{if(this.Modifiable&&this.ExperienceBase){var h=this.Modifiable.QueryInterface("W3AISGNodeHolder");var g=f.viewer||this.ExperienceBase.getManager("VCXContextManager").getMainViewer();return h.getWorldMatrix(g,f)}else{return new c.Matrix4()}}},SetReferential:function(f){this._referential=f},_computeMatrix:function(q){var l=this.Position.clone();if(this.PositioningType===b.EPositionType.Free3D){l.applyMatrix4(this.GetReferential(q))}else{if(this.PositioningType===b.EPositionType.RelativeToReferential){var r=this.ExperienceBase.getManager("VCXPaperManager");var h=new c.Vector3().getPositionFromMatrix(this.GetReferential(q));l=r.GetModelPointFromModelPointAndPaperPosition(q,h,this.Position2D,this.PositionRadius)}else{if(this.PositioningType<=b.EPositionType.Free2D){var h=new c.Vector3().getPositionFromMatrix(this.GetReferential(q));var i=this.ExperienceBase.getManager("VCXPaperManager").ModelToMM2(q,h);var j=i.z;var t=new c.Vector3();t.x=this.Position2D.x;t.y=this.Position2D.y;t.z=j;l=this.ExperienceBase.getManager("VCXPaperManager").MMToModel2(q,t)}}}var m=1;if(this.SizeControlType===1){m=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(q,l)}else{if(this.SizeControlType===2){var g=q.viewpoint.getEyePosition();var o=g.distanceTo(l);if(!o){o=1}var p=0.5*q.viewer.div.clientHeight*Math.abs(1/(Math.tan(Math.PI*q.viewpoint.getAngle()/360)*o));p*=this.ExperienceBase.getManager("VCXPaperManager").Zoom;var m=p!==0?1/p:1;if(!m){m=1}}}m*=this.ScalingFactor;var f=new c.Matrix4();var n=new c.Matrix4();n.setPosition(l);f.multiply(n);var k=this._ComputeBillboardMatrix(q,l,this.GetReferential(q));f.multiply(k);var s=new c.Matrix4();s.makeScale(m,m,m);f.multiply(s);this.setMatrix(f);return f},preRender:function(k){this._computeMatrix(k);if(this.AttachedDiv){var f=this.ExperienceBase.getManager("VCXContextManager");if(f.getMainViewer()===k.viewer){var j=this.ExperienceBase.getManager("VCXPaperManager");if(j){var h=new c.Vector3().getPositionFromMatrix(this.getMatrix());var l=j.ModelToMM2(k,h);var g=j.MMToPixel2(k,l);var i=j.GetMmToPxRatio();i*=0.3527;if(this._previousRatio!==i){var m=this;this._previousRatio=i;this.AttachedDiv.style.transform="scale("+i+")"}if(this._previousLeft!==g.x||this._previousTop!==g.y){this._previousLeft=g.x;this._previousTop=g.y;this.AttachedDiv.style.left=g.x+"px";this.AttachedDiv.style.top=g.y+"px"}}}}},update:function(i){if(!this._AxisSystemNode){}this._parent();var h=this.GlobalOpacity;if(h<=0){return}if(this._ModifiableProperties){if(this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")!==undefined){this.BillboardType=this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")}if(this.GetPropertyValue("Collab.3D.Paper.3D.Text.Position")!==undefined){this.Position=this.GetPropertyValue("Collab.3D.Paper.3D.Text.Position")}if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")!==undefined){this.PositioningType=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type");if(this.lastPositioningType!==this.PositioningType){var g=(this.PositioningType<=b.EPositionType.Free2D);var f=this.Modifiable.QueryInterface("W3AISGNodeHolder").giveSGNode();if(f.exludeFromBounding){f.exludeFromBounding(g)}}this.lastPositioningType=this.PositioningType}if(this.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")!==undefined){this.SizeControlType=this.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")}if(this.GetPropertyValue("Collab.3D.Paper.Scaling.Factor")!==undefined){this.ScalingFactor=this.GetPropertyValue("Collab.3D.Paper.Scaling.Factor")}if(this.GetPropertyValue("Collab.3D.Paper.Paper.Position")!==undefined){this.Position2D=this.GetPropertyValue("Collab.3D.Paper.Paper.Position")}else{if(this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")!==undefined){this.Position2D.x=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")}if(this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")!==undefined){this.Position2D.y=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")}}if(this.GetPropertyValue("Collab.3D.Paper.3D.Text.Radius")!==undefined){this.PositionRadius=this.GetPropertyValue("Collab.3D.Paper.3D.Text.Radius")}}this.handleLayers()}});Object.defineProperty(a.prototype,"ModifiableProperties",{enumerable:true,get:function(){return this._ModifiableProperties},set:function(f){this._ModifiableProperties=f}});Object.defineProperty(a.prototype,"Opacity",{enumerable:true,get:function(){return this._Opacity},set:function(f){this._Opacity=f}});Object.defineProperty(a.prototype,"BillboardType",{enumerable:true,get:function(){return this._BillboardType},set:function(f){this._BillboardType=f}});Object.defineProperty(a.prototype,"BillboardXAxis",{enumerable:true,get:function(){return this._BillboardXAxis},set:function(f){this._BillboardXAxis=f}});Object.defineProperty(a.prototype,"SizeControlType",{enumerable:true,get:function(){return this._SizeControlType},set:function(f){this._SizeControlType=f}});Object.defineProperty(a.prototype,"ScalingFactor",{enumerable:true,get:function(){return this._ScalingFactor},set:function(f){this._ScalingFactor=f}});Object.defineProperty(a.prototype,"PositioningType",{enumerable:true,get:function(){return this._PositioningType},set:function(f){this._PositioningType=f}});Object.defineProperty(a.prototype,"Position",{enumerable:true,get:function(){return this._Position},set:function(f){this._Position=f}});Object.defineProperty(a.prototype,"Position2D",{enumerable:true,get:function(){return this._Position2D},set:function(f){this._Position2D=f}});Object.defineProperty(a.prototype,"PositionRadius",{enumerable:true,get:function(){return this._PositionRadius},set:function(f){this._PositionRadius=f}});Object.defineProperty(a.prototype,"Referential",{get:function(){if(this._referential){return this._referential}else{if(this.Modifiable&&this.ExperienceBase){var g=this.Modifiable.QueryInterface("W3AISGNodeHolder");var f=this.ExperienceBase.getManager("VCXContextManager");return g.getWorldMatrix(f.getMainViewer())}else{return new c.Matrix4()}}},set:function(f){this._referential=f},enumerable:true,});Object.defineProperty(a.prototype,"Depth",{enumerable:true,get:function(){return this._Depth},set:function(f){this._Depth=f}});Object.defineProperty(a.prototype,"VerticalToUse",{enumerable:true,get:function(){return this._VerticalToUse},set:function(f){this._VerticalToUse=f}});Object.defineProperty(a.prototype,"BillboardDirectionType",{enumerable:true,get:function(){return this._BillboardDirectionType},set:function(f){this._BillboardDirectionType=f}});Object.defineProperty(a.prototype,"AttachedDiv",{enumerable:true,get:function(){return this._AttachedDiv},set:function(f){this._AttachedDiv=f}});return a});define("DS/VCXWebDressup/VCXSimplePanelNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXImageManager","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebProperties/VCXColor"],function(h,e,g,d,f,a,b){var c=h.extend({init:function(i){this._parent(i);this._previousBackgroundDocID=null;this._Smart3DPaperNode=null;return this},setMaterial:function(i){this._bodyMat=new e.MeshBasicMaterial({side:e.FrontSide,forceSide:true,vertexColors:e.VertexColors,color:"#ffffff",transparent:true,opacity:1,force:true,});if(i){this._bodyMat.map=i}if(this._MeshNode){this._MeshNode.setMaterial(this._bodyMat)}},_ComputeColorBuffer:function(k,l){var j=0;k[j++]=l.head.r;k[j++]=l.head.g;k[j++]=l.head.b;k[j++]=l.head.a;k[j++]=l.head.r;k[j++]=l.head.g;k[j++]=l.head.b;k[j++]=l.head.a;k[j++]=l.foot.r;k[j++]=l.foot.g;k[j++]=l.foot.b;k[j++]=l.foot.a;k[j++]=l.foot.r;k[j++]=l.foot.g;k[j++]=l.foot.b;k[j++]=l.foot.a;return 4},dispose:function(){if(this._Smart3DPaperNode){this._Smart3DPaperNode.dispose();this._Smart3DPaperNode=null}this._parent()},_Build:function(l){this._PrimitiveGroup=new f.PrimitiveGroup();this._PrimitiveGroup.editable=true;var p=new f.Buffer({component:f.VertexComponentEnum.POSITION,data:new Float32Array(12)});p.dimension=3;this._PrimitiveGroup.addBuffer(0,p);var q=new f.Buffer({component:f.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(16)});q.dimension=3;this._PrimitiveGroup.addBuffer(1,q);var u=new f.Buffer({component:f.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(16)});u.dimension=4;this._PrimitiveGroup.addBuffer(2,u);var r=new f.Buffer({indexBuffer:true,data:new Uint16Array(6)});this._PrimitiveGroup.addBuffer(3,r);var m;m=p.data;var n=0;m[n++]=0;m[n++]=0;m[n++]=0;m[n++]=1;m[n++]=0;m[n++]=0;m[n++]=1;m[n++]=-1;m[n++]=0;m[n++]=0;m[n++]=-1;m[n++]=0;m=q.data;var n=0;m[n++]=0;m[n++]=1;m[n++]=0;m[n++]=1;m[n++]=1;m[n++]=0;m[n++]=1;m[n++]=0;m[n++]=0;m[n++]=0;m[n++]=0;m[n++]=0;m=r.data;n=0;m[n++]=0;m[n++]=2;m[n++]=1;m[n++]=0;m[n++]=3;m[n++]=2;this._ComputeColorBuffer(u.data,{head:new b(),foot:new b()});var t=new f.Primitive({nbIndices:6,connectivity:f.ConnectivityTypeEnum.TRIANGLES,fillGAS:new f.FillAttributes()});var s=new f.VertexComponent({nbVertices:4,bufferId:0,indices:new f.IndexArray({bufferId:3,offset:0})});var o=new f.VertexComponent({nbVertices:4,bufferId:1,indices:new f.IndexArray({bufferId:3,offset:0})});var k=new f.VertexComponent({nbVertices:4,bufferId:2,indices:new f.IndexArray({bufferId:3,offset:0})});t.addVertexComponent(s);t.addVertexComponent(o);t.addVertexComponent(k);this._PrimitiveGroup.addPrimitive(t);this._MeshNode=d.createMeshNode(this._PrimitiveGroup);this.setMaterial();this._MeshNode.setVisibilityInTree(false);var j={name:"PanelSmartNode",modifiable:this.Modifiable,};this._Smart3DPaperNode=new a(j);this._Smart3DPaperNode.add(this._MeshNode);this.add(this._Smart3DPaperNode);this.RecursiveSetPickParent(true);this.setPickParent(false);this.handleLayers(true)},preRender:function(j){var i=false;if(this._Smart3DPaperNode){i|=this._Smart3DPaperNode.preRender(j)}if(this._AttachesNode){i|=this._AttachesNode.preRender(j)}return i},postUpdate:function(i){this._parent()},update:function(q){this._parent();if(this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var k=(this._globalOpacity>0);if(k){if(!this._Smart3DPaperNode){this._Build()}}if(this._Smart3DPaperNode){this._Smart3DPaperNode.setVisibility(k)}if(this._AttachesNode){this._AttachesNode.setVisibility(k)}}if(this._globalOpacity<=0){return}if(this._Smart3DPaperNode){this._Smart3DPaperNode.update(q)}if(this._AttachesNode){this._AttachesNode.update(q)}if(this.GetPropertyValue("Collab.3D.Paper.Depth")!==undefined){var m=this.GetPropertyValue("Collab.3D.Paper.Depth");this.RecursiveSetRenderDepth(m)}var n=this.GetPropertyValue("Collab.Image.Doc.ID");if(n===null||n===undefined||!this.GetPropertyGroupVisibility("Group.Image")){n=-1}if(this._previousBackgroundDocID!==n){this._previousBackgroundDocID=n;if(n!==-1){var p=n;var o=this;o._backgroundImage=null;var l=g.Effect.None;this._currentShape=this.GetPropertyValue("Collab.Body.Shape");if(this._currentShape===6){l=g.Effect.RemoveBorder}this.ExperienceBase.getManager("VCXImageManager").GetImageFromDocID(n,l,(function(t,s){if(t===p){var u=e.ImageUtils.loadTexture(s.toDataURL(),{},function(v){o._backgroundImage=s;o.setMaterial(v);o.update();o=null})}}))}else{this.setMaterial()}}if(this._AttachesNode){var r={shape:this._currentShape,center:this._center,size:this._internalSize,};this._AttachesNode.SetShapeInfo(r)}if(this._MeshNode){var j=this.GetPropertyValue("Collab.Body.Width");var i=this.GetPropertyValue("Collab.Body.Height");if(this._previousBackgroundDocID){if(!this._backgroundImage){j=0;i=0}else{if(this.GetPropertyValue("Collab.Body.KeepAspectRatio")){i=j*this._backgroundImage.height/this._backgroundImage.width}}}this._MeshNode.setMatrix(new e.Matrix4().makeScale(j,i,1))}this.handleLayers();return}});return c});define("DS/VCXWebDressup/VCXAnchorServices",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebDressup/VCXComponentMarkup"],function(a,e,i,f,b,c,h,g,d,j,l){var k=a.extend({init:function(){},});k.GetNewPropertyValueAnchorFromPickinfo=function(n){if(!n){var m=new h();var o=new g();o.Value=new e.Matrix4();m.SetValueFrame(o);m.SetValueLinkFromComponent(null);return m}var m=new h();var o=new g();m.SetValueFrame(o);o.Value=n.localMatrix;if(n.modifiable){m.SetValueLinkFromComponent(n.modifiable.GetObject())}else{m.SetValueLinkFromComponent(null)}return m};k.GetComponentToAttachTo=function(q,n){if(!q){return}var o=null;if(n){var m=j.BuildCleanedPathElement(n);var p=q._experienceBase.ComponentsMap.GetComponentFromPathElement(m);if(p){o=p}}if(!o){o=q.getWorkingRootComponent()}return o};k.BuildNewPropertyValueAnchor=function(r,m,o){if(!r instanceof e.Matrix4){console.warn("BuildNewPropertyValueAnchor Usage: BuildNewPropertyValueAnchor(iAnchorFrameInWorld <THREE.Matrix4>, iAnchorHolderComponent <VCXComponentOccurrence>, iPathObjectToLink <WebVizu.PathElement>) !");return}var p=this.GetComponentToAttachTo(m,o);if(!p){console.warn("Creation of Anchor Property Value aborted: No object has been found to link the anchor.");return}var q=p.QueryInterface("W3AISGNodeHolder");var n=q.getMatrixInLCS(m._experienceBase.getManager("VCXContextManager").getMainViewer(),r);var s=new h();var t=new g();s.SetValueFrame(t);t.Value=n;if(o){s.SetValueLinkFromComponent(p)}else{s.SetValueLinkFromComponent(null)}return s};k.getWorldMatrix=function(A,s,w){if(A){var o=A.GetValueFrame().Value;var x=s._experienceBase.ComponentsMap.GetComponentFromLink(A.GetValueLink());if(!x){x=s.getWorkingRootComponent()}var q=x.QueryInterface("W3AISGNodeHolder");var p=l.EPositionType.Free3D;var r=x.QueryInterface("VCXIModifiable");if(r){var t=r.GetProperty("Collab.3D.Paper.Positioning.Type");if(t){p=t.GetPropertyValue().Value}}if(A.is2DAnchor&&q&&q.getSGNode()&&q.getSGNode().GetShapeInfo&&w&&p===l.EPositionType.Free2D){if(s){var z=q.getSGNode().GetShapeInfo();if(z){var m=i.getOFromMatrix(o);var y=s._experienceBase.getManager("VCXPaperManager");if(y){var v=y.ModelToMM2(w,i.getOFromMatrix(z.smartNode.getMatrix()));var n=new e.Vector3(z.smartNode.Position2D.x+z.size.x*m.x,z.smartNode.Position2D.y+z.size.y*m.y,v.z*0.9999);var u=y.MMToModel2(w,n);return new e.Matrix4().setPosition(u)}}}}else{if(q&&p===l.EPositionType.Free3D){return q.getMatrixInWCS(x._experienceBase.getManager("VCXContextManager").getMainViewer(),o)}else{return o}}}else{return null}};k.requestNewAnchor=function(q,u,t){var n=q.GetPropertyValue("Collab.ListAnchorsIDs").slice(0);var m=null;if((typeof t==="number"||typeof t==="string")){m=t}else{m=q.getNewAnchorID()}var w="Actor.Anchor."+m;var r=k.GetNewPropertyValueAnchorFromPickinfo(u);n.push(m);var v=new d(n);var p=new c(w,0);var o=new c("Collab.ListAnchorsIDs",0);var s=new b();s.AddOrModifyProperty(new f(p,r));s.AddOrModifyProperty(new f(o,v));return{anchorPropName:w,propertySet:s}};return k});define("DS/VCXWebDressup/VCXPickerCmd",["UWA/Core","DS/CoreEvents/Events","DS/ApplicationFrame/Command","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/VCXWebKernelTools/VCXMathTools","DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebDressup/VCXPickerTools","DS/Robot/LineTranslationNode","DS/Core/PointerEvents","DS/VCXWebExperienceBase/VCXPathElementTools","DS/VCXWebKernelTools/VCXMeshServices","DS/VCXWebVisualization/VCXPickerCanonics","DS/VCXWebVisibility/VCXIVisibility","DS/WebappsUtils/WebappsUtils","DS/VCXWebDressup/VCXCmdChangeDressup","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebGUIInfra/VCXArcBar","DS/VCXWebComponents/VCXWebComponentOccurrence"],function(g,d,n,r,y,e,p,u,l,j,i,m,s,k,t,v,a,h,c,b,f,z,x,q,w){var o=n.extend({init:function(A){this._parent(A,{isAsynchronous:true});this.reset()},_clearFeedbackUnitGeoms:function(){var A=this._experienceBase?this._experienceBase.getManager("VCXContextManager").getMainViewer():null;if(A){A.removeNode(this._torusNode);A.removeNode(this._redXNode);A.removeNode(this._smartNodeArrow);A.removeNode(this._pointNode);A.removeNode(this._lineNode);A.removeNode(this._circleNode);A.removeNode(this._axisNode);A.removeNode(this._planeNode);A.removeNode(this._cylinderNode);A.removeNode(this._coneNode);A.removeNode(this._sphereNode)}this._torusNode=null;this._redXNode=null;this._arrowNode=null;this._smartNodeArrow=null;this._pointNode=null;this._lineNode=null;this._circleNode=null;this._axisNode=null;this._planeNode=null;this._cylinderNode=null;this._sphereNode=null;this._coneNode=null},reset:function(){this._clearFeedbackUnitGeoms();this._experienceBase=null;this.picker=null;this._startToDrag=false;this.Acquisitions=[];this._infinite=false;this.Acquired=[];this._arcBar=null;this._DressupModifiable=null;this.AcquisitionsEnable=true},_preRender:function(B,A){if(B){if(B.preRender){B.preRender(A)}if(B.cbChange){B.cbChange()}}},preRender:function(A){this._preRender(this._smartNodeArrow);this._preRender(this._smartNodeTorus);this._preRender(this._smartNodeRedX);this._preRender(this._redXNode)},BuildDressup:function(A){this.AcquisitionsEnable=false;var C=this._experienceBase.getManager("VCXDressupManager");var E=C.FindBestName(this.getComponentTypeToCreate(),this.getComponentNameToCreate());var G=function(I,H){var J=I.QueryInterface("VCXIModifiable");if(J){J.OnChangeProperty("Actor.Name",new x(H))}};if(this._experienceBase.getManager("VCXCAT3DXModelManager")){var B=this._experienceBase.getManager("VCXContextManager").getRootComponent();if(B){var F=this;this._experienceBase.getManager("VCXCAT3DXModelManager").CreateActor(this.getComponentTypeToCreate(),E,B).done(function(H){if(H){G(H,E);F._createDressup(A?A:{},H);F.AcquisitionsEnable=true}else{console.log("Actor dressup not built !")}})}else{console.error("Dressup creation : Missing father experience!")}}else{var D=this._experienceBase.Factory.BuildComponent(this.getComponentTypeToCreate());G(D,E);this._createDressup(A?A:{},D);this.AcquisitionsEnable=true}},SetDressupVisible:function(B){if(this._DressupModifiable){var A=this._DressupModifiable.QueryInterface("VCXIVisibility");if(A){A.SetVisibility(B?h.EVisState.Visible:h.EVisState.Hidden)}this._DressupModifiable.OnChangePropertiesEnd()}},_addAnchor:function(B,D,C,F){var A=i.requestNewAnchor(B,D,C);var E=this;if(F){A.propertySet.onEachProperty(F)}else{A.propertySet.onEachProperty(function(H,I){var G=I.GetPropertyValue();B.OnChangeProperty(H,G)})}},_finalizeDressupCB:function(B){if(this._DressupModifiable){var D=new z(this._experienceBase.getManager("VCXScenarioManager"));D.CaptureNeutralProperties(this._DressupModifiable);this._experienceBase.getManager("VCXCommandManager").Push(D);var E=[];var A=this._DressupModifiable.GetObject();if(A.IsKindOf("VCXComponentDressup")){E.push(A);var C=new f(this._experienceBase.getManager("VCXSelectionManager"));C.SetComponentsSelection(E);this._experienceBase.getManager("VCXCommandManager").Do(C)}}this._experienceBase.getManager("VCXCommandManager").EndTransaction(this.getComponentNameToCreate()+" Creation")},beginExecute:function(){this.reset();d.publish({event:"/VCX/Picker/Query/Start"});this._experienceBase=this.getFrameWindow()._experienceBase;this._debugTools=this._experienceBase.getManager("VCXExperience").debugTools;if(this._experienceBase.getManager("VCXMultiUserInputManager")){this._experienceBase.getManager("VCXMultiUserInputManager").registerCommand(this)}var A=this._experienceBase.getManager("VCXContextManager");var B=A.getMainViewer();if(!this.picker){this.picker=new m(this._experienceBase)}if(this._experienceBase.getManager("VCXGUIManager")&&this._experienceBase.getManager("VCXGUIManager").isTouchActivated()){}A.setAllViewerSensitive(false);this._experienceBase.getManager("VCXSelectionManager").setTrapSelection(false);this._experienceBase.getManager("VCXCommandManager").StartTransaction(this.getComponentNameToCreate()+" Creation");this.Acquired=[];this.Acquisitions=[];var C=this;this.callerOfTheAgentTreatment=function(F){var J=F.target||F.srcElement;if(J.tagName!=="CANVAS"&&!C._isDraggin){return}var O=C.GetNextAcquisitionIndice();if(!(C.Acquisitions[O])){}var K;if(C.Acquisitions[O]){K=C.Acquisitions[O].constraintPointIndex}if(K!==undefined&&K>=0){C.picker.usePointConstraint(true,C.Acquired[K].pickInfo.globalPosition);if(C.Acquisitions[O].constraint===o.CONSTRAINT.POINT_ON_Z){C.picker.useNormalConstraint(true,C.Acquired[K].pickInfo.globalNormal)}else{if(C.Acquisitions[O].constraint===o.CONSTRAINT.POINT_ON_X){C.picker.useNormalConstraint(true,l.getVzFromMatrix(l.getMatrixFromOVx(C.Acquired[K].pickInfo.globalPosition,C.Acquired[K].pickInfo.globalNormal)))}else{if(C.Acquisitions[O].constraint===o.CONSTRAINT.POINT_ON_Y){C.picker.useNormalConstraint(true,l.getVzFromMatrix(l.getMatrixFromOVy(C.Acquired[K].pickInfo.globalPosition,C.Acquired[K].pickInfo.globalNormal)))}else{if(C.Acquisitions[O].constraint===o.CONSTRAINT.USER&&C.Acquisitions[O].constraintNormal){if(C.Acquisitions[O].constraintNormal){C.picker.useNormalConstraint(true,C.Acquisitions[O].constraintNormal)}if(C.Acquisitions[O].constraintPoint){C.picker.usePointConstraint(true,C.Acquisitions[O].constraintPoint)}}else{C.picker.useNormalConstraint(false)}}}}}else{C.picker.usePointConstraint(false);C.picker.useNormalConstraint(false)}var G=C._infinite?-1:C.Acquisitions[O].constraint;if(G===o.CONSTRAINT.CAMERA_NORMAL){C.picker.useNormalConstraintToCamera(true)}else{C.picker.useNormalConstraintToCamera(false)}var H=C.picker.pick(B,F);C.Acquired[O]=H;var E=false;if(F.type==="DSlonghold"){E=true;if(C.PointAcquiredCB){C.PointAcquiredCB(C.Acquired)}}else{if(F.type==="DSpointerdown"&&F.button===2&&C.AcquisitionsEnable){E=true}else{if(F.type==="DSpointerdown"&&C.AcquisitionsEnable){C._beginDrag(H.mouse.xPix,H.mouse.yPix);if(C.CurrentAcquisitionCB){C.CurrentAcquisitionCB(C.Acquired)}}else{if(F.type==="DSpointermove"){C._onDrag(H.mouse.xPix,H.mouse.yPix);if(C.CurrentAcquisitionCB){C.CurrentAcquisitionCB(C.Acquired)}if(H.pickInfo.globalPosition&&H.pickInfo.globalNormal){C._RefreshVisuFeedback(H.pickInfo)}}else{if(F.type==="DSpointerup"&&C.AcquisitionsEnable){if(C._infinite&&!C._isDraggin){var I=C.Acquired[O];for(var D=C.Acquired.length-1;D>=0;--D){var L=C.Acquired[D];if(!L.accepted){continue}var N=new y.Vector2(I.mouse.xPix,I.mouse.yPix);var M=new y.Vector2(L.mouse.xPix,L.mouse.yPix);if(N.distanceTo(M)<5){E=true}break}}if(!E){C.Acquired[O].accepted=true;if(C.PointAcquiredCB){C.PointAcquiredCB(C.Acquired)}}C._endDrag()}}}}}C.updateCanonicsDetection();H.pickInfo.smartMode=(C.picker&&C.picker._canonicsMode!==a.Canonic.None);if(C._loadingOption&&C._loadingOption.isShowPickerDebug()&&C._debugTools){C._debugHTMLAcquired()}if(C.areAllAcquisitionsValid()||E){C.end()}};if(!r._isInit){r.init()}document.addEventListener(k.POINTERDOWN,this.callerOfTheAgentTreatment);document.addEventListener(k.POINTERMOVE,this.callerOfTheAgentTreatment);document.addEventListener(k.POINTERUP,this.callerOfTheAgentTreatment);document.addEventListener(k.LONGHOLD,this.callerOfTheAgentTreatment)},endExecute:function(){if(typeof this._dressupFinalized==="boolean"&&this._dressupFinalized===false&&this.ForceFinalize){this.ForceFinalize(this.Acquired)}if(this._DressupModifiable){var C=this._DressupModifiable.GetObject().QueryInterface("W3AISGNodeHolder");if(C){C.giveSGNode().setPickable(j.PICKABLE)}}var B=this._experienceBase.getManager("VCXContextManager");B.setAllViewerSensitive(true);var A=B.getTrapSelectionRequirements();this._experienceBase.getManager("VCXSelectionManager").setTrapSelection(A.pick,A.prePick);this._experienceBase.getManager("VCXGUIManager").SetCursor("auto");this._clearFeedbackUnitGeoms();document.removeEventListener(k.POINTERDOWN,this.callerOfTheAgentTreatment,false);document.removeEventListener(k.POINTERMOVE,this.callerOfTheAgentTreatment,false);document.removeEventListener(k.POINTERUP,this.callerOfTheAgentTreatment,false);document.removeEventListener(k.LONGHOLD,this.callerOfTheAgentTreatment,false);this._experienceBase.getManager("VCXContextManager").renderAll({updateInfinitePlane:true});if(this._experienceBase.getManager("VCXMultiUserInputManager")){this._experienceBase.getManager("VCXMultiUserInputManager").unRegisterCommand(this)}if(this._arcBar){this._arcBar.clear();this._arcBar=null}if(this.picker){this.picker.clear();delete this.picker}d.publish({event:"/VCX/Picker/Query/End"})},cancelExecute:function(){if(this._DressupModifiable){var B=this._DressupModifiable.GetObject();if(B.IsKindOf("VCXComponentDressup")){var E=[B];var A=this._experienceBase.getManager("VCXSelectionManager");if(A.isIn(B)){var D=new f(A);D.RemoveComponentsFromSelection(E);this._experienceBase.getManager("VCXCommandManager").Do(D)}var C=new b(this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.getManager("VCXDressupManager"),this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.ComponentsMap);E.forEach(function(F){C.RemoveDressups(F)});this._experienceBase.getManager("VCXCommandManager").Push(C)}}this._DressupModifiable=null},areAllAcquisitionsValid:function(){if(this._infinite||this.Acquisitions.length!==this.Acquired.length){return false}for(var A=0;A<this.Acquired.length;A++){if(!this.Acquired[A].accepted){return false}}return true},GetNextAcquisitionIndice:function(){var A=this.Acquired.length;if(A<=0){return 0}for(var C=0;C<A;C++){if(!this.Acquired[C].accepted){return C}}if(this._infinite){return this.Acquired.length}var B=(A>=this.Acquisitions.length)?A-1:A;return B},GetNextAcquisitionFeedbackMode:function(){if(this._infinite){return this.Acquisitions[0].displayFeedback}var A=this.GetNextAcquisitionIndice();if(A<0){return o.FEEDBACKMODE.NONE}return this.Acquisitions[A].displayFeedback},useNormalConstraint:function(B,A){this.picker.useNormalConstraint(B,A)},usePointConstraint:function(B,A){this.picker.usePointConstraint(B,A)},_RefreshVisuFeedback:function(G){var F=G.globalPosition;var E=G.globalNormal;var D=G.modifiable;var B=G.canonics;var H=l.getMatrixFromOVz(F,E);var A=this.GetNextAcquisitionFeedbackMode();if(A&o.FEEDBACKMODE.NONE){this._hideTorusFeedback();this._hideRedXFeedback();this._hideArrowFeedback();this._hideLineFeedback();this._hideCylinderFeedback();this._hideConeFeedback();this._hideSphereFeedback();this._hideCircleFeedback();this._hidePointFeedback();this._experienceBase.getManager("VCXGUIManager").SetCursor("crosshair");return}if(A&o.FEEDBACKMODE.NORMAL){this._showArrowFeedback();this._updateArrowFeedback(H)}if(A&o.FEEDBACKMODE.NORMAL_ONLY_ON_PART){if(D){this._showArrowFeedback();this._updateArrowFeedback(H)}else{this._hideArrowFeedback()}}if(A&o.FEEDBACKMODE.POINT){this._showTorusFeedback();this._updateTorusFeedback(H)}if(A&o.FEEDBACKMODE.POINT_ONLY_ON_PART){if(D){this._showTorusFeedback();this._updateTorusFeedback(H)}else{this._hideTorusFeedback()}}this._hidePointFeedback();this._hideLineFeedback();this._hideCircleFeedback();this._hideAxisFeedback();this._hidePlaneFeedback();this._hideCylinderFeedback();this._hideConeFeedback();this._hideSphereFeedback();if(B.length){var C=B[0];switch(C.type){case a.Canonic.CircleCenter:this._showPointFeedback();this._showCircleFeedback();this._updatePointFeedback(C);this._updateCircleFeedback(C);break;case a.Canonic.EdgeExtremity:this._showPointFeedback();this._showLineFeedback();this._updatePointFeedback(C);this._updateLineFeedback(C);break;case a.Canonic.PointOnAxis:this._showPointFeedback();this._showAxisFeedback();this._showCircleFeedback();this._updatePointFeedback(C);this._updateAxisFeedback(C);this._updateCircleFeedback(C);break;case a.Canonic.Line:this._showLineFeedback();this._updateLineFeedback(C);break;case a.Canonic.Circle:this._showCircleFeedback();this._updateCircleFeedback(C);break;case a.Canonic.Plane:this._showPointFeedback();this._showPlaneFeedback();this._updatePointFeedback(C);this._updatePlaneFeedback(C);break;case a.Canonic.Cylinder:this._showCylinderFeedback();this._updateCylinderFeedback(C);break;case a.Canonic.Cone:this._showConeFeedback();this._updateConeFeedback(C);break;case a.Canonic.Sphere:this._showSphereFeedback();this._updateSphereFeedback(C);break;default:break}}this._experienceBase.getManager("VCXContextManager").renderAll()},_showArrowFeedback:function(){if(!this._smartNodeArrow){var A={viewer:this._experienceBase.getManager("VCXContextManager").getMainViewer(),position:new y.Vector3()};this._arrowNode=new s(A);this._arrowNode.setMatrix(new y.Matrix4());var C={name:"PickerArrowSmartNode",experience:this._experienceBase,ratio:1};this._smartNodeArrow=new u(C);this._smartNodeArrow.add(this._arrowNode);var B=this._experienceBase.getManager("VCXVisuManager");this._smartNodeArrow.setRenderPasses([B.getRenderList("VCXManipulators")]);this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._smartNodeArrow)}this._smartNodeArrow.setVisibility(true)},_updateArrowFeedback:function(A){if(!this._smartNodeArrow){return}this._smartNodeArrow.setMatrix(A);this._arrowNode.setVisibility(true);this._smartNodeArrow.setVisibility(true)},_hideArrowFeedback:function(){if(this._smartNodeArrow){this._smartNodeArrow.setVisibility(false)}},_showTorusFeedback:function(){if(!this._torusNode){this._torus=e.createTorusNode({majorRadius:10,minorRadius:3,majorStartAngle:0,majorEndAngle:2*Math.PI,sag:40,color:new j.Color(0.0666666666666667,0.596078431372549,0.8980392156862745,0.5)});this._torusNode=new p();var B={name:"PickerTorusSmartNode",experience:this._experienceBase,ratio:1};this._smartNodeTorus=new u(B);this._smartNodeTorus.add(this._torus);this._torusNode.add(this._smartNodeTorus);this._torusNode.setPickable(j.NODRAWHL);var A=this._experienceBase.getManager("VCXVisuManager");this._torusNode.setRenderPasses([A.getRenderList("VCXManipulators")]);this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._torusNode)}this._torusNode.setVisibility(true)},_updateTorusFeedback:function(A){if(!this._torusNode){return}this._torusNode.setMatrix(A);this._torusNode.setVisibility(true)},_hideTorusFeedback:function(){if(this._torusNode){this._torusNode.setVisibility(false)}},_showRedXFeedback:function(){if(!this._redXNode){this._redX=e.createRedXNode({majorRadius:10,minorRadius:3,majorStartAngle:0,majorEndAngle:2*Math.PI,sag:40,color:new j.Color(0.0666666666666667,0.596078431372549,0.8980392156862745,0.5)});this._redXNode=new p();var B={name:"PickerRedXSmartNode",experience:this._experienceBase,ratio:1};this._smartNodeRedX=new u(B);this._smartNodeRedX.add(this._redX);this._redXNode.add(this._smartNodeRedX);this._redXNode.setPickable(j.NODRAWHL);var A=this._experienceBase.getManager("VCXVisuManager");this._redXNode.setRenderPasses([A.getRenderList("VCXManipulators")]);var B={name:"PickerRedXSmartNode",experience:this._experienceBase,ratio:1};this._redXNode=new u(B);this._redXNode.setRenderPasses([A.getRenderList("VCXManipulators")]);this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._redXNode)}this._redXNode.setVisibility(true)},_updateRedXFeedback:function(A){if(!this._redXNode){return}this._redXNode.setMatrix(A);this._redXNode.setVisibility(true)},_hideRedXFeedback:function(){if(this._redXNode){this._redXNode.setVisibility(false)}},_showLineFeedback:function(){if(!this._lineNode){this._line=v.buildLineStripSet([0,0,0,0,0,1],[2],[0,1],new j.Color(0,86/255,134/255),2,"WIRE_EDGE",null);this._line.setNoZ(true);this._lineNode=new p();this._lineNode.add(this._line);this._lineNode.setPickable(j.NODRAWHL);this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._lineNode)}this._lineNode.setVisibility(true)},_updateLineFeedback:function(D){if(!this._lineNode){return}if(!D.extremity1||!D.extremity2){return}var B=new y.Vector3(1,0,0);var A=new y.Vector3(0,1,0);var G=new y.Vector3(0,0,D.extremity1.distanceTo(D.extremity2));var E=new y.Matrix4().makeBasis(B,A,G);var C=new y.Vector3().subVectors(D.extremity2,D.extremity1);var F=l.getMatrixFromOVz(D.extremity1,C);this._lineNode.setMatrix(new y.Matrix4().multiplyMatrices(F,E))},_hideLineFeedback:function(){if(this._lineNode){this._lineNode.setVisibility(false)}},_showPlaneFeedback:function(){if(!this._planeNode){this._plane=e.createRectangleNode({width:1,height:1,fill:true,color:new j.Color(0,86/255,134/255,0.5)});this._plane.setNoZ(true);this._planeNode=new p();this._planeNode.add(this._plane);this._planeNode.setPickable(j.NODRAWHL);this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._planeNode)}this._planeNode.setVisibility(true)},_updatePlaneFeedback:function(D){if(!this._planeNode){return}if(!D.origin||!D.normal||!D.width||!D.height){return}var B=new y.Vector3(D.width,0,0);var A=new y.Vector3(0,D.height,0);var G=new y.Vector3(0,0,1);var E=new y.Matrix4().makeBasis(B,A,G);var C=new y.Matrix4();C.setPosition({x:-0.5,y:-0.5,z:0});var F=l.getMatrixFromOVz(D.origin,D.normal);this._planeNode.setMatrix(new y.Matrix4().multiplyMatrices(F,new y.Matrix4().multiplyMatrices(E,C)))},_hidePlaneFeedback:function(){if(this._planeNode){this._planeNode.setVisibility(false)}},_showCylinderFeedback:function(){if(!this._cylinderNode){var A={bottomCenterPoint:new y.Vector3(0,0,-1),topCenterPoint:new y.Vector3(0,0,1),radius:1,color:new j.Color(0,86/255,134/255,0.5)};this._cylinder=e.createCylinderNode(A);this._cylinder.setNoZ(true);this._cylinderNode=new p();this._cylinderNode.add(this._cylinder);this._cylinderNode.setPickable(j.NODRAWHL);this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._cylinderNode)}this._cylinderNode.setVisibility(true)},_updateCylinderFeedback:function(C){if(!this._cylinderNode){return}if(!C.radius||!C.length||!C.center||!C.normal){return}var B=new y.Vector3(C.radius+0.01,0,0);var A=new y.Vector3(0,C.radius+0.01,0);var F=new y.Vector3(0,0,(C.length+0.01)*0.5);var D=new y.Matrix4().makeBasis(B,A,F);var E=l.getMatrixFromOVz(C.center,C.normal);this._cylinderNode.setMatrix(new y.Matrix4().multiplyMatrices(E,D))},_hideCylinderFeedback:function(){if(this._cylinderNode){this._cylinderNode.setVisibility(false)}},_showConeFeedback:function(){if(!this._coneNode){var A={bottomCenterPoint:new y.Vector3(0,0,-1),topCenterPoint:new y.Vector3(0,0,1),bottomRadius:1,topRadius:0,color:new j.Color(0,86/255,134/255,0.5)};this._cone=e.createConeNode(A);this._cone.setNoZ(true);this._coneNode=new p();this._coneNode.add(this._cone);this._coneNode.setPickable(j.NODRAWHL);this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._coneNode)}this._coneNode.setVisibility(true)},_updateConeFeedback:function(C){if(!this._coneNode){return}if(!C.topCenterPoint){return}var B=new y.Vector3(C.bottomRadius,0,0);var A=new y.Vector3(0,C.bottomRadius,0);var F=new y.Vector3(0,0,C.length*0.5);var D=new y.Matrix4().makeBasis(B,A,F);var E=l.getMatrixFromOVz(C.center,new y.Vector3(-C.normal.x,-C.normal.y,-C.normal.z));this._coneNode.setMatrix(new y.Matrix4().multiplyMatrices(E,D))},_hideConeFeedback:function(){if(this._coneNode){this._coneNode.setVisibility(false)}},_showSphereFeedback:function(){if(!this._sphereNode){this._sphere=e.createSphereNode({radius:1,color:new j.Color(0,86/255,134/255,0.5)});this._sphere.setNoZ(true);this._sphereNode=new p();this._sphereNode.add(this._sphere);this._sphereNode.setPickable(j.NODRAWHL);this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._sphereNode)}this._sphereNode.setVisibility(true)},_updateSphereFeedback:function(C){if(!this._sphereNode){return}if(!C.center||!C.radius){return}var B=new y.Vector3(C.radius,0,0);var A=new y.Vector3(0,C.radius,0);var F=new y.Vector3(0,0,C.radius);var D=new y.Matrix4().makeBasis(B,A,F);var E=l.getMatrixFromOVz(C.center,new y.Vector3(0,0,1));this._sphereNode.setMatrix(new y.Matrix4().multiplyMatrices(E,D))},_hideSphereFeedback:function(){if(this._sphereNode){this._sphereNode.setVisibility(false)}},_showCircleFeedback:function(){if(!this._circleNode){var A=new y.LineBasicMaterial({side:y.DoubleSide,transparent:false,color:"#005686",opacity:1,force:true,polygonBorderMode:true,lineWidth:2});this._circle=e.createCircleNode({radius:1,material:A,fill:false});this._circle.setNoZ(true);this._circleNode=new p();this._circleNode.add(this._circle);this._circleNode.setPickable(j.NODRAWHL);this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._circleNode)}this._circleNode.setVisibility(true)},_updateCircleFeedback:function(C){if(!this._circleNode){return}if(!C.radius||!C.center||!C.normal){return}var B=new y.Vector3(C.radius,0,0);var A=new y.Vector3(0,C.radius,0);var F=new y.Vector3(0,0,1);var D=new y.Matrix4().makeBasis(B,A,F);var E=l.getMatrixFromOVz(C.center,C.normal);this._circleNode.setMatrix(new y.Matrix4().multiplyMatrices(E,D))},_hideCircleFeedback:function(){if(this._circleNode){this._circleNode.setVisibility(false)}},_showAxisFeedback:function(){if(!this._axisNode){this._axis=v.buildLineStripSet([0,0,0,0,0,1],[2],[0,1],new j.Color(0,86/255,134/255),2,"WIRE_EDGE",null);var B={type:w.ELineType.DotDash,lineWidth:1,color:new y.Color().setRGB(0,86/255,134/255)};var A=this._experienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(B,null);this._axis.setMaterial(A);this._axis.setNoZ(true);this._axisNode=new p();this._axisNode.add(this._axis);this._axisNode.setPickable(j.NODRAWHL);this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._axisNode)}this._axisNode.setVisibility(true)},_updateAxisFeedback:function(B){if(!this._axisNode){return}if(!B.center||!B.normal){return}var D=this._experienceBase.getManager("VCXContextManager");var F=D?D.getRootPathElement().getBoundingSphere(D.getMainViewer()):null;var G=10*(F?F.radius:1000);var K=new y.Vector3(1,0,0);var J=new y.Vector3(0,1,0);var H=new y.Vector3(0,0,G);var I=new y.Matrix4().makeBasis(K,J,H);var A=B.point,E=B.normal;var M=new y.Vector3(A.x-0.5*G*E.x,A.y-0.5*G*E.y,A.z-0.5*G*E.z);var O=l.getMatrixFromOVz(M,E);this._axisNode.setMatrix(new y.Matrix4().multiplyMatrices(O,I))},_hideAxisFeedback:function(){if(this._axisNode){this._axisNode.setVisibility(false)}},_showPointFeedback:function(){if(!this._pointNode){this._point=v.buildPointSet([0,0,0],[0],new j.Color(0,32/255,134/255),8,null);this._point.setNoZ(true);this._pointNode=new p();this._pointNode.add(this._point);this._pointNode.setPickable(j.NODRAWHL);this._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._pointNode)}this._pointNode.setVisibility(true)},_updatePointFeedback:function(A){if(!this._pointNode){return}if(!A.point){return}var B=new y.Matrix4().setPosition(A.point);this._pointNode.setMatrix(B)},_hidePointFeedback:function(){if(this._pointNode){this._pointNode.setVisibility(false)}},_beginDrag:function(B,A){this._startToDrag=true;this._isDraggin=false;this._pos2DduringDragX=B;this._pos2DduringDragY=A},_onDrag:function(C,B){if(!this._startToDrag||this._isDraggin){return}var A=C-this._pos2DduringDragX;var E=B-this._pos2DduringDragY;var D=A*A+E*E;if(D>4){this._isDraggin=true;this.Acquired[this.GetNextAcquisitionIndice()].accepted=true;if(this.PointAcquiredCB){this.PointAcquiredCB(this.Acquired)}}},_endDrag:function(){this._startToDrag=false;this._isDraggin=false},_debugHTMLAcquired:function(){if(!this._debugTools){return}var B='<div style="width:220px;padding:5px;"><div style="margin:5px;width:210px" align="center"><b>Current Acquisition</b></div>';if(this._experienceBase.getManager("VCXContextManager").isTouchCompliantDevice()){B+='<div style="margin:5px;" align="left">Touch compliante: vertical decay added</div>'}for(var A=0;A<this.Acquired.length;A++){B+='<div style="width:200px;border:1px solid black; margin:5px;padding:5px;">';B+='<div align="right" style="width:100%;">'+A+"</div>";B+=this._debugHTMLPos2D(A);B+=this._debugHTMLPos3D(A);B+=this._debugHTMLNormal(A);B+=this._debugHTMLModifiable(A);B+=this._debugHTMLState(A);B+="</div>"}B+="</div>";this._debugTools.updateImmersiveConsole(B)},_debugHTMLPos2D:function(C){if(!this._debugTools){return}var G=this._debugTools.getImgCursor();var D=C;if(this._infinite){D=0}var E=this.Acquisitions[D].displayFeedback;var A=(E&o.FEEDBACKMODE.POINT)||(E&o.FEEDBACKMODE.POINT_ONLY_ON_PART);var B=this.Acquisitions[D].is2D;var F="";if(A&&B){F+="<div>"}else{F+='<div style="opacity:0.4;">'}F+=G+this.Acquired[C].mouse.xPix+"/"+this.Acquired[C].mouse.yPix;F+="</div>";return F},_debugHTMLPos3D:function(C){if(!this._debugTools){return}var F=this._debugTools.getImgCoord();var D=C;if(this._infinite){D=0}var E=this.Acquisitions[D].displayFeedback;var A=(E&o.FEEDBACKMODE.POINT)||(E&o.FEEDBACKMODE.POINT_ONLY_ON_PART);var B=this.Acquisitions[D].is2D;var G="";if(A&&!B){G+="<div>"}else{G+='<div style="opacity:0.4;">'}G+=F+this.Acquired[C].pickInfo.globalPosition.x.toFixed(2)+"/"+this.Acquired[C].pickInfo.globalPosition.y.toFixed(2)+"/"+this.Acquired[C].pickInfo.globalPosition.z.toFixed(2);G+="</div>";return G},_debugHTMLNormal:function(B){if(!this._debugTools){return}var A=this._debugTools.getImgArrow();var D=B;if(this._infinite){D=0}var E=this.Acquisitions[D].displayFeedback;var C=(E&o.FEEDBACKMODE.NORMAL)||(E&o.FEEDBACKMODE.NORMAL_ONLY_ON_PART);var F="";if(C){F+="<div>"}else{F+='<div style="opacity:0.4;">'}F+=A+this.Acquired[B].pickInfo.globalNormal.x.toFixed(2)+"/"+this.Acquired[B].pickInfo.globalNormal.y.toFixed(2)+"/"+this.Acquired[B].pickInfo.globalNormal.z.toFixed(2);F+="</div>";return F},_debugHTMLState:function(B){if(!this._debugTools){return}var A=this._debugTools.getImgValid();var D=this._debugTools.getImgInvalid();var C='<div style="padding-top:5px">';if(this.Acquired[B].accepted){C+=A;C+="Accepted"}else{C+=D;C+="Current acquisition"}C+="</div>";return C},_debugHTMLModifiable:function(B){if(!this._debugTools){return}var A=this._debugTools.getImgCube();var C="";if(this.Acquired[B].pickInfo.modifiable){C="<div>"}else{C='<div style="opacity:0.4;">'}C+=A;C+=t.getLeafNameOfPathElement(this.Acquired[B].pickInfo.pathElement);C+="</div>";return C},_getArcBarButtons:function(H,C){if(!H||!C){return}var I=[];var F=a.Canonic.None;var G=this;for(var D=0;D<H.length;++D){var J=H[D];if(!J||J===""){console.log("[ARC BAR][NLS] Geometry can't be identified");continue}var K=C.getTitle({key:"Canonic."+J});if(!K||K===""){console.log("[ARC BAR][NLS] Geometry translation can't be identified from the input string");continue}var A=c.getWebappsAssetUrl("VCXWebDressup","icons/I_VCX_Canonics_"+J+".png");if(!A||A===""){console.log("[ARC BAR][URL] Geometry icon url can't be identified from the input string");continue}var B=a.Canonic[J];if(!B){console.log("[ARC BAR][ENUM] Geometry enum can't be identified from the input string");continue}F|=B;var E={nls:K,url:A,id:"id_Canonic_"+J,type:"element",userdata:B,callback:function(L){var M=G.picker._canonicsMode;if(M&L){M&=~L}else{M|=L}G.picker.useCanonicsDetection(M)},callbackUpdate:function(N,L){var M=G.picker._canonicsMode;N.check=(M&L)?true:false},};I.push(E);this.picker.useCanonicsDetection(F)}return I},updateCanonicsDetection:function(){var D=this.GetNextAcquisitionIndice();var I=(this.Acquisitions&&this.Acquisitions.length>D)?this.Acquisitions[D].displayFeedback:0;var B=this._experienceBase.getManager("VCXContextManager");var G=B&&B.getPickerCanonicsDetection();if(!G){if(this._arcBar){this._arcBar.clear();this._arcBar=null;this.picker.useCanonicsDetection(a.Canonic.None)}return}if(this._arcBar){if(this._arcBar.feedbackMode===I){return}this._arcBar.clear();this._arcBar=null;this.picker.useCanonicsDetection(a.Canonic.None)}var E=[];if(I&o.FEEDBACKMODE.CANONIC_POINT){E.push("Point")}if(I&o.FEEDBACKMODE.CANONIC_LINE){E.push("Line")}if(I&o.FEEDBACKMODE.CANONIC_CIRCLE){E.push("Circle")}if(I&o.FEEDBACKMODE.CANONIC_PLANE){E.push("Plane")}if(I&o.FEEDBACKMODE.CANONIC_CYLINDER){E.push("Cylinder")}if(I&o.FEEDBACKMODE.CANONIC_CONE){E.push("Cone")}if(I&o.FEEDBACKMODE.CANONIC_SPHERE){E.push("Sphere")}if(I&o.FEEDBACKMODE.CANONIC_CIRCLE_CENTER){E.push("CircleCenter")}if(I&o.FEEDBACKMODE.CANONIC_EDGE_EXTREMITY){E.push("EdgeExtremity")}if(I&o.FEEDBACKMODE.CANONIC_POINT_ON_AXIS){E.push("PointOnAxis")}if(!E.length){return}var F=this._experienceBase.getManager("VCXContextManager").getUIFrame();if(!F){return}var H=this._experienceBase.getManager("VCXNLSManager");if(!H){return}var C=H.GetNLS(["VCXWebDressup/VCXWebDressup"]);if(!C){return}var A=-10;if(this._experienceBase.getManager("VCXContextManager").isTouchCompliantDevice()){A+=25}this._arcBar=new q({experienceBase:this._experienceBase,body:F,frmWindow:this._experienceBase.getManager("VCXContextManager").getFrameWindow(),title:"Filter Control",typeSeparator:"bubble",actionBar:this._experienceBase.getManager("VCXContextManager").getActionBar(),heightOffset:A,lJsonElement:this._getArcBarButtons(E,C)});this._arcBar.feedbackMode=I}});o.FEEDBACKMODE={NONE:1<<0,POINT:1<<1,POINT_ONLY_ON_PART:1<<2,NORMAL:1<<3,NORMAL_ONLY_ON_PART:1<<4,CANONIC_POINT:1<<5,CANONIC_POINT_ON_AXIS:1<<6,CANONIC_CIRCLE_CENTER:1<<7,CANONIC_EDGE_EXTREMITY:1<<8,CANONIC_LINE:1<<9,CANONIC_CIRCLE:1<<10,CANONIC_PLANE:1<<11,CANONIC_CYLINDER:1<<12,CANONIC_CONE:1<<13,CANONIC_SPHERE:1<<14};o.CONSTRAINT={NONE:0,CAMERA_NORMAL:1,POINT_ON_Z:2,POINT_ON_X:3,POINT_ON_Y:4,USER:5};return o});define("DS/VCXWebDressup/VCXDressupModifiable",["DS/VCXWebExperienceBase/VCXModifiableOccurrenceExperience","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebDressup/VCXPropertyValueHTMLFormater","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebProperties/VCXPropertyValueHyperlinkId","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueVector","DS/Visualization/ThreeJS_DS"],function(i,l,e,a,h,d,f,b,n,m,o,c,k,q,p,r,j,g,t,s,w,v){var u=i.extend({init:function(){this._parent();this._Properties=[];this._PropertyGroups=[];this._Anchors={}},Build:function(){this._parent();var x=[{Name:"Actor.Color",Type:j,NLSPath:"VCXWebModifiables/VCXWebModifiables"},{Name:"Actor.Color.Defined",Type:q,DefaultValue:true,NLSPath:"VCXWebModifiables/VCXWebModifiables"},{Name:"Actor.Position",Type:g,DefaultValue:new g().GetValue(),NLSPath:"VCXWebModifiables/VCXWebModifiables"},{Name:"Collab.HideIfOutsideAnchorFrustrum",Type:q,DefaultValue:false},{Name:"Actor.Interpolation.Type",Type:s,DefaultValue:b.EInterpolationType.Linear,NLSPath:"VCXWebModifiables/VCXWebModifiables",MapChoice:this._generateMapChoiceFromEnumAndId(b.EInterpolationType,"Interpolation",["Custom","Smooth"])},{Name:"Actor.IsAlwaysOnTop",Type:q,DefaultValue:true},];this._BuildPropertyValues(x)},_BuildPropertyValues:function(F){for(var A=0;A<F.length;++A){var B=F[A].Name;var D=this._Properties[B];var C=null;var z=null;if(D){C=D.GetPropertyInfo();z=D.GetPropertyValue()}if(!C){var E=0;if(typeof F[A].BehaviorType!=="undefined"){E=F[A].BehaviorType}var x="VCXWebDressup/VCXWebDressup";if(typeof F[A].NLSPath!=="undefined"){x=F[A].NLSPath}var y=true;if(typeof F[A].Persistent!=="undefined"){y=F[A].Persistent}if(F[A].ControlsGroupAvailability){E=2;C=new c(B,E,y,x);if(F[A].ControlsGroupAvailability){C.SetMapChoiceEnum(this._generateMapChoiceFromEnumAndId(u.EAvailability,"Group.Availability"))}}else{if(typeof F[A].MapChoice!=="undefined"||F[A].ControlsGroupAvailability){C=new c(B,E,y,x);if(typeof F[A].MapChoice!=="undefined"){C.SetMapChoiceEnum(F[A].MapChoice)}}else{C=new o(B,E,y,x)}}}if(typeof F[A].Bounds!=="undefined"){C.SetBounds(F[A].Bounds.Min,F[A].Bounds.Max,F[A].Bounds.Step)}if(F[A].UnitType){C.SetUnitType(F[A].UnitType)}if(typeof F[A].GroupId!=="undefined"){C.SetGroupId(F[A].GroupId);if(!this._PropertyGroups[F[A].GroupId]){this._PropertyGroups[F[A].GroupId]={}}if(F[A].ControlsGroupAvailability){this._PropertyGroups[F[A].GroupId].PropertyControlingGroupAvailability=B}if(F[A].ControlsGroupVisibility){this._PropertyGroups[F[A].GroupId].PropertyControlingGroupVisibility=B;C.SetControlsGroupVisibility(true)}}if(!z&&F[A].Type){z=new F[A].Type()}if(z&&typeof F[A].DefaultValue!=="undefined"){z.SetValue(F[A].DefaultValue)}if(!D){this._Properties[B]=new m(C,z)}if(typeof F[A].DefaultValue!=="undefined"){this.OnChangeProperty(B,z)}}},SetPropertiesInfo:function(){this.SetPropertyInvisible("Actor.Interpolation.Type",true);this.SetPropertyInvisible("Actor.Color",true);this.SetPropertyInvisible("Actor.Color.Defined",true);this.SetPropertyInvisible("Actor.Visibility.Opacity",true);this.SetPropertyInvisible("Actor.Position",true);this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",true)},GetUpdatedDiv:function(){if(!this._panelDiv){this._panelDiv=new UWA.Element("div",{"class":"DressupText",id:this._hashing});this._panelDiv.style.position="absolute";var K=this.ExperienceBase.getManager("VCXContextManager").getUIFrame();this._panelDiv.inject(K)}if(this._panelDiv){var J=this.GetComputedStringProperty("Collab.Text",h.format);this._panelDiv.innerHTML=J;var C=this._panelDiv.childNodes[0];if(C){C.style["text-align"]="center";C.style["vertical-align"]="bottom";var z=this.GetFontPropertyValue("Collab.Text.Font");if(z){C.style["font-family"]=z.Family;C.style["font-size"]=z.Height}var F=this.GetColorPropertyValue("Collab.Text");C.style.color=F.GetStyle()}var E=this.GetPropertyValue("Collab.Body.Shape");var A="5px";if(E===3||E===4){A="50%"}var M="none";if(this.GetPropertyGroupVisibility("Group.Border")&&E>0){M="solid";var x=this.GetPropertyValue("Collab.Border.Line.Width");if(x){this._panelDiv.style["border-width"]=x+"px"}var B=this.GetColorPropertyValue("Collab.Border.Line");this._panelDiv.style["border-color"]=B.GetStyle()}this._panelDiv.style["box-shadow"]="5px 5px 11px #888888";this._panelDiv.style["vertical-align"]="bottom";this._panelDiv.style["border-radius"]=A;this._panelDiv.style["border-style"]=M;var H=this.GetPropertyValue("Collab.Body.InnerMargin");if(H){this._panelDiv.style.padding=H+"px"}var y="none";if(this.GetPropertyGroupVisibility("Group.Background")&&E>0){var I=this.GetColorPropertyValue("Collab.Background");y=I.GetStyle()}this._panelDiv.style.background=y;var G=this.GetPropertyValue("Collab.Body.Width");var L=this.GetPropertyValue("Collab.Body.Height");var D=this.GetPropertyValue("Collab.Body.FitToText");if(D&&C){G=C.clientWidth;L=C.clientHeight}if(E===2||E===3){L=Math.max(G,L);G=L}if(L){this._panelDiv.style.height=(L+1)+"px"}if(G){this._panelDiv.style.width=(G+1)+"px"}}return this._panelDiv},GetPropertyValue:function(x,z){var y;if(z){y=this.GetProperty(x)}else{y=this._Properties[x];if(!y){y=this.GetProperty(x)}}if(y){if(y.GetPropertyValue()){return y.GetPropertyValue().Value}}},GetNewProperty:function(A,z){var B=this._Properties[A];var y=null;if(B){var x=this._Properties[A].GetPropertyValue().Clone();x.SetValue(z);y=new m(this._Properties[A].GetPropertyInfo(),x)}return y},GetNewEnumProperty:function(z,y){var x=0;var A=this._Properties[z];if(A){var B=this._Properties[z].GetPropertyInfo().GetMapChoiceEnum();for(var C in B){if(B.hasOwnProperty(C)){if(B[C]===y){return this.GetNewProperty(z,parseInt(C))}}}}return null},GetAttachedOccurences:function(){var x=[];if(!(this._Anchors&&Object.keys(this._Anchors).length>0)){return x}var y=this;this.processAnchorsIDs(function(z){var B=y._Anchors[z];if(B){var A=B.GetValueLink().Value;if(A){var C=y.ExperienceBase.ComponentsMap.GetComponentFromID(A);if(C){x.push(C)}}}});return x},GetComputedStringProperty:function(z,B){var D;var A=this.GetProperty(z);if(A){D=A.GetPropertyValue().ToString();if(D){var y="";var C=this._Anchors[0];if(C){y=C.GetValueLink().Value}var x=d.ValuateLinkedProperties(D,this.ExperienceBase,y,this.GetObject().GetID(),B);return x}}},getAnchorsCount:function(){var y=0;var x=this.GetPropertyValue("Collab.ListAnchorsIDs");if(x){y+=x.length}x=this.GetPropertyValue("Collab.List2DAnchorsIDs");if(x){y+=x.length}return y},getNewAnchorID:function(){var x=this.getAnchorsCount();while(this._Anchors[x]){++x}return x},GetAnchorValue:function(y){var x=this._Anchors[y];if(x){return this._Anchors[y].GetValueFrame().Value}else{return null}},GetAnchorWorldMatrix:function(z,x){var y=this._Anchors[z];if(y){return e.getWorldMatrix(y,this.GetObject(),x)}else{return null}},GetFontPropertyValue:function(z){var y=this.GetProperty(z);if(y){var x=y.GetPropertyValue();if(x){return x.GetFont()}}return null},GetColorPropertyValue:function(y){var z=this.GetPropertyValue(y+".Color");var A=this.GetPropertyValue(y+".Color.Opacity");if(typeof A==="undefined"){A=this.GetPropertyValue(y+".Opacity")}var x=new n();if(typeof z==="object"){x=z.Clone()}if(typeof A==="undefined"){A=1}if(typeof A==="number"&&A>=0&&A<=1){x.a=A}else{console.warn("Opacity range [0.0,1.0]")}return x},GetFramePropertyValue:function(y){var x=this.GetProperty(y);if(x){return x.GetPropertyValue().GetFrame().Value}return null},GetPropertyGroupVisibility:function(x){var y=this._PropertyGroups[x];if(y){if(y.PropertyControlingGroupAvailability){if(this.GetPropertyValue(y.PropertyControlingGroupAvailability)===2||this.GetPropertyValue(y.PropertyControlingGroupAvailability)===4){return false}}if(y.PropertyControlingGroupVisibility){if(!this.GetPropertyValue(y.PropertyControlingGroupVisibility)){return false}}}else{console.warn("Does the property group "+x+" exists ?")}return true},_SetProperty:function(F,J){var I=false;if(this._Properties[F]===undefined&&J){var C;if(F.substring(0,13)==="Actor.Anchor."){C=new o(F,0);C.SetVisible(false)}else{return false}if(C){this._Properties[F]=new m(C,J.Clone())}I=true}var G=this._Properties[F];if(J){if(!J.IsEqualTo(G.GetPropertyValue())){if(G.GetPropertyValue()!==undefined&&J!==undefined){G.SetPropertyValue(J.Clone());I=true}else{console.warn("WTF !!!")}}}else{I=true;delete this._Properties[F]}if(F.substring(0,13)==="Actor.Anchor."){var B=F.substring(13,30);if(J){if(!J.IsEqualTo(this._Anchors[B])){I=true;var A=null;if(this._Anchors[B]){A=this._Anchors[B].is2DAnchor}this._Anchors[B]=J.Clone();if(A!==null){this._Anchors[B].is2DAnchor=A}}}else{I=true;delete this._Anchors[B];var y=this.GetPropertyValue("Collab.ListAnchorsIDs");var H=y.indexOf(B);if(H>=0){y.splice(H,1);var D=new w(y);this.OnChangeProperty("Collab.ListAnchorsIDs",D)}}}if(F==="Actor.Name"){var x=J.Value;var E=this.QueryInterface("W3AISGNodeHolder");if(E){var z=E.giveSGNode();if(z){z.setName(x)}}}return true},OnChangeProperty:function(A,x,z){if(!z){z={}}if(z.fromChildClass){}else{if(this.OnChangePropertyBegin(A,x)){return true}}if(A==="Collab.ListAnchorsIDs"||A==="Collab.List2DAnchorsIDs"){this._needToUpdateAnchors=true}if(!this._SetProperty(A,x)){var y=false;if(!y){z.fromChildClass=true;y=this._parent(A,x,z);if(y){var B=this.QueryInterface("W3AISGNodeHolder");if(B){B.setSGNodeDirty(true)}}}if(!y){console.warn("Unknown property on "+this.GetPropertyValue("Actor.Name")+" : "+A)}return y}return true},OnChangePropertiesEnd:function(){if(this._needToUpdateAnchors){this.updateAnchorsType();this._needToUpdateAnchors=false}this._parent();this.GetObject().setDirty()},GetProperty:function(A){var y=null;var E=this._Properties[A];if(E){y=new m(E.GetPropertyInfo(),E.GetPropertyValue().Clone())}else{var D="._ComputedText";if(A.endsWith(D)){var z=A.substring(0,A.length-D.length);var C=this.GetComputedStringProperty(z);var B=new p(C);var x=new o(z,1,false);y=new m(x,B)}if(!y){y=this._parent(A)}}return y},GetProperties:function(C){this.SetPropertiesInfo();var A=this._parent(),x,z=this;if(this._Anchors&&Object.keys(this._Anchors).length>0){this.processAnchorsIDs(function(H){A.AddOrModifyProperty(z.GetProperty("Actor.Anchor."+H))})}for(x in this._Properties){if(this._Properties.hasOwnProperty(x)){var F=true;var E=true;var B=this._Properties[x].GetPropertyInfo();var G=B.GetGroupId();if(G){var D=this._PropertyGroups[G];if(D){if(D.PropertyControlingGroupAvailability){var y=this.GetPropertyValue(D.PropertyControlingGroupAvailability);if(x!==D.PropertyControlingGroupAvailability){if(y===u.EAvailability.AppForceNotAvailable){F=false}else{if(y===u.EAvailability.AppForceAvailable){if(x===D.PropertyControlingGroupVisibility){E=false}}}}else{E=false}if(y===u.EAvailability.AppForceAvailable&&x===D.PropertyControlingGroupVisibility){E=false}}if(F&&D.PropertyControlingGroupVisibility){if(x!==D.PropertyControlingGroupVisibility){if(!this.GetPropertyValue(D.PropertyControlingGroupVisibility)){E=false}}}}}B.SetVisible(E&&!this._Properties[x].Invisible);if(F){A.AddOrModifyProperty(this.GetProperty(x))}}}return A},SetPropertyInvisible:function(y,x){if(this._Properties[y]){this._Properties[y].Invisible=x}},Dispose:function(){},processAnchorsIDs:function(C,B){var A=[];if(!B||!B.no3DAnchors){var z=this.GetPropertyValue("Collab.ListAnchorsIDs");if(z){A=A.concat(z)}}if(!B||!B.no2DAnchors){var z=this.GetPropertyValue("Collab.List2DAnchorsIDs");if(z){A=A.concat(z)}}if(B&&B.sort){A.sort()}if(Array.isArray(A)&&A.length>0){var D=true;for(var y=0;y<A.length;++y){var x=A[y];D=C(x);if(D===false){return}}}},updateAnchorsType:function(){var z=this.GetPropertyValue("Collab.ListAnchorsIDs");if(Array.isArray(z)&&z.length>0){for(var y=0;y<z.length;++y){var x=z[y];if(this._Anchors[x]){this._Anchors[x].is2DAnchor=false}else{console.warn("Can't find refered anchor:"+x)}}}z=this.GetPropertyValue("Collab.List2DAnchorsIDs");if(Array.isArray(z)&&z.length>0){for(var y=0;y<z.length;++y){var x=z[y];if(this._Anchors[x]){this._Anchors[x].is2DAnchor=true}else{console.warn("Can't find refered anchor:"+x)}}}},getPositionOfFirstAnchor:function(){var y=this.GetPropertyValue("Collab.ListAnchorsIDs");var z=y[0];var x=this.GetAnchorWorldMatrix(z);return new v.Vector3().getPositionFromMatrix(x)},getPositionOfLastAnchor:function(){var y=this.GetPropertyValue("Collab.ListAnchorsIDs");var x=y[y.length-1];var z=this.GetAnchorWorldMatrix(x);return new v.Vector3().getPositionFromMatrix(z)},getLineMaterialParams:function(x,J,F,A){if(typeof A!=="number"){A=1}var I={},D=this.GetPropertyValue(x+".Type"),C=this.GetPropertyValue(x+".Width"),H=this.GetColorPropertyValue(x),z=H.GetThreeColor(),B=H.a,y=this.GetProperty(x+".2.Color");if(!J||F!==D){if(D===l.ELineType.UserDefined){var G=this.GetPropertyValue(x+".StipplingMotif");if(G){var K=G.split(" ");I.dashPattern=K.map(function(L){return 4*parseInt(L)})}}else{I.type=D}}if(!J||J.lineWidth!==C){I.lineWidth=C}if(y){if(!J||J.vertexColors!==v.VertexColors){I.vertexColors=v.VertexColors}if(!J||J.opacity!==A){I.opacity=A}}else{if(!J||!J.color.equals(z)){I.color=z}var E=B*A;if(!J||J.opacity!==E){I.opacity=E}}return I},GetOpacity:function(){var y=this.GetPropertyValue("Actor.Opacity");y*=this.GetPropertyValue("Actor.Visibility.Opacity");if(y>0){var x=this.QueryInterface("VCXIVisibility");if(x){if(x.GetVisibility()===f.EVisState.Hidden){y=0}}}return y}});u.EAvailability={NoControl:0,AppForceAvailable:1,AppForceNotAvailable:2,AppNotVisible:3};Object.defineProperty(u.prototype,"ExperienceBase",{enumerable:true,get:function(){return this.GetObject()._experienceBase}});return u});define("DS/VCXWebDressup/VCXSectionModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueVector"],function(c,e,k,a,h,i,f,j,g,b,d){var l=c.extend({init:function(){this._parent();this._bIsSection=true},Build:function(){this._parent();var m=[{Name:"Actor.Anchor.0",Type:g,Visibility:false,DefaultValue:new g().SetValueFrame(new f().SetValueFromVector(new e.Vector3(0,0,0))).GetValue()},{Name:"Actor.Color",DefaultValue:new k().FromRGBA(1,1,0,1),GroupId:"Group.Section.Plane"},{Name:"Actor.Opacity",DefaultValue:0.15,GroupId:"Group.Section.Plane"},{Name:"Actor.IsAlwaysOnTop",DefaultValue:false,GroupId:"Group.Section.Plane"},{Name:"Section.Plane.Enable",Type:a,DefaultValue:true,ControlsGroupVisibility:true,GroupId:"Group.Section.Plane"},{Name:"Section.Enable",Type:a,DefaultValue:true,ControlsGroupVisibility:true,GroupId:"Group.Section"},{Name:"Section.AutoFlip",Type:a,DefaultValue:true,GroupId:"Group.Section"},{Name:"Section.SpaceBackAlpha",Type:i,DefaultValue:1,GroupId:"Group.Section"},{Name:"Section.SpaceFrontAlpha",Type:i,DefaultValue:0,GroupId:"Group.Section"},{Name:"Actor.ListActors",Type:b,GroupId:"Group.Section"},{Name:"Section.Capping",Type:a,DefaultValue:true,ControlsGroupVisibility:true,GroupId:"Group.Section.Capping"},{Name:"Section.Capping.Color",Type:j,DefaultValue:new k().FromRGBA(1,1,0,1),GroupId:"Group.Section.Capping"},{Name:"Section.Capping.ActorColor",Type:a,DefaultValue:false,GroupId:"Group.Section.Capping"},{Name:"Section.Hatching.Color",Type:j,DefaultValue:new k().FromRGBA(0,0,0,1),GroupId:"Group.Section.Hatching"},{Name:"Section.Hatching.Frequency",Type:h,DefaultValue:0,GroupId:"Group.Section.Hatching"},{Name:"Section.Hatching.Angle",Type:i,DefaultValue:0,GroupId:"Group.Section.Hatching"},{Name:"Collab.ListAnchorsIDs",Type:d,DefaultValue:[0]}];this._BuildPropertyValues(m);this.SetPropertyInvisible("Collab.ListAnchorsIDs",true)},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Actor.Color",false)},});return l});define("DS/VCXWebDressup/VCXRedLineModifiable",["DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueMap"],function(d,b,j,g,i,e,f,c,a){var h=b.extend({init:function(){this._parent()},Build:function(){this._parent();var k=[{Name:"Actor.Color",DefaultValue:new j().FromRGBA(1,0,0,1)},{Name:"Collab.Body.Line.Width",Type:i,DefaultValue:2,GroupId:"Group.Line"},{Name:"Actor.Anchor.0",Type:f,DefaultValue:new f().SetValueFrame(new e().SetValueFromVector(new d.Vector3(0,0,0))).GetValue()},{Name:"Collab.ListAnchorsIDs",Type:c,DefaultValue:[0]},{Name:"Collab.VertexBuffers",Type:a,DefaultValue:new a()}];this._BuildPropertyValues(k);this.SetPropertyInvisible("Collab.ListAnchorsIDs",true);this.SetPropertyInvisible("Collab.VertexBuffers",true);this.GetProperty("Actor.Color").GetPropertyInfo().SetVisible(true);this.GetProperty("Actor.Anchor.0").GetPropertyInfo().SetVisible(false);this.GetProperty("Collab.VertexBuffers").GetPropertyInfo().SetBehaviorType(2)},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Actor.Color",false);this.GetProperty("Collab.VertexBuffers").GetPropertyInfo().SetBehaviorType(2)}});return h});define("DS/VCXWebDressup/VCXGroundModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXColor"],function(e,g,f,b,d,a){var c=e.extend({init:function(){this._parent();this._bIsGround=true;this._envMapNeverLoaded=false},Build:function(){this._parent();var h=[{Name:"Environment.Ground.Color",Type:d,DefaultValue:new a(),GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Border.Show",Type:f,DefaultValue:true,ControlsGroupVisibility:true,GroupId:"Group.Environment.Ground.Border"},{Name:"Environment.Ground.Border.Color",Type:d,DefaultValue:new a(),GroupId:"Group.Environment.Ground.Border"},{Name:"Environment.Ground.FallOff",Type:b,DefaultValue:0,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Environment.Ground.Border"},{Name:"Environment.Ground.Diameter.Auto",Type:f,DefaultValue:true,GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Diameter",Type:b,DefaultValue:1,GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Shadows.Show",Type:f,DefaultValue:false,ControlsGroupVisibility:true,GroupId:"Group.Environment.Ground.Shadows"},{Name:"Environment.Ground.Mirror.Show",Type:f,DefaultValue:false,ControlsGroupVisibility:true,GroupId:"Group.Environment.Ground.Mirror"},{Name:"Environment.Ground.Mirror.Blurry",Type:f,DefaultValue:true,GroupId:"Group.Environment.Ground.Mirror"},{Name:"Environment.Ground.Grid.Show",Type:f,DefaultValue:false,ControlsGroupVisibility:true,GroupId:"Group.Environment.Ground.Grid"},{Name:"Environment.Ground.Grid.Color",Type:d,DefaultValue:new a(),GroupId:"Group.Environment.Ground.Grid"},{Name:"Environment.Ground.Grid.Falloff",Type:b,DefaultValue:0,Bounds:{Min:0,Max:2,Step:0.01},GroupId:"Group.Environment.Ground.Grid"},];this._BuildPropertyValues(h)},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Actor.Color",false);this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=false},RequestModification:function(j){var i=new g();if(j){if(j.GetPropertyInfo().GetPropertyName()==="Actor.Color"){var h=j.GetPropertyValue().Value.getAssociatedColors();i.AddOrModifyProperty(this.GetNewProperty("Environment.Ground.Color",h.body));i.AddOrModifyProperty(this.GetNewProperty("Environment.Ground.Border.Color",h.border));i.AddOrModifyProperty(this.GetNewProperty("Environment.Ground.Grid.Color",h.attach))}else{i.AddOrModifyProperty(j)}}return i}});return c});define("DS/VCXWebDressup/VCXCompassModifiable",["DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValuePoint2D","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueFrame",],function(h,e,i,l,a,j,k,d,b,f,g){var c=e.extend({init:function(){this._parent()},Build:function(){this._parent();var p=this.GetProperties();if(p){for(var n in p._map){var r=this.GetProperty(n);if(r&&r.GetPropertyInfo()){r.GetPropertyInfo().SetVisible(false)}}}var q=[{Name:"Actor.Name",Type:l,DefaultValue:"Compass",NLSPath:"VCXWebModifiables/VCXWebModifiables"},{Name:"Actor.Visibility.Opacity",Type:k,DefaultValue:1,NLSPath:"VCXWebModifiables/VCXWebModifiables"},{Name:"Compass.GeomPath",Type:f,DefaultValue:-1,GroupId:"Group.Compass.General",BehaviorType:1},{Name:"Compass.AbsoluteSize",Type:a,DefaultValue:false,GroupId:"Group.Compass.Size",BehaviorType:1},{Name:"Compass.Size",Type:k,DefaultValue:0.1,Bounds:{Min:0,Max:1,Step:0.1},GroupId:"Group.Compass.Size",BehaviorType:1},{Name:"Compass.SizePixel",Type:j,DefaultValue:300,GroupId:"Group.Compass.Size",BehaviorType:1},{Name:"Compass.Translation",Type:d,DefaultValue:new h.Vector3(0,0,0),BehaviorType:1},{Name:"Compass.Alignment",Type:g,DefaultValue:new h.Matrix4(),BehaviorType:1}];if(typeof this.GetObject()._experienceBase.odt!=="undefined"){var o={Name:"Compass.ODT.CustomRobotState",Type:a,DefaultValue:false,GroupId:"Group.Compass.General",BehaviorType:1};var m={Name:"Compass.ODT.CustomRobotGeomNodesNumber",Type:j,DefaultValue:0,GroupId:"Group.Compass.General",BehaviorType:1};q.push(o);q.push(m)}this._BuildPropertyValues(q);this.GetProperty("Compass.Translation").GetPropertyInfo().SetVisible(false);this.GetProperty("Compass.Alignment").GetPropertyInfo().SetVisible(false)},GetProperty:function(t){if(typeof this.GetObject()._experienceBase.odt!=="undefined"){var u=null;var m=this._Properties[t];var r=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();var q=r.getCustomReferenceAxisSystem();switch(t){case"Compass.ODT.CustomRobotState":var n=new a();n.SetValue(q!==null);u=new i(m.GetPropertyInfo(),n);break;case"Compass.ODT.CustomRobotGeomNodesNumber":var o=new j();o.SetValue(0);u=new i(m.GetPropertyInfo(),o);if(q){var s=q.node;var p=s&&s.children?s.children[0]:null;o.SetValue(p&&p.children?p.children.length:0)}break;default:break}if(u){return u}}return this._parent(t)}});return c});define("DS/VCXWebDressup/VCXCameraModifiable",["DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXProperty",],function(h,e,d,m,j,i,b,k,a,l,f,g){var c=e.extend({init:function(){this._parent();this._bIsCamera=true},Build:function(){this._parent();var n=[{Name:"Camera.Position",Type:i,DefaultValue:new h.Matrix4(),Persistent:false},{Name:"Actor.IsActive",Type:b,DefaultValue:false,Persistent:false,BehaviorType:1},{Name:"Actor.Anchor.1",Type:j,DefaultValue:new j().SetValueFrame(new i().SetValueFromVector(new h.Vector3(0,0,0))).GetValue()},{Name:"Actor.Anchor.2",Type:j,DefaultValue:new j().SetValueFrame(new i().SetValueFromVector(new h.Vector3(0,0,0))).GetValue()},{Name:"Camera.Angle",Type:k,DefaultValue:45,GroupId:"Group.Camera"},{Name:"Camera.Height",Type:k,DefaultValue:400,GroupId:"Group.Camera",},{Name:"Camera.Ortho",Type:b,DefaultValue:false,GroupId:"Group.Camera"},{Name:"Camera.Arcball",Type:b,DefaultValue:true,GroupId:"Group.Camera"},{Name:"Camera.Pitch",Type:b,DefaultValue:true,GroupId:"Group.Camera",},{Name:"Camera.Roll",Type:b,DefaultValue:true,GroupId:"Group.Camera",},{Name:"Camera.Roll.Angle",Type:k,DefaultValue:0,GroupId:"Group.Camera",Bounds:{Min:-180,Max:180,Step:1},},{Name:"Camera.Yaw",Type:b,DefaultValue:true,GroupId:"Group.Camera",},{Name:"Camera.LockDistCOI",Type:b,DefaultValue:false,GroupId:"Group.Camera",},{Name:"Camera.DistCOI",Type:k,DefaultValue:500,GroupId:"Group.Camera",},{Name:"Collab.Gizmo.Show",Type:b,DefaultValue:true,ControlsGroupVisibility:true,GroupId:"Group.Collab.Gizmo"},{Name:"Collab.Gizmo.Line.Color",Type:l,DefaultValue:new m().FromRGBA(1,1,1,1),GroupId:"Group.Collab.Gizmo"},{Name:"Collab.Gizmo.Line.Color.Opacity",Type:k,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Collab.Gizmo"},{Name:"Collab.Gizmo.Line.Width",Type:k,DefaultValue:1,GroupId:"Group.Collab.Gizmo"},{Name:"Collab.ListAnchorsIDs",Type:f,DefaultValue:[1,2]}];this._BuildPropertyValues(n)},GetVirtualProperties:function(){var n={};n["Camera.Position"]=true;return n},GetRequiredPropertiesForTransition:function(){var n={};n["Camera.Position"]=true;n["Actor.Anchor.1"]=true;n["Actor.Anchor.2"]=true;n["Camera.Angle"]=true;n["Camera.Height"]=true;n["Camera.Ortho"]=true;n["Camera.Arcball"]=true;n["Camera.Pitch"]=true;n["Camera.Roll"]=true;n["Camera.Roll.Angle"]=true;n["Camera.Yaw"]=true;n["Camera.LockDistCOI"]=true;n["Camera.DistCOI"]=true;return n},GetProperty:function(p){if(p==="Actor.IsActive"){var o=null;var r=this._Properties[p];if(r!==undefined){var n=this._Properties[p].GetPropertyValue().Clone();var q=this.ExperienceBase.getManager("VCXContextManager").getActiveCamera();n.SetValue(q.GetID()===this.GetObject().GetID());o=new g(this._Properties[p].GetPropertyInfo(),n)}return o}else{return this._parent(p)}},OnChangeProperty:function(q,n,p){if(p){}else{p={}}if(p.fromChildClass){}else{if(this.OnChangePropertyBegin(q,n)){return true}}this._parent(q,n,p);var o=this.ExperienceBase.getManager("VCXVisuManager");if(q==="Actor.IsActive"){if(n.Value===true){this.ExperienceBase.getManager("VCXContextManager").setActiveCamera(this.GetObject())}}},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Collab.ListAnchorsIDs",true);this.SetPropertyInvisible("Camera.Position",true);this.SetPropertyInvisible("Actor.Interpolation.Type",false);this.SetPropertyInvisible("Camera.Angle",this.GetPropertyValue("Camera.Ortho"));this.SetPropertyInvisible("Camera.Height",!this.GetPropertyValue("Camera.Ortho"));this.SetPropertyInvisible("Camera.Pitch",this.GetPropertyValue("Camera.Arcball"));this.SetPropertyInvisible("Camera.Roll",this.GetPropertyValue("Camera.Arcball"));this.SetPropertyInvisible("Camera.Yaw",this.GetPropertyValue("Camera.Arcball"));this.SetPropertyInvisible("Camera.LockDistCOI",this.GetPropertyValue("Camera.Arcball"));this.SetPropertyInvisible("Camera.DistCOI",this.GetPropertyValue("Camera.Arcball")||!this.GetPropertyValue("Camera.LockDistCOI"));this.SetPropertyInvisible("Camera.Roll.Angle",this.GetPropertyValue("Camera.Arcball")||this.GetPropertyValue("Camera.Roll"))},OnChangePropertiesEnd:function(){this._parent();this.GetObject().updatePosition()},GetInterpolator:function(n){var o=this.QueryInterface("VCXIViewpointController");if(o){return o.GetInterpolator(n)}},});return c});define("DS/VCXWebDressup/VCXMarkupModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueDocId"],function(j,a,c,s,q,d,l,i,n,k,o,p,b,g,m,e,r,f){var h=s.extend({init:function(){this._bIsMarkup=true;this._parent()},Build:function(){this._parent();var t=[{Name:"Collab.Text.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:true,GroupId:"Group.Text"},{Name:"Collab.Text.Show",Type:n,DefaultValue:true,ControlsGroupVisibility:true,GroupId:"Group.Text"},{Name:"Collab.Text",Type:m,DefaultValue:""},{Name:"Collab.Text.Color",Type:g,DefaultValue:new l().FromRGBA(0,0,0,1),GroupId:"Group.Text"},{Name:"Collab.Text.Color.Opacity",Type:o,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Text"},{Name:"Collab.Text.Font",Type:b,GroupId:"Group.Text"},{Name:"Collab.Text.SizeToFit",Type:n,DefaultValue:false,GroupId:"Group.Text"},{Name:"Collab.Body.Shape",Type:p,DefaultValue:c.EBodyShape.RoundedRectangle,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(c.EBodyShape,"Collab.Body.Shape",["User","CircumscribedCircle"])},{Name:"Collab.Body.FitToText",Type:n,DefaultValue:true,GroupId:"Group.Body"},{Name:"Collab.Body.KeepAspectRatio",Type:n,DefaultValue:true,GroupId:"Group.Body"},{Name:"Collab.Body.Width",Type:o,DefaultValue:1,GroupId:"Group.Body"},{Name:"Collab.Body.Height",Type:o,DefaultValue:1,GroupId:"Group.Body"},{Name:"Collab.Body.HAlignment",Type:p,DefaultValue:c.EHAlignment.Left,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(c.EHAlignment,"Collab.Body.HAlignment")},{Name:"Collab.Body.VAlignment",Type:p,DefaultValue:c.EVAlignment.Top,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(c.EVAlignment,"Collab.Body.VAlignment")},{Name:"Collab.Body.ContributeToEqualSize",Type:n,DefaultValue:false,GroupId:"Group.Body"},{Name:"Collab.Body.InnerMargin",Type:o,DefaultValue:2,GroupId:"Group.Body"},{Name:"Collab.Background.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:true,GroupId:"Group.Background"},{Name:"Collab.Background.Show",Type:n,DefaultValue:true,ControlsGroupVisibility:true,GroupId:"Group.Background"},{Name:"Collab.Background.Color",Type:g,DefaultValue:new l().FromRGBA(1,1,1,1),GroupId:"Group.Background"},{Name:"Collab.Background.Color.Opacity",Type:o,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Background"},{Name:"Collab.Image.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:true,GroupId:"Group.Image"},{Name:"Collab.Image.Show",Type:n,DefaultValue:false,ControlsGroupVisibility:true,GroupId:"Group.Image"},{Name:"Collab.Image.Doc.ID",Type:f,DefaultValue:-1,GroupId:"Group.Image"},{Name:"Collab.Image.Color",Type:g,DefaultValue:new l().FromRGBA(1,1,1,1),GroupId:"Group.Image"},{Name:"Collab.Image.Color.Opacity",Type:o,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Image"},{Name:"Collab.Image.Scale",Type:o,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Image"},{Name:"Collab.Border.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:true,GroupId:"Group.Border"},{Name:"Collab.Border.Show",Type:n,DefaultValue:true,ControlsGroupVisibility:true,GroupId:"Group.Border"},{Name:"Collab.Border.Line.Width",Type:o,DefaultValue:2,GroupId:"Group.Border"},{Name:"Collab.Border.Line.Color",Type:g,DefaultValue:new l().FromRGBA(0,0,0,1),GroupId:"Group.Border"},{Name:"Collab.Border.Line.Color.Opacity",Type:o,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Border"},{Name:"Collab.Body.Shadow.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:true,GroupId:"Group.Shadow"},{Name:"Collab.Body.Shadow.Show",Type:n,DefaultValue:false,ControlsGroupVisibility:true,GroupId:"Group.Shadow"},{Name:"Collab.Body.Shadow.Opacity",Type:o,DefaultValue:0.55,GroupId:"Group.Shadow",Bounds:{Min:0,Max:1,Step:0.1}},{Name:"Collab.Body.Shadow.Distance",Type:o,DefaultValue:3,GroupId:"Group.Shadow",Bounds:{Min:0,Max:20,Step:0.1}},{Name:"Collab.Body.Shadow.Orientation",Type:o,DefaultValue:45,GroupId:"Group.Shadow",Bounds:{Min:0,Max:360,Step:0.1}},{Name:"Collab.Body.Shadow.Blur",Type:o,DefaultValue:12,GroupId:"Group.Shadow",Bounds:{Min:0,Max:20,Step:0.1}},{Name:"Collab.3D.Paper.Positioning.Type",Type:p,DefaultValue:c.EPositionType.Free3D,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(c.EPositionType,"Positioning.Type",["EndOfAutomaticPositionning"])},{Name:"Collab.3D.Paper.3D.Text.Position",Type:e,DefaultValue:new q.Vector3(),GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Size.Control.Type",Type:p,DefaultValue:c.ESizeControlType.Paper,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(c.ESizeControlType,"Size.Control.Type")},{Name:"Collab.3D.Paper.Scaling.Factor",Type:o,DefaultValue:1,GroupId:"Group.Body"},{Name:"Collab.3D.Paper.Paper.Position.X",Type:o,DefaultValue:0,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Paper.Position.Y",Type:o,DefaultValue:0,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Is.Background",Type:n,DefaultValue:false,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Depth",Type:o,DefaultValue:0,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Billboard.Type",Type:p,DefaultValue:c.EBillboardType.Spherical,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(c.EBillboardType,"Billboard.Type")},{Name:"Collab.3D.Paper.3D.Text.Radius",Type:o,DefaultValue:0,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.UsesBarycenter",Type:n,DefaultValue:false,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Referential.In.World",Type:n,DefaultValue:true,GroupId:"Group.Position"},{Name:"Collab.Attach.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:true,GroupId:"Group.Attach"},{Name:"Collab.Attach.Show",Type:n,DefaultValue:true,ControlsGroupVisibility:true,GroupId:"Group.Attach"},{Name:"Collab.Attach.3DAttach",Type:n,DefaultValue:true,GroupId:"Group.Attach"},{Name:"Collab.Attach.Preset",Type:p,DefaultValue:c.EAttachType.Line,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(c.EAttachType,"Collab.Attach.Type"),Persistent:false},{Name:"Collab.Attach.LeadType",Type:p,DefaultValue:c.ELeadType.Bent,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(c.ELeadType,"Collab.Attach.LeadType")},{Name:"Collab.Attach.ExtremityType",Type:p,DefaultValue:c.EExtremityType.Yellow,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(c.EExtremityType,"Collab.Attach.ExtremityType",["FullArrow_1","FullArrow_2","HalfArrow_B1","HalfArrow_T1","HalfArrow_T2","HalfArrow_B2"])},{Name:"Collab.Attach.BentDot",Type:n,DefaultValue:false,GroupId:"Group.Attach"},{Name:"Collab.Attach.Background.Gradient",Type:n,DefaultValue:false,GroupId:"Group.Attach"},{Name:"Collab.Attach.Border.Gradient",Type:n,DefaultValue:false,GroupId:"Group.Attach"},{Name:"Collab.Attach.Curvature",Type:o,DefaultValue:40,Bounds:{Min:-100,Max:100,Step:0.01},GroupId:"Group.Attach"},{Name:"Collab.Attach.Origin",Type:e,DefaultValue:new q.Vector3(),GroupId:"Group.Attach"},{Name:"Collab.Attach.Line.Color",Type:g,DefaultValue:new l().FromRGBA(0,0,0,1),GroupId:"Group.Attach"},{Name:"Collab.Attach.Line.Color.Opacity",Type:o,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Attach"},{Name:"Collab.Attach.Line.Width",Type:o,DefaultValue:2,GroupId:"Group.Attach"},{Name:"Collab.Attach.Line.Type",Type:p,DefaultValue:j.ELineType.Plain,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(j.ELineType,"Collab.DashType",["UserDefined","Advanced"])},{Name:"Collab.Attach.CenteredOrigin",Type:n,DefaultValue:true,GroupId:"Group.Attach"},{Name:"Collab.ListAnchorsIDs",Type:r,DefaultValue:[]},{Name:"Collab.List2DAnchorsIDs",Type:r,DefaultValue:[]}];this._BuildPropertyValues(t);this._Properties["Collab.Text.Font"].GetPropertyValue().SetFamily(new m("Arial"));this._Properties["Collab.Text.Font"].GetPropertyValue().SetHeight(new o(11))},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Actor.Color",false);this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=false;this.SetPropertyInvisible("Collab.3D.Paper.UsesBarycenter",true);this.SetPropertyInvisible("Collab.3D.Paper.Scaling.Factor",true);this.SetPropertyInvisible("Collab.Body.FitToText",!this.GetPropertyValue("Collab.Text.Show"));this.SetPropertyInvisible("Collab.Text.SizeToFit",!this.GetPropertyValue("Collab.Text.Show"));this.SetPropertyInvisible("Collab.Body.Width",this.GetPropertyValue("Collab.Body.FitToText")&&this.GetPropertyValue("Collab.Text.Show"));this.SetPropertyInvisible("Collab.Body.Height",(this.GetPropertyValue("Collab.Body.FitToText")&&this.GetPropertyValue("Collab.Text.Show"))||(this.GetPropertyValue("Collab.Body.KeepAspectRatio")&&this.GetPropertyValue("Collab.Image.Show")));this.SetPropertyInvisible("Collab.Background.Show",this.GetPropertyValue("Collab.Body.Shape")===c.EBodyShape.None);this.SetPropertyInvisible("Collab.Background.Color",!this.GetPropertyValue("Collab.Background.Show")||this.GetPropertyValue("Collab.Body.Shape")===c.EBodyShape.None);this.SetPropertyInvisible("Collab.Background.Color.Opacity",!this.GetPropertyValue("Collab.Background.Show")||this.GetPropertyValue("Collab.Body.Shape")===c.EBodyShape.None);this.SetPropertyInvisible("Actor.IsAlwaysOnTop",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=c.EPositionType.Free2D);var u=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=c.EPositionType.Free2D||(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===c.EPositionType.Free3D&&this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")!==c.EBillboardType.Spherical);this.SetPropertyInvisible("Collab.3D.Paper.Size.Control.Type",u);this.SetPropertyInvisible("Collab.3D.Paper.3D.Text.Position",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=c.EPositionType.Free2D);this.SetPropertyInvisible("Collab.3D.Paper.Billboard.Type",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=c.EPositionType.Free2D);this.SetPropertyInvisible("Collab.3D.Paper.Referential.In.World",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=c.EPositionType.Free2D);var t=(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")!==c.EPositionType.Free2D)&&(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")!==c.EPositionType.RelativeToReferential);this.SetPropertyInvisible("Collab.3D.Paper.Paper.Position.X",t);this.SetPropertyInvisible("Collab.3D.Paper.Paper.Position.Y",t);this.SetPropertyInvisible("Collab.3D.Paper.Depth",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")>c.EPositionType.Free2D);this.SetPropertyInvisible("Collab.3D.Paper.Is.Background",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")>c.EPositionType.Free2D);this.SetPropertyInvisible("Collab.Attach.CenteredOrigin",this.GetPropertyValue("Collab.Attach.LeadType")!==c.ELeadType.Mustache);this.SetPropertyInvisible("Collab.Attach.BentDot",this.GetPropertyValue("Collab.Attach.LeadType")!==c.ELeadType.Bent&&this.GetPropertyValue("Collab.Attach.LeadType")!==c.ELeadType.Line);this.SetPropertyInvisible("Collab.Attach.Origin",this.GetPropertyValue("Collab.Attach.CenteredOrigin")||this.GetPropertyValue("Collab.Attach.LeadType")===c.ELeadType.Mustache);this.SetPropertyInvisible("Collab.Attach.3DAttach",true);this.SetPropertyInvisible("Collab.Attach.Line.Type",this.GetPropertyValue("Collab.Attach.LeadType")===c.ELeadType.Mustache);this.SetPropertyInvisible("Collab.Attach.Curvature",this.GetPropertyValue("Collab.Attach.LeadType")!==c.ELeadType.Mustache);this.SetPropertyInvisible("Collab.Attach.Background.Gradient",this.GetPropertyValue("Collab.Attach.LeadType")!==c.ELeadType.Mustache);this.SetPropertyInvisible("Collab.Attach.Border.Gradient",this.GetPropertyValue("Collab.Attach.LeadType")!==c.ELeadType.Mustache);this.SetPropertyInvisible("Collab.Body.ContributeToEqualSize",true);this.SetPropertyInvisible("Collab.ListAnchorsIDs",true);this.SetPropertyInvisible("Collab.List2DAnchorsIDs",true)},GetProperty:function(w){var z,t;if(w==="Collab.3D.Paper.Paper.Position.X"){if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<c.EPositionType.EndOfAutomaticPositionning){z=this.QueryInterface("W3AISGNodeHolder");if(z){t=z.getSGNode();if(t&&t._Smart3DPaperNode){return this.GetNewProperty(w,t._Smart3DPaperNode.Position2D.x)}}}}else{if(w==="Collab.3D.Paper.Paper.Position.Y"){if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<c.EPositionType.EndOfAutomaticPositionning){z=this.QueryInterface("W3AISGNodeHolder");if(z){t=z.getSGNode();if(t&&t._Smart3DPaperNode){return this.GetNewProperty(w,t._Smart3DPaperNode.Position2D.y)}}}}else{if(w==="Collab.Attach.Preset"){for(var x in c.EAttachType){if(c.EAttachType.hasOwnProperty(x)){var u=h.GetAttachPresets(c.EAttachType[x]);var v=true;for(var y in u){if(u.hasOwnProperty(y)&&this.GetProperty(y)&&this.GetProperty(y).GetPropertyInfo().IsVisible()){if(u[y]!==this.GetPropertyValue(y)){v=false;break}}}if(v){return this.GetNewProperty(w,c.EAttachType[x])}}}}}}return this._parent(w)},RequestModification:function(v){if(v){if(v.GetPropertyInfo().GetPropertyName()==="Collab.Attach.Preset"){var A=new i();var x=h.GetAttachPresets(v.GetPropertyValue().Value);for(var u in x){if(x.hasOwnProperty(u)){A.AddOrModifyProperty(this.GetNewProperty(u,x[u]))}}return A}else{if(v.GetPropertyInfo().GetPropertyName()==="Actor.Color"){var A=new i();var t=v.GetPropertyValue().Value.getAssociatedColors();A.AddOrModifyProperty(this.GetNewProperty("Collab.Background.Color",t.body));A.AddOrModifyProperty(this.GetNewProperty("Collab.Text.Color",t.text));A.AddOrModifyProperty(this.GetNewProperty("Collab.Image.Color",t.image));A.AddOrModifyProperty(this.GetNewProperty("Collab.Border.Line.Color",t.border));A.AddOrModifyProperty(this.GetNewProperty("Collab.Attach.Line.Color",t.attach));return A}else{if(v.GetPropertyInfo().GetPropertyName()==="Collab.3D.Paper.Positioning.Type"){var A=this._parent(v);this.ExperienceBase.getManager("VCXDressupManager").alignmentDirty=2;var w=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();var C=this.ExperienceBase.getManager("VCXPaperManager");var E=this.QueryInterface("W3AISGNodeHolder");if(w&&C&&E){var D,F;if(v.GetPropertyValue().Value<=c.EPositionType.Free2D){var z=new q.Vector3().getPositionFromMatrix(E.getAnchorReferential());var B=C.ModelToMM2({viewer:w,viewpoint:w.currentViewpoint},z);D=E.getPositionInWCS(w,this.GetPropertyValue("Collab.3D.Paper.3D.Text.Position"));F=C.ModelToMM2({viewer:w,viewpoint:w.currentViewpoint},D);if(v.GetPropertyValue().Value===c.EPositionType.RelativeToReferential){F.x-=B.x;F.y-=B.y}A.AddOrModifyProperty(this.GetNewProperty("Collab.3D.Paper.Paper.Position.X",F.x));A.AddOrModifyProperty(this.GetNewProperty("Collab.3D.Paper.Paper.Position.Y",F.y));A.AddOrModifyProperty(this.GetNewProperty("Collab.3D.Paper.Billboard.Type",c.EBillboardType.Spherical));A.AddOrModifyProperty(this.GetNewProperty("Collab.3D.Paper.Size.Control.Type",c.ESizeControlType.Paper))}else{var y=E.getWorldMatrix(w);F=C.ModelToMM2({viewer:w,viewpoint:w.currentViewpoint},d.getOFromMatrix(y));F.x=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X");F.y=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y");D=C.MMToModel2({viewer:w,viewpoint:w.currentViewpoint},F);A.AddOrModifyProperty(this.GetNewProperty("Collab.3D.Paper.3D.Text.Position",E.getPositionInLCS(w,D)))}}return A}else{return this._parent(v)}}}}else{return new i()}}});h.GetAttachPresets=function(u){var t={};switch(u){case c.EAttachType.None:t["Collab.Attach.LeadType"]=c.ELeadType.None;t["Collab.Attach.ExtremityType"]=c.EExtremityType.None;t["Collab.Attach.Curvature"]=0;t["Collab.Attach.Background.Gradient"]=false;t["Collab.Attach.Border.Gradient"]=false;t["Collab.Attach.BentDot"]=false;break;case c.EAttachType.Model:t["Collab.Attach.LeadType"]=c.ELeadType.Bent;t["Collab.Attach.ExtremityType"]=c.EExtremityType.Yellow;t["Collab.Attach.Curvature"]=0;t["Collab.Attach.Background.Gradient"]=false;t["Collab.Attach.Border.Gradient"]=false;t["Collab.Attach.BentDot"]=false;break;case c.EAttachType.Vertex:t["Collab.Attach.LeadType"]=c.ELeadType.Bent;t["Collab.Attach.ExtremityType"]=c.EExtremityType.Red;t["Collab.Attach.Curvature"]=0;t["Collab.Attach.Background.Gradient"]=false;t["Collab.Attach.Border.Gradient"]=false;t["Collab.Attach.BentDot"]=false;break;case c.EAttachType.GradientTooltip:t["Collab.Attach.LeadType"]=c.ELeadType.Mustache;t["Collab.Attach.ExtremityType"]=c.EExtremityType.Red;t["Collab.Attach.Curvature"]=0;t["Collab.Attach.Background.Gradient"]=true;t["Collab.Attach.Border.Gradient"]=true;t["Collab.Attach.BentDot"]=false;break;case c.EAttachType.TooltipStyle:t["Collab.Attach.LeadType"]=c.ELeadType.Mustache;t["Collab.Attach.ExtremityType"]=c.EExtremityType.Red;t["Collab.Attach.Curvature"]=0;t["Collab.Attach.Background.Gradient"]=false;t["Collab.Attach.Border.Gradient"]=true;t["Collab.Attach.BentDot"]=false;break;case c.EAttachType.Line:t["Collab.Attach.LeadType"]=c.ELeadType.Bent;t["Collab.Attach.ExtremityType"]=c.EExtremityType.SmallRed;t["Collab.Attach.Curvature"]=0;t["Collab.Attach.Background.Gradient"]=false;t["Collab.Attach.Border.Gradient"]=false;t["Collab.Attach.BentDot"]=false;break;case c.EAttachType.User:t["Collab.Attach.LeadType"]=c.ELeadType.Bent;t["Collab.Attach.ExtremityType"]=c.EExtremityType.SmallRed;t["Collab.Attach.Curvature"]=0;t["Collab.Attach.Background.Gradient"]=false;t["Collab.Attach.Border.Gradient"]=false;t["Collab.Attach.BentDot"]=false;break;case c.EAttachType.Simple:t["Collab.Attach.LeadType"]=c.ELeadType.Middle;t["Collab.Attach.ExtremityType"]=c.EExtremityType.SmallRed;t["Collab.Attach.Curvature"]=0;t["Collab.Attach.Background.Gradient"]=false;t["Collab.Attach.Border.Gradient"]=false;t["Collab.Attach.BentDot"]=false;break;case c.EAttachType.ArcTooltip:t["Collab.Attach.LeadType"]=c.ELeadType.Mustache;t["Collab.Attach.ExtremityType"]=c.EExtremityType.Red;t["Collab.Attach.Curvature"]=40;t["Collab.Attach.Background.Gradient"]=false;t["Collab.Attach.Border.Gradient"]=false;t["Collab.Attach.BentDot"]=false;break;case c.EAttachType.Arrow:t["Collab.Attach.LeadType"]=c.ELeadType.Bent;t["Collab.Attach.ExtremityType"]=c.EExtremityType.FullArrow_1;t["Collab.Attach.Curvature"]=0;t["Collab.Attach.Background.Gradient"]=false;t["Collab.Attach.Border.Gradient"]=false;t["Collab.Attach.BentDot"]=false;break;case c.EAttachType.Modern:t["Collab.Attach.LeadType"]=c.ELeadType.Line;t["Collab.Attach.ExtremityType"]=c.EExtremityType.Line;t["Collab.Attach.Curvature"]=0;t["Collab.Attach.Background.Gradient"]=false;t["Collab.Attach.Border.Gradient"]=false;t["Collab.Attach.BentDot"]=true;break}return t};return h});define("DS/VCXWebDressup/VCXBOMModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebDressup/VCXComponentMarkup"],function(f,c,a,g,b,e,d){var h=c.extend({init:function(){this._bIsBOM=true;this._parent()},Build:function(){this._parent();var i=[{Name:"Collab.Text.Availability",DefaultValue:f.EAvailability.AppForceAvailable},{Name:"Collab.Attach.Availability",DefaultValue:f.EAvailability.AppForceNotAvailable},{Name:"Collab.Background.Availability",DefaultValue:f.EAvailability.AppForceNotAvailable},{Name:"Collab.Border.Availability",DefaultValue:f.EAvailability.AppForceNotAvailable},{Name:"Collab.Image.Availability",DefaultValue:f.EAvailability.AppForceNotAvailable},{Name:"Collab.Body.Shadow.Availability",DefaultValue:f.EAvailability.AppForceNotAvailable},{Name:"Collab.Body.FitToText",DefaultValue:false},{Name:"Collab.3D.Paper.Billboard.Type",Type:b,DefaultValue:d.EBillboardType.Spherical},{Name:"Collab.3D.Paper.Positioning.Type",Type:b,DefaultValue:d.EPositionType.Free2D},{Name:"Collab.BOM.FilterOnVisibleCallouts",Type:g,DefaultValue:true,GroupId:"Group.BOM"},{Name:"Collab.BOM.Header.Text.Color",Type:e,DefaultValue:new a().FromRGBA(0,0,0,1),GroupId:"Group.BOM",BehaviorType:1,NLSPath:"VCXWebDressup/VCXWebDressup"},{Name:"Collab.BOM.Header.Background.Color",Type:e,DefaultValue:new a().FromRGBA(240/255,240/255,1),GroupId:"Group.BOM",BehaviorType:1,NLSPath:"VCXWebDressup/VCXWebDressup"},{Name:"Collab.BOM.OddRow.Background.Color",Type:e,DefaultValue:new a().FromRGBA(1,1,1,1),GroupId:"Group.BOM",BehaviorType:1,NLSPath:"VCXWebDressup/VCXWebDressup"},{Name:"Collab.BOM.EvenRow.Background.Color",Type:e,DefaultValue:new a().FromRGBA(240/255,240/255,1,1),GroupId:"Group.BOM",BehaviorType:1,NLSPath:"VCXWebDressup/VCXWebDressup"},];this._BuildPropertyValues(i)},OnChangeProperty:function(k,i,j){if(j){}else{j={}}if(j.fromChildClass){}else{if(this.OnChangePropertyBegin(k,i)){return true}}if(k==="Collab.BOM.FilterOnVisibleCallouts"){this._resquestedFilterOnVisibleCallouts=i.Value}this._parent(k,i,j)},OnChangePropertiesEnd:function(){if(this._resquestedFilterOnVisibleCallouts!==this._filterOnVisibleCallouts){var i=this.ExperienceBase.getManager("VCXComponentBomManager");if(i){i.filterHasChanged=true}this._filterOnVisibleCallouts=this._resquestedFilterOnVisibleCallouts}this._parent()},});return h});define("DS/VCXWebDressup/VCXLabelModifiable",["DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebProperties/VCXColor"],function(c,e,d,a){var b=c.extend({init:function(){this._bIsLabel=true;this._parent()},Build:function(){this._parent();var f=[{Name:"Collab.Text.Availability",DefaultValue:e.EAvailability.AppForceAvailable},{Name:"Collab.Text",DefaultValue:"$(##Actor.Name)"},{Name:"Collab.Text.Color",DefaultValue:new a().FromRGBA(1,1,1,1)},{Name:"Collab.Background.Color",DefaultValue:new a().FromRGBA(0.0666666666666667,0.596078431372549,0.8980392156862745,1)},{Name:"Collab.Body.Shape",DefaultValue:d.EBodyShape.RoundedRectangle},{Name:"Collab.HideIfOutsideAnchorFrustrum",DefaultValue:true},{Name:"Collab.Body.HAlignment",DefaultValue:d.EHAlignment.Middle},{Name:"Collab.Body.VAlignment",DefaultValue:d.EVAlignment.Middle}];this._BuildPropertyValues(f);this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",false)},});return b});define("DS/VCXWebDressup/VCXCalloutModifiable",["DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebProperties/VCXColor",],function(b,d,c,a){var e=b.extend({init:function(){this._bIsCallout=true;this._parent()},Build:function(){this._parent();var f=[{Name:"Collab.Text.Availability",DefaultValue:d.EAvailability.AppForceAvailable},{Name:"Collab.Text",DefaultValue:"$(##Actor.BomId)"},{Name:"Collab.Text.Color",DefaultValue:new a().FromRGBA(0,0,0,1)},{Name:"Collab.Background.Color",DefaultValue:new a().FromRGBA(1,1,1,1)},{Name:"Collab.Body.Shape",DefaultValue:c.EBodyShape.Circle},{Name:"Collab.Body.HAlignment",DefaultValue:c.EHAlignment.Middle},{Name:"Collab.Body.VAlignment",DefaultValue:c.EVAlignment.Bottom},{Name:"Collab.HideIfOutsideAnchorFrustrum",DefaultValue:true},{Name:"Collab.Body.ContributeToEqualSize",DefaultValue:true}];this._BuildPropertyValues(f);this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",false)},});return e});define("DS/VCXWebDressup/VCXComponentPath",["DS/VCXWebDressup/VCXComponentDressup"],function(a){var b=a.extend({init:function(){this._parent();this.IsViewPointDependent=false;this.IsAnchorDependent=true},});b.EConstructMode={PathClassic:0,PathXYZWorld:1,PathXYZLocal:2};b.EAxesOrder={XYZ:0,XZY:1,YZX:2,YXZ:3,ZXY:4,ZYX:5};b.EAxesOrderArray={0:["x","y","z"],1:["x","z","y"],2:["y","z","x"],3:["y","x","z"],4:["z","x","y"],5:["z","y","x"]};Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentPath"}});b.prototype._dressupFamily="Paths";return b});define("DS/VCXWebDressup/VCXComponentAssociativePath",["DS/VCXWebDressup/VCXComponentPath"],function(b){var a=b.extend({init:function(){this._parent();this._IsDressupPropertiesChangeIndependent=true},});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentAssociativePath"}});return a});define("DS/VCXWebDressup/VCXExtremityNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXComponentMarkup","DS/Visualization/Node3D","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebVisualization/VCXInteractor","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory"],function(i,j,e,h,g,b,a,d,f){var c=i.extend({init:function(k){this._parent(k);this.anchorID=k.anchorID;this._Type=1;this._ArrowTail=true;if(k&&typeof k.type==="number"){this.Type=k.type}return this},_getExtremityNode:function(){var m="#00ff00";var q=1;switch(this.Type){case undefined:case j.EExtremityType.None:return null;break;case j.EExtremityType.Sphere:return f.createSphereNode({radius:1});break;case j.EExtremityType.FullArrow_1:case j.EExtremityType.FullArrow_2:case j.EExtremityType.HalfArrow_B1:case j.EExtremityType.HalfArrow_T1:case j.EExtremityType.HalfArrow_T2:case j.EExtremityType.HalfArrow_B2:var u=new d.PrimitiveGroup();u.editable=true;u.fillAttr=new d.FillAttributes();u.lineAttr=new d.LineAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor(),this.GetPropertyValue("Collab.Attach.Line.Width"));u.pointAttr=new d.PointAttributes();var o=new d.Buffer();o.size=3*3;o.component=d.VertexComponentEnum.POSITION;o.format=d.DataTypeEnum.FLOAT;o.dimension=3;o.data=new Float32Array(o.size);o.data[0]=0;o.data[1]=0;o.data[2]=0;o.data[3]=3.5;if(this.Type===4||this.Type===7){o.data[4]=0}else{o.data[4]=-1.5}o.data[5]=0;o.data[6]=3.5;if(this.Type===5||this.Type===6){o.data[7]=0}else{o.data[7]=1.5}o.data[8]=0;u.addBuffer(0,o);var p=new d.Buffer();p.indexBuffer=true;p.size=3;p.format=d.DataTypeEnum.UINT;p.dimension=1;p.data=new Uint16Array(p.size);var n=p.data;n[0]=0;n[1]=1;n[2]=2;u.addBuffer(1,p);var t=new d.Primitive();t.nbIndices=3*1;t.connectivity=d.ConnectivityTypeEnum.TRIANGLES;var r=new d.VertexComponent();r.component=d.VertexComponentEnum.POSITION;r.nbVertices=3;r.nbValuesPerVertex=3;r.format=d.DataTypeEnum.FLOAT;r.cardinality=0;r.bufferId=0;r.indices=new d.IndexArray();r.indices.bufferId=1;r.indices.format=d.DataTypeEnum.UINT;r.indices.offset=0;t.addVertexComponent(r);u.addPrimitive(t);var l=new e();l.add(f.createMeshNode(u));if(this._ArrowTail){var s={type:h.ELineType.Plain,lineWidth:this.GetPropertyValue("Collab.Attach.Line.Width"),color:this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor()};var v=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(s);var k=f.createLineNode({points:[new g.Vector3(0,0,0),new g.Vector3(7,0,0)],material:v});l.add(k)}this.RecursiveSetPickParent(true);l.traverse(function(w){if(w.setFrustumCulled){w.setFrustumCulled(false)}if(w.setShadow){w.setShadow(false,false)}if(w.setMirror){w.setMirror(false)}return false});this.handleLayers(true);return l;break;case j.EExtremityType.Yellow:case j.EExtremityType.Dot:case j.EExtremityType.Red:case j.EExtremityType.SmallRed:case j.EExtremityType.Line:switch(this.Type){case j.EExtremityType.Yellow:m="#ffff00";q=1;break;case j.EExtremityType.Dot:q=0.5;break;case j.EExtremityType.Red:m="#ff0000";q=1;break;case j.EExtremityType.SmallRed:m="#ff0000";q=0.5;break;case j.EExtremityType.Line:q=1;break}this._Material=new g.MeshBasicMaterial({side:g.DoubleSide,transparent:false,opacity:1,color:m,force:true,polygonOffset:true,polygonOffsetFactor:1,polygonOffsetUnits:-10});if(this.Type!==j.EExtremityType.Dot){this._Material.line=new g.LineBasicMaterial({side:g.DoubleSide,transparent:false,color:"#000000",opacity:1,force:true,polygonBorderMode:true,lineWidth:2,polygonOffset:true,polygonOffsetFactor:1,polygonOffsetUnits:-20})}var l=f.createCircleNode({radius:q,material:this._Material,fill:true});l.traverse(function(w){if(w.setFrustumCulled){w.setFrustumCulled(false)}if(w.setShadow){w.setShadow(false,false)}if(w.setMirror){w.setMirror(false)}return false});return l;break;default:console.warn("Extremity "+this.Type+" not defined")}},dispose:function(){if(this._Smart3DPaperNode){this._Smart3DPaperNode.dispose();this._Smart3DPaperNode=null}this._parent()},_Build:function(){var k={name:"AttachExtremitySmartNode",modifiable:this.Modifiable,type:this._type};this._Smart3DPaperNode=new b(k);if(this._referential){this._Smart3DPaperNode.SetReferential(this._referential)}this._Smart3DPaperNode.ModifiableProperties=false;this._Smart3DPaperNode.SizeControlType=1;this._Smart3DPaperNode.BillboardType=3;this.add(this._Smart3DPaperNode);this.RecursiveSetPickParent(true);this.handleLayers(true)},preRender:function(k){if(this._Smart3DPaperNode){this._Smart3DPaperNode.preRender(k)}},update:function(k){this._parent();if(this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var m=(this._globalOpacity>0);if(m){if(!this._Smart3DPaperNode){this._Build()}}this.setVisibility(m)}if(this._globalOpacity<=0){return}if(this._previousType!==this.Type){this._previousType=this.Type;if(this._Node){this._Smart3DPaperNode.remove(this._Node);this._Material=null;this._Node=null}}if(!this._Node&&this._Smart3DPaperNode){this._Node=this._getExtremityNode(0);if(this._Node){this._Node.traverse(function(n){if(n.setFrustumCulled){n.setFrustumCulled(false)}if(n.setShadow){n.setShadow(false,false)}if(n.setMirror){n.setMirror(false)}return false});this._Smart3DPaperNode.add(this._Node)}this._Smart3DPaperNode.update(k)}if(this._Node){var l=this.GetColorPropertyValue("Collab.Attach.Line");if(!this._Material){this._Material=new g.MeshBasicMaterial({transparent:true});this._Node.setMaterial(this._Material)}this._Material.opacity=l.a*this._globalOpacity;if(this.Type!==j.EExtremityType.Yellow&&this.Type!==j.EExtremityType.Red&&this.Type!==j.EExtremityType.SmallRed){this._Material.color=l.GetThreeColor()}if(this._Material.line){this._Material.line.opacity=this._Material.opacity}this._Material.force=true;this.handleLayers()}},SetReferential:function(k){this._referential=k.clone();if(this._Smart3DPaperNode){this._Smart3DPaperNode.Referential=this._referential}},GetReferential:function(k){if(this._Smart3DPaperNode){return this._Smart3DPaperNode.GetReferential(k)}return null}});Object.defineProperty(c.prototype,"Type",{enumerable:true,get:function(){return this._Type},set:function(k){this._Type=k}});return c});define("DS/VCXWebDressup/VCXArrowModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueVector"],function(i,j,e,l,g,d,a,b,h,k,f){var c=e.extend({init:function(){this._bIsArrow=true;this._parent()},Build:function(){this._parent();var m=[{Name:"Collab.Is.Paper",Type:a,DefaultValue:true,GroupId:"Group.Arrow"},{Name:"Arrow.Scale",Type:h,DefaultValue:1,GroupId:"Group.Arrow"},{Name:"Collab.Border.Show",Type:a,DefaultValue:true,ControlsGroupVisibility:true,GroupId:"Group.Border"},{Name:"Collab.Border.Line.Width",Type:h,DefaultValue:1,GroupId:"Group.Border"},{Name:"Collab.Border.Line.Type",Type:b,DefaultValue:i.ELineType.Plain,GroupId:"Group.Border",MapChoice:this._generateMapChoiceFromEnumAndId(i.ELineType,"Collab.DashType",["UserDefined","Advanced"])},{Name:"Arrow.Body.Color",Type:k,DefaultValue:new l().FromRGBA(0.9294117647058824,0.3176470588235294,0.3176470588235294,1),GroupId:"Group.Arrow.Head"},{Name:"Arrow.Body.Color.Opacity",Type:h,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Arrow.Head"},{Name:"Arrow.Width.1",Type:h,DefaultValue:5,GroupId:"Group.Arrow.Head"},{Name:"Arrow.Head.ShowMode",Type:a,DefaultValue:true,GroupId:"Group.Arrow.Head"},{Name:"Arrow.Head.Length",Type:h,DefaultValue:10,GroupId:"Group.Arrow.Head"},{Name:"Arrow.Head.Size",Type:h,DefaultValue:4,GroupId:"Group.Arrow.Head"},{Name:"Arrow.Head.Shape",Type:h,DefaultValue:0,GroupId:"Group.Arrow.Head"},{Name:"Collab.Border.Line.Color",Type:k,DefaultValue:new l().FromRGBA(0.6431372549019608,0.1686274509803922,0.1568627450980392,1),GroupId:"Group.Arrow.Head"},{Name:"Collab.Border.Line.Color.Opacity",Type:h,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Arrow.Head"},{Name:"Arrow.Body.2.Color",Type:k,DefaultValue:new l().FromRGBA(0.9294117647058824,0.3176470588235294,0.3176470588235294,0.5),GroupId:"Group.Arrow.Head.2"},{Name:"Arrow.Body.2.Color.Opacity",Type:h,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Arrow.Head.2"},{Name:"Arrow.Width.2",Type:h,DefaultValue:5,GroupId:"Group.Arrow.Head.2"},{Name:"Arrow.Head.2.ShowMode",Type:a,DefaultValue:false,GroupId:"Group.Arrow.Head.2"},{Name:"Arrow.Head.2.Length",Type:h,DefaultValue:10,GroupId:"Group.Arrow.Head.2"},{Name:"Arrow.Head.2.Size",Type:h,DefaultValue:4,GroupId:"Group.Arrow.Head.2"},{Name:"Arrow.Head.2.Shape",Type:h,DefaultValue:0,GroupId:"Group.Arrow.Head.2"},{Name:"Collab.Border.Line.2.Color",Type:k,DefaultValue:new l().FromRGBA(0.6431372549019608,0.1686274509803922,0.1568627450980392,1),GroupId:"Group.Arrow.Head.2"},{Name:"Collab.Border.Line.2.Color.Opacity",Type:h,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Arrow.Head.2"},{Name:"Collab.ListAnchorsIDs",Type:f,DefaultValue:[]}];this._BuildPropertyValues(m)},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Actor.Color",false);this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=false;this.SetPropertyInvisible("Arrow.Head.Length",this.GetPropertyValue("Arrow.Head.ShowMode")===false);this.SetPropertyInvisible("Arrow.Head.Size",this.GetPropertyValue("Arrow.Head.ShowMode")===false);this.SetPropertyInvisible("Arrow.Head.Shape",this.GetPropertyValue("Arrow.Head.ShowMode")===false);this.SetPropertyInvisible("Arrow.Head.2.Length",this.GetPropertyValue("Arrow.Head.2.ShowMode")===false);this.SetPropertyInvisible("Arrow.Head.2.Size",this.GetPropertyValue("Arrow.Head.2.ShowMode")===false);this.SetPropertyInvisible("Arrow.Head.2.Shape",this.GetPropertyValue("Arrow.Head.2.ShowMode")===false);this.SetPropertyInvisible("Arrow.Head.2.Shape",this.GetPropertyValue("Arrow.Head.2.ShowMode")===false);this.SetPropertyInvisible("Arrow.Head.2.Shape",this.GetPropertyValue("Arrow.Head.2.ShowMode")===false);this.SetPropertyInvisible("Collab.Border.Line.Color",this.GetPropertyValue("Collab.Border.Show")===false);this.SetPropertyInvisible("Collab.Border.Line.Color.Opacity",this.GetPropertyValue("Collab.Border.Show")===false);this.SetPropertyInvisible("Collab.Border.Line.2.Color",this.GetPropertyValue("Collab.Border.Show")===false);this.SetPropertyInvisible("Collab.Border.Line.2.Color.Opacity",this.GetPropertyValue("Collab.Border.Show")===false);this.SetPropertyInvisible("Collab.ListAnchorsIDs",true)},GetProperty:function(s){var q=null;if(s==="Actor.Color"){var p=this.GetColorPropertyValue("Arrow.Body");var n=this.GetColorPropertyValue("Arrow.Body.2");var r=this.GetColorPropertyValue("Collab.Border.Line");var o=this.GetColorPropertyValue("Collab.Border.Line.2");var m=this._Properties["Arrow.Body.Color"].GetPropertyValue().Clone();if(p&&p.IsEqualTo(n)&&r&&r.IsEqualTo(o)){m._bUndefined=false}else{m._bUndefined=true}q=new g(this._Properties[s].GetPropertyInfo(),m)}else{q=this._parent(s)}return q},RequestModification:function(o){if(o){if(o.GetPropertyInfo().GetPropertyName()==="Actor.Color"){var n=new d();var m=o.GetPropertyValue().Value.getAssociatedColors();n.AddOrModifyProperty(this.GetNewProperty("Arrow.Body.Color",m.body));n.AddOrModifyProperty(this.GetNewProperty("Arrow.Body.2.Color",m.body));n.AddOrModifyProperty(this.GetNewProperty("Collab.Border.Line.Color",m.border));n.AddOrModifyProperty(this.GetNewProperty("Collab.Border.Line.2.Color",m.border));return n}else{return this._parent(o)}}else{return new d()}}});return c});define("DS/VCXWebDressup/VCXArrowLinearModifiable",["DS/VCXWebDressup/VCXArrowModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector"],function(b,f,g,d,c,a,h){var e=b.extend({init:function(){this._parent()},Build:function(){this._parent();var i=[{Name:"Arrow.Fixed.Length",Type:g,DefaultValue:false,GroupId:"Group.Arrow"},{Name:"Arrow.Length",Type:d,DefaultValue:20,GroupId:"Group.Arrow"},{Name:"Actor.Anchor.0",Type:a,DefaultValue:new a().SetValueFrame(new c().SetValueFromVector(new f.Vector3(0,0,0))).GetValue(),GroupId:"Group.Arrow.Head"},{Name:"Actor.Anchor.1",Type:a,DefaultValue:new a().SetValueFrame(new c().SetValueFromVector(new f.Vector3(1,1,1))).GetValue(),GroupId:"Group.Arrow.Head.2"},{Name:"Arrow.Head.2.Position.Is.Paper",Type:g,DefaultValue:false,GroupId:"Group.Arrow.Head.2"},{Name:"Arrow.Head.2.Position.X",Type:d,DefaultValue:0,GroupId:"Group.Arrow.Head.2"},{Name:"Arrow.Head.2.Position.Y",Type:d,DefaultValue:0,GroupId:"Group.Arrow.Head.2"},{Name:"Collab.ListAnchorsIDs",Type:h,DefaultValue:[0,1]}];this._BuildPropertyValues(i)},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Arrow.Length",!this.GetPropertyValue("Arrow.Fixed.Length"));this.SetPropertyInvisible("Arrow.Head.2.Position.X",!this.GetPropertyValue("Arrow.Head.2.Position.Is.Paper"));this.SetPropertyInvisible("Arrow.Head.2.Position.Y",!this.GetPropertyValue("Arrow.Head.2.Position.Is.Paper"))}});return e});define("DS/VCXWebDressup/VCXArrowCornerModifiable",["DS/VCXWebDressup/VCXArrowModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector"],function(b,e,d,c,a,g){var f=b.extend({init:function(){this._parent();this._handleAnchor=null},Build:function(){this._parent();var h=[{Name:"Arrow.Corner.Length.1",Type:d,DefaultValue:50,GroupId:"Group.Arrow",},{Name:"Arrow.Corner.Length.2",Type:d,DefaultValue:50,GroupId:"Group.Arrow",},{Name:"Actor.Anchor.0",Type:a,DefaultValue:new a().SetValueFrame(new c().SetValueFromVector(new e.Vector3(0,0,0))).GetValue(),GroupId:"Group.Arrow"},{Name:"Collab.ListAnchorsIDs",Type:g,DefaultValue:[0]}];this._BuildPropertyValues(h)}});return f});define("DS/VCXWebDressup/VCXManipulableDressup",["DS/CoreEvents/Events","DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXAManipulable","DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueFrame","DS/Visualization/ThreeJS_DS"],function(b,d,a,k,j,h,i,e,g,f){var c=a.extend({interact:function(r){if(!r){return}this._parent(r);var l=r&&r.manipulator&&r.manipulator.interactor;var m=l&&l.data&&typeof l.data.anchorID!=="undefined";if(!m){return}if(r.eventChannel&&r.eventChannel.indexOf("Manipulate")>-1){var u;var t;var p;if(l.data.is2DAnchor){u="Anchor2D";t=this.GetObject()._experienceBase.getManager("VCXPaperManager");if(!t){return}var n=this.GetObject()._experienceBase.getManager("VCXContextManager");var s=n.getMainViewer();p={viewer:s,viewpoint:s.currentViewpoint}}else{u="Anchor3D"}var o=r.eventChannel.replace("Manipulate","Manip");var q=o.charAt(0).toLowerCase()+o.slice(1)+u;this[q]&&this[q](r,t,p)}},beginManipAnchor2D:function(o,r,q){var m=o&&o.manipulator&&o.manipulator.interactor;var p=this.QueryInterface("W3AISGNodeHolder");p&&p.giveSGNode().setPickable(d.NODRAWHL);var s="Actor.Anchor."+m.data.anchorID;var u=this.QueryInterface("VCXIModifiable");if(u.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===j.EPositionType.Free3D){console.warn("Something's wrong, we shouldn't have an anchor2D on a Free3D-positioned panel..");return}var l=u.GetProperty(s).GetPropertyValue().Clone();var n=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(l.GetValueLink());if(!n){console.log("Shouldn't be available.. 2D anchors always have a link on a 2D panel..");return}var t=this._getShapeInfoFromComponent(n);if(!t){console.warn("No shapeInfo has been found for the dressup manipulated..");return}this._initManipInfos={smartNodePos2D:t.smartNode.Position2D.clone(),smartNodeSize:t.size.clone()}},manipAnchor2D:function(o,r,q){var l=o&&o.manipulator&&o.manipulator.interactor;if(!this._initManipInfos||!l){return}var t=this.QueryInterface("VCXIModifiable");if(!(t&&typeof l.data.anchorID!=="undefined")){return}var s="Actor.Anchor."+l.data.anchorID;var n=t.GetProperty(s);var m=this._getMovedAnchor2DProperty(r,q,l.requestedMatrix,this._initManipInfos.smartNodePos2D,this._initManipInfos.smartNodeSize,n);var p=l.requestedPropertySet||new e();p.AddOrModifyProperty(m);l.requestedPropertySet=p},endManipAnchor2D:function(q,v,u){var o=q&&q.manipulator&&q.manipulator.interactor;if(!this._initManipInfos||!o){return}if(q.intersection.path[0]){var t=k.GetComponentToAttachTo(this.GetObject(),q.intersection.path[0]);var n=t.QueryInterface("VCXIModifiable");if(t.IsKindOf("VCXComponentMarkup")&&n.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===j.EPositionType.Free2D){var z=this.QueryInterface("VCXIModifiable");var w="Actor.Anchor."+o.data.anchorID;var p=z.GetProperty(w);p.GetPropertyValue().SetValueLinkFromComponent(t);var y=this._getShapeInfoFromComponent(t);if(!y){return}var x=y.smartNode.Position2D.clone();var l=y.size.clone();var m=this._getMovedAnchor2DProperty(v,u,o.requestedMatrix,x,l,p);if(m){var r=o.requestedPropertySet||new e();r.AddOrModifyProperty(m);o.requestedPropertySet=r}}}var s=this.QueryInterface("W3AISGNodeHolder");if(s){this._initManipInfos=null;s.giveSGNode().setPickable(d.PICKABLE)}},_getShapeInfoFromComponent:function(m){var l=m.QueryInterface("W3AISGNodeHolder");var n=l&&l.getSGNode();var o=n&&n.GetShapeInfo();if(!o){return}if(o.size.x===0||o.size.y===0){return}return o},_getMovedAnchor2DProperty:function(u,t,n,s,q,o){var p=new f.Vector3().getPositionFromMatrix(n);var m=u.ModelToMM2(t,p);var r=new f.Vector3((m.x-s.x)/(q.x),(m.y-s.y)/(q.y),0);var v=new g().SetValueFromVector(r);var l=o.Clone();l.GetPropertyValue().SetValueFrame(v);return l},beginManipAnchor3D:function(l){var m=this.QueryInterface("W3AISGNodeHolder");if(m){m.giveSGNode().setPickable(d.NODRAWHL)}},manipAnchor3D:function(t){var o=t&&t.manipulator&&t.manipulator.interactor;var A=this.QueryInterface("VCXIModifiable");if(!(A&&o&&typeof o.data.anchorID!=="undefined")){return}var v=this.GetObject()._experienceBase;var l;var y="Actor.Anchor."+o.data.anchorID;var p=A.GetProperty(y).Clone();var s=p.GetPropertyValue().GetValueLink();var r=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(s);if(!r){r=this.GetObject().getWorkingRootComponent()}var x=t.intersection.path&&t.intersection.path[0];var w=k.GetComponentToAttachTo(this.GetObject(),x);if(x){var n=w.QueryInterface("VCXIModifiable");if(r!==w&&(w.IsKindOf("VCXComponentOccurrenceExt")||(w.IsKindOf("VCXComponentMarkup")&&n.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===j.EPositionType.Free3D&&n.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")===0))){l=k.BuildNewPropertyValueAnchor(o.requestedMatrix,this.GetObject(),x)}else{var z=r.QueryInterface("W3AISGNodeHolder");var m=z.getMatrixInLCS(this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer(),o.requestedMatrix);var q=p.GetPropertyValue().GetValueFrame();q.Value=m;l=p.GetPropertyValue();l.SetValueFrame(q)}}else{if(r!==w){l=k.BuildNewPropertyValueAnchor(o.requestedMatrix,this.GetObject(),x)}else{var z=r.QueryInterface("W3AISGNodeHolder");var m=z.getMatrixInLCS(this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer(),o.requestedMatrix);var q=p.GetPropertyValue().GetValueFrame();q.Value=m;l=p.GetPropertyValue();l.SetValueFrame(q)}}var y="Actor.Anchor."+o.data.anchorID;var p=A.GetProperty(y).Clone();p.SetPropertyValue(l);var u=o.requestedPropertySet||new e();u.AddOrModifyProperty(p);o.requestedPropertySet=u},endManipAnchor3D:function(l){var m=this.QueryInterface("W3AISGNodeHolder");if(m){m.giveSGNode().setPickable(d.PICKABLE)}},});return c});define("DS/VCXWebDressup/VCXManipulablePanel",["DS/CoreEvents/Events","DS/Mesh/MeshUtils","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebDressup/VCXManipulableDressup","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertySet","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXComponentMarkup"],function(b,d,k,n,c,j,a,l,f,g,h,i,m){var e=c.extend({_init:function(){this._dashedOutline=null},interact:function(s){this._parent(s);if(s.eventChannel&&s.eventChannel.indexOf("Manipulate")>-1){var r=s.manipulator&&s.manipulator.interactor&&s.manipulator.interactor.id;if(!r){return}var u;var t=s.eventChannel.replace("Manipulate","Manip");t=t.charAt(0).toLowerCase()+t.slice(1);if(r.includes("Resize")){var o=this.QueryInterface("VCXIModifiable");var p=o.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===m.EPositionType.Free3D;var q=p?"3D":"2D";u=t+q+"ResizePanel"}else{if(r==="Interactor Attach Origin"){u=t+"AttachOrigin"}else{u=t+r}}this[u]&&this[u](s)}},beginManipAttachOrigin:function(q){var o=this.QueryInterface("VCXIModifiable");var p=o&&o.GetPropertyValue("Collab.Attach.Origin");if(p){this._initAttachOrigin=p}},manipAttachOrigin:function(s){var o=s.manipulator&&s.manipulator.interactor;if(!o){return}var y=this.QueryInterface("VCXIModifiable");if(y){var u=this.GetObject()._experienceBase.getManager("VCXPaperManager");var q={viewer:s.viewer,viewpoint:s.viewer.currentViewpoint};var r=u.MMToModel2(q,this._initAttachOrigin);var p=r.add(s.translationVector);var w=u.ModelToMM2(q,p);var t=o.requestedPropertySet||new g();var x=y.GetProperty("Collab.Attach.Origin").Clone();var v=x.GetPropertyValue();v.SetValue(w);t.AddOrModifyProperty(x);o.requestedPropertySet=t}},endManipAttachOrigin:function(o){this._initAttachOrigin=null},beginManip2DResizePanel:function(t){var w=this.GetObject()._experienceBase;if(w.getManager("VCXGUIManager")._isPlayingGoTo){this.initDressupManipInfo={doNotManipulate:true};return}var s=t.manipulator&&t.manipulator.interactor&&t.manipulator.interactor.id;var u=s.replace("Resize ","");var x=this.QueryInterface("W3AISGNodeHolder");var D=x.giveSGNode();if(!D){console.warn("Can't find a scenegraph node to resize...");return}var q=D.GetShapeInfo();var A=w.getManager("VCXPaperManager");var r={viewer:t.viewer,viewpoint:t.viewer.currentViewpoint};var v=q.centerInPaper.clone();var p=A.MMToModel2(r,v);var z=q.size.x;var y=q.size.y;var B=A.MMToPixel(y);var C=A.MMToPixel(z);this.initDressupManipInfo={resizeType:u,height:{mm:y,px:B},width:{mm:z,px:C},center:{mm:v,px:p}};var E=this.QueryInterface("VCXIModifiable");if(this.bIsAttachOriginInitiated()){this.initDressupManipInfo.attachOrigin=E.GetPropertyValue("Collab.Attach.Origin")}if(E.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===m.EPositionType.RelativeToReferential){var o=new i.Vector3().getPositionFromMatrix(x.getWorldMatrix());if(!o){return}this.initDressupManipInfo.rel2D3D={x:E.GetPropertyValue("Collab.3D.Paper.Paper.Position.X",true),y:E.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y",true),radius:E.GetPropertyValue("Collab.3D.Paper.3D.Text.Radius",true),referentialPos:o,referentialPosMM:A.ModelToMM2(r,o)}}},manip2DResizePanel:function(r){var p=r.manipulator&&r.manipulator.interactor;if(!this.initDressupManipInfo||this.initDressupManipInfo.doNotManipulate||!r||!p){return}var s=this._getNewDimsConsideringData(this.initDressupManipInfo,r);var o=this._setNewDimensionsPropSet(this.QueryInterface("VCXIModifiable"),s.center.x,s.center.y,s.width,s.height);if(this.initDressupManipInfo.attachOrigin){var q=this.updateAttachOriginInResize(r,this.initDressupManipInfo,s);q&&o.AddOrModifyProperty(q)}p.requestedPropertySet=o},endManip2DResizePanel:function(t){var r=t.manipulator&&t.manipulator.interactor;if(!this.initDressupManipInfo||this.initDressupManipInfo.doNotManipulate||!t||!r){return}var o=this.GetObject()._experienceBase;var q=this.QueryInterface("VCXIModifiable");var u=this._getNewDimsConsideringData(this.initDressupManipInfo,t);var q=this.QueryInterface("VCXIModifiable");var p=this._setNewDimensionsPropSet(q,u.center.x,u.center.y,u.width,u.height);if(this.initDressupManipInfo.attachOrigin){var s=this.updateAttachOriginInResize(t,this.initDressupManipInfo,u);s&&p.AddOrModifyProperty(s)}r.requestedPropertySet=p;this.initDressupManipInfo=null},beginManip3DResizePanel:function(r){var v=this.GetObject()._experienceBase;if(v.getManager("VCXGUIManager")._isPlayingGoTo){this.initDressupManipInfo={doNotManipulate:true};return}var A=this.QueryInterface("VCXIModifiable");var q=r.manipulator&&r.manipulator.interactor&&r.manipulator.interactor.id;var s=q.replace("Resize ","");var o=Object.keys(A._Anchors)[0];var t=A.GetAnchorWorldMatrix(o);var A=this.QueryInterface("VCXIModifiable");var u=A.GetProperty("Collab.Body.Width");var p=u.GetPropertyValue().GetValue();var w=A.GetProperty("Collab.Body.Height");var z=w.GetPropertyValue().GetValue();var y=this.QueryInterface("W3AISGNodeHolder").giveSGNode();var x=y.GetShapeInfo();this._initDressupManipInfo={resizeType:s,anchorWorldMatrix:t,height:x.size.y,width:x.size.x,keepAspectRatio:x.keepAspectRatio}},manip3DResizePanel:function(r){var q=r.manipulator&&r.manipulator.interactor;if(!q||!this._initDressupManipInfo){return}var s=this._getNewDims3DConsideringData(this._initDressupManipInfo,r);var p=this.QueryInterface("VCXIModifiable");var o=this._setNewDimensionsPropSet3D(p,s.anchorMatrix,s.width,s.height);this._lastPropSet=o;q.requestedPropertySet=o},endManip3DResizePanel:function(p){var o=p.manipulator&&p.manipulator.interactor;if(!o||!this._initDressupManipInfo){return}o.requestedPropertySet=this._lastPropSet;this._lastPropSet=null;this._initialManipulatorPosition=null},beginManipBillboardedPanel:function(s){if(s.position){this._initialManipulatorPosition=s.position}var v=this.GetObject()._experienceBase.getManager("VCXPaperManager");var r={viewer:s.viewer,viewpoint:s.viewer.currentViewpoint};var p=v.GetPaperRatio(r,this._initialManipulatorPosition);var w=this.QueryInterface("VCXIModifiable");var o=new i.Vector2(w.GetPropertyValue("Collab.3D.Paper.Paper.Position.X",true),w.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y",true)).length();var t=o*p;var q=w.GetPropertyValue("Collab.3D.Paper.3D.Text.Radius",true);this._initialLengthScale=1;if(q>0){this._initialLengthScale=t/q}var u=w&&w.GetPropertyValue("Collab.Attach.Origin");if(u){this._initAttachOrigin=u}},manipBillboardedPanel:function(U){var B=U.manipulator&&U.manipulator.interactor;if(!this._initialManipulatorPosition||!U||!B){return}var K=B.requestedPropertySet||new g();var F=this.QueryInterface("VCXIModifiable");if(!F||F.GetPropertyValue("Collab.3D.Paper.Billboard.Type")===0){return}var v=F.GetPropertyValue("Collab.3D.Paper.Positioning.Type");var H=this._initialManipulatorPosition.clone();if(U.translationVector){H=H.add(U.translationVector)}if(v<=m.EPositionType.Free2D){var Q=this.GetObject()._experienceBase.getManager("VCXPaperManager");var z={viewer:U.viewer,viewpoint:U.viewer.currentViewpoint};if(!this._deltaBetweenModifAndManipulatorPositions){var M=F.GetPropertyValue("Collab.3D.Paper.Paper.Position.X",true)/this._initialLengthScale;var L=F.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y",true)/this._initialLengthScale;var T=Q.ModelToMM2(z,this._initialManipulatorPosition);this._deltaBetweenModifAndManipulatorPositions=new i.Vector2(T.x-M,T.y-L)}var A=Q.ModelToMM2(z,H);var G=new l(A.x-this._deltaBetweenModifAndManipulatorPositions.x);var E=new l(A.y-this._deltaBetweenModifAndManipulatorPositions.y);var w=F.GetProperty("Collab.3D.Paper.Paper.Position.X").Clone();var O=F.GetProperty("Collab.3D.Paper.Paper.Position.Y").Clone();w.SetPropertyValue(G);O.SetPropertyValue(E);K.AddOrModifyProperty(w);K.AddOrModifyProperty(O);if(this._initialLengthScale!==1){var C=new i.Vector2(G.Value,E.Value).length();var P=C*Q.GetPaperRatio(z,this._initialManipulatorPosition);var r=F.GetProperty("Collab.3D.Paper.3D.Text.Radius").Clone();r.SetPropertyValue(new l(P));K.AddOrModifyProperty(r)}if(this.bIsAttachOriginInitiated()){var S=F.GetProperty("Collab.Attach.Origin");var D=Q.MMToModel2(z,this._initAttachOrigin);var N=D.add(U.translationVector);var u=Q.ModelToMM2(z,N);var y=S.Clone();y.SetPropertyValue(new f(u));K.AddOrModifyProperty(y)}if(v<=m.EPositionType.Free2D&&v!==m.EPositionType.RelativeToReferential){var t=new a(m.EPositionType.Free2D);var J=F.GetProperty("Collab.3D.Paper.Positioning.Type").Clone();J.SetPropertyValue(t);K.AddOrModifyProperty(J)}}else{var I=F.QueryInterface("W3AISGNodeHolder");if(!this._deltaBetweenModifAndManipulatorPositions){var q=F.GetPropertyValue("Collab.3D.Paper.3D.Text.Position");var p=I.getPositionInWCS(U.viewer,q);this._deltaBetweenModifAndManipulatorPositions=new i.Vector3().subVectors(this._initialManipulatorPosition,p)}H.sub(this._deltaBetweenModifAndManipulatorPositions);var R=I.getPositionInLCS(U.viewer,H);var x=new f(R);var s=F.GetProperty("Collab.3D.Paper.3D.Text.Position").Clone();var o=s.SetPropertyValue(x);K.AddOrModifyProperty(s)}B.requestedPropertySet=K;this._lastPropSet=K},endManipBillboardedPanel:function(p){var o=p.manipulator&&p.manipulator.interactor;if(!this._initialManipulatorPosition||!p||!o){return}o.requestedPropertySet=this._lastPropSet;this._lastPropSet=null;this._initialManipulatorPosition=null;this._deltaBetweenModifAndManipulatorPositions=null;this._initAttachOrigin=null},beginManip3DPanel:function(t){var p=t.manipulator&&t.manipulator.interactor;if(!t.intersection.position||!p){return}var x=p.requestedPropertySet||new g();var C=this.QueryInterface("VCXIModifiable");if(!C){return}var w=new i.Vector3();var r=C.GetPropertyValue("Collab.3D.Paper.3D.Text.Position");if(!r.equals(w)){var B=new f(w);var s=C.GetProperty("Collab.3D.Paper.3D.Text.Position").Clone();s.SetPropertyValue(B);x.AddOrModifyProperty(s)}var z=this.QueryInterface("W3AISGNodeHolder");var v=z&&z.getAnchorReferential();var o=Object.keys(C._Anchors)[0];var u=C.GetProperty("Actor.Anchor."+o).GetPropertyValue();this._initialManipulatorPosition=t.intersection.position;var y=n.getWorldMatrix(u,this.GetObject());var A=new i.Matrix4().getInverse(y);var q=this._initialManipulatorPosition.clone().applyMatrix4(A).negate();this._offsetTranslMat=new i.Matrix4().setPosition(q);this._anchorRollRotMat=new i.Matrix4().makeRotationZ(this._getRollAngle(v));var z=this.QueryInterface("W3AISGNodeHolder");z&&z.getSGNode().setPickable(d.NODRAWHL);this._lastPropSet=x;p.requestedPropertySet=this._lastPropSet},manip3DPanel:function(u){var q=u.manipulator&&u.manipulator.interactor;if(!q||!this._initialManipulatorPosition||!this._offsetTranslMat||!this._anchorRollRotMat||!u){return}var A=this.QueryInterface("VCXIModifiable");if(!A||A.GetPropertyValue("Collab.3D.Paper.Billboard.Type")!==m.EBillboardType.None){return}if(A.GetPropertyValue("Collab.3D.Paper.Positioning.Type")>m.EPositionType.Free2D){var w=j.getVzFromMatrix(q.requestedMatrix);var v=new i.Vector3().getPositionFromMatrix(q.requestedMatrix);var t=j.getMatrixFromOVz(new i.Vector3(0,0,0),w);var r=new i.Matrix4().setPosition(v);var z=r.multiply(t).multiply(this._offsetTranslMat);var y=u.intersection&&u.intersection.path&&u.intersection.path[0];var p=n.BuildNewPropertyValueAnchor(z,this.GetObject(),y);var o=Object.keys(A._Anchors)[0];var s=A.GetProperty("Actor.Anchor."+o).Clone();s.SetPropertyValue(p);var x=q.requestedPropertySet||new g();x.AddOrModifyProperty(s);this._lastPropSet=x;q.requestedPropertySet=this._lastPropSet}else{}},endManip3DPanel:function(p){var o=p.manipulator&&p.manipulator.interactor;if(!o){return}o.requestedPropertySet=this._lastPropSet;this._lastPropSet=null;this._deltaBetweenInitFrameAndPickPositions=null;this._initialManipulatorPosition=null;this._offsetTranslMat=null;this._anchorRollRotMat=null;var q=this.QueryInterface("W3AISGNodeHolder");q&&q.getSGNode().setPickable(d.PICKABLE);this._dressupNode=null;b.publish({event:"VCX_PROPERTIES_CHANGED"})},_getRollAngle:function(u){var q=j.getVzFromMatrix(u);var o=j.getOFromMatrix(u);var r=j.getMatrixFromOVz(o,q);var p=j.getVxFromMatrix(u);var t=j.getVxFromMatrix(r);var s=t.angleTo(p);return s},_getNewDimsConsideringData:function(ad,af){var ab=this.GetObject()._experienceBase.getManager("VCXPaperManager");var W={viewer:af.viewer,viewpoint:af.viewer.currentViewpoint};var r=ab.ModelToMM2(W,af.manipulator.initial3dIntersectionPoint);var u=ab.ModelToMM2(W,new i.Vector3().getPositionFromMatrix(af.manipulator.interactor.requestedMatrix));var K=new i.Vector2().subVectors(u,r);var t=this.QueryInterface("VCXIModifiable");var H;var z;var v=ad.resizeType;var E=t.GetPropertyValue("Collab.3D.Paper.Positioning.Type");var Z=E===m.EPositionType.RelativeToReferential;var p;if(Z){var U=t.GetPropertyValue("Collab.3D.Paper.Paper.Position.X");var T=t.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y");var M=t.GetPropertyValue("Collab.3D.Paper.3D.Text.Radius");var ag=ab.GetPaperRatio(W,this.initDressupManipInfo.rel2D3D.referentialPos);var D=this.initDressupManipInfo.rel2D3D.radius/ag;p=new i.Vector2(this.initDressupManipInfo.rel2D3D.x,this.initDressupManipInfo.rel2D3D.y).normalize().multiplyScalar(D)}else{p=ad.center.mm}var L=new i.Vector2(p.x+K.x/2,p.y+K.y/2);var ae=v.includes("Left");var J=v.includes("Right");var ac=v.includes("Top");var s=v.includes("Bottom");var R=this.QueryInterface("W3AISGNodeHolder").giveSGNode();var G=R.GetShapeInfo();if(!G.keepAspectRatio){var y=ad.center.mm.x;var x=ad.center.mm.y;var N=ae?-1:(J?+1:0);var Q=ac?-1:(s?+1:0);if(N!==0){H=Math.abs(ad.width.mm+N*K.x);y+=K.x/2}if(Q!==0){z=Math.abs(ad.height.mm+Q*K.y);x+=K.y/2}var P=new i.Vector2(y,x)}else{var w=t.GetProperty("Collab.Body.Width").GetPropertyValue().Clone();var o=w.GetValue();var C=ad.width.mm;var q;var V;var X;var R=this.QueryInterface("W3AISGNodeHolder").giveSGNode();X=G.size.x/G.size.y;if(!X){console.warn("A ratio should have been determined for now...");return}q=o/X;V=C/X;var Y=new i.Vector2().copy(ad.center.mm);Y.x+=ae?C/2:-C/2;Y.y+=ac?V/2:-V/2;var I=new i.Vector2().subVectors(u,Y);var aa=Math.abs(I.x/I.y);var B=1;if(aa>X){B=Math.abs(I.x/C)}else{B=Math.abs(I.y/V)}var H=B*C;var z=B*V;var S=new i.Vector2();S.setX(I.x<0?-H:H);S.setY(I.y<0?-z:z);var P=new i.Vector2().addVectors(Y,S.clone().multiplyScalar(0.5));if(E===m.EPositionType.RelativeToReferential){var F=this.initDressupManipInfo.rel2D3D.referentialPosMM;P.set(P.x-F.x,P.y-F.y);var A=P.length();var O=Math.min(ab.Size.x,ab.Size.y);if(A<O*0.04){A=O*0.04}else{if(A>O*0.7){A=O*0.7}}P.normalize().multiplyScalar(A)}}return{center:P,width:H,height:z}},_setNewDimensionsPropSetRelTo3D:function(E,v,u,D,B){if(!this.initDressupManipInfo.rel2D3D){return}var G=new g();var H,F;if(v||u){if(v){switch(E.GetPropertyValue("Collab.Body.HAlignment")){case m.EHAlignment.Middle:H=v;break;case m.EHAlignment.Right:H=v+D/2;break;case m.EHAlignment.Left:default:H=v-D/2;break}}if(u){switch(E.GetPropertyValue("Collab.Body.VAlignment")){case m.EVAlignment.Middle:F=u;break;case m.EVAlignment.Bottom:F=u+B/2;break;case m.EVAlignment.Top:default:F=u-B/2;break}}}var K=E.GetPropertyValue("Collab.3D.Paper.Paper.Position.X");var I=E.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y");var y=this.GetObject()._experienceBase;var A=y.getManager("VCXContextManager");var o=A.getMainViewer();var O=y.getManager("VCXPaperManager");var s={viewer:o,viewpoint:o.currentViewpoint};var w=this.initDressupManipInfo.rel2D3D.referentialPos;if(!w){return}var L=new i.Vector2(H?H:K,F?F:I);var z=L.length();var r=z*O.GetPaperRatio(s,w);var N=E.GetProperty("Collab.3D.Paper.Paper.Position.X");if(N){var q=N.Clone();var P=q.GetPropertyValue();P.SetValue(L.x);G.AddOrModifyProperty(q)}var M=E.GetProperty("Collab.3D.Paper.Paper.Position.Y");if(M){var p=M.Clone();var t=p.GetPropertyValue();t.SetValue(L.y);G.AddOrModifyProperty(p)}if(this.initDressupManipInfo.rel2D3D.radius!==0){var J=E.GetProperty("Collab.3D.Paper.3D.Text.Radius");if(J){var x=J.Clone();var C=x.GetPropertyValue();C.SetValue(r);G.AddOrModifyProperty(x)}}return G},_getNewDims3DConsideringData:function(ad,ah){var t=this.QueryInterface("VCXIModifiable");var E=t.GetPropertyValue("Collab.3D.Paper.Billboard.Type")===m.EBillboardType.Spherical;var F=ad.anchorWorldMatrix;var I=new i.Vector3().getPositionFromMatrix(ad.anchorWorldMatrix);if(E){var O=this.QueryInterface("W3AISGNodeHolder").giveSGNode();var z=O.GetShapeInfo();var F=z.smartNode.getMatrix().clone();I=new i.Vector3().getPositionFromMatrix(z.smartNode.getMatrix());F.setPosition(new i.Vector3().getPositionFromMatrix(ad.anchorWorldMatrix))}var o=new i.Matrix4().extractRotation(F);var B=new i.Matrix4().getInverse(F);var Z=new i.Matrix4().extractRotation(B);var ai=1;var p=new i.Matrix4();if(t.GetPropertyValue("Collab.Is.Paper")||t.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")===m.ESizeControlType.Paper){var R=this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer();var Y=this.GetObject()._experienceBase.getManager("VCXPaperManager");var U={viewer:R,viewpoint:R.currentViewpoint};ai=this.GetObject()._experienceBase.getManager("VCXPaperManager").GetPaperRatio(U,I);var af=new i.Matrix4().makeScale(ai,ai,ai);p.getInverse(af)}var N=ah.translationVector;var T=N.clone().applyMatrix4(Z);var v=ad.resizeType;var ae=v.includes("Left");var D=v.includes("Right");var ac=v.includes("Top");var s=v.includes("Bottom");var x=ad.width*ai;var S=ad.height*ai;var q=x;var M=S;var aj=0;var X=0;var u=new i.Vector3();switch(t.GetPropertyValue("Collab.Body.HAlignment")){case m.EHAlignment.Left:X=+1;u.x=x/2;break;case m.EHAlignment.Right:X=-1;u.x=-x/2;break;case m.EHAlignment.Middle:default:break}switch(t.GetPropertyValue("Collab.Body.VAlignment")){case m.EVAlignment.Top:aj=-1;break;case m.EVAlignment.Bottom:aj=+1;break;case m.EVAlignment.Middle:default:break}u.x=X*x/2;u.y=aj*S/2;var H=new i.Vector3();var G=u.clone();var O=this.QueryInterface("W3AISGNodeHolder").giveSGNode();var z=O.GetShapeInfo();if(!z.keepAspectRatio){var J=ae?-1:(D?+1:0);var L=s?-1:(ac?+1:0);if(J!==0){q+=J*T.x;H.x+=T.x*0.5;if(q<0){q=-q}}if(L!==0){M+=L*T.y;H.y+=T.y*0.5;if(M<0){M=-M}}}else{var V=x/S;if(!V){console.warn("A ratio should have been determined for now...");return}var aa=new i.Vector3().addVectors(ah.manipulator.initial3dIntersectionPoint,ah.translationVector);var ag=aa.clone().applyMatrix4(B);var y=new i.Vector3(ae?x*0.5:-x*0.5,ac?-S*0.5:S*0.5,0);var A=u.clone().add(y);var r=new i.Vector2().subVectors(ag,A);var W=Math.abs(r.x/r.y);var w=1;if(W>V){w=Math.abs(r.x/x)}else{w=Math.abs(r.y/S)}q=w*x;M=w*S;var Q=new i.Vector3();Q.setX(r.x<0?-q:q);Q.setY(r.y<0?-M:M);var C=Q.clone().multiplyScalar(0.5);H=new i.Vector3().addVectors(C,y)}G.x=X*q*0.5;G.y=aj*M*0.5;var ab=H.clone().add(u).sub(G);ab.divideScalar(ai);var K=ab.applyMatrix4(F);var P=ad.anchorWorldMatrix.clone().setPosition(K);return{anchorMatrix:P,width:q/ai,height:M/ai}},_setNewDimensionsPropSet:function(C,w,v,B,z){var J=new g();var r=C.GetPropertyValue("Collab.3D.Paper.Positioning.Type");if(r===m.EPositionType.RelativeToReferential){J=this._setNewDimensionsPropSetRelTo3D(C,w,v,B,z)}else{J=new g()}var N=C.GetProperty("Collab.Body.Width");var U=N.Clone();if(typeof B==="number"){var M=U.GetPropertyValue();M.SetValue(B)}J.AddOrModifyProperty(U);var I=C.GetProperty("Collab.Body.Height");var O=I.Clone();if(typeof z==="number"){var q=O.GetPropertyValue();q.SetValue(z)}J.AddOrModifyProperty(O);var K,H;if(w||v){if(w){switch(C.GetPropertyValue("Collab.Body.HAlignment")){case m.EHAlignment.Middle:K=w;break;case m.EHAlignment.Right:K=w+B/2;break;case m.EHAlignment.Left:default:K=w-B/2;break}}if(v){switch(C.GetPropertyValue("Collab.Body.VAlignment")){case m.EVAlignment.Middle:H=v;break;case m.EVAlignment.Bottom:H=v+z/2;break;case m.EVAlignment.Top:default:H=v-z/2;break}}}if(r===m.EPositionType.Free2D){var T=C.GetProperty("Collab.3D.Paper.Paper.Position.X");if(T){var t=T.Clone();if(K){var V=t.GetPropertyValue();V.SetValue(K)}J.AddOrModifyProperty(t)}var R=C.GetProperty("Collab.3D.Paper.Paper.Position.Y");if(R){var s=R.Clone();if(H){var u=s.GetPropertyValue();u.SetValue(H)}J.AddOrModifyProperty(s)}}else{if(r===m.EPositionType.Free3D){var p=this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer();var S=this.GetObject()._experienceBase.getManager("VCXPaperManager");var o={viewer:p,viewpoint:p.currentViewpoint};var A=C.GetProperty("Collab.3D.Paper.3D.Text.Position");if(A){var L=A.Clone();if(K||H){var G=L.GetPropertyValue();var Q=G.GetValue();var F=C.QueryInterface("W3AISGNodeHolder");var y=F.getPositionInWCS(p,Q);var E=S.ModelToMM2(o,y);var D=new i.Vector2(K?K:E.x,H?H:E.y);var x=S.MMToModel2(o,D);var P=F.getPositionInLCS(p,x);G.SetValue(P)}J.AddOrModifyProperty(L)}}}return J},_setNewDimensionsPropSet3D:function(x,o,w,v){var B=new g();var p=Object.keys(x._Anchors)[0];var y=x.GetProperty("Actor.Anchor."+p).Clone();var C=y.GetPropertyValue().GetValueLink();var s=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(C);if(!s){s=this.GetObject().getWorkingRootComponent()}var z=s.QueryInterface("W3AISGNodeHolder");var r=z.getMatrixInLCS(s._experienceBase.getManager("VCXContextManager").getMainViewer(),o);var u=y.GetPropertyValue().GetValueFrame();u.Value=r;var t=y.GetPropertyValue().SetValueFrame(u);y.SetPropertyValue(t);B.AddOrModifyProperty(y);var E=x.GetProperty("Collab.Body.Width");var G=E.Clone();if(typeof w==="number"){var D=G.GetPropertyValue();D.SetValue(w)}B.AddOrModifyProperty(G);var A=x.GetProperty("Collab.Body.Height");var F=A.Clone();if(typeof v==="number"){var q=F.GetPropertyValue();q.SetValue(v)}B.AddOrModifyProperty(F);return B},bIsAttachOriginInitiated:function(){return !(this.QueryInterface("VCXIModifiable").GetPropertyValue("Collab.Attach.Origin").equals(new i.Vector3()))},updateAttachOriginInResize:function(w,x,r){return;var C=this.QueryInterface("VCXIModifiable");var u=new i.Vector3().subVectors(x.attachOrigin,x.center.mm);var o=new i.Vector3().set(u.x*r.width/x.width.mm,u.y*r.height/x.height.mm,x.attachOrigin.z);var p=new i.Vector3().addVectors(o,r.center);var A=this.GetObject()._experienceBase.getManager("VCXPaperManager");var t={viewer:w.viewer,viewpoint:w.viewer.currentViewpoint};var z=A.MMToModel2(t,r.center);var v=new i.Plane().setFromNormalAndCoplanarPoint(w.viewer.currentViewpoint.getSightDirection(),z);var s=A.MMToModel2(t,p);var y=v.projectPoint(s);var q=A.ModelToMM2(t,y);var B=C.GetProperty("Collab.Attach.Origin").Clone();B.SetPropertyValue(new f(q));return B},getShapeInfo:function(){var o=this.QueryInterface("W3AISGNodeHolder").giveSGNode();if(!o){console.warn("Could not find a sceneGraphNode for current Manipulable...");return}return o.GetShapeInfo()},updateDashedOutline:function(o){var v=this.getShapeInfo();if(!this.dashedOutline){var s=this.GetObject()._experienceBase.getManager("VCXMaterialManager");var t=s.getLineMaterialFromParams({type:k.ELineType.SmallDash,color:"#FFFFFF",lineWidth:1});this.dashedOutline=h.createRectangleNode({width:1,height:1,fill:false,material:t});this.dashedOutline.setVisibilityInTree(false);this.dashedOutline.setPickable(d.NODRAWHL);this.dashedOutline.excludeFromHighlight(true,true);var w=this.QueryInterface("W3AISGNodeHolder").giveSGNode();if(w&&w.children&&w.children.indexOf(this.dashedOutline)<0&&v.smartNode){v.smartNode.addChild(this.dashedOutline)}}var y=this.QueryInterface("VCXIModifiable");var u=this.getAllInteractors();var p=o;if(p){p=false;for(var q in u){if(u.hasOwnProperty(q)){if(q.includes("Resize")&&u[q].active){p=true;break}}}}if(p){switch(v.shape){case m.EBodyShape.Rectangle:case m.EBodyShape.RoundedRectangle:case m.EBodyShape.Square:case m.EBodyShape.RoundedSquare:if(y.GetPropertyValue("Collab.Background.Show")&&y.GetPropertyValue("Collab.Background.Color.Opacity")>=0.02){p=false}else{if(y.GetPropertyValue("Collab.Image.Show")&&y.GetPropertyValue("Collab.Image.Doc.ID")>=0){if(y.GetPropertyValue("Collab.Body.InnerMargin")>0){p=true}else{p=false}}else{p=true}}break;default:p=true;break}}this.dashedOutline.setVisibility(p);if(p===false){return}var x=v.size;var r=new i.Vector3();switch(y.GetPropertyValue("Collab.Body.HAlignment")){case m.EHAlignment.Middle:r.x=-x.x*0.5;break;case m.EHAlignment.Right:r.x=-x.x;break;case m.EHAlignment.Left:default:r.x=0;break}switch(y.GetPropertyValue("Collab.Body.VAlignment")){case m.EVAlignment.Middle:r.y=-x.y*0.5;break;case m.EVAlignment.Bottom:r.y=0;break;case m.EVAlignment.Top:default:r.y=-x.y;break}this.dashedOutline.setMatrix(new i.Matrix4().makeScale(x.x,x.y,1).setPosition(r))}});Object.defineProperty(e.prototype,"dashedOutline",{enumerable:true,get:function(){return this._dashedOutline},set:function(o){this._dashedOutline=o}});return e});define("DS/VCXWebDressup/VCXManipulableCircle",["DS/VCXWebDressup/VCXManipulableDressup","DS/VCXWebProperties/VCXPropertySet","DS/Visualization/ThreeJS_DS"],function(a,d,b){var c=a.extend({interact:function(f){var e=f&&f.manipulator&&f.manipulator.interactor&&f.manipulator.interactor.id;if(!e){return}if(e==="Resize Circle"){var h;var g=f.eventChannel.replace("Manipulate","Manip");g=g.charAt(0).toLowerCase()+g.slice(1);h=g+"ResizeCircle";this[h]&&this[h](f)}else{this._parent(f)}},beginManipResizeCircle:function(h){var k=this.GetObject()._experienceBase;if(k.getManager("VCXGUIManager")._isPlayingGoTo){this.initDressupManipInfo={doNotManipulate:true};return}var n=this.QueryInterface("VCXIModifiable");var l=k.getManager("VCXPaperManager");var f={viewer:h.viewer,viewpoint:h.viewer.currentViewpoint};var g=h.manipulator&&h.manipulator.interactor&&h.manipulator.interactor.id;if(n.GetPropertyValue("Collab.Is.Paper")){var e=k.getManager("VCXContextManager");var j=e.getMainViewer();var l=k.getManager("VCXPaperManager");var m={viewer:j,viewpoint:j.currentViewpoint};var i=new b.Vector3().getPositionFromMatrix(n.GetAnchorWorldMatrix(0));this._ratioFactor=l.GetPaperRatio(m,i)}else{this._ratioFactor=1}},manipResizeCircle:function(g){var f=g.manipulator&&g.manipulator.interactor;if(!g||!f){return}var e=this._getPropSetAfterResize(f);f.requestedPropertySet=e},endManipResizeCircle:function(g){var f=g.manipulator&&g.manipulator.interactor;if(!g||!f){return}var e=this._getPropSetAfterResize(f);f.requestedPropertySet=e;this._ratioFactor=null},_getPropSetAfterResize:function(j){var o=this.QueryInterface("VCXIModifiable");var m=new d();var f=o.GetAnchorWorldMatrix(0);var h=new b.Vector3().getPositionFromMatrix(f);var e=j.requestedMatrix;var i=new b.Vector3().getPositionFromMatrix(e);var k=new b.Vector3().subVectors(i,h).length()/this._ratioFactor;var l=o.GetProperty("Circle.Radius");var g=l.Clone();if(typeof k==="number"){var n=g.GetPropertyValue();n.SetValue(k);m.AddOrModifyProperty(g)}return m}});return c});define("DS/VCXWebDressup/VCXManipulableArrowLinear",["DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebDressup/VCXManipulableDressup","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebProperties/VCXPropertySet","DS/Visualization/ThreeJS_DS"],function(b,a,f,e,c){var d=a.extend({interact:function(l){if(l&&l.manipulator&&l.manipulator.interactor&&l.manipulator.interactor.id==="Interactor Anchor.1"){var h=this.QueryInterface("VCXIModifiable");if(!h){console.warn("Manipulable's associated modifiable not found !!");return}if(l.eventChannel==="BeginManipulate"){this._parent(l);var k=this.GetObject()._experienceBase.getManager("VCXPaperManager");var j={viewer:l.viewer,viewpoint:l.viewer.currentViewpoint};var m=h.GetAnchorWorldMatrix(0,null);var g=new c.Vector3().getPositionFromMatrix(m);var i=k.ModelToMM2(j,g);this._initPositionInMM=new c.Vector2(h.GetPropertyValue("Arrow.Head.2.Position.X"),h.GetPropertyValue("Arrow.Head.2.Position.Y")).add(i)}else{if(l.eventChannel==="Manipulate"){this._updateHead2PropertiesFromData(l)}else{if(l.eventChannel==="EndManipulate"){this._parent(l);this._updateHead2PropertiesFromData(l);this._initPositionInMM=null}}}}else{this._parent(l)}},_updateHead2PropertiesFromData:function(H){var A=this.QueryInterface("VCXIModifiable");var C=H.manipulator.interactor.requestedPropertySet||new e();var t=this.GetObject()._experienceBase;var G=t.getManager("VCXPaperManager");var p={viewer:H.viewer,viewpoint:H.viewer.currentViewpoint};var i=A.GetAnchorWorldMatrix(0,null);var o=new c.Vector3().getPositionFromMatrix(i);var x=G.ModelToMM2(p,o);var u=new c.Vector3().getPositionFromMatrix(H.manipulator.interactor.requestedMatrix);var s=G.ModelToMM2(p,u);var k=new c.Vector2().subVectors(s,this._initPositionInMM);var h=true;var g=H.intersection.path&&H.intersection.path[0];if(g){var m=f.GetModifiableFromPathElement(g,t);if(m){h=false}}if(h!==A.GetPropertyValue("Arrow.Head.2.Position.Is.Paper")){var w=A.GetProperty("Arrow.Head.2.Position.Is.Paper").Clone();var B=w.GetPropertyValue();B.SetValue(h);C.AddOrModifyProperty(w)}else{C.AddOrModifyProperty(A.GetProperty("Arrow.Head.2.Position.Is.Paper").Clone())}var l=s.clone();l.x-=x.x;l.y-=x.y;if(l.x!==A.GetPropertyValue("Arrow.Head.2.Position.X")){var y=A.GetProperty("Arrow.Head.2.Position.X").Clone();var v=y.GetPropertyValue();v.SetValue(l.x);C.AddOrModifyProperty(y)}else{C.AddOrModifyProperty(A.GetProperty("Arrow.Head.2.Position.X").Clone())}if(l.y!==A.GetPropertyValue("Arrow.Head.2.Position.Y")){var D=A.GetProperty("Arrow.Head.2.Position.Y").Clone();var z=D.GetPropertyValue();z.SetValue(l.y);C.AddOrModifyProperty(D)}else{C.AddOrModifyProperty(A.GetProperty("Arrow.Head.2.Position.Y").Clone())}var q=new c.Vector2(l.x,l.y).length();var F=q*G.GetPaperRatio(p,o);if(F!==A.GetPropertyValue("Arrow.Length")){var n=A.GetProperty("Arrow.Length").Clone();var j=n.GetPropertyValue();j.SetValue(F);C.AddOrModifyProperty(n)}var E=A.GetProperty("Actor.Anchor.1").Clone();var r=b.BuildNewPropertyValueAnchor(H.manipulator.interactor.requestedMatrix,this.GetObject(),g);E.SetPropertyValue(r);C.AddOrModifyProperty(E);H.manipulator.interactor.requestedPropertySet=C}});return d});define("DS/VCXWebDressup/VCXComponentViewport",["DS/VCXWebDressup/VCXComponentDressup","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(c,b,d){var a=c.extend({init:function(){this._parent();this.IsViewPointDependent=true;this.IsAnchorDependent=false;this._hdrUrl=null;this._originLight1Intensity=null;this._originLight2Intensity=null;this._originLight3Intensity=null;this._originAmbientLightIntensity=null},Build:function(){this._experienceBase.getManager("VCXVisuManager").setActiveViewport(this)},getActiveAmbienceID:function(){var e=this.QueryInterface("VCXIModifiable");if(e){var f=e.GetPropertyValue("Viewport.ActiveAmbience");if(f&&f.length){return f}}return null},setLightingMode:function(o,v,s){var e=false;var j=16777215;var t=1;var u=null;var k=false;var m=16777215;var h=1;var i=null;var w=false;var p=16777215;var n=1;var r=null;var g=0;switch(o){case a.ERenderLightingMode.Custom:case a.ERenderLightingMode.Soft:e=true;t=v*0.8;u=new b.Vector3(0,0,1);break;case a.ERenderLightingMode.Medium:g=0.25;var f=0.5;e=true;t=v*0.8;u=new b.Vector3(f,f,1);k=true;h=v*0.8;i=new b.Vector3(-f,-f,-1);break;case a.ERenderLightingMode.Metal:g=0.2;var f=0.7;e=true;t=v;u=new b.Vector3(f,f,1);k=true;h=v*0.6;i=new b.Vector3(-f,-f,1);w=true;n=v*0.5;r=new b.Vector3(-1,1,-0.5);break;case a.ERenderLightingMode.HeavyMetal:g=0.2;var f=0.7;e=true;j=15461375;t=v*0.8;u=new b.Vector3(2*f,f,1);k=true;m=15268095;h=v*0.8;i=new b.Vector3(-f,-2*f,1);w=true;n=v*0.5;r=new b.Vector3(-1,1,-0.5);break;case a.ERenderLightingMode.HighContrast:g=0.2;var f=-0.7;e=true;j=16772075;t=v*0.9;u=new b.Vector3(2*f,f,1);k=true;m=15268095;h=v*0.9;i=new b.Vector3(-f,-2*f,1);w=true;n=v*0.5;r=new b.Vector3(1,-1,-1);break;case a.ERenderLightingMode.ShadedIllustration:var f=0.2;e=true;j=13158455;t=v*0.9;u=new b.Vector3(f,0,1);k=true;m=3618760;h=v*0.9;i=new b.Vector3(-f,0,1);break;case a.ERenderLightingMode.Archi:e=true;t=1;u=new b.Vector3(-1,1,1);break;case a.ERenderLightingMode.DefaultComposer:e=true;u=new b.Vector3(-0.25,0.25,0.5);k=true;h=0.6;i=new b.Vector3(0.25,-0.75,0);break}var q=this;var l=this.GetObject()._experienceBase.getManager("VCXContextManager");l.applyToViewers(function(x){if(e){x.setLightParameters({lightIndex:0,intensity:t,color:j,direction:u.normalize(),directionType:"camera"})}else{x.setLightParameters({lightIndex:0,intensity:0,color:0,direction:new b.Vector3(0,0,1),directionType:"camera"})}if(k){x.setLightParameters({lightIndex:1,intensity:h,color:m,direction:i.normalize(),directionType:"camera"})}else{x.setLightParameters({lightIndex:1,intensity:0,color:0,direction:new b.Vector3(0,0,1),directionType:"camera"})}if(w){x.setLightParameters({lightIndex:2,intensity:n,color:p,direction:r.normalize(),directionType:"camera"})}else{x.setLightParameters({lightIndex:2,intensity:0,color:0,direction:new b.Vector3(0,0,1),directionType:"camera"})}})},getColors:function(i){var n=this.QueryInterface("VCXIModifiable");if(n){var f=n.GetColorPropertyValue("Environment.Background");var e=f;if(n.GetPropertyValue("Environment.Background.Gradient")){e=n.GetColorPropertyValue("Environment.Background.Foot")}var j=e.Clone();var m=f.Clone();if(i){var l=i.getSightDirection();var h=l.z;var k=45*Math.PI/180;var g=(Math.sin(Math.asin(h)-k)+1)/2;j.r=e.r+g*(f.r-e.r);j.g=e.g+g*(f.g-e.g);j.b=e.b+g*(f.b-e.b);j.a=e.a+g*(f.a-e.a);g=(Math.sin(Math.asin(h)+k)+1)/2;m.r=e.r+g*(f.r-e.r);m.g=e.g+g*(f.g-e.g);m.b=e.b+g*(f.b-e.b);m.a=e.a+g*(f.a-e.a)}return{foot:j,head:m}}}});a.EPaperOrientation={Portrait:0,Landscape:1};a.EVertical={"X+":0,"Y+":1,"Z+":2,"X-":3,"Y-":4,"Z-":5};a.EAA={NoAA:0,SMAA:1,MLAA:2,FXAA:3,FSAA:4,MSAA:5,SSAA:6,MSMAA:7};a.ESSAO={NoSSAO:0,Simple:1,Iterative:2,OnIdle:3};a.EEnvironment={None:0,exterior_parking:1,arches_pinetree:2,barcelona_rooftop:3,exterior_plaza_4:4,exterior_scenic_5:5,exterior_sky:6,interior_apartment_1:7,studio_panel_3:8,studio_spot_1:9,studio_spot_2:10,PLM:100};a.EOutlineType={Sharp:0,Construction:1,Smart:2};a.ERenderLightingMode={Custom:0,Soft:1,Medium:2,Metal:3,HeavyMetal:4,HighContrast:5,ShadedIllustration:6,Archi:7,DefaultComposer:8,};Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentViewport"}});a.prototype._dressupFamily="Environment";Object.defineProperty(a.prototype,"renderMode",{enumerable:true,set:function(e){this._renderMode=e},get:function(){return this._renderMode}});Object.defineProperty(a.prototype,"outlineType",{enumerable:true,set:function(e){this._outlineType=e},get:function(){return this._outlineType}});return a});define("DS/VCXWebDressup/VCXViewportModifiable",["DS/VCXWebDressup/VCXComponentViewport","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebTracks/VCXInterpolator","DS/Visualization/ThreeJS_DS","DS/WebappsUtils/WebappsUtils","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueDocId","DS/Visualization/SceneGraphUtils","DS/VCXWebKernelTools/VCXEnums","DS/VCXWebComponents/VCXWebComponentOccurrence",],function(i,y,a,x,e,g,m,p,r,d,o,t,u,v,k,f,c,s,w,q,j,l,b,n){var h=y.extend({init:function(){this._parent();this._bIsViewport=true;this._envMapNeverLoaded=false;this._forceRefresh=false},Dispose:function(){this._parent();delete this._currentAmbienceIDXs},Build:function(){this._parent();var z=[{Name:"Actor.Name",Type:s,DefaultValue:"Viewport",NLSPath:"VCXWebModifiables/VCXWebModifiables"},{Name:"Camera.Position",Type:f,DefaultValue:new x.Matrix4(),Persistent:false,},{Name:"Actor.Anchor.1",Type:c,DefaultValue:new c().SetValueFrame(new f().SetValueFromVector(new x.Vector3(0,0,0))).GetValue(),Persistent:false,},{Name:"Actor.Anchor.2",Type:c,DefaultValue:new c().SetValueFrame(new f().SetValueFromVector(new x.Vector3(0,0,0))).GetValue(),Persistent:false,},{Name:"Collab.ListAnchorsIDs",Type:w,DefaultValue:[1,2]},{Name:"Camera.Angle",Type:u,DefaultValue:45,GroupId:"Group.Camera",Persistent:false,},{Name:"Camera.Height",Type:u,DefaultValue:400,GroupId:"Group.Camera",Persistent:false,},{Name:"Camera.Ortho",Type:t,DefaultValue:false,GroupId:"Group.Camera",Persistent:false,},{Name:"Camera.Arcball",Type:t,DefaultValue:true,GroupId:"Group.Camera",Persistent:false,},{Name:"Camera.Pitch",Type:t,DefaultValue:true,GroupId:"Group.Camera",Persistent:false,},{Name:"Camera.Roll",Type:t,DefaultValue:true,GroupId:"Group.Camera",Persistent:false,},{Name:"Camera.Roll.Angle",Type:u,DefaultValue:0,GroupId:"Group.Camera",Persistent:false,Bounds:{Min:-180,Max:180,Step:1},},{Name:"Camera.Yaw",Type:t,DefaultValue:true,GroupId:"Group.Camera",Persistent:false,},{Name:"Camera.LockDistCOI",Type:t,DefaultValue:false,GroupId:"Group.Camera",Persistent:false,},{Name:"Camera.DistCOI",Type:u,DefaultValue:500,GroupId:"Group.Camera",Persistent:false,},{Name:"Document.Paper.Width",Type:u,GroupId:"Group.Paper",Persistent:false,BehaviorType:1},{Name:"Document.Paper.Height",Type:u,GroupId:"Group.Paper",Persistent:false,BehaviorType:1},{Name:"Document.Paper.Orientation",Type:v,GroupId:"Group.Paper",Persistent:false,BehaviorType:1,MapChoice:this._generateMapChoiceFromEnumAndId(i.EPaperOrientation,"Document.Paper.Orientation")},{Name:"Viewport.ActiveAmbience",Type:s,DefaultValue:"",GroupId:"Group.Environment",BehaviorType:1},{Name:"Viewport.ActiveAmbience.IDX",Type:v,GroupId:"Group.Environment",Persistent:false,BehaviorType:1,MapChoice:{0:"None"}},{Name:"Viewport.ActiveCamera",Type:o,DefaultValue:0,GroupId:"Group.Environment",Persistent:false,BehaviorType:1},{Name:"Environment.Vertical",Type:v,DefaultValue:i.EVertical["Z+"],GroupId:"Group.Environment",MapChoice:this._generateMapChoiceFromEnumAndId(i.EVertical)},{Name:"Environment.Background.Color",Type:k,DefaultValue:new q().FromRGBA(236/255,236/255,236/255),GroupId:"Group.Environment.Background"},{Name:"Environment.Background.Color.Opacity",Type:u,DefaultValue:1,GroupId:"Group.Environment.Background"},{Name:"Environment.Background.Image",Type:j,DefaultValue:-1,GroupId:"Group.Environment.Background"},{Name:"Environment.Background.Gradient",Type:t,DefaultValue:false,GroupId:"Group.Environment.Background"},{Name:"Environment.Background.Foot.Color",Type:k,DefaultValue:new q().FromRGBA(236/255,236/255,236/255),GroupId:"Group.Environment.Background"},{Name:"Environment.Shadow",Type:t,DefaultValue:false,Persistent:false,GroupId:"Group.Environment.Effects"},{Name:"Environment.AA",Type:v,DefaultValue:i.EAA.SMAA,GroupId:"Group.Environment.Effects",MapChoice:this._generateMapChoiceFromEnumAndId(i.EAA,"Environment.AA")},{Name:"Environment.SSAO",Type:v,DefaultValue:i.ESSAO.NoSSAO,GroupId:"Group.Environment.Effects",MapChoice:this._generateMapChoiceFromEnumAndId(i.ESSAO,"Environment.SSAO")},{Name:"Environment.Vignetting",Type:t,DefaultValue:false,GroupId:"Group.Environment.Effects"},{Name:"Environment.DOF",Type:t,DefaultValue:false,GroupId:"Group.Environment.Effects"},{Name:"Environment.Bloom",Type:t,DefaultValue:false,GroupId:"Group.Environment.Effects"},{Name:"Environment.Flare",Type:t,DefaultValue:false,GroupId:"Group.Environment.Effects"},{Name:"Environment.BackFaceCulling",Type:t,DefaultValue:true,GroupId:"Group.Environment.Effects"},{Name:"Environment.ShowEnvironment",Type:t,DefaultValue:false,GroupId:"Group.Environment.Effects"},{Name:"Environment.Environment",Type:v,DefaultValue:i.EEnvironment.exterior_parking,GroupId:"Group.Environment.Effects",MapChoice:this._generateMapChoiceFromEnumAndId(i.EEnvironment,"Environment.Environment")},{Name:"Render.Mode",Type:v,DefaultValue:b.ERenderMode.Smooth,GroupId:"Group.Render",MapChoice:this._generateMapChoiceFromEnumAndId(b.ERenderMode,"Render")},{Name:"Render.OutlineType",Type:v,DefaultValue:i.EOutlineType.Construction,GroupId:"Group.Render",MapChoice:this._generateMapChoiceFromEnumAndId(i.EOutlineType,"Render.OutlineType")},{Name:"Render.Lighting.Intensity",Type:u,DefaultValue:0.9,GroupId:"Group.Render.Lighting"},{Name:"Render.Lighting.Mode",Type:v,DefaultValue:i.ERenderLightingMode.DefaultComposer,GroupId:"Group.Render.Lighting",MapChoice:this._generateMapChoiceFromEnumAndId(i.ERenderLightingMode,"Render.Lighting.Mode")},{Name:"Environment.Debug.Availability",Type:v,DefaultValue:0,ControlsGroupAvailability:true,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Show",Type:t,DefaultValue:false,ControlsGroupVisibility:true,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.ShadowLight",Type:t,DefaultValue:false,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.BSphere",Type:t,DefaultValue:false,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.PrimitiveBSphere",Type:t,DefaultValue:false,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.RepBBox",Type:t,DefaultValue:false,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Picking",Type:t,DefaultValue:false,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Normals",Type:t,DefaultValue:false,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.PickHybrid",Type:t,DefaultValue:false,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.PostProcessing",Type:t,DefaultValue:false,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.ShadowMaps",Type:t,DefaultValue:false,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.FPS",Type:t,DefaultValue:false,GroupId:"Group.Environment.Debug"},{Name:"Render.PixelCulling",Type:u,DefaultValue:1,GroupId:"Group.Environment.Debug"},];this._BuildPropertyValues(z);this.SetPropertyInvisible("Actor.Color",false);this.SetPropertyInvisible("Collab.ListAnchorsIDs",true)},GetVirtualProperties:function(){var z={};z["Camera.Position"]=true;return z},GetRequiredPropertiesForTransition:function(){var A=this.QueryInterface("VCXIViewpointController");if(A){A.fromViewpoint()}var z={};z["Camera.Position"]=true;z["Actor.Anchor.1"]=true;z["Actor.Anchor.2"]=true;z["Camera.Angle"]=true;z["Camera.Height"]=true;z["Camera.Ortho"]=true;z["Camera.Arcball"]=true;z["Actor.Interpolation.Type"]=true;z["Camera.Pitch"]=true;z["Camera.Roll"]=true;z["Camera.Roll.Angle"]=true;z["Camera.Yaw"]=true;z["Camera.LockDistCOI"]=true;z["Camera.DistCOI"]=true;return z},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Environment.Background.Color.Opacity",this.GetPropertyValue("Environment.Background.Image")===-1);this.SetPropertyInvisible("Environment.Background.Foot.Color",!this.GetPropertyValue("Environment.Background.Gradient"));this.SetPropertyInvisible("Actor.Interpolation.Type",false);this.SetPropertyInvisible("Viewport.ActiveAmbience",true)},GetProperties:function(z){var A=this.QueryInterface("VCXIViewpointController");if(A){A.fromViewpoint()}return(this._parent(z))},GetProperty:function(H){if(H==="Document.Paper.Width"){var I=this.ExperienceBase.getManager("VCXPaperManager");if(I){return this.GetNewProperty(H,I.GetWidth())}}else{if(H==="Document.Paper.Height"){var I=this.ExperienceBase.getManager("VCXPaperManager");if(I){return this.GetNewProperty(H,I.GetHeight())}}else{if(H==="Document.Paper.Orientation"){var I=this.ExperienceBase.getManager("VCXPaperManager");if(I){return this.GetNewProperty(H,I.GetOrientation())}}else{if(H==="Environment.AA"){var C=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(C){return this.GetNewEnumProperty(H,H+"."+C.antiAliasing)}}else{if(H==="Environment.Shadow"){var C=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(C){return this.GetNewProperty(H,C.useShadowMap)}}else{if(H==="Environment.Vignetting"){var C=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(C){return this.GetNewProperty(H,C.useVignetting)}}else{if(H==="Environment.DOF"){var C=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(C){return this.GetNewProperty(H,C.useDOF)}}else{if(H==="Environment.Bloom"){var C=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(C){return this.GetNewProperty(H,C.useBloom)}}else{if(H==="Environment.Flare"){var C=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(C){return this.GetNewProperty(H,C.useFlare)}}else{if(H==="Environment.BackFaceCulling"){var C=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(C){return this.GetNewProperty(H,C.renderer.disableBackFaceCulling===false)}}else{if(H==="Render.PixelCulling"){var C=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(C){return this.GetNewProperty(H,C.currentViewpoint.camera.pixelCulling)}}else{if(H==="Viewport.ActiveAmbience.IDX"){var E=this._Properties["Viewport.ActiveAmbience.IDX"]._propertyInfo;this._currentAmbienceIDXs=[];var D=this.ExperienceBase.ComponentsMap.GetComponentFromType("AmbienceModel_Spec");E.AddOrModifyChoice(0,"None");var B=0;for(var J=0;J<D.length;J++){var A=D[J].GetID();this._currentAmbienceIDXs[J]=A;if(A===this.GetPropertyValue("Viewport.ActiveAmbience")){B=J+1}var G=A;var K=D[J].QueryInterface("VCXIModifiable");if(K){var z=K.GetProperty("Actor.Name");if(z){G=z.GetPropertyValue().Value}}E.AddOrModifyChoice(J+1,G)}var F=new v(B);return new p(E,F)}else{return this._parent(H)}}}}}}}}}}}}},RequestModification:function(B){var A=new m();if(B){if(B.GetPropertyInfo().GetPropertyName()==="Viewport.ActiveAmbience.IDX"){var z=B.GetPropertyValue().Value-1;if(this._currentAmbienceIDXs&&z>=0){var C=this._currentAmbienceIDXs[z];A.AddOrModifyProperty(this.GetNewProperty("Viewport.ActiveAmbience",C))}else{A.AddOrModifyProperty(this.GetNewProperty("Viewport.ActiveAmbience",""))}}else{A.AddOrModifyProperty(B)}}return A},OnChangeProperty:function(D,z,C){if(C){}else{C={}}if(C.fromChildClass){}else{if(this.OnChangePropertyBegin(D,z)){return true}}C.fromChildClass=true;this._parent(D,z,C);var A=this.ExperienceBase.getManager("VCXContextManager");var E;if(D==="Document.Paper.Width"){this._paperRequestedWidth=z}else{if(D==="Document.Paper.Height"){this._paperRequestedHeight=z}else{if(D==="Document.Paper.Orientation"){this._paperRequestedOrientation=z}else{if(D==="Environment.Environment"){if(z.Value===0){this._envMapStr=""}else{E=this.GetProperty(D).GetPropertyInfo().GetMapChoiceEnum();this._envMapStr=E[z.Value].split(".").pop()}}else{if(D==="Environment.ShowEnvironment"){this._showEnv=z.Value}else{if(D==="Environment.AA"){E=this.GetProperty(D).GetPropertyInfo().GetMapChoiceEnum();var B=E[z.Value].split(".").pop();A.applyToViewers(function(F){F.setAntiAliasing(B)})}else{if(D==="Environment.SSAO"){switch(z.Value){case 0:this.ExperienceBase.getManager("VCXVisuManager").SSAOONIdle=false;break;case 1:this.ExperienceBase.getManager("VCXVisuManager").SSAOONIdle=false;break;case 2:this.ExperienceBase.getManager("VCXVisuManager").SSAOONIdle=false;break;case 3:this.ExperienceBase.getManager("VCXVisuManager").SSAOONIdle=true;break}}else{if(D==="Environment.Mirror"){A.applyToViewers(function(F){F.setMirror(z.Value)})}else{if(D==="Environment.Shadow"){A.applyToViewers(function(F){F.setShadow(z.Value)})}else{if(D==="Environment.Vignetting"){A.applyToViewers(function(F){F.setVignetting(z.Value)})}else{if(D==="Environment.DOF"){A.applyToViewers(function(F){F.setDOF(z.Value)})}else{if(D==="Environment.Bloom"){A.applyToViewers(function(F){F.setBloom(z.Value)})}else{if(D==="Environment.Flare"){A.applyToViewers(function(F){F.setFlare(z.Value)})}else{if(D==="Environment.BackFaceCulling"){A.applyToViewers(function(F){F.setDisableBackFaceCulling(false===z.Value)})}else{if(D==="Render.PixelCulling"){A.applyToViewers(function(F){F.currentViewpoint.setPixelCulling(z.Value)})}else{if(D==="Environment.Debug.ShadowLight"){A.applyToViewers(function(F){F.debugShadowLight=z.Value})}else{if(D==="Environment.Debug.BSphere"){A.applyToViewers(function(F){F.debugBSphere=z.Value})}else{if(D==="Environment.Debug.PrimitiveBSphere"){A.applyToViewers(function(F){F.debugPrimitiveBSphere=z.Value})}else{if(D==="Environment.Debug.RepBBox"){A.applyToViewers(function(F){F.debugRepBBox=z.Value})}else{if(D==="Environment.Debug.Picking"){A.applyToViewers(function(F){F.debugPicking=z.Value})}else{if(D==="Environment.Debug.Normals"){A.applyToViewers(function(F){F.debugNormals=z.Value})}else{if(D==="Environment.Debug.BackfaceCulling"){A.applyToViewers(function(F){F.debugBackfaceCulling=z.Value})}else{if(D==="Environment.Debug.PickHybrid"){A.applyToViewers(function(F){F.debugPickHybrid=z.Value})}else{if(D==="Environment.Debug.PostProcessing"){A.applyToViewers(function(F){F.setDebugPostProcessing(z.Value)})}else{if(D==="Environment.Debug.ShadowMaps"){A.applyToViewers(function(F){F.setDebugShadowMaps(z.Value)})}else{if(D==="Environment.Debug.FPS"){}else{if(D==="Render.Mode"){this._requestedRenderMode=z.Value}else{if(D==="Render.OutlineType"){this._requestedOutlineType=z.Value}}}}}}}}}}}}}}}}}}}}}}}}}}}}},OnChangePropertiesEnd:function(){this._parent();if(this._requestedRenderMode!==this.GetObject().renderMode||this._requestedOutlineType!==this.GetObject().outlineType||this._forceRefresh){this.GetObject().renderMode=this._requestedRenderMode;this.GetObject().outlineType=this._requestedOutlineType;var N=this.GetObject().renderMode;var I=this.GetObject().outlineType;var z=this.ExperienceBase.getManager("VCXContextManager");if(z.getRootComponent().setDirtyFlag){z.getRootComponent().setDirtyFlag(n.FDirty.RenderingMode)}z.traverseGraphMustBePerformed=true;var K=this.ExperienceBase.getManager("VCXVisuManager");z.applyToViewers(function(O){switch(N){case b.ERenderMode.Smooth:if(O.setRenderPriority){O.setRenderPriority(false)}if(O.setRenderPriority){O.setRenderPriorityDefaultOpacity(1)}O.setRenderMode("InternalSharpEdge",false);O.setRenderMode("InternalSmoothEdge",false);O.setRenderMode("BoundaryEdge",false);break;case b.ERenderMode.SmoothWithOutlines:if(O.setRenderPriority){O.setRenderPriority(false)}if(O.setRenderPriority){O.setRenderPriorityDefaultOpacity(1)}O.setRenderMode("InternalSharpEdge",true);O.setRenderMode("InternalSmoothEdge",I===i.EOutlineType.Construction);O.setRenderMode("BoundaryEdge",I===i.EOutlineType.Smart);break;case b.ERenderMode.Custom:K&&K.dirtifyRenderPriority();O.setRenderMode("InternalSharpEdge",false);O.setRenderMode("InternalSmoothEdge",false);O.setRenderMode("BoundaryEdge",false);break;default:break}})}if(this._paperRequestedWidth||this._paperRequestedHeight||this._paperRequestedOrientation||this._paperRequestedVisibility){var J=this.ExperienceBase.getManager("VCXPaperManager");if(J){if(this._paperRequestedWidth&&(this._paperRequestedWidth.Value!==J.GetWidth()||this._forceRefresh)){J.SetWidth(this._paperRequestedWidth.Value);this._paperRequestedWidth=null}if(this._paperRequestedHeight&&(this._paperRequestedHeight.Value!==J.GetHeight()||this._forceRefresh)){J.SetHeight(this._paperRequestedHeight.Value);this._paperRequestedHeight=null}if(this._paperRequestedOrientation&&(this._paperRequestedOrientation.Value!==J.GetOrientation()||this._forceRefresh)){J.SetOrientation(this._paperRequestedOrientation.Value);this._paperRequestedOrientation=null}J.updatePaper()}}var z=this.ExperienceBase.getManager("VCXContextManager");if(z){this._previousEnvMapStr=this._envMapStr;this._previousShowEnv=this._showEnv}if(this._previousVertical!==this.GetPropertyValue("Environment.Vertical")||this._forceRefresh){this._previousVertical=this.GetPropertyValue("Environment.Vertical");this.ExperienceBase.getManager("VCXVisuManager").setVertical(this.GetPropertyValue("Environment.Vertical"));var E=this.ExperienceBase.getManager("VCXVisuManager").getInverseMatrixToAdjustVertical();var B=this.ExperienceBase.getManager("VCXContextManager").getRootNode();B.setMatrix(E);var F=this.ExperienceBase.ComponentsMap.GetComponentFromType("VCXComponentCamera");var M=F[this.GetPropertyValue("Viewport.ActiveCamera")];if(M){M.updatePosition()}}if(this._previousActiveAmbience!==this.GetPropertyValue("Viewport.ActiveAmbience")){var C=this.ExperienceBase.ComponentsMap.GetComponentFromID(this._previousActiveAmbience);if(C&&C.GetType()==="AmbienceModel_Spec"){C.update()}C=this.ExperienceBase.ComponentsMap.GetComponentFromID(this.GetPropertyValue("Viewport.ActiveAmbience"));if(C&&C.GetType()==="AmbienceModel_Spec"){C.update()}this._previousActiveAmbience=this.GetPropertyValue("Viewport.ActiveAmbience")}if(this._previousActiveCam!==this.GetPropertyValue("Viewport.ActiveCamera")||this._forceRefresh){this._previousActiveCam=this.GetPropertyValue("Viewport.ActiveCamera");var F=this.ExperienceBase.ComponentsMap.GetComponentFromType("VCXComponentCamera");var H=F[this.GetPropertyValue("Viewport.ActiveCamera")];if(H){var D=H.QueryInterface("VCXIModifiable");var A=new g();var L=new p(new r("Actor.IsActive",2),new t(true));A.ChangeProperty(D,L);this.ExperienceBase.getManager("VCXCommandManager").Do(A);H.updatePosition()}}var G=this.QueryInterface("VCXIViewpointController");if(G&&!this.ExperienceBase.getManager("VCXVisuManager").CameraControlsViewpoint){G.resetMatrixAndDOI();G.toViewpoint()}},GetInterpolator:function(z){var A=this.QueryInterface("VCXIViewpointController");if(A){return A.GetInterpolator(z)}},});return h});define("DS/VCXWebDressup/VCXAmbienceModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXComponentViewport","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXColor"],function(e,h,m,d,i,f,k,b,j,l,c,a,n){var g=e.extend({init:function(){this._parent();this._bIsGround=true;this._envMapNeverLoaded=false},Build:function(){this._parent();var o=[{Name:"Environment.Background.Map",Type:a,DefaultValue:h.EEnvironment.exterior_parking,GroupId:"Group.Environment.Background",MapChoice:this._generateMapChoiceFromEnumAndId(h.EEnvironment,"Environment.Environment")},{Name:"Environment.Background.Show",Type:b,DefaultValue:true,GroupId:"Group.Environment.Background"},{Name:"Environment.Background.Radius",Type:j,DefaultValue:15000,GroupId:"Group.Environment.Background"},{Name:"Environment.Background.Exposure",Type:j,DefaultValue:1,Bounds:{Min:0,Max:5,Step:0.01},GroupId:"Group.Environment.Background"},{Name:"Environment.Background.Rotation",Type:j,DefaultValue:0,Bounds:{Min:0,Max:360,Step:0.5},GroupId:"Group.Environment.Background"},{Name:"Environment.Ground.Reflectivity",Type:j,DefaultValue:0,Bounds:{Min:0,Max:100,Step:0.1},GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Glossiness",Type:j,DefaultValue:0,Bounds:{Min:0,Max:100,Step:0.1},GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.ShadowIntensity",Type:j,DefaultValue:0,Bounds:{Min:0,Max:100,Step:0.1},GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Scaleratio",Type:j,DefaultValue:0.2,GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Offset",Type:j,DefaultValue:0,Bounds:{Min:-1,Max:1,Step:0.001},GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Scale",Type:j,DefaultValue:1,GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Disc.Grid.Show",Type:b,DefaultValue:false,GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Disc.Grid.Color",Type:l,DefaultValue:new n(),GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Disc.Grid.Falloff",Type:j,DefaultValue:0,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Disc.Diameter.Auto",Type:b,DefaultValue:true,GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Disc.Diameter",Type:j,DefaultValue:1,GroupId:"Group.Environment.Ground"},{Name:"Environment.Ground.Disc.Show",Type:b,DefaultValue:false,ControlsGroupVisibility:true,GroupId:"Group.Environment.Ground.Disc"},{Name:"Environment.Ground.Disc.Color",Type:l,DefaultValue:new n(),GroupId:"Group.Environment.Ground.Disc"},{Name:"Environment.Ground.Disc.Border.Show",Type:b,DefaultValue:false,GroupId:"Group.Environment.Ground.Disc"},{Name:"Environment.Ground.Disc.Border.Color",Type:l,DefaultValue:new n(),GroupId:"Group.Environment.Ground.Disc"},{Name:"Environment.Ground.Disc.FallOff",Type:j,DefaultValue:0,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Environment.Ground.Disc"},];this._BuildPropertyValues(o)},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Actor.Color",false);this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=false;this.SetPropertyInvisible("Actor.Color.Defined",true);this.GetProperty("Actor.Color.Defined").GetPropertyInfo()._bPersistent=false;this.SetPropertyInvisible("Actor.Opacity",true);this.GetProperty("Actor.Opacity").GetPropertyInfo()._bPersistent=false;this.SetPropertyInvisible("Actor.IsAlwaysOnTop",true);this.GetProperty("Actor.IsAlwaysOnTop").GetPropertyInfo()._bPersistent=false;this.SetPropertyInvisible("Environment.Ground.Disc.Border.Color",!this.GetPropertyValue("Environment.Ground.Disc.Border.Show"));this.SetPropertyInvisible("Environment.Ground.Disc.Grid.Color",!this.GetPropertyValue("Environment.Ground.Disc.Grid.Show"));this.SetPropertyInvisible("Environment.Ground.Disc.Grid.Falloff",!this.GetPropertyValue("Environment.Ground.Disc.Grid.Show"));this.SetPropertyInvisible("Environment.Ground.Disc.Diameter",this.GetPropertyValue("Environment.Ground.Disc.Diameter.Auto"));var o=this.ExperienceBase.getManager("VCXContextManager");if(o&&o.getUrlVars().debug===undefined){this.SetPropertyInvisible("Environment.Background.Map",true)}},RequestModification:function(q){var p=new d();if(q){if(q.GetPropertyInfo().GetPropertyName()==="Actor.Color"){var o=q.GetPropertyValue().Value.getAssociatedColors();p.AddOrModifyProperty(this.GetNewProperty("Environment.Ground.Disc.Color",o.body));p.AddOrModifyProperty(this.GetNewProperty("Environment.Ground.Disc.Border.Color",o.border));p.AddOrModifyProperty(this.GetNewProperty("Environment.Ground.Disc.Grid.Color",o.attach))}else{p.AddOrModifyProperty(q)}}return p}});return g});define("DS/VCXWebDressup/VCXComponentArrow",["DS/VCXWebDressup/VCXComponentDressup"],function(b){var a=b.extend({init:function(){this._parent();this._IsAnchorDependent=true},});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentArrow"}});a.prototype._dressupFamily="Markups";return a});define("DS/VCXWebDressup/VCXComponentArrowLinear",["DS/VCXWebDressup/VCXComponentArrow"],function(b){var a=b.extend({init:function(){this._parent()},});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentArrowLinear"}});a.prototype._dressupFamily="Markups";return a});define("DS/VCXWebDressup/VCXComponentArrowCorner",["DS/VCXWebDressup/VCXComponentArrow"],function(b){var a=b.extend({init:function(){this._parent();this.IsAnchorDependent=true},});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentArrowCorner"}});a.prototype._dressupFamily="Markups";return a});define("DS/VCXWebDressup/VCXArrowNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D"],function(f,b,e,a,d){var c=f.extend({init:function(g){this._parent(g);this._Node=null;this._verticesNb=null;this._trianglesIndicesNb=null;this._lineIndicesNb=null;return this},_Build:function(){var w=0,t=0,r=0,u=0;this._verticesNb=(2*this._step)+8;this._lineIndicesNb=this._verticesNb*2;var g=(2*this._step)+6;this._trianglesIndicesNb=3*g;this._bkGrndPrimGrp=new e.PrimitiveGroup({editable:true});this._borderPrimGrp=new e.PrimitiveGroup({editable:true});var k=new e.Buffer({component:e.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3});var l=new e.Buffer({component:e.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4});var s=new e.Buffer({indexBuffer:true,data:new Uint16Array(this._trianglesIndicesNb)});var n=new e.Buffer({component:e.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3});var A=new e.Buffer({component:e.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4});var x=new e.Buffer({indexBuffer:true,data:new Uint16Array(this._lineIndicesNb)});this._bkGrndPrimGrp.addBuffer(0,k);this._bkGrndPrimGrp.addBuffer(1,l);this._bkGrndPrimGrp.addBuffer(2,s);this._borderPrimGrp.addBuffer(0,n);this._borderPrimGrp.addBuffer(1,A);this._borderPrimGrp.addBuffer(2,x);var h=s.data;h[w++]=0;h[w++]=1;h[w++]=2;h[w++]=0;h[w++]=2;h[w++]=2*this._step+6;h[w++]=0;h[w++]=2*this._step+6;h[w++]=2*this._step+7;for(t=2;t<this._step+2;++t){r=t+1;u=this._verticesNb-t;h[w++]=t;h[w++]=r;h[w++]=u;h[w++]=u;h[w++]=r;h[w++]=u-1}h[w++]=this._step+2;h[w++]=this._step+3;h[w++]=this._step+4;h[w++]=this._step+2;h[w++]=this._step+4;h[w++]=this._step+6;h[w++]=this._step+6;h[w++]=this._step+4;h[w++]=this._step+5;h=x.data;for(w=0,t=0;t<this._verticesNb;t++){h[w++]=t;h[w++]=(t===this._verticesNb-1)?0:t+1}var m=new e.Primitive({nbIndices:this._trianglesIndicesNb,connectivity:e.ConnectivityTypeEnum.TRIANGLES});var y=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new e.IndexArray({bufferId:2,offset:0})});var v=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new e.IndexArray({bufferId:2,offset:0})});m.addVertexComponent(y);m.addVertexComponent(v);this._bkGrndPrimGrp.addPrimitive(m);var q=new e.Primitive({nbIndices:this._lineIndicesNb,connectivity:e.ConnectivityTypeEnum.LINES,geomType:"WIRE_EDGE"});var o=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new e.IndexArray({bufferId:2,offset:0})});var p=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new e.IndexArray({bufferId:2,offset:0})});q.addVertexComponent(o);q.addVertexComponent(p);this._borderPrimGrp.addPrimitive(q);this._bodyMat=new b.MeshBasicMaterial({side:b.DoubleSide,vertexColors:b.VertexColors,color:"#ffffff",transparent:true,opacity:1,force:true});var z=this.Modifiable.getLineMaterialParams("Collab.Border.Line",this._lineMat,this._lastFrontLineType);if(Object.keys(z).length>0){if(typeof z.type==="number"&&z.type!==this._lastFrontLineType){this._lastFrontLineType=z.type}this._lineMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(z,this._lineMat)}this._NodeBkGrnd=a.createMeshNode(this._bkGrndPrimGrp);this._NodeBkGrnd.setMaterial(this._bodyMat);this._NodeBkGrnd.setVisibilityInTree(false);this._NodeBorder=a.createMeshNode(this._borderPrimGrp);this._NodeBorder.setMaterial(this._lineMat);this._NodeBorder.setVisibilityInTree(false);this._Node=new d();this._Node.setVisibilityInTree(true);this._Node.addChild(this._NodeBkGrnd);this._Node.addChild(this._NodeBorder);this.addChild(this._Node);this.traverse(function(i){if(i.setFrustumCulled){i.setFrustumCulled(false)}if(i.setShadow){i.setShadow(false,false)}if(i.setMirror){i.setMirror(false)}if(i.setPickParent){i.setPickParent(true)}return false},true);this.setPickParent(false)},preRender:function(g){this._parent(g);this._updateNodeBuffers(g,true)},update:function(){this._parent();this.handleLayers()},_updateArrowMaterialsParameters:function(){if(!this._Node){return}if(this._bodyMat){this._bodyMat.opacity=this._globalOpacity}if(this.GetPropertyGroupVisibility("Group.Border")){var g=this.Modifiable.getLineMaterialParams("Collab.Border.Line",this._lineMat,this._lastFrontLineType,this._globalOpacity);if(Object.keys(g).length>0){if(typeof g.type==="number"&&g.type!==this._lastFrontLineType){this._lastFrontLineType=g.type}this._lineMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(g,this._lineMat)}if(!this._NodeBorder.material||(this._lineMat&&this._NodeBorder.material.id!==this._lineMat.id)){this._NodeBorder.setMaterial(this._lineMat)}}else{this._lineMat.opacity=0;this._lineMat.setLineWidth(0)}},_updateNodeBuffers:function(o,k){var h=this.Modifiable.GetObject().IsKindOf("VCXComponentArrowLinear")||this.Modifiable.GetPropertyValue("Collab.Is.Paper")===true||this.Modifiable.GetPropertyValue("Arrow.Circular.Flat")===2;var j=(k&&h)||(!k&&!h);if(j&&this._NodeBkGrnd&&this._NodeBorder){var g=this._NodeBkGrnd.getBuffer(e.VertexComponentEnum.POSITION);var n=this._NodeBkGrnd.getBuffer(e.VertexComponentEnum.DIFFUSE_COLOR);var l=this._NodeBorder.getBuffer(e.VertexComponentEnum.POSITION);var i=this._NodeBorder.getBuffer(e.VertexComponentEnum.DIFFUSE_COLOR);if(typeof g!=="undefined"&&typeof n!=="undefined"&&typeof l!=="undefined"&&typeof i!=="undefined"){var m=this._ComputePosBuffer(o,g,n,l,i);this._NodeBkGrnd.updateBuffer(e.VertexComponentEnum.POSITION,0,m);this._NodeBkGrnd.updateBuffer(e.VertexComponentEnum.DIFFUSE_COLOR,0,m);this._NodeBkGrnd.computeBoundingElements();this._NodeBorder.updateBuffer(e.VertexComponentEnum.POSITION,0,m);this._NodeBorder.updateBuffer(e.VertexComponentEnum.DIFFUSE_COLOR,0,m);this._NodeBorder.computeBoundingElements()}}},_updateNodePositionFromAnchor:function(){if(!this.GetAnchorWorldMatrix(1,null)){var g=this.GetAnchorWorldMatrix(0,null);if(!g){console.warn("No matrix has been found for arrow's anchor.0 position...");g=new b.Matrix4()}this.setMatrix(g)}else{console.log("This arrow has another anchor.. may be the one determining the position")}},_fillColorBuffer:function(s,l){var o=0,i=0;var j=this.GetColorPropertyValue("Arrow.Body");var h=this.GetColorPropertyValue("Arrow.Body.2");var g=j.GetRGBA();var m=h.GetRGBA();var r=this.GetColorPropertyValue("Collab.Border.Line");var p=this.GetColorPropertyValue("Collab.Border.Line.2");var v=r.GetRGBA();var k=p.GetRGBA();var q=4;var u=0;for(i=this._verticesNb-2;i!==3;i=++i%this._verticesNb){o=i*q;for(u=0;u<q;o++,u++){s[o]=m[u];l[o]=k[u]}}for(i=3;i<this._step+2;++i){var t=h.Clone().Lerp(j,(i-2)/this._step);var n=p.Clone().Lerp(r,(i-2)/this._step);o=i*q;s[o+0]=t.r;s[o+1]=t.g;s[o+2]=t.b;s[o+3]=t.a;l[o+0]=n.r;l[o+1]=n.g;l[o+2]=n.b;l[o+3]=n.a;o=(this._verticesNb-i)*q;s[o+0]=t.r;s[o+1]=t.g;s[o+2]=t.b;s[o+3]=t.a;l[o+0]=n.r;l[o+1]=n.g;l[o+2]=n.b;l[o+3]=n.a}for(i=this._step+2;i<=this._step+6;++i){o=i*q;for(u=0;u<q;o++,u++){s[o]=g[u];l[o]=v[u]}}}});return c});define("DS/VCXWebDressup/VCXArrowSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder"],function(a){var b=a.extend({init:function(){},});return b});define("DS/VCXWebDressup/VCXPolylineNode",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory"],function(g,e,d,b,c,a){var f=d.extend({init:function(h){this._parent(h);return this},_getPosVectArray:function(){var h=[];var i=0;var k=this;if(!(this.Modifiable._Anchors&&Object.keys(this.Modifiable._Anchors).length>0)){console.log("No point");return}this.Modifiable.processAnchorsIDs(function(n){var m=k.GetAnchorWorldMatrix(n);if(m){var l=new b.Vector3(0,0,0);l.getPositionFromMatrix(m);h[i++]=l}});var j=i+1;if(this._currentPointsNumber!==j){return -1}if(this.GetPropertyValue("Polyline.Is.Closed")){h[j-1]=h[0].clone()}else{h[j-1]=h[j-2].clone()}return h},_ComputePosBuffer:function(j){if(this._currentPointsNumber!==this._getCurrentPointsNumber()){return -1}var k=this._getPosVectArray();if(!(Array.isArray(k)&&k.length>0)){return k}var l=k.length;for(var h=0;h<l;h++){j[3*h+0]=k[h].x;j[3*h+1]=k[h].y;j[3*h+2]=k[h].z}return l},_Build:function(){var p=this.Modifiable.getAnchorsCount();if(p===0){console.log("No point");return}this._currentPointsNumber=this._getCurrentPointsNumber();var h=this._getPosVectArray();if(!Array.isArray(h)||h.length<2){console.log("Can't build the polyline");return}var n=this._currentPointsNumber-1;var j=n*2;var q=new Uint16Array(j);for(var l=0;l<n;++l){q[l*2+0]=l;q[l*2+1]=l+1}var m=!this.Modifiable.GetPropertyValue("Actor.IsAlwaysOnTop")&&this.Modifiable.GetPropertyValue("Collab.Body.Line.UseHiddenStyle");if(m){var k=this.Modifiable.getLineMaterialParams("Collab.Body.Line.Back",this._lineBackMaterial,this._lastBackLineType);if(Object.keys(k).length>0){if(typeof k.type==="number"&&k.type!==this._lastBackLineType){this._lastBackLineType=k.type}this._lineBackMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(k,this._lineBackMaterial);k.backMaterial=this._lineBackMaterial}}else{if(this._lineBackMaterial&&this._lineBackMaterial.opacity!==0){this._lineBackMaterial=materialManager.getLineMaterialFromParams({opacity:0},this._lineBackMaterial)}}var r=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._lineMaterial,this._lastFrontLineType);if(Object.keys(r).length>0){if(typeof r.type==="number"&&r.type!==this._lastFrontLineType){this._lastFrontLineType=r.type}if(this._lineBackMaterial){r.backMaterial=this._lineBackMaterial}this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(r,this._lineMaterial)}var o={points:h,idx:q,editable:true,drawMode:c.ConnectivityTypeEnum.LINES,material:this._lineMaterial};this._Node=a.createLineNode(o);this._Node.setVisibilityInTree(false);this.add(this._Node)},update:function(i){this._parent();if(this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var o=(this._globalOpacity>0);if(o){if(!this._Node){this._Build()}}if(this._Node){this._Node.setVisibility(o)}}if(this._globalOpacity<=0){return}if(this._Node){var m=this._Node.getBuffer(c.VertexComponentEnum.POSITION);if(m!==undefined){var k=this._ComputePosBuffer(m);if(k===-1){this.remove(this._Node);this._Node=null;this._Build()}else{if(typeof k==="number"){this._Node.updateBuffer(c.VertexComponentEnum.POSITION,0,k);this._Node.computeBoundingElements()}}}var l=this.ExperienceBase.getManager("VCXMaterialManager");var j=!this.Modifiable.GetPropertyValue("Actor.IsAlwaysOnTop")&&this.Modifiable.GetPropertyValue("Collab.Body.Line.UseHiddenStyle");if(j){var h=this.Modifiable.getLineMaterialParams("Collab.Body.Line.Back",this._lineBackMaterial,this._lastBackLineType,this._globalOpacity);if(Object.keys(h).length>0){if(typeof h.type==="number"&&h.type!==this._lastBackLineType){this._lastBackLineType=h.type}this._lineBackMaterial=l.getLineMaterialFromParams(h,this._lineBackMaterial);h.backMaterial=this._lineBackMaterial}}else{if(this._lineBackMaterial&&this._lineBackMaterial.opacity!==0){this._lineBackMaterial=l.getLineMaterialFromParams({opacity:0},this._lineBackMaterial)}}var n=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._lineMaterial,this._lastFrontLineType,this._globalOpacity);if(n&&n.type){if(typeof n.type==="number"&&n.type!==this._lastFrontLineType){this._lastFrontLineType=n.type}}if(this._lineBackMaterial&&!(this._lineMaterial&&this._lineMaterial.backMaterial===this._lineBackMaterial)){n.backMaterial=this._lineBackMaterial}if(Object.keys(n).length>0){this._lineMaterial=l.getLineMaterialFromParams(n,this._lineMaterial)}if(this._Node&&(!this._Node.material||(this._lineMaterial&&this._Node.material.id!==this._lineMaterial.id))){this._Node.setMaterial(this._lineMaterial)}this.handleLayers()}},isNodeBuilt:function(){return Boolean(this._Node)},_getCurrentPointsNumber:function(){var h=this.Modifiable.getAnchorsCount();return h+1}});return f});define("DS/VCXWebDressup/VCXPolylineSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPolylineNode"],function(a,c){var b=a.extend({init:function(){},getWorldMatrix:function(g){var e=this.GetObject()._experienceBase.getManager("VCXContextManager");var f=this.GetObject().getWorkingRootPathElement();var d=f.getWorldMatrix(e.getMainViewer());var h=this.QueryInterface("VCXIModifiable");if(h){this._actorPosition=h.GetFramePropertyValue("Actor.Position");if(this._actorPosition){d.multiply(this._actorPosition)}return d}},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Polyline",modifiable:d,};this._sgNode=new c(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_PolylineLeaf.png")}return this._parent()},});return b});define("DS/VCXWebDressup/VCXAttachSegmentNode",["DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXExtremityNode","DS/VCXWebKernelTools/VCXMathTools","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS"],function(c,j,g,h,i,b,f,d,e){var a=i.extend({init:function(k){this._parent(k);this.anchorID=k.anchorID;this._StartExtremity=new e.Vector3();this._BreakExtremity=new e.Vector3();this._EndExtremity=new e.Vector3();this._EndExtremityType=j.EExtremityType.Dot;if(k&&typeof k.endExtremityType==="number"){this._EndExtremityType=k.endExtremityType}return this},_ComputePosBuffer:function(k){k[0]=this.StartExtremity.x;k[1]=this.StartExtremity.y;k[2]=this.StartExtremity.z;k[3]=this.BreakExtremity.x;k[4]=this.BreakExtremity.y;k[5]=this.BreakExtremity.z;k[6]=this.EndExtremity.x;k[7]=this.EndExtremity.y;k[8]=this.EndExtremity.z;return 3},dispose:function(){if(this._Node){this.removeChild(this._Node)}if(this._ExtremityNode){this._ExtremityNode.dispose();this.removeChild(this._ExtremityNode)}if(this._ExtremityStart){this._ExtremityStart.dispose();this.removeChild(this._ExtremityStart)}if(this._ExtremityBreak){this._ExtremityBreak.dispose();this.removeChild(this._ExtremityBreak)}this._parent()},_Build:function(){var l=3,s=0,r=1;this._PrimitiveGroup=new c.PrimitiveGroup({editable:true,lineGAS:new c.LineAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor(),this.GetPropertyValue("Collab.Attach.Line.Width"))});var o=new c.Buffer({component:c.VertexComponentEnum.POSITION,data:new Float32Array(3*l),dimension:3});var p=new c.Buffer({indexBuffer:true,data:new Uint16Array(4)});this._PrimitiveGroup.addBuffer(s,o);this._PrimitiveGroup.addBuffer(r,p);this._ComputePosBuffer(o.data);var n=p.data;n[0]=0;n[1]=1;n[2]=1;n[3]=2;var q=new c.VertexComponent({bufferId:s,indices:new c.IndexArray({bufferId:r,offset:0})});var k=new c.Primitive({nbIndices:4,connectivity:c.ConnectivityTypeEnum.LINES,geomType:"WIRE_EDGE",fillGAS:new c.FillAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor()),lineGAS:new c.LineAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor(),this.GetPropertyValue("Collab.Attach.Line.Width"))});k.addVertexComponent(q);this._PrimitiveGroup.addPrimitive(k);var t=this.Modifiable.getLineMaterialParams("Collab.Attach.Line",this._lineMaterial,this._lastFrontLineType);if(Object.keys(t).length>0){if(typeof t.type==="number"&&t.type!==this._lastFrontLineType){this._lastFrontLineType=t.type}this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(t,this._lineMaterial)}this._Node=d.createMeshNode(this._PrimitiveGroup,this._lineMaterial);this._Node.setMirror&&this._Node.setMirror(false);this._Node.setFrustumCulled&&this._Node.setFrustumCulled(false);this._Node.setShadow&&this._Node.setShadow(false,false);this.add(this._Node);if(this.GetPropertyValue("Collab.Attach.BentDot")){var m={name:this.name+" ExtremityBreak",experience:this.ExperienceBase,modifiable:this.Modifiable,anchorID:this.anchorID,type:j.EExtremityType.Dot};this._ExtremityBreak=new b(m);this.add(this._ExtremityBreak)}this.RecursiveSetPickParent(true);this.handleLayers(true)},preRender:function(k){if(this._Node){var n=this._Node.getBuffer(c.VertexComponentEnum.POSITION);if(n!==undefined){var l=this._ComputePosBuffer(n);this._Node.updateBuffer(c.VertexComponentEnum.POSITION,0,l);this._Node.computeBoundingElements()}}if(this._ExtremityNode){var m=new e.Vector3().subVectors(this.EndExtremity,this.BreakExtremity);this._ExtremityNode.SetReferential(f.getMatrixFromOVx(this.EndExtremity,m));this._ExtremityNode.preRender(k)}if(this._ExtremityStart){var m=new e.Vector3().subVectors(this.BreakExtremity,this.StartExtremity);this._ExtremityStart.SetReferential(f.getMatrixFromOVx(this.StartExtremity,m));this._ExtremityStart.preRender(k)}if(this._ExtremityBreak){var m=new e.Vector3().subVectors(this.BreakExtremity,this.StartExtremity);this._ExtremityBreak.SetReferential(f.getMatrixFromOVx(this.BreakExtremity,m));this._ExtremityBreak.preRender(k)}},update:function(l){this._parent();if(this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var n=(this._globalOpacity>0);if(n){if(!this._Node){this._Build()}}if(this._Node){this._Node.setVisibility(n)}if(this._ExtremityNode){this._ExtremityNode.setVisibility(n)}if(this._ExtremityBreak){this._ExtremityBreak.setVisibility(n)}if(this._ExtremityEnd){this._ExtremityEnd.setVisibility(n)}}if(this._globalOpacity<=0){return}this._EndExtremityType=this.GetPropertyValue("Collab.Attach.ExtremityType");if(this._previousEndExtremityType!==this._EndExtremityType){this._previousEndExtremityType=this._EndExtremityType;this.remove(this._ExtremityNode);this._ExtremityNode=null;if(this._EndExtremityType){var m={name:this.name+" Extremity",modifiable:this.Modifiable,anchorID:this.anchorID,type:this._EndExtremityType};this._ExtremityNode=new b(m);this.add(this._ExtremityNode);this.RecursiveSetPickParent(true);this.handleLayers(true)}}if(this._ExtremityNode){this._ExtremityNode.update(l)}if(this._ExtremityStart){this._ExtremityStart.update(l)}if(this._ExtremityBreak){this._ExtremityBreak.update(l)}if(this._Node){var k=this.Modifiable.getLineMaterialParams("Collab.Attach.Line",this._lineMaterial,this._lastFrontLineType,this._globalOpacity);if(Object.keys(k).length>0){if(typeof k.type==="number"&&k.type!==this._lastFrontLineType){this._lastFrontLineType=k.type}this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(k,this._lineMaterial)}if(!this._Node.material||(this._lineMaterial&&this._Node.material.id!==this._lineMaterial.id)){this._Node.setMaterial(this._lineMaterial)}this.handleLayers()}},postUpdate:function(k){this._parent();if(this._ExtremityNode){this._ExtremityNode.postUpdate(k)}if(this._ExtremityStart){this._ExtremityStart.postUpdate(k)}if(this._ExtremityBreak){this._ExtremityBreak.postUpdate(k)}}});Object.defineProperty(a.prototype,"StartExtremity",{enumerable:true,get:function(){return this._StartExtremity},set:function(k){this._StartExtremity=k}});Object.defineProperty(a.prototype,"BreakExtremity",{enumerable:true,get:function(){return this._BreakExtremity},set:function(k){this._BreakExtremity=k}});Object.defineProperty(a.prototype,"EndExtremity",{enumerable:true,get:function(){return this._EndExtremity},set:function(k){this._EndExtremity=k}});Object.defineProperty(a.prototype,"EndExtremityType",{enumerable:true,get:function(){return this._EndExtremityType},set:function(k){this._EndExtremityType=k}});return a});define("DS/VCXWebDressup/VCXPathNode",["DS/CoreEvents/Events","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXComponentPath","DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebDressup/VCXPolylineNode","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory"],function(a,h,i,j,f,c,g,b,e){var d=f.extend({init:function(k){this._parent(k);return this},_getPathFirstVertexPos:function(){return this.Modifiable.getPositionOfFirstAnchor()},_getPathLastVertexPos:function(){return this.Modifiable.getPositionOfLastAnchor()},_getAssyCurrentFrameInWCS:function(){return this.GetFramePropertyValue("Actor.Position")},_getPathAxisPositions:function(){var s=[];var w=this._getPathFirstVertexPos();var n=this._getPathLastVertexPos();var o=new g.Vector3().subVectors(n,w);var r=this.GetPropertyValue("Collab.Path.AxesOrder");var t=i.EAxesOrderArray[r];var u=false;var k=new g.Vector3();switch(this.GetPropertyValue("Collab.Path.ConstructMode")){case i.EConstructMode.PathXYZWorld:var v=new g.Vector3().copy(w);s.push(v);for(var l=0,m="";l<3;++l){v=new g.Vector3().copy(v);m=t[l];if(Math.abs(o[m])>0.00001){if((!u)){v[m]+=o[m]*0.5;u=true}else{v[m]=n[m]}}s.push(v)}if(u){s.push(n)}else{v=new g.Vector3().copy(v);s.push(v)}break;case i.EConstructMode.PathXYZLocal:var q={x:new g.Vector3(),y:new g.Vector3(),z:new g.Vector3()};this._getAssyCurrentFrameInWCS().extractBasis(q.x,q.y,q.z);var p={x:o.dot(q.x),y:o.dot(q.y),z:o.dot(q.z)};var v=new g.Vector3().copy(w);s.push(v);for(var l=0,m="";l<3;++l){v=new g.Vector3().copy(v);m=t[l];if(Math.abs(p[m])>0.00001){k.copy(q[m]).multiplyScalar(p[m]);if(!u){k.multiplyScalar(0.5);u=true}v.add(k)}s.push(v)}if(u){s.push(n)}else{v=new g.Vector3().copy(v);s.push(v)}break;default:break}return s},_getPosVectArray:function(){var k=[];var l=0;var m=this;if(!(this.Modifiable._Anchors&&Object.keys(this.Modifiable._Anchors).length>=2)){console.log("Not enough anchors");return}if(this.GetPropertyValue("Collab.Path.ConstructMode")===i.EConstructMode.PathClassic){this.Modifiable.processAnchorsIDs(function(p){var o=m.GetAnchorWorldMatrix(p);if(o){var n=new g.Vector3(0,0,0);n.getPositionFromMatrix(o);k[l++]=n}})}else{k=this._getPathAxisPositions(this._linkedModifiable)}return k},_getCurrentPointsNumber:function(){if(this.GetPropertyValue("Collab.Path.ConstructMode")===i.EConstructMode.PathClassic){return this._getPtsNbForPathClassicFromAnimation()}else{return 5}},_getPtsNbForPathClassicFromAnimation:function(){return this.Modifiable.getAnchorsCount()}});return d});define("DS/VCXWebDressup/VCXPathSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPathNode"],function(a,b){var c=a.extend({init:function(){},getWorldMatrix:function(g){var e=this.GetObject()._experienceBase.getManager("VCXContextManager");var f=this.GetObject().getWorkingRootPathElement();var d=f.getWorldMatrix(e.getMainViewer());var h=this.QueryInterface("VCXIModifiable");if(h){this._actorPosition=h.GetFramePropertyValue("Actor.Position");if(this._actorPosition){d.multiply(this._actorPosition)}return d}},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Path",modifiable:d,};this._sgNode=new b(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_AnimationPathLeaf.png")}return this._parent()},});return c});define("DS/VCXWebDressup/VCXGroundNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/Node3D"],function(b,a){var c=b.extend({init:function(d){this._parent(d);return this},preRender:function(d){this._parent(d)},update:function(e){this._parent();if(this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var g=(this._globalOpacity>0);if(g){if(!this._MeshNode){this._MeshNode=new a()}}this.setVisibility(g);var d=this.Modifiable.ExperienceBase.getManager("VCXContextManager");var f={};f.displayPlane=false;f.displayGrid=false;f.planeMirror=false;f.groundShadow=false;f.planeBorder=false;d.applyToViewers(function(h){h.setGroundOptions({displayGrid:true});h.setGroundOptions(f)})}if(this._globalOpacity<=0){return}var f={};f.displayPlane=true;f.planeColor=this.GetColorPropertyValue("Environment.Ground").GetHex();f.gridColor=this.GetColorPropertyValue("Environment.Ground.Grid").GetHex();f.displayGrid=this.GetPropertyGroupVisibility("Group.Environment.Ground.Grid");f.gridFalloff=this.GetPropertyValue("Environment.Ground.Grid.Falloff");f.displayGridFromBelow=true;f.gridNbSteps=10;f.planeMirror=this.GetPropertyGroupVisibility("Group.Environment.Ground.Mirror");f.blurryMirror=this.GetPropertyValue("Environment.Ground.Mirror.Blurry");f.groundShadow=this.GetPropertyGroupVisibility("Group.Environment.Ground.Shadows");f.planeBorder=this.GetPropertyGroupVisibility("Group.Environment.Ground.Border");f.planeBorderColor=this.GetColorPropertyValue("Environment.Ground.Border").GetHex();if(f.planeBorder){f.planeFalloff=1-this.GetPropertyValue("Environment.Ground.FallOff")}else{f.planeFalloff=this.GetPropertyValue("Environment.Ground.FallOff")}var d=this.Modifiable.ExperienceBase.getManager("VCXContextManager");d.applyToViewers(function(h){h.setGroundOptions(f)});this.Modifiable.GetObject().updatePosition()}});return c});define("DS/VCXWebDressup/VCXGroundSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXGroundNode"],function(a,c){var b=a.extend({init:function(){},getWorldMatrix:function(d){var e=this.QueryInterface("VCXIModifiable");if(e){return e.GetFramePropertyValue("Actor.Position")}},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Ground",modifiable:d,};this._sgNode=new c(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_GroundLeaf.png")}return this._parent()},});return b});define("DS/VCXWebDressup/VCXArrowCornerNode",["DS/VCXWebDressup/VCXArrowNode","DS/Visualization/ThreeJS_DS",],function(c,b){var a=c.extend({init:function(d){this._parent(d)},_ComputePosBuffer:function(j,z,s,w,i){var h=this.GetAnchorWorldMatrix(0,j);if((typeof h==="undefined")||(h===null)){console.error("anchorMatrix is null or undefined for circular arrow: ",this.Modifiable.GetObject());return}var g=new b.Vector3().getPositionFromMatrix(h);var k=1;if(this.GetPropertyValue("Collab.Is.Paper")){k=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(j,g);k*=this.GetPropertyValue("Arrow.Scale")}var x=this.GetPropertyValue("Arrow.Width.1")*k;var y=0;var A=0;var q=0;if(this.GetPropertyValue("Arrow.Head.ShowMode")){y=this.GetPropertyValue("Arrow.Head.Length")*k;A=this.GetPropertyValue("Arrow.Head.Size")*k;q=this.GetPropertyValue("Arrow.Head.Shape")*k}var u=this.GetPropertyValue("Arrow.Width.2")*k;var v=0;var m=0;var t=0;if(this.GetPropertyValue("Arrow.Head.2.ShowMode")){v=this.GetPropertyValue("Arrow.Head.2.Length")*k;m=this.GetPropertyValue("Arrow.Head.2.Size")*k;t=this.GetPropertyValue("Arrow.Head.2.Shape")*k}var e=this.GetPropertyValue("Arrow.Corner.Length.1")*k;var d=this.GetPropertyValue("Arrow.Corner.Length.2")*k;var p=x/2,o=u/2;var f=[],n=0;f[n*2+0]=v;f[n*2+1]=0;++n;f[n*2+0]=0;f[n*2+1]=-(u/2+m);++n;f[n*2+0]=-t;f[n*2+1]=-u/2;++n;f[n*2+0]=-p;f[n*2+1]=-o;++n;f[n*2+0]=-x/2;f[n*2+1]=-q;++n;f[n*2+0]=-(x/2+A);f[n*2+1]=0;++n;f[n*2+0]=0;f[n*2+1]=y;++n;f[n*2+0]=-f[10];f[n*2+1]=f[11];++n;f[n*2+0]=-f[8];f[n*2+1]=f[9];++n;f[n*2+0]=-f[6];f[n*2+1]=-f[7];++n;f[n*2+0]=f[4];f[n*2+1]=-f[5];++n;f[n*2+0]=f[2];f[n*2+1]=-f[3];++n;var l=new b.Vector3();for(n=0;n<this._verticesNb;n++){var r=(n+2)%this._verticesNb;if(r<5){l.set(d,0,0)}else{if(r>5&&r<11){l.set(0,e,0)}else{l.set(0,0,0)}}z[n*3+0]=l.x+f[n*2+0];z[n*3+1]=l.y+f[n*2+1];z[n*3+2]=l.z;w[n*3+0]=l.x+f[n*2+0];w[n*3+1]=l.y+f[n*2+1];w[n*3+2]=l.z}this._fillColorBuffer(s,i);return this._verticesNb},preRender:function(d){this._parent(d)},update:function(d){this._parent();if(!this._step){this._step=2}this._updateNodePresence();this._updateNodeBuffers(d,false);this._updateNodePositionFromAnchor();if(this._globalOpacity<=0){return}if(this._Node){this._updateArrowMaterialsParameters();this.handleLayers()}},_updateNodePresence:function(){if((!this._Node&&this.GlobalOpacity>0)||this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var d=(this._globalOpacity>0);if(d&&!this._Node){this._Build()}if(this._Node){this._Node.setVisibility(d)}}},});return a});define("DS/VCXWebDressup/VCXArrowCornerSGNodeHolder",["DS/VCXWebDressup/VCXArrowSGNodeHolder","DS/VCXWebDressup/VCXArrowCornerNode"],function(c,a){var b=c.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Arrow Corner",modifiable:d,};this._sgNode=new a(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ArrowCircular.png")}return this._parent()},});return b});define("DS/VCXWebDressup/VCXCircleNode",["DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebVisualization/VCXInteractor","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory"],function(e,h,a,c,f,g,d){var b=h.extend({_circleSubdivision:64,init:function(j){this._parent(j);this._verticesNb=2*(this._circleSubdivision);var i=this._circleSubdivision*2;this._trianglesIndicesNb=3*i;this._lineIndicesNb=this._circleSubdivision*2;return this},_getPosVectArray:function(){var o=[];var i=2*Math.PI/this._circleSubdivision;for(var k=0;k<this._circleSubdivision;++k){var j=k*i;var l=new f.Vector3(Math.cos(j),Math.sin(j),0);o.push(l)}if(this.GetPropertyValue("Circle.Background.Type")===2){for(k=this._circleSubdivision;k<this._verticesNb;++k){o.push(new f.Vector3(0,0,0))}}else{if(this.GetPropertyValue("Circle.Background.Type")===1){var n=(100-this.GetPropertyValue("Circle.Thickness"))/100;for(k=this._circleSubdivision;k<this._verticesNb;++k){var j=k*i;var m=new f.Vector3(n*Math.cos(j),n*Math.sin(j),0);o.push(m)}}}return o},_computePosBuffer:function(k){var j=3;var l=this._getPosVectArray();for(var i=0;i<l.length;++i){k[j*i+0]=l[i].x;k[j*i+1]=l[i].y;k[j*i+2]=l[i].z}},_computeColorBuffers:function(o){var k=0;var j=4;var n=this.GetColorPropertyValue("Collab.Background");if(this.GetPropertyValue("Circle.Background.Type")===0){n.a=0}var i=n.Clone();if(this.GetPropertyValue("Circle.Background.Type")!==2){i.a=0}var m=n.GetRGBA();var l=i.GetRGBA();for(k=0;k<this._circleSubdivision;++k){o[k*j+0]=m[0];o[k*j+1]=m[1];o[k*j+2]=m[2];o[k*j+3]=m[3]}for(k=this._verticesNb/2;k<this._verticesNb;++k){o[k*j+0]=l[0];o[k*j+1]=l[1];o[k*j+2]=l[2];o[k*j+3]=l[3]}},_ComputeBuffers:function(i,j){this._computePosBuffer(i);this._computeColorBuffers(j);return this._verticesNb},dispose:function(){if(this._Smart3DPaperNode){this._Smart3DPaperNode.dispose();this._Smart3DPaperNode=null}this._parent()},_Build:function(){var t=0;var o=1;var H=2;this._PrimitiveGroup=new g.PrimitiveGroup({editable:true});var s=new g.Buffer({component:g.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3});var y=new g.Buffer({component:g.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4});var i=new g.Buffer({indexBuffer:true,data:new Uint16Array(this._trianglesIndicesNb+this._lineIndicesNb)});this._PrimitiveGroup.addBuffer(t,s);this._PrimitiveGroup.addBuffer(o,y);this._PrimitiveGroup.addBuffer(H,i);var k=i.data;var D=0,C=0,z=0;for(D=0,C=1;D<this._circleSubdivision;++D,++C){if(C===this._circleSubdivision){C=0}k[z++]=D;k[z++]=C;k[z++]=this._circleSubdivision+D;k[z++]=this._circleSubdivision+D;k[z++]=C;k[z++]=this._circleSubdivision+C}for(D=0;D<this._circleSubdivision;++D){k[z++]=D;k[z++]=(D===this._circleSubdivision-1)?0:D+1}var n=new g.Primitive({nbIndices:this._trianglesIndicesNb,connectivity:g.ConnectivityTypeEnum.TRIANGLES});var p=new g.VertexComponent({bufferId:t,indices:new g.IndexArray({bufferId:H,offset:0})});var w=new g.VertexComponent({bufferId:o,indices:new g.IndexArray({bufferId:H,offset:0})});n.addVertexComponent(p);n.addVertexComponent(w);this._PrimitiveGroup.addPrimitive(n);var F=new g.Primitive({nbIndices:this._lineIndicesNb,connectivity:g.ConnectivityTypeEnum.LINES,geomType:"WIRE_EDGE"});var r=new g.VertexComponent({bufferId:t,indices:new g.IndexArray({bufferId:H,offset:this._trianglesIndicesNb})});F.addVertexComponent(r);this._PrimitiveGroup.addPrimitive(F);this._bodyMat=new f.MeshBasicMaterial({side:f.DoubleSide,vertexColors:f.VertexColors,color:"#ffffff",transparent:true,opacity:1,force:true});var I=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._bodyMat.line,this._lastFrontLineType);I.polygonOffset=true;I.polygonOffsetFactor=1;I.polygonOffsetUnits=-2;if(Object.keys(I).length>0){if(typeof I.type==="number"&&I.type!==this._lastFrontLineType){this._lastFrontLineType=I.type}this._bodyMat.line=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(I,this._bodyMat.line)}var B=new f.Vector3(0,0,0);var v=this.GetAnchorWorldMatrix(0,null);if(v){B.getPositionFromMatrix(v)}else{console.log("centerMatrix is null or undefined...")}var A=new f.Quaternion().setFromRotationMatrix(v);var x=new f.Matrix4().compose(B,A,new f.Vector3(1,1,1));this._MeshNode=d.createMeshNode(this._PrimitiveGroup);this._MeshNode.setMaterial(this._bodyMat);this._MeshNode.setVisibilityInTree(false);this._MeshNode.setMatrix(x);this._hlMeshNode=d.createCircleNode({radius:1,segments:this._circleSubdivision,fill:true,color:new g.Color(0,0,0,0),noEdge:true});this._hlMeshNode.setVisibilityInTree(false);this._hlMeshNode.setMatrix(x);this._hlMeshNode.setPickable(g.PICKABLE);var G={name:"CircleSmartNode",modifiable:this.Modifiable,};this._Smart3DPaperNode=new a(G);this._Smart3DPaperNode.add(this._MeshNode);this._Smart3DPaperNode.add(this._hlMeshNode);this.add(this._Smart3DPaperNode);var q=this.Modifiable.QueryInterface("VCXIManipulable");if(q){var u=q.getAllInteractors();var l="Resize Circle";var E=u[l];if(!E){E=new c(this.Modifiable.GetObject());q.addInteractor(l,E);E.node=this._MeshNode;E.id=l;E.constraintReferential=c.EConstraintReferential.Screen;E.visibility=c.EVisibility.OnObjectOver|c.EVisibility.OnObjectSelected|c.EVisibility.OnInteractorOver;E.application=c.EApplication["3DIllustration"]|c.EApplication.CityIllustration;E.manipulatorType=c.EManipulatorType.None;E.cursorManipulate="grabbing";E.cursorPreactivate=function(m,P){var R=m.component;var S=R._experienceBase.getManager("VCXPaperManager");var V=S.getDefaultOptions();var j=P.event.from[0];var N=j.currentPosition;var M=S.PixelToMM2(V,N);var U=R.QueryInterface("VCXIModifiable");var Q=U.GetAnchorWorldMatrix(0,null);var L=S.ModelToMM2(V,new f.Vector3().getPositionFromMatrix(Q));var K=new f.Vector2().subVectors(M,L);var T=Math.atan2(-K.y,K.x);if(T<0){T+=2*Math.PI}T=T%(2*Math.PI);var J="default";if(((15*Math.PI/8)<=T||T<(Math.PI/8))||(7*Math.PI/8)<=T&&T<(9*Math.PI/8)){J="ew-resize"}else{if((Math.PI/8)<=T&&T<(3*Math.PI/8)||(9*Math.PI/8)<=T&&T<(11*Math.PI/8)){J="nesw-resize"}else{if((3*Math.PI/8)<=T&&T<(5*Math.PI/8)||(11*Math.PI/8)<=T&&T<(13*Math.PI/8)){J="ns-resize"}else{if((5*Math.PI/8)<=T&&T<(7*Math.PI/8)||(13*Math.PI/8)<=T&&T<(15*Math.PI/8)){J="nwse-resize"}}}}var O=T*360*0.5/Math.PI;return J}}}this.traverse(function(m,j){if(m.setFrustumCulled){m.setFrustumCulled(false)}if(m.setShadow){m.setShadow(false,false)}if(m.setMirror){m.setMirror(false)}if(m.setPickParent){m.setPickParent(true)}return false},true);this.setPickParent(false)},preRender:function(i){this._parent(i);if(this._Smart3DPaperNode){this._Smart3DPaperNode.preRender(i)}},update:function(l){this._parent();if(this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var o=(this._globalOpacity>0);if(o){if(!this._Smart3DPaperNode){this._Build()}}if(this._Smart3DPaperNode){this._Smart3DPaperNode.setVisibility(o)}}if(this._globalOpacity<=0){return}if(this._Smart3DPaperNode){this._Smart3DPaperNode.SizeControlType=this.GetPropertyValue("Collab.Is.Paper")?1:0;this._Smart3DPaperNode.update(l);var n=this._MeshNode.getBuffer(g.VertexComponentEnum.POSITION);var p=this._MeshNode.getBuffer(g.VertexComponentEnum.DIFFUSE_COLOR);if(n&&p){var m=this._ComputeBuffers(n,p);this._MeshNode.updateBuffer(g.VertexComponentEnum.POSITION,0,m);this._MeshNode.updateBuffer(g.VertexComponentEnum.DIFFUSE_COLOR,0,m);this._MeshNode.computeBoundingElements()}if(this._Smart3DPaperNode&&this._bodyMat){this._bodyMat.opacity=this._globalOpacity}var i=this.GetPropertyValue("Circle.Radius");i*=this.GetPropertyValue("Circle.Scale");var k=new f.Matrix4().makeScale(i,i,1);this._MeshNode.setMatrix(k);this._hlMeshNode.setMatrix(k);var j=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._bodyMat.line,this._lastFrontLineType,this._globalOpacity);if(Object.keys(j).length>0){if(typeof j.type==="number"&&j.type!==this._lastFrontLineType){this._lastFrontLineType=j.type}this._bodyMat.line=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(j,this._bodyMat.line)}this.handleLayers()}},updateInteractors:function(j){var i=this._ExperienceBase.getManager("VCXContextManager");if(i.getPlayerMode()){return}if(!this.isNodeBuilt()){return}this.updateAnchorsInteractors(j)}});return b});define("DS/VCXWebDressup/VCXCircleSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXCircleNode"],function(b,a){var c=b.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Circle",modifiable:d,};this._sgNode=new a(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Circle.png")}return this._parent()},});return c});define("DS/VCXWebDressup/VCXBackgroundNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXImageManager","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXSmart3DPaperNode"],function(g,d,f,e,b,a){var c=g.extend({init:function(h){this._parent(h);this._previousBackgroundDocID=null;return this},dispose:function(){if(this._Smart3DPaperNode){this._Smart3DPaperNode.dispose();this._Smart3DPaperNode=null}this._parent()},_Build:function(l){var k=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");this.setRenderPasses([k.getRenderList("VCXBackground")]);this._PrimitiveGroup=new e.PrimitiveGroup();this._PrimitiveGroup.editable=true;var p=new e.Buffer({component:e.VertexComponentEnum.POSITION,data:new Float32Array(12)});p.dimension=3;this._PrimitiveGroup.addBuffer(0,p);var q=new e.Buffer({component:e.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(16)});q.dimension=3;this._PrimitiveGroup.addBuffer(1,q);var u=new e.Buffer({component:e.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(16)});u.dimension=4;this._PrimitiveGroup.addBuffer(2,u);var r=new e.Buffer({indexBuffer:true,data:new Uint16Array(6)});this._PrimitiveGroup.addBuffer(3,r);var m;m=p.data;var n=0;m[n++]=0;m[n++]=0;m[n++]=0;m[n++]=1;m[n++]=0;m[n++]=0;m[n++]=1;m[n++]=-1;m[n++]=0;m[n++]=0;m[n++]=-1;m[n++]=0;m=q.data;var n=0;m[n++]=0;m[n++]=1;m[n++]=0;m[n++]=1;m[n++]=1;m[n++]=0;m[n++]=1;m[n++]=0;m[n++]=0;m[n++]=0;m[n++]=0;m[n++]=0;m=r.data;n=0;m[n++]=0;m[n++]=2;m[n++]=1;m[n++]=0;m[n++]=3;m[n++]=2;var t=new e.Primitive({nbIndices:6,connectivity:e.ConnectivityTypeEnum.TRIANGLES,fillGAS:new e.FillAttributes()});var s=new e.VertexComponent({nbVertices:4,bufferId:0,indices:new e.IndexArray({bufferId:3,offset:0})});var o=new e.VertexComponent({nbVertices:4,bufferId:1,indices:new e.IndexArray({bufferId:3,offset:0})});var j=new e.VertexComponent({nbVertices:4,bufferId:2,indices:new e.IndexArray({bufferId:3,offset:0})});t.addVertexComponent(s);t.addVertexComponent(o);t.addVertexComponent(j);this._PrimitiveGroup.addPrimitive(t);this._MeshNode=b.createMeshNode(this._PrimitiveGroup);this.setMaterial();this._MeshNode.setVisibilityInTree(false);var h={name:"BackgroundSmartNode",experience:this.ExperienceBase,};this._Smart3DPaperNode=new a(h);this._Smart3DPaperNode.BillboardType=2;this._Smart3DPaperNode.SizeControlType=1;this._Smart3DPaperNode.PositioningType=1000;this._Smart3DPaperNode.Depth=0;this._Smart3DPaperNode.add(this._MeshNode);this.add(this._Smart3DPaperNode);this.RecursiveSetPickParent(true);this.setPickParent(false);this.traverse(function(v,i){if(v.setPickable){v.setPickable(e.NODRAWHL)}if(v.exludeFromBounding){v.exludeFromBounding(i)}if(v.excludeFromHighlight){v.excludeFromHighlight(i,i)}if(v.setFrustumCulled){v.setFrustumCulled(false)}if(v.setShadow){v.setShadow(false,false)}if(v.setMirror){v.setMirror(false)}return false},true)},_ComputeColorBuffer:function(j,k){var h=0;j[h++]=k.head.r;j[h++]=k.head.g;j[h++]=k.head.b;j[h++]=k.head.a;j[h++]=k.head.r;j[h++]=k.head.g;j[h++]=k.head.b;j[h++]=k.head.a;j[h++]=k.foot.r;j[h++]=k.foot.g;j[h++]=k.foot.b;j[h++]=k.foot.a;j[h++]=k.foot.r;j[h++]=k.foot.g;j[h++]=k.foot.b;j[h++]=k.foot.a;return 4},preRender:function(i){if(this._Smart3DPaperNode){this._Smart3DPaperNode.preRender(i)}if(this.GetPropertyValue("Environment.Background.Gradient")){if(this._MeshNode){var h=this.Modifiable.GetObject().getColors(i.viewpoint);var k=this._MeshNode.getBuffer(e.VertexComponentEnum.DIFFUSE_COLOR);if(k!==undefined){var j=this._ComputeColorBuffer(k,h);this._MeshNode.updateBuffer(e.VertexComponentEnum.DIFFUSE_COLOR,0,j)}}}},setMaterial:function(h){if(!this._bodyMat){this._bodyMat=new d.MeshBasicMaterial({side:d.FrontSide,forceSide:true,vertexColors:d.VertexColors,color:"#ffffff",transparent:true,opacity:1,force:true,depthWrite:false});if(this._MeshNode){this._MeshNode.setMaterial(this._bodyMat)}}if(h){this._bodyMat.map=h;this._bodyMat.needsUpdate=true}else{this._bodyMat.map=null;this._bodyMat.needsUpdate=true}},setMaterial2:function(h){this._bodyMat=new d.MeshBasicMaterial({side:d.FrontSide,forceSide:true,vertexColors:d.VertexColors,color:"#ffffff",transparent:true,opacity:1,force:true,depthWrite:false});if(h){this._bodyMat.map=h}if(this._MeshNode){this._MeshNode.setMaterial(this._bodyMat)}},update:function(t){this._parent();var l=this.GetPropertyValue("Environment.Background.Image");if(l===null||l===undefined){l=-1}var o=this.GlobalOpacity;if(l===-1&&!this.GetPropertyValue("Environment.Background.Gradient")){o=0}var u=this.Modifiable.ExperienceBase.getManager("VCXPaperManager");var w=u.getPaperVisibility();if(!w){o=0}if(this._globalOpacity!==o){this._globalOpacity=o;var k=(this._globalOpacity>0);if(k){if(!this._Smart3DPaperNode){this._Build()}}if(this._Smart3DPaperNode){this._Smart3DPaperNode.setVisibility(k)}}var r=this.GetPropertyValue("Environment.Background.Gradient");var s=this.GetColorPropertyValue("Environment.Background");s.a=1;var i=this.GetColorPropertyValue("Environment.Background.Foot");i.a=1;if(w!==this._previousShowPaper||r!==this._previousGradient||(s&&!s.IsEqualTo(this._previousColor))||(i&&!i.IsEqualTo(this._previousFootColor))||this._forceRefresh){this._previousShowPaper=w;this._previousGradient=r;this._previousColor=s.Clone();this._previousFootColor=i.Clone();var j=this.Modifiable.ExperienceBase.getManager("VCXContextManager");if(r&&!w){var p=i.Clone();p.Lerp(s,0.5);j.applyToViewers(function(y){y.setGradientBackground([s.GetHex(),p.GetHex(),i.GetHex()])})}else{j.applyToViewers(function(y){y.setGradientBackground(null);y.setBackgroundColor(s.GetHex(),1)})}}if(this._globalOpacity<=0){return}if(!this._MeshNode){return}if(!r){var h=this.Modifiable.GetObject().getColors(t.viewpoint);var v=this._MeshNode.getBuffer(e.VertexComponentEnum.DIFFUSE_COLOR);if(v){var q=this._ComputeColorBuffer(v,h);this._MeshNode.updateBuffer(e.VertexComponentEnum.DIFFUSE_COLOR,0,q)}}if(this._previousBackgroundDocID!==l){this._previousBackgroundDocID=l;if(l!==-1){var n=l;var m=this;this.ExperienceBase.getManager("VCXImageManager").GetImageFromDocID(l,f.Effect.None,(function(z,y){if(z===n){var A=d.ImageUtils.loadTexture(y.toDataURL(),{},function(B){m.setMaterial(B);m=null})}}))}else{this.setMaterial()}}if(this._Smart3DPaperNode&&this._bodyMat){this._bodyMat.opacity=this._globalOpacity}if(u){var x=u.Size;this._MeshNode.setMatrix(new d.Matrix4().makeScale(x.x,x.y,1))}},});return c});define("DS/VCXWebDressup/VCXDressupOrganisationShapeCircle",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(a,b){var c=a.extend({rewind:function(){this._parent();this.iCurrent=0;this.rMax=Math.min(this.sizeView.x,this.sizeView.y);this.rMax=this.rMax*0.5-this.fCellSize;if(this.rMax<this.fCellSize){this.rMax=this.fCellSize}this.r=this.rMax;this.nbPerCircle=Math.floor(Math.PI*2*this.r/this.fCellSize+0.5);this.iT=0;this.dt=0;this.iParite=0},next:function(){this._parent();this.iT++;if(this.iT>=this.nbPerCircle){this.r-=this.fCellSize;if(this.r<this.fCellSize){this.rewind();return true}else{this.iT=0;this.nbPerCircle=Math.floor(Math.PI*2*this.r/this.fCellSize+0.5);if(this.iParite&1){this.dt=Math.PI/this.nbPerCircle}else{this.dt=0}this.iParite++}}return false},getPoint:function(){var e=new b.Vector2();var d=this.dt+(Math.PI*2*this.iT)/this.nbPerCircle;e.x=Math.cos(d)*this.r+this.sizeView.x*0.5;e.y=Math.sin(d)*this.r+this.sizeView.y*0.5;return e}});return c});define("DS/VCXWebDressup/VCXBOMCSSNode",["DS/Core/Core","DS/Core/PointerEvents","UWA/Core","DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebDressup/VCXPropertyValueHTMLFormater","DS/VCXWebDressup/VCXPropertiesObserver"],function(e,d,c,i,g,b,h,f,a,k){var j=i.extend({init:function(l){this._parent(l);this._Smart3DPaperNode=null;this._previousBodyWidth=0;this._previousBodyHeight=0;this._textLineHeight=13;this._externalMargin=2;this._lineWidth=0.5;this._currentShape=1;this._BomContent=null;return this},_UpdateDIV:function(q){var r=this.Modifiable.ExperienceBase;if(q){this._bomContentObserver=new k()}this.data={columns:[],data:[]};var o=r.getManager("VCXComponentBomManager").GetColumnNumber();for(var B=0;B<o;B++){var t=r.getManager("VCXComponentBomManager").GetColumnName(B).Value;var x=r.getManager("VCXComponentBomManager").GetColumnLabel(B).Value;if(!x){x=t;x=x.slice(x.indexOf(".")+1)}if(x==="Quantity"){x="Qty"}else{if(x==="BomId"){x="Id"}}this.data.columns.push({text:x,dataIndex:t,width:"auto"})}for(var w in this._BomContent){if(w!==""&&this._BomContent.hasOwnProperty(w)){var n={};var p=this._BomContent[w];var v=0;if(p){var u=p.itemComponents[0].QueryInterface("VCXIModifiable");for(var B=0;B<o;B++){var x=r.getManager("VCXComponentBomManager").GetColumnName(B).Value;var z="";if(x==="Bom.Description"){var m=r.ComponentsMap.GetComponentFromType("VCXBOMInfoComponent");if(m&&m.length===1){z=m[0].getDescription(w);if(!z){x="Actor.Name"}}}var l;switch(x){case"Bom.Description":l=z;break;case"Bom.Quantity":l=p.itemComponents.length;break;default:l="";if(u){if(q){this._bomContentObserver.add(u,x)}var y=u.GetProperty(x);if(y){l=y.GetPropertyValue().Value;n[this.data.columns[B].dataIndex+".VCXProperty"]=y}}}n[this.data.columns[B].dataIndex]=l;v++}}this.data.data.push(n)}}var s=r.getManager("VCXComponentBomManager").GetSortOption();this.data.data.sort(function(D,C){var E=s.ascendant?1:-1;var F=D[s.propertyName];var H=C[s.propertyName];if(F!==H){var I=Number(F),G=Number(H);if(I==F&&G==H){return(I-G)*E}else{if(F.toLowerCase){F=F.toLowerCase()}if(H.toLowerCase){H=H.toLowerCase()}return(F>H)?E:-E}}return 0});var A=document.getElementById("divBom");if(A){this._removeRowsEvents(A);this._myDiv.removeChild(A)}A=this._buildBOM(s);this._myDiv.innerHTML="";this._myDiv.appendChild(A)},_getTextLength:function(p,l,m){if(this._span){}else{this._span=new c.Element("span",{});this._span.style.visibility="hidden";this._span.style.pointerEvents="none";this._span.style.whiteSpace="nowrap";this._span.style.position="absolute";this._span.style.left="-500px";var o=this.Modifiable.ExperienceBase.getManager("VCXContextManager").getUIFrame();this._span.inject(o)}this._span.style.fontFamily=l.text.font.fontFamily;this._span.style.fontSize=Math.floor(l.text.font.fontSize)+"pt";var n=0;if(p.length){n+=6}if(m){this._span.style.fontWeight="600"}else{this._span.style.fontWeight="normal"}this._span.innerHTML=p;n+=this._span.offsetWidth;return n},_buildBOM:function(E){this._myDiv.style.visibility="hidden";var D=null;var r=true;var l=true;var s=true;var w={fontFamily:"Arial",fontSize:12};var u={font:w,headerColor:"white",rowColor:0};var B={visible:true,headerColor:"gray",oddRowColor:0,evenRowColor:0};var y={visible:true,thickness:1,color:0};var m={text:u,background:B,border:y};if(this.GetPropertyValue("Collab.Text.Color")!==undefined){m.text.rowColor=this.GetPropertyValue("Collab.Text.Color").GetStyle()}if(this.GetPropertyValue("Collab.BOM.Header.Text.Color")!==undefined){m.text.headerColor=this.GetPropertyValue("Collab.BOM.Header.Text.Color").GetStyle()}if(this.GetPropertyValue("Collab.BOM.Header.Background.Color")!==undefined){m.background.headerColor=this.GetPropertyValue("Collab.BOM.Header.Background.Color").GetStyle()}if(this.GetPropertyValue("Collab.BOM.OddRow.Background.Color")!==undefined){m.background.oddRowColor=this.GetPropertyValue("Collab.BOM.OddRow.Background.Color").GetStyle()}if(this.GetPropertyValue("Collab.BOM.EvenRow.Background.Color")!==undefined){m.background.evenRowColor=this.GetPropertyValue("Collab.BOM.EvenRow.Background.Color").GetStyle()}if(this.GetFontPropertyValue("Collab.Text.Font")){m.text.font.fontFamily=this.GetFontPropertyValue("Collab.Text.Font").Family;m.text.font.fontSize=this.GetFontPropertyValue("Collab.Text.Font").Height}var x=null;while((r||l||s)&&m.text.font.fontSize>2){if(D){this._removeRowsEvents(D)}D=this._buildFlexBOM(m);this._calcSizeInPixel();this._myDiv.style.width=this.Size.x+"px";this._myDiv.style.height=this.Size.y+"px";this._myDiv.innerHTML="";this._myDiv.appendChild(D);var x=this._analyzeBOM(D);var v=this._addBorderTop(x);x=this._analyzeBOM(D);this._addHeader(x,D,m,E);x=this._analyzeBOM(D);this._removeBorderTop(v);this._addBorderTop(x);var C=this._calcColumnProportion(x,m);this._applyColumnProportion(x,C);var p=D.children;var A;r=false;for(A=0;A<p.length;A++){var n=p[A];if(n.offsetLeft+n.clientWidth>D.clientWidth){r=true;m.text.font.fontSize--;break}}l=true;if(r===false){l=false;var p=D.children;for(var A=0;A<p.length;A++){var q=p[A];var t=q.children;for(var z=0;z<t.length;z++){var n=t[z];var o=this._getTextLength(n.textContent,m,false);if(n.clientWidth<o){l=true;m.text.font.fontSize--;break}}if(l){break}}}s=false;this._myDiv.removeChild(D)}if(x&&x.length===1){D.style.justifyContent="center"}else{D.style.justifyContent="flex-start"}this._myDiv.style.visibility="visible";return D},_analyzeBOM:function(v){var m=[];var p=[];var n=v.children;var r;var t=0;var u=0;var s=null;var l=0;for(r=0;r<n.length;r++){var q=n[r];var o=q.offsetLeft;if(s){if(o===l){p.push(q);u++}else{m[t]=p;u=1;p=[];p.push(q);t++}}else{u++;p.push(q)}s=q;l=o}m[t]=p;return m},_removeBorderTop:function(n){for(var m=0;m<n.length;m++){var l=n[m];l.style.borderTop=""}},_addBorderTop:function(p){var q=[];for(var o=0;o<p.length;o++){var l=p[o];for(var n=0;n<l.length;n++){var m=l[n];if(n===0){m.style.borderTop="1px solid #000000";q.push(m)}}}return q},_addHeader:function(l,u,p,m){if(l.length>1){var q=0;for(var t=1;t<l.length;t++){var s=l[t];var n=s[0];var v=n;for(var o=0;o<q;o++){v=v.previousSibling}var r=this.createHeader(p,m);u.insertBefore(r,v);q++}}},_calcColumnProportion:function(l,t){var z=[];for(var A=0;A<l.length;A++){var v=[];var q=l[A];var u=q.length;for(var w=0;w<u;w++){var B=q[w];var o=B.children;for(var p=0;p<o.length;p++){var s=o[p];var n=this._getTextLength(s.textContent,t,w===0);if(v[p]){v[p]=Math.max(v[p],n)}else{v[p]=n}}}var r=v.length;var x=0;for(var p=0;p<r;p++){x+=v[p]}for(var p=0;p<r;p++){var y=v[p];var m=100*y/x;v[p]=m.toFixed(2)}z[A]=v}return z},_applyColumnProportion:function(l,t){for(var u=0;u<l.length;u++){var r=t[u];var o=l[u];var q=o.length;for(var s=0;s<q;s++){var v=o[s];var m=v.children;for(var n=0;n<m.length;n++){var p=m[n];p.style.flexBasis=r[n]+"%"}}}},_createHeaderCell:function(m){var l=this._createCell(m);l.style.fontWeight="bold";l.style.color=m.text.headerColor;l.style.backgroundColor=m.background.headerColor;return l},_fillHeaderCell:function(l,n){var m=this.data.columns[n].text;this._setContent(l,m)},_createCell:function(m){var l=new c.Element("div",{id:"divBomCell","class":"BOM_Cell"});l.style.fontFamily=m.text.font.fontFamily;l.style.fontSize=Math.floor(m.text.font.fontSize)+"pt";return l},_fillCell:function(l,m,p){var o;var n=this.data.data[m][this.data.columns[p].dataIndex+".VCXProperty"];if(n){o=a.format(n)}else{o=this.data.data[m][this.data.columns[p].dataIndex]}this._setContent(l,o)},_setContent:function(l,m){l.innerHTML=m},_getDescriptionColId:function(){var l=1;for(var m=0;m<this.data.columns.length;m++){var n=this.data.columns[m].dataIndex;if(n==="Bom.Description"){l=m;break}}return l},createHeader:function(m){var o=new c.Element("div",{id:"divBomRow","class":"BOM_Row"});for(var n=0;n<this.data.columns.length;n++){var l=this._createHeaderCell(m);this._fillHeaderCell(l,n);l.inject(o)}return o},_buildFlexBOM:function(o,n){var u=new c.Element("div",{id:"divBom","class":"BOM"});var q=this.createHeader(o,n);q.inject(u);for(var s=0;s<this.data.data.length;s++){var m=this._BomContent[this.data.data[s]["Actor.BomId"]];var l=new c.Element("div",{id:"divBomRow","class":"BOM_Row"});l.inject(u);l._bomLine=m;m._tr=l;if(e.Selection.CSOManager.isIn({pathElement:m.itemComponents[0].QueryInterface("W3AISGNodeHolder").getPathElement()})){l.classList.add("selected")}var p;if(s%2===0){p=o.background.oddRowColor}else{p=o.background.evenRowColor}l.style.backgroundColor=p;for(var r=0;r<this.data.columns.length;r++){var t=this._createCell(o);t.style.color=o.text.rowColor;this._fillCell(t,s,r);t.inject(l)}this._addRowEvents(l)}return u},_addRowEvents:function(l){l.addEventListener("mouseenter",j.rowMouseEnter,false);l.addEventListener("mouseleave",j.rowMouseLeave,false);l._experienceBase=this.Modifiable.ExperienceBase;l.addEventListener(d.POINTERUP,j.rowPointerEventUp,false)},_removeRowEvents:function(l){l.removeEventListener("mouseenter",j.rowMouseEnter);l.removeEventListener("mouseleave",j.rowMouseLeave);l.removeEventListener(d.POINTERUP,j.rowPointerEventUp);l._experienceBase=null},_removeRowsEvents:function(n){var m=n.children;var l;for(l=1;l<m.length;l++){var o=m[l];this._removeRowEvents(o)}},_calcSizeInPixel:function(){this.Size=new g.Vector2();this.Size.x=this.GetPropertyValue("Collab.Body.Width");this.Size.y=this.GetPropertyValue("Collab.Body.Height");var l=0.3527;this.Size.x/=l;this.Size.y/=l},dispose:function(){if(this._Smart3DPaperNode){this._Smart3DPaperNode.dispose();this._Smart3DPaperNode=null}this._bomContentObserver=null;this._parent()},_Build:function(){var m={name:"BOMSmartNode",modifiable:this.Modifiable,type:this._type};this._Smart3DPaperNode=new b(m);this._Smart3DPaperNode.setVisibilityInTree(false);this.add(this._Smart3DPaperNode);if(!this._myDiv){this._myDiv=new c.Element("div",{"class":"CSSTableGenerator"});this._myDiv.style.position="absolute";var l=this.Modifiable.ExperienceBase.getManager("VCXContextManager").getUIFrame();this._myDiv.inject(l)}this._Smart3DPaperNode.AttachedDiv=this._myDiv},removeDiv:function(){if(this._myDiv){var m=document.getElementById("divBom");if(m){this._removeRowsEvents(m);this._myDiv.removeChild(m)}var l=this.Modifiable.ExperienceBase.getManager("VCXContextManager").getUIFrame();l.removeChild(this._myDiv)}},preRender:function(l){if(this._Smart3DPaperNode){this._Smart3DPaperNode.preRender(l)}},addOrRemoveObjectToFromPSO:function(n,s){if(this._BomContent){var m=h.GetModifiableFromPathElement(n,this.ExperienceBase);if(m){var r;if(m._bIsCallout&&m.GetComputedStringProperty){r=m.GetComputedStringProperty("Collab.Text")}if(r){var o=this._BomContent[r];if(o&&o.itemComponents){var q=0;for(q=0;q<o.itemComponents.length;q++){var p={pathElement:o.itemComponents[q].QueryInterface("W3AISGNodeHolder").getPathElement()};var l=e.Selection.PSOManager;s?l.add(p):l.remove(p)}if(o._tr){s?o._tr.classList.add("hover"):o._tr.classList.remove("hover")}}}}}},addOrRemoveObjectToFromCSO:function(p,r){if(this._BomContent&&p){var q=h.GetModifiableFromPathElement(p,this.ExperienceBase);if(q){var t;var s=q.GetProperty("Actor.BomId");if(s){t=s.GetPropertyValue().Value}if(t){var m=this._BomContent[t];if(m){if(r){if(m.itemComponents){var l=0;for(l=0;l<m.itemComponents.length;l++){var o={pathElement:m.itemComponents[l].QueryInterface("W3AISGNodeHolder").getPathElement()};var n=e.Selection.CSOManager;n.add(o)}if(m._tr){m._tr.classList.add("selected")}}}else{if(m._tr){m._tr.classList.remove("selected")}}}}}}},addToPSO:function(l){this.addOrRemoveObjectToFromPSO(l,true)},removeFromPSO:function(l){this.addOrRemoveObjectToFromPSO(l,false)},emptyPSO:function(){for(var l in this._BomContent){if(l!==""&&this._BomContent.hasOwnProperty(l)){if(this._BomContent[l]._tr&&this._BomContent[l]._tr.classList.contains("hover")){this._BomContent[l]._tr.classList.remove("hover")}}}},addToCSO:function(l){this.addOrRemoveObjectToFromCSO(l,true)},removeFromCSO:function(l){this.addOrRemoveObjectToFromCSO(l,false)},emptyCSO:function(){for(var l in this._BomContent){if(l!==""&&this._BomContent.hasOwnProperty(l)){if(this._BomContent[l]._tr&&this._BomContent[l]._tr.classList.contains("selected")){this._BomContent[l]._tr.classList.remove("selected")}}}},postUpdate:function(){this._parent();if(this._bomContentObserver){this._bomContentObserver.postUpdate()}},update:function(m){this._parent();if(this.needToRebuildDiv||this.ExperienceBase.getManager("VCXComponentBomManager")){this.needToRebuildDiv=this.ExperienceBase.getManager("VCXComponentBomManager").ListHasChanged}var n=false;var l=this.GlobalOpacity;if(l){if(this.needToRebuildDiv){if(this.Modifiable.ExperienceBase.getManager("VCXComponentBomManager")&&this.Modifiable.ExperienceBase.getManager("VCXComponentBomManager").GetBOMContent){this._BomContent=this.Modifiable.ExperienceBase.getManager("VCXComponentBomManager").GetBOMContent(this.Modifiable.GetPropertyValue("Collab.BOM.FilterOnVisibleCallouts"))}}else{if(this._bomContentObserver){this._bomContentObserver.update();n=this._bomContentObserver.isDirty()}}}if(!this._BomContent||this._BomContent.length===0){l=0}if(this._globalOpacity!==l){this._globalOpacity=l;if(this._globalOpacity<=0){if(this._myDiv){this._myDiv.parentNode.removeChild(this._myDiv);this._myDiv=null}if(this._Smart3DPaperNode){this.remove(this._Smart3DPaperNode);this._Smart3DPaperNode=null}this._currentText=null;return}if(!this._Smart3DPaperNode){this._Build();this.needToRebuildDiv=true}if(this._myDiv){if(this._myDiv.style.opacity!==this._globalOpacity){this._myDiv.style.opacity=this._globalOpacity}}}if(this._Smart3DPaperNode){this._Smart3DPaperNode.update(m)}else{return}if(this.needToRebuildDiv||n){this._UpdateDIV(this.needToRebuildDiv)}if(this.needToRebuildDiv){this._calcSizeInPixel();this._myDiv.style.width=this.Size.x+"px";this._myDiv.style.height=this.Size.y+"px";this._UpdateDIV();this.needToRebuildDiv=false}this.handleLayers();return},});j.rowMouseEnter=function(o){o.stopPropagation();o.stopImmediatePropagation();var m=o.currentTarget;var l=e.Selection.PSOManager;if(m._bomLine.itemComponents){for(var p=0;p<m._bomLine.itemComponents.length;p++){var n={pathElement:m._bomLine.itemComponents[p].QueryInterface("W3AISGNodeHolder").getPathElement()};l.add(n)}}if(m._bomLine.calloutComponents){for(var p=0;p<m._bomLine.calloutComponents.length;p++){var n={pathElement:m._bomLine.calloutComponents[p].QueryInterface("W3AISGNodeHolder").getPathElement()};l.add(n)}}};j.rowMouseLeave=function(m){m.stopPropagation();m.stopImmediatePropagation();var l=e.Selection.PSOManager;l.empty()};j.rowPointerEventUp=function(o){o.stopPropagation();o.stopImmediatePropagation();var m=o.currentTarget;if(m._bomLine.itemComponents){var n=false;for(var q=0;q<m._bomLine.itemComponents.length&&!n;q++){if(e.Selection.CSOManager.isIn({pathElement:m._bomLine.itemComponents[q].QueryInterface("W3AISGNodeHolder").getPathElement()})){n=true}}var l=m._experienceBase;var p=new f(l.getManager("VCXSelectionManager"));for(var q=0;q<m._bomLine.itemComponents.length;q++){if(n){p.RemoveFromSelection(m._bomLine.itemComponents[q])}else{p.AddToSelection(m._bomLine.itemComponents[q])}}l.getManager("VCXCommandManager").Do(p)}};return j});define("DS/VCXWebDressup/VCXBOMSGNodeHolder",["DS/CoreEvents/Events","DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXBOMCSSNode"],function(d,b,a){var c=b.extend({init:function(){},buildSGNode:function(){if(this._sgNode===undefined){var e=this.GetObject().QueryInterface("VCXIModifiable");var g={name:"BOM",modifiable:e};this._sgNode=new a(g)}var f=this._sgNode;this.event_VCX_PREHIGHLIGHT_EMPTY=d.subscribe({event:"VCX_PREHIGHLIGHT_EMPTY"},function(h){f.emptyPSO()});this.event_VCX_PREHIGHLIGHT_REMOVE=d.subscribe({event:"VCX_PREHIGHLIGHT_REMOVE"},function(j){if(Array.isArray(j)){for(var h=0;h<j.length;++h){f.removeFromPSO(j[h].pathElement)}}else{if(j.pathElement){f.removeFromPSO(j.pathElement)}else{console.warn("Data given by SelectionManager for removes have changed..")}}});this.event_VCX_PREHIGHLIGHT_ADD=d.subscribe({event:"VCX_PREHIGHLIGHT_ADD"},function(j){if(Array.isArray(j)){for(var h=0;h<j.length;++h){f.addToPSO(j[h].pathElement)}}else{console.warn("Data given by SelectionManager for adds have changed..")}});this.event_VCX_SELECTION_EMPTY=d.subscribe({event:"VCX_SELECTION_EMPTY"},function(h){f.emptyCSO()});this.event_VCX_SELECTION_COMPONENTSLIST_REMOVE=d.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},function(j){if(!Array.isArray(j)){console.log("Problem: Something changed with the VCX_SELECTION_COMPONENTSLIST_REMOVE event...");return}for(var h=0;h<j.length;++h){var i=j[h];if(!i){continue}var k=i.QueryInterface("W3AISGNodeHolder");if(k){f.removeFromCSO(k.getPathElement())}}});this.event_VCX_SELECTION_COMPONENTSLIST_ADD=d.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},function(j){if(!Array.isArray(j)){console.log("Problem: Something changed with the VCX_SELECTION_COMPONENTSLIST_ADD event...");return}for(var h=0;h<j.length;++h){var i=j[h];if(!i){continue}var l=i.QueryInterface("W3AISGNodeHolder");if(l){var k=l.getPathElement();if(k){f.addToCSO(k)}}}});return this._parent()},Dispose:function(){if(this.event_VCX_PREHIGHLIGHT_EMPTY){d.unsubscribe(this.event_VCX_PREHIGHLIGHT_EMPTY);delete this.event_VCX_PREHIGHLIGHT_EMPTY}if(this.event_VCX_PREHIGHLIGHT_REMOVE){d.unsubscribe(this.event_VCX_PREHIGHLIGHT_REMOVE);delete this.event_VCX_PREHIGHLIGHT_REMOVE}if(this.event_VCX_PREHIGHLIGHT_ADD){d.unsubscribe(this.event_VCX_PREHIGHLIGHT_ADD);delete this.event_VCX_PREHIGHLIGHT_ADD}if(this.event_VCX_SELECTION_EMPTY){d.unsubscribe(this.event_VCX_SELECTION_EMPTY);delete this.event_VCX_SELECTION_EMPTY}if(this.event_VCX_SELECTION_REMOVE){d.unsubscribe(this.event_VCX_SELECTION_REMOVE);delete this.event_VCX_SELECTION_REMOVE}if(this.event_VCX_SELECTION_COMPONENTSLIST_REMOVE){d.unsubscribe(this.event_VCX_SELECTION_COMPONENTSLIST_REMOVE);delete this.event_VCX_SELECTION_COMPONENTSLIST_REMOVE}if(this.event_VCX_SELECTION_COMPONENTSLIST_ADD){d.unsubscribe(this.event_VCX_SELECTION_COMPONENTSLIST_ADD);delete this.event_VCX_SELECTION_COMPONENTSLIST_ADD}if(this._sgNode){this._sgNode.removeDiv();delete this._sgNode}this._parent()},});return c});define("DS/VCXWebDressup/VCXAmbienceNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXComponentViewport","DS/VCXWebDressup/VCXPropertiesObserver","DS/Visualization/Node3D","DS/Visualization/Ambience","DS/WebappsUtils/WebappsUtils","DS/Visualization/ThreeJS_DS"],function(h,b,g,f,d,e,c){var a=h.extend({init:function(i){this._parent(i);return this},preRender:function(i){this._parent(i)},_buildFromLocal:function(){var v=UWA.Promise.deferred();var r=this.Modifiable.GetProperty("Environment.Background.Map").GetPropertyInfo().GetMapChoiceEnum();var t=r[this.Modifiable.GetPropertyValue("Environment.Background.Map")].split(".").pop();if(this._envMapStr!==t){this._envMapStr=t;var l=this.Modifiable.ExperienceBase.getManager("VCXContextManager");var p=new d({viewer:l.getMainViewer()});var s="";if(this.Modifiable.GetPropertyValue("Environment.Background.Map")>1){s=e.getWebappsAssetUrl("debug_visu","models/textures/hdr_physical/")}else{s=e.getWebappsAssetUrl("VCXWebVisualization","ambiences/")}var j=s+t+"/"+t+".hdr";var m=s+t+"/"+t+".hdr";var n=s+t+"/"+t+"_rmips.hdr";var k=0;var o=function(){k++;if(k===3){k=0;v.resolve(p)}};var u=c.ImageUtils.loadHDRTexture(j,new c.LatLongEnvMapping());var i=c.ImageUtils.loadHDRTexture(m,new c.LatLongReflectionMapping());var q=c.ImageUtils.loadHDRTexture(n,new c.LatLongReflectionMapping());p.setIblMap({texture:i,doneCallback:o});p.setRoughnessMap({texture:q,doneCallback:o});p.setBackGroundMap({texture:u,mapping:new c.LatLongEnvMapping(),hdr:true,doneCallback:o})}return v.promise},_Build:function(){var i=this.Modifiable.ExperienceBase.getManager("VCXContextManager");var k=this.Modifiable.GetObject();k._ambience=null;k._ambienceLoading=true;var l;if(this.Modifiable.GetPropertyValue("Environment.Background.Map")===b.EEnvironment.PLM){var j=k.QueryInterface("CATI3DXAssetHolder");if(j){l=j.resolveAsset()}}if(!l){l=this._buildFromLocal()}l.then(function(m){k._ambience=m;k._ambienceLoading=false;i.getMainViewer().setAmbience(k._ambience,true);k.setDirty(true)})},update:function(s){this._parent();var k=false;var j=this.Modifiable.ExperienceBase.getManager("VCXContextManager");var o=j.getActiveViewport();var m=j.getMainViewer();var l=o.getActiveAmbienceID();if(l===this.Modifiable.GetObject().GetID()){k=true}var n=this.Modifiable.GetObject()._ambience;if(m){if(m.ambience){if(!l){m.removeAmbience()}}if(k){if(!n&&!this.Modifiable.GetObject()._ambienceLoading){this._Build()}if(!this.Modifiable.GetObject()._ambienceLoading&&n!==m.ambience){m.setAmbience(n,true)}}}if(!k){return}var q=this.Modifiable.GetProperty("Environment.Background.Map").GetPropertyInfo().GetMapChoiceEnum();var p=q[this.Modifiable.GetPropertyValue("Environment.Background.Map")].split(".").pop();if(this._envMapStr!==p){this._Build()}if(n){var i=this.Modifiable.GetPropertyValue("Environment.Background.Show");n.getBackground().setActivated(i);n.setExposure(Math.pow(2,this.Modifiable.GetPropertyValue("Environment.Background.Exposure")));n.setGroundGlossiness(this.Modifiable.GetPropertyValue("Environment.Ground.Glossiness")/100);n.setGroundReflectivitiy(this.Modifiable.GetPropertyValue("Environment.Ground.Reflectivity")/100);if(n.setGroundShadowIntensity){n.setGroundShadowIntensity(this.Modifiable.GetPropertyValue("Environment.Ground.ShadowIntensity")/100)}var r={};r.displayPlane=this.GetPropertyGroupVisibility("Group.Environment.Ground.Disc");r.planeColor=this.GetColorPropertyValue("Environment.Ground.Disc").GetHex();r.planeBorder=this.GetPropertyValue("Environment.Ground.Disc.Border.Show")&&this.GetPropertyGroupVisibility("Group.Environment.Ground.Disc");r.planeBorderColor=this.GetColorPropertyValue("Environment.Ground.Disc.Border").GetHex();if(r.planeBorder){r.planeFalloff=1-this.GetPropertyValue("Environment.Ground.Disc.FallOff")}else{r.planeFalloff=this.GetPropertyValue("Environment.Ground.Disc.FallOff")}r.gridColor=this.GetColorPropertyValue("Environment.Ground.Disc.Grid").GetHex();r.displayGrid=this.GetPropertyValue("Environment.Ground.Disc.Grid.Show");r.gridFalloff=this.GetPropertyValue("Environment.Ground.Disc.Grid.Falloff");r.displayGridFromBelow=true;r.gridNbSteps=10;if(n.setGroundOptions){n.setGroundOptions(r)}this.Modifiable.GetObject().updatePosition()}},postUpdate:function(i){this._parent()}});return a});define("DS/VCXWebDressup/VCXAmbienceSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXAmbienceNode"],function(a,b){var c=a.extend({init:function(){},getWorldMatrix:function(d){var e=this.QueryInterface("VCXIModifiable");if(e){return e.GetFramePropertyValue("Actor.Position")}},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Ambience",modifiable:d,};this._sgNode=new b(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_AmbienceLeaf.png")}return this._parent()},});return c});define("DS/VCXWebDressup/VCXDressupOrganisationShapeRectangle",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(b,c){var a=b.extend({rewind:function(){this._parent();this.iSwap=0;this.iPariteX=0;this.iPariteY=0;this.fX=0;this.dx=0;this.fY=this.fHalfSizeY-this.fCellSize;if(this.fY<0){this.fY=0}this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize;this.LRiPariteX=0;this.LRiPariteY=0;this.LRfX=this.fHalfSizeX-this.fCellSize;if(this.LRfX<0){this.LRfX=0}this.LRdy=0;this.LRfY=0;this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){this._parent();this.iSwap++;if(this.iSwap===1){return false}if(this.iSwap&1){this.LRiPariteX++;if(this.LRiPariteX===2){this.LRiPariteX=0;if(this.LRfY===0){this.LRiPariteY++}this.LRiPariteY++;if(this.LRiPariteY===2){this.LRiPariteY=0;this.LRfY+=this.fCellSize;if(this.LRfY>this.fHalfSizeY-this.fCellSize){if(this.LRdy===0){this.LRdy=this.fCellSize*0.5}else{this.LRdy=0}this.LRfY=0;this.LRfX-=this.fCellSize;if(this.LRfX<this.fCellSize){this.rewind();return true}}}}}else{this.iPariteY++;if(this.iPariteY===2){this.iPariteY=0;if(this.fX==0){this.iPariteX++}this.iPariteX++;if(this.iPariteX===2){this.iPariteX=0;this.fX+=this.fCellSize;if(this.fX>this.maxfx){this.maxfx-=this.fCellSize;if(this.maxfx<this.fCellSize){this.maxfx=this.fCellSize}if(this.dx===0){this.dx=this.fCellSize*0.5}else{this.dx=0}this.fX=0;this.fY-=this.fCellSize;if(this.fY<this.fCellSize){this.rewind();return true}}}}}return false},getPoint:function(){var d=new c.Vector2();if(this.iSwap&1){if(this.LRiPariteX&1){d.x=this.fHalfSizeX-this.LRfX}else{d.x=this.fHalfSizeX+this.LRfX}if(this.LRiPariteY&1){d.y=this.fHalfSizeY-this.LRfY+this.LRdy}else{d.y=this.fHalfSizeY+this.LRfY+this.LRdy}}else{if(this.iPariteX&1){d.x=this.fHalfSizeX-this.fX+this.dx}else{d.x=this.fHalfSizeX+this.fX+this.dx}if(this.iPariteY&1){d.y=this.fHalfSizeY-this.fY}else{d.y=this.fHalfSizeY+this.fY}}return d}});return a});define("DS/VCXWebDressup/VCXDressupOrganisationShapeTopAndLeft",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(a,b){var c=a.extend({rewind:function(){this._parent();this.iSwap=0;this.iPariteX=0;this.iPariteY=0;this.fX=0;this.dx=0;this.fY=this.fHalfSizeY-this.fCellSize;if(this.fY<0){this.fY=0}this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize;this.LRiPariteX=0;this.LRiPariteY=0;this.LRfX=this.fHalfSizeX-this.fCellSize;if(this.LRfX<0){this.LRfX=0}this.LRdy=0;this.LRfY=0;this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){this._parent();this.iSwap++;if(this.iSwap&1){this.LRiPariteY++;if(this.LRiPariteY===2){this.LRiPariteY=0;this.LRfY+=this.fCellSize;if(this.LRfY>this.fHalfSizeY-this.fCellSize){if(this.LRdy===0){this.LRdy=this.fCellSize*0.5}else{this.LRdy=0}this.LRfY=0;this.LRfX-=this.fCellSize;if(this.LRfX<this.fCellSize){this.rewind();return true}}}}else{if(this.fX==0){this.iPariteX++}this.iPariteX++;if(this.iPariteX===2){this.iPariteX=0;this.fX+=this.fCellSize;if(this.fX>this.maxfx){this.maxfx-=this.fCellSize;if(this.maxfx<this.fCellSize){this.maxfx=this.fCellSize}if(this.dx===0){this.dx=this.fCellSize*0.5}else{this.dx=0}this.fX=0;this.fY-=this.fCellSize;if(this.fY<this.fCellSize){this.rewind();return true}}}}return false},getPoint:function(){var d=new b.Vector2();if(this.iSwap&1){d.x=this.fHalfSizeX-this.LRfX;if(this.LRiPariteY&1){d.y=this.fHalfSizeY-this.LRfY+this.LRdy}else{d.y=this.fHalfSizeY+this.LRfY+this.LRdy}}else{if(this.iPariteX&1){d.x=this.fHalfSizeX-this.fX+this.dx}else{d.x=this.fHalfSizeX+this.fX+this.dx}d.y=this.fHalfSizeY-this.fY}return d}});return c});define("DS/VCXWebDressup/VCXComponentCircle",["DS/VCXWebDressup/VCXComponentDressup"],function(b){var a=b.extend({init:function(){this._parent()},});a.EBackgroundType={Empty:0,Gradient:1,Plain:2};Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentCircle"}});a.prototype._dressupFamily="Markups";return a});define("DS/VCXWebDressup/VCXCircleModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXComponentCircle","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueVector"],function(l,c,o,f,i,e,n,b,k,h,m,j,a,g){var d=f.extend({init:function(){this._parent();this._bIsCircle=true},Build:function(){this._parent();var p=[{Name:"Actor.Anchor.0",Type:j,DefaultValue:new j().SetValueFrame(new h().SetValueFromVector(new i.Vector3(0,0,0))).GetValue()},{Name:"Circle.Radius",Type:k,DefaultValue:1,GroupId:"Group.Body"},{Name:"Circle.Scale",Type:k,DefaultValue:1,GroupId:"Group.Body"},{Name:"Circle.Thickness",Type:k,DefaultValue:20,Bounds:{Min:0,Max:100,Step:0.1},GroupId:"Group.Body"},{Name:"Collab.3D.Paper.Billboard.Type",Type:a,DefaultValue:o.EBillboardType.Spherical,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(o.EBillboardType,"Billboard.Type",["AlongX_yInCam","AlongX_yInCamUp"])},{Name:"Collab.Is.Paper",Type:b,DefaultValue:true,GroupId:"Group.Position"},{Name:"Circle.Background.Type",Type:a,DefaultValue:c.EBackgroundType.Gradient,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(c.EBackgroundType,"Circle.BackgroundType")},{Name:"Collab.Background.Color",Type:m,DefaultValue:new n().FromRGBA(0.9294117647058824,0.3176470588235294,0.3176470588235294,0.5),GroupId:"Group.Body"},{Name:"Collab.Background.Color.Opacity",Type:k,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Body"},{Name:"Collab.Body.Line.Width",Type:k,DefaultValue:1,GroupId:"Group.Line"},{Name:"Collab.Body.Line.Color",Type:m,DefaultValue:new n().FromRGBA(0.6431372549019608,0.1686274509803922,0.1568627450980392,1),GroupId:"Group.Line"},{Name:"Collab.Body.Line.Color.Opacity",Type:k,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.Line"},{Name:"Collab.Body.Line.Type",Type:a,DefaultValue:l.ELineType.Plain,GroupId:"Group.Line",MapChoice:this._generateMapChoiceFromEnumAndId(l.ELineType,"Collab.DashType",["UserDefined","Advanced"])},{Name:"Collab.ListAnchorsIDs",Type:g,DefaultValue:[0]}];this._BuildPropertyValues(p);this.SetPropertyInvisible("Collab.ListAnchorsIDs",true)},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Actor.Color",false);this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=false;this.SetPropertyInvisible("Collab.Background.Color",this.GetPropertyValue("Circle.Background.Type")===0);this.SetPropertyInvisible("Collab.Background.Color.Opacity",this.GetPropertyValue("Circle.Background.Type")===0);this.SetPropertyInvisible("Circle.Thickness",this.GetPropertyValue("Circle.Background.Type")!==1)},RequestModification:function(r){if(r){if(r.GetPropertyInfo().GetPropertyName()==="Actor.Color"){var q=new e();var p=r.GetPropertyValue().Value.getAssociatedColors();q.AddOrModifyProperty(this.GetNewProperty("Collab.Background.Color",p.body));q.AddOrModifyProperty(this.GetNewProperty("Collab.Body.Line.Color",p.border));return q}else{return this._parent(r)}}else{return new e()}}});return d});define("DS/VCXWebDressup/VCXCompassNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebVisibility/VCXIVisibility"],function(c,e,b,d,a){var f=d.extend({init:function(g){this._convertFunc=null;this._currentGeomId=-1;this._nodeGeom=null;this._geomBSphereRadius=-1;this._compassMaterial=null;this._currentViewportWidth=0;this._currentViewportHeight=0;this._parent(g);return this},_Build:function(){this._Node=null},setGeomConverter:function(g){this._convertFunc=g},preRender:function(g){},_showDefaultRobot:function(j){var g=this.ExperienceBase.getManager("VCXContextManager").getPlayerMode();if(!g){return}var i=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(!i){return}var h=i.getRobot();if(!h){return}if(j){h.setVisibility(this._defaultRobotState?this._defaultRobotState.visibility:true);if(this._defaultRobotState&&this._defaultRobotState.isConnected){h.setConnectionState(this._defaultRobotState.isConnected);h.fixedSizeNode3D.setRatio(this._defaultRobotState.ratio);h.setRobotMatrix(this._defaultRobotState.matrix)}i.setReferenceAxisSystem(true)}else{this._defaultRobotState={isConnected:h.isConnected,matrix:h.getMatrix(),visibility:true,ratio:7};h.setVisibility(false);i.setReferenceAxisSystem(false)}},_updateCompassAspect:function(){var n=this;var l=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();var k=l.getRobot();var h=k._isEnabled();n._showDefaultRobot(false);var g=0;if(n.GetPropertyValue("Compass.AbsoluteSize")===true){g=n.GetPropertyValue("Compass.SizePixel")}else{g=n.GetPropertyValue("Compass.Size")*l.canvas.width}var m=-n.GetPropertyValue("Compass.Translation").x*l.canvas.width;var j=+n.GetPropertyValue("Compass.Translation").y*l.canvas.height;var i=2*n._geomBSphereRadius;l.setCustomReferenceAxisSystem(null);l.setCustomReferenceAxisSystem({node:n._nodeGeom,getPosition:function(p,o){var r=(p-m-(g*0.5))/p;var q=(o-j-(g*0.5))/o;return{x:-1+(2*r),y:-1+(2*q)}},ratio:g/i});k._setEnabled(h)},update:function(k){this._parent();var n=this.GetPropertyValue("Compass.GeomPath");var l=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(n===-1){l.setCustomReferenceAxisSystem(null);this._showDefaultRobot(true);l.render();this._currentGeomId=-1;this._nodeGeom=null;this._geomBSphereRadius=-1;return}var h=this.Modifiable.QueryInterface("VCXIVisibility");if(h._visible!==a.EVisState.Visible){if(l.getCustomReferenceAxisSystem()){l.setCustomReferenceAxisSystem(null);this._showDefaultRobot(true);l.render();this._currentGeomId=-1;this._nodeGeom=null;this._geomBSphereRadius=-1}return}if(n!==this._currentGeomId&&this._convertFunc){var m=this;var j=m.ExperienceBase.getManager("VCXDocManager");var i=j.GetPropPath(n);var g=i.GetValueURL().GetValue();this._convertFunc(g,function(q){if(n!==m._currentGeomId){return}var p=new e();m._nodeGeom=p;var s=new e();p.addChild(s);if(!m._compassMaterial){m._compassMaterial=new c.MeshPhongMaterial({color:new c.Color().setRGB(0.5,0.5,0.5),opacity:1});m._compassMaterial.force=true}s.material=m._compassMaterial;q.forEach(function(t,u){s.add(t.geode)});l.setCustomReferenceAxisSystem(p?{node:p,getPosition:function(u,t){return{x:0,y:0}},ratio:1}:null);m._geomBSphereRadius=p.bSphere.radius*(1+0.1);var r=new c.Vector3(-p.bSphere.center.x,-p.bSphere.center.y,-p.bSphere.center.z);var o=new c.Matrix4().setPosition(r);p.setMatrix(o);s.setMatrix(m.GetPropertyValue("Compass.Alignment"));m._updateCompassAspect()})}else{this._updateCompassAspect()}this._currentGeomId=n}});return f});define("DS/VCXWebDressup/VCXCompassSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXCompassNode"],function(a,c){var b=a.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Compass",modifiable:d};this._sgNode=new c(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_CompassLeaf.png")}return this._parent()},});return b});define("DS/VCXWebDressup/VCXRedLineNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebKernelTools/VCXMeshServices",],function(b,e,d,c,f){var a=c.extend({init:function(g){this._parent(g);this._localMaterial=new b.LineBasicMaterial({color:new b.Color().setRGB(1,0,0),opacity:1,dashSize:0,gapSize:0});return this},_Build:function(){if(!this._Node){this._Node=new e();this.add(this._Node)}var h=this._Node.getChildren();var r=h.length;for(var k=r-1;k>=0;--k){this._Node.removeChild(h[k])}var w=this.Modifiable.GetPropertyValue("Collab.VertexBuffers");if(w){for(var n=0;n<w.length;++n){var q=w[n].GetValue();if(!q||!q.length){continue}var l=window.atob(q);var s=new Uint8Array(l.length);var v="",p=0;for(var m=0;m<l.length;++m){if(l[m]===","){s[p++]=parseInt(v);v="";continue}v+=l[m]}s[p++]=parseInt(v);var o=new ArrayBuffer(p);var t=new Uint8Array(o);for(var m=0;m<t.length;++m){t[m]=s[m]}if(o.byteLength%4){continue}var g=new Float32Array(o);var u=f.buildLine(g,new d.Color(1,0,0,1),1,"WIRE_EDGE",null);u.setPickParent(true);this._updateGeom(u,1)}}},_updateGeom:function(i,h){if(!this._Node){return}if(h){this._Node.addChild(i)}else{var g=this._Node.getChildren();if(g.length){this._Node.removeChild(g[g.length-1])}this._Node.addChild(i)}i.setMaterial(this._localMaterial);this._localMaterial.force=true;this.update()},update:function(h){if(!this._Node){this._Build()}this._parent();if(this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var j=(this._globalOpacity>0);if(j){if(!this._Node||!this._Node.getChildren().length){this._Build()}}if(this._Node){this._Node.setVisibility(j)}}if(this._globalOpacity<=0){return}if(!this._Node){return}var k=this.GetAnchorWorldMatrix(0,h);if(k){this.setMatrix(k)}var i=this.GetColorPropertyValue("Actor");this._localMaterial.color=i.GetThreeColor();this._localMaterial.force=true;var g=this.GetPropertyValue("Collab.Body.Line.Width");this._localMaterial.setLineWidth(g);this._localMaterial.opacity=this._globalOpacity;this.handleLayers()}});return a});define("DS/VCXWebDressup/VCXRedLineSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXRedLineNode"],function(a,c){var b=a.extend({init:function(){},buildSGNode:function(){if(!this._sgNode||this._sgNode===undefined){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"RedLine",modifiable:d};this._sgNode=new c(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_RedLineLeaf.png")}return this._parent()},});return b});define("DS/VCXWebDressup/VCXDressupOrganisationShapePerimetric",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(a,c){var b=a.extend({rewind:function(){this._parent();this.iCurrent=0;this.rMax=Math.min(this.sizeView.x,this.sizeView.y);if(this.rMax<this.fCellSize){this.rMax=this.fCellSize}this.r=this.fCellSize;this.nbPerCircle=Math.floor(Math.PI*2*this.r/this.fCellSize+0.5);this.iT=0;this.dt=0;this.iParite=0},next:function(){this._parent();this.iT++;if(this.iT>=this.nbPerCircle){this.r+=this.fCellSize;if(this.r>this.rMax){this.rewind();return true}else{this.iT=0;this.nbPerCircle=Math.floor(Math.PI*2*this.r/this.fCellSize+0.5);if(this.iParite&1){this.dt=Math.PI/this.nbPerCircle}else{this.dt=0}this.iParite++}}return false},getPoint:function(e){var f=new c.Vector2();var d=this.dt+(Math.PI*2*this.iT)/this.nbPerCircle;f.x=Math.cos(d)*this.r+e.x;f.y=Math.sin(d)*this.r+e.y;return f}});return b});define("DS/VCXWebDressup/VCXDressupOrganisationShapeLeftAndRight",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(b,c,d){var a=b.extend({rewind:function(){this._parent();this.iPariteX=0;this.iPariteY=0;this.fX=this.fHalfSizeX-this.fCellSize;this.dy=0;this.fY=0;if(this.fX<0){this.fX=0}},next:function(){this._parent();this.iPariteX++;if(this.iPariteX===2){this.iPariteX=0;if(this.fY===0){this.iPariteY++}this.iPariteY++;if(this.iPariteY===2){this.iPariteY=0;this.fY+=this.fCellSize;if(this.fY>this.fHalfSizeY-this.fCellSize){if(this.dy===0){this.dy=this.fCellSize*0.5}else{this.dy=0}this.fY=0;this.fX-=this.fCellSize;if(this.fX<this.fCellSize){this.rewind();return true}}}}return false},getPoint:function(){var e=new c.Vector2();if(this.iPariteX&1){e.x=this.fHalfSizeX-this.fX}else{e.x=this.fHalfSizeX+this.fX}if(this.iPariteY&1){e.y=this.fHalfSizeY-this.fY+this.dy}else{e.y=this.fHalfSizeY+this.fY+this.dy}return e}});return a});define("DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndTop",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(a,b,c){var d=a.extend({rewind:function(){this._parent();this.iPariteX=0;this.iPariteY=0;this.fX=0;this.dx=0;this.fY=this.fHalfSizeY-this.fCellSize;if(this.fY<0){this.fY=0}},next:function(){this._parent();this.iPariteY++;if(this.iPariteY===2){this.iPariteY=0;if(this.fX===0){this.iPariteX++}this.iPariteX++;if(this.iPariteX===2){this.iPariteX=0;this.fX+=this.fCellSize;if(this.fX>this.fHalfSizeX-this.fCellSize){if(this.dx===0){this.dx=this.fCellSize*0.5}else{this.dx=0}this.fX=0;this.fY-=this.fCellSize;if(this.fY<this.fCellSize){this.rewind();return true}}}}return false},getPoint:function(){var e=new b.Vector2();if(this.iPariteX&1){e.x=this.fHalfSizeX-this.fX+this.dx}else{e.x=this.fHalfSizeX+this.fX+this.dx}if(this.iPariteY&1){e.y=this.fHalfSizeY-this.fY}else{e.y=this.fHalfSizeY+this.fY}return e}});return d});define("DS/VCXWebDressup/VCXForegroundNode",["DS/VCXWebDressup/VCXDressupNode","DS/WebappsUtils/WebappsUtils","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXImageManager","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXSmart3DPaperNode"],function(h,g,c,f,e,b,a){var d=h.extend({init:function(i){this._parent(i);return this},dispose:function(){if(this._Smart3DPaperNode){this._Smart3DPaperNode.dispose();this._Smart3DPaperNode=null}this._parent()},_Build:function(m){var l=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");this.setRenderPasses([l.getRenderList("VCXForeground")]);this._currentTime=0;var n=500;var j="fgTextureA";var o=c.ImageUtils.loadTexture(g.getWebappsBaseUrl()+"VCXWebDressup/assets/textures/"+j+".png");o.wrapS=c.RepeatWrapping;o.wrapT=c.RepeatWrapping;o.repeat.set(n,n);this._bodyMat=new c.MeshLambertMaterial({color:"#ffffff",transparent:true,map:o,side:c.DoubleSide});this._bodyMat.force=true;this._MeshNode=b.createRectangleNode({width:1,height:1,fill:true,material:this._bodyMat});var q=new c.Vector2(1000,1000,1);var p=this.Modifiable.ExperienceBase.getManager("VCXPaperManager");if(p){q=p.Size;this._MeshNode.setMatrix(new c.Matrix4().makeScale(q.x,q.y,1))}var i=new c.Matrix4();i.multiply(new c.Matrix4().makeScale(q.x*100,q.y*100,1));i.multiply(new c.Matrix4().makeRotationAxis(new c.Vector3(0,0,1),Math.PI*0.3));i.multiply(new c.Matrix4().makeTranslation(-0.5,-0.5,0));this._MeshNode.setMatrix(i);this._MeshNode.setVisibilityInTree(false);var k={name:"ForegroundSmartNode",experience:this.ExperienceBase,};this._Smart3DPaperNode=new a(k);this._Smart3DPaperNode.Position2D.x=q.x*0.5;this._Smart3DPaperNode.Position2D.y=q.y*0.5;this._Smart3DPaperNode.BillboardType=2;this._Smart3DPaperNode.SizeControlType=1;this._Smart3DPaperNode.PositioningType=1000;this._Smart3DPaperNode.Depth=0;this._Smart3DPaperNode.add(this._MeshNode);this.add(this._Smart3DPaperNode);this.RecursiveSetPickParent(true);this.setPickParent(false);this.traverse(function(s,r){if(s.setPickable){s.setPickable(e.NODRAWHL)}if(s.exludeFromBounding){s.exludeFromBounding(r)}if(s.excludeFromHighlight){s.excludeFromHighlight(r,r)}if(s.setFrustumCulled){s.setFrustumCulled(false)}if(s.setShadow){s.setShadow(false,false)}if(s.setMirror){s.setMirror(false)}return false},true)},preRender:function(i){if(this._bodyMat){this._currentTime+=0.01;this._bodyMat.opacity=this._globalOpacity*(Math.cos(this._currentTime)*0.4+0.6)}if(this._Smart3DPaperNode){this._Smart3DPaperNode.preRender(i)}},update:function(j){var k=this.Modifiable.ExperienceBase.getManager("VCXDRMManager");var i=0;if(k.GetDisplayWatermark()){i=1}if(this._globalOpacity!==i){this._globalOpacity=i;var l=(this._globalOpacity>0);if(l){if(!this._Smart3DPaperNode){this._Build()}}if(this._Smart3DPaperNode){this._Smart3DPaperNode.setVisibility(l)}}},});return d});define("DS/VCXWebDressup/VCXArrowLinearNode",["DS/VCXWebDressup/VCXArrowNode","DS/Visualization/ThreeJS_DS",],function(c,b){var a=c.extend({init:function(d){this._parent(d)},_ComputePosBuffer:function(f,G,t,A,e){var j=this.GetAnchorWorldMatrix(0,f);var r=new b.Vector3().getPositionFromMatrix(j);var n;if(this.GetPropertyValue("Arrow.Head.2.Position.Is.Paper")){var h=new b.Vector2(this.GetPropertyValue("Arrow.Head.2.Position.X"),this.GetPropertyValue("Arrow.Head.2.Position.Y"));var g=0;if(this.GetPropertyValue("Arrow.Fixed.Length")){g=this.GetPropertyValue("Arrow.Length")}n=this.ExperienceBase.getManager("VCXPaperManager").GetModelPointFromModelPointAndPaperPosition(f,r,h,g)}else{var u=this.GetAnchorWorldMatrix(1,f);n=new b.Vector3().getPositionFromMatrix(u)}var m=f.viewpoint.getEyePosition();var D=new b.Vector3(1,0,0);D.subVectors(n,r);var o=new b.Vector3().subVectors(m,r);var l=new b.Vector3(0,1,0);var p=D.length();var k=o.normalize().dot(D.normalize());if(k===1){}else{l.crossVectors(o,D);l.normalize()}if(this.GetPropertyValue("Arrow.Fixed.Length")){p=this.GetPropertyValue("Arrow.Length")}var E=1;var C=1;if(this.GetPropertyValue("Collab.Is.Paper")){E=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(f,r);C=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(f,n);E*=this.GetPropertyValue("Arrow.Scale");C*=this.GetPropertyValue("Arrow.Scale");if(this.GetPropertyValue("Arrow.Fixed.Length")){p*=E}}var z=this.GetPropertyValue("Arrow.Width.1")*E;var B=0;var F=0;var s=0;if(this.GetPropertyValue("Arrow.Head.ShowMode")){B=this.GetPropertyValue("Arrow.Head.Length")*E;F=this.GetPropertyValue("Arrow.Head.Size")*E;s=this.GetPropertyValue("Arrow.Head.Shape")*E}var x=this.GetPropertyValue("Arrow.Width.2")*C;var y=0;var q=0;var w=0;if(this.GetPropertyValue("Arrow.Head.2.ShowMode")){y=this.GetPropertyValue("Arrow.Head.2.Length")*C;q=this.GetPropertyValue("Arrow.Head.2.Size")*C;w=this.GetPropertyValue("Arrow.Head.2.Shape")*C}var v=0;var d=[];d[v*2+0]=p;d[v*2+1]=0;v++;d[v*2+0]=p-y;d[v*2+1]=x*0.5+q;v++;d[v*2+0]=p-(y+w);d[v*2+1]=x*0.5;v++;d[v*2+0]=B+s;d[v*2+1]=z*0.5;v++;d[v*2+0]=B;d[v*2+1]=z*0.5+F;v++;d[v*2+0]=0;d[v*2+1]=0;v++;d[v*2+0]=d[8];d[v*2+1]=-d[9];v++;d[v*2+0]=d[6];d[v*2+1]=-d[7];v++;d[v*2+0]=d[4];d[v*2+1]=-d[5];v++;d[v*2+0]=d[2];d[v*2+1]=-d[3];v++;for(v=0;v<this._verticesNb;v++){G[v*3+0]=r.x+d[v*2+0]*D.x+d[v*2+1]*l.x;G[v*3+1]=r.y+d[v*2+0]*D.y+d[v*2+1]*l.y;G[v*3+2]=r.z+d[v*2+0]*D.z+d[v*2+1]*l.z;A[v*3+0]=r.x+d[v*2+0]*D.x+d[v*2+1]*l.x;A[v*3+1]=r.y+d[v*2+0]*D.y+d[v*2+1]*l.y;A[v*3+2]=r.z+d[v*2+0]*D.z+d[v*2+1]*l.z}this._fillColorBuffer(t,e);return v},preRender:function(d){this._parent(d)},update:function(){this._parent();if(!this._step){this._step=this._getArrowStep()}this._updateNodePresence();if(this._globalOpacity<=0){return}if(this._Node){this._updateArrowMaterialsParameters();this.handleLayers()}},_updateNodePresence:function(){if((!this._Node&&this.GlobalOpacity>0)||this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var d=(this._globalOpacity>0);if(d&&!this._Node){this._Build()}if(this._Node){this._Node.setVisibility(d)}}},_getArrowStep:function(){return 1},updateInteractors:function(n){if(!this.isNodeBuilt()){return}this.updateAnchorsInteractors(n);if(this.Modifiable.GetPropertyValue("Arrow.Head.2.Position.Is.Paper")){var i=this.Modifiable.QueryInterface("VCXIManipulable");if(!i){return}var p=i.getAllInteractors();var l=p["Interactor Anchor.1"];var m=this.Modifiable.GetAnchorWorldMatrix(0,n);var k=new b.Vector3().getPositionFromMatrix(m);var e=this._ExperienceBase.getManager("VCXContextManager");var j=e.getMainViewer();var o=this._ExperienceBase.getManager("VCXPaperManager");var h={viewer:j,viewpoint:j.currentViewpoint};var g=o.ModelToMM2(h,k);var d=new b.Vector3(this.Modifiable.GetPropertyValue("Arrow.Head.2.Position.X")+g.x,this.Modifiable.GetPropertyValue("Arrow.Head.2.Position.Y")+g.y,g.z);var q=o.MMToModel2(h,d);var f=this.Modifiable.GetAnchorWorldMatrix(1,n);f.setPosition(q);l.matrix=f}},});return a});define("DS/VCXWebDressup/VCXArrowLinearSGNodeHolder",["DS/VCXWebDressup/VCXArrowSGNodeHolder","DS/VCXWebDressup/VCXArrowLinearNode"],function(c,a){var b=c.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Linear Arrow",modifiable:d,};this._sgNode=new a(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Arrow.png")}return this._parent()},});return b});define("DS/VCXWebDressup/VCXDressupOrganisationShapeLeft",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(a,b,d){var c=a.extend({rewind:function(){this._parent();this.iPariteY=0;this.fX=this.fHalfSizeX-this.fCellSize;if(this.fX<0){this.fX=0}this.dy=0;this.fY=0},next:function(){this._parent();if(this.fY===0){this.iPariteY++}this.iPariteY++;if(this.iPariteY===2){this.iPariteY=0;this.fY+=this.fCellSize;if(this.fY>this.fHalfSizeY-this.fCellSize){if(this.dy===0){this.dy=this.fCellSize*0.5}else{this.dy=0}this.fY=0;this.fX-=this.fCellSize;if(this.fX<-this.fHalfSizeX+this.fCellSize){this.rewind();return true}}}return false},getPoint:function(){var e=new b.Vector2();e.x=this.fHalfSizeX-this.fX;if(this.iPariteY&1){e.y=this.fHalfSizeY-this.fY+this.dy}else{e.y=this.fHalfSizeY+this.fY+this.dy}return e}});return c});define("DS/VCXWebDressup/VCXViewportNode",["DS/Visualization/Node3D","DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXForegroundNode","DS/VCXWebDressup/VCXBackgroundNode","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebKernelTools/VCXMathTools"],function(f,e,b,d,a,c,g){var h=e.extend({init:function(i){this._parent(i);this._foreground=new d(i);this.add(this._foreground);this._background=new a(i);this.add(this._background);this._viewpointNode=new f();this.add(this._viewpointNode);this.lightingModeObserver=new c();this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Intensity");this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Mode");this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Static");return this},dispose:function(){if(this._foreground){this._foreground.dispose();this._foreground=null}if(this._background){this._background.dispose();this._background=null}this.lightingModeObserver=null;this._parent()},preRender:function(i){this._foreground.preRender(i);this._background.preRender(i);if(i&&i.viewpoint){this._viewpointNode.setMatrix(i.viewpoint.camera.matrix.clone().setPosition(new b.Vector3(0,0,0)))}},update:function(i){this._parent();if(this.lightingModeObserver){this.lightingModeObserver.update();if(this.lightingModeObserver.isDirty()){this.Modifiable.GetObject().setLightingMode(this.GetPropertyValue("Render.Lighting.Mode"),this.GetPropertyValue("Render.Lighting.Intensity"),this.GetPropertyValue("Render.Lighting.Static"))}}this._foreground.update(i);this._background.update(i)},postUpdate:function(i){this._parent();if(this.lightingModeObserver){this.lightingModeObserver.postUpdate()}},getViewpointNode:function(){return this._viewpointNode}});return h});define("DS/VCXWebDressup/VCXViewportSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXViewportNode"],function(a,c){var b=a.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Viewport",modifiable:d,};this._sgNode=new c(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ViewportLeaf.png")}return this._parent()},});return b});define("DS/VCXWebDressup/VCXCameraNode",["DS/Mesh/MeshUtils","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXExtremityNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebKernelTools/VCXMathTools","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXComponentMarkup"],function(d,i,j,c,b,h,g,e,f,k){var a=j.extend({init:function(l){this._parent(l);this._Node=null;return this},_getPosVectArray:function(){if(!this.matrixAndDOI){var s=this.Modifiable.QueryInterface("VCXIViewpointController");if(!s){return}this.matrixAndDOI=s.getMatrixAndDOI()}var v=[];var o=-this.matrixAndDOI.doi;var t=Math.abs(Math.tan(Math.PI*this.GetPropertyValue("Camera.Angle")/360)*o);var x=1;var w=this.Modifiable.ExperienceBase.getManager("VCXPaperManager");if(w){x=w.Ratio}var n=t/x;var l=new g.Vector3(0,0,0);v.push(l);var q=new g.Vector3(0,0,-this.matrixAndDOI.doi);v.push(q);var u=new g.Vector3(-n,t,o);v.push(u);var m=new g.Vector3(n,t,o);v.push(m);var p=new g.Vector3(-n,-t,o);v.push(p);var r=new g.Vector3(n,-t,o);v.push(r);return v},_ComputePosBuffer:function(m){var n=this._getPosVectArray();if(!(Array.isArray(n)&&n.length>0)){return n}var o=n.length;for(var l=0;l<o;l++){m[3*l+0]=n[l].x;m[3*l+1]=n[l].y;m[3*l+2]=n[l].z}return o},dispose:function(){if(this._CameraBodyNode){this._CameraBodyNode.dispose();this._CameraBodyNode=null}if(this._targetExtremityNode){this._targetExtremityNode.dispose();this._targetExtremityNode=null}this._parent()},_Build:function(p){if(!this._Node){this._Node=new e();this.add(this._Node)}if(!this._FrustrumNode&&this.GetPropertyGroupVisibility("Group.Collab.Gizmo")){var n=this._getPosVectArray();var u=new Uint16Array([0,1,0,2,0,3,0,4,0,5,2,3,3,5,5,4,4,2]);var v={type:i.ELineType.Plain,lineWidth:1,color:new g.Color().setRGB(1,1,1)};this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(v,this._lineMaterial);var t={points:n,idx:u,editable:true,drawMode:d.ConnectivityTypeEnum.LINES,material:this._lineMaterial};this._FrustrumNode=f.createLineNode(t);this._FrustrumNode.setVisibilityInTree(false);this._FrustrumNode.setPickParent(true);this._Node.addChild(this._FrustrumNode)}if(!this._targetExtremityNode&&this.GetPropertyGroupVisibility("Group.Collab.Gizmo")){var o={name:"TargetExtremity",modifiable:this.Modifiable,type:k.EExtremityType.Dot};this._targetExtremityNode=new c(o);this.add(this._targetExtremityNode)}if(!this._CameraBodyNode){this._bodyMat=new g.MeshLambertMaterial({side:g.DoubleSide});this._bodyMat.force=true;var s=f.createCuboidNode({cornerPoint:new g.Vector3(-8,-10,0),firstAxis:new g.Vector3(16,0,0),secondAxis:new g.Vector3(0,20,0),thirdAxis:new g.Vector3(0,0,40),});var q=f.createCuboidNode({cornerPoint:new g.Vector3(-8.1,-8,5),firstAxis:new g.Vector3(16.2,0,0),secondAxis:new g.Vector3(0,16,0),thirdAxis:new g.Vector3(0,0,30),material:this._bodyMat});var r=f.createCuboidNode({cornerPoint:new g.Vector3(-5,-5,-10),firstAxis:new g.Vector3(10,0,0),secondAxis:new g.Vector3(0,10,0),thirdAxis:new g.Vector3(0,0,20),});var m=f.createCylinderNode({bottomCenterPoint:new g.Vector3(-4,20,30),topCenterPoint:new g.Vector3(4,20,30),radius:9,sag:16,material:this._bodyMat});var l=f.createCylinderNode({bottomCenterPoint:new g.Vector3(-4,20,10),topCenterPoint:new g.Vector3(4,20,10),radius:9,sag:16,material:this._bodyMat});var o={name:"CameraBodyNode",experience:this.ExperienceBase,type:this._type};this._CameraBodyNode=new b(o);this._CameraBodyNode.SizeControlType=1;this._CameraBodyNode.ScalingFactor=0.2;this._CameraBodyNode.addChild(s);this._CameraBodyNode.addChild(q);this._CameraBodyNode.addChild(r);this._CameraBodyNode.addChild(m);this._CameraBodyNode.addChild(l);this.add(this._CameraBodyNode);this.traverse(function(x,w){if(x.setFrustumCulled){x.setFrustumCulled(false)}if(x.setShadow){x.setShadow(false,false)}if(x.setMirror){x.setMirror(false)}if(x.setPickParent){x.setPickParent(true)}return false},true);this.setPickParent(false);this._CameraBodyNode.SetReferential(new g.Matrix4())}},preRender:function(m){var n=false;var l=h.getOFromMatrix(this._Node.getMatrix()).sub(m.viewpoint.getEyePosition());if(l.length()*100>this.matrixAndDOI.doi&&l.dot(m.viewpoint.getSightDirection())>0){n=this._visible}else{n=false}this.setVisibility(n);if(n){if(this._CameraBodyNode){this._CameraBodyNode.preRender(m)}if(this._targetExtremityNode){this._targetExtremityNode.preRender(m)}}},update:function(l){this._parent();var n=this.GlobalOpacity;if(this._globalOpacity!==n){this._globalOpacity=n;this._visible=(this._globalOpacity>0);if(this._visible){if(!this._Node){this._Build()}}this.setVisibility(this._visible)}if(this._globalOpacity<=0){return}if(!this._Node){this._Build()}var p=this.Modifiable.QueryInterface("VCXIViewpointController");if(!p){return}this.matrixAndDOI=p.getMatrixAndDOI();if(this.GetPropertyGroupVisibility("Group.Collab.Gizmo")){var m=this._FrustrumNode.getBuffer(d.VertexComponentEnum.POSITION);if(m!==undefined){var r=this._ComputePosBuffer(m);this._FrustrumNode.updateBuffer(d.VertexComponentEnum.POSITION,0,r);this._FrustrumNode.computeBoundingElements()}}else{if(this._targetAxisSystemNode){this._Node.remove(this._targetAxisSystemNode);this._targetAxisSystemNode=null}if(this._positionAxisSystemNode){this._Node.remove(this._positionAxisSystemNode);this._positionAxisSystemNode=null}}if(this._FrustrumNode){this._FrustrumNode.setVisibility(this.GetPropertyGroupVisibility("Group.Collab.Gizmo"))}if(this._targetExtremityNode){this._targetExtremityNode.setVisibility(this.GetPropertyGroupVisibility("Group.Collab.Gizmo"))}this._Node.setMatrix(this.matrixAndDOI.matrix);this._CameraBodyNode.SetReferential(this.matrixAndDOI.matrix);this._targetExtremityNode.update(l);if(this._positionAxisSystemNode){var o=new g.Matrix4().getInverse(this.matrixAndDOI.matrix);var s=new g.Matrix4().multiplyMatrices(o,this.GetAnchorWorldMatrix(1,null));this._positionAxisSystemNode.setMatrix(s);this._positionAxisSystemNode.setNoZ(this.GetPropertyValue("Actor.IsAlwaysOnTop"))}if(this._targetAxisSystemNode){var o=new g.Matrix4().getInverse(this.matrixAndDOI.matrix);var s=new g.Matrix4().multiplyMatrices(o,this.GetAnchorWorldMatrix(2,null));this._targetAxisSystemNode.setMatrix(s);this._targetAxisSystemNode.setNoZ(this.GetPropertyValue("Actor.IsAlwaysOnTop"))}if(this._targetExtremityNode){this._targetExtremityNode.SetReferential(h.getMatrixFromOVx(this.matrixAndDOI.target,h.getVzFromMatrix(this.matrixAndDOI.matrix)))}if(this._bodyMat){var t=this.GetColorPropertyValue("Actor");this._bodyMat.color=t.GetThreeColor();this._bodyMat.opacity=this._globalOpacity;this._bodyMat.opacity*=t.a}if(this._lineMaterial){var q=this.GetColorPropertyValue("Collab.Gizmo.Line");this._lineMaterial.color=q.GetThreeColor();this._lineMaterial.opacity=this._globalOpacity*q.a;this._lineMaterial.setLineWidth(this.GetPropertyValue("Collab.Gizmo.Line.Width"))}this.handleLayers()},});return a});define("DS/VCXWebDressup/VCXCameraSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXCameraNode"],function(a,c){var b=a.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Camera",modifiable:d,};this._sgNode=new c(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Camera.png")}return this._parent()},});return b});define("DS/VCXWebDressup/VCXPanelModifiable",["DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueString"],function(d,e,c,a){var b=d.extend({init:function(){this._bIsPanel=true;this._parent()},Build:function(){this._parent();var f=[{Name:"Collab.Text.Show",DefaultValue:false},{Name:"Collab.Body.InnerMargin",DefaultValue:0},{Name:"Collab.Body.Shape",DefaultValue:e.EBodyShape.Rectangle},{Name:"Collab.Body.Width",DefaultValue:100},{Name:"Collab.Body.Height",DefaultValue:100},{Name:"Collab.Border.Show",DefaultValue:false},{Name:"Collab.Background.Show",DefaultValue:false},{Name:"Collab.Image.Show",DefaultValue:true},{Name:"Collab.Attach.Show",DefaultValue:true},{Name:"Collab.3D.Paper.Billboard.Type",DefaultValue:2},{Name:"Collab.3D.Paper.Referential.In.World",DefaultValue:false},{Name:"Collab.3D.Paper.Size.Control.Type",DefaultValue:1},{Name:"Actor.IsAlwaysOnTop",DefaultValue:true},{Name:"Collab.Body.VAlignment",DefaultValue:e.EVAlignment.Bottom},{Name:"Collab.3D.Paper.Positioning.Type",DefaultValue:e.EPositionType.Free2D},];this._BuildPropertyValues(f)},});return b});define("DS/VCXWebDressup/VCXDiggerPanelModifiable",["DS/VCXWebDressup/VCXPanelModifiable","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebProperties/VCXPropertyValueString"],function(b,c,a){var d=b.extend({init:function(){this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.AssociatedObjectID",Type:a,DefaultValue:""},];this._BuildPropertyValues(e)},});return d});define("DS/VCXWebDressup/VCXDressupOrganisationShapeTopAndRight",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(a,b,c){var d=a.extend({rewind:function(){this._parent();this.iSwap=0;this.iPariteX=0;this.iPariteY=0;this.fX=0;this.dx=0;this.fY=this.fHalfSizeY-this.fCellSize;if(this.fY<0){this.fY=0}this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize;this.LRiPariteX=0;this.LRiPariteY=0;this.LRfX=this.fHalfSizeX-this.fCellSize;if(this.LRfX<0){this.LRfX=0}this.LRdy=0;this.LRfY=0;this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){this._parent();this.iSwap++;if(this.iSwap&1){this.LRiPariteY++;if(this.LRiPariteY===2){this.LRiPariteY=0;this.LRfY+=this.fCellSize;if(this.LRfY>this.fHalfSizeY-this.fCellSize){if(this.LRdy===0){this.LRdy=this.fCellSize*0.5}else{this.LRdy=0}this.LRfY=0;this.LRfX-=this.fCellSize;if(this.LRfX<this.fCellSize){this.rewind();return true}}}}else{if(this.fX==0){this.iPariteX++}this.iPariteX++;if(this.iPariteX===2){this.iPariteX=0;this.fX+=this.fCellSize;if(this.fX>this.maxfx){this.maxfx-=this.fCellSize;if(this.maxfx<this.fCellSize){this.maxfx=this.fCellSize}if(this.dx===0){this.dx=this.fCellSize*0.5}else{this.dx=0}this.fX=0;this.fY-=this.fCellSize;if(this.fY<this.fCellSize){this.rewind();return true}}}}return false},getPoint:function(){var e=new b.Vector2();if(this.iSwap&1){e.x=this.fHalfSizeX+this.LRfX;if(this.LRiPariteY&1){e.y=this.fHalfSizeY-this.LRfY+this.LRdy}else{e.y=this.fHalfSizeY+this.LRfY+this.LRdy}}else{if(this.iPariteX&1){e.x=this.fHalfSizeX-this.fX+this.dx}else{e.x=this.fHalfSizeX+this.fX+this.dx}e.y=this.fHalfSizeY-this.fY}return e}});return d});define("DS/VCXWebDressup/VCXPolylineModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueVector"],function(i,j,d,c,m,b,g,k,l,a,h,e){var f=d.extend({init:function(){this._bIsPolyline=true;this._parent()},Build:function(){this._parent();var n=this._generateMapChoiceFromEnumAndId(i.ELineType,"Collab.DashType");var o=[{Name:"Polyline.Is.Closed",Type:b,DefaultValue:false},{Name:"Collab.Body.Line.UseHiddenStyle",Type:b,DefaultValue:false},{Name:"Collab.Body.Line.Color",Type:l,DefaultValue:new m().FromRGBA(0,0,0,1),GroupId:"Group.FrontLine"},{Name:"Collab.Body.Line.Color.Opacity",Type:k,DefaultValue:1,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.FrontLine"},{Name:"Collab.Body.Line.Width",Type:k,DefaultValue:2,GroupId:"Group.FrontLine"},{Name:"Collab.Body.Line.Type",Type:a,DefaultValue:i.ELineType.Plain,GroupId:"Group.FrontLine",MapChoice:n},{Name:"Collab.Body.Line.StipplingMotif",Type:h,DefaultValue:"0",GroupId:"Group.FrontLine"},{Name:"Collab.Body.Line.Back.Color",Type:l,DefaultValue:new m().FromRGBA(0.5,0.5,0.5,1),GroupId:"Group.BackLine"},{Name:"Collab.Body.Line.Back.Color.Opacity",Type:k,DefaultValue:0.5,Bounds:{Min:0,Max:1,Step:0.01},GroupId:"Group.BackLine"},{Name:"Collab.Body.Line.Back.Type",Type:a,DefaultValue:i.ELineType.SmallDash,GroupId:"Group.BackLine",MapChoice:n},{Name:"Collab.Body.Line.Back.Width",Type:k,DefaultValue:1.5,GroupId:"Group.BackLine"},{Name:"Collab.Body.Line.Back.StipplingMotif",Type:h,DefaultValue:"0",GroupId:"Group.BackLine"},{Name:"Collab.ListAnchorsIDs",Type:e,DefaultValue:[]}];this._BuildPropertyValues(o)},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Actor.Color",false);this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=false;this.SetPropertyInvisible("Collab.Body.Line.UseHiddenStyle",this.GetPropertyValue("Actor.IsAlwaysOnTop")===true);this.SetPropertyInvisible("Collab.Body.Line.Back.Color",this.GetPropertyValue("Actor.IsAlwaysOnTop")===true||this.GetPropertyValue("Collab.Body.Line.UseHiddenStyle")===false);this.SetPropertyInvisible("Collab.Body.Line.Back.Color.Opacity",this.GetPropertyValue("Actor.IsAlwaysOnTop")===true||this.GetPropertyValue("Collab.Body.Line.UseHiddenStyle")===false);this.SetPropertyInvisible("Collab.Body.Line.Back.Type",this.GetPropertyValue("Actor.IsAlwaysOnTop")===true||this.GetPropertyValue("Collab.Body.Line.UseHiddenStyle")===false);this.SetPropertyInvisible("Collab.Body.Line.Back.Width",this.GetPropertyValue("Actor.IsAlwaysOnTop")===true||this.GetPropertyValue("Collab.Body.Line.UseHiddenStyle")===false);this.SetPropertyInvisible("Collab.Body.Line.StipplingMotif",this.GetPropertyValue("Collab.Body.Line.Type")!==i.ELineType.UserDefined);this.SetPropertyInvisible("Collab.Body.Line.Back.StipplingMotif",this.GetPropertyValue("Collab.Body.Line.Back.Type")!==i.ELineType.UserDefined);this.SetPropertyInvisible("Collab.ListAnchorsIDs",true)},RequestModification:function(p){var o=new c();if(p){if(p.GetPropertyInfo().GetPropertyName()==="Actor.Color"){var n=p.GetPropertyValue().Value.getAssociatedColors();o.AddOrModifyProperty(this.GetNewProperty("Collab.Body.Line.Color",n.body));o.AddOrModifyProperty(this.GetNewProperty("Collab.Body.Line.Back.Color",n.border))}else{o.AddOrModifyProperty(p)}}return o}});return f});define("DS/VCXWebDressup/VCXSectionNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D"],function(f,c,e,b,d){var a=f.extend({init:function(g){this._parent(g);return this},_Build:function(g){this._bodyMat=new c.MeshBasicMaterial({side:c.DoubleSide,transparent:true,opacity:1,force:true});this._bodyMat.line=new c.LineBasicMaterial({side:c.DoubleSide,transparent:true,opacity:1,force:true,polygonBorderMode:true,lineWidth:2});this._MeshNode=b.createRectangleNode({width:1,height:1,fill:true,material:this._bodyMat});this._MeshNode.setVisibilityInTree(false);this._MeshNode.setMatrix(new c.Matrix4().makeTranslation(-0.5,-0.5,0));this._MeshNodeHolder=new d();this.add(this._MeshNodeHolder);this._MeshNodeHolder.add(this._MeshNode);this._MeshNodeHolder.setPickingPriorityId("VCXSection");this._MeshNode.setPickingPriorityId("VCXSection");this.exludeFromBounding(true);this.RecursiveSetPickParent(true);this.setPickParent(false);this.traverse(function(i,h){if(i.setFrustumCulled){i.setFrustumCulled(false)}if(i.setShadow){i.setShadow(false,false)}if(i.setMirror){i.setMirror(false)}return false},true)},preRender:function(i){if(this._globalOpacity>0){var l=this.Modifiable.GetObject();if(l._plane){var r=this.Modifiable.ExperienceBase.getManager("VCXContextManager");if(r){var o=this.Modifiable.GetObject().getWorkingRootPathElement();if(o){var w=this.Modifiable.QueryInterface("W3AISGNodeHolder");var h=w.getWorldMatrix(i.viewer);var t=new c.Matrix4().getInverse(h);var j=o.getBoundingBox(null,i.viewer);j.applyMatrix4(o.getWorldMatrix(i.viewer));var y=j.size();var p=[j.min.clone(),new c.Vector3(j.min.x+y.x,j.min.y,j.min.z),new c.Vector3(j.min.x,j.min.y+y.y,j.min.z),new c.Vector3(j.min.x,j.min.y,j.min.z+y.z),j.max.clone(),new c.Vector3(j.max.x-y.x,j.max.y,j.max.z),new c.Vector3(j.max.x,j.max.y-y.y,j.max.z),new c.Vector3(j.max.x,j.max.y,j.max.z-y.z),];var s=[];for(var n=0;n<p.length;++n){var k=l._plane.projectPoint(p[n]);s.push(k)}var u=s[0].clone().applyMatrix4(t),x=s[0].clone().applyMatrix4(t);for(var z=1;z<s.length;++z){var g=s[z].clone().applyMatrix4(t);u.min(g);x.max(g)}var q=u.clone().applyMatrix4(h);var v=x.clone().applyMatrix4(h);var m=new c.Vector3().addVectors(v,q).multiplyScalar(0.5);h.setPosition(m);this.setMatrix(h);if(this._MeshNodeHolder){this._MeshNodeHolder.setMatrix(new c.Matrix4().makeScale(x.x-u.x,x.y-u.y,1).setPosition(new c.Vector3(0,0,-x.length()*0.001)))}}}}}},update:function(q){this._parent();var k=false;var g=this.Modifiable.QueryInterface("VCXIVisibility");if(g){k=g.GetVisibility()}var p=this.GetPropertyValue("Section.Plane.Enable")?this.GlobalOpacity:0;if(this._globalOpacity!==p){this._globalOpacity=p;var i=(this._globalOpacity>0);if(i){if(!this._MeshNode){this._Build()}}this.setVisibility(i)}var m=this.Modifiable.GetObject()._cappingMaterial;if(m&&k){var n=Math.cos(this.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180);var h=Math.sin(this.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180);var j=this.GetColorPropertyValue("Section.Capping");var r=this.GetColorPropertyValue("Section.Hatching");var o=this.GetPropertyValue("Section.Hatching.Frequency");m.stripesDirection=new c.Vector2(n+h,h-n);m.spaceWidth=500/(o+1);m.stripesWidth=Boolean(o)?1.5:0;m.spaceColor=j.GetThreeColor();m.stripesColor=r.GetThreeColor();if(m.autoSpaceColor!==this.GetPropertyValue("Section.Capping.ActorColor")){m.autoSpaceColor=this.GetPropertyValue("Section.Capping.ActorColor")}}if(this._globalOpacity<=0){return}if(this._bodyMat){this._bodyMat.opacity=this._globalOpacity}var l=this.GetColorPropertyValue("Actor");if(this._bodyMat&&this._bodyMat.line){this._bodyMat.line.color=l.GetThreeColor();this._bodyMat.line.opacity=1;this._bodyMat.color=l.GetThreeColor()}this.handleLayers()},});return a});define("DS/VCXWebDressup/VCXSectionSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXSectionNode"],function(b,a){var c=b.extend({init:function(){},getWorldMatrix:function(e){var d=this.getAnchorReferential();var f=this.QueryInterface("VCXIModifiable");if(f){this._actorPosition=f.GetFramePropertyValue("Actor.Position");if(this._actorPosition){d.multiply(this._actorPosition)}}return d},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Section",modifiable:d,};this._sgNode=new a(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Section.png")}return this._parent()},});return c});define("DS/VCXWebDressup/VCXAssociativePathNode",["DS/CoreEvents/Events","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXComponentPath","DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebDressup/VCXPathNode","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory"],function(a,h,i,j,e,c,g,b,f){var d=e.extend({init:function(k){this._parent(k);this._bReprocessPosInfos=true;this._linkedModifiable=null;this._pathParams=null;this._positionsArray=null;this._propValuePosition=null;this._neutralPosition=null;this._trackPositionsNb=1024;var l=this;this._keyChangedEvtToken=a.subscribe({event:"VCX_KEYS_CHANGED",},function(n){if(!n||!l._linkedModifiable){return}var m=l._linkedModifiable.GetHashing();if(m&&(n.setModifiablesTrackModified[m]||n.setModifiablesTrackRemoved[m])){l._bReprocessPosInfos=true;l.Modifiable&&l.Modifiable.GetObject().setDirty()}});this._propChangedEvtToken=a.subscribe({event:"VCX_PROPERTIES_CHANGED",},function(q){if(!q){return}var p=this._linkedModifiable&&q.GetProperty(this._linkedModifiable.GetHashing(),"Actor.Position");if(!p){return}var r=this.ExperienceBase.getManager("VCXScenarioManager");var o=r&&r.GetScenarios();var m=r&&r.GetCurrentScenario();var n=o&&o[m];if(n&&!n.HasAnimation()){l._bReprocessPosInfos=true;l.Modifiable&&l.Modifiable.GetObject().setDirty()}});this._tokenScenarioChanged=a.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(m){l._bReprocessPosInfos=true;l.Modifiable&&l.Modifiable.GetObject().setDirty()});return this},dispose:function(){if(this._keyChangedEvtToken!==null){a.unsubscribe(this._keyChangedEvtToken);this._keyChangedEvtToken=null}if(this._propChangedEvtToken!==null){a.unsubscribe(this._propChangedEvtToken);this._propChangedEvtToken=null}if(this._tokenScenarioChanged!==null){a.unsubscribe(this._tokenScenarioChanged);this._tokenScenarioChanged=null}},_getPosVectArray:function(){if(!this._linkedModifiable){var k=Object.keys(this.Modifiable._Anchors)[0];var p=this.Modifiable._Anchors[k].GetValueLink();var o=this.ExperienceBase.ComponentsMap.GetComponentFromLink(this.Modifiable._Anchors[k].GetValueLink());this._linkedModifiable=o.QueryInterface("VCXIModifiable")}this._pathParams=this._getAssoPathParameters();var s=this._getPosInfosInWCS();if(!s){return}var r=[];if(this.GetPropertyValue("Collab.Path.ConstructMode")===i.EConstructMode.PathClassic){if(this.GetPropertyValue("Collab.Path.IsFromNeutral")){r.push(this._getPathFirstVertexPos());r.push(this._getPathLastVertexPos())}else{if(!this._pathParams.track){for(n=0;n<=this._trackPositionsNb-1;++n){r.push(s.tracks[0])}}else{var q=this._pathParams.currentScenario;var n=0;var m=q.GetCurrentFrame();var t=this._pathParams.currentScenario.GetMaxFrame();var l=-1;if(this.GetPropertyValue("Collab.Path.IsFull")){l=this._trackPositionsNb-1}else{l=Math.floor((this._trackPositionsNb-1)*m/t)}for(n=0;n<=l;++n){r.push(s.tracks[n])}for(n=l+1;n<=this._trackPositionsNb-1;++n){r.push(s.tracks[l])}}}}else{r=this._getPathAxisPositions()}this._pathParams=null;this._lnkModBSphereFrame=null;this._assyMatrixInWCS=null;return r},_getAssoPathParameters:function(){var q=this.ExperienceBase.getManager("VCXScenarioManager");var o=q.GetScenarios();var l=q.GetCurrentScenario();var n=o[l];var p=this._linkedModifiable.QueryInterface("VCXIModelNavigable").getParent();var r=p&&p.GetObject();var m=null;if(n.HasAnimation()){var k=n.GetObjectAnimation(this._linkedModifiable.GetHashing());m=k&&k.GetTrack("Actor.Position")}return{currentScenario:n,parentComponent:r,track:m}},_getPosInfosInWCS:function(){if(this._bReprocessPosInfos){if(this._pathParams.track){this._positionsArray=this._getFullPathPosFromTrack()}this._propValuePosition=this._getPathPositionForPropValue();this._neutralPosition=this._getPathPositionForNeutral();this._bReprocessPosInfos=false}return{tracks:this._positionsArray,propValue:this._propValuePosition,neutral:this._neutralPosition}},_getFullPathPosFromTrack:function(){var m=[];var q=this._pathParams.currentScenario.GetMaxFrame();var o=this._pathParams.currentScenario.GetCurrentFrame();var n=this._trackPositionsNb;for(var l=0;l<n;++l){var p=l*q/n;var k=this._getBSphereCenterPosInWCSFromFrameNb(p);m.push(k)}return m},_getPathPositionForPropValue:function(){var k=this._linkedModifiable.GetProperty("Actor.Position");var m=k&&k.GetPropertyValue().GetFrame().GetValue();var n=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();var l=!this._pathParams.parentComponent?m:this._pathParams.parentComponent.QueryInterface("W3AISGNodeHolder").getMatrixInWCS(n,m);return this._getBSphereCenterPosInWCSFromMatrix(l)},_getPathPositionForNeutral:function(){var m=null;if(!this._pathParams.track||this._pathParams.track._treekeys.size===1||!this._pathParams.track.GetKey(0)){var l=this.ExperienceBase.getManager("VCXScenarioManager").GetNeutrals(this._linkedModifiable.GetHashing());m=l.GetProperty("Actor.Position").GetPropertyValue()}else{m=this._pathParams.track.GetKey(0).GetValue()}var k=m.GetFrame().GetValue();var o=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();var n=!this._pathParams.parentComponent?k:this._pathParams.parentComponent.QueryInterface("W3AISGNodeHolder").getMatrixInWCS(o,k);return this._getBSphereCenterPosInWCSFromMatrix(n)},_getPathFirstVertexPos:function(){var k=null;if(this.GetPropertyValue("Collab.Path.IsFromNeutral")||!this._pathParams.track||this._pathParams.track._treekeys.size===1||!this._pathParams.track.GetKey(0)){return this._getPosInfosInWCS().neutral}else{return this._getPosInfosInWCS().tracks[0]}},_getPathLastVertexPos:function(){var n=this._getPosInfosInWCS();if(this._pathParams.track){var l=this._pathParams.currentScenario.GetCurrentFrame();var m=this._pathParams.currentScenario.GetMaxFrame();var k=Math.floor((n.tracks.length-1)*l/m);return n.tracks[k]}else{return n.propValue}},_getCurrentPointsNumber:function(){if(this.GetPropertyValue("Collab.Path.IsFromNeutral")&&this.GetPropertyValue("Collab.Path.ConstructMode")===i.EConstructMode.PathClassic){return 2}else{return this._parent()}},_getPtsNbForPathClassicFromAnimation:function(){return this._trackPositionsNb},_getBSphereCenterLocalMat:function(n){if(!this._lnkModBSphereFrame){var m=n.QueryInterface("W3AISGNodeHolder");var l=m.getPathElement();var o=l.getLastElement(true).getBoundingSphere().center;var k=new g.Matrix4().setPosition(o);this._lnkModBSphereFrame=k}return this._lnkModBSphereFrame},_getBSphereCenterPosInWCSFromFrameNb:function(k){if(!this._pathParams){return}var l=c.GetFrameInWCSAtTime(this.ExperienceBase.getManager("VCXScenarioManager"),this._pathParams.currentScenario,this._linkedModifiable,k,this._pathParams.track);return this._getBSphereCenterPosInWCSFromMatrix(l)},_getBSphereCenterPosInWCSFromMatrix:function(k){var m=this._getBSphereCenterLocalMat(this._linkedModifiable);var l=new g.Matrix4().copy(k).multiply(m);return new g.Vector3().getPositionFromMatrix(l)},_getAssyCurrentFrameInWCS:function(){if(!this._assyMatrixInWCS){if(this._pathParams.track){var l=this._pathParams.currentScenario.GetCurrentFrame();this._assyMatrixInWCS=c.GetFrameInWCSAtTime(this.ExperienceBase.getManager("VCXScenarioManager"),this._pathParams.currentScenario,this._linkedModifiable,l,this._pathParams.track)}else{var k=this.GetFramePropertyValue("Actor.Position");var m=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();this._assyMatrixInWCS=!this._pathParams.parentComponent?k:this._pathParams.parentComponent.QueryInterface("W3AISGNodeHolder").getMatrixInWCS(m,k)}}return this._assyMatrixInWCS},});return d});define("DS/VCXWebDressup/VCXAssociativePathSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXAssociativePathNode"],function(a,c){var b=a.extend({init:function(){},getWorldMatrix:function(g){var e=this.GetObject()._experienceBase.getManager("VCXContextManager");var f=this.GetObject().getWorkingRootPathElement();var d=f.getWorldMatrix(e.getMainViewer());var h=this.QueryInterface("VCXIModifiable");if(h){this._actorPosition=h.GetFramePropertyValue("Actor.Position");if(this._actorPosition){d.multiply(this._actorPosition)}return d}},buildSGNode:function(){if(!this._sgNode){var e=this.GetObject().QueryInterface("VCXIModifiable");var d=e.GetPropertyValue("Collab.Path.IsFromNeutral")?"From Neutral":"";var f={name:"Associative Path"+d,modifiable:e,};this._sgNode=new c(f);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_AnimationPathLeaf.png")}return this._parent()},unreferenceSGNode:function(){if(this._sgNode){this._sgNode.dispose();delete this._sgNode}},});return b});define("DS/VCXWebDressup/VCXDressupOrganisationShapeBottom",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(b,c,d){var a=b.extend({rewind:function(){this._parent();this.iPariteX=0;this.fX=0;this.dx=0;this.fY=this.fHalfSizeY-this.fCellSize;if(this.fY<0){this.fY=0}},next:function(){this._parent();if(this.fX===0){this.iPariteX++}this.iPariteX++;if(this.iPariteX===2){this.iPariteX=0;this.fX+=this.fCellSize;if(this.fX>this.fHalfSizeX-this.fCellSize){if(this.dx===0){this.dx=this.fCellSize*0.5}else{this.dx=0}this.fX=0;this.fY-=this.fCellSize;if(this.fY<-this.fHalfSizeY+this.fCellSize){this.rewind();return true}}}return false},getPoint:function(){var e=new c.Vector2();if(this.iPariteX&1){e.x=this.fHalfSizeX-this.fX+this.dx}else{e.x=this.fHalfSizeX+this.fX+this.dx}e.y=this.fHalfSizeY+this.fY;return e}});return a});define("DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndRight",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(a,b,d){var c=a.extend({rewind:function(){this._parent();this.iSwap=0;this.iPariteX=0;this.iPariteY=0;this.fX=0;this.dx=0;this.fY=this.fHalfSizeY-this.fCellSize;if(this.fY<0){this.fY=0}this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize;this.LRiPariteX=0;this.LRiPariteY=0;this.LRfX=this.fHalfSizeX-this.fCellSize;if(this.LRfX<0){this.LRfX=0}this.LRdy=0;this.LRfY=0;this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){this._parent();this.iSwap++;if(this.iSwap&1){this.LRiPariteY++;if(this.LRiPariteY===2){this.LRiPariteY=0;this.LRfY+=this.fCellSize;if(this.LRfY>this.fHalfSizeY-this.fCellSize){if(this.LRdy===0){this.LRdy=this.fCellSize*0.5}else{this.LRdy=0}this.LRfY=0;this.LRfX-=this.fCellSize;if(this.LRfX<this.fCellSize){this.rewind();return true}}}}else{if(this.fX===0){this.iPariteX++}this.iPariteX++;if(this.iPariteX===2){this.iPariteX=0;this.fX+=this.fCellSize;if(this.fX>this.maxfx){this.maxfx-=this.fCellSize;if(this.maxfx<this.fCellSize){this.maxfx=this.fCellSize}if(this.dx===0){this.dx=this.fCellSize*0.5}else{this.dx=0}this.fX=0;this.fY-=this.fCellSize;if(this.fY<this.fCellSize){this.rewind();return true}}}}return false},getPoint:function(){var e=new b.Vector2();if(this.iSwap&1){e.x=this.fHalfSizeX+this.LRfX;if(this.LRiPariteY&1){e.y=this.fHalfSizeY-this.LRfY+this.LRdy}else{e.y=this.fHalfSizeY+this.LRfY+this.LRdy}}else{if(this.iPariteX&1){e.x=this.fHalfSizeX-this.fX+this.dx}else{e.x=this.fHalfSizeX+this.fX+this.dx}e.y=this.fHalfSizeY+this.fY}return e}});return c});define("DS/VCXWebDressup/VCXComponentPanel",["DS/VCXWebDressup/VCXComponentMarkup"],function(a){var b=a.extend({init:function(){this._parent()}});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentPanel"}});b.prototype._dressupFamily="Panels";return b});define("DS/VCXWebDressup/VCXComponentDiggerPanel",["DS/VCXWebDressup/VCXComponentPanel"],function(b){var a=b.extend({init:function(){this._parent()}});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentDiggerPanel"}});a.prototype._dressupFamily="Panels";return a});define("DS/VCXWebDressup/VCXAttachTooltipNode",["DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXExtremityNode","DS/VCXWebKernelTools/VCXMathTools","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D"],function(b,i,h,a,g,e,f,c){var d=h.extend({init:function(j){this._parent(j);this.anchorID=j.anchorID;this._bConsiderCurvature=typeof j.bConsiderCurvature==="boolean"?j.bConsiderCurvature:true;this.updateParams();this._StartExtremity=new f.Vector3();this._EndExtremity=new f.Vector3();this._zValue=new f.Vector3();return this},updateParams:function(){if(!this._bConsiderCurvature){console.log("Shouldn't we consider a curvature at anytime, to be sure ?")}this._bGradientBackGround=this.GetPropertyValue("Collab.Attach.Background.Gradient");this._bGradientBorder=this.GetPropertyValue("Collab.Attach.Border.Gradient");this._step=this._bConsiderCurvature?32:1;this._verticesNb=2*(this._step)+1;this._lineIndicesNb=this._verticesNb*2;var j=2*(this._step)-1;this._trianglesIndicesNb=3*j},dispose:function(){if(this._Node){this.removeChild(this._Node)}},_getAngleBetweenXAxisAndVector:function(m){var j=new f.Vector3(1,0,0),k=new f.Vector3(0,1,0);var l=Math.acos(j.dot(m));if(k.dot(m)<0){l=2*Math.PI-l}return l},_getArcVerticesPosFromStartEndPosRadDiffAndCurvSign:function(A,j,u,p,w){var y=[];var B=new f.Vector3(0,0,1);var q=w?1:-1;var v=new f.Vector3().addVectors(A,j).multiplyScalar(0.5);var o=new f.Vector3().subVectors(A,j);o.cross(B);o.normalize();v.x+=o.x*u;v.y+=o.y*u;var C=new f.Vector3().subVectors(A,v),l=new f.Vector3().subVectors(j,v),n,z,t;if(w){n=C.length();z=this._getAngleBetweenXAxisAndVector(C.normalize());t=this._getAngleBetweenXAxisAndVector(l.normalize())}else{n=l.length();z=this._getAngleBetweenXAxisAndVector(l.normalize());t=this._getAngleBetweenXAxisAndVector(C.normalize())}if((t-z)<0&&p*q===1){z-=2*Math.PI}else{if((t-z)>0&&p*q===-1){t-=2*Math.PI}}var s=0,D;var x=Math.abs((t-z)%(2*Math.PI));for(var m=0;m<=this._step;++m){var k=m/this._step;s=z+p*q*x*k;D=w?(A.z*(1-k)+j.z*k):(A.z*k+j.z*(1-k));var r=new f.Vector3(v.x+n*Math.cos(s),v.y+n*Math.sin(s),D);y.push(r)}return y},_getAttachShapeVerticesPositionsWithCurvature:function(t,l,q,m){var u=[];var A=new f.Vector3(0,0,1);var v=new f.Vector3().subVectors(t,l);var w=0.5*v.length();var y=w;if(m===0){m=0.001}y=Math.abs(y*100/m);var z=(m>0)?-1:1;var r=new f.Vector3().addVectors(t,l).multiplyScalar(0.5);var s=(y-w)*z;v.z=0;v.cross(A);v.normalize();var k=v.clone().multiplyScalar(s);r.add(k);r.z=0;var x=new f.Vector3().subVectors(t,r);x.z=0;x.normalize();var p=new f.Vector3().copy(x).multiplyScalar(2.5*q).add(t),o=new f.Vector3().copy(x).multiplyScalar(-2.5*q).add(t);var n=this._getArcVerticesPosFromStartEndPosRadDiffAndCurvSign(p,l,s,z,true);n.pop();var j=this._getArcVerticesPosFromStartEndPosRadDiffAndCurvSign(o,l,s,z,false);u=n.concat(j);return u},_getAttachShapeVerticesPositionsWithoutCurvature:function(p,k,o){var j=[];var n=new f.Vector3(0,0,1);var m=new f.Vector3().subVectors(p,k);var l=new f.Vector3().crossVectors(m,n).normalize();var r=new f.Vector3().copy(l).multiplyScalar(2.5*o).add(p),q=new f.Vector3().copy(l).multiplyScalar(-2.5*o).add(p);j.push(r);j.push(k);j.push(q);return j},_computePosBuffers:function(t,k,r){var v=this.ExperienceBase.getManager("VCXPaperManager");var w=this.StartExtremity.clone();var o=this.EndExtremity.clone();var x=v.ModelToMM2(t,w);var y=v.ModelToMM2(t,o);var q=this.GetPropertyValue("Collab.Attach.Line.Width");var z;if(this._bConsiderCurvature){var p=this.GetPropertyValue("Collab.Attach.Curvature");z=this._getAttachShapeVerticesPositionsWithCurvature(x,y,q,p)}else{z=this._getAttachShapeVerticesPositionsWithoutCurvature(x,y,q)}var l=[];for(var s=0;s<z.length;++s){var n=z[s];var m=v.MMToModel2(t,n);l.push(m)}var u=l.length;for(var j=0;j<u;++j){k[3*j+0]=l[j].x;k[3*j+1]=l[j].y;k[3*j+2]=l[j].z;r[3*j+0]=l[j].x;r[3*j+1]=l[j].y;r[3*j+2]=l[j].z}},_computeColorBuffers:function(r,o){var q=this.GetColorPropertyValue("Collab.Attach.Line");var n=q.GetRGBA();for(var m=0;m<=this._step;++m){var l=4*m;var k=4*(this._verticesNb-1-m);var p=this._bGradientBackGround?m*n[3]/this._step:n[3];r[l+0]=n[0];r[l+1]=n[1];r[l+2]=n[2];r[l+3]=p;r[k+0]=n[0];r[k+1]=n[1];r[k+2]=n[2];r[k+3]=p;var j=this._bGradientBorder?m*n[3]/this._step:n[3];o[l+0]=0;o[l+1]=0;o[l+2]=0;o[l+3]=j;o[k+0]=0;o[k+1]=0;o[k+2]=0;o[k+3]=j}},_computeBuffers:function(l,m,n,j,k){this._computePosBuffers(l,m,j);this._computeColorBuffers(n,k)},_Build:function(){this._bkGrndPrimGrp=new b.PrimitiveGroup({editable:true});this._borderPrimGrp=new b.PrimitiveGroup({editable:true});var m=new b.Buffer({component:b.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3});var y=new b.Buffer({component:b.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4});var w=new b.Buffer({indexBuffer:true,data:new Uint16Array(this._trianglesIndicesNb)});var x=new b.Buffer({component:b.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3});var n=new b.Buffer({component:b.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4});var p=new b.Buffer({indexBuffer:true,data:new Uint16Array(this._lineIndicesNb)});this._bkGrndPrimGrp.addBuffer(0,m);this._bkGrndPrimGrp.addBuffer(1,y);this._bkGrndPrimGrp.addBuffer(2,w);this._borderPrimGrp.addBuffer(0,x);this._borderPrimGrp.addBuffer(1,n);this._borderPrimGrp.addBuffer(2,p);var s=0,q=0;var l=w.data;var z=this._verticesNb-1;for(q=0;q<this._step-1;++q){l[s++]=q;l[s++]=z-q;l[s++]=z-(q+1);l[s++]=q;l[s++]=z-(q+1);l[s++]=q+1}l[s++]=this._step-1;l[s++]=this._step+1;l[s++]=this._step;l=p.data;for(s=0,q=0;q<this._verticesNb;++q){l[s++]=q;l[s++]=(q!==this._verticesNb-1)?q+1:0}var v=new b.Primitive({nbIndices:this._trianglesIndicesNb,connectivity:b.ConnectivityTypeEnum.TRIANGLES});var k=new b.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new b.IndexArray({bufferId:2,offset:0})});var u=new b.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new b.IndexArray({bufferId:2,offset:0})});v.addVertexComponent(k);v.addVertexComponent(u);this._bkGrndPrimGrp.addPrimitive(v);var o=new b.Primitive({nbIndices:this._lineIndicesNb,connectivity:b.ConnectivityTypeEnum.LINES,geomType:"WIRE_EDGE"});var t=new b.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new b.IndexArray({bufferId:2,offset:0})});var r=new b.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new b.IndexArray({bufferId:2,offset:0})});o.addVertexComponent(t);o.addVertexComponent(r);this._borderPrimGrp.addPrimitive(o);this._bodyMat=new f.MeshBasicMaterial({side:f.DoubleSide,vertexColors:f.VertexColors,color:"#ffffff",transparent:true,opacity:1,force:true,polygonOffset:true,polygonOffsetFactor:1,polygonOffsetUnits:20});this._lineMat=new f.LineBasicMaterial({side:f.DoubleSide,vertexColors:f.VertexColors,color:"#ffffff",transparent:true,opacity:1,polygonBorderMode:false,force:true,polygonOffset:true,polygonOffsetFactor:1,polygonOffsetUnits:10});this._NodeBkGrnd=e.createMeshNode(this._bkGrndPrimGrp);this._NodeBkGrnd.setMaterial(this._bodyMat);this._NodeBkGrnd.setVisibilityInTree(false);this._NodeBorder=e.createMeshNode(this._borderPrimGrp);this._NodeBorder.setMaterial(this._lineMat);this._NodeBorder.setVisibilityInTree(false);this._Node=new c();this._Node.addChild(this._NodeBkGrnd);this._Node.addChild(this._NodeBorder);this.addChild(this._Node);this.traverse(function(j){if(j.setFrustumCulled){j.setFrustumCulled(false)}if(j.setShadow){j.setShadow(false,false)}if(j.setMirror){j.setMirror(false)}if(j.excludeFromHighlight){j.excludeFromHighlight(true,true)}return false});this.RecursiveSetPickParent(true);this.handleLayers(true)},preRender:function(l){var m=this._NodeBkGrnd.getBuffer(b.VertexComponentEnum.POSITION);var n=this._NodeBkGrnd.getBuffer(b.VertexComponentEnum.DIFFUSE_COLOR);var j=this._NodeBorder.getBuffer(b.VertexComponentEnum.POSITION);var k=this._NodeBorder.getBuffer(b.VertexComponentEnum.DIFFUSE_COLOR);if(typeof m!=="undefined"&&typeof n!=="undefined"&&typeof j!=="undefined"&&typeof k!=="undefined"){this._computeBuffers(l,m,n,j,k);this._NodeBkGrnd.updateBuffer(b.VertexComponentEnum.POSITION,0,this._verticesNb);this._NodeBkGrnd.updateBuffer(b.VertexComponentEnum.DIFFUSE_COLOR,0,this._verticesNb);this._NodeBkGrnd.computeBoundingElements();this._NodeBorder.updateBuffer(b.VertexComponentEnum.POSITION,0,this._verticesNb);this._NodeBorder.updateBuffer(b.VertexComponentEnum.DIFFUSE_COLOR,0,this._verticesNb);this._NodeBorder.computeBoundingElements()}},update:function(j){this._parent();if(this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var k=(this._globalOpacity>0);if(k){if(!this._Node){this._Build()}}if(this._Node){this._lineMat.setLineWidth(2);this._Node.setVisibility(k)}if(this._ExtremityNode){this._ExtremityNode.setVisibility(k)}}if(this._globalOpacity<=0){return}if(this._ExtremityNode){this._ExtremityNode.update(j)}if(this._Node){this.updateParams();if(this._bodyMat){this._bodyMat.opacity=this._globalOpacity}if(this._lineMat){this._lineMat.opacity=this._globalOpacity}this.handleLayers()}},postUpdate:function(j){this._parent();if(this._ExtremityNode){this._ExtremityNode.postUpdate(j)}}});Object.defineProperty(d.prototype,"StartExtremity",{enumerable:true,get:function(){return this._StartExtremity},set:function(j){this._StartExtremity=j}});Object.defineProperty(d.prototype,"EndExtremity",{enumerable:true,get:function(){return this._EndExtremity},set:function(j){this._EndExtremity=j}});return d});define("DS/VCXWebDressup/VCXDressupOrganisationShapeRight",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(a,c,d){var b=a.extend({rewind:function(){this._parent();this.iPariteY=0;this.fX=this.fHalfSizeX-this.fCellSize;if(this.fX<0){this.fX=0}this.dy=0;this.fY=0},next:function(){this._parent();if(this.fY===0){this.iPariteY++}this.iPariteY++;if(this.iPariteY===2){this.iPariteY=0;this.fY+=this.fCellSize;if(this.fY>this.fHalfSizeY-this.fCellSize){if(this.dy===0){this.dy=this.fCellSize*0.5}else{this.dy=0}this.fY=0;this.fX-=this.fCellSize;if(this.fX<-this.fHalfSizeX+this.fCellSize){this.rewind();return true}}}return false},getPoint:function(){var e=new c.Vector2();e.x=this.fHalfSizeX+this.fX;if(this.iPariteY&1){e.y=this.fHalfSizeY-this.fY+this.dy}else{e.y=this.fHalfSizeY+this.fY+this.dy}return e}});return b});define("DS/VCXWebDressup/VCXAttachesNode",["DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXAttachSegmentNode","DS/VCXWebDressup/VCXAttachTooltipNode","DS/VCXWebVisualization/VCXInteractor","DS/Visualization/ThreeJS_DS"],function(i,h,a,e,b,f){var c={info:"info",warning:"warning",error:"error"};var d={unsupportedAttach:{level:c.warning,title:"Issue handling attach nodes",message:"Type of attach required for dressup not supported."},noPaperManager:{level:c.warning,title:"Paper manager not found",message:"The paper manager couldn't be fetch."}};var g=h.extend({init:function(j){this._parent(j);this._PanelNode=j.panelNode;this._BentLineSize=2;this._MinAngleAllowed=5;this._horizontalLineMargin=1;this._AttachType=i.ELeadType.Middle;this._AttachNodes={};return this},_getBentLineVerticesPosInPaper:function(l,k){var j=k?-1:1;var n=l.clone();n.x=n.x+j*this._PanelNode.GetShapeInfo().size.x*0.5;var m=n.clone();m.x=m.x+j*this._BentLineSize;return{start:n,end:m}},_getHorizontalLineVerticesPosInPaper:function(m,l,k){var j=l?-1:1;var p=k?-1:1;var o=m.clone();o.x=o.x-j*this._PanelNode.GetShapeInfo().size.x*0.5;o.y=o.y+p*(this._PanelNode.GetShapeInfo().size.y*0.5+this._horizontalLineMargin);var n=o.clone();n.x=n.x+j*this._PanelNode.GetShapeInfo().size.x;return{start:o,end:n}},_checkBreakStillToBeUsedFromBentEndPos:function(m,l,k){var j=new f.Vector3().subVectors(m.EndExtremityPaper,l);var n=k.angleTo(j)*(180/Math.PI);return n<(90+this._MinAngleAllowed)?false:true},_findBestCorner:function(j,k){return({left:j.x>k.EndExtremityPaper.x,top:j.y>k.EndExtremityPaper.y})},_ComputePosLinesAttaches:function(q,r){var p=null,t=null;var C=true;var B=true;var D;var j;var x=new f.Vector3().getPositionFromMatrix(this._PanelNode.GetShapeInfo().smartNode.getMatrix());var o=r.ModelToMM2(q,x);o.x+=this._PanelNode.GetShapeInfo().center.x;o.y+=this._PanelNode.GetShapeInfo().center.y;if(this._AttachType===i.ELeadType.Middle){C=false;B=false}else{if(this._AttachType===i.ELeadType.Line){var y=0;var s=0;for(p in this._AttachNodes){if(this._AttachNodes.hasOwnProperty(p)){t=this._AttachNodes[p];var w=this._findBestCorner(o,t);w.top?y++:y--;w.left?s++:s--}}var v=this._getHorizontalLineVerticesPosInPaper(o,s>0,y>0);var z=this._getHorizontalLineVerticesPosInPaper(o,s<0,y>0);D=r.MMToModel2(q,v.start);j=r.MMToModel2(q,v.end)}else{var v=this._getBentLineVerticesPosInPaper(o,true);var z=this._getBentLineVerticesPosInPaper(o,false);var k=new f.Vector3().subVectors(o,v.end);var E=new f.Vector3().subVectors(o,z.end);for(p in this._AttachNodes){if(this._AttachNodes.hasOwnProperty(p)){if(!C&&!B){break}t=this._AttachNodes[p];C=C&&this._checkBreakStillToBeUsedFromBentEndPos(t,v.end,k);B=B&&this._checkBreakStillToBeUsedFromBentEndPos(t,z.end,E)}}if(C){D=r.MMToModel2(q,v.start);j=r.MMToModel2(q,v.end)}else{if(B){D=r.MMToModel2(q,z.start);j=r.MMToModel2(q,z.end)}}}}for(p in this._AttachNodes){if(this._AttachNodes.hasOwnProperty(p)){t=this._AttachNodes[p];if(this._AttachType===i.ELeadType.Line){t.StartExtremity=D;t.BreakExtremity=j}else{if(C||B){t.StartExtremity=D;t.BreakExtremity=j}else{var A=o.clone();var l=new f.Vector3();t.EndExtremityPaper.sub(A);var n=this._PanelNode.GetShapeInfo().size.x*0.5;var m=this._PanelNode.GetShapeInfo().size.y*0.5;var u=this._PanelNode.GetShapeInfo().shape;if((u===i.EBodyShape.None||u===i.EBodyShape.RoundedRectangle||u===i.EBodyShape.Rectangle||u===i.EBodyShape.RoundedSquare||u===i.EBodyShape.Square)&&this.SegmentIntersectRectangle(t.EndExtremityPaper,-n,-m,n,m,l)){A.add(l)}else{if((u===i.EBodyShape.Circle||u===i.EBodyShape.Ellipse)&&this.SegmentIntersectEllipse(t.EndExtremityPaper,n,m,false,l)){A.add(l)}}t.StartExtremity=r.MMToModel2(q,A);t.BreakExtremity=t.StartExtremity.clone()}}t.preRender(q)}}},_ComputePosTooltipAttaches:function(p,j){var l;var t;var m=this.getBodyCenterPosInPaper(p,j);var q=this.Modifiable.GetPropertyValue("Collab.Attach.CenteredOrigin");if(q){t=m}else{var o=this.Modifiable.GetPropertyValue("Collab.Attach.Origin");if(o.equals(new f.Vector3())){var r=this.Modifiable.GetProperty("Collab.Attach.Origin").GetPropertyValue().Clone();r.SetValue(m.clone());this.Modifiable.OnChangeProperty("Collab.Attach.Origin",r);t=this.Modifiable.GetPropertyValue("Collab.Attach.Origin")}else{var n=new f.Vector3().copy(o).setZ(m.z);t=n}}l=j.MMToModel2(p,t);for(var k in this._AttachNodes){if(this._AttachNodes.hasOwnProperty(k)){var s=this._AttachNodes[k];s.StartExtremity=l;s.preRender(p)}}},getBodyCenterPosInPaper:function(j,m){var k=new f.Vector3().getPositionFromMatrix(this._PanelNode.GetShapeInfo().smartNode.getMatrix());var l=m.ModelToMM2(j,k);l.x+=this._PanelNode.GetShapeInfo().center.x;l.y+=this._PanelNode.GetShapeInfo().center.y;return l},_ComputePosAttaches:function(m){var l=this.ExperienceBase.getManager("VCXPaperManager");if(!l){this.ExperienceBase.getManager("VCXContextManager").addNotification(d.noPaperManager);return}if(this._AttachType===i.ELeadType.None||Object.keys(this._AttachNodes).length===0){return}for(var n in this._AttachNodes){if(this._AttachNodes.hasOwnProperty(n)){var j=this.GetAnchorWorldMatrix(n,m);if(j){var k=this._AttachNodes[n];k.EndExtremity.getPositionFromMatrix(j);k.EndExtremityPaper=l.ModelToMM2(m,k.EndExtremity)}}}switch(this._AttachType){case i.ELeadType.Mustache:this._ComputePosTooltipAttaches(m,l);break;default:this._ComputePosLinesAttaches(m,l)}},dispose:function(){for(var j in this._AttachNodes){if(this._AttachNodes.hasOwnProperty(j)){this._AttachNodes[j].dispose()}}this._AttachNodes={};this._parent()},_Build:function(){},preRender:function(j){this._parent(j);this._ComputePosAttaches(j)},update:function(n){this._parent();var m=this.GlobalOpacity;var l=this.GetPropertyValue("Collab.Attach.LeadType");if(this._AttachType!==l){for(var q in this._AttachNodes){if(this._AttachNodes.hasOwnProperty(q)){this._AttachNodes[q].dispose()}}this._AttachNodes={};this._AttachType=l}var k=false;var p=this;var o=this.Modifiable&&this.Modifiable._Anchors;if(o&&Object.keys(o).length>0){this.Modifiable.processAnchorsIDs(function(r){if(r==="Location"){return}if(p.GetPropertyGroupVisibility("Group.Attach")&&p._AttachType!==i.ELeadType.None&&m>0){if(!p._AttachNodes.hasOwnProperty(r)){var s={name:"AttachNode "+r,modifiable:p.Modifiable,type:p._type,anchorID:r};if(p._AttachType===i.ELeadType.Mustache){s.bConsiderCurvature=true;s.gradientBackGround=p.GetPropertyValue("Collab.Attach.Background.Gradient");s.gradientBorder=p.GetPropertyValue("Collab.Attach.Border.Gradient");p._AttachNodes[r]=new e(s)}else{s.endExtremityType=p.GetPropertyValue("Collab.Attach.ExtremityType");p._AttachNodes[r]=new a(s)}p._AttachNodes[r].exludeFromBounding(true);p.add(p._AttachNodes[r]);k=true;p.RecursiveSetPickParent(true);p.handleLayers(true)}}else{if(p._AttachNodes.hasOwnProperty(r)){p.remove(p._AttachNodes[r]);delete p._AttachNodes[r];k=true}}});for(var j in this._AttachNodes){if(this._AttachNodes.hasOwnProperty(j)){this._AttachNodes[j].update(n)}}}this.handleLayers(k)},postUpdate:function(k){this._parent();for(var j in this._AttachNodes){if(this._AttachNodes.hasOwnProperty(j)){this._AttachNodes[j].postUpdate(k)}}},updateInteractors:function(q){var l=this.Modifiable.QueryInterface("VCXIManipulable");if(!l){return}var t=l.getAllInteractors();var k="Interactor Attach Origin";var n=t[k];var p=this.Modifiable.GetPropertyValue("Collab.Attach.Origin");var s=this.Modifiable.GetPropertyValue("Collab.Attach.CenteredOrigin");var j=this.Modifiable.GetPropertyValue("Collab.Attach.LeadType");if(!s&&(j===i.ELeadType.Mustache)){if(!n){var n=new b(this.Modifiable.GetObject());n.id=k;l.addInteractor(n.id,n);n.manipulatorType=b.EManipulatorType.Handle;n.constraint=b.EConstraint.Pick;n.constraintReferential=b.EConstraintReferential.Screen;n.visibility=b.EVisibility.OnObjectOver|b.EVisibility.OnObjectSelected|b.EVisibility.OnInteractorOver;n.application=b.EApplication["3DIllustration"]|b.EApplication.CityIllustration;n.cursorPreactivate="grab";n.cursorManipulate="grabbing"}var m=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();var r=this.ExperienceBase.getManager("VCXPaperManager");var o=r.MMToModel2(q,p);n.matrix=new f.Matrix4().setPosition(o)}if(n){n.active=Boolean(this.Modifiable.GetPropertyGroupVisibility("Group.Attach")&&!this.Modifiable.GetPropertyValue("Collab.Attach.CenteredOrigin"))}},SegmentIntersectRectangle:function(r,l,j,q,m,p){if(r.x>l&&r.x<q&&r.y>j&&r.y<m){return false}var o=new f.Vector2(q,m);var s=new f.Vector2(l,m);if(this.IntersectSegment(r,o,s,p)){return true}var n=new f.Vector2(l,j);if(this.IntersectSegment(r,s,n,p)){return true}var k=new f.Vector2(q,j);if(this.IntersectSegment(r,k,o,p)){return true}if(this.IntersectSegment(r,k,n,p)){return true}p=r.clone();return false},SegmentIntersectEllipse:function(I,O,o,A,z){var s,r;z.x=I.x;z.y=I.y;z.z=I.z;var q=new f.Vector2(I.x,I.y);var v=new f.Vector2(I.x,I.y);var m=false;var G=0;var B=0,n=0,J=0,P=0,N=0,L=0;n=O*O;J=o*o;if(Math.abs(v.y)>Math.abs(v.x)){m=true;G=v.x/v.y;B=q.x-G*q.y;P=1/J+G*G/n;N=2*G*B/n;L=B*B/n-1}else{G=v.y/v.x;B=q.y-G*q.x;P=1/n+G*G/J;N=2*G*B/J;L=B*B/J-1}var l=N*N-4*P*L;if(l<0){return false}var F=false;if(l===0){if(m){r=-N/2*P;q.x=G*r+B;q.y=r}else{s=-N/2*P;q.x=s;q.y=G*s+B}if(A){F=true}else{F=this.IsPointInSegment(I,q)}if(F){z.x=q.x;z.y=q.y}}else{var w=Math.sqrt(l);if(m){r=(-N+w)/(2*P);s=G*r+B}else{s=(-N+w)/(2*P);r=G*s+B}var M=new f.Vector2(s,r);var D;if(A){D=true}else{D=this.IsPointInSegment(I,M)}if(m){r=(-N-w)/(2*P);s=G*r+B}else{s=(-N-w)/(2*P);r=G*s+B}var K=new f.Vector2(s,r);var H=false;if(A){H=true}else{H=this.IsPointInSegment(I,K)}if(D&&H){var u=M.x-K.x;var t=M.y-K.y;var E=u*u+t*t;var j=Math.min(O,o)*0.1;if(E<j*j){return false}u=M.x-z.x;t=M.y-z.y;E=u*u+t*t;u=K.x-z.x;t=K.y-z.y;var C=u*u+t*t;if(C<E){z.x=K.x;z.y=K.y}else{z.x=M.x;z.y=M.y}F=true}else{if(D){z.x=M.x;z.y=M.y;F=true}else{if(H){z.x=K.x;z.y=K.y;F=true}}}}return F},IsPointInSegment:function(p,k){var o=p.x;var m=p.y;var j=(o*o)+(m*m);var n=k.x;var l=k.y;var q=o*n+m*l;if(q<0||q>j){return false}return true},IntersectSegment:function(o,q,p,n){var m=(-o.x)*(q.y-o.y)-(-o.y)*(q.x-o.x);var l=(p.x-q.x)*(q.y-o.y)-(p.y-q.y)*(q.x-o.x);var r=(-o.y)*(p.x-q.x)-(-o.x)*(p.y-q.y);if(r===0){return false}var k=m/r;var j=l/r;n.x=q.x+k*(p.x-q.x);n.y=q.y+k*(p.y-q.y);if(k>=0&&k<=1&&j>=0&&j<=1){return true}else{return false}}});return g});define("DS/VCXWebDressup/VCXPathModifiable",["DS/VCXWebDressup/VCXComponentPath","DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebDressup/VCXPolylineModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueVector"],function(h,i,e,l,b,f,j,k,a,g,d){var c=e.extend({init:function(){this._bIsPolyline=true;this._parent()},Build:function(){this._parent();var m=[{Name:"Collab.Path.AxesOrder",Type:a,DefaultValue:h.EAxesOrder.XYZ,GroupId:"Group.Path",MapChoice:this._generateMapChoiceFromEnumAndId(h.EAxesOrder,"Collab.Path.AxesOrder")},{Name:"Collab.Path.IsFromNeutral",Type:b,DefaultValue:false,GroupId:"Group.Path"},{Name:"Collab.Path.ConstructMode",Type:a,DefaultValue:h.EConstructMode.PathClassic,GroupId:"Group.Path",MapChoice:this._generateMapChoiceFromEnumAndId(h.EConstructMode,"Collab.Path.ConstructMode")},{Name:"Collab.Body.Line.Width",DefaultValue:1},];this._BuildPropertyValues(m)},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Collab.Path.AxesOrder",this.GetPropertyValue("Collab.Path.ConstructMode")===h.EConstructMode.PathClassic);this.SetPropertyInvisible("Collab.Path.IsFromNeutral",true);this.SetPropertyInvisible("Collab.ListAnchorsIDs",true);this.SetPropertyInvisible("Polyline.Is.Closed",true)},});return c});define("DS/VCXWebDressup/VCXAssociativePathModifiable",["DS/VCXWebDressup/VCXComponentPath","DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebDressup/VCXPathModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueVector"],function(h,i,c,l,b,f,j,k,a,g,e){var d=c.extend({init:function(){this._bIsPolyline=true;this._parent()},Build:function(){this._parent();var m=[{Name:"Collab.Path.IsFull",Type:b,DefaultValue:false,GroupId:"Group.Path"},];this._BuildPropertyValues(m)},SetPropertiesInfo:function(){this._parent();this.SetPropertyInvisible("Collab.Path.IsFull",this.GetPropertyValue("Collab.Path.ConstructMode")!==h.EConstructMode.PathClassic);this.SetPropertyInvisible("Collab.Path.IsFromNeutral",true)},});return d});define("DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndLeft",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(b,c,d){var a=b.extend({rewind:function(){this._parent();this.iSwap=0;this.iPariteX=0;this.iPariteY=0;this.fX=0;this.dx=0;this.fY=this.fHalfSizeY-this.fCellSize;if(this.fY<0){this.fY=0}this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize;this.LRiPariteX=0;this.LRiPariteY=0;this.LRfX=this.fHalfSizeX-this.fCellSize;if(this.LRfX<0){this.LRfX=0}this.LRdy=0;this.LRfY=0;this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){this._parent();this.iSwap++;if(this.iSwap&1){this.LRiPariteY++;if(this.LRiPariteY===2){this.LRiPariteY=0;this.LRfY+=this.fCellSize;if(this.LRfY>this.fHalfSizeY-this.fCellSize){if(this.LRdy===0){this.LRdy=this.fCellSize*0.5}else{this.LRdy=0}this.LRfY=0;this.LRfX-=this.fCellSize;if(this.LRfX<this.fCellSize){this.rewind();return true}}}}else{if(this.fX==0){this.iPariteX++}this.iPariteX++;if(this.iPariteX===2){this.iPariteX=0;this.fX+=this.fCellSize;if(this.fX>this.maxfx){this.maxfx-=this.fCellSize;if(this.maxfx<this.fCellSize){this.maxfx=this.fCellSize}if(this.dx===0){this.dx=this.fCellSize*0.5}else{this.dx=0}this.fX=0;this.fY-=this.fCellSize;if(this.fY<this.fCellSize){this.rewind();return true}}}}return false},getPoint:function(){var e=new c.Vector2();if(this.iSwap&1){e.x=this.fHalfSizeX-this.LRfX;if(this.LRiPariteY&1){e.y=this.fHalfSizeY-this.LRfY+this.LRdy}else{e.y=this.fHalfSizeY+this.LRfY+this.LRdy}}else{if(this.iPariteX&1){e.x=this.fHalfSizeX-this.fX+this.dx}else{e.x=this.fHalfSizeX+this.fX+this.dx}e.y=this.fHalfSizeY+this.fY}return e}});return a});define("DS/VCXWebDressup/VCXComponentLabel",["DS/VCXWebDressup/VCXComponentMarkup"],function(b){var a=b.extend({init:function(){this._parent();this._IsAnchorDependent=true}});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentLabel"}});a.prototype._dressupFamily="Annotations";return a});define("DS/VCXWebDressup/VCXComponentMeasurement",["DS/VCXWebDressup/VCXComponentLabel","DS/VCXWebDressup/VCXComponentMarkup","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools"],function(a,b,c,d){var e=a.extend({init:function(){this._parent();this.IsAnchorDependent=true;this._keyValues={}},getAttachType:function(){var f=this.QueryInterface("VCXIModifiable");if(f){switch(f.GetPropertyValue("Collab.Measurement.Type")){case e.EType.Arc:case e.EType.GDT:case e.EType.Area:case e.EType.Volume:case e.EType.PipeLength:case e.EType.AreaMultiplePoints:case e.EType.VolumeMultiplePoints:case e.EType.PipeLengthMultiplePoints:case e.EType.Coord:case e.EType.Projected:return e.EAttachType.Simple;break;case e.EType.Angle:return e.EAttachType.Double;break;case e.EType.BetweenAxis:case e.EType.BetweenLines:case e.EType.BetweenPlanes:case e.EType.PlanePoint:case e.EType.LinePoint:case e.EType.BetweenPoints:case e.EType.Linear:case e.EType.BetweenCentres:return e.EAttachType.Double;break;case e.EType.Diameter:case e.EType.Radius:return f.GetPropertyValue("Collab.Measurement.Attach.Type");break}}},getKeyPoints:function(o,l){var q=this.QueryInterface("VCXIModifiable");if(q){this._keyValues.labelLineExtremity0=d.getOFromMatrix(l.getMatrix());this.newLabel0Position=this._keyValues.labelLineExtremity0;switch(q.GetPropertyValue("Collab.Measurement.Type")){case e.EType.Arc:case e.EType.GDT:case e.EType.QuotationArc:case e.EType.Area:case e.EType.Volume:case e.EType.PipeLength:case e.EType.AreaMultiplePoints:case e.EType.VolumeMultiplePoints:case e.EType.PipeLengthMultiplePoints:case e.EType.BetweenAxis:case e.EType.BetweenCentres:case e.EType.Coord:case e.EType.Projected:break;case e.EType.Angle:this._keyValues.angle=true;if(!this._keyValues.measurementExtremity1){this.getValue(o,l)}break;case e.EType.BetweenLines:case e.EType.BetweenPlanes:case e.EType.PlanePoint:case e.EType.LinePoint:if(!this._keyValues.measurementExtremity1){this.getValue(o,l)}break;case e.EType.Linear:this._getMeasurementExtremity1();this._keyValues.measurementExtremity2=new c.Vector3(this.getValue(o,l),0,0).applyMatrix4(this._keyValues.measurementExtremity1Frame);break;case e.EType.BetweenPoints:var h=new c.Vector3().subVectors(this._getMeasurementExtremity2(),this._getMeasurementExtremity1()).normalize();this._keyValues.measurementExtremity1Frame=d.getMatrixFromOVxVy(this._keyValues.measurementExtremity1,h,this.newLabel0Position);break;case e.EType.Radius:case e.EType.Diameter:if(!this._keyValues.labelLineExtremity1||!this._keyValues.labelLineExtremity2){this._keyValues.measurementExtremity0Frame=q.GetAnchorWorldMatrix(0,o);this._keyValues.measurementExtremity0=d.getOFromMatrix(this._keyValues.measurementExtremity0Frame);this._keyValues.value=q.GetPropertyValue("Collab.Measurement.Radius");var j=new c.Vector3().subVectors(this.newLabel0Position,this._keyValues.measurementExtremity0);var t=d.getVzFromMatrix(this._keyValues.measurementExtremity0Frame);t.normalize();var h=new c.Vector3().crossVectors(t,j).normalize();if(q.GetPropertyValue("Collab.Measurement.Type")===e.EType.Radius){h.multiplyScalar(this._keyValues.value);this._keyValues.measurementExtremity1=this._keyValues.measurementExtremity0.clone()}else{h.multiplyScalar(this._keyValues.value*0.5);this._keyValues.measurementExtremity1=this._keyValues.measurementExtremity0.clone().add(h)}this._keyValues.measurementExtremity2=this._keyValues.measurementExtremity0.clone().sub(h);h.negate().normalize();this._keyValues.measurementExtremity1Frame=d.getMatrixFromOVxVy(this._keyValues.measurementExtremity1,h,t);this._keyValues.labelLineExtremity1=this._keyValues.measurementExtremity1.clone().add(j);this._keyValues.labelLineExtremity2=this._keyValues.measurementExtremity2.clone().add(j);this._keyValues.arrowLineExtremity1=this._keyValues.labelLineExtremity1;this._keyValues.arrowLineExtremity2=this._keyValues.labelLineExtremity2}break}switch(q.GetPropertyValue("Collab.Measurement.Type")){case e.EType.Arc:case e.EType.Area:case e.EType.Volume:case e.EType.PipeLength:case e.EType.AreaMultiplePoints:case e.EType.VolumeMultiplePoints:case e.EType.PipeLengthMultiplePoints:case e.EType.Radius:case e.EType.Diameter:case e.EType.GDT:case e.EType.Coord:case e.EType.Projected:break;case e.EType.Angle:case e.EType.BetweenLines:case e.EType.BetweenPlanes:case e.EType.LinePoint:case e.EType.BetweenPoints:case e.EType.PlanePoint:case e.EType.BetweenAxis:case e.EType.BetweenCentres:if(l.PositioningType<=b.EPositionType.Free2D){var h=new c.Vector3().subVectors(this._getMeasurementExtremity2(),this._getMeasurementExtremity1()).normalize();var m=new c.Vector3().subVectors(this.newLabel0Position,o.viewpoint.getEyePosition()).normalize();var u=d.getNearestDistanceBetween2Lines(this.newLabel0Position,m,this._getMeasurementExtremity1(),h);this.newLabel0Position=u.p1}break}switch(q.GetPropertyValue("Collab.Measurement.Type")){case e.EType.Arc:case e.EType.Area:case e.EType.Volume:case e.EType.PipeLength:case e.EType.AreaMultiplePoints:case e.EType.VolumeMultiplePoints:case e.EType.PipeLengthMultiplePoints:case e.EType.Radius:case e.EType.Diameter:case e.EType.GDT:case e.EType.Coord:case e.EType.Projected:break;case e.EType.Angle:case e.EType.BetweenLines:case e.EType.BetweenPlanes:case e.EType.LinePoint:case e.EType.BetweenPoints:case e.EType.PlanePoint:case e.EType.BetweenAxis:case e.EType.Linear:case e.EType.BetweenCentres:if(!this._keyValues.labelLineExtremity1||!this._keyValues.labelLineExtremity2){if(!this._keyValues.angle){var h=new c.Vector3().subVectors(this._getMeasurementExtremity2(),this._getMeasurementExtremity1());var p=new c.Vector3().subVectors(this.newLabel0Position,this._getMeasurementExtremity1());var g=new c.Vector3().crossVectors(h,p).normalize();var n=new c.Vector3().crossVectors(g,h).normalize();var f=p.dot(n);n.multiplyScalar(f);this._keyValues.labelLineExtremity1=n.clone().add(this._getMeasurementExtremity1());this._keyValues.labelLineExtremity2=n.clone().add(this._getMeasurementExtremity1()).add(h);this._keyValues.arrowLineExtremity1=this._keyValues.labelLineExtremity1;this._keyValues.arrowLineExtremity2=this._keyValues.labelLineExtremity2}else{var i=new c.Plane().setFromNormalAndCoplanarPoint(d.getVzFromMatrix(this._keyValues.measurementExtremity0Frame),this._keyValues.measurementExtremity0);this._keyValues.projectedPoint=i.projectPoint(this.newLabel0Position);this._keyValues.radius=this._keyValues.projectedPoint.distanceTo(this._keyValues.measurementExtremity1);var k=Math.max(this._keyValues.radius,this._keyValues.measurementAnglePoint1.distanceTo(this._keyValues.measurementExtremity0));var s=new c.Vector3().subVectors(this._keyValues.measurementExtremity5,this._keyValues.measurementExtremity1).normalize();this._keyValues.labelLineExtremity1=this._keyValues.measurementExtremity1.clone().add(s.clone().multiplyScalar(k));this._keyValues.labelLineExtremity1Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.labelLineExtremity1);this._keyValues.arrowLineExtremity1=this._keyValues.measurementExtremity1.clone().add(s.clone().multiplyScalar(this._keyValues.radius));var k=Math.max(this._keyValues.radius,this._keyValues.measurementAnglePoint2.distanceTo(this._keyValues.measurementExtremity0));if(q.GetPropertyValue("Collab.Measurement.Type")===e.EType.BetweenLines){k=Math.max(this._keyValues.radius,q.GetPropertyValue("Collab.Measurement.Length2"))}var r=new c.Vector3().subVectors(this._keyValues.measurementExtremity6,this._keyValues.measurementExtremity2).normalize();this._keyValues.labelLineExtremity2=this._keyValues.measurementExtremity2.clone().add(r.clone().multiplyScalar(k));this._keyValues.labelLineExtremity2Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.labelLineExtremity2);this._keyValues.arrowLineExtremity2=this._keyValues.measurementExtremity2.clone().add(r.clone().multiplyScalar(this._keyValues.radius))}}break}}return this._keyValues},_getMeasurementExtremity1:function(){if(!this._keyValues.measurementExtremity1){var f=this.QueryInterface("VCXIModifiable");if(f){this._keyValues.measurementExtremity1Frame=f.GetAnchorWorldMatrix(0,null);this._keyValues.measurementExtremity1=d.getOFromMatrix(this._keyValues.measurementExtremity1Frame)}}return this._keyValues.measurementExtremity1},_getMeasurementExtremity2:function(){if(!this._keyValues.measurementExtremity2){var f=this.QueryInterface("VCXIModifiable");if(f){this._keyValues.measurementExtremity2Frame=f.GetAnchorWorldMatrix(1,null);this._keyValues.measurementExtremity2=d.getOFromMatrix(this._keyValues.measurementExtremity2Frame)}}return this._keyValues.measurementExtremity2},_getMeasurementExtremity3:function(){if(!this._keyValues.measurementExtremity3){var f=this.QueryInterface("VCXIModifiable");if(f){this._keyValues.measurementExtremity3Frame=f.GetAnchorWorldMatrix(2,null);this._keyValues.measurementExtremity3=d.getOFromMatrix(this._keyValues.measurementExtremity3Frame)}}return this._keyValues.measurementExtremity3},getValue:function(o,h){if(this._keyValues.value===undefined){if(!this.newLabel0Position){this.newLabel0Position=d.getOFromMatrix(this.getReferential())}var m=this.QueryInterface("VCXIModifiable");if(m){switch(m.GetPropertyValue("Collab.Measurement.Type")){case e.EType.GDT:case e.EType.Projected:this._keyValues.value=m._Properties["Collab.Measurement.Value"].GetPropertyValue().Value;break;case e.EType.Radius:case e.EType.Diameter:this._keyValues.value=m.GetPropertyValue("Collab.Measurement.Radius");break;case e.EType.Arc:case e.EType.PipeLength:case e.EType.PipeLengthMultiplePoints:case e.EType.Linear:this._keyValues.value=m.GetPropertyValue("Collab.Measurement.Length");break;case e.EType.Coord:this._keyValues.value=0;break;case e.EType.Area:case e.EType.AreaMultiplePoints:this._keyValues.value=m.GetPropertyValue("Collab.Measurement.Area");break;case e.EType.Volume:case e.EType.VolumeMultiplePoints:this._keyValues.value=m.GetPropertyValue("Collab.Measurement.Volume");break;case e.EType.BetweenAxis:case e.EType.BetweenPoints:case e.EType.BetweenCentres:this._keyValues.value=this._getMeasurementExtremity1().distanceTo(this._getMeasurementExtremity2());break;case e.EType.Angle:this._keyValues.angle=true;this._getMeasurementExtremity1();this._getMeasurementExtremity2();this._getMeasurementExtremity3();this._keyValues.measurementAnglePoint1=this._keyValues.measurementExtremity3.clone();this._keyValues.measurementAnglePoint2=this._keyValues.measurementExtremity2.clone();this._keyValues.measurementExtremity4=this._keyValues.measurementExtremity2.clone();this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone().setPosition(this._keyValues.measurementExtremity4);this._keyValues.measurementExtremity2=this._keyValues.measurementExtremity1.clone();this._keyValues.measurementExtremity2Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.measurementExtremity2);this._keyValues.measurementExtremity5=this._keyValues.measurementExtremity3.clone();this._keyValues.measurementExtremity5Frame=this._keyValues.measurementExtremity3Frame.clone().setPosition(this._keyValues.measurementExtremity5);this._keyValues.measurementExtremity6=this._keyValues.measurementExtremity4.clone();this._keyValues.measurementExtremity6Frame=this._keyValues.measurementExtremity4Frame.clone().setPosition(this._keyValues.measurementExtremity6);var k=new c.Vector3().subVectors(this._keyValues.measurementExtremity3,this._keyValues.measurementExtremity1).normalize();var i=new c.Vector3().subVectors(this._keyValues.measurementExtremity4,this._keyValues.measurementExtremity2).normalize();this._keyValues.value=k.angleTo(i);this._keyValues.measurementExtremity0=this._keyValues.measurementExtremity1;this._keyValues.measurementExtremity0Frame=d.getMatrixFromOVxVy(this._keyValues.measurementExtremity1,k,i);break;case e.EType.BetweenLines:this._getMeasurementExtremity1();this._getMeasurementExtremity2();var q=d.getNearestDistanceBetween2Lines(this._getMeasurementExtremity1(),d.getVxFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity2(),d.getVxFromMatrix(this._keyValues.measurementExtremity2Frame));if(q){this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone();this._keyValues.measurementExtremity3=this._keyValues.measurementExtremity1.clone();this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone();this._keyValues.measurementExtremity4=this._keyValues.measurementExtremity2.clone();if(Math.abs(q.d)<=0.001){this._keyValues.angle=true;if(m._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()!=="Angle"){m._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Angle")}var n=d.getVxFromMatrix(this._keyValues.measurementExtremity1Frame).normalize();var A=d.getVxFromMatrix(this._keyValues.measurementExtremity2Frame).normalize();if(this.newLabel0Position){var f=new c.Vector3().crossVectors(n,A).normalize();var z=new c.Plane().setFromNormalAndCoplanarPoint(f,q.p1);this._keyValues.projectedPoint=z.projectPoint(this.newLabel0Position);this._keyValues.radius=this._keyValues.projectedPoint.distanceTo(q.p1);var l=this._keyValues.projectedPoint.clone().sub(q.p1).normalize();var s=new c.Vector3().crossVectors(n,l).normalize();if(f.dot(s)<0){A.negate()}var f=new c.Vector3().crossVectors(A,n).normalize();var j=this._keyValues.projectedPoint.clone().sub(q.p2).normalize();var s=new c.Vector3().crossVectors(A,j).normalize();if(f.dot(s)<0){n.negate()}}this._keyValues.measurementExtremity5=q.p1.clone().add(n.clone().multiplyScalar(this._keyValues.radius));this._keyValues.measurementExtremity5Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.measurementExtremity5);this._keyValues.measurementExtremity6=q.p2.clone().add(A.clone().multiplyScalar(this._keyValues.radius));this._keyValues.measurementExtremity6Frame=this._keyValues.measurementExtremity2Frame.clone().setPosition(this._keyValues.measurementExtremity6);this._keyValues.measurementAnglePoint1=q.p1.clone().add(n.clone().multiplyScalar(m.GetPropertyValue("Collab.Measurement.Length1")));this._keyValues.measurementAnglePoint2=q.p2.clone().add(A.clone().multiplyScalar(m.GetPropertyValue("Collab.Measurement.Length2")));this._keyValues.value=n.angleTo(A);this._keyValues.measurementExtremity1=q.p1;this._keyValues.measurementExtremity2=q.p2;this._keyValues.measurementExtremity0=q.p1;this._keyValues.measurementExtremity0Frame=d.getMatrixFromOVxVy(q.p1,n,A)}else{this._keyValues.angle=false;if(m._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()!=="Length"){m._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Length")}this._keyValues.measurementExtremity1=q.p1;this._keyValues.measurementExtremity2=q.p2;this._keyValues.value=q.d}}break;case e.EType.LinePoint:this._getMeasurementExtremity1();this._getMeasurementExtremity2();this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone();this._keyValues.measurementExtremity3=this._keyValues.measurementExtremity1.clone();var r=new c.Ray(this._keyValues.measurementExtremity3,d.getVxFromMatrix(this._keyValues.measurementExtremity3Frame));r.closestPointToPoint(this._keyValues.measurementExtremity2,this._keyValues.measurementExtremity1);this._keyValues.value=this._keyValues.measurementExtremity2.distanceTo(this._keyValues.measurementExtremity1);break;case e.EType.PlanePoint:if(!this._keyValues.measurementExtremity1){this._getMeasurementExtremity1();var g=new c.Plane().setFromNormalAndCoplanarPoint(d.getVzFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity1());this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone();this._keyValues.measurementExtremity3=d.getOFromMatrix(this._keyValues.measurementExtremity3Frame);this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity1Frame.clone();this._getMeasurementExtremity2();this._keyValues.value=Math.abs(g.distanceToPoint(this._keyValues.measurementExtremity2));this._keyValues.measurementExtremity1=g.projectPoint(this._keyValues.measurementExtremity2);this._keyValues.measurementExtremity1Frame.setPosition(this._keyValues.measurementExtremity1);var C=new c.Plane().setFromNormalAndCoplanarPoint(d.getVzFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity2());this._keyValues.measurementExtremity4=C.projectPoint(this._keyValues.measurementExtremity3);this._keyValues.measurementExtremity4Frame.setPosition(this._keyValues.measurementExtremity4)}break;case e.EType.BetweenPlanes:if(!this._keyValues.measurementExtremity1){this._getMeasurementExtremity1();var g=new c.Plane().setFromNormalAndCoplanarPoint(d.getVzFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity1());this._getMeasurementExtremity2();var C=new c.Plane().setFromNormalAndCoplanarPoint(d.getVzFromMatrix(this._keyValues.measurementExtremity2Frame),this._getMeasurementExtremity2());this._keyValues.measurementExtremity3=this._keyValues.measurementExtremity1.clone();this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone();var p=d.getVzFromMatrix(this._keyValues.measurementExtremity2Frame).normalize().dot(d.getVzFromMatrix(this._keyValues.measurementExtremity1Frame).normalize());if(Math.abs(p)>=0.999){this._keyValues.measurementExtremity4=C.projectPoint(this._keyValues.measurementExtremity1);this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone().setPosition(this._keyValues.measurementExtremity4);this._keyValues.measurementExtremity5=g.projectPoint(this._keyValues.measurementExtremity2);this._keyValues.measurementExtremity5Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.measurementExtremity5);this._keyValues.measurementExtremity6=this._keyValues.measurementExtremity2.clone();this._keyValues.measurementExtremity6Frame=this._keyValues.measurementExtremity2Frame.clone();this._keyValues.value=Math.abs(g.distanceToPoint(this._keyValues.measurementExtremity2));this._keyValues.angle=false;if(m._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()!=="Length"){m._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Length")}this._keyValues.measurementExtremity1=new c.Vector3().addVectors(this._keyValues.measurementExtremity3,this._keyValues.measurementExtremity5).multiplyScalar(0.5);this._keyValues.measurementExtremity1Frame.setPosition(this._keyValues.measurementExtremity1);this._keyValues.measurementExtremity2=new c.Vector3().addVectors(this._keyValues.measurementExtremity4,this._keyValues.measurementExtremity6).multiplyScalar(0.5);this._keyValues.measurementExtremity2Frame.setPosition(this._keyValues.measurementExtremity2)}else{this._keyValues.angle=true;this._keyValues.measurementAnglePoint2=this._keyValues.measurementExtremity2.clone();if(m._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()!=="Angle"){m._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Angle")}var x=d.getVzFromMatrix(this._keyValues.measurementExtremity1Frame).normalize();var B=d.getVzFromMatrix(this._keyValues.measurementExtremity2Frame).normalize();var f=new c.Vector3().crossVectors(x,B).normalize();var u=new c.Vector3().crossVectors(x,f).normalize();var t=new c.Vector3().crossVectors(B,f).normalize();var q=d.getNearestDistanceBetween2Lines(this._getMeasurementExtremity1(),u,this._getMeasurementExtremity2(),t);if(q.p2){var w=q.p2;var v=this._keyValues.measurementExtremity1.clone().add(q.p2).sub(q.p1);var y=this._keyValues.measurementExtremity2.clone();var n=new c.Vector3().subVectors(v,w);var A=new c.Vector3().subVectors(y,w);if(this.newLabel0Position){var z=new c.Plane().setFromNormalAndCoplanarPoint(f,w);this._keyValues.projectedPoint=z.projectPoint(this.newLabel0Position);this._keyValues.radius=this._keyValues.projectedPoint.distanceTo(w);this._keyValues.measurementAnglePoint1=z.projectPoint(this._keyValues.measurementExtremity1)}this._keyValues.measurementExtremity0=w.clone();this._keyValues.measurementExtremity0Frame=d.getMatrixFromOVxVy(w,n,A);this._keyValues.measurementExtremity4=this._keyValues.measurementExtremity2.clone();this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone();this._keyValues.measurementExtremity5=w.clone().add(n.clone().multiplyScalar(this._keyValues.radius));this._keyValues.measurementExtremity5Frame=d.getMatrixFromOVxVz(w,n,d.getVzFromMatrix(this._keyValues.measurementExtremity1Frame));this._keyValues.measurementExtremity6=w.clone().add(A.clone().multiplyScalar(this._keyValues.radius));this._keyValues.measurementExtremity6Frame=d.getMatrixFromOVxVz(w,A,d.getVzFromMatrix(this._keyValues.measurementExtremity2Frame));this._keyValues.value=n.angleTo(A);this._keyValues.measurementExtremity1=w.clone();this._keyValues.measurementExtremity2=w.clone()}}}break}}}return this._keyValues.value},getReferential:function(){if(this._keyValues.referential){return this._keyValues.referential}var n=this.QueryInterface("VCXIModifiable");if(n){switch(n.GetPropertyValue("Collab.Measurement.Type")){case e.EType.LinePoint:case e.EType.BetweenLines:var g=n.GetAnchorWorldMatrix(0,null);var k=d.getOFromMatrix(g);var l=n.GetAnchorWorldMatrix(1,null);var j=d.getOFromMatrix(l);var m=new c.Vector3().addVectors(j,k).multiplyScalar(0.5);var o=this.QueryInterface("W3AISGNodeHolder");this._keyValues.referential=o.getAnchorReferential();this._keyValues.referential.setPosition(m);return this._keyValues.referential;break;case e.EType.Angle:var g=n.GetAnchorWorldMatrix(0,null);var k=d.getOFromMatrix(g);var l=n.GetAnchorWorldMatrix(1,null);var j=d.getOFromMatrix(l);var q=n.GetAnchorWorldMatrix(2,null);var i=d.getOFromMatrix(q);var f=new c.Vector3().subVectors(j,k);var p=new c.Vector3().subVectors(i,k);if(f.lengthSq()<0.0001){f=new c.Vector3(1,0,0)}this._keyValues.referential=d.getMatrixFromOVxVy(k,f,p);return this._keyValues.referential;break;case e.EType.PlanePoint:case e.EType.BetweenPlanes:case e.EType.BetweenPoints:var g=n.GetAnchorWorldMatrix(0,null);var k=d.getOFromMatrix(g);var l=n.GetAnchorWorldMatrix(1,null);var j=d.getOFromMatrix(l);var h=new c.Vector3().subVectors(j,k);if(h.lengthSq()<0.0001){h=new c.Vector3(1,0,0)}this._keyValues.referential=d.getMatrixFromOVx(k,h);return this._keyValues.referential;break}}var o=this.QueryInterface("W3AISGNodeHolder");this._keyValues.referential=o.getAnchorReferential();return this._keyValues.referential},postUpdate:function(f){this._parent(f);this._keyValues={}}});e.ESymbol={None:0,Straightness:1,Flatness:2,Circularity:3,Cylindricity:4,LineProfile:5,SurfaceProfile:6,Angularity:7,Perpendicularity:8,Parallelism:9,Position:10,Concentricity:11,Symmetry:12,CircularRunout:13,TotalRunout:14,ProjectedToleranceZone:15,MaxMaterialCondition:16,MinMaterialCondition:17,FreeStateVariations:18,Diameter:20,PlusMinus:21,Plus:22,Minus:23,Equal:24,ToBeDefined:25,};e.EAttachType={Simple:0,Double:1};e.EType={Arc:110,Angle:120,Linear:130,Diameter:140,GDT:150,BetweenAxis:160,BetweenCentres:170,BetweenPlanes:180,PlanePoint:190,BetweenPoints:200,Area:220,Volume:230,PipeLength:240,AreaMultiplePoints:250,VolumeMultiplePoints:260,PipeLengthMultiplePoints:270,BetweenLines:280,LinePoint:290,Radius:300,Coord:310,Projected:320};Object.defineProperty(e.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentMeasurement"}});e.prototype._dressupFamily="Measurements";return e});define("DS/VCXWebDressup/VCXMeasurementModifiable",["DS/VCXWebDressup/VCXComponentMeasurement","DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebDressup/VCXPropertyValueUnitFormater","DS/VCXWebUnits/VCXUnitType","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueEnum"],function(d,g,l,h,f,e,k,j,i,b,a){var c=g.extend({init:function(){this._bIsMeasurement=true;this._parent()},Build:function(){this._parent();var m=this._generateMapChoiceFromEnumAndId(d.ESymbol,"Collab.Measurement.Symbol");var n=[{Name:"Collab.Measurement.DisplayValue",Type:b,DefaultValue:true,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.PreSymbol",Type:a,DefaultValue:d.ESymbol.None,GroupId:"Group.Measurement",MapChoice:m},{Name:"Collab.Measurement.PreString",Type:i,DefaultValue:"",GroupId:"Group.Measurement"},{Name:"Collab.Measurement.MiddleSymbol",Type:a,DefaultValue:d.ESymbol.None,GroupId:"Group.Measurement",MapChoice:m},{Name:"Collab.Measurement.MiddleString",Type:i,DefaultValue:"",GroupId:"Group.Measurement"},{Name:"Collab.Measurement.PostSymbol",Type:a,DefaultValue:d.ESymbol.None,GroupId:"Group.Measurement",MapChoice:m},{Name:"Collab.Measurement.PostString",Type:i,DefaultValue:"",GroupId:"Group.Measurement"},{Name:"Collab.Measurement.Attach.Type",Type:a,DefaultValue:d.EAttachType.Double,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(d.EAttachType,"Collab.Measurement.Attach.Type")},{Name:"Collab.Measurement.Value",Type:j,DefaultValue:0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.Length",Type:j,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length"},{Name:"Collab.Measurement.Length1",Type:j,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length"},{Name:"Collab.Measurement.Length2",Type:j,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length"},{Name:"Collab.Measurement.Radius",Type:j,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length"},{Name:"Collab.Measurement.Radius1",Type:j,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length"},{Name:"Collab.Measurement.Radius2",Type:j,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length"},{Name:"Collab.Measurement.Area",Type:j,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Area"},{Name:"Collab.Measurement.Volume",Type:j,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Volume"},{Name:"Collab.Measurement.ShowConstructionLines",Type:b,DefaultValue:true,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.ShowRedlines",Type:b,DefaultValue:true,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.ShowPlanes",Type:b,DefaultValue:true,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.ShowEndPoints",Type:b,DefaultValue:true,GroupId:"Group.Measurement"},{Name:"Collab.3D.Paper.Billboard.Type",DefaultValue:2},{Name:"Collab.Text",DefaultValue:""},{Name:"Collab.Text.Color",DefaultValue:new k().FromRGBA(1,1,1,1)},{Name:"Collab.Background.Color",DefaultValue:new k().FromRGBA(0.0666666666666667,0.596078431372549,0.8980392156862745,1)},{Name:"Collab.Body.Shape",DefaultValue:l.EBodyShape.RoundedRectangle},{Name:"Collab.3D.Paper.Referential.In.World",DefaultValue:false},{Name:"Collab.Body.HAlignment",DefaultValue:l.EHAlignment.Middle},{Name:"Collab.Body.VAlignment",DefaultValue:l.EVAlignment.Bottom},{Name:"Collab.3D.Paper.UsesBarycenter",DefaultValue:false},{Name:"Collab.Body.InnerMargin",DefaultValue:1},{Name:"Collab.HideIfOutsideAnchorFrustrum",DefaultValue:true},{Name:"Collab.Measurement.Type",Type:a,DefaultValue:d.EType.BetweenPoints,GroupId:"Group.Measurement",MapChoice:this._generateMapChoiceFromEnumAndId(d.EType,"Collab.Measurement.Type")}];this._BuildPropertyValues(n);this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",false);this.SetPropertyInvisible("Collab.Text",true)},SetPropertiesInfo:function(){this._parent();switch(this.GetPropertyValue("Collab.Measurement.Type")){case d.EType.BetweenPlanes:case d.EType.PlanePoint:this.SetPropertyInvisible("Collab.Measurement.ShowPlanes",false);break;default:this.SetPropertyInvisible("Collab.Measurement.ShowPlanes",true);break}switch(this.GetPropertyValue("Collab.Measurement.Type")){case d.EType.Arc:case d.EType.Angle:case d.EType.Volume:case d.EType.Area:case d.EType.AreaMultiplePoints:case d.EType.VolumeMultiplePoints:case d.EType.Coord:this.SetPropertyInvisible("Collab.Measurement.ShowConstructionLines",true);break;default:this.SetPropertyInvisible("Collab.Measurement.ShowConstructionLines",false);break}switch(this.GetPropertyValue("Collab.Measurement.Type")){case d.EType.Arc:case d.EType.Angle:case d.EType.BetweenPoints:case d.EType.Volume:case d.EType.Area:case d.EType.AreaMultiplePoints:case d.EType.VolumeMultiplePoints:case d.EType.Coord:this.SetPropertyInvisible("Collab.Measurement.ShowRedlines",true);break;default:this.SetPropertyInvisible("Collab.Measurement.ShowRedlines",false);break}this.SetPropertyInvisible("Collab.Measurement.Type",true);this.SetPropertyInvisible("Collab.Measurement.Length",true);this.SetPropertyInvisible("Collab.Measurement.Length1",true);this.SetPropertyInvisible("Collab.Measurement.Length2",true);this.SetPropertyInvisible("Collab.Measurement.Radius",true);this.SetPropertyInvisible("Collab.Measurement.Radius1",true);this.SetPropertyInvisible("Collab.Measurement.Radius2",true);this.SetPropertyInvisible("Collab.Measurement.Area",true);this.SetPropertyInvisible("Collab.Measurement.Volume",true)},GetProperty:function(m){if(m==="Collab.Measurement.Value"){if(this._Properties["Collab.Measurement.Value"]){switch(this.GetPropertyValue("Collab.Measurement.Type")){case d.EType.Angle:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Angle");break;case d.EType.AreaMultiplePoints:case d.EType.Area:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Area");break;case d.EType.VolumeMultiplePoints:case d.EType.Volume:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Volume");break;case d.EType.BetweenPlanes:case d.EType.BetweenLines:break;default:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Length");break}}var n=this.GetObject().getValue();return this.GetNewProperty(m,n)}else{return this._parent(m)}},GetComputedStringProperty:function(q,r){switch(this.GetPropertyValue("Collab.Measurement.Type")){case d.EType.Coord:var m=this.ExperienceBase.getManager("VCXUnitManager");var n=this.GetAnchorWorldMatrix(0,null);var s=h.getOFromMatrix(n);var p="";var o=m.getUnitType("Length");var t=o.SymbolDisplay;o.SymbolDisplay=e.ESymbolDisplay.None;p+="x = "+o.getString(s.x)+"\n";p+="y = "+o.getString(s.y)+"\n";p+="z = "+o.getString(s.z);o.SymbolDisplay=t;return p;break;default:var p="";p+=f.format(this.GetProperty("Collab.Measurement.PreSymbol"),this.ExperienceBase);p+=this.GetPropertyValue("Collab.Measurement.PreString");if(p.length>0){p+=" "}if(this.GetPropertyValue("Collab.Measurement.DisplayValue")){p+=f.format(this.GetProperty("Collab.Measurement.Value"),this.ExperienceBase)}p+=f.format(this.GetProperty("Collab.Measurement.MiddleSymbol"),this.ExperienceBase);p+=this.GetPropertyValue("Collab.Measurement.MiddleString");p+=f.format(this.GetProperty("Collab.Measurement.PostSymbol"),this.ExperienceBase);p+=this.GetPropertyValue("Collab.Measurement.PostString");return p}return this._parent(r)}});return c});define("DS/VCXWebDressup/VCXMeasurementAttachesNode",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXAttachSegmentNode","DS/VCXWebDressup/VCXComponentDressup","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebDressup/VCXComponentMeasurement","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXExtremityNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/Mesh/MeshUtils","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS"],function(k,b,l,p,f,n,d,c,o,j,m,e,g,h,i){var a=n.extend({init:function(q){this._parent(q);this._PanelNode=q.panelNode;this._BentLineSize=2;this._MinAngleAllowed=5;this._AttachType=p.EAttachType.Line;this._AttachNodes={};this.additionalGeometryRebuildObserver=new o();this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Value");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Area");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Volume");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Type");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Radius");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Radius1");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Radius2");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Length");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowConstructionLines");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowEndPoints");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowRedlines");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowPlanes");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Length1");this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Length2");return this},_computePosBuffer:function(q,s,r){q[0]=s.x;q[1]=s.y;q[2]=s.z;q[3]=r.x;q[4]=r.y;q[5]=r.z;return 2},_getLineNode:function(){var x=[new i.Vector3(),new i.Vector3()];var u=new Uint16Array([0,1]);var t=this.GetPropertyValue("Collab.Attach.Line.Type");var v=this.GetColorPropertyValue("Collab.Attach.Line");var w=1;if(t!==k.ELineType.Plain){var r=1;if(r===0){r=1}w=1/r}var q={type:this.GetPropertyValue("Collab.Attach.Line.Type"),lineWidth:this.GetPropertyValue("Collab.Attach.Line.Width"),color:v.GetThreeColor(),opacity:v.a,scale:w};this._LineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(q,this._LineMaterial);var s={points:x,idx:u,editable:true,drawMode:e.ConnectivityTypeEnum.LINES,material:this._LineMaterial};return h.createLineNode(s)},dispose:function(){if(this._attachMeasurementLabelLine1){this._attachMeasurementLabelLine1.dispose();this._attachMeasurementLabelLine1=null}if(this._attachMeasurementLabelLine2){this._attachMeasurementLabelLine2.dispose();this._attachMeasurementLabelLine2=null}if(this._attachMeasurementExtremity1){this._attachMeasurementExtremity1.dispose();this._attachMeasurementExtremity1=null}if(this._attachMeasurementExtremity2){this._attachMeasurementExtremity2.dispose();this._attachMeasurementExtremity2=null}this.additionalGeometryRebuildObserver=null;this._parent()},_ComputePosAttaches:function(D){var B=this.Modifiable.GetObject().getKeyPoints(D,this._PanelNode.GetShapeInfo().smartNode);this._PanelNode.GetShapeInfo().smartNode.BillboardXAxis=new i.Vector3().subVectors(B.labelLineExtremity2,B.labelLineExtremity1);var E=new i.Vector3().addVectors(B.labelLineExtremity1,B.labelLineExtremity2).multiplyScalar(0.5);var x;if(B.angle&&B.projectedPoint){x=B.projectedPoint}else{x=B.labelLineExtremity0}var y=new i.Vector3().subVectors(x,B.labelLineExtremity1);var w=new i.Vector3().subVectors(x,B.labelLineExtremity2);var r=y.dot(w)>0;this.extremityType=p.EExtremityType.FullArrow_1;var q;if(B.labelLineExtremity0&&B.labelLineExtremity1&&B.measurementExtremity1){if(B.angle){this._attachMeasurementExtremity1._ArrowTail=false;var s=B.labelLineExtremity0.distanceTo(B.labelLineExtremity1);this._attachMeasurementLabelLine1.StartExtremity=j.getVxFromMatrix(B.measurementExtremity0Frame).multiplyScalar(0.1*s).add(B.labelLineExtremity1)}else{this._attachMeasurementLabelLine1._ArrowTail=true;this._attachMeasurementLabelLine1.StartExtremity=E}this._attachMeasurementLabelLine1.BreakExtremity=B.labelLineExtremity1;this._attachMeasurementLabelLine1.EndExtremity=B.measurementExtremity1;this._attachMeasurementLabelLine1.preRender(D);if(this._attachMeasurementExtremity1){this._attachMeasurementExtremity1.Type=this.extremityType;if(B.angle){q=j.getVyFromMatrix(B.measurementExtremity0Frame).negate()}else{q=new i.Vector3().subVectors(this._attachMeasurementLabelLine1.BreakExtremity,this._attachMeasurementLabelLine1.StartExtremity)}if(r){this._attachMeasurementExtremity1.Type=this.extremityType+1;q.negate()}this._attachMeasurementExtremity1.SetReferential(j.getMatrixFromOVx(B.arrowLineExtremity1,q));this._attachMeasurementExtremity1.preRender(D)}}if(B.labelLineExtremity0&&B.labelLineExtremity2&&B.measurementExtremity2){if(B.angle){this._attachMeasurementExtremity2._ArrowTail=false;var s=B.labelLineExtremity0.distanceTo(B.labelLineExtremity2);this._attachMeasurementLabelLine2.StartExtremity=j.getVxFromMatrix(B.measurementExtremity0Frame).applyAxisAngle(j.getVzFromMatrix(B.measurementExtremity0Frame),Math.PI+B.value).multiplyScalar(-0.1*s).add(B.labelLineExtremity2)}else{this._attachMeasurementExtremity2._ArrowTail=true;this._attachMeasurementLabelLine2.StartExtremity=E}this._attachMeasurementLabelLine2.BreakExtremity=B.labelLineExtremity2;this._attachMeasurementLabelLine2.EndExtremity=B.measurementExtremity2;this._attachMeasurementLabelLine2.preRender(D);if(this._attachMeasurementExtremity2){this._attachMeasurementExtremity2.Type=this.extremityType+1;if(B.angle){q=j.getVyFromMatrix(B.measurementExtremity0Frame).applyAxisAngle(j.getVzFromMatrix(B.measurementExtremity0Frame),B.value)}else{q=new i.Vector3().subVectors(this._attachMeasurementLabelLine2.BreakExtremity,this._attachMeasurementLabelLine2.StartExtremity)}if(r){this._attachMeasurementExtremity2.Type=this.extremityType;q.negate()}this._attachMeasurementExtremity2.SetReferential(j.getMatrixFromOVx(B.arrowLineExtremity2,q));this._attachMeasurementExtremity2.preRender(D)}}if(this._lineNode){var z=this._lineNode.getBuffer(e.VertexComponentEnum.POSITION);if(z){var C;if(B.angle&&B.projectedPoint){C=this._computePosBuffer(z,B.projectedPoint,B.labelLineExtremity0)}else{if(!r){C=this._computePosBuffer(z,B.labelLineExtremity0,B.labelLineExtremity0)}else{if(B.labelLineExtremity0.distanceToSquared(B.labelLineExtremity1)<B.labelLineExtremity0.distanceToSquared(B.labelLineExtremity2)){C=this._computePosBuffer(z,B.labelLineExtremity1,B.labelLineExtremity0)}else{C=this._computePosBuffer(z,B.labelLineExtremity2,B.labelLineExtremity0)}}}this._lineNode.updateBuffer(e.VertexComponentEnum.POSITION,0,C);this._lineNode.computeBoundingElements()}}if(this._additionalGeometryBasedOnAttach0&&B.measurementExtremity0Frame){this._additionalGeometryBasedOnAttach0.setMatrix(B.measurementExtremity0Frame)}if(this._additionalGeometryBasedOnAttach1&&B.measurementExtremity1Frame){this._additionalGeometryBasedOnAttach1.setMatrix(B.measurementExtremity1Frame)}if(this._additionalGeometryBasedOnAttach2&&B.measurementExtremity2Frame){this._additionalGeometryBasedOnAttach2.setMatrix(B.measurementExtremity2Frame)}if(this._additionalGeometryBasedOnAttach3&&B.measurementExtremity3Frame){this._additionalGeometryBasedOnAttach3.setMatrix(B.measurementExtremity3Frame)}if(this._additionalGeometryBasedOnAttach4&&B.measurementExtremity4Frame){this._additionalGeometryBasedOnAttach4.setMatrix(B.measurementExtremity4Frame)}if(B.angle){var A=0;var t=B.value;if(B.projectedPoint){var F=new i.Vector3().subVectors(B.projectedPoint,B.measurementExtremity0);var u=new i.Vector3().crossVectors(j.getVxFromMatrix(B.measurementExtremity0Frame),F);var v=j.getVxFromMatrix(B.measurementExtremity0Frame).angleTo(F);if(j.getVzFromMatrix(B.measurementExtremity0Frame).dot(u)<0){A=-v;t+=Math.PI*0.05}else{if(v>t){t=v;A-=Math.PI*0.05}}}if(this._arcNode){this._additionalGeometryBasedOnAttach0.remove(this._arcNode);this._arcNode=null}this._arcNode=h.createCircleNode({radius:B.radius,startAngle:A,endAngle:t,material:this._attachMeasurementLabelLine1._lineMaterial});this._additionalGeometryBasedOnAttach0.add(this._arcNode);this._geometryAdded=true}return 2},postUpdate:function(q){this._parent();if(this.additionalGeometryRebuildObserver){this.additionalGeometryRebuildObserver.postUpdate()}},preRender:function(r){this._ComputePosAttaches(r);for(var q=0;q<this._preRenderGeometries.length;q++){this._preRenderGeometries[q].preRender(r)}},getPlaneNode:function(q){var s=new i.MeshBasicMaterial({side:i.DoubleSide,transparent:true,opacity:0.3,color:"#888888",force:true});s.line=new i.LineBasicMaterial({side:i.DoubleSide,transparent:false,color:"#000000",opacity:1,force:true,polygonBorderMode:true,lineWidth:2});var r=h.createRectangleNode({width:1,height:1,fill:true,material:s});var t=new g();t.setMatrix(new i.Matrix4().setPosition(new i.Vector3(-0.5,-0.5,0)));t.add(r);var u=new c(q);u.ModifiableProperties=false;u.SizeControlType=1;u.ScalingFactor=10;u.add(t);return u},update:function(u){this._parent();var t=this.GlobalOpacity;var I=this.GetPropertyValue("Collab.Attach.LeadType");if(this._AttachType!==I){this._AttachType=I}var x=false;if(this._AttachType!==p.ELeadType.None&&t>0){if(!this._AxisSystemNode){}if(this._AxisSystemNode){this._AxisSystemNode.setMatrix(this.Modifiable.GetObject().getReferential())}var J;if(!this._attachMeasurementLabelLine1){J={name:"AttachMeasurementLabelLine1",modifiable:this.Modifiable,endExtremityType:p.EExtremityType.Yellow};this._attachMeasurementLabelLine1=new b(J);this.add(this._attachMeasurementLabelLine1);this._geometryAdded=true}if(!this._attachMeasurementLabelLine2){J={name:"AttachMeasurementLabelLine2",modifiable:this.Modifiable,endExtremityType:p.EExtremityType.Yellow};this._attachMeasurementLabelLine2=new b(J);this.add(this._attachMeasurementLabelLine2);this._geometryAdded=true}if(!this._lineNode){this._lineNode=this._getLineNode();this.add(this._lineNode);this._geometryAdded=true}if(!this._attachMeasurementExtremity1){J={name:"AttachMeasurementExtremity1",modifiable:this.Modifiable,type:p.EExtremityType.Dot};this._attachMeasurementExtremity1=new d(J);this.add(this._attachMeasurementExtremity1);this._geometryAdded=true}if(!this._attachMeasurementExtremity2){J={name:"AttachMeasurementExtremity2",modifiable:this.Modifiable,type:p.EExtremityType.Dot};this._attachMeasurementExtremity2=new d(J);this.add(this._attachMeasurementExtremity2);this._geometryAdded=true}}if(this.additionalGeometryRebuildObserver){this.additionalGeometryRebuildObserver.update()}var C=this.ExperienceBase.getManager("VCXMaterialManager");if(!this._primaryAdditionalGeometryMaterial){var s={type:k.ELineType.Plain,lineWidth:3,color:new m().SetRGB(255,0,0).GetThreeColor(),opacity:t};this._primaryAdditionalGeometryMaterial=C.getLineMaterialFromParams(s)}if(!this._secondaryAdditionalGeometryMaterial){var F={type:k.ELineType.Dot,lineWidth:1,color:new m().SetRGB(0,0,0).GetThreeColor(),opacity:t};this._secondaryAdditionalGeometryMaterial=C.getLineMaterialFromParams(F)}if(!this._thirdAdditionalGeometryMaterial){var v={type:k.ELineType.Plain,lineWidth:1,color:new m().SetRGB(200,100,0).GetThreeColor(),opacity:t};this._thirdAdditionalGeometryMaterial=C.getLineMaterialFromParams(v)}if(!this._fourthAdditionalGeometryMaterial){var H={type:k.ELineType.Dot,lineWidth:1,color:new m().SetRGB(255,0,0).GetThreeColor(),opacity:t};this._fourthAdditionalGeometryMaterial=C.getLineMaterialFromParams(H)}if((this.additionalGeometryRebuildObserver&&this.additionalGeometryRebuildObserver.isDirty())||this.Modifiable.GetObject().hasPointedObjectMoved(u)){this._preRenderGeometries=[];if(this._additionalGeometryToUpdate){this.remove(this._additionalGeometryToUpdate);this._additionalGeometryToUpdate=null}if(this._additionalGeometryBasedOnAttach0){this.remove(this._additionalGeometryBasedOnAttach0);this._additionalGeometryBasedOnAttach0=null}if(this._additionalGeometryBasedOnAttach1){this.remove(this._additionalGeometryBasedOnAttach1);this._additionalGeometryBasedOnAttach1=null}if(this._additionalGeometryBasedOnAttach2){this.remove(this._additionalGeometryBasedOnAttach2);this._additionalGeometryBasedOnAttach2=null}if(this._additionalGeometryBasedOnAttach3){this.remove(this._additionalGeometryBasedOnAttach3);this._additionalGeometryBasedOnAttach3=null}if(this._additionalGeometryBasedOnAttach4){this.remove(this._additionalGeometryBasedOnAttach4);this._additionalGeometryBasedOnAttach4=null}}this._PanelNode.GetShapeInfo().smartNode.update(u);this._PanelNode.GetShapeInfo().smartNode.preRender(u);var B=this.Modifiable.GetObject().getKeyPoints(u,this._PanelNode.GetShapeInfo().smartNode);if(B.angle&&this.GetPropertyValue("Collab.Measurement.Type")===f.EType.BetweenLines){var G=new i.Matrix4().getInverse(this._PanelNode.GetShapeInfo().smartNode.GetReferential(u));this._PanelNode.GetShapeInfo().smartNode.Position=B.projectedPoint.clone().applyMatrix4(G)}if(!this._additionalGeometryToUpdate){this._additionalGeometryToUpdate=new g();this.add(this._additionalGeometryToUpdate);this._geometryAdded=true;if(this.GetPropertyValue("Collab.Measurement.ShowConstructionLines")){switch(this.GetPropertyValue("Collab.Measurement.Type")){case f.EType.BetweenCentres:case f.EType.BetweenPoints:case f.EType.LinePoint:case f.EType.BetweenLines:case f.EType.PlanePoint:case f.EType.BetweenPlanes:if(!B.angle){var A=h.createLineNode({points:[B.measurementExtremity1,B.measurementExtremity2],material:this._secondaryAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(A)}break}}if(B.angle&&this.GetPropertyValue("Collab.Measurement.ShowEndPoints")){if(B.measurementAnglePoint1){J={name:"MeasurementAnglePoint1",modifiable:this.Modifiable,type:p.EExtremityType.Yellow};var z=new d(J);z.SetReferential(new i.Matrix4().setPosition(B.measurementAnglePoint1));this._additionalGeometryToUpdate.add(z);this._preRenderGeometries.push(z)}if(B.measurementAnglePoint2){J={name:"MeasurementAnglePoint2",modifiable:this.Modifiable,type:p.EExtremityType.Yellow};var z=new d(J);z.SetReferential(new i.Matrix4().setPosition(B.measurementAnglePoint2));this._additionalGeometryToUpdate.add(z);this._preRenderGeometries.push(z)}}switch(this.GetPropertyValue("Collab.Measurement.Type")){case f.EType.BetweenLines:A=h.createLineNode({points:[B.measurementExtremity2,B.measurementExtremity4],material:this._fourthAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(A);this._geometryAdded=true;case f.EType.LinePoint:A=h.createLineNode({points:[B.measurementExtremity1,B.measurementExtremity3],material:this._fourthAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(A);this._geometryAdded=true;break;case f.EType.PlanePoint:case f.EType.BetweenPlanes:if(this.GetPropertyValue("Collab.Measurement.ShowPlanes")){this._geometryAdded=true;var J={name:"planeSmartNode",modifiable:this.Modifiable,type:this._type};if(B.measurementExtremity3Frame){J.name="planeSmartNode1";var E=this.getPlaneNode(J);E.SetReferential(B.measurementExtremity3Frame);this._preRenderGeometries.push(E);this._additionalGeometryToUpdate.add(E)}if(B.angle){if(B.measurementExtremity4Frame){J.name="planeSmartNode2";var E=this.getPlaneNode(J);E.SetReferential(B.measurementExtremity4Frame);this._preRenderGeometries.push(E);this._additionalGeometryToUpdate.add(E)}}else{if(B.measurementExtremity6Frame){J.name="planeSmartNode2";var E=this.getPlaneNode(J);E.SetReferential(B.measurementExtremity6Frame);this._preRenderGeometries.push(E);this._additionalGeometryToUpdate.add(E)}}}var A;if(this.GetPropertyValue("Collab.Measurement.ShowConstructionLines")){if(!B.angle&&B.measurementExtremity4){A=h.createLineNode({points:[B.measurementExtremity4,B.measurementExtremity3],material:this._secondaryAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(A)}if(!B.angle&&B.measurementExtremity6){A=h.createLineNode({points:[B.measurementExtremity6,B.measurementExtremity5],material:this._secondaryAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(A)}if(B.angle){A=h.createLineNode({points:[B.measurementExtremity1,B.measurementExtremity3],material:this._secondaryAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(A)}}if(!B.angle&&this.GetPropertyValue("Collab.Measurement.ShowRedlines")){A=h.createLineNode({points:[B.measurementExtremity1,B.measurementExtremity3],material:this._thirdAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(A);A=h.createLineNode({points:[B.measurementExtremity2,B.measurementExtremity4],material:this._thirdAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(A);if(B.measurementExtremity5){A=h.createLineNode({points:[B.measurementExtremity1,B.measurementExtremity5],material:this._thirdAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(A)}if(B.measurementExtremity6){A=h.createLineNode({points:[B.measurementExtremity2,B.measurementExtremity6],material:this._thirdAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(A)}}break}}var w,D,A,r,q;if(!this._additionalGeometryBasedOnAttach0){this._additionalGeometryBasedOnAttach0=new g();this.add(this._additionalGeometryBasedOnAttach0);this._geometryAdded=true;switch(this.GetPropertyValue("Collab.Measurement.Type")){case f.EType.Radius:case f.EType.Diameter:w=this.GetPropertyValue("Collab.Measurement.Radius");if(this.GetPropertyValue("Collab.Measurement.Type")===f.EType.Diameter){w*=0.5}if(this.GetPropertyValue("Collab.Measurement.ShowRedlines")){D=h.createCircleNode({radius:w,material:this._primaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach0.add(D);r=h.createLineNode({points:[new i.Vector3(-w*0.2,-w*0.2,0),new i.Vector3(w*0.2,w*0.2,0)],material:this._primaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach0.add(r);q=h.createLineNode({points:[new i.Vector3(-w*0.2,w*0.2,0),new i.Vector3(w*0.2,-w*0.2,0)],material:this._primaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach0.add(q)}break}}if(!this._additionalGeometryBasedOnAttach1){this._additionalGeometryBasedOnAttach1=new g();this.add(this._additionalGeometryBasedOnAttach1);this._geometryAdded=true;switch(this.GetPropertyValue("Collab.Measurement.Type")){case f.EType.LinePoint:case f.EType.BetweenLines:if(this.GetPropertyValue("Collab.Measurement.ShowRedlines")){A=h.createLineNode({points:[new i.Vector3(0,0,0),new i.Vector3(this.GetPropertyValue("Collab.Measurement.Length1"),0,0)],material:this._primaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach1.add(A)}break;case f.EType.Linear:if(this.GetPropertyValue("Collab.Measurement.ShowRedlines")){A=h.createLineNode({points:[new i.Vector3(0,0,0),new i.Vector3(B.value,0,0)],material:this._primaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach1.add(A)}break;case f.EType.BetweenCentres:w=this.GetPropertyValue("Collab.Measurement.Radius1");if(this.GetPropertyValue("Collab.Measurement.ShowRedlines")){D=h.createCircleNode({radius:w,material:this._primaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach1.add(D);r=h.createLineNode({points:[new i.Vector3(-w*0.2,-w*0.2,0),new i.Vector3(w*0.2,w*0.2,0)],material:this._primaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach1.add(r);q=h.createLineNode({points:[new i.Vector3(-w*0.2,w*0.2,0),new i.Vector3(w*0.2,-w*0.2,0)],material:this._primaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach1.add(q)}break;case f.EType.Radius:case f.EType.Diameter:if(this.GetPropertyValue("Collab.Measurement.ShowConstructionLines")){A=h.createLineNode({points:[new i.Vector3(0,0,0),new i.Vector3(B.value,0,0)],material:this._secondaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach1.add(A)}break}}if(!this._additionalGeometryBasedOnAttach2){this._additionalGeometryBasedOnAttach2=new g();this.add(this._additionalGeometryBasedOnAttach2);this._geometryAdded=true;switch(this.GetPropertyValue("Collab.Measurement.Type")){case f.EType.BetweenLines:if(this.GetPropertyValue("Collab.Measurement.ShowRedlines")){A=h.createLineNode({points:[new i.Vector3(0,0,0),new i.Vector3(this.GetPropertyValue("Collab.Measurement.Length2"),0,0)],material:this._primaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach2.add(A)}break;case f.EType.BetweenCentres:w=this.GetPropertyValue("Collab.Measurement.Radius2");if(this.GetPropertyValue("Collab.Measurement.ShowRedlines")){D=h.createCircleNode({radius:w,material:this._primaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach2.add(D);r=h.createLineNode({points:[new i.Vector3(-w*0.2,-w*0.2,0),new i.Vector3(w*0.2,w*0.2,0)],material:this._primaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach2.add(r);q=h.createLineNode({points:[new i.Vector3(-w*0.2,w*0.2,0),new i.Vector3(w*0.2,-w*0.2,0)],material:this._primaryAdditionalGeometryMaterial});this._additionalGeometryBasedOnAttach2.add(q)}break}}if(!this._additionalGeometryBasedOnAttach3){this._additionalGeometryBasedOnAttach3=new g();this.add(this._additionalGeometryBasedOnAttach3);this._geometryAdded=true;switch(this.GetPropertyValue("Collab.Measurement.Type")){}}if(!this._additionalGeometryBasedOnAttach4){this._additionalGeometryBasedOnAttach4=new g();this.add(this._additionalGeometryBasedOnAttach4);this._geometryAdded=true;switch(this.GetPropertyValue("Collab.Measurement.Type")){}}for(var y=0;y<this._preRenderGeometries.length;y++){this._preRenderGeometries[y].update(u)}if(this.GetPropertyValue("Collab.Measurement.ShowEndPoints")){this._attachMeasurementLabelLine1.EndExtremityType=p.EExtremityType.Yellow;this._attachMeasurementLabelLine2.EndExtremityType=p.EExtremityType.Yellow}else{this._attachMeasurementLabelLine1.EndExtremityType=p.EExtremityType.None;this._attachMeasurementLabelLine2.EndExtremityType=p.EExtremityType.None}this._attachMeasurementLabelLine1.update(u);this._attachMeasurementLabelLine2.update(u);this._attachMeasurementExtremity1.update(u);this._attachMeasurementExtremity2.update(u);this.RecursiveSetPickParent(true);var K=this.Modifiable.getLineMaterialParams("Collab.Attach.Line",this._LineMaterial,this._lastFrontLineType,t);if(Object.keys(K).length>0){if(typeof K.type==="number"&&K.type!==this._lastFrontLineType){this._lastFrontLineType=K.type}this._LineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(K,this._LineMaterial)}if(this._geometryAdded){this.traverse(function(M,L){if(M.setFrustumCulled){M.setFrustumCulled(false)}if(M.setShadow){M.setShadow(false,false)}if(M.setMirror){M.setMirror(false)}if(M.setPickParent){M.setPickParent(true)}return false},true)}this._primaryAdditionalGeometryMaterial.opacity=t;this._secondaryAdditionalGeometryMaterial.opacity=t;this._thirdAdditionalGeometryMaterial.opacity=t;this._fourthAdditionalGeometryMaterial.opacity=t;this.handleLayers(x)},});return a});define("DS/VCXWebDressup/VCXPanelNode",["DS/CoreEvents/Events","DS/Mesh/MeshUtils","DS/SceneGraphNodes/CanvasNode","DS/SceneGraphNodes/CanvasNodeTexture","DS/VCXWebDressup/VCXAttachesNode","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXMeasurementAttachesNode","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebDressup/VCXPropertyValueUnitFormater","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebVisualization/VCXHandle","DS/VCXWebVisualization/VCXImageManager","DS/VCXWebVisualization/VCXInteractor","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS",],function(q,f,o,s,j,a,e,c,n,l,b,k,p,i,m,d,r){var h=0.3527;var g=e.extend({init:function(t){this._parent(t);this._previousBackgroundDocID=null;this._CanvasNode=null;this._CanvasNodeTexture=null;this._HighlightCanvasNode=null;this._HighlightCanvasNodeTexture=null;this._Smart3DPaperNode=null;this._backgroundImage=null;this._externalMargin=0;this._lineWidth=0;this._TextSize=new r.Vector2();this._currentText=null;this.visible=false;return this},_SetShadow:function(u,v,t){u.shadowColor="transparent";u.shadowBlur=0;u.shadowOffsetX=0;u.shadowOffsetY=0;if(v&&this.GetPropertyGroupVisibility("Group.Shadow")){u.shadowColor="rgba(0, 0, 0, "+this.GetPropertyValue("Collab.Body.Shadow.Opacity")+")";u.shadowBlur=t*this.GetPropertyValue("Collab.Body.Shadow.Blur")/4;u.shadowOffsetX=t*Math.cos(this.GetPropertyValue("Collab.Body.Shadow.Orientation")/180*Math.PI)*this.GetPropertyValue("Collab.Body.Shadow.Distance");u.shadowOffsetY=t*Math.sin(this.GetPropertyValue("Collab.Body.Shadow.Orientation")/180*Math.PI)*this.GetPropertyValue("Collab.Body.Shadow.Distance")}},_DrawShape:function(w,v,x,u,t){var y=v.shape;this._SetShadow(w,x,t);if(y===a.EBodyShape.Circle||y===a.EBodyShape.Ellipse){w.beginPath();w.save();w.translate(v.x+v.width*0.5,v.y+v.height*0.5);w.translate(-v.width*0.5,-v.height*0.5);w.scale(v.width*0.5,v.height*0.5);w.arc(1,1,1,0,2*Math.PI,false);w.restore();w.closePath();if(u&&v.type!=="stroke"){w.clip()}}else{if(y===a.EBodyShape.Rhombus){w.beginPath();w.moveTo(v.x+v.width*0.5,v.y);w.lineTo(v.x+v.width,v.y+v.height*0.5);w.lineTo(v.x+v.width*0.5,v.y+v.height);w.lineTo(v.x,v.y+v.height*0.5);w.closePath();if(u&&v.type!=="stroke"){w.clip()}}else{if(y===a.EBodyShape.Rectangle||y===a.EBodyShape.Square){w.beginPath();w.rect(v.x,v.y,v.width,v.height);w.closePath()}else{w.beginPath();w.moveTo(v.x+v.cornerRadius,v.y);w.lineTo(v.x+v.width-v.cornerRadius,v.y);w.quadraticCurveTo(v.x+v.width,v.y,v.x+v.width,v.y+v.cornerRadius);w.lineTo(v.x+v.width,v.y+v.height-v.cornerRadius);w.quadraticCurveTo(v.x+v.width,v.y+v.height,v.x+v.width-v.cornerRadius,v.y+v.height);w.lineTo(v.x+v.cornerRadius,v.y+v.height);w.quadraticCurveTo(v.x,v.y+v.height,v.x,v.y+v.height-v.cornerRadius);w.lineTo(v.x,v.y+v.cornerRadius);w.quadraticCurveTo(v.x,v.y,v.x+v.cornerRadius,v.y);w.closePath()}}}if(v.type==="fill"){w.fill()}else{if(v.type==="stroke"){this._SetShadow(w,false,t);w.stroke()}}},_DrawRegularCanvas:function(t,w,v,u){t.VCXNode._DrawCanvas(t,w,v,u,false)},_DrawHighlightCanvas:function(t,w,v,u){t.VCXNode._DrawCanvas(t,w,v,u,true)},_DrawCanvas:function(t,y,U,P,F){var O=t.VCXNode;var u=O.GetShapeInfo().externalSize.x-2*O._externalMargin;var N=O.GetShapeInfo().externalSize.y-2*O._externalMargin;var I=0;if(O.GetPropertyValue("Collab.Body.InnerMargin")!==undefined){I=O.GetPropertyValue("Collab.Body.InnerMargin")}var x=I;var T=O._externalMargin;var S=O._externalMargin;if(this.GetShapeInfo().shape===a.EBodyShape.Square||this.GetShapeInfo().shape===a.EBodyShape.RoundedSquare||this.GetShapeInfo().shape===a.EBodyShape.Circle){var W=Math.max(u,N);u=W;N=W}var L={shape:this.GetShapeInfo().shape,x:T,y:S,width:u,height:N,cornerRadius:x,type:"fill",border:this.GetShapeInfo().border,};var E=O.GetColorPropertyValue("Collab.Background");var Q=E.Clone();Q.a=1/255;var Y=Q.GetStyle();y.save();y.globalCompositeOperation="copy";y.fillStyle=Y;y.globalAlpha=1;y.fillRect(0,0,t.width,t.height);y.restore();var G=false;if(this.GetShapeInfo().shape!==a.EBodyShape.None&&this.GetShapeInfo().shape!==a.EBodyShape.RemoveBorder){y.save();if(F){y.globalCompositeOperation="copy";Q.a=2/255;y.fillStyle=Q.GetStyle();y.globalAlpha=1}else{y.globalCompositeOperation="source-over";y.fillStyle=E.GetStyle();if(E.a>100/255&&O.GetPropertyGroupVisibility("Group.Background")){G=true}}if(!F&&!O.GetPropertyGroupVisibility("Group.Background")){L.type="none"}O._DrawShape(y,L,G,false,P);y.restore();if(F){return}}var R=O.GetPropertyValue("Collab.Image.Scale");var M=I+O._externalMargin;var w=I+O._externalMargin;var B=u-(2*I);var V=N-(2*I);var X=B*R;var C=V*R;M+=(B-X)*0.5;w+=(V-C)*0.5;if(!F&&O._backgroundImage&&O._backgroundImage._IsReadyToUse){y.save();y.globalCompositeOperation="source-over";var H=O.GetColorPropertyValue("Collab.Image");var D=H.a;H.a=1;y.fillStyle=H.GetStyle();y.globalAlpha=D;if(this.ExperienceBase.getManager("VCXContextManager").isIE11()||H.r===1&&H.g===1&&H.b===1){L.type="none";O._DrawShape(y,L,false,true,P);y.globalCompositeOperation="source-over";O._SetShadow(y,!G,P);G=true;y.drawImage(O._backgroundImage,M,w,X,C)}else{L.type="fill";O._DrawShape(y,L,false,true,P);y.globalCompositeOperation="destination-in";O._SetShadow(y,false,P);y.drawImage(O._backgroundImage,M,w,X,C);y.globalCompositeOperation="multiply";O._SetShadow(y,!G,P);G=true;y.drawImage(O._backgroundImage,M,w,X,C)}y.restore()}if(F&&O._backgroundImage&&O._backgroundImage._IsReadyToUse){y.save();y.globalCompositeOperation="source-over";y.globalAlpha=1;y.fillStyle=Y;O._SetShadow(y,false,P);L.type="fill";O._DrawShape(y,L,false,true,P);y.globalCompositeOperation="destination-in";y.drawImage(O._backgroundImage,M,w,X,C);y.restore();return}if(!F&&(this._lineWidth&&this.GetShapeInfo().shape>0)){y.save();y.globalCompositeOperation="source-over";var A=O.GetColorPropertyValue("Collab.Border.Line");y.strokeStyle=A.GetStyle();y.lineWidth=O._lineWidth;y.globalAlpha=A.a;L.type="stroke";O._DrawShape(y,L,false,false,P);y.restore()}if(!F&&O._currentText){y.save();y.globalCompositeOperation="source-over";O._SetShadow(y,!G,P);G=true;var K=T+(u-O._TextSize.x)*0.5;K/=h;var J=S+(N-O._TextSize.y)*0.5+O.Modifiable.GetObject().fontHeight*h*0.9;J/=h;y.scale(h,h);O._SetContextToDrawText(y);var v=O._currentText.split("\n");for(var z=0;z<v.length;z++){y.fillText(v[z],K,J);J+=(O.Modifiable.GetObject().fontHeight);J+=(O.Modifiable.GetObject().fontHeight)*0.1}y.restore()}if(F){y.save();y.globalCompositeOperation="source-over";y.fillStyle=Y;y.globalAlpha=1;L.shape=a.EBodyShape.Rectangle;L.type="fill";O._DrawShape(y,L,false,true,P);y.restore()}},_SetContextToDrawText:function(t){var v=this.GetColorPropertyValue("Collab.Text");t.fillStyle=v.GetStyle();t.globalAlpha=v.a;var u=this.GetFontPropertyValue("Collab.Text.Font");if(u){if(this._requestedFontRatio){this.Modifiable.GetObject().fontHeight=this._requestedFontRatio*u.Height}else{this.Modifiable.GetObject().fontHeight=u.Height}var w="";w+=" "+(u.Italic?"italic":"normal");w+=" "+(u.Weight||400);w+=" "+(this.Modifiable.GetObject().fontHeight||22)+"px";w+=" "+(u.Family||"Arial");t.font=w}},GetShapeInfo:function(){if(!this.Modifiable.GetObject().shapeInfo){this.Modifiable.GetObject().shapeInfo={};this.Modifiable.GetObject().shapeInfo.border={top:false,bottom:true,left:false,right:false}}return this.Modifiable.GetObject().shapeInfo},_ComputeSize:function(){this.GetShapeInfo().size.set(this.GetPropertyValue("Collab.Body.Width"),this.GetPropertyValue("Collab.Body.Height"));if(this._currentText){if(this.GetPropertyValue("Collab.Body.FitToText")){this.GetShapeInfo().size.copy(this._TextSize)}}this.GetShapeInfo().keepAspectRatio=false;if(this.GetPropertyValue("Collab.Body.KeepAspectRatio")){this.GetShapeInfo().keepAspectRatio=true;if(this._backgroundImage){this.GetShapeInfo().size.y=this.GetShapeInfo().size.x*this._backgroundImage.height/this._backgroundImage.width}else{if(this._TextSize.x>0){this.GetShapeInfo().size.y=this.GetShapeInfo().size.x*this._TextSize.y/this._TextSize.x}}}this.GetShapeInfo().sizeBeforeEqualization=this.GetShapeInfo().size.clone();if(this.GetPropertyValue("Collab.Body.ContributeToEqualSize")){this.GetShapeInfo().size.x=this.ExperienceBase.getManager("VCXDressupManager").GetCalloutMaxWidth()}if(this.GetShapeInfo().shape===a.EBodyShape.Square||this.GetShapeInfo().shape===a.EBodyShape.RoundedSquare||this.GetShapeInfo().shape===a.EBodyShape.Circle){this.GetShapeInfo().keepAspectRatio=true;var u=Math.max(this.GetShapeInfo().size.x,this.GetShapeInfo().size.y);this.GetShapeInfo().size.x=u;this.GetShapeInfo().size.y=u}this.GetShapeInfo().internalSize.copy(this.GetShapeInfo().size);var t=0;if(this.GetPropertyValue("Collab.Body.InnerMargin")!==undefined){t=this.GetPropertyValue("Collab.Body.InnerMargin")}this.GetShapeInfo().size.x+=2*t;this.GetShapeInfo().size.y+=2*t;this.GetShapeInfo().externalSize.copy(this.GetShapeInfo().size);if(this.GetPropertyGroupVisibility("Group.Shadow")){this._externalMargin=this.GetPropertyValue("Collab.Body.Shadow.Distance")+1}else{this._externalMargin=0.5}this._externalMargin+=this._lineWidth*0.5;this.GetShapeInfo().externalSize.x+=2*this._externalMargin;this.GetShapeInfo().externalSize.y+=2*this._externalMargin},_ReBuildCanvasNodeTexture:function(x){this._ComputeSize();if(!this._CanvasNode||!this._CanvasNodeTexture||Math.abs(this._CanvasNodeTexture.width-this.GetShapeInfo().externalSize.x)>0.1||Math.abs(this._CanvasNodeTexture.height-this.GetShapeInfo().externalSize.y)>0.1||this.realignCanvasObserver.isDirty()){if(this._CanvasNode&&this._Smart3DPaperNode){this._Smart3DPaperNode.remove(this._CanvasNode);this._CanvasNode=null;this._CanvasNodeTexture=null;this._Smart3DPaperNode.remove(this._HighlightCanvasNode);this._HighlightCanvasNode=null;this._HighlightCanvasNodeTexture=null}if(this.GetShapeInfo().externalSize.x*this.GetShapeInfo().externalSize.y>0){var t=-this._externalMargin;var z=-this._externalMargin;switch(this.GetPropertyValue("Collab.Body.HAlignment")){case a.EHAlignment.Left:this.GetShapeInfo().center.x=this.GetShapeInfo().size.x*0.5;t-=0;break;case a.EHAlignment.Middle:this.GetShapeInfo().center.x=0;t-=this.GetShapeInfo().size.x*0.5;break;case a.EHAlignment.Right:this.GetShapeInfo().center.x=-this.GetShapeInfo().size.x*0.5;t-=this.GetShapeInfo().size.x*1;break}switch(this.GetPropertyValue("Collab.Body.VAlignment")){case a.EVAlignment.Top:this.GetShapeInfo().center.y=this.GetShapeInfo().size.y*0.5;z-=this.GetShapeInfo().size.y*1;break;case a.EVAlignment.Middle:this.GetShapeInfo().center.y=0;z-=this.GetShapeInfo().size.y*0.5;break;case a.EVAlignment.Bottom:this.GetShapeInfo().center.y=-this.GetShapeInfo().size.y*0.5;z-=0;break}var G=this._computePanelCenterMM(x);if(G){this.GetShapeInfo().centerInPaper=G}var A=true;if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===a.EPositionType.Free3D){A=!this.GetPropertyValue("Actor.IsAlwaysOnTop")}var B=new r.Vector3(t,z,0);var P=new r.Vector3(this.GetShapeInfo().externalSize.x,0,0);var N=new r.Vector3(0,this.GetShapeInfo().externalSize.y,0);if(!this._HighlightCanvasNodeTexture){var H=this.GetShapeInfo().externalSize.x;var D=this.GetShapeInfo().externalSize.y;var J=true;var O=10;this._HighlightCanvasNodeTexture=new s({width:H,height:D,rectangleTexture:J,maxZoom:O,drawCB:this._DrawHighlightCanvas,alphaTest:2/255,materialParams:{opacity:this._globalOpacity,depthTest:A,depthWrite:false}});this._HighlightCanvasNodeTexture.VCXNode=this}this._HighlightCanvasNode=new o({name:"highlightCanvas",bottomLeftcorner:B,widthVector:P,heightVector:N,canvasNodeTexture:this._HighlightCanvasNodeTexture},d);if(this._Smart3DPaperNode){this._Smart3DPaperNode.add(this._HighlightCanvasNode);this.RecursiveSetPickParent(true);this.setPickParent(false);this.handleLayers(true)}this._HighlightCanvasNode.traverse(function(S,R){if(S.setFrustumCulled){S.setFrustumCulled(false)}if(S.setShadow){S.setShadow(false,false)}if(S.setMirror){S.setMirror(false)}return false},true);var K=this.Modifiable.QueryInterface("VCXIManipulable");if(K){var M=K.getAllInteractors();var v="BillboardedPanel";var u=M[v];if(!u){u=new i(this.Modifiable.GetObject());u.id=v;K.addInteractor(v,u);u.node=this._HighlightCanvasNode;u.active=this._isBillboardedPanelInteractorActive();u.constraintReferential=i.EConstraintReferential.Screen;u.visibility=i.EVisibility.NoChange;u.application=i.EApplication["3DIllustration"]|i.EApplication.CityIllustration;u.manipulatorType=i.EManipulatorType.None;u.matrix=new r.Matrix4()}else{this.ExperienceBase.getManager("VCXManipulatorManager").unsubscribeInteractor(K.GetObject(),u);u.node=this._HighlightCanvasNode}var w="3DPanel";var L=M[w];if(!L){L=new i(this.Modifiable.GetObject());L.id=w;K.addInteractor(w,L);L.node=this._HighlightCanvasNode;L.active=this._is3DPanelInteractorActive();L.constraint=i.EConstraint.Pick;L.constraintReferential=i.EConstraintReferential.World;L.application=i.EApplication["3DIllustration"]|i.EApplication.CityIllustration;L.visibility=i.EVisibility.NoChange;L.manipulatorType=i.EManipulatorType.None;L.matrix=new r.Matrix4()}else{this.ExperienceBase.getManager("VCXManipulatorManager").unsubscribeInteractor(K.GetObject(),L);L.node=this._HighlightCanvasNode}if(!this.Modifiable.GetObject().IsKindOf("VCXComponentMeasurement")){var Q=false;var y=Object.keys(this.EStrHandleResize);for(var E=0;E<y.length;++E){var I=y[E];var F="Resize "+I;var C=M[F];if(!C){M[F]=new i(this.Modifiable.GetObject());Q=true}}Q&&this._updateResizeInteractors(x)}}if(!this._CanvasNodeTexture){var H=this.GetShapeInfo().externalSize.x;var D=this.GetShapeInfo().externalSize.y;var J=true;var O=100;if(!this._currentText){O=10}this._CanvasNodeTexture=new s({width:H,height:D,rectangleTexture:J,maxZoom:O,drawCB:this._DrawRegularCanvas,alphaTest:0,materialParams:{opacity:this._globalOpacity,depthTest:A,depthWrite:false}});this._CanvasNodeTexture.VCXNode=this}this._CanvasNode=new o({name:"regularCanvas",bottomLeftcorner:B,widthVector:P,heightVector:N,canvasNodeTexture:this._CanvasNodeTexture},d);this._CanvasNode.setPickable(f.NODRAWHL);this._CanvasNode.rectangle.excludeFromHighlight(true,true);this._CanvasNode.traverse(function(S,R){if(S.excludeFromHighlight){S.excludeFromHighlight(R,R)}if(S.setFrustumCulled){S.setFrustumCulled(false)}if(S.setShadow){S.setShadow(false,false)}if(S.setMirror){S.setMirror(false)}return false},true);if(this._Smart3DPaperNode){this._Smart3DPaperNode.add(this._CanvasNode)}this.RecursiveSetRenderDepth(this.renderDepth);this._CanvasNodeTexture._requestRedraw();this._HighlightCanvasNodeTexture._requestRedraw()}}else{this._CanvasNodeTexture._requestRedraw();this._HighlightCanvasNodeTexture._requestRedraw()}this.ExperienceBase.getManager("VCXContextManager").renderAll();return this._CanvasNode},isNodeBuilt:function(){return Boolean(this._Smart3DPaperNode)},dispose:function(){if(this._Smart3DPaperNode){this._Smart3DPaperNode.dispose();this._Smart3DPaperNode=null}if(this._AttachesNode){this._AttachesNode.dispose();this._AttachesNode=null}this.realignCanvasObserver=null;this.rebuildAttachesObserver=null;this.rebuildCanvasObserver=null;this.textChangeObserver=null;this.redrawCanvasObserver=null;this.otherOptionsObserver=null;this._parent()},_Build:function(){this.GetShapeInfo().shape=1;this.GetShapeInfo().externalSize=new r.Vector2();this.GetShapeInfo().internalSize=new r.Vector2();this.GetShapeInfo().center=new r.Vector2();this.GetShapeInfo().centerInPaper=new r.Vector2();this.GetShapeInfo().size=new r.Vector2();this.GetShapeInfo().keepAspectRatio=null;this._AttachesNodeContainer=new m();this.add(this._AttachesNodeContainer);var t={name:"PanelSmartNode",modifiable:this.Modifiable,};this._Smart3DPaperNode=new b(t);this.GetShapeInfo().smartNode=this._Smart3DPaperNode;this.add(this._Smart3DPaperNode);this.RecursiveSetPickParent(true);this.setPickParent(false);this.handleLayers(true);if(this._myDiv){this._Smart3DPaperNode.AttachedDiv=this._myDiv}this.realignCanvasObserver=new n();this.realignCanvasObserver.add(this.Modifiable,"Collab.Body.HAlignment");this.realignCanvasObserver.add(this.Modifiable,"Collab.Body.VAlignment");this.rebuildAttachesObserver=new n();this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Measurement.Type");this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Measurement.Attach.Type");this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Attach.BentDot");this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Attach.LeadType");this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Attach.Origin");this.rebuildCanvasObserver=new n();this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Shape");this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Width");this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Height");this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.InnerMargin");this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.KeepAspectRatio");this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Border.Show");this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Border.Line.Width");this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Show");this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Doc.ID");this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Scale");this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Show");this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Distance");this.textChangeObserver=new n();this.textChangeObserver.add(this.Modifiable,"Collab.Text.Show");this.textChangeObserver.add(this.Modifiable,"Collab.Body.FitToText");this.textChangeObserver.add(this.Modifiable,"Collab.Text.Font");this.textChangeObserver.add(this.Modifiable,"Collab.Text.SizeToFit");this.redrawCanvasObserver=new n();this.redrawCanvasObserver.add(this.Modifiable,"Collab.Background.Color");this.redrawCanvasObserver.add(this.Modifiable,"Collab.Background.Color.Opacity");this.redrawCanvasObserver.add(this.Modifiable,"Collab.Background.Show");this.redrawCanvasObserver.add(this.Modifiable,"Collab.Border.Line.Color");this.redrawCanvasObserver.add(this.Modifiable,"Collab.Border.Line.Color.Opacity");this.redrawCanvasObserver.add(this.Modifiable,"Collab.Text.Color");this.redrawCanvasObserver.add(this.Modifiable,"Collab.Text.Color.Opacity");this.redrawCanvasObserver.add(this.Modifiable,"Collab.Image.Color");this.redrawCanvasObserver.add(this.Modifiable,"Collab.Image.Color.Opacity");this.redrawCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Orientation");this.redrawCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Opacity");this.redrawCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Blur");this.otherOptionsObserver=new n();this.otherOptionsObserver.add(this.Modifiable,"Collab.3D.Paper.Depth");this.otherOptionsObserver.add(this.Modifiable,"Actor.IsAlwaysOnTop");this.otherOptionsObserver.add(this.Modifiable,"Collab.3D.Paper.Billboard.Type")},preRender:function(u){var t=false;if(this.isVisible){this._parent(u);this.setVisibility(this.viewpointVisibility);if(this._Smart3DPaperNode){t|=this._Smart3DPaperNode.preRender(u)}if(this._AttachesNode){t|=this._AttachesNode.preRender(u)}}return t},postUpdate:function(t){this._parent();if(this._Smart3DPaperNode){this._Smart3DPaperNode.postUpdate(t)}if(this._AttachesNode){this._AttachesNode.postUpdate(t)}if(this.rebuildAttachesObserver){this.rebuildAttachesObserver.postUpdate()}if(this.realignCanvasObserver){this.realignCanvasObserver.postUpdate()}if(this.rebuildCanvasObserver){this.rebuildCanvasObserver.postUpdate()}if(this.redrawCanvasObserver){this.redrawCanvasObserver.postUpdate()}if(this.otherOptionsObserver){this.otherOptionsObserver.postUpdate()}if(this.textChangeObserver){this.textChangeObserver.postUpdate()}},update:function(y){this._parent();if(this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;this.isVisible=(this._globalOpacity>0);if(this.isVisible){if(!this._Smart3DPaperNode){this._Build()}}else{if(this._Smart3DPaperNode!==null){if(this._CanvasNode){this._Smart3DPaperNode.remove(this._CanvasNode);this._CanvasNodeTexture=null;this._CanvasNode=null}if(this._HighlightCanvasNode){this._Smart3DPaperNode.remove(this._HighlightCanvasNode);this._HighlightCanvasNode=null;this._HighlightCanvasNodeTexture=null}}}this.setVisibility(this.isVisible);if(this._myDiv){if(this._myDiv.style.opacity!==this._globalOpacity){this._myDiv.style.opacity=this._globalOpacity}}}if(this._globalOpacity<=0){return}var L=false;if(this._Smart3DPaperNode){this._Smart3DPaperNode.update(y)}if(this.rebuildAttachesObserver){this.rebuildAttachesObserver.update()}if(this.realignCanvasObserver){this.realignCanvasObserver.update()}if(this.rebuildCanvasObserver){this.rebuildCanvasObserver.update()}if(this.redrawCanvasObserver){this.redrawCanvasObserver.update()}if(this.otherOptionsObserver){this.otherOptionsObserver.update()}if(this.textChangeObserver){this.textChangeObserver.update()}if(this.otherOptionsObserver.isDirty()){var G=this.Modifiable.QueryInterface("VCXIManipulable");if(G){var J=G.getAllInteractors();var v=J.BillboardedPanel;if(v){v.active=this._isBillboardedPanelInteractorActive()}var C=J["3DPanel"];if(C){C.active=this._is3DPanelInteractorActive()}}}if(!this._AttachesNode||this.rebuildAttachesObserver.isDirty()){if(this.rebuildAttachesObserver.isDirty()){this._AttachesNodeContainer.remove(this._AttachesNode);this._AttachesNode=null}var N={name:"AttachesNode",modifiable:this.Modifiable,panelNode:this};if(this.Modifiable.GetPropertyGroupVisibility("Group.Attach")){if(this.Modifiable.GetObject().getAttachType&&this.Modifiable.GetObject().getAttachType()){this._AttachesNode=new c(N)}else{this._AttachesNode=new j(N)}if(this._AttachesNodeContainer){this._AttachesNodeContainer.add(this._AttachesNode)}}}if(this._AttachesNode){this._AttachesNode.update(y)}var z=true;if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===a.EPositionType.Free3D){z=!this.GetPropertyValue("Actor.IsAlwaysOnTop")}if(this._CanvasNodeTexture&&this._CanvasNodeTexture.setMaterialParams){this._CanvasNodeTexture.setMaterialParams({opacity:this._globalOpacity,depthTest:z,depthWrite:false})}if(this._HighlightCanvasNodeTexture&&this._HighlightCanvasNodeTexture.setMaterialParams){this._HighlightCanvasNodeTexture.setMaterialParams({opacity:this._globalOpacity,depthTest:z,depthWrite:false})}var O=this.redrawCanvasObserver.isDirty();var M=this.textChangeObserver.isDirty();var I=(this._HighlightCanvasNode===null||this._CanvasNode===null||M||this.rebuildCanvasObserver.isDirty()||this.realignCanvasObserver.isDirty());var H="";if(this.GetPropertyGroupVisibility("Group.Text")){H=this.Modifiable.GetComputedStringProperty("Collab.Text",l.format)}if(!H){H=null}if(this._currentText!==H){this._currentText=H;I=true;M=true}if(this.Modifiable.GetPropertyValue("Collab.Text.SizeToFit")&&I){M=true}if(!this.otherOptionsObserver.isDirty()&&!I&&!O&&!M){return}if(this._CanvasNodeTexture&&this._CanvasNodeTexture.setMaterialParams){this._CanvasNodeTexture.setMaterialParams({opacity:this._globalOpacity,depthTest:z,depthWrite:false})}if(this._HighlightCanvasNodeTexture&&this._HighlightCanvasNodeTexture.setMaterialParams){this._HighlightCanvasNodeTexture.setMaterialParams({opacity:this._globalOpacity,depthTest:z,depthWrite:false})}this.GetShapeInfo().shape=this.GetPropertyValue("Collab.Body.Shape");this._lineWidth=this.GetPropertyValue("Collab.Border.Line.Width");if(!this.GetPropertyGroupVisibility("Group.Border")){this._lineWidth=0}else{this._lineWidth*=h*0.5}if(this.GetPropertyValue("Collab.3D.Paper.Depth")!==undefined){var P=this.GetPropertyValue("Collab.3D.Paper.Depth");this.RecursiveSetRenderDepth(P)}if(M){if(this._currentText){var x=document.createElement("canvas");x.width=0;x.height=0;var A=x.getContext("2d");this._requestedFontRatio=null;this._SetContextToDrawText(A);if(this._currentText){var u=this._currentText.split("\n");this._TextSize.x=0;this._TextSize.y=0;for(var w=0;w<u.length;w++){this._TextSize.x=Math.max(this._TextSize.x,A.measureText(u[w]).width*h);this._TextSize.y+=(this.Modifiable.GetObject().fontHeight*h);this._TextSize.y+=(this.Modifiable.GetObject().fontHeight*h)*0.1}if(!this.Modifiable.GetPropertyValue("Collab.Body.FitToText")&&this.Modifiable.GetPropertyValue("Collab.Text.SizeToFit")){this._ComputeSize();var B=this.GetShapeInfo().internalSize.x/this._TextSize.x;var F=this.GetShapeInfo().internalSize.y/this._TextSize.y;this._requestedFontRatio=Math.min(B,F);this._TextSize.multiplyScalar(this._requestedFontRatio);this.Modifiable.GetObject().fontHeight*=this._requestedFontRatio}}}else{this._TextSize.x=0;this._TextSize.y=0}if(this._myDiv){this.Modifiable.GetUpdatedDiv()}}var E=false;var D=this.GetPropertyValue("Collab.Image.Doc.ID");if(D===null||D===undefined||!this.GetPropertyGroupVisibility("Group.Image")){D=-1}if(this._previousBackgroundDocID!==D||this._previousShape!==this.GetShapeInfo().shape){this._previousShape=this.GetShapeInfo().shape;this._previousBackgroundDocID=D;if(D!==-1){var K=this;var t=p.Effect.None;if(this.GetShapeInfo().shape===a.EBodyShape.RemoveBorder){t=p.Effect.RemoveBorder}this.ExperienceBase.getManager("VCXImageManager").GetImageFromDocID(D,t,(function(Q,R){K._backgroundImage=R;K._ReBuildCanvasNodeTexture(y);L=true}));E=true}else{if(this._backgroundImage){this._backgroundImage=null;I=true}}}if(!E){if(!this._CanvasNode||I){this._ReBuildCanvasNodeTexture(y);L=true}else{if(O){this._CanvasNodeTexture._requestRedraw();this._HighlightCanvasNodeTexture._requestRedraw();this.ExperienceBase.getManager("VCXContextManager").renderAll()}}}this.handleLayers(L)},updateInteractors:function(v){if(this._ExperienceBase.getManager("VCXContextManager").getPlayerMode()){return}if(!this.isNodeBuilt()){return}var t=this.Modifiable.QueryInterface("VCXIManipulable");if(!t){return}var u=this.Dirty||(this.Modifiable.GetObject().hasPointedObjectMoved());if(u){this.updateAnchorsInteractors(v)}if(this.ExperienceBase.getManager("VCXVisuManager").HasViewpointMoved&&(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")!==a.EPositionType.Free3D||this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")===a.EBillboardType.Spherical)||this.Dirty){this._updateResizeInteractors(v)}},_is3DPanelInteractorActive:function(){return !this.Modifiable.GetObject().IsKindOf("VCXComponentMeasurement")&&this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")===a.EBillboardType.None},_isBillboardedPanelInteractorActive:function(){return this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")===a.EBillboardType.Spherical},_computePanelCenterMM:function(D){var z=this.Modifiable;var G=null;var A=this._Smart3DPaperNode.BillboardType===a.EBillboardType.Spherical;switch(this._Smart3DPaperNode.PositioningType){case a.EPositionType.Free2D:var u=z.GetPropertyValue("Collab.3D.Paper.Paper.Position.X");var H=z.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y");G=new r.Vector2(u,H);break;case a.EPositionType.Free3D:if(!A){return}var y=this._ExperienceBase.getManager("VCXContextManager").getMainViewer();var B=this._Smart3DPaperNode.Position;var C=z.QueryInterface("W3AISGNodeHolder");var w=C.getPositionInWCS(y,B);var E=this._ExperienceBase.getManager("VCXPaperManager");var F={viewer:y,viewpoint:y.currentViewpoint};var v=E.ModelToMM2(F,w);G=new r.Vector2(v.x,v.y);break;case a.EPositionType.RelativeToReferential:var E=this.ExperienceBase.getManager("VCXPaperManager");var t=new r.Vector3().getPositionFromMatrix(this._Smart3DPaperNode.GetReferential(D));var x=E.GetModelPointFromModelPointAndPaperPosition(D,t,this._Smart3DPaperNode.Position2D,this._Smart3DPaperNode.PositionRadius);G=E.ModelToMM2(D,x);break;default:return}G.x+=this.GetShapeInfo().center.x;G.y+=this.GetShapeInfo().center.y;return G},_getPanelBoundsMM:function(u){var x=this._computePanelCenterMM(u);if(!x){return}this.GetShapeInfo().centerInPaper=x;var t=this.GetShapeInfo().size.x;var w=this.GetShapeInfo().size.y;var v={center:x,left:x.x-t*0.5,right:x.x+t*0.5,top:x.y-w*0.5,bottom:x.y+w*0.5};return v},_updateResizeInteractors:function(E){var z=this.Modifiable.QueryInterface("VCXIManipulable");var F=z&&z.getAllInteractors();if(F.length===0){return}var x=true;var A=this.Modifiable.GetPropertyValue("Collab.Text")!=="";var D=this.Modifiable.GetPropertyValue("Collab.Body.FitToText");if(D&&A){x=false}var H=this.Modifiable.GetPropertyValue("Collab.3D.Paper.Positioning.Type");var C=this.Modifiable.GetPropertyValue("Collab.3D.Paper.Billboard.Type")===a.EBillboardType.Spherical;var v=null;switch(H){case a.EPositionType.Free2D:case a.EPositionType.Free3D:case a.EPositionType.RelativeToReferential:break;case a.EPositionType.Perimetric:case a.EPositionType.Circle:case a.EPositionType.Rectangle:case a.EPositionType.Bottom:case a.EPositionType.BottomAndLeft:case a.EPositionType.BottomAndRight:case a.EPositionType.BottomAndTop:case a.EPositionType.Top:case a.EPositionType.TopAndLeft:case a.EPositionType.TopAndRight:case a.EPositionType.Left:case a.EPositionType.LeftAndRight:case a.EPositionType.Right:case a.EPositionType.EndOfAutomaticPositionning:default:x=false;break}if(!x){for(var u in F){if(F.hasOwnProperty(u)){if(u.includes("Resize")){F[u].active=false}}}return}var G=Object.keys(this.EStrHandleResize);for(var y=0;y<G.length;++y){var B=G[y];var w="Resize "+B;var t=F[w];if(!t){continue}if(this.GetShapeInfo().keepAspectRatio&&!(B.match(/Top|Bottom/)&&B.match(/Left|Right/))){t.active=false;continue}this._updateResizeInteractorUnit(t,B,E);t.active=true}},_updateResizeInteractorUnit:function(u,x,w){var t=this.Modifiable.GetPropertyValue("Collab.3D.Paper.Positioning.Type");var v=this.Modifiable.GetPropertyValue("Collab.3D.Paper.Billboard.Type");u.id="Resize "+x;u.manipulatorType=i.EManipulatorType.Handle;if(t===a.EPositionType.Free2D||v!==a.EBillboardType.None){u.constraintReferential=i.EConstraintReferential.Screen}else{u.constraintReferential=i.EConstraintReferential.World}u.visibility=i.EVisibility.OnObjectOver|i.EVisibility.OnObjectSelected|i.EVisibility.OnInteractorOver;u.application=i.EApplication["3DIllustration"]|i.EApplication.CityIllustration;if(t===a.EPositionType.Free2D||t===a.EPositionType.RelativeToReferential){this._updateResizeInteractorUnit2D(u,x,w)}else{this._updateResizeInteractorUnit3D(u,x,w)}},_updateResizeInteractorUnit2D:function(v,z,x){v.constraint=i.EConstraint.Pick;v.cursorPreactivate=i.ECursorDisplay[z];v.cursorManipulate="grabbing";var y=this._getPanelBoundsMM(x);if(!y){console.warn("Something's gone wrong with the computation of panel dimensions to place manipulators handles");return}var u=y.center.clone();if(z.includes("Top")){u.setY(y.top)}else{if(z.includes("Bottom")){u.setY(y.bottom)}}if(z.includes("Left")){u.setX(y.left)}else{if(z.includes("Right")){u.setX(y.right)}}var w=this._ExperienceBase.getManager("VCXPaperManager");var t=w.MMToModel2(x,u);v.matrix=new r.Matrix4().setPosition(t)},_updateResizeInteractorUnit3D:function(H,N,A){var y=N.includes("Left");var P=N.includes("Right");var aa=N.includes("Top");var V=N.includes("Bottom");var G=y?-1:(P?+1:0);var v=V?-1:(aa?+1:0);var w=Object.keys(this.Anchors)[0];var u=this.Modifiable.GetAnchorWorldMatrix(w,null);var U=new r.Vector3();var T=new r.Vector3();var R=new r.Vector3();u.extractBasis(U,T,R);H.constraint=i.EConstraint.CustomPlane;H.constraintInfos={planeAxis:R.clone()};var O=new r.Vector3().getPositionFromMatrix(u);var x=this._ExperienceBase.getManager("VCXContextManager").getMainViewer();var F=x&&x.currentViewpoint.getEyePosition();var S=new r.Vector3().subVectors(O,F);var I=S.dot(R.clone())<0;if(G===0){H.cursorPreactivate="ns-resize"}else{if(v===0){H.cursorPreactivate="ew-resize"}else{if(G+v===0){H.cursorPreactivate=I?"nwse-resize":"nesw-resize"}else{H.cursorPreactivate=I?"nesw-resize":"nwse-resize"}}}H.cursorManipulate="grabbing";var W;var M;switch(this.GetPropertyValue("Collab.Body.HAlignment")){case a.EHAlignment.Left:W=-1;break;case a.EHAlignment.Middle:W=0;break;case a.EHAlignment.Right:W=+1;break}switch(this.GetPropertyValue("Collab.Body.VAlignment")){case a.EVAlignment.Bottom:M=-1;break;case a.EVAlignment.Middle:M=0;break;case a.EVAlignment.Top:M=+1;break}var D=this.GetShapeInfo().smartNode.getMatrix();var ab=new r.Vector3().getPositionFromMatrix(D);var L=1;if(this.GetPropertyValue("Collab.Is.Paper")||this.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")===a.ESizeControlType.Paper){var Z=this._ExperienceBase.getManager("VCXPaperManager");var t={viewer:x,viewpoint:x.currentViewpoint};L=this._ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(t,ab)}var E=this.GetShapeInfo().size.x*0.5*L;var Q=this.GetShapeInfo().size.y*0.5*L;var Y=this.Modifiable.GetPropertyValue("Collab.3D.Paper.Billboard.Type")===a.EBillboardType.Spherical;var B=Y?x.currentViewpoint.getUpDirection():T;var z=x.currentViewpoint.getSightDirection().negate();var C=Y?new r.Vector3().crossVectors(B,z):U;var K=C.clone().multiplyScalar(E*(G-W));var J=B.clone().multiplyScalar(Q*(v-M));var X=ab.clone().add(K).add(J);H.matrix=D.clone().setPosition(X)},_updateInteractorTranslate:function(t,u){}});return g});define("DS/VCXWebDressup/VCXLabelSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPanelNode"],function(a,b){var c=a.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Label",modifiable:d,};this._sgNode=new b(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_LabelLeaf.png")}return this._parent()},});return c});define("DS/VCXWebDressup/VCXCalloutSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPanelNode"],function(b,c){var a=b.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Callout",modifiable:d,};this._sgNode=new c(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_CalloutLeaf.png")}return this._parent()},});return a});define("DS/VCXWebDressup/VCXMeasurementSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPanelNode"],function(a,c){var b=a.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Measurement",modifiable:d,};this._sgNode=new c(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_LabelLeaf.png")}return this._parent()},getWorldMatrix:function(d){return this.GetObject().getReferential()},});return b});define("DS/VCXWebDressup/VCXPanelSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPanelNode",],function(a,b){var c=a.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Panel",modifiable:d,};this._sgNode=new b(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Image2DLeaf.png")}return this._parent()},});return c});define("DS/VCXWebDressup/VCXComponentArrowCircular",["DS/VCXWebDressup/VCXComponentArrow"],function(b){var a=b.extend({init:function(){this._parent();this.IsAnchorDependent=true},});a.EFlatMode={Cylindrical:0,Flat:1,Hybrid:2};Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXComponentArrowCircular"}});a.prototype._dressupFamily="Markups";return a});define("DS/VCXWebDressup/VCXArrowCircularModifiable",["DS/VCXWebDressup/VCXArrowModifiable","DS/VCXWebDressup/VCXComponentArrowCircular","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector"],function(b,i,d,a,j,h,e,f,c){var g=b.extend({init:function(){this._parent();this._handleAnchor=null},Build:function(){this._parent();var k=[{Name:"Arrow.Circular.Flat",Type:a,DefaultValue:i.EFlatMode.Flat,GroupId:"Group.Arrow",MapChoice:this._generateMapChoiceFromEnumAndId(i.EFlatMode,"Flatness.Type",["Hybrid"])},{Name:"Arrow.Circular.Angle",Type:j,DefaultValue:270,Bounds:{Min:0,Max:360,Step:0.1},GroupId:"Group.Arrow",},{Name:"Arrow.Circular.Radius",Type:j,DefaultValue:100,GroupId:"Group.Arrow"},{Name:"Arrow.Circular.Step",Type:h,DefaultValue:30,Bounds:{Min:2,Max:100,Step:1},GroupId:"Group.Arrow",},{Name:"Actor.Anchor.0",Type:f,DefaultValue:new f().SetValueFrame(new e().SetValueFromVector(new d.Vector3(0,0,0))).GetValue(),GroupId:"Group.Arrow"},{Name:"Collab.ListAnchorsIDs",Type:c,DefaultValue:[0]}];this._BuildPropertyValues(k)},});return g});define("DS/VCXWebDressup/VCXDiggerPanelNode",["DS/CoreEvents/Events","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebDressup/VCXPanelNode","DS/VCXWebGUIInfra/VCXArcBar","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebKernel/VCXCmdChangeSelection","DS/WebappsUtils/WebappsUtils"],function(a,e,c,f,b,d,g){var h=c.extend({init:function(i){this._parent(i);return this},dispose:function(){this.deleteDiggerPanelToolbar()},isDiggerPanel:function(j){var i;if(j===undefined){i=this.Modifiable}else{i=j.QueryInterface("VCXIModifiable")}var k=i.GetPropertyValue("Collab.AssociatedObjectID");return k?true:false},_Build:function(){this._parent();if(this.isDiggerPanel()){this.createDiggerPanelToolbar()}},preRender:function(k){var j=false;if(this.isVisible){this._parent(k);if(this.isDiggerPanel()&&this._toolbar&&this._toolbar.isVisible()){var i=this.Modifiable.QueryInterface("VCXIManipulable");if(i){this._toolbar.setInManipulation(i.isManipulated())}var l=this.calcToolbarInfo();this._toolbar.updateLayout(l.centerPx,l.radiusPx);this._toolbar.updateVisibilityStyle()}}return j},update:function(j){var i=this.isVisible;this._parent(j);if(i!==this.isVisible){if(this.isDiggerPanel()&&this._toolbar){this._toolbar.setVisible(this.isVisible);this._toolbar.updateVisibilityStyle()}}},addDiggerPanelEvents:function(){this._WUXEventTokens={};var j=this;var i=function(n,m){if(j._toolbar&&j.isVisible){for(var k=0;k<m.length;++k){var l=m[k];if(l===j.Modifiable.GetObject()){j._toolbar.setSelected(n);j._toolbar.updateVisibilityStyle();break}}}};this._WUXEventTokens.VCX_SELECTION_ADD=a.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},function(k){i(true,k)});this._WUXEventTokens.VCX_SELECTION_REMOVE=a.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},function(k){i(false,k)})},removeDiggerPanelEvents:function(){for(var i in this._WUXEventTokens){if(this._WUXEventTokens.hasOwnProperty(i)&&this._WUXEventTokens[i]){a.unsubscribe(this._WUXEventTokens[i]);this._WUXEventTokens[i]=null}}},calcToolbarInfo:function(){var m={};var k=this.ExperienceBase.getManager("VCXPaperManager");var j=k.GetMmToPxRatio();m.radiusPx=(j*this.GetShapeInfo().size.x+32)/2+5;var i=this.GetShapeInfo().centerInPaper;m.centerPx={x:j*i.x,y:j*i.y};var l=k._ViewBoxPx;m.centerPx.x+=l.x;m.centerPx.y+=l.y;return m},createDiggerPanelToolbar:function(){if(this._toolbar){return}var i=null;var k=this._ExperienceBase.getManager("VCXNLSManager");if(k){i=k.GetNLS(["VCXWebDressup/VCXWebDressup"])}if(!i){return null}var j=this._ExperienceBase.getManager("VCXContextManager");var l=this.calcToolbarInfo();var m=this;this._toolbar=new f({experienceBase:this._ExperienceBase,body:j.getUIFrame(),frmWindow:j.getFrameWindow(),title:"Digger Panel",actionBar:j.getActionBar(),heightElem:24,widthElem:24,padding:2,updateOpacity:false,startAngle:50,clockwise:false,center:l.centerPx,radius:l.radiusPx,lJsonElement:[{nls:i.getTitle({key:"DiggerPanel.Update",}),url:g.getWebappsAssetUrl("VCXWebDressup","icons/I_VCX_DiggerPanel_Update.png"),id:"id_1",type:"element",callback:function(n){m.reliveDiggers(true)},},{nls:i.getTitle({key:"DiggerPanel.Relive",}),url:g.getWebappsAssetUrl("VCXWebDressup","icons/I_VCX_DiggerPanel_Relive.png"),id:"id_2",type:"element",callback:function(n){m.reliveDiggers(false)},},]});this.addDiggerPanelEvents()},deleteDiggerPanelToolbar:function(){this.removeDiggerPanelEvents();if(this._toolbar){this._toolbar.clear();this._toolbar=null}},reliveDiggers:function(o){var j=this._ExperienceBase.getManager("VCXSelectionManager");var l=j.GetComponentsFromSelection("CSO");var k=this.Modifiable.GetObject();if(!l.includes(k)){l.push(k)}for(var i=0;i<l.length;++i){var k=l[i];if(this.isDiggerPanel(k)){var n=k.QueryInterface("W3AISGNodeHolder");if(n){var m=n.getSGNode();if(m){m.reliveDigger(o,k)}}}}},reliveDigger:function(o,t){var v;if(t===undefined){v=this.Modifiable}else{v=t.QueryInterface("VCXIModifiable")}var r=v.GetPropertyValue("Collab.AssociatedObjectID");if(r){var n=this._ExperienceBase.ComponentsMap.GetComponentFromID(r);if(n){var k=v.GetObject().QueryInterface("VCXIVisibility");if(k){k.SetVisibility(b.EVisState.Hidden)}if(!o&&this._toolbar){this._toolbar.setVisible(false)}var q=n.QueryInterface("W3AISGNodeHolder");if(q){var s=q.getSGNode();if(s){var u=this.GetShapeInfo();var j=this.Modifiable.GetPropertyValue("Collab.Attach.Show")&&(this.Modifiable.GetPropertyValue("Collab.Attach.LeadType")!==e.ELeadType.None);var i=Object.keys(this.Anchors)[0];var m=this.Modifiable.GetAnchorWorldMatrix(i,null);s.SetPropertiesFromPanel(u,j,m);if(o){var l=n.QueryInterface("VCXIVisibility");if(l){l.SetVisibility(b.EVisState.Visible)}this.ExperienceBase.webApplication.runloop.func.apply(this.ExperienceBase.webApplication.runloop.data,[{time:1,deltaTime:1}]);s.createSnapshot2D(false);if(l){l.SetVisibility(b.EVisState.Hidden)}}}}if(!o){var l=n.QueryInterface("VCXIVisibility");if(l){l.SetVisibility(b.EVisState.Visible)}var p=new d(this.ExperienceBase.getManager("VCXSelectionManager"));p.SetSelection(n);this.ExperienceBase.getManager("VCXCommandManager").Do(p)}}}},onDoubleClick:function(){if(this.isDiggerPanel()){this.reliveDigger(false)}},});return h});define("DS/VCXWebDressup/VCXDiggerPanelSGNodeHolder",["DS/VCXWebDressup/VCXPanelSGNodeHolder","DS/VCXWebDressup/VCXDiggerPanelNode",],function(c,b){var a=c.extend({init:function(){},unreferenceSGNode:function(){if(this._sgNode){this._sgNode.dispose();delete this._sgNode}},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Panel",modifiable:d,};this._sgNode=new b(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Image2DLeaf.png")}return this._parent()},});return a});define("DS/VCXWebDressup/VCXDressupOrganisationShapeTop",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(b,c){var a=b.extend({rewind:function(){this._parent();this.iPariteX=0;this.fX=0;this.dx=0;this.fY=this.fHalfSizeY-this.fCellSize;if(this.fY<0){this.fY=0}},next:function(){this._parent();if(this.fX===0){this.iPariteX++}this.iPariteX++;if(this.iPariteX===2){this.iPariteX=0;this.fX+=this.fCellSize;if(this.fX>this.fHalfSizeX-this.fCellSize){if(this.dx===0){this.dx=this.fCellSize*0.5}else{this.dx=0}this.fX=0;this.fY-=this.fCellSize;if(this.fY<-this.fHalfSizeY+this.fCellSize){this.rewind();return true}}}return false},getPoint:function(){var d=new c.Vector2();if(this.iPariteX&1){d.x=this.fHalfSizeX-this.fX+this.dx}else{d.x=this.fHalfSizeX+this.fX+this.dx}d.y=this.fHalfSizeY-this.fY;return d}});return a});define("DS/VCXWebDressup/VCXArrowCircularNode",["DS/VCXWebDressup/VCXArrowNode","DS/Visualization/ThreeJS_DS",],function(c,b){var a=c.extend({init:function(d){this._parent(d)},_ComputePosBuffer:function(h,w,o,s,g){var e=this.GetAnchorWorldMatrix(0,h);if((typeof e==="undefined")||(e===null)){console.error("anchorMatrix is null or undefined for circular arrow: ",this.Modifiable.GetObject());return}var d=new b.Vector3().getPositionFromMatrix(e);var j=1;if(this.GetPropertyValue("Collab.Is.Paper")){j=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(h,d);j*=this.GetPropertyValue("Arrow.Scale")}var t=this.GetPropertyValue("Arrow.Width.1")*j;var v=0;var x=0;var n=0;if(this.GetPropertyValue("Arrow.Head.ShowMode")){v=this.GetPropertyValue("Arrow.Head.Length")*j;x=this.GetPropertyValue("Arrow.Head.Size")*j;n=this.GetPropertyValue("Arrow.Head.Shape")*j}var q=this.GetPropertyValue("Arrow.Width.2")*j;var r=0;var m=0;var p=0;if(this.GetPropertyValue("Arrow.Head.2.ShowMode")){r=this.GetPropertyValue("Arrow.Head.2.Length")*j;m=this.GetPropertyValue("Arrow.Head.2.Size")*j;p=this.GetPropertyValue("Arrow.Head.2.Shape")*j}var k=this.GetPropertyValue("Arrow.Circular.Flat");if(typeof k!=="number"){k=1}var i=this.GetPropertyValue("Arrow.Circular.Angle");var u=(2*Math.PI*i)/360;var l=this.GetPropertyValue("Arrow.Circular.Radius");var f={width1:t,head1Length:v,head1Size:x,head1Shape:n,width2:q,head2Length:r,head2Size:m,head2Shape:p,arcAngleRad:u,arrowRadius:l,flatnessMode:k};this._fillPosBuffer(w,s,f);this._fillColorBuffer(o,g);return this._verticesNb},_addCoupleVerticesConsideredMainTransfMatrix:function(m,k,i,j,l){var n=((this._step-j)*i.width2+j*i.width1)/(2*this._step);var h=new b.Vector3(-n,0,0).applyMatrix4(l);var e=new b.Vector3(+n,0,0).applyMatrix4(l);var d=j+2;var g=3*d,f=3*(this._verticesNb-d);m[g]=h.x;m[g+1]=h.y;m[g+2]=h.z;m[f]=e.x;m[f+1]=e.y;m[f+2]=e.z;k[g]=h.x;k[g+1]=h.y;k[g+2]=h.z;k[f]=e.x;k[f+1]=e.y;k[f+2]=e.z},_addHeadPosInBuffer:function(p,k,f,e,l){var o,d,m,n,i;var q=new b.Matrix4();if(e===1){o=3*(this._step+3);d=f.width1;m=f.head1Size;n=f.head1Length;i=f.head1Shape}else{if(e===2){o=3*(2*this._step+7);d=f.width2;m=f.head2Size;n=f.head2Length;i=f.head2Shape;q.makeRotationZ(Math.PI)}else{throw"Arguments for _addHeadPosInBuffer method not valid."}}l.multiply(q);var j=new b.Vector3(-(d/2+m),i,0);var g=new b.Vector3(0,n,0);var h=new b.Vector3(-j.x,j.y,j.z);j.applyMatrix4(l);g.applyMatrix4(l);h.applyMatrix4(l);p[o]=j.x;k[o]=j.x;o++;p[o]=j.y;k[o]=j.y;o++;p[o]=j.z;k[o]=j.z;o++;o=o%(3*this._verticesNb);p[o]=g.x;k[o]=g.x;o++;p[o]=g.y;k[o]=g.y;o++;p[o]=g.z;k[o]=g.z;o++;p[o]=h.x;k[o]=h.x;o++;p[o]=h.y;k[o]=h.y;o++;p[o]=h.z;k[o]=h.z;o++},_fillPosBuffer:function(i,f,e){var h=new b.Matrix4();var j=new b.Matrix4();var g=new b.Matrix4();var l=new b.Matrix4();var k=new b.Matrix4();if(e.flatnessMode===0){h.makeRotationY(Math.PI/2)}j.makeTranslation(e.arrowRadius,0,0);l.multiply(j).multiply(h);this._addHeadPosInBuffer(i,f,e,2,l.clone());for(var d=0;d<=this._step;++d){g.makeRotationZ(e.arcAngleRad*d/this._step);k.copy(g).multiply(l);this._addCoupleVerticesConsideredMainTransfMatrix(i,f,e,d,k.clone())}g.makeRotationZ(e.arcAngleRad);k.copy(g).multiply(l);this._addHeadPosInBuffer(i,f,e,1,k.clone())},preRender:function(d){this._parent(d)},update:function(d){this._parent();this._step=this.GetPropertyValue("Arrow.Circular.Step");this._updateNodePresence();this._updateNodeBuffers(d,false);this._updateNodePositionFromAnchor();if(this._globalOpacity<=0){return}if(this._Node){this._updateArrowMaterialsParameters();this.handleLayers()}},_updateNodePresence:function(){if(this._lastStep!==this._step){this.removeChild(this._Node);this._Node=null}if((!this._Node&&this.GlobalOpacity>0)||this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var d=(this._globalOpacity>0);if(d&&!this._Node){this._Build();this._lastStep=this._step}if(this._Node){this._Node.setVisibility(d)}}},});return a});define("DS/VCXWebDressup/VCXArrowCircularSGNodeHolder",["DS/VCXWebDressup/VCXArrowSGNodeHolder","DS/VCXWebDressup/VCXArrowCircularNode"],function(c,b){var a=c.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var d=this.GetObject().QueryInterface("VCXIModifiable");var e={name:"Circular Arrow",modifiable:d,};this._sgNode=new b(e);this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ArrowCircular.png")}return this._parent()},});return a});define("DS/VCXWebDressup/VCXDressupOrganisationManager",["DS/WebApplicationBase/W3AAManager","DS/VCXWebDressup/VCXComponentMarkup","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebDressup/VCXDressupOrganisationShapePerimetric","DS/VCXWebDressup/VCXDressupOrganisationShapeCircle","DS/VCXWebDressup/VCXDressupOrganisationShapeRectangle","DS/VCXWebDressup/VCXDressupOrganisationShapeBottom","DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndLeft","DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndRight","DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndTop","DS/VCXWebDressup/VCXDressupOrganisationShapeTop","DS/VCXWebDressup/VCXDressupOrganisationShapeTopAndLeft","DS/VCXWebDressup/VCXDressupOrganisationShapeTopAndRight","DS/VCXWebDressup/VCXDressupOrganisationShapeLeft","DS/VCXWebDressup/VCXDressupOrganisationShapeLeftAndRight","DS/VCXWebDressup/VCXDressupOrganisationShapeRight","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXColor","DS/VCXWebVisibility/VCXIVisibility",],function(c,a,v,k,r,l,p,o,s,n,d,u,j,f,i,e,g,t,m,q,h){var b=c.extend({initialize:function(){},postInitialize:function(){},SetDirty:function(){this.needUpdate=true},getUpdatePriority:function(){return 2},unInitialize:function(){},setExperienceBase:function(w){this._experienceBase=w},_checkIfCellFree:function(A,x,C,y){for(var B=x-y-1;B<x+y;B++){for(var z=C-y-1;z<C+y;z++){if(z>0&&z<A.height&&B>0&&B<A.width){var w=(A.height-z)*A.width+B;w*=4;if(A.data[w+0]!==0||A.data[w+1]!==0||A.data[w+2]!==0||A.data[w+3]!==255){return false}}else{return false}}}return true},_flagCellBusy:function(A,x,C,y){for(var B=x-y-1;B<x+y;B++){for(var z=C-y-1;z<C+y;z++){if(z>0&&z<A.height&&B>0&&B<A.width){var w=(A.height-z)*A.width+B;w*=4;A.data[w+0]=1;A.data[w+1]=1;A.data[w+2]=1;A.data[w+3]=1}}}},_findFirstCellCandidatePerimetric:function(w,D){var C=this._experienceBase.getManager("VCXPaperManager");var y=C.Size;var A=Math.floor(D.leadGridPositionInMM.x*w.width/y.x);var z=Math.floor(D.leadGridPositionInMM.y*w.height/y.y);var x=0;var E=0;for(var B=1;B<Math.max(w.width,w.height);B++){for(x=Math.max(0,A-B);x<Math.min(w.width,A+B);x++){var E=Math.max(0,z-B);if(this._checkIfCellFree(w,x,E)){return{col:x,row:E}}E=Math.min(w.height,z+B);if(this._checkIfCellFree(w,x,E)){return{col:x,row:E}}}for(E=Math.max(0,z-B-1);E<Math.min(w.height,z+B-1);E++){var x=Math.max(0,A-B);if(this._checkIfCellFree(w,x,E)){return{col:x,row:E}}x=Math.min(w.width,A+B);if(this._checkIfCellFree(w,x,E)){return{col:x,row:E}}}}},autoAlignDressups:function(B){var U=this._experienceBase.getManager("VCXDressupManager");this._dressupsToAlign=U._automaticAlignmentDressups;if(!this._dressupsToAlign||this._dressupsToAlign.length===0){return}var ab=this._experienceBase.getManager("VCXVisuManager");var ac=this._experienceBase.getManager("VCXPaperManager");var N=ac.Size;var F=256;var E=Math.round(F/N.x*N.y);var L=ab.getOccupationGrid(F,E,B.viewer);if(!this.organisationShapes){this.organisationShapes={}}for(var G in this.organisationShapes){if(this.organisationShapes.hasOwnProperty(G)){this.organisationShapes[G]._dressups=[];this.organisationShapes[G].rewind()}}if(L){var S=this._experienceBase.getManager("VCXContextManager").getActiveBOM();if(S){var J=S.QueryInterface("VCXIVisibility");if(J&&J.GetVisibility()!==h.EVisState.Hidden){var I=S.QueryInterface("VCXIModifiable");if(I.GetPropertyValue("Actor.Opacity")){var C=I.GetPropertyValue("Collab.3D.Paper.Paper.Position.X");var M=I.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y");var Q=I.GetPropertyValue("Collab.Body.Width");var O=I.GetPropertyValue("Collab.Body.Height");var P=Math.floor(C*L.width/N.x);var W=Math.ceil((C+Q)*L.width/N.x);var w=Math.floor(M*L.height/N.y);var A=Math.ceil((M+O)*L.height/N.y);for(var D=P;D<=W;D++){for(var H=w;H<=A;H++){var K=(L.height-H)*L.width+D;K*=4;L.data[K+0]=1;L.data[K+1]=1;L.data[K+2]=1;L.data[K+3]=1}}}}}var V;for(var z=0;z<this._dressupsToAlign.length;z++){var Y=this._dressupsToAlign[z];Y.leadAutoPosLock=false;Y.textAutoPosLock=false;var X=(Y.shapeInfo&&Y.shapeInfo.size&&Y.shapeInfo.size.x)||1;var R=Y.QueryInterface("VCXIModifiable");var Z=R.GetPropertyValue("Collab.3D.Paper.Positioning.Type");V=this.organisationShapes[Z];if(!V){switch(Z){case a.EPositionType.Perimetric:V=new r(N);break;case a.EPositionType.Circle:V=new l(N);break;case a.EPositionType.Rectangle:V=new p(N);break;case a.EPositionType.Bottom:V=new o(N);break;case a.EPositionType.BottomAndLeft:V=new s(N);break;case a.EPositionType.BottomAndRight:V=new n(N);break;case a.EPositionType.BottomAndTop:V=new d(N);break;case a.EPositionType.Top:V=new u(N);break;case a.EPositionType.TopAndLeft:V=new j(N);break;case a.EPositionType.TopAndRight:V=new f(N);break;case a.EPositionType.Left:V=new i(N);break;case a.EPositionType.LeftAndRight:V=new e(N);break;case a.EPositionType.Right:V=new g(N);break}this.organisationShapes[Z]=V;V.fCellSize=X*1.5;V.rewind()}V.fCellSize=X*1.5;if(Z===a.EPositionType.Perimetric){V.rewind()}if(!V._dressups){V._dressups=[]}V._dressups.push(Y);Y.leadGridPositionInMM=new v.Vector2(N.x*0.5,N.y*0.5);R.processAnchorsIDs(function(ag){if(ag==="Location"){return}var ak=k.getOFromMatrix(R.GetAnchorWorldMatrix(ag,B));var aj=ac.ModelToMM2(B,ak);Y.leadGridPositionInMM.set(aj.x,aj.y);var ai=Math.floor(Y.leadGridPositionInMM.x*L.width/N.x);var ah=Math.floor(Y.leadGridPositionInMM.y*L.height/N.y);var af=(L.height-ah)*L.width+ai;af*=4;L.data[af+0]=1;L.data[af+1]=1;L.data[af+2]=1;L.data[af+3]=1});if(V){var y=false;var T=false;var aa;while(!y){aa=V.getPoint(Y.leadGridPositionInMM);var ae=Math.floor(aa.x*L.width/N.x);var ad=Math.floor(aa.y*L.height/N.y);var x=Math.floor(X*0.5*N.x/L.width);y=T||this._checkIfCellFree(L,ae,ad,x);if(y){this._flagCellBusy(L,ae,ad,x)}if(V.next()){T=true}}Y.textGridPositionInMM=aa}}}for(var G in this.organisationShapes){if(this.organisationShapes.hasOwnProperty(G)){if(this.organisationShapes[G]._dressups.length===0){delete this.organisationShapes[G]}}}this._uncrossLinks(B)},_locateCallout:function(w,z,y){var A=w.QueryInterface("W3AISGNodeHolder");if(A){var x=A.getSGNode();if(x&&x._Smart3DPaperNode){x._Smart3DPaperNode.Position2D.copy(z)}}},_uncrossLinks:function(D){for(var B in this.organisationShapes){if(this.organisationShapes.hasOwnProperty(B)){var w=this.organisationShapes[B];var z=w._dressups.length;if(!w._squareDistances||(w._squareDistances.length!==z*z)){w._squareDistances=new Array(z*z)}for(var y=0;y<z;y++){var A=w._dressups[y];A.leadSector=0;A.textSector=0;for(var x=0;x<z;x++){var F=w._dressups[x];F.leadSector=0;F.textSector=0;var E=y*z+x;var C=F.leadGridPositionInMM.distanceToSquared(A.textGridPositionInMM);w._squareDistances[E]={textComponent:A,textSector:0,leadComponent:F,leadSector:0,squareDistance:C}}}w._squareDistances.sort(function(H,G){return H.squareDistance-G.squareDistance});this._splitSectorInto2Sectors(0,0,w,D)}}},_splitSectorInto2Sectors:function(L,N,O,z){var I=0;for(var R=0;R<L;R++){I|=1<<R}var A=O._squareDistances.length;var y=new v.Vector2();var x=new v.Vector2();var C=false;for(var P=0;P<A&&!C;P++){var S=O._squareDistances[P];if(!S.leadComponent.leadAutoPosLock&&!S.textComponent.textAutoPosLock){if((N===(S.leadComponent.leadSector&I))&&(N===(S.textComponent.textSector&I))){S.leadComponent.leadAutoPosLock=true;S.textComponent.textAutoPosLock=true;y.copy(S.leadComponent.leadGridPositionInMM).sub(S.textComponent.textGridPositionInMM);var D=0;var Q=0;var G=0;var J=0;var U=1<<L;var F=~U;var K;var T;var E;var H;var B=O._dressups.length;for(var M=0;M<B;M++){var w=O._dressups[M];if(!w.leadAutoPosLock&&(N===(w.leadSector&I))){x.copy(w.leadGridPositionInMM).sub(S.textComponent.textGridPositionInMM);if(y.x*x.y>y.y*x.x){D++;K=w;w.leadSector|=U}else{G++;T=w;w.leadSector&=F}}if(!w.textAutoPosLock&&(N===(w.textSector&I))){x.copy(w.textGridPositionInMM).sub(S.textComponent.textGridPositionInMM);if(y.x*x.y>y.y*x.x){Q++;E=w;w.textSector|=U}else{J++;H=w;w.textSector&=F}}}if(D===Q){C=true;this._locateCallout(S.leadComponent,S.textComponent.textGridPositionInMM,z);if(D>1){this._splitSectorInto2Sectors(L+1,N|U,O,z)}else{if(D===1&&E&&K){this._locateCallout(K,E.textGridPositionInMM,z)}}if(G>1){this._splitSectorInto2Sectors(L+1,N,O,z)}else{if(G===1&&H&&T){this._locateCallout(T,H.textGridPositionInMM,z)}}}else{S.leadComponent.leadAutoPosLock=false;S.textComponent.textAutoPosLock=false;S=null}}}}if(!C){console.warn("No candidate found")}},displayBuffer:function(w){var x=document.createElement("canvas");x.width=w.width;x.height=w.height;var y=x.getContext("2d");var z=y.createImageData(w.width,w.height);z.data.set(w.data);y.putImageData(z,0,0);window.open(x.toDataURL("image/png"))},});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"VCXDressupOrganisationManager"}});return b});define("DS/VCXWebDressup/VCXDressupManager",["DS/CoreEvents/Events","DS/VisuEvents/EventsManager","DS/WebApplicationBase/W3AAManager","DS/VCXWebDressup/VCXDressupOrganisationManager","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebModifiables/VCXModelChangeListener","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelTools/VCXMathTools","DS/VCXWebDressup/VCXComponentMarkup","DS/VCXWebModifiablesServices/VCXModifiablesAccess",],function(a,b,d,e,c,g,f,h,k,i){var j=d.extend({initialize:function(){this._calloutMaxWidth=0;this._DressupRoot=null;this._DressupComponents={};this._DressupGrpsComponents=null;this._DressupComponentsToPreRender={};this._DressupSectionsToPreRender={};this._DressupComponentsToPostRender={};this._DressupOrganisationManager=new e();this._DressupOrganisationManager.setExperienceBase(this._experienceBase);this._DressupOrganisationManager.initialize()},postInitialize:function(){if(!this._DressupOrganisationManager){console.error("DressupOrganisationManager should not be null");return}this._DressupOrganisationManager.postInitialize();this._currentWorkingRootMatrix=new f.Matrix4();this._experienceBase.getManager("VCXContextManager").loadCssFile("VCXWebDressup/VCXWebDressup.css",1);var m=this;this.createDressupsBaseSGNodes();this.event_VCX_PROPERTIES_CHANGED=a.subscribe({event:"VCX_PROPERTIES_CHANGED"},function(n){m.needUpdate=true});this._doublePointerClickCB=function l(r){var o=i.GetModifiableFromEvent(r,m._experienceBase);if(o){var p=o.GetObject();if(p){var n=p.QueryInterface("W3AISGNodeHolder");if(n){var q=n.getSGNode();if(q&&q.onDoubleClick){q.onDoubleClick()}}}}};b.addEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerDoubleClick",this._doublePointerClickCB)},getDressupGroups:function(){if(!this._DressupGrpsComponents){this._DressupGrpsComponents={Annotations:null,Callouts:null,Cameras:null,CuttingPlanes:null,Diggers:null,Environment:null,Markups:null,Measurements:null,Panels:null,Paths:null,}}return this._DressupGrpsComponents},SetDirty:function(){this.needUpdate=true},getUpdatePriority:function(){return -5},unInitialize:function(){if(!this._DressupOrganisationManager){console.error("DressupOrganisationManager should not be null");return}this._DressupOrganisationManager.unInitialize();this._DressupOrganisationManager=null;a.unsubscribe(this.event_VCX_SET_REFRESH_VISU);this.event_VCX_SET_REFRESH_VISU=null;a.unsubscribe(this.event_VCX_PROPERTIES_CHANGED);this.event_VCX_PROPERTIES_CHANGED=null;b.removeEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas,"onPrimaryPointerDoubleClick",this._doublePointerClickCB);this._doublePointerClickCB=null;this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebDressup/VCXWebDressup.css",1);this.RemoveDressups(this._DressupComponents);if(this._DressupRoot){this._experienceBase.getManager("VCXContextManager").getMainViewer().removeNode(this._DressupRoot);this._DressupRoot=null}this._DressupComponents=null;this._DressupGrpsComponents=null;this._DressupComponentsToPreRender=null;this._DressupSectionsToPreRender=null;this._DressupComponentsToPostRender=null;this._automaticAlignmentDressups=null},createDressupsBaseSGNodes:function(){var o=this.QueryInterface("W3AISGNodeHolder");this._DressupRoot=o.getSGNode();if(this._experienceBase.getManager("VCXContextManager").getRootComponent()){}else{return}var m=this._experienceBase.getManager("VCXContextManager").getRootComponent().QueryInterface("VCXIModelNavigable");var l=this.QueryInterface("VCXIModelNavigable");if(l){l.setParent(m);for(var n in this.getDressupGroups()){if(this.getDressupGroups().hasOwnProperty(n)){if(this.getDressupGroups().dressupGrpType){continue}this.GetDressupGroup(n)}}}},GetDressupRoot:function(){if(!this._DressupRoot){this.createDressupsBaseSGNodes()}return this._DressupRoot},FindBestName:function(x,n){var u=this.GetDressupGroup(x);if(u){if(!u.highestValue){var s=u.QueryInterface("VCXIModelNavigable");u.highestValue=0;var r=this;var m=s.getChildren();var o=m.length;for(var p=0;p<o;++p){var v=m[p];var w=v.QueryInterface("VCXIModifiable");if(w){var l=w.GetPropertyValue("Actor.Name");var t=RegExp(n+"_(\\d*)$");var q=l.match(t);if(q){if(parseInt(q[1])>u.highestValue){u.highestValue=q[1]}}}}}u.highestValue++;return n+"_"+(u.highestValue+"").padStart(3,"0")}},GetDressupGroup:function(o){if(!o){console.warn("?? Check with ITY")}var l=this.getDressupGroups()[o];if(!l){l=this._experienceBase.Factory.BuildComponent("VCXComponentDressupGrp");l.SetID(o+"ID");l.setName(o);l.SetPersistency(2);this._experienceBase.ComponentsMap.AddComponent(l);this.getDressupGroups()[o]=l;var n=this.QueryInterface("VCXIModelNavigable");var m=l.QueryInterface("VCXIModelNavigable");if(m&&n){m.setParent(n)}}return l},AddDressups:function(m){for(var l=0;l<m.length;++l){this._addDressup(m[l])}if(m.length!==0){a.publish({event:"VCX_DRESSUPS_ADDED",data:m})}},_addDressup:function(l){var o=l.QueryInterface("VCXIModifiable");if(!o){return}var q=l.GetID();if(q){if(this._DressupComponents[q]){return}this._DressupComponents[q]=l;if(l.preRender){if(l.IsKindOf("VCXComponentSection")){this._DressupSectionsToPreRender[q]=l}else{this._DressupComponentsToPreRender[q]=l}}if(l.postRender){this._DressupComponentsToPostRender[q]=l}var n=this.GetDressupGroup(l._dressupFamily).QueryInterface("VCXIModelNavigable");var m=l.QueryInterface("VCXIModelNavigable");if(m&&n){m.setParent(n)}var p=l.QueryInterface("W3AISGNodeHolder");if(p){p.getSGNode()}}else{}},RemoveDressups:function(o){if(Object.keys(o).length===0){return}a.publish({event:"VCX_DRESSUPS_PREREMOVED",data:o});for(var p in o){if(o.hasOwnProperty(p)){this._removeDressup(o[p])}}a.publish({event:"VCX_DRESSUPS_REMOVED",data:o});for(var l=0;l<o.length;++l){var n=o[p];var m=n.GetID();delete this._DressupComponents[m];delete this._DressupComponentsToPreRender[m];delete this._DressupSectionsToPreRender[m];delete this._DressupComponentsToPostRender[m]}},_removeDressup:function(m){var o;if(this.getDressupGroups()[m._dressupFamily]){o=this.getDressupGroups()[m._dressupFamily].QueryInterface("VCXIModelNavigable")}var r=m.QueryInterface("W3AISGNodeHolder");if(r){var p=r.giveSGNode();if(p){var q=p.getParents()[0];q.removeChild(p);var n=q.getChildren();if(n.length===0){q.setVisibilityInTree(false)}}}var l=m.QueryInterface("VCXIModelNavigable");if(l&&o){o.removeChild(l);l.clear()}},RefreshVisuAfterDressupChange:function(){this.needUpdate=true;this.UpdateDressupList();var l=this._experienceBase.getManager("VCXModelChangeListener");if(l){l.hasChanged(g.FChangeFlag.BomID,true);l.hasChanged(g.FChangeFlag.Visibility,true);l.hasChanged(g.FChangeFlag.DressupVisibility,true)}this._experienceBase.getManager("VCXContextManager").renderAll()},getDressups:function(){return this._DressupComponents},getDressupsFromGroup:function(q){var o=[];var l=this.GetDressupGroup(q);if(l){var p=l.QueryInterface("VCXIModelNavigable");if(p){var n=p.getChildren();var r=n.length;for(var m=0;m<r;++m){o.push(n[m].GetObject())}}}return o},GetDressupCount:function(){var l=0;for(var m in this._DressupComponents){if(this._DressupComponents.hasOwnProperty(m)){l++}}return l},update:function(w){this._parent(w);if(this._DressupOrganisationManager){this._DressupOrganisationManager.update(w)}var o=this._experienceBase.getManager("VCXContextManager");if(!o){return}var s=this.QueryInterface("VCXIModelNavigable");var r=s.getWorkingRoot();if(r){var v=r.QueryInterface("W3AISGNodeHolder");if(v){var x=v.getWorldMatrix(o.getMainViewer());if(!h.IsMat1EqualsToMat2(x,this._currentWorkingRootMatrix)){this._currentWorkingRootMatrix=x.clone();this.needUpdate=true}}}if(o.partHasMoved){this.groundDirty=2}if(this.groundDirty>0){var u=o.getActiveGround();if(u){u.updatePosition()}var t=o.getActiveViewport().getActiveAmbienceID();var q=this._experienceBase.ComponentsMap.GetComponentFromID(t);if(q){q.updatePosition()}this.groundDirty--}var z=this._experienceBase.getManager("VCXVisuManager");if(this._automaticAlignmentDressups&&this._automaticAlignmentDressups.length){if(z.HasViewpointMoved||o.partHasMoved){this.alignmentDirty=2}}else{this.alignmentDirty=0}this._dressupsHaveBeenAligned=false;this._automaticAlignmentDressups=[];for(var l in this._DressupComponents){if(this._DressupComponents.hasOwnProperty(l)){var p=this._DressupComponents[l];if(this.needUpdate||p.IsDressupPropertiesChangeIndependent){var n=false;var m=p.QueryInterface("VCXIVisibility");if(m&&m.GetVisibility()!==c.EVisState.Hidden){n=true;var y=p.QueryInterface("VCXIModifiable");if(y&&y.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<k.EPositionType.EndOfAutomaticPositionning){this._automaticAlignmentDressups.push(p)}}if(!p.isDirty()&&n&&((p.IsAnchorDependent&&p.hasPointedObjectMoved(w))||(p.IsViewPointDependent&&z.HasViewpointMoved))){p.setDirty()}if(p.isDirty()||(w&&w.force)){if(p.update){p.update(w)}}}}}},postUpdate:function(n){if(!this._DressupOrganisationManager){console.error("DressupOrganisationManager should not be null");return}this._parent(n);this._DressupOrganisationManager.postUpdate(n);var m=0;for(var p in this._DressupComponents){if(this._DressupComponents.hasOwnProperty(p)){var l=this._DressupComponents[p];if(l.postUpdate){l.postUpdate(n)}var o=l.QueryInterface("VCXIModifiable");if(o&&o.GetPropertyValue("Collab.Body.ContributeToEqualSize")&&l.shapeInfo&&l.shapeInfo.sizeBeforeEqualization){m=Math.max(m,l.shapeInfo.sizeBeforeEqualization.x)}}}if(this._calloutMaxWidth!==m){this._calloutMaxWidth=m;this.needUpdate=true}this.needUpdate=false},preRender:function(o){if(!this._DressupOrganisationManager){console.error("DressupOrganisationManager should not be null");return}this._parent(o);this._DressupOrganisationManager.preRender(o);this._preRenderDone=false;if(o.onlyPostProcess){return}var m=this._experienceBase.getManager("VCXContextManager");m.applyToViewers(function(q){if(q.lockRenderIteration){q.lockRenderIteration()}});for(var p in this._DressupSectionsToPreRender){if(this._DressupSectionsToPreRender.hasOwnProperty(p)){var n=this._DressupSectionsToPreRender[p];var l=n.QueryInterface("VCXIVisibility");if(l&&l.GetVisibility()===c.EVisState.Hidden){continue}if(n.preRender){n.preRender(o)}}}if(this.alignmentDirty){this.alignmentDirty--;this._DressupOrganisationManager.autoAlignDressups(o)}for(var p in this._DressupComponentsToPreRender){if(this._DressupComponentsToPreRender.hasOwnProperty(p)){var n=this._DressupComponentsToPreRender[p];var l=n.QueryInterface("VCXIVisibility");if(l&&l.GetVisibility()===c.EVisState.Hidden){continue}if(n.preRender){n.preRender(o)}}}this._preRenderDone=true;m.applyToViewers(function(q){if(q.unlockRenderIteration){q.unlockRenderIteration()}})},postRender:function(n){if(!this._DressupOrganisationManager){console.error("DressupOrganisationManager should not be null");return}this._parent(n);this._DressupOrganisationManager.postRender(n);if(this._preRenderDone){for(var o in this._DressupComponentsToPostRender){if(this._DressupComponentsToPostRender.hasOwnProperty(o)){var m=this._DressupComponentsToPostRender[o];var l=m.QueryInterface("VCXIVisibility");if(l&&l.GetVisibility()!==c.EVisState.Hidden){if(m.postRender){m.postRender(n)}}}}}},ChangeVisuProperties:function(o,m,l,n){},UpdateDressupList:function(){for(var n in this._DressupComponents){if(this._DressupComponents.hasOwnProperty(n)){var m=this._DressupComponents[n];if(m.update){var l={deltaTime:0,viewer:this._experienceBase.getManager("VCXContextManager").getMainViewer(),viewpoint:this._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint};m.update(l)}}}},GetCalloutMaxWidth:function(){return this._calloutMaxWidth},getVersion:function(){return"1.0.6"}});Object.defineProperty(j.prototype,"componentType",{enumerable:true,get:function(){return"VCXDressupManager"}});return j});