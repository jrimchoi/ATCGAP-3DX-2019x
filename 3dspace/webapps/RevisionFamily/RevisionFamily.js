define("DS/RevisionFamily/RevisionFamilyModel",["UWA/Controls/Abstract","DS/LifecycleServices/ArrayFunctions"],function(c,b){var a=c.extend({init:function(){this.objects={};this.currentObject={}},setCurrentObject:function(d){if(this.currentObject!==d){this.currentObject=d}},getCurrentObject:function(){return this.currentObject},setObjects:function(e){var d=JSON.parse(e);if(d.hasOwnProperty("data")){this.objects=d.data;var f=this.objects.find(function(g){if(g.id===this.currentObject.id){return true}return false},this);if(f!=null){this.setCurrentObject(f)}}},getObjects:function(){return this.objects},removeObjects:function(d){if(!UWA.is(d,"array")){return}d.forEach(function(e){this.removeObject(e)},this)},removeObject:function(e){var d=0;for(;d<this.objects.length;++d){if(this.objects[d].id===e){this.objects.splice(d,1);return}}},setObjectsInternal:function(d){this.objects=d},getObjectTitle:function(d){for(var e=0;e<this.objects.length;++e){if(this.objects[e].id===d){return this.objects[e].displayName}}},objectIsInModel:function(d){for(var e=0;e<this.objects.length;++e){if(this.objects[e].id===d){return true}}return false},});return a});define("DS/RevisionFamily/RevisionFamilyController",["UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","DS/RevisionFamily/RevisionFamilyModel","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(h,c,e,d,f,a,g){var b=h.extend({tenant:null,init:function(){this.model=new e()},initTree:function(j){var i=this;d.getSecurityContextPromise(this.tenant).then(function(k){i.getRevisionHistory(j,k)})},getRevisionHistory:function(k,j){if(!k.hasOwnProperty("physicalid")){return}var i=this;var l=f.get3DSpaceWSUrl(i.tenant,"/resources/lifecycle/revision/family",null);a.authenticatedRequest(l,{method:"GET",type:"text",headers:f.getHeaders(j),timeout:600000,data:"physicalid="+k.physicalid,onComplete:function(m){i.model.setObjects(m);i.dispatchEvent("onTreeInfoChanged");i.dispatchEvent("onCompleteGetRevisionHistory")},onFailure:function(m,n){i.dispatchEvent("onError",d.parseWebServiceError(m,n))},ontimeout:function(){i.dispatchEvent("onError",g.connectionTimeout)}})},setTenant:function(i){this.tenant=i}});return b});define("DS/RevisionFamily/RevisionFamily",["css!DS/RevisionFamily/RevisionFamily","UWA/Core","UWA/Controls/Abstract","UWA/Utils/InterCom","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","DS/ApplicationFrame/CommandsManager","DS/LifecycleCmd/CommandAPI","DS/RevisionFamily/RevisionFamilyModel","DS/UIBehaviors/ContextualMenuManager","DS/Menu/Menu","DS/WebInWinHelper/WebInWinHelper","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","WebappsUtils/WebappsUtils","DS/ENO6WPlugins/jQuery","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/VersionExplorerSettings"],function(a,j,s,m,w,h,c,n,g,f,l,o,d,v,b,i,p,r,q,t){var e=false;var u="PushItem";var k=s.extend({context:null,currentObject:undefined,defaultOptions:{wintop:false,},WebToWinComSocket:null,ContextualMenuData:null,init:function(C,x,z,y,A){var B=this;this.widget=C;this.bottomMargin=z;b.getHistoryConfigPromise().then(function(D){t.historyConfig=D},function(){t.historyConfig=null});this._parent(y);this._buildSkeleton();this._getParentContainer=function(){if(x){return x}else{return j.Element.getElement.call(C.body,".history_popup")}};this.parentWidget=x;this.contextMenuObject=null;if(B.options.wintop==true){this.WebToWinComSocket=y.webToWinComSocket}this.context=A;this.id=Date.now()},updateObjectTitle:function(x,z){var y=document.getElementById(this.getUniqueHtmlIdForNode(x));if(y){y.textContent=z+"\u00A0"}},getUniqueHtmlIdForNode:function(x){return x+"revision"},showCompare:function(C,B){var z=this;if(z.options.wintop==true){if(z.ContextualMenuData!=null){o.launchWinCompare(z.WebToWinComSocket,C,B)}}else{var E=[];var A=widget.getValue("x3dPlatformId");if(null!==C){E.push({envId:A,serviceId:"",contextId:"",objectId:C.id,objectType:"",displayName:""})}if(null!==B){E.push({envId:A,serviceId:"",contextId:"",objectId:B.id,objectType:"",displayName:""})}if(E.length>0){var x={envId:A,protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:E}};var y=new m.Socket("compassPageSocket");y.subscribeServer("com.ds.compass",window.parent);y.dispatchEvent("onSetX3DContent",x,"compassPageSocket");y.addListener("launchApp",function(F){console.log("Response = "+JSON.stringify(F));this.response=F.response});var D={appId:"ENOCOMP_AP"};y.dispatchEvent("onLaunchApp",D,"compassPageSocket")}}},_buildSkeleton:function(){var A=this;var B=this.elements.container=j.createElement("div");B.className="revision-main";B.setAttribute("data-rec-id",B.className);this.revisionTab=document.createElement("div");this.revisionTab.className="revision-table";this.revisionTab.setAttribute("data-rec-id",this.revisionTab.className);var x=document.createElement("div");x.className="revision-NLVView";x.setAttribute("data-rec-id",x.className);this.revisionTab.NLVView=x;this.revisionTab.appendChild(x);B.appendChild(this.revisionTab);this.revisionTab.NLVView.style.display="block";var y=j.createElement("div",{"class":"revisionFamilyNLVViewContainer"});y.setAttribute("data-rec-id","revisionFamilyNLVViewContainer");y.inject(x);var z=q.SELECTION_MODES.SINGLE_SELECT_ONLY;if(A.options.clientOptions!==undefined&&A.options.clientOptions.Multiselect==="true"){z=q.SELECTION_MODES.MULTI_SELECT_ONLY}if(!(A.options.clientOptions!==undefined&&A.options.clientOptions.NoContextMenu==="true")){z=z|q.SELECTION_MODES.WITH_COMMANDS}A.versionExplorer=new r({versionGraphContainer:y,selectionMode:z,customOnDrop:function(C){A.dispatchEvent("DropEvent",C)},widget:A.options.wintop===true?undefined:A.widget,autoUpdate:false});A.versionExplorer.subscribeEvent("select",function(C){A.onSelectForVersionExplorer(C.data.nodeModel)},false);A.versionExplorer.subscribeEvent("unselect",function(C){A.onUnSelectForVersionExplorer(C.data.nodeModel)},false);A.versionExplorer.subscribeEvent("ENOXVersionExplorerDropdownMenu",function(C){var D=C.data||C;A.onPickContextForVersionExplorer(D.treeNode,D.selectedNodes,D.position)},true)},onResize:function(x){},_updateHistoryTree:function(){var x=this;this.revisionTab.style.display="none";this.revisionTab.style.display="block";this.dispatchEvent("ModelUpdated",this.currentObject);b.getSecurityContext(v.getTenant(),function(z){var y={displayMode:q.DISPLAY_MODES.THUMBNAIL_VIEW,displayLegend:false};if(t.historyConfig&&t.historyConfig.settings){if(t.historyConfig.settings.defaultView){y.displayMode=q.DISPLAY_MODES[t.historyConfig.settings.defaultView]}if(t.historyConfig.settings.thumbnailGraph){if(t.historyConfig.settings.thumbnailGraph.thumbnailGraphLayout){y.thumbnailGraphLayout=t.historyConfig.settings.thumbnailGraph.thumbnailGraphLayout}if(t.historyConfig.settings.thumbnailGraph.displayThumbnailOverview){y.displayThumbnailOverview=t.historyConfig.settings.thumbnailGraph.displayThumbnailOverview==="true"}}if(t.historyConfig.settings.subwayGraph){if(t.historyConfig.settings.subwayGraph.subwaySort){y.subwaySortAscending=t.historyConfig.settings.subwayGraph.subwaySort==="asc"}if(t.historyConfig.settings.subwayGraph.viewMode==="SUBWAY_COMPACT_VIEW"||t.historyConfig.settings.subwayGraph.viewMode==="SUBWAY_COMFORTABLE_VIEW"){y.subwayViewMode=t.historyConfig.settings.subwayGraph.viewMode}}if(t.historyConfig&&t.historyConfig.settings&&t.historyConfig.settings.common){if(t.historyConfig.settings.common.highlightParentConnectionsOnSelect){y.highlightParentConnectionsOnSelect=(t.historyConfig.settings.common.highlightParentConnectionsOnSelect==="true")}}}t.loadUserSettingsPromise(y).then(function(){x.versionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:x.currentObject.id,tenantId:x.tenant,securityContext:z,type:x.currentObject.type,context:x.context,onComplete:function(){var A=false;if(x.options.clientOptions!==undefined){if(x.options.clientOptions.SelectAnyRevison==="false"){var D=x.versionExplorer.applyFilter(function(F){var E=true;if(x.options.clientOptions.ActiveObjectSelectable==="false"){E=x.currentObject.id!==F._options.id}if(E===true){E=F._options.grid.__isLeaf__===true}return E});if(D.length===1){x.versionExplorer.unselectAll();D[0].select();if(x.options.clientOptions!==undefined&&x.options.clientOptions.AutoFire==="true"){A=true}}}else{if(x.options.clientOptions.ActiveObjectSelectable==="false"){var D=x.versionExplorer.applyFilter(function(E){return x.currentObject.id!==E._options.id});if(D.length===1){x.versionExplorer.unselectAll();D[0].select();if(x.options.clientOptions!==undefined&&x.options.clientOptions.AutoFire==="true"){A=true}}}else{x.versionExplorer.select(x.currentObject.id)}}}var C=x.versionExplorer.getSelectedNodes();var B={selectedNodes:C,autoFire:A};x.versionExplorer.reframeAll();x.dispatchEvent("onVersionExplorerLoaded",B)},dataModelType:(x.options.clientOptions!==undefined&&x.options.clientOptions.modelRevisions==="true")?q.DATA_MODEL_TYPES.MODEL_REVISION:q.DATA_MODEL_TYPES.MODEL_HISTORY})},function(A){console.log(A)})},function(y){console.log(y)});x.onResize()},displayError:function(x){var y=this;document.body.style.cursor="default";y.showError(x)},showError:function(y){if(this.context!==undefined&&this.context!==null){if(this.hasOwnProperty("context")&&typeof this.context.displayNotification==="function"){var x={eventID:"warning",msg:y};this.context.displayNotification(x)}}},setObjects:function(z){if(z.length===0){this.displayError(d.noObject)}else{if(z.length===1){var A={};A.data=z;var y=z[0];if(y.hasOwnProperty("physicalid")&&y.physicalid===""){this.displayError(d.epmtyPhysicalId)}else{this.tenant=y.tenant;if(y.hasOwnProperty("displayName")&&y.displayName&&y.displayName.trim().length>0){var x=y.type;this.currentObject={id:y.physicalid,displayName:y.displayName,revision:y.revision,type:x}}else{var x=y.type;this.currentObject={id:y.physicalid,type:x}}this._updateHistoryTree();this.dispatchEvent("onDataUpdated",this.currentObject)}}else{this.displayError(d.multipleSelection)}}},onSetCtxMenuForItem:function(x){var y=this;y.ContextualMenuData=o.parseContextualMenu(x);if(y.contextMenuObject!=null){if(!this.options.wintop){v.isOpenWithCATIAV5Available(function(z){y.doPickContext(y.contextMenuObject,z)})}else{y.doPickContext(y.contextMenuObject)}}},onSelectForVersionExplorer:function(D){var C=this;var z=C.versionExplorer.getSelectedNodes();var y=D._options.id;var x=D._options.label;var B=D._options.grid.code;if(this.options.clientOptions!==undefined&&this.options.clientOptions.ActiveObjectSelectable==="false"){if(this.currentObject.id===y){if(z.length===1){C.versionExplorer.unselectAll()}return}}var A={data:{physicalid:y,displayName:x,revision:B,tenant:C.tenant,selectedNodes:z}};C.dispatchEvent("onSelectedObject",A)},onUnSelectForVersionExplorer:function(D){var C=this;var z=C.versionExplorer.getSelectedNodes();var y=D._options.id;var x=D._options.label;var B=D._options.grid.code;var A={data:{physicalid:y,displayName:x,revision:B,tenant:C.tenant,selectedNodes:z}};C.dispatchEvent("onUnSelectedObject",A)},onPickContextForVersionExplorer:function(z,B,A){var x=this;if(!(x.options.disableContextMenu===true)){x.contextMenuObject=j.merge({pos:[A.x,A.y],selectedNodes:B},z.options.data);var y=[];y.push(z.options.data);if(x.options.wintop===true){o.fetchContextFromSelection(x.WebToWinComSocket,y)}else{v.isOpenWithCATIAV5Available(function(C){x.doPickContext(y[0],C)})}}},_showOpenInCATIAMenu:function(x){try{if(x.options.wintop){return false}if(b.isInPSEditorWidget(x.context.widget)){return false}if(b.isInXCADEditorWidget(x.context.widget)){return true}if(b.isDECType(x.contextMenuObject.type)){return true}return false}catch(y){return true}},doPickContext:function(ad,y){var C=this;var Z=this;if(C.context.hasOwnProperty("widget")){C._isWidget=true}else{C._isWidget=false}var L=[];function D(ag,ah){var aj=i.getWebappsBaseUrl();var ai=ah||"RevisionFamily";return"url("+aj+ai+"/assets/icons/32/"+ag+")"}var S;var Y=i.getWebappsBaseUrl()+"RevisionFamily/assets/icons/32/";var G=false;var ac=Z.versionExplorer.getSelectedNodes();for(var T=0;T<ac.length;T++){var N=ac[T];if(N._options.id===ad.physicalid){G=true;break}}for(var T=0;T<Z.contextMenuObject.selectedNodes.length;T++){var N=Z.contextMenuObject.selectedNodes[T];if(N._options.id===ad.physicalid){G=true;break}}if(Z.contextMenuObject){if(Z.options.wintop==true){var U=Z.ContextualMenuData[0];var af=C.contextMenuObject.displayName;var V={id:C.contextMenuObject.physicalid,displayName:af};o.onBuildWinContextMenu(Z.WebToWinComSocket,U,L,V)}else{var A=true;var K=c.getCommand("HistoryHdr",widget);if(K&&K.isEditMode===false){A=false}v.hasPARRole(function(aj){for(var ah=0,ag=n.commands.length;ah<ag;ah++){var ai=n.commands[ah];if((ai==="ReviseFromHdr"&&!aj)||(C._isWidget&&ai==="MaturityHdr")){continue}if((ai==="Properties"||ai==="DeleteHdr"||ai==="ReviseFromHdr"||ai==="MaturityHdr"||ai==="RevisionHdr"||ai==="NewBranchHdr"||ai==="DuplicateHdr")&&A===false){continue}if(n.checkAvailability(ai,[C.contextMenuObject],Z,C.options.context)){L.push({label:n.getTitle(ai),icon:n.getIcon(ai),callback:n.getCallbackFunction(ai,[C.contextMenuObject],Z,C.options.context)})}}});L.push({label:d.whereUsed,icon:D("ENORIPE32.png","FolderEditor"),callback:function ae(){var ah=require("DS/PADUtils/PADCommandProxy");var ag=ah.create();require(["DS/PADUtils/PADUtilsServices"],function(am){var aj=[];aj.push({envId:"",serviceId:"",contextId:"",objectId:C.contextMenuObject.physicalid,objectType:C.contextMenuObject.type,displayName:C.contextMenuObject.displayName});var ai={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:aj}};var al={attributes:{},paths:[],version:"1.1"};var ak=new m.Socket("compassPageSocket");ak.subscribeServer("com.ds.compass",window.parent);ak.dispatchEvent("onSetX3DContent",ai,"compassPageSocket");ak.addListener("launchApp",function(an){ag.select(al);ag.destroy();console.log("Response = "+JSON.stringify(an))});ak.dispatchEvent("onLaunchApp",{appId:"ENORIPE_AP"},"compassPageSocket")})}});if(this._showOpenInCATIAMenu(Z)){L.push({label:d.openCATIA,icon:D("ENOV5MA_AP_AppIcon.png","FolderEditor"),callback:function ab(){w.mask(C._getParentContainer(),d.openCATIALaunchMessage);require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],function(aj,al){var ah={version:"1",structures:{references:[],connections:[],trees:{}}};ah.structures.references.push({localid:"0",physicalid:Z.contextMenuObject.physicalid,type:"CATProduct"});ah.structures.trees["0"]={selected:true};var ai={data:ah,onComplete:function(am){var ao=j.is(am,"string")?JSON.parse(am):am;aj.setStructure_4_open_in_cv5({completeselection:ao});var an=new m.Socket("compassPageSocket");an.subscribeServer("com.ds.compass",window.parent);an.addListener("launchApp",function(ap){console.log("Response = "+JSON.stringify(ap));w.unmask(C._getParentContainer())});an.dispatchEvent("onLaunchApp",{appId:"ENOV5MA_AP"},"compassPageSocket")},onFailure:function(am){console.error("PADWSAccess.completeselection",am);w.unmask(C._getParentContainer())},timeout:0};if(C._isWidget){console.log("isWidget true, initialize PADSettingsMgt and PADUtilsServices");var ag=require("DS/PADUtils/PADSettingsMgt");ag.set_app_context("enopad");aj.app_initialization(function ak(){al.completeselection(ai)})}else{al.completeselection(ai)}})}})}if(C._displayOpenWithCATIAV5(Z,y)){var F=function(ag){b.getSecurityContext(v.getTenant(),function(ai){w.mask(C._getParentContainer(),d.openCATIALaunchMessage);var ah={objectId:Z.contextMenuObject.physicalid,envId:v.getTenant(),contextId:ai};require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(ak){var al={};al.version="2.1";al.results=[{id:"0",phid:Z.contextMenuObject.physicalid}];al.structures=[{structure:[{id:"0",show:true,select:true,children:[]}]}];al.viewpoint=[];var aj=ak.get();if(aj){al.workUnder=aj}var am=JSON.stringify(al);require(["DS/i3DXCompassServices/i3DXCompassPubSub"],function(an){var ao=new m.Socket("compassPageSocket");ao.subscribeServer("com.ds.compass",window.parent);ao.addListener("launchApp",function(aq){console.log("Response = "+JSON.stringify(aq));w.unmask(C._getParentContainer())});if(al.workUnder!==undefined&&al.workUnder.AuthoringContextHeader){var ap={appId:"MAP-CATCDVEAP",fileContent:am,fileName:"-file",widgetId:Z.id,envId:v.getTenant(),contextId:ai};an.publish("resetObject");ao.dispatchEvent("onLaunchApp",ap,"compassPageSocket")}else{an.publish("setObject",ah);ao.dispatchEvent("onLaunchApp",{appId:"MAP-CATCDVEAP"},"compassPageSocket")}})})},function(ah){console.error("_displayOpenWithCATIAV5",ah);w.unmask(C._getParentContainer())})};var B={title:d.OpenWith,label:d.openCATIA,icon:D("ENOV5MA_AP_AppIcon.png","FolderEditor"),type:u,callback:F,submenu:[{type:u,title:d.OpenWithCV5,icon:"url("+i.getWebappsAssetUrl("ENXNav","icons/ENOV5MA_AP_AppIcon.png")+")",action:{"this":Z,callback:F}}]};if(e){B.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-export",family:WUXManagedFontIcons.Font3DS,};B.icon=undefined}L.push(B)}}var Q=true;if(ac.length==0){Q=false}if(!G&&Q){S="url("+Y+"I_Compare.png)";var P=function W(){var ag;if(ac.length>0){var ah=ac[0];Z.showCompare({id:ah._options.id},{id:C.contextMenuObject.physicalid})}};var x={callback:P,"this":Z};L.push({title:d.compare,label:d.compare,type:u,icon:S,action:x,callback:P})}if(Z.options.wintop!=true){var O=function(ag){if(ag===undefined){return false}if(ag.indexOf("Workspace")>=0||ag==="ENOCLG_LibraryReference"||ag.indexOf("Folder")>=0){return true}return false};var J;if(O(C.contextMenuObject.type)){J=["select","properties","|","delete_","|","whereUsed"]}else{J=["select","properties","compare","|","maturity","newRevision","newRevisionFrom","newBranch","delete_","duplicate","|","whereUsed","openCATIA"]}L=J.map(function(ag){if(ag==="|"){return{type:(e?"SeparatorItem":"separator")}}return L.find(function(ah){return d[ag]===ah.label})}).filter(function(ag){return ag});var M=false;var E=[];var z=L.length;for(var I=0;I<z;I++){if((L[I].type==="SeparatorItem")||(L[I].type==="separator")){if(E.length===0||M===true){continue}E.push(L[I]);M=true}else{E.push(L[I]);M=false}}L=E;if(e){L=L.map(function(ag){return typeof ag.type==="string"?ag:j.extend(ag,{title:ag.label,type:u,action:{"this":Z,callback:ag.callback}})})}}}var V;if(Z.options.wintop==true){var H=(window.location.search.indexOf("touch")>=0);var X=(window.location.search.indexOf("replace")>=0);var R={target:V,nodes:L};var aa={input:H?"touch":"mouse",position:{x:Z.contextMenuObject.pos[0],y:Z.contextMenuObject.pos[1]},submenu:(L.length==1)?"outside":(X?"replace":"auto")};l.show(L,aa)}else{var R={target:V,nodes:L};var aa={input:H?"touch":"mouse",position:{x:Z.contextMenuObject.pos[0],y:Z.contextMenuObject.pos[1]},submenu:(L.length==1)?"outside":(X?"replace":"auto")};if(e){l.show(L,aa)}else{f.show(R,Z.contextMenuObject.pos)}}},_displayOpenWithCATIAV5:function(x,z){try{if(x.options.wintop){return false}if(b.isInPSEditorWidget(x.context.widget)){return false}if(b.isInXCADEditorWidget(x.context.widget)){return false}if(b.isDECType(x.contextMenuObject.type)){return false}return true}catch(y){return false}},cleanup:function(){this.versionExplorer.cleanup()}});return k});