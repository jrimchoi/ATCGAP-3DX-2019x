define("DS/VCXWebGUIInfra/VCXArcBar",["UWA/Controls/Abstract","DS/Core/PointerEvents","DS/CoreEvents/Events","DS/WebappsUtils/WebappsUtils",],function(e,b,a,d){var c=e.extend({defaultOptions:{body:null,actionBar:null,frmWindow:null,heightElem:32,widthElem:32,padding:4,title:"",updateOpacity:true,typeSeparator:"bubble",lJsonElement:[],classpanel:"",Idpanel:"",heightOffset:0,startAngle:0,clockwise:true,curve:true,center:null,radius:500,experienceBase:null,},init:function(f){this._parent(f);this._state=c.State.Visible;this._tokenWindowResized=null;this._listbutton=[];this._panel=null;this._panelInfos={};this.loadCssFile("VCXWebGUIInfra/VCXArcBar.css",1);if(this._testUniciyIdFromJson()){this._createFilter();this.updateLayout();this.updateCommandState()}else{alert("Error: ID not unique")}if(!f.center&&f.experienceBase){var g=this;this._usableAreaUpdateEvent=a.subscribe({event:"VCX_GUI_USABLEAREA_UPDATE",},function(h){g._updateSize();g._updatePosition()})}},clear:function(){if(this._usableAreaUpdateEvent){a.unsubscribe(this._usableAreaUpdateEvent);delete this._usableAreaUpdateEvent}this._listbutton=[];if(this._panel){this._panel.destroy();this._panel=null}this.stopMouseMoveEvent();if(this._tokenWindowResized){a.unsubscribe(this._tokenWindowResized);this._tokenWindowResized=null}},loadCssFile:function(g,f){var j=document.getElementsByTagName("head")[0];var k=j.getElementsByTagName("link");var l=null;for(var h=0;h<k.length;h++){l=k[h];if(l.href.search(g)>-1){l.disabled=false;return}}l=document.createElement("link");l.type="text/css";l.rel="stylesheet";if(f===undefined){l.href=g}else{l.href=d.getWebappsBaseUrl()+g}j.appendChild(l)},_findDuplicates:function(g){var f=g.length,h=[],k={};for(var j=0;j<f;j++){var l=g[j];k[l]=k[l]>=1?k[l]+1:1}for(var l in k){if(k[l]>1){h.push(l)}}return h},_testUniciyIdFromJson:function(){var h=[];for(var g=0;g<this.options.lJsonElement.length;g++){if(this.options.lJsonElement[g].type!=="separator"){h.push(this.options.lJsonElement[g].id)}}var f=this._findDuplicates(h);return(!f||f.length===0)},_setStyleChecked:function(g,f){if(f){g.addClassName("vcx-ui-state-checked")}else{g.removeClassName("vcx-ui-state-checked")}},_setStyleEnabled:function(g,f){if(!f){g.addClassName("vcx-ui-state-disabled");g.icon.addClassName("vcx-ui-state-disabled")}else{g.removeClassName("vcx-ui-state-disabled");g.icon.removeClassName("vcx-ui-state-disabled")}},_inputDiv:function(g,f){var h=UWA.createElement("div",{html:"",id:g,"class":g}).inject(f);h.style.display="block";return h},_createButton:function(j,f,g,i){var h=UWA.createElement("div",{"class":"vcx-filter-Button",id:j.id,title:j.nls,styles:{display:"inline-block",position:"absolute",background:"rgba(255,255,255,1)",opacity:"1",top:g+"px",left:i+"px",borderRadius:"50%",width:this.options.widthElem+"px",height:this.options.heightElem+"px",cursor:"pointer"}}).inject(f);var l=this._createButtonIcon(j.url).inject(h);h.icon=l;if(j.userdata===undefined){j.userdata=j.id}var k={button:h,userdata:j.userdata,callback:j.callback,callbackUpdate:j.callbackUpdate};this._listbutton.push(k);var m=this;h.addEvent(b.POINTERUP,function(n){if(k.callback){var o={enable:true,check:undefined};if(k.callbackUpdate){k.callbackUpdate.call(h,o,k.userdata)}if(o.enable){k.callback.call(h,k.userdata)}}m.updateCommandState()});return h},_createButtonIcon:function(g){var f=UWA.createElement("img",{});f.src=g;f.setStyles({position:"absolute",display:"block",width:"100%",height:"100%",padding:this.options.padding+"px",});return f},_createPanel:function(){var f=UWA.createElement("div",{id:"vcx-filter-panel "+this.options.Idpanel,"class":"vcx-filter-panel "+this.options.classpanel,styles:{position:"absolute",width:"auto",transition:"opacity 0.3s ease-in-out"}});f.addEvent("dragstart",function(g){g.preventDefault()});return f},_createSeparator:function(g,h,l,k,f){var j;if(h==="bubble"){j=UWA.createElement("div",{"class":"vcx-filter-Separator",styles:{position:"absolute",display:"inline-block",width:2*f+"px",height:2*f+"px",opacity:"0.45",borderRadius:"50%",background:"black",}}).inject(g)}else{j=UWA.createElement("div",{"class":"vcx-filter-Separator",styles:{position:"absolute",opacity:"1",width:2*f+"px",height:this.options.heightElem+"px",background:"-webkit-radial-gradient(50% 50%, circle, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.3) 40%, rgba(0, 0, 0, 0) 80%)"}}).inject(g)}j.style.top=l+"px";j.style.left=k+"px";var i={button:j,userdata:null,callback:null,callbackUpdate:null};this._listbutton.push(i);return j},_updateSize:function(){var j,f;for(var h=0;h<this._listbutton.length;h++){var k=this._listbutton[h];var g=k.button;var l=g.getBoundingClientRect();this._panelInfos.top=(this._panelInfos.top===undefined)?l.top:Math.min(this._panelInfos.top,l.top);this._panelInfos.left=(this._panelInfos.left===undefined)?l.left:Math.min(this._panelInfos.left,l.left);j=(j===undefined)?l.right:Math.max(j,l.right);f=(f===undefined)?l.bottom:Math.max(f,l.bottom)}this._panelInfos.width=j-this._panelInfos.left;this._panelInfos.height=f-this._panelInfos.top;this._panel.style.width=this._panelInfos.width+"px";this._panel.style.height=this._panelInfos.height+"px"},_calcBottomPosition:function(){if(this.options.body!==null){if(this.options.experienceBase){var j=this.options.experienceBase.getManager("VCXGUIManager");var f=j&&j.getUsableArea();var g=f&&f.getBoundingClientRect();this._panelInfos.left=g.left+(g.width-this._panelInfos.width)/2}else{this._panelInfos.left=(parseInt(this.options.body.offsetWidth)-this._panelInfos.width)/2}this._panelInfos.left+=this.options.widthElem/2;var i=parseInt(this.options.frmWindow.getContent().offsetHeight);if(this.options.actionBar&&this.options.actionBar.elements&&this.options.actionBar.elements.container){var h=parseInt(this.options.actionBar.elements.container.offsetHeight);this._panelInfos.top=i-2*h}else{this._panelInfos.top=i-145}}},_calcCenterPosition:function(){var g;if(this.options.startAngle){g=Math.PI*this.options.startAngle/180}else{g=Math.PI/2}var f=Math.cos(g)*this.options.radius;var h=Math.sin(g)*this.options.radius;this._panelInfos.left=this.options.center.x+f;this._panelInfos.top=this.options.center.y-h},_updatePosition:function(){if(this.options.center){this._calcCenterPosition()}else{this._calcBottomPosition()}this._panelInfos.top-=this.options.heightElem/2;this._panelInfos.left-=this.options.widthElem/2;this._panelInfos.top-=this.options.heightOffset;this._panel.style.top=this._panelInfos.top+"px";this._panel.style.left=this._panelInfos.left+"px"},_getElementRadius:function(g){var f=0;if(g.type==="separator"){if(this.options.typeSeparator==="bubble"){f=1.5}else{f=3}}else{f=this.options.widthElem/2}return f},_calcDemiAngle:function(h){var g=this.options.radius;var f=Math.asin(h/g);return f},_calcElementDemiAngle:function(f){var g=this._getElementRadius(f);return this._calcDemiAngle(g)},_calcStartAngle:function(k){if(this.options.startAngle){var h=Math.PI*this.options.startAngle/180;return h}var j=0;var l=this.options.lJsonElement.length;for(var g=0;g<l;g++){var f=this._calcElementDemiAngle(this.options.lJsonElement[g]);j+=2*f;if(g!=l-1){j+=k}}var h=Math.PI*1.5-j/2;return h},_createFilter:function(){this._panel=this._createPanel();var l=0;var k=0;var n=this.options.lJsonElement.length;for(var h=0;h<n;h++){var g=this.options.lJsonElement[h];if(g.type==="separator"){var j=this._getElementRadius(g);this._createSeparator(this._panel,this.options.typeSeparator,l,k,j)}else{var f=this._createButton(g,this._panel,l,k);if(f){f.setAttribute("data-rec-id",this.options.Idpanel+"_"+g.id)}}}this.startMouseMoveEvent();if(this.options.body!==null){this._panel.inject(this.options.body);var m=this;this._tokenWindowResized=a.subscribe({event:"/VISU/onWindowResized"},function(i){if(i.eventType==="@onWindowResized"){if(m.options.updateOpacity){m._updatePosition()}}})}},updateLayout:function(H,k){if(!this._panel){return}if(H){this.options.center=H}if(k){this.options.radius=k}var z=this.options.lJsonElement.length;if((!this.options.center&&(z<=3))||!this.options.curve){var m=1000000;this.options.radius=m}var t=this._calcDemiAngle(10);var G=0;var E=0;var F=this._calcStartAngle(t);var l=this.options.radius;var D=1;if(!this.options.clockwise){D=-1}var G=0;var E=0;for(var B=0;B<z;B++){var g=this.options.lJsonElement[B];var w=this._calcElementDemiAngle(g);if(!this.options.startAngle||B>0){F+=w*D}var s=Math.cos(F)*l;var q=Math.sin(F)*l;if(B===0){G=s;E=-q}var p=s-G;var o=-q-E;var v=this._getElementRadius(g);var C;if(g.type==="separator"&&this.options.typeSeparator==="bubble"){C=v}else{C=this.options.heightElem/2}var u=o-C;var j=p-v;var n=this._listbutton[B];var f=n.button;if(g.type==="separator"){var h=f;if(this.options.typeSeparator!=="bubble"){var A=90-F*180/Math.PI;h.style.transform="rotate("+A+"deg) rotateY(85deg)"}}u+=this.options.heightElem/2;j+=this.options.widthElem/2;f.style.top=u+"px";f.style.left=j+"px",F+=(w+t)*D}this._updateSize();this._updatePosition()},updateCommandState:function(){for(var h=0;h<this._listbutton.length;h++){var j=this._listbutton[h];var g=j.button;var f=j.callbackUpdate;if(!f){continue}var k={enable:true,check:undefined};f.call(g,k,j.userdata);if(k.enable!==undefined){this._setStyleEnabled(g,k.enable)}if(k.check!==undefined){this._setStyleChecked(g,k.check)}}},startMouseMoveEvent:function(){var f=Math.pow(0.1,2);var g=1;var h=this;this._callbackMouseMove=function(m){h._mouseX=m.clientX;h._mouseY=m.clientY;if(h.options.updateOpacity){var l=1*h._panelInfos.height;var o=2*h._panelInfos.height;var n=m.clientY;var j=Math.abs(h._panelInfos.top-n);var k=(j*(g-f)-o+f*l)/(l-o);k=Math.max(k,f);k=Math.min(k,g);k=Math.sqrt(k);h._panel.style.opacity=k}else{var i=h.isInCircle();h.setMouseOn(i);h.updateVisibilityStyle()}};this.options.frmWindow.getContent().addEvent(b.POINTERMOVE,this._callbackMouseMove)},stopMouseMoveEvent:function(){if(this._callbackMouseMove){this.options.frmWindow.getContent().removeEvent(b.POINTERMOVE,this._callbackMouseMove)}},isStyleVisible:function(){if(this._panel){return this._panel.style.display!=="none"&&this._panel.style.opacity!==0}return false},setState:function(g,f){if(g){this._state|=f}else{this._state&=~f}},setVisible:function(f){this.setState(f,c.State.Visible)},isVisible:function(){return this._state&c.State.Visible},setSelected:function(f){this.setState(f,c.State.Selected)},isSelected:function(){return this._state&c.State.Selected},setMouseOn:function(f){this.setState(f,c.State.MouseOn)},isMouseOn:function(){return this._state&c.State.MouseOn},setInManipulation:function(f){this.setState(f,c.State.InManipulation)},isInManipulation:function(){return this._state&c.State.InManipulation},_show:function(f){this._panel.style.opacity=f?1:0},updateVisibilityStyle:function(){if(!this._panel){return}if(this.isVisible()&&!this.isInManipulation()){this._panel.style.display="block"}else{this._panel.style.display="none"}if(this.isSelected()){this._show(true)}else{this._show(this.isMouseOn())}},isInCircle:function(){var g=this.options.center;var h=this.options.radius;var j=this.options.widthElem;var f=this._mouseX-g.x;var k=this._mouseY-g.y;var i=Math.sqrt(f*f+k*k);if(i<=(h+j)){return true}return false},});c.State={Visible:1<<0,Selected:1<<1,MouseOn:1<<2,InManipulation:1<<3,};c.Separator={type:"separator"};return c});