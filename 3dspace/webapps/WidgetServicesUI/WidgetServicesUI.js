define("DS/WidgetServicesUI/infra/TweakerBase",["UWA/Controls/Abstract","DS/UIKIT/Tooltip","DS/UIKIT/Spinner","css!DS/WidgetServicesUI/WidgetServicesUI","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(f,c,b,a,d){var e=f.extend({type:null,value:null,multiple:null,underEdition:null,_tooltip:null,defaultOptions:{postBuild:true},init:function(g){this._parent(g);this.value=null;this.underEdition=null;this._tooltip=null;this.data={};this.UIelements={};this.UIelements.lTooltip=[];this.type=this.type?this.type:g.tw_type;this._setValue(g.value);this.elements.container=UWA.createElement("div",{"class":"tw_container "+this._getClassName(g)});this.elements.elementsContainer=UWA.createElement("div",{"class":"tw_elementsContainer"}).inject(this.elements.container);this._postInit();this.__switchMode(g.editable===true)},showSpinner:function(){if(!this.elements.spinner){this.elements.spinner=new b();this.elements.spinner.inject(this.elements.container)}this.elements.elementsContainer.hide();this.elements.spinner.show()},hideSpinner:function(){if(this.elements.spinner){this.elements.spinner.hide()}this.elements.elementsContainer.show()},setValue:function(g,h){var i=this._getValueOrDefault(g);if(!this.areEquals(i,this.getValue())){this._setValue(i);if(this.getElement()){this._changeRW(i,h)}}if(this.getROElement()){this._changeRO(i)}},setTooltip:function(g){this._tooltip=g;this._updateTooltip()},getROElement:function(){return this.elements.elementROUI},getContainerElement:function(){var g=this.getElement();if(g.tw_parent){g=g.tw_parent}return g},getElement:function(){return this.elements.elementUI},getHTMLElement:function(){var g=this.getElement();g=g?g:this.getROElement();if(g&&g.elements){g=g.elements.container}return g},switchMode:function(g){this.__switchMode(g)},getValue:function(){return this.data.value},getDisplayValues:function(m,g){var i=this;var k=[];var l=false;var j=m!==undefined?m:this.data.value;if(j!==undefined){l=Array.isArray(j);var h=l?j:[j];h.forEach(function(n){k.push(i._computeValueForRO(n,g))})}if(!l){k=k.length>0?k[0]:""}return k},getType:function(){return this.type},getDisplayValue:function(h,g){return this.__computeValueForRO(h!==undefined?h:this.data.value,g)},areEquals:function(h,g){return h===g},checkValue:function(g){return null},destroy:function(){this.UIelements.lTooltip.forEach(function(g){g.destroy()});this.UIelements.lTooltip=[];this._parent()},_dispatchChange:function(g,h){this.setValue(g,h);this.__dispatchEvent("change",g);this.__dispatchAChange(g);if(h===true){this._dispatchValidation(g)}},_dispatchLiveChange:function(g,h){this._setValue(g);this.__dispatchEvent("liveChange",g);this.__dispatchAChange(g);if(h&&h.keyCode===13){this._dispatchValidation(g)}},_dispatchValidation:function(g){this._setValue(g);this.__dispatchEvent("valid",g)},_dispatchNotification:function(g,h){this._dispatchNotificationObj({eventID:g,message:h})},_dispatchNotificationObj:function(g){this.dispatchEvent("notification",g)},_getMinValue:function(){var h=this.options.stepValue;h=h?h:0;var g=null;if(this.options.minValue){g=this.options.minValue;if(this.options.minValueIncluded===false){g+=h}}return g},_getMaxValue:function(){var m=null;if(this.options.maxValue){var i=this.options.stepValue;i=i?i:0;m=this.options.maxValue;if(i){var k=this.__getNumberOfDecimal(i);var h=Math.pow(10,k);var g=this._getMinValue();var j=m-g;var l=parseInt(j*h)%parseInt(i*h);m=(parseInt(m*h)-l)/h}if(this.options.maxValueIncluded===false){m-=i}}return m},_setError:function(g){console.log("error: "+g.message)},_postInit:function(){},_getValueOrDefault:function(g){return g===null||g===undefined?"":g},_changeRO:function(h){var i=this.elements.elementROUI.getElement(".tw_ROValue_content");if(i){var g=this.__computeValueForRO(h);i.setHTML(g)}},_setElement:function(g){this.elements.elementUI=g},_setElementRO:function(g){this.elements.elementROUI=g},_computeValueForRO:function(h,g){if(typeof h==="string"){if(!g||g.escapeChar!==false){h=h.escapeHTML()}}return h},_buildRO:function(h,l){var i=this;var j=h.value;var k=this.__computeValueForRO(j,h);var g=this._createROContainer(k);l.call(this,g)},_createROContainer:function(k){var i=new UWA.createElement("div",{"class":"tw_ROValue"});var g={"class":"tw_ROValue_content"};var j=typeof k.inject==="function";if(!j){g.html=k}var h=new UWA.createElement("span",g);if(j){k.inject(h)}if(this.options.icon){UWA.createElement("img",{"class":"editProp_iconAttribute",src:this.options.icon}).inject(i)}h.inject(i);return i},_changeRW:function(g,h){},_build:function(g,h){this.__switchMode(false);h.call(this,null)},_setValue:function(g){var h=this;var g=this._getValueOrDefault(g);this.data.value=g;this._updateTooltip()},_updateTooltip:function(){var g=this;g.UIelements.lTooltip.forEach(function(i){var h=g.__getTooltip();g._setValueForTooltip(i,h)})},_setValueForTooltip:function(i,h){var g=i.getContent();if(h.textContent===""){g.addClassName("tw_hideTooltip")}else{g.removeClassName("tw_hideTooltip")}i.setBody(this.__getTooltip())},__computeValueForRO:function(k,h){var j=this;if(k===undefined){k=this.data.value}var i=Array.isArray(k)?k:k!==undefined&&k!==null&&k!==""?[k]:[];var m=this.options.units;m=m?m:"";var l="";var g="";i.forEach(function(n){n=j._computeValueForRO(n,h);l+=g+j._addDimensionToValue(n,m);g=", "});if(this.options.readOnly&&l===""&&this.options.parameter===true){l="";if(this.options.minValue!=null){l+=this.options.minValue+m;l+=this.options.minValueIncluded?" \u2264 ":" \u003C "}l+="\u2026";if(this.options.maxValue!=null){l+=this.options.maxValueIncluded?" \u2264 ":" \u003C ";l+=this.options.maxValue+m}}return l},__getTooltip:function(g){var n=false;var l=this.options.units;l=l?l:"";var j=new UWA.createElement("span");if(!g){var m=this._tooltip?this._tooltip:this.__computeValueForRO();var p=new UWA.createElement("span",{html:m});p.inject(j)}var h=this._getMinValue();if(h){var o=new UWA.createElement("br");o.inject(j);var k=new UWA.createElement("span",{text:d.get("minval")+" : "+h+l});k.inject(j);n=true}var i=this._getMaxValue();if(i){var o=new UWA.createElement("br");o.inject(j);var k=new UWA.createElement("span",{text:d.get("maxval")+" : "+i+l});k.inject(j);n=true}return n||!g?j:null},postBuildUI:function(){if(this.elements.elementUI){this._postBuildUI(this.elements.elementUI)}if(this.elements.elementROUI){this._postBuildUI(this.elements.elementROUI)}this.options.postBuild=true},_postBuildUI:function(g){if(this.options.nested!==true){var j=this.__getTooltip();if(j){var i=g;while(typeof i.getContent==="function"){i=i.getContent()}var h=new c({position:"top left",delay:{show:400},target:i,body:""});this._setValueForTooltip(h,j);this.UIelements.lTooltip.push(h)}}},__getNumberOfDecimal:function(h){var j=h+"";var i=0;var g=j.indexOf(".");if(g<0){g=j.indexOf(",")}if(g>=0){i=j.length-g-1}return i},__switchMode:function(i){var h=this;var g=i&&!h.options.readOnly;if(g!==this.underEdition){this.underEdition=g;this.elements.elementsContainer.empty();this.options.value=this.getValue();if(g===true){if(!this.getElement()){this._build(h.options,function(j){if(j&&h.elements.elementsContainer){if(!h.getElement()){if(h.options.postBuild===true){h._postBuildUI(j)}h._setElement(j)}if(h.underEdition){h.getContainerElement().inject(h.elements.elementsContainer)}}})}else{this.getContainerElement().inject(this.elements.elementsContainer)}}else{if(!this.getROElement()){this._buildRO(h.options,function(j){if(j&&h.elements.elementsContainer){if(!h.getROElement()){if(h.options.postBuild===true){h._postBuildUI(j)}h._setElementRO(j)}if(!h.underEdition){h.getROElement().inject(h.elements.elementsContainer)}}})}else{this.getROElement().inject(this.elements.elementsContainer)}}}},_addDimensionToValue:function(h,i){var g=h||h===false?h+"":"";if(i){if(typeof h.endsWith!=="function"||!h.endsWith(i)){g=g+=" "+i}}return g},__dispatchAChange:function(g){this.__dispatchEvent("changes",g)},__dispatchEvent:function(h,g){this.dispatchEvent(h,[g])},_getClassName:function(g){return g.className?g.className:""}});return e});define("DS/WidgetServicesUI/helpers/Constants",[],function(){var a={TYPES:{BOOLEAN:"boolean",STRING:"string",HTML:"html",DATE:"date",DATETIME:"datetime",PERSON:"person",NUMBER:"number",INTEGER:"integer",ENUM:"enum",DROPDOWN:"dropdown",OUTPUT:"ouputText",BUTTONWEB:"buttonweb",IMAGE:"image",MULTIPLE:"multiple",REPLACEMENT:"replacement",RELATION:"relation"},SPE_TYPES:{MVA:"mva",ENUM:"spe_enum",MULTISEL:"multisel"}};return a});define("DS/WidgetServicesUI/tweakers/TweakerMVA",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase"],function(a,b){var c=b.extend({tweakerInput:null,init:function(d){this.type=a.SPE_TYPES.MVA;this.tweakerInput=d.tweaker;this._parent(d);var e=this;this.tweakerInput.addEvent("notification",function(f){e._dispatchNotificationObj(f)})},setValue:function(d,g){var e=this._parent;var f=this;this.completeData(d,function(){e.apply(f,[d,g])})},_setValue:function(d){this._parent(d)},completeData:function(e,d){if(!!this.tweakerInput.completeData){this.tweakerInput.completeData(e,d)}else{d()}},_buildRO:function(d,g){var e=this;var f=this._parent;e.showSpinner();this.completeData(d.value,function(){f.apply(e,[d,g]);e.hideSpinner()})},_build:function(d,f){var e=this;e.showSpinner();this.completeData(d.value,function(){e.__build(d,f);e.hideSpinner()})},__build:function(d,f){var e=this;this.tweakerInput.__switchMode(true);require(["DS/WidgetServicesUI/infra/TweakerMVABase"],function(j){var i=false;var g=true;if(e.tweakerInput.getType()===a.TYPES.RELATION){i=true;g=false}var h=new j(e.tweakerInput,{value:d.value,uniqueValue:i,reorder:g,events:{onChange:function(){var l=this.getValue();var k=[];l.forEach(function(m){k.push(m.value)});e._dispatchChange(k)},onError:function(k){e._dispatchNotification("error",k.message)}}});f.call(this,h)})},areEquals:function(e,d){var g=e===d||(e&&d&&e.length===d.length);if(e&&g){var h=e.length;for(var f=0;f<h;f++){g=this.tweakerInput.areEquals(e[f],d[f]);if(!g){break}}}return g},_computeValueForRO:function(d){return this.tweakerInput.getDisplayValue(d)},_getValueOrDefault:function(d){return d},_changeRW:function(e){var d=this.getElement();d.setValue(e)}});return c});define("DS/WidgetServicesUI/tweakers/TweakerRelation",["DS/WidgetServicesUI/infra/TweakerBase","DS/UIKIT/Autocomplete","DS/WidgetServices/WidgetServices","DS/WAFData/WAFData","DS/DataDragAndDrop/DataDragAndDrop","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(j,g,k,f,d,b){var l=function(o,n,m){if(o.firstToggle===true){o.firstToggle=false;return}o._dispatchChange(n?m:null,n)};var i=function(o,m){var q=[];if(o&&o.results){var p={};if(m.predicates){m.predicates.forEach(function(r){p[r]=r})}p.resourceid="id";p["ds6w:label"]="label";var n=Object.keys(p).length;o.results.forEach(function(r){var u=true;var s={};var t=n;if(r.attributes){r.attributes.every(function(w){var v=p[w.name];if(v){t--;s[v]=w.value}return t!==0})}if(t===0){q.push({value:s,id:s.id,label:s.label})}})}m.onComplete(q)};var e=function(o,n){if(o.length==0){n.onComplete([]);return}var m="/cvservlet/fetch/v2";var p=k.getTenantID();n.handleRequest.handle=k.get3DSpaceUrlAsync({platformId:p,onComplete:function(t){var x="passport";var q=t+m+"?tenant="+p;var r=k.getLanguage();n.predicates=["ds6w:label"];var z="TweakerRelation";var v=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";var w=z+"-"+v+"-"+(new Date()).getTime();var y={locale:r,tenant:p,label:w,physicalid:o,select_predicate:n.predicates};var s={Accept:"application/json","content-type":"application/json","Accept-Language":k.getLanguage()};var u={type:"json",method:"POST",timeout:240000,data:UWA.Json.encode(y),proxy:x,headers:s,cache:-1,onComplete:function(A){i(A,n)},onFailure:function(){n.onFailure(b.dataFromIndexFailure);n.onComplete([])},onTimeout:function(){n.onFailure(b.timeout);n.onComplete([])}};if(!k.getWidgetValue("isStandalone")){u.authentication="passport"}n.handleRequest.handle=f.handleRequest(q,u)}})};var a=function(p,n){var m="/search";var o=k.getTenantID();n.handleRequest.handle=k.get3DSearchUrlAsync({platformId:o,onComplete:function(t){var x="passport";var q=t+m+"?tenant="+o;var r=k.getLanguage();n.predicates=["ds6w:label"];var z="PropertiesPanel";var v=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";var w=z+"-"+v+"-"+(new Date()).getTime();var y={with_indexing_date:false,with_synthesis:false,with_synthesis_attribute:false,with_nls:false,nresults:10,locale:r,query:p,tenant:o,start:0,sources:["3dspace"],label:w,select_predicate:n.predicates};var s={Accept:"application/json","content-type":"application/json","Accept-Language":k.getLanguage()};var u={type:"json",method:"POST",timeout:240000,data:UWA.Json.encode(y),proxy:x,headers:s,cache:-1,onComplete:function(A){i(A,n)},onFailure:function(){n.onFailure(b.searchFromIndexFailure)},onTimeout:function(){n.onFailure(b.timeout)}};if(!k.getWidgetValue("isStandalone")){u.authentication="passport"}n.handleRequest.handle=f.handleRequest(q,u)}})};var h=function(o){var m=this;var p=o;this.handler={handle:null};var n={dataParser:function(q,r){return r},onError:function(q){p._onFailure.apply(p,[q.error])},remoteSearchEngine:function(u,w){if(!!m.handler.handle){m.handler.handle.cancel()}m.handler.handle=k._getCancelObject();var t=w;var x=p.options.data;if(x){if(x.rules){t+=" ";var r=false;for(var s in x.rules){if(r){t+=" AND "}t+="(";var q=x.rules[s];var v=false;q.forEach(function(y){if(v){t+=" OR "}t+=s+':"'+y+'"';v=true});t+=")";r=true}}}return new Promise(function(z,y){a(t,{handleRequest:m.handler,onComplete:function(B){var A={};A.dataset=u;A.matchingItems=n.dataParser(u,B);z(A)},onFailure:function(A){var B={};B.type="error";B.error=A;B.dataset=u;y(B)}})})}};this.getConfig=function(){return n}};var c=j.extend({init:function(m){this.handlerLoad={handle:null};this.components={};this._parent(m)},destroy:function(){this._parent.apply(this,arguments);var m=this;setTimeout(function(){for(var n in m.components){try{m.components[n].destroy()}catch(o){}}})},setValue:function(m,p){var n=this._parent;var o=this;this.completeData([m],function(){n.apply(o,[m,p])})},completeData:function(n,m){if(n.length>0&&(!n[0]||n[0].label)){m()}else{var q=this;var p=[];var o={};n.forEach(function(r){p.push(r.id);o[r.id]=r;r.label=b["Not indexed"]});this.handlerLoad.handle=k._getCancelObject();e(p,{handleRequest:this.handlerLoad,onComplete:function(r){r.forEach(function(s){var t=o[s.id];if(t){t.label=s.label}});m()},onFailure:q._onFailure.bind(q)})}},_onFailure:function(m){this._dispatchNotification("error",m)},_buildRO:function(m,p){var n=this;var o=this._parent;n.showSpinner();this.completeData([m.value],function(){o.apply(n,[m,p]);n.hideSpinner()})},_build:function(m,o){var n=this;n.showSpinner();this.completeData([m.value],function(){n.__build(m,o);n.hideSpinner()})},_manageDrop:function(p){if(!p){return}var o=this;var m=JSON.parse(p);if(m.data&&m.data.items){var n=null;m.data.items.forEach(function(q){if(!!q.objectId&&!!q.displayName){if(!o.options.data||!o.options.data.rules||!o.options.data.rules.type||o.options.data.rules.type.indexOf(q.objectType)>=0){o.setValue({id:q.objectId,label:q.displayName})}else{n="mismatchType"}}else{n="wrongFormat"}if(n){o._dispatchNotification("warning",b[n])}})}},__build:function(o,r){var q=this;this.components.autocompleteWithRemoteData=new g({showSuggestsOnFocus:true});this.components.autocompleteWithRemoteData.addEvents({onSelect:l.bind(this.components.autocompleteWithRemoteData,this,true),onUnselect:l.bind(this.components.autocompleteWithRemoteData,this,false)});var n=o.value?[o.value]:[];var m=new h(this);this.components.autocompleteWithRemoteData.addDataset({name:b.ObjectsList,displayName:true,items:n},m.getConfig());if(o.value){this.firstToggle=true;this.components.autocompleteWithRemoteData.toggleSelect(o.value)}var p=this.components.autocompleteWithRemoteData;d.droppable(this.components.autocompleteWithRemoteData.elements.container,{drop:q._manageDrop.bind(this)});r.call(this,p)},_computeValueForRO:function(n,m){return n?n.label:""},_changeRW:function(o,n){if(!!o){var m={id:o.id,label:o.label,selected:true};var p=this.components.autocompleteWithRemoteData.selectedItems;if(p.length==0||p[0].id!==m.id){this.components.autocompleteWithRemoteData.toggleSelect(m,null,true)}}else{this.components.autocompleteWithRemoteData.resetInput()}},areEquals:function(n,m){return n===m||(!!n&&!!m&&n.id===m.id)},_getValueOrDefault:function(m){if(!m||!m.id){return null}return m}});return c});define("DS/WidgetServicesUI/infra/TweakerMVABase",["DS/MVAInput/MVAInput","DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/helpers/Constants"],function(b,d,c){var a=b.extend({internalOption:{useDropDown:false},defaultOptions:{options:[]},init:function(h,e){var g=this;if(!e.options){e.options=[]}var f=false;if(h.getType()===c.TYPES.STRING||h.getType()===c.TYPES.NUMBER||h.getType()===c.TYPES.BOOLEAN||h.getType()===c.TYPES.INTEGER){f=true}this.internalOption.useDropDown=f;var i=false;if(d.isReplayedODT()){i=true}h.addEvent("valid",function(){g._onValidValue()});if(f){h.addEvent("liveChange",function(){g._updateDropDown()})}this.textInput=h;this._parent(e)},_checkValue:function(f){if((this.textInput.getType()===c.TYPES.DATE||this.textInput.getType()===c.TYPES.DATETIME)&&!(f.value instanceof Date)){f.value=new Date(f.value)}var e=this.textInput.checkValue(f.value);return e?e:this._parent(f)},_actionOnValid:function(){this.textInput.setValue(null)},_isEqual:function(f,e){return this._parent(f,e)||this.textInput.areEquals(f,e)},_formatItem:function(e){return this.textInput.getDisplayValue(e.value)},_getTooltipForItem:function(e){return this.textInput.getDisplayValue(e.value,{detailed:true})},_getValueOfInput:function(){var e=this.textInput.getValue();return e},_getDisplayInputValue:function(){return this.textInput.getDisplayValue()},_focus:function(){var e=this.textInput.getElement();if(e&&typeof e==="function"){e.focus()}},_getItemOfInput:function(){var f=this._getValueOfInput();var e=this.textInput.getDisplayValue();return f===""?f:{value:f,displayValue:e}}});return a});define("DS/WidgetServicesUI/tweakers/TweakerButtonWeb",["DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase","DS/UIKIT/Input/Button","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(f,b,c,a,e){var d=c.extend({WidgetServices:null,SecurityContextServices:null,init:function(g){g.value=g.value?g.value:{};this.handleRequest={};this._parent(g)},_securityContextDispatcher:function(g,i,h){var l=this;var k=h.SecurityContext;if(k){l.__callWebService.call(this,g,i,h)}else{var j=this.SecurityContextServices.getInstance({tenant:h.tenant}).getSecurityContext({onSuccess:function(m){h.SecurityContext=m.SecurityContext;l.__callWebService.call(l,g,i,h)},onFailure:function(m){l._onFailure(null,{error:m},null,h)}});this._setCancelHandler(j)}},_setCancelHandler:function(g){if(g){this.handleRequest.handler=g}},__callWebService:function(o,g,w){var n=this;var l=this.options.data;var p="passport";var j=l&&l.headers?l.headers:{};j.Accept=j.Accept?j.Accept:"application/json";j["content-type"]=j["content-type"]?j["content-type"]:"application/json";j["Accept-Language"]=j["Accept-Language"]?j["Accept-Language"]:f.getLanguage();j.SecurityContext=w.SecurityContext?encodeURIComponent(w.SecurityContext):null;var h=l&&l.method?l.method:"GET";var k={type:"json",method:h,timeout:3600000,proxy:p,headers:j,onComplete:function(x){n._onComplete(x)},onFailure:function(x,y,z){n._onFailure(x,y,z)},onTimeout:function(x){n._onTimeout()}};if(this.getValue().data){k.data=UWA.Json.encode(this.getValue().data)}var t=this.getValue().parameters;t=t?t:{};var s=t.tenant?t.tenant:w.tenant;if(s){t.tenant=s}if(t){var v=g.indexOf("?");var m=v>0&&v<g.length-1?"&":"";if(v<0){g+="?"}for(var r in t){var q=t[r];if(Array.isArray(q)){q.forEach(function(x){g+=m+r+"="+x;m="&"})}else{g+=m+r+"="+q}m="&"}}try{var u=o.handleRequest(g,k);this._setCancelHandler(u)}catch(i){this._onFailure(null,i,null)}},_callWebService:function(g,i){var j=this.options.data;var h={};if(j.headers){h.SecurityContext=j.headers.SecurityContext}h.tenant=j.tenant?j.tenant:this.WidgetServices.getTenantID();this._securityContextDispatcher(g,i,h)},_launch:function(){var g=this;if(!g.handleRequest){g.handleRequest={}}this._setCancelHandler({toCancel:false,cancel:function(){this.toCancel=true}});require(["DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WAFData/WAFData"],function(l,j,h){g.WidgetServices=l;g.SecurityContextServices=j;if(g.handleRequest.handler&&g.handleRequest.handler.toCancel===false){var i=g.options.data.url;if(i){if(i.startsWith("http")){g._callWebService(h,i)}else{var k=l.get3DSpaceUrlAsync({onComplete:function(m){g._callWebService(h,m+g.options.data.url)}});g._setCancelHandler(k)}}}})},_onComplete:function(h){if(h&&h.success===false){this._onFailure(null,h)}else{this._clearHandle();this._changeStatus("completed","success");var g=this.getValue();g.value=h;this._dispatchChange(g,true)}},_onFailure:function(g,i,k,h){if(i!=null&&i.hasOwnProperty("error")){var j=i.error;if(typeof j==="object"){j=j.message}this._dispatchNotification("error",j)}this._clearHandle();this._changeStatus("failed","error")},_onTimeout:function(){this._clearHandle();this._changeStatus("timeout","warning")},_changeStatus:function(g,h){this.getElement().setClassName("twButton_"+g+(h?" "+h:""));this.getElement().setValue(e["tw_status_"+g])},_getDefaultLabel:function(){return this.options.data.label?this.options.data.label:e.tw_launch},_build:function(h,k){var i=this;var j=h.value;var g=new a({value:this._getDefaultLabel(),className:"primary",events:{onClick:function(){var l="";if(i._requestIsActive()){i._changeStatus("cancelled","warning");i._clearHandle()}else{i._changeStatus("loading","info");i._launch()}}}});k.call(this,g)},_requestIsActive:function(){return this.handleRequest.handler?true:false},_computeValueForRO:function(g){return this._getDefaultLabel()},_clearHandle:function(){if(this.handleRequest.handler){this.handleRequest.handler.cancel();this.handleRequest.handler=null}}});return d});define("DS/WidgetServicesUI/tweakers/TweakerString",["DS/WidgetServicesUI/infra/TweakerBase","DS/UIKIT/Input/Text","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(b,a,d){var c=b.extend({init:function(e){this._parent(e)},_build:function(n,m){var g=this;var k=this._transformString(n.value);var l=n.multiline;var j=null;if(n.placeholder){j=n.placeholder}else{j=d["Enter a value"];if(l){j=d["Enter a text"]}}var i=false;var e={value:k,className:"input-text-label",multiline:l,placeholder:j,events:{onChange:function(){if(!i){var o=this.getValue().replace(/\s+$/,"");g._dispatchChange(o,true)}},onKeyDown:function(p){if(p.keyCode===13){i=true;var o=this;setTimeout(function(){i=false;var q=o.getValue().replace(/\s+$/,"");g._dispatchLiveChange(q,p)})}}}};if(n.placeholder){e.placeholder=n.placeholder}var f=new a(e);var h={input:function(){setTimeout(function(){if(f.elements.input){var o=f.getValue().replace(/\s+$/,"");g._dispatchLiveChange(o)}})}};f.elements.input.addEvents(h);m.call(this,f)},_transformString:function(e){return e},_computeValueForRO:function(f,e){f=this._parent.apply(this,arguments);if(e&&e.forHTML!==false&&!!e.maxCharacters&&f.length>e.maxCharacters){f=f.substring(0,e.maxCharacters)+"..."}return f},_changeRW:function(g,f){var e=this;if(g===null||g===""){e.getElement().setValue("")}if(f||document.activeElement!==e.getElement().elements.input){e.getElement().setValue(this._transformString(g))}}});return c});define("DS/WidgetServicesUI/tweakers/TweakerReplacement",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase","DS/WidgetServicesUI/tweakers/TweakerString","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(b,c,a,e){var d=c.extend({_initValues:{},_currentValue:null,init:function(f){this._initValues={};this._currentValue=null;this._parent(f)},_postInit:function(){this._copyValueToInit()},_copyValueToInit:function(){var g=this.getValue();if(g!==this._currentValue){this._currentValue=g;this._initValues={};if(g){for(var f in g){this._initValues[f]=g[f]}}}},_build:function(f,i){var h=this;var g=UWA.createElement("div",{"class":"tw_replaceContainer"});this.elements.inputRegex=new a({placeholder:e["Enter a regex"],className:"tw_regexField",editable:true,nested:true,events:{change:function(j){h._applyResult()}}});this.elements.inputResult=new a({placeholder:e["Enter a replace expression"],className:"tw_replaceField",editable:true,nested:true,events:{change:function(j){h._applyResult()}}});this.elements.inputRegex.inject(g);this.elements.inputResult.inject(g);i.call(this,g)},_applyResult:function(){var f=false;var j=this.elements.inputRegex.getValue();if(j!==""&&j!==null){var n=this.elements.inputResult.getValue();if(n!==""&&n!==null){try{var i=new RegExp(j,"g");var g=this._initValues;var m={};for(var k in g){m[k]=g[k].replace(i,n)}this._currentValue=m;this._dispatchChange(m);f=true}catch(h){var l=h.message?h.message:e["Wrong regexp"];this._dispatchNotification("warning",l)}}}if(!f&&!this.areEquals(this._initValues,this._currentValue)){this._dispatchChange(UWA.clone(this._initValues))}},areEquals:function(i,f){var k=Object.keys(i);var j=Object.keys(f);var h=i===f||(i&&f&&k.length===j.length);if(i&&h){for(var g in i){var m=i[g];var l=f[g];h=m===l;if(!h){break}}}return h},_computeValueForRO:function(j){if(typeof j==="object"){var f=", ";var h="";for(var g in j){if(h!==""){h+=f}var i=j[g];h+=i}return h}},_setValue:function(f){this._parent(f);this._copyValueToInit()},_changeRW:function(f){if(f!==this._currentValue){this._applyResult()}}});return d});define("DS/WidgetServicesUI/infra/TweakerEnumBase",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase","DS/WidgetServices/WidgetServices","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(a,c,e,b){var d=c.extend({_withEmptyValue:false,init:function(f){this._withEmptyValue=false;this.tweakerInput=f.tweaker;this.mapOptions={};this._parent(f)},_postInit:function(){var g=this;var h=this.options.data.list;this._translateOptions(h);var f=0;h.forEach(function(i){if(i.value===null||i.value===""||i.value===undefined){g._withEmptyValue=true;i.value="_DS_ENUM_NULL_";i.label=b.get("tw_enum_null")}var j=typeof i.value==="string"?i.value:f+"";g.mapOptions[j]=i.value;i.valueObj=i.value;i.value=j;f++})},_translateOptions:function(f){var g=this;if(this.tweakerInput){f.forEach(function(h){if(h.label===null){h.label=g.getDisplayValue(h.value,{forHTML:false,escapeChar:false});h.html=g.getDisplayValue(h.value,{forHTML:false})}if(!h.html){h.html=h.label}})}},_computeValueForRO:function(j,h){var i=this;var g="";if(j!==null&&j!==undefined){var f=false;this.options.data.list.every(function(l){var k=i._getEnumValue(l.value);f=k!==undefined&&i.areEquals(k,j);if(f){g=l.html?l.html:l.label}return !f});if(!f&&this.tweakerInput){g=this.tweakerInput.getDisplayValue(j,h)}}return g?g:j},areEquals:function(g,f){return this._parent(g,f)||(this.tweakerInput&&this.tweakerInput.areEquals(g,f))},_getEnumValue:function(f){return this.mapOptions[f]},_getIdFromValue:function(f){return this.__getIdFromValue(f)},__getIdFromValue:function(h){var f=null;if(h!==undefined&&h!==null){for(var g in this.mapOptions){if(this.areEquals(h,this.mapOptions[g])){f=g;break}}}return f}});return d});define("DS/WidgetServicesUI/tweakers/TweakerEnum",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerEnumBase","DS/UIKIT/Input/Select","DS/WidgetServices/WidgetServices","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(a,b,f,e,d){var c=b.extend({_build:function(q,p){var k=this;var n=this.__getIdFromValue(q.value);var g=q.data.list;var m=q.data.placeholder===true?d.SelectOption:q.data.placeholder?q.data.placeholder:false;if(n===null){this.data.value=g.length>0?this._getEnumValue(g[0].value):null}var j=false;var h={value:n,options:g,nativeSelect:true,placeholder:m,className:"input-AuthorizedValuesboolean-label",events:{onChange:function(){var r=this.getValue();if(j||(r.length>0&&r[0]!==n)){r.forEach(function(t){var s=k._getEnumValue(t);if(s==="_DS_ENUM_NULL_"||s===undefined){s=""}k._dispatchChange(s,true)})}j=true}}};var l=false;if(e.isReplayedODT()){l=true}h.custom=l;if(q.placeholder){m=h.placeholder=q.placeholder}var i=new f(h);p.call(this,i);var o=this.getValue();if(q.nested!==true&&!m&&!n&&o!==undefined&&o!==null){k._dispatchChange(o,true)}},getValue:function(){return this.data.value==="_DS_ENUM_NULL_"||this.data.value===undefined?"":this.data.value},_changeRW:function(h){var g=this._getIdFromValue(h);this.getElement().setValue(g)}});return c});define("DS/WidgetServicesUI/tweakers/TweakerDropdown",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerEnumBase","DS/UIKIT/Dropdown","DS/UIKIT/Input/Button","DS/WidgetServices/WidgetServices","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(d,f,a,b,h,g){var c=function(i){return"tw_key_"+i.replace(/\W/g,"_")};var e=f.extend({_build:function(j,p){var k=this;var n=this.tweakerInput;n.__switchMode(true);var m=false;if(n.getType()===d.TYPES.STRING||n.getType()===d.TYPES.NUMBER||n.getType()===d.TYPES.INTEGER){m=true}var l=[];var i=this.elements.bodyDD=UWA.createElement("div",{"class":"tw_dropdown_content"});j.data.list.forEach(function(q){var r=UWA.createElement("div",{"class":"tw_dropdown_element "+c(q.value),text:q.label,events:{click:function(){var s=q.valueObj;k._dispatchChange(s,true);k._removeAllSelection();this.addClassName("tw_dd_selected")}}}).inject(i);UWA.createElement("span",{"class":"tw_dropdown_select"}).inject(r);l.push({value:q,UI:r})});this.elements.dropDown=new a({className:"tw_dropdown",body:i,target:n.elements.container});n.addEvent("changes",function(q){k._dispatchChange(q,true);k._selectFromValue(q)});var o=UWA.createElement("div");n.inject(o);if(!m){this.elements.dropButton=new b({icon:"expand-down",className:"default"}).inject(o)}this._selectFromValue(this.getValue());p.call(this,o)},_removeAllSelection:function(){if(this.elements.bodyDD){var i=this.elements.bodyDD.getElements(".tw_dd_selected");if(i){i.forEach(function(j){j.removeClassName("tw_dd_selected")})}}},_selectFromValue:function(l){if(this.elements.bodyDD){var j=this._getIdFromValue(l);this._removeAllSelection();if(j){var i="."+c(j);var k=this.elements.bodyDD.getElement(i);if(k){k.addClassName("tw_dd_selected")}}}},_changeRW:function(i){this.tweakerInput.setValue(i)}});return e});define("DS/WidgetServicesUI/tweakers/TweakerNumber",["DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase","DS/UIKIT/Input/Text","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(f,a,c,b,e){var d=c.extend({init:function(g){this._parent(g)},_postInit:function(){if(this.getType()===a.TYPES.INTEGER){this.options.stepValue=this.options.stepValue?parseInt(this.options.stepValue):1}},_build:function(t,r){var l=this;var p=t.value===""?t.value:parseFloat(t.value);var o=null;if(t.placeholder){o=t.placeholder}else{o=e["Enter a value"];switch(this.getType()){case a.TYPES.INTEGER:o=e["Enter an integer"];break;case a.TYPES.NUMBER:o=e["Enter a number"];break}}var k=new b({value:p,className:"input-number-label",placeholder:o,events:{onKeyDown:function(v){if(v.keyCode===13){var u=this;setTimeout(function(){var w=u.getValue();w=l._checkAndAdaptValue(w);l._dispatchLiveChange(w,v)})}}}});var n=k.elements.input;n.addEventListener("blur",function(){var u=k.getValue();var u=l._checkAndAdaptValue(u);l._dispatchChange(u,true)});var m={input:function(){setTimeout(function(){var u=k.getValue();l._dispatchLiveChange(u)})}};k.elements.input.addEvents(m);var j=t.units;if(j){var h=UWA.createElement("div",{"class":"input-group"});UWA.createElement("span",{"class":"input-group-addon",text:j}).inject(h);k.inject(h);k.tw_parent=h}var i=k.elements.container;var g=f.getLanguage();i.setAttribute("type","number");i.setAttribute("step",this.options.stepValue?this.options.stepValue:"any");i.setAttribute("lang",g);if(this.options.minValue){var q=this._getMinValue();i.setAttribute("min",q)}if(this.options.maxValue){var s=this._getMaxValue();i.setAttribute("max",s)}r.call(this,k)},_computeValueForRO:function(l,u){var k=null;var m=6;var h=5;var t=Math.pow(10,m);if(!isNaN(l)&&l!==""){var p=parseFloat(l);var o=!u||u.detailed!==true;k=p;var n=Math.abs(p);if(n>0&&(n>=t||n<0.1)){k=p.toExponential(o?h:undefined)}else{if(o){var q=l+"";var i=q.indexOf(".");var g=q.length;var s=i<0?0:g-i-1;s=Math.min(s,h);k=p.toFixed(s)}}k=this._removeTrailingZeros(k+"");var j=f.getLanguage();var r=(0.1).toLocaleString(j)[1];k=k.replace(".",r)}else{k=this._parent(l)}return k},_removeTrailingZeros:function(g){return g.replace(/((\.[0-9]*[1-9])|\.)0*(([eE])|[^eE]?.?\d*$)/,"$2$4")},_checkAndAdaptValue:function(i){if(i===""){return i}var n=parseFloat(i);var j=1;if(this.options.stepValue){var p=this.options.minValue?this.options.minValue:0;j=this.options.stepValue;var m=j+"";var h=0;var l=m.indexOf(".");if(l<0){l=m.indexOf(",")}if(l>=0){h=m.length-l-1}var s=Math.pow(10,h);var q=parseInt(j*s);var g=parseInt((n-p)*s);var k=g%q;n=(g-k+p*s)/s}if(this.options.minValue){var o=this._getMinValue();n=Math.max(n,o)}if(this.options.maxValue){var r=this._getMaxValue();n=Math.min(n,r)}return n},areEquals:function(h,g){return this._parent(h,g)||parseFloat(h)===parseFloat(g)},checkValue:function(i){var h=isNaN(i)?e["Please enter a correct value"]:null;var g=null;if(h){g={message:h}}return g},_changeRW:function(i,h){var g=this;if(i===null||i===""){g.getElement().setValue("")}else{if(h||document.activeElement!==g.getElement().elements.input){g.getElement().setValue(parseFloat(i))}}}});return d});define("DS/WidgetServicesUI/tweakers/TweakerDate",["DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase","DS/UIKIT/Input/Date","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(f,b,c,a,e){var d=c.extend({init:function(g){this._parent(g)},_build:function(h,l){var j=this;var k=h.value;var g=(h.mandatory===true)?false:true;if(this.type===b.TYPES.DATE){var i=new a({value:k,showClearIcon:g,className:"input-date-label",placeholder:e.selectADate,events:{onChange:function(){if(this.elements.picker){var m=this.getDate();if(!!m){m.setHours(12);m.setUTCHours(12)}else{m=""}j._dispatchChange(m,true)}}}});l.call(this,i)}else{require(["DS/Controls/DatePicker"],function(n){var m=new n({value:k,timePickerFlag:true,timePickerPrecision:"sec"});m.addEventListener("change",function(p){var o=p.dsModel.value;j._dispatchChange(o,true)});m.addEventListener("livechange",function(p){var o=p.dsModel.value});l.call(j,m)})}},areEquals:function(h,g){var i=this._methodForDisplay();return h&&g?h[i]()===g[i]():h===g},_methodForDisplay:function(){return this.type===b.TYPES.DATE?"toLocaleDateString":"toLocaleString"},_computeValueForRO:function(h){var g=this._methodForDisplay();return h?h[g](f.getLanguage()):""},_changeRW:function(h){var g=this.getElement();if(g instanceof a){if(!h){this.getElement().setValue("")}else{this.getElement().setDate(h)}}else{this.getElement().value=h}}});return d});define("DS/WidgetServicesUI/tweakers/TweakerPerson",["DS/WidgetServicesUI/infra/TweakerBase"],function(a){var b=a.extend({init:function(c){this._parent(c)},_build:function(c,e){var d=this;require(["DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant"],function(k,f){var j=c.value;var h=f.TYPE_PERSON;var g=k.getSearchWidget(k.FULL,{className:"EPP_searchPeople",MaxNumber:"3",MaxSize:"300",showEmptyCategory:false,setBorderColor:true,acceptEmpty:!d.options.mandatory,type:h,events:{onValid:function(){var l=g.getNewOwner();if(l.person.personFullName){var n=l.person.personFullName;var m=l.person.personID;m=m?m.replace(/_PRJ$/,""):m;var n={fullName:n,personID:m};d._dispatchChange(n,true)}},onUnvalid:function(){var l=g.getDisplayedResult();var l={fullName:l,personID:null};d._dispatchChange(l)},onError:function(l){d._setError(l)}}});var i=[];if(c.data&&c.data.objectIDs){c.data.objectIDs.forEach(function(l){i.push({objectID:l})})}g.setSelectedItemList(i);if(j){g.setValue(j.fullName)}e.call(this,g)})},actionOnScroll:function(){if(this.getElement()){this.getElement().actionOnScroll()}},_computeValueForRO:function(c){return c?c.fullName:""},areEquals:function(d,c){return d.personID===c.personID},_changeRW:function(c){this.getElement().setValue(c?c.fullName:"")},_getValueOrDefault:function(c){var d=c?c:{personID:"",fullName:""};return d}});return b});define("DS/WidgetServicesUI/tweakers/TweakerBoolean",["DS/WidgetServicesUI/infra/TweakerBase","DS/UIKIT/Input/Toggle","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(a,d,c){var b=a.extend({init:function(e){this._parent(e)},_build:function(e,j){var h=this;var i=e.value;var g=i===true;var f=new d({type:"switch",checked:g,value:"",className:"input-boolean-label",events:{onChange:function(){var k=this.isChecked();h._dispatchChange(k)}}});j.call(this,f)},_computeValueForRO:function(e){return e===true?c["true"]:c["false"]},_changeRW:function(e){this.getElement().setCheck(e===true)}});return b});define("DS/WidgetServicesUI/tweakers/TweakerHTML",["DS/WidgetServicesUI/infra/TweakerBase"],function(b,a){var c=b.extend({init:function(d){this._parent(d)},_buildRO:function(d,h){var f=this;var g=d.value;g=g?g:"";var e=this._createROContainer(g);h.call(this,e)},_computeValueForRO:function(d){return typeof d==="object"?d.textContent:d}});return c});define("DS/WidgetServicesUI/tweakers/TweakerImage",["DS/WidgetServicesUI/infra/TweakerBase","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","css!DS/WidgetServicesUI/WidgetServicesUI"],function(a,d,c,b){return a.extend({_initComponents:function(){var e=this;this.addIcon=UWA.createElement("i",{"class":"fonticon fonticon-plus",id:"add_image_icon"});this.removeIcon=UWA.createElement("i",{"class":"fonticon fonticon-wrong",id:"remove_image_icon",events:{click:function(f){e.preview.src=e.input.value=this.style.display=e.addIcon.style.display=e.label.style.display=e.previewDiv.style.display=e.labelContainer.style.padding=""}}});this.label=UWA.createElement("label",{id:"label-dropper","for":"dropper",text:d["Drop an image here"]});this.container=UWA.createElement("div",{id:"image_tweaker_container"});this.labelContainer=UWA.createElement("div",{id:"image_tweaker_label_container"});this.previewDiv=UWA.createElement("div",{id:"image_tweaker_div_preview"});this.preview=UWA.createElement("img",{id:"image_tweaker_preview"});this.input=UWA.createElement("input",{id:"dropper",type:"file",events:{dragenter:function(){e.container.style.backgroundColor="#e4f0f5";e.container.style.border="dashed #005686 1px"},dragleave:function(){e.container.style.backgroundColor="";e.container.style.border=""},change:function(f){e._onChange(f)}}})},init:function(e){this._parent(e);this._initComponents()},_checkImageType:function(e){if(e){return new RegExp(/^[A-z]*/).exec(e.type)[0]==="image"}else{this._dispatchNotification("error",d["Unexpected file error"])}},_onChange:function(i){var h=this;this.container=document.getElementById("image_tweaker_container");this.container.style.backgroundColor="";this.container.style.border="";var g=i.target.files[0];if(this._checkImageType(g)){var f=new FileReader();if(g){f.readAsDataURL(g)}f.addEventListener("load",function(){h.previewDiv.style.display="block";h.preview.src=f.result;h.labelContainer.style.padding="10px";h.label.style.display="none";h.addIcon.style.display="none";h.removeIcon.style.display="block";var e={fileInfo:{file:g},};c.get3DSpaceUrlAsync({onComplete:function(m){var j={};j.onComplete=function(n){h.documentUrl=m+n};var k=j.onFailure;j.onFailure=function(n,o){console.error("failure")};var l=null;b.getInstance().getSecurityContext({alwaysUpdate:true,onFailure:function(n){console.error("no security error");h._dispatchNotification("error","no security context")},onSuccess:function(n){j.securityContext=n.securityContext}})}})},false)}else{this.input.value="";this._dispatchNotification("error",d["Drop an image here"])}},_build:function(e,f){this.that=this;this.preview.inject(this.previewDiv);this.removeIcon.inject(this.previewDiv);this.addIcon.inject(this.labelContainer);this.label.inject(this.labelContainer);this.previewDiv.inject(this.labelContainer);this.input.inject(this.container);this.labelContainer.inject(this.container);f.call(this,this.container)}})});define("DS/WidgetServicesUI/tweakers/TweakerOutput",["DS/WidgetServicesUI/infra/TweakerBase"],function(b,a){var c=b.extend({init:function(d){this._parent(d)}});return c});define("DS/WidgetServicesUI/helpers/Helpers",["DS/WidgetServices/MultipleAsynchronousRequests","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/tweakers/TweakerPerson","DS/WidgetServicesUI/tweakers/TweakerString","DS/WidgetServicesUI/tweakers/TweakerNumber","DS/WidgetServicesUI/tweakers/TweakerDate","DS/WidgetServicesUI/tweakers/TweakerBoolean","DS/WidgetServicesUI/tweakers/TweakerOutput","DS/WidgetServicesUI/tweakers/TweakerHTML","DS/WidgetServicesUI/tweakers/TweakerImage",],function(h,b,f,i,e,m,k,d){var l={};var g={};g[b.TYPES.BOOLEAN]={req:"DS/WidgetServicesUI/tweakers/TweakerBoolean"};g[b.TYPES.STRING]={req:"DS/WidgetServicesUI/tweakers/TweakerString"};g[b.TYPES.NUMBER]={req:"DS/WidgetServicesUI/tweakers/TweakerNumber"};g[b.TYPES.INTEGER]={req:"DS/WidgetServicesUI/tweakers/TweakerNumber"};g[b.TYPES.ENUM]={req:"DS/WidgetServicesUI/tweakers/TweakerEnum"};g[b.TYPES.PERSON]={req:"DS/WidgetServicesUI/tweakers/TweakerPerson"};g[b.TYPES.DATE]={req:"DS/WidgetServicesUI/tweakers/TweakerDate"};g[b.TYPES.DATETIME]={req:"DS/WidgetServicesUI/tweakers/TweakerDate"};g[b.TYPES.HTML]={req:"DS/WidgetServicesUI/tweakers/TweakerHTML"};g[b.TYPES.OUTPUT]={req:"DS/WidgetServicesUI/tweakers/TweakerOutput"};g[b.TYPES.BUTTONWEB]={req:"DS/WidgetServicesUI/tweakers/TweakerButtonWeb"};g[b.TYPES.DROPDOWN]={req:"DS/WidgetServicesUI/tweakers/TweakerDropdown"};g[b.TYPES.REPLACEMENT]={req:"DS/WidgetServicesUI/tweakers/TweakerReplacement"};g[b.SPE_TYPES.MVA]={req:"DS/WidgetServicesUI/tweakers/TweakerMVA"};g[b.TYPES.IMAGE]={req:"DS/WidgetServicesUI/tweakers/TweakerImage"};g[b.TYPES.MULTIPLE]={req:"DS/WidgetServicesUI/tweakers/TweakerMultiple"};g[b.TYPES.RELATION]={req:"DS/WidgetServicesUI/tweakers/TweakerRelation"};var c=function(o,p,n){l[o]={element:n,requireStr:p}};var a=function(q,n,r){var p=l[q];if(p&&p.requireStr===n){r.call(null,p.element)}else{var o=require([n],function(s){c(q,n,s);r.call(null,s)})}};c(b.TYPES.STRING,g[b.TYPES.STRING].req,i);c(b.TYPES.PERSON,g[b.TYPES.PERSON].req,f);c(b.TYPES.NUMBER,g[b.TYPES.NUMBER].req,e);c(b.TYPES.INTEGER,g[b.TYPES.INTEGER].req,e);c(b.TYPES.DATETIME,g[b.TYPES.DATETIME].req,m);c(b.TYPES.DATE,g[b.TYPES.DATE].req,m);c(b.TYPES.OUTPUT,g[b.TYPES.OUTPUT].req,d);var j={getTweaker:function(v,z,x){var u=this;var t=null;var p=z.multivalued===true;var w=v!==b.TYPES.ENUM&&(z.data&&z.data.list!==undefined);var r=w&&(z.data&&z.data.range_required!==false);var o=z.multisel===true;var q=["A"];if(p){q.push("B")}if(w){q.push("C")}if(o){q.push("D")}var y=new h(q,function(){var I=this.getAnswer("A");var D=this.getAnswer("B");var H=this.getAnswer("C");var F=this.getAnswer("D");if(D&&(H||v===b.TYPES.ENUM)){z.data=z.data?z.data:{};z.data["placeholder"]=z.data["placeholder"]?z.data["placeholder"]:true}var A=UWA.clone(z);A.tw_type=v;if(D||F){A.value=null;A.nested=D!=null||F!=null;A.events={}}else{if(!H){A.value=z.value}}var G=new I(A);if(H){var C=D!=null||F!=null;var E=D?UWA.clone(A):UWA.clone(z);E.tweaker=G;E.nested=D!=null||F!=null;E.value=C?null:z.value;G=new H(E)}if(D){var C=F!=null;var J=UWA.clone(z);J.tweaker=G;J.nested=F!=null;J.value=C?null:z.value;J.events=C?{}:J.events;G=new D(J)}if(F){var B=UWA.clone(z);B.tweaker=G;B.value=z.value;G=new F(B)}x.call(u,G)});if(p){a(b.SPE_TYPES.MVA,"DS/WidgetServicesUI/tweakers/TweakerMVA",function(A){y.setAnswer("B",A)})}if(w){var n=r?b.TYPES.ENUM:b.TYPES.DROPDOWN;a(b.SPE_TYPES.ENUM,g[n].req,function(A){y.setAnswer("C",A)})}if(o){a(b.TYPES.MULTIPLE,g[b.TYPES.MULTIPLE].req,function(A){y.setAnswer("D",A)})}var s=g[v];if(!s){s=z.readOnly===true?g[b.TYPES.OUTPUT]:g[b.TYPES.STRING]}t=s.req;if(window.top.isDebug===true){console.log("Load Tweaker "+v+" : "+window.top.performance.now())}a(v,t,function(A){if(window.top.isDebug===true){console.log("Tweaker Loaded "+v+" : "+window.top.performance.now())}y.setAnswer("A",A)})},getAdvTweaker:function(p,o,r){var q=this;var n=null;o.touchMode=true;switch(p){case b.TYPES.BOOLEAN:n="DS/Tweakers/TweakerBoolean";break;case b.TYPES.NUMBER:n="DS/Tweakers/TweakerNumber";break;default:n=null}if(n!==null){a(p,n,function(t){var s=new t(o);if(o.events){for(var u in o.events){s.addEventListener(u,o.events[u])}}r.call(q,s)})}else{this.getTweaker(p,o.value,o,r)}}};return j});define("DS/WidgetServicesUI/tweakers/TweakerMultiple",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase","DS/WidgetServicesUI/helpers/Helpers","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/tweakers/TweakerString","UWA/Core","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService","css!DS/WidgetServicesUI/WidgetServicesUI"],function(b,i,h,a,e,g,j,f,d,c){return i.extend({_tweakerInput:null,_tweakerBuilt:false,_editorStatus:"single",_multipleChoices:false,_nbSelectCreated:0,_selectValueList:null,init:function(k){this._tweakerBuilt=false;this._multipleChoices=false;this._editorStatus="replace";this._nbSelectCreated=0;this.type=b.SPE_TYPES.MULTISEL;this._tweakerInput=k.tweaker;this._parent(k)},getDisplayValues:function(o,m){if(m&&m.singleLine===true){return this._parent(o,m)}else{var n={};var l=this.getValue();for(var k in l){n[k]=this._tweakerInput.getDisplayValues(l[k],{forHTML:false})}return n}},_generateValueForSelectTweaker:function(l,o){var n=this;var m=null;if(l.length>1&&(!this.elements.replacementContainer||this.elements.replacementContainer.getValue()!==o)){var k=d.clone(o);k._ismultisel=true;var m=[{value:k,label:d.i18n("tw_multiple_noChange")}];l.forEach(function(q){var p=n._tweakerInput.getDisplayValue(q,{escapeChar:false,forHTML:false});m.push({value:q,label:p})})}return m},_build:function(l,o){var m=this;this.elements.twMulticontainer=d.createElement("div",{"class":"tweaker_multiSelContainer"});this.elements.inputContainer=d.createElement("div",{"class":"tweaker_inputContainer"});var n=this._getSingleValues(this.getValue());this._selectValueList=d.clone(n);var k=this._generateValueForSelectTweaker(n,this.getValue());if(k&&k.length>2){this._buildSelect(k)}else{if(n.length>0){this._tweakerInput.setValue(n[0])}}this._switchToTweaker();this.elements.inputContainer.inject(this.elements.twMulticontainer);o.call(this,this.elements.twMulticontainer)},_setValueOnData:function(n){var m=n!==null&&n._ismultisel!==undefined;var l=d.clone(this.getValue());for(var k in l){l[k]=m?n[k]:n}return l},_computeValueForRO:function(p){if(typeof p==="object"){var l=[];for(var m in p){var o=p[m];var k=this._tweakerInput.getDisplayValue(o);if(l.indexOf(k)<0){l.push(k)}}var n=l.length>1?"("+c.get("tw_multiple_prefix")+") ":"";n+=l.join(", ");return n}else{return this._tweakerInput.getDisplayValue(p)}},_buildButton:function(){var k=this;if(!this.elements.addButton){this.elements.addButton=new e({className:"tw_multiple_switch",icon:"plus",events:{onClick:function(){k._switchToTweaker()}}});this.elements.tooltipButton=new g({target:this.elements.addButton.getContent(),body:c.get("Define for all")});this.elements.addButton.inject(this.elements.twMulticontainer)}},_buildReplacement:function(k){var l=this;if(!this.elements.replacementContainer){var m={value:d.clone(k),readOnly:false,editable:true,nested:true,events:{change:function(n){l.__dispatchValueFromTweaker(this,n)},notification:this._dispatchNotificationObj.bind(this)}};h.getTweaker(b.TYPES.REPLACEMENT,m,function(n){if(!l.elements.replacementContainer){l.elements.replacementContainer=n}if(l._editorStatus==="replace"){l.elements.replacementContainer.inject(l.elements.inputContainer);l.__dispatchValueFromTweaker(l.elements.replacementContainer)}})}},_buildSelect:function(l){var m=this;this._buildButton();if(this._tweakerInput instanceof f){this._buildReplacement(this.getValue())}this._multipleChoices=true;if(this.elements.select){this.elements.select.destroy();delete this.elements.select}var n={data:{list:l},readOnly:false,editable:true,nested:true,events:{change:function(o){m.__dispatchValueFromTweaker(this,o)}}};this._nbSelectCreated++;var k=this._nbSelectCreated;h.getTweaker(b.TYPES.ENUM,n,function(o){if(k===m._nbSelectCreated){m.elements.select=o;if(m._editorStatus==="multiple"){m.elements.select.inject(m.elements.inputContainer);m.__dispatchValueFromTweaker(m.elements.select)}}})},_switchToTweaker:function(){var m=this._tweakerInput instanceof f;if(this._editorStatus==="multiple"||!this._multipleChoices){this._editorStatus="single"}else{if(this._editorStatus==="single"&&m){this._editorStatus="replace"}else{this._editorStatus="multiple"}}var k="";var l=null;this.elements.inputContainer.empty();var n=null;if(this._editorStatus==="single"){if(!this._tweakerBuilt){this._buildTweaker()}l=m?"replace":"close";if(this.elements.addButton){this.elements.addButton.setIcon(l)}n=this._tweakerInput}else{if(this._editorStatus==="multiple"){l="plus";this.elements.addButton.setIcon(l);n=this.elements.select}else{if(this._editorStatus==="replace"){l="close";this.elements.addButton.setIcon(l);n=this.elements.replacementContainer}}}if(this.elements.tooltipButton){if(l==="plus"){this.elements.tooltipButton.setBody(c.get("Define for all"))}if(l==="close"){this.elements.tooltipButton.setBody(c.get("Set existing"))}if(l==="replace"){this.elements.tooltipButton.setBody(c.get("Replace with RegExp"))}}if(n!=null){n.inject(this.elements.inputContainer);this.__dispatchValueFromTweaker(n)}},__dispatchValueFromTweaker:function(n,m,k){if(m===null||m===undefined){m=n.getValue()}var l=m;if(this._editorStatus!=="replace"){l=this._setValueOnData(m)}if(k===true){this._dispatchLiveChange(l)}else{this._dispatchChange(l)}},_buildTweaker:function(){var k=this;this._tweakerBuilt=true;this._tweakerInput.__switchMode(true);this._tweakerInput.addEvent("change",function(){var l=this.getValue();k.__dispatchValueFromTweaker(this,l)});this._tweakerInput.addEvent("liveChange",function(){var l=this.getValue();k.__dispatchValueFromTweaker(this,l,true)})},areEquals:function(n,k){var p=Object.keys(n);var o=Object.keys(k);var m=n===k||(n&&k&&p.length===o.length);if(n&&m){for(var l in n){var r=n[l];var q=k[l];m=this._tweakerInput.areEquals(r,q);if(!m){break}}}return m},_getSingleValues:function(l){var n=this;var p=[];for(var m in l){var k=l[m];var o=j.arrayContains2(p,k,function(r,q){return n._tweakerInput.areEquals(r,q)});if(o<0){p.push(k)}}return p},_getValueOrDefault:function(k){return k},_changeRW:function(m){var n=this._getSingleValues(m);var l=this._generateValueForSelectTweaker(n,m);var k=n&&n.length==1?n[0]:null;if(k!=null){this._tweakerInput.setValue(k)}if(l&&l.length>2&&!this.areEquals(this._selectValueList,m)){this._selectValueList=d.clone(m);this._buildSelect(l)}}})});