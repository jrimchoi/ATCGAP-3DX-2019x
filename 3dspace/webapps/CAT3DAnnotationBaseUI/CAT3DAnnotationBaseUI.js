/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationBaseUI/CAT3DAnnotationExpander",["UWA/Core","UWA/Class","DS/Controls/Expander","css!DS/CAT3DAnnotationBaseUI/CAT3DAnnotationBaseUI.css"],function(d,b,a){var c=a.extend({init:function(e){this._parent(e);this.displayTitle=e.displayTitle!==undefined?e.displayTitle:true},_applyHeader:function(){while(this.elements.headerContainer.firstChild){this.elements.headerContainer.removeChild(this.elements.headerContainer.firstChild)}var f=this._endOffset!==undefined&&parseFloat(this._endOffset)>50?parseFloat(this._endOffset):50;this.elements.headerContainer.setStyles({width:"calc(100% - "+f+"px)"});var e=d.createElement("h5",{"class":"headerTitle"}).inject(this.elements.headerContainer);if(this.displayTitle){e.title=this.header}e.setStyles({"font-weight":"normal","word-wrap":"break-word","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis",width:"calc(100% - 7px)"});e.innerHTML=this.header}});return c});define("DS/CAT3DAnnotationBaseUI/CAT3DAnnotationBaseUI",[],function(){});define("DS/CAT3DAnnotationBaseUI/CAT3DAnnotationAttrDiv",["UWA/Core","UWA/Class","UWA/Controls/ThemedScroller","DS/VisuEvents/EventsManager","DS/WebappsUtils/WebappsUtils","DS/CAT3DAnnotationUtils/CAT3DAnnotationUnits","css!DS/CAT3DAnnotationBaseUI/CAT3DAnnotationBaseUI.css"],function(f,a,e,b,d,g){var i="";var h={};require(["i18n!DS/CAT3DAnnotationBaseUI/assets/nls/CAT3DAnnotationBaseUI"],function(j){i=j.MoreLbl;h=j.FailureModes});var c=a.extend({init:function(k){this._parent(k);var x=f.createElement("div",{"class":"CAT3DAnnotationAttrDiv"});var o,j;var s,q;var A,z=[];var l=false;var y=d.getWebappsAssetUrl("CAT3DAnnotationRsc","icons/22/");var p={4:"I_W3DAnnot_VeryHighFailureMode.png",3:"I_W3DAnnot_HighFailureMode.png",2:"I_W3DAnnot_MediumFailureMode.png",1:"I_W3DAnnot_LowFailureMode.png",0:"I_W3DAnnot_LeastImportantFailureMode.png"};var v;function w(){this.setStyles({color:"#368ec4",cursor:""})}function u(){this.setStyles({color:"rgb(130, 190, 220)",cursor:"pointer"})}function m(D,F){var C=f.createElement("div",{"class":"CAT3DAnnotationAttrDivTitleAndText"});if(D){var E=f.createElement("p",{"class":"CAT3DAnnotationAttrDivBoldTitle"}).inject(C);E.innerHTML=D}if(F){var B=f.createElement("p",{"class":"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivValue"}).inject(C);B.innerHTML=F}return C}function r(E){var F=f.createElement("div",{"class":"CAT3DAnnotationFailureDiv"});var C=f.createElement("div",{"class":"CAT3DAnnotationFailureImgBoxDiv"}).inject(F);f.createElement("img",{"class":"CAT3DAnnotationFailureImgDiv",src:y+p[E.crit]}).inject(C);var B=f.createElement("div",{"class":"CAT3DAnnotationFailureTextDiv"}).inject(F);var G=f.createElement("p",{"class":"CAT3DAnnotationFailureTextBoldDiv"}).inject(B);G.innerHTML=h[E.crit];for(var D=0;D<E.descriptions.length;D++){G=f.createElement("p",{"class":"CAT3DAnnotationFailureTextValueDiv"}).inject(B);G.innerHTML=E.descriptions[D]}return F}function n(F,E,B){var D=f.createElement("div",{"class":"CAT3DAnnotationAttrDivTitleAndText"});var C=f.createElement("p",{"class":"CAT3DAnnotationAttrDivBoldTitle"}).inject(D);C.innerHTML=F;if(F.indexOf("ISO")===-1){C.innerHTML+="-"}else{C.innerHTML+=":"}C.innerHTML+=E;C.innerHTML+=" ";var G=f.createElement("p",{"class":"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivValue"}).inject(D);G.innerHTML=B;return D}function t(B,C,E){var D=f.createElement(B,{"class":"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivUrl"});if(B==="a"){D.setAttributes({href:C.url})}if(C.title!==undefined&&C.title!==""){D.innerHTML=C.title;D.setAttributes({title:C.url})}else{D.innerHTML=C.url}D.addEventListener("mouseenter",u);D.addEventListener("mouseleave",w);D.setStyles({color:"rgb(0, 120, 175)",padding:l?"5px 0px":"2px 0px"});if(B!=="a"&&E){D.linkedData=C;z.push(b.addEvent(D,"onPrimaryPointerClick",function(){E(C)}))}return D}this.setTouchDisplay=function(E){var B=typeof E==="boolean"?E:false;if(l!==B){l=B;var D=x.querySelectorAll(".CAT3DAnnotationAttrDivUrl");if(!D.length){return}for(var C=0;C<D.length;C++){D[C].setStyles({padding:l?"5px 0px":"0px"})}}};this.getContent=function(){return x};this.buildDivWithDots=function(E){o=f.createElement("div");o.appendChild(x);var D=E.maxHeight;if(j&&v>E.maxHeight){D=0;var H=x.querySelectorAll(".CAT3DAnnotationAttrDivContent");if(H.length){H=H[0].childNodes;var G;for(var B=0;B<H.length;B++){for(var C=0;C<H[B].childNodes.length;C++){G=H[B].childNodes[C];if(D+G.divHeight<E.maxHeight){D+=G.divHeight}else{break}}}}}D=D?D:E.maxHeight;x.setStyles({"max-height":D+"px",width:"300px"});var F=f.createElement("div",{"class":"CAT3DAnnotationAttrDivDots"}).inject(o);F.innerHTML=i;A=b.addEvent(F,"onPrimaryPointerClick",function(I){I.from[0].event.stopPropagation();I.from[0].event.preventDefault();E.callback(I)});return o};this.expand=function(){if(o){if(A){b.removeEventFromToken(A);A=0}var B=o.querySelector(".CAT3DAnnotationAttrDivDots");o.removeChild(B)}x.setStyles({"max-height":"290px",width:"300px"});x.expand()};this.getContainerHeight=function(){return v};this.areAllInformationVisible=function(B){return B.maxHeight<v};this.build=function(B,E,J){var K,T,D;if(B===s&&q===E){return x}s=B;q=E;while(x.firstChild){x.removeChild(x.firstChild)}if(A){b.removeEventFromToken(A);A=0}if(z.length){for(K=0;K<z.length;K++){b.removeEventFromToken(z[K])}z.length=0}o=null;j=null;v=0;x.setStyles({"max-height":"",height:""});var H;for(K=0;K<s.length;K++){if(!H){H=f.createElement("div",{"class":"CAT3DAnnotationAttrDivMainContainer"})}var X=s[K];var Q=f.createElement("div",{"class":"CAT3DAnnotationAttrDivContent"}).inject(H);if(q){var N=f.createElement("div",{"class":"CAT3DAnnotationAttrContainer"}).inject(Q);if(X.icon){f.createElement("img",{src:X.icon,"class":"CAT3DAnnotationAttrDivIcon"}).inject(N)}if(X.name){var Y=f.createElement("p",{"class":"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivTitle"}).inject(N);Y.innerHTML=X.name;Y.title=X.name}}j=f.createElement("div",{"class":"CAT3DAnnotationAttrDivTextContainer"}).inject(Q);var W=X.infos;var M=Object.keys(W);for(T=0;T<M.length;T++){switch(M[T]){case"semanticStandards":for(D=0;D<W.semanticStandards.length;D++){n(W.semanticStandards[D].code,W.semanticStandards[D].year,W.semanticStandards[D].title).inject(j)}break;case"hyperlinksAndComments":var S=W.hyperlinksAndComments.urls;if(S&&S.length){for(D=0;D<S.length;D++){t("a",{title:S[D].title,url:S[D].url}).inject(j)}}if(W.hyperlinksAndComments.hiddenText){var F=W.hyperlinksAndComments.hiddenText.split(/(\r\n|\n|\r)/gm);for(D=0;D<F.length;D++){m(null,F[D]).inject(j)}}break;case"tolerances":if(W.tolerances.tabulatedLimit&&W.tolerances.toleranceLimits){m(W.tolerances.tabulatedLimit," ("+W.tolerances.toleranceLimits.min+" / +"+W.tolerances.toleranceLimits.max+")").inject(j)}if(W.tolerances.generalTol){m(W.tolerances.generalTol.name," ("+W.tolerances.generalTol.variation+")").inject(j)}break;case"failureModes":if(W.failureModes.length){var U=[],L;for(D=0;D<W.failureModes.length;D++){L=W.failureModes[D];if(U[L.crit]){U[L.crit].descriptions=U[L.crit].descriptions.concat(L.descriptions)}else{U[L.crit]={crit:L.crit,descriptions:L.descriptions.slice()}}}for(D=0;D<U.length;D++){if(U[D]){r(U[D]).inject(j)}}}break;default:if(M[T]==="requirements"||M[T]==="relatedDocs"){var C=W[M[T]];if(C&&C.length){for(D=0;D<C.length;D++){t("p",{title:C[D].displayLabel,url:C[D].label,phyID:C[D].phyID,type:C[D].type,phyType:C[D].phyType},J).inject(j)}}}else{if(Array.isArray(W[M[T]])){var R,O;for(D=0;D<W[M[T]].length;D++){O=W[M[T]][D].Magnitude;R=W[M[T]][D].Value;if(O&&O.toLowerCase){O=O.toLowerCase()}if(O==="length"||O==="area"||O==="volume"||O==="angle"){R=g.convert(W[M[T]][D].Value,O)}else{if(O==="boolean"){R=(R==="1").toString()}}m(W[M[T]][D].Name+": ",R).inject(j)}}else{var I=W[M[T]].split(/(\r\n|\n|\r)/gm);for(D=0;D<I.length;D++){if(I[D].charCodeAt(0)===10){continue}var P=I[D].indexOf("=");if(P===-1){P=I[D].indexOf(":")}if(P!==-1){m(I[D].substring(0,P+1),I[D].substring(P+1,I[D].length)).inject(j)}else{m(null,I[D]).inject(j)}}}}}}if(K!==s.length-1&&s.length>1){f.createElement("div",{"class":"CAT3DAnnotationAttrDivLine"}).inject(Q)}}if(H){x.appendChild(H);x.expand=function(){x.setStyles({height:v+"px"});if(v>290){x.removeChild(H);var Z=new e().inject(x);Z.getInnerElement().setContent(H);H.parentNode.parentNode.setStyles({height:"100%"});H.setStyles({height:v+"px"})}};var G=0;var V=setInterval(function(){var Z=0;var ac=H.querySelectorAll(".CAT3DAnnotationAttrDivContent");if(ac.length&&G<500){G++;ac=ac[0].childNodes;var ab,aa;for(K=0;K<ac.length;K++){for(T=0;T<ac[K].childNodes.length;T++){ab=ac[K].childNodes[T];aa=Math.max(ab.offsetHeight,ab.clientHeight);if(aa){ab.divHeight=aa}Z+=aa}}if(Z>10){clearInterval(V);v=Z}}else{v=0;clearInterval(V)}},10)}return x}}});return c});define("DS/CAT3DAnnotationBaseUI/CAT3DAnnotationBrowserSection",["UWA/Class","UWA/Core","DS/CAT3DAnnotationBaseUI/CAT3DAnnotationExpander","DS/VisuEvents/EventsManager","css!DS/CAT3DAnnotationBaseUI/CAT3DAnnotationBaseUI.css"],function(c,g,b,a){var d={};var f=b.extend({init:function(h){this._parent(h);this.header=h.name;this.body=g.createElement("div",{"class":"BrowserAnnotThumbsMainContainer"});if(!h.childrenContainer){for(var i=0;i<h.children.length;i++){h.children[i].view.getContent().inject(this.body)}}else{h.childrenContainer.getContent().inject(this.body)}var j=g.createElement("div",{"class":"BrowserAnnotSectionShadingCol"});j.setStyle("background-color","rgba(255, 255, 255, 0)");this.elements.header.appendChild(j);this.icon=h.icon;if(h.displayInfoButton){this.elements.header.childNodes[2].setStyle("width","calc(100% - 65px)")}this.getContent=function(){return this.elements.container};this.setShadingColor=function(k){j.setStyle("background-color",k?"rgb(87, 184, 71)":"rgba(255, 255, 255, 0)")};this.clear=function(){if(this.cbPreference){a.removeEvent(this.elements.header,"onPrimaryPointerUpUnique",this.cbPreference)}};if(d[this.header]===true||d[this.header]===undefined){this.expand()}else{this.close()}},buildView:function(){this._parent();if(!this.cbPreference){var h=this;this.cbPreference=function(){var i=d[h.header];d[h.header]=i!==true&&i!==undefined};a.addEvent(this.elements.header,"onPrimaryPointerUpUnique",this.cbPreference)}}});var e=c.extend({init:function(p){this._parent(p);var h=null;var k=null,l=null,o=null,m=null;if(p.displayInExpanders){h=new f(p);k=h.getContent()}else{k=g.createElement("div",{"class":"BrowserAnnotThumbsMainContainer"});l=g.createElement("div",{"class":"BrowserAnnotThumbsTitleDiv"}).inject(k);var j=g.createElement("div",{"class":"BrowserAnnotSectionShadingCol"}).inject(l);j.setStyle("background-color","rgba(255, 255, 255, 0)");g.createElement("img",{"class":"BrowserAnnotThumbsIcon",src:p.icon}).inject(l);o=g.createElement("p",{"class":"BrowserAnnotThumbsTitle"}).inject(l);o.setStyle("width","calc(100% - 25px)");o.textContent=p.name;if(!p.childrenContainer){for(var n=0;n<p.children.length;n++){p.children[n].view.getContent().inject(k)}}else{p.childrenContainer.getContent().inject(k)}}if(p.displayInfoButton){var i=p.displayInExpanders?k.getChildren()[0].getChildren()[0]:l;m=g.createElement("p",{"class":"BrowserAnnotThumbsInfoIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-info"}).inject(i);if(i===l){o.setStyle("width","calc(100% - 40px)");m.setStyles({"padding-bottom":"5px",display:"inline - block",overflow:"hidden"})}else{m.setStyle("margin","0")}m.addEventListener("click",function(q){q.stopPropagation();p.onInfoButtonClick(p.id)})}this.getContent=function(){return k};this.updateShadingColor=function(){var q=true,r;for(r=0;r<p.children.length;r++){if(!p.children[r].view.getDisplayFlag()){q=false;break}}if(q&&p.children){for(r=0;r<p.children.length;r++){p.children[r].view.setDisplayFlag(true,true)}}this.setShadingColor(q)};this.setShadingColor=function(q){if(h){h.setShadingColor(q)}else{j.setStyles({"background-color":q?"rgb(87, 184, 71)":"rgba(255, 255, 255, 0)",top:"5px",left:"3px"})}};this.clear=function(){if(h){h.clear()}};this.updateShadingColor()}});return e});