/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/3DPlayWidget/Widget3DPlay",["DS/3DPlayWidgetModel/W3DPlayModel","DS/3DPlayWidgetViews/W3DPlayMainView","DS/3DPlayWidgetViews/W3DPlayerView","DS/3DPlayWidgetControllers/W3DPlayDDCtrl","DS/3DPlayWidgetControllers/W3DPlayPrefsCtrl","DS/3DPlayWidgetControllers/W3DPlayModelFilteringCtrl","DS/3DPlayWidgetControllers/W3DPlayIncomingMsgCtrl","css!DS/3DPlayWidget/assets/3DPlayWidget","DS/CoreEvents/Events"],function(s,a,d,r,c,q,i,h,n){var k;var o={};var f;var b=function(){o.wModel=new s(k);o.wModel.applicationFrameOptions=f;o.wView=new a(k,o.wModel);o.wPlayer=new d(k,o.wModel);o.wPlayer.applicationFrameOptions=f;o.wPCtrl=new c(k,o.wModel,o.wView);o.wDDCtrl=new r(o.wModel,o.wView);o.wFilteringCtrl=new q(o.wPlayer);o.wIncMsgCtrl=new i(o.wModel,o.wView);f&&f.widgetCB&&f.widgetCB(o);o.dispose=function(t){k.removeEvent("onRefresh",j);k.removeEvent("onLoad",b);k.removeEvent("onHide",g);k.removeEvent("onShow",l);k.removeEvent("onViewChange",p);k=null;f=null;e(t)}};var e=function(t){n.publish({event:"3DPLAY/PLAYFROMCOMPASS/DISABLE",data:{}});if(o.wModel){o.wModel.dispose(t)}o.wModel=null;if(o.wView){o.wView.dispose(t)}o.wView=null;if(o.wPlayer){o.wPlayer.dispose(t)}o.wPlayer=null;if(o.wPCtrl){o.wPCtrl.dispose(t)}o.wPCtrl=null;if(o.wDDCtrl){o.wDDCtrl.dispose(t)}o.wDDCtrl=null};var j=function(){if(!o.wPlayer.widgetRefreshHandler()){o.wView.buildCanvas();o.wView.restoreDragAndDropZone();o.wView.createBlueBackground();o.wPlayer.instantiate3DPlayWebPlayer()}};var m=function(){return navigator.userAgent.match(/(Android|iPhone|iPad)/i)?true:false};var g=function(t){if(this.fullscreen){n.publish({event:"3DPLAY/PLAYFROMCOMPASS/DISABLE",data:{}})}if(m()&&o.wModel.isLoadingFInished()){e()}};var l=function(t){if(m()){if(!o.wModel){b()}}if(this.fullscreen){setTimeout(function(){n.publish({event:"3DPLAY/PLAYFROMCOMPASS/ENABLE",data:{}})},500)}};var p=function(t){if(t.type==="maximized"||t.type==="fullscreen"){console.log("fullscreen");n.publish({event:"3DPLAY/FULLSCREEN/ENABLE",data:{}})}else{if(t.type==="windowed"){this.fullscreen=false;n.publish({event:"3DPLAY/FULLSCREEN/DISABLE",data:{}})}}};return function(t){k=t.widget;f=t.applicationFrameOptions;k.setMetas({helpPath:"3DPlayWidget/assets/help"});k.addEvent("onLoad",b);k.addEvent("onRefresh",j);k.addEvent("onHide",g);k.addEvent("onShow",l);k.addEvent("onViewChange",p);k.fullscreen=false}});