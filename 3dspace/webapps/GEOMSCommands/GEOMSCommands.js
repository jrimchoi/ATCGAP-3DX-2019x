/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/GEOMSCommands/GEOMSRestoreParamCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core"],function(d,a,c){var b=a.extend({init:function(e){this._parent(e,{mode:"shared",isAsynchronous:false,})},beginExecute:function(){this._frmWindow=this.getFrameWindow()},execute:function(){var l=this;console.log("restore");var f=function(o){o.msaResult3d.restore();o.msaResult3d.applyPeriod();console.log(o.msaResult3d.initCanvassetting)};if(typeof xCity!=="undefined"&&!!xCity){var g=xCity.get3DRootNode();var m=function(p){var o=p.parents.length?m(p.parents[0]):p;return o};var k=m(g);var n=k.getChildrenByName("Result3dNode");n.forEach(function(o){f(o)})}else{var h=l.getFrameWindow().getRootNode();var i=h.getChildByName("scene");var j=i.getChildByName("Result3dNode");f(j)}var e;if(typeof xCity!=="undefined"&&!!xCity){e=xCity.renderScene}else{e=l.getFrameWindow().getViewer().render}e()}});return b});define("DS/GEOMSCommands/GEOMSAnimateCmd",["UWA/Core","UWA/Element","DS/ApplicationFrame/Command","DS/Core/Core","DS/GEOMineSchedExperience/GEOMineSchedPlayerHelper","DS/ApplicationFrame/PlayerStyle","DS/ApplicationFrame/AfrPlayerService","DS/Controls/Popup","DS/Controls/SpinBox"],function(e,b,c,g,i,f,j,d,h){var k;var a=c.extend({init:function(l){this._parent(l,{isAsynchronous:false,mode:"exclusive"})},beginExecute:function(){var l=this;if(document.getElementsByClassName("wux-controls-playerview").length==0){k=false}else{k=true}},execute:function(){var q=this;if(k){var t={data:{source:j._playerView}};var p=j._playerView._callbacks;p.stop(t);p.exit(t)}else{var s=q.getFrameWindow();var m={};var r=s.getUIFrame();q.immersiveFrame=s.getImmersiveFrame();var l;var o;o=i.createPlayerContainer(r);o.setStyles({position:"absolute",left:"0px",right:"0px",bottom:"50px",background:"rgba(241, 241, 241, 0)"});m.style=f.SIMPLE;m.excludedElements=[13];l={};l.FrameWindow=s;m.callbacks=i.getCallbacks(l);j.createPlayer(m);j.showPlayer();var t={data:{source:j._playerView}};var p=j._playerView._callbacks;var n=new h({domId:"btnRatio",value:1,units:"x",minValue:0.1,maxValue:99.99,stepValue:0.01,pageStepValue:1});n.elements.container.setStyles({"min-width":"35px","max-width":"35px",padding:"0",margin:"0"});n.elements.inputField.setStyles({width:"35px","padding right":"0","padding left":"0",});n.elements.buttonsDiv.setStyles({visibility:"hidden",width:"0",});n.inject(j._playerView.elements.rightFixedContainer,"top");n.addEventListener("change",function(u){if(/^([0-9]{1,2}){1}(\.[0-9]{1,2})?$/.test(n.value)&&(n.value!=0)){j._playerView.geoCurrentSpeed=n.value;if(j._state.state==="play"){p.play(t)}}})}},endExecute:function(){var t=this;if(!k){var w={data:{source:j._playerView}};var s=j._playerView._callbacks;var m=j._playerView.elements.slider;var o=t.getFrameWindow().getRootNode();if(o){var p=o.getChildByName("scene");if(p){var q=p.getChildByName("Result3dNode");if(q){var u=new b("div",{id:"periodDiv",styles:{height:"10px",display:"flex","margin-right":j._playerView.elements.rightFixedContainer.offsetWidth+15,"margin-left":j._playerView.elements.leftOrBottom.offsetWidth+15,"flex-direction":"row","justify-content":"space-around",}});var v=q.msaResult3d.periods.length;for(var r=1;r<v;r++){var z=q.msaResult3d.periods[r];var x=new b("div",{id:"MSperiod"+r,"class":"wux-afr-cmdstarter",value:r,styles:{margin:"1px",width:"100%",height:"8px","background-color":"#A2CADF"}});var l=new d({target:x,trigger:"hover",position:"top",arrowBoxFlag:true,overlap:false,offset:{x:-x.getBoundingClientRect().width/2,y:-10},constraint:"screen",mouseRelativePosition:false,});l.getContent().addClassName("wux-slider-tooltip");var y=e.Element("span");y.textContent=n(z);l.setBody(y);x.addEventListener("mouseenter",function(A){l.offset.x=-A.target.getBoundingClientRect().width/2;console.log(A.target.getBoundingClientRect().width/2)});x.addEventListener("click",function(B){var C=B.target.value;var A=C/(v-1);w.data.value=A;m.value=A*100;s.slider(w)});x.inject(u)}u.inject(j._playerView.elements.container,"before");function n(B){if(B&&B.start&&B.end){var A=B.number+": "+B.start.toLocaleDateString("en-US")+" - "+B.end.toLocaleDateString("en-US");return A}else{if(j._playerView.elements.slider.value===0){return"Start of schedule"}else{if(j._playerView.elements.slider.value===100){return"End of schedule"}else{return""}}}}window.addEventListener("resize",function(){var B=j._playerView.elements.extensibleContainer;var A=B.getSize();u.style.width=A.width});j._playerView.elements.slider.getTextFromValue=function(){var A=q.msaResult3d.periods[j._playerView.geoCurrentPeriod];return n(A)}}}}s.play(w)}}});return a});define("DS/GEOMSCommands/GEOMSDisplayTooltipsCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core","DS/Selection/PSOManager","DS/CoreEvents/Events","DS/Controls/TooltipModel","DS/Controls/Tooltip"],function(h,c,g,d,a,b,f){var e=c.extend({init:function(i){this._parent(i,{isAsynchronous:true,mode:"exclusive"})},beginExecute:function(){var j=this;var i=j.getFrameWindow().elements.viewerFrame;if(!j.tooltip){j.tooltip=new f({target:i,})}if(j.tooltip){j.tooltip.hide();j.tooltip.tooltipInfos=undefined;i.tooltipInfos=undefined}j.tokenMouse=[];j.tokenAddToPSO=d.onAdd(function(l){var m=l.pathElement.getLastElement();var k="";if(m.tags&&m.tags.length){k="<div>"+m.tags.toString().replace(/\,/g,"<br>")+"</div>"}if(!i.tooltipInfos){i.tooltipInfos=new b({title:"Tags",shortHelp:k,})}if(m.tags&&m.tags.length){j.tokenMouse[m.id]=a.subscribe({event:"/VISU/onMouseMove"},function(n){var o=n.from[0].currentPosition;if(j.tooltip){j.tooltip.mousePosition=o;j.tooltip.target=i;setTimeout(function(){j.tooltip.show()},800)}})}});j.tokenRemoveFromPSO=d.onRemove(function(k){var l=k.pathElement.getLastElement();if(j.tokenMouse[l.id]){a.unsubscribe(j.tokenMouse[l.id])}if(j.tooltip){j.tooltip.hide();j.tooltip.tooltipInfos=undefined;i.tooltipInfos=undefined}})},endExecute:function(){var i=this;if(i.tokenAddToPSO){d._modelEvents.unsubscribe(i.tokenAddToPSO)}if(i.tokenRemoveFromPSO){d._modelEvents.unsubscribe(i.tokenRemoveFromPSO)}if(i.tokenMouse){i.tokenMouse.forEach(function(j){a.unsubscribe(j)})}if(i.tooltip){i.tooltip.hide();i.tooltip.tooltipInfos=undefined}}});return e});define("DS/GEOMSCommands/GEOMSMineSchedViewCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core"],function(f,a,c){var e=undefined;var d=undefined;var b=a.extend({init:function(g){this._parent(g,{mode:"shared",isAsynchronous:false,})},beginExecute:function(){this._frmWindow=this.getFrameWindow();if(this.getArguments().find(function(g){return(g.ID==="CommandArg")})!==undefined){if(this.getArguments().find(function(g){return(g.ID==="CommandArg")}).Value!==undefined){e=this.getArguments().find(function(g){return(g.ID==="CommandArg")}).Value}}if(this.getArguments().find(function(g){return(g.ID==="ValueArg")})!==undefined){if(this.getArguments().find(function(g){return(g.ID==="ValueArg")}).Value!==undefined){d=this.getArguments().find(function(g){return(g.ID==="ValueArg")}).Value}}},execute:function(){var n=this;var h=function(q){q.msaResult3d.setting(d,e);q.msaResult3d.applyPeriod()};if(typeof xCity!=="undefined"&&!!xCity){var i=xCity.get3DRootNode();var o=function(r){var q=r.parents.length?o(r.parents[0]):r;return q};var m=o(i);var p=m.getChildrenByName("Result3dNode");p.forEach(function(q){h(q)})}else{var j=n.getFrameWindow().getRootNode();var k=j.getChildByName("scene");var l=k.getChildByName("Result3dNode");h(l)}var g;if(typeof xCity!=="undefined"&&!!xCity){g=xCity.renderScene}else{g=n.getFrameWindow().getViewer().render}g()}});return b});