/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define("DS/PIMwebViewController/PIMwebItfCtrl",["UWA/Class","UWA/Core","UWA/Utils","DS/Visualization/ThreeJS_DS","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/CATWebUXSlideShow/CATWebUXSlideShowController","DS/PIMwebUX/PIMwebItfListUI","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADSettingsMgt","DS/PIMwebViewModel/PIMwebIsrMgr","DS/PIMwebUX/PIMwebOpacitySlider","DS/PADUtils/PADUtilsServices","DS/PIMwebViewModel/PIMwebUnits","DS/Windows/Panel","DS/Windows/Dialog","DS/Controls/Button","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/ModelEvents","i18n!DS/PIMwebViewController/assets/nls/PIMwebItfCtrl","i18n!DS/PIMwebUX/assets/nls/PIMwebItfListUI"],function(B,w,g,C,u,m,D,p,h,o,v,n,j,x,f,q,d,s,k,c){function l(I,F){var J,E,L,H,G,K=F.getController();if(I.length){L=K.getRootBagPath();for(J=0,E=I.length-1;J<=E;++J){H=K.getNode({id:I[J]});if(H){if(J===E){L.addElement(H)}else{G=H.getParents();if(G.length!==1){window.console.log("Instance with more than one parent!!");L=null;break}L.addElement(G[0]);L.addElement(H)}}else{L=null;break}}}return L&&L.checkExternalPath()?L:null}function b(F,J,N){var P,K,M,I,H,O=[],L;if(!J||J.length===0||!F){return O}L=o.getIsr(J[0].itfModelId).getIsrContextIDs();if(L.length===0){return O}var G=L.filter(function(Q){return N.indexOf(Q)===-1});if(G.length){return O}for(P=0,M=J.length;P<M;++P){var E=J[P];if(!E||!E.itfSca2occ){continue}if(E.itfInstance1&&E.itfInstance2){continue}I=[];H=[];if(E.itfR2Sca){for(K=0;K<E.itfR2Sca.length;++K){I.push(E.itfR2Sca[K].physicalid);H.push(E.itfR2Sca[K].physicalid)}}if(E.itfSca2occ.length>0&&E.itfSca2occ[0]&&E.itfSca2occ[0].length){for(K=0;K<E.itfSca2occ[0].length;++K){I.push(E.itfSca2occ[0][K].physicalid)}}else{I.length=0}if(E.itfSca2occ.length>1&&E.itfSca2occ[1]&&E.itfSca2occ[1].length){for(K=0;K<E.itfSca2occ[1].length;++K){H.push(E.itfSca2occ[1][K].physicalid)}}else{H.length=0}E.itfInstance1=l(I,F);E.itfInstance2=l(H,F);E.itfInstance1Label=E.itfInstance1?E.itfSca2occ[0][E.itfSca2occ[0].length-1].label:"";E.itfInstance2Label=E.itfInstance2?E.itfSca2occ[1][E.itfSca2occ[1].length-1].label:"";if(E.itfInstance1||E.itfInstance2){O.push(E)}}return O}function A(F){var E="0-"+String(F.userValue)+"-"+String(F.checkedButton);localStorage.setItem("PIMwebOpacityPref",E)}function e(){var I={userValue:10,checkedButton:0},G=localStorage.getItem("PIMwebOpacityPref");if(typeof G==="string"){var F=G.split("-"),H=Number(F[1]),E=Number(F[2]);if(typeof H==="number"){I.userValue=0<=H&&H<=100?H:I.userValue}if(typeof E==="number"){I.checkedButton=0<=E&&E<=2?E:I.checkedButton}}return I}function a(G,F,I){var H=[];if(G){var E=G.getKey();if(I.indexOf(E)===-1){if(F.some(function(J){return G.isAParentOf(J)})){G.getChildrenPathes().forEach(function(J){Array.prototype.push.apply(H,a(J,F,I))})}else{H.push(G)}}}return H}var i=(function(){var G,E;function F(J){var H,K,I={};for(H in J){if(J.hasOwnProperty(H)){switch(H){case"itfQuantifier":case"itfTolerance":K=J[H];if(typeof K==="number"){K=(K*E).toFixed(3)+G}else{K=""}I[H]=K;break;case"itfPrevAnalysis":I[H]=(J[H]==="OK"||J[H]==="KO")?J[H]:"";break;default:I[H]=J[H]}}}return I}return function(H){G=window.widget?window.widget.getValue(j.Types.Length.name):"mm";E=j.Length[G]?j.Length[G].ratio:1;G=j.Length[G]?j.Length[G].nls:"mm";return H.map(F)}})();var r=B.extend({init:function(M){var G=this,F,E=null,L=M.readOnly,H=M.cbDnD;var K=M.frameWindow.getImmersiveFrame();function I(N){require(["DS/Windows/Dialog","DS/Controls/ButtonGroup","DS/Controls/Toggle"],function(T,U,Q){var R=new T();var S=new w.Element("div",{"class":"wux-control-inline-container",style:{"vertical-align":"top"}});R.content=S;var P=new U();P.inject(S);N.forEach(function(V){P.addChild(new Q({type:"radio",label:V.label,value:V.value}))});P.addEventListener("change",function O(V){E.onShowColumnComplete(V.dsModel.value.toString());K.removeWindow(R);R.destroy()});K.addWindow(R)})}function J(){var N=d.getWebappsAssetUrl("PIMwebUX","icons/22/");F=new x({title:c.noItf,identifier:"PIMwebItfListPanel",icon:N+"I_ExamineInterference.png",immersiveFrame:K,resizableFlag:true,height:200,width:500,collapsibleFlag:true,floatableFlag:true,maximizeButtonFlag:true,horizontallyStretchableFlag:true,verticallyStretchableFlag:true,currentDockArea:WUXDockAreaEnum.BottomDockArea});F.elements.container.addClassName(F.identifier);var O={parent:F,readOnly:L,cbDnD:H};E=new D(O);H=null;E.onShowColumn=I;F.hide();F.close=function(){if(!G.onClose){window.console.log("onClose function must be provided");return}G.onClose()}}this.getTreeListViewer=function(){return E};this.show=function(){if(!F){return}F.show(true);if(F.getDockedFlag()){var O=K.getDockingElement(F.currentDockArea).getContainedWindows();if(O.length===1&&O[0].isAWindowGroup()){O[0].currentWindows=[F]}var N=K.getDockingElement(F.currentDockArea);if(N.collapseDockingZoneFlag){N.collapseDockingZoneFlag=false}}};this.hide=function(){if(F){F.hide(false)}};this.updatePanelTitle=function(N){if(!F){return}F.title=N};this.onClose=null;this.toggleReadOnly=function(){if(E){E.toggleReadOnly()}};J()}});var y=B.extend({init:function(Y){var G=this,ac,O,K={},ah=[],S=false,av,ab,Q=new s(),ap,P,F={},T,ad,af={},E,N={},aa=[],J=Y.pad3DViewer,W,Z=true,ax=false,at,I=[];function R(ay){if(N[ay]){E.remove(N[ay]);delete N[ay]}}var U=(function(){var az,aA,aG,aQ,aI,aL,aE,aO,aR=3,aD=1,ay=new C.Color(16711680),aF=new C.Color(65280),aK=new C.LineBasicMaterial({color:ay,side:C.DoubleSide,transparent:true,opacity:1,force:true,lineWidth:aR}),aC=new C.LineBasicMaterial({color:16737792,side:C.DoubleSide,transparent:true,opacity:1,force:true,lineWidth:aD}),aM="PIMwebItfGeom",aB="PIMwebItfQuantifier",aP="Clash",aJ="Clearance";function aH(aU){var aT=K[aU],aS=N[aU];if(!aT||!aT.itfInstance1||!aT.itfInstance1.checkExternalPath()||!aT.itfInstance2||!aT.itfInstance2.checkExternalPath()||!aS||!aS.children||aS.children.length!==2){return}var aV=aG.computeCurves([aT.itfInstance1],[aT.itfInstance2]);aS=aS.children[0];if(aV.clash.length){aV.clash.Segment.forEach(function(aY){var aW=aY.map(function(aZ){return new C.Vector3(aZ[0],aZ[1],aZ[2])});var aX=az.createLineNode({points:aW,material:aK});aX.setNoZ(true);aS.add(aX)})}else{aV.contact.Surface.forEach(function(aY){var aW=aY.map(function(aZ){return new C.Vector3(aZ[0],aZ[1],aZ[2])});aW.push(aW[0]);var aX=az.createLineNode({points:aW,material:aC});aS.add(aX)})}}var aN=(function(){function aT(aZ,aX,aU){var aW=new C.Vector3(aZ[0],aZ[1],aZ[2]),aV=new C.Vector3(aX[0],aX[1],aX[2]);var aY={arrowWidth:2,headLength:10,initialPoint:aW,finalPoint:aV,color:aU,head:1};return new aQ(aY)}function aS(aZ,aY,aV){var aX=new aE({position:new C.Vector3(aY[0],aY[1],aY[2]),type:"Spherical"});aX.setMatrix(new C.Matrix4().setPosition(new C.Vector3(aY[0],aY[1],aY[2])));aX.setPickable(0);aX.setNoZ(true);var aU=new aL({ratio:1});aX.addChild(aU);var aW=az.createTextNode({text:aZ,font:aO,fontSize:22,color:aV});aU.addChild(aW);return aX}return function(aY){var aX=i([K[aY]])[0],aW=N[aY];if(!aX||!aX.itfInstance1||!aX.itfInstance1.checkExternalPath()||!aX.itfInstance2||!aX.itfInstance2.checkExternalPath()||!aW||!aW.children||aW.children.length!==2){return}if(!aX.itfQuantifier||!aX.itfQtfPt1||aX.itfQtfPt1.length!==3||!aX.itfQtfPt2||aX.itfQtfPt2.length!==3){return}aW=aW.children[1];var aV=[(aX.itfQtfPt2[0]+aX.itfQtfPt1[0])*0.5,(aX.itfQtfPt2[1]+aX.itfQtfPt1[1])*0.5,(aX.itfQtfPt2[2]+aX.itfQtfPt1[2])*0.5],aU=aF;if(aX.itfSystemType===aP){aW.addChild(aT(aX.itfQtfPt2,aX.itfQtfPt1,ay,aR));aU=ay}else{if(aX.itfSystemType===aJ){aW.addChild(aT(aV,aX.itfQtfPt1,aF,aD));aW.addChild(aT(aV,aX.itfQtfPt2,aF,aD))}}aW.addChild(aS(aX.itfQuantifier,aV,aU))}})();return function(aS){if(!Array.isArray(aS)){return}if(!az){require(["DS/Visualization/SceneGraphFactory","DS/Mesh/Mesh","DS/PIMwebViewController/PIMWebViewTools","DS/SceneGraphNodes/ArrowNode","DS/Visualization/Node3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/BillBoardNode3D"],function(aT,a0,aW,aX,aZ,aV,aU){az=aT;aA=a0;aQ=aX;aI=aZ;aL=aV;aE=aU;aG=aW;var aY=document.createElement("span");aY.setAttribute("style","display: none");J.getViewer().canvas.appendChild(aY);aO=window.getComputedStyle(aY,null).getPropertyValue("font-family");J.getViewer().canvas.removeChild(aY);U(aS)});return}Object.keys(N).forEach(function(aT){if(aS.indexOf(aT)===-1){R(aT)}});if(Object.keys(N).length===0){J.getViewer().removeNode(E);E=null}if(!E){E=new aI("PIMwebDecoration");E.setPickable(aA.NODRAWHL);J.getViewer().addNode(E)}aS.forEach(function(aU){if(!N[aU]){var aT;aT=N[aU]=new aI(aU);E.add(aT);aT.add(new aI(aM));aT.add(new aI(aB));setTimeout(function(){aH(aU);aN(aU);J.getViewer().render()},0)}})}})();function an(az,ay){return Q.publish({event:az,data:ay})}function au(){if(!T){return}if(av===0){T.setVisibility(false);T.setVisibilityFree(true);T.setOpacity(null,false);T.setPickability(null)}else{if(av===100){T.setVisibility(null);T.setVisibilityFree(null);T.setOpacity(null,false);T.setPickability(null)}else{T.setVisibility(null);T.setVisibilityFree(null);T.setOpacity(av/100,true);T.setPickability("IGNORED")}}}function aw(){if(T&&ap){ap.deleteOverride(T);T=null}if(!ac||ac.getSelectedInterferences().length===0){return}var az=[],ay=[];Object.keys(F).forEach(function(aB){var aC=K[aB];if(!aC){return}[aC.itfInstance1,aC.itfInstance2].forEach(function(aE){if(aE){var aD=aE.getKey();if(ay.indexOf(aD)===-1){ay.push(aD);az.push(aE)}}})});var aA=a(J.getRootBagPath(),az,ay);T=ap.createOverride({pathes:aA});au()}function aq(){var ay,aA=J.getViewer(),az=aA.getVisibleSpace()===1?"visibleSpace":"invisibleSpace";Object.keys(F).forEach(function(aB){var aC=K[aB];if(!aC){return}[aC.itfInstance1,aC.itfInstance2].forEach(function(aE){if(aE&&aE.checkExternalPath()){var aD=aE.getBoundingSphere(aA,az);if(ay){ay.mergeWithSphere(aD,ay)}else{ay=aD}}})});if(ay&&!ay.isNaN()){ay.radius=ay.radius/1.1*1.05;J.getFrameWindow().getViewpoint().reframe(undefined,undefined,ay)}}function al(az){if(K.hasOwnProperty(az)&&!F.hasOwnProperty(az)){var ay,aB=K[az],aA=[];if(!aB){return}if(aB.itfInstance1&&aB.itfInstance1.checkExternalPath()){ay=ap.createOverride({pathes:aB.itfInstance1});ay.setColor("blue",true);aA.push(ay)}if(aB.itfInstance2&&aB.itfInstance2.checkExternalPath()){ay=ap.createOverride({pathes:aB.itfInstance2});ay.setColor("yellow",true);aA.push(ay)}if(aA.length){F[az]=aA}aw();J.getViewer().render();aq();U(ac.getSelectedInterferences())}}function L(ay){if(ay&&F.hasOwnProperty(ay)){F[ay].forEach(function(az){ap.deleteOverride(az)});delete F[ay]}aw();J.getViewer().render();aq();U(ac.getSelectedInterferences())}function V(){if(!O){return}var aD=0,aC=0,aB=0,aE;Object.keys(K).forEach(function(aI){var aG=K[aI],aH=aG.itfUserType,aF=aG.itfSystemType;if(aH==="Clash"){aD++}else{if(aH==="Contact"){aC++}else{if(aH==="Clearance"){aB++}else{if(aH==="Undefined"){if(aF==="Clash"){aD++}else{if(aF==="Contact"){aC++}else{if(aF==="Clearance"){aB++}}}}}}}});if(aD||aC||aB){aE=aD?(aD+" "+c[aD===1?"itfClash":"itfClashes"]):"";aE+=aE&&aC?" ":"";aE+=aC?(aC+" "+c[aC===1?"itfContact":"itfContacts"]):"";aE+=aE&&aB?" ":"";aE+=aB?(aB+" "+c[aB===1?"itfClearance":"itfClearances"]):""}aE=!aE?c.noItf:aE;var aA=Object.keys(af);if(aA.length){if(aA.length>1){window.console.error("More than one simulation in session???")}var ay=o.getIsr(aA[0]),az=ay?ay.getAlias():undefined;aE+=az?(" - "+az):""}O.updatePanelTitle(aE)}function X(aA){if(Z){return}var az=K[aA.id].itfModelId,ay=o.getIsr(az),aB=[],aC=function(aE){if(aE.some(function(aF){return aF.id===aA.id})){aB.forEach(function(aF){ay.unsubscribe(aF)});aB.length=0;var aD=aE.map(function(aH){var aF=ay.getInterferences(aH.id)[0],aG=K[aH.id];w.extend(aG,aF,false);return aG});if(ac){ac.updateInterferences(i(aD),{onAttributeChange:X});V()}}};aB.push(ay.subscribe("itfUpdateSuccess",aC));aB.push(ay.subscribe("itfUpdateFailed",aC));ay.updateInterference({id:aA.id,param:aA.param,newValue:aA.newValue});if(aA.param==="itfUserType"){K[aA.id].itfUserType=aA.newValue;V()}}function ao(){if(!ab){return}var ay=[WUXDockAreaEnum.TopDockArea,WUXDockAreaEnum.LeftDockArea,WUXDockAreaEnum.RightDockArea].map(function(az){var aD="0px",aF=J.getFrameWindow().getImmersiveFrame().getDockingElement(az),aC=aF.getContainedWindows();if(aC&&aC.length&&((aC[0].isAWindowGroup()&&aC[0].getEmbeddedWindows().length)||(!aC[0].isAWindowGroup()))){var aE=false,aB=aC[0].getEmbeddedWindows?aC[0].getEmbeddedWindows():aC;for(var aA=0;aA<aB.length;aA++){if(aB[aA].visibleFlag){aE=true;break}}if(aE){aD=String((aF.collapseDockingZoneFlag?0:aF.dockingZoneSize)+aF._collapserSize)+"px"}}else{if(aF.interactiveDockAreaVisibleFlag){aD=String(aF.dockingZoneSize+aF._collapserSize)+"px"}}return aD});ab.setPosition({top:ay[0],left:ay[1],right:ay[2]})}function ar(ay){if(P&&ap&&P.getSceneGraphOverrideSetIndex(ap)===-1){P.pushSceneGraphOverrideSet(ap)}ay.forEach(function(az){if(az&&!K[az.itfuid]){K[az.itfuid]=az}});if(ac){b(J,ay,W);ac.addInterferences(i(ay),{onAttributeChange:X});V()}}function ag(){Object.keys(F).forEach(function(ay){F[ay].forEach(function(az){ap.deleteOverride(az)});delete F[ay]});aw()}function H(){if(ac){var ay=Object.keys(K).map(function(az){return K[az].itfuid});ac.removeInterferences(ay)}K={};V();ag();U([]);if(at){at.setActiveState(false)}J.getViewer().render()}function aj(){var az=[],ay=o.getLoadedIsr();Object.keys(af).forEach(function(aA){az=az.concat(ay[aA].getIsrContextIDs());o.unlockIsr(aA);delete af[aA];an("onIsrRemoved",{isrLog:w.clone(af,true),removedIsr:aA})});H();if(az.length){J.removeRoots({pids:az})}}P=J.getViewer().getSceneGraphOverrideSetManager();ap=new u(J.getRootBagPath().getLastElement(true));function am(ay){if(!S){return}if(!ad){ad={isrID:[],metricID:[]};if(at){at.setActiveState(false)}setTimeout(function(){var aO=false,aI=Object.keys(af),aB,aG,aF,aE=0,aK=true,aC=false,aN,aL;if(aI.length>1){window.console.log("More than 1 interference simulation loaded. This must not be possible!!")}if(ad.isrID.length>0){if(ad.isrID.length>1){J.displayNotification({msg:k.pimSingleIsr,eventID:"info"})}aN=ad.isrID[0];var aD=ad.metricID.length;if(!af[aN]){aO=true;aj();af={};af[aN]=[]}else{if(af[aN].length===0){aK=false}}if(aK){aB=function(aP){if(aP){aC=true;if(aO){o.lockIsr(aP.isrID)}V()}if(aE===0&&aC){J.unsubscribe(aG);J.unsubscribe(aF);J.displayNotification({msg:k.itfCtrlMsgSuccess,eventID:"success"});if(aD){J.displayNotification({msg:k[aD>1?"pimMetricsIgnored":"pimMetricIgnored"],eventID:"info"})}an("onIsrAdded",{isrLog:w.clone(af,true),loadedIsr:aN})}};o.loadIsr({isrID:aN,onProgress:function(aS){if(aS.context){if(aS.context.length){var aP=aS.context;if(af[aN]&&af[aN].length){af[aN].length=0}else{aP=aS.context.filter(function(aT){return W.indexOf(aT)===-1})}if(aP.length>0){aE+=aP.length;if(!aG&&!aF){aG=J.subscribe({event:"onRootAdded"},function(){aE=0;aB()});aF=J.subscribe({event:"onRootAlreadyExisting"},function(){aE=0;aB()})}J.addRoots({objects:aP.map(function(aT){return{path:[aT]}})},true,false)}else{J.displayNotification({msg:k.itfCtrlMsgCtxAlreadyLoaded,eventID:"info"})}}else{J.displayNotification({msg:k.itfCtrlMsgNoContext,eventID:"info"})}}if(aS.itfIDs&&aS.isrID){var aR=o.getIsr(aS.isrID),aQ=aR?aR.getInterferences(aQ):null;if(aQ){ar(aQ)}}},onComplete:aB,onFailure:function(aP){J.unsubscribe(aG);J.unsubscribe(aF);af={};if(aP.step==="Simulation"){J.displayNotification({msg:k.itfCtrlMsgNotFound,eventID:"warning"})}else{J.displayNotification({msg:k.itfCtrlMsgError,eventID:"warning"})}V();var aQ={};aQ[aN]=[];an("onIsrAddFailed",aQ)}})}else{J.displayNotification({msg:k.itfCtrlMsgSimuAlreadyLoaded,eventID:"info"});var aA={};aA[aN]=[];an("onIsrAlreadyLoaded",aA)}}else{if(ad.metricID.length>0){var aJ=0,aH=[],aM=0,az=ad.metricID.length;if(aI.length){aK=!ad.metricID.every(function(aP){return aI.some(function(aQ){return af[aQ].indexOf(aP)>-1})})}if(aK){aB=function(aP){if(aP){if(aO){o.lockIsr(aP.isrID)}V()}else{if(aE!==0){return}J.unsubscribe(aG);J.unsubscribe(aF);if(aH.length){J.displayNotification({msg:k[aH.length>1?"pimMetricsLoadOK":"pimMetricLoadOK"],eventID:"success"});an("onItfAdded",{isrLog:w.clone(af,true),loadedIsr:Object.keys(af)[0],loadedMetrics:aH})}else{if(az){J.displayNotification({msg:k[az>1?"pimMetricsAlreadyLoaded":"pimMetricAlreadyLoaded"],eventID:"info"});an("onItfAlreadyLoaded")}else{an("onIsrItfNothingAdded")}}if(aM){J.displayNotification({msg:k[aM>1?"pimIgnoredMetrics":"pimIgnoredMetric"],eventID:"info"})}if(aJ){J.displayNotification({msg:k[aJ>1?"pimMetricsNoIsr":"pimMetricNoIsr"],eventID:"info"})}}};o.loadIsrFromMetrics({metrics:ad.metricID,onFilterIsr:function(aU){function aR(aV){aU.onComplete(aV)}var aS=Object.keys(aU.isrIDs);if(aS.length===0){aJ=aU.metricsWithoutIsr.length;az=0;aR([]);return}if(aI.length&&aS.indexOf(aI[0])>-1){aN=aI[0];az=aU.isrIDs[aN].itfM.length;for(aL=1;aL<aS.length;++aL){if(aS[aL]!==aN){aM+=aU.isrIDs[aS[aL]].itfM.length}}if(af[aN].length===0){aR([]);return}else{if(aU.isrIDs[aN].itfM.every(function(aV){return af[aN].indexOf(aV)>-1})){aR([]);return}}}else{aN=aS[0];az=aU.isrIDs[aN].itfM.length;for(aL=1;aL<aS.length;++aL){if(az<aU.isrIDs[aS[aL]].itfM.length){aN=aS[aL];aM+=az;az=aU.isrIDs[aS[aL]].itfM.length}else{aM+=aU.isrIDs[aS[aL]].itfM.length}}if(aI.length){var aQ,aP=new q({onClick:function(){aQ.destroy();aj();aR([aN]);aO=true;af[aN]=[]}}),aT=new q({onClick:function(){aQ.close()}});aQ=new f({identifier:"PIMwebIsrRemovePanel",modalFlag:true,title:k.pimIsrRemoveTitle,content:new w.Element("div",{html:"<p>"+(aM?k.pimIsrRemoveMsg2:k.pimIsrRemoveMsg1)+"</p><p><b>"+aU.isrIDs[aN].label+"</b></p>"}),width:350,immersiveFrame:J.getFrameWindow().getImmersiveFrame(),buttons:{Ok:aP,Cancel:aT}});aQ.addEventListener("close",function(){aM=az=0;aR([])});return}aO=true;af[aN]=[]}aR([aN])},onProgress:function(aS){if(aS.interferingParts&&aS.interferingParts.length){var aP=J.getController();for(aL=aS.interferingParts.length-1;aL>=0;--aL){if(aS.interferingParts[aL].every(function(aT){return aP.getNode({id:aT})})){aS.interferingParts.splice(aL,1)}}aE+=aS.interferingParts.length;if(aE&&!aG&&!aF){aG=J.subscribe({event:"onRootAdded"},function(){aE--;if(aE===0){aB()}});aF=J.subscribe({event:"onRootAlreadyExisting"},function(){aE--;if(aE===0){aB()}})}if(aE){J.addRoots({objects:aS.interferingParts.map(function(aT){return{path:aT}})},true,false)}}if(aS.itfIDs){var aR=o.getIsr(aS.isrID),aQ=aR.getInterferences(aS.itfIDs);ar(aQ)}if(aS.metrics){aS.metrics.forEach(function(aT){if(af[aS.isrID].indexOf(aT)===-1){af[aS.isrID].push(aT)}aH.push(aT)})}},onComplete:aB,onFailure:function(aP){J.unsubscribe(aG);J.unsubscribe(aF);if(aP&&aP.isrID&&af[aP.isrID]&&af[aP.isrID].length===0){af={}}V();J.displayNotification({msg:k[az>1?"pimMetricsLoadKO":"pimMetricLoadKO"],eventID:"warning"});an("onItfAddFailed")}})}else{J.displayNotification({msg:k[ad.metricID.length>1?"pimMetricsAlreadyLoaded":"pimMetricAlreadyLoaded"],eventID:"info"});an("onItfAlreadyLoaded")}}}ad=null},0)}if(ay.isrID){ad.isrID=ad.isrID.concat(ay.isrID)}if(ay.metricID){ad.metricID=ad.metricID.concat(ay.metricID)}}ah.push(J.subscribe({event:"onRefreshBegin"},function(){aa=w.clone(af,true)}));ah.push(J.subscribe({event:"onRefreshCompleted"},function(){var aA=Object.keys(aa);if(aA.length===1){var az={},ay=aA[0];if(Array.isArray(aa[ay])&&aa[ay].length){az.metricID=aa[ay]}else{az.isrID=ay}am(az)}}));W=J.getRoots().map(function(ay){return p.getNodeID(ay)});Array.prototype.push.apply(W,J.getController().getHiddenRootIds());ah.push(J.subscribe({event:"onRootAdded"},function(az){if(W.indexOf(az.id)===-1){W.push(az.id)}var ay=Object.keys(K).map(function(aA){return K[aA]});ay=b(J,ay,W);if(ac){ac.updateInterferences(i(ay),{onAttributeChange:X});V()}}));ah.push(J.subscribe({event:"onRootRemoved"},function(az){var ay=W.indexOf(az.id);if(ay!==-1){W.splice(ay,1)}var aA=o.getLoadedIsr();Object.keys(aA).forEach(function(aB){var aC=aA[aB].getIsrContextIDs();if(aC.indexOf(az.id)>-1){o.unlockIsr(aB);delete af[aB];H();an("onIsrRemoved",{isrLog:w.clone(af,true),removedIsr:aB})}})}));ah.push(J.subscribe({event:"onRootAttached"},function(aA){if(!ac){return}var aB=o.getLoadedIsr();if(aA.id&&Object.keys(aB).some(function(aD){var aC=aB[aD].getIsrContextIDs();return aC.indexOf(aA.id)!==-1})){var az=[],ay;Object.keys(K).forEach(function(aC){az.push(K[aC])});ay=b(J,az,W);if(ac&&ay){ac.updateInterferences(i(ay),{onAttributeChange:X});V()}ac.getSelectedInterferences().forEach(function(aC){al(aC)})}}));ah.push(J.subscribe({event:"onRootDetached"},function(ay){var az=o.getLoadedIsr();if(ay.id&&Object.keys(az).some(function(aB){var aA=az[aB].getIsrContextIDs();return aA.indexOf(ay.id)!==-1})){ag();U(ac.getSelectedInterferences());J.getViewer().render()}}));ah.push(J.subscribe({event:"onEndDelete"},(function(){function ay(aA,aB){if(!aA||!aB){return false}for(var az=2;az<aB.externalPath.length;az+=2){if(aA===aB.externalPath[az]){return true}}return false}return function(aA){var az=[],aB=aA.pathToReparent;Object.keys(K).forEach(function(aD){var aE=K[aD],aC=false;if(aE.itfInstance1&&ay(aB,aE.itfInstance1)){aE.itfInstance1=undefined;aE.itfInstance1Label=undefined;aC=true}if(aE.itfInstance2&&ay(aB,aE.itfInstance2)){aE.itfInstance2=undefined;aE.itfInstance2Label=undefined;aC=true}if(aC){R(aD);az.push(aE)}});az.forEach(function(aC){K[aC.itfuid]=aC});if(ac){ac.updateInterferences(i(az),{onAttributeChange:X});V()}}})()));function ae(){if(ab){return}var ay=e();ay.parent=J.getFrameWindow().getUIFrame();av=ay.checkedButton===2?100:ay.checkedButton===1?0:ay.userValue;ab=new v(ay);ab.onOpacityChange=function(az){A(az);av=az.newValue;au();J.getViewer().render()};J.getFrameWindow().getImmersiveFrame().addEventListener("freeZoneResize",ao)}function M(){if(ac){return}function az(aF){aF.stopPropagation()}var aD=["dragenter","dragover","drop"];function ay(){var aF=J.getViewer().canvas,aG=J.getFrameWindow().getImmersiveFrame();aD.forEach(function(aH){aF.addEventListener(aH,az);aG.addEventListener(aH,az)});return true}function aA(){var aF=J.getViewer().canvas,aG=J.getFrameWindow().getImmersiveFrame();aD.forEach(function(aH){aF.removeEventListener(aH,az);aG.addEventListener(aH,az)});return true}function aC(aG,aI){if(!ac||!aI){return false}var aH={protocol:"3DXContent",version:"1.1",data:{items:[]},source:window.widget&&window.widget.getValue("x3dAppId")?window.widget.getValue("x3dAppId"):"ENOI3D_AP",widgetId:window.widget?window.widget.id:undefined},aF=[];ac.getSelectedInterferences().forEach(function(aK){var aJ=K[aK];if(aF.indexOf(aJ.mID)===-1){aF.push(aJ.mID);aH.data.items.push({envId:n.getPlatformId(),serviceId:"3DSpace",contextId:h.getSetting("pad_security_ctx")?h.getSetting("pad_security_ctx"):undefined,objectId:aJ.mID,objectType:aJ.mType,displayName:aJ.itfMetricName})}});aG.dataTransfer.setData("Text",JSON.stringify(aH));ay();return true}O=new r({frameWindow:J.getFrameWindow(),readOnly:Z,cbDnD:{onDragStartCell:aC,onDragOverCell:az,onDragEndCell:aA,onDragEnterBlank:az,onDragLeaveBlank:az,onDragOverBlank:az,onDragStartColumnHeader:ay,onDragEndColumnHeader:aA}});O.onClose=function(){G.hideGUX();an("onItfListClosed")};ac=O.getTreeListViewer();ac.onSelect=al;ac.onUnselect=L;var aE=Object.keys(K);if(aE.length>0){var aB=[];aE.forEach(function(aF){aB.push(K[aF])});ar(aB)}}function ai(){if(at){return}function ay(aC){if(typeof aC!=="number"){return false}var aA=ac.getNumberOfRows(),az=aC<0?aA-1:aC>=aA?0:aC;if(az<0||az>=aA){window.console.log("No interference in list for slide show");return false}ac.selectRows([az]);var aB=ac.getSelectedInterferences();if(aB.length===1){at.displaySlideInformation({message:K[aB[0]].itfCtxName+" ("+(az+1)+" / "+aA+") "})}return true}at=m.getSlideShowController({context:J.getFrameWindow(),id:"PIMwebSlideShow",params:{activateRotation:true}});I.push(at.subscribe("onPreviousSlideCB",function(){var aA=ac.getSelectedRows(),az=aA&&aA.length?aA.length>1?aA[0]:aA[0]-1:0;ay(az)}));I.push(at.subscribe("onNextSlideCB",function(){var aA=ac.getSelectedRows(),az=aA&&aA.length?aA.length>1?aA[0]:aA[0]+1:0;ay(az)}));I.push(at.subscribe("onFirstSlideCB",function(){ay(0)}));I.push(at.subscribe("onLastSlideCB",function(){ay(ac.getNumberOfRows()-1)}));I.push(at.subscribe("onActiveStateModified",function(az){if(az.state&&Object.keys(af).length===0){az.onBeginSlideShow(false);return}if(az.state){az.onBeginSlideShow(true)}var aB=J.getViewer();J.setDefaultContextualBarVisibility(!az.state);J.setDefaultContextualMenuVisibility(!az.state);if(az.state){if(ax){O.hide()}else{M();ae();ab.show();if(E){E.setVisibility(true);E.setVisibilityFree(false)}P.pushSceneGraphOverrideSet(ap);aB.render()}aB.setPicking({activated:false,trapSelection:false});require("DS/ApplicationFrame/CommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",J.getCommandContext()).disable();var aA=ac.getSelectedRows();ay(!aA||!aA.length?0:null)}else{if(ax){O.show()}else{ab.hide();if(E){E.setVisibility(false);E.setVisibilityFree(true)}P.removeSceneGraphOverrideSet(ap);aB.render()}aB.setPicking({activated:true,trapSelection:true});require("DS/ApplicationFrame/CommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",J.getCommandContext()).enable()}}))}this.load=am;this.clearIsr=aj;this.showGUX=function(){ax=true;if(!S){return}ae();ab.show();M();O.show();if(E){E.setVisibility(true);E.setVisibilityFree(false)}if(P&&ap&&P.getSceneGraphOverrideSetIndex(ap)===-1){P.pushSceneGraphOverrideSet(ap);J.getViewer().render()}ao()};function ak(){if(O){O.hide()}if(ab){ab.hide()}if(E){E.setVisibility(false);E.setVisibilityFree(true)}P.removeSceneGraphOverrideSet(ap);J.getViewer().render()}this.hideGUX=function(){if(!ax){return}ax=false;ak()};this.activate=function(ay){if(S){return}S=true;if(Z!==Boolean(ay.readOnly)){Z=Boolean(ay.readOnly);if(O){O.toggleReadOnly()}}J.setLoadingDelegations({_SIMItfSimulation:function(az){n.multiTenantMgt([az],p.getRoots(J),function(aA){if(!aA.isMultiTenant){am({isrID:[az.objectId]})}})},_PLMPIMMetricReference:function(az){n.multiTenantMgt([az],p.getRoots(J),function(aA){if(!aA.isMultiTenant){am({metricID:[az.objectId]})}})}});if(ax){G.showGUX()}ai()};this.deactivate=function(){if(!S){return}S=false;J.setLoadingDelegations({_SIMItfSimulation:undefined,_PLMPIMMetricReference:undefined});ak();I.forEach(function(ay){at.unsubscribe(ay)});I=[];m.unreferenceSlideShowController({context:J.getFrameWindow(),id:"PIMwebSlideShow"});at=null};this.subscribe=function(az,ay){if(!az||!ay){return null}return Q.subscribe({event:az},ay)};this.unsubscribe=function(ay){if(ay===null||ay===undefined){return undefined}return Q.unsubscribe(ay)};this.destroy=function(){if(ab){ab.destroy()}ab=null;ah.forEach(function(ay){J.unsubscribe(ay)});aj();J=null}}});var t=[],z=function(E){if(!E||!E.pad3DViewer){return null}var F;t.some(function(G){return(G.pad3DViewer===E.pad3DViewer)?(F=G.enveloppe):false});return F};return B.singleton({init:function(){},giveItfCtrl:function(E){return z(E)},getItfCtrl:function(G){if(!G||!G.pad3DViewer){return null}var H=z(G);if(!H){var F=new y({pad3DViewer:G.pad3DViewer}),E={load:function(){return F?F.load.apply(null,arguments):undefined},activate:function(){return F?F.activate.apply(null,arguments):undefined},deactivate:function(){return F?F.deactivate.apply(null,arguments):undefined},showGUX:function(){return F?F.showGUX.apply(null,arguments):undefined},hideGUX:function(){return F?F.hideGUX.apply(null,arguments):undefined},clearIsr:function(){return F?F.clearIsr.apply(null,arguments):undefined},subscribe:function(){return F?F.subscribe.apply(null,arguments):undefined},unsubscribe:function(){return F?F.unsubscribe.apply(null,arguments):undefined},dereference:function(){if(!F){return}F.deactivate();F.destroy.apply(null,arguments);F=null;t.some(function(J,I){if(J.enveloppe===E){t.splice(I,1);E=null;return true}})}};Object.freeze(E);t.push({pad3DViewer:G.pad3DViewer,enveloppe:E});H=E}return H}})});define("DS/PIMwebViewController/PIMWebViewTools",["DS/WebPolyMaths/WebMeshIntersection","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebToolsMeasure","DS/WebPolyMaths/WebMeshRecognition","DS/WebPolyMaths/WebMathsVector3D","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],function(n,x,w,l,i,r,k){var m=0.001,u=m*m,f=function(){this.clash=[];this.contact=[];this.isClash=false};f.prototype={constructor:f,concat:function(z){if(this.clash.length===0){this.clash=z.clash}else{if(z.clash.length>0){Array.prototype.push.apply(this.clash,z.clash)}}if(this.contact.length===0){this.contact=z.contact}else{if(z.contact.length>0){Array.prototype.push.apply(this.contact,z.contact)}}}};function t(D,C){var B=D[0]-C[0],A=D[1]-C[1],z=D[2]-C[2];return Math.sqrt(B*B+A*A+z*z)}function j(C,A){var B=0,z=A.length,D;for(;B<z;++B){D=A[B];if(r.areEqual(C,D.item||D)){return true}}return false}function a(D,C){var B=0,z=C.length,A;for(;B<z;++B){A=C[B];if(A.type===w.GeometryType.LINE&&j(A.item[0],D.item)&&j(A.item[1],D.item)){return true}}return false}function v(z,B){var G=r.sub(B[2],B[0]);var E=r.sub(B[1],B[0]);var D=r.sub(z,B[0]);var C=[r.dot(G,G),r.dot(G,E),r.dot(G,D),r.dot(E,E),r.dot(E,D)];var A=1/(C[0]*C[3]-C[1]*C[1]);var H=(C[3]*C[2]-C[1]*C[4])*A;var F=(C[0]*C[4]-C[1]*C[2])*A;return(H>=0)&&(F>=0)&&(H+F<=1+u)}function p(C,B){var E=[],A=0,z=C.length,D;for(;A<z;++A){D=C[A];if(v(D,B)){E.push({type:w.GeometryType.POINT,item:D})}}return E}function c(D,C){var B=t(D,C[0]);var A=t(D,C[1]);var z=t(C[0],C[1]);return(Math.abs(z-(B+A))<=m)}function q(B){var C=0,D,A,z;for(;C<B.length;++C){A=B[C];for(D=C+1;D<B.length;++D){z=B[D];if(j(z[0],A)&&j(z[1],A)&&j(z[2],A)){B.splice(D,1);--D}}}}function b(C,A,B){var G={};var E=r.sub(C[1],C[0]);var z,F,D=r.dot(B,E);if(D!==0){F=r.dot(B,A)-r.dot(B,C[0]);z=F/D;if(Math.abs(z)>=0&&Math.abs(z)<=1){G={type:w.GeometryType.POINT,item:r.multiplyAndAdd(E,z,C[0])}}}else{G={type:w.GeometryType.LINE,item:C}}return G}function y(D,B,A){var H=[],C=[];if(c(D[0],B)&&c(D[1],B)){H.push({type:w.GeometryType.LINE,item:D})}else{if(c(B[0],D)&&c(B[1],D)){H.push({type:w.GeometryType.LINE,item:B})}else{if(c(D[0],B)){C.push(D[0])}else{if(c(D[1],B)){C.push(D[1])}}if(c(B[0],D)){C.push(B[0])}else{if(c(B[1],D)){C.push(B[1])}}if(C.length===2){if(r.areEqual(C[0],C[1])){H.push({type:w.GeometryType.POINT,item:C[0]})}else{H.push({type:w.GeometryType.LINE,item:C})}}else{if(C.length===1){if(A){H.push({type:w.GeometryType.POINT,item:C[0]})}}else{var J=r.sub(D[1],D[0]);var I=r.sub(B[1],B[0]);var K=r.sub(B[0],D[0]);var Q=r.dot(J,J);var P=r.dot(J,I);var O=r.dot(I,I);var N=r.dot(J,K);var M=r.dot(I,K);var L=(Q*O)-(P*P);if(L===0){}else{var z=(P*M-O*N)/L;var G=(Q*M-P*N)/L;if((Math.abs(z)>=0&&Math.abs(z)<=1)&&(Math.abs(G)>=0&&Math.abs(G)<=1)){var F=r.multiplyAndAdd(J,z,D[0]);var E=r.multiplyAndAdd(I,G,B[0]);if(r.areEqual(F,E)){if(c(F,D)&&c(F,B)){H.push({type:w.GeometryType.POINT,item:F})}}}}}}}}return H}function s(A,z){var B=[];Array.prototype.push.apply(B,y([A[0],A[1]],z));Array.prototype.push.apply(B,y([A[0],A[2]],z));Array.prototype.push.apply(B,y([A[1],A[2]],z));return B}function d(L,I){var z=[],F;var J=p(L,I);if(J.length===3){return[{type:w.GeometryType.SURFACE,item:L}]}var E=p(I,L);if(E.length===3){return[{type:w.GeometryType.SURFACE,item:I}]}E.forEach(function(Q){if(!j(Q.item,J)){J.push(Q)}});var O=[];var A=[];var M=[[L[0],L[1]],[L[1],L[2]],[L[2],L[0]]];var K=[[I[0],I[1]],[I[1],I[2]],[I[2],I[0]]];var H=function(Q){if(r.areEqual(Q,E.item)){return}if(j(Q,J)){var R={type:w.GeometryType.LINE,item:[Q,E.item]};if(!a(R,z)){z.push(R)}}};var D=0;for(;D<M.length;D++){A=[];var C=0;for(;C<K.length;C++){E=y(M[D],K[C],true);if(E.length!==0){E=E[0];if(E.type===w.GeometryType.LINE){A=[E];O.push({type:w.GeometryType.POINT,item:E.item[0]});O.push({type:w.GeometryType.POINT,item:E.item[1]});if(!a(A[0],z)){z.push(A[0])}C=K.length}else{if(!j(E.item,O)){O.push(E);A.push(E);if(J.length!==0){[M[D][0],K[C][0]].forEach(H);[M[D][1],K[C][1]].forEach(H)}}}if(A.length===2){F=[A[0].item,A[1].item];if(r.subAndSquaredLength(M[D][0],A[1].item)<r.subAndSquaredLength(M[D][0],A[0].item)){F=[A[1].item,A[0].item]}A=[{type:w.GeometryType.LINE,item:F}];if(!a(A[0],z)){z.push(A[0])}C=K.length}}}}if(J.length===2){F={type:w.GeometryType.LINE,item:[J[0].item,J[1].item]};if(!a(F,z)){z.push(F)}}else{if(J.length===1&&z.length===0){z=[{type:w.GeometryType.POINT,item:J[0]}]}}var G=[];O=[];var N;if(z.length>1){var B=z.splice(0,1)[0];O.push(B.item[0],B.item[1]);N=B.item[1];var P;while(!r.areEqual(O[0],N)){P=null;for(D=0;(D<z.length)&&!P;D++){if(r.areEqual(z[D].item[0],N)){P=z.splice(D,1)[0].item[1]}else{if(r.areEqual(z[D].item[1],N)){P=z.splice(D,1)[0].item[0]}}}if(!P){P=(z.length!==0)?z[0].item[0]:O[0]}N=P;O.push(N)}if(O.length>=3){G=[{type:w.GeometryType.SURFACE,item:O}]}}else{G=z}return G}function e(A,z){var B=new f;if(A.type===w.GeometryType.LINE&&A.type===z.type){B.clash=y(A.item,z.item)}else{if(A.type===w.GeometryType.LINE&&z.type===w.GeometryType.SURFACE){B.clash=s(z.item,A.item)}else{if(A.type===w.GeometryType.SURFACE&&z.type===w.GeometryType.LINE){B.clash=s(A.item,z.item)}else{if(A.type===w.GeometryType.SURFACE&&z.type===w.GeometryType.SURFACE){B.clash=d(A.item,z.item)}else{if(A.type===w.GeometryType.LINE&&z.type===w.GeometryType.POINT){if(c(z.item[0],A.item)){B.clash=[z]}}else{if(A.type===w.GeometryType.POINT&&z.type===w.GeometryType.LINE){if(c(A.item[0],z.item)){B.clash=[A]}}}}}}}return B}function h(D,C,B,K,H){var z;var F=[];var A=[];var J=[];var E=[D,C,B];var I,G;G=r.dot(H,K);E.forEach(function(L){I=(r.dot(H,L)-G);if(I>m){F.push(L)}else{if(I<-m){A.push(L)}else{J.push(L)}}});if(J.length===3){z={type:w.GeometryType.SURFACE,item:[D,C,B],overThePlane:3}}else{if(J.length===2){z={type:w.GeometryType.LINE,item:J,overThePlane:2}}else{if(J.length===1&&F.length===1&&A.length===1){z={type:w.GeometryType.LINE,item:[J[0],b([F[0],A[0]],K,H).item],overThePlane:1}}else{if(J.length===1&&(F.length===2||A.length===2)){z={type:w.GeometryType.POINT,item:[J[0]],overThePlane:1}}else{if(F.length===1&&A.length===2){z={type:w.GeometryType.LINE,item:[b([F[0],A[0]],K,H).item,b([F[0],A[1]],K,H).item]}}else{if(F.length===2&&A.length===1){z={type:w.GeometryType.LINE,item:[b([A[0],F[0]],K,H).item,b([A[0],F[1]],K,H).item]}}}}}}}return z}function g(S,M,R,J){if(!S||!S.group||!S.group.geometry||S.start===undefined||S.count===undefined||S.count<=0){return[]}if(!R||!R.group||!R.group.geometry||R.start===undefined||R.count===undefined||R.count<=0){return[]}if(S.group.glType!==4||R.group.glType!==4){return[]}var F=new f;var L=S.count;var z=i.extractMeshVertices(S,M.elements);var K=R.count;var W=i.extractMeshVertices(R,J.elements);var I,P,O,N,H,D,B,A,E,C,V,T,G,Q,U;for(G=0;G<L;){P=z[G++];O=z[G++];N=z[G++];I=[P,O,N];V=r.cross(r.sub(O,P),r.sub(N,P));for(Q=0;Q<K;){D=W[Q++];B=W[Q++];A=W[Q++];H=[D,B,A];T=r.cross(r.sub(B,D),r.sub(A,D));E=h(P,O,N,D,T);C=h(D,B,A,P,V);if(E&&C){U=e(E,C);if(U&&U.clash.length){if(E.overThePlane>1||C.overThePlane>1){U.contact=[{type:w.GeometryType.SURFACE,item:I},{type:w.GeometryType.SURFACE,item:H}]}else{if(U.clash.length===1&&U.clash[0].type===w.GeometryType.POINT){U.contact=[{type:w.GeometryType.SURFACE,item:I},{type:w.GeometryType.SURFACE,item:H}]}}if(!F.isClash&&U.clash.length&&U.contact.length===0){F.isClash=true}F.concat(U)}}}}return F}function o(H,F){var K=new f,Z=2*u;var J=H,I=F,X,W=[],V=[],R,P,B,A,O,M,D,L,U,z,T=J.length;for(L=0;L<T;L++){O=J[L].getLastElement(true);M=I[L].getLastElement(true);R=l.retrieveProductAABB(O,J[L].getWorldMatrix());P=l.retrieveProductAABB(M,I[L].getWorldMatrix());D=x.computeAABBSquaredDistance(R,P);if(D<Z){B=k.is3DLeaf(O);A=k.is3DLeaf(M);if(B&&A){W.push({part:O,pathElement:J[L],AABB:R});V.push({part:M,pathElement:I[L],AABB:P})}}}var C=W.length,Q,N,S,Y,E,G;for(L=0;L<C;L++){N=l.retrievePartPrimitivesAndAABB(W[L].pathElement);Y=W[L].pathElement.getWorldMatrix();S=l.retrievePartPrimitivesAndAABB(V[L].pathElement);E=V[L].pathElement.getWorldMatrix();G=new f;X=false;for(U=0;U<N.primitives.length;U++){D=x.computeAABBSquaredDistance(N.AABB[U],V[L].AABB);if(D<u){for(z=0;z<S.primitives.length;z++){D=x.computeAABBSquaredDistance(N.AABB[U],S.AABB[z]);if(D<u){Q=g(N.primitives[U],Y,S.primitives[z],E);if(Q.isClash){X=true}G.concat(Q)}}}}if(!X){G.clash=[]}else{G.contact=[]}K.concat(G)}K.clash.Segment=[];K.contact.Segment=[];K.clash.Surface=[];K.contact.Surface=[];K.clash.forEach(function(aa){if(aa.type===w.GeometryType.LINE){K.clash.Segment.push(aa.item)}else{if(aa.type===w.GeometryType.SURFACE){K.clash.Surface.push(aa.item)}}});K.contact.forEach(function(aa){if(aa.type===w.GeometryType.LINE){K.contact.Segment.push(aa.item)}else{if(aa.type===w.GeometryType.SURFACE){K.contact.Surface.push(aa.item)}}});n._mergePolylines(K.clash.Segment);q(K.contact.Surface);return K}return Object.freeze({computeCurves:o})});define("DS/PIMwebViewController/PIMwebInteferenceListCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext"],function(c,b){var a=c.extend({init:function(d){this._parent(d);var g=this,e,f;require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(h){e=h.getItfCtrl({pad3DViewer:b.get()});f=e.subscribe("onItfListClosed",function(){if(g){g.setState(false)}});g.setState(localStorage.getItem("PIMwebItfListVisPref")==="1")});this.onStateChange(function(){if(!e||!g){return}var h=g.getState();if(h){e.showGUX()}else{e.hideGUX()}localStorage.setItem("PIMwebItfListVisPref",h?"1":"0")});this._destroy=function(){if(e){e.subscribe(f)}e=g=f=null;var h=Object.getPrototypeOf(this);if(h._destroy){h._destroy.apply(this,arguments)}}}});return a});