define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices",["DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/TreeModel/DataModelSet","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],function(a,h,e,d,g,c,b){var f={processAttachedModels:function(m){var k=[];var n=m.contexts.content.results;for(var l=0;l<n.length;l++){var i={};i.displayName="";i.name="";i.revision="";i.physicalId=n[l].physicalID;for(var j=0;j<n[l].data.length;j++){if(n[l].data[j].name=="Marketing Name"){i.displayName=n[l].data[j].value[0]}}for(var j=0;j<n[l].basicData.length;j++){if(n[l].basicData[j].name=="name"){i.name=n[l].basicData[j].value[0]}}k.push(i)}return k},buildFeature:function(j,i){return'<Feature Type = "ConfigFeature" Name = "'+j.replace(/&(?!amp;)/g,"&amp;")+'">'+i+"</Feature>"},buildOption:function(i){return'<Feature Type = "ConfigFeature" Name = "'+i.replace(/&(?!amp;)/g,"&amp;")+'"/>'},buildContext:function(j,i){return'<Context HolderType = "Model" HolderName = "'+j.replace(/&(?!amp;)/g,"&amp;")+'">'+i+"</Context>"},buildGlobalExpression:function(i){return'<CfgEffectivityExpression xs:schemaLocation = "urn:com:dassault_systemes:config CfgEffectivityExpression.xsd" xmlns:xs = "http://www.w3.org/2001/XMLSchema-instance" xmlns = "urn:com:dassault_systemes:config"><Expression Domain="ConfigChange_Variant">'+i+"</Expression></CfgEffectivityExpression>"},getFilterablesVariantGrid:function(l,i){var k=[];for(var j=0;j<i.length;j++){k.push({instancePID:i[j].instanceId})}var m=new Promise(function(s,r){var q={version:"1.0",mode:"Display",modelPID:l,withBinaries:"NO",instances:k,modelMask:"",featureMask:"Read",optionMask:"Read"};var o="/resources/modeler/configuration/navigationServices/getFilterablesVariantGrid";var p=JSON.stringify(q);var t=function(u){s(u)};var n=function(u){r(u)};d.makeWSCall(o,"POST","enovia","application/json",p,t,n,true)});return m},loadDictionary:function(k,j){var i=this;var l=new Promise(function(p,o){var m="/resources/modeler/browsing/browseservice/pid:"+k.get("id")+"/configurationdictionary?cloudView=1&features=1";var q=function(r){p(r)};var n=function(r){console.log("fail to get dictionary")};d.makeWSCall(m,"POST","enovia","json","",q,n,true)});l.then(function(n){var o=i.processDictionary(n);k.set("dictionary",o);var m=i.createDictionaryTreeDocument(o);k.set("treeDocumentVariantView",m);j(k.get("id"))})},processDictionary:function(o){var i=[];for(var n=0;n<o.features.length;n++){var k=o.features[n];var j={name:k.name,displayName:k.displayValue,revision:k.revision,options:[],type:k.type,selectionType:k.selectionType,check:false,physicalID:k.id.replace("pid:","")};if(k.current!="Preliminary"){for(var m=0;m<k.options.length;m++){var l=k.options[m];j.options.push({name:l.name,displayName:l.displayValue,type:l.type_NLS,selectionType:k.selectionType,check:false,physicalID:l.id.replace("pid:","")})}i.push(j)}}return i},createDictionaryTreeDocument:function(i){var o=new e();var k=new a({dataModelSet:o});k.prepareUpdate();for(var n=0;n<i.length;n++){var q=i[n];var j=new h({label:q.displayName,grid:{name:q.name,type:q.type,checkbx:false},data:{self:q,feature:q}});k.addRoot(j);for(var m=0;m<q.options.length;m++){var l=q.options[m];var p=new h({label:l.displayName,grid:{name:l.name,type:l.type,checkbx:false},data:{self:l,feature:q}});j.addChild(p)}}k.expandAll();k.pushUpdate();return k},setEffectivity:function(o,j,l,m){this.numberOfModifiedInstances=j;f.unsetEffectivitySuccessfulCount=0;f.unsetEffectivityFailedCount=0;f.effectivityExpression=[];f.unsetEffectivityExpression=[];f.PADContext=m;var i=[];f.instanceIds=Object.keys(o);for(var n=0;n<f.instanceIds.length;n++){if(j.indexOf(o[f.instanceIds[n]].data.instance.instanceId)!=-1){var k={};k.pid=o[f.instanceIds[n]].data.instance.instanceId;k.expressions=[{domain:"variant",content:o[f.instanceIds[n]].xml}];if(o[f.instanceIds[n]].xml!=""){f.effectivityExpression.push(k)}else{f.unsetEffectivityExpression.push(k)}}}if(f.unsetEffectivityExpression.length==0&&f.effectivityExpression.length==0){d.showwarning(b.CFG_Edit_Effectivity_AllSuccessful,"success");l()}var i=[];for(var n=0;n<f.unsetEffectivityExpression.length;n++){i.push(this._unsetEffectivity(f.unsetEffectivityExpression[n],l))}if(f.effectivityExpression.length!=0){this._setEffectivity(f.effectivityExpression,l)}},_refreshGridForUnsetEffectivity:function(l){var j=f.PADContext.get().getPADTreeDocument().getSelectedNodes();for(var i=0;i<j.length;i++){var k=" ";var m=j[i].options.relationid;if(l.availableVariantList.indexOf(m)>=0||l.availableVariantAndEvolutionList.indexOf(m)>=0||l.availableEvolutionList.indexOf(m)>=0){k=g.CFG_EFFECTIVITY_YES}else{k=g.CFG_EFFECTIVITY_NO}if(f.emptyInstanceID.indexOf(m)>=0){j[i].updateOptions({grid:{Effectivity:k,VariantEffectivity:" "}})}}},_refreshGridForSetEffectivity:function(m){var k=f.PADContext.get().getPADTreeDocument().getSelectedNodes();for(var i=0;i<k.length;i++){var l=k[i].options.relationid;if(m.expressions[l]!=undefined&&m.expressions[l].hasEffectivity=="NO"){k[i].updateOptions({grid:{Effectivity:g.CFG_EFFECTIVITY_NO,VariantEffectivity:" "}})}if(m.expressions[l]!=undefined&&m.expressions[l].hasEffectivity=="YES"){var j="";if(m.expressions[l].content.Variant!==null&&m.expressions[l].content.Variant!==undefined){j=m.expressions[l].content.Variant;j=j==null||""?" ":j.replace(/[\r\n]+/g," ");k[i].updateOptions({grid:{Effectivity:g.CFG_EFFECTIVITY_YES,VariantEffectivity:j}})}}}},_unsetEffectivity:function(i,k){var j=this;var l=new Promise(function(t,w){var s=function(x){if(x.unset!=undefined&&x.unset.Variant!=undefined&&x.unset.Variant.status!=undefined&&x.unset.Variant.status=="Error"){f.unsetEffectivityFailedCount++}else{f.unsetEffectivitySuccessfulCount++}if(f.unsetEffectivityExpression.length==f.unsetEffectivitySuccessfulCount+f.unsetEffectivityFailedCount){f.emptyInstanceID=[];f.unsetEffectivityExpression.forEach(function(z){f.emptyInstanceID.push(z.pid)});var y=d.getAvailableDemainDetails(f.emptyInstanceID,f.PADContext);y.then(function(z){f.PADContext.get().getPADTreeDocument().withTransactionUpdate(function(){j._refreshGridForUnsetEffectivity(z,f.PADContext)})});k();if(f.effectivityExpression==0){d.showwarning(b.CFG_Edit_Effectivity_AllSuccessful,"success")}}t(x)};var p=function(x){f.emptyFailedList++;if(f.unsetEffectivityExpression.length==f.unsetEffectivitySuccessfulCount+f.emptyFailedList){k();if(f.effectivityExpression==0){d.showwarning(b.CFG_Edit_Effectivity_AllFailed,"error")}}w(x)};var o=" ";o={version:"1.0",pid:i.pid,unset:["Variant"]};var m="/resources/modeler/configuration/authoringServices/unsetFilterableObjectInfo";var v=JSON.stringify(o);var n=[];var q=c.get();if(q&&q.AuthoringContextHeader){for(var r in q.AuthoringContextHeader){n.push({key:r,value:q.AuthoringContextHeader[r]})}}var u=null;if(n.length>0){u={operationheader:{key:n[0].key,value:n[0].value}}}d.makeWSCall(m,"POST","enovia","json",v,s,p,true,u)});return l},_setEffectivity:function(i,j){var k=this;var l=new Promise(function(t,v){var s=function(x){k._refreshGridForSetEffectivity(x);j();d.showwarning(b.CFG_Edit_Effectivity_AllSuccessful,"success");t(x)};var p=function(x){j();d.showwarning(b.CFG_Edit_Effectivity_AllFailed,"error");v(x)};var o=[];var q=c.get();if(q&&q.AuthoringContextHeader){for(var r in q.AuthoringContextHeader){o.push({key:r,value:q.AuthoringContextHeader[r]})}}var w=null;if(o.length>0){w={operationheader:{key:o[0].key,value:o[0].value}}}var m="/resources/modeler/configuration/authoringServices/setMultipleFilterableObjectInfo?traces=0&perfo=0 HTTP/1.1";var n={version:"1.1",expression:{output:{domains:"Variant",view:"Current",targetFormat:"TXT",withDescription:"YES"},contentFormat:"XML",expressionList:i,dictionary:{version:"0.1",idList:[{pid:"pid1"},{pid:"pid2"}],format:"xml",content:"< dictionary content for the effectivity definitions>"}}};var u=JSON.stringify(n);d.makeWSCall(m,"POST","enovia","application/json",u,s,p,true,w)});return l},isKarmaOdtMode:function(){if(window.__karma__!==undefined){return true}else{return false}}};return f});define("DS/CfgMassVariantEffectivityEditor/scripts/CfgTweakerTristate",["UWA/Core","DS/Tweakers/TweakerBase","DS/Utilities/Dom","DS/Utilities/Utils","DS/Core/PointerEvents"],function(c,i,d,f,e){var b=i.inherit({name:"TweakerTristate",publishedProperties:{value:{defaultValue:false,type:"boolean",advancedSetter:true},valueType:{defaultValue:"boolean",type:"string"},displayStyle:{defaultValue:"checkbox",type:"string"}},computeTweakerContentLength:function(){return this._getCurrentTouchMode()?19:14},_upgradeValue:function(j){if(j==="1"||j===1||j==="true"||j===true){return true}else{if(j==="0"||j===0||j==="false"||j===false){return false}else{return"undefined"}}}});var a=function(k,j){i.prototype.baseViewModule.call(this,k,j)};f.applyMixin(a,i.prototype.baseViewModule);var g=function(k,j){a.call(this,k,j)};f.applyMixin(g,a);g.prototype.buildView=function(){if(!this._tweaker.elements.container){return}var j=this._options.viewOptions||{};j.type=this._options.viewOptions.displayStyle;j.touchMode=this._tweaker._getCurrentTouchMode();j.fireOnlyFromUIInteractionFlag=true;this._view=new c.Element("div");this.icon=new c.Element("div");this.icon.inject(this._view);this.icon.setStyles({height:"100%",width:"100%"});var k;if(this._tweaker.value==="undefined"){k="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon"}else{if(this._tweaker.value===true){k="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg checkIcon"}else{if(this._tweaker.value===false){k="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg notIcon"}}}this.icon.addClassName(k);this.setValue(this._tweaker.value)};g.prototype.handleEvents=function(){var j=this._view;var k=this.icon;var m=this._tweaker;var l=this;d.addEventOnElement(m,j,e.POINTERHIT,function(n){n.stopPropagation();k.className="";var o="";if(m.value===false){o="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon";m.value="undefined"}else{if(m.value===true){o="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon";m.value="undefined"}else{if(m.value==="undefined"){m.value=true;o="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg checkIcon"}}}k.addClassName(o)})};g.prototype.setValue=function(k,j){if(!this.icon){return}var l="";if(this._tweaker.value==="undefined"){l="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon"}else{if(this._tweaker.value===true){l="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg checkIcon"}else{if(this._tweaker.value===false){l="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg notIcon"}}}this.icon.className="";this.icon.addClassName(l)};g.prototype.setTouchMode=function(k,j){if(!this.icon){return}this.icon.touchMode=k};var h=function(k,j){a.call(this,k,j)};f.applyMixin(h,a);h.prototype.buildView=function(){if(!this._tweaker.elements.container){return}this._view=new c.Element("span");var j;if(this._tweaker.value==="undefined"){j="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon"}else{if(this._tweaker.value===true){j="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg "}else{if(this._tweaker.value===false){j="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg "}}}this._view.addClassName(j);this.setValue(this._tweaker.value);this.setTouchMode(this._tweaker._getCurrentTouchMode())};h.prototype.setValue=function(k,j){if(!this._view){return}var l="";if(this._tweaker.value==="undefined"){l="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon"}else{if(this._tweaker.value===true){l="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg "}else{if(this._tweaker.value===false){l="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg "}}}this._view.className="";this._view.addClassName(l)};h.prototype.setTouchMode=function(k,j){if(!this._view){return}if(this._tweaker.readOnly){if(k){this._view.style.paddingLeft="14px"}else{this._view.style.paddingLeft="7px"}}else{this._view.touchMode=k}};b.prototype.baseViewModule=a;b.prototype.VIEW_MODULES={"switch":{classObject:g,options:{viewOptions:{displayStyle:"switch"}}},readOnly:{classObject:h,options:{viewOptions:{displayStyle:"switch"}}},checkbox:{classObject:g,options:{viewOptions:{displayStyle:"checkbox"}}}};b.prototype.registerViewModule=function(j,k){return;if(!j||!k||!k.classObject&&!k.classPath){return}if(b.prototype.VIEW_MODULES[j]!==undefined){return}b.prototype.VIEW_MODULES[j]=k};return b});define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEffectivityEditorModelSelector",["UWA/Drivers/Alone","DS/Core/Core","DS/Controls/ComboBox","UWA/Class/View","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],function(f,c,a,d,b){var e=d.extend({_textNode:null,setup:function(g){this._parent(g)},enable:function(){if(this.options.data.length!=1){this._wuxComboBox.disabled=false}},disable:function(){this._wuxComboBox.disabled=true},render:function(){var g=this;this.options.processedData=[];for(var i=0;i<this.options.data.length;i++){var h=this.options.data[i];this.options.processedData.push({valueItem:h,labelItem:h.displayName})}this._wuxComboBox=new a({elementsList:this.options.processedData,placeholder:b.CFG_Select_Model,selectedIndex:0});this._wuxComboBox.addEventListener("change",function(j){g.options.onChangeCB(g._wuxComboBox.currentValue);console.log(j)});if(this.options.data.length==1){this._wuxComboBox.hide();this._text=this.options.data[0].displayName}return this}});return e});define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",["DS/CfgBaseUX/scripts/CfgDialog","DS/Controls/Toggle","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],function(d,b,c){var a=Object.create(null);a.toolbar=null;a.isPasteEffectivityWarningToShow=true;a.writetoolbarDefination=function(){var e={entries:[{id:"ID_ColumnText",dataElements:{typeRepresentation:"string",value:"",label:c.CFG_SearchColumns,tooltip:c.CFG_SearchColumns,overflowPriority:"none",displayLabel:true,category:"Header",},position:"far",children:[]},{id:"ID_Plus",dataElements:{typeRepresentation:"functionIcon",tooltip:c.CFG_AddORConditions,disabled:true,icon:{iconName:"plus",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onPlusClick",}},position:"far",children:[]},{id:"ID_Copy",dataElements:{typeRepresentation:"functionIcon",tooltip:c.CFG_CopyEffectivityConditions,disabled:true,icon:{iconName:"copy",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onCopyClick",}},position:"far",children:[]},{id:"ID_Paste",dataElements:{typeRepresentation:"functionIcon",tooltip:c.CFG_PasteEffectivityConditions,disabled:true,icon:{iconName:"paste",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onPasteClick",}},position:"far",children:[]},{id:"ID_Duplicate",dataElements:{typeRepresentation:"functionIcon",tooltip:c.CFG_DuplicateEffectivityConditions,disabled:true,icon:{iconName:"duplicate",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onDuplicateClick",}},position:"far",children:[]},{id:"ID_Minus",dataElements:{tooltip:c.CFG_DeleteORConditions,typeRepresentation:"functionIcon",disabled:true,icon:{iconName:"trash",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onMinusClick",}},position:"far",children:[]}]};return JSON.stringify(e)},a.onPlusClick=function(f){a.toolbar.currentModel.addORCondition()},a.onCopyClick=function(f){a.toolbar.currentModel.addCopyCondition();a.toolbar.isCopyOperationPerformed="YES"},a.performPasteOperation=function(){a.toolbar.currentModel.addPasteCondition();var e={IdValue:"ID_Paste",StateValue:true};var f=[e];a.setToolbarState(f);a.toolbar.isCopyOperationPerformed="NO";a.toolbar.currentModel.set("copiedInstances",[])},a.onPasteClick=function(f){if(a.isPasteEffectivityWarningToShow==true){a.showPasteEffectivityWarningDialog();return}a.performPasteOperation()},a.onDuplicateClick=function(i){a.toolbar.currentModel.addDuplicateCondition();var h={IdValue:"ID_Duplicate",StateValue:true};var f={IdValue:"ID_Paste",StateValue:true};var g=[h,f];a.setToolbarState(g)},a.onMinusClick=function(f){a.toolbar.currentModel.removeORCondition()},a.setToolbarState=function(f){if(f){for(var e=0;e<f.length;e++){var g=f[e];a.toolbar.updateNodeModel(g.IdValue,{disabled:g.StateValue})}}},a.showPasteEffectivityWarningDialog=function(){var g=function(){a.performPasteOperation();f.closeDialog()};var i=function(){f.closeDialog()};var h={dialogue:{header:c.CFG_Paste_Effectivity_Heading,buttonArray:[{label:c.Ok,handler:g,className:"primary"},{label:c.Cancel,handler:i,className:"default"}],target:widget.body,object:null,postCrossHandler:i}};var f=new d(h);f.render();f.container.setStyle("overflow","auto");f.container.setHTML(c.CFG_Paste_Effectivity_Warning+"<br><br>"+c.CFG_Paste_Effectivity_Question+"<br>");var e=new b({label:c.CFG_Paste_Effectivity_Preference_Warning});e.addEventListener("change",function(j){if(j.dsModel.checkFlag==true){a.isPasteEffectivityWarningToShow=false}else{a.isPasteEffectivityWarningToShow=true}});e.inject(f.container)};return a});define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModel",["UWA/Class/Model","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/TreeModel/DataModelSet","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],function(f,a,g,d,c,e,b){return f.extend({_onNodeModelUpdateSubscriptionToken:"",_processedAttributes:{},defaults:function(){return{treeDocumentEffectivityGridView:null,treeDocumentVariantView:null,gridViewEffectivityColumns:[],configurationContext:{},selectedInstances:[],copiedInstances:[]}},_addExpressionColumn:function(){var j="350";var i=window.matchMedia("(max-width: 767px)");if(i.matches){j="100"}var h={text:b.CFG_Expression,dataIndex:"Expression",pinned:"right",width:j,editionPolicy:"none"};return h},_addInstanceColumn:function(){var j="250";var i=window.matchMedia("(max-width: 767px)");if(i.matches){j="100"}var h={text:b.CFG_Instance,dataIndex:"instance",pinned:"left",alwaysVisibleFlag:"true",width:j,editionPolicy:""};return h},addFeatureColumn:function(l,i,n,k,m,h){for(var o=0;o<l.length;o++){if(l[o].dataIndex==m){return l[o]}}var j=this.getColumnDefination();j.name=i;j.text=n;j.dataIndex=m;j.typeRepresentation="string";j.editionPolicy="";j.columnType="Feature";j.featureType=h;l.push(j);return j},addOptionColumn:function(h,i,m,n,k,l){var j=this.getColumnDefination();j.name=i;j.text=m;j.dataIndex=l;j.typeRepresentation="tristate";j.editionPolicy="EditionInPlace";j.columnType="Option";j.featureType="";j.parentId=k;if(e.isReadOnlyMode==true){j.editionPolicy="none"}if(h.children===undefined){h.children=[]}h.children.push(j)},getColumnDefination:function(){var h={name:"",text:"",dataIndex:"",typeRepresentation:"string",editionPolicy:"",columnType:"",featureType:"",parentId:""};return h},createColumns:function(j){var l=[];l.push(this._addInstanceColumn());if(j.criterias!=undefined){var h=j.criterias.features;for(var o=0;o<h.length;o++){var n=h[o].featureAttributes.results[0];var p=this._extractAttributes(n);p.parentId="";if(h[o].featureType!=undefined){p.featureType=h[o].featureType}else{p.featureType="NonExclusive"}this._processedAttributes[h[o].featurePID]=p;var m=this.addFeatureColumn(l,p.name,p.displayName,p.type,p.physicalId,p.featureType);m.children=[];for(var i=0;i<h[o].options.length;i++){var n=h[o].options[i].optionAttributes.results[0];var p=this._extractAttributes(n);p.parentId=h[o].featurePID;this._processedAttributes[h[o].options[i].optionPID]=p;var k=this.getColumnDefination();k.name=p.name;k.text=p.displayName;k.dataIndex=p.physicalId;k.typeRepresentation="tristate";k.editionPolicy="EditionInPlace";k.columnType="Option";k.featureType=p.type;k.parentId=p.parentId;if(e.isReadOnlyMode==true){k.editionPolicy="none"}m.children.push(k)}}}l.push(this._addExpressionColumn());this.set("gridViewEffectivityColumns",l)},_extractAttributes:function(h){var i={};i.physicalId=h.physicalID;h.data.forEach(function(j){if(j.name=="Display Name"){i.displayName=j.value[0]}});h.basicData.forEach(function(j){if(j.name=="name"){i.name=j.value[0]}});i.type=h.type;return i},getProcessedInstances:function(){var i={};var h=this.get("selectedInstances");for(var j=0;j<h.length;j++){i[h[j].instanceId]=h[j]}return i},createTreeDocument:function(i){var j=this.get("gridViewEffectivityColumns");var u={};for(var B=0;B<j.length;B++){u[j[B].dataIndex]="";for(var I=0;j[B].children!=undefined&&I<j[B].children.length;I++){u[j[B].children[I].dataIndex]="undefined"}}u.instance="";u.Expression="";var E=false;var q=this.getProcessedInstances();var m=new d();var C=new a({dataModelSet:m});C.prepareUpdate();var r=[];if(i.expressions!=undefined){for(var x=0;x<i.expressions.length;x++){r[i.expressions[x].instancePID]=i.expressions[x]}}if(i.classification!=undefined){for(var x=0;x<i.classification.length;x++){var s={effectivity:[]};if(i.classification[x].classificationCode=="LEGACY_EFF"){E=true;continue}r[i.classification[x].instancePID]=s}}for(var H in q){if(q.hasOwnProperty(H)){var w=r[H];if(w===undefined){continue}var v=r[H].effectivity;if(v===undefined){continue}var D=q[H];for(var p=0;p<v.length;p++){var y=v[p].optionSelection;var h=Object.assign({},u);var G={};var F=D.name;for(var k=0;k<y.length;k++){var t=y[k];var o=t.isSelected;if(o=="YES"){o=true}if(o=="NOT"){o=false}var n=this._processedAttributes[t.optionPID];h[n.physicalId]=o;G.instance=D;G.isModified=false;G.isAllowed=true;if(p!=0){F=""}}h.instance=F;var z=new g({label:F,grid:h,data:G});this.updateDisplayExpression(z);z.options.data.isModified=false;C.addChild(z)}if(v.length===0){var G={};G.instance=D;var A=Object.assign({},u);A.instance=D.name;G.isModified=false;G.isAllowed=true;var z=new g({label:D.name,grid:A,data:G});C.addChild(z)}}}C.expandAll();C.pushUpdate();this.set("treeDocumentEffectivityGridView",C);this.registeronNodeUpdateEvent();var l=C.getAllDescendants();if(l.length==0){c.showwarning(b.CFG_Invalid_All_Objects,"info")}else{if(E==true){c.showwarning(b.CFG_Invalid_Objects,"info")}}},updateDisplayExpression:function(l){var k=this.get("configurationContext");var j=this.get("gridViewEffectivityColumns");var i=this.getORConditionXML(j,l,"TXT");if(i!=""){i=e.buildContext(k.displayName,i)}i=e.buildGlobalExpression(i);var h=c.getDisplayExpressionUsingXSLT(i,"TRUE");l.prepareUpdate();l.options.data.isModified=true;l.updateOptions({grid:{Expression:h}});l.pushUpdate()},getORConditionXML:function(k,q,u){var o=q.options.grid;var p=[];var s=[];var n=false;for(var v=0;v<k.length;v++){var h=k[v].dataIndex;var j=k[v].name;if(u=="TXT"){j=k[v].text}p=[];n=false;if(k[v].children===undefined){continue}for(var y=0;y<k[v].children.length;y++){var l=o[k[v].children[y].dataIndex];var h=k[v].children[y].dataIndex;var x=k[v].children[y].name;if(u=="TXT"){x=k[v].children[y].text}if(l==true||l==false){if(l==false){n=true}p.push({isNOT:n,xml:e.buildOption(x)});n=false}}if(p.length==0){continue}if(k[v].featureType=="NonExclusive"){for(var r=0;r<p.length;r++){var w=e.buildFeature(j,p[r].xml);if(p[r].isNOT==true){w="<NOT>"+w+"</NOT>"}s.push(w)}}else{var i="";var n=false;for(var m=0;m<p.length;m++){i=i+p[m].xml;n=p[m].isNOT}var w=e.buildFeature(j,i);if(n==true){w="<NOT>"+w+"</NOT>"}s.push(w)}}p="";for(var t=0;t<s.length;t++){p+=s[t]}if(p!=""&&s.length>1){p="<AND>"+p+"</AND>"}return p},registeronNodeUpdateEvent:function(){var h=this;this._onNodeModelUpdateSubscriptionToken=this.get("treeDocumentEffectivityGridView").onNodeModelUpdate(function(i){h.undoRegisteronNodeUpdateEvent();h.updateVariantsSelection(i.data.nodeModel);h.updateDisplayExpression(i.data.nodeModel);h.registeronNodeUpdateEvent()})},updateVariantsSelection:function(l){var i=this.get("gridViewEffectivityColumns");for(var k=0;k<i.length;k++){if(i[k].children===undefined){continue}var j={};for(childrenCount=0;i[k].children!=undefined&&i[k].featureType=="Exclusive"&&childrenCount<i[k].children.length;childrenCount++){var h=l.options.grid[i[k].children[childrenCount].dataIndex];if(h=="undefined"){continue}j[""+h]=""}if(Object.keys(j).length>1){for(childrenCount=0;i[k].children!=undefined&&i[k].featureType=="Exclusive"&&childrenCount<i[k].children.length;childrenCount++){if(l.options.grid[i[k].children[childrenCount].dataIndex]==false){l.options.grid[i[k].children[childrenCount].dataIndex]="undefined"}}}}},undoRegisteronNodeUpdateEvent:function(){this.get("treeDocumentEffectivityGridView").unsubscribe(this._onNodeModelUpdateSubscriptionToken)},addORCondition:function(){var h=this.get("treeDocumentEffectivityGridView");var n=this.isRowSelectionValidForAdd();if(n==true){h.prepareUpdate();var m=h.getSelectedNodes();var i=m[0]._rowID+1;var k={};Object.assign(k,m[0].options.grid);for(var j in k){if(k.hasOwnProperty(j)){if(k[j]===true||k[j]===false){k[j]="undefined"}if(j=="instance"){k[j]=""}if(j=="Expression"){k[j]=""}}}var l=new g({label:"",grid:k,icons:"",data:m[0].options.data});h.addChild(l,i);h.pushUpdate()}},processSelectedDataForCopyOperation:function(i){var h=[];for(var k=0;k<i.length;k++){var j=JSON.parse(JSON.stringify(i[k].options.grid));var l={grid:j};h.push(l)}return h},addCopyCondition:function(){var h=this.get("treeDocumentEffectivityGridView");var j=h.getSelectedNodes();var i=this.processSelectedDataForCopyOperation(j);if(i.length>0){this.set("copiedInstances",i);h._xso.empty()}},sortNumber:function(i,h){return i-h},getDataForPasteOperation:function(){var k=this.get("treeDocumentEffectivityGridView");var l=k.getSelectedNodes();var p=[];var j=[];for(var m=0;m<l.length;m++){var o=l[m].options.data.instance.instanceId;if(p.indexOf(o)==-1){p.push(o)}}for(var m=0;m<p.length;m++){var n=p[m];var i=[];for(var h=0;h<l.length;h++){if(l[h].options.data.instance.instanceId==n){i.push(l[h]._rowID)}}i.sort(this.sortNumber);j.push({instanceId:n,rowIds:i})}return j},setModifiedInstances:function(h){var j=this.get("treeDocumentEffectivityGridView").getAllDescendants();for(var i=0;i<j.length;i++){if(h.indexOf(j[i].options.data.instance.instanceId)!=-1){j[i].options.data.isModified=true}}},getInstancesForPasteScenario:function(){var t=this.get("copiedInstances");var o=this.getDataForPasteOperation();var m=this.get("treeDocumentEffectivityGridView");var q=m.getSelectedNodes();var u=[];var k=[];var l={};q.forEach(function(w){l[""+w._rowID+""]=w});for(var r=0;r<o.length;r++){var s=o[r].instanceId;var p=o[r].rowIds.length;var n=o[r].rowIds;var h=t.length;if(p>=h){for(var i=0;i<h;i++){var v=JSON.parse(JSON.stringify(t[i].grid));var j=n[i];u.push(l[j].options.data.instance.instanceId);v.instance=l[j].options.grid.instance;l[j].updateOptions({grid:v})}}else{for(var i=0;i<p;i++){var v=JSON.parse(JSON.stringify(t[i].grid));var j=n[i];u.push(l[j].options.data.instance.instanceId);v.instance=l[j].options.grid.instance;l[j].updateOptions({grid:v})}k.push({instanceId:s,pasteCount:p,copyCount:h})}}this.setModifiedInstances(u);return k},addPasteCondition:function(){var t=this.get("copiedInstances");var n=this.get("treeDocumentEffectivityGridView");var o=n.getSelectedNodes();var m=this.getInstancesForPasteScenario();n.prepareUpdate();for(var r=m.length-1;r>=0;r--){var s=m[r].instanceId;var p=m[r].pasteCount;var j=m[r].copyCount;for(var i=o.length-1;i>=0;i--){if(o[i].options.data.instance.instanceId==s){var q=o[i]._rowID+1;for(var k=0;k<j;k++){if(k>=p){var h=JSON.parse(JSON.stringify(t[k].grid));for(var u in h){if(h.hasOwnProperty(u)){if(u=="instance"){h[u]=""}}}var l=new g({label:"",grid:h,icons:"",data:o[i].options.data});n.addChild(l,q);q++}}break}}}n.pushUpdate();n._xso.empty()},addDuplicateCondition:function(){var n=this.get("treeDocumentEffectivityGridView");var j=this.isRowSelectionValidForDelete();var r=[];if(j==true){n.prepareUpdate();var q=n.getSelectedNodes();var m={};var o=[];q.forEach(function(t){o.push(t._rowID);m[""+t._rowID+""]=t});o.sort(this.sortNumber);for(var i=o.length-1;i>=0;i--){var l=o[i];r.push(m[l].options.data.instance.instanceId);var p=l+1;var h=JSON.parse(JSON.stringify(m[l].options.grid));for(var s in h){if(h.hasOwnProperty(s)){if(s=="instance"){h[s]=""}}}var k=new g({label:"",grid:h,icons:"",data:m[l].options.data});n.addChild(k,p)}n.pushUpdate()}this.setModifiedInstances(r);n._xso.empty()},removeORCondition:function(){var i=this.get("treeDocumentEffectivityGridView");var o=this.isRowSelectionValidForDelete();var h=[];if(o==true){i.prepareUpdate();var m=i.getSelectedNodes();for(var j=0;j<m.length;j++){h.push(m[j].options.data.instance.instanceId);if(m[j].options.grid.instance==""){i.removeRoot(m[j])}else{var l=m[j].options.grid;for(var k in l){if(l.hasOwnProperty(k)){if(k=="instance"){continue}if(k=="Expression"){l[k]=""}if(l[k]===true||l[k]===false){l[k]="undefined"}}}m[j].updateOptions({grid:l})}}i.pushUpdate()}var n=this.get("treeDocumentEffectivityGridView").getAllDescendants();for(var j=0;j<n.length;j++){if(h.indexOf(n[j].options.data.instance.instanceId)!=-1){n[j].options.data.isModified=true}}},isRowSelectionValidForDelete:function(){var h=this.get("treeDocumentEffectivityGridView");var j=h.getSelectedNodes();if(j.length==0){c.showwarning(b.CFG_No_Selection,"error");return false}for(var i=0;i<j.length;i++){if(j[i].options.data.isAllowed==false){c.showwarning(b.CFG_Select_Valid_Object,"error");return false}}return true},isRowSelectionValidForAdd:function(){var h=this.get("treeDocumentEffectivityGridView");var i=h.getSelectedNodes();if(i.length==0){c.showwarning(b.CFG_No_Selection,"error");return false}if(i.length>1){c.showwarning(b.CFG_MultiSelection_Not_Allowed,"error");return false}if(i[0].options.data.isAllowed==false){c.showwarning(b.CFG_Select_Valid_Object,"error");return false}return true},addEffectivityGridViewColumn:function(n){this.undoRegisteronNodeUpdateEvent();var o={};var i=this.get("gridViewEffectivityColumns");var k=this.get("treeDocumentEffectivityGridView");k.prepareUpdate();var m="Exclusive";if(n.feature.selectionType!="Single"){m="NonExclusive"}var j=this.addFeatureColumn(i,n.feature.name,n.feature.displayName,n.feature.type,n.feature.physicalID,m);o[n.feature.physicalID]="";if(n.self.options!=undefined){for(var l=0;l<n.feature.options.length;l++){this.addOptionColumn(j,n.feature.options[l].name,n.feature.options[l].displayName,n.feature.name,n.feature.physicalID,n.feature.options[l].physicalID);o[n.feature.options[l].physicalID]="undefined"}}else{this.addOptionColumn(j,n.self.name,n.self.displayName,n.feature.name,n.feature.physicalID,n.self.physicalID);o[n.self.physicalID]="undefined"}var p=k.getAllDescendants();for(var l=0;l<p.length;l++){var h=p[l].options.grid;if(p[l].options.data.isAllowed==false){continue}Object.assign(h,o);p[l].updateOptions({grid:h})}k.pushUpdate();this.registeronNodeUpdateEvent()},removeEffectivityGridViewColumn:function(o){this.undoRegisteronNodeUpdateEvent();var l={};var k=this.get("gridViewEffectivityColumns");var i=this.get("treeDocumentEffectivityGridView");i.prepareUpdate();if(o.self.options!=undefined){l[o.feature.physicalID]="";for(var m=0;m<o.feature.options.length;m++){l[o.feature.options[m].physicalID]=""}}else{l[o.self.physicalID]=""}var n=i.getAllDescendants();for(var m=0;m<n.length;m++){var j=n[m].options.grid;Object.keys(l).forEach(function(q,p){delete j[q]});n[m].updateOptions({grid:j})}if(o.self.options!=undefined){this._removeFeatureColumn(k,o.feature.physicalID)}else{this._removeOptionColumn(k,o.self.physicalID)}i.pushUpdate();var h=this;n.forEach(function(p){h.updateDisplayExpression(p)});this.registeronNodeUpdateEvent()},_removeFeatureColumn:function(i,j){for(var h=i.length-1;h>=0;h--){if(i[h].dataIndex===j){i.splice(h,1);break}}},_removeOptionColumn:function(j,k){for(var i=j.length-1;i>=0;i--){for(var h=0;j[i].children!=undefined&&h<j[i].children.length;h++){if(j[i].children[h].dataIndex===k){j[i].children.splice(h,1);break}}}},filterColumns:function(h){console.log("filter columns")}})});define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridView",["UWA/Class/View","DS/DataGridView/DataGridView","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar","DS/Core/PointerEvents","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor",],function(b,a,d,g,f,c,i,h){var e=b.extend({toolbar:null,processedColumns:null,init:function(j){this._parent(j)},render:function(){this.columnsDeepCloned=JSON.parse(JSON.stringify(this.options.columns));this.massVariantGridView=new a({treeDocument:this.options.treeDocument,columns:this.columnsDeepCloned,initialEffectivitiesOfInstances:this.options.initialEffectivitiesOfInstances,selectionMode:"cell",defaultColumnDef:{width:"auto",typeRepresentation:"string",editableFlag:true,resizableFlag:true,sortableFlag:false}});var k={tristate:{stdTemplate:"tristatetemplate"}};var j={tristatetemplate:{path:"DS/CfgMassVariantEffectivityEditor/scripts/CfgTweakerTristate",options:{}}};this.massVariantGridView.getTypeRepresentationFactory().registerTypeTemplates(j);this.massVariantGridView.getTypeRepresentationFactory().registerTypeRepresentations(k);this.massVariantGridView.showEditableFeedbackFlag=false;this.massVariantGridView.layout.rowsHeader=true;if(d.isReadOnlyMode==false&&d.isKarmaOdtMode()===false){g.toolbar=this.massVariantGridView.setToolbar(g.writetoolbarDefination())}this.toolbar=g.toolbar;this.registerUpdateToolbarCommandStatesEvent();this.registerLiveChangeEvent();this.buildContextualMenu();return this},registerUpdateToolbarCommandStatesEvent:function(){var j=this;this.massVariantGridView.treeDocument.getXSO().onPostAdd(function(k){var q={IdValue:"ID_Plus",StateValue:false};var m={IdValue:"ID_Copy",StateValue:false};var l={IdValue:"ID_Paste",StateValue:false};var o={IdValue:"ID_Duplicate",StateValue:false};var p={IdValue:"ID_Minus",StateValue:false};var n=[q,m,o,p];if(j.toolbar.isCopyOperationPerformed!=undefined&&j.toolbar.isCopyOperationPerformed=="YES"){n.push(l)}g.setToolbarState(n)});this.massVariantGridView.treeDocument.getXSO().onPostRemove(function(k){if(j.massVariantGridView.treeDocument.getXSO().isEmpty()){var q={IdValue:"ID_Plus",StateValue:true};var m={IdValue:"ID_Copy",StateValue:true};var l={IdValue:"ID_Paste",StateValue:true};var o={IdValue:"ID_Duplicate",StateValue:true};var p={IdValue:"ID_Minus",StateValue:true};var n=[q,m,l,o,p];g.setToolbarState(n)}})},registerLiveChangeEvent:function(){if(!this.toolbar){return}var j=this;this.toolbar.addEventListener("liveChange",function(k){if(k.dsModel._properties.value.dirty==true){j.filterColumns(k.dsModel._properties.value.value)}})},filterColumns:function(o){var m=this;var l=m.massVariantGridView.layout;var n=m.massVariantGridView.layout.getLeafColumns();var k={};for(var j=0;n!=undefined&&j<n.length;j++){if(n[j].name==="Expression"){continue}if(n[j].name==="instance"){continue}if(n[j].name===undefined){continue}l.setColumnVisibleFlag(n[j].dataIndex,false,{isUserInteraction:true});if(n[j].text.toUpperCase().indexOf(o.toUpperCase())!=-1){l.setColumnVisibleFlag(n[j].dataIndex,true,{isUserInteraction:true})}}},filterRows:function(n){var m=this;var l=m.massVariantGridView.layout;var j=m.options.treeDocument.getAllDescendants();for(var k=0;k<j.length;k++){j[k].show();if(j[k]._options.data.instance.name.toUpperCase().indexOf(n.toUpperCase())===-1){j[k].hide()}}},isValidNotMenuCell:function(j){if(j.cellInfos.cellModel===true||j.cellInfos.cellModel===false||j.cellInfos.cellModel==="undefined"){return true}},setCellValues:function(q,r){var n=this.options.treeDocument.getNthRoot(q.cellInfos.rowID);n.prepareUpdate();var j=this.getColumnFromcolumnID(q.cellInfos.columnID);if(j.childIndex==-1){return}var p={};if(this.options.columns[j.parentIndex].featureType=="Exclusive"&&r!="undefined"){var l="";var m=this.options.columns[j.parentIndex].children;if(m===undefined){return}var o="undefined";for(var s=0;s<m.length;s++){var k=this.options.columns[j.parentIndex].children[s];if(n.options.grid[k.dataIndex]!="undefined"){o=n.options.grid[k.dataIndex]}}if(o!=r){for(var s=0;s<m.length;s++){var k=this.options.columns[j.parentIndex].children[s];p[k.dataIndex]="undefined"}}}p[this.options.columns[j.parentIndex].children[j.childIndex].dataIndex]=r;n.options.data.isModified=true;n.updateOptions({grid:p});n.pushUpdate()},getColumnFromcolumnID:function(k){var j=-1;var m=null;var p=-1;var o=0;var l=this.options.columns;for(var n=0;n<l.length;n++){if(l[n].children===undefined){j++}m=n;for(childrenCount=0;l[n].children!=undefined&&childrenCount<l[n].children.length;childrenCount++){j++;if(k==j){p=childrenCount;o=1;break}}if(o==1){break}}return{parentIndex:m,childIndex:p}},buildCellSelectionContextualMenu:function(n){var m=this;var p=[];var l="";var o="";var j="";p.push({type:"PushItem",title:h.CFG_Set_Not,fonticon:l,state:"",action:{callback:function k(q){if(q&&q.context&&q.context.id){m.setCellValues(n,false)}},context:{id:"NOT"}}},{type:"PushItem",title:h.CFG_Set_Selected,fonticon:o,state:"",action:{callback:function k(q){if(q&&q.context&&q.context.id){m.setCellValues(n,true)}},context:{id:"Select"}}},{type:"PushItem",title:h.CFG_Set_Unselected,fonticon:j,state:"",action:{callback:function k(q){if(q&&q.context&&q.context.id){m.setCellValues(n,"undefined")}},context:{id:"Unselect"}}});return p},buildHeaderContextualMenu:function(n){var o=[];var m=this.massVariantGridView;var l=m.layout.getColumnVisibleFlag("Expression");var j="";if(l==true){j={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-check"}}if(n.cellInfos.cellModel!="Expression"&&n.cellInfos.cellModel!="Instance"){}o.push({type:"PushItem",title:h.CFG_Expression,fonticon:j,state:"",action:{callback:function k(q){if(q&&q.context&&q.context.id){var p=m.layout.getColumnVisibleFlag(q.context.id);m.layout.setColumnVisibleFlag(q.context.id,!p,{isUserInteraction:true})}},context:{id:"Expression"}}});return o},buildInformationContextualMenu:function(m){var n=[];var l=this;var j={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-info"};n.push({type:"PushItem",title:h.CFG_Information,fonticon:j,state:"",action:{callback:function k(q){if(q&&q.context&&q.context.id){var r=l.options.treeDocument.getNthRoot(m.cellInfos.rowID);var p=r._options.data.instance.currentEffectivityXmls.xml;var o=h.Effectivity_Not_Set;if(p!=""){o=i.getDisplayExpressionUsingXSLT(p)}o=o.replace(/\n/ig,"<br/><br/>");l.showGlobalEffectivityDialog(o,m.cellInfos.nodeModel.options.grid.instance)}},context:{id:"globalEffectivity"}}});return n},buildContextualMenu:function(){var j=this;this.massVariantGridView.onContextualEvent=function(k){if(j.isValidNotMenuCell(k)==true){return j.buildCellSelectionContextualMenu(k)}else{if(k.cellInfos.columnID===0&&k.cellInfos.nodeModel!=undefined){return j.buildInformationContextualMenu(k)}else{if(k.cellInfos.nodeModel===undefined){return j.buildHeaderContextualMenu(k)}}}}},cssAdjustmentsForLayout:function(j){if(j==false){this.massVariantGridView.getContent(".wux-layouts-collectionview").setStyle("top","33px")}else{this.massVariantGridView.getContent(".wux-layouts-collectionview").setStyle("top","48px")}},refreshColumns:function(k){var l=JSON.parse(JSON.stringify(k));var j=this.massVariantGridView.layout.getColumnVisibleFlag("Expression");this.massVariantGridView.columns=l;this.massVariantGridView.layout.setColumnVisibleFlag("Expression",j,{isUserInteraction:true})},showGlobalEffectivityDialog:function(m,l){var j={dialogue:{header:h.Current_Variant_Effectivity+" - "+l,buttonArray:[],target:widget.body,object:null,postCloseHandler:null}};var k=new c(j);k.render();k.container.setStyle("overflow","auto");k.container.setHTML(m)}});return e});define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModelsCollection",["UWA/Class/Collection","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModel","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],function(b,e,d,a){var c=b.extend({model:e,attachedModels:[],selectedInstances:[],init:function(f){this._parent(f)},setSelectedInstances:function(f){this.selectedInstances=f},setAttachedModels:function(f){this.attachedModels=f},initialiseModels:function(){for(var g=0;g<this.attachedModels.length;g++){var f=new e({id:this.attachedModels[g].physicalId,treeDocumentEffectivityGridView:null,gridViewEffectivityColumns:[],configurationContext:this.attachedModels[g],selectedInstances:this.selectedInstances});this.add(f)}},processJsonToXml:function(s){var l={};for(var o=0;o<this.length;o++){var j=this.at(o).get("gridViewEffectivityColumns");var f=this.at(o).get("treeDocumentEffectivityGridView").getAllDescendants();var h=this.at(o).get("configurationContext");var t="";var u=0;for(var i=0;i<f.length;i++){if(f[i].options.data.isAllowed==false){continue}var m="";var k=this.at(o).getORConditionXML(j,f[i],s);if(k!=""){u++}t=t+k;if(f[i+1]!=undefined&&f[i].options.data.instance.instanceId==f[i+1].options.data.instance.instanceId){continue}if(u>1){t="<OR>"+t+"</OR>"}u=0;var r="";if(s=="XML"){r=h.name}else{r=h.displayName}if(t!=""){t=d.buildContext(h.name,t)}if(l[f[i].options.data.instance.instanceId]===undefined){l[f[i].options.data.instance.instanceId]={xmls:[],data:f[i].options.data}}l[f[i].options.data.instance.instanceId].xmls.push(t);t=""}}var g={};for(var q in l){if(l.hasOwnProperty(q)){var v="";var p=l[q].xmls;for(var n=0;n<p.length;n++){v+=p[n]}if(p.length>1&&v!=""){v="<MultiContextView>"+v+"</MultiContextView>"}if(v!=""){v=d.buildGlobalExpression(v)}g[q]={xml:v,data:l[q].data}}}console.log(g);return g},initiateCurrentEffectivityXmls:function(){var h=this.processJsonToXml("TXT");for(var f=0;f<this.length;f++){var g=this.at(f).get("treeDocumentEffectivityGridView").getAllDescendants();for(cnt=0;cnt<g.length;cnt++){g[cnt].options.data.instance.currentEffectivityXmls=h[g[cnt].options.data.instance.instanceId]}}},getModifiedInstances:function(){var f=[];for(var h=0;h<this.length;h++){var i=this.at(h).get("treeDocumentEffectivityGridView").getAllDescendants();for(cnt=0;cnt<i.length;cnt++){if(i[cnt].options.data.isModified==true){var g=f.indexOf(i[cnt].options.data.instance.instanceId);if(g==-1){f.push(i[cnt].options.data.instance.instanceId)}}}}return f},resetModifiedInstances:function(){for(var f=0;f<this.length;f++){var g=this.at(f).get("treeDocumentEffectivityGridView").getAllDescendants();for(cnt=0;cnt<g.length;cnt++){g[cnt].options.data.isModified=false}}}});return c});define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEffectivityEditorLayout",["UWA/Class/View","DS/Handlebars/Handlebars","DS/CfgBaseUX/scripts/CfgSliderView","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEffectivityEditorModelSelector","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridView","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModelsCollection","DS/Utilities/TouchUtils","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgFeatureOptionsView","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor","css!DS/CfgMassVariantEffectivityEditor/assets/styles/CfgMassVariantEffectivityEditor.css"],function(a,b,g,h,e,c,f,l,k,d,m,j){var i={gridView:null,featureOptionsView:null,sliderView:null,collection:null,render:function(o){l.setTouchMode(false);this.CfgUXEnvVariables=JSON.parse(m);this.options=o;c.isReadOnlyMode=this.CfgUXEnvVariables.isMassVariantReadOnly;if(c.isKarmaOdtMode()===true){c.isReadOnlyMode=false}this.collection=new f();var n=c.processAttachedModels(o.attachedModels);this.collection.setAttachedModels(n);this.collection.setSelectedInstances(o.selectedInstances);this.collection.initialiseModels();this.buildSelector();this.buildSlider();var p=c.getFilterablesVariantGrid(n[0].physicalId,o.selectedInstances);p.then(function(r){var q=i.collection.at(0);q.createColumns(r);q.createTreeDocument(r);i.initialiseGridView();i.sliderView.clearRightLayout();i.sliderView.disableRightLayout();i.collection.initiateCurrentEffectivityXmls();if(c.isReadOnlyMode==false){c.loadDictionary(q,i.onLoadDictionaryComplete)}})},initialiseGridView:function(){this.buildGridView()},onLoadDictionaryComplete:function(o){i.buildfeatureOptionView(o);var n=i.collection.get(o);i.featureOptionsView.selectColumns(n.get("gridViewEffectivityColumns"));i.modelSelector.enable()},buildfeatureOptionView:function(q){var n=this.collection.get(q);var o={treeDocument:n.get("treeDocumentVariantView"),onFeatureOptionSelectionChange:this.onFeatureOptionSelectionChange};this.featureOptionsView=new d(o);this.featureOptionsView.render();this.sliderView.clearRightLayout();this.sliderView.setRightView(this.featureOptionsView.featureOptionGridView,this.featureOptionsView.toolbar);var p=l.getTouchMode();if(c.isReadOnlyMode==false){this.featureOptionsView.cssAdjustmentsForLayout(p)}},onFeatureOptionSelectionChange:function(p,o){i.gridView.toolbar.isCopyOperationPerformed="NO";i.gridView.toolbar.currentModel.set("copiedInstances",[]);var n=i.collection.get(i.modelSelector._wuxComboBox.currentValue.physicalId);if(o==false){n.addEffectivityGridViewColumn(p)}else{n.removeEffectivityGridViewColumn(p)}i.refreshDataGridView(i.modelSelector._wuxComboBox.currentValue.physicalId)},refreshDataGridView:function(o){var n=null;if(o===undefined){n=this.collection.at(0)}else{n=this.collection.get(o)}this.gridView.refreshColumns(n.get("gridViewEffectivityColumns"))},buildSlider:function(){var o=true;if(c.isReadOnlyMode==true){o=false}var n={isReadOnlyMode:c.isReadOnlyMode,leftHeader:j.GridHeader,rightHeader:j.DictionaryHeader,Apply:j.ApplyAndClose,Verify:j.Apply,Cancel:j.Cancel,Touch:j.Touch,onButtonClickCB:this.onButtonClickCB,isRightFooter:false,isLeftFooter:o,headerControl:this.modelSelector._wuxComboBox,headerText:this.modelSelector._text};this.sliderView=new g(n).render()},buildSelector:function(){var n={onChangeCB:this.onHeaderControlChangeCB,data:this.collection.attachedModels};this.modelSelector=new h(n);this.modelSelector.render();this.modelSelector.disable()},buildGridView:function(q){var n=null;if(q===undefined){n=this.collection.at(0)}else{n=this.collection.get(q)}var o={treeDocument:n.get("treeDocumentEffectivityGridView"),columns:n.get("gridViewEffectivityColumns"),context:n.get("configurationContext"),initialEffectivitiesOfInstances:n.get("initialEffectivitiesOfInstances")};this.gridView=new e(o);this.gridView.render();this.sliderView.clearLeftLayout();this.sliderView.setLeftView(this.gridView.massVariantGridView,this.gridView.toolbar);if(this.gridView.toolbar!=null){this.gridView.toolbar.currentModel=n}var p=l.getTouchMode();if(c.isReadOnlyMode==true){this.modelSelector.enable()}else{this.gridView.cssAdjustmentsForLayout(p)}},onHeaderControlChangeCB:function(n){i.refreshView(n.physicalId)},refreshView:function(p){var n=i.collection.get(p);if(n.get("treeDocumentEffectivityGridView")==null){i.modelSelector.disable();var o=c.getFilterablesVariantGrid(p,i.options.selectedInstances);o.then(function(r){var q=i.collection.get(p);q.createColumns(r);q.createTreeDocument(r);i.buildGridView(p);i.modelSelector.enable()})}else{i.buildGridView(p);i.modelSelector.enable()}},onButtonClickCB:function(p){var o={};if(p.buttonId=="leftVerify"||p.buttonId=="leftApply"){if(i.gridView.toolbar!=null){i.gridView.toolbar.isCopyOperationPerformed="NO";i.gridView.toolbar.currentModel.set("copiedInstances",[])}o=i.collection.processJsonToXml("XML");var n=i.collection.getModifiedInstances();i.sliderView.disableRightLayout();i.sliderView.disableLeftLayout();if(p.buttonId=="leftVerify"){c.setEffectivity(o,n,i.enableLayout,i.options.PADContext)}else{c.setEffectivity(o,n,i.destroyLayout,i.options.PADContext)}if(n.length===0){k.showwarning(j.CFG_Edit_Effectivity_AllSuccessful,"success")}i.collection.resetModifiedInstances()}else{if(p.buttonId=="touch"){var q=l.getTouchMode();l.setTouchMode(!q);i.gridView.cssAdjustmentsForLayout(!q);if(c.isReadOnlyMode==false){i.featureOptionsView.cssAdjustmentsForLayout(!q)}}}},destroyLayout:function(){i.sliderView.destroyLayout()},enableLayout:function(){i.sliderView.enableButtons()}};return i});