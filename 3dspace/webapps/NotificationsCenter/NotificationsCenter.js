define("DS/NotificationsCenter/js/view/NotificationSettingsView",["UWA/Class","UWA/Class/Events","DS/UIKIT/Scroller","DS/UIKIT/Input/Toggle","DS/W3DXLogger/W3DXLogger","DS/UIKIT/SuperModal","i18n!DS/NotificationsCenter/assets/nls/feed"],function(a,k,c,g,e,b,i){var h=new e({name:"3DNOTIF",debug:"debugNOTIF"});h.log("3DNOTIF - NotificationSettingsView load");var f=a.extend(k,{init:function(l){var m=this;this.notif_by_ui=l?l.notif_by_ui:0;this.notif_by_email=l?l.notif_by_email:0;this.notif_by_browser=l?l.notif_by_browser:0;this.notifId=l?l.notifId:0;this.app=l?l.app:undefined;this.deg=0;this.globalView=UWA.createElement("div",{id:"NOTIFAPPNAME",styles:{display:"inline-flex",width:"100%",height:"auto","padding-left":"10px","padding-right":"10px","border-bottom":"1px solid #f1f1f1"},events:{click:function(n){h.log("Click APP");m.dispatchEvent("iconClick",n)},mouseover:function(n){m.globalView.style.cursor="pointer"},mouseout:function(n){m.globalView.style.cursor="default"}}});this.icon=UWA.createElement("div",{id:"NotifIconApp"+l.service,styles:{margin:"auto","margin-right":"10px",color:"#77797c"}}).inject(this.globalView);if(this.app){this.iconApp=UWA.createElement("img",{src:l.nameIcon,styles:{width:"48px",height:"48px"}}).inject(this.icon)}this.appTextDetail=UWA.createElement("div",{styles:{flex:"1",}}).inject(this.globalView);this.text=UWA.createElement("div",{styles:{"margin-top":"8px",color:"#77797c","font-weight":"bold","font-size":"16px"}}).inject(this.appTextDetail);this.detailState=UWA.createElement("div",{text:"Off",styles:{color:"#77797c","font-size":"12px","font-style":"italic","margin-bottom":"8px"}}).inject(this.appTextDetail);this.mail=UWA.createElement("span",{"class":"fonticon handler fonticon-right-open-big",styles:{color:"#b4b6ba","font-size":"20px",margin:"auto"},events:{mousedown:function(n){m.mail.style.color="#368ec4"},mouseup:function(n){m.mail.style.color="#b4b6ba"},mouseover:function(n){m.mail.style.cursor="pointer";m.mail.style.color=(m.notif_by_email===1)?"#005686":"#3d3d3d"},mouseout:function(n){m.mail.style.cursor="default";m.mail.style.color=(m.notif_by_email===1)?"#368ec4":"#b4b6ba"}}}).inject(this.globalView)},inject:function(l){this.globalView.inject(l)},setText:function(l){var m=UWA.createElement("div",{});m.innerHTML=l;this.text.setText(m.innerText)},setSetting:function(l){if(l.notif_by_email!==undefined){this.notif_by_email=parseInt(l.notif_by_email);this.mail.style.color=(this.notif_by_email===1)?"#368ec4":"#b4b6ba";if(!l.nodispatch){this.dispatchEvent("updateSettings",[{id:this.notifId,notif_by_email:this.notif_by_email,notif_by_browser:this.notif_by_browser}])}}if(l.notif_by_ui!==undefined){this.notif_by_ui=parseInt(l.notif_by_ui);this.monitor.style.color=(this.notif_by_ui===1)?"#368ec4":"#b4b6ba";if(!l.nodispatch){this.dispatchEvent("updateSettings",[{id:this.notifId,notif_by_ui:this.notif_by_ui,notif_by_email:this.notif_by_email,notif_by_browser:this.notif_by_browser}])}}if(l.notif_by_browser!==undefined){this.notif_by_browser=parseInt(l.notif_by_browser);this.monitor.style.color=(this.notif_by_browser===1)?"#368ec4":"#b4b6ba";if(!l.nodispatch){this.dispatchEvent("updateSettings",[{id:this.notifId,notif_by_ui:this.notif_by_ui,notif_by_email:this.notif_by_email,notif_by_browser:this.notif_by_browser}])}}},setOff:function(l){if(l){this.globalView.style.opacity="0.6"}else{this.globalView.style.opacity="1"}},setDetailState:function(l){this.detailState.setText(l)}});var d=a.extend(k,{init:function(l){var m=this;this.notifs={};this.idNotifs=[];this.notif_by_ui=0;this.notif_by_email=0;this.notif_by_browser=0;this.appID=undefined;this.service=l.service;this.hNotifView=undefined;this.fxShow=undefined;this.fxHide=undefined;this.hNotifs=0;var n=UWA.createElement("textarea",{});n.innerHTML=l.serviceName;this.titleText=n.value;this.appDetailView=l.detailView;this.globalView=UWA.createElement("div",{});this.appTitle=new f({app:true,notif_by_ui:this.notif_by_ui,notif_by_email:this.notif_by_email,notif_by_browser:this.notif_by_browser,nameIcon:l.icon,service:l.service});this.appTitle.inject(this.globalView);this.appTitle.setText(this.titleText);this.appTitle.addEvent("updateSettings",function(o){for(var p in m.notifs){m.notifs[p].line.setSetting(o)}});this.appTitle.addEvent("iconClick",function(o){m.showDetail()});this.buildAppDetailView()},buildAppDetailView:function(){var q=this;var m=UWA.createElement("div",{id:"NotifTitleSetting",styles:{display:"inline-flex",width:"100%",height:"44px","margin-top":"-10px",},events:{mousedown:function(r){m.style.color="#368ec4";p.style.color="#368ec4"},mouseup:function(r){p.style.color="#b4b6ba";p.style.color="#b4b6ba"},mouseover:function(){m.style.cursor="pointer";m.style.color="#3d3d3d";p.style.color="#3d3d3d"},mouseout:function(){m.style.cursor="default";m.style.color="#b4b6ba";p.style.color="#b4b6ba"},click:function(r){q.hideDetail()}}}).inject(this.appDetailView);var p=UWA.createElement("span",{"class":"fonticon handler fonticon-left-open-big",styles:{color:"#b4b6ba","font-size":"24px","margin-top":"5px"},events:{mousedown:function(r){p.style.color="#368ec4"},mouseup:function(r){p.style.color="#b4b6ba"},mouseover:function(){p.style.cursor="pointer";p.style.color="#3d3d3d"},mouseout:function(){p.style.cursor="default";p.style.color="#b4b6ba"},click:function(r){q.hideDetail()}}}).inject(m);UWA.createElement("div",{text:i.settings,styles:{color:"#77797c","font-size":"14px",width:"100%",margin:"auto"},}).inject(m);var o=UWA.createElement("div",{styles:{display:"inline-flex",width:"100%","border-bottom":"1px solid #f1f1f1"},}).inject(this.appDetailView);var n=UWA.createElement("div",{text:this.titleText,styles:{"font-size":"16px",margin:"auto",flex:"1",color:"rgb(119, 121, 124)","font-weight":"bold",},}).inject(o);this.appToogle=new g({type:"switch",value:"option2",label:"",events:{onChange:function(r){var s=0;if(q.appToogle.isChecked()){s=1;q.setDetail()}else{q.appTitle.setDetailState("Off")}q.displaySettings(q.appToogle.isChecked());q.appTitle.setOff(!q.appToogle.isChecked());q.dispatchEvent("updateSettings",[{id:q.appID,subscribe:s}])}}}).inject(o);var l=UWA.createElement("div",{"class":"scroller scroller-root",styles:{margin:"auto",overflow:"hidden",height:"calc(100% - 58px)","max-width":"680px"},}).inject(this.appDetailView);this.notifView=UWA.createElement("div",{"class":"no-native-scrollbars  scroller-content",styles:{right:"-16px",bottom:"-16px","padding-right":"16px","padding-bottom":"16px"},}).inject(l);this.textExplain=UWA.createElement("div",{styles:{width:"100%",height:"40px"},}).inject(this.notifView);this.listNotifs=UWA.createElement("div",{styles:{width:"100%",},}).inject(this.notifView);this.textExplainUI=UWA.createElement("div",{styles:{width:"100%",height:"80px"},}).inject(this.notifView);this.uiDefine=UWA.createElement("div",{styles:{width:"100%",display:"inline-flex",},}).inject(this.notifView);this.centerUI=UWA.createElement("div",{styles:{width:"100%","text-align":"center",margin:"5px"},events:{mouseover:function(){q.centerUI.style.cursor="not-allowed"},mouseout:function(){q.centerUI.style.cursor="default"}}}).inject(this.uiDefine);this.centerIcon=UWA.createElement("span",{"class":"icon-desktop-center",styles:{"font-size":"72px","margin-top":"6px",color:"rgb(54, 142, 196)"}}).inject(this.centerUI);this.txtCenter=UWA.createElement("div",{text:i.centerIconText||"Center",styles:{color:"rgb(54, 142, 196)"}}).inject(this.centerUI);this.AlertUI=UWA.createElement("div",{styles:{width:"100%","text-align":"center",margin:"5px"},events:{mouseover:function(){q.AlertUI.style.cursor="pointer"},mouseout:function(){q.AlertUI.style.cursor="default"},click:function(r){q.notif_by_ui=(q.notif_by_ui===1)?0:1;q.dispatchEvent("updateSettings",[{id:q.appID,notif_by_ui:q.notif_by_ui,notif_by_email:q.notif_by_email,notif_by_browser:q.notif_by_browser}]);for(var s=0;s<q.idNotifs.length;s++){q.dispatchEvent("updateSettings",[{id:q.idNotifs[s],notif_by_ui:q.notif_by_ui,notif_by_email:q.notif_by_email,notif_by_browser:q.notif_by_browser}])}if(q.notif_by_ui===1){q.AlertUIIcon.style.color="rgb(54, 142, 196)";q.txtAlert.style.color="rgb(54, 142, 196)"}else{q.AlertUIIcon.style.color="rgb(180, 182, 186)";q.txtAlert.style.color="rgb(180, 182, 186)"}q.setDetail()}}}).inject(this.uiDefine);this.AlertUIIcon=UWA.createElement("span",{"class":"icon-desktop-popover",styles:{"font-size":"72px","margin-top":"6px",color:"rgb(180, 182, 186)"}}).inject(this.AlertUI);this.txtAlert=UWA.createElement("div",{text:i.alertIconText||"Alert",styles:{color:"rgb(180, 182, 186)"}}).inject(this.AlertUI);if(this.service!=="X3DMPNF_AP"&&this.service!=="X3DOPMR_AP"&&this.service!=="X3DPMMR_AP"&&this.service!=="X3DDASH_AP"){this.Mail=UWA.createElement("div",{styles:{width:"100%","text-align":"center",margin:"5px"},events:{mouseover:function(){q.Mail.style.cursor="pointer"},mouseout:function(){q.Mail.style.cursor="default"},click:function(r){q.notif_by_email=(q.notif_by_email===1)?0:1;q.dispatchEvent("updateSettings",[{id:q.appID,notif_by_ui:q.notif_by_ui,notif_by_email:q.notif_by_email,notif_by_browser:q.notif_by_browser}]);for(var s=0;s<q.idNotifs.length;s++){q.dispatchEvent("updateSettings",[{id:q.idNotifs[s],notif_by_ui:q.notif_by_ui,notif_by_email:q.notif_by_email,notif_by_browser:q.notif_by_browser}])}if(q.notif_by_email===1){q.MailIcon.style.color="rgb(54, 142, 196)";q.txtMail.style.color="rgb(54, 142, 196)"}else{q.MailIcon.style.color="rgb(180, 182, 186)";q.txtMail.style.color="rgb(180, 182, 186)"}q.setDetail()}}}).inject(this.uiDefine);this.MailIcon=UWA.createElement("span",{"class":"icon-desktop-email",styles:{"font-size":"72px","margin-top":"6px",color:"rgb(180, 182, 186)"},events:{mouseover:function(){q.MailIcon.style.cursor="pointer"},mouseout:function(){q.MailIcon.style.cursor="default"}}}).inject(this.Mail);this.txtMail=UWA.createElement("div",{text:i.mailIconText||"Mail",styles:{color:"rgb(180, 182, 186)"}}).inject(this.Mail)}if(typeof Notification!="undefined"){this.uiDefineBrowser=UWA.createElement("div",{styles:{width:"100%",display:"inline-flex",margin:"5px","margin-bottom":"15px"},}).inject(this.notifView);this.Browser=UWA.createElement("div",{styles:{width:"25%","text-align":"center",margin:"auto"},events:{mouseover:function(){q.Browser.style.cursor="pointer"},mouseout:function(){q.Browser.style.cursor="default"},click:function(r){var s=new b({renderTo:document.body});s.confirm(q.notif_by_browser===0?i.browserNotifActivateMsgForPopup:i.browserNotifDeactivateMsgForPopup,i.confirmMsg,function(t){if(t){q.notif_by_browser=(q.notif_by_browser===1)?0:1;if(q.notif_by_browser!=0){if(!Notification){alert("Desktop notifications not available in your browser. Try Chromium.");return}if(Notification.permission!=="granted"){Notification.requestPermission(function(v){if(v==="granted"){u()}else{if(v==="default"){q.notif_by_browser=0}}})}else{u()}}else{u()}function u(){q.dispatchEvent("updateSettings",[{id:q.appID,notif_by_ui:q.notif_by_ui,notif_by_email:q.notif_by_email,notif_by_browser:q.notif_by_browser}]);for(var v=0;v<q.idNotifs.length;v++){q.dispatchEvent("updateSettings",[{id:q.idNotifs[v],notif_by_ui:q.notif_by_ui,notif_by_email:q.notif_by_email,notif_by_browser:q.notif_by_browser}])}if(q.notif_by_browser===1){q.BrowserIcon.style.color="rgb(54, 142, 196)";q.txtBrowser.style.color="rgb(54, 142, 196)"}else{q.BrowserIcon.style.color="rgb(180, 182, 186)";q.txtBrowser.style.color="rgb(180, 182, 186)"}q.setDetail()}}})}}}).inject(this.uiDefineBrowser);this.BrowserIcon=UWA.createElement("span",{"class":"icon-desktop-empty",styles:{"font-size":"72px","margin-top":"6px",color:"rgb(180, 182, 186)"},events:{mouseover:function(){q.BrowserIcon.style.cursor="pointer"},mouseout:function(){q.BrowserIcon.style.cursor="default"}}}).inject(this.Browser);this.txtBrowser=UWA.createElement("div",{text:i.BrowserIconText||"Browser",styles:{color:"rgb(180, 182, 186)"}}).inject(this.Browser)}},setDetail:function(){if(this.notif_by_ui===1&&this.notif_by_email===1){this.appTitle.setDetailState("Center, Alerts, Mails")}else{if(this.notif_by_ui===1||this.notif_by_email===1){this.appTitle.setDetailState("Center, "+((this.notif_by_ui===1)?"Alerts":"Mails"))}else{this.appTitle.setDetailState("Center")}}},showDetail:function(){var l=this.appTitle.globalView.clientWidth+20;this.appDetailView.style.marginLeft=l+"px";this.appDetailView.style.display="block";var m=new UWA.Fx(this.appDetailView,{duration:300,transition:"linear"});m.start({marginLeft:"0px"})},hideDetail:function(){var n=this;var l=this.appDetailView.clientWidth+20;var m=new UWA.Fx(this.appDetailView,{duration:300,transition:"linear",events:{onComplete:function(o){n.appDetailView.style.display="none"}}});m.start({marginLeft:l+"px"})},displaySettings:function(m){var l=new UWA.Fx(this.notifView,{duration:400,transition:"linear"});if(!m){l.start({height:"0px"})}else{this.notifView.style.height="100%";this.hNotifs=this.notifView.clientHeight;l.start({height:["0px",this.hNotifs+"px"]})}},addSetting:function(n){var o=this;if(n.name==="GLOBAL"){this.appID=n.id;if(parseInt(n.notif_by_ui)===1){this.notif_by_ui=1;o.AlertUIIcon.style.color="rgb(54, 142, 196)";o.txtAlert.style.color="rgb(54, 142, 196)"}if(parseInt(n.notif_by_email)===1){this.notif_by_email=1;o.MailIcon.style.color="rgb(54, 142, 196)";o.txtMail.style.color="rgb(54, 142, 196)"}if(parseInt(n.notif_by_browser)===1){if(typeof Notification==="undefined"){console.log("Notification Object is Undefined for IE browser !!!!")}else{if(Notification.permission==="granted"){this.notif_by_browser=1;o.BrowserIcon.style.color="rgb(54, 142, 196)";o.txtBrowser.style.color="rgb(54, 142, 196)"}}}if(parseInt(n.subscribe)){this.appToogle.check();o.setDetail()}else{this.displaySettings(false);this.appTitle.setOff(true);this.appTitle.setDetailState("Off")}}else{this.idNotifs.push(n.id);var l=UWA.createElement("div",{styles:{display:"inline-flex",width:"100%","border-bottom":"1px solid #f1f1f1",opacity:"0.6"},}).inject(this.listNotifs);var q=UWA.createElement("textarea",{});q.innerHTML=n.name;var m=UWA.createElement("div",{text:q.value,styles:{margin:"auto",flex:"1",color:"rgb(119, 121, 124)","font-weight":"bold","font-size":"16px"},}).inject(l);var p=new g({type:"switch",value:"option2",label:"",events:{onChange:function(r){var s=0;if(p.isChecked()){s=1;l.style.opacity="1"}else{l.style.opacity="0.6"}o.dispatchEvent("updateSettings",[{id:n.id,subscribe:s}])}}}).inject(l);if(parseInt(n.subscribe)===1){p.check();l.style.opacity="1"}this.notifs[n.id]={notifToggle:p,tittleNotif:l}}},setSetting:function(l){if(this.notifs[l.ID]){this.notifs[l.ID].notifToggle.setCheck(parseInt(l.SUBSCRIBE)===1);if(this.notifs[l.ID].notifToggle.isChecked()){this.notifs[l.ID].tittleNotif.style.opacity="1"}else{this.notifs[l.ID].tittleNotif.style.opacity="0.6"}}},inject:function(l){this.globalView.inject(l)}});var j=a.extend(k,{init:function(l){h.log("NotificationSettingsView init");this.apps={};this.buildView(l);this.buildTitle()},buildView:function(l){var m=this;this.globalView=UWA.createElement("div",{styles:{margin:"auto",height:"100%",padding:"10px",position:"absolute",left:"0px",right:"0px",overflow:"hidden",background:"white","margin-left":l.left,"z-index":"2",display:"none"},});this.toolbarView=UWA.createElement("div",{id:"NotifToolbarSetting",styles:{display:"inline-flex",width:"100%",height:"44px","margin-top":"-10px",},events:{mousedown:function(n){m.settingIcon.style.color="#368ec4";m.toolbarView.style.color="#368ec4"},mouseup:function(n){m.settingIcon.style.color="#b4b6ba";m.toolbarView.style.color="#b4b6ba"},mouseover:function(){m.toolbarView.style.cursor="pointer";m.settingIcon.style.color="#3d3d3d";m.toolbarView.style.color="#3d3d3d"},mouseout:function(){m.toolbarView.style.cursor="default";m.settingIcon.style.color="#b4b6ba";m.toolbarView.style.color="#b4b6ba"},click:function(n){m.hide()}}}).inject(this.globalView);this.scroll=UWA.createElement("div",{"class":"scroller scroller-root",styles:{margin:"auto",overflow:"hidden",height:"calc(100% - 58px)","max-width":"680px"},}).inject(this.globalView);this.settingsView=UWA.createElement("div",{"class":"no-native-scrollbars  scroller-content",styles:{right:"-16px",bottom:"-16px","padding-right":"16px","padding-bottom":"16px"},}).inject(this.scroll)},buildTitle:function(l){var m=this;this.settingIcon=UWA.createElement("span",{"class":"fonticon handler fonticon-left-open-big",styles:{color:"#b4b6ba","font-size":"24px","margin-top":"5px"},events:{mousedown:function(n){m.settingIcon.style.color="#368ec4"},mouseup:function(n){m.settingIcon.style.color="#b4b6ba"},mouseover:function(){m.settingIcon.style.cursor="pointer";m.settingIcon.style.color="#3d3d3d"},mouseout:function(){m.settingIcon.style.cursor="default";m.settingIcon.style.color="#b4b6ba"},click:function(n){m.hide()}}}).inject(this.toolbarView);this.tittle=UWA.createElement("div",{text:i.settings,styles:{color:"#77797c","font-size":"14px",width:"100%",margin:"auto"},}).inject(this.toolbarView)},addSetting:function(m){var n=this;if(!this.apps[m.service]){var l=UWA.createElement("div",{id:"NotifAppDetail",styles:{margin:"auto",height:"100%",padding:"10px",position:"absolute",left:"0px",right:"0px",top:"0px",overflow:"hidden",background:"white",display:"none","z-index":"3"},}).inject(this.globalView);this.apps[m.service]=new d({service:m.service,serviceName:m.serviceName,detailView:l,icon:m.icon});this.apps[m.service].inject(this.settingsView);this.apps[m.service].addEvent("updateSettings",function(o){n.dispatchEvent("updateSettings",o)})}if(this.apps[m.service]){this.apps[m.service].addSetting(m)}},setSetting:function(l){this.apps[l.APPID].setSetting(l)},getView:function(){h.log("NotificationSettingsView getView");return this.globalView},show:function(){this.globalView.style.display="block";var l=new UWA.Fx(this.globalView,{duration:300,transition:"linear"});l.start({marginLeft:"0px"})},hide:function(){var m=this;var l=new UWA.Fx(this.globalView,{duration:300,transition:"linear",events:{onComplete:function(n){m.globalView.style.display="none"}}});l.start({marginLeft:this.globalView.clientWidth+"px"})}});return j});define("DS/NotificationsCenter/js/view/NotificationFilterTagsView",["UWA/Core","UWA/Controls/Abstract","UWA/Event","DS/UIKIT/Input/Text","DS/UIKIT/Touch","DS/UIKIT/Spinner","UWA/Utils"],function(f,g,i,d,c,e,h){var a=13,b="fonticon-cancel";return g.extend({defaultOptions:{text:null,onChange:function(){},onDestroy:function(){}},init:function(j){var k=this;k._parent(j);this.buildContainer()},destroy:function(){this.options.onDestroy();this._parent()},processChange:function(l,k){if(f.is(k.getParent("div"))){var j=(this.getSelected().indexOf(l)===-1);if(this.options.validator(l)&&j){this.options.text=l;k.getParent("div").removeClassName("has-error");this.getContent().setContent(this.setReadInput());this.asyncCheck()}else{k.focus();f.log(k);if(!k.getParent("div").hasClassName("has-error")){k.getParent("div").addClassName("has-error");if(this.options.onError&&j){this.options.onError()}}}}},setEditInput:function(){var j=this;this.input=new d({value:this.options.text,attributes:{type:"email",styles:{width:j.getContent().getSize().width},events:{keyup:function(k){k.preventDefault();k.stopPropagation();if(k.keyCode===a){j.processChange(this.value,this)}},blur:function(l){var k=this;l.preventDefault();l.stopPropagation();if(f.is(k)){setTimeout(function(){j.processChange(k.value,k)},100)}}}}});this.getContent().setContent(this.input);this.input.focus()},getButton:function(){var j=this;if(!this.button){this.button=f.createElement("button",{"class":"btn btn-default",html:{tag:"span","class":"fonticon fonticon-cancel"},events:{click:function(k){if(this.getElement(".fonticon").hasClassName(b)&&(k.detail===1||k.pointerType=="mouse")){j.destroy();i.stop(k)}}}})}return{tag:"span","class":"input-group-btn",html:this.button}},getInputText:function(){var j=this;this.inputText=f.createElement("span",{"class":"form-control",text:this.options.text,events:!j.isTouchActivate()?{dblclick:function(){j.setEditInput()}}:null});if(j.isTouchActivate()){this.touch=new c(this.inputText).on("hold",function(k){k.preventDefault();k.stopPropagation();j.setEditInput()})}return this.inputText},isTouchActivate:function(){return f.Utils.Client.Features.touchEvents},setReadInput:function(){return f.createElement("div",{"class":"input-group",html:[this.getInputText(),this.getButton()]})},buildContainer:function(){this.elements.container=f.createElement("div",{"class":"uwa-input-tags uwa-input",html:this.setReadInput()})},setLoading:function(k){var j=this.button.getElement(".fonticon");if(k){j.removeClassName(b);this.button.addClassName("is-loading");new e({visible:true}).inject(j)}else{this.button.removeClassName("is-loading");j.addClassName(b);j.setContent("")}},setError:function(l){var k=this.inputText,j=k.getParent("div");if(l){if(!j.hasClassName("has-error")){j.addClassName("has-error")}}else{j.removeClassName("has-error")}this.options.onChange()},asyncCheck:function(){var j=this;if(this.options.validatorAsync){this.setLoading(true);this.options.syncInputSize();this.options.validatorAsync(this.inputText.getText(),{onComplete:function(){j.getContent().setContent(j.setReadInput());j.setLoading();j.setError(false);j.options.syncInputSize()},onFailure:function(){j.setLoading();j.setError(true);j.options.syncInputSize()}})}},getSelected:function(){var j=[];this.elements.container.getParent().getElements(".uwa-input-tags span.form-control").forEach(function(k){j.push(k.getHTML())});return j}})});define("DS/NotificationsCenter/js/view/NotificationFilterTaggerView",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Input/Text","DS/NotificationsCenter/js/view/NotificationFilterTagsView","UWA/Utils"],function(e,d,b,a,c){return d.extend({defaultOptions:{validator:function(f){return(f.length>0)},onSuccess:function(){},onError:function(){},onLimitError:function(){},placeholder:"",limit:null,onChange:function(){}},isFirst:true,init:function(f){var g=this;g._parent(f);this.buildContainer();setTimeout(function(){g.elements.input.focus()},1)},buildContainer:function(){this.elements.container=e.createElement("div",{html:[{"class":"tags-input-wrapper",html:[{"class":"tag-wrapper"},{"class":"tag-input-wrapper",html:this.buildInput()}]},{"class":"clearfix"}]})},buildInput:function(){var f=this;this.elements.input=new b({className:"pull-right",attributes:{type:"email",placeholder:this.options.placeholder,autofocus:this.options.focus||null,events:{keydown:function(g){if(g.keyCode===9){f.paste(false,true)}},keyup:function(g){document.getElementsByClassName("RTFilterButton")[0].disabled=true;if(g.keyCode!==17){if(g.keyCode===13||g.keyCode===188){f.paste(false,true)}else{f.paste(true,true)}}},drop:function(){f.paste(false,true)},paste:function(){f.paste(false,true)},blur:function(){f.paste(false,false)}}}});return this.elements.input},paste:function(h,g){var f=this;setTimeout(function(){var o=f.elements.input.getValue(),p=o,m,q,j,i=f.elements.container.getElement(".tags-input-wrapper"),n=f.elements.container.getElement(".tag-input-wrapper"),l,k=true;if((h&&o.indexOf(";")>-1)||!h){m=o.split(";");m.forEach(function(s,r){if(s!==""){if(f.options.validator(s)&&(f.options.limit!==null&&f.getSelected().length<f.options.limit)){if(f.getSelected().indexOf(s)===-1){q=f.buildTag(s);q.inject(i);q.asyncCheck();j=(r+1===m.length)?"":";";o=o.replace(s+j,"")}}else{if(f.options.validator(s)&&f.getSelected().length===f.options.limit){if(!n.hasClassName("has-error")){n.addClassName("has-error");f.options.onLimitError()}}}}});if(o!==p){f.elements.input.setValue(o);f.syncInputSize();if(g){setTimeout(function(){f.elements.input.focus()},1)}}if(k){f.validate()}}},0)},buildTag:function(g){var f=this;return new a({text:g,onDestroy:function(){setTimeout(function(){f.syncInputSize();f.validate()},10)},onChange:function(){f.syncInputSize();f.validate()},onError:function(){f.syncInputSize();f.options.onError()},syncInputSize:f.syncInputSize.bind(this),validator:f.options.validator,validatorAsync:f.options.validatorAsync})},isFirstEmailAlreadySelected:function(){var g=this.elements.input.getValue(),f=g.split(";");return this.getSelected().indexOf(f[0])>-1},validate:function(){var f=this;setTimeout(function(){var g=f.elements.container.getElement(".tag-input-wrapper");if(g){if(f.elements.input.getValue()!==""||f.getContent().getElements(".uwa-input-split.has-error").length!==0){if(!g.hasClassName("has-error")){g.addClassName("has-error")}if(f.elements.input.getValue()!==""&&f.isFirstEmailAlreadySelected()){f.options.onError(true)}else{if(f.elements.input.getValue()!==""){f.options.onError()}else{f.options.onError(true)}}}else{g.removeClassName("has-error");f.options.onSuccess()}}},10)},proceedRemove:function(){var f=this.elements.container.getElements(".uwa-input-tags.focus");if(f.length>0){f.forEach(function(g){g.destroy()});this.syncInputSize()}else{f=this.elements.container.getElements(".uwa-input-tags");if(f.length>0){f[f.length-1].destroy();this.syncInputSize()}}this.validate()},syncInputSize:function(){var i=0,h=this,g=h.elements.container.getSize().width,j=g,f=[];h.elements.container.getElements(".uwa-input-tags").forEach(function(k){k.inject(h.elements.container.getElement(".tags-input-wrapper"))});h.elements.container.getElements(".uwa-input-tags").forEach(function(k){i=i+k.getDimensions().outerWidth;if(h.isFirst){i=i+5}f.push(k);if(i>g-200){f.forEach(function(l){h.elements.container.getElement(".tag-wrapper").grab(l)});f=[];i=0}});if(h.isFirst){h.isFirst=false}if(g-i>200){j=g-i}if(i>0){h.elements.container.getElement("input").setStyle("width",j-5)}else{h.elements.container.getElement("input").setStyle("width","100%")}h.options.onChange()},getSelected:function(){var f=[];this.elements.container.getElements(".uwa-input-tags span.form-control").forEach(function(g){f.push(g.getHTML())});return f}})});define("DS/NotificationsCenter/js/view/NotificationFilterView",["UWA/Class","UWA/Class/Events","UWA/Class/Model","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Form","DS/UIKIT/Input/Date","DS/UIKIT/DropdownMenu","DS/NotificationsCenter/js/view/NotificationFilterTaggerView","DS/UIKIT/Spinner","DS/W3DXLogger/W3DXLogger","DS/UWPClientCode/I18n","DS/PlatformAPI/PlatformAPI","i18n!DS/NotificationsCenter/assets/nls/feed","DS/UIKIT/Alert","DS/UIKIT/Autocomplete","css!NotificationsCenter/NotificationsCenter.css"],function(q,k,h,o,j,m,d,f,l,c,e,r,p,a,b,g,n){var i=new r({name:"3DNOTIF",debug:"debugNOTIF"});i.log("NotificationFilterView load");var s=q.extend(k,{init:function(t){i.log("3DNOTIF - NotificationFilterView init");this.showState=false;this.isFiltered=false;this.tenants=[];this.settings=[];this.buildView();this.buildListener()},buildListener:function(){var u=this;var t=new Date();this.addEvent("updateFilter",function(v){i.log("NotificationFilterView updateFilter")});this.addEvent("setDates",function(v){i.log("NotificationFilterView setFilterDates");u.fields[0].destroy();u.fields[1].destroy();u.fields[0]=new f({min:v,value:v,max:t}).inject(u.WhenView.firstChild);u.fields[1]=new f({min:v,value:t,max:t}).inject(u.WhenView.lastChild)});this.addEvent("setTenants",function(v){i.log("NotificationFilterView setFilterTenants");u.tenants=v;u.showTenants()});this.addEvent("setWhoSettings",function(w){i.log("NotificationFilterView setSettings");var z={name:"Settings"};z.items=[];var A=u.settings.reduce(function(C,B){C[B.serviceName]=C[B.serviceName]||[];C[B.serviceName].push({name:B.name,id:B.id});return C},{});var v=Object.keys(A).map(function(B){return{serviceName:B,setting:A[B]}});for(var y=0;y<v.length;y++){z.items.push({label:v[y].serviceName});z.items[y].items=[];for(var x=0;x<v[y].setting.length;x++){if(v[y].setting[x].name!=="GLOBAL"){z.items[y].items.push({value:v[y].setting[x].name,positionID:v[y].setting[x].id})}}}u.autocompleteHierarchicalInput.addDataset(z)})},buildView:function(){var u=this;var t=new Date();t.setDate(t.getDate()+1);this.globalView=UWA.createElement("div",{"class":"RTNotificationFilterView",styles:{display:"none",width:"92%",height:"auto",maxWidth:"680px",margin:"auto",marginBottom:"10px"}});this.labelViewWhen=UWA.createElement("div",{"class":"RTLabelView"}).inject(this.globalView);UWA.createElement("span",{"class":"fonticon fonticon-clock",styles:{color:"#77797c","font-size":"14px"}}).inject(this.labelViewWhen);UWA.createElement("span",{"class":"RTLabelText",text:"When"}).inject(this.labelViewWhen);this.filterForm=new d({className:"RTFilterForm",fields:[{max:t,name:"filterFormDate1",type:"date",placeholder:"dd / mm / yyyy"},{type:"date",max:t,value:t,name:"filterFormDate2",placeholder:"dd / mm / yyyy"}]}).inject(this.globalView);this.fields=this.filterForm.getFields();this.WhenView=UWA.createElement("div",{"class":"RTWhenView"});this.WhenView.inject(this.filterForm.elements.container,"top");this.labelViewWhen.inject(this.filterForm.elements.container,"top");this.toText=UWA.createElement("span",{"class":"RTLabelText",styles:{color:"#77797c","font-size":"14px",marginRight:"5px",marginLeft:"5px",marginTop:"12px"},text:b.get("to")}).inject(this.fields[1].parentElement,"before");this.WhenView.appendChild(this.fields[0].parentElement);this.WhenView.appendChild(this.toText);this.WhenView.appendChild(this.fields[1].parentElement);if(this.lastDate){this.fields[1].value=this.lastDate}this.labelViewWhat=UWA.createElement("div",{"class":"RTLabelView",styles:{marginTop:"0px"}}).inject(this.WhenView,"after");UWA.createElement("span",{"class":"fonticon fonticon-3ds-what",styles:{color:"#77797c","font-size":"14px"}}).inject(this.labelViewWhat);UWA.createElement("span",{"class":"RTLabelText",text:"What"}).inject(this.labelViewWhat);this.WhatView=UWA.createElement("div",{styles:{width:"100%",marginBottom:"10px"}}).inject(this.labelViewWhat,"after");this.tagger=new c({placeholder:b.get("NotifContent"),limit:5,focus:true,validator:function(v){return true},onError:function(v){},onLimitError:function(){},onSuccess:function(){u.FilterButton.disabled=false;var v=u.tagger.getSelected().length;if(u.tagger.elements.container.getElement(".has-error")===null){}else{}},onChange:function(){var v=u.tagger.getSelected().length}}).inject(this.WhatView);this.WhoView=UWA.createElement("div",{"class":"RTWhenView"}).inject(this.filterForm.elements.container);this.labelViewWho=UWA.createElement("div",{"class":"RTLabelView",styles:{marginTop:"0px"}}).inject(this.WhoView,"before");UWA.createElement("span",{"class":"fonticon fonticon-3ds-who",styles:{color:"#77797c","font-size":"14px"}}).inject(this.labelViewWho);UWA.createElement("span",{"class":"RTLabelText",text:"Who"}).inject(this.labelViewWho);this.autocompleteHierarchicalInput=new n({multiSelect:true,showSuggestsOnFocus:true,placeholder:b.SettingsName,noResultsMessage:b.NoSettingsName});this.autocompleteHierarchicalInput.elements.container.style.width="100%";this.autocompleteHierarchicalInput.inject(this.WhoView,"bottom");this.filtersConfirmation=UWA.createElement("div",{"class":"modal-footer RTFilterConfirmation"}).inject(this.globalView);this.FilterButton=new UWA.Element("button",{"class":"btn btn-primary btn-sm RTFilterButton",text:b.filter,events:{click:function(){var B=[],z=u.filterForm.getValues(),x=[],y=u.autocompleteHierarchicalInput.getSelection();if(y){for(var w=0;w<y.length;w++){x.push(y[w].positionID)}}z.whoSettings=x;if(u.tenants&&u.tenants.length!==0){for(var w=0;w<u.tenants.length;w++){if(z[u.tenants[w].displayName]==="true"){B.push(u.tenants[w].PLATFORMID)}}z.tenants=B}z.what=u.tagger.getSelected();z.first_date=u.fields[0].getDate();var v=new Date(u.fields[1].getDate());v.setDate(v.getDate()+1);z.last_date=v;if(z.first_date<z.last_date){a.publish("3dnotifinterne",{action:"filter",values:z});u.isFiltered=true;u.dispatchEvent("Filtering",true)}else{var A=new g({visible:true,autoHide:true,hideDelay:3000,}).inject(u.globalView,"before");A.add({className:"error",message:"Wrong date range. Please correct it"})}}}}).inject(this.filtersConfirmation);this.ResetButton=new UWA.Element("button",{"class":"btn btn-default btn-sm RTFilterButton",text:b.reset,events:{click:function(){u.dispatchEvent("Resetting",true);u.autocompleteHierarchicalInput.reset();u.filterForm.reset();var v=u.WhatView.getElements(".uwa-input-tags");if(v.length>0){for(var w=0;w<v.length;w++){v[w].destroy()}u.tagger.syncInputSize()}if(u.fields){for(var w=0;w<u.fields.length;w++){u.fields[w].elements.content.value="dd / mm / yyyy"}}u.isFiltered=false}}}).inject(this.filtersConfirmation);this.CancelButton=new UWA.Element("button",{"class":"btn btn-default btn-sm RTFilterButton",text:b.close,events:{click:function(){u.dispatchEvent("Canceling",true);u.hide()}}}).inject(this.filtersConfirmation)},refresh:function(){var t=this;this.cleanAll()},cleanAll:function(t){this.section=[]},getView:function(){i.log("NotificationFilterView getView");return this.globalView},hide:function(){this.showState=false;this.globalView.style.display="none"},show:function(){this.showState=true;this.globalView.style.display=""},showTenants:function(){if(this.tenants.length!==0){this.labelViewWhere=UWA.createElement("div",{"class":"RTLabelView"}).inject(this.filterForm.elements.container);this.whereView=UWA.createElement("div",{"class":"RTWhereView"}).inject(this.filterForm.elements.container);UWA.createElement("span",{"class":"fonticon fonticon-3ds-where",styles:{color:"#77797c","font-size":"14px"}}).inject(this.labelViewWhere);UWA.createElement("span",{"class":"RTLabelText",text:"Where"}).inject(this.labelViewWhere);var u=0;for(var t=0;t<this.tenants.length;t++){if(this.tenants[t].displayName){if(this.tenants[t].displayName.toLowerCase()!=="null"){new m({type:"checkbox",name:this.tenants[t].displayName,value:this.tenants[t].displayName,className:"RTFilterToggle"}).inject(this.whereView);this.whereView.children[u].style["margin-top"]="0px";u++}}}}},setDate:function(t){this.fields[1].setValue(t);this.fields[1].min=t},dateStringify:function(t){var u=function(v){var w=v+"";if(w.length===1){return("0"+w)}else{return w}};return t.getFullYear()+"-"+u(t.getMonth()+1)+"-"+u(t.getDate())+" "+u(t.getHours())+":"+u(t.getMinutes())+":"+u(t.getSeconds())}});return s});define("DS/NotificationsCenter/js/view/NotificationCenterView",["UWA/Class","UWA/Class/Events","UWA/Class/Model","UWA/Class/Collection","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Scroller","DS/NotifAlert/NotifAlert","DS/UIKIT/DropdownMenu","DS/UIKIT/SuperModal","DS/UIKIT/Spinner","DS/W3DXLogger/W3DXLogger","DS/UWPClientCode/I18n","DS/W3DXTimeline/Timeline","DS/NotificationsCenter/js/view/NotificationFilterView","i18n!DS/NotificationsCenter/assets/nls/feed"],function(o,i,f,s,l,h,j,q,d,k,n,e,p,m,c,r,a){var g=new p({name:"3DNOTIF",debug:"debugNOTIF"});g.log("NotificationCenterView load");var b=o.extend(i,{init:function(t){g.log("3DNOTIF - NotificationCenterView init");this.section={};this.numRead=0;this.numFound=0;this.numMerged=0;this.showSpinner=false;this.alerts={};this.isFiltering=false;this.isInject=false;this.withRead="all";this.buildView();this.buildTitle();this.buildNoNotifs();this.buildListner();var u=new UWA.Class.Collection();this.timeLine=new c({itemView:d,collection:u,pictureSize:"48px",removeTime:false,removeCircle:false})},buildListner:function(){var t=this;this.addEvent("updatePicture",function(u){g.log("NotificationCenterView updatePicture");t.timeLine.dispatchEvent("updatePicture",u)});this.notificationFilterView.addEvent("Filtering",function(u){g.log("NotificationCenterView filtering");if(u){t.cleanAll();if(!t.showSpinner){t.spinner=new e().inject(t.noNotif,"after").show();t.showSpinner=true}t.isFiltering=true;t.numMerged=0}});this.notificationFilterView.addEvent("Resetting",function(u){g.log("NotificationCenterView Resetting");if(u){t.filteringIcon.style.color="#b4b6ba";t.cleanAll();t.dispatchEvent("getUnreadTotal");t.dispatchEvent("getHistory","all");t.isFiltering=false;t.numMerged=0}});this.notificationFilterView.addEvent("Canceling",function(u){g.log("NotificationCenterView Canceling");t.numMerged=0;if(u){t.filteringIcon.style.color="#b4b6ba"}});this.addEvent("setTenants",function(u){g.log("NotificationCenterView setTenants");t.notificationFilterView.dispatchEvent("setTenants",[JSON.parse(u.src.tenants)])});this.addEvent("setWhoSettings",function(u){g.log("NotificationCenterView setWhoSettings");t.notificationFilterView.dispatchEvent("setWhoSettings",u.src.settings)});this.addEvent("setDates",function(u){g.log("NotificationCenterView setDates");var v=JSON.parse(u.src.Dates);t.notificationFilterView.dispatchEvent("setDates",new Date(v[0].FIRST_DATE))})},buildView:function(){var t=this;this.globalView=UWA.createElement("div",{"class":"RTNotificationCenter",styles:{margin:"auto",height:"100%",padding:"10px",position:"absolute",left:"0px",right:"0px",overflow:"hidden"},});this.toolbarView=UWA.createElement("div",{styles:{display:"inline-flex",width:"100%",margin:"10px 0px",height:"44px","margin-top":"-10px"},}).inject(this.globalView);this.noNotif=UWA.createElement("div",{"class":"NotifZero",styles:{height:"calc(100% - 58px)","max-width":"680px","text-align":"center","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",margin:"auto",display:"none"},}).inject(this.globalView);this.alertsView=UWA.createElement("div",{});this.scrollerView=new q({element:UWA.createElement("div",{"class":"scrollable-body",styles:{margin:"auto",overflow:"hidden",height:"calc(100% - 58px)","max-width":"680px"},html:this.alertsView})}).inject(this.globalView);this.scrollerView.elements.content.onscroll=function(w){if(t.shareDropdownMenu.elements.container.style.display!=="none"){t.shareDropdownMenu.elements.container.style.display="none";t.settingIcon.style.color="#b4b6ba"}t.shareDropdownMenu.elements.container.style.display="none";if((w.currentTarget.scrollHeight-w.currentTarget.scrollTop-w.currentTarget.clientHeight)<2){if(!t.isFiltering){t.displaySpinner(true);t.dispatchEvent("getMoreHistory",t.withRead)}else{}}};this.spinnerView=UWA.createElement("div",{styles:{margin:"auto","max-width":"680px","text-align":"center",display:"none"},}).inject(this.globalView);var v=new e().inject(this.spinnerView).show();this.initialSpinnerView=UWA.createElement("div",{styles:{margin:"auto","max-width":"680px","text-align":"center",display:"block",position:"absolute",top:"38%","padding-left":"44%"},}).inject(this.globalView);var u=new e().inject(this.initialSpinnerView).show()},buildNoNotifs:function(){UWA.createElement("span",{"class":"fonticon handler fonticon-bell",styles:{color:"#d1d4d4","font-size":"90px","margin-top":"50px",opacity:"0.6"}}).inject(this.noNotif);UWA.createElement("div",{text:a.noNotifications,styles:{color:"#d1d4d4","font-size":"24px",width:"100%","text-align":"center",opacity:"0.6"}}).inject(this.noNotif);this.filteringIconSpan.style.display="none"},buildTitle:function(t){var u=this;this.unreadNotif=UWA.createElement("div",{styles:{color:"#77797c","font-size":"14px",width:"100%",margin:"auto"},}).inject(this.toolbarView);this.filteringIconSpan=UWA.createElement("span",{styles:{color:"#b4b6ba",background:"white",height:"44px",width:"44px",position:"absolute",right:"44px",top:"0px","text-align":"center"},events:{mouseover:function(){u.filteringIconSpan.style.cursor="pointer";u.filteringIconSpan.style.background="#e4e4e4"},mouseout:function(){u.filteringIconSpan.style.cursor="default";u.filteringIconSpan.style.background="#ffffff"}}}).inject(this.toolbarView);this.notificationFilterView=new r();this.notificationFilterView.getView().inject(u.scrollerView.elements.container.firstChild,"top");this.filteringIconSpan.onclick=function(){if(u.filteringIcon.style.color.rgbToHex()==="#b4b6ba"){u.filteringIcon.style.color="#368ec4"}else{if(!u.notificationFilterView.isFiltered){u.filteringIcon.style.color="#b4b6ba"}}if(!u.notificationFilterView.showState){u.notificationFilterView.show()}else{u.notificationFilterView.hide()}};this.filteringIcon=UWA.createElement("span",{"class":"fonticon fonticon-filter",title:a.filter,styles:{color:"#b4b6ba","font-size":"20px","margin-top":"7px",}}).inject(this.filteringIconSpan);this.settingIconSpan=UWA.createElement("span",{title:a.settingsDownM,styles:{color:"#b4b6ba",background:"white",height:"44px",width:"44px",position:"absolute",right:"0px",top:"0px","text-align":"center"},events:{mouseover:function(){u.settingIconSpan.style.cursor="pointer";u.settingIconSpan.style.background="#e4e4e4"},mouseout:function(){u.settingIconSpan.style.cursor="default";u.settingIconSpan.style.background="#ffffff"}}}).inject(this.toolbarView);this.settingIconSpan.onclick=function(){if(u.settingIcon.style.color.rgbToHex()==="#b4b6ba"){u.settingIcon.style.color="#368ec4"}else{u.settingIcon.style.color="#b4b6ba"}};this.settingIcon=UWA.createElement("span",{"class":"fonticon handler fonticon-cog",styles:{color:"#b4b6ba","font-size":"20px","margin-top":"7px",}}).inject(this.settingIconSpan);this.shareDropdownMenu=new k({target:this.settingIconSpan,items:[{id:"1",text:a.showAll,name:"all",icon:"fonticon fonticon-check"},{id:"2",text:a.readOnly,name:"read",disabled:true},{className:"divider"},{id:"3",text:a.markAllAsRead,name:"allread",disabled:true},{id:"4",text:a.markAllAsUnread,name:"allunread",disabled:true},{id:"5",text:a.deleteAll,name:"deleteall",disabled:true},{className:"divider"},{id:"6",text:a.settingsDownM,name:"settings"}],events:{onClick:function(w,v){switch(v.name){case"settings":u.dispatchEvent("settings");break;case"all":u.shareDropdownMenu.updateItem({id:"1",text:a.showAll,name:"all",icon:"fonticon fonticon-check"});u.shareDropdownMenu.updateItem({id:"2",text:a.readOnly,name:"read",icon:""});var x=u.shareDropdownMenu.getItem("2");if(x.elements&&x.elements.container&&x.elements.container.firstChild&&!x.elements.container.firstChild.className){x.elements.container.firstChild.destroy()}u.cleanAll();u.initialSpinnerView.style.display="block";u.withRead="all";u.dispatchEvent("getHistory","all");break;case"read":u.shareDropdownMenu.updateItem({id:"1",text:a.showAll,name:"all",icon:""});u.shareDropdownMenu.updateItem({id:"2",text:a.readOnly,name:"read",icon:"fonticon fonticon-check"});var x=u.shareDropdownMenu.getItem("1");if(x.elements&&x.elements.container&&x.elements.container.firstChild&&!x.elements.container.firstChild.className){x.elements.container.firstChild.destroy()}u.cleanAll();u.initialSpinnerView.style.display="block";u.withRead="unread";u.dispatchEvent("getHistory","unread");break;case"allread":u.markAll({read:true});break;case"allunread":u.markAll({read:false});break;case"deleteall":u.deleteAll();break}},onHide:function(){u.settingIcon.style.color="#b4b6ba"}}})},buildToolBar:function(){var t=this;this.groupB=UWA.createElement("div",{styles:{width:"100%"},}).inject(this.toolbarView);this.selectView=UWA.createElement("div",{styles:{width:"140px"},}).inject(this.groupB);var u=new j({placeholder:false,options:[{value:"1",label:a.showAll,selected:true},{value:"2",label:a.readOnly}],events:{onChange:function(v){var w=u.getValue();t.cleanAll();t.dispatchEvent("getHistory",(w[0]==="1")?"all":"unread")}}}).inject(this.selectView);this.markAllIcon=UWA.createElement("span",{text:a.markAllAsRead,styles:{color:"#368EC4","font-weight":"bold","min-width":"150px",margin:"auto","font-size":"13px","text-align":"right"},events:{click:function(v){if(t.markAllIcon.innerText===a.markAllAsRead){t.markAll({read:true});t.markAllIcon.innerText=a.markAllAsUnread}else{t.markAll({read:false});t.markAllIcon.innerText=a.markAllAsRead}},mouseover:function(){t.markAllIcon.style.cursor="pointer";t.markAllIcon.style.textDecoration="underline"},mouseout:function(){t.markAllIcon.style.cursor="default";t.markAllIcon.style.textDecoration=""}}}).inject(this.toolbarView)},addNotification:function(D,B){this.initialSpinnerView.style.display="none";this.displayNoNotification(false);this.disableMenu(false);this.filteringIconSpan.style.display="";var A=this;var C=D.MESSAGE;var v=(!C.icon||(C.icon&&C.icon.type&&C.icon.type==="appID"));var z;var w=UWA.Class.Collection.extend({model:f});var t=new w();if(D.notifications){for(var x=0;x<D.notifications.length;x++){var u=D.notifications[x];z=new f({id:u.ID,img:u.MESSAGE.icon,text:decodeURI(encodeURI(u.MESSAGE.nls.msg)),options:u.MESSAGE.actions,appIconBorder:v,listOfService:A.listOfService,readState:(u.READ_DATE)?true:false,isInNotifCenter:true,actioned:(!u.ACTION_DATE||u.ACTION_DATE==="0000-00-00 00:00:00")?false:true,provider:u.APPID,viewIndex:A.numMerged,merged:true,creationDate:u.CREATION_DATE,platformId:u.PLATFORMID?u.PLATFORMID:"",state:u.STATE,actionedLabel:u.ACTION,actor_data:u.ACTOR_DATA});t.add(z);z.addEvent("read",function(E){A.dispatchEvent("read",E)});z.addEvent("actioned",function(E){A.dispatchEvent("actioned",E)});z.addEvent("updateLabel",function(E){A.dispatchEvent("updateLabel",E)});z.addEvent("unsubscribe",function(E){A.numRead--;A.dispatchEvent("unsubscribe",[{id:u.ID,subscribe:0}])});z.addEvent("publish",function(E){A.dispatchEvent("publish",E)});z.addEvent("deleteCenter",function(E){A.dispatchEvent("delete",{id:E.id})})}}else{t=null}var y=new f({id:D.ID,img:C.icon,text:decodeURI(encodeURI(C.nls.msg)),options:C.actions,appIconBorder:v,listOfService:A.listOfService,readState:(D.READ_DATE)?true:false,isInNotifCenter:true,actioned:(!D.ACTION_DATE||D.ACTION_DATE==="0000-00-00 00:00:00")?false:true,provider:D.APPID,notifications:(D.notifications)?D.notifications:null,platformId:D.PLATFORMID?D.PLATFORMID:"",date:Date.parse(D.CREATION_DATE),actionedLabel:D.ACTION,actor_data:D.ACTOR_DATA,mergedCollection:t});if(!this.isInject){this.timeLine.inject(this.alertsView);this.isInject=true}this.timeLine.add(y,B);y.addEvent("readCenter",function(E){if(E.read){if(!E.flag){A.numRead--}}else{A.numRead++}A.dispatchEvent("read",E);if(!A.notificationFilterView.isFiltered){A.setNumOfUnread(A.numRead)}if(A.withRead==="unread"){this.dispatchEvent("deleteView",E)}});y.addEvent("readMerged",function(E){A.dispatchEvent("read",E)});y.addEvent("actioned",function(E){A.dispatchEvent("actioned",E)});y.addEvent("updateLabel",function(E){A.dispatchEvent("updateLabel",E)});y.addEvent("unsubscribeCenter",function(E){g.log("unsubscribe");A.numRead--;A.dispatchEvent("unsubscribe",[{id:D.ID,subscribe:0}])});y.addEvent("publish",function(E){A.dispatchEvent("publish",E)});y.addEvent("deleteMerged",function(E){A.dispatchEvent("delete",{id:E.id})});y.addEvent("deleteCenter",function(E){if(!E.read){A.numRead--;A.numFound--;if(!A.notificationFilterView.isFiltered){A.setNumOfUnread(A.numRead)}else{A.setNumOfFound(A.numFound)}}if(!A.timeLine.getElement(".TL-section")){A.cleanAll();A.displayNoNotification(true);A.filteringIconSpan.style.display="none"}A.dispatchEvent("delete",{id:D.ID,read:E.read})});if(D.REFRESH){A.cleanAll();A.withRead="all";A.dispatchEvent("getHistory","all")}},markAll:function(t){this.timeLine.markAll(t);this.dispatchEvent("readAll",[{read:t.read}]);this.numRead=0;if(!this.notificationFilterView.isFiltered){this.setNumOfUnread(this.numRead)}if(!t.read){var u=this;setTimeout(function(){u.dispatchEvent("getUnreadTotal",[])},500)}if(t.read&&this.withRead==="unread"){this.cleanAll();this.displayNoNotification(true)}else{if(!t.read&&this.withRead==="unread"){u.cleanAll();u.initialSpinnerView.style.display="block";u.withRead="unread";setTimeout(function(){u.dispatchEvent("getHistory","unread")},500)}}},deleteAll:function(t){var v=this;var u=new n({renderTo:document.body});u.confirm(a.deleteMsgForPopup,a.confirmMsg,function(w){console.log("Confirm result: "+w);if(w){v.cleanAll();v.numRead=0;v.setNumOfUnread(v.numRead);v.dispatchEvent("deleteAllNotification",[]);v.displayNoNotification(true);v.filteringIconSpan.style.display="none"}})},refresh:function(){var t=this;this.cleanAll();this.numRead=0;this.displayNoNotification(true);this.dispatchEvent("getHistory","all");this.setNumOfUnread(this.numRead);setTimeout(function(){t.dispatchEvent("getUnreadTotal",[])},500)},cleanAll:function(t){for(var v in this.alerts){delete this.alerts[v]}while(this.alertsView.firstChild){this.alertsView.removeChild(this.alertsView.firstChild)}this.numMerged=0;this.section=[];this.disableMenu(true);var u=new UWA.Class.Collection();this.timeLine=new c({itemView:d,collection:u,pictureSize:"48px",removeTime:false,removeCircle:false});this.isInject=false},setNumOfUnread:function(t){if(t===1){this.unreadNotif.style.display="block";this.unreadNotif.innerHTML="<strong>"+t+" "+a.oneNotification+"</strong> "}else{if(t>1){this.unreadNotif.style.display="block";this.unreadNotif.innerHTML="<strong>"+t+" "+a.notifications+"</strong> "}else{this.unreadNotif.innerHTML="";this.unreadNotif.style.display="none"}}},setNumOfFound:function(t){if(t===1){this.unreadNotif.style.display="block";this.unreadNotif.innerHTML="<strong>"+t+" "+a.onefoundNotifications+"</strong> "}else{if(t>1){this.unreadNotif.style.display="block";this.unreadNotif.innerHTML="<strong>"+t+" "+a.foundNotifications+"</strong> "}else{this.unreadNotif.innerHTML="";this.unreadNotif.style.display="none"}}},getView:function(){g.log("NotificationCenterView getView");return this.globalView},displayNoNotification:function(t){if(t){this.noNotif.style.display="block"}else{this.noNotif.style.display="none"}},disableMenu:function(t){this.shareDropdownMenu.updateItem({id:"2",disabled:t});this.shareDropdownMenu.updateItem({id:"3",disabled:t});this.shareDropdownMenu.updateItem({id:"4",disabled:t});this.shareDropdownMenu.updateItem({id:"5",disabled:t})},displaySpinner:function(t){if(t){this.spinnerView.style.display="block"}else{this.spinnerView.style.display="none"}},deleteNotification:function(t){this.timeLine.deleteView(t)}});return b});define("DS/NotificationsCenter/js/controller/NotificationCenterController",["UWA/Class","UWA/Class/Events","DS/PlatformAPI/PlatformAPI","DS/NotificationsCenter/js/view/NotificationCenterView","DS/NotificationsCenter/js/view/NotificationSettingsView","DS/W3DXLogger/W3DXLogger","i18n!DS/NotificationsCenter/assets/nls/feed","DS/UIKIT/SuperModal","css!NotificationsCenter/assets/fonticons/fontNotificationStyle.css"],function(b,l,h,f,k,d,j,c){var i=new d({name:"3DNOTIF",debug:"debugNOTIF"});i.log("NotificationCenterController load");var e={};var g=undefined;var a=b.extend(l,{init:function(){i.log("NotificationCenterController init");this.centerView=undefined;this.settingsView=undefined;this.listOfService=undefined;this.oldNotif={CREATION_DATE:undefined,ID:undefined};this.buildView();this.buildMessagelistner();this.getServices();this.getHistory("all");this.getUnreadTotal();this.getUnreadTotalFlag=true;this.groupIDs=[];this.getSettings();this.getTenants();this.getDates();this.resetNotifications()},buildView:function(){var m=this;this.centerView=new f();this.centerView.addEvent("read",function(n){if(n&&n.id){var o={action:"notificationRead",id:n.id,read:n.read,actioned:n.actioned};h.publish("3dnotifinterne",o)}});this.centerView.addEvent("readAll",function(n){if(n&&n.read!==undefined){var o={action:"notificationRead",read:n.read,scope:true};h.publish("3dnotifinterne",o)}});this.centerView.addEvent("actioned",function(n){if(n&&n.id){var o={action:"actioned",params:{id:n.id,actioned:true}};h.publish("3dnotifinterne",o)}});this.centerView.addEvent("updateLabel",function(n){if(n&&n.id){var o={action:"notificationRead",updateLabel:"updateLabel",params:{id:n.id,label:n.label,flag:n.flag}};h.publish("3dnotifinterne",o)}});this.centerView.addEvent("getHistory",function(n){m.getHistory(n)});this.centerView.addEvent("deleteAllNotification",function(n){m.deleteAllNotification(n)});this.centerView.addEvent("publish",function(n){h.publish(n.topic,n.data)});this.centerView.addEvent("delete",function(n){if(n&&n.id){var o={action:"notificationDelete",id:n.id,read:n.read};h.publish("3dnotifinterne",o)}});this.centerView.addEvent("settings",function(n){if(m.settingsView){m.settingsView.show()}});m.centerView.addEvent("updateSettings",function(n){m.updateSettings(n)});m.centerView.addEvent("unsubscribe",function(n){m.unsubscribe(n)});m.centerView.addEvent("getMoreHistory",function(n){m.getMoreHistory(n)});m.centerView.addEvent("getUnreadTotal",function(n){m.getUnreadTotal()});if(typeof widget!=="undefined"&&widget.environment){widget.environment.onResize=function(n){m.centerView.notificationFilterView.tagger.syncInputSize()}}},buildMessagelistner:function(){i.log("NotificationCenterController buildMessagelistner");var m=this;h.subscribe("3dnotifinterne",function(q){switch(q.action){case"rollbackPopup":var p,s;if(q.params.isInNotifCenter){p=document.body;s=j.rollbackPopupTitleForNotifCenter}else{p=parent.document.body;s=j.rollbackPopupTitleFor3DDashboard}var o=new c({renderTo:p});o.confirm(j.rollbackPopupMsg,s,function(t){h.publish("3dnotifinterne",{action:"rollbackPopupconfirmation",file:q.params.file,id:q.params.id,confirmPopupResult:t})});break;case"refreshForRollback":m.centerView.cleanAll();m.centerView.withRead="all";m.centerView.dispatchEvent("getHistory","all");break;case"addNotification":var r=JSON.parse(q.notification);m.addNotification(r,"top");m.centerView.numRead++;m.centerView.setNumOfUnread(m.centerView.numRead);break;case"setHistory":var n=JSON.parse(q.notifications);if((q.language)&&(m.centerView.timeLine.language!=q.language)){m.centerView.timeLine.language=q.language}m.centerView.initialSpinnerView.style.display="none";if(n.length===0&&m.centerView.globalView.getElementsByClassName("RTMainNotifAlert").length===0){m.centerView.initialSpinnerView.style.display="none";m.centerView.displayNoNotification(true)}else{m.centerView.displayNoNotification(false)}if(!this.getUnreadTotalFlag){m.getUnreadTotal()}else{this.getUnreadTotalFlag=false}m.setHistory(n);break;case"setAppInfos":m.centerView.dispatchEvent("updatePicture",[{src:q.src,notifID:q.notifID}]);break;case"setTenants":m.centerView.dispatchEvent("setTenants",[{src:q}]);break;case"setDates":m.centerView.dispatchEvent("setDates",[{src:q}]);break;case"setNotifications":var n=JSON.parse(q.notifications);if(!n.length){n.length=0;m.centerView.numFound=0}else{m.centerView.numFound=n.length}m.centerView.spinner.elements.container.style.display="none";m.setHistory(n);break;case"setServices":m.listOfService=q.services;break;case"setWhoSettings":m.centerView.dispatchEvent("setWhoSettings",[{src:q.settings}]);break;case"setSettings":m.setSettings(q.settings,widget.body);break;case"setSetting":if(m.settingsView){m.settingsView.setSetting(q.setting)}if(m.centerView){m.centerView.refresh()}break;case"setUnreadTotal":m.centerView.numRead=q.unread;m.centerView.setNumOfUnread(q.unread);break;case"setFilteredTotal":if(q.count===0){m.centerView.spinner.elements.container.style.display="none"}m.centerView.numFound=q.count;m.centerView.unreadNotif.innerHTML="<strong>"+q.count+" "+j.foundNotifications+"</strong> ";break;case"read":if(!q.params.scope){if(m.centerView&&m.centerView.timeLine&&m.centerView.timeLine.alertlist&&m.centerView.timeLine.alertlist[q.params.id]&&m.centerView.timeLine.alertlist[q.params.id].alert&&m.centerView.timeLine.alertlist[q.params.id].timeView&&m.centerView.timeLine.alertlist[q.params.id].circleView){m.centerView.timeLine.alertlist[q.params.id].alert.setReadstate(q.params.read);if(q.params.read){m.centerView.timeLine.alertlist[q.params.id].timeView.style.opacity="0.6";m.centerView.timeLine.alertlist[q.params.id].circleView.style.background="";m.centerView.numRead--;m.centerView.setNumOfUnread(m.centerView.numRead)}else{m.centerView.timeLine.alertlist[q.params.id].timeView.style.opacity="1";m.centerView.timeLine.alertlist[q.params.id].circleView.style.background="rgb(54, 142, 196)";m.centerView.numRead++;m.centerView.setNumOfUnread(m.centerView.numRead)}}}else{m.centerView.timeLine.markAll(q.params);if(!q.params.read){setTimeout(function(){m.dispatchEvent("getUnreadTotal",[])},500)}else{m.centerView.numRead=0;m.centerView.setNumOfUnread(m.centerView.numRead)}}break;case"delete":if(m.centerView&&m.centerView.timeLine&&m.centerView.timeLine.alertlist&&m.centerView.timeLine.alertlist[q.params.id]&&m.centerView.timeLine.alertlist[q.params.id].alert&&m.centerView.timeLine.alertlist[q.params.id].timeView&&m.centerView.timeLine.alertlist[q.params.id].circleView){m.centerView.deleteNotification(q.params);if(!q.params.read){m.centerView.numRead--;m.centerView.setNumOfUnread(m.centerView.numRead)}}break;case"updateLabel":if(m.centerView&&m.centerView.timeLine&&m.centerView.timeLine.alertlist&&m.centerView.timeLine.alertlist[q.params.id]&&m.centerView.timeLine.alertlist[q.params.id].alert){m.centerView.timeLine.alertlist[q.params.id].alert.updateActionedLabel(q.params.label,q.params.flag)}}})},setHistory:function(n){var r=this;i.log("NotificationCenterController setHistory");this.centerView.displaySpinner(false);var q=new Date(this.oldNotif.CREATION_DATE);for(var p=0;p<n.length;p++){var m=n[p],o;if(m.notifications){m.notifications=JSON.parse(m.notifications);this.groupIDs.push(m.GROUPID)}o=new Date(n[p].CREATION_DATE);if(!this.oldNotif.CREATION_DATE||q>o){this.oldNotif.ID=n[p].ID;this.oldNotif.CREATION_DATE=n[p].CREATION_DATE;q=new Date(this.oldNotif.CREATION_DATE)}this.addNotification(m)}},setSettings:function(o,m){var p=this;if(!this.settingsView){this.settingsView=new k({left:m.clientWidth});this.settingsView.addEvent("updateSettings",function(q){p.updateSettings(q)});this.settingsView.getView().inject(m)}if(o){for(var n=0;n<o.length;n++){if(o[n].service!=="X3DNTFC_AP"){this.settingsView.addSetting(o[n]);this.centerView.notificationFilterView.settings.push(o[n])}}}},getIconUrl:function(p){switch(p.icon.type){case"url":var n;if(typeof p.icon.data==="object"){if(p.platformId&&p.platformId!=="null"){n=this.getServiceUrl({name:p.icon.data.service,platformId:p.platformId})}else{if(!p.icon.data.service){if(this.checkIfIsUrl(p.icon.data)){return p.icon.data}else{return"./../../resources/en/1/webapps/NotifAlert/assets/icons/notificon.png"}}else{for(var m in this.listOfService[0]){if(p.icon.data.service.toLowerCase()===m.toLowerCase()){return this.listOfService[0][m]+p.icon.data.uri}}}}}else{return p.icon.data}if(n){return n+p.icon.data.uri}return undefined;case"login":var n=this.getServiceUrl({name:"3dswym",platformId:p.platformId});var o;if(n==="/"){o="api/user/getpicture/login/"}else{o="/api/user/getpicture/login/"}return n+o+p.icon.data+"/format";case"app":this.getAppInfos({id:p.icon.data});return undefined}},checkIfIsUrl:function(n){var m=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return m.test(n)},getCsrfUrl:function(m){var n="/api/index/tk/";return this.listOfService[0]["3dswym"]+n},deleteAllNotification:function(n){i.log("NotificationCenterController deleteAllNotification");var m={action:"deleteAllNotification"};h.publish("3dnotifinterne",m)},getHistory:function(n){i.log("NotificationCenterController getHistory");this.oldNotif={CREATION_DATE:undefined,ID:undefined};this.groupIDs=[];var m={action:"getHistory",type:n};h.publish("3dnotifinterne",m)},getTenants:function(m){i.log("NotificationCenterController getTenants");var n={action:"getTenants"};h.publish("3dnotifinterne",n)},getDates:function(m){i.log("NotificationCenterController getDate");var n={action:"getDates"};h.publish("3dnotifinterne",n)},getUnreadTotal:function(n){i.log("NotificationCenterController getUnreadTotal");var m={action:"getUnreadTotal"};h.publish("3dnotifinterne",m)},getAppInfos:function(m){i.log("NotificationCenterController getAppInfos");var n={action:"getAppInfos",appID:m.appID,notifID:m.notifID};h.publish("3dnotifinterne",n)},getServices:function(){i.log("NotificationCenterController getServices");var m={action:"getServices"};h.publish("3dnotifinterne",m)},getSettings:function(){i.log("NotificationCenterController getHistory");var m={action:"getSettings"};h.publish("3dnotifinterne",m)},addNotification:function(p,w){i.log("NotificationCenterController addNotification");var x=decodeURIComponent(escape(window.atob(p.MESSAGE)));x=JSON.parse(x);if(x.icon){switch(x.icon.type){case"appID":this.getAppInfos({appID:x.icon.data,notifID:p.ID});break;case"login":case"url":x.icon=this.getIconUrl({icon:x.icon,platformId:p.PLATFORMID});break;default:x.icon="./../../resources/en/1/webapps/NotifAlert/assets/icons/notificon.png";break}}if(x.actions){for(var t=0;t<x.actions.length;t++){var q=x.actions[t];if(q.options&&q.options.event&&q.options.event.type==="url"){var m=q.options.event;if(m.options&&m.options.service&&m.options.uri){var n=this.getServiceUrl({name:m.options.service,platformId:p.PLATFORMID});m.options.url=n+m.options.uri;if(p.APPID==="USASWYM_AP"){m.options.csrf=n+"/api/index/tk/"}}}}}if(p.notifications){for(var r=0;r<p.notifications.length;r++){var s=decodeURIComponent(escape(window.atob(p.notifications[r].MESSAGE)));s=JSON.parse(s);if(s.icon){switch(s.icon.type){case"appID":this.getAppInfos({appID:s.icon.data,notifID:p.notifications[r].ID});break;case"login":case"url":s.icon=this.getIconUrl({icon:s.icon,platformId:p.notifications[r].PLATFORMID});break;default:s.icon="./../../resources/en/1/webapps/NotifAlert/assets/icons/notificon.png";break}}if(s.actions){for(var v=0;v<s.actions.length;v++){var q=s.actions[v];if(q.options&&q.options.event&&q.options.event.type==="url"){var o=q.options.event;if(o.options&&o.options.service&&o.options.uri){var u=this.getServiceUrl({name:o.options.service,platformId:p.notifications[r].PLATFORMID});o.options.url=u+o.options.uri;if(p.notifications[r].APPID==="USASWYM_AP"){o.options.csrf=u+"/api/index/tk/"}}}}}p.notifications[r].MESSAGE=s}}p.MESSAGE=x;this.centerView.addNotification(p,w)},getServiceUrl:function(m){for(var o=0;o<this.listOfService.length;o++){if(m.platformId){if(this.listOfService[o].platformid.toLowerCase()===m.platformId.toLowerCase()){if(this.listOfService[o][m.name.toLowerCase()]){return this.listOfService[o][m.name.toLowerCase()]}else{if(!this.listOfService[o][m.name.toLowerCase()]&&m.name.toLowerCase()==="3ddashboard"){for(var n=0;n<this.listOfService.length;n++){if(this.listOfService[n][m.platformId.toLowerCase()]){return this.listOfService[n][m.name.toLowerCase()]}}}}}}else{return this.listOfService[o][m.name.toLowerCase()]?this.listOfService[o][m.name.toLowerCase()]:this.listOfService[o+1]?this.listOfService[o+1][m.name.toLowerCase()]:undefined}}if(this.listOfService.length>0){return this.listOfService[0][m.name.toLowerCase()]}return undefined},getView:function(){return this.centerView.getView()},resetNotifications:function(){var m={action:"resetNotifications"};h.publish("3dnotifinterne",m)},updateSettings:function(m){i.log("NotificationCenterController updateSettings");var n=m;n.action="updateSettings";h.publish("3dnotifinterne",n)},unsubscribe:function(m){i.log("NotificationCenterController unsubscribe");var n=m;n.action="unsubscribe";h.publish("3dnotifinterne",n)},getMoreHistory:function(n){i.log("NotificationCenterController getMoreHistory");var m={action:"getHistory",type:n,oldID:this.oldNotif.ID,groupIDs:this.groupIDs};h.publish("3dnotifinterne",m)},});e.getInstance=function(m){if(g){return g}g=new a();g.getView().inject(m.body);return g};return e});