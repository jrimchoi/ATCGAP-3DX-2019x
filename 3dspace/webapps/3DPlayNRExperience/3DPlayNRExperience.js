define("DS/3DPlayNRExperience/3DPlayNRCursorManager",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/CoreEvents/Events","DS/Visualization/SceneGraphFactory","DS/Mesh/Mesh","DS/Mesh/MeshUtils","DS/Utilities/Color","DS/Visualization/ModelLoader","DS/Animation/ANIM","DS/Animation/AnimationPath","DS/Animation/PropertyAnimation","DS/RuntimeView/NLSManager","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/3DPlayNRExperience/assets/nls/NRExperience"],function(n,o,k,l,m,d,f,i,r,p,b,a,e,j,h,c,g){var q=n.extend({init:function(u){this._parent(u);this._curExperience=u.experience;this._viewer=u.experience.frmWindow.getViewer();this._arScenario=u.experience._scenario;this._CameraUpdateCbk=null;this._hitTestResultsCbk=null;this._screenHitPoint=new o.Vector2(0.5,0.5);this._activeState=false;this._reticle=null;this._reticleAnimation=null;this._waitingLoadingEndAnimation=null;this._readyForNextHit=true;this.updateAnimation=function(w){};this.materialTorus=null;this.materialSphere=null;this._isPlaneHit=false;this._hitPlaneAnchorID=null;this._planeObject=null;this._planeNormal=null;this._previousHitType=q.NoHit;this._planeBag=new k();this._viewer.addNode(this._planeBag);this._rotX=new o.Matrix4().makeRotationAxis(new o.Vector3(1,0,0),Math.PI/2);this._planeMaterial=new o.MeshBasicMaterial({force:true,color:new o.Color("white"),side:o.DoubleSide});this._planeMaterial.transparent=true;this._planeMaterial.activatePDSFX();var s={};var t={ProcessFinalColor:["void ProcessFinalColor(inout vec4 ioFinalColor) {","if(length(ioFinalColor - vec4(1.0,1.0,1.0,1.0)) < 1e-3) {","ioFinalColor.w=0.0;","} else {","float average = (ioFinalColor.r + ioFinalColor.g + ioFinalColor.b) / 3.0;","if(average > 0.85) {","ioFinalColor.w = 0.0;","}else {","ioFinalColor = vec4(0.0, 0.0, 0.0, 0.2);","}","}","}"].join("\n")};this._planeMaterial.setPDSFXOverridableFunctions(s,t);var v=this;this.onStop=function(w){if(w===b.State.STOPPED){v._readyForNextHit=true}};this._position=new o.Vector3(0,0,0);this._orientation=new o.Quaternion();this._transform=new o.Matrix4().setPosition(this._position);this._transform.setRotationFromQuaternion(this._orientation);this._buildARCursor()},_buildARCursor:function(){this.materialTorus=new o.LineBasicMaterial({color:16711680,lineWidth:5,side:o.DoubleSide,opacity:0.7,scale:1,isCPUPattern:true,force:true,polygonBorderMode:false,});this.materialTorus.receiveShadow=false;this.materialTorus.castShadow=false;this.materialSphere=new o.MeshLambertMaterial({color:new o.Color().setRGB(255,255,255),opacity:0,force:true});this.materialSphere.receiveShadow=false;this.materialSphere.castShadow=false;this.materialSquare=new o.MeshLambertMaterial({color:new o.Color().setRGB(255,50,0),opacity:0,force:true});this.materialSquare.receiveShadow=false;this.materialSquare.castShadow=false;this.materialSquare.line=new o.LineBasicMaterial({color:16750848,lineWidth:5,side:o.DoubleSide,opacity:1,scale:1,isCPUPattern:true,force:true,polygonBorderMode:true,linejoin:"round",});this.materialSquare.line.receiveShadow=false;this.materialSquare.line.castShadow=false;var W=new o.Matrix4();var F=[];var v=50;var D=[];for(var L=1;L<=9;L++){D.push(new o.Vector3(v*Math.cos((Math.PI/20)*L),v*Math.sin((Math.PI/20)*L),0))}var B=[];for(var L=11;L<=19;L++){B.push(new o.Vector3(v*Math.cos((Math.PI/20)*L),v*Math.sin((Math.PI/20)*L),0))}var A=[];for(var L=21;L<=29;L++){A.push(new o.Vector3(v*Math.cos((Math.PI/20)*L),v*Math.sin((Math.PI/20)*L),0))}var z=[];for(var L=31;L<=39;L++){z.push(new o.Vector3(v*Math.cos((Math.PI/20)*L),v*Math.sin((Math.PI/20)*L),0))}var U=d.createLineNode({points:D,material:this.materialTorus});U.setPickable(f.NOPICKABLE);var S=d.createLineNode({points:B,material:this.materialTorus});S.setPickable(f.NOPICKABLE);var Q=d.createLineNode({points:A,material:this.materialTorus});Q.setPickable(f.NOPICKABLE);var O=d.createLineNode({points:z,material:this.materialTorus});O.setPickable(f.NOPICKABLE);var K=d.createCircleNode({material:this.materialSphere,radius:3,fill:true});K.setPickable(f.NOPICKABLE);var N=60;var T=[];T.push(new o.Vector3(N,N/3,0));T.push(new o.Vector3(N,N,0));T.push(new o.Vector3(N/3,N,0));var H=d.createLineNode({points:T,material:this.materialSquare});H.setPickable(f.NOPICKABLE);var R=[];R.push(new o.Vector3(-N/3,N,0));R.push(new o.Vector3(-N,N,0));R.push(new o.Vector3(-N,N/3,0));var G=d.createLineNode({points:R,material:this.materialSquare});G.setPickable(f.NOPICKABLE);var P=[];P.push(new o.Vector3(-N,-N/3,0));P.push(new o.Vector3(-N,-N,0));P.push(new o.Vector3(-N/3,-N,0));var E=d.createLineNode({points:P,material:this.materialSquare});E.setPickable(f.NOPICKABLE);var M=[];M.push(new o.Vector3(N/3,-N,0));M.push(new o.Vector3(N,-N,0));M.push(new o.Vector3(N,-N/3,0));var C=d.createLineNode({points:M,material:this.materialSquare});C.setPickable(f.NOPICKABLE);var I=new k();I.setName("Torus");I.setMatrix(W);I.addChild(U);I.addChild(S);I.addChild(Q);I.addChild(O);var u=new k();u.setName("Sphere");u.setMatrix(W);u.addChild(K);var w=new k();w.setName("Square");w.setMatrix(W);w.addChild(H);w.addChild(G);w.addChild(E);w.addChild(C);this._reticle=new k();this._reticle.setName("Reticle");this._reticle.setMatrix(this._transform);this._reticle.addChild(I);this._reticle.addChild(u);this._reticle.addChild(w);this._reticle.setVisibility(false);var x=this;if(this._arScenario._context!=undefined){var V=new k();V.setName("NRReticleBag");V.setMatrix(this._arScenario._context.getMatrix());this._viewer.addNode(V);V.addChild(this._reticle)}else{m.subscribeOnce({event:"/AR/onScenarioStarted"},function(X){var Y=new k();Y.setName("NRReticleBag");Y.setMatrix(x._arScenario._context.getMatrix());x._viewer.addNode(Y);Y.addChild(x._reticle)})}var y=new k("animatedSquare");y.setMatrix(W);y.addChild(H);y.addChild(G);y.addChild(E);y.addChild(C);var t=new o.Matrix4().setPosition(new o.Vector3(0,0,0));y.setMatrix(t);y.setVisibility(false);this._reticle.addChild(y);var J=new a({position:0},{position:150},1000);J.setInterpolator(function(X,Y,Z){return Y.position+(Z.position-Y.position)*X});var s={modelNode:y,updateAnimation:function(Y){var X=this.modelNode.getMatrix();X.makeScale(Y/150,Y/150,Y/150);this.modelNode.setMatrix(X)}};this._waitingLoadingEndAnimation=new e(s,"updateAnimation",J);this._waitingLoadingEndAnimation.setLoop(true)},_updateARCursorPosition:function(u,w){var t=new o.Vector3(u[0],u[1],u[2]);var s=new o.Quaternion(w[0],w[1],w[2],w[3]);var v=new a({position:this._position.clone(),orientation:this._orientation.clone()},{position:t,orientation:s},250);v.setInterpolator(function(z,A,B){var y={};var x=A.position.clone();x.lerp(B.position,z);y.position=x;var C=new o.Quaternion();o.Quaternion.slerp(A.orientation,B.orientation,C,z);y.orientation=C;return y});this.updateAnimation=function(x){this._position=x.position.clone();this._orientation=x.orientation.clone();this._transform.setPosition(this._position);this._transform.setRotationFromQuaternion(this._orientation);this._reticle.setMatrix(this._transform);if(this._curExperience.getScenarioCurrentState()==1){this._curExperience.setModelPosition(this.getMatrixWorld())}};this._readyForNextHit=false;this._reticleAnimation=new e(this,"updateAnimation",v,this.onStop);this._reticleAnimation.start()},_updateARCursorLook:function(x,w){if(this._hitPlaneAnchorID!=null){var v=this._planeBag.getChildByName(this._hitPlaneAnchorID+"_center");if(v!=null){v.removeChildren()}this._hitPlaneAnchorID=null;this._planeObject=null;this._planeNormal=null}this._isPlaneHit=false;if(w.distance<0.1||w.distance>3){this._reticle.setVisibility(false);var s="HitTooFarMsg";if(w.distance<0.1){s="HitTooCloseMsg"}var u=g[s];this._curExperience.showMessage(u);this._previousHitType=q.NoHit}else{this._curExperience.hideMessage();this._reticle.setVisibility(true);switch(x){case 0:this.materialTorus.opacity=0.1;this.materialTorus.color.setRGB(150,150,150);this.materialSphere.opacity=0.5;this.materialSphere.color.setRGB(150,150,150);this.materialSquare.line.opacity=0;break;case 1:this.materialTorus.opacity=0.2;this.materialTorus.color.setRGB(150,150,150);this.materialSphere.opacity=1;this.materialSphere.color.setRGB(255,255,255);this.materialSquare.line.opacity=0;break;case 2:this.materialTorus.opacity=0.2;this.materialTorus.color.setRGB(150,150,150);this.materialSphere.opacity=1;this.materialSphere.color.setRGB(255,255,255);this.materialSquare.line.opacity=0;break;case 3:this.materialTorus.opacity=1;this.materialTorus.color.setRGB(255,255,255);this.materialSphere.opacity=1;this.materialSphere.color.setRGB(255,255,255);this.materialSquare.line.opacity=0;break;case 4:this._isPlaneHit=true;this.materialTorus.opacity=0;this.materialTorus.color.setRGB(255,255,255);this.materialSphere.opacity=1;this.materialSphere.color.setRGB(255,255,255);this.materialSquare.line.opacity=0.3;if(w.anchorforHit!==undefined&&w.anchorforHit.anchorIdentifier!==undefined){this._hitPlaneAnchorID=w.anchorforHit.anchorIdentifier}if(this._arScenario._context.planeBag){var t=this._arScenario._context.planeBag[this._hitPlaneAnchorID];this._updatePlaneModel(t)}break;case 5:this.materialTorus.opacity=0;this.materialTorus.color.setRGB(255,255,255);this.materialSphere.opacity=1;this.materialSphere.color.setRGB(255,255,255);this.materialSquare.line.opacity=0.8;this._isPlaneHit=true;if(w.anchorforHit!==undefined&&w.anchorforHit.anchorIdentifier!==undefined){this._hitPlaneAnchorID=w.anchorforHit.anchorIdentifier}if(this._arScenario._context.planeBag){var t=this._arScenario._context.planeBag[this._hitPlaneAnchorID];this._updatePlaneModel(t)}break}if(this._previousHitType!=x){if(this._hitPlaneAnchorID==null){if(this._previousHitType>=4||this._previousHitType!==-1){this._curExperience.setModelOverrideMaterial(true,{color:12632256,alpha:0.2})}}else{if(this._previousHitType!=4&&this._previousHitType!=5){this._curExperience.setModelOverrideMaterial(true)}}this._previousHitType=x}}},_updatePlaneModel:function(x){if(x===undefined){return}var t=x.anchor.getName();var v=this._planeBag.getChildByName(t+"_center");if(v==null){this._planeBag.removeChildren();var B=new k(t);this._planeBag.addChild(B);B.setMatrix(x.anchor.getVirtualGlobalMatrix());v=new k(t+"_center");this._planeBag.addChild(v);v.setMatrix(x.center.getVirtualGlobalMatrix())}var y=this._curExperience.getModelOrientedBoundingBox();var u=x.extent.x;var z=x.extent.y;var s=d.createRectangleNode({width:u*4,height:z*4,fill:true,material:this._planeMaterial});s.setPickable(f.NOPICKABLE);s.setName("planeModel");var A=new o.Matrix4();A.setPosition(new o.Vector3(-x.extent.x*2,-x.extent.y*2,0.01));s.setMatrix(A);v.addChild(s);this._planeObject=x;var w=x.center.getVirtualGlobalMatrix().decompose();this._planeNormal=new o.Vector3(0,0,1).applyQuaternion(w[1]);this._planeNormal.normalize()},_extractHitType:function(s){if(s.IsHitFeaturePoint){return q.HitFeaturePoint}else{if(s.IsHitEstimatedHorPlane){return q.HitEstimatedHorPlane}else{if(s.IsHitEstimatedVerPlane){return q.HitEstimatedVerPlane}else{if(s.IsHitExistingPlane){return q.HitExistingPlane}else{if(s.IsHitExistingPlaneUsingExtent){return q.HitExistingPlaneUsingExtent}else{if(s.IsHitExistingPlaneUsingGeometry){return q.HitExistingPlaneUsingGeometry}}}}}}},activate:function(){if(this._activeState==true||this._curExperience.getScenarioCurrentState()===2){return}var s=this;this._previousHitType=-1;this._hitTestResultsCbk=m.subscribe({event:"/AR/onCenterHitTestResultReceived"},function(w){if(s._readyForNextHit){var t=w.hitTest;if(t.length>0){var v=null;var x=null;var u=null;t.forEach(function(y){if(v==null){v=y;x=s._extractHitType(y)}else{u=s._extractHitType(y);if(u>x){v=y;x=u}}});s._updateARCursorLook(x,v);s._updateARCursorPosition(v.worldPosition,v.worldOrientation)}else{}}});this._arScenario.activateHitTestCenterScreen({IsHitFeaturePoint:true,IsHitEstimatedHorPlane:true,IsHitEstimatedVerPlane:true,IsHitExistingPlane:false,IsHitExistingPlaneUsingExtent:true,IsHitExistingPlaneUsingGeometry:true});this._activeState=true;this._reticle.setVisibility(this._activeState)},desactivate:function(){if(this._activeState==false){return}this._arScenario.deactivateHitTestCenterScreen();if(this._hitTestResultsCbk!=null){m.unsubscribe(this._hitTestResultsCbk);this._hitTestResultsCbk=null}this._activeState=false;this._reticle.setVisibility(this._activeState);this.setReticlePlacementState(false)},isActive:function(){return this._activeState},getMatrixWorld:function(){return this._reticle.getMatrixWorld()},setReticlePlacementState:function(t){var s=this._reticle.getChildByName("animatedSquare");if(s!=null&&s.visible!=t){s.setVisibility(t);if(t){this._waitingLoadingEndAnimation.stop()}else{this._waitingLoadingEndAnimation.stop()}}},isHitPlane:function(){return this._isPlaneHit},getHitPlaneAnchorID:function(){return this._hitPlaneAnchorID},});q.NoHit=-1;q.HitFeaturePoint=0;q.HitEstimatedHorPlane=1;q.HitEstimatedVerPlane=2;q.HitExistingPlane=3;q.HitExistingPlaneUsingExtent=4;q.HitExistingPlaneUsingGeometry=5;return q});define("DS/3DPlayNRExperience/3DPlayNRExperience",["css!DS/3DPlayNRExperience/3DPlayNRExperience.css","i18n!DS/3DPlayNRExperience/assets/nls/NRExperience","DS/3DPlayExperienceModule/PlayExperience3D","UWA/Core","DS/Core/Core","DS/Windows/ImmersiveFrame","DS/Windows/Panel","DS/Controls/Button","DS/SUI/ARScenario","DS/CoreEvents/Events","DS/WebSystem/Environment","DS/3DPlayNRExperience/3DPlayNRCursorManager","DS/3DPlayNRExperience/3DPlayNRManipulate","DS/HapticFeedbacks/HapticFeedbacks","DS/ReplayKit/ReplayKit","DS/DocumentBrowser/DocumentBrowser","DS/Visualization/ThreeJS_DS","DS/WebappsUtils/WebappsUtils","DS/RuntimeView/NLSManager","DS/Visualization/PathElement","DS/Visualization/SceneGraphUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/Mesh/Mesh","DS/Animation/AnimationPath","DS/Animation/PropertyAnimation","DS/VisuEvents/EventsManager"],function(z,k,t,h,d,q,m,s,f,u,p,l,b,y,o,A,B,e,n,w,v,g,r,j,a,i,x){var c=t.extend({init:function(C){C.commandApplication=false;C.workbenchs=C.workbenchs||[];C.workbenchs.unshift({name:"3DPlayNRExperience",module:"3DPlayNRExperience",defaultCommand:{ID:"Default",className:"DS.3DPlayNRExperience.3DPlayNRManipulateCmd"}});this._parent(C);this._anchorsMap=new Map();this._anchorsUpdateCbk=null;this._isRecording=false;this._initialModelMatrix=null;this._currentScenarioState=c.EmptyScene;this.favoriteButton=null;this.cameraButton=null;this.modelOrientedBB=null;this.debugBB=false;this._disableMaterialOverride=false;this._FaceUpOrDownTimeout=null;this.eventToDispose={tokens:[],cbs:[]}},onPreCreate:function(){this.args.visu={}},buildLandingPage:function(){var H=this.frmWindow.elements.modalDialogContainer;var E=document.createElement("div");E.setAttribute("id","PlayWeb-Content-Chooser");E.setAttribute("class","font-3dsregular");E.style.display="none";var J=document.createElement("button");var G=document.createElement("span");G.setAttribute("class","fonticon fonticon-2x fonticon-picture-animated");J.appendChild(G);J.appendChild(document.createTextNode(k.LandingUseSample));var D=function(){E.style.display="none"};x.addEvent(J,"onTap",D);this.eventToDispose.cbs.push([J,"onTap",D]);x.addEvent(J,"onLeftMouseDown",D);this.eventToDispose.cbs.push([J,"onLeftMouseDown",D]);var C=document.createElement("button");var I=document.createElement("span");I.setAttribute("class","fonticon fonticon-2x fonticon-folder-open");C.appendChild(I);C.appendChild(document.createTextNode(k.LandingLocalFile));var F=function(){HybridApp.interactiveAuthentify().then(function(K){this._documentBrowser.showDocumentBrowser()}.bind(this),function(){});this._hapticFeedbacks.notificationFeedback(y.NotificationStyleSuccess)}.bind(this);x.addEvent(C,"onTap",F);this.eventToDispose.cbs.push([C,"onTap",F]);x.addEvent(C,"onLeftMouseDown",F);this.eventToDispose.cbs.push([C,"onLeftMouseDown",F]);E.appendChild(J);E.appendChild(C);H.appendChild(E);this.showLandingPage=function(){E.style.display=""};this.hideLandingPage=function(){E.style.display="none"}},onPostCreate:function(){this.buildLandingPage();this.showLandingPage();u.subscribe({event:"/HybridInfra/onURLPicked"},this.hideLandingPage);var Y=this.frmWindow.getActionBar();if(Y.getLabelsVisibility()===true){Y.hideLabels()}this.skillSetContainer=new h.Element("div",{"class":"PlayNR-OpenSkillSet-Container-2Elems",id:"SkillSetContainer"});this.skillSetContainer.inject(this.frmWindow.elements.actionBarContainer.getParent());var T=this;var N={};N.fonticon="trash";N.action=function(){T.showLandingPage();T.cleanLoadedModel();T.setScenarioCurrentState(c.EmptyScene);T.publish("EXPERIENCE/REQUESTNEWASSET",{ctx:T.args.ctx});T._hapticFeedbacks.notificationFeedback(y.NotificationStyleSuccess)};var W=this.createSkillSetButton(N);N={};N.fonticon="check";N.css="background-color:rgba(0, 135, 163, 0.8);";N.action=function(){if(T._arReticle.isHitPlane()){T.setFixedModelPosition(T._arReticle.getMatrixWorld());T.setScenarioCurrentState(c.ShareMode);T._hapticFeedbacks.notificationFeedback(y.NotificationStyleSuccess)}else{T._hapticFeedbacks.notificationFeedback(y.NotificationStyleError)}};var J=this.createSkillSetButton(N);var K=new h.Element("div",{"class":"PlayNR-ButtonDiv",id:"Confirm-SkillSet"});K.appendChild(J);K.appendChild(W);K.display="none";K.inject(this.skillSetContainer);this._activeSkSet=K;N={};N.icon="3DPlayNRExperience/assets/icons/I_NRRepositionModel.png";N.action=function(){T.setScenarioCurrentState(c.PlacementMode);T._hapticFeedbacks.notificationFeedback(y.NotificationStyleSuccess)};var P=this.createSkillSetButton(N);N={};N.icon="3DPlayNRExperience/assets/icons/I_NRExplode.png";N.action=function(){var ab=d.AFR.CommandsManager.getCommand("EnhancedExplode",T.args.ctx);if(ab){ab.begin()}T._hapticFeedbacks.notificationFeedback(y.NotificationStyleSuccess)};var L=this.createSkillSetButton(N);var U=new h.Element("div",{"class":"PlayNR-ButtonDiv",id:"Share-SkillSet"});U.appendChild(P);U.appendChild(L);K.display="none";U.inject(this.skillSetContainer);var I=this.frmWindow.getViewer();I.mobile=false;I.setShadowQuality("low");I.setShadowFilter("PCFOptimized");I.setShadow(true);I.autoUpdateFrustum=true;I.setReferenceAxisSystem(false);I.setMaterialMode(true);I.setRenderMode("Face",true);I.setRenderMode("@Edge",true);I.setRenderMode("@InternalEdge",false);I.setRenderMode("Outline",false);I.displayHiddenEdges(0);if(p.isSet("3DPlay.Debug")){I.setDebugFPS(true)}this.eventToDispose.tokens.push(u.subscribe({event:"/AR/onScenarioReady"},function(ab){ab.activate()}));this._scenario=new f({viewer:I,detectPlane:{activated:true,vertical:true,horizontal:true,boundary:false,mesh:false}});this._scenario.autoUpdateNearFar=true;this._arReticle=new l({experience:this});this._arManipulator=new b({experience:this});this._hapticFeedbacks=new y();this._documentBrowser=new A();this._assetToLoad=null;this._floatingAnimation=null;var V=new a({position:0},{position:50},1500);V.setInterpolator(function(ab,ac,ad){return ac.position+(ad.position-ac.position)*ab});var E={modelNode:undefined,modelOrientedBB:this.modelOrientedBB,isReverse:false,updateAnimation:function(ad){if(this.modelNode!==undefined){var ab=this.modelOrientedBB.center();ab.z=this.modelOrientedBB.min.z;var ac=new B.Matrix4();this.modelNode.setMatrix(ac);this.modelNode.translateX(-ab.x);this.modelNode.translateY(-ab.y);if(this.isReverse){this.modelNode.translateZ(-ab.z+ad)}else{this.modelNode.translateZ(-ab.z+50-ad)}if(ad===50){this.isReverse=!this.isReverse}}}};this._floatingAnimation=new i(E,"updateAnimation",V);this._floatingAnimation.setLoop(true);var O=this;I.setTriLights(true);this.eventToDispose.tokens.push(u.subscribe({event:"/AR/onCameraUpdated"},function(ab){O.latestLightIntensity=ab.viewpoint.lightIntensity;var ac={lightIndex:0,intensity:O.latestLightIntensity};I.setLightParameters(ac);ac.lightIndex=1;I.setLightParameters(ac);ac.lightIndex=2;I.setLightParameters(ac);I.ambientLight.intensity=O.latestLightIntensity}));this._deviceCurrentOrientation=0;var Q=k.Init;this._msgPlacementPanel=new h.Element("div",{"class":"containerCountdown",styles:{color:"white",textAlign:"center",verticalAlign:"middle",width:"100%",height:"110%",position:"absolute",top:"0%",left:"0%",background:"rgba(255,255,255,0.6)",fontSize:"15px"}});var G=new h.Element("div",{"class":"circle",styles:{position:"absolute",top:"33%",left:"14%"}});var M="http://www.w3.org/2000/svg";var S=document.createElementNS(M,"svg");S.setAttributeNS(null,"width","300");S.setAttributeNS(null,"viewBox","0 0 220 220");S.setAttributeNS(null,"filter","drop-shadow(10px 10px 5px black)");G.appendChild(S);this._msgPlacementPanel.appendChild(G);var C=document.createElementNS(M,"g");C.setAttributeNS(null,"transform","translate(110,110)");S.appendChild(C);var H=document.createElementNS(M,"circle");H.setAttributeNS(null,"r","100");H.setAttributeNS(null,"class","e-c-base");C.appendChild(H);var aa=document.createElementNS(M,"g");aa.setAttributeNS(null,"transform","rotate(-90)");C.appendChild(aa);var F=document.createElementNS(M,"circle");F.setAttributeNS(null,"r","100");F.setAttributeNS(null,"class","e-c-progress");aa.appendChild(F);this._progressBar=F;var Z=document.createElementNS(M,"g");Z.setAttributeNS(null,"id","e-pointer");this._progressPointer=Z;aa.appendChild(Z);var D=document.createElementNS(M,"circle");D.setAttributeNS(null,"r","8");D.setAttributeNS(null,"cx","100");D.setAttributeNS(null,"cy","0");D.setAttributeNS(null,"class","e-c-pointer");Z.appendChild(D);var R=k.Placing;var X=new h.Element("div",{html:R,styles:{position:"relative",top:"-190px",color:"black",fontSize:"20px",textAlign:"center",whiteSpace:"pre-line"}});G.appendChild(X);this._msgPlacementPanel.inject(O.frmWindow.getUIFrame());this._msgPlacementPanel.style.display="none";Q=k.Init;this._msgPanel=new h.Element("div",{html:Q,styles:{color:"black",textAlign:"center",lineHeight:"250%",verticalAlign:"middle",width:"80%",height:"5%",position:"absolute",top:"3%",left:"10%",background:"rgba(255,255,255,0.5)",boxShadow:"0 10px 20px rgba(0,0,0,0.34)",borderRadius:"15px",border:"1px solid #FFF",fontSize:"15px"}});this._msgPanel.inject(O.frmWindow.getUIFrame());this.eventToDispose.tokens.push(u.subscribeOnce({event:"/AR/onScenarioStarted"},function(){O.eventToDispose.tokens.push(u.subscribe({event:"/AR/onPointAnchorUpdated"},function(ab){O.updateNodesPosition(ab)}));O.eventToDispose.tokens.push(u.subscribe({event:"/AR/onTrackingStateUpdated"},function(ad){var ab=ad.trackingState.trackingState;var ae=ad.trackingState.trackingReason;var ac;switch(ae){case 1:ac="Init";break;case 2:ac="TooFast";break;case 3:ac="LackOfFeat";break;case 4:ac="Reloc";break;default:break}switch(ab){case 0:O.showMessage(k[ac]);O._arReticle.desactivate();break;case 1:O.showMessage(k[ac]);O._arReticle.desactivate();break;case 2:O.hideMessage();O._arReticle.activate();break;default:break}}))}))},_checkAuthBeforeLoad:function(D,C){if(D&&D.asset&&D.asset.appSource==="com.dassaultsystemes.corp.x3d.Drive"||D.asset.provider==="3DSPACE"||D.asset.provider==="EV6"||(D.asset.originalAsset&&(D.asset.originalAsset.provider==="3DDRIVE"||D.asset.originalAsset.provider==="3DSWYM"))){this.load(D,C,true);this.hideLandingPage()}else{HybridApp.interactiveAuthentify().then(function(){this.load(D,C,true);this.hideLandingPage()}.bind(this),function(){this.showLandingPage();self.publish("EXPERIENCE/REQUESTNEWASSET",{ctx:self.args.ctx});this._hapticFeedbacks.notificationFeedback(y.NotificationStyleSuccess)}.bind(this))}},load:function(E,C,D){if(D||E&&E.asset&&E.asset.isSample){this._parent(E,C)}else{this._checkAuthBeforeLoad(E,C)}},dispose:function(){var E=this.eventToDispose.tokens;while(0<E.length){u.unsubscribe(E.pop())}var D=this.eventToDispose.cbs;while(0<D.length){var C=D.pop();x.removeEvent(C[0],C[1],C[2])}if(this._scenario){this._scenario.deactivate()}this._parent()},updateProgressCircle:function(E,C){var D=Math.PI*2*100;var G=-D-D*E/(C);this._progressBar.style.strokeDashoffset=G;var F=360*E/(C);this._progressPointer.style.transform="rotate("+F+"deg)"},changeWholeTime:function(C){if((this._wholeTime+C)>0){this._wholeTime+=C;this.updateProgressCircle(this._wholeTime,this._wholeTime)}},timerLandOnTable:function(E){var C=Date.now()+(E*1000);var D=this;this._intervalTimer=setInterval(function(){D._timeLeft=Math.round((C-Date.now())/1000);if(D._timeLeft<0){clearInterval(D._intervalTimer);D.isTimerLandOnTableStarted=false;var J=window.__player.getExperience();var I=J.frmWindow.getViewer();var G=I.currentViewpoint.getEyePosition();G.z+=100;var H=J.getRootBag();var F=H.getMatrix();F.setPosition(G);H.setMatrix(F);J.setFixedModelPosition(J._arReticle.getMatrixWorld());J.setScenarioCurrentState(c.ShareMode);J._hapticFeedbacks.vibrateFeedback();J._FaceUpOrDownTimeout=null;J._msgPlacementPanel.style.display="none";return}D.displayTimeLeft(D._timeLeft)},1000)},abortTimerLandOnTable:function(){if(this.isTimerLandOnTableStarted!==false){this._arReticle.activate();clearInterval(this._intervalTimer);this.isTimerLandOnTableStarted=false;var C=window.__player.getExperience();C._msgPlacementPanel.style.display="none"}},displayTimeLeft:function(C){this.updateProgressCircle(C,this._wholeTime)},smartRGBtoHex:function(C){var D=Number(C).toString(16);if(D.length<2){D="0"+D}return D},createSkillSetButton:function(E){var D=document.createElement("button");D.setAttribute("class","PlayNR-Button");if(E.css){D.setAttribute("style",E.css)}var C=document.createElement("i");D.appendChild(C);if(E.icon){C.setAttribute("style","background-image:url('"+HybridApp.getWebappsPath()+E.icon+"')")}else{if(E.fonticon){C.setAttribute("class","fonticon fonticon-2x fonticon-"+E.fonticon)}else{C.setAttribute("class","fonticon fonticon-2x")}}x.addEvent(D,"onTap",E.action);this.eventToDispose.cbs.push([D,"onTap",E.action]);x.addEvent(D,"onLeftMouseDown",E.action);this.eventToDispose.cbs.push([D,"onLeftMouseDown",E.action]);return D},showModelChooser:function(){},activateSkillSetById:function(C){if(this._activeSkSet!==null){if(this._activeSkSet.id!==C){this._activeSkSet.style.display="none";this._activeSkSet=document.getElementById(C);if(this._activeSkSet!==null){var D=this._activeSkSet.childElementCount;if(D===2||D===1){this.skillSetContainer.removeClassName("PlayNR-OpenSkillSet-Container-3Elems")}else{this.skillSetContainer.addClassName("PlayNR-OpenSkillSet-Container-3Elems")}this._activeSkSet.style.display=""}}}},rotateCurrentSkillSet:function(E){if(this._activeSkSet!==null){var C="";switch(this._deviceCurrentOrientation){case 0:break;case 1:break;case 2:C="PlayNR-ButtonPortraitUpsideDown";break;case 3:C="PlayNR-ButtonLandscapeLeft";break;case 4:C="PlayNR-ButtonLandscapeRight";break;default:break}var F=this._activeSkSet.children;for(var D=0;D<F.length;D++){F[D].removeClassName(C);if(E===2){F[D].addClassName("PlayNR-ButtonPortraitUpsideDown")}if(E===3){F[D].addClassName("PlayNR-ButtonLandscapeLeft")}if(E===4){F[D].addClassName("PlayNR-ButtonLandscapeRight")}}this._deviceCurrentOrientation=E}},openModelFromName:function(D){var C=D.split(".").pop();var F={filename:HybridApp.getWebappsPath()+"3DPlayNRExperience/assets/models/"+D,format:C,mimetype:C,type:C,provider:"FILE",proxyurl:"none"};var E=window.__player.lastOptions;E.input={asset:F,experience:{filename:"DS/3DPlayNRExperience/3DPlayNRExperience"}};window.__player.load(E)},cleanLoadedModel:function(){this._floatingAnimation.stop();this.modelOrientedBB=null;this.clearView();this.getRootBag().setMatrix(new B.Matrix4());this.showLandingPage();this._arReticle.activate();this._arReticle.setReticlePlacementState(false)},linkNodeToWorldAnchor:function(F){var D=F.getMatrix().decompose();var C=new B.Matrix4().makeScale(1,1,1);C.setPosition(D[0]);C.setRotationFromQuaternion(D[1]);var E=this._scenario.addAnchor(C);this._anchorsMap.set(E.identifier,F)},unlinkNodeToWorldAnchor:function(){this._anchorsMap.clear()},updateNodesPosition:function(G){if(this._anchorsMap.size>0){var E=G.point;for(var F=0;F<E.length;F++){var D=E[F];var H=null;if(this._anchorsMap.has(D.JSidentifier)){H=this._anchorsMap.get(D.JSidentifier);delete this._anchorsMap[D.JSidentifier];this._anchorsMap.set(D.identifier,H)}else{H=this._anchorsMap.get(D.identifier)}if(H){var C=new B.Vector3();C.x=D.pointPosition[0];C.y=D.pointPosition[1];C.z=D.pointPosition[2];var J=H.getMatrix();var I=J.getMaxScaleOnAxis();J.setPosition(C);J.scale(new B.Vector3(I,I,I));H.setMatrix(J);break}}}},showMessage:function(C){if(this._msgPanel!==undefined&&this._msgPanel!==null){this._msgPanel.textContent=C;this._msgPanel.style.display=""}},hideMessage:function(){if(this._msgPanel!==undefined&&this._msgPanel!==null){this._msgPanel.textContent="";this._msgPanel.style.display="none"}},getPositionToPlaceModel:function(){return this._initialModelMatrix},resetPositionToPlaceModel:function(){this._initialModelMatrix=null},setPositionToPlaceModel:function(){this._initialModelMatrix=this._arReticle.getMatrixWorld()},getScenarioCurrentState:function(){return this._currentScenarioState},setMaterialOverrideActive:function(C){this._disableMaterialOverride=!C;this._arReticle._previousHitType=-1},setScenarioCurrentState:function(C){this._currentScenarioState=C;switch(C){case c.EmptyScene:d.AFR.CommandsManager.endAll(this.args.ctx,false);this.activateSkillSetById("AddModel-SkillSet");this.activateShadowOnGround(false);break;case c.PlacementMode:this.activateSkillSetById("Confirm-SkillSet");d.AFR.CommandsManager.endAll(this.args.ctx,false);this._arReticle.activate();this._arReticle.setReticlePlacementState(true);this.unlinkNodeToWorldAnchor();this.activateShadowOnGround(false);break;case c.ShareMode:d.AFR.CommandsManager.endAll(this.args.ctx,true);d.AFR.CommandsManager._restoreDefault(this.args.ctx,true);this.activateSkillSetById("Share-SkillSet");this._arReticle.desactivate();this.activateShadowOnGround(true);break;default:break}},setModelPosition:function(D){var F=this.getRootBag();if(F!==null){var H=D.decompose();var C=F.getMatrix();if(
/*!this._floatingAnimation.isRunning() && */
F.children[0]!==undefined&&this.modelOrientedBB!==null){F.setVisibility(true);this._floatingAnimation._target.modelNode=F.children[0];this._floatingAnimation._target.modelOrientedBB=this.modelOrientedBB}var E=new B.Vector3(0,0,100);if(this._arReticle._planeNormal!==null){E=this._arReticle._planeNormal.clone();E.multiplyScalar(100)}H[0].add(E);var G=C.getMaxScaleOnAxis();C.setPosition(H[0]);C.setRotationFromQuaternion(H[1]);if(!isNaN(G)){C.scale(new B.Vector3(G,G,G))}F.setMatrix(C)}},setFixedModelPosition:function(G){var E=this.getRootBag();if(E!==null){E.setVisibility(true);this._floatingAnimation.stop();var C=this.modelOrientedBB.center();C.z=this.modelOrientedBB.min.z;var M=new B.Matrix4();this.getRootBag().children[0].setMatrix(M);this.getRootBag().children[0].translateX(-C.x);this.getRootBag().children[0].translateY(-C.y);this.getRootBag().children[0].translateZ(-C.z);var F=G.decompose();var L=E.getMatrix();var D=new B.Vector3();D.getPositionFromMatrix(L);var K=new a({position:0},{position:100},800);K.setInterpolator(function(N,O,P){return O.position+(P.position-O.position)*N});var J;var H={rootModelNode:E,posInitial:D,updateAnimation:function(Q){var O=this.rootModelNode.getMatrix();var N=this.posInitial.clone();var P=new B.Vector3(0,0,Q);if(window.__player.getExperience()._arReticle._planeNormal!==null){P=window.__player.getExperience()._arReticle._planeNormal.clone();P.multiplyScalar(Q)}N.sub(P);var R=O.getMaxScaleOnAxis();O.setPosition(N);this.rootModelNode.setMatrix(O);if(Q===100){window.__player.getExperience().linkNodeToWorldAnchor(this.rootModelNode);window.__player.getExperience()._hapticFeedbacks.impactFeedback(y.ImpactStyleHeavy);J.stop();J=false}}};J=new i(H,"updateAnimation",K);J.start();var I=new w([E]);v.applyMaterialToPath(I,null);this._arReticle.desactivate()}},getModelOrientedBoundingBox:function(){return this.modelOrientedBB},forceModelOriginPosition:function(){var J=this.frmWindow.getViewer();var H=new w([this.getRootBag().children[0]]);this.modelOrientedBB=H.getOrientedBoundingBox(this.getRootBag().children[0].getMatrixWorld(),J);var E=this.modelOrientedBB.center();E.z=this.modelOrientedBB.min.z;var F=new B.Matrix4();this.getRootBag().children[0].setMatrix(F);this.getRootBag().children[0].translateX(-E.x);this.getRootBag().children[0].translateY(-E.y);this.getRootBag().children[0].translateZ(-E.z);if(this.debugBB===true){var D=new r();var G=new B.MeshPhongMaterial({color:"blue"});G.line=new B.LineBasicMaterial({color:0,linewidth:2,opacity:1});G.side=B.DoubleSide;G.depthWrite=true;G.opacity=0.5;G.transparent=true;G.force=true;G.receiveShadow=true;G.castShadow=false;G.overridable=false;var I={cornerPoint:this.modelOrientedBB.min,firstAxis:new B.Vector3(this.modelOrientedBB.max.x-this.modelOrientedBB.min.x,0,0),secondAxis:new B.Vector3(0,this.modelOrientedBB.max.y-this.modelOrientedBB.min.y,0),thirdAxis:new B.Vector3(0,0,this.modelOrientedBB.max.z-this.modelOrientedBB.min.z),fill:true,material:G};var C=g.createCuboidNode(I);D.addChild(C);this.getRootBag().children[0].addChild(D)}},activateShadowOnGround:function(C){if(typeof C==="boolean"){this._arReticle._planeBag.setVisibility(C);this.frmWindow.getViewer().setShadow(C)}},setModelOverrideMaterial:function(F,E){if(this._disableMaterialOverride===true){return}var H=this.getRootBag();if(H!==null){var G=new w([H]);if(F===true){var D=22149;var I=0.3;if(E!==undefined){if(E.color!==undefined){D=E.color}if(E.alpha!==undefined){I=E.alpha}}var C=new B.MeshPhongMaterial({color:D});C.side=B.DoubleSide;C.depthWrite=true;C.opacity=I;C.transparent=true;C.force=true;C.receiveShadow=true;C.castShadow=false;C.overridable=false;v.applyMaterialToPath(G,C)}else{v.applyMaterialToPath(G,null)}}}});c.EmptyScene=0;c.PlacementMode=1;c.ShareMode=2;return c});define("DS/3DPlayNRExperience/3DPlayNRManipulateCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/VisuEvents/EventsManager","DS/Selection/CSOManager","DS/Selection/PSOManager","DS/Visualization/PathElement","DS/Visualization/SceneGraphUtils","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/CoreEvents/Events","DS/3DPlayNRExperience/3DPlayNRExperience","DS/HapticFeedbacks/HapticFeedbacks"],function(j,b,n,k,f,e,m,g,a,h,l,d,o,c){var i=b.extend({init:function(p){this._parent(p,{isAsynchronous:true,mode:"exclusive"});this._experience=this.getFrameWindow().experience;this._rootModelNode=null;this._arScenario=this.getFrameWindow().experience._scenario;this._pointCLoudVertices={};this._debug_scale=false},_elevateLaunchCB:function(q){if(this._experience.getScenarioCurrentState()!=o.ShareMode){return}if(q.state==="begin"){this._rootModelNode=this._experience.getRootBag();if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(true);this._experience.activateShadowOnGround(false);this._experience.unlinkNodeToWorldAnchor()}}else{if(q.state==="end"){this._experience.setModelOverrideMaterial(false);this._experience.activateShadowOnGround(true)}else{if(this._rootModelNode!=null){var u=q.gesture.touches[0].lastPosition.clone();u.addVectors(q.gesture.touches[1].lastPosition,q.gesture.touches[2].lastPosition);u.multiplyScalar(1/3);var s=q.gesture.touches[0].currentPosition.clone();s.addVectors(q.gesture.touches[1].currentPosition,q.gesture.touches[2].currentPosition);s.multiplyScalar(1/3);var r=this._rootModelNode.getMatrix();var p=new n.Vector3();p.getPositionFromMatrix(r);var t=new n.Vector3(0,0,10);t.multiplyScalar(-(s.y-u.y));p.add(t);r.setPosition(p);this._rootModelNode.setMatrix(r)}}}},_rotateLaunchCB:function(p){if(this._experience.getScenarioCurrentState()!=o.ShareMode){return}if(p.state==="begin"){this._rootModelNode=this._experience.getRootBag();if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(true);this._experience.activateShadowOnGround(false);this._experience.unlinkNodeToWorldAnchor()}}else{if(p.state==="end"){if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(false);this._experience.activateShadowOnGround(true);this._experience.linkNodeToWorldAnchor(this._rootModelNode)}}else{if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(true);var r=this._rootModelNode.getMatrix();var t=(Math.PI/20)*(p.gesture.currentEvent[0].deltaPosition.x/9);r.rotateZ(t);this._rootModelNode.setMatrix(r);if(this._debug_scale==true){var q=this._rootModelNode.getMatrix().decompose();var s="Scale: ("+q[2].x+"\n"+q[2].y+"\n"+q[2].z+")";this._experience.showMessage(s)}}}}},_scaleLaunchCB:function(y){if(this._experience.getScenarioCurrentState()!=o.ShareMode){return}if(y&&y.gesture){var t=y.gesture.getEvents();var A=t[0].getCurrentPosition();var z=t[1].getCurrentPosition();if(y.state==="begin"){this._rootModelNode=this._experience.getRootBag();if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(true);this._experience.activateShadowOnGround(false)}var v=Math.pow((z.x-A.x),2);var u=Math.pow((z.y-A.y),2);if(this._rootModelNode!=null){var p=this._rootModelNode.getMatrix().decompose();this.zoomStart={previousDist:0,newDist:Math.sqrt(v+u),center:{x:(A.x+z.x)/2,y:(A.y+z.y)/2},scale:p[2].x}}}else{if(y.state==="end"){this.zoomStart=null;if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(false);this._experience.activateShadowOnGround(true)}}else{if(this.zoomStart!==null){if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(true);this._experience.activateShadowOnGround(false);var v=Math.pow((z.x-A.x),2);var u=Math.pow((z.y-A.y),2);var r=Math.sqrt(v+u);this.zoomStart.previousDist=this.zoomStart.newDist;this.zoomStart.newDist=r;var w=1;w=this.zoomStart.newDist/this.zoomStart.previousDist;this.zoomStart.scale=w*this.zoomStart.scale;var q=this._rootModelNode.getMatrix();var x=1-q.getMaxScaleOnAxis()*w;if(Math.abs(x)>=0.2){q.scale(new n.Vector3(w,w,w));this._rootModelNode.setMatrix(q);var x=1-q.getMaxScaleOnAxis()}else{var p=this._rootModelNode.getMatrix().decompose();var s=new n.Matrix4().makeScale(1,1,1);q.compose(p[0],p[1],s);this._experience._hapticFeedbacks.impactFeedback(c.ImpactStyleLight)}}}}}}},_scanLaunchCB:function(p){this.getFrameWindow().experience._scenario.setPointCloudVisibility(true)},_scanEndCB:function(p){this.getFrameWindow().experience._scenario.setPointCloudVisibility(false)},_panLaunchCB:function(w){if(this._experience.getScenarioCurrentState()!=o.ShareMode){return}if(w.state==="begin"){this._rootModelNode=this._experience.getRootBag();if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(true);this._experience.activateShadowOnGround(false);this._experience.unlinkNodeToWorldAnchor()}}else{if(w.state==="end"){if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(false);this._experience.activateShadowOnGround(true);this._experience.linkNodeToWorldAnchor(this._rootModelNode)}}else{if(this._rootModelNode!=null){var s=this.getFrameWindow().getViewer();var r=s.currentViewpoint;var x=r.getSightDirection();x.z=0;var u=x.clone().multiplyScalar(-(w.gesture.barycenter.y-w.gesture.lastBarycenter.y)*10);var t=new n.Matrix4().makeRotationAxis(new n.Vector3(0,0,1),-Math.PI/2);var v=x.clone().applyMatrix4(t).multiplyScalar((w.gesture.barycenter.x-w.gesture.lastBarycenter.x)*10);var q=this._rootModelNode.getMatrix();var p=new n.Vector3();p.getPositionFromMatrix(q);p.add(u);p.add(v);q.setPosition(p);this._rootModelNode.setMatrix(q)}}}},beginExecute:function(){if(this.getFrameWindow().experience!==undefined&&this.getFrameWindow().experience._arManipulator!==undefined){this._experience._arManipulator.enable()}},resumeExecute:function(){},pauseExecute:function(){},execute:function(){},cancelExecute:function(p){if(this.getFrameWindow().experience!==undefined&&this.getFrameWindow().experience._arManipulator!==undefined){this._experience._arManipulator.disable()}},endExecute:function(){},dist:function(r,q){var p=q.x-r.x,t=q.y-r.y,s=q.z-r.z;return Math.sqrt(p*p+t*t+s*s)},});return i});define("DS/3DPlayNRExperience/3DPlayNRManipulate",["UWA/Class","UWA/Core","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/VisuEvents/EventsManager","DS/Selection/CSOManager","DS/Selection/PSOManager","DS/Visualization/PathElement","DS/Visualization/SceneGraphUtils","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/CoreEvents/Events","DS/3DPlayNRExperience/3DPlayNRExperience","DS/HapticFeedbacks/HapticFeedbacks"],function(b,i,n,j,f,e,m,g,a,h,l,d,o,c){var k=b.extend({init:function(q){this._parent(q);this._experience=q.experience;this._viewer=q.experience.frmWindow.getViewer();this._arScenario=q.experience._scenario;this._rootModelNode=null;this._pointCLoudVertices={};this._debug_scale=false;this._isActive=false;var p=this._viewer&&this._viewer.canvas;if(p){f.addEvent(this._viewer.canvas,"onPan",this._panLaunchCB.bind(this));f.addEvent(this._viewer.canvas,"onSpread",this._elevateLaunchCB.bind(this));f.addEvent(this._viewer.canvas,"onDrag",this._rotateLaunchCB.bind(this));f.addEvent(this._viewer.canvas,"onPinch",this._scaleLaunchCB.bind(this))}},enable:function(){this._isActive=true},disable:function(){this._isActive=false},_elevateLaunchCB:function(q){if(this._experience.getScenarioCurrentState()!=2||this._isActive!=true){return}if(q.state==="begin"){this._rootModelNode=this._experience.getRootBag();if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(true);this._experience.activateShadowOnGround(false);this._experience.unlinkNodeToWorldAnchor()}}else{if(q.state==="end"){this._experience.setModelOverrideMaterial(false);this._experience.activateShadowOnGround(true)}else{if(this._rootModelNode!=null){var u=q.gesture.touches[0].lastPosition.clone();u.addVectors(q.gesture.touches[1].lastPosition,q.gesture.touches[2].lastPosition);u.multiplyScalar(1/3);var s=q.gesture.touches[0].currentPosition.clone();s.addVectors(q.gesture.touches[1].currentPosition,q.gesture.touches[2].currentPosition);s.multiplyScalar(1/3);var r=this._rootModelNode.getMatrix();var p=new n.Vector3();p.getPositionFromMatrix(r);var t=new n.Vector3(0,0,10);if(window.__player.getExperience()._arReticle._planeNormal!=null){t=window.__player.getExperience()._arReticle._planeNormal.clone();t.multiplyScalar(10)}if(window.__player.getExperience()._deviceCurrentOrientation==3){t.multiplyScalar((s.x-u.x))}else{if(window.__player.getExperience()._deviceCurrentOrientation==4){t.multiplyScalar(-(s.x-u.x))}else{t.multiplyScalar(-(s.y-u.y))}}p.add(t);r.setPosition(p);this._rootModelNode.setMatrix(r)}}}},_rotateLaunchCB:function(p){if(this._experience.getScenarioCurrentState()!=2||this._isActive!=true){return}if(p.state==="begin"){this._rootModelNode=this._experience.getRootBag();if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(true);this._experience.activateShadowOnGround(false);this._experience.unlinkNodeToWorldAnchor()}}else{if(p.state==="end"){if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(false);this._experience.activateShadowOnGround(true);this._experience.linkNodeToWorldAnchor(this._rootModelNode)}}else{if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(true);var q=this._rootModelNode.getMatrix();var r=0;if(window.__player.getExperience()._deviceCurrentOrientation==3){r=(Math.PI/20)*(p.gesture.currentEvent[0].deltaPosition.y/9)}else{if(window.__player.getExperience()._deviceCurrentOrientation==4){r=-(Math.PI/20)*(p.gesture.currentEvent[0].deltaPosition.y/9)}else{r=(Math.PI/20)*(p.gesture.currentEvent[0].deltaPosition.x/9)}}q.rotateZ(r);this._rootModelNode.setMatrix(q)}}}},_scaleLaunchCB:function(x){if(this._experience.getScenarioCurrentState()!=2||this._isActive!=true){return}if(x&&x.gesture){var t=x.gesture.getEvents();var z=t[0].getCurrentPosition();var y=t[1].getCurrentPosition();if(x.state==="begin"){this._rootModelNode=this._experience.getRootBag();if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(true);this._experience.activateShadowOnGround(false)}var v=Math.pow((y.x-z.x),2);var u=Math.pow((y.y-z.y),2);if(this._rootModelNode!=null){var p=this._rootModelNode.getMatrix().decompose();this.zoomStart={previousDist:0,newDist:Math.sqrt(v+u),center:{x:(z.x+y.x)/2,y:(z.y+y.y)/2},scale:p[2].x,scaled:false,}}}else{if(x.state==="end"){this.zoomStart=null;if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(false);this._experience.activateShadowOnGround(true)}}else{if(this.zoomStart!==null){if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(true);this._experience.activateShadowOnGround(false);var v=Math.pow((y.x-z.x),2);var u=Math.pow((y.y-z.y),2);var r=Math.sqrt(v+u);this.zoomStart.previousDist=this.zoomStart.newDist;this.zoomStart.newDist=r;var w=1;w=this.zoomStart.newDist/this.zoomStart.previousDist;this.zoomStart.scale=w*this.zoomStart.scale;var q=this._rootModelNode.getMatrix();if(this.zoomStart.scale>=0.8&&this.zoomStart.scale<=1.2){var p=q.decompose();var s=new n.Vector3(1,1,1);q.compose(p[0],p[1],s);this._rootModelNode.setMatrix(q);if(this.zoomStart.scaled){this._experience._hapticFeedbacks.impactFeedback(c.ImpactStyleLight);this.zoomStart.scaled=false}}else{q.scale(new n.Vector3(w,w,w));this._rootModelNode.setMatrix(q);this.zoomStart.scaled=true}}}}}}},_panLaunchCB:function(A){if(this._experience.getScenarioCurrentState()!=2||this._isActive!=true){return}if(A.state==="begin"){this._rootModelNode=this._experience.getRootBag();if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(true);this._experience.activateShadowOnGround(false);this._experience.unlinkNodeToWorldAnchor()}}else{if(A.state==="end"){if(this._rootModelNode!=null){this._experience.setModelOverrideMaterial(false);this._experience.activateShadowOnGround(true);this._experience.linkNodeToWorldAnchor(this._rootModelNode)}}else{if(this._rootModelNode!=null){var u=this._viewer.currentViewpoint;var B=u.getSightDirection();var z=new n.Vector3();var y=new n.Vector3();if(window.__player.getExperience()._arReticle._planeObject!=null&&window.__player.getExperience()._arReticle._planeObject.alignement===1){var v=window.__player.getExperience()._arReticle._planeObject;var w=v.center.getVirtualGlobalMatrix().decompose();var t=new n.Vector3(1,0,0).applyQuaternion(w[1]);var r=new n.Vector3(0,1,0).applyQuaternion(w[1]);if(window.__player.getExperience()._deviceCurrentOrientation==3){z=t.multiplyScalar((A.gesture.barycenter.y-A.gesture.lastBarycenter.y)*5);y=r.multiplyScalar(-(A.gesture.barycenter.x-A.gesture.lastBarycenter.x)*5)}else{if(window.__player.getExperience()._deviceCurrentOrientation==4){z=t.multiplyScalar((A.gesture.barycenter.y-A.gesture.lastBarycenter.y)*5);y=r.multiplyScalar((A.gesture.barycenter.x-A.gesture.lastBarycenter.x)*5)}else{z=t.multiplyScalar((A.gesture.barycenter.x-A.gesture.lastBarycenter.x)*5);y=r.multiplyScalar(-(A.gesture.barycenter.y-A.gesture.lastBarycenter.y)*5)}}}else{B.z=0;var q=new n.Vector3(0,0,1);var x=new n.Matrix4().makeRotationAxis(q,-Math.PI/2);if(window.__player.getExperience()._deviceCurrentOrientation==3){z=B.clone().applyMatrix4(x).multiplyScalar((A.gesture.barycenter.y-A.gesture.lastBarycenter.y)*10);y=B.clone().multiplyScalar((A.gesture.barycenter.x-A.gesture.lastBarycenter.x)*10)}else{if(window.__player.getExperience()._deviceCurrentOrientation==4){z=B.clone().applyMatrix4(x).multiplyScalar(-(A.gesture.barycenter.y-A.gesture.lastBarycenter.y)*10);y=B.clone().multiplyScalar(-(A.gesture.barycenter.x-A.gesture.lastBarycenter.x)*10)}else{z=B.clone().applyMatrix4(x).multiplyScalar((A.gesture.barycenter.x-A.gesture.lastBarycenter.x)*10);y=B.clone().multiplyScalar(-(A.gesture.barycenter.y-A.gesture.lastBarycenter.y)*10)}}}var s=this._rootModelNode.getMatrix();var p=new n.Vector3();p.getPositionFromMatrix(s);p.add(y);p.add(z);s.setPosition(p);this._rootModelNode.setMatrix(s)}}}},});return k});