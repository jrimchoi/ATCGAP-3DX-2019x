define("DS/VCXWebExplodeServices/VCXExplodeBox",["UWA/Class","DS/Visualization/SceneGraphUtils","DS/Visualization/ThreeJS_DS","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VCXWebTracks/VCXEasing",],function(d,c,e,b,f){var a=d.extend({init:function(i,h,g){this._viewer=g;this._modifiablesInfos=[];this.id=h;if(Array.isArray(i)){this.setFromComponentsArray(i)}else{if(i.IsKindOf("VCXWebComponentOccurrence")&&!i.IsDressup){this.setFromComponentsArray([i])}}},setFromComponentsArray:function(g){if(!(Array.isArray(g))||g.length===0){console.error("A non-empty array is needed..");return}this._empty();for(var h=0;h<g.length;++h){if(!g[h]){console.log("ExplodeBox #"+this.id+": The "+h+"th object of the array is not defined. Resuming at the next index..");continue}if(!g[h].IsKindOf("VCXWebComponentOccurrence")||g[h].IsDressup){var j=g[h].GetType();console.log("ExplodeBox #"+this.id+": The "+h+"th object of the array is not a VCXWebComponentOccurrence, it is a "+j+". Resuming at the next index..");continue}this.addComponent(g[h])}},_empty:function(){this._modifiablesInfos=[]},addComponent:function(g){if(!g.IsKindOf("VCXWebComponentOccurrence")||g.IsDressup){console.error("A component is needed as parameter !");return}var h=g.QueryInterface("VCXIModifiable");var i=h.GetProperty("Actor.Position");var k=i.GetPropertyValue();var j={modifiable:h,initialPropertyLocationValue:k};this._modifiablesInfos.push(j)},saveInitPosition:function(){for(var g=0;g<this._modifiablesInfos.length;++g){var h=this._modifiablesInfos[g].modifiable.GetProperty("Actor.Position");this._modifiablesInfos[g].initialPropertyLocationValue=h.GetPropertyValue()}},restoreInitPosition:function(){for(var h=0;h<this._modifiablesInfos.length;++h){var g=this._modifiablesInfos[h].initialPropertyLocationValue;this._modifiablesInfos[h].modifiable.OnChangeProperty("Actor.Position",g)}},translate:function(n,j,m){for(var h=0;h<this._modifiablesInfos.length;++h){var k=b.buildPropertyLocationWithTranslationInWCS(this._modifiablesInfos[h].modifiable,n);var l=k.GetPropertyValue();var g=m;if(g===null||g===undefined){g=true}if(g){if(j.GetType&&j.GetType()==="VCXCmdChangePropertiesWithAnimation"){j.ChangeProperty(this._modifiablesInfos[h].modifiable,k,f.easeInOutPower3)}else{if(j.GetType&&j.GetType()==="VCXCmdChangePropertiesAutokey"){j.ChangeProperty(this._modifiablesInfos[h].modifiable,k)}else{console.error("Case not supported");return}}}else{this._modifiablesInfos[h].modifiable.OnChangeProperty("Actor.Position",l);this._modifiablesInfos[h].modifiable.OnChangePropertiesEnd()}}},getOBBDimensionsInWCS:function(m){var k=[];var g=this.getModifiablesInfos();for(var j=0;j<g.length;++j){var l=g[j].modifiable.QueryInterface("W3AISGNodeHolder").getPathElement();k.push(l)}var h=c.getOrientedBoundingBoxFromPathElements(k,m,this._viewer);return h},getBoundingBoxInWCS:function(){var h=new e.Box3();for(var j=0;j<this._modifiablesInfos.length;++j){var k=this._modifiablesInfos[j].modifiable.QueryInterface("W3AISGNodeHolder");var l=k.getPathElement();var g=l.getBoundingBox(null,this._viewer);g.applyMatrix4(k.getWorldMatrix(this._viewer));h.union(g)}return h},getInitialCenterInWCS:function(){var l=this._modifiablesInfos[0].initialPropertyLocationValue.GetFrame().GetValue();var k=this._modifiablesInfos[0].modifiable.GetProperty("Actor.Position").GetPropertyValue().GetFrame().GetValue();var n=new e.Vector3().getPositionFromMatrix(l);var j=new e.Vector3().getPositionFromMatrix(k);var m=new e.Matrix4().setPosition(new e.Vector3().copy(n).sub(j));var q=this._modifiablesInfos[0].modifiable.QueryInterface("W3AISGNodeHolder").getPathElement().getParentPath().getWorldMatrix(this._viewer);var p=new e.Matrix4().extractRotation(q);var h=new e.Matrix4().copy(p).multiply(m);var i=new e.Vector3().getPositionFromMatrix(h);var g=new e.Vector3().copy(this.getCenterInWCS());var o=g.add(i);return o},getBoxCenterInWCS:function(){var g=this.getBoundingBoxInWCS();return g.center()},getCenterInWCS:function(){return this.getBoxCenterInWCS()},getBoundingSphereInWCS:function(){var j=new e.Sphere();for(var h=0;h<this._modifiablesInfos.length;++h){var k=this._modifiablesInfos[h].modifiable.QueryInterface("W3AISGNodeHolder").getPathElement();var g=k.getBoundingSphere();j.mergeWithSphere(g,j)}return j},getSphereCenterInWCS:function(){var g=this.getBoundingSphereInWCS();return g.center.clone()},getModifiablesInfos:function(){return this._modifiablesInfos}});return a});define("DS/VCXWebExplodeServices/VCXExplodeBoxManager",["DS/Visualization/ThreeJS_DS","DS/VCXWebExplodeServices/VCXExplodeBox","DS/WebApplicationBase/W3AAManager"],function(c,b,d){var a=d.extend({initialize:function(){this.explodeBoxes=null;this._bExplodeBoxListSorted=false;this._explodeHandleMatrix=null;this._mapModifiableExplodeBox=null},postInitialize:function(){},unInitialize:function(){this.explodeBoxes=null;this._bExplodeBoxListSorted=false;this._explodeHandleMatrix=null;this._mapModifiableExplodeBox=null},createExplodeBoxesList:function(e){if(!(Array.isArray(e))||e.length===0){console.error("A non-empty array is needed..");return}if(this.explodeBoxes!==null){this.disposeExplodeBoxes()}var g=[];for(var f=0;f<e.length;++f){g[f]=this.createExplodeBoxFromArray([e[f]])}return g},createExplodeBoxFromArray:function(e){if(!(Array.isArray(e))||e.length===0){console.error("A non-empty array is needed..");return}if(this.explodeBoxes===null){this.explodeBoxes={}}var k=-1;for(var j in this.explodeBoxes){if(this.explodeBoxes.hasOwnProperty(j)){var h=parseInt(j,10);if(h>k){k=h}}}var f=new b(e,k+1,this._experienceBase.getManager("VCXContextManager").getMainViewer());this.explodeBoxes[k+1]=f;for(var g=0;g<e.length;++g){if(this._mapModifiableExplodeBox===null){this._mapModifiableExplodeBox={}}this._mapModifiableExplodeBox[e[g].GetID()]=k+1}return f},sortExplodeBoxList:function(f,e,j,h){if(h){var g=new c.Vector3().copy(h).normalize()}var i=f.toLowerCase();switch(i){case"linear":case"linearcenter":e.sort(function(m,k){if(!(m instanceof b&&k instanceof b)){console.error("The explodeBoxList specified in parameter do not contains exclusively ExplodeBoxes");return}var q=m.getCenterInWCS();var p=k.getCenterInWCS();var r=new c.Vector3().subVectors(q,j).dot(g);var l=new c.Vector3().subVectors(p,j).dot(g);if(Math.abs(r-l)>0.001){if(r>l){return 1}if(r<l){return -1}}else{var n=m.getBoundingBoxInWCS().size().projectOnVector(h).length();var o=k.getBoundingBoxInWCS().size().projectOnVector(h).length();if(Math.abs(n-o)>0.001){if(n<o){return 1}if(n>o){return -1}}else{if(new c.Vector3().copy(h).dot(new c.Vector3(0,0,1))<0.5){if(q.z>p.z){return 1}if(q.z<p.z){return -1}}return 0}}});break;case"linearnearbound":e.sort(function(r,q){if(!(r instanceof b&&q instanceof b)){console.error("The explodeBoxList specified in parameter do not contains exclusively ExplodeBoxes");return}var n=new c.Vector3().copy(r.getCenterInWCS());var t=new c.Vector3().copy(q.getCenterInWCS());var m=new c.Vector3().subVectors(n,j).dot(g);var s=new c.Vector3().subVectors(t,j).dot(g);var k=r.getBoundingBoxInWCS().size().projectOnVector(g).length();var o=q.getBoundingBoxInWCS().size().projectOnVector(g).length();var p=m-(k/2);var l=s-(o/2);if(Math.abs(p-l)>0.001){if(p>l){return 1}if(p<l){return -1}}else{if(Math.abs(m-s)>0.001){if(m>s){return 1}if(m<s){return -1}}else{if(new c.Vector3().copy(h).dot(new c.Vector3(0,0,1))<0.5){if(n.z>t.z){return 1}if(n.z<t.z){return -1}return 0}return 0}}});break;case"linearfarbound":e.sort(function(r,p){if(!(r instanceof b&&p instanceof b)){console.error("The explodeBoxList specified in parameter do not contains exclusively ExplodeBoxes");return}var n=new c.Vector3().copy(r.getCenterInWCS());var t=new c.Vector3().copy(p.getCenterInWCS());var m=new c.Vector3().subVectors(n,j).dot(g);var s=new c.Vector3().subVectors(t,j).dot(g);var k=r.getBoundingBoxInWCS().size().projectOnVector(g).length();var o=p.getBoundingBoxInWCS().size().projectOnVector(g).length();var l=m+(k/2);var q=s+(o/2);if(Math.abs(l-q)>0.001){if(l>q){return 1}if(l<q){return -1}}else{if(Math.abs(m-s)>0.001){if(m>s){return 1}if(m<s){return -1}}else{if(new c.Vector3().copy(h).dot(new c.Vector3(0,0,1))<0.5){if(n.z>t.z){return 1}if(n.z<t.z){return -1}return 0}return 0}}});break;case"spherical":e.sort(function(l,k){if(!(l instanceof b&&k instanceof b)){console.error("The explodeBoxList specified in parameter do not contains exclusively ExplodeBoxes");return}var p=new c.Vector3().copy(l.getCenterInWCS());var n=new c.Vector3().copy(k.getCenterInWCS());var m=new c.Vector3().subVectors(p,j).length();var o=new c.Vector3().subVectors(n,j).length();if(m>o){return 1}if(m<o){return -1}return 0});break;case"cylindrical":e.sort(function(n,m){if(!(n instanceof b&&m instanceof b)){console.error("The explodeBoxList specified in parameter do not contains exclusively ExplodeBoxes");return}var q=new c.Vector3().copy(n.getCenterInWCS());var p=new c.Vector3().copy(m.getCenterInWCS());var l=new c.Vector3().subVectors(q,j);var k=new c.Vector3().subVectors(p,j);var o=new c.Vector3().copy(l).projectOnPlane(h).length();var r=new c.Vector3().copy(k).projectOnPlane(h).length();if(o>r){return 1}if(o<r){return -1}return 0});break;default:console.error("Please specify a type of sorting for the explode in order to sort the explodeBox array properly. Available types are :\n\t'linear' for sorting by explodeBoxes' center position in the direction of the axis \n\t'linearfarbound' for sorting by explodeBoxes' farthest bound in the direction of the axis \n\t'linearnearbound' for sorting by explodeBoxes' farthest bound in the opposite direction of the axis \n\t'spherical' for sorting by distance between explodeBoxes' center and explode center \n\t'cylindrical' for sorting by distance between explodeBoxes' center and axis.");this._bExplodeBoxListSorted=false;return false}this._bExplodeBoxListSorted=true},getExplBoxFromModifID:function(e){var f=this._mapModifiableExplodeBox[e];return this.getExplBoxFromID(f)},getExplBoxFromID:function(e){return this.explodeBoxes[e]},disposeExplodeBoxes:function(){this.explodeBoxes=null;this._mapModifiableExplodeBox=null;this._bExplodeBoxListSorted=false},isExplodeBoxListSorted:function(){return this._bExplodeBoxListSorted},saveExplodeHandleMatrix:function(e){this._explodeHandleMatrix=new c.Matrix4().copy(e)},getExplodeHandleMatrix:function(){return this._explodeHandleMatrix.clone()}});Object.defineProperty(a.prototype,"componentType",{enumerable:true,get:function(){return"VCXExplodeBoxManager"}});return a});