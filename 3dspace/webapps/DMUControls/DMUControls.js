define("DS/DMUControls/EXPSnapshotControl",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/Windows/Dialog","DS/Controls/Button","DS/UIKIT/Spinner","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(h,b,g,e,d,c,a){if(navigator.mediaDevices===undefined){navigator.mediaDevices={}}if(navigator.mediaDevices.getUserMedia===undefined){navigator.mediaDevices.getUserMedia=function(j){var i=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;if(!i){return Promise.reject(new Error("getUserMedia is not implemented"))}return new Promise(function(l,k){i.call(navigator,j,l,k)})}}var f=b.extend({init:function(l){this._parent(l);var y=this;var r;var j=h.createElement("div",{"class":"EXPSnapshotControl"});var n=h.createElement("div",{"class":"EXPSnapshotControlSpinnerDiv"}).inject(j);var p=h.createElement("video",{"class":"EXPSnapshotVideo"}).inject(j);var A=h.createElement("div",{"class":"EXPSnapshotControlSnapDiv",styles:{opacity:0}}).inject(j);var x=new c({visible:true}).inject(n);var s=new Image();var u=h.createElement("canvas");var B=[];var i=300;function k(){A.setStyles({width:p.videoWidth,height:p.videoHeight});A.addClassName("EXPSnapshotAnimation");p.pause();u.width=p.videoWidth;u.height=p.videoHeight;u.getContext("2d").drawImage(p,0,0,p.videoWidth,p.videoHeight);s.src=u.toDataURL("image/png");s.width=p.videoWidth;s.height=p.videoHeight;C.elements.button.setStyles({display:""});m.elements.button.setStyles({display:""});t.elements.button.setStyles({display:"none"})}function z(){var E=s.width,D=s.height;if(E>i){D=i*D/E;E=i}if(D>i){E=i*E/D;D=i}l.onValidateSnapshotCB({img:s,width:E,height:D});o()}function o(){for(var E=0;E<B.length;E++){var D=B[E].getTracks();for(var F=0;F<D.length;F++){D[F].stop()}}B.length=0;if(x){x.destroy()}if(r){r.destroy()}r=x=y=j=p=null}function q(){p.play();A.removeClassName("EXPSnapshotAnimation");C.elements.button.setStyles({display:"none"});m.elements.button.setStyles({display:"none"});t.elements.button.setStyles({display:""})}function v(){o();if(l.onCloseSnapshotCB){l.onCloseSnapshotCB()}}var C=new d({emphasize:"primary",touchMode:true,label:a.snapshotValidate,onClick:z});var m=new d({label:a.snapshotReset,touchMode:true,onClick:q});var t=new d({label:a.captureSnapshot,touchMode:true,onClick:k});r=new e({touchMode:true,modalFlag:true,ensureHeightDefinitionOnHierarchy:true,title:a.snapshotTitle,content:j,immersiveFrame:l.immersiveFrame,buttons:{Cancel:t,Ok:C,Apply:m}});r.addEventListener("close",v);t.disabled=true;t.elements.button.setStyles({display:""});C.elements.button.setStyles({display:"none"});m.elements.button.setStyles({display:"none"});var w=navigator.mediaDevices.getUserMedia({video:{width:{min:50,max:640},height:{min:50,max:360}}});w.then(function(D){if(!D){if(l.onErrorCB){l.onErrorCB()}return o()}if("srcObject" in p){p.srcObject=D}else{p.src=window.URL.createObjectURL(D)}B.push(D);p.onloadedmetadata=function(){t.disabled=false;j.removeChild(n);p.play()}});w["catch"](function(){if(l.onErrorCB){l.onErrorCB()}o()})}});return f});define("DS/DMUControls/panels/DMU3DComparePanel",["UWA/Core","UWA/Class","DS/CATWebUXComponents/CATWebUXPanel","DS/Controls/Button","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(f,c,b,e,d){var a=c.extend({init:function(o){this._parent(o);var h;var l;var i,n,m;var j=null;var k=true;this.buildPanel=function(r){this.clean();j=r.displayType;if(!h){h=f.createElement("div",{id:"DMU3DCompareMainDiv"})}var q=f.createElement("div",{id:"panelcontent","class":"DMU3DCompareContainerDiv"}).inject(h);var p=f.createElement("div",{id:"comparecontent","class":"DMU3DCompareCompareContentDiv"}).inject(q);i=g({leftLabel:d.dmuCompareNewLabel,color:r.newStyleColor,rightLabel:r.newStyleLabel||d.dmuCompareLoadingLabel});i.inject(p);n=g({leftLabel:d.dmuCompareOldLabel,color:r.oldStyleColor,rightLabel:r.oldStyleLabel||d.dmuCompareLoadingLabel});n.inject(p);m=g({leftLabel:d.dmuCompareCommonLabel,color:r.commonStyleColor,rightLabel:r.commonStyleLabel||null});m.inject(p);if(j!=="reduce"){var t=f.createElement("div",{"class":"DMU3DCompareButtonDiv"}).inject(q);new e({label:d.dmuCompareButtonLabel,emphasize:"secondary",onClick:function(){if(r.onClickCB){r.onClickCB()}}}).inject(t)}var s={id:"DMU3DComparePanel",className:"DMU3DComparePanel",title:r.title||d.dmuCompareTitle,icon:r.icon,immersiveFrame:r.immersiveFrame,content:h,minWidth:250,width:250,allowedDockAreas:WUXDockAreaEnum.RightDockArea|WUXDockAreaEnum.LeftDockArea,position:{at:"top right"}};l=new b(s);this.displaying(k);return h};this.clean=function(){if(!h){return}while(h.firstChild){h.removeChild(h.firstChild)}if(l){l.clean()}h=l=null};this.displaying=function(p){k=p;if(l){l.setPanelVisibilityFlag(k)}};this.updatePanel=function(p){if(!h){return}if(p.firstLabel&&i){i.querySelector(".DMU3DCompareRightLabel").innerHTML=p.firstLabel}if(p.secondLabel&&n){n.querySelector(".DMU3DCompareRightLabel").innerHTML=p.secondLabel}if(p.thirdLabel&&n){m.querySelector(".DMU3DCompareRightLabel").innerHTML=p.secondLabel}};var g=function(s){var q=new f.Element("div",{"class":"DMU3DCompareLine"});if(j!=="reduce"){new f.Element("div",{"class":"DMU3DCompareText DMU3DCompareLeftLabel",html:s.leftLabel}).inject(q)}var p=f.createElement("div",{"class":"DMU3DCompareColorDot"}).inject(q);p.style.background=s.color;var r=new f.Element("div",{"class":"DMU3DCompareText DMU3DCompareRightLabel",html:s.rightLabel});r.inject(q);if(j==="reduce"){r.setStyles({width:"calc(100% - 28px)"})}return q}}});return a});define("DS/DMUControls/DMUHTMLBox",["UWA/Core","UWA/Controls/Abstract","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseExperience/EXPToolsVisualization","DS/SceneGraphNodes/CSS2DNode","DS/Visualization/ThreeJS_DS","css!DS/DMUControls/DMUControls.css"],function(g,f,e,b,a,c){var d=f.extend({init:function(j){this._parent(j);var m;var l=new g.Element("div",{contenteditable:false,"class":"DMUHTMLBoxWidget",style:{whiteSpace:"pre-line"}});var o=g.createElement("p",{"class":"DMUHTMLBoxParagraph"}).inject(l);var k=navigator.userAgent&&navigator.userAgent.search("Chrome")===-1&&navigator.userAgent.search("Firefox")===-1?"IE":"ChromeFF";if(j.onTextModifiedCB){if(k!=="IE"){l.addEventListener("input",j.onTextModifiedCB)}else{l.addEventListener("keyup",j.onTextModifiedCB);l.addEventListener("paste",j.onTextModifiedCB)}}var h=new a({html:l,position:j.positionBreakPoint3D,name:j.title});h._getExcludeFromCSO=function(){return true};h.css2DNode.primitive=true;j.parentNode.addChild(h);this.remove=function(){if(l){l.destroy()}j.parentNode.removeChild(h);h=l=null};function i(r,s){var q,p;if(r.offsetHeight){q=r.offsetHeight}else{if(r.style.pixelHeight){q=r.style.pixelHeight}}if(r.offsetWidth){p=r.offsetWidth}else{if(r.style.pixelWidth){p=r.style.pixelWidth}}return(q&&p)?{left:s.left+(p/2),top:s.top+(q/2)}:{}}function n(q){m=q.clone();var r=b.getWindowPositionFromPoint(j.viewer,m,j.window);if(h&&h.getElement()){h.setMatrix(new c.Matrix4().setPosition(m));h.updatePosition();var p=i(h.getElement(),r);if(p&&p.left&&p.top){h.setOffset(new c.Vector2((r.left-p.left)*window.devicePixelRatio,(r.top-p.top)*window.devicePixelRatio))}else{h.setOffset(new c.Vector2(0,0))}}}this.focusAndSelectText=function(){window.getSelection().removeAllRanges();var p=document.createRange();p.selectNodeContents(o);window.getSelection().addRange(p);o.focus()};this.getText=function(){var r=[];var q=(o.innerText||"").split("\n");for(var p=0;p<q.length;p++){if(!q[p]&&p===q.length-1){continue}q[p]=q[p].replace("\r","");r.push(q[p])}return r};this.update=function(q){if(q.textAlign){l.style.textAlign=q.textAlign}if(q.padding){l.style.padding=q.padding}if(q.sFontName){l.style.fontFamily=q.sFontName}if(q.iFontSize){l.style.fontSize=q.iFontSize}if(q.sFontStyle){if(q.sFontStyle==="bold"){l.style.fontWeight=q.sFontStyle}else{l.style.fontStyle=q.sFontStyle}}if(q.cFontColor){l.style.color=e.colorToHex(q.cFontColor)}if(q.bIsFilled!==undefined){if(q.bIsFilled){if(q.cFillStyleColor){l.style.background=e.hexToRgb(e.colorToHex(q.cFillStyleColor),q.fOpacity?q.fOpacity:1)}}else{l.style.background="none"}}if(q.bHasBorder!==undefined){if(q.bHasBorder){if(q.cLineStyleColor){l.style.borderColor=e.colorToHex(q.cLineStyleColor)}if(q.fLineStyleThickness){l.style.borderWidth=q.fLineStyleThickness}if(q.sLineStylePattern){l.style.borderStyle="solid"}}else{l.style.border="none"}}if(q.borderRadius){l.style.borderRadius=q.borderRadius}if(q.lineHeight){l.style.lineHeight=q.lineHeight;o.style.lineHeight=q.lineHeight}if(q.sTextContents){o.innerHTML="";for(var p=0;p<q.sTextContents.length;p++){o.innerHTML+=q.sTextContents[p];if(p!==q.sTextContents.length-1){o.innerHTML+="<br>"}}}if(q.bEditable!==undefined&&l.contenteditable!==q.bEditable){var r=l.childNodes;for(var p=0;p<r.length;p++){r[p].setAttributes({contenteditable:q.bEditable})}}if(q.position){n(q.position)}}}});return d});define("DS/DMUControls/EXPLevelSelector",["UWA/Class","DS/LevelSelector/LevelSelector","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUToolsSceneGraph"],function(b,f,d,a,e){var c=b.extend({init:function(k){var l=this;if(!k||k&&!k.iFrameWindow){return}this.clean=function(){var m=f._noAnim;f._noAnim=true;f.destroyView();f._noAnim=m};var i=function(o,m){var t=[];var u=k.iGetPathElementCB();var r=[],n=u.externalPath.length;for(var p=0;p<n;++p){var s=u.getLastElement(true);if(k.iFilterNodeCB(u)){t.push({pathElement:u.clone(),name:s.name,internalLevel:n-p});r.push(s)}u=u.getParentPath()}if(!m){var q=d.getContextViewer({viewer:k.iFrameWindow.getViewer()});if(q){e.getName(r,function(w){for(var v=0;v<w.length;++v){t[v].name=w[v]}o()},q,"")}}return t};var j=function(m){if(k.iOnLevelHoverCB){k.iOnLevelHoverCB(m)}};var h=function(m){g(k.iGet3DPositionCB,k.iGet2DPositionCB,k.iGetDelta2DPosition);k.iOnLevelSelectCB(m)};function g(r,p,o){var n=p?p():a.getWindowPositionFromPoint(k.iFrameWindow.getViewer(),r(),k.iFrameWindow);var q=o?o():{left:0,top:0};var m={positionX:n.left+q.left,positionY:n.top+q.top,uiFrame:k.iFrameWindow.getUIFrame(),getLevels:i,onHover:j,onSelect:h};l.clean();f.createView(m)}g(k.iGet3DPositionCB,k.iGet2DPositionCB,k.iGetDelta2DPosition)}});return c});define("DS/DMUControls/EXPNotify",["UWA/Class","DS/CATWebUXComponents/CATWebUXNotification"],function(a,b){return a.extend({init:function(d){var c=new b();d.message=d.messages;c.build(d);this.destroy=function(){if(c){c.destroy()}c=null}}})});define("DS/DMUControls/EXPNavBar",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/VisuEvents/EventsManager","UWA/Controls/ThemedScroller","UWA/Utils/Client","DS/Controls/TabBar","css!DS/DMUControls/DMUControls.css"],function(h,d,g,a,f,e,c){var b=d.extend({init:function(n){var s=n||{};if(!s.frameWindow){return}this._parent(s);var l;var m={};var q;var o=s.offset?s.offset:0;var j=s.activeTabIndex?s.activeTabIndex:s.tabs?s.tabs[0].id:null;var k=true;var i=function(){if(!l||!q){return}var z=s.frameWindow.getImmersiveFrame().getFreeZone().getSize();if(z.width){var D=q.getWidthWithoutScroll();var x=z.width-o;var A=D+100>x?x:D+100;l.setStyles({"max-width":A-50+"px",width:A-50+"px"});var u=0;var w=s.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.LeftDockArea);var C=w.getContainedWindows();if(C&&((C.length===1&&C[0].isAWindowGroup()&&C[0].getEmbeddedWindows().length)||(C.length===1&&!C[0].isAWindowGroup()))){var v=C[0].getEmbeddedWindows?C[0].getEmbeddedWindows():C;var t=false;for(var y=0;y<v.length;y++){if(v[y].visibleFlag){t=true}}if(t&&!w.collapseDockingZoneFlag){var B=w._collapserSize;u=w.dockingZoneSize+B}}else{if(w.interactiveDockAreaVisibleFlag){u=w.dockingZoneSize}}u+=(x-A)/2+o+25;l.setStyles({left:u+"px"})}};this.setOffset=function(t){if(o!==t){o=t;i()}};this.getOffset=function(){return o};this.setVisibleFlag=function(t){l.setStyles({display:t?"":"none"})};this.getVisibleFlag=function(){return l.style.display===""};this.setActiveNarBarItem=function(t){if(q){k=false;q.value=[t];j=t;k=true}};this.getActiveNarBarItem=function(){if(q){return q.value}return undefined};this.clean=function(){if(q){q.displayStyle="normal";q.destroy()}if(l){s.frameWindow.getUIFrame().removeChild(l)}if(m.onFreeZoneResize&&s.frameWindow){s.frameWindow.getImmersiveFrame().removeEventListener("freeZoneResize",i)}l=q=null;m={}};var r=function(t){if(k&&t.dsModel.value[0]&&t.dsModel.value[0]!==j){j=t.dsModel.value[0];s.onClickCB(j)}k=true};l=h.createElement("div",{"class":"EXPNavBar"}).inject(s.frameWindow.getUIFrame());l.setStyles({opacity:0});q=new c({displayStyle:["strip","strip-box"],showComboBoxFlag:true}).inject(l);q.addEventListener("change",r);if(s.tabs&&s.tabs.length){for(var p=0;p<s.tabs.length;p++){q.add({value:s.tabs[p].id,label:s.tabs[p].label})}}if(!m.onFreeZoneResize){s.frameWindow.getImmersiveFrame().addEventListener("freeZoneResize",i);m.onFreeZoneResize=1}if(j){this.setActiveNarBarItem(s.activeTabIndex)}setTimeout(function(){if(!l){return}i();l.setStyles({opacity:1})},50)}});return b});define("DS/DMUControls/EXPTranslationSlider",["UWA/Core","UWA/Class","DS/Controls/Slider","DS/WebappsUtils/WebappsUtils","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(f,c,e,d,b){var a=c.extend({init:function(j){var p=j||{};this._parent(p);if(!p.frameWindow){return}var n=true;var h={};var k=new f.Element("div",{"class":"EXPTranslationSlider",styles:{opacity:0}}).inject(p.frameWindow.getUIFrame());var o=typeof p.initValue==="number"&&p.initValue>=-1&&p.initValue<=1?p.initValue:0;function l(){if(!k){return}var u=p.frameWindow.getImmersiveFrame().getFreeZone().getSize();if(u.width){var w=0;var q=p.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.LeftDockArea);var v=q.getContainedWindows();if(v&&((v.length===1&&v[0].isAWindowGroup()&&v[0].getEmbeddedWindows().length)||(v.length===1&&!v[0].isAWindowGroup()))){var t=v[0].getEmbeddedWindows?v[0].getEmbeddedWindows():v;var x=false;for(var r=0;r<t.length;r++){if(t[r].visibleFlag){x=true}}if(x&&!q.collapseDockingZoneFlag){var s=q._collapserSize;w=q.dockingZoneSize+s}}else{if(q.interactiveDockAreaVisibleFlag){w=q.dockingZoneSize}}w+=u.width/2-100;k.setStyles({left:w+"px"})}}var i=d.getWebappsBaseUrl()+"DMUBaseCommands/assets/icons/32/";new f.createElement("img",{"class":"EXPTranslationSliderImg",title:b.moveLeft,src:i+"Left_CuttingPlane.png",styles:{left:"0px"}}).inject(k);var m=f.createElement("div",{"class":"EXPTranslationSliderContainer"}).inject(k);var g=new e({minValue:-1,maxValue:1,stepValue:0.1,value:o}).inject(m);g.addEventListener("change",function(){if(p.onChangeCB){p.onChangeCB(g.value)}});new f.createElement("img",{"class":"EXPTranslationSliderImg",title:b.moveRight,src:i+"Right_CuttingPlane.png",styles:{left:"198px"}}).inject(k);if(!h.onFreeZoneResize){p.frameWindow.getImmersiveFrame().addEventListener("freeZoneResize",l);h.onFreeZoneResize=1}setTimeout(function(){if(!k){return}l();k.setStyles({opacity:1})},50);this.setValue=function(q){if(!g||q<-1||q>1){return}g.value=q};this.getValue=function(){if(!g){return undefined}return g.value};this.getVisibleFlag=function(){return n};this.setVisibleFlag=function(q){n=q;k.setStyle("display",n?"":"none")};this.clean=function(){if(j.frameWindow&&k&&k.parentNode===j.frameWindow.getUIFrame()){j.frameWindow.getUIFrame().removeChild(k)}if(h.onFreeZoneResize&&p.frameWindow){p.frameWindow.getImmersiveFrame().removeEventListener("freeZoneResize",l)}k=null;h={}}}});return a});define("DS/DMUControls/EXPColorPicker",["UWA/Core","UWA/Class","DS/Controls/Gauge","DS/Visualization/ThreeJS_DS","DS/VisuEvents/EventsManager","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/VisuEvents/EventsManager","css!DS/DMUControls/DMUControls.css"],function(g,a,b,h,c,d,f,e){var i=a.extend({init:function(x){var m=x||{};this._parent(m);var D,w;var E=d.getWebappsAssetUrl("DMUBaseUI","images/");var r=false;var C;var B=this;var H,J=true;var o=200;var L,z;var K,v;var u=true;var y,l,s;var q={color:true,opacity:true};var p=true,F;var I=[{r:0,g:0,b:0},{r:25,g:25,b:25},{r:61,g:61,b:61},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:190,g:190,b:190},{r:205,g:205,b:205},{r:230,g:230,b:230},{r:255,g:255,b:255}];var A=[{r:109,g:40,b:40},{r:204,g:9,b:47},{r:143,g:76,b:0},{r:255,g:138,b:46},{r:254,g:224,b:0},{r:87,g:184,b:71},{r:71,g:119,b:56},{r:141,g:222,b:228},{r:54,g:142,b:196},{r:77,g:98,b:186},{r:0,g:37,b:150},{r:155,g:42,b:152}];function k(M){if(typeof M.color==="boolean"){q.color=M.color;if(y){y.setStyles({display:M.color?"block":"none"})}if((I.indexOf(F)!==-1&&p)||(A.indexOf(F)!==-1&&!p)){L()}}if(typeof M.opacity==="boolean"){q.opacity=M.opacity;if(l){l.setStyles({display:M.opacity?"block":"none"});if(M.opacity&&s.getContent().hasClassName("EXPOpacitySliderDisableHover")){s.getContent().removeClassName("EXPOpacitySliderDisableHover")}else{if(!M.opacity){s.getContent().addClassName("EXPOpacitySliderDisableHover")}}}}}function t(Q){w=new g.createElement("div",{"class":"EXPColorPickerColorSlider"}).inject(D);var P;var O=-1,S=-1;if(Q.defaultColor){var N=new h.Color();for(var V=0;V<A.length;V++){N.setRGB(A[V].r/255,A[V].g/255,A[V].b/255);if(N.equals(Q.defaultColor)){S=V;p=true;F=A[V];break}}if(S===-1){for(var V=0;V<I.length;V++){N.setRGB(I[V].r/255,I[V].g/255,I[V].b/255);if(N.equals(Q.defaultColor)){O=V;p=false;F=I[V];break}}}}else{S=0;p=true}var T=!p?O:(S!==-1?S:6);var R=function(X){var Y=[];if(P.id==="color_gauge"){Y=A}else{if(P.id==="bw_gauge"){Y=I}}if(!isNaN(M.getValue())){var W=M.getValue();F=Y[W];y.setHTML("");y.setStyles({backgroundImage:"none",backgroundColor:"rgb("+Y[W].r+","+Y[W].g+","+Y[W].b+")","-webkit-transform":"translate3d(-50%,0,0)","-moz-transform":"translate3d(-50%,0,0)","-ms-transform":"translate3d(-50%,0,0)","-o-transform":"translate3d(-50%,0,0)",transform:"translate3d(-50%,0,0)"});if(Q.onColorChangedCB){T=W;if(X.sendCB){Q.onColorChangedCB({color:"rgb("+Y[T].r+","+Y[T].g+","+Y[T].b+")"})}}}};z=new g.Element("div",{"class":"EXPColorPickerBWSwitch"}).inject(w);var U=new g.createElement("img").inject(z);U.src=E+(!p?"I_SwitchColorPalette.png":"I_SwitchBWPalette.png");var M=new b({className:"EXPColorPickerColorGauge",minValue:0,maxValue:A.length-1,stepValue:1,value:T,graduationsLabel:false,dynamicGaugeColor:false,eventsList:[]}).inject(w);P=M.getContent();M.elements.control.setStyles({height:"30px",margin:0});y=M._cursors[1];y.setStyles({height:"30px",width:"20px","border-radius":"0px","border-width":"4px 3px","border-style":"solid","border-color":"rgb(240, 240, 240)",outline:"1px solid #adadad"});y.setHTML("");M._cursors[0].setStyles({backgroundColor:"none"});P.setAttributes({id:!p?"bw_gauge":"color_gauge"});P.setStyles({backgroundImage:'url("'+E+(!p?"BWPalette.jpg":"ColorPalette.jpg")+'")',position:"absolute","margin-top":"14px",left:"30px"});M.addEvent("change",function(){if(v&&v.hasClassName("EXPColorPickerResetButtonActiveState")){v.removeClassName("EXPColorPickerResetButtonActiveState")}R({sendCB:true});k({color:true,opacity:Q.colorAndOpacityBinded})});L=function(){p=!p;if(P.id==="color_gauge"){P.style.backgroundImage='url("'+E+'BWPalette.jpg")';P.id="bw_gauge";U.src=E+"I_SwitchColorPalette.png"}else{if(P.id==="bw_gauge"){P.style.backgroundImage='url("'+E+'ColorPalette.jpg")';P.id="color_gauge";U.src=E+"I_SwitchBWPalette.png"}}if(q.color){T=-1;R({sendCB:true})}};c.addEvent(z,"onPrimaryPointerClick",L);k({color:Q.defaultColor!==null,opacity:Q.colorAndOpacityBinded&&Q.defaultColor!==null});R({sendCB:false})}function n(N){v=new g.createElement("div",{"class":"EXPColorPickerResetButton"}).inject(w);v.title=N.resetButtonLabel;if(N.defaultResetState){v.addClassName("EXPColorPickerResetButtonActiveState");k({color:false,opacity:false})}var M=new g.createElement("img",{"class":"EXPColorPickerResetButtonIcon"}).inject(v);M.src=d.getWebappsAssetUrl("DMUControls","icons/22/")+"I_ResetButton.png";K=function(){if(!v.hasClassName("EXPColorPickerResetButtonActiveState")){N.onResetButtonPressedCB();v.addClassName("EXPColorPickerResetButtonActiveState");k({color:false,opacity:false})}};c.addEvent(v,"onPrimaryPointerClick",K)}function G(M){var O=new g.createElement("div",{"class":"EXPColorPickerOpacitySlider"}).inject(D);var N;if(M.defaultOpacity==0){N=0}else{N=M.defaultOpacity?M.defaultOpacity:1}s=new b({className:"EXPColorPickerOpacityGauge",minValue:M.minOpacity?M.minOpacity:0,maxValue:M.maxOpacity?M.maxOpacity:1,stepValue:0.1,value:N,graduationsLabel:false,dynamicGaugeColor:false,eventsList:[]}).inject(O);s.getContent().setStyles({"margin-top":"5px",border:"none"});s.elements.control.setStyles({height:"10px",top:"4px"});l=s._cursors[1];k({opacity:M.defaultOpacity!==null,color:M.colorAndOpacityBinded&&M.defaultOpacity!==null});s._cursors[1].setStyles({height:"20px",top:"-4px"});s.addEvent("change",function(){if(v&&v.hasClassName("EXPColorPickerResetButtonActiveState")){v.removeClassName("EXPColorPickerResetButtonActiveState")}k({opacity:true,color:M.colorAndOpacityBinded});if(M.onOpacityChangedCB){M.onOpacityChangedCB({opacity:this.getValue()})}this._cursors[1].setStyles({"-webkit-transform":"translate3d(-50%,0,0)","-moz-transform":"translate3d(-50%,0,0)","-ms-transform":"translate3d(-50%,0,0)","-o-transform":"translate3d(-50%,0,0)",transform:"translate3d(-50%,0,0)"})})}function j(M){var N=M.from[0].view;while(N){if(N.className&&N.className.indexOf("EXPColorPicker")!==-1){return}N=N.parentNode}B.clean()}this.getContent=function(){return D};this.build=function(Q){J=false;B.clean();J=true;if(!Q.displayColorSlider&&!Q.displayOpacitySlider){return}D=g.createElement("div",{"class":"EXPColorPicker"});if(Q.displayColorSlider){t(Q)}if(Q.displayOpacitySlider){G(Q)}if(Q.displayResetButton){n(Q)}u=Q.hideWithDistance===false?false:true;if(m.frameWindow){var U=m.frameWindow.getContextualUIManager().getContextualBar();var R=U.getPosition();if((R&&U)||(Q.position&&Q.position.x&&Q.position.y)){var T=Q.displayColorSlider&&Q.displayOpacitySlider?80:(Q.displayColorSlider?53:30),S=238;if(Q.displayResetButton){S+=35}var P=Q.position?0:U.elements.container.getDimensions().width/2-S/2;var O=Q.position?0:U.elements.container.getDimensions().height;var N=Q.position?Q.position.x:R.x+P,M=Q.position?Q.position.y:R.y-O-T-5;if(M<0){M=R.y+5}C=new g.Element("div",{"class":"EXPContextualColorPicker",styles:{position:"absolute",top:M+"px",left:N+"px",width:S+"px",height:T+"px",opacity:1}}).inject(m.frameWindow.getUIFrame());C.appendChild(D);H=f.subscribe({event:"/VISU/"},function(V){var W=V.eventType;if(W==="@onViewpointBeginMove"){B.clean()}else{if(W==="@onMoveEvent"&&u){var X=new h.Box2(new h.Vector2(N,M),new h.Vector2(N+S,M+T)).distanceToPoint(V.event.currentPosition);if(X>o){B.clean()}else{C.setStyles({opacity:Math.min((o-X)/o,1)})}}}});e.addEvent(document,"onLeftMouseDown",j);e.addEvent(document,"onTouch",j)}}r=true};this.getVisibleFlag=function(){if(!m.frameWindow){return true}return r};this.setVisibleFlag=function(M){if(!m.frameWindow||!C){return}if(!r&&M){C.inject(m.frameWindow.getUIFrame())}else{if(r&&!M){m.frameWindow.getUIFrame().removeChild(C)}}r=M};this.clean=function(){if(m.frameWindow&&C&&C.parentNode===m.frameWindow.getUIFrame()){m.frameWindow.getUIFrame().removeChild(C)}if(L&&z){c.removeEvent(z,"onPrimaryPointerClick",L)}if(K&&v){c.removeEvent(v,"onPrimaryPointerClick",K)}if(H){f.unsubscribe(H)}e.removeEvent(document,"onLeftMouseDown",j);e.removeEvent(document,"onTouch",j);D=C=H=z=L=K=v=null;if(J&&m.onDestroyCB){m.onDestroyCB()}}}});return i});define("DS/DMUControls/EXPClippingManager",["UWA/Class","DS/Core/Events","DS/DMUBaseExperience/EXP3DReviewWidgetSingleton"],function(b,c,d){var a=b.extend({init:function(e){this._parent(e);this._indexPlane=0;this.context=e.context;this._clippingPlanes=[];var f=d.get();if(f){this._sModelerType=f.getValue("appModelerType")}},destroy:function(){this._parent()},addPlane:function(g,f){if(this._sModelerType!=="VPM"){var e=this._indexPlane++;this._clippingPlanes[e]={planePosition:g,iOnOff:f};this._dispatchClippingPlane();return e}},removePlane:function(e){if(this._sModelerType!=="VPM"){if(this._clippingPlanes){delete this._clippingPlanes[e];this._dispatchClippingPlane()}}},updatePlane:function(g,f,e){if(this._sModelerType!=="VPM"){if(this._clippingPlanes&&this._clippingPlanes[g]){this._clippingPlanes[g]={planePosition:f,iOnOff:e};this._dispatchClippingPlane()}}},_dispatchClippingPlane:function(){if(this._clippingPlanes){var e;var f=[];for(e=0;e<this._clippingPlanes.length;++e){if(this._clippingPlanes[e]!==undefined){if(this._clippingPlanes[e].iOnOff){f.push(this._clippingPlanes[e].planePosition)}}}c.publish({event:"/"+this.context.getCommandContext()+"/ASSET/EXPCLIPPINGPLANEEVENT/",data:f})}}});return a});define("DS/DMUControls/EXPFileBrowser",["UWA/Core","UWA/Controls/Abstract"],function(c,b){var a=b.extend({init:function(d){this._parent(d);var g=null;var e=new FileReader();var h=false;var i=null;function f(){if(!h&&d.onErrorCB){d.onErrorCB()}}g=new c.createElement("input",{id:"DMUFileSelector"}).inject(widget.body);g.setAttribute("type","file");g.setAttribute("accept","image/*");g.setStyles({opacity:0});g.onchange=function(){if(g){var j=g.files;if(!j||j&&!j.length){f();return}i=j[0].name;e.onload=function(){var k=new Image();k.src=e.result;k.name=i;k.onload=function(){h=true;d.onFileLoadedCB({img:k,name:i})};k.onerror=f};setTimeout(f,5000);e.readAsDataURL(j[0])}};this.openFileBrowser=function(){g.click()};this.cleanFileBrowser=function(){if(g&&g.parentNode===widget.body){widget.body.removeChild(g)}g=null}}});return a});define("DS/DMUControls/EXPWindow",["UWA/Controls/Abstract","UWA/Controls/Drag","i18n!DS/DMUControls/assets/nls/DMUControls","WebappsUtils/WebappsUtils"],function(e,b,a,d){var c=e.extend({defaultOptions:{body:null,height:"320",width:"320",title:"Window Title",position:{top:"50",left:"50"},fTopbarHeight:30,fManipulatorSize:10,fMarginAroundViewer:10,fResizeMinHeight:320,fResizeMinWidth:320,fCornerRoundRadius:4,bTopBarButtons:true,bFullScreenOnDbclickTopbar:true,bScaleManipulator:true,bMoveManipulator:true,bBoxShadow:true,bBoldTitle:false},init:function(g){this._domElements={_mainContainer:null,_topbarContainer:null,_topbarTitle:null,_topbarButtonContainer:null,_topbarTitleText:null,_Containerviewer:null,_viewer:null,_sizeControlLeft:null,_sizeControlRight:null,_sizeControlBottom:null,_sizeControlBottomLeft:null,_sizeControlBottomRight:null};var f=UWA.extend(this.defaultOptions,g);this._fullscreenObject={_bFullscreenIsEnable:false,mainContainerPreFullscreenPosition:null,mainContainerPreFullscreenSize:null};this._dragEventParameters={mainContainerOriginalPosition:null,mainContainerOriginalSize:null};this._parent(f);this._createWindow()},setHTMLContent:function(f){if(f&&f.inject){f.inject(this._domElements._viewer);f.style.width="100%";f.style.height="100%"}},setVisibility:function(g){var f=(g)?"block":"none";this._domElements._mainContainer.setStyle("display",f)},show:function(){this._domElements._mainContainer.setStyle("display","block")},noShow:function(){this._domElements._mainContainer.setStyle("display","none")},clear:function(){this._domElements._mainContainer.destroy()},isShow:function(){return !(this._domElements._mainContainer.getStyle("display")==="none")},setFullScreen:function(g,f){if(g){this._fullscreenObject.mainContainerPreFullscreenPosition=this._domElements._mainContainer.getPosition();this._fullscreenObject.mainContainerPreFullscreenSize=this._domElements._mainContainer.getSize();this._domElements._mainContainer.setStyle("width",this.options.body.parentElement.getSize().width+"px");this._domElements._mainContainer.setStyle("height",this.options.body.parentElement.getSize().height+"px");this._domElements._mainContainer.setPosition({x:0,y:0});if(this.options.bTopBarButtons){this._domElements._topBarMinimizeButton.setStyle("display","inline-block");this._domElements._topBarMaximizeButton.setStyle("display","none")}this._fullscreenObject._bFullscreenIsEnable=true}else{if(this.options.bTopBarButtons){this._domElements._topBarMinimizeButton.setStyle("display","none");this._domElements._topBarMaximizeButton.setStyle("display","inline-block")}if(!f){this._domElements._mainContainer.setStyle("width",this._fullscreenObject.mainContainerPreFullscreenSize.width+"px");this._domElements._mainContainer.setStyle("height",this._fullscreenObject.mainContainerPreFullscreenSize.height+"px");this._domElements._mainContainer.setPosition(this._fullscreenObject.mainContainerPreFullscreenPosition)}this._fullscreenObject._bFullscreenIsEnable=false}this._updateSize()},isFullScreen:function(){return this._fullscreenObject._bFullscreenIsEnable},_createWindow:function(){this._createMainContainer();this._createTopbarContainer();this._createTopbarTitle();if(this.options.bTopBarButtons){this._createTopbarButtonContainer()}this._createViewerContainer();this._createViewer();if(this.options.bScaleManipulator){this._createSizeControl()}this.setHTMLContent(this.options.HTMLContent)},_createUWADiv:function(f){return UWA.createElement("div",{styles:f})},_createUWATopButton:function(h,f,i){var g='<span title="'+f+'"><img src='+h+" ></span>";return UWA.createElement("button",{html:g,styles:{padding:"0",border:"0",backgroundColor:"#F0F0F0",display:"inline-block",verticalAlign:"middle",marginLeft:"5px",outlineStyle:"none"},events:{click:function(){i()}}})},_createMainContainer:function(){this._domElements._mainContainer=this._createUWADiv({position:"absolute",height:this.options.height,borderRadius:this.options.fCornerRoundRadius+"px",width:this.options.width,backgroundColor:"#F0F0F0",boxShadow:this.options.bBoxShadow?"0 1px 1px 0px rgba(26,25,25,0.24)":"none",top:this.options.position.top+"px",left:this.options.position.left+"px",overflow:"visible",border:"1px solid #D1D1D1",});this._domElements._mainContainer.inject(this.options.body)},_createTopbarContainer:function(){this._domElements._topbarContainer=this._createUWADiv({position:"relative",height:this.options.fTopbarHeight+"px",width:"100%",cursor:"default",overflow:"hidden"});this._domElements._topbarContainer.inject(this._domElements._mainContainer);var g=this;if(this.options.bFullScreenOnDbclickTopbar){this._domElements._topbarContainer.addEvent("dblclick",function(){g.setFullScreen(!g.isFullScreen())})}if(this.options.bMoveManipulator){var f=new b({element:this._domElements._topbarContainer,});f.move=function(){if(g.isFullScreen()){var l=g._domElements._mainContainer.getSize();var k=g._domElements._mainContainer.getPosition();var o=(this.currentEvent.clientX*100)/l.width;var j=(o*g._fullscreenObject.mainContainerPreFullscreenSize.width)/100;var i=this.currentEvent.clientX;var h=i-j;var n=k.y+this.currentDelta.y;g._domElements._mainContainer.setPosition({x:h,y:n});g._startDrag(this,g);g.setFullScreen(false)}var m=g._manipulatorComputeChecker(this,"drag");g._domElements._mainContainer.setPosition({x:m.position.x,y:m.position.y})};f.start=function(){g._startDrag(this,g)}}},_createTopbarTitle:function(){this._domElements._topbarTitle=this._createUWADiv({position:"absolute",height:"100%",lineHeight:this.options.fTopbarHeight+"px",width:"auto",overflow:"hidden"});this._domElements._topbarTitle.className="topbarTitleEXPWin";this._domElements._topbarTitle.inject(this._domElements._topbarContainer);this._domElements._topbarTitleText=this._createUWADiv({display:"inline-block",verticalAlign:"middle",lineHeight:"normal",overflow:"hidden",marginLeft:this.options.fMarginAroundViewer+"px",fontFamily:"Open Sans,Segoe UI,Helvetica,Arial,sans-serif",whiteSpace:"nowrap",textOverflow:"ellipsis",fontSize:"13px",fontWeight:this.options.bBoldTitle?"bold":"normal"});this._domElements._topbarTitleText.inject(this._domElements._topbarTitle);this._domElements._topbarTitleText.setText(this.options.title)},_createTopbarButtonContainer:function(){var h=this;this._domElements._topbarButtonContainer=this._createUWADiv({position:"absolute",height:"100%",width:100,right:0,textAlign:"right",lineHeight:this.options.fTopbarHeight+"px",marginRight:this.options.fMarginAroundViewer+"px",overflow:"hidden"});this._domElements._topbarButtonContainer.inject(this._domElements._topbarContainer);var i=d.getWebappsBaseUrl()+"DMUControls/assets/icons/maximize.png";var g=a.maximize;var f=function(){h.setFullScreen(true)};this._domElements._topBarMaximizeButton=this._createUWATopButton(i,g,f);this._domElements._topBarMaximizeButton.inject(this._domElements._topbarButtonContainer);var i=d.getWebappsBaseUrl()+"DMUControls/assets/icons/minimize.png";var g=a.minimize;var f=function(){h.setFullScreen(false)};this._domElements._topBarMinimizeButton=this._createUWATopButton(i,g,f);this._domElements._topBarMinimizeButton.setStyle("display","none");this._domElements._topBarMinimizeButton.inject(this._domElements._topbarButtonContainer);i=d.getWebappsBaseUrl()+"DMUControls/assets/icons/cancel.png";g=a.close;f=function(){h.setVisibility(false)};this._createUWATopButton(i,g,f).inject(this._domElements._topbarButtonContainer)},_createViewerContainer:function(){this._domElements._viewerContainer=this._createUWADiv({position:"relative",height:this._domElements._mainContainer.offsetHeight-this.options.fTopbarHeight,width:"100%",overflow:"hidden",paddingRight:this.options.fMarginAroundViewer+"px",paddingLeft:this.options.fMarginAroundViewer+"px",paddingBottom:this.options.fMarginAroundViewer+"px",});this._domElements._viewerContainer.inject(this._domElements._mainContainer)},_createViewer:function(){this._domElements._viewer=this._createUWADiv({position:"relative",height:"100%",width:"100%",overflow:"hidden",});this._domElements._viewer.inject(this._domElements._viewerContainer)},_manipulatorComputeChecker:function(k,h){var g={size:{width:null,height:null},position:{x:null,y:null}};if(h==="left"){var j=this._dragEventParameters.mainContainerOriginalSize.width-k.currentDelta.x;if(j<this.options.fResizeMinWidth){var m=this._domElements._mainContainer.getPosition().x;var l=this._domElements._mainContainer.getSize().width;var i=m+l;g.size.width=this.options.fResizeMinWidth;g.position.x=i-this.options.fResizeMinWidth}else{g.size.width=j;g.position.x=this._dragEventParameters.mainContainerOriginalPosition.x+k.currentDelta.x}}if(h==="right"){var j=this._dragEventParameters.mainContainerOriginalSize.width+k.currentDelta.x;if(j<this.options.fResizeMinWidth){g.size.width=this.options.fResizeMinWidth}else{g.size.width=j}}if(h==="bottom"){var f=this._dragEventParameters.mainContainerOriginalSize.height+k.currentDelta.y;if(f<this.options.fResizeMinHeight){g.size.height=this.options.fResizeMinHeight}else{g.size.height=f}}if(g.position.x<0){var l=this._dragEventParameters.mainContainerOriginalPosition.x+this._dragEventParameters.mainContainerOriginalSize.width;g.position.x=0;g.size.width=l}if(this._domElements._mainContainer.getPosition().x+g.size.width>this.options.body.parentElement.getSize().width){g.size.width=this.options.body.parentElement.getSize().width-this._domElements._mainContainer.getPosition().x}if(this._domElements._mainContainer.getPosition().y+g.size.height>this.options.body.parentElement.getSize().height){g.size.height=this.options.body.parentElement.getSize().height-this._domElements._mainContainer.getPosition().y}if(h==="drag"){g.position.x=this._dragEventParameters.mainContainerOriginalPosition.x+k.currentDelta.x;g.position.y=this._dragEventParameters.mainContainerOriginalPosition.y+k.currentDelta.y;if(g.position.x+this._domElements._mainContainer.getSize().width>this.options.body.parentElement.getSize().width){g.position.x=this.options.body.parentElement.getSize().width-this._domElements._mainContainer.getSize().width}if(g.position.y+this._domElements._mainContainer.getSize().height>this.options.body.parentElement.getSize().height){g.position.y=this.options.body.parentElement.getSize().height-this._domElements._mainContainer.getSize().height}if(g.position.x<0){g.position.x=0}if(g.position.y<0){g.position.y=0}}return g},_createSizeControl:function(){var i=this;this._domElements._sizeControlLeft=this._createUWADiv({position:"absolute",bottom:0,height:"100%",width:this.options.fManipulatorSize+"px",cursor:"ew-resize",overflow:"hidden",});this._domElements._sizeControlLeft.inject(this._domElements._mainContainer);var h=new b({element:this._domElements._sizeControlLeft,});h.start=function(){i._startDrag(this,i)};h.move=function(){var l=i._manipulatorComputeChecker(this,"left");i._domElements._mainContainer.setStyle("width",l.size.width+"px");i._domElements._mainContainer.setPosition({x:l.position.x,y:i._dragEventParameters.mainContainerOriginalPosition.y});if(i.isFullScreen()){i.setFullScreen(false,true)}};this._domElements._sizeControlRight=this._createUWADiv({position:"absolute",bottom:0,right:0,height:"100%",width:this.options.fManipulatorSize+"px",cursor:"ew-resize",overflow:"hidden",});this._domElements._sizeControlRight.inject(this._domElements._mainContainer);var k=new b({element:this._domElements._sizeControlRight,});k.start=function(){i._startDrag(this,i)};k.move=function(){var l=i._manipulatorComputeChecker(this,"right");i._domElements._mainContainer.setStyle("width",l.size.width+"px");if((i.isFullScreen())){i.setFullScreen(false,true)}};this._domElements._sizeControlBottom=this._createUWADiv({position:"absolute",left:0,bottom:0,height:this.options.fManipulatorSize+"px",width:"100%",cursor:"ns-resize",overflow:"hidden",});this._domElements._sizeControlBottom.inject(this._domElements._mainContainer);var g=new b({element:this._domElements._sizeControlBottom,});g.start=function(){i._startDrag(this,i)};g.move=function(){var l=i._manipulatorComputeChecker(this,"bottom");i._domElements._mainContainer.setStyle("height",l.size.height+"px");if(i.isFullScreen()){i.setFullScreen(false,true)}i._updateSize()};this._domElements._sizeControlBottomLeft=this._createUWADiv({position:"absolute",left:0,bottom:0,width:this.options.fManipulatorSize+"px",height:this.options.fManipulatorSize+"px",cursor:"nesw-resize",overflow:"hidden",});this._domElements._sizeControlBottomLeft.inject(this._domElements._mainContainer);var j=new b({element:this._domElements._sizeControlBottomLeft,});j.start=function(){i._startDrag(this,i)};j.move=function(){var l=i._manipulatorComputeChecker(this,"left");i._domElements._mainContainer.setStyle("width",l.size.width+"px");i._domElements._mainContainer.setPosition({x:l.position.x,y:i._dragEventParameters.mainContainerOriginalPosition.y});l=i._manipulatorComputeChecker(this,"bottom");i._domElements._mainContainer.setStyle("height",l.size.height+"px");if(i.isFullScreen()){i.setFullScreen(false,true)}i._updateSize()};this._domElements._sizeControlBottomRight=this._createUWADiv({position:"absolute",right:0,bottom:0,width:this.options.fManipulatorSize+"px",height:this.options.fManipulatorSize+"px",cursor:"nwse-resize",overflow:"hidden",});this._domElements._sizeControlBottomRight.inject(this._domElements._mainContainer);var f=new b({element:this._domElements._sizeControlBottomRight,});f.start=function(){i._startDrag(this,i)};f.move=function(){var l=i._manipulatorComputeChecker(this,"right");i._domElements._mainContainer.setStyle("width",l.size.width+"px");l=i._manipulatorComputeChecker(this,"bottom");i._domElements._mainContainer.setStyle("height",l.size.height+"px");if(i.isFullScreen()){i.setFullScreen(false,true)}i._updateSize()}},_updateSize:function(){this._domElements._viewerContainer.setStyle("height",this._domElements._mainContainer.offsetHeight-this.options.fTopbarHeight+"px")},_startDrag:function(g,f){f._dragEventParameters.mainContainerOriginalPosition=f._domElements._mainContainer.getPosition();f._dragEventParameters.mainContainerOriginalSize=f._domElements._mainContainer.getSize()}});return c});define("DS/DMUControls/panels/DMUSlidesPanel",["UWA/Core","UWA/Class","DS/Core/ModelEvents","DS/CATWebUXComponents/CATWebUXThumbnail","UWA/Controls/ThemedScroller","DS/WebappsUtils/WebappsUtils","DS/CATWebUXComponents/CATWebUXSectionHeader","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(d,a,b,h,g,c,i,e){var f=a.extend({init:function(x){this._parent(x);var l=[];var n;var v;var p,s;var q,m;var t=false;var o=true;var w=new b();this.buildPanel=function(A){this.cleanPanel();if(!n){n=d.createElement("div",{id:"DMUSlidePanelThumbMainDiv"})}n.setStyles({height:"100%"});var z=d.createElement("div",{"class":"DMUSlidePanelSectionMainDiv"}).inject(n);z.setStyles({"background-color":"rgba(255, 255, 255, 0)",height:"100%"});p=new i({fontIcon:"fonticon fonticon-viewBrowser",sectionLabel:A.panelTitle?A.panelTitle:e.dmuPanelTitle,cmdList:[{id:"DMUDeleteSlides",type:"button",nls:e.dmucontrolsdelete,icon:c.getWebappsAssetUrl("DMUControls","icons/22/")+"I_DMUDeleteSlides.png",cb:function(){j("onSlidesDeleted",{})}}],quickAccessBtnList:[{fontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-select-on",type:"checkbox",cb:function(){j("onCheckBoxesDisplayed",{})}}],doubleClickCB:function(){j("onPanelResized")}});z.appendChild(p.getContent());var y=40;if(A.displayNominal){q=d.createElement("div",{"class":"DMUSlidePanelNominalContainer"});z.appendChild(q);s=new i({sectionLabel:e.dmuSlidesSectionTitle,doubleClickCB:function(){j("onPanelResized")}});z.appendChild(s.getContent());y=215}m=d.createElement("div",{"class":"DMUSlidePanelThumbMainContainer"});v=new g().inject(z);v.getInnerElement().setContent(m);v.getContent().setStyle("height","calc(100% - "+y+"px)");o=typeof A.displayInWork==="boolean"?A.displayInWork:true;return n};this.cleanPanel=function(){if(!n){return}for(var y=0;y<l.length;y++){l[y].clear()}while(n.firstChild){n.removeChild(n.firstChild)}l.splice(0,l.length);if(p){p.clear()}if(s){s.clear()}if(v){v.destroy()}p=s=v=l=n=null};this.addSlide=function(y){p.closeContextualSectionHeader();var z=y.title?y.title:(y.category==="Nominal"?e.nominalSlideTitle:"");l.push(new h({id:y.id,width:154,height:118,title:z,preview:y.img,clickCB:r,onTitleEditedCB:u,checkFlagChangedCB:k,allowTitleEdition:y.titleEditionAllowed}));if((y.category==="Nominal"&&q)||y.category==="Slides"||(y.category==="InWork"&&o)){l[l.length-1].inject((y.category==="Nominal"&&q)?q:m)}l[l.length-1].getContent().categoryName=y.category==="Nominal"?"Nominal":"Slides";t=false;this.setCheckBoxeActiveFlag(t)};this.removeSlide=function(z){for(var y=0;y<l.length;y++){if(l[y].getThumbnailID()===z){m.removeChild(l[y].getContent());l[y].clear();l.splice(y,1);return}}};this.updateSlide=function(A,z){for(var y=0;y<l.length;y++){if(l[y].getThumbnailID()===A){if(z.name){l[y].setThumbnailTexts({title:z.name})}if(z.img){l[y].setPreview(z.img)}if(z.titleEditionAllowed!==undefined){l[y].allowTitleEdition(z.titleEditionAllowed)}return}}};this.setActiveSlide=function(z){p.closeContextualSectionHeader();if(!t){p.setCtxSectionHeaderDisableFlag("DMUDeleteSlides","NominalSlide"===z)}for(var y=0;y<l.length;y++){l[y].setDisplayFlag(l[y].getThumbnailID()===z)}};this.getSelectedTiles=function(){var z=[];for(var y=1;y<l.length;y++){if(l[y].isChecked()){z.push(l[y].getThumbnailID())}}return z};this.setCheckBoxeActiveFlag=function(y){p.closeContextualSectionHeader();t=y;if(l.length){p.setCtxSectionHeaderDisableFlag("DMUDeleteSlides",l[0].getDisplayFlag())}for(var z=1;z<l.length;z++){l[z].setIsCheckableFlag(t);l[z].setCheckFlag(l[z].getDisplayFlag(),null,true)}p.setAdditionalCheckBoxActiveFlag(0,t)};this.setSectionHeaderCommandsVisibleFlag=function(y){p.closeContextualSectionHeader();p.setAdditionalCommandsVisibility(y);p.setAdditionalCheckBoxActiveFlag(0,false)};var r=function(y){p.closeContextualSectionHeader();j("onSlideSelected",y)};var u=function(y){j("onSlideNameChanged",y)};var k=function(){var z=true;for(var y=1;y<l.length;y++){if(l[y].isChecked()){z=false;break}}p.setCtxSectionHeaderDisableFlag("DMUDeleteSlides",z)};this.subscribe=function(z,y){if(!z||!y){return}return w.subscribe({event:z},y)};this.unsubscribe=function(y){if(y===null||y===undefined){return}w.unsubscribe(y)};var j=function(z,y){return w.publish({event:z,data:y,context:this})}}});return f});define("DS/DMUControls/DMUWarningPanel",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,a,d,c,b){return a.extend({init:function(g){this._parent(g);if(!g||!g.frmWindow||!g.message){return}var f=e.createElement("div");e.createElement("span",{"class":"DMUWarningPanelIcon fonticon fonticon-attention fonticon-3x"}).inject(f);var j=e.createElement("p",{"class":"DMUWarningPanelLabel"}).inject(f);j.innerHTML=g.message;var i={Ok:new c({emphasize:"primary",touchMode:true,label:b.warningPanel.okLabel,onClick:function(){if(g.callbacks&&g.callbacks.onValidateCB){g.callbacks.onValidateCB()}h.close()}})};if(g.callbacks&&g.callbacks.onCancelCB){i.Cancel=new c({label:b.warningPanel.cancelLabel,touchMode:true,onClick:function(){g.callbacks.onCancelCB();h.close()}})}var h=new d({touchMode:true,modalFlag:true,ensureHeightDefinitionOnHierarchy:true,title:g.title?g.title:b.warningPanel.defaultTitle,content:f,immersiveFrame:g.frmWindow.getImmersiveFrame(),buttons:i});h.addEventListener("close",function(){if(g.callbacks&&g.callbacks.onCloseCB){g.callbacks.onCloseCB()}h=null});this.destroy=function(){if(h){h.close()}}}})});define("DS/DMUControls/DMU2DSheetManager",["UWA/Class","DS/Core/Events","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUControls/EXPNotify","DS/DMUControls/EXPNavBar","DS/SVGLoader/SVGNode","DS/Mesh/MeshUtils","i18n!DS/DMUControls/assets/nls/DMUControls"].concat(["DS/DibUDLWebLoader/DraftingUDLWebLoader"]),function(a,c,e,f,h,i,b,d,j){var g=a.extend({init:function(x){var B=this;var s=null,A=null;var w=null,m=null,t=false,p=null,v=null;var D,l;var z=new j();z.setMaxSheetInCache(4);var C=x.ctxViewer;var F=false;var u,E,y;var k;function o(I){if(w){for(var H=0;H<w.length;H++){if(w[H].sheetID===I){return w[H]}}}return undefined}function G(J){var H=o(J);if(H){var I=H.currentSheetViewpointInfo;if(I){e.moveViewpoint(C.getViewer(),I.position,null,I.sight,I.up,I.distance,0)}else{C.getViewer().currentViewpoint.reframe();H.currentSheetViewpointInfo=e.getViewpointInfo(C.getViewer().currentViewpoint)}}}function q(J){var I;if(F){for(I=0;I<w.length;I++){w[I].setVisibility(w[I].sheetID===J.sheetID);w[I].setVisibilityFree(w[I].sheetID!==J.sheetID)}if(J.updateViewpoint){G(J.sheetID)}if(J.callback){J.callback()}}else{var K;for(I=0;I<w.length;I++){if(w[I].sheetID===J.sheetID){K=w[I].modelID;break}}m.removeChildren();var H=z.getSheetBackgroundColor(K);C.getViewer().setBackgroundColor(H&&H.getHex?H.getHex():16777215);z.getSheet3DNode({sheetID:K,onSheetNodeCreated:function(L){m.addChild(L);u={activated:C.getViewer().picking.activated,primitive:C.getViewer().picking.primitive,trapSelectionMesh:C.getViewer().picking.trapSelectionMesh};E={activated:C.getViewer().pPicking.activated,primitive:C.getViewer().pPicking.primitive};C.getViewer().setPicking({activated:true,trapSelectionMesh:true});C.getViewer().setPrePicking({activated:true})},onSheetLoaded:function(){z.setSheetPickingByView({sheetID:K,pickingByView:true});if(J.updateViewpoint){G(J.sheetID)}if(J.callback){J.callback()}},onFailure:function(){}})}}function r(I,J){var H=o(I);if(H){H.currentSheetViewpointInfo=J}}function n(){if(s){s.clean()}if(w&&w.length){var H=[];for(var I=0;I<w.length;I++){H.push({id:w[I].sheetID,label:w[I].label})}A=A?A:H[0].id;if(H.length){s=new h({frameWindow:C.getFrameWindow(),tabs:H,onClickCB:function(J){A=J;q({sheetID:J,updateViewpoint:true});if(!t){c.publish({event:"/DMUCHANGE2DSHEET/"})}},activeTabIndex:A?A:H[0].id})}q({sheetID:A,updateViewpoint:true});if(p===undefined||p===null){p=c.subscribe({event:"/VISU/"},function(J){if(J.eventType==="@onViewpointEndMove"&&!t){r(A,e.getViewpointInfo(C.getViewer().currentViewpoint))}})}}}this.load2DDocument=function(H){if(!H||!C){return}if(!H.phyID){if(H.onFailure){H.onFailure()}return}if(!H.parentNode){if(H.onFailure){H.onFailure()}return}if(!H.onComplete){if(H.onFailure){H.onFailure()}return}if(!H.onFailure){return}if(H&&H.phyID===k){return}k=H.phyID;if(H.onLoadingStarted){H.onLoadingStarted()}C.getController().getAttributes({ids:[H.phyID],attributes:["svg"],callbacks:{onComplete:function(K){var J=function(){if(D){D.destroy()}D=new f({body:C.getFrameWindow().getUIFrame(),type:"error",messages:d.sheetNotSupported});H.onComplete()};var I=function(){if(K[H.phyID]&&K[H.phyID].svg&&K[H.phyID].svg!==""){F=true;var L=new XMLHttpRequest();L.onload=function(R){B.clean2DDocument();if(!v){v=new DOMParser()}var M=v.parseFromString(R.currentTarget.responseText,"image/svg+xml");var O=[];w=[];m=H.parentNode;if(!M){J();return}var S=[];if(M.documentElement&&M.documentElement.id){S=[M.documentElement]}else{if(M.documentElement&&M.documentElement.childNodes&&M.documentElement.childNodes.length&&M.documentElement.childNodes[0].id){S=M.documentElement.childNodes}}if(!S.length){J();return}if(!C.getViewer().get2DMode()){C.getViewer().set2DMode(true);l=C.getViewer().antiAliasing;C.getViewer().setAntiAliasing("MSAA")}var Q=S.length-1,P,N;for(N=S.length-1;N>=0;N--){if(!S[N].id){J();return}if(O.indexOf(S[N].id)!==-1){J();return}O.push(S[N].id)}for(N=S.length-1;N>=0;N--){P=new i(S[N],"Drw."+H.phyID+"_"+S[N].id,C.getViewer());P.sheetID="Drw."+H.phyID+"_"+S[N].id;P.label=S[N].textContent;P.setPickable(b.NODRAWHL);w.unshift(P);if((Q>0)&&(S[N].localName==="svg")){P.setVisibility(false)}Q--}for(N=0;N<w.length;N++){m.addChild(w[N])}C.getFrameWindow().getViewpoint().reframe();C.getViewer().render();n();H.onComplete()};L.open("GET",K[H.phyID].svg,true);L.send(null)}else{k=null;H.onFailure()}};if(K[H.phyID]&&K[H.phyID].UDL&&K[H.phyID].UDL!==""){B.clean2DDocument();z.loadModel({UDLObjURL:{provider:"FILE",filename:K[H.phyID].UDL,serverurl:"",proxyurl:"none",requiredAuth:null},onComplete:function(M){w=[];m=H.parentNode;if(!M.sheetIDList||!M.sheetIDList.length){J();return}if(!C.getViewer().get2DMode()){C.getViewer().set2DMode(true);l=C.getViewer().antiAliasing;C.getViewer().setAntiAliasing("MSAA")}for(var L=0;L<M.sheetIDList.length;L++){w.push({modelID:M.sheetIDList[L],sheetID:"Drw."+H.phyID+"_"+M.sheetIDList[L],label:z.getSheetName(M.sheetIDList[L])})}y=C.getViewer().getVisuEnv();C.getViewer().setVisuEnv("None");B.setCurrentSheet({sheetID:w[0].sheetID,callback:function(){n();H.onComplete()}})},onFailure:function(){I(H)}})}else{I(H)}},onFailure:function(){k=null;H.onFailure()}}})};this.clean2DDocument=function(){if(!C){return}if(m){m.removeChildren()}C.getViewer().render();if(u){C.getViewer().setPicking({primitive:u.primitive,trapSelectionMesh:u.trapSelectionMesh,activated:u.activated})}if(E){C.getViewer().setPrePicking({primitive:E.primitive,activated:E.activated})}if(y){C.getViewer().setVisuEnv(y)}if(C.getViewer().get2DMode()){if(l&&C.getViewer().antiAliasing!==l){C.getViewer().setAntiAliasing(l)}C.getViewer().set2DMode(false)}if(s){s.clean()}if(p){c.unsubscribe(p)}s=A=p=w=l=m=u=E=y=k=null};this.isADocumentDisplayed=function(){return w&&w.length>0};this.setNavBarVisibleFlag=function(H){if(s){s.setVisibleFlag(H)}};this.getNavBarVisibleFlag=function(){if(s){return s.getVisibleFlag()}return undefined};this.unInitialize=function(){B.clean2DDocument();if(D){D.destroy()}D=v=z=C=null};this.setCurrentSheet=function(J){if(!C){return}var I=J&&J.sheetID?J.sheetID:(w&&w.length?w[0].sheetID:null);if(I&&A!==I){if(D){D.destroy()}var H=o(I);if(H){A=I;q({sheetID:I,updateViewpoint:false,callback:J.callback});if(s){s.setActiveNarBarItem(A)}}else{D=new f({body:C.getFrameWindow().getUIFrame(),type:"error",messages:d.sheetNotExistWarning});if(J.cbOnSheetNotFound){J.cbOnSheetNotFound()}}}};this.getCurrentSheet=function(){return A};this.setReviewPlayMode=function(H){t=H};this.getReviewPlayMode=function(){return t}}});return g});define("DS/DMUControls/EXPWindowWithBar",["DS/DMUControls/EXPWindow","WebappsUtils/WebappsUtils"],function(b,a){var c=b.extend({defaultOptions:{fLeftPanelSize:40},init:function(e){var d=UWA.extend(this.defaultOptions,e);this._parent(d);this._createBar()},addButton:function(f){var d=this;var e=UWA.createElement("div",{"class":f.className,title:f.nls,styles:{position:"relative",background:"rgba(255,255,255,0.5)",opacity:"1",borderRadius:"50%",left:this.options.fMarginAroundViewer,height:"30px",width:"30px",marginTop:"7px",marginBottom:"7px",cursor:"pointer",lineHeight:"25px",textAlign:"center",border:"1px solid #727476"},events:{click:function(){f.callback(d)}}}).inject(this._domElements._actionButtonContainer);this._buildButtonIcon(f.url).inject(e)},setFullScreen:function(e,d){this._parent(e,d);if(e){this._domElements._leftPanelMainContainer.setStyle("left",0);this._domElements._actionButtonContainer.setStyles({width:"130%",borderBottomRightRadius:"2pc",borderTopRightRadius:"2pc",})}else{this._domElements._leftPanelMainContainer.setStyle("left",-this.options.fLeftPanelSize+"px");this._domElements._actionButtonContainer.setStyles({width:"100%",borderBottomRightRadius:"0",borderTopRightRadius:"0",})}},_createBar:function(){this._createLeftButtonArrowOpenPanel();this._createLeftButtonsCommandPanel();this._createLeftPanelContainer();this._createLeftButtonArrowClosePanel();this._createLeftActionButtonContainer()},_createLeftButtonArrowOpenPanel:function(){var e=this;var d=a.getWebappsBaseUrl()+"DMUControls/assets/icons/expanderBigLeftArrow.png";this._domElements._leftPanelArrow=this._createUWADiv({position:"absolute",left:0,top:"50%",height:"20px",width:"20px",overflow:"hidden",backgroundImage:"url("+d+")",backgroundSize:"contain",backgroundRepeat:"no-repeat",cursor:"pointer"});this._domElements._leftPanelArrow.addEvent("click",function(f){e._domElements._leftPanelArrow.setStyle("display","none");e._domElements._leftPanelMainContainer.setStyle("display","block");UWA.Event.stop(f)});this._domElements._leftPanelArrow.inject(this._domElements._mainContainer)},_createLeftButtonsCommandPanel:function(){this._domElements._leftPanelMainContainer=this._createUWADiv({position:"absolute",left:-this.options.fLeftPanelSize+"px",top:0,height:"100%",width:this.options.fLeftPanelSize+"px",overflow:"visible",paddingTop:this.options.fTopbarHeight+"px",lineHeight:this._domElements._mainContainer.getSize().height-this.options.fTopbarHeight+"px",textAlign:"center",display:"none"});this._domElements._leftPanelMainContainer.inject(this._domElements._mainContainer)},_createLeftPanelContainer:function(){this._domElements._leftPanelContainer=this._createUWADiv({height:"auto",width:"100%",overflow:"visible",display:"inline-block",verticalAlign:"middle",lineHeight:"normal",});this._domElements._leftPanelContainer.inject(this._domElements._leftPanelMainContainer)},_createLeftButtonArrowClosePanel:function(){var e=this;var d=a.getWebappsBaseUrl()+"DMUControls/assets/icons/expanderBigRightArrow.png";this._domElements._leftPanelCloseArrow=this._createUWADiv({height:"20px",width:"100%",overflow:"hidden",backgroundImage:"url("+d+")",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center center",cursor:"pointer",position:"relative",right:-this.options.fMarginAroundViewer/2});this._domElements._leftPanelCloseArrow.addEvent("click",function(f){e._domElements._leftPanelArrow.setStyle("display","block");e._domElements._leftPanelMainContainer.setStyle("display","none");UWA.Event.stop(f)});this._domElements._leftPanelCloseArrow.inject(this._domElements._leftPanelContainer)},_createLeftActionButtonContainer:function(){this._domElements._actionButtonContainer=this._createUWADiv({height:"auto",width:"100%",backgroundColor:"#F0F0F0",overflow:"visible",borderTop:"1px solid #D1D1D1",borderBottom:"1px solid #D1D1D1",borderLeft:"1px solid #D1D1D1",borderTopLeftRadius:this.options.fCornerRoundRadius+"px",borderBottomLeftRadius:this.options.fCornerRoundRadius+"px",paddingTop:"10px",paddingBottom:"10px"});this._domElements._actionButtonContainer.inject(this._domElements._leftPanelContainer)},_buildButtonIcon:function(e){var d=new UWA.Controls.Img({url:e});d.elements.container.setStyles({height:"75%",width:"75%",display:"inline-block",verticalAlign:"middle",lineHeight:"normal",});return d},_updateSize:function(){this._domElements._leftPanelMainContainer.setStyle("lineHeight",this._domElements._mainContainer.getSize().height-this.options.fTopbarHeight+"px");this._parent()},});return c});define("DS/DMUControls/EXPSecondaryViewer",["DS/DMUControls/EXPWindowWithBar","DS/WebappsUtils/WebappsUtils","DS/Visualization/WebGLV6Viewer","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,c,d,a){var b=e.extend({init:function(f){this.options=f;this._addViewer();this._parent(f);this._addDefaultButtons()},_addDefaultButtons:function(){var h=c.getWebappsAssetUrl("DMUBaseCommands","icons/32/");var g=[{className:"secondaryViewerPrintCmd",nls:a.print,url:h+"I_3DSHAREPROPrint.png",callback:function(i){i._printScreenshot(true)}},{className:"secondaryViewerReframeCmd",nls:a.reframe,url:h+"I_3DSHAREPROReframe.png",callback:function(i){i.options.viewer.currentViewpoint.reframe()}}];for(var f=0;f<g.length;f++){this.addButton(g[f])}},_addViewer:function(){var g=new UWA.Element("div").inject(this.options.body,"top");g.setStyle("visibility","visible");var f={div:g,antiAliasing:true,useShadowMap:false,infinitePlane:false,displayGrid:false,ssao:false,debugShadowLight:false,debugBSphere:false,debugBBox:false,multiViewer:true};this._viewerSecondary=new d(f);this._viewerSecondary.setPrePicking({activated:true,displayHL:true,gpu:true,computeNormalDepth:false,primitive:false});this.options.viewer=this._viewerSecondary;this.options.HTMLContent=g},_printScreenshot:function(){var i=this;var h=this.options.viewer;if(h.print){h.print()}else{this._iframe=new UWA.Element("iframe",{styles:{position:"fixed",top:"0",left:"-150%",width:"100%",height:"100%"}}).inject(document.body);var g=new UWA.Element("img",{src:this._getScreenShot(),styles:{"max-width":"100%","max-height":"100%"}}).inject(this._iframe.contentWindow.document.body);if(window.navigator.userAgent.indexOf("Firefox")>-1){this._doPrint()}else{var f;var i=this;f=setInterval(function(){if(g.offsetHeight){clearInterval(f);try{if(false===i._iframe.contentWindow.document.execCommand("print",false,null)){i._iframe.contentWindow.print()}}catch(j){i._iframe.contentWindow.print()}setTimeout(function(){document.body.removeChild(i._iframe)},60000)}},100)}}},_doPrint:function(){var f=this._iframe.contentWindow.document.body.innerHTML;var g=window.open("","popup","width=750,height=800,toolbar = no, status = no,resizable =no,location=no");g.document.write(f);g.document.close();g.focus();g.print();g.close();document.body.removeChild(this._iframe);this._iframe=null},_getScreenShot:function(x,u){var f=this.options.viewer;if(f.save){f.save()}var r=f.currentViewpoint;var z={data:null,width:f.SCREEN_WIDTH,height:f.SCREEN_HEIGHT};var k=document.createElement("canvas");k.width=x?x:z.width;k.height=u?u:z.height;r.getControl().update();f.renderToTarget(z,r);var y=k.getContext("2d");var v=y.getImageData(0,0,k.width,k.height);if(v.width!==k.width){console.error("error");return undefined}if(v.height!==k.height){console.error("error");return undefined}var g=(z.width-1)/(v.width-1);var q=(z.height-1)/(v.height-1);var o=z.data;var E=v.data;var D=function(H,G,F,I,J){if(J){G=I-G;return F*Math.floor(G-1)+Math.floor(H)}return F*Math.floor(G)+Math.floor(H)};if(g===1&&q===1){var C=v.height;var p=v.width;var n=4*p;for(var A=0;A<C;A++){var m=4*(A*p);var t=4*((C-A)*p);for(var B=n;B>0;B--){E[m+B]=o[t+B]}}}else{var s=v.height;var l=v.width;for(var A=0;A<s;A++){for(var B=0;B<l;B++){var m=4*D(B,A,v.width,v.height,false);var t=4*D(B,A,z.width,z.height,true);E[m]=o[t];E[m+1]=o[t+1];E[m+2]=o[t+2];E[m+3]=o[t+3]}}}y.putImageData(v,0,0,0,0,k.width,k.height);return(k.toDataURL("image/png"))},});return b});