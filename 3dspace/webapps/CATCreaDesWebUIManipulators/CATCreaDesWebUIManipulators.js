define("DS/CATCreaDesWebUIManipulators/CATCrDWebEventsRouter",["UWA/Core","DS/Core/Events","DS/VisuEvents/EventsManager"],function(f,c,e){function b(){var t=this;var k=[];var j=[];var v=false;var p=0;var m;var l;var u;var h;var r;var i=function(G,H){k.sort(function(L,K){var N=L.getPriority();var M=K.getPriority();return M-N});var A;var I=u.pick(H,"rep",true);if(0!==I.path.length&&false!==UWA.typeOf(I.position)){var B=I.position.clone();var J=I.path;if(J[0]!==undefined){var C=J[0].getLength();var z=1;for(z=0;z<C;z++){var y=J[0].getElement(z);if(false!==UWA.typeOf(y)){var x=y.name;var E=0;for(E=0;E<k.length;E++){var F=k[E];if(false!==UWA.typeOf(F)){if(x===F._name&&true===F.isListeningToEvent(G)){A=F;break}}}if(false!==UWA.typeOf(A)){break}}}}}var E=0;var w;if(false!==UWA.typeOf(A)){w=A}else{if(k.length>0){var D=k[k.length-1];if(0===D.getPriority()&&true===D.isListeningToEvent(G)){w=D}}}return w};var s=function(w,y,x){if(false!==UWA.typeOf(w)){w.dispatchEvent(x,y)}};var g=function(x){UWA.Event.stop(x);v=true;var y=new THREEDS.Core.Vector2(0,0);var w=x.gesture.getEvents();y=u.getMousePosition(w[0].lastPosition);r=i("CATCrDWeb:beginManipulate",y);if(false!==UWA.typeOf(r)){h.setControlActive(false);s(r,y,"CATCrDWeb:beginManipulate")}else{v=false}};var q=function(x){UWA.Event.stop(x);var y=new THREEDS.Core.Vector2(0,0);var w=x.gesture.getEvents();y=u.getMousePosition(w[0].lastPosition);if(true==v){v=false;if(false!==UWA.typeOf(r)){s(r,y,"CATCrDWeb:endManipulate")}}r=null;h.setControlActive(true)};var o=function(x){UWA.Event.stop(x);var y=new THREEDS.Core.Vector2(0,0);var w=x.gesture.getEvents();y=u.getMousePosition(w[0].lastPosition);if(true==v){if(false!==UWA.typeOf(r)){s(r,y,"CATCrDWeb:manipulate")}}else{r=i("CATCrDWeb:move",y);if(false!==UWA.typeOf(r)){s(r,y,"CATCrDWeb:move")}}};var n=function(x){UWA.Event.stop(x);var z=new THREEDS.Core.Vector2(0,0);var w=x.gesture.getEvents();z=u.getMousePosition(w[0].lastPosition);var y=i("CATCrDWeb:dblClick",z);if(false!==UWA.typeOf(y)){s(y,z,"CATCrDWeb:dblClick")}};t.setFrmWindow=function(w){m=w;l=m.getViewpoint().canvas;u=m._3dViewer;h=m.getViewpoint()};t.getViewpoint=function(){return h};t.getViewer=function(){return u};t.appendManipulator=function(w){if(0===k.length){if(false!==UWA.typeOf(u)){e.addEvent(u.canvas,"onLeftMouseDown",g);e.addEvent(u.canvas,"onLeftMouseUp",q);e.addEvent(u.canvas,"onLeftDoubleClick",n);e.addEvent(u.canvas,"onMouseMove",o);e.addEvent(u.canvas,"onTouch",g);e.addEvent(u.canvas,"onSwipe",o);e.addEvent(u.canvas,"onRelease",q);e.addEvent(u.canvas,"onDoubleTap",n)}}p++;w.setId(p);k.push(w);return p};t.removeManipulator=function(w){var x=0;var y=false;for(x=0;x<k.length;x++){if(k[x]===w){y=true;break}}if(true===y){k.splice(x,1)}if(0===k.length){e.removeEvent(u.canvas,"onLeftMouseDown",g);e.removeEvent(u.canvas,"onLeftMouseUp",q);e.removeEvent(u.canvas,"onLeftDoubleClick",n);e.removeEvent(u.canvas,"onMouseMove",o);e.removeEvent(u.canvas,"onTouch",g);e.removeEvent(u.canvas,"onSwipe",o);e.removeEvent(u.canvas,"onRelease",q);e.removeEvent(u.canvas,"onDoubleTap",n)}};t.activateManip=function(A){var w;if(undefined!==A){var x=j.length;var z=0;for(z=0;z<x&&w===undefined;z++){var y=j[0];if(A===y.getId()){if(0===k.length){if(false!==UWA.typeOf(u)){e.addEvent(u.canvas,"onLeftMouseDown",g);e.addEvent(u.canvas,"onLeftMouseUp",q);e.addEvent(u.canvas,"onLeftDoubleClick",n);e.addEvent(u.canvas,"onMouseMove",o);e.addEvent(u.canvas,"onTouch",g);e.addEvent(u.canvas,"onSwipe",o);e.addEvent(u.canvas,"onRelease",q);e.addEvent(u.canvas,"onDoubleTap",n)}}k.push(y);j.splice(z,1);w=y}}}else{if(j.length>0){var y=j[0];j.splice(0,1);this.appendManipulator(y);y.activate();w=y}}return w};t.deactivateManip=function(w){if(w!==undefined){j.push(w);this.removeManipulator(w)}};t.getManip=function(z){var w=0;var y;for(w=0;w<j.length;w++){var x=j[w];if(x.getId()===z){y=x}}for(w=0;w<k.length;w++){var x=k[w];if(x.getId()===z){y=x}}return y}}var d;function a(){if(false===UWA.typeOf(d)){d=new b()}return d}return UWA.namespace("DS/CATCreaDesWebUIManipulators/CATCrDWebEventsRouter",a)});define("DS/CATCreaDesWebUIManipulators/CATCrDWebManipulatorBase",["UWA/Core","DS/Core/Events"],function(b,a){function c(f,i){var e=[];var h=-1;this._name=f;var g=-1;var d=f+":CATCrDWeb:ManipBeginManipulate";this.beginManipulateEvent=new CustomEvent("CATCrDWeb:ManipBeginManipulate",{detail:{source:this},bubbles:false,cancelable:false});var d=f+":CATCrDWeb:ManipManipulate";this.manipulateEvent=new CustomEvent("CATCrDWeb:ManipManipulate",{detail:{source:this},bubbles:false,cancelable:false});var d=f+":CATCrDWeb:ManipEndManipulate";this.endManipulateEvent=new CustomEvent("CATCrDWeb:ManipEndManipulate",{detail:{source:this},bubbles:false,cancelable:false});this.setPriority=function(j){h=j};this.getPriority=function(){return h};this.setId=function(j){g=j};this.getId=function(){return g};this.appendEvent=function(j){e.push(j)};this.cleanEvents=function(j){e.length=0};this.isListeningToEvent=function(m){var k=0;var j=false;if(false!==UWA.typeOf(m)){for(k=0;k<e.length;k++){var l=e[k];if(false!==UWA.typeOf(l)&&l===m){j=true;break}}}return j};this._webGLV6Viewer=i;this.dispatchEvent=function(j,k){switch(j){case"CATCrDWeb:beginManipulate":this.beginManipulate(k);break;case"CATCrDWeb:manipulate":this.manipulate(k);break;case"CATCrDWeb:endManipulate":this.endManipulate(k);break;case"CATCrDWeb:dblClick":this.edit(k);break;case"CATCrDWeb:move":this.move(k);break}}}c.prototype.beginManipulate=function(e){var d=this;a.publish({event:"CATCrDWeb:ManipBeginManipulate",data:d})},c.prototype.manipulate=function(e){var d=this;a.publish({event:"CATCrDWeb:ManipManipulate",data:d})},c.prototype.endManipulate=function(e){var d=this;a.publish({event:"CATCrDWeb:ManipEndManipulate",data:d})},c.prototype.move=function(e){var d=this;a.publish({event:"CATCrDWeb:Move",data:d})},c.prototype.edit=function(d){};return UWA.namespace("DS/CATCreaDesWebUIManipulators/CATCrDWebManipulatorBase",c)});define("DS/CATCreaDesWebUIManipulators/CATCrDWebPencilManipulator",["UWA/Core","DS/Core/Events","DS/CATCreaDesWebUIManipulators/CATCrDWebEventsRouter","DS/CATCreaDesWebUIManipulators/CATCrDWebManipulatorBase","DS/CATCreaDesWebUIServices/CATCrDSettings","DS/CATCreaDesWebUIServices/CATCrDWebUIServices","DS/CATCreaDesWebUIServices/CATCrDStrokeInterpreter","DS/CATCreaDesWebUIServices/CATCrDCircle","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS"],function(h,c,e,a,d,b,i,g,f,j){function k(l,w){var F=this;var p=w._3dViewer;a.call(F,l,p);var P;var L=0;var n=0;var r;var N=false;var E;var I;var u;var z;var D;var G;var y;var J;var C=false;var t;var Q;var H=false;var o;var x;var O;var A;var K;var s;F.setPriority(0);F.appendEvent("CATCrDWeb:beginManipulate");F.appendEvent("CATCrDWeb:manipulate");F.appendEvent("CATCrDWeb:endManipulate");var m=new e();if(false!==UWA.typeOf(m)){m.appendManipulator(F)}var M=new d();P=M.getSettingsColor();L=M.getSettingsPencilOpacity();n=M.getSettingsPencilThickness();C=M.getSymmetryMode();t=M.getSettingsSymmetryPlane();Q=M.getSettingsSymmetryPlanePosition();H=M.getPrimitivesMode();N=-1;E=[];I=[];u=[];z=[];r=M.getSettingsDrawingPlane();D=new f("pencilPreviewNode");G;J=b.createPencilMaterial(P,L);o=c.subscribe({event:"/CATCrD_Thickness_Changed/"},function(R){n=M.getSettingsPencilThickness()});x=c.subscribe({event:"/CATCrD_Opacity_Changed/"},function(R){L=M.getSettingsPencilOpacity();J.uniforms.Opacity.value=L;UWA.log("opacity : "+L)});O=c.subscribe({event:"/CATCrD_Color_Changed/"},function(R){P=M.getSettingsColor();J.uniforms.Color.value=P});A=c.subscribe({event:"/CATCrD_Primitives_Changed/"},function(R){H=M.getPrimitivesMode()});K=c.subscribe({event:"/CATCrD_Symmetry_Changed/"},function(R){C=M.getSymmetryMode()});s=c.subscribe({event:"/CATCrD_SymmetryPlane_Changed/"},function(R){t=M.getSettingsSymmetryPlane();Q=M.getSettingsSymmetryPlanePosition()});var q=F._webGLV6Viewer.getRootNode();q.add(D);F.clean=function(){var R=new e();if(false!==UWA.typeOf(R)){R.removeManipulator(F)}F.cleanEvents();q.remove(D);c.unsubscribe(o);c.unsubscribe(x);c.unsubscribe(O);c.unsubscribe(A);c.unsubscribe(K);c.unsubscribe(s)};F.getPoints=function(){return E};F.getNormals=function(){return I};F.getPointsSym=function(){return z};var v=function(){if(E.length>1){G=b.createPencilGP(E,I,n,J);D.add(G);F._webGLV6Viewer.render()}if(true==C){if(z.length>1){y=b.createPencilGP(z,I,n,J);D.add(y);F._webGLV6Viewer.render()}}};var B=function(){if(false!==UWA.typeOf(G)){D.remove(G);G=null}if(false!==UWA.typeOf(y)){D.remove(y);y=null}};F.beginManipulate=function(R){a.prototype.beginManipulate.call(F,R);E.length=0;I.length=0;u.length=0;z.length=0};F.manipulate=function(Y){a.prototype.manipulate.call(F,Y);var T=F._webGLV6Viewer.getRootNode();B();var X;var V;var aa=F._webGLV6Viewer.pick(Y,"mesh",true);var ab=aa.path;if(-1===N){N=0;if(0!==ab.length){N=1}else{var S=T.getChildByName("LoadedCGR");while(false!==UWA.typeOf(S)){S.name="LoadedCGRNoPick";var W=S.children[0].children[0];W.setPickable(CATXMLV6.NOPICKABLE);S=T.getChildByName("LoadedCGR")}}}if(0===ab.length&&0===N){X=aa.ray.intersectPlane(r);V=r.normal.clone()}else{if(0!==ab.length&&false!==UWA.typeOf(aa.normal)&&1===N){X=aa.position.clone();V=aa.normal.clone()}}if(false!==UWA.typeOf(X)&&((E.length<1)||(X.distanceToSquared(E[E.length-1])>(0.15*0.15*n*n)))){E.push(X);I.push(V);u.push(Y);if(true==C&&false!==UWA.typeOf(t)){var Z=X.clone().sub(Q);var U=Z.clone().projectOnPlane(t.normal);var R=U.sub(Z).multiplyScalar(2);Z.add(R);Z.add(Q);z.push(Z)}}v()};F.endManipulate=function(am){var Y=F._webGLV6Viewer.getRootNode();B();if(N==0){var ab=Y.getChildByName("LoadedCGRNoPick");while(false!==UWA.typeOf(ab)){ab.name="LoadedCGR";var R=ab.children[0].children[0];R.setPickable(CATXMLV6.PICKABLE);ab=Y.getChildByName("LoadedCGRNoPick")}}N=-1;if(true===H){if(E.length>=2){var X;var U;var V=new i();var af=V.GetResultShape(u);if(af==1){X=[];U=[];X.push(new j.Vector3().copy(E[0]));X.push(new j.Vector3().copy(E[E.length-1]));U.push(new j.Vector3().copy(I[0]));U.push(new j.Vector3().copy(I[I.length-1]));E=X}else{if(af==2){var Z=new g();Z.calculateFromPoints(E,r);var W=j.Math.degToRad(5);var ad=Math.floor((2*Math.PI/W)+0.5);var aa=0;var T=2*Math.PI;var aj=0.001;var ae=0;var ah=2*Math.PI;var ad;var ag=Z.getParam(Z._FirstLimit,aj,ae,ah);if(0!=ag[0]){aa=ag[1];ag=Z.getParam(Z._SecondLimit,aj,ae,ah);if(0!=ag[0]){T=ag[ag[0]]}if(T>aa){ad=Math.floor(((T-aa)/W)+0.5);if(20>ad){ad=20;W=Math.floor(((T-aa)/(ad+1))+0.5)}}else{ad=Math.floor(((2*Math.PI-aa)/W)+0.5);ad+=Math.floor((T/W)+0.5);ad-=1;if(20>ad){ad=20;W=Math.floor((((2*Math.PI-aa)+T)/(ad+1))+0.5)}}}X=new Array;U=new Array;for(var al=0;al<ad;al++){X.push(new j.Vector3().copy(Z.evaluate(aa)));U.push(r.normal);aa+=W}X.push(new j.Vector3().copy(Z.evaluate(T)));U.push(r.normal);E=X;I=U}}if(af!=-1&&true==C){var ai;var S;var ac;z.length=0;for(var ak=0;ak<E.length;ak++){ai=E[ak].clone().sub(Q);S=ai.clone().projectOnPlane(t.normal);ac=S.sub(ai).multiplyScalar(2);ai.add(ac);ai.add(Q);z.push(ai)}}}}a.prototype.endManipulate.call(F,am)}}k.prototype=new a();return UWA.namespace("DS/CATCreaDesWebUIManipulators/CATCrDWebPencilManipulator",k)});"use strict";define("DS/CATCreaDesWebUIManipulators/CATCrDWebPlaneManipulator",["UWA/Core","DS/Mesh/MeshUtils","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/CATCreaDesWebUIServices/CATCrDShaders","DS/CATCreaDesWebUIManipulators/CATCrDWebEventsRouter","DS/CATCreaDesWebUIManipulators/CATCrDWebManipulatorBase","DS/CATCreaDesWebUIServices/CATCrDWebUIServices","DS/CATCreaDesWebUIServices/CATCrDWebMathServices","DS/CATCreaDesWebUIServices/CATCrDGrid"].concat(window.dependencies),function(f,h,l,k,i,j,g,c,b,e,d){function a(m,w,y,A){var L=this;var p=A._3dViewer;c.call(L,m,p);var u=p;var I=new l.Vector3(0,0,0);var S=new l.Vector3(1,0,0);var C=new l.Vector3(0,1,0);var E=new l.Vector3(0,0,1);var K=50;var M=false;var D=-1;var B=new THREEDS.Core.Vector2(0,0);var s=u.getViewpoints()[0].getCamera();var r=y.clone();var K=b.convertPixelsLengthToMm(s,r,Math.min(window.innerHeight*0.25,window.innerWidth*0.25));var o=K*0.5;var P;var z;L.getNormal=function(){return E};L.getPosition=function(){return I};L.setVisibility=function(V){M=V;z.setVisibility(M);H(V);u.render()};var H=function(V){if(true==V){P.setPickable(h.PICKABLE)}else{P.setPickable(h.NOPICKABLE)}};var t=function(X){var Y=E.angleTo(X);if((Math.abs(Y)>0.001)&&(Math.abs(Math.PI-Y)>0.001)){var W=E.cross(X);var V=new l.Matrix4();W.normalize();V.makeRotationAxis(W,Y);z.applyMatrix(V);S.applyMatrix4(V);C.applyMatrix4(V);S.normalize();C.normalize();E=X.clone();I.applyMatrix4(V)}};var G=function(V){I=V.clone();V.x=V.x-K*0.5*(S.x+C.x);V.y=V.y-K*0.5*(S.y+C.y);V.z=V.z-K*0.5*(S.z+C.z);z.getMatrix().setPosition(V);z._updateMatrix()};var U=function(){var ak=new l.Vector3(1,0,0);var ag=new l.Vector3(0,1,0);var ac=new l.Vector3(0,0,1);var W=S.angleTo(ak);var aj=S.angleTo(ag);var aa=S.angleTo(ac);var ad=C.angleTo(ak);var V=C.angleTo(ag);var ae=C.angleTo(ac);var Z=Math.min(Math.abs(W),Math.abs(aj),Math.abs(aa),Math.abs(ad),Math.abs(V),Math.abs(ae));if(Z>0.001){var ah=new l.Vector3();if(Z==W){ah.crossVectors(ak,S);if(ah.dot(E)<0){Z=-1*Z}}else{if(Z==aj){ah.crossVectors(ag,S);if(ag.dot(E)<0){Z=-1*Z}}else{if(Z==aa){ah.crossVectors(ac,S);if(ah.dot(E)<0){Z=-1*Z}}else{if(Z==ad){ah.crossVectors(ak,C);if(ah.dot(E)<0){Z=-1*Z}}else{if(Z==V){ah.crossVectors(ag,C);if(ah.dot(E)<0){Z=-1*Z}}else{if(Z==ae){ah.crossVectors(ac,C);if(ah.dot(E)<0){Z=-1*Z}}}}}}}var ai=I.clone();var Y=E.clone();var ab=new l.Matrix4().makeTranslation(-ai.x,-ai.y,-ai.z);var X=new l.Matrix4().makeTranslation(ai.x,ai.y,ai.z);var af=new l.Matrix4();Y.normalize();af.makeRotationAxis(Y,-Z);z.applyMatrix(ab);z.applyMatrix(af);S.applyMatrix4(af);C.applyMatrix4(af);z.applyMatrix(X);S.normalize();C.normalize();E.crossVectors(S,C);E.normalize()}};var H=function(V){if(true==V){P.setPickable(h.PICKABLE)}else{P.setPickable(h.NOPICKABLE)}};var J=function(X){var W=L._webGLV6Viewer.getRootNode();if(f.typeOf(X)!=false){K=X}P=k.createRectangleNode({width:K,height:K,fill:true,color:16711680});P.name=L._name;P.setPickable(h.PICKABLE);z=new i();z.add(P);var V=new l.Vector3();V.x=I.x-K*0.5*(S.x+C.x);V.y=I.y-K*0.5*(S.y+C.y);V.z=I.z-K*0.5*(S.z+C.z);z.getMatrix().setPosition(V);z._updateMatrix();var Y=new l.Color();z.material=new l.MeshBasicMaterial({color:11513775});z.material.line=new l.LineBasicMaterial({color:0,linewidth:1,opacity:1});z.material.side=l.DoubleSide;z.material.depthWrite=false;z.material.opacity=0.1;z.material.transparent=true;z.material.force=true;W.add(z);S.normalize();C.normalize();E.crossVectors(S,C);E.normalize();u.render()};var N=function(V){var X=V.distanceToSquared(I);var W;if(X<K){W=5}else{W=R(V)}return W};var R=function(ak){var Y=200;var ai=201;var ah=-1;var ab=new l.Vector3();ab.x=I.x-K*0.5*(S.x-C.x);ab.y=I.y-K*0.5*(S.y-C.y);ab.z=I.z-K*0.5*(S.z-C.z);var aa=new l.Vector3();aa.x=I.x+K*0.5*(S.x+C.x);aa.y=I.y+K*0.5*(S.y+C.y);aa.z=I.z+K*0.5*(S.z+C.z);var X=new l.Vector3();X.x=I.x+K*0.5*(S.x-C.x);X.y=I.y+K*0.5*(S.y-C.y);X.z=I.z+K*0.5*(S.z-C.z);var V=new l.Vector3();V.x=I.x-K*0.5*(S.x+C.x);V.y=I.y-K*0.5*(S.y+C.y);V.z=I.z-K*0.5*(S.z+C.z);var af=new l.Vector3();af.subVectors(aa,ab);var Z=new l.Vector3();Z.subVectors(X,aa);var aj=new l.Vector3();aj.subVectors(V,X);var ae=new l.Vector3();ae.subVectors(ab,V);var ag=new l.Vector3();ag.subVectors(ak,ab);var ac=new l.Vector3();ac.subVectors(ak,aa);var W=ag.dot(ac);if(W<0&&ag.length()<Y&&ac.length()<Y){return 1}var ac=new l.Vector3();ac.subVectors(ak,aa);var al=new l.Vector3();al.subVectors(ak,X);W=ac.dot(al);if(W<0&&ac.length()<Y&&al.length()<Y){return 2}var al=new l.Vector3();al.subVectors(ak,X);var ad=new l.Vector3();ad.subVectors(ak,V);W=al.dot(ad);if(W<0&&al.length()<Y&&ad.length()<Y){return 3}var ag=new l.Vector3();ag.subVectors(ak,ab);var ad=new l.Vector3();ad.subVectors(ak,V);W=ag.dot(ad);if(W<0&&ag.length()<Y&&ad.length()<Y){return 4}return ah};var F=function(W,Y){var V=new l.Vector3(W.x-Y.x,W.y-Y.y,W.z-Y.z);var Z=V.dot(E);V.x=Z*E.x;V.y=Z*E.y;V.z=Z*E.z;V.normalize();var X=new l.Matrix4();X.makeTranslation(Math.abs(Z)*V.x,Math.abs(Z)*V.y,Math.abs(Z)*V.z);z.applyMatrix(X);u.render();I.x=I.x+Math.abs(Z)*V.x;I.y=I.y+Math.abs(Z)*V.y;I.z=I.z+Math.abs(Z)*V.z};var q=function(X,W,af){var ag=new l.Vector3();ag.subVectors(W,I);var aj=new l.Vector3();aj.subVectors(X,I);var aa=new l.Vector3();aa.x=I.x-K*0.5*(S.x-C.x);aa.y=I.y-K*0.5*(S.y-C.y);aa.z=I.z-K*0.5*(S.z-C.z);var Z=new l.Vector3();Z.x=I.x+K*0.5*(S.x+C.x);Z.y=I.y+K*0.5*(S.y+C.y);Z.z=I.z+K*0.5*(S.z+C.z);var Y=new l.Vector3();Y.x=I.x+K*0.5*(S.x-C.x);Y.y=I.y+K*0.5*(S.y-C.y);Y.z=I.z+K*0.5*(S.z-C.z);var V=new l.Vector3();V.x=I.x-K*0.5*(S.x+C.x);V.y=I.y-K*0.5*(S.y+C.y);V.z=I.z-K*0.5*(S.z+C.z);var ac=new l.Vector3();var ak=new l.Vector3();ak=I.clone();if(af==1){ac.subVectors(Z,aa)}else{if(af==2){ac.subVectors(Y,Z)}else{if(af==3){ac.subVectors(V,Y)}else{if(af==4){ac.subVectors(aa,V)}}}}var ad=ag.angleTo(aj);var ai=new l.Vector3(W.x-X.x,W.y-X.y,W.z-X.z);if(ai.dot(E)>0){ad=-1*ad}var ae=new l.Matrix4().makeTranslation(-ak.x,-ak.y,-ak.z);var ab=new l.Matrix4().makeTranslation(ak.x,ak.y,ak.z);var ah=new l.Matrix4();ac.normalize();ah.makeRotationAxis(ac,ad);z.applyMatrix(ae);z.applyMatrix(ah);S.applyMatrix4(ah);C.applyMatrix4(ah);z.applyMatrix(ab);S.normalize();C.normalize();E.crossVectors(S,C);E.normalize();u.render()};function T(Y){var X=b.getScreenPlane(u);var W=b.get3DPosition(u,Y,X);var V=b.get3DPosition(u,B,X);F(W,V);B=Y}function O(Y){var X=b.getScreenPlane(u);var W=b.get3DPosition(u,Y,X);var V=b.get3DPosition(u,B,X);q(W,V,D);B=Y}L.clean=function(){var W=L._webGLV6Viewer.getRootNode();var V=new g();if(false!==f.typeOf(V)){V.removeManipulator(L)}L.cleanEvents();W.remove(z);u.render()};L.beginManipulate=function(ab){c.prototype.beginManipulate.call(L,ab);B=ab;var ac=u.pick(ab,"rep",true);if(false!==f.typeOf(ac.path)&&false!==f.typeOf(ac.normal)&&false!==f.typeOf(ac.position)){var aa=ac.normal.clone();var Y=ac.position.clone();var ad=ac.path;if(ad[0]!==undefined){var Z=ad[0].getLength();var W=1;for(W=0;W<Z;W++){var V=ad[0].getElement(W);if(false!==f.typeOf(V)&&V.name==="myPolyline"){t(aa);G(Y);break}if(false!==f.typeOf(V)&&V.name!=="myPolyline"){D=N(Y);break}}u.render()}}else{var X=b.getScreenPlane(u);var Y=b.get3DPosition(u,ab,X);D=N(Y)}};L.manipulate=function(W){c.prototype.manipulate.call(L);var V=L._webGLV6Viewer.getRootNode();if(D==5){T(W)}if(D==1||D==2||D==3||D==4){O(W)}b.updateCutByPlane(V,true,I,E);u.render()};L.endManipulate=function(V){c.prototype.endManipulate.call(L,V);D=-1};L.edit=function(Y){c.prototype.edit.call(L,Y);var W=L._webGLV6Viewer.getRootNode();var V=I.clone();var X=e.getClosestCanonicalDir(E);t(X);G(V);U(true);b.updateCutByPlane(W,true,I,E);u.render()};L.setPriority(1);L.appendEvent("CATCrDWeb:beginManipulate");L.appendEvent("CATCrDWeb:manipulate");L.appendEvent("CATCrDWeb:endManipulate");L.appendEvent("CATCrDWeb:dblClick");var n=new g();if(false!==f.typeOf(n)){n.appendManipulator(L)}var x=new l.Vector3();var Q=new l.Vector3();x=y.clone();Q=w.normal.clone();J(K);t(Q);G(x);var v=L._webGLV6Viewer.getRootNode();b.updateCutByPlane(v,true,I,E);u.render()}a.prototype=new c();return f.namespace("DS/CATCreaDesWebUIManipulators/CATCrDWebPlaneManipulator",a)});