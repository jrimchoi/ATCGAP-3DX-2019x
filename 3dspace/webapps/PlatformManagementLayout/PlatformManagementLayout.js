define("DS/PlatformManagementLayout/EditableTabView",["UWA/Core","UWA/Utils","DS/UIKIT/DropdownMenu","i18n!DS/PlatformManagementLayout/assets/nls/PlatformManagementLayout","css!DS/PlatformManagementLayout/PlatformManagementLayout.css"],function(g,i,b,m){var a=require("DS/Dashboard/UserPlatformAccess"),d=require("DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"),k=require("DS/PlatformAPI/PlatformAPI"),c=require("DS/UWPClientCode/PublicAPI"),j="my-account";var e=[],l=[],h=null;var f={init:function(r,n){var q=this,p=3,o=function(){p--;if(p===0){n.refreshIfVisible()}};q.tabsOptions={className:j,classNames:{scroller:j+"-tablist-scroller",scrollerButton:j+"-scroller-button",tabView:j+"-tabview",tabList:j+"-tablist",tabPanels:j+"-tabview-panel"},editable:false,allowNewTab:false};console.log(r);this.items=[];console.log(q);r.setValue("tabsOptions",q.tabsOptions);d.getGrantedRoles(function(s){e=s;o()});k.subscribe("com.ds.i3DXCompassManagement:updateNotificationBadge",function(t){var s=r.body.getElement("[data-tabid=PlatformManager00011] .badge");if(s){s.setText(t.count);s.toggleClassName("hidden",t.count===0)}});a.fetchUserStartupParams().then(function(s){s.roles.forEach(function(t){if(t.roles.detect(function(u){return u.id==="Operator"})){q.items.push({value:t.platform,text:t.platform});if(localStorage.getItem("platform-manager-id")===t.platform){h=t.platform}}});if(!h){h=q.items[0].text}d.getPlatformServices({platformId:h,onComplete:function(t){l=t;o()}});o()})},onLoadCards:function(s,p){var r=this,q=s.layout,n=q.elements.container,o;o=c.getUser();this._buildHeader(s);this._overrideCss(n);this._buildMobileMenu(n);this._buildPlatformSelector(s,n);this._buildMoreLessMenu(n);this._hideMenus(s,n)},_overrideCss:function(n){var p,o;n.className+=" row";o=n.querySelector("."+this.tabsOptions.classNames.scroller+"-ctn");p=n.querySelector("."+this.tabsOptions.classNames.tabPanels);o.className+=" hidden-xs col-sm-4 col-md-2 resetPadding";p.className+=" col-xs-12 col-sm-8 col-md-10 resetPadding"},_buildMobileMenu:function(o){var p=g.createElement("select",{"class":"form-control mobile-tab-select"}),n=g.createElement("div",{"class":"mobile-tab-container visible-xs"}),q=o.querySelector("."+this.tabsOptions.classNames.tabPanels);p.inject(n);o.insertBefore(n,q)},_buildHeader:function(n){n.body.innerHTML+='<div class="'+j+'-header row"><div class="first">'+m.get("welcome")+'</div><div class="second">'+m.get("platformManagement")+"</div></div>"},_buildPlatformSelector:function(q,o){var p=o.querySelector("."+this.tabsOptions.classNames.tabList);if(this.items.length>1){var n=g.createElement("li",{"class":"wp-tab "+j+"-custom-tab",html:{"class":"inner-ctn",html:{tag:"span","class":"title",html:[{tag:"i","class":"fonticon fonticon-3ds-compass expand-more"},{tag:"span",text:h},{tag:"i","class":"fonticon fonticon-open-down expand-more"}]}}}).inject(p,"top")}if(!self.dropdown&&this.items.length>1){self.dropdown=new b({target:n,position:"bottom left",items:this.items,events:{onClick:function(s,r){console.log(r);localStorage.setItem("platform-manager-id",r.value);q.setPreferences({platform:r.value});window.location.reload()}}})}},_buildMoreLessMenu:function(n){var q=this,p=n.querySelector("."+this.tabsOptions.classNames.tabList),o=n.querySelectorAll("."+q.tabsOptions.classNames.tabList+" > .wp-tab:not(."+j+"-custom-tab) .title");console.log("."+q.tabsOptions.classNames.tabList+" > .wp-tab:not(."+j+"-custom-tab) .title");if(o.length>2){g.createElement("li",{"class":"wp-tab "+j+"-custom-tab expand-more",html:{"class":"inner-ctn",html:{tag:"span","class":"title state-more",html:[{tag:"i","class":"fonticon fonticon-expand-left less"},{tag:"span",text:m.get("more")},{tag:"i","class":"fonticon fonticon-expand-right more"}]}},events:{click:function(){var r=n.querySelectorAll("."+q.tabsOptions.classNames.tabList+" > .wp-tab:not(."+j+"-custom-tab) .title");r.forEach(function(t,s){if(s>2){t.getParent("li").toggleClassName("hidden")}});if(this.getElement(".title").hasClassName("state-more")){this.querySelector(".title span").innerText=m.get("less")}else{this.querySelector(".title span").innerText=m.get("more")}this.getElement(".title").toggleClassName("state-more").toggleClassName("state-less")}}}).inject(p)}},_hideMenus:function(q,n){var p=this,o=n.querySelectorAll("."+p.tabsOptions.classNames.tabList+" > .wp-tab:not(."+j+"-custom-tab) .title");o.forEach(function(x,s){var r=JSON.parse(q.layout.tabs[s].options.item.data),u=r.icon||"",w=r.role||null,t=r.service||null;x.innerHTML='<span class="fonticon fonticon-'+u+'"></span> '+x.innerHTML;if(s>2){x.getParent("li").addClassName("hidden")}if(!p._isRoleAvailable(w)){x.getParent("li").addClassName("missing-role")}if(!p._isServiceAvailable(t)){x.getParent("li").addClassName("missing-service")}var v=0;g.createElement("div",{"class":"badge-notification",html:{tag:"span",text:v,"class":v!==0?"badge":"badge hidden"}}).inject(x)})},_isRoleAvailable:function(n){return !n||!!e.detect(function(o){return o.id===n&&o.platforms.indexOf(h)>-1})},_isServiceAvailable:function(n){return !n||!!l[n]}};return f});define("DS/PlatformManagementLayout/Column",["UWA/Core","UWA/Class/Promise"],function(c,f){var d=require("DS/UWPClientCode/WidgetFactory"),g=require("DS/WidgetPreview/Environment/Transient"),h=require("DS/i3DXCompass/i3DXCompass"),e="my-account",i="."+e+"-header",a="module "+e+" -module";var b={init:function(k,j){console.log("init");j.refreshIfVisible()},_getAppInfo:function(j){return new f(function(l,k){if(h){h.getAppInfo({appId:j,onComplete:function(m){if(m){l(m)}else{k("Could not locate app information.")}},onFailure:k})}else{k()}})},_instantiateApp:function(l,j,k){return new f(function(n){var m={el:j,title:"",parent:false,preview:true,appId:l.id,data:k||{},header:true};if(l&&((l.checksum&&l.launchInfos)||(l.platforms&&l.platforms[0]&&l.platforms[0].checksum&&l.platforms[0].launchInfos))){m=c.extend(m,{widgetId:c.is(l.launchInfos)?l.launchInfos:l.platforms[0].launchInfos,isolationLevel:c.is(l.isolationLevel)?l.isolationLevel:l.platforms[0].isolationLevel,token:c.is(l.checksum)?l.checksum:l.platforms[0].checksum})}else{throw new Error("Could not get valid Config from MyApps for the App "+m.appId)}d.load(m,function(){if(m.widget&&m.widget.environment){if(self.wp&&self.wp.isVisible){m.widget.environment.setVisible(true,true)}}n(m.widget)},g)})},onBeforeLoadColumns:function(l,r){var n=this;var p=document.body.querySelector(".main"),m=document.body.querySelector(i),o=p&&c.extendElement(p).getSize().height||588,k=m&&c.extendElement(m).getSize().height||100,q=l&&l.getValue("appId"),j=c.createElement("div",{"class":a,styles:{height:o-k}}).inject(l.layout.columns[0].body);n._getAppInfo(q).then(function(s){return n._instantiateApp(s,j,"")})}};return b});