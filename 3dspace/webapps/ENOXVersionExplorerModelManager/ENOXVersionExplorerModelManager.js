define("DS/ENOXVersionExplorerModelManager/ModelManagerP",["UWA/Promise","DS/ENOXVersionExplorerModelWebServices/ModelWebServicesP","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerUtils/ArrayFunctions","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/SemanticRelationships"],function(g,h,d,f,a,c,b,i,e){return h.extend({_onCompleteLoadVersions:function(k,j){this._parent(k,j);if(this._bLoadThumbnail===true&&b.POLL_UPDATE_THUMBNAIL&&j!==true){this._loadThumbnailAndTitle(k)}},getNewVersionName:function(){var k=this;var j;if(k.isLoaded()&&k.getNumberOfNodes()>0){var l=k._nodeList[0];if(l instanceof a){j=i.version+(k.getNumberOfNodes()+1).toString()+"_"+l.options.grid.title}}return j},})});define("DS/ENOXVersionExplorerModelManager/ModelManagerPPrime",["UWA/Promise","DS/ENOXVersionExplorerModelWebServices/ModelWebServicesPPrime","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerUtils/ArrayFunctions","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/SemanticRelationships"],function(g,h,c,e,a,b,i,d){var f=undefined;return h.extend({createNewVersionPromise:function(m,l,k){if(!m||typeof m.title!=="string"||!m.title.length){throw Error("createNewVersion: Title cannot be null")}if(!m||typeof m.parentid!=="string"||!m.parentid.length){throw Error("createNewVersion: Title cannot be null")}var j=this;return new g(function(o,n){var p={};p[m.versionSemantic]=m.parentid;j.addVersions([e.getSanitizedID(m.parentid)],[p],[m.nextRevision]).then(function(q){j._onNewVersionCreated(m,q,o,n)},n)})},_getNewVersionID:function(){var k=retval.addRequests,j;if(Array.isArray(k)&&k.length===1){j=e.getSanitizedID(k[0].id)}return j},getNewVersionName:function(){var k=this;var j;if(k.isLoaded()&&k.getNumberOfNodes()>0){var l=k._nodeList[0];if(l instanceof a){j=i.version+(k.getNumberOfNodes()+1).toString()+"_"+l.options.grid.title}}return j},getLegend:function(){return d.P_PRIME}})});define("DS/ENOXVersionExplorerModelManager/ModelManagerHistory",["UWA/Promise","DS/ENOXVersionExplorerModelWebServices/ModelWebServicesHistory","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerUtils/ArrayFunctions","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/WebappsUtils/WebappsUtils","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/SemanticRelationships"],function(h,i,c,g,a,b,f,d,e){return i.extend({_processVersions:function(l,m){var k=this,j=false;j=k[((!!m&&(!!k.itemID)&&((k.itemID===m)||k.searchByID(m).length)||l.nodes.findIndex(function(n){return n.id===k.itemID})>=0)?"_updateTree":"_loadTree")](l);k.itemID=m;return j},_getVersionArray:function(r){var k=r.nodes.length>1?r.nodes.sort(function(t,s){return(t.nId-s.nId)}):r.nodes,q=r.connections;for(var o=0,p=q.length;o<p;o++){var m=q[o],j=k[m.src-1],l=k[m.trg-1],n=m.typ;l.ancestor={historySemantic:n,id:j.id}}return k.sort(function(t,s){return new Date(t.originated).getTime()-new Date(s.originated).getTime()})},_createVersionData:function(q,m,k){var l=this,n=f.getHistoryCustomAttribute(q);var o=[],r={title:"",thumbnail:""};for(var p in q){switch(p){case"displayName":r.title=UWA.String.escapeHTML(q[p]);break;case"ancestor":if(q.ancestor){var j={semantic:g.historySemantics[q.ancestor.historySemantic].symbol,id:q.ancestor.id,icon:d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+((n&&n.icon)?n.icon:g.historySemantics[q.ancestor.historySemantic].icon),historySemantic:q.ancestor.historySemantic};if(n&&typeof n.line_color==="string"&&n.line_color.length){j.custom_line_color=n.line_color}o.push(j);if(q.ancestor.historySemantic.contains("From")&&typeof q.revisedFrom==="string"&&q.revisedFrom&&k.find(function(s){return s.id===q.revisedFrom})){o.push({semantic:"I",id:q.revisedFrom,historySemantic:q.ancestor.historySemantic})}}break;case"originated":r.creationDate=new Date(q[p]);break;case"modified":r.modified=new Date(q[p]);break;case"revision":r.code=q[p];break;case"thumbnail":case"icon":r[p]=q[p].length&&q[p].indexOf("http")<0?c.get3DSpaceBaseUrl(l.getTenantId())+q[p]:q[p];break;default:r[p]=typeof q[p]==="string"?UWA.String.escapeHTML(q[p]):q[p];break}}r.custom_node_color=(n&&typeof n.node_color==="string"&&n.node_color.length)?n.node_color:"";return{data:r,conx:o}}})});define("DS/ENOXVersionExplorerModelManager/ModelManagerRDF",["UWA/Promise","DS/ENOXVersionExplorerModelWebServices/ModelWebServicesRDF","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerUtils/ArrayFunctions","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/SemanticRelationships"],function(g,h,d,a,c,f,b,i,e){return h.extend({_createVersionData:function(k,m,l){var j=this;var p,o={title:"",thumbnail:""};for(var n in k){switch(n){case"label":o.title=UWA.String.escapeHTML(k[n]);break;case"semanticInfo":if(k.semanticInfo.member&&k.semanticInfo.member.length){p=k.semanticInfo.member.map(function(q){return{semantic:f.getSemanticSymbol(q.semantic),id:q.toVersion["@id"]}});if(p.filter(function(q){return f.getSemanticSymbol(q.semantic)!=="I"}).length>1){throw Error("_createVersionData: Version "+k.id+"has more than one non-integrate connections")}}break;case"@id":o.id=k[n];break;case"creationDate":o[n]=new Date(o[n]);break;case"modificationDate":o.modified=new Date(o[n]);break;case"thumbnail":case"icon":o[n]=k[n].length&&k[n].indexOf("http")<0?d.get3DSpaceBaseUrl(j.getTenantId())+k[n]:k[n];break;default:o[n]=typeof k[n]==="string"?UWA.String.escapeHTML(k[n]):k[n];break}}o.code="";return{data:o,conx:p}},_getItemID:function(j){return j["@id"]},_getVersionArray:function(j){return j.versions.member},_onCompleteLoadVersions:function(j){},createNewVersionPromise:function(k){if(!k||typeof k.title!=="string"||!k.title.length){throw Error("createNewVersion: Title cannot be null")}if(!k||typeof k.parentid!=="string"||!k.parentid.length){throw Error("createNewVersion: Title cannot be null")}var j=this;return new g(function(m,l){j.addVersionPromise(k).then(function(n){j._onNewVersionCreated(k,n,m,l)},l)})},_onNewVersionCreated:function(n,j,m,l){var k=this;k.getVersionsFromVersion(k.itemID).then(function(o){k._processVersions(o);var p=k._nodeList[k._nodeList.length-1];m(p);k._onCompleteLoadVersions(p.options.id)})},getNewVersionName:function(){var k=this;var j;if(k.isLoaded()&&k.getNumberOfNodes()>0){var l=k._nodeList[0];if(l instanceof a){j=i.version+(k.getNumberOfNodes()+1).toString()+"_"+l.options.grid.title}}return j},getLegend:function(){return e.P_PRIME},_getPreContextualMenuPromise:function(l,k,j){return new g(function(n,m){n(l)})}})});define("DS/ENOXVersionExplorerModelManager/ModelManagerBase",["UWA/Core","UWA/Promise","DS/ENOXVersionExplorerModelWebServices/ModelWebServicesBase","DS/ENOXVersionExplorerModel/VersionTreeDocumentModel","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/ArrayFunctions","DS/WebappsUtils/WebappsUtils"],function(g,j,m,l,b,a,h,e,f,i,d,c){var k=g.Class.extend({_manager:null,pollingInterval:undefined,init:function(n){(this._previous)&&this._previous(n)},setManager:function(n){if(!(this instanceof l)){throw Error("ModelManagerBase.setManager: ModelManagerBase can only extend a VersionTreeDocument")}this._manager=n;g.Class.implement.call(this,new (k.extend(n))())},_processVersions:function(q){var p=this;var n=false;q=(Array.isArray(q.graphs)&&q.graphs.length&&q.graphs[0])?q.graphs[0]:q;if((q.items||q.item)&&q.versions){var o=false;if(Array.isArray(q.items)){o=p._checkIfItemsPreviouslyLoaded(q.items);p.items=q.items}else{if(q.item){o=p._checkIfItemsPreviouslyLoaded([q.item]);p.items=[q.item]}}n=p[(o?"_updateTree":"_loadTree")].bind(p)(q);n=true}return n},_getVersionArray:function(n){return n.versions},_checkIfItemsPreviouslyLoaded:function(o){if(Array.isArray(this.items)){var n=d.intersectionDifference(this.items,o,function(q,p){return((p.id!=null&&q.id!=null&&p.id===q.id)||(p.vid!=null&&q.vid!=null&&p.vid===q.vid)||(p.mid!=null&&q.mid!=null&&p.mid===q.mid))});return(n[0].intersection.length>0)}else{return false}},loadVersionModelPromise:function(o){var n=this,p=o.id;this._bLoadThumbnail=((typeof o.loadThumbnail==="boolean")?o.loadThumbnail:true);if(typeof o.tenantId==="string"&&o.tenantId.length){n.setTenantId(o.tenantId)}if(typeof o.securityContext==="string"&&o.securityContext.length){n.setSecurityContext(o.securityContext)}return new j(function(r,q){if(!(n instanceof a)){q("ModelManager.createVersionModel: 'this' must be an instance of TreeDocument")}if(typeof p==="string"&&p.length){n.getVersionsFromVersion(f.getSanitizedID(p),Array.isArray(o.attributeList)&&o.attributeList.length?o.attributeList:undefined).then(function(s){r(n._processVersions(s,p));n._onCompleteLoadVersions(p,o.contextualMenu)},q)}else{if(typeof p==="object"){r(n._processVersions(p))}else{q("loadVersionModel: Input should be object or string")}}})},createNewVersionPromise:function(q,p,o){if(!q||typeof q.title!=="string"||!q.title.length){throw Error("createNewVersion: Title cannot be null")}if(!q||typeof q.parentid!=="string"||!q.parentid.length){throw Error("createNewVersion: Title cannot be null")}var n=this;this._bLoadThumbnail=((typeof q.loadThumbnail==="boolean")?q.loadThumbnail:true);return new j(function(t,s){var r=[f.getSanitizedID(q.parentid)],u=[((q.title!==n.searchByID(q.parentid)[0].options.label)?q.title:undefined)];n.reviseAsMajor({physIds:r,titles:u}).then(function(v){n._onNewVersionCreated(q,v,t,s)},s)})},_getNewVersionID:function(n,r){var q=n.results,p;var o=q.find(function(s){return r.parentid===s["attribute[PLMReference.V_DerivedFrom]"]});o=o||q[0];if(o){p=o.physicalid}return p},_onNewVersionCreated:function(t,n,s,r){var p=this,q=((typeof t.loadThumbnail==="boolean")?t.loadThumbnail:true);var o=p._getNewVersionID(n,t);if(typeof o==="string"&&o.length){if(t.description&&t.description.length){p.getUpdateNameAndDescriptionPromise({id:o,attributes:[{key:"description",value:t.description},{key:"V_description",value:t.description}]}).then(function(){p.getVersionsFromVersion(o).then(function(u){p._processVersions(u);var v=p._nodeList.find(function(w){return w.options.id===o});s(v);p._onCompleteLoadVersions(o)})},r)}else{p.getVersionsFromVersion(o).then(function(u){p._processVersions(u);var v=p._nodeList.find(function(w){return w.options.id===o});s(v);p._onCompleteLoadVersions(o)})}}},getNewVersionName:function(){throw Error("getNewVersionName: no implement")},_onCompleteLoadVersions:function(o,n){n!==true&&this._loadPersonInfo()},getLegend:function(n){return undefined},_loadPersonInfo:function(){var q=this,t=[];var s=this.personInfo=this.personInfo||{};for(var u=0,p=q._nodeList.length;u<p;u++){var v=q._nodeList[u],o=v.options.grid.owner,r=v.options.grid.reservedby;if(typeof o==="string"&&o.length&&!s.hasOwnProperty(o)){t.push(q.getPersonInfoPromise(o));s[o]=undefined}else{if(typeof o==="string"&&o.length&&s[o]&&v.options.grid.ownerName!==(s[o].firstname+" "+s[o].lastname)){v.setAttribute("ownerName",(s[o].firstname+" "+s[o].lastname))}else{if(!o){v.setAttribute("ownerName",null)}}}if(typeof r==="string"&&r.length&&!s.hasOwnProperty(r)){t.push(q.getPersonInfoPromise(r));s[reserved]=undefined}else{if(typeof r==="string"&&r.length&&s[r]&&v.options.grid.reservedbyName!==(s[r].firstname+" "+s[r].lastname)){v.setAttribute("reservedbyName",(s[r].firstname+" "+s[r].lastname))}else{if(!r){v.setAttribute("reservedbyName",null)}}}}if(t.length){Promise.all(t).then(function(y){for(var B=0,z=y.length;B<z;B++){if(y&&y[B]&&y[B].name){s[y[B].name]=y[B]}}for(var C=0,x=q._nodeList.length;C<x;C++){var D=q._nodeList[C],w=D.options.grid.owner,A=D.options.grid.reservedby;if(typeof w==="string"&&w.length&&s[w]&&D.options.grid.ownerName!==(s[w].firstname+" "+s[w].lastname)){D.setAttribute("ownerName",s[w].firstname+" "+s[w].lastname)}if(typeof A==="string"&&A.length&&s[A]&&D.options.grid.reservedbyName!==(s[A].firstname+" "+s[A].lastname)){D.setAttribute("reservedbyName",s[w].firstname+" "+s[w].lastname)}}})}},_loadThumbnailAndTitle:function(u){var q;var t=[];var o=this;var s;var r=4,n=0;(o.pollingInterval!=="undefined")&&(clearInterval(o.pollingInterval),o.pollingInterval=undefined);function v(){var x=[];var w=o._branchArray.reduce(function(y,z){if(Array.isArray(z.nodeList)&&z.nodeList.length&&z.nodeList[0] instanceof b){y.push(o.getVersionFamilyData(z.nodeList[0].options.id))}return y},[]);Promise.all(w).then(function(z){for(var A=0,y=z.length;A<y;A++){if(z[A]&&Array.isArray(z[A].data)&&z[A].data.length){x=x.concat(z[A].data)}}p(x)})}function p(y){var A=y.length;s=false;for(var z=0;z<A;z++){var B=y[z];var w=o._nodeList.find(function(F){return B.id===F.options.id});if(w){var C=(B.modified?new Date(B.modified):undefined),x=(B.modified3DShape?new Date(B.modified3DShape):undefined),D=(B.thumbnailModified?new Date(B.thumbnailModified):undefined),E=(B.isAssembly===true);if(B.thumbnail.indexOf("http")===-1){B.thumbnail=e.get3DSpaceBaseUrl(o.getTenantId())+B.thumbnail;w.setAttribute("_mask",true);s=true;w.options.repmoddate=x;w.options.thumbnaildate=D}else{if(x&&D&&(x-D)>0){w.setAttribute("_mask",true);s=true}else{if(E&&u===w.options.id){if(w.options.thumbnaildate&&D&&(D-w.options.thumbnaildate)<=0){w.setAttribute("_mask",true);s=true}else{w.setAttribute("_mask",false);w.options.repmoddate=x;w.options.thumbnaildate=D}}else{w.options.repmoddate=x;w.options.thumbnaildate=D;w.setAttribute("_mask",false)}}}if(w.options.grid.thumbnail!==B.thumbnail){w.setAttribute("thumbnail",B.thumbnail)}if(w.options.grid.title!==B.displayName){w.setAttribute("title",B.displayName)}}}if((n>=r||!s)&&o.pollingInterval!==undefined){clearInterval(o.pollingInterval);o.pollingInterval=undefined;for(var z=0,A=o._nodeList.length;z<A;z++){var w=o._nodeList[z];(w.options.grid._mask===true)&&w.setAttribute("_mask",false)}}else{if(s&&o.pollingInterval===undefined){o.pollingInterval=setInterval(function(){var F=[];v();n++},30000)}}}v()},_getPreContextualMenuPromise:function(p,o,n){return new j(function(r,q){r(p)})},_loadTree:function(r){var o=this;o.prepareAddDelete();o.empty();var p=this._createNodeArray.bind(o)(r);function s(x,G){var E=x,C,w,t;for(var F=G,v=o._nodeList.length;F<v;F+=1){w=o._nodeList[F];C=d.separate.call(E,function(N){var K=false,L;if(Array.isArray(N.options.ancestors)){var I=N.options.ancestors.length;for(var M=0;M<I;M++){var J=N.options.ancestors[M];if(f.getSemanticSymbol(J.semantic.toUpperCase())!=="I"&&J.id===w.options.id){if(!K){K=true}else{throw Error("_loadTree: mode than one non integrate semantic found")}}}}return K});if(Array.isArray(w.options.ancestors)&&w.options.ancestors.length){var H=w.options.ancestors;for(var y=0,B=H.length;y<B;y++){(f.getSemanticSymbol(H[y].semantic.toUpperCase())==="I")&&o.addMerge(H[y].id,w,H[y])}}if(C.match.length){for(var y=0,B=C.match.length;y<B;y++){var A=null,z=w.getNumberOfChildren(),u=C.match[y],D;if(u.options.ancestors.find(function(I){return I.semantic.toUpperCase()==="E"})){A=0}else{if(u.options.ancestors.find(function(I){return(I.semantic.toUpperCase()!=="I")})&&z===0){A=1}}o.addChildNode(u,A,w)}v=o._nodeList.length}E=C.dontMatch}return E}for(var q=0,n;q<p.length>0&&q<p.length;q++){n=p[q];if(!(Array.isArray(n.options.ancestors)&&n.options.ancestors.length)||(Array.isArray(n.options.ancestors)&&n.options.ancestors.length===1&&n.options.ancestors[0].mergeBetweenRoots===true)){o.addChildNode(p.splice(p.indexOf(n),1)[0]);p=s.bind(o)(p,o._nodeList.indexOf(n));q=-1}}o._isLoaded=true;o.pushAddDelete();return true},_updateTree:function(F){var y=false;var E=this,s,H=E._nodeList,D,o,A,t,u;u=E._createNodeArray.bind(E)(F);t=d.intersectionDifference(u,H,function(n,v){return n.options.id===v.options.id&&n.options.grid.redrawFlag===v.options.grid.redrawFlag});o=t[1].difference;A=o.length;E.prepareAddDelete();if(A>0){y=true;while(s=o.shift(),s){if(H.indexOf(s)>=0){var w=s.getParent(),z;if(Array.isArray(s.options.ancestors)&&s.options.ancestors.length){if(s.options.ancestors.find(function(n){return(n.semantic.toUpperCase()==="E")})&&w.getNumberOfChildren()>0){E.addChildNode(new b(),0,w,true)}E.removeChildNode(s);if(w.getNumberOfChildren()===1&&(z=w.getNthChild(0),z.isEmpty())){w.removeChild(z)}}else{E.removeChildNode(s)}}Array.isArray(s.options.ancestors)&&s.options.ancestors.filter(function(n){return n.semantic==="I"}).forEach(function(n){E.removeMerge(n.id,s)});E._mergeConnections.filter(function(n){return n.parent===s}).forEach(function(n){E.removeMerge(s,n.child)})}}t=d.intersectionDifference(u,H,function(N,O){var v=N.options.id===O.options.id;if(v){if(N.options.ancestors&&N.options.ancestors.length&&O.options.ancestors&&O.options.ancestors.length){var M=N.options.ancestors.filter(function(P){return P.semantic==="I"}),J=O.options.ancestors.filter(function(P){return P.semantic==="I"});if(M.length||J.length){var n=d.intersectionDifference(M,J,function(P,Q){return P.id===Q.id&&P.redrawFlag===Q.redrawFlag});var K=n[0].difference,L=n[1].difference;if(K.length||L.length){L.length&&L.forEach(function(P){E.removeMerge(P.id,O)});K.length&&K.forEach(function(P){E.addMerge(f.getSanitizedID(P.id),O,P)});y=true}}}O.refreshNodeData(N)}return v});var I=t[0].difference,D=I.length;if(D){y=true;for(var C=-1,x;D>0;D=I.length){C+=1;var s=I[C];if(Array.isArray(s.options.ancestors)&&s.options.ancestors.findIndex(function(n){return n.mergeBetweenRoots===true})<0){for(var B=0;B<s.options.ancestors.length;B++){var q=s.options.ancestors[B];if(f.getSemanticSymbol(q.semantic.toUpperCase())!=="I"){var w=E._nodeList.find(function(n){return q.id===n.options.id});if(w){var r=null,p=w.getNumberOfChildren(),G;if(f.getSemanticSymbol(q.semantic.toUpperCase())==="E"){r=0}else{if(p===0){r=1}}E.addChildNode(I.splice(I.indexOf(s),1)[0],r,w);C=-1}}else{E.addMerge(q.id,s,q)}}}else{E.addChildNode(I.splice(I.indexOf(s),1)[0],u.findIndex(function(n){return n===s}));if(Array.isArray(s.options.ancestors)&&s.options.ancestors.length===1&&s.options.ancestors[0].mergeBetweenRoots===true){E.addMerge(s.options.ancestors[0].id,s,s.options.ancestors[0])}C=-1}}}E.pushAddDelete();return y},_createNodeArray:function(p){var o=this;var n=this._getVersionArray(p);return n.map(function(q,s,r){return o._newVersionTreeNode.bind(o)(q,s,r)})},_newVersionTreeNode:function(p,r,q){var o=this;var n=this._createVersionData(p,r,q);return new b(f.getSanitizedID(n.data.id),n.data,n.data.creationDate,n.conx,true,o.type)},_createVersionData:function(w,r,n){var t,x={title:"",thumbnail:""};var o=this;for(var u in w){switch(u){case"label":x.title=g.String.escapeHTML(w[u]);break;case"ancestors":if(Array.isArray(w.ancestors)&&w.ancestors.length){t=[];for(var p=0,q=w.ancestors.length;p<q;p++){var s=w.ancestors[p];t.push({semantic:f.getSemanticSymbol(s.semantic),id:f.getSanitizedID(s.id),icon:c.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+f.getSemanticIcon(s.semantic),});if(s.semantic==="E"&&w.copyFrom&&w.copyFrom!==s.id&&n.findIndex(function(v){return v.id===w.copyFrom})>=0){t.push({semantic:"I",id:w.copyFrom,icon:c.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+f.getSemanticIcon("I"),})}}if(t.filter(function(v){return f.getSemanticSymbol(v.semantic)!=="I"}).length>1){throw Error("_createVersionData: Version "+w.id+"has more than one non-integrate connections")}}break;case"creation":case"creation date":x.creationDate=new Date(w[u]);break;case"modification":x.modified=new Date(w[u]);break;case"thumbnail":x[u]=w[u].length&&w[u].indexOf("://")>=0?w[u]:"";break;case"icon":x[u]=w[u].length&&w[u].indexOf("://")>=0?w[u]:"";if(x[u].length==0){x[u]=e.get3DSpaceBaseUrl(o.getTenantId())+"/snresources/images/icons/large/"+w.icon+"108x144.png"}break;default:x[u]=typeof w[u]==="string"?g.String.escapeHTML(w[u]):w[u];break}}w.code&&(x.code=w.code);return{data:x,conx:t}}});return k});define("DS/ENOXVersionExplorerModelManager/ModelManagerHistory2",["UWA/Promise","DS/ENOXVersionExplorerModelWebServices/ModelWebServicesHistory2","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerUtils/ArrayFunctions","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/WebappsUtils/WebappsUtils","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/SemanticRelationships"],function(h,i,c,g,a,b,f,d,e){return i.extend({_createVersionData:function(s,p,k){if((s.copyFrom&&!s.ancestors||(Array.isArray(s.ancestors)&&!s.ancestors.length))&&k.findIndex(function(t){return t.id===s.copyFrom})>=0){s.ancestors=[{semantic:"SO",id:s.copyFrom}]}var o=this.__proto__._createVersionData.call(this,s,p,k),q=f.getHistoryCustomAttribute(s);if(!this.mainBranchRoot){this.mainBranchRoot=k.find(function(t){return(!Array.isArray(t.ancestors)||Array.isArray(t.ancestors)&&t.ancestors.length===0)})}if(!o.conx||!o.conx.length){o.data.position=0}if(q){o.data.custom_node_color=(typeof q.node_color==="string"&&q.node_color.length)?q.node_color:"";if(Array.isArray(o.conx)&&o.conx.length){var r=o.conx.filter(function(t){return !(t.semantic=="E"||t.semantic=="I")}),m;if(o.conx&&r.length===1&&q&&q.setAsTree==="true"&&(m=q.position,!isNaN(m))){r[0].semantic="I";o.data.position=m;o.data.redrawFlag=true;r[0].reference=this.mainBranchRoot.id;r[0].mergeBetweenRoots=true;r[0].mergeLeft=true;if(typeof q.icon==="string"&&q.icon.length){r[0].icon=d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+q.icon}if(typeof q.line_color==="string"&&q.line_color.length){r[0].custom_line_color=q.line_color}}else{for(var l=0,n=o.conx.length;l<n;l++){var j=o.conx[l];if(j.semantic!=="I"&&typeof q.line_color==="string"&&q.line_color.length){j.custom_line_color=q.line_color}else{j.redrawFlag=true}if(typeof q.icon==="string"&&q.icon.length){j.icon=d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+q.icon}}}}}else{o.data.custom_node_color=""}return o},_createNodeArray:function(n){var l=this.__proto__._createNodeArray.call(this,n);l.sort(function(p,o){return p.options.creationDate.getTime()-o.options.creationDate.getTime()});var k=[];for(var m=0,j=l.length;m<j;m++){if(!isNaN(l[m].options.grid.position)){k.push(l.splice(m,1)[0]);j-=1;m-=1}}if(k.length){k.sort(function(p,o){return p.options.grid.position-o.options.grid.position})}l=k.concat(l);return l},_updateMerges:function(){var j=this;var k=j.searchByID(this.mainBranchRoot.id)[0];this._mergeConnections.forEach(function(n,m,l){if(n.mergeBetweenRoots){n.reference=n.reference instanceof a?n.reference:j.searchByID(n.reference)[0];n.referenceBranch=n.reference.__BRANCH__;if(!n.child instanceof a){n.child=j.searchByID(n.child)[0]}if(n.child instanceof a){n.child.processDescendants({async:false,onlyVisibleNodes:true,processNode:function(o){var p=o.nodeModel;j._mergeConnections.filter(function(q){return q.child===p}).forEach(function(q){if(!(q.parent instanceof a)){q.parent=j.searchByID(q.parent)[0]}if(q.parent instanceof a&&k.isAscendantOf(q.parent)){q.mergeLeft=true;q.referenceBranch=n.referenceBranch}})}})}}});this.__proto__._updateMerges.call(this)},empty:function(){this.__proto__.empty.call(this);this.mainBranchRoot=undefined}})});define("DS/ENOXVersionExplorerModelManager/ModelManagerER",["UWA/Promise","DS/ENOXVersionExplorerModelWebServices/ModelWebServicesER","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerUtils/ArrayFunctions","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/SemanticRelationships"],function(g,h,c,e,a,b,i,d){var f=undefined;return h.extend({getNewVersionName:function(){var k=this;var j;if(k.isLoaded()&&k.getNumberOfNodes()>0){var l=k._nodeList[0];if(l instanceof a){j=i.version+(k.getNumberOfNodes()+1).toString()+"_"+l.options.grid.title}}return j},getLegend:function(){return d.X_MODEL}})});