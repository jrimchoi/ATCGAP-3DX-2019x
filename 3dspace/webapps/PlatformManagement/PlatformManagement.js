define("DS/PlatformManagement/Model/LegalNoticeModel",["UWA/Core","UWA/Class/Model"],function(b,a){return a.extend({defaults:{accepted:false,acceptedDP:false,acceptedTOS:false,displayName:"",dp:"",id:"",manager:true,tos:""},hasLegal:function(){return this.get("statusDP")||this.get("statusTOS")||this.get("statusCookies")}})});define("DS/PlatformManagement/Utils/FCSManager",["UWA/Core","UWA/Class","UWA/Utils","UWA/Utils/Client","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(g,a,c,f,e){var d=e.extend({url:"environment/ticket"}),b=e.extend({url:"environment/checkoutticket"});return a.singleton({fetchTicket:function(h){return new d().fetch(h)},fetchCheckoutTicket:function(h){return new b().fetch(h)},downloadFile:function(j,i){var h=i.fcsJobTicket;if(this._isChromeAndroid()){this._downloadWithForm(i,j)}else{window.top.location=i.fcsUrl+"?"+c.toQueryString({__fcs__failurePage:i.failurePage,__fcs__jobTicket:h,file_0_name:j,__fcs__attachment:true})}},_isChromeAndroid:function(){return g.is(f.Platform.android)&&g.is(f.Engine.chrome)},_downloadWithForm:function(i,j){var h=g.createElement("form",{"class":"form-wrapper",action:i.fcsUrl,method:"POST",enctype:"application/x-www-form-urlencoded",target:"_blank",html:[{tag:"input",type:"hidden",value:j,name:"file_0_name",id:"file_0_name"},{tag:"input",type:"hidden",value:"false",name:"attachment",id:"attachment"},{tag:"input",type:"hidden",value:i.fcsJobTicket,name:"__fcs__jobTicket",id:"__fcs__jobTicket"}]});h.inject(document.body);h.submit();setTimeout(function(){h.destroy()},25)}})});define("DS/PlatformManagement/Views/TileAddView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView"],function(b,a){return a.extend({tagName:"div",name:"platform-management",render:function(){this.container.addClassName("grid add-container");this._parent();this.container.getElement(".platform-management-header").setContent({tag:"i",styles:{height:70,width:60,"vertical-align":"middle",display:"table-cell"},"class":this.model.get("fonticon")});this.container.getElement(".platform-management-body").removeClassName("tile-body").setContent({tag:"div",styles:{height:70,"vertical-align":"middle",display:"table-cell"},text:this.model.get("title")});this.container.addEvent("click",this.model.get("action"));return this}})});define("DS/PlatformManagement/Model/NotificationModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(b,a){return a.extend({url:"role/request",defaults:{type:null,who:null,what:null,date:null,state:null},canAccept:function(){var f=true,e=this.get("role"),c=e.prereq,d=c.type;if(d==="and"){c.process.forEach(function(g){if(g.free===0){f=false}})}else{if(d==="or"){f=false;c.process.forEach(function(g){if(g.free>0){f=true}})}}if(e.free===0){f=false}return f}})});define("DS/PlatformManagement/Controls/Input/Text",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Input/Text"],function(d,c,b){var a=600;return c.extend({defaultOptions:{},init:function(e){var f=this;this.open=e.open||false;this.minChar=e.minChar||0;this.isCollapsable=false;if(!e.attributes.value){e.attributes.value=""}if(e.attributes.value===""){this.isCollapsable=e.isCollapsable||false}f._parent(e);this.elements.container=this.buildContainer()},openInput:function(){var e=this;if(this.isCollapsable){this.elements.input.elements.input.removeClassName("hidden")}e.open=true;e.elements.input.elements.input.focus();if(e.options.attributes&&e.options.attributes.placeholder){e.elements.input.elements.input.setAttribute("placeholder",e.options.attributes.placeholder)}},updateInputClosedAttribute:function(){this.elements.input.elements.input.addClassName("hidden");this.elements.input.elements.input.setAttribute("placeholder","")},buildContainer:function(){var e=this,f=0;e.keyUp=d.clone(e.options.attributes.events.keyup);e.options.attributes.events.keyup=function(){var g=e.elements.input.getValue().length;if(g>=e.minChar){e.getContent().getElement(".fonticon-cancel-squared").toggleClassName("hidden",g===0);clearTimeout(f);f=setTimeout(function(){e.keyUp.call(e.elements.input.getContent())},a)}};this.elements.input=new b(this.options);if(this.isCollapsable){this.elements.input.elements.input.addEvent("click",function(){if(!e.open){e.openInput()}});this.updateInputClosedAttribute()}return d.createElement("div",{"class":"input-search-center",html:{"class":"input-search-wrapper",html:[{tag:"i","class":"fonticon fonticon-cancel-squared pointer"+(this.options.attributes.value===""?" hidden":""),events:{click:function(){e.elements.input.setValue("");e.elements.input.focus();e.getContent().getElement(".fonticon-cancel-squared").addClassName("hidden");e.keyUp.call(e.elements.input.getContent())}}},{tag:"i","class":"fonticon fonticon-search pointer",events:{click:function(h){var g=e.elements.input.getValue().length;h.preventDefault();h.stopPropagation();if(e.open){if(g>=e.minChar){e.keyUp.call(e.elements.input.getContent())}}else{e.openInput()}}}},this.elements.input]}})}})});define("DS/PlatformManagement/Views/ProcessView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView"],function(b,a){return a.extend({tagName:"div",name:"platform-management",extendedEvents:false,render:function(){var d="",c=this.model;this._parent();this.container.setAttribute("data-id",c.get("uid"));this.container.setAttribute("data-percent",c.getPercent());this.container.setAttribute("data-type","process");if(!c.isCustom()){this.container.setAttribute("data-casual",c.get("casual"))}this.container.setAttribute("data-free",c.get("free"));if(c.isSelfExp()){this.container.setAttribute("data-trial","")}this.container.setAttribute("data-cross-company",this.model.canCrossCompany());if((!c.hasFree()&&!c.isCustom())||c.isSelfExp()){d=" disabled"}this.container.addClassName("process grid"+d);if(this.container.getElement(".tile-subtitle")&&this.container.getElement(".tile-subtitle").getText()===""){this.container.getElement(".tile-subtitle").addClassName("hidden")}this.extendedEvents=this._initExtendedEvents();return this},destroy:function(){if(this.container&&this.container.getElement(".tile-sub-container")){this.container.getElement(".tile-sub-container").removeEvent("click")}return this._parent()},_initExtendedEvents:function(){var c=this;this.container.getElement(".tile-sub-container").addEvent("click",function(d){if(!c._isActionElement(d.target)&&!c.container.hasClassName("disabled")){if(c.isSelected()){c.unSelect()}else{c.select()}if(c.options.onSelect){c.options.onSelect(c.getContent(),c.model)}}});return true},_isActionElement:function(c){return c.getParent(".actions-inline-container")||c.hasClassName("actions-inline-container")}})});define("DS/PlatformManagement/Views/AppsView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView"],function(b,a){return a.extend({tagName:"div",name:"platform-management",extendedEvents:false,render:function(){var c="";this._parent();if(!this.model.get("private")){c=" tp-apps-public";this.container.setAttribute("data-public","true")}this.container.addClassName("process tp-apps grid"+c);this.container.setAttribute("data-id",this.model.get("uid"));this.container.setAttribute("data-type","process");this.extendedEvents=this._initExtendedEvents();return this},destroy:function(){if(this.container&&this.container.getElement(".tile-sub-container")){this.container.getElement(".tile-sub-container").removeEvent("click")}return this._parent()},_initExtendedEvents:function(){var c=this;this.container.getElement(".tile-sub-container").addEvent("click",function(d){if(!c._isActionElement(d.target)&&!c.container.hasClassName("disabled")&&c.model.get("private")){if(c.isSelected()){c.unSelect()}else{c.select()}if(c.options.onSelect){c.options.onSelect(c.getContent())}}});return true},_isActionElement:function(c){return c.getParent(".actions-inline-container")||c.hasClassName("actions-inline-container")}})});define("DS/PlatformManagement/Utils/DragManager",["UWA/Core","UWA/Class","UWA/Controls/Drag","UWA/Event"],function(d,b,h,i){var a=200,g=30,e=150,f=50,j=2,c=10;return b.extend({init:function(k){this.zonesIdentifier=k.zonesIdentifier;this.tileIdentifier=k.tileIdentifier;this.wrapperSelector=k.wrapperSelector;this.container=k.container;this.scrollView=k.scrollView;this.scroller=k.scrollView.scroller;this.cancelZoneLocationSelector=k.cancelZoneLocationSelector;this.currentContext=null;this.isScrolling=false;this.drop=k.drop;this.collection=k.collection;this.onSelect=k.onSelect;this._initDrag=k.initDrag;return this._parent(k)},getScroller:function(){return this.scrollView.scroller},getZones:function(){return this.container.getElements(this.zonesIdentifier)},getCurrentScrollPosition:function(){return this.scroller.getPosition().y*-1},getYPosition:function(k){return k.startOrigin.y+k.currentDelta.y},getContainerHeight:function(){return this.scroller.getContent().getSize().height},needToScrollTop:function(k){return this.getYPosition(k)<e&&this.getCurrentScrollPosition()!==0},needToScrollBottom:function(k){return this.getYPosition(k)>(this.getContainerHeight()-f)},buildStack:function(){var q=0,n,m,p=0,l="",o=this.container.getElements(this.tileIdentifier+".selected"),k=o.reduce(function(u,t,r){var s=u;q=q+c;if(r<=(j-1)){if((r===o.length-1)||r===(j-1)){l='<span class="badge" style="top:'+(q+7)+'px">'+o.length+"</span>"}n=t.getParent().getTagName()==="tbody"?'table class="table"':"div";m=t.getParent().getTagName()==="tbody"?"background-color:white;":"";p=t.getParent().getTagName()==="tbody"?(t.getSize().width*0.8):t.getSize().width;s=u+"<"+n+' style="width:'+p+"px;height:"+t.getSize().height+"px;position:absolute;top:"+q+"px;left:"+q+"px;"+m+'">'+t.outerHTML+"</"+n+">"}return s},"");return d.createElement("div",{"class":"drag-stack",styles:{width:p},html:{html:[k,l]}})},getWrapperSize:function(){return this._getZonesWrapper().getSize().height},_createDropZoneCancel:function(){this._dropZoneCancel=d.createElement("div",{"class":"drop-manager-cancel",events:{mouseenter:function(){this.addClassName("hover")},mouseleave:function(){this.removeClassName("hover")}},html:'<div class="center"><span class="fonticon fonticon-cancel"></span><span class="text">'+d.i18n("Drop here to cancel action")+"</span></div>"});return this._dropZoneCancel},_getZonesWrapper:function(){if(!this._zoneWrapper){this._zoneWrapper=this.container.getElement(this.wrapperSelector+" .pm-grid-container")}return this._zoneWrapper},initDrag:function(){var k=this;return new h.Move({container:this.scrollView.getContent(),zones:this.getZones(),delegate:this.tileIdentifier+" *",centerHandles:true,handles:function(l){var m=l.target.getClosest(k.tileIdentifier);k.currentContext=l;if(!m.hasClassName("selected")){m.addClassName("selected");if(k.onSelect(m,k.collection.get(m.getAttribute("data-id")),true)){setTimeout(function(){l.cancel();l.stop();l.reset();k._initDrag()},0)}l.refreshCache()}l.options.zones=k.getZones();m.addClassName("isDragging");k._wrapperSize=k.getWrapperSize();k._createDropZoneCancel().inject(k.container.getElement(k.cancelZoneLocationSelector),"before");k._getZonesWrapper().addClassName("smooth-translate-Y-start");setTimeout(function(){k._getZonesWrapper().addClassName("smooth-translate-Y");k.scroller.scrollTo(0,0)},1);return k.buildStack().inject(l.root)},stop:function(l){k._dropZoneCancel.destroy();l.target.getClosest(".selected").removeClassName("isDragging");if(l.zone){l.zone.removeClassName("drag-hover")}l.handles.destroy();setTimeout(function(){k._getZonesWrapper().removeClassName("smooth-translate-Y")},2);setTimeout(function(){k._getZonesWrapper().removeClassName("smooth-translate-Y-start")},301);if(k.isScrolling){window.clearInterval(k.isScrolling);k.isScrolling=false}},enter:function(l){if(!l.zone.hasClassName("disabled")){l.zone.addClassName("drag-hover")}},leave:function(l){l.zone.removeClassName("drag-hover")},move:function(l){k.currentContext.refreshCache();i.stop(l);if(k.needToScrollTop(l)){if(!k.isScrolling){k.isScrolling=window.setInterval(function(){k.getScroller().scrollTo(0,(k.getCurrentScrollPosition())-g)},a)}}else{if(k.needToScrollBottom(l)){if(!k.isScrolling){k.isScrolling=window.setInterval(function(){k.getScroller().scrollTo(0,(k.getCurrentScrollPosition())+g)},a)}}else{if(k.isScrolling){window.clearInterval(k.isScrolling);k.isScrolling=false}}}},drop:function(l){if(!l.zone.hasClassName("disabled")){k.drop(l)}}})}})});define("DS/PlatformManagement/Utils/SpriteManager",["UWA/Core","UWA/Class"],function(c,a){var b="{0}/api/media/streammediasprite/idList/{1}?{2}";return a.extend({spriteParams:[],spriteCache:[],url:null,init:function(d){this.swymUrl=d.url;this.spriteParams=[];this.spriteCache=[]},addItem:function(d){this.spriteParams.push(d)},addCache:function(d){this.spriteCache.push(d)},spritifyElement:function(g,f){var e=100*this.spriteParams.length,d=(100/(this.spriteParams.length-1))*f;g.setStyles({"background-image":'url("'+this.getUrl()+'")',"background-size":"100% "+e+"%","background-position":"0px "+d+"%",height:"100%"})},getUrl:function(){if(!this.url){this.url=c.String.format(b,this.swymUrl,this.spriteParams.join("="),this.spriteCache.join(""))}return this.url}})});define("DS/PlatformManagement/Views/StepView",["UWA/Core","UWA/Class/View"],function(b,a){return a.extend({tagName:"div",className:"step",setup:function(){this.listenTo(this.model,{"onChange:active":this._setActive,"onChange:validated":this._setValidated});var c=80/this.model.collection.length+"%";this.getContent().setStyle("width",c);return this._parent.apply(this,arguments)},_setValidated:function(){this.getContent().toggleClassName("validated",this.model.get("validated")===true)},_setActive:function(){this.getContent().toggleClassName("active",this.model.get("active")===true)},render:function(){var c=this.model.get("label"),d=[{"class":"step-number",text:this.model.get("id")},{"class":"step-label",text:c,title:c}];this.container.setContent(d);return this}})});define("DS/PlatformManagement/Controls/PlatformNotify",["UWA/Core","DS/UIKIT/Alert"],function(b,a){return{message:function(d,c){if(!this.notifier||(document.body.getElement&&!document.body.getElement(".platform-management-notify"))){this.notifier=new a({closable:true,visible:true,autoHide:true,hideDelay:3000,className:"platform-management-notify"}).inject(document.body,"top")}this.notifier.add({className:c,message:d})},success:function(c){this.message(c,"success")},alert:function(c){this.message(c,"error")},warn:function(c){this.message(c,"warning")},info:function(c){this.message(c,"info")}}});define("DS/PlatformManagement/Model/TagModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(b,a){return a.extend({url:"user/tag",parse:function(c){return c}})});define("DS/PlatformManagement/Views/CreditAndTokenView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView"],function(b,a){return a.extend({tagName:"div",name:"platform-management",extendedEvents:false,render:function(){var d="",c=this.model;this._parent();this.container.setAttribute("data-id",c.get("id"));this.container.setAttribute("data-percent",c.getPercent());this.container.setAttribute("data-type","credits-tokens");this.container.setAttribute("data-free",c.get("free"));if(c.isSelfExp()){this.container.setAttribute("data-trial","")}this.container.addClassName("process grid"+d);if(this.container.getElement(".tile-subtitle")&&this.container.getElement(".tile-subtitle").getText()===""){this.container.getElement(".tile-subtitle").addClassName("hidden")}return this},destroy:function(){if(this.container&&this.container.getElement(".tile-sub-container")){this.container.getElement(".tile-sub-container").removeEvent("click")}return this._parent()},_isActionElement:function(c){return c.getParent(".actions-inline-container")||c.hasClassName("actions-inline-container")}})});define("DS/PlatformManagement/Controls/ButtonFab",["UWA/Core","UWA/Class/View","DS/UIKIT/Tooltip"],function(g,f,d){var a=[],b="",e="",c="";return f.extend({tagName:"div",className:"btn-fab hidden",domEvents:{click:"_onClick"},setup:function(h){a=[{id:"remove-people","class":"fonticon fonticon-users-times",title:g.i18n("Remove Users")},{id:"remove-roles","class":"fonticon fonticon-role-times",title:g.i18n("Remove granted roles")}];b=g.i18n("Open");e=g.i18n("Close");c=g.i18n("Grant selected roles/apps to selected members");this._parent(h)},render:function(){this.container.setContent(this.createContent());this.tooltip=new d({position:"left",target:this.container,body:g.i18n("Grant selected roles/apps to selected members")});return this},createContent:function(){return{tag:"i","class":"fonticon fonticon-plus"}},showSingle:function(){this._hideSubMenu();this._cleanIcon();this.container.getElement("i").addClassName("fonticon-plus");this.tooltip.setBody(c);this._show()},showMultiple:function(){this._hideSubMenu();this._cleanIcon();this.container.getElement("i").addClassName("fonticon-up-open-mini");this.tooltip.setBody(b);this._show()},hide:function(){this._hideSubMenu();this.container.addClassName("hidden")},_show:function(){this.container.removeClassName("hidden")},_onClick:function(){var h=this.container,i=h.getElement("i");if(i.hasClassName("fonticon-plus")){this.dispatchEvent("onActionClick",["default"]);h.addClassName("hidden")}else{if(i.hasClassName("fonticon-cancel")){i.removeClassName("fonticon-cancel").addClassName("fonticon-up-open-mini");this.tooltip.setBody(b);this._hideSubMenu()}else{i.removeClassName("fonticon-up-open-mini").addClassName("fonticon-cancel");this.tooltip.setBody(e);if(!this._subMenus){this._createSubMenu();this._showSubMenu()}else{this._showSubMenu()}}}},_cleanIcon:function(){this.container.getElement("i").removeClassName("fonticon-cancel").removeClassName("fonticon-up-open-mini").removeClassName("fonticon-plus")},_createSubMenu:function(){var h=this;h._subMenus=a.map(function(k,i){var j=g.createElement("div",{"class":"btn-fab",styles:{bottom:70*(i+1),opacity:0,transition:"opacity ."+15*(i+1)+"s ease-in-out"},html:{"data-action":k.id,tag:"i","class":k["class"]},events:{click:function(){h.hide();h.dispatchEvent("onActionClick",[k.id])}}}).inject(h.options.wrapper);new d({position:"left",target:j,body:k.title});return j})},_showSubMenu:function(){if(this._subMenus){this._subMenus.forEach(function(h){h.removeClassName("hidden");setTimeout(function(){h.setStyle("opacity",1)},0)})}},_hideSubMenu:function(){if(this._subMenus){this._subMenus.forEach(function(h){h.addClassName("hidden").setStyle("opacity",0)})}}})});define("DS/PlatformManagement/Model/UserRightModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/i3DXCompassCore/CacheManager"],function(c,b,a){return b.extend({url:"environment/listroles",sync:function(f,e,d){return this._parent(f,e,c.merge(d,{cacheStrategy:typeof DISABLE_LOCAL_CACHE==="undefined"?a.CACHE_STRATEGY_STATIC:null}))}})});define("DS/PlatformManagement/Utils/SearchManager",["UWA/Core","UWA/Class","UWA/Utils/InterCom"],function(g,e,f){var d="SearchComServer",c="RegisterContext",b="UnregisterContext",a="InContextSearch";return e.extend({_socket:null,_widgetId:null,init:function(h){this._socket=null;this._widgetId=h.id},register:function(){if(!g.is(this._socket)){this._socket=new f.Socket(this._widgetId,{dispatchRetryInterval:0});this._socket.subscribeServer(d);this._socket.dispatchEvent(c,{app_socket_id:this._widgetId,widget_id:this._widgetId,search_delegation:"3ddashboard"})}return this},unregister:function(){this._socket.dispatchEvent(b,{widget_id:this._widgetId});this._socket.disconnect();delete this._socket;return this}})});define("DS/PlatformManagement/Views/DiskView",["UWA/Core","UWA/Class/View","DS/UIKIT/Spinner","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/i3DXCompassCore/Controls/Gauge","DS/i3DXCompassCore/CacheManager"],function(g,e,c,d,b,a){var f=d.extend({url:"disk",parse:function(h){if(h){h.consumptionFormatted=this._bytesFormat(h.consumption);h.quotaFormatted=this._bytesFormat(h.quota)}return h},getPercentage:function(){return(!this.get("quota")||this.get("quota")===0)?0:Math.round(this.get("consumption")*100)/this.get("quota")},hasError:function(){return g.is(this.get("code"))&&this.get("code")!==0},isEmpty:function(){return !g.is(this.get("quota"))},_bytesFormat:function(m){var i="",j=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],k,h,l;for(l=0;l<=j.length;l++){k=Math.pow(1000,l);h=Math.pow(1000,l+1);if(m>=k&&m<h){i=i+j[l];if(k>0){m=m/k}break}}return(Math.round(m*10)/10)+i}});return e.extend({tagName:"div",className:"disk",isRendered:false,setup:function(h){this.model=new f();this.platform=h.platform;this.listenTo(this.model,"onChange",this._renderTemplate)},render:function(){if(!this.isRendered){this._renderTemplate();this.isRendered=true}this.model.fetch({data:{platform:this.platform.get("id")},cacheTTL:a.LONG_LIFE_TIME,onFailure:function(h,i){if(h.isEmpty()){if(!i.code){h.set("code",1)}else{h.set(i)}}}});return this},_renderTemplate:function(){this.container.setContent([{"class":"disk-gauge",html:this._createGauge()},{"class":"disk-information",html:this._createInformation()}])},_createGauge:function(){return new b({percent:this.model.getPercentage(),reversed:true})},_createInformation:function(){var h="";if(this.model.isEmpty()&&!this.model.hasError()){h=new c().show()}else{if(this.model.hasError()){h=""}else{h=g.String.format(g.i18n("Consumption {0} of {1}"),this.model.get("consumptionFormatted"),this.model.get("quotaFormatted"))}}return h}})});define("DS/PlatformManagement/Views/EmptyView",["UWA/Core","UWA/Class/View"],function(b,a){return a.extend({tagName:"div",className:"empty-text-view",render:function(d){var c=b.createElement("div",{"class":"empty-text text-center",text:d});this.container.setContent(c);return this}})});define("DS/PlatformManagement/Utils",["UWA/Core","DS/i3DXCompassCore/Utils","UWA/Utils","UWA/Widget","DS/WebappsUtils/WebappsUtils"],function(f,h,e,i,d){var j=["platform-management-2"],b=null,g,c=null,a=null;return f.merge(h,{isLightweight:function(){var k=this.getWidget();if(c===null){c=k&&k.data&&k.data.lightweight===true}return c},getDocument:function(){return this.isFrame()?this.getWidget().body:document.body},getAsset:function(k){return d.getWebappsAssetUrl("PlatformManagement",k)}})});define("DS/PlatformManagement/Controls/Loader",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Spinner"],function(c,b,a){return b.extend({defaultOptions:{},init:function(d){var e=this;e._parent(d);this.buildContainer()},buildContainer:function(){this.elements.container=c.createElement("div",{"class":"mask loading-mask",html:{"class":"mask-wrapper",html:{"class":"mask-content",html:new a({visible:true})}}})}})});define("DS/PlatformManagement/Utils/Ajax",["UWA/Core","UWA/Class","UWA/Data","DS/PlatformManagement/Controls/PlatformNotify","UWA/Class/Options","DS/PlatformManagement/Utils","UWA/Storage","DS/WAFData/WAFData","UWA/Storage/Adapter/Dom"],function(h,d,e,c,b,g,f,a){return d.extend(b,{defaultOptions:{url:"",callbacks:{},params:{}},init:function(i){this.setOptions(i)},request:function(j,o,q,i){var m={Accept:"application/json","Accept-Language":g.getLang()},n,k,r="passport",p=null,l=function(s){if(typeof q.onFailure==="function"){q.onFailure.apply(this,arguments)}else{h.log("ERROR");h.log(s)}};o=h.merge({os:g.detectOs()},o);i=i||"GET";if(o.proxy===null){r=null}else{if(o.proxy){r=o.proxy}}n=o;if(i==="POST"||i==="PUT"||i==="DELETE"){m["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8"}m["X-Utc-Offset"]=g.getTimezoneOffset();k={timeout:15000,method:i,type:o.responseType||"json",headers:m,proxy:r,data:n,cache:-1,onComplete:function(t){var s;if((t.code&&t.code!=="0"&&t.code!=="2")||t.error){if(t.message&&t.message!==""){s=t.message}else{if(t.error&&t.error.type){s=t.error.type}else{if(t.error){s=t.error}else{s=t}}}if(t.error&&t.error.status==="java.net.SocketTimeoutException: Read timed out"){c.warn(h.i18n("Action is still pending... Please wait a few seconds and refresh your widget"))}if(typeof q.onFailure==="function"){q.onFailure(t)}else{c.alert(s)}}else{if(typeof q.onComplete==="function"){q.onComplete(t)}}},onFailure:l,onTimeout:function(s){c.warn(h.i18n("Action is still pending... Please wait a few seconds and refresh your widget"));l(s)}};return a.authenticatedRequest(j,k)},get:function(){return this.request(this.options.url,this.options.params,this.options.callbacks,"GET")},post:function(){return this.request(this.options.url,this.options.params,this.options.callbacks,"POST")},put:function(){this.request(this.options.url,this.options.params,this.options.callbacks,"PUT")},doDelete:function(){return this.request(this.options.url,this.options.params,this.options.callbacks,"DELETE")},create:function(){return this.post()},update:function(){return this.put()}})});define("DS/PlatformManagement/Collection/PaginatedCollection",["UWA/Core","DS/i3DXCompassCore/Collection/i3DXCompassCollection","DS/PlatformManagement/Utils"],function(c,a,b){return a.extend({options:{data:{query:null,platform:null,sort:null,sort_direction:null,offset:null}},count:0,setParams:function(d){this.options.data=b.merge(d,this.options.data);return this},getParams:function(){return this.options.data},setPlatform:function(d){this.getParams().platform=d;return this},setSortField:function(d){this.getParams().sort=d;return this},setQuery:function(d){this.getParams().query=d;return this},getOffset:function(){return this.getParams().offset||0},setOffset:function(d){this.getParams().offset=d;return this},setLimit:function(d){this.getParams().limit=d;return this},getQuery:function(){return this.getParams().query},setMaxLimit:function(d){this.count=d;return this},setSortDirection:function(d){this.getParams().sort_direction=d;return this},getLimit:function(){return this.getParams().limit||this.size()},getMaxLimit:function(){return this.count},getPreviousOffset:function(){var d=this.getOffset();if(this.hasPrevious()){d=parseInt(this.getOffset(),10)-parseInt(this.getLimit(),10)}return d},getNextOffset:function(){var d=this.getOffset();if(this.hasNext()){d=parseInt(this.getOffset(),10)+parseInt(this.getLimit(),10)}return d},hasNext:function(){return(this.getOffset()+this.getLimit())<this.getMaxLimit()},hasPrevious:function(){return(this.getOffset()-this.getLimit())>0},hasPagination:function(){return this.getMaxLimit()>this.getLimit()}})});define("DS/PlatformManagement/Model/ProcessModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Utils","DS/i3DXCompassCore/Controls/Gauge"],function(f,e,d,a){var b="license",c="apps";return e.extend({idAttribute:"uid",url:"role",hasFree:function(g){if(typeof g==="undefined"){g=0}return(this.get("withLicenses")===false)||this.canCrossCompany()||this.isTPA()||this.isCustom()||(this.get("free")!==0&&this.get("free")>=g)},isWUWithouLicenseFree:function(){return this.get("free")===0&&this.isWU()&&this.canCrossCompany()},isOption:function(){return this.get("option")},isCasual:function(){return this.get("casual")>0},isTPA:function(){return f.is(this.get("type"))&&this.get("type")!=="WA"&&this.get("type")!=="WU"},isSelfExp:function(){return this.get("selfexp")===true},getPercent:function(){var g=(this.get("total")-this.get("free"))*100/this.get("total");return Math.min(g,100)},getType:function(){return this.isTPA()?c:b},getDisplayType:function(){return this.isTPA()?this.escape("type"):null},isDisabled:function(i,h){var g=false;if(this.isSelfExp()){if(!this.get("granted")){g=true}else{g=!(this.get("remove")===true&&this.get("expire")==="")}}else{if(!i){if(this.isCustom()){g=false}else{if(this.isTPA()){g=this.get("private")===false}else{g=(this.get("granted")===false&&!this.hasFree())||(this.get("granted")===true&&this.get("remove")===false);if(!g&&h&&!this.hasFree(h)){g=true}}}}else{if(this.get("granted")){g=this.get("remove")===false}else{g=true}}}return g},getCasual:function(){return this.isCustom()?null:this.get("casual")},isCustom:function(){var g=f.is(this.get("custom"))?this.get("custom"):this.get("icon");return !this.isTPA()&&g},getIcon:function(){if(this.isTPA()){return this.get("icon")||d.getAsset("3DExpPlatform_Default.png")}else{if(this.isCustom()||this.get("total")===0){return this.get("icon")||d.getAsset("ROLE_64_granted.png")}else{if(this.isSelfExp()){return d.getAsset("selfexp-logo.png")}else{return new a({height:120,width:120,reversed:true,percent:this.getPercent()}).toUrl()}}}},canCrossCompany:function(){return this.get("crossCompany")===true},isWA:function(){return this.get("type")==="WA"},isWU:function(){return this.get("type")==="WU"},_hasPrereq:function(){return this.get("prereq")&&this.get("prereq").process&&this.get("prereq").process.length>0},isAssignDisabled:function(g,i){var h=false;if(g===false){h=this.get("free")===0}if(typeof i!=="undefined"){h=this.get("free")<i}return this.get("licensedDisabled")||h},isAssignSelected:function(){}})});define("DS/PlatformManagement/Utils/Data",["UWA/Core","DS/PlatformAPI/PlatformAPI","DS/WebappsUtils/WebappsUtils","DS/i3DXCompassCore/Utils/Ajax","DS/PlatformManagement/Utils"],function(e,a,d,c){var b={proxy:{baseUrl:"",baseUrlBackend:"{0}/resources/AppsMngt/",getpreferences:"{0}user/getPreferences",setpreferences:"{0}user/setPreferences",licensesUser:"{0}licenses/user/",groupRole:"{0}group/role/",removeAllRoles:"{0}/licenses/allroles",faillurePage:"{0}uploadfile/message?error=true",faillurePageImport:"{0}massivesynchro/upload/result?success=false",eServiceError:"{0}/enovia/eServiceError.jsp",removefile:"{0}environment/removefile",platformInvite:"{0}platform/invite",userSupportMode:"{0}user/supportmode",massiveSynchroStart:"{0}massivesynchro/start",massiveSynchroFile:"{0}massivesynchro/file"},formatUrl:function(f){if(b.proxy.baseUrl===""){b.proxy.baseUrl=a.getApplicationConfiguration("app.urls.myapps");if(!b.proxy.baseUrl){a.getAllApplicationConfigurations(true);b.proxy.baseUrl=a.getApplicationConfiguration("app.urls.myapps")}b.proxy.baseUrlBackend=b.proxy.baseUrlBackend.format(b.proxy.baseUrl)}return f.format(b.proxy.baseUrlBackend)}};return{get:function(f){return(b.proxy[f])?b.formatUrl(b.proxy[f]):""},getUrl:function(f){return(b.proxy[f])?b.formatUrl(b.proxy[f]):""},createLicensesUser:function(g,f){return new c({url:b.formatUrl(b.proxy.licensesUser),params:g,callbacks:f}).create()},updateLicensesUser:function(g,f){return new c({url:b.formatUrl(b.proxy.licensesUser),params:g,callbacks:f}).update()},deleteLicensesUser:function(f){return new c({url:b.formatUrl(b.proxy.licensesUser),params:f.params||{},callbacks:f.callbacks||{}}).doDelete()},removeAllRoles:function(f){return new c({url:b.formatUrl(b.proxy.removeAllRoles),params:f.data||{},callbacks:f.callbacks||{}}).doDelete()},removeFile:function(g,f){return new c({url:b.formatUrl(b.proxy.removefile),params:g,callbacks:f}).get()},getPreferences:function(g,f){g=e.merge({responseType:"text"},g);return new c({url:b.formatUrl(b.proxy.getpreferences),params:g,callbacks:f}).get()},setSupportMode:function(f){return new c({url:b.formatUrl(b.proxy.userSupportMode),params:f.params,callbacks:f.callbacks}).create()},platformInvite:function(g,f){return new c({url:b.formatUrl(b.proxy.platformInvite),params:g,callbacks:f}).create()},startImport:function(f){return new c({url:b.formatUrl(b.proxy.massiveSynchroStart),params:f.params||{},callbacks:f.callbacks||{}}).post()},getImportFile:function(f){return new c({url:b.formatUrl(b.proxy.massiveSynchroFile),params:f.params||{},callbacks:f.callbacks||{}}).get()},createLicensesGroup:function(g,f){return new c({url:b.formatUrl(b.proxy.groupRole),params:g,callbacks:f}).create()},updateLicensesGroup:function(g,f){return new c({url:b.formatUrl(b.proxy.groupRole),params:g,callbacks:f}).update()},deleteLicensesGroup:function(f){return new c({url:b.formatUrl(b.proxy.groupRole),params:f.params||{},callbacks:f.callbacks||{}}).doDelete()}}});define("DS/PlatformManagement/Collection/ProcessCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/ProcessModel"],function(c,b,a){return b.extend({url:"role",model:a,parse:function(d){this.setMaxLimit(d.count);return d.data||d.roles},toJSONString:function(d){var e=[];this.forEach(function(f){var g={id:f.get("uid")};if(c.is(f.get("licensed"))){g.licensed=f.get("licensed")}if(d===false){g.licensed=false}e.push(g)});return JSON.stringify(e)}})});define("DS/PlatformManagement/Model/PreferencesModel",["UWA/Core","UWA/Class/Model","UWA/Utils","DS/PlatformAPI/PlatformAPI","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Utils","DS/i3DXCompassCore/CacheManager"],function(d,a,c,i,h,f,e){var g="pm-preferences",b=a.extend({backendModel:new a(),defaults:{membersMaxPerPage:"25",membersSortField:"Last Name",membersSortDirection:"asc",membersDisplayPicture:"true",processesMaxPerPage:"25",processesSortDirection:"asc",advancedMode:false,displayMode:"grid"},getWidgetKey:function(){return"displayMode-"+f.getWidget().id+(f.isLightweight()?"light":"")},isGridLayout:function(){if(!this._displayMode){this._displayMode=e.getCache(this.getWidgetKey(),0)||this.get("displayMode")}return this._displayMode==="grid"},shouldLoadPicture:function(){return this.get("membersDisplayPicture")===true||this.get("membersDisplayPicture")==="true"},setLayout:function(j){this._displayMode=j;e.setCache(this.getWidgetKey(),j);f.getWidget().setValue("displayMode",j)},isFetched:false,setup:function(){this.createUid();return this},createUid:function(){this.id=e._getKeyUID(g);return this.id},sync:function(m,l,j){var k=this;switch(m){case"read":if(k.isFetched||this.fetchLocal()){k.isFetched=true;j.onComplete.call(k)}else{this.fetchRemote(j.onComplete)}break}},fetchLocal:function(){var j=false,k;try{k=sessionStorage.getItem(this.id);if(k){this.set(JSON.parse(k));j=true}}catch(l){d.log(l)}return j},fetchRemote:function(k){var j=this;h.getPreferences({name:g},{onComplete:function(m){var l;if(m!==""){l=JSON.parse(c.base64Decode(m.replace("_","=")));if(l){j.set(l);this.isFetched=false}}j.saveLocal();k.call(j)}})},saveLocal:function(){var j=false;try{sessionStorage.setItem(this.id,JSON.stringify(this.toJSON()));j=true}catch(k){d.log(k)}return j},clear:function(){var j=this._parent();try{sessionStorage.removeItem(this.id)}catch(k){d.log(k)}this.isFetched=false;this.set(this.defaults);return j}});return new b()});define("DS/PlatformManagement/Model/MemberDetailsModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/WebappsUtils/WebappsUtils","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/Data"],function(e,d,c,b,a){return d.extend({url:"user",idAttribute:"id",defaults:{user:"",firstname:"",lastname:"",email:"",platform:"",platformName:"",role:"",agreement:"",active:null,supportMode:null,legal:null,processes:null,apps:null,remove:true,deny:false},setup:function(f,g){if(this.get("email")){this.set("email",this.get("email").toLowerCase())}return this._parent(f,g)},getUserFullName:function(g){var h=this.escape("firstname")?e.String.ucfirst(this.escape("firstname")):"",f=this.escape("lastname")?e.String.ucfirst(this.escape("lastname")):"",i="";if(h===""){h=this.escape("firstName")?e.String.ucfirst(this.escape("firstName")):""}if(f===""){f=this.escape("lastName")?e.String.ucfirst(this.escape("lastName")):""}if(h.trim()!==""&&f.trim()!==""){i=h.trim()+" "+f.trim()}else{if(this.escape("email")&&this.escape("email").trim()!==""){i=this.escape("email").trim()}else{if(this.escape("id")&&this.escape("id").trim()!==""){i=this.escape("id").trim()}}}if(g&&this.escape("id").length<=4){i=i+" - "+this.escape("id").toUpperCase()}return i},getUserId:function(){return this.get("id")||this.get("id")||this.get("email").toLowerCase()},getProfile:function(h,i){var g,f="{0}/api/media/streammediasprite/idList/{1}?{2}";if(!h||i===""||!e.is(i)){g=b.isCheckedAgreement(this.get("agreement"))?"default-profile-contractor.png":"default-profile.png";g=c.getWebappsAssetUrl("PlatformManagement","")+g}else{g=e.String.format(f,i,this.getSpriteItem(),this.get("cacheBuster")?""+this.get("cacheBuster"):this.get("agreement"))}return g},getSpriteItem:function(){return(this.get("firstname")===""?this.get("email"):this.get("id"))+":7:6"},isDeny:function(){return this.get("role")==="2"},isContractor:function(){return b.isCheckedAgreement(this.get("agreement"))},isCasual:function(){return this.get("casual")>0},isRoleOnly:function(){return this.get("granted")&&!this.get("licensed")},removeLicense:function(g,f,h){a.deleteLicensesUser(e.merge({params:{user:this.get("id"),licenses:f.canCrossCompany()?JSON.stringify([{id:g.get("uid"),licensed:g.get("licensed"),restricted:g.get("restricted")}]):JSON.stringify([{id:g.get("uid")}]),type:g.getType()}},{callbacks:h}))},addLicense:function(h,g,f,i){a.createLicensesUser({user:this.get("id"),licenses:JSON.stringify(h),type:g,platform:f.getId()},i)},updateLicense:function(h,g,f,i){a.updateLicensesUser({user:this.get("id"),licenses:JSON.stringify(h),type:g,platform:f.getId()},i)}})});define("DS/PlatformManagement/Modal/FullScreenModal",["UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/PlatformManagement/Utils","DS/UIKIT/Scroller","UWA/Class/View"],function(h,d,g,e,c,f){var b="<h3>{0}</h3>",a=function(i){return h.is(i,"string")&&!/<[\s\S]*>/i.test(i)};return d.extend({init:function(i){i.className=h.String.format(e.getPlatformManagementWrapperClassName("modal-scrollable big-modal {0}"),i.className||"");if(a(i.header)){i.header=h.String.format(b,i.header)}return this._parent(i)},setHeader:function(i){if(a(i)){i=h.String.format(b,i)}return this._parent(i)},setBody:function(i){if(i instanceof f){i=i.getContent()}return this._parent(new c({element:h.createElement("div",{"class":"scrollable-body",styles:{height:"100%"},html:i})}))},_isMasked:function(){return this.masked},mask:function(){if(!this._isMasked()){g.mask(this.getBody());this.masked=true}},unmask:function(){if(this._isMasked()){g.unmask(this.getBody())}this.masked=null}})});define("DS/PlatformManagement/Modal/PrereqError",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Model/ProcessModel","DS/UIKIT/Input/Button","DS/PlatformManagement/Utils"],function(g,f,c,e,b,a,d){return f.extend({defaultOptions:{prereq:[],onCancel:function(){},onRemovedRequired:function(){}},needed:false,disableOKButton:false,clickOkPressed:false,requiredByOption:0,requiredByAnd:0,init:function(h){var i=this;i._parent(h);this.modal=new c({closable:true,className:d.getPlatformManagementWrapperClassName(""),header:"",body:"",footer:"",events:{onHide:function(){i.options.onCancel(i.asRemovedRequired);this.destroy();d.manageSupportOfMultiModal()}}});this.elements.container=this.modal;if(!i.options.model.isTPA()){i.options.selectedCollection.forEach(function(j){if(j.get("prereq")){if(j.get("prereq")&&!j.get("prereq").empty&&j.get("prereq").type==="and"){j.get("prereq").process.forEach(function(k){if(i.options.model.get("uid")===k.uid){i.options.prereq.push(j);i.requiredByAnd++}})}else{if(j.get("prereq")&&!j.get("prereq").empty&&j.get("prereq").type==="or"){j.get("prereq").process.forEach(function(k){if(i.options.model.get("uid")===k.uid){i.options.prereq.push(j)}if(i.options.selectedCollection.get(k.uid)){i.requiredByOption++}})}}}});if(i.options.prereq.length>0&&(i.requiredByOption<=1||i.requiredByAnd>0)){i.needed=true}}},_findRequiredRoles:function(j,o,l){l.push(j.get("uid"));if(j._hasPrereq()){var h=j.get("prereq").process;for(var k=0;k<h.length;k++){var m=new b(h[k]);if(m.get("uid")===o){return m}var n=this._findRequiredRoles(m,o,l);if(n){return n}}}return false},_removeRequired:function(){var h=this,j=this.options.selectedCollection,k=this.options.model.get("uid"),i=[];j.forEach(function(m){var l=[];if(h._findRequiredRoles(m,k,l)){l.forEach(function(n){i.push(n)})}});i.push(k);j.remove(i);return i},isNeeded:function(){return this.needed},show:function(){this.modal.setHeader(this.getTitle());this.modal.setBody(this.getContent());this.modal.setFooter(this.getButtons());this.modal.inject(document.body).show()},getTitle:function(){var h=this.options.model.get("option")?g.i18n("This option is required by"):g.i18n("This role is required by");return"<h3>"+h+"</h3>"},getContent:function(){var i=this,h=[];this.options.prereq.forEach(function(j){h.push(i.getContentItem(j))});return[g.createElement("table",{"class":"table",html:h}),{"class":"text-error text-right",text:g.i18n("You need to remove required roles first")}]},getContentItem:function(h){return{tag:"tr",html:[{tag:"td",html:new e({className:"primary",type:"checkbox",name:"prereq-licenses[]",value:h.get("uid"),label:h.get("name"),checked:false,disabled:true})}]}},getButtons:function(){var i=this,h=[];if(this.options.removeRequired){h.push(new a({value:g.i18n("Remove required roles"),className:"default",events:{onClick:function(){i.asRemovedRequired=true;i.options.onRemovedRequired(i._removeRequired());i.destroy()}}}))}h.push(new a({value:g.i18n("Cancel"),className:"default",events:{onClick:function(){i.modal.hide()}}}));return h}})});define("DS/PlatformManagement/Collection/MemberCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/MemberDetailsModel"],function(d,a,c){var b="user";return a.extend({url:b,model:c,sync:function(g,f,e){return this._parent(g,f,e)},parse:function(e){this.setMaxLimit(e.count);if(e.tag){this.setTags(e.tag)}return e.data||e.users},setTags:function(e){this.tags=e},getTags:function(){return this.tags}})});define("DS/PlatformManagement/Model/PlatformModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Utils"],function(c,b,a){return b.extend({url:"platform",getId:function(){return this.get("id")},canCrossCompany:function(){return this.get("crossCompany")},canCrossCompanyExtended:function(){return this.get("crossCompanyExtended")},getCrossCompanyRoles:function(){return this.get("crossCompanyRoles")||[]},isOnPremise:function(){var d=this.get("isOnPremise");if(d===undefined&&this.get("id")){d=this.get("id").toLowerCase()==="OnPremise".toLowerCase()}return d},hasError:function(){return a.isBetaModeActivated("subscription-error")||this.get("subscriptionError")},isPlatform:function(){return this.get("platform")===true},isVPC:function(){return this.get("vpc")===true},})});define("DS/PlatformManagement/Collection/UserRoleCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/ProcessModel"],function(d,c,b){var a=6;return c.extend({url:"user/roles",model:b,setup:function(e,f){this.setLimit(a);return this._parent(e,f)},parse:function(e){this.setMaxLimit(e.count);return e.data||e.roles}})});define("DS/PlatformManagement/Model/OldMembersModel",["UWA/Core","DS/PlatformManagement/Model/MemberDetailsModel"],function(b,a){return a.extend({url:"user/anonymized",isAnonymised:function(){return this.get("anonymised")===true}})});define("DS/PlatformManagement/Model/AppModel",["UWA/Core","DS/PlatformManagement/Model/ProcessModel"],function(b,a){return a.extend({url:"app/custom"})});define("DS/PlatformManagement/Collection/AppsCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/AppModel"],function(c,b,a){return b.extend({url:"app/custom",model:a,parse:function(d){this.setMaxLimit(d.count);return d.data}})});define("DS/PlatformManagement/Utils/TaggerManager",["UWA/Core","UWA/Class","DS/TagNavigatorProxy/TagNavigatorProxy","DS/PlatformManagement/Model/TagModel"],function(d,a,c,b){return a.singleton({model:new b(),memberList:null,setup:function(e){if(e){this.taggerProxy=c.createProxy({widgetId:e.id,filteringMode:"WithFilteringServices",proxyDisplayName:"PlatformManagement-"+e.id,events:{addFilterSubjectsListener:this._addFilterSubjectsListener.bind(this)}})}return this},fetch:function(g,f){var e=this;this.listRoles=g;this.memberList=f;if(this.taggerProxy){this.model.fetch({data:{platform:this.memberList.collection.options.data.platform},onComplete:function(){e._buildTags()}})}return this},_buildTags:function(){var f=this.taggerProxy,g=f.getCurrentFilter(),e=false;if(g&&d.is(g.allfilters,"object")){e=Object.keys(g.allfilters).length>0}if(f&&g&&(!e||!this.setSubjectsTagsDoneOnce)){this.setSubjectsTagsDoneOnce=true;f.setSubjectsTags(this._getTags())}},_getTags:function(){var h=this,f=this.model,e={},g={roles:{0:f.get("admin"),1:f.get("member"),2:f.get("denied")},status:{0:f.get("active"),1:f.get("pending")},agreements:{0:f.get("employee"),1:f.get("contractor")}};this.listRoles.roles.forEach(function(i){e=d.merge(e,h._buildTag(g.roles[i.id],i.name,d.i18n("User rights"),"role-"+i.id))});this.listRoles.status.forEach(function(i){e=d.merge(e,h._buildTag(g.status[i.id],i.name,d.i18n("Status"),"status-"+i.id))});this.listRoles.agreements.forEach(function(i){if(i.id!=="0"){e=d.merge(e,h._buildTag(g.agreements[i.id],i.name,d.i18n("Agreement"),"agreement-"+i.id))}});return e},_buildTag:function(j,f,h,k){var g,e={};for(g=0;g<j;g++){e[k+"-"+g]=[{object:k,sixw:"ds6w:what",field:"owner",dispValue:f}]}return e},_resetCollectionFilter:function(){this.memberList.collection.setParams({access:null,status:null,agreement:null});this.memberList.collection.setOffset(null)},_convertFilterToParams:function(i){var j,f,h=[],g=[],e=[];if(d.is(i.allfilters)&&d.is(i.allfilters["ds6w:what"])&&i.allfilters["ds6w:what"].length>0){i.allfilters["ds6w:what"].forEach(function(k){f=k.object;if(k.object.contains("role")){h.push(f.replace("role-",""))}else{if(k.object.contains("status")){e.push(parseInt(f.replace("status-",""),10))}else{if(k.object.contains("agreement")){g.push(f.replace("agreement-",""))}}}});if(h.length>0||e.length>0||g.length>0){j={access:h.join(",")||null,status:e.join(",")||null,agreement:g.join(",")||null}}}return j},syncFilter:function(g){var f,e=this.taggerProxy&&this.taggerProxy.getCurrentFilter?this.taggerProxy.getCurrentFilter():"";this.memberList=g;if(e){f=this._convertFilterToParams(e);if(e.allfilters&&Object.keys(e.allfilters).length>0&&f===null){this.memberList.collection.setQuery(JSON.stringify(e.allfilters))}else{this.memberList.collection.setParams(f||{})}}},_addFilterSubjectsListener:function(e){var f;this._filter=e;this._resetCollectionFilter();f=this._convertFilterToParams(e);if(e.allfilters&&Object.keys(e.allfilters).length>0&&f===null){this.memberList.collection.setQuery(JSON.stringify(e.allfilters))}else{this.memberList.collection.setParams(f||{})}this.memberList.refresh()}})});define("DS/PlatformManagement/Views/LocationView",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Select","DS/PlatformManagement/Controls/PlatformNotify"],function(g,d,c,f,e,a){var b=[];return d.extend({tagName:"div",_className:"location-view",setup:function(h){this.options=h||{};if(h.platform){this.platform=h.platform}else{throw ("A platform need to be set")}if(!this.hasLocations()&&this.platform.get("locations")){b=this.platform.get("locations")}return this._parent(h)},render:function(){if(this.hasLocations()){this.container.setContent(this._getTemplate()).addClassName(this._className+(this.options.layout?" "+this.options.layout:""))}return this},hasLocations:function(){return b.length>1},getValue:function(){var h=this.hasLocations()?this.container.getElement("[name=location]"):null;return h?h.value:null},_getTemplate:function(){var j=this,h,i=[];b.forEach(function(k,l){i.push({value:k.id,label:k.name,selected:(j.model&&j.model.get("location")===k.id)||l===0})});h=new e({attributes:{name:"location",id:"location-"+this.id},placeholder:false,options:i,events:{onChange:function(){if(j.model){c.mask(j.container);j.model.save({user:j.model.get("id"),location:j.getValue(),platform:j.options.platform.getId()},{patch:true,onComplete:function(k,l){c.unmask(j.container);a.success(l.message)},onFailure:function(k,l){c.unmask(j.container);a.alert(l.message)}})}}}});return[{tag:(this.options.layout==="invite")?"label":"h5",html:this.options.text||g.i18n("Select user location")+" <em>"+g.i18n("(Used to optimize performances)")+"</em>"},h]}})});define("DS/PlatformManagement/Utils/ImageUploader",["UWA/Core","UWA/Class","UWA/Class/Events","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/PlatformNotify"],function(h,c,b,g,d,f,a){var e=["png","jpeg","jpg","gif","svg"];return c.extend(b,{defaultSrc:null,actions:[],className:"image-uploader",elements:{},init:function(i){var j=this;this.defaultSrc=i.defaultSrc;this.src=i.src;if(i.className){this.className=i.className}if(i.disabled){this.disabled=i.disabled}this.actions=[{id:"upload",title:h.String.format(h.i18n("Upload, {0}"),this._getAllowedExtension()),handler:function(){j.openFile()}},{id:"trash",title:h.i18n("Delete"),handler:function(){j.setValue(j.defaultSrc);j.container.getElement(".input-file-hidden").setContent(j.buildUploadIcon());j._hideTrashAction();j.dispatchEvent("onHideTrashAction")}}];this.width=i.width||64;this.height=i.height||64;this.imgWidth=i.imgWidth||120;this.imgHeight=i.imgHeight||120},_hideTrashAction:function(){if(this.container){if(this.container.getElements(".actions")[0]){this.container.getElements(".actions")[0].setStyle("height",this.height)}if(this.container.getElements(".actions")[1]){this.container.getElements(".actions")[1].addClassName("hidden")}}},_showTrashAction:function(){if(this.container){if(this.container.getElements(".actions")[0]){this.container.getElements(".actions")[0].setStyle("height",this.height/this.actions.length)}if(this.container.getElements(".actions")[1]){this.container.getElements(".actions")[1].removeClassName("hidden")}}},_manageFiles:function(m){var l=this,j=this.container.getElement(".preview-icon"),k=j.getParent("div"),i=new FileReader(),o,n="";if(m.length>0){if(this._isFile(m)){n=m[0].name}else{n=m}o=f.getFileExtension(n);if(e.indexOf(o)>-1){g.mask(k,"");if(this._isFile(m)){i.readAsDataURL(m[0]);i.onload=function(p){l._manageImage(p.target.result,j,k)}}else{l._manageImage(n,j,k)}}else{a.alert(l._getAllowedExtension())}}else{}},_getAllowedExtension:function(){return h.String.format(h.i18n("Allowed extensions are .{0}"),e.join(", ."))},_isFile:function(i){return i[0]&&i[0].name},_manageImage:function(l,i,j){var k=this;setTimeout(function(){var m=new Image();if(l.indexOf("data:")!==0){m.crossOrigin="Anonymous"}m.onload=function(){var n=document.createElement("canvas"),o,p;n.width=m.width;n.height=m.height;n.getContext("2d").drawImage(m,0,0);o=m.width>m.height?k.imgWidth/m.width:k.imgHeight/m.height;if(o<0||o>1){o=1}p=f.downScaleCanvas(n,o);i.src=p.toDataURL();k.imageIsValid=true;k.dispatchEvent("onChange",i.src);k._showTrashAction();k.dispatchEvent("onShowTrashAction");g.unmask(j,"")};m.onerror=function(){g.unmask(j,"");a.alert(h.i18n("The selected file is not a valid Image"))};m.src=l},100)},onChange:function(){},_buildActions:function(){var i=this,j=[];this.actions.forEach(function(l,k){j.push(i._buildAction(l,k))});return j},_buildAction:function(l,i){var k=this,j=h.createElement("div",{"class":"actions",styles:{top:(this.height/this.actions.length)*i,height:this.height/this.actions.length,width:this.width},html:{"class":h.String.format("fonticon fonticon-{0} pointer action-icon",l.id)},events:{click:function(){l.handler();k.container.removeClassName("hover")}}});if(l.title){new d({target:j,body:l.title,position:"right"})}return j},_getSrc:function(){return this.src||this.defaultSrc},render:function(){var k=this,j=this.buildUploadIcon(),i=[];if(!this.disabled){i.push(this._buildActions())}i.push({tag:"img",src:this._getSrc(),"class":"preview-icon"+(this.disabled?"":" pointer"),events:this.disabled?{}:{click:function(){j.click()},error:function(){this.setAttribute("src",k._getSrc())}}});i.push({"class":"hidden input-file-hidden",html:j});this.container=h.createElement("div",{styles:{width:this.width,height:this.height},"class":this.className,events:this.disabled?{}:{mouseenter:function(){this.addClassName("hover")},mouseleave:function(){this.removeClassName("hover")},touchstart:function(l){if(this.hasClassName("hover")){return true}else{this.addClassName("hover");l.preventDefault();l.stopPropagation();return false}},dragover:function(l){l.preventDefault()},drop:function(l){l.preventDefault();k._manageFiles(l.dataTransfer.getData("URL")||l.dataTransfer.files)}},html:i});if(this._getSrc()===this.defaultSrc){this._hideTrashAction();this.dispatchEvent("onHideTrashAction")}return this.container},openFile:function(){this.elements.input.click()},setValue:function(i){if(this.container){this.container.getElement(".preview-icon").src=i===""?this.defaultSrc:i}},getBase64Value:function(){return this.container.getElement(".preview-icon").src.replace(":443/","/")===this.defaultSrc.replace(":443/","/")?"":this.container.getElement(".preview-icon").src},setDisabled:function(i){this.disabled=i},buildUploadIcon:function(){var i=this;this.elements.input=h.createElement("input",{type:"file","class":"hidden",events:{change:function(){i._manageFiles(this.files)}}});return this.elements.input}})});define("DS/PlatformManagement/Model/CreditAndTokenModel",["UWA/Core","DS/PlatformManagement/Model/ProcessModel"],function(b,a){return a.extend({})});define("DS/PlatformManagement/Model/I18nModel",["DS/i3DXCompassCore/Model/i3DXCompassModel","DS/i3DXCompassCore/CacheManager","DS/PlatformManagement/Utils"],function(c,a,b){return c.extend({setup:function(d){this._parent(d,{cache:-1});this.url=this.formatUrl(UWA.String.format("assets/lang/{0}.json",b.getLang())).replace("resources/AppsMngt","webapps/PlatformManagement")}})});define("DS/PlatformManagement/Views/UserRowView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Utils","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Model/PreferencesModel","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","UWA/Event"],function(e,b,f,i,d,h,a,k){var j="-1",g="3",c="Contractor";return b.extend({tagName:"tr",domEvents:{click:"_onClick"},setup:function(){this.firstRender=true;this.listenTo(this.model,{onChange:this.render});this.container.setAttribute("data-type","user");this.container.setAttribute("data-id",this.model.get("id"));this.container.setAttribute("data-cross-company",!this.model.get("licensed"));this.container.setAttribute("data-casual",this.model.get("casual"));return this._parent.apply(this,arguments)},render:function(){this.container.setContent(this.createContent());this._injectPresence();return this},getRoleLabel:function(){var m;if(!this.model.isDeny()&&this.model.isContractor()){m={id:j,name:e.i18n(c)}}else{var l=this.model.get("role");m=e.Array.detect(this.options.roles,function(n){return n.id===l})}return(m&&m.name)||""},createImage:function(){var l;if(this.firstRender&&this.options.getSwymUrl()!==""&&d.shouldLoadPicture()){l=f.getAsset("s.gif");this.firstRender=false}else{l=this.model.getProfile(d.shouldLoadPicture(),this.options.getSwymUrl())}return l},_onClick:function(n){var l=this.getContent(),m=!l.hasClassName("selected");k.stop(n);l.toggleClassName("selected",m);this.toggleSelect.setCheck(m);this.options.onSelect.call(this,l,this.model)},createContent:function(){var l=this.model,m=this.getFooterText();this.toggleSelect=new i({className:"primary inline",type:"checkbox",name:"users[]",value:l.get("id"),id:l.get("id"),label:""});return[{tag:"td",html:[this.toggleSelect,{"class":"img-wrapper",html:{tag:"img",styles:{height:"100%"},src:this.createImage()}},this.model.get("licensed")===false?{tag:"i","class":"fonticon fonticon-key"}:null]},{tag:"td","class":"text-ellipsis",html:this.model.get("active")&&l.get("firstname")?e.String.ucfirst(l.get("firstname")):[{tag:"span",text:e.i18n("Pending")},{tag:"span",html:m}]},{tag:"td","class":"text-ellipsis",html:this.model.get("active")&&l.get("lastname")?[{tag:"span",text:e.String.ucfirst(l.get("lastname"))},{tag:"span",html:m}]:""},{tag:"td",html:[{tag:"span","class":(!this.model.isDeny()&&this.model.isContractor())?f.getRoleColor(g,true):f.getRoleColor(l.get("role"),true),text:this.getRoleLabel()}]},{tag:"td","class":"text-ellipsis",text:l.get("email")},{tag:"td",html:this._buildAction()}]},_injectPresence:function(){var n=this,l=this.model,m=e.createElement("div",{"class":"presence-wrapper"});m.inject(this.container.getElement(".img-wrapper"));if(f.isBetaModeActivated("RTPresence")){f.getParentModule("DS/RTPresenceAPI/RTPresenceAPI",function(o){new o({login:l.get("id"),button:false,username:l.getUserFullName(),tenant:n.options.platform,content:m})})}},getFooterText:function(){var m=null,l=this.model;if(l.isCasual()){m=e.String.format(e.i18n("(Casual usage)"),l.get("casual"))}return m!==null?{tag:"span","class":"contractor-text",text:m}:null},_buildAction:function(){var n=this,l=this.model,m;if(l.actions.length===1){m=l.actions.map(function(p){var o=e.createElement("div",{tag:"div","class":"action-container single-action",html:{"class":"action-icon-wrapper",html:{tag:"i","class":p.icon}},events:{click:function(q){k.stop(q);n.options.onActionClick(p,n,q)}}});new h({position:"bottom",target:o,body:p.title});return o})}else{m=e.createElement("div",{tag:"div","class":"action-container single-action",html:{"class":"action-icon-wrapper",html:{tag:"i","class":"fonticon fonticon-down-open"}},events:{click:function(o){k.stop(o)}}});new a({target:m,items:l.actions.map(function(o){return{text:o.title,icon:o.icon,handler:function(p){n.options.onActionClick(o,n,p)}}})})}return m}})});define("DS/PlatformManagement/Collection/OldMembersCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/OldMembersModel"],function(c,b,a){return b.extend({url:"user/deleted",model:a,parse:function(d){this.setMaxLimit(d.count);return d.data}})});define("DS/PlatformManagement/Modal/FullScreenIdCardModal",["UWA/Core","DS/PlatformManagement/Modal/FullScreenModal"],function(b,a){return a.extend({init:function(c){if(!c.className){c.className=""}c.className="modal-id-card "+c.className;return this._parent(c)}})});define("DS/PlatformManagement/Model/ImportModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Collection/PaginatedCollection"],function(f,e,b){var d=0,a=3,c=4;return e.extend({url:"massivesynchro",_users:null,_status:null,canRetry:function(){return this.get("status")!==d&&this.get("status")!==c&&this.get("status")!==a},inProgress:function(){return this.get("status")===a},fileUploadError:function(){return this.get("status")===c},setup:function(){var g=this;this._parent.apply(this,arguments);this._users=new b([],{url:this.url,data:{offset:0,limit:25}});this._status=new b();this._users.setMaxLimit(this.get("count"));this.addEvent("onChange:users",function(h,i){g._users.set(i)});this.addEvent("onChange:count",function(h,i){g._users.setMaxLimit(i)});this.addEvent("onChange:statuslist",function(h,i){g._status.set(i)})}})});define("DS/PlatformManagement/Modal/ThirdPartyApps",["UWA/Core","UWA/Controls/Abstract","UWA/Controls/Input","UWA/Fx","UWA/Event","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/Mask","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/Tooltip","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/ImageUploader","DS/i3DXCompassCore/RequestOptions","DS/i3DXCompassCore/Utils"],function(c,k,l,d,q,a,r,f,n,g,e,j,o,h,b,p,i,m){return k.extend({id:b.getUUID(),defaultOptions:{appId:null,box:null},content:null,masked:false,init:function(s){this._parent(s);if(s.model){this.model=s.model}this.buildContainer()},buildContainer:function(){var s=this;this.imageUploader=new p({disabled:!this.isEditable(),defaultSrc:i.getBackendAsset("3DExpPlatform_Default.png"),src:m.removeUselessPort(b.escape(this.model.get("icon")))}).addEvent("onShowTrashAction",function(){s.imageUploaderMobile.setValue(s.imageUploader.getBase64Value());s.imageUploaderMobile._showTrashAction()}).addEvent("onHideTrashAction",function(){s.imageUploaderMobile.setValue(s.imageUploader.getBase64Value());s.imageUploaderMobile._hideTrashAction()});this.imageUploaderMobile=new p({disabled:!this.isEditable(),defaultSrc:i.getBackendAsset("3DExpPlatform_Default.png"),src:m.removeUselessPort(b.escape(this.model.get("icon")))}).addEvent("onShowTrashAction",function(){s.imageUploader.setValue(s.imageUploaderMobile.getBase64Value());s.imageUploader._showTrashAction()}).addEvent("onHideTrashAction",function(){s.imageUploader.setValue(s.imageUploaderMobile.getBase64Value());s.imageUploader._hideTrashAction()});this.modal=new a({closable:true,className:"third-party-apps-modal",header:this.getHeader(),body:{"class":"empty-body"},footer:"",events:{onHide:function(){this.destroy()}}});this.elements.container=this.modal;this.elements.container.inject(document.body,"top").show();this.modal.mask();this.model.fetch({data:{id:this.model.get("id"),ui:true},onComplete:function(u,v){var t=v.ui;if(v.app){s.imageUploader.setDisabled(v.app.editable===false);s.imageUploaderMobile.setDisabled(v.app.editable===false)}u.set(v.app);u.unset("ui");u.unset("app");if(v.app){s.editData=u.toJSON();s.editionMode=true}else{s.editData=s.defaultData;s.editionMode=false}s.elements.container.setBody(s.getContent(t));s.elements.container.setFooter(s.getButtons(t));s.modal.unmask();s.updatePreview(s.editData)}})},isInEditionMode:function(){return c.is(this.model.get("id"))},isEditable:function(){return this.model.get("editable")!==false},getHeader:function(){return this.isInEditionMode()?c.i18n("Edit Additional App"):c.i18n("Create Additional App")},getContent:function(s){this.content=c.createElement("div",{html:[this.getForm(s),this.getPreview(s),{"class":"clearfix"}]});return this.content},_showDeleteConfirmation:function(){var t=this,s=new j({closable:false}),u=this._getConfirmDeleteTitle();s.confirm(u,c.i18n("Confirmation"),function(v){if(v){t._delete()}b.manageSupportOfMultiModal()})},_getConfirmDeleteTitle:function(){var t,s=b.getTextFromHtml(this.model.get("name"));if(this.model.get("granted")===true){t=c.String.format(c.i18n("Warning this Additional App is currently granted to members, are you sure you want to remove {0} Additional App?"),s)}else{t=c.String.format(c.i18n("Are you sure you want to remove {0} Additional App?"),s)}return t},_delete:function(){var s=this;this.modal.mask();this.model.destroy({data:{id:this.model.get("id")},wait:true,onComplete:function(t,u){s.modal.unmask();s.elements.container.hide();h.success(u.message);if(s.options.onDelete){s.options.onDelete()}},onFailure:function(){s.modal.unmask();s.showMessages([c.String.format(c.i18n("Unable to remove {0}"),s.model.get("name"))],"error")}})},getButtons:function(){var t=[],v=this,u,s;t.push(new e({className:"primary",value:c.i18n("Save"),events:{onClick:function(){setTimeout(function(){v.validateForm.call(v,true)},100)}}}));if(this.isInEditionMode()){u=new e({value:c.i18n("Remove"),disabled:this.model.get("remove")===false,className:"error",events:{onClick:this._showDeleteConfirmation.bind(this)}});s=c.createElement("div",{"class":"tooltip-wrapper",html:u});t.push(s);if(this.model.get("remove")===false&&this.model.get("helpMessage")){this.tooltip=new o({position:"bottom",target:s,body:this.model.get("helpMessage")})}}t.push(new e({value:c.i18n("Cancel"),className:"default",events:{onClick:function(){v.elements.container.hide()}}}));return t},launchInfosLabelFx:undefined,configUrlFx:undefined,tooltips:{},editData:{},quadrantData:{},defaultData:{displayname:"",icon:"",active:true,"private":false,quadrant:"NORTH",tooltip:"",description:"",type:"Web"},controls:{platforms:[]},imageIsValid:false,getDefault:function(s){return c.is(this.editData[s])?b.getTextFromHtml(this.editData[s]):""},getPreview:function(){var s=c.createElement("div",{tag:"div","class":"preview-title"});this.tooltips.preview=new o({position:"bottom",target:s,body:""});return c.createElement("div",{"class":"third-party-app-preview col-sm-4 col-md-3 col-md-offset-1",html:[{tag:"label",text:c.i18n("Preview")},{tag:"div","class":"panel-preview",html:[{tag:"div","class":"compass-preview",styles:{"margin-top":5,"margin-left":5},html:{tag:"div","class":"compass-preview compass-preview-on "+this.editData.quadrant.toLowerCase()}},{tag:"div","class":"compass-scroll-accordion-section-title has-icon",html:{"class":"compass-scroll-accordion-section-title-wrapper",html:[{tag:"span","class":"compass-scroll-accordion-section-title-icon "+this.editData.quadrant.toLowerCase()},{tag:"span","class":"compass-scroll-accordion-section-title-text",text:""},{tag:"span","class":"compass-scroll-accordion-section-title-arrow fonticon fonticon-down-dir"}]}},{tag:"div","class":"preview-item",html:[this.imageUploader.render(),s]}]}]})},updatePreview:function(t){var u=t.name||t.displayname,s=t.quadrant,v=t.tooltip;if(!this.content){return}if(c.is(u)){this.content.getElement(".preview-title").setText(b.getTextFromHtml(u))}if(c.is(s)){s=s.id||s;if(this.content.getElement(".compass-scroll-accordion-section-title-icon")){this.content.getElement(".compass-scroll-accordion-section-title-icon").className="compass-scroll-accordion-section-title-icon "+s.toLowerCase()}if(this.content.getElement(".compass-preview-on")){this.content.getElement(".compass-preview-on").className="compass-preview compass-preview-on "+s.toLowerCase()}this.content.getElement(".compass-scroll-accordion-section-title-text").setText(this.quadrantData[s])}if(c.is(v)){if(v===""){v=this.content.getElement("[name=display-name]").value}this.tooltips.preview.setBody(b.escape(b.unescape(v)))}},getForm:function(y){var x,t=[],s=[],u,w=this.getDefault("typeId"),v=this;this.formWrapper=c.createElement("div",{"class":"form-wrapper col-sm-8"});x=Object.keys(y.type);x.forEach(function(z){t.push({label:y.type[z].name,value:y.type[z].id,selected:w===y.type[z].id})});u=this.getDefault("quadrant");x=Object.keys(y.quadrant);x.forEach(function(z){if(y.quadrant[z].id!=="PLAY"){s.push({label:y.quadrant[z].name,value:y.quadrant[z].id,selected:u===y.quadrant[z].id});v.quadrantData[y.quadrant[z].id]=y.quadrant[z].name;if(v.defaultData.quadrant.id===y.quadrant[z].id){v.defaultData.quadrantId=s.length-1}}});c.createElement("div",{html:[{"class":"form-group",html:[{tag:"label","for":"display-name"+this.id,html:c.i18n("Short Name")+" <em>"+c.i18n("* (Appears in the Compass)")+"</em>"},new n({value:this.getDefault("name"),disabled:!this.isEditable(),attributes:{maxlength:45,id:"display-name"+this.id,name:"display-name",events:{focus:this._removeError,keyup:function(){v.updatePreview({displayname:this.value})}}}})]},{"class":"form-group",html:[{tag:"label","for":"long-name-"+this.id,html:c.i18n("Long Name")+" <em>"+c.i18n("(Appears in the tooltip)")+"</em>"},new n({value:this.getDefault("tooltip"),disabled:!this.isEditable(),attributes:{name:"long-name",id:"long-name-"+this.id,maxlength:255,events:{focus:this._removeError,keyup:function(){v.updatePreview({tooltip:this.value})}}}})]},{"class":"form-group",html:[{tag:"label","for":"quadrant-"+this.id,text:c.i18n("Compass Quadrant *")},(this.controls.quadrant=new f({options:s,disabled:!this.isEditable(),attributes:{id:"quadrant-"+this.id,name:"quadrant"},placeholder:false,events:{onChange:function(){v.updatePreview({quadrant:this.getValue()[0]})}}}))]},{"class":"form-group xs-visible",html:[{tag:"label","for":"icon-url-"+this.id,text:c.i18n("Icon")},v.imageUploaderMobile.render()]},{"class":"form-group",html:[{tag:"label","for":"type-"+this.id,text:c.i18n("Type *")},(this.controls.type=new f({placeholder:false,options:t,attributes:{id:"type-"+this.id,name:"type"},disabled:this.editionMode||!this.isEditable(),events:{onChange:function(){var z=this.getValue()[0].toLowerCase();v._manageFields(z)}}}))]}]}).inject(this.formWrapper);this.controls["public"]=new g({type:"checkbox",name:"public",checked:!this.getDefault("private"),label:c.i18n("Available to all members"),className:"primary"});c.createElement("div",{html:[{"class":"form-group",html:[{tag:"label","class":"launchinfos-label","for":"launch-infos-"+this.id,text:c.i18n("URL *")},new n({value:this.getDefault("launchinfos"),disabled:!this.isEditable(),attributes:{type:"url",id:"launch-infos-"+this.id,name:"launch-infos",events:{focus:this._removeError}}})]},{tag:"div","class":"configurl-wrapper",styles:{display:this.getDefault("typeId")==="Widget"?"block":"none"},html:[{"class":"form-group",html:[{tag:"label","for":"config-url-"+this.id,text:c.i18n("Configuration file URL")},new n({value:this.getDefault("config"),disabled:!this.isEditable(),attributes:{type:"url",id:"config-url-"+this.id,name:"config-url",events:{focus:this._removeError}}})]}]},{"class":"form-group exe-wrapper hidden",html:[{tag:"label","for":"exe-"+this.id,html:c.i18n("Exe")+" <em>"+c.i18n("* (File must be located within the code\\bin or code\\command directory of a client installation)")+"</em>"},new n({value:this.getDefault("exe"),disabled:!this.isEditable(),attributes:{placeholder:"3DExperience.exe",type:"url",id:"exe-"+this.id,name:"exe",events:{focus:this._removeError}}})]},{"class":"form-group error-wrapper hidden",html:[{tag:"label","for":"error-"+this.id,html:c.i18n("Custom Error Message")+" <em>"+c.i18n("(Used when the exe file is not found)")+"</em>"},new n({value:this.getDefault("error"),disabled:!this.isEditable(),attributes:{maxlength:45,type:"url",id:"error-"+this.id,name:"error",events:{focus:this._removeError}}})]},{tag:"div",html:this.controls["public"]}]}).inject(this.formWrapper);this._buildFx();this._manageFields(w.toLowerCase());return this.formWrapper},_buildFx:function(){var s=this;this.launchInfosLabelFx={newText:"",fx:new d(this.formWrapper.getElement(".launchinfos-label"),{duration:200,unit:"",events:{onComplete:function(){var t=this.element;if(t.getStyle("opacity")===0){t.setContent(s.launchInfosLabelFx.newText);this.start({opacity:[0,1]})}}}}),start:function(t){if(t!==this.newText){this.newText=t;this.fx.start({opacity:[1,0]})}}};this.configUrlFx={fx:new d(this.formWrapper.getElement(".configurl-wrapper"),{duration:200,unit:"",events:{onComplete:function(){var t=this.element,u=t.getElement("input");if(t.getStyle("opacity")===0){t.hide();u.value=""}}}}),show:function(){var t=this.fx.element;if(t.getStyle("display")==="none"){t.show();this.fx.start({opacity:[0,1]})}},hide:function(){var t=this.fx.element;if(t.getStyle("display")==="block"){this.fx.start({opacity:[1,0]})}}}},_manageFields:function(w){var v=this.launchInfosLabelFx,u=this.configUrlFx,t=this.formWrapper.getElement(".exe-wrapper").show(),x=this.formWrapper.getElement(".error-wrapper").show();switch(w){case"web":v.start(c.i18n("URL *"));u.hide();t.addClassName("hidden");x.addClassName("hidden");break;case"widget":v.start(c.i18n("Source code URL *"));u.show();t.addClassName("hidden");x.addClassName("hidden");break;case"native":var s=c.createElement("div",{html:c.i18n("ID")+" <em>"+c.i18n('* (Mandatory if "Exe" field is equal to "3DExperience.exe")')+"</em>"});v.start(s);u.hide();t.removeClassName("hidden");x.removeClassName("hidden");break}},_removeError:function(){var s=this.elements?this.elements.container:this,t=this.content;if(s.hasClassName("uwa-checkbox")&&s.hasClassName("error")){t.getElements(".platform-checkboxes .uwa-checkbox").forEach(function(u){u.removeClassName("error")})}else{s.removeClassName("error")}},validateForm:function(x){var w=this.content,u=w.getElement("[name=exe]").value,s=w.getElement("[name=error]").value,t={id:this.editData.id,type:w.getElement("[name=type]").value,quadrant:w.getElement("[name=quadrant]").value,platforms:this.options.platform.getId(),displayname:w.getElement("[name=display-name]").value.replace(/^\s+|\s+$/g,""),tooltip:w.getElement("[name=long-name]").value.replace(/^\s+|\s+$/g,""),description:"",icon:this.imageUploader.getBase64Value(),launchinfos:w.getElement("[name=launch-infos]").value,config:w.getElement("[name=config-url]").value,visibility:(w.getElement("[name=public]").checked)?"Public":"Private"},v=[];if(u.length!==0){t.exe=u}if(s.length!==0){t.error=s}this.modal.mask();w.getElement("[name=launch-infos]").removeClassName("error");if(t.displayname.length===0){v.push("<b>"+c.i18n("Short Name: ")+"</b>"+c.i18n("This field is required."));w.getElement("[name=display-name]").addClassName("error")}else{if(t.displayname.length<3){v.push("<b>"+c.i18n("Short Name: ")+"</b>"+c.i18n("Minimum 3 characters."));w.getElement("[name=display-name]").addClassName("error")}}if(t.tooltip.length>0&&t.tooltip.length<3){v.push("<b>"+c.i18n("Long Name: ")+"</b>"+c.i18n("Minimum 3 characters."));w.getElement("[name=long-name]").addClassName("error")}if(t.type!=="Native"&&!b.isUrl(t.launchinfos)){if(t.type==="Web"){v.push("<b>"+c.i18n("URL: ")+"</b>"+c.i18n("Must be a valid URL."))}else{v.push("<b>"+c.i18n("Source code URL: ")+"</b>"+c.i18n("Must be a valid URL."))}w.getElement("[name=launch-infos]").addClassName("error")}else{if(t.type==="Native"&&(!t.exe||t.exe==="3DExperience.exe")&&t.launchinfos.length===0){v.push("<b>"+c.i18n("ID: ")+"</b>"+c.i18n("This field is required, if Exe is 3DExperience.exe."));w.getElement("[name=launch-infos]").addClassName("error")}}if(v.length===0){this.clearMessages();this.submitForm(t,x)}else{this.showMessages(v,"error");this.modal.unmask()}},clearMessages:function(){var s=this.content.getElement(".messages");if(s){s.empty();s.fx.start({height:[s.getSize().height,0]})}},showMessages:function(x,u){var w=this.content,s=w.getElement(".messages"),v,t;if(!s){s=c.createElement("div",{styles:{height:0,overflow:"hidden"}}).inject(w.getElement(".form-wrapper"),"top");s.fx=new d(s,{duration:200,unit:"px"})}else{s.empty()}s.className="messages";s.addClassName(u);v=c.createElement("ul");x.forEach(function(y){c.createElement("li",{html:y}).inject(v)});v.inject(s);if(x.length>0){t=v.getElement("li").getSize().height}else{t=0}s.fx.start({height:[s.getSize().height,t*x.length]})},submitForm:function(s,u){var t=this;t.modal.mask();this.model.save(s,{patch:true,onComplete:function(v,w){t.modal.unmask();if(u){t.elements.container.hide();h.success(w.message)}else{t.showMessages([w.message],"success")}if(s.id){s["private"]=s.visibility!=="Public";s.name=b.escape(s.displayname);s.tooltip=b.escape(s.tooltip);t.model.set(s)}else{if(t.options.onAdded){t.options.onAdded()}}},onFailure:function(v){t.modal.unmask();if(v&&v.message){t.showMessages([v.message],"error")}else{t.showMessages([c.String.format(c.i18n("Unable to save {0}"),s.displayname)],"error")}}})}})});define("DS/PlatformManagement/Views/AppsRowView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Utils","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","UWA/Event"],function(g,e,d,f,b,c,a){return e.extend({tagName:"tr",domEvents:{click:"_onClick"},setup:function(){this.listenTo(this.model,{onChange:this.render});if(!this.model.get("private")){this.container.setAttribute("data-public","true")}this.container.setAttribute("data-id",this.model.get("uid"));this.container.setAttribute("data-type","process");this.container.addClassName("tp-apps");return this._parent.apply(this,arguments)},render:function(){this.container.setContent(this.createContent());return this},_onClick:function(j){var h=this.getContent(),i=!h.hasClassName("selected");a.stop(j);h.toggleClassName("selected",i);this.toggleSelect.setCheck(i);this.options.onSelect.call(this,h,this.model)},createContent:function(){var h=this.model;this.toggleSelect=new f({className:"primary inline",type:"checkbox",name:"users[]",value:h.get("id"),id:h.get("id"),label:""});return[{tag:"td",html:[this.toggleSelect,{"class":"img-wrapper",html:{tag:"img",src:h.getIcon()}}]},{tag:"td",text:d.getTextFromHtml(h.get("name"))},{tag:"td",text:h.getDisplayType()},{tag:"td",html:this._buildAction()}]},_buildAction:function(){var j=this,h=this.model,i;if(h.actions.length===1){i=h.actions.map(function(l){var k=g.createElement("div",{tag:"div","class":"action-container single-action",html:{"class":"action-icon-wrapper",html:{tag:"i","class":l.icon}},events:{click:function(m){a.stop(m);j.options.onActionClick(l,j,m)}}});new c({position:"bottom",target:k,body:l.title});return k})}else{i=g.createElement("div",{tag:"div","class":"action-container single-action",html:{"class":"action-icon-wrapper",html:{tag:"i","class":"fonticon fonticon-down-open"}},events:{click:function(k){a.stop(k)}}});new b({target:i,items:h.actions.map(function(k){return{text:k.title,icon:k.icon,handler:function(l){j.options.onActionClick(k,j,l)}}})})}return i}})});define("DS/PlatformManagement/Controls/Tags",["UWA/Core","UWA/Controls/Abstract","UWA/Event","DS/UIKIT/Input/Text","DS/UIKIT/Touch","DS/UIKIT/Spinner","DS/PlatformManagement/Utils"],function(f,g,i,d,c,e,h){var a=13,b="fonticon-cancel";return g.extend({defaultOptions:{text:null,onChange:function(){},onDestroy:function(){}},init:function(j){var k=this;k._parent(j);this.buildContainer()},destroy:function(){this.options.onDestroy();this._parent()},processChange:function(l,k){if(f.is(k.getParent("div"))){var j=(this.getSelected().indexOf(l)===-1);if(this.options.validator(l)&&j){this.options.text=l;k.getParent("div").removeClassName("has-error");this.getContent().setContent(this.setReadInput());this.asyncCheck()}else{k.focus();f.log(k);if(!k.getParent("div").hasClassName("has-error")){k.getParent("div").addClassName("has-error")}console.log("value",l);console.log("old Value",this.oldValue);if(l!==this.oldValue){this.options.onError();this.oldValue=l}}}},setEditInput:function(){var j=this;this.input=new d({value:this.options.text,attributes:{type:"email",styles:{width:j.getContent().getSize().width},events:{keyup:function(k){k.preventDefault();k.stopPropagation();if(k.keyCode===a){j.processChange(this.value,this)}},blur:function(l){var k=this;l.preventDefault();l.stopPropagation();if(f.is(k)){setTimeout(function(){j.processChange(k.value,k)},100)}}}}});this.getContent().setContent(this.input);this.input.focus()},getButton:function(){var j=this;if(!this.button){this.button=f.createElement("button",{"class":"btn btn-default",html:{tag:"span","class":"fonticon fonticon-cancel"},events:{click:function(k){if(this.getElement(".fonticon").hasClassName(b)){j.destroy();i.stop(k)}}}})}return{tag:"span","class":"input-group-btn",html:this.button}},getInputText:function(){var j=this;this.inputText=f.createElement("span",{"class":"form-control",text:this.options.text,events:!h.isTouchActivate()?{dblclick:function(){j.setEditInput()}}:null});if(h.isTouchActivate()){this.touch=new c(this.inputText).on("press",function(k){k.preventDefault();i.stopPropagation(k);j.setEditInput()})}return this.inputText},setReadInput:function(){return f.createElement("div",{"class":"input-group",html:[this.getInputText(),this.getButton()]})},buildContainer:function(){this.elements.container=f.createElement("div",{"class":"uwa-input-tags uwa-input",html:this.setReadInput()})},setLoading:function(k){var j=this.button.getElement(".fonticon");if(k){j.removeClassName(b);this.button.addClassName("is-loading");new e({visible:true}).inject(j)}else{this.button.removeClassName("is-loading");j.addClassName(b);j.setContent("")}},setError:function(l){var k=this.inputText,j=k.getParent("div");if(l){if(!j.hasClassName("has-error")){j.addClassName("has-error")}}else{j.removeClassName("has-error")}this.options.onChange()},asyncCheck:function(){var j=this;if(this.options.validatorAsync){this.setLoading(true);this.options.syncInputSize();this.options.validatorAsync(this.inputText.getText(),{onComplete:function(){j.getContent().setContent(j.setReadInput());j.setLoading();j.setError(false);j.options.syncInputSize()},onFailure:function(){j.setLoading();j.setError(true);j.options.syncInputSize()}})}},getSelected:function(){var j=[];this.elements.container.getParent().getElements(".uwa-input-tags span.form-control").forEach(function(k){j.push(k.getHTML())});return j}})});define("DS/PlatformManagement/Collection/PlatformRoleCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/ProcessModel"],function(d,c,b){var a=6;return c.extend({url:"platform/share/roles",model:b,setup:function(e,f){this.setLimit(a);return this._parent(e,f)},parse:function(e){this.setMaxLimit(e.count);return e.data}})});define("DS/PlatformManagement/Model/GroupModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/WebappsUtils/WebappsUtils","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/Data"],function(e,d,c,b,a){return d.extend({url:"group",membersCollection:null,rowViewExtended:false,getGroupId:function(){return this.get("uuid")},removeLicense:function(g,f,h){a.deleteLicensesGroup(e.merge({params:{group:this.get("uuid"),licenses:f.canCrossCompany()?JSON.stringify([{id:g.get("uid"),licensed:g.get("licensed"),restricted:g.get("restricted")}]):JSON.stringify([{id:g.get("uid")}]),platform:f.getId(),type:g.getType()}},{callbacks:h}))},addLicense:function(h,g,f,i){a.createLicensesGroup({group:this.get("uuid"),label:this.get("label"),licenses:JSON.stringify(h),type:g,platform:f.getId()},i)},updateLicense:function(h,g,f,i){a.updateLicensesGroup({group:this.get("uuid"),licenses:JSON.stringify(h),type:g,platform:f.getId()},i)},isMembersRowViewExtended:function(){return this.rowViewExtended},setRowViewExtended:function(f){this.rowViewExtended=f},setMembersCollection:function(f){this.membersCollection=f},getMembersCollection:function(){return this.membersCollection}})});define("DS/PlatformManagement/Collection/GroupCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/GroupModel"],function(d,c,b){var a=6;return c.extend({url:"group",model:b,setup:function(e,f){this.setLimit(a);return this._parent(e,f)},parse:function(e){this.setMaxLimit(e.count);return e.data||e.roles}})});define("DS/PlatformManagement/Collection/CreditAndTokenCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/CreditAndTokenModel"],function(c,b,a){return b.extend({url:"credits",model:a,parse:function(d){this.setMaxLimit(d.count);return d.data}})});define("DS/PlatformManagement/Views/OldMembersView",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/PlatformManagement/Utils","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Collection/OldMembersCollection","DS/PlatformManagement/Model/OldMembersModel","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Loader","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformAPI/PlatformAPI","UWA/Event","DS/UIKIT/SuperModal","DS/UIKIT/Tooltip","DS/UIKIT/Mask","DS/UIKIT/Touch","DS/UIKIT/Input/Toggle","DS/UIKIT/Iconbar","DS/UIKIT/Spinner","DS/PlatformManagement/Controls/ButtonFab","DS/PlatformManagement/Views/UserRowView","DS/PlatformManagement/Utils/SpriteManager","DS/PlatformManagement/Views/EmptyView","DS/PlatformManagement/Controls/Input/Text"],function(j,u,v,g,i,e,k,h,l,s,f,x,t,w,y,q,r,c,m,n,p,d,o,b){var a="member-list-wrapper";return u.extend({forceRefreshView:false,touchPagerEvent:null,nbSelected:0,nbDeleted:0,noPage:1,lastCollection:null,setup:function(z){this.collection=new e();this.buildContainer()},render:function(){var z=this;if(this.collection.getMaxLimit()>0||this.forceRefreshView){this.lastCollection=new e(this.collection.toJSON());this.lastCollection.setLimit(this.collection.options.data.limit);this.lastCollection.setSortDirection(this.collection.options.data.sort_direction);this.lastCollection.setSortField(this.collection.options.data.sort);this.lastCollection.setPlatform(this.collection.options.data.platform);this.getBody().setContent(this.buildContent())}else{if(this.collection.getMaxLimit()===0&&(this.collection.getQuery()===null||this.collection.getQuery()==="")){this.getBody().setContent(this.buildContent());this.getBody().setContent(new o().render(j.i18n("No removed user")))}else{this.collection.setQuery(null);this.setTitle(j.i18n("No result found"));this.collection=this.lastCollection}}this.unmask();this.forceRefreshView=false;if(this.options.onRefresh){this.options.onRefresh()}},search:function(z){this.collection.setOffset(0);this.collection.setQuery(z);this.refresh()},refresh:function(z){this.setOptions(z);this.nbSelected=0;this.nbDeleted=0;if(z&&z.params){this.collection.setParams(z.params)}this.buildContainer()},getSwymUrl:function(){if(this.options.platform.get("swym")!==""){this.profileUrl=this.options.platform.get("swym")}else{if(!this.profileUrl&&this.options.platform.collection){this.profileUrl=this.options.platform.collection.at(0).get("swym")}else{this.profileUrl=""}}return this.profileUrl},buildContainer:function(){var z=this;if(!this.elements.container){this.elements.container=j.createElement("div",{"class":a});z.elements.container.setContent({"class":"empty-body"})}this.mask();if(this.options.platform&&this.options.platform!==null){i.fetch({onComplete:function(){z.collection.setLimit(i.get("membersMaxPerPage"));z.collection.setSortDirection(i.get("membersSortDirection"));z.collection.setSortField(i.get("membersSortField"));z.collection.setPlatform(z.options.platform.get("id"));z.collection.fetch({onComplete:function(){z.render()},onFailure:function(){z.render()}})}})}},buildContent:function(){var z=[];z.push(this.buildActionHeader());z.push(this.buildTitle(this.collection.getMaxLimit()));z.push({"class":"pm-grid-container layout-table",html:[this.createTableView(),this.buildPager()]});this.initTouchPager();return z},createTableView:function(){var B=this,z=new d({url:B.getSwymUrl()}),A=this.collection.map(function(C){z.addItem(C.getSpriteItem());return B.getRow(C)});if(B.getSwymUrl()!==""&&i.shouldLoadPicture()){A.forEach(function(D,C){z.spritifyElement(D.getElement("img"),C)})}return[{tag:"table","class":"table",html:[{tag:"thead",html:[{tag:"td"},{tag:"td",text:j.i18n("First Name")},{tag:"td",text:j.i18n("Last Name")},{tag:"td",text:j.i18n("E-mail")},{tag:"td",text:j.i18n("Removed by")},{tag:"td",text:j.i18n("Removed on")},{tag:"td",text:j.i18n("Pseudonymised")}]},{tag:"tbody",html:A}]}]},getPseudonymised:function(z){var B=this,A;if(z.isAnonymised()){A={tag:"span",text:j.i18n("Yes"),styles:{color:"#57B847","text-align":"center"}}}else{A=j.createElement("span",{"class":"fonticon fonticon-eye-off",styles:{cursor:"pointer","text-align":"center"},events:{click:function(C){B.showAnonimizeModal("Pseudonymised",z)}}});new w({target:A,position:"bottom",body:j.i18n("Pseudonymise Member")})}return A},getRow:function(A){var B=this,D=A.get("id"),C=A.isAnonymised(),z=new r({className:"primary inline",type:"checkbox",name:"subscriptions[]",value:D,id:D,label:"",});return j.createElement("tr",{"class":"tr-"+D,"data-type":"user",html:[{tag:"td",html:[z,{"class":"img-wrapper",styles:{"float":"right","margin-right":"30%"},html:{tag:"img",styles:{height:"100%","float":"right"},src:this.createImage(A)}}]},{tag:"td","class":"text-ellipsis",html:A.get("firstname")},{tag:"td","class":"text-ellipsis",html:A.get("lastname")},{tag:"td","class":"text-ellipsis",html:A.get("email")},{tag:"td","class":"text-ellipsis",html:A.get("deletedBy"),styles:{color:"#EA4F37"}},{tag:"td","class":"text-ellipsis",html:A.get("deletedOn"),styles:{color:"#EA4F37"}},{tag:"td","class":"status",html:this.getPseudonymised(A),styles:{"text-align":"center"}}],styles:{cursor:"pointer"},events:{click:function(F){x.stop(F);if(F.target.hasClassName("fonticon-eye-off")){return}var E=!z.isChecked();z.setCheck(E);B.initChecked()}}})},setTitle:function(z){if(this.getBody().getElement("h5 span")){this.getBody().getElement("h5 span").setText(j.String.format(j.i18n("Removed members | {0}"),z))}},buildTitle:function(z){return{tag:"h5",html:[{tag:"i","class":"fonticon fonticon-users-delete"},{tag:"span",text:j.String.format(j.i18n("Removed members | {0}"),z)}]}},initTouchPager:function(){var A=this,z;if(!this.touchPagerEvent&&A.pager){this.touchPagerEvent=true;z=new q(A.getBody());z.on("swipeleft",function(){if(A.collection.hasNext()){A.collection.setOffset(A.collection.getNextOffset());A.pager.setOffset(A.collection.getOffset())}});z.on("swiperight",function(){if(A.collection.hasPrevious()){A.collection.setOffset(A.collection.getPreviousOffset());A.pager.setOffset(A.collection.getOffset())}})}},buildPager:function(){var A=this,z=this.collection.getMaxLimit();if(z>A.collection.getLimit()){this.pager=new v({limit:A.collection.getLimit(),offset:A.collection.getOffset(),type:1,pageLinks:10,max:z,showPageLinks:true,length:z,events:{onOffsetChange:function(B){A.mask();A.collection.setOffset(B);A.collection.fetch({onComplete:function(){A.render()}})}}})}else{this.pager=null}return this.pager},getBody:function(){if(!this.content){this.content=this.elements.container}return this.content},mask:function(){if(!this.isMasked()){y.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){y.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked},setStatus:function(A,B){var z=(A)?this.getContent().getElement(".tr-"+g.escapeDomSelector(A.get("id"))+(" .status")):this.getBody();if(z){z.setContent(B)}return true},setLoadingStatus:function(A){var z=A?new m({visible:true}):new l();this.setStatus(A,z)},resetStatus:function(z){var A;if(z.isAnonymised()){A={tag:"span",text:j.i18n("Yes"),styles:{color:"#57B847","text-align":"center"}};this.setStatus(z,A)}},createImage:function(A){var z;if(this.getSwymUrl()!==""&&i.shouldLoadPicture()){z=g.getAsset("s.gif");this.firstRender=false}else{z=A.getProfile(i.shouldLoadPicture(),this.getSwymUrl())}return z},showAnonimizeModal:function(I,C){var E=this,H=new t({closable:false,className:"modal-no-warper"}),B=(!C),F=B?false:C.get("id"),A=B?[]:[F],z=B?[]:[C.cid],D=B?E.elements.container.getElements('[data-type="user"] input'):false,G;I=(I!=="Pseudonymised"&&I!=="Deleted")?"Pseudonymised":I;if(D){D.forEach(function(J){if(J.checked&&I!=="Deleted"&&!E.collection.get(J.id).isAnonymised()){A.push(J.id);z.push(E.collection.get(J.id))}else{if(J.checked&&I==="Deleted"&&E.collection.get(J.id).isAnonymised()){A.push(J.id);z.push(E.collection.get(J.id))}}});if(A[0]){C=E.collection.get(A[0])}}G=(I==="Pseudonymised")?(B&&this.nbSelected>1)?j.String.format(j.i18n("Are you sure you want to pseudonymise these members: {0}? Once executed, this action is irreversible."),z.map(function(J){return J.get("firstname")+" "+J.get("lastname")}).join(", ")):j.String.format(j.i18n("Are you sure you want to pseudonymise {0} {1}? Once executed, this action is irreversible."),C.get("firstname"),C.get("lastname")):(B&&this.nbDeleted>1)?j.String.format(j.i18n("Are you sure you want to delete these members: {0}? Once executed, this action is irreversible."),z.map(function(J){return J.get("firstname")+" "+J.get("lastname")}).join(", ")):j.String.format(j.i18n("Are you sure you want to delete {0} {1}? Once executed, this action is irreversible."),C.get("firstname"),C.get("lastname"));H.confirm(G,j.i18n("Confirmation"),function(J){if(J){for(var K=0;K<A.length;K++){C=E.collection.get(A[K]);E.setLoadingStatus(C)}if(I==="Pseudonymised"){C.save({users:JSON.stringify(A)},{patch:true,onComplete:function(L,N){for(var M=0;M<A.length;M++){C=E.collection.get(A[M]);C.set("anonymised",true);E.resetStatus(C)}E.initChecked();s.success(N.message)},onFailure:function(L,M){E.unmask();s.alert(M.message);E.initChecked();E.refresh()}})}else{if(I==="Deleted"){C.destroy({data:{id:E.options.platform.get("id"),users:JSON.stringify(A)},wait:true,onComplete:function(L,M){s.success(M.message);E.initChecked();E.refresh()},onFailure:function(L,M){E.unmask();s.alert(M.message);E.initChecked();E.refresh()}})}}}else{E.unmask()}})},getModelUserSelected:function(C){var z=false,B=(C==="Deleted"),A=this;if((B&&this.nbDeleted===1)||(!B&&this.nbSelected===1)){this.elements.container.getElements('[data-type="user"] input').forEach(function(D,E){if(!z&&D.checked){if(B&&A.collection.get(D.id).isAnonymised()){z=A.collection.get(D.id);return true}if(!B&&!A.collection.get(D.id).isAnonymised()){z=A.collection.get(D.id);return true}}})}return z},buildIconBar:function(){var z=this,A=new c({items:[{fonticon:"mouse-pointer-check",text:j.i18n("Manage Selection"),innerComponent:{type:"icondropdown",options:(this.nbSelected>0&&this.nbDeleted>0)?{items:[{action:"select-all",fonticon:"files-check",description:j.i18n("Select All"),handler:this._manageSelectionFilter.bind(this)},{action:"deselect-all",fonticon:"files-times",description:j.i18n("Deselect All"),handler:this._manageSelectionFilter.bind(this)},{action:"anonymised-all-members",fonticon:"eye-off",className:"selected",description:j.i18n("Pseudonymise Selected Members"),handler:function(){var B=z.getModelUserSelected("Pseudonymised");z.showAnonimizeModal("Pseudonymised",B)}},{action:"delete-all-members",fonticon:"users-times",className:"selected",description:j.i18n("Delete Selected Members"),handler:function(){var B=z.getModelUserSelected("Deleted");z.showAnonimizeModal("Deleted",B)}}]}:this.nbSelected>=1&&this.nbDeleted<1?{items:[{action:"select-all",fonticon:"files-check",description:j.i18n("Select All"),handler:this._manageSelectionFilter.bind(this)},{action:"deselect-all",fonticon:"files-times",description:j.i18n("Deselect All"),handler:this._manageSelectionFilter.bind(this)},{action:"anonymised-all-members",fonticon:"eye-off",className:"selected",description:j.i18n("Pseudonymise Selected Members"),handler:function(){var B=z.getModelUserSelected("Pseudonymised");z.showAnonimizeModal("Pseudonymised",B)}}]}:(this.nbDeleted>=1&&this.nbSelected<1)?{items:[{action:"select-all",fonticon:"files-check",description:j.i18n("Select All"),handler:this._manageSelectionFilter.bind(this)},{action:"deselect-all",fonticon:"files-times",description:j.i18n("Deselect All"),handler:this._manageSelectionFilter.bind(this)},{action:"delete-all-members",fonticon:"users-times",className:"selected",description:j.i18n("Delete Selected Members"),handler:function(){var B=z.getModelUserSelected("Deleted");z.showAnonimizeModal("Deleted",B)}}]}:{items:[{action:"select-all",fonticon:"files-check",description:j.i18n("Select All"),handler:this._manageSelectionFilter.bind(this)},{action:"deselect-all",fonticon:"files-times",description:j.i18n("Deselect All"),handler:this._manageSelectionFilter.bind(this)}]}}}]});A.elements.container.getElement(".fonticon").setAttribute("data-action","select-mode");return{styles:{"padding-right":8,"float":"right"},html:A}},buildActionHeader:function(){var A=this,z=new b({isCollapsable:true,minChar:3,attributes:{placeholder:j.i18n("Search Members"),value:this.collection.getQuery()||"",events:{keyup:function(){A.search(this.value)}}}});return[{"class":"iconBarDeleteMembers",html:this.buildIconBar(),events:{onClick:function(B){A.initChecked()}}},{styles:{"float":"right"},html:z}]},_manageSelectionFilter:function(E,D){var C=this,z=C.elements.container.getElements('[data-type="user"] input:not([disabled])'),B=C.elements.container.getElement('[data-action="select-mode"]'),A=C.getContent().getElement(".iconBarDeleteMembers");D.elements.container.removeClassName("selected");if(D.action==="select-all"){B.removeClassName("fonticon-mouse-pointer-check").addClassName("fonticon-files-check").getParent("li").addClassName("item-active");if(z){z.forEach(function(F,G){if(!F.checked){F.checked=true}});C.initChecked()}}else{B.removeClassName("fonticon-files-check").addClassName("fonticon-mouse-pointer-check");C.elements.container.getElements('[data-type="user"].selected').invoke("removeClassName","selected");if(z){z.forEach(function(F,G){if(F.checked){F.checked=false}});C.initChecked()}}A.setContent(C.buildIconBar())},showDeleteUser:function(){var z=this.getContent().getElement(".iconBarDeleteMembers");z.setContent(this.buildIconBar()).click()},initChecked:function(){var z=this;z.nbDeleted=0;z.nbSelected=0;this.elements.container.getElements('[data-type="user"] input').forEach(function(A,C){if(A.checked){var B=z.collection.get(A.id);if(B){if(B.isAnonymised()){z.nbDeleted++}else{z.nbSelected++}}}});this.showDeleteUser()}})});define("DS/PlatformManagement/Views/ProcessRowView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Utils","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","UWA/Event"],function(g,e,d,f,b,c,a){return e.extend({tagName:"tr",domEvents:{click:"_onClick"},setup:function(){this.firstRender=true;this.listenTo(this.model,{onChange:this.render});this.container.setAttribute("data-type","process");this.container.setAttribute("data-id",this.model.get("uid"));if(!this.model.isCustom()){this.container.setAttribute("data-casual",this.model.get("casual"))}this.container.setAttribute("data-free",this.model.get("free"));if(this.model.isSelfExp()){this.container.setAttribute("data-trial","")}this.container.setAttribute("data-cross-company",this.model.canCrossCompany());return this._parent.apply(this,arguments)},render:function(){this.container.setContent(this.createContent());return this},_onClick:function(j){var h=this.getContent(),i=!h.hasClassName("selected");a.stop(j);h.toggleClassName("selected",i);this.toggleSelect.setCheck(i);this.options.onSelect.call(this,h,this.model)},createContent:function(){var i=this.model,h=this.options.getTileSubtitle?this.options.getTileSubtitle(i):null;this.toggleSelect=new f({className:"primary inline",type:"checkbox",name:"users[]",value:i.get("uid"),label:""});return[{tag:"td",html:[this.toggleSelect,{"class":"img-wrapper",html:{tag:"img","data-percent":i.getPercent(),src:i.getIcon()}}]},{tag:"td",html:[{tag:"span",text:d.getTextFromHtml(i.get("name"))},h?{tag:"span",html:" "+h}:null]},{tag:"td",text:i.get("apps")},{tag:"td",html:this._getUsed()},{tag:"td",text:i.get("expire")},{tag:"td",html:this._buildAction()}]},_getUsed:function(){var i="",h=this.model;if(h.isSelfExp()){i=g.i18n("Used: {0}").format(h.get("used"))}else{if(!h.isCustom()){i+=g.i18n("Used: {0}/{1}").format((h.get("total")-h.get("free")),h.get("total"))}}return i},_buildAction:function(){var j=this,h=this.model,i;if(h.actions.length===1){i=h.actions.map(function(l){var k=g.createElement("div",{tag:"div","class":"action-container single-action",html:{"class":"action-icon-wrapper",html:{tag:"i","class":l.icon}},events:{click:function(m){a.stop(m);j.options.onActionClick(l,j,m)}}});new c({position:"bottom",target:k,body:l.title});return k})}else{i=g.createElement("div",{tag:"div","class":"action-container single-action",html:{"class":"action-icon-wrapper",html:{tag:"i","class":"fonticon fonticon-down-open"}},events:{click:function(k){a.stop(k)}}});new b({target:i,items:h.actions.map(function(k){return{text:k.title,icon:k.icon,handler:function(l){j.options.onActionClick(k,j,l)}}})})}return i}})});define("DS/PlatformManagement/Views/StepsView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Views/StepView"],function(c,b,a){return b.extend({tagName:"div",className:"steps",render:function(){var f=this,h=[],e=this.collection.size(),d=this.options.stepNumber,g=typeof d==="undefined"?0:(d-1),i=20/(e-1)+"%";this.collection.forEach(function(k,j){var l,m=c.createElement("div",{"class":"transition",styles:{width:i}});l=new a({model:k}).render();f._refreshModel(g,j,k);h.push(l);if(j<e-1){h.push(m)}});this.container.setContent(h);return this},_refreshModel:function(f,e,d){if(f===e){d.set("active",true);d.unset("validated")}else{if(f>e){d.unset("active");d.set("validated",true)}else{d.unset("validated");d.unset("active")}}},setStep:function(d){var e=this,f=typeof d==="undefined"?0:(d-1);this.collection.forEach(function(h,g){e._refreshModel(f,g,h)});return this}})});define("DS/PlatformManagement/Modal/ConfirmSwitchToggle",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Collection/ProcessCollection","DS/UIKIT/Input/Button","DS/PlatformManagement/Utils"],function(g,f,b,e,c,a,d){return f.extend({roleImpacted:[],needed:false,disableOKButton:false,clickOkPressed:false,init:function(i){var j=this,h=i.model,k,l;j._parent(i);this.modalConfirmSwitchToggle=new b({closable:true,className:d.getPlatformManagementWrapperClassName("")+" confirm-switch-toggle",header:"",body:"",footer:"",events:{onHide:function(){if(!j.clickOkPressed){j.options.onCancel()}j.modalConfirmSwitchToggle.destroy()}}});if(j.options.selectedCollection.size()>0){k=h.get("licensed");l=h.get("restricted");this.roleImpacted=j.options.selectedCollection.filter(function(m){return m.isWA()&&!m.isCustom()&&m.get("licensed")!==k});if(this.roleImpacted.length>0){j.needed=true}else{j.needed=false}}else{j.needed=false}},isNeeded:function(){return this.needed},show:function(){var h=this;h.modalConfirmSwitchToggle.setHeader(this.getTitle());h.modalConfirmSwitchToggle.setBody(this.getContent());h.modalConfirmSwitchToggle.setFooter(this.getButtons());h.modalConfirmSwitchToggle.inject(document.body).show()},getTitle:function(){var h="";if(this.options.model.get("licensed")){h=this.options.selectedCollection.size()>1?g.i18n("Assigning this role will automatically assign the following Licenses"):g.i18n("Assigning this role will automatically assign the following License")}else{h=this.options.selectedCollection.size()>1?g.i18n("Assigning this role will automatically unassign the following Licenses"):g.i18n("Assigning this role will automatically unassign the following License")}return"<h3>"+h+"</h3>"},getContent:function(){var i=this,h=[];this.roleImpacted.forEach(function(j){h.push(i.getContentItem(j))});return[g.createElement("table",{"class":"table",html:h})]},getContentItem:function(h){return{tag:"tr",html:[{tag:"td",html:new e({className:"primary",type:"checkbox",name:"prereq-licenses[]",value:h.get("uid"),label:h.get("name"),checked:true,disabled:true})},{tag:"td","class":"confirm-switch-toggle-status",html:!h.get("licensed")?g.i18n("1 license will be assigned"):g.i18n("1 license will be unassigned")}]}},getButtons:function(){var i=this,h=[];h.push(new a({value:g.i18n("Ok"),className:"primary",events:{onClick:function(){i.needed=false;this.clickOkPressed=true;i.modalConfirmSwitchToggle.hide();i.options.onConfirm(i.options.mandatoryPrereq)}}}));h.push(new a({value:g.i18n("Cancel"),className:"default",events:{onClick:function(){i.modalConfirmSwitchToggle.hide();i.options.onCancel()}}}));return h}})});define("DS/PlatformManagement/Modal/Prereq",["UWA/Core","UWA/Controls/Abstract","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Model/ProcessModel","DS/UIKIT/Input/Button","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Utils","DS/PlatformManagement/Modal/ConfirmSwitchToggle","UWA/Event"],function(c,d,g,h,b,e,a,f,j,i){return d.extend({defaultOptions:{prereq:[],onConfirm:function(){},onCancel:function(){},number:1,type:"and"},needed:false,neededConfirmSwitchToggle:false,disableOKButton:false,clickOkPressed:false,content:null,neededPrereq:null,prereqOptionsMissing:true,init:function(m){var n=this,l=m.model,k,p,q,o;this._parent(m);this.model=l;this.selectMode=m.selectMode;if(!l.isTPA()){this.modal=new g({closable:true,header:"",className:f.getPlatformManagementWrapperClassName("prereq-needed"),body:"",footer:"",events:{onHide:function(){if(!n.clickOkPressed){n.options.onCancel()}this.destroy();f.manageSupportOfMultiModal()}}});if(this._asPrereq(l)&&l.get("prereq").type==="or"&&l.get("prereq").process.length===1){l.get("prereq").type="and"}if(this._asPrereq(l)){n.options.prereq=l.get("prereq").process.filter(function(r){return l.get("prereq").type==="and"?!n.options.selectedCollection.get(r.uid):true});if(l.get("prereq").type==="or"){n.prereqOptionsMissing=l.get("prereq").process.filter(function(r){return !n.options.selectedCollection.get(r.uid)});n.prereqOptionsMissing=n.prereqOptionsMissing.length>0}}if(!n.options.disabledConfirmSwitchToggleModal&&(m.platform&&m.platform.canCrossCompany())&&l.isWA()&&!l.isCustom()){k=n.getMandatoryPrereq();n.confirmSwitchToggleModal=new j({selectedCollection:n.options.selectedCollection,model:l,onCancel:function(){n.confirmSwitchToggleModal.destroy();n.options.onCancel()},onConfirm:function(){n.confirmSwitchToggleModal.destroy();n.options.onConfirm(k)},mandatoryPrereq:k});n.neededConfirmSwitchToggle=n.confirmSwitchToggleModal.isNeeded()}if(n.options.prereq.length>0){n.needed=true;if(l.get("prereq").type==="or"){this.disableOKButton=true;if(this.options.okButton&&n.prereqOptionsMissing){this.options.okButton.setDisabled(n.disableOKButton)}}}if(l.get("prereq")&&l.get("prereq").type==="or"&&!n.prereqOptionsMissing){n.needed=false}}this.elements.container=this.modal},getMandatoryPrereq:function(){var k=new a(),l=this.model;if(this._asPrereq(l)&&l.get("prereq").type==="and"){this._manageSubPrereq(l,k)}if(!this.prereqOptionsMissing){if(this._asPrereq(l)&&l.get("prereq").type==="or"){this._manageSubPrereq(l,k)}}return k},isNeeded:function(){return this.needed||this.neededConfirmSwitchToggle},showConfirmSwitchToggle:function(){this.confirmSwitchToggleModal.show()},confirm:function(){if(this.needed===false&&this.neededConfirmSwitchToggle===true){this.showConfirmSwitchToggle()}else{this.modal.setHeader("<h3>"+this.getTitle()+"</h3>");this.modal.setBody(this.getContent());this.modal.setFooter(this.getButtons());this.modal.inject(document.body).show();this.manageDefaultSelection()}},_manageButtonActivation:function(){var m,k=false,l=0;if(this.model.get("prereq").type==="or"){m=this.getContent().getElements('tr[data-level="0"] input');k=c.Array.detect(m,function(n){return n.checked===true})}else{m=this.getContent().getElements("tr input");k=m.every(function(n){return n.checked===true})}if(this.options.okButton){this.options.okButton.setDisabled(!k)}},manageDefaultSelection:function(){var k=this;if(this.model.get("prereq").type==="or"){this.options.selectedCollection.forEach(function(m){var l=[],n;if(k.getContent().getElement('[value="'+m.get("uid")+'"]')){l=k.getContent().getElements('[data-prereq="'+m.get("uid")+'"] input');if(k.getContent().getElement('[value="'+m.get("uid")+'"]:not(:disabled)')){k.getContent().getElement('[value="'+m.get("uid")+'"]:not(:disabled)').checked=true;l.forEach(function(o){o.checked=true})}}n=k.elements.container.getBody().getElements("[name=prereq-licenses\\[\\]]:checked");if(k.model.get("prereq")&&k.model.get("prereq").type==="or"){k.disableOKButton=n.length>0;if(k.options.okButton){k.options.okButton.setDisabled(k.disableOKButton)}}});if(this.options.selectedCollection.size()===0){k.disableOKButton=true;if(k.options.okButton){k.options.okButton.setDisabled(k.disableOKButton)}}}this._manageButtonActivation()},getTitle:function(){var k=this.model.get("option")?c.i18n("Granting this option will also grant"):c.i18n("Granting this role will also grant");return this.model.get("prereq").type==="and"?k:c.i18n("You need to select at least one of these roles")},getContentOld:function(){var l=this,k=[];if(!l.content){this.options.prereq=new a(this.options.prereq);this.options.prereq.forEach(function(n){var m,o=false;if(l._asPrereq(n)){m=l.getOptionsDetail(n,l.model.get("prereq").type==="or");o=c.Array.detect(m.getElements("tr[data-free]"),function(p){return p.getAttribute("data-free")==="false"})}k.push(l.getContentItem(n,l.model.get("prereq").type,null,0,!!o));if(m){k.push(m)}});l.content=c.createElement("table",{"class":"table",html:k})}return l.content},getContent:function(){var l=this,k=[];if(!l.content){this.options.prereq=new a(this.options.prereq);this.options.prereq.forEach(function(n){var m=[],o=false;if(l._asPrereq(n)){l._manageSubPrereq(n,l.options.prereq,m,l.model.get("prereq").type==="or");if(c.Array.detect(m,function(p){return p.getAttribute("data-type")==="and"})){o=c.Array.detect(m,function(p){var q=l.options.selectedCollection.get(p.getElement("input").value);return p.getAttribute("data-free")==="false"&&!q})}else{}}k.push(l.getContentItem(n,l.model.get("prereq").type,null,0,!!o));if(m){k.push(m)}});l.content=c.createElement("table",{"class":"table",html:k})}return l.content},_asPrereq:function(k){return k.get("prereq")&&k.get("prereq").process&&k.get("prereq").process.length>0},_isChecked:function(k,l,m){var n=this.options.selectedCollection.get(k.get("uid"));return n||(k.hasFree(this.options.number)&&l==="and"&&!m)},_isDisabled:function(k,l,m){var n=this.options.selectedCollection.get(k.get("uid"));return(!!this.options.selectedCollection.isGroupRoles&&n)||(n||l==="and"||((k.get("free")<this.options.number||m)&&((k.get("total")!==0&&k.get("withLicenses")===false)||k.get("total")>0)))},getContentItem:function(n,q,m,p,r){var o=this,l=this._isChecked(n,q,m);if(!p){p=0}if(!l
/*!model.hasFree() && type === 'and'*/
){this.disableOKButton=true;if(this.options.okButton){this.options.okButton.setDisabled(o.disableOKButton)}this.modal.getContent().addClassName("big-modal")}var s=new h({className:"primary",type:"checkbox",name:"prereq-licenses[]",value:n.get("uid"),label:n.get("name"),checked:l,disabled:!!this._isDisabled(n,q,r)});var k=c.createElement("tr",{"data-level":p,"data-free":n.get("free")>=this.options.number,"data-type":q,html:[{tag:"td",styles:{"padding-left":(15*p)+8},html:s},{tag:"td","class":"text-right status",html:this.getInformation(n)}],events:{click:function(y){if(s.isDisabled()){i.stop(y);return}var v=!s.isChecked();s.setCheck(v);if(this.getAttribute("data-type")==="or"){o._checkAllSubRow(this,s.isChecked(),p);var x=parseInt(this.getAttribute("data-level"),10);var u=this,w;if(x===1){u=o._getFirstLevel(this);w=this.getParent().getElement('tr[data-level="1"][data-type="or"] input:checked')||this}if(u){var t=w||u.nextElementSibling;if(t&&t.getAttribute("data-type")==="or"&&parseInt(t.getAttribute("data-level"),10)<parseInt(u.getAttribute("data-level"),10)){if(t.getElement('[data-type="or"][data-level="1"] input:checked')){o.disableOKButton=false;if(o.options.okButton){o.options.okButton.setDisabled(false)}}else{o.disableOKButton=true;if(o.options.okButton){o.options.okButton.setDisabled(true)}}}else{if(t&&t.getAttribute("data-type")==="or"&&(t.getElement('[data-type="or"][data-level="1"]')&&!t.getElement('[data-type="or"][data-level="1"] input:checked'))){o.disableOKButton=true;if(o.options.okButton){o.options.okButton.setDisabled(true)}}else{o.disableOKButton=false;if(o.options.okButton){o.options.okButton.setDisabled(false)}}}}else{if(o.content.getElement('[data-level="'+x+'"] input:checked')){c.log("Still have on prereq")}else{o.disableOKButton=true;if(o.options.okButton){o.options.okButton.setDisabled(true)}}}}i.stop(y)}}});return k},_getFirstLevel:function(l){var k=l.previousSibling;if(k&&parseInt(k.getAttribute("data-level"),10)===0||!k){return k||l}else{return this._getFirstLevel(k)}},_checkAllSubRow:function(l,n,k){var m=l.nextElementSibling;if(m&&parseInt(m.getAttribute("data-level"),10)>k){m.getElement("input").checked=n;this._checkAllSubRow(m,n,k)}},_manageSubPrereq:function(p,o,m,n,k){var l=this;if(!k){k=0}if(this._asPrereq(p)){k++;p.get("prereq").process.forEach(function(q){var r=new b(q);if(m){m.push(l.getContentItem(r,p.get("prereq").type,n,k))}o.add(r);l._manageSubPrereq(r,o,m,n,k)})}},getOptionsDetail:function(n,m){var l=this,k=[];l._manageSubPrereq(n,l.options.prereq,k,m);return c.createElement("tr",{html:[{tag:"td",colspan:2,styles:{padding:0},html:c.createElement("table",{"class":"table role-option-prereq","data-prereq":n.get("uid"),html:k})}]})},getInformation:function(l){var k="",m=this.options.selectedCollection.get(l.get("uid"));if(m){if(this.selectMode){k+=c.i18n("Already selected:")+" "}else{k+=c.i18n("Already granted:")+" "}}else{if(l.get("total")===0&&l.get("withLicenses")===false){k+=c.i18n("No license associated")}else{if(!l.hasFree()){k+=c.i18n("No more role available:")+" "}}}if(l.get("total")===0&&l.get("withLicenses")===false){k+=""}else{k+=c.String.format(c.i18n("Used: {0}/{1}"),(l.get("total")-l.get("free")),l.get("total"))}return{tag:"span","class":(l.get("total")===0&&l.get("withLicenses")===false)||(!l.hasFree()&&!m)?"text-error":"",text:k}},getButtons:function(){var k=this;k.options.okButton=new e({value:c.i18n("Ok"),className:"primary",disabled:this.disableOKButton,events:{onClick:function(){var m=k.elements.container.getBody().getElements("[name=prereq-licenses\\[\\]]:checked"),l=new a();m.forEach(function(n){var p=n.value,o=k.options.selectedCollection.get(p);l.add(o||k.options.prereq.get(p))});if(k.neededConfirmSwitchToggle){k.confirmSwitchToggleModal.options.onConfirm=function(n){k.clickOkPressed=true;if(k.model.get("prereq")&&k.model.get("prereq").type==="or"){k.options.onConfirm(l)}else{k.options.onConfirm(k.getMandatoryPrereq())}k.modal.hide()};k.confirmSwitchToggleModal.show()}else{k.clickOkPressed=true;if(k.model.get("prereq")&&k.model.get("prereq").type==="or"){k.options.onConfirm(l)}else{k.options.onConfirm(k.getMandatoryPrereq())}k.modal.hide()}}}});return[k.options.okButton,new e({value:c.i18n("Cancel"),className:"default",events:{onClick:function(){k.modal.hide()}}})]}})});define("DS/PlatformManagement/Views/GrantTable",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Spinner","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Tooltip","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Modal/PrereqError","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Views/EmptyView","DS/PlatformManagement/Collection/UserRoleCollection","UWA/Event"],function(f,p,q,o,k,u,g,h,n,r,b,d,m,c,l,s,j,i,t){var e=1,a=2;return p.extend({tagName:"div",collection:null,content:null,masked:false,emptyView:null,hideTableWithoutLicences:1,hideTableWithLicences:0,IFWLock:false,setup:function(v){var x=this,w=(v.fullCollectionWithOutLicenses)?3:2,y=function(){if(!x.content){x.render()}x.updateWrapper()},z=function(A){w--;if(w>0&&x._activeFilter!==a&&(x.grantedCollection.size()>0||(!f.is(x.fullCollection))&&x.grantedCollection.isFetched())){w=0;if(!x.options.noFilter){y()}}else{if(f.is(x.fullCollection)&&x.fullCollection.isFetched()&&x.grantedCollection.isFetched()&&x._activeFilter===a){y()}else{if(w===0){if(x.grantedCollection&&x.grantedCollection.size()>0){x.collection=x.grantedCollection}else{if(x.fullCollection){x.collection=x.fullCollection}}y()}}}if(A){x.model.set("nbUsed",x.grantedCollection.getMaxLimit())}};if(v.grantedCollection){this.grantedCollection=v.grantedCollection}if(v.fullCollection){this.fullCollection=v.fullCollection}else{x.options.noFilter=true}if(v.platform&&v.platform.canCrossCompanyExtended()&&v.fullCollectionWithOutLicenses){this.fullCollectionWithOutLicenses=v.fullCollectionWithOutLicenses}this.listenTo(this.model,{"onChange:role":this.updateWrapper});if(v.platform){this.platform=v.platform}this.forceGrantedCollectionRefresh=false;this.forceFullCollectionRefresh=false;this.forceFullCollectionWithOutLicensesRefresh=false;x.collection=x.grantedCollection;if(this.fullCollectionWithOutLicenses){this.fullCollectionWithOutLicenses.fetch({onComplete:function(){z()},onFailure:function(){z()}})}if(this.fullCollection){this.fullCollection.fetch({onComplete:function(){z()},onFailure:function(A,B){m.alert(B.message||A);z()}})}else{z()}this.grantedCollection.fetch({onComplete:function(){var A=true;z(A)},onFailure:function(){z()}});return v},_cleanTooltips:function(){if(this.tooltips&&this.tooltips.length>0){this.tooltips.invoke("destroy")}this.tooltips=[]},render:function(){this.container.setContent([this.buildSearch(),{"class":"wrapper"}]);this.mask();return this},updateWrapper:function(){var v;this._cleanTooltips();if(!this.collection.isFetched()||this.collection.isInProgress()===true||this.loading){this.mask();if(this.collection.isInProgress()===false&&!this.loading){v=this.buildEmptyView()}}else{if(this.fullCollectionWithOutLicenses&&(this.fullCollectionWithOutLicenses.size()>0||this.collection.size()>0)&&this.collection===this.fullCollection){v=this.getTableWithWithoutLicense()}else{if(this.collection.size()>0){v=this.getTable()}else{v=this.buildEmptyView()}}}if(this.elements&&this.elements.filterViewAll&&this.elements.filterGrantedOnly){if(this.collection&&this.collection===this.grantedCollection){this.elements.filterGrantedOnly.setClassName("primary");this.elements.filterViewAll.setClassName("default")}else{this.elements.filterViewAll.setClassName("primary");this.elements.filterGrantedOnly.setClassName("default")}}if(v){this.unmask();this.getBody().setContent(v)}},getTable:function(){return[{tag:"table","class":"table table-hover table-select-process",html:[{tag:"tbody",html:this.getRows()}]},this.buildPager()]},getTableWithWithoutLicense:function(){var y=this,w=this.buildPager(),v=this.buildPager(this.fullCollectionWithOutLicenses),z=function(E,D){var C=E.target.getParent("table").getElement("tbody"),B=E.target.getParent("table").getElement(".fonticon");if(B===null){C.show();if(D){D.show()}}else{if(B.hasClassName("fonticon-down-dir")){C.hide();if(D){D.hide()}B.removeClassName("fonticon-down-dir").addClassName("fonticon-right-dir")}else{C.show();if(D){D.show()}B.removeClassName("fonticon-right-dir").addClassName("fonticon-down-dir")}}},A=[{tag:"table","class":"table table-hover table-select-process",html:[{tag:"thead",html:{tag:"tr",styles:this.model.isCasual()?null:{cursor:"pointer"},html:[{tag:"th",text:(this.options.titleTableCollection)?this.options.titleTableCollection:f.i18n("Available")},{tag:"th",html:[this.model.isCasual()?null:{tag:"span","class":(this.hideTableWithLicences)?"fonticon fonticon-right-dir":"fonticon fonticon-down-dir",styles:{"float":"right","font-size":"14px",cursor:"pointer"},events:{click:function(B){z(B,w);y.hideTableWithLicences=(y.hideTableWithLicences)?0:1;f.Event.stopPropagation(B)}}}]}],events:{click:function(B){z(B,w);y.hideTableWithLicences=(y.hideTableWithLicences)?0:1}}}},{tag:"tbody",styles:{display:(this.hideTableWithLicences)?"none":""},html:this.getRows()}]},(w)?(this.hideTableWithLicences)?w.hide():w.show():""],x=null;if(!this.model.isCasual()){x=[{tag:"table","class":"table table-hover table-select-process",html:[{tag:"thead",html:{tag:"tr",styles:{cursor:"pointer"},html:[{tag:"th",text:this.options.titleTableCollectionWithOutLicenses},{tag:"th",html:[{tag:"span","class":(this.hideTableWithoutLicences)?"fonticon fonticon-right-dir":"fonticon fonticon-down-dir",styles:{"float":"right","font-size":"14px",cursor:"pointer"},events:{click:function(B){z(B,v);y.hideTableWithoutLicences=(y.hideTableWithoutLicences)?0:1;f.Event.stopPropagation(B)}}}]}],events:{click:function(B){z(B,v);y.hideTableWithoutLicences=(y.hideTableWithoutLicences)?0:1}}}},{tag:"tbody",styles:{display:(this.hideTableWithoutLicences)?"none":""},html:this.getRows(this.fullCollectionWithOutLicenses)}]},(v)?(this.hideTableWithoutLicences)?v.hide():v.show():""]}return[A,x]},buildPager:function(y){var x=this,w,v=this.collection;if(y){v=y}w=v.getMaxLimit();return w>v.getLimit()?new q({limit:v.getLimit(),offset:v.getOffset(),type:1,pageLinks:7,max:w,showPageLinks:true,length:w,events:{onOffsetChange:function(z){x.mask();v.setOffset(z);v.fetch({onComplete:function(){x.updateWrapper()}})}}}):null},getRows:function(y){var x=[],w=this,v=this.collection;if(y){v=y}v.forEach(function(z){x.push(w.getRow(z))});return x},getRowIdentifier:function(v){return v.get("uid")},isCheckboxDisabled:function(w,v){if(w.get("groups")){return true}else{return w.isDisabled(v.isDeny())}},isChecked:function(v){return v.get("granted")||(v.isTPA()&&v.get("private")===false)},getRow:function(w){var z=this,A=this.getRoleModel(w),x=new k({className:"primary",type:"checkbox",name:"licenses[]",value:this.getRowIdentifier(w),id:this.getRowIdentifier(w),label:d.getTextFromHtml(this.getLabel(w)),checked:this.isChecked(w),disabled:this.isCheckboxDisabled(w,this.model)}),v=f.createElement("div",{"class":"tooltip-wrapper",html:x}),y=w.get("groups")&&this.model.get("id")!=="IFW"&&w.get("id")!=="IFW"?this.getGroupsSpan(w):"",B=f.createElement("tr",{"class":"tr-"+this.getRowIdentifier(w),html:[{tag:"td",html:[v,y]},{tag:"td","class":this.platform.canCrossCompany()&&!A.isTPA()&&!A.isCustom()?"":"text-right status",html:this.platform.canCrossCompany()&&!A.isTPA()&&!A.isCustom()?this._createCrossCompany(w,this.isChecked(w)):this.getInformation(w)}],events:{click:function(D){if(x.isDisabled()){return}else{if(!D.target.getParent(".toggle-switch")){var C=!x.isChecked();x.setCheck(C);z.onToggleClick(x,w);t.stop(D)}}},onRemoveAllGrantedRole:function(){z.dispatchEvent("onRemoveAllGrantedRole")}}});if(this.isCheckboxDisabled(w,this.model)&&w.get("helpMessage")&&w.get("helpMessage")!==""){this.tooltips.push(new r({position:"bottom",target:v,body:w.get("helpMessage")}))}return B},_createCrossCompany:function(A,E){var B=this,D=this,w,x,y=this.getUserModel(A),z=this.getRoleModel(A),C=true,v=true;if(A.canCrossCompany()||A.isWU()){v=(A.get("granted")?A.get("licensed")===true:(A.isWUWithouLicenseFree()?false:y.get("licensed")));A.set("licensed",v);C=(A.get("restricted")===true)}w=A.get("withLicenses")?new k({className:"primary"+(v?"":" hidden"),type:"switch",name:"restricted[]",checked:C,disabled:!A.canCrossCompany()||A.isWU(),value:A.get("uid"),label:f.i18n("Restrict Usage to this Platform"),events:{onClick:function(G){var F=this;A.set("restricted",this.isChecked());if(E){B.mask();F.setDisabled(true);y.updateLicense([{id:z.get("uid"),licensed:z.get("licensed"),restricted:z.get("restricted")}],A.getType(),B.platform,{patch:true,onComplete:function(H){m.success(H.message);D.setUpdatedStatus(A);F.setDisabled(false);D.invalidCache();B.refreshModel();B.collection.reset();B.collection.fetch({onComplete:function(){B.unmask();B.updateWrapper()}})},onFailure:function(H){m.alert(H.message);B.refresh()}})}}}}):null;x=new k({className:"primary",type:"switch",name:"licensed[]",checked:(!A.get("withLicenses"))?false:v,disabled:A.isWUWithouLicenseFree()||(this.platform.getCrossCompanyRoles().indexOf(A.get("id"))!==-1&&this.isIFWLock())||(!A.get("withLicenses"))||A.get("locked")||A.isAssignDisabled(v)||(!A.canCrossCompany()&&!A.isWU()),value:A.get("uid"),label:"",events:{onClick:function(G){var F=this;A.set("licensed",this.isChecked());w.getContent().toggleClassName("hidden",!this.isChecked());if(E){B.mask();F.setDisabled(true);y.updateLicense([{id:z.get("uid"),licensed:z.get("licensed"),restricted:z.get("restricted")}],A.getType(),B.platform,{patch:true,onComplete:function(H){m.success(H.message);D.setUpdatedStatus(A);F.setDisabled(false);D.invalidCache();B.refreshModel();B.collection.reset();B.collection.fetch({onComplete:function(){B.unmask();B.updateWrapper()}})},onFailure:function(H){m.alert(H.message);B.refresh()}})}}}});x.getContent().getElement("label").setContent([{tag:"span",text:f.i18n("Assign License")},{tag:"span",html:this.getInformation(A)}]);return[x,w]},getLabel:function(v){var w=null;if(v.isOption()&&v.isSelfExp()){w=f.i18n("(Trial, Option)")}else{if(v.isSelfExp()){w=f.i18n("(Trial)")}else{if(v.isOption()){w=f.i18n("(Option)")}}}return w?v.get("name")+" "+w:v.get("name")},getInformation:function(w){var v="",x="";if(!w.isTPA()&&!w.isCustom()&&w.get("available")===false){if(this.platform.canCrossCompany()){if(!w.get("withLicenses")){v=f.i18n("No license associated")}else{v=f.i18n("Not available")}}else{v=f.i18n("Not available")}x="text-error"}else{if(w.get("casual")>0){v=""}else{if(w.isSelfExp()){v=f.String.format(f.i18n("Expires on {0}"),w.get("expireLong")||w.get("expire"))}else{if(w.get("start")){v=f.String.format(f.i18n("Granted {0}"),w.get("startLong")||w.get("start"))}else{if(w.getDisplayType()){v=f.String.format(f.i18n("Type: {0}"),w.getDisplayType())}else{if(!w.isCustom()){v=w.get("total")?f.String.format(f.i18n("Used: {0}/{1}"),(w.get("total")-w.get("free")),w.get("total")):""}}}}}}return{tag:"span","class":x,text:this.platform.canCrossCompany()&&!w.isTPA()&&v!==""?" - "+v:v}},setStatus:function(w,x){var v=this.getContent().getElement(".tr-"+d.escapeDomSelector(this.getRowIdentifier(w))+" .status");if(v){v.setContent(x)}return true},resetStatus:function(v){this.setStatus(v,this.getInformation(v))},setLoadingStatus:function(v){this.setStatus(v,new g({visible:true}))},setUpdatedStatus:function(w){var v='<span class="text-success">'+f.i18n("Updated")+"</span>";this.setStatus(w,v)},setGrantedStatus:function(w){var v='<span class="text-success">'+f.i18n("Granted")+"</span>";this.setStatus(w,v)},setRemovedStatus:function(w){var v='<span class="text-error">'+f.i18n("Removed")+"</span>";this.setStatus(w,v)},buildSearch:function(){var x=this,w=function(){var y=0;x.mask();x.collection.setQuery(this.value);x.collection.setOffset(0);x.collection.reset();if(x.fullCollectionWithOutLicenses){x.fullCollectionWithOutLicenses.setQuery(this.value);x.fullCollectionWithOutLicenses.setOffset(0);x.fullCollectionWithOutLicenses.reset();x.fullCollectionWithOutLicenses.fetch({onComplete:function(){if(y===1){x.updateWrapper()}else{y=2}}})}x.collection.fetch({onComplete:function(){if(!x.fullCollectionWithOutLicenses||y===2){x.updateWrapper()}else{y=1}}})},v=new b({attributes:{placeholder:x.options.searchPlaceholder,value:this.collection.getQuery()||"",events:{keyup:w}}});return{tag:"div",styles:{"text-align":"center","margin-top":5,"margin-bottom":15},html:[this.options.noFilter?null:this.buildFilter(),{"class":"input-search-center-wrapper",html:v},{"class":"clearfix"}]}},buildEmptyView:function(){if(this.emptyView===null){this.emptyView=new j()}this.emptyView.render(this.options.emptyText);return this.emptyView},isFullCollectionFresh:function(){return this.collection.getQuery()===this.fullCollection.getQuery()&&this.forceFullCollectionRefresh===false},isFullCollectionWithOutLicensesFresh:function(){return this.collection.getQuery()===this.fullCollectionWithOutLicenses.getQuery()&&this.forceFullCollectionWithOutLicenses===false},isGrantedCollectionFresh:function(){return this.collection.getQuery()===this.grantedCollection.getQuery()&&this.forceGrantedCollectionRefresh===false},isIFWLock:function(){var v=this.grantedCollection.find(function(w){return w.get("id")==="IFW"&&w.get("locked")===true});if(v){this.IFWLock=true}return this.IFWLock},invalidCache:function(){this.forceGrantedCollectionRefresh=true;this.forceFullCollectionRefresh=true;this.forceFullCollectionWithOutLicenses=true},invalidCacheAndReload:function(){var v=this;this.invalidCache();this.refreshModel();this.collection.reset();this.collection.fetch({onComplete:function(){v.unmask();v.updateWrapper()}})},filterGrantedOnly:function(){var v=this;this._activeFilter=e;v.elements.filterGrantedOnly.setClassName("primary");v.elements.filterViewAll.setClassName("default");if(!this.isGrantedCollectionFresh()&&!this.collection.isInProgress()&&!this.loading){this.mask();this.grantedCollection.setQuery(v.collection.getQuery());this.grantedCollection.reset();this.grantedCollection.fetch({onComplete:function(){v.updateWrapper();v.forceGrantedCollectionRefresh=false}});v.collection=v.grantedCollection}else{v.collection=v.grantedCollection;this.updateWrapper()}},filterViewAll:function(){var v=this;this._activeFilter=a;v.elements.filterGrantedOnly.setClassName("default");v.elements.filterViewAll.setClassName("primary");if(!this.isFullCollectionFresh()&&!this.collection.isInProgress()&&!this.loading){this.mask();this.fullCollection.setQuery(v.collection.getQuery());this.fullCollection.reset();this.fullCollection.fetch({onComplete:function(){v.updateWrapper();v.forceFullCollectionRefresh=false}});v.collection=v.fullCollection}else{v.collection=v.fullCollection;this.updateWrapper()}},buildFilter:function(){var v=this.elements;v.filterGrantedOnly=new h({value:(this.options.filterGrantedOnlyText)?this.options.filterGrantedOnlyText:f.i18n("View granted only"),className:"default",events:{onClick:this.filterGrantedOnly.bind(this)}});v.filterViewAll=new h({value:(this.options.filterViewAllText)?this.options.filterViewAllText:f.i18n("View all"),className:"default",events:{onClick:this.filterViewAll.bind(this)}});return{"class":"pull-left filter-group",styles:{"margin-top":0},html:[new n({buttons:[v.filterGrantedOnly,v.filterViewAll]})]}},getUserModel:function(){return this.model},getRoleModel:function(v){return v},onToggleClick:function(B,A){var C=this,x=true,D=null,y=this.getUserModel(A),z=this.getRoleModel(A),E=new i([],{data:{platform:this.platform.getId(),user:y.getUserId(),casual:y.get("casual"),granted:true}}).setLimit(null),w=function(F){if(x&&z.hasFree()){C.onCreateLicensesUser(y,z,A,C,F,B)}else{m.warn(f.i18n("You have not enough role"));B.uncheck()}},v=function(F){if(B.isChecked()){D=new c({platform:C.platform,selectedCollection:F,model:z,onConfirm:function(G){w(G)},onCancel:function(){C.unmask();B.uncheck();B.setDisabled(false);C.resetStatus(A)}});if(D.isNeeded()){D.confirm()}else{w(D.getMandatoryPrereq())}}else{D=new l({selectedCollection:F,model:z,onCancel:function(){C.unmask();B.check();B.setDisabled(false);C.resetStatus(A)}});if(D.isNeeded()){D.show()}else{if(y.isDeny()){B.setDisabled()}C.showDeleteConfirmation(y,z,A,C,B)}}};C.setLoadingStatus(A);B.setDisabled(true);if(this.needToFetchToGrant(z)){if(!B.isChecked()){C.mask()}E.fetch({onComplete:v})}else{v(C.grantedCollection)}},onCreateLicensesUser:function(x,C,y,w,B,v){var A=this,z=A.platform.canCrossCompany()?[{id:C.get("uid"),licensed:this.options.withLicenses===false||(A.fullCollectionWithOutLicenses&&A.fullCollectionWithOutLicenses.get(C.get("uid")))?false:y.get("licensed"),restricted:y.get("restricted")}]:[{id:C.get("uid")}];B.forEach(function(D){if(A.platform.canCrossCompany()){var E={id:D.get("uid")};if(A.fullCollectionWithOutLicenses&&A.fullCollectionWithOutLicenses.get(C.get("uid"))||D.get("withLicenses")===false){E.licensed=false}z.push(E)}else{z.push({id:D.get("uid")})}});if(B.size()>0){B.forEach(function(E){var D=A.getBody().getElement(d.escapeDomSelector("#"+E.get("uid")));w.setLoadingStatus(E);if(D){A.getBody().getElement(d.escapeDomSelector("#"+E.get("uid"))).checked=true}})}if(A.platform.canCrossCompany()){A.mask()}this.loading=true;x.addLicense(z,C.getType(),A.platform,{patch:true,onComplete:function(E){var D=0;m.success(E.message);w.setGrantedStatus(y);if(B.size()>0){B.forEach(function(F){w.setGrantedStatus(F)})}v.setDisabled(false);w.invalidCache();A.refreshModel();A.loading=false;if(A.platform.canCrossCompany()){A.unmask();A.collection.reset();A.collection.fetch({onComplete:function(){if(!A.fullCollectionWithOutLicenses||D===2){A.updateWrapper()}else{D=1}}});if(A.fullCollectionWithOutLicenses){A.fullCollectionWithOutLicenses.reset();A.fullCollectionWithOutLicenses.fetch({onComplete:function(){if(D===1){A.updateWrapper()}else{D=2}}})}}A.model.set("nbUsed",A.model.get("nbUsed")+1)},onFailure:function(E,D){m.alert(E.message);A.unmask();v.setDisabled(false);w.invalidCache();A.refreshModel();A.loading=false}})},showDeleteConfirmation:function(x,C,y,w,v){var A=this,z=new o({closable:false}),B=this.getConfirmDeleteTitle(y);z.confirm(B,f.i18n("Confirmation"),function(D){if(D){A.confirmDelete(x,C,y,w,v)}else{v.check();v.setDisabled(false);A.resetStatus(y);A.unmask()}d.manageSupportOfMultiModal()})},getConfirmDeleteTitle:function(x){var w,v=d.getTextFromHtml(x.get("name"));if(!x.isTPA()){if(x.isOption()){w=f.String.format(f.i18n("Are you sure you want to remove {0} Option?"),v)}else{w=f.String.format(f.i18n("Are you sure you want to remove {0} Role?"),v)}}else{w=f.String.format(f.i18n("Are you sure you want to remove {0} App?"),v)}return w},confirmDelete:function(x,A,y,w,v){var z=this;w.setLoadingStatus(y);v.setDisabled(true);this.loading=true;x.removeLicense(A,z.platform,{onComplete:function(C){var B=0;z.unmask();v.uncheck();z.grantedCollection.remove(y);if(A.isTPA()||A.isCustom()){v.setDisabled(false)}w.invalidCache();z.refreshModel();z.loading=false;if(z.platform.canCrossCompany()){z.unmask();z.collection.reset();z.collection.fetch({onComplete:function(){if(!z.fullCollectionWithOutLicenses||B===2){z.updateWrapper()}else{B=1}}});if(z.fullCollectionWithOutLicenses){z.fullCollectionWithOutLicenses.reset();z.fullCollectionWithOutLicenses.fetch({onComplete:function(){if(B===1){z.updateWrapper()}else{B=2}}})}}if(!z.platform.isPlatform()&&z.grantedCollection.length===0&&!z.grantedCollection.hasNext()){z.dispatchEvent("onRemoveAllGrantedRole")}else{if(z.grantedCollection.length===0&&z.grantedCollection.hasNext()){z.refresh()}}z.model.set("nbUsed",z.model.get("nbUsed")-1);setTimeout(function(){m.success(C.message);w.setRemovedStatus(y);z.dispatchEvent("onUnGrantRole")},1000)},onFailure:function(B){m.alert(B.message);z.refresh();z.loading=false}})},refresh:function(){var w=this,v=0;this.unmask();this.collection.reset();this.collection.fetch({onComplete:function(){if(!w.fullCollectionWithOutLicenses||v===2){w.updateWrapper()}else{v=1}}});if(w.fullCollectionWithOutLicenses){w.fullCollectionWithOutLicenses.reset();w.fullCollectionWithOutLicenses.fetch({onComplete:function(){if(v===1){w.updateWrapper()}else{v=2}}})}},refreshModel:function(){this.model.fetch({data:{rolePlatform:this.model.get("platform"),platform:this.platform.get("id"),id:this.model.get("id")}})},needToFetchToGrant:function(v){return !v.isTPA()&&!v.isSelfExp()&&!v.isCustom()&&(this.grantedCollection.hasNext()||(this.grantedCollection.getQuery()!==null&&this.grantedCollection.getQuery()!==""))},getBody:function(){if(!this.content){this.content=this.container.getElement(".wrapper")}return this.content},mask:function(){if(!this.isMasked()){u.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){u.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked},onDestroy:function(){this._cleanTooltips()},getGroupsSpan:function(v){var y=v.get("groups"),B=y.split(","),z=B.length,x=B[0].length>20?B[0].substring(0,20)+"...":B[0],A=z===1?f.i18n("Granted through group: {0}").format(x):f.i18n("Granted through groups: {0}").format(y.replace(",","</br>")),w=f.createElement("span",{"class":"fonticon fonticon-users-group ",styles:{"margin-left":"10px"}});this.tooltips.push(new r({position:"bottom",target:w,body:A}));return w}})});define("DS/PlatformManagement/Views/GrantUserTable",["UWA/Core","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","DS/PlatformManagement/Views/GrantTable"],function(e,a,d,b,c){return c.extend({getRowIdentifier:function(f){return f.get("id")},needToFetchToGrant:function(){return true},isCheckboxDisabled:function(f,h){var g=false;if(f.get("groups")){g=f.get("granted")}else{if(h.isSelfExp()){if(f.get("granted")===false){g=true}else{g=!(f.get("remove")===true&&f.get("expire")==="")}}else{if(!f.isDeny()){if(h.isCustom()){g=false}else{if(h.isTPA()){g=h.get("private")===false}else{g=(f.get("granted")===false&&!h.hasFree())||(f.get("granted")&&(f.get("remove")===false||h.get("isPlatform")===true))}}}else{g=!f.get("granted")}}}return g},getLabel:function(f){return f.getUserFullName()},getRoleModel:function(){return this.model},getUserModel:function(f){return f},isChecked:function(f){return f.get("granted")},getInformation:function(g){var f="",h="";if(this.model.isSelfExp()){if(g.get("expire")!==""){f=e.i18n("Expires on {0}").format(g.get("expireLong")||g.get("expire"))}else{f=e.i18n("Trial Expired");h="text-error"}}else{if(!this.model.isTPA()&&g.get("start")){f=e.i18n("Granted {0}").format(g.get("startLong")||g.get("start"))}}return[{tag:"span","class":h,text:f}]},getConfirmDeleteTitle:function(f){return e.i18n("Are you sure you want to remove {0}?").format(f.getUserFullName())},_createCrossCompany:function(f){if(f.isRoleOnly&&f.isRoleOnly()){return[{tag:"span","class":"groups-list text-center status",text:e.i18n("Role granted without license")}]}else{if(!(f.isTPA&&f.isTPA())&&!(f.isCustom&&f.isCustom())){return this.getInformation(f)}}}})});define("DS/PlatformManagement/Views/SelectAppsView",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/PlatformManagement/Controls/Input/Text","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Modal/PrereqError","DS/PlatformManagement/Collection/ProcessCollection","UWA/Event"],function(g,e,a,h,j,f,i,k,d,c,b,l){return e.extend({tagName:"div",hideTableWithoutLicences:1,hideTableWithLicences:0,statRoleCrossCompany:{licensed:true,restricted:true,trigram:""},setup:function(m){if(m.collectionSelected){this.collectionSelected=m.collectionSelected}if(m.platform){this.platform=m.platform}else{throw new Error("platform is mandatory")}if(m.disabledCrossCompany){this.disabledCrossCompany=m.disabledCrossCompany}this._disabledRoles=[];this.preSelectedRoleDone=false;return m},render:function(){this._managePreselection();this.filterData();if(!this.subView){this.container.setContent(this.buildAppSkeleton());this.mask()}else{if(this.collection.isFetched()&&(!this.options.collectionWithOutLicenses||this.options.collectionWithOutLicenses.isFetched())){if(!this.collectionFull){this.collectionFull=new b();this.collectionFull.add(this.collection.toJSON());if(this.options.collectionWithOutLicenses){this.collectionWithOutLicensesFull=new b();this.collectionWithOutLicensesFull.add(this.options.collectionWithOutLicenses.toJSON())}if(this.collectionSelected){this._managePreselection();if(this.collectionSelected.size()>0){this.filterData()}}}this.subView.setContent(this.buildSubView());this.unmask()}}if(this.options.setNextDisabled){this._manageNextButton()}return this},_manageNextButton:function(){var m=this.options.tagger?this.options.tagger.getSelected().length:1;if(m&&this.collectionSelected.size()>0){this.options.setNextDisabled(false)}else{this.options.setNextDisabled(true)}},_managePreselection:function(){var o=this.options.tagger?this.options.tagger.getSelected().length:1,n,p,m=this.platform.canCrossCompany()&&!this.disabledCrossCompany;if(this.collectionSelected&&this.collectionFull&&!this.preSelectedRoleDone){n=this.collectionFull.filter(function(r){var q=m?true:r.get("free")>=o;return r.get("isPlatform")===true&&q});if(n.length===1){p=n[0];this.collectionSelected.add(p);this._disabledRoles.push(p.get("trigram"))}this.preSelectedRoleDone=true}},getMaxFreeRole:function(){var m=null;if(this.collectionSelected){this.collectionSelected.forEach(function(n){m=!m?n.get("free"):Math.min(m,n.get("free"))})}return m},buildAppSkeleton:function(){return[this.buildSearch(),this.buildSubView()]},buildSubView:function(){this.subView=g.createElement("div",{styles:{position:"relative"},"class":"wrapper",html:[this.collectionSelected&&this.collectionSelected.size()>0?this.buildSelectedTable():{"class":"text-center",text:this.options.emptyText||""},this.collection&&this.collection.size()>0?(this.options.collectionWithOutLicenses)?this.buildWithoutLicensesTable(this.collection):this.buildTable():null,this.platform.canCrossCompanyExtended()&&!this.disabledCrossCompany&&this.options.collectionWithOutLicenses?this.buildWithoutLicensesTable(this.options.collectionWithOutLicenses):null]});return this.subView},buildSelectedTable:function(){return{tag:"table","class":"table table-hover table-select-process table-selection",html:[{tag:"thead",html:{tag:"tr",html:[{tag:"th",colspan:2,text:g.i18n("Selected")}]}},{tag:"tbody",html:this.buildSelectedRows()}]}},buildSelectedRows:function(){var n=[],m=this;this.collectionSelected.forEach(function(o){n.push(m.buildRow(o))});return n},buildTable:function(){var m=function(p){var o=p.target.getParent("table").getElement("tbody"),n=p.target.getParent("table").getElement(".fonticon");if(n.hasClassName("fonticon-down-dir")){o.hide();n.removeClassName("fonticon-down-dir").addClassName("fonticon-right-dir")}else{o.show();n.removeClassName("fonticon-right-dir").addClassName("fonticon-down-dir")}};return{tag:"table","class":"table table-hover table-select-process",html:[{tag:"thead",html:{tag:"tr",html:[{tag:"th",colspan:2,text:(this.options.titleTableCollection)?this.options.titleTableCollection:g.i18n("Available")}]}},{tag:"tbody",html:this.buildRows()}]}},buildWithoutLicensesTable:function(p){var n=this,m=(p===this.options.collectionWithOutLicenses),q=(m)?this.hideTableWithoutLicences:this.hideTableWithLicences,o=function(t){var s=t.target.getParent("table").getElement("tbody"),r=t.target.getParent("table").getElement(".fonticon");if(r.hasClassName("fonticon-down-dir")){s.hide();r.removeClassName("fonticon-down-dir").addClassName("fonticon-right-dir")}else{s.show();r.removeClassName("fonticon-right-dir").addClassName("fonticon-down-dir")}};return{tag:"table","class":"table table-hover table-select-process",html:[{tag:"thead",html:{tag:"tr",html:[{tag:"th",text:(m)?this.options.titleTableCollectionWithOutLicenses:this.options.titleTableCollection},{tag:"th",html:(this.collection.options.data.casual===0)?[{tag:"span","class":(q)?"fonticon fonticon-right-dir":"fonticon fonticon-down-dir",styles:{"float":"right","font-size":"14px",cursor:"pointer"},events:{click:function(r){o(r);if(m){n.hideTableWithoutLicences=(n.hideTableWithoutLicences)?0:1}else{n.hideTableWithLicences=(n.hideTableWithLicences)?0:1}g.Event.stopPropagation(r)}}}]:null}],events:{click:function(r){if(r.target.getParent("table").getElement(".fonticon")){o(r);if(m){n.hideTableWithoutLicences=(n.hideTableWithoutLicences)?0:1}else{n.hideTableWithLicences=(n.hideTableWithLicences)?0:1}}g.Event.stopPropagation(r)}}}},{tag:"tbody",styles:{display:(q)?"none":""},html:this.buildRows(p)}]}},buildRows:function(p){var o=[],n=this,m=this.collection;if(p){m=p}m.forEach(function(q){o.push(n.buildRow(q,"other"))});return o},buildRow:function(n){var q=this,r=function(s){var u=null,x,v=0,w,t=function(y){y.forEach(function(z){u=(q.platform.canCrossCompanyExtended()&&!q.disabledCrossCompany&&q.collectionWithOutLicensesFull&&q.collectionWithOutLicensesFull.get(z.get("uid")))?q.collectionWithOutLicensesFull.get(z.get("uid")):q.collectionFull.get(z.get("uid"));if(u){q.collectionSelected.add(u);q.collection.remove(x)}})};if(q.options.tagger){v=q.options.tagger.getSelected().length}if(s.isChecked()){if(n.hasFree()||n.isTPA()||n.isCustom()){w=new d({selectedCollection:q.collectionSelected,model:n,number:v,disabledConformSwitchToggleModal:true,onConfirm:function(y){t(y);q.collectionSelected.add(n);if(q.platform.canCrossCompanyExtended()&&!q.disabledCrossCompany&&q.options.collectionWithOutLicenses&&q.options.collectionWithOutLicenses.remove(n.id)){q.options.collectionWithOutLicenses.set(q.options.collectionWithOutLicenses.sortBy("name"))}else{q.collection.remove(n.id);q.collection.set(q.collection.sortBy("name"))}q.collectionSelected.set(q.collectionSelected.sortBy("name"));q.render();q._manageCrossCompanySelection()},onCancel:function(){s.uncheck()}});if(w.isNeeded()){w.confirm()}else{q.collectionSelected.add(n);if(q.platform.canCrossCompanyExtended()&&!q.disabledCrossCompany&&q.options.collectionWithOutLicenses&&q.options.collectionWithOutLicenses.remove(n.id)){q.options.collectionWithOutLicenses.set(q.options.collectionWithOutLicenses.sortBy("name"))}else{q.collection.remove(n.id);q.collection.set(q.collection.sortBy("name"))}q.collectionSelected.set(q.collectionSelected.sortBy("name"));q.render();q._manageCrossCompanySelection()}}else{k.warn(g.i18n("You have not enough role"))}}else{w=new c({model:n,selectedCollection:q.collectionSelected,onCancel:function(){s.check()}});if(w.isNeeded()){w.show()}else{q.collectionSelected.remove(n.id);q.collectionSelected.set(q.collectionSelected.sortBy("name"));if(q.platform.canCrossCompanyExtended()&&!q.disabledCrossCompany&&q.options.collectionWithOutLicenses&&!n.get("withLicenses")){q.options.collectionWithOutLicenses.add(n);q.options.collectionWithOutLicenses.set(q.options.collectionWithOutLicenses.sortBy("name"))}else{q.collection.add(n);q.collection.set(q.collection.sortBy("name"))}q.render();q._updateCrossCompanyRoles("remove","","",n);q._manageCrossCompanySelection()}}},p=q.collectionSelected.contains(n);if(n.isTPA()&&n.get("private")===false){p=true}function m(){var t=false,s=null;if(q.options.tagger){s=q.options.tagger.getSelected().length}if(this._disabledRoles.indexOf(n.get("trigram"))>-1){t=true}if(q.options.isBatchInvite){n.set("crossCompany",false)}if((!n.canCrossCompany()||q.disabledCrossCompany||q.options.isBatchInvite)&&n.isDisabled(false,s)){t=true}return t}var o=new j({"data-free":n.get("free"),className:"primary",type:"checkbox",name:"licenses[]",value:n.get("uid"),id:n.get("uid"),label:n.get("option")===true?i.getTextFromHtml(n.get("name"))+" "+g.i18n("(Option)"):i.getTextFromHtml(n.get("name")),checked:p,disabled:m.call(this)});return g.createElement("tr",{html:[{tag:"td",styles:{"vertical-align":"middle"},html:o},{tag:"td","class":q.platform.canCrossCompany()&&!q.disabledCrossCompany&&!n.isTPA()&&!n.isCustom()&&p?"":"text-right status",html:q.platform.canCrossCompany()&&!q.disabledCrossCompany&&!n.isTPA()&&!n.isCustom()&&p?this._createCrossCompany(n):this._getInformation(n)}],events:{click:function(t){if(o.isDisabled()){return}else{if(!t.target.getParent(".toggle-switch")){var s=!o.isChecked();o.setCheck(s);r(o);l.stop(t)}}}}})},_getInformation:function(n,p){var m="",o="";if(n.isTPA()){m=g.String.format(g.i18n("Type: {0}"),n.getDisplayType())}else{if(!n.isCustom()&&n.get("free")<(this.options.tagger?this.options.tagger.getSelected().length:1)){if(this.platform.canCrossCompany()&&!this.disabledCrossCompany){if(!n.get("withLicenses")){m=g.i18n("No license associated")}else{m=g.String.format(g.i18n("Not enough licenses available ({0} remaining)"),n.get("free"))}}else{m=g.String.format(g.i18n("Not enough roles available ({0} remaining)"),n.get("free"))}o="text-error"}else{if(!n.isCustom()){m=n.get("total")?g.String.format(g.i18n("Used: {0}/{1}"),(n.get("total")-n.get("free")),n.get("total")):""}}}return{tag:"span","class":o,text:p&&m!==""?" - "+m:m}},_updateCrossCompanyRoles:function(o,n,q,m){var p=this,r;if(!p._isCrossCompanyRoleDisabled()){if(m&&p.platform.getCrossCompanyRoles().indexOf(m.get("trigram"))>-1){if(o==="update"){p.statRoleCrossCompany.trigram=m.get("trigram");p.statRoleCrossCompany[n]=q}else{if(o==="remove"){p.statRoleCrossCompany.trigram="";p.platform.getCrossCompanyRoles().forEach(function(s){if(g.is(p.collectionSelected.findWhere({trigram:s}))){r=p.collectionSelected.findWhere({trigram:s});p.statRoleCrossCompany.trigram=r.get("trigram");p.statRoleCrossCompany.licensed=r.get("licensed");p.statRoleCrossCompany.restricted=r.get("restricted")}})}}}}},_manageCrossCompanySelection:function(n){var p=this,q=this.container.getElements(".table-selection tbody tr"),o,m=this.collectionSelected.find(function(r){return r.isWA()&&!r.canCrossCompany()});if(!this._isCrossCompanyRoleDisabled()){if(n&&p.platform.getCrossCompanyRoles().indexOf(n.get("trigram"))>-1){o=n}else{o=p.statRoleCrossCompany.trigram?this.collectionSelected.find(function(r){return r.get("trigram")===p.statRoleCrossCompany.trigram}):this.collectionSelected.find(function(r){return p.platform.getCrossCompanyRoles().indexOf(r.get("trigram"))>-1})}q.forEach(function(t){var s=t.getElement("[name=licensed\\[\\]]"),r=t.getElement("[name=restricted\\[\\]]");if(o&&s&&r){var u=p.collectionSelected.find(function(v){return v.get("trigram")===s.getAttribute("data-trigram")});if(g.is(m)){if(p.platform.getCrossCompanyRoles().indexOf(s.getAttribute("data-trigram"))>-1){o.set("licensed",true);s.checked=o.get("licensed");s.disabled=true;r.checked=o.get("restricted");r.getParent().toggleClassName("hidden",!o.get("licensed"));u.set("licensed",o.get("licensed"));u.set("restricted",o.get("restricted"))}else{r.getParent().toggleClassName("hidden",!s.checked)}}else{if(p.platform.getCrossCompanyRoles().indexOf(s.getAttribute("data-trigram"))>-1){s.checked=o.get("licensed");s.disabled=false;r.checked=o.get("restricted");r.getParent().toggleClassName("hidden",!o.get("licensed"));u.set("licensed",o.get("licensed"));u.set("restricted",o.get("restricted"))}else{r.getParent().toggleClassName("hidden",!s.checked)}}}})}},_isCrossCompanyRoleDisabled:function(){var n=this,m;if(n.options.tagger){m=n.options.tagger.getSelected().length}return !!this.collectionSelected.find(function(o){return n.platform.getCrossCompanyRoles().indexOf(o.get("trigram"))>-1&&o.isAssignDisabled(undefined,m)})},_createCrossCompany:function(n){if(n.isWUWithouLicenseFree()){n.set("licensed",false)}var q=this,r=n.isWUWithouLicenseFree()||(!n.get("withLicenses"))||(this.platform.getCrossCompanyRoles().indexOf(n.get("trigram"))>-1||(!n.isTPA()&&!n.isCustom()&&!n.canCrossCompany()))&&this._isCrossCompanyRoleDisabled(),m=!r&&!n.isDisabled(false,q.options.tagger?q.options.tagger.getSelected().length:null)&&(g.is(n.get("licensed"))?n.get("licensed"):true),p=new j({className:"primary",type:"switch",name:"licensed[]",attributes:{"data-trigram":n.get("trigram")},checked:m,value:n.get("uid"),disabled:r||!n.canCrossCompany()||n.isDisabled(false,q.options.tagger?q.options.tagger.getSelected().length:null),label:"",events:{onClick:function(){n.set("licensed",this.isChecked());q._updateCrossCompanyRoles("update","licensed",this.isChecked(),n);q._manageCrossCompanySelection(n)}}}),o=n.get("withLicenses")?new j({className:"primary"+(m?" ":" hidden"),type:"switch",name:"restricted[]",attributes:{"data-trigram":n.get("trigram")},checked:g.is(n.get("restricted"))?n.get("restricted"):true,value:n.get("uid"),label:g.i18n("Restrict Usage to this Platform"),disabled:!n.canCrossCompany()||n.isWU(),events:{onClick:function(){n.set("restricted",this.isChecked());q._updateCrossCompanyRoles("update","restricted",this.isChecked(),n);q._manageCrossCompanySelection(n)}}}):null;p.getContent().getElement("label").setContent([{tag:"span",text:g.i18n("Assign License")},{tag:"span",html:this._getInformation(n,true)}]);return[p,o]},filterData:function(){var m=this;m.collectionSelected.forEach(function(n){if(n){m.collection.remove(n.id)}})},_fetchSearch:function(o){var n=this,m=0;this.mask();this.collection.setQuery(o);this.collection.setOffset(0);this.collection.reset();this.collection.fetch({onComplete:function(){if(!n.options.collectionWithOutLicenses||m===2){n.render();n._manageCrossCompanySelection()}else{m=1}}});if(this.platform.canCrossCompanyExtended()&&!this.disabledCrossCompany&&this.options.collectionWithOutLicenses){this.options.collectionWithOutLicenses.setQuery(o);this.options.collectionWithOutLicenses.setOffset(0);this.options.collectionWithOutLicenses.reset();this.options.collectionWithOutLicenses.fetch({onComplete:function(){if(m===1){n.render();n._manageCrossCompanySelection()}else{m=2}}})}},_search:function(n){var m=this,o;if(((!this.options.collectionWithOutLicenses||this.disabledCrossCompany)&&this.collection.isFetched())||(this.options.collectionWithOutLicenses&&this.options.collectionWithOutLicenses.isFetched()&&this.collection.isFetched())){this._fetchSearch(n)}else{o=function(){m.collection.removeEvent("onAdd",o);setTimeout(function(){m._fetchSearch(n)},100)};this.collection.addEvent("onAdd",o)}},buildSearch:function(){var m=this;return new h({attributes:{placeholder:this.options.searchPlaceholder,value:this.collection.getQuery()||"",events:{keyup:function(){m._search.call(m,this.value)}}}})},getBody:function(){if(!this.content){this.content=this.container.getElement(".wrapper")}return this.content},mask:function(){if(!this.isMasked()){f.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){f.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked}})});define("DS/PlatformManagement/Collection/UserTpaCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/ProcessModel"],function(d,c,b){var a=6;return c.extend({url:"user/apps",model:b,setup:function(e,f){this.setLimit(a);return this._parent(e,f)},parse:function(e){this.setMaxLimit(e.count);return e.data}})});define("DS/PlatformManagement/Collection/SelfExperienceCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/ProcessModel"],function(d,c,b){var a=6;return c.extend({url:"user/selfexp",model:b,setup:function(e,f){this.setLimit(a);return this._parent(e,f)},parse:function(e){this.setMaxLimit(e.count);return e.data||e.roles}})});define("DS/PlatformManagement/Views/UserView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView","DS/PlatformManagement/Utils","UWA/Event"],function(f,b,e){var d="Contractor",c="-1",a="3";return b.extend({tagName:"div",name:"platform-management",extendedEvents:false,getFooterText:function(){var h=null,g=this.model;if(g.isCasual()){h=f.i18n("(Casual usage)").format(g.get("casual"))}return h!==null?{tag:"div","class":"contractor-text",text:h}:null},getPendingText:function(){var g=null;if(!this.model.get("active")){g={tag:"span",text:" "+f.i18n("(Pending)")}}return g},getRoleLabel:function(){var h;if(!this.model.isDeny()&&this.model.isContractor()){h={id:c,name:f.i18n(d)}}else{var g=this.model.get("role");h=f.Array.detect(this.options.roles,function(i){return i.id===g})}return(h&&h.name)||""},render:function(){var g=this.model;this._parent();this.container.getElement(".tile-content").setContent([{tag:"span","class":(!this.model.isDeny()&&this.model.isContractor())?e.getRoleColor(a,true):e.getRoleColor(g.get("role"),true),text:this.getRoleLabel()},this.getPendingText(),this.getFooterText()]);this.container.addClassName("user-box grid");this.container.setAttribute("data-id",g.get("id"));this.container.setAttribute("data-casual",g.get("casual"));this.container.setAttribute("data-type","user");this.container.setAttribute("data-cross-company",!g.get("licensed"));this.extendedEvents=this._initExtendedEvents();this._injectPresence();return this},destroy:function(){if(this.container&&this.container.getElement(".tile-sub-container")){this.container.getElement(".tile-sub-container").removeEvent("click")}return this._parent()},_injectPresence:function(){var i=this,g=this.model,h=f.createElement("div",{styles:{position:"absolute",bottom:-5,right:-3}});h.inject(this.container.getElement(".platform-management-header"));if(e.isBetaModeActivated("RTPresence")){e.getParentModule("DS/RTPresenceAPI/RTPresenceAPI",function(j){new j({login:g.get("id"),button:false,username:g.getUserFullName(),tenant:i.options.platform,content:h})})}},_initExtendedEvents:function(){var g=this;this.container.getElement(".tile-sub-container").addEvent("click",function(h){if(!g._isActionElement(h.target)&&!g.container.hasClassName("disabled")){if(g.isSelected()){g.unSelect()}else{g.select()}if(g.options.onSelect){g.options.onSelect(g.getContent(),g.model)}}});return true},_isActionElement:function(g){return g.getParent(".actions-inline-container")||g.hasClassName("actions-inline-container")}})});define("DS/PlatformManagement/Views/GrantTable2",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Spinner","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Tooltip","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Modal/PrereqError","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Views/EmptyView","UWA/Event"],function(f,o,p,n,j,t,g,h,m,q,b,d,l,c,k,r,i,s){var e=1,a=2;return o.extend({tagName:"div",collection:null,content:null,masked:false,emptyView:null,setup:function(u){var w=this,v=2,x=function(){if(!w.content){w.render()}w.updateWrapper()},y=function(){v--;if(w._activeFilter!==a&&(w.grantedCollection.size()>0||(!f.is(w.fullCollection))&&w.grantedCollection.isFetched())){w.collection=w.grantedCollection;v=0;if(!w.options.noFilter){x();w.elements.filterGrantedOnly.setActive();w.elements.filterViewAll.setActive(false)}}else{if(f.is(w.fullCollection)){w.collection=w.fullCollection}}if(v===0||w._activeFilter===a){x()}};if(u.grantedCollection){this.grantedCollection=u.grantedCollection}if(u.fullCollection){this.fullCollection=u.fullCollection}else{w.options.noFilter=true}if(u.platform){this.platform=u.platform}this.toGrantCollection=new r();this.toRemoveCollection=new r();this.toUpdateCollection=new r();this.forceGrantedCollectionRefresh=false;this.forceFullCollectionRefresh=false;w.collection=w.grantedCollection;if(this.fullCollection){this.fullCollection.fetch({onComplete:function(){y()},onFailure:function(){}})}else{y()}this.grantedCollection.fetch({onComplete:function(){y()},onFailure:function(){}});return u},render:function(){this.container.setContent([this.buildSearch(),{styles:{"margin-bottom":15},text:f.i18n("New members will be granted the following Roles and Licenses")},{"class":"wrapper"}]);this.mask();return this},updateWrapper:function(){var u;if(!this.collection.isFetched()){this.mask()}else{if(this.collection.size()>0){u=this.getTable()}else{u=this.buildEmptyView()}}if(this.elements&&this.elements.filterViewAll&&this.elements.filterGrantedOnly){if(this.collection&&this.collection===this.grantedCollection){this.elements.filterGrantedOnly.setClassName("primary");this.elements.filterViewAll.setClassName("default")}else{this.elements.filterViewAll.setClassName("primary");this.elements.filterGrantedOnly.setClassName("default")}}if(u){this.unmask();this.getBody().setContent(u)}},getTable:function(){var u=this;return[{tag:"table","class":"table table-hover table-select-process",html:[{tag:"tbody",html:this.collection.map(function(v){return u.getRow(v)})}]},this.buildPager()]},buildPager:function(){var v=this,u=this.collection.getMaxLimit();return u>v.collection.getLimit()?new p({limit:v.collection.getLimit(),offset:v.collection.getOffset(),type:1,pageLinks:7,max:u,showPageLinks:true,length:u,events:{onOffsetChange:function(w){v.mask();v.collection.setOffset(w);v.collection.fetch({onComplete:function(){v.updateWrapper()}})}}}):null},getRowIdentifier:function(u){return u.get("uid")},getRow:function(w){var y=this,v=this.toRemoveCollection.findWhere({uid:w.get("uid")})||this.toGrantCollection.findWhere({uid:w.get("uid")})||this.toUpdateCollection.findWhere({uid:w.get("uid")})||this.grantedCollection.findWhere({uid:w.get("uid")}),x=new j({className:"primary",type:"checkbox",name:"licenses[]",value:this.getRowIdentifier(w),id:this.getRowIdentifier(w),label:d.getTextFromHtml(this.getLabel(w)),checked:v?v.get("granted"):!!v,disabled:w.get("remove")===false}),u=f.createElement("div",{"class":"tooltip-wrapper",html:x}),z=f.createElement("tr",{"class":"tr-"+this.getRowIdentifier(w),"data-id":this.getRowIdentifier(w),html:[{tag:"td",html:u},{tag:"td","class":this.platform.canCrossCompany()&&!w.isTPA()&&!w.isCustom()?"":"text-right status",html:this.platform.canCrossCompany()&&!w.isTPA()&&!w.isCustom()?this._createCrossCompany(w,v):this.getInformation(w)}],events:{click:function(B){if(x.isDisabled()){return}else{if(!B.target.getParent(".toggle-switch")){var A=!x.isChecked();x.setCheck(A);w.set("granted",A);y.onToggleClick(x,w);s.stop(B)}}}}});return z},_createCrossCompany:function(w,v){var A=this,y,u=true,x=new j({className:"primary"+(u?"":" hidden"),type:"switch",name:"restricted[]",checked:true,disabled:true,value:w.get("uid"),label:f.i18n("Restrict Usage to this Platform")}),z;if(w.canCrossCompany()&&v){u=v.get("licensed")}if((v&&(v.get("crossCompanyDeseable")===false||v.get("crossCompanyDeseable")===true))||(w.get("crossCompanyDeseable")===false||w.get("crossCompanyDeseable")===true)){z=v?v.get("crossCompanyDeseable"):w.get("crossCompanyDeseable")}else{z=!w.canCrossCompany()}y=new j({className:"primary",type:"switch",name:"licensed[]",checked:u,disabled:z,value:w.get("uid"),attributes:{"data-trigram":w.get("trigram")},label:"",events:{onClick:function(C){var B=C.target.getParent("tr").getElement('[id="'+w.get("uid")+'"]').checked;w.set("licensed",this.isChecked());w.set("granted",B);if(!B&&A.grantedCollection.get(w)){A.toRemoveCollection.add(w);A.toRemoveCollection.get(w).unset("crossCompanyDeseable");A._manageCrossCompanySelection(w)}else{if(B&&A.grantedCollection.get(w)){A.toUpdateCollection.add(w);A.toGrantCollection.remove(w);A.toRemoveCollection.remove(w);A._manageCrossCompanySelection(w)}else{if(B){A.toGrantCollection.add(w);A._manageCrossCompanySelection(w)}}}}}});y.getContent().getElement("label").setContent([{tag:"span",text:f.i18n("Assign License")},{tag:"span",html:this.getInformation(w)}]);return[y,x]},_manageCrossCompanySelection:function(w){var y=this,u,z=this.container.getElements(".table-select-process tbody tr"),x,v=this.getCurrentCollection().find(function(A){return A.isWA()&&!A.canCrossCompany()&&y.platform.getCrossCompanyRoles().indexOf(A.get("trigram"))===-1});if(w&&y.platform.getCrossCompanyRoles().indexOf(w.get("trigram"))>-1){x=w}else{x=this.getCurrentCollection().find(function(A){return y.platform.getCrossCompanyRoles().indexOf(A.get("trigram"))>-1})}z.forEach(function(C){var B=C.getElement("[name=licensed\\[\\]]");if(x&&B){if(f.is(v)){if(y.platform.getCrossCompanyRoles().indexOf(B.getAttribute("data-trigram"))>-1){x.set("licensed",true);var A=y.getCurrentCollection().get(C.getAttribute("data-id"));if(A){A.set("licensed",x.get("licensed"));if(!y.grantedCollection.get(A)){y.toGrantCollection.add(A)}else{if(!y.toUpdateCollection.get(A)||(y.toUpdateCollection.get(A)&&y.toUpdateCollection.get(A).get("licensed")!==x.get("licensed"))){y.toUpdateCollection.add(A)}}B.checked=x.get("licensed");B.disabled=true}else{u=y.toGrantCollection.findWhere({uid:C.getAttribute("data-id")})}}}else{if(y.platform.getCrossCompanyRoles().indexOf(B.getAttribute("data-trigram"))>-1){var A=y.getCurrentCollection().get(C.getAttribute("data-id"));if(A){A.set("licensed",x.get("licensed"));if(!y.grantedCollection.get(A)){y.toGrantCollection.add(A)}else{if(!y.toUpdateCollection.get(A)||(y.toUpdateCollection.get(A)&&y.toUpdateCollection.get(A).get("licensed")!==x.get("licensed"))){y.toUpdateCollection.add(A)}}B.checked=x.get("licensed");B.disabled=false}else{u=y.toGrantCollection.findWhere({uid:C.getAttribute("data-id")})}}}}});y._updateCrossCompanyGrantedRoles(w,x,v)},_updateCrossCompanyGrantedRoles:function(v,w,u){var x=this;if(x.grantedCollection&&x.grantedCollection.length>0){if(!w){w=x.grantedCollection.find(function(y){return x.platform.getCrossCompanyRoles().indexOf(y.get("trigram"))>-1&&!x.toRemoveCollection.get(y)})}if(!u){u=this.grantedCollection.find(function(y){return y.isWA()&&!y.canCrossCompany()&&x.platform.getCrossCompanyRoles().indexOf(y.get("trigram"))===-1&&!x.toRemoveCollection.get(y)})}}if(x.toGrantCollection&&x.toGrantCollection.length>0){if(!w){w=x.toGrantCollection.find(function(y){return x.platform.getCrossCompanyRoles().indexOf(y.get("trigram"))>-1})}if(!u){u=this.toGrantCollection.find(function(y){return y.isWA()&&!y.canCrossCompany()&&x.platform.getCrossCompanyRoles().indexOf(y.get("trigram"))===-1})}}if(x.toUpdateCollection&&x.toUpdateCollection.length>0){if(!w){w=x.toUpdateCollection.find(function(y){return x.platform.getCrossCompanyRoles().indexOf(y.get("trigram"))>-1})}if(!u){u=this.toUpdateCollection.find(function(y){return y.isWA()&&!y.canCrossCompany()&&x.platform.getCrossCompanyRoles().indexOf(y.get("trigram"))===-1})}}x.grantedCollection.forEach(function(y){if(w){if(f.is(u)){if(x.platform.getCrossCompanyRoles().indexOf(y.get("id"))>-1){if(w&&w.get("licensed")!==true){w.set("licensed",true)}if(y.get("licensed")!==w.get("licensed")||y.get("crossCompanyDeseable")!==true){y.set("licensed",w.get("licensed"));y.set("crossCompanyDeseable",true);if(!x.toUpdateCollection.get(y)||(x.toUpdateCollection.get(y.get("id"))&&x.toUpdateCollection.get(y).get("crossCompanyDeseable")!==true)){x.toUpdateCollection.add(y)}}}}else{if(x.platform.getCrossCompanyRoles().indexOf(y.get("id"))>-1){if(y.get("licensed")!==w.get("licensed")||(x.toUpdateCollection.get(y.get("id"))&&x.toUpdateCollection.get(y).get("crossCompanyDeseable")!==false)){y.set("licensed",w.get("licensed"));y.set("crossCompanyDeseable",false);if(!x.toUpdateCollection.get(y)){x.toUpdateCollection.add(y)}}}}}});x.toGrantCollection.forEach(function(y){if(w){if(f.is(u)){if(x.platform.getCrossCompanyRoles().indexOf(y.get("id"))>-1){w.set("licensed",true);y.set("licensed",w.get("licensed"));y.set("crossCompanyDeseable",true)}}else{if(x.platform.getCrossCompanyRoles().indexOf(y.get("id"))>-1){y.set("licensed",w.get("licensed"));y.set("crossCompanyDeseable",false)}}}});x.toUpdateCollection.forEach(function(y){if(w){if(f.is(u)){if(x.platform.getCrossCompanyRoles().indexOf(y.get("id"))>-1){w.set("licensed",true);y.set("licensed",w.get("licensed"));y.set("crossCompanyDeseable",true)}}else{if(x.platform.getCrossCompanyRoles().indexOf(y.get("id"))>-1){y.set("licensed",w.get("licensed"));y.set("crossCompanyDeseable",false)}}}})},getLabel:function(u){var v=null;if(u.isOption()&&u.isSelfExp()){v=f.i18n("(Trial, Option)")}else{if(u.isSelfExp()){v=f.i18n("(Trial)")}else{if(u.isOption()){v=f.i18n("(Option)")}}}return v?u.get("name")+" "+v:u.get("name")},getInformation:function(v){var u="",w="";if(v.get("casual")>0){u=""}else{if(v.isSelfExp()){u=f.i18n("Expires on {0}").format(v.get("expireLong")||v.get("expire"))}else{if(v.get("start")){u=f.i18n("Granted {0}").format(v.get("startLong")||v.get("start"))}else{if(v.getDisplayType()){u=f.i18n("Type: {0}").format(v.getDisplayType())}else{if(!v.isCustom()){u=v.get("total")?f.i18n("Used: {0}/{1}").format((v.get("total")-v.get("free")),v.get("total")):""}}}}}return{tag:"span","class":w,text:this.platform.canCrossCompany()&&!v.isTPA()&&u!==""?" - "+u:u}},setStatus:function(v,w){var u=this.getContent().getElement(".tr-"+d.escapeDomSelector(this.getRowIdentifier(v))+" .status");if(u){u.setContent(w)}return true},resetStatus:function(u){this.setStatus(u,this.getInformation(u))},setLoadingStatus:function(u){this.setStatus(u,new g({visible:true}))},setUpdatedStatus:function(v){var u='<span class="text-success">'+f.i18n("Updated")+"</span>";this.setStatus(v,u)},setGrantedStatus:function(v){var u='<span class="text-success">'+f.i18n("Granted")+"</span>";this.setStatus(v,u)},setRemovedStatus:function(v){var u='<span class="text-error">'+f.i18n("Removed")+"</span>";this.setStatus(v,u)},buildSearch:function(){var w=this,v=function(){w.mask();w.collection.setQuery(this.value);w.collection.setOffset(0);w.collection.reset();w.collection.fetch({onComplete:function(){w.updateWrapper()}})},u=new b({attributes:{placeholder:w.options.searchPlaceholder,value:this.collection.getQuery()||"",events:{keyup:v}}});return{tag:"div",styles:{"text-align":"center","margin-top":5,"margin-bottom":15},html:[this.options.noFilter?null:this.buildFilter(),{"class":"input-search-center-wrapper",html:u},{"class":"clearfix"}]}},buildEmptyView:function(){if(this.emptyView===null){this.emptyView=new i()}this.emptyView.render(this.options.emptyText);return this.emptyView},isFullCollectionFresh:function(){return this.collection.getQuery()===this.fullCollection.getQuery()&&this.forceFullCollectionRefresh===false},isGrantedCollectionFresh:function(){return this.collection.getQuery()===this.grantedCollection.getQuery()&&this.forceGrantedCollectionRefresh===false},invalidCache:function(){this.forceGrantedCollectionRefresh=true;this.forceFullCollectionRefresh=true},filterGrantedOnly:function(){var u=this;this._activeFilter=e;u.elements.filterGrantedOnly.setClassName("primary");u.elements.filterViewAll.setClassName("default");if(!this.isGrantedCollectionFresh()){this.mask();this.grantedCollection.setQuery(u.collection.getQuery());this.grantedCollection.reset();this.grantedCollection.fetch({onComplete:function(){u.updateWrapper()}});u.collection=u.grantedCollection;this.forceGrantedCollectionRefresh=false}else{u.collection=u.grantedCollection;this.updateWrapper()}},filterViewAll:function(){var u=this;this._activeFilter=a;u.elements.filterGrantedOnly.setClassName("default");u.elements.filterViewAll.setClassName("primary");if(!this.isFullCollectionFresh()){this.mask();this.fullCollection.setQuery(u.collection.getQuery());this.fullCollection.reset();this.fullCollection.fetch({onComplete:function(){u.updateWrapper()}});u.collection=u.fullCollection;this.forceFullCollectionRefresh=false}else{u.collection=u.fullCollection;this.updateWrapper()}},buildFilter:function(){var u=this.elements;u.filterGrantedOnly=new h({value:(this.options.filterGrantedOnlyText)?this.options.filterGrantedOnlyText:f.i18n("View selected only"),className:"default",events:{onClick:this.filterGrantedOnly.bind(this)}});u.filterViewAll=new h({value:(this.options.filterViewAllText)?this.options.filterViewAllText:f.i18n("View all"),className:"default",events:{onClick:this.filterViewAll.bind(this)}});return{"class":"pull-left filter-group",styles:{"margin-top":0},html:[new m({buttons:[u.filterGrantedOnly,u.filterViewAll]})]}},getSelectedCollection:function(){var u=this.platform.canCrossCompany();return{add:this.toGrantCollection.map(function(v){return u?{uid:v.get("uid"),licensed:v.get("licensed"),restricted:true}:{uid:v.get("uid"),licensed:true,restricted:true}}),update:this.toUpdateCollection.map(function(v){return u?{uid:v.get("uid"),licensed:v.get("licensed"),restricted:true}:{uid:v.get("uid"),licensed:true,restricted:true}}),remove:this.toRemoveCollection.map(function(v){return u?{uid:v.get("uid"),licensed:v.get("licensed"),restricted:true}:{uid:v.get("uid"),licensed:true,restricted:true}})}},getCurrentCollection:function(){var u=this;var v=new r(this.grantedCollection.toJSON());v.add(this.toGrantCollection.toJSON());this.toRemoveCollection.forEach(function(w){v.remove(w.get("uid"))});return v},onToggleClick:function(u,v){var x=this,w;if(this.grantedCollection.hasPagination()){}if(u.isChecked()){if(v.hasFree()||v.isTPA()||v.isCustom()){w=new c({selectedCollection:this.getCurrentCollection(),platform:x.platform,model:v,number:0,onConfirm:function(y){y.forEach(function(z){if(z&&!x.toUpdateCollection.get(z)&&!x.grantedCollection.get(z)){z.set("granted",true);x.toGrantCollection.add(z)}else{if(z&&x.grantedCollection.get(z)){z.set("granted",true);x.toGrantCollection.add(z)}}x.toRemoveCollection.remove(z)});x.toGrantCollection.add(v);x.toRemoveCollection.remove(v);x._manageCrossCompanySelection(v);x.updateWrapper()},onCancel:function(){u.uncheck()}});if(w.isNeeded()){w.confirm()}else{if(!x.toUpdateCollection.get(v)&&!x.grantedCollection.get(v)){x.toGrantCollection.add(v);x.toRemoveCollection.remove(v)}else{x.toUpdateCollection.add(v);x.toRemoveCollection.remove(v);x.toGrantCollection.remove(v)}x._manageCrossCompanySelection(v);x.updateWrapper()}}else{l.warn(f.i18n("You have not enough role"))}}else{w=new k({model:v,selectedCollection:this.getCurrentCollection(),onCancel:function(){u.check()}});if(w.isNeeded()){w.show()}else{this.toGrantCollection.remove(v);this.toUpdateCollection.remove(v);if(this.grantedCollection.findWhere({uid:v.get("uid")})){this.toRemoveCollection.add(v);this.toRemoveCollection.get(v).unset("crossCompanyDeseable")}x._manageCrossCompanySelection(v);x.updateWrapper()}}},getBody:function(){if(!this.content){this.content=this.container.getElement(".wrapper")}return this.content},mask:function(){if(!this.isMasked()){t.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){t.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked}})});define("DS/PlatformManagement/Modal/ShareRolesModal",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Controls/Pager","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/Mask","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/GrantTable2","DS/PlatformManagementComponents/Model/Platform","DS/UIKIT/Input/Button","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Collection/PlatformRoleCollection","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(h,o,n,p,c,s,l,e,m,f,a,b,r,k,g,q,d,j){var i=o.extend({tagName:"div",className:"facet-roles",setup:function(t){this.options=t||{};if(t.platform){this.platform=t.platform}return this._parent(t)},render:function(){this.grantView=new b({fullCollection:new d([],{data:{platform:this.platform.get("id")}}),grantedCollection:new d([],{data:{platform:this.platform.get("id"),granted:true}}),platform:this.platform,searchPlaceholder:h.i18n("Search Roles"),filterViewAllText:h.i18n("View all"),filterGrantedOnlyText:h.i18n("View selected roles only"),emptyText:h.i18n("No Roles found")});this.container.setContent(this.grantView.render());return this}});return n.extend({content:null,cache:null,locationsView:null,init:function(u){var v=this,t=j.extend({url:"platform/share/roles"});this.platform=u.platform;this.model=new t();this.view=new i({platform:v.platform});this._parent(u);this.modal=new c({closable:true,header:"",body:"",footer:[new k({value:h.i18n("Save"),className:"primary",events:{onClick:function(){v.model.save({id:v.platform.get("id"),shareRoles:JSON.stringify(v.view.grantView.getSelectedCollection())},{patch:true,onComplete:function(){v.modal.unmask();m.success(h.i18n("Settings have been saved"));v.modal.hide()},onFailure:function(){v.modal.unmask()}})}}}),new k({className:"default",value:h.i18n("Cancel"),events:{onClick:function(){v.modal.hide()}}})],events:{onHide:function(){this.destroy()}}});this.elements.container=this.modal},show:function(){var t=this;t.modal.mask();this.modal.inject(document.body,"top").show();g.fetch({onComplete:function(){t.modal.setHeader(h.i18n("Select roles and licenses to assign"));t.modal.setBody(t.view.render());t.modal.unmask()}});return this}})});define("DS/PlatformManagement/Controls/Input/Tagger",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Input/Text","DS/PlatformManagement/Controls/Tags","DS/PlatformManagement/Utils"],function(e,d,b,a,c){return d.extend({defaultOptions:{validator:function(f){return(f.length>0)},onSuccess:function(){},onError:function(){},onLimitError:function(){},placeholder:"",limit:null,onChange:function(){}},isFirst:true,init:function(f){var g=this;g._parent(f);this.buildContainer();setTimeout(function(){g.elements.input.focus()},1)},buildContainer:function(){this.elements.container=e.createElement("div",{html:[{"class":"tags-input-wrapper",html:[{"class":"tag-wrapper"},{"class":"tag-input-wrapper",html:this.buildInput()}]},{"class":"clearfix"}]})},buildInput:function(){var f=this;this.elements.input=new b({className:"pull-right",attributes:{type:"email",placeholder:this.options.placeholder,autofocus:this.options.focus||null,events:{keydown:function(g){if(g.keyCode===9){f.paste(false,true)}},keyup:function(g){if(g.keyCode!==17){if(g.keyCode===13||g.keyCode===188){f.paste(false,true)}else{f.paste(true,true)}}},drop:function(){f.paste(false,true)},paste:function(){f.paste(false,true)},blur:function(){f.paste(false,false)}}}});return this.elements.input},paste:function(h,g){var f=this;setTimeout(function(){var o=f.elements.input.getValue(),p=o,m,q,j,i=f.elements.container.getElement(".tags-input-wrapper"),n=f.elements.container.getElement(".tag-input-wrapper"),l,k=true;if(!h&&o.contains(" ")){l=c.extractEmails(o);if(l){o=l.join(";")}}if((h&&o.indexOf(";")>-1)||!h){m=o.split(";");m.forEach(function(s,r){if(s!==""){if(f.options.validator(s)&&(f.options.limit!==null&&f.getSelected().length<f.options.limit)){if(f.getSelected().indexOf(s)===-1){q=f.buildTag(s);q.inject(i);q.asyncCheck();k=false;j=(r+1===m.length)?"":";";o=o.replace(s+j,"")}}else{if(f.options.validator(s)&&f.getSelected().length===f.options.limit){if(!n.hasClassName("has-error")){n.addClassName("has-error");n.addClassName("has-error-limit");k=true}}else{k=true}}}});if(o!==p){f.elements.input.setValue(o);f.syncInputSize();if(g){setTimeout(function(){f.elements.input.focus()},1)}}if(k){f.validate()}}},0)},buildTag:function(g){var f=this;return new a({text:g,onDestroy:function(){setTimeout(function(){f.syncInputSize();f.validate()},10)},onChange:function(){f.syncInputSize();f.validate()},onError:function(){f.syncInputSize();f.options.onError()},syncInputSize:f.syncInputSize.bind(this),validator:f.options.validator,validatorAsync:f.options.validatorAsync})},validate:function(){var f=this;setTimeout(function(){var g=f.elements.container.getElement(".tag-input-wrapper");if(g){if(f.elements.input.getValue()!==""||f.getContent().getElements(".uwa-input-split.has-error").length!==0){if(!g.hasClassName("has-error")){g.addClassName("has-error")}if((g.hasClassName("has-error-limit"))&&(f.getSelected().length===f.options.limit)){f.options.onLimitError()}else{g.removeClassName("has-error-limit");f.options.onError()}}else{g.removeClassName("has-error");f.options.onSuccess()}}},10)},syncInputSize:function(){var i=0,h=this,g=h.elements.container.getSize().width,j=g,f=[];h.elements.container.getElements(".uwa-input-tags").forEach(function(k){k.inject(h.elements.container.getElement(".tags-input-wrapper"))});h.elements.container.getElements(".uwa-input-tags").forEach(function(k){i=i+k.getDimensions().outerWidth;if(h.isFirst){i=i+5}f.push(k);if(i>g-200){f.forEach(function(l){h.elements.container.getElement(".tag-wrapper").grab(l)});f=[];i=0}});if(h.isFirst){h.isFirst=false}if(g-i>200){j=g-i}if(i>0){h.elements.container.getElement("input").setStyle("width",j-5)}else{h.elements.container.getElement("input").setStyle("width","100%")}h.options.onChange()},getSelected:function(){var f=[];this.elements.container.getElements(".uwa-input-tags span.form-control").forEach(function(g){f.push(g.getHTML())});return f}})});define("DS/PlatformManagement/Modal/InviteMember",["UWA/Core","UWA/Controls/Abstract","UWA/Controls/Input","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/File","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Input/Tagger","DS/PlatformManagement/Utils","DS/PlatformManagement/Views/SelectAppsView","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Collection/AppsCollection","DS/PlatformManagement/Collection/MemberCollection","DS/PlatformManagement/Model/ImportModel","DS/PlatformManagement/Views/LocationView","DS/PlatformManagement/Model/PlatformModel","DS/PlatformManagement/Model/UserRightModel","DS/PlatformManagement/Views/StepsView","UWA/Class/Model","UWA/Class/Collection"],function(d,J,y,u,r,e,m,l,b,C,z,j,n,A,a,v,i,t,o,g,E,w,f,s,I,B,c){var H=0,h=1,k=10,F=0,q=999,x="-1",p="Contractor",G,D;return J.extend({defaultOptions:{platform:null,onAdded:function(){}},casualType:{casual:F},mode:H,step:0,viewStep2Casual:null,viewStep3Casual:null,id:v.getUUID(),selectedLicenses:[],nextButtonDisabled:true,locationsView:null,init:function(K){var L=this;L._parent(K);if(K.mode){this.mode=K.mode}this.platform=K.platform;this.inviteInProgress=false;this.uploadInProgress=false;L.casualHasRole={};this.buildContainer()},buildContainer:function(){var M=this,N=new t([]),L=4,K=function(){L--;if(L===0){M.viewStep1=M.buildContent();M.modal.unmask();M.elements.container.setBody(M._getTemplate(M.viewStep1));M.dispatchEvent("onRendered")}};this.modal=new e({closable:true,className:"invite-member",header:this.getModalTitle(),body:{"class":"empty-body"},footer:"",events:{onHide:function(){G=null;this.destroy()}}});this.elements.container=this.modal;this.elements.container.inject(document.body,"top").show();this.modal.mask();M.elements.container.setFooter(M.getButtons());new s().fetch({onComplete:function(O,P){M.roles=P.roles;M.agreements=P.agreements;K()}});M.platform.fetch({data:{id:this.platform.get("id"),availability:true},onComplete:function(O){M.data=O.toJSON();M.locationsView=new w({text:d.i18n("Select users location")+" <em>"+d.i18n("(Used to optimize performances)")+"</em>",platform:M.platform,layout:"invite"});K()}});N.fetch({data:{selfexp:false,platform:M.platform.get("id"),casual:0,limit:1,apps:false},onComplete:function(O){M.casualHasRole[M.casualType.casual]=O.length>0;M.manageButtonNextText(M.casualHasRole[M.casualType.casual]);K()}});v.getParentModule("DS/UWPClientCode/I18n",function(O){D=O;K()})},_canCrossCompany:function(){return this.mode===H&&this.platform.canCrossCompany()},buildContent:function(){var R,M=D.getSupportedLanguages(),S,P,Q,K=[],O=this,L=this.buildCasual(),N=new c([{id:1,label:d.i18n("Members")},{id:2,label:d.i18n("Roles")}]);if(this.platform.isPlatform()){N.add({id:3,label:d.i18n("Additional Apps")})}if(!this.stepsView){this.stepsView=new I({collection:N,stepNumber:this.step+1}).render()}else{this.stepsView.setStep(this.step+1)}if(this.step===0){for(S in M){if(M.hasOwnProperty(S)){P=M[S];Q=P.localizedName+" ("+P.staticName+")";K.push({value:S,label:Q,selected:S===v.getLang()})}}if(this.mode===H){this.elements.tagger=new a({placeholder:d.i18n("Enter email"),limit:this._getMinAvailability(),focus:true,validator:function(T){return v.isEmail(T)},onError:function(){var T=O.casualType.free===0&&!O._canCrossCompany()?d.i18n("No more roles available"):d.i18n("Your Email is not valid");if(!O.errorInterval){setTimeout(function(){if(O.elements.container.isVisible===true){n.alert(T)}},200);O.errorInterval=true;setTimeout(function(){O.errorInterval=null},2000)}O.setNextDisabled(true)},onLimitError:function(){var T=(k<O.casualType.free)?d.i18n("The number of invitations is limited to ten. If you need to invite more than ten people, use the batch invitation available in the Import Members tab."):d.i18n("No more roles available");if(O._getMinAvailability()<k&&O._getMinAvailability()<O.casualType.free){T=d.String.format(d.i18n("You can't add more than {0} emails because of selected roles"),O._getMinAvailability())}if(!O.errorInterval){n.alert(T);O.errorInterval=true;setTimeout(function(){O.errorInterval=null},2000)}O.setNextDisabled(true)},onSuccess:function(){var T=O.elements.tagger.getSelected().length;if(O.elements.tagger.elements.container.getElement(".has-error")===null){if((T>0&&(O.platform.get("platform")===true))||(T>0&&O.platform.get("platform")===false)){O.setNextDisabled(false)}else{O.setNextDisabled(true)}}else{O.setNextDisabled(true)}},validatorAsync:function(U,V){var T=new g();O.setNextDisabled(true);T.setLimit(15);T.setOffset(0);T.setQuery(U);T.setPlatform(O.platform.get("id"));T.fetch({onComplete:function(){var W=T.find(function(X){return X.get("email").toLowerCase()===U.toLowerCase()});if(d.is(W)){n.alert(d.i18n("You cannot invite a user already on the platform"));O.setNextDisabled(true);V.onFailure()}else{V.onComplete()}},onFailure:function(){V.onFailure()}})},onChange:function(){var T=O.elements.tagger.getSelected().length;if(O.platform!=="none"){O.updateAvailability()}if(T){O.setNextDisabled(true)}}})}else{this.elements.iframe=d.createElement("iframe",{"class":"hidden",id:"uploadFrame"+this.id,name:"uploadFrame"+this.id,src:A.getUrl("resources")+"s.gif",events:{load:function(){if(O.uploadInProgress){O.uploadInProgress=false;setTimeout(function(){O.modal.unmask();n.success(d.i18n("Import has been created"));if(O.options.onAdded){O.options.onAdded()}O.hide()},300)}else{O.modal.unmask()}}}});this.elements.form=d.createElement("form",{"class":"form-wrapper",action:"#",method:"POST",enctype:"multipart/form-data",target:"uploadFrame"+this.id,html:[{tag:"input",type:"hidden",name:"__fcs__jobTicket",id:"__fcs__jobTicket"},new j({showResetButton:false,className:"input-file",attributes:{name:"file_import"},buttonBefore:false,events:{onChange:function(){var U=this.elements.input,V=this.getValue(),W=v.getFileExtension(V),T=U.getParent(".form-group");if(V!==""&&W==="csv"){T.removeClassName("has-error");O.setNextDisabled(false)}else{if(V!==""){O.setNextDisabled(true);T.addClassName("has-error");n.alert(d.i18n("Wrong file type. Please select a correct csv file."));this.setValue()}else{T.removeClassName("has-error");O.setNextDisabled(true)}}}}}),{tag:"a",target:"_blank",href:v.getAsset("data/import-sample.csv"),html:new C({value:d.i18n("See Example"),events:{onClick:function(){if(d.Utils.Client.Engine.ie){window.open(v.getAsset("data/import-sample.csv"))}}}})},{tag:"input",type:"hidden",value:A.getUrl("faillurePageImport"),name:"__fcs__failurePage",id:"__fcs__failurePage"},{tag:"input",type:"hidden",value:"false",name:"attachment",id:"attachment"},{tag:"input",type:"hidden",value:"",name:"file_0_name",id:"file_0_name"}]})}R=d.createElement("div",{html:[{"class":"row",html:{"class":"form-group col-sm-12",html:[this.elements.availability,{tag:"label","class":"control-label",html:this.mode===H?(d.i18n("Invite by email")+" <em>"+d.i18n("(If multiple separate by ';')")+"</em>"):d.i18n("Select a file to import")},this.mode===H?{"class":"wrapper",html:this.elements.tagger}:[this.elements.form]]}},this.mode===H?{"class":"row",html:[this.displayCompany()?this.buildCompany():this.buildPlatform()]}:{"class":"row",html:this.buildCompany()},this.mode===H?this.displayCompany()?{"class":"row",html:[this.buildPlatform()]}:{styles:{width:"40%"},html:this.buildCompany()}:null,{styles:{clear:"both"}},{"class":"row",html:L},this.locationsView.hasLocations()?{"class":"row",html:{"class":"form-group col-sm-6",html:this.locationsView.render()}}:null,{"class":"row",html:{"class":"form-group col-sm-6",html:[{tag:"label","for":"language-"+this.id,text:d.i18n("Invitation Email language")},new l({attributes:{id:"language-"+this.id,name:"language"},placeholder:false,options:K,className:"select-language"})]}},{"class":"row",html:{"class":"form-group col-sm-12",html:[{tag:"label","for":"text-"+this.id,text:d.i18n("Add a message")},new m({multiline:true,attributes:{id:"text-"+this.id,name:"text",styles:{height:80}}})]}}]})}else{if(this.step===1){if(!O.viewStep2||O.viewStep2Casual!==O.casualType.casual){O.viewStep2Casual=O.casualType.casual;R=d.createElement("div",{html:[this.stepsView,O.buildLicensesSkeleton()]});O.viewStep2=R}else{R=G.render();G._manageNextButton()}}else{if(!O.viewStep3||O.viewStep3Casual!==O.casualType.casual){O.viewStep3Casual=O.casualType.casual;R=d.createElement("div",{html:[this.stepsView,O.options.hasApp?O.buildAppsSkeleton():null]});O.viewStep3=R}else{R=O.viewStep3;G._manageNextButton()}}}return R},updateAvailability:function(){var K=this.elements.availability;K.setText(this.getAvailabilityText());this.elements.tagger.options.limit=this._getMinAvailability()},_getMinAvailability:function(){var K,L=k;if(!this._canCrossCompany()){if(G){K=G.getMaxFreeRole();if(K){L=Math.min(K,L)}}else{L=Math.min(this.casualType.free,L)}}return Math.min(k,L)},getAvailabilityText:function(){var L=this.elements.tagger?this.elements.tagger.getSelected().length:0,N=this.casualType,M=N.total-N.free+L,K=M+"/"+N.total;return d.String.format(M>1?d.i18n("Used invitations: {0}"):d.i18n("Used invitation: {0}"),K)},buildCasual:function(){var M=this.data.availability,L=[],N=this,K;M.forEach(function(O){if(!d.is(N.casualType.free)&&N.casualType.casual===O.casual){N.casualType=O}if(!L.detect(function(P){return P.value===""+O.casual})){L.push({value:""+O.casual,label:O.casual===0?d.i18n("Unlimited"):d.String.format(d.i18n("Casual {0}h/month"),O.casual),selected:N.casualType.casual===O.casual})}});this.elements.availability=d.createElement("span",{"class":"pull-right"+(N._canCrossCompany()?" hidden":""),text:this.getAvailabilityText(this.casualType)});K=new l({attributes:{name:"casual",id:"casual-"+this.id},placeholder:false,options:L,events:{onChange:function(){var O=parseInt(this.getValue()[0],10),P=new t([]);N.casualType=d.Array.detect(M,function(Q){return Q.casual===O});if(!N.options.hasApp){if(!d.is(N.casualHasRole[N.casualType.casual])){N.modal.mask();P.fetch({data:{limit:1,platform:N.platform.get("id"),casual:N.casualType.casual,selfexp:false,apps:false},onComplete:function(Q){N.modal.unmask();N.casualHasRole[N.casualType.casual]=Q.length>0;N.manageButtonNextText(N.casualHasRole[N.casualType.casual])}})}else{N.manageButtonNextText(N.casualHasRole[N.casualType.casual])}}N.updateAvailability()}}});return[{"class":L.length>1?"form-group col-sm-6":"form-group col-sm-6 hidden",html:[{tag:"label","for":"casual-"+this.id,text:d.i18n("Usage Type")},K]}]},displayCompany:function(){var K=this.data.companies||[];return K.length>1},buildCompany:function(){var M=this.data.companies||[],K=[],L=this;M.forEach(function(N){K.push({value:N.id,label:v.isEmptyString(N.name)?N.id:N.name})});L.elements.company=new l({attributes:{name:"company",id:"company-"+this.id},placeholder:false,options:K,events:{onChange:function(){}}});return{"class":this.displayCompany()?"form-group col-sm-6":"form-group col-sm-6 hidden",html:[{tag:"label","for":"company-"+this.id,text:d.i18n("Company")},L.elements.company]}},buildRoles:function(){var M,K=this.roles.length,L=[],N=this;for(M=0;M<K;M++){if(this.roles[M].id!=="2"){L.push({value:this.roles[M].id,label:this.roles[M].name})}}L.push({value:x,label:d.i18n(p)});N.elements.roles=new l({attributes:{name:"role",id:"role-"+this.id},placeholder:false,options:L,events:{onChange:function(){}}});return N.elements.roles},buildSelectAgreement:function(){var N=this,L=[],K=this.agreements.length,M;for(M=0;M<K;M++){if(this.agreements[M].id!=="-1"){L.push({value:this.agreements[M].id,label:this.agreements[M].name})}}this.selectAgreement=new b({type:"checkbox",name:"agreement",value:"",label:d.i18n("Contractor"),className:"primary",events:{onClick:function(){N.elements.roles.setDisabled(this.isChecked())}}});return this.selectAgreement},getModalTitle:function(){var K=d.i18n("Invite members");if(this.platform.get("platform")===false){K=d.i18n("Grant Roles")}return K},buildPlatform:function(){return{"class":"form-group col-sm-6"+(this.platform.isPlatform()?"":" hidden"),html:[{tag:"label","for":"role-"+this.id,text:d.i18n("User rights")},this.buildRoles()]}},buildLicensesSkeleton:function(){var O=this,N=0,Q=new t([],{data:{platform:this.platform.get("id"),casual:this.casualType.casual,selfexp:false,apps:false,withLicenses:true}}),L=new t([],{data:{platform:this.platform.get("id"),casual:this.casualType.casual,selfexp:false,apps:false,withLicenses:false}}),P=new t(),K=new i({disabledCrossCompany:!O._canCrossCompany(),isBatchInvite:O.mode===h,collection:Q,titleTableCollection:(O.platform.canCrossCompanyExtended()&&O._canCrossCompany())?d.i18n("Available roles with licenses"):null,collectionWithOutLicenses:(O.platform.canCrossCompanyExtended()&&O._canCrossCompany())?L:null,titleTableCollectionWithOutLicenses:(O.platform.canCrossCompanyExtended()&&O._canCrossCompany())?d.i18n("Available roles without any license"):null,collectionSelected:P,searchPlaceholder:d.i18n("Search Roles"),tagger:this.elements.tagger,platform:this.platform,setNextDisabled:this.setNextDisabled.bind(this)}),M=d.createElement("span",{"class":"fonticon fonticon-down-dir",styles:{opacity:"1"}});G=K;Q.setLimit(q);Q.fetch({onComplete:function(){if(!O.platform.canCrossCompanyExtended()||!O._canCrossCompany()||N===2){K.render()}else{N=1}}});if(this.platform.canCrossCompanyExtended()&&O._canCrossCompany()){L.setLimit(q);L.fetch({onComplete:function(){if(N===1){K.render()}else{N=2}}})}return[K.render(),{"class":"clearfix"}]},buildAppsSkeleton:function(){var N=new o([],{data:{platform:this.platform.get("id")}}),M=new o(),K=new i({collection:N,platform:this.platform,collectionSelected:M,searchPlaceholder:d.i18n("Search Additional Apps")}),L=d.createElement("span",{"class":"fonticon fonticon-down-dir",styles:{opacity:"1"}});N.setLimit(q);N.fetch({onComplete:function(){K.render()}});return[K.render(),{"class":"clearfix"}]},onClickInvite:function(){var O=this,N=[],M=this.viewStep2.getElements(".table-selection tbody tr"),P=O.elements.container.getBody().getElements(".table-selection tbody tr");if(this.inviteInProgress===false&&this.uploadInProgress===false){this.inviteInProgress=true;P.forEach(function(Q){M.push(Q)});M.forEach(function(S){var R=S.getElement("[name=licenses\\[\\]]:checked"),T=S.getElement("[name=licensed\\[\\]]"),Q=S.getElement("[name=restricted\\[\\]]");if(O._canCrossCompany()){N.push({id:R.value,licensed:T&&T.checked,restricted:Q&&Q.checked})}else{N.push({id:R.value})}});O.modal.mask();if(O.mode===H&&O.elements.tagger.getSelected().length>0&&(O.platform.get("platform")===true||(O.platform.get("platform")===false&&N.length>0))){var K=O.viewStep1.getElement("[name=role]").value,L="0";if(K!==x){L="0"}else{K="1";L="1"}A.platformInvite({platform:O.platform.get("id"),emails:O.elements.tagger.getSelected().join(","),role:K,agreement:L,language:O.viewStep1.getElement("[name=language]").value,text:O.viewStep1.getElement("[name=text]").value,licenses:JSON.stringify(N),company:O.viewStep1.getElement("[name=company]").value,casual:O.casualType.casual,location:this.locationsView.getValue()},{onComplete:function(Q){O.inviteInProgress=false;n.success(Q.message);O.options.onAdded();O.hide()},onFailure:function(){O.inviteInProgress=false;O.hide()}})}else{if(O.mode===h){new E().save({platform:O.platform.get("id"),language:O.viewStep1.getElement("[name=language]").value,text:O.viewStep1.getElement("[name=text]").value,licenses:JSON.stringify(N),company:O.viewStep1.getElement("[name=company]").value,casual:O.casualType.casual,location:this.locationsView.getValue()},{patch:true,onComplete:function(Q){O.inviteInProgress=false;O.uploadInProgress=true;O.elements.form.inject(O.elements.container.elements.body);O.elements.iframe.inject(O.elements.container.elements.body);O.elements.form.addClassName("hidden");O.elements.form.getElement("[name=__fcs__jobTicket]").setAttribute("value",Q.get("fcsJobTicket"));O.elements.form.getElement("[name=file_0_name]").setAttribute("value",O.elements.form.getElement("[name=file_import]").value);O.elements.form.setAttribute("action",Q.get("fcsUrl"));O.elements.form.setAttribute("target","uploadFrame"+O.id);O.elements.form.setAttribute("enctype","multipart/form-data");O.elements.form.submit()},onFailure:function(){O.hide()}})}}}},needSecondStep:function(){return this.casualHasRole[this.casualType.casual]===true||this.options.hasApp},manageButtonNextText:function(){this.nextButton.setValue(this.getButtonNextText())},getInviteText:function(){return this.platform.isPlatform()?d.i18n("Invite"):d.i18n("Grant")},getButtonNextText:function(){return this.needSecondStep()?d.i18n("Next"):this.getInviteText()},getButtons:function(){var L=this,K=[];if(this.step===2||this.step===1){K.push(new C({value:d.i18n("Back"),className:"default pull-left",events:{onClick:function(){L.step=L.step-1;L.nextButtonDisabled=false;L.elements.container.setFooter(L.getButtons());(L.step===0)?L.elements.container.setBody(L._getTemplate(L.viewStep1)):L.elements.container.setBody(L._getTemplate(L.viewStep2))}}}))}if(this.step===2||(this.step===1&&this.platform.isPlatform()===false)){this.nextButton=new C({value:this.getInviteText(),className:"primary",disabled:L.platform.get("platform")===false,events:{onClick:this.onClickInvite.bind(this)}});K.push(d.createElement("span",{"class":"tooltip-wrapper",html:this.nextButton}))}else{this.nextButton=new C({value:this.getButtonNextText(),className:"primary",disabled:L.nextButtonDisabled,events:{onClick:function(){if(this.needSecondStep()){this.step=(this.step===0)?1:2;this.elements.container.setFooter(this.getButtons());if(this.step===1){this.viewStep2=L.buildContent();this.elements.container.setBody(this._getTemplate(this.viewStep2))}else{this.viewStep3=L.buildContent();this.elements.container.setBody(this._getTemplate(this.viewStep3))}this.dispatchEvent("onNextViewRendered")}else{this.onClickInvite()}}.bind(this)}});K.push(d.createElement("div",{"class":"tooltip-wrapper",html:this.nextButton}))}K.push(new C({className:"default",value:d.i18n("Cancel"),events:{onClick:function(){L.elements.container.hide()}}}));L.elements.container.buttons=K;return K},_getTemplate:function(K){this.stepsView.setStep(this.step+1);return[this.stepsView,K]},setNextDisabled:function(M){var K=this.step===1?1:0,L=this.nextButton;L.setDisabled(M);if(!M){this.dispatchEvent("onNextAvailable")}if(this.tooltip){this.tooltip.destroy();this.tooltip=null}if(M){this.tooltip=new r({position:"top",target:this.elements.container.buttons[K],body:this.step===1?d.i18n("You need to select a least one role"):d.i18n("You need to add a least one email")})}this.nextButtonDisabled=M}})});define("DS/PlatformManagement/Modal/MemberDetails2",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Controls/Pager","DS/W3DXComponents/IdCard","DS/W3DXComponents/Views/Layout/ScrollView","DS/PlatformManagement/Modal/FullScreenIdCardModal","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/PlatformAPI/PlatformAPI","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/MemberCollection","DS/PlatformManagement/Model/MemberDetailsModel","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Collection/UserRoleCollection","DS/PlatformManagement/Collection/UserTpaCollection","DS/PlatformManagement/Views/GrantTable","DS/PlatformManagementComponents/Model/Platform","DS/PlatformManagement/Collection/AppsCollection","DS/PlatformManagement/Model/LegalNoticeModel","DS/PlatformManagement/Collection/SelfExperienceCollection","DS/UIKIT/Input/Button","DS/PlatformManagement/Views/LocationView","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Model/UserRightModel","DS/UIKIT/DropdownMenu"],function(f,Q,R,N,n,G,h,u,e,H,a,q,z,s,I,k,E,r,L,b,D,c,m,j,x,F,l,M,K,S,A,o){var d=0,i=1,g=3,O=4,t=s.getUser().login,J="-1",w="Contractor",C="3",v=Q.extend({tagName:"div",className:"facet-roles",setup:function(T){this.options=T||{};if(T.platform){this.platform=T.platform}this.collection=new k();return this._parent(T)},render:function(){var U=this,T=(this.platform.canCrossCompanyExtended())?new D([],{data:{platform:this.platform.getId(),user:this.model.getUserId(),casual:this.model.get("casual"),withLicenses:false}}):null;this.container.setContent(new m({fullCollection:new D([],{data:{platform:this.platform.getId(),user:this.model.getUserId(),casual:this.model.get("casual"),withLicenses:true}}),fullCollectionWithOutLicenses:T,grantedCollection:new D([],{data:{platform:this.platform.getId(),user:this.model.getUserId(),casual:this.model.get("casual"),granted:true}}),titleTableCollection:(this.platform.canCrossCompanyExtended())?f.i18n("Available roles with licenses"):null,titleTableCollectionWithOutLicenses:(this.platform.canCrossCompanyExtended())?f.i18n("Available roles without any license"):null,platform:this.platform,model:this.model,searchPlaceholder:f.i18n("Search Roles"),filterViewAllText:f.i18n("View all"),filterGrantedOnlyText:f.i18n("View roles granted"),emptyText:f.i18n("No Roles found"),events:{onRemoveAllGrantedRole:function(){U.dispatchEvent("onRemoveAllGrantedRole")}}}).render());return this}}),y=Q.extend({tagName:"div",className:"action-replace-me",setup:function(T){if(T.platform){this.platform=T.platform}if(T.mask){this.mask=T.mask}if(T.unmask){this.unmask=T.unmask}return this._parent(T)},render:function(){var V=this,U=new M({value:f.i18n("Replace Me"),disabled:!this.canBeReplaced(),className:"warning",events:{onClick:function(){V._getReplaceModal().inject(document.body).show()}}}),T=f.createElement("div",{"class":"tooltip-wrapper",html:U});if(U.isDisabled()){this.tooltip=new z({position:"bottom",target:T,body:f.i18n("Available if you are connected to this platform for more than 30 days, have only 1 platform and don't have casual license")})}this.container.setContent([T,{tag:"span",text:this._getHelpText()}]);return this},mask:function(){},unmask:function(){},canBeReplaced:function(){return f.is(this.model.get("replace"))&&this.model.get("replace").enable},_validateFields:function(){var U=this._getReplaceModal().getBody().getElement(".form-group"),T=false;if(f.String.isEmail(this._getEmailValue())){U.removeClassName("has-error")}else{U.addClassName("has-error");T=true}return !T},_getReplaceModal:function(){var T=this;if(!this.modal){this.modal=new u({closable:true,className:"replace-me",header:f.i18n("Replace Me"),body:"",footer:[new M({value:f.i18n("Replace Me"),className:"warning",events:{onClick:function(){if(T._validateFields()){T._showConfirmModal()}}}}),new M({className:"default",value:f.i18n("Cancel"),events:{onClick:function(){T.modal.hide()}}})],events:{onHide:function(){this.destroy();T.modal=null}}});this.modal.setBody([{"class":"bs-callout bs-callout-warning",html:[{tag:"h4",text:f.i18n("Caution")},{text:f.i18n("The person you invite to replace you as the Administrator will take ownership of your license and become the Administrator of the platform. You will no longer have access to the 3DEXPERIENCE platform once the person clicks the link to accept.")}]},{"class":"row",html:[{"class":"form-group col-sm-12",html:[{tag:"label","for":"email-"+this.cid,text:f.i18n("Send Administrator invitation to")},new q({id:"email-"+this.cid,name:"email",placeholder:f.i18n("Enter email"),attributes:{type:"email",events:{blur:this._validateFields.bind(this)}}}),{"class":"error-text",text:f.i18n("Must be a valid email")}]}]},{"class":"row",html:[{"class":"form-group col-sm-12",html:[{tag:"label","for":"message-"+this.cid,text:f.i18n("Add a message")},new q({id:"message-"+this.cid,name:"message",attributes:{maxlength:255},multiline:true,rows:4})]}]}])}return this.modal},_getHelpText:function(){var U=this.model.get("replace")&&this.model.get("replace").user,T=f.i18n("Invite someone to replace you as the Administrator of this platform");if(f.is(U)&&U!==""){T=f.String.format(f.i18n("Waiting for {0} to accept the invitation to replace you as Administrator. Click Replace Me to resend the invitation or invite someone else to replace you"),U)}return T},_showConfirmModal:function(){var U=this,T=f.String.format(f.i18n("Are you sure you want to be replaced by {0}?"),this._getEmailValue());new e({closable:false}).confirm(T,f.i18n("Confirmation"),function(V){if(V){U._confirm()}I.manageSupportOfMultiModal()})},_getEmailValue:function(){return this.modal.getBody().getElement("[name=email]").value},_getDescriptionValue:function(){return this.modal.getBody().getElement("[name=message]").value},_confirm:function(){var T=this;this.mask();this.model.save({user:s.getUser().login,email:this._getEmailValue(),platform:this.platform.getId(),text:this._getDescriptionValue()},{patch:true,onComplete:function(U,V){T.unmask();r.success(V.message)},onFailure:function(){T.unmask();r.alert(f.i18n("Unable to be replaced"))}});this._getReplaceModal().hide()}}),P=Q.extend({currentUserId:s.getUser().login,tagName:"div",_className:"facet-options",modelLegal:null,setup:function(T){if(T.platform){this.platform=T.platform}this.listenTo(this.model,{"onChange:remove":this.render,"onChange:deny":this.render,"onChange:role":this.render});this.onDelete=T.onDelete},render:function(){if(this.modelLegal===null){this.modelLegal=new F(this.model.get("legal"))}this.container.setContent(this.getTemplate()).addClassName(this._className);return this},buildStatus:function(U,V){var T;if(U&&V){T={tag:"i","class":"fonticon fonticon-check color-green"}}else{if(U){T={tag:"i","class":"fonticon fonticon-cancel color-red"}}else{T=f.i18n("None")}}return T},buildLegal:function(){var T=null;if(this.modelLegal.hasLegal()){T=[{tag:"h5",text:f.i18n("Legal Notice")},{"class":"table",tag:"table",html:[{tag:"thead",html:[{tag:"th",text:f.i18n("Terms of Use"),"class":"text-center"},{tag:"th",text:f.i18n("Privacy Policy"),"class":"text-center"},{tag:"th",text:f.i18n("Cookie Warning"),"class":"text-center"}]},{tag:"tbody",html:{tag:"tr","class":"odd",html:[{tag:"td","class":"text-center",html:this.buildStatus(this.modelLegal.get("statusTOS"),this.modelLegal.get("acceptedTOS"))},{tag:"td","class":"text-center",html:this.buildStatus(this.modelLegal.get("statusDP"),this.modelLegal.get("acceptedDP"))},{tag:"td","class":"text-center",html:this.buildStatus(this.modelLegal.get("statusCookies"),this.modelLegal.get("acceptedCookies"))}]}}]}]}return T},mask:function(){if(!this.loader){H.mask(this.getContent());this.loader=true}},unmask:function(){if(this.loader){H.unmask(this.getContent())}this.loader=null},getTemplate:function(){var T=new y({model:this.model,platform:this.platform,mask:this.mask.bind(this),unmask:this.unmask.bind(this)}),U=[this.buildLegal()];if(!this.isCurrentUser()||this.isCurrentUser()&&this.model.get("replace")){U.push({tag:"h5",text:f.i18n("Actions")})}if(this.platform.isPlatform()&&!this.isCurrentUser()){U.push({"class":"action-invitation",html:this.buildInvitation()})}if(this.model.isCasual()){U.push({"class":"action-switch-casual",html:this.buildSwitchCasual()})}if(!this.isCurrentUser()){U.push({"class":"action-remove-access",html:this.buildRemoveAccess()});U.push({"class":"action-delete",html:this.buildRemove()})}if(this.isCurrentUser()&&this.model.get("replace")){U.push(T.render())}U.push({tag:"h5",text:f.i18n("Options")});U.push({html:this.buildSupportMode()});U.push(this.options.locationsView);U.push({tag:"h5",html:f.i18n("Native Apps Environment Configuration File")+" <em>"+f.i18n("(Please note that the user must have read access to this folder)")+"</em>"});U.push({html:this._buildCatEnvConfiguration()});return U},_buildCatEnvConfiguration:function(){var U=this,T=new q({value:f.is(U.model.get("catEnv"))?U.model.get("catEnv"):"",placeholder:f.i18n("Default installation configuration path location")});return{"class":"form-group input-group",html:[T,{tag:"span","class":"input-group-btn",html:new M({value:f.i18n("Save"),className:"primary",events:{onClick:function(){var V=T.getValue();if(I.isValidFilePathTxt(V)||V===""){U.mask();U.model.save({user:U.model.get("id"),catenv:V,platform:U.platform.getId()},{patch:true,onComplete:function(W,X){U.model.set("catEnv",V);U.unmask();r.success(X.message)},onFailure:function(W,X){U.unmask();r.alert(X.message)}})}else{r.warn(f.i18n("Native Apps Environment Configuration File must be a valid path"))}}}})}]}},buildInvitation:function(){var T=new M({value:f.i18n("Send invitation"),className:"primary btn-align",disabled:this.model.isDeny(),events:{onClick:this.sendInvitation.bind(this)}}),U=f.createElement("div",{"class":"tooltip-wrapper",html:T});if(T.isDisabled()){this.tooltip=new z({position:"bottom",target:U,body:I.i18n("User has no access to this 3DExperience platform (change his right before)")})}return[U,{tag:"span",html:I.i18n("Send invitation by email to the user to access the 3DEXPERIENCE platform")}]},buildRemove:function(){var U=this,T=new M({value:f.i18n("Remove user"),disabled:!this.canRemove(),className:"error btn-align",events:{onClick:function(){var W=U.model.getUserFullName(),Y=new e({closable:false}),Z=f.String.format(f.i18n("Are you sure you want to remove {0}?"),W),X=function(){U.mask();U.model.destroy({data:{user:U.model.getUserId(),platform:U.options.platform.getId()},wait:true,onComplete:function(aa,ac){var ab=ac.message||f.String.format(f.i18n("{0} has been removed"),W);r.success(ab);U.onDelete()},onFailure:function(aa,ab){if(ab&&ab.message){U.unmask();r.alert(ab.message);U.onDelete()}else{U.unmask();r.alert(f.String.format(f.i18n("Unable to remove {0}"),W))}}})};Y.confirm(Z,f.i18n("Confirmation"),function(aa){if(aa){X()}I.manageSupportOfMultiModal()})}}}),V=f.createElement("div",{"class":"tooltip-wrapper",html:T});if(T.isDisabled()){this.tooltip=new z({position:"bottom",target:V,body:f.i18n("This action will be available when user will have no roles")})}return[V,{tag:"span",html:I.i18n("Remove user from 3DEXPERIENCE platform, the user will still be associated with his content")}]},buildSwitchCasual:function(){var U=this,T=new M({className:"primary",disabled:this.model.get("switchCasual")!==true,value:f.i18n("Switch to Unlimited Usage"),events:{onClick:function(){var X=f.i18n("Do you confirm the switch to Unlimited usage for this User ?")+" "+f.i18n("Please note that this operation cannot be undone."),W=function(){U.mask();U.model.save({user:U.model.get("id"),casual:0,platform:U.options.platform.getId()},{patch:true,onComplete:function(Y,Z){U.model.set({casual:0});r.success(Z.message);U.model.fetch({data:{id:U.model.getUserId(),platform:U.options.platform.getId()},onComplete:function(){U.unmask();U.render()},onFailure:function(){U.unmask()}})},onFailure:function(Y,Z){U.unmask();r.alert(Z.message)}})};new e({closable:false}).confirm(X,f.i18n("Confirmation"),function(Y){if(Y){W()}I.manageSupportOfMultiModal()})}}}),V=f.createElement("div",{"class":"tooltip-wrapper",html:T});if(T.isDisabled()){this.tooltip=new z({position:"bottom",target:V,body:f.i18n("Only available if all user roles are available in unlimited usage")})}return[V,{tag:"span",text:f.String.format(f.i18n("Switch from Casual usage ({0}h per month) to unlimited usage"),this.model.get("casual"))}]},buildSupportMode:function(){var T=this;return{"class":"form-group",html:new a({className:"primary",type:"checkbox",name:"supportMode",value:"",label:f.i18n("Enable Apps logs for Dassault Systèmes support"),checked:T.model.get("supportMode"),events:{onClick:function(){var U=this;T.mask();L.setSupportMode({params:{user:T.model.get("id"),enable:this.isChecked()},callbacks:{onComplete:function(V){var W=V.message;r.success(W);T.unmask()},onFailure:function(){U.uncheck();T.unmask()}}})}}})}},buildRemoveAccess:function(){var U=this,T=new M({value:f.i18n("Remove access"),className:"error btn-align",disabled:!this.canRemoveAccess(),events:{onClick:function(){var W=U.model.getUserFullName(),Y=new e({closable:false}),Z=f.String.format(f.i18n(" Are you sure you want to remove platform access for {0}?"),W),X=function(){U.mask();U.model.save({user:U.model.get("id"),role:"2",platform:U.options.platform.getId()},{patch:true,onComplete:function(aa,ab){U.model.set({role:"2"});U.render();r.success(ab.message);U.model.fetch({data:{id:U.model.getUserId(),platform:U.options.platform.getId()},onComplete:function(){U.unmask()},onFailure:function(){U.unmask()}})},onFailure:function(aa,ab){U.unmask();r.alert(ab.message)}})};Y.confirm(Z,f.i18n("Confirmation"),function(aa){if(aa){X()}I.manageSupportOfMultiModal()})}}}),V=f.createElement("div",{"class":"tooltip-wrapper",html:T});if(T.isDisabled()){this.tooltip=new z({position:"bottom",target:V,body:I.i18n("Only available if the user can't be removed or if user has already no access to this 3DExperience platform")})}return[V,{tag:"span",html:I.i18n("Remove access to the 3DEXPERIENCE platform, user will not be allowed to connect")}]},sendInvitation:function(){var T=this;this.mask();L.platformInvite({platform:T.platform.getId(),emails:this.model.get("email"),role:this.model.get("role"),agreement:this.model.get("agreement"),casual:this.model.get("casual")},{onComplete:function(U){T.unmask();r.success(U.message)}})},canRemove:function(){return this.model.get("remove")&&!this.isCurrentUser()},isCurrentUser:function(){return this.currentUserId===this.model.get("id")},canRemoveAccess:function(){return this.model.get("deny")&&!this.isCurrentUser()&&this.model.get("role")!=="2"&&this.model.get("active")}}),p=Q.extend({tagName:"div",className:"facet-tpa",setup:function(T){this.options=T||{};if(this.options.platform){this.platform=this.options.platform}else{throw new Error("A platform need to be set")}return this._parent(T)},render:function(){this.container.setContent(this.buildAppsSkeleton());return this},buildAppsSkeleton:function(){return new m({fullCollection:new c([],{data:{platform:this.platform.getId(),user:this.model.getUserId()}}),grantedCollection:new c([],{data:{platform:this.platform.getId(),user:this.model.getUserId(),granted:true}}),platform:this.platform,model:this.model,searchPlaceholder:f.i18n("Search Additional Apps"),emptyText:f.i18n("No Additional Apps found")}).render()}}),B=Q.extend({tagName:"div",className:"facet-selfexp",setup:function(T){this.options=T||{};if(this.options.platform){this.platform=this.options.platform}else{throw new Error("A platform need to be set")}return this._parent(T)},render:function(){this.container.setContent(this.getTemplate());return this},getTemplate:function(){return new m({grantedCollection:new l([],{data:{platform:this.platform.getId(),user:this.model.getUserId(),granted:true}}),platform:this.platform,searchPlaceholder:f.i18n("Search Suggested Role"),title:f.i18n("Suggested Role"),emptyText:f.i18n("No Suggested Role found"),model:this.model}).render()}});return R.extend({content:null,cache:null,locationsView:null,init:function(T){var U=this;this.platform=T.platform;this.model=T.model;this.locationsView=new K({model:this.model,platform:this.platform});this.cache={};this._parent(T);this.modal=new h({closable:true,header:this.model.getUserFullName(),className:"modal-member",body:"",footer:"",events:{onHide:function(){if(U.idCard){U.idCard.destroy()}this.destroy()}}});this.elements.container=this.modal},hasTPA:function(){return f.is(I.getWidget().getElement(".tp-apps"))},buildHeader:function(){var T=this,U=[{text:f.i18n("Roles"),icon:"role",handler:function(){T.modal.setBody(T.getFacet(d))}}];if(this.hasTPA()){U.push({text:f.i18n("Additional Apps"),icon:"drive",handler:function(){T.modal.setBody(T.getFacet(i))}})}if(this.model.get("selfexp")){U.push({text:f.i18n("Suggested Role"),icon:"pmt fonticon-pmt-selfexp",handler:function(){T.modal.setBody(T.getFacet(g))}})}U.push({text:f.i18n("More options"),icon:"cog",handler:function(){T.modal.setBody(T.getFacet(O))}});return new n({model:this.model,thumbnailUrl:function(){return this.getProfile(S.shouldLoadPicture(),T.platform.get("swym"))},attributesMapping:{title:function(){return this.getUserFullName(true)+(this.get("licensed")===false?'<i class="fonticon fonticon-key"></i>':"")},description:function(){var V="<a>"+this.get("email")+"</a>";V+=T.getPendingText();V+='<div class="js-select-role"></div>';if(this.isCasual()&&this.isContractor()){V+='<div class="bright-orange">'+f.String.format(f.i18n("Contractor, {0}"),T.getConsumptionText(this.get("casual"),this.get("consumption")||0))+"</div>"}else{if(this.isCasual()){V+='<div class="bright-orange">'+T.getConsumptionText(this.get("casual"),this.get("consumption")||0)+"</div>"}}setTimeout(T.updateSelectRole.bind(T),10);return V}},actions:[],facets:function(){return U}})},getConsumptionText:function(Y,U){var X="",W=(Y*60)-U,T=Math.floor(W/60),V=W%60;if(T>0&&V===0){if(T>1){X=f.String.format(f.i18n("Casual usage ({0}h/month): {1} hours remaining"),Y,T)}else{X=f.String.format(f.i18n("Casual usage ({0}h/month): {1} hour remaining"),Y,T)}}else{if(T>0){if(T>1&&V>1){X=f.String.format(f.i18n("Casual usage ({0}h/month): {1} hours and {2} minutes remaining"),Y,T,V)}else{if(T===1&&V<=1){X=f.String.format(f.i18n("Casual usage ({0}h/month): {1} hour and {2} minute remaining"),Y,T,V)}else{if(T>1&&V<=1){X=f.String.format(f.i18n("Casual usage ({0}h/month): {1} hours and {2} minute remaining"),Y,T,V)}else{if(T===1&&V>1){X=f.String.format(f.i18n("Casual usage ({0}h/month): {1} hour and {2} minutes remaining"),Y,T,V)}}}}}else{if(V>1){X=f.String.format(f.i18n("Casual usage ({0}h/month): {1} minutes remaining"),Y,V)}else{X=f.String.format(f.i18n("Casual usage ({0}h/month): {1} minute remaining"),Y,V)}}}return X},getDropdown:function(){var U=this,T=[];this.roles.forEach(function(V){if(V.id!=="2"&&(U.model.get("role")!==V.id||U.model.isContractor())){T.push({"data-id":V.id,text:V.name})}});if(!U.model.isContractor()||this.model.isDeny()){T.push({"data-id":J,text:f.i18n(w)})}return T},getRoleLabel:function(){var U;if(!this.model.isDeny()&&this.model.isContractor()){U={id:J,name:f.i18n(w)}}else{var T=this.model.get("role");U=f.Array.detect(this.roles,function(V){return V.id===T})}return(U&&U.name)||""},isCurrentUser:function(){return t===this.model.get("id")},updateSelectRole:function(){this.modal.getHeader().getElement(".description-section .js-select-role").setContent(this.buildSelectRole())},cantChangeRole:function(){return this.isCurrentUser()||!this.platform.isPlatform()},buildSelectRole:function(){var U=this,T=f.createElement("a",{"class":(!this.model.isDeny()&&this.model.isContractor())?I.getRoleColor(C,true):I.getRoleColor(this.model.get("role"),true),html:this.getRoleLabel()+(this.cantChangeRole()?"":'<span class="caret"></span>')});if(!this.cantChangeRole()){new o({target:T,items:U.cantChangeRole()?null:U.getDropdown(),events:{onClick:function(Y,X){var V=X["data-id"];var W="0";U.modal.mask();if(V!==J){W=I.getAgreementValue(false)}else{V="1";W=I.getAgreementValue(true)}U.model.save({user:U.model.get("id"),role:V,agreement:W,platform:U.options.platform.getId(),cacheBuster:U.model.get("agreement")},{patch:true,onComplete:function(Z,aa){setTimeout(function(){U.model.unset("cacheBuster")},500);r.success(aa.message);U.model.fetch({data:{id:U.model.getUserId(),platform:U.options.platform.getId()}});U.modal.unmask()},onFailure:function(Z,aa){U.modal.unmask();r.alert(aa.message)}})}}})}return T},getFacet:function(T){var U=this.cache[T];if(!f.is(U)){switch(T){case d:this.cache[T]=new v({model:this.model,platform:this.platform,events:{onRemoveAllGrantedRole:function(){if(this.options.memberList){this.options.memberList.forceRefreshView=true;this.options.memberList.refresh()}this.hide()}.bind(this)}}).render();break;case O:this.cache[T]=new P({platform:this.platform,model:this.model,locationsView:(this.locationsView)?this.locationsView.render():null,onDelete:function(){if(this.options.memberList){this.options.memberList.forceRefreshView=true;this.options.memberList.refresh();this.options.processList.refresh()}this.hide()}.bind(this)}).render();break;case i:this.cache[T]=new p({model:this.model,platform:this.platform}).render();break;case g:this.cache[T]=new B({model:this.model,platform:this.platform}).render();break}U=this.cache[T]}return U},getPendingText:function(){var T="";if(!this.model.get("active")){T="<span> "+f.i18n("(Pending)")+"</span>"}return T},show:function(){var U=this,T=3,V=function(){T--;if(T===0){U.idCard=U.buildHeader();U.modal.setHeader(U.idCard);U.idCard.selectFacet(d);U.modal.unmask()}};U.modal.mask();this.modal.getFooter().addClassName("hidden");this.modal.inject(document.body,"top").show();new A().fetch({onComplete:function(W,X){U.roles=X.roles;U.agreements=X.agreements;V()}});this.model.fetch({data:{platform:this.platform.getId(),id:this.model.getUserId()},onComplete:function(){V()}});S.fetch({onComplete:function(){V()}});return this}})});define("DS/PlatformManagement/Views/UserGroupsRowView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Utils","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/UIKIT/Mask","DS/UIKIT/Spinner","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Controls/Loader","UWA/Event"],function(f,c,g,i,a,h,e,d,j,b,k){return c.extend({tagName:"tr",masked:false,domEvents:{click:"_onClick"},setup:function(){this.listenTo(this.model,{onChange:this.render});this.container.addClassName(this.options.parentClassName||"");this.container.setAttribute("data-id",this.model.get("id"));this.container.setAttribute("data-type","user-groups");return this._parent.apply(this,arguments)},render:function(){this.container.setContent(this.createContent());return this},_onClick:function(o){var l=this.getContent(),m=!l.hasClassName("selected"),n=this;if(this.toggleSelect.isDisabled()){return}k.stop(o);n.setLoadingStatus(this.model);l.toggleClassName("selected",m);this.toggleSelect.setDisabled(true);this.toggleSelect.setCheck(m);this.model.addLicense(this.options.role,this.options.platform,this.options.groupModel,this.model,{patch:true,onComplete:function(p){j.success(p.message);n.resetStatus()},onFailure:function(q,p){j.alert(q.message);n.toggleSelect.setDisabled(false);n.toggleSelect.setCheck(false);n.resetStatus()}})},getLabel:function(){var l=this.model.getUserFullName();if(this.model.isCasual()){l+=f.i18n(" (Casual usage)")}return l},createContent:function(){var l=this.model;this.toggleSelect=new i({className:"primary inline",type:"checkbox",name:"users[]",value:l.get("id"),id:l.get("id"),label:this.getLabel(),checked:l.get("granted"),disabled:l.get("granted")||!this.options.groupModel.get("granted")||l.get("disabled")});return[{tag:"td",styles:{"padding-left":(15*1)+8},html:[this.toggleSelect]},{tag:"td","class":!this.options.role.hasFree()&&!l.get("granted")?"text-error status":"text-right status",text:!this.options.role.hasFree()&&!l.get("granted")?f.i18n("You have not enough role"):""}]},refreshModel:function(){this.model.fetch({data:{rolePlatform:this.model.get("platform"),platform:this.platform.get("id"),id:this.model.get("id")}})},getBody:function(){if(!this.content){this.content=this.getContent()}return this.content},isMasked:function(){return this.masked},mask:function(){if(!this.isMasked()){e.mask(this.getBody());this.masked=true}},setStatus:function(m,n){var l=this.getBody().getElement("td:nth-child(2n)");if(l){l.setContent(n)}return true},setLoadingStatus:function(m){var l=m?new d({visible:true}):new b();this.setStatus(m,l)},resetStatus:function(l){var m;this.setStatus(l,m)},unmask:function(){if(this.isMasked()){e.unmask(this.getBody());this.masked=false}}})});define("DS/PlatformManagement/Views/ConfigureMembersInvitations",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/PlatformManagement/Utils","DS/i3DXCompassCore/Collection/i3DXCompassCollection","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Modal/ShareRolesModal","DS/UIKIT/Tooltip"],function(h,b,m,f,e,a,i,k,g,d,n,q,l){var o="crossCompany",c="share",p="shareEnabled",j="shareValidation";return b.extend({tagName:"div",className:"facet-scrollable facet-config",model:null,detailElement:null,enableToggle:null,platformFolder:null,callbacks:2,setup:function(r){this.platform=r.platform;this.listenTo(this.platform,{onChange:this.render.bind(this)});return r},render:function(){this.container.setContent(this.getTemplate());this.dispatchEvent("onResize");return this},save:function(){var r=this,s={};s.id=this.platform.get("id");if(this.getFormElement(o)){s[o]=this.getFormElement(o).checked}if(this.getFormElement(p)&&this.getFormElement(j)){s[p]=this.getFormElement(p).checked;s[j]=this.container.getElement('[name="'+j+'"]:checked').value}r.mask();this.platform.save(s,{patch:true,onComplete:function(){r.unmask();n.success(h.i18n("Settings have been saved"))},onFailure:function(t,u){r.unmask();if(u.message){n.warn(u.message)}}})},getFormElement:function(r){return this.container.getElement('[name="'+r+'"]')},getTemplate:function(){return this.platform.isOnPremise()?null:this._createCrossCompanyTemplate()},_createCrossCompanyTemplate:function(){var t=this,r=h.is(this.platform.get(o+"Disabled"))?this.platform.get(o+"Disabled"):this.platform.get(o)===true,s=!this.platform.get("features")||this.platform.get("features").crossCompany===false?null:h.createElement("span",{html:new m({className:"primary inline",type:"switch",name:o,value:true,label:h.i18n("Allow administrators to grant roles without assigning the associated license"),checked:this.platform.get(o)===true,disabled:r,events:{onClick:this.save.bind(t)}}),styles:{"float":"left"}}),u=h.createElement("span",{"class":"fonticon fonticon-info ",styles:{"padding-top":"1px",color:"grey"}});if(r&&s){new l({position:"bottom",target:u,body:h.i18n("Once activated, this option can be deactivated only if it is not currently used: all users must have all licenses assigned, with restricted usage for platform licenses.")})}if(!r&&s){new l({position:"bottom",target:u,body:h.i18n("Members can work on this platform with a license they have already been granted on another platform.")})}return{html:[{tag:"h4",text:h.i18n("Invitations from administrators")},s?{html:s,styles:{"margin-bottom":10}}:null,s?u:null,{tag:"div",className:"clearfix "},{tag:"br"},{tag:"br"},{html:this.platform.get(c)?this._createShareInviteMember():null}]}},_createShareInviteMember:function(){var t=this,u=h.createElement("span",{"class":"fonticon fonticon-info ",styles:{color:"grey","margin-left":10}}),r=function(w){if(w.get("shareEnabled")===false){return false}else{if(w.get("shareEnabled")===true){return true}else{return w.get(c).enabled===true}}},v=function(w,x){if(w.get("shareValidation")===false){return x===false}else{if(w.get("shareValidation")===true){return x===true}else{return w.get(j).enabled===x}}},s=h.createElement("span",{html:new m({className:"primary inline",type:"switch",name:p,value:true,label:h.i18n("Allow platform members to invite external users (for instance when sharing content)."),checked:r(this.platform),events:{onClick:this.save.bind(t)}})});new l({position:"bottom",target:u,body:h.i18n("Authorize automatic invitation of external users when sharing content")});return[{tag:"h4",text:h.i18n("Invitations from members")},s,{tag:"span",html:{tag:"a","class":"manage-share-link",html:h.i18n("(select default roles to assign)")},events:{click:function(w){w.stopPropagation();new q({platform:t.platform}).show()}}},u,{"class":"share-wrapper"+(r(this.platform)?" hidden":" hidden"),html:[{"class":"share-validation",html:[new m({name:j,value:true,className:"primary",label:h.i18n("With admin validation"),checked:false&&v(true),disabled:true}),new m({name:j,value:false,className:"primary",label:h.i18n("Without admin validation"),checked:true||v(this.platform,false),disabled:true})]}]}]},getBody:function(){if(!this.content){this.content=this.container}return this.content},mask:function(){if(!this.isMasked()){f.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){f.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked}})});define("DS/PlatformManagement/Modal/ImportReport",["UWA/Core","UWA/Controls/Abstract","UWA/Class/View","UWA/Controls/Pager","DS/UIKIT/SuperModal","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/Layout/ListView","DS/W3DXComponents/Collections/ActionsCollection","DS/PlatformManagement/Collection/PaginatedCollection","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/EmptyView","DS/PlatformManagement/Views/TileAddView","DS/PlatformManagement/Modal/InviteMember","DS/PlatformManagement/Model/ImportModel","DS/PlatformManagement/Model/MemberDetailsModel","DS/PlatformManagement/Utils/FCSManager","DS/W3DXComponents/Views/Layout/ScrollView","DS/PlatformAPI/PlatformAPI"],function(k,u,v,w,t,b,B,i,e,A,z,m,h,d,a,p,r,n,q,s,l,y,c){var x=0,f=1,g=z.extend({url:"massivesynchro",model:q,_status:new z(),options:{data:{query:null,limit:7,offset:null}},setup:function(){this._parent.apply(this,arguments);this.addEvent("reset",function(C,D){D.previousModels.forEach(function(E){E.trigger("remove")})})},parse:function(C){this._status.set(C.statuslist);this.setMaxLimit(C.count);return C.data}}),o=v.extend({tagName:"div",className:"skeleton-detail facet-scrollable",setup:function(){this.collection=this.model._users;this.collection.setOffset(0);this.collection.setQuery(null)},render:function(){var C=this,D=this.collection;this.mask();if(!this.model.fileUploadError()){this.model.fetch({data:{synchro:this.model.get("id"),platform:null,offset:D.getOffset(),limit:D.getLimit(),query:D.getQuery()},onComplete:function(){if(!C.subView){C.container.setContent(C.getTemplate());C.subView.addClassName("ImportReport-View")}else{C.subView.setContent(C.buildSubView())}C.unmask()}})}else{C.container.setContent(new p().render(k.i18n("An error occurred on the file upload process.")))}return this},getTemplate:function(){this.subView=k.createElement("div",{html:this.buildSubView()});return[this.buildSearch(),this.subView]},buildSubView:function(){return this.collection.getMaxLimit()===0?this.buildEmptyView():[this.buildTable(),this.buildPager()]},buildEmptyView:function(){return new p().render(k.i18n("No result found"))},buildTable:function(){return{tag:"table","class":"table",html:[{tag:"thead",html:{tag:"tr",html:[{tag:"th",text:k.i18n("ID")},{tag:"th","class":"text-center",text:k.i18n("Status")},{tag:"th",text:k.i18n("Comment")},{tag:"th",text:k.i18n("Action")}]}},{tag:"tbody",html:this.buildRows()}]}},buildRows:function(){var C=this,D=[];this.collection.forEach(function(E){D.push(C.buildRow(E))});return D},retryUser:function(C){var D=this;D.mask();h.startImport({params:{synchro:this.model.get("id"),user:C.get("id")},callbacks:{onComplete:function(){D.render()},onFailure:function(){D.unmask()}}})},buildRow:function(C){var D=this;return{tag:"tr",html:[{tag:"td",text:C.get("id")},{tag:"td","class":"text-center",html:this.buildStatus(C.get("status"))},{tag:"td",html:C.get("comment")},{tag:"td",html:[C.get("status")===x?null:{tag:"i","class":"fonticon fonticon-arrows-ccw pointer",events:{click:function(){D.retryUser(C)}}}]}]}},buildStatus:function(C){return{tag:"span","class":"report-status-"+C,text:this.model._status.get(C).get("name")}},buildPager:function(){var E=this,C,D=this.collection.getMaxLimit();if(this.collection.getMaxLimit()>E.collection.getLimit()){C=new w({limit:E.collection.getLimit(),offset:E.collection.getOffset(),type:1,pageLinks:8,max:D,showPageLinks:true,length:D,events:{onOffsetChange:function(F){E.collection.setOffset(F);E.render()}}})}else{C=null}return C},buildSearch:function(){var D=this,C=function(){D.mask();D.collection.setQuery(this.value);D.collection.setOffset(0);D.render()};return[{html:new a({attributes:{placeholder:k.i18n("Search by name"),events:{keyup:C}}})},{"class":"clearfix"}]},getBody:function(){if(!this.content){this.content=this.container}return this.content},mask:function(){if(!this.isMasked()){B.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){B.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked}}),j=v.extend({tagName:"div",render:function(){this.container.setContent(new y({useInfiniteScroll:false,usePullToRefresh:false,view:new o({model:this.model})}).render());return this}});return u.extend({defaultOptions:{platform:null,onSaved:function(){}},uploadFrameId:null,callback:0,emptyView:null,init:function(C){this._parent(C);this.uploadFrameId="uploadFrame"+d.getUUID();this.modal=new b({closable:true,header:this.getTitle(),className:d.getPlatformManagementWrapperClassName("big-modal platform-import"),body:"",footer:"",events:{onHide:function(){this.destroy()}}});this.elements.container=this.modal},_manageEmptyView:function(C){if(!C||C.size()===0){if(!this.emptyView){this.emptyView=new p().render(k.i18n("You have no batch invitation report yet"));this.emptyView.inject(this.skeleton.getContent().getElement(".grid-container"),"bottom")}}else{if(this.emptyView){this.emptyView.destroy();this.emptyView=null}}},show:function(){this.modal.setBody(this.getSkeleton().render());this.modal.getFooter().addClassName("hidden");this.modal.inject(document.body,"top").show();return this},_hasTPA:function(){return this.options.platform.get("hasTPA")===true},buildAddTile:function(){var D=this,C=new r({lazyLoading:false,model:new m({fonticon:"fonticon fonticon-upload",title:k.i18n("Invite members"),action:function(){D.modal=new n({hasApp:D._hasTPA(),mode:f,platform:D.options.platform,onAdded:function(){var F=D.skeleton,E=F.getCurrentPanelIndex(),G=F.getViewAt(E).collection;if(G){D.skeletonCollection=G}if(D.skeletonCollection){D.skeletonCollection.reset();D.skeletonCollection.fetch({data:{offset:0},onComplete:function(){D._manageEmptyView(G)}})}F.refresh();c.publish("PlatformManagement.refresh",d.getWidget().id)}})}}),name:"platform-management"});return C.render()},render:function(){return k.createElement("div",{"class":"facet-import",html:this.getSkeleton().render()})},getTitle:function(){return"<h3>"+k.i18n("Import report")+"</h3>"},getActions:function(C){var D=this,E=[];if(C.canRetry()){E.push({text:k.i18n("Restart"),icon:"arrows-ccw",handler:function(){D.retryImport(C,this)}})}if(!C.inProgress()){E.push({text:k.i18n("Delete"),icon:"trash",handler:function(){D.deleteImport(C,this)}})}if(!C.fileUploadError()){E.push({text:k.i18n("Get Import File"),icon:"logout",handler:function(){D.getImportFile(this.model)}})}return E},getSkeleton:function(){var C=this;C.skeleton=new i({section:{collection:g,collectionOptions:{data:{platform:C.options.platform.getId()},actions:new A([])},fetchOptions:{onComplete:function(D){C._manageEmptyView(D)}},view:e,viewOptions:{emptyView:v.extend({tagName:"div",render:function(){return this}}),itemViewOptions:{mapping:{title:function(){return this.model.get("name")},subtitle:function(){var D=this.model.get("status");return this.model.collection._status.get(D).get("name")},image:function(){return d.getAsset("request.png")},content:function(){var D=k.String.format(k.i18n("Owner:{0}, Count:{1}"),this.model.get("manager"),this.model.get("count")),E;if(typeof this.model.get("admin")!=="string"){E=new s(this.model.get("admin"));D=k.String.format(k.i18n("Owner:{0}, Count:{1}"),E.getUserFullName(),this.model.get("count"))}return D}},events:{onRender:function(){var D=this.container.getElement(".tile-body .tile-subtitle");D.addClassName(C.getReportStatusClassName(this.model.get("status")))}}},autoFetch:true,useInfiniteScroll:true,usePullToRefresh:true,events:{onRender:function(){C.buildAddTile().inject(this.container.getElement(".grid-container"),"top")},onPullToRefresh:function(){var D=this.scrollView;this.collection.reset();this.collection.fetch({data:{offset:0},onComplete:function(E){D.endLoading();C._manageEmptyView(E)},onFailure:function(){D.endLoading()}})},onInfiniteScroll:function(){var D=this.scrollView;if(!this.collection.isInProgress()){if(this.collection.hasNext()){this.collection.setOffset(this.collection.getNextOffset());this.collection.fetch({reset:false,add:true,remove:false,onComplete:function(){D.endLoading()},onFailure:function(){D.endLoading()}})}else{if(this.collection.isFetched()){D.useInfiniteScroll(false)}}}else{D.endLoading()}}}},idCardOptions:{attributesMapping:{title:function(){return this.get("name")}},actions:function(){var D=this;return C.getActions(D)},facets:[{handler:i.getRendererHandler(j)}]}}},{root:"section",useRootChannelView:false,height:"100%"});return C.skeleton},deleteImport:function(C){var E=this,F=this.skeleton,G=C.collection,D=new t({closable:false});D.confirm(k.i18n("Are you sure you want to remove this import?"),k.i18n("Confirmation"),function(H){if(H){E.mask();C.destroy({wait:true,data:{synchro:C.get("id"),platform:null},onComplete:function(){E.unmask();F.dispatchEvent("onBackArrowClick");E._manageEmptyView(G)},onFailure:function(){E.unmask()}})}d.manageSupportOfMultiModal()})},retryImport:function(D,C){var E=this;E.mask();h.startImport({params:{synchro:D.get("id")},callbacks:{onComplete:function(){C.render();E.unmask()},onFailure:function(){E.unmask()}}})},buildStatus:function(C,D){return{tag:"span","class":this.getReportStatusClassName(C),text:D}},getReportStatusClassName:function(C){return"report-status-"+C},getImportFile:function(C){var E=this,D=k.createElement("iframe",{"class":"hidden",id:this.uploadFrameId,name:this.uploadFrameId,src:d.getAsset("s.gif")});if(!this.getBody().getElement("#"+this.uploadFrameId)){D.inject(this.getBody())}this.mask();h.getImportFile({params:{synchro:C.get("id")},callbacks:{onFailure:function(){E.unmask()},onComplete:function(F){E.unmask();l.downloadFile(C.get("filename"),F)}}})},getBody:function(){return this.skeleton.getContent()},mask:function(){if(!this.loader){B.mask(this.getBody().getElement(".skeleton-detail"));this.loader=true}},unmask:function(){if(this.loader){B.unmask(this.getBody().getElement(".skeleton-detail"))}this.loader=null}})});define("DS/PlatformManagement/MemberList",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Controls/Pager","DS/UIKIT/Touch","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/Iconbar","DS/W3DXComponents/Collections/ActionsCollection","DS/PlatformAPI/PlatformAPI","DS/PlatformManagement/Utils","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Views/UserView","DS/PlatformManagement/Views/TileAddView","DS/PlatformManagement/Modal/MemberDetails2","DS/PlatformManagement/Modal/InviteMember","DS/PlatformManagement/Collection/MemberCollection","DS/PlatformManagement/Utils/SpriteManager","DS/PlatformManagement/Utils/TaggerManager","DS/PlatformManagement/Model/UserRightModel","DS/PlatformManagement/Views/UserRowView","DS/PlatformManagement/Controls/Input/Text"],function(j,u,m,v,q,x,o,t,c,k,f,g,i,l,r,w,n,e,d,s,h,p,b){var a="member-list-wrapper";return u.extend({profileUrl:null,currentUserId:f.getUser().login,forceRefreshView:false,touchPagerEvent:null,setup:function(y){this._parent(y);this.collection=new e();this.buildContainer()},search:function(y){this.collection.setOffset(0);this.collection.setQuery(y);this.refresh()},refresh:function(y){this.setOptions(y);if(y&&y.params){this.collection.setParams(y.params)}this.buildContainer()},setTitle:function(y){if(this.getBody().getElement("h5 span")){this.getBody().getElement("h5 span").setText(j.String.format(j.i18n("Members | {0}"),y))}},render:function(){if(this.collection.getMaxLimit()>0){this.getBody().setContent(this.buildContent())}else{if(this.collection.getQuery()===null||this.forceRefreshView){this.getBody().setContent(this.buildContent())}else{this.collection.setQuery(null);this.setTitle(j.i18n("No result found"))}}this.unmask();this.forceRefreshView=false;if(this.options.onRefresh){this.options.onRefresh()}},getPersistedData:function(z){var B=this,y=0,A=function(){y++;if(y===2){s.fetch(B.listRoles,B);B.render();if(z){g.scrollToElement("."+a)}}};new h().fetch({onComplete:function(C,D){B.roles=D.roles;B.listRoles=D;A()}});s.syncFilter(B);this.collection.fetch({onComplete:function(){A()},onFailure:function(){A()}})},getSwymUrl:function(){if(this.options.platform.get("swym")!==""){this.profileUrl=this.options.platform.get("swym")}else{if(!this.profileUrl&&this.options.platform.collection){this.profileUrl=this.options.platform.collection.at(0).get("swym")}else{this.profileUrl=""}}return this.profileUrl},buildContainer:function(){var y=this;if(!this.elements.container){this.elements.container=j.createElement("div",{"class":a});y.elements.container.setContent({"class":"empty-body"})}this.mask();if(this.options.platform&&this.options.platform!==null){i.fetch({onComplete:function(){y.collection.setLimit(i.get("membersMaxPerPage"));y.collection.setSortDirection(i.get("membersSortDirection"));y.collection.setSortField(i.get("membersSortField"));y.collection.setPlatform(y.options.platform.getId());y.getPersistedData()}})}},buildTag:function(C,z,B,D){var A,y={};for(A=0;A<C;A++){y[D+"-"+A]=[{object:D,sixw:"ds6w:what",field:"owner",dispValue:z}]}return y},buildContent:function(){var y=[];y.push(this.buildRoleFilter());y.push(this.buildTitle(this.collection.getMaxLimit()));y.push({"class":"pm-grid-container "+(i.isGridLayout()?"layout-grid":"layout-table"),html:[i.isGridLayout()?this.buildTiles():this.createTableView(),this.buildPager()]});this.initTouchPager();return y},buildAddTile:function(){var z=this,y=new r({lazyLoading:false,model:new m({fonticon:"fonticon fonticon-user-add fix-alignement",title:j.i18n("Invite members"),action:function(){z.modal=new n({hasApp:g.getDocument().getElements(".platform-management-2 .tp-apps").length>0,platform:z.options.platform,onAdded:function(){z.refresh();z.options.processList.refresh();f.publish("PlatformManagement.refresh",g.getWidget().id)}})}}),name:"platform-management",mapping:{}});return y.render()},createTableView:function(){var A=this,y=new d({url:A.getSwymUrl()}),z=this.collection.map(function(B){y.addItem(B.getSpriteItem());y.addCache(B.isContractor()===true?1:0);B.actions=[{id:"info",title:j.i18n("Details"),icon:"fonticon fonticon-info"}];return new p({model:B,platform:A.options.platform,roles:A.roles,getSwymUrl:A.getSwymUrl.bind(A),onSelect:A.options.onSelect,onActionClick:function(D,C,E){var F=D.id;E.stopPropagation();switch(F){case"info":A.displayInfo(B,C);break}}}).render()});if(A.getSwymUrl()!==""&&i.shouldLoadPicture()){z.forEach(function(C,B){y.spritifyElement(C.container.getElement("img"),B)})}return[new o({value:j.i18n("Invite members"),icon:"user-add",className:"primary",events:{onClick:function(){A.modal=new n({hasApp:g.getDocument().getElements(".platform-management-2 .tp-apps").length>0,platform:A.options.platform,onAdded:function(){A.refresh();A.options.processList.refresh();f.publish("PlatformManagement.refresh",g.getWidget().id)}})}}}),{tag:"table","class":"table",html:[{tag:"thead",html:[{tag:"td"},{tag:"td",text:j.i18n("First Name")},{tag:"td",text:j.i18n("Last Name")},{tag:"td",text:j.i18n("User rights")},{tag:"td",text:j.i18n("Email")},{tag:"td",text:j.i18n("Details")}]},{tag:"tbody",html:z}]}]},buildTiles:function(){var z=[],A=this,y=new d({url:A.getSwymUrl()});z.push(A.buildAddTile());this.collection.forEach(function(B){z.push(A.buildTile(B));y.addItem(B.getSpriteItem());y.addCache(B.isContractor()===true?1:0)});if(A.getSwymUrl()!==""&&i.shouldLoadPicture()){z.forEach(function(C,B){if(B!==0){y.spritifyElement(C.container.getElement(".tile-header img"),B-1)}})}return z},buildTile:function(z){var A=this,y,B=true;z.actions=new k([{id:"info",title:j.i18n("Details"),icon:"fonticon fonticon-info"}]);this.listenTo(z,{"onChange:licensed":function(){setTimeout(function(){A.options.manageCasualActivation()},1000)}});y=new l({lazyLoading:false,model:z,platform:A.options.platform,roles:this.roles,mapping:{title:function(){return this.model.getUserFullName()+(this.model.get("licensed")===false?'<i class="fonticon fonticon-key"></i>':"")},image:function(){var C;if(B&&A.getSwymUrl()!==""&&i.shouldLoadPicture()){C=g.getAsset("s.gif");B=false}else{C=this.model.getProfile(i.shouldLoadPicture(),A.getSwymUrl())}return C}},onSelect:A.options.onSelect,events:{onActionClick:function(C,F,D){var E=F.model.get("id");D.stopPropagation();switch(E){case"info":A.displayInfo(z,y);break}}}});return y.render()},displayInfo:function(y){var z=this;new w({model:y,platform:z.options.platform,memberList:z,processList:z.options.processList}).show()},buildTitle:function(y){return{tag:"h5",html:[{tag:"i","class":"fonticon fonticon-users"},{tag:"span",text:j.String.format(j.i18n("Members | {0}"),y)}]}},hasMixedCasualType:function(){var z=this.getBody().getElement('.platform-management-container[data-casual]:not([data-casual="0"])'),y=this.getBody().getElement('.platform-management-container:not([data-casual="0"])');return z!==null&&y!==null},hasMixedCrossCompanyType:function(){var y=this.getBody().getElement('.platform-management-container[data-cross-company="true"]'),z=this.getBody().getElement('.platform-management-container[data-cross-company="false"]');return y!==null&&z!==null},_manageSelectionFilter:function(C,B){var A=this,y=A.elements.container.getElements('[data-type="user"] input'),z=A.elements.container.getElement('[data-action="select-mode"]');B.elements.container.removeClassName("selected");if(B.action==="select-all"){if(A.hasMixedCasualType()){new t({closable:true,renderTo:g.getDocument()}).confirm(j.i18n("You cannot select different types of casual member"),j.i18n("Information"))}else{if(A.hasMixedCrossCompanyType()){new t({closable:true,renderTo:g.getDocument()}).confirm(j.i18n("You cannot select different types of assigned member"),j.i18n("Information"))}else{z.removeClassName("fonticon-mouse-pointer-check").addClassName("fonticon-files-check").getParent("li").addClassName("item-active");A.elements.container.getElements('[data-type="user"]').invoke("addClassName","selected");if(y){y.forEach(function(D){D.checked=true})}}}}else{z.removeClassName("fonticon-files-check").addClassName("fonticon-mouse-pointer-check");A.elements.container.getElements('[data-type="user"].selected').invoke("removeClassName","selected");if(y){y.forEach(function(D){D.checked=false})}A.options.manageCasualActivation()}A.options.onSelect()},buildRoleFilter:function(){var z=this,y=new b({isCollapsable:true,minChar:3,attributes:{placeholder:j.i18n("Search Members"),value:this.collection.getQuery()||"",events:{keyup:function(){z.search(this.value)}}}}),A=new c({items:[{fonticon:"mouse-pointer-check",text:j.i18n("Manage Selection"),innerComponent:{type:"icondropdown",options:{items:[{action:"select-all",fonticon:"files-check",description:j.i18n("Select All"),handler:this._manageSelectionFilter.bind(this)},{action:"deselect-all",fonticon:"files-times",description:j.i18n("Deselect All"),handler:this._manageSelectionFilter.bind(this)}]}}},{fonticon:i.isGridLayout()?"th-list-alt fonticon-interact":"th-list fonticon-interact",text:j.i18n("Switch View"),handler:function(){i.setLayout(i.isGridLayout()?"table":"grid");g.getWidget().dispatchEvent("onLoad")}}]});A.elements.container.getElement(".fonticon").setAttribute("data-action","select-mode");return[{styles:{"padding-right":i.isGridLayout()?15:8,"float":"right"},html:A},{styles:{"float":"right"},html:y}]},initTouchPager:function(){var z=this,y;if(!this.touchPagerEvent&&z.pager){this.touchPagerEvent=true;y=new q(z.getBody());y.on("swipeleft",function(){if(z.collection.hasNext()){z.collection.setOffset(z.collection.getNextOffset());z.pager.setOffset(z.collection.getOffset())}});y.on("swiperight",function(){if(z.collection.hasPrevious()){z.collection.setOffset(z.collection.getPreviousOffset());z.pager.setOffset(z.collection.getOffset())}})}},buildPager:function(){var z=this,y=this.collection.getMaxLimit();if(y>z.collection.getLimit()){this.pager=new v({limit:z.collection.getLimit(),offset:z.collection.getOffset(),type:1,pageLinks:10,max:y,showPageLinks:true,length:y,events:{onOffsetChange:function(A){z.mask();z.collection.setOffset(A);z.getPersistedData(true)}}})}else{this.pager=null}return this.pager},getBody:function(){if(!this.content){this.content=this.elements.container}return this.content},mask:function(){if(!this.isMasked()){x.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){x.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked}})});define("DS/PlatformManagement/Collection/NotificationCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/NotificationModel"],function(c,b,a){return b.extend({url:"role/request",options:{data:{query:null,limit:7,offset:null}},model:a,parse:function(d){this.setMaxLimit(d.count);return d.data}})});define("DS/PlatformManagement/Views/ConfigureNetworkInstallation",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/PlatformManagement/Utils","DS/i3DXCompassCore/Collection/i3DXCompassCollection","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Controls/PlatformNotify","DS/UIKIT/Tooltip","DS/i3DXCompassCore/UsageTracker"],function(b,l,i,r,m,g,f,a,p,e,j,n,k){var d="folder",o="launcherUrl",h="documentationUrl",q=p.extend({url:"media",idAttribute:"description",model:e,parse:function(s){var u=[],t=[];s.result.forEach(function(v){var w=v.description;if(!u[w]){u[w]=v}else{v.codeLevels.forEach(function(x){u[w].codeLevels.push(x)})}});Object.keys(u).forEach(function(v){var x=u[v];x.codeLevels.sort(function w(y,z){if(y.type<z.type){return 1}if(y.type>z.type){return -1}return 0});t.push(x)});return t}}),c=l.extend({tagName:"div",className:"download-installation form-section",setup:function(s){this.platform=s.platform;return s},render:function(){var s=this;r.mask(this.container);this.collection.fetch({data:{platform:this.platform.get("id")},onComplete:function(){r.unmask(s.container);s.container.setContent(s._getTemplate())},onFailure:function(){r.unmask(s.container);s.container.setContent(s._getFailTemplate())}});return this},_getTemplate:function(){return[{tag:"h4",text:b.i18n("Download Installation Files")},{"class":"information",html:[{text:b.i18n("You can use the files to install native apps on users' computers. This is especially useful if users do not have the access rights to install new software themselves.")}]},{html:this._getFilesTemplate()}]},_getDescription:function(u){var s={Desktop:b.i18n("3DEXPERIENCE Natives Apps Processes Online Installation - Cloud"),DESKTOP_Cloud:b.i18n("3DEXPERIENCE Native Apps installation"),Drive:b.i18n("3DEXPERIENCE Drive for Windows installation")},t=s[this._getStack(u)];return t||u.get("description")},_getStack:function(s){return s.get("codeLevels")&&s.get("codeLevels").length>0&&s.get("codeLevels")[0]["stack"]},_getFilesTemplate:function(){var u=this,t=[],s=[],v=[];this.collection.forEach(function(w){s=[{tag:"h5",text:u._getDescription(w)}];w.get("codeLevels").forEach(function(x){v=[];x.volumes.forEach(function(z,y){v.push({text:b.String.format(b.i18n("Download - {0}"),(y+1)+"/"+x.volumes.length),"data-link":z.url})});s.push({"class":"level",html:[{tag:"h6","class":"col-sm-8 col-xs-8",html:{tag:"ul",styles:{"list-style-type":"disc"},html:{tag:"li",text:(x.type==="FULL"?b.i18n("Full"):b.i18n("Delta"))+": "+x.longName}}},new f({dropdown:v.length>1?{items:v}:null,attributes:{"data-link":x.volumes[0].url},className:"primary pull-left",value:b.i18n("Download"),events:{onDropdownClick:function(z,y){window.open(y["data-link"])},onClick:v.length>1?function(){}:function(){k.sync("Download-Media",{platform:u.platform.get("id"),stackType:x.type,stack:x.stack,name:x.shortName,longName:x.longName,url:x.volumes[0].url});window.open(this.getContent().getAttribute("data-link"))}}}),{"class":"clearfix"}]})});t.push({html:s})});return t},_getFailTemplate:function(){return[{tag:"h4",text:b.i18n("Download Installation Files")},{"class":"text-center",html:[{styles:{margin:10},html:a.i18n("The 3DEXPERIENCE Download Platform cannot be reached")},new f({value:b.i18n("Retry"),className:"default",events:{onClick:this.render.bind(this)}})]}]}});return l.extend({tagName:"div",className:"facet-scrollable facet-config",model:null,detailElement:null,enableToggle:null,platformFolder:null,callbacks:2,setup:function(s){this.platform=s.platform;this.listenTo(this.platform,{onChange:this.render.bind(this)});return s},render:function(){this.container.setContent(this.getTemplate());this.dispatchEvent("onResize");return this},save:function(){var u=this,v={},s=false;v.id=this.platform.get("id");if(this.getFormElement(d)){v[d]=this.getFormElement(d).value}if(this.getFormElement(o)){v[o]=this.getFormElement(o).value}if(this.getFormElement(h)){v[h]=this.getFormElement(h).value}u.mask();if(v[d]&&v[d]!==""&&!a.isUNC(v[d])){j.warn(b.i18n("Network path setting must be a valid UNC folder"));s=true}if(v[o]&&v[o]!==""&&!a.isHttpsUrl(v[o])){j.warn(b.i18n("3DEXPERIENCE launcher setting must be a valid secure url"));s=true}if(v[h]&&v[h]!==""&&!a.isHttpsUrl(v[h])){j.warn(b.i18n("3DEXPERIENCE User Assistance setting must be a valid secure url"));s=true}if(s){u.unmask()}else{var t=this.platform.get(h)||"";this.platform.save(v,{patch:true,onComplete:function(){u.unmask();if(typeof v[h]!="undefined"&&v[h]!==t){j.success(b.i18n("Settings have been saved, 3DEXPERIENCE User Assistance setting may need a browser's refresh to be applied"))}else{j.success(b.i18n("Settings have been saved"))}},onFailure:function(){u.unmask()}})}},getFormElement:function(s){return this.container.getElement('[name="'+s+'"]')},getTemplate:function(){var s=this;return[(this.platform.isOnPremise()||!this.platform.isPlatform())?null:new c({platform:this.platform,collection:new q()}).render(),(this.platform.isOnPremise()||!this.platform.isPlatform())?null:{"class":"form-section",html:[{tag:"h4",text:b.i18n("Network installation files storage")},{"class":"information",html:[{html:a.i18n("If your platform has multiple users, use this field to minimize the download time for installation files. Each time a user installs an app, the 3DEXPERIENCE platform looks for the needed files in this folder and use them if found. Files that are not found in the folder will be downloaded and added to the folder for future use.")},{tag:"br"},{text:b.i18n("Enter a network folder UNC in the format \\\\ComputerName\\SharedFolder")}]},{"class":"form-group",html:[{"for":d,tag:"label","class":"control-label",html:b.i18n("Network path")+" <em>"+b.i18n("(Please note that users must have Read/Write access to this folder)")+"</em>"},new m({value:this.platform.get("folder")||"",attributes:{id:d,name:d,maxlength:255}})]}]},this.platform.isOnPremise()?this._createLauncherConfiguration():null,this.platform.isOnPremise()||this.platform.isVPC()?this._createDocumentationConfiguration():null,{"class":"footer",html:[new f({value:b.i18n("Cancel"),className:"pull-right default",events:{onClick:s.render.bind(s)}}),new f({value:b.i18n("Save"),className:"pull-right primary",events:{onClick:this.save.bind(this)}}),{"class":"clearfix"}]}]},_createLauncherConfiguration:function(){return{html:[{tag:"h4",text:b.i18n("3DEXPERIENCE launcher setting")},{"class":"form-group",html:[{"for":o,tag:"label","class":"control-label",html:b.i18n("URL")+" <em>"+b.i18n("(Please note that this setting will override 3DEXPERIENCE platform default's)")+"</em>"},new m({value:this.platform.get(o)||"",attributes:{placeholder:"https://dslauncher.3ds.com",id:o,name:o,maxlength:255}})]}]}},_createDocumentationConfiguration:function(){return{html:[{tag:"h4",text:b.i18n("3DEXPERIENCE User Assistance setting")},{"class":"form-group",html:[{"for":h,tag:"label","class":"control-label",html:b.i18n("URL")+" <em>"+b.i18n("(Please note that this setting will override 3DEXPERIENCE platform default's)")+"</em>"},new m({value:this.platform.get(h)||"",attributes:{placeholder:"https://help.3ds.com",id:h,name:h,maxlength:255}})]}]}},getBody:function(){if(!this.content){this.content=this.container}return this.content},mask:function(){if(!this.isMasked()){r.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){r.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked}})});define("DS/PlatformManagement/Modal/Notifications",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Model/ProcessModel","DS/UIKIT/Input/Button","DS/UIKIT/Form","DS/UIKIT/Mask","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/Layout/ScrollView","DS/W3DXComponents/Views/Layout/ListView","DS/PlatformManagement/Collection/NotificationCollection","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Model/MemberDetailsModel","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Views/EmptyView","DS/PlatformManagement/Collection/UserRoleCollection"],function(f,x,w,a,t,j,p,h,E,e,D,d,m,b,v,c,z,u,r,q){var A="accepted",C="refused",i="read",k="new",o=0,n="roleRequest",s="roleRequestWU",B="roleRequestWUActivation",l=function(){},g=x.extend({masked:false,tagName:"div",className:"generic-detail facet-scrollable",styles:{"margin-top":10},selectedCollection:new z([]),render:function(){var F=this;E.mask(this.container);if(this.model.get("disabled")!==true){this.selectedCollection=new q([],{data:{platform:this.options.platform,user:this.model.get("user").id,casual:this.model.get("user").casual,granted:true}});this.selectedCollection.fetch({onComplete:function(){E.unmask(F.container);F._render()}})}else{E.unmask(F.container);F._render()}},_render:function(){var L=this,F=this,I=new j(this.model.toJSON()),K=new v(this.model.get("user")),H=new v(this.model.get("manager")),J=new p({value:f.i18n("Accept"),className:"primary",disabled:this.model.get("disabled")===true||this.model.get("role").free===0,attributes:{styles:{"margin-right":5}},events:{onClick:function(){var M=F.getElements("[name=prereq-licenses\\[\\]]:checked"),N;L.mask();N=M.map(function(O){return{id:O.value,licensed:true,restricted:true}});F.model.save({status:A,id:F.model.get("id"),licenses:JSON.stringify(N)},{patch:true,onComplete:function(O,P){L.unmask();u.success(P.message);F.render()},onFailure:function(O,P){L.unmask();if(P.message){u.alert(P.message)}}})}}}),G=new b({platform:L.platform,selectedCollection:this.selectedCollection,model:new j(this.model.get("role")),okButton:this.model.get("role").free===0?null:J});if(this.model.get("status")===k){F.model.save({status:i,id:F.model.get("id")},{patch:true,onComplete:function(){o=o-1;l(o)}})}this.content=f.createElement("div",{"class":"generic-content",styles:{"padding-left":15},html:[this.model.get("disabled")===true?{"class":"bs-callout bs-callout-warning",html:[{tag:"h4",text:f.i18n("Information")},{text:f.is(this.model.get("message"))?this.model.get("message"):f.i18n("This user is not available on this platform, you can not accept this request.")}]}:null,{html:L.getRequestInformation(K)},{tag:"table","class":"table",styles:{"margin-top":10},html:{tag:"tbody",html:{tag:"tr",html:[{tag:"td",html:new t({className:"primary",type:"checkbox",name:"prereq-licenses[]",value:I.get("uid"),label:I.get("role").name,checked:new j(I.get("role")).hasFree(),disabled:true})},I.get("selfexp")?null:{tag:"td","class":"text-right status",html:L.getInformation(I)}]}}},G.isNeeded()?{tag:"div",text:G.getTitle()+":"}:null,G.isNeeded()?G.getContent():null,this.model.get("status")===k||this.model.get("status")===i?{"class":"text-right",html:[J,new p({value:f.i18n("Refuse"),className:"error",disabled:this.model.get("disabled")===true,events:{onClick:function(){L.mask();F.model.save({status:C,id:F.model.get("id")},{patch:true,onComplete:function(M,N){L.unmask();u.success(N.message);F.render()},onFailure:function(){L.unmask()}})}}})]}:{styles:{position:"relative",margin:0,width:"100%"},"class":this.model.get("status")===A?"alert-message alert-success":"alert-message alert-warning",text:L.getStatusText(this.model.get("status")===A,H,F)}]});this.container.setContent(this.content);if(G.isNeeded()){G.manageDefaultSelection()}return this},getRequestInformation:function(F){var G="";if(this.model.get("selfexp")){G=f.String.format(f.i18n("{0} has requested to experience the role:"),F.getUserFullName()+this.getContractorText(F))}else{G=f.String.format(f.i18n("{0} has requested the role:"),F.getUserFullName()+this.getContractorText(F))}return G},getContractorText:function(F){var G="";if(F.isCasual()&&F.isContractor()){G=f.String.format(f.i18n("(Contractor, Casual usage)"),F.get("casual"))}else{if(F.isContractor()){G=f.i18n("(Contractor)")}else{if(F.isCasual()){G=f.String.format(f.i18n("(Casual usage)"),F.get("casual"))}}}return G!==""?(" "+G):G},getStatusText:function(J,H,F){var I=f.String.format(f.i18n("{0} accepted this request on {1}."),H.getUserFullName(),F.model.get("modified")),G=f.String.format(f.i18n("{0} refused this request on {1}."),H.getUserFullName(),F.model.get("modified"));return J?I:G},getInformation:function(G){var F="";if(G.get("role").free===0){F+=f.i18n("No more role available:")+" "}F+=f.String.format(f.i18n("Used: {0}/{1}"),(G.get("role").total-G.get("role").free),G.get("role").total);return{tag:"span","class":G.get("role").free===0?"text-error":"",text:F}},mask:function(){if(!this.isMasked()){E.mask(this.container);this.masked=true}},unmask:function(){if(this.isMasked()){E.unmask(this.container);this.masked=false}},isMasked:function(){return this.masked}}),y=x.extend({tagName:"div",render:function(){this.container.setContent(new D({useInfiniteScroll:false,usePullToRefresh:false,view:new g({model:this.model,platform:this.model.options.data.platform})}).render());return this}});return w.extend({defaultOptions:{},content:null,unread:0,init:function(F){var G=this;G._parent(F);if(F._updateNotificationBadge){l=F._updateNotificationBadge}this.modal=new a({closable:true,header:this.getTitle(),className:c.getPlatformManagementWrapperClassName("big-modal"),body:"",footer:"",events:{onHide:function(){this.destroy()}}});this.elements.container=this.modal},confirm:function(){this.modal.setBody(this.getContent());this.modal.getFooter().addClassName("hidden");this.modal.inject(document.body,"top").show();return this},getTitle:function(){return"<h3>"+f.i18n("Requests")+"</h3>"},getContent:function(){return f.createElement("div",{html:[this.getRequestTemplate(),this.getSkeleton().render()]})},getListViewThumbnail:function(F){return c.getAsset("notification_"+(F.get("selfexp")?"selfexp":"role")+"_80x60-"+F.get("status")+".png")},getSkeleton:function(){var F=this;F.skeleton=new e({notification:{fetchOptions:{onComplete:function(H,G){o=G.unread;if(H.count===0){F.skeleton.getContent().setContent(new r().render(f.i18n("You have no request yet")))}l(o)}},collection:m,collectionOptions:{data:{platform:F.options.platform.getId()}},view:d,viewOptions:{emptyView:x.extend({tagName:"div",render:function(){return this}}),itemViewOptions:{mapping:{"data-id":function(){this.container.setAttribute("data-id",this.model.get("role").id)},title:function(){return f.String.format((this.model.get("selfexp")?f.i18n("{0} experience request"):f.i18n("{0} request")),this.model.get("role").name)},subtitle:function(){var G=new v(this.model.get("user"));return G.getUserFullName()+" - "+this.model.get("created")},image:function(){return F.getListViewThumbnail(this.model)},icon:function(){return null},content:function(){return""}}},autoFetch:true,useInfiniteScroll:true,usePullToRefresh:true,events:{onPullToRefresh:function(){var G=this.scrollView;this.collection.fetch({reset:true,data:{offset:0},onComplete:function(){G.endLoading()},onFailure:function(){G.endLoading()}})},onInfiniteScroll:function(){var G=this.scrollView;if(!this.collection.isInProgress()){if(this.collection.hasNext()){this.collection.setOffset(this.collection.getNextOffset());this.collection.fetch({reset:false,add:true,remove:false,onComplete:function(){G.endLoading()},onFailure:function(){G.endLoading()}})}else{if(this.collection.isFetched()){G.useInfiniteScroll(false)}}}else{G.endLoading()}}}},idCardOptions:{attributesMapping:{title:function(){return f.String.format((this.get("selfexp")?f.i18n("{0} experience request"):f.i18n("{0} request")),this.get("role").name)},date:function(){return this.get("created")}},actions:[],facets:[{handler:e.getRendererHandler(y)}]}}},{root:"notification",useRootChannelView:false,height:"100%"});return F.skeleton},getBody:function(){if(!this.content){this.content=this.skeleton.getContent()}return this.content},save:function(H){var F=this,G={};G.id=this.options.platform.get("id");G[n]=H.target.checked;this.options.platform.save(G,{patch:true,onComplete:function(){u.success(f.i18n("Settings have been saved"))},onFailure:function(I,J){if(J.message){u.alert(J.message)}}})},getFormElement:function(F){return this.getContent().getElement('[name="'+F+'"]')},getRequestTemplate:function(){return{"class":"form-section",styles:{"margin-left":"14px","margin-top":"25px"},html:[{tag:"h4",text:f.i18n("Requests from members")},new t({className:"primary",type:"switch",name:n,value:true,label:this.options.platform.get(B)===true?f.i18n("Allow platform members to request roles containing Web Apps"):f.i18n("Allow platform members to request new roles"),checked:this.options.platform.get(n)===true,events:{onClick:this.save.bind(this)}}),f.is(this.options.platform.get(B))&&this.options.platform.get(B)===true?new t({className:"primary",type:"switch",name:s,value:true,label:f.i18n("Allow Platform Members to request Roles containing Native Apps"),checked:this.options.platform.get(s)===true}):null,{tag:"br"},{tag:"h4",text:f.i18n("Requests")}]}}})});define("DS/PlatformManagement/Views/CreditAndTokenRowView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Utils","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","UWA/Event"],function(g,e,d,f,b,c,a){return e.extend({tagName:"tr",setup:function(){this.firstRender=true;this.listenTo(this.model,{onChange:this.render});return this._parent.apply(this,arguments)},render:function(){this.container.setContent(this.createContent());return this},createContent:function(){var i=this.model,h=this.options.getTileSubtitle?this.options.getTileSubtitle(i):null;return[{tag:"td",html:[{"class":"img-wrapper",html:{tag:"img","data-percent":i.getPercent(),src:i.getIcon(),styles:{"margin-left":"35px"}}}]},{tag:"td",html:[{tag:"span",text:d.getTextFromHtml(i.get("name")+" ("+i.get("trigram")+")")},h?{tag:"span",html:" "+h}:null]},{tag:"td",html:this._getUsed()},{tag:"td",text:i.get("expire")}]},_getUsed:function(){var i="",h=this.model;i+=g.i18n("Used: {0}/{1}").format((h.get("total")-h.get("free")),h.get("total"));return i}})});define("DS/PlatformManagement/CreditAndTokenList",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Controls/Pager","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Touch","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/W3DXComponents/Collections/ActionsCollection","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Views/CreditAndTokenView","DS/PlatformManagement/Views/TileAddView","DS/PlatformManagement/Model/CreditAndTokenModel","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/CreditAndTokenCollection","DS/PlatformManagement/Views/CreditAndTokenRowView","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/EmptyView"],function(f,p,h,q,t,i,k,l,r,s,e,g,n,m,d,c,o,b,j){var a="creditAndToken-list-wrapper";return p.extend({collection:new c(),touchPagerEvent:null,setup:function(v){var u=this._parent(v);this.buildContainer();return u},search:function(u){this.collection.setOffset(0);this.collection.setQuery(u);this.refresh()},refresh:function(u){this.setOptions(u);if(u&&u.params){this.collection.setParams(u.params)}this.buildContainer()},setTitle:function(u){if(this.getBody().getElement("h5 span")){this.getBody().getElement("h5 span").setText(f.String.format(f.i18n("Credits & Tokens | {0}"),u))}},getPersistedData:function(u){var w=this,v=false,x=function(){if(w.collection.getMaxLimit()>0){w.elements.container.removeClassName("hidden");w.elements.container.setContent(w.buildContent());v=true;w.lastResult=w.collection.toJSON()}else{if(w.collection.getQuery()!==null){w.elements.container.removeClassName("hidden");w.collection.setQuery(null);w.setTitle(f.i18n("No result found"));w.collection.set(w.lastResult)}}if(v&&w.options.onRefresh){w.options.onRefresh()}if(u){d.scrollToElement("."+a)}w.unmask()};this.collection.fetch({onComplete:x})},buildContainer:function(){var u=this;if(!this.getBody()){this.elements.container=f.createElement("div",{"class":a+" hidden"});this.getBody().setContent({"class":"empty-body"})}this.mask();if(this.options.platform&&this.options.platform!==null){e.fetch({onComplete:function(){u.collection.setLimit(e.get("processesMaxPerPage"));u.collection.setSortDirection(e.get("processesSortDirection"));u.collection.setPlatform(u.options.platform.getId());u.getPersistedData()}})}},buildContent:function(){var u=[];u.push({"class":"divider"});u.push(this.buildFilter());u.push(this.buildTitle(this.collection.getMaxLimit()));u.push({"class":"pm-grid-container "+(e.isGridLayout()?"layout-grid":"layout-table"),html:[e.isGridLayout()?this.buildTiles():this.createTableView(),((this.collection.getMaxLimit()===0))?new j().render(f.i18n("No credits & tokens available")):null,this.buildPager()]});this.initTouchPager();return u},_hasTPA:function(){return f.is(d.getWidget().getElement(".tp-apps"))},createTableView:function(){var v=this,u=this.collection.map(function(w){return new o({model:w}).render()});return[{tag:"table","class":"table",html:[{tag:"thead",html:[{tag:"td"},{tag:"td",text:f.i18n("Name")},{tag:"td",text:f.i18n("Used")},{tag:"td",text:f.i18n("Expire")}]},{tag:"tbody",html:u}]}]},buildTiles:function(){var u=[],v=this;this.collection.forEach(function(w){u.push(v.buildTile(w))});return u},getAppsText:function(u){var v=u.get("apps");return f.is(v)&&v<=1?f.String.format(f.i18n("{0} app"),v):f.String.format(f.i18n("{0} apps"),v)},getTileContent:function(u){var v="";v+='<span class="nowrap"> '+f.String.format(f.i18n("Used: {0}/{1}"),(u.get("total")-u.get("free")),u.get("total"))+" | </span>";v+='<span class="nowrap">'+f.String.format(f.i18n("Expires: {0}"),u.get("expire"))+"</span>";return v},buildTile:function(v){var w=this,u;u=new g({lazyLoading:false,model:v,mapping:{title:function(){return this.model.get("name")+" ("+this.model.get("trigram")+")"},image:function(){return this.model.getIcon()},icon:function(){return null},content:function(){return w.getTileContent(this.model)}}});return u.render()},initTouchPager:function(){var v=this,u;if(!this.touchPagerEvent&&v.pager){this.touchPagerEvent=true;u=new k(v.getBody());u.on("swipeleft",function(){if(v.collection.hasNext()){v.collection.setOffset(v.collection.getNextOffset());v.pager.setOffset(v.collection.getOffset())}});u.on("swiperight",function(){if(v.collection.hasPrevious()){v.collection.setOffset(v.collection.getPreviousOffset());v.pager.setOffset(v.collection.getOffset())}})}},buildPager:function(){var v=this,u=this.collection.getMaxLimit();if(u>v.collection.getLimit()){this.pager=new q({limit:v.collection.getLimit(),offset:v.collection.getOffset(),type:1,pageLinks:10,max:u,showPageLinks:true,length:u,events:{onOffsetChange:function(w){v.mask();v.collection.setOffset(w);v.getPersistedData(true)}}})}else{this.pager=null}return this.pager},buildTitle:function(u){return{tag:"h5",html:[{tag:"i","class":"fonticon fonticon-tokens"},{tag:"span",text:f.String.format(f.i18n("Credits & Tokens | {0}"),u)}]}},buildFilter:function(){var v=this,u=new b({isCollapsable:true,minChar:3,attributes:{placeholder:f.i18n("Search Credits & Tokens"),value:this.collection.getQuery()||"",events:{keyup:function(){v.search(this.value)}}}});return[{styles:{"padding-right":e.isGridLayout()?15:8,"float":"right"},html:u}]},getBody:function(){if(!this.content){this.content=this.elements.container}return this.content},mask:function(){if(!this.isMasked()){t.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){t.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked}})});define("DS/PlatformManagement/Views/FacetOldMembersView",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/OldMembersCollection","DS/PlatformManagement/Model/OldMembersModel","DS/PlatformManagement/Views/OldMembersView","DS/UIKIT/SuperModal","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Loader","DS/PlatformManagement/Controls/PlatformNotify","UWA/Event","DS/UIKIT/Tooltip","DS/PlatformManagement/Controls/ButtonFab"],function(g,c,a,i,f,h,e,d,l,b,k,n,j,m){return c.extend({tagName:"div",className:"Data-Privacy-Wrapper",setup:function(o){if(o.platform){this.platform=o.platform}if(o.taggerProxy){this.taggerProxy=o.taggerProxy}return o},render:function(){var o=this;this.oldMemberslist=new e({platform:this.platform,offset:0,page:1});this.container.setContent([this.oldMemberslist.getContent()]);return this}})});define("DS/PlatformManagement/Collection/GroupRoleCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/ProcessModel"],function(d,c,b){var a=6;return c.extend({url:"group/roles",model:b,setup:function(e,f){this.setLimit(a);return this._parent(e,f)},parse:function(e){this.setMaxLimit(e.count);return e.data||e.roles},isGroupRoles:function(){return true}})});define("DS/PlatformManagement/Modal/PlatformInformationModal",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Class/Collection","UWA/Class/Model","UWA/Controls/Input","UWA/Event","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Form","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Scroller","DS/UIKIT/Input/File","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/Layout/ListView","DS/W3DXComponents/IdCard","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Views/FacetOldMembersView","DS/PlatformManagement/Controls/PlatformNotify","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Utils/FCSManager","DS/W3DXComponents/Views/Layout/ScrollView","DS/PlatformManagement/Views/DiskView"],function(d,H,J,b,C,z,v,e,c,a,u,D,A,o,j,g,E,f,K,w,h,x,B,i,k,r,m,t,q){var y=0,p=1,l=2,F,s=r.extend({url:"platform/legal",idAttribute:"platform",defaults:{dp:"",tos:"",legalInfos:"",defaultLegalLanguage:"",legalMessages:"",notifyCookies:false,defaultCookiesLanguage:"",cookiesMessages:"",cookies:"",cookiesValidity:12},getJsonValue:function(M){var O=this.get(M),L={};try{L=JSON.parse(O)}catch(N){}return L}}),G=J.extend({defaultOptions:{maxLength:400},init:function(L){this._parent(L);this.elements={}},getContent:function(){this.buildSkeleton();return this._parent()},buildId:function(L){return this.options.type+"-"+L},buildSkeleton:function(){var O=this,N=this.options.maxLength,ad=this.options.data,X=ad.messages,aa=ad.defaultLanguage,P=F.getSupportedLanguages(),M,W,U,S,Y=[],T=[],Q=this.elements,ac,R,L,Z,ab;function V(){Z.setValue(Z.getValue().replace(/\n|\r/g,""))}for(M in P){if(P.hasOwnProperty(M)){W=P[M];U=W.localizedName+" ("+W.staticName+")";S=M===aa;Y.push({value:M,label:U,selected:S});T.push(new D({value:M.toUpperCase(),className:"default",active:S,id:this.buildId(M),lang:M}))}}this.messageTextLanguage=aa;ac=new g({placeholder:false,options:Y,id:this.buildId("language"),className:"form-group col-sm-6 col-md-3",events:{onChange:function(){O.showLanguage(this.getValue())}}});R=new A({type:"radio",buttons:T,events:{onClick:function(af,ae){O.showLanguage(ae.options.lang)}}});L=d.createElement("em",{text:d.String.format(d.i18n("(Max. {0} characters; {1} characters left)"),N,N-(X[aa]||"").length)});Z=new j({multiline:true,rows:4,maxlength:N,value:X[aa]||"",id:this.buildId("message"),attributes:{events:{keydown:function(af){var ae=v.whichKey(af);if(ae==="return"||ae==="shift+return"){af.preventDefault()}},keyup:function(){O.updateMessageCharInfo()},drop:function(){setTimeout(function(){V();O.updateMessageCharInfo()},0)},paste:function(){setTimeout(function(){V();O.updateMessageCharInfo()},0)}}}});ab=d.createElement("div",{"class":"form-group",html:[{"class":"label-group",html:[{tag:"label",html:[d.i18n("Message")+" ",L],"for":this.buildId("message")},R]},Z]});Q.container=d.createElement("div",{"class":"message-form",html:[{"class":"form-group",html:[{tag:"label",html:d.i18n("Default language")+" <em>"+d.i18n("(Used if message is not available in other languages)")+"</em>","for":this.buildId("language")},{"class":"row",html:ac}]},ab]});Q.messageText=Z;Q.messageFormGroup=ab;Q.defaultLanguageSelect=ac;Q.languageButtonGroup=R;Q.messageCharInfo=L},updateMessageCharInfo:function(N){var L=this.options.maxLength,M=this.elements;if(d.typeOf(N)!=="string"){N=M.messageText.getValue()}M.messageCharInfo.setText(d.String.format(d.i18n("(Max. {0} characters; {1} characters left)"),L,L-N.length))},getValues:function(){var L=this.options.data.messages,M=this.elements;L[this.messageTextLanguage]=M.messageText.getValue().trim();return{defaultLanguage:M.defaultLanguageSelect.getValue()[0],messages:L}},showLanguage:function(Q){var N=this.buildId(Q),P=this.elements.messageText,O=this.options.data.messages,L=this.elements.languageButtonGroup,M=d.Array.detect(L.options.buttons,function(R){return R.options.id===N});L.setActive(M);O[this.messageTextLanguage]=P.getValue().trim();this.messageTextLanguage=Q;P.setValue(O[Q]||"");this.updateMessageCharInfo(O[Q])},messageError:function(){this.elements.messageFormGroup.addClassName("has-error")},removeMessageError:function(){this.elements.messageFormGroup.removeClassName("has-error")}}),I=H.extend({id:"v-"+x.getUUID(),tagName:"div",className:"facet-scrollable legal-notice",getTemplate:function(){var L=this;return[this.buildInformationPanel(),this.buildPlatformLegal(this.model),{"class":"text-helper",text:d.i18n("* If you upload a file for Terms of Use or Privacy Policy Statement you have to complete the message. It will be displayed in a pop-up at the users first login to ask them to read and approve those documents.")},this.buildCookies(),{tag:"h4",text:d.i18n("Footer")},{html:this.elements.displayFooterToggle},{"class":"footer",html:[new D({value:d.i18n("Cancel"),className:"pull-right default",events:{onClick:L.render.bind(L)}}),new D({value:d.i18n("Save"),className:"pull-right primary",events:{onClick:this.save.bind(this)}}),{"class":"clearfix"}]}]},setup:function(M){var L=M.platform.get("id");this.model=new s({platform:L},{data:{platform:L}});this.elements={};this.legalInput=[];return this._parent(M)},buildPlatformLegal:function(L){return d.createElement("div",{id:"platform-details-"+L.get("platform"),html:[{"class":"tos",html:this.buildPlatformLegalDetails(L,"tos")},{"class":"dp",html:this.buildPlatformLegalDetails(L,"dp")},{"class":"legalInfos",html:this.buildPlatformLegalDetails(L,"legalInfos")}]})},getNames:function(L){var M={fileName:this.model.get(L)};switch(L){case"tos":M.label=d.i18n("Terms of Use");break;case"dp":M.label=d.i18n("Privacy Policy Statement");break;case"legalInfos":M.label=d.i18n("Legal Information");break;case"cookies":M.label=d.i18n("Cookie Document");break}return M},buildPlatformLegalDetails:function(O,S){var V=d.createElement("form",{"class":"form-wrapper",id:"platform-details-"+O.get("platform")+"-"+S,action:"#",method:"POST",enctype:"multipart/form-data",target:"uploadFrame"+this.id}),P=this,Q=this.getNames(S),M=Q.fileName,L,R,U,T;L={type:S,hasReadyToDownload:false,hasDownload:false,downloadError:false,currentForm:V,uploadF:function(){var W=function(){P.mask();m.fetchTicket({data:{envid:O.get("platform"),type:S},onComplete:function(X,Y){V.getElement("[name=__fcs__jobTicket]").setAttribute("value",Y.fcsJobTicket);V.getElement("[name=file_0_name]").setAttribute("value",V.getElement("[name=file_"+S+"]").value);V.setAttribute("action",Y.fcsUrl);V.setAttribute("target","uploadFrame"+P.id);P.uploadInProgress=true;P.model.set(S,"");P.model.set(S,x.getFileName(V.getElement("[name=file_"+S+"]").value));V.setAttribute("enctype","multipart/form-data");V.submit()},onFailure:function(){P.unmask()}})};W()}};for(var N=0;N<=this.legalInput.length;N++){if(N===this.legalInput.length){this.legalInput.push(L);break}else{if(this.legalInput[N].type===S){this.legalInput[N]=L;break}}}R=new D({value:d.i18n("View"),className:"info",events:{onClick:function(){P.mask();M=P.model.get(S);m.fetchCheckoutTicket({data:{envid:O.get("platform"),file:M},onComplete:function(W,X){P.unmask();m.downloadFile(M,X)},onFailure:function(){P.unmask()}})}}});U=new D({value:d.i18n("Remove"),className:"error ",events:{onClick:function(){var W=V.getElement("input[type=text]").value,X=new c({closable:false});X.confirm(d.String.format(d.i18n("Are you sure you want to remove {0}?"),W),d.i18n("Confirmation"),function(Y){if(Y){P.mask();B.removeFile({envid:O.get("platform"),type:S},{onComplete:function(Z){P.unmask();k.success(Z.message);P.model.set(S,"");P.refresh()},onFailure:function(){P.unmask()}})}x.manageSupportOfMultiModal()})}}});T=this.buildInputFile(S,L);d.createElement("div",{"class":"line",html:[{tag:"div",html:[{tag:"input",type:"hidden",value:B.getUrl("faillurePage"),name:"__fcs__failurePage",id:"__fcs__failurePage"},{tag:"input",type:"hidden",value:B.getUrl("eServiceError"),name:"__fcs__jobTicket",id:"__fcs__jobTicket"},{tag:"input",type:"hidden",value:"",name:"file_0_name",id:"file_0_name"},{tag:"input",type:"hidden",value:"false",name:"attachment",id:"attachment"}]},{"class":"section file row",html:[{"class":"col-sm-2",html:{tag:"p","class":"form-control-static",text:Q.label}},{"class":"col-sm-5",html:{"class":"input-wrapper",html:T}},{"class":"col-sm-5",html:[R,U]}]}]}).inject(V);if(M===""){R.getContent().addClassName("disabled").setAttribute("disabled",true);U.getContent().addClassName("disabled").setAttribute("disabled",true)}return V},buildInputFile:function(N,M){var O=this,L=new f({attributes:{name:"file_"+N},placeholder:d.is(O.model.get(N))&&O.model.get(N)!==""?O.model.get(N):"",buttonBefore:false,events:{onChange:function(){var P=this.elements.input,R=P.value,S=x.getFileExtension(R),Q=P.getParent(".input-wrapper");if(R!==""&&(S==="pdf"||S==="doc"||S==="docx")){M.hasReadyToDownload=true;if(Q.hasClassName("has-error")){Q.removeClassName("has-error")}}else{if(R!==""){M.hasReadyToDownload=false;k.alert(d.i18n("File formats supported are : pdf, doc, and docx."));Q.setContent(O.buildInputFile(N,M));Q.addClassName("has-error")}else{M.hasReadyToDownload=false}}}}});return L},refresh:function(L){if(this.model.changedAttributes().tos!==undefined||L==="tos"){this.getBody().getElement(".tos").setContent(this.buildPlatformLegalDetails(this.model,"tos"))}if(this.model.changedAttributes().dp!==undefined||L==="dp"){this.getBody().getElement(".dp").setContent(this.buildPlatformLegalDetails(this.model,"dp"))}if(this.model.changedAttributes().legalInfos!==undefined||L==="legalInfos"){this.getBody().getElement(".legalInfos").setContent(this.buildPlatformLegalDetails(this.model,"legalInfos"))}if(this.model.changedAttributes().cookies!==undefined||L==="cookies"){this.getBody().getElement(".cookies").setContent(this.buildPlatformLegalDetails(this.model,"cookies"))}},resetLegalInput:function(){},sendNotifLegalInput:function(M){for(var L=0;L<M.length;L++){if(!M[L].values&&M[L].hasDownload){k.success(d.i18n("File has been uploaded"));this.refresh(M[L].type)}else{if(!M[L].values&&M[L].downloadError){k.alert(d.String.format(d.i18n("File can't be uploaded {0}"),this.getNames(M[L].type).fileName));M[L].currentForm.getElement(".input-wrapper").addClassName("has-error")}}}},manageSave:function(){var L;while(this.legalInput[0].values===undefined&&(this.legalInput[0].hasReadyToDownload===false||this.legalInput[0].hasDownload===true||this.legalInput[0].downloadError===true)){this.legalInput.splice(this.legalInput.length,0,this.legalInput.splice(0,1)[0])}if(this.legalInput[0].values){this.legalInput.splice(this.legalInput.length,0,this.legalInput.splice(0,1)[0]);L=this.legalInput.slice(0);this.sendNotifLegalInput(L);this.saveLegal(L[(L.length-1)].values)}else{this.legalInput[0].uploadF()}},buildInformationPanel:function(){var P=this,L=this.model,R={tag:"h4",text:d.i18n("Legal Notice")},Q=d.createElement("div",{"class":"information",html:x.i18n("The 3DEXPERIENCE platform provided by Dassault Systèmes is a space under the Customer's sole responsibility. Therefore, Customer's is sole responsible and liable for the access to and the use of this platform. As such, it belongs to Customer to regulate the use of this platform by users, and in particular to set up terms of use and data privacy policy related to the platform, in accordance with the agreement concluded with Dassault Systèmes for the use of the platform.")+" "+x.i18n("Therefore you have to fill the acceptance message and upload at least one document to activate the 'Legal Notice feature'.")}),O=d.createElement("iframe",{id:"uploadFrame"+this.id,name:"uploadFrame"+this.id,src:x.getAsset("s.gif"),events:{load:function(S){if(P.uploadInProgress){P.uploadInProgress=false;setTimeout(function(){P.unmask();m.fetchCheckoutTicket({data:{envid:P.model.get("platform"),file:(P.legalInput[0].currentForm[2])?P.legalInput[0].currentForm[2].value:""},onComplete:function(T,U){P.legalInput[0].hasDownload=true;P.manageSave()},onFailure:function(T){P.legalInput[0].downloadError=true;P.manageSave()}})},300)}else{P.unmask()}}}}),N=d.createElement("div",{"class":"text-helper",text:d.i18n("Allowed extensions are .pdf,.doc,.docx")}),M=this.elements.legalMessageForm=new G({type:"pm-legal",data:{messages:L.getJsonValue("legalMessages"),defaultLanguage:L.get("defaultLegalLanguage")||x.getLang()}});this.elements.displayFooterToggle=new a({type:"switch",value:d.i18n("Display Legal Notice & Cookies Warning in footer"),className:"primary display-footer",checked:L.get("footerDisplay")});return[R,Q,M,N,O]},buildCookies:function(){var R=this.elements,L=this.model,P,Q,N,S=[],M,O;R.notifyCookiesToggle=P=new a({type:"switch",value:d.i18n("Notify users about cookie usage"),className:"primary notify-cookies",checked:L.get("notifyCookies")});R.cookieMessageForm=O=new G({type:"pm-cookies",data:{messages:L.getJsonValue("cookiesMessages"),defaultLanguage:L.get("defaultCookiesLanguage")||x.getLang()}});R.cookieUploadForm=Q=d.createElement("div",{html:[{"class":"text-helper",text:d.i18n("Allowed extensions are .pdf,.doc,.docx")},{"class":"cookies",html:this.buildPlatformLegalDetails(L,"cookies")}]});for(M=12;M>0;M--){S.unshift({value:M,label:d.String.format((M===1?d.i18n("{0} month"):d.i18n("{0} months")),M),selected:M===L.get("cookiesValidity")})}R.validitySelect=N=new g({placeholder:false,options:S,id:"cookies-validity",className:"form-group col-sm-6 col-md-3"});return d.createElement("div",{id:"platform-cookies-"+L.get("platform"),"class":"platform-cookies",html:[{tag:"h4",text:d.i18n("Cookie Warning")},P,{"class":"information",html:x.i18n("This option allows you to inform users of your 3DEXPERIENCE platform about the use of cookies in your applications. The notification message can be defined below in several languages. A document may also be associated with it.")},O,{"class":"form-group cookies-validity dropup",html:[{tag:"label",html:d.i18n("Period of validity"),"for":"cookies-validity"},{"class":"row",html:N}]},Q]})},render:function(){var L=this;if(!this.model.isFetched()){this.mask();this.model.fetch({onComplete:function(){x.getParentModule("DS/UWPClientCode/I18n",function(M){F=M;L.container.setContent(L.getTemplate());L.unmask();L.dispatchEvent("onRendered")})}})}else{this.container.setContent(L.getTemplate())}return this},save:function(){var M=this.elements,P=this.model,Q=M.cookieMessageForm,L=Q.getValues(),R=M.legalMessageForm,S=R.getValues(),V=this.legalInput,U,T=true,O,W=-1,N=0;Q.removeMessageError();R.removeMessageError();U={notifyCookies:M.notifyCookiesToggle.isChecked(),defaultCookiesLanguage:L.defaultLanguage,cookiesMessages:L.messages,cookiesValidity:parseInt(M.validitySelect.getValue()[0],10),footerDisplay:M.displayFooterToggle.isChecked(),defaultLegalLanguage:S.defaultLanguage,legalMessages:S.messages};if(U.notifyCookies&&!U.cookiesMessages[U.defaultCookiesLanguage]){k.alert(d.i18n("The message for the default language can't be empty when a file is uploaded."));Q.showLanguage(U.defaultCookiesLanguage);Q.messageError();T=false}if((P.get("dp")||P.get("tos")||P.get("legalInfos"))&&!U.legalMessages[U.defaultLegalLanguage]){k.alert(d.i18n("The message for the default language can't be empty when a file is uploaded."));R.showLanguage(U.defaultLegalLanguage);R.messageError();T=false}for(O in V){if(T&&V.hasOwnProperty(O)&&V[O].hasReadyToDownload){T=this.validateFileUpload(V[O].type);if(W===-1){W=parseInt(O)}}}if(T&&W!==-1&&V.length){if(V[(V.length-1)]&&!V[(V.length-1)].values){V.push({values:U})}else{V[(V.length-1)].values=U}while(N!==W){this.legalInput.splice(this.legalInput.length,0,this.legalInput.splice(0,1)[0]);N++}V[0].uploadF()}else{if(T){this.saveLegal(U)}}},getFirstInputValideToDowload:function(){var M,L=this.elements.inputFiles;for(M in L){if(L.hasOwnProperty(M)&&L[M].hasReadyToDownload){return L[M]}}return null},validateFileUpload:function(N){var L,M;if(N==="tos"||N==="dp"||N==="legalInfos"){M=this.elements.legalMessageForm}else{if(N==="cookies"){M=this.elements.cookieMessageForm}}if(M){L=M.getValues();if(!L.messages[L.defaultLanguage]){k.alert(d.i18n("The message for the default language can't be empty when a file is uploaded."));M.showLanguage(L.defaultLanguage);M.messageError();return false}}return true},getBody:function(){if(!this.content){this.content=this.container}return this.content},mask:function(){if(!this.isMasked()){u.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){u.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked},saveLegal:function(L){var M=this;this.mask();if(typeof L.legalMessages!=="string"){L.legalMessages=JSON.stringify(L.legalMessages)}if(typeof L.cookiesMessages!=="string"){L.cookiesMessages=JSON.stringify(L.cookiesMessages)}this.model.save(L,{onComplete:function(){M.unmask();k.success(d.i18n("Settings have been saved"))},onFailure:function(){M.unmask()}})}}),n=H.extend({tagName:"div",className:"facet-scrollable information-general",platformFolder:null,callback:0,setup:function(L){if(L.platform){this.platform=L.platform}return this._parent(L)},buildPlatformEditor:function(){var L=this.platform;return[{"class":"row",html:{"class":"form-group col-sm-12",html:[{"for":"display-name",tag:"label","class":"control-label",text:d.i18n("Name")},new j({id:"display-name",value:L.get("name"),name:"display-name",attributes:{maxlength:45,events:{blur:function(N){var M=this;N.preventDefault();N.stopPropagation();if(d.is(M)){setTimeout(function(){if(M.value.length<3){M.focus();if(!M.getParent("div").hasClassName("has-error")){M.getParent("div").addClassName("has-error");k.alert(d.i18n("Name should have a minimum of 3 characters"))}}else{M.getParent("div").removeClassName("has-error")}},100)}}}},disabled:!L.get("platform")})]}},{"class":"row",html:{"class":"form-group col-sm-12",html:[{tag:"label","class":"control-label",text:d.i18n("ID")},{tag:"p","class":"form-control-static",text:L.get("id")}]}}]},getTemplate:function(){return[{tag:"h4",text:d.i18n("Platform Information")},{tag:"div",html:this.buildPlatformEditor()},!this.platform.isOnPremise()?{tag:"h4",text:d.i18n("Disk usage")}:null,!this.platform.isOnPremise()?new q({platform:this.platform}).render():null,{"class":"clearfix"},this.getButtons(),{"class":"clearfix"}]},onComplete:function(){this.unmask();k.success(d.i18n("Settings have been saved"));this.dispatchEvent("onSaved")},save:function(){var M=this,L=this.getBody(),N=L.getElement("[name=display-name]").value;if(N.length>=3&&N.length<=45&&N!==this.platform.get("name")){this.mask();this.platform.save({id:this.platform.get("id"),name:N},{patch:true,onComplete:M.onComplete.bind(M),onFailure:function(){M.unmask()}})}else{if(N!==M.platform.get("name")){return}else{this.onComplete()}}},getButtons:function(){var L=this;return{"class":"footer",html:[new D({value:d.i18n("Cancel"),className:"pull-right default",events:{onClick:L.render.bind(L)}}),new D({value:d.i18n("Save"),className:"primary pull-right",events:{onClick:this.save.bind(this)}})]}},render:function(){this.container.setContent(this.getTemplate());return this},getBody:function(){if(!this.content){this.content=this.container}return this.content},mask:function(){if(!this.isMasked()){u.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){u.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked}});return J.extend({content:null,init:function(L){var M=this;this.platform=L.platform;this.cache={};M._parent(L)},getHeader:function(){var L=this;return new h({model:L.options.platform,actions:[],facets:function(){return[{text:d.i18n("Setup Legal Policy"),icon:"cog",handler:function(){L.getBody().setContent(L.getFacet(p))}},{text:d.i18n("Manage Data Privacy"),icon:"cog",handler:function(){L.getBody().setContent(L.getFacet(l))}}]}})},getFacet:function(L){var N=this,M=this.cache[L];this.content.setAttribute("data-view","facet-"+L);if(!d.is(M)){switch(L){case p:this.cache[L]=new t({useInfiniteScroll:false,usePullToRefresh:false,view:new I({platform:N.options.platform})}).render();break;case l:this.cache[L]=new t({useInfiniteScroll:false,usePullToRefresh:false,view:new i({platform:N.options.platform,taggerProxy:this.taggerProxy,getScrollView:function(){return this.cache[l]}.bind(this)})}).render();break}M=this.cache[L]}return M},getTitle:function(){return"<h3>"+d.i18n("Platform Information")+"</h3>"},getBody:function(){if(!this.content){this.content=this.elements.container}return this.content},mask:function(){if(!this.loader){u.mask(this.getBody());this.loader=true}},unmask:function(){if(this.loader){u.unmask(this.getBody())}this.loader=null}})});define("DS/PlatformManagement/Widgets/PlatformInformation",["UWA/Core","UWA/Class","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/PlatformManagement/Modal/PlatformInformationModal","DS/PlatformManagement/Model/PlatformModel","DS/PlatformManagementComponents/Collection/Platform","DS/PlatformManagement/Utils","DS/PlatformManagement/Model/I18nModel","DS/i3DXCompassCore/RequestOptions","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassCore/Csrf"],function(g,b,e,i,l,o,d,m,a,f,c,n,h){var k="en",j;return b.extend({widget:null,init:function(p){var q=this;j=p.widget;this.collection=null;n.subscribe("PlatformManagement.renamePlatformName",function(r){j.setTitle(r);q.platform.set("name",r)});return this._parent(p)},onBeforeLoad:function(){j.body.addClassName("platform-information");j.body.addClassName("platform-management-2");j.setMetas({helpPath:"PlatformManagementLegal/assets/help"});m.setLang(j.lang);m.setWidget(j);var p=this,q=m.getLang();f.setupLanguage(q);h.getTokenCSRF();if(q!==k){new a().fetch({onComplete:function(s,r){g.i18n(r);p.initPreferences()},onFailure:function(){p.initPreferences()}})}else{p.initPreferences()}},initPreferences:function(){var p=this;p.collection=new d({includeWu:false,lang:m.getLang()});e.mask(j.body);c.getAppInfo({appId:"X3DOPMR_AP",onComplete:function(r){var q=[];p.collection.set(r.platforms);if(!g.is(p.getCurrentPlatform())){new i({visible:true,messages:[{message:g.i18n("You have no access to this resource"),className:"error"}]}).inject(j.body.getElement("div"));e.unmask(j.body);return}j.setTitle(p.getCurrentPlatform().get("name"));p.collection.forEach(function(s){q.push({label:s.get("name"),value:s.get("id"),id:s.get("id")})});if(p.collection.size()>1){j.addPreference({type:"list",id:"x3dPlatformId",name:"x3dPlatformId",label:g.i18n("3DExperience platform"),defaultValue:j.getValue("x3dPlatformId"),onchange:"onLoad",options:q})}p.platform=new o(p.collection.get(p.getCurrentPlatformId())?p.collection.get(p.getCurrentPlatformId()).toJSON():[]);p.platform.fetch({data:{id:p.getCurrentPlatformId()},onComplete:p.onLoad.bind(p)})}})},getCurrentPlatform:function(){var q=j.getValue("x3dPlatformId"),p;if(q&&q!==""){p=this.collection.get(q)}return p?p:this.collection.first()},getCurrentPlatformId:function(){return this.getCurrentPlatform().get("id")},onLoad:function(){var p=new l({platform:this.platform}),q=p.getHeader();this.platformInformation=p;e.unmask(j.body);j.setBody([q,{"class":"id-card-content"}]);p.content=j.getElement(".id-card-content");q.selectFacet(0);j.setTitle(this.platform.get("name"));j.body.getElement(".id-card-content").setStyle("height","calc(100% - 55px)")},onSearch:function(p){if(p){p=p.toLowerCase()}this.platformInformation.getFacet(2).view.oldMemberslist.search(p)},onResetSearch:function(){if(this.collection){this.onSearch(null)}},onRefresh:function(){this.initPreferences()},onResize:function(){},onViewChange:function(){}})});define("DS/PlatformManagement/Model/UserGroupModel",["UWA/Core","DS/PlatformManagement/Model/MemberDetailsModel","DS/WebappsUtils/WebappsUtils","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/Data"],function(e,d,c,b,a){return d.extend({addLicense:function(g,f,i,k,h){var j=f.canCrossCompany()?[{id:g.get("uid"),licensed:k.get("licensed"),restricted:k.get("restricted")}]:[{id:g.get("uid")}];a.createLicensesGroup({group:i.get("uuid"),label:i.get("label"),licenses:JSON.stringify(j),type:g.getType(),users:k.getUserId(),platform:f.getId()},h)},updateLicense:function(g,f,i,j,h){a.updateLicensesGroup({group:i.get("uuid"),licenses:JSON.stringify(g.getId()),users:j,type:g.getType(),platform:f.getId()},h)}})});define("DS/PlatformManagement/Modal/CustomRole",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Controls/Pager","DS/W3DXComponents/IdCard","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/ButtonGroup","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/ImageUploader","DS/PlatformManagement/Collection/AppsCollection","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/EmptyView"],function(e,n,m,o,r,b,l,t,f,p,h,j,c,q,k,d,i,a,g){var s=n.extend({tagName:"div",className:"facet-add",imageUploader:null,emptyView:null,setup:function(u){this.options=u||{};if(u.platform){this.platform=u.platform}else{throw new Error("A platform need to be set")}this.elements={};return this._parent(u)},getTemplate:function(){var v=this,u=0,w=2048;this.imageUploader=new q({defaultSrc:c.getAsset("ROLE_64_granted.png"),src:c.escape(this.model.get("icon"))});return[{"class":"row",html:[{"class":"form-group col-sm-6",html:[{tag:"label","for":"name"+this.cid,html:e.i18n("Name")+" <em>"+e.i18n("* (Appears in the Compass)")+"</em>"},new p({id:"name"+this.cid,name:"name",attributes:{maxlength:45,events:{keyup:function(){v._getErrors("name")}}},value:c.getTextFromHtml(this.model.get("name"))||""})]},{"class":"form-group col-sm-6",html:[{tag:"label",text:e.i18n("Role icon")},this.imageUploader.render()]}]},{"class":"row",html:{"class":"form-group  col-sm-12",html:[{tag:"label","for":"description"+this.cid,text:this.titleDescription(w,u)},new p({id:"description"+this.cid,name:"description",value:this._getDescriptionValue(),attributes:{maxlength:2048,events:{keyup:function(){v._getErrors("description");var x=this.value.length;v.getElement("[for=description"+v.cid+"]").setText(v.titleDescription(w,x))}}},multiline:true,rows:8})]}},this.buildAppsSkeleton()]},_getDescriptionValue:function(){var u=c.getTextFromHtml(this.model.get("description"));if(u){u=u.replace(/<br>/g,"\n")}return u||""},_getValues:function(){var u=this.getContent(),v=[];this.grantedCollection.forEach(function(w){v.push(w.get("id"))});return{id:this.model.get("id"),name:u.getElement("[name=name]").value,description:u.getElement("[name=description]").value,icon:this.imageUploader.getBase64Value(),applications:v.join(","),platform:this.platform.get("id")}},_removeError:function(){this.getParent(".form-group").removeClassName("has-error")},_addError:function(){this.getParent(".form-group").addClassName("has-error")},_getErrors:function(v){var u=this._getValues(),x=[],w=this.getContent();if(!v||v==="name"){if(u.name===""){x.push(e.i18n("Name: This field is required."));this._addError.call(w.getElement("[name=name]"))}else{if(u.name.length<3){x.push(e.i18n("Name: Minimum 3 characters."));this._addError.call(w.getElement("[name=name]"))}else{this._removeError.call(w.getElement("[name=name]"))}}}if(!v||v==="description"){if(u.description===""){x.push(e.i18n("Description: This field is required."));this._addError.call(w.getElement("[name=description]"))}else{if(u.description.length<3){x.push(e.i18n("Description: Minimum 3 characters."));this._addError.call(w.getElement("[name=description]"))}else{this._removeError.call(w.getElement("[name=description]"))}}}if(!v){if(u.applications===""){x.push(e.i18n("You need to select at least one application"))}}return x},buildAppsSkeleton:function(){this.fullCollection=new k();this.collection=this.fullCollection;this.elements.appsContent=e.createElement("div",{html:[this.buildSearch(),{"class":"wrapper"}]});this.grantedCollection=new k();if(this.model.get("applications")){this.grantedCollection.set(this.model.get("applications"))}this.fullCollection.setLimit(d.get("processesMaxPerPage"));this.fullCollection.setSortDirection(d.get("processesSortDirection"));this.fullCollection.setPlatform(this.platform.getId());this.filterViewAll();return this.elements.appsContent},titleDescription:function(v,u){return e.i18n("Description * ")+e.String.format(e.i18n("(Max. {0} characters; {1} characters left)"),v,v-u)},getTable:function(){return[{tag:"table","class":"table table-hover table-select-process",html:[{tag:"tbody",html:this.getRows()}]},this.buildPager()]},getRows:function(){var v=[],u=this;this.collection.forEach(function(w){v.push(u.getRow(w))});return v},getRow:function(u){var v=this;return{tag:"tr","class":"tr-"+this.getRowIdentifier(u),html:[{tag:"td",html:new h({className:"primary",type:"checkbox",name:"licenses[]",value:this.getRowIdentifier(u),id:this.getRowIdentifier(u),label:c.getTextFromHtml(u.get("name"))||c.getTextFromHtml(u.get("title")),checked:e.is(this.grantedCollection.findWhere({uid:u.get("uid")})),disabled:false,events:{onClick:function(){if(this.isChecked()){v.grantedCollection.add(u)}else{v.grantedCollection.remove(u)}}}})},{tag:"td","class":"text-right status",html:this._getInformation(u)}]}},_getInformation:function(u){var v;if(u.get("private")===false){v=e.String.format(e.i18n("Type: {0}, Available to all members"),u.getDisplayType())}else{v=e.String.format(e.i18n("Type: {0}"),u.getDisplayType())}return v},getRowIdentifier:function(u){return u.get("uid")},buildSearch:function(){var w=this,v=function(){w.mask();w.collection.setQuery(this.value);w.collection.setOffset(0);w.collection.reset();w.collection.fetch({onComplete:function(){w.unmask();w.filterViewAll()}})},u=new a({attributes:{placeholder:e.i18n("Search Additional Apps"),value:this.collection.getQuery()||"",events:{keyup:v}}});return{tag:"div",styles:{"text-align":"center","margin-top":5,"margin-bottom":15},html:[u,{"class":"clearfix"}]}},updateWrapper:function(){var u=this.collection.size()>0?this.getTable():this.buildEmptyView();this.elements.appsContent.getElement(".wrapper").setContent(u)},buildEmptyView:function(){if(this.emptyView===null){this.emptyView=new g().render(e.i18n("No Custom Role found"))}return this.emptyView},filterGrantedOnly:function(){this.collection=this.grantedCollection;this.updateWrapper()},filterViewAll:function(){var u=this;this.mask();this.collection=this.fullCollection;this.collection.fetch({onComplete:function(){u.unmask();u.updateWrapper()}})},mask:function(){t.mask(this.elements.appsContent)},unmask:function(){t.unmask(this.elements.appsContent)},buildFilter:function(){var u=this.elements;u.filterGrantedOnly=new f({value:e.i18n("View granted only"),className:"default",events:{onClick:this.filterGrantedOnly.bind(this)}});u.filterViewAll=new f({value:e.i18n("View all"),className:"default",active:true,events:{onClick:this.filterViewAll.bind(this)}});return{"class":"pull-right filter-group",styles:{"margin-top":0},html:[new j({type:"radio",buttons:[u.filterGrantedOnly,u.filterViewAll]})]}},buildPager:function(){var v=this,u=this.collection.getMaxLimit();return u>v.collection.getLimit()?new o({limit:v.collection.getLimit(),offset:v.collection.getOffset(),type:1,pageLinks:7,max:u,showPageLinks:true,length:u,events:{onOffsetChange:function(w){v.mask();v.collection.setOffset(w);v.collection.fetch({onComplete:function(){v.unmask();v.updateWrapper()}})}}}):null},render:function(){this.container.setContent(this.getTemplate());return this}});return m.extend({content:null,modal:null,init:function(u){var v=this;this.model=u.model;this.platform=u.platform;v._parent(u);this.modal=new b({closable:true,header:this._getHeader(),body:"",footer:v.getButtons(),events:{onHide:function(){this.destroy()}}});this.elements.container=this.modal},show:function(){var u=this;this.view=new s({model:this.model,platform:this.platform});if(this.model.get("id")){this.mask();this.model.fetch({data:{rolePlatform:this.model.get("platform"),platform:this.model.get("platform"),id:this.model.get("id"),offset:null,limit:null,sort_direction:null},onComplete:function(){u.unmask();u.modal.setBody(u.view.render())}})}else{u.modal.setBody(u.view.render())}this.modal.inject(document.body,"top").show();return this},_getHeader:function(){return this._isInEditionMode()?e.i18n("Edit Custom Role"):e.i18n("Create Custom Role")},_save:function(){var v=this,u=this.view._getValues(),w=this.view._getErrors();if(w.length===0){v.mask();this.model.save(e.merge(u,{platform:this.model.get("platform")}),{patch:true,onComplete:function(x,y){v.unmask();v.elements.container.hide();i.success(y.message);if(v.options.onAdded){v.options.onAdded()}},onFailure:function(x,y){v.unmask();i.alert(y.message)}})}else{i.alert(w.join("<br />"))}},_isInEditionMode:function(){return e.is(this.model.get("id"))},_showDeleteConfirmation:function(){var v=this,u=new l({closable:false}),w=this._getConfirmDeleteTitle();u.confirm(w,e.i18n("Confirmation"),function(x){if(x){v._delete()}c.manageSupportOfMultiModal()})},_getConfirmDeleteTitle:function(){var v,u=c.getTextFromHtml(this.model.get("name"));if(this.model.get("granted")===true){v=e.String.format(e.i18n("Warning this role is currently granted to members, are you sure you want to remove {0} Role?"),u)}else{v=e.String.format(e.i18n("Are you sure you want to remove {0} Role?"),u)}return v},_delete:function(){var u=this;this.mask();this.model.destroy({data:{id:u.model.get("id"),limit:null,offset:null,sort_direction:null},wait:true,onComplete:function(v,w){u.unmask();u.elements.container.hide();i.success(w.message);if(u.options.onDelete){u.options.onDelete()}},onFailure:function(){u.unmask();i.alert(e.String.format(e.i18n("Unable to remove {0}"),u.model.get("name")))}})},getButtons:function(){var u=[],v=this;u.push(new f({className:"primary",value:e.i18n("Save"),events:{onClick:this._save.bind(this)}}));if(this._isInEditionMode()){u.push(new f({value:e.i18n("Remove"),className:"error",events:{onClick:this._showDeleteConfirmation.bind(this)}}))}u.push(new f({className:"default",value:e.i18n("Cancel"),events:{onClick:function(){v.modal.hide()}}}));return u},getBody:function(){return this.modal.getBody()},mask:function(){if(!this.loader){t.mask(this.getBody());this.loader=true}},unmask:function(){if(this.loader){t.unmask(this.getBody())}this.loader=null}})});define("DS/PlatformManagement/Collection/UserGroupCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/UserGroupModel"],function(d,c,b){var a=6;return c.extend({url:"group/members",model:b,setup:function(e,f){this.setLimit(a);return this._parent(e,f)},parse:function(e){this.setMaxLimit(e.count);return e.data||e.roles}})});define("DS/PlatformManagement/Modal/SubscriptionErrorModal",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Controls/Pager","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/MemberDetailsModel"],function(e,b,g,a,j,d,h,k,f,l){var i=f.extend({url:"subscriptions",model:l,setup:function(m,n){this.setLimit(6);return this._parent(m,n)},parse:function(m){this.setMaxLimit(m.count);this.id=m.id;this.name=m.name;this.errorCount=m.errorCount;this.stop=m.stop;return m.data}}),c=b.extend({tagName:"div",className:"",imageUploader:null,emptyView:null,setup:function(m){this.options=m||{};if(m.platform){this.platform=m.platform}else{throw new Error("A platform need to be set")}this.onClick=m.onClick;this.elements={};return this._parent(m)},_createTemplate:function(){return[this._createDescription(),this._getTable()]},_createDescription:function(){return{"class":"bs-callout bs-callout-warning",html:[{text:e.String.format(e.i18n("{0} annual subscription of {1} will not be renewed on {2}"),this.collection.errorCount,this.collection.name,this.collection.stop)},{text:e.String.format(e.i18n("Please select and confirm the {0} members whose subscription will not be renewed"),this.collection.errorCount)}]}},_getTable:function(){return[{tag:"table","class":"table table-hover",html:[{tag:"tbody",html:this._getRows()}]},this._createPager()]},_getRows:function(){var n=[],m=this;this.collection.forEach(function(o){n.push(m._getRow(o))});return n},_getRow:function(m){var n=this,o=m.get("id");return{tag:"tr","class":"tr-"+o,html:[{tag:"td",html:new k({className:"primary",type:"checkbox",name:"subscriptions[]",value:o,id:o,label:m.getUserFullName(),events:{onClick:this.onClick.bind(this)}})}]}},mask:function(){d.mask(this.elements.appsContent)},unmask:function(){d.unmask(this.elements.appsContent)},_createPager:function(){var n=this,m=this.collection.getMaxLimit();return m>n.collection.getLimit()?new a({limit:n.collection.getLimit(),offset:n.collection.getOffset(),type:1,pageLinks:7,max:m,showPageLinks:true,length:m,events:{onOffsetChange:function(o){n.mask();n.collection.setOffset(o);n.collection.fetch({onComplete:function(){}})}}}):null},getSelected:function(){return this.container.getElements("input:checked")},render:function(){this.container.setContent(this._createTemplate());return this}});return g.extend({content:null,modal:null,init:function(m){var n=this;this.platform=m.platform;n._parent(m);this.modal=new j({closable:false,header:e.i18n("Subscription modification"),body:"",footer:n.getButtons(),events:{onHide:function(){this.destroy()}}});this.elements.container=this.modal},show:function(){var m=this,n=new i();this.view=new c({collection:n,platform:this.platform,onClick:function(){if(m.view.getSelected().length>=n.errorCount){m._buttonConfirm.setDisabled(false)}else{m._buttonConfirm.setDisabled(true)}}});this.modal.mask();n.fetch({data:{platform:this.platform.get("id")},onComplete:function(){m.modal.unmask();m.modal.setBody(m.view.render())},onFailure:function(){m.modal.unmask()}});this.modal.inject(document.body,"top").show();return this},_save:function(){new l({id:"_"}).destroy({data:{user:getSelectedUser().join(","),platform:that.platform.getId()},wait:true,onComplete:function(m,n){PlatformNotify.success(n.message);that.memberList.refresh()},onFailure:function(m,n){if(n.message){PlatformNotify.warn(n.message)}that.memberList.refresh()}})},getButtons:function(){this._buttonConfirm=new h({className:"primary",disabled:true,value:e.i18n("Confirm"),events:{onClick:this._save.bind(this)}});return this._buttonConfirm}})});define("DS/PlatformManagement/Views/GrantGroupTable",["UWA/Core","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Collection/GroupCollection","DS/PlatformManagement/Collection/UserGroupCollection","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Utils","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Modal/PrereqError","DS/PlatformManagement/Views/GrantUserTable","DS/PlatformManagement/Views/UserGroupsRowView","DS/PlatformManagement/Collection/GroupRoleCollection","UWA/Event","DS/UIKIT/Mask","DS/UIKIT/Spinner","DS/UIKIT/Tooltip"],function(i,d,m,f,h,o,j,b,a,c,q,n,p,g,e,l){return c.extend({onCreateLicensesUser:function(w,y,t,s,x,r){var v=this,u=v.platform.canCrossCompany()?[{id:y.get("uid"),licensed:this.options.withLicenses===false||(v.fullCollectionWithOutLicenses&&v.fullCollectionWithOutLicenses.get(y.get("uid")))?false:t.get("licensed"),restricted:t.get("restricted")}]:[{id:y.get("uid")}];x.forEach(function(z){if(v.platform.canCrossCompany()){var A={id:z.get("uid")};if(v.fullCollectionWithOutLicenses&&v.fullCollectionWithOutLicenses.get(y.get("uid"))||z.get("withLicenses")===false){A.licensed=false}u.push(A)}else{u.push({id:z.get("uid")})}});if(x.size()>0){x.forEach(function(A){var z=v.getBody().getElement(j.escapeDomSelector("#"+A.get("uid")));s.setLoadingStatus(A);if(z){v.getBody().getElement(j.escapeDomSelector("#"+A.get("uid"))).checked=true}})}if(v.platform.canCrossCompany()){v.mask()}w.addLicense(u,y.getType(),v.platform,{patch:true,onComplete:function(A){var z=0;s.resetStatus(t);r.setDisabled(false);s.invalidCache();if(v.platform.canCrossCompany()){v.unmask();v.collection.reset();v.collection.fetch({onComplete:function(){if(!v.fullCollectionWithOutLicenses||z===2){v.updateWrapper()}else{z=1}}});if(v.fullCollectionWithOutLicenses){v.fullCollectionWithOutLicenses.reset();v.fullCollectionWithOutLicenses.fetch({onComplete:function(){if(z===1){v.updateWrapper()}else{z=2}}})}}v.model.set("nbUsed",v.model.get("nbUsed")+1);setTimeout(function(){o.success(A.message);v.refreshModel();v.dispatchEvent("onGrantGroup")},1000)},onFailure:function(A,z){o.alert(A.message);if(v.platform.canCrossCompany()){v.unmask()}r.setDisabled(false);v.resetStatus(w);r.setCheck(false);s.invalidCache();v.refreshModel()}})},onToggleClick:function(w,v){var x=this,t=true,z=null,y=v,u=this.getRoleModel(v),A=new n([],{data:{platform:this.platform.getId(),group:y.getGroupId()}}).setLimit(null),s=function(B){if(t){x.onCreateLicensesUser(y,u,v,x,B,w)}else{w.uncheck()}},r=function(B){if(w.isChecked()){z=new b({selectedCollection:B,model:u,disabledConformSwitchToggleModal:true,onConfirm:function(C){s(C)},onCancel:function(){x.unmask();w.uncheck();w.setDisabled(false);x.resetStatus(v)}});if(z.isNeeded()){z.confirm()}else{s(z.getMandatoryPrereq())}}else{z=new a({selectedCollection:B,model:u,onCancel:function(){x.unmask();w.check();w.setDisabled(false);x.resetStatus(v)}});if(z.isNeeded()){z.show()}else{x.showDeleteConfirmation(y,u,v,x,w)}}};x.setLoadingStatus(v);w.setDisabled(true);if(!w.isChecked()){x.mask()}A.fetch({onComplete:r})},getRowIdentifier:function(r){return r.get("uuid")||r.get("id")},isCheckboxDisabled:function(r,s){return false},getLabel:function(r){return r.get("label")},getRoleModel:function(){return this.model},isChecked:function(r){return r.get("granted")},updateRowUserGroup:function(r,w,v){var u=w.getElements("td")[1],t=w.getElement("label"),s=w.getElement("input");if(r){s.setAttribute("disabled",true);u.setContent(new e({visible:true}))}else{if(v){if(s.checked!==v.get("granted")){s.checked=v.get("granted")}if((v.isCasual()?j.getTextFromHtml(v.getUserFullName())+i.i18n(" (Casual usage)"):j.getTextFromHtml(v.getUserFullName()))!==w.getElement("label").textContent){t.textContent=v.isCasual()?j.getTextFromHtml(v.getUserFullName())+i.i18n(" (Casual usage)"):j.getTextFromHtml(v.getUserFullName())}if(v.isCasual()&&!v.get("granted")){w.removeAttribute("disabled")}else{if(!v.get("granted")){w.setAttribute("disabled",true)}}if(!this.getRoleModel().hasFree()&&!v.get("granted")){if(!u.hasClassName("text-error")){u.className="text-error status"}u.setContent(i.i18n("You have not enough role"))}else{u.setContent("")}}else{if(!w.getElement("input").checked){w.removeAttribute("disabled")}else{if(w.getElement("label")&&w.getElement("label").indexOf&&w.getElement("label").indexOf(i.i18n(" (Casual usage)"))){w.removeAttribute("disabled")}}if(u.hasClassName("text-error")){u.setContent(i.i18n("You have not enough role"))}else{u.setContent("")}}}},getUserGroupRows:function k(r){if(this.getContent().getElement('tr[class*="'+this.getRowIdentifier(r)+'"][data-id]')){return this.getContent().getElements('tr[class*="'+this.getRowIdentifier(r)+'"][data-id]')}return[]},getInformation:function(r){var t=this,s="",u="";if(this.tooltips[r.getGroupId()]&&this.tooltips[r.getGroupId()].length>0){this.tooltips[r.getGroupId()].forEach(function(v){v.destroy()})}this.tooltips[r.getGroupId()]=[];if(r.get("countUsers")>0){s=i.createElement("span",{"class":!r.isMembersRowViewExtended()?"pointer fonticon fonticon-down-dir user-group-icon":"pointer fonticon fonticon-up-dir user-group-icons",events:{click:function(v){t.setLoadingStatus(r);if(r.get("countUsers")===0){return}else{if(v.target.hasClassName("pointer fonticon fonticon-up-dir")){r.setRowViewExtended(false);v.target.removeClassName("pointer fonticon fonticon-up-dir");v.target.addClassName("pointer fonticon fonticon-down-dir");t.destroyUserGroupRows(r)}else{r.setRowViewExtended(true);v.target.removeClassName("pointer fonticon fonticon-down-dir");v.target.addClassName("pointer fonticon fonticon-up-dir");t.fetchUserGroupRows(r)}}p.stop(v)}}});this.tooltips[r.getGroupId()].push(new l({position:"bottom",target:s,body:!r.isMembersRowViewExtended()?i.i18n("Expand"):i.i18n("Collapse")}))}if(r.isMembersRowViewExtended()){u=i.createElement("span",{"class":"pointer fonticon fonticon-cw user-group-icons",events:{click:function(w){var v=t.getUserGroupRows(r);t.setLoadingStatus(r);if(v.length>0){v.forEach(function(y,x){t.updateRowUserGroup(true,y)})}t.fetchUserGroupRows(r);p.stop(w)}}});this.tooltips[r.getGroupId()].push(new l({position:"bottom",target:u,body:i.i18n("Refresh")}))}return{styles:r.isMembersRowViewExtended()?{"text-align":"initial","margin-right":"13px"}:{},html:[u,s]}},fetchUserGroupRows:function(s){var t=this,r=this.content.getElement('label[for="'+this.getRowIdentifier(s)+'"]'),u=this.content.getElement('tr[class="tr-'+this.getRowIdentifier(s)+'"]');new h([],{data:{platform:this.platform.getId(),group:s.get("uuid"),role:this.getRoleModel().get("id")}}).fetch({onComplete:function(y){s.setMembersCollection(y);if(y.count){var v=y.filter(function(z){return z.get("granted")}),x,w;s.set("grantedUsers",v.length);s.set("countUsers",y.length);t.updateToggleLabel(s,r);y.forEach(function(A,z){if(t.getContent().getElement('tr[class*="'+t.getRowIdentifier(s)+'"][data-id="'+A.get("id")+'"]')){t.updateRowUserGroup(false,t.getContent().getElement('tr[class*="'+t.getRowIdentifier(s)+'"][data-id="'+A.get("id")+'"]'),A)}else{x=new q({role:t.getRoleModel(),model:A,parentClassName:t.getRowIdentifier(s),groupModel:s,platform:t.platform}).render();if(t.getContent().getElement('tr[class*="'+t.getRowIdentifier(s)+'"]')){if(w){x.inject(t.getContent().getElement('tr[class*="'+t.getRowIdentifier(s)+'"][data-id="'+w+'"]'),"after")}else{x.inject(t.getContent().getElement('tr[class*="'+t.getRowIdentifier(s)+'"]'),"after")}w=A.get("id")}}});t.resetStatus(s)}else{s.setRowViewExtended(false);s.set("grantedUsers",0);s.set("countUsers",y.length);t.updateToggleLabel(s,r);t.resetStatus(s);o.warn(i.i18n("No users found"));if(t.getUserGroupRows(s).length>0){t.destroyUserGroupRows(s)}}},onFailure:function(w,x){var v=t.getUserGroupRows(s);if(x.message){o.warn(x.message)}else{if(x&&x.indexOf&&x.indexOf("504")!==-1){o.warn(i.i18n("Action is still pending... Please wait a few seconds and refresh your widget"))}else{o.warn(x)}}if(v.length>0){v.forEach(function(y){t.updateRowUserGroup(false,y)});s.setRowViewExtended(true)}else{s.setRowViewExtended(false);u.getElement("span").removeClassName("pointer fonticon fonticon-up-dir");u.getElement("span").addClassName("pointer fonticon fonticon-down-dir")}t.resetStatus(s)}});return true},destroyUserGroupRows:function(r){var s=this.getUserGroupRows(r);s.forEach(function(u,t){u.destroy()});this.resetStatus(r);return true},getConfirmDeleteTitle:function(r){return i.i18n("Are you sure you want to remove {0}?").format(r.get("label"))},_createCrossCompany:function(r,s){return""},updateToggleLabel:function(s,r){r.textContent=this.formatGroupLabel(s)},formatGroupLabel:function(r){var s=r.get("countUsers")>0?r.get("grantedUsers")<1?i.String.format(i.i18n(" ({0} members)"),r.get("countUsers")):i.String.format(i.i18n(" ({0} granted / {1} members)"),r.get("grantedUsers"),r.get("countUsers")):"";return j.getTextFromHtml((this.getLabel(r)||r.getGroupId())+s)},getRow:function(s){var u=this,v=[],t=new m({className:"primary",type:"checkbox",name:"licenses[]",value:this.getRowIdentifier(s),id:this.getRowIdentifier(s),label:this.formatGroupLabel(s),checked:this.isChecked(s),disabled:this.isCheckboxDisabled(s,this.model)}),r=i.createElement("div",{"class":"tooltip-wrapper",html:t}),w=i.createElement("tr",{"class":"tr-"+this.getRowIdentifier(s),html:[{tag:"td",html:r},{tag:"td","class":"text-right status",html:this.getInformation(s)}],events:{click:function(y){if(t.isDisabled()){return}else{if(!y.target.getParent(".toggle-switch")){var x=!t.isChecked();t.setCheck(x);u.onToggleClick(t,s);p.stop(y)}}},onRemoveAllGrantedRole:function(){u.dispatchEvent("onRemoveAllGrantedRole")}}});if(this.isCheckboxDisabled(s,this.model)&&s.get("helpMessage")&&s.get("helpMessage")!==""){this.tooltips.push(new l({position:"bottom",target:r,body:s.get("helpMessage")}))}v.push(w);if(s.getMembersCollection&&s.getMembersCollection()){s.getMembersCollection().forEach(function(y,x){v.push(new q({role:u.getRoleModel(),model:y,parentClassName:u.getRowIdentifier(s),groupModel:s,platform:u.platform}).render())})}return v},updateDisplayGrantedMember:function(r){return""}})});define("DS/PlatformManagement/Modal/RoleDetails",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Controls/Pager","DS/W3DXComponents/IdCard","DS/W3DXComponents/Views/Layout/ScrollView","DS/PlatformManagement/Modal/FullScreenIdCardModal","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/i3DXCompass/Controls/IframeLoader","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/MemberCollection","DS/PlatformManagement/Model/ProcessModel","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Views/GrantUserTable","DS/PlatformManagement/Views/GrantGroupTable","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Collection/GroupCollection","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(i,u,t,v,w,B,d,r,D,A,f,e,k,p,a,x,c,j,h,b,l){var n=0,o=1,C=2,y=3,g=3,m=false,z,s=u.extend({tagName:"div",_className:"facet-about",_allowfullscreen:function(){var E=window.top.document.getElementById("frame-"+f.getWidget().id);if(E){E.setAttribute("allowfullscreen",true)}},render:function(){this._allowfullscreen();this.container.setContent(new A({src:this.model.get("description"),text:this.model.isOption()?i.i18n("No additional information for this option"):i.i18n("No additional information for this role")})).addClassName(this._className);return this}}),q=u.extend({tagName:"div",_className:"facet-apps",render:function(){var E=this;if(!this.model.isFetched()){this.mask();this.model.fetch({data:{platform:this.model.get("platform"),role:this.model.get("id")},onComplete:function(){l.getServiceUrl({platformId:E.platform.get("id"),serviceName:"usersgroup",onComplete:function(F){if(F){m=true}E.container.setContent(E.getTemplate()).addClassName(E._className);E.unmask()},onFailure:function(){E.container.setContent(E.getTemplate()).addClassName(E._className);E.unmask()}})},onFailure:function(){E.unmask()}})}else{this.container.setContent(this.getTemplate()).addClassName(this._className)}return this},getTemplate:function(){var F=this,E=[];this.model.get("applications").forEach(function(G){E.push(F.getAppView(G))});return[{tag:"h5",text:i.String.format(i.i18n("{0} Apps are available with this role"),this.model.get("apps"))},E]},getAppView:function(E){return{"class":"apps-item","data-id":E.id,html:[{tag:"img",src:E.icon},{text:E.title,title:E.title}]}},mask:function(){if(!this.loader){D.mask(this.getContent());this.loader=true}},unmask:function(){if(this.loader){D.unmask(this.getContent())}this.loader=null}});return t.extend({content:null,cache:null,idCard:null,init:function(E){var F=this;this.cache={};this.model=E.model;this.platform=E.platform;this.withLicenses=E.withLicenses;F._parent(E);this.modal=new d({closable:true,header:this.idCard,body:"",footer:"",events:{onHide:function(){if(F.idCard){F.idCard.destroy()}this.destroy()}}});this.elements.container=this.modal},getDescription:function(){var E="";if(this.isCustom()){E=""}else{if(this.isTPA()){E+="<div>"+i.String.format(i.i18n("Type: {0}"),this.getDisplayType())+"</div>"}else{if(this.isSelfExp()){E+='<div class="bright-orange">'+i.i18n("Trial")+"</div>";E+="<div>"+i.String.format(i.i18n("Used: {0}"),this.get("used"))+"</div>"}else{if(this.isCasual()&&this.isOption()){E+='<div class="bright-orange">'+i.i18n("Option, Casual usage")+"</div>"}else{if(this.isCasual()){E+='<div class="bright-orange">'+i.i18n("Casual usage")+"</div>"}else{if(this.isOption()){E+='<div class="bright-orange">'+i.i18n("Option")+"</div>"}}}if(!this.get("total")){E+='<div class="bright-orange">'+i.i18n("No license associated")+"</div>";E+="<div>"+i.String.format(i.i18n("Used: {0}"),this.get("nbUsed"))+"</div>"}else{E+="<div>"+i.String.format(i.i18n("Used: {0}/{1}"),this.get("total")-this.get("free"),this.get("total"))+"</div>"}}}}if(this.get("expireLong")){E+=i.String.format(i.i18n("Expiration date: {0}"),this.get("expireLong"))}return E},buildHeader:function(){var E=this,F;return new w({model:this.model,thumbnailUrl:function(){return this.getIcon()},attributesMapping:{title:function(){var G;if(this.isTPA()||this.isCustom()){G=this.get("name")}else{G=this.get("name")||this.get("title");if(G){G=G+" - "+this.get("trigram")}else{G=this.get("trigram")}}return G},description:this.getDescription},actions:[],facets:function(){var G=[{text:i.i18n("Members"),icon:"users",handler:function(){E.modal.mask();h.fetch({onComplete:function(){E.modal.setBody(E.getFacet(n));E.modal.unmask()}})}}];if(m){if(this.get("id")!=="IFW"&&!E.model.isCasual()&&(E.model.isTPA()||this.get("withLicenses"))){G.push({text:i.i18n("Groups"),icon:"users-group",handler:function(){E.modal.setBody(E.getFacet(g))}})}}if(!E.model.isTPA()){G.push({text:i.i18n("Apps"),icon:"drive",handler:function(){E.modal.setBody(E.getFacet(o))}});G.push({text:i.i18n("About"),icon:"doc-text",handler:function(){E.modal.setBody(E.getFacet(C))}});if(E.model.get("id")==="IFW"&&z){if(z.isActivated&&z.isActivated()){G.push({text:i.i18n("Subscriptions"),icon:"doc-text",handler:function(){E.modal.setBody(E.getFacet(y))}})}}}return G}})},getFacet:function(E){var G=this,F=this.cache[E];if(!i.is(F)){switch(E){case n:this.cache[E]=new c({withLicenses:this.withLicenses,fullCollection:this.model.isSelfExp()?null:new e([],{data:{role:this.model.get("id"),platform:this.platform.get("id"),casual:this.model.isTPA()?null:this.model.get("casual"),limit:10}}).setSortDirection(h.get("membersSortDirection")).setSortField(h.get("membersSortField")),grantedCollection:new e([],{data:{role:this.model.get("id"),platform:this.platform.get("id"),granted:true,casual:this.model.isTPA()?null:this.model.get("casual"),limit:10}}).setSortDirection(h.get("membersSortDirection")).setSortField(h.get("membersSortField")),platform:this.platform,model:this.model,searchPlaceholder:i.i18n("Search user"),filterViewAllText:i.i18n("View all"),filterGrantedOnlyText:i.i18n("View users granted"),emptyText:i.i18n("No user found")}).render();break;case g:this.cache[E]=new j({withLicenses:this.withLicenses,fullCollection:this.model.isSelfExp()?null:new b([],{data:{role:this.model.get("id"),platform:this.platform.get("id"),casual:this.model.isTPA()?null:this.model.get("casual"),limit:10}}).setSortDirection(h.get("membersSortDirection")).setSortField(h.get("membersSortField")),grantedCollection:new b([],{data:{role:this.model.get("id"),platform:this.platform.get("id"),granted:true,casual:this.model.isTPA()?null:this.model.get("casual"),limit:10}}).setSortDirection(h.get("membersSortDirection")).setSortField(h.get("membersSortField")),platform:this.platform,model:this.model,searchPlaceholder:i.i18n("Search group"),filterViewAllText:i.i18n("View all"),filterGrantedOnlyText:i.i18n("View groups granted"),emptyText:i.i18n("No group found"),events:{onUnGrantRole:function(){var H=G.cache[n];if(H){H.invalidCacheAndReload()}},onGrantGroup:function(){var H=G.cache[n];if(H){H.invalidCacheAndReload()}}}}).render();break;case o:this.cache[E]=new q({model:this.model,platform:this.platform}).render();break;case C:this.cache[E]=new s({model:this.model}).render();break;case y:this.cache[E]=new u().render();new z({container:this.cache[E].container,platform:this.platform.getId(),product:this.model.get("id")}).show();break}F=this.cache[E]}return F},show:function(){var E=this;this.model.fetch({data:{platform:this.platform.getId(),id:this.model.get("id"),rolePlatform:this.model.get("platform")}});l.getServiceUrl({platformId:E.platform.get("id"),serviceName:"usersgroup",onComplete:function(F){if(F){m=true}E._renderTemplate()},onFailure:function(){E._renderTemplate()}});return this},_renderTemplate:function(){var F=this,E=function(){F.idCard=F.buildHeader();F.modal.setHeader(F.idCard);if(F.modal.getHeader().getElement(".thumbnail-section")){F.modal.getHeader().getElement(".thumbnail-section").setAttribute("data-percent",F.model.getPercent())}F.idCard.selectFacet(n);F.modal.getFooter().addClassName("hidden");F.modal.inject(document.body,"top").show()};if(F.model.get("id")==="IFW"){try{require(["DS/MPFSubscriptionComponent/SubscriptionListWrapper"],function(H){z=H;return E()},function(){return E()})}catch(G){E()}}else{E()}}})});define("DS/PlatformManagement/AppsList",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Controls/Pager","DS/UIKIT/Touch","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/W3DXComponents/Collections/ActionsCollection","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Views/AppsView","DS/PlatformManagement/Views/TileAddView","DS/PlatformManagement/Modal/RoleDetails","DS/PlatformManagement/Model/ProcessModel","DS/PlatformManagement/Model/MemberDetailsModel","DS/PlatformManagement/Modal/ThirdPartyApps","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/AppsCollection","DS/PlatformManagement/Model/AppModel","DS/PlatformManagement/Views/AppsRowView","DS/PlatformManagement/Controls/Input/Text"],function(f,q,j,r,m,t,l,s,e,i,n,o,g,b,d,c,p,h,k,a){return q.extend({defaultOptions:{},content:null,masked:false,collection:new p(),setup:function(v){var u=this._parent(v);this.buildContainer();return u},search:function(u){this.collection.setOffset(0);this.collection.setQuery(u);this.refresh()},refresh:function(u){this.setOptions(u);if(u&&u.params){this.collection.setParams(u.params)}this.buildContainer()},_manageCustomRoleDisplay:function(v){var u=c.getWidget().getElement("#create-custom");if(u){if(v){u.removeClassName("hidden")}else{u.addClassName("hidden")}}},createTableView:function(){var v=this,u=this.collection.map(function(w){w.actions=v._createAction(w);w.addEvent("onChange",function(){w.actions=this._createAction(w)},v);return new k({model:w,onSelect:v.options.onSelect,onActionClick:function(y,x,z){var A=y.id;z.stopPropagation();switch(A){case"info":v.openDetailModal(w);break;case"edit":v.openEditModal(w,x);break}}}).render()});return[new l({value:f.i18n("Create Additional App"),icon:"box-plus",className:"primary",events:{onClick:function(){v.action=new d({platform:v.options.platform,model:new h(),onAdded:function(){v.refresh()}})}}}),u.length>0?{tag:"table","class":"table",html:[{tag:"thead",html:[{tag:"td"},{tag:"td",text:f.i18n("Name")},{tag:"td",text:f.i18n("Type")},{tag:"td",text:f.i18n("Details")}]},{tag:"tbody",html:u}]}:null]},getPersistedData:function(w){var u=this,v=function(){if(u.collection.getQuery()===null){u.options.platform.set("hasTPA",u.collection.getMaxLimit()>0)}if(u.collection.getMaxLimit()>0){u.getBody().removeClassName("hidden");u.getBody().setContent(u.buildContent());u._manageCustomRoleDisplay(true)}else{if(u.collection.getQuery()===null){u.getBody().removeClassName("hidden");u.getBody().setContent(u.buildContent());u._manageCustomRoleDisplay(false)}else{u.collection.setQuery(null);u.setTitle(f.i18n("No result found"))}}if(w){c.scrollToElement(".apps-list-wrapper")}if(u.options.onRefresh){u.options.onRefresh()}u.unmask()};this.collection.fetch({onComplete:v})},buildContainer:function(){var u=this;if(!this.getBody()){this.elements.container=f.createElement("div",{"class":"process-list-wrapper apps-list-wrapper hidden"})}this.mask();if(this.options.platform&&this.options.platform!==null&&this.options.platform.isPlatform()){e.fetch({onComplete:function(){u.collection.setLimit(e.get("processesMaxPerPage"));u.collection.setSortDirection(e.get("processesSortDirection"));u.collection.setPlatform(u.options.platform.getId());u.getPersistedData()}})}},setTitle:function(u){if(this.getBody().getElement("h5 span")){this.getBody().getElement("h5 span").setText(f.String.format(f.i18n("Additional Apps | {0}"),u))}},getTitle:function(){return{tag:"h5",html:[{tag:"i","class":"fonticon fonticon-drive"},{tag:"span",text:f.String.format(f.i18n("Additional Apps | {0}"),this.collection.getMaxLimit())}]}},buildContent:function(){var u=[];u.push({"class":"divider"});u.push(this.buildFilter());u.push(this.getTitle());u.push({"class":"pm-grid-container "+(e.isGridLayout()?"layout-grid":"layout-table"),html:[e.isGridLayout()?this.buildTiles():this.createTableView(),this.buildPager()]});this.initTouchPager();return u},buildAddTile:function(){var v=this,u=new n({lazyLoading:false,model:new j({fonticon:"fonticon fonticon-box-plus",title:f.i18n("Create Additional App"),action:function(){if(!this.hasClassName("disabled")){v.action=new d({platform:v.options.platform,model:new h(),onAdded:function(){v.refresh()}})}}})});return u.render()},buildTiles:function(){var u=[],w=this,v;if(this.options.platform.get("platform")===true){u.push(w.buildAddTile())}this.collection.forEach(function(x){v=w.buildTile(x);u.push(v)});return u},_createAction:function(u){var v=[{id:"edit",title:f.i18n("Edit"),icon:"fonticon fonticon-pencil"}];if(u.get("private")){v.push({id:"info",title:f.i18n("Details"),icon:"fonticon fonticon-info"})}return v},buildFilter:function(){var v=this,u=new a({isCollapsable:true,minChar:3,attributes:{placeholder:f.i18n("Search Additional Apps"),value:this.collection.getQuery()||"",events:{keyup:function(){v.search(this.value)}}}});return{styles:{"padding-right":e.isGridLayout()?15:8,"float":"right"},html:u}},buildTile:function(v){var w=this,u;v.actions=new s(this._createAction(v));v.addEvent("onChange",function(){v.actions=new s(this._createAction(v))},this);u=new i({lazyLoading:false,model:v,mapping:{title:function(){return this.model.get("name")},subtitle:function(){return f.String.format(f.i18n("Type: {0}"),this.model.getDisplayType())},image:function(){return v.getIcon()},icon:function(){return null}},onSelect:w.options.onSelect,events:{onActionClick:function(x,A,y){y.stopPropagation();var z=A.model.get("id");switch(z){case"info":w.openDetailModal(v);break;case"edit":w.openEditModal(v,u);break}}}});return u.render()},openDetailModal:function(u){new o({model:u,isApp:true,platform:this.options.platform}).show()},openEditModal:function(v,u){var w=this;this.modal=new d({model:v,appId:v.get("id"),platform:this.options.platform,onDelete:function(){u.destroy();w.refresh()}})},touchPagerEvent:null,initTouchPager:function(){var v=this,u;if(!this.touchPagerEvent&&v.pager){this.touchPagerEvent=true;u=new m(v.getBody());u.on("swipeleft",function(){if(v.collection.hasNext()){v.collection.setOffset(v.collection.getNextOffset());v.pager.setOffset(v.collection.getOffset())}});u.on("swiperight",function(){if(v.collection.hasPrevious()){v.collection.setOffset(v.collection.getPreviousOffset());v.pager.setOffset(v.collection.getOffset())}})}},buildPager:function(){var v=this,u=this.collection.getMaxLimit();if(u>v.collection.getLimit()){this.pager=new r({limit:v.collection.getLimit(),offset:v.collection.getOffset(),type:1,pageLinks:10,max:u,showPageLinks:true,length:u,events:{onOffsetChange:function(w){v.mask();v.collection.setOffset(w);v.getPersistedData(true)}}})}else{this.pager=null}return this.pager},getBody:function(){if(!this.content){this.content=this.elements.container}return this.content},mask:function(){if(!this.isMasked()){t.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){t.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked}})});define("DS/PlatformManagement/ProcessList",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Controls/Pager","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Touch","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/W3DXComponents/Collections/ActionsCollection","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Views/ProcessView","DS/PlatformManagement/Views/TileAddView","DS/PlatformManagement/Model/ProcessModel","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Modal/RoleDetails","DS/PlatformManagement/Modal/CustomRole","DS/PlatformManagement/Views/ProcessRowView","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/EmptyView"],function(f,q,i,r,v,j,m,n,s,u,e,h,o,g,c,t,p,d,l,b,k){var a="process-list-wrapper";return q.extend({withLicenses:true,collection:new t(),touchPagerEvent:null,setup:function(x){var w=this._parent(x);this.buildContainer();return w},search:function(w){this.collection.setOffset(0);this.collection.setQuery(w);this.options.toGrantCollection.reset();this.refresh()},refresh:function(w){this.setOptions(w);if(w&&w.params){this.collection.setParams(w.params)}this.buildContainer()},setTitle:function(w){if(this.getBody().getElement("h5 span")){this.getBody().getElement("h5 span").setText(f.String.format(f.i18n("Roles | {0}"),w))}},getPersistedData:function(w){var y=this,x=false,z=function(){if(y.collection.getMaxLimit()>0){y.elements.container.setContent(y.buildContent());x=true;y.lastResult=y.collection.toJSON()}else{if(y.collection.getQuery()===null){y.elements.container.setContent(y.buildContent());y.lastResult=y.collection.toJSON()}else{y.collection.setQuery(null);y.setTitle(f.i18n("No result found"));y.collection.set(y.lastResult)}}if(x&&y.options.onRefresh){y.options.onRefresh()}if(w){c.scrollToElement("."+a)}y.unmask()};this.collection.setParams({withLicenses:this.withLicenses});this.collection.fetch({onComplete:z})},buildContainer:function(){var w=this;if(!this.getBody()){this.elements.container=f.createElement("div",{"class":a});this.getBody().setContent({"class":"empty-body"})}this.mask();if(this.options.platform&&this.options.platform!==null){e.fetch({onComplete:function(){w.collection.setLimit(e.get("processesMaxPerPage"));w.collection.setSortDirection(e.get("processesSortDirection"));w.collection.setPlatform(w.options.platform.getId());w.getPersistedData()}})}},buildContent:function(){var w=[];w.push({"class":"divider"});w.push(this.buildFilter());w.push(this.buildTitle(this.collection.getMaxLimit()));w.push({"class":"pm-grid-container "+(e.isGridLayout()?"layout-grid":"layout-table"),html:[e.isGridLayout()?this.buildTiles():this.createTableView(),((this.collection.getMaxLimit()===0)&&(!this.withLicenses))?new k().render(f.i18n("No roles without licenses available")):null,this.buildPager()]});this.initTouchPager();return w},_hasTPA:function(){return f.is(c.getWidget().getElement(".tp-apps"))},buildAddTile:function(){var x=this,w=new o({id:"create-custom",lazyLoading:false,model:new i({fonticon:"fonticon fonticon-role-plus",title:f.i18n("Create Custom Role"),action:function(){if(!this.hasClassName("disabled")){new d({model:new g(),platform:x.options.platform,onAdded:function(){x.refresh()}}).show()}}})});w.render();if(this._hasTPA()&&this.withLicenses===true){w.getContent().removeClassName("hidden")}else{w.getContent().addClassName("hidden")}return w},_createAction:function(w){var x=[];if(w.isCustom()){x.push({id:"edit",title:f.i18n("Edit"),icon:"fonticon fonticon-pencil"})}x.push({id:"info",title:f.i18n("Details"),icon:"fonticon fonticon-info"});return x},createTableView:function(){var x=this,w=this.collection.map(function(y){y.actions=x._createAction(y);y.addEvent("onChange",function(){y.actions=this._createAction(y)},x);return new l({model:y,getTileSubtitle:x.getTileSubtitle.bind(x),onSelect:x.options.onSelect,onActionClick:function(A,z,B){var C=A.id;B.stopPropagation();switch(C){case"info":x.openDetailModal(y);break;case"edit":x.openEditModal(y,z);break}}}).render()});return[new j({id:"create-custom",value:f.i18n("Create Custom Role"),icon:"role-plus",className:this._hasTPA()?"primary":"primary hidden",events:{onClick:function(){new d({model:new g(),platform:x.options.platform,onAdded:function(){x.refresh()}}).show()}}}),{tag:"table","class":"table",html:[{tag:"thead",html:[{tag:"td"},{tag:"td",text:f.i18n("Name")},{tag:"td",text:f.i18n("Included Apps")},{tag:"td",text:f.i18n("Used")},{tag:"td",text:f.i18n("Expire")},{tag:"td",text:f.i18n("Details")}]},{tag:"tbody",html:w}]}]},buildTiles:function(){var w=[],x=this;w.push(x.buildAddTile());this.collection.forEach(function(y){w.push(x.buildTile(y))});return w},getAppsText:function(w){var x=w.get("apps");return f.is(x)&&x<=1?f.String.format(f.i18n("{0} app"),x):f.String.format(f.i18n("{0} apps"),x)},getTileSubtitle:function(w){var x=null;if(w.isOption()&&w.isCasual()){x=f.i18n("Option, Casual usage")}else{if(w.isOption()&&w.isSelfExp()){x=f.i18n("Option, Trial")}else{if(w.isOption()){x=f.i18n("Option")}else{if(w.isCasual()){x=f.i18n("Casual usage")}else{if(w.isSelfExp()){x=f.i18n("Trial")}}}}}return x?'<span class="contractor-text">'+x+"</span>":null},getTileContent:function(w){var x=this.getAppsText(w);if(w.isSelfExp()){x+='<span class="nowrap"> | '+f.String.format(f.i18n("Used: {0}"),w.get("used"))+"</span>"}else{if(!w.isCustom()&&this.withLicenses===true){x+='<span class="nowrap"> | '+f.String.format(f.i18n("Used: {0}/{1}"),(w.get("total")-w.get("free")),w.get("total"))+" | </span>";x+='<span class="nowrap">'+f.String.format(f.i18n("Expires: {0}"),w.get("expire"))+"</span>"}}return x},buildTile:function(x){var y=this,w;x.actions=new u(this._createAction(x));x.addEvent("onChange",function(){x.actions=new u(this._createAction(x))},this);w=new h({lazyLoading:false,model:x,onSelect:y.options.onSelect,mapping:{title:function(){return this.model.get("name")},subtitle:function(){return y.getTileSubtitle(this.model)},image:function(){return this.model.getIcon()},icon:function(){return null},content:function(){return y.getTileContent(this.model)}},events:{onActionClick:function(z,C,A){A.stopPropagation();var B=C.model.get("id");switch(B){case"info":y.openDetailModal(x);break;case"edit":y.openEditModal(x,w);break}}}});return w.render()},openDetailModal:function(w){new p({model:w,platform:this.options.platform,withLicenses:this.withLicenses}).show()},openEditModal:function(x,w){var y=this;new d({model:x,platform:this.options.platform,onDelete:function(){w.destroy();y.refresh()}}).show()},initTouchPager:function(){var x=this,w;if(!this.touchPagerEvent&&x.pager){this.touchPagerEvent=true;w=new m(x.getBody());w.on("swipeleft",function(){if(x.collection.hasNext()){x.collection.setOffset(x.collection.getNextOffset());x.pager.setOffset(x.collection.getOffset())}});w.on("swiperight",function(){if(x.collection.hasPrevious()){x.collection.setOffset(x.collection.getPreviousOffset());x.pager.setOffset(x.collection.getOffset())}})}},buildPager:function(){var x=this,w=this.collection.getMaxLimit();if(w>x.collection.getLimit()){this.pager=new r({limit:x.collection.getLimit(),offset:x.collection.getOffset(),type:1,pageLinks:10,max:w,showPageLinks:true,length:w,events:{onOffsetChange:function(y){x.mask();x.collection.setOffset(y);x.getPersistedData(true)}}})}else{this.pager=null}return this.pager},buildTitle:function(w){return{tag:"h5",html:[{tag:"i","class":"fonticon fonticon-role"},{tag:"span",text:f.String.format(f.i18n("Roles | {0}"),w)}]}},_manageSelectionFilter:function(x,w){if(w.action==="select-all"){this.withLicenses=true}else{this.withLicenses=false}this.collection.setOffset(0);this.buildContainer()},buildFilter:function(){var y=this,w=new b({isCollapsable:true,minChar:3,attributes:{placeholder:f.i18n("Search Roles"),value:this.collection.getQuery()||"",events:{keyup:function(){y.search(this.value)}}}}),x=f.createElement("i",{"class":(this.withLicenses)?"pointer fonticon fonticon-filter":"pointer fonticon fonticon-filter withLicenses"});new n({target:x,items:[{text:f.i18n("Roles with licenses"),fonticon:"role-key",action:"select-all",selectable:true,selected:this.withLicenses},{text:f.i18n("Roles without any license"),fonticon:"role",action:"select-without",selectable:true,selected:!this.withLicenses}],events:{onClick:this._manageSelectionFilter.bind(this)}});new s({position:"right",target:x,body:f.i18n("Filter roles")});return[{styles:{"padding-right":e.isGridLayout()?15:8,"float":"right"},html:this.options.platform.canCrossCompanyExtended()?x:w},this.options.platform.canCrossCompanyExtended()?{styles:{"float":"right"},html:w}:null]},getBody:function(){if(!this.content){this.content=this.elements.container}return this.content},mask:function(){if(!this.isMasked()){v.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){v.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked}})});define("DS/PlatformManagement/Views/FacetMembers",["UWA/Core","UWA/Class/View","DS/PlatformManagement/MemberList","DS/PlatformManagement/ProcessList","DS/PlatformManagement/AppsList","DS/PlatformManagement/CreditAndTokenList","DS/PlatformManagement/Utils","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Modal/PrereqError","DS/PlatformManagement/Collection/ProcessCollection","UWA/Controls/Drag","DS/UIKIT/SuperModal","DS/PlatformManagement/Model/ProcessModel","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Loader","DS/PlatformManagement/Controls/PlatformNotify","UWA/Event","DS/PlatformManagement/Utils/DragManager","DS/UIKIT/Tooltip","DS/PlatformManagement/Controls/ButtonFab","DS/PlatformManagement/Model/MemberDetailsModel"],function(g,r,l,h,b,f,d,c,n,t,a,q,j,e,k,o,u,i,s,m,p){return r.extend({tagName:"div",grantBtn:null,className:"facet-members",toGrantCollection:new t(),setup:function(v){if(v.platform){this.platform=v.platform}if(v.taggerProxy){this.taggerProxy=v.taggerProxy}return v},render:function(){var v=this;this.processList=new h({toGrantCollection:v.toGrantCollection,onSelect:this.onSelectTile.bind(this),onRefresh:function(){v.manageButtonsState();v.manageCasualActivation();v.initDrag()}});this.memberList=new l({processList:this.processList,onSelect:this.onSelectTile.bind(this),taggerProxy:this.taggerProxy,manageCasualActivation:this.manageCasualActivation.bind(this),onRefresh:function(){v.manageButtonsState();v.manageCasualActivation();v.initDrag()}});this.creditAndTokenList=(this.platform&&this.platform!==null&&this.platform.isPlatform())?new f({creditAndTokenList:this.creditAndTokenList}):null;this.appsList=new b({onSelect:this.onSelectTile.bind(this),onRefresh:function(){v.manageButtonsState();v.initDrag()}});this.memberList.refresh({params:{platform:this.platform.getId(),offset:0},platform:this.platform});this.processList.refresh({params:{platform:this.platform.getId(),offset:0},platform:this.platform});this.appsList.refresh({params:{platform:this.platform.getId(),offset:0},platform:this.platform});if(this.creditAndTokenList){this.creditAndTokenList.refresh({params:{platform:this.platform.getId(),offset:0},platform:this.platform})}this.container.setContent([this.memberList.getContent(),this.processList.getContent(),this.appsList.getContent(),this.creditAndTokenList&&this.creditAndTokenList.getContent()]);if(!v.buttonFab){setTimeout(function(){var w=v.container.getParent(".scroller-root");v.buttonFab=new m({wrapper:w,action:v.onGrant.bind(v),events:{onActionClick:function(y){var x=function(){return v.memberList.getContent().getElements('[data-type="user"].selected').map(function(A){var z=new k();z.inject(A);return A.getAttribute("data-id")})};switch(y){case"default":v.onGrant();break;case"remove-people":new p({id:"_"}).destroy({data:{user:x().join(","),platform:v.platform.getId()},wait:true,onComplete:function(z,A){o.success(A.message);v.memberList.forceRefreshView=true;v.memberList.refresh();v.processList.refresh()},onFailure:function(z,A){if(A.message){o.warn(A.message)}v.memberList.forceRefreshView=true;v.memberList.refresh()}});break;case"remove-roles":e.removeAllRoles({data:{user:x().join(","),platform:v.platform.getId()},callbacks:{onComplete:function(z){o.success(z.message);v.memberList.forceRefreshView=true;v.memberList.refresh();v.processList.refresh()},onFailure:function(z){if(z.message){o.warn(z.message)}v.memberList.forceRefreshView=true;v.memberList.refresh()}}});break}}}}).render();v.buttonFab.inject(w)},200)}return this},_refreshViewAfterGranting:function(v,w){if(v){v.forEach(function(x){x.destroy()});v=null}if(this._isIOS()){this.memberList.unmask()}if(w){this.processList.refresh()}else{this.processList.getContent().getElements(".process.selected").forEach(function(y){var x=y.getElement("input");y.removeClassName("selected");if(x){x.checked=false}})}this.toGrantCollection.reset();this.appsList.getContent().getElements(".tp-apps.selected").forEach(function(y){var x=y.getElement("input");y.removeClassName("selected");if(x){x.checked=false}});this.memberList.getContent().getElements('[data-type="user"].selected').forEach(function(y){var x=y.getElement("input");y.removeClassName("selected");if(x){x.checked=false}});this.manageButtonsState()},onGrant:function(){var B=this,w,C=[],v=[],z=false,y,A=B.processList.collection,x;B.memberList.getContent().getElements('[data-type="user"].selected').forEach(function(D){C.push(D.getAttribute("data-id"));w=new k();w.inject(D);v.push(w)});B.processList.getContent().getElements('[data-type="process"].selected').forEach(function(D){w=new k();w.inject(D);v.push(w);z=true;if(!B.toGrantCollection.get(D.getAttribute("data-id"))){x=A.get(D.getAttribute("data-id"));B.toGrantCollection.add(x);y=new c({platform:B.platform,selectMode:true,selectedCollection:B.toGrantCollection,model:x});B.toGrantCollection.add(y.getMandatoryPrereq().toJSON())}});B.appsList.getContent().getElements('[data-type="process"].selected').forEach(function(D){w=new k();w.inject(D);v.push(w);B.toGrantCollection.add({uid:D.getAttribute("data-id")})});e.createLicensesUser({user:C.join(","),licenses:B.toGrantCollection.toJSONString(B.processList.withLicenses),platform:B.platform.getId()},{onComplete:function(D){o.success(D.message);B._refreshViewAfterGranting(v,z)},onFailure:function(D,E){if(D.message||E.message){o.warn(D.message||E.message)}B._refreshViewAfterGranting(v,z)}})},manageButtonsState:function(){var w=this.container,y=w.getElements('[data-type="user"].selected'),v=w.getElements('[data-type="process"].selected'),x=w.getElement('[data-action="select-mode"]');if(this.buttonFab){if(y.length>0&&v.length>0){this.buttonFab.showSingle()}else{if(y.length>0){this.buttonFab.showMultiple()}else{this.buttonFab.hide()}}}if(x){if(y.length===this.memberList.collection.size()&&this.memberList.collection.size()!==0){x.removeClassName("fonticon-mouse-pointer-check").addClassName("fonticon-files-check").getParent("li").addClassName("item-active")}else{x.removeClassName("fonticon-files-check").addClassName("fonticon-mouse-pointer-check");if(y.length===0){x.getParent("li").removeClassName("item-active")}else{x.getParent("li").addClassName("item-active")}}}},_manageSelection:function(y,w){var v='[data-type]:not([data-trial]):not([data-free="0"])[data-casual]',B=y.getElements(v+".selected"),x=w.getElements(v+".selected"),C;if(B.length>0||x.length>0){if(B.length>0){C=B[0].getAttribute("data-casual")}if(x.length>0){C=x[0].getAttribute("data-casual")}y.getElements(v+':not([data-casual="'+C+'"])').invoke("addClassName","disabled");w.getElements(v+':not([data-casual="'+C+'"])').invoke("addClassName","disabled")}if(B.length>0){var A=B[0].getAttribute("data-cross-company");y.getElements(v+':not([data-cross-company="'+A+'"])').invoke("addClassName","disabled");if(A==="true"){w.getElements(v+':not([data-cross-company="'+A+'"])').invoke("addClassName","disabled")}}if(x.length>0){var z=g.Array.detect(x,function(D){return D.getAttribute("data-cross-company")==="false"});if(z){y.getElements(v+':not([data-cross-company="false"])').invoke("addClassName","disabled")}}if(C&&C!==0){w.getElements('[data-free="0"][data-cross-company="true"]:not([data-casual="'+C+'"])').invoke("addClassName","disabled")}else{w.getElements('[data-free="0"][data-cross-company="true"]').invoke("removeClassName","disabled")}},manageCasualActivation:function(){var w=this.container,v='[data-type]:not([data-trial]):not([data-free="0"])[data-casual]',y=w.getElement(".process-list-wrapper .pm-grid-container"),x=w.getElement(".member-list-wrapper .pm-grid-container");w.getElements(v).invoke("removeClassName","disabled");if(x&&y){this._manageSelection(x,y)}},onSelectTile:function(A,C,w){var v=this.container,z=this,y=new q({closable:false}),B=false,x=function(E){var D;E.forEach(function(F){D=v.getElement(d.escapeDomSelector("[data-id="+F.get("uid")+"]"));if(D){z._select(D)}z.toGrantCollection.add(F)})};if(A&&A.hasClassName("selected")){if(C instanceof j&&C){y=new c({platform:z.platform,selectMode:true,selectedCollection:z.toGrantCollection,model:C,onConfirm:function(D){x(D);z.toGrantCollection.add(C);z.manageCasualActivation(C.getCasual())},onCancel:function(){z._unselect(A);z.manageButtonsState();z.manageCasualActivation(C.getCasual())}});if(y.isNeeded()){B=true;y.confirm()}else{z.toGrantCollection.add(C);z.manageCasualActivation(C.getCasual())}}}else{if(C&&C instanceof j&&A){y=new n({removeRequired:true,selectedCollection:z.toGrantCollection,model:C,onRemovedRequired:function(D){D.forEach(function(F){var E=z.processList.getContent().getElement('[data-type="process"][data-id="'+F+'"].selected');if(E){z._unselect(E)}})},onCancel:function(D){if(!D){z._select(A)}z.manageCasualActivation(C.getCasual())}});if(y.isNeeded()){B=true;y.show()}else{z.toGrantCollection.remove(C.get("uid"));z.manageCasualActivation(C.getCasual())}}}if(C&&!(C instanceof j)){z.manageCasualActivation(C.get("casual"))}z.manageButtonsState();if(!w){z.initDrag()}return B},_select:function(w){var v=w.getElement("input");w.addClassName("selected");if(v){v.checked=true}},_unselect:function(w){var v=w.getElement("input");w.removeClassName("selected");if(v){v.checked=false}},_isIOS:function(){return(d.detectOs()==="ios"||d.detectOs()==="macos")},initDrag:function(){var v=this.container,w=this;if(this.dragMembers){this.dragMembers.destroy()}if(this.dragProcesses){this.dragProcesses.destroy()}if(v.getElements('.process-list-wrapper [data-type="process"]:not(.disabled):not(.tp-apps-public)').length>0&&v.getElements('.member-list-wrapper [data-type="user"]:not(.disabled)').length>0){this.dragMembers=new i({tileIdentifier:'[data-type="user"]',container:v,scrollView:this.options.getScrollView(),zonesIdentifier:'.process-list-wrapper [data-type="process"]:not(.disabled):not(.tp-apps-public)',wrapperSelector:".member-list-wrapper",cancelZoneLocationSelector:".member-list-wrapper .pm-grid-container",collection:this.memberList.collection,onSelect:this.onSelectTile.bind(this),initDrag:this.initDrag.bind(this),drop:function(A){var y,E=[],x=[],C=new t(w.processList.collection.toArray()),z=C.get(A.zone.getAttribute("data-id")),B,D=function(F){e.createLicensesUser({user:F.join(","),licenses:w.toGrantCollection.toJSONString(w.processList.withLicenses),platform:w.platform.getId()},{onComplete:function(G){o.success(G.message);w._refreshViewAfterGranting(x,true)},onFailure:function(G,H){if(G.message||H.message){o.warn(G.message||H.message)}w._refreshViewAfterGranting(x,true)}})};if(w._isIOS()){w.memberList.mask();v.getElements('.member-list-wrapper [data-type="user"].selected').forEach(function(F){E.push(F.getAttribute("data-id"))})}else{v.getElements('.member-list-wrapper [data-type="user"].selected').forEach(function(F){E.push(F.getAttribute("data-id"));y=new k();y.inject(F);x.push(y)})}y=new k();y.inject(A.zone);x.push(y);if(z){B=new c({platform:w.platform,selectMode:true,selectedCollection:w.toGrantCollection,model:z,onConfirm:function(F){w.toGrantCollection.add(F.toJSON());w.toGrantCollection.add(z);D(E)},onCancel:function(){w.memberList.unmask();x.forEach(function(F){F.destroy()})}});if(B.isNeeded()){B.confirm()}else{w.toGrantCollection.add(z);D(E)}}else{w.toGrantCollection.add({uid:A.zone.getAttribute("data-id")});D(E)}return true}}).initDrag();this.dragProcesses=new i({tileIdentifier:'[data-type="process"]:not(.disabled):not([data-public="true"])',container:v,scrollView:this.options.getScrollView(),zonesIdentifier:'.member-list-wrapper [data-type="user"]:not(.disabled)',wrapperSelector:".process-list-wrapper",cancelZoneLocationSelector:".member-list-wrapper .pm-grid-container",collection:this.processList.collection,onSelect:this.onSelectTile.bind(this),initDrag:this.initDrag.bind(this),drop:function(z){var F,y=[],C=[],D=false,x=false,E,A=new t(w.processList.collection.toArray()),B;w.processList.getContent().getElements('[data-type="process"].selected').forEach(function(G){if(!w._isIOS()){F=new k();F.inject(G);C.push(F)}D=true;if(!w.toGrantCollection.get(G.getAttribute("data-id"))){B=A.get(G.getAttribute("data-id"));w.toGrantCollection.add(B);E=new c({platform:w.platform,selectMode:true,selectedCollection:w.toGrantCollection,model:B});w.toGrantCollection.add(E.getMandatoryPrereq().toJSON())}});w.appsList.getContent().getElements('[data-type="process"].selected').forEach(function(G){x=true;if(!w._isIOS()){F=new k();F.inject(G);C.push(F)}w.toGrantCollection.add({uid:G.getAttribute("data-id")})});if(w._isIOS()){if(D){w.processList.mask()}if(x){w.appsList.mask()}}y.push(z.zone.getAttribute("data-id"));if(!w._isIOS()){F=new k();F.inject(z.zone);C.push(F)}else{w.memberList.mask()}e.createLicensesUser({user:y.join(","),licenses:w.toGrantCollection.toJSONString(w.processList.withLicenses),platform:w.platform.getId()},{onComplete:function(G){o.success(G.message);w._refreshViewAfterGranting(C,D)},onFailure:function(G,H){if(G.message||H.message){o.warn(G.message||H.message)}w._refreshViewAfterGranting(C,D)}});return true}}).initDrag()}}})});define("DS/PlatformManagement/Widgets/MembersRoles",["UWA/Core","UWA/Class","UWA/Class/Model","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/W3DXComponents/IdCard","DS/W3DXComponents/Views/Layout/ScrollView","DS/PlatformManagement/Model/PlatformModel","DS/PlatformManagementComponents/Collection/Platform","DS/PlatformManagement/Utils","DS/PlatformManagement/Modal/Notifications","DS/PlatformManagement/Modal/ImportReport","DS/PlatformManagement/Views/FacetMembers","DS/PlatformManagement/Views/ConfigureMembersInvitations","DS/PlatformManagement/Views/ConfigureNetworkInstallation","DS/PlatformManagement/Modal/InviteMember","DS/PlatformManagement/Modal/ThirdPartyApps","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Model/AppModel","DS/PlatformManagement/Utils/SearchManager","DS/PlatformManagement/Utils/TaggerManager","DS/PlatformManagement/Model/I18nModel","DS/PlatformManagement/Modal/SubscriptionErrorModal","DS/i3DXCompassCore/RequestOptions","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassServices/i3DXCompassServices","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassCore/Csrf","DS/PlatformManagement/CreditAndTokenList"],function(d,a,B,x,p,l,w,f,r,y,j,c,n,H,A,h,G,I,J,C,m,u,K,b,F,z,q,E,g){var t="en",s,e=0,i=1,D=2,k=3,o=4;var v=null;return a.extend({cache:null,toGrantCollection:null,_isInitialized:false,platform:null,init:function(L){var M=this;this.selectedFacet=e;s=L.widget;this.collection=null;this.invalidateCache();s.addEvent("onUpdateValue",function(N,O){var P=M.collection._models,R=function(T){var S=false;P.forEach(function(U){if(T===U.get("id")&&!U.get("platform")){S=true}});return S},Q=function(){var S=false;P.forEach(function(T){if(T.get("platform")){S=T.get("id");return true}});return S};if(this.data&&this.data.advancedMode&&(N==="x3dPlatformId"||N==="tenantPlatform")&&O&&R(O)){v={x3dPlatformId:Q(),tenantPlatform:O}}else{if(this.data&&(N==="advancedMode")){if(this.data.advancedMode){v={tenantPlatform:null}}else{v={x3dPlatformId:Q(),tenantPlatform:null}}}}});s.addEvent("endEdit",this.endEditfunction.bind(this));q.subscribe("PlatformManagement.refresh",function(N){if(N!==s.id){s.dispatchEvent("onLoad")}});q.subscribe("PlatformManagement.renamePlatformName",function(N){s.setTitle(N);M.platform.set("name",N)});return this._parent(L)},invalidateCache:function(){this.cache=[]},onBeforeLoad:function(){var L=this,M;y.setWidget(s);y.setLang(s.lang);s.body.addClassName("members-roles");s.body.addClassName("platform-management-2");if(y.isLightweight()){s.body.addClassName("lightweight")}M=y.getLang();b.setupLanguage(M);E.getTokenCSRF();I.fetch({onComplete:function(){if(M!==t){new u().fetch({onComplete:function(O,N){d.i18n(N);L.initPreferences()},onFailure:function(){L.initPreferences()}})}else{L.initPreferences()}}})},getPreferenceValue:function(L){return d.is(s.getValue(L))?s.getValue(L):I.get(L)},initPreferences:function(){var L=this;x.mask(s.body);L.collection=new r({includeWu:this.getPreferenceValue("advancedMode")==="true",lang:y.getLang()});if(this.getPreferenceValue("advancedMode")==="true"){L.collection.fetch({onComplete:L.onPlatformFetch.bind(L)})}else{F.getAppInfo({appId:"X3DOPMR_AP",onComplete:function(M){L.collection.set(M.platforms);L.onPlatformFetch()}})}},onPlatformFetch:function(){var M=this,L=[],N={},O=this.collection;if(!d.is(this.getCurrentPlatform())){new p({visible:true,messages:[{message:d.i18n("You have no access to this resource"),className:"error"}]}).inject(s.body.getElement("div"));x.unmask(s.body);return}s.setTitle(this.getCurrentPlatform().get("displayName")||this.getCurrentPlatform().get("name"));O.forEach(function(P){L.push({label:P.get("displayName")||P.get("name"),value:P.get("id"),id:P.get("id")})});if(O.size()>1){s.addPreference({type:!s.getValue("tenantPlatform")?"list":"hidden",id:"x3dPlatformId",name:"x3dPlatformId",label:d.i18n("3DExperience platform"),defaultValue:s.getValue("tenantPlatform")||s.getValue("x3dPlatformId"),options:L})}if(s.getValue("tenantPlatform")){s.addPreference({type:"list",id:"tenantPlatform",name:"tenantPlatform",label:d.i18n("3DExperience platform"),defaultValue:s.getValue("tenantPlatform"),options:L})}s.addPreference({type:"hidden",id:"displayMode",name:"displayMode",label:d.i18n("Display layout"),defaultValue:this.getPreferenceValue("displayMode")});s.addPreference({type:"boolean",id:"membersDisplayPicture",name:"membersDisplayPicture",label:d.i18n("Display Picture"),defaultValue:this.getPreferenceValue("membersDisplayPicture")});s.addPreference({type:"list",id:"membersSortField",name:"membersSortField",label:d.i18n("Sort by"),defaultValue:this.getPreferenceValue("membersSortField"),options:[{label:d.i18n("First Name"),value:"First Name"},{label:d.i18n("Last Name"),value:"Last Name"},{label:d.i18n("Email"),value:"Email Address"}]});s.addPreference({type:"list",id:"membersSortDirection",name:"membersSortDirection",label:d.i18n("Sort Direction"),defaultValue:this.getPreferenceValue("membersSortDirection"),options:[{label:d.i18n("A=>Z"),value:"asc"},{label:d.i18n("Z=>A"),value:"desc"}]});s.addPreference({type:"list",id:"membersMaxPerPage",name:"membersMaxPerPage",label:d.i18n("Number of results per page"),defaultValue:this.getPreferenceValue("membersMaxPerPage"),options:[{value:"10",label:"10",id:"10"},{value:"25",label:"25"},{value:"50",label:"50"}]});s.addPreference({type:M.getCurrentPlatform().isOnPremise()?"hidden":"boolean",id:"advancedMode",name:"advancedMode",label:d.i18n("Allow granting roles without granting access to any platform"),defaultValue:this.getPreferenceValue("advancedMode")});s.getPreferences().forEach(function(P){N[P.name]=P.value});N.processesMaxPerPage=this.getPreferenceValue("membersMaxPerPage");N.processesSortDirection=this.getPreferenceValue("membersSortDirection");I.set(N);if(!this._isInitialized){this._initTopBar();this._initTagger();this._initSearch();this._isInitialized=true}if(this.getPreferenceValue("advancedMode")==="true"){this.onLoad()}else{z.getServiceUrl({platformId:M.platform.get("id"),serviceName:"3DSwym",onComplete:function(P){M.platform.set("swym",P);M.platform.fetch({data:{id:M.platform.get("id")},onComplete:M.onLoad.bind(M)})}})}},getFacetMemberView:function(){return this.getFacet(e).view},setTopBar:function(O){var P=this,N=function(){if(P.action&&P.action.elements&&P.action.elements.container&&P.action.elements.container.isVisible&&!P.action.elements.container.masked){P.action.destroy()}},L=P.getCurrentPlatform(),R=new O({label:d.i18n("Members"),onExecute:function(){N();P.action=new h({platform:L,hasApp:true,onAdded:function(){q.publish("PlatformManagement.refresh",s.id);P.getFacetMemberView().memberList.refresh()}})}}),M=new O({label:d.i18n("Additional Apps"),onExecute:function(){N();P.action=new G({platform:L,model:new J(),onAdded:function(){P.getFacetMemberView().appsList.refresh()}})}}),Q=[],S=[];if(L.get("platform")){Q.push(R);Q.push(M)}P.topBarProxy.setContent({add:Q,home:S})},_initTopBar:function(){var M=this,L={id:s.id};require(["DS/TopBarProxy/TopBarProxy","DS/TopBarProxy/MenuItem"],function(N,O){M.topBarProxy=new N(L);M.setTopBar(O)})},_initSearch:function(){new C(s).register()},_initTagger:function(){m.setup(s)},onLoad:function(){var L;if(this.getCurrentPlatform().hasError()){new K({platform:this.getCurrentPlatform()}).show()}else{L=this.buildIdCard();x.unmask(s.body);this.invalidateCache();s.setBody([L,{"class":"id-card-content",html:""}]);L.selectFacet(this.selectedFacet);this._addNotificationBadge(this.getCurrentPlatform().get("unread"));s.setTitle(this.platform.get("name"));s.body.getElement(".id-card-content").setStyle("height","calc(100% - 55px)")}},_addNotificationBadge:function(M){var L=s.body.getElements(".facets-list .facet")[i];if(L){L.setStyle("position","relative");d.createElement("div",{"class":"badge-notification",html:{tag:"span",text:M,"class":M!==0?"badge":"badge hidden"}}).inject(L)}},_updateNotificationBadge:function(N){var M=s.body.getElements(".facets-list .facet")[i],L;if(M){L=M.getElement(".badge");if(L){if(N>0){L.removeClassName("hidden");L.setText(N)}else{L.addClassName("hidden")}}}},onRefresh:function(){this.initPreferences()},onUpdateValue:function(N,L,M){console.log("onUpdateValue ==== ");console.log(N,L,M);if(this.data&&this.data.tenantPlatform&&N==="x3dPlatformId"&&L){this.data.tenantPlatform=L}},endEditfunction:function(){this.platform=null;if(v){y.getWidget().setValues(v);v=null}},onResize:function(){},getCurrentPlatform:function(){var M=(s.getValue("tenantPlatform")&&s.getValue("tenantPlatform")!=="")?s.getValue("tenantPlatform"):s.getValue("x3dPlatformId"),L;if(!this.platform){if(M&&M!==""){L=this.collection.get(M)}this.platform=L?new f(L.toJSON()):new f(this.collection.first().toJSON())}return this.platform},getIdCardContent:function(){return s.body.getElement(".id-card-content")},buildIdCard:function(){var L=this;return new l({model:new B(),actions:[],facets:function(){var M=[{text:d.i18n("Invite & Grant Roles"),icon:"users",handler:function(){L.selectedFacet=e;L.getIdCardContent().setContent(L.getFacet(e))}}];if(L.getCurrentPlatform().get("platform")===true){M.push({text:d.i18n("Manage Requests"),icon:"bell",handler:function(){L.selectedFacet=i;L.platform.fetch({data:{id:L.getCurrentPlatform().id},onComplete:function(){L.getIdCardContent().setContent(L.getFacet(i))}})}});M.push({text:d.i18n("Import Members"),icon:"upload",handler:function(){L.selectedFacet=D;L.getIdCardContent().setContent(L.getFacet(D))}})}if(!y.isLightweight()){if(!L.getCurrentPlatform().isOnPremise()&&L.getCurrentPlatform().get("platform")===true){M.push({text:d.i18n("Configure Members Invitations"),icon:"user-cog",handler:function(){L.selectedFacet=k;x.mask(L.getIdCardContent());L.platform.fetch({data:{id:L.getCurrentPlatform().id},onComplete:function(){x.unmask(L.getIdCardContent());L.getIdCardContent().setContent(L.getFacet(k))}})}})}if(L.getCurrentPlatform().get("platform")===true){M.push({text:d.i18n("Configure Apps Installation"),icon:"cog",handler:function(){L.selectedFacet=o;x.mask(L.getIdCardContent());L.platform.fetch({data:{id:L.getCurrentPlatform().id},onComplete:function(){x.unmask(L.getIdCardContent());L.getIdCardContent().setContent(L.getFacet(o))}})}})}}return M}})},getFacet:function(L){var M=this.cache[L],N;s.body.getElement(".id-card-content").setStyle("height","calc(100% - 55px)").setAttribute("data-view","facet-"+L);if(!d.is(M)){switch(L){case e:this.cache[L]=new w({useInfiniteScroll:false,usePullToRefresh:false,orientation:"vertical",view:new n({platform:this.getCurrentPlatform(),taggerProxy:this.taggerProxy,getScrollView:function(){return this.cache[e]}.bind(this)})}).render();break;case i:s.body.getElement(".id-card-content").setStyle("height","calc(100% - 200px)");N=new j({platform:this.platform,_widgetHeight:"calc(100% - 200px)",_updateNotificationBadge:this._updateNotificationBadge.bind(this)});this.cache[L]=N.getContent();break;case D:this.cache[L]=new c({platform:this.getCurrentPlatform(),_widgetHeight:"calc(100% - 130px)"}).render();break;case k:this.cache[L]=new w({useInfiniteScroll:false,usePullToRefresh:false,orientation:"vertical",view:new H({platform:this.platform,taggerProxy:this.taggerProxy,getScrollView:function(){return this.cache[k]}.bind(this)})}).render();break;case o:this.cache[L]=new w({useInfiniteScroll:false,usePullToRefresh:false,orientation:"vertical",view:new A({platform:this.platform,taggerProxy:this.taggerProxy,getScrollView:function(){return this.cache[o]}.bind(this)})}).render();break}M=this.cache[L]}return M},onSearch:function(L){if(L){L=L.toLowerCase()}this.getFacetMemberView().memberList.search(L);this.getFacetMemberView().processList.search(L);this.getFacetMemberView().appsList.search(L);this.getFacetMemberView().creditAndTokenList.search(L)},onResetSearch:function(){if(this.collection){this.onSearch(null)}},onViewChange:function(){}})});