define("DS/XCT25DExperience/XCT25DPlatformHelpers",["UWA/Class/Promise","DS/WAFData/WAFData"],function(c,a){const b={getStreamsPromise:function(e){const d=this;return new c(function(g,f){var i=e.physicalid;d.securityContext=e.contextid;d.serverUrl=e.serverurl;var j=e.tenant;var h=d.serverUrl+"/resources/experience/medias/"+i+"/streams"+((j)?"/?tenant="+j:"");a.authenticatedRequest(h,{method:"GET",type:"json",headers:{"Content-Type":"application/json",SecurityContext:d.securityContext},onComplete:function(l){const k=l.results.find(function(m){return(/\.(dsxm)$/i).test(m.persistencyname)});if(k){g(k)}else{f(new Error(".dsxm file not found"))}},onFailure:function(k){f(new Error(k))}})}).then(function(f){return d.streamDescriptorToTicketPromise(f.physicalid,f.persistencyname)}).then(function(f){return d.retrieveStreamContentPromise(f)})},streamDescriptorToTicketPromise:function(e,f){const d=this;const g={fcsurl:"",ticket:""};return new c(function(k,j){const h=d.serverUrl+"/resources/experience/medias/"+e+"/streams/"+f;const i=d.serverUrl+"?__fcs__jobTicket="+encodeURIComponent(g.ticket)+"&jobTicket=__fcs__jobTicket&__fcs__attachment=true";a.authenticatedRequest(h,{method:"GET",type:"json",cache:-1,headers:{"Content-Type":"application/json",SecurityContext:d.securityContext},onComplete:function(m){const l={data:m,ticketUrl:i};k(l)},onFailure:function(l){j(new Error(l))}})})},retrieveStreamContentPromise:function(e){const d=e.data.results[0];return new c(function(h,g){var f={timeout:100000,method:"GET",data:"__fcs__jobTicket="+encodeURIComponent(d.ticket),responseType:"blob",headers:{Accept:"application/octet-stream"},onComplete:function(i){h(i)},onFailure:function(i){g(new Error(i))}};f.proxy="passport";a.authenticatedRequest(d.fcsurl,f)})}};return b});define("DS/XCT25DExperience/XCT25DConfig",[],function(){var a="MediaVideo3DExp";return Object.freeze({MEDIA_TYPE:a,SEARCH_STRING_MEDIA_TYPE:"type: "+a})});define("DS/XCT25DExperience/XCTSequenceLoader",["UWA/Class","DS/Visualization/ThreeJS_DS"],function(a,b){var c=a.extend({init:function(){this.setMakeFilePathsCallback=this.setMakeFilePathsCallback.bind(this);this.resetMakeFilePathsCallback=this.resetMakeFilePathsCallback.bind(this);this.onProgressCB=null;this.onLoadedCB=null;this.onErrorCB=null;this.onStateLoadedCB=null;this.resetMakeFilePathsCallback()},loadState:function(f,d,e){if(d.images.length===6){this.loadSkyboxState(f,d,e)}else{this.loadImageState(f,d,e)}},loadSkyboxState:function(j,g,h){var e=this;var d=[];for(var f=0;f<6;f++){d.push(g.images[f][h?1:0])}e.makeFilePaths(d,function(m){for(var i=0;i<m.length;i++){var l=e.loadTexture(j,g,m[i]);var k=new b.MeshBasicMaterial({map:l,side:b.BackSide});g.materialArray.push(k)}g.material=new b.MeshFaceMaterial(g.materialArray)})},loadImageState:function(h,f,g){var e=this;var d=[f.images[g?1:0]];e.makeFilePaths(d,function(k){var j=e.loadTexture(h,f,k[0]);var i=new b.MeshBasicMaterial({map:j,side:b.DoubleSide});i.force=true;f.material=i})},loadTexture:function(i,g,e){var d=this;var h=URL.createObjectURL(new Blob([e]));g.total++;var f=b.ImageUtils.loadTexture(h,undefined,function(){if(i.uuid!==d.currentSequenceUuid){return}g.total--;if(g.total===0&&d.onStateLoadedCB){d.onStateLoadedCB({state:g})}if(d.onProgressCB){d.onProgressCB({uuid:i.uuid,total:i.totalStates,loaded:i.totalLoaded})}if(i.totalStates===i.totalLoaded){if(d.onLoadedCB){d.onLoadedCB()}}},undefined,!i.spec.from3DSpace);f.flipY=false;return f},setOnProgressCallback:function(d){this.onProgressCB=d},setOnLoadedCallback:function(d){this.onLoadedCB=d},setOnErrorCallback:function(d){this.onErrorCB=d},setOnStateLoadedCallback:function(d){this.onStateLoadedCB=d},setMakeFilePathsCallback:function(d){this.makeFilePaths=d},resetMakeFilePathsCallback:function(){this.setMakeFilePathsCallback(this.defaultMakeFilePathsCallback)},defaultMakeFilePathsCallback:function(e,g){var d=[];for(var f=0;f<e.length;f++){d.push(this.imagePrefix+e[f])}setTimeout(g,10,d)}});return c});define("DS/XCT25DExperience/XCTSequenceModel",["UWA/Class"],function(a){var b=a.extend({init:function(c){this._parent(c);this.uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var e=Math.random()*16||0,d=f==="x"?e:(e&&3||8);return d.toString(16)});this.root="";this.states=[];this.transitions=[];this.aspectRatio=1}});return b});define("DS/XCT25DExperience/XCTSequenceSceneManager",["UWA/Class","DS/Visualization/Node3D","DS/Visualization/SceneGraphUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/SceneGraphConverter","DS/Visualization/ThreeJS_DS"],function(b,f,a,c,e,d){var g=b.extend({MODE_IMAGE:0,MODE_SKYBOX:1,DISTANCE:110,DEFAULT_FOV:45,init:function(h){this._parent(h);this.resetViewpoint=this.resetViewpoint.bind(this);this.showState=this.showState.bind(this);this.createRootNode=this.createRootNode.bind(this);this.setFOV=this.setFOV.bind(this);this.moveCameraBy=this.moveCameraBy.bind(this);this.moveCameraTo=this.moveCameraTo.bind(this);this.frameWindow=h.frameWindow;this.aspectRatio=h.aspectRatio;this.mode=2;this.viewpoint=this.frameWindow.getViewpoint();var i=this.frameWindow.getViewer||this.frameWindow.getViewerFrame;i=i.bind(this.frameWindow);this.viewer=i();this.context=this.viewer.getWebGLContext();this.imageScaleUp=1;this.hFreedomOfMovement=0;this.vFreedomOfMovement=0;this.h=0;this.v=0},createRootNode:function(){if(this.sceneGraph){this.sceneGraph.removeChild(this.image);this.sceneGraph.removeChild(this.skybox);this.image=undefined;this.skybox=undefined;this.viewer.removeNode(this.sceneGraph)}this.viewer.clearScene();this.sceneGraph=new f();this.viewer.addNode(this.sceneGraph)},showState:function(h){this.mode=h.mode;if(h.material!==undefined){if(this.mode===this.MODE_SKYBOX){this.showSkybox(h)}else{this.showImage(h)}}this.resetViewpoint();setTimeout(this.resetViewpoint,150);this.render()},showSkybox:function(h){if(this.skybox){this.sceneGraph.removeChild(this.skybox);this.skybox=undefined}this.buildSkybox(this.sceneGraph,h.material)},showImage:function(h){if(this.image===undefined){this.buildImage(this.sceneGraph)}this.rectangle.setMaterial(h.material)},buildSkybox:function(h,l){h=h||new f();var j=new d.CubeGeometry(5000,5000,5000);var m=new d.Mesh(j,l);m.geometry.applyMatrix(new d.Matrix4().rotateX(-0.5*Math.PI));m.geometry.applyMatrix(new d.Matrix4().rotateZ(-0.5*Math.PI));var i=new d.Scene();i.add(m);var k=new e(this.context,i);this.skybox=k.getRootNode();h.addChild(this.skybox);return h},buildImage:function(j,n){j=j||new f();var i=this.DISTANCE*2;this.rectangle=c.createRectangleNode({width:this.aspectRatio*i,height:i,fill:true,material:n});var h=new d.Matrix4();var l=new d.Matrix4().makeRotationX(-Math.PI*0.5);var k=new d.Matrix4().makeRotationY(-Math.PI*1.5);h.multiply(l);h.multiply(k);h.setPosition(new d.Vector3(0,this.aspectRatio*i*0.5,i*0.5));this.rectangle.setMatrix(h);this.image=new f();this.image.add(this.rectangle);j.addChild(this.image);return j},resetViewpoint:function(){this.setFOV(this.DEFAULT_FOV);this.moveCameraTo(0,0)},setFOV:function(i){var j=this.viewpoint.camera;if(i!==j.fov){j.fov=i;var h=this.viewpoint.viewer.SCREEN_WIDTH/this.viewpoint.viewer.SCREEN_HEIGHT/this.aspectRatio;this.imageScaleUp=this.DEFAULT_FOV/i;this.vFreedomOfMovement=1-(1/this.imageScaleUp);this.hFreedomOfMovement=1-(1/this.imageScaleUp*h);if(this.hFreedomOfMovement<0){this.hFreedomOfMovement=0}this.v=this.vFreedomOfMovement*this.DISTANCE;this.h=this.hFreedomOfMovement*this.DISTANCE*this.aspectRatio;this.render()}},moveCameraBy:function(j,i){var k=209/this.imageScaleUp/this.viewpoint.viewer.SCREEN_HEIGHT;var m=this.viewpoint.getCameraTarget();var n=m.y+k*j;var l=m.z+k*i;this.moveCameraTo(n,l)},moveCameraTo:function(l,k){var q=l;var h=this.h;if(q>h){q=h}else{if(q<-h){q=-h}}var p=k;var j=this.v;if(p>j){p=j}else{if(p<-j){p=-j}}var o=this.DISTANCE/Math.tan(this.DEFAULT_FOV*Math.PI/360);var m=new d.Vector3(0,q,p);var i=new d.Vector3(-o,q,p);var n=new d.Vector3().subVectors(m,i);this.viewpoint.moveTo({eyePosition:i,upDirection:new d.Vector3(0,0,1),sightDirection:n,distanceToTarget:n.length(),duration:0});this.render()},render:function(){this.viewer.render()}});return g});define("DS/XCT25DExperience/XCTJSONReader",["UWA/Class"],function(a){var b=a.extend({init:function(){this._parent()},load:function(c,e){var d=new XMLHttpRequest();d.onreadystatechange=function(){if(d.readyState===4&&d.status===200){var f=JSON.parse(d.responseText);e(f)}};d.open("GET",c,true);d.send()}});return b});define("DS/XCT25DExperience/XCTXHRWithProxyAbstraction",["UWA/Core","UWA/Data"],function(b){var a=function(){var c=function(f,g,e){var d=f.indexOf("/");var i=f.indexOf("/",d+2);var h=f.slice(0,d)+"//"+g+":"+e+f.slice(i,f.length);return h};this.executePostHttpRequest2=function(d,i,h,j,k){if(a.proxyUsage===2){console.log("gestion UWA");var e={timeout:100000,method:"POST",data:h,type:"text",headers:{"Content-Type":i,Accept:"application/json"},onComplete:j,onFailure:function(){b.log("arguments onFailure");b.log(arguments)}};if(k.responseType!==null){e.type=k.responseType}if(a.proxymode){e.proxy=a.proxymode}var f=b.Data.request(d,e);this.myRequest=f}else{if(a.proxyUsage===1){d=c(d,a.server,a.sport)}var l=new XMLHttpRequest();l.open("POST",d,true);l.onload=function(){j(this.response)};var g=new FormData();g.append("data",h);l.setRequestHeader("Content-type",i);l.setRequestHeader("Accept","text/plain");if(k.responseType!==null){l.responseType=k.responseType}l.send(h)}};this.executeSyncPostHttpRequest=function(f,j,i){if(a.proxyUsage===2){console.log("gestion UWA");var d;var e={timeout:100000,method:"POST",data:i,type:"text",async:false,headers:{"Content-type":j,Accept:"text/plain"},onComplete:function(k){console.warn("retour >data",k);d=k},onFailure:function(){console.log("arguments onFailure");console.log(arguments)}};if(a.proxymode){e.proxy=a.proxymode}var g=b.Data.request(f,e);this.myRequest=g;return d}else{if(a.proxyUsage===1){f=c(f,a.server,a.sport)}var h=new XMLHttpRequest();h.open("POST",f,false);h.setRequestHeader("Content-type",j);h.setRequestHeader("Accept","text/plain");h.send(i);return h.responseText}};this.transformUrlIntoRealUrl=function(d){if(a.proxyUsage===2){console.log("gestion UWA");return b.Data.proxifyUrl(d,{proxy:"passport"})}else{if(a.proxyUsage===1){d=c(d,a.server,a.sport);return d}}return d};this.syncTransformFCSUrlIntoRealUrl=function(e,f){var g=e.indexOf("v23");var p=e.slice(3,g);var i=e.slice(g+3,e.length);var m="application/xml";if(typeof(f)==="boolean"&&f){m="application/xmql"}var j=this.executeSyncPostHttpRequest(p,m,i);var n=/\{\{([^}]*)\}\{([^}]*)\}\}/;var o=n.exec(j);var d=o[1];var l=o[2];var h=l;var k="posthttp:"+h+":postparams:__fcs__jobTicket="+encodeURIComponent(d);return k}};a.useNoProxy=function(){a.proxyUsage=0;a.server=null;a.sport=null};a.useProxyDefinedBy=function(d,c){a.proxyUsage=1;a.server=d;a.sport=c};a.useUWAProxy=function(c){a.proxyUsage=2;a.server=null;a.sport=null;a.proxymode=c};return a});define("DS/XCT25DExperience/XCT25DExperience",[],function(){});define("DS/XCT25DExperience/XCTSequencePlayer",["UWA/Class","DS/XCT25DExperience/XCTSequenceModel","DS/XCT25DExperience/XCTSequenceLoader","DS/XCT25DExperience/XCTSequenceSceneManager","WebappsUtils/WebappsUtils"],function(a,d,f,e,c){var b=a.extend({init:function(g){this.stateLoaded=this.stateLoaded.bind(this);this.setupControl=this.setupControl.bind(this);this.frameWindow=g.frameWindow;this.frameWindow.experience.player=this;this.loader=g.loader||new f();this.loader.setOnStateLoadedCallback(this.stateLoaded);this.sceneManager=g.sceneManager||new e({frameWindow:this.frameWindow});this.viewpoint=this.frameWindow.getViewpoint();this.setupControl(this.viewpoint.getControl());this.loadingQueue=[];this.chunkSize=5},buildSequence:function(o,l){this.loadingQueue=[];this.loadedStatesMap={};this.k=0;this.h=0;this.zoom=0;this.sequence=new d();this.sequence.spec=o;this.sequence.root=l.root+(l.root.slice(-1)!=="/"?"/":"");this.sequence.meta=l.meta;this.sceneManager.createRootNode();this.sceneManager.aspectRatio=this.sequence.meta.stillResolution.width/this.sequence.meta.stillResolution.height;var j=this.asset=l.asset;var m={};var i={};this.eventIndexes=[];if(j.events){for(var n=0;n<j.events.length;n++){var g=j.events[n];if(g.constructor===Array){var k=g[1];m[k]=n}else{i[g]=n;this.eventIndexes[n]=n}}}this.sequence.events=i;this.sequence.variants=m;this.sequence.transitions=j.transitions;this.sequence.totalStates=(j.transitions)?j.transitions.length:1;this.sequence.totalLoaded=0;this.loader.imagePrefix=c.getWebappsBaseUrl()+"XCT25DWidget/demos/"+this.sequence.root;this.loader.currentSequenceUuid=this.sequence.uuid;this.sceneManager.resetViewpoint();this.moveToFirstState(this.loadedStatesMap);this.processLoadingQueue();for(var h=0;h<this.sequence.totalStates;h++){this.loadStates(h,this.loadedStatesMap)}this.processLoadingQueue()},moveToFirstState:function(g){this.loadInitialState(0,g);this.moveToNewState(0)},moveToNewState:function(g){this.currentIndex=g;if(this.sequence.states[g]!==undefined){this.sceneManager.showState(this.sequence.states[g])}},loadInitialState:function(j,g){var l={};this.buildStatesToLoadMap(j,2,this.sequence.transitions,g,l);for(var i in l){if(l.hasOwnProperty(i)){var h=Number(i);var k=this.buildState(h,this.asset.states[h]);this.loadingQueue.push({state:k,loaded:false})}}},loadStates:function(h,g){if(g[h]===undefined){var i=this.buildState(h,this.asset.states[h]);this.loadingQueue.push({state:i,loaded:false});g[h]=true}},processLoadingQueue:function(){if(this.loadingQueue.length===0){return}this.currentChunk=this.loadingQueue.splice(0,this.chunkSize);for(var g=0;g<this.currentChunk.length;g++){if(!this.currentChunk[g].loaded){this.loader.loadState(this.sequence,this.currentChunk[g].state);this.currentChunk[g].loaded=true}}},stateLoaded:function(h){var g=h.state;g.loaded=true;this.sequence.states[g.index]=g;this.sequence.totalLoaded++;if(g.index===this.currentIndex){this.sceneManager.showState(g)}this.currentChunk.splice(0,1);if(this.currentChunk.length===0){this.processLoadingQueue()}},buildState:function(h,g){var i={index:h,images:g,materialArray:[],mode:(g.length===6)?this.sceneManager.MODE_SKYBOX:this.sceneManager.MODE_IMAGE,total:0};return i},buildStatesToLoadMap:function(k,j,i,g,l){if(g[k]===undefined){l[k]=true;g[k]=true}if(i===undefined){return}var m=i[k];for(var h in m){if((j>0)&&(this.eventIndexes.indexOf(Number(h))!==-1)){this.buildStatesToLoadMap(m[h],j-1,i,g,l)}}},switchVariant:function(i){var k=this.sequence;var j=k.transitions[this.currentIndex];if(j){var h;var g=k.variants[i];if(g!==undefined){h=j[g];if(h!==undefined&&this.sequence.states[h]!==undefined){this.moveToNewState(h,this.loadedStatesMap)}}}},setupControl:function(h){var g=this;if(!window._rotateLockWorldUpVector){window._rotateLockWorldUpVector=h._rotateLockWorldUpVector}h._rotate=function(){};h._rotateLockZ=function(j,m){var o=g.sequence;if(g.sceneManager.mode===g.sceneManager.MODE_IMAGE){if(o&&o.transitions!==undefined){if(g.zoom>1){g.sceneManager.moveCameraBy(j,m)}else{g.k+=j;g.h+=m;var n=o.transitions[g.currentIndex];if(n){var l;var i;if(g.k<0){i=o.events.left}else{if(g.k>=20){i=o.events.right}}if(g.h<0){i=o.events.up}else{if(g.h>=20){i=o.events.down}}if(i!==undefined){l=n[i];if(l!==undefined&&g.sequence.states[l]!==undefined){g.moveToNewState(l,g.loadedStatesMap)}}}g.h=(20+g.h)%20;g.k=(20+g.k)%20}}else{g._rotateLockZ.call(this,j,m)}}else{g._rotateLockZ.call(this,-j,-m)}};h._pan=function(){};h._zoom=function(){};h._zoomSimple=function(k,i){if(i){g.zoom++}else{g.zoom--}if(g.zoom<1){g.zoom=1}if(g.zoom>20){g.zoom=20}var j=10;var l=45+j*(1-Math.sqrt(g.zoom));g.sceneManager.setFOV(l)}}});return b});define("DS/XCT25DExperience/XCTModelLoader",["DS/Visualization/ModelLoader","DS/XCT25DExperience/XCTJSONReader","DS/XCT25DExperience/XCTSequencePlayer","DS/XCT25DExperience/XCTSequenceLoader","DS/XCT25DExperience/XCTXHRWithProxyAbstraction","WebappsUtils/WebappsUtils","DS/XCT25DExperience/XCT25DConfig","DS/WAFData/WAFData"],function(a,d,i,h,e,b,c,f){var g=a.extend({init:function(m,j,l){this.frmWindow=m;this._parent(j,l);var k=this;if(!this.descriptorTicket){this.descriptorTicket={fcsurl:"",ticket:""}}this.onModelLoadingCompleted=function(){k.frmWindow.experience.progress.hide();var n=k.player.sceneManager.mode;var o=k.frmWindow.getViewpoint();if(n===k.player.sceneManager.MODE_SKYBOX||n===k.player.sceneManager.MODE_IMAGE){o.setControlActive({viewpoint:o,picking:false})}else{o.setControlActive({viewpoint:o,picking:true})}o.viewer.render()};this.onModelLoadingProgression=function(n){if(n.loaded!==undefined&&n.total!==undefined&&n.total!==0){k.frmWindow.experience.progress.updateProgression(Math.round(n.loaded*100/n.total));WUX.Events.publish({event:"ASSET/LOADINGPROGRESS",data:{model:k.modelName,progress:n,ctx:k.ctx}})}};this.onModelLoadingError=function(){};this.cachedIds=[]},initializePlayer:function(){if(this.player){return}this.player=new i({frameWindow:this.frmWindow});this.player.loader.setOnProgressCallback(this.onModelLoadingProgression);this.player.loader.setOnLoadedCallback(this.onModelLoadingCompleted);this.player.loader.setOnErrorCallback(this.onModelLoadingError)},loadModel:function(o,k,p){var n=this,m=null,j=(k!==undefined)?k:n.targetNode;if(j===null){return}p=p!==undefined?p:false;if(!p){this.spec=m=this.buildPath(o);this.modelName=m.serverurl?m.serverurl:"";this.modelName+=m.filename?m.filename:"";this.setFileTypeFromSpec(m)}setTimeout(this.onModelLoadingProgression,10,{loaded:0,total:100});this.initializePlayer();if(this.fileType==="Ox4MQLV6"&&m.dtype===c.MEDIA_TYPE){this._retreiveStreamInfo(m,function(q,r){if(r){n._parseStreamDescriptors(r,function(){n._loadJSON(q,function s(t){if(t){q.from3DSpace=n.cachedIds.indexOf(q.physicalid)<0;n._setupViewer(q,t)}})})}else{}},null)}else{if(this.fileType==="json"){if(p){return}if(this.jsonLoader===null){this.jsonLoader=new d()}this.jsonLoader.load(this.modelName,function l(q){m.from3DSpace=false;n._setupViewer(m,q)},null,this.onLoadedCB)}else{o.dtype="VPMReference";a.prototype.loadModel.apply(this,arguments)}}},_parseStreamDescriptors:function(l,n){this.files=l;var m=this.filesMap={};for(var k=0;k<l.length;k++){var j=l[k].persistencyname;m[j]=l[k]}n(l)},_loadJSON:function(k,m){var j=this;var l=this.filesMap["25D_asset.json"];if(!l){l=this.filesMap["25D_asset.json.json"]}if(!l){l=this.filesMap["25D_asset"]}if(!l){l=this.filesMap["sequence.json"]}if(!l){l=this.filesMap["sequence.json.jpeg"]}if(!l){l=this.filesMap["sequence.json.jpg"]}if(!l){l=this.filesMap.sequence}if(l){this._streamDescriptorToTicket(k.physicalid,l,function(n){j._retrieveStreamContent(n,function(o){m(JSON.parse(o))})})}else{m()}},_streamDescriptorToTicket:function(k,o,j,l){var m=this.serverUrl+"/resources/experience/medias/"+k+"/streams/"+o.persistencyname;var n=this.descriptorTicket.fcsurl+"?__fcs__jobTicket="+encodeURIComponent(this.descriptorTicket.ticket)+"&jobTicket=__fcs__jobTicket&__fcs__attachment=true";f.authenticatedRequest(m,{method:"GET",type:"json",cache:-1,headers:{"Content-Type":"application/json",SecurityContext:this.securityContext},onComplete:function(p){if((j!==undefined)&&(null!==j)){j(p.results[0],n)}},onFailure:function(p){if((l!==undefined)&&(null!==l)){l(p)}}})},_retrieveStreamContent:function(k,l){var j={timeout:100000,method:"GET",data:"__fcs__jobTicket="+encodeURIComponent(k.ticket),type:"application/octet-stream",headers:{Accept:"application/octet-stream"},onComplete:function(m){l(m)},onFailure:function(m){l(m)}};j.proxy="passport";f.authenticatedRequest(k.fcsurl,j)},_retrieveStreamImage:function(n,j,k){var m="__fcs__jobTicket="+encodeURIComponent(n.ticket);var l={timeout:100000,method:"GET",data:m,type:"arraybuffer",headers:{Accept:"text/plain"},onComplete:function(o){j(o)},onFailure:function(o){if((k!==undefined)&&(null!==k)){k(o)}}};l.proxy="passport";f.authenticatedRequest(n.fcsurl,l)},_setupViewer:function(k,m){var j=this;var l=j.frmWindow.getViewer||j.frmWindow.getViewerFrame;l=l.bind(j.frmWindow);var n=l();n.displayInfinitePlane(false);n.setGrid(false);n.setMirror(false);n.setShadow(false);n.setSSAO(false);if(k.from3DSpace){this.player.loader.setMakeFilePathsCallback(function(o,p){j._makeFilePaths(o,k.physicalid,p)})}else{this.player.loader.resetMakeFilePathsCallback()}this.player.buildSequence(k,m);WUX.Events.publish({event:"ASSET/LOADINGSTARTED",data:{model:j.modelName,ctx:j.ctx}})},_makeFilePaths:function(r,p,s){var t=this;var u=[];var k=[];var o=r.length;var m=function(y,x){o--;var v=y.filename;var w=k.indexOf(v);u[w]=x;if(o===0){setTimeout(s,10,u)}};for(var n=0;n<r.length;n++){var l=r[n];if(l.constructor===Array){l=l[0]}var j=l;k.push(j);var q={persistencyname:l};if(q){this._streamDescriptorToTicket(p,q,function(v){t._retrieveStreamImage(v,function(w){m(v,w)})})}}},_retreiveStreamInfo:function(l,j,k){this.securityContext=l.contextid;this.serverUrl=l.serverurl;this.phisicalId=l.physicalid;var m=this.serverUrl+"/resources/experience/medias/"+this.phisicalId+"/streams/";f.authenticatedRequest(m,{method:"GET",type:"json",headers:{"Content-Type":"application/json",SecurityContext:this.securityContext},onComplete:function(n){if((j!==undefined)&&(null!==j)){j(l,n.results)}},onFailure:function(n){if((k!==undefined)&&(null!==k)){k(n)}}})},loadCachedModels:function(){var k=this;var j=new d();j.load(b.getWebappsBaseUrl()+"XCT25DWidget/demos/cached.json",function(l){k.cachedIds=l})}});return g});define("DS/XCT25DExperience/XCTFileLoader",["DS/Visualization/ModelLoader","UWA/Class/Promise","DS/ZipJS/zip","DS/XCT25DExperience/XCTSequencePlayer","DS/XCT25DExperience/XCT25DPlatformHelpers"],function(c,g,e,a,d){const f=32;const b="0123456789ABCDEF";return c.extend({init:function(h){const i=this;this.specs={contextid:"",dtype:"MediaVideo3DExp",from3DSpace:false,physicalid:this._getRandomString(),type:"MediaVideo3DExp"};this.frmWindow=h;this.loadedBlob=null;this.modelName="Unknown";this._parent();this.onModelLoadingCompleted=function(){const j=i.sequencePlayer.sceneManager.mode;const k=i.frmWindow.getViewpoint();if(j===i.sequencePlayer.sceneManager.MODE_SKYBOX||j===i.sequencePlayer.sceneManager.MODE_IMAGE){k.setControlActive({viewpoint:k,picking:false})}else{k.setControlActive({viewpoint:k,picking:true})}k.viewer.render()};this.onModelLoadingProgression=function(j){if(j.loaded!==undefined&&j.total!==undefined&&j.total!==0){WUX.Events.publish({event:"ASSET/LOADINGPROGRESS",data:{model:i.modelName,progress:j,ctx:i.ctx}})}};this.onModelLoadingError=function(){};this.cachedIds=[]},initializeSequencePlayer:function(){if(this.sequencePlayer){return}this.sequencePlayer=new a({frameWindow:this.frmWindow});this.sequencePlayer.loader.setOnProgressCallback(this.onModelLoadingProgression);this.sequencePlayer.loader.setOnLoadedCallback(this.onModelLoadingCompleted);this.sequencePlayer.loader.setOnErrorCallback(this.onModelLoadingError)},loadModel:function(i){const h=this;var j;if(i.type==="application/octet-stream"){j=new g.resolve(i)}else{this.specs=this.buildPath(i);j=d.getStreamsPromise(i)}this.initializeSequencePlayer();j.then(function(k){return h._createZipReaderPromise(k)}).then(function(k){return h._parseFileNames(k)}).then(function(k){return h._getJsonPromise(k)}).then(function(k){h._setupViewer(h.specs,JSON.parse(k))})},_createZipReaderPromise:function(h){return new g(function(j,i){e.createReader(new e.BlobReader(h),function(k){k.getEntries(function(l){j(l)})},function(k){i(k)})})},_parseFileNames:function(k){const l=this.filesMap={};for(var j=0;j<k.length;j++){var h=k[j].filename;l[h]=k[j]}return this.filesMap},_getJsonPromise:function(i){var h=i["25D_asset.json"];if(!h){h=i["25D_asset.json.json"]}if(!h){h=i["25D_asset"]}if(!h){h=i["sequence.json"]}if(!h){h=i["sequence.json.jpeg"]}if(!h){h=i["sequence.json.jpg"]}return new g(function(j){h.getData(new e.TextWriter(),function(l){const k=l.currentTarget.result;j(k,i)})})},_setupViewer:function(i,k){const h=this;var j=h.frmWindow.getViewer||h.frmWindow.getViewerFrame;j=j.bind(h.frmWindow);const l=j();l.displayInfinitePlane(false);l.setGrid(false);l.setMirror(false);l.setShadow(false);l.setSSAO(false);this.sequencePlayer.loader.setMakeFilePathsCallback(function(m,n){h._makeFilePaths(m,i.physicalid,n)});this.sequencePlayer.buildSequence(i,k);WUX.Events.publish({event:"ASSET/LOADINGSTARTED",data:{model:h.modelName,ctx:h.ctx}})},_makeFilePaths:function(p,o,q){const r=this;var s=[];var j=[];var m=p.length;const n=function(u){const v=u[0];const t=u[1];m--;var i=j.indexOf(v);s[i]=t;if(m===0){setTimeout(q,10,s)}};for(var l=0;l<p.length;l++){var k=p[l];if(k.constructor===Array){k=k[0]}var h=k;j.push(h);r._getArrayBufferPromise(k).then(n)}},_getRandomString:function(){var h="";for(var j=f;j>0;--j){h+=b[Math.floor(Math.random()*b.length)]}return h},_getArrayBufferPromise:function(i){const h=this;return new g(function(j){h.filesMap[i].getData(new e.BlobWriter(),function(l){var k=new FileReader();k.onload=function(m){j([i,m.target.result])};k.onerror=function(){};k.readAsArrayBuffer(l)})})}})});define("DS/XCT25DExperience/XCT25DPlayApp",["UWA/Core","DS/WebSystem/Environment","DS/XCT25DExperience/XCTModelLoader","DS/XCT25DExperience/XCTFileLoader"],function(e,c,b,a){var d=e.Class.extend({init:function(g,h,f){var i=g.frmWindow.actionBarToken;g.frmWindow.loadActionBar({workbenchModule:"XCT25DExperience",workbench:"XCT25DWebApp.xml"});if(i){g.frmWindow.getActionBar().removeCallback(i)}g.frmWindow.actionBarToken=g.frmWindow.onActionBarReady(function(){const j=h.blob||f?new a(g.frmWindow,{node:c.isSet("3DPlay.pad3DViewer")?g.getRootBag():null,viewer:g.frmWindow.getViewer()}):new b(g.frmWindow,{node:c.isSet("3DPlay.pad3DViewer")?g.getRootBag():null,viewer:g.frmWindow.getViewer()});j.targetNode=g.modelLoader.targetNode?g.modelLoader.targetNode:g.modelLoader.glContext.node;if(h.onModelLoadingProgression){h.onModelLoadingProgression({loaded:70,total:100})}if(f||h.blob){if(f){j.loadModel(h.asset)}else{j.loadModel(h.blob)}}else{j.loadModel(h.asset)}if(h.onModelLoadingCompleted){h.onModelLoadingCompleted()}})}});return d});define("DS/XCT25DExperience/XCTFrameWindow3D",["UWA/Core","DS/ApplicationFrame/FrameWindow3D","DS/XCT25DExperience/XCTModelLoader","DS/Visualization/WebGLV6Viewer","DS/Visualization/SceneGraph","DS/Visualization/Viewpoint","DS/Visualization/SceneGraphTree","DS/ApplicationFrame/CommandsManager"],function(d,e,h,j,a,f,g,i){var b="EVT_VIEWER_LOADED";var c="EVT_VIEWER_MODEL_LOADED";var k=e.extend({init:function(l){l=l||{};this._parent(l)},load3dViewer:function(m){var l=this;l._3dViewer=new j(m);l.init3dViewer()},init3dViewer:function(){var o=this;o._3dViewer.setRenderMode("@Edge",false);o._3dViewer.setPicking({activated:true,displayHL:true,gpu:true,computeNormalDepth:true,primitive:false});o._3dViewer.setPrePicking({activated:false,displayHL:true,gpu:true,computeNormalDepth:false,primitive:false});if(!window.undoSceneGraphMigration){o._private_sceneGraph=o._3dViewer.getRootNode()}else{o._private_sceneGraph=new a("I solemnly swear that I am up to no good.");o._3dViewer.attachScene(o._private_sceneGraph)}o._viewpoint=new f({viewer:o._3dViewer});o._viewpoint.onMove(o._3dViewer.render);o._3dViewer.addViewpoint(o._viewpoint);o._3dViewer.setVisuEnv("None");o._modelLoader=new h(this);o._modelLoader.setSceneGraph(o._private_sceneGraph);o._modelLoader.setRenderCallback(o._3dViewer.render);o._modelLoader.setOnLoadedCallback(function(){if(!o.options.onModelLoaded){o._viewpoint.reframe()}else{o.options.onModelLoaded.call(o)}o._modelEvents.publish({event:c,data:o})});o._sceneGraphTree=new g(d.extendElement(o._3dViewer.div),o._3dViewer);o._sceneGraphTree.setSceneGraph(o._private_sceneGraph);if(o.options.uiOptions.displayTree){o._sceneGraphTree.tree.show()}else{o._sceneGraphTree.tree.hide()}var m=0;var p=0;if(o.options.uiOptions&&o.options.uiOptions.displayActionBar){m=81;p=m-32}o.elements.layerSet.addLayer(o._sceneGraphTree.tree.getContent(),{height:"auto",position:"absolute",left:0,top:0,bottom:p});o._sceneGraphTree.tree.getContent().setStyles({height:"auto",position:"absolute",left:0,top:0,bottom:81});o._3dViewer.inject(o.elements.viewerFrame);var n="Visu"+o._3dViewer.getVisuEnv()+"Env";var l={VisuNoEnv:"light",VisuNoneEnv:"light",VisuV6Env:"light",VisuCleanSpaceEnv:"light",VisuDarkBlueEnv:"dark",VisuDarkGreyEnv:"dark",VisuShinyEnv:"dark"};o.elements.container.addClassName("wux-ui-ambiance-"+l[n]);i.onCommandStart(function(q){if(l[q._id]){o.elements.container.removeClassName("wux-ui-ambiance-light");o.elements.container.removeClassName("wux-ui-ambiance-dark");o.elements.container.addClassName("wux-ui-ambiance-"+l[q._id])}});o._modelEvents.publish({event:b,context:o})}});return k});define("DS/XCT25DExperience/XCT25DExperiencePlayer",["DS/3DPlayExperienceModule/PlayExperience3D","DS/3DPlay/3DPlayScenarioManager","UWA/Core","WebappsUtils/WebappsUtils","DS/RuntimeView/RSCManager","DS/RuntimeView/NLSManager","DS/XCT25DExperience/XCTFrameWindow3D","DS/WebSystem/Environment","DS/XCT25DExperience/XCTModelLoader"],function(e,c,f,d,g,j,i,h,a){var b=e.extend({init:function(k){k=k||{};k.commandApplication=false;k.workbenchs=[];k.workbenchs.unshift({name:"XCT25DExperience",module:"XCT25DExperience"});if(!k.input&&this.args.input){k.input=this.args.input}this._parent(k);this.args.FrameWindow=i},loadScenario:function(){var k=d.getWebappsAssetUrl("XCT25DExperience","ScenarioList.json");c.loadScenarios(k,this)},dispose:function(){},preCreate:function(){e.prototype.preCreate.apply(this,arguments)},onPreCreate:function(){var l={visu:{antiAliasing:false,backgroundColor:16711680,useShadowMap:false,defaultAnimationLoop:false,displayLines:false,autoUpdateFrustum:true,picking:false,displayPicking:false,prePicking:false,displayprePicking:false,displayHighlight:false,highlight:false,pHighlight:false,useVignetting:false,defaultLights:true}};this.args=f.extend(l,this.args,true);var k=this;this.args.ui={keepActionbarClosed:true,onActionBarReady:function(){var m=k.frmWindow.getActionBar();m.close()}}},onPostCreate:function(){this.autoReframe=false;var k=h.isSet("3DPlay.pad3DViewer")?this.getRootBag():null;this.modelLoader=new a(this.frmWindow,{node:k,viewer:this.frmWindow.getViewer()})}});return b});