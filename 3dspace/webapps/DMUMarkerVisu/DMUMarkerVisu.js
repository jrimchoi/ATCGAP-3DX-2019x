define("DS/DMUMarkerVisu/DMUMkvShapeNode",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/CanvasNodeTexture","DS/SceneGraphNodes/CanvasNode","DS/DMUBaseExperience/EXPUtils","DS/DMUControls/DMUHTMLBox","DS/VisuEvents/EventsManager","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseExperience/EXPToolsVisualization"],function(g,i,m,k,c,n,e,a,h,l,d,j,f){var b=i.extend({init:function(F){this._parent();var J=F.window,y=J.getViewer();var L=this;var H;var N;var M,o;var D=g.createElement("canvas");D.width=1000;D.height=300;var E=g.createElement("canvas");var s=g.createElement("canvas");var B,w;var v={};var t;var q,x=0;var I=new Image();var u={anchorMode:"center",isFilled:true,hasBorder:false,graphicProperties:{padding:5,borderRadius:8,horizontalAlignement:"center",fontStyle:{height:12,familyName:"sans-serif",familyStyle:"normal",color:new m.Color(0)},fillStyle:{color:new m.Color(16777215),opacity:1},lineStyle:{thickness:1,pattern:"1",color:new m.Color(4013373)}},isHighlighted:false};if(F.data){u=g.extend(u,F.data,true)}function P(T,U,V,S){var Q;u.canvasNodeTexture=new e({width:T,height:U,webGLV6Viewer:y,drawCB:V,rectangleTexture:true,materialParams:{depthTest:false}});var R;if(q||x){switch(u.anchorMode){case"topleft":R=new m.Vector3(-S/2,-U+S/2,0);break;case"center":R=new m.Vector3(-T/2,-U/2,0);break}Q=new a({bottomLeftcorner:R,widthVector:new m.Vector3(T,0,0),heightVector:new m.Vector3(0,U,0),canvasNodeTexture:u.canvasNodeTexture},k)}else{switch(u.anchorMode){case"topleft":R=new m.Vector2(S/2,U-S/2);break;case"center":R=new m.Vector2(T/2,U/2);break}Q=k.createCanvas2DNode({hotspot:R,canvasNodeTexture:u.canvasNodeTexture})}Q.rectangle.setRenderDepth(10);Q.rectangle.excludeFromHighlight(true,true);return Q}function p(Q,V){var U=Q.getImageData(0,0,D.width,D.height).data,W=false,T=false,S=D.height,X=0,R=0;while(!T&&S){S--;for(X=0;X<V;X++){if(U[S*D.width*4+X*4+3]){T=S;break}}}S=-1;while(S<D.height&&!W){S++;for(X=0;X<V;X++){if(U[S*D.width*4+X*4+3]){W=S;break}}if(W&&T){R=T-W}}return R}function O(){v={};var U=null,Z;if(u.mkvShape){U=u.mkvShape.getMarkUpGrid()}if(U){v.height=0;v.width=0;for(var W=0;W<U.getNbofRows();W++){v.height+=U.getRowHt(W)}if(isNaN(v.height)){v.height=1}for(var V=0;V<U.getNbofColumns();V++){v.width+=U.getColWd(V)}if(isNaN(v.width)){v.width=1}}else{if(u.content&&u.content.length){var Y=u.graphicProperties.fontStyle.familyStyle?u.graphicProperties.fontStyle.familyStyle+" ":"";Y+=u.graphicProperties.fontStyle.height*window.devicePixelRatio+"px ";Y+=u.graphicProperties.fontStyle.familyName;v.fontHeight=0;v.width=0;v.fontHeightComment=0;var ab=D.getContext("2d");ab.font=Y;var R="";var T=0;for(Z=0;Z<u.content.length;Z++){R=u.content[Z]?u.content[Z]:"aA_{}";ab.clearRect(0,0,D.width,D.height);ab.fillText(R,0,D.height);var X=ab.measureText(R).width;v.width=Math.max(X,v.width);v.fontHeight=Math.max(p(ab,X),v.fontHeight)}if(u.commentContent&&u.commentContent.length){T=u.commentContent.length;var Q=u.graphicProperties.fontStyleComment.familyStyle?u.graphicProperties.fontStyleComment.familyStyle+" ":"";var aa=u.graphicProperties.fontStyleComment.familyName?u.graphicProperties.fontStyleComment.familyName:"sans-serif";ab.font=Q+u.graphicProperties.fontStyleComment.height*window.devicePixelRatio+"px "+aa;for(Z=0;Z<u.commentContent.length;Z++){R=u.commentContent[Z]?u.commentContent[Z]:"aA_{}";ab.clearRect(0,0,D.width,D.height);ab.fillText(R,0,D.height);var S=ab.measureText(R).width;v.width=Math.max(S,v.width);v.fontHeightComment=Math.max(p(ab,S),v.fontHeightComment)}}v.paddingY=Math.floor(0.5*v.fontHeight);v.paddingYComment=Math.floor(0.5*v.fontHeightComment);v.paddingBorder=Math.max(v.paddingY,v.paddingYComment);v.width+=2*v.paddingBorder;v.height=(v.fontHeight+2*v.paddingY)*u.content.length-v.paddingY;if(T){v.height+=(v.fontHeightComment+2*v.paddingYComment)*T-v.paddingYComment}else{v.height-=v.paddingY}v.height+=2*v.paddingBorder;if(isNaN(v.width)){v.width=1}}}v.width+=2*u.graphicProperties.padding;v.height+=2*u.graphicProperties.padding;v.widthInMM=f.convertPixelToModel({sizeInPixels:v.width,viewer:y});v.heightInMM=f.convertPixelToModel({sizeInPixels:v.height,viewer:y});v.width=Math.round(v.width);v.height=Math.round(v.height);v.widthInMM=Math.round(v.widthInMM);v.heightInMM=Math.round(v.heightInMM)}function A(U,S,R,V,T){var Q=u.graphicProperties.borderRadius;U.beginPath();U.moveTo(S+Q,R);U.lineTo(S+V-Q,R);U.arc(S+V-Q,R+Q,Q,1.5*Math.PI,2*Math.PI);U.lineTo(S+V,R+T-Q);U.arc(S+V-Q,R+T-Q,Q,0,0.5*Math.PI);U.lineTo(S+Q,R+T);U.arc(S+Q,R+T-Q,Q,0.5*Math.PI,Math.PI);U.lineTo(S,R+Q);U.arc(S+Q,R+Q,Q,Math.PI,1.5*Math.PI);U.closePath()}function r(S,X,Q,W,T,V,R,U){S.save();S.translate(Q+T/2,W+V/2);S.scale(R?-1:1,U?-1:1);S.drawImage(X,-T/2,-V/2,T,V);S.restore()}function G(al,V,T,af){var ax,av,au,S,W;V.scale(1/af,1/af);var ao=V.canvas.width/(q?f.convertModelToPixels({sizeInMM:v.widthInMM+t,viewer:y}):(v.width+t));var Q=ao*(v.width),R=ao*(v.height);var ap=(V.canvas.width-Q)/2,am=(V.canvas.height-R)/2;if(u.isFilled){if(u.graphicProperties.fillStyle.gradient){var aq;if(u.graphicProperties.fillStyle.gradient.type==="leftToRight"){aq=V.createLinearGradient(ap,am,V.canvas.width-ap,am)}else{if(u.graphicProperties.fillStyle.gradient.type==="topToBottom"){aq=V.createLinearGradient(ap,am,ap,V.canvas.height)}else{if(u.graphicProperties.fillStyle.gradient.type==="topLeftToBottomRight"){aq=V.createLinearGradient(ap,am,V.canvas.width-ap,V.canvas.height)}else{if(u.graphicProperties.fillStyle.gradient.type==="bottomLeftToTopRight"){aq=V.createLinearGradient(ap,V.canvas.height,V.canvas.width-ap,am)}}}}var ad=Object.keys(u.graphicProperties.fillStyle.gradient.specs);for(var ah=0;ah<ad.length;ah++){aq.addColorStop(parseFloat(ad[ah]),u.graphicProperties.fillStyle.gradient.specs[ad[ah]])}V.fillStyle=aq}else{V.fillStyle=h.colorToHex(u.graphicProperties.fillStyle.color);V.globalAlpha=u.graphicProperties.fillStyle.opacity}}else{V.globalAlpha=0}A(V,((V.canvas.width-Q)/2),((V.canvas.height-R)/2),Q,R);V.fill();V.globalAlpha=1;V.fillStyle=h.colorToHex(u.graphicProperties.fontStyle.color);var ag=u.mkvShape?u.mkvShape.getMarkUpGrid():null;var X=function(aB){aB.target.hasBeenLoaded=true;aB.target.removeEventListener("load",X);aB.target.listenToLoadEvt=false;if(u&&u.canvasNodeTexture){u.canvasNodeTexture.requestRedraw();y.render()}};if(ag){for(ax=0;ax<ag.getNbofRows();ax++){for(av=0;av<ag.getNbofColumns();av++){W=ag.getMarkUpCell(ax,av);if(W){var an=W.getCellPos();var aa=W.getCellImageToDisplay();if(!aa){aa=W.getCellImage()}if(aa){var U=ao*W.getCellWd(),at=ao*W.getCellHt();if(ao*ag.getRowHt(ax)<at){at=ao*ag.getRowHt(ax)}if(ao*ag.getColWd(av)<U){U=ao*ag.getColWd(av)}var aA;if(!q&&aa.width&&aa.height&&(aa.width!==U||aa.height!==at)&&(aa.width>300||aa.height>300)){var aj=false;if(U!==aa.width||at!==aa.height){E.width=aa.width;E.height=aa.height;var ab=E.getContext("2d");ab.drawImage(aa,0,0);aj=true}var ai=aa;aa=I;s.width=U;s.height=at;s.getContext("2d").drawImage(aj?E:ai,0,0,s.width,s.height);aA=s.toDataURL("image/png");aa.width=s.width;aa.height=s.height;W.setCellImageToDisplay(aa)}if(!aa.hasBeenLoaded){if(aa.listenToLoadEvt){aa.removeEventListener("load",X);aa.listenToLoadEvt=false}aa.addEventListener("load",X);aa.listenToLoadEvt=true;if(aA){aa.src=aA}}r(V,aa,ap+ao*an.x+(u.graphicProperties.horizontalAlignement==="center"?((V.canvas.width-2*ap)-U)/2:0),am+ao*an.y,U,at,u.imageInvertH,u.imageInvertV)}else{S=W.getCellText();var az=S?S.getTextToDisplay():null;if(az&&az.length){var ar=S.getFontStyle()?S.getFontStyle()+" ":"";var Y=S.getFontName()?S.getFontName():"sans-serif";V.font=ar+ao*S.getFontSize()*window.devicePixelRatio+"px "+Y;var Z=ao*u.graphicProperties.padding;for(au=0;au<az.length;++au){V.fillText(az[au],ap+ao*(u.graphicProperties.padding+W.size.paddingX+an.x),am+Z+ao*(W.size.paddingY+W.size.fontHeight+an.y));Z+=ao*(2*W.size.paddingY+W.size.fontHeight)}}}}}}}else{if(u.content&&u.content.length){var aw=u.graphicProperties.fontStyle.familyStyle?u.graphicProperties.fontStyle.familyStyle+" ":"";var ac=u.graphicProperties.fontStyle.familyName?u.graphicProperties.fontStyle.familyName:"sans-serif";V.font=aw+u.graphicProperties.fontStyle.height*window.devicePixelRatio+"px "+ac;var ae=ao*u.graphicProperties.padding;for(au=0;au<u.content.length;++au){V.fillText(u.content[au],ap+ao*(u.graphicProperties.padding+v.paddingBorder),am+ae+ao*((au===0?v.paddingBorder:v.paddingY)+v.fontHeight));ae+=ao*((au===0?(v.paddingBorder+v.paddingY):(2*v.paddingY))+v.fontHeight)}if(u.commentContent&&u.commentContent.length){var ak=u.graphicProperties.fontStyleComment.familyStyle?u.graphicProperties.fontStyleComment.familyStyle+" ":"";var ay=u.graphicProperties.fontStyleComment.familyName?u.graphicProperties.fontStyleComment.familyName:"sans-serif";V.font=ak+u.graphicProperties.fontStyleComment.height*window.devicePixelRatio+"px "+ay;for(au=0;au<u.commentContent.length;++au){V.fillText(u.commentContent[au],ap+ao*(u.graphicProperties.padding+v.paddingBorder),am+ae+ao*(v.paddingYComment+v.fontHeightComment));ae+=ao*(2*v.paddingYComment+v.fontHeightComment)}}}}if(!u.hasBorder&&u.inEdition){V.strokeStyle="#00C8FF";V.lineWidth=Math.max(u.graphicProperties.lineStyle.thickness,4);V.stroke()}else{if(u.hasBorder){if(!u.inEdition){V.strokeStyle=h.colorToHex(u.graphicProperties.lineStyle.color?u.graphicProperties.lineStyle.color:h.colorToHex(new m.Color(12775156)));V.lineWidth=u.graphicProperties.lineStyle.thickness}else{V.strokeStyle="#00C8FF";V.lineWidth=Math.max(u.graphicProperties.lineStyle.thickness,4)}if(u.graphicProperties.lineStyle.pattern){V.setLineDash(j.getDashPattern(u.graphicProperties.lineStyle.pattern,2))}V.stroke()}}y.render()}function K(U){var V={size:null,style:null,content:null,name:null,lineHeight:null};for(var R=0;R<U.getNbofColumns();R++){for(var Q=0;Q<U.getNbofRows();Q++){var T=U.getMarkUpCell(Q,R);if(T){var S=T.getCellText();if(S){if(!V.size){V.size=S.getFontSize()*window.devicePixelRatio}if(!V.style){V.style=S.getFontStyle()}if(!V.content){V.content=S.getTextContent()}if(!V.name){V.name=S.getFontName()}}if(!V.lineHeight){V.lineHeight=T.size.fontHeight}if(!V.paddingY){V.paddingY=T.size.paddingY}if(!V.paddingX){V.paddingX=T.size.paddingX}}}}return V}function C(Q){var X=function(Z,Y){if(Y!==undefined){return JSON.stringify(Y)===JSON.stringify(Z)}return true};var U=Object.keys(Q);for(var R=0;R<U.length;R++){if(U[R]!=="graphicProperties"&&U[R]!=="breakPoint2D"&&U[R]!=="position"&&U[R]!=="pointingPoints"){if(U[R]==="markerImage"){if(u[U[R]]&&!Q[U[R]]||!u[U[R]]&&Q[U[R]]){return false}if(u[U[R]].src!==Q[U[R]].src||u[U[R]].width!==Q[U[R]].width||u[U[R]].height!==Q[U[R]].height){return false}}else{if(!X(u[U[R]],Q[U[R]])){return false}}}else{if(U[R]==="graphicProperties"){var W=Object.keys(Q[U[R]]);for(var T=0;T<W.length;T++){if(W[T]==="fontStyle"||W[T]==="fillStyle"||W[T]==="lineStyle"){var S=Object.keys(Q[U[R]][W[T]]);for(var V=0;V<S.length;V++){if(!X(u[U[R]][W[T]][S[V]],Q[U[R]][W[T]][S[V]])){return false}}}else{if(!X(u[U[R]][W[T]],Q[U[R]][W[T]])){return false}}}}}}return true}function z(R){var Q=function(Y){if(Y!==null&&Y!==undefined){return Y.clone?Y.clone():Y}return Y};var V=Object.keys(R);for(var S=0;S<V.length;S++){if(V[S]!=="graphicProperties"){u[V[S]]=Q(R[V[S]])}else{var X=Object.keys(R[V[S]]);for(var U=0;U<X.length;U++){if(X[U]==="fontStyle"||X[U]==="fillStyle"||X[U]==="lineStyle"){var T=Object.keys(R[V[S]][X[U]]);for(var W=0;W<T.length;W++){u[V[S]][X[U]][T[W]]=Q(R[V[S]][X[U]][T[W]])}}else{u[V[S]][X[U]]=Q(R[V[S]][X[U]])}}}}}this.modify=function(S){if(S.position){u.position=S.position.clone();L.setMatrix(new m.Matrix4().setPosition(u.position));if(H&&S.position){if(H){H.update({position:S.position})}}}if(!C(S)||!B){var R=false;if(u.markerImage&&!S.markerImage||!u.markerImage&&S.markerImage||u.markerImage&&S.markerImage&&(u.markerImage.src!==S.markerImage.src||u.markerImage.width!==S.markerImage.width||u.markerImage.height!==S.markerImage.height)){R=true}if((typeof S.imageWidth==="number"&&typeof u.imageWidth==="number"&&S.imageWidth!==u.imageWidth)||(typeof S.imageHeight==="number"&&typeof u.imageHeight==="number"&&S.imageHeight!==u.imageHeight)||R||S.imageInvertH!==u.imageInvertH||S.imageInvertV!==u.imageInvertV||x!==u.boxRotationAngle){var Q=u.mkvShape?u.mkvShape.getMarkUpGrid():null;if(Q){for(var T=0;T<Q.getNbofRows();T++){for(var U=0;U<Q.getNbofColumns();U++){if(Q.getMarkUpCell(T,U)){Q.getMarkUpCell(T,U).removeCellImageToDisplay();I.src="";I.width=1;I.height=1;I.hasBeenLoaded=false}}}}}z(S);if(u.mkvShape){u.mkvShape.buildGrid()}O();if((q!==u.zoomMode||x!==u.boxRotationAngle)&&w){L.removeChildren();w=null}if(w){w.removeChildren()}else{q=u.zoomMode;x=u.boxRotationAngle?u.boxRotationAngle:0;if(q){w=new c({type:"Spherical"});L.addChild(w)}else{if(x){var W=new c({type:"Spherical"});L.addChild(W);var V=new n({ratio:1});W.addChild(V);w=new i();V.addChild(w)}else{w=L}}}t=q?3:8;B=P((q?v.widthInMM:v.width)+t,(q?v.heightInMM:v.height)+t,G,t);w.addChild(B);if(x){w.setMatrix(new m.Matrix4().makeRotationAxis(new m.Vector3(0,0,1),x))}}};this.getDimensions=function(){return{offsetWidth:v.widthInMM>0?v.widthInMM:1,offsetHeight:v.heightInMM>0?v.heightInMM:1}};this.startEdition=function(R){L.setVisibility(false);if(H){return}if(!o){o=function(V){if(!H){return}var U=V.force;if(!U){var W=V.from[0].view,T=false;while(W&&!T){if(W.className&&W.className.indexOf("DMUHTMLBox")!==-1){T=true}W=W.parentNode}U=!T}if(U){if(F.onContentModifiedCB){F.onContentModifiedCB({text:H.getText()})}L.stopEdition()}};if(y){y.setPicking({trapSelection:false});if(!M){M=y.onSwapVisibleSpace(function(){o({force:true})})}}d.addEvent(y.canvas,"onLeftMouseDown",o);d.addEvent(y.canvas,"onTouch",o)}H=new l({parentNode:R,window:J,viewer:y,onTextModifiedCB:function(){if(F.onContentModifiedCB){F.onContentModifiedCB({text:H.getText()})}}});var S={size:0,style:"",content:"",name:"sans-serif",lineHeight:"1.3em"};if(u.mkvShape){var Q=u.mkvShape.getMarkUpGrid();if(Q){S=K(Q)}}H.update({bEditable:true,bHasALeader:true,position:u.position.clone(),bIsFilled:u.isFilled,bHasBorder:u.hasBorder,cFontColor:u.graphicProperties.fontStyle.color,sFontName:S.name,iFontSize:(S.size/window.devicePixelRatio)+"px",sFontStyle:S.style,fOpacity:u.graphicProperties.fillStyle.opacity,cFillStyleColor:u.graphicProperties.fillStyle.color,cLineStyleColor:u.graphicProperties.lineStyle.color,fLineStyleThickness:u.graphicProperties.lineStyle.thickness+"px",sLineStylePattern:u.graphicProperties.lineStyle.pattern,sTextContents:S.content,lineHeight:(S.lineHeight+2*S.paddingY)/window.devicePixelRatio+"px",borderRadius:u.graphicProperties.borderRadius/window.devicePixelRatio+"px",padding:u.graphicProperties.padding/window.devicePixelRatio+"px "+(u.graphicProperties.padding+S.paddingX)/window.devicePixelRatio+"px"});N=S.content;H.focusAndSelectText();if(J){J.getContextualUIManager().deactivateContextualBar()}if(F.onStartContentEditionCB){F.onStartContentEditionCB()}y.render()};this.stopEdition=function(){if(!H){return}L.setVisibility(true);var R=H.getText();var Q;for(Q=R.length-1;Q>=0;Q--){if(!R[Q]||(R[Q].length===1&&R[Q].charCodeAt()===10)){R.splice(Q,1)}else{break}}var S=false;for(Q=0;Q<R.length;Q++){if(R[Q].length>1||(R[Q].length===1&&R[Q].charCodeAt()!==10)){S=true;break}}if(!S){R=N}F.onContentModifiedCB({text:R});H.remove();H=null;N=null;y.setPicking({trapSelection:true});if(F.onEndContentEditionCB){F.onEndContentEditionCB()}if(M&&y){y.unsubscribe(M);M=0}if(o){d.removeEvent(y.canvas,"onLeftMouseDown",o);d.removeEvent(y.canvas,"onTouch",o);o=null}if(J){J.getContextualUIManager().activateContextualBar()}};this._cleanNode=function(){L.stopEdition();L=u=H=J=D=w=E=s=o=null}},remove:function(){this._cleanNode()}});return b});define("DS/DMUMarkerVisu/DMUMkvTextAdapter",["UWA/Class"],function(a){var b=a.extend({init:function(){this._stextcontent=null,this._stextToDisplay=null;this._ifontsize=12;this._sfontname="sans-serif";this._sfontstyle="normal"},getTextContent:function(){return this._stextcontent},setTextContent:function(c){this._stextcontent=c},getTextToDisplay:function(){return this._stextToDisplay?this._stextToDisplay:this._stextcontent},setTextToDisplay:function(c){this._stextToDisplay=c},getFontSize:function(){return this._ifontsize},setFontSize:function(c){this._ifontsize=c},getFontStyle:function(){return this._sfontstyle},setFontStyle:function(c){this._sfontstyle=c},getFontName:function(){return this._sfontname},setFontName:function(c){this._sfontname=c}});return b});define("DS/DMUMarkerVisu/DMUMkvTextComp",["DS/DMUMarkerVisu/DMUMkvTextAdapter"],function(b){var a=b.extend({});return a});define("DS/DMUMarkerVisu/DMUMkvCellAdapter",["UWA/Class","DS/DMUMarkerVisu/DMUMkvTextComp"],function(a,b){return a.extend({init:function(){var i=[1,1];var g=null;var c={x:0,y:0};var f=0;var d=0;var h=null;var e=null;this.getCellText=function(){if(!g&&!h){g=new b()}return g};this.getCellImage=function(){return h};this.setCellImage=function(j){if(!h||(j&&j.src!==h.src)){h=j;e=null}};this.getCellImageToDisplay=function(){return e};this.setCellImageToDisplay=function(j){if(!e||(j&&(j.width!==e.width||j.height!==e.height||j.src!==e.src))){e=j}};this.removeCellImageToDisplay=function(){e=null};this.setCellIndex=function(j,k){i[0]=j;i[1]=k};this.getCellIndex=function(){var j={};j.row=i[0];j.col=i[1];return j};this.getCellPos=function(){return c};this.setCellPos=function(j){c=j};this.getCellWd=function(){return f};this.setCellWd=function(j){f=j};this.getCellHt=function(){return d};this.setCellHt=function(j){d=j}}})});define("DS/DMUMarkerVisu/DMUMkvCellComp",["DS/DMUMarkerVisu/DMUMkvCellAdapter"],function(b){var a=b.extend({});return a});define("DS/DMUMarkerVisu/DMUMkvGridAdapter",["UWA/Core","UWA/Class","DS/DMUMarkerVisu/DMUMkvCellComp"],function(d,a,c){var b=a.extend({init:function(){var j=1,h=1;var i=[],q=[0],l=[0],f=[0];var p=d.createElement("canvas");p.width=1000;p.height=300;var t=new c();t.setCellIndex(0,0);i.push(t);var o=this;this.updateGrid=function(){for(var y=0;y<h;y++){var w=0;for(var x=0;x<j;x++){var v=o.getMarkUpCell(x,y);if(v){var D=m(v);if(w<D.width){w=D.width}}}r(y,w)}for(var x=0;x<j;x++){var C=0;var B=0;for(var y=0;y<h;y++){var v=o.getMarkUpCell(x,y);if(v){var D=m(v);C=Math.max(D.height,C);B=Math.max(D.charHeight,B)}}k(x,C);s(x,B)}var u=0;var z=0;for(var y=0;y<j;y++){var C=q[y];u=0;for(var x=0;x<h;x++){var w=l[x];var v=o.getMarkUpCell(y,x);if(v){var A={};A.x=u;A.y=z;v.setCellPos(A)}u+=w}z+=C}};this.getMarkUpCell=function(v,y){var x;if(i.length>0){for(var u=0;u<i.length;u++){var w=i[u].getCellIndex();if(w.row===v&&w.col===y){x=i[u];break}}}return x};this.getNbofRows=function(){return j};this.setNbofRows=function(x){if(x!==j){g()}if(x>j){var w=j;for(var v=0;v<h;v++){for(var u=w;u<x;u++){var y=new c();y.setCellIndex(u,v);i.push(y);q[u]=0;f[u]=0}}}j=x};this.getNbofColumns=function(){return h};this.setNbofColumns=function(y){if(y!==h){g()}if(y>h){var x=h;for(var v=x;v<y;v++){for(var u=0;u<j;u++){var w=new c();if(w){w.setCellIndex(u,v);i.push(w)}}l[v]=0}}h=y};this.getRowHt=function(u){return q[u]};this.getRowCharHt=function(u){return f[u]};this.getColWd=function(u){return l[u]};function k(v,u){q[v]=u}function s(v,u){f[v]=u}function r(v,u){l[v]=u}function e(u,z){var y=u.getImageData(0,0,p.width,p.height).data,A=false,x=false,w=p.height,B=0;var v=0;while(!x&&w){w--;for(B=0;B<z;B++){if(y[w*p.width*4+B*4+3]){x=w;break}}}w=-1;while(w<p.height&&!A){w++;for(B=0;B<z;B++){if(y[w*p.width*4+B*4+3]){A=w;break}}if(A&&x){v=x-A}}return v}function n(v){if(v&&v.length){for(var u=0;u<v.length;u++){if(v[u].length){return true}}}return false}function m(w){var x=w.getCellText();var A=x?x.getTextToDisplay():null;if(n(A)){var F=x.getFontSize();var v=x.getFontName()||"sans-serif";var y=x.getFontStyle()||"";var D=w.size===undefined;if(!D){D=F!==w.size.fontSize;D=D||JSON.stringify(A)!==w.size.textContent;D=D||y!==w.size.fontStyle;D=D||v!==w.size.fontName}if(D){w.size={};var C=y?y+" ":"";C+=F*window.devicePixelRatio+"px ";C+=v;w.size.fontHeight=0;w.size.width=0;var E=p.getContext("2d");E.font=C;var u="";for(var z=0;z<A.length;++z){u=A[z]?A[z]:"aA_{}";E.clearRect(0,0,p.width,p.height);E.fillText(u,0,p.height);var B=E.measureText(u).width;w.size.width=Math.max(B,w.size.width);w.size.fontHeight=Math.max(e(E,B),w.size.fontHeight)}w.size.paddingY=Math.floor(0.5*w.size.fontHeight);w.size.paddingX=Math.floor(0.5*w.size.fontHeight);w.size.width+=2*w.size.paddingX;w.size.height=(w.size.fontHeight+2*w.size.paddingY)*A.length;w.size.fontStyle=y;w.size.textContent=JSON.stringify(A);w.size.fontSize=F}}else{w.size={};w.size.width=w.getCellWd();w.size.height=w.getCellHt();w.size.fontHeight=0}return w.size}function g(){i=[];q=[0];f=[0];l=[0];j=1;h=1;var u=new c();u.setCellIndex(0,0);i.push(u)}}});return b});define("DS/DMUMarkerVisu/DMUMkvGridComp",["DS/DMUMarkerVisu/DMUMkvGridAdapter"],function(a){var b=a.extend({});return b});define("DS/DMUMarkerVisu/DMUMkvShapeAdapter",["UWA/Class","DS/DMUMarkerVisu/DMUMkvGridComp"],function(a,c){var b=a.extend({init:function(f){var g,d,e="center";this.getObject=function(){return f};this.getMarkUpGrid=function(){if(!g){g=new c()}return g};this.getShapePosition=function(){return d};this.getAnchorMode=function(){return e};this.setAnchorMode=function(h){e=h}}});return b});