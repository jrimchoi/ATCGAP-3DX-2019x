define("DS/OptimizationPanel/KPIsettings/OptimKpiPresenter",["DS/Controls/Tab","DS/OptimizationPanel/KPIsettings/KPIconfigContainer","DS/CoreEvents/ModelEvents","DS/Core/Core","css!DS/OptimizationPanel/KPIsettings/PanelKPI.css"],function(b,e,c,d){var a=function(f){this._init(f)};a.prototype._init=function(f){this._listKPI=f&&f.listKPI?f.listKPI:["KPI1","KPI2"];this._modelEventExt=f&&f.modelEvents?f.modelEvents:new c();this._modelEvents=new c();this._tabId=f&&f.modelC0.tabId?f.modelC0.tabId:{};this._content=[];this._configList=[];this._kpiList=[];f.modelC0.tabId=this._tabId;this._initDom(f)};a.prototype._initDom=function(j){this._container=document.createElement("div");this._container.classList.add("panel-container");this._tabWindow=new b({touchMode:true,editableFlag:true,autoCloseFlag:true,displayStyle:"strip",allowUnsafeHTMLOnTabButton:false});this._tabWindow.tabBar.newTabButtonFlag=true;this._tabWindow.tabBar.closeButtonFlag=true;this._tabWindow.tabBar.centeredFlag=false;this._options={tab:this._tabWindow,label:"Optim ",selectedIndex:1};this.id=0;if(Object.keys(this._tabId).length===0&&this._tabId.constructor===Object){this._initiate_createTab(this._options,j.modelC0)}else{for(var g in j.modelC0.tabId){var f=document.createElement("div");f.classList.add("tab-content");f.setAttribute("myid",g);this._content[j.modelC0.tabId[g].index]=new e({listKPI:this._listKPI,modelEvents:this._modelEvents,id:g,meExt:this._modelEventExt,modelC0:j.modelC0});this._content[j.modelC0.tabId[g].index].inject(f);this._tabWindow.setPageContentFromIndex(j.modelC0.tabId[g].index,f);this._options.tab.add({label:j.modelC0.tabId[g].label,content:f,isSelected:true,index:j.modelC0.tabId[g].index});this._options.tab.inject(this._container);this.id=parseInt(g)}}var h=this;this._tabWindow.tabBar.onNewTab(function(){h._tabWindow.tabBar.editableFlag=true;var k=h._tabWindow.tabBar.getTabCount();if(k===1){h.id}else{h.id=h.id+1}var i=document.createElement("div");i.classList.add("tab-content");i.setAttribute("myid",h.id);var l=h._container.querySelectorAll(".wux-controls-tabbar-closebutton");j.modelC0.tabId[h.id]={};j.modelC0.tabId[h.id].index=k-1;j.modelC0.tabId[h.id].label=l[k-1].childNodes[1].innerHTML;h._content[k-1]=new e({listKPI:h._listKPI,modelEvents:h._modelEvents,id:h.id,meExt:h._modelEventExt,modelC0:j.modelC0});h._content[k-1].inject(i);h._tabWindow.setPageContentFromIndex(k-1,i);h._container.querySelector(".wux-controls-buttongroup").setStyle("margin-left","0px");h._container.querySelector(".wux-controls-tabbar-button-nopadding").setAttribute("touch-mode","true")});this._tabWindow.tabBar.onRemoveTabEvent(function(){var n=h._container.querySelector('.tab-content:not([style*="display: none"])');var q=n.attributes.myid.value;var p=0;var o=0;var m=0;var r=[];for(o in j.modelC0.tabId[q].configList){if(j.modelC0.current==o){j.modelC0.current=null}r.push(j.modelC0.defConfig[j.modelC0.tabId[q].configList[o]]);delete j.modelC0.defConfig[j.modelC0.tabId[q].configList[o]]}delete j.modelC0.tabId[q];h._modelEventExt.publish({event:"pc-optim-delete-tab",data:r});console.log(r);var l=h._tabWindow.tabBar.getTabCount();for(p in j.modelC0.tabId){if(j.modelC0.tabId[p]){j.modelC0.tabId[p].index=m;m=m+1}}});this._subscribeEvents()};a.prototype._initiate_createTab=function(h,f){var l=this;for(var k=0;k<1;k++){this._div=document.createElement("div");this._div.classList.add("tab-content");this._div.setAttribute("myId",k);f.tabId[k]={};f.tabId[k].index=k;l._content[k]=new e({listKPI:l._listKPI,modelEvents:l._modelEvents,id:""+k+"",meExt:l._modelEventExt,modelC0:f});l._content[k].inject(l._div);var g=k+1;h.tab.add({label:h.label+g,content:l._div,isSelected:h.selectedIndex==true,index:k})}h.tab.inject(this._container)};a.prototype.inject=function(f){f.appendChild(this._container)};a.prototype._subscribeEvents=function(){this._listSubscription=[];this._listSubscription2=[];var f=this;f._listSubscription.push(f._modelEvents.subscribe({event:"kpilist-generate-configuration-pressed"},function(g){for(var h=0;h<f._content.length;h++){if(f._content[h]._id==g){f._modelEventExt.publish({event:"pc-optim-create-config",data:g})}}}));f._listSubscription.push(f._modelEvents.subscribe({event:"config-created"},function(g){f._modelEventExt.publish({event:"pc-optim-config-created",data:g})}));f._listSubscription.push(f._modelEvents.subscribe({event:"config-name-change"},function(g){f._modelEventExt.publish({event:"pc-optim-change-name",data:g})}));f._listSubscription.push(f._modelEvents.subscribe({event:"config-current-change"},function(g){f._modelEventExt.publish({event:"pc-optim-change-current",data:g})}));f._listSubscription.push(f._modelEvents.subscribe({event:"delete-config"},function(g){f._modelEventExt.publish({event:"pc-optim-delete-config",data:g})}));f._listSubscription2.push(f._modelEventExt.subscribe({event:"pc-optim-conf-to-create"},function(g){f._modelEvents.publish({event:"optimkpipresenter-create-config",data:g})}));f._listSubscription2.push(f._modelEventExt.subscribe({event:"pc-optim-config-color"},function(h){var i=h.id;var g=f._container.querySelector("#"+i);if(g){g.firstChild.firstChild.style.background=h.color;g.firstChild.firstChild.style.display="inline-block"}}));f._listSubscription2.push(f._modelEventExt.subscribe({event:"pc-optim-change-current-from-graph"},function(j){var g=document.querySelectorAll(".wux-ui-3ds-check");for(var h=0;h<g.length;h++){if(j==g[h].parentElement.parentElement.id){g[h].setAttribute("checked",true)}else{g[h].removeAttribute("checked")}}}));f._listSubscription.push(f._modelEvents.subscribe({event:"config-component-next"},function(g){f._modelEventExt.publish({event:"get-next-configuration",data:g})}));f._listSubscription.push(f._modelEvents.subscribe({event:"config-component-refresh"},function(g){f._modelEventExt.publish({event:"get-same-config-new-userchoices",data:g})}))};a.prototype.destroy=function(){this._container=null;var g=this._listSubscription.length;for(var f=0;f<g;f++){this._modelEvents.unsubscribe(this._listSubscription[f])}var h=this._listSubscription2.length;for(var f=0;f<h;f++){this._modelEventExt.unsubscribe(this._listSubscription2[f])}};return a});