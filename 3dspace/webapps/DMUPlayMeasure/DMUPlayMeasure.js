define("DS/DMUPlayMeasure/DMUMeasureImport",["UWA/Class","DS/DMUMeasurable/DMUMeasurable","DS/DMUBaseExperience/EXPUtils"],function(a,c,b){return a.extend({init:function(d){this.importData=function(j,h){if(j&&h&&d){h.fillObjectAttributes(d,j);var g=j.measurables.length;for(var f=0;f<g;f++){var e=new c({},true).importData(j.measurables[f],b.strToType);d.setMeasurable(f+1,e)}h.registerForPostImport(d)}};this.afterImport=function(){if(d){d.buildNode();d.setInEdition(false);d.setClippingControlPoints()}}}})});define("DS/DMUPlayMeasure/DMUMeasureNode3D",["DS/DMUMeasurable/DMUMeasureEnums","DS/DMUBaseUI/DMUNode3D","DS/DMUBaseUI/DMUToolsLeader","DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUMathsFiniteGeometry","DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUToolsAvatars","DS/DMUBaseExperience/EXPUnitManagement","DS/DMUBaseExperience/EXPUtils","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/WebappsUtils/WebappsUtils","DS/Manipulators/ScreenPlaneManipulator","DS/Manipulators/PlaneTranslationManipulator","DS/Manipulators/LineTranslationManipulator","DS/Manipulators/RotationManipulator","DS/SceneGraphNodes/ArrowNode","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/Mesh/MeshUtils","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUMarkerVisu/DMUMkvShapeNode","DS/DMUBaseExperience/EXPToolsVisualization","DS/Selection/CSOManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsMaterial","i18n!DS/DMUPlayMeasure/assets/nls/DMUPlayMeasure"],function(g,w,B,k,F,C,i,s,y,l,b,D,d,t,c,a,o,f,v,x,n,u,j,m,q,e,A,h,E,r,p){var z=w.extend({init:function(au){this._parent(au.owner);this.setNoZ(true);var az=au.owner.getAttribute("cLineStyleColor"),aa=au.owner.getAttribute("cFillStyleColor");var ad={};ad.regularSolidLine=new D.MeshBasicMaterial({force:true});ad.regularSolidLine.line=r.createLineMaterial({color:az,lineWidth:window.devicePixelRatio});ad.regularDashedLine=r.createLineMaterial({color:az,lineWidth:window.devicePixelRatio,pattern:2});ad.avatarSolidLine=new D.MeshBasicMaterial({force:true});ad.avatarSolidLine.line=r.createLineMaterial({color:aa,lineWidth:window.devicePixelRatio});ad.avatarDashedLine=r.createLineMaterial({color:az,lineWidth:window.devicePixelRatio,pattern:2});var aL=(au.bPreviewPickingPoint===true);var N=E.getReviewContext({viewer:au.owner._viewer});var Z=false;var aK=false;var ag=null,V=null,L=null,ah=null;var aw=true;var K=this;var W={};var T,G;var aO;function aD(aQ,aR){aR.setPickParent(true);aR.setVisibilityInTree(false);aQ.addChild(aR)}function aq(){aw=au.owner.isReadOnly()||M()}function aj(aR){if(!aw&&!au.owner.isInEdition()){var aQ={pathElement:h.buildPathElement(K)};if(aR&&aR.event.from[0].event.ctrlKey){A.remove(aQ)}else{A.empty()}A.add(aQ)}}this.getPixelFontSize=function(aR){var aQ;if(au.owner.getAttribute("iFontSize")){aQ=e.convertPixelToModel({sizeInPixels:au.owner.getAttribute("iFontSize")*(4/3),viewer:au.owner._viewer})}if(!aQ){aQ=au.owner.getAttribute(aR)}return e.convertModelToPixels({sizeInMM:aQ,viewer:au.owner._viewer})};function ao(){var aT={fontStyle:{height:K.getPixelFontSize("fFontSize"),familyStyle:au.owner.getAttribute("sFontStyle"),familyName:au.owner.getAttribute("sFontName"),color:au.owner.getAttribute("cFontColor")},fontStyleComment:{height:K.getPixelFontSize("fCommentFontSize"),familyStyle:au.owner.getAttribute("sCommentFontStyle"),familyName:au.owner.getAttribute("sCommentFontName"),color:au.owner.getAttribute("cFontColor")},fillStyle:{color:au.owner.getAttribute("cFillStyleColor"),opacity:au.owner.getAttribute("fOpacity")},lineStyle:{thickness:au.owner.getAttribute("fLineStyleThickness")*window.devicePixelRatio,pattern:au.owner.getAttribute("sLineStylePattern"),color:au.owner.getAttribute("cLineStyleColor")}};var aR=au.owner.getAttribute("fLeaderStyleThickness");var aQ=au.owner.getAttribute("cLeaderStyleColor");var aS=au.owner.getAttribute("sLeaderStylePattern");if(aR!==undefined||aQ||aS){aT.leaderStyle={thickness:aR!==undefined?aR*window.devicePixelRatio:undefined,pattern:aS,color:aQ}}return aT}var R=new q({window:au.frmWindow,content:[""],position:au.owner.getAttribute("vLeaderBreakPoint3D"),isFilled:au.owner.getAttribute("bIsFilled"),hasBorder:au.owner.getAttribute("bHasBorder"),graphicProperties:ao()});aD(this,R);var aE=new q({window:au.frmWindow,content:[""],position:au.owner.getAttribute("vLeaderBreakPoint3D"),isFilled:au.owner.getAttribute("bIsFilled"),hasBorder:au.owner.getAttribute("bHasBorder"),graphicProperties:ao()});aD(this,aE);var Q=new t();aD(this,Q);var am=new t();aD(this,am);var aA=new t();aD(this,aA);var ae=new t();aD(this,ae);var U=new t();aD(this,U);p.diameter=String.fromCharCode(216);var S={approximate:String.fromCharCode(126)};function ar(a1,aV,aZ){var aY=[];var aU={exact:null,value:null,digit:null,symbol:null};var aQ=au.owner.getMeasurable(1);if(aV==="MeasureBetween"||aV==="MeasureThickness"){var a3=au.owner.getMeasurable(2);aU.exact=((ag!=="MeasureThickness")&&(aQ.getMode()===s.Mode.EXACT&&a3.getMode()===s.Mode.EXACT))?true:false;aU.value=0.001;aU.digit=(aU.value+"").split(".")[1].length;aU.mode=(aU.exact)?p.exactMode:p.approximateMode;var aT=ap(aZ,aU,true);if(a1){if(aV==="MeasureBetween"){aY[0]=p.distance+" "+aT}else{aY[0]=p.thickness+" "+aT}}else{var aX=new D.Vector3();aX.subVectors(a3.getSelPoint(),aQ.getSelPoint()).normalize();if(aV==="MeasureBetween"){aY[0]=p.distance+" "+aT;aY[1]=p.firstpoint+" "+at(aQ.getSelPoint(),aU);aY[2]=p.secondpoint+" "+at(a3.getSelPoint(),aU);aY[3]=p.direction+" "+at(aX,aU);aY[4]=al(au.owner.getAttribute("sResultingType1"),au.owner.getAttribute("oProduct1Name"));aY[5]=al(au.owner.getAttribute("sResultingType2"),au.owner.getAttribute("oProduct2Name"));aY[6]=aU.mode}else{aY[0]=p.thickness+" "+aT;aY[1]=p.startpoint+" "+at(aQ.getSelPoint(),aU);aY[2]=p.endpoint+" "+at(a3.getSelPoint(),aU);aY[3]=p.direction+" "+at(aX,aU);aY[4]=p.thickness+" "+p.ofLabel+" "+au.owner.getAttribute("oProduct1Name");aY[5]=aU.mode}}}else{if(aV==="MeasureItem"){aU.exact=(aQ.getMode()===s.Mode.EXACT)?true:false;aU.value=0.001;aU.digit=(aU.value+"").split(".")[1].length;aU.mode=(aU.exact)?p.exactMode:p.approximateMode;var a0=au.owner.getAttribute("oProduct1Name");switch(au.owner.getAttribute("sResultingType1")){case g.ResultType.POINT:if(a1){aY[0]=p.x+": "+l.convert("Length",au.owner.getAttribute("vPosition").x,3,N,true);aY[1]=p.y+": "+l.convert("Length",au.owner.getAttribute("vPosition").y,3,N,true);aY[2]=p.z+": "+l.convert("Length",au.owner.getAttribute("vPosition").z,3,N,true)}else{aY[0]=at(au.owner.getAttribute("vPosition"),aU);aY[1]=p.point+" "+p.inLabel+" "+a0;aY[2]=aU.mode}break;case g.ResultType.CENTER:var aS=aQ.getCenter();if(a1){aY[0]=p.x+": "+l.convert("Length",aS.x,3,N,true);aY[1]=p.y+": "+l.convert("Length",aS.y,3,N,true);aY[2]=p.z+": "+l.convert("Length",aS.z,3,N,true)}else{aY[0]=at(aS,aU);aY[1]=p.point+" "+p.inLabel+" "+a0;aY[2]=aU.mode}break;case g.ResultType.LINE:if(a1){if(au.owner.getAttribute("fLength")!==0){aY[0]=ap(au.owner.getAttribute("fLength"),aU)}}else{var a2=aQ.getPoints();var aX=new D.Vector3();aX.subVectors(a2.endPoint,a2.beginPoint).normalize();aY[0]=ap(au.owner.getAttribute("fLength"),aU);aY[1]=p.startpoint+" "+at(a2.beginPoint,aU);aY[2]=p.endpoint+" "+at(a2.endPoint,aU);aY[3]=p.direction+" "+at(aX,aU);aY[4]=p.line+" "+p.inLabel+" "+a0;aY[5]=aU.mode}break;case g.ResultType.AXIS:var a2=aQ.getPoints();var aX=new D.Vector3();aX.subVectors(a2.endPoint,a2.beginPoint).normalize();if(a1){aY[0]=p.direction+" "+at(aX,aU)}else{aY[0]=p.direction+" "+at(aX,aU);aY[1]=p.infiniteline+" "+p.inLabel+" "+a0;aY[2]=aU.mode}break;case g.ResultType.CIRCLE:var aR=au.owner.getAttribute("fRadius");if(a1){if(au.owner.getAttribute("bRadiusDisplay")){aY[0]=aN(aR,aU)}else{aY[0]=ax(2*aR,aU)}}else{if(au.owner.getAttribute("bRadiusDisplay")){aY[0]=aN(aR,aU)}else{aY[0]=ax(2*aR,aU)}aY[1]=p.center+" "+at(au.owner.getAttribute("vCenter"),aU);aY[2]=ap(2*Math.PI*aR,aU);aY[3]=p.circle+" "+p.inLabel+" "+a0;aY[4]=aU.mode}break;case g.ResultType.CURVE:if(a1){if(au.owner.getAttribute("fLength")!==0){aY[0]=ap(au.owner.getAttribute("fLength"),aU)}}else{aY[0]=ap(au.owner.getAttribute("fLength"),aU);var a2=aQ.getPoints();if(null!==a2){aY[1]=p.startpoint+" "+at(a2.beginPoint,aU);aY[2]=p.endpoint+" "+at(a2.endPoint,aU);aY[3]=p.curve+" "+p.inLabel+" "+a0;aY[4]=aU.mode}else{aY[1]=p.curve+" "+p.inLabel+" "+a0;aY[2]=aU.mode}}break;case g.ResultType.PLANE:if(a1){if(au.owner.getAttribute("fArea")!==0){aY[0]=aB(au.owner.getAttribute("fArea"),aU)}}else{var aW=aQ.getPlane();aY[0]=aB(au.owner.getAttribute("fArea"),aU);aY[1]=p.cog+" "+at(au.owner.getAttribute("vCog"),aU);aY[2]=p.equation+" "+aJ(aW.origin,aW.normal,aU);aY[3]=p.plane+" "+p.inLabel+" "+a0;aY[4]=aU.mode}break;case g.ResultType.CYLINDER:var aR=au.owner.getAttribute("fRadius");if(a1){if(aR!==0){if(au.owner.getAttribute("bRadiusDisplay")){aY[0]=aN(aR,aU)}else{aY[0]=ax(2*aR,aU)}}}else{var a2=aQ.getPoints();var aX=new D.Vector3();aX.subVectors(a2.endPoint,a2.beginPoint).normalize();if(au.owner.getAttribute("bRadiusDisplay")){aY[0]=aN(aR,aU)}else{aY[0]=ax(2*aR,aU)}aY[1]=p.startpoint+" "+at(a2.beginPoint,aU);aY[2]=p.endpoint+" "+at(a2.endPoint,aU);aY[3]=p.direction+" "+at(aX,aU);aY[4]=aB(au.owner.getAttribute("fArea"),aU);aY[5]=p.cog+" "+at(au.owner.getAttribute("vCog"),aU);aY[6]=p.cylinder+" "+p.inLabel+" "+a0;aY[7]=aU.mode}break;case g.ResultType.CONE:if(a1){if(au.owner.getAttribute("fSemiAngle")!==0){aY[0]=ac(au.owner.getAttribute("fSemiAngle"),aU)}}else{var a2=aQ.getPoints();var aX=new D.Vector3();aX.subVectors(a2.endPoint,a2.beginPoint).normalize();aY[0]=ac(au.owner.getAttribute("fSemiAngle"),aU);aY[1]=p.startpoint+" "+at(a2.beginPoint,aU);aY[2]=p.endpoint+" "+at(a2.endPoint,aU);aY[3]=p.direction+" "+at(aX,aU);aY[4]=aB(au.owner.getAttribute("fArea"),aU);aY[5]=p.cog+" "+at(au.owner.getAttribute("vCog"),aU);aY[6]=p.cone+" "+p.inLabel+" "+a0;aY[7]=aU.mode}break;case g.ResultType.SPHERE:aY[0]=p.sphere;var aR=au.owner.getAttribute("fRadius");if(a1){if(au.owner.getAttribute("bRadiusDisplay")){aY[0]=aN(aR,aU)}else{aY[0]=ax(2*aR,aU)}}else{if(au.owner.getAttribute("bRadiusDisplay")){aY[0]=aN(aR,aU)}else{aY[0]=ax(2*aR,aU)}aY[1]=p.center+" "+at(au.owner.getAttribute("vCenter"),aU);aY[2]=aB(au.owner.getAttribute("fArea"),aU);aY[3]=p.sphere+" "+p.inLabel+" "+a0;aY[4]=aU.mode}break;case g.ResultType.SURFACE:if(a1){if(au.owner.getAttribute("fArea")!==0){aY[0]=aB(au.owner.getAttribute("fArea"),aU)}}else{aY[0]=aB(au.owner.getAttribute("fArea"),aU);aY[1]=p.cog+" "+at(au.owner.getAttribute("vCog"),aU);aY[2]=p.surface+" "+p.inLabel+" "+a0;aY[3]=aU.mode}break;case g.ResultType.PRODUCT:if(a1){aY[0]=aF(au.owner.getAttribute("fVolume"),aU)}else{aY[0]=aF(au.owner.getAttribute("fVolume"),aU);aY[1]=aB(au.owner.getAttribute("fArea"),aU);aY[2]=p.cog+" "+at(au.owner.getAttribute("vCog"),aU);aY[3]=p.product+" "+a0;aY[4]=aU.mode}break;default:aY[0]="Unknow";break}}else{if(aV==="Measure3PointsCircle"){var a3=au.owner.getMeasurable(2);aU.exact=(aQ.getMode()===s.Mode.EXACT&&a3.getMode()===s.Mode.EXACT&&au.owner.getMeasurable(3).getMode()===s.Mode.EXACT)?true:false;aU.value=0.001;aU.digit=(aU.value+"").split(".")[1].length;aU.mode=(aU.exact)?p.exactMode:p.approximateMode;var aR=au.owner.getAttribute("fRadius");if(a1){if(au.owner.getAttribute("bRadiusDisplay")){aY[0]=aN(aR,aU)}else{aY[0]=ax(2*aR,aU)}}else{aY[0]=aN(aR,aU)+"  "+ax(2*aR,aU);aY[1]=p.center+" "+at(au.owner.getAttribute("vCenter"),aU);aY[2]=p.normal+" "+at(au.owner.getAttribute("vNormal"),aU);aY[3]=p.circle;aY[4]=aU.mode}}}}return aY}function X(a0,aT,aZ,a1){var aW=[];var aS={exact:null,value:null,digit:null,symbol:null};var aR=au.owner.getMeasurable(1);if((aT==="MeasureBetween")||(aT==="Measure3PointsAngle")||(aT==="MeasureThickness")){var a5=au.owner.getMeasurable(2);aS.exact=(aR.getMode()===s.Mode.EXACT&&a5.getMode()===s.Mode.EXACT)?true:false;aS.value=0.001;aS.digit=(aS.value+"").split(".")[1].length;aS.mode=(aS.exact)?p.exactMode:p.approximateMode;var a3=ac(aZ,aS,true);if(a0){aW[0]=p.angle+" "+a3}else{aW[0]=p.angle+" "+a3;if(a1&&(aT==="MeasureBetween")||aT==="MeasureThickness"){aW[1]=al(au.owner.getAttribute("sResultingType1"),au.owner.getAttribute("oProduct1Name"));aW[2]=al(au.owner.getAttribute("sResultingType2"),au.owner.getAttribute("oProduct2Name"))}else{if(aT==="Measure3PointsAngle"){var a5=au.owner.getMeasurable(2);var a2=au.owner.getMeasurable(3);if(aR!==undefined&&a5!==undefined&&a2!==undefined){aS.exact=(aR.getMode()===s.Mode.EXACT&&a5.getMode()===s.Mode.EXACT&&a2.getMode()===s.Mode.EXACT)?true:false}var aU=au.owner.getAttribute("fProjectedAngleXY");var a4=au.owner.getAttribute("fProjectedAngleYZ");var aX=au.owner.getAttribute("fProjectedAngleZX");if(aU!==undefined&&a4!==undefined&&aX!==undefined){var aV=ac(aU,aS,true);var aQ=ac(a4,aS,true);var aY=ac(aX,aS,true);aW.push(p.projectedAngle+" "+p.xy+": "+aV+" "+p.yz+": "+aQ+" "+p.zx+": "+aY);if(aR!==undefined&&a5!==undefined&&a2!==undefined){if(aR.getSelPoint()!==undefined&&a5.getSelPoint()!==undefined&&a2.getSelPoint()!==undefined){aW.push(p.firstpoint+" "+at(aR.getSelPoint(),aS));aW.push(p.secondpoint+" "+at(a5.getSelPoint(),aS));aW.push(p.thirdpoint+" "+at(a2.getSelPoint(),aS))}}}}}aW.push(aS.mode)}}return aW}function al(aS,aQ){var aR;switch(aS){case g.ResultType.POINT:case g.ResultType.CENTER:aR=p.point+" "+p.inLabel+" "+aQ;break;case g.ResultType.LINE:aR=p.line+" "+p.inLabel+" "+aQ;break;case g.ResultType.AXIS:aR=p.infiniteline+" "+p.inLabel+" "+aQ;break;case g.ResultType.CIRCLE:aR=p.circle+" "+p.inLabel+" "+aQ;break;case g.ResultType.CURVE:aR=p.curve+" "+p.inLabel+" "+aQ;break;case g.ResultType.PLANE:aR=p.plane+" "+p.inLabel+" "+aQ;break;case g.ResultType.CYLINDER:aR=p.cylinder+" "+p.inLabel+" "+aQ;break;case g.ResultType.CONE:aR=p.cone+" "+p.inLabel+" "+aQ;break;case g.ResultType.SPHERE:aR=p.sphere+" "+p.inLabel+" "+aQ;break;case g.ResultType.SURFACE:aR=p.surface+" "+p.inLabel+" "+aQ;break;case g.ResultType.PRODUCT:aR=p.product+" "+aQ;break}return aR}function at(aQ,aR){return" "+p.x+": "+l.convert("Length",aQ.x,aR.digit,N,true)+" "+p.y+": "+l.convert("Length",aQ.y,aR.digit,N,true)+" "+p.z+": "+l.convert("Length",aQ.z,aR.digit,N,true)}function ap(aQ,aU,aT){var aR=(k.isZero(aQ))?0:aQ;var aS=l.convert("Length",aR,aU.digit,N,true);return((aT)?aS:p.length+" "+aS)}function ac(aQ,aU,aT){var aR=(k.isZero(aQ))?0:aQ*180/Math.PI;var aS=l.convert("Angle",aR,aU.digit,N,true);return((aT)?aS:p.angle+" "+aS)}function aB(aQ,aU,aT){var aR=(k.isZero(aQ))?0:aQ;var aS=l.convert("Area",aR,aU.digit,N,true);return((aT)?aS:p.area+" "+aS)}function aF(aQ,aU,aT){var aR=(k.isZero(aQ))?0:aQ;var aS=l.convert("Volume",aR,aU.digit,N,true);return((aT)?aS:p.volume+" "+aS)}function aN(aQ,aU,aT){var aR=(k.isZero(aQ))?0:aQ;var aS=l.convert("Length",aR,aU.digit,N,true);return((aT)?aS:p.radius+" "+aS)}function ax(aQ,aU,aT){var aR=(k.isZero(aQ))?0:aQ;var aS=l.convert("Length",aR,aU.digit,N,true);return((aT)?aS:p.diameter+" "+aS)}function aJ(aU,aS,aT){var aR="";var aV=false;if(!k.isZero(aS.x)){aV=true;aR+=l.convert("Length",aS.x,aT.digit,N,true,true);aR+=p.sx}if(!k.isZero(aS.y)){if(aS.y>0&&aV===true){aR+="+"}aV=true;aR+=l.convert("Length",aS.y,aT.digit,N,true,true);aR+=p.sy}if(!k.isZero(aS.z)){if(aS.z>0&&aV===true){aR+="+"}aV=true;aR+=l.convert("Length",aS.z,aT.digit,N,true,true);aR+=p.sz}var aQ=-((aU.x*aS.x)+(aU.y*aS.y)+(aU.z*aS.z));if(aQ>0&&aV===true){aR+="+"}aR+=l.convert("Length",aQ,aT.digit,N,true,true);aR+="=0";return aR}function ay(aS,aQ,aR){var aX=new t();var aW=[];var a2=Number.MAX_VALUE;for(var aV=0;aV<3;aV++){aW[aV]=aS[aV+3]-aS[aV];a2=Math.min(a2,aW[aV])}a2/=10;var a1=[];a1[0]=new D.Vector3(a2,0,0);a1[1]=new D.Vector3(0,a2,0);a1[2]=new D.Vector3(0,0,a2);var aY=[];var a3=[];var a0=new D.Vector3(aS[0],aS[1],aS[2]);for(aY[0]=0;aY[0]<2;aY[0]++){for(aY[1]=0;aY[1]<2;aY[1]++){for(aY[2]=0;aY[2]<2;aY[2]++){var aU=4*aY[0]+2*aY[1]+aY[2];a3[aU]=[];a3[aU][0]=new D.Vector3(aY[0]*aW[0],aY[1]*aW[1],aY[2]*aW[2]).add(a0);for(var aT=0;aT<3;aT++){a3[aU][aT+1]=a1[aT].clone().multiplyScalar(1-2*aY[aT]).add(a3[aU][0])}var a5=[a3[aU][1],a3[aU][0],a3[aU][2],a3[aU][0],a3[aU][3]];var aZ=d.createLineNode({points:a5,material:aQ});aZ.setShadow(false);aD(aX,aZ)}}}var a5=[a3[0][0],a3[4][0],a3[6][0],a3[2][0],a3[0][0],a3[1][0],a3[5][0],a3[4][0],a3[5][0],a3[7][0],a3[6][0],a3[7][0],a3[3][0],a3[2][0],a3[3][0],a3[1][0]];var a4=d.createLineNode({points:a5,material:aR});a4.setShadow(false);aD(aX,a4);return aX}function J(a2,a0,a6,bh,aY,aT,aZ,aQ){var a7=new t();if(a2&&a0){var aX=4;var a4=false;var aV=a2.clone().add(a0).multiplyScalar(0.5);var a9=(aY)?aV.clone():a0.clone();var a5=(aZ.leaderStyle&&aZ.leaderStyle.thickness!==undefined?aZ.leaderStyle.thickness:aZ.lineStyle.thickness);var aW=aZ.leaderStyle&&aZ.leaderStyle.thickness!==undefined?aZ.leaderStyle.thickness:aZ.lineStyle.thickness;if(aQ!==undefined&&aQ===true){aX=Math.max(2*aW+4,10);a4=true}var bg={arrowWidth:aW,headLength:aX,viewpoint:au.viewer.currentViewpoint,initialPoint:a9.clone(),finalPoint:a2.clone(),color:aZ.leaderStyle&&aZ.leaderStyle.color?aZ.leaderStyle.color:aZ.lineStyle.color,head:0};if(!k.areEqual(bg.initialPoint,bg.finalPoint,"Vector3")){var a1=new x(bg);aD(a7,a1)}var bb=a2.clone().sub(a0);var a8=bb.length();var aU=a8<aX;var aS=(aU)?1:aX/a8;if(a4!==true){var a3=false;if(ag!=="MeasureThickness"){var bf=a6.clone().sub(a2);var be=a0.clone().sub(a2);var bd=a6.clone().sub(a0);var bc=a2.clone().sub(a0);a3=(!bh)||((bf.clone().dot(be.clone())>0)&&(bd.clone().dot(bc.clone())>0))}if(!a3||aU){aS=-aS}}bb.multiplyScalar(aS);bg.head=1;bg.initialPoint=a2.clone().sub(bb);if(!k.areEqual(bg.initialPoint,bg.finalPoint,"Vector3")){var aR=new x(bg);aD(a7,aR)}if(!aY){bg.initialPoint=a0.clone().add(bb);bg.finalPoint=a0;if(!k.areEqual(bg.initialPoint,bg.finalPoint,"Vector3")){var ba=new x(bg);aD(a7,ba)}}}return a7}function aG(aT,aS,aR,aQ,aZ,aW,a0){var aX=new t();if(aT&&aS&&aR&&aQ){var aY=aS.clone();var aV=aQ.clone();if(aZ){aY.add(aT).multiplyScalar(0.5);aV.add(aR).multiplyScalar(0.5)}var aU={arrowWidth:(a0.leaderStyle&&a0.leaderStyle.thickness!==undefined?a0.leaderStyle.thickness:a0.lineStyle.thickness)*window.devicePixelRatio,viewpoint:au.viewer.currentViewpoint,initialPoint:aR.clone(),finalPoint:aT.clone(),color:a0.leaderStyle&&a0.leaderStyle.color?a0.leaderStyle.color:a0.lineStyle.color,head:0};if(!k.areEqual(aU.initialPoint,aU.finalPoint,"Vector3")){aD(aX,new x(aU))}aU.initialPoint=aV;aU.finalPoint=aY;if(!k.areEqual(aU.initialPoint,aU.finalPoint,"Vector3")){aD(aX,new x(aU))}}return aX}function I(aT,aS,aR,aQ,a0,aV,a1){var aW=new t();if(aT&&aS&&aR&&aQ){var aX=aS.clone();var aU=aQ.clone();if(a0){aX.add(aT).multiplyScalar(0.5);aU.add(aR).multiplyScalar(0.5)}var aY=y.createLineNode(aR.clone(),aT.clone(),aV);if(!k.areEqual(aR,aT,"Vector3")){aD(aW,aY)}var aZ=y.createLineNode(aU.clone(),aX.clone(),aV);if(!k.areEqual(aU,aX,"Vector3")){aD(aW,aZ)}}return aW}function ak(aV,aT,aQ,aW,aU,aS,aR){var aY=new t();var aX=true;if(au.owner._bCreateMeasureInShowSpace===0){aX=false}if(aV){if(aY._nAnchor1SpriteNode!==null){aY.remove(aY._nAnchor1SpriteNode)}aY._nAnchor1SpriteNode=aM(aV,aQ,aW,aS);aY._nAnchor1SpriteNode.setVisibility(aX);aD(aY,aY._nAnchor1SpriteNode)}if(aT){if(aY._nAnchor2SpriteNode!==null){aY.remove(aY._nAnchor2SpriteNode)}aY._nAnchor2SpriteNode=aM(aT,aQ,aW,aR);aY._nAnchor2SpriteNode.setVisibility(aX);aD(aY,aY._nAnchor2SpriteNode)}if(aV&&aT){var aZ=y.createLineNode(aV,aT,aU);aD(aY,aZ)}return aY}function aM(aY,aQ,aT,aR){var aU=new n({position:aY.clone(),name:"anchor1",type:"Spherical"});aU.setMatrix(new D.Matrix4().setPosition(aY.clone()));var aZ=8;var aX=d.createCircleNode({radius:aZ/2,segments:8,fill:false,color:aQ});aX.setShadow(false);var aS=new u({name:"myFixedSizeNode",ratio:1});aD(aS,aX);aD(aU,aS);var aW=d.createCircleNode({radius:aZ/2,segments:8,fill:true,color:aT});aW.setShadow(false);var aV=new u({name:"myFixedSizeNode",ratio:1});aD(aV,aW);aD(aU,aV);return aU}function aC(aT,aQ,aW,aV,aR,aZ){var aS;var aU=(aV===g.ResultType.AXIS||aV===g.ResultType.CIRCLE)?ad.avatarDashedLine:ad.avatarSolidLine;aP(aT,aQ,aW,aV,aU,aZ);if((aV===g.ResultType.AXIS)||(aV===g.ResultType.LINE)){var aX=aW.getPoints();var aY=C.computePointSegmentDistance(aR.toArray(),aX.beginPoint.toArray(),aX.endPoint.toArray());if((aY.returnCode===0)&&(aY.relationship!==s.Relationship.COINCIDENT)){aS=new D.Vector3(aY.aPosition[0],aY.aPosition[1],aY.aPosition[2])}}else{aS=aW.getSelPoint()}if(aS){if(i.areEqual(aS.toArray(),aR.toArray())){aS=undefined}else{aD(aT,y.createLineNode(aS,aR,ad.regularDashedLine))}}}function aP(bh,aW,bg,bb,aT,a4){if(aW!==null){bh.remove(aW)}if(bg){var bf=(bg.getMode()===s.Mode.EXACT)?"circle":"square";switch(bb){case g.ResultType.LINE:break;case g.ResultType.AXIS:var bd=bg.getPoints();aW=y.createLineNode(bd.beginPoint,bd.endPoint,aT);break;case g.ResultType.CIRCLE:aW=new t();var bc=y.createCircleNode(bg.getRadius(),bg.getCenter(),bg.getAxis(),aT);aD(aW,bc);var be=10;var a6=y.createCrossNode(be,bg.getCenter(),bg.getAxis(),aT);aD(aW,a6);break;case g.ResultType.CYLINDER:aW=new t();var bd=bg.getPoints();var a1=bd.beginPoint.clone().add(bd.endPoint).multiplyScalar(0.5);var a3=bd.endPoint.clone().sub(bd.beginPoint);var bc=y.createCircleNode(bg.getRadius(),a1,a3,aT);aD(aW,bc);var bk=y.createLineNode(bd.beginPoint,bd.endPoint,aT);aD(aW,bk);var bj=bd.beginPoint.clone().sub(bd.endPoint);var aR=Math.max(bg.getRadius(),bj.length())/8;bj.normalize().multiplyScalar(aR);var ba=bd.beginPoint.clone().add(bj);var a8=bd.endPoint.clone().sub(bj);var aV=y.createLineNode(ba,bd.beginPoint,ad.regularDashedLine);aD(aW,aV);var aV=y.createLineNode(a8,bd.endPoint,ad.regularDashedLine);aD(aW,aV);var a9=aM(a1,a4.leaderStyle&&a4.leaderStyle.color?a4.leaderStyle.color:a4.lineStyle.color,a4.fillStyle.color,bf);aD(aW,a9);var a7=aM(bd.beginPoint,a4.leaderStyle&&a4.leaderStyle.color?a4.leaderStyle.color:a4.lineStyle.color,a4.fillStyle.color,bf);aD(aW,a7);var a5=aM(bd.endPoint,a4.leaderStyle&&a4.leaderStyle.color?a4.leaderStyle.color:a4.lineStyle.color,a4.fillStyle.color,bf);aD(aW,a5);break;case g.ResultType.CONE:aW=new t();var bd=bg.getPoints();var a2=bg.getApex();var bl=bg.getSemiAngle();var aZ=bg.getAxis();var bi=k.areEqual(bd.beginPoint,a2,"Vector3");var aX=a2.clone().sub(bd.beginPoint).length()*Math.tan(bl);var aS=y.createCircleNode(aX,bd.beginPoint,aZ,aT);aD(aW,aS);var aU=a2.clone().sub(bd.endPoint).length()*Math.tan(bl);var aQ=y.createCircleNode(aU,bd.endPoint,aZ,aT);aD(aW,aQ);var a0=y.createLineNode(bd.beginPoint,bd.endPoint,aT);aD(aW,a0);if(!bi){aD(aW,y.createLineNode(bd.beginPoint,a2,ad.regularDashedLine))}aD(aW,y.createLineNode(au.owner.getAttribute("vFirstExtensionPoint3D"),a2,ad.regularDashedLine));aD(aW,aM(a2,a4.leaderStyle&&a4.leaderStyle.color?a4.leaderStyle.color:a4.lineStyle.color,a4.fillStyle.color,bf));if(!bi){aD(aW,aM(bd.beginPoint,a4.leaderStyle&&a4.leaderStyle.color?a4.leaderStyle.color:a4.lineStyle.color,a4.fillStyle.color,bf))}aD(aW,aM(bd.endPoint,a4.leaderStyle&&a4.leaderStyle.color?a4.leaderStyle.color:a4.lineStyle.color,a4.fillStyle.color,bf));break;case g.ResultType.SPHERE:aW=new t();aD(aW,y.createCircleNode(bg.getRadius(),bg.getCenter(),bg.normal,aT));aD(aW,aM(bg.getCenter(),a4.leaderStyle&&a4.leaderStyle.color?a4.leaderStyle.color:a4.lineStyle.color,a4.fillStyle.color,bf));break;case g.ResultType.PLANE:if((bb===g.ResultType.PLANE)||(bb===g.ResultType.POINTPLANE)||(bb===g.ResultType.AXISPLANE)||(bb===g.ResultType.PLANEPLANE)){var be=10;aW=y.createRectangleNode(be,be,bg.getSelPoint(),bg.getPlane().normal,aT)}else{if(bb===g.ResultType.POINT){aW=new t();var aY=bg.getPlane();aD(aW,y.createCrossNode(be,aY.origin,aY.normal,aT))}}break;default:break}if(aW){aD(bh,aW)}}}function ai(){var aR=false;if(ag==="MeasureBetween"||ag==="MeasureThickness"){var aS=au.owner.getAttribute("fDistance");aR=(aS!==undefined)&&!k.isZero(aS)}else{if(ag==="MeasureItem"){var aQ=au.owner.getAttribute("sResultingType1");aR=((aQ===g.ResultType.LINE)||(aQ===g.ResultType.CIRCLE))}else{if(ag==="Measure3PointsCircle"){aR=true}}}return aR}function av(aR){var aQ=ai();if(aR||((L!==undefined)&&(aQ!==L))){aI();if(ai()){ab();H()}O();af();L=aQ}}function aH(){if(ai()){if(aA.manipulator){aA.manipulator.deactivate(aA.token)}if(ae.manipulator){ae.manipulator.deactivate(ae.token)}}if(R.manipulator){R.manipulator.deactivate(R.token)}if(aE.manipulator){aE.manipulator.deactivate(aE.token)}}function Y(){if(ai()){if(aA.manipulator){aA.manipulator.activate(aA.token)}if(ae.manipulator){ae.manipulator.activate(ae.token)}}if(R.manipulator){R.manipulator.activate(R.token)}if(aE.manipulator){aE.manipulator.activate(aE.token)}}function aI(){if(aA.manipulator){aA.manipulator.unlink(aA.token);aA.manipulator=null;aA.token=null}if(ae.manipulator){ae.manipulator.unlink(ae.token);ae.manipulator=null;ae.token=null}if(R.manipulator){R.manipulator.unlink(R.token);R.manipulator=null;R.token=null}if(aE.manipulator){aE.manipulator.unlink(aE.token);aE.manipulator=null;aE.token=null}}function P(){if(ai()){if(aA.manipulator){aA.manipulator.axis=au.owner.getAttribute("vExtensionDirection3D").clone()}if(R.manipulator){R.manipulator.axis=au.owner.getAttribute("vSecondPoint3D").clone().sub(au.owner.getAttribute("vFirstPoint3D"))}if(aE.manipulator&&aK){aE.manipulator.axis=au.owner.getAttribute("vAngleVector1").clone().cross(au.owner.getAttribute("vAngleVector2"))}}}function M(){var aR=b.allowManipulation({object:"Section",viewer:au.viewer});if(typeof aR==="boolean"){return !aR}var aS=b.checkIfCommandIsRunning(au.viewer);if(aS){var aQ=b.getCurrentCommand(au.viewer);if(aQ==="measureCmdHdr"||aQ==="measure3CmdHdr"||aQ==="measure2CmdHdr"){aS=false}}return aS}function ab(){aA.manipulator=new f({axis:au.owner.getAttribute("vExtensionDirection3D").clone()});aA.manipulator.setExclusive(true);aA.token=aA.manipulator.linkToNode(aA);var aQ;var aR;aA.manipulator.subscribe("BeginManipulate",function(){aq();if(!aw){aQ=au.owner.getAttribute("vFirstPoint3D").clone();aR=au.owner.getAttribute("vSecondPoint3D").clone()}});aA.manipulator.subscribe("Manipulate",function(aS){if(!aw){au.owner.setAttribute("vFirstPoint3D",aQ.clone().add(aS.translationVector));au.owner.setAttribute("vSecondPoint3D",aR.clone().add(aS.translationVector));var aT=au.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(au.owner.getAttribute("vLeaderBreakPoint3D"));au.owner.setAttribute("vLeaderPointingPoint3D",au.owner.getAttribute("vFirstPoint3D").clone().add(au.owner.getAttribute("vSecondPoint3D")).multiplyScalar(0.5));au.owner.setAttribute("vLeaderBreakPoint3D",au.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(aT));P();K.update()}});aA.manipulator.subscribe("EndManipulate",aj)}function H(){var aR=au.owner.getAttribute("vSecondExtensionPoint3D").clone().sub(au.owner.getAttribute("vFirstExtensionPoint3D"));ae.manipulator=new v({axis:aR});ae.manipulator.setExclusive(true);ae.manipulator.setCenter(au.owner.getAttribute("vFirstExtensionPoint3D").clone());ae.token=ae.manipulator.linkToNode(ae);var aS;var aT;var aQ;ae.manipulator.subscribe("BeginManipulate",function(){aq();if(!aw){aS=au.owner.getAttribute("vFirstPoint3D").clone();aT=au.owner.getAttribute("vSecondPoint3D").clone();aQ=new D.Matrix4()}});ae.manipulator.subscribe("Manipulate",function(aY){if(!aw){var aW=new D.Matrix4().copy(aQ);var aV=new D.Matrix4().makeRotationAxis(aY.axis,aY.angle);var a1=new D.Matrix4().setPosition(aY.center);var aU=new D.Matrix4().getInverse(a1).multiply(aW);var aZ=new D.Matrix4().copy(aV).multiply(aU);var aX=new D.Matrix4().copy(a1).multiply(aZ);au.owner.setAttribute("vFirstPoint3D",aS.clone().applyMatrix4(aX));au.owner.setAttribute("vSecondPoint3D",aT.clone().applyMatrix4(aX));au.owner.setAttribute("vExtensionDirection3D",au.owner.getAttribute("vFirstPoint3D").clone().sub(au.owner.getAttribute("vFirstExtensionPoint3D")));var a0=au.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(au.owner.getAttribute("vLeaderBreakPoint3D"));au.owner.setAttribute("vLeaderPointingPoint3D",au.owner.getAttribute("vFirstPoint3D").clone().add(au.owner.getAttribute("vSecondPoint3D")).multiplyScalar(0.5));au.owner.setAttribute("vLeaderBreakPoint3D",au.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(a0));P();K.update()}});ae.manipulator.subscribe("EndManipulate",aj)}function O(){R.manipulator=new a();R.manipulator.setExclusive(true);R.token=R.manipulator.linkToNode(R);var aT;var aS;var aQ=R.manipulator,aR=0;aQ.setExclusive(true);aQ.subscribe("BeginManipulate",function(){aq();aR=0;if(!aw){aS=au.frmWindow.getViewerFrame().style.cursor;au.frmWindow.getViewerFrame().setStyle("cursor","move");aT=au.owner.getAttribute("vLeaderBreakPoint3D").clone()}});aQ.subscribe("Manipulate",function(a0){aR++;if(!aw){if(ai()){var a1=aT.clone().add(a0.translationVector);var aW=au.owner.getAttribute("vSecondExtensionPoint3D").clone().sub(au.owner.getAttribute("vFirstExtensionPoint3D"));var aV=aW.lengthSq();if(aV>0.000001){var aY=aW.dot(au.owner.getAttribute("vFirstExtensionPoint3D").clone().sub(a1))/aV;var aU=aW.multiplyScalar(-aY).add(au.owner.getAttribute("vFirstExtensionPoint3D"));var aZ=a1.clone().sub(aU);au.owner.setAttribute("vFirstPoint3D",au.owner.getAttribute("vFirstExtensionPoint3D").clone().add(aZ));au.owner.setAttribute("vSecondPoint3D",au.owner.getAttribute("vSecondExtensionPoint3D").clone().add(aZ));au.owner.setAttribute("vLeaderBreakPoint3D",a1);var aX=au.owner.getAttribute("vFirstPoint3D").clone().add(au.owner.getAttribute("vSecondPoint3D")).multiplyScalar(0.5);au.owner.setAttribute("vLeaderPointingPoint3D",aX)}}else{au.owner.setAttribute("vLeaderBreakPoint3D",aT.clone().add(a0.translationVector))}P();K.update()}});aQ.subscribe("EndManipulate",function(aV){if(!aw){au.frmWindow.getViewerFrame().setStyle("cursor",aS);if(aR<3){var aU={pathElement:h.buildPathElement(K)};if(!aV.event.from[0].event.ctrlKey){setTimeout(function(){A.empty();A.add(aU)})}else{if(A.isIn(aU)){A.remove(aU)}else{A.add(aU)}}}else{aj(aV)}}})}function af(){var aT=(aK)?au.owner.getAttribute("vAngleVector1").clone().cross(au.owner.getAttribute("vAngleVector2")):new D.Vector3();aE.manipulator=new o({axis:aT});aE.manipulator.setExclusive(true);aE.token=aE.manipulator.linkToNode(aE);var aR;var aS;var aQ=aE.manipulator;aQ.subscribe("BeginManipulate",function(){aq();if(!aw){aS=au.frmWindow.getViewerFrame().style.cursor;au.frmWindow.getViewerFrame().setStyle("cursor","move");aR=au.owner.getAttribute("vAngleBreakPoint").clone()}});aQ.subscribe("Manipulate",function(aZ){if(!aw){au.owner.setAttribute("vAngleBreakPoint",aR.clone().add(aZ.translationVector));au.owner.setAttribute("vAnglePointingPoint",au.owner.getAttribute("vAngleBreakPoint").clone());var a2=au.owner.getAttribute("vAngleBreakPoint").clone().sub(au.owner.getAttribute("vAngleArcCenter"));var aU=au.owner.getAttribute("vAngleVector1");var a3=au.owner.getAttribute("vAngleVector2");var aV=aU.clone().cross(a3);var a1=aV.clone().cross(aU).dot(a2);var a0=aV.clone().cross(a3).dot(a2);var aW=0;if(0>a1){aW+=2}if(0<a0){aW+=1}au.owner.setAttribute("fQuadrant",aW);var aY=aU.clone();if((aW===1)||(aW===3)){aY.negate()}var aX=a3.clone();if((aW===2)||(aW===3)){aX.negate()}au.owner.setAttribute("fAngle",aY.angleTo(aX));P();K.update()}});aQ.subscribe("EndManipulate",function(aU){if(!aw){au.frmWindow.getViewerFrame().setStyle("cursor",aS)}aj(aU)})}function an(aR,aS){var aQ=false;switch(aS){case"bool":var aT=au.owner.getAttribute("b"+aR);aQ=(aT===undefined)||((W[aR]!==undefined)&&(aT===W[aR]));if(!aQ){W[aR]=aT}break;case"int":var aT=au.owner.getAttribute("i"+aR);aQ=(aT===undefined)||((W[aR]!==undefined)&&(aT===W[aR]));if(!aQ){W[aR]=aT}break;case"float":var aT=au.owner.getAttribute("f"+aR);aQ=(aT===undefined)||((W[aR]!==undefined)&&(aT===W[aR]));if(!aQ){W[aR]=aT}break;case"string":var aT=au.owner.getAttribute("s"+aR);if(aT===undefined&&W[aR]){aT=W[aR]}aQ=(aT===undefined)||((W[aR]!==undefined)&&(aT===W[aR]));if(!aQ){W[aR]=aT}break;case"Color":var aT=au.owner.getAttribute("c"+aR);aQ=(aT===undefined)||((W[aR]!==undefined)&&(aT.equals(W[aR])));if(!aQ){W[aR]=aT}break;case"Vector3":var aT=au.owner.getAttribute("v"+aR);aQ=(aT===undefined)||(aT===null)||((W[aR]!==undefined)&&(aT.equals(W[aR])));if(!aQ){W[aR]=aT.clone()}break;case"AABB":var aT=au.owner.getAttribute(aR);aQ=(aT===undefined)||((W[aR]!==undefined)&&F.areEqualAABB(aT,W[aR]));if(!aQ){W[aR]=aT}break;default:aQ=false}return aQ}this.getBoxPosition=function(){var aR=R.getDimensions();var aQ={top:-aR.offsetHeight/2,left:-aR.offsetWidth/2};return aQ};this.update=function(bH,aW,aX){if(undefined!==aX){aL=(aX===true)}if(W===null){return}ag=au.owner.getAttribute("sType");if(aW){V=undefined}var bZ=au.owner.getMeasurable(1);var bn=ao();var bl=an("UnitLength","string");var bw=an("UnitAngle","string");var bq=an("UnitArea","string");var bP=an("UnitVolume","string");var bs=bl&&bw&&bq&&bP;var aS=(V!==undefined)&&(V===ag);if(!aS){V=ag}var br=(bH)?true:!aS;if(!aS){aK=(au.owner.getAttribute("fAngle")!==undefined)&&!k.isZero(au.owner.getAttribute("fAngle"));var bg=au.owner.getAttribute("fDistance");Z=(ag==="MeasureItem")||(ag==="Measure3PointsCircle")||(ag==="MeasureThickness")||((bg!==undefined)&&!(k.isZero(bg)&&aK))}if(!au.owner.isReadOnly()){av(br)}var bh=an("LineStyleColor","Color");var bS=an("FillStyleColor","Color");var bC=an("LineStyleThickness","float");var cm=an("LeaderStyleThickness","float");var a6=an("Distance","float");var a8=an("FirstPoint3D","Vector3");var aQ=an("SecondPoint3D","Vector3");var bE=an("FirstExtensionPoint3D","Vector3");var a1=an("SecondExtensionPoint3D","Vector3");var bj=an("LeaderBreakPoint3D","Vector3");var bU=an("LeaderPointingPoint3D","Vector3");var aR=an("RadiusDisplay","bool");var bQ=an("Angle","float");var bF=an("AngleBreakPoint","Vector3");var bm=an("Quadrant","float");var aU=an("AngleArcCenter","Vector3");var cj=an("AnglePointingPoint","Vector3");var bJ=an("AngleVector1","Vector3");var bI=an("AngleVector2","Vector3");var bo=an("aabb","AABB");var a0=au.owner._bCreateMeasureInShowSpace!==0;if(!bh||!bS){ad.regularSolidLine.line.color=bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color;ad.regularDashedLine.color=bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color;ad.avatarSolidLine.line.color=bn.fillStyle.color;ad.avatarDashedLine.color=bn.fillStyle.color}if(!aS||!bh||!cm||!bS||!a6||!a8||!aQ||!bE||!a1||!bj||!bU||!aR||!bQ||!bF||!bm||!aU||!cj||!bJ||!bI){if((ag!=="MeasureItem")||((au.owner.getAttribute("sResultingType1")===g.ResultType.LINE)||(au.owner.getAttribute("sResultingType1")===g.ResultType.CIRCLE))){aA.removeChildren();ae.removeChildren();aH();if(ag==="MeasureBetween"||ag==="MeasureThickness"){if(ag==="MeasureBetween"){var bV=au.owner.getAttribute("vAngleArcCenter");var bD=au.owner.getAttribute("vAnglePointingPoint");var bA=au.owner.getAttribute("vAngleVector1");var bz=au.owner.getAttribute("vAngleVector2");if(bV&&bD&&bA&&bz){var b8=bA.clone();var bv=au.owner.getAttribute("fQuadrant");if((bv===1)||(bv===3)){b8.negate()}var b6=bz.clone();if((bv===2)||(bv===3)){b6.negate()}var aT=bD.clone().sub(bV).length();var bR=y.createArcNode(aT,bV,b8,b6,ad.regularSolidLine);aD(ae,bR);var bb=bV.clone().add(b8.clone().normalize().multiplyScalar(aT));aD(ae,y.createLineNode(bV,bb,ad.regularDashedLine));var ba=bV.clone().add(b6.clone().normalize().multiplyScalar(aT));aD(ae,y.createLineNode(bV,ba,ad.regularDashedLine))}}if(ai()){var cb=(ag==="MeasureBetween")?true:false;var a4=J(au.owner.getAttribute("vFirstPoint3D"),au.owner.getAttribute("vSecondPoint3D"),au.owner.getAttribute("vLeaderBreakPoint3D"),true,false,ad.regularSolidLine,bn,cb);aD(aA,a4);if(ag==="MeasureBetween"){var ce=I(au.owner.getAttribute("vFirstPoint3D"),au.owner.getAttribute("vSecondPoint3D"),au.owner.getAttribute("vFirstExtensionPoint3D"),au.owner.getAttribute("vSecondExtensionPoint3D"),false,ad.regularDashedLine,bn);aD(ae,ce)}else{var ce=aG(au.owner.getAttribute("vFirstPoint3D"),au.owner.getAttribute("vSecondPoint3D"),au.owner.getAttribute("vFirstExtensionPoint3D"),au.owner.getAttribute("vSecondExtensionPoint3D"),false,ad.regularSolidLine,bn);aD(ae,ce)}}}else{if(ag==="MeasureItem"){switch(au.owner.getAttribute("sResultingType1")){case g.ResultType.LINE:var a4=J(au.owner.getAttribute("vFirstPoint3D"),au.owner.getAttribute("vSecondPoint3D"),au.owner.getAttribute("vLeaderBreakPoint3D"),true,false,ad.regularSolidLine,bn);aD(aA,a4);var ce=aG(au.owner.getAttribute("vFirstPoint3D"),au.owner.getAttribute("vSecondPoint3D"),au.owner.getAttribute("vFirstExtensionPoint3D"),au.owner.getAttribute("vSecondExtensionPoint3D"),false,ad.regularSolidLine,bn);aD(ae,ce);break;case g.ResultType.CIRCLE:var a4=J(au.owner.getAttribute("vFirstPoint3D"),au.owner.getAttribute("vSecondPoint3D"),au.owner.getAttribute("vLeaderBreakPoint3D"),true,au.owner.getAttribute("bRadiusDisplay"),ad.regularSolidLine,bn);aD(aA,a4);var ce=aG(au.owner.getAttribute("vFirstPoint3D"),au.owner.getAttribute("vSecondPoint3D"),au.owner.getAttribute("vFirstExtensionPoint3D"),au.owner.getAttribute("vSecondExtensionPoint3D"),au.owner.getAttribute("bRadiusDisplay"),ad.regularSolidLine,bn);aD(ae,ce);break;default:break}}else{if(ag==="Measure3PointsCircle"){var a4=J(au.owner.getAttribute("vFirstPoint3D"),au.owner.getAttribute("vSecondPoint3D"),au.owner.getAttribute("vLeaderBreakPoint3D"),true,au.owner.getAttribute("bRadiusDisplay"),ad.regularSolidLine,bn);aD(aA,a4);var ce=aG(au.owner.getAttribute("vFirstPoint3D"),au.owner.getAttribute("vSecondPoint3D"),au.owner.getAttribute("vFirstExtensionPoint3D"),au.owner.getAttribute("vSecondExtensionPoint3D"),au.owner.getAttribute("bRadiusDisplay"),ad.regularSolidLine,bn);aD(ae,ce)}else{if(ag==="Measure3PointsAngle"){var b8=au.owner.getAttribute("vAngleVector1").clone();var b6=au.owner.getAttribute("vAngleVector2").clone();var bv=au.owner.getAttribute("fQuadrant");var b1=false;if(bv!==undefined){if((bv===1)||(bv===3)){b8.negate()}if((bv===2)||(bv===3)){b6.negate()}var bB=b8.angleTo(b6);if(bB!==au.owner.getAttribute("fAngle")){au.owner.setAttribute("fAngle",bB)}}else{var bd=au.owner.getAttribute("fAngle");var be=(k.isZero(bd))?0:bd*180/Math.PI;if(be>180){b1=true}}var co=au.owner.getAttribute("vAnglePointingPoint");var a9=au.owner.getAttribute("bHasALeader");var ck=au.owner.getAttribute("vAngleBreakPoint");var a7=ad.regularDashedLine;if(a9!==undefined&&co!==undefined&&ck!==undefined&&a9==true){a7=ad.regularSolidLine;var cf=y.createLineNode(au.owner.getAttribute("vAnglePointingPoint"),au.owner.getAttribute("vAngleBreakPoint"),a7);aD(ae,cf);var bG=aM(au.owner.getAttribute("vAnglePointingPoint"),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color);bG.setVisibility(a0);var bf=aM(au.owner.getAttribute("vAngleBreakPoint"),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color);bf.setVisibility(a0);aD(ae,bG);aD(ae,bf)}var bV=au.owner.getAttribute("vAngleArcCenter");var aT=au.owner.getAttribute("vAnglePointingPoint").clone().sub(bV).length();var bR=y.createArcNode(aT,bV,b8,b6,a7,b1);aD(ae,bR);var bY=au.owner.getMeasurable(2);var bb=bV.clone().add(b8.clone().normalize().multiplyScalar(aT));var bO=aM(bb,bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color);bO.setVisibility(a0);aD(ae,bO);var cs=C.computePointSegmentDistance(bb.toArray(),bZ.getSelPoint().toArray(),bY.getSelPoint().toArray());if((cs.returnCode===0)&&(cs.relationship!==s.Relationship.COINCIDENT)){var bM=new D.Vector3(cs.aPosition[0],cs.aPosition[1],cs.aPosition[2]);aD(ae,y.createLineNode(bM,bb,ad.regularDashedLine))}var ba=bV.clone().add(b6.clone().normalize().multiplyScalar(aT));var a5=aM(ba,bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color);a5.setVisibility(a0);aD(ae,a5);var cs=C.computePointSegmentDistance(ba.toArray(),au.owner.getMeasurable(3).getSelPoint().toArray(),bY.getSelPoint().toArray());if((cs.returnCode===0)&&(cs.relationship!==s.Relationship.COINCIDENT)){var bM=new D.Vector3(cs.aPosition[0],cs.aPosition[1],cs.aPosition[2]);aD(ae,y.createLineNode(bM,ba,ad.regularDashedLine))}}}}}Y()}}if(!aL&&((ag==="MeasureBetween"&&au.owner.getAttribute("sResultingType1")===g.ResultType.POINT&&au.owner.getAttribute("sResultingType2")===g.ResultType.POINT)||(ag==="MeasureItem"&&au.owner.getAttribute("sResultingType1")===g.ResultType.POINT))){am.removeChildren()}if(!aS||!bh||!bS||!aR||!bo||!a6||!bE){Q.removeChildren();am.removeChildren();if(ag==="MeasureBetween"||ag==="MeasureThickness"){var bY=au.owner.getMeasurable(2);var bW=(bZ.getMode()===s.Mode.EXACT&&ag!=="MeasureThickness")?"circle":"square";var bT=(bY.getMode()===s.Mode.EXACT&&ag!=="MeasureThickness")?"circle":"square";var cl=(bZ.getMode()===s.Mode.EXACT&&bY.getMode()===s.Mode.EXACT)?"circle":"square";if(ag==="MeasureBetween"){var bV=au.owner.getAttribute("vAngleArcCenter");var bA=au.owner.getAttribute("vAngleVector1");var bz=au.owner.getAttribute("vAngleVector2");if(bV&&au.owner.getAttribute("vAnglePointingPoint")&&bA&&bz){var cd=bV.clone().add(bA);aD(Q,y.createLineNode(bV,cd,ad.regularDashedLine));var cc=bV.clone().add(bz);var bK=y.createLineNode(bV,cc,ad.regularDashedLine);aD(Q,bK)}}if((au.owner.getAttribute("sResultingType1")===g.ResultType.AXIS)||(au.owner.getAttribute("sResultingType1")===g.ResultType.PLANE)){if(!aK&&ag!=="MeasureBetween"){aC(Q,T,bZ,au.owner.getAttribute("sResultingType1"),au.owner.getAttribute("vFirstExtensionPoint3D"),bn)}}else{if((au.owner.getAttribute("sResultingType1")===g.ResultType.CURVE)&&(bZ.getType()===s.GeometryType.LINE)){if(ag!=="MeasureBetween"){aC(Q,T,bZ,g.ResultType.LINE,au.owner.getAttribute("vFirstExtensionPoint3D"),bn)}}}if((au.owner.getAttribute("sResultingType2")===g.ResultType.AXIS)||(au.owner.getAttribute("sResultingType2")===g.ResultType.PLANE)){if(!aK&&ag!=="MeasureBetween"){aC(Q,G,bY,au.owner.getAttribute("sResultingType2"),au.owner.getAttribute("vSecondExtensionPoint3D"),bn)}}else{if((au.owner.getAttribute("sResultingType2")===g.ResultType.CURVE)&&(bY.getType()===s.GeometryType.LINE)){if(ag!=="MeasureBetween"){aC(Q,G,bY,g.ResultType.LINE,au.owner.getAttribute("vSecondExtensionPoint3D"),bn)}}}if(Z&&ag!=="MeasureBetween"){var cr=(ag==="MeasureThickness")?ad.avatarDashedLine:ad.regularDashedLine;var by=ak(au.owner.getAttribute("vFirstExtensionPoint3D"),au.owner.getAttribute("vSecondExtensionPoint3D"),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color,cr,bW,bT);aD(am,by)}else{if(!aK&&ag!=="MeasureBetween"){var b0=aM(au.owner.getAttribute("vFirstExtensionPoint3D"),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color,bW);b0.setVisibility(a0);aD(am,b0)}else{if(aL&&ag==="MeasureBetween"&&au.owner.getAttribute("sResultingType1")===g.ResultType.POINT&&au.owner.getAttribute("sResultingType2")===g.ResultType.POINT){if(bZ.getType()!==s.GeometryType.POINT){var b0=aM(au.owner.getAttribute("vFirstExtensionPoint3D"),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color,bW);b0.setVisibility(a0);aD(am,b0)}if(bY.getMode()!==s.GeometryType.POINT){var aV=aM(au.owner.getAttribute("vSecondExtensionPoint3D"),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color,bW);aV.setVisibility(a0);aD(am,aV)}}}}if(ag==="MeasureThickness"){aD(Q,y.createCircleNode(2.5,bZ.getSelPoint(),bZ.getSelNormal(),ad.avatarSolidLine))}}else{if(ag==="MeasureItem"){var bu=(bZ.getMode()===s.Mode.EXACT)?"circle":"square";switch(au.owner.getAttribute("sResultingType1")){case g.ResultType.POINT:if(aL&&(bZ.getType()!==s.GeometryType.POINT)){var b0=aM(au.owner.getAttribute("vFirstExtensionPoint3D"),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color,bu);b0.setVisibility(a0);aD(am,b0)}case g.ResultType.CENTER:break;case g.ResultType.LINE:aP(Q,T,bZ,au.owner.getAttribute("sResultingType1"),ad.avatarSolidLine,bn);var b0=aM(au.owner.getAttribute("vFirstExtensionPoint3D"),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color,bu);b0.setVisibility(a0);aD(am,b0);var aV=aM(au.owner.getAttribute("vSecondExtensionPoint3D"),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color,bu);aV.setVisibility(a0);aD(am,aV);break;case g.ResultType.AXIS:aP(Q,T,bZ,au.owner.getAttribute("sResultingType1"),ad.avatarDashedLine,bn);break;case g.ResultType.CIRCLE:aP(Q,T,bZ,au.owner.getAttribute("sResultingType1"),ad.avatarSolidLine,bn);var by=ak(au.owner.getAttribute("vFirstExtensionPoint3D"),au.owner.getAttribute("vSecondExtensionPoint3D"),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color,ad.regularDashedLine);aD(am,by);break;case g.ResultType.CURVE:var bp=bZ.getPoints();var aZ=aM(bp.beginPoint.clone(),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color);var cp=aM(bp.endPoint.clone(),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color);aD(am,aZ);aD(am,cp);break;case g.ResultType.PLANE:aP(Q,T,bZ,au.owner.getAttribute("sResultingType1"),ad.avatarSolidLine,bn);break;case g.ResultType.CYLINDER:aP(Q,T,bZ,au.owner.getAttribute("sResultingType1"),ad.avatarSolidLine,bn);var a4=J(au.owner.getAttribute("vFirstPoint3D"),au.owner.getAttribute("vSecondPoint3D"),au.owner.getAttribute("vLeaderBreakPoint3D"),false,au.owner.getAttribute("bRadiusDisplay"),ad.regularSolidLine,bn);aD(Q,a4);break;case g.ResultType.CONE:aP(Q,T,bZ,au.owner.getAttribute("sResultingType1"),ad.avatarSolidLine,bn);var a4=J(au.owner.getAttribute("vFirstPoint3D"),au.owner.getAttribute("vSecondPoint3D"),au.owner.getAttribute("vLeaderBreakPoint3D"),false,au.owner.getAttribute("bRadiusDisplay"),ad.regularSolidLine,bn);aD(Q,a4);var bp=bZ.getPoints();var cn=au.owner.getAttribute("vApex");var b4=bp.beginPoint.clone().sub(cn).length()/bp.endPoint.clone().sub(cn).length();var b9=au.owner.getAttribute("vFirstPoint3D").clone().sub(cn).multiplyScalar(b4).add(cn);var b7=au.owner.getAttribute("vSecondPoint3D").clone().sub(cn).multiplyScalar(b4).add(cn);a4=J(b9,b7,au.owner.getAttribute("vLeaderBreakPoint3D"),false,au.owner.getAttribute("bRadiusDisplay"),ad.regularSolidLine,bn);aD(Q,a4);break;case g.ResultType.SPHERE:aP(Q,T,bZ,au.owner.getAttribute("sResultingType1"),ad.avatarSolidLine,bn);var a4=J(au.owner.getAttribute("vFirstPoint3D"),au.owner.getAttribute("vSecondPoint3D"),au.owner.getAttribute("vLeaderBreakPoint3D"),false,au.owner.getAttribute("bRadiusDisplay"),ad.regularSolidLine,bn);aD(Q,a4);break;case g.ResultType.SURFACE:break;case g.ResultType.PRODUCT:T=ay(au.owner.getAttribute("aabb"),ad.avatarSolidLine,ad.avatarDashedLine);aD(Q,T);break;default:break}}else{if(ag==="Measure3PointsCircle"){var bY=au.owner.getMeasurable(2);var bX=au.owner.getMeasurable(3);var bu=(bZ.getMode()===s.Mode.EXACT&&bY.getMode()===s.Mode.EXACT&&bX.getMode()===s.Mode.EXACT)?"circle":"square";var b3=y.createCircleNode(au.owner.getAttribute("fRadius"),au.owner.getAttribute("vCenter"),au.owner.getAttribute("vNormal"),ad.avatarSolidLine);aD(Q,b3);var bc=10;var ci=y.createCrossNode(bc,au.owner.getAttribute("vCenter"),au.owner.getAttribute("vNormal"),ad.avatarSolidLine);aD(Q,ci);var by=ak(au.owner.getAttribute("vFirstExtensionPoint3D"),au.owner.getAttribute("vSecondExtensionPoint3D"),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color,ad.regularDashedLine,bu,bu);aD(am,by)}else{if(ag==="Measure3PointsAngle"){var bY=au.owner.getMeasurable(2);var bX=au.owner.getMeasurable(3);var ct="circle";aD(Q,y.createLineNode(bZ.getSelPoint(),bY.getSelPoint(),ad.regularDashedLine));aD(Q,y.createLineNode(bX.getSelPoint(),bY.getSelPoint(),ad.regularDashedLine));var b0=aM(bZ.getSelPoint(),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color,ct);b0.setVisibility(a0);aD(am,b0);var aV=aM(bY.getSelPoint(),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color,ct);aV.setVisibility(a0);aD(am,aV);var bx=aM(bX.getSelPoint(),bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,bn.fillStyle.color,ct);bx.setVisibility(a0);aD(am,bx)}}}}}var ca=an("ShortDisplay","bool");var cg=an("IsFilled","bool");var bi=an("HasBorder","bool");var a3=an("HasALeader","bool");var cq=an("FontColor","Color");var bN=an("FontName","string");var bL=K.getPixelFontSize("fFontSize");var bk=(bL===undefined)||((W.FontSize!==undefined)&&(bL===W.FontSize));if(!bk){W.FontSize=bL}var bk=an("FontSize","float");var b2=an("Opacity","float");if(!ah){ah=false}var ch=(ah===au.owner.isInEdition());ah=au.owner.isInEdition();if(!aS||!bs||!ca||!a6||!bQ||!bh||!bS||!bC||!cg||!bi||!a3||!cq||!bN||!bk||!b2||!aR||!ch){bj=false;R.setVisibility(Z);if(au.owner._bCreateMeasureInShowSpace===0){if(Z){R.setVisibility(!Z)}else{R.setVisibility(Z);R.setVisibilityFree(!Z)}}else{if(au.owner._bCreateMeasureInShowSpace===1){R.setVisibility(Z);R.setVisibilityFree(!Z)}}if(Z||!aK||!ch){aH();R.modify({content:ar(au.owner.getAttribute("bShortDisplay"),ag,au.owner.getAttribute("fDistance")),commentContent:au.owner.getAttribute("sCommentOnMeasure"),position:au.owner.getAttribute("vLeaderBreakPoint3D"),isFilled:au.owner.getAttribute("bIsFilled"),hasBorder:au.owner.getAttribute("bHasBorder"),graphicProperties:bn,inEdition:au.owner.isInEdition()});Y()}aE.setVisibility(aK);if(au.owner._bCreateMeasureInShowSpace===0){if(aK){aE.setVisibility(!aK)}else{aE.setVisibility(aK)}aE.setVisibilityFree(!aK)}else{if(au.owner._bCreateMeasureInShowSpace===1){aE.setVisibility(aK);aE.setVisibilityFree(!aK)}}if(aK){aH();aE.modify({content:X(au.owner.getAttribute("bShortDisplay"),ag,au.owner.getAttribute("fAngle"),!Z),position:au.owner.getAttribute("vAngleBreakPoint"),isFilled:au.owner.getAttribute("bIsFilled"),hasBorder:au.owner.getAttribute("bHasBorder"),graphicProperties:bn});Y()}}if(!aS||!bj){if(Z||!aK){aH();R.modify({position:au.owner.getAttribute("vLeaderBreakPoint3D")});Y()}}if(!aS||!bF){if(aK){aH();aE.modify({position:au.owner.getAttribute("vAngleBreakPoint")});Y()}}if(!aS||!bC||!bj||!bU||!bh){if(Z||!aK){var bt=1;if(ag==="MeasureBetween"||ag==="MeasureThickness"||ag==="Measure3PointsCircle"){bt=0}else{if(ag==="MeasureItem"){var aY=au.owner.getAttribute("sResultingType1");switch(au.owner.getAttribute("sResultingType1")){case g.ResultType.CYLINDER:case g.ResultType.CONE:case g.ResultType.SPHERE:case g.ResultType.LINE:bt=0;break;case g.ResultType.CIRCLE:if(!au.owner.getAttribute("bRadiusDisplay")){bt=0}break;default:break}}}B.modifyLeaderNode(au.viewer,U,!ai(),au.owner.getAttribute("vLeaderBreakPoint3D"),au.owner.getAttribute("vLeaderPointingPoint3D"),undefined,bn.leaderStyle&&bn.leaderStyle.thickness!==undefined?bn.leaderStyle.thickness:bn.lineStyle.thickness,bn.leaderStyle&&bn.leaderStyle.color?bn.leaderStyle.color:bn.lineStyle.color,null,bt,R.getDimensions(),au.frmWindow)}else{U.removeChildren()}}var b5=!au.owner.getAttribute("bCollapsedDisplay");var a2=(au.owner._bCreateMeasureInShowSpace===1)?b5:!b5;Q.setVisibility(a2);aA.setVisibility(a2);ae.setVisibility(a2);U.setVisibility(a2);if(R&&R.isVisible()&&!b5){R.setVisibility(b5)}if(aE&&aE.isVisible()&&!b5){aE.setVisibility(b5)}if(R&&au.owner._bCreateMeasureInShowSpace===1){R.setVisibilityFree(!R.isVisible())}if(aE&&au.owner._bCreateMeasureInShowSpace===1){aE.setVisibilityFree(!aE.isVisible())}K.setVisibility(au.owner.getAttribute("bVisible"));K.setName(au.owner.getAttribute("sName"));if(!aS){if(ag==="MeasureBetween"){K.setIcon(c.getWebappsAssetUrl("DMUBaseUI","icons/32/I_WebMeasureBetween.png"))}else{if(ag==="MeasureItem"){K.setIcon(c.getWebappsAssetUrl("DMUBaseUI","icons/32/I_WebMeasureItem.png"))}else{K.setIcon(c.getWebappsAssetUrl("DMUBaseUI","icons/32/I_WebMeasureItem.png"))}}}K.highlightIfNeeded();au.viewer.render()};this.setMeasureClippingControlPoints=function(){if(aO){this.removeClippingControlPoints(aO)}if(ai()){aO=this.setClippingControlPoints([au.owner.getAttribute("vFirstExtensionPoint3D"),au.owner.getAttribute("vSecondExtensionPoint3D")])}else{if(ag==="MeasureItem"){switch(au.owner.getAttribute("sResultingType1")){case g.ResultType.POINT:case g.ResultType.CENTER:case g.ResultType.CURVE:case g.ResultType.PLANE:case g.ResultType.SURFACE:case g.ResultType.PRODUCT:aO=this.setClippingControlPoints([au.owner.getAttribute("vFirstExtensionPoint3D")]);break;case g.ResultType.AXIS:aO=this.setClippingControlPoints([au.owner.getAttribute("vLeaderPointingPoint3D")]);break;case g.ResultType.CYLINDER:case g.ResultType.CONE:case g.ResultType.SPHERE:aO=this.setClippingControlPoints([au.owner.getAttribute("vLeaderBreakPoint3D")]);break;default:break}}else{if(ag==="Measure3PointsAngle"){aO=this.setClippingControlPoints([au.owner.getAttribute("vAngleArcCenter")])}}}};this.onViewerEventCB=function(aQ){if(!ai()&&(aQ.eventType==="@onWindowResized"||aQ.eventType==="@onViewpointChange")){if(W.LeaderBreakPoint3D){W.LeaderBreakPoint3D.x=W.LeaderBreakPoint3D.x-1}K.update()}else{if(aQ.eventType==="beginExplodeCmd"||aQ.eventType==="endExplodeCmd"){au.owner.setAttribute("bVisible",aQ.eventType==="endExplodeCmd");K.update()}}};this.removeDMUNode3DOverload=function(){if(aO){K.removeClippingControlPoints(aO);aO=null}K=ad=W=T=G=R=aE=Q=null;am=aA=ae=U=null};this.update(true)},remove:function(){if(this.removeDMUNode3DOverload){this.removeDMUNode3DOverload()}}});return z});define("DS/DMUPlayMeasure/DMUMeasure",["DS/DMUBaseReview/DMUOverloadableObject","DS/DMUMeasurable/DMUMeasureEnums","DS/DMUMeasurable/DMUMeasurable","DS/DMUMeasurable/DMUToolsMeasure","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseExperience/EXPUtils","DS/CoreEvents/ModelEvents","DS/Visualization/ThreeJS_DS","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUBaseExperience/DMUContextManager","DS/Visualization/SubElement","DS/DMUMeasurable/DMUToolsInterference","DS/DMUMarkupsController/DMUMarkupsController","DS/DMUPlayMeasure/DMUMeasureNode3D","DS/DMUPlayMeasure/DMUMeasureImport","DS/Selection/CSOManager","DS/DMUBaseUI/DMUInitialization","i18n!DS/DMUPlayMeasure/assets/nls/DMUPlayMeasure"],function(c,g,n,o,h,i,l,e,b,p,v,j,w,s,m,d,t,r,u,f,k){var q=[{name:"sType",type:"string",JSONname:"Specifications.Type"},{name:"sSelectedType1",type:"int",JSONname:"Specifications.SelectedType1"},{name:"sSelectedType2",type:"int",JSONname:"Specifications.SelectedType2"},{name:"sResultingType1",type:"int",JSONname:"Results.ResultingType1"},{name:"sResultingType2",type:"int",JSONname:"Results.ResultingType2"},{name:"oProduct1Name",type:"string",JSONname:"Results.Product1Name"},{name:"oProduct2Name",type:"string",JSONname:"Results.Product2Name"},{name:"fDistance",type:"float",JSONname:"Results.Distance"},{name:"fAngle",type:"float",JSONname:"Results.Angle",isOverloadable:true},{name:"fProjectedAngleXY",type:"float",JSONname:"Results.ProjectedAngleXY",isOverloadable:false},{name:"fProjectedAngleYZ",type:"float",JSONname:"Results.ProjectedAngleYZ",isOverloadable:false},{name:"fProjectedAngleZX",type:"float",JSONname:"Results.ProjectedAngleZX",isOverloadable:false},{name:"vPosition",type:"Vector3",JSONname:"Results.Position"},{name:"vCenter",type:"Vector3",JSONname:"Results.Center"},{name:"vNormal",type:"Vector3",JSONname:"Results.Normal"},{name:"vCog",type:"Vector3",JSONname:"Results.Cog"},{name:"fLength",type:"float",JSONname:"Results.Length"},{name:"fRadius",type:"float",JSONname:"Results.Radius"},{name:"fArea",type:"float",JSONname:"Results.Area"},{name:"vApex",type:"Vector3",JSONname:"Results.Apex"},{name:"fSemiAngle",type:"float",JSONname:"Results.SemiAngle"},{name:"fVolume",type:"float",JSONname:"Results.Volume"},{name:"bHasALeader",type:"bool",JSONname:"Properties3DText.HasALeader",defaultValue:true,isOverloadable:true},{name:"vLeaderBreakPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderBreakPoint3D",isOverloadable:true},{name:"vLeaderPointingPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderPointingPoint3D",isOverloadable:true},{name:"bShortDisplay",type:"bool",JSONname:"PropertiesMeasure.Shortdisplay",defaultValue:true,isOverloadable:true},{name:"vFirstPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.FirstPoint3D",isOverloadable:true},{name:"vSecondPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.SecondPoint3D",isOverloadable:true},{name:"vFirstExtensionPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.FirstExtensionPoint3D",isOverloadable:true},{name:"vSecondExtensionPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.SecondExtensionPoint3D",isOverloadable:true},{name:"vExtensionDirection3D",type:"Vector3",JSONname:"PropertiesMeasure.ExtensionDirection3D",isOverloadable:true},{name:"bRadiusDisplay",type:"bool",JSONname:"PropertiesMeasure.Radiusdisplay",defaultValue:false,isOverloadable:true},{name:"bCollapsedDisplay",type:"bool",JSONname:"PropertiesMeasure.Collapseddisplay",defaultValue:false,isOverloadable:true},{name:"vAngleBreakPoint",type:"Vector3",JSONname:"PropertiesMeasure.AngleBreakPoint",isOverloadable:true},{name:"fQuadrant",type:"float",JSONname:"PropertiesMeasure.Quadrant",isOverloadable:true},{name:"vAngleArcCenter",type:"Vector3",JSONname:"PropertiesMeasure.AngleArcCenter",isOverloadable:true},{name:"vAnglePointingPoint",type:"Vector3",JSONname:"PropertiesMeasure.AnglePointingPoint",isOverloadable:true},{name:"vAngleVector1",type:"Vector3",JSONname:"PropertiesMeasure.AngleVector1",isOverloadable:true},{name:"vAngleVector2",type:"Vector3",JSONname:"PropertiesMeasure.AngleVector2",isOverloadable:true},{name:"aabb",type:"AABB",JSONname:"PropertiesMeasure.aabb",isOverloadable:true},{name:"bVisible",type:"bool",JSONname:"PropertiesMarkerBase.Visible",defaultValue:true,isOverloadable:true},{name:"bIsFilled",type:"bool",JSONname:"PropertiesMarkerBase.IsFilled",defaultValue:true,isOverloadable:true},{name:"bHasBorder",type:"bool",JSONname:"PropertiesMarkerBase.HasBorder",defaultValue:false,isOverloadable:true},{name:"fFontSize",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.fontSize",defaultValue:3.5,isOverloadable:true},{name:"sFontName",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyName",defaultValue:"sans-serif",isOverloadable:true},{name:"sFontStyle",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyStyle",defaultValue:"normal",isOverloadable:true},{name:"cFontColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.color",defaultValue:new v.Color("#ffffff"),isOverloadable:true},{name:"cFillStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.color",defaultValue:new v.Color("#368ec4"),isOverloadable:true},{name:"fOpacity",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.opacity",defaultValue:1,isOverloadable:true},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",defaultValue:1,isOverloadable:true},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",defaultValue:"1",isOverloadable:true},{name:"cLineStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.color",defaultValue:new v.Color("#3d3d3d"),isOverloadable:true},{name:"sLeaderStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.pattern",isOverloadable:true},{name:"fLeaderStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thickness",isOverloadable:true},{name:"cLeaderStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.color",isOverloadable:true},{name:"sCommentOnMeasure",type:"string",JSONname:"Comment.TextContents",isOverloadable:false},{name:"sCommentFontStyle",type:"string",JSONname:"Comment.GraphicProperties.FontStyle.familyStyle",isOverloadable:false},{name:"sCommentFontName",type:"string",JSONname:"Comment.GraphicProperties.FontStyle.familyName",isOverloadable:false},{name:"fCommentFontSize",type:"float",JSONname:"Comment.GraphicProperties.FontStyle.fontSize",isOverloadable:false},{name:"iFontSize",type:"int",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.height",isOverloadable:true}];var a=c.extend({init:function(z,y,x){this._parent(z,y);this._sExpType="DMUMeasure";this._parameters=this._parameters.concat(q);this.defineMembersFromParameters();this._type="DMUMeasure";this._typeApps=x;var A=this;this.getPixelFontSize=function(){if(A._nNode){return A._nNode.getPixelFontSize()}return undefined};this.measureCancel=function(){j.emptyCSO();A.remove();var C=w.getReviewContext({viewer:A._viewer});var B=C?C.getCurrentReview():null;if(B&&!B.getChildren("DMUMeasure").length&&!B.getChildren("DMUSection").length){f.stopSwitchExperience({viewer:A._viewer})}A._viewer.render()};this.buildNode=function(B){if(!A._nNode){A._nNode=new t({owner:A,viewer:A._viewer,frmWindow:A._frmWindow,bPreviewPickingPoint:B});A.addNodeInParentNode()}}},setAttribute:function(x,y){if(x==="fFontSize"){this.setAttribute("iFontSize",null)}this._parent(x,y)},updateGlobalRadiusPreference:function(y){var x;if(y===true){x="DisplayRadius"}else{x="DisplayDiameter"}switch(this.getAttribute("sResultingType1")){case g.ResultType.CIRCLE:localStorage.setItem("DMUMeasureCircleRadiusPreferences",x);break;case g.ResultType.CYLINDER:localStorage.setItem("DMUMeasureCylinderRadiusPreferences",x);break;case g.ResultType.SPHERE:localStorage.setItem("DMUMeasureSphereRadiusPreferences",x);break}},initComponent:function(A){this._parent(A);var C=this;if(A&&A.appType){this._typeApps=A.appType}this._bCreateMeasureInShowSpace=this._viewer.getVisibleSpace();if(w.getAuthoringFeatureTypes().indexOf("Measure")!==-1){if(!this.ctxBarInitialized){this.ctxBarInitialized=true;var B="DS/DMUMeasure/DMUMeasureContextualBar";require([B],function(F){var D=new F();C.getContextualCommandList=D.getContextualCommandList;C.getSharedContextualCommandList=D.getSharedContextualCommandList;C.getSharedHeaderTypes=D.getSharedHeaderTypes;D.register({frmWindow:C._frmWindow});var E=u.get().length===1?u.get()[0].pathElement.clone():null;if(E&&E.getLastElement(true).getDMUType&&E.getLastElement(true)===C._nNode){u.empty();u.add({pathElement:E})}})}var y="DS/DMUMeasure/DMUMeasureExport";require([y],function(E){var D=new E(C);C.exportData=D.exportData})}var z=new r(C);this.importData=z.importData;this.afterImport=z.afterImport;var x=d.getDMUMarkupsController({context:this._viewer});if(x){x.registerMarker(this)}},getMeasurable:function(x){return this["_sMeasurable"+x]},setMeasurable:function(H,I){var G=this;var B=this["_sMeasurable"+H];if(B){var A=this["_sMeasurableNode"+H];var J=this["_sMeasurableToken"+H];for(var F=0;F<A.length;F++){A[F].modelEvents.unsubscribe(J[F])}}this["_sMeasurable"+H]=I;if(I){var A=[];var J=[];var x=I.getPathElement();var E=I.getLevel();var D=(E)?h.truncatePathElement(x,E).externalPath:x.externalPath;var z={event:"move"};this.updateAfterEvent=function(){G.update()};for(var C=0;C<D.length;C++){var y=D[C];if(h.isInstance(y)){if(y.modelEvents===undefined){y.modelEvents=new p()}A.push(y);J.push(y.modelEvents.subscribe(z,this.updateAfterEvent))}}this["_sMeasurableNode"+H]=A;this["_sMeasurableToken"+H]=J}},remove:function(){this._parent();if(this._paneltop){this._paneltop.destroy()}if(this._nNode){this._nNode.remove();this._nNode=undefined}this.setMeasurable(1,undefined);this.setMeasurable(2,undefined);this.setMeasurable(3,undefined);if(this._lockedNodes){var y=w.getContextViewer({viewer:this._viewer});if(y.getController){y.getController().unlockNodes({ids:this._lockedNodes})}this.clearLockedNodes()}var x=d.giveDMUMarkupsController({context:this._viewer});if(x){x.unregisterMarker(this)}d.unreferenceDMUMarkupsController({context:this._viewer})},refreshNode:function(z,y,x){if(this._nNode){this._nNode.update(z,y,x)}},setClippingControlPoints:function(){if(this._nNode){this._nNode.setMeasureClippingControlPoints()}},update:function(){var z=[];if(this._sType==="MeasureItem"){var y=[];var J=o.measureItem(this._sMeasurable1,this.getAttribute("sSelectedType1"),true);y.push({attribute:"vLeaderPointingPoint3D",value:J.position});y.push({attribute:"vLeaderBreakPoint3D",value:J.position});this._oProduct1=J.product;z.push(this._oProduct1);switch(this._sResultingType1){case g.ResultType.POINT:case g.ResultType.PICKINGPT:case g.ResultType.CENTER:y.push({attribute:"vPosition",value:J.position});break;case g.ResultType.LINE:case g.ResultType.AXIS:case g.ResultType.CURVE:if(this._sMeasurable1._type===l.GeometryType.CIRCLE){y.push({attribute:"fLength",value:J.arcLength})}else{y.push({attribute:"fLength",value:J.length})}break;case g.ResultType.CIRCLE:y.push({attribute:"fRadius",value:J.radius});y.push({attribute:"vCenter",value:J.center});y.push({attribute:"vNormal",value:J.normal});break;case g.ResultType.PLANE:y.push({attribute:"vOrigin",value:J.origin});y.push({attribute:"vNormal",value:J.normal});y.push({attribute:"fArea",value:J.area});y.push({attribute:"vCog",value:J.cog});break;case g.ResultType.CYLINDER:y.push({attribute:"fRadius",value:J.radius});y.push({attribute:"fArea",value:J.area});y.push({attribute:"vCog",value:J.cog});this._vPoint1=J.point1;this._vPoint2=J.point2;this._vAxis=J.point2.clone().sub(J.point1);var A=this._vPoint1.clone().add(this._vPoint2).multiplyScalar(0.5);y.push({attribute:"vCenter",value:A});this._sMeasurable1.center=A.clone();this._sMeasurable1.normal=this._vAxis.clone();break;case g.ResultType.CONE:y.push({attribute:"vApex",value:J.apex});y.push({attribute:"fSemiAngle",value:J.semiAngle});y.push({attribute:"fArea",value:J.area});y.push({attribute:"vCog",value:J.cog});this._vPoint1=J.point1;this._vPoint2=J.point2;this._vAxis=J.axis;y.push({attribute:"vCenter",value:this._vPoint2.clone()});break;case g.ResultType.SPHERE:y.push({attribute:"fRadius",value:J.radius});y.push({attribute:"vCenter",value:J.center});y.push({attribute:"fArea",value:J.area});y.push({attribute:"vCog",value:J.cog});break;case g.ResultType.SURFACE:y.push({attribute:"fArea",value:J.area});y.push({attribute:"vCog",value:J.cog});break;case g.ResultType.PRODUCT:y.push({attribute:"fVolume",value:J.volume});y.push({attribute:"fArea",value:J.area});y.push({attribute:"vCog",value:J.cog});y.push({attribute:"aabb",value:J.aabb});break;default:break}this.set(y);this._buildConstructionData(J)}else{if(this._sType==="MeasureBetween"){var y=[];var J=o.measureBetween(this._sMeasurable1,this.getAttribute("sSelectedType1"),this._sMeasurable2,this.getAttribute("sSelectedType2"));this._oProduct1=J.product1;z.push(this._oProduct1);this._oProduct2=J.product2;z.push(this._oProduct2);this._duration=J.duration;y.push({attribute:"fDistance",value:(J.distance!==undefined)?J.distance:0});var F=(J.angle!==undefined)?J.angle:0;y.push({attribute:"fAngle",value:F});if((F!==undefined)&&!i.isZero(F)){y.push({attribute:"fQuadrant",value:0})}this.set(y);this._buildConstructionData(J)}else{if(this._sType==="MeasureThickness"){var y=[];var C=this._sMeasurable1.getSelPoint();var D=this._sMeasurable1.getSelNormal();var L=D.clone().negate();var I=D.clone().normalize().multiplyScalar(0.1).add(C);var E=m.computeRayProductInterferences(I.toArray(),L.toArray(),[this._sMeasurable1.getPathElement()]);var B=[];if(E.returnCode===0){B=E.aIntersections}var H=THREEDS.SubElement.getFromSGNode(B[0].primitive);var O=(H.getBodyDimension()===3);var N;var G=function(T,Q){var P=new v.Matrix4();P.getInverse(Q.getWorldMatrix());var S=T.point.clone();S.applyMatrix4(P);var R={type:l.GeometryType.POINT,primitive:T.primitive,position:S};return new n({canonic:R,pathElement:Q})};if(O){N=G(B[1],this._sMeasurable1.getPathElement())}else{N=this._sMeasurable1.clone()}this.setMeasurable(2,N);y.push({attribute:"sSelectedType1",value:g.ViewedType.POINT});y.push({attribute:"sSelectedType2",value:g.ViewedType.POINT});y.push({attribute:"sResultingType1",value:g.ResultType.POINT});y.push({attribute:"sResultingType2",value:g.ResultType.POINT});var J=o.measureBetween(this._sMeasurable1,g.ViewedType.POINT,this._sMeasurable2,g.ViewedType.POINT);this._oProduct1=J.product1;z.push(this._oProduct1);this._oProduct2=J.product2;z.push(this._oProduct2);y.push({attribute:"fDistance",value:(J.distance!==undefined)?J.distance:0});y.push({attribute:"fAngle",value:0});this.set(y);this._buildConstructionData(J)}else{if(this._sType==="Measure3PointsCircle"){var y=[];var J=o.measureThreepoints(this._sMeasurable1,this._sMeasurable2,this._sMeasurable3);y.push({attribute:"fRadius",value:J.radius});y.push({attribute:"fAngle",value:J.angle});y.push({attribute:"vCenter",value:J.center.clone()});y.push({attribute:"vNormal",value:J.normal.clone()});this.set(y);J.position=J.center.clone();this._buildConstructionData(J)}else{if(this._sType==="Measure3PointsAngle"){var y=[];var J=o.measureThreepoints(this._sMeasurable1,this._sMeasurable2,this._sMeasurable3);y.push({attribute:"fRadius",value:J.radius});y.push({attribute:"fAngle",value:J.angle});y.push({attribute:"vCenter",value:J.center.clone()});y.push({attribute:"vNormal",value:J.normal.clone()});this.set(y);J.position=this._sMeasurable2.getSelPoint();this._buildConstructionData(J)}}}}}var K=this;if(z.length>0){var x=[0,1];for(var M=z.length-1;M>=0;M--){if((z[M].name!==undefined)&&(z[M].name.length>0)){K["_oProduct"+(M+1)+"Name"]=z[M].name;z.splice(M,1);x.splice(M,1)}}if(z.length>0){h.getName(z,function(R){var Q=R.length;for(var P=0;P<Q;P++){K["_oProduct"+(x[P]+1)+"Name"]=R[P]}K.refreshNode(false,true)},w.getContextViewer({viewer:this._viewer}),k.defaultname)}}this.refreshNode(false,true)},addLockedNode:function(x){if(this._lockedNodes===undefined){this._lockedNodes=[]}this._lockedNodes.push(x)},getLockedNodes:function(){return this._lockedNodes},isNodeLocked:function(y){var x=false;if(this._lockedNodes){if(this._lockedNodes.indexOf(y)!==-1){x=true}}return x},clearLockedNodes:function(){this._lockedNodes=[]},_buildConstructionData:function(L){var M=30;if(this._sType==="MeasureItem"){switch(this._sResultingType1){case g.ResultType.POINT:case g.ResultType.PICKINGPT:this._buildConstructionPointsForLeader(1.4*M,L.position);break;case g.ResultType.CENTER:this._buildConstructionPointsForLeader(1.4*M,L.center);break;case g.ResultType.LINE:this._buildConstructionPointsForDimension(M,L.point1,L.point2);break;case g.ResultType.AXIS:this._buildConstructionPointsForLeader(M,L.point1.clone().add(L.point2).multiplyScalar(0.5));break;case g.ResultType.CIRCLE:var y=[];var K=this.getAttribute("fRadius");var E=this.getAttribute("vNormal");M=K*0.2;var U=e.getViewpointInfo(this._viewer.currentViewpoint);var V=new v.Vector3().crossVectors(E,U.sight);if(V.length()>0.001){V.normalize().multiplyScalar(K)}else{V=U.right.clone().normalize().multiplyScalar(K)}var D=new v.Vector3().crossVectors(E,V).normalize();var T=Math.abs(E.angleTo(U.sight)-Math.PI/2)<Math.PI/10;var N;if(T){D=E.clone().normalize();if(D.dot(U.up)<0){D.negate()}N=D.clone().multiplyScalar(M)}else{N=D.clone().multiplyScalar(M+K)}var B=this.getAttribute("vCenter");var z=B.clone().add(V);var R=B.clone().sub(V);var G=z.clone().add(N);var F=R.clone().add(N);var W;if(this.getAttribute("bRadiusDisplay")){W=F.clone().sub(G).multiplyScalar(0.25).add(G)}else{W=G.clone().add(F).multiplyScalar(0.5)}y.push({attribute:"vLeaderBreakPoint3D",value:W});y.push({attribute:"vLeaderPointingPoint3D",value:W});y.push({attribute:"vFirstPoint3D",value:G});y.push({attribute:"vSecondPoint3D",value:F});y.push({attribute:"vFirstExtensionPoint3D",value:z});y.push({attribute:"vSecondExtensionPoint3D",value:R});y.push({attribute:"vExtensionDirection3D",value:D});this.set(y);break;case g.ResultType.PLANE:case g.ResultType.CURVE:case g.ResultType.SURFACE:this._buildConstructionPointsForLeader(M,L.position);break;case g.ResultType.CYLINDER:var K=this.getAttribute("fRadius");var B=this.getAttribute("vCenter");var U=e.getViewpointInfo(this._viewer.currentViewpoint);var V=new v.Vector3().crossVectors(this._vAxis,U.sight);if(V.length()>0.001){V.normalize().multiplyScalar(K)}else{V=U.right.clone().normalize().multiplyScalar(K)}var I=B.clone().add(V);var H=B.clone().sub(V);this._buildConstructionPointsForLeader(M,I,H);break;case g.ResultType.CONE:var C=this.getAttribute("vApex");var Z=this.getAttribute("fSemiAngle");var B=this.getAttribute("vCenter");var K=C.clone().sub(this._vPoint2).length()*Math.tan(Z);var U=e.getViewpointInfo(this._viewer.currentViewpoint);var V=new v.Vector3().crossVectors(this._vAxis,U.sight);if(V.length()>0.001){V.normalize().multiplyScalar(K)}else{V=U.right.clone().normalize().multiplyScalar(K)}var I=B.clone().add(V);var H=B.clone().sub(V);this._buildConstructionPointsForLeader(M,I,H);break;case g.ResultType.SPHERE:var K=this.getAttribute("fRadius");var B=this.getAttribute("vCenter");var U=e.getViewpointInfo(this._viewer.currentViewpoint);var V=U.right.clone().normalize().multiplyScalar(K);var I=B.clone().add(V);var H=B.clone().sub(V);this._buildConstructionPointsForLeader(M,I,H);this._sMeasurable1.normal=U.sight.clone();break;case g.ResultType.PRODUCT:this._buildConstructionPointsForLeader(M,this.getAttribute("vCog"));break;default:break}}else{if(this._sType==="MeasureBetween"||this._sType==="MeasureThickness"){var G;var F;if((this._sResultingType1===g.ResultType.PLANE)&&(this._sResultingType2===g.ResultType.PLANE)){if((this.getAttribute("fDistance")===0)&&(this.getAttribute("fAngle")!==0)){G=L.position2.clone();F=L.position1.clone()}else{var X=L.position1.clone().sub(L.position2);F=L.position2.clone().add(this._sMeasurable2.getSelPoint()).multiplyScalar(0.5);G=F.clone().add(X)}}else{G=L.position1.clone();F=L.position2.clone()}this._buildConstructionPointsForDimension(M,G,F,L.extensionDirection);if(this._sType==="MeasureBetween"){var y=[];var J=this.getAttribute("fAngle");var Y;var Q;var P;var O;if((J!==undefined)&&!i.isZero(J)){var z=this.getAttribute("vFirstExtensionPoint3D");var R=this.getAttribute("vSecondExtensionPoint3D");this.computeAngleVector=function(ab,ae,af,ag){var ah;if(ab===g.ResultType.AXIS){ah=ae.beginPoint.clone().sub(af);var ad=ah.length();var ac=ae.endPoint.clone().sub(af);var aa=ac.length();if((i.isZero(ad))||((aa<ad)&&!i.isZero(aa))){ah=ac}}else{ah=ag.clone().sub(af)}return ah};P=this.computeAngleVector(this._sResultingType1,this._sMeasurable1.getPoints(),z,this._sMeasurable1.getSelPoint());O=this.computeAngleVector(this._sResultingType2,this._sMeasurable2.getPoints(),R,this._sMeasurable2.getSelPoint());J=P.angleTo(O);var S=P.clone().add(O);var x=Math.min(P.length(),O.length())/2;Y=z.clone().add(R).multiplyScalar(0.5);Q=S.normalize().multiplyScalar(x).add(Y)}y.push({attribute:"fAngle",value:J});y.push({attribute:"vAngleArcCenter",value:Y});y.push({attribute:"vAnglePointingPoint",value:Q});y.push({attribute:"vAngleBreakPoint",value:Q});y.push({attribute:"vAngleVector1",value:P});y.push({attribute:"vAngleVector2",value:O});this.set(y)}}else{if(this._sType==="Measure3PointsCircle"){var y=[];var K=this.getAttribute("fRadius");var E=this.getAttribute("vNormal");var B=this.getAttribute("vCenter");y.push({attribute:"fAngle",value:0});var M=K*0.2;var U=e.getViewpointInfo(this._viewer.currentViewpoint);var V=new v.Vector3().crossVectors(E,U.sight);if(V.length()>0.001){V.normalize().multiplyScalar(K)}else{V=U.right.clone().normalize().multiplyScalar(K)}var D=new v.Vector3().crossVectors(E,V).normalize();var N=D.clone().multiplyScalar(M+K);var z=B.clone().add(V);var R=B.clone().sub(V);var G=z.clone().add(N);var F=R.clone().add(N);var W;if(this.getAttribute("bRadiusDisplay")){W=F.clone().sub(G).multiplyScalar(0.25).add(G)}else{W=G.clone().add(F).multiplyScalar(0.5)}y.push({attribute:"vExtensionDirection3D",value:D});y.push({attribute:"vFirstExtensionPoint3D",value:z});y.push({attribute:"vSecondExtensionPoint3D",value:R});y.push({attribute:"vFirstPoint3D",value:G});y.push({attribute:"vSecondPoint3D",value:F});y.push({attribute:"vLeaderBreakPoint3D",value:W});y.push({attribute:"vLeaderPointingPoint3D",value:W.clone()});this.set(y)}else{if(this._sType==="Measure3PointsAngle"){var y=[];y.push({attribute:"fDistance",value:0});var P=this._sMeasurable1.getSelPoint().sub(this._sMeasurable2.getSelPoint());var O=this._sMeasurable3.getSelPoint().sub(this._sMeasurable2.getSelPoint());var S=P.clone().add(O);var x=Math.min(P.length(),O.length())/2;var A=S.normalize().multiplyScalar(x).add(this._sMeasurable2.getSelPoint());J=P.angleTo(O);y.push({attribute:"fAngle",value:J});y.push({attribute:"vAngleVector1",value:P});y.push({attribute:"vAngleVector2",value:O});y.push({attribute:"vAngleArcCenter",value:this._sMeasurable2.getSelPoint()});y.push({attribute:"vAnglePointingPoint",value:A.clone()});y.push({attribute:"vAngleBreakPoint",value:A.clone()});y.push({attribute:"vLeaderBreakPoint3D",value:A.clone()});y.push({attribute:"vLeaderPointingPoint3D",value:A.clone()});y.push({attribute:"vFirstExtensionPoint3D",value:A.clone()});y.push({attribute:"vSecondExtensionPoint3D",value:A.clone()});y.push({attribute:"vFirstPoint3D",value:A.clone()});y.push({attribute:"vSecondPoint3D",value:A.clone()});this.set(y)}}}}},_buildConstructionPointsForLeader:function(y,D,B){var A=[];var z=e.getDistanceFromPixel(this._viewer,D,y,this._frmWindow);var C=e.getViewpointInfo(this._viewer.currentViewpoint);var x=C.up.clone().multiplyScalar(z);A.push({attribute:"vFirstExtensionPoint3D",value:D.clone()});A.push({attribute:"vFirstPoint3D",value:D.clone()});var E=D.clone();if(B!==undefined){A.push({attribute:"vSecondExtensionPoint3D",value:B.clone()});A.push({attribute:"vSecondPoint3D",value:B.clone()});E=D.add(B).multiplyScalar(0.5)}else{E=D.clone()}A.push({attribute:"vLeaderPointingPoint3D",value:E});A.push({attribute:"vLeaderBreakPoint3D",value:E.clone().add(x)});this.set(A)},_buildConstructionPointsForDimension:function(J,G,F,K){var C=[];var L=e.getDistanceFromPixel(this._viewer,G,J,this._frmWindow);var H=i.areEqual(G,F,"Vector3");var y=e.getViewpointInfo(this._viewer.currentViewpoint);var z;if(K){z=K.clone()}else{if(H){z=y.up.clone()}else{var x=G.clone().sub(F).normalize();z=new v.Vector3().crossVectors(x,y.sight);if(i.isZero(z.length())){z=y.up.clone()}}}z.normalize();var A=z.clone().multiplyScalar(L);if(A.dot(y.up)<0){A.negate()}var E;var I;var D;var B;if(H){E=G.clone();I=F.clone();D=E.clone().add(I).multiplyScalar(0.5);B=D.clone().add(A)}else{E=G.clone().add(A);I=F.clone().add(A);D=E.clone().add(I).multiplyScalar(0.5);B=D.clone()}C.push({attribute:"vExtensionDirection3D",value:z});C.push({attribute:"vFirstExtensionPoint3D",value:G.clone()});C.push({attribute:"vSecondExtensionPoint3D",value:F.clone()});C.push({attribute:"vFirstPoint3D",value:E});C.push({attribute:"vSecondPoint3D",value:I});C.push({attribute:"vLeaderBreakPoint3D",value:B});C.push({attribute:"vLeaderPointingPoint3D",value:D});this.set(C)},hideContextualBar:function(){if(this._itfContextbar){this._itfContextbar.clear()}},showContextualBar:function(){if(this._itfContextbar){this._itfContextbar.create()}},onViewerEventCB:function(x){if(this._nNode&&this._nNode.onViewerEventCB){this._nNode.onViewerEventCB(x)}},GetType:function(){return"DMUMeasure"}});return a});