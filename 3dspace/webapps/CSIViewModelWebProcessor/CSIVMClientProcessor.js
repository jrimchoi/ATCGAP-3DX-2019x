define("DS/CSIViewModelWebProcessor/CSIVMClientProcessor",["DS/CSIViewModelWebImplement/CSIVMClientModel","DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebProcessor/CSIVMClientTransactionOnIdent","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebProcessor/CSIVMClientViewParameter","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv"],function(g,a,e,c,f,b){var h=0;var d=function(k){var j=this;h=0;this._cbOnFatalError;this._cbOnVMUpdate={};this._delegateMap={};this._model=k;if(k===undefined){this._model=new g()}this._curTransactionMap={};b.activateNewCSIIdentification();f.prototype.declareType();this.onServerMessageWithOutCallback=function(m){var o=m.readObject("view","CSIViewParam");var l=m.readInt32("OperationType");var n=m.readString("rc");var p={Operation:l,rc:n,hasUpdatedView:false};if(o){p.hasUpdatedView=true;o.process(j)}return p};this.answerCallback=function(o,n){var m=j._cbOnVMUpdate.length;var p=undefined;for(var l in j._cbOnVMUpdate){p=j._cbOnVMUpdate[l];if(p!=undefined){p(o,n)}}};this.onServerMessage=function(l){var m;try{m=j.onServerMessageWithOutCallback(l)}catch(n){if(j._cbOnFatalError){j._cbOnFatalError(n)}}j.answerCallback(m,l);return true};var i=a.getDefaultResponse();i.onAnswerDomain("view",this.onServerMessage)};d.prototype.getModel=function(){return this._model};d.prototype.setNotifier=function(j,i){this._delegateMap[j]=i;return i};d.prototype.getNotifier=function(i){return this._delegateMap[i]};d.prototype.addCBOnVMUpdate=function(i){this._cbOnVMUpdate[h]=i;h++;return h};d.prototype.addCBOnFatalError=function(i){this._cbOnFatalError=i;return i};d.prototype.removeCBOnVMUpdate=function(i){if(this._cbOnVMUpdate[i-1]){this._cbOnVMUpdate[i-1]=undefined;delete this._cbOnVMUpdate[i-1]}};d.prototype.createTransaction=function(j){var k=undefined;var i=this._delegateMap[j.getViewType()];k=i.createTransaction(j);return k};d.prototype.createTransactionOnIdent=function(j){var k=new e();var i=this.createTransaction(j);k.setData(this._model,j,i,this);this._curTransactionMap[j.getUUID()]=k;return k};d.prototype.getTransactionOnIdent=function(i){return this._curTransactionMap[i.getUUID()]};d.prototype.deleteTransactionOnIdent=function(i){delete this._curTransactionMap[i.getUUID()]};d.prototype.getOrCreateTransactionOnIdent=function(i){var j=this.getTransactionOnIdent(i);if(j==undefined){j=this.createTransactionOnIdent(i)}return j};d.prototype.commit=function(j){if(j==undefined){for(var l in this._curTransactionMap){var i=this._curTransactionMap[l];i.commit()}this._curTransactionMap={}}else{var k=this.getTransactionOnIdent(j);if(k!=undefined){k.commit();this.deleteTransactionOnIdent(j)}}};d.prototype.abort=function(j){if(j==undefined){for(var l in this._curTransactionMap){var i=this._curTransactionMap[l];i.abort()}this._curTransactionMap={}}else{var k=this.getTransactionOnIdent(j);if(k!=undefined){k.abort();this.deleteTransactionOnIdent(j)}}};d.prototype.createOperation=function(i){var m=undefined;var l=[{_IdOperatedObject:true,_IdNewObject:true,_IdPreviousObject:false,_Attributes:false},{_IdOperatedObject:true,_GeometricalData:true,_IdNewObject:true,_Attributes:false},{_IdOperatedObject:true,_GeometricalData:true,_IdPattern:true,_MultipleViewElts:false},{_IdOperatedObject:true,_CustomData:true,_IdNewObject:true,_IdPreviousObject:false,_Attributes:false},{_IdOperatedObject:true,_ShortIdOperand:false,_GlobalIdOperand:false,_IdPreviousObject:false},{_IdOperatedObject:true,_GlobalIdOperand:true},{_IdOperatedObject:true,_GlobalIdOperand:true,_IdPreviousObject:false},{_IdOperatedObject:true,_GlobalIdOperand:true},{},{_IdOperatedObject:true,_CustomData:true},{_IdOperatedObject:true,_Groups:true},{_IdOperatedObject:true,_GraphicProperties:true},{_IdNewObject:true,_Attributes:false},{_IdOperatedObject:true,_SemanticData:true,_IdNewObject:true,_IdPreviousObject:false,_Attributes:false},{_IdOperatedObject:true,_SemanticData:true},{_IdNewObject:true,_SemanticData:true,_Attributes:false},{_IdOperatedObject:true,_Attributes:true}];var j=l[i._type-2];if(j!=undefined){m=new c();m._type=i._type}for(var k in j){if((j[k]==true)&&(i[k]==undefined)){m=undefined;break}else{if(i[k]!=undefined){m[k]=i[k]}}}return m};d.prototype.checkCompletedOperation=function(j){var m=j;var l=[{_OperatedObject:true,_IdNewObject:true,_PreviousObject:false,_Attributes:false},{_OperatedObject:true,_GeometricalData:true,_IdNewObject:true,_Attributes:false},{_OperatedObject:true,_GeometricalData:true,_IdPattern:true,_MultipleViewElts:false},{_OperatedObject:true,_CustomData:true,_IdNewObject:true,_PreviousObject:false,_Attributes:false},{_OperatedObject:true,_OperandObject:true,_PreviousObject:false},{_OperatedObject:true,_OperandObject:true},{_OperatedObject:true,_OperandObject:true,_PreviousObject:false},{_OperatedObject:true,_OperandObject:true},{},{_OperatedObject:true,_CustomData:true},{_OperatedObject:true,_Groups:true},{_OperatedObject:true,_GraphicProperties:true,_SubElement:false},{_IdNewObject:true,_SemanticData:false,_Attributes:false},{_OperatedObject:true,_SemanticData:true,_IdNewObject:true,_PreviousObject:false,_Attributes:false},{_OperatedObject:true,_SemanticData:true},{_IdNewObject:true,_SemanticData:true,_Attributes:false},{_OperatedObject:true,_Attributes:true}];var i=l[j._type-2];for(var k in i){if((i[k]==true)&&(j[k]==undefined)){m=undefined;break}}return m};d.prototype.clear=function(){this.abort();this._model=new g()};return d});