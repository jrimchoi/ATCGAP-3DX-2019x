define("DS/CSIViewModelWebProcessor/CSIVMClientIdPatternParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels"],function(b,e){function c(f){this._id=f.id||0;this._idSpace=f.idSpace||"";this._idContext=f.idContext||"";this._shared=!!f.shared}c.prototype.getId=function(){return this._id};c.prototype.getIdSpace=function(){return this._idSpace};c.prototype.getIdContext=function(){return this._idContext};c.prototype.getShared=function(){return this._shared};c.prototype.process=function(h){var g=h.getProcessor();var f=g.getModel();return f.getOrCreateIdPattern(this._idSpace,this._idContext,this._shared)};var d=function(){return false};var a=function(f){var g={id:f.readInt32(e.id),idSpace:f.readString(e.idSpace),idContext:f.readString(e.idContext),shared:f.readInt32(e.shared)};return new c(g)};c.prototype.declareType=function(){b.declareType({type:"CSIViewModelIdPattern",serialize:d,unserialize:a})};return c});define("DS/CSIViewModelWebProcessor/CSIVMClientTransactionOnIdent",["DS/CSIViewModelWebImplement/CSIVMClientObject","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey"],function(e,d,c,a){function b(){}b.prototype.setData=function(h,g,i,f){this._nameSpace=h.getOrCreateNameSpace(g);this._createdObjects={};this._createCells=[];this._reusedObjects={};this._shortIdsToDualIds={};this._IdsObjIsEmpty=true;this._treeKey=g;this._viewTransac=i;this._Processor=f;this._errManager=h.getErrorManager()};b.prototype.getTreatedObject=function(f){var g=this._createdObjects[f];if(g==undefined){g=this._reusedObjects[f]}return g};b.prototype.completeOperationWithObjects=function(s){this._errManager.addContext({name:"completeOperationWithObjects","arguments":arguments});var m=s.getType();if(s._IdOperatedObject!=undefined){var l=undefined;if(s._IdOperatedObject._ShortId!=undefined){l=this.getTreatedObject(s._IdOperatedObject._ShortId)}else{if(s._IdOperatedObject._GlobalId!=undefined){var t=this._nameSpace.decodeGlobalId({Node:null,Id:s._IdOperatedObject._GlobalId});if(m==d.prototype.OperationType.ApplyGP||m==d.prototype.OperationType.AddExistingCell){if(t==undefined||t.length==0){t=this._nameSpace.decodeGlobalIdInternal({Node:null,Id:s._IdOperatedObject._GlobalId,State:e.prototype.stateMode.TempoOrPermanent})}var w=t[t.length-1];if(w.isLeaf(this._treeKey)&&w.getIdPattern()._shared&&t.length>1){var g=t[t.length-2];if(g.getIdPattern()._idContext==w.getIdPattern()._idContext){l=g;s._SubElement=w.getAssociatedViewElt(this._treeKey)}else{l=w}}else{l=w}}else{if(t!=undefined&&t.length!=0){l=t[t.length-1]}}}}if(s._IdOperatedSubElements!==undefined){var o=l.getMappedChildren(this._treeKey,e.prototype.stateMode.TempoOrPermanent);if(o!=undefined){var x,u,q;var v=s._IdOperatedSubElements.length;for(x=0;x<v;++x){u=s._IdOperatedSubElements[x];q=o.get(u);if(q!==undefined){s._OperatedSubElements.push(q.getAssociatedViewElt(this._treeKey))}}}if(v&&!s._OperatedSubElements.length){s._type=d.prototype.OperationType.UnknownType}s._IdOperatedSubElements=undefined}s._OperatedObject=l.getAssociatedViewElt(this._treeKey);s._IdOperatedObject=undefined}if(s._ShortIdOperand!=undefined){if(m==d.prototype.OperationType.AddExistingNode){var h=this.getTreatedObject(s._ShortIdOperand);h.getAssociatedViewElt(this._treeKey);s._OperandObject=h.getAssociatedViewElt(this._treeKey);s._ShortIdOperand=undefined}}if(s._GlobalIdOperand!=undefined){var h=undefined;var t=this._nameSpace.decodeGlobalId({Node:null,Id:s._GlobalIdOperand});if(m==d.prototype.OperationType.RemoveExistingCell||m==d.prototype.OperationType.AddExistingCell){if(t==undefined||t.length==0){t=this._nameSpace.decodeGlobalIdInternal({Node:null,Id:s._GlobalIdOperand,State:e.prototype.stateMode.TempoOrPermanent})}}if(t!=undefined&&t.length!=0){h=t[t.length-1]}s._OperandObject=h.getAssociatedViewElt(this._treeKey);s._GlobalIdOperand=undefined}if(s._IdPreviousObject!=undefined){var n=undefined;if(s._IdPreviousObject._ShortId!=undefined){n=this.getTreatedObject(s._IdPreviousObject._ShortId)}else{if(s._IdPreviousObject._GlobalId!=undefined){var t=this._nameSpace.decodeGlobalId({Node:null,Id:s._IdPreviousObject._GlobalId});if(t!=undefined&&t.length!=0){n=t[t.length-1]}}}s._PreviousObject=n.getAssociatedViewElt(this._treeKey);s._IdPreviousObject=undefined}if((s._GeometricalData!=undefined)&&(s._GeometricalData._initializers!=undefined)){var A=0;var p=[];for(A=0;A<s._GeometricalData._initializers.length;A++){var z=s._GeometricalData._initializers[A];if(z!=undefined){var h=undefined;var t=this._nameSpace.decodeGlobalId({Node:null,Id:z});if(t==undefined||t.length==0){t=this._nameSpace.decodeGlobalIdInternal({Node:null,Id:z,State:e.prototype.stateMode.TempoOrPermanent})}if(t!=undefined&&t.length!=0){h=t[t.length-1]}p.push(h.getAssociatedViewElt(this._treeKey))}}s._GeometricalData._initializers=p}if(s._Groups!=undefined){var A=0;for(A=0;A<s._Groups.length;A++){var r=s._Groups[A];var y=0;r._groupedElements=[];for(y=0;y<r._stringElements.length;y++){var f=r._stringElements[y];var t=this._nameSpace.decodeGlobalIdInternal({Node:null,Id:f,State:e.prototype.stateMode.Tempo});var B=t[t.length-1];(r._groupedElements).push(B.getAssociatedViewElt(this._treeKey))}}}this._errManager.cleanContext(arguments)};b.prototype.doOperation=function(g){this._errManager.addContext({name:"doOperation","arguments":arguments});if(c.isPerformanceTracesActivated()){c.startPerfo("CSIVMClientTransactionOnIdent.doOperation")}this.completeOperationWithObjects(g);var f=this._Processor.checkCompletedOperation(g);if(f!==undefined){this._viewTransac.doOperation(f);this.internalDoOperation(f)}if(c.isPerformanceTracesActivated()){c.endPerfo("CSIVMClientTransactionOnIdent.doOperation")}this._errManager.cleanContext(arguments)};b.prototype.executeEnd=function(){var f=undefined;if(this._viewTransac.executeEnd!=undefined){f=this._viewTransac.executeEnd()}return f};b.prototype.internalDoOperation=function(r){this._errManager.addContext({name:"internalDoOperation","arguments":arguments});if(c.isPerformanceTracesActivated()){c.startPerfo("CSIVMClientTransactionOnIdent.internalDoOperation")}var h=r.getType();if(h===d.prototype.OperationType.RemoveAll){this._nameSpace.clear(this._treeKey)}else{var g=undefined;if(r._IdNewObject!==undefined){var w=this._nameSpace.getObjects(r._IdNewObject._IdPattern,r._IdNewObject._LocalId);var l=w.length;var v;if(l){if(r._OperatedObject!==undefined){if(r._OperatedObject.getIdentificationObject().getIdPattern()._idContext!==r._IdNewObject._IdPattern._idContext&&r._OperatedObject.getIdentificationObject().getIdPattern()._idContext===r._IdNewObject._IdPattern._idSpace){v=r._OperatedObject.getIdentificationObject()}else{var s=r._OperatedObject.getIdentificationObject().getFirstParentsDefiningNameSpaceOfThis();if(s.length){v=s[0]}}}if(v){for(var B=0;B<l&&g===undefined;B++){if(w[B].getFirstParentsDefiningNameSpaceOfThis().indexOf(v)>=0){g=w[B]}}}else{if(l>1){throw"Several objects with same ID without any Parent defining a NameSpace to allow such a situation"}g=w[0]}}if(g!==undefined){if(g.getViewData(this._treeKey)){throw"we try to create a view of an object which already has a representation in this view"}this._reusedObjects[r._IdNewObject._ShortId]=g}else{g=this._nameSpace.createObject(r._IdNewObject._IdPattern,r._IdNewObject._LocalId);this._createdObjects[r._IdNewObject._ShortId]=g;if(r._IdNewObject._LocalIdDual){this._shortIdsToDualIds[r._IdNewObject._ShortId]=r._IdNewObject._LocalIdDual;this._IdsObjIsEmpty=false}if(h===d.prototype.OperationType.CreateRoot||h===d.prototype.OperationType.CreateSemanticRoot){g.setRoot()}else{if(h===d.prototype.OperationType.AddBody){g.activateChildrenMapping()}}}r._CreatedObject.setIdentificationObject(g);g.associateViewElt(this._treeKey,r._CreatedObject)}switch(h){case d.prototype.OperationType.AddNode:case d.prototype.OperationType.AddBody:case d.prototype.OperationType.AddCustomNode:case d.prototype.OperationType.AddSemanticNode:var q=r._OperatedObject.getIdentificationObject();q.addChild(this._treeKey,g);if((r._GeometricalData!==undefined)&&(r._GeometricalData._initializers!==undefined)){var B=0,C=r._GeometricalData._initializers.length;for(B=0;B<C;B++){var A=r._GeometricalData._initializers[B];var n=A.getIdentificationObject();var o=n.getChildren(this._treeKey,n.stateMode.Tempo);if(o!==undefined){g.addChildren(this._treeKey,o)}}}break;case d.prototype.OperationType.AddCells:var l=r._CreatedObjectsWithID.length;var x=0;var B=0,z=0;var q=r._OperatedObject.getIdentificationObject();var g=null;var u=null;var D=[];var f=false;if(r._MultipleViewElts!==undefined){x=r._MultipleViewElts.length}for(B=0;B<l;B++){g=undefined;u=r._CreatedObjectsWithID[B];f=false;if(x>0){for(z=0;z<x&&!f;z++){if(r._MultipleViewElts[z]===u.ident){f=true}}}if(f){var w=this._nameSpace.getObjects(r._IdPattern,u.ident);var m=w.length;if(m){var t=q.getFirstParentsDefiningNameSpaceOfThis();var v;if(t.length){v=t[0]}if(!v){if(m>1){throw"Several cells with same ID without any Parent defining a NameSpace to allow such a situation"}g=w[0]}else{for(var y=0;y<m&&g===undefined;y++){if(w[y].getFirstParentsDefiningNameSpaceOfThis().indexOf(v)>=0){g=w[y]}}}}if(g!==undefined){g=g.addObject()}}if(g===undefined){g=this._nameSpace.createObject(r._IdPattern,u.ident);this._createCells.push(g)}u.object.setIdentificationObject(g);g.associateViewElt(this._treeKey,u.object);D.push(g)}q.addChildren(this._treeKey,D);break;case d.prototype.OperationType.AddExistingNode:case d.prototype.OperationType.AddExistingCell:var q=r._OperatedObject.getIdentificationObject();var p=r._OperandObject.getIdentificationObject();q.addChild(this._treeKey,p);break;case d.prototype.OperationType.RemoveExistingNode:case d.prototype.OperationType.RemoveExistingCell:var q=r._OperatedObject.getIdentificationObject();var p=r._OperandObject.getIdentificationObject();q.removeChild(this._treeKey,p);break}}if(c.isPerformanceTracesActivated()){c.endPerfo("CSIVMClientTransactionOnIdent.internalDoOperation")}this._errManager.cleanContext(arguments)};b.prototype.commit=function(){this._errManager.addContext({name:"commit","arguments":arguments});var f=undefined;this._viewTransac.commit();f=this._nameSpace.commit(this._treeKey);this._errManager.cleanContext(arguments);return f};b.prototype.abort=function(){this._errManager.addContext({name:"abort","arguments":arguments});var h=undefined;var g=0,f=this._createCells.length;for(g in this._createdObjects){this._nameSpace.removeObject(this._createdObjects[g])}for(g=0;g<f;++g){this._nameSpace.removeObject(this._createCells[g])}h=this._nameSpace.abort(this._treeKey);this._viewTransac.abort();this._errManager.cleanContext(arguments);return h};b.prototype.computeDuality=function(){this._errManager.addContext({name:"computeDuality","arguments":arguments});if(!this._IdsObjIsEmpty){var i=this._Processor.getModel();if(i!==undefined){var h=this._treeKey.getViewType();var n=[];if(h===a.prototype.ViewType.ViewSpecTree||h===a.prototype.ViewType.ViewSpecTree2){n.push(a.prototype.ViewType.View3D)}else{if(h===a.prototype.ViewType.View3D){n.push(a.prototype.ViewType.ViewSpecTree,a.prototype.ViewType.ViewSpecTree2)}}var f,p,m,o,l;var g,j=n.length;for(f in this._shortIdsToDualIds){m=this._createdObjects[f];if(m!==undefined){p=this._shortIdsToDualIds[f];for(g=0;g<j;++g){l=n[g];o=m.getDualObject(l);if(o!==undefined&&o.getDualObject(h)===m){break}else{o=i.getDualObject(l,m.getIdPattern(),p);if(o!==undefined){m.setDualObject(l,o);o.setDualObject(h,m);break}}}}}}}};return b});define("DS/CSIViewModelWebProcessor/CSIVMClientTreeObjectParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels"],function(c,e){function b(f){this._shortId=f.shortId||null;this._idPath=f.idPath||null}b.prototype.getShortId=function(){return this._shortId};b.prototype.getIdPath=function(){return this._idPath};var d=function(){return false};var a=function(f){var g={shortId:f.readInt32(e.shortId),idPath:f.readString(e.idPath)};return new b(g)};b.prototype.declareType=function(){c.declareType({type:"CSIViewTreeObjectParam",serialize:d,unserialize:a})};return b});define("DS/CSIViewModelWebProcessor/CSIVMClientTreeTokenParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebProcessor/CSIVMClientTreeObjectParameter","DS/CSIViewModelWebInterfaces/CSIVMClientGeometryParameter","DS/CSIViewModelWebInterfaces/CSIVMClientInfiniteGeometryParameter","DS/CSIViewModelWebInterfaces/CSIVMClientBoundingSphereParameter","DS/CSIViewModelWebInterfaces/CSIVMClientCustomDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIVMClientGroup"],function(b,c,i,j,k,d,a,f,h){function e(m){this._value=m.value||f.prototype.OperationType.UnknownType;this._localIdInt=m.localIdInt;this._localIdString=m.localIdString;this._localIdIntDual=m.localIdIntDual;this._localIdStringDual=m.localIdStringDual;this._shortId=m.shortId;this._idPath=m.idPath;this._idPattern=m.idPattern;this._parent=m.parent;this._previous=m.previous;this._geometries=(m.geometries&&m.geometries.length)?m.geometries:(m.geometry?[m.geometry]:undefined);this._infiniteGeometries=(m.infiniteGeometries&&m.infiniteGeometries.length)?m.infiniteGeometries:(m.infiniteGeometry?[m.infiniteGeometry]:undefined);this._bs=m.bs;this._inits=m.inits;this._customData=m.customData;this._groups=m.groups;this._attributes=m.attributes;this._dim=m.dimension;this._multipleViewElts=m.multipleViewElts;this._hasInfiniteGeometry=m.hasInfiniteGeometry||(this._infiniteGeometries?true:false);this._hasGeomDecorations=m.hasGeomDecorations}e.prototype.getTreeKey=function(){return this._treeKey};e.prototype.getLocalIdInt=function(){return this._localIdInt};e.prototype.getLocalIdString=function(){return this._localIdString};e.prototype.getLocalIdIntDual=function(){return this._localIdIntDual};e.prototype.getLocalIdStringDual=function(){return this._localIdStringDual};e.prototype.getShortId=function(){return this._shortId};e.prototype.getIdPath=function(){return this._idPath};e.prototype.getIdPattern=function(){return this._idPattern};e.prototype.getParent=function(){return this._parent};e.prototype.getGeometries=function(){return this._geometries};e.prototype.getInfiniteGeometries=function(){return this._infiniteGeometries};e.prototype.getBoundingSphere=function(){return this._bs};e.prototype.getInitializers=function(){return this._inits};e.prototype.getCustomData=function(){return this._customData};e.prototype.getGroups=function(){return this._groups};e.prototype.getAttributes=function(){return this._attributes};e.prototype.hasInfiniteGeometry=function(){return this._hasInfiniteGeometry};e.prototype.hasGeomDecorations=function(){return this._hasGeomDecorations};e.prototype.process=function(t,z){z._errManager.addContext({name:"process","arguments":arguments});var w=t.getProcessor();var v=t.getIdPatterns();var q;var p;var x;var m;var o;var y;var B;var r;var n;if(this._value==f.prototype.OperationType.ModifyCustomNode||this._value==f.prototype.OperationType.ApplyAttributes||this._value==f.prototype.OperationType.ModifyBody){p={_GlobalId:this._idPath}}else{if(this._value!=f.prototype.OperationType.RemoveAll){if(this._parent&&(this._parent.getShortId()!=undefined||this._parent.getIdPath()!=undefined)){p={_ShortId:this._parent.getShortId(),_GlobalId:this._parent.getIdPath()};o=this._idPath;y=this._shortId}else{this._value=f.prototype.OperationType.CreateRoot}if(this._previous){B={_ShortId:this._previous.getShortId(),_GlobalId:this._previous.getIdPath()}}if(this._value==f.prototype.OperationType.AddCells){m=v[this._idPattern]}if((this._localIdInt||this._localIdString)&&this._idPattern&&this._shortId){x={_LocalId:this._localIdInt||this._localIdString,_LocalIdDual:this._localIdIntDual||this._localIdStringDual,_IdPattern:v[this._idPattern],_ShortId:this._shortId}}}}if(this._geometries||this._infiniteGeometries||this._inits||this._bs||this._dim){q=new f.prototype.GeometricalData(this._bs,this._inits,this._hasInfiniteGeometry?this._infiniteGeometries:this._geometries,this._dim,t.getViewVersion(),this._hasInfiniteGeometry,this._hasGeomDecorations)}if((this._customData!=undefined)&&(this._customData.getBinFormat()==this._customData.binFormatValues.sem)){var C={};var s=this._customData.getData();C[c.valueAlias]=s.readString(c.valueAlias);C[c.valueTypeId]=s.readString(c.valueTypeId);C[c.valueSubTypeId]=s.readString(c.valueSubTypeId);C[c.valueIconName]=s.readString(c.valueIconName);C[c.valueIconModule]=s.readString(c.valueIconModule);C[c.valueEditCommandName]=s.readString(c.valueEditCommandName);C[c.valueErrors]=s.readObjectArray(c.valueErrors,"CSIViewModelError");C[c.valueStates]=s.readObjectArray(c.valueStates,"CSIViewModelEltState");r=new f.prototype.SemanticData(C);if(this._value==f.prototype.OperationType.AddCustomNode){this._value=f.prototype.OperationType.AddSemanticNode}else{if(this._value==f.prototype.OperationType.CreateRoot){this._value=f.prototype.OperationType.CreateSemanticRoot}else{if(this._value==f.prototype.OperationType.ModifyCustomNode){this._value=f.prototype.OperationType.ModifySemanticNode}}}}if(this._attributes!==undefined){var A=this._attributes.readObject(c.valueMatrix,"CATMathTransformation");n=new f.prototype.Attributes(A)}var u=w.createOperation({_type:this._value,_GeometricalData:q,_CustomData:this._customData,_SemanticData:r,_IdOperatedObject:p,_IdNewObject:x,_IdPreviousObject:B,_IdPattern:m,_ShortIdOperand:y,_GlobalIdOperand:o,_MultipleViewElts:this._multipleViewElts,_Groups:this._groups,_Attributes:n});z.doOperation(u);z._errManager.cleanContext(arguments)};var l=function(){return false};var g=function(n){var m=n.readString(c.value);var o={value:(c.valueTab[m]),localIdInt:n.readUint32(c.localIdInt),localIdString:n.readString(c.localIdString),localIdIntDual:n.readUint32(c.localIdIntDual),localIdStringDual:n.readString(c.localIdStringDual),shortId:n.readInt32(c.shortId),idPath:n.readString(c.idPath),idPattern:n.readInt32(c.idPattern),parent:n.readObject(c.parent,"CSIViewTreeObjectParam"),previous:n.readObject(c.previous,"CSIViewTreeObjectParam"),geometry:n.readObject(c.valueGeometry,"CSIGeometryParam"),geometries:n.readObjectArray(c.valueGeometries,"CSIGeometryParam"),infiniteGeometry:n.readObject(c.valueInfiniteGeometry,"CSIInfiniteGeometryParam"),infiniteGeometries:n.readObjectArray(c.valueInfiniteGeometries,"CSIInfiniteGeometryParam"),multipleViewElts:n.readUint32Array(c.valueMultipleViewElts),bs:n.readObject(c.valueBoundingSphere,"CSIBoundingSphereParam"),customData:n.readObject(c.valueCustomData,"CSICustomDataParam"),inits:n.readStringArray(c.valueInitializers),groups:n.readObjectArray(c.valueGroups,"CSIViewModelGroup"),attributes:n.readObject(c.valueAttribute,"Parameters"),dimension:n.readInt32(c.valueDimension),hasInfiniteGeometry:n.readBool(c.valueHasInfiniteGeometry),hasGeomDecorations:n.readBool(c.valueHasGeomDecorations)};return new e(o)};e.prototype.declareType=function(){b.declareType({type:"CSIViewTreeTokenParam",serialize:l,unserialize:g});i.prototype.declareType();j.prototype.declareType();k.prototype.declareType();d.prototype.declareType();a.prototype.declareType();h.prototype.declareType()};return e});define("DS/CSIViewModelWebProcessor/CSIVMClientTargetsInContext",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebProcessor/CSIVMClientTreeObjectParameter"],function(b,e,f){function d(h,g){this._context=h;this._targetsIds=g}var c=function(){return false};var a=function(g){var h=new d(g.readObject(e.targetsContext,"CSIViewTreeObjectParam"),g.readUint32Array(e.targets));return h};d.prototype.declareType=function(){b.declareType({type:"CSIViewModelTargetsInContext",serialize:c,unserialize:a})};return d});define("DS/CSIViewModelWebProcessor/CSIVMClientAppliedGasTokenParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebProcessor/CSIVMClientTreeObjectParameter","DS/CSIViewModelWebInterfaces/CSIVMClientOperation"],function(b,f,g,c){function e(h){this._id=h.id||0;this._node=h.node||null}e.prototype.getId=function(){return this._id};e.prototype.getNode=function(){return this._node};e.prototype.process=function(l,k){var j=l.getGraphicProperties();var i=l.getProcessor();var h=i.createOperation({_type:c.prototype.OperationType.ApplyGP,_IdOperatedObject:{_ShortId:this._node.getShortId(),_GlobalId:this._node.getIdPath()},_GraphicProperties:j[this._id]});k.doOperation(h)};var d=function(){return false};var a=function(h){var i={id:h.readUint32(f.idGP),node:h.readObject(f.node,"CSIViewTreeObjectParam")};return new e(i)};e.prototype.declareType=function(){b.declareType({type:"CSIViewTreeAppliedGPTokenParam",serialize:d,unserialize:a})};return e});define("DS/CSIViewModelWebProcessor/CSIVMClientAppliedGPTokenParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebProcessor/CSIVMClientTargetsInContext"],function(b,g,d,e){function c(h){this._id=h.id||0;this._shortIds=h.shortIds;this._globalIds=h.globalIds;this._targetsInContext=h.targetsInContext}c.prototype.process=function(o,l){var k=o.getGraphicProperties();var j=o.getProcessor();var m=0;var n=0;if(this._shortIds!==undefined){n=this._shortIds.length;for(m=0;m<n;m++){var h=j.createOperation({_type:d.prototype.OperationType.ApplyGP,_IdOperatedObject:{_ShortId:this._shortIds[m]},_GraphicProperties:k[this._id]});l.doOperation(h)}}if(this._globalIds!==undefined){n=this._globalIds.length;for(m=0;m<n;m++){var h=j.createOperation({_type:d.prototype.OperationType.ApplyGP,_IdOperatedObject:{_GlobalId:this._globalIds[m]},_GraphicProperties:k[this._id]});l.doOperation(h)}}if(this._targetsInContext!==undefined){n=this._targetsInContext.length;for(m=0;m<n;m++){var h=j.createOperation({_type:d.prototype.OperationType.ApplyGP,_IdOperatedObject:{_GlobalId:this._targetsInContext[m]._context.getIdPath(),_ShortId:this._targetsInContext[m]._context.getShortId()},_GraphicProperties:k[this._id]});h._IdOperatedSubElements=this._targetsInContext[m]._targetsIds;l.doOperation(h)}}};var f=function(){return false};var a=function(h){var i={id:h.readUint32(g.idGP),shortIds:h.readInt32Array(g.shortIds),globalIds:h.readStringArray(g.globalIds),targetsInContext:h.readObjectArray(g.targetsInContext,"CSIViewModelTargetsInContext")};return new c(i)};c.prototype.declareType=function(){b.declareType({type:"CSIViewModelGPTokenParam",serialize:f,unserialize:a});e.prototype.declareType()};return c});define("DS/CSIViewModelWebProcessor/CSIVMClientTreeUpdateParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebProcessor/CSIVMClientTreeTokenParameter","DS/CSIViewModelWebProcessor/CSIVMClientAppliedGasTokenParameter","DS/CSIViewModelWebProcessor/CSIVMClientAppliedGPTokenParameter"],function(b,g,h,f,c){function d(i,k,l,j){this._treeKey=i||{};this._tokens=k||[];this._appliedGas=l||[];this._appliedGP=j||[]}d.prototype.getTreeKey=function(){return this._treeKey};d.prototype.getTokens=function(){return this._tokens};d.prototype.process=function(n){var j=n.getProcessor();this._treeKey=this._treeKey.process(n);j.abort(this._treeKey);var k=j.createTransactionOnIdent(this._treeKey);var l=0;var m=null;for(l=0;l<this._tokens.length;l++){m=this._tokens[l];m.process(n,k)}for(l=0;l<this._appliedGas.length;l++){m=this._appliedGas[l];m.process(n,k)}for(l=0;l<this._appliedGP.length;l++){m=this._appliedGP[l];m.process(n,k)}k.executeEnd();if(n.getViewStatus()==g.viewStatusPermanent){j.commit(this._treeKey)}return k};var e=function(){return false};var a=function(k){var j=k.readObject(g.csiTreeKey,"CSIViewTreeKey");var l=k.readObjectArray(g.tokens,"CSIViewTreeTokenParam");var m=k.readObjectArray(g.appliedGas,"CSIViewTreeAppliedGPTokenParam");var i=k.readObjectArray(g.appliedGP,"CSIViewModelGPTokenParam");return new d(j,l,m,i)};d.prototype.declareType=function(){b.declareType({type:"CSIViewTreeUpdateParam",serialize:e,unserialize:a});h.prototype.declareType();f.prototype.declareType();c.prototype.declareType()};return d});define("DS/CSIViewModelWebProcessor/CSIVMClientViewParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebProcessor/CSIVMClientTreeUpdateParameter","DS/CSIViewModelWebProcessor/CSIVMClientIdPatternParameter","DS/CSIViewModelWebInterfaces/CSIVMClientGraphicPropertyParameter","DS/CSIViewModelWebInterfaces/CSIVMClientMaterialMessageParameter","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv","CSIMathematics/CSIDeclareMathematics"],function(a,b,h,d,e,g,j,c){var k=false;function f(m){this._viewStatus=m.viewStatus||b.viewStatusPermanent;this._viewVersion=m.viewVersion;this._idPatterns=m.idPatterns||{};this._graphicProperties=m.gas||{};this._treeUpdates=m.treeUpdates||[]}f.prototype.getViewStatus=function(){return this._viewStatus};f.prototype.getViewVersion=function(){return this._viewVersion};f.prototype.getIdPatterns=function(){return this._idPatterns};f.prototype.getGraphicProperties=function(){return this._graphicProperties};f.prototype.getTreeUpdates=function(){return this._treeUpdates};f.prototype.getProcessor=function(){return this._processor};f.prototype.process=function(r){this._processor=r;if(this.getViewStatus()==b.viewStatusCommit){r.commit()}else{if(this.getViewStatus()==b.viewStatusAbort){r.abort()}else{for(var t in this._idPatterns){var s=this._idPatterns[t];this._idPatterns[t]=s.process(this)}var o,m,n,p,q=[];for(m=this._treeUpdates.length,o=0;o<m;++o){n=this._treeUpdates[o];p=n.process(this);q.push(p)}for(m=q.length,o=0;o<m;++o){p=q[o];p.computeDuality()}}}};var l=function(){return false};var i=function(y){var o;var n={viewStatus:y.readString(b.viewStatus),viewVersion:y.readUint32(b.viewVersion),gas:{},treeUpdates:y.readObjectArray(b.treeUpdates,"CSIViewTreeUpdateParam"),idPatterns:{}};var m=y.readObjectArray(b.idPatterns,"CSIViewModelIdPattern");var x=y.readObjectArray(b.graphicProperties,"CSIViewModelGraphicProperty");var q=y.readObject(b.materialMessage,"CSIViewModelMaterialMessage");if(m){for(o=0;o<m.length;o++){var u=m[o];n.idPatterns[u.getId()]=u}}if(x){var v,p;if(q!==undefined){var w=q.getMaterialJSON();if(w!==undefined){v=w.getJSON()}p=q.getMaterialBuffers()}for(o=0;o<x.length;o++){var t=x[o];if(t!==undefined){var r=t.getMaterial();if(r!==undefined){var s=r.getMaterialDefinition();if(s!==undefined){if(s.JSON===undefined){s.JSON=v}if(s.Buffers===undefined){s.Buffers=p}s.Index--}}n.gas[t.getId()]=t}}}return new f(n)};f.prototype.declareType=function(){if(!k&&j.isNewCSIIdentificationActivated()){c(a);a.declareType({type:"CSIViewParam",serialize:l,unserialize:i});h.prototype.declareType();d.prototype.declareType();e.prototype.declareType();g.prototype.declareType();k=true}};f.prototype.declareType();return f});define("DS/CSIViewModelWebProcessor/CSIVMClientProcessor",["DS/CSIViewModelWebImplement/CSIVMClientModel","DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebProcessor/CSIVMClientTransactionOnIdent","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebProcessor/CSIVMClientViewParameter","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv"],function(g,a,e,c,f,b){var h=0;var d=function(k){var j=this;h=0;this._cbOnFatalError;this._cbOnVMUpdate={};this._delegateMap={};this._model=k;if(k===undefined){this._model=new g()}this._curTransactionMap={};b.activateNewCSIIdentification();f.prototype.declareType();this.onServerMessageWithOutCallback=function(m){var o=m.readObject("view","CSIViewParam");var l=m.readInt32("OperationType");var n=m.readString("rc");var p={Operation:l,rc:n,hasUpdatedView:false};if(o){p.hasUpdatedView=true;o.process(j)}return p};this.answerCallback=function(o,n){var m=j._cbOnVMUpdate.length;var p=undefined;for(var l in j._cbOnVMUpdate){p=j._cbOnVMUpdate[l];if(p!=undefined){p(o,n)}}};this.onServerMessage=function(l){var m;try{m=j.onServerMessageWithOutCallback(l)}catch(n){if(j._cbOnFatalError){j._cbOnFatalError(n)}}j.answerCallback(m,l);return true};var i=a.getDefaultResponse();i.onAnswerDomain("view",this.onServerMessage)};d.prototype.getModel=function(){return this._model};d.prototype.setNotifier=function(j,i){this._delegateMap[j]=i;return i};d.prototype.getNotifier=function(i){return this._delegateMap[i]};d.prototype.addCBOnVMUpdate=function(i){this._cbOnVMUpdate[h]=i;h++;return h};d.prototype.addCBOnFatalError=function(i){this._cbOnFatalError=i;return i};d.prototype.removeCBOnVMUpdate=function(i){if(this._cbOnVMUpdate[i-1]){this._cbOnVMUpdate[i-1]=undefined;delete this._cbOnVMUpdate[i-1]}};d.prototype.createTransaction=function(j){var k=undefined;var i=this._delegateMap[j.getViewType()];k=i.createTransaction(j);return k};d.prototype.createTransactionOnIdent=function(j){var k=new e();var i=this.createTransaction(j);k.setData(this._model,j,i,this);this._curTransactionMap[j.getUUID()]=k;return k};d.prototype.getTransactionOnIdent=function(i){return this._curTransactionMap[i.getUUID()]};d.prototype.deleteTransactionOnIdent=function(i){delete this._curTransactionMap[i.getUUID()]};d.prototype.getOrCreateTransactionOnIdent=function(i){var j=this.getTransactionOnIdent(i);if(j==undefined){j=this.createTransactionOnIdent(i)}return j};d.prototype.commit=function(j){if(j==undefined){for(var l in this._curTransactionMap){var i=this._curTransactionMap[l];i.commit()}this._curTransactionMap={}}else{var k=this.getTransactionOnIdent(j);if(k!=undefined){k.commit();this.deleteTransactionOnIdent(j)}}};d.prototype.abort=function(j){if(j==undefined){for(var l in this._curTransactionMap){var i=this._curTransactionMap[l];i.abort()}this._curTransactionMap={}}else{var k=this.getTransactionOnIdent(j);if(k!=undefined){k.abort();this.deleteTransactionOnIdent(j)}}};d.prototype.createOperation=function(i){var m=undefined;var l=[{_IdOperatedObject:true,_IdNewObject:true,_IdPreviousObject:false,_Attributes:false},{_IdOperatedObject:true,_GeometricalData:true,_IdNewObject:true,_Attributes:false},{_IdOperatedObject:true,_GeometricalData:true,_IdPattern:true,_MultipleViewElts:false},{_IdOperatedObject:true,_CustomData:true,_IdNewObject:true,_IdPreviousObject:false,_Attributes:false},{_IdOperatedObject:true,_ShortIdOperand:false,_GlobalIdOperand:false,_IdPreviousObject:false},{_IdOperatedObject:true,_GlobalIdOperand:true},{_IdOperatedObject:true,_GlobalIdOperand:true,_IdPreviousObject:false},{_IdOperatedObject:true,_GlobalIdOperand:true},{},{_IdOperatedObject:true,_CustomData:true},{_IdOperatedObject:true,_Groups:true},{_IdOperatedObject:true,_GraphicProperties:true},{_IdNewObject:true,_Attributes:false},{_IdOperatedObject:true,_SemanticData:true,_IdNewObject:true,_IdPreviousObject:false,_Attributes:false},{_IdOperatedObject:true,_SemanticData:true},{_IdNewObject:true,_SemanticData:true,_Attributes:false},{_IdOperatedObject:true,_Attributes:true},{_IdOperatedObject:true,_GeometricalData:true}];var j=(i._type>1)?l[i._type-2]:undefined;if(j!=undefined){m=new c();m._type=i._type}for(var k in j){if((j[k]==true)&&(i[k]==undefined)){m=undefined;break}else{if(i[k]!=undefined){m[k]=i[k]}}}return m};d.prototype.checkCompletedOperation=function(j){var m=j;var l=[{_OperatedObject:true,_IdNewObject:true,_PreviousObject:false,_Attributes:false},{_OperatedObject:true,_GeometricalData:true,_IdNewObject:true,_Attributes:false},{_OperatedObject:true,_GeometricalData:true,_IdPattern:true,_MultipleViewElts:false},{_OperatedObject:true,_CustomData:true,_IdNewObject:true,_PreviousObject:false,_Attributes:false},{_OperatedObject:true,_OperandObject:true,_PreviousObject:false},{_OperatedObject:true,_OperandObject:true},{_OperatedObject:true,_OperandObject:true,_PreviousObject:false},{_OperatedObject:true,_OperandObject:true},{},{_OperatedObject:true,_CustomData:true},{_OperatedObject:true,_Groups:true},{_OperatedObject:true,_GraphicProperties:true,_SubElement:false},{_IdNewObject:true,_SemanticData:false,_Attributes:false},{_OperatedObject:true,_SemanticData:true,_IdNewObject:true,_PreviousObject:false,_Attributes:false},{_OperatedObject:true,_SemanticData:true},{_IdNewObject:true,_SemanticData:true,_Attributes:false},{_OperatedObject:true,_Attributes:true},{_OperatedObject:true,_GeometricalData:true},];if(j._type<2){m=undefined}else{var i=l[j._type-2];for(var k in i){if((i[k]==true)&&(j[k]==undefined)){m=undefined;break}}}return m};d.prototype.clear=function(){this.abort();this._model=new g()};return d});define("DS/CSIViewModelWebProcessor/CSIVMClientManager",["DS/CSIViewModelWebInterfaces/CSIVMClientManagerList","DS/CSIViewModelWebProcessor/CSIVMClientProcessor","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/CSICommandBinder/CSICommandBinder","DS/CSICommandBinder/CSIParameters","DS/CSIViewModelWebInterfaces/CSIVMClientRequestWithView"],function(e,f,b,a,d,h){function c(i){Object.defineProperty(this,"_processor",{value:new f(),configurable:false,writable:false});this._impl=this;e._Managers.push(this)}c.prototype.OperationType={BEGIN:5,DO:6,END:7,EXECUTE:4,CANCEL:3};c.prototype.getModel=function(){return this._processor.getModel()};c.prototype.getProcessor=function(){return this._processor};c.prototype.setNotifier=function(i,j){this._processor.setNotifier(i,j)};c.prototype.getNotifier=function(i){return this._processor.getNotifier(i)};c.prototype.addCBOnVMUpdate=function(i){return this._processor.addCBOnVMUpdate(i)};c.prototype.addCBOnFatalError=function(i){return this._processor.addCBOnFatalError(i)};c.prototype.removeCBOnVMUpdate=function(i){return this._processor.removeCBOnVMUpdate(i)};c.prototype.createTreeKey=function(i,j){return this.getModel().getOrCreateTreeKey(j,i)};c.prototype.createCSIVMRequestWithView=function(i){var j=this.getProcessor();if(i===undefined||i.node===undefined||i.serverNodeId===undefined||i.command===undefined||(i.command&&i.command.command==="")){return undefined}return new h(i,j.onServerMessage.bind(j))};function g(i){if((i instanceof d)&&(this._onReloadAnswer!==undefined)){var j={};j.status=i.readBool("commandHasSucceeded");this._onReloadAnswer(j)}}c.prototype.reload=function(k){this._processor.clear();if(k!==undefined){this._onReloadAnswer=k.onAnswer;var j=new a.Parameters();var l={command:"CSIReloadViewCommand",version:1,defaultCallback:g.bind(this)};var i={node:k.node,serverNodeId:k.serverNodeId,command:l};this.globalRequest=this.createCSIVMRequestWithView(i);this.globalRequest.begin();this.globalRequest.send(j);this.globalRequest.end()}};c.createClientManager=function(){var i=new c();return i};return c});