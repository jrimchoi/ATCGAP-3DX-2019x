define("DS/VisuLoaders/ColladaLoader",["DS/Visualization/ThreeJS_DS","DS/Visualization/Utils","DS/Visualization/ProxyAbstraction"],function(b,d,c){var a=function(){var ap=null;var J=null;var Z;var aM=null;var ac={};var o={};var R={};var ai={};var au={};var T={};var aw={};var ah={};var aQ;var aK;var aT;var j;var M;var w=true;var S=b.SmoothShading;var ae={centerGeometry:false,convertUpAxis:false,subdivideFaces:true,upAxis:"Y",defaultEnvMap:null,waitMaterial:new b.MeshPhongMaterial({color:new b.Color(16777215)})};var aS=1;var ax="Y";var C=null;function k(a2,a6,a5){var a4=0;if(document.implementation&&document.implementation.createDocument){var a3=new XMLHttpRequest();a3.onreadystatechange=function(){if(a3.readyState==4){if(a3.status==0||a3.status==200){if(a3.responseXML){aM=a6;ao(a3.responseXML,undefined,a2)}else{if(a3.responseText){aM=a6;var a7=new DOMParser();var a8=a7.parseFromString(a3.responseText,"application/xml");ao(a8,undefined,a2)}else{console.error("ColladaLoader: Empty or non-existing file ("+a2+")")}}}}else{if(a3.readyState==3){if(a5){if(a4==0){a4=a3.getResponseHeader("Content-Length")}a5({total:a4,loaded:a3.responseText.length})}}}};a3.open("GET",a2,true);a3.withCredentials=true;a3.send(null)}else{alert("Don't know how to parse XML!")}}function af(a3,a7,a5){var a2=a3.serverurl?a3.serverurl:"";a2+=a3.filename?a3.filename:"";var a4=new c();d.setProxyFromSpec(a3,a4);var a6=function(a9){aM=a7;var a8=new DOMParser();var ba=a8.parseFromString(a9,"application/xml");ao(ba,undefined,a2)};a4.executeGetHttpRequest(a2,"text",null,a6,function(){console.error("ColladaLoader: Empty or non-existing file ("+a2+")")})}function ao(a7,a5,a3){ap=a7;a5=a5||aM;if(a3!==undefined){var a6=a3.split("/");a6.pop();aT=(a6.length<1?".":a6.join("/"))+"/"}B();X();o=aB("//dae:library_images/dae:image",ag,"image");T=aB("//dae:library_materials/dae:material",g,"material");aw=aB("//dae:library_effects/dae:effect",Q,"effect");au=aB("//dae:library_geometries/dae:geometry",aD,"geometry");ah=aB(".//dae:library_cameras/dae:camera",aR,"camera");ai=aB("//dae:library_controllers/dae:controller",L,"controller");R=aB("//dae:library_animations/dae:animation",aU,"animation");aK=aB(".//dae:library_visual_scenes/dae:visual_scene",aN,"visual_scene");j=[];M=[];Z=aa();J=new b.Object3D();for(var a4=0;a4<Z.nodes.length;a4++){J.add(h(Z.nodes[a4]))}J.scale.multiplyScalar(aS);y();var a2={scene:J,morphs:j,skins:M,animations:aQ,dae:{images:o,materials:T,cameras:ah,effects:aw,geometries:au,controllers:ai,animations:R,visualScenes:aK,scene:Z}};if(a5){a5(a2)}return a2}function F(a2){S=a2}function B(){var a5=ap.evaluate("//dae:asset",ap,aY,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var a3=a5.iterateNext();if(a3&&a3.childNodes){for(var a2=0;a2<a3.childNodes.length;a2++){var a6=a3.childNodes[a2];switch(a6.nodeName){case"unit":var a4=a6.getAttribute("meter");if(a4){aS=parseFloat(a4)}break;case"up_axis":ax=a6.textContent.charAt(0);break}}}}function aB(a8,a5,a7){var a6=ap.evaluate(a8,ap,aY,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var a9={};var a4=a6.iterateNext();var a3=0;while(a4){var a2=(new a5()).parse(a4);if(!a2.id||a2.id.length==0){a2.id=a7+(a3++)}a9[a2.id]=a2;a4=a6.iterateNext()}return a9}function aa(){var a3=ap.evaluate(".//dae:scene/dae:instance_visual_scene",ap,aY,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext();if(a3){var a2=a3.getAttribute("url").replace(/^#/,"");return aK[a2.length>0?a2:"visual_scene0"]}else{return null}}function y(){aQ=[];s(J)}function s(a7){var a9=Z.getChildById(a7.name,true),a6=null;if(a9&&a9.keys){a6={fps:60,hierarchy:[{node:a9,keys:a9.keys,sids:a9.sids}],node:a7,name:"animation_"+a7.name,length:0};aQ.push(a6);for(var a5=0,a2=a9.keys.length;a5<a2;a5++){a6.length=Math.max(a6.length,a9.keys[a5].time)}}else{a6={hierarchy:[{keys:[],sids:[]}]}}for(var a5=0,a2=a7.children.length;a5<a2;a5++){var a8=s(a7.children[a5]);for(var a3=0,a4=a8.hierarchy.length;a3<a4;a3++){a6.hierarchy.push({keys:[],sids:[]})}}return a6}function K(){var a8=1000000;var a2=-a8;var a6=0;for(var a7 in R){var a5=R[a7];for(var a4=0;a4<a5.sampler.length;a4++){var a3=a5.sampler[a4];a3.create();a8=Math.min(a8,a3.startTime);a2=Math.max(a2,a3.endTime);a6=Math.max(a6,a3.input.length)}}return{start:a8,end:a2,frames:a6}}function q(a9,a6){var a8=a6 instanceof G?ai[a6.url]:a6;if(!a8||!a8.morph){console.log("could not find morph controller!");return}var a5=a8.morph;for(var a4=0;a4<a5.targets.length;a4++){var a3=a5.targets[a4];var a2=au[a3];if(!a2.mesh||!a2.mesh.primitives||!a2.mesh.primitives.length){continue}var a7=a2.mesh.primitives[0].geometry}}function aO(a9,a2,a7){var a3=ai[a2.url];if(!a3||!a3.skin){console.log("could not find skin controller!");return}if(!a2.skeleton||!a2.skeleton.length){console.log("could not find the skeleton for the skin!");return}var ba=a3.skin;var a5=Z.getChildById(a2.skeleton[0]);var a8=[];a7=a7!==undefined?a7:true;var a4=[];a9.skinWeights=[];a9.skinIndices=[];if(a7){for(var a6=0;a6<a9.vertices.length;a6++){a9.vertices[a6].applyMatrix4(ba.bindShapeMatrix)}}}function E(a7,a3,a8,a5){a7.world=a7.world||new b.Matrix4();a7.world.copy(a7.matrix);if(a7.channels&&a7.channels.length){var a6=a7.channels[0];var a2=a6.sampler.output[a8];if(a2 instanceof b.Matrix4){a7.world.copy(a2)}}if(a5){a7.world.multiplyMatrices(a5,a7.world)}a3.push(a7);for(var a4=0;a4<a7.nodes.length;a4++){E(a7.nodes[a4],a3,a8,a7.world)}}function V(a2,a9){for(var a5=0;a5<a2.length;a5++){var a8=a2[a5];var ba=-1;if(a8.type!="JOINT"){continue}for(var a4=0;a4<a9.joints.length;a4++){if(a8.sid==a9.joints[a4]){ba=a4;break}}if(ba>=0){var a6=a9.invBindMatrices[ba];a8.invBindMatrix=a6;a8.skinningMatrix=new b.Matrix4();a8.skinningMatrix.multiplyMatrices(a8.world,a6);a8.weights=[];for(var a4=0;a4<a9.weights.length;a4++){for(var a3=0;a3<a9.weights[a4].length;a3++){var a7=a9.weights[a4][a3];if(a7.joint==ba){a8.weights.push(a7)}}}}else{throw"ColladaLoader: Could not find joint '"+a8.sid+"'."}}}function aV(bd,be,a4){var bb=ai[be.url];a4=a4!==undefined?a4:40;if(!bb||!bb.skin){console.log("ColladaLoader: Could not find skin controller.");return}if(!be.skeleton||!be.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ");return}var ba=K();var a6=Z.getChildById(be.skeleton[0],true)||Z.getChildBySid(be.skeleton[0],true);var a8,a7,bf,a2,a9;var bg=new b.Vector3(),a3,bh;for(a8=0;a8<bd.vertices.length;a8++){bd.vertices[a8].applyMatrix4(bb.skin.bindShapeMatrix)}for(a4=0;a4<ba.frames;a4++){var a5=[];var bc=[];for(a8=0;a8<bd.vertices.length;a8++){bc.push(new b.Vector3())}E(a6,a5,a4);V(a5,bb.skin);for(a8=0;a8<a5.length;a8++){if(a5[a8].type!="JOINT"){continue}for(a7=0;a7<a5[a8].weights.length;a7++){bf=a5[a8].weights[a7];a2=bf.index;a9=bf.weight;a3=bd.vertices[a2];bh=bc[a2];bg.x=a3.x;bg.y=a3.y;bg.z=a3.z;bg.applyMatrix4(a5[a8].skinningMatrix);bh.x+=(bg.x*a9);bh.y+=(bg.y*a9);bh.z+=(bg.z*a9)}}}}function h(br,bc){var bh=new b.Object3D();var bf=false;var ba;var bl;var bu,bs;for(bu=0;bu<br.controllers.length;bu++){var bo=ai[br.controllers[bu].url];switch(bo.type){case"skin":if(au[bo.skin.source]){var bj=new az();bj.url=bo.skin.source;bj.instance_material=br.controllers[bu].instance_material;br.geometries.push(bj);bf=true;ba=br.controllers[bu]}else{if(ai[bo.skin.source]){var by=ai[bo.skin.source];bl=by;if(by.morph&&au[by.morph.source]){var bj=new az();bj.url=by.morph.source;bj.instance_material=br.controllers[bu].instance_material;br.geometries.push(bj)}}}break;case"morph":if(au[bo.morph.source]){var bj=new az();bj.url=bo.morph.source;bj.instance_material=br.controllers[bu].instance_material;br.geometries.push(bj);bl=br.controllers[bu]}console.log("ColladaLoader: Morph-controller partially supported.");default:break}}var a5={};for(bu=0;bu<br.geometries.length;bu++){var bt=br.geometries[bu];var bd=bt.instance_material;var a7=au[bt.url];var a9={};var bw=[];var bi=0;var a4;if(a7){if(!a7.mesh||!a7.mesh.primitives){continue}if(bh.name.length==0){bh.name=a7.id}if(bd){for(bs=0;bs<bd.length;bs++){var bm=bd[bs];var bv=T[bm.target];var a8=bv.instance_effect.url;var a2=aw[a8].shader;var bp=a2.material;if(a7.doubleSided){if(!(bp in a5)){var be=bp.clone();be.side=b.DoubleSide;a5[bp]=be}bp=a5[bp]}bp.opacity=!bp.opacity?1:bp.opacity;a9[bm.symbol]=bi;bw.push(bp);a4=bp;a4.name=bv.name==null||bv.name===""?bv.id:bv.name;bi++}}var a3;var bg=a4||new b.MeshLambertMaterial({color:14540253,shading:b.FlatShading,side:a7.doubleSided?b.DoubleSide:b.FrontSide});var bq=a7.mesh.geometry3js;var bn=null;if(bi>1){bg=new b.MeshFaceMaterial(bw);for(bs=0;bs<bq.faces.length;bs++){var bb=bq.faces[bs];bb.materialIndex=a9[bb.daeMaterial]}}if(ba!==undefined){aV(bq,ba);bg.morphTargets=true;a3=new b.SkinnedMesh(bq,bg,false);a3.skeleton=ba.skeleton;a3.skinController=ai[ba.url];a3.skinInstanceController=ba;a3.name="skin_"+M.length;M.push(a3)}else{if(bl!==undefined){q(bq,bl);bg.morphTargets=true;a3=new b.Mesh(bq,bg);a3.name="morph_"+j.length;j.push(a3)}else{a3=new b.Mesh(bq,bg)}}if(bn){bn.objectsWhoWantThisMaterial.push(a3)}br.geometries.length>1?bh.add(a3):bh=a3}}for(bu=0;bu<br.cameras.length;bu++){var bk=br.cameras[bu];var bz=ah[bk.url];bh=new b.PerspectiveCamera(bz.fov,bz.aspect_ratio,bz.znear,bz.zfar)}bh.name=br.name||br.id||"";bh.matrix=br.matrix;var a6=br.matrix.decompose();bh.position=a6[0];bh.quaternion=a6[1];bh.useQuaternion=true;bh.scale=a6[2];if(ae.centerGeometry&&bh.geometry){var bx=b.GeometryUtils.center(bh.geometry);bx.multiply(bh.scale);bx.applyQuaternion(bh.quaternion);bh.position.sub(bx)}for(bu=0;bu<br.nodes.length;bu++){bh.add(h(br.nodes[bu],br))}return bh}function r(a3,a4){for(var a2=0;a2<a3.joints.length;a2++){if(a3.joints[a2]==a4){return a2}}}function N(a2){return ap.evaluate(".//dae:library_nodes//dae:node[@id='"+a2+"']",ap,aY,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext()}function u(a4){var a7=[];var a3=1000000;var a8=-1000000;for(var a2 in R){var a5=R[a2];for(var a6=0;a6<a5.channel.length;a6++){var a9=a5.channel[a6];var ba=a5.sampler[a6];var a2=a9.target.split("/")[0];if(a2==a4.id){ba.create();a9.sampler=ba;a3=Math.min(a3,ba.startTime);a8=Math.max(a8,ba.endTime);a7.push(a9)}}}if(a7.length){a4.startTime=a3;a4.endTime=a8}return a7}function aX(a7){var a5=10000000;for(var a4=0;a4<a7.channels.length;a4++){var a3=a7.channels[a4].sampler;for(var a2=0;a2<a3.input.length-1;a2++){var a8=a3.input[a2];var a6=a3.input[a2+1];a5=Math.min(a5,a6-a8)}}return a5}function ad(a3,bb){var a4={};var a6,a5;for(a6=0;a6<a3.channels.length;a6++){var a7=a3.channels[a6];a4[a7.sid]=a7}var a9=new b.Matrix4();for(a6=0;a6<a3.transforms.length;a6++){var a2=a3.transforms[a6];var a7=a4[a2.sid];if(a7!==undefined){var a8=a7.sampler;var ba;for(a5=0;a5<a8.input.length-1;a5++){if(a8.input[a5+1]>bb){ba=a8.output[a5];break}}if(ba!==undefined){if(ba instanceof b.Matrix4){a9.multiplyMatrices(a9,ba)}else{a9.multiplyMatrices(a9,a2.matrix)}}else{a9.multiplyMatrices(a9,a2.matrix)}}else{a9.multiplyMatrices(a9,a2.matrix)}}return a9}function aH(bc){if(bc.channels&&bc.channels.length){var ba=[],bg=[];for(var be=0,a7=bc.channels.length;be<a7;be++){var bj=bc.channels[be],a2=bj.fullSid,bb=bj.sampler,a8=bb.input,a9=bc.getTransformBySid(bj.sid),a3;if(bj.arrIndices){a3=[];for(var bd=0,bf=bj.arrIndices.length;bd<bf;bd++){a3[bd]=aC(bj.arrIndices[bd])}}else{a3=W(bj.member)}if(a9){if(bg.indexOf(a2)===-1){bg.push(a2)}for(var bd=0,bf=a8.length;bd<bf;bd++){var a6=a8[bd],bh=bb.getData(a9.type,bd),bi=ar(ba,a6);if(!bi){bi=new aj(a6);var a5=z(ba,a6);ba.splice(a5==-1?ba.length:a5,0,bi)}bi.addTarget(a2,a9,a3,bh)}}else{console.log('Could not find transform "'+bj.sid+'" in node '+bc.id)}}for(var be=0;be<bg.length;be++){var a4=bg[be];for(var bd=0;bd<ba.length;bd++){var bi=ba[bd];if(!bi.hasTarget(a4)){x(ba,bi,bd,a4)}}}bc.keys=ba;bc.sids=bg}}function ar(a5,a7){var a6=null;for(var a4=0,a2=a5.length;a4<a2&&a6==null;a4++){var a3=a5[a4];if(a3.time===a7){a6=a3}else{if(a3.time>a7){break}}}return a6}function z(a6,a7){var a3=-1;for(var a5=0,a2=a6.length;a5<a2&&a3==-1;a5++){var a4=a6[a5];if(a4.time>=a7){a3=a5}}return a3}function x(bc,a9,ba,a7){var bd=aA(bc,a7,ba?ba-1:0),a8=n(bc,a7,ba+1);if(bd&&a8){var a3=(a9.time-bd.time)/(a8.time-bd.time),bb=bd.getTarget(a7),a6=a8.getTarget(a7).data,a2=bb.data,a5;if(bb.type==="matrix"){a5=a2}else{if(a2.length){a5=[];for(var a4=0;a4<a2.length;++a4){a5[a4]=a2[a4]+(a6[a4]-a2[a4])*a3}}else{a5=a2+(a6-a2)*a3}}a9.addTarget(a7,bb.transform,bb.member,a5)}}function n(a4,a5,a2){for(;a2<a4.length;a2++){var a3=a4[a2];if(a3.hasTarget(a5)){return a3}}return null}function aA(a4,a5,a2){a2=a2>=0?a2:a2+a4.length;for(;a2>=0;a2--){var a3=a4[a2];if(a3.hasTarget(a5)){return a3}}return null}function ag(){this.id="";this.init_from=""}ag.prototype.parse=function(a3){this.id=a3.getAttribute("id");for(var a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];if(a4.nodeName=="init_from"){this.init_from=a4.textContent}}return this};function L(){this.id="";this.name="";this.type="";this.skin=null;this.morph=null}L.prototype.parse=function(a3){this.id=a3.getAttribute("id");this.name=a3.getAttribute("name");this.type="none";for(var a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];switch(a4.nodeName){case"skin":this.skin=(new t()).parse(a4);this.type=a4.nodeName;break;case"morph":this.morph=(new m()).parse(a4);this.type=a4.nodeName;break;default:break}}return this};function m(){this.method=null;this.source=null;this.targets=null;this.weights=null}m.prototype.parse=function(a6){var a4={};var a2=[];var a5;this.method=a6.getAttribute("method");this.source=a6.getAttribute("source").replace(/^#/,"");for(a5=0;a5<a6.childNodes.length;a5++){var a8=a6.childNodes[a5];if(a8.nodeType!=1){continue}switch(a8.nodeName){case"source":var a7=(new aP()).parse(a8);a4[a7.id]=a7;break;case"targets":a2=this.parseInputs(a8);break;default:console.log(a8.nodeName);break}}for(a5=0;a5<a2.length;a5++){var a3=a2[a5];var a7=a4[a3.source];switch(a3.semantic){case"MORPH_TARGET":this.targets=a7.read();break;case"MORPH_WEIGHT":this.weights=a7.read();break;default:break}}return this};m.prototype.parseInputs=function(a4){var a2=[];for(var a3=0;a3<a4.childNodes.length;a3++){var a5=a4.childNodes[a3];if(a5.nodeType!=1){continue}switch(a5.nodeName){case"input":a2.push((new e()).parse(a5));break;default:break}}return a2};function t(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}t.prototype.parse=function(a5){var a3={};var a2,a6;this.source=a5.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var a4=0;a4<a5.childNodes.length;a4++){var a9=a5.childNodes[a4];if(a9.nodeType!=1){continue}switch(a9.nodeName){case"bind_shape_matrix":var a7=i(a9.textContent);this.bindShapeMatrix=an(a7);break;case"source":var a8=new aP().parse(a9);a3[a8.id]=a8;break;case"joints":a2=a9;break;case"vertex_weights":a6=a9;break;default:console.log(a9.nodeName);break}}this.parseJoints(a2,a3);this.parseWeights(a6,a3);return this};t.prototype.parseJoints=function(a5,a3){for(var a4=0;a4<a5.childNodes.length;a4++){var a7=a5.childNodes[a4];if(a7.nodeType!=1){continue}switch(a7.nodeName){case"input":var a2=(new e()).parse(a7);var a6=a3[a2.source];if(a2.semantic=="JOINT"){this.joints=a6.read()}else{if(a2.semantic=="INV_BIND_MATRIX"){this.invBindMatrices=a6.read()}}break;default:break}}};t.prototype.parseWeights=function(a7,a2){var bg,bd,ba=[];for(var a8=0;a8<a7.childNodes.length;a8++){var a3=a7.childNodes[a8];if(a3.nodeType!=1){continue}switch(a3.nodeName){case"input":ba.push((new e()).parse(a3));break;case"v":bg=aW(a3.textContent);break;case"vcount":bd=aW(a3.textContent);break;default:break}}var bb=0;for(var a8=0;a8<bd.length;a8++){var a5=bd[a8];var a9=[];for(var a6=0;a6<a5;a6++){var bc={};for(var a4=0;a4<ba.length;a4++){var be=ba[a4];var bf=bg[bb+be.offset];switch(be.semantic){case"JOINT":bc.joint=bf;break;case"WEIGHT":bc.weight=a2[be.source].data[bf];break;default:break}}a9.push(bc);bb+=ba.length}for(var a6=0;a6<a9.length;a6++){a9[a6].index=a8}this.weights.push(a9)}};function aN(){this.id="";this.name="";this.nodes=[];this.scene=new b.Object3D()}aN.prototype.getChildById=function(a5,a2){for(var a3=0;a3<this.nodes.length;a3++){var a4=this.nodes[a3].getChildById(a5,a2);if(a4){return a4}}return null};aN.prototype.getChildBySid=function(a2,a3){for(var a4=0;a4<this.nodes.length;a4++){var a5=this.nodes[a4].getChildBySid(a2,a3);if(a5){return a5}}return null};aN.prototype.parse=function(a3){this.id=a3.getAttribute("id");this.name=a3.getAttribute("name");this.nodes=[];for(var a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];if(a4.nodeType!=1){continue}switch(a4.nodeName){case"node":this.nodes.push((new aE()).parse(a4));break;default:break}}return this};function aE(){this.id="";this.name="";this.sid="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new b.Matrix4()}aE.prototype.getChannelForTransform=function(bc){for(var a8=0;a8<this.channels.length;a8++){var a9=this.channels[a8];var a6=a9.target.split("/");var a2=a6.shift();var a3=a6.shift();var ba=(a3.indexOf(".")>=0);var bb=(a3.indexOf("(")>=0);var a5;var a7;if(ba){a6=a3.split(".");a3=a6.shift();a7=a6.shift()}else{if(bb){a5=a3.split("(");a3=a5.shift();for(var a4=0;a4<a5.length;a4++){a5[a4]=parseInt(a5[a4].replace(/\)/,""))}}}if(a3==bc){a9.info={sid:a3,dotSyntax:ba,arrSyntax:bb,arrIndices:a5};return a9}}return null};aE.prototype.getChildById=function(a5,a2){if(this.id==a5){return this}if(a2){for(var a3=0;a3<this.nodes.length;a3++){var a4=this.nodes[a3].getChildById(a5,a2);if(a4){return a4}}}return null};aE.prototype.getChildBySid=function(a2,a3){if(this.sid==a2){return this}if(a3){for(var a4=0;a4<this.nodes.length;a4++){var a5=this.nodes[a4].getChildBySid(a2,a3);if(a5){return a5}}}return null};aE.prototype.getTransformBySid=function(a2){for(var a3=0;a3<this.transforms.length;a3++){if(this.transforms[a3].sid==a2){return this.transforms[a3]}}return null};aE.prototype.parse=function(a4){var a2;this.id=a4.getAttribute("id");this.sid=a4.getAttribute("sid");this.name=a4.getAttribute("name");this.type=a4.getAttribute("type");this.type=this.type=="JOINT"?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.cameras=[];this.controllers=[];this.matrix=new b.Matrix4();for(var a3=0;a3<a4.childNodes.length;a3++){var a6=a4.childNodes[a3];if(a6.nodeType!=1){continue}switch(a6.nodeName){case"node":this.nodes.push((new aE()).parse(a6));break;case"instance_camera":this.cameras.push((new ay()).parse(a6));break;case"instance_controller":this.controllers.push((new G()).parse(a6));break;case"instance_geometry":this.geometries.push((new az()).parse(a6));break;case"instance_light":break;case"instance_node":a2=a6.getAttribute("url").replace(/^#/,"");var a5=N(a2);if(a5){this.nodes.push((new aE()).parse(a5))}break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new aJ()).parse(a6));break;case"extra":break;default:console.log(a6.nodeName);break}}this.channels=u(this);aH(this);this.updateMatrix();return this};aE.prototype.updateMatrix=function(){this.matrix.identity();for(var a2=0;a2<this.transforms.length;a2++){this.transforms[a2].apply(this.matrix)}};function aJ(){this.sid="";this.type="";this.data=[];this.obj=null}aJ.prototype.parse=function(a2){this.sid=a2.getAttribute("sid");this.type=a2.nodeName;this.data=i(a2.textContent);this.convert();return this};aJ.prototype.convert=function(){switch(this.type){case"matrix":this.obj=an(this.data);break;case"rotate":this.angle=b.Math.degToRad(this.data[3]);case"translate":U(this.data,-1);this.obj=new b.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":U(this.data,1);this.obj=new b.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type);break}};aJ.prototype.apply=function(a2){switch(this.type){case"matrix":a2.multiply(this.obj);break;case"translate":a2.translate(this.obj);break;case"rotate":a2.rotateByAxis(this.obj,this.angle);break;case"scale":a2.scale(this.obj);break}};aJ.prototype.update=function(a4,a5){var a2=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(!a5){this.obj.copy(a4)}else{if(a5.length===1){switch(a5[0]){case 0:this.obj.n11=a4[0];this.obj.n21=a4[1];this.obj.n31=a4[2];this.obj.n41=a4[3];break;case 1:this.obj.n12=a4[0];this.obj.n22=a4[1];this.obj.n32=a4[2];this.obj.n42=a4[3];break;case 2:this.obj.n13=a4[0];this.obj.n23=a4[1];this.obj.n33=a4[2];this.obj.n43=a4[3];break;case 3:this.obj.n14=a4[0];this.obj.n24=a4[1];this.obj.n34=a4[2];this.obj.n44=a4[3];break}}else{if(a5.length===2){var a3="n"+(a5[0]+1)+(a5[1]+1);this.obj[a3]=a4}else{console.log("Incorrect addressing of matrix in transform.")}}}break;case"translate":case"scale":if(Object.prototype.toString.call(a5)==="[object Array]"){a5=a2[a5[0]]}switch(a5){case"X":this.obj.x=a4;break;case"Y":this.obj.y=a4;break;case"Z":this.obj.z=a4;break;default:this.obj.x=a4[0];this.obj.y=a4[1];this.obj.z=a4[2];break}break;case"rotate":if(Object.prototype.toString.call(a5)==="[object Array]"){a5=a2[a5[0]]}switch(a5){case"X":this.obj.x=a4;break;case"Y":this.obj.y=a4;break;case"Z":this.obj.z=a4;break;case"ANGLE":this.angle=b.Math.degToRad(a4);break;default:this.obj.x=a4[0];this.obj.y=a4[1];this.obj.z=a4[2];this.angle=b.Math.degToRad(a4[3]);break}break}};function G(){this.url="";this.skeleton=[];this.instance_material=[]}G.prototype.parse=function(a4){this.url=a4.getAttribute("url").replace(/^#/,"");this.skeleton=[];this.instance_material=[];for(var a3=0;a3<a4.childNodes.length;a3++){var a6=a4.childNodes[a3];if(a6.nodeType!==1){continue}switch(a6.nodeName){case"skeleton":this.skeleton.push(a6.textContent.replace(/^#/,""));break;case"bind_material":var a5=ap.evaluate(".//dae:instance_material",a6,aY,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(a5){var a2=a5.iterateNext();while(a2){this.instance_material.push((new l()).parse(a2));a2=a5.iterateNext()}}break;case"extra":break;default:break}}return this};function l(){this.symbol="";this.target=""}l.prototype.parse=function(a2){this.symbol=a2.getAttribute("symbol");this.target=a2.getAttribute("target").replace(/^#/,"");return this};function az(){this.url="";this.instance_material=[]}az.prototype.parse=function(a4){this.url=a4.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var a3=0;a3<a4.childNodes.length;a3++){var a6=a4.childNodes[a3];if(a6.nodeType!=1){continue}if(a6.nodeName=="bind_material"){var a5=ap.evaluate(".//dae:instance_material",a6,aY,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(a5){var a2=a5.iterateNext();while(a2){this.instance_material.push((new l()).parse(a2));a2=a5.iterateNext()}}break}}return this};function aD(){this.id="";this.mesh=null}aD.prototype.parse=function(a3){this.id=a3.getAttribute("id");aI(this,a3);for(var a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];switch(a4.nodeName){case"mesh":this.mesh=(new am(this)).parse(a4);break;case"extra":break;default:break}}return this};function am(a2){this.geometry=a2.id;this.primitives=[];this.vertices=null;this.geometry3js=null}am.prototype.parse=function(a6){this.primitives=[];var a5,a4;for(a5=0;a5<a6.childNodes.length;a5++){var a7=a6.childNodes[a5];switch(a7.nodeName){case"source":aZ(a7);break;case"vertices":this.vertices=(new al()).parse(a7);break;case"triangles":this.primitives.push((new ab().parse(a7)));break;case"polygons":this.primitives.push((new D().parse(a7)));break;case"polylist":this.primitives.push((new aF().parse(a7)));break;default:break}}this.geometry3js=new b.Geometry();var a3=ac[this.vertices.input.POSITION.source].data;for(a5=0;a5<a3.length;a5+=3){this.geometry3js.vertices.push(Y(a3,a5).clone())}for(a5=0;a5<this.primitives.length;a5++){var a2=this.primitives[a5];a2.setVertices(this.vertices);this.handlePrimitive(a2,this.geometry3js)}this.geometry3js.computeCentroids();this.geometry3js.computeFaceNormals();if(this.geometry3js.calcNormals){this.geometry3js.computeVertexNormals();delete this.geometry3js.calcNormals}this.geometry3js.computeBoundingBox();return this};am.prototype.handlePrimitive=function(a9,a4){var br,bq,bk=a9.p,be=a9.inputs;var a2,bj,a5;var bd,bp;var bn=0,bl=3,bh=0;var bz=[];for(br=0;br<be.length;br++){a2=be[br];var bm=a2.offset+1;bh=(bh<bm)?bm:bh;switch(a2.semantic){case"TEXCOORD":bz.push(a2.set);break}}for(var bb=0;bb<bk.length;++bb){var bo=bk[bb],bt=0;while(bt<bo.length){var a8=[];var bs=[];var bx=null;var bf=[];if(a9.vcount){bl=a9.vcount.length?a9.vcount[bn++]:a9.vcount}else{bl=bo.length/bh}for(br=0;br<bl;br++){for(bq=0;bq<be.length;bq++){a2=be[bq];bd=ac[a2.source];bj=bo[bt+(br*bh)+a2.offset];bp=bd.accessor.params.length;a5=bj*bp;switch(a2.semantic){case"VERTEX":a8.push(bj);break;case"NORMAL":bs.push(Y(bd.data,a5));break;case"TEXCOORD":bx=bx||{};if(bx[a2.set]===undefined){bx[a2.set]=[]}bx[a2.set].push(new b.Vector2(bd.data[a5],bd.data[a5+1]));break;case"COLOR":bf.push(new b.Color().setRGB(bd.data[a5],bd.data[a5+1],bd.data[a5+2]));break;default:break}}}if(bs.length==0){a2=this.vertices.input.NORMAL;if(a2){bd=ac[a2.source];bp=bd.accessor.params.length;for(var ba=0,bc=a8.length;ba<bc;ba++){bs.push(Y(bd.data,a8[ba]*bp))}}else{a4.calcNormals=true}}if(!bx){bx={};a2=this.vertices.input.TEXCOORD;if(a2){bz.push(a2.set);bd=ac[a2.source];bp=bd.accessor.params.length;for(var ba=0,bc=a8.length;ba<bc;ba++){a5=a8[ba]*bp;if(bx[a2.set]===undefined){bx[a2.set]=[]}bx[a2.set].push(new b.Vector2(bd.data[a5],1-bd.data[a5+1]))}}}if(bf.length==0){a2=this.vertices.input.COLOR;if(a2){bd=ac[a2.source];bp=bd.accessor.params.length;for(var ba=0,bc=a8.length;ba<bc;ba++){a5=a8[ba]*bp;bf.push(new b.Color().setRGB(bd.data[a5],bd.data[a5+1],bd.data[a5+2]))}}}var a6=null,a7=[],bi,bg;if(bl===3){a7.push(new b.Face3(a8[0],a8[1],a8[2],bs,bf.length?bf:new b.Color()))}else{if(bl===4){a7.push(new b.Face4(a8[0],a8[1],a8[2],a8[3],bs,bf.length?bf:new b.Color()))}else{if(bl>4&&ae.subdivideFaces){var a3=bf.length?bf:new b.Color(),bw,bv,bu,bB,bA,by;for(bq=1;bq<bl-1;){a7.push(new b.Face3(a8[0],a8[bq],a8[bq+1],[bs[0],bs[bq++],bs[bq]],a3))}}}}if(a7.length){for(var ba=0,bc=a7.length;ba<bc;ba++){a6=a7[ba];a6.daeMaterial=a9.material;a4.faces.push(a6);for(bq=0;bq<bz.length;bq++){bi=bx[bz[bq]];if(bl>4){bg=[bi[0],bi[ba+1],bi[ba+2]]}else{if(bl===4){bg=[bi[0],bi[1],bi[2],bi[3]]}else{bg=[bi[0],bi[1],bi[2]]}}if(!a4.faceVertexUvs[bq]){a4.faceVertexUvs[bq]=[]}a4.faceVertexUvs[bq].push(bg)}}}else{console.log("dropped face with vcount "+bl+" for geometry with id: "+a4.id)}bt+=bh*bl}}};function D(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new b.Geometry()}D.prototype.setVertices=function(a2){for(var a3=0;a3<this.inputs.length;a3++){if(this.inputs[a3].source==a2.id){this.inputs[a3].source=a2.input.POSITION.source}}};D.prototype.parse=function(a3){this.material=a3.getAttribute("material");this.count=p(a3,"count",0);for(var a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];switch(a4.nodeName){case"input":this.inputs.push((new e()).parse(a3.childNodes[a2]));break;case"vcount":this.vcount=aW(a4.textContent);break;case"p":this.p.push(aW(a4.textContent));break;case"ph":console.warn("polygon holes not yet supported!");break;default:break}}return this};function aF(){D.call(this);this.vcount=[]}aF.prototype=Object.create(D.prototype);function ab(){D.call(this);this.vcount=3}ab.prototype=Object.create(D.prototype);function aG(){this.source="";this.count=0;this.stride=0;this.params=[]}aG.prototype.parse=function(a3){this.params=[];this.source=a3.getAttribute("source");this.count=p(a3,"count",0);this.stride=p(a3,"stride",0);for(var a2=0;a2<a3.childNodes.length;a2++){var a5=a3.childNodes[a2];if(a5.nodeName=="param"){var a4={};a4.name=a5.getAttribute("name");a4.type=a5.getAttribute("type");this.params.push(a4)}}return this};function al(){this.input={}}al.prototype.parse=function(a4){this.id=a4.getAttribute("id");for(var a3=0;a3<a4.childNodes.length;a3++){if(a4.childNodes[a3].nodeName=="input"){var a2=(new e()).parse(a4.childNodes[a3]);this.input[a2.semantic]=a2}}return this};function e(){this.semantic="";this.offset=0;this.source="";this.set=0}e.prototype.parse=function(a2){this.semantic=a2.getAttribute("semantic");this.source=a2.getAttribute("source").replace(/^#/,"");this.set=p(a2,"set",-1);this.offset=p(a2,"offset",0);if(this.semantic=="TEXCOORD"&&this.set<0){this.set=0}return this};function aP(a2){this.id=a2;this.type=null}aP.prototype.parse=function(a4){this.id=a4.getAttribute("id");for(var a3=0;a3<a4.childNodes.length;a3++){var a5=a4.childNodes[a3];switch(a5.nodeName){case"bool_array":this.data=ak(a5.textContent);this.type=a5.nodeName;break;case"float_array":this.data=i(a5.textContent);this.type=a5.nodeName;break;case"int_array":this.data=aW(a5.textContent);this.type=a5.nodeName;break;case"IDREF_array":case"Name_array":this.data=I(a5.textContent);this.type=a5.nodeName;break;case"technique_common":for(var a2=0;a2<a5.childNodes.length;a2++){if(a5.childNodes[a2].nodeName=="accessor"){this.accessor=(new aG()).parse(a5.childNodes[a2]);break}}break;default:break}}return this};aP.prototype.read=function(){var a3=[];var a6=this.accessor.params[0];switch(a6.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var a4=0;a4<this.data.length;a4+=16){var a5=this.data.slice(a4,a4+16);var a2=an(a5);a3.push(a2)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+a6.type+".");break}return a3};function g(){this.id="";this.name="";this.instance_effect=null}g.prototype.parse=function(a3){this.id=a3.getAttribute("id");this.name=a3.getAttribute("name");for(var a2=0;a2<a3.childNodes.length;a2++){if(a3.childNodes[a2].nodeName=="instance_effect"){this.instance_effect=(new A()).parse(a3.childNodes[a2]);break}}return this};function aq(){this.color=new b.Color(0);this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texture=null;this.texcoord=null;this.texOpts=null}aq.prototype.isColor=function(){return(this.texture==null)};aq.prototype.isTexture=function(){return(this.texture!=null)};aq.prototype.parse=function(a4){for(var a3=0;a3<a4.childNodes.length;a3++){var a5=a4.childNodes[a3];if(a5.nodeType!=1){continue}switch(a5.nodeName){case"color":var a2=i(a5.textContent);this.color=new b.Color(0);this.color.setRGB(a2[0],a2[1],a2[2]);this.color.a=a2[3];break;case"texture":this.texture=a5.getAttribute("texture");this.texcoord=a5.getAttribute("texcoord");this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1,};this.parseTexture(a5);break;default:break}}return this};aq.prototype.parseTexture=function(a3){if(!a3.childNodes){return this}if(a3.childNodes[1]&&a3.childNodes[1].nodeName==="extra"){a3=a3.childNodes[1];if(a3.childNodes[1]&&a3.childNodes[1].nodeName==="technique"){a3=a3.childNodes[1]}}for(var a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];switch(a4.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[a4.nodeName]=parseFloat(a4.textContent);break;case"wrapU":case"wrapV":this.texOpts[a4.nodeName]=parseInt(a4.textContent);break;default:this.texOpts[a4.nodeName]=a4.textContent;break}}return this};function av(a3,a2){this.type=a3;this.effect=a2;this.material=null}av.prototype.parse=function(a3){for(var a2=0;a2<a3.childNodes.length;a2++){var a5=a3.childNodes[a2];if(a5.nodeType!=1){continue}switch(a5.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":case"normal":this[a5.nodeName]=(new aq()).parse(a5);break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var a4=at(a5,".//dae:float");if(a4.length>0){this[a5.nodeName]=parseFloat(a4[0].textContent)}break;default:break}}this.create();return this};av.prototype.create=function(){var ba={};var be=(this["transparency"]!==undefined&&this["transparency"]<1);var a7=0;var bb=null;var a8=null;function a3(){var bf=0,bg=null;if(a8&&a8.numberOfAwaitedTextures){a8.numberOfAwaitedTextures--;if(a8.numberOfAwaitedTextures===0){delete a8.numberOfAwaitedTextures}}}for(var a2 in this){switch(a2){case"ambient":case"emission":case"diffuse":case"specular":case"normal":var bd=this[a2];if(bd instanceof aq){if(bd.isTexture()){var a5=bd.texture;var bc=this.effect.sampler[a5].source;if(bc){var a4=this.effect.surface[bc];var a6=o[a4.init_from];if(a6){var a9=b.ImageUtils.loadTexture(aT+a6.init_from,undefined,a3,null,true);a7++;a9.wrapS=bd.texOpts.wrapU?b.RepeatWrapping:b.ClampToEdgeWrapping;a9.wrapT=bd.texOpts.wrapV?b.RepeatWrapping:b.ClampToEdgeWrapping;a9.offset.x=bd.texOpts.offsetU;a9.offset.y=bd.texOpts.offsetV;a9.repeat.x=bd.texOpts.repeatU;a9.repeat.y=bd.texOpts.repeatV;if(a2==="normal"){ba.normalMap=a9}else{ba.map=a9}if(a2==="emission"){ba.emissive=16777215}}}}else{if(a2==="diffuse"||!be){if(a2==="emission"){ba.emissive=bd.color.getHex()}else{ba[a2]=bd.color.getHex()}}}}break;case"shininess":ba[a2]=this[a2];break;case"reflectivity":ba[a2]=this[a2];if(ba[a2]>0){ba.envMap=ae.defaultEnvMap}ba.combine=b.MixOperation;break;case"index_of_refraction":ba.refractionRatio=this[a2];if(this[a2]!==1){ba.envMap=ae.defaultEnvMap}break;case"transparency":if(be){ba.transparent=true;ba.opacity=this[a2];be=true}break;default:break}}ba.shading=S;ba.side=this.effect.doubleSided?b.DoubleSide:b.FrontSide;switch(this.type){case"constant":if(ba.emissive!=undefined){ba.color=ba.emissive}a8=new b.MeshBasicMaterial(ba);break;case"phong":case"blinn":if(ba.diffuse!=undefined){ba.color=ba.diffuse}a8=new b.MeshPhongMaterial(ba);break;case"lambert":default:if(ba.diffuse!=undefined){ba.color=ba.diffuse}a8=new b.MeshLambertMaterial(ba);break}this.material=a8;return this.material};function f(a2){this.effect=a2;this.init_from=null;this.format=null}f.prototype.parse=function(a3){for(var a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];if(a4.nodeType!=1){continue}switch(a4.nodeName){case"init_from":this.init_from=a4.textContent;break;case"format":this.format=a4.textContent;break;default:console.log("unhandled Surface prop: "+a4.nodeName);break}}return this};function P(a2){this.effect=a2;this.source=null;this.wrap_s=null;this.wrap_t=null;this.minfilter=null;this.magfilter=null;this.mipfilter=null}P.prototype.parse=function(a3){for(var a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];if(a4.nodeType!=1){continue}switch(a4.nodeName){case"source":this.source=a4.textContent;break;case"minfilter":this.minfilter=a4.textContent;break;case"magfilter":this.magfilter=a4.textContent;break;case"mipfilter":this.mipfilter=a4.textContent;break;case"wrap_s":this.wrap_s=a4.textContent;break;case"wrap_t":this.wrap_t=a4.textContent;break;default:console.log("unhandled Sampler2D prop: "+a4.nodeName);break}}return this};function Q(){this.id="";this.name="";this.shader=null;this.surface={};this.sampler={}}Q.prototype.create=function(){if(this.shader==null){return null}};Q.prototype.parse=function(a3){this.id=a3.getAttribute("id");this.name=a3.getAttribute("name");aI(this,a3);this.shader=null;for(var a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];if(a4.nodeType!=1){continue}switch(a4.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(a4));break;default:break}}return this};Q.prototype.parseNewparam=function(a4){var a2=a4.getAttribute("sid");for(var a3=0;a3<a4.childNodes.length;a3++){var a5=a4.childNodes[a3];if(a5.nodeType!=1){continue}switch(a5.nodeName){case"surface":this.surface[a2]=(new f(this)).parse(a5);break;case"sampler2D":this.sampler[a2]=(new P(this)).parse(a5);break;case"extra":break;default:console.log(a5.nodeName);break}}};Q.prototype.parseProfileCOMMON=function(a4){var a5;for(var a3=0;a3<a4.childNodes.length;a3++){var a6=a4.childNodes[a3];if(a6.nodeType!=1){continue}switch(a6.nodeName){case"profile_COMMON":this.parseProfileCOMMON(a6);break;case"technique":a5=a6;break;case"newparam":this.parseNewparam(a6);break;case"image":var a2=(new ag()).parse(a6);o[a2.id]=a2;break;case"extra":break;default:console.log(a6.nodeName);break}}return a5};Q.prototype.parseTechnique=function(a3){for(var a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];if(a4.nodeType!=1){continue}switch(a4.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=(new av(a4.nodeName,this)).parse(a4);break;default:break}}};function A(){this.url=""}A.prototype.parse=function(a2){this.url=a2.getAttribute("url").replace(/^#/,"");return this};function aU(){this.id="";this.name="";this.source={};this.sampler=[];this.channel=[]}aU.prototype.parse=function(a4){this.id=a4.getAttribute("id");this.name=a4.getAttribute("name");this.source={};for(var a3=0;a3<a4.childNodes.length;a3++){var a7=a4.childNodes[a3];if(a7.nodeType!=1){continue}switch(a7.nodeName){case"animation":var a5=(new aU()).parse(a7);for(var a6 in a5.source){this.source[a6]=a5.source[a6]}for(var a2=0;a2<a5.channel.length;a2++){this.channel.push(a5.channel[a2]);this.sampler.push(a5.sampler[a2])}break;case"source":var a6=(new aP()).parse(a7);this.source[a6.id]=a6;break;case"sampler":this.sampler.push((new H(this)).parse(a7));break;case"channel":this.channel.push((new O(this)).parse(a7));break;default:break}}return this};function O(a2){this.animation=a2;this.source="";this.target="";this.fullSid=null;this.sid=null;this.dotSyntax=null;this.arrSyntax=null;this.arrIndices=null;this.member=null}O.prototype.parse=function(a4){this.source=a4.getAttribute("source").replace(/^#/,"");this.target=a4.getAttribute("target");var a6=this.target.split("/");var a9=a6.shift();var a2=a6.shift();var a8=(a2.indexOf(".")>=0);var a5=(a2.indexOf("(")>=0);if(a8){a6=a2.split(".");this.sid=a6.shift();this.member=a6.shift()}else{if(a5){var a7=a2.split("(");this.sid=a7.shift();for(var a3=0;a3<a7.length;a3++){a7[a3]=parseInt(a7[a3].replace(/\)/,""))}this.arrIndices=a7}else{this.sid=a2}}this.fullSid=a2;this.dotSyntax=a8;this.arrSyntax=a5;return this};function H(a2){this.id="";this.animation=a2;this.inputs=[];this.input=null;this.output=null;this.strideOut=null;this.interpolation=null;this.startTime=null;this.endTime=null;this.duration=0}H.prototype.parse=function(a3){this.id=a3.getAttribute("id");this.inputs=[];for(var a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];if(a4.nodeType!=1){continue}switch(a4.nodeName){case"input":this.inputs.push((new e()).parse(a4));break;default:break}}return this};H.prototype.create=function(){for(var a3=0;a3<this.inputs.length;a3++){var a2=this.inputs[a3];var a4=this.animation.source[a2.source];switch(a2.semantic){case"INPUT":this.input=a4.read();break;case"OUTPUT":this.output=a4.read();this.strideOut=a4.accessor.stride;break;case"INTERPOLATION":this.interpolation=a4.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(a2.semantic);break}}this.startTime=0;this.endTime=0;this.duration=0;if(this.input.length){this.startTime=100000000;this.endTime=-100000000;for(var a3=0;a3<this.input.length;a3++){this.startTime=Math.min(this.startTime,this.input[a3]);this.endTime=Math.max(this.endTime,this.input[a3])}this.duration=this.endTime-this.startTime}};H.prototype.getData=function(a4,a2){var a5;if(a4==="matrix"&&this.strideOut===16){a5=this.output[a2]}else{if(this.strideOut>1){a5=[];a2*=this.strideOut;for(var a3=0;a3<this.strideOut;++a3){a5[a3]=this.output[a2+a3]}if(this.strideOut===3){switch(a4){case"rotate":case"translate":U(a5,-1);break;case"scale":U(a5,1);break}}else{if(this.strideOut===4&&a4==="matrix"){U(a5,-1)}}}else{a5=this.output[a2]}}return a5};function aj(a2){this.targets=[];this.time=a2}aj.prototype.addTarget=function(a5,a2,a4,a3){this.targets.push({sid:a5,member:a4,transform:a2,data:a3})};aj.prototype.apply=function(a2){for(var a3=0;a3<this.targets.length;++a3){var a4=this.targets[a3];if(!a2||a4.sid===a2){a4.transform.update(a4.data,a4.member)}}};aj.prototype.getTarget=function(a3){for(var a2=0;a2<this.targets.length;++a2){if(this.targets[a2].sid===a3){return this.targets[a2]}}return null};aj.prototype.hasTarget=function(a3){for(var a2=0;a2<this.targets.length;++a2){if(this.targets[a2].sid===a3){return true}}return false};aj.prototype.interpolate=function(bb,a4){for(var a8=0;a8<this.targets.length;++a8){var ba=this.targets[a8],a2=bb.getTarget(ba.sid),a7;if(ba.transform.type!=="matrix"&&a2){var a5=(a4-this.time)/(bb.time-this.time),a9=a2.data,a3=ba.data;if(a5<0||a5>1){console.log("Key.interpolate: Warning! Scale out of bounds:"+a5);a5=a5<0?0:1}if(a3.length){a7=[];for(var a6=0;a6<a3.length;++a6){a7[a6]=a3[a6]+(a9[a6]-a3[a6])*a5}}else{a7=a3+(a9-a3)*a5}}else{a7=ba.data}ba.transform.update(a7,ba.member)}};function aR(){this.id="";this.name="";this.technique=""}aR.prototype.parse=function(a3){this.id=a3.getAttribute("id");this.name=a3.getAttribute("name");for(var a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];if(a4.nodeType!=1){continue}switch(a4.nodeName){case"optics":this.parseOptics(a4);break;default:break}}return this};aR.prototype.parseOptics=function(a6){for(var a5=0;a5<a6.childNodes.length;a5++){if(a6.childNodes[a5].nodeName=="technique_common"){var a8=a6.childNodes[a5];for(var a4=0;a4<a8.childNodes.length;a4++){this.technique=a8.childNodes[a4].nodeName;if(this.technique=="perspective"){var a7=a8.childNodes[a4];for(var a2=0;a2<a7.childNodes.length;a2++){var a9=a7.childNodes[a2];switch(a9.nodeName){case"yfov":this.yfov=a9.textContent;break;case"xfov":this.xfov=a9.textContent;break;case"znear":this.znear=a9.textContent;break;case"zfar":this.zfar=a9.textContent;break;case"aspect_ratio":this.aspect_ratio=a9.textContent;break}}}else{if(this.technique=="orthographic"){var a3=a8.childNodes[a4];for(var a2=0;a2<a3.childNodes.length;a2++){var a9=a3.childNodes[a2];switch(a9.nodeName){case"xmag":this.xmag=a9.textContent;break;case"ymag":this.ymag=a9.textContent;break;case"znear":this.znear=a9.textContent;break;case"zfar":this.zfar=a9.textContent;break;case"aspect_ratio":this.aspect_ratio=a9.textContent;break}}}}}}}return this};function ay(){this.url=""}ay.prototype.parse=function(a2){this.url=a2.getAttribute("url").replace(/^#/,"");return this};function aZ(a2){var a3=a2.getAttribute("id");if(ac[a3]!=undefined){return ac[a3]}ac[a3]=(new aP(a3)).parse(a2);return ac[a3]}function aY(a2){if(a2=="dae"){return"http://www.collada.org/2005/11/COLLADASchema"}return null}function ak(a6){var a3=I(a6);var a5=[];for(var a4=0,a2=a3.length;a4<a2;a4++){a5.push((a3[a4]=="true"||a3[a4]=="1")?true:false)}return a5}function i(a6){var a3=I(a6);var a5=[];for(var a4=0,a2=a3.length;a4<a2;a4++){a5.push(parseFloat(a3[a4]))}return a5}function aW(a6){var a3=I(a6);var a5=[];for(var a4=0,a2=a3.length;a4<a2;a4++){a5.push(parseInt(a3[a4],10))}return a5}function I(a2){return(a2.length>0)?v(a2).split(/\s+/):[]}function v(a2){return a2.replace(/^\s+/,"").replace(/\s+$/,"")}function a0(a4,a3,a2){if(a4.hasAttribute(a3)){return parseFloat(a4.getAttribute(a3))}else{return a2}}function p(a4,a3,a2){if(a4.hasAttribute(a3)){return parseInt(a4.getAttribute(a3),10)}else{return a2}}function aL(a4,a3,a2){if(a4.hasAttribute(a3)){return a4.getAttribute(a3)}else{return a2}}function a1(a4,a2){if(a4===undefined){var a3="0.";while(a3.length<a2+2){a3+="0"}return a3}a2=a2||2;var a5=a4.toString().split(".");a5[1]=a5.length>1?a5[1].substr(0,a2):"0";while(a5[1].length<a2){a5[1]+="0"}return a5.join(".")}function at(a3,a5){var a6=ap.evaluate(a5,a3,aY,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var a4=a6.iterateNext();var a2=[];while(a4){a2.push(a4);a4=a6.iterateNext()}return a2}function aI(a4,a2){a4.doubleSided=false;var a3=ap.evaluate(".//dae:extra//dae:double_sided",a2,aY,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(a3){a3=a3.iterateNext();if(a3&&parseInt(a3.textContent,10)===1){a4.doubleSided=true}}}function X(){if(!ae.convertUpAxis||ax===ae.upAxis){C=null}else{switch(ax){case"X":C=ae.upAxis==="Y"?"XtoY":"XtoZ";break;case"Y":C=ae.upAxis==="X"?"YtoX":"YtoZ";break;case"Z":C=ae.upAxis==="X"?"ZtoX":"ZtoY";break}}}function U(a4,a2){if(!ae.convertUpAxis||ax===ae.upAxis){return}switch(C){case"XtoY":var a3=a4[0];a4[0]=a2*a4[1];a4[1]=a3;break;case"XtoZ":var a3=a4[2];a4[2]=a4[1];a4[1]=a4[0];a4[0]=a3;break;case"YtoX":var a3=a4[0];a4[0]=a4[1];a4[1]=a2*a3;break;case"YtoZ":var a3=a4[1];a4[1]=a2*a4[2];a4[2]=a3;break;case"ZtoX":var a3=a4[0];a4[0]=a4[1];a4[1]=a4[2];a4[2]=a3;break;case"ZtoY":var a3=a4[1];a4[1]=a4[2];a4[2]=a2*a3;break}}function Y(a3,a4){var a2=[a3[a4],a3[a4+1],a3[a4+2]];U(a2,-1);return new b.Vector3(a2[0],a2[1],a2[2])}function an(a3){if(ae.convertUpAxis){var a2=[a3[0],a3[4],a3[8]];U(a2,-1);a3[0]=a2[0];a3[4]=a2[1];a3[8]=a2[2];a2=[a3[1],a3[5],a3[9]];U(a2,-1);a3[1]=a2[0];a3[5]=a2[1];a3[9]=a2[2];a2=[a3[2],a3[6],a3[10]];U(a2,-1);a3[2]=a2[0];a3[6]=a2[1];a3[10]=a2[2];a2=[a3[0],a3[1],a3[2]];U(a2,-1);a3[0]=a2[0];a3[1]=a2[1];a3[2]=a2[2];a2=[a3[4],a3[5],a3[6]];U(a2,-1);a3[4]=a2[0];a3[5]=a2[1];a3[6]=a2[2];a2=[a3[8],a3[9],a3[10]];U(a2,-1);a3[8]=a2[0];a3[9]=a2[1];a3[10]=a2[2];a2=[a3[3],a3[7],a3[11]];U(a2,-1);a3[3]=a2[0];a3[7]=a2[1];a3[11]=a2[2]}return new b.Matrix4(a3[0],a3[1],a3[2],a3[3],a3[4],a3[5],a3[6],a3[7],a3[8],a3[9],a3[10],a3[11],a3[12],a3[13],a3[14],a3[15])}function aC(a3){if(a3>-1&&a3<3){var a2=["X","Y","Z"],a4={X:0,Y:1,Z:2};a3=W(a2[a3]);a3=a4[a3]}return a3}function W(a2){if(ae.convertUpAxis){switch(a2){case"X":switch(C){case"XtoY":case"XtoZ":case"YtoX":a2="Y";break;case"ZtoX":a2="Z";break}break;case"Y":switch(C){case"XtoY":case"YtoX":case"ZtoX":a2="X";break;case"XtoZ":case"YtoZ":case"ZtoY":a2="Z";break}break;case"Z":switch(C){case"XtoZ":a2="X";break;case"YtoZ":case"ZtoX":case"ZtoY":a2="Y";break}break}}return a2}return{load:k,loadFromSpec:af,parse:ao,setPreferredShading:F,applySkin:aV,geometries:au,options:ae}};b.ColladaLoader=a;return a});