define("DS/VisuLoaders/OBJMTLLoader",["DS/Visualization/ThreeJS_DS","DS/Visualization/Utils","DS/VisuLoaders/MTLLoader","DS/Visualization/ProxyAbstraction"],function(a,e,b,d){var c=function(){a.EventDispatcher.call(this)};c.prototype={constructor:a.OBJMTLLoader,load:function(k,h,o){var l=this;var m=new d();e.setProxyFromSpec(k,m);var p=k.serverurl?k.serverurl:"";p+=k.filename?k.filename:"";var f;var j;var i;var n=new b(p.substr(0,p.lastIndexOf("/")+1),o);n.addEventListener("load",g);n.addEventListener("error",g);if(h){n.load(h);f=false}else{f=true}function g(q){if(q.type==="load"){if(q.content instanceof b.MaterialCreator){f=true;i=q.content;i.preload()}}else{if(q.type==="error"){f=true}else{var r=q;if(h){j=l.parse(r)}else{j=l.parse(r,function(s){f=false;n.load(n.baseUrl+s)})}}}if(f&&j){if(i){j.traverse(function(s){if(s instanceof a.Mesh){if(s.material.name){var t=i.create(s.material.name);if(t){s.material=t}}}})}l.dispatchEvent({type:"load",content:j})}}m.executeGetHttpRequest(p,"text",null,g,function(){l.dispatchEvent({type:"error",message:"Couldn't load URL ["+p+"]"})})},parse:function(G,F){G=G.replace(/\ \\\r\n/g,"");function h(i,J,I){return new a.Vector3(i,J,I)}function n(I,i){return new a.Vector2(I,i)}function q(I,i,K,J){return new a.Face3(I,i,K,J)}function p(I,i,L,K,J){return new a.Face4(I,i,L,K,J)}function w(i,I){if(l.vertices.length>0){l.mergeVertices();l.computeCentroids();l.computeFaceNormals();l.computeBoundingSphere();H.add(f);l=new a.Geometry();f=new a.Mesh(l,u);j=0}if(i!==undefined){f.name=i}if(I!==undefined){u=new a.MeshLambertMaterial();u.name=I;f.material=u}}var o=new a.Object3D();var H=o;var l=new a.Geometry();var u=new a.MeshLambertMaterial();var f=new a.Mesh(l,u);var m=[];var j=0;var v=[];var r=[];var x=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;var y=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;var C=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;var E=/f( +\d+)( +\d+)( +\d+)( +\d+)?/;var D=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/;var B=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/;var A=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/;var g=G.split("\n");for(var z=0;z<g.length;z++){var t=g[z];t=t.trim();var s;if(t.length===0||t.charAt(0)==="#"){continue}else{if((s=x.exec(t))!==null){m.push(h(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3])))}else{if((s=y.exec(t))!==null){v.push(h(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3])))}else{if((s=C.exec(t))!==null){r.push(n(parseFloat(s[1]),parseFloat(s[2])))}else{if((s=E.exec(t))!==null){if(s[4]===undefined){l.vertices.push(m[parseInt(s[1])-1],m[parseInt(s[2])-1],m[parseInt(s[3])-1]);l.faces.push(q(j++,j++,j++))}else{l.vertices.push(m[parseInt(s[1])-1],m[parseInt(s[2])-1],m[parseInt(s[3])-1],m[parseInt(s[4])-1]);l.faces.push(p(j++,j++,j++,j++))}}else{if((s=D.exec(t))!==null){if(s[10]===undefined){l.vertices.push(m[parseInt(s[2])-1],m[parseInt(s[5])-1],m[parseInt(s[8])-1]);l.faces.push(q(j++,j++,j++));l.faceVertexUvs[0].push([r[parseInt(s[3])-1],r[parseInt(s[6])-1],r[parseInt(s[9])-1]])}else{l.vertices.push(m[parseInt(s[2])-1],m[parseInt(s[5])-1],m[parseInt(s[8])-1],m[parseInt(s[11])-1]);l.faces.push(p(j++,j++,j++,j++));l.faceVertexUvs[0].push([r[parseInt(s[3])-1],r[parseInt(s[6])-1],r[parseInt(s[9])-1],r[parseInt(s[12])-1]])}}else{if((s=B.exec(t))!==null){if(s[13]===undefined){l.vertices.push(m[parseInt(s[2])-1],m[parseInt(s[6])-1],m[parseInt(s[10])-1]);l.faces.push(q(j++,j++,j++,[v[parseInt(s[4])-1],v[parseInt(s[8])-1],v[parseInt(s[12])-1]]));l.faceVertexUvs[0].push([r[parseInt(s[3])-1],r[parseInt(s[7])-1],r[parseInt(s[11])-1]])}else{l.vertices.push(m[parseInt(s[2])-1],m[parseInt(s[6])-1],m[parseInt(s[10])-1],m[parseInt(s[14])-1]);l.faces.push(p(j++,j++,j++,j++,[v[parseInt(s[4])-1],v[parseInt(s[8])-1],v[parseInt(s[12])-1],v[parseInt(s[16])-1]]));l.faceVertexUvs[0].push([r[parseInt(s[3])-1],r[parseInt(s[7])-1],r[parseInt(s[11])-1],r[parseInt(s[15])-1]])}}else{if((s=A.exec(t))!==null){if(s[10]===undefined){l.vertices.push(m[parseInt(s[2])-1],m[parseInt(s[5])-1],m[parseInt(s[8])-1]);l.faces.push(q(j++,j++,j++,[v[parseInt(s[3])-1],v[parseInt(s[6])-1],v[parseInt(s[9])-1]]))}else{l.vertices.push(m[parseInt(s[2])-1],m[parseInt(s[5])-1],m[parseInt(s[8])-1],m[parseInt(s[11])-1]);l.faces.push(p(j++,j++,j++,j++,[v[parseInt(s[3])-1],v[parseInt(s[6])-1],v[parseInt(s[9])-1],v[parseInt(s[12])-1]]))}}else{if(/^o /.test(t)){H=new a.Object3D();H.name=t.substring(2).trim();o.add(H)}else{if(/^g /.test(t)){w(t.substring(2).trim(),undefined)}else{if(/^usemtl /.test(t)){w(undefined,t.substring(7).trim())}else{if(/^mtllib /.test(t)){if(F){var k=t.substring(7);k=k.trim();F(k)}}else{if(/^s /.test(t)){}else{console.log("THREE.OBJMTLLoader: Unhandled line "+t)}}}}}}}}}}}}}}w(undefined,undefined);return o}};return c});