define("DS/ApplicationFrame/Private_AfrCS",["DS/Core/Core","DS/CSICommandBinder/CSICommandBinder","DS/CoreUtilities/ErrorManagement"],function(f,j,e){var a;var i;var n;var g;var h;var k;var p=[];var o=[];var l=function l(){if(e.getDebugMode()){f.enableWUXConsole();a=WUX.getWUXConsole()?WUX.getWUXConsole():console}else{a=console}a.log("Client has lost connection with server");var r=0;for(r=0;r<p.length;r++){var s=p[r].serverLostCallback;var q=p[r].callbackObject;s.call(q)}};var m={INTERNAL_AFR_CALL:-1,START_COMMAND:0,STOP_COMMAND:1,CANCEL_COMMAND:2,CANCEL_OPERATION:3,EXECUTE_OPERATION:4,BEGIN_OPERATION:5,DO_OPERATION:6,END_OPERATION:7,EXECUTE_READ_ONLY_OPERATION:8};var d=[e.generateReturnValue("REQUEST_PUT_IN_QUEUE",true),e.generateReturnValue("SERVER_LOCKED_BY_ANOTHER_CMD",false),e.generateReturnValue("SERVER_NOT_LOCKED_FOR_CMD",false),e.generateReturnValue("CMD_DID_NOT_DECLARE_SERVER_CALLS",false),e.generateReturnValue("NO_CMD_TO_CANCEL",false),e.generateReturnValue("NO_OPERATION_TO_CANCEL",false),e.generateReturnValue("REQUEST_COULD_NOT_BE_SENT",false),e.generateReturnValue("NO_CMD_LOCKING_SERVER_TO_END_OR_CANCEL",false),e.generateReturnValue("CANNOT_CALL_OPERATION_FROM_APPLICATIVE_CB",false),e.generateReturnValue("INVALID_MSG",false),e.generateReturnValue("CONNECTION_FAILED",false),e.generateReturnValue("UNTYPED_ERROR",false)];var b=function(q){var r=q.readStringArray("domainNames");if(i&&r instanceof Array){q.writeStringArray("domainNames",r.reverse());i.callDomains(q)}};var c={INTERNAL_AFR_CALL:m.INTERNAL_AFR_CALL,START_COMMAND:m.START_COMMAND,STOP_COMMAND:m.STOP_COMMAND,CANCEL_COMMAND:m.CANCEL_COMMAND,CANCEL_OPERATION:m.CANCEL_OPERATION,EXECUTE_OPERATION:m.EXECUTE_OPERATION,BEGIN_OPERATION:m.BEGIN_OPERATION,DO_OPERATION:m.DO_OPERATION,END_OPERATION:m.END_OPERATION,EXECUTE_READ_ONLY_OPERATION:m.EXECUTE_READ_ONLY_OPERATION,csErrorManager:e.getErrorManager(d,{merge:true}),returnSpecificValue:function(r,q){if(!r){return e.createReturnObject(this.csErrorManager.MISSING_PARAMETERS,{description:"Need a value to return. Parameters are value, description"})}return e.createReturnObject(r,{description:q})},setClientNode:function(q){if(n!==undefined){return c.returnSpecificValue(c.csErrorManager.FAILED,"Client node has already been set ( it will be allowed to modified it in futur development ) : "+q)}if(q!==undefined){n=q;return c.returnSpecificValue(c.csErrorManager.SUCCEEDED,"Client node has been successfully set to : "+q)}else{return c.returnSpecificValue(c.csErrorManager.WRONG_PARAMETERS,"Input parameter iNode is undefined or has the wrong type")}},setServerNodeId:function(q){if(g!==undefined){return c.returnSpecificValue(c.csErrorManager.FAILED,"Client node Id has already been set ( it will be allowed to modified it in futur development ) : "+q)}if(q!==undefined){g=q;return c.returnSpecificValue(c.csErrorManager.SUCCEEDED,"Client node Id has been successfully set to : "+q)}else{return c.returnSpecificValue(c.csErrorManager.WRONG_PARAMETERS,"Input parameter iNodeId is undefined or has the wrong type")}},isServerConnected:function(){if(n&&g){return true}return false},registerAnswerCallback:function(q){if(!q){return this.returnSpecificValue(this.csErrorManager.MISSING_PARAMETERS,"No parameters specified")}if(!q.callback){return this.returnSpecificValue(this.csErrorManager.MISSING_PARAMETERS,"No callback specified")}if(!q.domain){return this.returnSpecificValue(this.csErrorManager.MISSING_PARAMETERS,"No domain specified")}i=j.getDefaultResponse();i.onAnswerDomain(q.domain,q.callback);return this.returnSpecificValue(this.csErrorManager.SUCCEEDED,"")},callReadOnlyCB:function(q){var r=o.shift();if(r){r.call(undefined,q)}},_sendReadOnlyRequest:function(q){o.push(q.callback);return this._sendRequest(q)},_sendRequest:function(t){var q=this.returnSpecificValue(this.csErrorManager.SUCCEEDED,"Message was successfully sent.");var s;if(n===undefined){q=this.returnSpecificValue(this.csErrorManager.CONNECTION_FAILED,"No browser node to send the request with.");e.logResult(q);return{result:q,request:s}}if(t.currentRequest===undefined&&(t.msg===this.DO_OPERATION||t.msg===this.END_OPERATION||t.msg===this.CANCEL_OPERATION||t.msg===this.STOP_OPERATION)){console.error("Private_AfrCS._sendRequest No current iterative request but asked to send a specific iterative message");console.trace();q=this.returnSpecificValue(this.csErrorManager.REQUEST_COULD_NOT_BE_SENT,"No current iterative request but asked to send a specific iterative message : "+t.msg);return{result:q,request:s}}if(!t.currentRequest){if(t.destinationPool===undefined){t.destinationPool=k}if(!g){g=n.select(t.destinationPool)}var u={destinationNodeId:g,command:t.operation,version:t.version,onComplete:b};if(t.msg===this.BEGIN_OPERATION||t.msg===this.START_COMMAND){s=n.createIterativeRequest(u)}else{s=n.createRequest(u)}}else{s=t.currentRequest}if(!s){throw new Error("Private_AfrCS request undefined in _sendRequest")}var r=new j.Parameters();if(t.msg===this.CANCEL_OPERATION){var r=new j.Parameters();r.writeBool("isCanceled",true);r.declareAsObject("AfrParameters")}if(t.msg>=3){if(t.inputs===undefined){t.inputs=new j.Parameters()}t.inputs.writeInt32("msg",t.msg)}if(t.msg===this.BEGIN_OPERATION||t.msg===this.START_COMMAND){s.begin(t.inputs)}else{if(t.msg===this.DO_OPERATION){s.send(t.inputs)}else{if(t.msg===this.END_OPERATION||t.msg===this.CANCEL_OPERATION||t.msg===this.STOP_COMMAND){s.end(t.inputs)}else{s.send(null,t.inputs,null)}}}if(t.killRequestAfterSend){s=undefined}return{result:q,request:s}},_reset:function(){n=undefined;g=undefined;i=undefined},getNode:function(){return n},setDefaultClientNodeId:function(q){if(n!==undefined){return c.returnSpecificValue(c.csErrorManager.FAILED,"Default client node id has already been set ( it will be allowed to modified it in futur development ) : "+q)}if(q!==undefined){n=q;return c.returnSpecificValue(c.csErrorManager.SUCCEEDED,"Default client node id has been successfully set to : "+q)}return c.returnSpecificValue(c.csErrorManager.WRONG_PARAMETERS,"NodeId is undefined or has the wrong type")},setDefaultServerPoolId:function(q){if(k!==undefined){return c.returnSpecificValue(c.csErrorManager.FAILED,"Default server pool id has already been set ( it will be allowed to modified it in futur development ) : "+q)}if(q!==undefined&&typeof q==="string"){k=q;return c.returnSpecificValue(c.csErrorManager.SUCCEEDED,"Default server pool id has been successfully set to : "+q)}return c.returnSpecificValue(c.csErrorManager.WRONG_PARAMETERS,"Default server pool id is undefined or has the wrong type")},initConnection:function(s){if(!s){return this.returnSpecificValue(this.csErrorManager.MISSING_PARAMETERS,"No parameters specified. Connection to 3DCSServer couldn't be established ")}if(n!==undefined){return this.returnSpecificValue(this.csErrorManager.UNTYPED_ERROR,"Connection already established.")}if(k!==undefined){return this.returnSpecificValue(this.csErrorManager.UNTYPED_ERROR,"Connection already established.")}var u;if(s.hypervisorUrl){u={hypervisorUrl:s.hypervisorUrl,onHypervisorDisconnect:l}}else{u={hypervisorIp:s.hypervisorIp,webSocketPort:s.webSocketPort,onHypervisorDisconnect:l}}if(s.ssl!==undefined){u.ssl=s.ssl}k=s.destinationPool;h="application.webWidget";var t=j.getPool(h);if(t===undefined){return this.returnSpecificValue(this.csErrorManager.CONNECTION_FAILED,"Couldn't create or retrieve the pool "+h+".")}n=t.createNode(u);if(n===undefined){return this.returnSpecificValue(this.csErrorManager.CONNECTION_FAILED,"Node creation on pool "+h+" failed.")}var r=0;while(s.closingCallbacks.length>0&&r<s.closingCallbacks.length){var q={serverLostCallback:s.closingCallbacks[r],callbackObject:s.closingCallbacksObj[r]};if(p.indexOf(q)===-1){p.push(q)}r++}return this.returnSpecificValue(this.csErrorManager.SUCCEEDED,"")}};return c});define("DS/ApplicationFrame/PlayerStyle",[],function(){var a={SIMPLE:{name:"SIMPLE"},TOUR3D:{name:"TOUR3D"},RUN:{name:"RUN"},SIMULATION:{name:"SIMULATION"}};return a});define("DS/ApplicationFrame/CommandsManager",["UWA/Core","DS/Core/Core","DS/Core/Events","UWA/Class"],function(g,f,e,a){var d="/WUX/AFR/CMD/";var c=[];var b=a.singleton({options:{},init:function(h){this.options=this.defaultOptions;g.extend(this.options,h);this._parent(h);this._reset();var i=this;var j=false;document.onkeydown=function(k){var l;k=k||window.event;if(k.keyCode===27){k.preventDefault();i._cancelCurrentCmdInAllCtxt()}else{if(k.keyCode===17){j=true}else{if(j&&k.keyCode===90){l=i.getCommand("Undo");if(l){l.begin()}}else{if(j&&k.keyCode===89){l=i.getCommand("Redo");if(l){l.begin()}}}}}};document.onkeyup=function(k){k=k||window.event;if(k.keyCode===17){j=false}};e.subscribe({event:"COMMAND_MANAGER/Ending_Commands"},function(){i.endAll(undefined)})},_reset:function(){var j,h;for(j in this._commands){if(this._commands[j]&&this._commands[j]._destroy){this._commands[j]._destroy()}}for(h in this._commands){for(j in this._commands[h]){if(this._commands[h][j]&&this._commands[h][j]._destroy){this._commands[h][j]._destroy()}}}var i=this.getCommandCheckHeaders();for(j in i){if(i[j]&&i[j]._destroy){i[j]._destroy()}}for(h in i){for(j in i[h]){if(i[h][j]&&i[h][j]._destroy){i[h][j]._destroy()}}}this._commands={};this._isCommandEnding=false;this._ignoreCommandBeginWhileEndingCommand=false;this._allowNextCmd=false;this._nextCmd=null;this._commandsState={lastCommand:[],currentCommand:null,currentCommandInstanceId:null,defaultCommand:null}},_cancelCurrentCmdInAllCtxt:function(){this._resetNextCmd();if(this._commandsState.currentCommand){var k=this._getCurrent();if(k){this.getCommand(k).cancel()}}else{for(var i in this._commandsState){var h=this._getCurrent(i);if(h){var j=this.getCommand(h,i);if(j){j.cancel()}}}}},setDefaultCommand:function(i,h){h=h||i.context;this._loadCommand(i.ID,i.className,h,function(j){if(h){if(!this._commandsState[h]){this._commandsState[h]={};this._commandsState[h].lastCommand=[]}this._commandsState[h].defaultCommand=j}else{this._commandsState.defaultCommand=j}if(i.dontStartCmd!==true){j.begin()}})},resetDefaultCommand:function(h){if(h){if(!this._commandsState[h]){this._commandsState[h]={};this._commandsState[h].lastCommand=[]}this._commandsState[h].defaultCommand=null}else{this._commandsState.defaultCommand=null}},_getDefaultCommand:function(h){if(h){return this._commandsState[h].defaultCommand}else{return this._commandsState.defaultCommand}},_setLast:function(i,h){if(!i){return}if(h){if(!this._commandsState[h]){this._commandsState[h]={}}if(!this._commandsState[h].lastCommand){this._commandsState[h].lastCommand=[]}this._commandsState[h].lastCommand.push(i)}else{if(!this._commandsState.lastCommand){this._commandsState.lastCommand=[]}this._commandsState.lastCommand.push(i)}},_getLast:function(h){if(h){if(this._commandsState[h].lastCommand.length){return this._commandsState[h].lastCommand[this._commandsState[h].lastCommand.length-1]}else{return null}}else{if(this._commandsState.lastCommand.length){return this._commandsState.lastCommand[this._commandsState.lastCommand.length-1]}else{return null}}},_popLastPausedCmd:function(h){if(h){if(this._commandsState[h].lastCommand.length){return this._commandsState[h].lastCommand.pop()}else{return null}}else{if(this._commandsState.lastCommand.length){return this._commandsState.lastCommand.pop()}else{return null}}},_removeFromLast:function(j,h){var k,i;if(h){k=this._commandsState[h].lastCommand.indexOf(j);if(k>=0){i=this._commandsState[h].lastCommand.splice(k,1)}else{i=null}}else{k=this._commandsState.lastCommand.indexOf(j);if(k>=0){i=this._commandsState.lastCommand.splice(k,1)}else{i=null}}return i},_setCurrent:function(i,h){if(h){if(!this._commandsState[h]){this._commandsState[h]={}}if(!this._commandsState[h].lastCommand){this._commandsState[h].lastCommand=[]}if(i){this._commandsState[h].currentCommand=i._id;this._commandsState[h].currentCommandInstanceId=i.getCSIdentifier()}else{this._commandsState[h].currentCommand=null;this._commandsState[h].currentCommandInstanceId=null}}else{if(i){this._commandsState.currentCommand=i._id;this._commandsState.currentCommandInstanceId=i.getCSIdentifier()}else{this._commandsState.currentCommand=null;this._commandsState.currentCommandInstanceId=null}}},_getCurrent:function(h){if(h){if(this._commandsState[h]){return this._commandsState[h].currentCommand}else{return null}}else{return this._commandsState.currentCommand}},_getCurrentInstanceId:function(h){if(h){if(this._commandsState[h]){return this._commandsState[h].currentCommandInstanceId}else{return null}}else{return this._commandsState.currentCommandInstanceId}},getCurrentCmdId:function(h){if(h){if(this._commandsState[h]){return this._commandsState[h].currentCommand?this._commandsState[h].currentCommand:"NoRunningCmd"}else{return null}}else{return this._commandsState.currentCommand?this._commandsState.currentCommand:"NoRunningCmd"}},_restoreLast:function(h){var i=this._getLast(h);var j=this._getDefaultCommand(h);if(h&&this._commands[h]){if(this._commands[h][i]&&this._commands[h][i].isPaused()){this._commands[h][i].resume()}else{if(j){if(j.isPaused()){j.resume()}else{j.begin()}}}}else{if(this._commands[i]&&this._commands[i].isPaused()){if(this._commands[i].isPaused()){this._commands[i].resume()}else{this._commands[i].begin()}}else{if(j){if(j.isPaused()){j.resume()}else{j.begin()}}}}},_restoreDefault:function(i,h){var j=this._getDefaultCommand(i);if(j){if(j.isPaused()&&j.isRunning()){j.resume()}else{if(!j.isRunning()){j.begin(h)}}}},activateNextCmd:function(){this._allowNextCmd=true},deactivateNextCmd:function(){this._allowNextCmd=false},_isNextCmdAllowed:function(){return this._allowNextCmd},_setNextCmd:function(h){if(this._nextCmd===null){this._nextCmd=h;return true}else{return false}},_resetNextCmd:function(){this._nextCmd=null},_getNextCmd:function(){return this._nextCmd},_isNextCmdWaiting:function(){if(this._nextCmd===null){return false}else{return true}},setIgnoreCommandBeginWhileEndingCommand:function(){this._ignoreCommandBeginWhileEndingCommand=true},unsetIgnoreCommandBeginWhileEndingCommand:function(){this._ignoreCommandBeginWhileEndingCommand=false},_isIgnoredCommandBeginWhileEndingCommand:function(){return this._ignoreCommandBeginWhileEndingCommand},_isEndingCommand:function(){return this._isCommandEnding},_setEndingCommand:function(){this._isCommandEnding=true},_unsetEndingCommand:function(){this._isCommandEnding=false},_isCmdBeingCanceled:function(){var h=this.getCommands();var j;for(var k in h){var i=h[k];if(i._executeUndoAtEnd===true){j=true}}return j},getCommand:function(i,h){if(h&&this._commands[h]){return this._commands[h][i]}else{return this._commands[i]}},getCommands:function(h){if(h){return this._commands[h]}else{return this._commands}},endAll:function(j,m){var l,n;this._resetNextCmd();var h=this.getCommands(j);c=[];var i=0;var k=false;for(n in h){l=h[n];if(l.isNewInfraActivated()){return}if(l._mode!=="undefined"&&((l.isRunning&&l.isRunning())||(l.isPaused&&l.isPaused()))){i++}}if(i>0){for(n in h){l=h[n];if(l._mode!=="undefined"&&((l.isRunning&&l.isRunning())||(l.isPaused&&l.isPaused()))){c.push({cmdID:l._id,token:l.onCanceled(function(p){i--;for(var o=0;o<c.length;o++){if(c[o].cmdID===p){e.unsubscribe(c[o].token);c.splice(o,1);break}}if(i===0&&k===false){k=true;e.publish({event:"COMMAND_MANAGER/ALL_CMD_ENDED"})}})});l.cancel(m!==false)}}}if(i===0&&k===false){e.publish({event:"COMMAND_MANAGER/ALL_CMD_ENDED"});k=true}},pauseAll:function(i){var h=this.getCommands(i);for(var k in h){var j=h[k];if(j.isRunning&&j.isRunning()&&j.isPaused&&!j.isPaused()){j.pause()}}},disableAll:function(h,i){if(typeof h==="object"){i=h;h=undefined}var k=this.getCommands(h);for(var l in k){k[l].disable(i)}var j=this.getCommandCheckHeaders(h);for(var m in j){j[m].disable(i)}},enableAll:function(h){if(typeof h==="object"){h=undefined}var j=this.getCommands(h);for(var k in j){j[k].enable()}var i=this.getCommandCheckHeaders(h);for(var l in i){i[l].enable()}},_loadCommand:function(n,j,h,m){var k=this;var l=this.getCommand(n,h);if(l){if(m){m.call(k,l)}}else{var i=j.replace(/\./g,"/");require([i],function(o){var p=new o({context:h,ID:n});if(m){m.call(k,p)}})}},onCommandStart:function(j,h){if(!h){h=""}var i=d+h+"/BEGIN";return e.subscribe({event:i},j)},_registerExistingCommand:function(h){if(h.options.context){if(this._commands[h.options.context]===undefined){this._commands[h.options.context]={}}if(h.options.ID){this._commands[h.options.context][h.options.ID]=h}else{console.warn("Error: Cannot register the command. Please specify a command ID")}}else{if(h.options.ID){this._commands[h.options.ID]=h}else{console.warn("Error: Cannot register the command. Please specify a command ID")}}},_registerExistingCommandCheckHeader:function(h){if(h===undefined||h.options===undefined){throw new Error("Wrong parameter")}if(h.options.ID===undefined||typeof h.options.ID!=="string"){throw new Error("Missing parameter: Cannot register the commandCheckHeader. Please specify a command ID")}if(h.options.context&&typeof h.options.context!=="string"){console.warn("The context parameter has to be a string")}if(this._cmdCheckHeader===undefined){this._cmdCheckHeader={}}if(h.options.context){if(this._cmdCheckHeader[h.options.context]===undefined){this._cmdCheckHeader[h.options.context]={}}this._cmdCheckHeader[h.options.context][h.options.ID]=h}else{this._cmdCheckHeader[h.options.ID]=h}},getCommandCheckHeader:function(i,h){if(this._cmdCheckHeader===undefined){return undefined}if(i===undefined||typeof i!=="string"){throw new Error("The id parameter is not defined or is not a string")}if(h!==undefined&&h!==null){if(typeof h!=="string"){console.warn("The context parameter has to be a string")}if(this._cmdCheckHeader[h]){return this._cmdCheckHeader[h][i]}else{return undefined}}else{return this._cmdCheckHeader[i]}},getCommandCheckHeaders:function(h){if(h&&this._cmdCheckHeader!==undefined){return this._cmdCheckHeader[h]}else{return this._cmdCheckHeader}},_dispose:function(h){var i;if(h&&this._commands[h]){i=this._commands[h]}else{i=this._commands}if(i){for(var k in i){var l=i[k];if(l._destroy&&l._ctx===h){l._destroy();delete i[k]}}}var j=this.getCommandCheckHeaders(h);if(!j){return}for(var m in j){if(j[m]._destroy){j[m]._destroy()}}}});return g.namespace("WUX/AFR/CommandsManager",b)});define("DS/ApplicationFrame/FrameWindowsManager",["UWA/Core","UWA/Class"],function(c,a){var b=a.singleton({options:{},init:function(d){this.options=this.defaultOptions;c.extend(this.options,d);this._parent(d);this._frameWindow=null;this._frameWindows={}},_registerNewFrameWindow:function(e){var d=e.options;if(d.context){if(this._frameWindows[d.context]===undefined){this._frameWindows[d.context]={};this._frameWindows[d.context]=e}else{console.warn("Warning registering the new FrameWindow! A FrameWindow already exist in this context: "+d.context)}}else{if(this._frameWindow){console.warn("Warning registering the new FrameWindow! A FrameWindow already exist. ")}else{this._frameWindow=e}}},getFrameWindow:function(d){if(d&&this._frameWindows[d]){return this._frameWindows[d]}else{return this._frameWindow}},_unregisterFrameWindow:function(d){if(d!==undefined&&this._frameWindows[d]){delete this._frameWindows[d]}else{this._frameWindow=null}}});return c.namespace("WUX/AFR/FrameWindowsManager",b)});define("DS/ApplicationFrame/PlayerButton",[],function(){var a={PLAY_PAUSE:0,BACK_NEXT:1,BACKWARD_FORWARD:2,FIRST_LAST:3,STOP:4,PLAYREVERSE:5,SLIDER:6,EDITOR:7,LOOP:8,PLAYLIST:9,OPTIONS:10};return a});define("DS/ApplicationFrame/XMLUtilities",["UWA/Core","DS/WebappsUtils/WebappsUtils"],function(f,c){function e(h){var j=window.location.href.split("/").slice(0,window.location.href.split("/").length-2).join("/");var i=c.getWebappsBaseUrl()+h.module+"/"+h.directory+"/"+h.fileName+"."+h.fileExtension;var g;var l=function(p){var n=p.implementation.createDocument(p.namespaceURI,null,null);var m=n.importNode(p.documentElement,true);n.appendChild(m);var o=f.Utils.loadXml(n);return o};var k="Ajax";if(c.getWebappsBaseUrl()!="../"){k="Data"}f[k].request(i,{async:true,type:"xml",onComplete:function(m){g=l(m);if(h.onComplete){h.onComplete.call(this,g)}},onFailure:function(m){console.error("[!]\tError loading file:"+i);if(h.onFailure){h.onFailure.call(this,m)}}})}function d(j){var h=j.getElementsByTagName("CATCmdHeadersList")[0];var l=j.getElementsByTagName("CATCmdContainer")[0];var m=h.cloneNode(false);var k=l.cloneNode(false);var i=j.getElementsByTagName("Template")[1];var g=j.getElementsByTagName("CATCmdWorkbench")[0];i.removeChild(h);g.removeChild(l);i.appendChild(m);g.appendChild(k)}function b(k,p,t,x,w){d(w);var q=w.getElementsByTagName("CATCmdHeadersList")[0];var h=w.getElementsByTagName("CATCmdContainer")[0];var s;var v=w.createElement("CATCmdWorkbench");for(var o=0;o<p.length;o++){var n=p[o];if(n.hdr_list.length>1){s=w.createElement("CATCmdContainer");s.setAttribute("Name",n.name);s.setAttribute("RepresentationType","AfrActionBarDropDown");s.setAttribute("Visibility","1");h.appendChild(s)}for(var m=0;m<n.hdr_list.length;m++){var l=k+n.hdr_list[m]+t;var g=x[0].querySelectorAll('[ID="'+l+'"]');var u=g.length>0;if(u&&q.querySelectorAll('[ID="'+l+'"]').length===0){q.appendChild(g[0].cloneNode(false))}var r=w.createElement("CATCmdStarter");r.setAttribute("Name",l);r.setAttribute("Command",l);if(n.hdr_list.length>1&&u){s.appendChild(r)}else{if(u){h.appendChild(r)}}}}}function a(g){var h=this;e({module:"ApplicationFrame",directory:"assets/afr",fileName:"dafr-template",fileExtension:"xml",onComplete:function(i){var j=i;e({module:g.module,directory:"assets/afr",fileName:g.workbenchName,fileExtension:"xml",onComplete:function(l){var k=l;var m=k.getElementsByTagName("CATCmdHeadersList");b(g.cmdPrefix,g.cmdList,g.cmdSuffix,m,j);if(g.onComplete){g.onComplete.call(this,j)}}})}})}return a});define("DS/ApplicationFrame/PlayerElements",[],function(){var a={PLAY_PAUSE:0,BACK_NEXT:1,BACKWARD_FORWARD:2,FIRST_LAST:3,STOP:4,PLAYREVERSE:5,SLIDER:6,EDITOR:7,LOOPRC:8,loopRCBF:9,LOOPRO:10,PLAYLIST:11,OPTIONS:12,EXIT:13};return a});define("DS/ApplicationFrame/CommandCheckHeader",["UWA/Core","DS/Core/Core","DS/Core/Events","DS/Core/ModelEvents","UWA/Class","DS/ApplicationFrame/FrameWindowsManager","DS/ApplicationFrame/CommandsManager"],function(e,f,d,c,b,i,a){var g="/WUX/AFR/CMD/";var h=b.extend({defaultOptions:{context:null,ID:null,Behavior:"CATAfrHeaderCheck"},init:function(k,j){e.extend(k,j);this.options=e.extend(this.defaultOptions,k);this._parent(this.options);if(k.isEnabled!==undefined){this._isEnabled=k.isEnabled}else{this._isEnable=true}this._modelEvents=new c();this._state=false;this._id=this.options.ID;this._context=this.options.context;var m=this;var l="";if(this.options.context){l=this.options.context+"/"}this._evtID=g+l+this.options.ID;this._startToken=d.subscribe({event:this._evtID},function(){m.toggleState()});this.onStateChange(function(){if(this.getState()){d.publish({event:m._evtID+"/BEGIN",data:m})}else{d.publish({event:m._evtID+"/END",data:m})}});d.subscribe({event:m._evtID+"/END"},function(n){if(!n){m.setState(false,false)}});d.subscribe({event:m._evtID+"/BEGIN"},function(n){if(!n){m.setState(true,false)}});if(!a.getCommand(this._id,this._ctx)){a._registerExistingCommandCheckHeader(this)}else{if(this._id===undefined){console.warn("The CommandCheckHeader has no ID.")}else{if(typeof this._id!=="string"){throw new Error("The CommandCheckHeader ID has to be a string.")}}}},getState:function(){return this._state},setState:function(k,j){if(j===undefined){j=true}this._state=k;this._modelEvents.publish({event:"UDPATE",data:this._state,context:this})},toggleState:function(){this.setState(!this.getState(),false)},onStateChange:function(j){return this._modelEvents.subscribe({event:"UDPATE"},j)},getFrameWindow:function(){return i.getFrameWindow(this._context)},enable:function(){var j=this;this._isEnabled=true;d.publish({event:j._evtID+"/ENABLE",data:j});d.publish({event:j._evtID+"/ENABLE",data:j})},disable:function(j){var k=this;this._isEnabled=false;d.publish({event:k._evtID+"/DISABLE",data:j});d.publish({event:k._evtID+"/DISABLE",data:k})},isEnabled:function(){return this._isEnabled}});return h});define("DS/ApplicationFrame/CommandStarter",["UWA/Core","DS/Core/Core","UWA/Controls/Abstract","DS/ApplicationFrame/CommandsManager","DS/RuntimeView/RSCManager","DS/RuntimeView/NLSManager","DS/Core/Events","DS/WebappsUtils/WebappsUtils","DS/Controls/TooltipModel"],function(g,i,h,a,j,m,d,c,l){var k="/WUX/AFR/CMD/";function b(n,o){return c.getWebappsBaseUrl()+n+"/assets/graphic/"+o}function f(r,o,t,s){var n=o.HelpResourceFile;var w=r.options.Command;var v="top";if(t._privateAfrTmpIsInDropDown){v="right";delete t._privateAfrTmpIsInDropDown}t.tooltipInfos=new l({mouseRelativePosition:false,position:v});if(n){t.tooltipInfos.loadFromHelpRscFile(n,w);var p=n.split("/");var q="i18n!"+p[0];p.splice(0,1);q+="/assets/help/"+p.join("/");require([q],function(x){s.set("html",x[w+".Title"])},function(x){console.error("[i18n] Internationalization file not found",x)})}else{var u=o.ResourceFile;m.onResourceLoaded({resourceFile:u,language:r._dafrManager.options.language},function(){var x=this.getTitle({key:w});if(x){t.tooltipInfos.title=x;s.set("html",x)}else{console.error("[NLS] No NLS title found for "+w)}if(r._dafrManager.options.contextMenu==="true"){s.setStyles({display:"inline-block"})}})}}var e=h.extend({defaultOptions:{},init:function(n,o){this._parent(n);this._dafrManager=o;this._buildView();this._loadResources();this._bindEvents()},_buildView:function(){this.elements.container=new g.Element("div",{"class":"wux-afr-cmdstarter"});for(var n in this.options){if(this.options.hasOwnProperty(n)){this.elements.container.setAttribute("data-"+n,this.options[n])}}},_loadResources:function(){var p=this;var n=this.elements.container;var r=n.getAttribute("data-Command");var q=this._dafrManager.getCommandHeader(r);if(q){var o=q.ResourceFile;j.onResourceLoaded({resourceFile:o},function(){var v=p.options.Command;var t;if(p.options.Icon){t=c.getWebappsBaseUrl()+p.options.Icon}else{t=this.getIcon({key:v,size:"Normal"})}var w=g.extend(n);var u;if(p._dafrManager.options.contextMenu==="true"){u=new g.Element("div",{styles:{backgroundImage:"url("+t+")",backgroundSize:"cover",lineHeight:"32px",display:"inline-block",verticalAlign:"top"}}).inject(w)}else{u=new g.Element("div",{styles:{width:32,height:32,backgroundImage:"url("+t+")",backgroundSize:"cover",lineHeight:"32px",display:"inline-block",verticalAlign:"top"}}).inject(w)}var s=new g.Element("div",{html:v,"class":"wux-afr-label"});if(p._dafrManager.options.contextMenu==="true"){s.setStyles({display:"inline-block"})}w.appendChild(s);f(p,q,w,s)},{})}},_bindEvents:function(){var p=this;var t=this.options.Command;var q=this.elements.container;var n="";if(this._dafrManager.options.context){n=p._dafrManager.options.context+"/"}var r=k+n+t;var s;if(window.DSWebRecord){this.elements.container._record=Object.create(null);this.elements.container._record._commandId=t;if(n&&n.length>0){this.elements.container._record._context=n.substr(0,n.length-1)}}q.addEventListener("click",function(v){var u=((" "+v.target.className+" ").replace(/[\n\t]/g," ").indexOf(" wux-ui-state-disabled ")>-1);if(v.which===1&&!u){d.publish({event:r,data:p});p._dafrManager._modelEvents.publish({event:"HIDE_DROPDOWN_MENUS"})}else{v.stopPropagation()}});d.subscribe({event:r+"/BEGIN"},function(){q.addClassName("wux-ui-state-active")});d.subscribe({event:r+"/RESUME"},function(){q.addClassName("wux-ui-state-active")});d.subscribe({event:r+"/PAUSE"},function(){q.removeClassName("wux-ui-state-active")});d.subscribe({event:r+"/END"},function(){q.removeClassName("wux-ui-state-active")});d.subscribe({event:r+"/ENABLE"},function(){p._enableCommand(t)});d.subscribe({event:r+"/DISABLE"},function(u){p._disableCommand(t,u)});var o;if(n!==""){o=a.getCommand(t,n.substring(0,n.length-1))}else{o=a.getCommand(t,p.options.context)}if(o){if(o.isEnabled!==undefined&&!o.isEnabled()){p._disableCommand(t)}if(o.isRunning!==undefined&&o.isRunning()){q.addClassName("wux-ui-state-active")}}else{if(n!==""){o=a.getCommandCheckHeader(t,n.substring(0,n.length-1))}else{o=a.getCommandCheckHeader(t,p.options.context)}if(o&&o.getState!==undefined&&o.getState()){q.addClassName("wux-ui-state-active")}if(o&&!o.isEnabled()){p._disableCommand()}}},_disableCommand:function(p,o){var n={tintInGray:true};o=g.extend(n,o);this.elements.container.addClassName("wux-ui-state-disabled")},_enableCommand:function(n){this.elements.container.removeClassName("wux-ui-state-disabled")}});return e});define("DS/ApplicationFrame/Private_AfrCSController",["DS/Core/Core","DS/ApplicationFrame/Private_AfrCS","DS/CSICommandBinder/CSICommandBinder","DS/CoreUtilities/ErrorManagement"],function(e,c,d,a){var b={INTERNAL_AFR_CALL:c.INTERNAL_AFR_CALL,START_COMMAND:c.START_COMMAND,STOP_COMMAND:c.STOP_COMMAND,CANCEL_COMMAND:c.CANCEL_COMMAND,CANCEL_OPERATION:c.CANCEL_OPERATION,EXECUTE_OPERATION:c.EXECUTE_OPERATION,BEGIN_OPERATION:c.BEGIN_OPERATION,DO_OPERATION:c.DO_OPERATION,END_OPERATION:c.END_OPERATION,_appCallback:undefined,_callbackObj:undefined,_callbackArgs:undefined,_waitingMessages:[],_request:undefined,_requestOperation:undefined,_startStopCmdRequest:undefined,_cmdLockingServer:undefined,_stackedMessagesBeingTreated:false,_waitingForServerAnwser:false,_sendOnlyLastIteration:false,_cancellingCmd:false,_cmdToCancel:[],_requestUnstackingPaused:true,_reset:function(){this._appCallback=undefined;this._callbackObj=undefined;this._callbackArgs=undefined;this._waitingMessages=[];this._request=undefined;this._requestOperation=undefined;this._startStopCmdRequest=undefined;this._cmdLockingServer=undefined;this._stackedMessagesBeingTreated=false;this._waitingForServerAnwser=false;this._sendOnlyLastIteration=false;this._cancellingCmd=false;this._cmdToCancel=[];this._requestUnstackingPaused=true},isServerConnected:function(){return c.isServerConnected()},getAppCallback:function(){return this._appCallback},getCallbackObj:function(){return this._callbackObj},getCallbackArgs:function(){return this._callbackArgs},resetCallback:function(){this._appCallback=undefined;this._callbackObj=undefined;this._callbackArgs=undefined},returnValueRequestPutQueue:function(g){var f="The request [operation: "+g.operation+", msg : "+g.msg;if(g.from){f+=", from : "+g.from.getId()}f+="] has been put in queue";return c.returnSpecificValue(c.csErrorManager.REQUEST_PUT_IN_QUEUE,f)},isServiceRunning:function(){if(this._request!==undefined){return true}else{return false}},getCurrentRequestService:function(){return this._requestOperation},_isCommandUsingServer:function(){if(this._cmdLockingServer!==undefined){return true}else{return false}},_getCommandLockingServer:function(){return this._cmdLockingServer},_lockServer:function(f){if(this._cmdLockingServer!==undefined){return c.returnSpecificValue(c.csErrorManager.SERVER_LOCKED_BY_ANOTHER_CMD,"Cannot lock the server for command "+f.getCSIdentifier()+". Another command is already locking the server")}this._cmdLockingServer=f},_unlockServer:function(){if(this._cmdLockingServer===undefined){return c.returnSpecificValue(c.csErrorManager.NO_CMD_LOCKING_SERVER_TO_END_OR_CANCEL,"No command lock to remove on the server juste after sending a stop message.")}else{this._cmdLockingServer=undefined}},_addCmdToCancel:function(f){this._cmdToCancel.push(f)},_removeCmdToCancel:function(g){var f=this._cmdToCancel.indexOf(g);if(f>-1){this._cmdToCancel.splice(f,1)}},isCancellingCmd:function(){return this._cancellingCmd},_setCancellingCmd:function(){this._cancellingCmd=true},_unsetCancellingCmd:function(){this._cancellingCmd=false},isServerWorking:function(){if(this._waitingForServerAnwser){return true}else{return false}},_unsetServerWorking:function(){this._waitingForServerAnwser=false},_setServerWorking:function(){this._waitingForServerAnwser=true},_isCurrentServiceToCancel:function(){var f=this.getCurrentRequestService();if(f&&this._waitingMessages[0].msg>this.CANCEL_OPERATION){if(f!==this._waitingMessages[0].operation){return true}}return false},_keepOnlyCurrentServiceLastDoRequest:function(){var g=this.getCurrentRequestService();if(!g){return}var f=0;while(f<this._waitingMessages.length){if(this._waitingMessages[f]&&(this._waitingMessages[f].msg!==this.DO_OPERATION||this._waitingMessages[f].operation!==g)){break}f++}this._waitingMessages.splice(0,f-1)},addMessageInStack:function(f){if(f.atBeginning&&f.atBeginning===true){this._waitingMessages.unshift(f.request)}else{this._waitingMessages.push(f.request)}if(this._requestUnstackingPaused===true){return this._sendNextMessages()}return this.returnValueRequestPutQueue(f.request)},_sendNextMessages:function(){var l=null;var h=null;if(this.isServerWorking()||this._waitingMessages.length===0){this._requestUnstackingPaused=true}while(!this.isServerWorking()&&this._waitingMessages.length>0){this._requestUnstackingPaused=false;if(this.isCancellingCmd()===true){if(this._waitingMessages[0].msg!==this.CANCEL_OPERATION&&this._waitingMessages[0].msg!==this.STOP_COMMAND){this._requestUnstackingPaused=true;break}}else{if((this._waitingMessages[0].msg===this.CANCEL_OPERATION||this._waitingMessages[0].msg===this.STOP_COMMAND)&&this._cmdToCancel.indexOf(this._waitingMessages[0].from.getCSIdentifier())===0){this._setCancellingCmd()}}if(this._isCurrentServiceToCancel()){h=this._cancelCurrentService(this._waitingMessages[0].from);if(!a.hasSucceeded(h)){a.logResult(h)}}if(this._sendOnlyLastIteration===true&&this._waitingMessages[0].msg===this.DO_OPERATION){this._keepOnlyCurrentServiceLastDoRequest()}l=this._waitingMessages.shift();h=this._checksBeforeSendRequest(l);if(a.hasSucceeded(h)){var f=undefined;if(this._request&&l.msg===this.INTERNAL_AFR_CALL){f=this._request;this._request=undefined}this._setServerWorking();if(l.msg===this.STOP_COMMAND){this._request=this._startStopCmdRequest;this._startStopCmdRequest=undefined}if(this._request){l.currentRequest=this._request}var g=c._sendRequest(l);h=g.result;if(!a.hasSucceeded(h)){this._unlockServer();this._unsetServerWorking();if(this._waitingMessages.length===0){this._requestUnstackingPaused=true}return h}var j=g.request;this._request=j;if(l.msg===this.START_COMMAND){this._startStopCmdRequest=this._request;this._request=undefined}else{if(f!==undefined){if(this._request!==undefined){}this._request=f}else{if(this._request===undefined){this._requestOperation=undefined}else{this._requestOperation=l.operation}}}if(l.msg===this.STOP_COMMAND){this._unsetServerWorking();var k=this._getCommandLockingServer();this._unlockServer();if(this.isCancellingCmd()){this._removeCmdToCancel(k.getCSIdentifier());this._unsetCancellingCmd()}k.onCmdEnded();if(this._waitingMessages.length===0){this._requestUnstackingPaused=true}}else{if(l.msg===this.START_COMMAND){this._unsetServerWorking();if(this._waitingMessages.length===0){this._requestUnstackingPaused=true}}else{break}}}else{if(this.getAppCallback()){var i=new d.Parameters();i.writeInt32("AfrErrCode",2);this.getAppCallback().call(this.getCallbackObj(),i);this.resetCallback()}h=c.returnSpecificValue(c.csErrorManager.REQUEST_COULD_NOT_BE_SENT,"PrivateAfrCS._sendRequest couldn't send message ")}}return h},_checksBeforeSendRequest:function(f){if(f.msg===this.START_COMMAND){this._lockServer(f.from)}if(f.msg===this.BEGIN_OPERATION){if(f.sendOnlyLastIteration===true){this._sendOnlyLastIteration=true}else{this._sendOnlyLastIteration=false}}if(f.callback){this._appCallback=f.callback;this._callbackObj=f.from;this._callbackArgs=f.callbackArgs}else{this.resetCallback()}if(!this._request){if(f.msg===this.DO_OPERATION||f.msg===this.END_OPERATION||f.msg===this.CANCEL_OPERATION){return c.returnSpecificValue(c.csErrorManager.REQUEST_COULD_NOT_BE_SENT,"Trying to send a DO, END or CANCEL message on a operation which doesn't exist or has been killed ")}}return c.returnSpecificValue(c.csErrorManager.SUCCEEDED,"Request ready to be sent")},callInternalService:function(f){if(!f||!f.operation){return c.returnSpecificValue(c.csErrorManager.MISSING_PARAMETERS,"PrivateAfrController.callInternalService expect an literal object as input parameters with a defined parameters.operation")}if(!f.version){f.version=1}f.msg=-1;f.killRequestAfterSend=true;return this.addMessageInStack({request:f,atBeginning:true})},callReadOnlyOperation:function(f){f.msg=c.EXECUTE_READ_ONLY_OPERATION;f.killRequestAfterSend=true;if(f.version===undefined){f.version=1}return c._sendReadOnlyRequest(f)},_cancelCurrentService:function(){if(!this.isServiceRunning()){return c.returnSpecificValue(c.csErrorManager.NO_OPERATION_TO_CANCEL,"There is no current operation to cancel.")}var f={};f.from=this._getCommandLockingServer();f.msg=this.CANCEL_OPERATION;f.killRequestAfterSend=true;return this.addMessageInStack({request:f,atBeginning:true})},interruptCurrentOperation:function(){if(this._request!==undefined&&typeof(this._request.interrupt)!==undefined){this._waitingMessages=[];this._request.interrupt()}}};return b});define("DS/ApplicationFrame/Private_AfrCSInternalServices",["UWA/Core","DS/ApplicationFrame/Private_AfrCS","DS/ApplicationFrame/Private_AfrCSController","DS/AfrUndoRedoUI/Private_UndoRedoManager","DS/AfrUndoRedoUI/Private_UndoRedoCSServices","DS/Core/Events","DS/CoreUtilities/ErrorManagement","DS/CSICommandBinder/CSICommandBinder"],function(e,a,d,h,i,c,b,g){var f={_allowedCmds:[],_connectionlost:false,EXECUTE_OPERATION:d.EXECUTE_OPERATION,BEGIN_OPERATION:d.BEGIN_OPERATION,DO_OPERATION:d.DO_OPERATION,END_OPERATION:d.END_OPERATION,setClientNode:function(k){this._connectionlost=false;var j=a.setClientNode(k);if(b.hasSucceeded(j)){a.registerAnswerCallback({domain:"AfrUndo",callback:i.getUndoServerCallback()});a.registerAnswerCallback({domain:"AfrRedo",callback:i.getRedoServerCallback()});a.registerAnswerCallback({domain:"Afr",callback:this._afrCallback});a.registerAnswerCallback({domain:"ReadOnlyOperation",callback:a.callReadOnlyCB})}return j},_isCmdAllowedToCallServer:function(j,n){if(this._connectionlost){return}if(!j||j.getCSIdentifier()===undefined){return a.returnSpecificValue(a.csErrorManager.MISSING_PARAMETERS,"No sending command (1st argument) specified for this request")}if(!j.hasDecalredCS()){return a.returnSpecificValue(a.csErrorManager.REQUEST_COULD_NOT_BE_SENT,"Command DID NOT specified it want to send request. Send forbiden.")}if(n===undefined){return a.returnSpecificValue(a.csErrorManager.MISSING_PARAMETERS,"No message (2nd argument) specified for this request")}if(n===d.START_COMMAND){if(d._getCommandLockingServer()===undefined){this._allowedCmds.push(j.getCSIdentifier());return a.returnSpecificValue(a.csErrorManager.SUCCEEDED,"Your command with instance number : '"+j.getId()+"' is allowed to call 3DCS server")}else{var l=d._getCommandLockingServer();if(this._allowedCmds.length<=1&&(l.isEnding()||l.isCanceled())){this._allowedCmds.push(j.getCSIdentifier());return a.returnSpecificValue(a.csErrorManager.SUCCEEDED,"Your command with instance number : '"+j.getId()+"' is allowed to call 3DCS server")}else{return a.returnSpecificValue(a.csErrorManager.SERVER_LOCKED_BY_ANOTHER_CMD,"Command with instance number"+d._getCommandLockingServer().getId()+" is locking the server. \nYour command (with instance number : '"+j.getId()+"') cannot be executed for the moment.")}}}else{var k=this._allowedCmds.indexOf(j.getCSIdentifier());if(k>-1){if(n===d.STOP_COMMAND){var m=this._allowedCmds.splice(k,1);if(m!==j.getCSIdentifier()){}}return a.returnSpecificValue(a.csErrorManager.SUCCEEDED,"Your command with instance number : '"+j.getId()+"' is allowed to call 3DCS server")}else{if(d._getCommandLockingServer()){if(d._getCommandLockingServer().getCSIdentifier()===j.getCSIdentifier()&&n===d.STOP_COMMAND){return a.returnSpecificValue(a.csErrorManager.SUCCEEDED,"Your command with instance number : '"+j.getId()+"' is allowed to call 3DCS server")}else{return a.returnSpecificValue(a.csErrorManager.SERVER_LOCKED_BY_ANOTHER_CMD,"Command with instance number"+d._getCommandLockingServer().getId()+" is locking the server. \n Your command (with instance number"+j.getId()+") cannot be executed for the moment.")}}else{return a.returnSpecificValue(a.csErrorManager.SERVER_NOT_LOCKED_FOR_CMD,"Command with instance number"+j.getId()+" has declared using compute server but startcommand has not locked the server for this command or the command is already ended.")}}}},_checkCmdCallParameters:function(j){if(!j){return a.returnSpecificValue(a.csErrorManager.MISSING_PARAMETERS,"No parameters defined. Expect at lest object {from: sender, \noperation : server operation to call\nmsg: message to send to the server operation\ndestinationPool: server pool where the server operation is defined")}if(!j.from){return a.returnSpecificValue(a.csErrorManager.MISSING_PARAMETERS,"No sender (paramters.from) specified.")}if(j.from.getCSIdentifier()===undefined){return a.returnSpecificValue(a.csErrorManager.WRONG_PARAMETERS,"Sender (paramters.from) has no CSIdentifier defined.")}if(!j.operation){return a.returnSpecificValue(a.csErrorManager.MISSING_PARAMETERS,"No operation (paramters.operation) specified.")}if(j.msg===undefined){return a.returnSpecificValue(a.csErrorManager.MISSING_PARAMETERS,"No message (paramters.msg) specified.")}if(j.version===undefined){j.version=1}return a.returnSpecificValue(a.csErrorManager.SUCCEEDED,"")},callOperation:function(n){if(!n.operation){console.warn("DEPRECATED","service input parameter in AfrCore.callOperation has been deprecated",'Use of an input parameter called "service" is deprecated. Specify the server operation to call in "operation".\n See afrCore.callOperation documentation');n.operation=n.service}var m={from:n.from,inputs:n.inputs,operation:e.clone(n.operation),version:e.clone(n.version),msg:e.clone(n.msg),sendOnlyLastIteration:e.clone(n.sendOnlyLastIteration),destinationPool:e.clone(n.destinationPool),callback:n.callback};var k=this._checkCmdCallParameters(m);if(!b.hasSucceeded(k)){return k}var j=m.from;var l=this._isCmdAllowedToCallServer(j,m.msg);if(!b.hasSucceeded(l)){return l}if(m.msg===f.EXECUTE_OPERATION||m.msg===f.END_OPERATION){m.killRequestAfterSend=true}else{m.killRequestAfterSend=false}return d.addMessageInStack({request:m})},sendStartCommand:function(m){var l=d._getCommandLockingServer();if(l!==undefined&&l.getCSIdentifier()===m.from.getCSIdentifier()){return a.returnSpecificValue(a.csErrorManager.REQUEST_COULD_NOT_BE_SENT,"Start command message already sent for the command with instance ID: "+m.from.getId())}var j=m.from;var k=this._isCmdAllowedToCallServer(j,d.START_COMMAND);if(!b.hasSucceeded(k)){return k}m.operation="AfrStartStopCommandOperation";m.version=1;m.msg=d.START_COMMAND;m.inputs=new g.Parameters();m.inputs.writeString("cmdId",m.from.getId());return d.addMessageInStack({request:m})},sendStopCommand:function(k){var j=this._isCmdAllowedToCallServer(k.from,d.STOP_COMMAND);if(!b.hasSucceeded(j)){return j}k.operation="AfrStartStopCommandOperation";k.version=1;k.msg=d.STOP_COMMAND;k.inputs=new g.Parameters();k.inputs.writeString("cmdId",k.from.getId());k.killRequestAfterSend=true;return d.addMessageInStack({request:k})},cancelCommandService:function(n){if(n.from===undefined||n.from.getCSIdentifier()===undefined){return a.returnSpecificValue(a.csErrorManager.NO_CMD_TO_CANCEL,"Command instance to canceled is undefined")}var p=n.from.getCSIdentifier();var l=false;if(d._getCommandLockingServer()&&d._getCommandLockingServer().getCSIdentifier()===p){l=true;d._addCmdToCancel(p)}var j=true;var m=0;var k=0;var o=d._waitingMessages.length;while(k<o&&j){if(d._waitingMessages[m].msg!==-1&&d._waitingMessages[m].from.getCSIdentifier()===p){if(d._waitingMessages[m].msg===d.STOP_COMMAND){j=false}d._waitingMessages.splice(m,1)}else{m++}k++}if(!l){return a.returnSpecificValue(a.csErrorManager.NO_CMD_TO_CANCEL,"Command canceled is not using and locking the server")}return d._cancelCurrentService(n)},_afrCallback:function(m){var k=m.readBool("stopCommand");var n=m.readBool("startCommand");if(k===true||n===true){return}var l=m.readInt32("AfrErrCode");if(l===1){var j=m.readString("AfrErrMsg");if(b.getDebugMode()===true){throw new Error(j)}else{console.error(j)}}f._synchronizeClientUndoStack(m);f.removeAfrServerParameters(m);if(d.getAppCallback()){d.getAppCallback().call(d.getCallbackObj(),m,d.getCallbackArgs());d.resetCallback()}d._unsetServerWorking();h.displayStacksSize();return d._sendNextMessages()},_synchronizeClientUndoStack:function(r){var q=r.readInt32("oldestServerUndoStep");if(q&&q>=1){var m;m=i.findFirstUndoStepServerOlderThan(q);if(m>0){h._private._undoStack.removeStepsFromId(m)}}q=undefined;var s=r.readInt32Array("undoStepsMerged");if(s&&s.length>0){for(var n=0;n<s.length;n++){var l=i.findUndoStepIdFromServerId(s[n]);if(l>-1){if(!q||q>l){q=l}i.removeUndoWithServerId(s[n])}}}var k=r.readInt32("undoStepCreated");if(k!==undefined&&k>-1){var p=r.readBool("isExclusiveServerUndo");var o=r.readString("undoTitle");i.registerServerAction({serverUndoStepId:k,undoTitle:o,serverExclusivity:p});if(q!==undefined&&q>-1){var j=i.findUndoStepIdFromServerId(k);if(j>-1&&j>q){h._private._undoStack.groupSteps(j,q)}}}else{}},removeAfrServerParameters:function(j){j.removeProperty("oldestServerUndoStep");j.removeProperty("undoStepCreated");j.removeProperty("isExclusiveServerUndo");j.removeProperty("undoStepsMerged");j.removeProperty("undoTitle");j.removeProperty("stopCommand")},onConnectionLost:function(){this._connectionlost=true;this._reset();d._reset();a._reset();c.publish({event:"COMMAND_MANAGER/Ending_Commands"});d._reset();h.flushStacks()},_reset:function(){this._allowedCmds=[]},getNode:function(){return a.getNode()},setDefaultClientNodeId:function(k){var j=a.setDefaultClientNodeId(k);if(b.hasSucceeded(j)){a.registerAnswerCallback({domain:"Afr",callback:this._afrCallback});a.registerAnswerCallback({domain:"AfrUndo",callback:i.getUndoServerCallback()});a.registerAnswerCallback({domain:"AfrRedo",callback:i.getRedoServerCallback()})}return j},initConnection:function(k){var j=a.initConnection(k);if(b.hasSucceeded(j)){a.registerAnswerCallback({domain:"Afr",callback:this._afrCallback});a.registerAnswerCallback({domain:"AfrUndo",callback:i.getUndoServerCallback()});a.registerAnswerCallback({domain:"AfrRedo",callback:i.getRedoServerCallback()})}return j}};return f});define("DS/ApplicationFrame/AfrCore",["DS/AfrUndoRedoUI/Private_UndoRedoManager","DS/ApplicationFrame/Private_AfrCSInternalServices","DS/ApplicationFrame/Private_AfrCSController","DS/ApplicationFrame/Private_AfrCS"],function(e,d,b,a){var c={setClientNode:function(f){if(!f){throw new Error("AfrCore.setClientNode takes the following input parameter: iNode (Object)")}return d.setClientNode(f)},setServerNodeId:function(f){if(!f){throw new Error("AfrCore.setServerNodeId takes the following input parameter: iNodeId (Object)")}return a.setServerNodeId(f)},callOperation:function(f){return d.callOperation(f)},EXECUTE_OPERATION:d.EXECUTE_OPERATION,BEGIN_OPERATION:d.BEGIN_OPERATION,DO_OPERATION:d.DO_OPERATION,END_OPERATION:d.END_OPERATION,callReadOnlyOperation:function(f){return b.callReadOnlyOperation(f)},interruptCurrentOperation:function(){return b.interruptCurrentOperation()},onConnectionLost:function(){return d.onConnectionLost()},isWaitingForServerAnswer:function(){return b.isServerWorking()},isOperationRunning:function(){return b.isServiceRunning()},allRequestsSent:function(){return b._waitingMessages.length===0},getNode:function(){console.warn("AfrCore.getNode is deprecated. Will be removed on 2016//03");return d.getNode()},callService:function(f){console.warn("AfrCore.callService is deprecated. Please use AfrCore.callOperation instead.");return d.callOperation(f)},setDefaultClientNodeId:function(f){console.warn("Deprecated","AfrCore.setDefaultClientNodeId has been deprecated","Please use AfrCore.setClientNode AND AfrCore.setServerNodeId to set up the necessary parameters to communicate with the compute server");return d.setDefaultClientNodeId(f)},setClientNodeId:function(f){console.warn("AfrCore.setClientNodeId best to use AfrCore.setServerNodeId ");if(!f){throw new Error("AfrCore.setClientNodeId takes the following input parameter: iNodeId (Object)")}return a.setServerNodeId(f)},setDefaultServerPoolId:function(f){console.warn("Deprecated","AfrCore.setDefaultServerPoolId has been deprecated","Please use AfrCore.setClientNode AND AfrCore.setServerNodeId to set up the necessary parameters to communicate with the compute server");return a.setDefaultServerPoolId(f)},returnValue:d.returnValue,EXECUTE_SERVICE:d.EXECUTE_OPERATION,BEGIN_SERVICE:d.BEGIN_OPERATION,DO_SERVICE:d.DO_OPERATION,END_SERVICE:d.END_OPERATION,initConnection:function(f){f.closingCallbacks=[];f.closingCallbacksObj=[];f.closingCallbacks.push(e.flushStacks);f.closingCallbacksObj.push(undefined);if(f.serverLostCallback){f.closingCallbacks.push(f.serverLostCallback);f.closingCallbacksObj.push(f.callbackObject)}console.warn("Deprecated","AfrCore.initConnection has been deprecated","Please use AfrCore.setDefaultClientNodeId or AfrCore.setDefaultServerPoolId to set up the necessary parameters to communicate");return d.initConnection(f)}};return c});define("DS/ApplicationFrame/CommandFactory",["UWA/Core","DS/Core/Core","DS/ApplicationFrame/CommandsManager","UWA/Class"],function(g,f,c,b){function a(h){if(window.DEBUG_ActionBar_CmdInstantiation){window.top.performance.mark("b_cmdInstantiation_"+h)}}function e(j,h,i){if(window.DEBUG_ActionBar_CmdInstantiation){window.top.performance.mark("e_cmdInstantiation_"+j);window.top.performance.measure(h+"_"+i+"_NewCommandFor"+j,"b_cmdInstantiation_"+j,"e_cmdInstantiation_"+j)}}var d=b.singleton({init:function(){this._parent(this.options)},_createCommandCheckHeader:function(j,h){var i=c.getCommandCheckHeader(h.ID,h.context);if(!i){a(h.ID);var i=new j({context:h.context,ID:h.ID,arguments:h.arguments,isEnabled:h.isEnabled});e(h.ID,h.perfId,h.perfStr);return i}else{return i}},_createCommand:function(j,h){var i=c.getCommand(h.ID,h.context);if(!i){a(h.ID);var i=new j({context:h.context,ID:h.ID,isEnabled:h.isEnabled,arguments:h.arguments});e(h.ID,h.perfId,h.perfStr);return i}else{return i}}});return d});define("DS/ApplicationFrame/PlayerView",["UWA/Core","UWA/Controls/Abstract","DS/ApplicationFrame/PlayerStyle","DS/ApplicationFrame/PlayerElements","DS/WebappsUtils/WebappsUtils","DS/RuntimeView/NLSManager","DS/Controls/Gauge","DS/Controls/Button","DS/Controls/Slider","DS/Controls/Abstract","DS/Controls/Popup"],function(f,i,g,e,c,q,j,k,h,n,b){var m="change";var d="editorchange";function p(s,r){return s.name==r.name}var a=n.inherit({name:"playerEditor",publishedProperties:{text:{defaultValue:"",type:String},textTotal:{defaultValue:"",type:String},editable:{defaultValue:false,type:Boolean},showTotal:{defaultValue:false,type:Boolean}},_preBuildView:function(){var s=this;var r="wux-afr-cmdstarter wux-controls-player-button";this.elements.container=new f.Element("div",{"class":"wux-controls-player-editor-ctn",style:{display:"inline-block"}});this.elements.editor=new f.Element("input",{"class":"wux-controls-player-editor",events:{onchange:function(u){var t=document.createEvent("Event");t.initEvent(d,true,false);t.dsModel=s;t.textValue=s.elements.editor.getAttribute("text");s.elements.container.dispatchEvent(t)},click:function(t){t.stopPropagation()}}});this.elements.editor.setAttribute("type","text");this.elements.editor.setAttribute("value","00:00:00");this.elements.editor.inject(this.elements.container);this.elements.playerEditor=this.elements.container;this._parent()},_applyText:function(r){this.elements.editor.setAttribute("value",this.text)},_applyTextTotal:function(r){if(!this.elements.totalLabel){return}this.elements.totalLabel.setText(this.totalText)},_applyProperties:function(r){if(!this.editable){this.elements.editor.setAttribute("readonly","readonly")}if(!this.showTotal){return}if(!this.elements.totalLabel){this.elements.totalLabel=new f.Element("div",{"class":"wux-controls-player-total-label",styles:{},html:this.textTotal}).inject(this.getContent())}},handleEvents:function(){}});var o=n.inherit({name:"playerButton",publishedProperties:{label:{defaultValue:"",type:String},dataName:{defaultValue:"",type:String},icon:{defaultValue:"",type:String}},_preBuildView:function(){var r="wux-afr-cmdstarter wux-controls-player-button";this.elements.container=new f.Element("div",{"class":r});this.elements.playerButton=this.elements.container;this._parent()},_applyProperties:function(r){this._parent(r);if(this.icon||this.icon==""){if(!this.elements.icon){this.elements.icon=new f.Element("div",{styles:{width:32,height:32,backgroundImage:this.icon,backgroundSize:"cover",lineHeight:"32px",display:"inline-block",verticalAlign:"top"}});this.elements.icon.inject(this.getContent())}else{this.elements.icon.setStyle("background","url("+this.icon+")")}}if(this.label||this.label==""){if(!this.elements.label){this.elements.label=new f.Element("div",{html:this.label,"class":"wux-afr-label"});this.elements.label.inject(this.getContent())}else{this.elements.label.setText(this.label)}this.getContent().setAttribute("title",this.label)}if(this.dataName){this.getContent().setAttribute("data-name",this.dataName.toLowerCase())}}});var l=i.extend({init:function(r){this._model=r;this._callbacks=r.callbacks;if(this._callbacks==undefined){this._callbacks={}}this._parent();this._lines=1;this._secondaryLevel=0;this._buildView();this._respondToActions(this._model.state)},_buildView:function(){this.elements.container=new f.Element("div",{"class":"wux-controls-playerview "});this.elements.leftOrBottom=new f.Element("div",{"class":"wux-controls-player-left-or-bottom-ctn "}).inject(this.elements.container);this.elements.rightFixedContainer=new f.Element("div",{"class":"wux-controls-player-right-ctn"}).inject(this.elements.container);this.elements.extensibleContainer=new f.Element("div",{"class":"wux-controls-player-extensible-ctn "}).inject(this.elements.container);this._indexesAndViews={};this._maxSecondaryLevel=0;var v=false;this._noSlider=true;var t=this._model.elements;for(var u=0;u<t.length;u++){var x=t[u];var s=this.elements.leftOrBottom;if(x.group===e.SLIDER){this._noSlider=false;s=this.elements.extensibleContainer}else{if(v){s=this.elements.rightFixedContainer}}if(x.topLine){v=true}var r=this._createElement(x,s);if(x.hiddenByDefault){this._setVisibleView(r,false)}this._indexesAndViews[x.id]={index:u,view:r};this._maxSecondaryLevel=Math.max(this._maxSecondaryLevel,x.secondary)}this._createBurgerMenu().inject(this.elements.leftOrBottom);var w=this;this.elements.exitButton=this._createPlayerButton("exit",false);if(this._noSlider){this.elements.exitButton.inject(this.elements.leftOrBottom)}else{this.elements.exitButton.inject(this.elements.rightFixedContainer)}this.elements.container.setAttribute("data-player-style",this._model.name)},_createElement:function(u,r){switch(u.group){case e.SLIDER:this.elements.slider=this._createSlider(u.id);this.elements.slider.inject(r);return this.elements.slider;case e.EDITOR:var v=this._model.formatterLabel(1);this.elements.playerEditor=new a({editable:this._model.editableLabel,showTotal:this._model.useTotal,textTotal:v});var s=u.id;var t=this;this.elements.playerEditor.addEventListener(d,function(w){t._publish(s,d)});this.elements.playerEditor.inject(r);return this.elements.playerEditor;default:var s=u.id;return this._createPlayerButton(s,u.checkMode).inject(r)}},_createEditor:function(r,u){var t=this;var s=new f.Element("input",{"class":"wux-controls-player-editor",events:{focusout:function(v){t._publish(r,d)},click:function(v){v.stopPropagation()}}});s.setAttribute("type","text");s.setAttribute("value","00:00:00");if(!u){s.setAttribute("readonly","readonly")}return s},_createSlider:function(r){var u=this._model.progress*100;var t=new h({value:u,minValue:0,maxValue:100,stepValue:1});var s=this;t.getContent().addEventListener("change",function(w){s._model.progress=t.value/100;var v=s._model.formatterLabel(s._model.progress);if(s.elements.playerEditor!=undefined){s.elements.playerEditor.text=v}s._publish(r,m)});return t},_createPlayerButton:function(r,z){var u=this;var x=r.substring(0,1).toUpperCase()+r.substring(1,r.length);var s="url("+c.getWebappsBaseUrl()+"Controls/assets/I_CompassPlayer"+x+".png)";var t=new o({dataName:r,icon:s});var y=x+"Button.Title";t.label=x;var v="Controls/DSPlayer";q.onResourceLoaded({resourceFile:v,language:u._model.language},function(){var A=this.getTitle({key:y});t.label=A});t.addEventListener("click",function w(){u._respondToActions(r);u._publish(r,r)});return t},getButtonWidth:function(){return Math.max(this.elements.exitButton.getContent().getSize().width,40)+4},_createBurgerMenu:function(){this.elements.burgerButton=this._createPlayerButton("hamburger",false,undefined);var r=new f.Element("div",{"class":"wux-controls-player-hbg-menu",styles:{}});this.elements.burgerMenuTop=new f.Element("div",{styles:{}}).inject(r);this.elements.burgerMenuBottom=new f.Element("div",{styles:{}}).inject(r);this.elements.popupBurgerMenu=new b({target:this.elements.burgerButton,position:"top",alignment:"center",trigger:"click"});this.elements.popupBurgerMenu.setBody(r);this._setVisibleView(this.elements.burgerButton,false);return this.elements.burgerButton},_publish:function(s,t){var u=this;var w=u._callbacks[s];if(w!=undefined){var r=null;var v=u._model.progress;if(u.elements.editor){r=u.elements.editor.text}w({context:u,event:t,data:{eventId:t,source:u,textValue:r,value:v}})}},respondToWidthChange:function(){this.elements.popupBurgerMenu.visibleFlag=false;var D=false;var x=this.getButtonWidth();if(this._secondaryLevel==0){if(this._lines==1){var r=this.elements.container.getSize();var G=this.elements.extensibleContainer.getSize();if(this._model.minimalSliderWidth!=undefined&&(G.width<this._model.minimalSliderWidth||r.height>x)){this._lines=2;D=true;this.elements.container.addClassName("two-lines");this.elements.leftOrBottom.remove();this.elements.leftOrBottom.inject(this.elements.container);this.elements.exitButton.getContent().remove();this.elements.exitButton.inject(this.elements.leftOrBottom)}}else{var G=this.elements.extensibleContainer.getSize();if(this._model.maximalSliderWidth!=undefined&&G.width>this._model.maximalSliderWidth){this._lines=1;D=true;this.elements.container.removeClassName("two-lines");this.elements.rightFixedContainer.remove();this.elements.extensibleContainer.remove();this.elements.rightFixedContainer.inject(this.elements.container);this.elements.extensibleContainer.inject(this.elements.container);if(!this._noSlider){this.elements.exitButton.getContent().remove();this.elements.exitButton.inject(this.elements.rightFixedContainer)}}}}var r=this.elements.container.getSize();if(this.elements.exitButton.getContent().getParent()==this.elements.leftOrBottom){var F=this._getVisibleItems(false);var C=F.length+1;if(this._secondaryLevel>0){C++}var B=C*x;var z=r.width-B;var u=false;while(z<x&&this._secondaryLevel<this._maxSecondaryLevel){u=true;this._secondaryLevel++;var t=this._model.elements;for(var A=0;A<t.length;A++){var y=t[A];if(y.secondary===this._secondaryLevel){var E=this._indexesAndViews[y.id].view;E.remove();C--;B=C*x;if(!y.secondaryPosition||y.secondaryPosition=="top"){E.inject(this.elements.burgerMenuTop)}else{if(y.secondaryPosition=="bottom"){E.inject(this.elements.burgerMenuBottom)}}}}if(this._secondaryLevel>0){this._setVisibleView(this.elements.burgerButton,true)}z=r.width-B}if(!u&&z>x*2&&this._secondaryLevel>0){var t=this._model.elements;for(var A=0;A<t.length;A++){var y=t[A];var s=this.elements.leftOrBottom;if(y.topLine){s=this.elements.rightFixedContainer}if(y.secondary===this._secondaryLevel){var E=this._indexesAndViews[y.id].view;E.remove();if(!y.topLine){if(A>0){var w=this._indexesAndViews[t[A-1].id].view;E.getContent().inject(w.getContent(),"after")}else{E.getContent().inject(s,"top")}}else{E.inject(s)}}}this._secondaryLevel--;if(this._secondaryLevel==0){this._setVisibleView(this.elements.burgerButton,false)}}}},_getVisibleItems:function(x){var r=[];var t=this._model.elements;for(var u=0;u<t.length;u++){var w=t[u];var s=this._indexesAndViews[w.id].view;if(this._isVisibleView(s)&&w.topLine==x&&(w.secondary==0||w.secondary>this._secondaryLevel)){r.push(w)}}return r},_getView:function(r){return this._indexesAndViews[r].view},updateState:function(){this._respondToActions(this._model.state);if(this.elements.slider!=undefined){this.elements.slider.value=this._model.progress*100}if(this.elements.playerEditor){this.elements.playerEditor.text=this._model.formatterLabel(this._model.progress);this.elements.playerEditor.totalText=this._model.formatterLabel(1)}},_respondToActions:function(y){if(y=="hamburger"){return}var r=this._model.elements;if(this._previousState===y){return}if(this._previousState){var s=r[this._indexesAndViews[this._previousState].index];if(s){var t=this._indexesAndViews[this._previousState].view;t.getContent().removeClassName("active-action")}}var z=this._indexesAndViews[y];if(z==undefined){return}this._model.state=y;var x=r[z.index];if(x==undefined){throw"the state "+y+" do not exist in the index"}var u=x.visibleOnActive;for(var A=0;u!=undefined&&A<u.length;A++){var C=this._indexesAndViews[u[A]];if(C){var B=C.view;if(B==undefined){throw"the view identified by "+u[A]+" do not exist in the index"}this._setVisibleView(B,true)}}var w=x.hideOnActive;for(var A=0;w!=undefined&&A<w.length;A++){var C=this._indexesAndViews[w[A]];if(C){var v=C.view;if(v==undefined){throw"the view identified by "+w[A]+" do not exist in the index"}this._setVisibleView(v,false)}}if(x.checkMode){var D=z.view;D.getContent().addClassName("active-action")}this._previousState=y},_setVisibleView:function(r,s){if(s){r.getContent().removeClassName("view-hide")}else{r.getContent().addClassName("view-hide")}},_isVisibleView:function(r){var s=r?r.getContent().getStyle("display"):"none";return(s!="none")}});return l});define("DS/ApplicationFrame/CommandContainer",["UWA/Core","DS/Core/Core","UWA/Controls/Abstract","DS/WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandStarter","DS/Core/PointerEvents","DS/Controls/Popup","DS/RuntimeView/RSCManager","DS/RuntimeView/NLSManager","DS/WebRecordEnabler/Adapter"],function(e,j,i,d,f,g,c,k,l,b){function a(o,n){var m=o;if(m){var p=(" "+m.className+" ").replace(/[\n\t]/g," ").indexOf(" "+n+" ")>-1;if(p){return m}else{return a(m.parentNode,n)}}else{return}}var h=i.extend({defaultOptions:{},init:function(m,n){this._parent(m);this._dafrManager=n;this._items=[];this._buildView()},_buildView:function(){var s=this;this.elements.container=new e.Element("div",{"class":"wux-afr-cmdContainer"});for(var n in this.options){if(this.options.hasOwnProperty(n)){this.elements.container.setAttribute("data-"+n.toLowerCase(),this.options[n])}}function m(u){if(!a(u.target,"wux-afr-dropdown-popup")){s._dafrManager._modelEvents.publish({event:"HIDE_DROPDOWN_MENUS"})}}switch(this.options.RepresentationType){case"AfrActionBarDropDown":if(this.options.ResourceFile===undefined){this.elements.currentCommand=new e.Element("div",{}).inject(this.elements.container);this.elements.dropDownArrow=new e.Element("div",{"class":"wux-afr-dropdown-arrow",html:new e.Element("div",{styles:{background:"url("+d.getWebappsBaseUrl()+"Controls/assets/arrow-b.png)",backgroundRepeat:"no-repeat",backgroundSize:"5px",backgroundPosition:"center center",width:8,height:"100%"}})}).inject(this.elements.container)}else{this.elements.dropDownArrow=new e.Element("div",{styles:{width:"100%",height:"100%"}}).inject(this.elements.container);var o=new e.Element("div",{styles:{width:"calc(100% - 11px)",height:"100%"}}).inject(this.elements.dropDownArrow);var t=new e.Element("div",{styles:{background:"url("+d.getWebappsBaseUrl()+"Controls/assets/arrow-b.png)",backgroundRepeat:"no-repeat",backgroundSize:"5px",backgroundPosition:"center center",width:11,height:"100%",position:"absolute",right:0,top:0,display:"inline-block",borderRadius:"0 3px 3px 0",boxSizing:"border-box",}}).inject(this.elements.dropDownArrow);var r=this.options.ResourceFile;var q=o;k.onResourceLoaded({resourceFile:r},function(){var x=s.options.Name;var v;if(s.options.Icon){v=d.getWebappsBaseUrl()+s.options.Icon}else{v=this.getIcon({key:x,size:"Normal"})}var y=e.extend(q);var w=new e.Element("div",{styles:{width:32,height:32,backgroundImage:"url("+v+")",backgroundSize:"cover",lineHeight:"32px",display:"inline-block",verticalAlign:"top"}}).inject(y);y.setAttribute("title",x);var u=new e.Element("div",{html:x,"class":"wux-afr-label"});y.appendChild(u);l.onResourceLoaded({resourceFile:r,language:s._dafrManager.options.language},function(){var z=this.getTitle({key:x,});y.setAttribute("title",z);u.set("html",z)})},{})}this.elements.listOfCommands=new e.Element("ul",{"class":"wux-afr-dropdown-menu wux-ui-stack-v"});this.elements.dropDownArrow.addEventListener("click",function(v){v.preventDefault();v.stopPropagation();v.stopImmediatePropagation();s._dafrManager._modelEvents.publish({event:"HIDE_DROPDOWN_MENUS"});if(s.elements.dropDownPopup===undefined){var u={target:s.elements.container,position:"top",offset:{x:0,y:0},alignment:"left",constraint:"screen",visibleFlag:false,overlap:false,arrowBoxFlag:false,trigger:""};s.elements.dropDownPopup=new c(u);s.elements.dropDownPopup.getContent().addClassName("wux-afr-dropdown-popup");if(window.DSWebRecord){s.elements.dropDownPopup.getContent().setAttribute("data-rec-id","flyout");s.markForRecord(s.elements.dropDownPopup.getContent())}s.elements.dropDownPopup.setBody(s.elements.listOfCommands)}s.elements.dropDownPopup.addEventListener("mouseenter",function(x){var w=s.elements.container.querySelector(".wux-afr-cmdstarter");if(w&&!w.hasClassName("wux-afr-dropdown-starter-presenter")){w.addClassName("wux-afr-dropdown-starter-presenter")}});s.elements.dropDownPopup.addEventListener("mouseleave",function(x){var w=s.elements.container.querySelector(".wux-afr-cmdstarter");if(w&&w.hasClassName("wux-afr-dropdown-starter-presenter")){w.removeClassName("wux-afr-dropdown-starter-presenter")}});s.elements.dropDownPopup.show();s.elements.container.toggleClassName("wux-ui-state-active");s._dafrManager.getContent().getParent().toggleClassName("wux-ui-state-active")});s.elements.container.addEventListener("mouseup",function(){s._dafrManager._modelEvents.publish({event:"HIDE_DROPDOWN_MENUS"})});s.elements.container.addEventListener("touchend",function(){s._dafrManager._modelEvents.publish({event:"HIDE_DROPDOWN_MENUS"})});window.addEventListener("mousedown",m,true);window.addEventListener("touchend",m,true);this._dafrManager._modelEvents.subscribe({event:"HIDE_DROPDOWN_MENUS"},function(){s.elements.container.removeClassName("wux-ui-state-active");if(s.elements.dropDownPopup){s.elements.dropDownPopup.removeEventListener("mouseenter");s.elements.dropDownPopup.removeEventListener("mouseleave");var u=s.elements.container.querySelector(".wux-afr-cmdstarter");if(u){u.removeClassName("wux-afr-dropdown-starter-presenter")}s.elements.dropDownPopup.hide()}if(s._dafrManager.getContent().getParent()){s._dafrManager.getContent().getParent().removeClassName("wux-ui-state-active")}});break;case"AfrActionBarSection":var p=this._dafrManager._registerSection(this);if(p>1){this.elements.container.hide()}break;case"AfrActionBarFixedSection":this._dafrManager._registerFixedSection(this);break}},appendChildCusto:function(n){var o=this;switch(this.options.RepresentationType){case"AfrActionBarDropDown":if(n){var p=n.getContent();if(p&&p.tooltipInfos){p.tooltipInfos.position="right"}else{p._privateAfrTmpIsInDropDown=true}}var m=new e.Element("li",{html:n,"data-index":this._items.length,styles:{display:"block",userSelect:"none"}});m.addEvent(g.POINTERUP,function(q){q.stopPropagation();q.stopImmediatePropagation();o.selectCommand(n)});this.elements.listOfCommands.appendChild(m);if(this._items.length===0){this.selectCommand(n)}break;default:if(n.tagName){this.elements.container.appendChild(n)}else{this.elements.container.appendChild(n.getContent())}break}this._items.push(n)},selectCommand:function(m){if(this.elements.currentCommand===undefined){return}if(this.options.Icon){m.options.Icon=this.options.Icon}var n=new f(m.options,m._dafrManager);this.elements.currentCommand.setHTML(n)}});if(window.DSWebRecord){b.register(h,"DS/CommandRecord/ActionBarRecord")}return h});define("DS/ApplicationFrame/Json2Html",["UWA/Core","DS/Core/Core","UWA/Controls/Abstract","DS/RuntimeView/RSCManager","DS/RuntimeView/NLSManager","DS/WebappsUtils/WebappsUtils","DS/Core/ModelEvents","DS/Utilities/Xml","DS/ApplicationFrame/CommandContainer","DS/ApplicationFrame/CommandStarter","DS/ApplicationFrame/CommandFactory"],function(i,f,q,n,m,h,o,g,c,b,j){var d=false;function l(t){return t["@tag"]}function e(t){return t["@children"]}function r(t,u){if(t&&t["@attributes"]){return t["@attributes"][u]}}function p(t){if(t){return t["@attributes"]}else{return{}}}function k(y,x,w,v){var t="";for(var u=0;u<y;u++){t=t+"    "}t=t+"|--";if(d){console.log(t,x,w,v)}}var a={CATCmdStarter:b,CATCmdContainer:c};var s=q.extend({defaultOptions:{xml:null,module:null,directory:"assets/afr/",fileExtension:".xml",onComplete:null,onFailure:null,showLabels:false,_createView:true},init:function(t){this._parent(t);this._perfId=t.perfId;this._perfStr=t.perfStr;this._buildView();var u=this;setTimeout(function(){u._initialize(t)},1)},_initialize:function(u){if(u.actionBar===undefined&&this.options.actionBar!==undefined&&this.options.actionBar===true){u.actionBar=true}this.options=i.extend({merge:true,_createView:true},u);this._isAlreadyProcessed=false;this._modelEvents=new o();this._currentSectionID=0;this._listOfSections=[];this._listOfFixedSections=[];var w=window.location.href.split("?")[0];var t=w.split("/");this._currentModule=t[t.length-2];this._host=h.getWebappsBaseUrl();var x=this;x.backMAB=u.backMAB;var v=h.getWebappsBaseUrl()+(this.options.module||this._currentModule)+"/"+this.options.directory+this.options.xml;this._loadXML(v,function(y){x._model=y;x._processAFR();x.goToNthSection(0)})},merge:function(u){var v=this;this._isAlreadyProcessed=false;this._modelEvents=new o();this._currentSectionID=0;this._listOfSections=[];this._listOfFixedSections=[];this.getCommandHeadersList()["@children"]=this.getCommandHeaders().concat(u.getCommandHeaders());var t=e(this.getWorkbench());var w=e(u.getWorkbench());w.forEach(function(x){var y=r(x,"Name");var z;t.forEach(function(A){if(y===r(A,"Name")){if(d){console.warn("---> found already defined section",y);console.log("----->",A["@children"])}A["@children"]=e(A).concat(e(x));z=true}});if(!z){if(d){console.warn("---> new section",y)}v.getWorkbench()["@children"].push(x)}});this._processAFR()},getModel:function(){return this._model},_loadXML:function(u,x){var v=this;var w="Ajax";if(h.getWebappsBaseUrl()!=="../"){w="Data"}if(window.DEBUG_ActionBar_Xml){window.top.performance.mark("b_xml")}if(typeof this.options.xml==="string"){i[w].request(u,{isAsync:true,onComplete:function(B){var y;if(window.DEBUG_ActionBar_Xml){window.top.performance.mark("e_xml");var C=u.split("/");y=C[C.length-1];window.top.performance.measure(v._perfId+"_"+v._perfStr+"_XMLRequestFor"+y,"b_xml","e_xml");window.top.performance.mark("b_xmlParse")}B.replace(/<!--[\s\S]*?-->/g,"");var A=i.Utils.loadXml(B);var z=v._convertXml2Json(A);if(window.DEBUG_ActionBar_Xml){window.top.performance.mark("e_xmlParse");window.top.performance.measure(v._perfId+"_"+v._perfStr+"_XMLToJsonOf"+y,"b_xmlParse","e_xmlParse")}x.call(v,z);v._modelEvents.publish({event:"COMPLETE"})},onFailure:function(y){console.error("[!]\tError loading file:"+u);if(v.options.onFailure){v.options.onFailure.call(v,y)}}})}else{var t=v._convertXml2Json(this.options.xml);x.call(v,t)}},onReady:function(t){return this._modelEvents.subscribe({event:"COMPLETE"},t)},_convertXml2Json:function(u){if(!this._isAlreadyProcessed){this._isAlreadyProcessed=true;var t=g.toJson(u);if(d){console.log("AFR XML model",u);console.log("AFR JSON model",t)}return t}},_searchTag:function(w,v){var t;var u=w["@children"];u.some(function(y,x,z){if(l(y)===v){t=y;return true}return false});return t},nextSection:function(){this._currentSectionID++;this.goToNthSection(this._currentSectionID)},goToNthSection:function(v){var t=this;this.getSections().forEach(function(x,w){if(w!==v){x.hide()}else{x.show()}});this._currentSectionID=v;this._modelEvents.publish({event:"HIDE_DROPDOWN_MENUS"});var u=t.getNthSection(v);if(u){this._modelEvents.publish({context:this,event:"CHANGE_SECTION",data:{sectionID:v,section:u}})}},previousSection:function(){this._currentSectionID--;this.goToNthSection(this._currentSectionID)},getStyles:function(){return this.getModel()["@children"][0]},getTemplates:function(){return this.getStyles()["@children"]},getWorkbench:function(){var t;var u=this;this.getTemplates().some(function(w){var v=u._searchTag(w,"CATCmdWorkbench");if(v){t=v;return true}});t.backCB=u.backMAB;return t},getCommandHeadersList:function(){var t;var u=this;this.getTemplates().some(function(w){var v=u._searchTag(w,"CATCmdHeadersList");if(v){t=v;return true}});return t},getCommandHeader:function(u){var t;e(this.getCommandHeadersList()).forEach(function(v){if(!t){var w=r(v,"ID");if(w===u){t=v}}});return p(t)},getCommandHeaders:function(){var t=[];this.getCommandHeadersList()["@children"].forEach(function(u){if(l(u)){t.push(u)}});return t},_buildView:function(){this.elements.container=new i.Element("div",{"class":"wux-afr wux-afr-view"});if(this.options.actionBar!==undefined&&this.options.actionBar===true){this.elements.scrollButtons=Object.create(null);this.elements.scrollButtons.leftButton=new i.Element("div",{"class":"wux-afr-buttons wux-afr-button-left"});this.elements.scrollButtons.rightButton=new i.Element("div",{"class":"wux-afr-buttons wux-afr-button-right"});this.elements.borderContainer=new i.Element("div",{"class":"wux-afr-border-container"});var t=this;this.elements.scrollButtons.leftButton.inject(this.elements.container);this.elements.scrollButtons.leftButton.addEvent("click",function(){var u=t.elements.borderContainer,v=u.children[0],w=0;if(v){w=v.scrollLeft-(u.clientWidth-146);if(w<0){w=0}v.scrollLeft=w}});this.elements.borderContainer.inject(this.elements.container);window.borderContainer=this.elements.borderContainer;this.elements.scrollButtons.rightButton.inject(this.elements.container);this.elements.scrollButtons.rightButton.addEvent("click",function(){var u=t.elements.borderContainer,v=u.children[0],w=0;if(v){var w=v.scrollLeft+(u.clientWidth-146);if(w>v.width){w=v.width}v.scrollLeft=w}})}},showLabels:function(){this.elements.container.addClassName("wux-afr-state-labels");this.elements.container.removeClassName("wux-afr-state-nolabels");this._modelEvents.publish({event:"SHOW_LABELS"})},hideLabels:function(){this.elements.container.removeClassName("wux-afr-state-labels");this.elements.container.addClassName("wux-afr-state-nolabels");this._modelEvents.publish({event:"HIDE_LABELS"})},onShowLabels:function(t){return this._modelEvents.subscribe({event:"SHOW_LABELS"},t)},onHideLabels:function(t){return this._modelEvents.subscribe({event:"HIDE_LABELS"},t)},getLabelsVisibility:function(){return !this.elements.container.hasClassName("wux-afr-state-nolabels")},toggleLabels:function(){this.elements.container.toggleClassName("wux-afr-state-nolabels")},_processAFR:function(){this._processCommandHeaders();var t=this.getWorkbench(true);t.backCB=this.backMAB;if(this.options.actionBar!==undefined&&this.options.actionBar===true){this._processCommands(null,t,this.elements.borderContainer)}else{this._processCommands(null,t,this.elements.container)}if(this.options.showLabels){this.showLabels()}else{this.hideLabels()}},_postProcessAFR:function(){var t=this;if(t._listOfSections.length){t._listOfFixedSections.forEach(function(u){u.getContent().inject(t.getNthSection(0).getContent(),"top")});this._modelEvents.subscribe({event:"CHANGE_SECTION"},function(u){t._listOfFixedSections.forEach(function(v){v.getContent().inject(u.section.getContent(),"top")})})}},_getCommandHeaderArgs:function(u){var v=[];var t=e(u);if(t){t.forEach(function(y){var x=l(y);switch(x){case"CATAfrCommandHeaderArgs":var w=e(y);if(w){w.forEach(function(A){var z=l(A);switch(z){case"CATCommandHeaderArg":v.push(p(A));break}})}break}})}return v},_processCommandHeaders:function(){var u=this;var t=function(w){if(u.getCommandHeaders().length===w&&u.options.onComplete){if(window.DEBUG_ActionBar_ProcessCommandHeader){window.top.performance.mark("e_processCommandHeaders");window.top.performance.measure(u._perfId+"_"+u._perfStr+"_ProcessCommandHeader","b_processCommandHeaders","e_processCommandHeaders")}u._postProcessAFR();u.options.onComplete.call(u)}};var v=0;if(window.DEBUG_ActionBar_ProcessCommandHeader){window.top.performance.mark("b_processCommandHeaders")}this.getCommandHeaders().forEach(function(z){var B=r(z,"ClassName");var x=r(z,"ID");var w=r(z,"Behavior");var y=r(z,"Available");var E=true;if(y==="0"){E=false}var D=r(z,"ResourceFile");if(x){n.loadResource({resourceFile:D});m.loadResource({resourceFile:D});var A=u._getCommandHeaderArgs(z);if(B){var C=B.replace(/\./g,"/");if(window.DEBUG_ActionBar_Require){if(v<=0){window.top.performance.mark("b_require_"+C)}}require([C],function(F){if(window.DEBUG_ActionBar_Require){window.top.performance.mark("e_require_"+C);window.top.performance.measure(u._perfId+"_"+u._perfStr+"_RequireFor"+C,"b_require_"+C,"e_require_"+C)}v++;if(F){if(w==="CATAfrHeaderCheck"){j._createCommandCheckHeader(F,{context:u.options.context,ID:x,isEnabled:E,arguments:A,perfId:u._perfId,perfStr:u._perfStr})}else{j._createCommand(F,{context:u.options.context,ID:x,isEnabled:E,arguments:A,perfId:u._perfId,perfStr:u._perfStr})}}else{console.warn("[DAFR]","The module",C,"has been loaded, but the returned object is undefined. Please check if in this module, there is an object returned.")}t(v)},function(F){if(window.DEBUG_ActionBar_Require){window.top.performance.mark("e_require_"+C);window.top.performance.measure(u._perfId+"_"+u._perfStr+"_RequireFor"+C,"b_require_"+C,"e_require_"+C)}v++;t(v)})}}})},_registerSection:function(t){return this._listOfSections.push(t)},_registerFixedSection:function(t){this._listOfFixedSections.push(t)},_processCommands:function(t,w,y,z){if(w){if(z===undefined){z=0}var x=this;var v=function(F){if(F){var A=l(F);var C=p(F);k(z,A,C);var B,D;if(a[A]){B=new a[A](C,x);if(!x.options.actionBar){if(F["@attributes"]&&F["@attributes"].RepresentationType!=="AfrActionBarSection"){D=new a[A](C,x)}}}else{var E;if(A){E=A.replace("CATC","c")}else{E="actionBar"}B=new i.Element("div",{"class":"wux-afr-"+E,styles:{display:"inline-block"}});if(!x.options.actionBar){D=new i.Element("div",{"class":"wux-afr-"+E,styles:{display:"inline-block"}})}}if(y.appendChildCusto){y.appendChildCusto(B)}else{if(B.tagName){y.appendChild(B)}else{y.appendChild(B.getContent())}}F["@view"]=B;if(!x.options.actionBar){if(F["@attributes"]&&F["@attributes"].RepresentationType!=="AfrActionBarSection"){F["@viewMAB"]=D}}return B}else{console.log("Something is wrong");return null}};var u=x.options._createView?v(w):null;if(w["@children"]){z++;w["@children"].forEach(function(A){x._processCommands.call(x,w,A,u,z)})}}else{console.log("Something is wrong")}},getNumberOfSections:function(){if(this._listOfSections===undefined){return 0}return this._listOfSections.length},getSections:function(){return this._listOfSections},getNthSection:function(t){return this._listOfSections[t]},getCurrentSection:function(){return this.getNthSection(this._currentSectionID)},getSectionIDByName:function(u){var t;this.getSections().forEach(function(w,v){if(w.options.Name===u){t=v}});return t},getSectionID:function(t){var u;this.getSections().forEach(function(w,v){if(w.options.Name===t.options.Name){u=v}});return u}});return s});define("DS/ApplicationFrame/AfrPlayerService",["UWA/Core","DS/Core/Core","UWA/Class","DS/ApplicationFrame/PlayerStyle","DS/ApplicationFrame/PlayerElements","DS/ApplicationFrame/PlayerView"],function(h,e,a,g,d,f){var c={SIMPLE:{name:"SIMPLE",state:"pause",progress:0,editableLabel:false,minimalSliderWidth:240,useTotal:false,language:null,elements:[{id:"play",group:d.PLAY_PAUSE,visibleOnActive:["pause"],hideOnActive:["play"],topLine:false,secondary:0},{id:"pause",group:d.PLAY_PAUSE,visibleOnActive:["play"],hideOnActive:["pause"],topLine:false,secondary:0},{id:"slider",group:d.SLIDER,topLine:false,secondary:0}]},TOUR3D:{name:"3DTOUR",state:"pause",progress:0,editableLabel:false,minimalSliderWidth:240,maximalSliderWidth:680,useTotal:false,language:null,elements:[{id:"back",group:d.BACK_NEXT,topLine:false,secondary:0},{id:"play",group:d.PLAY_PAUSE,visibleOnActive:["pause"],hideOnActive:["play"],topLine:false,secondary:0},{id:"pause",group:d.PLAY_PAUSE,visibleOnActive:["play"],hideOnActive:["pause"],topLine:false,secondary:0},{id:"next",group:d.BACK_NEXT,topLine:false,secondary:0},{id:"slider",group:d.SLIDER,topLine:true,secondary:0}]},RUN:{name:"RUN",state:"pause",progress:0,editableLabel:false,useTotal:false,language:null,elements:[{id:"stop",group:d.STOP,visibleOnActive:["next"],hideOnActive:["backward","forward"],topLine:false,secondary:0},{id:"pause",group:d.PLAY_PAUSE,checkMode:true,visibleOnActive:["next"],hideOnActive:["backward","forward"],topLine:false,secondary:0},{id:"play",group:d.PLAY_PAUSE,checkMode:true,visibleOnActive:["backward","forward"],hideOnActive:["next"],topLine:false,secondary:0},{id:"next",group:d.BACK_NEXT,topLine:false,secondary:0},{id:"backward",group:d.BACKWARD_FORWARD,topLine:false,secondary:0},{id:"forward",group:d.BACKWARD_FORWARD,topLine:false,secondary:0},{id:"options",group:d.OPTIONS,topLine:false,secondary:3,secondaryPosition:"top"},{id:"stack",group:d.PLAYLIST,topLine:false,secondary:2,secondaryPosition:"top"},{id:"editor",group:d.EDITOR,topLine:false,secondary:1,secondaryPosition:"top"}]},SIMULATION:{name:"SIMULATION",state:"pause",progress:0,editableLabel:false,minimalSliderWidth:320,maximalSliderWidth:800,useTotal:false,language:null,elements:[{id:"first",group:d.FIRST_LAST,topLine:false,secondary:1,secondaryPosition:"top"},{id:"back",group:d.BACK_NEXT,topLine:false,secondary:0},{id:"backward",group:d.BACKWARD_FORWARD,topLine:false,secondary:0},{id:"playReverse",group:d.PLAYREVERSE,checkMode:true,visibleOnActive:["backward","forward"],hideOnActive:["back","next"],topLine:false,secondary:0},{id:"pause",group:d.PLAY_PAUSE,checkMode:true,visibleOnActive:["back","next"],hideOnActive:["backward","forward"],topLine:false,secondary:0},{id:"play",group:d.PLAY_PAUSE,checkMode:true,visibleOnActive:["backward","forward"],hideOnActive:["back","next"],topLine:false,secondary:0},{id:"next",group:d.BACK_NEXT,topLine:false,secondary:0},{id:"forward",group:d.BACKWARD_FORWARD,topLine:false,secondary:0},{id:"last",group:d.FIRST_LAST,topLine:false,secondary:1,secondaryPosition:"top"},{id:"loopRC",group:d.LOOPRC,visibleOnActive:["loopRCBF"],hideOnActive:["loopRC"],topLine:false,secondary:0},{id:"loopRCBF",group:d.LOOPRCBF,visibleOnActive:["loopRO"],hideOnActive:["loopRCBF"],topLine:false,secondary:0,hiddenByDefault:true},{id:"loopRO",group:d.LOOPRO,visibleOnActive:["loopRC"],hideOnActive:["loopRO"],topLine:false,secondary:0,secondaryPosition:"top",hiddenByDefault:true},{id:"options",group:d.OPTIONS,topLine:false,secondary:3,secondaryPosition:"top"},{id:"stack",group:d.PLAYLIST,topLine:false,secondary:2,secondaryPosition:"top"},{id:"slider",group:d.SLIDER,topLine:true,secondary:0},{id:"editor",group:d.EDITOR,topLine:true,secondary:1,secondaryPosition:"bottom"}]}};var b=a.singleton({state:{state:"pause",progress:0},actions:{PLAY:"play",PAUSE:"pause",BACK:"back",NEXT:"next",BACKWARD:"backward",FORWARD:"forward",FIRST:"first",LAST:"last",STOP:"stop",PLAYREVERSE:"playReverse",SLIDER_CHANGE:"slider",EDITOR_CHANGE:"editorchange",LOOPRC:"loopRC",LOOPRCBF:"loopRCBF",LOOPRO:"loopRO",PLAYLIST:"playlist",OPTIONS:"options",EXIT:"exit"},defaultOptions:{style:g.TOUR3D,excludedElements:[],useTotal:true,editableLabel:true,language:null,callbacks:{},formatterLabel:function(i){return(i*100)+" %"}},createPlayer:function(k){this._options=h.extend(h.clone(this.defaultOptions),k);this._playerModel=h.clone(c[this._options.style.name]);if(this._options.excludedElements.length>0){var j=this._options.excludedElements.slice(0,this._options.excludedElements.length);var o=this._playerModel.elements;var m=0;while(m<o.length){var l=o[m];if(j.indexOf(l.group)>=0){o.splice(m,1)}else{m++}}}this._playerModel.useTotal=this._options.useTotal;this._playerModel.editableLabel=this._options.editableLabel;this._playerModel.language=this._options.language;this._playerModel.callbacks=h.clone(this._options.callbacks);this._playerModel.formatterLabel=this._options.formatterLabel;var n=this;this._playerModel.callbacks.exit=function(i){n.hidePlayer();if(n._options.callbacks&&n._options.callbacks.exit){n._options.callbacks.exit(i)}};this._state=h.clone(this.state)},showPlayer:function(){if(!this._playerModel){return}if(!this._playerView){this._playerView=new f(this._playerModel)}if(this._playerContainer&&this._playerContainer.insertPlayer!==undefined){this._playerContainer.insertPlayer(this._playerView)}},hidePlayer:function(){if(!this._playerView){return}if(this._playerContainer&&this._playerContainer.removePlayer!==undefined){this._playerContainer.removePlayer(this._playerView)}this._playerView=null},getState:function(){return this._state},setState:function(i){this._state=h.extend(h.clone(this.state),i);for(var j in this.state){if(this._state.hasOwnProperty(j)){this._playerModel[j]=this._state[j]}}if(this._playerView){this._playerView.updateState()}},registerPlayerContainer:function(i){if(this._playerContainer&&i&&!h.debug){return}this._playerContainer=i}});return b});define("DS/ApplicationFrame/ActionBar",["UWA/Core","UWA/Controls/Abstract","DS/Core/Core","DS/RuntimeView/NLSManager","DS/ApplicationFrame/Json2Html","DS/Core/ModelEvents","DS/UIBehaviors/Kinetic","DS/Core/PointerEvents","DS/UIBehaviors/ContextualMenuManager","DS/Utilities/Dom","DS/Controls/TabBar","DS/WebRecordEnabler/Adapter","DS/Utilities/TouchUtils","UWA/Utils/Client"],function(k,t,g,p,A,s,h,m,c,w,n,z,d,r){var v=r.getScrollbarWidth();var u="EVT_SECTION_CHANGE";var b="EVT_ACTIONBAR_READY";var o=900;var e=32;var C=70;var q=54;function j(E,D){if(window.DEBUG_ActionBar_Init){E._perfId=window.top.performance.now();E._perfStr=D}}function l(){if(window.DEBUG_ActionBar_Init){window.top.performance.mark("b_ABInit")}}function y(D){if(window.DEBUG_ActionBar_Init){window.top.performance.mark("e_ABInit");window.top.performance.measure(D._perfId+"_"+D._perfStr+"_ABReady","b_ABInit","e_ABInit")}}function f(E,D){if(D!==undefined&&D.index!==undefined&&D.index>=0&&D.index<E._afr.getNumberOfSections()){E._afr.goToNthSection(D.index);E._checkWidth();E._modelEvents.publish({event:u,data:E._afr.getNthSection(D.index)})}}function x(G){if(!G){throw new Error("Action Bar not defined")}if(G._afr){var E=G._afr.getWorkbench()["@view"];if(E){var F=E.getParent();if(F){var D=G._afr.getWorkbench()["@view"].getParent().getDimensions();G._modelEvents.publish({event:"ACTIONBAR_WIDTH_CHANGE",data:D.width})}}}}function i(E,D){if(E&&E.options&&E.options.uiOptions&&E.options.uiOptions.displayWatermark===true){D-=q}return D}function B(E){var D=d.getTouchMode();if(D){E.elements.container.addClassName("wux-afr-actionbar-touch")}else{E.elements.container.removeClassName("wux-afr-actionbar-touch")}if(E.elements.chevron){if(D){E.elements.chevron.addClassName("wux-ui-chevron-touch")}else{E.elements.chevron.removeClassName("wux-ui-chevron-touch")}}}var a=t.extend({defaultOptions:{context:null,file:null,module:null,enableShowHide:true,dev:{sectionsBarPosition:"top"},language:"",uiOptions:{displayWatermark:false}},init:function(D){j(this,D.module);l();this._parent(D);this._tabBar=new n();this._tabBar.editableFlag=false;this._tabBar.pinFlag=false;var E=this;this._tabBar.onSelectTab(function(G){f(E,G)});document.addEventListener("touchChange",function(){B(E);E._checkWidth()});this._isShownWhenLarge=true;this._modelEvents=new s();this._buildLayout();var F={hideLabels:"Hide Labels",showLabels:"Show Labels",bulletMode:"Section with bullet",labelMode:"Section with label"};p.loadResource({resourceFile:"ApplicationFrame/ActionBar"});p.onResourceLoaded({resourceFile:"ApplicationFrame/ActionBar",language:this.options.language},function(){F.hideLabels=this.getTitle({key:"hideLabels"});F.showLabels=this.getTitle({key:"showLabels"});F.bulletMode=this.getTitle({key:"bulletMode"});F.labelMode=this.getTitle({key:"labelMode"})});c.onReady({target:E.elements.container,nodes:function(){if(this.elements.container.getAttribute("data-open")==="false"){return null}var G;if(E._afr.getLabelsVisibility()){G={label:F.hideLabels,callback:function(){E.hideLabels()}}}else{G={label:F.showLabels,callback:function(){E.showLabels()}}}return[G]}.bind(this)});E.elements.container.addEventListener(m.LONGHOLD,function(G){c.show(G.currentTarget,[G.pageX,G.pageY])});this._afr=new A({actionBar:true,context:this.options.context,module:this.options.module,directory:"assets/afr/",xml:this.options.file,language:this.options.language,onComplete:function(){E._postProcess();y(E);E._modelEvents.publish({context:E,event:b});E._checkWidth()},perfId:this._perfId,perfStr:this._perfStr})},loadModel:function(D){var E=this;l();D=k.extend({context:this.options.context,merge:false},D);this._tabBar.remove();this._tabBar=new n();this._tabBar.editableFlag=false;this._tabBar.pinFlag=false;this._tabBar.onSelectTab(function(F){f(E,F)});this._afr.elements.borderContainer.empty();if(this.elements.container.getAttribute("data-open")==="false"){this._tabBar.hide()}this._tabBar.getContent().inject(this.elements.tabBarParent);if(D.merge){new A({actionBar:true,context:D.context,module:D.module,merge:false,directory:"assets/afr/",language:D.language,xml:D.file,_createView:false,onComplete:function(){E._afr.merge(this)},perfId:E._perfId,perfStr:E._perfStr})}else{if(D.showLabels===undefined){D.showLabels=this._afr.getLabelsVisibility()}this.options=k.extend(this.defaultOptions,D);this._afr._initialize({context:this.options.context,module:D.module,directory:"assets/afr/",xml:D.file,_createView:true,showLabels:D.showLabels,onComplete:function(){E._postProcess();E._checkWidth();y(E);E._modelEvents.publish({context:E,event:b})}})}},_buildLayout:function(){this.elements.container=new k.Element("div",{"class":"AfrActionBar wux-afr wux-afr-actionbar"});if(window.DSWebRecord){this.elements.container.setAttribute("data-rec-id","actionBar");this.markForRecord(this.elements.container)}this.elements.container.oncontextmenu=function(){return false};this.elements.sections=new k.Element("ul",{"class":"Sections",html:this.elements.toolbars,events:null});this.elements.sectionsTop=new k.Element("div").inject(this.elements.sections);this.elements.sectionsTop.addClassName("wux-afr-sectionchooser-container");this.elements.sectionsBottom=new k.Element("div").inject(this.elements.sections);if(this.options.dev.sectionsBarPosition==="top"){this.elements.container.addClassName("wux-afr-actionbar-top-section");this.elements.tabBarParent=new k.Element("div");this.elements.tabBarParent.addClassName("wux-afr-view-tabbar-parent");this._tabBar.getContent().inject(this.elements.tabBarParent);this.elements.sectionsTop.appendChild(this.elements.tabBarParent)}this.elements.container.appendChild(this.elements.sections);if(this.options.dev.sectionsBarPosition==="bottom"){this.elements.container.appendChild(this.elements.sectionsNav)}this.elements.itemContainer=this.elements.container},onActionBarReady:function(D){return this._modelEvents.subscribe({event:b},D)},_postProcess:function(){var F=this;this._afr.inject(this.elements.sections);var G=this._afr.getSections().length;var E=0;this._afr.getSections().forEach(function(K,I){var H=false;if(I===0){H=true}var L=F._tabBar.addTab(K.options.Name,I,H);var J=F.options.module+"/"+F.options.file.replace(".xml","");p.onResourceLoaded({resourceFile:J},function(){if(L===undefined||L===null){return}var M=this.getTitle({key:K.options.Name});if(M){L.label=M}++E;if(E>=G){F._checkWidth()}});p.loadResource({resourceFile:J})});if(this.elements.chevron){this.elements.chevron.destroy()}this.elements.chevronIcon=k.Element("span",{"class":"wux-ui-icon-chevron",});this.elements.chevron=k.Element("div",{"class":"wux-ui-chevron"});this.elements.chevronIcon.inject(this.elements.chevron);this.elements.chevron.inject(F.elements.tabBarParent,"after");if(this.options.enableShowHide){this.elements.chevron.show()}else{this.elements.chevron.hide()}this.elements.chevron.addEvent(m.POINTERUP,this.toggle.bind(this));B(this);F._modelEvents.publish({event:u,data:F._afr.getNthSection(0)});if(this._privateBoundCheckWidth){window.removeEventListener("resize",this._privateBoundCheckWidth)}this._privateBoundCheckWidth=this._checkWidth.bind(F);window.addEventListener("resize",this._privateBoundCheckWidth);var D=false;w.onNodeRendered(this.elements.container,function(){if(!D){F._checkWidth();D=true}})},showLabels:function(){this._afr.showLabels();var D=this;D._checkWidth()},hideLabels:function(){this._afr.hideLabels();var D=this;D._checkWidth()},onShowLabels:function(D){return this._afr._modelEvents.subscribe({event:"SHOW_LABELS"},D)},onHideLabels:function(D){return this._afr._modelEvents.subscribe({event:"HIDE_LABELS"},D)},getLabelsVisibility:function(){return this._afr.getLabelsVisibility()},_checkWidth:function(){var F=this.elements.container.getDimensions();if(F.width<=o){if(this._isShownWhenSmall===undefined||this._isShownWhenSmall===false){this.close()}else{this.open()}}else{if(F.width>o){if(this._isShownWhenLarge!==undefined&&this._isShownWhenLarge===true){this.open()}else{this.close()}}}var E=this._afr.getCurrentSection();if(E!==undefined&&E._minimumWidthValue===undefined){E._minimumWidthValue=E.getContent().getDimensions().width}var G=(this.elements.chevron===undefined)?0:this.elements.chevron.getDimensions().width;var H=this.elements.container.getDimensions().width-G;var L=0;if(this._tabBar.visibleFlag){L=Math.min(this._tabBar.getWidthWithoutScroll(),H)}this._tabBar.minWidth=L;if(this.elements.container.getParent()&&E){var I=this;var D;D=E.getContent();var J=this.elements.container.getParent().getDimensions();this._afr.elements.borderContainer.setStyles({minWidth:this._tabBar.minWidth+G});var K=i(this,J.width);if(K<D.getDimensions().width){I._afr.elements.container.addClassName("wux-ui-scrollbuttons-h");I._afr.elements.container.setStyles({display:"block",minWidth:""});I._afr.getWorkbench()["@view"].style.marginBottom=-v-3+"px"}else{I._afr.elements.container.removeClassName("wux-ui-scrollbuttons-h");I._afr.elements.container.setStyles({display:"inline-block",verticalAlign:"top"});I._afr.getWorkbench()["@view"].style.marginBottom=""}}if(this.getNumberOfSections()<=1){this._tabBar.hide()}else{if(this.elements.container.getAttribute("data-open")==="true"){this._tabBar.show()}}x(this)},toggle:function(){if(this.elements.container.getAttribute("data-open")===null){this.elements.container.setAttribute("data-open","true")}if(this.elements.container.getAttribute("data-open")==="true"){this.close()}else{this.open();this._checkWidth()}},open:function(){if(this.elements.container.getAttribute("data-open")==="true"){return}var D=this.elements.container.getDimensions();if(D.width<=o){this._isShownWhenSmall=true;this._isShownWhenLarge=true}else{if(D.width>o){this._isShownWhenLarge=true}}this.elements.container.setAttribute("data-open","true");if(this.getNumberOfSections()>1){this._tabBar.show()}this._modelEvents.publish({context:this,event:"ACTIONBAR_OPEN"})},close:function(){if(this.elements.container.getAttribute("data-open")==="false"){return}var D=this.elements.container.getDimensions();if(D.width<=o){this._isShownWhenSmall=false}else{if(D.width>o){this._isShownWhenLarge=false;this._isShownWhenSmall=false}}this.elements.container.setAttribute("data-open","false");this._tabBar.hide();this._modelEvents.publish({context:this,event:"ACTIONBAR_CLOSE"})},onActionBarOpen:function(D){return this._modelEvents.subscribe({event:"ACTIONBAR_OPEN"},D)},onActionBarClose:function(D){return this._modelEvents.subscribe({event:"ACTIONBAR_CLOSE"},D)},removeCallback:function(D){if(D===undefined||typeof D!=="string"){throw new Error("Wrong parameter: removeCallback has to be called passing one string parameter")}this._modelEvents.unsubscribe(D)},getSectionID:function(D){return this._afr.getSectionIDByName(D)},getNumberOfSections:function(){return this._afr.getNumberOfSections()},goToNthSection:function(D){this._tabBar.value=[this._tabBar.getValueByIndex(D)]},onSectionChange:function(D){return this._modelEvents.subscribe({event:u},D)},onWidthChange:function(D){return this._modelEvents.subscribe({event:"ACTIONBAR_WIDTH_CHANGE"},D)},_setWatermarkLimitationState:function(E,G,D){if(typeof E!=="boolean"){throw new Error("bState has to be a boolean")}if(!E&&!this._watermarkLimitationState){return}this._watermarkLimitationState=E;if(E){var F=D-q-G;this.elements.sectionsTop.style.marginLeft="-"+F+"px"}else{this.elements.sectionsTop.style.marginLeft="0px"}}});if(window.DSWebRecord){z.register(a,"DS/CommandRecord/ActionBarRecord")}return a});define("DS/ApplicationFrame/ContextualBar",["UWA/Core","UWA/Controls/Abstract","DS/ApplicationFrame/XMLUtilities","DS/ApplicationFrame/Json2Html","DS/Selection/CSOManager","DS/ApplicationFrame/FrameWindowsManager","DS/Core/Events","DS/WebRecordEnabler/Adapter","DS/CoreEvents/Events"],function(e,g,d,j,b,f,c,a,i){var h=g.singleton({defaultOptions:{cmdList:null,workbenchName:null,module:null,cmdPrefix:null,fileName:null,subscribersOptions:[],viewerFrame:null,uiFrame:null,Xposition:null,Yposition:null,hideWithDistance:true,Xoffset:45,Yoffset:-45,samePosition:false,withContextMenu:false},init:function(k){this._parent(k);this.elements.container=new e.Element("div",{"class":"wux-afr-contextual-bar"});if(window.DSWebRecord){this.elements.container.setAttribute("data-rec-id","ContextualBar");this.markForRecord(this.elements.container)}this._isShown=false;this._opacityLocalListener=null;this._opacityListener=null;this._fadeEffect=true},_adjustPosition:function(p){if(p.frameWindow===null&&p.frameWindow===undefined){return}if(p.bar===null&&p.bar===undefined){return}var q=p.frameWindow.getContent().getDimensions();var n=q.width;var l=q.height;var r=p.bar.getDimensions();var m=r.width;var k=r.height;var o=p.bar.getPosition();if(n<=m+o.x){p.bar.setStyles({left:n-m})}if(o.x<=0){p.bar.setStyles({left:0})}if(o.y<=0){p.bar.setStyles({top:0})}if(l<=k+o.y){p.bar.setStyles({top:l-k})}},_calculateDistanceFromMouse:function(n){var q=0;var o=n.posElement;var m=n.posMouse;var p=n.dim;var l=0;var k=0;if(m.y>=o.y){k=m.y-o.y}else{if(m.y<=(o.y-p.height)){k=(o.y-p.height)-m.y}}if(m.x<=o.x){l=o.x-m.x}else{if(m.x>=o.x+p.width){l=m.x-(o.x+p.width)}}q=Math.sqrt((l*l)+(k*k));return q},_selectedHdrInModel:function(k){if(k!==undefined&&k.elemList!==undefined&&k.selectedHdr!==undefined){k.elemList.forEach(function(l){if(l.selectedHdr!==undefined&&l.hdr_list.length!==1){k.selectedHdr.push([l.name,l.selectedHdr])}})}},_getSelectedHdr:function(l){var q;var n;if(l===undefined||l.selectedHdrTab===undefined||l.model===undefined){return n}var r=l.containerName;var m=0;for(m=0;m<l.selectedHdrTab.length;m++){var p=l.selectedHdrTab[m];if(p!==undefined&&p.length===2&&p[0]===r){q=p[1];break}}if(q===undefined){return n}var o=l.model;if(o["@children"]!==undefined){var k=0;for(k=0;k<o["@children"].length;k++){if(o["@children"][k]!==undefined&&o["@children"][k]["@tag"]==="CATCmdStarter"&&o["@children"][k]["@attributes"].Name===q){n=o["@children"][k];break}}}return n},_processSelectedHdr:function(k){var m=this;if(k===undefined||k.model===undefined||k.selectedHdr===undefined){return}var l=k.model["@children"][0]["@children"];l.forEach(function(o){if(o["@tag"]==="CATCmdContainer"){var p=m._getSelectedHdr({containerName:o["@attributes"].Name,selectedHdrTab:k.selectedHdr,model:o});if(p!==undefined){var q=p["@view"];var n=o["@view"];n.selectCommand(q)}}})},setPosition:function(k){this.elements.container.setStyles({top:k.y,left:k.x})},getPosition:function(){if(this._isShown&&this&&this.elements&&this.elements.container){var k={};k.x=parseFloat(this.elements.container.getStyle("left"));k.y=parseFloat(this.elements.container.getStyle("top"))+this.elements.container.getDimensions().outerHeight;return k}},show:function(v){var r=this;if(v){r.options=e.extend(e.clone(this.defaultOptions),v)}if(this._hideForMultiselection){r.hide();r._clicWhenHideForMultiselection=true;return}var u=1;r.elements.container.setStyles({opacity:u});var o=b.get()[0];r.elements.container.empty();var l;var k=this.options.subscribersOptions.length;var m=[];var q=0;var t=false;var n=false;var s={};s.XmousePosition=r.options.Xposition;s.YmousePosition=r.options.Yposition;s.XmousePositionWithDevPxRatio=r.options.Xposition*window.devicePixelRatio;s.YmousePositionWithDevPxRatio=r.options.Yposition*window.devicePixelRatio;s.withContextMenu=r.options.withContextMenu;var p=function(A){var x=r.options.subscribersOptions[q];if(q<r.options.subscribersOptions.length){var y=x.onContextualBarReady.call(r,o,s);var w=x.context;if(w===undefined){w=r.options.context}if(y&&y.cmdList&&y.cmdList.length!==0){y._selectedHdrs=[];n=true;r._selectedHdrInModel({elemList:y.cmdList,selectedHdr:y._selectedHdrs});var z=new d({cmdList:y.cmdList,workbenchName:x.workbenchName,module:x.module,cmdPrefix:x.cmdPrefix,cmdSuffix:"",onComplete:function(B){if(q===0||!t){l=new j({context:w,module:x.module,xml:B,backMAB:v.backMAB,onComplete:function(){k--;q++;if(!v.ignoreMAB){i.publish({event:"/"+r.options.context+"/WUX/ContextualBar/Show/",data:this.getWorkbench()})}if(y._selectedHdrs!==undefined&&y._selectedHdrs.length!==0){r._processSelectedHdr({model:this.getWorkbench(),selectedHdr:y._selectedHdrs})}p(A)},onFailure:function(C){console.log("[!]\tError loading Contextual Bar");q++;p(A)}});l.getContent().setStyles({display:"inline-block"});r.elements.container.empty();r.elements.container.addContent(l);t=true}else{new j({context:w,module:x.module,merge:false,xml:B,_createView:false,onComplete:function(){m.push(this);k--;q++;if(y._selectedHdrs!==undefined&&y._selectedHdrs.length!==0){r._processSelectedHdr({model:this.getWorkbench(),selectedHdr:y._selectedHdrs})}p(A)}})}}})}else{q++;p(A)}}else{if(q===r.options.subscribersOptions.length&&n){r.elements.container.inject(v.uiFrame);if(r.options.samePosition!==true){r.elements.container.setStyles({position:"absolute",top:r.options.Yposition-r.elements.container.getDimensions().outerHeight+r.options.Yoffset,left:r.options.Xposition+r.options.Xoffset})}r._isShown=true;if(m.length!==0){l.elements.container.empty();m.forEach(function(C,B){l.merge(C);if(B<m.length-1){l.elements.container.empty()}})}A()}}};p(function(){r._fadeEffect=r.options.hideWithDistance===false?false:true;var w=r.options.context;if(w===undefined&&r.options.subscribersOptions.length>=1){w=r.options.subscribersOptions[0].context}var x=f.getFrameWindow(w);var y={frameWindow:x,bar:r.elements.container,YmousePosition:r.options.Yposition,XmousePosition:r.options.Xposition};r._adjustPosition(y);r._isShown=true;r.setHideWithDistance(r._fadeEffect);if(r._multiselectionStart){document.removeEventListener("keydown",r._multiselectionStart)}r._multiselectionStart=function(z){if(z.keyCode===17&&r._isShown){z.preventDefault();document.removeEventListener("keydown",r._multiselectionStart);document.addEventListener("keyup",r._multiselectionStop);r.elements.container.setStyles({opacity:0});r._isShown=false;r._hideForMultiselection=true;r._clicWhenHideForMultiselection=false}};document.addEventListener("keydown",r._multiselectionStart);if(r._multiselectionStop){document.removeEventListener("keyup",r._multiselectionStop)}r._multiselectionStop=function(B){if(B.keyCode===17&&!r._isShown&&r._hideForMultiselection){B.preventDefault();document.addEventListener("keydown",r._multiselectionStart);document.removeEventListener("keyup",r._multiselectionStop);r._hideForMultiselection=false;if(r._clicWhenHideForMultiselection){r.show(r.options)}else{r.elements.container.setStyles({opacity:1});if(r.options.withContextMenu){r.elements.container.setStyles({top:r.options.Yposition-r.elements.container.getDimensions().outerHeight-45,left:r.options.Xposition+45});var C=r.options.context;if(C===undefined&&r.options.subscribersOptions.length>=1){C=r.options.subscribersOptions[0].context}var z=f.getFrameWindow(C);var A={frameWindow:z,bar:r.elements.container,YmousePosition:r.options.Yposition,XmousePosition:r.options.Xposition};r._adjustPosition(A);r._fadeEffect=true;r.options.hideWithDistance=true;r.setHideWithDistance(r._fadeEffect)}r._isShown=true}}};document.addEventListener("keyup",r._multiselectionStop);if(r.options.eventCallback!==null&&r.options.eventCallback!==undefined){r.options.eventCallback()}})},hide:function(){if(this.elements.container){this.elements.container.remove()}if(this._isShown){c.publish({event:"/WUX/AFR/ctxBarHidden"})}this._isShown=false},setHideWithDistance:function(n){var l=this;if((n===true||n===false)){l._fadeEffect=n;l._isOnBar=false;if(l._opacityLocalListenerEnter){l.elements.container.removeEventListener("mouseenter",l._opacityLocalListenerEnter)}l._opacityLocalListenerEnter=function(p){l._isOnBar=true};if(l._opacityLocalListenerLeave){l.elements.container.removeEventListener("mouseleave",l._opacityLocalListenerLeave)}l._opacityLocalListenerLeave=function(p){l._isOnBar=false;l.options.Xposition=p.clientX;l.options.Yposition=p.clientY};if(l._opacityListener){document.removeEventListener("mousemove",l._opacityListener)}var m;var o;var k;l._opacityListener=function(s){if(m===undefined){m=l.elements.container.getDimensions()}if(o===undefined){o=l.elements.container.getBoundingClientRect().left}if(k===undefined){k=l.elements.container.getBoundingClientRect().bottom}if(l._isShown&&l._fadeEffect){var q=0;var t=50;var r=200;var u=0;var p={posElement:{x:o,y:k},posMouse:{x:s.clientX,y:s.clientY},dim:{height:m.height,width:m.width}};u=l._calculateDistanceFromMouse(p);if((u>=0&&u<=t)||l._isOnBar){q=1}else{if(u>t&&u<r){q=1-u/r}else{q=0;if(!l.elements.container.hasClassName("wux-ui-state-active")){l.elements.container.remove()}l._isShown=false}}l.elements.container.setStyles({opacity:q})}};if(n===true){l.elements.container.addEventListener("mouseenter",l._opacityLocalListenerEnter);l.elements.container.addEventListener("mouseleave",l._opacityLocalListenerLeave);document.addEventListener("mousemove",l._opacityListener)}else{l.elements.container.setStyles({opacity:1})}}},hideMAB:function(){i.publish({event:"/"+this.options.context+"/WUX/ContextualBar/Hide/"})}});if(window.DSWebRecord){a.register(h,"DS/CommandRecord/ContextualBarRecord")}return h});define("DS/ApplicationFrame/ContextualMenu",["UWA/Core","UWA/Controls/Abstract","DS/ApplicationFrame/Json2Html","DS/ApplicationFrame/XMLUtilities","DS/Selection/CSOManager","DS/ApplicationFrame/FrameWindowsManager","DS/Menu/Menu","DS/Core/Events","DS/RuntimeView/RSCManager","DS/RuntimeView/NLSManager","DS/ApplicationFrame/CommandsManager"],function(e,h,k,d,b,f,i,c,j,l,a){var g=h.singleton({defaultOptions:{cmdList:null,workbenchName:null,module:null,cmdPrefix:null,fileName:null,subscribersOptions:[],viewerFrame:null,uiFrame:null,Xposition:null,Yposition:null,samePosition:false,underBar:false},init:function(m){var n=this;n._parent(m);m=n.options;n.elements.container=new e.Element("div",{"class":"wux-afr-contextual-menu"});n._isShown=false;n._precPosition=undefined},_adjustPosition:function(t){if(t.frameWindow===null&&t.frameWindow===undefined){return}if(t.menu===null&&t.menu===undefined){return}var q={x:0,y:0,XMax:0};if(t.viewerFrame!==null&&t.viewerFrame!==undefined){q.x=t.viewerFrame.getBoundingClientRect().left;q.y=t.viewerFrame.getBoundingClientRect().top;q.XMax=t.viewerFrame.getBoundingClientRect().right}var r,v;var w=t.menuPosAndSize.width;var u=t.menuPosAndSize.height;var y={y:t.menuPosAndSize.top,x:t.menuPosAndSize.left};var p={y:t.YExpectedPosition,x:t.XExpectedPosition};if(t.frameWindow.getContextualUIManager()&&t.frameWindow.getContextualUIManager().getContextualBar()&&t.frameWindow.getContextualUIManager().getContextualBar()._isShown&&t.frameWindow.getContextualUIManager().getContextualBar().elements){var m={x:t.menuPosAndSize.left,y:t.menuPosAndSize.top};var x=t.frameWindow.getContextualUIManager().getContextualBar().elements.container;var s=x.getDimensions();var n=x.getPosition();var o=false;r=(p.y>y.y);if(r&&x){x.setStyles({top:m.y-q.y-5-s.height})}v=(p.x>y.x);if(v&&x){x.setStyles({left:m.x-q.x+w-s.width});o=true}if(m.y-q.y-(s.height+5)<0&&x){x.setStyles({top:m.y-q.y+u+5})}if(n.x<(m.x-q.x)&&!o&&x){if(m.x+w>q.XMax&&t.menuContentConfig!==undefined&&t.menuContentConfig.config!==undefined){x.setStyles({left:m.x-q.x-s.width});if(r){t.menuContentConfig.config.layout="BottomRight"}else{t.menuContentConfig.config.layout="TopRight"}i.show(t.menuContentConfig.content,t.menuContentConfig.config)}else{x.setStyles({left:m.x-q.x+w-s.width})}}}},_positionnedRelatedToBar:function(x){var v=this;var r={x:0,y:0};if(x.frameWindow===null&&x.frameWindow===undefined){return}if(x.menu===null&&x.menu===undefined){return}if(x.frameWindow.getContextualUIManager()&&x.frameWindow.getContextualUIManager().getContextualBar()&&x.frameWindow.getContextualUIManager().getContextualBar()._isShown&&x.frameWindow.getContextualUIManager().getContextualBar().elements){var o=x.frameWindow.getContextualUIManager().getContextualBar();var z=o.elements.container;var w=z.getDimensions();var p=z.getPosition();if(z){o.setHideWithDistance(false);r={y:p.y+5+w.height,x:p.x}}var n={};n.position=r;n.input="touch";var m=i.show(x.menuContent,n);var u=false,y=false;var q=x.frameWindow.getContent().getDimensions();var t=q.width;var s=q.height;u=(r.y>m.top);y=(r.x>m.left);if(u&&z){r.y=p.y-5-m.height}if(y&&z){r.x=p.x-m.width+w.width}n.position=r;m=i.show(x.menuContent,n);v._precPosition={x:m.left,y:m.top}}},_manageEvent:function(){var m=this;if(m._keyDown){document.removeEventListener("keydown",m._keyDown)}m._keyDown=function(n){if(n.keyCode===17){n.preventDefault();m.hide();document.removeEventListener("keydown",m._keyDown);m._hideForMultiselection=true}};document.addEventListener("keydown",m._keyDown);if(m._keyup){document.removeEventListener("keyup",m._keyup)}m._keyup=function(n){if(n.keyCode===17&&!m._isShown&&m._hideForMultiselection){n.preventDefault();document.addEventListener("keydown",m._keydown);document.removeEventListener("keyup",m._keyup);m._hideForMultiselection=false}};document.addEventListener("keyup",m._keyup)},_buildMdlMenu:function(o){var r=o.that;var q=this;var n;for(n=0;n<o.cmdList.length;n++){if(o.cmdList[n].hdr_list&&o.cmdList[n].hdr_list.length<=1){var s=r.getCommandHeader(o.cmdList[n].hdr_list[0]);o.tab.push({param1:s,param2:o.parser,param3:o.context});o.tabFlat.push({parser:o.parser,context:o.context,name:o.cmdList[n].hdr_list[0],ResourceFile:s.ResourceFile})}else{if(o.cmdList[n].hdr_list){var p=o.cmdList[n].hdr_list.length;var m=[];o.tab.push({param2:o.parser,param3:o.context,param4:{name:o.cmdList[n].name,ResourceFile:o.cmdList[n].resourceFile},children:m});o.tabFlat.push({parser:o.parser,context:o.context,name:o.cmdList[n].name,ResourceFile:o.cmdList[n].resourceFile});q._buildMdlMenu({tab:m,context:o.context,parser:o.parser,cmdList:o.cmdList[n].hdr_list,that:o.that,tabFlat:o.tabFlat})}else{var s=r.getCommandHeader(o.cmdList[n]);o.tab.push({param1:s,param2:o.parser,param3:o.context});o.tabFlat.push({parser:o.parser,context:o.context,name:o.cmdList[n],ResourceFile:s.ResourceFile})}}}},_definePropMenuEntryView:function(m){var n={type:"",state:""};var q="",p="";var r=m.header;var o=m.cmdHeader;if(r.Behavior==="CATAfrHeaderCheck"){n.type="CheckItem";if(o.getState&&o.getState()===true){p="selected"}else{if(o.getState&&o.getState()===false){p="unselected"}}}else{n.type="PushItem"}if(o.isEnabled!==undefined&&!o.isEnabled()){q="disabled"}if(o.isRunning!==undefined&&o.isRunning()){p="selected"}else{if(o.isRunning!==undefined&&o.isRunning()){p="unselected"}}n.state=p+((p!==""&&q!=="")?"|":"")+q;return n},_buildMenuView:function(w){var t=this;var u=w.tabMdl;var r=w.tabFlat;var n=w.resourceTab;var q;var v;for(q=0;q<u.length;q++){var s=t.options.context;if(s===undefined&&t.options.subscribersOptions.length>=1){s=t.options.subscribersOptions[0].context}if(u[q].param1){var o=u[q].param1;v=o.ID;(function(A){var y=t._searchEntryInFlatTab({tabFlat:r,id:A});if(y===undefined){return}var x;x=a.getCommand(A,u[q].param3);if(!x){x=a.getCommandCheckHeader(A,u[q].param3)}if(o&&x){var z=t._definePropMenuEntryView({header:o,cmdHeader:x});n.push({type:z.type,state:z.state,icon:y.icon,title:y.title,action:{callback:function(C){var B="";if(s!==undefined&&s!==null){B=s+"/"}c.publish({event:"/WUX/AFR/CMD/"+B+A,data:t});f.getFrameWindow(s).getContextualUIManager().getContextualBar().hide()}}})}})(v)}else{if(u[q].param4){v=u[q].param4.name;var p=t._searchEntryInFlatTab({tabFlat:r,id:u[q].param4.name});if(p===undefined){return}var m=[];t._buildMenuView({tabMdl:u[q].children,tabFlat:r,resourceTab:m});n.push({type:"PushItem",submenu:m,title:p.title})}}}},_searchEntryInFlatTab:function(o){var n=o.tabFlat;var q=o.id;var m;var p;for(var m=0;m<n.length;m++){if(n[m].name===q){p=n[m];return p}}return p},show:function(w){var u=this;if(w){this.options=e.extend(e.clone(this.defaultOptions),w)}u.elements.container.empty();if(this._hideForMultiselection){return}var n;var m=this.options.subscribersOptions.length;var s=0;var p=b.get()[0];var o=false;var v={};v.XmousePosition=u.options.Xposition;v.YmousePosition=u.options.Yposition;v.XmousePositionWithDevPxRatio=u.options.Xposition*window.devicePixelRatio;v.YmousePositionWithDevPxRatio=u.options.Yposition*window.devicePixelRatio;var t=[];var r=[];var q=function(B){var y=u.options.subscribersOptions[s];if(s<u.options.subscribersOptions.length){var z=y.onContextualMenuReady.call(u,p,v);var x=y.context;if(x===undefined){x=u.options.context}if(z&&z.cmdList&&z.cmdList.length!==0){o=true;var A=new d({cmdList:z.cmdList,workbenchName:y.workbenchName,module:y.module,cmdPrefix:y.cmdPrefix,cmdSuffix:"",onComplete:function(C){var D=false;if(s===0){D=true}n=new k({showLabels:true,context:x,module:y.module,language:w.language,contextMenu:"true",xml:C,merge:D,_createView:false,onComplete:function(){u._buildMdlMenu({tab:r,tabFlat:t,cmdList:z.cmdList,context:x,parser:n,that:this});m--;s++;q(B)},onFailure:function(E){console.log("[!]\tError loading Contextual menu");s++;q(B)}})}})}else{s++;q(B)}}else{if(s===u.options.subscribersOptions.length&&o){B()}}};q(function(){var y=0;var x;var z=function(B){if(y<t.length){if(t[y]){x=t[y].parser;var A=false;j.onResourceLoaded({resourceFile:t[y].ResourceFile},function(){var C=t[y].name;t[y].icon=this.getIcon({key:C,size:"Normal"});l.onResourceLoaded({resourceFile:t[y].ResourceFile,language:t[y].parser.options.language},function(){if(t[y]){t[y].title=this.getTitle({key:C});var D=u.options.context;if(D===undefined&&u.options.subscribersOptions.length>=1){D=u.options.subscribersOptions[0].context}y++;z(B)}A=true});if(!A){l.loadResource({resourceFile:t[y].ResourceFile,language:"en"});l.onResourceLoaded({resourceFile:t[y].ResourceFile},function(){t[y].title=this.getTitle({key:C});y++;A=true;z(B)})}})}else{y++;z(B)}}else{if(y===t.length){B()}}};z(function(){var C=[];u._buildMenuView({tabMdl:r,tabFlat:t,resourceTab:C});var J=[];var B;for(B=0;B<C.length;B++){J.push(C[B])}var I={x:0,y:0};if(u.options.viewerFrame!==null&&u.options.viewerFrame!==undefined){I.x=u.options.viewerFrame.getBoundingClientRect().left;I.y=u.options.viewerFrame.getBoundingClientRect().top}u.options.Xposition+=I.x;u.options.Yposition+=I.y;var F={};if(u.options.underBar!==true){if(u.options.samePosition!==true){F.x=u.options.Xposition;F.y=u.options.Yposition}else{F.x=u._precPosition.x;F.y=u._precPosition.y}var D={};D.position=F;D.input="touch";if(w.eventCallback!==null&&w.eventCallback!==undefined&&w.eventCallback.preShowCallback!==null&&w.eventCallback.preShowCallback!==undefined){w.eventCallback.preShowCallback(J)}var A=i.show(J,D);var K=u.options.context;if(K===undefined&&u.options.subscribersOptions.length>=1){K=u.options.subscribersOptions[0].context}var H=f.getFrameWindow(K);var E=(u.options.samePosition===true||u.options.underBar===true)?false:true;var L={frameWindow:H,viewerFrame:u.options.viewerFrame,menuPosAndSize:A,YExpectedPosition:E===true?u.options.Yposition:u._precPosition.y,XExpectedPosition:E===true?u.options.Xposition:u._precPosition.x,menuContentConfig:{content:J,config:D},};u._adjustPosition(L);u._precPosition={x:A.left,y:A.top}}else{var G={frameWindow:w.frameWindow,menuContent:J};u._positionnedRelatedToBar(G)}u._isShown=true;if(w.eventCallback!==null&&w.eventCallback!==undefined&&w.eventCallback.displayedCallback!==null&&w.eventCallback.displayedCallback!==undefined){w.eventCallback.displayedCallback()}u._manageEvent()})})},hide:function(){var m=this;if(m.elements.container){m.elements.container.remove()}i.hide();m._isShown=false},});return g});define("DS/ApplicationFrame/FrameWindow",["UWA/Core","UWA/Element","DS/Core/Core","DS/Controls/LayerSet","DS/ApplicationFrame/ActionBar","DS/ApplicationFrame/AfrPlayerService","DS/Windows/ImmersiveFrame","DS/Windows/Panel","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/FrameWindowsManager","UWA/Controls/Abstract","DS/RuntimeView/NLSManager","DS/Utilities/Css","DS/Core/ModelEvents","DS/Core/PointerEvents","DS/Utilities/TouchUtils"],function(q,p,b,r,a,w,n,k,h,c,s,m,u,o,i,e){var l="EVT_VIEWER_MODEL_LOADED";var d="EVT_ACTIONBAR_LOADED";var j="EVT_VIEWER_LOADED";var f=false;function g(x){x.preventDefault();x.stopPropagation()}var t=navigator.language.substr(0,2)||navigator.systemLanguage.substr(0,2)||"en";var v=s.extend({defaultOptions:{context:null,workbench:null,workbenchModule:null,defaultCommand:null,viewer:"2d",height:"100%",minHeight:0,ignoreResetCommandManager:false,viewerOptions:{antiAliasing:"SMAA",useShadowMap:false,infinitePlane:true,displayGrid:true,useVignetting:false,ssao:false,dof:false,deferred:false,debugShadowLight:false,debugBSphere:false,debugBBox:false,onModelLoaded:null},uiOptions:{displayActionBar:true,displayTree:true,displayImmersiveFrame:true,preserveActionBarHeight:false,displayWatermark:false},language:null},init:function(x){var y=this;this._parent(x);this._abTokens=[];c._registerNewFrameWindow(this);this._modelEvents=new o();this._isReady=false;m.DEFAULT_LANGUAGE=this.options.language;this.onReady(function(){y._isReady=true});this._buildView();this.elements.actionBarAndWatermarkContainer=new UWA.Element("div");if(this.options.uiOptions.displayWatermark===true){this.elements.watermarkContainer=new UWA.Element("div");this.elements.watermarkContainer.addClassName("wux-afr-watermark");this.elements.watermarkIcon=new UWA.Element("span");this.elements.watermarkIcon.inject(this.elements.watermarkContainer);this.elements.watermarkContainer.addEvent(i.POINTERUP,function(){window.open("https://3ds.com")});this.elements.watermarkContainer.inject(this.elements.actionBarAndWatermarkContainer);this.elements.actionBarAndWatermarkContainer.addClassName("wux-afr-actionbar-watermark")}this.elements.layerSet.addLayer(this.elements.actionBarAndWatermarkContainer,{left:0,right:0,bottom:0,zIndex:30001}).setAttribute("data-type","action-bar");this.elements.contextualComponentContainer=new UWA.Element("div");this.elements.layerSet.addLayer(this.elements.contextualComponentContainer,{top:0,left:0,right:0,bottom:0,pointerEvents:"none"}).setAttribute("data-type","contextual-component");this.elements.modalDialogContainer=new UWA.Element("div");this.elements.layerSet.addLayer(this.elements.modalDialogContainer,{top:0,left:0,right:0,bottom:0,pointerEvents:"none"}).setAttribute("data-type","modal-dialog");if(this.options.workbench){this.loadActionBar({workbench:this.options.workbench,workbenchModule:this.options.workbenchModule})}u.disableSelection(this.elements.container);u.disableSelection(this.getUIFrame());if(this.options.defaultCommand){h.setDefaultCommand({context:this.options.context,ID:this.options.defaultCommand.ID||"myDefaultCmd",className:this.options.defaultCommand.className||"myDefaultCmd"})}if(f){this.onActionBarReady(function(){alert(2)})}this.insertPlayer=function(z){if(!y.elements.playerPanel){y.elements.playerPanel=new k({title:"Player",closeButtonFlag:false,collapsibleFlag:false,expandedFlag:false,content:z,position:{my:"bottom center",at:"bottom center",offsetY:-30},immersiveFrame:y.elements._immersiveFrame})}};this.removePlayer=function(z){if(!y.elements.playerPanel){return}y.elements.playerPanel.close();y.elements.playerPanel=null};w.registerPlayerContainer(this)},_buildView:function(){var z=this;this.elements={};this.elements.container=new UWA.Element("div",{"class":"wux-afr-framewindow wux-afr-framewindow-background wux-ui-ambiance-light",styles:{height:this.options.height,minHeight:this.options.minHeight,position:"relative"}});this._onTouchChange=function(){console.log("on touch change");if(e.getTouchMode()){this.elements.container.addClassName("wux-afr-framewindow-touch")}else{this.elements.container.removeClassName("wux-afr-framewindow-touch")}}.bind(this);document.addEventListener("touchChange",this._onTouchChange);this._onTouchChange();this.elements.viewerFrame=new UWA.Element("div",{styles:{width:"100%",height:"100%"}});this.elements.uiFrame=new UWA.Element("div",{"class":"wux-afr-framewindow-uiframe",dataType:"UI-Frame",styles:{}});this.elements.uiFrame3d=new UWA.Element("div",{"class":"wux-afr-framewindow-uiframe",dataType:"UI-Frame-3D",styles:{}});this.elements.layerSet=new r({styles:{position:"relative",height:"100%",minHeight:this.options.minHeight}});this.elements.layerSet.inject(this.elements.container);this.elements.layerSet.addLayer(this.elements.viewerFrame).setAttribute("data-type","viewer");var x=0;var A=0;if(this.options.uiOptions&&this.options.uiOptions.displayActionBar){x=81;A=x;if(!this.options.uiOptions.preserveActionBarHeight){A-=32}}this.elements.layerSet.addLayer(this.elements.uiFrame3d,{top:0,bottom:A,left:0,right:0,pointerEvents:"none"}).setAttribute("data-type","ui-frame-3d");this.elements.layerSet.addLayer(this.elements.uiFrame,{top:0,bottom:A,left:0,right:0,pointerEvents:"none"}).setAttribute("data-type","ui-frame-2d");setTimeout(function(){if(z.elements.container){z.elements.container.addClassName("wux-ui-at-screen")}},0);if(this.options.uiOptions.displayImmersiveFrame){var y=this.options.context?this.options.context:"";this.elements._immersiveFrame=new n({identifier:y,frameWindowInstantiationFlag:true});this.elements._immersiveFrame.rootContainer=this.elements.container;this.elements._immersiveFrame.inject(this.elements.uiFrame)}},loadActionBar:function(y){if(!this.options.ignoreResetCommandManager){h._reset()}y=UWA.extend({workbench:this.options.workbench,workbenchModule:this.options.workbenchModule,language:this.options.language},y);if(!this._actionBar){this._actionBar=new a({context:this.options.context,file:y.workbench,module:y.workbenchModule,language:y.language,uiOptions:{displayWatermark:this.options.uiOptions.displayWatermark}});if(this.options.uiOptions.displayActionBar){this._actionBar.inject(this.elements.actionBarAndWatermarkContainer);this.elements.actionBarContainer=this._actionBar.elements.container;var A=this;if(this.options.uiOptions.preserveActionBarHeight){var x=this._onActionBarChange.bind(this);this._abTokens.push(this.onActionBarReady(function(){A._abTokens.push(A._actionBar.onActionBarOpen(x));A._abTokens.push(A._actionBar.onActionBarClose(x));A._abTokens.push(A._actionBar.onShowLabels(x));A._abTokens.push(A._actionBar.onHideLabels(x))}))}if(this.options.uiOptions.displayWatermark===true){var z=this._actionBar.onActionBarReady(function(){A._actionBar.removeCallback(z);A._onWidthChangeToken=A._actionBar.onWidthChange(function(D){var C=D;var B=A.elements.container.getDimensions().width;if(C>=B-54-54){A._actionBar._setWatermarkLimitationState(true,C,B);A._actionBar.getContent().addClassName("wux-afr-actionbar-moved")}else{A._actionBar._setWatermarkLimitationState(false);A._actionBar.getContent().removeClassName("wux-afr-actionbar-moved")}})})}}}else{this._actionBar.loadModel({merge:y.merge,file:y.workbench,module:y.workbenchModule,language:y.language})}},onActionBarReady:function(x){return this._actionBar.onActionBarReady(x)},_load2dViewer:function(){},onReady:function(x){x.call(this)},_enableBusyMode:function(){this.elements.container.addClassName("wux-ui-state-busy")},_disableBusyMode:function(){this.elements.container.removeClassName("wux-ui-state-busy")},_onActionBarChange:function(z){var y=this._actionBar.elements.container.getSize();var x=0;var A=this._actionBar.elements.container.getAttribute("data-open")!=="false";if(this.options.uiOptions&&this.options.uiOptions.displayActionBar){x=y.height;if(!A){x=this._actionBar.elements.chevron.getSize().height}this.elements.uiFrame.getParent().setStyle("bottom",x)}},getViewerFrame:function(){return this.elements.viewerFrame},getContextualFrame:function(){return this.elements.contextualComponentContainer},getUIFrame:function(){return this.elements.uiFrame},getActionBar:function(){return this._actionBar},getImmersiveFrame:function(){return this.elements._immersiveFrame},_onDispose:function(){},dispose:function(){document.removeEventListener("touchChange",this._onTouchChange);h._dispose(this.options.context);c._unregisterFrameWindow(this.options.context);if(this.elements.playerPanel){w.registerPlayerContainer(undefined);this.elements.playerPanel.destroy()}var x=0;for(;x<this._abTokens.lengh;x++){this._actionBar.removeCallback(this._abTokens[x])}if(this.options.uiOptions.displayWatermark===true&&this._onWidthChangeToken){this._actionBar.removeCallback(this._onWidthChangeToken)}this._onDispose();if(this.elements._immersiveFrame){this.elements._immersiveFrame.destroy()}if(this.elements.container.parentNode){this.destroy()}}});return UWA.namespace("WUX/AFR/FrameWindow",v)});define("DS/ApplicationFrame/ContextualUIManager",["UWA/Core","UWA/Class","DS/ApplicationFrame/ContextualBar","DS/Selection/CSOManager","DS/ApplicationFrame/ContextualMenu","DS/Core/Events","DS/Core/PointerEvents","DS/WebRecordEnabler/Adapter"],function(f,a,i,d,h,e,g,c){var b=a.extend({init:function(){this._parent()}});var j=b.extend({defaultOptions:{onContextualBarReady:function(k){return null},onContextualMenuReady:function(k){return null},frameWindow:undefined,subscriberId:undefined},init:function(k){this.options=f.extend(f.clone(this.defaultOptions),k);this._parent();this._contextBar=null;this._viewerFrame=this.options.frameWindow.getViewerFrame();this._uiFrame=this.options.frameWindow.getUIFrame();this._ctxFrame=this.options.frameWindow.getContextualFrame();this._isInViewpointManipulation=false;this._listOfSubscribers=[];this._ContextualBarOnLeftClic=true;this._ContextualBarOnLeftClicAfterCSOChange=true;this._ContextualMenuOnRightClic=true;this._ContextualBarAvailable=true;var l=this;this._unbindBehaviors();this._bindBehaviors();d.onEmpty(function(){l.hideContextualMenus()})},register:function(k){k=f.extend(f.clone(this.defaultOptions),k);if(k.merge){this._listOfSubscribers.push(k)}else{this._listOfSubscribers=[];this._listOfSubscribers.push(k)}},unregister:function(k){if(k){var l;for(l=0;l<this._listOfSubscribers.length;l++){if(this._listOfSubscribers[l].subscriberId===k){this._listOfSubscribers.splice(l,1);break}}}},_bindBehaviors:function(){var m=this;m._mousePos={x:0,y:0};this._viewerFrame.addEvent("mousemove",function(o){m._mousePos={x:o.offsetX===undefined?o.layerX:o.offsetX,y:o.offsetY===undefined?o.layerY:o.offsetY}});this._hideListener=function(r){if(window.DSWebRecord&&c.isReplaying()&&r.reason==undefined){return}else{if(r.reason){var o=r.parentElement;var q=r.parentElement2}else{var o=f.Event.findElement(r,".wux-afr-contextual-bar");var q=f.Event.findElement(r,".wux-menu")}}if(!o&&!q){m.hideContextualMenus()}if(window.DSWebRecord&&c.isRecording()){var p=document.querySelector("[data-rec-id=WebGLV6ViewerEventsManager]");c.addCustomInteraction(p,{context:m.options.frameWindow.options.context,parentElement:o,parentElement2:q,reason:"hideListenerCalled"},"DS/CommandRecord/DelegateRec",false)}};m._viewerFrame.addEvent(g.POINTERDOWN,m._onPointerDown.bind(m));m._viewerFrame.addEvent("mousedown",m._onMouseDown.bind(m));m._viewerFrame.addEvent(g.POINTERUP,m._onMouseUp.bind(m));m._viewerFrame.addEvent("contextmenu",m._onRightClick.bind(m));m._viewerFrame.addEvent(g.LONGHOLD,m._onLongHold.bind(m));var k=0;var l=function(o){k=0};var n=false;m._visuEventToken=e.subscribe({event:"/VISU/"},function(p){if(p.eventType==="@onViewpointChange"){if(k===0){if(m.getContextualBar()._isShown===true){n=true}m.hideContextualMenus();m._viewerFrame.removeEvent("mouseup",l);m._viewerFrame.addEvent("mouseup",l)}k++}else{if(p.eventType==="@onViewpointBeginMove"&&m._ContextualBarOnLeftClicAfterCSOChange===true){m._isInViewpointManipulation=true;n=false}else{if(p.eventType==="@onViewpointEndMove"&&m._ContextualBarOnLeftClicAfterCSOChange===true){m._isInViewpointManipulation=false;if(n===true){m.hideContextualMenus();var o={};o.hideWithDistance=true;o.ignoreMAB=true;m._showContextualBar(o)}n=false}else{if(p.eventType==="@onClickEvent"&&m._ContextualBarOnLeftClic===true&&m._ContextualBarOnLeftClicAfterCSOChange===true){if(p.eventID==="@pickNothing"||p.eventID==="@pickPrimitive"||p.eventID==="@pickRep"||p.eventID==="@pickMesh"){m.hideContextualMenus();var o={};o.hideWithDistance=true;o.ignoreMAB=true;m._showContextualBar(o)}}}}}});this._ctxbarHiddenEventToken=e.subscribe({event:"WUX/AFR/ctxBarHidden"},function(o){m.hideContextualMenu()});window.removeEventListener("blur",m.hideContextualMenus);window.addEventListener("blur",m.hideContextualMenus)},dispose:function(){var k=this;e.unsubscribe(k._visuEventToken);e.unsubscribe(k._ctxbarHiddenEventToken);window.removeEventListener("blur",k.hideContextualMenus)},deactivateContextualBarOnLeftClic:function(){this._ContextualBarOnLeftClic=false},activateContextualBarOnLeftClic:function(){this._ContextualBarOnLeftClic=true},deactivateContextualBar:function(){this._ContextualBarAvailable=false},activateContextualBar:function(){this._ContextualBarAvailable=true},deactivateContextualMenuOnRightClic:function(){this._ContextualMenuOnRightClic=false},activateContextualMenuOnRightClic:function(){this._ContextualMenuOnRightClic=true},deactivateContextualBarOnLeftClicAfterCSOChange:function(){this._ContextualBarOnLeftClicAfterCSOChange=false},activateContextualBarOnLeftClicAfterCSOChange:function(){this._ContextualBarOnLeftClicAfterCSOChange=true},_unbindBehaviors:function(){var k=this;k._viewerFrame.removeEvent(g.POINTERDOWN,k._onPointerDown.bind(k));k._viewerFrame.removeEvent("mousedown",k._onMouseDown.bind(k));k._viewerFrame.removeEvent(g.POINTERUP,k._onMouseUp.bind(k));k._viewerFrame.removeEvent("contextmenu",k._onRightClick.bind(k));k._viewerFrame.removeEvent(g.LONGHOLD,k._onLongHold.bind(k));e.unsubscribe(this._ctxbarHiddenEventToken)},_onBarDisplayed:null,_showContextualBar:function(k){if(k===undefined){k={}}var l=this;document.body.removeEventListener("click",this._hideListener);document.body.addEventListener("click",this._hideListener);if(this._contextBar){this._contextBar.hide()}if(this._listOfSubscribers.length){if(this.options.frameWindow.options.context!==null&&this.options.frameWindow.options.context!==undefined){k.context=this.options.frameWindow.options.context}k.viewerFrame=this._viewerFrame;k.uiFrame=this._uiFrame;if(l._isTouch){k.Xposition=(k.x===undefined)?l._initMousePos.x:k.x;k.Yposition=(k.y===undefined)?l._initMousePos.y:k.y}else{k.Xposition=(k.x===undefined)?l._mousePos.x:k.x;k.Yposition=(k.y===undefined)?l._mousePos.y:k.y}k.subscribersOptions=(k.fillingList===undefined||k.fillingList.length===0)?this._listOfSubscribers:k.fillingList;k.hideWithDistance=(k.hideWithDistance===undefined)?true:k.hideWithDistance;if(l._onBarDisplayed!==null){k.eventCallback=l._onBarDisplayed.bind(l)}if(k.barDisplayedCB!==null&&k.barDisplayedCB!==undefined){k.eventCallback=k.barDisplayedCB}k.Xoffset=(k.Xoffset===undefined)?45:k.Xoffset;k.Yoffset=(k.Yoffset===undefined)?-45:k.Yoffset;if(l._ContextualBarAvailable){i.show(k)}}},getContextualBar:function(){return i},hideContextualMenus:function(){document.body.removeEventListener("click",this._hideListener);i.hide();h.hide()},hideContextualMenu:function(){h.hide()},showContextualBar:function(k){var l={};if(k!==undefined){l.x=k.x;l.y=k.y;if(k.x!==undefined&&k.y!==undefined){l.Xoffset=0;l.Yoffset=0;l.hideWithDistance=false}l.fillingList=k.fillingList;l.barDisplayedCB=k.barDisplayedCB;if(k.hideWithDistance!==undefined){l.hideWithDistance=k.hideWithDistance}if(k.backMAB!==undefined){l.backMAB=k.backMAB}}if(this.getContextualBar()&&this.getContextualBar()!==undefined){this.getContextualBar().hide()}this.hideContextualMenu();this._showContextualBar(l)},updateContextualBar:function(){if(this.getContextualBar()&&this.getContextualBar()!==undefined&&this.getContextualBar()._isShown){var k={};k.samePosition=true;if(this.getContextualBar()&&this.getContextualBar()!==undefined){this.getContextualBar().hide()}this.hideContextualMenu();this._showContextualBar(k)}},_onMouseDown:function(m){var l=this;l._initMousePos={x:m.offsetX===undefined?m.layerX:m.offsetX,y:m.offsetY===undefined?m.layerY:m.offsetY};var k=m.button;if(k===1){l._isInViewpointManipulation=true}},_onPointerDown:function(n){var m=this;m._initMousePos={x:n.offsetX===undefined?n.layerX:n.offsetX,y:n.offsetY===undefined?n.layerY:n.offsetY};m._isTouch=g.isTouchEvent(n);var l=n.button;if(l===0&&m._ContextualBarOnLeftClic!==false&&m._ContextualBarOnLeftClicAfterCSOChange===false){m.hideContextualMenus();var k={};k.hideWithDistance=true;setTimeout(function(){m._showContextualBar(k)},200)}},_onMouseUp:function(m){var l=this;var k=m.button;if(k===0){}else{if(k===2){}else{if(k===1){l._isInViewpointManipulation=false}}}},_onMenuDisplayed:null,_onMenuReadyToShow:null,_showContextualMenu:function(l){var n=this;if(!l){l={}}var k=l.withUpdatedBar===undefined?false:l.withUpdatedBar;document.body.removeEventListener("click",this._hideListener);document.body.addEventListener("click",this._hideListener);if(!n._isInViewpointManipulation){if(k){var m={hideWithDistance:false,x:(l.x===undefined)?n._mousePos.x:l.x,y:(l.y===undefined)?n._mousePos.y:l.y,Xoffset:0,Yoffset:-5,withContextMenu:true,samePosition:(l.samePosition===true)?true:false};if(this._contextBar){this._contextBar.hide()}n._showContextualBar(m)}h.hide();if(n._listOfSubscribers.length){var o={};if(this.options.frameWindow.options.context!==null&&this.options.frameWindow.options.context!==undefined){o.context=this.options.frameWindow.options.context}o.frameWindow=n.options.frameWindow;o.viewerFrame=n._viewerFrame;o.uiFrame=n._uiFrame;o.Xposition=(l.x===undefined)?n._mousePos.x:l.x;o.Yposition=(l.y===undefined)?n._mousePos.y:l.y;o.samePosition=l.samePosition;o.underBar=l.underBar;o.subscribersOptions=(l.fillingList===undefined||l.fillingList.length===0)?this._listOfSubscribers:l.fillingList;o.language=n.options.frameWindow.options.language;if(n._onMenuDisplayed!==null){if(o.eventCallback===undefined){o.eventCallback={}}o.eventCallback.displayedCallback=n._onMenuDisplayed.bind(n)}if(n._onMenuReadyToShow!==null){if(o.eventCallback===undefined){o.eventCallback={}}o.eventCallback.preShowCallback=n._onMenuReadyToShow.bind(n)}if(l.menuDisplayedCB!==null&&l.menuDisplayedCB!==undefined){if(o.eventCallback===undefined){o.eventCallback={}}o.eventCallback.displayedCallback=l.menuDisplayedCB}h.show(o)}}},updateContextualMenu:function(k){if(h&&h!==undefined&&h._isShown){if(k===undefined||!k){k={}}k.samePosition=true;this.hideContextualMenu();this._showContextualMenu(k)}},showContextualMenuUnderBar:function(k){if(h&&h!==undefined&&this.getContextualBar()&&this.getContextualBar()!==undefined&&this.getContextualBar()._isShown){if(k===undefined||!k){k={}}k.underBar=true;this.hideContextualMenu();this._showContextualMenu(k)}},_onLongHold:function(k){if(g.isTouchEvent(k)){this._onRightClick(k)}},_onRightClick:function(o){var n=this;if(window.DSWebRecord&&c.isReplaying()){if(o.pos){n._finalMousePos=o.pos;n._initMousePos=o.posInit;n._mousePos=o.posFinal}else{return}}else{n._finalMousePos={x:o.offsetX===undefined?o.layerX:o.offsetX,y:o.offsetY===undefined?o.layerY:o.offsetY}}if(window.DSWebRecord&&c.isRecording()){var l=document.querySelector("[data-rec-id=WebGLV6ViewerEventsManager]");c.addCustomInteraction(l,{context:n.options.frameWindow.options.context,reason:"contextMenu",event:o,posInit:n._initMousePos,posFinal:n._finalMousePos,pos:n._mousePos,},"DS/CommandRecord/DelegateRec",false)}document.body.removeEventListener("click",this._hideListener);document.body.addEventListener("click",this._hideListener);if(!(window.DSWebRecord&&c.isReplaying())){o.preventDefault()}if((n._initMousePos.x===n._finalMousePos.x&&n._initMousePos.y===n._finalMousePos.y)&&n._ContextualMenuOnRightClic!==false){var m={hideWithDistance:false,x:n._mousePos.x,y:n._mousePos.y,Xoffset:0,Yoffset:-5,withContextMenu:true};if(this.getContextualBar()&&this.getContextualBar()!==undefined){this.getContextualBar().hide()}n._showContextualBar(m);h.hide();if(n._listOfSubscribers.length){var k={};if(this.options.frameWindow.options.context!==null&&this.options.frameWindow.options.context!==undefined){k.context=this.options.frameWindow.options.context}k.frameWindow=n.options.frameWindow;k.viewerFrame=n._viewerFrame;k.uiFrame=n._uiFrame;if(n._isTouch){k.Xposition=n._finalMousePos.x;k.Yposition=n._finalMousePos.y}else{k.Xposition=n._mousePos.x;k.Yposition=n._mousePos.y}k.language=n.options.frameWindow.options.language;k.subscribersOptions=n._listOfSubscribers;if(n._onMenuDisplayed!==null){if(k.eventCallback===undefined){k.eventCallback={}}k.eventCallback.displayedCallback=n._onMenuDisplayed.bind(n)}if(n._onMenuReadyToShow!==null){if(k.eventCallback===undefined){k.eventCallback={}}k.eventCallback.preShowCallback=n._onMenuReadyToShow.bind(n)}h.show(k)}}}});return j});define("DS/ApplicationFrame/Private_AfrCore",["DS/ApplicationFrame/Private_AfrCSInternalServices"],function(b){var a={sendStartCommand:function(c){return b.sendStartCommand(c)},sendStopCommand:function(c){return b.sendStopCommand(c)},cancelCommandService:function(c){return b.cancelCommandService(c)}};return a});define("DS/ApplicationFrame/Command",["UWA/Core","UWA/Class","DS/Core/Core","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/FrameWindowsManager","DS/AfrUndoRedoUI/Private_UndoRedoManager","DS/AfrUndoRedoUI/Private_UndoStep","DS/ApplicationFrame/Private_AfrCore","DS/CoreUtilities/ErrorManagement"],function(j,d,k,i,c,p,l,o,h,g){var n="/WUX/AFR/CMD/";var b;var m=function(){if(g.getDebugMode()){k.enableWUXConsole();b=k.getWUXConsole()?k.getWUXConsole():console}else{b=console}};var f=function(q){if(g.getDebugMode()){m();b.log(q)}};var e=1;var a=d.extend({defaultOptions:{context:null,ID:null,className:null,isAsynchronous:false,isEnabled:true,arguments:[],mode:"exclusive",repeatMode:false,withStartUndoStep:false,undoOnCancel:true},init:function(r,q){j.extend(r,q);this.options=j.extend(j.clone(this.defaultOptions),r);this._parent(this.options);this._isRunning=false;this._isEnding=false;this._isPaused=false;this._isCanceled=false;this._executeUndoAtEnd=false;var t=this;var s="";if(this.options.context){s=this.options.context+"/"}this._evtID=n+s+this.options.ID;this._globalEvtID=n+s;this._id=this.options.ID;this._ctx=this.options.context;this._mode=this.options.mode;this._isEnabled=this.options.isEnabled;this._repeatMode=this.options.repeatMode;this._withStartUndoStep=this.options.withStartUndoStep;this._previousUndoId=-1;this._isAsynchronous=this.options.isAsynchronous;this._arguments=this.options.arguments;this._undoOnCancel=this.options.undoOnCancel;this._dirtyUndoStack=false;this._endUndoGroupingRequested=false;this._undoGroupID="";if(this._isEnabled){this.enable()}else{this.disable()}if(!c.getCommand(this.getId(),this._ctx)){c._registerExistingCommand(this);t._startToken=i.subscribe({event:t._evtID},function(){t.begin()})}},done:function(){return false},isNewInfraActivated:function(){return false},_destroy:function(){if(this._isRunning){this.cancel();var r=this;var q=this.onEnd(function(){r.destroy()});i.unsubscribe(q)}else{this.destroy()}i.unsubscribe(this._startToken)},_updateOptions:function(q){this.options=j.extend(this.options,q)},beginExecute:function(){},resumeExecute:function(){},pauseExecute:function(){},execute:function(){},cancelExecute:function(q){},endExecute:function(){},destroy:function(){},getFrameWindow:function(){return p.getFrameWindow(this.options.context)},getArguments:function(){return this._arguments||[]},getId:function(){return this._id},getCSIdentifier:function(){return this._instanceId},hasDecalredCS:function(){return this.options.doServerCall},setRepeatMode:function(q){this._repeatMode=q},executeUndoAtEnd:function(q){if(q===undefined||typeof q!=="boolean"){return g.createReturnObject(g.getErrorManager().MISSING_PARAMETERS,{description:"command.executeUndoAtEnd expect a boolean input parameter"})}else{this._executeUndoAtEnd=q;this._undoOnCancel=q;return true}},enable:function(){var q=this;this._isEnabled=true;i.publish({event:q._evtID+"/ENABLE",data:q});i.publish({event:q._globalEvtID+"/ENABLE",data:q})},disable:function(q){var r=this;if(this.isRunning()){this.cancel()}this._isEnabled=false;i.publish({event:r._evtID+"/DISABLE",data:q});i.publish({event:r._globalEvtID+"/DISABLE",data:r})},isEnabled:function(){return this._isEnabled},isRunning:function(){return !this._isPaused&&this._isRunning},isPaused:function(){return this._isPaused},isEnding:function(){return this._isEnding},isCanceled:function(){return this._isCanceled},begin:function(s){if(c._isEndingCommand()){if(c._isIgnoredCommandBeginWhileEndingCommand()){return false}else{if(c._isNextCmdAllowed()&&c._isEndingCommand()){return c._setNextCmd(this)}}}if(s===undefined){s=true}if(this._repeatMode&&(c._getCurrent()===this.getId())){s=false}var u=this;if(!this._isRunning){this._instanceId=e;e++;f("begin command : "+this.getId());if(this._mode!=="undefined"){c._setCurrent(this,this.options.context)}if(s){if(this._mode==="exclusive"){c.endAll(this.options.context,false)}if(this._mode==="shared"){c.pauseAll(this.options.context)}}this._isRunning=true;this._isEnding=false;this._isPaused=false;this._isCanceled=false;this._executeUndoAtEnd=false;this._undoOnCancel=this.options.undoOnCancel;this._restoreLastCommand=undefined;this._dirtyUndoStack=false;this._previousUndoId=l.getLastCreatedUndoStepId();if(this.hasDecalredCS()){this._doNotSendCommandEnd=false;var v={from:this};var t=h.sendStartCommand(v);if(!g.hasSucceeded(t)){this._doNotSendCommandEnd=true;var r;if(this===c._getDefaultCommand()){r=false}this.end(r);return t}}if(this._withStartUndoStep){var q=new o({undoTitle:"Start command "+this.getId(),exclusivity:true,redoEnabled:false});l.registerAction(q)}i.publish({event:u._evtID+"/BEGIN",data:u});i.publish({event:u._globalEvtID+"/BEGIN",data:u});if(u.beginExecute){u.beginExecute()}i.publish({event:u._evtID+"/EXECUTE",data:u});i.publish({event:u._globalEvtID+"/EXECUTE",data:u});if(u.execute){if(this.isRunning()){u.execute()}}if(!this._isAsynchronous){this.end()}}else{if(this._mode!=="undefined"){this.cancel()}}},pause:function(){if(this.isRunning()&&!this.isEnding()){var q=this;this._isPaused=true;c._setLast(this.getId(),this._ctx);i.publish({event:q._evtID+"/PAUSE",data:q});i.publish({event:q._globalEvtID+"/PAUSE",data:q});this.pauseExecute()}},resume:function(){if(this.isPaused()){var q=this;c._popLastPausedCmd(this._ctx);c._setCurrent(this,this._ctx);this._isPaused=false;this.resumeExecute();i.publish({event:q._evtID+"/RESUME",data:q});i.publish({event:q._globalEvtID+"/RESUME",data:q})}},cancel:function(r){if(this._isCanceled){return}if(!this._isRunning){return}this._isCanceled=true;this.setRepeatMode(false);var s=r===false;this.cancelExecute(null,{canceledByAnotherCmd:s});if(this._undoOnCancel){this._executeUndoAtEnd=true;f("cancel command : "+this.getId());if(this.hasDecalredCS()){var q=h.cancelCommandService({from:this});if(q.getReturnValue().internalValue==="NO_CMD_TO_CANCEL"){this._doNotSendCommandEnd=true}else{this._isEnding=false;this._doNotSendCommandEnd=false}}}this.end(r)},end:function(r){if(this.isEnding()||!this._isRunning){return}if(this.isPaused()){c._removeFromLast(this.getId(),this._ctx)}this._isEnding=true;c._setEndingCommand();f("ending command : "+this.getId());if(r===undefined){this._restoreLastCommand=true}else{this._restoreLastCommand=r}var s=this;if(s.endExecute){s.endExecute()}if(this.hasDecalredCS()&&!this._doNotSendCommandEnd){var t={from:this};this._doNotSendCommandEnd=true;var q=h.sendStopCommand(t);if(g.hasSucceeded(q)){return}else{g.logResult(q)}}this.onCmdEnded()},onCmdEnded:function(){if(!this._isRunning){return}var q;if(this._mode!=="undefined"){q=this._createCmdGlobalUndo()}this._isRunning=false;this._isEnding=false;c._unsetEndingCommand();var r=this;i.publish({event:r._evtID+"/END",data:r});i.publish({event:r._globalEvtID+"/END",data:r});f("ended command : "+this.getId());if(this._executeUndoAtEnd&&q){this._cancelToken=l.onUndoExecuted(l._private._undoStack.getLastStepId(),function(){i.unsubscribe(r._cancelToken);r._cancelToken=undefined;if(r.isCanceled()){i.publish({event:r._evtID+"/CANCELED",data:r._id});i.publish({event:r._globalEvtID+"/CANCELED",data:r._id})}});l.undo()}else{if(this.isCanceled()){i.publish({event:r._evtID+"/CANCELED",data:r._id});i.publish({event:r._globalEvtID+"/CANCELED",data:r._id})}}this._executeUndoAtEnd=false;if(this._endUndoGroupingRequested){l._stopConcatenateUS(this._undoGroupID);this._endUndoGroupingRequested=false}this._relaunchCmd()},_createCmdGlobalUndo:function(){var q=false;if(!this._dirtyUndoStack){return q}var u=l._private._undoStack.getLastStepId();if(this._previousUndoId<u){var t=true;if(this._mode==="shared"&&c._getLast(this._ctx)||this._executeUndoAtEnd){t=false}var s=new o({undoTitle:this.getId(),exclusivity:t,redoEnabled:!this._executeUndoAtEnd});l.registerAction(s);var r=l._private._undoStack.groupSteps(s.getId(),this._previousUndoId+1);if(g.hasSucceeded(r)){q=true}else{var v=l._private._undoStack.removeStepWithId(l._private._undoStack.getLastStepId());if(!g.hasSucceeded(v)){g.logResult(v)}}}return q},_relaunchCmd:function(){if(c._getCurrent(this._ctx)===this.getId()){if(c._getCurrentInstanceId(this._ctx)===this.getCSIdentifier()){if(this._restoreLastCommand){if(c._isNextCmdAllowed()&&c._isNextCmdWaiting()){var q=c._getNextCmd();c._resetNextCmd();q.begin(false)}else{if(this._repeatMode){this.begin()}else{if(this._mode==="shared"&&c._getLast(this._ctx)){c._restoreLast(this._ctx)}else{if(c._getDefaultCommand(this._ctx)){c._getDefaultCommand(this._ctx).begin(false)}else{c._setCurrent(null,this._ctx)}}}}}c._resetNextCmd()}}},onBegin:function(r){var q=this;return i.subscribe({event:q._evtID+"/BEGIN"},r)},onExecute:function(r){var q=this;return i.subscribe({event:q._evtID+"/EXECUTE"},r)},onPause:function(r){var q=this;return i.subscribe({event:q._evtID+"/PAUSE"},r)},onResume:function(r){var q=this;return i.subscribe({event:q._evtID+"/RESUME"},r)},onEnd:function(r){var q=this;return i.subscribe({event:q._evtID+"/END"},r)},onCanceled:function(r){var q=this;return i.subscribe({event:q._evtID+"/CANCELED"},r)},askForUndoGroupingAtEnd:function(q){this._endUndoGroupingRequested=true;this._undoGroupID=q}});return j.namespace("WUX/AFR/Command",a)});define("DS/ApplicationFrame/FrameWindow3D",["UWA/Core","DS/ApplicationFrame/FrameWindow","DS/Visualization/WebGLV6Viewer","DS/Visualization/SceneGraph","DS/Visualization/Viewpoint","DS/Visualization/ModelLoader","DS/Visualization/SceneGraphTree","DS/Visualization/GeometryHelper","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/ContextualUIManager","DS/Visualization/Node3D"],function(m,g,q,a,j,b,k,n,o,p,h){var e="EVT_VIEWER_MODEL_LOADED";var f="EVT_ACTIONBAR_LOADED";var c="EVT_VIEWER_LOADED";var l=false;function d(r){r.preventDefault();r.stopPropagation()}var i=g.extend({defaultOptions:{context:null,workbench:null,workbenchModule:null,defaultCommand:null,viewer:"3D",height:"100%",minHeight:0,viewerOptions:{antiAliasing:"SMAA",useShadowMap:false,infinitePlane:true,displayGrid:true,useVignetting:false,ssao:false,dof:false,deferred:false,debugShadowLight:false,debugBSphere:false,debugBBox:false,onModelLoaded:null},uiOptions:{displayActionBar:true,displayTree:true}},init:function(r){var s=this;if(r.viewer==="3d"){console.warn("FrameWindow3d error: You don't have to specify viewer:3d in the options.")}this._is3DViewer=true;this._parent(r);s.load3dViewer(s.options.viewerOptions);this._contextualUIManager=new p({frameWindow:this})},load3dViewer:function(s){var r=this;r._3dViewer=new q(s);r.init3dViewer()},init3dViewer:function(){var u=this;u._3dViewer.setRenderMode("@Edge",true);u._3dViewer.setPicking({activated:true,displayHL:true,gpu:true,computeNormalDepth:true,primitive:false});u._3dViewer.setPrePicking({activated:false,displayHL:true,gpu:true,computeNormalDepth:false,primitive:false});if(!window.undoSceneGraphMigration){u._private_sceneGraph=u._3dViewer.getRootNode()}else{u._private_sceneGraph=new a("I solemnly swear that I am up to no good.");u._3dViewer.attachScene(u._private_sceneGraph)}u._viewpoint=new j({viewer:u._3dViewer});u._viewpoint.onMove(u._3dViewer.render);u._3dViewer.addViewpoint(u._viewpoint);u._3dViewer.setV6Ambience();u._modelLoader=new b();u._modelLoader.setSceneGraph(u._private_sceneGraph);u._modelLoader.setRenderCallback(u._3dViewer.render);u._modelLoader.setOnLoadedCallback(function(){if(!u.options.onModelLoaded){u._viewpoint.reframe()}else{u.options.onModelLoaded.call(u)}u._modelEvents.publish({event:e,data:u})});u._sceneGraphTree=new k(UWA.extendElement(u._3dViewer.div),u._3dViewer);u._sceneGraphTree.setSceneGraph(u._private_sceneGraph);if(u.options.uiOptions.displayTree){u._sceneGraphTree.tree.show()}else{u._sceneGraphTree.tree.hide()}var s=0;var v=0;if(u.options.uiOptions&&u.options.uiOptions.displayActionBar){s=81;v=s-32}u.elements.layerSet.addLayer(u._sceneGraphTree.tree.getContent(),{height:"auto",position:"absolute",left:0,top:0,bottom:v});u._sceneGraphTree.tree.getContent().setStyles({height:"auto",position:"absolute",left:0,top:0,bottom:81});u._3dViewer.inject(u.elements.viewerFrame);var t="Visu"+u._3dViewer.getVisuEnv()+"Env";var r={VisuNoEnv:"light",VisuNoneEnv:"light",VisuV6Env:"light",VisuCleanSpaceEnv:"light",VisuDarkBlueEnv:"dark",VisuDarkGreyEnv:"dark",VisuShinyEnv:"dark"};u.elements.container.addClassName("wux-ui-ambiance-"+r[t]);o.onCommandStart(function(w){if(r[w._id]){u.elements.container.removeClassName("wux-ui-ambiance-light");u.elements.container.removeClassName("wux-ui-ambiance-dark");u.elements.container.addClassName("wux-ui-ambiance-"+r[w._id])}});u._modelEvents.publish({event:c,context:u})},onViewerModelLoaded:function(r){return this._modelEvents.subscribe({event:e},r)},onViewerLoaded:function(r){return this._modelEvents.subscribe({event:c},r)},onReady:function(r){if(this.options.viewer==="3d"){this.onViewerLoaded(r)}else{r.call(this)}},getCurrentViewer:function(){console.warn("deprecated","WUX.AFR.FrameWindow.getCurrentViewer() is deprecated. Please use WUX.AFR.FrameWindow.getViewer");return this.getViewer()},getModelLoader:function(){return this._modelLoader},getViewer:function(){return this._3dViewer},registerAdditionnalViewer:function(r,s){if(!r){console.error("FrameWindow3D.js : registerAdditionnalViewer error iViewerID is undefined, can't regsiter a viewer without iViewerID specified");return}if(!this._additionnalViewers){this._additionnalViewers=[]}if(this._additionnalViewers[r]){console.warn("FrameWindow3D.js : Registering a new viewer under a viewerID already used. The viewer registered under the id : "+r+" is overwritten")}this._additionnalViewers[r]=s},unregisterAdditionnalViewer:function(s){if(!this._additionnalViewers){console.error("FrameWindow3D.js : unregisterAdditionnalViewer error, no additionnal viewer resgitered");return}var r;if(this._additionnalViewers[s]){r=this._additionnalViewers[s];this._additionnalViewers[s]=undefined}else{console.error("FrameWindow3D.js : unregisterAdditionnalViewer error, no additionnal viewer with Id "+s+" resgitered")}return r},getViewers:function(){var r=[];if(this.getViewer()){r.push(this.getViewer())}if(this._additionnalViewers){for(var s=0;s<this._additionnalViewers.length;s++){r.push(this._additionnalViewers[s])}}return r},getViewpoint:function(){return this._viewpoint},getGeometryHelper:function(){h.DEPRECATED_SceneGraph(new Error());if(!this._geometryHelper){this._geometryHelper=new n()}return this._geometryHelper},getSceneGraph:function(){h.DEPRECATED_SceneGraph(new Error());return this._private_sceneGraph},getRootNode:function(){return this._3dViewer.getRootNode()},getTree:function(){if(this._sceneGraphTree){return this._sceneGraphTree.tree}},getContextualUIManager:function(){return this._contextualUIManager},get3DUIFrame:function(){return this.elements.uiFrame3d},getRootDelta:function(){return 2},_onDispose:function(){this._contextualUIManager.dispose();this._modelLoader.abort();this._modelLoader=null;this.getViewer().dispose();this._3dViewer=null;this._sceneGraphTree&&this._sceneGraphTree.dispose()},dispose:function(){this._parent()}});Object.defineProperty(i.prototype,"_sceneGraph",{get:function(){h.DEPRECATED_SceneGraph(new Error());return this._private_sceneGraph}});return UWA.namespace("WUX/AFR/FrameWindow3D",i)});define("DS/ApplicationFrame/CSIFrameWindow3D",["DS/ApplicationFrame/FrameWindow3D","DS/Visualization/CSIViewer"],function(c,a){var b=c.extend({init:function(d){this._parent(d);return this},load3dViewer:function(e){var d=this;d._3dViewer=new a(e);d.init3dViewer()}});return UWA.namespace("WUX/AFR/CSIFrameWindow3D",b)});