define("DS/LifecycleDAGModel/DAGNodeModelBase",["UWA/Core","DS/Tree/TreeNodeModel",],function(c,b){var a=function(d){this.options=d||{isEmpty:true};b.call(this,this.options)};a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.prototype.isEmpty=function(){return this.options.isEmpty===true};a.prototype.clone=function(){throw Error("DAGNodeModelBase.clone: Function must be overriden in derived class")};a.prototype.sortFunction=function(e,d){throw Error("DAGNodeModelBase.sortFunction: Function must be overriden in derived class")};a.prototype.getLastLeaf=function(){for(var d=this;d.hasChildren();d=d.getLastChild()){}return d};a.prototype.remove=function(){this.options.isRemoved=true;b.prototype.remove.call(this)};a.prototype.hasBeenRemoved=function(){return this.options.isRemoved===true};a.prototype.getBreadth=function(){var e=this._localID,d=this._parentNode;while(d&&!d._isTrueRoot()){d=d._parentNode;e=e+d._localID}return e};return a});define("DS/LifecycleDAGModel/DAGBranch",[],function(){var a=function(b){this.data=b||{};this.nodeList=[]};a.prototype.addNode=function(c,b){if(b==true&&c.__BRANCH__){c.__BRANCH__.removeNode(c)}if(this.nodeList.indexOf(c)<0){this.nodeList.push(c)}c.__BRANCH__=this};a.prototype.removeNode=function(b){this.nodeList.splice(this.nodeList.indexOf(b),1);b.__BRANCH__=undefined};a.prototype.getNodes=function(){return this.nodeList};return a});define("DS/LifecycleDAGModel/DAGMergeHiddenNode",["DS/LifecycleDAGModel/DAGNodeModelBase","UWA/Core",],function(c,b){var a=function(e,d){this.options={parentBranch:e,mergeLeft:d};c.call(this,this.options)};a.prototype=Object.create(c.prototype);a.prototype.constructor=a;return a});define("DS/LifecycleDAGModel/DAGDocumentModel",["DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/LifecycleDAGModel/DAGBranch","DS/LifecycleDAGUtils/ArrayFunctions","DS/LifecycleDAGModel/DAGNodeModelBase","DS/LifecycleDAGModel/DAGMergeHiddenNode"],function(b,f,a,e,d,c){return b.extend({_ID_COUNTER:-1,init:function(g){g=g||{};this._mergeConnections=[];this._branchArray=[];this._nodeGroups=[];this._nodeList=[];this._isLoaded=false;this._parent(g);this.persistentColor=false;this._mapColorArray=new e.MapArray((Array.isArray(g.branchColors)&&g.branchColors.length?g.branchColors:["#FEE000","#009DDB","#FF8A2E","#9B2C98","#00AA86","#F564A3","#8DDEE4","#CC092F","#E2D5CC","#6FBC4B","#70036b","#002596","#C6C68B","#7F7F7F","#4EA8B7","#007A4C","#ADADAD","#127277","#6D2815","#000000","#4D62BA"]));this._circularColorArray=new e.CircularArray((Array.isArray(g.branchColors)&&g.branchColors.length?g.branchColors:["#FEE000","#009DDB","#FF8A2E","#9B2C98","#00AA86","#F564A3","#8DDEE4","#CC092F","#E2D5CC","#6FBC4B","#70036b","#002596","#C6C68B","#7F7F7F","#4EA8B7","#007A4C","#ADADAD","#127277","#6D2815","#000000","#4D62BA"]))},getNumberOfNodes:function(){return(this._nodeList.length?this._nodeList.length:this._numberOfNodesInDocument)},isLoaded:function(){return this._isLoaded},searchByID:function(g){return this._nodeList.length?this._nodeList.filter(function(h){return(h._getID()===g)}):[]},searchByAttribute:function(h,k,g){var j=[],i=(Array.isArray(g)&&g.length)?g:this._nodeList;if(i.length){j=i.filter(function(l){return l.options.grid[h]===k})}return j},isNodeInModel:function(){var g;if(arguments.length===1){g=this.searchByID(arguments[0])}else{if(arguments.length===2){g=this.searchByAttribute(arguments[0],arguments[1])}}return(g&&g.length>0)},setAttribute:function(k,h,n,m){if(k===undefined||k===null||!(typeof h==="string"&&h.length)||n===undefined||n===null){throw Error("DAGDocumentModel.setAttribute: attribute, value and nodes cannot be null")}if(typeof k==="string"&&k.length){var j=this.searchByID(k);(j.length===1)&&(j[0].options.grid[h]!==n||m===true)&&j[0].setAttribute(h,n)}else{if(k instanceof f){(k.options.grid[h]!==n||m===true)&&k.setAttribute(h,n)}else{if(Array.isArray(k)){var g=this._nodeList.length;for(var l=0;l<g;l++){var o=this._nodeList[l];(k.findIndex(function(p){var i;if(typeof p==="string"&&p.length){i=p}else{if(p instanceof f){i=p._getID()}}return i===o._getID()})>=0)&&(o.options.grid[h]!==n||m===true)&&o.setAttribute(h,n)}}}}},setAttributeAll:function(h,l,k){if(!(typeof h==="string"&&h.length)||l===undefined||l===null){throw Error("VersionTreeDocumentModel.setAttributeAll attribute and value")}var g=this._nodeList.length;for(var j=0;j<g;j++){(this._nodeList[j].options.grid[h]!==l||k===true)&&this._nodeList[j].setAttribute(h,l)}},empty:function(){this._parent();this._nodeList=[];this._mergeConnections=[];this._branchArray=[];this._nodeGroups=[];this._isLoaded=false;if(this.usePersistentColor()!==true){this._circularColorArray.resetCurrentIndex()}this.itemID=null},usePersistentColor:function(){return false},addBranch:function(j,g,h){if(typeof g==="number"){e.insert.call(this._branchArray,j,g)}else{this._branchArray.push(j)}if(!h){if(this.usePersistentColor()===true){h=this._mapColorArray.mapToValue(j.data.physicalid).value}else{h=this._circularColorArray.next().value}var i=this.getAllBranches().length>0?this.getBranch(this.getBranchID(j)-1):undefined;var l=this.getBranchID(j)<this.getAllBranches().length-1?this.getBranch(this.getBranchID(j)+1):undefined;var k=1;while((i&&h===i.data.color)||(l&&h===l.data.color)){if(this.usePersistentColor()===true){h=this._mapColorArray.mapToValue(j.data.physicalid+k++).value}else{h=this._circularColorArray.next().value}}}j.data.color=h},removeBranch:function(h){if(h instanceof a){var g=this._branchArray.indexOf(h);g>=0&&this._branchArray.splice(g,1);if(this.usePersistentColor()!==true){(g===0)&&this._circularColorArray.resetCurrentIndex()}}},getBranchID:function(g){return this._branchArray.indexOf(g)},getBranch:function(g){return this._branchArray[g]},getAllBranches:function(){return this._branchArray},addChildNode:function(h,l,q,g,u){if(!(h instanceof f)){throw Error("VersionTreeDocumentModel.addChild: Child cannot be null")}h._id=++this._ID_COUNTER;if(!g&&this._nodeList.indexOf(h)<0){e.orderedInsert.call(this._nodeList,h,this._nodeList.indexOf(q),this._nodeList.indexOf(h),h.sortFunction)}q=(q instanceof f)?q:this._getTrueRoot();var i=q.getChildren(),r,p=q.getNumberOfChildren();if(!p&&l>0){this.addChildNode(new d(),0,q,true);p=q.getNumberOfChildren()}l=(typeof l==="number"&&l>=0&&l<=p)?l:p;if(l===0){if(q._isTrueRoot()){r=u||new a({physicalid:h.options.id?h.options.id:q.options.id});(this.getBranchID(r)===-1)&&this.addBranch(r,0)}else{r=r||q.__BRANCH__}if(r.getNodes().length&&p){var t=i[0];if(r.nodeList.indexOf(t)>=0&&!t.isEmpty()){var m={physicalid:t.options.id?t.options.id:r.data.physicalid};var s=u||new a(m);(this.getBranchID(r)===-1)&&this.addBranch(s,1);t.__BRANCH__.removeNode(t);s.addNode(t);t.__BRANCH__=s;t.processDescendants({async:true,onlyVisibleNodes:true,processNode:function(w){var x=w.nodeModel;if(!x._isTrueRoot()){var v=x.__BRANCH__;if(v===r){x.__BRANCH__.removeNode(x);s.addNode(x);x.__BRANCH__=s}}}})}}}else{var n;r=u||new a({physicalid:h.options.id?h.options.id:q.options.id});if(q._isTrueRoot()){var k=h.getNextBrother();position=(k&&k.__BRANCH__)?this.getBranchID(k.__BRANCH__):undefined}else{if(h instanceof c===true){var j=this._getLastMergeBranchHiddenChildNode(q,h.mergeLeft);n=j?this.getBranchID(j.__BRANCH__):this.getBranchID(q.__BRANCH__);l=this._getNextIntermediateMergeNodePosition(q)}else{var j=this._getLastMergeBranchHiddenChildNode(q),o=j?this.getBranchID(j.__BRANCH__):this.getBranchID(q.__BRANCH__);n=this.getBranchID(q.getLastLeaf().__BRANCH__);(o>n)&&(n=o)}}(this.getBranchID(r)===-1)&&this.addBranch(r,(typeof n==="number"?n+1:undefined))}(p&&l===0&&i[0].isEmpty())&&this.removeChildNode(i[0]);r.addNode(h);q.addChild(h,l);(!q._isTrueRoot())&&q.expand();q.options.grid.__isLeaf__=(q.hasChildren()&&q.getNthChild(0).isEmpty())||!q.hasChildren()},removeChildNode:function(g){if(!(g instanceof f)){throw Error("VersionTreeDocumentModel.removeChildNode: Child cannot be null")}var o=g.getParent(),h=o.getChildren(),l=this,p;if(!g.isEmpty()){if(h.length>1&&h.indexOf(g)===0&&!o._isTrueRoot()){var m=h[1].__BRANCH__;for(var k=m.nodeList.length-1;k>=0;k--){var j=m.nodeList[k];j.__BRANCH__.removeNode(j);o.__BRANCH__.addNode(j)}this.removeBranch(m)}p=g.__BRANCH__;p.removeNode(g);(p.nodeList.length===0)&&l.removeBranch(p);g.processDescendants({async:true,onlyVisibleNodes:true,processNode:function(u){var v=u.nodeModel;if(!v._isTrueRoot()){p=v.__BRANCH__;if(p){p.removeNode(v);if(p.nodeList.length===0){l.removeBranch(p)}}var r=l._nodeList.indexOf(v);r>0&&l._nodeList.splice(l._nodeList.indexOf(v),1);var s=l._mergeConnections.filter(function(i){return i.parent===v||i.child===v});for(var t=0,q=s.length;t<q;t++){l.removeMerge(s[t].parent,s[t].child,true)}}}});var n=this._nodeList.indexOf(g);n>=0&&this._nodeList.splice(this._nodeList.indexOf(g),1)}else{g.__BRANCH__.removeNode(g)}g.remove();o.options.grid.__isLeaf__=(o.hasChildren()&&o.getNthChild(0).isEmpty())||!o.hasChildren()},getNodeDescendantBranches:function(h){var g=[];h.processDescendants({async:false,onlyVisibleNodes:true,processNode:function(j){var i=j.nodeModel;if(!i._isTrueRoot()){(g.indexOf(i.__BRANCH__)<0)&&g.push(i.__BRANCH__)}}});return g},applyFilter:function(l){var k=[];if(Array.isArray(l)&&l.length){k=this._nodeList;l.forEach(function(i){k=this.searchByAttribute(i.key,i.value,k)},this)}else{if(typeof l==="function"){var j=arguments[0];for(var h=0,g=this._nodeList.length;h<g;h++){var m=this._nodeList[h];j(m,h)&&k.push(m)}}else{throw Error("invalid arguments for filter")}}if(k.length){this.prepareUpdate();this.setAttributeAll("__filter__",false);this.setAttribute(k,"__filter__",true);this.pushUpdate()}return k},clearFilter:function(){this.prepareUpdate();this.setAttributeAll("__filter__",false);this.pushUpdate()},prepareAddDelete:function(){if(!this.prepareAddDeleteCount){this.prepareAddDeleteCount=0;this.prepareUpdate();this._trueRoot._modelEvents.publish({event:"prepareAddDelete",data:this._trueRoot._getNodeInfos(),context:this})}this.prepareAddDeleteCount+=1},pushAddDelete:function(){if(this.prepareAddDeleteCount==null){throw Error("VersionTreeDocumentModel:pushAddDelete called without prepareAddDelete")}this.prepareAddDeleteCount-=1;if(this.prepareAddDeleteCount<=0){this._updateMerges();this.pushUpdate();this._trueRoot._modelEvents.publish({event:"pushAddDelete",data:this._trueRoot._getNodeInfos(),context:this});prepareAddDeleteCount=0}},addMerge:function(g,j,h){if(!(j instanceof f)&&!(typeof g==="string")){throw Error("VersionTreeDocumentModel.addMergeConnection : either child or parent are not in the correct format")}if(!this._mergeConnections.length||(this._mergeConnections.length&&!this._mergeConnections.find(function(k){return(k.child===j&&k.parent===g)}))){var i=UWA.extend({parent:this._nodeList.find(function(k){return k._getID()===g})||g,child:j},h||{});this._mergeConnections.push(i);if((i.child instanceof f)&&(i.parent instanceof f)){if(typeof i.child.addMergeParent==="function"){i.child.addMergeParent(i.parent)}if(typeof i.parent.addMergeChild==="function"){i.parent.addMergeChild(i.child)}i.parent.setAttribute("__isLeaf__",false);this._trueRoot._modelEvents.publish({event:"addMerge",data:i,})}}},removeMerge:function(j,l,i){var h=this._mergeConnections.findIndex((function(q,n,p){var o=(j instanceof f)?j._getID():j,m=(q.parent instanceof f)?q.parent._getID():q.parent;return(o===m)&&q.child===l})),k;if(h>=0){k=this._mergeConnections.splice(h,1)[0];if(Array.isArray(l.options.ancestors)){var g=l.options.ancestors.findIndex(function(m){return m.semantic==="I"&&((typeof j==="string"&&m.id===j)||(j instanceof f&&m.id===j._getID()))});g>=0&&l.options.ancestors.splice(g,1)}k.mergeHiddenNode&&this.removeChildNode(k.mergeHiddenNode);this._trueRoot._modelEvents.publish({event:"removeMerge",data:k[0],})}},_updateMerges:function(){var r=[],m=this;for(var k=0,n=this._mergeConnections.length;k<n;k++){var o=this._mergeConnections[k],q=o.parent,g=o.child;if((typeof q==="string")&&((q=this.searchByID(q),Array.isArray(q))&&q.length===1)){o.parent=q[0];if((o.child instanceof f)&&(o.parent instanceof f)){if(typeof o.child.addMergeParent==="function"){o.child.addMergeParent(o.parent)}if(typeof o.parent.addMergeChild==="function"){o.parent.addMergeChild(o.child)}o.parent.setAttribute("__isLeaf__",false);this._trueRoot._modelEvents.publish({event:"addMerge",data:o,})}}else{if(!((q instanceof f)&&(g instanceof f))){throw Error("VersionTreeDocumentModel._updateAllMerges:merge parent or child not found.")}}if(o.parent.hasChildren()&&!o.parent.getChildren()[0].isEmpty()&&this._nodeList.indexOf(o.child)>this._nodeList.indexOf(o.parent.getChildren()[0])&&!o.mergeBetweenRoots&&!o.mergeHiddenNode){var j=new c(o.parent.__BRANCH__,o.mergeLeft),h=o.parent.getChildren().filter(function(i){return i instanceof c}),l,p;if(o.mergeLeft===true&&o.referenceBranch){var s=m.getBranchID(o.referenceBranch);p=h.length?h.find(function(i){return m.getBranchID(i.__BRANCH__)<s}):null;l=p?p.__BRANCH__:null;if(!l){l=new a()}this.addBranch(l,s)}else{p=h.length?h.find(function(i){return m.getBranchID(i.__BRANCH__)>m.getBranchID(o.parent.__BRANCH__)}):null;l=p?p.__BRANCH__:null}this.addChildNode(j,null,q,true,l);o.mergeHiddenNode=j;j.__BRANCH__.data.color=o.parent.__BRANCH__.data.color}else{if(o.mergeHiddenNode&&o.parent.getChildren()[0].isEmpty()){r.push(o)}}}r.forEach(function(i){this.removeMerge(i.parent,i.child);this.addMerge(i.parent,i.child)},this)},_getLastMergeBranchHiddenChildNode:function(i,h){var j=this,g=this._mergeConnections.filter(function(k){return k.mergeHiddenNode&&k.mergeHiddenNode.options.parentBranch===i.__BRANCH__&&k.mergeLeft===h});if(g.length){return g.length>1?g.sort(function(l,k){return j.getBranchID(k.mergeHiddenNode.__BRANCH__)-j.getBranchID(l.mergeHiddenNode.__BRANCH__)})[0].mergeHiddenNode:g[0].mergeHiddenNode}else{return undefined}},_getNextIntermediateMergeNodePosition:function(k){var j=0;if(k.hasChildren()){var h=k.getChildren(),g=h.length;for(j=0;j<g;j++){if(!(h[j] instanceof c)){break}}}return j+1}})});