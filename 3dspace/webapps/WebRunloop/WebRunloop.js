/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/WebRunloop/Runloop",["UWA/Class"],function(a){return a.extend({init:function(b){this.name=b.name||"Runloop";this.running=false;this.data=b.data;this.setRunloopCB(b.func);this.onStart=b.onStart;this.onStop=b.onStop;this.onError=b.onError;if(b.autoStart){this.start()}},setRunloopCB:function(b){if(b){this.func=b;var d=this;var c=new Date().getTime();if(this.data){this.runloop=function(){if(d.running){d.id=requestAnimationFrame(d.runloop)}var e=new Date().getTime();d.func.apply(d.data,[{time:e-d.starttime,deltaTime:e-c}]);c=e}}else{this.runloop=function(){if(d.running){d.id=requestAnimationFrame(d.runloop)}var e=new Date().getTime();d.func({time:e-d.starttime,deltaTime:e-c});c=e}}}},start:function(){if(this.runloop){this.running=true;this.id=requestAnimationFrame(this.runloop);this.starttime=new Date().getTime();if(this.onStart){this.onStart()}}else{console.error("runloop have not loop function");if(this.onError){this.onError()}}},stop:function(){this.running=false;cancelAnimationFrame(this.id);if(this.onStop){this.onStop()}},dispose:function(){if(this.running===true){this.stop()}this.func=null;this.data=null;this.runloop=null}})});