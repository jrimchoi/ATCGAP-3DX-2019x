define("DS/WebPolyMaths/WebToolsMaths",["DS/Visualization/ThreeJS_DS"],function(b){var a={isZero:function(d){var c=0.001;return(Math.abs(d)<c)},areEqual:function(f,e,c,k){var d=(k!==undefined)?k:0.001;var g=true;var j=(c!==undefined)?c:"float";switch(j){case"float":g=(Math.abs(f-e)<d);break;case"Vector3":g=(Math.abs(f.x-e.x)<d)&&(Math.abs(f.y-e.y)<d)&&(Math.abs(f.z-e.z)<d);break;case"Matrix4":for(var h=0;h<16&&g;h++){g=(Math.abs(f.elements[h]-e.elements[h])<d)}break;default:console.log("areEqual used with unknown type: "+j);break}return g},computeMatrixFromLines:function(c,d,e,f){var i=d.clone().normalize();var h;var g;if(e!==undefined){g=new b.Vector3().crossVectors(i,e);h=new b.Vector3().crossVectors(g,i)}else{if(f!==undefined){h=new b.Vector3().crossVectors(i,f);g=new b.Vector3().crossVectors(i,h)}else{h=new b.Vector3().crossVectors(i,new b.Vector3(0,0,1));if(a.isZero(h.length())){h=new b.Vector3().crossVectors(i,new b.Vector3(0,1,0))}g=new b.Vector3().crossVectors(i,h)}}return new b.Matrix4(i.x,h.x,g.x,c.x,i.y,h.y,g.y,c.y,i.z,h.z,g.z,c.z,0,0,0,1)},computeTransformationBetweenTwoLines:function(g,i,k,m){var o={};o.returnCode=1;if(g&&i&&k&&m){var l=i.clone().normalize();var n=m.clone().normalize();var e=new b.Matrix4().makeTranslation(-g.x,-g.y,-g.z);var f=new b.Vector3().crossVectors(l,n);if(a.isZero(f.length())){f=new b.Vector3().crossVectors(l,new b.Vector3(1,0,0));if(a.isZero(f.length())){f=new b.Vector3().crossVectors(l,new b.Vector3(0,1,0))}}var h=Math.acos(n.dot(l));var c=new b.Matrix4().makeRotationAxis(f.normalize(),h);var d=new b.Matrix4().makeTranslation(k.x,k.y,k.z);var j=d.clone().multiply(c).multiply(e);o.returnCode=0;o.transformation=j}return o},quaternionToAxisSystem:function(f){var c={};var d=new b.Matrix4().setRotationFromQuaternion(f.clone()).elements;c.X=new b.Vector3(d[0],d[1],d[2]);c.Y=new b.Vector3(d[4],d[5],d[6]);c.Z=new b.Vector3(d[8],d[9],d[10]);c.Origin=new b.Vector3(d[12],d[13],d[14]);return c}};return a});define("DS/WebPolyMaths/WebMathsVector3D",[],function(){var a=0.001;var c=0.000001;var b={modifyEpsilon:function(d){var e=a;if(d>0){a=d;c=d*d}return e},isNull:function(e){var d=(Math.abs(e[0])<a)&&(Math.abs(e[1])<a)&&(Math.abs(e[2])<a);return d},clone:function(e){var d=[];d[0]=e[0];d[1]=e[1];d[2]=e[2];return d},length:function(e){var d=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return d},squaredLength:function(e){var d=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return d},normalize:function(h,e){var f;var g=h[0]*h[0]+h[1]*h[1]+h[2]*h[2];if(Math.abs(g-1)<c){f=e||[0,0,0];f[0]=h[0];f[1]=h[1];f[2]=h[2]}else{if(g>c){var d=Math.sqrt(g);f=e||[0,0,0];f[0]=h[0]/d;f[1]=h[1]/d;f[2]=h[2]/d}}return f},multiply:function(g,d,e){var f=e||[0,0,0];f[0]=d*g[0];f[1]=d*g[1];f[2]=d*g[2];return f},areEqual:function(f,e){var d=(Math.abs(e[0]-f[0])<a)&&(Math.abs(e[1]-f[1])<a)&&(Math.abs(e[2]-f[2])<a);return d},add:function(g,f,d){var e=d||[0,0,0];e[0]=f[0]+g[0];e[1]=f[1]+g[1];e[2]=f[2]+g[2];return e},sub:function(g,f,d){var e=d||[0,0,0];e[0]=f[0]-g[0];e[1]=f[1]-g[1];e[2]=f[2]-g[2];return e},angle:function(i,h){var f;var e=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);var d=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]);if((e>a)&&(d>a)){var g=(i[0]*h[0]+i[1]*h[1]+i[2]*h[2])/(e*d);f=Math.acos(Math.min(Math.max(g,-1),1))}return f},dot:function(f,e){var d=f[0]*e[0]+f[1]*e[1]+f[2]*e[2];return d},cross:function(h,g,i){var j=i||[0,0,0];var f=h[0];var e=h[1];var d=h[2];var m=g[0];var l=g[1];var k=g[2];j[0]=e*k-d*l;j[1]=d*m-f*k;j[2]=f*l-e*m;return j},subAndLength:function(h,g,e){var f=e||[0,0,0];f[0]=g[0]-h[0];f[1]=g[1]-h[1];f[2]=g[2]-h[2];var d=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]);return d},subAndSquaredLength:function(h,f,d){var e=d||[0,0,0];e[0]=f[0]-h[0];e[1]=f[1]-h[1];e[2]=f[2]-h[2];var g=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return g},multiplyAndAdd:function(h,d,g,e){var f=e||[0,0,0];f[0]=h[0]*d+g[0];f[1]=h[1]*d+g[1];f[2]=h[2]*d+g[2];return f},isIdentity:function(d){var e=(Math.abs(d[0]-1)<a)&&(Math.abs(d[1])<a)&&(Math.abs(d[2])<a)&&(Math.abs(d[3])<a)&&(Math.abs(d[4])<a)&&(Math.abs(d[5]-1)<a)&&(Math.abs(d[6])<a)&&(Math.abs(d[7])<a)&&(Math.abs(d[8])<a)&&(Math.abs(d[9])<a)&&(Math.abs(d[10]-1)<a)&&(Math.abs(d[11])<a)&&(Math.abs(d[12])<a)&&(Math.abs(d[13])<a)&&(Math.abs(d[14])<a)&&(Math.abs(d[15]-1)<a);return e},areMatrixEqual:function(e,d){var f=(Math.abs(e[0]-d[0])<a)&&(Math.abs(e[1]-d[1])<a)&&(Math.abs(e[2]-d[2])<a)&&(Math.abs(e[3]-d[3])<a)&&(Math.abs(e[4]-d[4])<a)&&(Math.abs(e[5]-d[5])<a)&&(Math.abs(e[6]-d[6])<a)&&(Math.abs(e[7]-d[7])<a)&&(Math.abs(e[8]-d[8])<a)&&(Math.abs(e[9]-d[9])<a)&&(Math.abs(e[10]-d[10])<a)&&(Math.abs(e[11]-d[11])<a)&&(Math.abs(e[12]-d[12])<a)&&(Math.abs(e[13]-d[13])<a)&&(Math.abs(e[14]-d[14])<a)&&(Math.abs(e[15]-d[15])<a);return f},transformVector:function(j,e,h){var i=h||[0,0,0];var g=j[0];var f=j[1];var d=j[2];i[0]=e[0]*g+e[4]*f+e[8]*d;i[1]=e[1]*g+e[5]*f+e[9]*d;i[2]=e[2]*g+e[6]*f+e[10]*d;return i},transformPoint:function(j,e,h){var i=h||[0,0,0];var g=j[0];var f=j[1];var d=j[2];i[0]=e[0]*g+e[4]*f+e[8]*d+e[12];i[1]=e[1]*g+e[5]*f+e[9]*d+e[13];i[2]=e[2]*g+e[6]*f+e[10]*d+e[14];return i}};return b});define("DS/WebPolyMaths/WebGeometryEnums",[],function(){var a=a||{REVISION:"1"};a.GeometryType={POINT:0,PICKINGPT:1,CURVE:2,LINE:3,CIRCLE:4,SURFACE:5,PLANE:6,CYLINDER:7,CONE:8,SPHERE:9,PRODUCT:10};a.Relationship={NONE:0,COINCIDENT:1,PARRALLEL:2,INTERSECTING:3};a.Mode={EXACT:0,FACETTED:1};return a});define("DS/WebPolyMaths/WebToolsSceneGraph",["DS/Visualization/PathElement"],function(b){var a={isReference:function(d){var c=false;if(d){if(d.className==="PAD3DViewerNode"||d.isPLMReference){c=d.isPLMReference()}else{c=(d.productType==="Reference3D")}}return c},isInstance:function(d){var c=false;if(d){if(d.className==="PAD3DViewerNode"||d.isPLMInstance){c=(d.isPLMInstance())}else{c=(d.productType==="Instance3D")}}return c},isReferenceOrInstance:function(d){var c=false;if(d){if(d.className==="PAD3DViewerNode"){c=(d.isPLMReference())||(d.isPLMInstance())}else{if(d.isPLMInstance&&d.isPLMReference){c=(d.isPLMReference())||(d.isPLMInstance())}else{c=(d.productType==="Reference3D")||(d.productType==="Instance3D")}}}return c},isLeaf:function(f){var c=true;var e=f.children;var g=e.length;for(var d=0;c&&(d<g);d++){var h=f.children[d];if(a.isReferenceOrInstance(h)){c=false}}return c},getName:function(c,d,u,r){var e=(r)?r:"";if(c&&d){var t=[];var s=[];var o=true;var n=c.length;for(var l=0;l<n;l++){var g=c[l];var f=(u)?u.name:g.className;if(((f==="ENOPAD3DContext")||(f==="PAD3DViewerNode"))&&(g.getID)){o=false;if(a.isInstance(g)){g=g.children[0]}s.push(g.getID());t.push(e)}else{t.push(g.name)}}d(t);if(!o){var q=[];for(var l=0;l<s.length;l++){var p=false;for(var k=0;!p&&(k<l);k++){p=(s[l]===s[k])}if(!p){q.push(s[l])}}var m=u.ctx.getController();var h="ds6w:label";m.getAttributes({ids:q,attributes:[h],callbacks:{onComplete:function(w){t=[];for(var j=0;j<s.length;j++){var v=w[s[j]];t.push(v[h])}d(t)},onFailure:function(){return null}}})}}},getProductRoots:function(d){var c=[];a._recursiveGetProductRoots(d.getRootNode(),c,true);return c},_recursiveGetProductRoots:function(g,f,e){var d=g.children;var h=d.length;for(var c=0;c<h;c++){if(true===a.isReference(d[c])){if(!e){f.push(g);break}else{f.push(d[c])}}else{a._recursiveGetProductRoots(d[c],f,false)}}},getRootReferences:function(c){var d=[];a._recursiveGetRootReferences(c.getRootNode(),d);return d},_recursiveGetRootReferences:function(e,f){if(a.isReference(e)){f.push(e)}else{var d=e.children;var g=d.length;for(var c=0;c<g;c++){a._recursiveGetRootReferences(d[c],f)}}},getViewerRoot:function(c){return c.getRootNode()},getSceneRoot:function(c){return c.getRootNode()},recursiveGetPathElementVisibility:function(m,l){var d;if(m.hasSceneGraphOverrideSet()){var c=m.getSceneGraphOverrideSetManager();if(c){var o=c.getNumberOfSceneGraphOverrideSets();for(var k=0;k<o;k++){var f=c.getSceneGraphOverrideSetAt(k);if(f){var h=f.getOverridesFromPathElement(l);if(h){for(var g=0;g<h.length;g++){d=h[g].getVisibility();if(d!==null){break}}}else{var n=l.getChildrenPathes();for(var g=0;g<n.length;g++){d=a.recursiveGetPathElementVisibility(m,n[g]);if(d!==null){break}}}}}}else{if(m&&l&&m.sceneGraphState){d=m.sceneGraphState.getAppliedVisibility(l);if(d===null){var e=l.getChildrenPathes();for(var g=0;g<e.length;g++){d=a.recursiveGetPathElementVisibility(m,e[g]);if(d!==null){break}}}}}}return d},isVisible:function(e,f){var c=false;if(f&&e){var d=e.getSceneGraphOverrideSetManager().getCurrentVisibility(f);c=((d===null||d===undefined)?true:d)}return c},getFirstReference:function(d){var h=new b();var g=d.getLength();var c=null;for(var e=0;(c===null)&&(e<g);e++){var f=d.getElement(e);h.addElement(f);if(a.isReference(f)){c=f}}return h},getLastReference:function(d){var c=new b();var h=d.getLength();var k=false;var g;for(var f=0;f<h;f++){g=d.getElement(f);if(!k){c.addElement(g);k=a.isReference(g)}else{if(a.isReferenceOrInstance(g)){c.addElement(g)}}}var e=c.getLength();if(e>0){g=c.getElement(e-1);if(a.isInstance(g)){var j=g.children.length;if(j>0){c.addElement(g.children[0])}}}return c},truncatePathElement:function(e,d){var c=new b();var g=Math.min(e.getLength(),d);for(var f=0;f<g;f++){c.addElement(e.getElement(f))}return c},buildPathElement:function(f){var d=new b();var c=[];var e=f;while(e&&!e.notAllowedInPathElement){c.splice(0,0,e);e=e.parents[0]}d.setFromArray(c);return d},isDescendant:function(f,e){var g=true;var d=f.getLength();if(e.getLength()>=d){for(var c=0;(g)&&(c<d);c++){g=e.getElement(c)===f.getElement(c)}}return g},getAllOthers:function(c){var e=[];var d=c;while(d&&this.isReferenceOrInstance(d.getLastElement())){e=e.concat(this._getBrothers(d));d=d.getParentPath()}return e},_getBrothers:function(c){var e=[];var d=c.getParentPath();if(d){e=d.getChildrenPathes(c)}return e},getRenderables:function(c){return c._getRenderableOccurrences()}};return a});define("DS/WebPolyMaths/WebMeasureEnums",[],function(){var a=a||{REVISION:"1"};a.ResultType={POINT:0,PICKINGPT:1,CENTER:2,CURVE:3,LINE:4,AXIS:5,CIRCLE:6,SURFACE:7,PLANE:8,CYLINDER:9,CONE:10,SPHERE:11,PRODUCT:12};a.ViewedType={POINT:0,CENTER:1,AXIS:2,CURVE:3,INFPLANE:4,SURFACE:5,PRODUCT:6,CIRCLE:7,CYCOSP:8};return a});define("DS/WebPolyMaths/WebMeshCreation",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/WebPolyMaths/WebToolsMaths"],function(b,d,c,a){var e={createPolylines:function(p,u){var w=3;var k=new c.PrimitiveGroup();var r=new c.Color(u[0].r,u[0].g,u[0].b,1);k.fillAttr=new c.FillAttributes();k.lineAttr=new c.LineAttributes(r,1);k.pointAttr=new c.PointAttributes();var f=0;var t=p.length;for(var n=0;n<t;n++){var i=p[n];var j=i.length;for(var h=0;h<j;h++){f+=i[h].length}}var o=new c.Buffer();o.size=w*f;o.component=c.VertexComponentEnum.POSITION;o.format=c.DataTypeEnum.FLOAT;o.dimension=w;o.data=new Float32Array(o.size);var x=o.data;var v=0;for(var n=0;n<t;n++){var i=p[n];var j=i.length;for(var h=0;h<j;h++){var s=i[h];f=s.length;for(var m=0;m<f;m++){var y=s[m];x[v]=y[0];x[v+1]=y[1];x[v+2]=y[2];v+=w}}}k.addBuffer(0,o);var g=0;for(var n=0;n<t;n++){var i=p[n];var r=new c.Color(u[n].r,u[n].g,u[n].b,1);var j=i.length;for(var h=0;h<j;h++){var s=i[h];f=s.length;var q=new c.Primitive();q.nbIndices=f;q.connectivity=c.ConnectivityTypeEnum.LINE_STRIP;q.attr={fill:new c.FillAttributes(r),line:new c.LineAttributes(r,1),point:new c.PointAttributes()};var l=new c.VertexComponent();l.component=c.VertexComponentEnum.POSITION;l.nbVertices=f;l.nbValuesPerVertex=w;l.format=c.DataTypeEnum.FLOAT;l.cardinality=0;l.bufferId=0;l.offset=g;g+=f;q.addVertexComponent(l);k.addPrimitive(q)}}return k},createRectangle:function(g,h,p,m,o,f){var j=[];var k=0;j[k++]=0;j[k++]=0;j[k++]=0;j[k++]=g;j[k++]=0;j[k++]=0;j[k++]=g;j[k++]=h;j[k++]=0;j[k++]=0;j[k++]=h;j[k++]=0;var l=[];l[0]=0;l[1]=0;l[2]=1;var n=[];var k=0;n[k++]=0;n[k++]=1;n[k++]=1;n[k++]=0;return e.createPlanarPolygon(j,l,n,false,p,m,o,f)},createArrow:function(g,h,k,s,p,r,f){var o=(1-k)*h;var m=g/2;var j=[];var l=0;j[l++]=0;j[l++]=0;j[l++]=0;j[l++]=o;j[l++]=-g;j[l++]=0;j[l++]=o;j[l++]=-m;j[l++]=0;j[l++]=h;j[l++]=-m;j[l++]=0;j[l++]=h;j[l++]=m;j[l++]=0;j[l++]=o;j[l++]=m;j[l++]=0;j[l++]=o;j[l++]=g;j[l++]=0;var n=[];n[0]=0;n[1]=0;n[2]=1;var q=[];var l=0;q[l++]=1;q[l++]=1;q[l++]=1;q[l++]=0;q[l++]=0;q[l++]=1;q[l++]=1;return e.createPlanarPolygon(j,n,q,false,s,p,r,f)},createRing:function(f,q,A,x,p,l,g,r,n,k){var B=x-A;var C=B/p;var s=[];var z=0;var y=[];var w=0;var h=(k)?1:0;var m=1-h;var v=a.isZero(f);if(v){s[z++]=0;s[z++]=0;s[z++]=0;y[w++]=h}for(var o=0;o<=p;o++){var t=A+o*C;if(!v){s[z++]=f*Math.cos(t);s[z++]=f*Math.sin(t);s[z++]=0;y[w++]=h}s[z++]=q*Math.cos(t);s[z++]=q*Math.sin(t);s[z++]=0;y[w++]=m}var u=[];u[0]=0;u[1]=0;u[2]=1;return e.createPlanarPolygon(s,u,y,!v,l,g,r,n)},createPlanarPolygon:function(I,x,h,G,n,O,t,R){var E=3;var g=I.length/E;var u=(n)?g+1:0;var B=(t)?g:0;var N=(G)?c.ConnectivityTypeEnum.TRIANGLE_STRIP:c.ConnectivityTypeEnum.TRIANGLE_FAN;var M=(R!==undefined)?R:new c.Color(0.5,0.5,0.5,1);var J=(O!==undefined)?O:new c.Color(0.5,0.5,0.5,1);var s=new c.PrimitiveGroup();s.fillAttr=new c.FillAttributes();s.lineAttr=new c.LineAttributes();s.pointAttr=new c.PointAttributes();var A=new c.Buffer();A.size=E*g;A.component=c.VertexComponentEnum.POSITION;A.format=c.DataTypeEnum.FLOAT;A.dimension=E;A.data=new Float32Array(A.size);var p=new c.Buffer();p.size=E;p.component=c.VertexComponentEnum.NORMAL;p.format=c.DataTypeEnum.FLOAT;p.dimension=E;p.data=new Float32Array(p.size);var v=new c.Buffer();v.size=E*2;v.component=c.VertexComponentEnum.TEX_COORD_0;v.format=c.DataTypeEnum.FLOAT;v.dimension=E;v.data=new Float32Array(v.size);var H=new c.Buffer();H.indexBuffer=true;H.size=u+B;H.format=c.DataTypeEnum.UINT;H.dimension=1;H.data=new Uint16Array(H.size);var w=new c.Buffer();w.indexBuffer=true;w.size=B;w.format=c.DataTypeEnum.UINT;w.dimension=1;w.data=new Uint16Array(w.size);var C=new c.Buffer();C.indexBuffer=true;C.size=u+B;C.format=c.DataTypeEnum.UINT;C.dimension=1;C.data=new Uint16Array(C.size);var z=0;var Q=1;var f=2;var k=3;var y=4;var r=5;s.addBuffer(z,A);s.addBuffer(Q,p);s.addBuffer(f,H);s.addBuffer(k,w);s.addBuffer(y,v);s.addBuffer(r,C);var F=H.data;var L=0;var K=0;if(n){for(K=0;K<g;K++){F[L++]=K}F[L++]=0}if(t){for(K=0;K<g;K++){F[L++]=K}}F=w.data;L=0;if(t){for(K=0;K<g;K++){F[L++]=0}}F=C.data;L=0;if(t){for(K=0;K<g;K++){F[L++]=h[K]}}F=A.data;for(L=0;L<E*g;L++){F[L]=I[L]}F=p.data;L=0;F[L++]=x[0];F[L++]=x[1];F[L++]=x[2];F=v.data;L=0;F[L++]=0;F[L++]=0;F[L++]=0;F[L++]=1;F[L++]=0;F[L++]=0;if(n){var m=new c.Primitive();m.nbIndices=g+1;m.connectivity=c.ConnectivityTypeEnum.LINE_STRIP;m.attr={fill:new c.FillAttributes(J),line:new c.LineAttributes(J),point:new c.PointAttributes()};var l=new c.VertexComponent();l.component=c.VertexComponentEnum.POSITION;l.nbVertices=g;l.nbValuesPerVertex=E;l.format=c.DataTypeEnum.FLOAT;l.cardinality=0;l.bufferId=z;l.indices=new c.IndexArray();l.indices.format=c.DataTypeEnum.UINT;l.indices.bufferId=f;l.indices.offset=0;m.addVertexComponent(l);s.addPrimitive(m)}if(t){var o=new c.Primitive();o.nbIndices=g;o.connectivity=N;o.attr={fill:new c.FillAttributes(M),line:new c.LineAttributes(),point:new c.PointAttributes()};var q=new c.VertexComponent();q.component=c.VertexComponentEnum.POSITION;q.nbVertices=g;q.nbValuesPerVertex=E;q.format=c.DataTypeEnum.FLOAT;q.cardinality=0;q.bufferId=z;q.indices=new c.IndexArray();q.indices.format=c.DataTypeEnum.UINT;q.indices.bufferId=f;q.indices.offset=u;var D=new c.VertexComponent();D.component=c.VertexComponentEnum.NORMAL;D.nbVertices=1;D.nbValuesPerVertex=E;D.format=c.DataTypeEnum.FLOAT;D.cardinality=0;D.bufferId=Q;D.indices=new c.IndexArray();D.indices.format=c.DataTypeEnum.UINT;D.indices.bufferId=k;D.indices.offset=0;var P=new c.VertexComponent();P.component=c.VertexComponentEnum.TEX_COORD_0;P.nbVertices=2;P.nbValuesPerVertex=E;P.format=c.DataTypeEnum.FLOAT;P.cardinality=0;P.bufferId=y;P.indices=new c.IndexArray();P.indices.format=c.DataTypeEnum.UINT;P.indices.bufferId=r;P.indices.offset=0;o.addVertexComponent(q);o.addVertexComponent(D);o.addVertexComponent(P);s.addPrimitive(o)}return s}};return e});define("DS/WebPolyMaths/WebMathsInfiniteGeometry",["DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebGeometryEnums"],function(e,c){var a=0.001;var d=0.000001;var b={computeTwoPointsDistance:function(h,g){var f={};f.returnCode=1;if(h&&g){f.returnCode=0;f.distance=e.subAndLength(h,g);f.relationship=(f.distance<a)?c.Relationship.COINCIDENT:c.Relationship.NONE}return f},computePointLineDistance:function(k,j,g){var f={};f.returnCode=1;if(k&&j&&g){var h=e.squaredLength(g);if(h>d){f.returnCode=0;var i=e.dot(e.sub(j,k),g)/h;f.aPosition=e.multiplyAndAdd(g,i,j);f.distance=e.subAndLength(k,f.aPosition);f.relationship=(f.distance<a)?c.Relationship.COINCIDENT:c.Relationship.NONE}}return f},computePointPlaneDistance:function(k,g,i){var f={};f.returnCode=1;if(k&&g&&i){var h=e.squaredLength(i);if(h>d){f.returnCode=0;var j=e.dot(e.sub(k,g),i)/h;f.aPosition=e.multiplyAndAdd(i,j,k);f.distance=e.subAndLength(k,f.aPosition);f.relationship=(f.distance<a)?c.Relationship.COINCIDENT:c.Relationship.NONE}}return f},computeTwoLinesDistance:function(r,q,g,h){var s={};s.returnCode=1;if(r&&q&&g&&h){s.returnCode=0;var f=e.sub(g,r);var n=e.squaredLength(q);var m=e.dot(q,h);var k=e.squaredLength(h);var j=e.dot(q,f);var i=e.dot(h,f);var l=n*k-m*m;var p=0;var o=0;if(l<a){p=0;o=(m>k)?(j/m):(i/k);s.aPosition1=e.clone(r);s.aPosition2=e.multiplyAndAdd(h,o,g);s.distance=e.subAndLength(s.aPosition1,s.aPosition2);s.relationship=(s.distance<a)?c.Relationship.COINCIDENT:c.Relationship.PARRALLEL;s.angle=0}else{p=(m*i-k*j)/l;o=(n*i-m*j)/l;s.aPosition1=e.multiplyAndAdd(q,p,r);s.aPosition2=e.multiplyAndAdd(h,o,g);s.distance=e.subAndLength(s.aPosition1,s.aPosition2);s.relationship=(s.distance<a)?c.Relationship.INTERSECTING:c.Relationship.NONE;s.angle=e.angle(q,h)}}return s},computeLinePlaneDistance:function(i,j,h,g){var o={};o.returnCode=1;if(i&&j&&h&&g){o.returnCode=0;var l=e.normalize(j);var f=e.normalize(g);var m=e.dot(l,f);if(Math.abs(m)<a){o.angle=0;var k=b.computePointPlaneDistance(i,h,f);if((k.returnCode===0)&&(k.distance<a)){o.distance=0;o.aPosition=e.clone(i);o.relationship=c.Relationship.COINCIDENT}else{o.distance=k.distance;o.aPosition=k.aPosition;o.relationship=c.Relationship.PARRALLEL}}else{o.distance=0;o.angle=Math.asin(m);var n=e.dot(e.sub(i,h),f)/m;o.aPosition=e.multiplyAndAdd(l,n,i);o.relationship=c.Relationship.INTERSECTING}}return o},computeTwoPlanesDistance:function(p,u,o,s){var v={};v.returnCode=1;if(p&&u&&o&&s){v.returnCode=0;var m=e.normalize(u);var g=e.normalize(s);if(e.areEqual(m,g)||e.isNull(e.add(m,g))){v.angle=0;var q=(e.areEqual(m,g))?1:-1;var n=e.dot(p,m);var l=e.dot(o,g);v.distance=Math.abs(n-q*l);var k=b.computePointPlaneDistance(o,p,m);v.aPosition1=k.aPosition;var j=b.computePointPlaneDistance(p,o,g);v.aPosition2=j.aPosition;v.relationship=(v.distance<a)?c.Relationship.COINCIDENT:c.Relationship.PARRALLEL}else{v.distance=0;v.angle=Math.acos(e.dot(m,g));var r=e.cross(m,g);var f=e.cross(m,r);var t=e.cross(g,r);var i=b.computeLinePlaneDistance(o,t,p,m);v.aPosition1=i.aPosition;var h=b.computeLinePlaneDistance(p,f,o,g);v.aPosition2=h.aPosition;v.relationship=c.Relationship.INTERSECTING}}return v}};return b});define("DS/WebPolyMaths/WebMathsBoundingGeometry",["DS/WebPolyMaths/WebMathsVector3D"],function(d){var b=0.001;var c=0.000001;var a={areEqualAABB:function(g,f){var e=(Math.abs(f[0]-g[0])<b)&&(Math.abs(f[1]-g[1])<b)&&(Math.abs(f[2]-g[2])<b)&&(Math.abs(f[3]-g[3])<b)&&(Math.abs(f[4]-g[4])<b)&&(Math.abs(f[5]-g[5])<b);return e},computeAABBDistance:function(f,e){return Math.sqrt(a.computeAABBSquaredDistance(f,e))},computeAABBSquaredDistance:function(f,e){var j=0;var i=0;var h=0;var g=0;if(f[3]<e[0]){i=e[0]-f[3]}else{if(f[0]>e[3]){i=f[0]-e[3]}}if(f[4]<e[1]){h=e[1]-f[4]}else{if(f[1]>e[4]){h=f[1]-e[4]}}if(f[5]<e[2]){g=e[2]-f[5]}else{if(f[2]>e[5]){g=f[2]-e[5]}}if((i!==0)||(h!==0)||(g!==0)){j=i*i+h*h+g*g}return j},computeAABBForPoint:function(f){var e=[];e[0]=f[0];e[1]=f[1];e[2]=f[2];e[3]=f[0];e[4]=f[1];e[5]=f[2];return e},computeAABBForPoints:function(k){var f=[];var j=k.length;var l;var h;var g;f[0]=k[0][0];f[1]=k[0][1];f[2]=k[0][2];f[3]=f[0];f[4]=f[1];f[5]=f[2];for(var e=1;e<j;e++){l=k[e][0];h=k[e][1];g=k[e][2];if(l<f[0]){f[0]=l}else{if(l>f[3]){f[3]=l}}if(h<f[1]){f[1]=h}else{if(h>f[4]){f[4]=h}}if(g<f[2]){f[2]=g}else{if(g>f[5]){f[5]=g}}}return f},computeAABBForUnsortedPoints:function(o,f,q,h,e){var p=[];var m;var n;var l;var k;if(e&&!d.isIdentity(e)){m=3*q[f];p=d.transformPoint([h[m],h[m+1],h[m+2]],e);p[3]=p[0];p[4]=p[1];p[5]=p[2];for(var j=1;j<o;j++){m=3*q[f+j];var g=d.transformPoint([h[m],h[m+1],h[m+2]],e);n=g[0];l=g[1];k=g[2];if(n<p[0]){p[0]=n}else{if(n>p[3]){p[3]=n}}if(l<p[1]){p[1]=l}else{if(l>p[4]){p[4]=l}}if(k<p[2]){p[2]=k}else{if(k>p[5]){p[5]=k}}}}else{m=3*q[f];p[0]=h[m];p[1]=h[m+1];p[2]=h[m+2];p[3]=p[0];p[4]=p[1];p[5]=p[2];for(var j=1;j<o;j++){m=3*q[f+j];n=h[m];l=h[m+1];k=h[m+2];if(n<p[0]){p[0]=n}else{if(n>p[3]){p[3]=n}}if(l<p[1]){p[1]=l}else{if(l>p[4]){p[4]=l}}if(k<p[2]){p[2]=k}else{if(k>p[5]){p[5]=k}}}}return p},computeAABBForSegment:function(f,e){var g=[];g[0]=Math.min(f[0],e[0]);g[1]=Math.min(f[1],e[1]);g[2]=Math.min(f[2],e[2]);g[3]=Math.max(f[0],e[0]);g[4]=Math.max(f[1],e[1]);g[5]=Math.max(f[2],e[2]);return g},computeAABBForTriangle:function(f,e,h){var g=[];g[0]=Math.min(f[0],e[0],h[0]);g[1]=Math.min(f[1],e[1],h[1]);g[2]=Math.min(f[2],e[2],h[2]);g[3]=Math.max(f[0],e[0],h[0]);g[4]=Math.max(f[1],e[1],h[1]);g[5]=Math.max(f[2],e[2],h[2]);return g},areEqualBoundingSpheres:function(g,f){var e=(Math.abs(f[0]-g[0])<b)&&(Math.abs(f[1]-g[1])<b)&&(Math.abs(f[2]-g[2])<b)&&(Math.abs(f[3]-g[3])<b);return e},computeBoundingSpheresDistance:function(f,e){return Math.max(0,d.subAndLength(f,e)-f[3]-e[3])},computeBoundingSpheresSquaredDistance:function(f,e){var g=a.computeBoundingSpheresDistance(f,e);return g*g},computeBoundingSphereForPoint:function(f){var e=[];e[0]=f[0];e[1]=f[1];e[2]=f[2];e[3]=0;return e},computeBoundingSphereForPoints:function(h){var e=[];var g=a.computeAABBForPoints(h);var f=[g[3],g[4],g[5]];e=a.computeBoundingSphereForSegment(g,f);return e},computeBoundingSphereForSegment:function(f,g){var e=[];e[0]=(f[0]+g[0])/2;e[1]=(f[1]+g[1])/2;e[2]=(f[2]+g[2])/2;e[3]=d.subAndLength(f,g)/2;return e},computeBoundingSphereForTriangle:function(m,l,k){var e=[];var g=d.sub(m,l);var f=d.sub(m,k);var p=d.squaredLength(g);var n=d.squaredLength(f);var h=d.dot(g,f);var i=2*(p*n-h*h);var j;if(Math.abs(i)<=c){var r=a.computeAABBForTriangle(m,l,k);j=[r[3],r[4],r[5]];e=a.computeBoundingSphereForSegment(r,j)}else{var q=(p*n-n*h)/i;var o=(n*p-p*h)/i;var s=m;if(q<=0){j=d.add(m,k);e=d.multiply(j,0.5)}else{if(o<=0){j=d.add(m,l);e=d.multiply(j,0.5)}else{if(q+o>=1){j=d.add(l,k);e=d.multiply(j,0.5);s=l}else{j=d.multiplyAndAdd(g,q,m);e=d.multiplyAndAdd(f,o,j)}}}e[3]=d.subAndLength(e,m)}return e}};return a});define("DS/WebPolyMaths/WebMeshRecognition",["DS/WebPolyMaths/WebToolsMaths","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/Visualization/ThreeJS_DS","DS/Visualization/Measurable"],function(h,k,b,d,i,g,a){var l=0.1;var c=0.02;var f=0.000001;var e=50;var j={recognizeCanonicGeometry:function(v,A,p){var C={};C.returnCode=1;if(v.decoration){var s=new a(v);var B=s.getType();switch(B){case a.TYPEUNKNOWN:var o=j.extractMeshVertices(v);var y=v.group.glType;var x=o.length;if(x===1){C.returnCode=0;C.type=k.GeometryType.POINT;C.position=j._buildVector3(o[0]).applyMatrix4(A)}break;case a.TYPEPLANE:var t=s.getPlane();if(t){C.returnCode=0;C.type=k.GeometryType.PLANE;C.origin=j._buildVector3(t.position).applyMatrix4(A);C.normal=j._buildVector3(t.normal).transformDirection(A)}break;case a.TYPECYLINDER:var w=s.getCylinder();if(w){C.returnCode=0;C.type=k.GeometryType.CYLINDER;C.radius=w.radius;if(p){var o=j.extractMeshVertices(v);var r=j._computeMinMaxProjection(o,w.axis,w.center);if(r.returnCode===0){C.point1=j._buildVector3(r.aPoint1).applyMatrix4(A);C.point2=j._buildVector3(r.aPoint2).applyMatrix4(A)}}else{C.point1=j._buildVector3(w.center).applyMatrix4(A);C.point2=C.point1.clone().sub(j._buildVector3(w.axis)).applyMatrix4(A)}}break;case a.TYPECONE:var u=s.getCone();if(u){C.returnCode=0;C.type=k.GeometryType.CONE;C.semiAngle=u.semiAngle;C.apex=j._buildVector3(u.center).applyMatrix4(A);C.axis=j._buildVector3(u.axis).transformDirection(A);if(p){var o=j.extractMeshVertices(v);var r=j._computeMinMaxProjection(o,u.axis,u.center);if(r.returnCode===0){C.point1=j._buildVector3(r.aPoint1).applyMatrix4(A);C.point2=j._buildVector3(r.aPoint2).applyMatrix4(A)}}else{C.point1=j._buildVector3(u.center).applyMatrix4(A);C.point2=C.point1.clone().sub(j._buildVector3(u.axis)).applyMatrix4(A)}}break;case a.TYPESPHERE:var q=s.getSphere();if(q){C.returnCode=0;C.type=k.GeometryType.SPHERE;C.radius=q.radius;C.center=j._buildVector3(q.center).applyMatrix4(A)}break;case a.TYPELINE:var z=s.getLine();if(z){C.returnCode=0;C.type=k.GeometryType.LINE;C.point1=j._buildVector3(z.startPosition).applyMatrix4(A);C.point2=j._buildVector3(z.endPosition).applyMatrix4(A)}break;case a.TYPECIRCLE:var m=s.getCircle();if(m){C.returnCode=0;C.type=k.GeometryType.CIRCLE;C.radius=m.radius;C.center=j._buildVector3(m.center).applyMatrix4(A);C.normal=j._buildVector3(m.axis).transformDirection(A)}break}C.exact=C.returnCode===0}else{if(v._bNotRecognized===undefined){if(j.verifyMesh(v)){var o=j.extractMeshVertices(v);var y=v.group.glType;var x=o.length;if(x===1){C.returnCode=0;C.type=k.GeometryType.POINT;C.position=j._buildVector3(o[0]).applyMatrix4(A)}else{if(x===2){C=j._recognizeLine(o);if(C.returnCode===0){C.point1=j._buildVector3(C.aPoint1).applyMatrix4(A);C.point2=j._buildVector3(C.aPoint2).applyMatrix4(A)}}else{if(y===1){var r=j._recognizeCircle(o);if(r.returnCode===0){C=r;C.center=j._buildVector3(C.aCenter).applyMatrix4(A);C.normal=j._buildVector3(C.aNormal).transformDirection(A)}else{C=j._recognizeLine(o);if(C.returnCode===0){C.point1=j._buildVector3(C.aPoint1).applyMatrix4(A);C.point2=j._buildVector3(C.aPoint2).applyMatrix4(A)}}}else{if(y===4){var r=j._recognizePlane(o);if(r.returnCode===0){C=r;C.origin=j._buildVector3(C.aOrigin).applyMatrix4(A);C.normal=j._buildVector3(C.aNormal).transformDirection(A)}else{var n=j.extractMeshNormals(v);C=j._recognizeCylinder(o,n);if(C.returnCode===0){C.point1=j._buildVector3(C.aPoint1).applyMatrix4(A);C.point2=j._buildVector3(C.aPoint2).applyMatrix4(A)}else{C=j._recognizeSphere(o,n);if(C.returnCode===0){C.center=j._buildVector3(C.aCenter).applyMatrix4(A)}else{C=j._recognizeCone(o,n);if(C.returnCode===0){C.apex=j._buildVector3(C.aApex).applyMatrix4(A);C.axis=j._buildVector3(C.aAxis).applyMatrix4(A);C.point1=j._buildVector3(C.aPoint1).applyMatrix4(A);C.point2=j._buildVector3(C.aPoint2).applyMatrix4(A)}}}}}}}}}if(C.returnCode===1){v._bNotRecognized=true}}C.exact=false}return C},recognizeNonCanonicGeometry:function(r,q,p){var m={};m.returnCode=1;if(j.verifyMesh(r)){var n=j.extractMeshVertices(r,q.elements);var o=r.group.glType;if(o===1){m=j._recognizeCurve(n,p);if((m.returnCode===0)&&p){m.point1=j._buildVector3(m.aPoint1);m.point2=j._buildVector3(m.aPoint2)}}else{if(o===4){m=j._recognizeSurface(n,p);if((m.returnCode===0)&&p){m.cog=j._buildVector3(m.aCog)}}}}return m},verifyMesh:function(n){var m=(n!==undefined)&&(n.group!==undefined)&&(n.group.glType!==undefined)&&(n.group.geometry!==undefined);m=m&&(n.count!==undefined)&&(n.count>0)&&(n.group.geometry.vertexIndexArray!==undefined);return m},extractMeshVertices:function(u,m){var q=[];var w=u.count;var p=u.start;var v=u.group.geometry;var o=v.vertexIndexArray;var n=v.vertexPositionArray;var t;if(m&&!b.isIdentity(m)){for(var s=0;s<w;s++){t=3*o[p+s];q[s]=b.transformPoint([n[t],n[t+1],n[t+2]],m)}}else{for(var r=0;r<w;r++){t=3*o[p+r];q[r]=[n[t],n[t+1],n[t+2]]}}return q},extractMeshNormals:function(u,m){var o=[];if(j.verifyMesh(u)){var s=u.count;var p=u.start;var v=u.group.geometry;var n=v.vertexIndexArray;var w=v.vertexNormalArray;var t;if(m&&!b.isIdentity(m)){for(var r=0;r<s;r++){t=3*n[p+r];o[r]=b.transformVector([w[t],w[t+1],w[t+2]],m)}}else{for(var q=0;q<s;q++){t=3*n[p+q];o[q]=[w[t],w[t+1],w[t+2]]}}}return o},computeAABB:function(s,n){var q=s.count;var o=s.start;var r=s.group.geometry;var p=r.vertexIndexArray;var m=r.vertexPositionArray;return i.computeAABBForUnsortedPoints(q,o,p,m,n)},computeBoundingSphere:function(p,n){var m=[];var o=j.extractMeshVertices(p,n);var m=i.computeBoundingSphereForPoints(o);return m},_recognizeLine:function(o){var y={};y.returnCode=1;var v=o.length;if(v===2){y.returnCode=0;y.type=k.GeometryType.LINE;y.aPoint1=o[0];y.aPoint2=o[1]}else{if(v>2){var t=b.sub(o[1],o[0]);var s;var n=true;for(var r=1;n&&(r<v);r++){s=b.sub(o[r],o[0]);n=h.isZero(b.length(b.cross(t,s)))}if(n){var x=0;var p=1;var u=0;var m=b.dot(t,t);for(var q=2;q<v;q++){s=b.sub(o[q],o[0]);var w=b.dot(t,s);if(w<u){x=q;u=w}else{if(w>m){p=q;m=w}}}y.returnCode=0;y.type=k.GeometryType.LINE;y.aPoint1=o[x];y.aPoint2=o[p]}}}return y},_recognizePlane:function(n){var B={};B.returnCode=1;var y=n.length;var v;var t;var w=0;var u=0;var s=0;for(var q=w+1;q<y&&0===s;q++){if(0===u){v=b.sub(n[w],n[q]);if(b.length(v)>l){u=q}}else{if(0===s){t=b.sub(n[w],n[q]);if(b.length(t)>l){var p=b.angle(v,t);if((p>c)&&(p<Math.PI-c)){s=q}}}}}if((0!==u)&&(0!==s)){var x=b.cross(v,t);var A=true;for(var o=0;A&&(o<y);o++){if((o!==w)&&(o!==u)&&(o!==s)){var r=b.sub(n[w],n[o]);var z=b.cross(v,r);if(!h.isZero(b.length(z))){var m=b.angle(x,z);A=!((m>c)&&(m<Math.PI-c))}}}if(A){B.returnCode=0;B.type=k.GeometryType.PLANE;B.aOrigin=n[w];B.aNormal=b.normalize(x)}}return B},_recognizeCircle:function(x){var w={};w.returnCode=1;var D=x.length;if(D>6){var o=j._recognizePlane(x);if(o&&(o.type===k.GeometryType.PLANE)){var B=o.aNormal;var t=0;var s=t+1;if(b.areEqual(x[t],x[s])){s++}var r=Math.floor(D/3);var q=r+1;if(b.areEqual(x[r],x[q])){q++}var u=b.multiply(b.add(x[t],x[s]),0.5);var p=b.cross(b.sub(x[t],x[s]),B);var z=b.multiply(b.add(x[r],x[q]),0.5);var y=b.sub(x[r],x[q]);var v=d.computeLinePlaneDistance(u,p,z,y);if(v.aPosition){var A=b.length(b.sub(x[t],v.aPosition));var n=true;for(var C=0;n&&(C<D);C++){var m=b.length(b.sub(x[C],v.aPosition));n=h.areEqual(A,m)}if(n){w.returnCode=0;w.type=k.GeometryType.CIRCLE;w.radius=A;w.aCenter=v.aPosition;w.aNormal=B}}}}return w},_recognizeCylinder:function(O,Q,H){var K={};K.returnCode=1;var u=((H)&&(H<=O.length))?H:O.length;var D=true;if(u>e){var B=j._recognizeCylinder(O,Q,e);D=(B!==undefined)&&(B.type!==undefined)&&(B.type===k.GeometryType.CYLINDER)}if(D){var o;var N;var x;var t=false;if(u>7){for(var Y=0;Y<u;Y++){for(var X=Y+1;X<u;X++){N=b.cross(Q[Y],Q[X]);if(!t){if(b.length(N)>l){t=true;x=N;o=N}}else{var z=b.dot(x,N);o=b.add(o,b.multiply(N,z))}}}}if(o){var p=0.7;x=b.normalize(o);o=[0,0,0];var F=0;var E=[];for(var W=0;W<u;W++){N=b.cross(Q[W],x);if(b.length(N)/b.length(Q[W])>p){F++;E[W]=1}else{E[W]=0}}var y=true;if(F>1){for(var V=0;(V<u)&&(E[V]===1);V++){for(var U=V+1;(U<u)&&(E[U]===1);U++){N=b.cross(Q[V],Q[U]);if(!t){if(b.length(N)>l){t=true;x=N;o=N}}else{var P=b.dot(x,N);o=b.add(o,b.multiply(N,P))}}}o=b.normalize(o);for(var T=0;(T<u)&&(E[T]===1)&&y;T++){N=b.cross(Q[T],o);if(1-b.length(N)/b.length(Q[T])>c){y=false}}}else{y=false}if(l>=b.length(o)){y=false}if(y){var v=0;var A=[];var ac=0;var L=0;var M=0;var Z=0;var ab;for(var S=0;S<u;S++){ab=b.dot(b.sub(O[0],O[S]),o);var w=b.sub(b.multiply(o,ab),O[S]);var G=false;for(var R=0;(R<v)&&!G;R++){var I=b.subAndLength(A[R],w);G=(I<l)}if(!G){A[v]=w;v++}if(ab>M){M=ab;Z=S}if(ab<ac){ac=ab;L=S}}var J=j._recognizeCircle(A);if(J&&(J.type===k.GeometryType.CIRCLE)){ab=b.dot(b.sub(J.aCenter,O[L]),o);var aa=b.add(b.multiply(o,ab),J.aCenter);ab=b.dot(b.sub(J.aCenter,O[Z]),o);var C=b.add(b.multiply(o,ab),J.aCenter);K.returnCode=0;K.type=k.GeometryType.CYLINDER;K.radius=J.radius;K.aPoint1=aa;K.aPoint2=C}}}}return K},_recognizeCone:function(w,z,o,n){var v={};v.returnCode=1;var N=((o)&&(o<=w.length))?o:w.length;var x=((n)&&(n<=z.length))?n:z.length;var E=true;if(N>e){var H=j._recognizeCone(w,z,e,e);E=(H!==undefined)&&(H.type!==undefined)&&(H.type===k.GeometryType.CONE)}if(E){if(3<N){var B=[];for(var F=1;F<N;F++){if(!b.areEqual(w[0],w[F])){B.push(w[F])}}var q=j._recognizeCircle(B);if(q&&(q.type===k.GeometryType.CIRCLE)){var G=b.sub(q.aCenter,w[0]);if(b.areEqual(b.normalize(G),q.aNormal)){v.returnCode=0;v.type=k.GeometryType.CONE;v.aApex=w[0];v.aPoint1=w[0];v.aPoint2=q.aCenter;v.aAxis=q.aNormal;v.semiAngle=b.angle(b.sub(w[1],w[0]),G)}}}if((v.returnCode!==0)&&(N===x)){var C=false;var P=-1;var u=-1;var O=-1;var t=-1;for(var F=0;(F<x)&&!C;F++){for(var D=F+1;(D<x)&&!C;D++){if(b.areEqual(z[F],z[D])&&!b.areEqual(w[F],w[D])){if(0>P){P=F;O=D}else{if(!b.areEqual(z[P],z[F])){u=F;t=D;C=true}}}}}if((0<=P)&&(0<=O)&&(0<=u)&&(0<=t)){var s=b.sub(w[P],w[O]);var M=b.cross(s,z[P]);var r=b.sub(w[u],w[t]);var L=b.cross(r,z[u]);var p=false;var y=b.angle(M,L);if((y>c)&&(y<Math.PI-c)){var K=d.computeLinePlaneDistance(w[P],s,w[u],L);if((K.returnCode===0)&&(K.relationship===k.Relationship.INTERSECTING)){var J=d.computeLinePlaneDistance(w[P],z[P],w[u],L);if((J.returnCode===0)&&(J.relationship===k.Relationship.INTERSECTING)){p=true;v.aApex=K.aPosition;v.aAxis=b.normalize(b.sub(K.aPosition,J.aPosition))}}}else{var K=d.computeTwoLinesDistance(w[P],s,w[u],r);if((K.returnCode===0)&&(K.relationship===k.Relationship.INTERSECTING)){var J=d.computeTwoLinesDistance(w[P],z[P],w[u],z[u]);if((J.returnCode===0)&&(J.relationship===k.Relationship.INTERSECTING)){p=true;v.aApex=K.aPosition1;v.aAxis=b.normalize(b.sub(K.aPosition1,J.aPosition1))}}}if(p){v.semiAngle=b.angle(s,v.aAxis);var G;for(var A=0;(A<N)&&p;A++){G=b.sub(v.aApex,w[A]);y=b.angle(G,v.aAxis);p=h.areEqual(v.semiAngle,y)}if(p){v.returnCode=0;v.type=k.GeometryType.CONE;var I=j._computeMinMaxProjection(w,v.aAxis,v.aApex);v.aPoint1=I.aPoint1;v.aPoint2=I.aPoint2}}}}}return v},_recognizeSphere:function(x,A){var w={};w.returnCode=1;var F=x.length;var y=A.length;if(F===y){var u=0;var t=0;var r=0;var p=0;var s;var q;var o;var m;var B;for(var E=1;(E<F)&&(0===p);E++){if(0===t){s=b.sub(x[u],x[E]);if(b.length(s)>l){t=E}}else{if(0===r){q=b.sub(x[u],x[E]);if(b.length(q)>l){B=b.angle(s,q);if((B>c)&&(B<Math.PI-c)){r=E;m=b.cross(s,q)}}}else{if(0===p){o=b.sub(x[u],x[E]);if(b.length(o)>l){B=b.angle(m,b.cross(s,o));if((B>c)&&(B<Math.PI-c)){p=E}}}}}}if((0!==t)&&(0!==r)&&(0!==p)){var v=j._computeSphereThru4Points(x[u],x[t],x[r],x[p]);if(v.returnCode===0){var n=true;var z;var D;for(var C=0;(C<F)&&n;C++){D=b.sub(x[C],v.aCenter);z=b.length(D);n=h.areEqual(v.radius,z)&&b.areEqual(b.normalize(D),b.normalize(A[C]))}if(n){w.returnCode=0;w.type=k.GeometryType.SPHERE;w.aCenter=v.aCenter;w.radius=v.radius}}}}return w},_recognizeCurve:function(n,s){var m={};m.returnCode=0;m.type=k.GeometryType.CURVE;m.length=0;if(s){var q=n.length;var p=q/2;var r=0;for(var o=0;o<p;o++){r+=b.length(b.sub(n[o],n[o+1]))}m.length=r;m.aPoint1=n[0];m.aPoint2=n[q-1]}return m},_recognizeSurface:function(o,n){var x={};x.returnCode=1;x.type=k.GeometryType.SURFACE;x.area=0;if(n){var v=o.length;var w=v/3;var t=0;var m=[0,0,0];for(var p=0;p<w;p++){var s=b.sub(o[3*p],o[3*p+1]);var q=b.sub(o[3*p],o[3*p+2]);var r=b.length(b.cross(s,q));var u=b.add(o[3*p],b.add(o[3*p+1],o[3*p+2]));t+=r;m=b.multiplyAndAdd(u,r,m)}x.returnCode=0;x.area=t/2;x.aCog=(h.isZero(t))?[0,0,0]:b.multiply(m,1/(3*t))}return x},_computeVolume:function(u,p){var y={};y.returnCode=1;var o=j.extractMeshVertices(u);if(u.group.glType===4){var x=o.length/3;var m=0;var n=[0,0,0];for(var q=0;q<x;q++){var v=b.sub(p,o[3*q]);var t=b.sub(p,o[3*q+1]);var s=b.sub(p,o[3*q+2]);var r=-(s[0]*t[1]*v[2])+(t[0]*s[1]*v[2])+(s[0]*v[1]*t[2])-(v[0]*s[1]*t[2])-(t[0]*v[1]*s[2])+(v[0]*t[1]*s[2]);var w=b.add(v,b.add(t,s));m+=r;n=b.multiplyAndAdd(w,r,n)}y.returnCode=0;y.volume=m/6;y.aCog=(h.isZero(m))?[0,0,0]:b.multiplyAndAdd(n,1/(4*m),p)}return y},_computeMinMaxProjection:function(p,n,s){var v={};v.returnCode=0;var t=p.length;var m=b.normalize(n);var r=Number.MAX_VALUE;var u=-Number.MAX_VALUE;var o;for(var q=0;q<t;q++){o=b.dot(b.sub(s,p[q]),m);if(o>u){u=o}if(o<r){r=o}}v.aPoint1=b.multiplyAndAdd(m,r,s);v.aPoint2=b.multiplyAndAdd(m,u,s);return v},_computeCircleThru3Points:function(s,r,q){var v={};v.returnCode=1;var m=b.sub(s,r);var t=b.sub(r,q);var o=b.cross(m,t);if(b.areEqual(s,r)){v.aCenter=b.multiply(b.add(s,q),0.5);o=b.cross([0,0,1],t)}else{if(b.areEqual(s,q)){v.aCenter=b.multiply(b.add(s,r),0.5);o=b.cross([0,0,1],m)}else{if(b.areEqual(r,q)){v.aCenter=b.multiply(b.add(s,r),0.5);o=b.cross([0,0,1],m)}else{var u=b.squaredLength(o);if(u>f){var n=(0.5*b.squaredLength(t)+0.5*b.dot(m,t))/u;var p=b.multiplyAndAdd(m,0.5,s);v.aCenter=b.multiplyAndAdd(b.cross(m,o),-n,p)}}}}if(v.aCenter!==undefined){v.returnCode=0;v.type=k.GeometryType.CIRCLE;v.radius=b.subAndLength(v.aCenter,s);v.aNormal=b.normalize(o)}return v},_computeSphereThru4Points:function(s,r,q,p){var n={};n.returnCode=1;var o=j._computeCircleThru3Points(s,r,q);if(o.returnCode===0){var m=j._computeCircleThru3Points(r,q,p);if(m.returnCode===0){var t=d.computeTwoLinesDistance(o.aCenter,o.aNormal,m.aCenter,m.aNormal);if((t.returnCode===0)&&(t.relationship===k.Relationship.INTERSECTING)){n.returnCode=0;n.type=k.GeometryType.SPHERE;n.aCenter=t.aPosition1;n.radius=b.subAndLength(n.aCenter,s)}}}return n},_buildVector3:function(m){return new g.Vector3(m[0],m[1],m[2])}};return j});define("DS/WebPolyMaths/WebMathsFiniteGeometry",["DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebGeometryEnums"],function(f,c,d){var b=0.001;var e=0.000001;var a={computePointSegmentDistance:function(k,h,g,i){var o={};o.returnCode=1;if(k&&h&&g){o.returnCode=2;var n=(i!==undefined)?i:Number.MAX_VALUE;if(n>e){var p=f.sub(k,h);var j=f.sub(h,g);var l=-f.dot(p,j);if(l<=0){o.aPosition=f.clone(h);n=f.squaredLength(p)}else{var m=f.squaredLength(j);if(m<e){o.aPosition=f.clone(h);n=f.squaredLength(p)}else{l=l/m;if(l>=1){o.aPosition=f.clone(g);n=f.subAndSquaredLength(g,k)}else{o.aPosition=f.multiplyAndAdd(j,l,h);n=f.subAndSquaredLength(o.aPosition,k)}}}if((i===undefined)||(i>n)){o.returnCode=0;o.squaredDistance=n;o.distance=Math.sqrt(n);o.relationship=(n<e)?d.Relationship.COINCIDENT:d.Relationship.NONE}}}return o},computePointTriangleDistance:function(q,i,h,g,y){var u={};u.returnCode=1;if(q&&i&&h&&g){u.returnCode=2;var C=f.sub(i,h);var s=f.squaredLength(C);var B=f.sub(i,g);var o=f.squaredLength(B);var v=f.sub(h,g);var j=f.squaredLength(v);if(s<e){u=a.computePointSegmentDistance(q,i,g)}else{if((o<e)||(j<e)){u=a.computePointSegmentDistance(q,i,h)}else{var k=f.sub(q,i);var r=f.dot(C,B);var m=f.dot(C,k);var l=f.dot(B,k);var w=s*o-r*r;var A=r*l-o*m;var z=r*m-s*l;if((A+z)<=w){if(A<0){if(z<0){if(m<0){z=0;A=(-m>=s)?1:-m/s}else{A=0;z=(l>=0)?0:((-l>=o)?1:z=-l/o)}}else{A=0;z=(l>=0)?0:((-l>=o)?1:-l/o)}}else{if(z<0){z=0;A=(m>=0)?0:((-m>=s)?1:-m/s)}else{w=1/w;A*=w;z*=w}}}else{var t=0;var x=0;var n=0;var p=0;if(A<0){t=r+m;x=o+l;if(x>t){n=x-t;p=s-2*r+o;A=(n>=p)?1:n/p;z=1-A}else{A=0;z=(x<=0)?1:((l>=0)?0:-l/o)}}else{if(z<0){t=r+m;x=o+l;if(x>t){n=x-t;p=s-2*r+o;A=(n>=p)?1:n/p;z=1-A}else{A=0;z=(x<=0)?1:((l>=0)?0:-l/o)}}else{n=o+l-r-m;if(n<=0){A=0}else{p=s-2*r+o;A=(n>=p?1:n/p)}z=1-A}}}u.aPosition=f.multiplyAndAdd(B,z,f.multiplyAndAdd(C,A,i));u.squaredDistance=f.subAndSquaredLength(u.aPosition,q);if((y===undefined)||(u.squaredDistance<y)){u.relationship=(u.squaredDistance<e)?d.Relationship.COINCIDENT:d.Relationship.NONE;u.returnCode=0}}}}return u},computeTwoSegmentsDistance:function(n,l,G,E,D){var y={};y.returnCode=1;if(n&&l&&G&&E){y.returnCode=2;if(f.areEqual(n,l)){y=a.computePointSegmentDistance(n,G,E,D);y.angle=0;y.aPosition1=f.clone(n);y.aPosition2=y.aPosition;return y}if(f.areEqual(G,E)){y=a.computePointSegmentDistance(G,n,l,D);y.angle=0;y.aPosition1=y.aPosition;y.aPosition2=f.clone(G);return y}var H=false;var K=f.sub(n,l);var h=f.sub(G,E);var A=f.cross(K,h);var F=f.squaredLength(A);var C=e*f.squaredLength(K)*f.squaredLength(h);var z=0;var r=0;var x=0;var p=0;var v=0;var u=0;var t=0;var q=0;var o=0;var J=0;if(F>C){x=f.sub(n,G);J=f.dot(x,A);J=J*J;if((D!==undefined)&&(J>(D*F))){return y}var k=f.cross(A,x);u=f.dot(k,K);t=f.dot(k,h);var s=false;if(u<=0){v=f.clone(G)}else{if(u>=F){v=f.clone(E)}else{s=1}}var m=false;if(t<=0){p=f.clone(n)}else{if(t>=F){p=f.clone(l)}else{m=1}}if(!s&&!m){r=f.sub(v,n);t=-f.dot(r,K);q=f.squaredLength(K);var B;if(t<=0){B=f.clone(n)}else{if(t>=q){B=f.clone(l)}else{t=t/q;B=f.multiplyAndAdd(K,t,n)}}var g=f.subAndSquaredLength(v,B);z=f.sub(G,p);u=f.dot(z,h);o=f.squaredLength(h);var i;if(u<=0){i=f.clone(G)}else{if(u>=o){i=f.clone(E)}else{u=u/o;i=f.multiplyAndAdd(h,u,G)}}var I=f.subAndSquaredLength(p,i);if(g<=I){if((D!==undefined)&&(g>D)){return y}J=g;p=B}else{if((D!==undefined)&&(I>D)){return y}J=I;v=i}}else{q=0;if(s&&m){var j=1/F;u=u*j;t=t*j;v=f.multiplyAndAdd(h,u,G);p=f.multiplyAndAdd(K,t,n);J=J*j}else{if(s){z=f.sub(G,p);q=f.squaredLength(h);A=f.cross(h,z);J=f.squaredLength(A);if((D!==undefined)&&(J>(D*q))){return y}o=f.dot(h,z);if(o<=0){v=f.clone(G);J=f.squaredLength(f.sub(v,p));if((D!==undefined)&&(J>(D*q))){return y}}else{if(o>=q){v=f.clone(E);J=f.squaredLength(f.sub(v,p));if((D!==undefined)&&(J>(D*q))){return y}}else{q=1/q;J=J*q;o=o*q;v=f.multiplyAndAdd(h,o,G)}}}else{r=f.sub(v,n);q=f.squaredLength(K);A=f.cross(K,r);J=f.squaredLength(A);if((D!==undefined)&&(J>(D*q))){return y}o=f.dot(K,r);o=-o;if(o<=0){p=f.clone(n);J=f.squaredLength(f.sub(v,p));if((D!==undefined)&&(J>(D*q))){return y}}else{if(o>=q){p=f.clone(l);J=f.squaredLength(f.sub(v,p));if((D!==undefined)&&(J>(D*q))){return y}}else{q=1/q;J=J*q;o=o*q;p=f.multiplyAndAdd(K,o,n)}}}}}}else{H=true;q=f.squaredLength(h);x=f.sub(G,n);u=f.dot(x,h);var w=f.sub(G,l);t=f.dot(w,h);if((q<e)||(Math.abs(u-t)<e)){return y}if(u>q){if(t>q){v=f.clone(E);if(t>=u){p=f.clone(n)}else{p=f.clone(l)}}else{if(t>=0){p=f.clone(l);t=t/q;v=f.multiplyAndAdd(h,t,G)}else{v=f.clone(G);t=u/(u-t);p=f.multiplyAndAdd(K,t,n)}}}else{if(u<0){if(t<0){v=f.clone(G);if(t<u){p=f.clone(n)}else{p=f.clone(l)}}else{if(t<=q){p=f.clone(l);t=t/q;v=f.multiplyAndAdd(h,t,G)}else{v=f.clone(G);t=u/(u-t);p=f.multiplyAndAdd(K,t,n)}}}else{p=f.clone(n);u=u/q;v=f.multiplyAndAdd(h,u,G)}}J=f.squaredLength(f.sub(v,p));if((D!==undefined)&&(J>D)){return y}}if((D===undefined)||(J<D)){y.squaredDistance=J;y.distance=Math.sqrt(J);if(H){y.relationship=(y.distance<b)?d.Relationship.COINCIDENT:d.Relationship.PARRALLEL;y.angle=0}else{y.relationship=(y.distance<b)?d.Relationship.INTERSECTING:d.Relationship.NONE;y.angle=f.angle(K,h)}y.aPosition1=p;y.aPosition2=v;y.returnCode=0}}return y},computeSegmentTriangleSquaredDistance:function(C,B,o,n,l,z){var s={};s.returnCode=1;if(C&&B&&o&&n&&l){s.returnCode=2;var D=(z!==undefined)?z:Number.MAX_VALUE;if(D>e){var k;var h;var r=false;var F=f.sub(o,n);var E=f.sub(o,l);var t=f.cross(F,E);if(!f.normalize(t)){t=f.multiply(t,1000)}var v=f.sub(o,C);var u=f.sub(o,B);var p=f.dot(t,v);var m=f.dot(t,u);if(((p>0)&&(m<0))||((p<0)&&(m>0))){var g=f.sub(C,B);var A=c.computeLinePlaneDistance(C,g,o,t);if((A.returnCode===0)&&(A.aPosition)){A=a.computePointTriangleDistance(A.aPosition,o,n,l,D);if((A.returnCode!==2)&&(A.relationship===d.Relationship.COINCIDENT)){D=A.squaredDistance;k=f.clone(A.aPosition);h=f.clone(A.aPosition);r=true}}}if(!r){var q=[C,B];var w=[o,n,l,o];var A;for(var y=0;(y<3)&&(D>e);y++){A=a.computeTwoSegmentsDistance(C,B,w[y],w[y+1],D);if(A.returnCode!==2){D=A.squaredDistance;k=f.clone(A.aPosition1);h=f.clone(A.aPosition2);r=true}}for(var x=0;(x<2)&&(D>e);x++){A=a.computePointTriangleDistance(q[x],o,n,l,D);if(A.returnCode!==2){D=A.squaredDistance;k=f.clone(q[x]);h=f.clone(A.aPosition);r=true}}}if(r){s.returnCode=0;s.squaredDistance=D;s.aPosition1=k;s.aPosition2=h;s.angle=0;s.relationship=(s.squaredDistance<e)?d.Relationship.INTERSECTING:d.Relationship.NONE}}}return s},computeTwoTrianglesSquaredDistance:function(k,h,g,u,t,s,o){var y={};y.returnCode=1;if(k&&h&&u&&t&&s){y.returnCode=2;var x=(o!==undefined)?o:Number.MAX_VALUE;if(x>e){var l=[k,h,g,k];var w=[u,t,s,u];var n;var m;var v=false;var q;for(var r=0;(r<3)&&(x>e);r++){q=a.computeSegmentTriangleSquaredDistance(l[r],l[r+1],u,t,s,x);if(q.returnCode!==2){x=q.squaredDistance;n=f.clone(q.aPosition1);m=f.clone(q.aPosition2);v=true}}for(var p=0;(p<3)&&(x>e);p++){q=a.computeSegmentTriangleSquaredDistance(w[p],w[p+1],k,h,g,x);if(q.returnCode!==2){x=q.squaredDistance;n=f.clone(q.aPosition2);m=f.clone(q.aPosition1);v=true}}if(v){y.returnCode=0;y.squaredDistance=x;y.aPosition1=n;y.aPosition2=m;y.angle=0;y.relationship=d.Relationship.NONE}}}return y}};return a});define("DS/WebPolyMaths/WebMeshMeasure",["DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsFiniteGeometry","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebMeshRecognition"],function(f,c,b,d){var e=0.000001;var a={computePointMeshSquaredDistance:function(n,h,o,g){var q={};var i;q.returnCode=1;var j=h&&h.group&&h.group.geometry&&(h.start!==undefined)&&(h.count!==undefined)&&(h.count>0);if(j){var l=h.count;var p=h.group.glType;var m=d.extractMeshVertices(h,o.elements);var k=(p===1)?l/2:l/3;if(p===1){i=a._computePointCurveSquaredDistance(n,k,m,g)}else{if(p===4){i=a._computePointSurfaceSquaredDistance(n,k,m,g)}}}return i},computeTwoMeshesSquaredDistance:function(u,o,t,k,n){var i={};var h;i.returnCode=1;var s=u&&u.group&&u.group.geometry&&(u.start!==undefined)&&(u.count!==undefined)&&(u.count>0);var r=t&&t.group&&t.group.geometry&&(t.start!==undefined)&&(t.count!==undefined)&&(t.count>0);if(s&&r){var m=u.count;var x=u.group.glType;var g=d.extractMeshVertices(u,o.elements);var q=(x===1)?m/2:m/3;var l=t.count;var v=t.group.glType;var w=d.extractMeshVertices(t,k.elements);var p=(v===1)?l/2:l/3;if(x===1){if(v===1){h=a._computeTwoCurvesSquaredDistance(q,g,p,w,n)}else{if(v===4){h=a._computeCurveSurfaceSquaredDistance(q,g,p,w,n)}}}else{if(x===4){if(v===1){h=a._computeCurveSurfaceSquaredDistance(p,w,q,g,n);var j=h.aPosition1;h.aPosition1=h.aPosition2;h.aPosition2=j}else{if(v===4){h=a._computeSurfaceSurfaceSquaredDistance(q,g,p,w,n)}}}}}return h},_computePointCurveSquaredDistance:function(m,q,o,g){var s={};s.returnCode=1;if((q!==undefined)&&o){s.returnCode=2;var r=(g)?g:Number.MAX_VALUE;var h;var p=b.computeAABBForPoint(m);for(var n=0;(n<q)&&(r>e);n++){var l=b.computeAABBForSegment(o[2*n],o[2*n+1]);var k=b.computeAABBSquaredDistance(p,l);if(k<r){var j=c.computePointSegmentDistance(m,o[2*n],o[2*n+1],r);if(j.returnCode!==2){s.returnCode=0;r=j.squaredDistance;h=f.clone(j.aPosition)}}}if(s.returnCode===0){s.squaredDistance=r;s.aPosition1=m;s.aPosition2=h}}return s},_computePointSurfaceSquaredDistance:function(m,q,o,g){var s={};s.returnCode=1;if((q!==undefined)&&o){s.returnCode=2;var r=(g)?g:Number.MAX_VALUE;var h;var p=b.computeAABBForPoint(m);for(var n=0;(n<q)&&(r>e);n++){var l=b.computeAABBForTriangle(o[3*n],o[3*n+1],o[3*n+2]);var k=b.computeAABBSquaredDistance(p,l);if(k<r){var j=c.computePointTriangleDistance(m,o[3*n],o[3*n+1],o[3*n+2],r);if(j.returnCode!==2){s.returnCode=0;r=j.squaredDistance;h=f.clone(j.aPosition)}}}if(s.returnCode===0){s.squaredDistance=r;s.aPosition1=m;s.aPosition2=h}}return s},_computeTwoCurvesSquaredDistance:function(l,u,h,t,g){var w={};w.returnCode=1;if((l!==undefined)&&u&&(h!==undefined)&&t){w.returnCode=2;var v=(g)?g:Number.MAX_VALUE;var m;var k;for(var s=0;(s<l)&&(v>e);s++){var r=b.computeAABBForSegment(u[2*s],u[2*s+1]);for(var q=0;(q<h)&&(v>e);q++){var p=b.computeAABBForSegment(t[2*q],t[2*q+1]);var o=b.computeAABBSquaredDistance(r,p);if(o<v){var n=c.computeTwoSegmentsDistance(u[2*s],u[2*s+1],t[2*q],t[2*q+1],v);if(n.returnCode!==2){w.returnCode=0;v=n.squaredDistance;m=f.clone(n.aPosition1);k=f.clone(n.aPosition2)}}}}if(w.returnCode===0){w.squaredDistance=v;w.aPosition1=m;w.aPosition2=k}}return w},_computeCurveSurfaceSquaredDistance:function(k,u,s,t,g){var w={};w.returnCode=1;if((k!==undefined)&&u&&(s!==undefined)&&t){w.returnCode=2;var v=(g)?g:Number.MAX_VALUE;var l;var h;for(var r=0;(r<k)&&(v>e);r++){var q=b.computeAABBForSegment(u[2*r],u[2*r+1]);for(var p=0;(p<s)&&(v>e);p++){var o=b.computeAABBForTriangle(t[3*p],t[3*p+1],t[3*p+2]);var n=b.computeAABBSquaredDistance(q,o);if(n<v){var m=c.computeSegmentTriangleSquaredDistance(u[2*r],u[2*r+1],t[3*p],t[3*p+1],t[3*p+2],v);if(m.returnCode!==2){w.returnCode=0;v=m.squaredDistance;l=f.clone(m.aPosition1);h=f.clone(m.aPosition2)}}}}if(w.returnCode===0){w.squaredDistance=v;w.aPosition1=l;w.aPosition2=h}}return w},_computeSurfaceSurfaceSquaredDistance:function(p,g,o,A,u){var q={};q.returnCode=1;if((p!==undefined)&&g&&(o!==undefined)&&A){q.returnCode=2;var z=(u)?u:Number.MAX_VALUE;var r=[];var n;var m;var y;var x;if(p>o){n=p;m=o;y=g;x=A}else{n=o;m=p;y=A;x=g}var k;var h;for(var v=0;(v<n)&&(z>e);v++){var s=b.computeAABBForTriangle(y[3*v],y[3*v+1],y[3*v+2]);for(var t=0;(t<m)&&(z>e);t++){if(r[t]===undefined){r[t]=b.computeAABBForTriangle(x[3*t],x[3*t+1],x[3*t+2])}var l=b.computeAABBSquaredDistance(s,r[t]);if(l<z){var w=c.computeTwoTrianglesSquaredDistance(y[3*v],y[3*v+1],y[3*v+2],x[3*t],x[3*t+1],x[3*t+2],z);if(w.returnCode!==2){q.returnCode=0;z=w.squaredDistance;k=f.clone(w.aPosition1);h=f.clone(w.aPosition2)}}}}if(q.returnCode===0){q.squaredDistance=z;if(p>o){q.aPosition1=k;q.aPosition2=h}else{q.aPosition1=h;q.aPosition2=k}}}return q}};return a});define("DS/WebPolyMaths/WebMeshIntersection",["DS/WebPolyMaths/WebToolsMaths","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebMeshRecognition","DS/WebPolyMaths/WebMeshMeasure","DS/Visualization/ThreeJS_DS"],function(i,d,j,e,l,c,h){var b=0.001;var f=0.000001;var g=0.02;var k=0.0004;var a={computeSectionCurves:function(I,t,r){var D={};D.returnCode=2;D.nbIntersections=0;D.nbTotTriangles=0;D.aPolylines2D=[];var G=[r[12],r[13],r[14]];var F=[r[8],r[9],r[10]];var y=-d.dot(G,F);var S=I.count;var B=I.start;var v=I.group.geometry;var C=v.vertexIndexArray;var s=v.vertexPositionArray;var q;var n;var m;var z;var x;var R=[0,0,0];var Q=[0,0,0];var P=[0,0,0];var H=[];var N=[0,0,0,0,0,0];var E=S/3;for(var M=0;M<E;M++){D.nbTotTriangles++;z=B+3*M;x=3*C[z];R[0]=s[x];R[1]=s[x+1];R[2]=s[x+2];x=3*C[z+1];Q[0]=s[x];Q[1]=s[x+1];Q[2]=s[x+2];x=3*C[z+2];P[0]=s[x];P[1]=s[x+1];P[2]=s[x+2];q=R[0]*F[0]+R[1]*F[1]+R[2]*F[2]+y;n=Q[0]*F[0]+Q[1]*F[1]+Q[2]*F[2]+y;m=P[0]*F[0]+P[1]*F[1]+P[2]*F[2]+y;var w=0;var u=0;if(q>0){if(n>0){if(m<=0){w=1}}else{if(m>0){w=2}else{w=1;u=2}}}else{if(n>0){if(m>0){w=1}u=2}else{if(m>0){w=1}}}if((w!==0)||(u!==0)){D.nbIntersections++;var A=3-w-u;var p;if(A===0){p=a._computeIntersectionTrianglePlane(R,Q,P,G,F,N)}else{if(A===1){p=a._computeIntersectionTrianglePlane(Q,P,R,G,F,N)}else{p=a._computeIntersectionTrianglePlane(P,R,Q,G,F,N)}}if(p&&(p.length===2)){H.push([p[0],p[1]])}}}if(H.length>0){D.returnCode=0;a._mergePolylines(H);for(var L=0;L<H.length;L++){a._simplifyPolylinePerpendicularDistance(H[L],k,N)}var o=H.length;for(var K=0;K<o;K++){var O=H[K].length;for(var J=0;J<O;J++){H[K][J]=d.transformPoint(H[K][J],t,H[K][J])}D.aPolylines2D[K]=H[K]}}return D},_computeIntersectionTrianglePlane:function(E,D,C,s,u,z){var q;var p=z||[0,0,0,0,0,0];p[0]=E[0]-D[0];p[1]=E[1]-D[1];p[2]=E[2]-D[2];p[3]=E[0]-C[0];p[4]=E[1]-C[1];p[5]=E[2]-C[2];var y=p[0]*u[0]+p[1]*u[1]+p[2]*u[2];var x=p[3]*u[0]+p[4]*u[1]+p[5]*u[2];if((Math.abs(y)>b)&&(Math.abs(x)>b)){var o=((s[0]-E[0])*u[0]+(s[1]-E[1])*u[1]+(s[2]-E[2])*u[2]);var B=o/y;var A=o/x;var w=p[0]*B;var v=p[1]*B;var t=p[2]*B;var r=p[3]*A;var n=p[4]*A;var m=p[5]*A;if((Math.abs(w-r)>b)||(Math.abs(v-n)>b)||(Math.abs(t-m)>b)){q=[];q[0]=[w+E[0],v+E[1],t+E[2]];q[1]=[r+E[0],n+E[1],m+E[2]]}}return q},_mergePolylines:function(m){var r=true;var q;var o;var z;var y;var p;var n;var w;var v;while(r){r=false;for(var u=0;u<m.length;u++){q=m[u][0];o=m[u][m[u].length-1];for(var t=u+1;t<m.length;t++){z=m[t][0];y=m[t][m[t].length-1];p=((q[0]-z[0])*(q[0]-z[0]))+((q[1]-z[1])*(q[1]-z[1]))+((q[2]-z[2])*(q[2]-z[2]));if(p<f){for(var s=1,x=m[t].length;s<x;s++){m[u].unshift(m[t][s])}q=m[u][0];m.splice(t,1);r=true;t--}else{n=((q[0]-y[0])*(q[0]-y[0]))+((q[1]-y[1])*(q[1]-y[1]))+((q[2]-y[2])*(q[2]-y[2]));if(n<f){for(var s=m[t].length-2;0<=s;s--){m[u].unshift(m[t][s])}q=m[u][0];m.splice(t,1);r=true;t--}else{w=((o[0]-z[0])*(o[0]-z[0]))+((o[1]-z[1])*(o[1]-z[1]))+((o[2]-z[2])*(o[2]-z[2]));if(w<f){for(var s=1,x=m[t].length;s<x;s++){m[u].push(m[t][s])}o=m[u][m[u].length-1];m.splice(t,1);r=true;t--}else{v=((o[0]-y[0])*(o[0]-y[0]))+((o[1]-y[1])*(o[1]-y[1]))+((o[2]-y[2])*(o[2]-y[2]));if(v<f){for(var s=m[t].length-2;0<=s;s--){m[u].push(m[t][s])}o=m[u][m[u].length-1];m.splice(t,1);r=true;t--}}}}}}}},_simplifyPolylinePerpendicularDistance:function(q,t,s){var m=s||[0,0,0,0,0,0];var v;var u;var r;var w;var x;var o;for(var p=1;p<q.length-1;p++){v=q[p-1];u=q[p];r=q[p+1];m[0]=r[0]-v[0];m[1]=r[1]-v[1];m[2]=r[2]-v[2];w=m[0]*m[0]+m[1]*m[1]+m[2]*m[2];if(w>f){x=((u[0]-v[0])*m[0]+(u[1]-v[1])*m[1]+(u[2]-v[2])*m[2])/w;m[3]=m[0]*x+v[0]-u[0];m[4]=m[1]*x+v[1]-u[1];m[5]=m[2]*x+v[2]-u[2];o=(m[3]*m[3])+(m[4]*m[4])+(m[5]*m[5]);if(o<t){for(var n=p+1;n<q.length;n++){q[n-1]=q[n]}q.length=q.length-1;p--}}}},detectTwoMeshesInterference:function(u,m,t,A,p){var C=1;var B=u&&u.group&&u.group.geometry&&(u.start!==undefined)&&(u.count!==undefined)&&(u.count>0);var z=t&&t.group&&t.group.geometry&&(t.start!==undefined)&&(t.count!==undefined)&&(t.count>0);if(B&&z){C=0;var s=u.group.glType;var r=t.group.glType;if((s===4)&&(r===4)){var w=u.count;var y=l.extractMeshVertices(u,m.elements);var q=w/3;var v=t.count;var x=l.extractMeshVertices(t,A.elements);var o=v/3;var n=c._computeSurfaceSurfaceSquaredDistance(q,y,o,x,p);C=((n.returnCode===0)&&(n.squaredDistance<f))?2:0}}return C},computeRayIntersection:function(o,t,r,s,v){var u=new h.Ray(o,t);var m=u.intersectMeshInstances({object:r},s,u.origin,1);var p=m[0].object.id;var n=[];for(var q=0;q<m.length;q++){if(p===m[q].object.id){n.push(m[q])}}if(v){return n}else{return n[0]}}};return a});define("DS/WebPolyMaths/WebToolsMeasure",["DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebToolsSceneGraph","DS/WebPolyMaths/WebMeshRecognition","DS/WebPolyMaths/WebMeshMeasure","DS/WebPolyMaths/WebToolsMaths","DS/WebPolyMaths/WebMeasureEnums","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement","DS/Visualization/SubElement"],function(f,k,m,e,i,l,c,j,b,h,d,a){var g=0.000001;var n={measureItem:function(x,A,q,u){var p={};var s;if(u&&u===true){s=new Date().getTime()}var y=x.getPathElement();var v;var o=x.getLevel();if(o){p.product=y.getElement(o-1);v=i.truncatePathElement(y,o)}else{v=i.getLastReference(y);p.product=v.getLastElement()}var w=x.getType();if(((A!==undefined)&&(A===b.ViewedType.POINT))||(w===m.GeometryType.POINT)||(w===m.GeometryType.PICKINGPT)){p.type=m.GeometryType.POINT;p.position=x.getPoint();if(!p.position){p.position=x.getSelPoint()}}else{if((A)&&(A===b.ViewedType.PRODUCT)){p.type=m.GeometryType.PRODUCT;p.position=x.getSelPoint();p.aabb=n.retrieveProductAABB(p.product,v.getWorldMatrix());var r=n.measureProduct(x,u);p.volume=r.volume;p.cog=r.cog}else{if(w===m.GeometryType.LINE){p.type=w;p.length=x.getLength();var z=x.getPoints();p.point1=z.beginPoint;p.point2=z.endPoint;p.position=p.point1.clone().add(p.point2).multiplyScalar(0.5)}else{if(w===m.GeometryType.CIRCLE){p.type=w;p.length=x.getLength();p.position=x.getSelPoint();p.radius=x.getRadius();p.center=x.getCenter();p.normal=x.getAxis()}else{if(w===m.GeometryType.CYLINDER){p.type=w;p.area=x.getArea();p.cog=x.getCoG();p.position=x.getSelPoint();p.radius=x.getRadius();var z=x.getPoints();p.point1=z.beginPoint;p.point2=z.endPoint}else{if(w===m.GeometryType.CONE){p.type=w;p.area=x.getArea();p.cog=x.getCoG();p.position=x.getSelPoint();p.apex=x.getApex();p.semiAngle=x.getSemiAngle();p.axis=x.getAxis();var z=x.getPoints();p.point1=z.beginPoint;p.point2=z.endPoint}else{if(w===m.GeometryType.SPHERE){p.type=w;p.area=x.getArea();p.cog=x.getCoG();p.position=x.getSelPoint();p.radius=x.getRadius();p.center=x.getCenter()}else{if(w===m.GeometryType.PLANE){p.type=w;p.area=x.getArea();p.cog=x.getCoG();p.position=x.getSelPoint();var t=x.getPlane();p.origin=t.origin;p.normal=t.normal}else{if(w===m.GeometryType.CURVE){p.type=w;p.length=x.getLength();p.position=x.getSelPoint()}else{if(w===m.GeometryType.SURFACE){p.type=w;p.area=x.getArea();p.cog=x.getCoG();p.position=x.getSelPoint()}}}}}}}}}}if(u&&u===true){console.log("PCS measureItem="+(new Date().getTime()-s))}return p},measureProduct:function(J){var s={};var I=J.getPathElement();var r;var q=J.getLevel();if(q){r=i.truncatePathElement(I,q)}else{r=i.getLastReference(I)}var C=i.getRenderables(r);var p=0;var o=[0,0,0];var u=[0,0,0];var D=C.length;for(var H=0;H<D;H++){var v=C[H].matrix.elements;var z=C[H].geometry;var B=z.length;for(var G=0;G<B;G++){var K=z[G].drawingGroups;var t=K.length;for(var F=0;F<t;F++){if((K[F].geomType==="FACE")){var w=K[F].primitives.length;for(var E=0;E<w;E++){var x=new a(K[F].primitives[E]);if(x.getDimension()==="volume"){var y=l._computeVolume(K[F].primitives[E],u);p+=y.volume;var A=e.transformPoint(y.aCog,v);o=e.multiplyAndAdd(A,y.volume,o)}}}}}}s.volume=(p>0)?p:0;o=(j.isZero(p))?[0,0,0]:e.multiply(o,1/p);s.cog=new h.Vector3(o[0],o[1],o[2]);return s},measureBetween:function(s,y,r,w,t){var p={};if(((y===b.ViewedType.POINT)||(y===b.ViewedType.AXIS)||(y===b.ViewedType.CENTER)||(y===b.ViewedType.INFPLANE))&&((w===b.ViewedType.POINT)||(w===b.ViewedType.AXIS)||(w===b.ViewedType.CENTER)||(w===b.ViewedType.INFPLANE))){p=n.measureBetweenInfinite(s,y,r,w)}else{if((y===b.ViewedType.PRODUCT)||(w===b.ViewedType.PRODUCT)){var A=Number.MAX_VALUE;if(s.getSelPoint()&&r.getSelPoint()){var B=f.computeTwoPointsDistance(s.getSelPoint().toArray(),r.getSelPoint().toArray());A=B.distance*B.distance}if((y===b.ViewedType.PRODUCT)&&(w===b.ViewedType.PRODUCT)){p=n.measureBetweenWithProducts(n.MeasuredType.PRODUCT,s,r,A,t);p.type1=y;p.type2=w}else{if((y===b.ViewedType.PRODUCT)&&((w===m.GeometryType.POINT)||(w===b.ViewedType.CENTER))){p=n.measureBetweenWithProducts(n.MeasuredType.POINT,r,s,A,t);p.type1=y;p.type2=b.ViewedType.POINT;var z=p.aPosition1;p.aPosition1=p.aPosition2;p.aPosition2=z;var z=p.product1;p.product1=p.product2;p.product2=z}else{if((w===b.ViewedType.PRODUCT)&&((y===m.GeometryType.POINT)||(y===b.ViewedType.CENTER))){p=n.measureBetweenWithProducts(n.MeasuredType.POINT,s,r,A,t);p.type1=b.ViewedType.POINT;p.type2=w}else{if(y===b.ViewedType.PRODUCT){p=n.measureBetweenWithProducts(n.MeasuredType.MESH,r,s,A,t);p.type1=n.MeasuredType.MESH;p.type2=n.MeasuredType.MESH;var z=p.aPosition1;p.aPosition1=p.aPosition2;p.aPosition2=z;var z=p.product1;p.product1=p.product2;p.product2=z}else{p=n.measureBetweenWithProducts(n.MeasuredType.MESH,s,r,A,t);p.type1=n.MeasuredType.MESH;p.type2=n.MeasuredType.MESH}}}}p.distance=Math.sqrt(p.squaredDistance)}else{if(((y===b.ViewedType.POINT)||(y===b.ViewedType.CENTER))&&((w===b.ViewedType.CURVE)||(w===b.ViewedType.SURFACE)||(w===b.ViewedType.CIRCLE)||(w===b.ViewedType.CYCOSP))){var o=(y===b.ViewedType.CENTER)?s.getCenter().toArray():s.getSelPoint().toArray();p=c.computePointMeshSquaredDistance(o,r.getPrimitive(),r.getReferentialPosition());p.type1=b.ViewedType.POINT;p.type2=n.MeasuredType.MESH}else{if(((w===b.ViewedType.POINT)||(w===b.ViewedType.CENTER))&&((y===b.ViewedType.CURVE)||(y===b.ViewedType.SURFACE)||(y===b.ViewedType.CIRCLE)||(y===b.ViewedType.CYCOSP))){var o=(w===b.ViewedType.CENTER)?r.getCenter().toArray():r.getSelPoint().toArray();p=c.computePointMeshSquaredDistance(o,s.getPrimitive(),s.getReferentialPosition());p.type1=n.MeasuredType.MESH;p.type2=b.ViewedType.POINT;var q=p.aPosition1;p.aPosition1=p.aPosition2;p.aPosition2=q}else{p=c.computeTwoMeshesSquaredDistance(s.getPrimitive(),s.getReferentialPosition(),r.getPrimitive(),r.getReferentialPosition());p.type1=n.MeasuredType.MESH;p.type2=n.MeasuredType.MESH}}p.distance=Math.sqrt(p.squaredDistance)}}if(p.type1===n.MeasuredType.MESH){var u=s.getType();if((u===m.GeometryType.CURVE)||(u===m.GeometryType.LINE)||(u===m.GeometryType.CIRCLE)){p.type1=b.ViewedType.CURVE}else{p.type1=b.ViewedType.SURFACE}}if(p.type2===n.MeasuredType.MESH){var u=r.getType();if((u===m.GeometryType.CURVE)||(u===m.GeometryType.LINE)||(u===m.GeometryType.CIRCLE)){p.type2=b.ViewedType.CURVE}else{p.type2=b.ViewedType.SURFACE}}if(p.product1===undefined){var x=s.getPathElement();if(x){p.product1=i.getLastReference(x).getLastElement()}}if(p.product2===undefined){var v=r.getPathElement();if(v){p.product2=i.getLastReference(v).getLastElement()}}if(p.aPosition1){p.position1=new h.Vector3(p.aPosition1[0],p.aPosition1[1],p.aPosition1[2])}if(p.aPosition2){p.position2=new h.Vector3(p.aPosition2[0],p.aPosition2[1],p.aPosition2[2])}if(p.aExtension){p.extensionDirection=new h.Vector3(p.aExtension[0],p.aExtension[1],p.aExtension[2])}return p},measureThreepoints:function(w,t,r){var o={};var u=w.getSelPoint();var s=t.getSelPoint();var p=r.getSelPoint();if(u&&s&&p){var B=u.toArray();var A=s.toArray();var z=p.toArray();var q=e.sub(B,A);var D=e.sub(A,z);o.angle=Math.PI-e.angle(q,D);var x=e.cross(q,D);o.normal=new h.Vector3(x[0],x[1],x[2]);var E;if(e.areEqual(B,A)){E=e.multiply(e.add(B,z),0.5)}else{if(e.areEqual(B,z)){E=e.multiply(e.add(B,A),0.5)}else{if(e.areEqual(A,z)){E=e.multiply(e.add(B,A),0.5)}else{var C=e.squaredLength(x);if(C>g){var v=(0.5*e.squaredLength(D)+0.5*e.dot(q,D))/C;var y=e.multiplyAndAdd(q,0.5,B);var E=e.multiplyAndAdd(e.cross(q,x),-v,y)}}}}if(E!==undefined){o.radius=e.subAndLength(E,B);o.center=new h.Vector3(E[0],E[1],E[2])}}return o},measureBetweenInfinite:function(t,C,s,A){var p={};var z=[t,s];var B=[{_selectedType:C},{_selectedType:A}];for(var v=0;v<2;v++){var y=z[v].getType();B[v].realType=y;if(B[v]._selectedType===b.ViewedType.POINT){B[v].type=m.GeometryType.POINT;B[v].position=z[v].getSelPoint()}else{if((y===m.GeometryType.POINT)||(y===m.GeometryType.PICKINGPT)){B[v].type=m.GeometryType.POINT;B[v].position=z[v].getPoint()}else{if(y===m.GeometryType.LINE){B[v].type=m.GeometryType.LINE;var D=z[v].getPoints();B[v].position=z[v].getSelPoint();B[v].direction=D.endPoint.sub(D.beginPoint)}else{if(y===m.GeometryType.CIRCLE){if(B[v]._selectedType===b.ViewedType.CENTER){B[v].type=m.GeometryType.POINT;B[v].position=z[v].getCenter()}else{B[v].type=m.GeometryType.LINE;B[v].position=z[v].getCenter();B[v].direction=z[v].getAxis()}}else{if(y===m.GeometryType.CYLINDER){B[v].type=m.GeometryType.LINE;var D=z[v].getPoints();B[v].position=D.beginPoint;B[v].direction=D.endPoint.sub(D.beginPoint)}else{if(y===m.GeometryType.CONE){B[v].type=m.GeometryType.LINE;var D=z[v].getPoints();B[v].position=D.beginPoint;B[v].direction=D.endPoint.sub(D.beginPoint)}else{if(y===m.GeometryType.SPHERE){B[v].type=m.GeometryType.POINT;B[v].position=z[v].getCenter()}else{if(y===m.GeometryType.PLANE){B[v].type=m.GeometryType.PLANE;var w=z[v].getPlane();B[v].origin=z[v].getSelPoint();B[v].normal=w.normal}}}}}}}}}var r=B[0];var q=B[1];var u=false;if(((B[0].type===m.GeometryType.LINE)&&(B[1].type===m.GeometryType.PLANE))||(B[0].type===m.GeometryType.POINT)||(B[0].type===m.GeometryType.PICKINGPT)){r=B[1];q=B[0];u=true}var E;var o=[];var x=[];if(r.type===m.GeometryType.PLANE){x[0]=b.ViewedType.INFPLANE;if(q.type===m.GeometryType.PLANE){x[1]=b.ViewedType.INFPLANE;E=f.computeTwoPlanesDistance(r.origin.toArray(),r.normal.toArray(),q.origin.toArray(),q.normal.toArray());if(E&&(E.returnCode===0)){p.distance=E.distance;p.angle=(E.angle>Math.PI/2)?Math.PI-E.angle:E.angle;p.relationship=E.relationship;if(E.relationship===m.Relationship.INTERSECTING){o[0]=e.clone(E.aPosition1);o[1]=e.clone(E.aPosition2)}else{o[0]=r.origin.toArray();o[1]=E.aPosition2}}}else{if(q.type===m.GeometryType.LINE){x[1]=b.ViewedType.AXIS;E=f.computeLinePlaneDistance(q.position.toArray(),q.direction.toArray(),r.origin.toArray(),r.normal.toArray());if(E&&(E.returnCode===0)){p.distance=E.distance;p.angle=(E.angle>Math.PI/2)?Math.PI-E.angle:E.angle;p.relationship=E.relationship;if(E.relationship===m.Relationship.INTERSECTING){o[0]=E.aPosition;o[1]=E.aPosition}else{o[0]=E.aPosition;o[1]=q.position.toArray()}p.aExtension=q.direction.toArray()}}else{x[1]=b.ViewedType.POINT;E=f.computePointPlaneDistance(q.position.toArray(),r.origin.toArray(),r.normal.toArray());if(E&&(E.returnCode===0)){p.distance=E.distance;p.relationship=E.relationship;o[0]=E.aPosition;o[1]=q.position.toArray()}}}}else{if(r.type===m.GeometryType.LINE){x[0]=b.ViewedType.AXIS;if(q.type===m.GeometryType.LINE){x[1]=b.ViewedType.AXIS;E=f.computeTwoLinesDistance(r.position.toArray(),r.direction.toArray(),q.position.toArray(),q.direction.toArray());if(E&&(E.returnCode===0)){p.distance=E.distance;p.angle=(E.angle>Math.PI/2)?Math.PI-E.angle:E.angle;p.relationship=E.relationship;if((E.relationship===m.Relationship.INTERSECTING)||(E.relationship===m.Relationship.NONE)){o[0]=E.aPosition1;o[1]=E.aPosition2;p.aExtension=e.sub(r.position.toArray(),E.aPosition1)}else{o[0]=r.position.toArray();o[1]=E.aPosition2;if((r.realType===m.GeometryType.CIRCLE)||(r.realType===m.GeometryType.CYLINDER)||(r.realType===m.GeometryType.CONE)||(r.realType===m.GeometryType.SPHERE)){p.aExtension=q.direction.toArray()}else{p.aExtension=e.sub(q.position.toArray(),E.aPosition2)}}}}else{x[1]=b.ViewedType.POINT;E=f.computePointLineDistance(q.position.toArray(),r.position.toArray(),r.direction.toArray());if(E&&(E.returnCode===0)){p.distance=E.distance;p.relationship=E.relationship;o[0]=E.aPosition;o[1]=q.position.toArray();p.aExtension=e.sub(r.position.toArray(),E.aPosition)}}}else{x[0]=b.ViewedType.POINT;x[1]=b.ViewedType.POINT;o[0]=r.position.toArray();o[1]=q.position.toArray();E=f.computeTwoPointsDistance(o[0],o[1]);if(E&&(E.returnCode===0)){p.distance=E.distance;p.relationship=E.relationship}}}if(u){p.aPosition1=o[1];p.aPosition2=o[0];p.type1=x[1];p.type2=x[0]}else{p.aPosition1=o[0];p.aPosition2=o[1];p.type1=x[0];p.type2=x[1]}return p},measureBetweenWithProducts:function(J,C,B,Q,N){var y={};var A;if(N&&N===true){A=new Date().getTime()}var E=(Q)?Q:Number.MAX_VALUE;y.squaredDistance=E;var P=(J===n.MeasuredType.PRODUCT);var r;var w=C.getPathElement();var H;var X=C.getLevel();if(X){r=w.getElement(X-1);H=i.truncatePathElement(w,X)}else{H=i.getLastReference(w);r=H.getLastElement()}var q;var v=B.getPathElement();var o;var U=B.getLevel();if(U){q=v.getElement(U-1);o=i.truncatePathElement(v,U)}else{o=i.getLastReference(v);q=o.getLastElement()}var ad=false;if(P){var Y=H.externalPath.length;var W=o.externalPath.length;var R;var p;var ac;if(Y<W){R=Y;p=o;ac=H}else{R=W;p=H;ac=o}ad=true;for(var ab=0;ad&&(ab<R);ab++){ad=(p.externalPath[ab]===ac.externalPath[ab])}}if(ad){y.squaredDistance=0;y.aPosition1=C.getSelPoint().toArray();y.aPosition2=y.aPosition1;y.product1=r;y.product2=q}else{if(N&&N===true){if(P){console.log("Measure Products: "+r.name+" / "+q.name)}else{console.log("Measure Products: "+J+" / "+q.name)}}var t=[];var S=[];var M=[];var L=[];t.push(H);S.push(o);var z;if(!P){if(J===n.MeasuredType.MESH){z=n.retrieveMeshPrimitivesAndAABB(C)}else{z=k.computeAABBForPoint(C.getSelPoint().toArray())}}var x;var u=!P;var s;var O;for(var ab=0;ab<t.length;ab++){if(P){z=n.retrieveProductAABB(t[ab].getLastElement(true),C.getReferentialPosition())}x=n.retrieveProductAABB(S[ab].getLastElement(true),B.getReferentialPosition());O=k.computeAABBSquaredDistance(z,x);if(O<E){if(P){u=i.isLeaf(t[ab].getLastElement(true))}s=i.isLeaf(S[ab].getLastElement(true));if(u&&s){if(P){M.push(t[ab])}else{M.push(C)}L.push(S[ab])}else{if(u||(!s&&(t[ab].getLastElement(true).bSphere.radius<S[ab].getLastElement(true).bSphere.radius))){var D=S[ab].getChildrenPathes();var G=D.length;for(var aa=0;aa<G;aa++){if(i.isReferenceOrInstance(D[aa].getLastElement())){if(P){t.push(t[ab])}else{t.push(C)}S.push(D[aa])}}}else{var D=t[ab].getChildrenPathes();var G=D.length;for(var aa=0;aa<G;aa++){if(i.isReferenceOrInstance(D[aa].getLastElement())){t.push(D[aa]);S.push(S[ab])}}}}}}var I=M.length;var K=new Date().getTime()-A;for(var Z=0;Z<I;Z++){var V;if(P){V=M[Z]}else{V=M[Z]}var T=L[Z];var F=n.measureBetweenWithParts(J,V,T,E,N);if(F.squaredDistance<E){E=F.squaredDistance;y=F;y.product1=M[Z];y.product2=L[Z]}}if(X||!P){y.product1=r}if(U){y.product2=q}if(N&&N===true){console.log("Measure Products: Parts Couples="+I+" Scan duration="+K+" Duration="+(new Date().getTime()-A))}}return y},measureBetweenWithParts:function(t,r,p,q,u){var s;switch(t){case n.MeasuredType.PRODUCT:var w=n.retrievePartPrimitivesAndAABB(r);var o=r.getWorldMatrix();break;case n.MeasuredType.MESH:var w=n.retrieveMeshPrimitivesAndAABB(r);var o=r.getReferentialPosition();break;case n.MeasuredType.POINT:var w={};w.primitives=[];w.primitives[0]=r.getSelPoint().toArray();w.AABB=[];w.AABB[0]=k.computeAABBForPoint(w.primitives[0]);var o=null;break}var v=n.retrievePartPrimitivesAndAABB(p);var x=p.getWorldMatrix();s=n.measureBetweenPrimitivesAABB(t,w,o,v,x,q,u);return s},retrieveProductAABB:function(r,o){var p=[];var q=r.bBox.clone().applyMatrix4(o);p[0]=q.min.x;p[1]=q.min.y;p[2]=q.min.z;p[3]=q.max.x;p[4]=q.max.y;p[5]=q.max.z;return p},retrievePartPrimitivesAndAABB:function(z){var C={};C.primitives=[];var x=i.getRenderables(z);var p=x.length;for(var w=0;w<p;w++){var q=x[w].geometry;var B=q.length;for(var v=0;v<B;v++){var r=q[v].drawingGroups;var o=r.length;for(var u=0;u<o;u++){if(r[u].geomType==="FACE"){var A=r[u].primitives.length;for(var t=0;t<A;t++){C.primitives.push(r[u].primitives[t])}}}}}C.AABB=[];var y=z.getWorldMatrix().elements;var A=C.primitives.length;for(var s=0;s<A;s++){C.AABB[s]=l.computeAABB(C.primitives[s],y)}return C},retrieveMeshPrimitivesAndAABB:function(p){var o={};o.primitives=[];o.primitives.push(p.getPrimitive());o.AABB=[];o.AABB[0]=l.computeAABB(p.getPrimitive(),p.getReferentialPosition().elements);return o},measureBetweenPrimitivesAABB:function(w,p,A,H,y,C,q){var r={};var x=new Date().getTime();var G=(C)?C:Number.MAX_VALUE;r.squaredDistance=G;var s=[];var o=0;var t;var F=p.primitives.length;var E=H.primitives.length;for(var D=0;D<F;D++){for(var B=0;B<E;B++){t=k.computeAABBSquaredDistance(p.AABB[D],H.AABB[B]);if(t<G){s[o]=[D,B,t];o++}}}var z=s.length;var u=0;if(w===n.MeasuredType.POINT){for(var D=0;(D<z)&&(G>g);D++){if(s[D][2]<G){var v=c.computePointMeshSquaredDistance(p.primitives[s[D][0]],H.primitives[s[D][1]],y,G);if(v.squaredDistance<G){G=v.squaredDistance;r=v}u++}}}else{for(var D=0;(D<z)&&(G>g);D++){if(s[D][2]<G){var v=c.computeTwoMeshesSquaredDistance(p.primitives[s[D][0]],A,H.primitives[s[D][1]],y,G);if(v.squaredDistance<G){G=v.squaredDistance;r=v}u++}}}if(q&&q===true){console.log("Measure Parts: Primitives Couples="+F*E+" ("+F+"-"+E+")  Candidates="+s.length+"  MeasuredCandidates="+u+"  duration="+(new Date().getTime()-x))}return r}};n.MeasuredType={POINT:0,MESH:1,PRODUCT:2};return n});define("DS/WebPolyMaths/WebMeasurable",["DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebMeshRecognition","DS/WebPolyMaths/WebToolsMeasure","DS/WebPolyMaths/WebMeasureEnums","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement"],function(g,f,a,b,d,e){var c=UWA.Class.extend({init:function(l,m){if(!m){this._bRealPathElement=false;if(l.pathElement){this._pathElement=l.pathElement.clone();this._bRealPathElement=true}else{this._matrix=(l.position)?l.position.clone():new d.Matrix4()}if(l.selpoint){var i=new d.Matrix4().getInverse(this._getMatrix());this._selPosition=l.selpoint.clone().applyMatrix4(i)}if(l.selnormal){var i=new d.Matrix4().getInverse(this._getMatrix());this._selNormal=l.selnormal.clone().transformDirection(i)}var h;if(l.canonic){h=l.canonic;h.exact=true;h.returnCode=0;this._length=l.canonic.length;this._cog=l.canonic.cog;this._area=l.canonic.area}else{if(l.primitive){this._SGPrimitive=l.primitive;if(l.bAvoidRecognition){h={returnCode:1}}else{h=f.recognizeCanonicGeometry(this._SGPrimitive,new d.Matrix4(),true)}}}if(h.returnCode===0){this._type=h.type;switch(h.type){case g.GeometryType.POINT:case g.GeometryType.PICKINGPT:this._selectedType=b.ViewedType.POINT;this._position=h.position;if(!this._selPosition){this._selPosition=h.position.clone()}break;case g.GeometryType.LINE:this._selectedType=b.ViewedType.AXIS;this._point1=h.point1;this._point2=h.point2;if(!this._selPosition){this._selPosition=this._point1.clone()}break;case g.GeometryType.CIRCLE:this._selectedType=b.ViewedType.CIRCLE;this._center=h.center;this._radius=h.radius;this._normal=h.normal;if(!this._selPosition){this._selPosition=this._center.clone()}break;case g.GeometryType.PLANE:this._selectedType=b.ViewedType.INFPLANE;this._origin=h.origin;this._normal=h.normal;if(!this._selPosition){this._selPosition=this._origin.clone()}break;case g.GeometryType.CYLINDER:this._selectedType=b.ViewedType.CYCOSP;this._radius=h.radius;this._point1=h.point1;this._point2=h.point2;if(!this._selPosition){this._selPosition=this._point1.clone()}break;case g.GeometryType.CONE:this._selectedType=b.ViewedType.CYCOSP;this._apex=h.apex;this._semiAngle=h.semiAngle;this._axis=h.axis;this._point1=h.point1;this._point2=h.point2;if(!this._selPosition){this._selPosition=this._point1.clone()}break;case g.GeometryType.SPHERE:this._selectedType=b.ViewedType.CYCOSP;this._radius=h.radius;this._center=h.center;if(!this._selPosition){this._selPosition=this._center.clone()}break}this._mode=(h.exact)?g.Mode.EXACT:g.Mode.FACETTED}else{switch(this._SGPrimitive.group.glType){case 1:this._type=g.GeometryType.CURVE;this._selectedType=b.ViewedType.CURVE;var j=f.extractMeshVertices(this._SGPrimitive);var k=j.length-1;this._point1=new d.Vector3(j[0][0],j[0][1],j[0][2]);this._point2=new d.Vector3(j[k][0],j[k][1],j[k][2]);if(!this._selPosition){this._selPosition=this._point1.clone()}break;case 4:this._type=g.GeometryType.SURFACE;this._selectedType=b.ViewedType.SURFACE;var j=f.extractMeshVertices(this._SGPrimitive);if(!this._selPosition){this._selPosition=new d.Vector3(j[0][0],j[0][1],j[0][2])}break}this._mode=g.Mode.FACETTED}}return this},clone:function(){var h=new c({},true);h._type=this._type;h._mode=this._mode;if(this._SGPrimitive){h._SGPrimitive=this._SGPrimitive}if(this._pathElement){h._pathElement=this._pathElement.clone()}if(this._bRealPathElement){h._bRealPathElement=this._bRealPathElement}if(this._selPosition){h._selPosition=this._selPosition}if(this._selNormal){h._selNormal=this._selNormal}if(this._position){h._position=this._position}if(this._point1){h._point1=this._point1.clone()}if(this._point2){h._point2=this._point2.clone()}if(this._origin){h._origin=this._origin.clone()}if(this._normal){h._normal=this._normal.clone()}if(this._center){h._center=this._center.clone()}if(this._apex){h._apex=this._apex.clone()}if(this._axis){h._axis=this._axis.clone()}if(this._radius){h._radius=this._radius}if(this._semiAngle){h._semiAngle=this._semiAngle}if(this._length){h._length=this._length}if(this._area){h._area=this._area}if(this._cog){h._cog=this._cog}if(this._selectedType){h._selectedType=this._selectedType}return h},getType:function(){return this._type},getMode:function(){return this._mode},getPrimitive:function(){return this._SGPrimitive},getPathElement:function(){var h=(this._bRealPathElement)?this._pathElement.clone():new e();return h},setLevel:function(h){this._level=h},getLevel:function(){return this._level},setReferentialPosition:function(h){if(!this._bRealPathElement&&h&&h instanceof d.Matrix4){this._matrix=h.clone()}},getReferentialPosition:function(){return this._getMatrix().clone()},getPoint:function(){var h=null;if(this._type===g.GeometryType.POINT){h=this._position.clone().applyMatrix4(this._getMatrix())}return h},getPoints:function(){var h=null;if((this._type===g.GeometryType.LINE)||(this._type===g.GeometryType.CURVE)||(this._type===g.GeometryType.CYLINDER)||(this._type===g.GeometryType.CONE)){h={};h.beginPoint=this._point1.clone().applyMatrix4(this._getMatrix());h.endPoint=this._point2.clone().applyMatrix4(this._getMatrix())}return h},getPlane:function(){var h=null;if(this._type===g.GeometryType.PLANE){h={};h.origin=this._origin.clone().applyMatrix4(this._getMatrix());h.normal=this._normal.clone().transformDirection(this._getMatrix())}return h},getRadius:function(){var h=null;if((this._type===g.GeometryType.CIRCLE)||(this._type===g.GeometryType.CYLINDER)||(this._type===g.GeometryType.SPHERE)){h=this._radius}return h},getCenter:function(){var h=null;if((this._type===g.GeometryType.CIRCLE)||(this._type===g.GeometryType.SPHERE)){h=this._center.clone().applyMatrix4(this._getMatrix())}return h},getAxis:function(){var h=null;if(this._type===g.GeometryType.CIRCLE){h=this._normal.clone().transformDirection(this._getMatrix())}else{if((this._type===g.GeometryType.LINE)||(this._type===g.GeometryType.CYLINDER)||(this._type===g.GeometryType.CONE)){h=this._point2.clone().sub(this._point1).normalize().transformDirection(this._getMatrix())}}return h},getAngle:function(){var h=null;if(this._type===g.GeometryType.CIRCLE){h=Math.PI*2}return h},getSemiAngle:function(){var h=null;if(this._type===g.GeometryType.CONE){h=this._semiAngle}return h},getApex:function(){var h=null;if(this._type===g.GeometryType.CONE){h=this._apex.clone().applyMatrix4(this._getMatrix())}return h},getLength:function(){var h=null;if((this._type===g.GeometryType.LINE)||(this._type===g.GeometryType.CIRCLE)||(this._type===g.GeometryType.CURVE)){if(!this._length){this._complete()}h=this._length}return h},getCoG:function(){var h=null;if((this._type===g.GeometryType.SURFACE)||(this._type===g.GeometryType.CYLINDER)||(this._type===g.GeometryType.SPHERE)||(this._type===g.GeometryType.CONE)||(this._type===g.GeometryType.PLANE)){if(!this._cog){this._complete()}h=this._cog.clone().applyMatrix4(this._getMatrix())}return h},getArea:function(){var h=null;if((this._type===g.GeometryType.SURFACE)||(this._type===g.GeometryType.CYLINDER)||(this._type===g.GeometryType.SPHERE)||(this._type===g.GeometryType.CONE)||(this._type===g.GeometryType.PLANE)){if(!this._area){this._complete()}h=this._area}return h},getVolume:function(){var h=null;if(!this.volume){var i=a.measureProduct(this);this.volume=i.volume}h=this.volume;return h},getSelPoint:function(){var h=this._selPosition.clone().applyMatrix4(this._getMatrix());return h},getSelNormal:function(){var h=this._selNormal.clone().transformDirection(this._getMatrix());return h},computeMinimumDistance:function(j){var h={};h.returnCode=1;if(j){var i=a.measureBetween(this,this._selectedType,j,j._selectedType);if(i.position1){h.distance=i.distance;h.relationship=i.relationship;h.position1=i.position1;h.position2=i.position2;h.returnCode=0}}return h},computeAngle:function(j){var h={};h.returnCode=1;if(j){var i=a.measureBetween(this,this._selectedType,j,j._selectedType);if(i.position1){h.angle=i.angle;h.returnCode=0}}return h},exportData:function(){var h={};h.canonic={};h.canonic.type=this._type.toString();h.canonic.mode=this._mode.toString();h.canonic.selectedType=this._selectedType.toString();h.canonic.matrix=this._matrix4ToStr(this._getMatrix());switch(this._type){case g.GeometryType.POINT:case g.GeometryType.PICKINGPT:h.canonic.position=this._vector3ToStr(this._position);break;case g.GeometryType.LINE:h.canonic.point1=this._vector3ToStr(this._point1);h.canonic.point2=this._vector3ToStr(this._point2);if(!this._length){this._complete()}h.canonic.length=this._length.toString();break;case g.GeometryType.CIRCLE:h.canonic.center=this._vector3ToStr(this._center);h.canonic.radius=this._radius.toString();h.canonic.normal=this._vector3ToStr(this._normal);if(!this._length){this._complete()}h.canonic.length=this._length.toString();break;case g.GeometryType.PLANE:h.canonic.origin=this._vector3ToStr(this._origin);h.canonic.normal=this._vector3ToStr(this._normal);if(!this._cog||!this._area){this._complete()}h.canonic.cog=this._vector3ToStr(this._cog);h.canonic.area=this._area.toString();break;case g.GeometryType.CYLINDER:h.canonic.radius=this._radius.toString();h.canonic.point1=this._vector3ToStr(this._point1);h.canonic.point2=this._vector3ToStr(this._point2);if(!this._cog||!this._area){this._complete()}h.canonic.cog=this._vector3ToStr(this._cog);h.canonic.area=this._area.toString();break;case g.GeometryType.CONE:h.canonic.apex=this._vector3ToStr(this._apex);h.canonic.semiAngle=this._semiAngle.toString();h.canonic.axis=this._vector3ToStr(this._axis);h.canonic.point1=this._vector3ToStr(this._point1);h.canonic.point2=this._vector3ToStr(this._point2);if(!this._cog||!this._area){this._complete()}h.canonic.cog=this._vector3ToStr(this._cog);h.canonic.area=this._area.toString();break;case g.GeometryType.SPHERE:h.canonic.radius=this._radius.toString();h.canonic.center=this._vector3ToStr(this._center);if(!this._cog||!this._area){this._complete()}h.canonic.cog=this._vector3ToStr(this._cog);h.canonic.area=this._area.toString();break;case g.GeometryType.SURFACE:if(!this._cog||!this._area){this._complete()}h.canonic.cog=this._vector3ToStr(this._cog);h.canonic.area=this._area.toString();break;case g.GeometryType.CURVE:if(!this._length){this._complete()}h.canonic.length=this._length.toString();h.canonic.point1=this._vector3ToStr(this._point1);h.canonic.point2=this._vector3ToStr(this._point2);break}h.selpoint=this._vector3ToStr(this._selPosition);if(this._selNormal){h.selnormal=this._vector3ToStr(this._selNormal)}return h},_vector3ToStr:function(h){return h.x.toString()+" "+h.y.toString()+" "+h.z.toString()},_matrix4ToStr:function(h){var i=h.elements;return i[0].toString()+" "+i[1].toString()+" "+i[2].toString()+" "+i[3].toString()+" "+i[4].toString()+" "+i[5].toString()+" "+i[6].toString()+" "+i[7].toString()+" "+i[8].toString()+" "+i[9].toString()+" "+i[10].toString()+" "+i[11].toString()+" "+i[12].toString()+" "+i[13].toString()+" "+i[14].toString()},importData:function(h){this._type=parseInt(h.canonic.type,10);this._mode=parseInt(h.canonic.mode,10);this._bRealPathElement=false;this._pathElement={};this._matrix=(h.canonic.matrix)?this._strTomatrix4(h.canonic.matrix):new d.Matrix4();if(h.selpoint){this._selPosition=this._strToVector3(h.selpoint)}if(h.selnormal){this._selNormal=this._strToVector3(h.selnormal)}if(h.canonic.position){this._position=this._strToVector3(h.canonic.position)}if(h.canonic.point1){this._point1=this._strToVector3(h.canonic.point1)}if(h.canonic.point2){this._point2=this._strToVector3(h.canonic.point2)}if(h.canonic.origin){this._origin=this._strToVector3(h.canonic.origin)}if(h.canonic.normal){this._normal=this._strToVector3(h.canonic.normal)}if(h.canonic.center){this._center=this._strToVector3(h.canonic.center)}if(h.canonic.apex){this._apex=this._strToVector3(h.canonic.apex)}if(h.canonic.axis){this._axis=this._strToVector3(h.canonic.axis)}if(h.canonic.radius){this._radius=parseFloat(h.canonic.radius)}if(h.canonic.semiAngle){this._semiAngle=parseFloat(h.canonic.semiAngle)}if(h.canonic.length){this._length=parseFloat(h.canonic.length)}if(h.canonic.area){this._area=parseFloat(h.canonic.area)}if(h.canonic.cog){this._cog=this._strToVector3(h.canonic.cog)}if(h.canonic.selectedType){this._selectedType=parseInt(h.canonic.selectedType)}return this},_strToVector3:function(h){var i=h.split(" ");return new d.Vector3(parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2]))},_strTomatrix4:function(h){var j=new d.Matrix4();var m=j.elements;var k=h.split(" ");for(var l=0;l<16;l++){m[l]=parseFloat(k[l])}return j},print:function(j){var h=(j!==undefined)?j:"Measurable";console.log(h);switch(this._type){case g.GeometryType.POINT:console.log("    type=POINT point=("+this._position.x+", "+this._position.y+", "+this._position.z+")");break;case g.GeometryType.CURVE:console.log("    type=CURVE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case g.GeometryType.LINE:console.log("    type=LINE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case g.GeometryType.CIRCLE:console.log("    type=CIRCLE radius="+this._radius+" center=("+this._center.x+", "+this._center.y+", "+this._center.z+") normal=("+this._normal.x+", "+this._normal.y+", "+this._normal.z+")");break;case g.GeometryType.SURFACE:console.log("    type=SURFACE area="+this._area+" cog=("+this._cog.x+", "+this._cog.y+", "+this._cog.z+")");break;case g.GeometryType.PLANE:console.log("    type=PLANE origin=("+this._origin.x+", "+this._origin.y+", "+this._origin.z+") normal=("+this._normal.x+", "+this._normal.y+", "+this._normal.z+")");break;case g.GeometryType.CYLINDER:console.log("    type=CYLINDER point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case g.GeometryType.CONE:console.log("    type=CONE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case g.GeometryType.SPHERE:console.log("    type=SPHERE center=("+this._center.x+", "+this._center.y+", "+this._center.z+")");break}var i=this._getMatrix().elements;console.log("    transformation=("+i[0]+", "+i[4]+", "+i[8]+"), ("+i[1]+", "+i[5]+", "+i[9]+"), ("+i[2]+", "+i[6]+", "+i[10]+"), ("+i[3]+", "+i[7]+", "+i[11]+")")},_complete:function(){var h=f.recognizeNonCanonicGeometry(this._SGPrimitive,new d.Matrix4(),true);if((this._type===g.GeometryType.LINE)||(this._type===g.GeometryType.CIRCLE)){this._length=h.length}else{if((this._type===g.GeometryType.PLANE)||(this._type===g.GeometryType.CYLINDER)||(this._type===g.GeometryType.CONE)||(this._type===g.GeometryType.SPHERE)){this._area=h.area;this._cog=h.cog}else{if(this._type===g.GeometryType.CURVE){this._length=h.length}else{this._area=h.area;this._cog=h.cog}}}},_getMatrix:function(){var h=(this._bRealPathElement)?this._pathElement.getWorldMatrix():this._matrix;return h}});return c});