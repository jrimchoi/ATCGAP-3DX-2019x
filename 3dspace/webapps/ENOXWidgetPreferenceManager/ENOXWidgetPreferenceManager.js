define("DS/ENOXWidgetPreferenceManager/js/ENOXWidgetPreferenceConstants",[],function(){var a={};a.xWDGT_PREF_CREDENTIAL="xPref_CREDENTIAL";a.xWDGT_PREF_SHOW_WORK_UNDER="xPref_SHOW_WORK_UNDER";a.xWDGT_PREF_SHOW_PREF_PAGE_AT_START="xPref_SHOW_PREF_PAGE_AT_START";return a});define("DS/ENOXWidgetPreferenceManager/js/ENOXWidgetPreferenceManager",["UWA/Class","DS/WAFData/WAFData","DS/i3DXCompassServices/i3DXCompassServices","DS/ENOXWidgetPreferenceManager/js/ENOXWidgetPreferenceConstants","i18n!DS/ENOXWidgetPreferenceManager/assets/nls/ENOXWidgetPreferenceManager"],function(b,f,a,e,i){var c=".";var k=" ‚óè ";var d=function(l){return{name:l&&l.prefName?l.prefName:e.xWDGT_PREF_CREDENTIAL,type:"list",label:l&&l.prefLabel?l.prefLabel:i.xWDGT_PREF_CREDENTIAL_LABEL,options:[],value:undefined}};var h=function(l,m){console.log("Error: "+l);if(m){throw new Error(l)}};var j=function(l){console.log("Info: "+l)};var g=b.singleton({init:function(l){this._parent(l);this._serviceUrl=null;if(widget){widget.addEvents({endEdit:function(){j("ENOXWidgetPreferenceManager: Widget Preference is edited!!!")}})}},_getCredentialPreference:function(m){var o=this;var n=d(m);if(m===undefined||m.availableContexts===undefined||(m.availableContexts instanceof Array&&m.availableContexts.length<=0)){return o._getServiceUrlHandler().then(function p(){return new UWA.Promise(function(x,z){var t=null;var u;var y=(new Date()).getTime();var r=widget.getValue("x3dPlatformId");var w=(r&&r!=="")?r:"OnPremise";u="/resources/modeler/pno/person?current=true&select=collabspaces";if(m.usePreferredCredentials){u+="&select=preferredcredentials"}u+="&tenant="+w;u+=("&timestamp="+y);var v=function(A){x(A)};var s=function(A){z();h("Unable to get assigned security context for user!")};f.authenticatedRequest(o._serviceUrl+u,{method:"GET",type:"json",async:false,onComplete:v,onFailure:s,timeout:5000})},function q(){h("Unable to get assigned security contexts for user!");reject()})},function l(){h("Unable to get service URL!");reject("Unable to get service URL!")})}else{if(m.availableContexts instanceof Array&&m.availableContexts.length>0){n.options=m.availableContexts;return n}else{if(m.availableContexts instanceof Object&&m.availableContexts.collabspaces!==undefined){n.options=this._getAssignedSecurityContextsFromResponse(m.availableContexts);return n}}}},addCredentialPreferenceToWidget:function(r,q){var n=this;var m=r?r:{};m=UWA.merge(m,{availableContexts:undefined,prefName:e.xWDGT_PREF_CREDENTIAL,prefLabel:i.xWDGT_PREF_CREDENTIAL_LABEL});if(widget){var l=this._getCredentialPreference(m);if(l instanceof UWA.Promise){j("_getCredentialPreference > returned Promise!!!");return l.then(function p(u){var t=n._getAssignedSecurityContextsFromResponse(u,{usePreferredCredentials:m.usePreferredCredentials||false});j("_getCredentialPreference > Promise is Resolved!!!");if(t&&t instanceof Array&&t.length>0){var s=d(m);if(t[0]._iampreferred){delete t[0]._iampreferred;s.value=t[0].value}s.options=t;n._helperAddCredentialPrefToWidget(s,q)}return UWA.Promise.resolve()},function o(){h(" Unable to get assigned security contexts!");return UWA.Promise.reject()})}else{if(l!=undefined&&l!=null){n._helperAddCredentialPrefToWidget(l,q);return UWA.Promise.resolve()}}}else{h(" Widget is undefined!",false)}return UWA.Promise.reject("ENOXWidgetPreferenceManager: Something went wrong in Credential Preference addition to Widget!")},addShowWorkUnderPreferenceToWidget:function(l){this._addBooleanPreferenceToWidget({prefName:l&&l.prefName?l.prefName:e.xWDGT_PREF_SHOW_WORK_UNDER,prefLabel:l&&l.prefLabel?l.prefLabel:i.xWDGT_PREF_SHOW_WORK_UNDER_LABEL,prefDefValue:l&&l.prefDefValue?l.prefDefValue:undefined})},addShowPreferencesAtStartPreferenceToWidget:function(l){this._addBooleanPreferenceToWidget({prefName:l&&l.prefName?l.prefName:e.xWDGT_PREF_SHOW_PREF_PAGE_AT_START,prefLabel:l&&l.prefLabel?l.prefLabel:i.xWDGT_PREF_SHOW_PREF_PAGE_AT_START,prefDefValue:l&&l.prefDefValue?l.prefDefValue:undefined})},_addBooleanPreferenceToWidget:function(l){if(widget&&l&&l.prefName!=undefined&&l.prefLabel!=undefined){widget.addPreference({name:l.prefName,type:"boolean",label:l.prefLabel,defaultValue:(l.prefDefValue!=undefined&&typeof(l.prefDefValue)=="boolean")?l.prefDefValue:false})}else{h(" Widget is undefined!",true)}},_getAssignedSecurityContextsFromResponse:function(w){if(w){var m=[];var y=w.collabspaces||undefined;var q=w.preferredcredentials||undefined;var x=undefined;var A=false;if(y&&UWA.is(y,"array")){for(var v=0,p=y.length;v<p;v++){var r=y[v];if(UWA.is(r.couples,"array")){var n=r.couples;for(var u=0,t=n.length;u<t;u++){var s=n[u];if(x===undefined){x=s.organization.name}if(x!==s.organization.name){A=true;break}}}}}var o=undefined;if(q){var B=q.collabspace?q.collabspace.name:"";var l=q.organization?q.organization.name:"";var C=q.role?q.role.name:"";var z=q.role?q.role.nls:C;o={label:A?B+k+l+k+z:B+k+z,value:C+c+l+c+B,_iampreferred:true}}if(y&&UWA.is(y,"array")){y.forEach(function(E,D){if(UWA.is(E.couples,"array")){E.couples.forEach(function(I){var H=(I.role.nls==undefined||I.role.nls=="")?I.role.name:I.role.nls;var F=I.role.name;var K=I.organization.name;var G=E.name;var J={label:A?G+k+K+k+H:G+k+H,value:F+c+K+c+G};if(o==undefined||o.value!=J.value){m.push(J)}})}else{h(" Proper collab space information is not available in response!",true)}});if(o){m.unshift(o)}}else{h(" Proper collab space information is not available in response!",true)}}else{h(" Incorrect/incomplete response for request to fetch security contexts!",true)}return m},_getServiceUrlHandler:function(){var l=this;return new UWA.Promise(function(o,n){if(l._serviceUrl==null){var m={serviceName:"3DSpace",platformId:widget.getValue("x3dPlatformId"),async:false,onComplete:function(p){if(typeof p==="string"){l._serviceUrl=p}else{l._serviceUrl=p[0].url}o()},onFailure:function(){h(" Unable to get Service URL!",false);n("Error while getting service URL")}};a.getServiceUrl(m)}else{o()}})},getServiceUrl:function(){return this._serviceUrl},_helperAddCredentialPrefToWidget:function(l,o){if(widget&&(l!=undefined||l!=null)){var n=widget.getPreferences();var p=widget.getValue(e.xWDGT_PREF_CREDENTIAL);if(p==undefined||p==""){widget.setValue(e.xWDGT_PREF_CREDENTIAL,l.value);j("Widget does not have credentials, setting preferred credentials for it.")}else{if(l.value&&p!=l.value){l.value=p;j("Widget has credentials from previous session, setting it as a 'value' for the preference object being added to widget.")}}j("Current Preferences : "+n);if(n&&n instanceof Array&&n.length>0){var m=UWA.is(o,"number")?(o-1):0;n.splice(m,0,l);widget.setPreferences(n)}else{widget.addPreference(l)}}else{h(" Either widget is not defined or input security context preference object is invalid!",true)}},getCredentialPreferenceKey:function(){return e.xWDGT_PREF_CREDENTIAL},getShowWorkUnderPreferenceKey:function(){return e.xWDGT_PREF_SHOW_WORK_UNDER},getShowPreferencesAtStartPreferenceKey:function(){return e.xWDGT_PREF_SHOW_PREF_PAGE_AT_START},});return g});