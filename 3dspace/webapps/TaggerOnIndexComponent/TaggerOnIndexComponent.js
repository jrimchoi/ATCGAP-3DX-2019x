define("DS/TaggerOnIndexComponent/TaggerOnIndexComponent",["UWA/Core","DS/TagNavigatorProxy/TagNavigatorProxy","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI"],function(i,k,b,g,j){var a={};var f={};var c="";b.getPlatformServices({onComplete:function(n){var m=n[0];c=m["3DSearch"]+"/search"}});function l(n){var m=new Date();var o="";if(n){if(typeof n==="string"){n=n.replace(/\&#x2f;/g,"/");n=n.replace(/\&#x3a;/g,":");n=n.replace(/\u200E/g,"")}m=new Date(n);o=m.getFullYear()+"/"+(m.getMonth()+1)+"/"+m.getDate()}return o}function h(o){var n;var s={};var q=o.results;var p="";var r={};var m=[];if(q){q.forEach(function(u){n=u.attributes;p="";r={};m=[];for(var t=0;t<n.length;t++){if(n[t].format=="internal"){if(n[t].name=="resourceid"){p=n[t].value}}else{if(n[t].dispValue||n[t].type=="date"){r={object:(n[t].type=="date")?l(n[t].value):n[t].value,sixw:n[t].name,field:n[t].field,dispValue:(n[t].type=="date")?"NONE_NEEDED":n[t].dispValue,type:n[t].type};m.push(r)}}}s[p]=m})}return s}function d(s,n,m,p){var q="";for(var o=0;o<m.length;o++){if(o>0){q+=" OR "}q+='physicalid:"'+m[o]+'"'}var r=widget.getUrl()+"-"+j.getUser().login+"-"+Date.now();if(i.typeOf(n.onTagFilterChange)==="function"){if(!a[s]){a[s]=k.createProxy({id:s,widgetId:widget.id,filteringMode:"WithFilteringServices",colorize:n.colorize?n.colorize:false,MyFriends:n.MyFriends});if(UWA.is(n.onSetTagProxy,"function")){n.onSetTagProxy()}}a[s].addEvent("onFilterSubjectsChange",n.onTagFilterChange);if(n.colorize&&n.colorize===true){a[s].addEvent("colorize",n.onTagColor);a[s].addEvent("unColorize",n.onTagUncolor)}}g.authenticatedRequest(c,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({query:q,order_by:"asc",order_field:"ds6w:modified",label:r,locale:(widget!=undefined&&widget.lang!=undefined)?widget.lang:"en",nresults:m.length,start:0,tenant:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",with_synthesis:false,select_predicate:["ds6w:created"]}),onComplete:function(w){var v=h(w);if(a[s]){if(p){for(var u in v){if(p[u]){for(var t=0;t<p[u].length;t++){v[u].push((p[u][t]))}}}}if(!f[s]){f[s]={}}for(var u in v){f[s][u]=v[u]}e.publishTags(s)}},onFailure:function(t){console.log("Tagger service Error : ");console.log(t)}})}var e={setTagProxy:function(t,q,m,r){if(!a){a={}}var s=this;Object.keys(a).forEach(function(u){if(a[u]&&u!==t&&((q.MyFriends==undefined)||q.MyFriends.indexOf(u)===-1)){s.deactivate(u)}});if(a[t]){a[t].unsetTags();f[t]={};a[t].activate()}if(m.length>330){var p=Math.floor(m.length/330);for(var o=0;o<p;o++){var n=m.slice(o*330,(o+1)*330);d(t,q,n,r)}if(m.length%330>0){var n=m.slice(p*330);d(t,q,n,r)}}else{d(t,q,m,r)}},getTagProxy:function(m){if(a[m]){return a[m]}else{return null}},publishTags:function(m){if(a[m]&&a[m]._attributes.isAlive===true){a[m].setSubjectsTags(f[m])}},filterTags:function(p,o){if(a[p]&&a[p]._attributes.isAlive===true){if(f[p]){var m={};if(o&&o.length>0){for(var n=0;n<o.length;n++){if(f[p].hasOwnProperty(o[n])){m[o[n]]=f[p][o[n]]}}}a[p].setSubjectsTags(m)}}},killTagProxy:function(m){if(a[m]){a[m].unsetTags();a[m].die();a[m]=undefined;f[m]=undefined;delete a[m];delete f[m]}},killAllTagProxy:function(){var m=this;Object.keys(a).forEach(function(n){m.killTagProxy(n)})},activate:function(m){if(a[m]){a[m].activate()}},deactivate:function(m){if(a[m]){a[m].deactivate()}},unsetTags:function(m){if(a[m]){a[m].unsetTags()}}};return e});