define("DS/MPFCartQuoteComponent/CartQuoteDownloadLink",["UWA/Core","UWA/Class/View","DS/UIKIT/Spinner","DS/MPFCartQuoteModel/CartQuoteModel","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFError/BadArgumentError","i18n!DS/MPFCartQuoteComponent/assets/nls/CartQuoteComponent","css!DS/MPFCartQuoteComponent/MPFCartQuoteComponent"],function(e,a,c,i,f,g,d){var j;var b;var h;b={ACTIVE:"ACTIVE",LOADING:"LOADING"};h=[{from:b.ACTIVE,to:b.LOADING},{from:b.LOADING,to:b.ACTIVE}];j=a.extend({tagName:"div",className:"mpf-cart-quote",setup:function(k){if(!(i.prototype.isPrototypeOf(this.model))){throw new g("model must be a CartQuoteModel")}this.quote=this.model;this.label=k.label||d.get("downloadQuote");this.stateMachine=new f({state:b.ACTIVE,states:[b.ACTIVE,b.LOADING],transitions:h});this.downloadLink=e.createElement("a",{"class":"mpf-link",target:"_blank",text:this.label,events:{click:this.downloadQuote.bind(this)}});this.loader=new c()},render:function(){if(this.stateMachine.getState()===b.LOADING){this.container.setContent(this.loader);this.loader.show()}else{this.container.setContent(this.downloadLink)}return this},downloadQuote:function(l){var k=this;e.Event.stop(l);this.stateMachine.changeState(b.LOADING);this.render();return this.quote.fetchPromise().then(function(){k.container.setAttributes({href:k.quote.getUrl()});window.open(k.quote.getUrl())})["catch"](function(m){console.log(m)})["finally"](function(){k.stateMachine.changeState(b.ACTIVE);k.render()})}});return j});