define("DS/VCXWebProducts/VCXCameraPlayModeCmd",["DS/ApplicationFrame/CommandCheckHeader"],function(a){var b=a.extend({init:function(c){this._parent(c,{});var d=this;this.onStateChange(function(){var f=d.getFrameWindow();var e=f._experienceBase;if(e){var g=e.getManager("VCXVisuManager");if(g){if(d.getState()){g.setUpdateViewport(true)}else{g.setUpdateViewport(false)}}}});this.setState(true)},});return b});define("DS/VCXWebProducts/VCXShowAllCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(b,c,a){var d=b.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){var l=this.getFrameWindow();var g=l._experienceBase;var n;var k=g.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence");var h=g.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence",true);var m=[];for(var j=0;j<k.length;++j){var e=k[j].QueryInterface("VCXIVisibility");if(e){n=e.GetVisibility();if(n!==a.EVisState.Hidden){}else{m.push(k[j])}}}for(var j=0;j<h.length;++j){var e=h[j].QueryInterface("VCXIVisibility");if(e){n=e.GetVisibility();if(n!==a.EVisState.Hidden){}else{m.push(h[j])}}}if(m.length===0){return}var f=new c(g.getManager("VCXScenarioManager"),g.ComponentsMap,g.getManager("VCXCommandManager"));f.ChangeVisibility(m,a.EVisState.Visible);g.getManager("VCXCommandManager").Push(f)},endExecute:function(){}});return d});define("DS/VCXWebProducts/VCXHideSelectionCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(b,c,a){var d=b.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){var k=this.getFrameWindow();var h=k._experienceBase;var f=h.getManager("VCXSelectionManager");var n;var m=f.GetComponentsFromCurrentSelection();var l=[];for(var j=0;j<m.length;++j){var e=m[j].QueryInterface("VCXIVisibility");if(e){n=e.GetVisibility();if(n===a.EVisState.Visible||typeof n==="undefined"){l.push(m[j])}}}if(l.length!==0){var g=new c(h.getManager("VCXScenarioManager"),h.ComponentsMap,h.getManager("VCXCommandManager"));g.ChangeVisibility(l,a.EVisState.Hidden);h.getManager("VCXCommandManager").Push(g)}},endExecute:function(){}});return d});define("DS/VCXWebProducts/VCXPreviewPlayCmd",["UWA/Core","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/Command"],function(d,b,a){var c=a.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:true})},beginExecute:function(){},execute:function(){this.onResume(function(){});this.onPause(function(){})},endExecute:function(){}});return c});define("DS/VCXWebProducts/VCXCloseExperienceCmd",["UWA/Core","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/Command","DS/Controls/Loader","DS/VCXWebComposer/VCXExperienceLoader","DS/VCXWebInteropSMG/VCXSmgXmlLoader","DS/VCXWebInteropSMG/VCXSmgLoader"],function(h,e,c,b,d,a,f){var g=c.extend({init:function(i){this._parent(i,{mode:"exclusive",isAsynchronous:true})},beginExecute:function(){},execute:function(){var n=this;var l=this.getFrameWindow();var i=l.getUIFrame();var k=l._experienceBase;var m=k.getManager("VCXGUIManager").getGettingStartedUI();var j=[];j[0]=function(){var o=k.getManager("VCXContextManager").getContext();var p=e.getCommand("VCXSaveCmd",o);p.callbackOnEnd=function(){if(k&&k.webApplication){var q=k.webApplication;q.requestNewExperienceBaseAsync().then(function(r){n.end()})}};p.begin()};j[1]=function(){if(k&&k.webApplication){var o=k.webApplication;o.requestNewExperienceBaseAsync().then(function(p){n.end()})}};j[2]=function(){n.end()};if(k.getManager("VCXContextManager").getPlayerMode()){j[1]();return}m.displaySaveBeforeClose(j);this.onResume(function(){});this.onPause(function(){})},endExecute:function(){}});return g});define("DS/VCXWebProducts/VCXRedoCmd",["UWA/Core","UWA/Element","DS/ApplicationFrame/Command"],function(d,b,a){var c=a.extend({init:function(e){this._parent(e,{});var f=this;d.Element.addEvent.call(document,"keydown",function(h){var g=d.Event.whichKey(h);if(g==="ctrl+y"){f.begin()}})},beginExecute:function(){},execute:function(){var f=this.getFrameWindow();var e=f._experienceBase;var h=function(){e.getManager("VCXCommandManager").Redo()};var g=e.getManager("VCXExperience")._bPreviewMode;if(g&&e.getManager("VCXPulseManager")){e.getManager("VCXPulseManager").StopPulse(h)}else{h()}},endExecute:function(){}});return c});define("DS/VCXWebProducts/VCXUndoCmd",["UWA/Core","UWA/Element","DS/ApplicationFrame/Command"],function(d,b,a){var c=a.extend({init:function(e){this._parent(e,{});var f=this;d.Element.addEvent.call(document,"keydown",function(h){var g=d.Event.whichKey(h);if(g==="ctrl+z"){f.begin()}})},beginExecute:function(){},execute:function(){var f=this.getFrameWindow();var e=f._experienceBase;var h=function(){e.getManager("VCXCommandManager").Undo()};var g=e.getManager("VCXExperience")._bPreviewMode;if(g&&e.getManager("VCXPulseManager")){e.getManager("VCXPulseManager").StopPulse(h)}else{h()}},endExecute:function(){}});return c});define("DS/VCXWebProducts/VCXShowSelectionCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(b,c,a){var d=b.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){var k=this.getFrameWindow();var h=k._experienceBase;var f=h.getManager("VCXSelectionManager");var n;var m=f.GetComponentsFromCurrentSelection();var l=[];for(var j=0;j<m.length;++j){var e=m[j].QueryInterface("VCXIVisibility");if(e){n=e.GetVisibility();if(n!==a.EVisState.Hidden){}else{l.push(m[j])}}}if(l.length===0){return}var g=new c(h.getManager("VCXScenarioManager"),h.ComponentsMap,h.getManager("VCXCommandManager"));g.ChangeVisibility(l,a.EVisState.Visible);h.getManager("VCXCommandManager").Push(g)},endExecute:function(){}});return d});define("DS/VCXWebProducts/VCXSaveToJSONCmd",["DS/ApplicationFrame/Command","DS/VCXWebComposer/VCXExperienceSaver","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties"],function(c,b,a){var d=c.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:true})},beginExecute:function(){},execute:function(){var g=this;var e=this.getFrameWindow()._experienceBase;var f=function(i){var h=e.getManager("VCXDocManager").actorDocManager;if(h){var j=h.QueryInterface("VCXIModifiable");var l=new a(e.getManager("VCXScenarioManager"));l.CaptureNeutralProperties(j);l.Do()}var k=new b();k.Save(e);g.end()};f(g)},endExecute:function(){}});return d});define("DS/VCXWebProducts/VCXInvertSelectionCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebVisibility/VCXIVisibility"],function(e,b,c,a){var d=b.extend({init:function(f){this._parent(f,{});var g=this;e.Element.addEvent.call(document,"keydown",function(i){var h=e.Event.whichKey(i);if(h==="ctrl+i"){g.begin()}})},beginExecute:function(){var f=this.getFrameWindow();this._experienceBase=f._experienceBase},execute:function(){var h=this._experienceBase.getManager("VCXSelectionManager");var g=[];var k=this._experienceBase.ComponentsMap.GetComponentsFromFilterMethod(this._isComponentVisibleInTheScene);var g=[];for(var f=0;f<k.length;++f){var i=k[f];if(!h.isIn(i)){g.push(i)}}var j=new c(h);j.SetComponentsSelection(g);this._experienceBase.getManager("VCXCommandManager").Do(j)},endExecute:function(){this._experienceBase=null},_isComponentVisibleInTheScene:function(g){var f=g.QueryInterface("VCXIVisibility");if(!f||f.GetVisibility()!==a.EVisState.Visible){return false}if(g.IsDressup){var i=["VCXComponentBOM","VCXComponentCamera","VCXComponentCompass","VCXComponentDigger","VCXComponentGround","VCXComponentViewport"];var h=!g.IsKindOf(i);return h}else{if(g.IsKindOf("VCXComponentOccurrenceRenderable")){return true}}return false}});return d});define("DS/VCXWebProducts/VCXTransformFreeDragCmd",["DS/ApplicationFrame/Command","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS"],function(d,a,c,h,b,g,f){var e=d.extend({init:function(i){this._parent(i,{mode:"exclusive",isAsynchronous:true});this._tokens=null},beginExecute:function(){this._experienceBase=this.getFrameWindow()._experienceBase;var i=this._experienceBase.getManager("VCXContextManager");this._viewer=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(!this._tokens){this._tokens={}}this._tokens.pointerDownToken=g.addEvent(this._viewer.canvas,"onPrimaryPointerDownUnique",this._onPointerDownCB());this._tokens.pointerMovePlainToken=a.subscribe({event:"/VISU/onPrimaryPointerMove"},this._onPointerMoveCB())},_onPointerDownCB:function(){var k=this;var j=this._experienceBase.getManager("VCXGUIManager");return function i(q){if(k._tokens.pointerMoveToken&&k._tokens.pointerUpToken){return}var y=k._viewer.getMousePosition(q.from[0].getCurrentPosition(k._viewer.canvas));var m;var r=k._viewer.pick(y,"mesh",true);if(r&&r.path&&r.path.length>0){m=r.path[0].clone()}var l=m&&h.GetModifiableFromPathElement(m,k._experienceBase);if(l){var n=k._experienceBase.getManager("VCXSelectionManager");var p=n.GetComponentsFromCurrentSelection("VCXComponentOccurrenceComposer");var u=n.GetComponentsFromCurrentSelection("VCXComponentOccurrenceRenderable");var t=n.GetComponentsFromCurrentSelection("VCXComponentDressup");if(!l.GetObject().IsKindOf("VCXComponentOccurrenceComposer")){return}var v=[];if(l.GetObject().IsKindOf("VCXComponentOccurrenceComposer")){v=p.map(function(z){return z.QueryInterface("VCXIModifiable")});v=b.filterChildrenOfModsFromArray(v);var s=v.length===0?false:k.checkPickedComponentHasAncestorInArray(l,v);if(!s){if(l.GetObject().IsKindOf("VCXComponentOccurrenceComposer")){v=[l]}}}k._viewer.currentViewpoint.setControlActive({viewpoint:false});k._viewer.setPrePicking({activated:false});var o=r.position.clone();var w=new f.Vector3().subVectors(k._viewer.currentViewpoint.target,k._viewer.currentViewpoint.position).normalize();var x=new f.Plane(w,0).setFromNormalAndCoplanarPoint(w,o);k._initInfos={data:q,pickInfo:r,modifiablesArray:v,plane3D:x,mousePos:y};k._isDragging=false;k._lastPosition=o;j.SetCursor("grabbing");k._experienceBase.getManager("VCXCommandManager").StartTransaction();if(!k._tokens.pointerMoveDragToken){k._tokens.pointerMoveDragToken=a.subscribe({event:"/VISU/onPrimaryPointerMove"},k._translate())}if(!k._tokens.pointerUpToken){k._tokens.pointerUpToken=g.addEvent(k._viewer.canvas,"onPrimaryPointerUpUnique",k._disposeEvents())}}}},_onPointerMoveCB:function(){var k=this;var j=this._experienceBase.getManager("VCXGUIManager");return function i(p){if(k._initInfos){return}var l=k._viewer.getMousePosition(p.from[0].getCurrentPosition(k._viewer.canvas));var o;var m=k._viewer.pick(l,"mesh",true);if(m&&m.path&&m.path.length>0){o=m.path[0].clone()}var n=o&&h.GetModifiableFromPathElement(o,k._experienceBase);if(n&&n.GetObject().IsKindOf("VCXComponentOccurrenceComposer")){j.SetCursor("grab")}else{j.SetCursor("default")}}},_translate:function(){var j=this;return function i(p){if(!j._initInfos||!j._lastPosition){return}var l=j._viewer.getMousePosition(p.from[0].getCurrentPosition(j._viewer.canvas));if(!j._isDragging){var o=j._initInfos.mousePos;var q=Math.max(Math.abs(l.xPix-o.xPix),Math.abs(l.yPix-o.yPix));if(q<3){return}else{j._isDragging=true}}var m=j._viewer.pick(l,"mesh",false);var k=m.ray.intersectPlane(j._initInfos.plane3D);var n=j._initInfos.modifiablesArray;j._translateFromOriginToTarget(j._lastPosition,k,n);j._lastPosition=k.clone()}},_translateFromOriginToTarget:function(p,l,n){var k=new f.Vector3().subVectors(l,p);var o=new c(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"));for(var i=0;i<n.length;++i){var j=n[i];if(!j){continue}var m=b.buildPropertyLocationWithTranslationInWCS(j,k);o.ChangeProperty(n[i],m)}this._experienceBase.getManager("VCXCommandManager").Push(o)},_disposeEvents:function(){var k=this;var j=this._experienceBase.getManager("VCXGUIManager");return function i(n){a.unsubscribe(k._tokens.pointerMoveDragToken);k._tokens.pointerMoveDragToken=null;g.removeEventFromToken(k._tokens.pointerUpToken);k._tokens.pointerUpToken=null;k._experienceBase.getManager("VCXCommandManager").EndTransaction();j.SetCursor("grab");k._viewer.currentViewpoint.setControlActive({viewpoint:true});k._viewer.setPrePicking({activated:true});if(k._experienceBase.odt==="record"&&k._isDragging){var m=k._initInfos.modifiablesArray.map(function(o){return o.GetObject().GetID()});var l={commandName:"VCXTransformFreeDragCmd",componentsIDs:m,origin:k._initInfos.pickInfo.position.createJSON(),target:k._lastPosition.createJSON()};k._experienceBase.getManager("VCXODTManager").LogAPI("VCXExecuteFreeDrag",l)}k._initInfos=null;k._translateCB=null;k._disposeCB=null;k._isDragging=false}},endExecute:function(){if(this._tokens){this._tokens.pointerDownToken&&g.removeEventFromToken(this._tokens.pointerDownToken);this._tokens.pointerMovePlainToken&&a.unsubscribe(this._tokens.pointerMovePlainToken)}this._tokens={};this._lastPosition=null;this._viewer=null;this._experienceBase=null},checkPickedComponentHasAncestorInArray:function(k,n){if(n.includes(k)){return true}var m=k.QueryInterface("VCXIModelNavigable");for(var i=0;i<n.length;++i){var l=n[i];var j=l.QueryInterface("VCXIModelNavigable");if(j.isAncestorOf(m)){return true}}return false},executeFreeDragODT:function(j){var k=j.origin;var m=j.target;var l=this._experienceBase.ComponentsMap.GetComponentsFromIDs(j.componentsIDs);var i=l.map(function(n){return n.QueryInterface("VCXIModifiable")});this._translateFromOriginToTarget(k,m,i)}});return e});define("DS/VCXWebProducts/VCXTransformCmd",["DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/Visualization/ThreeJS_DS","DS/Robot/Robot","DS/CoreEvents/Events"],function(b,c,e,d,a){var f=b.extend({init:function(g){this._parent(g,{mode:"exclusive",isAsynchronous:true});var h=this;this._bChangePositionAtCmdBeginning=true;this._tokenSelectionAdd=null;this._tokenSelectionRemove=null;this._tokenSelectionEmpty=null;a.subscribe({event:"VCX_DONT_CHNG_ROBOT_POS_AT_TRANSFORM_BEGIN"},function(){h._bChangePositionAtCmdBeginning=false})},beginExecute:function(){this._experienceBase=this.getFrameWindow()._experienceBase;this._viewer=this._experienceBase.getManager("VCXContextManager").getMainViewer();var g=this;this._tokenSelectionAdd=a.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},function(){if(g.isRunning()){g._displayPivot()}});this._tokenSelectionRemove=a.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},function(){if(g.isRunning()){g._displayPivot()}});this._tokenSelectionEmpty=a.subscribe({event:"VCX_SELECTED_ACTORS_EMPTY"},function(){if(g.isRunning()){g._displayPivot()}});if(this._bChangePositionAtCmdBeginning){this._displayPivot()}else{this.changeRobotPosAtCmdBeginning(true)}},endExecute:function(){if(this._experienceBase){if(this._tokenSelectionAdd!==null){a.unsubscribe(this._tokenSelectionAdd);this._tokenSelectionAdd=null}if(this._tokenSelectionRemove!==null){a.unsubscribe(this._tokenSelectionRemove);this._tokenSelectionRemove=null}if(this._tokenSelectionEmpty!==null){a.unsubscribe(this._tokenSelectionEmpty);this._tokenSelectionEmpty=null}var i=this._viewer.getRobot();if(!(i instanceof d)){return}i.target=null;i.setConnectionState(false);i.CallBackEventHandlerViewPoint();var h=this._experienceBase.getManager("VCXContextManager").getContext();var g=c.getCommand("VCXMoveRobotOnBBoxCenterCmd",h);g.disable();this._viewer.render()}this._viewer=null;this._experienceBase=null},_displayPivot:function(){var h=this._experienceBase.getManager("VCXSelectionManager");var n=this._viewer.getRobot();if(!(n instanceof d)){console.error("No robot found..");this.end();return}var m=h.GetComponentsFromSelection("CSO");var g=[];for(var j=0;j<m.length;++j){if(m[j].IsKindOf("VCXWebComponentOccurrence")&&!m[j].IsDressup){var p=m[j].QueryInterface("VCXIModifiable");p&&g.push(p)}}var l=this._experienceBase.getManager("VCXContextManager").getContext();var k=c.getCommand("VCXMoveRobotOnBBoxCenterCmd",l);if(Array.isArray(g)&&g.length>0){n.setConnectionState(true);n.fixedSizeNode3D.setRatio(7);n.target=g[0].QueryInterface("W3AISGNodeHolder").getPathElement();var o=this._getNewRobotFrame(g);if(o){n.setRobotMatrix(o);if(!k.isEnabled()){k.enable()}}}else{if(k.isEnabled()){k.disable()}n.target=null;n.setConnectionState(false);n.CallBackEventHandlerViewPoint()}this._viewer.render()},_getNewRobotFrame:function(h){if(h.length===0){console.error("No modifiable specified in the array parameter");return}if(h.length===1&&h[0].GetObject()._ID!=="VCX_Root"){var j=h[0].GetProperty("Actor.Position");var n=j.GetPropertyValue();var o=n.GetPivot().GetValue();var p=h[0].QueryInterface("W3AISGNodeHolder").getPathElement().getParentPath().getWorldMatrix(this._viewer);var m=new e.Matrix4().copy(p).multiply(o);return m}else{var l=null;var k;for(k=0;k<h.length;++k){if(h[k].GetObject()._ID==="VCX_Root"){continue}var o=h[k].GetProperty("Actor.Position").GetPropertyValue().GetPivot().GetValue();var p=h[k].QueryInterface("W3AISGNodeHolder").getPathElement().getParentPath().getWorldMatrix(this._viewer);var m=new e.Matrix4().copy(p).multiply(o);if(l!==null){var g=this._equalMatrices(m,l);if(!g){break}}else{l=m.clone()}}if(k===h.length){return l}else{return new e.Matrix4().setPosition(this._getBBoxInWCS(h).center())}}},changeRobotPosAtCmdBeginning:function(g){if(typeof g!=="boolean"){console.error("A boolean is needed as parameter");return}this._bChangePositionAtCmdBeginning=g},_equalMatrices:function(j,h){if(!(j instanceof e.Matrix4)||!(h instanceof e.Matrix4)){console.error("2 THREE.Matrix4 objects are needed as parameters");return}var g;for(g=0;g<16;++g){if(Math.abs(j.elements[g]-h.elements[g])>0.001){break}}return(g===16)},_getBBoxInWCS:function(j){var h=new e.Box3();for(var k=0;k<j.length;k++){var l=j[k].QueryInterface("W3AISGNodeHolder");var m=l.getPathElement();var g=m.getBoundingBox(null,this._viewer);g.applyMatrix4(l.getWorldMatrix(this._viewer));h.union(g)}return h}});return f});define("DS/VCXWebProducts/VCXOpenCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Controls/Loader","DS/VCXWebComposer/VCXExperienceLoader","DS/VCXWebInteropSMG/VCXSmgXmlLoader","DS/VCXWebInteropSMG/VCXSmgLoader"],function(g,c,b,d,a,e){var f=c.extend({init:function(h){this._parent(h,{mode:"exclusive",isAsynchronous:true})},beginExecute:function(){},execute:function(){var m=this;var i=this.getFrameWindow();var h=i.getUIFrame();if(document.getElementById("VCXOpenFileHiddenButton")===null){var j=new g.Element("input",{name:"Open",id:"VCXOpenFileHiddenButton",styles:{position:"absolute",left:"-99999px",},type:"file",multiple:"multiple",accept:".json,.3dxml,.smgxml,.smg,.smggeom,.urb,.ctxp,.ctps"}).inject(h);document.getElementById("VCXOpenFileHiddenButton").addEventListener("click",function(n){},false);document.getElementById("VCXOpenFileHiddenButton").addEventListener("change",function(n){m.openFile(n);j.destroy()},false)}var l=this;var k=function(){var p=document.createEvent("MouseEvent");p.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);var o=document.getElementById("VCXOpenFileHiddenButton");var n=!o.dispatchEvent(p);if(n){console.log("VCXOpenFileHiddenButton : A handler called preventDefault")}else{}l.end()};k();this.onResume(function(){});this.onPause(function(){})},openFile:function(t,h){var j="";var n="";var l="";var r="";var x=null;var w={};var o="";var s=false;var m=t.target;for(var p=0;p<m.files.length;p++){var v=m.files[p];if(typeof v!=="undefined"){var z=v.name;if(typeof z!=="undefined"){var i=z.slice(z.lastIndexOf(".")+1);i=i.toLowerCase();if(i==="json"||i==="ctps"){j=v}else{if(i==="3dxml"){n=window.URL.createObjectURL(v);w[v.name]=n}else{if(i==="smgxml"){l=v}else{if(i==="smg"||i==="smgs"){r=v}else{if(i==="smggeom"){w[v.name]=v;x=v}else{if((i==="urb")||(i==="ctxp")){o=v;w[v.name]=o;s=true}}}}}}}}}var k=document.getElementsByClassName("wux-windows-docking-element-free-zone wux-docking-element-bottom")[0];var q=new b({text:"Preparing...",showButtonFlag:false});q.inject(k);q.getContent().setStyles({opacity:"1",position:"absolute",bottom:"calc(50% - 100px)",left:"calc(50% - 50px)"});q.on("0%");if(h===undefined){var u=this.getFrameWindow();h=u._experienceBase}if(h&&h.webApplication){var y=h.webApplication;y.requestNewExperienceBaseAsync().then(function(A){var E=A.getManager("VCXGUIManager").getGettingStartedUI();E.startLoadingExperience();WUX.setFullscreen();var F=null;var D=A.getManager("VCXContextManager").getMainViewer();if(Object.keys(w).length!==0){if(A.odt==="record"){if(n!==""){A.getManager("VCXODTManager").SetModelForZip(n)}else{if(x){A.getManager("VCXODTManager").SetModelForZip(x)}}}F=new d();F.Load({experienceBase:A,mapAssets:w,jsonFile:j,urb:s,endCB:function(){q.off();E.endLoadingExperience()}})}else{if(l!==""){var C;smgXmlLoader=new a();smgXmlLoader.Load(A,D,l,true,C)}else{if(r){var B=new e();B._progressBar=q;if(A.odt==="record"){A.getManager("VCXODTManager").SetModelForZip(r)}B.Load(A,D,r,function(){q.off();E.endLoadingExperience()})}else{q.off();E.endLoadingExperience()}}}})}},endExecute:function(){}});return f});define("DS/VCXWebProducts/VCXPlayGuidedTourCmd",["DS/CoreEvents/Events","DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebKernelCommands/VCXCmdPlayScenario"],function(a,c,b,d){var e=c.extend({init:function(f){this._parent(f,{})},beginExecute:function(){},execute:function(){console.log("VCXPlayGuidedTourCmd");var v=this.getFrameWindow();var f=v._experienceBase;var h=f.getManager("VCXScenarioManager");var q=f.getManager("VCXSequenceManager");var r=f.getManager("VCXCommandManager");var n=q.GetListSequencesFromType(0);var m=[];for(var u=0;u<n.length;u++){var p=n[u];var l=p.QueryInterface("VCXIModifiable");var x=p.GetListScenariosId();for(var s=0;s<x.length;s++){var y=x[s];var k=h.GetScenarios()[y];if(k){m.push(k)}}}var o=m.length;console.log("nb sce",o);var t=function(j){if(j>=m.length){return}console.log("callbackPlayScenario",j);var i=new d(h,f.ComponentsMap,r);i.PlayScenario(m[j]);i.SetCallback(g,j);r.Do(i)};var g=function(z){if(z>=m.length-1){a.publish({event:"VCX_PLAY_GUIDED_TOUR_END"});return}var i=f.Factory.BuildComponent("VCXScenario");i.SetPersistency(2);i.SetApplyNeutralAtGoToScenario(false);i.SetMaxFrame(h.GetFPS()*10);console.log("callbackWait",z);var j=new d(h,f.ComponentsMap,r);j.PlayScenario(i);j.SetCallback(w,z+1);r.Do(j)};var w=function(j){if(j>=m.length){return}console.log("callbackGotoScenario",j);var i=new b(h,f.ComponentsMap,r);i.BuildTransitionTo(m[j]);if(j<m.length){i.SetCallback(t,j)}r.Do(i)};a.publish({event:"VCX_PLAY_GUIDED_TOUR_START"});w(0)},endExecute:function(){}});return e});define("DS/VCXWebProducts/VCXShowAllGeometriesCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(b,c,a){var d=b.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){var k=this.getFrameWindow();var h=k._experienceBase;var n;var l=h.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer");var m=[];for(var j=0;j<l.length;++j){var g=l[j];if(g.IsKindOf("VCXComponentCompositePmi")){continue}var e=g.QueryInterface("VCXIVisibility");if(e){n=e.GetVisibility();if(n!==a.EVisState.Hidden){}else{m.push(l[j])}}}if(m.length===0){return}var f=new c(h.getManager("VCXScenarioManager"),h.ComponentsMap,h.getManager("VCXCommandManager"));f.ChangeVisibility(m,a.EVisState.Visible);h.getManager("VCXCommandManager").Push(f)},endExecute:function(){}});return d});define("DS/VCXWebProducts/VCXMoveRobotOnBBoxCenterCmd",["DS/ApplicationFrame/Command","DS/Visualization/ThreeJS_DS","DS/Robot/Robot"],function(a,c,b){var d=a.extend({init:function(e){this._parent(e,{mode:"shared",isAsynchronous:true});this._vcxExperience=null;this.disable()},execute:function(){this._vcxExperience=this.getFrameWindow()._experienceBase;this._displayBBoxCenter()},pauseExecute:function(){},resumeExecute:function(){if(!this.isRunning()){this.end()}},endExecute:function(){this._vcxExperience=null},_displayBBoxCenter:function(){var j=this._vcxExperience.getManager("VCXContextManager").getMainViewer();var g=this._vcxExperience.getManager("VCXSelectionManager");var k=g.GetComponentsFromSelection("CSO");var e=[];for(var h=0;h<k.length;++h){if(k[h].IsKindOf("VCXWebComponentOccurrence")&&!k[h].IsDressup){var n=k[h].QueryInterface("VCXIModifiable");n&&e.push(n)}}if(Array.isArray(e)&&e.length>0){var l=j.getRobot();if(!(l instanceof b)){console.error("No robot found..");this.end();return}l.connect();l.fixedSizeNode3D.setRatio(7);var f=this._getBBoxInWCS(e).center();var m=new c.Matrix4().setPosition(f);l.setRobotMatrix(m);j.render()}this.end()},_getBBoxInWCS:function(g){var f=new c.Box3();for(var h=0;h<g.length;h++){var j=g[h].QueryInterface("W3AISGNodeHolder");var l=j.getPathElement();var k=this._vcxExperience.getManager("VCXContextManager").getMainViewer();var e=l.getBoundingBox(null,k);e.applyMatrix4(j.getWorldMatrix(k));f.union(e)}return f}});return d});define("DS/VCXWebProducts/VCXRestoreActiveViewVisibilityCmd",["DS/ApplicationFrame/Command",],function(a){var b=a.extend({init:function(c){this._parent(c,{})},beginExecute:function(){},execute:function(){var e=this.getFrameWindow();var d=e._experienceBase;var f=d.getManager("VCXScenarioManager").GetCurrentScenario();var c=d.ComponentsMap.GetComponentFromID(f);d.getManager("VCXScenarioManager").ApplyVisibility(c)},endExecute:function(){}});return b});