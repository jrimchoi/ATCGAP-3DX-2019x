/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CATWebUXSlideShow/CATWebUXSlideShowController",["UWA/Core","UWA/Class","DS/CATWebUXComponents/CATWebUXNotification","DS/WebappsUtils/WebappsUtils","DS/VisuEvents/EventsManager","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/ApplicationFrame/CommandsManager","i18n!DS/CATWebUXSlideShow/assets/nls/CATWebUXSlideShow","css!DS/CATWebUXSlideShow/CATWebUXSlideShow.css"],function(l,c,m,h,d,j,f,i,e,a,k){var g=c.extend({init:function(B){this._parent(B);var u=B||{};var z=false;var F=this;var H=new f();var E=u.context,x=E.getViewer();var L,M={},G={},K={};var I,v={},o={};var s="windowed";var A=E.getUIFrame();var w;var r=[];var J=u.params&&u.params.activateRotation;function t(O,N){H.publish({event:O,data:N,context:F})}function C(N){if(N.key==="ArrowLeft"||N.keyCode===37||N.key==="ArrowDown"||N.keyCode===40||N.key==="PageDown"||N.keyCode===34){t("onPreviousSlideCB")}else{if(N.key==="ArrowUp"||N.keyCode===38||N.key==="ArrowRight"||N.keyCode===39||N.key==="PageUp"||N.keyCode===33){t("onNextSlideCB")}else{if(N.key==="Escape"||N.keyCode===27){s="noViewRequested";F.setActiveState(false)}else{if(N.key==="Home"||N.keyCode===36){t("onFirstSlideCB")}else{if(N.key==="End"||N.keyCode===35){t("onLastSlideCB")}}}}}}function D(){if(I){clearTimeout(I);I=0}G.left.setStyles({opacity:null});G.right.setStyles({opacity:null});G.exitSlideShow.setStyles({opacity:null});I=setTimeout(function(){G.left.setStyles({opacity:0});G.right.setStyles({opacity:0});G.exitSlideShow.setStyles({opacity:0})},2000)}function q(){x.currentViewpoint.getControl()._changeState(5)}function y(){x.currentViewpoint.getControl()._changeState(-1)}function p(N){if(N&&N.getId){var O=N.getId();if(r.indexOf(O)!==-1){return}if(O!=="CATWebUXSlideShowPreviousHdr"&&O!=="CATWebUXSlideShowNextHdr"&&O!=="CATWebUXSlideShowExitHdr"){F.setActiveState(false)}else{N.ControllerID=u.id}}}this.getID=function(){return u.id};this.setListOfCommandsAllowed=function(N){if(N&&N.length){r=N}};this.setActiveState=function(S){var P=0;if(z!==S){z=S;if(z){t("onActiveStateModified",{state:z,onBeginSlideShow:function(U){if(U){var V=E.getActionBar();w=V.options.context;i.empty();e.empty();K.left=function(){t("onPreviousSlideCB");D()};G.left=l.createElement("div",{"class":"CATWebUXSlideShowDiv",id:"CATWebUXSlideShowLeftArrowMainDiv"}).inject(A);d.addEvent(G.left,"onPrimaryPointerClick",K.left);M.left=l.createElement("div",{"class":"CATWebUXSlideShowMainDiv"}).inject(G.left);M.left.setStyles({background:'url("'+h.getWebappsAssetUrl("CATWebUXSlideShow","textures/")+'I_PreviousSlideText.png")',backgroundSize:"contain",left:"30px"});M.left.title=k.previousSlide;K.right=function(){t("onNextSlideCB");D()};G.right=l.createElement("div",{"class":"CATWebUXSlideShowDiv",id:"CATWebUXSlideShowRightArrowMainDiv"}).inject(A);d.addEvent(G.right,"onPrimaryPointerClick",K.right);M.right=l.createElement("div",{"class":"CATWebUXSlideShowMainDiv"}).inject(G.right);M.right.setStyles({background:'url("'+h.getWebappsAssetUrl("CATWebUXSlideShow","textures/")+'I_NextSlideText.png")',backgroundSize:"contain",right:"30px"});M.right.title=k.nextSlide;G.exitSlideShow=l.createElement("div",{"class":"CATWebUXSlideShowDiv",id:"CATWebUXSlideShowExitDiv"}).inject(A);G.exitSlideShow.setStyles({background:'url("'+h.getWebappsAssetUrl("CATWebUXSlideShow","textures/")+'I_ExitSlideShowText.png")',backgroundSize:"contain"});K.cross=function(){F.setActiveState(false)};d.addEvent(G.exitSlideShow,"onPrimaryPointerClick",K.cross);G.exitSlideShow.title=k.exitSlideShow;document.addEventListener("keyup",C);d.addEvent(x.canvas,"onPrimaryPointerMoveUnique",D);d.addEvent(x.canvas,"onMouseMove",D);d.addEvent(x.canvas,"onPrimaryPointerClick",D);d.addEvent(x.canvas,"onPrimaryPointerDownUnique",q);d.addEvent(x.canvas,"onPrimaryPointerUpUnique",y);D();var T=localStorage.getItem("CATWebUXSlideShowABPreferences");if(T==="displayed"){V.open()}else{V.close()}E.getContextualUIManager().register({subscriberId:"CATWebUXSlideShow",workbenchName:"CATWebUXSlideShowWkb",module:"CATWebUXSlideShow",context:w,cmdPrefix:"",merge:true,fileName:"CATWebUXSlideShowWkb.xml",onContextualMenuReady:function(){return{cmdList:[{name:"CATWebUXSlideShowPreviousStr",line:1,hdr_list:["CATWebUXSlideShowPreviousHdr"]},{name:"CATWebUXSlideShowNextStr",line:1,hdr_list:["CATWebUXSlideShowNextHdr"]},{name:"CATWebUXSlideShowExitStr",line:1,hdr_list:["CATWebUXSlideShowExitHdr"]}]}}});v.onActionBarOpen=V.onActionBarOpen(function(){localStorage.setItem("CATWebUXSlideShowABPreferences","displayed")});v.onActionBarClose=V.onActionBarClose(function(){localStorage.setItem("CATWebUXSlideShowABPreferences","closed")});o.cmds=a.onCommandStart(p,w);s=window&&window.widget?window.widget.getView().type:null;if(s&&s!=="fullscreen"){window.widget.requestView({type:"fullscreen"})}if(!J&&!x.get2DMode()){x.currentViewpoint.control.setMouseRotationActive(!z);x.currentViewpoint.control.setTouchRotationActive(!z)}}else{z=false;F.displaySlideInformation({type:"error",message:k.slideShowCannotBeLaunched});t("onSlideShowAborted")}}})}else{if(I){clearTimeout(I);I=0}if(G.left){d.removeEvent(G.left,"onPrimaryPointerClick",K.left);A.removeChild(G.left);G.left.destroy();G.left=null}if(G.right){d.removeEvent(G.right,"onPrimaryPointerClick",K.right);A.removeChild(G.right);G.right.destroy();G.right=null}if(G.exitSlideShow){d.removeEvent(G.exitSlideShow,"onPrimaryPointerClick",K.cross);A.removeChild(G.exitSlideShow);G.exitSlideShow.destroy();G.exitSlideShow=null}document.removeEventListener("keyup",C);d.removeEvent(x.canvas,"onPrimaryPointerMoveUnique",D);d.removeEvent(x.canvas,"onMouseMove",D);d.removeEvent(x.canvas,"onPrimaryPointerClick",D);d.removeEvent(x.canvas,"onPrimaryPointerDownUnique",q);d.removeEvent(x.canvas,"onPrimaryPointerUpUnique",y);E.getContextualUIManager().unregister("CATWebUXSlideShow");if(o.cmds){j.unsubscribe(o.cmds)}if(s&&s!=="noViewRequested"){window.widget.requestView({type:s})}var O=Object.keys(v);var R=E.getActionBar();for(P=0;P<O.length;P++){R.removeCallback(v[O[P]])}R.open();if(L){L.destroy()}var N=a._commands._cmdContext;if(N){var Q=["CATWebUXSlideShowPreviousHdr","CATWebUXSlideShowNextHdr","CATWebUXSlideShowExitHdr"];Q.forEach(function(T){if(N[T]){if(N[T]._destroy){N[T]._destroy()}delete N[T]}})}s="windowed";I=L=null;M={};G={};K={};v={};o={};if(!J&&!x.get2DMode()){x.currentViewpoint.control.setMouseRotationActive(!z);x.currentViewpoint.control.setTouchRotationActive(!z)}t("onActiveStateModified",{state:z})}}};this.getActiveState=function(){return z};this.subscribe=function(O,N){return O&&N?H.subscribe({event:O},N):undefined};this.unsubscribe=function(N){if(H&&N){H.unsubscribe(N)}};this.displaySlideInformation=function(N){if(!L){L=new m()}L.build({body:A,duration:2000,type:N.type?N.type:"primary",message:N.message})};this.activatePreviousSlide=function(){t("onPreviousSlideCB")};this.activateNextSlide=function(){t("onNextSlideCB")};this.clearController=function(){this.setActiveState(false);if(L){L.destroy()}E=L=H=A=null}}});var b=[];var n=c.singleton({init:function(){},giveSlideShowController:function(p){var q;if(p&&p.context&&p.id){for(var o=0;o<b.length;o++){if(b[o].context===p.context&&b[o].id===p.id){q=b[o].controller}}}return q},getSlideShowController:function(p){var q;if(p&&p.context&&p.id){q=this.giveSlideShowController(p);if(q){return q}var o=new g(p);q=Object.freeze({getID:function(){if(o){return o.getID()}return undefined},setActiveState:function(r){if(o){o.setActiveState(r)}},getActiveState:function(){if(o){return o.getActiveState()}return null},setListOfCommandsAllowed:function(r){if(o){o.setListOfCommandsAllowed(r)}},displaySlideInformation:function(r){if(o){o.displaySlideInformation(r)}},clearController:function(){if(o){o.clearController();o=null}},activateNextSlide:function(){if(o){o.activateNextSlide()}},activatePreviousSlide:function(){if(o){o.activatePreviousSlide()}},subscribe:function(r,s){if(o){return o.subscribe(r,s)}return null},unsubscribe:function(r){if(o){o.unsubscribe(r)}}});b.push({context:p.context,controller:q,id:p.id})}return q},unreferenceSlideShowController:function(p){if(p&&p.context&&p.id){for(var o=0;o<b.length;o++){if(b[o].context===p.context&&b[o].id===p.id){b[o].controller.clearController();b.splice(o,1);break}}}}});return n});define("DS/CATWebUXSlideShow/CATWebUXSlideShowCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/CATWebUXSlideShow/CATWebUXSlideShowController"],function(b,a){return b.extend({init:function(j){this._parent(j,{});var e=this;var i,d,k;var c="";for(var h=0;h<j.arguments.length;h++){if(j.arguments[h].ID==="ControllerID"){c=j.arguments[h].Value}}var f=this.onStateChange(function(){if(!i){i=a.giveSlideShowController({context:e.getFrameWindow(),id:c});if(i){d=i.subscribe("onActiveStateModified",function(l){setTimeout(function(){if(!l.state&&e.getState()){e.setState(false)}})});k=i.subscribe("onSlideShowAborted",function(){setTimeout(function(){if(e.getState()){e.setState(false)}})})}}if(i&&i.getActiveState()!==e.getState()){i.setActiveState(e.getState())}});var g=this._destroy;this._destroy=function(){if(i){i.unsubscribe(d);i.unsubscribe(k)}i=null;e._modelEvents.unsubscribe(f);g.call(e)}},_destroy:function(){this._parent()}})});define("DS/CATWebUXSlideShow/CATWebUXSlideShowNavigationCmd",["DS/ApplicationFrame/Command","DS/CATWebUXSlideShow/CATWebUXSlideShowController"],function(c,b){var a=c.extend({init:function(d){this._parent(d,{mode:"shared",isAsynchronous:true})},beginExecute:function(){var d=b.giveSlideShowController({context:this.getFrameWindow(),id:this.ControllerID});if(d){switch(this.options.ID){case"CATWebUXSlideShowPreviousHdr":d.activatePreviousSlide();break;case"CATWebUXSlideShowNextHdr":d.activateNextSlide();break;case"CATWebUXSlideShowExitHdr":d.setActiveState(false);break;default:}}this.end()}});return a});