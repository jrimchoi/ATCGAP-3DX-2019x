/*! -- Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/W3DSpace/EnoviaBootstrap",["UWA/Core","UWA/Class/Collection","UWA/Class/Listener","UWA/Utils","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData"],function(r,m,p,h,f,j,b){function k(v,x){var w;if(v){w=v[x];if(r.is(w,"function")){w=w.call(v)}}return w}var n=false,s=false,d,l,o,i,q,g,a,c;function u(v){if(d){return d}var x="com.ds."+v.id,w="com.ds.compass";d=new h.InterCom.Socket(x);d.subscribeServer(w,window.parent);return d}function e(){var v;v=b.authenticatedRequest;b.authenticatedRequest=function(y,x){var w=l,A,z;if(w){A=w.getStorageWithUrl(y)}if(r.is(A)){if(y!==k(A,"url")){if(!x){x={}}if(!x.headers){x.headers={}}x.headers["X-DS-CSRFTOKEN"]=o||""}y=y+(y.indexOf("?")===-1?"?":"&")+"tenant="+A.id}z=x.onComplete;x.onComplete=function(E,D,C){var B=Object.keys(D).filter(function(G,F){return G.search(/x-ds-csrftoken/i)!==-1});o=B.length>0?D[B[0]]:o;if(r.is(z,"function")){z(E,D,C)}};return v(y,x)}}function t(){if(a){return a}j.getServiceUrl({serviceName:"3DSwym",onComplete:function(w){a=w;var x;if(i){x=i.id}if(x&&a){for(var v=0;v<a.length;v++){if(x===a[v].platformId){c=a[v].url;break}}}},onFailure:function(v){a=[]}});return a}g=r.merge(p,{start:function(v){if(n){return}if(v.frameENOVIA){s=true}v=(v?r.clone(v,false):{});l=v.collection;u(v);e();t();n=true},onStorageChange:function(z,y){var w=z.get("csrf");i=z;if(!r.is(w)){i.fetch({onComplete:y,onFailure:y})}else{if(y){y()}}var x=i.id;if(x&&a){for(var v=0;v<a.length;v++){if(x===a[v].platformId){c=a[v].url;break}}}},getCompassSocket:function(){if(n){return d}},getSyncOptions:function(){if(s){return{}}else{var v={ajax:b.authenticatedRequest};return v}},getStorages:function(){if(n){return l}},getStorage:function(){if(n){return i}},getSwymUrl:function(){if(c){return c}}});return g});define("DS/W3DSpace/Views/AnalyticsView",["UWA/Core","DS/W3DXComponents/Views/GraphView","UWA/Class/View","DS/UIKIT/Input/Select","DS/UIKIT/Mask","DS/UIKIT/Scroller","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(g,b,f,h,e,a,d){var c=f.extend({init:function(i){this._parent(i);this.collabspace=this.model;this.buildSkeleton();this.getAnalyticsContents();this.getAnalyticsMembers();this.getAnalyticsModified()},buildSkeleton:function(){var j=this,k,i=null;j.container=g.createElement("div",{"class":"analytics-container",id:"analytics-container",html:[{tag:"div","class":"analytics-component",id:"analytics-component"}]});j.component=j.container.getElement("#analytics-component");j.selectModified=new h({nativeSelect:false,options:[{value:"1h",label:d.hour},{value:"1d",label:d.day},{value:"1w",label:d.week},{value:"1m",selected:true,label:d.month}],placeholder:false,events:{onChange:function(){e.mask(j.component.getElement("#modifiedGraph"));j.getAnalyticsModified()}}});i=new a({element:j.container});j.graphContent1=j.createGraph({title:d.cpm,unit:d.unitContents,labelFormat:"",graphName:"Content1"});j.graphContent2=j.createGraph({title:d.cpt,unit:d.unitContents,labelFormat:"",graphName:"Content2"});j.graphMembers=j.createGraph({title:d.mpr,unit:d.unitMembers,labelFormat:"",graphName:"Members"});j.graphModified=j.createGraph({title:d.lmct,unit:d.unitContents,labelFormat:"",graphName:"modifiedGraph"});k=j.component.getElement("#modifiedGraph").childNodes[0];j.ComboContainer=g.createElement("div",{"class":"timemodified-container",id:"comboModified",html:[{tag:"label",html:d.overthelast}]});j.ComboContainer.inject(k,"bottom");j.selectModified.inject(j.ComboContainer);return j.container},createGraph:function(j){var k=this;var i=new b({title:j.title,type:b.TYPE_PIE,unit:j.unit,plotOptions:{pie:{allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:true,format:"<b>{point.name}</b>: {point.y:} "+j.labelFormat}}},series:[]}).render();k.graph=g.createElement("div",{"class":"graph col-xs-12 col-md-6 col-sm-6 col-lg-4",id:j.graphName,events:{resize:function(){if(i){i.reflow()}}},html:[{tag:"div","class":"analytics"}]});i.inject(k.graph.getElement(".analytics"));k.graph.inject(k.component);return i},updateGraph:function(j,i){j.setOptions({subtitle:i.nbr+" "+i.subtitle,series:[{data:i.data}]}).render()},getAnalyticsMembers:function(){var j=this;var i={};i.view=j;i.onComplete=function(m){var l=m.mpr,k=m.nbmembers;j.updateGraph(j.graphMembers,{data:l,subtitle:d.nb_members,nbr:k})};j.collabspace.getAnalyticsMembers(i)},getAnalyticsContents:function(){var j=this;var i={};i.onComplete=function(m){var l=m.cpm;var n=m.cpt;var k=m.nbcontents;j.updateGraph(j.graphContent1,{subtitle:d.nb_contents,data:l,nbr:k});j.updateGraph(j.graphContent2,{subtitle:d.nb_contents,data:n,nbr:k})};j.collabspace.getAnalyticsContents(i)},getAnalyticsModified:function(){var j=this;var l=j.retrieveData();var k;var i={};i.modified=l;i.onComplete=function(o){var n=o.lmpt,m=o.nbmodified;j.updateGraph(j.graphModified,{data:n,subtitle:d.nb_modified,nbr:m});e.unmask(j.component.getElement("#modifiedGraph"))};j.collabspace.getAnalyticsModified(i)},retrieveData:function(){var l=this;var k=l.selectModified.getValue()[0];var j=1;if(k==="1h"){j=1}else{if(k==="1d"){j=24}else{if(k==="1w"){j=24*7}else{if(k==="1m"){j=24*30}}}}var m=j*3600*1000;var i=new Date(Date.now()-m);var n=i.getTime();return n},});return c});define("DS/W3DSpace/Views/EditVisibilityView",["UWA/Core","UWA/Element","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Alert","UWA/Class/View","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(h,i,f,g,b,d,e,c,j){var a=c.extend({name:"EditVisibility",tagName:"div",className:"create-cs-view",init:function(k){var l=UWA.clone(k,false);["container","template","tagName","domEvents"].forEach(function(m){delete l[m]});this._parent(l)},setup:function(){this.container.addClassName(this.getClassNames("-container"));this._initAlert();this._initForm();this._initListenKeyDown()},_initAlert:function(){var k={className:"create-alert",closable:true,renderTo:document.body,autoHide:true,visible:true};this.elements.alertFailure=new e(h.extend({messageClassName:"error"},k))},_initForm:function(){var q=this,l=this.options,r=this.elements,p,o,n,m;var k=[{value:"PRIVATE",label:j["private"]+" - "+j.privateDetail},{value:"PROTECTED",label:j["protected"]+" - "+j.protectedDetail},{value:"PUBLIC",label:j["public"]+" - "+j.publicDetail}];if(this.model.get("visibility").value.toUpperCase()===("Private").toUpperCase()){k[0].selected=true}else{if(this.model.get("visibility").value.toUpperCase()===("Protected").toUpperCase()){k[0].disabled=true;k[1].selected=true}else{k[0].disabled=true;k[1].disabled=true;k[2].selected=true}}p=[{type:"select",name:"visibility",label:j.visibility,nativeSelect:false,placeholder:false,options:k}];o=new f({fields:p,events:{onSubmit:function(){q.onEdit()},onInvalid:function(s){},onValid:function(){}}});n=new g({value:j.edit,className:"primary",events:{onClick:this.dispatchAsEventListener("onEdit")}});m=new g({value:j.cancel,events:{onClick:this.dispatchAsEventListener("onCancel")}});r.form=o;r.edit=n;r.cancel=m},getEditButton:function(){return this.elements.edit},getCancelButton:function(){return this.elements.cancel},getFormFirstInput:function(){return this.elements.form.elements.container[0]},_initListenKeyDown:function(){this.onKeyDown=this.onKeyDown.bind(this);document.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(l){if(l.keyCode===13){if(this.submitEnabled()){this.onEdit()}}else{if(l.keyCode===27){var k=document.createEvent("Event");k.initEvent("click",true,false);this.elements.cancel.elements.content.dispatchEvent(k)}}},submitEnabled:function(){var k=this.elements.edit.elements.content.getAttribute("disabled");return k===null?true:false},render:function(){var n=this.elements,m=n.form,l=n.edit,k=n.cancel;this.container.setContent([m,{tag:"div","class":"footer"}]);return this},onEdit:function(){var n=this,l=this.options,o=this.model,q=l.onComplete,m=l.onFailure,p,k;l.onFailure=function(s,t,r){n.model.collection.remove(s);if(h.is(m)){m.apply(undefined,arguments)}};p={visibility:{value:this.elements.form.getValue("visibility")}};this.model.save(p,{onComplete:l.onComplete,onFailure:l.onFailuren})}});return a});define("DS/W3DSpace/Views/ModelForm",["UWA/Core","UWA/Utils","UWA/Class/Listener","DS/W3DXComponents/Views/Temp/TempItemView","DS/UIKIT/Form","DS/W3DXComponents/Views/Temp/TempAutocomplete","css!DS/UIKIT/UIKIT.css"],function(d,b,h,g,f,e){var a;function c(j,l,k,i){if(typeof j[l]==="function"){return j[l].apply(k,i)}else{return d.clone(j[l],false)}}a=f.extend(h,{_disabled:false,init:function(k){var i={},j=k.model;if(!j){throw new Error("You must specify a model")}this.model=k.model;delete k.model;Object.keys(k).map(function(l){i[l]=c(k,l,this.model)},this);this._parent.call(this,i);this.disable();this.syncFields();this._modelEvent={onChange:this._onModelChange,onDestroy:this._onModelDestroy};this.listenTo(this.model,this._modelEvent)},setValues:function(i,j){var k;if(this._disabled&&!j){return}else{if(j){this.setDisabled(false,true);k=true}}this._parent.call(this,i);k&&this.setDisabled();return this},setValue:function(j,l,k){var i={};i[j]=l;return this.setValues(i,k)},getValues:function(){var k=this._parent.apply(this,arguments),n,j,m,o=this.getFields();for(n=0,j=o.length;n<j;n++){m=o[n];if(m.getAttribute("type")==="autocomplete"){k[m.name]=m.getAttribute("data-key")}}return k},clear:function(j){if(this._disabled&&!j){return}var i=this.getValues();Object.keys(i).forEach(function(k){i[k]=""});this.setValues(i);this.dispatchEvent("onClear");return this},reset:function(){this.syncFields();this.dispatchEvent("onReset");return this},syncFields:function(){var i=this;this.getFields().forEach(function(j){i.syncField(j.getAttribute("name"))});return this},syncField:function(i){var k=this.getField(i),j;if(!k){return this}j=k.getAttribute("data-attr");if(d.is(j)){j=new Function(j);j=j.call(this.model)}else{j=this.model.get(i)}this.setValue(i,j,true);return this},setDisabled:function(l,m){var o,k,i,n;this._disabled=true;if(typeof l==="undefined"){l=true}i=this.getFields(true);for(k=0;k<i.length;k++){n=i[k];o=n.getAttribute("data-editable");!d.is(o)&&(o="true");if(o!=="false"&&o!=="true"){o=new Function(o);o=o.call(this.model)}if(!l&&(o==="false"||!o)&&!m){continue}var j=this.getInput(n.name);if(j){j.setDisabled(l)}n.disabled=l;this._disabled=l}return this},createField:function(n,m,i,p){var o=this._parent.apply(this,arguments);var k=this,j=n.getContent();var l=j.dataset?j.dataset.icon:j.getAttribute("data-icon");if(l){if(d.is(l)){l=new Function(l);l=l.call(this.model)}var q=UWA.createElement("img",{"class":"type-icon",src:l});o.insertBefore(q,j)}return o},fields:d.extend(f.prototype.fields,{autocomplete:function(l,n){var j,k,m=n,i={id:"input-"+b.getUUID().substring(0,6)};j=new e(d.extend(i,l,true));j.getContent().getElement("input").addClassName("form-control").getParent().removeClassName("temp-autocomplete-searchbox");if(UWA.is(l.label)){k=UWA.createElement("label",{"for":j.getId(),text:UWA.i18n(l.label+m.options.labelSuffix)})}return m.createField.call(m,j,k)}}),_onModelChange:function(){if(this._disabled){return}this.syncFields()},_onModelDestroy:function(){this.disable();this.clear(true)},onSubmit:function(){this.disable()},onReset:function(){this.disable()},onEdit:function(){this.enable()},destroy:function(){this.stopListening(this.model,this._modelEvent);return this._parent.apply(this,arguments)}});return a});define("DS/W3DSpace/Views/ModalRemoveCS",["UWA/Controls/Abstract","UWA/Controls/Input","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/W3DXComponents/Views/Temp/TempItemView","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(b,e,i,f,a,d,c,h){var g=b.extend({init:function(j){this._parent(j);this.resetModal();this.model=j.model;this._alertFailure=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"});this._alertSuccess=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});this._alertWarning=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"warning"})},showModal:function(){var j=this;this.modal.inject(document.body);this.modal.show()},getFooter:function(){var k=this;var j=new d({value:h.remove,className:"primary",events:{onClick:function(){k.onRemoveCalled()}}});var l=new d({value:h.cancel,className:"default",events:{onClick:function(m){k.onCancelCalled()}}});return[j,l]},onRemoveCalled:function(){a.mask(widget.body);var k=this.model,n=k.collection,l=this._alertFailure,j=this._alertSuccess,m=this._alertWarning;k.destroy({onFailure:function(p,q,o){if(o&&o.request&&o.request.xhr&&o.request.xhr.timedout){m.add({message:h.warningRemoveCSTimeout})}else{l.add({message:h.errorRemove})}a.unmask(widget.body)},onComplete:function(){j.add({message:h.successRemoveCS});a.unmask(widget.body)},wait:true});this.modal.destroy();this.resetModal()},onCancelCalled:function(){this.modal.destroy();this.resetModal()},resetModal:function(){this.modal=new f({closable:true,header:h.removeCS,body:h.removeCSDetail,footer:this.getFooter()})},onDestroy:function(){this._alertFailure.destroy();this._alertSuccess.destroy()}});return g});define("DS/W3DSpace/Views/CollabSpaceAdminView",["UWA/Core","UWA/Class/View","DS/W3DXComponents/Views/Layout/ScrollView","i18n!DS/W3DSpace/assets/nls/CollabSpaceAdminView","css!DS/W3DSpace/W3DSpace.css"],function(a,e,c,d){var b=e.extend({name:"collabspaces-admin",tagName:"div",className:"collabspaces-admin",domEvents:{},setup:function(f){},render:function(){var f=this;this.container.setContent([{tag:"div","class":"widget-frame",html:[{tag:"div","class":"widget-header",html:[{tag:"span","class":"widget-title",text:d.ownership},{tag:"div","class":"widget-actions",html:[{tag:"a",href:"#","class":"action-refresh",html:[{tag:"img",src:"images/s.gif","class":"widget-actions-view-refresh",alt:"Refresh",title:"Refresh",width:"16",height:"16"}],events:{click:function(h){var i=f.container.getElements("iframe#adminOwnership");if(i&&i.length){var g=i[0];g.src=g.src}return false}}}]}]},{tag:"div","class":"widget-content",html:[{tag:"iframe",id:"adminOwnership","class":"widget-content-frame",src:"../csmCentral/emxENOCollabSpaceStorageAdminOwnership.jsp"}]}]},{tag:"div","class":"widget-frame",html:[{tag:"div","class":"widget-header",html:[{tag:"span","class":"widget-title",text:d.members},{tag:"div","class":"widget-actions",html:[{tag:"a",href:"#","class":"action-refresh",html:[{tag:"img",src:"images/s.gif","class":"widget-actions-view-refresh",alt:"Refresh",title:"Refresh",width:"16",height:"16"}],events:{click:function(h){var i=f.container.getElements("iframe#adminMembers");if(i&&i.length){var g=i[0];g.src=g.src}return false}}}]}]},{tag:"div","class":"widget-content",html:[{tag:"iframe",id:"adminMembers","class":"widget-content-frame",src:"../csmCentral/emxENOCollabSpaceStorageAdminMembers.jsp"}]}]}]);return this}});return b});define("DS/W3DSpace/Views/ModalDeleteMember",["UWA/Controls/Abstract","UWA/Controls/Input","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/W3DXComponents/Views/Temp/TempItemView","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(h,f,e,b,a,d,g){var c=h.extend({init:function(i){this._parent(i);this.resetModal();this.model=i.model;this.alert=new e({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"})},showModal:function(){var i=this;this.modal.inject(document.body);this.modal.show()},getFooter:function(){var j=this;var i=new a({value:g.remove,className:"primary",events:{onClick:function(){j.onDeleteCalled()}}});var k=new a({value:g.cancel,className:"default",events:{onClick:function(l){j.onCancelCalled()}}});return[i,k]},onDeleteCalled:function(){var i=this.model,k=i.collection,j=this.alert;i.destroy({onFailure:function(m,n,l){k.add(m);j.add({message:g.replace(g.errorDeleteMember,{tag1:m.get("people").name})})}});this.modal.destroy();this.resetModal()},onCancelCalled:function(){this.modal.destroy();this.resetModal()},resetModal:function(){this.modal=new b({closable:true,header:g.deleteMember,body:g.deleteMemberDetail,footer:this.getFooter()})},onDestroy:function(){this.alert.destroy()}});return c});define("DS/W3DSpace/Views/FiltersAdapter",["UWA/Core","DS/UIKIT/Mask"],function(b,c){function a(f,d){var e=d;return f.extend({setup:function(h){var g=this._externalEvents={onTaggerProxyFilterChange:function(){this.reload()},onSearch:function(i){this.reload()},onResetSearch:function(){this.reload()}};if(this.collection){this.listenTo(this.collection,g)}return this._parent.apply(this,arguments)},destroy:function(g){if(this.isDestroyed){return}if(this.collection){this.stopListening(this.collection,this._externalEvents)}return this._parent.apply(this,arguments)},reload:function(){var g=this,i,h=e?b.clone(e,false):{};c.mask(this.container);this.collection.state.totalRecords=null;i=h.onComplete;h.onComplete=function(){if(i){i(arguments)}c.unmask(g.container)};this.collection.getFirstPage(h)}})}return a});define("DS/W3DSpace/Views/ModalShareContent",["UWA/Core","DS/WAFData/WAFData","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/UIKIT/Alert","DS/W3DSpace/EnoviaBootstrap","DS/SwymPublishForm/script/publish-form-view","i18n!DS/W3DSpace/assets/nls/ModalShareContent","css!DS/W3DSpace/W3DSpace.css"],function(h,g,e,f,d,b,k,i){var a=new d({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:3000,messageClassName:"success"}),c=new d({className:"csg-alert",closable:true,renderTo:document.body,visible:true,messageClassName:"error"});var j=e.extend({init:function(s){this._parent(s);var o=this,p,t,m,q,l,n,r;t={id:s.model.physicalid,name:s.model.title};r=function(){p.destroy();o.destroy()};p=new k({platformUrl:s.url,title:"",description:"",content_title:s.model.title,content_description:s.model.description,mode:"jsevent",});p.addEvent("CancelShare",function(u){r()},false);p.addEvent("StartUpload",function(z){var x=new RegExp("/session");var v=b.getStorage(),w;if(v){w=v.url;if(h.is(w,"function")){w=w.call(v)}w=w.split(x)[0];w=w+"/publish/swym/createMedia"}var u=new Object();m=(JSON.parse(z)).platform_instance;u.platformid=m;q=(JSON.parse(z)).community_id;l=(JSON.parse(z)).content_type;u.communityid=q;u.contenttype=l;u.objectid=t.id;var y=JSON.stringify(u),B={"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"},A={url:w,timeout:15000,method:"POST",data:y,type:"json",headers:B,proxy:"passport",onComplete:function(E){n=E.mediaid;var D=E.errorID;if(D!==undefined){var C=i.get(D);if(C!==undefined){if(C.search("{tagName}")!==-1){C=i.replace(C,{tagName:t.name})}c.add({message:C})}else{c.add({message:i.errCreateMedia})}console.log("Upload error: "+E.errorMessage);r()}else{if(n===undefined){c.add({message:i.errUploadContent});r()}else{p.createContent(n)}}},onFailure:function(C){c.add({message:i.errCreateMedia});r()}};g.authenticatedRequest(w,A)},false);p.addEvent("ContentCreated",function(w){var u="<a href="+m+"/#community:"+q+"/media:"+n+' target="_blank">'+t.name+"</a>";var v=i.replace(i.successShare,{tagName:u});a.add({message:v});r()},false);this.elements.modal=new f({className:"publishSwymPanel_3DSpace",closable:true,header:i.shareSwymTitle,body:p.render("publish_to_sywm_wrapper_id")})},show:function(){var m=this.elements,l=m.modal;l.inject(document.body);l.show()}});return j});define("DS/W3DSpace/Models/ContentModel",["UWA/Core","DS/WAFData/WAFData","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(e,c,d,b,g){function a(i,k){var j;if(i){j=i[k];if(e.is(j,"function")){j=j.call(i)}}return j}function f(j,i){var k=i.onFailure;i.onFailure=function(l){if(k){k(j,l,i)}j.dispatchEvent("onError",[j,l,i])}}var h=d.extend({defaults:{collabspace:"",businessobj:{icon:"",type:{},title:"",description:"",maturity:{},thumbnail:"",modified:"",fullnameowner:"",file:"",owner:{}},actions:[]},parse:function(i){if(e.is(i.businessobj)&&!e.is(i.businessobj.description)){i.businessobj.description=""}return i},sync:function(k,j,i){e.extend(i,b.getSyncOptions(),true);if(i&&i.data&&!i.data.contains('nlsKey":"Whole Structure')){delete i.data}return this._parent.apply(this,arguments)},getSecurityContexts:function(l){var k=l.get("contexts");var j=["VPLMProjectLeader","VPLMCreator","VPLMExperimenter","VPLMViewer","VPLMProjectAdministrator"];var i=k.map(function(n){if(n.role==="VPLMProjectLeader"){return 0}else{if(n.role==="VPLMCreator"){return 1}else{if(n.role==="VPLMExperimenter"){return 2}else{if(n.role==="VPLMViewer"){return 3}else{if(n.role==="VPLMProjectAdministrator"){return 4}else{return 5}}}}}});var m=k.filter(function(n){return n.role===j[Math.min.apply(null,i)]});return m},destroy:function(j){if(this.get("businessobj").type.value!=="Document"){var l=this;var k=l.getSecurityContexts(this.collection._modelKey);var i=b.getStorage().get("url")+"/resources/lifecycle/Delete/structure?SecurityContext=ctx::"+k[0].name;j=e.clone(j||{},false);var m={data:[{physicalid:this.id}],options:[{nlsKey:"Whole Structure",type:"checkbox",value:false,key:"wholeStructure"}]};j=Object.assign({type:"json",method:"POST",data:JSON.stringify(m),headers:{"Content-Type":"application/json",Accept:"application/json"},url:i},j)}return this._parent(j)},createAssociatedBO:function(k){k=k?e.clone(k,false):{};if(!k.urlFCS){throw new Error('A "url" must be specified')}var n=this,j=k.urlFCS,p=k.onComplete,o,i,m;k.onComplete=function(q){n.dispatchEvent("onCreateAssociatedBO");if(p){return p(n,n.parseBOReceipt(q),k)}};o=new FormData();i=this.getBOFormAttr(k);for(var l in i){o.append(l,i[l])}this.dispatchEvent("onBeforeCreateAssociatedBO",[o]);m=new XMLHttpRequest();m.upload.onprogress=this.onProgressBOCreation.bind(this);m.open("POST",j,true);m.onreadystatechange=function(){if(m.readyState===4){if(m.status===200){k.onComplete(m.responseText)}else{if(k.onFailure){k.onFailure(n,m.responseText,k)}}}};m.send(o);return m},parseBOReceipt:function(j){var i=e.createElement("div").setHTML(j).getElement('[name="__fcs__jobReceipt"]').value;return{receipt:i}},getBOFormAttr:function(j){j=j?e.clone(j,false):{};var i={};if(j.ticket&&j.ticket.name){i[j.ticket.name]=j.ticket.value}e.extend(i,{__fcs__jobTicket:j.ticket.value,"file-name":this.get("businessobj").file,file_0:j&&j.file,"file-title":this.get("businessobj").title,"file-description":this.get("businessobj").description});return i},getPreview:function(j){if(this.get("businessobj").type.value!=="Document"){return}if(!j){j={}}var l=this,k,i=a(this,"url")+"/preview",m=j.onComplete;j.onComplete=function(o){var n;o=l.parsePreview(o);n=l.get("businessobj");l.set("businessobj",e.merge({thumbnail:o.thumbnail},n));if(m){return m(l,o,j)}};c.authenticatedRequest(i,e.extend({type:"json"},e.extend(j,b.getSyncOptions(),true)));return k},parsePreview:function(i){return i},download:function(i){if(!i){i={}}var j=i.onComplete;i.onComplete=function(l,m,k){window.open(m.url,"_self");if(j){return j(l,m,k)}};f(this,i);return this.getDownloadUrl(i)},getFileUrl:function(j){if(!j){j={}}var l=this,k,i=a(this,"url")+"/fileurl",m=j.onComplete;j.onComplete=function(o){var n;if(m){return m(l,o,j)}};k=c.authenticatedRequest(i,e.extend({type:"json"},e.extend(j,b.getSyncOptions(),true)));return k},getDownloadUrl:function(j){if(!j){j={}}var l=this,k,i=a(this,"url")+"/download",m=j.onComplete;j.onComplete=function(o){var n;if(m){return m(l,o,j)}};k=c.authenticatedRequest(i,e.extend({type:"json"},e.extend(j,b.getSyncOptions(),true)));return k},onProgressBOCreation:function(j){if(j.lengthComputable){var i=(j.loaded/j.total)*100;this.dispatchEvent("onProgress",i)}},focusTaggerProxyOnSubject:function(){var j=this.collection,i;if(!j||!(i=j.taggerProxy)){return}i.focusOnSubjects(["pid://"+this.id])},"onChange:id":function(){this.getPreview()}});return h});define("DS/W3DSpace/Models/CollabSpaceModel",["UWA/Core","DS/WAFData/WAFData","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap","DS/W3DXComponents/Collections/ActionsCollection"],function(h,c,g,b,f){function a(i,k){var j;if(i){j=i[k];if(h.is(j,"function")){j=j.call(i)}}return j}var d="collabspace";var e=g.extend({name:d,defaults:{title:"",contexts:[],thumbnail:"",description:"",family:{},visibility:{},solution:"",owner:{},contents:null,members:null,actions:[]},idAttribute:"name",actions:null,parse:function(i){if(!h.is(i.description)){i.description=""}return i},sync:function(k,j,i){h.extend(i,b.getSyncOptions(),true);return this._parent.apply(this,arguments)},setup:function(i,j){if(!this.actions){(this.actions=new f([],{_modelKey:this}))}if(j&&j.actionsCtx&&j.actionsCtx instanceof f){(this.actionsCtx=j.actionsCtx)}},_mapActions:function(i,j){var m,l,k;if(h.is(this.actionsCtx)){l=this.actionsCtx}else{if(j&&j.actionsCtx&&j.actionsCtx instanceof f){l=j.actionsCtx}}if(i&&Array.isArray(i)){m=i.map(function(o){if(h.is(o,"object")){return o}else{if(l){var n=l.get(o);if(!n){throw new Error("No corresponding action in the specified actionCtx")}return new f.prototype.model(n._attributes)}else{return o}}})}return m?m:i},set:function(k,l,j){var i;if(k!=="actions"&&!k.actions){return this._parent.apply(this,arguments)}if(h.is(k,"object")||k===null){i=k;j=l||{}}else{i={};i[k]=l;j=j||{}}return this._setAttrWithActions(i,j)},_setAttrWithActions:function(i,j){var l=this._mapActions(i.actions,j),k=g.prototype.set.apply(this,arguments);if(!this.actions){(this.actions=new f([],{_modelKey:this}))}this.actions[j.reset?"reset":"set"](l,j);return k},save:function(k,l,j){var i;if((!h.is(k))||(h.typeOf(k))==="object"){i=k;j=l}else{i={};i[k]=l}if(!h.is(i)||!i.hasOwnProperty("thumbnail")){return this._parent.call(this,i,j)}return this._saveWithThumbnail(i,j)},_saveWithThumbnail:function(k,j){if(!j||!j.hasOwnProperty("file")){throw new Error("You must specify a file options when you save a new thumbnail property")}j=h.clone(j||{},false);var m=this,l=j.file,i=l.name,n=j.onComplete;j.onComplete=function(p,q,o){h.extend(o,q);o.onComplete=function(s,t,r){r.onComplete=function(v,w,u){v.dispatchEvent("onThumbnailLoad");if(n){return n(v,w,u)}};g.prototype.save.call(m,k,h.merge({url:a(s,"url")+"?receipt="+encodeURIComponent(t.receipt)},r))};p.checkInThumbnailFile(o)};return this.getTicket(h.extend({model:this},j))},getTicket:function(k){var m=this,j=a(this,"url")+"/ticket?id="+Date.now(),l,i,n;k=k?h.clone(k,false):{};i=k.model;if(i){i.dispatchEvent("onBeforeGetTicket")}n=k.onComplete;k.onComplete=function(o){if(i){i.dispatchEvent("onGetTicket")}if(n){return n(m,m.parseTicket(o),k)}};l=c.authenticatedRequest(j,h.extend(h.extend({type:"json"},b.getSyncOptions()),k,true));return l},parseTicket:function(i){return{urlFCS:i.actionurl,ticket:{name:i.jobticket,value:i.ticket}}},getNominalContext:function(){var l=this.get("contexts"),k,j;for(k=0;k<l.length;k++){j=l[k];if(j.role!=="VPLMProjectAdministrator"){break}}return j.name},getAnalyticsMembers:function(l){if(!l){l={}}var n=this,m,k=a(this,"url")+"/analytics",j="mpr,nbmembers";var i=k+"?fields="+j;m=c.authenticatedRequest(i,h.extend(l,h.extend(b.getSyncOptions(),{type:"json",onComplete:l.onComplete}),true));return m},getAnalyticsContents:function(j){if(!j){j={}}var m=this,l,i=a(this,"url")+"/analytics",k="cpt,cpm,nbcontents";var n=i+"?fields="+k;l=c.authenticatedRequest(n,h.extend(j,h.extend(b.getSyncOptions(),{type:"json",onComplete:j.onComplete}),true));return l},getAnalyticsModified:function(l){if(!l){l={}}var o=this,n,k=a(this,"url")+"/analytics",i="lmpt,lastmodified,nbmodified",j=l.modified;if(j){j="&modified="+j}var m=k+"?fields="+i+j;n=c.authenticatedRequest(m,h.extend(l,h.extend(b.getSyncOptions(),{type:"json",onComplete:l.onComplete}),true));return n},checkInThumbnailFile:function(k){k=k?h.clone(k,false):{};if(!k.urlFCS){throw new Error('A "url" must be specified')}var n=this,j=k.urlFCS,p=k.onComplete,o,i,m;k.onComplete=function(q){n.dispatchEvent("onCheckInThumbnailFile");if(p){return p(n,n.parseThumbnailFileReceipt(q),k)}};o=new FormData();i=this.getThumbnailFileForm(k);for(var l in i){o.append(l,i[l])}this.dispatchEvent("onBeforeCheckInThumbnailFile",[o]);m=new XMLHttpRequest();m.open("POST",j);m.onreadystatechange=function(){if(m.readyState===4){if(m.status===200){k.onComplete(m.responseText)}else{if(k.onFailure){k.onFailure(m.responseText)}}}};m.send(o);return m},parseThumbnailFileReceipt:function(j){var i=h.createElement("div").setHTML(j).getElement('[name="__fcs__jobReceipt"]').value;return{receipt:i}},getThumbnailFileForm:function(j){j=j?h.clone(j,false):{};var i={};if(j.ticket&&j.ticket.name){i[j.ticket.name]=j.ticket.value}h.extend(i,{__fcs__jobTicket:j.ticket.value,"file-name":j&&j.file.name,file_0:j&&j.file,"file-title":j&&j.file.name,"file-description":j&&j.file.name});return i},getPreview:function(j){if(!j){j={}}var l=this,k,i=a(this,"url")+"/preview",m=j.onComplete;j.onComplete=function(n){l.set("thumbnail",n.thumbnail);if(m){return m(l,n,j)}};c.authenticatedRequest(i,h.extend({type:"json"},h.extend(j,b.getSyncOptions(),true)));return k},"onChange:name":function(){this.getPreview()}});return e});define("DS/W3DSpace/SkeletonUtils/MemberSkeletonOptions",["UWA/Drivers/Alone","UWA/Core","DS/WAFData/WAFData","DS/UIKIT/Alert","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/EmptyView","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/Views/ModalDeleteMember","DS/W3DXComponents/Views/Item/PanelAddMemberView","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(i,p,a,c,f,o,g,r,e,h){var n,q=null,m=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"}),j=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});function k(s,u){var t;if(s){t=s[u];if(p.is(t,"function")){t=t.call(s)}}return t}function d(){var s=this,v=this.collection,u,w,t=n.getFetchOptions();u=t.onComplete;t.onComplete=function(z,y,x){if(s.container.offsetParent){s.container.removeClassName("loading");Object.keys(s.contentsViews).map(function(A){s.contentsViews[A].scrollView.endLoading()})}if(u){u(s,y,x)}};if(v.state.totalRecords===null){v.getFirstPage(t)}else{if(v.hasNextPage()){v.getNextPage(p.extend(t,{remove:false,reset:false}))}else{s.container.removeClassName("loading");Object.keys(s.contentsViews).map(function(x){s.contentsViews[x].scrollView.useInfiniteScroll(false)})}}}function l(){var s=this;if(!p.is(this.collection.getFirstPage,"function")){return this.collection.fetch(p.extend({onComplete:function(){s.scrollView.useInfiniteScroll(false);s.scrollView.endLoading()}},n.getFetchOptions()))}}function b(u,s,w,t){var v=w.model.get("id");switch(v){case"add.members":this.togglePanel();break;default:console.log(v+" is not permitted.");break}}n={getFetchOptions:function(){return{type:"json",data:{embed:"people"},reset:true,onFailure:function(){m.add({message:h.errorFetchMembers})}}},getIdCardOptions:function(s){return{collapsed:s.minimizeIdCardView}},getMemberSetOptions:function(s){return{slidepanel:{view:e,viewOptions:{categories:[{id:"Contributor",name:h.contributor},{id:"Author",name:h.author},{id:"Leader",name:h.leaderOwner}],suggestFormat:"{fname} {lname}",suggestKey:"login",suggestDistinction:function(v){var t=this.options.categories;for(var u in t){if(t[u].id===v.role){return t[u].name}}},labelFormat:"{fname} {lname}",placeholder:"",typeDelay:500,minLength:1,getSuggestions:function(z,w,y){var v,u,t=new RegExp("/session"),x=this.collection._modelKey.id;if(!z){return}if(q){q.cancel()}if(w[z]){y(w[z])}else{v=k(g.getStorage(),"url");v=v.split(t)[0];v=v+"/peoples?filter="+encodeURIComponent(z)+"&collabspace="+encodeURIComponent(x)+"&limit=10";u=p.extend({type:"json",onComplete:function(A){y(A)}},g.getSyncOptions());q=a.authenticatedRequest(v,u)}},saveProcess:function(u){var v;for(var t=0;t<u.length;t++){this.collection.create({people:u[t].selection,role:{value:u[t].categoryId,admin:(u[t].categoryId==="Leader")}},{onFailure:function(x,y,w){x.destroy();m.add({message:h.replace(h.errorCreateMember,{tag1:x.get("people").name})})},onComplete:function(x,y,w){j.add({message:h.replace(h.successAddMember,{tag1:x.get("people").name})})},headers:{"Content-type":"application/json"}})}}}},className:"loading",events:{onActionClick:b,onInfiniteScroll:d},actions:{collection:function(){var u=this.collection,t=u._modelKey;return t&&t.actions},filterer:function(u,t){return !!u.get("actionBar")&&u.id.indexOf(".members")!==-1}},contents:{selectionMode:null,headerOnEmpty:false,headers:[{property:"title_fname",label:h.firstname},{property:"title_lname",label:h.lastname},{property:"subtitle",label:h.role},{label:h.actions,actions:true}],itemViewOptions:{mapping:{title:function(){var t=this.model.get("people");if(!p.is(t)){return}return(t.fname||h.loading)+" "+(t.lname||"")},title_fname:function(){var t=this.model.get("people");if(!p.is(t)){return}return t.fname||h.loading},title_lname:"people.lname",subtitle:function(){var t=this.model.get("role");if(!p.is(t)){return}return(t.admin)?t.value+" & "+h.ownerRole:t.value},image:function(){var t=this.model.get("people");if(t){return this.model.get("picture")}}},contextualActions:function(){var z=function(B,C,A){B.set(B.previousAttributes());m.add({message:h.replace(h.errorEditRole,{tag1:B.get("people").name})})};var y=function(B,C,A){j.add({message:h.replace(h.successEditRole,{tag1:B.get("people").name})})};var x=[],v=0,t=0;for(var u=0;u<this.get("actions").length;u++){var w=this.get("actions")[u];if(w.indexOf("contributor")!==-1){x.splice(0,0,w);v++}else{if(w.indexOf("author")!==-1){x.splice(v,0,w);v++}else{if(w.indexOf("leader")!==-1){x.splice(x.length-t,0,w)}else{x.splice(x.length,0,w);t++}}}}return x.map(function(A){switch(A){case"delete":return{text:h.remove,fonticon:"trash",handler:function(B){var C=new r({model:B.model});C.showModal()}};break;case"edit.role.author":return{text:h.author,fonticon:"pencil",handler:function(B){B.model.save({people:B.model.get("people"),role:{value:"Author",admin:false}},{onFailure:z,onComplete:y})}};break;case"edit.role.contributor":return{text:h.contributor,fonticon:"pencil",handler:function(B){B.model.save({people:B.model.get("people"),role:{value:"Contributor",admin:false}},{onFailure:z,onComplete:y})}};break;case"edit.role.leader":return{text:h.leaderOwner,fonticon:"pencil",handler:function(B){B.model.save({people:B.model.get("people"),role:{value:"Leader",admin:true}},{onFailure:z,onComplete:y})}};break;default:return null}}).filter(function(A){return A})},icon:"users",title:h.emptyMemberTitle,},emptyView:o,events:{onPullToRefresh:l}}}}};return n});define("DS/W3DSpace/Collections/ContentsCollection",["UWA/Core","DS/WAFData/WAFData","UWA/Class/Model","DS/WebAppsFoundations/Collections/PageableCollection","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/Models/ContentModel","DS/W3DSpace/Models/CollabSpaceModel","DS/TagNavigatorProxy/TagNavigatorProxy"],function(g,e,k,d,c,a,b,f){var h="contents";function j(l,n){var m;if(l){m=l[n];if(g.is(m,"function")){m=m.call(l)}}return m}var i=d.extend({defaultOptions:{mode:"data",state:{firstPage:0,currentPage:0,pageSize:25},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"contentTotal"},taggerProxy:{filteringMode:"FilteringOnServer",events:{}}},name:h,model:a,filterTagObj:null,isNewFilter:false,url:function(){return"/"+this.name},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"contentTotal"},_initTaggerProxy:function(){var n=this,l,m,o;l=this.getOption("taggerProxy");o=this._taggerProxyEvents={onFilterChange:n.onFilterChange,addUnfocusSubjectsListener:n.onUnfocusSubjects};if(widget){l=g.extend({widgetId:widget.id,tenant:c.getStorage().id},l,true)}else{l=g.extend({contextId:"context1"},l,true)}m=this.taggerProxy=f.createProxy(l);this.listenTo(m,o);return m},parseResponseForStateUpdate:function(o,m,n,l){return{totalRecords:o.contentTotal}},parseRecords:function(m,l){return m.items},sync:function(n,m,l){g.extend(l,c.getSyncOptions(),true);this._parent.apply(this,arguments)},fetch:function(o){var q=this,m=this.taggerProxy,n,r,l,p;o=o?g.clone(o,false):{};if(m){r=o.onComplete;n=this.filterTagObj;if(n){l={tags:JSON.stringify(n)};o.data=(o.data?g.extend(l,o.data):l)}o.onComplete=function(t,u,s){p=t.parseTags(u);if(s.reset===true){m.setTags(p.subjectsTags,p.tagValues)}else{m.addSubjects(p.subjectsTags)}t.isNewFilter=false;if(g.is(r,"function")){r(this,u,s)}}}if(this.currentSearchUrl){o.url=this.currentSearchUrl}return this._parent.call(this,o)},parseTags:function(l){return{tagValues:l.tagValues,subjectsTags:l.subjectsTags}},setup:function(n,l){var m=l._modelKey;if(m&&m instanceof k){this._modelKey=m;if(l.url===undefined){this.url=j(m,"url")+Object.getPrototypeOf(this).url.call(this)}}this._initTaggerProxy();if(widget){this.listenTo(widget,{onSearch:this.onSearch,onResetSearch:this.onResetSearch})}},create:function(l,n){if(!this._modelKey&&!this._modelKey instanceof b){throw new Error("Your contents is not associated with a collabspace!")}var m,q,o=this,p=this._modelKey;n=n?g.clone(n,false):{};m=o._prepareModel(l,n);if(!m){return false}if(!n.wait){o.add(m,g.extend({isProgress:true},n))}q=n.onComplete;n.onComplete=function(t,s,r){g.extend(r,s);r.onComplete=function(v,w,u){u.onComplete=function(y,z,x){y.dispatchEvent("onLoad");if(x.wait){o.add(y,x)}if(q){return q(y,z,x)}};v.save(null,g.extend({url:j(v,"url")+"?receipt="+encodeURIComponent(w.receipt),type:"json"},u))};m.createAssociatedBO(r)};p.getTicket(g.extend({model:m},n));return m},getPreviews:function(n){if(this.isEmpty()){return}var l=this.filter(function(r){return r.get("businessobj").type.value==="Document"});if(l.length===0){return}if(!n){n={}}var p=this,o,m=j(this,"url")+"/previews",q=n.onComplete;n.onComplete=function(t){var r,s;t=p.parsePreviews(t);t.forEach(function(u){r=p.get(u.id);if(r){s=r.get("businessobj");r.set("businessobj",g.merge({thumbnail:u.thumbnail},s))}});if(q){return q(p,t,n)}};e.authenticatedRequest(m,g.extend(n,g.extend(c.getSyncOptions(),{type:"json",data:{ids:l.map(function(r){return r.id}).reduce(function(r,s){return r+","+s})}},true),true));return o},parsePreviews:function(l){return l},focusTaggerProxyOnSubject:function(m){if(!this.taggerProxy){return}var l=this.get(m);if(l){l.focusTaggerProxyOnSubject()}},unfocusTaggerProxy:function(){var l=this.taggerProxy;if(!this.taggerProxy){return}l.unfocus()},activateTaggerProxy:function(){var l=this.taggerProxy;if(!this.taggerProxy){return}l.activate()},deactivateTaggerProxy:function(){var l=this.taggerProxy;if(!this.taggerProxy){return}l.deactivate()},onReset:function(){this.getPreviews()},onFilterChange:function(l){this.filterTagObj=l;this.isNewFilter=true;this.taggerProxy.setTags({},[]);this.dispatchEvent("onTaggerProxyFilterChange")},onUnfocusSubjects:function(){this.dispatchEvent("onTaggerProxyUnfocusSubjects")},onSearch:function(n){if(n){var l=(g.is(this.url,"function"))?this.url():this.url;var m=l+"?q="+n;if(m!=this.currentSearchUrl){this.currentSearchUrl=m;this.dispatchEvent("onSearch")}}},onResetSearch:function(){if(this.currentSearchUrl){delete this.currentSearchUrl;this.dispatchEvent("onResetSearch")}},destroy:function(){var l=this.taggerProxy;if(l){this.stopListening(l,this._taggerProxyEvents);l.die();delete this.taggerProxy}this.stopListening(widget);return this._parent.apply(this,arguments)}});return i});define("DS/W3DSpace/Collections/CollabSpacesCollection",["UWA/Core","DS/WAFData/WAFData","DS/WebAppsFoundations/Collections/PageableCollection","UWA/Class/Model","UWA/Class/Collection","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/Models/CollabSpaceModel"],function(f,e,d,j,h,b,a){var g="collabspaces";function i(k,m){var l;if(k){l=k[m];if(f.is(l,"function")){l=l.call(k)}}return l}var c=d.extend({defaultOptions:{mode:"data",state:{firstPage:0,currentPage:0,pageSize:20},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"csTotal"}},name:g,model:a,url:function(){return"/resources/enocsmrest/"+this.name},parseResponseForStateUpdate:function(n,l,m,k){return{totalRecords:n.csTotal}},parseRecords:function(l,k){return l.items},setup:function(m,k){var l=k.storage;if(l&&l instanceof j){this._storage=l}},getTenantUrl:function(){var k=new RegExp("^(.+)/resources/enocsmrest/"+this.name+"$");return k.exec(i(this,"url"))[1]},sync:function(m,l,k){f.extend(k,b.getSyncOptions(),true);if(!k.data){k.data={}}if(!k.data.fields){k.data.fields="actions,contexts,created,description,family,owner,solution,visibility,title"}this._parent.apply(this,arguments)},getPreviews:function(l){if(this.isEmpty()){return}if(!l){l={}}var n=this,m,k=i(this,"url")+"/previews",o=l.onComplete;l.onComplete=function(q){var p;q.forEach(function(r){p=n.get(r.id);if(p){p.set("thumbnail",r.thumbnail)}});if(o){return o(n,q,l)}};e.authenticatedRequest(k,f.extend(l,f.extend(b.getSyncOptions(),{type:"json",data:{ids:this.pluck(this.model.prototype.idAttribute).reduce(function(p,q){return p+","+q})}},true),true));return m},onReset:function(){this.getPreviews()}});return c});define("DS/W3DSpace/Models/InvitationModel",["UWA/Core","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap"],function(c,b,a){var d=b.extend({defaults:{addoncommonspace:false,sendemail:false,givecreationright:false,managevisibility:false,hasreaderrole:false,haspublicreaderrole:false},idAttribute:"addoncommonspace",sync:function(g,f,e){e=e?c.clone(e,false):{};c.extend(e,a.getSyncOptions(),true);return this._parent.apply(this,[g,f,e])},url:function(){var f=a.getStorage().get("url");var e=f+"/resources/enocsmrest/admin/config";return e}});return d});define("DS/W3DSpace/Models/AdminCollabSpaceModel",["UWA/Core","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap"],function(c,b,a){var d=b.extend({idAttribute:"name",sync:function(g,f,e){c.extend(e,c.extend(a.getSyncOptions(),{attrs:JSON.stringify(f.toJSON(e))},true),true);delete e.data;return this._parent.apply(this,arguments)},parse:function(e){!c.is(e.description)&&(e.description="");return e},});return d});define("DS/W3DSpace/Views/ModalEditVisibility",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/W3DSpace/Views/EditVisibilityView","DS/UIKIT/Alert","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(b,g,a,f,d,e){var c=g.extend({init:function(p){var k=this,o,j,i,m,l,n,h=new d({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});p=b.clone(p||{},false);this._parent(p);o=b.clone(p.events||{},false);j=p.onComplete;i=p.onFailure;m=o.onCancel;n=function(){document.removeEventListener("keydown",l.onKeyDown);l.destroy();k.destroy()};o.onCancel=function(){n();if(b.is(m)){m.apply(this,arguments)}};p.events=o;p.onComplete=function(){n();if(b.is(j)){j.apply(undefined,arguments)}h.add({message:e.successEditVisibility})};p.onFailure=function(){n();if(b.is(i)){i.apply(undefined,arguments)}};l=new f(p);this.elements.modal=new a({closable:true,header:e.editVisibility,form:l,body:l.render(),footer:[l.getEditButton(),l.getCancelButton()]})},show:function(){var i=this.elements,h=i.modal;h.inject(document.body);h.show();h.options.form.getFormFirstInput().focus()}});return c});define("DS/W3DSpace/Views/ModalChangeOwner",["UWA/Drivers/Alone","UWA/Controls/Abstract","UWA/Core","DS/WAFData/WAFData","UWA/Controls/Input","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/W3DSpace/EnoviaBootstrap","UWA/Class/Collection","DS/W3DXComponents/Views/Item/LabelManagerView","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter"],function(e,g,n,k,i,p,j,h,b,d,l,o){var f=null,c=new p({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"}),a=new p({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});var m=g.extend({init:function(q){this._parent(q);this.resetModal();this.model=q.model;this._selectedOwner=null},showModal:function(){this.modal.inject(document.body);this.modal.show()},getBody:function(){this.labelManager=new l({domEvents:{"click .supp-icon":function(){this.container.getElement("form").show();this.onClickSuppCalled.apply(this,arguments)}},categories:[{id:"mainOwner",name:o.labelMainOwner}],labelFormat:"{fname} {lname}",suggestKey:"login",placeholder:o.placeholderTxt,getSuggestions:function(w,u,v){var t,s,r=new RegExp("/session");if(!w){return}if(f){f.cancel()}if(u[w]){v(u[w])}else{t=b.getStorage().get("url");t=t.split(r)[0];t=t+"/resources/enocsmrest/admin/peoples?filter="+w+"&limit=10";s=n.extend({type:"json",onComplete:function(x){v(x.peoples)}},b.getSyncOptions());f=k.authenticatedRequest(t,s)}},});var q=this.labelManager.addObject;this.labelManager.addObject=function(s,u,v,r,t){t.hide();q.apply(this,arguments)};return this.labelManager.render().getContent()},getFooter:function(){var r=this;var q=new h({value:o.save,className:"primary",events:{onClick:function(){r.onSaveCalled()}}});var s=new h({value:o.cancel,className:"default",events:{onClick:function(){r.onCancelCalled()}}});return[q,s]},onSaveCalled:function(){var t=this.labelManager.getJsonObjects()[0];if(t){var r=this.model,q=t.selection,s=r.get("owner");r.save({title:r.get("title"),owner:{login:q}},{onFailure:function(u){c.add({message:o.errorChangeOwner});u.set("owner",s)},onComplete:function(){a.add({message:o.replace(o.successChangeOwner,{tag1:r.get("owner").name})})}});this.modal.destroy();this.resetModal()}},onCancelCalled:function(){this.modal.destroy();this.resetModal()},resetModal:function(){this.modal=new j({className:"changeowner",closable:true,header:o.modalHeader,body:this.getBody(),footer:this.getFooter()})},onDestroy:function(){this.alert.destroy()}});return m});define("DS/W3DSpace/Collections/AdminCollabSpacesCollection",["UWA/Core","UWA/Class/Model","DS/WebAppsFoundations/Collections/PageableCollection","DS/W3DSpace/Models/AdminCollabSpaceModel","DS/W3DSpace/EnoviaBootstrap"],function(d,c,f,e,a){var b=f.extend({name:"collabspaces",defaultOptions:{mode:"data",state:{firstPage:0,currentPage:0,pageSize:25},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"csTotal"}},model:e,url:function(){return"/admin/"+this.name},setup:function(k,g){var h=g._modelKey,i,j;if(h&&h instanceof c){this._modelKey=h;this.url=h.url()+Object.getPrototypeOf(this).url.call(this)}if(widget){this.listenTo(widget,{onSearch:this.onSearch,onResetSearch:this.onResetSearch})}},sync:function(i,h,g){d.extend(g,a.getSyncOptions(),true);this._parent.apply(this,arguments)},fetch:function(g){if(this.currentSearchUrl){g.url=this.currentSearchUrl}return this._parent.call(this,g)},parseResponseForStateUpdate:function(j,h,i,g){return{totalRecords:j.csTotal}},parseRecords:function(h,g){return h.items},onSearch:function(i){if(i){var g=(d.is(this.url,"function"))?this.url():this.url;var h=g+"?filter="+i;if(h!=this.currentSearchUrl){this.currentSearchUrl=h;this.dispatchEvent("onSearch")}}},onResetSearch:function(){this.currentSearchUrl=null;this.dispatchEvent("onResetSearch")}});return b});define("DS/W3DSpace/Views/CreateCSViewSimple",["UWA/Core","UWA/Element","DS/WAFData/WAFData","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Alert","UWA/Class/View","DS/W3DSpace/EnoviaBootstrap","css!DS/W3DSpace/W3DSpace.css","css!DS/UIKIT/UIKIT.css"],function(i,j,h,f,g,a,d,e,b,c){var k=b.extend({name:"Collaborative Space Creation",tagName:"div",className:"create-cs-view",init:function(l){var m=UWA.clone(l,false);["container","template","tagName","domEvents"].forEach(function(n){delete m[n]});this._parent(m)},setup:function(){this.container.addClassName(this.getClassNames("-container"));this._initAlert();this._initForm()},_initAlert:function(){var l={className:"create-alert",closable:true,renderTo:document.body,visible:true};this.elements.alertFailure=new e(i.extend({messageClassName:"error"},l));this.elements.alertSuccess=new e(i.extend({messageClassName:"success"},l))},_initForm:function(){var r=this,t=this.options,l=this.elements,p=l.alertFailure,n,o,m,q,s;n=function(v,u){if(v){l.create.setDisabled();u.addClassName("has-error");p.add({message:v})}else{l.create.setDisabled(false);u.removeClassName("has-error")}};o=[{type:"text",name:"title",label:"Title",placeholder:"Enter title...",events:{onChange:function(){console.log(this.getValue());var u=null;var w=this.getValue();if(!w||w.length===0){u="The title cannot be empty"}var v=new RegExp("[\\\\\"#$@%*,?<>[\\]|/:.']","i");if(v.test(w)){u="The title cannot include the characters \\ \" # $ @ % * , ? < > [ ] | / : . '"}v=new RegExp("\\s$","i");if(v.test(w)){u="The title cannot finish by a space"}n(u,this.elements.input)}}},{type:"text",name:"owner",label:"Owner",placeholder:"Enter owner...",events:{onChange:function(){console.log(this.getValue());var u=null;var w=this.getValue();if(!w||w.length===0){u="The owner cannot be empty"}var v=new RegExp("[\\\\\"#$@%*,?<>[\\]|:.']","i");if(v.test(w)){u="The owner cannot include the characters \\ \" # $ @ % * , ? < > [ ] | : . '"}n(u,this.elements.input)}}}];m=new f({fields:o});q=new g({value:"Create",className:"primary",events:{onClick:this.dispatchAsEventListener("onCreate")}});l.form=m;l.create=q},render:function(){var o=this.elements,n=o.form,l=o.create,m=o.cancel;this.container.setContent([n,{tag:"div","class":"footer",html:[l,m]}]);return this},resetForm:function(){var l=this;this._initForm();this.render()},onCreate:function(){var s=this,v=this.options,p=v.onComplete,o=v.onFailure,t=this.elements.form.getValue("title"),n=this.elements.form.getValue("owner");if(t===""){s.elements.alertFailure.add({message:"The title cannot be empty"});return}if(n===""){s.elements.alertFailure.add({message:"The owner cannot be empty"});return}this.elements.create.setDisabled();v.onFailure=function(w){s.elements.alertFailure.add({message:"Creation has failed."});s.resetForm()};v.onComplete=function(w){s.elements.alertSuccess.add({message:"Collaborative Space "+t+" has been created successfully."});s.resetForm()};var r=c.getStorage();var m=r.get("url");var l=m+"/resources/ENOCsm/cstorage/createcollabspace";l+="?name="+encodeURIComponent(t)+"&owner="+encodeURIComponent(n);var u=r.get("id");if(u!==""){l+="&tenant="+u}var q=h.authenticatedRequest(l,i.extend(v,{method:"POST"},true));return q}});return k});define("DS/W3DSpace/Models/VersionModel",["UWA/Core","DS/WAFData/WAFData","DS/W3DSpace/Models/ContentModel","DS/W3DSpace/EnoviaBootstrap"],function(e,c,f,b){function a(g,i){var h;if(g){h=g[i];if(e.is(h,"function")){h=h.call(g)}}return h}var d=f.extend({defaults:function(){return{title:"",file:"",modified:"",filedescription:"",download:"",preview:"",index:"",physicalid:"",versionnumbers:"",actions:["download"]}},idAttribute:"physicalid",actions:null,getPreview:function(i){if(!i){i={}}var h=this.collection._modelKey,j,g=a(h,"url")+"/preview",k=i.onComplete;i.onComplete=function(m){var l;m=h.parsePreview(m);l=h.get("businessobj");h.set("businessobj",e.merge({thumbnail:m.thumbnail},l));if(k){return k(h,m,i)}};c.authenticatedRequest(g,e.extend({type:"json"},e.extend(i,b.getSyncOptions(),true)));return j},});return d});define("DS/W3DSpace/Collections/VersionsCollection",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/Models/VersionModel","DS/W3DSpace/Models/ContentModel","DS/W3DSpace/Models/CollabSpaceModel"],function(f,j,d,c,g,a,b){var h="versions";function i(k,m){var l;if(k){l=k[m];if(f.is(l,"function")){l=l.call(k)}}return l}var e=d.extend({model:g,name:h,url:function(){return"/"+this.name},parse:function(l){for(var k=0;k<l.length;k++){l[k].index=k+1}return l},sync:function(m,l,k){f.extend(k,c.getSyncOptions(),true);this._parent.apply(this,arguments)},setup:function(o,k){var l=k._modelKey,m,n;if(l&&l instanceof j){this._modelKey=l;this.url=i(l,"url")+Object.getPrototypeOf(this).url.call(this);m=l.get(this.name);if(Array.isArray(m)&&m.length){n=m.map(function(p){return new this.model(p)});this.reset(n,Core.extend({silent:true},k))}}},create:function(k,m){if(!this._modelKey&&!this._modelKey instanceof a){throw new Error("Your versions is not associated with a content!")}var l,r,o=this,q,n=this._modelKey;if(!n.collection&&!n.collection._modelKey instanceof b){throw new Error("Your contents is not associated with a collabspace!")}var p=n.collection._modelKey;m=m?f.clone(m,false):{};l=o._prepareModel(k,m);if(!l){return false}if(!m.wait){o.add(l,f.extend({isProgress:true},m))}r=m.onComplete;m.onComplete=function(u,t,s){f.extend(s,t);s.onComplete=function(w,y,v){v.onComplete=function(A,B,z){A.collection._modelKey.dispatchEvent("onLoad");if(r){return r(A,B,z)}};var x=v.model;v.method="POST";x.save(null,f.extend({url:i(x.collection,"url")+"?receipt="+encodeURIComponent(y.receipt),type:"json"},v))};p.checkInThumbnailFile(s)};p.getTicket(f.extend({model:l},m));return l}});return e});define("DS/W3DSpace/Models/CollabStorageModel",["UWA/Core","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap"],function(f,e,b){function a(g,i){var h;if(g){h=g[i];if(f.is(h,"function")){h=h.call(g)}}return h}var c="collabstorage";var d=e.extend({name:c,defaults:{csrf:null,isInnovation:false,displayName:"",url:""},url:function(){return this.get("url")+"/resources/enocsmrest/session"},fetch:function(h){var g=a(this,"url");h=h?f.clone(h,false):{};f.extend(h,b.getSyncOptions(),true);return this._parent.call(this,h)},parse:function(h){var g=f.clone(h);g.csrf=h.csrftoken;delete g.csrftoken;g.isInnovation=h.isinnovation;delete g.isinnovation;return g}});return d});define("DS/W3DSpace/Collections/CollabStorageCollection",["UWA/Core","UWA/Utils","UWA/Class/Collection","DS/PlatformAPI/PlatformAPI","DS/W3DSpace/Models/CollabStorageModel","DS/i3DXCompassServices/i3DXCompassServices",],function(e,c,h,f,d,a){var g="collabstorages";function i(j,l){var k;if(j){k=j[l];if(e.is(k,"function")){k=k.call(j)}}return k}var b=h.extend({name:g,model:d,fetch:function(j){var k=this;a.getPlatformServices({onComplete:function(l){Object.keys(l).map(function(m){if(l[m]["3DSpace"]){k.add({id:l[m].platformId,displayName:l[m].displayName,url:l[m]["3DSpace"]})}});if(j&&j.onComplete){j.onComplete(k)}},onFailure:function(l){if(j&&j.onFailure){j.onFailure(l)}}})},getStorageWithUrl:function(k,j){j=e.clone(j||{},false);var m=c.parseUrl(k).domain,l;l=function(o){var n=c.parseUrl(i(o,"url")).domain;return n===m};if(!e.is(m)){return}return this.find(l)}});return b});define("DS/W3DSpace/W3DSpaceCreateCSWidget",["UWA/Core","UWA/Class","DS/UIKIT/Alert","DS/W3DSpace/Collections/CollabStorageCollection","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/Views/CreateCSViewSimple","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(j,k,n,d,c,m,l){var f,g,i=false,e,a=false;function h(s){if(!s){return}var q,o={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[],onchange:"onStorageChange"},r=widget.getValue("collab-storage");if(r===""){var p=widget.getValue("x3dPlatformId");q=s.get(p);if(!q){q=s.at(0)}if(q){widget.setValue("collab-storage",q.id)}}else{q=s.get(r)}s.forEach(function(t){var v,u;u=t.get("displayName").unescapeHTML();v=t.get("id");o.options.push({label:u,value:v})});if(s.length===1&&q){o.type="hidden"}widget.addPreference(o);if(a){widget.dispatchEvent("onEdit",["refreshPrefs"]);if(!q){q=s.at(0)}}if(q){g.onStorageChange("collab-storage",q.id)}else{f.add({message:l.updatePreference,className:"warning"})}return q}function b(){if(i){return}if(!widget){throw new Error("W3DSpaceCreateCSWidget must be executed in a widget environement")}e=new d();widget.setTitle("Create a Collaborative Space");i=true}g={onLoad:function(){c.start({id:widget.id,collection:e});e.fetch({onComplete:function(s,r,q){h.call(undefined,s)},onFailure:function(q){f.add({message:"Error while getting storage",className:"error"})}});widget.setBody([{tag:"div",id:"widget-content"}]);f=new n({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"});var o={};var p=new m(o);p.render().inject(widget.body.getElement("#widget-content"))},onStorageChange:function(o,p){var q=e.get(p);c.onStorageChange(q)}};b();return g});define("DS/W3DSpace/Views/ContentPropertiesView",["UWA/Core","DS/UIKIT/Alert","DS/W3DXComponents/Views/Temp/TempItemView","DS/W3DSpace/Collections/VersionsCollection","DS/W3DSpace/Views/ModelForm","DS/W3DXComponents/Views/Layout/ScrollView","DS/W3DXComponents/Views/Layout/TableView","DS/W3DXComponents/IdCard","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(h,k,b,g,d,a,e,c,j){var i="content-properties";var f=b.extend({name:i,tagName:"div",template:function(){return'<div class="'+this.getClassNames("-subcontainer")+'"></div>'},domEvents:{},init:function(l){var m=this;["container","template","tagName","domEvents"].forEach(function(n){delete l[n]});this._parent.call(this,l)},setup:function(l){this.container.addClassName(this.getClassNames("-container"));this._form=this._initForm();this._initVersions();this.alert=new k({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"error"})},_initForm:function(){var l=this.model;var m={className:"vertical",fields:function(){var o=[{type:"text",name:"type",attributes:{"data-attr":"return this.get('businessobj').type.name","data-icon":"return this.get('businessobj').icon","data-editable":false},label:j.type},{type:"textarea",name:"description",attributes:{"data-attr":"return this.get('businessobj').description","data-editable":"return this.get('actions').indexOf('edit') !== -1"},rows:5,label:j.description,placeholder:""},{type:"date",name:"created",attributes:{"data-attr":"return new Date(this.get('businessobj').created * 1000)","data-editable":false},label:j.created},{type:"date",name:"modified",attributes:{"data-attr":"return new Date(this.get('businessobj').modified * 1000)","data-editable":false},label:j.modified},{type:"text",name:"owner",attributes:{"data-attr":"return this.get('businessobj').fullnameowner","data-editable":false},label:j.owner}];if(l.collection._modelKey.collection._storage.get("isInnovation")){o.splice(5,0,{type:"text",name:"maturity",attributes:{"data-attr":"return this.get('businessobj').maturity.name","data-editable":false},label:j.maturity})}return o},buttons:[{type:"submit",value:j.save},{type:"reset",value:j.cancel}]};var n=this.formProperties=new d(h.extend({model:this.model,events:{onSubmit:this._onFormSubmit.bind(this),onReset:this._onFormReset.bind(this)}},m));return n},setOptions:function(m){var l=m.idCard;if(l){this._setIdCard(l);delete m.idCard}return this._parent.apply(this,arguments)},_setIdCard:function(l){if(!(l instanceof c)){throw new Error("You try to set idCard option with no instance of idCard")}if(this._idCard){return}this._idCard=l;this.listenTo(l,{onSwitchToEditMode:this.dispatchAsEventListener("onEdit"),onTitleChangeRequest:this._onTitleChange});if(l._mode===1){this.dispatchEvent("onEdit")}},_resetIdCard:function(){this._idCard._refreshSection("title");this._idCard._refreshSection("date");return this._switchIdCardToViewMode()},_switchIdCardToEditMode:function(){var l=this._idCard;if(l){l.switchToEditMode()}return l},_switchIdCardToViewMode:function(){var l=this._idCard;this._idCard._refreshSection("date");if(l){l.switchToViewMode()}return l},reset:function(){var l=this._form;this._resetIdCard();l.reset();return this},_initVersions:function(){var m=this;var n=new g([],{_modelKey:m.model,});var l=this.tableVersions=new e({collection:n,headers:[{property:"index",label:j.versionNumber},{property:"title",label:j.versionTitle},{property:"modified",type:"date",label:j.versionDate},{property:"filedescription",label:j.versionComments},{label:j.versionActions,actions:true}],itemViewOptions:{contextualActions:function(){return this.get("actions").map(function(o){switch(o){case"download":return{text:j.download,fonticon:"download",handler:function(p){p.model.download()}};break;default:return null}}).filter(function(o){return o})}}});n.fetch({onComplete:function(){if(!n.isEmpty()){m.tableVersions.show()}}});return l},onRender:function(){var l=this.getElement(".content-properties-subcontainer");this.formProperties.inject(l);this.tableVersions.render().inject(l);l.render=function(){};l.container=l;var m=new a({view:l,useInfiniteScroll:false,usePullToRefresh:false});m.render().inject(this.container)},_onTitleChange:function(m,l){this.newtitle=m},_onFormSubmit:function(t){var o=this,p=this.model,q=this.alert,v={onFailure:function(x,y,w){o.reset();q.add({message:j.errorEdit})},type:"json",wait:true};var s=!(typeof this.newtitle=="undefined")&&this.newtitle!=null;if(s){var r=null;if(!this.newtitle||this.newtitle.length===0){r=j.errorEmptyTitle}if(this.newtitle.length>128){r=j.errorTooLong}var m=this._idCard._controls.titleInput.elements.container;if(r){m.addClassName("has-error");q.add({message:r});this.formProperties.dispatchEvent("onEdit");return}else{m.removeClassName("has-error")}}this._switchIdCardToViewMode();var l=p.get("businessobj");var n=(l.description!=t.description);l.description=t.description;if(s){l.title=this.newtitle}var u={businessobj:l};if(s||n){p.save(u,v)}this.dispatchEvent("onEndEdit")},_onFormReset:function(){this._resetIdCard();this.dispatchEvent("onEndEdit")},onFacetSelect:function(m){var l;l=m.getIdCardAt(2);this.setOptions({idCard:l})},onEdit:function(){var l=this.formProperties;l.dispatchEvent("onEdit")},onEndEdit:function(){delete this.newtitle},onDestroy:function(){if(this.formProperties){this.formProperties.destroy();delete this.formProperties}if(this.tableVersions){this.tableVersions.destroy();delete this.tableVersions}}});return f});define("DS/W3DSpace/SkeletonUtils/ContentSkeletonOptions",["UWA/Drivers/Alone","UWA/Core","DS/WAFData/WAFData","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Form","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/W3DXComponents/Views/Temp/TempItemView","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/EmptyView","DS/W3DSpace/Models/ContentModel","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/Views/ContentPropertiesView","DS/W3DSpace/Collections/VersionsCollection","DS/TopBarProxy/TopBarProxy","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(c,F,q,m,a,s,d,C,g,K,J,E,I,u,b,k,i){var H,z=new m({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"}),o=new m({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"}),p=".3dxml, .step, .stp, .stpz, .ifc, .ifczip, .smg, .jpg, .jpeg, .png, .gif, .tif, .tiff, .bmp, .svg, .flv, .avi, .mov, .wmv, .mpg, .mpeg, .mp4, .m4v, .rm, .webm, .mkv, .mp3, .wav, .aac, .m4a, .wma, .ra, .ogg, .doc, .docx, .ppt, .pptx, .pps, .ppsx, .xls, .xlsx, .xlsm, .pdf, .zip, .txt, .csv, .json, .xml, .geojson, .mdb, .gml, .kml, .sdm , .str , .mineschedanimation",x,y,f={DELETE:"delete",DOWNLOAD:"download",UPDATE:"update",UPLOAD:"upload",FILE_EXTENSION:"fileExtension",ACTION:"action",FETCH:"fetch"};function t(M){if(!F.is(M,"string")){return}var N,O;N=M.match(/\.([^.]+)$/);if(N!==null&&N.length===2){O=N[1].toLowerCase()}return O}function G(M){return p.indexOf(t(M))!==-1}function h(Q,X){function V(Z){var Y;Y="";if(F.is(Z,"string")){Y=i.replace(i.errorDeleteDoc,{title:Z})}return Y}function O(Z){var Y;Y="";if(F.is(Z,"string")){Y=i.replace(i.errorDownload,{tag1:Z})}return Y}function P(Z){var Y;Y="";if(F.is(Z,"string")){Y=i.replace(i.errorUpdate,{tag1:Z})}return Y}function U(Z){var Y;Y="";if(F.is(Z,"string")){Y=i.replace(i.errorUpload,{tag1:Z})}return Y}function N(Z){var ab,Y,aa;ab=i.replace(i.errorFileExtension,{tag1:t(Z)});if(F.is(Z,"string")){Y=".sldprt, .sldasm, .dwg, .catpart, .catproduct";aa=Y.indexOf(t(Z))!==-1;if(aa){ab=i.replace(i.errorLegacyExtension,{tag1:t(Z)})}}return ab}function R(){return i.errorAction}function S(){return i.errorFetchContents}if(!F.is(Q,"string")){throw new Error("You must provide an error input")}var W,T,M;X=X||{};T=X.title;switch(Q){case f.DELETE:W=V(model);break;case f.DOWNLOAD:W=O(model);break;case f.UPDATE:W=P(model);break;case f.UPLOAD:W=U(model);break;case f.FILE_EXTENSION:M=X.filename;W=N(M);break;case f.ACTION:W=R();break;case f.FETCH:W=S();break;default:W="";break}return W}function A(R,M,T,Q){var S=T.model.get("id"),P=this.collection,N=P._modelKey.id,O;switch(S){case"add.contents":O=c.createElement("input",{attributes:{type:"file",accept:p,multiple:true},styles:{display:"none"},events:{change:function(){var W=this.files,Z,Y,U;O.remove();for(var V=0,X;X=W[V];V++){Y=X.name;if(G(Y)){Z=F.merge({title:Y.substring(0,Y.lastIndexOf(".")),file:Y},E.prototype.defaults.businessobj);P.create({businessobj:Z,collabspace:N},{file:X,onFailure:function(ab,ac,aa){ab.destroy();!U&&z.add({message:i.replace(i.errorUpload,{tag1:ab.get("businessobj").title})})},onTimeout:function(){U=true;this.dispatchEvent("onFailure",arguments)},onComplete:function(aa){o.add({message:i.replace(i.successUpload,{tag1:aa.get("businessobj").title})})},headers:{"Content-type":"application/json"}})}else{z.add({message:h(f.FILE_EXTENSION,{filename:Y})})}}}}});O.inject(document.body);O.click();break;default:console.log(S+" is not permitted in the action bar.");break}}function l(){var M=this,P=this.collection,O,Q,N=H.getFetchOptions();O=N.onComplete;N.onComplete=function(T,S,R){if(M.container.offsetParent){M.container.removeClassName("loading");Object.keys(M.contentsViews).map(function(U){M.contentsViews[U].scrollView.endLoading()})}if(O){O(M,S,R)}};if(P.state.totalRecords===null){P.getFirstPage(N)}else{if(P.hasNextPage()){P.getNextPage(F.extend(N,{remove:false,reset:false}))}else{M.container.removeClassName("loading");Object.keys(M.contentsViews).map(function(R){M.contentsViews[R].scrollView.useInfiniteScroll(false)})}}}function e(){var M=this;this.collection.getFirstPage(F.extend({onComplete:function(){M.scrollView.endLoading()}},H.getFetchOptions()))}function w(N,M){}function D(M){return{envId:I.getStorage().id,serviceId:"3DSpace",contextId:M.collection._modelKey.getNominalContext(),objectId:M.get("id"),objectType:M.get("businessobj").type.value,displayName:M.get("businessobj").title,displayType:M.get("businessobj").type.name,displayIcon:M.get("businessobj").icon,displayPreview:M.get("businessobj").thumbnail}}function n(M){return{protocol:"3DXContent",version:"1.0",source:"X3DCSMA_AP",data:{items:[M]}}}function L(){var N,P,O,M;console.log("onItemViewDrag");N=arguments[arguments.length-2];P=arguments[arguments.length-1];if(N){O=N.model;P.dataTransfer.setData("text",JSON.stringify(n(D(O))))}}function v(){var O,Q,M;O=arguments[arguments.length-1];if(O){Q=O.model;Q.focusTaggerProxyOnSubject();x=Q.get("businessobj");var P=D(Q);M=I.getCompassSocket();if(M){M.dispatchEvent("onSetObject",P);M.dispatchEvent("onSetX3DContent",n(P))}else{console.log("Warning ContentSkeletonOptions socket is not defined")}if(widget===undefined){if(getTopWindow){var N=getTopWindow().findFrame(getTopWindow(),"content");if(N){N.arrObjectId=[];N.arrObjectId[0]=Q.id}}}}}function j(){var N,P,M;x=undefined;N=arguments[arguments.length-1];if(N){P=N.collection;P.unfocusTaggerProxy();M=I.getCompassSocket();if(M){M.dispatchEvent("onResetObject",{});M.dispatchEvent("onResetX3DContent",{})}if(widget===undefined){if(getTopWindow){var O=getTopWindow().findFrame(getTopWindow(),"content");if(O){O.arrObjectId=[]}}}}}function B(){var M=this.collection;if(M){M.activateTaggerProxy();if(M.isNewFilter){M.fetch(H.getFetchOptions())}}require(["DS/SwymPublishForm/script/publish-form-view","DS/W3DSpace/Views/ModalShareContent"],function(O,N){if(y===undefined){y=new k({id:widget.id});var P=function(R){var S=x;var Q=new N({model:S,widget:widget,url:I.getSwymUrl()});Q.show()};y.addOnSubMenuDisplayedEvent({share:function(Q){var R=Q.get("submenu");if(x&&I.getSwymUrl()){if(x.type.value==="Document"){if(R.length===0){R.add({label:i.shareContent,onExecute:P})}}else{if(R.length===1){R.remove(R.slice(0))}}}else{if(R.length===1){R.remove(R.slice(0))}}Q.fireOnSubMenuReady()}})}})}function r(){if(this.collection){this.collection.deactivateTaggerProxy()}}H={getFetchOptions:function(M){return{type:"json",reset:true,onFailure:function(){z.add({message:i.errorFetchContents})}}},getIdCardOptions:function(M){return{collapsed:M.minimizeIdCardView,editableElements:function(){return this.get("actions").map(function(N){switch(N){case"edit":return"title";break;default:return null}}).filter(function(N){return N})},thumbnailUrl:function(){return this.get("businessobj").thumbnail},attributesMapping:{title:function(){return this.get("businessobj").title},ownerName:function(){return this.get("businessobj").fullnameowner},date:function(){var N=new Date(this.get("businessobj").modified*1000);return N.toGMTString().parseRelativeTime()}},actions:function(){var O=[],N=true;N=N&&this.get("actions").some(function(P){return P.indexOf("edit")!==-1});return N?[{text:i.editProperties,icon:"pencil",handler:function(R,Q){var P;this.selectFacet("properties");this.switchToEditMode()}}]:[]},facets:[{name:"view",text:i.view,icon:"eye",handler:K.getRendererHandler("DS/W3DSpace/Views/DetailView",{viewOptions:{asset:{serverurl:I.getStorage().get("url"),server:I.getStorage().get("url")}}})},{name:"properties",text:i.properties,icon:"doc-text",handler:K.getRendererHandler(u)}]}},getContentSetOptions:function(M){return{className:"loading",actions:{filterer:function(O,N){return !!O.get("actionBar")&&O.id.indexOf(".contents")!==-1},collection:function(){var O=this.collection,N=O._modelKey;return N&&N.actions}},contents:{selectionMode:"oneToOne",headerOnEmpty:false,headers:[{property:"title",label:i.title},{property:"subtitle",icon:"icon",label:i.type},{property:"owner",label:i.owner},{property:"content_modified",sortable:true,label:i.modified,type:"date"},{property:"content_created",sortable:true,label:i.created,type:"date"},{label:i.actions,actions:true}],sort:function(S,P,Q){var R=Q.split(/[\.\[\]]/).pop();R=(R==="created")?"originated":R;var N=(P==="ascending")?"a":"d";N=N+R;var O=F.extend(H.getFetchOptions(),{data:{sort:N}});S.getFirstPage(O)},itemViewOptions:{mapping:{title:"businessobj.title",owner:"businessobj.fullnameowner",content:function(){var P,Q=this.model.get("businessobj"),N,O;if(!Q){return}N=new Date(this.model.get("businessobj").modified*1000);O=this.model.get("businessobj").description;P=N.toGMTString().parseRelativeTime();if(O){P+=("<br/>"+O)}return P},content_modified:"businessobj.modified",content_created:"businessobj.created",icon:"businessobj.icon",image:"businessobj.thumbnail",subtitle:"businessobj.type.name"},contextualActions:function(){var N=this.collection;return this.get("actions").map(function(O){switch(O){case"delete":return{text:i.toDelete,fonticon:"trash",handler:function(P){var R,T,Q;function S(){P.model.destroy({onFailure:function(U){N.add(U);z.add({message:i.replace(i.errorDeleteDoc,{title:U.get("businessobj").title})})},onComplete:function(V,Y){if(Y.status==="failure"){var U;var X=" ";if(Y.report){for(var W=0;W<Y.report.length;W++){X+=Y.report[0].error+" "}U=i.replace(i.errorDelete,{title:V.get("businessobj").title,errorMessage:X})}N.add(V);z.add({message:U})}else{o.add({message:i.replace(i.successDelete,{tag1:V.get("businessobj").title})})}}})}T=new C({value:i.toDelete,className:"primary",events:{onClick:function(){Q.destroy();S()}}});R=new C({value:i.cancel,events:{onClick:function(){Q.destroy()}}});Q=new a({closable:true,header:i.replace(i.deleteObj,{name:P.model.get("businessobj").title}),body:i.confirmationDeleteMessage,footer:[T,R]}).inject(document.body);Q.show()}};break;case"download":return{text:i.download,fonticon:"download",handler:function(R){var Q,S,P={onFailure:function(U,V,T){z.add({message:i.replace(i.errorDownload,{tag1:U.get("businessobj").title})})}};S=navigator.userAgent.match(/(iPhone|iPad|iPod)/g)?true:false;if(S){F.extend(P,{onComplete:function(U,V,T){Q=V.url},async:false});R.model.getDownloadUrl(P);window.open(Q,"_blank")}else{R.model.download(P)}}};break;case"update":return{text:i.update,fonticon:"upload",handler:function(R){var Q,P=new b([],{_modelKey:R.model});Q=c.createElement("input",{attributes:{type:"file",accept:p},styles:{display:"none"},events:{change:function(){var S=this.files[0],T=S.name;if(G(T)){P.create({title:T,file:T},{file:S,onFailure:function(V,W,U){z.add({message:i.replace(i.errorUpdate,{tag1:V.get("title")})})},onComplete:function(U){o.add({message:i.replace(i.successUpdate,{tag1:U.get("title")})})},headers:{"Content-type":"application/json"}})}else{z.add({message:h(f.FILE_EXTENSION,{filename:T})})}}}});Q.inject(document.body);Q.click();Q.remove()}};break;case"move":return{text:i.move,fonticon:"fonticon fonticon-export ",handler:function(S){var P=N._modelKey.id,R=S.model._attributes.businessobj.title,Q=[];var T=I.getStorage().url().replace("/session","");var U=T+"/collabspaces?tenant=OnPremise&embed=contexts&fields=contexts";q.authenticatedRequest(U,{method:"GET",type:"json",onComplete:function(aa){function ad(){V.setDisabled();var ai=W.elements.container[0].value,ah=S.model.id;var aj=T.replace("/enocsmrest","")+"/restmove/collabspaces/{fromcollabspace}/moveable/{physicalid}";aj=aj.replace("{fromcollabspace}",P);aj=aj.replace("{physicalid}",ah);var ag="{collabspace: '"+ai+"'}";q.authenticatedRequest(aj,{method:"PUT",data:ag,headers:{"Content-type":"application/json"},onComplete:function(ak){ae.destroy();S.destroy();o.add({message:R+i.successMove+ai})},onFailure:function(ak){V.setDisabled(false);z.add({message:R+i.errorMove+ai})}})}function ac(){if(event.keyCode===13){var ag=V.elements.container.getAttribute("disabled");ag=ag===null?true:false;if(ag){ad()}}else{if(event.keyCode===27){document.removeEventListener("keydown",ac);ae.destroy()}}}for(var ab=0;ab<aa.length;ab++){var af=aa[ab],Z=af.contexts[0].role,Y=["VPLMProjectLeader","VPLMProjectAuthor"];if(Y.indexOf(Z)>-1&&af.name!==P){Q.push({value:af.name,label:af.name})}}if(Q.length===0){z.add({message:i.errorMoveOneCS})}else{var W=new s({fields:[{type:"select",name:"tocollabspace",label:i.toCollabSpace,options:Q}]});var X=new C({value:i.cancel,events:{onClick:function(ag){document.removeEventListener("keydown",ac);ae.destroy()}}});var V=new C({value:i.move,className:"primary",events:{onClick:ad}});var ae=new a({closable:true,header:i.replace(i.moveElem,{name:R}),body:W,footer:[V,X]}).inject(document.body);ae.show();document.addEventListener("keydown",ac)}},onFailure:function(V){z.add({message:i.errorMoveGetCSList})}})}};break;default:return null}}).filter(function(O){return O})},icon:"picture",title:i.emptyContentTitle,},emptyView:J,events:{onItemViewSelect:w,onPullToRefresh:e}},events:{onActionClick:A,onItemViewSelect:v,onUnSelectAll:j,onFacetUnselect:r,onFacetSelect:B,onDestroy:r,onInfiniteScroll:l,onItemViewDrag:L}}},getListViewOptions:function(){return{className:"loading",contents:{useInfiniteScroll:true,usePullToRefresh:true,itemViewOptions:{mapping:{title:"businessobj.title",content:function(){var O,P=this.model.get("businessobj"),M,N;if(!P){return}M=new Date(this.model.get("businessobj").modified*1000);N=this.model.get("businessobj").description;O=M.toGMTString().parseRelativeTime();if(N){O+=("<br/>"+N)}return O},icon:"businessobj.icon",image:"businessobj.thumbnail",subtitle:"businessobj.type.name"},icon:"picture",title:i.emptyContentTitle,},emptyView:J,events:{onItemViewClick:function(N,M,O){},onItemViewSelect:v,onUnSelectAll:j,onPullToRefresh:e,onDestroy:r,onRender:B}},events:{onInfiniteScroll:l,onItemViewDrag:L}}}};return H});define("DS/W3DSpace/Models/AdminPeopleModel",["UWA/Core","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap"],function(c,b,a){var d=b.extend({idAttribute:"login",sync:function(g,f,e){c.extend(e,c.extend(a.getSyncOptions(),{attrs:JSON.stringify(f.toJSON(e))},true),true);delete e.data;return this._parent.apply(this,arguments)},});return d});define("DS/W3DSpace/Collections/AdminPeopleCollection",["UWA/Core","UWA/Class/Model","DS/WebAppsFoundations/Collections/PageableCollection","DS/W3DSpace/Models/AdminPeopleModel","DS/W3DSpace/EnoviaBootstrap"],function(d,c,f,e,b){var a=f.extend({name:"peoples",defaultOptions:{mode:"data",state:{firstPage:0,currentPage:0,pageSize:25},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"total"}},model:e,url:function(){return"/admin/"+this.name},setup:function(k,g){var h=g._modelKey,i,j;if(h&&h instanceof c){this._modelKey=h;this.url=h.url()+Object.getPrototypeOf(this).url.call(this)}if(widget){this.listenTo(widget,{onSearch:this.onSearch,onResetSearch:this.onResetSearch})}},sync:function(i,h,g){d.extend(g,b.getSyncOptions(),true);this._parent.apply(this,arguments)},fetch:function(g){if(this.currentSearchUrl){g.url=this.currentSearchUrl}return this._parent.call(this,g)},parseResponseForStateUpdate:function(j,h,i,g){return{totalRecords:j.total}},parseRecords:function(h,g){return h.peoples},onSearch:function(i){if(i){var g=(d.is(this.url,"function"))?this.url():this.url;var h=g+"?filter="+i;if(h!=this.currentSearchUrl){this.currentSearchUrl=h;this.dispatchEvent("onSearch")}}},onResetSearch:function(){this.currentSearchUrl=null;this.dispatchEvent("onResetSearch")},});return a});define("DS/W3DSpace/Views/Player3DView",["UWA/Core","DS/W3DSpace/EnoviaBootstrap","DS/3DPlayHelper/3DPlayHelper","DS/W3DXComponents/Views/Temp/TempItemView","DS/W3DSpace/Models/ContentModel","css!DS/UIKIT/UIKIT.css","css!DS/W3DSpace/W3DSpace.css"],function(e,b,d,g,h){var c="3dplay";function a(i,k){var j;if(i){j=i[k];if(e.is(j,"function")){j=j.call(i)}}return j}var f=g.extend({name:c,tagName:"div",template:"",playerContainer:function(){return this.container},domEvents:{},defaultOptions:{input:{},asset:{serverurl:"",physicalid:null,proxyurl:null,requiredAuth:"passport"}},init:function(i){var j=this;["container","template","tagName","domEvents"].forEach(function(k){delete i[k]});if(widget===undefined){i.asset.requiredAuth=null}this._parent.call(this,i)},setup:function(){var i=this;this.playerObj={instance:undefined,isLoaded:false};this.container.addClassName(this.getClassNames("-container"))},_initPlayer:function(){var k=this,j={},i;j.onComplete=function(n,m,l){k.player3D=new d({container:a(k,"playerContainer"),input:n,options:{loading:m,tenant:b.getStorage().id}})};return this.getInputOptions(j)},getInputOptions:function(i){if(!i){i={}}var m=this,l=this.getContentType(),o,n,k,j;if(!l){return}n=this.getOption("input");j=this.getOption("asset");o=i.onComplete;switch(l.toLowerCase()){case"document":k=function(p){var q=p.onComplete;p.onComplete=function(s,t,r){j={provider:"FILE",filename:t.url,format:t.extension,requestsOptions:{proxy:"none"}};if(e.is(q,"function")){return q.call(s,j,"autoplay",r)}};m.model.getFileUrl(p)};break;default:k=function(p){var q=p.onComplete;j=e.merge({provider:"EV6",physicalid:m.model.id,dtype:l,tenant:b.getStorage().id},m.getOption("asset"));if(e.is(q,"function")){return q.call(m,j,null,p)}};break}i.onComplete=function(q,p){n=e.merge({asset:q,},n);if(e.is(o,"function")){return o.call(m,n,p,i)}};return k(i)},getContentType:function(){if(!this.model||!(this.model instanceof h)){return}var k,i,j;return(k=this.model.get("businessobj"))&&(i=k.type)&&i.value},onRender:function(){this._initPlayer()},onDestroy:function(){if(this.player3D){this.player3D.dispose();this.player3D=null}this.container.empty();return this._parent.apply(this,arguments)}});return f});define("DS/W3DSpace/Views/DetailView",["UWA/Core","DS/W3DXComponents/Views/Temp/TempItemView","DS/W3DSpace/Views/Player3DView","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(c,e,d,f){var b="detailview";var a=e.extend({name:b,tagName:"div",template:function(){return'<div class="'+this.getClassNames("-wrapper")+'"></div>'},setup:function(){this.container.addClassName(this.getClassNames("-container"))},selectSubView:function(){this.subView=new d(c.extend({model:this.model},this.options));this.toggleContent=this.subView.render().getContent();this.injectContent(this.toggleContent,"."+b+"-wrapper")},onRender:function(){this.selectSubView();this._parent.apply(this,arguments)},onDestroy:function(){if(this.subView){this.subView.destroy()}return this._parent.apply(this,arguments)},injectContent:function(i,g){var h=this.container.getElement(g);if(i&&h){this.undelegateDOMEvents();h.setContent(i);this.delegateDOMEvents()}}});return a});define("DS/W3DSpace/Views/InvitationView",["UWA/Drivers/Alone","UWA/Core","UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/W3DSpace/Models/InvitationModel","DS/W3DSpace/EnoviaBootstrap","DS/UIKIT/Scroller","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter","css!DS/W3DSpace/W3DSpace.css"],function(f,b,p,c,o,m,i,d,r,e){var l=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"}),g=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});var q,h,k,a,t,s;var j=this;var n=p.extend({init:function(u){var v=this;this._parent(u);this.model=new i();this.model.fetch({onFailure:function(){l.add({message:e.errorFetch})},onComplete:function(){v.CreateForm()}})},CreateForm:function(){var z=this;var y;var v=z.containerview;z.containerview=this.container.addClassName(this.getClassNames("-container"));z.addUsersToCSToggle=new o({type:"switch",value:"addUsersToCS",checked:z.model.get("addoncommonspace"),label:e.addUsersToCS});z.givecreationrightToggle=new o({type:"switch",value:"givecreationright",checked:z.model.get("givecreationright"),label:e.givecreationright});z.readerRoleToggle=new o({type:"switch",value:"readerRole",checked:z.model.get("hasreaderrole"),label:e.reader});z.publicReaderRoleToggle=new o({type:"switch",value:"publicReaderRole",checked:z.model.get("haspublicreaderrole"),label:e.publicReader});z.manageVisibilityRight=new o({type:"switch",value:"manageVisibility",checked:z.model.get("managevisibility"),label:e.visibility});var B=b.createElement("div",{"class":"deployment-container",html:[{tag:"h4",text:e.deployementSection},z.addUsersToCSToggle,z.givecreationrightToggle]}).inject(z.containerview);var w=b.createElement("div",{"class":"roles-container",html:[{tag:"h4",text:e.rolesAvailability},z.readerRoleToggle,z.publicReaderRoleToggle]}).inject(z.containerview);var A=b.createElement("div",{"class":"visibility-container",html:[{tag:"h4",text:e.manageVisibility},z.manageVisibilityRight]}).inject(z.containerview);var x=b.createElement("div",{"class":"footer",html:[new m({value:e.cancel,className:"pull-right default",events:{onClick:z.dispatchAsEventListener("onCancel")}}),new m({value:e.save,className:"pull-right primary",events:{onClick:z.dispatchAsEventListener("onSave")}})]}).inject(z.containerview);var u=new r({element:z.containerview});return z.containerview},onSave:function(){var u=this;u.model.save({addoncommonspace:u.addUsersToCSToggle.isChecked(),givecreationright:u.givecreationrightToggle.isChecked(),haspublicreaderrole:u.publicReaderRoleToggle.isChecked(),hasreaderrole:u.readerRoleToggle.isChecked(),managevisibility:u.manageVisibilityRight.isChecked(),},{onFailure:function(){u.onCancel();l.add({message:e.errorSave})},onComplete:function(){g.add({message:e.successSave})}})},onCancel:function(){if(this.model.get("addoncommonspace")==true){this.addUsersToCSToggle.check()}else{this.addUsersToCSToggle.uncheck()}if(this.model.get("givecreationright")==true){this.givecreationrightToggle.check()}else{this.givecreationrightToggle.uncheck()}if(this.model.get("hasreaderrole")==true){this.readerRoleToggle.check()}else{this.readerRoleToggle.uncheck()}if(this.model.get("haspublicreaderrole")==true){this.publicReaderRoleToggle.check()}else{this.publicReaderRoleToggle.uncheck()}if(this.model.get("managevisibility")==true){this.manageVisibilityRight.check()}else{this.manageVisibilityRight.uncheck()}}});return n});define("DS/W3DSpace/Views/CreateCSView",["UWA/Core","UWA/Element","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Alert","UWA/Class/View","DS/WAFData/WAFData","DS/W3DSpace/EnoviaBootstrap","DS/W3DXComponents/Views/Item/LabelManagerView","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(k,l,g,h,a,e,f,b,i,c,j,m){var d=b.extend({name:"createCS",tagName:"div",className:"create-cs-view",init:function(n){var o=UWA.clone(n,false);["container","template","tagName","domEvents"].forEach(function(p){delete o[p]});this._parent(o)},setup:function(){this.container.addClassName(this.getClassNames("-container"));this._initAlert();this._initForm();this._initListenKeyDown()},_initAlert:function(){var n={className:"create-alert",closable:true,renderTo:document.body,autoHide:true,visible:true};this.elements.alertFailure=new f(k.extend({messageClassName:"error"},n));this.elements.alertSuccess=new f(k.extend({messageClassName:"success"},n))},_initForm:function(){var u=this,y=this.options,n=this.elements,r=n.alertFailure,p,q,o,t,x;p=function(A,z){if(A){n.create.setDisabled();z.addClassName("has-error");r.add({message:A})}else{n.create.setDisabled(false);z.removeClassName("has-error")}};var s;var w=new j({domEvents:{"click .supp-icon":function(){this.container.getElement("form").show();this.onClickSuppCalled.apply(this,arguments)}},categories:[{id:"mainOwner",name:"Main Owner"}],labelFormat:"{fname} {lname}",suggestKey:"login",placeholder:"Type here",getSuggestions:function(E,C,D){var B,A,z=new RegExp("/session");if(!E){return}if(s){s.cancel()}if(C[E]){D(C[E])}else{B=c.getStorage().get("url");B=B.split(z)[0];B=B+"/resources/enocsmrest/admin/peoples?filter="+E+"&limit=10";A=k.extend({type:"json",onComplete:function(F){D(F.peoples)}},c.getSyncOptions());s=i.authenticatedRequest(B,A)}}});var v=w.addObject;w.addObject=function(A,C,D,z,B){B.hide();v.apply(this,arguments)};q=[{type:"text",name:"title",required:true,label:m.title,maxlength:"32",placeholder:m.placeholderTitle,pattern:'^((?!<)(?!>)(?!/)(?!\\\\)(?!:)(?!\\?)(?!\\*)(?!")(?!\\|)(?!@)(?!#)(?!\\$)(?!%)(?!,)(?!\\.)(?!\\[)(?!\\]).)*$'},{type:"text",name:"description",label:m.description,maxlength:"128",placeholder:m.placeholderDescription}];q.push({type:"select",name:"visibility",label:m.visibility,nativeSelect:false,placeholder:false,options:[{value:"PRIVATE",label:m["private"]+" - "+m.privateDetail,selected:true},{value:"PROTECTED",label:m["protected"]+" - "+m.protectedDetail},{value:"PUBLIC",label:m["public"]+" - "+m.publicDetail}]});q.push({type:"select",name:"family",label:m.family,nativeSelect:false,placeholder:false,className:"form-item",options:[{value:"DESIGNTEAM",label:m.design+" - "+m.designDetail,selected:true},{value:"STANDARDTEAM",label:m.standard+" - "+m.standardDetail}]});o=new g({fields:q,events:{onSubmit:function(){u.onCreate()},onInvalid:function(z){},onValid:function(){}}});t=new h({value:m.create,className:"primary",events:{onClick:this.dispatchAsEventListener("onCreate")}});x=new h({value:m.cancel,events:{onClick:this.dispatchAsEventListener("onCancel")}});n.form=[w.render(),o];n.create=t;n.cancel=x},getCreateButton:function(){return this.elements.create},getCancelButton:function(){return this.elements.cancel},getFormFirstInput:function(){return this.elements.form[0].container},_initListenKeyDown:function(){this.onKeyDown=this.onKeyDown.bind(this);document.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(o){if(o.keyCode===13){if(this.submitEnabled()){this.onCreate()}}else{if(o.keyCode===27){var n=document.createEvent("Event");n.initEvent("click",true,false);this.elements.cancel.elements.content.dispatchEvent(n)}}},submitEnabled:function(){var n=this.elements.create.elements.content.getAttribute("disabled");return n===null?true:false},render:function(){var q=this.elements,n=q.form,o=q.create,p=q.cancel;this.container.setContent([n,{tag:"div","class":"footer"}]);return this},onCreate:function(){var u=this,y=this.options,q=this.collection,t=q._storage,r=y.onComplete,p=y.onFailure,x=this.elements.form[1].getValue("title"),n,o=this.elements.form[0].getJsonObjects()[0]?this.elements.form[0].getJsonObjects()[0].selection:"",s=this.elements.alertFailure;var v=new RegExp("\\s$","i");while(v.test(x)){x=x.substring(0,x.length-1)}if((!this.elements.form[1].validate())||x.length===0||o.length===0){if(x===""){s.add({message:m.errorEmptyTitle})}else{if(o===""){s.add({message:m.errorEmptyOwner})}else{var w=" \\ \" # $ @ % * , ? < > [ ] | : . '";s.add({message:m.replace(m.errorCharacterTitle,{tag1:w})})}}return}y.onFailure=function(A,B,z){q.remove(A);if(k.is(p)){p.apply(undefined,arguments)}};n={title:x,description:this.elements.form[1].getValue("description"),family:{value:this.elements.form[1].getValue("family")},visibility:{value:this.elements.form[1].getValue("visibility")},owner:{login:o}};this.collection.create(n,{onComplete:y.onComplete,onFailure:y.onFailure})}});return d});define("DS/W3DSpace/Views/ModalCreateCS",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/W3DSpace/Views/CreateCSView","DS/UIKIT/Alert","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(d,g,b,a,c,f){var e=g.extend({init:function(r){var m=this,q,k,j,o,n,p,l,h;var i={className:"create-alert",closable:true,renderTo:document.body,autoHide:true,visible:true};r=d.clone(r||{},false);this._parent(r);q=d.clone(r.events||{},false);k=r.onComplete;j=r.onFailure;o=q.onCancel;l=this.elements.alertFailure;h=this.elements.alertSuccess;p=function(){document.removeEventListener("keydown",n.onKeyDown);n.remove();m.destroy()};q.onCancel=function(){p();if(d.is(o)){o.apply(this,arguments)}};r.events=q;r.onComplete=function(s){p();m.elements.alertSuccess=new c(d.extend({messageClassName:"success"},i));m.elements.alertSuccess.add({message:f.replace(f.successCreate,{tag1:s.get("title")})});if(d.is(k)){k.apply(undefined,arguments)}};r.onFailure=function(s){p();m.elements.alertFailure=new c(d.extend({messageClassName:"error"},i));m.elements.alertFailure.add({message:f.replace(f.errorCreateCS,{tag1:s.get("title")})});if(d.is(j)){j.apply(undefined,arguments)}};n=new a(r);this.elements.modal=new b({closable:true,header:f.createTitle,form:n,body:n.render(),footer:[n.getCreateButton(),n.getCancelButton()]})},show:function(){var i=this.elements,h=i.modal;h.inject(document.body);h.show();h.options.form.getFormFirstInput().focus()}});return e});define("DS/W3DSpace/SkeletonUtils/W3DSpaceContentSkeletonOptions",["UWA/Core","DS/W3DXComponents/Skeleton","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/Collections/ContentsCollection","DS/W3DXComponents/Views/Item/SkeletonRootView","DS/W3DSpace/Views/FiltersAdapter","DS/W3DSpace/SkeletonUtils/ContentSkeletonOptions"],function(g,a,b,h,d,f,c){function i(j,l){var k;if(j){k=j[l];if(g.is(k,"function")){k=k.call(j)}}return k}var e={getRootIdCardOptions:function(j){var k=this;return{root:"contents",useRootChannelView:j.channelView,minimizeIdCards:true,responsiveTrigger:function(){var l=widget.getView().type;return l==="maximized"||l==="fullscreen"},rootIdCardOptions:{model:j.rootModel,facets:[{name:"contents",text:"",icon:"",handler:a.getRendererHandler("contents")}]}}},getRendererMap:function(j){return{contents:{collection:h,view:new f(d,c.getFetchOptions()),collectionOptions:{url:function(){var l=i(b.getStorage(),"url"),k=new RegExp("/session");l=l.split(k)[0];return l+"/collabspaces/"+j.collabSpace+"/"+this.name},},viewOptions:c.getListViewOptions(j),idCardOptions:c.getIdCardOptions(j),fetchMode:"never",swipe:false}}}};return e});define("DS/W3DSpace/SkeletonUtils/W3DSpaceControlCenterSkeletonOptions",["UWA/Core","DS/UIKIT/Alert","UWA/Class/Model","DS/W3DXComponents/ContentSet","DS/W3DXComponents/MemberSet","DS/W3DXComponents/Skeleton","DS/W3DSpace/Collections/AdminCollabSpacesCollection","DS/W3DSpace/Collections/AdminPeopleCollection","DS/W3DXComponents/Views/Layout/GridScrollView","DS/W3DXComponents/Views/Item/TileView","DS/W3DSpace/Views/ModalChangeOwner","DS/W3DSpace/Views/InvitationView","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/W3DSpace/Views/ModalCreateCS","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/Views/ModalEditVisibility","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter"],function(t,f,p,a,o,g,b,u,d,l,r,q,k,n,c,h,s,i){var w,m=new f({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"}),j=new f({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});var v=d.extend({onRender:function(){var x=new n({value:i.createCS,icon:"plus",className:"primary",events:{onClick:function(z,A){var y=new c({collection:this.collection});y.show()}.bind(this)}});this.container.setHTML(x.getContent());this._parent.apply(this,arguments)},setup:function(y){var x=this._externalEvents={onSearch:function(z){this.reload()},onResetSearch:function(){this.reload()}};if(this.collection){this.listenTo(this.collection,x)}return this._parent.apply(this,arguments)},destroy:function(x){if(this.isDestroyed){return}if(this.collection){this.stopListening(this.collection,this._externalEvents)}return this._parent.apply(this,arguments)},reload:function(){this.container.addClassName("loading");this.collection.state.totalRecords=null;this.collection.getFirstPage()}});function e(){var x=this,A=this.collection,z,B,y={};y.onComplete=function(E,D,C){if(x.container.offsetParent){x.scrollView.elements.infinitearea.show();x.scrollView.elements.infiniteareaLoader.hide();x.scrollView.endLoading()}};y.onFailure=function(){m.add({message:i.errorFetch})};if(A.state.totalRecords===null){A.getFirstPage(y)}else{if(A.hasNextPage()){A.getNextPage(t.extend(y,{remove:false,reset:false}))}else{x.scrollView.elements.infinitearea.show();x.scrollView.elements.infiniteareaLoader.hide()}}}w={getRootIdCardOptions:function(x){var z=this;var y=p.extend({urlRoot:function(){return x.selectedStorage.get("url")+"/resources/enocsmrest"},});return{root:"admincollabspaces",rootIdCardOptions:{model:new y(),facets:[{name:"admincollabspaces",text:i.ownership,icon:"doc-text",handler:g.getRendererHandler("admincollabspaces")},{name:"adminmembers",text:i.creation,icon:"users",handler:g.getRendererHandler("adminmembers")},{name:"invitation",text:i.invitation,icon:"cog",handler:g.getRendererHandler(q)}]}}},getRendererMap:function(x){return{adminmembers:{collection:u,fetchMode:"never",view:v,viewOptions:{className:"members-facet",useInfiniteScroll:true,usePullToRefresh:true,itemView:l,itemViewOptions:{mapping:{title:function(){return this.model.get("name")},image:function(){return this.model.get("picture").split("redirect=")[1]},subtitle:function(){if(this.model.get("createcs")){return'<div class="allowed">'+i.allowed+"</div>"}else{return i.notAllowed}},content:"email"},contextualActions:function(){var A=[],z,y;if(this.get("createcs")){if(!this.get("isadmin")){A.push({text:i.denyCreation,fonticon:"block",handler:function(B){B.model.save({login:B.model.get("login"),createcs:false},{onFailure:function(C){m.add({message:i.errorDenyCreation});C.set("createcs",true)},onComplete:function(){j.add({message:i.successDenyCreation})}})}})}}else{A.push({text:i.allowCreation,fonticon:"pencil",handler:function(B){B.model.save({login:B.model.get("login"),createcs:true},{onFailure:function(C){m.add({message:i.errorAllowCreation});C.set("createcs",false)},onComplete:function(){j.add({message:i.successAllowCreation})}})}})}return A}},events:{onInfiniteScroll:e}},},admincollabspaces:{className:"loading",collection:b,fecthMode:"never",view:v,viewOptions:{useInfiniteScroll:true,usePullToRefresh:true,itemView:l,itemViewOptions:{mapping:{title:"title",subtitle:"owner.name",image:"thumbnail",content:function(){var A,y,z;y=this.model.get("visibility").name;z=this.model.get("description");A=y;if(z){A+=("<br/>"+z)}return A},},contextualActions:function(){var z=[];var A=this.get("actions");if(A){for(var y=0;y<A.length;y++){if(A[y]==="edit.visibility"){z.push({text:i.editVisibility,fonticon:"pencil",handler:function(B){var C=new s({model:B.model});C.show()}})}if(A[y]==="edit.owner"){z.push({text:i.changeOwner,fonticon:"pencil",handler:function(B){var C=new r({model:B.model});C.showModal()}})}}}return z}},events:{onInfiniteScroll:e,}}}}}};return w});define("DS/W3DSpace/W3DSpaceControlCenter",["UWA/Core","DS/UIKIT/Alert","DS/W3DSpace/Collections/CollabStorageCollection","DS/W3DXComponents/IdCard","DS/W3DXComponents/Skeleton","DS/W3DSpace/Collections/AdminPeopleCollection","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/SkeletonUtils/W3DSpaceControlCenterSkeletonOptions","DS/PlatformAPI/PlatformAPI","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter","css!DS/W3DSpace/W3DSpace.css"],function(n,c,q,p,d,s,f,t,a,g){var k,i,o,m=false,l,h=false,r;function j(){if(i){i.destroy()}if(f.getStorage().get("isadmin")){i=new d(t.getRendererMap(),t.getRootIdCardOptions({selectedStorage:r}));i.render().inject(widget.body.getElement("#controlcenter-widget-content"))}else{k.add({message:g.errorAdminRights,className:"error"})}}function b(z,A){if(!z){return}var w,u={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[],onchange:"onStorageChange"},y=widget.getValue("collab-storage");if(y===""){var v=widget.getValue("x3dPlatformId");if(v){w=z.get(v);if(w){widget.setValue("collab-storage",w.id)}else{var x=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"warning"});x.add({message:g.undefinedStorage});return}}else{w=z.at(0)}}else{w=z.get(y)}z.forEach(function(B){var D,C;C=B.get("displayName").unescapeHTML();D=B.get("id");u.options.push({label:C,value:D})});if(z.length===1&&w){u.type="hidden"}widget.addPreference(u);if(h){widget.dispatchEvent("onEdit",["refreshPrefs"]);if(!w){w=z.at(0)}}if(w){widget.setTitle(w.get("displayName"));o.onStorageChange("collab-storage",w.id,A)}else{k.add({message:g.updatePreference,className:"warning"})}a.subscribe("PlatformManagement.renamePlatformName",function(B){widget.setTitle(B);w.set("displayName",B)});r=w;return w}function e(){if(m){return}if(!widget){throw new Error("W3DSpace must be executed in a widget environement")}l=new q();m=true}o={onLoad:function(){f.start({id:widget.id,collection:l});widget.setBody([{tag:"div",id:"controlcenter-widget-content"}]);k=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"});l.fetch({onComplete:function(w,v,u){b.call(undefined,w,j)},onFailure:function(u){k.add({message:g.errorFetchStorages,className:"error"})}})},onRefresh:function(){var u=b.call(undefined,l,j)},onEdit:function(v){h=true;if(v!=="refreshPrefs"){var u={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[{label:"Loading",value:""}],onchange:"onStorageChange"};widget.addPreference(u);widget.dispatchEvent("onEdit",["refreshPrefs"]);l.fetch({onComplete:function(y,x,w){var z=b.call(undefined,y)}})}},endEdit:function(u){h=false},onStorageChange:function(u,v,x){var w=l.get(v);f.onStorageChange(w,x)}};e();return o});define("DS/W3DSpace/Models/MemberModel",["UWA/Core","UWA/Class/Model","DS/WebappsUtils/WebappsUtils","DS/WAFData/WAFData","UWA/Data","DS/W3DSpace/EnoviaBootstrap"],function(f,e,g,b,d,a){var c=e.extend({defaults:{collabspace:"",role:{},isownercs:false,contents:null,people:{},actions:[]},setup:function(j){var k=j.people;var i;var l=this;var h=g.getWebappsAssetUrl("W3DSpace","Default_People.png");if(k){if(a.getSwymUrl()){i=a.getSwymUrl()+"/api/user/getpicture/login/"+k.login+"/format/normal";return l.set("picture",i)}else{return l.set("picture",h)}}},sync:function(j,i,h){f.extend(h,f.extend(a.getSyncOptions(),{attrs:JSON.stringify(i.toJSON(h))},true),true);delete h.data;return this._parent.apply(this,arguments)},});return c});define("DS/W3DSpace/Collections/MembersCollection",["UWA/Core","DS/WebAppsFoundations/Collections/PageableCollection","UWA/Class/Model","DS/W3DSpace/Models/MemberModel","DS/W3DSpace/EnoviaBootstrap"],function(g,h,f,e,c){var d="members";function b(i,k){var j;if(i){j=i[k];if(g.is(j,"function")){j=j.call(i)}}return j}var a=h.extend({name:d,defaultOptions:{mode:"data",state:{firstPage:0,currentPage:0,pageSize:20},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"memberTotal"}},model:e,url:function(){return"/"+this.name},parseResponseForStateUpdate:function(l,j,k,i){return{totalRecords:l.memberTotal}},parseRecords:function(j,i){return j.items},setup:function(m,i){var j=i._modelKey,k,l;if(j&&j instanceof f){this._modelKey=j;this.url=b(j,"url")+Object.getPrototypeOf(this).url.call(this)}},sync:function(k,j,i){g.extend(i,c.getSyncOptions(),true);this._parent.apply(this,arguments)},getMembers:function(k){var j,i;k=k.replace(/\W+$/,"").replace(/^\W+/,"");i=k.toLowerCase().split(/\W+/);j=function(l){return i.some(function(m){return l.get("people")["fname"].toLowerCase().indexOf(m)!==-1||l.get("people")["lname"].toLowerCase().indexOf(m)!==-1})};return this.filter(j)}});return a});define("DS/W3DSpace/Views/CollabSpacePropertiesView",["UWA/Core","UWA/Class/Model","DS/UIKIT/Alert","DS/W3DXComponents/Views/Temp/TempItemView","DS/W3DXComponents/Views/Layout/ScrollView","DS/W3DXComponents/IdCard","DS/W3DSpace/Views/ModelForm","DS/W3DSpace/Collections/MembersCollection","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(i,n,m,c,b,d,f,g,l){var k="collabspaces-properties",a={className:"vertical",fields:function(){var p=new g(null,{_modelKey:this}),o=[{type:"autocomplete",name:"owner",attributes:{value:"return this.get('owner').name","data-attr":"return this.get('owner').name","data-editable":"return this.get('actions').indexOf('edit.owner') !== -1"},label:l.mainOwner,suggestFormat:"{fname} {lname}",suggestKey:"login",labelFormat:"{fname} {lname}",placeholder:"Type here",typeDelay:0,minLength:1,events:{onSelect:function(r,q){this.elements.input["data-key"]=r;this.elements.input.value=q.name}},getSuggestions:function(u,r,t){if(!u.length){return}var q=p,s=function(w,x,v){t(w.getMembers(v.text).map(function(y){return y.toJSON().people}))};q.fetch({onComplete:s,text:u,data:{embed:"people"}})}},{type:"textarea",name:"description",attributes:{"data-attr":"return this.get('description')","data-editable":"return this.get('actions').indexOf('edit.description') !== -1"},rows:5,label:l.description}];if(this.collection._storage.get("isInnovation")){o.splice(1,0,{type:"select",name:"visibility",attributes:{"data-attr":"return this.get('visibility').value","data-editable":"return this.get('actions').indexOf('edit.visibility') !== -1"},label:l.visibility,options:[{label:l["private"],value:"Private"},{label:l["protected"],value:"Protected"},{label:l["public"],value:"Public"}]});o.splice(3,0,{type:"select",name:"family",attributes:{"data-attr":"return this.get('family').value","data-editable":false},label:l.family,options:[{label:l.design,value:"DesignTeam"},{label:l.standard,value:"StandardTeam"}]})}return o},buttons:[{type:"submit",value:l.save},{type:"reset",value:l.cancel}]};function j(u,p,r){if(u==null){return false}var o,t=u.length!==+u.length&&Object.keys(u),s=(t||u).length,q,v;for(q=0;q<s;q++){v=t?t[q]:q;if(p.call(r,u[v],v,u)){return true}}}function h(r,p,q){var o;j(r,function(u,s,t){if(p.call(q,u,s,t)){o=u;return true}});return o}var e=c.extend({name:k,tagName:"div",template:"",domEvents:{},defaultOptions:{idCard:null},reader:null,init:function(o){var p=this;["container","template","tagName","domEvents"].forEach(function(q){delete o[q]});this._parent.call(this,o)},setup:function(o){var p;this.container.addClassName(this.getClassNames("-container"));this._initForm();this._initFileReader(o);p=this._collabSpaceEvents={"onChange:visibility":this._onChangeVisibility};this.alert=new m({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"});this.alertSuccess=new m({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});this.listenTo(this.model,p)},_initForm:function(){var p,o=i.clone(a);p=this._form=new f(i.extend({model:this.model,events:{onSubmit:this._onFormSubmit.bind(this),onReset:this._onFormReset.bind(this)}},o));p.render=function(){};p.container=p.elements.container;return p},_initFileReader:function(p){var q=this,o=new FileReader();this.reader=o;o.onload=function(r){q._idCard&&(q._idCard.getElement(".thumbnail").setStyle("background-image","url("+o.result+")"))}},setOptions:function(p){var o=p.idCard;if(o){this._setIdCard(o);delete p.idCard}return this._parent.apply(this,arguments)},_setIdCard:function(o){if(!(o instanceof d)){throw new Error("You try to set idCard option with no instance of idCard")}if(this._idCard){return}this._idCard=o;this.listenTo(o,{onSwitchToEditMode:this.dispatchAsEventListener("onEdit"),onThumbnailChangeRequest:this._onChangeThumbnail,onTitleChangeRequest:this._onTitleChange});if(o._mode===1){this.dispatchEvent("onEdit")}},_resetIdCard:function(){this._idCard._refreshSection("thumbnail");return this._switchIdCardToViewMode()},_switchIdCardToViewMode:function(){var o=this._idCard;if(o){o.switchToViewMode()}return o},reset:function(){var o=this._form;this._resetIdCard();o.reset();return this},_onChangeVisibility:function(t,p,x){if(!t.collection._storage.get("isInnovation")){return}var v=this._form.getField("visibility"),r=v.parentElement.getElement(".select-results").children,o=v.getElementsByTagName("*"),w=p.value,s,q,u;for(u=0;u<o.length;u++){s=o[u];q=r[u];if(s.value===w){break}q.addClassName("result-option-disabled");s.disabled=true}},_onChangeThumbnail:function(p){var s=this,r=" .jpg, .jpeg, .png, .gif, .tif, .tiff, .bmp",q,o=this.reader;q=UWA.createElement("input",{attributes:{type:"file",accept:r,multiple:false},styles:{display:"none"},events:{change:function(){var t=s.thumbnailFile=this.files[0];var u=s.alertSuccess;o.readAsDataURL(t);u.add({message:l.replace(l.successUpload,{tag1:s.thumbnailFile.name})})}}});q.inject(document.body);q.click();q.remove()},_onTitleChange:function(p,o){this.newtitle=p},_onFormSubmit:function(p){var r=this,o=this.model,t=this.alert,q={onFailure:function(v,w,u){r.reset();t.add({message:l.errorEdit})},type:"json",wait:true};var s=!(typeof this.newtitle=="undefined")&&this.newtitle!=null;if(s){p.title=this.newtitle}else{p.title=o.get("title")}p.visibility&&(p.visibility={value:p.visibility});if(!i.is(p.owner)){delete p.owner}else{p.owner={login:p.owner}}if(this.thumbnailFile){p.thumbnail=this.thumbnailFile.name;q.file=this.thumbnailFile}if(this._validateInputs(p)){o.save(p,q);this._switchIdCardToViewMode();this.dispatchEvent("onEndEdit")}else{this.dispatchEvent("onEdit")}},_onFormReset:function(){this._resetIdCard();this.dispatchEvent("onEndEdit")},_validateInputs:function(o){var p=new RegExp("[\\\\\"#$@%*,?<>[\\]|/:.']","i");if(p.test(o.title)){this._idCard.getElement(".title-section").getElement("input").addClassName("has-error");this.alert.add({message:l.replace(l.errorCharacterTitle,{tag1:" \\ \" # $ @ % * , ? < > [ ] | : . '"})});return false}else{if(!o.title||o.title.length===0){this._idCard.getElement(".title-section").getElement("input").addClassName("has-error");this.alert.add({message:l.errorCSBlankTitle})}else{if(o.title.length>32){this._idCard.getElement(".title-section").getElement("input").addClassName("has-error");this.alert.add({message:l.errorCSTitleFormat})}else{if(o.description.length>255){this._form.getField("description").addClassName("has-error");this.alert.add({message:l.errorCSDescFormat})}else{return true}}}}},onRender:function(){var q,p=this._form,o=this;this._onChangeVisibility(this.model,this.model.get("visibility"));q=new b({view:p,useInfiniteScroll:false,usePullToRefresh:false});q.render().inject(this.container)},onFacetSelect:function(p){var o;o=p.getIdCardAt(1);this.setOptions({idCard:o})},onEdit:function(){this._form.dispatchEvent("onEdit")},onEndEdit:function(){delete this.thumbnailFile;delete this.newtitle},onDestroy:function(){if(this._idCard){this.stopListening(this._idCard);delete this._idCard}if(this._form){this._form.destroy();delete this._form}this.alert.destroy()}});return e});define("DS/W3DSpace/SkeletonUtils/CollabSpaceSkeletonOptions",["UWA/Drivers/Alone","UWA/Core","DS/WAFData/WAFData","DS/W3DSpace/EnoviaBootstrap","DS/UIKIT/Alert","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Collections/ActionsCollection","DS/W3DXComponents/Views/EmptyView","DS/W3DSpace/Views/AnalyticsView","DS/W3DSpace/Views/CollabSpacePropertiesView","DS/W3DSpace/SkeletonUtils/ContentSkeletonOptions","DS/W3DSpace/SkeletonUtils/MemberSkeletonOptions","DS/W3DSpace/Views/ModalCreateCS","DS/W3DSpace/Views/ModalRemoveCS","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(j,u,b,h,e,g,x,p,w,f,r,o,c,l,i){function s(y){return y.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var m,n=new e({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"}),k=new e({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"}),t=new e({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"warning"}),a=new x([{id:"edit.visibility",title:i.visibility,icon:"pencil"},{id:"edit.thumbnail",title:i.thumbnail,icon:"pencil"},{id:"edit.owner",title:i.ownerRole,icon:"pencil"},{id:"edit.description",title:i.description,icon:"pencil"},{id:"edit.title",title:i.title,icon:"pencil"},{id:"edit.family",title:i.family,icon:"pencil"},{id:"add.contents",title:i.addContent,icon:"upload",overflow:false,actionBar:true},{id:"add.members",title:i.addMember,icon:"user-add",overflow:false,actionBar:true},{id:"delete",title:i.removeCS,icon:"trash",actionBar:false}]);function d(){var y=this,B=this.collection,A,C,z=m.getFetchOptions();A=z.onComplete;z.onComplete=function(F,E,D){if(y.container.offsetParent){y.container.removeClassName("loading");Object.keys(y.contentsViews).map(function(G){y.contentsViews[G].scrollView.endLoading()})}if(A){A(y,E,D)}};if(B.state.totalRecords===null){B.getFirstPage(z)}else{if(B.hasNextPage()){B.getNextPage(u.extend(z,{remove:false,reset:false}))}else{y.container.removeClassName("loading");Object.keys(y.contentsViews).map(function(D){y.contentsViews[D].scrollView.useInfiniteScroll(false)})}}}function v(y,E){if(E.model.get("solution")!=="Team"){t.add({message:i.warningNonOCDX})}var D=E.model.get("contexts");var C=["VPLMProjectLeader","VPLMCreator","VPLMExperimenter","VPLMViewer","VPLMProjectAdministrator"];var B=D.map(function(G){if(G.role==="VPLMProjectLeader"){return 0}else{if(G.role==="VPLMCreator"){return 1}else{if(G.role==="VPLMExperimenter"){return 2}else{if(G.role==="VPLMViewer"){return 3}else{if(G.role==="VPLMProjectAdministrator"){return 4}else{return 5}}}}}});var F=D.filter(function(G){return G.role===C[Math.min.apply(null,B)]});var A,z=h.getStorage().get("url");z=z+"/resources/pno/person/setsecuritycontext";A={method:"POST",data:{SecurityContext:F[0].name}};b.authenticatedRequest(z,A)}function q(){var y=t.getMessages();y.forEach(function(z){t.remove(z)})}m={getFetchOptions:function(z){var y={type:"json",data:{embed:"contexts"},actionsCtx:a,reset:true,onFailure:function(){n.add({message:i.errorFetchCollabSpaces})}};return y},getCreateOptions:function(){return{actionsCtx:a,onComplete:function(y){k.add({message:i.replace(i.successCreate,{tag1:y.get("title")})})},onFailure:function(z,B,y){var A;if(B.indexOf("The request has timedout")!==-1){A=i.errorCreateCSTimedout}else{A=i.replace(i.errorCreateCS,{tag1:z.get("title")})}n.add({message:A})}}},getIdCardOptions:function(y){return{collapsed:y.minimizeIdCardView,editableElements:function(){return this.get("actions").map(function(z){switch(z){case"edit.thumbnail":return"thumbnail";case"edit.title":return"title";default:return null}}).filter(function(z){return z})},attributesMapping:{ownerName:function(){return this.get("owner").name},date:function(){var z=new Date(this.get("created")*1000);return z.toGMTString().parseRelativeTime()},description:function(){var z=this.get("description");return z&&s(z)}},thumbnailUrl:function(){return this.get("thumbnail")},actions:function(){var B=[],z=true,A=true;A=A&&this.get("actions").some(function(C){return C.indexOf("edit")!==-1});z=z&&this.get("actions").some(function(C){return C==="delete"});if(A){B.push({text:i.editProperties,icon:"pencil",handler:function(D,C){this.selectFacet("properties");this.switchToEditMode()}})}if(z){B.push({text:i.removeCS,icon:"trash",handler:function(F,E){var C;C=E.getNodeAt(1).getFacet("contents").collection;if(C.isEmpty()){this.listenToOnce(this.model,{onDestroy:function(){E.slideBack()}});var D=new l({model:this.model});D.showModal()}else{n.add({message:i.errorRemoveCSNotEmpty})}}})}return B},facets:[{name:"contents",text:i.content,icon:"picture",handler:g.getRendererHandler("contents")},{name:"members",text:i.members,icon:"users",handler:g.getRendererHandler("members")},{name:"properties",text:i.properties,icon:"doc-text",handler:g.getRendererHandler(f)},{name:"analytics",text:i.analytics,icon:"chart-bar",handler:g.getRendererHandler(w)}]}},getListViewOptions:function(y){return{buttonGroup:function(){var C=this._storage,B=C.get("actions"),A,z;B&&(A=B.some(function(D){return D.indexOf("add")!==-1}));if(!u.is(B)||A){z={buttons:[{icon:"plus",value:i.createcs,className:"primary"}]}}return z},className:"loading",contents:{useInfiniteScroll:true,usePullToRefresh:false,itemViewOptions:{mapping:{content:function(){var z=this.model.get("description");return z&&s(z)},image:"thumbnail",subtitle:"owner.name"},icon:"attention",title:i.emptyCSTitle},emptyView:p,events:{onItemViewUnSelect:q,onItemViewSelect:v}},events:{onInfiniteScroll:function(){Array.prototype.push.call(arguments,y);d.apply(this,arguments)},onClick:function(A,B){var C=this.collection,z=new c(u.extend({collection:C},m.getCreateOptions()));z.show()}}}}};return m});define("DS/W3DSpace/W3DSpaceContent",["UWA/Core","UWA/Class","UWA/Class/Collection","DS/UIKIT/Alert","DS/W3DSpace/Collections/CollabStorageCollection","DS/W3DSpace/Collections/CollabSpacesCollection","DS/W3DSpace/Models/CollabSpaceModel","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/EmptyView","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/SkeletonUtils/W3DSpaceContentSkeletonOptions","DS/W3DSpace/SkeletonUtils/ContentSkeletonOptions","DS/W3DSpace/SkeletonUtils/CollabSpaceSkeletonOptions","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(A,E,u,d,D,l,F,e,x,i,v,z,p,k){var h,n,C,a,w=false,t,j,o,m=false;function s(G,I){var H;if(G){H=G[I];if(A.is(H,"function")){H=H.call(G)}}return H}function y(){var L,H,J,I,G,K;L=widget.getValue("collabstorage");if(L){t.forEach(function(M){if(M.get("url")===L){H=M.id}});if(H){widget.setValue("collab-storage",H)}widget.setValue("collabstorage",null);J=widget.getValue("collabspace");if(J){I=J.match(/\..+\.(.+)/)[1];widget.setValue("collab-space",I)}widget.setValue("collabspace",null);G=widget.getValue("view");if(G){if(G==="CHANNEL"){K="channel"}else{if(G==="LIST"){K="list"}}widget.setValue("main-view",K)}widget.setValue("view",null)}}function B(I){var H=new RegExp("/session"),G=s(I,"url");return G.split(H)[0]+"/collabspaces"}function r(){var H=widget.getValue("collab-space");var L=widget.getValue("main-view");if(n){n.destroy()}if(C){C.destroy()}var K=j.get(H);var G=widget.body.getElement("#widget-content");if(j.length>0&&K){widget.setTitle(K.get("title")+" "+k.content);var I={collabSpace:H,minimizeIdCardView:widget.getBool("id-card-view")};var J={rootModel:j.get(H),channelView:L==="channel"};n=new e(v.getRendererMap(I),v.getRootIdCardOptions(J));n.render().inject(G)}else{widget.setTitle(k.noCollabSpace);C=new x({icon:"picture",title:k.emptyContentTitle});C.render().inject(G)}}function c(M,L){if(!M){return}var I,K=widget.getValue("collab-storage");if(K===""){var H=widget.getValue("x3dPlatformId");I=M.get(H);if(!I){I=M.at(0)}if(I){widget.setValue("collab-storage",I.id)}}else{I=M.get(K)}if(m){var G={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[],onchange:"onStorageChange"};M.forEach(function(N){var P,O;P=N.get("displayName").unescapeHTML();O=N.get("id");G.options.push({label:P,value:O})});if(M.length===1&&I){G.type="hidden"}widget.addPreference(G);widget.dispatchEvent("onEdit",["refreshPrefs"]);if(!I){I=M.at(0)}var J={fields:"title"};i.onStorageChange(I,function(){g(I,J)})}else{if(I){i.onStorageChange(I,function(){q(I)})}else{h.add({message:k.updatePreference,className:"warning"})}}}function q(M){var K,H=widget.getValue("collab-space");var J={fields:"title,contexts",embed:"contexts"};j=new l([],{url:function(){return B(M)},storage:i.getStorage()});j.fetch=function(){Object.getPrototypeOf(Object.getPrototypeOf(Object.getPrototypeOf(this))).fetch.apply(this,arguments)};j.parse=function(N){return N};if(H===""){g(M,J)}else{var I=F.extend({urlRoot:function(){return B(M)}});var L=new I({name:H},{silent:true});j.add(L);var G=A.extend(p.getFetchOptions(),{onComplete:function(){r()},onFailure:function(){h.add({message:k.updateCollaborativeSpacePref,className:"warning"})},data:{fields:"title,contexts",embed:"contexts"}},true);L.fetch(G)}}function g(H,G){j.fetch({onComplete:function(K,J,I){b.call(undefined,K)},onFailure:function(I){h.add({message:k.errorFetchCollabSpaces})},data:G,silent:true})}function b(J){var I,H=widget.getValue("collab-space");if(J.length>0){if(H===""){I=J.get("Common Space")||J.at(0);if(I){widget.setValue("collab-space",I.id)}}}if(m){var G={type:"list",name:"collab-space",label:"Collaborative Space",options:[]};J.forEach(function(L){var M,K;M=(L.get("title")).unescapeHTML();K=L.get("name");G.options.push({label:M,value:K})});widget.addPreference(G);widget.dispatchEvent("onEdit",["refreshPrefs"])}else{r()}}function f(){if(w){return}if(!widget){throw new Error("W3DSpaceContent must be executed in a widget envirronement")}t=new D();w=true}a={onLoad:function(){i.start({id:widget.id,collection:t});widget.setBody([{tag:"div",id:"widget-content"}]);h=new d({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"});return h.add({message:"This widget does not exist anymore, please instantiate 3DSpace widget!"})},onViewChange:function(G){},onRefresh:function(){var H=widget.getValue("collab-storage");var G=t.get(H);i.onStorageChange(G,function(){q(G)})},onEdit:function(I){m=true;if(I!=="refreshPrefs"){var G={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[{label:"Loading",value:""}],onchange:"onStorageChange"};widget.addPreference(G);var H={type:"list",name:"collab-space",label:"Collaborative Space",options:[{label:"Loading",value:""}]};widget.addPreference(H);widget.dispatchEvent("onEdit",["refreshPrefs"]);t.fetch({onComplete:function(L,K,J){c(L)}})}},endEdit:function(G){m=false},onStorageChange:function(G,J){var K=t.get(J);var I=B(K),H={type:"list",name:"collab-space",label:"Collaborative Space",options:[{label:"Loading",value:""}]};widget.addPreference(H);widget.dispatchEvent("onEdit",["refreshPrefs"]);i.onStorageChange(K,function(){j.url=I;j.reset();var L={fields:"title"};g(K,L)})}};f();return a});define("DS/W3DSpace/SkeletonUtils/W3DSpaceSkeletonOptions",["UWA/Core","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap","DS/W3DXComponents/Skeleton","DS/W3DXComponents/ContentSet","DS/W3DXComponents/MemberSet","DS/W3DSpace/Collections/CollabSpacesCollection","DS/W3DSpace/Collections/ContentsCollection","DS/W3DSpace/Collections/MembersCollection","DS/W3DSpace/SkeletonUtils/CollabSpaceSkeletonOptions","DS/W3DSpace/SkeletonUtils/ContentSkeletonOptions","DS/W3DSpace/SkeletonUtils/MemberSkeletonOptions","DS/W3DSpace/Views/FiltersAdapter","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(j,p,b,a,l,h,f,o,e,i,d,c,g,m){function n(q,s){var r;if(q){r=q[s];if(j.is(r,"function")){r=r.call(q)}}return r}var k={getRootIdCardOptions:function(q){var r=this;return{root:"collabspaces",useRootChannelView:q.channelView,responsiveTrigger:function(){var s=widget.getView().type;return s==="maximized"||s==="fullscreen"},minimizeIdCards:true,rootIdCardOptions:{model:new p({title:m.myCollaborativeSpaces,collabspaces:null}),facets:[{name:"collabspaces",text:"",icon:"",handler:a.getRendererHandler("collabspaces")}]},events:q.events}},getRendererMap:function(q){return{collabspaces:{collection:f,collectionOptions:{url:function(){var s=n(b.getStorage(),"url"),r=new RegExp("/session");s=s.split(r)[0];return s+"/"+this.name},storage:b.getStorage()},viewOptions:i.getListViewOptions(q),idCardOptions:i.getIdCardOptions(q),idKey:"name",fetchMode:"never",swipe:false},members:{collection:e,view:h,viewOptions:c.getMemberSetOptions(q),idCardOptions:c.getIdCardOptions(q),fetchMode:"never",swipe:false},contents:{collection:o,view:new g(l,d.getFetchOptions()),viewOptions:d.getContentSetOptions(q),idCardOptions:d.getIdCardOptions(q),fetchMode:"never",swipe:false}}}};return k});define("DS/W3DSpace/W3DSpaceWidget",["UWA/Core","UWA/Class","UWA/Class/Collection","DS/UIKIT/Alert","DS/W3DSpace/Collections/CollabStorageCollection","DS/W3DSpace/Models/CollabSpaceModel","DS/W3DSpace/Models/ContentModel","DS/W3DXComponents/Skeleton","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/SkeletonUtils/W3DSpaceSkeletonOptions","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(q,u,n,b,t,v,s,c,e,g,f){var l,j,r,o=false,m,h=false;function p(){var z,x,w,y;widget.setValue("nb-items",null);z=widget.getValue("collabstorage");if(z){m.forEach(function(A){if(A.get("url")===z){x=A.id}});if(x){widget.setValue("collab-storage",x)}widget.setValue("collabstorage",null);w=widget.getValue("view");if(w){if(w==="CHANNEL"){y="channel"}else{if(w==="LIST"){y="list"}}widget.setValue("main-view",y)}widget.setValue("view",null)}}function i(x){var w,y=f.myCollaborativeSpaces;if(!q.is(x)&&this instanceof c){w=this.getCurrentPanelIndex();x=this.getModelAt(w)}if(x instanceof v){y=x.get("title")}else{if(x instanceof s){y=x.get("businessobj").title}}return widget.setTitle(y)}function k(){if(j){j.destroy();i()}var w,x;w={minimizeIdCardView:widget.getBool("id-card-view")};x={channelView:widget.getValue("main-view")==="channel",events:{onSlide:function(y,z){i.call(this,z)},onItemSelect:i}};j=new c(g.getRendererMap(w),g.getRootIdCardOptions(x));j.render().inject(widget.body.getElement("#widget-content"))}function a(A,B){if(!A){return}var y,w={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[],onchange:"onStorageChange"},z=widget.getValue("collab-storage");if(z===""){var x=widget.getValue("x3dPlatformId");y=A.get(x);if(!y){y=A.at(0)}if(y){widget.setValue("collab-storage",y.id)}}else{y=A.get(z)}A.forEach(function(C){var E,D;D=C.get("displayName").unescapeHTML();E=C.get("id");w.options.push({label:D,value:E})});if(A.length===1&&y){w.type="hidden"}widget.addPreference(w);if(h){widget.dispatchEvent("onEdit",["refreshPrefs"]);if(!y){y=A.at(0)}}if(y){r.onStorageChange("collab-storage",y.id,B)}else{l.add({message:f.updatePreference,className:"warning"})}return y}function d(){if(o){return}if(!widget){throw new Error("W3DSpace must be executed in a widget environement")}m=new t();o=true}r={onLoad:function(){i();e.start({id:widget.id,collection:m});widget.setBody([{tag:"div",id:"widget-content"}]);l=new b({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"});m.fetch({onComplete:function(y,x,w){p();a.call(undefined,y,k)},onFailure:function(w){l.add({message:f.errorFetchStorages,className:"error"})}})},onViewChange:function(w){},onRefresh:function(){k()},onEdit:function(x){h=true;if(x!=="refreshPrefs"){var w={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[{label:"Loading",value:""}],onchange:"onStorageChange"};widget.addPreference(w);widget.dispatchEvent("onEdit",["refreshPrefs"]);m.fetch({onComplete:function(A,z,y){var B=a.call(undefined,A)}})}},endEdit:function(w){h=false},onStorageChange:function(w,x,z){var y=m.get(x);e.onStorageChange(y,z)}};d();return r});