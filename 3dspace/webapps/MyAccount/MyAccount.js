define("DS/MyAccount/Column",["UWA/Core","UWA/Class/Promise","DS/i3DXCompass/i3DXCompass","DS/TopFrame/Environment"],function(g,f,e,d){var c=require("DS/UWPClientCode/WidgetFactory"),a=require("DS/UWPClientCode/PublicAPI");var b={init:function(i,h){h.refreshIfVisible()},_getAppInfo:function(h){return new f(function(j,i){if(e){e.getAppInfo({appId:h,onComplete:function(k){if(k){j(k)}else{i("Could not locate app information.")}},onFailure:i})}else{i()}})},_instantiateApp:function(j,h,i){return new f(function(o){var k=a&&a.getUserProperty("tenantId"),n=k&&{x3dPlatformId:k}||{},l=l||{},p=g.merge(l,n),m={el:h,title:"",parent:false,preview:true,appId:j.id,data:p,header:true};if(j&&((j.checksum&&j.launchInfos)||(j.platforms&&j.platforms[0]&&j.platforms[0].checksum&&j.platforms[0].launchInfos))){m=g.extend(m,{widgetId:g.is(j.launchInfos)?j.launchInfos:j.platforms[0].launchInfos,isolationLevel:g.is(j.isolationLevel)?j.isolationLevel:j.platforms[0].isolationLevel,token:g.is(j.checksum)?j.checksum:j.platforms[0].checksum})}else{throw new Error("Could not get valid Config from MyApps for the App "+m.appId)}c.load(m,function(){if(m.widget&&m.widget.environment){if(self.wp&&self.wp.isVisible){m.widget.environment.setVisible(true,true)}}o(m.widget)},d)})},onBeforeLoadColumns:function(j,p){var l=this,n=document.body.querySelector(".main"),k=document.body.querySelector(".my-account-header"),m=n&&g.extendElement(n).getSize().height||588,i=k&&g.extendElement(k).getSize().height||100,o=j&&j.getValue("appId")||"X3DCALC_AP",h=g.createElement("div",{"class":"module my-account-module",styles:{height:m-i-65}});h.inject(j.layout.columns[0].body);l._getAppInfo(o).then(function(q){return l._instantiateApp(q,h,"")})}};return b});define("DS/MyAccount/EditableTabView",["UWA/Core","UWA/Utils","UWA/Promise","DS/TopBar/TopBar","DS/TopBarProxy/TopBarProxy","css!DS/MyAccount/MyAccount.css"],function(d,g,h,f,c){var e=require("DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"),a=require("DS/UWPClientCode/PublicAPI"),i=require("DS/WAFData/WAFData");var b={showDefaultCard:false,init:function(l,j){var k=this;k.tabsOptions={className:"my-account",classNames:{scroller:"my-account-tablist-scroller",scrollerButton:"my-account-scroller-button",tabView:"my-account-tabview",tabList:"my-account-tablist",tabPanels:"my-account-tabview-panel"},editable:false,allowNewTab:false};k.endpoint="account";k.widget=l;k.enableUserSearch();l.setValue("tabsOptions",k.tabsOptions);k.setApplicationName();k.setRightMenu();k.addTopBarItemProfil();k.getCurrentUser().then(function(m){k.user=m;j.refreshIfVisible()})},onBeforeLoadCards:function(m,t,k){var p=this,s=a&&a.getUser(),q,n=k.length,j,o,l;if(s.login!==p.user.login){Array.prototype.clean=function(v){for(var u=0;u<this.length;u++){if(this[u]===v){this.splice(u,1);u--}}return this};for(q=0;q<n;q++){j=k[q],o=j&&j.data;try{l=JSON.parse(o)}catch(r){l={restricted:"false"}}if(d.is(l.restricted,"boolean")&&l.restricted===true){k[q]=null}}k.clean(null)}},onLoadCards:function(o,v){var r=this,p=o.layout,j=p.elements.container,t,u,n,m,q=0,k,s,l=r.user;o.body.innerHTML+='<div class="my-account-banner row"></div><div class="my-account-header row"><div class="col-xs-12 col-xs-offset-0 col-sm-4 col-sm-offset-2 col-md-4 col-md-offset-2 my-account-header-logo text-center"><div class="logo"></div></div><div class="col-xs-12 col-sm-6 col-md-6 my-account-header-info"><p class="firstname-lastname-trigramme"><span class="firstname">'+l.firstName+'</span> <span class="lastname-trigramme">'+l.lastName+" ("+l.login+')</span></p><span class="fonticon fonticon-open-down font-3dsregular chevron-tenant"></span>'+((l.company&&l.job)?'<p class="job-company"><span class="job">Job title Lorem Ipsum </span></br> <span class="company">Company name Lorem Ipsum </span></p>':"")+'<p class="location-mail-phone">'+((l.address&&l.city)?'<span class="location"><span class="fonticon fonticon-3ds-where"></span> '+l.address+", "+l.city+"</span>":"")+((l.email)?'<a class="mail"><span class="fonticon fonticon-mail"></span> '+l.email+"</a>":"")+((l.telephone)?'<a class="phone"><span class="fonticon fonticon-phone"></span> '+l.telephone+"</a>":"")+"</p></div></div>";e.getPlatformServices({onComplete:function(B){var A,x=l&&l.login,w=B&&B[0],y=w&&w["3DSwym"],z;if(y&&x){A="{0}/api/user/getpicture/login/{1}/format/normal".format(y,x);z=d.extendElement(document.body.querySelector(".my-account-header-logo .logo"));d.createElement("img",{src:A}).inject(z)}}});r.enableSelectTenant(document.body.querySelector(".chevron-tenant"));j.className+=" row";u=j.querySelector("."+this.tabsOptions.classNames.scroller+"-ctn");t=j.querySelector("."+this.tabsOptions.classNames.tabPanels);u.className+=" col-xs-4 col-xs-offset-2 col-sm-4 col-sm-offset-2 col-md-4 col-md-offset-2 resetPadding";t.className+=" col-xs-12 col-sm-6 col-md-6";m=d.createElement("select",{"class":"form-control mobile-tab-select"});k=j.querySelectorAll("."+this.tabsOptions.classNames.tabList+" > .wp-tab .title");s=["user","navigation-history","search","lock","cog","rss","list","help"];[].forEach.call(k,function(w){w.innerHTML='<span class="fonticon fonticon-'+s.shift()+'"></span> '+w.innerHTML;m.innerHTML+='<option value="'+q+'">'+w.innerHTML+"</option>";q++});n=d.createElement("div",{"class":"mobile-tab-container col-xs-12"});m.inject(n);j.insertBefore(n,t);m.addEvent("change",function(y){var z=y&&y.target,x=z&&z.value,w=document.body.querySelectorAll(".my-account-tablist li");w[x]&&w[x].click()});v.switchCard(r.getTabToLoad(o))},enableUserSearch:function(){var j=this;e.getPlatformServices({onComplete:function(m){var k=m&&m[0],l=k&&k["3DSwym"];if(l){f.addEvent({events:{search:function(n){var o=n.value||"";window.location.hash=j.endpoint+":"+o;location.reload()},clearSearch:function(){}}})}else{console.error("Account search feature disable")}}})},getCurrentUser:function(){var k=a&&a.getUser(),j=this.parseUrl(),l=j&&j.account;if(l){return this.getUserInfos(l)}if(k){return new h(function(m){m(k)})}else{console.error("User is not defined")}},getUserInfos:function(k){var m=a&&a.getUser();function j(){return new h(function(p,o){e.getPlatformServices({onComplete:function(s){var q=s&&s[0],r=q&&q["3DSwym"];if(r){p(r)}else{console.error("Swym URL not found");o()}}})})}function n(o){return new h(function(q,p){if(o){i.authenticatedRequest(o+"/api/index/tk",{type:"json",onComplete:function(r){if(!r||!r.result||r.error||r.errorcode){console.error("Cannot get Swym Token");p()}else{q({swymURL:o,token:r.result.ServerToken})}}})}else{console.error("Swym URL not defined");p()}})}function l(o){return new h(function(s,r){var p=o&&o.swymURL,q=o&&o.token;if(p&&q){i.authenticatedRequest(p+"/api/user/find/login/"+k,{method:"GET",headers:{"X-DS-SWYM-CSRFTOKEN":q,"Content-Type":"application/json",Accept:"application/json"},onComplete:function(t){if(d.is(t,"string")){t=JSON.parse(t)}if(t&&t.result){s(t.result)}else{console.error("Error on parsing data from Swym");r()}},onFailure:r,onTimeout:r})}else{console.error("Swym URL or Token not defined");r()}})}if(m&&m.login===k){return new h(function(o){o(m)})}else{return j().then(n).then(l).then(this.formatUser)}},formatUser:function(j){return new h(function(k){j.firstName=j.firstName||j.first_name;j.lastName=j.lastName||j.last_name;k(j)})},parseUrl:function(){var j=window&&window.location,m=j&&j.hash,l=j&&j.pathname,n={},k;if(/#account(\:\w+)?\/?(tab\:\w+)?/g.test(m)){m=m.substring(1);k=m.split("/");k.forEach(function(p){var o=p.split(":");n[o[0]]=o[1]});if(n.tab){n.tab=n.tab.charAt(0).toUpperCase()+n.tab.slice(1).toLowerCase()}}return n},setApplicationName:function(){var j=this;j.getCurrentUser().then(function(k){var l=a&&a.getUser();if(l===k){f.set({application:"My Account"})}else{f.set({application:"Profil"})}})},addTopBarItemProfil:function(){var j=new c({id:this.endpoint});j.empty();j.setContent({profile:[{label:"My Account",onExecute:function(){}}]})},setRightMenu:function(){require(["DS/TopBarProxy/TopBarProxy"],function(j){var k=new j({id:"MyAccount"});k.addContent({profile:[{label:"My Account",onExecute:function(){}},{label:"Preferences",onExecute:function(){}},{label:"Sign Out",onExecute:function(){}}]})})},enableSelectTenant:function(j){e.getPlatformServices({onComplete:function(l){var k=[];l.forEach(function(n){var m=n.platformId;k.push({text:m})});require(["DS/UIKIT/DropdownMenu"],function(m){new m({target:j,items:k,events:{onClick:function(o,n){a.setUserProperty("tenantId",n.name);window.location.reload()}}})})}})},getTabToLoad:function(l){var m=l&&l.getValue("defaultCard")||0,k=this.parseUrl(),j=k&&k.tab||m;return j}};return b});