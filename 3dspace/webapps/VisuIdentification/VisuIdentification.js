define("DS/VisuIdentification/Pattern",["UWA/Class"],function(a){var b=a.extend({init:function(e,d,c){this.space=e;this.context=d;this.shared=c;return this},getSpace:function(){return this.space},getContext:function(){return this.context},getSharability:function(){return this.shared},setSpace:function(c){this.space=c},setContext:function(c){this.context=c},setSharability:function(c){this.shared=c},copy:function(c){this.space=c.space;this.context=c.context;this.shared=c.shared;return this},isEqual:function(c){return(this.space===c.space&&this.context===c.context&&this.shared===c.shared)}});return UWA.namespace("THREEDS/Identification/Pattern",b)});define("DS/VisuIdentification/Node",["UWA/Class","DS/VisuIdentification/Pattern"],function(a,d){var c=[];var b=a.extend({init:function(f,e){this.pattern=this._findOrCreatePattern(f);this.localId=e;return this},getLocalId:function(){return this.localId},getPattern:function(){return this.pattern},getSpace:function(){return this.pattern.space},getContext:function(){return this.pattern.context},getSharability:function(){return this.pattern.shared},setLocalId:function(e){this.localId=e},setPattern:function(e){this.pattern=this._findOrCreatePattern(e)},computeId:function(){var e="";if(!this.pattern){return e}e+=this.pattern.getContext();e+=b.delimiter;e+=this.localId;return e},_findOrCreatePattern:function(g){for(var f=0;f<c.length;f++){var e=c[f];if(e.isEqual(g)){return e}}return new d(g.space,g.context,g.shared)}});b.delimiter="#";b.atomicDelimiter="/";return UWA.namespace("THREEDS/Identification/Node",b)});define("DS/VisuIdentification/Converter",["UWA/Class","DS/Visualization/PathElement","DS/VisuIdentification/Node","DS/Visualization/Mesh3D","DS/Visualization/SubElement"],function(b,f,c,a,e){var g=null;var d=b.extend({init:function(){if(g){return g}g=this;return this},buildGlobalId:function(p){var u="";var r="";var q=p.getLength();var m=null;var h=null;var s=null;var k=false;var l=true;var t=true;for(var o=q-1;o>=0;o--){var j=p.getElement(o);var n=j.getModelIdentification();if(n){m=n.getSpace();k=n.getSharability();r=n.computeId();s=n.getContext();if(s&&m&&(s===h)){t=true}if(t){if(!l){r+=c.atomicDelimiter}l=false;r+=u;u=r}t=k;if(!t){h=m}}}return u},decodeGlobalId:function(t,l,p){var h=l.split(c.atomicDelimiter);var v=new f();var w=null;var s=t;v.addElement(s);for(var r=0;r<h.length;r++){var m=h[r];var o=this.findNodeByIdentifier(s,m,p);if(o){if(o instanceof e){v.addElement(o)}else{var n=o;var k=[];while(o!==s){w=o.getParents();k.push(o);o=w[0];if(w.length>1){var u=w.indexOf(s);if(u===-1){console.warn("Impossible to create a PathElement from the identifier.");return null}else{o=s}}}for(var q=k.length-1;q>=0;q--){v.addElement(k[q])}s=n}}}return v},findNodeByIdentifier:function(m,n,i){var l=n.split(c.delimiter);var k=l[0];var j=l[1];if(m instanceof a){return m.getPrimitive(parseInt(j),i)}else{var h={node:null};m.traverse(function(q,o){var r=q.getModelIdentification();var p=r?r.getLocalId():null;var s=r?r.getContext():null;if(p==j&&s===k){o.node=q;return true}return false},h);return h.node}}});return UWA.namespace("THREEDS/Identification/Converter",d)});