/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/SMAMpwControls/SMAMpwSpinBox",["UWA/Core","DS/Controls/SpinBox"],function(e,c){var b=function(){if(this.elements.inputField){var f;if(this.units&&this.units.length>0){f=this.value.toPrecision(this.precision)+(" "+this.units)}else{f=this.value.toPrecision(this.precision)}this.elements.inputField.setText(f);this.elements.inputField.value=f}};var a=function(){var f=this.value;if((this.maxValue!==undefined)&&(this.maxValue!==null)&&(f>this.maxValue)){f=this.maxValue}if((this.minValue!==undefined)&&(this.minValue!==null)&&(f<this.minValue)){f=this.minValue}var g=f;if(this.precision){g=parseFloat(f.toPrecision(this.precision))}return g};var d=c.inherit({name:"spinBox",publishedProperties:{value:{defaultValue:0,type:Number},units:{defaultValue:"",type:String},minValue:{defaultValue:null,type:Number},maxValue:{defaultValue:null,type:Number},stepValue:{defaultValue:0.1,type:Number},pageStepValue:{defaultValue:10,type:Number},decimals:{defaultValue:20,type:Number},precision:{defaultValue:3,type:Number},onValueChanged:{defaultValue:null,type:Function},customClass:{defaultValue:"",type:String},customStyle:{defaultValue:null,type:Object}},_postBuildView:function(){this._parent();b.call(this);if(this.elements.container){this.elements.container.addClassName(this.customClass);if(this.customStyle){e.extend(this.elements.container.style,this.customStyle)}}},_applyValue:function(f){if(isNaN(this.value)){this.value=f}else{var g=a.call(this);if(g!==this.value){this.value=g}else{b.call(this);this.fire("change")}}},_applyProperties:function(f){this._applyDisabled();this._applyVisibleFlag();this._applyTouchMode();if(undefined!==f.value){this._applyValue(f.value)}}});return d});define("DS/SMAMpwControls/SMAMpwInputCursors",["css!DS/SMAMpwControls/SMAMpwInputCursors.css","UWA/Core","DS/Controls/Abstract","DS/CoreEvents/Events","DS/WebappsUtils/Promise"],function(b,f,e,a,d){var c=e.inherit({name:"SMAMpwInputCursors",publishedProperties:{divLegend:{defaultValue:null,type:HTMLElement},valuePrecision:{defaultValue:null,type:Number},localMinValue:{defaultValue:null,type:Number},localMaxValue:{defaultValue:null,type:Number},globalMinValue:{defaultValue:null,type:Number},globalMaxValue:{defaultValue:null,type:Number},isReadOnly:{defaultValue:false,type:Boolean},hideCursors:{defaultValue:false,type:Boolean},passFailImgUrl:{defaultValue:"",type:String},postDOMInsertEventId:{defaultValue:null,type:Number},invertedPalette:{defaultValue:false,type:Boolean},loadColorsImage:{defaultValue:null,type:Function},userMinGetter:{defaultValue:null,type:Function},userMaxGetter:{defaultValue:null,type:Function},updateUserMax:{defaultValue:null,type:Function},updateUserMin:{defaultValue:null,type:Function}},init:function(g){this.outOfBoundBorderWidth=8.5;this.incrementBorderWidth=6;this.currentIncrement="none";this.currentIncrementSign=0;this.displayPassFail=false;this.inAnimation=false;this.isEditing=false;this.callbacks={cursorInputMaxInputCallback:this._editingInputCursor.bind(this),cursorInputMinInputCallback:this._editingInputCursor.bind(this),cursorInputMaxChangeCallback:this._inputValueChanged.bind(this,"max"),cursorInputMinChangeCallback:this._inputValueChanged.bind(this,"min"),cursorInputMaxMousemoveCallback:this.inputSwitchCallback.bind(this),cursorInputMinMousemoveCallback:this.inputSwitchCallback.bind(this)};this._parent(g);this.drawToCanvasInfo={};this.drawToCanvasInfo.image=new f.Element("img");this.loadColorsImage(this.drawToCanvasInfo.image);var h=[];h.push(new d(function(i){this.drawToCanvasInfo.image.onload=i()}.bind(this)));if(this.passFailImgUrl.length){this.drawToCanvasInfo.passFailImage=new f.Element("img");this.drawToCanvasInfo.passFailImage.src=this.passFailImgUrl;h.push(new d(function(i){this.drawToCanvasInfo.passFailImage.onload=i}.bind(this)))}this.drawToCanvasInfo.imagesReady=false;d.all(h).then(function(){this.drawToCanvasInfo.imagesReady=true}.bind(this))},updateLocalMinMax:function(g,h){this.localMinValue=g;this.localMaxValue=h},setAnimationMode:function(g){if(g){this.cursorsDiv.addClassName("cursors-in-animation");this.outOfBoundBorderWidth=11.5;this.incrementBorderWidth=8}else{this.cursorsDiv.removeClassName("cursors-in-animation");this.outOfBoundBorderWidth=8.5;this.incrementBorderWidth=6}this.cursorInputMin.min=-this.outOfBoundBorderWidth;this.cursorInputMax.min=-this.outOfBoundBorderWidth;this.cursorInputMin.max=100+this.outOfBoundBorderWidth;this.cursorInputMax.max=100+this.outOfBoundBorderWidth;this.inAnimation=g},getUserMin:function(){var g=this.userMinGetter();return isNaN(g)?this.localMinValue:g},getUserMax:function(){var g=this.userMaxGetter();return isNaN(g)?this.localMaxValue:g},_postBuildView:function(){this._parent();this.paletteSection=new f.Element("div",{"class":"simux-2dlegend-palette"}).inject(this.divLegend);this.paletteMin=new f.Element("div",{"class":"simux-2dlegend-colorbar simux-2dlegend-colorbar-min",invertFlag:this.invertedPalette}).inject(this.paletteSection);this.paletteColors=new f.Element("div",{"class":"simux-2dlegend-colorbar simux-2dlegend-colorbar-colors"}).inject(this.paletteSection);this.loadColorsImage(this.paletteColors);this.paletteColors.onload=function(){this.colorPaletteImgUrl=this.paletteColors.style["background-image"]}.bind(this);if(this.paletteColors.src){this.paletteColors.style["background-image"]="url("+this.paletteColors.src+")"}this.paletteMax=new f.Element("div",{"class":"simux-2dlegend-colorbar simux-2dlegend-colorbar-max",invertFlag:this.invertedPalette}).inject(this.paletteSection);this.cursorsDiv=new f.Element("div",{"class":"simux-2dlegend-cursors"}).inject(this.divLegend);this.minOutOfRangeLink=new f.Element("div",{invertFlag:this.invertedPalette,"class":"simux-2dlegend-outOfRange simux-2dlegend-outOfRange-min"}).inject(this.cursorsDiv);this.maxOutOfRangeLink=new f.Element("div",{invertFlag:this.invertedPalette,"class":"simux-2dlegend-outOfRange simux-2dlegend-outOfRange-max"}).inject(this.cursorsDiv);this.userMinAnimationCursor=new f.Element("div",{"class":"simux-2dlegend-userAnimationCursor-min simux-2dlegend-userAnimationCursor"}).inject(this.cursorsDiv);this.userMaxAnimationCursor=new f.Element("div",{"class":"simux-2dlegend-userAnimationCursor-max simux-2dlegend-userAnimationCursor"}).inject(this.cursorsDiv);this.cursorInputMin=new f.Element("input",{"class":"simux-2dlegend-cursors-input input-cursor-min",invertFlag:this.invertedPalette,attributes:{type:"range",step:0.1,value:0,min:-this.outOfBoundBorderWidth,max:100+this.outOfBoundBorderWidth}}).inject(this.cursorsDiv);this.cursorInputMax=new f.Element("input",{"class":"simux-2dlegend-cursors-input input-cursor-max",invertFlag:this.invertedPalette,attributes:{type:"range",step:0.1,value:100,min:-this.outOfBoundBorderWidth,max:100+this.outOfBoundBorderWidth}}).inject(this.cursorsDiv);this.minOutOfRangeLink.hide();this.maxOutOfRangeLink.hide();this.cursorInputMax.hide();this.cursorInputMin.hide();var g=a.subscribe({event:this.postDOMInsertEventId},function(){if(!this.hideCursors){this.cursorInputMin.show();this.cursorInputMax.show();this.toggleCallbacks(true);this._updateInputCursor("none",this.cursorInputMin);this._updateInputCursor("none",this.cursorInputMax);this._inputValueChanged("max");this._inputValueChanged("min")}if(this.isReadOnly){this.cursorInputMin.disabled=true;this.cursorInputMax.disabled=true}a.unsubscribe(g)}.bind(this))},_editingInputCursor:function(j,i){var l=parseFloat(this.cursorInputMax.value);var k=parseFloat(this.cursorInputMin.value);if(j&&(j.target===this.cursorInputMin&&this._lastChangedMin===k||j.target===this.cursorInputMax&&this._lastChangedMax===l)){return}var g;if(!j){g=i==="min"?this.cursorInputMin:this.cursorInputMax;this.isEditing=false}else{g=j.target;this.isEditing=true}if(k<0&&l<0){g.value="0"}else{if(k>100&&l>100){g.value="100"}else{if(k>l){this._updateCursorsColors();var h=this.cursorInputMax;this.cursorInputMax=this.cursorInputMin;this.cursorInputMin=h}}}if(j||i==="min"||i==="max"){var m=(g.className.indexOf("min")>=0)?"min":"max";this._updateInputCursor(m,g)}},_updateInputCursor:function(k,h){var i=parseFloat(h.value);var g;if(i<0){if(k!=="none"){g=i<-this.incrementBorderWidth?-1:1;if(this.currrentIncrement!=="min"||this.currentIncrementSign!==g){this.currentIncrement="min";this.currentIncrementSign=g;this.outOfBoundIncrement("min",g)}}}else{if(i>100){if(k!=="none"){g=i>100+this.incrementBorderWidth?1:-1;if(this.currrentIncrement!=="max"||this.currentIncrementSign!==g){this.currentIncrement="max";this.currentIncrementSign=g;this.outOfBoundIncrement("max",g)}}}else{this.currentIncrement="none";this.currentIncrementSign=0;var j=this.localMinValue+(i/100)*(this.localMaxValue-this.localMinValue);if(k==="min"){this.updateUserMin(j)}else{if(k==="max"){this.updateUserMax(j)}}}}this.updateScale("none");this._updateOutOfBoundDisplay()},_inputValueChanged:function(i){this.currentIncrement="none";this.isEditing=false;var h=(i==="min")?this.cursorInputMin:this.cursorInputMax;var g=parseFloat(h.value);if(g>100){if(this.getUserMax().toPrecision(this.valuePrecision)===this.localMaxValue.toPrecision(this.valuePrecision)){h.value="100";this.updateUserMax()}else{h.value=Math.round(100+this.incrementBorderWidth).toString()}}else{if(g<0){if(this.getUserMin().toPrecision(this.valuePrecision)===this.localMinValue.toPrecision(this.valuePrecision)){h.value="0";this.updateUserMin()}else{h.value=Math.round(-this.incrementBorderWidth).toString()}}}this._lastChangedMin=parseFloat(this.cursorInputMin.value);this._lastChangedMax=parseFloat(this.cursorInputMax.value);this._updateOutOfBoundDisplay()},updateScale:function(m){if(!m){}if(m==="min"||m==="max"){this.updateCursorsFromMinMax(m)}var n=this.paletteSection.offsetWidth;if(!this.isReadOnly){if(this.localMinValue===this.localMaxValue){this.paletteMin.style.width=n.toString()+"px";this.paletteMax.style.width=0;this.paletteColors.style.width=0;this.cursorInputMax.hide();this.cursorInputMin.hide();this.cursorInputMin.disabled=true;this.cursorInputMax.disabled=true;return}else{if(this.cursorInputMin.disabled||this.cursorInputMax.disabled){this.cursorInputMax.show();this.cursorInputMin.show();if(!this.inAnimation){this.cursorInputMin.disabled=false;this.cursorInputMax.disabled=false}}}}var j,g;if(this.inAnimation){if(isNaN(this.userMinGetter())){j=0}else{j=(this.getUserMin()-this.globalMinValue)/(this.globalMaxValue-this.globalMinValue)}if(isNaN(this.userMaxGetter())){g=0}else{g=(this.globalMaxValue-this.getUserMax())/(this.globalMaxValue-this.globalMinValue)}}else{j=(this.getUserMin()-this.localMinValue)/(this.localMaxValue-this.localMinValue);g=(this.localMaxValue-this.getUserMax())/(this.localMaxValue-this.localMinValue)}var l=j*n;var i=Math.min(g*n,n);var h=n-l-i+1;var k=function(o){return Math.round(Math.max(Math.min(n,o),0)).toString()+"px"};this.paletteMin.style.width=k(l);this.paletteMax.style.width=k(i);this.paletteColors.style.width=k(Math.min(h,n-l,n-i));if(l<0){this.paletteColors.style["background-position"]=l.toString()+"px"}else{this.paletteColors.style["background-position"]=0}this.paletteColors.style["background-size"]=(h).toString()+"px 25px";if(this.inAnimation&&(this.userMinGetter()||this.userMaxGetter())){this.userMinAnimationCursor.style.left=k(j*n);this.userMaxAnimationCursor.style.right=k(g*n);this.userMinAnimationCursor.show();this.userMaxAnimationCursor.show()}else{this.userMinAnimationCursor.hide();this.userMaxAnimationCursor.hide()}},resetInputCursor:function(g){this._editingInputCursor(null,g);this.updateScale("none");this._updateCursorsColors()},updateCursorsFromMinMax:function(l){if(this.isEditing){return}var g=this.getUserMin();var j=this.getUserMax();var k;var i;if(this.inAnimation){k=this.globalMinValue;i=this.globalMaxValue;g=this.localMinValue;j=this.localMaxValue}else{k=this.localMinValue;i=this.localMaxValue}var h;if(l==="min"||l==="both"){if(g.toPrecision(this.valuePrecision)===k.toPrecision(this.valuePrecision)){h=0}else{h=100*(g-k)/(i-k);if(h<0){h=-this.incrementBorderWidth}}this.cursorInputMin.value=h.toString()}if(l==="max"||l==="both"){if(j.toPrecision(this.valuePrecision)===i.toPrecision(this.valuePrecision)){h=100}else{h=100*(1-(i-j)/(i-k));if(h>100){h=100+this.incrementBorderWidth}}this.cursorInputMax.value=h.toString()}this._updateOutOfBoundDisplay()},_updateOutOfBoundDisplay:function(){if(this.localMinValue===this.localMaxValue){this.minOutOfRangeLink.hide();this.maxOutOfRangeLink.hide();return}if(parseFloat(this.cursorInputMin.value)<-2){this.minOutOfRangeLink.show()}else{this.minOutOfRangeLink.hide()}if(102<parseFloat(this.cursorInputMax.value)){this.maxOutOfRangeLink.show()}else{this.maxOutOfRangeLink.hide()}},_updateCursorsColors:function(){var h=parseFloat(this.cursorInputMax.value);var g=parseFloat(this.cursorInputMin.value);if(g>h){if(this.cursorInputMax.hasClassName("input-cursor-max")){this.cursorInputMax.removeClassName("input-cursor-max");this.cursorInputMax.addClassName("input-cursor-min")}if(this.cursorInputMin.hasClassName("input-cursor-min")){this.cursorInputMin.removeClassName("input-cursor-min");this.cursorInputMin.addClassName("input-cursor-max")}}else{if(this.cursorInputMax.hasClassName("input-cursor-min")){this.cursorInputMax.removeClassName("input-cursor-min");this.cursorInputMax.addClassName("input-cursor-max")}if(this.cursorInputMin.hasClassName("input-cursor-max")){this.cursorInputMin.removeClassName("input-cursor-max");this.cursorInputMin.addClassName("input-cursor-min")}}},outOfBoundIncrement:function(i,g){if(this.currentIncrement!==i||this.currentIncrementSign!==g){return}var j=(this.localMaxValue-this.localMinValue)/20;var h;if(i==="min"){h=this.getUserMin()+g*j;if(h>this.localMinValue){this.updateUserMin(this.localMinValue);return}this.updateUserMin(this.getUserMin()+g*j)}else{h=this.getUserMax()+g*j;if(h<this.localMaxValue){this.updateUserMax(this.localMaxValue);return}this.updateUserMax(this.getUserMax()+g*j)}this.updateScale("none");setTimeout(this.outOfBoundIncrement.bind(this,i,g),300)},_getDistToMouse:function(h,g){var i=(parseFloat(h.value)-parseFloat(h.min))/(parseFloat(h.max)-parseFloat(h.min));var j=h.offsetWidth*i;return Math.abs(j-g)},inputSwitchCallback:function(k){var i=k.offsetX;var j,h;var g=this._getDistToMouse(this.cursorInputMin,i);var l=this._getDistToMouse(this.cursorInputMax,i);if(g<l){j=this.cursorInputMin;h=this.cursorInputMax}else{j=this.cursorInputMax;h=this.cursorInputMin}if(k.target!==j){j.value=h.value}},togglePassFail:function(){this.displayPassFail=!this.displayPassFail;if(this.displayPassFail){this.paletteMin.style["background-color"]="#b8b8b8";this.paletteColors.style["background-image"]=this.passFailImgUrl;this.paletteMax.style["background-color"]="red"}else{this.paletteMin.style["background-color"]="blue";this.paletteColors.style["background-image"]=this.colorPaletteImgUrl;this.paletteMax.style["background-color"]="red"}},toggleCallbacks:function(j){var i=navigator.userAgent.indexOf("Trident")>=0;var k=navigator.userAgent.indexOf("Edge")>=0;var l=!i?"input":"change";var h=!i?"change":"mouseup";var g="mousedown";if(j&&!this.isReadOnly){this.cursorInputMax.disabled=false;this.cursorInputMin.disabled=false;this.cursorInputMax.addEventListener(l,this.callbacks.cursorInputMaxInputCallback);this.cursorInputMin.addEventListener(l,this.callbacks.cursorInputMinInputCallback);this.cursorInputMax.addEventListener(h,this.callbacks.cursorInputMaxChangeCallback);this.cursorInputMin.addEventListener(h,this.callbacks.cursorInputMinChangeCallback);if(i||k){this.cursorInputMax.addEventListener(g,this.callbacks.cursorInputMaxMousemoveCallback);this.cursorInputMin.addEventListener(g,this.callbacks.cursorInputMinMousemoveCallback);this.cursorInputMax.style["pointer-events"]="auto";this.cursorInputMin.style["pointer-events"]="auto"}}else{this.cursorInputMax.disabled=true;this.cursorInputMin.disabled=true;this.cursorInputMax.removeEventListener(l,this.callbacks.cursorInputMaxInputCallback);this.cursorInputMin.removeEventListener(l,this.callbacks.cursorInputMinInputCallback);this.cursorInputMax.removeEventListener(h,this.callbacks.cursorInputMaxChangeCallback);this.cursorInputMin.removeEventListener(h,this.callbacks.cursorInputMinChangeCallback);if(i||k){this.cursorInputMax.removeEventListener(g,this.callbacks.cursorInputMaxMousemoveCallback);this.cursorInputMin.removeEventListener(g,this.callbacks.cursorInputMinMousemoveCallback);this.cursorInputMax.style["pointer-events"]="none";this.cursorInputMin.style["pointer-events"]="none"}}if(j){this.updateCursorsFromMinMax("both")}},drawToCanvas:function(o,p,s){if(!this.drawToCanvasInfo.imagesReady){}var n=s+this.divLegend.offsetTop;var q=function(t){return !isNaN(t)?t:0};var j=!this.invertedPalette?"blue":"red";var g=!this.invertedPalette?"red":"blue";n+=this.paletteSection.offsetTop-8;var l=function(t,w,u,x,v){var y=t.fillStyle;t.fillStyle=u;t.fillRect(p+w.offsetLeft+q(x),n+w.offsetTop+q(v),w.clientWidth,w.clientHeight);t.fillStyle=y};l(o,this.paletteMin,j);var r=this.paletteColors.clientWidth;var k=parseInt(this.paletteColors.style["background-size"]);var m=r*198/k;var i=-parseInt(this.paletteColors.style["background-position"])*r/k;o.drawImage(this.drawToCanvasInfo.image,i,2,m,5,p+this.paletteMin.clientWidth,n,r,8);l(o,this.paletteMax,g);n-=7;if(this.minOutOfRangeLink.style.display!=="none"){l(o,this.minOutOfRangeLink,j)}if(this.maxOutOfRangeLink.style.display!=="none"){l(o,this.maxOutOfRangeLink,g)}n+=10;var h=function(t,x){var w=t.fillStyle;var u=x?this.paletteMin.offsetWidth:this.paletteMax.offsetLeft;if(x&&this.minOutOfRangeLink.style.display!=="none"){u-=15}else{if(!x&&this.maxOutOfRangeLink.style.display!=="none"){u+=15}}t.beginPath();t.arc(p+u,n,8.5,0,2*Math.PI);var v=t.createRadialGradient(p+u,n,4.5,p+u,n,8.5);if((x&&!this.invertedPalette)||(!x&&this.invertedPalette)){v.addColorStop(0,"rgb(0, 0, 255)");v.addColorStop(1,"rgb(0, 0, 190)")}else{v.addColorStop(0,"rgb(255, 0, 0)");v.addColorStop(1,"rgb(190, 0, 0)")}t.fillStyle=v;t.fill();t.stroke();t.fillStyle=w}.bind(this);h(o,true);h(o,false)}});return c});define("DS/SMAMpwControls/SMAMpwTooltipedImage",["css!DS/SMAMpwControls/SMAMpwTooltipedImage.css","UWA/Core","DS/Controls/Abstract"],function(a,d,c){var b=c.inherit({name:"SMAMpwTooltipedImage",publishedProperties:{imageUrl:{defaultValue:"",type:String},title:{defaultValue:"",type:String},customStyle:{defaultValue:null,type:Object}},init:function(e){this._parent(e)},buildView:function(){},_postBuildView:function(){this._parent();if(this.elements.container){this.elements.image=new d.Element("img",{"class":"simux-tooltiped-image"}).inject(this.elements.container);this.elements.image.src=this.imageUrl;this.elements.title=new d.Element("p").inject(this.elements.container);if(this.title&&this.title.length>0){this.elements.title.setText(this.title)}}},});return b});define("DS/SMAMpwControls/SMAMpwEditableLabel",["css!DS/SMAMpwControls/SMAMpwEditableLabel.css","UWA/Core","DS/Controls/Abstract","DS/SMAMpwControls/SMAMpwSpinBox"],function(a,e,d,b){var c=d.inherit({name:"SMAMpwEditableLabel",publishedProperties:{value:{defaultValue:0,type:Number},resetValue:{defaultValue:null,type:Number},units:{defaultValue:"",type:String},minValue:{defaultValue:null,type:Number},maxValue:{defaultValue:null,type:Number},stepValue:{defaultValue:0.1,type:Number},pageStepValue:{defaultValue:10,type:Number},precision:{defaultValue:3,type:Number},onSwitchToEditMode:{defaultValue:null,type:Function},onSwitchToLabelMode:{defaultValue:null,type:Function},onValueChanged:{defaultValue:null,type:Function},onValueReset:{defaultValue:null,type:Function},labelCustomClass:{defaultValue:"",type:String},labelStyle:{defaultValue:null,type:Object},spinBoxCustomClass:{defaultValue:"",type:String},spinBoxStyle:{defaultValue:null,type:Object},resetButtonCustomClass:{defaultValue:"",type:String},resetButtonStyle:{defaultValue:null,type:Object},readOnlyFlag:{defaultValue:false,type:Boolean},editabilityCheck:{defaultValue:null,type:Function},resetFlag:{defaultValue:false,type:Boolean}},init:function(f){this.inAnimation=false;this._parent(f)},buildView:function(){},_postBuildView:function(){this._parent();if(this.elements.container){if(!this.readOnlyFlag){this.elements.labelEditableDeco=new e.Element("span",{html:'<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-pencil"></span>',"class":"simux-editablelabel-editabledeco "+this.labelCustomClass,styles:this.labelStyle}).inject(this.elements.container)}this.elements.spinBox=new b({value:this.value,units:this.units,minValue:this.minValue,maxValue:this.maxValue,stepValue:this.stepValue,pageStepValue:this.pageStepValue,precision:this.precision,decimals:20,customClass:this.spinBoxCustomClass,customStyle:this.spinBoxStyle});this.elements.spinBox.inject(this.elements.container);if(!this.readOnlyFlag){if(this.resetFlag){if(null===this.resetValue){this.resetValue=this.value}this.elements.resetButton=new e.Element("a",{html:'<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload"></span>',"class":"simux-editablelabel-resetbutton "+this.resetButtonCustomClass,styles:this.resetButtonStyle,events:{click:this.resetToInitialValue.bind(this)}});this.elements.resetButton.inject(this.elements.container);if(this._isResetToDisplay()){this.elements.resetButton.show();this.elements.spinBox.show();this.elements.labelEditableDeco.hide()}else{if(this.elements.resetButton){this.elements.resetButton.hide()}if(this.elements.spinBox){this.elements.spinBox.hide()}if(this.elements.labelEditableDeco){this.elements.labelEditableDeco.show()}}}}this.setReadOnlyFlag(this.readOnlyFlag)}},handleEvents:function(){if(this.readOnlyFlag){return}if(this.elements&&this.elements.spinBox){this.elements.spinBox.handleEvents();this.elements.spinBox.addEventListener("change",this._onSpinBoxChange.bind(this));this.elements.spinBox.elements.inputField.addEventListener("focusout",this._updateLabel.bind(this))}this.elements.labelEditableDeco.addEventListener("click",this.switchToEditMode.bind(this))},setProperties:function(f){this._parent(f);if(
/*!this.readOnlyFlag && */
this.elements&&this.elements.spinBox){this.elements.spinBox.setProperties(f)}},resetToInitialValue:function(){this.setProperties({value:this.resetValue});this.elements.resetButton.hide();this.elements.spinBox.hide();this.elements.labelEditableDeco.show();if(this.onValueReset){this.onValueReset()}},setDisplayedValue:function(f){if(!isNaN(f)){this._labelValue=f;if(this.elements.spinBox){if(this.value.toPrecision(this.precision)!==this._labelValue.toPrecision(this.precision)){this.setProperties({value:this._labelValue})}}if(!this.readOnlyFlag){if(this._isResetToDisplay()){this.elements.resetButton.show();this.elements.spinBox.show();this.elements.labelEditableDeco.hide()}else{if(this.elements.resetButton){this.elements.resetButton.hide()}if(this.elements.spinBox){this.elements.spinBox.hide()}if(this.elements.labelEditableDeco){this.elements.labelEditableDeco.show()}}}}},updateLabelDisplay:function(){this._updateLabel()},setResetValue:function(f){if(!isNaN(f)){this.resetValue=f}},setInAnimation:function(f){this.inAnimation=f},setReadOnlyFlag:function(g){this.setProperties({readOnlyFlag:g});if(this.readOnlyFlag){this.elements.spinBox.setProperties({disabled:true})}else{this.elements.spinBox.setProperties({disabled:false})}var f=false;if(this.elements.resetButton){if(g){this.elements.resetButton.hide()}else{if(this._isResetToDisplay()){this.elements.resetButton.show();f=true}}}if(this.elements.labelEditableDeco){if(g||f){this.elements.labelEditableDeco.hide()}else{this.elements.labelEditableDeco.show()}}if(g&&this.inAnimation){this.elements.spinBox.show()}else{if(this.value===this.resetValue){this.elements.spinBox.hide()}}},switchToEditMode:function(){if(!this.readOnlyFlag){if(null===this.editabilityCheck||this.editabilityCheck()){if(this.elements.resetButton){this.elements.resetButton.hide()}this.elements.spinBox.show();this.elements.labelEditableDeco.hide();var f=this.elements.spinBox.elements.inputField;f.focus();f.value=parseFloat(f.value).toPrecision(this.precision);f.setSelectionRange(0,f.value.length);if(this.onSwitchToEditMode){this.onSwitchToEditMode()}}}},getText:function(){var f=this.elements.spinBox.elements.inputField.getText();if(!f.length){f=this.resetValue.toPrecision(this.precision)}return f},_isResetToDisplay:function(){var f=this.value.toPrecision(this.precision)!==this.resetValue.toPrecision(this.precision);return(this.resetFlag&&this.elements.spinBox&&f)},_onSpinBoxChange:function(){if(this.inAnimation){return}this._updateLabel();var f=this.elements.spinBox.value;this._labelValue=f;if(this.onValueChanged){if(f.toPrecision(this.precision)===this.resetValue.toPrecision(this.precision)){this.onValueChanged()}else{this.onValueChanged(f)}}},_updateLabel:function(){if(!this.readOnlyFlag){if(this._labelValue===this.resetValue){this.elements.spinBox.hide();this.elements.resetButton.hide();this.elements.labelEditableDeco.show()}else{this.elements.spinBox.show();this.elements.resetButton.show();this.elements.labelEditableDeco.hide()}}}});return c});define("DS/SMAMpwControls/SMAMpwLegend",["require","css!DS/SMAMpwControls/SMAMpwLegend.css","i18n!DS/SMAMpwControls/assets/nls/SMAMpwLegend","UWA/Core","DS/Controls/Abstract","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/UIKIT/Tooltip","DS/UIKIT/Input/Select","DS/SMAMpwControls/SMAMpwEditableLabel","DS/SMAMpwControls/SMAMpwInputCursors"],function(e){var k=e("i18n!DS/SMAMpwControls/assets/nls/SMAMpwLegend");var f=e("UWA/Core");var g=e("DS/Controls/Abstract");var h=e("DS/WebappsUtils/WebappsUtils");var d=e("DS/CoreEvents/Events");var j=e("DS/UIKIT/Tooltip");var a=e("DS/UIKIT/Input/Select");var l=e("DS/SMAMpwControls/SMAMpwEditableLabel");var c=e("DS/SMAMpwControls/SMAMpwInputCursors");var b=2000;if(!Array.prototype.find){Array.prototype.find=function(m){if(this===null){throw new TypeError("Array.prototype.find called on null or undefined")}if(typeof m!=="function"){throw new TypeError("predicate must be a function")}var r=Object(this);var p=r.length>>>0;var n=arguments[1];var q;for(var o=0;o<p;o++){q=r[o];if(m.call(n,q,o,r)){return q}}return undefined}}var i=g.inherit({name:"smaMpwLegend",publishedProperties:{readOnly:{defaultValue:true,type:Boolean},displayMode:{defaultValue:0,type:Number},smoothColors:{defaultValue:false,type:Boolean},displayTitle:{defaultValue:true,type:Boolean},displayBlocks:{defaultValue:true,type:Boolean},displayFrameSelector:{defaultValue:true,type:Boolean},enableFrameSelector:{defaultValue:true,type:Boolean},displayLock:{defaultValue:true,type:Boolean},displayPassFailToggle:{defaultValue:false,type:Boolean},valuePrecision:{defaultValue:3,type:Number},legendDataProvider:{defaultValue:null,type:Object},legendControler:{defaultValue:null,type:Object}},destroy:function(){this._parent();if(this._navModeCallback){d.unsubscribe(this._navModeCallback)}if(this._animModeCallback){d.unsubscribe(this._animModeCallback)}if(this._inputsAnimModeCallback){d.unsubscribe(this._inputsAnimModeCallback)}if(this._inputsNavModeCallback){d.unsubscribe(this._inputsNavModeCallback)}if(this._userMinMdlCallback){d.unsubscribe(this._userMinMdlCallback)}if(this._userMaxMdlCallback){d.unsubscribe(this._userMaxMdlCallback)}if(this._postDomInsertCallback){d.unsubscribe(this._postDomInsertCallback)}if(this._updateCallback){d.unsubscribe(this._updateCallback)}if(this._viewerResizedCallback){d.unsubscribe(this._viewerResizedCallback)}},buildView:function(){this._cursorsHidden=true},_buildLock:function(m){this._partialAnimLockSpan=new f.Element("div",{"class":"simux-2dlegend-lock-container"}).inject(m);this._partialAnimLockSpan.style["vertical-align"]="middle";this._partialAnimLock=new f.Element("div",{"class":"wux-afr-cmdstarter",styles:{"vertical-align":"middle"}}).inject(this._partialAnimLockSpan);this._partialAnimLockIcon=new f.Element("div",{"class":"simux-2dlegend-partialPlay",styles:{"background-image":"url("+h.getWebappsBaseUrl()+"SMAMpwControls/assets/icons/32/I_SimNavPartialPlay.png)"}}).inject(this._partialAnimLock);this._partialAnimLock.addEvent("click",function(){this._partialAnimLock.toggleClassName("wux-ui-state-active");var n=this._partialAnimLock.hasClassName("wux-ui-state-active");this._partialAnimLockIcon.style["background-image"]="url("+h.getWebappsBaseUrl()+"SMAMpwControls/assets/icons/32/I_SimNavPartialPlay"+(n?"On":"")+".png)";if(n){this.legendControler.onLock()}else{this.legendControler.onUnLock()}if(this._frameSelector){this._frameSelector.onChange()}else{this.legendControler.onFrameSelectorChange(this.legendControler.getCurrentFrameId()+1)}}.bind(this));this._updatePlayOnlyVisibility();this._lockTooltip=new j({target:this._partialAnimLockSpan,body:k.get("playOnlyTooltip")})},_buildBlocks:function(r){var m=this.legendDataProvider.getScopeBlocks();if(m.length>1&&m.length<=200){this.timeBlocksDiv=new f.Element("div",{"class":"simux-2dlegend-blockzone"}).inject(r);this.timeBlocks=[];for(var u=0;u<m.length;u++){var o=m[u];if(o){var s=new f.Element("span",{id:o.id,"class":"simux-2dlegend-block"}).inject(this.timeBlocksDiv);var q=true;var n=true;if(u<m.length-1){q=false}if(o.percentSize<5){q=false;n=false}var t=o.percentSize-1;var p=((n?3:0)+(q?3:0))/(m.length+1);s.style.width=(t-p).toString()+"%";s.style["border-right-style"]=q?"solid":"none";s.style["border-left-style"]=n?"solid":"none";o.toolTip=new j({target:s,body:o.name});this.timeBlocks.push(s)}}this._updateBlocks()}},_buildFrameSelector:function(p,r){var q=this.legendDataProvider.getFrameSelectorEntries();var o=(r+1).toString();if(q.length<=b){this._frameSelector=new a({nativeSelect:true,placeholder:k.get("frameSelectorPlaceHolder"),options:q}).inject(p);var n=this._frameSelector.getContent();if(n){n.style["vertical-align"]="middle"}this._frameSelector.setValue(o)}else{this._frameLabel=new f.Element("p").inject(p);var m=q.find(function(s){return s.value===o});if(m){this._frameLabel.setText(m.label)}}this._setSelectorAvailability(false);if(this.enableFrameSelector){if(this._frameSelector){this._frameSelector.onChange=function(){this.legendControler.onFrameSelectorChange(parseInt(this._frameSelector.getValue()[0]))}.bind(this)}this._setSelectorAvailability(true);if(this._navModeCallback){d.unsubscribe(this._navModeCallback)}this._navModeCallback=d.subscribe({event:this.legendControler.getNavigationModeEventId()},function(){this.legendControler.onNavigationMode();this._setSelectorAvailability(true);this._cursorsHidden=true;if(this.inputCursors){var s=this.legendControler.getCurrentFrameId();var t=this.legendDataProvider.getLocalComputedMin(s);var u=this.legendDataProvider.getLocalComputedMax(s);this.inputCursors.updateLocalMinMax(t,u);this.inputCursors.updateScale("none");this.inputCursors.updateCursorsFromMinMax("both")}if(this.lowerMinText&&this.lowerMaxText){this.lowerMinText.setReadOnlyFlag(this.readOnly);this.lowerMaxText.setReadOnlyFlag(this.readOnly)}this._updatePlayOnlyVisibility()}.bind(this));if(this._animModeCallback){d.unsubscribe(this._animModeCallback)}this._animModeCallback=d.subscribe({event:this.legendControler.getAnimationModeEventId()},function(){this._setSelectorAvailability(false);if(this.lowerMinText&&this.lowerMaxText){this.lowerMinText.setReadOnlyFlag(true,true);this.lowerMaxText.setReadOnlyFlag(true,true)}}.bind(this))}},_buildPassFailToggle:function(m){this.passfailSwitchDiv=new f.Element("div").inject(m);this.passfailSwitchDiv.style["vertical-align"]="middle";this.passfailSwitchDiv.style.display="inline-block";this.pfButton=new f.Element("div",{html:'<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-thumbs-up simux-2dlegend-thumbs-up-reversed"></span><span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-thumbs-up simux-2dlegend-thumbs-up"></span>',"class":"simux-2dlegend-button a",events:{click:function(){var n=this.pfButton.hasClassName("simux-2dlegend-button-active");if(!n){this.pfButton.toggleClassName("simux-2dlegend-button-active");this.contourButton.toggleClassName("simux-2dlegend-button-active");this.inputCursors.togglePassFail();this.legendControler.onPassFailActivation()}}.bind(this)}}).inject(this.passfailSwitchDiv);this.contourButton=new f.Element("div",{html:'<span class="wux-ui-3ds wux-ui-3ds-1x"><b>#</b></span>',"class":"simux-2dlegend-button simux-2dlegend-button-active simux-2dlegend-font-size-big a",events:{click:function(){var n=this.contourButton.hasClassName("simux-2dlegend-button-active");if(!n){this.contourButton.toggleClassName("simux-2dlegend-button-active");this.pfButton.toggleClassName("simux-2dlegend-button-active");this.inputCursors.togglePassFail();this.legendControler.onPassFailDeactivation()}}.bind(this)}}).inject(this.passfailSwitchDiv)},_buildMinMax:function(t){var u=(this.legendDataProvider.getInvertedFlag()==="1");this.upperMinMaxSection=new f.Element("div",{"class":"simux-2dlegend-upperMinMaxSection"}).inject(this.divLegend);var p=new f.Element("div",{"class":"simux-2dlegend-upperMin"}).inject(this.upperMinMaxSection);this.upperMinLink=new f.Element("div",{"class":"simux-2dlegend-upperMinMaxLink",invertFlag:u}).inject(p);this.minText=new f.Element("p").inject(p);this.minText.setText(k.get("min")+" "+this.legendDataProvider.getGlobalComputedMin().toPrecision(this.valuePrecision));var r=new f.Element("div",{"class":"simux-2dlegend-upperMax"}).inject(this.upperMinMaxSection);this.maxText=new f.Element("p").inject(r);this.maxText.setText(k.get("min")+" "+this.legendDataProvider.getGlobalComputedMax().toPrecision(this.valuePrecision));this.upperMaxLink=new f.Element("div",{"class":"simux-2dlegend-upperMinMaxLink",invertFlag:u}).inject(r);var o=this.legendDataProvider.getGlobalComputedMax()-this.legendDataProvider.getGlobalComputedMin();this._zeroGlobalRange=(o===0);var n=this.legendDataProvider.getLocalComputedMin(t);var s=this.legendDataProvider.getLocalComputedMax(t);var q=this.readOnly||this._zeroGlobalRange;this.inputCursors=new c({divLegend:this.divLegend,valuePrecision:this.valuePrecision,passFailImgUrl:this.legendDataProvider.getPassFailColorsImageUrl?"url("+this.legendDataProvider.getPassFailColorsImageUrl()+")":"",localMinValue:n,localMaxValue:s,isReadOnly:q,hideCursors:this._zeroGlobalRange,invertedPalette:u,globalMinValue:this.legendDataProvider.getGlobalComputedMin(),globalMaxValue:this.legendDataProvider.getGlobalComputedMax(),loadColorsImage:this.legendDataProvider.loadColorsImage,userMinGetter:this.legendDataProvider.getUserMin,userMaxGetter:this.legendDataProvider.getUserMax,postDOMInsertEventId:this.legendControler.getPostDOMInsertEventId(),updateUserMin:this.legendControler.onMinChanged,updateUserMax:this.legendControler.onMaxChanged});if(this.legendControler.getAnimationModeEventId){if(this._inputsAnimModeCallback){d.unsubscribe(this._inputsAnimModeCallback)}this._inputsAnimModeCallback=d.subscribe({event:this.legendControler.getAnimationModeEventId()},function(){var w=this.legendControler.getCurrentFrameId();var v=this.legendDataProvider.getLocalComputedMin(w);var x=this.legendDataProvider.getLocalComputedMax(w);this.inputCursors.updateLocalMinMax(v,x);this.inputCursors.setAnimationMode(true);this.inputCursors.toggleCallbacks(false)}.bind(this))}if(this.legendControler.getNavigationModeEventId){if(this._inputsNavModeCallback){d.unsubscribe(this._inputsNavModeCallback)}this._inputsNavModeCallback=d.subscribe({event:this.legendControler.getNavigationModeEventId()},function(){this.lowerMinText.setInAnimation(false);this.lowerMaxText.setInAnimation(false);this._updateUpperMinMax(false);this.inputCursors.setAnimationMode(false);this.inputCursors.toggleCallbacks(true);var w=this.legendControler.getCurrentFrameId();var v=this.legendDataProvider.getLocalComputedMin(w);var x=this.legendDataProvider.getLocalComputedMax(w);this.inputCursors.updateLocalMinMax(v,x);this.lowerMinText.setDisplayedValue(this.legendDataProvider.getUserMin());this.lowerMaxText.setDisplayedValue(this.legendDataProvider.getUserMax())}.bind(this))}var m=new f.Element("div",{"class":"simux-2dlegend-local"}).inject(this.divLegend);this.lowerMinText=new l({value:!isNaN(this.legendDataProvider.getUserMin())&&!this._zeroGlobalRange?this.legendDataProvider.getUserMin():n,resetValue:n,readOnlyFlag:q,resetFlag:true,editabilityCheck:this.legendControler.checkEditability,maxValue:!isNaN(this.legendDataProvider.getUserMax())?this.legendDataProvider.getUserMax():s,stepValue:(s-n)/10,pageStepValue:(s-n)/4,precision:this.valuePrecision,onSwitchToEditMode:function(){this._minEditing=true}.bind(this),onSwitchToLabelMode:function(){this._minEditing=false;this._updateUpperMinMax()}.bind(this),onValueChanged:function(v){this.legendControler.onMinChanged(v)}.bind(this),onValueReset:function(){this.inputCursors.resetInputCursor("min");this.legendControler.onMinChanged()}.bind(this),labelCustomClass:"simux-2dlegend-min-label",spinBoxCustomClass:"simux-2dlegend-min-spin",resetButtonCustomClass:"simux-2dlegend-min-reset"});this.lowerMinText.inject(m);this.lowerMinText.elements.container.addClassName("simux-2dlegend-min");if(!q){if(this._userMinMdlCallback){d.unsubscribe(this._userMinMdlCallback)}this._userMinMdlCallback=d.subscribe({event:this.legendControler.getUserMinMdlEventId()},function(x){var v;if(x&&!isNaN(x.value)){v=x.value}else{var w=this.legendControler.getCurrentFrameId();v=this.legendDataProvider.getLocalComputedMin(w)}if(this.lowerMinText){this.lowerMinText.setDisplayedValue(v)}if(this.lowerMaxText){this.lowerMaxText.setProperties({minValue:v})}this._updateUpperMinMax();this.inputCursors.updateScale("min")}.bind(this))}this.lowerMaxText=new l({value:!isNaN(this.legendDataProvider.getUserMax())&&!this._zeroGlobalRange?this.legendDataProvider.getUserMax():s,resetValue:s,readOnlyFlag:q,resetFlag:true,editabilityCheck:this.legendControler.checkEditability,minValue:!isNaN(this.legendDataProvider.getUserMin())?this.legendDataProvider.getUserMin():n,stepValue:(s-n)/10,pageStepValue:(s-n)/4,precision:this.valuePrecision,onSwitchToEditMode:function(){this._maxEditing=true}.bind(this),onSwitchToLabelMode:function(){this._maxEditing=false;this._updateUpperMinMax()}.bind(this),onValueChanged:function(v){this.legendControler.onMaxChanged(v)}.bind(this),onValueReset:function(){this.inputCursors.resetInputCursor("max");this.legendControler.onMaxChanged()}.bind(this),labelCustomClass:"simux-2dlegend-max-label",spinBoxCustomClass:"simux-2dlegend-max-spin",resetButtonCustomClass:"simux-2dlegend-max-reset"});this.lowerMaxText.inject(m);this.lowerMaxText.elements.container.addClassName("simux-2dlegend-max");if(!q){if(this._userMaxMdlCallback){d.unsubscribe(this._userMaxMdlCallback)}this._userMaxMdlCallback=d.subscribe({event:this.legendControler.getUserMaxMdlEventId()},function(x){var v;if(x&&!isNaN(x.value)){v=x.value}else{var w=this.legendControler.getCurrentFrameId();v=this.legendDataProvider.getLocalComputedMax(w)}if(this.lowerMaxText){this.lowerMaxText.setDisplayedValue(v)}if(this.lowerMinText){this.lowerMinText.setProperties({maxValue:v})}this._updateUpperMinMax();this.inputCursors.updateScale("max")}.bind(this))}this._postDomInsertCallback=d.subscribe({event:this.legendControler.getPostDOMInsertEventId()},function(){d.unsubscribe(this._postDomInsertCallback);this._updateUpperMinMax();this.updateSizeResponsive()}.bind(this))},_postBuildView:function(){this._parent();if(this.elements.container&&this.legendDataProvider&&this.legendControler){var q=this.legendDataProvider.getDefaultFrameId();var p=new f.Element("div",{id:"legendMainContainer","class":"simux-2dlegend-main"}).inject(this.elements.container);this.elements.divMain=p;if(this.displayTitle){var r=new f.Element("div",{id:"legendTitle","class":"simux-2dlegend-title"}).inject(p);this.elements.title=r;this.titleText=new f.Element("p").inject(r);this._updateTitle()}var t=new f.Element("div",{"class":"simux-2dlegend-scopeNav"}).inject(p);this.elements.scopeNavDiv=t;this.divLegend=new f.Element("div",{"class":"simux-2dlegend"+(this.displayMode>0?" simux-2dlegend-vertical":"")}).inject(p);this.elements.divLegend=this.divLegend;if(this.displayLock){this._buildLock(t)}var m;if(this.displayBlocks||this.displayFrameSelector){m=new f.Element("div",{"class":"simux-2dlegend-scopeNav-content",styles:{display:"inline-block"}}).inject(t)}if(this.displayBlocks){this._buildBlocks(m)}if(this.displayFrameSelector){this._buildFrameSelector(m,q)}if(this.displayPassFailToggle){this._buildPassFailToggle(t)}var s=this.legendDataProvider.hasMinMax();var o=this.legendDataProvider.hasDeformationScales();if(s||o){if(s){this._buildMinMax(q)}if(o){var n=this.legendDataProvider.getDeformationScaleFactor(q);this.scaleDiv=new f.Element("div",{id:"legendScale","class":"simux-2dlegend-scalefactor"}).inject(this.divLegend);if(n<=0){this.scaleDiv.hide()}this.scaleText=new f.Element("p",{styles:{clear:"both","text-align":"left"}}).inject(this.scaleDiv);this.scaleText.setText(k.get("scaleFactor")+": "+(n).toPrecision(this.valuePrecision))}if(this.legendControler.onNavigationMode){this.legendControler.onNavigationMode()}}if(this.legendControler.getDataUpdateEventId){this._updateCallback=d.subscribe({event:this.legendControler.getDataUpdateEventId()},function(){this._updateTitle();this._updateLowerSection();this._updateUpperMinMax();this.updateSizeResponsive()}.bind(this))}if(this.legendControler.onPostBuildCallback){this.legendControler.onPostBuildCallback()}}if(this.displayMode===0&&this.legendControler.getResponsiveEventId){this._viewerResizedCallback=d.subscribe({event:this.legendControler.getResponsiveEventId()},this.updateSizeResponsive.bind(this))}},_updateTitle:function(){if(this.displayTitle){if(this.legendDataProvider&&this.legendDataProvider.getTitle()){this.titleText.setText(this.legendDataProvider.getTitle())}}},_updateLowerSection:function(q){var n=this.legendControler.isInAnimationMode?this.legendControler.isInAnimationMode():false;if(this.lowerMinText&&this.lowerMaxText){if(!isNaN(q)){q=this.legendControler.getCurrentFrameId()}var p=this.legendDataProvider.getLocalComputedMin(q);var r=this.legendDataProvider.getLocalComputedMax(q);var o={stepValue:(r-p)/10,pageStepValue:(r-p)/4};this.lowerMinText.setInAnimation(n);this.lowerMaxText.setInAnimation(n);this.lowerMinText.setResetValue(p);this.lowerMaxText.setResetValue(r);this.lowerMinText.setProperties({maxValue:r});this.lowerMaxText.setProperties({minValue:p});this.lowerMinText.setProperties(o);this.lowerMaxText.setProperties(o);if(isNaN(this.legendDataProvider.getUserMin())||this._zeroGlobalRange||n){this.lowerMinText.setDisplayedValue(p)}if(isNaN(this.legendDataProvider.getUserMax())||this._zeroGlobalRange||n){this.lowerMaxText.setDisplayedValue(r)}this.lowerMinText.updateLabelDisplay();this.lowerMaxText.updateLabelDisplay()}if(this.scaleDiv&&this.scaleText){var m=this.legendDataProvider.getDeformationScaleFactor(q);if(m>=0){this.scaleDiv.show()}else{this.scaleDiv.hide()}this.scaleText.setText(k.get("scaleFactor")+": "+(m).toPrecision(this.valuePrecision))}},_updateUpperMinMax:function(n){if(this.minText&&this.maxText){if(n===undefined){n=this.legendControler.isInAnimationMode?this.legendControler.isInAnimationMode():false}if(!n){var m=this.legendControler.getCurrentFrameId();if(!isNaN(m)){this.maxText.setText(k.get("max")+" "+this.legendDataProvider.getLocalComputedMax(m).toPrecision(this.valuePrecision));this.minText.setText(k.get("min")+" "+this.legendDataProvider.getLocalComputedMin(m).toPrecision(this.valuePrecision))}}else{if(n&&!this.legendDataProvider.hasScanAnimation()){this.minText.setText(this.legendDataProvider.getGlobalComputedMin().toPrecision(this.valuePrecision));this.maxText.setText(this.legendDataProvider.getGlobalComputedMax().toPrecision(this.valuePrecision))}}}},_setSelectorAvailability:function(m){if(this._frameSelector){if(m){this._frameSelector.enable()}else{this._frameSelector.disable()}}if(this._partialAnimLock){if(m){this._partialAnimLock.removeClassName("wux-ui-state-disabled")}else{this._partialAnimLock.addClassName("wux-ui-state-disabled")}}},_updatePlayOnlyVisibility:function(){if(this._partialAnimLockSpan&&this.legendControler){var m=this.legendControler.getLockAvailability();if(m){this.elements.divMain.addClassName("responsive-has-lock")}this._partialAnimLockSpan.style.display=m?"inline-flex":"none";if(this._partialAnimLock){if(this.legendControler.getLockStatus()){this._partialAnimLock.addClassName("wux-ui-state-active");this._partialAnimLockIcon.style["background-image"]="url("+h.getWebappsBaseUrl()+"SMAMpwControls/assets/icons/32/I_SimNavPartialPlayOn.png)"}else{this._partialAnimLock.removeClassName("wux-ui-state-active");this._partialAnimLockIcon.style["background-image"]="url("+h.getWebappsBaseUrl()+"SMAMpwControls/assets/icons/32/I_SimNavPartialPlay.png)"}}}},_updateBlocks:function(){if(this.timeBlocks&&this.timeBlocks.length>=1){var p=this.legendControler.getCurrentScopeBlockId();var n=this.legendControler.getLockStatus()?"#e2e4e3":"#78befa";for(var m=0;m<this.timeBlocks.length;m++){var o=this.timeBlocks[m];if(o){o.style["background-color"]=n;if(o.id===p){o.style["background-color"]="#368ec4"}}}}},updateSizeResponsive:function(){var p=this.elements.divMain;if(p.offsetWidth===0){return}if(this.displayMode===1){if(this.inputCursors){this.inputCursors.updateScale("none")}return}var m=this.elements.container.offsetParent.offsetParent;var t=["responsive-medium","responsive-small","responsive-icon"];var o;var n=t.length;for(o=0;o<n;o++){p.removeClassName(t[o])}var q=1/5;var s={};s.width=Math.min(m.offsetWidth,m.offsetHeight);s.left=Math.max(0,0.5*(m.offsetWidth-m.offsetHeight));s.right=s.left+s.width;s.top=Math.max(0,0.5*(m.offsetHeight-m.offsetWidth));var r=function(){var w=p.offsetParent.offsetTop+p.offsetParent.offsetHeight;var v=p.offsetParent.offsetLeft;var x=Math.min(p.offsetWidth,s.width,Math.max(0,s.right-v));var u=Math.min(p.offsetHeight,s.width,Math.max(0,w-s.top));var y=x*u>q*s.width*s.width;return y||p.offsetParent.offsetLeft<=0};if(r()){p.addClassName("responsive-medium");if(r()){p.addClassName("responsive-small");if(r()){p.addClassName("responsive-icon")}}}if(this.inputCursors){this.inputCursors.updateScale("none")}},animate:function(v){this._updateLowerSection(v);this._cursorsHidden=!this.legendControler.areCursorsVisible(v);var B=!this.legendControler.isInAnimationMode?this.legendControler.isInAnimationMode():false;this._updateUpperMinMax();if(this.inputCursors){var n,A;n=this.legendDataProvider.getLocalComputedMin(v);A=this.legendDataProvider.getLocalComputedMax(v);this.inputCursors.updateLocalMinMax(n,A);this.inputCursors.updateCursorsFromMinMax("both");this.inputCursors.updateScale("none")}this._updatePlayOnlyVisibility();this._updateBlocks();var p=this._frameSelector;var u=this._frameLabel;var r=this.legendDataProvider.getFrameSelectorEntries();var z=p?p:u;var t=function(C){return r.find(function(D){return D.value===C})};var s=p?p.getOption.bind(p):t;var o=p?p.select.bind(p):function(D){if(u){var C=t(D);if(C){u.setText(C.label)}}};if(z){var x=(v+1).toString();if(s(x)){o(x);if(this.legendDataProvider.updateDefaultFrameId){this.legendDataProvider.updateDefaultFrameId(x-1)}}else{if(!B){var m=v+1;var y=false;var w=this.legendControler.getCurrentScopeStartFrameId();var q=this.legendControler.getCurrentScopeEndFrameId();while(!y&&m>w&&m<=q+1){x=m.toString();y=(null!==s(x));if(!y){m++}}if(y){o(x);if(this.legendDataProvider.updateDefaultFrameId){this.legendDataProvider.updateDefaultFrameId(x-1)}}}}}},drawToCanvas:function(q,s,p){if(q){p-=80;var u=this.elements.divMain.hasClassName("responsive-icon");this.elements.divMain.removeClassName("responsive-icon");var r=12;q.font=r.toString()+"px Arial";var t=function(z){return !isNaN(z)?z:0};var x=function(z,B,C,A){if(z&&B){z.fillText(B.getText(),s+t(B.offsetLeft)+t(C),p+t(B.offsetTop)+t(A))}};var o=function(z,B,C,A){if(z&&B){x(z,B,C,A)}};var n=function(z,G,A,F,E,B){if(z&&G){var D=s+t(G.offsetLeft)+t(E);var C=p+t(G.offsetTop)+t(B);z.strokeSyle=A?A:"black";z.beginPath();z.moveTo(D,C);if(F.indexOf("l")>=0){z.lineTo(D,C+G.offsetHeight)}else{z.moveTo(D,C+G.offsetHeight)}if(F.indexOf("b")>=0){z.lineTo(D+G.offsetWidth,C+G.offsetHeight)}else{z.moveTo(D+G.offsetWidth,C+G.offsetHeight)}if(F.indexOf("r")>=0){z.lineTo(D+G.offsetWidth,C)}else{z.moveTo(D+G.offsetWidth,C)}if(F.indexOf("t")>=0){z.lineTo(D,C)}else{z.moveTo(D,C)}z.stroke()}};x(q,this.titleText,30,40);if(this._frameSelector){var m=this._frameSelector.getOption(this._frameSelector.getValue()[0]);if(m){q.fillText(m.getText(),s+30,p+60+r)}}var y=this.upperMinMaxSection.offsetParent.offsetTop+10;x(q,this.minText,this.minText.offsetParent.offsetLeft,y);x(q,this.maxText,this.maxText.offsetParent.offsetLeft,y);n(q,this.upperMinLink,"#666666","lt",this.upperMinLink.offsetParent.offsetLeft,y);n(q,this.upperMaxLink,"#666666","tr",this.upperMaxLink.offsetParent.offsetLeft,y);this.inputCursors.drawToCanvas(q,s,p+10);if(this.lowerMinText&&this.lowerMaxText){var v=this.divLegend.offsetTop+this.lowerMaxText.elements.container.offsetParent.offsetTop+10;o(q,this.lowerMinText,0,v);o(q,this.lowerMaxText,0,v)}var w=this.divLegend.offsetTop+this.scaleDiv.offsetTop;x(q,this.scaleText,0,w);if(u){this.elements.divMain.addClassName("responsive-icon")}}}});return i});