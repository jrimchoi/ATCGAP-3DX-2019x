define("DS/Mesh/Mesh",["DS/Mesh/ThreeJS_Base"],function(e){var g=g||{REVISION:"1"};var h=((new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)!=null));var f=(new RegExp("Edge","i").test(navigator.userAgent));g.VertexComponentEnum={POSITION:0,NORMAL:1,DIFFUSE_COLOR:2,TEX_COORD_0:3,TEX_COORD_1:4,TEX_COORD_2:5,TEX_COORD_3:6,TEX_COORD_4:7,TEX_COORD_5:8,TEX_COORD_6:9,TEX_COORD_7:10,USER_COMPONENT_0:11};g.DataTypeEnum={UCHAR:0,USHORT:1,UINT:2,CHAR:3,SHORT:4,INT:5,FLOAT:6,DOUBLE:7};g.GeomTypeString={};(function(){var j=["EDGE","WIRE_EDGE","BOUNDARY_EDGE","SHARP_EDGE","SMOOTH_EDGE","HIDDEN_SEAM_EDGE","BOUNDARY_POINT","SHARP_POINT","SMOOTH_POINT","HIDDEN_SEAM_POINT","SURFACIC_POINT","FREE_POINT","INFINITE_FACE","FACE","UNKNOWN","AXIS_SYSTEM"];var k,i;for(k=0;k<j.length;k++){i=j[k];g.GeomTypeString[e.GeomTypeEnum[i]]=i}})();g.sizeOfDataType=function(i){switch(i){case g.DataTypeEnum.FLOAT:case g.DataTypeEnum.INT:case g.DataTypeEnum.UINT:return 4;case g.DataTypeEnum.CHAR:case g.DataTypeEnum.UCHAR:return 1;case g.DataTypeEnum.SHORT:case g.DataTypeEnum.USHORT:return 2;case g.DataTypeEnum.DOUBLE:return 8;default:return 0}};g.ConnectivityTypeEnum={TRIANGLES:0,TRIANGLE_FAN:1,TRIANGLE_STRIP:2,LINES:3,LINE_STRIP:4,LINE_LOOP:5,POINTS:6};g.PointSymbolEnum={CROSS:0,PLUS:1,CONCENTRIC:2,COINCIDENT:3,FULLCIRCLE:4,FULLSQUARE:5,STAR:6,DOT:7,SMALLDOT:8};g.LinePatternEnum={UNKNOWN:0,SOLID:1,DOTTED:2,DASHED:3,DOTDASHED:4,PHANTOM:5,SMALLDOTTED:6,JISAXIS:7};g.NOPICKABLE=0;g.PICKABLE=1;g.NODRAWHL=2;g.INVISIBLE=2;g.PICK_NEVER=0;g.PICK_ALWAYS=1;g.PICK_VISIBLE=2;g.PICK_INVISIBLE=3;g.Color=function(l,k,i,j){this.r=l||0;this.g=k||0;this.b=i||0;this.a=(j==undefined?1:j)};g.Color.prototype={constructor:g.Color,setRGBA:function(l,k,i,j){this.r=l;this.g=k;this.b=i;this.a=j},isEqual:function(i){return((this.r===i.r)&&(this.g===i.g)&&(this.b===i.b)&&(this.a===i.a))},clone:function(){return new g.Color(this.r,this.g,this.b,this.a)}};g.FillAttributes=function(k,i,j){this.color=k||new g.Color();this.solid=i||this.solid||0;this.basic=j||this.basic||false};g.FillAttributes.prototype={constructor:g.FillAttributes,isEqual:function(i){return(i!==null)&&this.color.isEqual(i.color)&&(this.solid===i.solid)&&(this.basic===i.basic)},clone:function(){return new g.FillAttributes(this.color.clone(),this.solid)}};g.LineAttributes=function(i,j,k){this.color=i||new g.Color();this.thickness=(Math.round(j)>1?Math.round(j):1);this.pattern=k||g.LinePatternEnum.SOLID;this.forceMaterial=false};g.LineAttributes.prototype={constructor:g.LineAttributes,isEqual:function(i){return(i!==null)&&(this.color.isEqual(i.color)&&(this.thickness===i.thickness)&&(this.pattern===i.pattern)&&(this.forceMaterial===i.forceMaterial)&&((this.forceLineWidth===i.forceLineWidth)||(this.thickness==1)))},clone:function(){return new g.LineAttributes(this.color.clone(),this.thickness,this.pattern)}};g.PointAttributes=function(i,j,k){this.color=i||new g.Color();this.size=j||1;this.symbol=k||g.PointSymbolEnum.CROSS;this.forceMaterial=false};g.PointAttributes.prototype={constructor:g.PointAttributes,isEqual:function(i){return(i!==null)&&(this.color.isEqual(i.color)&&(this.size===i.size)&&(this.forceMaterial===i.forceMaterial)&&(this.symbol===i.symbol))},clone:function(){return new g.PointAttributes(this.color.clone(),this.size,this.symbol)}};var d=new g.FillAttributes();var c=new g.LineAttributes();var a=new g.PointAttributes();g.PrimitiveGroup=function(i){this.identifier=0;this.nbPrimitives=0;this.primitives=[];this.nbBuffers=0;this.buffers=[];this.material=null;this.fillAttr=d;this.lineAttr=c;this.pointAttr=a;this.noz=false;this.editable=false;if(i){if(i.fillGAS!==undefined){this.fillAttr=i.fillGAS}if(i.lineGAS!==undefined){this.lineAttr=i.lineGAS}if(i.pointGAS!==undefined){this.pointAttr=i.pointGAS}if(i.identifier!==undefined){this.identifier=i.identifier}if(i.editable!==undefined){this.editable=i.editable}if(i.noz!==undefined){this.noz=i.noz}}};g.PrimitiveGroup.prototype={constructor:g.PrimitiveGroup,addPrimitive:function(i){this.primitives.push(i);this.nbPrimitives++;return this},addBuffer:function(j,i){this.buffers[j]=i;this.nbBuffers++;return this},removeBuffer:function(i){this.buffers[i]=null;this.nbBuffers--},getBuffer:function(j){var l;for(l in this.buffers){var k=this.buffers[l];if(k.component===j){return k}}return null},getBufferFromId:function(j){var i=this.buffers[j];if(i!==undefined){return i}return null}};g.Buffer=function(i){this.indexBuffer=false;this.size=0;this.component=g.VertexComponentEnum.POSITION;this.format=g.DataTypeEnum.FLOAT;this.dimension=3;this.data=null;if(i){if(i.indexBuffer){this.indexBuffer=true}if(i.component!==undefined){this.component=i.component}if(i.format!==undefined){this.format=i.format}if(i.dimension){this.dimension=i.dimension}if(i.data){this.data=i.data}}};g.Primitive=function(i){this.identifier=0;this.nbIndices=0;this.connectivity=g.ConnectivityTypeEnum.TRIANGLES;this.nbVertexComponents=0;this.geomType=null;this.vertexComponents=[];this.attr=null;this.material=null;if(i){if(i.nbIndices!==undefined){this.nbIndices=i.nbIndices}if(i.connectivity!==undefined){this.connectivity=i.connectivity}if(i.geomType!==undefined){this.geomType=i.geomType}if(i.identifier!==undefined){this.identifier=i.identifier}if(i.fillGAS||i.lineGAS||i.pointGAS){if(!this.attr){this.attr={fill:d,line:c,point:a}}if(i.fillGAS){this.attr.fill=i.fillGAS}if(i.lineGAS){this.attr.line=i.lineGAS}if(i.pointGAS){this.attr.point=i.pointGAS}}}};g.Primitive.prototype={constructor:g.Primitive,addVertexComponent:function(i){this.vertexComponents.push(i);this.nbVertexComponents++;return this}};g.VertexComponent=function(i){this.component=g.VertexComponentEnum.POSITION;this.nbVertices=0;this.nbValuesPerVertex=0;this.format=g.DataTypeEnum.FLOAT;this.cardinality=0;this.bufferId="";this.offset=0;this.indices=null;if(i){if(i.nbVertices!==undefined){this.nbVertices=i.nbVertices}if(i.cardinality!==undefined){this.cardinality=i.cardinality}if(i.bufferId!==undefined){this.bufferId=i.bufferId}if(i.indices!==undefined){this.indices=i.indices}if(i.offset!==undefined){this.offset=i.offset}}};g.IndexArray=function(i){this.format=g.DataTypeEnum.UINT;this.bufferId="";this.offset=0;if(i){if(i.bufferId!==undefined){this.bufferId=i.bufferId}if(i.offset!==undefined){this.offset=i.offset}}};g.Material=function(){this.type="material";this.identifier=0;this.colorAmbient=[];this.colorDiffuse=[];this.colorSpecular=[];this.shininess=0;this.ambientCoef=0;this.diffuseCoef=0;this.specularCoef=0;this.transparent=0;this.reflectivityCoef=0;this.textureId=-1;this.textureImageNumberComposante=0;this.textureBlending=1;this.magFilter=0;this.minFilter=0;this.mappingFunction=0;this.textureWrapS=0;this.textureWrapT=0;this.addedComposantInTexEnv=0;this.shaderMaterial=null};g.Material.prototype={constructor:g.Material,clone:function(){return new g.Material()}};g.SGNode=function(i){this.type=0;if(i){this.cgmId=i.cgmId!==undefined?i.cgmId:-1;this.parent=i.parent!==undefined?i.parent:null;this.solid=i.solid!==undefined?i.solid:false}else{this.cgmId=-1;this.parent=null;this.solid=false}};g.SGNode.prototype={constructor:g.SGNode};g.SGBag=function(i){g.SGNode.call(this,i);i=i||{};this.type=1;this.matrix=i.matrix!==undefined?i.matrix:null;this.children=i.children!==undefined?i.children:[]};g.SGBag.prototype=new g.SGNode();g.SGBag.prototype.constructor=g.SGBag;g.SGBag.prototype.childClone=function(){var i=new Array();for(var j in this.children){i[j]=typeof(this.children[j])=="object"?this.children[j].clone():this.children[j]}return i};g.SGBag.prototype.clone=function(){return new g.SGBag({cgmId:this.cgmId,type:this.type,children:this.childClone(),matrix:this.matrix!==null?this.matrix.clone():null,parent:this.parent,solid:this.solid})};g.SGRep=function(i){g.SGNode.call(this,i);this.type=2;if(i){this.matrix=i.matrix!==undefined?i.matrix:null;this.primitives=i.primitives!==undefined?i.primitives:[];this.boundingSphere=i.boundingSphere!==undefined?i.boundingSphere:null;this.sag=i.sag!==undefined?i.sag:null;this.namingContext=i.namingContext!==undefined?i.namingContext:0}else{this.matrix=null;this.primitives=[];this.boundingSphere=null;this.sag=null;this.namingContext=0}};g.SGRep.prototype=new g.SGNode();g.SGRep.prototype.constructor=g.SGRep;g.SGRep.prototype.primitivesClone=function(){var i=new Array();for(var j in this.primitives){i[j]=typeof(this.primitives[j])=="object"?this.primitives[j].clone():this.primitives[j]}return i};g.SGRep.prototype.clone=function(){return new g.SGRep({cgmId:this.cgmId,type:this.type,primitives:this.primitivesClone(),matrix:this.matrix?this.matrix.clone():null,parent:this.parent,solid:this.solid,sag:this.sag,boundingSphere:this.boundingSphere?{radius:this.boundingSphere.radius,center:[this.boundingSphere.center[0],this.boundingSphere.center[1],this.boundingSphere.center[2]]}:null})};g.SGPrimitive=function(i){this.type=3;if(i){this.cgmId=i.cgmId!==undefined?i.cgmId:-1;this.rep=i.rep!==undefined?i.rep:null;this.group=i.group!==undefined?i.group:null;this.start=i.start!==undefined?i.start:0;this.count=i.count!==undefined?i.count:0;this.boundingSphere=i.boundingSphere!==undefined?i.boundingSphere:undefined;this.decoration=i.decoration!==undefined?i.decoration:0}else{this.cgmId=-1;this.rep=null;this.group=null;this.start=0;this.count=0;this.boundingSphere=undefined;this.decoration=0}};g.SGPrimitive.prototype.constructor=g.SGPrimitive;g.SGPrimitive.prototype.clone=function(){return new g.SGPrimitive({type:this.type,cgmId:this.cgmId,rep:this.rep,group:this.group,start:this.start,count:this.count,boundingSphere:this.boundingSphere?{radius:this.boundingSphere.radius,center:[this.boundingSphere.center[0],this.boundingSphere.center[1],this.boundingSphere.center[2]]}:undefined,decoration:this.decoration})};g.SGPrimitive.prototype.getIdentificationObject=function(){return this.IdentObj};g.SGPrimitive.prototype.setIdentificationObject=function(i){this.IdentObj=i};g.SGPrimitive.prototype.computeBoundingSphere=function(){var r=this.start;var t=this.count;if(t==0){return}var k=this.group.geometry.vertexIndexArray;var A=this.group.geometry.vertexPositionArray;var G=null;var q=0;var s=k[r];var p=A[3*s];var n=A[3*s+1];var l=A[3*s+2];var o=p;var m=n;var j=l;for(var F=1;F<t;++F){s=k[r+F];var w=A[3*s];var v=A[3*s+1];var u=A[3*s+2];if(w<p){p=w}else{if(w>o){o=w}}if(v<n){n=v}else{if(v>m){m=v}}if(u<l){l=u}else{if(u>j){j=u}}}var E=(p+o)/2;var D=(n+m)/2;var C=(l+j)/2;var q=0;for(var F=0;F<t;++F){s=k[r+F];var w=A[3*s];var v=A[3*s+1];var u=A[3*s+2];var B=(u-C)*(u-C)+(v-D)*(v-D)+(w-E)*(w-E);if(B>q){q=B}}q=Math.sqrt(q);return new e.Sphere(new e.Vector3(E,D,C),q)};var b={EDGE:1,WIRE_EDGE:2,BOUNDARY_EDGE:3,SHARP_EDGE:4,SMOOTH_EDGE:5,BOUNDARY_POINT:6,SHARP_POINT:7,SMOOTH_POINT:8,SURFACIC_POINT:9,FREE_POINT:10,INFINITE_FACE:11,FACE:12,UNKNOWN:13};g.getConvertedVec3=function(j,k){var i=[j[k],j[k+1],j[k+2]];return new e.Vector3(i[0],i[1],i[2])};g.isEqualGAS=function(i,j){if((i==null)&&(j==null)){return true}if(((i==null)&&(j!=null))||((i!=null)&&(j==null))){return false}return(i.fill.isEqual(j.fill)&&i.line.isEqual(j.line)&&i.point.isEqual(j.point))};g.isEqualMaterial=function(j,i){if((j==null)&&(i==null)){return true}if(((j==null)&&(i!=null))||((j!=null)&&(i==null))){return false}return(j.id==i.id)&&(j.file==i.file)};g.convertToMaterial3js=function(m,l){if(m==null){return null}var k=null;var j=1;var i=null;switch(l){case 0:j=(m.point.color.a==undefined?1:m.point.color.a);i=new e.Color();if(m.point.color){i.setRGB(m.point.color.r,m.point.color.g,m.point.color.b);k={color:i,opacity:j,symbol:m.point.symbol,pointsize:m.point.size};if(m.point.forceMaterial){k.forceMaterial=true}}break;case 1:j=(m.line.color.a==undefined?1:m.line.color.a);i=new e.Color();if(m.line.color){i.setRGB(m.line.color.r,m.line.color.g,m.line.color.b);k={color:i,opacity:j,lineWidth:m.line.thickness,pattern:m.line.pattern};if(m.line.forceMaterial){k.forceMaterial=true}}break;case 2:j=(m.fill.color.a==undefined?1:m.fill.color.a);i=new e.Color();if(m.fill.color){i.setRGB(m.fill.color.r,m.fill.color.g,m.fill.color.b);k={color:i,opacity:j,solid:m.fill.solid,basic:m.fill.basic}}break;default:break}return k};g.areEqualGraphicProperties=function(i,j){if(i.color==null||j.color==null){return false}if((i.color.r!=j.color.r)||(i.color.g!=j.color.g)||(i.color.b!=j.color.b)){return false}if(i.thickness&&j.thickness&&(i.thickness!=j.thickness)){return false}if(i.pointsize&&j.pointsize&&(i.pointsize!=j.pointsize)){return false}if(i.opacity!=j.opacity){return false}return true};g.validatePrimitiveGroup=function(o){var n,m;for(n=0;n<o.buffers.length;n++){var l=o.buffers[n];if(l){l.size=l.data.byteLength/g.sizeOfDataType(l.format);if(l.indexBuffer){l.format=g.DataTypeEnum.UINT;l.dimension=1}}}for(n=0;n<o.primitives.length;n++){var k=o.primitives[n];if(!k.attr){k.attr={fill:o.fillAttr,line:o.lineAttr,point:o.pointAttr}}for(m=0;m<k.nbVertexComponents;m++){var p=k.vertexComponents[m];var l=o.getBufferFromId(p.bufferId);p.component=l.component;p.nbValuesPerVertex=l.dimension;p.format=l.format}}};g.checkMeshOptimizable=function(q){var l=null;var k=[];for(var p=0;p<q.buffers.length;p++){var n=q.buffers[p];if(!n){continue}if(n.indexBuffer){if(!l){l=n}else{return false}}else{if(!k[n.component]){k[n.component]=n}else{return false}}}for(var o=0;o<q.primitives.length;o++){var m=q.primitives[o];if(m.connectivity===g.ConnectivityTypeEnum.TRIANGLE_STRIP||m.connectivity===g.ConnectivityTypeEnum.TRIANGLE_FAN||m.connectivity===g.ConnectivityTypeEnum.LINE_STRIP){return false}}return true};g.createGeometryOptimized=function(D,p){var w=new g.Mesh();w.rep=p;for(var O=0;O<D.buffers.length;O++){var B=D.buffers[O];var Q=B.component;var R=B.data;if(B.indexBuffer){w.vertexIndexArray=R;continue}switch(Q){case g.VertexComponentEnum.POSITION:w.vertexPositionArray=R;break;case g.VertexComponentEnum.NORMAL:w.vertexNormalArray=R;break;case g.VertexComponentEnum.DIFFUSE_COLOR:w.vertexColorArray=R;break;case g.VertexComponentEnum.TEX_COORD_0:w.vertexUvArray=R;break;case g.VertexComponentEnum.TEX_COORD_1:w.vertexUv2Array=R;break;case g.VertexComponentEnum.TEX_COORD_2:w.vertexTangentArray=R;break;case g.VertexComponentEnum.TEX_COORD_3:w.vertexBinormalArray=R;break;default:break}}var m=[];var I=[];var z=D.nbPrimitives;for(var O=0;O<z;O++){var s=D.primitives[O];var M=!!s.vertexComponents[0].indices;var N=0;var v=m.length;if(!M){I.push(s);continue}for(N=0;N<v;N++){var x=m[N];if((x.connectivity==s.connectivity)&&(x.geomType==s.geomType)&&g.isEqualGAS(x.gas,s.attr)&&(((x.material==null)&&(s.material==null))||((x.material.id==s.material.id)&&(x.material.file==s.material.file)))){x.set.push(s);x.nbIndices+=s.nbIndices;break}}if(N===m.length){var u={connectivity:s.connectivity,geomType:s.geomType,gas:s.attr,material:s.material,nbIndices:s.nbIndices,set:[s]};m.push(u)}}m.sort(function(n,j){if(n.connectivity<j.connectivity){return -1}if(n.connectivity>j.connectivity){return 1}if(n.geomType&&j.geomType){var k=b[n.geomType];var i=b[j.geomType];if(k&&i){return k-i}}return 0});for(var O=0;O<m.length;O++){m[O].set.sort(function(j,i){var n=j.vertexComponents[0].indices;var k=i.vertexComponents[0].indices;if(n&&k){return n.offset-k.offset}return 0})}for(var O=0;O<m.length;O++){var C=m[O];var J=[];var y=C.set[0].vertexComponents[0].indices.offset;var l=C.set[0].vertexComponents[0].indices.offset;var F=0;var E=0;while(E<C.set.length){for(var N=E;N<C.set.length;N++){var t=C.set[N];if(!t.vertexComponents[0].indices||(t.vertexComponents[0].indices.offset!==l)||(N===C.set.length-1)){if(N===C.set.length-1){J.push(t);F+=t.nbIndices;E=N+1}else{E=N}var S=(C.connectivity===g.ConnectivityTypeEnum.TRIANGLES)?4:((C.connectivity===g.ConnectivityTypeEnum.LINES)?1:0);var G=(S===4)?2:S;var o=new g.DrawingGroup(g.convertToMaterial3js(C.gas,G),C.material,S,y,F,undefined,undefined,e.GeomTypeEnum[C.geomType]);o._geomType=C.geomType?e.GeomTypeEnum[C.geomType]:0;w.drawingGroups.push(o);for(var L=0;L<J.length;L++){var P=J[L];var r=new g.SGPrimitive({cgmId:P.identifier,rep:w.rep,group:o,start:P.vertexComponents[0].indices.offset,count:P.nbIndices});o.primitives.push(r);w.rep.primitives.push(r)}y=t.offset;l=t.offset;F=0;J.length=0;break}J.push(t);l+=t.nbIndices;F+=t.nbIndices}}}for(var O=0;O<I.length;O++){var P=I[O];var S=(P.connectivity===g.ConnectivityTypeEnum.TRIANGLES)?4:((P.connectivity===g.ConnectivityTypeEnum.LINES)?1:0);var G=(S===4)?2:S;var o=new g.DrawingGroup(g.convertToMaterial3js(P.attr,G),P.material,S,P.vertexComponents[0].offset,P.nbIndices,undefined,undefined,e.GeomTypeEnum[P.geomType]);o._geomType=P.geomType?e.GeomTypeEnum[P.geomType]:0;o.nonIndexed=true;w.drawingGroups.push(o);var r=new g.SGPrimitive({cgmId:P.identifier,rep:w.rep,group:o,start:P.vertexComponents[0].offset,count:P.nbIndices});o.primitives.push(r);w.rep.primitives.push(r)}var V=new e.Color();var T=new e.Color();var q=new e.Color();if(D.fillAttr.color){V.setRGB(D.fillAttr.color.r,D.fillAttr.color.g,D.fillAttr.color.b)}if(D.lineAttr.color){T.setRGB(D.lineAttr.color.r,D.lineAttr.color.g,D.lineAttr.color.b)}w.gas.fill={color:V,opacity:(D.fillAttr.color.a==undefined?1:D.fillAttr.color.a),solid:D.fillAttr.solid};w.gas.line={color:T,opacity:(D.lineAttr.color.a==undefined?1:D.lineAttr.color.a),lineWidth:D.lineAttr.thickness,pattern:(D.lineAttr.pattern||1)};if(D.pointAttr){if(D.pointAttr.color){q.setRGB(D.pointAttr.color.r,D.pointAttr.color.g,D.pointAttr.color.b)}w.gas.point={color:q,opacity:(D.pointAttr.color.a==undefined?1:D.pointAttr.color.a),pointsize:D.pointAttr.size}}var U=[0,0,0];var A=[0,0,0];if(w.vertexPositionArray){var H=w.vertexPositionArray.length;if(H>=3){U=[w.vertexPositionArray[0],w.vertexPositionArray[1],w.vertexPositionArray[2]];A=[w.vertexPositionArray[0],w.vertexPositionArray[1],w.vertexPositionArray[2]];for(var K=0;K<H;K+=3){if(w.vertexPositionArray[K]<U[0]){U[0]=w.vertexPositionArray[K]}if(w.vertexPositionArray[K+1]<U[1]){U[1]=w.vertexPositionArray[K+1]}if(w.vertexPositionArray[K+2]<U[2]){U[2]=w.vertexPositionArray[K+2]}if(w.vertexPositionArray[K]>A[0]){A[0]=w.vertexPositionArray[K]}if(w.vertexPositionArray[K+1]>A[1]){A[1]=w.vertexPositionArray[K+1]}if(w.vertexPositionArray[K+2]>A[2]){A[2]=w.vertexPositionArray[K+2]}}}}w.AABB={min:U,max:A};return w};g.convertToGeometry3js=function(s,G,S,r,p){var I=r;var k=[];var E=0;var D=0;var A=s.nbPrimitives;for(var P=0;P<A;P++){var u=s.primitives[P];var O=0;var x=k.length;for(O=0;O<x;O++){var z=k[O];if((z.connectivity==u.connectivity)&&(z.geomType==u.geomType)&&g.isEqualGAS(z.gas,u.attr)&&(((z.material==null)&&(u.material==null))||((z.material.id==u.material.id)&&(z.material.file==u.material.file)))){E+=u.nbIndices;switch(z.connectivity){case g.ConnectivityTypeEnum.TRIANGLE_STRIP:case g.ConnectivityTypeEnum.TRIANGLE_FAN:D+=(u.nbIndices-3)*2;z.more_indices+=(u.nbIndices-3)*2;break;case g.ConnectivityTypeEnum.LINE_STRIP:D+=u.nbIndices-2;z.more_indices+=u.nbIndices-2;break;default:break}z.set.push(u);z.nbIndices+=u.nbIndices;break}}if(O==k.length){var w={};w.connectivity=u.connectivity;w.geomType=u.geomType;w.gas=u.attr;w.material=u.material;w.nbIndices=u.nbIndices;w.more_indices=0;w.set=[];w.set.push(u);k.push(w);E+=u.nbIndices;switch(k[O].connectivity){case g.ConnectivityTypeEnum.TRIANGLE_STRIP:case g.ConnectivityTypeEnum.TRIANGLE_FAN:D+=(u.nbIndices-3)*2;w.more_indices=(u.nbIndices-3)*2;break;case g.ConnectivityTypeEnum.LINE_STRIP:D+=u.nbIndices-2;w.more_indices=u.nbIndices-2;break;default:break}}}k.sort(function(V,j){if(V.connectivity<j.connectivity){return -1}if(V.connectivity>j.connectivity){return 1}if(V.geomType&&j.geomType){var n=b[V.geomType];var i=b[j.geomType];if(n&&i){return n-i}}return 0});var t=[];for(var O=0;O<k.length;O++){var w=k[O];for(var P=0;P<w.set.length;P++){t.push(w.set[P])}}var J=null;if((p==undefined)||(p=="multi")){J=(G!==undefined)?g.deMultiIndex(t,s.buffers,G,S):g.deMultiIndex(t,s.buffers)}else{J=(G!==undefined)?g.monoIndex(t,s.buffers,G,S):g.monoIndex(t,s.buffers)}var y=new g.Mesh();y.vertexPositionArray=J.VB[0];y.vertexNormalArray=J.VB[1];y.vertexColorArray=J.VB[2];y.vertexUvArray=J.VB[3];y.vertexUv2Array=J.VB[4];y.vertexTangentArray=J.VB[5];y.vertexBinormalArray=J.VB[6];var N=new Uint32Array(E+D);var K=0,m=0;for(var T=0;T<k.length;T++){var w=k[T];var M=(w.material==null)?s.material:w.material,l;switch(w.connectivity){case g.ConnectivityTypeEnum.TRIANGLES:l=new g.DrawingGroup(g.convertToMaterial3js(w.gas,2),M,4,m,w.nbIndices,undefined,undefined,e.GeomTypeEnum[w.geomType]);l._geomType=w.geomType?e.GeomTypeEnum[w.geomType]:0;y.drawingGroups.push(l);for(var P=0;P<w.set.length;P++){var u=w.set[P];var v=new g.MeshPrimitive(u.identifier,l,m,u.nbIndices);if(u.cgmId){v.cgmId=u.cgmId}if(u.decoration){v.decoration=u.decoration}if(u.boundingSphere){v.boundingSphere=u.boundingSphere}l.primitives.push(v);for(var O=0;O<u.nbIndices;O++){N[m++]=J.IB[K++]}}break;case g.ConnectivityTypeEnum.TRIANGLE_FAN:l=new g.DrawingGroup(g.convertToMaterial3js(w.gas,2),M,4,m,w.nbIndices+w.more_indices,undefined,undefined,e.GeomTypeEnum[w.geomType]);l._geomType=w.geomType?e.GeomTypeEnum[w.geomType]:0;y.drawingGroups.push(l);for(var P=0;P<w.set.length;P++){var u=w.set[P];var F=m;var q=K;for(var O=0;O<u.nbIndices-2;O++){N[m++]=J.IB[q];N[m++]=J.IB[K+1];N[m++]=J.IB[K+2];K++}K+=2;var v=new g.MeshPrimitive(u.identifier,l,F,m-F);if(u.cgmId){v.cgmId=u.cgmId}if(u.decoration){v.decoration=u.decoration}if(u.boundingSphere){v.boundingSphere=u.boundingSphere}l.primitives.push(v)}break;case g.ConnectivityTypeEnum.TRIANGLE_STRIP:l=new g.DrawingGroup(g.convertToMaterial3js(w.gas,2),M,4,m,w.nbIndices+w.more_indices,undefined,undefined,e.GeomTypeEnum[w.geomType]);l._geomType=w.geomType?e.GeomTypeEnum[w.geomType]:0;y.drawingGroups.push(l);for(var P=0;P<w.set.length;P++){var u=w.set[P];var F=m;var C=0;for(var O=0;O<u.nbIndices-2;O++){N[m++]=J.IB[K];N[m++]=J.IB[K+1+C];N[m++]=J.IB[K+2-C];K++;C=1-C}K+=2;var v=new g.MeshPrimitive(u.identifier,l,F,m-F);if(u.cgmId){v.cgmId=u.cgmId}if(u.decoration){v.decoration=u.decoration}if(u.boundingSphere){v.boundingSphere=u.boundingSphere}l.primitives.push(v)}break;case g.ConnectivityTypeEnum.LINES:if(M){M.shading="Basic"}l=new g.DrawingGroup(g.convertToMaterial3js(w.gas,1),M,1,m,w.nbIndices,undefined,undefined,e.GeomTypeEnum[w.geomType]);l._geomType=w.geomType?e.GeomTypeEnum[w.geomType]:0;y.drawingGroups.push(l);for(var P=0;P<w.set.length;P++){var u=w.set[P];var v=new g.MeshPrimitive(u.identifier,l,m,u.nbIndices);if(u.cgmId){v.cgmId=u.cgmId}if(u.decoration){v.decoration=u.decoration}if(u.boundingSphere){v.boundingSphere=u.boundingSphere}l.primitives.push(v);for(var O=0;O<u.nbIndices;O++){N[m++]=J.IB[K++]}}break;case g.ConnectivityTypeEnum.LINE_STRIP:if(M){M.shading="Basic"}l=new g.DrawingGroup(g.convertToMaterial3js(w.gas,1),M,1,m,w.nbIndices+w.more_indices,undefined,undefined,e.GeomTypeEnum[w.geomType]);l._geomType=w.geomType?e.GeomTypeEnum[w.geomType]:0;y.drawingGroups.push(l);for(var P=0;P<w.set.length;P++){var u=w.set[P];var F=m;for(var O=0;O<u.nbIndices-1;O++){N[m++]=J.IB[K++];N[m++]=J.IB[K]}K++;var v=new g.MeshPrimitive(u.identifier,l,F,m-F);if(u.cgmId){v.cgmId=u.cgmId}if(u.decoration){v.decoration=u.decoration}if(u.boundingSphere){v.boundingSphere=u.boundingSphere}l.primitives.push(v)}break;case g.ConnectivityTypeEnum.POINTS:l=new g.DrawingGroup(g.convertToMaterial3js(w.gas,0),M,0,m,w.nbIndices,undefined,undefined,e.GeomTypeEnum[w.geomType]);l._geomType=w.geomType?e.GeomTypeEnum[w.geomType]:0;y.drawingGroups.push(l);for(var P=0;P<w.set.length;P++){var u=w.set[P];var v=new g.MeshPrimitive(u.identifier,l,m,u.nbIndices);if(u.cgmId){v.cgmId=u.cgmId}if(u.decoration){v.decoration=u.decoration}if(u.boundingSphere){v.boundingSphere=u.boundingSphere}l.primitives.push(v);for(var O=0;O<u.nbIndices;O++){N[m++]=J.IB[K++]}}break}}y.vertexIndexArray=N;var U=new e.Color();var Q=new e.Color();var o=new e.Color();if(s.fillAttr.color){U.setRGB(s.fillAttr.color.r,s.fillAttr.color.g,s.fillAttr.color.b)}if(s.lineAttr.color){Q.setRGB(s.lineAttr.color.r,s.lineAttr.color.g,s.lineAttr.color.b)}y.gas.fill={color:U,opacity:(s.fillAttr.color.a==undefined?1:s.fillAttr.color.a),solid:s.fillAttr.solid};y.gas.line={color:Q,opacity:(s.lineAttr.color.a==undefined?1:s.lineAttr.color.a),lineWidth:s.lineAttr.thickness,pattern:(s.lineAttr.pattern||1)};if(s.pointAttr){if(s.pointAttr.color){o.setRGB(s.pointAttr.color.r,s.pointAttr.color.g,s.pointAttr.color.b)}y.gas.point={color:o,opacity:(s.pointAttr.color.a==undefined?1:s.pointAttr.color.a),pointsize:s.pointAttr.size}}if(!I){var R=[0,0,0];var B=[0,0,0];if(y.vertexPositionArray){var H=y.vertexPositionArray.length;if(H>=3){R=[y.vertexPositionArray[0],y.vertexPositionArray[1],y.vertexPositionArray[2]];B=[y.vertexPositionArray[0],y.vertexPositionArray[1],y.vertexPositionArray[2]];for(var L=0;L<H;L+=3){if(y.vertexPositionArray[L]<R[0]){R[0]=y.vertexPositionArray[L]}if(y.vertexPositionArray[L+1]<R[1]){R[1]=y.vertexPositionArray[L+1]}if(y.vertexPositionArray[L+2]<R[2]){R[2]=y.vertexPositionArray[L+2]}if(y.vertexPositionArray[L]>B[0]){B[0]=y.vertexPositionArray[L]}if(y.vertexPositionArray[L+1]>B[1]){B[1]=y.vertexPositionArray[L+1]}if(y.vertexPositionArray[L+2]>B[2]){B[2]=y.vertexPositionArray[L+2]}}}}y.AABB={min:R,max:B}}return y};g.monoIndex=function(E,t,C,m){var z=0;for(var F=0;F<E.length;F++){z+=E[F].nbIndices}var H=[];for(var F=0;F<g.NumberOfComponents;F++){H[F]=[]}var o=0;var F;for(F=0;F<t.length;F++){var B=t[F];if(B==null){continue}if(B.component>=g.NumberOfComponents){continue}if(B.indexBuffer||!B.data.length){continue}if((B._isPlanar!==undefined)&&B._isPlanar){continue}var p=0;var s=H[B.component].length;if(s){var x=H[B.component][s-1];p=x.offset+x.buffer.data.length/3}H[B.component].push({buffer:B,offset:p});B._newOffset=p;if(p+B.data.length/3>o){o=p+B.data.length/3}}for(F=0;F<t.length;F++){var B=t[F];if(B==null){continue}if(B.component>=g.NumberOfComponents){continue}if(B.indexBuffer||!B.data.length){continue}if((B._isPlanar==undefined)||!B._isPlanar){continue}var p=o;H[B.component].push({buffer:B,offset:p});B._newOffset=p}var q=new Uint32Array(z);var r=[];for(var F=0;F<g.NumberOfComponents;F++){var s=H[F].length;if(s){var J=H[F][s-1];r[F]=new Float32Array(3*J.offset+J.buffer.data.length);var p=0;for(var D=0;D<s;D++){var B=H[F][D];var n=B.buffer.data.length;var K=B.buffer.data;if(p<3*B.offset){for(var A=p;A<3*B.offset;A++){r[F][A]=0}p=3*B.offset}if(C==null){for(var A=0;A<n;A++){r[F][p+A]=K[A]}}else{for(var A=0;A<n;A+=3){var v=new e.Vector3(K[A],K[A+1],K[A+2]);if(F==1){v.applyMatrix4(m)}else{if(F==0){v.applyMatrix4(C)}}r[F][p+A]=v.x;r[F][p+A+1]=v.y;r[F][p+A+2]=v.z}}p+=n}}else{r[F]=null}}var w=0;for(var F=0;F<E.length;F++){var u=E[F];var y=u.vertexComponents[0];var I=t[y.bufferId];if(I==undefined){continue}var G=I._newOffset;if(y.indices!=null){var l=t[y.indices.bufferId];for(var A=0;A<u.nbIndices;A++){q[w+A]=l.data[y.indices.offset+A]+G}}else{for(var A=0;A<u.nbIndices;A++){q[w+A]=G+y.offset+A}}w+=u.nbIndices}return{IB:q,VB:r}};g.deMultiIndex=function(J,t,G,p){if((G==undefined)||(p==undefined)){G=null}if((p!==undefined)&&(p instanceof e.Matrix4)){p=new e.Matrix4().copy(p);p.elements[12]=0;p.elements[13]=0;p.elements[14]=0}var A=0;for(var K=0;K<J.length;K++){A+=J[K].nbIndices}var u=[];var r=[];var y=0;for(var K=0;K<g.NumberOfComponents;K++){u[K]=null}for(var K=0;K<J.length;K++){var v=J[K];for(var I=0;I<v.nbVertexComponents;I++){var B=v.vertexComponents[I];if(u[B.component]==null){u[B.component]=[];r[B.component]=B.bufferId;for(var D=0;D<A;D++){u[B.component][D]=null}}var O=t[B.bufferId];var m=null;if(B.indices!=null){m=t[B.indices.bufferId]}if(m!=null){for(var D=0;D<v.nbIndices;D++){u[B.component][y+D]={bufferId:B.bufferId,index:B.offset+m.data[B.indices.offset+D]}}}else{for(var D=0;D<v.nbIndices;D++){u[B.component][y+D]={bufferId:B.bufferId,index:B.offset+D}}}}y+=v.nbIndices}var H=[];for(var I=0;I<A;I++){var N=new g.MultiIndexMultiBuffer();N.old_index=I;for(var K=0;K<g.NumberOfComponents;K++){if(u[K]!==null){N.comp[K]=u[K][I]}}H.push(N)}H.sort(function(k,j){var R=0,Q=0;for(var P=0;P<g.NumberOfComponents;P++){if((k.comp[P]==null)||(j.comp[P]==null)){if(k.comp[P]==null){R++}if(j.comp[P]==null){Q++}continue}if(k.comp[P].index<j.comp[P].index){return -1}if(k.comp[P].index>j.comp[P].index){return 1}if(k.comp[P].bufferId<j.comp[P].bufferId){return -1}if(k.comp[P].bufferId>j.comp[P].bufferId){return 1}}if(R<Q){return -1}if(R>Q){return 1}return 0});var n=new Uint32Array(A);var o=[];for(var K=0;K<g.NumberOfComponents;K++){if(u[K]===null){o[K]=null;continue}var M=t[r[K]].dimension;o[K]=new Float32Array(M*A)}var F=-1;var L=null;for(var K=0;K<H.length;K++){var N=H[K];var q=N.old_index;if(!K||!N.componentsEqual(L)){F++;L=N;for(var I=0;I<g.NumberOfComponents;I++){if(N.comp[I]==null){continue}var z=t[N.comp[I].bufferId].data;var E=t[N.comp[I].bufferId].dimension;if(G==null){for(var D=0;D<E;D++){o[I][E*F+D]=z[E*u[I][N.old_index].index+D]}}else{var w=new e.Vector3(z[3*u[I][N.old_index].index],z[3*u[I][N.old_index].index+1],z[3*u[I][N.old_index].index+2]);if(I==1){w.applyMatrix4(p);o[I][3*F]=w.x;o[I][3*F+1]=w.y;o[I][3*F+2]=w.z}else{if(I==0){w.applyMatrix4(G);o[I][3*F]=w.x;o[I][3*F+1]=w.y;o[I][3*F+2]=w.z}else{o[I][3*F]=w.x;o[I][3*F+1]=w.y;o[I][3*F+2]=w.z}}}}}n[q]=F}var x=[];for(var K=0;K<g.NumberOfComponents;K++){var s=o[K];if(s!==null){var l=t[r[K]].dimension*(F+1);var C=new Float32Array(l);for(var I=0;I<l;I++){C[I]=s[I]}x[K]=C}else{x[K]=null}}return{IB:n,VB:x}};g.MeshContextEnum={UNKNOWN:0,DATA:1,FLOATBUFFER:2,INDEXBUFFER:3,COMPRESSEDBUFFER:4,PRIMITIVE:5,VERTEXCOMPONENT:6,GRAPHICPROPERTIES:7,APPEARANCE:8,BAG:9,MESH:10,TEXT:11};g.NumberOfComponents=7;g.MultiIndex=function(){this.old_index=0;this.comp=[];this.comp[0]=-1;this.comp[1]=-1;this.comp[2]=-1;this.comp[3]=-1;this.comp[4]=-1;this.comp[5]=-1;this.comp[6]=-1};g.MultiIndex.prototype={constructor:g.MultiIndex,componentsEqual:function(k){for(var j=0;j<g.NumberOfComponents;j++){if((this.comp[j]==-1)||(k.comp[j]==-1)){continue}if(this.comp[j]!=k.comp[j]){return false}}return true}};g.MultiIndexMultiBuffer=function(){this.old_index=0;this.comp=[];for(var j=0;j<g.NumberOfComponents;j++){this.comp[j]=null}};g.MultiIndexMultiBuffer.prototype={constructor:g.MultiIndexMultiBuffer,componentsEqual:function(k){for(var j=0;j<g.NumberOfComponents;j++){if((this.comp[j]==null)||(k.comp[j]==null)){continue}if(this.comp[j].bufferId!=k.comp[j].bufferId){return false}if(this.comp[j].index!=k.comp[j].index){return false}}return true}};g.Node=function(o,l,n,j,i,k,m){this.id=o!==undefined?o:"";this.type=l!==undefined?l:"Bag";this.childNodes=n!==undefined?n:[];this.matrix=j!==undefined?j:null;this.position=i!==undefined?i:{};this.rotation=k!==undefined?k:{};this.scale=m!==undefined?m:{}};g.Node.prototype={constructor:g.Node,add:function(i){if(i!=null){this.childNodes.push(i)}},childClone:function(){var i=new Array();for(var j in this.childNodes){i[j]=typeof(this.childNodes[j])=="object"?this.childNodes[j].clone():this.childNodes[j]}return i},matrixClone:function(){if(this.matrix){var i=new e.Matrix4();i.copy(this.matrix);return i}},clone:function(){return new g.Node(this.id,this.type,this.childClone(),this.matrixClone(),this.position,this.rotation,this.scale)}};g.Mesh=function(i,q,j,p,t,l,m,o,k,n,s,r){this.id=i!==undefined?i:"";this.type=q!==undefined?q:"Mesh";this.vertexPositionArray=j!==undefined?j:null;this.vertexNormalArray=p!==undefined?p:null;this.vertexIndexArray=t!==undefined?t:null;this.vertexUvArray=l!==undefined?l:null;this.drawingGroups=m!==undefined?m:[];this.gas=o!==undefined?o:{fill:{},line:{}};this.AABB=k!==undefined?k:{};this._radius=0;this.material=n!==undefined?n:null;this.matrix=r!==undefined?r:null;this.rep=s!==undefined?new g.SGRep({cgmId:s.cgmId}):new g.SGRep()};g.Mesh.prototype={constructor:g.Mesh,setMatrix:function(i){this.matrix=i},indexCopy:function(){if(this.vertexIndexArray instanceof Uint32Array){return new Uint32Array(this.vertexIndexArray)}},tabCopy:function(i){if(i instanceof Float32Array){return new Float32Array(i)}},gasCopy:function(){var i;if(this.gas){i={fill:this.gas.fill,line:this.gas.line}}return i},dGCopy:function(){var i=new Array();for(var j in this.drawingGroups){i[j]=typeof(this.drawingGroups[j])=="object"?this.drawingGroups[j].clone():this.drawingGroups[j]}return i},clone:function(){var i=new g.Mesh(this.id,this.type,this.tabCopy(this.vertexPositionArray),this.tabCopy(this.vertexNormalArray),this.indexCopy(),this.tabCopy(this.vertexUvArray),this.dGCopy(),this.gasCopy(),this.AABB,this.material,this.rep);if(this.vertexBinormalArray){i.vertexBinormalArray=this.tabCopy(this.vertexBinormalArray)}if(this.vertexTangentArray){i.vertexTangentArray=this.tabCopy(this.vertexTangentArray)}return i}};g.MeshPrimitive=function(m,k,l,j,i){this.cgmId=m||0;this.groupIndex=k||0;this.start=l||0;this.count=j||0;this.boundingSphere=undefined;this.rep=0;this.decoration=i||0};g.MeshPrimitive.prototype={constructor:g.MeshPrimitive,clone:function(){if(this.boundingSphere){var i=new g.MeshPrimitive(this.cgmId,this.groupIndex,this.start,this.count,this.decoration);i.boundingSphere={center:this.boundingSphere.center,radius:this.boundingSphere.radius};return i}else{return this}},};g.DrawingGroup=function(m,l,n,i,k,q,j,p,o){this.gas=m||null;this.material=l||null;this.glType=n;this._geomType=p||0;this.gasIndex=o;this.start=i||0;this.count=k||0;this.primitives=q!==undefined?q:[];this.geometry=null;this.vbStart=-1;this.ib=null;this.idWideLine=-1;this.nonIndexed=false;this.lineStructure={sides:[],primitives:[]};this.cullingData=null};g.DrawingGroup.prototype={constructor:g.DrawingGroup,clone:function(){var i=new g.DrawingGroup(this.gas,this.material,this.glType,this.start,this.count,undefined,undefined,this._geomType,this.gasIndex);i.copyPrimitives(this.primitives);i.geometry=this.geometry;i.lineStructure.sides=this.lineStructure.sides.slice(0);i.lineStructure.primitives=this.lineStructure.primitives.slice(0);i.idWideLine=this.idWideLine;return i},copyPrimitives:function(m){var k=false;var j=null;for(var l=0;l<m.length;l++){j=m[l];if(j.boundingSphere){this.primitives.push(j.clone());k=true}else{var n=new g.SGPrimitive();n.cgmId=j.cgmId;n.rep=j.rep;n.group=this;n.start=j.start;n.count=j.count;this.primitives.push(n)}}},computeOrientedBoundingBox:function(r){if(!r){return null}var j=new e.Vector3();var m=new e.Vector3();var q=new e.Vector3();var p=this.geometry.vertexPositionArray;if(p){var o=this.start+this.count;var l=this.geometry.vertexIndexArray;if(p.length>=3){var i=3*l[this.start];m.set(p[i],p[i+1],p[i+2]).applyMatrix4(r);q.set(p[i],p[i+1],p[i+2]).applyMatrix4(r);for(var k=this.start+1;k<o;k++){var i=3*l[k];j.set(p[i],p[i+1],p[i+2]).applyMatrix4(r);if(j.x<m.x){m.x=j.x}if(j.y<m.y){m.y=j.y}if(j.z<m.z){m.z=j.z}if(j.x>q.x){q.x=j.x}if(j.y>q.y){q.y=j.y}if(j.z>q.z){q.z=j.z}}}}return new e.Box3(m,q)},disabled:function(i,j){j=j||0;if(j>0&&(this._geomType&j>0)){return true}return !((this._geomType&i)>0||this._geomType===0)},clonePrimitives:function(){var l=false;var k=[];var j=null;for(var m=0;m<this.primitives.length;m++){j=this.primitives[m];if(j.boundingSphere){k.push(j.clone());l=true}else{var n=new g.SGPrimitive();n.cgmId=j.cgmId;n.rep=j.rep;n.group=this;n.start=j.start;n.count=j.count;k.push(n)}}return k}};Object.defineProperty(g.DrawingGroup.prototype,"geomType",{get:function(){console.warn("[Mesh.DrawingGroup] DOT NOT ACCESS geomType directly !\n");return g.GeomTypeString[this._geomType]},set:function(i){console.warn("[Mesh.DrawingGroup] DOT NOT ACCESS geomType directly !\n");this._geomType=e.GeomTypeEnum[i]},});g.SelectionGroup=function(){this.geometries={}};g.SelectionGroup.prototype={constructor:g.SelectionGroup,contains:function(p){for(var o in this.geometries){var n=this.geometries[o];for(var m=0;m<n.length;m++){var q=n[m].primitives;for(var l=0;l<q.length;l++){if(q[l]===p){return true}}}}return false},getFirstPrimitive:function(){for(var k in this.geometries){var j=this.geometries[k];if(j.length&&j[0].primitives.length){return j[0].primitives[0]}}return null},getPrimitives:function(){var p=[];for(var o in this.geometries){var n=this.geometries[o];for(var m=0;m<n.length;m++){var q=n[m].primitives;for(var l=0;l<q.length;l++){p.push(q[l])}}}return p},addPrimitive:function(m){var k=0;var j=m.group.geometry.id;var l=this.geometries[j];if(!l){l=[];this.geometries[j]=l}for(k=0;k<l.length;k++){if(l[k].drawingGroup===m.group){l[k].primitives.push(m);break}}if(k===l.length){l.push({drawingGroup:m.group,primitives:[m]})}},clone:function(){var m=new g.SelectionGroup();for(var l in this.geometries){var n=this.geometries[l];m.geometries[l]=[];for(var k=0;k<n.length;k++){m.geometries[l][k]={drawingGroup:n[k].drawingGroup,primitives:n[k].primitives.slice()}}}return m},getIdentificationObject:function(){var j;var i=this.getFirstPrimitive();if(i&&i.getIdentificationObject){j=i.getIdentificationObject()}return j}};g.processRepsCGR=function(C,q,an,Y,ad){var V=0;var ai=0;var Z=!q;var ar=[];var N=5;var O=Y?Y:{};var s=0;var J=false;var F=false;var aw=false;var T=false;var aj=false;for(var am=0;am<C.length;am++){V+=C[am].vertexPositionArray?C[am].vertexPositionArray.length:0;ai+=C[am].vertexIndexArray.length;if(!J&&(C[am].vertexNormalArray!==null)){J=true}if(!F&&(C[am].vertexUvArray!==null)){F=true}if(!aw&&C[am].vertexUv2Array){aw=true}if(!T&&C[am].vertexTangentArray){T=true}if(!aj&&C[am].vertexBinormalArray){aj=true}}var u=new Float32Array(V);var U;if(V/3<65535){U=new Uint16Array(ai)}else{U=new Uint32Array(ai)}var o=J?new Float32Array(V):null;var p=F?new Float32Array(V):null;var r=aw?new Float32Array(V):null;var R=T?new Float32Array(V):null;var z=aj?new Float32Array(V):null;var av=0;for(var am=0;am<C.length;am++){var ac=C[am];var I=ac.vertexPositionArray;if(I){u.set(I,av);if(o!==null&&ac.vertexNormalArray){o.set(ac.vertexNormalArray,av)}if(p!==null&&ac.vertexUvArray){p.set(ac.vertexUvArray,av)}if(r!==null&&ac.vertexUv2Array){r.set(ac.vertexUv2Array,av)}if(R!==null&&ac.vertexTangentArray){R.set(ac.vertexTangentArray,av)}if(z!==null&&ac.vertexBinormalArray){z.set(ac.vertexBinormalArray,av)}}for(var ao=0;ao<ac.drawingGroups.length;ao++){var E=ac.drawingGroups[ao];E.vbStart=av/3;E.ib=ac.vertexIndexArray;E.geometry=C[am];if(E.gas==null){if((E.glType==4)||(E.glType==5)){E.gas=C[am].gas.fill}else{if(E.glType==1){E.gas=C[am].gas.line}else{if(E.glType==0){E.gas=C[am].gas.point}}}}for(var aq=0;aq<E.primitives.length;aq++){var D=E.primitives[aq];D.rep=ac.rep;if(D.boundingSphere){var A=new e.Vector3(D.boundingSphere.center[0],D.boundingSphere.center[1],D.boundingSphere.center[2]);var w=ac.globalMatrix?!ac.globalMatrix.isIdentity():false;if(w){A.applyMatrix4(C[am].globalMatrix);D.boundingSphere.center=[A.x,A.y,A.z]}}}ar.push(E)}av+=I?I.length:0}ar.sort(function(k,i){if(k.glType<i.glType){return -1}if(k.glType>i.glType){return 1}if((k.material==null)&&(i.material!=null)){return -1}if((k.material!=null)&&(i.material==null)){return 1}if((k.material!=null)&&(i.material!=null)){if(k.material.id<i.material.id){return -1}if(k.material.id>i.material.id){return 1}if(k.material.file<i.material.file){return -1}if(k.material.file>i.material.file){return 1}}if((k.gas==null)&&(i.gas!=null)){return -1}if((k.gas!=null)&&(i.gas==null)){return -1}if((k.gas!=null)&&(i.gas!=null)){var m=g.compareGASMaterial(k.gas,i.gas);if(m){return m}}if(k._geomType&&i._geomType){if(k._geomType<i._geomType){return -1}if(k._geomType>i._geomType){return 1}if(an){if(k.geometry._radius<i.geometry._radius){return 1}if(k.geometry._radius>i.geometry._radius){return -1}}}if(an){if(k.geometry._radius<i.geometry._radius){return 1}if(k.geometry._radius>i.geometry._radius){return -1}}return 0});var af=[];var H=[];var t=(ar.length>0)?ar[0].gas:null;var ap=(ar.length>0)?ar[0].material:null;var M=(ar.length>0)?ar[0].glType:0;var X=(ar.length>0)?ar[0]._geomType:0;var j=0;var P=0;var ak=0;var l=0;var ah=t;var ab=[];var v=[];for(var am=0;am<ar.length;am++){var E=ar[am];if((E.glType==M)&&(E._geomType===X)&&!g.compareGASMaterial(t,E.gas)&&(((ap==null)&&(E.material==null))||(((ap!=null)&&(E.material!=null))&&(ap.id==E.material.id)&&(ap.file==E.material.file)))){if(an){ab.push({start:j,count:E.count,radius:E.geometry._radius,rep:E.geometry.rep})}ak+=E.count;v.push(E);for(var ao=0;ao<E.count;ao++){U[j++]=E.vbStart+E.ib[E.start+ao]}}else{var aa=false;var y=null;if(ak>0){y=new g.DrawingGroup(t,ar[am-1].material,M,P,ak,undefined,undefined,X,l);if(an){y.cullingData=ab}var L=0;for(var au=0;au<v.length;++au){L+=v[au].primitives.length}var ae=new Uint32Array(N*L);var ag=0;var Q=P;var al=[];for(var B=0;B<v.length;++B){var x=v[B];var W=N*ag;if(x.geometry.noShow&&O.containNoShow){for(var au=0;au<x.primitives.length;au++){var D=x.primitives[au];al.push(ag);ae[W++]=D.cgmId+1;ae[W++]=D.rep;ae[W++]=Q;ae[W++]=D.count;ae[W++]=D.decoration;ag++;Q+=D.count}}else{for(var au=0;au<x.primitives.length;au++){var D=x.primitives[au];ae[W++]=D.cgmId+1;ae[W++]=D.rep;ae[W++]=Q;ae[W++]=D.count;ae[W++]=D.decoration;ag++;Q+=D.count}}}y.primitives=ae;if(al.length){y.noShowPrim=al}v=[];ab=[];af.push(y)}if(g.compareGASMaterial(ah,E.gas)!==0){ah=E.gas;l++}M=E.glType;X=E._geomType;t=E.gas;if(!aa){ap=E.material}P=j;ak=E.count;v.push(E);if(an){ab.push({start:j,count:E.count,radius:E.geometry._radius,rep:E.geometry.rep})}for(var ao=0;ao<E.count;ao++){U[j++]=E.vbStart+E.ib[E.start+ao]}}}if(ak>0){var y=new g.DrawingGroup(t,ar[ar.length-1].material,M,P,ak,undefined,undefined,X,l);if(an){y.cullingData=ab}var L=0;for(var au=0;au<v.length;++au){L+=v[au].primitives.length}var ae=new Uint32Array(N*L);var Q=P;var ag=0;var al=[];for(var B=0;B<v.length;++B){var E=v[B];var W=N*ag;if(E.geometry.noShow&&O.containNoShow){for(var au=0;au<E.primitives.length;au++){var D=E.primitives[au];al.push(ag);ae[W++]=D.cgmId+1;ae[W++]=D.rep;ae[W++]=Q;ae[W++]=D.count;ae[W++]=D.decoration;ag++;Q+=D.count}}else{for(var au=0;au<E.primitives.length;au++){var D=E.primitives[au];ae[W++]=D.cgmId+1;ae[W++]=D.rep;ae[W++]=Q;ae[W++]=D.count;ae[W++]=D.decoration;ag++;Q+=D.count}}}y.primitives=ae;if(al.length){y.noShowPrim=al}af.push(y)}var G=new g.Mesh();G.vertexPositionArray=u;G.vertexNormalArray=o;G.vertexUvArray=p;G.vertexUv2Array=r;G.vertexTangentArray=R;G.vertexBinormalArray=z;G.vertexIndexArray=U;G.drawingGroups=af;if(C[0]===undefined){var at=1;var S=new e.Color();S.setRGB(0.5,0.5,0.5);G.gas.fill={color:S,opacity:at,solid:0};G.gas.line={color:S,opacity:at,lineWidth:1};G.gas.point={color:S,opacity:at,pointsize:1}}else{G.gas=C[0].gas}if(Z){var ax=[0,0,0];var K=[0,0,0];if(V>=3){ax=[u[0],u[1],u[2]];K=[u[0],u[1],u[2]];for(var am=0;am<V;am+=3){if(u[am]<ax[0]){ax[0]=u[am]}if(u[am+1]<ax[1]){ax[1]=u[am+1]}if(u[am+2]<ax[2]){ax[2]=u[am+2]}if(u[am]>K[0]){K[0]=u[am]}if(u[am+1]>K[1]){K[1]=u[am+1]}if(u[am+2]>K[2]){K[2]=u[am+2]}}}G.AABB={min:ax,max:K}}return G};g.processReps=function(A,r,aa){var P=0;var V=0;var R=!r;var ae=[];var F=false;var D=false;var ai=false;var N=false;var W=false;for(var Z=0;Z<A.length;Z++){P+=A[Z].vertexPositionArray?A[Z].vertexPositionArray.length:0;V+=A[Z].vertexIndexArray.length;if(!F&&(A[Z].vertexNormalArray!==null)){F=true}if(!D&&(A[Z].vertexUvArray!==null)){D=true}if(!ai&&A[Z].vertexUv2Array){ai=true}if(!N&&A[Z].vertexTangentArray){N=true}if(!W&&A[Z].vertexBinormalArray){W=true}}var u=new Float32Array(P);var O;if(P/3<65535){O=new Uint16Array(V)}else{O=new Uint32Array(V)}var o=F?new Float32Array(P):null;var q=D?new Float32Array(P):null;var s=ai?new Float32Array(P):null;var L=N?new Float32Array(P):null;var y=W?new Float32Array(P):null;var ah=0;for(var Z=0;Z<A.length;Z++){if(A[Z].vertexPositionArray){for(var ab=0;ab<A[Z].vertexPositionArray.length;ab++){u[ah+ab]=A[Z].vertexPositionArray[ab];if(o!==null){o[ah+ab]=(A[Z].vertexNormalArray!==null)?A[Z].vertexNormalArray[ab]:0}if(q!==null){q[ah+ab]=(A[Z].vertexUvArray!==null)?A[Z].vertexUvArray[ab]:0}if(s!==null){s[ah+ab]=A[Z].vertexUv2Array?A[Z].vertexUv2Array[ab]:0}if(L!==null){L[ah+ab]=A[Z].vertexTangentArray?A[Z].vertexTangentArray[ab]:0}if(y!==null){y[ah+ab]=A[Z].vertexBinormalArray?A[Z].vertexBinormalArray[ab]:0}}}for(var ab=0;ab<A[Z].drawingGroups.length;ab++){var C=A[Z].drawingGroups[ab];C.vbStart=ah/3;C.ib=A[Z].vertexIndexArray;C.geometry=A[Z];if(C.gas==null){if((C.glType==4)||(C.glType==5)){C.gas=A[Z].gas.fill}else{if(C.glType==1){C.gas=A[Z].gas.line}else{if(C.glType==0){C.gas=A[Z].gas.point}}}}for(var ad=0;ad<C.primitives.length;ad++){var B=C.primitives[ad];B.rep=A[Z].rep;if(B.boundingSphere){var z=new e.Vector3(B.boundingSphere.center[0],B.boundingSphere.center[1],B.boundingSphere.center[2]);var v=A[Z].globalMatrix?!A[Z].globalMatrix.isIdentity():false;if(v){z.applyMatrix4(A[Z].globalMatrix);B.boundingSphere.center=[z.x,z.y,z.z]}}}ae.push(C)}ah+=A[Z].vertexPositionArray?A[Z].vertexPositionArray.length:0}ae.sort(function(k,i){if(k.glType<i.glType){return -1}if(k.glType>i.glType){return 1}if((k.material==null)&&(i.material!=null)){return -1}if((k.material!=null)&&(i.material==null)){return 1}if((k.material!=null)&&(i.material!=null)){if(k.material.id<i.material.id){return -1}if(k.material.id>i.material.id){return 1}if(k.material.file<i.material.file){return -1}if(k.material.file>i.material.file){return 1}}if((k.gas==null)&&(i.gas!=null)){return -1}if((k.gas!=null)&&(i.gas==null)){return -1}if((k.gas!=null)&&(i.gas!=null)){var m=g.compareGASMaterial(k.gas,i.gas);if(m){return m}}if(k._geomType&&i._geomType){if(k._geomType<i._geomType){return -1}if(k._geomType>i._geomType){return 1}if(k.geometry._radius<i.geometry._radius){return 1}if(k.geometry._radius>i.geometry._radius){return -1}}if(k.geometry._radius<i.geometry._radius){return 1}if(k.geometry._radius>i.geometry._radius){return -1}return 0});var T=[];var G=[];var t=(ae.length>0)?ae[0].gas:null;var ac=(ae.length>0)?ae[0].material:null;var I=(ae.length>0)?ae[0].glType:0;var Q=(ae.length>0)?ae[0]._geomType:0;var j=0;var J=0;var X=0;var l=0;var U=t;var S=[];for(var Z=0;Z<ae.length;Z++){var C=ae[Z];if((C.glType==I)&&(C._geomType===Q)&&!g.compareGASMaterial(t,C.gas)&&(((ac==null)&&(C.material==null))||(((ac!=null)&&(C.material!=null))&&(ac.id==C.material.id)&&(ac.file==C.material.file)))){if(aa){S.push({start:j,count:C.count,radius:C.geometry._radius,rep:C.geometry.rep})}X+=C.count;var K=j;for(var ag=0;ag<C.primitives.length;ag++){var B=C.primitives[ag];var w=new g.SGPrimitive({cgmId:B.cgmId,rep:B.rep,start:K,count:B.count});if(B.decoration){w.decoration=B.decoration}if(B.boundingSphere){w.boundingSphere=B.boundingSphere}G.push(w);B.rep.primitives.push(w);K+=B.count}for(var ab=0;ab<C.count;ab++){O[j++]=C.vbStart+C.ib[C.start+ab]}}else{var x=null;if(X>0){x=new g.DrawingGroup(t,ac,I,J,X,undefined,undefined,Q,l);x.primitives=G;if(aa){x.cullingData=S}for(var Y=0;Y<G.length;Y++){G[Y].group=x}G=[];S=[];T.push(x)}if(g.compareGASMaterial(U,C.gas)!==0){U=C.gas;l++}I=C.glType;Q=C._geomType;t=C.gas;ac=C.material;J=j;X=C.count;if(aa){S.push({start:j,count:C.count,radius:C.geometry._radius,rep:C.geometry.rep})}var K=j;for(var ag=0;ag<C.primitives.length;ag++){var B=C.primitives[ag];var w=new g.SGPrimitive({cgmId:B.cgmId,rep:B.rep,start:K,count:B.count});if(B.decoration){w.decoration=B.decoration}if(B.boundingSphere){w.boundingSphere=B.boundingSphere}G.push(w);B.rep.primitives.push(w);K+=B.count}for(var ab=0;ab<C.count;ab++){O[j++]=C.vbStart+C.ib[C.start+ab]}}}if(X>0){var x=new g.DrawingGroup(t,ac,I,J,X,undefined,undefined,Q,l);x.primitives=G;if(aa){x.cullingData=S}for(var Y=0;Y<G.length;Y++){G[Y].group=x}T.push(x)}var E=new g.Mesh();E.vertexPositionArray=u;E.vertexNormalArray=o;E.vertexUvArray=q;E.vertexUv2Array=s;E.vertexTangentArray=L;E.vertexBinormalArray=y;E.vertexIndexArray=O;E.drawingGroups=T;if(A[0]===undefined){var af=1;var M=new e.Color();M.setRGB(0.5,0.5,0.5);E.gas.fill={color:M,opacity:af,solid:0};E.gas.line={color:M,opacity:af,lineWidth:1};E.gas.point={color:M,opacity:af,pointsize:1}}else{E.gas=A[0].gas}if(R){var aj=[0,0,0];var H=[0,0,0];if(P>=3){aj=[u[0],u[1],u[2]];H=[u[0],u[1],u[2]];for(var Z=0;Z<P;Z+=3){if(u[Z]<aj[0]){aj[0]=u[Z]}if(u[Z+1]<aj[1]){aj[1]=u[Z+1]}if(u[Z+2]<aj[2]){aj[2]=u[Z+2]}if(u[Z]>H[0]){H[0]=u[Z]}if(u[Z+1]>H[1]){H[1]=u[Z+1]}if(u[Z+2]>H[2]){H[2]=u[Z+2]}}}E.AABB={min:aj,max:H}}return E};g.divideRep=function(ag,ae,ad){var z=ag.vertexPositionArray?ag.vertexPositionArray.length:0;var y=ag.vertexIndexArray.length;var ab=[];var P=ad?ad:{};if(ae){var M=5;var P=ad?ad:{};var s=0;var ah=null;for(var aq=0;aq<ag.drawingGroups.length;aq++){var w=ag.drawingGroups[aq];if(w.gas==null){if((w.glType==4)||(w.glType==5)){w.gas=ag.gas.fill}else{if(w.glType==1){w.gas=ag.gas.line}else{if(w.glType==0){w.gas=ag.gas.point}}}}s=w.primitives.length;ah=new Uint32Array(M*s);var ac=0;if(ag.noShow&&P.containNoShow){for(var ar=0;ar<w.primitives.length;ar++){var B=w.primitives[ar];noShowPrim.push(ar);ah[ac++]=B.cgmId+1;ah[ac++]=ag.rep;ah[ac++]=B.start;ah[ac++]=B.count;ah[ac++]=B.decoration}}else{for(var ar=0;ar<w.primitives.length;ar++){var B=w.primitives[ar];ah[ac++]=B.cgmId+1;ah[ac++]=ag.rep;ah[ac++]=B.start;ah[ac++]=B.count;ah[ac++]=B.decoration}}w.primitives=ah}}else{for(var ar=0;ar<ag.drawingGroups.length;ar++){var w=ag.drawingGroups[ar];if(w.gas==null){if((w.glType==4)||(w.glType==5)){w.gas=ag.gas.fill}else{if(w.glType==1){w.gas=ag.gas.line}else{if(w.glType==0){w.gas=ag.gas.point}}}}for(var aq=0;aq<w.primitives.length;aq++){var B=w.primitives[aq];var x=new g.SGPrimitive({cgmId:B.cgmId,rep:ag.rep,group:w,start:B.start,count:B.count});if(B.decoration){x.decoration=B.decoration}if(B.boundingSphere){x.boundingSphere=B.boundingSphere}w.primitives[aq]=x;ag.rep.primitives.push(x)}}}var V=ag.vertexIndexArray;var U;if(z/3<65535){U=new Uint16Array(V.length)}else{U=new Uint32Array(V.length)}for(var ar=0;ar<V.length;ar++){U[ar]=V[ar]}ag.vertexIndexArray=U;g.unindexPoints(ag);ab.push(ag);return ab;var K=(ag.vertexNormalArray!==null);var F=(ag.vertexUvArray!==null);var at=!!ag.vertexUv2Array;var T=!!ag.vertexTangentArray;var al=!!ag.vertexBinormalArray;var o=!!ag.vertexColorArray;var A=z/3;var W=new Int32Array(A);var r=0;var N=[];var t=[];var au=[];var af=[];var G=[];var q=[];var m=[];var R=[];var aj=[];var aa=[];var D=196605;var u=0;var C=0;var O=0;var Y=new Float32Array(D);var J=K?new Float32Array(D):null;var ak=F?new Float32Array(D):null;var S=at?new Float32Array(D):null;var v=T?new Float32Array(D):null;var ai=al?new Float32Array(D):null;var Z=o?new Float32Array(4*D/3):null;var ao=new Uint16Array(y);while((u<ag.drawingGroups.length-1)||(C<ag.drawingGroups[u].primitives.length)){var I=false;var X=0;var p=0;var ap=[];for(var am=0;am<A;am++){W[am]=-1}for(var aq=u;aq<ag.drawingGroups.length;aq++){var E=ag.drawingGroups[aq];if(E.gas==null){if((E.glType==4)||(E.glType==5)){E.gas=ag.gas.fill}else{if(E.glType==1){E.gas=ag.gas.line}else{if(E.glType==0){E.gas=ag.gas.point}}}}var w=new g.DrawingGroup(E.gas,E.material,E.glType,X,0);w.geomType=E._geomType;for(var an=C;an<E.primitives.length;an++){var B=E.primitives[an];var Q=X;for(var am=B.start+O;am<B.start+B.count;am++){var ac=ag.vertexIndexArray[am];if(W[ac]==-1){ao[X]=p;for(var l=0;l<3;l++){Y[3*p+l]=ag.vertexPositionArray[3*ac+l];if(K){J[3*p+l]=ag.vertexNormalArray[3*ac+l]}if(F){ak[3*p+l]=ag.vertexUvArray[3*ac+l]}if(at){S[3*p+l]=ag.vertexUv2Array[3*ac+l]}if(T){v[3*p+l]=ag.vertexTangentArray[3*ac+l]}if(al){ai[3*p+l]=ag.vertexBinormalArray[3*ac+l]}if(o){Z[4*p+l]=ag.vertexColorArray[4*ac+l]}}if(o){Z[4*p+3]=ag.vertexColorArray[4*ac+3]}if(p>=65535){I=true;break}W[ac]=p;p++}else{ao[X]=W[ac]}X++}if(I){if(Q==0){if(E.glType==4){X=3*Math.floor(X/3)}else{if(E.glType==1){X=2*Math.floor(X/2)}}O+=X;var x=new g.SGPrimitive({cgmId:B.cgmId,rep:ag.rep,group:w,start:0,count:X});if(B.decoration){x.decoration=B.decoration}if(B.boundingSphere){x.boundingSphere=B.boundingSphere}w.count+=X;w.primitives.push(x);ag.rep.primitives.push(x)}C=an;break}var x=new g.SGPrimitive({cgmId:B.cgmId,rep:ag.rep,group:w,start:Q,count:B.count-O});if(B.decoration){x.decoration=B.decoration}if(B.boundingSphere){x.boundingSphere=B.boundingSphere}w.count+=B.count-O;O=0;w.primitives.push(x);ag.rep.primitives.push(x)}ap.push(w);if(I){u=aq;break}C=0}aj[r]=new Uint16Array(X);t[r]=new Float32Array(3*p);for(var ar=0;ar<X;++ar){aj[r][ar]=ao[ar]}for(var ar=0;ar<3*p;++ar){t[r][ar]=Y[ar]}if(K){au[r]=new Float32Array(3*p);for(var ar=0;ar<3*p;++ar){au[r][ar]=J[ar]}}else{au[r]=null}if(F){af[r]=new Float32Array(3*p);for(var ar=0;ar<3*p;++ar){af[r][ar]=ak[ar]}}else{af[r]=null}if(at){G[r]=new Float32Array(3*p);for(var ar=0;ar<3*p;++ar){G[r][ar]=S[ar]}}else{G[r]=null}if(T){q[r]=new Float32Array(3*p);for(var ar=0;ar<3*p;++ar){q[r][ar]=v[ar]}}else{q[r]=null}if(al){m[r]=new Float32Array(3*p);for(var ar=0;ar<3*p;++ar){m[r][ar]=ai[ar]}}else{m[r]=null}if(o){R[r]=new Float32Array(4*p);for(var ar=0;ar<4*p;++ar){R[r][ar]=Z[ar]}}else{R[r]=null}aa.push(ap);r++;if(!I){break}}ab=[];for(var ar=0;ar<r;ar++){var H=new g.Mesh();H.vertexPositionArray=t[ar];H.vertexNormalArray=au[ar];H.vertexUvArray=af[ar];H.vertexUv2Array=G[ar];H.vertexTangentArray=q[ar];H.vertexBinormalArray=m[ar];H.vertexColorArray=R[ar];H.vertexIndexArray=aj[ar];H.drawingGroups=aa[ar];H.gas=ag.gas;H.rep=ag.rep;var av=[0,0,0];var L=[0,0,0];if(t[ar].length>=3){av=[t[ar][0],t[ar][1],t[ar][2]];L=[t[ar][0],t[ar][1],t[ar][2]];for(var am=0;am<t[ar].length;am+=3){if(t[ar][am]<av[0]){av[0]=t[ar][am]}if(t[ar][am+1]<av[1]){av[1]=t[ar][am+1]}if(t[ar][am+2]<av[2]){av[2]=t[ar][am+2]}if(t[ar][am]>L[0]){L[0]=t[ar][am]}if(t[ar][am+1]>L[1]){L[1]=t[ar][am+1]}if(t[ar][am+2]>L[2]){L[2]=t[ar][am+2]}}}H.AABB={min:av,max:L};g.unindexPoints(H);ab.push(H)}return ab};g.unindexPoints=function(l){if(!(h||f)){return false}if(!l.vertexPositionArray){return false}var q,p;var y=false;var w=l.vertexPositionArray.length/3;var s=new Int32Array(w);for(q=0;q<w;q++){s[q]=-1}var x=0;for(q=0;q<l.drawingGroups.length;q++){var u=l.drawingGroups[q];if(u.glType>0){continue}y=true;for(p=u.start;p<u.start+u.count;p++){var v=l.vertexIndexArray[p];if(s[v]===-1){l.vertexIndexArray[p]=x;s[v]=x;x++}else{l.vertexIndexArray[p]=s[v]}}}if(!y){return false}var t=x;for(q=0;q<x;q++){if(s[q]===-1){while(t<w){if(s[t]!==-1){s[q]=t;t++;break}s[t]=t;t++}}}while(t<w){if(s[t]===-1){s[t]=t}t++}for(q=0;q<l.drawingGroups.length;q++){var u=l.drawingGroups[q];if(u.glType===0){continue}for(p=u.start;p<u.start+u.count;p++){var v=l.vertexIndexArray[p];l.vertexIndexArray[p]=s[v]}}var z=[];l.vertexPositionArray&&z.push(l.vertexPositionArray);l.vertexNormalArray&&z.push(l.vertexNormalArray);l.vertexUvArray&&z.push(l.vertexUvArray);l.vertexUv2Array&&z.push(l.vertexUv2Array);l.vertexTangentArray&&z.push(l.vertexTangentArray);l.vertexBinormalArray&&z.push(l.vertexBinormalArray);var n=new Float32Array(3*z.length);var m=new Float32Array(3*z.length);for(q=0;q<w;q++){var k=q;var r=s[k];if((r===k)||(r===-1)){continue}for(p=0;p<z.length;p++){var o=z[p];n[3*p]=o[3*k];n[3*p+1]=o[3*k+1];n[3*p+2]=o[3*k+2]}while(r!==-1){for(p=0;p<z.length;p++){var o=z[p];m[3*p]=o[3*r];m[3*p+1]=o[3*r+1];m[3*p+2]=o[3*r+2];o[3*r]=n[3*p];o[3*r+1]=n[3*p+1];o[3*r+2]=n[3*p+2];n[3*p]=m[3*p];n[3*p+1]=m[3*p+1];n[3*p+2]=m[3*p+2]}s[k]=-1;k=r;r=s[k]}}l.vertexPositionArray.nonindexedPoints=true;return true};g.compareGASMaterial=function(i,j){if(i.opacity<j.opacity){return -1}if(i.opacity>j.opacity){return 1}if(i.color.r<j.color.r){return -1}if(i.color.r>j.color.r){return 1}if(i.color.g<j.color.g){return -1}if(i.color.g>j.color.g){return 1}if(i.color.b<j.color.b){return -1}if(i.color.b>j.color.b){return 1}if(i.thickness&&j.thickness){if(i.thickness<j.thickness){return -1}if(i.thickness>j.thickness){return 1}}if(i.lineWidth&&j.lineWidth){if(i.pattern<j.pattern){return -1}if(i.pattern>j.pattern){return 1}if(i.lineWidth<j.lineWidth){return -1}if(i.lineWidth>j.lineWidth){return 1}if(i.forceMaterial||j.forceMaterial){if(!(i.forceMaterial&&j.forceMaterial)){if(i.forceMaterial){return -1}else{return 1}}}}if(i.pointsize&&j.pointsize){if(i.pointsize<j.pointsize){return -1}if(i.pointsize>j.pointsize){return 1}if(i.forceMaterial||j.forceMaterial){if(!(i.forceMaterial&&j.forceMaterial)){if(i.forceMaterial){return -1}else{return 1}}}}if(i.symbol&&j.symbol){if(i.symbol<j.symbol){return -1}if(i.symbol>j.symbol){return 1}if(i.symbol.id<j.symbol.id){return -1}if(i.symbol.id>j.symbol.id){return 1}}if(i.solid!=undefined&&j.solid!=undefined){if(i.solid<j.solid){return -1}if(i.solid>j.solid){return 1}}return 0};g.applyMat=function(q,o,k){if(o!=null){if(q.vertexNormalArray){var l=new e.Matrix4();l.copy(o);l.elements[12]=0;l.elements[13]=0;l.elements[14]=0;for(var x=0;x<q.vertexNormalArray.length;x+=3){var t=new e.Vector3(q.vertexNormalArray[x],q.vertexNormalArray[x+1],q.vertexNormalArray[x+2]);t.applyMatrix4(l);q.vertexNormalArray[x]=t.x;q.vertexNormalArray[x+1]=t.y;q.vertexNormalArray[x+2]=t.z}}if(q.vertexPositionArray){for(var x=0;x<q.vertexPositionArray.length;x+=3){var t=new e.Vector3(q.vertexPositionArray[x],q.vertexPositionArray[x+1],q.vertexPositionArray[x+2]);t.applyMatrix4(o);q.vertexPositionArray[x]=t.x;q.vertexPositionArray[x+1]=t.y;q.vertexPositionArray[x+2]=t.z}var z=q.drawingGroups;for(var x=0;x<z.length;++x){var y=z[x];var s=y.material;var B=!s||s.id<0||!k[s.id].physicalMaterial||(!k[s.id].physicalMaterial.PhysicalMaterial.MappingOperator&&!k[s.id].mapping)||(k[s.id].physicalMaterial.PhysicalMaterial.MappingOperator&&k[s.id].physicalMaterial.PhysicalMaterial.MappingOperator.Type=="None")||(k[s.id].mapping&&k[s.id].mapping.type<0);if(!B){var A=new e.Matrix4().getInverse(o);var r=JSON.parse(JSON.stringify(k[s.id]));var u=r.physicalMaterial.PhysicalMaterial.MappingOperator;if(!u){u=r.mapping}if(u){if(u.UvTransformation){u.UvTransformation=u.UvTransformation.slice(0)}}var v=new e.Matrix4();if(u&&u.ObjectTransformation){v.elements=u.ObjectTransformation.slice(0)}v.multiply(A);u.ObjectTransformation=v.elements;y.material.id=k.length;k.push(r)}}if(o.determinant()<0){for(var x=0;x<z.length;++x){var y=z[x];if(y.glType==4){var p=y.count/3;for(var w=0;w<p;w++){var n=q.vertexIndexArray[y.start+3*w];var m=q.vertexIndexArray[y.start+3*w+1];q.vertexIndexArray[y.start+3*w]=m;q.vertexIndexArray[y.start+3*w+1]=n}}}}}}};g.computeBB=function(m){var j=[0,0,0];var i=[0,0,0];if(m.vertexPositionArray){var k=m.vertexPositionArray.length;if(k>=3){j=[m.vertexPositionArray[0],m.vertexPositionArray[1],m.vertexPositionArray[2]];i=[m.vertexPositionArray[0],m.vertexPositionArray[1],m.vertexPositionArray[2]];for(var l=0;l<k;l+=3){if(m.vertexPositionArray[l]<j[0]){j[0]=m.vertexPositionArray[l]}if(m.vertexPositionArray[l+1]<j[1]){j[1]=m.vertexPositionArray[l+1]}if(m.vertexPositionArray[l+2]<j[2]){j[2]=m.vertexPositionArray[l+2]}if(m.vertexPositionArray[l]>i[0]){i[0]=m.vertexPositionArray[l]}if(m.vertexPositionArray[l+1]>i[1]){i[1]=m.vertexPositionArray[l+1]}if(m.vertexPositionArray[l+2]>i[2]){i[2]=m.vertexPositionArray[l+2]}}}}m.AABB={min:j,max:i}};return g});define("Mesh/Mesh",["DS/Mesh/Mesh","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Mesh/Mesh");return b});