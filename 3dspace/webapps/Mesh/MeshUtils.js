define("DS/Mesh/MeshUtils",["DS/Mesh/Mesh","DS/Visualization/ThreeJS_DS","DS/Visualization/MaterialManager","DS/Visualization/GraphicAttributeSet"],function(d,b,a,c){d.convertTo3jsGeometry=function(e,r){if(!e.length){return}var n=[];var s=null;var h=null;var q=new b.Sphere();var p=new b.Box3();for(var k=0;k<e.length;k++){var o=e[k];var m=new b.BufferGeometryDS();var g=new b.Vector3(o.AABB.min[0],o.AABB.min[1],o.AABB.min[2]);var l=new b.Vector3(o.AABB.max[0],o.AABB.max[1],o.AABB.max[2]);if(s==null){s=g}if(h==null){h=l}if(g.x<s.x){s.x=g.x}if(g.y<s.y){s.y=g.y}if(g.z<s.z){s.z=g.z}if(l.x>h.x){h.x=l.x}if(l.y>h.y){h.y=l.y}if(l.z>h.z){h.z=l.z}p.set(s,h);q.radius=h.clone().sub(s).multiplyScalar(0.5).length();q.center=h.clone().add(s).multiplyScalar(0.5);for(var f=0;f<o.drawingGroups.length;f++){o.drawingGroups[f].geometry=m}m.drawingGroups=o.drawingGroups;m.vertexPositionArray=o.vertexPositionArray;if(o.vertexNormalArray!==null){m.vertexNormalArray=o.vertexNormalArray}if(o.vertexUvArray!==null){m.vertexUvArray=o.vertexUvArray}if(o.vertexUv2Array){m.vertexUv2Array=o.vertexUv2Array}if(o.vertexTangentArray){m.vertexTangentArray=o.vertexTangentArray}if(o.vertexBinormalArray){m.vertexBinormalArray=o.vertexBinormalArray}m.vertexIndexArray=o.vertexIndexArray;n.push(m)}n.boundingSphere=q;n.boundingBox=p;return n};d.convertTo3jsMesh=function(s,r,B,J,I){if(!s.length){return}var g=window.newMaterialInheritance;var e=null;var l=[];var k=null;var E=null;var H=new b.Sphere();var f=new b.Box3();var q=new a();var u=false;for(var A=0;A<s.length;A++){var h=s[A];var n=new b.BufferGeometryDS();n.editable=h.editable;if(J!==undefined){n.sharedBuffers=J}if(I!==undefined){n.noMeshInRAM=I}var w=new b.Vector3(h.AABB.min[0],h.AABB.min[1],h.AABB.min[2]);var z=new b.Vector3(h.AABB.max[0],h.AABB.max[1],h.AABB.max[2]);if(k==null){k=w}if(E==null){E=z}if(w.x<k.x){k.x=w.x}if(w.y<k.y){k.y=w.y}if(w.z<k.z){k.z=w.z}if(z.x>E.x){E.x=z.x}if(z.y>E.y){E.y=z.y}if(z.z>E.z){E.z=z.z}f.set(k,E);H.radius=E.clone().sub(k).multiplyScalar(0.5).length();H.center=E.clone().add(k).multiplyScalar(0.5);for(var y=0;y<h.drawingGroups.length;y++){var D=h.drawingGroups[y];if(!u){if(D._geomType!==0){u=true}}D.geometry=n;if((B!==undefined)&&B){var F=null;var o=null;var t=D.gas;var p=D.material;if(p){D.gas=p}else{if(t!==null){if((o!=null)&&d.areEqualGraphicProperties(o,t)){D.gas=F}else{var x=new b.Color();x.setRGB(t.color.r,t.color.g,t.color.b);var m={color:x,opacity:t.opacity};if(t.linewidth){console.warn("DEPRECATED : Use lineWidth (cameCase) instead of linewidth.");t.lineWidth=t.linewidth}if(t.lineWidth){m.lineWidth=t.lineWidth;if(t.pattern){m.pattern=t.pattern}}else{if(t.pointsize){m.symbol=0;m.size=t.pointsize}else{m.solid=t.solid}}if(g){var G={colorRGB:m.color,colorA:m.opacity,inheritance:b.GASEnum.RGBA_INHERIT};if(m.lineWidth){G.lineWidth=m.lineWidth;G.inheritance|=b.GASEnum.LINEWIDTH_INHERIT}if(m.pattern){G.lineType=m.pattern;G.inheritance|=b.GASEnum.LINETYPE_INHERIT}D.gas=new c(G)}else{D.gas=q.getMaterialFromGAS(m)}F=D.gas;o=t}}}}}n.drawingGroups=h.drawingGroups;n.vertexPositionArray=h.vertexPositionArray;if(h.vertexNormalArray!==null){n.vertexNormalArray=h.vertexNormalArray}if(h.vertexColorArray!==null){n.vertexColorArray=h.vertexColorArray}if(h.vertexUvArray!==null){n.vertexUvArray=h.vertexUvArray}if(h.vertexUv2Array){n.vertexUv2Array=h.vertexUv2Array}if(h.vertexTangentArray){n.vertexTangentArray=h.vertexTangentArray}if(h.vertexBinormalArray){n.vertexBinormalArray=h.vertexBinormalArray}n.vertexIndexArray=h.vertexIndexArray;var C=r&&(r.isDashedLine||(r.backMaterial&&r.backMaterial.isDashedLine));if(C){n.computeLineDistances(s.patternOffsets)}l.push(n)}if(!H.radius){H.radius=0.1}if(!f.min.distanceToSquared(f.max)){f.expandByScalar(0.1)}l.boundingSphere=H;l.boundingBox=f;e=new b.Mesh(l,r);e.matrixAutoUpdate=false;e.castShadow=true;e.receiveShadow=true;var v=new d.SGBag();v.children.push(s[0].rep);s[0].rep.parent=v;e.sceneGraph=v;e.fromLoadedModel=u;return e};d.createEmptyMesh=function(){var f=new b.BufferGeometryDS();f.boundingSphere=new b.Sphere(new b.Vector3(),0);f.boundingBox=new b.Box3();var e=new b.MeshPhongMaterial();mesh=new b.Mesh(f,e);mesh.matrixAutoUpdate=false;mesh.castShadow=true;mesh.receiveShadow=true;return new THREEDS.Nodes.Mesh(mesh)};d.convertTo3js=function(s,v,u,k){var f=null;var m=[];var l=null;var C=null;var E=new b.Sphere();var g=new b.Box3();var q=new THREEDS.MaterialManager();q.cleanResources();var B;for(var A=0;A<s.length;A++){var h=s[A];var o=new b.BufferGeometryDS();var w=new b.Vector3(h.AABB.min[0],h.AABB.min[1],h.AABB.min[2]);var z=new b.Vector3(h.AABB.max[0],h.AABB.max[1],h.AABB.max[2]);if(l==null){l=w}if(C==null){C=z}if(w.x<l.x){l.x=w.x}if(w.y<l.y){l.y=w.y}if(w.z<l.z){l.z=w.z}if(z.x>C.x){C.x=z.x}if(z.y>C.y){C.y=z.y}if(z.z>C.z){C.z=z.z}g.set(l,C);E.radius=C.clone().sub(l).multiplyScalar(0.5).length();E.center=C.clone().add(l).multiplyScalar(0.5);var D=null;var p=null;for(var y=0;y<h.drawingGroups.length;y++){h.drawingGroups[y].geometry=o;var t=h.drawingGroups[y].gas;var r=h.drawingGroups[y].material;if(k&&(r!==null)&&!r.file&&(r.id!==-1)){if(k[r.id]!=null){B=k[r.id]}else{B=q.getMaterialCgr(v[r.id],undefined,"CGR",u);k[r.id]=B}h.drawingGroups[y].gas=B}else{if((t!==null)&&t.color){var x=new b.Color();x.setRGB(t.color.r,t.color.g,t.color.b);h.drawingGroups[y].gas=q.getMaterialFromGAS({color:x,opacity:t.opacity,lineWidth:(t.lineWidth?t.lineWidth:t.linewidth),solid:t.solid,symbol:t.symbol,basic:t.basic,resource:u})}}}o.drawingGroups=h.drawingGroups;o.vertexPositionArray=h.vertexPositionArray;if(h.vertexNormalArray!==null){o.vertexNormalArray=h.vertexNormalArray}if(h.vertexUvArray!==null){o.vertexUvArray=h.vertexUvArray}if(h.vertexUv2Array){o.vertexUv2Array=h.vertexUv2Array}if(h.vertexTangentArray){o.vertexTangentArray=h.vertexTangentArray}if(h.vertexBinormalArray){o.vertexBinormalArray=h.vertexBinormalArray}o.vertexIndexArray=h.vertexIndexArray;m.push(o)}var e=new b.Color();e.setRGB(s[0].gas.fill.color.r,s[0].gas.fill.color.g,s[0].gas.fill.color.b);var n=new b.Color();n.setRGB(s[0].gas.line.color.r,s[0].gas.line.color.g,s[0].gas.line.color.b);var r=q.getMaterialFromGAS({color:e,opacity:s[0].gas.fill.opacity,solid:s[0].gas.fill.solid,basic:s[0].gas.fill.basic});r.line=q.getMaterialFromGAS({color:n,opacity:s[0].gas.line.opacity,lineWidth:(s[0].gas.line.lineWidth?s[0].gas.line.lineWidth:s[0].gas.line.linewidth)});m.boundingSphere=E;m.boundingBox=g;f=new b.Mesh(m,r);f.matrixAutoUpdate=false;f.castShadow=true;f.receiveShadow=true;if(s.length){f.sceneGraph=s[0].sceneGraph}return new THREEDS.Nodes.Mesh(f)};d.mergeGeometries=function(am){am.invalidRatio=am.invalidRatio||0;var ap=0;var J=0;var ac=[];var S=0;var g=false;var o=false;var l=false;var G=false;var Z=false;var an=false;for(var P=0;P<am.layers.length;P++){var E=am.layers[P].drawableInterval;if(E.layerNum<=0){S+=E.count}}for(var P=0;P<am.geometries.length;P++){var ay=am.geometries[P];ap+=ay.vertexIndexArray.length;J+=ay.vertexPositionArray.length;ac[P]=ay.vertexPositionArray.length;g=(ay.vertexNormalArray!==null);o=(ay.vertexUvArray!==null);l=(ay.vertexUv2Array!==null);G=(ay.vertexColorArray!==null);Z=(ay.vertexTangentArray!==null);an=(ay.vertexBinormalArray!==null)}if(!S&&!am.force){return null}if(!am.force&&(S/ap<am.invalidRatio)){return null}var ai=[];for(var P=0;P<am.layers.length;P++){var y=am.layers[P].drawableGroup;var E=am.layers[P].drawableInterval;if(E.layerNum>0){for(var O=E.primitiveStart;O<E.primitiveStart+E.primitiveCount;O++){ai.push(y.primitives[O])}}}ai.sort(function(j,i){var n=j.group;var k=i.group;if(n.glType<k.glType){return -1}if(n.glType>k.glType){return 1}if(n._geomType<k._geomType){return -1}if(n._geomType>k._geomType){return 1}if(n.gas===null){return -1}if(k.gas===null){return 1}if(n.gas.id<k.gas.id){return -1}if(n.gas.id>k.gas.id){return 1}return 0});var m=[];for(var P=0;P<ac.length;P++){m[P]=new Int32Array(ac[P]/3);for(var O=0;O<m[P].length;O++){m[P][O]=-1}}var B=[];var at=[];var au=[];var aw=[];var H=[];var w=[];var N=[];var az=[];var X=[];var V=[];var p=Math.min(J,196608);var aa=Math.min(J*4/3,262144);at[0]=new Float32Array(p);au[0]=g?new Float32Array(p):null;aw[0]=o?new Float32Array(p):null;H[0]=l?new Float32Array(p):null;w[0]=G?new Float32Array(aa):null;N[0]=Z?new Float32Array(p):null;az[0]=an?new Float32Array(p):null;X[0]=new Uint16Array(ap);var ag=ai[0].group.glType;var C=ai[0].group._geomType;var af=ai[0].group.gas;var t=[];var ar=[];var aC=0;var aj=0;var Q=0;var I=0;var z=0;for(var P=0;P<ai.length;P++){var ah=ai[P];var y=ah.group;var ay=y.geometry;var Y=(am.geometries instanceof Array)?am.geometries.indexOf(ay):0;var u=ay.vertexPositionArray;var ax=ay.vertexNormalArray;var D=ay.vertexUvArray;var r=ay.vertexUv2Array;var T=ay.vertexColorArray;var ab=ay.vertexTangentArray;var e=ay.vertexBinormalArray;var s=ay.vertexIndexArray;if(aj+ah.count>=65536){var U=new d.DrawingGroup(af,af,ag,Q,z-Q,undefined,undefined,C);t.push(U);for(var O=0;O<ar.length;O++){ar[O].group=U;U.primitives.push(ar[O])}ar=[];V[aC]=t;B[aC]={index:z,data:aj};ag=y.glType;C=y._geomType;af=y.gas;t=[];aC++;aj=0;Q=0;I=0;z=0;p=196608;aa=262144;at[aC]=new Float32Array(p);au[aC]=g?new Float32Array(p):null;aw[aC]=o?new Float32Array(p):null;H[aC]=l?new Float32Array(p):null;w[aC]=G?new Float32Array(aa):null;N[aC]=Z?new Float32Array(p):null;az[aC]=an?new Float32Array(p):null;X[aC]=new Uint16Array(ap);for(var M=0;M<ac.length;M++){for(var O=0;O<m[M].length;O++){m[M][O]=-1}}}else{if((y.glType!==ag)||(y.gas!==af)||(y._geomType!==C)){var U=new d.DrawingGroup(af,af,ag,Q,z-Q,undefined,undefined,C);ag=y.glType;C=y._geomType;af=y.gas;t.push(U);Q=z;for(var O=0;O<ar.length;O++){ar[O].group=U;U.primitives.push(ar[O])}ar=[]}}I=z;for(var O=0;O<ah.count;O++){var av=s[ah.start+O];var ao=m[Y][av];if(ao===-1){for(var A=0;A<3;A++){at[aC][3*aj+A]=u[3*av+A];if(g){au[aC][3*aj+A]=ax[3*av+A]}if(o){aw[aC][3*aj+A]=D[3*av+A]}if(l){H[aC][3*aj+A]=r[3*av+A]}if(Z){N[aC][3*aj+A]=ab[3*av+A]}if(an){az[aC][3*aj+A]=e[3*av+A]}}if(G){for(var A=0;A<4;A++){w[aC][4*aj+A]=T[4*av+A]}}m[Y][av]=aj;X[aC][z++]=aj;aj++}else{X[aC][z++]=ao}}var f=ah.clone();f.start=I;ar.push(f);ah._newPrim=f}if(ar.length>0){var U=new d.DrawingGroup(af,af,ag,Q,z-Q,undefined,undefined,C);t.push(U);for(var O=0;O<ar.length;O++){ar[O].group=U;U.primitives.push(ar[O])}ar=[];V[aC]=t;B[aC]={index:z,data:aj}}var aB=aC+1;var ae=null;for(var P=0;P<aB;P++){var p=B[P];var v=X[P];var h=at[P];var ak=au[P];var D=aw[P];var r=H[P];var W=w[P];var al=N[P];var L=az[P];if(p.index<v.length){ae=new Uint16Array(p.index);for(var O=0;O<p.index;O++){ae[O]=v[O]}X[P]=ae}if(3*p.data<h.length){var q=3*p.data;var F=4*p.data;ae=new Float32Array(q);for(var O=0;O<q;O++){ae[O]=h[O]}at[P]=ae;if(g){ae=new Float32Array(q);for(var O=0;O<q;O++){ae[O]=ak[O]}au[P]=ae}if(o){ae=new Float32Array(q);for(var O=0;O<q;O++){ae[O]=D[O]}aw[P]=ae}if(l){ae=new Float32Array(q);for(var O=0;O<q;O++){ae[O]=r[O]}H[P]=ae}if(G){ae=new Float32Array(F);for(var O=0;O<F;O++){ae[O]=W[O]}w[P]=ae}if(Z){ae=new Float32Array(q);for(var O=0;O<q;O++){ae[O]=al[O]}N[P]=ae}if(an){ae=new Float32Array(q);for(var O=0;O<q;O++){ae[O]=L[O]}az[P]=ae}}}var aq=[];for(var P=0;P<aB;P++){var R=new d.Mesh();R.vertexPositionArray=at[P];R.vertexNormalArray=au[P];R.vertexUvArray=aw[P];R.vertexUv2Array=H[P];R.vertexColorArray=w[P];R.vertexTangentArray=N[P];R.vertexBinormalArray=az[P];R.vertexIndexArray=X[P];R.drawingGroups=V[P];var aA=[0,0,0];var x=[0,0,0];if(at[P].length>=3){aA=[at[P][0],at[P][1],at[P][2]];x=[at[P][0],at[P][1],at[P][2]];for(var K=0;K<at[P].length;K+=3){if(at[P][K]<aA[0]){aA[0]=at[P][K]}if(at[P][K+1]<aA[1]){aA[1]=at[P][K+1]}if(at[P][K+2]<aA[2]){aA[2]=at[P][K+2]}if(at[P][K]>x[0]){x[0]=at[P][K]}if(at[P][K+1]>x[1]){x[1]=at[P][K+1]}if(at[P][K+2]>x[2]){x[2]=at[P][K+2]}}}R.AABB={min:aA,max:x};aq.push(R)}var ad=d.convertTo3jsGeometry(aq,null);return ad};return d});define("Mesh/MeshUtils",["DS/Mesh/MeshUtils","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Mesh/MeshUtils");return b});