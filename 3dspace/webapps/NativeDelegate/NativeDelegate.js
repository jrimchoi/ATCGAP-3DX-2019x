define("DS/NativeDelegate/NativeDelegate",["UWA/Class"],function(a){var b=a.extend({init:function(c,d){this._parent();this._name=c;this._isCpp=d||false;this._delegateCtrl=null;this._watchTextCb=null;this._watchJSONCb=null;this._watchBinaryCb=null},getName:function(){return this._name},isCpp:function(){return this._isCpp},remove:function(){return HybridApp.removeDelegate(this._name)},execute:function(d,c){return this._delegateCtrl._executeOn(this._name,this._isCpp,d,c)},sendText:function(c){return this._delegateCtrl._sendTextOn(this._isCpp,c)},sendJson:function(c){if(c===null||typeof c!=="object"){c={}}c.target=this._name;return this._delegateCtrl._sendTextOn(this._isCpp,JSON.stringify(c))},sendBinary:function(c){return this._delegateCtrl._sendBinaryOn(this._isCpp,c)},addTextWatch:function(c){if(c){this._watchTextCb=c}},removeTextWatch:function(){this._watchTextCb=null},addJsonWatch:function(c){if(c){this._watchJSONCb=c}},removeJsonWatch:function(){this._watchJSONCb=null},addBinaryWatch:function(c){if(c){this._watchBinaryCb=c}},removeBinaryWatch:function(){this._watchBinaryCb=null},removeAllWatch:function(){this._watchTextCb=null;this._watchJSONCb=null;this._watchBinaryCb=null},});return UWA.namespace("DS/NativeDelegate/NativeDelegate",b)});define("DS/NativeDelegate/NativeDelegateController",["UWA/Class","DS/ExperienceKernel/ExperienceKernel"],function(a,f){var i=0;var d=new Array();var c=function(){return ++i};var h=function(k,l){d[k]=l};var j=function(m,k,l){if(m){var n=d[m];if(n){n(k,l);delete d[m]}}};var b=Object.freeze({DEFAULT_IP:"127.0.0.1",POOL_WEB_APP:"POOL_WEB_APP",POOL_3DX_NATIVE:"POOL_3DX_NATIVE",POOL_OS_NATIVE:"POOL_OS_NATIVE",EMIT_EVENT_KEY:"event",});var e=window.HybridAppArgs?window.HybridAppArgs.IS_EK_PROTOCOL:undefined;var g=a.extend({DELEGATE_TYPE:Object.freeze({NATIVE_CPP:0,OS_SPECIFIC:1}),init:function(){this._parent();this._webAppNode=null;this._cppNativeDelegateNodeID=null;this._nativeDelegateNodeID=null;this._isNativeDelegationAvailable=false;this._delegateDico={};if(undefined!==window.HybridAppArgs&&undefined===window.jasmine){this.connectToNative()}else{console.warn("[ODT Mode] : HybridApp isn't connected to the native")}},connectToNative:function(k){if(null===this._webAppNode){this._webAppNode=new f.Node({onText:this.onText.bind(this),onBinary:this.onBinary.bind(this),onHypervisorConnect:this.onConnection.bind(this),onHypervisorDisconnect:this.onDisconnection.bind(this),onDisconnect:this.onDisconnection.bind(this),pool:b.POOL_WEB_APP,hypervisorIp:b.DEFAULT_IP,webSocketPort:window.HybridAppArgs.webSocketPort})}if(null!==this._webAppNode){this._cppNativeDelegateNodeID=this._webAppNode.connect(b.POOL_3DX_NATIVE).select();if(null!=this._cppNativeDelegateNodeID){this._webAppNode.subscribe(this._cppNativeDelegateNodeID,b.EMIT_EVENT_KEY)}if(e){this._nativeDelegateNodeID=this._webAppNode.connect(b.POOL_OS_NATIVE).select();if(null!=this._nativeDelegateNodeID){this._webAppNode.subscribe(this._nativeDelegateNodeID,b.EMIT_EVENT_KEY)}}}},isAvailable:function(){return this._isNativeDelegationAvailable},linkDelegate:function(k){k._delegateCtrl=this;this._delegateDico[k.getName()]=k},onText:function(n,k){var m=null;if("object"===typeof(n)){m=n}else{try{m=JSON.parse(n)}catch(l){this._executeTextWatchCallback(n)}}if(null!==m){if(m.requestID){j(m.requestID,m.isSuccess,m.data)}else{if("system"==m.target){this._executeSystemCall(m.data)}else{this._executeJsonWatchCallback(m.target,m.data)}}}return true},onBinary:function(l,k){this._executeBinaryWatchCallback(l)},onConnection:function(){this._isNativeDelegationAvailable=true;var k="ON_NATIVE_DELEGATION_CONNECTION";document.dispatchEvent(new CustomEvent("DELEGATE_CONTROLLER",{detail:k}))},onDisconnection:function(){this._webAppNode=null;this._cppNativeDelegateNodeID=null;this._nativeDelegateNodeID=null;this._isNativeDelegationAvailable=false;var k="ON_NATIVE_DELEGATION_DISCONNECTION";console.error(k);document.dispatchEvent(new CustomEvent("DELEGATE_CONTROLLER",{detail:k}))},_executeOn:function(r,m,n,l){var k=c();var q={target:r,action:n,data:l,requestID:k};var o=new Promise(function(s,p){h(k,function(u,t){if(u){s(t)}else{p(t)}})});this._sendTextOn(m,JSON.stringify(q));return o},_sendTextOn:function(k,l){if(this._webAppNode&&undefined!==k&&undefined!==l){if(k){return this._webAppNode.sendText(this._cppNativeDelegateNodeID,l)}else{if(e){return this._webAppNode.sendText(this._nativeDelegateNodeID,l)}else{HybridApp.__postTextMsgToNative(l)}}}else{throw new Error("Missing args")}},_sendBinaryOn:function(k,l){if(this._webAppNode&&undefined!==k&&undefined!==l){if(k){return this._webAppNode.sendBinary(this._cppNativeDelegateNodeID,l)}else{if(e){return this._webAppNode.sendBinary(this._nativeDelegateNodeID,l)}else{HybridApp.__postBinaryMsgToNative(l)}}}else{throw new Error("Missing args")}},_executeSystemCall:function(l){var k={detail:{id:l.id,args:l.args||undefined,}};document.dispatchEvent(new CustomEvent(l.type,k))},_executeTextWatchCallback:function(l){for(var m in this._delegateDico){var k=this._delegateDico[m];if(k&&k._watchTextCb){k._watchTextCb(l)}}},_executeBinaryWatchCallback:function(l){for(var m in this._delegateDico){var k=this._delegateDico[m];if(k&&k._watchBinaryCb){k._watchBinaryCb(l)}}},_executeJsonWatchCallback:function(m,l){var k=this._delegateDico[m];if(k&&k._watchJSONCb){k._watchJSONCb(l)}},});return UWA.namespace("DS/NativeDelegate/NativeDelegateController",g)});