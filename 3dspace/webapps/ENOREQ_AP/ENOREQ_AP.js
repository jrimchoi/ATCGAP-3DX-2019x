function ENOREQ_AP(c){var a={v1:{ap_custo:"ap_custo",ap_root_pids:"ap_root_pids",ap__root_pids_detached:"ap__root_pids_detached"}};var b={widget:null,pad_app:null,home_app:null,paddebug:false,lastStatus:{timer:null,},setting_names:a.v1,enoreq_opts:{x3dAppId:null,widget:null,active_view:null,action_bar_opts:null,ReqTypesPrefOptions:null,layout:{title_update:true,view_customization:null,store_roots_in_pref:true,slidder:false,root_panel:true,drop_invite:"dynamic",padshell:false},settings:null,authorize_setStructure:true,authorizeChangeControl:false},closeActionbarOnStartup:false,init:function(d){this.pcsPrefix=widget.id+"_"+widget.title;window.top.performance.mark(this.pcsPrefix+"_init");this.widget=d.widget;this.widget.addEvent("onLoad",this.onLoad.bind(this));this.widget.addEvent("onRefresh",this.onRefresh.bind(this));this.widget.addEvent("onResize",this.onResize.bind(this))},onRefresh:function(){this.pad_app.refresh()},onLoad:function(){var d=this;localStorage.removeItem("PADTreeListDefinition.ENORERE_AP");window.top.performance.mark(this.pcsPrefix+"_onload");window.top.performance.measure(this.pcsPrefix+"_call_onload",this.pcsPrefix+"_init",this.pcsPrefix+"_onload");require(["text!DS/ENOREQComponent/assets/ENOREQSettings.json","DS/PADUtils/PADWSAccess","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","UWA/Core","DS/PADUtils/PADSession","text!DS/ENOREQComponent/assets/enoreq_settings.json","DS/HomePage/HomePage","text!DS/ENOREQComponent/assets/ENOREQ.2D.json","DS/PADUtils/views/PADAlert","i18n!DS/ENOREQComponent/assets/nls/ENOREQ.json"],function(s,t,j,k,e,q,f,x,r,u,l){window.top.performance.mark(d.pcsPrefix+"_require_infra_padutils");window.top.performance.measure(d.pcsPrefix+"_require_infra",d.pcsPrefix+"_onload",d.pcsPrefix+"_require_infra_padutils");var n=JSON.parse(f);var p=JSON.parse(s);var w=JSON.parse(r);var h=function(B,z){var D=true,A=B.length-1;if(!UWA.is(z)){z=[]}while(A>=0&&D){var y=z.length-1;var C=false;if(UWA.is(B[A].dataIndex)){while(y>=0&&!C){if(z[y].dataIndex&&z[y].dataIndex===B[A].dataIndex){C=true}else{y--}}}if(C){A--}else{D=false}}return D};var m=function(){u.displayNotification({msg:l.Columns_changes,eventID:"info"})};j.setApp(n.padsettings,"enoreq",true);j.with_security_context=true;d.widget.mergePreferences(j.getWidgetPreferences());d.widget.addEvent("endEdit",j.updateWidgetPreferences.bind(j));j.updateWidgetPreferences();j.setSetting("add_objects_when_select",false);j.setSetting("open_in_v5_v2",false);j.setSetting("newCtxMenu",true);j.setSetting("EditModeActivated",true);j.setSetting("expandAllwithApplyFilter",true);j.setSetting("local_preferences_file",{module:"ENOREQComponent",file:"ENOREQ.2D.json"});j.setSetting("authorized_find_in_ctx_types",["Requirement Specification","Requirement","Chapter","Comment"]);j.setSetting("FedDictionnaryAccess",false);var i=j.setSetting("changeControlActivation",true);var o=j.setSetting("changeControlPosition","bottom-right");d.home_app=new x({widget:widget,settings:p});d.ReqTypesPrefOptions={types:p.Customized_types};if(!d.widget.getValue("x3dSharedId")&&!d.widget.getValue("x3dAppId")){d.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"REQ_appId"})}var v=d._initializeENOREQComponent.bind(d);d.setting_names=a.v1;if(d.pad_app===null){var g=d.enoreq_opts;g.x3dAppId=d.widget.getValue("x3dAppId");g.widget=d.widget;g.lang=d.widget.lang;g.active_view=d.widget.getValue("default_view")?d.widget.getValue("default_view"):"treelistview";g.settings=n;g.layout.padshell=true;j.setSetting("authorizeChangeControl",false);g.authorizeChangeControl=false;if(d.widget.getValue(d.setting_names.ap_custo)){g.layout.view_customization=JSON.parse(decodeURIComponent(d.widget.getValue(d.setting_names.ap_custo)));if(UWA.is(g.layout.view_customization.columns)){g.layout.view_customization.columnsOptimized=g.layout.view_customization.columns}if(h(w.pad_columns,g.layout.view_customization.columnsOptimized)){v(g)}else{k.app_initialization(function(){t.getMyAppsTemplate({preference_name:g.x3dAppId,onComplete:function(z){var y=null;if(z.length>0&&z.contains("{")){y=JSON.parse(decodeURIComponent(z));if(!h(w.pad_columns,y)){m();y=""}}g.layout.view_customization=y;v(g)},onFailure:function(y){v(g)}})})}}else{k.app_initialization(function(){t.getMyAppsTemplate({preference_name:g.x3dAppId,onComplete:function(z){var y=null;if(z.length>0&&z.contains("{")){y=JSON.parse(decodeURIComponent(z));if(!h(w.pad_columns,y)){m();y=""}}g.layout.view_customization=y;v(g)},onFailure:function(y){v(g)}})})}}})},onDestroy:function(){this.pad_app.destroy()},onResize:function(e){var d=this;setTimeout(function(){var h=false;if(d.lastStatus.timer!==null){var g=Date.now()-d.lastStatus.timer;h=g>1000?true:false}else{h=true}if(h){d.lastStatus.timer=Date.now();var f=window.getComputedStyle(d.widget.body,null).getPropertyValue("width");f=parseInt(f.replace("px",""));if(d.pad_app&&d.pad_app.elements&&d.pad_app.elements.padslidder){d.pad_app.elements.padslidder._updateMaxSizes(f)}}},500)},_initializeENOREQComponent:function(e){var d=this;e.closeActionbarOnStartup=d.closeActionbarOnStartup;window.top.performance.mark(d.pcsPrefix+"_require_padcomponent_before");require(["DS/ENOREQComponent/ENOREQComponent","UWA/Core","DS/TraceableRequirementsUtils/Services/RequirementUserPrefrences","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementTypeMgt","DS/PADUtils/PADUtilsServices"],function(j,k,g,f,n,i){var l=function(){var o=new g();widget.displayNameSettings=o.getDisplayNamePref()};f.app_initialization(function(){n.addTypes2Preferences(d.ReqTypesPrefOptions);widget.mergePreferences([{name:"trm_tv_addednodes",type:"hidden",defaultValue:""}]);var o=this;widget.addPreference({name:"trm_tv_addednodes",type:"hidden",defaultValue:{},options:[]});widget.setValue("trm_tv_addednodes",{});l()});var h=function(o){d._checkIfChangeControlEnabled(function(){window.top.performance.mark(d.pcsPrefix+"_require_padcomponent_done");window.top.performance.measure(d.pcsPrefix+"_require_padcomponent",d.pcsPrefix+"_require_padcomponent_before",d.pcsPrefix+"_require_padcomponent_done");var p=d._retrieveinitializationOpts(),q=UWA.extend(e,p);if(o.length){q.additionalColumnsModules=o}d.xnav_component=new j(q)})};var m="DS/ENOREQ_AP/AdditionalColumns";require([m,"UWA/Promise"],function(r,t){var s=[];var q=[];var p=new t(function(v){t.all(q).then(function(){r.isAdditionalColumnsAvailable(function(w){if(w===true){s.push(r)}v()})})});p.name="Add "+r.getName();q.push(p);var o=new t(function(v){t.all(q).then(function(){var w="DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns";require([w],function(x){x.isAdditionalColumnsAvailable(function(y){if(y===true){s.push(x)}v()});o.name="Add "+x.getName()})})});q.push(o);var u=new t(function(v){t.all(q).then(function(){h(s);v()})});u.name="Launch real initialization";q.push(u)},function(){h([])})})},_retrieveinitializationOpts:function(){var d=this;return{events:{onReady:function(){window.top.performance.mark(d.pcsPrefix+"_padcomponent_onready");window.top.performance.measure(d.pcsPrefix+"_padcomponent_ready",d.pcsPrefix+"_require_padcomponent_done",d.pcsPrefix+"_padcomponent_onready");d.pad_app=this;function i(){var m=d.widget.getPreference("dnd");var l=m?m.value:"MOVE";d.pad_app.setDnDBehavior(l)}i();d.pad_app.addEvent("onToggleView",function(l){d.widget.setValue("default_view",l)});var g=require("DS/PADUtils/PADSession");var h=(d.widget.getValue("useIndexAccleration")!=="false");g.setUseIndexPreference(h,undefined,true);d.widget.addEvent("endEdit",i);d.widget.setBody(d.pad_app.render());d.home_app.inject(d.widget.body);var f=[];if(!d.widget.getValue(d.setting_names.ap_root_pids)){d.widget.addPreference({name:d.setting_names.ap_root_pids,type:"hidden",defaultValue:"[]"})}else{f=JSON.parse(widget.getValue(d.setting_names.ap_root_pids))}if(!widget.getValue(d.setting_names.ap__root_pids_detached)){widget.addPreference({name:d.setting_names.ap__root_pids_detached,type:"hidden",defaultValue:"[]"})}var k=d.widget.getValue("X3DContentId");if(f.length>0){var j=JSON.parse(widget.getValue(d.setting_names.ap__root_pids_detached));widget.setValue(d.setting_names.ap_root_pids,"[]");widget.setValue(d.setting_names.ap__root_pids_detached,"[]");d.pad_app.add({pids:f,id_to_detach:j},function(){d.widget.dispatchEvent("onENOPADReady")},false)}else{if(UWA.is(k)){var e=UWA.is(k,"string")?JSON.parse(k):k;d.pad_app.addNodesFromContent(e,function(){d.widget.dispatchEvent("onENOPADReady")},null,false)}else{d.widget.dispatchEvent("onENOPADReady")}}window.top.performance.mark(d.pcsPrefix+"_app_load_complete")},onSaveRoots:function(){var e=[],g=[],f=d.pad_app.getPADTreeDocument();f.getRoots().forEach(function(h){e.push(h.getID())});if(f.hasOwnProperty("detachedRoots")){f.detachedRoots.forEach(function(h){g.push(h.getID());if(e.indexOf(h.getID())===-1){e.push(h.getID())}})}widget.setValue(d.setting_names.ap_root_pids,JSON.stringify(e));widget.setValue(d.setting_names.ap__root_pids_detached,JSON.stringify(g))},onRootsVisibility:function(){var f=[],e=d.pad_app.getPADTreeDocument();if(e.hasOwnProperty("detachedRoots")){e.detachedRoots.forEach(function(g){f.push(g.getID())})}widget.setValue(d.setting_names.ap__root_pids_detached,JSON.stringify(f))},onCustoViewChange:function(e){widget.setValue(d.setting_names.ap_custo,encodeURIComponent(JSON.stringify(e)))},onSaveAsTemplate:function(e){widget.setValue(d.setting_names.ap_custo,encodeURIComponent(JSON.stringify(e)));require(["DS/PADUtils/PADWSAccess"],function(f){f.saveMyAppsTemplate({preference_name:widget.getValue("x3dAppId"),value:encodeURIComponent(JSON.stringify(e)),onComplete:function(g){console.log("Saved as template")},onFailure:function(g){console.warn("Cannot save customization template")}})})},onAuthoringCtxAvailable:function(g){if(g.isLicenseValid===true){var e=require("DS/PADUtils/PADSettingsMgt");var f=e.getSetting("changeControlActivation");var h=e.getSetting("changeControlPosition");d.widget.addPreference({name:"changeControlActivation",defaultValue:f,type:"hidden",label:"changeControlActivation_label"});d.widget.addPreference({name:"changeControlPosition",defaultValue:h,type:"hidden",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]});e.addEvent("onChangeControlActivation",function(j){var i=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");if(!d.debouncePrefSynchro){d._proxy.preferenceModification({name:"changeControlActivation",value:j})}else{d.debouncePrefSynchro=false}if(j===true){i.show()}else{i.hide()}});e.addEvent("onChangeControlPosition",function(j){var i=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");i.setPosition(j)})}}}}},_checkIfChangeControlEnabled:function(f){var e=false;var d=this;require(["DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADSettingsMgt"],function(g,i,h){g.getTRMExpressionValue({expression:"TRM_AuthoringContext_Enabled",securityContext:i.getSecurityContext(),onComplete:function(j){var k=JSON.parse(j).results.value;if(UWA.is(k,"boolean")){e=k}else{if(UWA.is(k,"string")){if(k==="true"){e=true}}}h.setSetting("authorizeChangeControl",e);d.enoreq_opts.authorizeChangeControl=e;f(e)},onFailure:function(j){console.error("Could not get change control enabled state: "+j);console.warn("--> Change Control deactivated");h.setSetting("authorizeChangeControl",e);d.enoreq_opts.authorizeChangeControl=e;f(e)},onTimeout:function(){console.error("Could not get change control enabled state: "+error);console.warn("--> Change Control deactivated");h.setSetting("authorizeChangeControl",e);d.enoreq_opts.authorizeChangeControl=e;f(e)}})})}};b.init(c);return b}
/*! -- Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/ENOREQ_AP/AdditionalColumns",["css!DS/ENOREQ_AP/ENOREQ_AP","i18n!DS/ENOREQ_AP/assets/nls/ENOREQ_AP.json","UWA/Core","UWA/Class"],function(a,d,e,b){var c=b.singleton({_columnDataIndex:[],init:function(f){this._parent(f)},isAdditionalColumnsAvailable:function(f){if(e.is(f,"function")===false){throw new Error("A callback function should be defined")}f(true)},getName:function(){return"PS Specific Column"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(f){return true},updateAttributes:function(g,f){if(e.is(g,"object")===false){throw new Error("The object ids to modify must be specify")}if(e.is(f,"function")===false){throw new Error("A callback function should be defined")}require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADRelatedDocuments","DS/PADUtils/views/PADAlert"],function(i,k,h){var j={pids:{},relids:{}};k.getRelatedCADDocuments({data:{input_physical_ids:g.pids},onComplete:function(m){var l=e.is(m,"string")?JSON.parse(m):m;if(l.result.length===0){g.pids.forEach(function(n){j.pids[n]={hasNONPS:"FALSE"}});f(j);throw new Error("Cannot find object with the physicalid "+g.pids)}if(l.result.length!==g.pids.length){g.pids.forEach(function(n){j.pids[n]={hasNONPS:"FALSE"}});f(j);throw new Error("More results than input objects")}l.result.forEach(function(n){var p=n.input_object.physicalid,o=Object.getOwnPropertyNames(n.outputs).length?"TRUE":"FALSE";if(p===""){throw new Error("Resourceid not found in fetch result for "+JSON.stringify(n))}j.pids[p]={hasNONPS:o}});f(j)},onFailure:function(){h.displayNotification({msg:d.generic_service_failure,eventID:"error"});f(j)}})})},getAdditionalColumnsUX:function(g){var f=[]},registerReusableCellContent:function(f){},getOnCellClickCB:function(f){return undefined}});return c});