define("DS/NotificationSubscription/NotificationSubscription",["UWA/Core","UWA/Class/View","DS/PlatformAPI/PlatformAPI"],function(e,d,b){var c;var a=d.extend({init:function(g){var f;if(b.getUser()){f=b.getUser().login}this._getSubscribedState(g,f);this._buildContent(g);this.subscribed=0;this._addEvent(g);b.publish("INTFSubscriptionTopic",{action:"init",params:{notificationID:g.notificationID,tokenID:g.tokenID,user:f}})},_buildContent:function(f){this.button=new e.Element("button",{"class":"btn btn-primary",text:(this.subscribed===0)?"Subscribe":"Unsubscribe",styles:{marginBottom:"5px",marginRight:"10px",maxWidth:"110px",overflow:"hidden",textOverflow:"ellipsis","float":"right"}}).inject(f.target)},_addEvent:function(f){c=this;this.button.onclick=function(){var g,h;c._setSubscribedState();if(window.location.href.search(/https:\/\/([A-z0-9]+)-[A-z0-9]+-[A-z0-9]+-[A-z0-9]+/)===0){h=window.location.href.split(/https:\/\//)[1].split("-")[0].toUpperCase()}if(b.getUser()){g=b.getUser().login}b.publish("INTFSubscriptionTopic",{action:c.subscribed?"subscribe":"unsubscribe",params:{user:g,tenant:h,notificationID:f.notificationID,tokenID:f.tokenID,}})};b.subscribe("INTFSubscriptionTopic",function(g){if(g.action==="setSubscribedState"){g.state=parseInt(g.state);c.subscribed=g.state?g.state:0;var h=(c.subscribed===0)?"Subscribe":"Unsubscribe";if(c.button){c.button.setText(h)}}})},_setSubscribedState:function(){if(!this.subscribed){this.button.textContent="Unsubscribe";this.subscribed=1}else{this.button.textContent="Subscribe";this.subscribed=0}},_getSubscribedState:function(g,f){b.publish("INTFSubscriptionTopic",{action:"getSubscribedState",params:{notificationID:g.notificationID,tokenID:g.tokenID,user:f}})}});return a});