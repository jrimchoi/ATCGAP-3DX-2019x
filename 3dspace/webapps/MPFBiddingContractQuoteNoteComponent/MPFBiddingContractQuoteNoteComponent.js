define("DS/MPFBiddingContractQuoteNoteComponent/NDASection",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFServices/ObjectService","DS/MPFTCContractModel/TCDocumentModel","i18n!DS/MPFBiddingContractQuoteNoteComponent/assets/nls/MPFBiddingContractQuoteNoteComponent","css!DS/MPFBiddingContractQuoteNoteComponent/MPFBiddingContractQuoteNoteComponent"],function(g,f,d,c,b,e){var a=f.extend({className:"col-md-6 mpf-nda-section",setup:function(h){h||(h={});this._parent(h);this._checkPrototypes(h);this.ndaDocument=h.ndaDocument;this.ndaExist=g.is(this.ndaDocument);this.title=this._createTitle();this.downloadButton=this._createDownloadButton();this.message=this._createMessage()},render:function(){this.container.setContent([this.title,this.downloadButton,this.message]);return this},_createMessage:function(){var h=this.ndaExist?e.get("attachedNda"):e.get("noNda");return g.createElement("div",{"class":"mpf-bidding-message",text:h})},_createDownloadButton:function(){if(this.ndaExist){return g.createElement("a",{"class":"mpf-bidding-link",target:"_blank",href:this.ndaDocument.getDocUrl(),html:e.get("download")})}},_createTitle:function(){return g.createElement("div",{"class":"mpf-bidding-title",text:e.get("nda")})},_checkPrototypes:function(h){if(g.is(h.ndaDocument)){c.requiredOfPrototype(h.ndaDocument,b,"options.ndaDocument must be a TCDocumentModel")}}});return a});define("DS/MPFBiddingContractQuoteNoteComponent/NotesSection",["UWA/Core","UWA/Class/View","UWA/Promise","DS/UIKIT/Popover","DS/MPFServices/ObjectService","DS/MPFNoteModel/NoteModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartItemCollection","DS/MPFView/FieldTextInputV2","i18n!DS/MPFBiddingContractQuoteNoteComponent/assets/nls/MPFBiddingContractQuoteNoteComponent","css!DS/MPFBiddingContractQuoteNoteComponent/MPFBiddingContractQuoteNoteComponent"],function(g,b,h,f,i,j,e,c,a,k){var d=b.extend({className:"col-md-6 mpf-notes-section mpf-horizontal",setup:function(l){var m;l||(l={});this._parent(l);this._checkPrototypes(l);this.note=l.note;this.cartItems=l.cartItems;this.title=this._createTitle();m=this.cartItems.first().getState();this.internalReferenceInput=new a({model:this.note,fieldLabel:k.get("internalReference"),fieldName:j.Fields.INTERNAL_REFERENCE,saveOnChange:true,dynamicValidation:true,readOnly:!(m===e.STATUS.draft||m===e.STATUS.submitted||m===e.STATUS.accepted)});this.privateNotesInput=new a({model:this.note,fieldLabel:k.get("privateNotes"),fieldName:j.Fields.PRIVATE_NOTES,saveOnChange:true,dynamicValidation:true,multiline:true,multilineRows:4})},render:function(){this.container.setContent([this.title,this.internalReferenceInput.render(),this.privateNotesInput.render()]);return this},_createTitle:function(){var l;l=g.createElement("span",{"class":"fonticon fonticon-info"});new f({target:l,position:"bottom",body:k.get("infoNotes"),trigger:"hover"});return g.createElement("div",{"class":"mpf-bidding-title",html:[k.get("notes"),l]})},_checkPrototypes:function(l){i.requiredOfPrototype(l.note,j,"options.note must be a NoteModel");i.requiredOfPrototype(l.cartItems,c,"options.cartItems must be a CartItemCollection")}});return d});define("DS/MPFBiddingContractQuoteNoteComponent/QuoteSection",["UWA/Core","UWA/Class/View","UWA/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFBuyer/BuyerType","DS/MPFCountryModel/CountryCollection","DS/MPFPersonModel/PersonModel","DS/MPFCompanyModel/CompanyModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartItemCollection","DS/MPFCartModel/CartModelHelper","DS/MPFCartQuoteModel/CartQuoteModel","DS/MPFAddressModel/AddressCollection","DS/MPFModelFactory/AddressFactory","DS/MPFModelFactory/CompanyFactory","DS/MPFModelFactory/CartFactory","DS/MPFModelFactory/CartItemFactory","DS/MPFCartQuoteComponent/CartQuoteDownloadLink","DS/MPFBuyerAddressComponent/BuyerAddressBook","i18n!DS/MPFBiddingContractQuoteNoteComponent/assets/nls/MPFBiddingContractQuoteNoteComponent","css!DS/MPFBiddingContractQuoteNoteComponent/MPFBiddingContractQuoteNoteComponent"],function(n,e,a,i,t,o,l,q,w,c,x,r,s,d,p,v,f,h,m,g,k,b,j){var u=e.extend({className:"col-md-6 mpf-quote-section",setup:function(y){y||(y={});this._parent(y);this.sellerView=y.sellerView===true;this._checkPrototypes(y);this.me=y.me;this.buyerType=y.buyerType;this.company=y.company;this.addresses=y.addresses;this.cart=y.cart;this.cartItems=y.cartItems;this.cartQuote=y.cartQuote;this.addressFactory=y.addressFactory;this.companyFactory=y.companyFactory;this.cartFactory=y.cartFactory;this.cartItemFactory=y.cartItemFactory;this.countries=y.countries;this.orderStatus=this.cartItems.first().getState();this.buyerAddressBook=this._createBuyerAddressBook();this.title=this._createTitle();this.downloadButton=this._createDownloadButton();this.message=this._createMessage()},render:function(){var y=[this.title,this.downloadButton,this.message];if(n.is(this.buyerAddressBook)){y.push(this.buyerAddressBook.render())}this.container.setContent(y);return this},_createBuyerAddressBook:function(){var z;var A;var y;A=this.orderStatus!==r.STATUS.submitted;y=n.is(this.cart.get("BillTo"))&&this.cart.get("BillTo")!=="";if(A&&!y&&!this.sellerView){z=new b({model:this.addresses,me:this.me,buyer:this.buyerType===l.COMPANY?this.company:this.me,addressFactory:this.addressFactory,companyFactory:this.companyFactory,cartFactory:this.cartFactory,cartItemFactory:this.cartItemFactory,isBillingAddress:true,countries:this.countries,countryReadOnly:this.buyerType===l.COMPANY});this.listenTo(z,"onSelected",this._newBillingAddressHandler.bind(this));return z}},_createMessage:function(){var z;var y;var A;y=this.orderStatus!==r.STATUS.submitted;A=d.isPaidByDirectPurchase(this.cart,this.cartItems);if(this.cart.getState()===x.States.CANCELLED){z=j.get("noQuoteOrderCancelled")}else{if(y||A){z=n.createElement("div",{html:[n.createElement("span",{"class":"fonticon fonticon-check"}),j.get("quoteReady")]})}else{z=j.get("noQuote")}}return n.createElement("div",{"class":"mpf-bidding-message",html:z})},_createDownloadButton:function(){var B;var z;var A;var y;B=this.cart.getState()!==x.States.CANCELLED;z=this.orderStatus!==r.STATUS.submitted;A=d.isPaidByDirectPurchase(this.cart,this.cartItems);if(B&&(z||A)){y=n.is(this.cart.get("BillTo"))&&this.cart.get("BillTo")!=="";if(this.sellerView){if(y){return this._getDownloadQuoteComponent()}else{return this._sellerErrorDownloadButton()}}else{if(y){return this._getDownloadQuoteComponent()}else{return this._createBuyerAddressBookButton()}}}},_getDownloadQuoteComponent:function(){var y;y=new k({model:this.cartQuote,label:j.get("download")});y.render();return y},_sellerErrorDownloadButton:function(){return new i({className:"link",value:j.get("download"),events:{onClick:this._displayErrorQuoteMessage.bind(this)}})},_newBillingAddressHandler:function(y){var z=this;if(y.ok){t.mask(this.container);return this.cart.savePromise({BillTo:y.selectedAddress.get("id")},{patch:true}).then(function(){z.downloadButton=z._createDownloadButton();z.render()})}},_displayErrorQuoteMessage:function(){this.message.setContent([n.createElement("span",{"class":"fonticon fonticon-wrong"}),j.get("errorQuoteSeller")])},_createBuyerAddressBookButton:function(){return new i({className:"link",value:j.get("download"),events:{onClick:this.buyerAddressBook.show.bind(this.buyerAddressBook)}})},_createTitle:function(){return n.createElement("div",{"class":"mpf-bidding-title",text:j.get("quote")})},_checkPrototypes:function(y){o.requiredOfPrototype(y.countries,q,"options.countries must be a CountryCollection");o.requiredOfPrototype(y.me,w,"options.me must be a PersonModel");o.requiredOfPrototype(y.cart,x,"options.cart must be a CartModel");o.requiredOfPrototype(y.cartItems,s,"options.cartItems must be a CartItemCollection");o.requiredOfPrototype(y.cartQuote,p,"options.cartQuote must be a CartQuoteModel");o.requiredOfPrototype(y.addressFactory,f,"options.addressFactory must be an AddressFactory");o.requiredOfPrototype(y.companyFactory,h,"options.companyFactory must be a CompanyFactory");o.requiredOfPrototype(y.cartFactory,m,"options.cartFactory must be a CartFactory");o.requiredOfPrototype(y.cartItemFactory,g,"options.cartItemFactory must be a CartItemFactory");if(!this.sellerView){o.requiredOfPrototype(y.addresses,v,"options.addresses must be an AddressCollection");if(this.buyerType===l.COMPANY){o.requiredOfPrototype(y.company,c,"options.company must be a CompanyModel")}}}});return u});define("DS/MPFBiddingContractQuoteNoteComponent/InvoiceSection",["UWA/Core","UWA/Class/View","UWA/Promise","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Input/Button","DS/UIKIT/Input/File","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartItemCollection","DS/MPFCartModel/CartModelHelper","DS/MPFInvoiceModel/InvoiceDocumentModel","DS/MPFInvoiceComponent/InvoiceUploadModal","DS/MPFModelFactory/InvoiceDocumentFactory","i18n!DS/MPFBiddingContractQuoteNoteComponent/assets/nls/MPFBiddingContractQuoteNoteComponent","css!DS/MPFBiddingContractQuoteNoteComponent/MPFBiddingContractQuoteNoteComponent"],function(l,g,c,d,i,o,r,n,a,s,p,q,f,k,m,h,j){var e={};e.NOT_AVAILABLE="notAvailable";e.UPLOAD_AVAILABLE="uploadAvailable";e.ALREADY_UPLOADED="alreadyUploaded";var b=g.extend({className:"col-md-6 mpf-invoice-section",setup:function(t){t||(t={});this._parent(t);this._checkPrototypes(t);this.sellerView=t.sellerView===true;this.cart=t.cart;this.cartItems=t.cartItems;this.invoiceDocument=t.invoiceDocument;this.invoiceDocumentFactory=t.invoiceDocumentFactory;this.stateMachine=this._createStateMachine();this.title=this._createTitle();this.button=this._createButton();this.downloadButton=this._createDownloadButton();this.inputFile=this._createInputFile();this.message=this._createMessage()},render:function(){this.container.setContent([this.title,this.downloadButton,this.button,this.message]);return this},_updateContent:function(t){this.stateMachine.changeState(t);this.downloadButton=this._createDownloadButton();this.button=this._createButton();this.message=this._createMessage();this.render()},_createMessage:function(){var t;if(this.stateMachine.getState()===e.NOT_AVAILABLE){t=j.get("invoiceNotAvailable")}else{if(this.stateMachine.getState()===e.ALREADY_UPLOADED){t=l.createElement("div",{html:[l.createElement("span",{"class":"fonticon fonticon-check"}),this.invoiceDocument.getDocName()]})}else{if(this.stateMachine.getState()===e.UPLOAD_AVAILABLE){t=j.get("noInvoiceYet")}}}return l.createElement("div",{"class":"mpf-bidding-message",html:t})},_createButton:function(){if(this.sellerView){if(this.stateMachine.getState()===e.ALREADY_UPLOADED){return this._createDeleteInvoiceButton()}else{if(this.stateMachine.getState()===e.UPLOAD_AVAILABLE){return this._createUploadInvoiceButton()}}}},_createInputFile:function(){var u=this;var t;if(this.sellerView){return new o({events:{onChange:function(v){r.mask(u.container);t=v.target.files[0];u.invoiceDocument=u.invoiceDocumentFactory.createModel(h.Types.CART_INVOICE_DOCUMENT);u.invoiceDocument.parentResourceId=u.cart.get("id");return u.invoiceDocument.saveFile(t).then(function(){var w={};w[s.Fields.BUYER_INVOICE_DOCUMENT_PID]=u.invoiceDocument.id;return c.all([u.cart.savePromise(w,{patch:true}),u.invoiceDocument.fetchPromise()])}).then(function(){u._updateContent(e.ALREADY_UPLOADED);r.unmask(u.container);d.publish("MPCartTimeline",{event:"refresh",cartId:u.cart.id})})}}})}},_createUploadInvoiceButton:function(){return new i({className:"default",value:j.get("uploadInvoice"),events:{onClick:this._uploadInvoiceHandler.bind(this)}})},_uploadInvoiceHandler:function(){this.inputFile.elements.input.click()},_createDeleteInvoiceButton:function(){return new i({className:"default",value:j.get("deleteInvoice"),events:{onClick:this._updateContent.bind(this,e.UPLOAD_AVAILABLE)}})},_createDownloadButton:function(){if(this.stateMachine.getState()===e.ALREADY_UPLOADED){return l.createElement("a",{"class":"mpf-bidding-link",target:"_blank",href:this.invoiceDocument.getDocUrl(),html:j.get("download")})}},_createTitle:function(){return l.createElement("div",{"class":"mpf-bidding-title",text:j.get("invoice")})},_createStateMachine:function(){var t;if(f.isConfirmed(this.cart)){t=this.cart.getBuyerInvoiceDocumentPid()!==""?e.ALREADY_UPLOADED:e.UPLOAD_AVAILABLE}else{t=e.NOT_AVAILABLE}return new a({state:t,states:[e.NOT_AVAILABLE,e.UPLOAD_AVAILABLE,e.ALREADY_UPLOADED],transitions:[{from:e.UPLOAD_AVAILABLE,to:e.ALREADY_UPLOADED},{from:e.ALREADY_UPLOADED,to:e.UPLOAD_AVAILABLE}]})},_checkPrototypes:function(t){n.requiredOfPrototype(t.cart,s,"options.cart must be a CartModel");n.requiredOfPrototype(t.cartItems,q,"options.cartItems must be a CartItemCollection");n.requiredOfPrototype(t.invoiceDocumentFactory,h,"options.invoiceDocumentFactory must be an InvoiceDocumentFactory");if(t.cart.getBuyerInvoiceDocumentPid()!==""){n.requiredOfPrototype(t.invoiceDocument,k,"options.invoiceDocument must be an InvoiceDocumentModel")}}});b.States=Object.freeze(e);return b});define("DS/MPFBiddingContractQuoteNoteComponent/BiddingContractQuoteNoteComponent",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFServices/ObjectService","DS/MPFBuyer/BuyerType","DS/MPFCountryModel/CountryCollection","DS/MPFPersonModel/PersonModel","DS/MPFTCContractModel/TCDocumentModel","DS/MPFTCContractModel/TCContractModel","DS/MPFCompanyModel/CompanyModel","DS/MPFShopModel/ShopModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemCollection","DS/MPFCartQuoteModel/CartQuoteModel","DS/MPFInvoiceModel/InvoiceDocumentModel","DS/MPFNoteModel/NoteModel","DS/MPFAddressModel/AddressCollection","DS/MPFModelFactory/AddressFactory","DS/MPFModelFactory/CompanyFactory","DS/MPFModelFactory/CartFactory","DS/MPFModelFactory/CartItemFactory","DS/MPFModelFactory/TCContractFactory","DS/MPFModelFactory/TCDocumentFactory","DS/MPFModelFactory/InvoiceDocumentFactory","DS/MPFBiddingContractQuoteNoteComponent/NDASection","DS/MPFBiddingContractQuoteNoteComponent/QuoteSection","DS/MPFTcContractComponent/SellerSalesConditionsOrder","DS/MPFBiddingContractQuoteNoteComponent/InvoiceSection","DS/MPFBiddingContractQuoteNoteComponent/NotesSection","i18n!DS/MPFBiddingContractQuoteNoteComponent/assets/nls/MPFBiddingContractQuoteNoteComponent","css!DS/MPFBiddingContractQuoteNoteComponent/MPFBiddingContractQuoteNoteComponent"],function(r,g,c,u,n,w,D,s,t,d,l,E,x,v,q,y,C,i,k,o,j,z,b,h,A,B,p,a,e,m){var f=g.extend({className:"col-md-12 container-fluid mpf-bidding-contract-quote-note",setup:function(F){F||(F={});this._parent(F);this.sellerView=F.sellerView===true;this._checkPrototypes(F);this.buyerType=F.buyerType;this.countries=F.countries;this.me=F.me;this.ndaDocument=F.ndaDocument;this.salesContract=F.salesContract;this.salesDocument=F.salesDocument;this.cart=F.cart;this.cartItems=F.cartItems;this.cartQuote=F.cartQuote;this.addresses=F.addresses;this.company=F.company;this.shop=F.shop;this.addressFactory=F.addressFactory;this.companyFactory=F.companyFactory;this.cartFactory=F.cartFactory;this.cartItemFactory=F.cartItemFactory;this.tcDocumentFactory=F.tcDocumentFactory;this.tcContractFactory=F.tcContractFactory;this.invoiceDocument=F.invoiceDocument;this.invoiceDocumentFactory=F.invoiceDocumentFactory;this.note=F.note;this.ndaSection=new A({ndaDocument:this.ndaDocument});if(r.is(this.salesDocument)){this.salesConditionsSection=new p({sellerView:this.sellerView,shop:this.shop,tcContractFactory:this.tcContractFactory,tcDocumentFactory:this.tcDocumentFactory,salesContract:this.salesContract,salesDocument:this.salesDocument})}this.quoteSection=new B({sellerView:this.sellerView,buyerType:this.buyerType,countries:this.countries,me:this.me,cart:this.cart,cartItems:this.cartItems,cartQuote:this.cartQuote,company:this.company,addresses:this.addresses,addressFactory:this.addressFactory,companyFactory:this.companyFactory,cartFactory:this.cartFactory,cartItemFactory:this.cartItemFactory});this.invoiceSection=new a({sellerView:this.sellerView,cartItems:this.cartItems,cart:this.cart,invoiceDocument:this.invoiceDocument,invoiceDocumentFactory:this.invoiceDocumentFactory});this.notesSection=new e({note:this.note,cartItems:this.cartItems})},render:function(){if(this.shop.isInternal()){this.container.setContent([this.ndaSection.render(),this.notesSection.render()])}else{this.container.setContent(this._getLayoutContent())}return this},_getLayoutContent:function(){var G=[];var H;var F;if(r.is(this.salesConditionsSection)){H=r.createElement("div",{"class":"row",html:[this.ndaSection.render(),this.salesConditionsSection.render()]});F=r.createElement("div",{"class":"row",html:[this.quoteSection.render(),this.notesSection.render()]});G.push(H);G.push(F)}else{H=r.createElement("div",{"class":"row",html:[this.ndaSection.render(),this.notesSection.render(),this.quoteSection.render()]});G.push(H)}return G},_checkPrototypes:function(F){u.requiredOfPrototype(F.countries,w,"options.countries must be a CountryCollection");u.requiredOfPrototype(F.note,y,"options.note must be a NoteModel");u.requiredOfPrototype(F.shop,l,"options.shop must be a ShopModel");u.requiredOfPrototype(F.me,D,"options.me must be a PersonModel");u.requiredOfPrototype(F.addressFactory,i,"options.addressFactory must be an AddressFactory");u.requiredOfPrototype(F.companyFactory,k,"options.companyFactory must be a CompanyFactory");u.requiredOfPrototype(F.cartFactory,o,"options.cartFactory must be a CartFactory");u.requiredOfPrototype(F.cartItemFactory,j,"options.cartItemFactory must be a CartItemFactory");u.requiredOfPrototype(F.cart,E,"options.cart must be a CartModel");u.requiredOfPrototype(F.cartItems,x,"options.cartItems must be a CartItemCollection");u.requiredOfPrototype(F.cartQuote,v,"options.cartQuote must be a CartQuoteModel");u.requiredOfPrototype(F.tcContractFactory,z,"options.tcContractFactory must be a TCContractFactory");u.requiredOfPrototype(F.tcDocumentFactory,b,"options.tcDocumentFactory must be a TCDocumentFactory");u.requiredOfPrototype(F.invoiceDocumentFactory,h,"options.invoiceDocumentFactory must be an InvoiceDocumentFactory");if(F.cart.getBuyerInvoiceDocumentPid()!==""){u.requiredOfPrototype(F.invoiceDocument,q,"options.invoiceDocument must be an InvoiceDocumentModel")}if(r.is(F.ndaDocument)){u.requiredOfPrototype(F.ndaDocument,s,"options.ndaDocument must be a TCDocumentModel")}if(r.is(F.salesDocument)){u.requiredOfPrototype(F.salesDocument,s,"options.salesDocument must be a TCDocumentModel")}if(r.is(F.salesContract)){u.requiredOfPrototype(F.salesContract,t,"options.salesContract must be a TCContractModel")}if(!this.sellerView){u.requiredOfPrototype(F.addresses,C,"options.addresses must be an AddressCollection");if(this.buyerType===n.COMPANY){u.requiredOfPrototype(F.company,d,"options.company must be a CompanyModel")}}}});return f});define("DS/MPFBiddingContractQuoteNoteComponent/BiddingContractQuoteNoteFactory",["UWA/Core","UWA/Class","UWA/Promise","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFTCContractModel/TCContractModel","DS/MPFModelFactory/InvoiceDocumentFactory","DS/MPFBuyer/BuyerType","DS/MPFCompanyModel/CompanyHelper","DS/MPFModelFactory/CartQuoteFactory","DS/MPFModelFactory/NoteFactory","DS/MPFBiddingContractQuoteNoteComponent/BiddingContractQuoteNoteComponent"],function(j,a,k,d,m,i,l,c,h,g,e,f){var b=a.extend({init:function(n){n||(n={});this.me=n.me;this.cart=n.cart;this.shop=n.shop;this.sellerView=n.sellerView},getComponent:function(){return this._getConnector().then(this._initFactories.bind(this)).then(this._initModelsAndCollections.bind(this)).then(this._fetchAllResources.bind(this)).then(this._fetchAddresses.bind(this)).then(this._buildComponent.bind(this))},_getConnector:function(){return d.fetchPromise()},_initFactories:function(n){var o=this;this.factoryDispenser=m.getInstance(n);return k.all([this.factoryDispenser.getFactory(m.Types.COUNTRY),this.factoryDispenser.getFactory(m.Types.CART),this.factoryDispenser.getFactory(m.Types.TC_CONTRACT),this.factoryDispenser.getFactory(m.Types.TC_DOCUMENT),this.factoryDispenser.getFactory(m.Types.CART_ITEM),this.factoryDispenser.getFactory(m.Types.COMPANY),this.factoryDispenser.getFactory(m.Types.ADDRESS),this.factoryDispenser.getFactory(m.Types.CART_QUOTE),this.factoryDispenser.getFactory(m.Types.SHOP_SERVICE),this.factoryDispenser.getFactory(m.Types.INVOICE_DOCUMENT),this.factoryDispenser.getFactory(m.Types.NOTE)]).then(function(p){o.countryFactory=p[0];o.cartFactory=p[1];o.tcContractFactory=p[2];o.tcDocumentFactory=p[3];o.cartItemFactory=p[4];o.companyFactory=p[5];o.addressFactory=p[6];o.cartQuoteFactory=p[7];o.shopServiceFactory=p[8];o.invoiceDocumentFactory=p[9];o.noteFactory=p[10];o.companyFactory.addressFactory=o.addressFactory})},_initModelsAndCollections:function(){this.cartQuote=this.cartQuoteFactory.createModel(g.Types.CART_QUOTE);this.cartItems=this.cartItemFactory.createCollection("cart-items",this.cart.getItems());this.cartItemsIDs=this._getCartItemsIDs();this.cartQuote.parentResourceId=this.cart.id;this.cartItems.parentResourceId=this.cart.id;return k.resolve()},_getCartItemsIDs:function(){var n=[];this.cartItems.forEach(function(o){n.push(o.get("id"))});return n},_fetchAllResources:function(){return k.all([this._fetchCountries(),this._fetchCompany(),this._fetchInvoiceDocument(),this._fetchNote(),this._getNDA(),this._getSellerSalesConditions()])},_fetchCountries:function(){this.countries=this.countryFactory.createCollection("buyer");return this.countries.fetchPromise()},_fetchCompany:function(){if(!this.sellerView){this.company=h.getCompanyFromPerson(this.me,this.companyFactory);if(j.is(this.company)){this.buyerType=c.COMPANY;return this.company.fetchPromise()}}},_fetchInvoiceDocument:function(){if(this.cart.getBuyerInvoiceDocumentPid()){this.invoiceDocument=this.invoiceDocumentFactory.createModel(l.Types.CART_INVOICE_DOCUMENT);this.invoiceDocument.id=this.cart.getBuyerInvoiceDocumentPid();this.invoiceDocument.parentResourceId=this.cart.get("id");return this.invoiceDocument.fetchPromise()}else{return k.resolve()}},_fetchNote:function(){this.note=this.noteFactory.createModel(e.Types.CART,{id:""});this.note.parentResourceId=this.cart.id;return this.note.fetchPromise()},_getNDA:function(){if(this.sellerView){return this._getConsumedContracts().then(this._getNDAContract.bind(this,this.consumedContracts)).then(this._getNDADocument.bind(this))}else{return this._getSuppliedContracts().then(this._getNDAContract.bind(this,this.suppliedContracts)).then(this._getNDADocument.bind(this))}},_getNDAContract:function(n){var o=this;this.ndaContract=n.find(function(p){return p.getDocumentType()===i.DOCUMENT_TYPES.NDA&&o.cartItemsIDs.indexOf(p.getCartItemID())!==-1});return this.ndaContract},_getNDADocument:function(){if(j.is(this.ndaContract)){this.ndaDocument=this.tcDocumentFactory.createModel("documents",{id:this.ndaContract.getDocumentID()});return this.ndaDocument.fetchPromise()}else{return k.resolve()}},_getSellerSalesConditions:function(){if(this.sellerView){return this._getSuppliedContracts().then(this._getSellerSalesConditionsContract.bind(this,this.suppliedContracts)).then(this._getSellerSalesConditionsDocument.bind(this))}else{return this._getConsumedContracts().then(this._getSellerSalesConditionsContract.bind(this,this.consumedContracts)).then(this._getSellerSalesConditionsDocument.bind(this))}},_getSellerSalesConditionsContract:function(n){this.salesContract=this._getSpecificSalesContract(n);return this.salesContract},_getSpecificSalesContract:function(n){var o=this;return n.find(function(p){return o._isThisSalesContractSpecificToThisOrder(p)})},_isThisSalesContractSpecificToThisOrder:function(o){var n=this;return this.cartItemsIDs.find(function(p){return o.getCartItemID()===p&&o.getConsumerID()===n.cart.getOwnerId()&&o.getDocumentType()===i.DOCUMENT_TYPES.SPECIFIC_SALES_CONDITIONS&&o.getCurrentState()!==i.STATUS.archived})},_getSellerSalesConditionsDocument:function(){if(j.is(this.salesContract)){this.salesDocument=this.tcDocumentFactory.createModel("documents",{id:this.salesContract.getDocumentID()});return this.salesDocument.fetchPromise()}else{if(j.is(this.shop.getServices()["contract-documents"][0])){this.salesDocument=this.tcDocumentFactory.createModel("documents",{id:this.shop.getServices()["contract-documents"][0].id});return this.salesDocument.fetchPromise()}else{return k.resolve()}}},_getConsumedContracts:function(){this.consumedContracts=this.tcContractFactory.createCollection("consumed-contracts");return this.consumedContracts.fetchPromise()},_getSuppliedContracts:function(){this.suppliedContracts=this.tcContractFactory.createCollection("supplied-contracts");return this.suppliedContracts.fetchPromise()},_fetchAddresses:function(){if(!this.sellerView){if(this.buyerType===c.COMPANY){this.addresses=this.company.addresses;this.addresses.parentResourceId=this.company.get("id")}else{this.addresses=this.addressFactory.createCollection("me");this.me.addresses=this.addresses;return this.addresses.fetchPromise()}}},_buildComponent:function(){return new f({sellerView:this.sellerView,buyerType:this.buyerType,countries:this.countries,me:this.me,ndaDocument:this.ndaDocument,salesContract:this.salesContract,salesDocument:this.salesDocument,cart:this.cart,cartItems:this.cartItems,cartQuote:this.cartQuote,company:this.company,shop:this.shop,addresses:this.addresses,addressFactory:this.addressFactory,companyFactory:this.companyFactory,cartFactory:this.cartFactory,cartItemFactory:this.cartItemFactory,tcContractFactory:this.tcContractFactory,tcDocumentFactory:this.tcDocumentFactory,cartItemsIDs:this.cartItemsIDs,invoiceDocument:this.invoiceDocument,invoiceDocumentFactory:this.invoiceDocumentFactory,note:this.note})}});return b});