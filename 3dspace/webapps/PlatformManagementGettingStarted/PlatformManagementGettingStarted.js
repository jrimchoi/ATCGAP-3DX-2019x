define("DS/PlatformManagementGettingStarted/View/WelcomePlatformView",["UWA/Core","UWA/Class/View","DS/UIKIT/DropdownMenu","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/PlatformAPI/PlatformAPI","DS/PlatformManagement/Utils","i18n!DS/PlatformManagementGettingStarted/assets/nls/PlatformManagementGettingStarted"],function(h,g,c,d,a,b,f,e){return g.extend({tagName:"div",className:"welcome-box",setup:function(i){this.platform=i.platform;this.platformCollection=i.platformCollection},render:function(){this.container.setContent(this._createTemplate());this._buildSelector();return this},_buildSelector:function(){var j=this,i=[{id:"rename",fonticon:"pencil",text:e.get("Rename")}];if(this.platformCollection.size()>1){i.push({className:"divider"});this.platformCollection.forEach(function(k){i.push({id:k.get("id"),text:k.get("name"),selected:j.platform.get("id")===k.get("id")})})}new c({target:this.selectIcon,multiSelect:false,items:i,events:{onClick:function(l,k){console.log(k);if(k.id==="rename"){j.container.getElement(".welcome-edit-platform").removeClassName("hidden");j.container.getElement(".welcome-text-platform-selector").addClassName("hidden");j.container.getElement("#platform-name").focus()}else{j.dispatchEvent("onLoadingStart");b.publish("platform:tenant",{tenantId:k.id});f.getWidget().setValue("x3dPlatformId",k.id);setTimeout(function(){j.dispatchEvent("onPlatformNameSaved")},500)}}}})},_createTemplate:function(){this.selectIcon=h.createElement("i",{tag:"i","class":"fonticon fonticon-open-down pointer"});return[{"class":"welcome-text-head",text:e.get("Welcome to your platform")},{"class":"welcome-text-platform",html:[{"class":"welcome-text-platform-selector",html:[{tag:"span",text:this.platform.get("name")},this.selectIcon]},this._buildEditZone()]},{"class":"welcome-text",styles:{"font-weight":"bold"},text:e.get("You have been selected as an administrator to manage users & roles.")},{"class":"welcome-text",text:f.isLightweight()?e.get("This is the Members Management dashboard."):e.get("This is the Platform Management dashboard.")},{tag:"ul",styles:{"list-style-type":"disc"},html:[{tag:"li","class":"welcome-text",text:e.get("Begin by going to the next tab, “Members”, where you can invite other users and give them access to apps by granting them roles.")},{tag:"li","class":"welcome-text",text:e.get("Be sure to give yourself the roles you need, too.")},{tag:"li","class":"welcome-text",text:e.get("Use the 3DDashboard menu to change to a different dashboard, such as My First Dashboard. You can also create your own dashboard.")},{tag:"li","class":"welcome-text",text:e.get("Find your apps in Compass. Some apps can be dragged onto the dashboard, and some launch in other windows.")}]}]},_buildEditZone:function(){var i=this;return{"class":"welcome-edit-platform hidden",html:[new d({id:"platform-name",value:this.platform.get("name"),attributes:{maxlength:45,events:{keyup:function(j){if(j.keyCode===13){i._onSavePlatformName()}}}}}),{styles:{"text-align":"right"},html:[new a({value:e.get("Save"),attributes:{styles:{"margin-right":10}},className:"primary",events:{onClick:this._onSavePlatformName.bind(this)}}),new a({value:e.get("Cancel"),events:{onClick:this._onCancelPlatformName.bind(this)}})]}]}},_onSavePlatformName:function(){var i=this,j=this.container.getElement("#platform-name").value;if(j.length>=3&&j.length<=45&&j!==this.platform.get("name")){this.dispatchEvent("onLoadingStart");this.platform.save({id:this.platform.get("id"),name:j},{patch:true,onComplete:this.onComplete.bind(this),onFailure:function(){i.dispatchEvent("onLoadingEnd")}});this.platformCollection.get(this.platform.get("id")).set({name:j})}else{if(j!==this.platform.get("name")){return}else{this.onComplete()}}},_onCancelPlatformName:function(){this.container.getElement(".welcome-edit-platform").addClassName("hidden");this.container.getElement(".welcome-text-platform-selector").removeClassName("hidden")},onComplete:function(){console.log("onComplete");this.dispatchEvent("onLoadingEnd");this._onCancelPlatformName();this.dispatchEvent("onPlatformNameSaved");b.publish("PlatformManagement.renamePlatformName",this.platform.get("name"))}})});define("DS/PlatformManagementGettingStarted/View/StatusView",["UWA/Core","UWA/Class/View","DS/UIKIT/Tooltip"],function(c,b,a){return b.extend({tagName:"div",className:"content-no-overflow",setup:function(d){if(d.platform){this.platform=d.platform}if(d.model){this.model=d.model}},render:function(){this.cleanTooltips();this.container.setContent(this._createTemplate());return this},cleanTooltips:function(){if(this.tooltips&&this.tooltips.length>0){this.tooltips.invoke("destroy")}this.tooltips=[]},_createTemplate:function(){return{"class":"content-wrapper",html:{tag:"content",html:[this._createTitle(),this._createBlocks(),this.options.button?this.options.button:null,{"class":"clearfix"}]}}},_createTitle:function(){return{tag:"h3",html:[{tag:"i","class":"fonticon fonticon-"+this.model.get("icon")},{tag:"span",text:this.model.get("title")}]}},_formatNumber:function(d){if(!d){d=0}return d.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")},_createBlocks:function(){var f=this,g=[],d=this.model.get("data"),e=false;d.forEach(function(h){if(parseInt(h.get("count"),10)>=999){e=true}});d.forEach(function(i){var h=c.createElement("div",{"class":"stat"+(i.get("warn")?" warn":""),styles:{width:"calc("+(100/d.length)+"% - 10px)"},html:[{"class":"count"+(e?" small":""),text:f._formatNumber(i.get("count"))},{"class":"title",text:i.get("title")},(i.get("subtitle"))?{"class":"subtitle",text:i.get("subtitle")}:null],events:{click:function(){if(i.get("navigation")){window.parent.location.hash=window.parent.location.hash.split("tab:")[0]+"tab:"+i.get("navigation")}}}});if(i.get("tooltip")){f.tooltips.push(new a({position:"top",target:h,body:i.get("tooltip")}))}g.push(h)});return{"class":"blocks",html:g}}})});define("DS/PlatformManagementGettingStarted/View/StorageView",["UWA/Core","UWA/Class/View","DS/UIKIT/Spinner","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/i3DXCompassCore/CacheManager","DS/UIKIT/Input/Button","DS/WebappsUtils/WebappsUtils","i18n!DS/PlatformManagementGettingStarted/assets/nls/PlatformManagementGettingStarted"],function(f,a,e,b,g,h,c,j){var i=b.extend({url:"disk",parse:function(k){if(k){k.consumptionFormatted=this._bytesFormat(k.consumption);k.quotaFormatted=this._bytesFormat(k.quota)}return k},getPercentage:function(){var k=(!this.get("quota")||parseInt(this.get("quota"),10)===0||isNaN(this.get("quota")))?0:Math.round(Math.round(this.get("consumption")*100)/this.get("quota"));if(this.get("consumption")>0&&(!this.get("quota")||parseInt(this.get("quota"),10)===0||isNaN(this.get("quota")))){k=100}return k},hasError:function(){return f.is(this.get("code"))&&this.get("code")!==0},isEmpty:function(){return !f.is(this.get("quota"))},_bytesFormat:function(p){var l="",m=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],n,k,o;for(o=0;o<=m.length;o++){n=Math.pow(1000,o);k=Math.pow(1000,o+1);if(p>=n&&p<k){l=l+m[o];if(n>0){p=p/n}break}}return(Math.round(p*10)/10)+l}}),d;return a.extend({tagName:"div",className:"content-no-overflow",setup:function(k){this.model=new i();this.platform=k.platform;this.listenTo(this.model,"onChange",this._renderTemplate)},render:function(){this._renderTemplate();this.model.fetch({data:{platform:this.platform.get("id")},cacheTTL:g.LONG_LIFE_TIME,onFailure:function(k,l){if(k.isEmpty()){if(!l.code){k.set("code",1)}else{k.set(k.parse(l))}}}});return this},_renderTemplate:function(){var l=this,k="DS/MPFModalConfiguratorComponent/ModaleConfiguratorWrapper";l.container.setContent(l._createTemplate());require([k],function(m){var n=new m({platform:l.platform.getId(),product:"PGB",events:{onBuy:function(){console.log("onBuy")}}});if(n&&n.isActivated&&n.isActivated()){l._buildUpgradeStorage(n)}})},percentageStorage:function(){var k=this.model.getPercentage();if(k<80){return 0}else{if(k>90){return 1}else{return 2}}},colourPercentageStorage:function(){var k=[""," warn-full"," warn"];return k[this.percentageStorage()]},colourStorageUsed:function(){var k=[""," warn-full-storage-used"," warn-storage-used"];return k[this.percentageStorage()]},_buildUpgradeStorage:function(k){if(!this.upgradeStorage){this.upgradeStorage=f.createElement("div",{styles:{"text-align":"right"},html:""})}if(k){this.upgradeStorage.setContent(new h({value:j.get("Upgrade Storage"),icon:"shopping-cart",events:{onClick:function(){k.whenReady().then(function(){k.openModal()})}}}))}return this.upgradeStorage},_createTemplate:function(){return{"class":"content-wrapper",html:{tag:"content",html:[this._createTitle(),this._createBlocks(),this._buildUpgradeStorage(),{"class":"clearfix"}]}}},_createTitle:function(){return{tag:"h3",html:[{tag:"i","class":"fonticon fonticon-"+this.options.config.get("icon")},{tag:"span",text:this.options.config.get("title")}]}},_createBlocks:function(){var l=[],k;if(this.model.isEmpty()&&!this.model.hasError()){k=new e().show()}else{if(this.model.hasError()){k=""}else{k=f.String.format(j.get("Used: {0}"),this.model.get("consumptionFormatted"))}}return[{"class":"gauge",html:[{"class":"gauge-blue"+this.colourPercentageStorage(),styles:{width:this.model.getPercentage()+"%"},text:this.model.getPercentage()+"%"},{"class":"gauge-free",styles:{width:(100-this.model.getPercentage())+"%"}},{"class":"clearfix"}]},{"class":"storage-used"+this.colourStorageUsed(),html:k},{"class":"storage-capacity",text:this.model.isEmpty()?"":f.String.format(j.get("Total capacity: {0}"),this.model.get("quotaFormatted"))}]}})});define("DS/PlatformManagementGettingStarted/PlatformManagementGettingStarted",["UWA/Core","UWA/Class/View","UWA/Class/Model","DS/PlatformManagementGettingStarted/View/StatusView","DS/PlatformManagementGettingStarted/View/StorageView","DS/UIKIT/Input/Button","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/i3DXCompassCore/CacheManager","DS/PlatformManagementGettingStarted/View/WelcomePlatformView","DS/UIKIT/Mask","DS/PlatformManagement/Modal/InviteMember","DS/PlatformAPI/PlatformAPI","i18n!DS/PlatformManagementGettingStarted/assets/nls/PlatformManagementGettingStarted"],function(f,a,c,l,n,j,g,i,b,d,e,k,m){var h=g.extend({url:"platform/stat"});return a.extend({tagName:"div",render:function(){var u=[],q=new c({title:m.get("Members"),icon:"users",data:[new c({title:m.get("Members"),count:0,navigation:"Members"}),new c({title:m.get("Pending Invitations"),count:0,navigation:"Members",warn:false}),new c({title:m.get("Remaining Invitations"),count:0,navigation:"Members",warn:false})]}),s=new c({title:m.get("Roles"),icon:"role-key",data:[new c({title:m.get("Granted Roles"),navigation:"Members",count:0})]}),p=new c({title:m.get("Pending Requests"),icon:"bell",data:[new c({title:m.get("Requests"),count:0,navigation:"Members/notifications",warn:false})]});if(this.options.platform.get("id")!=="OnPremise"){s.get("data").push(new c({title:m.get("Roles Expire Soon"),count:0}))}var t=this;var v=new l({model:q,platform:this.options.platform}),o=new l({model:s}),r=new l({model:p});u.push(v.render());u.push(o.render());u.push(r.render());new h().fetch({data:{platform:t.options.platform.get("id")},cacheTTL:i.LONG_LIFE_TIME,onFailure:function(w,x){},onComplete:function(w){if((t.options.platform&&t.options.platform.get("crossCompany"))||w.get("remaining")>0){v.options.button={styles:{"text-align":"right"},html:new j({value:m.get("Invite Members"),icon:"user-add",events:{onClick:function(){this.modal=new e({lang:t.options.widget.lang,hasApp:true,platform:t.options.platform,widget:t.options.widget,onAdded:function(){t.render();k.publish("PlatformManagement.refresh",t.options.widget.id)}})}}})}}q.get("data")[0].set({subtitle:f.String.format(f.i18n("({0} Administrators)"),w.get("admin")),count:(w.get("member")+w.get("admin"))});q.get("data")[1].set({count:w.get("pending"),warn:w.get("pending")>0});q.get("data")[2].set({count:Math.max(w.get("remaining"),0),warn:w.get("remaining")<=0});if(t.options.platform.get("id")==="OnPremise"){s.get("data")[0].set("count",w.get("role"))}else{s.get("data")[0].set("count",w.get("role"));s.get("data")[1].set({tooltip:m.get("Only roles whose license will expire in less than 30 days"),count:w.get("expire"),warn:w.get("expire")>0})}p.get("data")[0].set({count:w.get("request"),warn:w.get("request")>0});v.render();o.render();r.render()}});if(!this.options.platform.isOnPremise()){u.push(new n({platform:this.options.platform,config:new c({title:m.get("Storage"),icon:"database"})}).render())}this.container.setContent([{"class":"body-wrap",html:[new b({platformCollection:this.options.platformCollection,platform:this.options.platform,events:{onLoadingStart:function(){console.log("onLoadingStart");d.mask(t.container)},onLoadingEnd:function(){console.log("onLoadingEnd");d.unmask(t.container)},onPlatformNameSaved:function(){console.log("onPlatformNameSaved");t.options.widget.dispatchEvent("onLoad")}}}).render(),{"class":"status-boxs",html:u}]},{"class":"footer-wrapper",html:{"class":"footer",text:this.options.platform.get("id")}}]);return this}})});define("DS/PlatformManagementGettingStarted/Widgets/PlatformManagementGettingStartedWdg",["UWA/Core","UWA/Class","DS/UIKIT/Mask","DS/i3DXCompassCore/RequestOptions","DS/PlatformManagementComponents/Collection/Platform","DS/i3DXCompassCore/Model/PlatformModel","DS/PlatformManagement/Utils","DS/W3DXComponents/Views/Layout/ScrollView","DS/PlatformManagementGettingStarted/PlatformManagementGettingStarted","DS/PlatformManagement/Model/I18nModel","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/PlatformManagementGettingStarted/assets/nls/PlatformManagementGettingStarted","css!DS/PlatformManagementGettingStarted/PlatformManagementGettingStarted","css!DS/PlatformManagement/PlatformManagement"],function(g,b,f,i,e,m,k,h,d,a,l,c){var j="en";return b.extend({widget:null,init:function(n){this.widget=n.widget;this.platform=n.platform;i.setupLanguage(this.widget.lang);k.setWidget(this.widget);this._initWidgetEvents()},_initWidgetEvents:function(){var n=this,o=n.widget;o.addEvents({onLoad:n._onBeforeLoad.bind(n)})},_onBeforeLoad:function(){var n=this;if(this.widget.lang!==j){new a().fetch({onComplete:function(p,o){g.i18n(o);n._initWidgetPreferences()},onFailure:function(){n._initWidgetPreferences()}})}else{n._initWidgetPreferences()}},_initWidgetPreferences:function(){var n=this,o=n.widget;f.mask(o.body);this.collection=new e({includeWu:false,lang:this.widget.lang});c.getAppInfo({appId:"X3DOPMR_AP",onComplete:function(p){n.collection.set(p.platforms);n._getCurrentPlatform().fetch({data:{id:n._getCurrentPlatform().get("id")},onComplete:function(q,s){var r=n.collection.get(n._getCurrentPlatform().get("id"));if(r){r.set(s)}n._onLoad()}})}})},_getCurrentPlatform:function(){var o=this.widget.getValue("x3dPlatformId")||localStorage.getItem("platform-manager-id"),n;if(o&&o!==""){n=this.collection.get(o)}if(!this.platform){this.platform=n?new m(n.toJSON()):new m(this.collection.first().toJSON())}if(!o&&o!==""){l.publish("platform:tenant",{tenantId:this.platform.get("id"),silent:true})}return this.platform},_onLoad:function(){var q=this,p=this.widget.id,o=this.widget.body,n=this._getCurrentPlatform();this.widget.setTitle(n.get("name"));f.unmask(o);o.setContent(g.createElement("div",{"class":"getting-started",html:new h({useInfiniteScroll:false,usePullToRefresh:false,view:new d({widget:this.widget,platformCollection:this.collection,platform:n})}).render()}));l.subscribe("PlatformManagement.refresh",function(r){if(r!==p){q._onLoad()}})}})});