define("DS/WAfrUIComponents/Viewer",["UWA/Core","DS/Visualization/WebGLV6Viewer","DS/Visualization/SceneGraph","DS/Visualization/Viewpoint","DS/Visualization/ModelLoader","DS/Visualization/SceneGraphTree","DS/CoreEvents/ModelEvents","DS/WAfrUIStandardComponents/UIFrame"],function(k,l,a,h,b,i,d,g){var e="EVT_VIEWER_MODEL_LOADED";var c="EVT_VIEWER_LOADED";var f={pathViewer:null,antiAliasing:"SMAA",useShadowMap:false,infinitePlane:true,displayGrid:true,useVignetting:false,ssao:false,dof:false,deferred:false,debugShadowLight:false,debugBSphere:false,debugBBox:false,onModelLoaded:null,displayTree:false};var j=function(m){this.options=k.extend(k.clone(f),m);this._modelEvents=new d();this._viewerBuilt=false};j.prototype.init3dViewer=function(){var m=this;m._3dViewer.setRenderMode("@Edge",true);m._3dViewer.setPicking({activated:true,displayHL:true,gpu:true,computeNormalDepth:true,primitive:false});m._3dViewer.setPrePicking({activated:false,displayHL:true,gpu:true,computeNormalDepth:false,primitive:false});if(!window.undoSceneGraphMigration){m._private_sceneGraph=m._3dViewer.getRootNode()}else{m._private_sceneGraph=new a("I solemnly swear that I am up to no good.");m._3dViewer.attachScene(m._private_sceneGraph)}m._viewpoint=new h({viewer:m._3dViewer});m._viewpoint.onMove(m._3dViewer.render);m._3dViewer.addViewpoint(m._viewpoint);m._3dViewer.setVisuEnv("V6");m._modelLoader=new b();m._modelLoader.setSceneGraph(m._private_sceneGraph);m._modelLoader.setRenderCallback(m._3dViewer.render);m._modelLoader.setOnLoadedCallback(function(){if(!m.options.onModelLoaded){m._viewpoint.reframe()}else{m.options.onModelLoaded.call(m)}m._modelEvents.publish({event:e,data:m})})};j.prototype._init=function(){var r=this;r.init3dViewer();var o=0;var t=0;var s=this.getExecutionContext();if(s){var p=null;var m=s.getComponent(g.DEFAULT_COMPONENT_NAME);var p=m.getViewerLayout();r._3dViewer.inject(p);r._sceneGraphTree=new i(UWA.extendElement(r._3dViewer.div),r._3dViewer);r._sceneGraphTree.setSceneGraph(r._private_sceneGraph);if(r.options.displayTree){r._sceneGraphTree.tree.show()}else{r._sceneGraphTree.tree.hide()}r._sceneGraphTree.tree.getContent().setStyles({height:"auto",position:"absolute",left:0,top:0,bottom:81});m.addLayer(r._sceneGraphTree.tree.getContent(),{height:"auto",position:"absolute",left:0,top:0,bottom:t});var q="Visu"+r._3dViewer.getVisuEnv()+"Env";var n={VisuNoEnv:"light",VisuNoneEnv:"light",VisuV6Env:"light",VisuCleanSpaceEnv:"light",VisuDarkBlueEnv:"dark",VisuDarkGreyEnv:"dark",VisuShinyEnv:"dark"};m.addRootClassName("wux-ui-ambiance-"+n[q]);r._modelEvents.publish({event:c,context:r});this._viewerBuilt=true}};j.prototype.initialize=function(){if(this._viewerBuilt){return UWA.Class.Promise.resolve()}var m=this;var n=this.options.pathViewer;return new UWA.Class.Promise(function(p,o){if(!n){m._3dViewer=new l(m.options);m._init();p();return}try{require([n],function(r){m._3dViewer=new r(m.options);m._init();p()})}catch(q){o(q)}});return UWA.Class.Promise.resolve()};j.prototype.onViewerModelLoaded=function(m){return this._modelEvents.subscribe({event:e},m)};j.prototype.onViewerLoaded=function(m){return this._modelEvents.subscribe({event:c},m)};j.prototype.get3DViewer=function(){return this._3dViewer};j.prototype.getModelLoader=function(){return this._modelLoader};j.prototype.destroy=function(){this._modelLoader.abort();this._modelLoader=null;this._3dViewer.dispose();return UWA.Class.Promise.resolve()};return j});