(function(b){var a=false;b.onmessage=function(c){require(["DS/Mesh/Mesh","DS/EasySax/EasySax","DS/Formats/CGRFile"],function(o,A,s){a=true;var E=c.data.xmlData;var F=c.data.loadingIndex;var k=c.data.ctxTypes&&c.data.ctxTypes.length?c.data.ctxTypes:null;var y;var w;var f;var p=0;var g,e;var n;function r(I){return I?parseFloat(I.replace?I.replace(",","."):I):undefined}function v(J){var I=J;if(I.indexOf("&amp;")!==-1){I=I.replace(/&amp;/g,"&")}if(I.indexOf("&gt;")!==-1){I=I.replace(/&gt;/g,">")}if(I.indexOf("&lt;")!==-1){I=I.replace(/&lt;/g,"<")}if(I.indexOf("&quot;")!==-1){I=I.replace(/&quot;/g,'"')}return I}var C=function(O,M,K){var J=[];var I=O.split(" ");for(var L=0;L<I.length;L++){if(I[L]!==" "&&I[L]!==""){var N=!K?r(I[L]):I[L];if(N!==undefined&&(!M||M&&J.indexOf(N)===-1)){J.push(N)}}}return J};var u=function(K,O){var L=[];var I=":";var N=O.indexOf(I);if(N!==-1){var M=O.substring(N+I.length,O.length);var J=M.split(I);if(J.length){for(var Q=0;Q<J.length;Q++){var P=parseInt(J[Q],10);if(P!==undefined&&P!==null){L.push(P)}}}}if(L.length!==0){K.associatedBasicDims=L}};var l=function(M,O){var I;var L=0;var N="^";I=O.indexOf(N,L);if(I!==-1){L=I+N.length;I=O.indexOf(N,L);if(I!==-1){L=I+N.length;I=O.indexOf(N,L);if(I!==-1){L=I+N.length}I=O.indexOf(N,L);if(I!==-1){L=I+N.length}}}N=";";M.dimensionLimits={min:null,max:null};I=O.indexOf(N,L);M.dimensionLimits.min=r(O.substring(L,I));L=I+N.length;I=O.indexOf(N,L);M.dimensionLimits.max=r(O.substring(L,I));L=I+N.length;I=O.indexOf(N,L);if(I!==-1){M.nominalValue=O.substring(L,I);L=I+N.length;N="!";I=O.indexOf(N,L);if(I!==-1){M.tabLimit=O.substring(L,I!==-1?I:O.length)}else{I=O.indexOf("#x&amp;",L);M.tabLimit=O.substring(L,I!==-1?I:O.length)}}else{N="#";I=O.indexOf(N,L);if(I!==-1&&O.indexOf("#x&amp;",L)===-1){I=O.indexOf(N,L);M.nominalValue=O.substring(L,I);L=I+N.length;I=O.indexOf(N,L);var K={};if(I!==-1){K.name=O.substring(L,I);L=I+N.length;N=";";I=O.indexOf(N,L);if(I===-1){I=O.length}}else{N="#x&amp;$)";I=O.indexOf(N,L);if(I!==-1){K.name=O.substring(L,I)}else{N=";";K.name=O.substring(L,I)}L=I+N.length}if(K.name){var J=O.substring(L,I);I=J.indexOf("!",0);if(J&&I!==-1){K.variation=J.substring(0,I)}else{K.variation=J}M.genTol=K}}else{N="!";I=O.indexOf(N,L);if(I!==-1){M.nominalValue=O.substring(L,I);L=I+N.length;N="#x&amp;$)"}else{N="#x&amp;$)"}}}};var m=function(M,P){var N="^";var K,O;var L=0;var J=[];if(M.type===5){K=P.indexOf(N,L);if(K!==-1){L=K+N.length}K=P.indexOf(N,L);if(K!==-1){L=K+N.length}N=";";var I=P.indexOf(N,L);while(I!==-1){L=I+N.length;I=P.indexOf(N,L);if(I!==-1){O=parseInt(P.substring(L,I),10)}else{O=parseInt(P.substring(L,P.length),10)}if(O){J.push(O)}}}else{if(M.type===6){K=P.indexOf(N,L);if(K!==-1){L=K+N.length;K=P.indexOf(N,L);if(K!==-1){L=K+N.length;K=P.indexOf(N,L);if(K!==-1){L=K+N.length}}}N="#x&amp;$)";K=P.indexOf(N,L);if(K!==-1){O=parseInt(P.substring(L,K),10)}else{O=parseInt(P.substring(L,P.length),10)}if(O){J.push(O)}}}if(J.length){M.datumTargets=J}};var D=function(M,Q){var I="^";var N=0;var O=Q.indexOf(I,N);I="@#";O=Q.indexOf(I,0);if(O!==-1){var L=Q.split(I);if(L.length){if(O!==0){L.splice(0,1)}M.toleranceZoneValue=r(L[10])}}I=";";O=Q.indexOf("!",N);if(O!==-1){var P=Q.indexOf(":",N);N=O+I.length;O=Q.indexOf(I,N);var K,J;K=r(Q.substring(N,O));N=O+I.length;O=Q.indexOf(I,N);if(P!==-1){J=r(Q.substring(N,P))}else{O=Q.indexOf("#x&amp;$)",N);if(O!==-1){J=r(Q.substring(N,O))}else{J=r(Q.substring(N,Q.length))}}M.toleranceUnitBasis={val1:K,val2:J}}};var B=function(M,T){var P,Q,K;var N=0;var J="#x&amp;",L=";";var U={};var S;var W;var V;if(M.type===1||M.type===2||M.type===30){P=T.indexOf(J,N);if(P!==-1){N=P+J.length}P=T.indexOf(J,N);if(P!==-1){V=T.substring(0,P);S=T.substring(N,P);U.hiddenText=S?S:undefined;N=P+J.length}P=T.indexOf(J,N);var R=[];while(P!==-1){if(!V){V=T.substring(0,P)}S=T.substring(N,P);if(S){if(M.type===30){Q=S.indexOf(L,0);if(Q===-1){R.push({address:S})}}else{R.push({address:S})}}N=P+J.length;P=T.indexOf(J,N)}if(P===-1&&N!==0){if(!V){V=T.substring(0,N)}S=T.substring(N,T.length);if(S&&M.type===30){Q=S.indexOf(L,0);if(Q===-1){R.push({address:S})}}else{if(S){R.push({address:S})}}}if(R.length){U.urls=R}}else{var I=[];var X="";P=T.indexOf("#x&amp;$)");if(P!==-1){if(!V){V=T.substring(0,P)}K=T.split("amp;$)");if(K.length){var O=K[1].split("#x&amp;");X=O[0];if(O.length>1){for(W=1;W<O.length;W++){I.push({address:O[W]})}}}}else{P=T.indexOf("#x&amp;");if(P!==-1){if(!V){V=T.substring(0,P)}K=T.split("#x&amp;");if(K.length>1){for(W=1;W<K.length;W++){I.push({address:K[W]})}}}}if(X||(I&&I.length)){U={urls:I.length>0?I:undefined,hiddenText:X!==""?X:undefined}}}if(M.hyperlinksData&&M.hyperlinksData.length){return V?V:T}if(U.hiddenText||(U.urls&&U.urls.length)){M.hyperlinksData=[];if(U.hiddenText){M.hyperlinksData.push({type:-1,text:U.hiddenText})}if(U.urls&&U.urls.length){for(W=0;W<U.urls.length;W++){M.hyperlinksData.push({type:0,address:U.urls[W].address})}}}return V?V:T};var j=function(K){var I=K.attributes;delete K.attributes;if(!I){return}I=B(K,I);var J=K.type;if(J!==0&&J!==1&&J!==2&&J!==30){if(J===12||J===13||J===14||J===15||J===37||J===38||J===34){l(K,I)}else{if(J===5||J===6||J===33){m(K,I)}else{if(J===7||J===8||J===9||J===10||J===11||J===17||J===18||J===19||J===20||J===21||J===22||J===23||J===24||J===25||J===26||J===27||J===28){D(K,I)}}}u(K,I)}};var G=function(J){var K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function M(S,R){var O=K.indexOf(S.charAt(S.length-1));var N=K.indexOf(S.charAt(S.length-2));var ab=(S.length/4)*3;if(O===64){ab--}if(N===64){ab--}var P;var aa,Y,W;var Z,X,V,T;var U=0;var Q=0;if(R){P=new Uint8Array(R)}else{P=new Uint8Array(ab)}S=S.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(U=0;U<ab;U+=3){Z=K.indexOf(S.charAt(Q++));X=K.indexOf(S.charAt(Q++));V=K.indexOf(S.charAt(Q++));T=K.indexOf(S.charAt(Q++));aa=(Z<<2)|(X>>4);Y=((X&15)<<4)|(V>>2);W=((V&3)<<6)|T;P[U]=aa;if(V!==64){P[U+1]=Y}if(T!==64){P[U+2]=W}}return P}var I=(J.length/4)*3;var L=new ArrayBuffer(I);M(J,L);return L};var z=function(K){var J=G(K);var I=y.openSceneGraph(new Uint8Array(J),function(){});return I&&I.reps?I:undefined};var i=function(){E=null;F=null;a=false;y=null;w=null;f=null;k=null;g=null;e=null;p=0};var d=function(I){if(a){if(I.done){I.hasTesseletedTextReps=e?g:true;i()}b.postMessage(I)}};var x=function(){d({done:true,loadingIndex:F,loadingPartiallyFailed:true});a=false};var h=function(Z,R){if(!a){return}var Q=R();if(Q===false){x()}n=false;switch(Z){case"Functional_Tolerancing_Annotation":f.push({name:Z,node:{}});break;case"AnnotationSet":p++;var Y={nodeXMLtype:Z};if(Q.ContextType){Y.contextType=r(Q.ContextType)}if(Q.Standard){Y.standard=Q.Standard}if(k&&k.indexOf(Y.contextType)===-1){d({node:Y,done:true,loadingIndex:F,loadingCancelled:true,annotSetID:p})}else{f.push({name:Z,node:Y})}break;case"RootTTRSs":f.push({name:Z,node:{nodeXMLtype:Z}});break;case"RefFrame":f.push({name:Z,node:{nodeXMLtype:Z}});break;case"TPSView":f.push({name:Z,node:{nodeXMLtype:Z}});break;case"TPS":e=true;var V={nodeXMLtype:Z};if(Q.Att){V.attributes=Q.Att}if(Q.Ref){V.ref=r(Q.Ref)}if(Q.Val){V.val=r(Q.Val)}if(Q.Def){V.def=r(Q.Def)}f.push({name:Z,node:V});break;case"TPSCap":var M={nodeXMLtype:Z};f.push({name:Z,node:M});if(Q.Att){M.attributes=Q.Att}if(Q.ActVieSt==="1"&&Q.ActVie){M.view=r(Q.ActVie)}if(Q.RepMngt){M.RepMngt=r(Q.RepMngt)}if(Q.InstMngt){M.InstMngt=r(Q.InstMngt)}if(Q.ClipPla){M.ClipPla=r(Q.ClipPla)}if(Q.FavCtxMngt){M.FavCtxMngt=r(Q.FavCtxMngt)}if(Q.FeatureVersion){M.FeatureVersion=r(Q.FeatureVersion)}break;case"TPSCG":var L={nodeXMLtype:Z};f.push({name:Z,node:L});if(Q.Att){L.attributes=Q.Att}break;case"TPSAttribute":var K={nodeXMLtype:Z};f.push({name:Z,node:K});if(Q.Categ){K.category=Q.Categ}if(Q.AttrType){var J=Q.AttrType.split(".");if(J&&J.length===2){K.attrType=parseFloat(J[1])}else{K.attrType=parseFloat(Q.AttrType)}}break;case"TPSAttributes":var U={nodeXMLtype:Z};f.push({name:Z,node:U});if(Q.Categ){U.category=Q.Categ}break;case"Rep":if(Q.Type==="2"){f.push({name:"Rep2D",node:f[f.length-1].node})}else{if(Q.Type==="3"){f.push({name:"Rep",node:f[f.length-1].node})}else{if(Q.Type==="4"){f.push({name:"CappingRep",node:f[f.length-1].node})}}}break;case"Buf":if(f[f.length-1].name==="Rep"){f.push({name:Z,node:f[f.length-1].node})}break;case"AlternativeTextBuf":if(f[f.length-1].name==="Rep"){g=true;f.push({name:Z,node:f[f.length-1].node})}break;case"TPSId":if(Q.Name){f[f.length-1].node.name=v(Q.Name)}if(Q.Att){f[f.length-1].node.attributes=Q.Att}if(Q.Uuid){f[f.length-1].node.uuid=Q.Uuid}break;case"TPSLoc":if(Q.Status){f[f.length-1].node.status=r(Q.Status)}if(Q.Id){f[f.length-1].node.tpsID=r(Q.Id)}if(Q.Type){f[f.length-1].node.type=r(Q.Type)}break;case"Standard":if(!f[f.length-1].node.standards){f[f.length-1].node.standards=[]}var X={};if(Q.Title){X.title=v(Q.Title)}if(Q.Year){X.year=v(Q.Year)}if(Q.Code){X.code=v(Q.Code)}f[f.length-1].node.standards.push(X);break;case"DefaultSpec":if(!f[f.length-1].node.standardNorms){f[f.length-1].node.standardNorms=[]}var W={};if(Q.Type){W.type=v(Q.Type)}if(Q.SubType){W.subtype=v(Q.SubType)}if(Q.Code){W.code=v(Q.Code)}if(Q.Year){W.year=v(Q.Year)}f[f.length-1].node.standardNorms.push(W);break;case"Symbol":var T=f[f.length-1].node.standardNorms;if(!T[T.length-1].symbols){T[T.length-1].symbols=[]}var S;if(Q.Name){S=Q.Name}f[f.length-1].node.standardNorms[f[f.length-1].node.standardNorms.length-1].symbols.push(S);break;case"Value":n=true;break;case"Hyperlink":if(!f[f.length-1].node.hyperlinksData){f[f.length-1].node.hyperlinksData=[]}var N={};if(Q.AnchorText){N.anchorText=Q.AnchorText}if(Q.Address){N.address=Q.Address}if(Q.Type){N.type=r(Q.Type)}if(Q.AddressRelId){N.addressRelId=Q.AddressRelId}f[f.length-1].node.hyperlinksData.push(N);break;case"HiddenText":if(!f[f.length-1].node.hyperlinksData){f[f.length-1].node.hyperlinksData=[]}var I={type:-1};if(Q.Text){I.text=v(Q.Text)}f[f.length-1].node.hyperlinksData.push(I);break;case"Failure":if(!f[f.length-1].node.failureModes){f[f.length-1].node.failureModes=[]}var P={};if(Q.Criticity!==null&&Q.Criticity!==undefined){P.crit=Q.Criticity}f[f.length-1].node.failureModes.push(P);break;case"Description":f.push({name:Z,node:f[f.length-1].node});break;case"TPSs":f.push({name:Z,node:f[f.length-1].node});break;case"Thumbnail":f.push({name:Z,node:f[f.length-1].node});break;case"Datum":f.push({name:Z,node:f[f.length-1].node});break;case"Views":f.push({name:Z,node:f[f.length-1].node});break;case"Caps":f.push({name:Z,node:f[f.length-1].node});break;case"CGs":f.push({name:Z,node:f[f.length-1].node});break;case"HiddenBodyInst":f.push({name:Z,node:f[f.length-1].node});break;case"VisibleBodyInst":f.push({name:Z,node:f[f.length-1].node});break;case"VisibleCompRelId":f.push({name:Z,node:f[f.length-1].node});break;case"VisibleCompXmlId":if(!f[f.length-1].node[Z]){f[f.length-1].node[Z]=[]}f[f.length-1].node[Z].push([]);f.push({name:Z,node:f[f.length-1].node});break;case"Cam":f[f.length-1].node.camera={};f[f.length-1].node.camera.angle=r(Q.Angle);f[f.length-1].node.camera.mode=Q.Mode;f[f.length-1].node.camera.type=Q.Type;f[f.length-1].node.camera.zoom=r(Q.Zoom);f.push({name:Z,node:f[f.length-1].node});break;case"Po":f.push({name:Z,node:f[f.length-1].node});break;case"Di":f.push({name:Z,node:f[f.length-1].node});break;case"Ze":f.push({name:Z,node:f[f.length-1].node});break;case"Ta":f.push({name:Z,node:f[f.length-1].node});break;case"Math":f[f.length-1].node.planeInfos={};f.push({name:Z,node:f[f.length-1].node});break;case"Or":f.push({name:Z,node:f[f.length-1].node});break;case"No":f.push({name:Z,node:f[f.length-1].node});break;case"MultiClipping":f[f.length-1].node.multiClipping={};f[f.length-1].node.multiClipping.inverted=r(Q.Inverted);f.push({name:Z,node:f[f.length-1].node});break;case"SketchOrigin":f.push({name:Z,node:f[f.length-1].node});break;case"SketchNormal":f.push({name:Z,node:f[f.length-1].node});break;case"Point":f.push({name:Z,node:f[f.length-1].node});break;case"PointsDef":f[f.length-1].node.multiClipping.pointsDef=[];f.push({name:Z,node:f[f.length-1].node});break;case"ReframeArea":f[f.length-1].node.reframeArea={cornerX:r(Q.CornerX),cornerY:r(Q.CornerY),width:r(Q.Width),length:r(Q.Length)};break;case"TTRS":if(f[f.length-1].name==="RootTTRSs"){f.push({name:Z,node:{nodeXMLtype:Z}})}else{f.push({name:Z,node:f[f.length-1].node})}break;case"GeoP":f.push({name:Z,node:f[f.length-1].node});break;case"TRep":f.push({name:Z,node:f[f.length-1].node});break;case"Grou":f.push({name:Z,node:f[f.length-1].node});break;case"OccId":f.push({name:Z,node:f[f.length-1].node});break;case"Param":if(!f[f.length-1].node.params){f[f.length-1].node.params=[]}var O={};if(Q.Name){O.Name=Q.Name}if(Q.Value){O.Value=Q.Value}if(Q.Magnitude){O.Magnitude=Q.Magnitude}f[f.length-1].node.params.push(O);f.push({name:Z,node:f[f.length-1].node});break}};var t=function(W,Q){if(!a){return}if(n){if(!f[f.length-1].node.standardNorms[f[f.length-1].node.standardNorms.length-1].symbols){f[f.length-1].node.standardNorms[f[f.length-1].node.standardNorms.length-1].symbols=[]}var P=v(Q(W));f[f.length-1].node.standardNorms[f[f.length-1].node.standardNorms.length-1].symbols.push(P);return}if(f.length){var L=f[f.length-1].name;var N=f[f.length-1].node;var T,M,J,S;switch(L){case"Buf":T=z(Q(W));if(T){if(!N.reps){N.reps=[]}N.reps.push(T)}break;case"AlternativeTextBuf":T=z(Q(W));if(T){if(!N.reps){N.reps=[]}N.reps.push(T)}break;case"Rep2D":break;case"CappingRep":T=z(Q(W));if(T){N.cappingRep=T}break;case"Thumbnail":var I=Q(W);if(I){N.thumbnail=I}break;case"Caps":M=C(Q(W),true);if(M.length){N[L]=M}break;case"CGs":M=C(Q(W),true);if(M.length){N[L]=M}break;case"TPSs":M=C(Q(W),true);if(M.length){N[L]=M}break;case"HiddenBodyInst":J=C(Q(W),true);if(J.length){if(!N[L]){N[L]=[]}N[L].push(J)}break;case"VisibleBodyInst":J=C(Q(W),true);if(J.length){if(!N[L]){N[L]=[]}N[L].push(J)}break;case"VisibleCompRelId":var K=C(Q(W),true,true);if(K.length===1){if(!N[L]){N[L]=[]}N[L].push(K[0])}break;case"OccId":var O=C(Q(W),true,true);if(O.length===1&&N.VisibleCompXmlId){N.VisibleCompXmlId[N.VisibleCompXmlId.length-1].push(O[0].split("#")[1])}break;case"Po":if(N.camera){S=C(Q(W),false);N.camera.position={x:S[0],y:S[1],z:S[2]}}break;case"Di":if(N.camera){S=C(Q(W),false);N.camera.direction={x:S[0],y:S[1],z:S[2]}}else{if(N.planeInfos){S=C(Q(W),false);N.planeInfos.direction={x:S[0],y:S[1],z:S[2]}}}break;case"Ze":if(N.camera){S=C(Q(W),false);N.camera.zenith={x:S[0],y:S[1],z:S[2]}}break;case"Ta":if(N.camera){S=C(Q(W),false);N.camera.target={x:S[0],y:S[1],z:S[2]}}break;case"Or":if(N.planeInfos){S=C(Q(W),false);N.planeInfos.origin={x:S[0],y:S[1],z:S[2]}}break;case"No":if(N.planeInfos){S=C(Q(W),false);N.planeInfos.normal={x:S[0],y:S[1],z:S[2]}}break;case"Views":M=C(Q(W),true);if(M.length&&f[f.length-2].name==="MultiClipping"){N.multiClipping.views=M}else{if(M.length){N[L]=M}}break;case"Point":if(f[f.length-2].name==="PointsDef"){S=C(Q(W),false);if(S&&S.length===3){N.multiClipping.pointsDef.push({x:S[0],y:S[1],z:S[2]})}}break;case"SketchNormal":if(f[f.length-2].name==="MultiClipping"){S=C(Q(W),false);if(S){N.multiClipping[L]={x:S[0],y:S[1],z:S[2]}}}break;case"SketchOrigin":if(f[f.length-2].name==="MultiClipping"){S=C(Q(W),false);if(S){N.multiClipping[L]={x:S[0],y:S[1],z:S[2]}}}break;case"TTRS":var V=f[f.length-2].name;if(V==="TPSCG"||V==="TPS"||V==="TPSAttribute"){N.ttrs=C(Q(W),true)}break;case"TRep":N.trep=C(Q(W),true);break;case"GeoP":var R=C(Q(W),false);if(R.length){if(!N[L]){N[L]=[]}N[L].push(R)}break;case"Datum":N.datums=C(Q(W),true);break;case"Grou":N.grou=C(Q(W),true);break;case"Param":N.params=Q(W);break;case"Description":if(N.failureModes&&N.failureModes.length){var U=N.failureModes[N.failureModes.length-1];if(!U.descriptions){U.descriptions=[]}U.descriptions.push(v(Q(W)))}break}}};var q=function(J){if(!a){return}if(f.length){var K=f[f.length-1].name;var I=f[f.length-1].node;if(K===J){switch(J){case"TPS":j(I);d({node:I,done:false,loadingIndex:F,annotSetID:p});f.pop();break;case"TPSView":j(I);d({node:I,done:false,loadingIndex:F,annotSetID:p});f.pop();break;case"TPSCap":j(I);d({node:I,done:false,loadingIndex:F,annotSetID:p});f.pop();break;case"TPSCG":j(I);d({node:I,done:false,loadingIndex:F,annotSetID:p});f.pop();break;case"TPSAttribute":if(f[f.length-2].name==="TPSAttribute"||f[f.length-2].name==="TPSAttributes"){if(!f[f.length-2].node.childrenAttr){f[f.length-2].node.childrenAttr=[]}f[f.length-2].node.childrenAttr.push(I)}else{d({node:I,done:false,loadingIndex:F,annotSetID:p})}f.pop();break;case"TPSAttributes":d({node:I,done:false,loadingIndex:F,annotSetID:p});f.pop();break;case"RefFrame":d({node:I,done:false,loadingIndex:F,annotSetID:p});f.pop();break;case"TTRS":if(f[f.length-2].name==="RootTTRSs"){d({node:I,done:false,loadingIndex:F,annotSetID:p})}f.pop();break;case"AnnotationSet":j(I);d({node:I,done:false,loadingIndex:F,annotSetID:p});f.pop();break;case"Functional_Tolerancing_Annotation":f.pop();d({node:I,done:true,loadingIndex:F});a=false;break;default:f.pop();break}}else{if((K==="CappingRep"||K==="Rep2D")&&J==="Rep"){f.pop()}}}};var H=function(I){f=[];if(!w){w=new A()}if(!y){y=new s(undefined,undefined,undefined,true)}w.on("startNode",h);w.on("textNode",t);w.on("endNode",q);w.on("error",x);w.parse(I)};H(E)})}})(this);