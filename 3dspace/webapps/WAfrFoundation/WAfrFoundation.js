define("DS/WAfrModelEvents/mod_ModelEvents",["UWA/Core","DS/CoreEvents/ModelEvents"],function(c,b){var a=function(){this._modelEvents=new b();this._applicativeModelEvents=new b()};a.DEFAULT_COMPONENT_NAME="AFR_ModelEvents";a.prototype.initialize=function(){var e=this.getExecutionContext();if(e){var d=this;["onWillLoadApp","onDidLoadApp","onDidFailToLoadApp","onDidContextualComponentsUpdate"].forEach(function(f){e[f]=function(g){d.publish({event:f,scope:"ALL",data:g})}})}return c.Class.Promise.resolve()};a.prototype.subscribe=function(d,e){return this._modelEvents.subscribe(d,e)};a.prototype.subscribeOnce=function(d,e){this._modelEvents.subscribeOnce(d,e)};a.prototype.unsubscribe=function(d){this._modelEvents.unsubscribe(d)};a.prototype.unsubscribeAll=function(d){this._modelEvents.unsubscribeAll(d)};a.prototype.publish=function(d){if(d.scope==="ALL"){this._modelEvents.publish(d);this._applicativeModelEvents.publish(d);return}this._modelEvents.publish(d)};a.prototype.destroy=function(){this._modelEvents.destroy();this._applicativeModelEvents.destroy();return c.Class.Promise.resolve()};a.prototype.createExposedComponent=function(){return{subscribe:this._applicativeModelEvents.subscribe.bind(this._applicativeModelEvents),subscribeOnce:this._applicativeModelEvents.subscribeOnce.bind(this._applicativeModelEvents),unsubscribe:this._applicativeModelEvents.unsubscribe.bind(this._applicativeModelEvents),unsubscribeAll:this._applicativeModelEvents.unsubscribeAll.bind(this._applicativeModelEvents),publish:this._applicativeModelEvents.publish.bind(this._applicativeModelEvents)}};return a});define("DS/WAfrUtils/Logger",[],function(){var b=Object.create(null);var a=false;b.log=function(c){if(a){console.log("[AfrContainer]"+c)}};b.warn=function(c){if(a){console.warn("[AfrContainer]"+c)}};b.severe=function(c){if(a){console.error("[AfrContainer]"+c)}};return b});define("DS/WAfrHandlers/private/private_Utilities",[],function(){var a=Object.create(null);a.enums=Object.create(null);a.enums.HandlerType={};a.inherit=function(d,c){d.prototype=Object.create(c.prototype,{constructor:{value:d,enumerable:false}})};a.executeHandlerFunctions=[];a.registerLeafHandler=function b(g,e){var d=a.enums.HandlerType;if(d.hasOwnProperty(g)){throw new Error("There already are a handler registered using the same handlerId",g)}if(!e||!e.executeFunc){throw new Error("Missing parameters")}var c=-1;for(var f in d){if(d.hasOwnProperty(f)){c=c>d[f]?c:d[f]}}++c;d[g]=c;a.executeHandlerFunctions[c]=e.executeFunc};a.publishHandlerAvailability=function(e){var d=e.getHandlerComponent();if(!d){throw new Error("There is no HandlerComponent related to this Handler",e)}var c=d.getEventChannel();if(!c){throw new Error("Retrieved eventChannel is undefined")}var f=e.getId();if(!f){throw new Error("handlerIdentfier has to be a non empty string.")}setTimeout(function(){c.publish({event:f+"/AVAILABILITY",data:{newValue:e.isAvailable()}})},0)};a.computeArgs=function(e,c){var d=e.getArgs();if(c&&d){for(var f in d){if(d.hasOwnProperty(f)&&!c.hasOwnProperty(f)){c[f]=d[f]}}}else{if(d){c=d}}return c};return a});define("DS/WAfrExecutionContext/mod_Component",["UWA/Core"],function(g){var b=Object.create(null);var c=function(){};b.Component=c;function f(i,h){if(typeof h!=="object"){throw new Error("target obj to update must be an object")}var j;j=i.prototype;Object.keys(j).forEach(function(k){if(!h.hasOwnProperty(k)){Object.defineProperty(h,k,Object.getOwnPropertyDescriptor(j,k))}})}function e(h,j){if(typeof j!=="function"){throw new Error("parameters must be constructors (i.e. functions)")}var i;i=j.prototype;f(h,i)}c.implementsBy=function(h){e(c,h)};c.mixinProperties=function(h){f(c,h)};c.prototype.getExecutionContext=function(){return this._private._executionContext};c.prototype.setExecutionContext=function(h){this._private=this._private||Object.create(null);this._private._executionContext=h};c.prototype.getRegisteredIdentifier=function(){return this._private._identifier};c.prototype.setRegisteredIdentifier=function(h){this._private=this._private||Object.create(null);this._private._identifier=h};c.prototype.initialize=function(){return g.Class.Promise.resolve()};c.prototype.clean=function(){return g.Class.Promise.resolve()};c.prototype.destroy=function(){return g.Class.Promise.resolve()};c.prototype.canBeParallelized=function(){return true};var d=function(){};b.StandardComponent=d;c.implementsBy(d);d.implementsBy=function(h){e(d,h)};d.prototype.configure=function(){return g.Class.Promise.resolve()};d.prototype.getExposedComponentCtor=function(){return null};d.prototype.getExposedComponent=function(){return this._private?this._private._publicComponent:null};d.prototype.setExposedComponent=function(h){this._private=this._private||Object.create(null);this._private._publicComponent=h};d.prototype.generateInterpreter=function(h){return null};d.prototype.getCurrentInterpreter=function(){return this._private._currentInterpreter};d.prototype.setCurrentInterpreter=function(h){this._private=this._private||Object.create(null);this._private._currentInterpreter=h};var a=function(){};b.Interpreter=a;a.prototype.interpret=function(i,h){throw new Error("Not implemented")};a.prototype.commit=function(h,i){throw new Error("Not implemented")};return b});define("DS/WAfrHandlers/mod_Handler",[],function(){function b(c){if(!this._private){this._private=Object.create(null)}this._private._currentAvailability=true;if(c){if(!c.id){throw new Error("Missing parameter. id has to be defined.")}this._private._id=c.id;if(c.i18n){this._private._i18n=c.i18n}}else{throw new Error("Missing parameters. Please see the Handler documentation to see the required parameters.")}}b.prototype.getId=function(){return this._private._id};b.prototype.setI18n=function(c){if(!c||!c.title||!c.shortHelpImage||!c.shortHelpImage.uri||!c.longHelpImage||!c.longHelpImage.uri){throw new Error("One or many parameters are missing.")}if(c){this._private._i18n=c}};b.prototype.getI18n=function(){return this._private._i18n};b.prototype.beingInitialized=function(){var c=false;var d=this.getHandlerComponent();if(d&&d.getInitializedState()){c=true}return c};b.prototype.getHandlerComponent=function(){throw new Error("getHandlerComponent has to be implemented on subclasses.")};b.prototype.onAvailabilityChanged=function(){throw new Error("onAvailabilityChanged has to be implemented on subclasses")};b.prototype.onAvailabilityEvent=function(c){if(!c||typeof c!=="function"){throw new Error("cb has to be a function",c)}var e=this.getHandlerComponent();if(!e){throw new Error("There is no HandlerComponent related to this Handler",this)}var d=e.getEventChannel();if(!d){throw new Error("Retrieved eventChannel is undefined")}var f=this.getId();if(!f){throw new Error("handlerIdentfier has to be a non empty string.")}return d.subscribe({event:f+"/AVAILABILITY"},c)};b.prototype.removeAvailabilityEventSubscription=function(c){if(undefined===c){throw new Error("token has to be defined")}var e=this.getHandlerComponent();if(!e){throw new Error("There is no HandlerComponent related to this Handler",this)}var d=e.getEventChannel();if(!d){throw new Error("Retrieved eventChannel is undefined")}var f=this.getId();if(!f){throw new Error("handlerIdentfier has to be a non empty string.")}return d.unsubscribe(c)};b.prototype.isAvailable=function(){return this._private._currentAvailability};b.prototype.isExecutable=function(){return this._private._currentAvailability};b.prototype.destroy=function(){};var a=Object.create(null);a.Handler=b;a.enums=Object.create(null);return a});define("DS/WAfrAvailabilityModes/mod_AvailabilityModesComponent",["text!DS/WAfrAvailabilityModes/assets/afr/availabilitymodes/AFR_DEFAULT_AVAILABILITY_MODES.json","UWA/Class/Promise"],function(l,e){var f="DEACTIVATED";var b=JSON.parse(l);function k(){return e.resolve(b)}function r(y,A,z){var w=false;var x=y._private._defaultModesValues;if(x.hasOwnProperty(A)&&(x[A].values.hasOwnProperty(z)||z===f)){w=true}return w}var v=Object.create(null);v.DEFAULT_COMPONENT_NAME="AFR_AvailabilityModesComponent";var q="[AVAILABILITY_MODE]";var g=false;v.setDebugMode=function(x){if(x!==undefined&&typeof x==="boolean"&&g!==x){g=x;var w;if(g){w=new Error("Debug mode activated - DO NOT USE IN PRODUCTION");w.name="Warning";console.warn(w.stack)}else{w=new Error("Debug mode deactivated - DO NOT USE IN PRODUCTION");w.name="Warning";console.warn(w.stack)}}};var p="[DS/WAfrAvailabilityModes/mod_AvailabilityModesComponent]";var c=p+"_b_";var h=p+"_e_";var s=p+"_m_";var a=false;v.setProbeMode=function(x){if(x!==undefined&&typeof x==="boolean"&&a!==x){a=x;var w;if(a){w=new Error("Probe mode activated - DO NOT USE IN PRODUCTION");w.name="Warning";console.warn(w.stack)}else{w=new Error("Probe mode deactivated - DO NOT USE IN PRODUCTION");w.name="Warning";console.warn(w.stack)}}};function t(x,w){if(undefined===x||null===x||undefined===w||null===w){throw new Error("probesId and identifier has to be defined")}if(a){window.performance.mark(c+w+x)}}function n(A,x){if(undefined===A||null===A||undefined===x||null===x){throw new Error("probesId and identifier has to be defined")}if(a){window.performance.mark(h+x+A);var y=s+x+A;window.performance.measure(y,c+x+A,h+x+A);if(g){var w=window.performance.getEntriesByName(y);var z=w[w.length-1];console.log(q+" [PROBES] "+x,z)}}}v.AvailabilityModesComponent=function(){this._private=Object.create(null);this._private._probesId=new Date().valueOf()};v.AvailabilityModesComponent.DEFAULT_COMPONENT_NAME=v.DEFAULT_COMPONENT_NAME;v.AvailabilityModesComponent.prototype.initialize=function(){t(this._private._probesId,"AvailabilityModesComponent.prototype.initialize");this._private._currentModes={};this._private._clients={};this._private._nextClientUid=0;var x=this;if(!this._private._defaultModesValues){var y=k().then(function z(A){x._private._defaultModesValues=A;n(x._private._probesId,"AvailabilityModesComponent.prototype.initialize");return e.resolve()},function w(A){throw A});return y}else{n(this._private._probesId,"AvailabilityModesComponent.prototype.initialize");return e.resolve()}};function o(w){for(var x in w){if(w.hasOwnProperty(x)){delete w[x]}}}v.AvailabilityModesComponent.prototype.clean=function(){t(this._private._probesId,"AvailabilityModesComponent.prototype.clean");if(!this._private||!this._private._clients||!this._private._currentModes){throw new Error("AvailabilityModeComponent state is corrupted. You may have call clean before initialize")}o(this._private._currentModes);o(this._private._clients);this._private._nextClientUid=0;n(this._private._probesId,"AvailabilityModesComponent.prototype.clean");return e.resolve()};v.AvailabilityModesComponent.prototype.destroy=function(){t(this._private._probesId,"AvailabilityModesComponent.prototype.destroy");if(!this._private||!this._private._clients||!this._private._currentModes){throw new Error("AvailabilityModeComponent state is corrupted. You may have call clean before initialize")}delete this._private._currentModes;delete this._private._clients;delete this._private._nextClientUid;delete this._private._defaultModesValues;n(this._private._probesId,"AvailabilityModesComponent.prototype.destroy");return e.resolve()};v.AvailabilityModesComponent.prototype.canBeParallelized=function(){return false};function j(){return e.resolve()}v.AvailabilityModesComponent.prototype.getExposedComponentCtor=function(){t(this._private._probesId,"AvailabilityModesComponent.prototype.getExposedComponentCtor");var x=this;function w(){}w.prototype.initialize=j;w.prototype.clean=j;w.prototype.destroy=j;w.prototype.subscribe=x.subscribe.bind(x);w.prototype.unsubscribe=x.unsubscribe.bind(x);w.prototype.publish=x.publish.bind(x);w.prototype.canBeParallelized=x.canBeParallelized.bind(x);n(this._private._probesId,"AvailabilityModesComponent.prototype.getExposedComponentCtor");return w};function u(w){if(!w||!w.getAvailabilityModesInfo||typeof w.getAvailabilityModesInfo!=="function"||!w.onAvailabilityChanged||typeof w.onAvailabilityChanged!=="function"){throw new Error("element is not defined or it does not implement required methods")}}v.AvailabilityModesComponent.prototype.subscribe=function(y){t(this._private._probesId,"AvailabilityModesComponent.prototype.subscribe");u(y);var x=this._private._clients;for(var A in x){if(x.hasOwnProperty(A)){if(x[A]===y){throw new Error("Trying to subscribe an element which is already registered",y)}}}if(x.hasOwnProperty(this._private._nextClientUid)){throw new Error("Internal Error")}x[this._private._nextClientUid]=y;++this._private._nextClientUid;var w=this._private._defaultModesValues;var z=this._private._currentModes;i(this,y,{currentModes:z,defaultModes:w});n(this._private._probesId,"AvailabilityModesComponent.prototype.subscribe");return this._private._nextClientUid-1};v.AvailabilityModesComponent.prototype.unsubscribe=function(x){t(this._private._probesId,"AvailabilityModesComponent.prototype.unsubscribe");var w=this._private._clients;if(!w.hasOwnProperty(x)){throw new Error("No element registered with this token",x)}delete w[x];n(this._private._probesId,"AvailabilityModesComponent.prototype.unsubscribe")};function m(D,B){var A=JSON.parse(JSON.stringify(D));var y=JSON.parse(JSON.stringify(B));for(var C in y){if(y.hasOwnProperty(C)){if(!A[C]){throw new Error(q+" Unsupported availability mode ("+C+")")}var z=A[C].values;var w=y[C].values;for(var x in w){if(w.hasOwnProperty(x)){if(w[x]!==z[x]){z[x]=w[x]}}}}}return A}function i(w,A){var x=w._private._defaultModesValues;var y=w._private._currentModes;var D=A.getAvailabilityModesInfo();if(!D||undefined===D.currentAvailability){throw new Error("Cannot retrieve availabilityModes information for this client",A)}var F=null;var z=null;F=D.modes||{};z=D.currentAvailability;var B=m(x,F);var G=null;var C=null;var E=false;for(G in y){if(y.hasOwnProperty(G)){C=y[G];if(B[G].values[C.selected]===false){E=true;if(z){setTimeout(A.onAvailabilityChanged.bind(A,false,{mode:C,value:C.selected}),0)}break}}}if(!E&&!z){setTimeout(A.onAvailabilityChanged.bind(A,true),0)}}function d(y){if(g){console.log(q+" [AVAILABILITY_COMPUTATION] AvailabilityModesComponent~computeAvailabilityAndPublishAsync - Begin computation",y._private._clients)}t(y._private._probesId,"AvailabilityModesComponent~computeAvailabilityAndPublishAsync");var w=y._private._clients;for(var x in w){if(w.hasOwnProperty(x)){i(y,w[x])}}n(y._private._probesId,"AvailabilityModesComponent~computeAvailabilityAndPublishAsync");if(g){console.log(q+" [AVAILABILITY_COMPUTATION] AvailabilityModesComponent~computeAvailabilityAndPublishAsync - End computation",y._private._clients)}}v.AvailabilityModesComponent.prototype.publish=function(w){if(g){console.log(q+" [MODES_ARRAY] AvailabilityModesComponent.prototype.publish - Before computation",this._private._currentModes)}t(this._private._probesId,"AvailabilityModesComponent.prototype.publish");var z=w.mode;var y=w.data;var x=w.value;if(!z||x===undefined){throw new Error("settings.mode, settings.value has to be defined")}if(!r(this,z,x)){throw new Error("INVALID MODE OR VALUE",z,x)}var A=false;if(!this._private._currentModes.hasOwnProperty(z)){if(x!==f){this._private._currentModes[z]={selected:x,data:y};A=true}}else{if(this._private._currentModes[z].value!==x){if(x===f){delete this._private._currentModes[z]}else{this._private._currentModes[z]={selected:x,data:y}}A=true}}if(A){d(this)}if(g){console.log(q+" [MODES_ARRAY] AvailabilityModesComponent.prototype.publish - After computation",this._private._currentModes)}n(this._private._probesId,"AvailabilityModesComponent.prototype.publish")};return v});define("DS/WAfrUtils/PerformanceHelper",[],function(){var d="WAfr_Mark_";var c="WAfr_Measure_";window.performance.mark=window.performance.mark||function(){};window.performance.measure=window.performance.measure||function(){};var b=Object.create(null);var a=Object.create(null);b.checkpoint=function(e){if(!a[e]){window.performance.mark(d+e+"_start");a[e]=true}else{window.performance.mark(d+e+"_end");window.performance.measure(c+e,d+e+"_start",d+e+"_end");delete a[e]}};return b});define("DS/WAfrContainer/App",["UWA/Core","UWA/Class"],function(c,a){var b=a.extend({defaultOptions:{id:null,title:null,brand:null,appConfig:{afrVersion:"0.1",afrCode:null,afrFamily:null,afrTransitionsFrom:{},afrTransitionsTo:{},afrTransitionsFromFamily:{},afrTransitionsToFamily:{}}},disposeOptions:{disposeFrameWindow:true},init:function(d){d=d||{};this.options=c.extend(c.clone(this.defaultOptions),d);if(!this.options.id){this.options.id=this.options.appConfig.appId||this.options.appConfig.afrAppId;if(this.options.appConfig.appId){delete this.options.appConfig.appId}if(this.options.appConfig.afrAppId){delete this.options.appConfig.afrAppId}}if(!this.options.title){this.options.title=this.options.appConfig.title;if(this.options.appConfig.title){delete this.options.appConfig.title}}if(!this.options.brand){this.options.brand=this.options.appConfig.brand;if(this.options.appConfig.brand){delete this.options.appConfig.brand}}this._parent(this.options);this._frmWindow=undefined;this._disposeCalled=false;this._executionContext=undefined},getIdCard:function(){return this.options.appConfig},getTransitionFrom:function(d){return this.options.appConfig.afrTransitionsFrom?this.options.appConfig.afrTransitionsFrom[d]:null},getTransitionFromFamily:function(d){return this.options.appConfig.afrTransitionsFromFamily?this.options.appConfig.afrTransitionsFromFamily[d]:null},getExecutionContext:function(){return this._executionContext},getFrameWindow:function(){return this._frmWindow},getId:function(){return this.options.id},getTitle:function(){return this.options.title},getBrand:function(){return this.options.brand},getFamily:function(){return this.options.appConfig.afrFamily},onWillEnter:function(d){return c.Class.Promise.resolve()},onWillLeave:function(d){return c.Class.Promise.resolve()},setUp:function(d){if(d.done){d.done()}},isDisposeCalled:function(){return this._disposeCalled},dispose:function(d){var e=c.extend(c.clone(this.disposeOptions),d);if(e.disposeFrameWindow){if(this._frmWindow){this._frmWindow.dispose();this._frmWindow=undefined}}this._disposeCalled=true},getContainer:function(){return this._container},setContainer:function(d){if(this._container){this._container.removeEvent("onDestroy");this._container.removeEvent("onRefresh")}this._container=d;if(this._container){this._container.addEvent("onDestroy",this.onContainerDestroy.bind(this));this._container.addEvent("onRefresh",this.onContainerRefresh.bind(this))}},onContainerDestroy:function(d){this.dispose()},onContainerRefresh:function(d){}});b.inherits=function(d){d.prototype=Object.create(b.prototype,{constructor:{value:d,enumerable:false}})};return b});define("DS/WAfrAppManager/mod_AppManager",["UWA/Class/Promise","DS/WAfrUtils/Logger","i18n!DS/WAfrContainer/assets/nls/Notification"],function(d,c,e){var b=Object.create(null);var a=function(f){this._options=f};a.DEFAULT_COMPONENT_NAME="AFR_AppManager";a.prototype.setCurrentConfig=function(f){this._config=f};a.prototype.initialize=function(){this._executionContext=this.getExecutionContext();this._container=this._executionContext._container;var f=this._executionContext.getComponent(WAfrStandardComponentKey.ModelEvents);if(f){var g=this;["onWillLoadApp","onDidLoadApp","onDidFailToLoadApp"].forEach(function(h){f.subscribe({event:h},g[h].bind(g))})}return d.resolve()};a.prototype.onWillLoadApp=function(f){this._appId=f;this._sourceApp=this._executionContext.getSourceApp()};a.prototype.onDidLoadApp=function(){var h=this._executionContext.getSourceApp();var g=this._executionContext.getComponent(WAfrStandardComponentKey.NotificationManager);this._appId=h.getId();var f=this._sourceApp?this._sourceApp.getTitle()||this._container._view.getTitleHeader().appTitle||this._sourceApp.getId():null;var j=this._container._view.getValue("afrExecutionContexts");if(!j){throw new Error("The persisted contexts must not be undefined")}j[this._container._currentExecutionContext].currentappId=h.getId();this._container._view.setValue("afrCode",h.getIdCard().afrCode);this._container._view.setValue("afrExecutionContexts",j.slice());this._container._view.setValue("afrCurrentExecutionContextIdx",this._container._currentExecutionContext);this._container._view.setValue("afrAppId",h.getId());this._container._view.setValue("appId",h.getId());this._container._view.setBrand(h.options.brand);this._container.updateTitle({title:this._container.productTitle},h);this._container._view.setValue("title",h.getTitle()||this._container._view.getValue("title"));this._container._view.setValue("brand",h.getBrand()||this._container._view.getValue("brand"));var i=h.getTitle();var k={containerId:this._container.id,contextId:this._executionContext.getId(),targetApp:{options:h.options}};k.targetApp.options.appConfig.appId=h.getId();this._container.publish("onAppReady."+this._appId,k);var n="";var l={};if(f){n="WAfrTransitionSuccessful";l["0"]=i;l["1"]=f;var o=e.get(n+".message");var m=e.get(n+".title");if(l&&o){o=e.replace(o,l)}g&&g.notifySuccess({title:m,message:o})}this._appId=null;this._sourceApp=null};a.prototype.onDidFailToLoadApp=function(j){var m=this._executionContext.getComponent(WAfrStandardComponentKey.NotificationManager);var h=this._executionContext.getTargetApp()&&this._executionContext.getTargetApp().getTitle();var l={containerId:this._container.id,contextId:this._executionContext.getId()};var g="WAfrTransitionFailed";var f={0:h};if(h){f[1]=(j&&j.message)||"";var i=e.get(g+".message");i=e.replace(i,f);var k=e.get(g+".title");m&&m.notifyError({title:k,message:i})}if(j){c.severe("Error when loading configuration \n"+j.stack);l.error={name:j?j.name:"Error",message:j?j.message:""}}this._container.publish("onAppFail."+this._appId,l)};a.prototype.createExposedComponent=function(){return{launchApp:this.getExecutionContext()._container.launchApp.bind(this.getExecutionContext()._container)}};b.AppManager=a;return b});define("DS/WAfrHandlers/private/private_CheckHandlerUtilities",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities"],function(d,c){var a=Object.create(null);function b(g){var f=g.getHandlerComponent();if(!f){throw new Error("There is no HandlerComponent related to this CheckHandler",g)}var e=f.getEventChannel();if(!e){throw new Error("Retrieved eventChannel is undefined")}var h=g.getId();if(!h){throw new Error("handlerIdentfier has to be a non empty string.")}var i=g._private._isChecked?"/CHECK":"/UNCHECK";e.publish({event:h+i})}a.executeCheckHandler=function(g,h){if(!g){throw new Error("checkHandler has to be defined and cannot be null")}var f=g.getHandlerComponent();if(!f){console.warn("NO HANDLER COMPONENT SET");throw new Error()}else{if(!f.getExecutionContext()){console.warn("NO EXECUTION CONTEXT SET");throw new Error()}}if(!h||h.action===undefined||typeof h.action!=="boolean"){throw new Error("Wrong parameters")}var e=true;if(g.beingInitialized()||g._private._isChecked!==h.action){g._private._isChecked=h.action;b(g);if(g._private._isChecked){if(g._private._check&&g._private._check._private._type!==undefined){e=false;c.executeHandlerFunctions[g._private._check._private._type]({handler:g._private._check,cb:h.cb,args:h.args})}}else{if(g._private._uncheck&&g._private._uncheck._private._type!==undefined){e=false;c.executeHandlerFunctions[g._private._uncheck._private._type]({handler:g._private._uncheck,cb:h.cb,args:h.args})}}}if(e&&h.cb){setTimeout(function(){var j=d.getErrorManager();var i=d.createReturnObject(j.SUCCEEDED);h.cb(i)},0)}};return a});define("DS/WAfrHandlers/mod_HandlerComponent",["DS/CoreUtilities/ErrorManagement","UWA/Class/Promise","DS/CoreEvents/ModelEvents","DS/WAfrHandlers/private/private_Utilities","DS/WAfrDebug/mod_Performances"],function(e,n,d,i,g){var p=g.Performances,f="[DS/WAfrHandlers/mod_HandlerComponent]";var k=Object.create(null);k.DEFAULT_COMPONENT_NAME="AFR_HandlerComponent";function m(r){if(!this||!this.resolve||!this.reject||!r){throw new Error()}if(e.hasSucceeded(r)){this.resolve(r)}else{this.reject(r)}}var a=Object.create(null);a.HandlerMap={HANDLER:"_hdlrMap",CHECK_HANDLER:"_chkHdlrMap",RADIO_HANDLER:"_radioHdlrMap"};function l(t,r,s){if(!t||!r||!s||!t._private.hasOwnProperty(r)){throw new Error()}var v=t._private[r];var u=s.getId();if(!v||!u){throw new Error()}if(s.setHandlerComponent(t)){v[u]=s}else{throw new Error()}}function o(t,r,s){if(!t||!r||!s||!t._private.hasOwnProperty(r)){throw new Error()}var v=t._private[r];var u=s.getId();if(!v||!u){throw new Error()}if(s.setHandlerComponent(null)){delete v[u]}else{throw new Error()}}function c(t,s,r){if(!t(r)){return r}return s(r).then(c.bind(null,t,s))}k.HandlerComponent=function(){this._perf=new p();this._private={};var s=a.HandlerMap;for(var t in s){if(s.hasOwnProperty(t)){var r=s[t];this._private[r]={}}}};k.HandlerComponent.DEFAULT_COMPONENT_NAME=k.DEFAULT_COMPONENT_NAME;function q(){return n.resolve()}k.HandlerComponent.prototype.getExposedComponentCtor=function(){var s=this;function r(){}r.prototype.initialize=q;r.prototype.clean=q;r.prototype.destroy=q;r.prototype.executeHandler=s.executeHandler.bind(s);r.prototype.toggleCheck=s.toggleCheck.bind(s);r.prototype.setCheckState=s.setCheckState.bind(s);r.prototype.getCheckState=s.getCheckState.bind(s);r.prototype.toggleRadioItemState=s.toggleRadioItemState.bind(s);r.prototype.setRadioItemState=s.setRadioItemState.bind(s);r.prototype.getRadioItemState=s.getRadioItemState.bind(s);return r};k.HandlerComponent.prototype.initialize=function(){this._private._eventChannel=new d();return n.resolve()};function b(u){if(!u){throw new Error("handlerComponent has to be defined")}var s=u._perf;var r=s.start([f,"manageDefaultCommand"].join(" "));var t=u._private._defaultCommandIdentifier;return new n(function(x,w){if(t){var v=u.getExecutionContext();if(v){require(["DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent"],function(y){var z=v.getComponent(y.CommandsManagerComponent.DEFAULT_COMPONENT_NAME);if(z){z.setDefaultCommand(t);delete u._private._defaultCommandIdentifier;s.stop(r);x()}else{s.stop(r);w(new Error("No commandsManagerComponent found using this executionContext",v))}},function(){s.stop(r);w(new Error("Require failed (DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent)"))})}else{s.stop(r);w(new Error("executionContext is undefined"))}}else{s.stop(r);x()}})}k.HandlerComponent.prototype.configure=function(){var r=this;var t={ActionHandler:"executeHandler",CommandHandler:"executeHandler",CheckHandler:"setCheckState",RadioHandler:"setRadioItemState"};var s=this._private._initializationData;if(!s||s.length<=0){return b(r)}else{return c(function(u){return u<s.length},function(v){var u=s[v];var w=t[u.type];return r[w](u).then(function(){return ++v})},0).then(function(){return b(r)})["catch"](function(u){return n.reject(u)})}};function j(x,t){var w=x._perf.start([f,"cleanUpHandlers"].join(" "));var s=a.HandlerMap;for(var v in s){if(s.hasOwnProperty(v)){var r=s[v];var y=x._private[r];for(var u in y){if(y.hasOwnProperty(u)){y[u].destroy()}}delete x._private[r];if(t){x._private[r]={}}}}x._perf.stop(w)}k.HandlerComponent.prototype.clean=function(){j(this,true);this._private._eventChannel.destroy();this._private._eventChannel=new d();this._private._availabilityModesComponent=null;return n.resolve()};k.HandlerComponent.prototype.destroy=function(){j(this,false);this._private._eventChannel.destroy();delete this._private._eventChannel;delete this._private._availabilityModesComponent;return n.resolve()};k.HandlerComponent.prototype.getEventChannel=function(){return this._private._eventChannel};k.HandlerComponent.prototype.setInitializedState=function(r){if(r===undefined){throw new Error("state has to be defined")}else{this._private._initializedState=r}};k.HandlerComponent.prototype.setInitializationDefaultCommand=function(r){if(!r||typeof r!=="string"){throw new Error("commandIdentifier has to be a string")}this._private._defaultCommandIdentifier=r};k.HandlerComponent.prototype.getInitializedState=function(){return Boolean(this._private._initializedState)};k.HandlerComponent.prototype.setInitializationData=function(r){if(Array.isArray(r)){this._private._initializationData=r}else{throw new Error("data has to be an array")}};k.HandlerComponent.prototype.setAvailabilityModesComponent=function(r){if(r===undefined){throw new Error("component has to be defined")}if(r!==null&&this._private._availabilityModesComponent){throw new Error("There is already one AvailabilityModesComponent attached to this HandlerComponent")}this._private._availabilityModesComponent=r};k.HandlerComponent.prototype.getAvailabilityModesComponent=function(){return this._private._availabilityModesComponent};k.HandlerComponent.prototype.addHandler=function(r){l(this,a.HandlerMap.HANDLER,r)};k.HandlerComponent.prototype.removeHandler=function(r){o(this,a.HandlerMap.HANDLER,r)};k.HandlerComponent.prototype.addCheckHandler=function(r){l(this,a.HandlerMap.CHECK_HANDLER,r)};k.HandlerComponent.prototype.removeCheckHandler=function(r){o(this,a.HandlerMap.CHECK_HANDLER,r)};k.HandlerComponent.prototype.addRadioHandler=function(r){l(this,a.HandlerMap.RADIO_HANDLER,r)};k.HandlerComponent.prototype.removeRadioHandler=function(r){o(this,a.HandlerMap.RADIO_HANDLER,r)};k.HandlerComponent.prototype.executeHandler=function(s){if(s&&s.cb){throw new Error()}var r=this;return new n(function(v,u){var w=e.getErrorManager();if(!s){u(e.createReturnObject(w.MISSING_PARAMETERS,{description:"parameters has to be defined"}))}var t=s.id;if(!t||typeof t!=="string"){u(e.createReturnObject(w.MISSING_PARAMETERS,{description:"parameters.id has to be defined"}))}if(r._private._hdlrMap.hasOwnProperty(t)){r._private._hdlrMap[t].execute({cb:m.bind({resolve:v,reject:u}),args:s.args})}else{u(e.createReturnObject(w.FAILED,{description:"No Handler corresponding to the following id: "+t}))}})};k.HandlerComponent.prototype.toggleCheck=function(s){if(s&&s.cb){throw new Error()}var r=this;return new n(function(y,x){var z=e.getErrorManager();if(!s){x(e.createReturnObject(z.MISSING_PARAMETERS,{description:"parameters has to be defined"}))}var t=s.id;var v=s.args;if(!t||typeof t!=="string"){x(e.createReturnObject(z.MISSING_PARAMETERS,{description:"parameters.id has to be defined"}))}if(r._private._chkHdlrMap.hasOwnProperty(t)){var u=r._private._chkHdlrMap[t];var w=u.getState();u.setState({state:!w,cb:m.bind({resolve:y,reject:x}),args:v})}else{x(e.createReturnObject(z.FAILED,{description:"No CheckHandler corresponding to the following id: "+t}))}})};k.HandlerComponent.prototype.setCheckState=function(s){if(s&&s.cb){throw new Error()}var r=this;return new n(function(x,w){var y=e.getErrorManager();if(!s){w(e.createReturnObject(y.MISSING_PARAMETERS,{description:"parameters has to be defined"}))}var t=s.id;var v=s.state;var u=s.args;if(!t||typeof t!=="string"){w(e.createReturnObject(y.MISSING_PARAMETERS,{description:"parameters.id has to be defined"}))}if(v===undefined||typeof v!=="boolean"){w(new Error())}if(r._private._chkHdlrMap.hasOwnProperty(t)){r._private._chkHdlrMap[t].setState({state:v,cb:m.bind({resolve:x,reject:w}),args:u})}else{w(e.createReturnObject(y.FAILED,{description:"No CheckHandler corresponding to the following id: "+t}))}})};k.HandlerComponent.prototype.getCheckState=function(s){if(!s){throw new Error()}var r=s.id;if(!r||typeof r!=="string"){throw new Error()}if(!this._private._chkHdlrMap.hasOwnProperty(r)){throw new Error()}return this._private._chkHdlrMap[r].getState()};k.HandlerComponent.prototype.toggleRadioItemState=function(s){if(s&&s.cb){throw new Error()}var r=this;return new n(function(y,x){var z=e.getErrorManager();if(!s){x(e.createReturnObject(z.MISSING_PARAMETERS,{description:"parameters has to be defined"}))}var A=s.id;var w=s.radioId;var t=s.args;if(!A||typeof A!=="string"){x(e.createReturnObject(z.MISSING_PARAMETERS,{description:"parameters.id has to be defined"}))}if(!w||typeof w!=="string"){x(e.createReturnObject(z.MISSING_PARAMETERS,{description:"parameters.radioId has to be defined"}))}var u=r._private._radioHdlrMap;if(u.hasOwnProperty(w)){var v=!u[w].getRadioItemState(A);u[w].setRadioItemState({radioHdlrItemId:A,state:v,cb:m.bind({resolve:y,reject:x}),args:t})}else{x(e.createReturnObject(z.FAILED,{description:"No item corresponding to the following id: "+w}))}})};k.HandlerComponent.prototype.setRadioItemState=function(s){if(s&&s.cb){throw new Error()}var r=this;return new n(function(y,x){var z=e.getErrorManager();if(!s){x(e.createReturnObject(z.MISSING_PARAMETERS,{description:"parameters has to be defined"}))}var A=s.id;var w=s.radioId;var v=s.state;var t=s.args;if(!A||typeof A!=="string"){x(new Error())}if(!w||typeof w!=="string"){x(e.createReturnObject(z.MISSING_PARAMETERS,{description:"parameters.id has to be defined"}))}if(v===undefined||typeof v!=="boolean"){x(e.createReturnObject(z.MISSING_PARAMETERS,{description:"parameters.state has to be defined"}))}var u=r._private._radioHdlrMap;if(u.hasOwnProperty(w)){u[w].setRadioItemState({radioHdlrItemId:A,state:v,cb:m.bind({resolve:y,reject:x}),args:t})}else{x(e.createReturnObject(z.MISSING_PARAMETERS,{description:"No CheckHandler corresponding to the following id: "+A}))}})};k.HandlerComponent.prototype.getRadioItemState=function(s){if(!s){throw new Error()}var u=s.id;var t=s.radioId;if(!u||typeof u!=="string"){throw new Error()}if(!t||typeof t!=="string"){throw new Error()}var r=this._private._radioHdlrMap;if(!r.hasOwnProperty(t)){throw new Error()}return r[t].getRadioItemState(u)};function h(u,t){var w={};if(t!==undefined&&u&&u._private&&u._private._hdlrMap){var r=u._private._hdlrMap;for(var v in r){var s=r[v]._private._type;if(u._private._hdlrMap.hasOwnProperty(v)){if(s===t){w[v]=u._private._hdlrMap[v]}}}}return w}k.HandlerComponent.prototype.getActionHandlerMap=function(){return h(this,i.enums.HandlerType.ACTION_HANDLER)};k.HandlerComponent.prototype.getCommandHandlerMap=function(){return h(this,i.enums.HandlerType.COMMAND_HANDLER)};k.HandlerComponent.prototype.getLeafHandlerMaps=function(){var u=Object.create(null);u.actionHandlers={};u.commandHandlers={};if(this._private&&this._private._hdlrMap){var r=this._private._hdlrMap;for(var t in r){if(r.hasOwnProperty(t)){var s=r[t]._private._type;if(s===i.enums.HandlerType.ACTION_HANDLER){u.actionHandlers[t]=r[t]}else{if(s===i.enums.HandlerType.COMMAND_HANDLER){u.commandHandlers[t]=r[t]}else{console.warn("Unknown LeafHandler type",r[t]._private._type)}}}}}return u};return k});define("DS/WAfrHandlers/private/private_RadioHandlerUtilities",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_CheckHandlerUtilities"],function(c,b){var a=Object.create(null);a.fireEvent=function(g,e,j){if(!g||!e||j===undefined){throw new Error("radioHandler, itemIdentifier and state has to be defined")}var i=g.getHandlerComponent();if(!i){throw new Error("There is no HandlerComponent related to this RadioHandler",g)}var h=i.getEventChannel();if(!h){throw new Error("Retrieved eventChannel is undefined")}var f=g.getId();if(!f){throw new Error("radioHandlerIdentifier has to be a non empty string.")}var d="/"+e;var k=j?"/SELECT":"/UNSELECT";h.publish({event:f+d+k})};a.checkOnUncheck=function(d){if(this&&this.manager&&this.manageable&&d){if(c.hasSucceeded(d)){a.fireEvent(this.manager,this.manageable.getId(),true);b.executeCheckHandler(this.manageable,{cb:this.cb,action:true,args:this.args})}else{if(this.cb){this.cb(d)}else{throw d.getError()}}}else{throw new Error("Internal error. Manageable has to be defined")}};a.isManagedByRadioHandler=function(e,g){var h=false;var d=0;var f=g._private._elements.length;while(!h&&d<f){if(g._private._elements[d]===e){h=true}++d}return h};return a});define("DS/WAfrHandlers/mod_LeafHandler",["DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/mod_Handler"],function(f,g){var d=g.Handler;function c(h){d.call(this,h);if(h){if(h.availabilityMode){this._private._availabilityMode=h.availabilityMode}this._private._currentAvailability=true;if(h.icon&&h.icon.uri){this._private._icon=h.icon}}else{throw new Error("Missing parameters. Please see the LeafHandler documentation to see the required parameters.")}}f.inherit(c,d);c.prototype.initAvailabilityModesSubscription=function(){var h=this.getHandlerComponent();if(!h){throw new Error("Impossible to retieve the HandlerComponent.")}var i=h.getAvailabilityModesComponent();if(!i){throw new Error("Impossible to retieve the AvailabilityModesComponent.")}this._private._availabilityModesSubscriptionToken=i.subscribe(this)};c.prototype.destroy=function(){var h=this.getHandlerComponent();if(!h){throw new Error("Impossible to retieve the HandlerComponent.")}var i=h.getAvailabilityModesComponent();if(i){i.unsubscribe(this._private._availabilityModesSubscriptionToken)}};c.prototype.getAvailabilityModesInfo=function(){return{modes:this._private._availabilityMode,currentAvailability:this._private._currentAvailability}};c.prototype.onAvailabilityChanged=function(i,h){this._private._currentAvailability=i;return this._private._handlerState.onAvailabilityChanged(i,h)};c.prototype.getIcon=function(){return this._private._icon};c.prototype.makeManaged=function(h){if(!(this._private._handlerState instanceof e)){this._private._handlerState=new e(this,h)}else{throw new Error("Call makeManaged method on an LeafHandler which is already managed")}};c.prototype.isExecutable=function(){return this._private._handlerState.isExecutable()};c.prototype.execute=function(h){if(h&&typeof h!=="object"){throw new Error("parameters has to be an object if defined")}if(!this.isExecutable()){if(h&&h.cb){setTimeout(function(){h.cb(new Error("This LeafHandler is not executable"))},0)}else{console.warn("This LeafHandler is not executable",this.getId())}}else{return this._private._handlerState.execute(h)}};c.prototype.setArgs=function(h){if(typeof h!=="object"){throw new Error("args has to be an object")}this._private._args=h};c.prototype.getArgs=function(){return this._private._args};function b(h){if(h){this._handler=h}else{throw new Error("handler has to be defined")}}b.prototype.execute=function(){throw new Error("execute has to be implemented on subclasses")};b.prototype.setHandlerComponent=function(h){if(h===undefined){throw new Error("component has to be defined")}this._handler._private._handlerComponent=h;return true};b.prototype.getHandlerComponent=function(){return this._handler._private._handlerComponent};b.prototype.onAvailabilityChanged=function(l){var j=this._handler;j._private._currentAvailability=l;var i=j.getHandlerComponent();if(!i){throw new Error("There is no HandlerComponent related to this LeafHandler",j)}var h=i.getEventChannel();if(!h){throw new Error("Retrieved eventChannel is undefined")}var k=j.getId();if(!k){throw new Error("handlerIdentfier has to be a non empty string.")}h.publish({event:k+"/AVAILABILITY",data:{newValue:l}})};b.prototype.isExecutable=function(){return this._handler._private._currentAvailability};function e(i,h){if(i&&h){this._handler=i;this._manager=h}else{throw new Error("handler and manager have to be defined")}}e.prototype.execute=function(h){return this._manager.handleExecute({cb:h.cb,manageable:this._handler,args:h.args})};e.prototype.setHandlerComponent=function(){console.warn("Impossible to set a HandlerComponent to a LeafHandler which is managed.");return false};e.prototype.getHandlerComponent=function(){return this._manager.getHandlerComponent()};e.prototype.onAvailabilityChanged=function(k,j){var i=this._handler;var h=this._manager;return h.handleOnAvailabilityChanged({manageable:i,args:{newValue:k,info:j}})};e.prototype.isExecutable=function(){return this._manager.handleIsExecutable({manageable:this._handler})};var a=Object.create(null);a.LeafHandler=c;a.StandaloneLeafHandlerState=b;a.ManagedLeafHandlerState=e;return a});define("DS/WAfrHandlers/private/private_CommandHandlerUtilities",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities"],function(d,c){var a=Object.create(null);a.CmdMode={EXCLUSIVE:0,NESTED:1};a.RepeatMode={NEVER:0,STANDARD:1,ALWAYS:2};a.LifeCycleEvents={BEGIN:"BEGIN",PAUSE:"PAUSE",RESUME:"RESUME",CANCEL:"CANCEL",END:"END"};a.HandlerState={EXECUTING:"EXECUTING",PAUSED:"PAUSED",CANCELED:"CANCELED",ENDING:"ENDING",ENDED:"ENDED"};a.isValidHandlerState=function(e){return Boolean(e)&&this.HandlerState.hasOwnProperty(e)};function b(e){if(!this){throw new Error("this (commandHandler) is undefined.")}if(this.getState()!==a.HandlerState.ENDED){throw new Error("The command ended with the status Stated")}if(!e||!e.notStarted){for(var f=0;f<this._private._appCB.length;f++){if(this._private._appCB[f]&&typeof this._private._appCB[f]==="function"){if(!e){var g=d.getErrorManager();e=d.createReturnObject(g.SUCCEEDED)}this._private._appCB[f](e)}}}}a.executeCommandHandler=function(e){if(!e||!e.handler){throw new Error("parameters.handler has to be defined")}e.args=c.computeArgs(e.handler,e.args);e.handler._private._cmdsManager.stackCommandExecutionRequest(b.bind(e.handler),e)};return a});define("DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent",["DS/WAfrHandlers/private/private_CommandHandlerUtilities","DS/WAfrHandlers/mod_HandlerComponent","DS/ApplicationFrame/Private_AfrCore","DS/CoreEvents/ModelEvents","DS/CoreEvents/Events","DS/CoreUtilities/ErrorManagement","UWA/Class/Promise","DS/ApplicationFrame/CommandsManager","DS/AfrUndoRedoUI/Private_UndoRedoManager","DS/AfrUndoRedoUI/Private_UndoStep"],function(b,C,F,o,K,s,r,w,l,m){console.error("###################################################################");console.error("## Load DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent ##");console.error("## DRAFT MODULE                                                  ##");console.error("## DO NOT USE WITHOUT AFR TEAM AUTHORIZATION                     ##");console.error("###################################################################");var B={exclusiveCmdCalled:0,secondExecuteCalled:1,killedByInfra:2,askedByCmd:3};var i=false;function v(O,N){if(i){console.log(N+" : "+method)}}var x=false;var H=Object.create(null);H.CommandsManagerComponent=function(){var N=this;if(!this._private){this._private=Object.create(null)}this._private._defaultCommand=null;this._private._runningCmd=null;this._private._pausedCmds=[];this._private._executionChain=[];this._private._currentExecution=null;this._private._currentExecutionDone=true;this._private._waitingExecution=0;this._private._modelEvents=new o();K.subscribe({event:"COMMAND_MANAGER/Ending_Commands"},function(){N.endAll(undefined)});w._newCmdMgt=true};H.CommandsManagerComponent.DEFAULT_COMPONENT_NAME="AFR_CommandsManager";H.CommandsManagerComponent.prototype.initialize=function(){var N=this;x=false;return r.resolve()};H.CommandsManagerComponent.prototype.clean=function(){x=true;this.setDefaultCommand(null);return r.resolve()};H.CommandsManagerComponent.prototype.isCmdExecuting=function(N){return N.getState()===b.HandlerState.EXECUTING};H.CommandsManagerComponent.prototype.setDefaultCommand=function(O){if(O===undefined||O&&typeof O!=="string"){throw new Error("CommandsManagerComponent.setDefaultCommand can only take null or a string (commandHandlerID) as input parameter")}if(O&&((this._private._runningCmd===null&&this._private._pausedCmds.length===0&&this._private._waitingExecution===0&&this._private._currentExecutionDone)||this._private._runningCmd.getId()===O)){var N=this.getExecutionContext();f({commandHandlerId:O,executionCtx:N})}this._private._defaultCommand=O};H.CommandsManagerComponent.prototype.getDefaultCommand=function(){return this._private._defaultCommand};H.CommandsManagerComponent.prototype.subscribeToCmdState=function(Q,P,N){var O;if(Q===""){O=P}else{O=Q+"/"+P}return this._private._modelEvents.subscribe({event:O},function(R){N(R)})};H.CommandsManagerComponent.prototype.subscribeOnceToCmdState=function(Q,P,N){var O;if(Q===""){O=P}else{O=Q+"/"+P}return this._private._modelEvents.subscribeOnce({event:Q+"/"+P},function(R){N(R)})};H.CommandsManagerComponent.prototype.unsubscribeToCmdState=function(N){this._private._modelEvents.unsubscribe(N)};H.CommandsManagerComponent.prototype.getRunningCommand=function(){return this._private._runningCmd?this._private._runningCmd.getId():null};H.CommandsManagerComponent.prototype.getExposedComponentCtor=function(){var N=this;function O(){this.cancelReason=B}O.prototype.getDefaultCommand=N.getDefaultCommand.bind(N);O.prototype.getRunningCommand=N.getRunningCommand.bind(N);O.prototype.setDefaultCommand=N.setDefaultCommand.bind(N);O.prototype.isCmdExecuting=N.isCmdExecuting.bind(N);O.prototype.subscribeToCmdState=N.subscribeToCmdState.bind(N);O.prototype.unsubscribeToCmdState=N.unsubscribeToCmdState.bind(N);O.prototype.subscribeOnceToCmdState=N.subscribeOnceToCmdState.bind(N);return O};H.CommandsManagerComponent.prototype.stackCommandExecutionRequest=function(P,O){var N=Object.create(null);N.cmdsManager=this;N.cmdHandler=O.handler;var Q=O.cb;a({callback:function(R){if(!R){throw new error("mod_CommandsManagerComponent.js callback in chainNewExecution cannot start a command is no capsuleObject is passed")}if(x){return}if(Q===null||typeof Q!=="function"){Q=undefined}if(t(R.cmdHandler)){if(R.cmdsManager._private._currentExecution){R.cmdsManager._private._currentExecutionDone=true}setTimeout(function(){u.call(R.cmdsManager)},0);return}if(h(R.cmdHandler)){if(!R.cmdHandler._private._appCB){R.cmdHandler._private._appCB=[]}if(Q){R.cmdHandler._private._appCB.push(Q)}R.cmdHandler._private._command._instance.params=Object.create(null);R.cmdHandler._private._command._instance.params.cancelReason=B.secondExecuteCalled;q(R)}else{R.cmdHandler.setStateAndSendEvent({state:b.HandlerState.EXECUTING,event:b.LifeCycleEvents.BEGIN});require([R.cmdHandler._private._command._module],function(V){if(V){var T=null;var S=R.cmdsManager.getExecutionContext();if(S){T=S.applicationContext;T.ID=R.cmdsManager._private._executionContext.getId()}if(!O.args){O.args=Object.create(null)}O.args.cmdLifeCyleEventsChanel=R.cmdsManager._private._modelEvents;O.ID=R.cmdHandler.getId();V.prototype.isNewInfraActivated=function(){return true};var U=new V({args:O.args,executionContext:T,ID:O.ID});if(U){if(R.cmdHandler.isUsingComputeServer()){U.getCSIdentifier=function(){return U};U.hasDecalredCS=function(){return true};U.onCmdEnded=function(W){return D.call(R,W)}}U.getId=function(){return R.cmdHandler.getId()};U.askForUndoGroupingAtEnd=function(W){U._endUndoGroupingRequested=true;U._undoGroupID=W};U._evtID=T.ID+O.ID;R.cmdHandler._private._command._instance=U;R.cmdHandler._private._cb=P;if(!R.cmdHandler._private._appCB){R.cmdHandler._private._appCB=[]}if(Q){R.cmdHandler._private._appCB.push(Q)}L(R)}else{u.call(R.cmdsManager);throw new Error("Call to "+R.cmdHandler._private._command._module+" constructor returned undefined")}}else{console.error("Failed to load the module related to the command",R.cmdHandler._private._id)}},function(){var S=new Error("Require failed ("+R.cmdHandler._private._command._module+")");if(Q&&typeof Q==="function"){Q(S)}else{throw S}u.call(R.cmdsManager)})}},caller:N})};H.CommandsManagerComponent.prototype.endAll=function(Q){var T=this;this._private._executionChain.length=0;var P=T._private._pausedCmds;var V=[];var O=0;var N=false;this._private._waitingExecution=0;if(T._private._runningCmd&&T._private._runningCmd._private._id!=="WAFRUndoCmd"){var R=Object.create(null);R.cmdsManager=T;R.cmdHandler=T._private._runningCmd;q(R)}O=P.length;for(var U in P){var S=Object.create(null);S.cmdsManager=T;S.cmdHandler=P.pop();q(S)}K.publish({event:"COMMAND_MANAGER/ALL_CMD_ENDED"})};function L(O){if(!O||!O.cmdsManager||!O.cmdHandler||!O.cmdHandler._private._command._instance||!O.cmdHandler._private._cb||!O.cmdHandler._private._cb){throw new Error("executeCmd require the parameter capsuleObject with a valid CommandsManager and cmdHandler with a valid command instance")}v("begin",O.cmdHandler.getId());O.cmdsManager._private._modelEvents.publish({event:O.cmdHandler.getId()+"/begin"});O.cmdsManager._private._modelEvents.publish({event:"begin",data:O.cmdHandler.getId()});O.cmdsManager._private._runningCmd=O.cmdHandler;if(!O.cmdHandler._private._command._instance.beginExecute&&O.cmdHandler._private._command._instance.stateGraph!==true){throw new Error("mod_CommandsManagerComponent.executeCmd : Cannot execute a command without a beginExecute method defined on it. It has no sense. BAD Command : "+O.cmdHandler._private._command._module)}O.cmdHandler._private._command._instance._previousUndoId=l.getLastCreatedUndoStepId();if(O.cmdHandler.isUsingComputeServer()){var P={from:O.cmdHandler._private._command._instance};var N=F.sendStartCommand(P);if(!s.hasSucceeded(N)){s.logResult(N);D.call(O);return}}if(O.cmdHandler._private._command._instance.stateGraph!==true){O.cmdHandler._private._command._instance.done=J.bind(O);z({callback:O.cmdHandler._private._command._instance.beginExecute,caller:O.cmdHandler._private._command._instance})}else{if(O.cmdHandler._private._command._instance.asyncGraph===true){O.cmdHandler._private._command._instance.done=j.bind(O)}else{O.cmdHandler._private._command._instance.done=J.bind(O)}z({callback:O.cmdHandler._private._command._instance.buildGraph,caller:O.cmdHandler._private._command._instance});if(O.cmdHandler._private._command._instance.asyncGraph!==true){z({callback:O.cmdHandler._private._command._instance._initGraph,caller:O.cmdHandler._private._command._instance})}}if(O.cmdsManager._private._currentExecution){O.cmdsManager._private._currentExecutionDone=true}z({callback:function(){if(O.cmdsManager._private._currentExecutionDone&&h(O.cmdHandler)){u.call(O.cmdsManager)}}})}function M(N){if(!N||!N.cmdsManager||!N.cmdHandler){throw new Error("pauseCmd require the parameter capsuleObject with a valid cmdsManager and cmdHandler with a valid command instance")}if(h(N.cmdHandler)){v("pause",N.cmdHandler.getId());N.cmdsManager._private._modelEvents.publish({event:N.cmdHandler.getId()+"/pause"});N.cmdsManager._private._modelEvents.publish({event:"pause",data:N.cmdHandler.getId()});N.cmdHandler.setStateAndSendEvent({state:b.HandlerState.PAUSED,event:b.LifeCycleEvents.PAUSE});N.cmdsManager._private._pausedCmds.push(N.cmdHandler);if(N.cmdHandler._private._command._instance.stateGraph){N.cmdHandler._private._command._instance._unsubscribeFromAllEvents(N.cmdHandler._private._command._instance._getCurrentStateId())}if(N.cmdHandler._private._command._instance.pauseExecute){N.cmdHandler._private._command._instance.done=c.bind(N);z({callback:N.cmdHandler._private._command._instance.pauseExecute,caller:N.cmdHandler._private._command._instance})}else{z({callback:c,caller:N})}}}function n(N){v("resume",N.cmdHandler.getId());N.cmdsManager._private._modelEvents.publish({event:N.cmdHandler.getId()+"/resume"});N.cmdsManager._private._modelEvents.publish({event:"resume",data:N.cmdHandler.getId()});N.cmdHandler.setStateAndSendEvent({state:b.HandlerState.EXECUTING,event:b.LifeCycleEvents.RESUME});N.cmdsManager._private._runningCmd=N.cmdHandler;if(N.cmdHandler._private._command._instance.stateGraph){N.cmdHandler._private._command._instance._SuscribeToStateEvent(N.cmdHandler._private._command._instance._getCurrentStateId())}N.cmdHandler._private._command._instance.done=J.bind(N);if(N.cmdHandler._private._command._instance.resumeExecute){z({callback:N.cmdHandler._private._command._instance.resumeExecute,caller:N.cmdHandler._private._command._instance})}z({callback:function(){if(N.cmdsManager._private._currentExecutionDone&&h(N.cmdHandler)){u.call(N.cmdsManager)}}})}function q(N){if(!N||!N.cmdsManager||!N.cmdHandler||!N.cmdHandler._private._cb){throw new Error("cancelCmd require the parameter capsuleObject with a valid cmdsManager and cmdHandler with a valid command instance")}if(h(N.cmdHandler)){N.cmdHandler.setStateAndSendEvent({state:b.HandlerState.CANCELED,event:b.LifeCycleEvents.CANCEL});v("canceling",N.cmdHandler.getId());N.cmdsManager._private._modelEvents.publish({event:N.cmdHandler.getId()+"/canceling"});N.cmdsManager._private._modelEvents.publish({event:"canceling",data:N.cmdHandler.getId()});if(N.cmdHandler._private._command._instance.cancelExecute){N.cmdHandler._private._command._instance.done=A.bind(N);z({callback:N.cmdHandler._private._command._instance.cancelExecute,caller:N.cmdHandler._private._command._instance,arg:N.cmdHandler._private._command._instance.params})}else{z({callback:A,caller:N})}}}function A(Q){if(Q&&Q.undoOnEnd){if(!this.cmdsManager._private._runningCmd._private._command._instance.params){this.cmdsManager._private._runningCmd._private._command._instance.params={}}this.cmdsManager._private._runningCmd._private._command._instance.params.undoOnEnd=Q.undoOnEnd}this.cmdHandler._private._command._instance.done=function(){};if(this.cmdHandler.getState()!==b.HandlerState.CANCELED){this.cmdHandler.setStateAndSendEvent({state:b.HandlerState.ENDING})}if(this.cmdHandler.isUsingComputeServer()){var P={from:this.cmdHandler._private._command._instance};var N=F.sendStopCommand(P);if(s.hasSucceeded(N)){return}else{s.logResult(N)}}var O=this;setTimeout(function(){D.call(O,Q)},0)}function J(N){this.cmdHandler._private._command._instance.done=function(){};if(this.cmdsManager._private._runningCmd!==this.cmdHandler||!h(this.cmdHandler)){v("done execute callback called but command paused/canceled in between",this.cmdHandler.getId());return}this.cmdHandler._private._command._instance.params={};if(N&&N.error){this.cmdHandler._private._command._instance.params.error=N.error}if(N&&N.cancel){this.cmdHandler._private._command._instance.params.cancelReason=B.askedByCmd;if(N.undoOnEnd){this.cmdHandler._private._command._instance.params.undoOnEnd=N.undoOnEnd}q(this)}else{A.call(this)}}function j(O){var N=this;this.cmdHandler._private._command._instance.done=J.bind(N);if(this.cmdsManager._private._runningCmd!==this.cmdHandler||!h(this.cmdHandler)){v("done execute callback called but command paused/canceled in between",this.cmdHandler.getId());return}z({callback:this.cmdHandler._private._command._instance._initGraph,caller:this.cmdHandler._private._command._instance})}function c(){this.cmdHandler._private._command._instance.done=function(){};v("paused",this.cmdHandler.getId());this.cmdsManager._private._modelEvents.publish({event:this.cmdHandler.getId()+"/paused"});this.cmdsManager._private._modelEvents.publish({event:"paused",data:this.cmdHandler.getId()});this.cmdsManager._private._runningCmd=null;if(this.cmdsManager._private._currentExecution){this.cmdsManager._private._currentExecutionDone=true}var N=this;setTimeout(function(){u.call(N.cmdsManager)},0)}function D(S){if(this.cmdsManager._private._runningCmd._private._command._instance._endUndoGroupingRequested===true){l._stopConcatenateUS(this.cmdsManager._private._runningCmd._private._command._instance._undoGroupID);this.cmdsManager._private._runningCmd._private._command._instance._endUndoGroupingRequested=false}var O=null;if(this.cmdsManager._private._runningCmd._private._command._instance._createCmdGlobalUndo){O=this.cmdsManager._private._runningCmd._private._command._instance._createCmdGlobalUndo()}if(G){O=G(this.cmdsManager._private._runningCmd._private._command._instance)}if(this.cmdsManager._private._runningCmd._private._command._instance.params&&this.cmdsManager._private._runningCmd._private._command._instance.params.undoOnEnd){var P=this.cmdsManager.getExecutionContext();if(O){this.cmdsManager._private._runningCmd._private._command._instance.isCanceled=function(){return true};l.undo()}}this.cmdsManager._private._runningCmd=null;if(this.cmdsManager._private._currentExecution){this.cmdsManager._private._currentExecutionDone=true}var N=e(this.cmdHandler);var R=(this.cmdHandler.getRepeatMode()===b.RepeatMode.ALWAYS&&!N&&this.cmdsManager._private._waitingExecution===0);this.cmdHandler.setStateAndSendEvent({state:b.HandlerState.ENDED,event:b.LifeCycleEvents.END,repeated:R,canceled:N});v("end",this.cmdHandler.getId());this.cmdsManager._private._modelEvents.publish({event:this.cmdHandler.getId()+"/end",data:{repeated:R,canceled:N}});this.cmdsManager._private._modelEvents.publish({event:"end",data:{handlerId:this.cmdHandler.getId(),repeated:R,canceled:N}});if(this.cmdHandler._private._cb&&typeof this.cmdHandler._private._cb==="function"){this.cmdHandler._private._cb(S?S.error:undefined);if(!R){this.cmdHandler._private._appCB=[]}}if(this.cmdHandler._private._command._instance.destroy){this.cmdHandler._private._command._instance.destroy.call(this.cmdHandler._private._command._instance)}this.cmdHandler._private._command._instance=null;if(R){this.cmdHandler.execute();u.call(this.cmdsManager)}else{var Q=this;setTimeout(function(){if(!Q.cmdsManager._private._runningCmd){I(Q)}},0)}}function I(Q){if(Q.cmdsManager._private._runningCmd){console.error("CmdsManager.runNextCmd a command is already running")}if(!Q.cmdsManager._private._currentExecutionDone){return}var P;if(Q.cmdsManager._private._executionChain.length>0){P=Q.cmdsManager._private._executionChain[0].caller.cmdHandler}if(Q.cmdsManager._private._pausedCmds.length>0&&(!Q.cmdsManager._private._waitingExecution||P===Q.cmdsManager._private._pausedCmds[0]||P.getMode()!==b.CmdMode.NESTED)){var N=Object.create(null);N.cmdsManager=Q.cmdsManager;N.cmdHandler=Q.cmdsManager._private._pausedCmds.pop();n(N);return}else{if(Q.cmdsManager._private._waitingExecution===0&&Q.cmdsManager._private._currentExecutionDone){var O=Q.cmdsManager.getDefaultCommand();if(O){f({commandHandlerId:O,executionCtx:Q.cmdsManager.getExecutionContext()})}}}setTimeout(function(){if(Q.cmdsManager._private._waitingExecution){u.call(Q.cmdsManager)}else{if(Q.cmdsManager._private._currentExecution&&Q.cmdsManager._private._currentExecutionDone){Q.cmdsManager._private._currentExecution=null}}},0)}function f(O){if(!O.commandHandlerId){return}if(!O.executionCtx){throw new Error("mod_commandsManagerComponent.js cannot execute a command without an execution context")}var N=O.executionCtx.getComponent(C.DEFAULT_COMPONENT_NAME);if(!N){throw new Error("mod_commandsManagerComponent.js cannot execute a command without a handler component registered on the execution context")}N.executeHandler({id:O.commandHandlerId})}function E(N){return(N._private._runningCmd.getState()===b.HandlerState.PAUSED||N._private._runningCmd.getState()===b.HandlerState.CANCELED)}function h(N){return N.getState()===b.HandlerState.EXECUTING}function t(N){return N.getState()===b.HandlerState.PAUSED}function e(N){return N.getState()===b.HandlerState.CANCELED}var d=new Array(50);var k=0;function z(N){d[k]=N.callback;d[k+1]=N.caller;d[k+2]=N.arg;k+=3;if(k===3){setTimeout(g,0)}}function g(){for(var P=0;P<k;P+=3){var Q=d[P];var O=d[P+1];var N=d[P+2];Q.call(O,N);d[P]=undefined;d[P+1]=undefined;d[P+2]=undefined}k=0}function a(O){O.caller.cmdsManager._private._waitingExecution++;if(O.caller.cmdsManager._private._currentExecution||!O.caller.cmdsManager._private._currentExecutionDone||(O.caller.cmdsManager._private._runningCmd&&!h(O.caller.cmdsManager._private._runningCmd))){if(O.caller.cmdsManager._private._executionChain.length>0){O.caller.cmdsManager._private._waitingExecution--;var N=O.caller.cmdsManager._private._executionChain.pop();N.caller.cmdHandler.setStateAndSendEvent({state:b.HandlerState.ENDED,event:b.LifeCycleEvents.END,notStarted:true});if(N.caller.cmdHandler===O.caller.cmdHandler){O.caller.cmdsManager._private._waitingExecution--}else{O.caller.cmdsManager._private._executionChain.push(O)}}else{O.caller.cmdsManager._private._executionChain.push(O)}}else{var P=p(O);if(P){O.caller.cmdsManager._private._executionChain.push(O);P.caller.cmdsManager._private._currentExecution=y(P)}else{O.caller.cmdsManager._private._currentExecution=y(O)}}}function y(N){if(!N.caller.cmdsManager._private._currentExecutionDone){throw new Error("begin forbidden")}N.caller.cmdsManager._private._waitingExecution--;N.caller.cmdsManager._private._currentExecutionDone=false;setTimeout(function(){N.callback.call(undefined,N.caller)},0);return N.caller}function p(N){var O;if(N.caller.cmdHandler.getState()===b.HandlerState.PAUSED){return undefined}if(N.caller.cmdsManager._private._runningCmd&&(N.caller.cmdsManager._private._runningCmd!==N.caller.cmdHandler)&&h(N.caller.cmdsManager._private._runningCmd)){N.caller.cmdsManager._private._waitingExecution++;O=Object.create(null);O.caller=Object.create(null);O.caller.cmdsManager=N.caller.cmdsManager;O.caller.cmdHandler=N.caller.cmdsManager._private._runningCmd;if(N.caller.cmdHandler.getMode()===b.CmdMode.EXCLUSIVE||N.caller.cmdsManager._private._runningCmd._private._command._instance.cancelWhenPaused===true){O.callback=q;O.caller.cmdHandler._private._command._instance.params=Object.create(null);O.caller.cmdHandler._private._command._instance.params.cancelReason=B.exclusiveCmdCalled}else{if(N.caller.cmdHandler.getMode()===b.CmdMode.NESTED){O.callback=M}}}return O}function u(){if(!this._private._currentExecutionDone){return}if(this._private._executionChain.length===0){this._private._waitingExecution=0;this._private._executionChain=[];this._private._currentExecution=null;this._private._currentExecutionDone=true;if(!this._private._runningCmd){I({cmdsManager:this,cmdHandler:undefined})}}else{var N=p(this._private._executionChain[0]);if(!N){N=this._private._executionChain.shift()}this._private._currentExecution=y(N)}}function G(S){var N=false;if(!S._dirtyUndoStack){return N}var R=l._private._undoStack.getLastStepId();if(S._previousUndoId<R){var Q=true;if(S._mode==="shared"&&S._executeUndoAtEnd){Q=false}var P=new m({undoTitle:S.getId(),exclusivity:Q,redoEnabled:!S._executeUndoAtEnd});l.registerAction(P);var O=l._private._undoStack.groupSteps(P.getId(),S._previousUndoId+1);if(s.hasSucceeded(O)){N=true}else{var T=l._private._undoStack.removeStepWithId(l._private._undoStack.getLastStepId());if(!s.hasSucceeded(T)){s.logResult(T)}}}return N}return H});define("DS/WAfrHandlers/mod_CommandHandler",["DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/private/private_CommandHandlerUtilities","DS/WAfrHandlers/mod_LeafHandler"],function(c,b,a){var i=a.LeafHandler;var d=a.StandaloneLeafHandlerState;var g="COMMAND_HANDLER";c.registerLeafHandler(g,{executeFunc:b.executeCommandHandler});var e=Object.create(null);e.CmdMode={EXCLUSIVE:b.CmdMode.EXCLUSIVE,NESTED:b.CmdMode.NESTED};e.RepeatMode={NEVER:b.RepeatMode.NEVER,STANDARD:b.RepeatMode.STANDARD,ALWAYS:b.RepeatMode.ALWAYS};e.LifeCycleEvents={BEGIN:b.LifeCycleEvents.BEGIN,PAUSE:b.LifeCycleEvents.PAUSE,RESUME:b.LifeCycleEvents.RESUME,CANCEL:b.LifeCycleEvents.CANCEL,END:b.LifeCycleEvents.END};function j(k){return Boolean(k)&&e.LifeCycleEvents.hasOwnProperty(k)}function h(k){d.call(this,k)}c.inherit(h,d);h.prototype.execute=function(m){var k=m?m.cb:undefined;var l=m?m.args:undefined;return b.executeCommandHandler({handler:this._handler,cb:k,args:l})};function f(k){i.call(this,k);if(!k){throw new Error("DS/WAfrHandlers/mod_CommandHandler.CommandHandler: parameters has to be defined")}if(!k.module||typeof k.module!=="string"){throw new Error("DS/WAfrHandlers/mod_CommandHandler.CommandHandler: parameters.module has to be defined and to be a non empty string")}if(!k.cmdsManager||typeof k.cmdsManager!=="object"){throw new Error("DS/WAfrHandlers/mod_CommandHandler.CommandHandler: parameters.cmdsManager has to be defined and to be Object of type DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent")}if(!this._private){this._private=Object.create(null)}this._private._type=c.enums.HandlerType[g];this._private._command=Object.create(null);this._private._command._module=k.module;this._private._command._instance=null;this._private._command._mode=k.cmdMode?k.cmdMode:e.CmdMode.EXCLUSIVE;this._private._repeatMode=k.repeatMode?k.repeatMode:e.RepeatMode.NEVER;this._private._cmdsManager=k.cmdsManager;this._private._useComputeServer=k.computeServer?k.computeServer:false;this._private._cb=null;this._private._handlerState=new h(this)}c.inherit(f,i);f.prototype.makeStandalone=function(){if(!(this._private._handlerState instanceof h)){this._private._handlerState=new h(this)}else{throw new Error("Call makeStandalone method on an CommandHandler which is already a standalone item")}};f.prototype.execute=function(k){i.prototype.execute.call(this,k)};f.prototype.getMode=function(){return this._private._command._mode};f.prototype.setMode=function(k){if((typeof k!=="string"&&typeof k!=="number")||(!b.CmdMode.hasOwnProperty(k)&&(k<0||k>b.CmdMode.NESTED))){throw new Error("CommandHandler.setMode : command mode value illegal. The command mode must be defined on mod_CommandHandler.CmdMode")}if(!this._private._command._instance){this._private._command._mode=k}else{throw new Error("CommandHandler.setMode : command mode cannot be changed durring command execution")}};f.prototype.getRepeatMode=function(){return this._private._repeatMode};f.prototype.setRepeatMode=function(k){if(typeof k!=="number"||k<0||k>b.RepeatMode.ALWAYS){throw new Error("CommandHandler.setRepeatMode : command repeat mode value illegal. The command repeat mode must be defined on mod_CommandHandler.RepeatMode")}this._private._repeatMode=k};f.prototype.getCSIdentifier=function(){return this._private._command._instance};f.prototype.isUsingComputeServer=function(){return this._private._useComputeServer};f.prototype.setHandlerComponent=function(k){return this._private._handlerState.setHandlerComponent(k)};f.prototype.getHandlerComponent=function(){return this._private._handlerState.getHandlerComponent()};f.prototype.setStateAndSendEvent=function(n){if(!n||!n.state){throw new Error("parameters has to be defined with a non empty and valid state property (mod_CommandHandler.HandlerState) ")}var p=n.state.toUpperCase();if(!b.isValidHandlerState(n.state)){throw new Error("There is no state corresponding to the event "+n.state+" for a CommandHandler")}this._private._command._state=b.HandlerState[p];if(n.event){var o=n.event.toUpperCase();if(j(o)){var l=this.getHandlerComponent();if(!l){throw new Error("There is no HandlerComponent related to this CommandHandler",this)}var k=l.getEventChannel();if(!k){throw new Error("Retrieved eventChannel is undefined")}var m=this.getId();if(!m){throw new Error("handlerIdentfier has to be a non empty string.")}k.publish({event:m+"/"+b.LifeCycleEvents[o],data:{repeated:n.repeated,canceled:n.canceled,notStarted:n.notStarted}})}}};f.prototype.getState=function(){return this._private._command._state};f.prototype.onLifeCycleEvent=function(l,k){if(!l||typeof l!=="string"){throw new Error("identifier has to be a non empty string")}var o=l.toUpperCase();if(!j(o)){throw new Error("The given identifier is not supported by an CommandHandler",l)}if(!k||typeof k!=="function"){throw new Error("cb has to be a function",k)}var n=this.getHandlerComponent();if(!n){throw new Error("There is no HandlerComponent related to this CommandHandler",this)}var m=n.getEventChannel();if(!m){throw new Error("Retrieved eventChannel is undefined")}var p=this.getId();if(!p){throw new Error("handlerIdentfier has to be a non empty string.")}return m.subscribe({event:p+"/"+o},k)};f.prototype.removeLifeCycleEventSubscription=function(k){if(undefined===k){throw new Error("token has to be defined")}var m=this.getHandlerComponent();if(!m){throw new Error("There is no HandlerComponent related to this CommandHandler",this)}var l=m.getEventChannel();if(!l){throw new Error("Retrieved eventChannel is undefined")}var n=this.getId();if(!n){throw new Error("handlerIdentfier has to be a non empty string.")}return l.unsubscribe(k)};e.CommandHandler=f;return e});define("DS/WAfrExecutionContext/mod_ExecutionContext",["UWA/Utils","UWA/Core","DS/WAfrExecutionContext/mod_Component","UWA/Class/Promise","DS/WAfrUtils/PerformanceHelper","DS/WAfrUtils/Logger","DS/WAfrContainer/App"],function(a,f,b,c,p,i,q){var r=Object.create(null);function g(t){var v={};var w=function(A){var z=A.split("==");if(z.length!==2){throw new Error("Bad syntax, expected expression like A == B, found "+A)}var y=z[0].trim();var x=z[1].trim();if(y.indexOf('"')>=0||x.indexOf('"')>=0){throw new Error('Bad syntax, key and value should not contain double quote ", found '+A)}if(y.indexOf(" ")>=0||x.indexOf(" ")>=0){throw new Error("Bad syntax, key and value should not contain space, found "+A)}v[y]=x};if(t.indexOf("&&")>=0){var u=t.split("&&");if(u.length<2){throw new Error("Bad syntax, expected expression like A == B && C == D, found "+t)}u.forEach(w)}else{w(t)}return v}function k(v,u,w){var t=true;Object.keys(u.when).forEach(function(x){t=t&&(u.when[x]===v[x])});if(t&&!u.fit){u.fit=true;!w&&u.onDidFitContext&&u.onDidFitContext(u.element)}else{if(!t){u.fit=false;!w&&u.onDidUnfitContext&&u.onDidUnfitContext(u.element)}}return u.fit}function d(t){return{current:0,next:function(){if(this.current>=t.length){return null}return t[this.current++]}}}function m(u){var x=b.Component.prototype;var v=Object.keys(x);for(var t=0;t<v.length;t++){const w=v[t];if(!u.hasOwnProperty(w)){return false}}return true}function s(v,u,t){if(!v(t)){return t}return u(t).then(s.bind(null,v,u))}function e(G){var B=G.iterator;var w=G.action;var C=G.generatedData;var y=G.inverse;if(w===null||typeof w!=="function"){throw new Error("The action cannot be null and must be a function returning a promise")}var x=[];var A=[];var E=[];var v=[];var u=B.next();var z=null;var D=0;while(u){z=C?C[D]:null;if(u.canBeParallelized()){x.push(u);E.push(z)}else{if(y){A.unshift(u);v.unshift(z)}else{A.push(u);v.push(z)}}u=B.next();D+=1}var t=function(){if(!A||A.length<=0){return c.resolve()}else{return s(function(H){return H<A.length},function(H){return w(A[H],v[H]).then(function(){return ++H})},0).then(function(H){return c.resolve(H)})["catch"](function(H){return c.reject(H)})}};var F=function(){var J=x.length;var I=null;var H=[];for(D=y?J-1:0;y?D>=0:D<J;y?--D:++D){z=E[D];I=w(x[D],z);H.push(I)}return c.all(H)};if(y){return F().then(t)}else{return t().then(F)}}function j(t,u){return{current:0,next:function(){var w;while(this.current<t.length&&!w){var v=t[this.current];w=u[v].component;this.current+=1}return w}}}function h(x,u,t){var w,v;var y=x._appComponents.length+x._stdComponents.length;if(t){for(v=y-1;v>=0;v--){if(v>=x._appComponents.length){w=x._stdComponents[v-x._appComponents.length]}else{w=x._appComponents[v]}u(x._components[w],w)}}else{for(v=0;v<y;v++){if(v>=x._stdComponents.length){w=x._appComponents[v-x._stdComponents.length]}else{w=x._stdComponents[v]}u(x._components[w],w)}}}function n(v,t,u){if(u){b.Component.implementsBy(v)}else{b.StandardComponent.implementsBy(v)}return new v(t)}var l=function(t){return{getId:t.getId.bind(t),getComponent:function(u){return t.getComponent(u,true)},registerComponent:function(v,u){t.registerApplicationComponent(v,u)},createAndRegisterComponent:t.createAndRegisterApplicationComponent.bind(t),unregisterComponent:t.unregisterApplicationComponent.bind(t),isRegisteredComponent:t.isRegisteredComponent.bind(t),recycleComponent:t.recycleComponent.bind(t),getData:function(){},getSourceApp:t.getSourceApp.bind(t),getTargetApp:t.getTargetApp.bind(t),getComponents:function(u){return t.getComponents(u,true)},getContext:function(){return f.clone(t._contexts)},setContext:t.setContext.bind(t)}};var o=function(t){t=f.merge(t||{},{config:{components:[],interpreters:[]}});this._id=t.id||a.getUUID();this._config=t.config;this._config.interpreters=this._config.interpreters||[];this._components=Object.create(null);this._stdComponents=[];this._appComponents=[];this._contextualElements=[];this._handlers={};this.exposedApi=l(this);this.applicationContext=this.exposedApi;this._version=null;this._container=t.container;this._contexts=Object.create(null);this.onWillLoadApp=null;this.onDidLoadApp=null;this.onDidFailToLoadApp=null;this.onDidContextualComponentsUpdate=null;this._container=t.container;if(this._container){var u=this;this._container.subscribe("onReuseContext."+this.getId(),function(v){u.load(v)})}};r.ExecutionContext=o;o.prototype.setUiContainer=function(t){this._view=t};o.prototype.getUiContainer=function(){return this._view};o.prototype.getTargetApp=function(){return this._targetApp};o.prototype.getSourceApp=function(){return this._sourceApp};o.prototype.getId=function(){return this._id};o.prototype.getComponent=function(w,u){if(w===undefined||w===null){throw new Error("Invalid identifier "+w)}var t=this._components[w];if(!t){return undefined}var v=t.component;if(!v){return undefined}if(u&&v.getExposedComponent&&v.getExposedComponent()){return v.getExposedComponent()}else{if(u&&t.standard){return undefined}}return v};o.prototype.cleanComponent=function(v,x){if(!v){throw new Error("Component must be defined ")}var u=v.getRegisteredIdentifier();if(u===undefined||u===null||typeof u!=="string"){throw new Error("Invalid identifier "+u)}var t=this._components[u];if(!t){throw new Error("The MetaData for this component do not exists")}var w=this;i.log("[Execution context] clean component "+u);var y=v.clean()||c.resolve();if(t.recycled&&t.context){t.recycled=k(w._contexts,t.context,true)}if((!t.recycled&&!t.standard)||(t.standard&&t.context)){return y.then(function(){i.log("[Execution context] destroy component "+u);return v.destroy()}).then(function(){i.log("[Execution context] Remove component "+u+" from execution context");w.removeComponent(t,x&&!t.standard);return c.resolve(v)})}else{t.recycled=false;return y.then(function(){return c.resolve(v)})}};o.prototype.unregisterComponent=function(w,u){if(w===undefined||w===null||typeof w!=="string"){throw new Error("Invalid identifier "+w)}if(this._components[w]!==undefined){var t=this._components[w];if(t.standard&&u){throw new Error("Invalid access, try to unregister a standard component from application side")}var v=t.component;var x=this;i.log("[Execution context] clean component "+w);var y=v.clean()||c.resolve();return y.then(function(){i.log("[Execution context] destroy component "+w);return v.destroy()}).then(function(){i.log("[Execution context] Remove component "+w+" from execution context");x.removeComponent(t,true);return c.resolve(v)})}return c.resolve()};o.prototype.isRegisteredComponent=function(w){if(!w){throw new Error("The component is null or undefined")}var t=false;var v=w.getRegisteredIdentifier();var u=this._components[v];if(u&&u.component){if(u.component===w||(u.component.getExposedApi&&u.component.getExposedApi()===w)){t=true}}return t};o.prototype.cleanComponents=function(t){var u=this;return e({action:function(v){return u.cleanComponent(v,t?t.removeForGood:false)},inverse:true,iterator:t&&t.iterator?t.iterator:j(u._appComponents.concat(u._stdComponents),u._components)})};o.prototype.recycleComponent=function(u){if(u===undefined||u===null||typeof u!=="string"){throw new Error("Invalid identifier "+u)}var t=this._components[u];if(!t){return false}if(t.standard){throw new Error("Cannot recycle a standard component")}if(t.recycled){return false}t.recycled=true;return true};o.prototype.isComponentRecycled=function(u){if(u===undefined||u===null||typeof u!=="string"){throw new Error("Invalid identifier "+u)}var t=this._components[u];if(!t){return false}return t.recycled};o.prototype.getComponents=function(t,u){if(!t){throw new Error("Predicate function is mandatory")}var w=[];var v;var x=this;h(this,function(y,z){v=x.getComponent(z,u);if(v){if(t(v)){w.push(v)}}});return w};o.prototype.registerComponent=function(w,v,x,u){if(w===undefined||w===null||typeof w!=="string"){throw new Error("Invalid identifier "+w)}if(v===undefined||v===null){throw new Error("Component cannot be null")}if(u){if(!m(Object.getPrototypeOf(v))&&!m(v)){throw new Error("the given component do not contains some methods of DS/WAfrExecutionContext/mod_Component")}}if("setExecutionContext" in v===false||"setRegisteredIdentifier" in v===false){throw new Error("The component do not implements module:DS/WAfrExecutionContext/mod_Component~Component. Use applyComponentMixin first from the context.")}if(this._components[w]){throw new Error("An component has already been registered with this identifier "+w)}var y=x?this._appComponents:this._stdComponents;var t={standard:!x,position:y.length};this._components[w]=t;y.push(w);this.registerComponentThruMetaData(w,t,v)};o.prototype.removeComponent=function(t,x){if(!t){throw new Error("You must provide a metaData")}if(!t.component){throw new Error("The component is already removed")}var v=t.component.getRegisteredIdentifier();t.component.setExecutionContext(null);t.component.setRegisteredIdentifier(null);delete t.component;if(x){var u=t.position;var w=t.standard?this._stdComponents:this._appComponents;w.splice(u,1);delete this._components[v]}};o.prototype.registerComponentThruMetaData=function(w,u,v){if(!u){throw new Error("The metaData do not exist")}if(u.component){throw new Error("The component is already created")}if(!v){if(!u.ctor){throw new Error("The Component constructor must be defined. Have been the component "+w+"required ?")}if(typeof u.ctor!=="function"){throw new Error(" Component constructor must be a constructor (i.e. functions)")}v=n(u.ctor,u.options,!u.standard)}u.component=v;var y=!u.standard?this.exposedApi:this;u.component.setExecutionContext(y);u.component.setRegisteredIdentifier(w);var x=u.component.createExposedComponent&&u.component.createExposedComponent();if(x){b.Component.mixinProperties(x);x.setExecutionContext(this.exposedApi);x.setRegisteredIdentifier(w);u.component.setExposedComponent(x)}else{var z=u.component.getExposedComponentCtor&&u.component.getExposedComponentCtor();if(z){var t=n(z,undefined,true);t.setExecutionContext(this.exposedApi);t.setRegisteredIdentifier(w);u.component.setExposedComponent(t)}}return u.component};o.prototype.createAndRegisterComponent=function(v,x,u,w){if(this._components[v]){return undefined}var t=n(x,u,w);this.registerComponent(v,t,w);if(!this._components[v]){throw new Error("The metaData for component do not exist !")}this._components[v].ctor=x;return t};o.prototype.requireStandardComponents=function(t,z){var y=this;if(t.length!==z.length){throw new Error("Modules and keys do not have the same size !")}var w,v,u,A,x;return new c(function(C,B){require(t,function(){var D;for(w=0;w<arguments.length;w+=1){v=arguments[w];u=z[w];D=y._components[u];A=D.ctorImport;x=A?v[A]:v;D.ctor=x;y.registerComponentThruMetaData(u,D)}C()},B)})};o.prototype.registerStandardComponents=function(){i.log("[Execution context] Register standard components if need ");var y=this;if(y._stdComponents.length>0){var t=[];var x=[];var v;var w=[];h(this,function(z,A){if(z.standard&&z.context){v=k(y._contexts,z.context,true);if(!z.component){if(v){t.push(z.module);x.push(A)}}else{if(!v&&z.component){w.push(z.component)}}}});return y.cleanComponents({iterator:d(w)}).then(function(){return y.requireStandardComponents(t,x)})}var u=y.parseComponents(y._config.components);y._components=f.merge(y._components,u.metaDatas);y._stdComponents=u.componentsKeys;return y.requireStandardComponents(u.readyModules,u.readyKeys)};o.prototype.initializeStandardComponents=function(u){var v=this;var t=null;return e({action:function(w,x){t=w.getCurrentInterpreter&&w.getCurrentInterpreter();if(t&&t.commit){t.commit(v,{componentId:w.getRegisteredIdentifier()})}return w.initialize(x)},generatedData:u.generatedData,iterator:u&&u.iterator?u.iterator:j(this._stdComponents,this._components)})};o.prototype.configureComponents=function(t){return e({action:function(u){return u.configure()},iterator:t&&t.iterator?t.iterator:j(this._stdComponents,this._components)})};o.prototype.cleanStandardComponents=function(){return e({action:function(t){return t.clean()},iterator:j(this._stdComponents,this._components)})};o.prototype.parseApplicativeComponents=function(t){this._appConfig={components:t};return this.parseComponents(t,true)};o.prototype.registerApplicationComponent=function(u,t){if(!t){throw new Error("Component is null")}return this.registerComponent(u,t,true,true)};o.prototype.createAndRegisterApplicationComponent=function(u,v,t){if(!v){throw new Error("Component is null")}return this.createAndRegisterComponent(u,v,t,true)};o.prototype.createAndRegisterApplicationComponentsList=function(v){i.log("[Execution Context] Register Application Components :"+v);if(v){for(var u=0;u<v.length;u++){var t=v[u];this.createAndRegisterApplicationComponent(t.key,t.mod,t.options)}}};o.prototype.getApplicationComponent=function(t){return this.getComponent(t,true)};o.prototype.unregisterApplicationComponent=function(t){return this.unregisterComponent(t,true)};o.prototype.isRegisteredApplicationComponent=function(t){return this.isRegisteredComponent(t)};o.prototype.recycleApplicationComponent=function(v,u){if(u){var t=u.metaDatas[v];if(!t){throw new Error('The App "'+this._targetApp.getId()+'" has requested to recyle the component "'+v+'" but do not declare it in its list of components :\n'+JSON.stringify(u.metaDatas,null,2))}}return this.recycleComponent(v)};o.prototype.isApplicationComponentRecycled=function(t){return this.isComponentRecycled(t)};o.prototype.prepareTransition=function(u){var x=this;var t;var w=0;var v;if(!this._sourceApp){return c.resolve(u)}return this._sourceApp.onWillLeave(this._targetApp).then(function(){return x._targetApp.onWillEnter(x._sourceApp)}).then(function(){var G=x._targetApp.getTransitionFrom(x._sourceApp.getId());if(!G){G=x._targetApp.getTransitionFromFamily(x._sourceApp.getFamily())}if(G){var E=G.components||{};var A=G.handlers||{};if(E.keep){if(E.keep==="@all"){for(t in x.applicationContext._components){x.recycleApplicationComponent(t,u)}}else{if(Array.isArray(E.keep)){for(;w<E.keep.length;w++){v=E.keep[w];x.recycleApplicationComponent(v,u)}}}}if(A.keep&&Array.isArray(A.keep)){var I=x._sourceApp.options.appConfig.handlers.check;var F=u.app.options.appConfig.handlers.check;var D=x._sourceApp.options.appConfig.radioGroup.items;var H=u.app.options.appConfig.radioGroup.items;var L="";var z=L;var K=L;var J=x.getComponent(WAfrStandardComponentKey.HandlerComponent);for(w=0;w<A.keep.length;w++){K=A.keep[w];L=z="";for(var C=0;C<I.length;C++){if(I[C].identifier==K){L=I[C].identifier+"-"+I[C].check.identifier+"-"+I[C].uncheck.identifier;break}}for(var C=0;C<F.length;C++){if(F[C].identifier===K){z=F[C].identifier+"-"+F[C].check.identifier+"-"+F[C].uncheck.identifier;break}}if(z===L&&L!=""){var y=J.getCheckState({id:K});x._handlers[K]=y}else{for(var C=0;C<D.length;C++){if(D[C].identifier==K){for(var B=0;B<D[C].items.length;B++){if(J.getRadioItemState({radioId:D[C].identifier,id:D[C].items[B].identifier})==true){L=D[C].identifier+"-"+D[C].items[B].identifier+"-"+D[C].items[B].check.identifier+"-"+D[C].items[B].uncheck.identifier}}}}for(var C=0;C<H.length;C++){if(H[C].identifier==K){for(var B=0;B<H[C].items.length;B++){z=H[C].identifier+"-"+H[C].items[B].identifier+"-"+H[C].items[B].check.identifier+"-"+H[C].items[B].uncheck.identifier;if(z==L){var y=H[C].items[B].identifier;x._handlers[K]=y;break}}}}}}}}return x.cleanComponents({removeForGood:true})}).then(function(){return c.resolve(u)})};o.prototype.initializeApplicativeComponents=function(t){return e({action:function(u,v){return u.initialize(v)},iterator:t&&t.iterator?t.iterator:j(this._appComponents,this._components)})};o.prototype.load=function(u,y){if(!u.appId&&!u.afrAppId){throw new Error("Not found a valid App id from the current Id Card ")}this.onWillLoadApp&&this.onWillLoadApp(u.appId||u.afrAppId);p.checkpoint("load");var x=this;if(!y){y=u.afrVersion||"0.1"}i.log("[Execution context] load new app "+u.appId);x.setInitialContext(u.initialContext);if(x._sourceApp){var z=undefined;if(u.afrTransitionsFrom){z=u.afrTransitionsFrom[x._sourceApp.getId()];if(!z){z=u.afrTransitionsFromFamily?u.afrTransitionsFromFamily[x._sourceApp.getId()]:null}if(z&&z.type==="ReuseContext"){var w=z.components||{};if(w.keep){if(w.keep==="@all"){throw ("TODO")}else{if(Array.isArray(w.keep)){var t={};for(var v=0;v<w.keep.length;v++){var B=w.keep[v];var A=x._components[B];if(A.context&&A.context.fit===true){Object.keys(A.context.when).forEach(function(C){t[C]=A.context.when[C]})}}Object.keys(t).forEach(function(C){var D=t[C];if(D!==undefined&&D!==null){x._contexts[C]=String(D)}})}}}}}}p.checkpoint("registerStandardComponents");return x.registerStandardComponents().then(function(){p.checkpoint("registerStandardComponents");p.checkpoint("loadApp");return x.loadApp(u)}).then(function(C){p.checkpoint("loadApp");x._targetApp=C.app;if(!x._targetApp){throw new Error("Not found a target app !")}p.checkpoint("prepareTransition");return x.prepareTransition(C)}).then(function(C){p.checkpoint("prepareTransition");x._components=f.merge(x._components,C.metaDatas);x._appComponents=C.componentsKeys;p.checkpoint("interpret");var H=false;for(var G in x._handlers){H=false;for(var F=0;F<u.handlers.check.length;F++){if(u.handlers.check[F].identifier===G){u.handlers.check[F].defaultState=x._handlers[G];H=true}}if(!H){var E="default";for(var D=0;D<u.radioGroup.items.length;D++){if(u.radioGroup.items[D].identifier===G){u.radioGroup.items[D][E]=x._handlers[G]}}}}return x.interpret(u,y)}).then(function(C){p.checkpoint("interpret");i.log("[Execution context] Initialize standard components");p.checkpoint("initializeStandardComponents");return x.initializeStandardComponents(C)}).then(function(){p.checkpoint("initializeStandardComponents");p.checkpoint("initializeApplicativeComponents");i.log("[Execution context] Initialize applicative components");return x.initializeApplicativeComponents()}).then(function(){p.checkpoint("initializeApplicativeComponents");p.checkpoint("configureStandardComponents");i.log("[Execution context] Configure standard components");return x.configureComponents()}).then(function(){p.checkpoint("configureStandardComponents");p.checkpoint("initializeApp");i.log("[Execution context] Initialize application");return x.initializeApp()}).then(function(C){p.checkpoint("initializeApp");i.log("[Execution context] set the target app "+x._targetApp+" as source app");if(C){i.warn("[WARNING] App should use the UIFrame component to add UI to their App");C.inject(x.getUiContainer())}if(x.getSourceApp()&&!x.getSourceApp().isDisposeCalled()){x.getSourceApp().dispose()}x._sourceApp=x._targetApp;x._targetApp=null;p.checkpoint("load");x.onDidLoadApp&&x.onDidLoadApp();return c.resolve()})["catch"](function(C){x.onDidFailToLoadApp&&x.onDidFailToLoadApp(C);return c.reject(C)})};o.prototype.loadApp=function(u){var t=this;return new c(function(D,F){var z=u.afrCode;if(!z){z="DS/WAfrAppManager/App"}z=z.replace(/\./g,"/");var x=t.parseComponents(u.components||[],true);var E=[z].concat(x.readyModules);i.log("[Execution Context] Require modules "+E);var y,C,v,w,B,A;require(E,function(){var G=arguments[0];if(arguments.length!==x.readyKeys.length+1){throw new Error("The count of arguments and components do not fit")}for(y=0;y<x.readyKeys.length;y++){C=x.readyKeys[y];v=x.metaDatas[C];w=arguments[y+1];B=v.ctorImport;A=B?w[B]:w;v.ctor=A;t.registerComponentThruMetaData(C,v)}var H=new G({appConfig:u});if(H instanceof q===false){F(new Error("The app loaded is not an instance of DS/WAfrAppManager/App"));return}if(!H.getId()){F(new Error("The app loaded do not have an id"));return}i.log("[App Interpreter] Success require App and components ");D({app:H,metaDatas:x.metaDatas,componentsKeys:x.componentsKeys})},F)})};o.prototype.interpret=function(u,y){i.log("[Execution context] Start interpret id card");var B=[];var x=this._version!==y;var v;if(!this._interpreters){this._interpreters=[];for(v=0;v<this._config.interpreters.length;v++){var A=this._config.interpreters[v].module;this._interpreters.push(A.generateInterpreter(y))}x=false}for(v=0;v<this._interpreters.length;v++){var C=this._interpreters[v];if(x){C=this._config.interpreters[v].module.generateInterpreter(y);this._interpreters[v]=C}var w=this._config.interpreters[v].target;var z=w?this.getComponent(w):undefined;z&&z.setCurrentInterpreter(C);if(!C){B.push(c.resolve(null))}else{var t=C.interpret(u,this,{componentId:this._config.interpreters[v].target});B.push(t)}}return c.all(B)};o.prototype.initializeApp=function(){var v=this.getTargetApp();if(!v){return c.reject(new Error("No app has been loaded by the interpreter !"))}var t=this;v._executionContext=this.exposedApi;v.setContainer(t._container?t._container._view:null);var u=new c(function(x,w){if(!v){return}var y=v.setUp({sourceApp:t._sourceApp,done:function(z){x(z)},failure:function(z){w(z)}});if(y){y.then(x,w)}});return u};o.prototype.dispose=function(){this._timerHandle&&clearTimeout(this._timerHandle);this._timerHandleTreatment&&clearTimeout(this._timerHandleTreatment);var t=this;this._sourceApp&&this._sourceApp.dispose();h(this,function(u){if(u.component){u.component.clean(true);u.component.destroy(true);u.component.setExecutionContext(null);t.removeComponent(u)}},true);delete this._components;delete this._stdComponents;delete this._appComponents;delete this.exposedApi;delete this._contexts;this.onWillLoadApp=null;this.onDidLoadApp=null;this.onDidFailToLoadApp=null;this.onDidContextualComponentsUpdate=null;this._container=null;return c.resolve()};o.prototype.registerContextualElement=function(v,u){if(!v||!v.when){throw new Error("The contextual element must be defined and must contain a when expression")}u=u||{};var t={element:v,when:g(v.when),onDidFitContext:u.onDidFitContext,onDidUnfitContext:u.onDidUnfitContext};this._contextualElements.push(t);k(this._contexts,t);return t};o.prototype.onDidChangeContext=function(){this._timerHandle=null;var t=this._contexts;h(this,function(u){if(u.context){k(t,u.context)}});this._contextualElements.forEach(function(u){k(t,u)})};o.prototype.parseComponents=function(w,z){var A=[];var u=[];var B={};var v=[];var y;var t;var x=this;w.forEach(function(C){y=true;t={module:C.code,ctorImport:C.ctor,options:C.options,standard:!z,position:v.length};B[C.key]=t;v.push(C.key);if(C.when){t.context={element:C.key,when:g(C.when),onDidFitContext:x.onDidFitContextForComponent.bind(x),onDidUnfitContext:x.onDidUnFitContextForComponent.bind(x)};y=k(x._contexts,t.context,true)}if(y){A.push(C.code);u.push(C.key)}});return{readyModules:A,readyKeys:u,metaDatas:B,componentsKeys:v}};o.prototype.onDidFitContextForComponent=function(u){var t=this._components[u];if(!t||!t.context){return}if(!t.context.fit){throw new Error("Unexpected state of context")}this._timerHandleTreatment&&clearTimeout(this._timerHandleTreatment);this._timerHandleTreatment=setTimeout(this.onDidProcessContextualComponent.bind(this),0)};o.prototype.onDidUnFitContextForComponent=function(u){var t=this._components[u];if(!t||!t.context){return}if(t.context.fit){throw new Error("Unexpected state of context")}this._timerHandleTreatment&&clearTimeout(this._timerHandleTreatment);this._timerHandleTreatment=setTimeout(this.onDidProcessContextualComponent.bind(this),0)};o.prototype.setInitialContext=function(t){var v=Object.create(null);var u;Object.keys(t||v).forEach(function(w){u=t[w];if(u!==undefined&&u!==null){v[w]=String(u)}});this._contexts=v};o.prototype.setContext=function(u,v){var t=this._contexts[u];if(t!==v){if(!v){delete this._contexts[u]}else{this._contexts[u]=String(v)}if(this._timerHandle){clearTimeout(this._timer)}this._timerHandle=setTimeout(this.onDidChangeContext.bind(this,this._contexts),0)}return this};o.prototype.onDidProcessContextualComponent=function(){var t=[];var w=[];var v=[];var x=[];var y=[];var u=this;h(this,function(z,A){if(z.context){if(z.context.fit&&!z.component){if(!z.ctor){t.push(z.module);w.push(A)}else{u.registerComponentThruMetaData(A,z);if(z.standard){x.push(z.component)}else{y.push(z.component)}}}else{if(!z.context.fit&&z.component){v.push(z.component)}}}});this._timerHandleTreatment=null;return new c(function(E,D){var A,C,B,z;require(t,function(){for(A=0;A<arguments.length;A++){C=arguments[A];B=w[A];z=u._components[B];z.ctor=C;z=u._components[B];u.registerComponentThruMetaData(B,z);if(z.standard){x.push(z.component)}else{y.push(z.component)}}E()},D)}).then(function(){return u.cleanComponents({iterator:d(v)})}).then(function(){return u.initializeStandardComponents({iterator:d(x)})}).then(function(){return u.initializeApplicativeComponents({iterator:d(y)})}).then(function(){return u.configureComponents({iterator:d(x)})}).then(function(){u.onDidContextualComponentsUpdate&&u.onDidContextualComponentsUpdate();return c.resolve()})};return r});define("DS/WAfrContainer/Container",["UWA/Core","UWA/Class/Promise","DS/Core/Core","DS/WAfrExecutionContext/mod_ExecutionContext","DS/PlatformAPI/PlatformAPI","DS/WAfrUtils/Logger","DS/WAfrUtils/PerformanceHelper","WebappsUtils/WebappsUtils","DS/WAFData/WAFData"],function(d,g,f,k,i,j,a,c,h){var e=k.ExecutionContext;var b=function(n){var l={view:null,debug:false,infraComponents:[],proxified:false,baseUrl:c.getWebappsBaseUrl()};var o=l;o=d.extend(d.clone(l),n);this._proxified=o.proxified;this._view=o.view;if(!this._view){throw new Error("A view must be defined for the container")}this.id=this._view.getId();this._executionContexts=[];this._currentExecutionContext=-1;this._config=o.config;this._registeredInfraComponents=o.standardComponents;this._baseUrl=o.baseUrl;this._version=null;var m=this.destroy.bind(this);this._view.addEvent("onDestroy",m);this._restoreContextsIfNeed();var p=this;this.subscribe("onCreateContext."+this.id,function(q){p.createNewExecutionContext();p.loadCurrentConfig(q)});Object.defineProperty(this,"currentApp",{get:function(){var r=this.getCurrentExecutionContext();if(r){var q=r.getSourceApp();if(q){return q}}return undefined}});Object.defineProperty(this,"lang",{get:function(){return this._view.getLanguage()}});Object.defineProperty(this,"productTitle",{get:function(){return this._view.getValue("afrProductTitle")}})};b.prototype.destroy=function(){this._executionContexts.map(function(l){return l.dispose()});this._executionContexts=[];this._currentExecutionContext=-1;this._view.setValues({afrCode:undefined,afrAppId:undefined,appId:undefined,title:undefined,afrDebug:undefined,components:undefined});this._view.destroy();return g.resolve()};b.prototype._restoreContextsIfNeed=function(){var p=this._view.getValue("afrExecutionContexts")||[];var l=this._view.getValue("afrCurrentExecutionContextIdx")||0;var o=this._view.getValue("afrAppId");if(p.length>0&&!o){j.warn("A context has been found "+JSON.stringify({contexts:p})+" but the app id is null,Ignore the restoration of the saved context");p=[]}if(p.length===0){var n=this.createNewExecutionContext();p.push({id:n.getId(),currentappId:null});l=this._currentExecutionContext}else{var m=0;for(m=0;m<p.length;m++){this.createNewExecutionContext(p[m].id)}if(l<0||l>=p.length){throw new Error("The current context index must be in the range of the list of contexts")}this._currentExecutionContext=l}this._view.setValue("afrExecutionContexts",p.slice());this._view.setValue("afrCurrentExecutionContextIdx",l);this._view.setValue("afrAppId",o)};b.prototype.createNewExecutionContext=function(m){var l=new e({id:m,container:this,config:this._config});this._executionContexts.push(l);this._currentExecutionContext=this._executionContexts.length-1;this._view.addExecutionContextView(l,this.onChangeExecutionContext.bind(this));return l};b.prototype.onChangeExecutionContext=function(l){};b.prototype.requestWAfrService=function(u,t){if(!this._configService){return g.resolve()}if(t&&!u){throw new Error("Must provide an app id to call the transition service")}u=u||this._configService.afrAppId||this._configService.appId;var v=this._configService.afrService;var l="GET";var q;if(t){v=v.replace("/apps","/transition");l="POST";q={containers:[{id:this.id,contexts:this._view.getValue("afrExecutionContexts"),currentIndex:this._view.getValue("afrCurrentExecutionContextIdx")}],currentIndex:0}}v+=u;if(!v.startsWith("http")){var s=this._baseUrl;var m=s.split("/");if(m.length>=2){var r=m[2].split(":");var p=r[0];var n="";if(r.length>1&&!this._configService.afrServicePort){n=":"+r[1]}if(this._configService.afrServicePort){n=":"+this._configService.afrServicePort}v=m[0]+"//"+p+n+"/"+v}}if(this.lang){v+="?lang="+this.lang}var o=this._proxified?"proxifiedRequest":"request";return new g(function(x,w){h[o](v,{type:"json",responseType:"json",method:l,data:q,onComplete:function(y){x(y)},onFailure:function(y){y.url=v;w(y)}})})};b.prototype.loadCurrentConfig=function(n){a.checkpoint("requestWAfrService");var l=n||this.getCurrentConfig();this._configService=null;if(l.afrService){this._configService=l}if(!l.title||l.title==="Apps supporting transition"){l.title=this._view.getTitleHeader().appTitle}var m=this.getCurrentExecutionContext();return this.requestWAfrService().then(function(o){a.checkpoint("requestWAfrService");return m.load(o||l)})};b.prototype.launchApp=function(n,m){var l=this.id;return new g(function(p,o){var q="DS/i3DXCompassServices/i3DXCompassPubSub";require([q],function(r){r.subscribe("launchAppCallback",function(t){if(t.response==="COMPLETE"){p()}else{o()}});var s={widgetId:l,appId:n};s=d.extend(s,m);r.publish("launchApp",s)})})};b.prototype.getCurrentConfig=function(){var l=d.clone(this._view.getValues());var m=this._view.getTitleHeader();l.appId=this._view.getValue("afrAppId")||this._view.getValue("appId");l.title=this._view.getValue("title")||this._view.getTitle();if(l.title===l.brand){l.title=m.appTitle}return l};b.prototype.publish=function(l,m){i.publish(l,m)};b.prototype.subscribe=function(l,m){i.unsubscribe(l);i.subscribe(l,m)};b.prototype.getCurrentExecutionContext=function(){if(this._currentExecutionContext<0){return null}return this._executionContexts[this._currentExecutionContext]};b.prototype.registerInfraComponents=function(o){for(var n=0;n<this._registeredInfraComponents.length;n++){var l=this._registeredInfraComponents[n];var m=l.DEFAULT_COMPONENT_NAME;o.createAndRegisterComponent(m,l,{container:this})}};b.prototype.updateTitle=function(l,m){if(!m){const n=this.getCurrentExecutionContext();if(n){m=n.getTargetApp()||n.getSourceApp()}}if(m){l.appTitle=l.appTitle||m.getTitle()||this._view.getValue("title");l.brand=l.brand||m.getBrand()||this._view.getValue("brand")}this._view.setValue("afrProductTitle",l.title);this._view.setTitleHeader(l)};return b});define("DS/WAfrHandlers/private/private_ActionHandlerUtilities",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities"],function(d,b){var a=Object.create(null);function c(e){if(!this.actionHandler){throw new Error("this.action is undefined. A problem occurred when calling this function.")}var i=this.actionHandler;var g=i.getHandlerComponent();if(!g){throw new Error("There is no HandlerComponent related to this ActionHandler",i)}var f=g.getEventChannel();if(!f){throw new Error("Retrieved eventChannel is undefined")}var h=i.getId();if(!h){throw new Error("handlerIdentfier has to be a non empty string.")}f.publish({event:h+"/END"});console.log("Action "+i.getId()+" view updated: action Ended");if(!e){var j=d.getErrorManager();e=d.createReturnObject(j.SUCCEEDED)}if(this.cb&&typeof this.cb==="function"){this.cb(e)}else{if(e&&!d.hasSucceeded(e)){throw e.getError()}}}a.executeActionHandler=function(g){var h=g.handler;var e=g.cb;if(!h){throw new Error("actionHandler has to be defined and cannot be null")}var f=h.getHandlerComponent();if(!f){console.warn("NO HANDLER COMPONENT SET");throw new Error()}else{if(!f.getExecutionContext()){console.warn("NO EXECUTION CONTEXT SET");throw new Error()}}if(e===null||typeof e!=="function"){e=undefined}require([h._private._action._module],function(p){var m=d.getErrorManager();var o;if(p){var j=p[h._private._action._func];if(j&&typeof j==="function"){var k=Object.create(null);k.cb=e;k.actionHandler=h;var i=h.getHandlerComponent();var n=Object.create(null);n.executionContext=i.getExecutionContext().applicationContext;n.args=b.computeArgs(h,g.args);var i=h.getHandlerComponent();if(!i){throw new Error("There is no HandlerComponent related to this ActionHandler",h)}var q=i.getEventChannel();if(!q){throw new Error("Retrieved eventChannel is undefined")}var l=h.getId();if(!l){throw new Error("handlerIdentfier has to be a non empty string.")}q.publish({event:l+"/BEGIN"});j(c.bind(k),n)}else{o=d.createReturnObject(m.FAILED,{description:"Unknown function "+h._private._action._func+" in "+h._private._action._module})}}else{o=d.createReturnObject(m.WRONG_VALUE,{description:"Module require return undefined"})}if(o){if(e){e(o)}else{if(!d.hasSucceeded(o)){throw o.getError()}}}},function(){if(e&&typeof e==="function"){var j=d.getErrorManager();var i=d.createReturnObject(j.FAILED,{description:"Require failed ("+h._private._action._module+")"});e(i)}else{throw i.getError()}})};return a});define("DS/WAfrHandlers/mod_ActionHandler",["DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/private/private_ActionHandlerUtilities","DS/WAfrHandlers/mod_LeafHandler","DS/WAfrHandlers/mod_HandlerComponent"],function(d,j,c){var e=Object.create(null);var i=c.LeafHandler;var f=c.StandaloneLeafHandlerState;var g="ACTION_HANDLER";d.registerLeafHandler(g,{executeFunc:j.executeActionHandler});e.LifeCycleEvents={BEGIN:"BEGIN",END:"END"};function h(k){return Boolean(k)&&e.LifeCycleEvents.hasOwnProperty(k)}function b(k){f.call(this,k)}d.inherit(b,f);b.prototype.execute=function(m){var k=m?m.cb:undefined;var l=m?m.args:undefined;return j.executeActionHandler({handler:this._handler,cb:k,args:l})};function a(k){i.call(this,k);if(!k){throw new Error("parameters has to be defined")}if(!k.module||typeof k.module!=="string"){throw new Error("parameters.module has to be defined and to be a non empty string")}if(!k.func||typeof k.func!=="string"){throw new Error("parameters.func has to be defined and to be a non empty string")}if(!this._private){this._private=Object.create(null)}this._private._type=d.enums.HandlerType[g];this._private._action=Object.create(null);this._private._action._module=k.module;this._private._action._func=k.func;this._private._handlerState=new b(this)}d.inherit(a,i);a.prototype.makeStandalone=function(){if(!(this._private._handlerState instanceof b)){this._private._handlerState=new b(this)}else{throw new Error("Call makeStandalone method on an ActionHandler which is already a standalone item")}};a.prototype.execute=function(k){i.prototype.execute.call(this,k)};a.prototype.setHandlerComponent=function(k){return this._private._handlerState.setHandlerComponent(k)};a.prototype.getHandlerComponent=function(){return this._private._handlerState.getHandlerComponent()};a.prototype.onLifeCycleEvent=function(l,k){if(!l){throw new Error("identifier has to be a non empty string")}var o=l.toUpperCase();if(!h(o)){throw new Error("The given identifier is not supported by an ActionHandler",l)}if(!k||typeof k!=="function"){throw new Error("cb has to be a function",k)}var n=this.getHandlerComponent();if(!n){throw new Error("There is no HandlerComponent related to this ActionHandler",this)}var m=n.getEventChannel();if(!m){throw new Error("Retrieved eventChannel is undefined")}var p=this.getId();if(!p){throw new Error("handlerIdentfier has to be a non empty string.")}return m.subscribe({event:p+"/"+o},k)};a.prototype.removeLifeCycleEventSubscription=function(k){if(undefined===k){throw new Error("token has to be defined")}var m=this.getHandlerComponent();if(!m){throw new Error("There is no HandlerComponent related to this ActionHandler",this)}var l=m.getEventChannel();if(!l){throw new Error("Retrieved eventChannel is undefined")}var n=this.getId();if(!n){throw new Error("handlerIdentfier has to be a non empty string.")}return l.unsubscribe(k)};e.ActionHandler=a;return e});define("DS/WAfrHandlers/mod_CheckHandler",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/private/private_CheckHandlerUtilities","DS/WAfrHandlers/mod_Handler","DS/WAfrHandlers/mod_ActionHandler","DS/WAfrHandlers/mod_CommandHandler"],function(d,g,f,n,p,e){var k=n.Handler;var a=p.ActionHandler;var i=e.CommandHandler;var h=Object.create(null);h.StateEvents={CHECK:"CHECK",UNCHECK:"UNCHECK"};function j(q){return Boolean(q)&&h.StateEvents.hasOwnProperty(q)}function c(s,r){var q=false;if(s.beingInitialized()){q=true}else{if((r===s._private._check&&!s._private._isChecked)||(r===s._private._uncheck&&s._private._isChecked)){q=true}}return q}function b(s){var r=false;var q=true;if((s._private._check&&!s._private._check.isAvailable())||(s._private._uncheck&&!s._private._uncheck.isAvailable())){q=false}if(s.isAvailable()!==q){s._private._currentAvailability=q;r=true}return r}function l(r,q){if(r&&q){this._checkHandler=r;this._manager=q}else{throw new Error("manageable and handlerManager have to be define")}}l.prototype.handleExecute=function(t){if(t){var q=t.cb;var s=t.manageable;var r=t.args;if(s!==this._checkHandler._private._check&&s!==this._checkHandler._private._uncheck){throw new Error("Internal error. The manageable calling handle is not managed by this manager.")}if(c(this._checkHandler,s)){this._manager.handleExecute({cb:t.cb,manageable:this._checkHandler,action:!this._checkHandler._private._isChecked,args:r})}else{if(q&&typeof q==="function"){setTimeout(function(){var u=d.getErrorManager();q(d.createReturnObject(u.SUCCEEDED))},0)}}}else{throw new Error("Wrong parameters")}};l.prototype.handleOnAvailabilityChanged=function(s){var r=this._checkHandler;var q=this._manager;var t=b(r);if(t){s.args.newValue=r.isAvailable();s.manageable=r;q.handleOnAvailabilityChanged(s)}};l.prototype.handleIsExecutable=function(){return this._manager.handleIsExecutable({manageable:this._checkHandler})};l.prototype.setState=function(){throw new Error("You can not directly change the state of a CheckHandler which is managed")};l.prototype.setHandlerComponent=function(){console.warn("Impossible to set a HandlerComponent to a CheckHandler which is managed.");return false};l.prototype.getHandlerComponent=function(){return this._manager.getHandlerComponent()};function o(q){if(!q){throw new Error("checkHandler has to be defined")}this._checkHandler=q}o.prototype.handleExecute=function(t){if(t){var q=t.cb;var s=t.manageable;var r=t.args;if(s!==this._checkHandler._private._check&&s!==this._checkHandler._private._uncheck){throw new Error("Internal error. The manageable calling handleExecute is not managed by this manager.")}if(c(this._checkHandler,s)){f.executeCheckHandler(this._checkHandler,{cb:q,action:!this._checkHandler._private._isChecked,args:r})}else{if(q&&typeof q==="function"){setTimeout(function(){var u=d.getErrorManager();q(d.createReturnObject(u.SUCCEEDED))},0)}}}else{throw new Error("Wrong parameters")}};o.prototype.setState=function(t){var u=t.state;var q=t.cb;var r=t.args;if(u!==this._checkHandler._private._isChecked){var s;if(this._checkHandler._private._isChecked){s=this._checkHandler._private._uncheck}else{s=this._checkHandler._private._check}this.handleExecute({cb:q,manageable:s,args:r})}else{setTimeout(function(){var v=d.getErrorManager();q(d.createReturnObject(v.SUCCEEDED))},0)}};o.prototype.setHandlerComponent=function(q){if(q===undefined){throw new Error("component has to be defined")}this._checkHandler._private._handlerComponent=q;return true};o.prototype.getHandlerComponent=function(){return this._checkHandler._private._handlerComponent};o.prototype.handleOnAvailabilityChanged=function(){var q=this._checkHandler;var r=b(q);if(r){g.publishHandlerAvailability(q)}};o.prototype.handleIsExecutable=function(){return this.isAvailable()};function m(q){k.call(this,q);this._private._check=null;this._private._uncheck=null;if(!q||!q.id){throw new Error("Wrong parameters")}this._private._id=q.id;this._private._isChecked=false;this._private._handlerState=new o(this)}g.inherit(m,k);m.prototype.makeStandalone=function(){if(!(this._private._handlerState instanceof o)){this._private._handlerState=new o(this)}else{throw new Error("Call makeStandalone method on an CheckHandler which is already a standalone item")}};m.prototype.makeManaged=function(q){if(!(this._private._handlerState instanceof l)){this._private._handlerState=new l(this,q);delete this._private._handlerComponent}else{throw new Error("Call makeManaged method on an CheckHandler which is already managed")}};m.prototype.validateElement=function(q){return(q instanceof a||q instanceof i)};m.prototype.addElement=function(t,s){var q=false;if(!t||!s||!s.state||(s.state!=="check"&&s.state!=="uncheck")){throw new Error("Imcompatible parameters")}var r="_"+s.state;if(this.validateElement(t)&&!this._private[r]){this._private[r]=t;t.makeManaged(this);this._private._handlerState.handleOnAvailabilityChanged({manageable:this,args:{newValue:t.isAvailable()}});q=true}return q};m.prototype.handleExecute=function(q){return this._private._handlerState.handleExecute(q)};m.prototype.handleIsExecutable=function(q){if(!q||!q.manageable){throw new Error("Wrong parameters")}if(q.manageable!==this._private._check&&q.manageable!==this._private._uncheck){throw new Error("The given manageable is not managed by this CheckHandler")}return this._private._handlerState.handleIsExecutable(q)};m.prototype.getCheckHandler=function(){return this._private._check};m.prototype.getUncheckHandler=function(){return this._private._uncheck};m.prototype.setState=function(r){if(!this.isExecutable()){var s=d.getErrorManager();var q=d.createReturnObject(s.FAILED,{description:"This CheckHandler is not executable"});if(r&&r.cb){setTimeout(function(){r.cb(q)},0)}else{throw q.getError()}}else{this._private._handlerState.setState(r)}};m.prototype.getState=function(){return this._private._isChecked};m.prototype.setHandlerComponent=function(q){return this._private._handlerState.setHandlerComponent(q)};m.prototype.getHandlerComponent=function(){return this._private._handlerState.getHandlerComponent()};m.prototype.handleOnAvailabilityChanged=function(q){if(!q||!q.manageable||!q.args||q.args.newValue===undefined){throw new Error("handleExecute was called using wrong parameters",q)}return this._private._handlerState.handleOnAvailabilityChanged(q)};m.prototype.onStateEvent=function(r,q){if(!r){throw new Error("identifier has to be a non empty string")}var u=r.toUpperCase();if(!j(u)){throw new Error("The given identifier is not supported by a CheckHandler",r)}if(!q||typeof q!=="function"){throw new Error("cb has to be a function",q)}var t=this.getHandlerComponent();if(!t){throw new Error("There is no HandlerComponent related to this CheckHandler",this)}var s=t.getEventChannel();if(!s){throw new Error("Retrieved eventChannel is undefined")}var v=this.getId();if(!v){throw new Error("handlerIdentfier has to be a non empty string.")}return s.subscribe({event:v+"/"+u},q)};m.prototype.removeStateEventSubscription=function(q){if(undefined===q){throw new Error("token has to be defined")}var s=this.getHandlerComponent();if(!s){throw new Error("There is no HandlerComponent related to this CheckHandler",this)}var r=s.getEventChannel();if(!r){throw new Error("Retrieved eventChannel is undefined")}var t=this.getId();if(!t){throw new Error("handlerIdentifier has to be a non empty string.")}return r.unsubscribe(q)};m.prototype.destroy=function(){if(this._private._check){this._private._check.destroy()}if(this._private._uncheck){this._private._uncheck.destroy()}};h.CheckHandler=m;return h});define("DS/WAfrHandlers/mod_RadioHandler",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/mod_Handler","DS/WAfrHandlers/mod_CheckHandler"],function(b,d,h,j){var f=h.Handler;var i=j.CheckHandler;var e=Object.create(null);e.ItemStateEvents={SELECT:"SELECT",UNSELECT:"UNSELECT"};function g(k){return Boolean(k)&&e.ItemStateEvents.hasOwnProperty(k)}function a(n){var m=false;var l=true;var p=n._private._elements;var o=p.length;var k=0;while(k<o&&l){l=p[k].isAvailable();++k}if(l!==n.isAvailable()){n._private._currentAvailability=l;m=true}return m}function c(k){f.call(this,k);this._private._checkedElement=null;this._private._elements=[]}d.inherit(c,f);c.prototype.validateElement=function(k){return k instanceof i};c.prototype.addElement=function(l){var k=false;if(!l||l===this||!l.makeManaged||typeof l.makeManaged!=="function"){throw new Error()}if(this.validateElement(l)){this._private._elements.push(l);l.makeManaged(this);this.handleOnAvailabilityChanged({manageable:this,args:{newValue:l.isAvailable()}});k=true}else{throw new Error("elt is not a valide element to add to a RadioHandler")}return k};c.prototype.getElements=function(){if(!this._private||!this._private._elements||!Array.isArray(this._private._elements)){throw new Error("Internal error")}return this._private._elements};c.prototype.getElementById=function(n){var p=this._private._elements.length;var l=0;var o=false;var k=null;while(!o&&l<p){var m=this._private._elements[l];if(m.getId()===n){o=true;k=m}++l}return k};c.prototype.getSelectedItem=function(){var k=null;var l=this.getSelectedItemId();if(l){k=this.getElementById(l)}return k};c.prototype.setRadioItemState=function(t){var r=t.radioHdlrItemId;var k=t.state;var l=t.cb;var q=t.args;var o=b.getErrorManager();var p;var n;var s=0;var u=this._private._elements.length;for(s=0;s<u;++s){if(this._private._elements[s].getId()===r){n=this._private._elements[s]}}if(!n){p=b.createReturnObject(o.FAILED,{description:"Unknown item: "+r});if(l){setTimeout(function(){l(p)},0)}else{throw p.getError()}}else{if(!this.isExecutable()){p=b.createReturnObject(o.FAILED,{description:"This RadioHandler is not executable"});if(t&&t.cb){setTimeout(function(){l(p)},0)}else{throw p}}else{var m=Object.create(null);m.cb=l;m.manageable=n;m.action=k;m.args=q;this.handleExecute(m)}}};c.prototype.getRadioItemState=function(n){if(!n||typeof n!=="string"){throw new Error("itemId has to be a non empty string")}var l;var m=this._private._elements.length;for(var k=0;k<m;++k){if(this._private._elements[k].getId()===n){l=this._private._elements[k].getState()}}if(l===undefined){throw new Error("This item does not belong to this RadioHandler")}return l};c.prototype.getSelectedItemId=function(){var k;if(this._private._checkedElement){k=this._private._checkedElement.getId()}return k};c.prototype.setHandlerComponent=function(k){if(k===undefined){throw new Error("component has to be define")}this._private._handlerComponent=k;return true};c.prototype.getHandlerComponent=function(){return this._private._handlerComponent};c.prototype.handleOnAvailabilityChanged=function(k){if(!k||!k.manageable||!k.args||k.args.newValue===undefined){throw new Error("handleExecute was called using wrong parameters",k)}var l=a(this);if(l){d.publishHandlerAvailability(this)}};c.prototype.handleIsExecutable=function(k){if(!k||!k.manageable){throw new Error("Wrong parameters")}return this.isAvailable()};c.prototype.onItemStateEvent=function(m,l,k){if(!m){throw new Error("identifier has to be a non empty string")}if(!l){throw new Error("itemIdentifier has to be a non empty string")}var p=m.toUpperCase();if(!g(p)){throw new Error("The given identifier is not supported by an RadioHandler",m)}if(!k||typeof k!=="function"){throw new Error("cb has to be a function",k)}var o=this.getHandlerComponent();if(!o){throw new Error("There is no HandlerComponent related to this RadioHandler",this)}var n=o.getEventChannel();if(!n){throw new Error("Retrieved eventChannel is undefined")}var q=this.getId();if(!q){throw new Error("handlerIdentfier has to be a non empty string.")}return n.subscribe({event:q+"/"+l+"/"+p},k)};c.prototype.removeItemStateEventSubscription=function(k){if(undefined===k){throw new Error("token has to be defined")}var m=this.getHandlerComponent();if(!m){throw new Error("There is no HandlerComponent related to this RadioHandler",this)}var l=m.getEventChannel();if(!l){throw new Error("Retrieved eventChannel is undefined")}var n=this.getId();if(!n){throw new Error("handlerIdentifier has to be a non empty string.")}return l.unsubscribe(k)};c.prototype.destroy=function(){var m=this._private._elements;var l=this._private._elements.length;for(var k=0;k<l;++k){m[k].destroy()}};e.RadioHandler=c;return e});define("DS/WAfrAppManager/App",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/WAfrContainer/App"],function(e,a,b,d){var c=function(f){d.call(this,f);this._frmWindow=undefined;this._disposeCalled=false;this._executionContext=undefined};d.inherits(c);c.prototype.onWillEnter=function(f){return b.resolve()};c.prototype.setUp=function(f){return b.resolve()};c.prototype.dispose=function(f){};c.inherits=function(f){f.prototype=Object.create(c.prototype,{constructor:{value:f,enumerable:false}})};c.Extend=function(){var f=function(g){c.call(this,g)};c.inherits(f);return f};return c});define("DS/WAfrHandlers/mod_RadioHandlerONE",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/private/private_CheckHandlerUtilities","DS/WAfrHandlers/private/private_RadioHandlerUtilities","DS/WAfrHandlers/mod_RadioHandler"],function(h,d,g,e,b){var c=b.RadioHandler;function f(i){c.call(this,i)}d.inherit(f,c);f.prototype.isUnselectAuthorized=function(){return false};f.prototype.handleExecute=function(l){if(l&&l.manageable){var k=l.manageable;if(!e.isManagedByRadioHandler(k,this)){throw new Error("Internal error. The manageable calling handleExecute is not managed by this RadioHandler.")}if(!l.action){var m=h.getErrorManager();var i=h.createReturnObject(m.FAILED,{description:"It is impossible to uncheck the checked element for RadioHandler of type ONE"});if(l.cb&&typeof l.cb==="function"){setTimeout(function(){l.cb(i)},0)}else{throw i.getError()}}if(!this._private._checkedElement){e.fireEvent(this,l.manageable.getId(),true);g.executeCheckHandler(l.manageable,{cb:l.cb,action:true,args:l.args});this._private._checkedElement=l.manageable}else{if(l.manageable!==this._private._checkedElement){var j=Object.create(null);j.cb=l.cb;j.manageable=l.manageable;j.manager=this;j.args=l.args;e.fireEvent(this,this._private._checkedElement.getId(),false);g.executeCheckHandler(this._private._checkedElement,{cb:e.checkOnUncheck.bind(j),action:false});this._private._checkedElement=l.manageable}else{if(this.beingInitialized()){e.fireEvent(this,l.manageable.getId(),true);g.executeCheckHandler(l.manageable,{cb:l.cb,action:true,args:l.args});this._private._checkedElement=l.manageable}}}}else{throw new Error("Wrong parameters")}};var a=Object.create(null);a.RadioHandlerONE=f;return a});define("DS/WAfrHandlers/mod_RadioHandlerZERO",["DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/private/private_CheckHandlerUtilities","DS/WAfrHandlers/private/private_RadioHandlerUtilities","DS/WAfrHandlers/mod_RadioHandler"],function(e,g,f,b){var d=b.RadioHandler;function c(h){d.call(this,h)}e.inherit(c,d);c.prototype.isUnselectAuthorized=function(){return true};c.prototype.handleExecute=function(j){if(j&&j.manageable){var i=j.manageable;if(!f.isManagedByRadioHandler(i,this)){throw new Error("Internal error. The manageable calling handleExecute is not managed by this RadioHandler.")}if(!j.action){if(j.manageable.getState()!==j.action){f.fireEvent(this,j.manageable.getId(),j.action);g.executeCheckHandler(j.manageable,{cb:j.cb,action:j.action,args:j.args});this._private._checkedElement=null}}else{if(this._private._checkedElement){if(this._private._checkedElement!==j.manageable){var h=Object.create(null);h.cb=j.cb;h.manager=this;h.manageable=j.manageable;h.args=j.args;f.fireEvent(this,this._private._checkedElement.getId(),false);g.executeCheckHandler(this._private._checkedElement,{cb:f.checkOnUncheck.bind(h),action:false});this._private._checkedElement=j.manageable}}else{f.fireEvent(this,j.manageable.getId(),j.action);g.executeCheckHandler(j.manageable,{cb:j.cb,action:j.action,args:j.args});this._private._checkedElement=j.manageable}}}else{throw new Error("Wrong parameters")}};var a=Object.create(null);a.RadioHandlerZERO=c;return a});define("DS/WAfrHandlers/mod_HandlerInterpreter",["UWA/Class/Promise","DS/WAfrHandlers/mod_ActionHandler","DS/WAfrHandlers/mod_CommandHandler","DS/WAfrHandlers/mod_CheckHandler","DS/WAfrHandlers/mod_RadioHandlerZERO","DS/WAfrHandlers/mod_RadioHandlerONE","DS/WAfrHandlers/mod_HandlerComponent","DS/WAfrHandlers/private/private_Utilities","DS/WAfrAvailabilityModes/mod_AvailabilityModesComponent"],function(e,v,c,a,u,h,i,t,r){var o=v.ActionHandler;var b=c.CommandHandler;var q=a.CheckHandler;var p=u.RadioHandlerZERO;var k=h.RadioHandlerONE;var d={};function g(y){var x={id:y.identifier,i18n:y.internationalization,icon:y.icon,availabilityMode:y.availability,accelerator:y.accelerator};return x}function l(y){var x={id:y.identifier,i18n:y.internationalization,icon:y.icon,availabilityMode:y.availability};return x}function m(z,y){var x=y(z);x.module=z.code.module;x.func=z.code.func;x.args=z.argument;return x}function s(A,z,y){var x=y(z);x.module=z.code.module;var B=A.getComponent("AFR_CommandsManager");x.cmdsManager=B;x.cmdMode=c.CmdMode[z.mode];x.repeatMode=c.RepeatMode[z.repeatability];x.args=z.argument;x.computeServer=z.computeServer;return x}function j(B,z,A){var x=null;var y;if(z.type==="Action"){y=m(z,A);x=new o(y)}else{if(z.type==="Command"){y=s(B,z,A);x=new b(y)}else{throw new Error("Unknown handler type",z.type)}}if(y&&y.args){x.setArgs(y.args)}return x}function n(){this._initializationValues=[];this._handler=[];this._chkHandler=[];this._radioHandler=[]}n.prototype.interpretLeafHandler=function(B,y){if(!y){return}var C=y.length;var A;var z;for(var x=0;x<C;++x){A=y[x];z=j(B,A,g);this._handler.push(z);this.addToAvailabilityModesSubscribers(z)}};n.prototype.interpretCheckHandler=function(D,A){if(!A){return}var x=A.length;var E;var F;var y;var z;var B;for(var C=0;C<x;++C){E=A[C];F=new q({id:E.identifier});y=j(D,E.check,l);F.addElement(y,{state:"check"});this.addToAvailabilityModesSubscribers(y);z=j(D,E.uncheck,l);F.addElement(z,{state:"uncheck"});this.addToAvailabilityModesSubscribers(z);this._chkHandler.push(F);if(E.defaultState!==undefined&&typeof E.defaultState==="string"){E.defaultState=E.defaultState==="true"}if(E.defaultState!==undefined&&E.defaultState){B={type:"CheckHandler",id:E.identifier,state:true};this._initializationValues.push(B)}}};n.prototype.interpretRadioHandler=function(I,M){if(!M){return}var E=M.items;if(!Array.isArray(E)){return}if(E.length===0){return}var K=0;var A=E.length;var L;var G;var J;var F;for(K=0;K<A;++K){J=E[K];L={id:J.identifier};if(J.radioType==="ONE"){G=new k(L)}else{if(J.radioType==="ZERO"){G=new p(L)}else{throw new Error()}}var x=0;var C=J.items;var D=C.length;var z;var H;var y;var B;for(x=0;x<D;++x){H=C[x];z=new q({id:H.identifier});if(H.check){y=j(I,H.check,l);z.addElement(y,{state:"check"});this.addToAvailabilityModesSubscribers(y)}if(H.uncheck){B=j(I,H.uncheck,l);z.addElement(B,{state:"uncheck"});this.addToAvailabilityModesSubscribers(B)}G.addElement(z)}this._radioHandler.push(G);if(J["default"]){F={type:"RadioHandler",id:J["default"],radioId:J.identifier,state:true};this._initializationValues.push(F)}}};n.prototype.interpret=function(D,C,z){if(!D||!C){throw new Error("Missing parameters")}var y=i.DEFAULT_COMPONENT_NAME;if(z&&z.componentId){y=z.componentId}else{console.warn("Caution! You are using the default component name. This is not recommended")}this._executionContext=C;this._handlerComponent=C.getComponent(y);if(!this._handlerComponent){throw new Error("HandlerComponent not found")}if(D){if(D.handlers){if(D.handlers&&D.handlers["default"]){var x=D.handlers["default"];this.interpretLeafHandler(C,x)}if(D.handlers&&D.handlers.check){var B=D.handlers.check;this.interpretCheckHandler(C,B)}if(D.handlers.defaultCommand){this._defaultCommandIdentifier=D.handlers.defaultCommand}}if(D.radioGroup){var A=D.radioGroup;this.interpretRadioHandler(C,A)}}return e.resolve()};n.prototype.commit=function(z){var x=0;var A=this._handler.length;var B=null;for(x=0;x<A;++x){B=this._handler[x];this._handlerComponent.addHandler(B)}this._handler.splice(0,A);delete this._handler;A=this._chkHandler.length;for(x=0;x<A;++x){B=this._chkHandler[x];this._handlerComponent.addCheckHandler(B)}this._chkHandler.splice(0,A);delete this._chkHandler;A=this._radioHandler.length;for(x=0;x<A;++x){B=this._radioHandler[x];this._handlerComponent.addRadioHandler(B)}this._radioHandler.splice(0,A);delete this._radioHandler;this._handlerComponent.setInitializationData(this._initializationValues);if(this._defaultCommandIdentifier){this._handlerComponent.setInitializationDefaultCommand(this._defaultCommandIdentifier)}if(this._availabilityModesSubscribers&&this._availabilityModesSubscribers.length>0){var y=r.DEFAULT_COMPONENT_NAME;if(z&&z[r.DEFAULT_COMPONENT_NAME]){y=z[r.DEFAULT_COMPONENT_NAME]}var C=this._executionContext.getComponent(y);if(C){this._handlerComponent.setAvailabilityModesComponent(C);this.commitAvailabilityModesSubsribers()}}delete this._handlerComponent;delete this._executionContext;delete this._initializationValues;delete this._availabilityModesSubscribers};n.prototype.addToAvailabilityModesSubscribers=function(x){if(!x||!this._executionContext){throw new Error("element and this._executionContext has to be defined")}if(!this._availabilityModesSubscribers){this._availabilityModesSubscribers=[]}this._availabilityModesSubscribers.push(x)};n.prototype.commitAvailabilityModesSubsribers=function(){var x=0;var y=0;var z=null;if(this._availabilityModesSubscribers){y=this._availabilityModesSubscribers.length;for(x=0;x<y;++x){z=this._availabilityModesSubscribers[x];z.initAvailabilityModesSubscription()}}};function f(x){var y=n;if(d[x]!==undefined){y=d[x]}return new y()}var w=Object.create(null);w.generateInterpreter=f;return w});