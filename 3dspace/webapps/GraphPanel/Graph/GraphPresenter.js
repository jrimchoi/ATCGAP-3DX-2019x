define("DS/GraphPanel/Graph/GraphPresenter",["DS/CoreEvents/ModelEvents","DS/Core/Core","DS/GraphPanel/Graph/GraphSettings","DS/3DXHighcharts/3DXHighcharts","css!DS/GraphPanel/Graph/GraphPresenter.css"],function(c,e,d,b){var a=function(f){this._init(f)};a.prototype._init=function(f){this._modelEventExt=f&&f.modelEvents?f.modelEvents:new c();this._modelEvents=new c();this._applicationChannel=f&&f.applicationChannel?f.applicationChannel:new c();this._modelC3={selectedItems:[],current:{id:f.modelC0.current?f.modelC0.current:null},series:[]};this._colors=[];this._kpiAttributes=[];this._initDom(f)};a.prototype._initDom=function(h){this._content=document.createElement("div");this._content.classList.add("graph-panel-content");this._settingsContent=document.createElement("div");this._settingsContent.classList.add("settings-content");this._graphContent=document.createElement("div");this._graphContent.classList.add("graph-content");for(var f in h.modelC0.dicoFormat){if(h.modelC0.dicoFormat[f].type==="kpi"){this._kpiAttributes.push(f)}}this._settingsPanel=new d({modelEvents:this._modelEvents,listKPI:h.listKPI,modelC3:this._modelC3});this._settingsPanel.inject(this._settingsContent);this._content.appendChild(this._settingsContent);this._content.appendChild(this._graphContent);var g=this;this._chart=new b.Chart({chart:{renderTo:this._graphContent,polar:true,type:"area",width:"230",marginTop:50},title:{text:"KPI values chart"},xAxis:{categories:this._modelC3.selectedItems,tickmarkPlacement:"on",lineWidth:0},yAxis:{gridLineInterpolation:"polygon",min:0},legend:{symbolHeight:12,symbolWidth:12,symbolRadius:6,itemStyle:{color:"#000000",fontWeight:"italic"},useHTML:true,},plotOptions:{series:{events:{legendItemClick:function(){this.visible?"visible":"hidden";h.modelC0.current=this.options.id;g._modelC3.current.id=this.options.id;g._setCurrentItemsIndex(h);g._modelEventExt.publish({event:"pc-graph-change-current-for-optim",data:h.modelC0.current});return false},click:function(i){h.modelC0.current=this.options.id;g._modelC3.current.id=this.options.id;g._setCurrentItemsIndex(h);g._modelEventExt.publish({event:"pc-graph-change-current-for-optim",data:h.modelC0.current})}},states:{hover:{halo:{size:0}}}}},colors:["#009DDB","#005686","#9B2C98","#00AA86","#F564A3","#8DDEE4","#CC092F","#E2D5CC","#6FBC4B","#70036b","#002596","#FEE000","#7F7F7F","#4EA8B7","#007A4C","#ADADAD","#127277","#6D2815","#000000","#4D62BA"],});this._initseries(h);this._subscribeEvents(h);this._setCurrentItemsIndex(h)};a.prototype.debounce=function(g,i,f){var h;return function(){var m=this,l=arguments;var k=function(){h=null;if(!f){g.apply(m,l)}};var j=f&&!h;clearTimeout(h);h=setTimeout(k,i||200);if(j){g.apply(m,l)}}};a.prototype._subscribeEvents=function(h){this._listSubscription=[];this._listSubscription2=[];this._listSubscription3=[];var f={};var g=this;g._listSubscription2.push(g._modelEventExt.subscribe({event:"pc-graph-config-created"},function(i){g._newConf(h,i.id,i.min,i.max);g._setCurrentItemsIndex(h);g._modelEventExt.publish({event:"pc-graph-config-color",data:{id:i.id.id,color:g._getConfigColor(i.id.id)}})}));g._listSubscription.push(g._modelEvents.subscribe({event:"change-view"},function(m){g._nbseries=g._modelC3.series.length;for(var o=0;o<g._nbseries;o++){for(var n=0;n<m.length;n++){for(var l in g._modelC3.series[o].data){if(l.includes(m[n])===true){if(f[o]){f[o].push(g._modelC3.series[o].data[l])}else{f[o]=[];f[o].push(g._modelC3.series[o].data[l])}}}}}for(var n in f){g._chart.series[n].update({data:f[n]});g._chart.xAxis[0].update({categories:m});f[n]=null}g._setBold()}));g._listSubscription2.push(g._modelEventExt.subscribe({event:"pc-graph-change-name"},function(k){for(var j=0;j<g._chart.series.length;j++){if(k.id===g._chart.series[j].options.id){g._modelC3.series[j].name=k.name;g._chart.series[j].update({name:k.name})}}g._setBold()}));g._listSubscription2.push(g._modelEventExt.subscribe({event:"pc-graph-change-current"},function(i){g._setCurrentItemsIndex(h)}));g._listSubscription2.push(g._modelEventExt.subscribe({event:"pc-graph-delete-config"},function(k){for(var j=0;j<g._chart.series.length;j++){if(g._chart.series[j].options.id===k){g._modelC3.series.splice(j,1);g._chart.series[j].remove()}}}));g._listSubscription2.push(g._modelEventExt.subscribe({event:"pc-graph-delete-tab"},function(m){for(var l=0;l<m.length;l++){for(var k=0;k<g._chart.series.length;k++){if(g._chart.series[k].options.id===m[l].id){g._modelC3.series.splice(k,1);g._chart.series[k].remove()}}}}));g._listSubscription3.push(g._applicationChannel.subscribe({event:"triptych-resized"},function(j){if(j.side==="right"){var i=j.width;g.debounce(g._chart.setSize(i,i),100,true)}}))};a.prototype._initseries=function(p){this._values=[];var q=[];var g={};this._nbseries=this._modelC3.series.length;if(Object.keys(p.modelC0.defConfig).length>1){for(var o in p.modelC0.defConfig){if(o!="prodConf"){this._previousConf(p,p.modelC0.defConfig[o])}}}else{var n=0;this._modelC3.series[n]={id:p.modelC0.defConfig.prodConf.id,name:p.modelC0.defConfig.prodConf.name,data:{}};for(var o in p.modelC0.defConfig.prodConf.definition){for(var m in p.modelC0.dicoFormat){if(o===m){for(var h=0;h<this._kpiAttributes.length;h++){if(p.modelC0.dicoFormat[this._kpiAttributes[h]].type==="kpi"&&p.modelC0.dicoFormat[m][this._kpiAttributes[h]]){if(g[this._kpiAttributes[h]]){g[this._kpiAttributes[h]]=g[this._kpiAttributes[h]]+p.modelC0.dicoFormat[m][this._kpiAttributes[h]].value}else{g[this._kpiAttributes[h]]=p.modelC0.dicoFormat[m][this._kpiAttributes[h]].value}}}}}}for(var h=0;h<this._modelC3.selectedItems.length;h++){for(var f in g){if(f.includes(this._modelC3.selectedItems[h])===true){this._modelC3.series[n].data[f]=g[f];this._values.push(g[f])}}}this._chart.addSeries({id:this._modelC3.series[n].id,name:this._modelC3.series[n].name,fullName:this._modelC3.series[n].name,data:this._values,animation:false})}};a.prototype._previousConf=function(p,q){this._values=[];var g={};this._nbseries=this._modelC3.series.length;for(var o=0;o<this._nbseries;o++){if(this._modelC3.series[o]&&this._modelC3.series[o].id===p.modelC0.defConfig.prodConf.id){this._chart.series[o].remove();this._modelC3.series.splice(o,1);this._nbseries=this._modelC3.series.length}}var n=this._nbseries;this._modelC3.series[n]={id:q.id,name:q.name,data:{}};for(var o in p.modelC0.defConfig){if(q.name===p.modelC0.defConfig[o].name){for(var m in p.modelC0.defConfig[o].definition){for(var h in p.modelC0.dicoFormat){if(m===h){for(var f=0;f<this._kpiAttributes.length;f++){if(p.modelC0.dicoFormat[this._kpiAttributes[f]].type==="kpi"&&p.modelC0.dicoFormat[h][this._kpiAttributes[f]]){if(g[this._kpiAttributes[f]]){g[this._kpiAttributes[f]]=g[this._kpiAttributes[f]]+p.modelC0.dicoFormat[h][this._kpiAttributes[f]].value}else{g[this._kpiAttributes[f]]=p.modelC0.dicoFormat[h][this._kpiAttributes[f]].value}}}}}}}}for(var h in p.listKPI){for(var f in g){if(f.includes(p.listKPI[h])===true){this._modelC3.series[n].data[f]=g[f];this._values.push(g[f])}}}this._chart.addSeries({id:q.id,name:q.name,data:this._values,animation:false})};a.prototype._newConf=function(o,g,p,u){this._values=[];var h={};this._nbseries=this._modelC3.series.length;for(var r=0;r<this._nbseries;r++){if(this._modelC3.series[r]&&this._modelC3.series[r].id===o.modelC0.defConfig.prodConf.id){this._chart.series[r].remove();this._modelC3.series.splice(r,1);this._nbseries=this._modelC3.series.length}}console.log(u,p);var t=this._nbseries;this._modelC3.series[t]={id:g.id,name:g.name,data:{}};for(var r in o.modelC0.defConfig){if(g.name===o.modelC0.defConfig[r].name){for(var q=0;q<o.modelC0.defConfig[r].definition.length;q++){for(var n in o.modelC0.dicoFormat){if(o.modelC0.defConfig[r].definition[q].Id===n){for(var m=0;m<this._kpiAttributes.length;m++){if(o.modelC0.dicoFormat[this._kpiAttributes[m]].type==="kpi"&&o.modelC0.dicoFormat[n][this._kpiAttributes[m]]){var s=0;if(s>0){h[this._kpiAttributes[m]].value=h[this._kpiAttributes[m]]+o.modelC0.dicoFormat[n][this._kpiAttributes[m]].value;s++;h[this._kpiAttributes[m]].number=s}else{h[this._kpiAttributes[m]].value=o.modelC0.dicoFormat[n][this._kpiAttributes[m]].value;s++;h[this._kpiAttributes[m]].number=s}}}}}}}}for(var n=0;n<o.listKPI.length;n++){for(var m in h){if(m.includes(o.listKPI[n])===true){if(m==="kpi_cost"){this._modelC3.series[t].data[m]=100-(h[m].value);this._values.push(100-(h[m].value))}else{this._modelC3.series[t].data[m]=h[m].value;this._values.push(h[m].value)}}}}o.modelC0.current=g.id;this._chart.addSeries({id:g.id,name:g.name,data:this._values,animation:false})};a.prototype._setBold=function(){this._item=[];this._item=this._graphContent.querySelectorAll("div.highcharts-legend-item");this._series=this._graphContent.querySelectorAll(".highcharts-series-group .highcharts-series");for(var f=0;f<this._chart.series.length;f++){if(this._chart.series[f].options.id===this._modelC3.current.id){this._item[f].firstChild.style.fontWeight="900"}else{this._item[f].firstChild.style.fontWeight="400"}}};a.prototype._setCurrentItemsIndex=function(o){this._modelC3.current.id=o.modelC0.current;for(var n=0;n<this._chart.series.length;n){this._chart.series[n].remove()}this._chart.colorCounter=0;this._chart.symbolCounter=0;var h=[];for(var k=0;k<this._modelC3.series.length;k++){this._data=[];for(var g=0;g<this._modelC3.selectedItems.length;g++){for(var f in this._modelC3.series[k].data){if(f.includes(this._modelC3.selectedItems[g])===true){this._data.push(this._modelC3.series[k].data[f])}}}if(this._modelC3.series[k].id==o.modelC0.current){this._chart.addSeries({id:this._modelC3.series[k].id,name:this._modelC3.series[k].name,data:this._data,zIndex:10,animation:false})}else{this._chart.addSeries({id:this._modelC3.series[k].id,name:this._modelC3.series[k].name,data:this._data,animation:false})}this._modelEventExt.publish({event:"pc-graph-config-color",data:{id:this._modelC3.series[k].id,color:this._getConfigColor(this._modelC3.series[k].id)}})}this._setBold()};a.prototype._getConfigColor=function(g){for(var f=0;f<this._chart.series.length;f++){if(this._chart.series[f].options.id===g){return this._chart.series[f].color}}};a.prototype.inject=function(f){f.appendChild(this._content)};a.prototype.destroy=function(){this._content=null;var g=this._listSubscription.length;for(var f=0;f<g;f++){this._modelEvents.unsubscribe(this._listSubscription[f])}var h=this._listSubscription2.length;for(var f=0;f<g;f++){this._modelEventExt.unsubscribe(this._listSubscription2[f])}};return a});