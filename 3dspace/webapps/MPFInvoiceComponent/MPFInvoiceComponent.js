define("DS/MPFInvoiceComponent/InvoiceUploadModal",["UWA/Core","UWA/Class/View","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Input/File","DS/MPFView/FieldTextInputV2","DS/MPFCartModel/CartModel","DS/MPFInvoiceModel/InvoiceDocumentModel","DS/MPFServices/ObjectService","i18n!DS/MPFInvoiceComponent/assets/nls/InvoiceComponent","css!DS/MPFUI/MPFUI","css!DS/MPFInvoiceComponent/MPFInvoiceComponent"],function(g,a,m,k,e,h,i,j,c,f,n,l,d){var b=a.extend({setup:function(o){l.requiredOfPrototype(this.model,f,"options.model must be a CartModel");l.requiredOfPrototype(o.invoiceDocument,n,"options.invoiceDocument must be an InvoiceDocumentModel");this.cart=this.model;this.invoiceDocument=o.invoiceDocument;this.modal=new k({renderTo:document.body,header:d.get("invoiceUpload"),className:"mpf-invoice-upload-modal",events:{onHide:this.reset.bind(this)}});this.alert=new h({closable:true,visible:true,autoHide:true,maximumVisibleMessages:2});this.warningMessage=this._createWarningMessage();this.invoiceNumberField=this._createInvoiceNumberField();this.invoiceFileField=this._createInvoiceFileField()},render:function(){var o;var p;o=[this.alert,this.warningMessage,this.invoiceNumberField.render(),this.invoiceFileField];p=this._getFooterButtons();this.modal.setBody(o);this.modal.setFooter(p);this.modal.show();return this},validate:function(){var p;var o;var q;o=this.invoiceNumberField.validate().isValid;q=this._validateIvoiceFileField();p=o&&q;return p},save:function(){var o=this;e.mask(this.modal.getBody());if(this.validate()){this._saveSelectedFile().then(this._saveCart.bind(this)).then(function(){e.unmask(o.modal.getBody());o.modal.hide();m.publish("MPCartTimeline",{event:"refresh",cartId:o.cart.id})})["catch"](function(){e.unmask(o.modal.getBody());o.alert.add({className:"error",visible:true,message:d.get("anErrorOccured")})})}else{e.unmask(this.modal.getBody())}},reset:function(){this.invoiceNumberField.resetValue();this.fileInput.clear();this._removeRedBorders()},destroy:function(){this.modal.destroy();this.cart=null;this.invoiceDocument=null;this._parent();this.container=null},_saveSelectedFile:function(){var o=this.fileInput.getContent().getElement("input").files[0];return this.invoiceDocument.saveFile(o)},_saveCart:function(){var o={};o[f.Fields.BUYER_INVOICE_DOCUMENT_PID]=this.invoiceDocument.id;o[f.Fields.BUYER_INVOICE_NUMBER]=this.invoiceNumberField.getValue();return this.cart.savePromise(o,{patch:true})},_createWarningMessage:function(){return g.createElement("div",{"class":"alert-message alert-warning alert-has-icon",html:[{tag:"span","class":"icon fonticon"},{tag:"span",text:d.get("uploadWarning")}]})},_createInvoiceNumberField:function(){return new c({model:this.cart,fieldName:f.Fields.BUYER_INVOICE_NUMBER,fieldLabel:d.get("invoiceNumber"),required:true,readOnly:false,dynamicValidation:true})},_createInvoiceFileField:function(){this.fileInput=new j({buttonText:d.get("invoiceFile"),events:{onChange:this._validateIvoiceFileField.bind(this)}});return g.createElement("div",{"class":"mpf-entry",html:[{tag:"label",html:[{tag:"span","class":"mpf-label",html:[d.get("invoiceOrderDocument"),'&nbsp;<span class="mpf-required">*</span>']},this.fileInput]}]})},_getFooterButtons:function(){var o=this;return[new i({className:"primary",value:d.get("uploadInvoice"),events:{onClick:this.save.bind(this)}}),new i({value:d.get("cancel"),events:{onClick:function(){o.modal.hide()}}})]},_validateIvoiceFileField:function(){var o;var p;o=!!(this.fileInput.getValue());p=this.fileInput.getContent().getElement(".form-control");if(o){p.removeClassName("mpf-invalidField")}else{p.addClassName("mpf-invalidField")}return o},_removeRedBorders:function(){this.fileInput.elements.textfield.removeClassName("mpf-invalidField")}});return b});define("DS/MPFInvoiceComponent/ProceedToPaymentNoticeBodyComponent",["UWA/Core","UWA/Class/View","i18n!DS/MPFInvoiceComponent/assets/nls/InvoiceComponent"],function(d,c,b){var a;a=c.extend({setup:function(){this.message=this._createMessage();this.link=this._createLink()},render:function(){this.container.setContent([this.message,this.link]);return this},_createMessage:function(){return d.createElement("p",{text:b.get("proceedToPayment")})},_createLink:function(){return d.createElement("a",{href:"/faq/proceed-to-deferred-payment",text:b.get("learnMoreAboutDifferedPayment"),target:"_blank"})}});return a});define("DS/MPFInvoiceComponent/ProceedToPaymentNoticeComponent",["UWA/Class/View","DS/MPFNoticeComponent/ImportantNoticeComponent","DS/MPFInvoiceComponent/ProceedToPaymentNoticeBodyComponent"],function(d,c,a){var b;b=d.extend({setup:function(){this.body=new a({});this.notice=new c({body:this.body})},render:function(){this.container=this.notice.render();return this}});return b});define("DS/MPFInvoiceComponent/InvoiceUploadNoticeBodyComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFInvoiceComponent/InvoiceUploadModal","DS/MPFCartModel/CartModel","DS/MPFInvoiceModel/InvoiceDocumentModel","DS/MPFError/BadArgumentError","i18n!DS/MPFInvoiceComponent/assets/nls/InvoiceComponent"],function(d,a,f,b,e,h,i,c){var g=a.extend({className:"clearfix",setup:function(k){var j;if(!(e.prototype.isPrototypeOf(this.model))){throw new i("options.model must be a CartModel")}if(!(h.prototype.isPrototypeOf(k.invoiceDocument))){throw new i("options.invoiceDocument must be an InvoiceDocumentModel")}this.cart=this.model;this.invoiceDocument=k.invoiceDocument;this.purchaseOrder=k.purchaseOrder;j=new b({model:this.cart,invoiceDocument:this.invoiceDocument});this.firstMessage=d.createElement("p",{text:c.get("invoicePaymentNoticeMessage")});this.secondMessage=d.createElement("p",{text:c.get("invoiceInfoNoticeMessage",this.purchaseOrder.getNumber(),this.purchaseOrder.getLabel())});this.link=d.createElement("a",{href:"/faq/proceed-to-deferred-payment",text:c.get("learnMoreAboutDifferedPayment"),target:"_blank"});this.uploadInvoiceButton=new f({className:"primary",value:c.get("uploadInvoice"),events:{onClick:function(){j.render()}}})},render:function(){var j;j=[this.firstMessage,this.secondMessage,this.link,this.uploadInvoiceButton];this.container.setContent(j);return this}});return g});define("DS/MPFInvoiceComponent/InvoiceUploadNoticeComponent",["UWA/Class/View","DS/MPFNoticeComponent/ImportantNoticeComponent","DS/MPFInvoiceComponent/InvoiceUploadNoticeBodyComponent","DS/MPFCartModel/CartModel","DS/MPFInvoiceModel/InvoiceDocumentModel","DS/MPFError/BadArgumentError"],function(g,f,b,c,d,a){var e;e=g.extend({setup:function(h){if(!(c.prototype.isPrototypeOf(this.model))){throw new a("options.model must be a CartModel")}if(!(d.prototype.isPrototypeOf(h.invoiceDocument))){throw new a("options.invoiceDocument must be a InvoiceDocumentModel")}this.cart=this.model;this.invoiceDocument=h.invoiceDocument;this.purchaseOrder=h.purchaseOrder;this.body=new b({model:this.cart,invoiceDocument:this.invoiceDocument,purchaseOrder:this.purchaseOrder});this.notice=new f({body:this.body})},render:function(){this.container=this.notice.render();return this}});return e});