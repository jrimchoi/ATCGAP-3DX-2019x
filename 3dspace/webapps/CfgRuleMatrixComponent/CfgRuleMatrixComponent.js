define("DS/CfgRuleMatrixComponent/Utils/CfgRuleMatrixExpressionGenerator",[],function(){var a={};a.generateBCR=function(h,i){var j={};j.rightExpression=a.generateRightExpression(h,i);j.defaultExpression=a.generateDefaultExpression(h);var g={};g.version=h.version;g.defaultExpression=j.defaultExpression;g.expression=j.rightExpression;var f=JSON.stringify(g);j.fullExpression="MREV1:"+f;return j};a.generateDefaultExpression=function(h){var f="";var i="";var g=0;for(g=0;g<h.drivingCombinationValues.length;g++){f=e(g,h);if(f!==""){break}}for(g=g+1;g<h.drivingCombinationValues.length;g++){i=e(g,h);if(i!==""){f=f+" ; "+i}}return f};var e=function(g,k){var i=[];var f="";var h=0;for(h=0;h<k.constrainedValues.length;h++){if(k.states[g][h]==="D"){i.push(k.constrainedValues[h])}}if(i.length!==0){f=i[0]}for(h=1;h<i.length;h++){f=f+" , "+i[h]}if(f!==""){f="( "+f+" )";f="DEFAULT ( "+f+" , ( "+d(k.drivingCombinationValues[g])+" ) )"}return f};a.generateRightExpression=function(k,m){var f="";var j=0;var h="";var l="";var g="";if((k.drivingCombinationValues.length===0)||(k.constrainedValues.length===0)){return""}for(j=0;j<k.drivingCombinationValues.length;j++){l=d(k.drivingCombinationValues[j]);if(m){g=c(j,k)}h=b(l,g);if(h!==""){f="( "+h+" )";break}}for(j=j+1;j<k.drivingCombinationValues.length;j++){l=d(k.drivingCombinationValues[j]);if(m){g=c(j,k)}h=b(l,g);if(h!==""){f=f+" AND ( "+h+" )"}}return f};var d=function(i){var f="";var h="";for(h in i){var g="";if(i[h]==="yes"){g=h}else{if(i[h]==="no"){g="NOT ("+h+")"}else{g=i[h]}}if(f===""){f=g}else{f=f+" AND "+g}}return f};var c=function(g,o){var n=[];var q="";var p=o.states;var k="";var i=0;var m="";var h="";var f=false;var l="";for(i=0;i<o.constrainedValues.length;i++){if(p[g][i]==="N"){l=o.constrainedValues[i];if(q===""){q="NOT ( "+l+" )"}else{q="NOT ( "+l+" ) AND "+q}}else{if(p[g][i]==="S"){l=o.constrainedValues[i];if(q===""){q="( "+l+" )"}else{q="( "+l+" ) AND "+q}}}}return q};var b=function(f,g){if(f===""||g===""){return""}return("NOT ( "+f+" ) OR ( "+g+" )")};return a});define("DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenterStaticContent",["DS/UIKIT/Popover","css!DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenterStaticContent.css","css!DS/UIKIT/UIKIT.css"],function(c,a,f){var b={};var e=function(h,g){if(h!=undefined&&g instanceof Array){g.forEach(function(i){h.classList.add(i)})}};b.generateMRStandard=function(i,h){var g=document.createElement("div");e(g,["mr-body-cell","mr-standard","user-selection"]);var j=document.createElement("span");e(j,["fonticon","fonticon-check","user-selection"]);g.appendChild(j);return g};b.generateMRStandardConflict=function(j,i){var h=document.createElement("div");e(h,["mr-body-cell","mr-standard","mr-conflict","user-selection"]);var k=document.createElement("span");e(k,["fonticon","fonticon-check","user-selection"]);h.appendChild(k);var g=document.createElement("span");e(g,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]);h.appendChild(g);return h};b.generateMRStandardRequired=function(){var g=document.createElement("div");e(g,["mr-body-cell","mr-standard","user-selection"]);var h=document.createElement("span");e(h,["fonticon","fonticon-check","user-selection"]);g.appendChild(h);var i=d("required");g.appendChild(i);return g};b.generateMRDefault=function(i,h){var g=document.createElement("div");e(g,["mr-body-cell","mr-default","user-selection"]);var j=document.createElement("span");e(j,["fonticon","fonticon-favorite-on","user-selection"]);g.appendChild(j);return g};b.generateMRDefaultRequired=function(){var g=document.createElement("div");e(g,["mr-body-cell","mr-default","user-selection"]);var h=document.createElement("span");e(h,["fonticon","fonticon-favorite-on","user-selection"]);g.appendChild(h);var i=d("required");g.appendChild(i);return g};b.generateMRDefaultIncompatible=function(){var h=document.createElement("div");e(h,["mr-body-cell","mr-default","user-selection"]);var i=document.createElement("span");e(i,["fonticon","fonticon-favorite-on","user-selection"]);h.appendChild(i);var g=document.createElement("span");e(g,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]);h.appendChild(g);return h};b.generateMRAvailable=function(i,h){var g=document.createElement("div");e(g,["mr-body-cell","mr-available"]);return g};b.generateMRAvailableRequired=function(i,h){var g=document.createElement("div");e(g,["mr-body-cell","mr-available"]);var j=d("required");g.appendChild(j);return g};b.generateMRAvailableIncompatible=function(i,h){var g=document.createElement("div");e(g,["mr-body-cell","mr-available"]);var j=d("incompatible");g.appendChild(j);return g};b.generateMRAvailableConflict=function(j,i){var h=document.createElement("div");e(h,["mr-body-cell","mr-available"]);var g=document.createElement("span");e(g,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]);h.appendChild(g);return h};b.generateMRNotAvailable=function(i,h){var g=document.createElement("div");e(g,["mr-body-cell","mr-notavailable","user-selection"]);var j=document.createElement("span");e(j,["fonticon","fonticon-block","user-selection"]);g.appendChild(j);return g};b.generateMRNotAvailableConflict=function(j,i){var h=document.createElement("div");e(h,["mr-body-cell","mr-notavailable","mr-conflict","user-selection"]);var k=document.createElement("span");e(k,["fonticon","fonticon-block","user-selection"]);h.appendChild(k);var g=document.createElement("span");e(g,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]);h.appendChild(g);return h};b.generateMRNotAvailableIncompatible=function(i,h){var g=document.createElement("div");e(g,["mr-body-cell","mr-notavailable","user-selection"]);var j=document.createElement("span");e(j,["fonticon","fonticon-block","user-selection"]);g.appendChild(j);var k=d("incompatible");g.appendChild(k);return g};var d=function(i){var h=document.createElement("div");h.classList.add("triangle");var g=document.createElement("span");e(g,["mr-span-information","fonticon"]);if(i==="required"){g.classList.add("fonticon-check")}else{if(i==="incompatible"){g.classList.add("fonticon-block")}else{g.classList.add("fonticon-info")}}g.classList.add("mr-combi-details");h.appendChild(g);return h};return b});define("DS/CfgRuleMatrixComponent/Runtime/TablePresenter2",["DS/UIKIT/DropdownMenu","DS/UIKIT/Dropdown","DS/UIKIT/Mask","UWA/Element","css!DS/CfgRuleMatrixComponent/Runtime/TablePresenter2.css","css!DS/UIKIT/UIKIT.css"],function(c,b,f,a,d,e){});define("DS/CfgRuleMatrixComponent/Buildtime/AxisPresenter",["DS/Handlebars/Handlebars","DS/Core/ModelEvents","DS/UIKIT/Mask","UWA/Element","DS/ENOXSplitView/js/ENOXSplitView","DS/CfgVCSComponent/Presenter/DgvCfgVCSMainContainer","DS/xModelEventManager/xModelEventManager","css!DS/CfgRuleMatrixComponent/Buildtime/AxisPresenter.css","text!DS/CfgRuleMatrixComponent/Buildtime/AxisPresenter.html"],function(b,c,f,j,i,k,e,a,d){var g=false;var h=function(){};h.prototype.init=function(n,m,l){this._subDico=l.subDico?l.subDico:{};this._fullDictionary=n||{};this._updateChannel=l&&l.updateChannel!==undefined?l.updateChannel:new c();this._privateChannel=m?m:new c();this._myEventManager=new e(this._updateChannel,this._privateChannel);this._id=l&&l.id?l.id:null;this._editable=l.editable;this._options={};this._options.nbMax=l&&l.nbMax?l.nbMax:500;this._options.axisMainTitle=l&&l.axisMainTitle?l.axisMainTitle:"";this._options.axisTitle=l&&l.axisTitle?l.axisTitle:"";this._options.axisSubtitle=l&&l.axisSubtitle?l.axisSubtitle:"";this._options.axisIcon=l&&l.axisIcon?l.axisIcon:"";this._criteriaList=l.criteria||[];this._selectedTreeNode=[];this._filteredTreeNode=[];this._editMode=false;this._rightSidePanelOpened=false;this._amICurrActiveAxis=false;this._initDivs(this._options);this._subscribeToEvents();this._subscribeToDomEvents();this._updateUI()};h.prototype._initDivs=function(m){var n=b.compile(d);var l=n(m);this._container=document.createElement("div");this._container.innerHTML=l;this._container=this._container.firstChild;UWA.extendElement(this._container);this._dicoContainer=this._container.querySelector(".axis-content");this._axisNumber=this._container.querySelector(".axis-subtitle");this._axisSubtitleName=this._container.querySelector(".axis-subtitle-name")};h.prototype._subscribeToEvents=function(){var l=this;this._myEventManager.subscribe(this._privateChannel,{event:"new-axis-nb"},function(m){if(m.id===l._id){l._updateUICount(m.count)}});this._myEventManager.subscribe(this._privateChannel,{event:"axis-criteria-selection-change"},function(m){if(m.id!=l._id){l._filterCriteria(m.selectedIds)}});this._myEventManager.subscribe(this._updateChannel,{event:"on-add-variability-btn-click"},function(m){var n=l._dicoContainer.querySelector("#axis-add-crit-btn");if(m&&m.id==l._id){if(l._amICurrActiveAxis==false){n.addClassName("enox-collection-toolbar-filter-activated");l._dicoContainer.addClassName("active");m.selected=l._amICurrActiveAxis=true}else{n.removeClassName("enox-collection-toolbar-filter-activated");l._dicoContainer.removeClassName("active");m.selected=l._amICurrActiveAxis=false}}else{n.removeClassName("enox-collection-toolbar-filter-activated");l._dicoContainer.removeClassName("active");l._amICurrActiveAxis=false}});this._myEventManager.subscribe(this._updateChannel,{event:"triptych-hide-panel"},function(m){if(l._amICurrActiveAxis==true){var n=l._dicoContainer.querySelector("#axis-add-crit-btn");n.removeClassName("enox-collection-toolbar-filter-activated");l._dicoContainer.removeClassName("active");l._amICurrActiveAxis=false}});this._myEventManager.subscribe(this._updateChannel,{event:"open-vcs-presenter"},function(m){if(m.id==l._id){if(l._dicoContainer){l._dicoContainer.addClassName("active")}}else{l._updateChannel.publish({event:"close-vcs-presenter",data:{reload:false}});if(l._dicoContainer){l._dicoContainer.removeClassName("active")}}});this._myEventManager.subscribe(this._updateChannel,{event:"close-vcs-presenter"},function(m){if(!m){actionView.isSelected=false;actionView.elements.container.removeClassName("selected");if(l._dicoContainer){l._dicoContainer.removeClassName("active")}}})};h.prototype._subscribeToDomEvents=function(){var l=this;this._dicoContainer.ondrop=function(n){if(n.preventDefault){n.preventDefault()}var m=document.createElement("div");m.innerHTML=n.dataTransfer.getData("text/html");l._subDico.push(m.textContent);l._updateUI()};this._dicoContainer.ondragover=function(m){if(m.preventDefault){m.preventDefault()}m.dataTransfer.dropEffect="move";return false}};h.prototype.getContent=function(){return this._subDico};h.prototype._getFilterer=function(l){var m=this;return function(o){var n=false;if(!m._editMode){if(o.attributes&&(o.attributes._include==true||o.attributes._includeNot==true)){n=true}}else{n=true}if(n&&m._filteredTreeNode.indexOf(o.id)>-1){n={filter:false,child:false}}return n}};h.prototype._updateUI=function(){var l=0;this._dicoContainer.innerHTML="";var n=this;if(!this.itemsPresenter){var m=function(p){return function(r){var q=false;if(!p){if(r.attributes&&(r.attributes._include==true||r.attributes._includeNot==true)){q=true}}else{if(n._filteredTreeNode.indexOf(r.id)>-1){q=false}else{q=true}}return q}};this.itemsPresenter=new k({axisId:this._id,dictionaryJSON:this._fullDictionary,showSwitchViewAction:true,itemActions:[{id:"delete",title:"Remove",text:"Remove",fonticon:"trash",event:"onRemoveAction"}],actions:[{id:"axis-add-crit-btn",text:"Add Variants/Options",fonticon:"book-add",disabled:!this._editable,allowSelectRetain:false,handler:function(q,r){if(g){if(!this.isLoaded){n.itemsPresenter.subscribe("set-criteria-edit-mode",function(s){r.selected=s;r.selected?r.elements.container.addClassName("enox-collection-toolbar-filter-activated"):r.elements.container.removeClassName("enox-collection-toolbar-filter-activated")})}n._editMode=r.selected;if(!n._isMasked){n.itemsPresenter.setEditable(r.selected)}n.itemsPresenter.filter(n._getFilterer(r.selected))}else{var p={id:n._id,selected:r.selected};n._updateChannel.publish({event:"on-add-variability-btn-click",data:p})}}}],contentFilter:function(p){var q=true;if(p.kind=="instance"){q=false}return q},isEditable:false});this.itemsPresenter.render();this.itemsPresenter.subscribe("onRemoveAction",function(p){console.log("[AxisPresenter: onRemoveAction] Axis: "+p.axisId);if(p.nodeModel!=undefined){var t=p.nodeModel;var q={id:t.options.id,name:"_include",value:false,axisId:p.axisId};var s=q;var r="";switch(t.options.criteriaType){case"Variants":r="variant";break;case"Values":r="value";break;case"VariabilityGroups":r="variabilityGroup";break;case"Options":r="option";break}UWA.merge(s,{changedObject:t.options.dictionaryItem,type:r});n.onChangeAttributeHandler(s,p.withCriteriaUpdate)}});this._updateIncludeNotOnceForAxisContent();if(this._criteriaList.length>0){this.itemsPresenter.setAttributes(this._criteriaList);this._updateChannel.publish({event:"update-vcs-on-axis-content-load",data:{axisId:this._id,criteriaList:this._criteriaList}})}this.itemsPresenter.filter(n._getFilterer(false));this.itemsPresenter.subscribe("onChangeAttribute",n.onChangeAttributeHandler)}var o=this._getCurrentCriteria();this._criteria=o.criteria;this._criteriaValues=o.values;this._selectedTreeNode=o.selectedIds;this._privateChannel.publish({event:"axis-criteria-selection-change",data:{id:this._id,selectedIds:this._selectedTreeNode}});this._updateUICount(this._criteriaValues.length);UWA.extendElement(this._dicoContainer).setContent(this.itemsPresenter.container)};h.prototype._updateIncludeNotOnceForAxisContent=function(){var n=this;try{var o=function(p){if(p&&(p.options.criteriaType=="Options"||p.options.criteriaType=="Variants")){p.setAttribute("_includeNot",false)}};var l=this.itemsPresenter.getTreeDocument().getChildren();if(l&&l.length>0){this.itemsPresenter.getTreeDocument().prepareUpdate();l.forEach(function(p){if(p.options.criteriaType=="VariabilityGroups"){p.getChildren().forEach(function(q){o(q)})}else{o(p)}});this.itemsPresenter.getTreeDocument().pushUpdate()}}catch(m){console.log("[AxisPresenter:_updateIncludeNotOnceForAxisContent] Exception occured: "+m)}};h.prototype._updateIncludeIncludeNotForAxisContent=function(w){var u=this;try{if(w&&w.value!=undefined){var x=w.value?1:0;var o=2;var y=this.itemsPresenter.getTreeDocument().search({match:function(z){if(z.nodeModel.options.id==w.id){return true}}});if(y&&y.length>0){this.itemsPresenter.getTreeDocument().prepareUpdate();var v=y[0];var s=v.hasChildren();if(s){v.setAttribute("_include",x);v.getChildren().forEach(function(z){z.setAttribute("_include",x)})}else{var t=v.getParent();if(t){var q=t.getNumberOfChildren();v.setAttribute("_include",x);if(q===1){t.setAttribute("_include",x)}else{if(q>1){var m=false;var n=t.getChildren();for(var r=0;r<q;r++){var l=n[r];if(l&&l.options.id!==v.options.id){if(l.options.grid._include!==x){t.setAttribute("_include",o);m=true;break}}}if(!m){t.setAttribute("_include",x)}else{t.setAttribute("_include",o)}}}}}this.itemsPresenter.getTreeDocument().pushUpdate()}}}catch(p){console.log("[AxisPresenter:_updateIncludeIncludeNotForAxisContent]Exception Occured: "+p)}};h.prototype.onChangeAttributeHandler=function(t,p){console.log();var s=this;var m={};var v=[];var l=[];this._updateIncludeIncludeNotForAxisContent(t);this.itemsPresenter.filter(this._getFilterer(false));var n=s._getCurrentCriteria();this._updateChannel.publish({event:"update-vcs-on-axis-content-change",data:t});if(p!=undefined&&p==false){return}if(t.value==true){v=n.criteria}else{v=s._criteria}var u=t.changedObject;for(var r=0;r<v.length;r++){if(t.type=="value"||t.type=="variant"){if(v[r].type=="variant"){var o=false;if(v[r].id==u.lid){if(t.name=="_include"){o=true}else{if(t.name=="_includeNot"){m[v[r].id]=[{criteriaValidity:"no"}];break}}}if(v[r].selectedValues){var w=[];for(var q=0;q<v[r].selectedValues.length;q++){if(v[r].selectedValues[q].variantValue){if(o){w.push(v[r].selectedValues[q])}else{if(v[r].selectedValues[q].variantValue==u.rel_lid){m[v[r].id]=[v[r].selectedValues[q]];break}}}}}if(o){m[v[r].id]=w}}}else{if(t.type=="option"||t.type=="variabilityGroup"){if(v[r].type=="option"){if(v[r].id==u.rel_lid){if(t.name=="_include"){m[v[r].id]=[{criteriaValidity:"yes"}]}else{if(t.name=="_includeNot"){m[v[r].id]=[{criteriaValidity:"no"}]}}break}if(u.options){var x=u.options.member?u.options.member:[];x.forEach(function(y){if(v[r].id==y.rel_lid){if(t.name=="_include"){l.push({id:v[r].id,criteriaValidity:true});m[v[r].id]=[{criteriaValidity:"yes"}]}else{if(t.name=="_includeNot"){m[v[r].id]=[{criteriaValidity:"no"}]}}}})}}}}}console.log("criteria values ",m);if(t.value==true){s._privateChannel.publish({event:"axis-add-criteria",data:{id:s._id,criteria:m}})}else{s._privateChannel.publish({event:"axis-remove-criteria",data:{id:s._id,criteria:m}})}s._criteria=n.criteria;s._criteriaValues=n.values;s._selectedTreeNode=n.selectedIds;s._privateChannel.publish({event:"axis-criteria-selection-change",data:{id:s._id,selectedIds:s._selectedTreeNode}})};h.prototype._getCurrentCriteria=function(){var q=[];var n=[];var p=[];var m=this;var o=m.itemsPresenter.getDictionaryContent({type:"criteria"});if(o){for(var l in o){if(o.hasOwnProperty(l)){if(UWA.is(o[l],"array")){o[l].forEach(function(s){p.push(s.id);if(l=="variants"){var t=s;var u={id:t.lid,name:t.attributes._name.value,type:"variant",value:t.attributes._name.value,selectedValues:[],rejectedValues:[]};var v={id:t.lid,type:"variant",value:t.attributes._name.value,criteriaValidity:"no",parent:null,};if(t.values&&UWA.is(t.values,"array")){t.values.forEach(function(y){var x={variantValue:y.rel_lid};var w={id:y.rel_lid,type:"value",value:y.attributes._name.value,variantValue:y.rel_lid,parent:t.lid,};if(y.include){u.selectedValues.push(x);n.push(w)}else{u.rejectedValues.push(x)}})}if(UWA.is(t.includeNot,"boolean")){var r={criteriaValidity:"no"};if(t.includeNot){u.selectedValues.push(r);n.push(v)}else{u.rejectedValues.push(r)}}q.push(u)}else{if(l=="variabilityGroups"){if(s&&UWA.is(s.options,"array")){s.options.forEach(function(z){var A={id:z.rel_lid,name:z.attributes._name.value,type:"option",value:z.attributes._name.value,selectedValues:[],rejectedValues:[]};var x={id:z.rel_lid,type:"option",value:z.attributes._name.value,criteriaValidity:"no",parent:null,};var w={criteriaValidity:"yes"};var y={criteriaValidity:"no"};if(z.include){A.selectedValues.push(w);x.criteriaValidity="yes";n.push(x)}else{A.rejectedValues.push(w)}if(UWA.is(z.includeNot,"boolean")){if(z.includeNot){A.selectedValues.push(y);x.criteriaValidity="no";n.push(x)}else{A.rejectedValues.push(y)}}q.push(A)})}}}})}}}}return{criteria:q,values:n,selectedIds:p}};h.prototype._updateUICount=function(l){this._axisNumber.innerHTML=UWA.is(l)?l:"##";if(l>this._options.nbMax){this._axisNumber.classList.add("axis-warning");this._axisSubtitleName.classList.add("axis-warning")}else{this._axisNumber.classList.remove("axis-warning");this._axisSubtitleName.classList.remove("axis-warning")}};h.prototype._filterCriteria=function(l){this._filteredTreeNode=l;this.itemsPresenter.filter(this._getFilterer(true))};h.prototype.getCritria=function(l){return this._criteria};h.prototype.getCriteriaValues=function(l){return this._criteriaValues};h.prototype.setDico=function(l){this._subDico=l};h.prototype.inject=function(l){l.appendChild(this._container)};h.prototype.mask=function(l){this._isMasked=true;this.itemsPresenter.setEditable(false)};h.prototype.unmask=function(l){this._isMasked=false;this.itemsPresenter.setEditable(this._editMode)};h.prototype.destroy=function(){this._myEventManager.cleanup(this._id+"-AxisPresenter")};h.prototype.refreshUI=function(l){this._editMode=false;this._resetItemsPresenter();this._criteriaList=l.criteria;if(this._criteriaList.length>0){this.itemsPresenter.setAttributes(this._criteriaList);this._updateChannel.publish({event:"update-vcs-on-axis-content-load",data:{axisId:this._id,criteriaList:this._criteriaList}})}this.itemsPresenter.setEditable(this._editMode);this.itemsPresenter.filter(this._getFilterer(false));var m=this._getCurrentCriteria();this._criteria=m.criteria;this._criteriaValues=m.values;this._selectedTreeNode=m.selectedIds};h.prototype._resetItemsPresenter=function(){try{var n=this;var l=this.itemsPresenter.getTreeDocument().getChildren();var n=this;if(l&&l.length>0){l.forEach(function(o){if(o.isVisible()){n.itemsPresenter.publish("onRemoveAction",{nodeModel:o,axisId:n._id,withCriteriaUpdate:false})}})}}catch(m){console.log("[AxisPresenter:_resetItemsPresenter] Exception occured!!!")}};return h});define("DS/CfgRuleMatrixComponent/Model/DemoModel",["UWA/Class/Model"],function(b){var a=UWA.Class.Model.extend({defaults:{drivingCriteria:[],constrainedCriteria:[],drivingCombinationValues:[],constrainedValues:[],states:null,statesValidity:null}});return a});define("DS/CfgRuleMatrixComponent/GlobalPresenter/WizardPresenter",["DS/Handlebars/Handlebars","DS/Core/ModelEvents","i18n!DS/CfgRuleMatrixComponent/assets/nls/WizardPresenter","text!DS/CfgRuleMatrixComponent/GlobalPresenter/WizardPresenter.html","css!DS/CfgRuleMatrixComponent/GlobalPresenter/WizardPresenter.css"],function(f,d,c,a,e){var b=function(){};b.prototype.init=function(h,g){this._privateChannel=h?h:new d();this._currentView=g.view;this._initDivs();this._subscribeToEvents()};b.prototype._initDivs=function(){var i=f.compile(a);var h={};if(this._currentView==="build"){h.build=true;h.run=false}else{if(this._currentView==="run"){h.build=false;h.run=true}else{h.build=false;h.run=false}}h.axisNls=c._axis_definition;h.contraintsNls=c._constraints_definition;var g=i(h);this._container=document.createElement("div");this._container.innerHTML=g;this._container=this._container.firstChild;this._axisIcon=this._container.querySelector(".axis-definition").querySelector(".fonticon");this._constraintsIcon=this._container.querySelector(".constraints-definition").querySelector(".fonticon");this._readypublishEvents()};b.prototype.inject=function(g){g.appendChild(this._container)};b.prototype._subscribeToEvents=function(){var g=this;this._privateChannel.subscribe({event:"switched-view"},function(h){if(h==="build"){g._axisIcon.classList.add("selected");g._constraintsIcon.classList.remove("selected");g._container.querySelector(".axis-definition").querySelector(".text-content").classList.add("selected");g._container.querySelector(".constraints-definition").querySelector(".text-content").classList.remove("selected")}else{if(h==="run"){g._axisIcon.classList.remove("selected");g._constraintsIcon.classList.add("selected");g._container.querySelector(".axis-definition").querySelector(".text-content").classList.remove("selected");g._container.querySelector(".constraints-definition").querySelector(".text-content").classList.add("selected")}}})};b.prototype._readypublishEvents=function(){var g=this;this._container.querySelector(".axis-definition").addEventListener("click",function(h){g._privateChannel.publish({event:"switch-view",data:"build"})});this._container.querySelector(".constraints-definition").addEventListener("click",function(h){g._privateChannel.publish({event:"switch-view",data:"run"})})};return b});define("DS/CfgRuleMatrixComponent/Utils/MatruiTablePersistanceUtils",[],function(){var a={};a.convertJsonToV2=function(c,b){if(b.version==="1.0.1"){return a.generateJsonModelV2FromV1(c,b)}else{if(b.version=="2.0"){return b}}};a.generateJsonModelV2FromV1=function(s,p){var g=0,f=0;var h={};var n=[];h.constrainedValues=[];for(g=0;g<p.constrainedCombinations.length;g+=1){var b={};b.id=p.constrainedCombinations[g].combinationOptions[0].id;if(s[b.id].type==="option"){b.parent=null}else{b.parent=s[b.id].parent}h.constrainedValues.push(b);n.push(b.id)}var k=[];h.drivingCombinationValues=[];for(g=0;g<p.drivingCombinations.length;g+=1){var c=[];for(f=0;f<p.drivingCombinations[g].combinationOptions.length;f+=1){c.push(p.drivingCombinations[g].combinationOptions[f].id)}var t={};for(f=0;f<c.length;f+=1){if(s[c[f]].type==="option"){t[c[f]]={};t[IdsInComb[f]].criteriaValidity="yes"}else{var o=s[c[f]].parent;t[o]={};t[o].variantValue=c[f]}k.push(c[f])}h.drivingCombinationValues.push(t)}h.drivingCriteria=[];for(var g=0;g<p.drivingFeatures.length;g+=1){var r=p.drivingFeatures[g].id;if(s[r]){var q={};q.id=p.drivingFeatures[g].id;q.type=s[p.drivingFeatures[g].id].type;q.selectedValues=[];q.rejectedValues=[];for(var f=0;f<s[p.drivingFeatures[g].id].values.length;f+=1){if(k.indexOf(s[p.drivingFeatures[g].id].values[f])!=-1){q.selectedValues.push({variantValue:s[p.drivingFeatures[g].id].values[f]})}else{q.rejectedValues.push({variantValue:s[p.drivingFeatures[g].id].values[f]})}}q.rejectedValues.push({criteriaValidity:"no"});if(q.selectedValues.length>0){h.drivingCriteria.push(q)}}}h.constrainedCriteria=[];for(var g=0;g<p.constrainedFeatures.length;g+=1){var r=p.constrainedFeatures[g].id;if(s[r]){var d={};d.id=p.constrainedFeatures[g].id;d.type=s[p.constrainedFeatures[g].id].type;d.selectedValues=[];d.rejectedValues=[];if(d.type==="variability_group"){for(var f=0;f<s[p.constrainedFeatures[g].id].content.length;f+=1){var d={};d.id=s[p.constrainedFeatures[g].id].content[f];d.criteriaValidity="yes";d.parent=null;h.constrainedCriteria.push(d)}}else{for(var f=0;f<s[p.constrainedFeatures[g].id].values.length;f+=1){if(n.indexOf(s[p.constrainedFeatures[g].id].values[f])!=-1){d.selectedValues.push({variantValue:s[p.constrainedFeatures[g].id].values[f]})}else{d.rejectedValues.push({variantValue:s[p.constrainedFeatures[g].id].values[f]})}}if(d.selectedValues.length>0){h.constrainedCriteria.push(d)}}}}h.states=[];h.statesValidity=[];if(!p.statesValidity){p.statesValidity="";for(var g=0;g<p.states.length;g++){p.statesValidity+="V"}}for(g=0;g<h.drivingCombinationValues.length;g+=1){var m="",e="";for(f=0;f<h.constrainedValues.length;f+=1){var l=(f*p.drivingCombinations.length)+g;m+=p.states[l];e+=p.statesValidity[l]}h.states.push(m);h.statesValidity.push(e)}h.version="2.0";return h};a.generatePersistedModel=function(d){return d;var b={};var g=0,f=0;b.drivingCriteria=[];for(g=0;g<d.drivingCriteria.length;g++){if(d.drivingCriteria[g].type==="option"){b.drivingCriteria.push({id:d.drivingCriteria[g].id})}else{b.drivingCriteria.push({id:d.drivingCriteria[g].id,rejectedValues:d.drivingCriteria[g].rejectedValues,selectedValues:d.drivingCriteria[g].selectedValues})}}b.constrainedCriteria=[];for(g=0;g<d.constrainedCriteria.length;g++){b.constrainedCriteria.push({id:d.constrainedCriteria[g].id,rejectedValues:d.constrainedCriteria[g].rejectedValues,selectedValues:d.constrainedCriteria[g].selectedValues})}b.constrainedValues=[];for(g=0;g<d.constrainedValues.length;g++){b.constrainedValues.push(d.constrainedValues[g].id)}b.drivingCombinationValues=[];for(g=0;g<d.drivingCombinationValues.length;g++){var h={};var k=Object.keys(d.drivingCombinationValues[g]);for(f=0;f<k.length;f++){if(d.drivingCombinationValues[g][k[f]].id){h[k[f]]=d.drivingCombinationValues[g][k[f]].id}else{if(d.drivingCombinationValues[g][k[f]].value){h[k[f]]=d.drivingCombinationValues[g][k[f]].value}}}b.drivingCombinationValues.push(h)}var e=[];for(g=0;g<d.drivingCombinationValues.length;g++){var c="";for(f=0;f<d.constrainedValues.length;f++){c+=d.states.get(g.toString()).get(f.toString())}e.push(c)}b.states=e;return b};return a});define("DS/CfgRuleMatrixComponent/Buildtime/BuildTimePresenter",["DS/Handlebars/Handlebars","DS/Core/ModelEvents","DS/UIKIT/Mask","UWA/Element","DS/CfgDictionary/CfgDictionaryV3Utils","DS/CfgRuleMatrixComponent/Buildtime/AxisPresenter","DS/ENOXSplitView/js/ENOXSplitView","DS/WebappsUtils/WebappsUtils","DS/CfgRuleMatrixComponent/Model/DemoModel","DS/CfgSolver/CfgSolverServices","DS/CfgVCSComponent/Presenter/DgvCfgVCSMainContainer","DS/xModelEventManager/xModelEventManager","i18n!DS/CfgRuleMatrixComponent/assets/nls/BuildTimePresenter","css!DS/CfgRuleMatrixComponent/Buildtime/BuildTimePresenter.css"],function(c,d,i,o,k,l,m,f,n,p,q,h,e,b){var g="attrDisabled";var a="attrAxis";var j=function(){};j.prototype.init=function(v,u,A,t,B){this._fullDico=v;this._dicoForVCS=k.getSubDictionary(v,k.WITH_REFERENCES_ONLY);this._model=new n();this._matrixRuleModel=u;this._privateChannel=t?t:new d();this._updateChannel=B&&B.updateChannel!==undefined?B.updateChannel:new d();this._applicationChannel=A;this._myEventManager=new h(this._privateChannel,this._updateChannel,this._applicationChannel);this._isReadyToSwitch=true;this._editable=B.editable===false?false:true;this._isRequiredRefresh=false;this._solverKey=B.solverKey||null;this.jsonModel=this._matrixRuleModel.getJsonModel();this._isRHSPanelActivated=false;this._workaroundCheckAndWakeUpResizeSensor=B.resizeSensorEnablerFun?B.resizeSensorEnablerFun:function(){};var y={modelEvents:this._privateChannel,withtransition:true,withoverflowhidden:false,resizable:false,params:{leftWidth:50,leftVisible:true,rightVisible:true},rightMaximizer:false,leftMaximizer:false};this._enoxSplitView=new m();this._enoxSplitView.init(y);this._initVCS();this._subscribeToEvents();var s={updateChannel:this._updateChannel,editable:this._editable};s.axisMainTitle="X "+e._axis;s.axisTitle=e._driving_criteria;s.axisSubtitle=" "+e._columns;s.axisIcon=f.getWebappsAssetUrl("CfgRuleMatrixComponent","Xaxis.png");s.id="driving";s.nbMax=600;s.criteria=[{id:"50240.31854.17152.17879",attributes:{_includeNot:true,}},{id:"6843B156115E00007450065B36A60E00@6843B156115E00001F52065BA01A0600",attributes:{_include:1}},{id:"6843B156115E00007450065B36A60E00@6843B156115E00001F52065B6EE20500",attributes:{_include:1}},{id:"6843B156115E00007450065B36A60E00@6843B156115E00003252065B2BC60900",attributes:{_include:0}},{id:"50240.31854.53248.57161",attributes:{_includeNot:false,}},{id:"6843B156115E00007450065B36A60E00@6843B156115E0000E451065B477B0500",attributes:{_include:1}},{id:"6843B156115E00007450065B36A60E00@6843B156115E0000E451065BD72F0400",attributes:{_include:1}},{id:"6843B156115E00007450065B36A60E00@6843B156115E0000E451065B2CCC0300",attributes:{_include:0}}];var z=this.formatCriteria(this.jsonModel.drivingCriteria);s.criteria=z;var r={updateChannel:this._updateChannel};r.axisMainTitle="Y "+e._axis;r.axisTitle=e._constrained_criteria;r.axisSubtitle=" "+e._rows;r.axisIcon=f.getWebappsAssetUrl("CfgRuleMatrixComponent","Yaxis.png");r.id="constrained";r.nbMax=1000;r.criteria=[{id:"6843B156115E00007450065B36A60E00@6843B156115E0000FE51065B0C760E00",attributes:{_include:1}},{id:"6843B156115E00007450065B36A60E00@6843B156115E0000FE51065B53C50C00",attributes:{_include:1}},{id:"6843B156115E00007450065B36A60E00@6843B156115E0000FE51065BC5C20C00",attributes:{_include:0}},];var x=this.formatCriteria(this.jsonModel.constrainedCriteria);r.criteria=x;r.editable=this._editable;this._drivingAxisPresenter=new l();var w=UWA.clone(this._fullDico);UWA.Json.path(w,"$..variabilityGroups[?(@.member=[])]");this._drivingAxisPresenter.init(w,this._privateChannel,s);this._constrainedAxisPresenter=new l();this._constrainedAxisPresenter.init(this._fullDico,this._privateChannel,r);this._jsonModelMap={drivingCriteria:{},constrainedCriteria:{},drivingCombinationValues:{},constrainedValues:{}};this._initDivs()};j.prototype._initDivs=function(){this._container=document.createElement("div");this._container.classList.add("build-tablerule-presenter");UWA.extendElement(this._container);this._enoxSplitView.inject(this._container);this._drivingContainer=this._enoxSplitView.getLeft();this._drivingAxisPresenter.inject(this._drivingContainer);this._constrainedContainer=this._enoxSplitView.getRight();this._constrainedAxisPresenter.inject(this._constrainedContainer)};j.prototype._subscribeToEvents=function(){var r=this;this._myEventManager.subscribe(this._updateChannel,{event:"on-add-variability-btn-click"},function(s){if(s&&s.selected){if(r._isRHSPanelActivated==false){r._isRHSPanelActivated=true;r._applicationChannel.publish({event:"information-panel-hidden",data:"right"});r._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:null}});r._applicationChannel.publish({event:"triptych-show-panel",data:"right"});r._criteriaSelector.publish("buildtime-axis-change",s.id);r._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:r._criteriaSelector.container}});r._workaroundCheckAndWakeUpResizeSensor(r._criteriaSelector.container)}else{r._criteriaSelector.publish("buildtime-axis-change",s.id)}r._currAxisId=s.id;if(r._currAxisId=="driving"){var t=r._criteriaSelector.container.getElementsByClassName("wux-ui-3ds-table-column-row");if(t&&t.length>0){t[0].addClassName("wux-ui-3ds-table-row-column");t[0].removeClassName("wux-ui-3ds-table-column-row")}}else{if(r._currAxisId=="constrained"){var t=r._criteriaSelector.container.getElementsByClassName("wux-ui-3ds-table-row-column");if(t&&t.length>0){t[0].addClassName("wux-ui-3ds-table-column-row");t[0].removeClassName("wux-ui-3ds-table-row-column")}}}}else{if(r._isRHSPanelActivated){r._isRHSPanelActivated=false;r._applicationChannel.publish({event:"triptych-hide-panel",data:null})}}});this._myEventManager.subscribe(this._applicationChannel,{event:"triptych-hide-panel"},function(){if(r._isRHSPanelActivated==true){r._isRHSPanelActivated=false;r._updateChannel.publish({event:"triptych-hide-panel",data:{}})}});this._myEventManager.subscribe(this._updateChannel,{event:"triptych-hide-panel-if-opened-from-rule"},function(){if(r._isRHSPanelActivated==true){r._applicationChannel.publish({event:"triptych-hide-panel",data:null})}});this._myEventManager.subscribe(this._updateChannel,{event:"update-vcs-on-axis-content-load"},function(s){console.log("BuildtimePresenter: update-vcs-on-axis-content-load handler");var u=s.criteriaList;var t=s.axisId||undefined;r._criteriaSelector.processDicoItemsForBuildTimeVCS(s)});this._myEventManager.subscribe(this._updateChannel,{event:"update-vcs-on-axis-content-change"},function(D){try{if(D&&D.value!=undefined){var u=D.value?1:0;var B=D.axisId;var C=r._criteriaSelector.getTreeDocument().search({match:function(K){if(K.nodeModel.options.id==D.id){return true}}});if(C&&C.length>0){r._criteriaSelector.publish("dgv-prepare-update-view",{});r._criteriaSelector.getTreeDocument().prepareUpdate();var v=C[0];var E=v.hasChildren();if(E){v.setAttribute(g,(u==1?true:false));v.setAttribute(a,(u==0?undefined:B));v.getChildren().forEach(function(K){K.setAttribute(g,(u==1?true:false));K.setAttribute(a,(u==0?undefined:B))})}else{var J=v.getParent();if(J){var H=J.getNumberOfChildren();v.setAttribute(g,(u==1?true:false));v.setAttribute(a,(u==0?undefined:B));if(H===1){J.setAttribute(g,(u==1?true:false));J.setAttribute(a,(u==0?undefined:B));v.setAttribute(a,(u==0?undefined:B))}else{if(H>1){var s=false;var I=0;var A=0;var z=undefined;var w=J.getChildren();for(var F=0,G=w.length;F<G;F++){var y=w[F];var t=y.options.grid.attrDisabled;if(y&&(t==undefined||t==false)){A+=1}else{if(y&&(t==true)){z=y.options.grid.attrAxis;I+=1}}}if(u==1){v.getBrothers().forEach(function(K){K.setAttribute(a,B)})}if(I>0&&A>0){J.setAttribute(g,false);J.setAttribute(a,z);v.setAttribute(a,z)}if(I==0&&A==H){J.setAttribute(g,false);J.setAttribute(a,undefined);v.setAttribute(a,undefined)}if(A==0&&I>0){J.setAttribute(g,true);J.setAttribute(a,z);v.setAttribute(a,z)}}}}}r._criteriaSelector.getTreeDocument().pushUpdate();r._criteriaSelector.publish("dgv-push-update-view",{})}}}catch(x){console.log("[BuildTimePresenter:update-vcs-on-axis-content-change Handler] Exception Occured: "+x)}});this._privateChannel.subscribe({event:"axis-add-criteria"},function(w){console.log("added criteria: "+w);r._privateChannel.publish({event:"mr-model-change",data:""});if(w.id=="driving"){var A={};var z={};r.jsonModel.drivingCriteria.forEach(function(D){if(UWA.is(D.selectedValues,"array")){var C=[];D.selectedValues.forEach(function(E){if(E.variantValue){C.push(E.variantValue)}});A[D.id]=C;var B=[];D.rejectedValues.forEach(function(E){if(E.criteriaValidity){if(E.criteriaValidity=="yes"){B.push(true)}else{if(E.criteriaValidity=="no"){B.push(false)}}}})}z[D.id]=B});for(var u in w.criteria){if(w.criteria.hasOwnProperty(u)){if(UWA.is(w.criteria[u],"array")){var v=[];var y=z[u]||[true,false];w.criteria[u].forEach(function(B){if(B.variantValue){if(v.indexOf(B.variantValue)==-1){v.push(B.variantValue)}}if(B.criteriaValidity){if(B.criteriaValidity=="yes"){var C=y.indexOf(true);if(C!=-1){y.splice(C,1)}}else{if(B.criteriaValidity=="no"){var C=y.indexOf(false);if(C!=-1){y.splice(C,1)}}}}});if(A[u]){v.forEach(function(B){if(A[u].indexOf(B)==-1){A[u].push(B)}})}else{A[u]=v}z[u]=y}}}var t=[];var x=0;for(var u in A){if(A.hasOwnProperty(u)){t.push(u);t=t.concat(A[u]);x++}}r._privateChannel.publish({event:"switch-view-allow",data:false});r._constrainedAxisPresenter.mask();r.computeCombinations(t,x,z).then(function(C){console.log("combinations : ",C);console.log(z);var B=C.length;r._privateChannel.publish({event:"new-axis-nb",data:{id:"driving",count:B}});if(B>600){r._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:e.ERROR_MAX_DRIVING_COMBINATIONS}});r._privateChannel.publish({event:"mr-rule-save-allow",data:{allow:false,message:e.SAVE_ERROR_MAX_DRIVING_COMBINATIONS}});r._isRequiredRefresh=false}else{r._matrixRuleModel.updateDrivingCombinationValues(C);r._isRequiredRefresh=true}r._matrixRuleModel.addDrivingCriteria(w.criteria);r._matrixRuleModel.reOrderDrivingCriteria();r._privateChannel.publish({event:"switch-view-allow",data:true});r._constrainedAxisPresenter.unmask()},function(){console.log(e.ERROR_COMPUTING_COMBINATIONS);r._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:e.ERROR_COMPUTING_COMBINATIONS}});r._privateChannel.publish({event:"switch-view-allow",data:true});r._constrainedAxisPresenter.unmask()})}else{if(w.id=="constrained"){r._drivingAxisPresenter.mask();var s=r.getCriteriaValues(w.criteria);r._matrixRuleModel.addConstrainedValues(s);r._matrixRuleModel.addConstrainedCriteria(w.criteria);r._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:r._matrixRuleModel.getJsonModel().constrainedValues.length}});r._isRequiredRefresh=true;r._drivingAxisPresenter.unmask()}}console.log()});this._privateChannel.subscribe({event:"axis-remove-criteria"},function(w){console.log("removed criteria: "+w);r._privateChannel.publish({event:"mr-model-change",data:""});if(w.id=="driving"){var s={};var y={};r.jsonModel.drivingCriteria.forEach(function(F){var C=[];if(UWA.is(F.selectedValues,"array")){var E=[];var D=false;for(var B=0;B<F.selectedValues.length;B++){if(w.criteria[F.id]){var A=true;for(var z=0;z<w.criteria[F.id].length;z++){w.criteria[F.id][z];if(w.criteria[F.id][z].variantValue){if(w.criteria[F.id][z].variantValue==F.selectedValues[B].variantValue){A=false;break}}else{if(w.criteria[F.id][z].criteriaValidity){if(F.selectedValues[B].hasOwnProperty("criteriaValidity")){if(w.criteria[F.id][z].criteriaValidity==F.selectedValues[B].criteriaValidity){A=false;if(w.criteria[F.id][z].criteriaValidity=="yes"){C.push(true)}else{if(w.criteria[F.id][z].criteriaValidity=="no"){C.push(false)}}break}else{D=true}}}}}if(A){if(F.selectedValues[B].variantValue){if(E.indexOf(F.selectedValues[B].variantValue)==-1){E.push(F.selectedValues[B].variantValue)}}}}else{if(F.selectedValues[B].variantValue){if(E.indexOf(F.selectedValues[B].variantValue)==-1){E.push(F.selectedValues[B].variantValue)}}if(F.selectedValues[B].hasOwnProperty("criteriaValidity")){D=true}}}if(D||E.length>0){s[F.id]=E}else{delete s[F.id]}}if(UWA.is(F.rejectedValues,"array")){F.rejectedValues.forEach(function(G){if(G.criteriaValidity){if(G.criteriaValidity=="yes"){if(C.indexOf(true)==-1){C.push(true)}}else{if(G.criteriaValidity=="no"){if(C.indexOf(false)==-1){C.push(false)}}}}})}y[F.id]=C});var u=[];var t=0;for(var x in s){if(s.hasOwnProperty(x)){u.push(x);u=u.concat(s[x]);t++}}r._privateChannel.publish({event:"switch-view-allow",data:false});r._constrainedAxisPresenter.mask();r.computeCombinations(u,t,y).then(function(A){console.log("combinations : ",A);var z=A.length;r._privateChannel.publish({event:"new-axis-nb",data:{id:"driving",count:z}});if(z>600){r._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:e.ERROR_MAX_DRIVING_COMBINATIONS}});r._privateChannel.publish({event:"mr-rule-save-allow",data:{allow:false,message:e.SAVE_ERROR_MAX_DRIVING_COMBINATIONS}});r._isRequiredRefresh=false}else{r._matrixRuleModel.updateDrivingCombinationValues(A);r._isRequiredRefresh=true}r._matrixRuleModel.removeDrivingCriteria(w.criteria);r._matrixRuleModel.reOrderDrivingCriteria();r._privateChannel.publish({event:"switch-view-allow",data:true});r._constrainedAxisPresenter.unmask()},function(){console.log(e.ERROR_COMPUTING_COMBINATIONS);r._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:e.ERROR_COMPUTING_COMBINATIONS}});r._privateChannel.publish({event:"switch-view-allow",data:true});r._constrainedAxisPresenter.unmask()})}else{if(w.id=="constrained"){r._drivingAxisPresenter.mask();r._matrixRuleModel.removeConstrainedCriteria(w.criteria);var v=r.getCriteriaValues(w.criteria);r._matrixRuleModel.removeConstrainedValues(v);r._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:r._matrixRuleModel.getJsonModel().constrainedValues.length}});r._isRequiredRefresh=true;r._drivingAxisPresenter.unmask()}}console.log()});this._model.addEvent("onChange:drivingCriteria",function(){console.log("driving Criteria changing")});this._model.addEvent("onChange:constrainedCriteria",function(){console.log("constrained Criteria changing")});this._privateChannel.subscribe({event:"mr-init-finished"},function(){var s=r.createDicoFromModel("constrained");r._constrainedAxisPresenter.setDico(s);var t=r.createDicoFromModel("driving");r._drivingAxisPresenter.setDico(t);r._privateChannel.publish({event:"new-axis-nb",data:{id:"driving",count:r._model.get("drivingCriteria").length}});r._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:r._model.get("constrainedCriteria").length}});r._privateChannel.publish({event:"new-axis-nb",data:{id:"driving",count:18}});r._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:5}})});this._privateChannel.subscribe({event:"switched-view"},function(s){if(s==="run"){if(r._isRequiredRefresh){r._privateChannel.publish({event:"mr-refresh-run-view"});r._isRequiredRefresh=false}if(r._isRHSPanelActivated==true){r._applicationChannel.publish({event:"triptych-hide-panel",data:null})}}else{if(s==="build"){r.jsonModel=r._matrixRuleModel.getJsonModel()}}})};j.prototype.getCriteriaValues=function(w){var u={};for(var v in w){if(w.hasOwnProperty(v)){var r=[];for(var s=0;s<w[v].length;s++){var t=UWA.clone(w[v][s]);if(t.variantValue){t.id=t.variantValue;t.parent=v}else{t.id=v;t.parent=null}r.push(t)}u[v]=r}}return u};j.prototype.inject=function(r){r.appendChild(this._container);this._enoxSplitView.attachResizeSensor()};j.prototype.updateModel=function(s,r){var t=r.criteria;switch(s){case"driving":this.jsonModel.drivingCriteria=t;this.jsonModel.drivingCombinationValues=r.combinations;break;case"constrained":this.jsonModel.constrainedCriteria=t;this.jsonModel.constrainedValues=r.values;break;default:break}};j.prototype._initVCS=function(){var r=this;this._criteriaSelector=new q({title:"<B>"+e.VARIABILITY_SECTION_TITLE+"</B>",dictionaryJSON:this._dicoForVCS,getAllChildrenOnParentSelection:false,getParentOnChildSelection:false,actions:[{id:"toggleAxis",title:e.SWITCH_AXIS,text:e.SWITCH_AXIS,fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-table-column-row",handler:function(s,t){if(r._currAxisId=="driving"){r._updateChannel.publish({event:"on-add-variability-btn-click",data:{selected:true,id:"constrained"}})}else{if(r._currAxisId=="constrained"){r._updateChannel.publish({event:"on-add-variability-btn-click",data:{selected:true,id:"driving"}})}}}}],itemActions:[{title:"Add",text:"add",fonticon:"plus",event:"onAddAction"}],contentFilter:function(s){var t=true;if(s.kind=="instance"){t=false}return t}});this._criteriaSelector.render();this._criteriaSelector.subscribe("onAddAction",function(s){console.log("BuildTimePresenter: onAddAction!!!");if(s.nodeModel!=undefined){var w=s.nodeModel;var t={id:w.options.id,name:"_include",value:true,axisId:s.axisId?s.axisId:undefined};var v=t;var u="";switch(w.options.criteriaType){case"Variants":u="variant";break;case"Values":u="value";break;case"VariabilityGroups":u="variabilityGroup";break;case"Options":u="option";break}UWA.merge(v,{changedObject:w.options.dictionaryItem,type:u});if(s.axisId=="driving"){r._drivingAxisPresenter.onChangeAttributeHandler(v)}else{if(s.axisId=="constrained"){r._constrainedAxisPresenter.onChangeAttributeHandler(v)}}}})};j.prototype.createDicoFromModel=function(t){var s=0,r=[];if(t==="driving"){for(s=0;s<this._model.get("drivingCriteria").length;s+=1){r.push(this._model.get("drivingCriteria")[s])}}else{if(t==="constrained"){for(s=0;s<this._model.get("constrainedCriteria").length;s+=1){r.push(this._model.get("constrainedCriteria")[s])}}}return r};j.prototype.addCriteriaInDico=function(r,s){};j.prototype.computeCombinations=function(s,r,v){var u=[];var t=this;return new UWA.Promise(function(y,x){if(s.length>0){var w={_from:"test",_to:"solverConfiguration",_request:"computeSolutions",_data:{getCombinations:true,includeInvalidCriteria:true,combinationsIds:s,maxCombinations:10000}};if(t._solverKey){p.computeAnswer(w,t._solverKey).then(function(z){console.log("success",z);var z=JSON.parse(z);if(z){if(z._rc=="OK"){var A=z._data.combinations;if(UWA.is(A,"array")){A.forEach(function(D){var B=true;if(v){for(var C=0;C<D.length;C++){var E=D[C].id;if(v[E]){if(v[E].indexOf(D[C].validity)!=-1){B=false;break}}}}if(B){if(r){if(D.length==r){u.push(D)}}else{u.push(D)}}})}}else{x()}}y(u)})}}else{y(u)}})};j.prototype.formatCriteria=function(s){var r=[];if(s){s.forEach(function(t){var u={attributes:{}};if(t.type=="variant"){u.lid=t.id}else{if(t.type=="option"){u.rel_lid=t.id}}if(t.selectedValues){t.selectedValues.forEach(function(v){if(v.variantValue){r.push({rel_lid:v.variantValue,attributes:{_include:1}})}else{if(v.criteriaValidity){if(v.criteriaValidity=="yes"){u.attributes._include=1}else{if(v.criteriaValidity=="no"){u.attributes._includeNot=true}}}}})}if(t.rejectedValues){t.rejectedValues.forEach(function(v){if(v.variantValue){r.push({rel_lid:v.variantValue,attributes:{_include:0}})}else{if(v.criteriaValidity){if(v.criteriaValidity=="yes"){u.attributes._include=0}else{if(v.criteriaValidity=="no"){u.attributes._includeNot=false}}}}})}if(Object.keys(u.attributes).length>0){r.push(u)}})}return r};j.prototype.refreshUI=function(){this.jsonModel=this._matrixRuleModel.getJsonModel();var s=this.formatCriteria(this.jsonModel.drivingCriteria);var r=this.formatCriteria(this.jsonModel.constrainedCriteria);this._drivingAxisPresenter.refreshUI({criteria:s});this._constrainedAxisPresenter.refreshUI({criteria:r});this._isRequiredRefresh=false;this._privateChannel.publish({event:"new-axis-nb",data:{id:"driving",count:this.jsonModel.drivingCombinationValues.length}});this._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:this.jsonModel.constrainedValues.length}})};j.prototype.destroy=function(){if(this._drivingAxisPresenter){this._drivingAxisPresenter.destroy()}if(this._constrainedAxisPresenter){this._constrainedAxisPresenter.destroy()}this._myEventManager.cleanup("BuildTimePresenter")};return j});define("DS/CfgRuleMatrixComponent/Model/MatrixRuleModel",["DS/CfgRuleMatrixComponent/Utils/MatruiTablePersistanceUtils"],function(a){var b=function(d,c){this.init(d,c)};b.prototype.init=function(e,c){var d=c.version===2?c:a.convertJsonToV2(e,c);this.__jsonModel=JSON.parse(JSON.stringify(d));this._drivingCriteria=this.__jsonModel.drivingCriteria||[];this._constrainedCriteria=this.__jsonModel.constrainedCriteria||[];this._constrainedValues=this.__jsonModel.constrainedValues||[];this._drivingCombinationValues=this.__jsonModel.drivingCombinationValues||[];this._mapDico=e||[];this._states=this.__jsonModel.states||[];this._statesValidity=this.__jsonModel.statesValidity||[];this._timerID=[]};b.prototype.getJsonModel=function(){return this.__jsonModel};b.prototype.setJsonModel=function(c){UWA.extend(this.__jsonModel,c);this._drivingCriteria=this.__jsonModel.drivingCriteria;this._constrainedCriteria=this.__jsonModel.constrainedCriteria;this._constrainedValues=this.__jsonModel.constrainedValues;this._drivingCombinationValues=this.__jsonModel.drivingCombinationValues;this._states=this.__jsonModel.states;this._statesValidity=this.__jsonModel.statesValidity};b.prototype.reOrderDrivingCriteria=function(){var k=this;var e=[];k.__jsonModel.drivingCriteria.forEach(function(i){e.push(i.id)});var h=function(o,m){var l=0;var q=o[0];var n=m[0];for(var p=0;p<e.length;p++){var r=e[p];if(q[r].variantValue&&n[r].variantValue){if(k._mapDico[q[r].variantValue].name===k._mapDico[n[r].variantValue].name){continue}else{l=k._mapDico[q[r].variantValue].name<k._mapDico[n[r].variantValue].name?-1:1}}else{if(q[r].variantValue&&n[r].criteriaValidity){l=-1}else{if(q[r].criteriaValidity&&n[r].variantValue){l=1}else{if(q[r].criteriaValidity&&n[r].criteriaValidity){if(q[r].criteriaValidity===n[r].criteriaValidity){continue}else{l=q[r].criteriaValidity>n[r].criteriaValidity?-1:1}}}}}break}return l};var j=function(l){for(var n=0;n<l.length;n++){l[n]=[l[n],n]}l.sort(h);var o=[];for(var m=0;m<l.length;m++){o.push(l[m][1]);l[m]=l[m][0]}return o};var c=j(k.__jsonModel.drivingCombinationValues);console.log(c);var d=[];var g=[];var f=0;for(f=0;f<c.length;f+=1){d.push(k.__jsonModel.states[c[f]]);g.push(k.__jsonModel.statesValidity[c[f]])}k.__jsonModel.states=d;k.__jsonModel.statesValidity=g};b.prototype.addConstrainedValues=function(h){var g=this;for(var d in h){var m=0;var l=false;for(var f=0;f<g.__jsonModel.constrainedCriteria.length;f++){if(UWA.is(g.__jsonModel.constrainedCriteria[f].selectedValues,"array")){if(g.__jsonModel.constrainedCriteria[f].id==d){var k=[];var c=h[d];g.__jsonModel.constrainedCriteria[f].selectedValues.forEach(function(i){c.forEach(function(j,n){if(i.variantValue==j.variantValue&&i.criteriaValidity==j.criteriaValidity){k.push(n)}else{m++}})});if(k.length>0){for(var e=k.length-1;e>=0;e--){c.splice(k[e],1)}}}else{m+=g.__jsonModel.constrainedCriteria[f].selectedValues.length}}if(g.__jsonModel.constrainedCriteria[f].id==d){break}}if(h.hasOwnProperty(d)){var c=h[d];c.forEach(function(j){var s=j.id;if(m>g.__jsonModel.constrainedValues.length){m=g.__jsonModel.constrainedValues.length}g.__jsonModel.constrainedValues.splice(m,0,j);for(var o=0;o<g.__jsonModel.states.length;o++){var q=g.__jsonModel.states[o];var r=q.slice(0,m)+"A"+q.slice(m);g.__jsonModel.states[o]=r}for(var o=0;o<g.__jsonModel.statesValidity.length;o++){var n=g.__jsonModel.statesValidity[o];var p=n.slice(0,m)+"V"+n.slice(m);g.__jsonModel.statesValidity[o]=p}})}}console.log(this.__jsonModel)};b.prototype.removeConstrainedValues=function(c){var d=this;for(var f in c){if(c.hasOwnProperty(f)){var e=c[f];e.forEach(function(g){var o=g.id;var l=-1;for(var j=0;j<d.__jsonModel.constrainedValues.length;j++){if(d.__jsonModel.constrainedValues[j].id==o){if((!d.__jsonModel.constrainedValues[j].variantValue||(d.__jsonModel.constrainedValues[j].variantValue==g.variantValue))&&d.__jsonModel.constrainedValues[j].criteriaValidity==g.criteriaValidity){l=j;break}}}if(l>-1){d.__jsonModel.constrainedValues.splice(l,1);for(var j=0;j<d.__jsonModel.states.length;j++){var n=d.__jsonModel.states[j].split("");n.splice(l,1);var m=n.join("");d.__jsonModel.states[j]=m;var h=d.__jsonModel.statesValidity[j].split("");h.splice(l,1);var k=h.join("");d.__jsonModel.statesValidity[j]=k}}})}}console.log(this.__jsonModel)};b.prototype.addDrivingCombinationValues=function(c){};b.prototype.removeDrivingCombinationValues=function(e){for(var d=0;d<e.length;d++){var c=e[d];if(c!==-1&&c<this.__jsonModel.drivingCombinationValues.length){this.__jsonModel.drivingCombinationValues.splice(c,1);this.__jsonModel.states.splice(c,1);this.__jsonModel.statesValidity.splice(c,1)}}console.log(this.__jsonModel)};b.prototype.updateDrivingCombinationValues=function(f){if(UWA.is(f,"array")){f=UWA.clone(f);var h=[];this.__jsonModel.drivingCombinationValues.forEach(function(m,r){var s=-1;for(var n=0;n<f.length;n++){var t=Object.keys(m);if(t.length==f[n].length){var l=false;for(var p=0;p<f[n].length;p++){var q=m[f[n][p].id];if(q){if(q.hasOwnProperty("criteriaValidity")){if((q.criteriaValidity=="no"&&f[n][p].validity==false)||(q.criteriaValidity=="yes"&&f[n][p].validity==true)){l=true}else{l=false;break}}}else{if(l){l=false}for(var o=0;o<t.length;o++){if(m[t[o]].variantValue==f[n][p].id){l=true;break}}}}if(l){s=n;break}}}if(s!=-1){f.splice(s,1)}else{h.push(r)}});var d=[];var g=this;f.forEach(function(i){var k={};i.forEach(function(m){var l=g._mapDico[m.id];if(l.parent){k[l.parent]={variantValue:m.id,value:l.name,type:l.type}}else{k[m.id]={value:l.name,type:l.type};if(m.validity==true){k[m.id].criteriaValidity="yes"}else{k[m.id].criteriaValidity="no"}}});d.push(k)});var j=[];var c=[];d.forEach(function(m){var o="";var p="";for(var r=0;r<g.__jsonModel.drivingCombinationValues.length;r++){var l=g.__jsonModel.drivingCombinationValues[r];var t=r;var v=Object.keys(l);var u=Object.keys(m);if(v.length>0&&v.length<u.length){var k=false;for(var n=0;n<v.length;n++){var s=m[v[n]];var q=l[v[n]];if(s){if(s.criteriaValidity==q.criteriaValidity&&s.variantValue==q.variantValue){k=true}else{break}}else{break}}if(k){o=g.__jsonModel.states[t];break}}}for(var r=0;r<g.__jsonModel.constrainedValues.length;r++){if(o.length<(r+1)){o+="A"}if(p.length<(r+1)){p+="V"}}j.push(o);c.push(p)});h.reverse();h.forEach(function(i){g.__jsonModel.drivingCombinationValues.splice(i,1);g.__jsonModel.states.splice(i,1);g.__jsonModel.statesValidity.splice(i,1)});if(d.length>0){for(var e=0;e<d.length;e++){d[e];g.__jsonModel.drivingCombinationValues.push(d[e]);g.__jsonModel.states.push(j[e]);g.__jsonModel.statesValidity.push(c[e])}}}};b.prototype.addDrivingCriteria=function(c){this._addCriteria(this.__jsonModel.drivingCriteria,c);console.log(this.__jsonModel)};b.prototype.removeDrivingCriteria=function(c){this._removeCriteria(this.__jsonModel.drivingCriteria,c);console.log(this.__jsonModel)};b.prototype._addCriteria=function(e,h){for(var d in h){if(h.hasOwnProperty(d)){var k=false;e.forEach(function(m){if(m.id==d){k=true;var l=h[d];l.forEach(function(n){var o=false;m.selectedValues.forEach(function(q){if(q.variantValue==n.variantValue&&q.criteriaValidity==n.criteriaValidity){o=true}});if(!o){m.selectedValues.push(n);var p=m.rejectedValues.findIndex(function(q){return(q.variantValue==n.variantValue&&q.criteriaValidity==n.criteriaValidity)});if(p!=-1){m.rejectedValues.splice(p,1)}}})}});if(!k){var f={id:d};var j=this._mapDico[d];if(j){f.name=j.name;f.type=j.type;f.selectedValues=h[d];f.rejectedValues=[];if(j.values){var g=false;var i=UWA.clone(j.values);h[d].forEach(function(l){if(l.variantValue){var m=i.indexOf(l.variantValue);if(m!=-1){i.splice(m,1)}}else{if(l.criteriaValidity){g=true}}});i.forEach(function(l){f.rejectedValues.push({variantValue:l})});if(!g){f.rejectedValues.push({criteriaValidity:"no"})}}else{var c=["yes","no"];h[d].forEach(function(l){if(l.criteriaValidity){var m=c.indexOf(l.criteriaValidity);if(m!=-1){c.splice(m,1)}}});c.forEach(function(l){f.rejectedValues.push({criteriaValidity:l})})}}e.push(f)}}}};b.prototype._removeCriteria=function(f,d){for(var e in d){if(d.hasOwnProperty(e)){var c=-1;f.forEach(function(i,h){if(i.id==e){var g=d[e];g.forEach(function(j){i.rejectedValues.push(j);var k=i.selectedValues.findIndex(function(l){return(l.variantValue==j.variantValue&&l.criteriaValidity==j.criteriaValidity)});if(k!=-1){i.selectedValues.splice(k,1)}});if(i.selectedValues.length==0){c=h}}});if(c>-1){f.splice(c,1)}}}};b.prototype.addConstrainedCriteria=function(c){this._addCriteria(this.__jsonModel.constrainedCriteria,c);console.log(this.__jsonModel)};b.prototype.removeConstrainedCriteria=function(c){this._removeCriteria(this.__jsonModel.constrainedCriteria,c);console.log(this.__jsonModel)};b.prototype._isPresent=function(e,d){for(var c=0;c<e.length;c++){if(e[c].id===d.id){return true}}return false};b.prototype.setStateWithID=function(e,f,g){var c=this.__jsonModel.states[e];var d=c.substr(0,f)+g+c.substr(f+1,c.length);this.__jsonModel.states[e]=d};b.prototype.getMiniJsonModel=function(d){var c={drivingCriteria:this.__jsonModel.drivingCriteria,constrainedCriteria:this.__jsonModel.constrainedCriteria,drivingCombinationValues:[this.__jsonModel.drivingCombinationValues[d]],constrainedValues:this.__jsonModel.constrainedValues,states:[this.__jsonModel.states[d]],version:"2.0",_clientData:{columnID:d,timerID:this._timerID[d]}};return c};b.prototype.setTimerIDForColumnID=function(c){if(c>=0){this._timerID[c]=performance.now()}};b.prototype.updateJsonModel=function(d){var c=d._clientData.columnID;if(c>=0){this.__jsonModel.states[c]=d.states[0];this.__jsonModel.statesValidity[c]=d.statesValidity[0]}};b.prototype.checkAndFixDiscrepancy=function(){var c={};c._rc=0;c.discrepancyList=[];var f=0,d=0;var h=[];var g=[];for(f=0;f<this.__jsonModel.drivingCriteria.length;f+=1){if(this._mapDico[this.__jsonModel.drivingCriteria[f].id]==undefined){this.__jsonModel.states=[];this.__jsonModel.statesValidity=[];this.__jsonModel.drivingCriteria[f]="to remove";this.__jsonModel.drivingCombinationValues=[];g.push(this.__jsonModel.drivingCriteria[f].id)}}this.__jsonModel.drivingCriteria=this.__jsonModel.drivingCriteria.filter(function(i){return i!=="to remove"});for(f=0;f<this.__jsonModel.drivingCriteria.length;f+=1){if(this.__jsonModel.drivingCriteria[f].selectedValues){for(d=0;d<this.__jsonModel.drivingCriteria[f].selectedValues.length;d+=1){if(!this.__jsonModel.drivingCriteria[f].selectedValues[d].criteriaValidity&&this._mapDico[this.__jsonModel.drivingCriteria[f].selectedValues[d].variantValue]==undefined){g.push(this.__jsonModel.drivingCriteria[f].selectedValues[d].variantValue);this.__jsonModel.drivingCriteria[f].selectedValues[d]="toremove"}this.__jsonModel.drivingCriteria[f].selectedValues=this.__jsonModel.drivingCriteria[f].selectedValues.filter(function(i){return i!=="toremove"})}}if(this.__jsonModel.drivingCriteria[f].rejectedValues){for(d=0;d<this.__jsonModel.drivingCriteria[f].rejectedValues.length;d+=1){if(!this.__jsonModel.drivingCriteria[f].rejectedValues[d].criteriaValidity&&this._mapDico[this.__jsonModel.drivingCriteria[f].rejectedValues[d].variantValue]==undefined){g.push(this.__jsonModel.drivingCriteria[f].rejectedValues[d].variantValue);this.__jsonModel.drivingCriteria[f].rejectedValues[d]="toremove"}this.__jsonModel.drivingCriteria[f].rejectedValues=this.__jsonModel.drivingCriteria[f].rejectedValues.filter(function(i){return i!=="toremove"})}}}for(f=0;f<this.__jsonModel.constrainedCriteria.length;f+=1){if(this._mapDico[this.__jsonModel.constrainedCriteria[f].id]==undefined){g.push(this.__jsonModel.constrainedCriteria[f].id);this.__jsonModel.constrainedCriteria[f]="to remove"}}this.__jsonModel.constrainedCriteria=this.__jsonModel.constrainedCriteria.filter(function(i){return i!=="to remove"});for(f=0;f<this.__jsonModel.constrainedCriteria.length;f+=1){if(this.__jsonModel.constrainedCriteria[f].selectedValues){for(d=0;d<this.__jsonModel.constrainedCriteria[f].selectedValues.length;d+=1){if(!this.__jsonModel.constrainedCriteria[f].selectedValues[d].criteriaValidity&&this._mapDico[this.__jsonModel.constrainedCriteria[f].selectedValues[d].variantValue]==undefined){g.push(this.__jsonModel.constrainedCriteria[f].selectedValues[d].variantValue);this.__jsonModel.constrainedCriteria[f].selectedValues[d]="toremove"}this.__jsonModel.constrainedCriteria[f].selectedValues=this.__jsonModel.constrainedCriteria[f].selectedValues.filter(function(i){return i!=="toremove"})}}if(this.__jsonModel.constrainedCriteria[f].rejectedValues){for(d=0;d<this.__jsonModel.constrainedCriteria[f].rejectedValues.length;d+=1){if(!this.__jsonModel.constrainedCriteria[f].rejectedValues[d].criteriaValidity&&this._mapDico[this.__jsonModel.constrainedCriteria[f].rejectedValues[d].variantValue]==undefined){g.push(this.__jsonModel.constrainedCriteria[f].rejectedValues[d].variantValue);this.__jsonModel.constrainedCriteria[f].rejectedValues[d]="toremove"}this.__jsonModel.constrainedCriteria[f].rejectedValues=this.__jsonModel.constrainedCriteria[f].rejectedValues.filter(function(i){return i!=="toremove"})}}}var e=null;var k=[];for(f=0;f<this.__jsonModel.drivingCombinationValues.length;f+=1){var l=true;if(k.length===0){for(e in this.__jsonModel.drivingCombinationValues[0]){k.push(e)}}for(d=0;d<k.length;d+=1){if(!this.__jsonModel.drivingCombinationValues[f][k[d]].criteriaValidity&&this._mapDico[this.__jsonModel.drivingCombinationValues[f][k[d]].variantValue]==undefined){g.push(this.__jsonModel.drivingCombinationValues[f][k[d]].variantValue);l=false}}if(!l){this.__jsonModel.drivingCombinationValues[f]="to remove";this.__jsonModel.states[f]="YOURE REMOVED";this.__jsonModel.statesValidity[f]="YOURE REMOVED"}}this.__jsonModel.states=this.__jsonModel.states.filter(function(i){return i!=="YOURE REMOVED"});this.__jsonModel.statesValidity=this.__jsonModel.statesValidity.filter(function(i){return i!=="YOURE REMOVED"});this.__jsonModel.drivingCombinationValues=this.__jsonModel.drivingCombinationValues.filter(function(i){return i!=="to remove"});for(f=0;f<this.__jsonModel.constrainedValues.length;f+=1){if(this._mapDico[this.__jsonModel.constrainedValues[f].id]==undefined){h.push(f);g.push(this.__jsonModel.constrainedValues[f].id)}}if(h.length>0){for(d=0;d<this.__jsonModel.states.length;d+=1){for(f=0;f<h.length;f+=1){this.__jsonModel.states[d]=this.__jsonModel.states[d].substr(0,h[f])+"_"+this.__jsonModel.states[d].substr(h[f]+1);this.__jsonModel.statesValidity[d]=this.__jsonModel.statesValidity[d].substr(0,h[f])+"_"+this.__jsonModel.statesValidity[d].substr(h[f]+1)}this.__jsonModel.states[d]=this.__jsonModel.states[d].replace(/_/g,"");this.__jsonModel.statesValidity[d]=this.__jsonModel.statesValidity[d].replace(/_/g,"")}for(f=0;f<h.length;f+=1){this.__jsonModel.constrainedValues[h[f]]="test_remove"}this.__jsonModel.constrainedValues=this.__jsonModel.constrainedValues.filter(function(i){return i!=="test_remove"})}c._discrepancyIds=g;if(c._discrepancyIds.length>0){c._discrepancyIds=c._discrepancyIds.filter(function(i,j){return c._discrepancyIds.indexOf(i)==j});c._rc=-1}return c};return b});define("DS/CfgRuleMatrixComponent/Buildtime/DrivingCriteriaPresenter",["DS/Handlebars/Handlebars","DS/Core/ModelEvents","DS/UIKIT/Mask","UWA/Element","DS/CfgDictionary/CfgDictionaryV3Utils","DS/CfgRuleMatrixComponent/Buildtime/AxisPresenter","DS/ENOXSplitView/js/ENOXSplitView","DS/WebappsUtils/WebappsUtils","DS/CfgRuleMatrixComponent/Model/DemoModel","DS/CfgSolver/CfgSolverServices","DS/CfgVCSComponent/Presenter/DgvCfgVCSMainContainer","DS/xModelEventManager/xModelEventManager","i18n!DS/CfgRuleMatrixComponent/assets/nls/DrivingCriteriaPresenter","css!DS/CfgRuleMatrixComponent/Buildtime/DrivingCriteriaPresenter.css"],function(c,d,h,n,i,k,l,e,m,o,q,g,p,j){var f="attrDisabled";var b="attrAxis";var a=function(){};a.prototype.init=function(v,u,y,t,z,r){this._criteriaSelector=r;this._fullDico=v;this._model=new m();this._matrixRuleModel=u;this._privateChannel=t?t:new d();this._updateChannel=z&&z.updateChannel!==undefined?z.updateChannel:new d();this._applicationChannel=y;this._myEventManager=new g(this._privateChannel,this._updateChannel,this._applicationChannel);this._isReadyToSwitch=true;this._editable=z.editable===false?false:true;this._isRequiredRefresh=false;this._solverKey=z.solverKey||null;this.jsonModel=this._matrixRuleModel.getJsonModel();this._isRHSPanelActivated=false;this._workaroundCheckAndWakeUpResizeSensor=z.resizeSensorEnablerFun?z.resizeSensorEnablerFun:function(){};this._initVCS();this._subscribeToEvents();var s={updateChannel:this._updateChannel,editable:this._editable};s.axisMainTitle="X "+p._axis;s.axisTitle=p._driving_criteria;s.axisSubtitle=" "+p._columns;s.axisIcon=e.getWebappsAssetUrl("CfgRuleMatrixComponent","Xaxis.png");s.id="driving";s.nbMax=600;s.criteria=[];var x=this.formatCriteria(this.jsonModel.drivingCriteria);s.criteria=x;this._drivingAxisPresenter=new k();var w=UWA.clone(this._fullDico);UWA.Json.path(w,"$..variabilityGroups[?(@.member=[])]");this._drivingAxisPresenter.init(w,this._privateChannel,s);this._jsonModelMap={drivingCriteria:{},constrainedCriteria:{},drivingCombinationValues:{},constrainedValues:{}};this._initDivs()};a.prototype._initDivs=function(){this._container=document.createElement("div");this._container.classList.add("build-tablerule-presenter");UWA.extendElement(this._container);this._drivingAxisPresenter.inject(this._container)};a.prototype._subscribeToEvents=function(){var r=this;this._myEventManager.subscribe(this._updateChannel,{event:"on-add-variability-btn-click"},function(s){if(s&&s.selected&&s.id=="driving"){if(r._isRHSPanelActivated==false){console.log("active right side panel");r._isRHSPanelActivated=true;r._applicationChannel.publish({event:"information-panel-hidden",data:"right"});r._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:null}});r._applicationChannel.publish({event:"triptych-show-panel",data:"right"});r._criteriaSelector.publish("buildtime-axis-change",s.id);r._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:r._criteriaSelector.container}});r._workaroundCheckAndWakeUpResizeSensor(r._criteriaSelector.container)}else{console.log("not active right side panel");r._criteriaSelector.publish("buildtime-axis-change",s.id)}r._currAxisId=s.id}else{if(r._isRHSPanelActivated){r._isRHSPanelActivated=false;r._applicationChannel.publish({event:"triptych-hide-panel",data:null})}}});this._myEventManager.subscribe(this._applicationChannel,{event:"triptych-hide-panel"},function(){if(r._isRHSPanelActivated==true){r._isRHSPanelActivated=false;r._updateChannel.publish({event:"triptych-hide-panel",data:{}})}});this._myEventManager.subscribe(this._updateChannel,{event:"triptych-hide-panel-if-opened-from-rule"},function(){if(r._isRHSPanelActivated==true){r._applicationChannel.publish({event:"triptych-hide-panel",data:null})}});this._myEventManager.subscribe(this._updateChannel,{event:"update-vcs-on-axis-content-load"},function(s){console.log("DrivingCriteriaPresenter: update-vcs-on-axis-content-load handler");var u=s.criteriaList;var t=s.axisId||undefined;r._criteriaSelector.processDicoItemsForBuildTimeVCS(s)});this._myEventManager.subscribe(this._updateChannel,{event:"update-vcs-on-axis-content-change"},function(D){try{if(D&&D.value!=undefined){var u=D.value?1:0;var B=D.axisId;var C=r._criteriaSelector.getTreeDocument().search({match:function(K){if(K.nodeModel.options.id==D.id){return true}}});if(C&&C.length>0){r._criteriaSelector.publish("dgv-prepare-update-view",{});r._criteriaSelector.getTreeDocument().prepareUpdate();var v=C[0];var E=v.hasChildren();if(E){v.setAttribute(f,(u==1?true:false));v.setAttribute(b,(u==0?undefined:B));v.getChildren().forEach(function(K){K.setAttribute(f,(u==1?true:false));K.setAttribute(b,(u==0?undefined:B))})}else{var J=v.getParent();if(J){var H=J.getNumberOfChildren();v.setAttribute(f,(u==1?true:false));v.setAttribute(b,(u==0?undefined:B));if(H===1){J.setAttribute(f,(u==1?true:false));J.setAttribute(b,(u==0?undefined:B));v.setAttribute(b,(u==0?undefined:B))}else{if(H>1){var s=false;var I=0;var A=0;var z=undefined;var w=J.getChildren();for(var F=0,G=w.length;F<G;F++){var y=w[F];var t=y.options.grid.attrDisabled;if(y&&(t==undefined||t==false)){A+=1}else{if(y&&(t==true)){z=y.options.grid.attrAxis;I+=1}}}if(u==1){v.getBrothers().forEach(function(K){K.setAttribute(b,B)})}if(I>0&&A>0){J.setAttribute(f,false);J.setAttribute(b,z);v.setAttribute(b,z)}if(I==0&&A==H){J.setAttribute(f,false);J.setAttribute(b,undefined);v.setAttribute(b,undefined)}if(A==0&&I>0){J.setAttribute(f,true);J.setAttribute(b,z);v.setAttribute(b,z)}}}}}r._criteriaSelector.getTreeDocument().pushUpdate();r._criteriaSelector.publish("dgv-push-update-view",{})}}}catch(x){console.log("[DrivingCriteriaPresenter:update-vcs-on-axis-content-change Handler] Exception Occured: "+x)}});this._privateChannel.subscribe({event:"axis-add-criteria"},function(w){console.log("added criteria: "+w);r._privateChannel.publish({event:"mr-model-change",data:""});if(w.id=="driving"){var A={};var z={};r.jsonModel.drivingCriteria.forEach(function(D){if(UWA.is(D.selectedValues,"array")){var C=[];D.selectedValues.forEach(function(E){if(E.variantValue){C.push(E.variantValue)}});A[D.id]=C;var B=[];D.rejectedValues.forEach(function(E){if(E.criteriaValidity){if(E.criteriaValidity=="yes"){B.push(true)}else{if(E.criteriaValidity=="no"){B.push(false)}}}})}z[D.id]=B});for(var u in w.criteria){if(w.criteria.hasOwnProperty(u)){if(UWA.is(w.criteria[u],"array")){var v=[];var y=z[u]||[true,false];w.criteria[u].forEach(function(B){if(B.variantValue){if(v.indexOf(B.variantValue)==-1){v.push(B.variantValue)}}if(B.criteriaValidity){if(B.criteriaValidity=="yes"){var C=y.indexOf(true);if(C!=-1){y.splice(C,1)}}else{if(B.criteriaValidity=="no"){var C=y.indexOf(false);if(C!=-1){y.splice(C,1)}}}}});if(A[u]){v.forEach(function(B){if(A[u].indexOf(B)==-1){A[u].push(B)}})}else{A[u]=v}z[u]=y}}}var t=[];var x=0;for(var u in A){if(A.hasOwnProperty(u)){t.push(u);t=t.concat(A[u]);x++}}r._privateChannel.publish({event:"switch-view-allow",data:false});r.computeCombinations(t,x,z).then(function(C){console.log("combinations : ",C);console.log(z);var B=C.length;r._privateChannel.publish({event:"new-axis-nb",data:{id:"driving",count:B}});if(B>600){r._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:p.ERROR_MAX_DRIVING_COMBINATIONS}});r._privateChannel.publish({event:"mr-rule-save-allow",data:{allow:false,message:p.SAVE_ERROR_MAX_DRIVING_COMBINATIONS}});r._isRequiredRefresh=false}else{r._matrixRuleModel.updateDrivingCombinationValues(C);r._isRequiredRefresh=true}r._matrixRuleModel.addDrivingCriteria(w.criteria);r._matrixRuleModel.reOrderDrivingCriteria();r._privateChannel.publish({event:"switch-view-allow",data:true})},function(){console.log(p.ERROR_COMPUTING_COMBINATIONS);r._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:p.ERROR_COMPUTING_COMBINATIONS}});r._privateChannel.publish({event:"switch-view-allow",data:true})})}else{if(w.id=="constrained"){r._drivingAxisPresenter.mask();var s=r.getCriteriaValues(w.criteria);r._matrixRuleModel.addConstrainedValues(s);r._matrixRuleModel.addConstrainedCriteria(w.criteria);r._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:r._matrixRuleModel.getJsonModel().constrainedValues.length}});r._isRequiredRefresh=true;r._drivingAxisPresenter.unmask()}}console.log()});this._privateChannel.subscribe({event:"axis-remove-criteria"},function(w){console.log("removed criteria: "+w);r._privateChannel.publish({event:"mr-model-change",data:""});if(w.id=="driving"){var s={};var y={};r.jsonModel.drivingCriteria.forEach(function(F){var C=[];if(UWA.is(F.selectedValues,"array")){var E=[];var D=false;for(var B=0;B<F.selectedValues.length;B++){if(w.criteria[F.id]){var A=true;for(var z=0;z<w.criteria[F.id].length;z++){w.criteria[F.id][z];if(w.criteria[F.id][z].variantValue){if(w.criteria[F.id][z].variantValue==F.selectedValues[B].variantValue){A=false;break}}else{if(w.criteria[F.id][z].criteriaValidity){if(F.selectedValues[B].hasOwnProperty("criteriaValidity")){if(w.criteria[F.id][z].criteriaValidity==F.selectedValues[B].criteriaValidity){A=false;if(w.criteria[F.id][z].criteriaValidity=="yes"){C.push(true)}else{if(w.criteria[F.id][z].criteriaValidity=="no"){C.push(false)}}break}else{D=true}}}}}if(A){if(F.selectedValues[B].variantValue){if(E.indexOf(F.selectedValues[B].variantValue)==-1){E.push(F.selectedValues[B].variantValue)}}}}else{if(F.selectedValues[B].variantValue){if(E.indexOf(F.selectedValues[B].variantValue)==-1){E.push(F.selectedValues[B].variantValue)}}if(F.selectedValues[B].hasOwnProperty("criteriaValidity")){D=true}}}if(D||E.length>0){s[F.id]=E}else{delete s[F.id]}}if(UWA.is(F.rejectedValues,"array")){F.rejectedValues.forEach(function(G){if(G.criteriaValidity){if(G.criteriaValidity=="yes"){if(C.indexOf(true)==-1){C.push(true)}}else{if(G.criteriaValidity=="no"){if(C.indexOf(false)==-1){C.push(false)}}}}})}y[F.id]=C});var u=[];var t=0;for(var x in s){if(s.hasOwnProperty(x)){u.push(x);u=u.concat(s[x]);t++}}r._privateChannel.publish({event:"switch-view-allow",data:false});r.computeCombinations(u,t,y).then(function(A){console.log("combinations : ",A);var z=A.length;r._privateChannel.publish({event:"new-axis-nb",data:{id:"driving",count:z}});if(z>600){r._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:p.ERROR_MAX_DRIVING_COMBINATIONS}});r._privateChannel.publish({event:"mr-rule-save-allow",data:{allow:false,message:p.SAVE_ERROR_MAX_DRIVING_COMBINATIONS}});r._isRequiredRefresh=false}else{r._matrixRuleModel.updateDrivingCombinationValues(A);r._isRequiredRefresh=true}r._matrixRuleModel.removeDrivingCriteria(w.criteria);r._matrixRuleModel.reOrderDrivingCriteria();r._privateChannel.publish({event:"switch-view-allow",data:true})},function(){console.log(p.ERROR_COMPUTING_COMBINATIONS);r._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:p.ERROR_COMPUTING_COMBINATIONS}});r._privateChannel.publish({event:"switch-view-allow",data:true})})}else{if(w.id=="constrained"){r._drivingAxisPresenter.mask();r._matrixRuleModel.removeConstrainedCriteria(w.criteria);var v=r.getCriteriaValues(w.criteria);r._matrixRuleModel.removeConstrainedValues(v);r._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:r._matrixRuleModel.getJsonModel().constrainedValues.length}});r._isRequiredRefresh=true;r._drivingAxisPresenter.unmask()}}console.log()});this._model.addEvent("onChange:drivingCriteria",function(){console.log("driving Criteria changing")});this._model.addEvent("onChange:constrainedCriteria",function(){console.log("constrained Criteria changing")});this._privateChannel.subscribe({event:"mr-init-finished"},function(){var s=r.createDicoFromModel("constrained");var t=r.createDicoFromModel("driving");r._drivingAxisPresenter.setDico(t);r._privateChannel.publish({event:"new-axis-nb",data:{id:"driving",count:r._model.get("drivingCriteria").length}});r._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:r._model.get("constrainedCriteria").length}});r._privateChannel.publish({event:"new-axis-nb",data:{id:"driving",count:18}});r._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:5}})});this._privateChannel.subscribe({event:"switched-view"},function(s){if(s==="run"){if(r._isRequiredRefresh){r._privateChannel.publish({event:"mr-refresh-run-view"});r._isRequiredRefresh=false}if(r._isRHSPanelActivated==true){r._applicationChannel.publish({event:"triptych-hide-panel",data:null})}}else{if(s==="build"){r.jsonModel=r._matrixRuleModel.getJsonModel()}}})};a.prototype.getCriteriaValues=function(w){var u={};for(var v in w){if(w.hasOwnProperty(v)){var r=[];for(var s=0;s<w[v].length;s++){var t=UWA.clone(w[v][s]);if(t.variantValue){t.id=t.variantValue;t.parent=v}else{t.id=v;t.parent=null}r.push(t)}u[v]=r}}return u};a.prototype.inject=function(r){r.appendChild(this._container)};a.prototype.updateModel=function(s,r){var t=r.criteria;switch(s){case"driving":this.jsonModel.drivingCriteria=t;this.jsonModel.drivingCombinationValues=r.combinations;break;case"constrained":this.jsonModel.constrainedCriteria=t;this.jsonModel.constrainedValues=r.values;break;default:break}};a.prototype._initVCS=function(){var r=this;this._criteriaSelector.subscribe("onAddAction",function(s){if(s.nodeModel!=undefined&&s.axisId=="driving"){console.log("DrivingCriteriaPresenter: onAddAction!!!");var w=s.nodeModel;var t={id:w.options.id,name:"_include",value:true,axisId:s.axisId?s.axisId:undefined};var v=t;var u="";switch(w.options.criteriaType){case"Variants":u="variant";break;case"Values":u="value";break;case"VariabilityGroups":u="variabilityGroup";break;case"Options":u="option";break}UWA.merge(v,{changedObject:w.options.dictionaryItem,type:u});r._drivingAxisPresenter.onChangeAttributeHandler(v)}})};a.prototype.createDicoFromModel=function(t){var s=0,r=[];if(t==="driving"){for(s=0;s<this._model.get("drivingCriteria").length;s+=1){r.push(this._model.get("drivingCriteria")[s])}}else{if(t==="constrained"){for(s=0;s<this._model.get("constrainedCriteria").length;s+=1){r.push(this._model.get("constrainedCriteria")[s])}}}return r};a.prototype.addCriteriaInDico=function(r,s){};a.prototype.computeCombinations=function(s,r,v){var u=[];var t=this;return new UWA.Promise(function(y,x){if(s.length>0){var w={_from:"test",_to:"solverConfiguration",_request:"computeSolutions",_data:{getCombinations:true,includeInvalidCriteria:true,combinationsIds:s,maxCombinations:10000}};if(t._solverKey){o.computeAnswer(w,t._solverKey).then(function(z){console.log("success",z);var z=JSON.parse(z);if(z){if(z._rc=="OK"){var A=z._data.combinations;if(UWA.is(A,"array")){A.forEach(function(D){var B=true;if(v){for(var C=0;C<D.length;C++){var E=D[C].id;if(v[E]){if(v[E].indexOf(D[C].validity)!=-1){B=false;break}}}}if(B){if(r){if(D.length==r){u.push(D)}}else{u.push(D)}}})}}else{x()}}y(u)})}}else{y(u)}})};a.prototype.formatCriteria=function(s){var r=[];if(s){s.forEach(function(t){var u={attributes:{}};if(t.type=="variant"){u.lid=t.id}else{if(t.type=="option"){u.rel_lid=t.id}}if(t.selectedValues){t.selectedValues.forEach(function(v){if(v.variantValue){r.push({rel_lid:v.variantValue,attributes:{_include:1}})}else{if(v.criteriaValidity){if(v.criteriaValidity=="yes"){u.attributes._include=1}else{if(v.criteriaValidity=="no"){u.attributes._includeNot=true}}}}})}if(t.rejectedValues){t.rejectedValues.forEach(function(v){if(v.variantValue){r.push({rel_lid:v.variantValue,attributes:{_include:0}})}else{if(v.criteriaValidity){if(v.criteriaValidity=="yes"){u.attributes._include=0}else{if(v.criteriaValidity=="no"){u.attributes._includeNot=false}}}}})}if(Object.keys(u.attributes).length>0){r.push(u)}})}return r};a.prototype.refreshUI=function(){this.jsonModel=this._matrixRuleModel.getJsonModel();var r=this.formatCriteria(this.jsonModel.drivingCriteria);this._drivingAxisPresenter.refreshUI({criteria:r});this._isRequiredRefresh=false;this._privateChannel.publish({event:"new-axis-nb",data:{id:"driving",count:this.jsonModel.drivingCombinationValues.length}})};a.prototype.destroy=function(){if(this._drivingAxisPresenter){this._drivingAxisPresenter.destroy()}this._myEventManager.cleanup("DrivingCriteriaPresenter")};return a});define("DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenter",["DS/Controls/ComboBox","UWA/Class/View","DS/ENOXSplitViewVertical/js/ENOXSplitViewVertical","DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenterStaticContent","DS/UIKIT/DropdownMenu","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/TreeModel/TreeDocument","DS/Controls/Popup","DS/CfgRuleMatrixComponent/Model/MatrixRuleModel","DS/CfgSolver/CfgSolverServices","DS/Tweakers/TweakerString","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridView","DS/Windows/ImmersiveFrame","DS/Windows/Panel","DS/UIKIT/Mask","DS/xModelEventManager/xModelEventManager","i18n!DS/CfgRuleMatrixComponent/assets/nls/MatruiTablePresenter","css!DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenter.css"],function(j,x,o,a,t,i,r,p,A,f,h,l,z,u,s,m,B,c,w,e){var y=110;var q=60;var n=50;var d=400;var v={};var g={S:"check",A:"",N:"block",D:"favorite-on",U:"question-circle",X:"block"};var b={S:w.Selected,A:w.Available,N:w.NA,D:w.Default,U:w.Undefined};var k=function(){};k.prototype.init=function(C,F,D){var E=this;this._matrixModel=C;this._mapDico=this._matrixModel._mapDico;this._jsonModel=this._matrixModel.getJsonModel();this._solverKey=D.solverKey;this._solverModelEvent=D.solverModelEvent;this._rightColumnsWidth=[];this._options=D||{};this._privateChannel=F;this._editable=D.editable;this._painterEnabled=undefined;this._myEventManager=new c(this._privateChannel,this._solverModelEvent);if(!this._container){this._container=document.createElement("div");this._container.classList.add("matrui-table-presenter")}this._subscribeToEvent();this._initTreeModel();if(this._jsonModel.states&&this._jsonModel.states.length>0){if(this._container){B.mask(UWA.extendElement(this._container))}this._callSolverToCompute()}};k.prototype._subscribeToEvent=function(){var C=this;this._myEventManager.subscribe(this._solverModelEvent,{event:"mr-reload-table"},function(D){C._container.innerHTML="";C._buildTable()});this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-action-activated"},function(D){console.log("Event : enox-collection-toolbar-action-activated from MatruiTablePresenter");C._actionToolBar(D);if(C._container&&C._previousPainterEnabled!==C._painterEnabled){C._dataGridView.invalidateLayout({updateCellContent:true});C._previousPainterEnabled=C._painterEnabled}})};k.prototype._actionToolBar=function(C){switch(C){case"painter-not-available":this._painterState=b.N;this._selectedPainter("brush-block");this._painterEnabled=true;break;case"painter-available":this._painterState=b.A;this._selectedPainter("brush");this._painterEnabled=true;break;case"painter-default":this._painterState=b.D;this._selectedPainter("brush-favorite");this._painterEnabled=true;break;case"painter-selected":this._painterState=b.S;this._selectedPainter("brush-ok");this._painterEnabled=true;break;case"painter-none":this._painterState=b.A;this._painterEnabled=false;break;case"large":this._setColumnWidth(600);break;case"medium":this._setColumnWidth(400);break;case"small":this._setColumnWidth(200);break;default:this._painterState=b.A;this._painterEnabled=false}};k.prototype._setColumnWidth=function(D){for(var C=0;C<this._dataGridView.columns.length;C++){this._dataGridView.layout.setColumnWidth(C,D)}};k.prototype._buildTable=function(){console.log("building runtime table...");this._resizableTableModel=this._createResizableModel();if(this._resizableTableModel.columns&&this._resizableTableModel.columns.length>0){this._initTreeModel();this._insertDataNodes();this._fillBotRightTable();this._initDivs();if(this._dataGridView&&this._dataGridView.treeDocument){this._dataGridView.treeDocument.expandAll()}}};k.prototype._createResizableModel=function(){var C={lines:[],columns:[],title_columns:[]};var C={lines:[],columns:[],title_columns:[]};this._jsonModel=this._matrixModel.getJsonModel();this._mapDico=this._matrixModel._mapDico;var J=this._jsonModel.drivingCombinationValues[0];for(F in J){var G=this._mapDico[F];var H={};H.id=F;H.value=G.name;C.title_columns.push(H)}for(var F=0;F<this._jsonModel.drivingCombinationValues.length;F+=1){var I=[];for(var E in this._jsonModel.drivingCombinationValues[F]){var G=this._mapDico[this._jsonModel.drivingCombinationValues[F][E].variantValue];I.push(G?G.name:(this._jsonModel.drivingCombinationValues[F][E].criteriaValidity==="yes"?this._mapDico[E].name:"not "+this._mapDico[E].name))}C.columns.push(I)}for(F=0;F<this._jsonModel.constrainedValues.length;F+=1){var D={};D.id=this._jsonModel.constrainedValues[F].id;var G=this._mapDico[D.id];D.variantValue=G.name;D.type=G.type;D.idparent=G.parent;if(D.idparent){D.value=this._mapDico[D.idparent].name}else{D.value=G.name}C.lines.push(D)}return C};k.prototype._initDivs=function(){if(!this._container){this._container=document.createElement("div");this._container.classList.add("matrui-table-presenter")}this._dataGridView.inject(this._container)};k.prototype.inject=function(C){C.appendChild(this._container)};k.prototype.destroy=function(){this._container="";if(this._myEventManager){this._myEventManager.cleanup("MatruiTablePresenter");this._myEventManager=null}};k.prototype._initTreeModel=function(){var G=this._jsonModel.drivingCombinationValues?this._jsonModel.drivingCombinationValues.length:0;var D=this._jsonModel.constrainedValues?this._jsonModel.constrainedValues.length:0;this.allData=[];for(var E=0;E<D;E++){var F={};for(var C=0;C<G;C++){F["col"+C]={state:this._jsonModel.states[C][E],stateValidity:this._jsonModel.statesValidity[C][E]||"V",flatIndexRowID:E,}}this.allData.push(F)}};k.prototype._insertDataNodes=function(){this._dataModelSet=new z();this._treeDocumentModel=new p({useAsyncPreExpand:true,dataModelSet:this._dataModelSet});this._treeDocumentModel.prepareUpdate();for(var H=0;H<this._jsonModel.constrainedCriteria.length;H++){var G=[],F={};if(this._jsonModel.constrainedCriteria[H].type==="variant"){var I=r.createTreeNodeDataModel(this._dataModelSet,{label:this._mapDico[this._jsonModel.constrainedCriteria[H].id].name,grid:{},});this._treeDocumentModel.addChild(I)}for(var C=0;C<this._jsonModel.constrainedValues.length;C++){var J=this._jsonModel.constrainedValues[C].id;var E={};var D=this.allData[C];this._dataModelSet.createDataModel(D);if(this._jsonModel.constrainedCriteria[H].id===this._jsonModel.constrainedValues[C].parent){I.addChild({label:this._mapDico[J].name,grid:this.allData[C]})}if(this._jsonModel.constrainedCriteria[H].id===this._jsonModel.constrainedValues[C].id){this._treeDocumentModel.addChild({label:this._mapDico[J].name,grid:this.allData[C]})}}}this._treeDocumentModel.pushUpdate()};k.prototype._applyCustomHeader=function(){var I=this;var J=I._dataGridView.elements.headerPoolContainer.children||[];for(var H=0;H<J.length;H++){var G=I._resizableTableModel.columns[H];var D=UWA.createElement("div",{"class":"mr_dc_header"});for(var F=0;F<G.length;F++){UWA.createElement("p",{"class":"mr_dc_header_combi",text:G[F]}).inject(D)}J[H].setContent(D.outerHTML)}var J=I._dataGridView.elements.leftHeaderPoolContainer.children||[];var G=I._resizableTableModel.title_columns;var C=UWA.createElement("div",{"class":"newheader"});var E=UWA.createElement("p",{"class":"newheader1",text:w.ConstrainedCriteria}).inject(C);var D=UWA.createElement("div",{"class":"mr_cc_header"}).inject(C);for(var F=0;F<G.length;F++){UWA.createElement("p",{"class":"mr_cc_header_combi",text:G[F].value}).inject(D)}J[0].setContent(C.outerHTML)};k.prototype._updateCellView=function(H){var E=this,G,F,D,C;if(H.cellModel){F=H.cellModel.state;D=H.cellModel.stateValidity}if(F==="A"){switch(D){case"U":case"R":case"E":C=a.generateMRAvailableRequired();break;case"A":case"T":case"I":C=a.generateMRAvailableIncompatible();break;case"C":C=a.generateMRAvailableConflict();break;default:C=a.generateMRAvailable();break}}else{if(F==="N"){switch(D){case"C":case"U":case"R":case"E":C=a.generateMRNotAvailableConflict();break;case"A":case"T":case"I":C=a.generateMRNotAvailableIncompatible();break;default:C=a.generateMRNotAvailable();break}}else{if(F==="S"){switch(D){case"C":case"A":case"T":case"I":C=a.generateMRStandardConflict();break;case"U":case"R":case"E":C=a.generateMRStandardRequired();break;default:C=a.generateMRStandard();break}}else{if(F==="D"){switch(D){case"U":case"R":case"E":C=a.generateMRDefaultRequired();break;case"C":case"A":case"T":case"I":C=a.generateMRDefaultIncompatible();break;default:C=a.generateMRDefault();break}}else{C=a.generateMRAvailable()}}}}return C};k.prototype._updateTooltip=function(F,C){var D=this;var E="c"+(C.columnID-1)+"r"+C.rowID;if(v[E]&&v[E].elements){v[E]={}}v[E]=new A({target:F,trigger:"click",constraint:this._dataGridView.elements.container});F.onclick=function(K){if(this.columnID>=0&&this.rowID>=0){var I=document.querySelectorAll(".wux-controls-popup");v[E].setBody(w.Loading);if(I&&I[0]){I[0].setContent(w.Loading)}var G=D._matrixModel.getMiniJsonModel(this.columnID-1);G._clientData.rowID=this.cellModel.flatIndexRowID;G._clientData.treeRowID=this.rowID;var H="";if(G.states[0]){for(var J=0;J<G.states[0].length;J++){H+=(J===this.cellModel.flatIndexRowID)?"Y":"N"}}G.statesCauses=[H];D._callSolverToCompute(G)}}.bind(C)};k.prototype.setTooltip=function(G,E){var I=w.ReasonString;var C=G.states+G.statesValidity;switch(C){case"SA":case"ST":case"SI":case"DI":case"DT":case"DA":case"NE":case"NR":case"NU":I+=w.stateValidity_C_Rule;break;case"AC":case"SC":case"DC":case"NC":I+=w.stateValidity_C;break;case"DU":case"SU":case"AU":I+=w.stateValidity_U;break;case"DR":case"DE":case"AR":case"AE":case"SR":case"SE":I+=w.stateValidity_RE;break;case"NA":case"NT":case"NI":case"AA":case"AT":case"AI":I+=w.stateValidity_ATI;break;default:break}if(G.statesCausingRules.length>0||G.statesCausingValues.length>0){I+=w.due_to}if(G.statesCausingValues.length>0&&G.statesCausingRules.length===0){I+=w.current_Selection;for(var F=0;F<G.statesCausingValues.length;F++){if(F>0){I=I+", "}var D=this._mapDico[G.statesCausingValues[F]]?this._mapDico[G.statesCausingValues[F]].name:G.statesCausingValues[F];I=I+" "+D}}if(G.statesCausingRules.length>0){I+=w.ImpliedRulesString;for(var F=0;F<G.statesCausingRules.length;F++){if(F>0){I=I+", "}var D=this._mapDico[G.statesCausingRules[F]]?this._mapDico[G.statesCausingRules[F]].name:G.statesCausingRules[F];I=I+" "+D}}var H="c"+E.columnID+"r"+E.treeRowID;if(v[H]){v[H].setBody(I);v[H].getContent().addClassName("mr-custom-popup")}B.unmask(UWA.extendElement(this._container))};k.prototype._fillBotRightTable=function(){var F=this;var D=i.SETTINGS.STANDARD;D.treeDocument=this._treeDocumentModel;D.selectionMode="cell";D.defaultColumnDef={minWidth:40,editableFlag:true,resizableFlag:true,sortableFlag:false,allowUnsafeHTMLContent:false};var C=this._jsonModel.drivingCombinationValues?this._jsonModel.drivingCombinationValues.length:0;for(var E=0;E<C;E+=1){D.columns.push({text:this._resizableTableModel.columns[E],dataIndex:"col"+E,typeRepresentation:"dropdownSelection",editionPolicy:"none",setCellValue:function(N,M){var J=N.columnID-1;var L=N.nodeModel._options.grid["col"+J].flatIndexRowID;var K;switch(M){case b.S:K="S";break;case b.D:K="D";break;case b.N:K="N";break;case b.A:K="A";break;default:}F._matrixModel.setStateWithID(J,L,K);if(K==="S"||K==="D"){for(var I=0;I<F._jsonModel.constrainedValues.length;I+=1){if(I!==L){if(F._jsonModel.constrainedValues[I].parent&&(F._jsonModel.constrainedValues[I].parent===F._jsonModel.constrainedValues[L].parent)){if(F._matrixModel.__jsonModel.states[J][I]==="S"||F._matrixModel.__jsonModel.states[J][I]==="D"){F._matrixModel.setStateWithID(J,I,"A")}}}}}F._matrixModel.setTimerIDForColumnID(J);var H=F._matrixModel.getMiniJsonModel(J);H.check="runtime";B.mask(UWA.extendElement(F._container));F._callSolverToCompute(H);F._privateChannel.publish({event:"mr-model-change",data:""})},onCellRequest:function(L){F._dataGridView.prepareUpdateView();var H=L.columnID-1;if(L.nodeModel&&L.nodeModel._options.grid["col"+H]){var K=L.nodeModel._options.grid["col"+H].flatIndexRowID;L.cellModel.state=F._jsonModel.states[H][K];L.cellModel.stateValidity=F._jsonModel.statesValidity[H][K];if(F._painterEnabled){L.cellView.elements.container.addClassName("displayBlock")}else{L.cellView.elements.container.removeClassName("displayBlock")}var J,I;switch(L.cellModel.state){case"S":J=b.S;break;case"D":J=b.D;break;case"N":J=b.N;break;case"A":J=b.A;break;default:}I=F._painterEnabled?"functionIcon":"dropdownSelection";F._dataGridView.getTypeRepresentationFactory().generateView(J,{typePath:I,readOnly:false,touchMode:true,escapeHTML:true,context:"stdTemplate",semantics:{allowUnsafeHTMLContent:true},onViewCreated:function(N){var M=F._updateCellView(L);if(!F._painterEnabled){if(N.elements.internalView&&N.elements.internalView.elements){N.elements.internalView.elements.expander.style.display="none";N.elements.internalView.elements.mainElement.style.backgroundColor="transparent";N.elements.internalView.elements.mainElement.style.marginLeft="19px";N.elements.internalView.elements.mainElement.setContent(M);L.cellView._setReusableContent(N)}}else{if(N.elements.container){N.elements.container.setContent(M);N.elements.container.style.backgroundColor="transparent"}L.cellView._setReusableContent(M)}var O=L.cellView.elements.container.querySelector(".mr-combi-details");if(O){F._updateTooltip(O,L)}}})}else{F._dataGridView.getTypeRepresentationFactory().generateView(" ",{typePath:"string",readOnly:true,touchMode:true,escapeHTML:true,context:"stdTemplate",semantics:{allowUnsafeHTMLContent:true},onViewCreated:function(M){L.cellView._setReusableContent(M)}})}F._dataGridView.pushUpdateView()}})}this._dataGridView=new u(D);this._dataGridView.columnDragEnabledFlag=false;this._dataGridView.columns[0].text="ConstrainedCriteria";this._dataGridView.columns[0].pinned="left";this._dataGridView.columns[0].sortableFlag=true;this._dataGridView.columns[0].editableFlag=false;this._dataGridView.showRowBorderFlag=true;this._dataGridView.layout.rowsHeader=false;this._dataGridView.layout.cellHeight=36;this._dataGridView.layout.columnHeaderHeight=this._resizableTableModel.columns[0].length*26;this._dataGridView.onContextualEvent=function(){};this._dataGridView._onClick=function(H,I){if(F._painterEnabled){if(I&&I.cellModel&&I.columnID>0&&I.rowID>=0&&I.nodeModel&&I.nodeModel._options.grid["col"+(I.columnID-1)]){F._dataGridView.setModelAt(I.cellID,F._painterState)}}};this._dataGridView.layout.postRender=function(){F._applyCustomHeader();var H=F._dataGridView.layout._getEstimatedVirtualHeight()+F._dataGridView.layout.getHeaderContainerHeight()+20;if(H<F._container.offsetHeight){F._dataGridView.height=H}else{F._dataGridView.height=F._container.offsetHeight-20}};var G={dropdownSelection:{stdTemplate:"comboSelector",semantics:{possibleValues:[{value:b.S,label:" ",icon:{iconName:g.S,fontIconFamily:1},},{value:b.D,label:" ",icon:{iconName:g.D,fontIconFamily:1},},{value:b.N,label:" ",icon:{iconName:g.N,fontIconFamily:1},},{value:b.A,label:" ",icon:{iconName:" ",fontIconFamily:1},}]}}};this._dataGridView.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(G))};k.prototype._selectedPainter=function(D){var E=document.querySelector("#painter");var C=E.getChildren()[0];C.removeAttribute("class");C.setAttribute("class","fonticon fonticon-"+D+" painter-selected")};k.prototype._callSolverToCompute=function(D){var C=D?D:this._matrixModel.getJsonModel();h.callSolveForRules(C,this._solverKey,this._solverModelEvent)};k.prototype.update=function(C){var E=this;var D=UWA.is(C.columnID,"number")&&C.columnID>=0?C.columnID+1:0;if(D&&this._dataGridView&&E._dataGridView.treeDocument){this._dataGridView.prepareUpdateView();var C=E._dataGridView.layout.getDataIndexFromColumnIndex(D);E._dataGridView.treeDocument.processDescendants({processNode:function(H){if(H.nodeModel._options.grid[C]){var F=H.nodeModel._options.grid[C].flatIndexRowID;var G="col"+D;if(!H.nodeModel._rowID&&H.nodeModel._rowID!==0){H.nodeModel._rowID=1}H.nodeModel.updateOptions({grid:{keyname:{state:E._jsonModel.states[F],stateValidity:E._jsonModel.statesValidity[F],flatIndexRowID:F}}})}if(E._container){B.unmask(UWA.extendElement(E._container))}}});this._dataGridView.pushUpdateView()}else{this._container.innerHTML="";this._buildTable();if(E._container){B.unmask(UWA.extendElement(E._container))}}};k.prototype.refresh=function(){this._container.innerHTML="";this._mapDico=this._matrixModel._mapDico;this._jsonModel=this._matrixModel.getJsonModel();if(this._jsonModel.states&&this._jsonModel.states.length>0){if(this._container){B.mask(UWA.extendElement(this._container))}this._callSolverToCompute()}};return k});define("DS/CfgRuleMatrixComponent/Buildtime/ConstrainedCriteriaPresenter",["DS/Handlebars/Handlebars","DS/Core/ModelEvents","DS/UIKIT/Mask","UWA/Element","DS/CfgDictionary/CfgDictionaryV3Utils","DS/CfgRuleMatrixComponent/Buildtime/AxisPresenter","DS/ENOXSplitView/js/ENOXSplitView","DS/WebappsUtils/WebappsUtils","DS/CfgRuleMatrixComponent/Model/DemoModel","DS/CfgSolver/CfgSolverServices","DS/CfgVCSComponent/Presenter/DgvCfgVCSMainContainer","DS/xModelEventManager/xModelEventManager","i18n!DS/CfgRuleMatrixComponent/assets/nls/ConstrainedCriteriaPresenter","css!DS/CfgRuleMatrixComponent/Buildtime/ConstrainedCriteriaPresenter.css"],function(b,c,h,o,i,k,m,e,n,p,q,g,l,d){var f="attrDisabled";var a="attrAxis";var j=function(){};j.prototype.init=function(y,u,t,x,s,r){this._criteriaSelector=r;this._fullDico=y;this._dicoForVCS=i.getSubDictionary(y,i.WITH_REFERENCES_ONLY);this._model=new n();this._matrixRuleModel=u;this._privateChannel=x?x:new c();this._updateChannel=s&&s.updateChannel!==undefined?s.updateChannel:new c();this._applicationChannel=t;this._myEventManager=new g(this._privateChannel,this._updateChannel,this._applicationChannel);this._isReadyToSwitch=true;this._editable=s.editable===false?false:true;this._isRequiredRefresh=false;this._solverKey=s.solverKey||null;this.jsonModel=this._matrixRuleModel.getJsonModel();this._isRHSPanelActivated=false;this._workaroundCheckAndWakeUpResizeSensor=s.resizeSensorEnablerFun?s.resizeSensorEnablerFun:function(){};this._initVCS();this._subscribeToEvents();var v={updateChannel:this._updateChannel};v.axisMainTitle="Y "+l._axis;v.axisTitle=l._constrained_criteria;v.axisSubtitle=" "+l._rows;v.axisIcon=e.getWebappsAssetUrl("CfgRuleMatrixComponent","Yaxis.png");v.id="constrained";v.nbMax=1000;v.criteria=[];var w=this.formatCriteria(this.jsonModel.constrainedCriteria);v.criteria=w;v.editable=this._editable;this._constrainedAxisPresenter=new k();this._constrainedAxisPresenter.init(this._fullDico,this._privateChannel,v);this._jsonModelMap={drivingCriteria:{},constrainedCriteria:{},drivingCombinationValues:{},constrainedValues:{}};this._initDivs()};j.prototype._initDivs=function(){this._container=document.createElement("div");this._container.classList.add("build-tablerule-presenter");UWA.extendElement(this._container);this._constrainedAxisPresenter.inject(this._container)};j.prototype._subscribeToEvents=function(){var r=this;this._myEventManager.subscribe(this._updateChannel,{event:"on-add-variability-btn-click"},function(s){if(s&&s.selected&&s.id=="constrained"){if(r._isRHSPanelActivated==false){r._isRHSPanelActivated=true;r._applicationChannel.publish({event:"information-panel-hidden",data:"right"});r._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:null}});r._applicationChannel.publish({event:"triptych-show-panel",data:"right"});r._criteriaSelector.publish("buildtime-axis-change",s.id);r._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:r._criteriaSelector.container}});r._workaroundCheckAndWakeUpResizeSensor(r._criteriaSelector.container)}else{r._criteriaSelector.publish("buildtime-axis-change",s.id)}r._currAxisId=s.id}else{if(r._isRHSPanelActivated){r._isRHSPanelActivated=false;r._applicationChannel.publish({event:"triptych-hide-panel",data:null})}}});this._myEventManager.subscribe(this._applicationChannel,{event:"triptych-hide-panel"},function(){if(r._isRHSPanelActivated==true){r._isRHSPanelActivated=false;r._updateChannel.publish({event:"triptych-hide-panel",data:{}})}});this._myEventManager.subscribe(this._updateChannel,{event:"triptych-hide-panel-if-opened-from-rule"},function(){if(r._isRHSPanelActivated==true){r._applicationChannel.publish({event:"triptych-hide-panel",data:null})}});this._myEventManager.subscribe(this._updateChannel,{event:"update-vcs-on-axis-content-load"},function(s){console.log("ConstrainedCriteriaPresenter: update-vcs-on-axis-content-load handler");var u=s.criteriaList;var t=s.axisId||undefined;r._criteriaSelector.processDicoItemsForBuildTimeVCS(s)});this._myEventManager.subscribe(this._updateChannel,{event:"update-vcs-on-axis-content-change"},function(D){try{if(D&&D.value!=undefined){var u=D.value?1:0;var B=D.axisId;var C=r._criteriaSelector.getTreeDocument().search({match:function(K){if(K.nodeModel.options.id==D.id){return true}}});if(C&&C.length>0){r._criteriaSelector.publish("dgv-prepare-update-view",{});r._criteriaSelector.getTreeDocument().prepareUpdate();var v=C[0];var E=v.hasChildren();if(E){v.setAttribute(f,(u==1?true:false));v.setAttribute(a,(u==0?undefined:B));v.getChildren().forEach(function(K){K.setAttribute(f,(u==1?true:false));K.setAttribute(a,(u==0?undefined:B))})}else{var J=v.getParent();if(J){var H=J.getNumberOfChildren();v.setAttribute(f,(u==1?true:false));v.setAttribute(a,(u==0?undefined:B));if(H===1){J.setAttribute(f,(u==1?true:false));J.setAttribute(a,(u==0?undefined:B));v.setAttribute(a,(u==0?undefined:B))}else{if(H>1){var s=false;var I=0;var A=0;var z=undefined;var w=J.getChildren();for(var F=0,G=w.length;F<G;F++){var y=w[F];var t=y.options.grid.attrDisabled;if(y&&(t==undefined||t==false)){A+=1}else{if(y&&(t==true)){z=y.options.grid.attrAxis;I+=1}}}if(u==1){v.getBrothers().forEach(function(K){K.setAttribute(a,B)})}if(I>0&&A>0){J.setAttribute(f,false);J.setAttribute(a,z);v.setAttribute(a,z)}if(I==0&&A==H){J.setAttribute(f,false);J.setAttribute(a,undefined);v.setAttribute(a,undefined)}if(A==0&&I>0){J.setAttribute(f,true);J.setAttribute(a,z);v.setAttribute(a,z)}}}}}r._criteriaSelector.getTreeDocument().pushUpdate();r._criteriaSelector.publish("dgv-push-update-view",{})}}}catch(x){console.log("[ConstrainedCriteriaPresenter:update-vcs-on-axis-content-change Handler] Exception Occured: "+x)}});this._privateChannel.subscribe({event:"axis-add-criteria"},function(t){console.log("added criteria: "+t);r._privateChannel.publish({event:"mr-model-change",data:""});if(t.id=="constrained"){var s=r.getCriteriaValues(t.criteria);r._matrixRuleModel.addConstrainedValues(s);r._matrixRuleModel.addConstrainedCriteria(t.criteria);r._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:r._matrixRuleModel.getJsonModel().constrainedValues.length}});r._isRequiredRefresh=true}console.log()});this._privateChannel.subscribe({event:"axis-remove-criteria"},function(t){console.log("removed criteria: "+t);r._privateChannel.publish({event:"mr-model-change",data:""});if(t.id=="constrained"){r._matrixRuleModel.removeConstrainedCriteria(t.criteria);var s=r.getCriteriaValues(t.criteria);r._matrixRuleModel.removeConstrainedValues(s);r._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:r._matrixRuleModel.getJsonModel().constrainedValues.length}});r._isRequiredRefresh=true}console.log()});this._model.addEvent("onChange:constrainedCriteria",function(){console.log("constrained Criteria changing")});this._privateChannel.subscribe({event:"mr-init-finished"},function(){var s=r.createDicoFromModel("constrained");r._constrainedAxisPresenter.setDico(s);r._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:r._model.get("constrainedCriteria").length}});r._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:5}})});this._privateChannel.subscribe({event:"switched-view"},function(s){if(s==="run"){}else{if(s==="build"){r.jsonModel=r._matrixRuleModel.getJsonModel()}}})};j.prototype.getCriteriaValues=function(w){var u={};for(var v in w){if(w.hasOwnProperty(v)){var r=[];for(var s=0;s<w[v].length;s++){var t=UWA.clone(w[v][s]);if(t.variantValue){t.id=t.variantValue;t.parent=v}else{t.id=v;t.parent=null}r.push(t)}u[v]=r}}return u};j.prototype.inject=function(r){r.appendChild(this._container)};j.prototype.updateModel=function(s,r){var t=r.criteria;switch(s){case"constrained":this.jsonModel.constrainedCriteria=t;this.jsonModel.constrainedValues=r.values;break;default:break}};j.prototype._initVCS=function(){var r=this;this._criteriaSelector.subscribe("onAddAction",function(s){if(s.nodeModel!=undefined&&s.axisId=="constrained"){console.log("ConstrainedCriteriaPresenter: onAddAction!!!");var w=s.nodeModel;var t={id:w.options.id,name:"_include",value:true,axisId:s.axisId?s.axisId:undefined};var v=t;var u="";switch(w.options.criteriaType){case"Variants":u="variant";break;case"Values":u="value";break;case"VariabilityGroups":u="variabilityGroup";break;case"Options":u="option";break}UWA.merge(v,{changedObject:w.options.dictionaryItem,type:u});r._constrainedAxisPresenter.onChangeAttributeHandler(v)}})};j.prototype.createDicoFromModel=function(t){var s=0,r=[];if(t==="constrained"){for(s=0;s<this._model.get("constrainedCriteria").length;s+=1){r.push(this._model.get("constrainedCriteria")[s])}}return r};j.prototype.addCriteriaInDico=function(r,s){};j.prototype.computeCombinations=function(s,r,v){var u=[];var t=this;return new UWA.Promise(function(y,x){if(s.length>0){var w={_from:"test",_to:"solverConfiguration",_request:"computeSolutions",_data:{getCombinations:true,includeInvalidCriteria:true,combinationsIds:s,maxCombinations:10000}};if(t._solverKey){p.computeAnswer(w,t._solverKey).then(function(z){console.log("success",z);var z=JSON.parse(z);if(z){if(z._rc=="OK"){var A=z._data.combinations;if(UWA.is(A,"array")){A.forEach(function(D){var B=true;if(v){for(var C=0;C<D.length;C++){var E=D[C].id;if(v[E]){if(v[E].indexOf(D[C].validity)!=-1){B=false;break}}}}if(B){if(r){if(D.length==r){u.push(D)}}else{u.push(D)}}})}}else{x()}}y(u)})}}else{y(u)}})};j.prototype.formatCriteria=function(s){var r=[];if(s){s.forEach(function(t){var u={attributes:{}};if(t.type=="variant"){u.lid=t.id}else{if(t.type=="option"){u.rel_lid=t.id}}if(t.selectedValues){t.selectedValues.forEach(function(v){if(v.variantValue){r.push({rel_lid:v.variantValue,attributes:{_include:1}})}else{if(v.criteriaValidity){if(v.criteriaValidity=="yes"){u.attributes._include=1}else{if(v.criteriaValidity=="no"){u.attributes._includeNot=true}}}}})}if(t.rejectedValues){t.rejectedValues.forEach(function(v){if(v.variantValue){r.push({rel_lid:v.variantValue,attributes:{_include:0}})}else{if(v.criteriaValidity){if(v.criteriaValidity=="yes"){u.attributes._include=0}else{if(v.criteriaValidity=="no"){u.attributes._includeNot=false}}}}})}if(Object.keys(u.attributes).length>0){r.push(u)}})}return r};j.prototype.refreshUI=function(){this.jsonModel=this._matrixRuleModel.getJsonModel();var r=this.formatCriteria(this.jsonModel.constrainedCriteria);this._constrainedAxisPresenter.refreshUI({criteria:r});this._isRequiredRefresh=false;this._privateChannel.publish({event:"new-axis-nb",data:{id:"constrained",count:this.jsonModel.constrainedValues.length}})};j.prototype.destroy=function(){if(this._constrainedAxisPresenter){this._constrainedAxisPresenter.destroy()}this._myEventManager.cleanup("ConstrainedCriteriaPresenter")};return j});define("DS/CfgRuleMatrixComponent/Runtime/RunTimePresenter",["DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenter","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","DS/Handlebars/Handlebars","DS/Core/ModelEvents","DS/UIKIT/Mask","UWA/Element","text!DS/CfgRuleMatrixComponent/Runtime/RunTimePresenter.html","i18n!DS/CfgRuleMatrixComponent/assets/nls/RunTimePresenter","css!DS/CfgRuleMatrixComponent/Runtime/RunTimePresenter.css"],function(e,h,b,c,d,i,a,j,f){var g=function(){};g.prototype.init=function(k,m,l){this._matrixModel=k;this._privateChannel=m?m:new c();this._options={};this._options.painter=l.painter?l.painter:false;this._solverKey=l.solverKey;this._solverModelEvent=l.solverModelEvent;this._dictionary=l.dictionary;this._editable=l.editable;this._subscribedEventTokens=[];this._subscribedEventTokensPrivate=[];this._matruiTablePresenter=new e();this._matruiTablePresenter.init(this._matrixModel,this._privateChannel,{solverKey:this._solverKey,solverModelEvent:this._solverModelEvent,dictionary:this._dictionary,editable:this._editable});this._initToolbar();this._initDivs();this._subscribeToEvents()};g.prototype._initToolbar=function(){var k={modelEvents:this._privateChannel,actions:[{id:"painter",fonticon:"brush",text:j.Painter,content:[{id:"painter-not-available",text:j.NA,fonticon:"brush-block",changeIconSelection:true},{id:"painter-available",text:j.Available,fonticon:"brush",changeIconSelection:true},{id:"painter-default",text:j.Default,fonticon:"brush-favorite",changeIconSelection:true,},{id:"painter-selected",text:j.Selected,fonticon:"brush-ok",changeIconSelection:true},{id:"painter-none",text:j.None,fonticon:"brush",changeIconSelection:true}]},{id:"zoom",text:j.Zoom,fonticon:"search",content:[{id:"large",text:j.Large,fonticon:"fonticon fonticon-high"},{id:"medium",text:j.Medium,fonticon:"fonticon fonticon-medium"},{id:"small",text:j.Small,fonticon:"fonticon fonticon-low"}]}]};this._containerToolBar=document.createElement("div");this._containerToolBar.classList.add("matri-table-toolbar");this.collectionToolbar=new h(k);this.collectionToolbar.inject(this._containerToolBar)};g.prototype._initDivs=function(){var k=b.compile(a);var l=k(this._options);this._container=document.createElement("div");this._container.innerHTML=l;this._container=this._container.firstChild;this._painterContainer=this._container.querySelector(".painter-presenter");this._matruiTablePresenterContainer=this._container.querySelector(".table-presenter");this._matruiTablePresenterContainer.appendChild(this._containerToolBar);this._matruiTablePresenter.inject(this._matruiTablePresenterContainer);UWA.extendElement(this._container)};g.prototype._clearPreviousEvents=function(){if(this._solverModelEvent){var l=UWA.clone(this._subscribedEventTokens)||[];for(var k=0;k<l.length;k++){this._solverModelEvent.unsubscribe(l[k])}}if(this._privateChannel){var l=UWA.clone(this._subscribedEventTokensPrivate)||[];for(var k=0;k<l.length;k++){this._privateChannel.unsubscribe(l[k])}}};g.prototype._subscribeToEvents=function(){var k=this;this._subscribedEventTokensPrivate.push(this._privateChannel.subscribe({event:"mr-refresh-run-view"},function(l){d.mask(k._container);k._matruiTablePresenter.refresh()}));this._subscribedEventTokens.push(this._solverModelEvent.subscribe({event:"checkMatrixRuleValidity_SolverAnswer"},function(n){var m=n.answerData._clientData?n.answerData._clientData.columnID:-1;if(m>=0){var l=k._matrixModel.getMiniJsonModel(m);if(l._clientData.timerID===n.answerData._clientData.timerID){k._matrixModel.updateJsonModel(n.answerData);k.update({columnID:m})}}else{k._matrixModel.setJsonModel(n.answerData);k.update({columnID:m})}d.unmask(k._container)}));this._subscribedEventTokens.push(this._solverModelEvent.subscribe({event:"checkMatrixRuleValidity_SolverReason"},function(n){var l=n.answerData._clientData.columnID;var m=n.answerData._clientData.rowID;if(l>=0&&m>=0){var o={};o.statesCausingValues=n.answerData.statesCausingValues[0][m];o.statesCausingRules=n.answerData.statesCausingRules[0][m];o.statesValidity=n.answerData.statesValidity[0][m];o.states=n.answerData.states[0][m];k._matruiTablePresenter.setTooltip(o,n.answerData._clientData)}d.unmask(k._container)}))};g.prototype.inject=function(k){k.appendChild(this._container)};g.prototype.attachResizeSensor=function(){this.collectionToolbar.attachResizeSensor()};g.prototype.loadData=function(){};g.prototype.update=function(k){this._matruiTablePresenter.update(k)};g.prototype.destroy=function(){};g.prototype.refreshUI=function(){this._privateChannel.publish({event:"mr-refresh-run-view"})};return g});define("DS/CfgRuleMatrixComponent/GlobalPresenter/GlobalPresenter",["DS/CfgDictionary/CfgDictionaryV3Utils","DS/CfgVCSComponent/Presenter/DgvCfgVCSMainContainer","DS/Handlebars/Handlebars","DS/Core/ModelEvents","DS/UIKIT/Mask","UWA/Element","DS/CfgDictionary/CfgDictionaryMapperUtils","DS/CfgRuleMatrixComponent/GlobalPresenter/WizardPresenter","DS/ENOXWizard/js/ENOXWizard","DS/CfgRuleMatrixComponent/Buildtime/DrivingCriteriaPresenter","DS/CfgRuleMatrixComponent/Buildtime/ConstrainedCriteriaPresenter","DS/CfgRuleMatrixComponent/Runtime/RunTimePresenter","DS/CfgRuleMatrixComponent/Model/MatrixRuleModel","DS/CfgRuleMatrixComponent/Utils/MatruiTablePersistanceUtils","UWA/Class/Model","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Alert","DS/xModelEventManager/xModelEventManager","text!DS/CfgRuleMatrixComponent/GlobalPresenter/GlobalPresenter.html","css!DS/CfgRuleMatrixComponent/GlobalPresenter/GlobalPresenter.css","i18n!DS/CfgRuleMatrixComponent/assets/nls/GlobalPresenter"],function(a,r,g,m,w,h,b,q,v,l,i,c,f,e,s,k,n,j,d,u,t,o){var p=function(){};p.prototype.init=function(y,F,B,H,G,I){this._solverKey=I.solverKey?I.solverKey:null;this._updateChannel=G;this._applicationChannel=H?H:undefined;this._privateChannel=new m();this._myEventManager=new d(this._applicationChannel,this._updateChannel,this._privateChannel);this._currentView="build";this._inputJsonModel=UWA.clone(B);this._jsonModel=B?B:null;if(!this._jsonModel){this._jsonModel={drivingCriteria:[],constrainedCriteria:[],constrainedValues:[],drivingCombinationValues:[],states:[],statesValidity:[],version:"2.0"}}else{if(this._jsonModel.states&&this._jsonModel.states.length>0){this._currentView="run"}}this._variabilityDictionary=F;this._contextDictionary=I.contextDico;this._mapDico=b.dicoMinifiedV3ToMap(F);if(this._jsonModel.version==="1.0.1"){var x=e.convertJsonToV2(this._mapDico,this._jsonModel);this._jsonModel=x}console.log(x);this._matrixRuleModel=new f(this._mapDico,this._jsonModel);var D=this._matrixRuleModel.checkAndFixDiscrepancy();this._isReadyToSwitch=true;this._ruleId=y.ruleId;this._modelId=y.modelId;this._ruleName=y.ruleName;this._ruleSaveAllowed=true;this._ruleSaveErrorMessage="";this._runTimePresenter=new c();this._drivingCriteriaPresenter=new l();this._constrainedCriteriaPresenter=new i();this._wizardPresenter=new q();var C={modelEvents:this._privateChannel,items:[{id:"driving-criteria",name:"Driving Criteria",icon:"fonticon fonticon-lifebelt"},{id:"constrained-criteria",name:"Constrained Criteria",icon:"fonticon fonticon-link"},{id:"content",name:"Content",icon:"fonticon fonticon-table"}]};this._ENOXWizard=new v(C);this._workaroundCheckAndWakeUpResizeSensor=I.resizeSensorEnablerFun?I.resizeSensorEnablerFun:function(){};this._wizardPresenter.init(this._privateChannel,{view:this._currentView});this._runTimePresenter.init(this._matrixRuleModel,this._privateChannel,{painter:false,solverKey:this._solverKey,solverModelEvent:I.solverModelEvent,dictionary:this._variabilityDictionary,editable:I.editable});this._initVCS();this._drivingCriteriaPresenter.init(F,this._matrixRuleModel,this._applicationChannel,this._privateChannel,{updateChannel:this._updateChannel,solverKey:this._solverKey,editable:I.editable,resizeSensorEnablerFun:this._workaroundCheckAndWakeUpResizeSensor},this._criteriaSelector);this._constrainedCriteriaPresenter.init(F,this._matrixRuleModel,this._applicationChannel,this._privateChannel,{updateChannel:this._updateChannel,solverKey:this._solverKey,editable:I.editable,resizeSensorEnablerFun:this._workaroundCheckAndWakeUpResizeSensor},this._criteriaSelector);this._initDivs();this._subscribeToEvents();this._msgError="";if(D._rc!==0){var E="",A=0;for(A=0;A<D._discrepancyIds.length;A+=1){if(A===0){E=D._discrepancyIds[A]}else{E+=", "+D._discrepancyIds[A]}}this._msgError=E+" "+o._HaveNotBeenFoundWhileOpeningRule}if(this._msgError!==""){this._msgError=o._error_missing_criteria;this._updateChannel.publish({event:"mr-global-presenter-error-criteria-not-found",data:this._msgError});console.warn(this._msgError)}if(this._msgError!==""){this._privateChannel.publish({event:"mr-model-change"})}var z=this._matrixRuleModel.getJsonModel();if(z.drivingCriteria.length==0||z.constrainedCriteria.length==0||z.states.length===0){this._contentrunContainer.classList.add("no-content")}};p.prototype._initDivs=function(){var y=g.compile(u);var x=y();this._container=document.createElement("div");this._container.innerHTML=x;this._container=this._container.firstChild;UWA.extendElement(this._container);this._alertContainer=this._container.querySelector(".tablerule-alert-container");this._wizardContainer=this._container.querySelector(".wizard-container");this._contentDrivingContainer=this._container.querySelector(".contentbuild-container");this._contentConstrainedContainer=this._container.querySelector(".contentconstrained-container");this._contentrunContainer=this._container.querySelector(".contentrun-container");this._alert=new j();this._alert.inject(this._alertContainer);this._ENOXWizard.inject(this._wizardContainer);this._drivingCriteriaPresenter.inject(this._contentDrivingContainer);this._constrainedCriteriaPresenter.inject(this._contentConstrainedContainer);this._runTimePresenter.inject(this._contentrunContainer);var z=UWA.createElement("div",{"class":"no-criteria-container",html:o._noCriteriaSelected});z.inject(this._contentrunContainer);if(this._currentView==="build"){this._contentrunContainer.classList.add("displaynone");this._contentConstrainedContainer.classList.add("displaynone");this._contentDrivingContainer.classList.remove("displaynone")}else{if(this._currentView==="run"){this._contentDrivingContainer.classList.add("displaynone");this._contentrunContainer.classList.remove("displaynone");this._contentrunContainer.classList.remove("no-content")}}this._okCancelContainer=this._container.querySelector(".okcancel-footer");this._createOKCancelActions().inject(this._okCancelContainer)};p.prototype._switchViewWizard=function(x){var z=this;switch(x){case"driving-criteria":z._contentDrivingContainer.classList.remove("displaynone");z._contentrunContainer.classList.add("displaynone");z._contentConstrainedContainer.classList.add("displaynone");z._criteriaSelector.publish("buildtime-axis-change","driving");break;case"constrained-criteria":z._contentConstrainedContainer.classList.remove("displaynone");z._contentDrivingContainer.classList.add("displaynone");z._contentrunContainer.classList.add("displaynone");z._criteriaSelector.publish("buildtime-axis-change","constrained");break;case"content":z._applicationChannel.publish({event:"information-panel-close"});z._contentConstrainedContainer.classList.add("displaynone");z._contentDrivingContainer.classList.add("displaynone");z._contentrunContainer.classList.remove("displaynone");z._privateChannel.publish({event:"mr-refresh-run-view"});var y=z._matrixRuleModel.getJsonModel();if(y.drivingCriteria.length==0||y.constrainedCriteria.length==0||y.states.length===0){z._contentrunContainer.classList.add("no-content")}else{z._contentrunContainer.classList.remove("no-content")}break;default:}};p.prototype._subscribeToEvents=function(){var x=this;this._myEventManager.subscribe(this._privateChannel,{event:"enox-wizard-item-click"},function(y){x._switchViewWizard(y)});this._myEventManager.subscribe(this._privateChannel,{event:"display-more-details-solver"},function(y){console.log("receiving display-more-details-solver")});this._myEventManager.subscribe(this._privateChannel,{event:"mr-model-change"},function(){x._showOkCancel();x._privateChannel.publish({event:"mr-rule-save-allow",data:{allow:true}});x._updateChannel.publish({event:"mr-model-change"})});this._myEventManager.subscribe(this._privateChannel,{event:"set-notification-message"},function(y){x._alert.add(y);x._alert.show()});this._myEventManager.subscribe(this._privateChannel,{event:"mr-rule-save-allow"},function(y){if(y){x._ruleSaveAllowed=y.allow==true;if(x._ruleSaveAllowed){x._ruleSaveErrorMessage=""}else{x._ruleSaveErrorMessage=y.message}}});this._myEventManager.subscribe(this._privateChannel,{event:"switch-view-allow"},function(y){x._isReadyToSwitch=y==true;if(x._wizardContainer){if(x._isReadyToSwitch){x._wizardContainer.classList.remove("switch-disabled")}else{x._wizardContainer.classList.add("switch-disabled")}}});this._updateChannel.subscribe({event:"mr-reload-table"},function(){console.log("reloading...");x._runTimePresenter.refreshUI()})};p.prototype.attachResizeSensor=function(){this._runTimePresenter.attachResizeSensor();this._ENOXWizard.attachResizeSensor()};p.prototype.inject=function(x){x.appendChild(this._container);this._workaroundCheckAndWakeUpResizeSensor(this._contentDrivingContainer);if(this._currentView==="build"){this._ENOXWizard._setCurrentSelection("driving-criteria")}else{this._ENOXWizard._setCurrentSelection("content")}};p.prototype.destroy=function(){if(this._runTimePresenter){this._runTimePresenter._clearPreviousEvents()}if(this._drivingCriteriaPresenter){this._drivingCriteriaPresenter.destroy()}if(this._ENOXWizard){this._ENOXWizard.destroy()}this._myEventManager.cleanup("GlobalPresenter")};p.prototype._createOKCancelActions=function(){var A=this;this._myEventManager.subscribe(this._updateChannel,{event:"mr-onsavedone"},function(){A._hideOKCancel()});this._myEventManager.subscribe(this._updateChannel,{event:"update-json-model-on-mr-save"},function(){A._jsonModel=A._matrixRuleModel.getJsonModel();A._inputJsonModel=UWA.clone(A._jsonModel)});var C=new k({value:o._save,className:"primary"});var B=function(){console.log("saving MR");if(A._ruleSaveAllowed){A._updateChannel.publish({event:"mr-onsave",data:A._matrixRuleModel.getJsonModel()})}else{A._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:A._ruleSaveErrorMessage}})}};C.addEvent("onClick",B);var z=new k({value:o._undo,className:"default"});var y=function(){console.log("cancel");A.refreshUI(A._inputJsonModel);A._hideOKCancel()};z.addEvent("onClick",y);var x=new n({buttons:[C,z]});A._OkCancel=x;if(A._jsonModel.version!="2.0"){A._showOkCancel()}return x};p.prototype._showOkCancel=function(){this._okCancelContainer.classList.remove("displaynone");this._contentDrivingContainer.classList.add("with-footer");this._contentrunContainer.classList.add("with-footer")};p.prototype._hideOKCancel=function(){this._okCancelContainer.classList.add("displaynone");this._contentDrivingContainer.classList.remove("with-footer");this._contentrunContainer.classList.remove("with-footer")};p.prototype.refreshUI=function(x){w.mask(this._container);this._jsonModel=x?UWA.clone(x):null;if(!this._jsonModel){this._jsonModel={drivingCriteria:[],constrainedCriteria:[],constrainedValues:[],drivingCombinationValues:[],states:[],statesValidity:[],version:"2.0"}}if(this._jsonModel.states||this._jsonModel.states.length==0){this._currentView="build";if(this._jsonModel.drivingCriteria.length==0||this._jsonModel.constrainedCriteria.length==0||this._jsonModel.states.length===0){this._contentrunContainer.classList.add("no-content")}}this._matrixRuleModel.setJsonModel(this._jsonModel);this._drivingCriteriaPresenter.refreshUI();this._runTimePresenter.refreshUI();w.unmask(this._container)};p.prototype._initVCS=function(){var x=this;this._dicoForVCS=a.getSubDictionary(this._variabilityDictionary,a.WITH_REFERENCES_ONLY);this._criteriaSelector=new r({title:"<B>"+o.VARIABILITY_SECTION_TITLE+"</B>",dictionaryJSON:this._dicoForVCS,getAllChildrenOnParentSelection:false,getParentOnChildSelection:false,itemActions:[{title:"Add",text:"add",fonticon:"plus",event:"onAddAction"}],contentFilter:function(y){var z=true;if(y.kind=="instance"){z=false}return z}});this._criteriaSelector.render()};return p});