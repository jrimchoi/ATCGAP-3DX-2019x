function LibraryEditor(a){var b={widget:null,filterFromWin:null,libraryContent_Cont:null,libraryContentController:null,libraryTree_div:null,libraryTreeDoc_div:null,libraryTree_Cont:null,libraryIdCard_div:null,libraryIdCard_Cont:null,core:null,widthToHideLeftPanel:300,_actionbar:null,_commandProxy:null,libraryTree_W_NotLinked:false,css_view_class:"windowed",_mouseEventsManager:{unlockMouseMove:false,draggingXSlider:null,mouseStartXSlider:null,initialMouseStartXSlider:null,dragginDirection:null,cancelDragging:false,spanPosition:null,widthLeftDiv:null,widthRightDiv:null,widthLeftDivSave:null,widthRightDivSave:null,widthGlobalDiv:null,newWidthGlobalDiv:null},init:function(c){var d=this;this.widget=c.widget;var e=JSON.stringify(c.filter);if(c.filter){this.filterFromWin=c.filter}else{this.filterFromWin=null}if(c.defaultSelectionPath){this.widget.defaultSelectionPathFromWin="root,LibrarySection_AllLibraries,"+c.defaultSelectionPath}if(c.contextID){localStorage.setItem("windowContext",c.contextID)}this.widget.addEvent("onLoad",this.onLoad.bind(this));this.widget.addEvent("onRefresh",this.onRefresh.bind(this));this.widget.addEvent("onDestroy",this.onDestroy.bind(this));this.widget.addEvent("onResize",this.onResize.bind(this))},onRefresh:function(d){var c=this;require(["DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/utils/LibraryAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/PADUtils/PADSettingsMgt","DS/LibraryEditor/utils/LibraryEditorcontrol"],function(f,e,k,g,i){var j=g.getSetting("useIndexAccleration");i.getContent().updateFilterBI(j);i.getContent().updateComputedColumns();c.libraryContent_Cont.addEvent("onCompleteRefreshNodes",function(l){this.removeEvent("onCompleteRefreshNodes");e.displayNotification({message:k.msg_info_refresh,className:"primary"})});if(d&&UWA.is(d.authored.deleted,"array")){var h=f.getCurrentLibrary();if(h.getID()===d.authored.deleted[0]){h.getParent().select(true)}}i.getTreeCont().refreshLibraryTree();i.getContent().refreshLibraryContent();require(["DS/PlatformAPI/PlatformAPI"],function(l){if(i.isCustomizedEnv()){l.publish("LibraryEditor.ActiveLibraryCheck",{})}})})},setCtxMenu:function(e,c,d){if(this.libraryContentController){this.libraryContentController.webInWinCtxMenu(e,c)}},onWebInWinFilterChange:function(c){if(this.libraryContentController){this.libraryContentController.onWebInWinFilterChange(c)}},onWebInWinTaggerVisChange:function(c){},onDestroy:function(){},onResize:function(){var c=this;setTimeout(function(){var d;if(c.libraryGlobal_div&&c.libraryIdCard_Cont){d=c.libraryGlobal_div.clientWidth;if(d!==0){c.libraryIdCard_Cont.updateDisplayPath()}}},500)},onLoad:function(){this.probeHeader=this.widget.id+"_"+this.widget.getTitle()+"_";window.top.performance.mark("onLoad_begin");window.top.performance.measure(this.probeHeader+"createToOnLoad","createWidget_begin","onLoad_begin");var c=this;require(["UWA/Core","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","DS/PADUtils/PADUtilsServices","DS/LibraryEditor/controllers/LibraryContentController","DS/LibraryEditor/controllers/LibraryIdCardController","DS/LibraryEditor/controllers/LibraryTreeController","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/ActionBar/LibraryActionBar","DS/LibraryEditor/utils/LibraryEditorEvents","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryAlert","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/LibraryEditorKeyboardListener","DS/LibraryEditor/utils/LibraryEditorUtil","DS/PADUtils/PADProbes","DS/LibraryEditor/utils/FilterUtils","text!DS/LibraryEditor/assets/library_settings.json","DS/MessageBus/MessageBus"],function(d,n,k,x,o,s,h,l,v,f,t,p,y,w,e,B,u,C,g,z,m){var q=c.filterFromWin;if(q&&q!=null){z.setFilters(c.filterFromWin)}else{z.resetEndItemFilter()}window.top.performance.mark("loadRequire_end");window.top.performance.measure(c.probeHeader+"loadRequire","createWidget_begin","loadRequire_end");k.addEventOnce("onNoSecurityContext",function(){B._isSecurityCTXInitialized=false;widget.setBody(" ");var D=UWA.createElement("div",{text:p.get("authentication_error")});D.set("styles",{position:"absolute",top:"40%",bottom:"30%",left:"30%",right:"30%"});D.inject(widget.body)});var r=JSON.parse(m);k.setApp(r.padsettings,"enopad");k.setSetting("activate_padprobes",true);k.setSetting("add_objects_when_select",false);g.initialize({padid:widget.id,padtitle:widget.getTitle()});x.addSharedSettings(widget,["useIndexAccleration","x3dPlatformId","pad_security_ctx"]);widget.setValue("editProperties_readOnly",false);c.widget.addEvent("endEdit",k.updateWidgetPreferences.bind(k));k.updateWidgetPreferences();c.updateSecurityPreference();if(!c.widget.getValue("x3dSharedId")&&!c.widget.getValue("x3dAppId")){c.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOFOL3_AP"})}if(!c.widget.getValue("x3dSharedId")){c.widget.addPreference({name:"x3dSharedId",type:"hidden",defaultValue:"LibraryEditor_"+o.getWidgetId()})}t.onCurrentLibraryChange(function(D){widget.setTitle(this.getLabel())});t.onLibraryRename(function(D){if(D.oldNode.id===v.getCurrentLibraryID()&&UWA.is(widget)){widget.setTitle(D.newLabel)}});c._onRefreshLibrary=function(F){var D=false;var I=[];if(UWA.is(F.authored.connected,"array")){var J=v.getCurrentLibrary();var E=J.getID();var L=F.authored.connected;if(L.length>0){for(var G=0;G<L.length;G++){var K=L[G];if(UWA.is(K,"array")){var H=K[0];if(K.length>1){I.push(K[1])}if(H==E){D=true;break}}}}}if(D){c.libraryContentController.loadContentAndSelect(v.getCurrentLibrary(),I)}};c._commandProxy=n.create({events:{onRefresh:c._onRefreshLibrary.bind(c)}});if(c.libraryTree_Cont===null||c.libraryTree_Cont===undefined){c.core=d;c.widget.body.empty();c._buildSkeleton();var j=function(){c.widget.getPreferences().forEach(function(D){var E=D.type==="boolean"&&UWA.is(D.value,"string")?c.convertToBool(D.value):D.value;c.widget.setValue(D.name,E)})};c.widget.addEvent("endEdit",function(){j()});c.libraryGlobal_div=c.widget.body.container;c.libraryTreeDoc_div=c.widget.body.right_side_div;c.libraryIdCard_div=c.widget.body.top_right_side_div;c.libraryContent_div=c.widget.body.bottom_right_side_div;var A=c._initializeLibraryEditorComponent.bind(c);if(c.libraryContent_Cont===null){var i={x3dAppId:c.widget.getValue("x3dAppId"),lang:c.widget.lang?c.widget.lang:c.widget.getValue("lang"),layout:{view_customization:null,css_view_class:c.css_view_class,store_roots_in_pref:true,padshell:true},authorize_setStructure:true,settings:r};if(c.widget.getValue("LibraryCusto_treelistview")){i.layout.view_customization=JSON.parse(decodeURIComponent(c.widget.getValue("LibraryCusto_treelistview")));A(i)}else{o.app_initialization(function(){require(["DS/PADUtils/PADWSAccess"],function(D){D.getMyAppsTemplate({preference_name:c.widget.getValue("x3dAppId"),onComplete:function(F){var E=null;if(F.length>0){E=JSON.parse(decodeURIComponent(F))}i.layout.view_customization=E;A(i)},onFailure:function(E){A(i)}})})})}c.getSelectedNodes=function(){return v.getSelectedNodes()};c.getCurrentLibrary=function(){var F=true;var E=C.getCurrentSecurityContextAndLibraryData(F);var D=JSON.stringify(E);return D};c.getSecurityContext=function(){return{SecurityContext:k.getSetting("pad_security_ctx"),tenant:widget.getValue("pad_tenant")}};c.beginBlockingTransaction=function(D){require(["DS/UIKIT/Mask"],function(E){E.mask(c.libraryContent_div,D)})};c.endBlockingTransaction=function(){require(["DS/UIKIT/Mask"],function(D){D.unmask(c.libraryContent_div)})};c.author=function(D){};c.insertNodes=function(H){var E=[];function G(I){if(E.indexOf(I.resourceid)===-1){E.push(I.resourceid)}}for(var F in H){if(H.hasOwnProperty(F)){H[F].forEach(G)}}var D=E[0];c._insertOrAdd(D,"insert")};c.addRoots=function(E){if(E.pids.length>0){var D=E.pids[0];c._insertOrAdd(D,"add")}};c._insertOrAdd=function(D,H){var G=v.getCurrentLibrary();var K=true;if(G!==null){var J=G.getType();if(w.inFamilyLibrary(J)||J=="LibrarySection_AllLibraries"){K=false;var I=null;if(UWA.is(B.getContent())){I=c.libraryContentController.loadContentAndSelect(G,D)}if(UWA.is(B.getTreeCont())){var F=(!G.isFavorite)?G:B.getTreeCont()._getVisibleNodeById(G.getID());if(F!==null&&F.isExpanded()){B.getTreeCont().updateTreeWithNewLibrary(F)}else{if(!G.isExpanded()&&B.getTreeCont().NodeToExpandAfterNewLibrary){G.expand();B.getTreeCont().NodeToExpandAfterNewLibrary=false}}}if(I!==null&&H==="add"){I.then(function(L){c.probeEnableEdit=g.createProbe("setEnable_name");c.defaultEnableNameEdit(L,true)})}}}if(K){var E=[];if(UWA.is(B.getTreeCont())){E=c.libraryTree_Cont._libraries_TreeDocument.getRoots()}E.forEach(function(L){if(L.plmType=="LibrarySection_AllLibraries"){if(G!==null){G.unselect()}L.select();if(UWA.is(B.getContent())){c.libraryContentController.loadContentAndSelect(L,D)}if(L.isExpanded()){B.getTreeCont().updateTreeWithNewLibrary(L)}else{if(B.getTreeCont().NodeToExpandAfterNewLibrary){L.expand();B.getTreeCont().NodeToExpandAfterNewLibrary=false}}}})}};c.defaultEnableNameEdit=function(E,D){var F=B.getContent().getView().getPADTreeListView().getManager();setTimeout(function(){try{if(D===true){var G=g.createProbe("scrollTo_library");F.scrollToNode(E,"middle");G.end()}setTimeout(function(){var K=g.createProbe("switchToEdit_name");var N=E._computeRowID();var I=F.getRow(N);var M=null;for(var L=0;L<I.length;L++){var J=I[L];if(J._view&&"tree"===(J._view.getCellInfos()).dataIndex){M=J.getView();break}}if(null!==M){M.switchToWriteView();K.end();c.probeEnableEdit.end()}})}catch(H){}},1000)};c.displayNotification=function(D){e.displayNotification({message:D.msg,className:D.eventID})};c.getPADTreeDocument=function(){return B.getContent().getView()?B.getContent().getView().getPADTreeDocument():null};c.toggleView=function(D){if(UWA.is(B.getContent().getView().toggleView(D))){B.getContent().getView().toggleView(D)}};c.getPADTreeListView=function(){return B.getContent().getView().getPADTreeListView()}}}})},_slidderMoveEndCallback:function(){if(this.libraryIdCard_Cont){this.libraryIdCard_Cont.updateDisplayPath()}},_buildSkeleton:function(){if(!this.core.is(this.widget.body.container)){this.widget.body.container=UWA.createElement("div",{"class":"LibraryEditor_global_container"}).inject(this.widget.body,"top");this.widget.body.right_side_div=UWA.createElement("div",{"class":"LibraryEditor_right_side_div"}).inject(this.widget.body.container);this.widget.body.top_right_side_div=UWA.createElement("div",{"class":"LibraryEditor_top_right_side_div",}).inject(this.widget.body.right_side_div);this.widget.body.bottom_right_side_div=UWA.createElement("div",{"class":"LibraryEditor_bottom_right_side_div"}).inject(this.widget.body.right_side_div)}},loadActionBar:function(c,d){this._actionbar.loadActionBar(c,d)},convertToBool:function(c){return(c.toLowerCase()==="true")},_initializeLibraryEditorComponent:function(g){var e=this;var j=require("DS/LibraryEditor/controllers/LibraryTreeController");var h=require("DS/LibraryEditor/utils/LibraryEditorcontrol");var d=require("DS/LibraryEditor/controllers/LibraryIdCardController");var f=require("DS/LibraryEditor/controllers/LibraryContentController");var c=require("DS/LibraryEditor/utils/LibraryEditorKeyboardListener");var i=require("DS/PADUtils/PADUtilsServices");i.app_initialization(function(){i.getSecurityContext(function(m){if(m&&m.securityContext!==""&&m.securityContextList.length>0){if(e.libraryTree_Cont===null){i.app_initialization(function(){new j({lang:e.widget.lang?e.widget.lang:e.widget.getValue("lang"),css_view_class:e.css_view_class,events:{onReady:function(){e.libraryTree_Cont=this;if(e.libraryTree_Cont!==null){e.libraryTree_Cont.setOption("_libraryContentView",this)}else{if(e.libraryTree_W_NotLinked===true){throw"LibraryTree are not linked !!!"}else{e.libraryTree_W_NotLinked=true}}e.libraryTree_Cont.getSortingContainer().inject(this.elements.container);var n=h.getTreeCont();n._OnTreeComponentReady();e.widget.dispatchEvent("onLibraryEditorReady")}}})})}var k=e._retrieveinitializationOpts(),l=UWA.extend(g,k);e.libraryContentController=new f(l);if(e.libraryIdCard_Cont===null){e.libraryIdCard_Cont=new d({lang:e.widget.lang?e.widget.lang:e.widget.getValue("lang"),css_view_class:e.css_view_class,parentDiv:e.libraryIdCard_div,events:{onReady:function(){h.getIdCardCont()._OnIdCardComponentReady()}}})}if(!e._keyboardListener){e._keyboardListener=new c();e._keyboardListener.startObservingKeyboard()}}})})},updateSecurityPreference:function(){if(window.library){require(["DS/PADUtils/PADSettingsMgt"],function(c){var e=window.library.params;var d="ctx::"+e.securityContext;c.setSetting("pad_security_ctx",d)})}},_retrieveinitializationOpts:function(){var c=this;return{renderTo:c.libraryContent_div,events:{onActionBarReadyToBuild:function(){var d=require("DS/LibraryEditor/ActionBar/LibraryActionBar");window.DEBUG_ActionBar_Require=true;window.DEBUG_ActionBar_CmdInstantiation=true;window.DEBUG_ActionBar_Xml=true;window.DEBUG_ActionBar_ProcessCommandHeader=true;window.DEBUG_ActionBar_Init=true;c.elements=this.elements;c.options=this.options;c.togglePanel=this.togglePanel;c._actionbar=new d({renderTo:c.libraryGlobal_div,context:c,events:{onActionBarReady:function(){c.widget.dispatchEvent("onLibraryEditorActionBarReady");var e=window.top.performance.getEntriesByName("createWidget_begin");if(e&&e.length>0){window.top.performance.mark("createWidget_end");window.top.performance.measure(c.probeHeader+"createWidget","createWidget_begin","createWidget_end")}}}})},onReady:function(){c.libraryContent_Cont=this;c.addEvent=c.libraryContent_Cont.addEvent.bind(c.libraryContent_Cont);if(c.libraryContent_Cont.dropInvitContainer){c.libraryContent_Cont._dropInvitContainer=c.libraryContent_Cont.dropInvitContainer}if(c.libraryContent_Cont.options.renderTo){c.libraryContent_Cont._dropInvitContainer.hide();c.libraryContent_Cont.render().inject(c.libraryContent_Cont.options.renderTo)}c.libraryContentController._OnPADComponentReady();var d=require("DS/PADUtils/PADSettingsMgt");c.widget.mergePreferences(d.getSecurityPreferences());c.updateSecurityPreference();require(["DS/WidgetServices/WidgetServices","DS/LibraryEditor/service/LibraryCommunication","DS/LibraryEditor/utils/LibraryEditorcontrol"],function(g,f,e){if(g.isNatifEnvironnement()&&!g.isWebInWinEnvironment()){e.getContent().getView().getPADTreeDocument().getXSO().onChange(function(){var h=e.getContent().getView().getPADTreeDocument().getXSO().get();var i=[];h.forEach(function(j){i.push(j.getID())});f.publish("onObjectSelected",i)})}})},onCustoViewChange:function(d){c.widget.setValue("LibraryCusto_treelistview",encodeURIComponent(JSON.stringify(d)))},onSaveAsTemplate:function(d){c.widget.setValue("LibraryCusto_treelistview",encodeURIComponent(JSON.stringify(d)));require(["DS/PADUtils/PADWSAccess"],function(e){e.saveMyAppsTemplate({preference_name:c.widget.getValue("x3dAppId"),value:encodeURIComponent(JSON.stringify(d)),onComplete:function(f){console.log("Saved as template")},onFailure:function(f){console.warn("Cannot save customization template")}})})},onSwitchView:function(){if(c._actionbar){c._actionbar.syncState()}},}}},};b.init(a);return b}define("DS/LibraryEditor/utils/LibraryAlert",["UWA/Class","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(b,c,d){var a=b.singleton({_notif_manager:null,init:function(){},displayNotification:function(e){if(this._notif_manager===null){this._notif_manager=c;d.setNotificationManager(this._notif_manager);d.setStackingPolicy(5)}var f="info";if(UWA.is(e.className)&&e.className!=="primary"){f=e.className}this._notif_manager.addNotif({level:f,message:e.message,sticky:false})}});return{displayNotification:a.displayNotification.bind(a)}});define("DS/LibraryEditor/utils/LibraryEditorEvents",["UWA/Class","DS/Core/ModelEvents",],function(c,b){var a=c.singleton({EVT_CURRENT_LIBRARY_CHANGE:"/LIBRARY_EDITOR/CURRENTLIBRARY_CHANGE",EVT_NODEMODEL_MODIFY:"/LIBRARY_EDITOR/NODEMODEL_MODIFY",EVT_LIBRARY_LOADINGSTART:"/LIBRARY_EDITOR/LIBRARY_LOADINGSTART",EVT_LIBRARY_LOADINGEND:"/LIBRARY_EDITOR/LIBRARY_LOADINGEND",EVT_CURRENT_LIBRARY_FILTER_CHANGE:"/LIBRARY_EDITOR/CURRENTLIBRARY_FILTER_CHANGE",EVT_LIBRARY_TREELISTVIEW_SCROLL_END:"/LIBRARY_EDITOR/LIBRARY_TREELISTVIEW_SCROLL_END",EVT_LIBRARY_TAGGER_OPEN:"/LIBRARY_EDITOR/LIBRARY_TAGGER_OPEN",EVT_LIBRARY_TAGGER_CLOSE:"/LIBRARY_EDITOR/LIBRARY_TAGGER_CLOSE",EVT_LIBRARY_PAGETOOLBAR_EXPAND:"welcome-panel-expand",EVT_LIBRARY_PAGETOOLBAR_EXPANDED:"welcome-panel-expanded",EVT_LIBRARY_PAGETOOLBAR_COLLAPSE:"welcome-panel-collapse",EVT_LIBRARY_PAGETOOLBAR_COLLAPSED:"welcome-panel-collapsed",EVT_LIBRARY_PAGEINFO_EXPAND:"information-panel-open",EVT_LIBRARY_PAGEINFO_EXPANDED:"information-panel-visible",EVT_LIBRARY_PAGEINFO_COLLAPSE:"information-panel-close",EVT_LIBRARY_PAGEINFO_COLLAPSED:"information-panel-hidden",_modelEvents:null,init:function(d){this._parent(d);this._modelEvents=new b()},getModelEvents:function(){return this._modelEvents},notifyLibraryLoadingStart:function(d){if(!UWA.is(d)){throw new Error("input parameter should be a TreeNodeModel")}this._modelEvents.publish({event:this.EVT_LIBRARY_LOADINGSTART,context:d,data:d})},onLibraryLoadingStart:function(e){if(!UWA.is(e,"function")){throw new Error("input parameter should be function")}var d=this;this._modelEvents.subscribe({event:d.EVT_LIBRARY_LOADINGSTART,},e)},notifyLibraryLoadingEnd:function(d){if(!UWA.is(d)){throw new Error("input parameter should be a TreeNodeModel")}this._modelEvents.publish({event:this.EVT_LIBRARY_LOADINGEND,context:d,data:d})},onLibraryLoadingEnd:function(e){if(!UWA.is(e,"function")){throw new Error("input parameter should be function")}var d=this;this._modelEvents.subscribe({event:d.EVT_LIBRARY_LOADINGEND,},e)},notifyLibraryRename:function(e){if(!UWA.is(e,"object")){throw new Error("input parameter should be object")}var d=this;d._modelEvents.publish({event:d.EVT_NODEMODEL_MODIFY,context:e.oldNode,data:e})},onLibraryRename:function(e){if(!UWA.is(e,"function")){throw new Error("input parameter should be function")}var d=this;this._modelEvents.subscribe({event:d.EVT_NODEMODEL_MODIFY,},e)},notifyCurrentLibraryChange:function(e){if(!UWA.is(e,"object")){throw new Error("input parameter should be object")}if(!e.currentNode){throw new Error("input object should have currentNode")}var d=this;this._modelEvents.publish({event:d.EVT_CURRENT_LIBRARY_CHANGE,context:e.currentNode,data:e})},onCurrentLibraryChange:function(e){if(!UWA.is(e,"function")){throw new Error("input parameter should be function")}var d=this;this._modelEvents.subscribe({event:d.EVT_CURRENT_LIBRARY_CHANGE,},e)},notifyCurrentLibraryFilterChange:function(){var d=this;this._modelEvents.publish({event:d.EVT_CURRENT_LIBRARY_FILTER_CHANGE})},onCurrentLibraryFilterChange:function(e){if(!UWA.is(e,"function")){throw new Error("input parameter should be function")}var d=this;this._modelEvents.subscribe({event:d.EVT_CURRENT_LIBRARY_FILTER_CHANGE},e)},notifyScrollEnd:function(){var d=this;this._modelEvents.publish({event:d.EVT_LIBRARY_TREELISTVIEW_SCROLL_END})},onScrollEnd:function(e){if(!UWA.is(e,"function")){throw new Error("input parameter should be function")}var d=this;this._modelEvents.subscribe({event:d.EVT_LIBRARY_TREELISTVIEW_SCROLL_END},e)},notifyTaggerOpen:function(){var d=this;this._modelEvents.publish({event:d.EVT_LIBRARY_TAGGER_OPEN})},onTaggerOpen:function(e){if(!UWA.is(e,"function")){throw new Error("input parameter should be function")}var d=this;this._modelEvents.subscribe({event:d.EVT_LIBRARY_TAGGER_OPEN},e)},notifyTaggerClose:function(){var d=this;this._modelEvents.publish({event:d.EVT_LIBRARY_TAGGER_CLOSE})},onTaggerClose:function(e){if(!UWA.is(e,"function")){throw new Error("input parameter should be function")}var d=this;this._modelEvents.subscribe({event:d.EVT_LIBRARY_TAGGER_CLOSE},e)},notifyPageToolBarExpand:function(){var d=this;this._modelEvents.publish({event:d.EVT_LIBRARY_PAGETOOLBAR_EXPAND})},onPageToolBarExpand:function(e){if(!UWA.is(e,"function")){throw new Error("input parameter should be function")}var d=this;this._modelEvents.subscribe({event:d.EVT_LIBRARY_PAGETOOLBAR_EXPAND},e)},notifyPageToolBarExpanded:function(){var d=this;this._modelEvents.publish({event:d.EVT_LIBRARY_PAGETOOLBAR_EXPANDED})},onPageToolBarCollapse:function(e){if(!UWA.is(e,"function")){throw new Error("input parameter should be function")}var d=this;this._modelEvents.subscribe({event:d.EVT_LIBRARY_PAGETOOLBAR_COLLAPSE},e)},notifyPageToolBarCollapse:function(){var d=this;this._modelEvents.publish({event:d.EVT_LIBRARY_PAGETOOLBAR_COLLAPSED})},notifyInfoExpand:function(){var d=this;this._modelEvents.publish({event:d.EVT_LIBRARY_PAGEINFO_EXPAND})},onInfoExpand:function(e){if(!UWA.is(e,"function")){throw new Error("input parameter should be function")}var d=this;this._modelEvents.subscribe({event:d.EVT_LIBRARY_PAGEINFO_EXPAND},e)},notifyInfoExpanded:function(){var d=this;this._modelEvents.publish({event:d.EVT_LIBRARY_PAGEINFO_EXPANDED})},notifyInfoCollapse:function(){var d=this;this._modelEvents.publish({event:d.EVT_LIBRARY_PAGEINFO_COLLAPSE})},onInfoCollapse:function(e){if(!UWA.is(e,"function")){throw new Error("input parameter should be function")}var d=this;this._modelEvents.subscribe({event:d.EVT_LIBRARY_PAGEINFO_COLLAPSE},e)},notifyInfoCollapsed:function(){var d=this;this._modelEvents.publish({event:d.EVT_LIBRARY_PAGEINFO_COLLAPSED})}});return a});define("DS/LibraryEditor/service/LibraryCommunication",["DS/WidgetServices/WidgetServices"],function(b){var a={publish:function(c,e){var d=JSON.stringify(e);dscef.sendString(c+"="+d)}};if(b.isNatifEnvironnement()&&!b.isWebInWinEnvironment()){return{publish:a.publish.bind(a)}}else{return{}}});define("DS/LibraryEditor/utils/Library_Clipboard",["UWA/Class"],function(b){var a=b.singleton({name:"library_clipboard",_currentLibrary:null,_currentSelectedNodes:null,_Mode:null,_IsEmpty:true,_IsExternalDrop:true,init:function(c){this._parent(c);var d=this},getSelectedNodes:function(){return this._currentSelectedNodes},SetAsExternalDrop:function(c){this._IsExternalDrop=c},IsExternalDrop:function(){return this._IsExternalDrop},});return a});define("DS/LibraryEditor/utils/LibraryWebInWinTaggerProxy",["DS/SNResultUX/webinwin/WebInWinTaggerProxy","UWA/Core","DS/Core/ModelEvents"],function(c,d,a){var b=c.extend(a,{init:function(e){e.proxyId=e.widgetId+"LibraryEditor_WebInWin";this._parent.call(this,e)},_dispatchEvent:function(f){if(!d.is(f,"object")||!d.is(f.notif_name)||undefined===f.notif_parameters){console.log("E_INVALIDARG, expect to have parameters.notif_name arg & parameters.notif_parameters in _dispathTowin !!!");throw ("No parameters.notif_name arg & parameters.notif_parameters given to _dispathTowin method !")}console.log("ResultWebInWin._dispathTowin for "+f.notif_name);var e=d.is(f.notif_parameters,"string")?f.notif_parameters:JSON.stringify(f.notif_parameters);if(typeof dscef!=="undefined"){dscef.sendString(f.notif_name+"="+e)}}});return b});define("DS/LibraryEditor/commands/ActionBar_ExpandNCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(c,a){var b=a.extend({labelTopBar:c.i18n("Expand N levels"),isInsert:true,datas:{},init:function(d){this._parent(d,{mode:"exclusive",isAsynchronous:false});require(["DS/LibraryEditor/utils/LibraryAlert","DS/PADUtils/views/PADLevelSelector","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol"],function(g,f,j,i,h){})},beginExecute:function(){},execute:function(){var e=require("DS/LibraryEditor/utils/LibraryAlert");var j=require("DS/PADUtils/views/PADLevelSelector");var f=require("DS/LibraryEditor/utils/Library_CSO");var i=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor");var h=require("DS/LibraryEditor/utils/LibraryEditorcontrol");var d=h.getContent().getView().getSelectedNodes();var g=null;g=f.getCurrentLibrary();if(d.length){new j({css_style:"",events:{onApply:function(k){d.forEach(function(l){if(l.options.children===null){}else{l.expandNLevels({numberOfLevelsToExpand:k})}})}}})}else{if(g===null){e.displayNotification({message:i.msg_warning_noselection,className:"warning"})}else{new j({css_style:"",events:{onApply:function(k){g.expandNLevels({numberOfLevelsToExpand:k})}}})}}},endExecute:function(){}});return b});define("DS/LibraryEditor/utils/FilterUtils",["UWA/Class"],function(a){var b=a.singleton({init:function(c){this.libraryFilter='flattenedtaxonomies:"types/General Library"';this.classFilter=["General Class"];this.classTreeFilter='flattenedtaxonomies:"types/General Class"';this.endItemFilter=null;this.excludeBOTypesFromContentView=["Document Family","Part Family"]},setFilters:function(f){var l;for(var g=0;g<f.length;g++){var k=null;var m;var n;var c=null;try{k=f[g];m=k.values;if(m&&m.length>0){for(var d=0;d<m.length;d++){if(c&&c!=null){c=c+' OR "'+m[d]+'"'}else{c='"'+m[d]+'"'}}n="("+k.name+": ("+c+"))";if(l){l=l+" AND "+n}else{l=n}}}catch(h){console.warn("Failed to decode","",f[g],h)}}this.endItemFilter=l},resetLibraryFilter:function(){this.libraryFilter=null},resetClassFilter:function(){this.classFilter=null},resetEndItemFilter:function(){this.endItemFilter=null}});return b});define("DS/LibraryEditor/service/LibraryTypeService",["UWA/Controls/Abstract","text!DS/PADUtils/assets/PADOpenCommandsSettings.json"],function(c,b){var a=c.singleton({TYPE_ROOT_LIBRARY_1:"General Library",TYPE_ROOT_LIBRARY_2:"Part Library",TYPE_ROOT_LIBRARY_3:"RootLibrary",TYPE_LIBRARY_1:"General Class",TYPE_LIBRARY_2:"Library",TYPE_LIBRARIES_SECTION:"LibrarySection_AllLibraries",TYPE_FAVORITES_SECTION:"LibrarySection_favorite",openTypes:[],getOpenAvailableForTypes:function(d){if(this.openTypes.length==0&&d){var e=JSON.parse(b);if(e["openInCAD_"+d+"_supported_types"]){this.openTypes=e["openInCAD_"+d+"_supported_types"]}}return this.openTypes},init:function(){},isRootLibrary:function(d){return(d===this.TYPE_ROOT_LIBRARY_1||d===this.TYPE_ROOT_LIBRARY_2||d===this.TYPE_ROOT_LIBRARY_3)},isLibrary:function(d){return d===this.TYPE_LIBRARY_1||d===this.TYPE_LIBRARY_2},inFamilyLibrary:function(d){return(this.isRootLibrary(d)||this.isLibrary(d))},isSection:function(d){return(d===this.TYPE_LIBRARIES_SECTION||d===this.TYPE_FAVORITES_SECTION)}});return a});define("DS/LibraryEditor/utils/LibraryEditorcontrol",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","UWA/Controls/Abstract"],function(b,c){var a=c.singleton({_Content:null,_TreeCont:null,_IdCardCont:null,_isDebugMode:false,init:function(){this.isCustomizedEnv()},getContent:function(){return this._Content},getTreeCont:function(){return this._TreeCont},getIdCardCont:function(){return this._IdCardCont},setContent:function(d){this._Content=d},setTreeCont:function(d){this._TreeCont=d},setIdCardCont:function(d){this._IdCardCont=d},isDebugMode:function(){return this._isDebugMode},setDebugMode:function(d){this._isDebugMode=d},isCustomizedEnv:function(){var d=this;if(d._isCustomizedEnv===undefined){d._isCustomizedEnv=false;b.getGrantedRoles(function(f){for(var e=0;e<f.length;e++){if(f[e]&&f[e].id==="InternalDS"||f[e].id==="PAR"){d._isCustomizedEnv=true;break}}})}return d._isCustomizedEnv},getActiveLibrary:function(){return{id:this._activeLibraryId!==undefined?this._activeLibraryId:null,label:this._activeLibraryLabel,sc:this._activeLibrarySc,disabledId:this._activeLibraryDisabledId}},setActiveLibrary:function(g,e,f,d){this._activeLibraryId=g;this._activeLibraryLabel=e;this._activeLibrarySc=f;this._activeLibraryDisabledId=d}});return a});define("DS/LibraryEditor/LibraryWebInWin",["UWA/Widget","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompass/Data","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADContext","UWA/Drivers/Alone"],function(c,e,b,a,d){var g=window.library.params;window.widget=new c();console.log("G88 inside LibraryWebInWin");widget.body=UWA.createElement("div",{"class":"libraryEditor",styles:{height:"100%",width:"100%"}});b.initialize({myAppsBaseUrl:g.myAppsUrl,userId:g.userId,passportUrl:"",proxyTicketUrl:""});document.body.innerHTML="";widget.body.inject(document.body,"top");window.top.performance.mark("createWidget_begin");var f=new LibraryEditor({widget:widget,filter:window.library.filter,defaultSelectionPath:g.defaultSelectionPath,contextID:g.contextID});widget.dispatchEvent("onLoad");widget.dispatchEvent("onRefresh");widget.dispatchEvent("onDestroy");widget.dispatchEvent("onResize");return f});define("DS/LibraryEditor/utils/LibraryConfirmation",["UWA/Class","DS/ENOFloatingPanel/ENOFloatingPanel","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/UIKIT/Input/Button"],function(c,b,d,a){var e=c.singleton({name:"Library Confirmation",confirmModal:null,launch:function(o,n,m){var f=o.title;var i=o.content;var k=this;var j=i||"Are you sure?";var g=document.createElement("div");var l=new a({value:d.confirmation_ok,className:"primary"}).inject(g);var h=new a({value:d.confirmation_cancel}).inject(g);h.addEvent("onClick",function(p){k.confirmModal._close()});l.addEvent("onClick",function(p){n&&n(p);k.confirmModal._close()});k.confirmModal=new b({className:"command_dialog move",title:f,footer:g,body:j,overlay:true,closable:true,animate:true,resizable:false,autocenter:true,visible:true,events:{onClose:function(){m&&m(event);this.destroy()}},limitParent:true});k.confirmModal.inject(widget.body)},});return e});define("DS/LibraryEditor/utils/LibrarySearch",["UWA/Class","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","text!DS/LibraryEditor/assets/library_exclude_columns.json"],function(d,c,e){var a={tree:"ds6w:label"};var b=d.singleton({init:function(f){this._parent(f);this._predicateToHeaderMap=null;this._dynamicHeaderMap=[];this._currentSearch=null;this._searchInfo=null;this._indexInfo=null;this._lListener=[];this._lListenerResult=[];this._refine=null;this._originLibrary=null;this._previousViewCommand=null;this._defaultPredicates=["ds6w:label","physicalid","mxid",];this._authPersonAttributes=["ds6w:reservedby","ds6w:responsible"];var h=this._defaultPredicates;var g=["icon","thumbnail_2d"];this._searchInfo={with_indexing_date:true,select_predicate:h,select_file:g,order_field:"ds6w:modified",order_by:"desc",nresults:25}},setPreviousView:function(f){this._previousViewCommand=f},getPreviousView:function(){return this._previousViewCommand},setPredicates:function(f){var h=this;this._searchInfo.select_predicate=this._defaultPredicates;var g=JSON.parse(e);if(g){g=g.columnToExclude}if(Array.isArray(f)){f.forEach(function(i){if(h._searchInfo.select_predicate.indexOf(i.toLowerCase())===-1&&g.indexOf(i)===-1){h._searchInfo.select_predicate.push(i)}})}},onSearchChange:function(f){if(typeof f==="function"){this._lListener.push(f)}},onSearchResult:function(f){if(typeof f==="function"){this._lListenerResult.push(f)}},_notifyChange:function(f){if(this.isSearchActive()||f){var g=this;if(!f){f=g._currentSearch}this._lListener.forEach(function(h){h.call(null,g._currentSearch)})}},getPersonPredicatesForAuth:function(){return this._authPersonAttributes},changeSortField:function(i,g){var h=this._getDS6WFromColumnIndex(i);var f=this._getColumnPredicate(h);if(f&&f.startsWith("ds6w")){if(this._searchInfo.order_field!==f){this._searchInfo.order_field=f;this.setInfoIndex(null,false)}if(g){this._notifyChange()}}else{return{message:c.get("msg_info_SortNonAvailable"),className:"primary"}}},changeOrderSort:function(f,g){if(f!=null&&this._searchInfo.order_by!=f){this._searchInfo.order_by=f;this.setInfoIndex(null,false)}if(g){this._notifyChange()}},setAttrNameToPredMapping:function(f){if(!this._attrNameToPredMapping){this._attrNameToPredMapping={}}if(this._attrNameToPredMapping&&f){this._attrNameToPredMapping[f.key]=f.value}},getAttrNameToPredMapping:function(){if(!this._attrNameToPredMapping){this._attrNameToPredMapping={}}return this._attrNameToPredMapping},resetAttrNameToPredMapping:function(){this._attrNameToPredMapping=null},changeSearch:function(h,g){if(h===""){h=null}if(this._currentSearch!==h||!h){this.setInfoIndex(null,!h);var f=this._currentSearch;this._currentSearch=h;this._notifyChange(f)}},columnIsAvailable:function(f){return this._getColumnPredicate(f)!=null},_getColumnPredicate:function(g){var f=this._getDS6WFromColumnIndex(g);var h=this.getSearchInfo().select_predicate.indexOf(f)>=0?f:null;h=!h&&this.getSearchInfo().select_predicate.indexOf(f.toLowerCase())>=0?f.toLowerCase():h;return h},_getDS6WFromColumnIndex:function(g){var f=a[g];if(!f){f=g}return f},getSearchInfo:function(){return this._searchInfo},setInfoIndex:function(h,f){var g=this;this._indexInfo=h;if(f!==false){this._lListenerResult.forEach(function(i){i.call(g,h)})}},getOrderFieldForTree:function(){var g=this.getOrderField();for(var f in a){if(a[f]===g){g=f}}return g},getOrderField:function(){return this.getSearchInfo()?this.getSearchInfo().order_field:null},getOrderBy:function(){return this.getSearchInfo()?this.getSearchInfo().order_by:null},getInfoIndex:function(){return this._indexInfo},getNumberLastResult:function(){return this._indexInfo?this._indexInfo.nresults:0},getNumberHits:function(){return this._indexInfo?this._indexInfo.nhits:0},getDateLastIndexation:function(){var f=null;var g=this.getInfoIndex();if(g&&g.sources){var h=null;g.sources.forEach(function(k){if(k.indexingDate){var i=k.indexingDate}for(var j in i){if(i[j]&&i[j]!==-1){if(!h){h=i[j]}else{if(i[j]<h){h=i[j]}}}}});if(h){f=new Date(h*1000)}}return f},setRefine:function(f){var g=this.getRefine();if(JSON.stringify(g)!==JSON.stringify(f)){this._searchInfo.refine=f;this.setInfoIndex(null,false);this._notifyChange()}},getRefine:function(){return this._searchInfo.refine},clearRefine:function(){delete this._searchInfo.refine},isSearchActive:function(){return this.getSearchValue()?true:false},isSearchInProgress:function(){return this._indexInfo&&this._currentSearch},getSearchValue:function(){return this._currentSearch},getOriginLibrary:function(){return this._originLibrary},setOriginLibrary:function(f){this._originLibrary=f},clearSearch:function(){this.changeSearch("",true)},initPredicateToHeaderMap:function(j){this._predicateToHeaderMap=[];for(var g=0;g<j.length;g++){var h=j[g];var k=h.text?h.text.toLowerCase():null;if(k&&h.xnav_options&&h.xnav_options.name){var f={header:k,predicate:h.xnav_options.name};this._predicateToHeaderMap.push(f)}}},addToDynamicHeaderMap:function(g){var h=g.text?g.text.toLowerCase():null;if(h&&g.predicate){var f={toolTip:g.text,header:h,dataIndex:g.dataIndex,predicate:g.predicate};this._dynamicHeaderMap.push(f)}},resetDynamicHeaderMap:function(){this._dynamicHeaderMap=[]},getDynamicHeaderMap:function(){return this._dynamicHeaderMap},convertSearchQueryToFederated:function(l){var k=l.split("");var g="";var f="";for(var j=0;j<k.length;j++){g=g+k[j];if(k[j]==":"||k[j]=="="||k[j]==">"||k[j]=="<"){f=f.concat(this.replaceHeader(g));var m=l.substring(j+1).trim();if(m.startsWith("=")){f=f.concat("=");m=m.substring(1).trim()}if(m.startsWith('"')){f=f.concat('"');m=m.substring(1);var h=m.indexOf('"');f=f.concat(m.substring(0,h+1));m=m.substring(h+1)}else{if(m.startsWith("(")){f=f.concat("(");m=m.substring(1);var h=m.indexOf(")");f=f.concat(m.substring(0,h+1));m=m.substring(h+1)}}var h=m.indexOf(" ");if(h!=-1){f=f.concat(m.substring(0,h+1));m=m.substring(h+1);f=f.concat(this.convertSearchQueryToFederated(m))}else{f=f.concat(m)}break}}if(f===""){return l}return f},replaceHeader:function(k){var h=k;var g=this._predicateToHeaderMap;g=g.concat(this._dynamicHeaderMap);for(var i=0;i<g.length;i++){var l=g[i].header;var f=g[i].predicate;var j=k.toLowerCase().indexOf(l);if(j!=-1){h="";h=h.concat(k.substring(0,j));h=h.concat("["+f+"]");h=h.concat(k.substring(j+l.length));break}}return h}});return b});define("DS/LibraryEditor/service/LibraryEditorWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/LibraryEditor/utils/LibrarySearch","DS/LibraryEditor/utils/FilterUtils"],function(g,h,d,f,e,a,c){function i(j){return UWA.is(j,"array")?j.toString():j}var b={_pageCount:50,content:function(k){var o=this;var q={};UWA.extend(q,k);var j=c.endItemFilter;var m=false;if(j&&j!=null){if(q.selectedType=="Library"){m=true}j=" AND "+j}else{j=""}var p="";if(q.searchQuery){if(k.isExactSearch){p=a.convertSearchQueryToFederated(k.searchQuery);p="classification: "+k.mxid+j+" AND ("+p+")"}else{p="*"+k.searchQuery+"* classification: "+k.mxid+j}}else{if(m){p='flattenedtaxonomies:"types/General Class" OR ('+c.endItemFilter+")";q.isExpand=true}else{var n=c.excludeBOTypesFromContentView;p=l(p,n,true);q.isExpand=true}}if(q.selectedType=="Library"){q.dynamicattrs=q.dynamicattributes}q.searchPageCount=this._pageCount;this._performSearchQuery(q,p,"content");function l(w,u,t){if(u&&u.length>0){var s="";if(t===true){s="NOT"}for(var r=0,v=u.length;r<v;++r){if(w){w=w+" AND "+s+'(type == "'+u[r]+'" )'}else{w=s+'( type == "'+u[r]+'" )'}}}return w}},roots:function(j){var k='flattenedtaxonomies:"types/Libraries"';var l=c.libraryFilter;if(l&&l!=null){k=l}if(j.fetchAll!==true){j.searchPageCount=this._pageCount}this._performSearchQuery(j,k,"roots")},favourites:function(j){this._performFetchQuery(j,"favourites")},libraries:function(k){var l={};UWA.extend(l,k);l.expand_iter="1";if(k.isExpandAll){l.expand_iter="-1"}var j=c.classTreeFilter;l.filter=j;this._performExpandQuery(l,"libraries")},addcontent:function(k){var m=k;if(!UWA.is(m,"object")){throw new Error("Invalid inputs for LibraryEditorWebService.addcontent")}var n=e.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+m.pid+"/addItems";m.headers={"content-type":"application/json"};if(m.IDs){var l=m.IDs;var j=[];l.forEach(function(o){j.push({id:o})});m.data={objectId:j};m.data=UWA.Json.encode(m.data)}m.method="POST";m.timeout=120000;this._executeRequest(n,m,"addContent")},removecontent:function(j){var l=j;if(!UWA.is(l,"object")){throw new Error("Invalid inputs for LibraryEditorWebService.removecontent")}var m=e.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+l.pid+"/removeClassifiedItems";l.headers={"content-type":"application/json"};if(l.IDs){var k=[];l.IDs.forEach(function(n){k.push({id:n})});l.data={objectId:k};l.data=UWA.Json.encode(l.data)}l.method="POST";l.timeout=120000;this._executeRequest(m,l,"removeContent")},getLibraryPathLength:function(j){var k="physicalid: "+j.pid;this._performSearchQuery(j,k,"getLibraryPathLength")},getLibraryPath:function(k){var n={};UWA.extend(n,k);var m={};var j=n.depth;for(var l=1;l<=j;l++){m["GET_PARENT_"+l+"_LIBRARY"]=[{id:2,iter:l}]}n.patterns=m;this._performNavigateQuery(n,"getLibraryPath")},getUserPreferences:function(l){var j=l;if(!UWA.is(j,"object")){throw new Error("Invalid inputs for LibraryEditorWebService.getUserPreferences")}var k=e.get3DSpaceUrl()+"/resources/AppsMngt/user/getPreferences";if(j.name){k+="?name="+j.name}j.method="GET";return this._executeRequest(k,j,"getUserPreferences")},saveUserPreferences:function(l){var j=l;if(!UWA.is(j,"object")){throw new Error("Invalid inputs for LibraryEditorWebService.saveUserPreferences")}var k=e.get3DSpaceUrl()+"/resources/AppsMngt/user/preference";j.method="PUT";j.headers={"Content-Type":"application/x-www-form-urlencoded"};j.data={name:l.name,value:l.value};this._executeRequest(k,j,"saveUserPreferences")},_performNavigateQuery:function(u){if(!UWA.is(u,"object")){throw new Error("Invalid inputs for LibraryEditorWebService.content")}var m={};UWA.extend(m,u);var r=f.getSetting("pad_security_ctx");var o=e.get3DSpaceUrl()+"/cvservlet/navigate";o+="?SecurityContext="+r;var s=null;var k=widget.lang?widget.lang:widget.getValue("lang");var t=[];t.push(u.pid);m.payload={};m.payload.input_physical_ids=t;var n=c.classFilter;if(n&&n!=null&&u.selectedType=="RootLibrary"){m.payload.primitives=[{navigate_to_rel:{id:1,filter:{bo_type:n}},navigate_from_rel:{id:2}}]}else{m.payload.primitives=[{navigate_to_rel:{id:1},navigate_from_rel:{id:2}}]}m.payload.patterns=m.patterns;var q=a.getSearchInfo().select_predicate;var p=["flattenedtaxonomies"];q=q.concat(p);if(u.dynamicattrs&&u.dynamicattrs.length>0){var l=q.concat(u.dynamicattrs);m.payload.attributes=l}else{m.payload.attributes=q}m.payload.version=3;var j=new Date();m.payload.label=("LibraryWidgetNavigate_"+j.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");m.method="POST";m.headers={Accept:"application/json","content-type":"application/json","Accept-Language":k,};m.type="json";m.data=UWA.Json.encode(m.payload);s=this._executeRequest(o,m,"searchInLibrary");return s},_performExpandQuery:function(w){if(!UWA.is(w,"object")){throw new Error("Invalid inputs for LibraryEditorWebService.content")}var o={};UWA.extend(o,w);var u=f.getSetting("pad_security_ctx");var r=e.get3DSpaceUrl()+"/cvservlet/expand";r+="?SecurityContext="+u;var v=null;var m=widget.lang?widget.lang:widget.getValue("lang");var j=a.getSearchInfo().select_predicate;var t=["flattenedtaxonomies"];j=j.concat(t);var k=["svg","bi_color"];var s=j.filter(function(x){return(k.indexOf(x)<0)});o.payload={};o.payload.expand_iter=w.expand_iter;if(o.children&&o.children.length>0){var q=[];q.push(w.pid);for(var p=0;p<o.children.length;++p){q.push(o.children[p])}o.payload.multi_root_physicalid=q}else{o.payload.root_physicalid=w.pid}if(o.filter){o.payload["q.iterative_filter_query_bo"]=w.filter}if(w.dynamicattrs&&w.dynamicattrs.length>0){var n=s.concat(w.dynamicattrs);o.payload.select_bo=n}else{o.payload.select_bo=s}o.payload.compute_select_bo=["icon","thumbnail_2d"];var l=new Date();o.payload.label=("LibraryWidgetExpand_"+l.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");o.payload.max_count_path="10000";o.method="POST";o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":m,};o.type="json";o.data=UWA.Json.encode(o.payload);v=this._executeRequest(r,o,"Expand");return v},_performFetchQuery:function(t){if(!UWA.is(t,"object")){throw new Error("Invalid inputs for LibraryEditorWebService.content")}var n={};UWA.extend(n,t);var r=f.getSetting("pad_security_ctx");var o=e.get3DSpaceUrl()+"/cvservlet/fetch/v2";o+="?SecurityContext="+r;var s=null;var m=widget.lang?widget.lang:widget.getValue("lang");var j=a.getSearchInfo().select_predicate;var q=["flattenedtaxonomies"];j=j.concat(q);if(t.dynamicAttrs&&t.dynamicAttrs.length>0){j=j.concat(t.dynamicAttrs)}var k=["svg","bi_color"];var p=j.filter(function(u){return(k.indexOf(u)<0)});n.payload={};n.payload.physicalid=n.ids;n.payload.select_predicate=p;if(t.isAuthoringMode===true){o=e.get3DSpaceUrl()+"/resources/IPClassificationReuse/classifiedItem/getContentDetails";n.payload.person_predicate=a.getPersonPredicatesForAuth();n.payload.compute_select_bo=["icon","thumbnail_2d"]}var l=new Date();n.payload.label=("LibraryWidgetFetch_"+l.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");n.method="POST";n.headers={Accept:"application/json","content-type":"application/json","Accept-Language":m,};n.type="json";n.data=UWA.Json.encode(n.payload);s=this._executeRequest(o,n,"Fetch");return s},_performSearchQuery:function(t,p){if(!UWA.is(t,"object")){throw new Error("Invalid inputs for LibraryEditorWebService.content")}var n={};UWA.extend(n,t);var s=null;var o=e.get3DSearchUrl()+"/search";var l=widget.lang?widget.lang:widget.getValue("lang");n.payload=Object.assign({},a.getSearchInfo());var q=n.payload.select_predicate;var k=["flattenedtaxonomies"];if(t.isAuthoringMode===true){o=e.get3DSpaceUrl()+"/resources/IPClassificationReuse/search/InContext";n.payload.person_predicate=a.getPersonPredicatesForAuth();n.payload.root_physicalid=t.pid}else{k.push("classification")}q=q.concat(k);if(t.dynamicattributes&&t.dynamicattributes.length>0){q=q.concat(t.dynamicattributes)}n.payload.select_predicate=q;var j=new Date();var r=Math.random();r.toString(36);var m=r.toString(36).substr(2,9);n.payload.label=("LibraryWidgetSearch_"+m+"_"+j.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");n.payload.locale=l;n.payload.query=p;n.payload.tenant=e.getTenantId();n.payload.next_start=t.next_start;n.payload.start=t.start;n.method="POST";n.headers={Accept:"application/json","content-type":"application/json","Accept-Language":l,};n.type="json";if(t.order_field){n.payload.order_field=t.order_field;n.payload.order_by=t.order_by}if(t.searchPageCount){n.payload.nresults=t.searchPageCount}if(t.fetchAll===true){n.payload.nresults=undefined}if(t.isExpand){n.payload.source=["3dspace"];n.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:t.pid,expand_iter:"1",type_filter_rel:["Subclass","Classified Item","Reference Document"]}}}}}if(t.filters){n.payload.refine=t.filters}n.data=UWA.Json.encode(n.payload);n.securityContextRequired=false;s=this._executeRequest(o,n,"searchInLibrary");return s},_executeRequest:function(n,m,k){var o=(Math.round(Math.random()*1000)).toString();var p=widget.id+"_"+widget.getTitle()+"_";window.top.performance.mark("libraryRequest_begin"+o);var q={};UWA.extend(q,m);if(!q.payload&&n.indexOf("cvservlet")>-1){q.payload={};var l=new Date();q.payload.label=("LibraryWidgetExecute_"+l.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-")}if(!UWA.is(q.onTimeout,"function")){q.onTimeout=function(){var r={type:"timeout",toString:function(){return d.msg_InfoAction_Timeout}};q.onFailure(r)};q.onComplete=function(s){window.top.performance.mark("libraryRequest_end"+o);var r=window.top.performance.getEntriesByName("libraryRequest_begin"+o);if(r&&r.length===1){window.top.performance.measure(p+"_Request"+k,"libraryRequest_begin"+o,"libraryRequest_end"+o);window.top.performance.clearMarks("libraryRequest_end"+o);window.top.performance.clearMarks("libraryRequest_begin"+o)}m.onComplete(s)}}var j={Accept:"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};if(q.securityContextRequired!==false){j.SecurityContext=f.getSetting("pad_security_ctx")}if(m.headers){q.headers=UWA.extend(j,m.headers)}else{q.headers=j}return h.authenticatedRequest(n,q)},getClassificationAttributes:function(l){var m=this;var j=l;if(!UWA.is(j,"object")){throw new Error("Invalid inputs for LibraryEditorWebService.getClassificationAttributes")}var k=e.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+j.classid+"/getclassificationattributes";j.method="GET";return this._executeRequest(k,j,"getClassificationAttributes")}};return b});define("DS/LibraryEditor/utils/LibraryEditorDataConversion",["DS/WebappsUtils/WebappsUtils","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/PADUtils/XNavSettings","DS/LibraryEditor/utils/LibrarySearch"],function(g,c,f,b,e){function d(i){var j=["CATIA Embedded Component","CATPart","CATProduct","CATProcess","CATDrawing","CATAnalysis","CATShape"];return j.indexOf(i)>=0}var h=function(j){var l=j.toLowerCase();var i=null;if(b.getAvailableColumns()){i=b.getAvailableColumns().available_columns}var k=null;if(Array.isArray(i)){i.every(function(m){if(l==m.toLowerCase()){k=m}return k===null})}k=k?k:j;return k};var a={convertToExaleadDataFormatFederated:function(j){var n={};n.children=null;var i=j.attributes;var l=e.getAttrNameToPredMapping();var m={"ds6w:type":"type","ds6w:label":"label"};var k={};i.forEach(function(t){if(t.name=="resourceid"||t.name=="physicalid"){n.physicalid=t.value;n.resourceid=t.value}else{if(t.name=="mxid"){n.mxid=t.value}else{if(t.name==="type_icon_url"){n.icons=[t.value]}else{if(t.name==="preview_url"){n.thumbnail=t.value}else{if(t.name.startsWith("ds6w")){var s=t.name.split("/");var q=s[s.length-1];if(q==="ds6w:type"&&d(t.value)){n.children=[]}else{if(q==="ds6w:created"){n.created=t.value}}var u=t.object?t.object:t.value;u=u?u:t.dispValue;if(l[q]){if(k[q]){u=[u];var o=k[q];if(!Array.isArray(o)){o=[o]}u=u.concat(o)}q=l[q]}k[q]=u;k[t.name]=u;var p=m[q];if(p){n[p]=u}}else{var r=k[h(t.name)];if(r){if(Array.isArray(r)){r.push(t.value)}else{var v=[r,t.value];k[h(t.name)]=v}}else{k[h(t.name)]=t.value}}}}}}});if(!j.id){j.id=n.resourceid}n.grid=k;n.padgrid={"ds6w:leaf":"False","ds6w:root":"True"};return n},convertExpandToSearchFormat:function(i,k){var j=[];var l=["General Class"];k.forEach(function(m){var n=false;if(m.attributes){m.attributes.forEach(function(o){if(o.name==="physicalid"&&o.value!=i){n=true}})}if(n){j.push(m)}});return j},convertNavigateToSearchFormat:function(k){var j=[];var i=k[0]["outputs"]["GET_CONTENT"];if(i){i.forEach(function(m){var l=[];for(var n in m){l.push({name:n,value:m[n]})}j.push({attributes:l})})}return j},convertNavigateToFlatFormat:function(l,m){var s=[];if(m.length<=0){return s}var o=m[0];var n=o.input_object;var r=o.outputs;var j=l;for(var k=j,i=0;k>0;k--){var p="GET_PARENT_"+k+"_LIBRARY";var q=r[p];if(q){q=q[0];q.level=i++;s.push(q)}}s.push(n);return s},getLibraryDepth:function(j){var k=j.results[0].attributes;var i=[];k.forEach(function(l){if(l.name==="classification"){i.push(l.value)}});return i.length+1},getPathsAndObjectsFromExpand:function(D){if(!D||D.length<=0){return}var F=[],k={},v={};var C={};for(var I=0,y=D.length;I<y;++I){var J=D[I];if(J.attributes){var q=true,t,K;for(var H=0,u=J.attributes.length;H<u;++H){if(J.attributes[H].name==="physicalid"){q=false;K=J.attributes[H].value;break}else{if(J.attributes[H].name==="did"){t=J.attributes[H].value}}}if(!q){k[K]=J;v[t]=K}}else{if(J.path){F.push(J.path)}else{if(J.icon__default_thumbnail_2d){for(var G=0;G<J.icon__default_thumbnail_2d.length;G++){var B=J.icon__default_thumbnail_2d[G].did;for(var E=0;E<B.length;E++){var w=[];w.push(J.icon__default_thumbnail_2d[G].icon);w.push(J.icon__default_thumbnail_2d[G].thumbnail_2d);C[B[E]]=w}}}}}}for(var A in k){var r=k[A];var s;for(var z=0;z<r.attributes.length;z++){if(r.attributes[z].name==="did"){s=r.attributes[z].value;r.attributes.push({name:"icons",value:C[s]});break}}}var x=[];for(var I=0;I<F.length;++I){var o=F[I];var l=[];for(var H=0;H<o.length;H+=2){l.push(v[o[H]])}x.push(l)}return{paths:x,objects:k}},getPlmTypeFromContentDetails:function(m){if(!m||m.length<1){return}var l="Content";for(var k=0,j=m.length;k<j;++k){if(m[k].name==="flattenedtaxonomies"){if(k+1<j&&m[k].value==="types/Classification"&&m[k+1].value==="types/General Class"){l="Library"}else{if(k+1<j&&m[k].value==="types/Libraries"&&m[k+1].value==="types/General Library"){l="RootLibrary"}else{if(m[k].value[0]==="types/Classification"&&m[k].value[1]==="types/General Class"){l="Library"}else{if(m[k].value[0]==="types/Libraries"&&m[k].value[1]==="types/General Library"){l="RootLibrary"}}}}break}}return l}};return a});define("DS/LibraryEditor/utils/Library_CSO",["DS/Selection/XSO","DS/Logger/Logger","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/utils/LibraryEditorEvents","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/PADUtils/PADProbes"],function(h,b,j,a,c,f,d){var e="LIBRARY_CSO/SELECT";var i=function(m){var k="";if(m){var l=m.plmType;if(l=="Library"){k="General Class"}else{if(l=="RootLibrary"){k="General Library"}else{k=l}}}return k};var g=h.singleton({name:"library_cso",_logger:null,_currentLibrary:null,init:function(k){var m={areEquals:function(o,n){return o===n}};UWA.extend(m,k);this._parent(m);this._logger=b.getLogger(g);var l=this;this.onPostAdd(function(n){var o="CONTENT";if(UWA.is(n,"array")){n=n[0]}if(n&&UWA.is(n.getID,"function")&&n.getID()==l.getCurrentLibraryID()){o="TREE"}if(UWA.is(n)){l._modelEvents.publish({event:e,data:{context:o,selectedNode:n}})}})},addInLibraryCSO:function(q,l){if(!UWA.is(q)){throw new Error("No libraryNode specified")}if(!UWA.is(l)){throw new Error("No context specified")}var u=d.createProbe("library_addInLibraryCSO");l=l.toUpperCase();if(l=="TREE"){var s=this;this.empty(false);var o=this._currentLibrary;this._currentLibrary=q;var r=function(w,v){c.notifyCurrentLibraryChange({previousNode:w,currentNode:v});s.add(v);u.end()};this._currentLibraryPath=[{id:q.id,type:i(q),label:q.getLabel(),mxid:q.options.mxid}];var p=false;if(j.inFamilyLibrary(q.plmType)){if(q.isVisible&&q.isVisible()&&q.getPath){var k=q.getPath();if(Array.isArray(k)&&k.length>=2&&k[0]&&k[0].plmType==="LibrarySection_AllLibraries"){this._currentLibraryPath=[];for(var n=1;n<k.length;n++){var t=k[n];this._currentLibraryPath.push({id:t.id,type:i(t),label:t.getLabel()})}p=true}}}else{p=true}if(p){r(o,q)}else{a.getLibraryPathLength({pid:q.id,onComplete:function(y){if(!y.results&&y.error){s._logger.warn("Unable to retrieve LibraryPath using Index/Search");r(o,s._currentLibrary)}var w=f.getLibraryDepth(y);if(w===1){var x={};x.id=q.id;x.type=q.plmType;x.label=q.options.label;if(s._currentLibrary&&x.id==s._currentLibrary.id){s._currentLibraryPath=[];s._currentLibraryPath.push({id:x.id,type:x.type,label:x.label,});r(o,s._currentLibrary)}else{s._logger.log("LibraryPath returned by Index do not corresponds to the current Library")}}else{if(w>1){var v=w-1;a.getLibraryPath({depth:v,pid:q.id,onComplete:function(A){var z=f.convertNavigateToFlatFormat(v,A.result);if(s._currentLibrary&&z[w-1].physicalid==s._currentLibrary.id){s._currentLibraryPath=[];z.forEach(function(B){s._currentLibraryPath.push({id:B.physicalid,type:B["ds6w:type"],label:B["ds6w:label"],})});r(o,s._currentLibrary)}},onFailure:function(z){s._logger.warn("Unable to retrieve LibraryPath using Index/Navigate");r(o,s._currentLibrary)},})}}},onFailure:function(v){s._logger.warn("Unable to retrieve LibraryPathLength using Index/Search");r(o,s._currentLibrary)}})}}else{this.empty(false);var m=null;if(UWA.typeOf(q)=="array"){m=q}else{m=[q]}if(m.length===0){this.add(this._currentLibrary);u.end()}else{this.add(m);u.end()}}},removeFromLibraryCSO:function(k){if(!UWA.is(k)){throw new Error("No libraryNode specified")}this.remove(k);if(this.getSelectedNodes().length===0&&k!=this._currentLibrary){this.add(this._currentLibrary)}},removeAllFromLibraryCSO:function(){this.empty(true)},getCurrentLibrary:function(){return this._currentLibrary},updateLabelCurrentLibraryPath:function(){if(this._currentLibraryPath){var k=this._currentLibraryPath.length;var l=this._currentLibrary.getLabel();if(this._currentLibraryPath[k-1].label!==l){this._currentLibraryPath[k-1].label=l}}},getCurrentLibraryID:function(){var k=null;if(this._currentLibrary&&this._currentLibrary.getID){k=this._currentLibrary.getID()}return k},getCurrentLibraryPath:function(){var k=[];if(this._currentLibraryPath){this._currentLibraryPath.forEach(function(l){k.push({id:l.id,type:l.type,label:l.label})})}return k},getSelectedNodes:function(){var k=[];if(this.get()){this.get().forEach(function(l){k.push(l)})}return k},getSelectedNodesID:function(){var k=[];if(this.get()){this.get().forEach(function(l){k.push(l.getID())})}return k},onLibrarySelected:function(k){return this._modelEvents.subscribe({event:e},k)}});return g});define("DS/LibraryEditor/commands/ActionBar_AddToFavoritesCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService"],function(g,f,b,e,c,a){var d=f.extend({labelTopBar:e.label_ActionBar_AddToFavorites,isInsert:true,datas:{},init:function(h){this._parent(h,{});var i=this;b.onChange(function(){i._adaptStateToCurrentLibrary()});this.onStateChange(function(){if(!i.getState()){var n=b.getCurrentLibrary();if(n){var m=n.getID();var o=n.getType();var l=n.options.label;if(m&&a.inFamilyLibrary(o)){if(g.is(c.getTreeCont())){var k=c.getTreeCont().isLibraryAmongFavoriteLibraries(m);if(k==true){var j=c.getTreeCont().removeFavorite({id:m,name:l});if(false===j){i.setState(true,false)}}}}}i.labelTopBar=e.label_ActionBar_AddToFavorites}else{var n=b.getCurrentLibrary();if(n){var m=n.getID();var o=n.getType();var l=n.options.label;if(m&&a.inFamilyLibrary(o)){if(g.is(c.getTreeCont())){var k=c.getTreeCont().isLibraryAmongFavoriteLibraries(m);if(k==false){c.getTreeCont().addFavorite({id:m,name:l})}}}}i.labelTopBar=e.label_ActionBar_RemoveFromFavorites}})},_adaptStateToCurrentLibrary:function(){var j=b.getCurrentLibrary();if(j&&j.getID){var i=j.getID();if(g.is(c.getTreeCont())){var h=c.getTreeCont().isLibraryAmongFavoriteLibraries(i);var k=false;if(h){k=true}this.setState(k,false)}}},});return d});define("DS/LibraryEditor/utils/LibraryEditorUtil",["UWA/Utils","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/LibraryEditorEvents","DS/LibraryEditor/utils/Library_CSO","DS/PADUtils/PADSettingsMgt","DS/PlatformAPI/PlatformAPI","DS/ZipJS/deflate","DS/ZipJS/inflate"],function(g,a,k,e,c,h,b,i,f,j){var d={nameRules:{notAllowedChars:["/",'"',"#","$","@","%","*",",","?","\\","<",">","[","]","|",":"],maxLength:127},jsonZip:function(r){if(r.length>0&&r[0]!=="{"&&r[0]!=="["){return r}var n=new ArrayBuffer(r.length);var l=new Uint8Array(n);for(var o=0;o<r.length;++o){l[o]=r.charCodeAt(o)}var q=new Deflater();q.append(l);var m=q.flush();var p=String.fromCharCode.apply(null,m);return g.base64Encode(p)},jsonUnzip:function(m){if(m.length>0&&(m[0]==="{"||m[0]==="[")){return m}var r=m;try{r=g.base64Decode(m)}catch(p){}var o=new ArrayBuffer(r.length);var l=new Uint8Array(o);for(var n=0;n<r.length;++n){l[n]=r.charCodeAt(n)}var q=new Inflater();var s=q.append(l);q.flush();return String.fromCharCode.apply(null,s)},shouldBeEditable:function(l){return false},onNodeModelUpdate:function(r){var n=r.data.nodeModel;if(!k.inFamilyLibrary(n.plmType)){return}var t=n._lastUpdateTime?n._lastUpdateTime:0;var w=Date.now()-t;n._lastUpdateTime=Date.now();console.log("lastUpdateTime : "+t+", elapsedTime : "+w);if(t!==0&&w<300){return}if(n._resetting){n._resetting=false;return}var s=n.getID();var l=n.options.label;var v=n.options.oldLabel;if(v===undefined){v=""}if(l===v){return}if(l&&l.trim){l=l.trim()}var m=true;if(l.length>d.nameRules.maxLength){e.displayNotification({message:c.replace(c.get("msg_error_name_maxlength"),{name:l,maxLength:d.nameRules.maxLength}),className:"error"});m=false}if(l.trim().length==0){e.displayNotification({message:c.get("msg_error_name_empty"),className:"error"});m=false}var o=d.nameRules.notAllowedChars;for(var p=0;p<o.length;p++){var q=o[p];if(l.indexOf(q)!=-1){e.displayNotification({message:c.replace(c.get("msg_error_name_badchars"),{name:l,badChars:d.nameRules.notAllowedChars.join(", ")}),className:"error"});m=false;break}}if(!m){n.withTransactionUpdate(function(){this.setLabel(v)})}else{if(n.isFavorite){if(UWA.is(h.getTreeCont())){var u={id:s,name:v};h.getTreeCont().renameFavorite(u,l,n)}}}},validateLibraryRename:function(w,t,s){var n=w;var l=t?t:"";var v=s;if(n&&k.inFamilyLibrary(n.plmType)){if(l!==v){if(l&&l.trim){l=l.trim()}var m=true;if(!l||l.length==0){e.displayNotification({message:c.get("msg_error_name_empty"),className:"error"});m=false}if(l.length>d.nameRules.maxLength){e.displayNotification({message:c.replace(c.get("msg_error_name_maxlength"),{name:l,maxLength:d.nameRules.maxLength}),className:"error"});m=false}var o=d.nameRules.notAllowedChars;for(var p=0;p<o.length;p++){var r=o[p];if(l.indexOf(r)!=-1){e.displayNotification({message:c.replace(c.get("msg_error_name_badchars"),{name:l,badChars:d.nameRules.notAllowedChars.join(", ")}),className:"error"});m=false;break}}if(!m){l=v}else{var q=n.getID();if(n.isFavorite){if(UWA.is(h.getTreeCont())){var u={id:q,name:v};h.getTreeCont().renameFavorite(u,l,n);b.notifyLibraryRename({oldNode:u,newLabel:l})}}}}}return l},getCurrentSecurityContextAndLibraryData:function(p){var n=i.getCurrentLibrary();var m=f.getSetting("pad_security_ctx");var o=widget.getValue("pad_tenant");var l={From:"LibraryEditor",LibraryID:null,LibraryType:null,IsInDeletedItems:false,Timestamp:Date.now(),Tenant:o,SecurityContext:m};if(n&&(k.inFamilyLibrary(n.plmType)||p)){l.LibraryID=n.getID();l.LibraryType=n.getType()}if(n&&n.plmType==="LibrarySection_Trash"){l.IsInDeletedItems=true}return l},dipatchSecurityContextAndLibrary:function(){var m=JSON.stringify(this.getCurrentSecurityContextAndLibraryData());j.publish("LibraryEditor.CurrentLibrary",m);if(h.isCustomizedEnv()){var l=h.getActiveLibrary();j.publish("LibraryEditor.ActiveLibrary",{id:l.id!=="!"?l.id:null,label:l.label,sc:l.sc})}},sortTreeColumn:function(o,n){var l=k.inFamilyLibrary(o.plmType);var m=k.inFamilyLibrary(n.plmType);if(l&&!m){if(this.sortOrder==="asc"){return -1}else{return 1}}else{if(!l&&m){if(this.sortOrder==="asc"){return 1}else{return -1}}else{return o.options.label.localeCompare(n.options.label)}}},sortColumn:function(o,n){var l=k.inFamilyLibrary(o.plmType);var m=k.inFamilyLibrary(n.plmType);if(l&&!m){if(this.sortOrder==="asc"){return -1}else{return 1}}else{if(!l&&m){if(this.sortOrder==="asc"){return 1}else{return -1}}else{return 0}}},isTouchDevice:function(){if("ontouchstart" in document.documentElement){return true}else{return false}},isIndexedMode:function(){var l=f.getSetting("useIndexAccleration");if(l===false){return false}else{return true}},};return d});define("DS/LibraryEditor/commands/ActionBar_AddExistingContentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/utils/LibraryEditorUtil"],function(d,a,c){var b=a.extend({labelTopBar:d.i18n("Add Content"),isInsert:true,data:{},_modalChooser:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:false});require(["DS/LibraryEditor/utils/Library_CSO","DS/PADUtils/views/PADModalChooser","DS/LibraryEditor/utils/LibraryAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/service/LibraryServices","DS/PADUtils/PADUtilsServices","DS/UIKIT/Mask"],function(i,h,n,m,l,k,j){});var f=this;widget.addEvent("onRefresh",function(){if(UWA.is(f._modalChooser)){f._modalChooser.close();f._modalChooser=null}})},beginExecute:function(){this._buildCellSkeleton()},execute:function(){var i=this;var g=require("DS/LibraryEditor/utils/Library_CSO");var f=require("DS/PADUtils/views/PADModalChooser");var e=require("DS/LibraryEditor/utils/LibraryAlert");var j=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor");var h="";if(g.getCurrentLibrary()){h=g.getCurrentLibrary().getID()}if(!h.length){e.displayNotification({message:j.msg_warning_nocurrentlibrary,className:"warning"})}else{if(UWA.is(this._modalChooser)){this._modalChooser.close()}setTimeout(function(){i._modalChooser=new f({renderTo:document.body,position:"above_action_bar",in_apps_search:{in_apps_callback:i._objects_selected.bind(i)}})})}},_objects_selected:function(q){var o=require("DS/LibraryEditor/utils/Library_CSO");var j=require("DS/LibraryEditor/utils/LibraryAlert");var h=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor");var m=require("DS/LibraryEditor/utils/LibraryEditorcontrol");var r=require("DS/LibraryEditor/commands/LibraryCommands");var n=require("DS/LibraryEditor/service/LibraryServices");var f=require("DS/UIKIT/Mask");var g=require("DS/PADUtils/PADUtilsServices");var l=[];var k=this;var p=o.getCurrentLibrary();var i=g.getPlatformId();var e=false;q.forEach(function(v){var w=v.resourceid;var u=v.sourceid;var s=null;if(u){var t=u.split(":");if(t.length>0){s=t[1]}}if(!!s&&s!==i){e=true}else{l.push(w)}});if(e===true){j.displayNotification({message:h.msg_warning_addnotsupported_from_different_tenant,className:"warning"})}if(l.length>0){r._startProgressBar(h.AddExisting_content_loading);if(d.is(m.getContent()._contentDiv)){f.mask(m.getContent()._contentDiv)}n.AddContent({IDs:l,callbacks:{onComplete:function(u){r._endProgressBarListener();if(c.isIndexedMode()){j.displayNotification({message:h.replace(h.msg_info_indexedModePresence,{}),className:"warning"})}else{if(d.is(m.getContent())){if(l.length===1){m.getContent().loadContentAndSelect(p,l[0])}else{m.getContent().loadContentAndSelect(p,l)}if(d.is(m.getContent()._contentDiv)){f.unmask(m.getContent()._contentDiv)}}}var t="";var s=l.length;if(u){var v=JSON.parse(u);s=v.added?v.added.length:s;t=v.information?" ("+v.information+")":t}j.displayNotification({message:h.replace(h.msg_info_Addinlibrary,{number:s,libraryname:p.options.label})+t,className:"primary"})},onFailure:function(s){r._offProgressBar();if(d.is(m.getContent()._contentDiv)){f.unmask(m.getContent()._contentDiv)}j.displayNotification({message:s?(h.msg_error_Addinlibrary+"<br>"+s):h.msg_error_Addinlibrary,className:"error"})}}})}},_buildCellSkeleton:function(){var e=require("DS/LibraryEditor/utils/LibraryEditorcontrol");if(!d.is(e.getContent()._libraryContentView.elements.container)){e.getContent().elements.container=d.createElement("span",{"class":"fonticon fonticon-1x fonticon-search",title:"Find in Context"})}},endExecute:function(){},});return b});define("DS/LibraryEditor/commands/LibraryCommands",["DS/LibraryEditor/utils/LibraryAlert","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandsManager","DS/PADUtils/views/PADProgressBar","DS/WidgetServices/WidgetServices"],function(e,h,d,i,g,b,a,f,j){var c={_endProgressBarListener:function(){var k=this;g.getContent().getView().addEvent("onCompleteRefreshNodes",function(l){this.removeEvent("onCompleteRefreshNodes");k._offProgressBar()})},_offProgressBar:function(){if(f._counter===0){return null}f.off()},_commonError:function(m,k,l){console.error(m,l);var n=k;if(UWA.is(l)&&!(l instanceof Error)){n+="<br>"+l}e.displayNotification({message:n,className:"error"})},_startProgressBar:function(k){if(f._counter===1){f.off()}f.on(k)},_nbItemsNotNull:function(n){var m,k=n.length,l=0;for(m=0;m<k;++m){if(n){l++}}return l},RenameCmd:function(o,m){var n=o.virtualRowID;var l=o.manager.getCell(n,"tree");var k=l.getView();k.switchToWriteView()},RemoveContentCmd:function(k,l){var m=a.getCommand("RemoveContent",g.getContent());if(m){m.begin()}},ExpandAllCmd:function(m,n){var l=m.plmType;var k=[];if(n==="TREE"&&m){k.push(m)}else{k=h.getSelectedNodes()}var o=null;o=h.getCurrentLibrary();if(k.length){k.forEach(function(p){if(p.options.children===null){}else{p.expandAll()}})}else{if(o===null){e.displayNotification({message:d.msg_warning_nocurrentlibrary,className:"warning"})}else{o.expandAll()}}},CollapseAllCmd:function(m,n){var l=m.plmType;var k=[];var o=h.getCurrentLibrary();if(n==="TREE"&&m){k.push(m)}else{k=h.getSelectedNodes()}if(k.length){k.forEach(function(p){p.collapseAll()})}else{if(o===null){e.displayNotification({message:d.msg_warning_noselection,className:"warning"})}else{o.collapseAll()}}},EditPropertiesCmd:function(k,l){var m=a.getCommand("ActionBar_Attributes",g.getContent().getView());if(m){m.begin()}},RemoveFavoriteCmd:function(m,o){var l=m;console.log("  RemoveFavoriteCmd currentFavoriteTreeNode : ",l);if(l&&l.isFavorite){var k=l.getID();var n=l.options.label;console.log("  currentLibrary Id : ",k);if(k&&UWA.is(g.getTreeCont())){g.getTreeCont().removeFavorite({id:k,name:n})}}},AddExistingCmd:function(k,l){var m=a.getCommand("AddExistingContent",g.getContent());if(m){m.begin()}},OpenInCADCmd:function(l,m){var k=a.getCommand("OpenInCADHdr",g.getContent());if(k){k.begin()}},GetContextualMenu:function(k,m){var s=this;var y=[];var A;var x=k.white_Click?k.white_Click:false;A=x===true?A=h.getCurrentLibrary():k.nodeModel;if(A===undefined){A=k}var p=A.plmType;var z=A.isFavorite;var r={label:d.CMDRename,icon:"url("+b.getWebappsAssetUrl("LibraryEditor","icons/32/I_RenameLibrary.png")+")",callback:function(){s.RenameCmd(k,m)}};var q={label:d.CMDProperties,icon:"url("+b.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_CATSSEditorDisplayProperties.png")+")",callback:function(){s.EditPropertiesCmd(A,m)}};var B={label:d.CMDExpandAll,icon:"url("+b.getWebappsAssetUrl("ENXNav","icons/32/I_ExpandAll.png")+")",callback:function(){s.ExpandAllCmd(A,m)}};var u={label:d.CMDCollapseAll,icon:"url("+b.getWebappsAssetUrl("ENXNav","icons/32/I_CollapseAll.png")+")",callback:function(){s.CollapseAllCmd(A,m)}};var w={label:d.CMDRemove,icon:"url("+b.getWebappsAssetUrl("LibraryEditor","icons/32/I_RemoveFavorite.png")+")",callback:function(){s.RemoveFavoriteCmd(A,m)}};var t={label:d.CMDSizeColumnToFit,icon:"url("+b.getWebappsAssetUrl("LibraryEditor","icons/32/I_FitToColumn.png")+")",callback:function(){k.manager.sizeColumnToFit(k.dataIndex)}};var l={label:d.CMDAddExistingContent,icon:"url("+b.getWebappsAssetUrl("LibraryEditor","icons/32/I_PLMAddExistingObjectToLibrary.png")+")",callback:function(){s.AddExistingCmd(A,m)}};var o={label:d.CMDRemoveContent,icon:"url("+b.getWebappsAssetUrl("LibraryEditor","icons/32/I_RemoveItem.png")+")",callback:function(){s.RemoveContentCmd(A,m)},nativeAvailability:false};var v={label:d.CMDOpen,icon:"url("+b.getWebappsAssetUrl("PADUtils","icons/32/I_OpenInCAD.png")+")",callback:function(){s.OpenInCADCmd(A,m)},managedTypes:i.getOpenAvailableForTypes(j._getEnvironment()),dashboardAvailability:false,v6Availability:false};if(m==="TREE"){if(z){y.push(r);y.push(w)}else{if(i.isLibrary(p)){y.push(B);y.push(u);y.push(q)}else{if(i.isRootLibrary(p)){y.push(B);y.push(u);y.push(q)}else{if(p==="LibrarySection_AllLibraries"){y.push(B);y.push(u)}else{if(p==="LibrarySection_favorite"){y.push(B);y.push(u)}}}}}}else{if(m==="CONTENT"){if(k.cellView&&typeof k.cellView.getVirtualCoordinates==="function"&&k.cellView.getVirtualCoordinates().virtualRowID===-1){y.push(t)}else{if(x){p=A.plmType;if(p==="Library"){y.push(l)}}else{var n=h.getSelectedNodes();if(n.length==1){p=A.plmType;if(z){if(g.getContent().getView().getActiveView()==="treelistview"){y.push(r)}y.push(w)}else{if(p==="Content"){s._addCtxCmd(m,y,o);s._addCtxCmd(m,y,v);y.push(q)}else{y.push(q)}}}else{if(p==="Content"){s._addCtxCmd(m,y,o);s._addCtxCmd(m,y,v)}y.push(q)}}}}}return y},_checkTypeAvailability:function(l,p){if(p){var n=p.managedTypes;if(n){var q=null;if(l==="TREE"){q=h.getCurrentLibrary();q=q?[q]:[]}else{q=h.getSelectedNodes()}if(q){var o=true;for(var k=0;k<q.length;++k){var m=q[k];o=m.options&&m.options.type?n.indexOf(m.options.type)>-1:false;if(!o){return o}}}}}return true},_addCtxCmd:function(m,k,n){var l=true;if(j.isNatifEnvironnement()){if(n.nativeAvailability==false){l=false}else{if(!j.isWebInWinEnvironment()){if(n.v6Availability==false){l=false}}}}else{if(n.dashboardAvailability==false){l=false}}if(l){l=this._checkTypeAvailability(m,n)}if(l){k.push(n)}},_addHiddenInput:function(l){var k=g.getContent().getView();var m=UWA.createElement("a",{href:l,styles:{display:"hidden"}}).inject(k.elements.container);m.click()}};return c});define("DS/LibraryEditor/commands/ActionBar_RemoveContentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/utils/LibraryEditorUtil","DS/LibraryEditor/commands/LibraryCommands",],function(e,a,d,c){var b=a.extend({labelTopBar:e.i18n("Remove Content"),isInsert:true,datas:{},init:function(f){this._parent(f,{mode:"exclusive",isAsynchronous:false});require(["DS/LibraryEditor/commands/LibraryCommands"],function(g){})},beginExecute:function(){},execute:function(){require(["DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/utils/LibraryConfirmation","DS/LibraryEditor/utils/LibraryAlert","DS/ApplicationFrame/CommandsManager","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/utils/LibraryEditorcontrol","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(h,m,f,i,g,k,l){var j=h.getCurrentLibrary();if(!j){f.displayNotification({message:l.msg_warning_nocurrentlibrary,className:"warning"})}else{m.launch({title:l.confirmation_remove_title,content:l.confirmation_remove_message,},function(){var s=j.getType();var o=h.getSelectedNodes();var r=o.length;if(r>0){c._startProgressBar(l.Remove_content_loading);var p=i.getCommand("RemoveContent",k.getContent());p.disable();var n=[];var q=null;o.forEach(function(t){if(q===null){if(t._expandState!=="noExpandState"&&widget.getBool("filtered-content")===true){q=true}}n.push(e.is(t.id)?t.id:t.options.resourceid)});g.RemoveContent({IDs:n,callbacks:{onComplete:function(u){if(q||n.length>10){k.getContent().RefreshProductStructure=true;k.getContent().loadContentAndSelect(j)}else{if(d.isIndexedMode()){f.displayNotification({message:l.replace(l.msg_info_indexedModePresence,{}),className:"warning"})}else{for(var t=0;t<n.length;t++){var v=n[t];k.getContent()._libraryContentView.removeNodeInContent(v)}}}c._offProgressBar();f.displayNotification({message:l.replace(l.msg_info_objetremoved,{number:n.length,libraryname:j.options.label}),className:"primary"})},onFailure:function(t){c._offProgressBar();p.enable();c._commonError("RemoveContentCmd",l.msg_error_Removefromlibrary,t)}}})}else{f.displayNotification({message:l.msg_warning_nocontent,className:"warning"})}})}})},endExecute:function(){}});return b});define("DS/LibraryEditor/commands/ActionBar_CollapseAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/utils/Library_CSO"],function(e,b,d,a){var c=b.extend({labelTopBar:e.i18n("Collase All"),isInsert:true,datas:{},init:function(f){this._parent(f,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){var g=a.getSelectedNodes();if(g.length){var f=g[0];d.CollapseAllCmd(f,"CONTENT")}else{var h=a.getCurrentLibrary();d.CollapseAllCmd(h,"TREE")}},endExecute:function(){}});return c});define("DS/LibraryEditor/commands/ActionBar_ExpandAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/utils/Library_CSO"],function(e,b,d,a){var c=b.extend({labelTopBar:e.i18n("Expand All"),isInsert:true,datas:{},init:function(f){this._parent(f,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){var g=a.getSelectedNodes();if(g.length){var f=g[0];d.ExpandAllCmd(f,"CONTENT")}else{var h=a.getCurrentLibrary();d.ExpandAllCmd(h,"TREE")}},endExecute:function(){}});return c});define("DS/LibraryEditor/utils/LibraryCommandManager",["DS/ApplicationFrame/CommandsManager","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService"],function(b,c,a){var e=["CreateSnapshotHdr"];var d={enableAllCommands:function(g){var h;var f=b.getCommands();for(h in f){var i=b.getCommand(h,c.getContent().getView());if(UWA.is(i)&&e.indexOf(h)<0){if(g){i.enable()}else{if(h!=="ListSnapshotsHdr"){i.disable()}}}}},enableFavoriteCommands:function(g){var f=b.getCommandCheckHeader("AddToFavorites");if(f&&g){f.enable()}else{if(f){f.disable()}}},ItemSelected:function(l,f,h){function i(p){if(typeof(window.dscef)=="undefined"){if(p){n.push("AddExistingContent")}else{o.push("AddExistingContent")}}}function k(p){if(typeof(window.dscef)=="undefined"){if(p){n.push("RemoveContent")}else{o.push("RemoveContent")}}}var n=[];var o=[];if(f==="TREE"){if(a.inFamilyLibrary(l.plmType)){d.enableAllCommands(true);d.enableFavoriteCommands(true);o.push("SelectSiblings");if(l.plmType==="RootLibrary"){i(false)}}else{if(l.plmType=="LibrarySection_favorite"){d.enableAllCommands(false);d.enableFavoriteCommands(false);n.push("treelistview","tileview","thumbnailview","ExpandAll","ExpandN","CollapseAll","ColumnVisibility","SelectAll","SelectInversion");i(false)}else{if(l.plmType=="LibrarySection_AllLibraries"){d.enableAllCommands(false);d.enableFavoriteCommands(false);n.push("treelistview","tileview","thumbnailview","ExpandAll","ExpandN","CollapseAll","ColumnVisibility","SelectAll","SelectInversion");i(false)}else{d.enableAllCommands(false);d.enableFavoriteCommands(false)}}}k(false)}else{if(f==="CONTENT"){var j=h.plmType;var g=c.getContent().getView().getSelectedNodes();d.enableFavoriteCommands(true);if(a.inFamilyLibrary(j)&&l.plmType==="Busy"){d.enableAllCommands(false)}else{if(a.inFamilyLibrary(j)){d.enableAllCommands(true);o.push("ExpandAll","ExpandN","CollapseAll");if(l.plmType==="RootLibrary"||l.plmType==="Library"){k(false)}}else{if(j=="LibrarySection_AllLibraries"){d.enableAllCommands(true);if(g.length===1){var m=g[0].plmType||g[0].getType()}o.push("ExpandAll","ExpandN","CollapseAll");k(false)}else{if(j=="LibrarySection_favorite"){d.enableAllCommands(false);n.push("treelistview","tileview","thumbnailview","ExpandAll","ExpandN","CollapseAll","SelectAll","SelectInversion","SelectSiblings")}else{d.enableAllCommands(false)}}}}i(false)}}this._switchCommands(n,true);this._switchCommands(o,false)},getCommand:function(f){return b.getCommand(f,c.getContent().getView())},_switchCommands:function(k,j){for(var f=0;f<k.length;++f){var h=this.getCommand(k[f]);try{if(j){h.enable()}else{h.disable()}}catch(g){console.error("Error "+(j?"enabling":"disabling"),k[f],g)}}}};return d});define("DS/LibraryEditor/utils/LibraryEditorKeyboardListener",["UWA/Core","UWA/Class","UWA/Event","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/utils/LibraryCommandManager","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryEditorEvents","DS/Logger/Logger"],function(e,a,g,h,k,f,i,j,d,c){var b=a.extend({name:"LibraryEditorKeyboardListener",init:function(l){var m=this;this._parent(l);this._logger=c.getLogger(b);this._onKeyDown_binded=this._onKeyDown.bind(this)},startObservingKeyboard:function(){e.Element.addEvent.call(document,"keydown",this._onKeyDown_binded)},_onKeyDown:function(m){var r=this;var v=g.whichKey(m);if(m.ODTENVKeyName){v=m.ODTENVKeyName}var s=function(){var x=document.activeElement;if(x&&(x.tagName==="INPUT"||x.tagName==="TEXTAREA")){return true}else{return false}};var l=function(x,z){var y=f.getCommand(z);if(y&&y.isEnabled()){if(!s()){y.begin();g.stop(m)}else{r._logger.log("Info : '"+x+"' key pressed in INPUT field, no command launched")}}else{r._logger.log("Info : '"+x+"' key pressed, but command '"+z+"' is disabled")}};switch(v){case"ctrl+a":l(v,"SelectAll");break;case"alt+return":d.notifyInfoExpand();break;case"ctrl+f":var u=h.getIdCardCont();if(u._isSearchAvailable()){u.switchSearch(true);g.stop(m)}break;case"f2":if(!s()){var p=i.getSelectedNodes();var t=i.getCurrentLibrary();if(t.pathId&&!t.pathId.includes("LibrarySection_favorite")){break}var o=Array.isArray(p)?p.length:0;if(o>=1){var n=p[0];if(n&&j.inFamilyLibrary(n.plmType)){if(t.getID()==n.getID()){var q=h.getTreeCont();if(q&&q.switchLibraryTreeNodeLabelToWriteView){q.switchLibraryTreeNodeLabelToWriteView(t)}}else{var w=h.getContent();if(w&&w.switchLibraryTreeNodeLabelToWriteView){w.switchLibraryTreeNodeLabelToWriteView(n)}}}else{r._logger.log("Info : '"+v+"' key pressed but selected element is not a Library, no command launched")}}else{r._logger.log("Info : '"+v+"' key pressed when no element selected, no command launched")}}else{r._logger.log("Info : '"+v+"' key pressed in INPUT field, no command launched")}break;case"esc":k.escapCmd();break;default:break}},});return b});define("DS/LibraryEditor/ActionBar/LibraryActionBar",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Class/Options","DS/Logger/Logger","DS/LibraryEditor/utils/LibraryCommandManager","DS/ApplicationFrame/CommandsManager","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/ApplicationFrame/ActionBar","DS/Core/ModelEvents","DS/LibraryEditor/utils/Library_CSO","DS/RuntimeView/NLSManager","DS/PADUtils/PADContext","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/PADUtils/PADProbes"],function(j,f,o,l,c,g,a,k,n,b,m,p,h,e,i){var d=f.extend(l,o,{name:"library_actionbar",_logger:null,_actionBar:null,_language:"en",_context:null,_isReady:false,_modelEvents:null,init:function(q){this._probeLoadElmt=i.createProbe("loadActionBar");var r=this;if(q.language){this._language=widget.lang?widget.lang:widget.getValue("lang")}if(q.context){this._context=q.context}else{this._context=this}this._modelEvents=new b();this._parent(q);this._logger=c.getLogger(d);this.onLoad(q);if(this.getOption("renderTo")){this.render().inject(this.getOption("renderTo"))}this.onReady(function(){r.syncState();var s=m.getCurrentLibrary();m.onLibrarySelected(function(w){var v=m.getCurrentLibrary();g.ItemSelected(w.selectedNode,w.context,v)});m.onEmpty(function(){g.enableAllCommands(false)});if(k.isCustomizedEnv()){try{var u=a.getCommand("ActiveLibrary",k.getContent().getView());if(u){u.begin()}}catch(t){console.error("Error trying to execute command","ActiveLibrary",t)}}if(UWA.is(q.events)&&UWA.is(q.events.onActionBarReady,"function")){q.events.onActionBarReady()}r._probeLoadElmt.end()})},render:function(){return this},loadActionBar:function(q){this._actionBar.loadModel(q)},destroy:function(){this._logger.log("destroy");if(this._actionBar){delete this._actionBar;this._actionBar=null}this._parent()},onLoad:function(r){var t=this;t._context.options=t._context.options||{};UWA.extend(t._context.options,{custo_view_title:e.name_Widget_Title});h.set(t._context);var q=null;if(!j.is(this.elements.container)){p.DEFAULT_LANGUAGE=widget.lang?widget.lang:widget.getValue("lang");this.elements.container=UWA.createElement("div",{"class":this.getClassNames()});var u="";if(typeof(window.dscef)!=="undefined"){u="ENOLibraryCustoWebInWin.xml"}else{u=k.isCustomizedEnv()?"ENOLibraryCusto.xml":"ENOLibrary.xml"}this._actionBar=new n({context:q,file:u,module:"LibraryEditor",language:widget.lang?widget.lang:widget.getValue("lang")});var s=this._actionBar.onActionBarReady(function(){t._actionBar._modelEvents.unsubscribe(s);t._isReady=true;t._modelEvents.publish({event:"READY",context:t})});this._actionBar.inject(this.elements.container)}},onReady:function(r){var q=this._modelEvents.subscribe({event:"READY"},r);return q},syncState:function(){var q=m.getCurrentLibrary();var s=m.get();if(q&&s&&s.length>0){var r="CONTENT";if(q.getID()==s[0].getID()){r="TREE"}g.ItemSelected(s[0],r,q)}else{g.enableAllCommands(false)}}});return d});define("DS/LibraryEditor/service/LibraryServices",["DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryAlert","DS/LibraryEditor/utils/LibraryEditorcontrol","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(c,g,b,a,e,f){var d={AddContent:function(i){if(!UWA.is(i.callbacks,"object")){throw new Error("No callbacks function defined")}if(!UWA.is(i.callbacks.onComplete,"function")){throw new Error("No onComplete callback function defined")}if(!UWA.is(i.callbacks.onFailure,"function")){throw new Error("No onFailure callback function defined")}var k=i.IDs.length;if(k>0){var l=i.library;var h;if(l){h=l}else{h=c.getCurrentLibrary()}var j=h?h.id||h.getID():"";if(j&&j.length){g.addcontent({pid:j,IDs:i.IDs,onComplete:function(n){var o=n?JSON.parse(n):undefined;if(o&&o.error){var m=o.error;console.log("AddContent WebService Err : "+m);if(m.length>200){m=null}i.callbacks.onFailure(m)}else{i.callbacks.onComplete(n)}},onFailure:i.callbacks.onFailure})}else{i.callbacks.onFailure(i)}}else{i.callbacks.onFailure(i)}},RemoveContent:function(i){if(!UWA.is(i.callbacks,"object")){throw new Error("No callbacks function defined")}if(!UWA.is(i.callbacks.onComplete,"function")){throw new Error("No onComplete callback function defined")}if(!UWA.is(i.callbacks.onFailure,"function")){throw new Error("No onFailure callback function defined")}var k=i.IDs.length;if(k>0){var l=i.library;var h;if(l){h=l}else{h=c.getCurrentLibrary()}var j=h?h.id||h.getID():"";if(j&&j.length){g.removecontent({pid:j,IDs:i.IDs,onComplete:function(n){var o=n?JSON.parse(n):undefined;if(o&&o.error){var m=o.error;console.log("Remove WebService Err : "+m);if(m.length>200){m=null}i.callbacks.onFailure(m)}else{i.callbacks.onComplete(n)}},onFailure:i.callbacks.onFailure})}else{i.callbacks.onFailure(i)}}else{i.callbacks.onFailure(i)}},activateLibraryEditorItem:function(h,l,i,k){if(b.isLibrary(i)){i="Library"}else{if(b.isRootLibrary(i)){i="RootLibrary"}}if(h&&b.inFamilyLibrary(i)){var j=e.getTreeCont();if(j){j.expandTreeAndSelectLibrary({libraryToFindAndSelect:{id:h,mxid:l,type:i,name:k},onComplete:function(m){console.log(" expandTreeAndSelectLibrary:onComplete")},onGiveUp:function(m){console.log(" expandTreeAndSelectLibrary:onGiveUp")},onFailure:function(m){a.displayNotification({message:f.replace(f.get("msg_error_LibraryActivate"),{name1:k}),className:"error"})}})}}else{console.log("Selected (Double Clicked) object is not library")}}};return d});define("DS/LibraryEditor/views/LibraryTreeListView",["DS/Logger/Logger","UWA/Class/Listener","DS/ENOPAD_v2/views/PADTreeListView","DS/LibraryEditor/utils/LibraryEditorUtil","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/utils/LibraryEditorEvents","DS/LibraryEditor/utils/LibrarySearch","text!DS/LibraryEditor/assets/library_exclude_columns.json"],function(d,k,j,h,i,g,a,c){function b(l){if(l==="ds6w:label"||l==="tree"||l==="ds6w:description"){return true}return false}function f(){return["tree","ds6w:description"]}var e=j.extend(k,{name:"LibraryTreeListView",padtreelst_def_file:{module:"LibraryEditor",asset:"padtreelst_def.json"},init:function(m){var n=this;m.apiVersion=2;m.not_attr_column=[];m.infiniteScrolling=true;var l={};l={0:"bi_color",end:"thumbnail"};m.specific_columns=l;m.isEditable=true;this._logger=d.getLogger(e);this._logger.log("init");this.listenTo(this,"onComplete",function(){var q=n.getManager();var o=q.getNumberOfColumns();for(var p=0;p<o;p++){var r=q.getColumnOptions(p);if(r&&r.dataIndex!=="tree"){q.setColumnOptions(p,{isEditable:false})}}n.onNodeDblClick(function(z){var A=z.nodeModel;var u=A.options.physicalid;var x=A.options.mxid;var v=A.options.label;var y=A.plmType;var t=A.options.grid["ds6wg:revision"]?A.options.grid["ds6wg:revision"]:"";var B=A.options.grid["ds6w:description"]?A.options.grid["ds6w:description"]:"";var s=A.options.grid["ds6w:responsible"]?A.options.grid["ds6w:responsible"]:"";var w=A.options.grid["ds6w:policy"]?A.options.grid["ds6w:policy"]:"";i.activateLibraryEditorItem(u,x,y,v)});q.onInfiniteScrollAsync(function(s){if(s.reachBottom){g.notifyScrollEnd()}else{if(s.reachRight){this.infiniteScrollAsyncProcessDone()}}})});m.selection={enableListSelection:true};this._parent(m)},provideDisplayTooltip:function(o){var n="";if(o){if(!o.isHeader&&o.dataIndex==="tree"){n=o.nodeModel.options.display||o.nodeModel.options.label;return{longHelp:n}}else{if(o.isHeader){var l=a.getDynamicHeaderMap();for(var m=0;m<l.length;m++){if(o.dataIndex==l[m].dataIndex){return{longHelp:l[m].toolTip}}}}return this._parent(o)}}},buildTreeListOpts:function(l,n){var m=JSON.parse(c);if(m){m=m.columnToExclude}this._parent(l,function(o){o.columns.slice(0).forEach(function(q){for(var p=0;p<m.length;p++){if(q.dataIndex===m[p]){o.columns.splice(o.columns.indexOf(q),1)}}});n.apply(this,arguments)})},_enrichViews:function(l){l=this._parent(l);if(l.columns){l.columns.forEach(function(n){var m=n.dataIndex;if(m==="tree"){n.sortFunction=h.sortTreeColumn}else{n.sortFunction=h.sortColumn}})}return l},getSortingOrder:function(p){var r=this;var s={};var m=r.getManager();if(m){var l=m.getOrderedColumnState();var q=1,o="asc";if(l&&l.columnID){q=l.columnID;o=l.sortOrder}else{m.setColumnOrderState(q,o)}s.order_by=o;var n=m.getColumnOptions(q);if(n){if(n.isHidden){m.setColumnOrderState("ds6w:modified","desc")}else{if(n.xnav_options){s.order_field=n.xnav_options.name}else{if(p&&n.dataIndex){s.order_field=n.dataIndex}else{if(!p&&n.predicate){s.order_field=n.predicate}}}}}}return s},setSortingForComputedAttrs:function(){var n=this.getManager();if(null==n||undefined==n){return}var r=h.isIndexedMode();var q=f();for(var m=0;m<q.length;++m){var l=q[m];var p=n.getColumnIDFromDataIndex(l);if(p<=0){return}var o=n.getColumnOptions(p);if(r){o.isSortable=true}else{o.isSortable=false}n.setColumnOptions(p,o)}if(r===false){if(b(this.getSortingOrder().order_field)){n.setColumnOrderState("ds6w:modified","desc")}}}});return e});define("DS/LibraryEditor/views/LibraryThumbnailGridView",["DS/ENXNav/views/xNavResponsiveThumbnailsView","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/utils/LibraryEditorEvents"],function(d,a,c){var b=d.extend({init:function(e){this._parent(e);this.options.grid.infiniteScrolling=true;var f=this;if(UWA.is(this.options.grid.onCellDoubleClick,"function")){this.options.grid.onCellDoubleClick(function(h){var g=h.nodeModel;a.activateLibraryEditorItem(g.options.resourceid,g.options.mxid,g.options.type,g.options.label)})}this.options.grid.onInfiniteScroll(function(g){if(g.reachBottom){c.notifyScrollEnd()}else{if(g.reachRight){f.options.grid.infiniteScrollProcessDone()}}})}});return b});define("DS/LibraryEditor/views/LibraryTileGridView",["DS/ENXNav/views/xNavResponsiveTilesView","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/utils/LibraryEditorEvents"],function(b,a,d){var c=b.extend({init:function(e){this._parent(e);this.options.grid.infiniteScrolling=true;var f=this;if(UWA.is(this.options.grid.onCellDoubleClick,"function")){this.options.grid.onCellDoubleClick(function(h){var g=h.nodeModel;a.activateLibraryEditorItem(g.options.resourceid,g.options.mxid,g.options.type,g.options.label)})}this.options.grid.onInfiniteScroll(function(g){if(g.reachBottom){d.notifyScrollEnd()}else{if(g.reachRight){f.options.grid.infiniteScrollProcessDone()}}})}});return c});define("DS/LibraryEditor/service/LibraryDnDService",["UWA/Controls/Abstract","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/PADUtils/PADUtilsServices","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/LibraryEditorUtil","DS/WidgetServices/WidgetServices","DS/LibraryEditor/service/LibraryCommunication"],function(g,j,k,f,b,c,l,i,h,e,m,a){var d=g.singleton({shouldAcceptDrag:function(){var p=true;var n=j.getSelectedNodes();if(n.length>0){for(var o=0;o<n.length;++o){if(n[o].plmType!=="Content"){p=false;break}}}else{p=false}return p},setDragData:function(n,p){if(m.isNatifEnvironnement()&&!m.isWebInWinEnvironment()){var v=j.getSelectedNodesID();a.publish("setDragData",{ids:v})}else{var o=j.getSelectedNodes();var w=j.getCurrentLibrary();var u="";if(w&&!w.isRoot()&&k.inFamilyLibrary(w.plmType)){u=w.getID()}var r={protocol:"3DXContent",version:"1.1",source:"LibraryEditor",widgetId:widget.id,data:{items:[]}};var s=widget.getValue("x3dPlatformId");if(!s){s="OnPremise"}var t=widget.getPreference("pad_security_ctx");if(t&&t.value){t=t.value.split("::")[1]}var q=[];o.forEach(function(y){var x={envId:s,serviceId:"3DSpace",contextId:t,objectId:y._options.physicalid,objectType:y._options.type,displayName:y._options.label,displayType:y._options.type,libraryId:u};q.push(x)});r.data.items=q;if(n.dataTransfer&&n.dataTransfer.setData){n.dataTransfer.setData("text/plain",JSON.stringify(r))}}},cleanDragData:function(){if(m.isNatifEnvironnement()&&!m.isWebInWinEnvironment()){a.publish("cleanDragData")}},shouldAcceptDrop:function(){return false},setDragFrom:function(n){dragFrom=n},getDragFrom:function(n){return dragFrom},performDropOnLibraryEditorNode:function(q,o){var n=this;var s=true;if(!q){f.displayNotification({message:b.msg_warning_dndnotsupported,className:"warning"});s=false}else{if(k.inFamilyLibrary(q.plmType)){s=true}else{f.displayNotification({message:b.msg_warning_dndnotsupported,className:"warning"});s=false}}var r=null;if(s){try{r=n.retrieveDroppedDataFromDropEvent(o)}catch(p){r=null;s=false;f.displayNotification({message:b.msg_warning_dndnotsupported,className:"warning"})}}if(s&&r&&q){n.processDroppedDataOnLibraryEditorNode(q,r)}},processDroppedDataOnLibraryEditorNode:function(x,u){var n=this;function y(B){if(Array.isArray(B)&&B.length>0){var D=c.getPlatformId();for(var C=B.length-1;C>=0;C--){var E=B[C];if(E&&E.droppedItem_tenantId!==D){return false}}}return true}if(u&&x){var q=n.isExternalDroppedDataOnLibraryEditor(u);var z={};n.getSortedDroppedDataByType(u,z);var p=z.RootLibrary_itemList;var A=z.Library_itemList;var s=z.Content_itemList;if(!y(p)||!y(A)||!y(s)){f.displayNotification({message:b.msg_warning_dndnotsupported_from_different_tenant,className:"warning"});return}if(k.inFamilyLibrary(x.plmType)){if(Array.isArray(p)&&p.length>0){f.displayNotification({message:b.msg_warning_dndnotsupported,className:"warning"})}if(Array.isArray(s)&&s.length>0){while(s.length>0&&s[0]){var o=s[0];var w=o.droppedSourceLibrary_id;var v=[];for(var t=s.length-1;t>=0;t--){var r=s[t];if(r){if(r.droppedSourceLibrary_id===w){v.push(r.droppedItem_id);s.splice(t,1)}}else{s.splice(t,1)}}n.addContentInLibrary(x,w,v,q)}}}else{console.warn("  LibraryDnDService processDroppedDataOnLibraryEditorNode dropTarget_NodeModel type is not in Library family")}}else{console.warn("  LibraryDnDService processDroppedDataOnLibraryEditorNode invalid argument(s)")}},retrieveDroppedDataFromDropEvent:function(u){var t={};var r;var p=UWA.is(u.dataTransfer.types.indexOf,"function")?"indexOf":"contains",o="";var q=["text/searchitems","text/plain","Text"];for(var n=0;n<q.length&&o==="";n++){var s=u.dataTransfer.types[p](q[n]);if((UWA.is(s,"number")&&s>=0)||(UWA.is(s,"boolean")&&s===true)){o=q[n]}}if(o===""){throw new Error("Unknown type in DnD")}else{r=u.dataTransfer.getData(o)}t=JSON.parse(r);return t},isExternalDroppedDataOnLibraryEditor:function(o){var n=true;if(o&&o.widget_id&&o.widget_id==this.getWidgetId()){n=false}return n},getSortedDroppedDataByType:function(u,x){var q=[];var y=[];var r=[];if(!u||!u.data||!u.data.items||!(Array.isArray(u.data.items))){return}for(var n=0;n<u.data.items.length;n++){var o=u.data.items[n];var p=o.objectId;var s=o.objectType_Internal;if(!s){s=o.objectType}if(Array.isArray(s)){var C=s.length;var w=(C>0)?s[C-1]:undefined;for(var B=0;B<C;++B){if(k.inFamilyLibrary(s[B])){w=s[B];break}}s=w}var v=o.displayName;if(!v){v=s}if(!v){v=p}var z=o.libraryId;var t=o.envId;var A={droppedItem_id:p,droppedItem_type:s,droppedItem_name:v,droppedSourceLibrary_id:z,droppedItem_tenantId:t};if(k.isRootLibrary(s)){q.push(A)}else{if(k.isLibrary(s)){y.push(A)}else{r.push(A)}}}x.RootLibrary_itemList=q;x.Library_itemList=y;x.Content_itemList=r},addContentInLibrary:function(q,p,t,o){var r=this;l._startProgressBar(b.Paste_content_loading);if(q&&q.plmType&&k.inFamilyLibrary(q.plmType)&&t){if((q.id===p)){l._offProgressBar();f.displayNotification({message:b.msg_error_MoveInSamelibrary,className:"error"});return}var s=t;var n=s.length;if(n<1){console.log("  Error in LibraryDnDService.addContentInLibrary, lContentId list is empty");return}i.AddContent({IDs:s,library:q,callbacks:{onComplete:function(z){if(e.isIndexedMode()){f.displayNotification({message:b.msg_info_indexedModePresence,className:"warning"});l._offProgressBar()}else{var v=h.getContent();var u=j.getCurrentLibrary();if(v&&u){if(u.id===q.id){l._endProgressBarListener();var w=v._libraryContentView.getPADTreeDocument();if(w){w.keepExpandedState()}v.loadContentAndSelect(u,s[n-1]);v.getView().maskContentDiv(false)}else{l._offProgressBar()}}else{l._offProgressBar()}}var y="";var x=s.length;if(z){var A=JSON.parse(z);x=A.added?A.added.length:x;y=A.information?" ("+A.information+")":y}f.displayNotification({message:b.replace(b.msg_info_Addinlibrary,{number:x,libraryname:q.options.label})+y,className:"primary"})},onFailure:function(w){var v=h.getContent();var u=j.getCurrentLibrary();l._offProgressBar();if(v&&u){if(u.id===q.id){v.getView().maskContentDiv(false)}}f.displayNotification({message:w?(b.msg_error_Addinlibrary+"<br>"+w):b.msg_error_Addinlibrary,className:"error"})}}})}else{l._offProgressBar();console.log("  Error in LibraryDnDService.addContentInLibrary, dropTarget_LibraryNodeModel is not a Library")}},getWidgetId:function(){return(self.widget.id)}});return d});define("DS/LibraryEditor/views/LibraryTreeDocumentView",["DS/Logger/Logger","DS/ENOPAD_v2/models/PADTreeDocument","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/utils/LibraryEditorUtil","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/LibraryEditor/utils/LibraryCommandManager","DS/PADUtils/PADProbes","DS/PADUtils/PADUtilsServices","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/WebappsUtils/WebappsUtils","DS/LibraryEditor/service/LibraryDnDService"],function(b,k,m,n,a,g,l,h,j,d,i,c,f){var e=k.extend({name:"LibraryTreeDocumentView",_doNotAddLibrary:false,init:function(o){o.authorize_setStructure=true;o.shouldBeEditable=g.shouldBeEditable;o.shouldAcceptDrag=f.shouldAcceptDrag;o.shouldAcceptDrop=f.shouldAcceptDrop;this._parent(o);this.onNodeModelUpdate(g.onNodeModelUpdate);this._logger=b.getLogger(e);this._logger.log("init");var p=this;this.selection_broadcast_fn=function(){if(!p._doNotAddLibrary){var q=p.getXSO().get();if(q&&q.length>0){var r=q[0];if(!r.getID){r.getID=function(){return this.id}}if(!r.getType){r.getType=function(){return this.plmType}}}m.addInLibraryCSO(q,"CONTENT")}};this.getXSO().onChange(p.selection_broadcast_fn);this.getXSO().onEmpty(function(){p._doNotAddLibrary=false;p.selection_broadcast_fn()});this.getXSO().onPreEmpty(function(){p._doNotAddLibrary=true})},_buildSelectData:function(){var t=this._parent();if(t){var v=m.getCurrentLibrary();if(Array.isArray(t.paths)&&t.paths.length>=1){if(v&&n.inFamilyLibrary(v.plmType)){var s=m.getCurrentLibraryPath();var u=[];var w=Array.isArray(s)?s.length:0;for(var p=0;p<w;p++){u.push({resourceid:s[p].id,type:s[p].type})}t.libraryPath=u}}else{if(v&&n.inFamilyLibrary(v.plmType)){var s=m.getCurrentLibraryPath();var q=[];var w=Array.isArray(s)?s.length:0;for(var p=0;p<w-1;p++){q.push({resourceid:s[p].id,type:s[p].type})}var o={};if(w>=1){var r=w-1;if(s[r].id){o[s[r].id]={type:s[r].type,label:s[r].label}}}t.paths=[[v.id]];t.attributes=o;t.libraryPath=q}}}return t},withBroadcastSelect:function(o){this.prepareBroadcastSelect();o();this.pushBroadcastSelect()},prepareBroadcastSelect:function(){this._doNotAddLibrary=true;this._parent()},pushBroadcastSelect:function(){this._doNotAddLibrary=false;this.selection_broadcast_fn();this._parent()},keepExpandedState:function(){var s=i.getContent().getView().getPADTreeDocument();if(s){var p=s.getRoots();var q=0;var o=p.length;for(q=0;q<o;q++){var r=p[q].options.type;if(p[q].isExpanded()){i.getContent()._refreshProductStructure=true;break}}}},deleteNodes:function(o){this._parent(o)},refreshNodeById:function(s){var u=g.isIndexedMode();if(u){return}var r=this;var o=s.modified;s.modified=[];var q=i.getContent().getView().getPADTreeListView().getManager();var p=q.options.columns;var t=[];p.forEach(function(v){if(v.isDynamic){if(t.indexOf(v.dataIndex)===-1){t.push(v.dataIndex)}}});if(o.length>0){a._performFetchQuery({ids:o,dynamicAttrs:t,isAuthoringMode:!u,onComplete:function(v){if(v.results&&v.results.length>0){v.results.forEach(function(w){var y=l.convertToExaleadDataFormatFederated(w);var x=r.searchRootById(y.physicalid);if(!u){if(x){r.wrapInTransaction(function(){x.updateOptions(y)})}}})}},onFailure:function(){console.error("Unable to update Content root node, Error in getting content Properties")}})}this._parent(s)}});return e});define("DS/LibraryEditor/models/LibraryContentModel",["UWA/Class","UWA/Class/Promise","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/PADUtils/PADProbes"],function(k,h,b,i,e){var j=undefined,c=false,f=false;var g=0;var d=undefined;var a=k.singleton({fetchLibraryContents:function(o){var l=e.createProbe("probeFetchLibraryContents");function n(t,s,r){return r.indexOf(t)===s}var m=this;if(o.isStartFromBeg){j=undefined;g=0;d=o.dynamicattributes.filter(n)}var q,p;if(o.sortOrder){q=o.sortOrder.order_field;p=o.sortOrder.order_by}return new h(function(s,r){b.content({pid:o.containerId,mxid:o.containerMXID,searchQuery:o.searchQuery,isExactSearch:o.isExactSearch,selectedType:o.selectedType,dynamicattributes:d,filters:o.filters,start:o.isStartFromBeg?0:undefined,next_start:j,order_field:q,order_by:p,isAuthoringMode:o.isAuthoringMode,onComplete:function(v){a.setFetchInProgress(false);v=typeof v==="string"?JSON.parse(v):v;if(v.result){u=i.convertNavigateToSearchFormat(v.result);s({contents:u,infos:v.infos,facets:v.facets});return}m._updateStartIndexAfterFetch(v);if(m.isMoreDataToFetch()&&v.infos.nresults==0){o.isStartFromBeg=false;s(m.fetchLibraryContents(o))}var u=t(v.results,o.containerId);s({contents:u,infos:v.infos,facets:v.facets});l.end();function t(x,w){var y=[];if(x!=null){x.forEach(function(z){var A=false;if(z.attributes){z.attributes.forEach(function(B){if(B.name==="physicalid"&&B.value!=w){A=true}})}if(A){y.push(z)}})}return y}},onFailure:function(u,t){r({err:u,serverErr:t});l.end()}})})},fetchClassificationAttributes:function(m){var o=e.createProbe("probeFetchClassificationAttrs");var n=[];var p=[];var l=[];return new h(function(r,q){b.getClassificationAttributes({classid:m,onComplete:function(v){var w=JSON.parse(v);var t=w.attribute;if(!t){t=w.Attribute}if(t.length>0){for(var u=0,s=t.length;u<s;++u){n[u]=t[u].nls_label||t[u].name;p[u]=t[u].predicate;l[u]="attribute["+t[u].name+"]"}}r({dynamicattributes:p,dynamicattributesForUIView:n,dynamicattributesName:l});o.end()},onFailure:function(){q();o.end()}})})},fetchAllLibraries:function(m){var o=e.createProbe("probeFetchAllLibraries");var l=this;if(m.isStartFromBeg){j=undefined;g=0}var p,n;if(m.sortOrder){p=m.sortOrder.order_field;n=m.sortOrder.order_by}return new h(function(r,q){b.roots({filters:m.filters,start:m.isStartFromBeg?0:undefined,next_start:j,order_field:p,order_by:n,onComplete:function(s){a.setFetchInProgress(false);l._updateStartIndexAfterFetch(s);if(l.isMoreDataToFetch()&&s.infos.nresults==0){s.isStartFromBeg=false;r(l.fetchAllLibraries(s))}r(s);o.end()},onFailure:function(){q();o.end()}})})},_updateStartIndexAfterFetch:function(l){c=false;if(l.infos&&l.infos.next_start){j=l.infos.next_start;g+=l.infos.nresults;if(g<l.infos.nhits){c=true}}},isMoreDataToFetch:function(){return c},isFetchInProgress:function(){return f},setFetchInProgress:function(l){f=l}});return{fetchLibraryContents:a.fetchLibraryContents.bind(a),fetchClassificationAttributes:a.fetchClassificationAttributes.bind(a),fetchAllLibraries:a.fetchAllLibraries.bind(a),isMoreDataToFetch:a.isMoreDataToFetch.bind(a),isFetchInProgress:a.isFetchInProgress.bind(a),setFetchInProgress:a.setFetchInProgress.bind(a)}});define("DS/LibraryEditor/views/LibrarySearchInContext",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Autocomplete","DS/LibraryEditor/utils/LibrarySearch","DS/UIKIT/Tooltip","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(i,d,h,a,f,c){var g={enter:13,upArrow:38,downArrow:40};var e=(function(){var m=100;if(!i.is(localStorage.LibSearchBoxStore)){var k=[];localStorage.LibSearchBoxStore=JSON.stringify(k)}var l=function(q){if(null==q||undefined==q||""==q){return}if(i.is(localStorage.LibSearchBoxStore)){var p=JSON.parse(localStorage.LibSearchBoxStore);if(p.indexOf(q)===-1){if(p.length>=m){p.shift()}p.push(q);localStorage.LibSearchBoxStore=JSON.stringify(p)}else{if(p.indexOf(q)>-1){var o=p.indexOf(q);var n=p[o];p.splice(o,1);p.push(n);localStorage.LibSearchBoxStore=JSON.stringify(p)}}}};var j=function(t,o){var r=[];if(i.is(localStorage.LibSearchBoxStore)){var n=JSON.parse(localStorage.LibSearchBoxStore);for(var q=n.length-1;q>=0;--q){if(r.length==o){break}var s=n[q];if(null==s||undefined==s||""==s){continue}if(s.toLowerCase().startsWith(t.toLowerCase())){var p={};p.label=s;p.value=s;p.id=s.replace(/[:* ]/gi,"-");r.push(p)}}}return r};return{insertSuggestion:l,getSuggestions:j}})();var b=d.extend({switchSearch:function(j){if(j){this._showSearchInput()}else{this._hideSearchInput(true)}},_hideSearchInput:function(j){if(j&&this.getValue()){this.clearValue()}if(!this.getValue()){this.elements.inputHolder.show();this.elements.input.hide();this.dispatchEvent("onSearchSwitch",false)}},_showSearchInput:function(){this.elements.input.show();this.elements.inputHolder.hide();this.dispatchEvent("onSearchSwitch",true)},init:function(j){var k=this;this._parent(j);this._placeholder=null;this.elements.container=UWA.createElement("div",{"class":"searchInContext_container"});this.elements.inputHolder=new UWA.createElement("div",{"class":"searchInContext_holder fonticon-2x fonticon fonticon-search",attributes:{title:c.get("searchInLibrary_search")},events:{click:function(){k._showSearchInput()}}}).inject(this.elements.container);new f({position:"left",target:this.elements.inputHolder});this.elements.input=new h({multiSelect:false,showSuggestsOnFocus:false,placeholder:"Search In Context",disabled:false,allowFreeInput:true,minLengthBeforeSearch:3,maxSuggestsToDisplay:4,noResultsMessage:null,events:{onSelect:function(m,l){this.resetCache();e.insertSuggestion(m.value);k._launchSearch(m.value)},onKeyDown:function(m){this.resetCache();var l=m.which;if(m.ODTENVKeyName){l=m.ODTENVKeyName}if(l===g.enter){this._updateKeyboardIndex("reset");this.dispatchEvent("onHideSuggests");e.insertSuggestion(this.elements.input.value);k._launchSearch(this.elements.input.value)}else{if(l===g.upArrow){this._updateKeyboardIndex("up");this.elements.input.value=this._getActiveItem().value;this._updateKeyboardIndex("down")}else{if(l===g.downArrow){this._updateKeyboardIndex("down");this.elements.input.value=this._getActiveItem().value;this._updateKeyboardIndex("up")}}}},onClickOutside:function(l){if(this.elements.input.value==null||this.elements.input.value==undefined||this.elements.input.value===""){k._changePlaceholder(k._placeholder);k._launchSearch("")}this.resetCache();k._hideSearchInput()}},datasets:{configuration:{searchEngine:function(l,m){if(!m){k._launchSearch("");return[]}return e.getSuggestions(m,this.options.maxSuggestsToDisplay)}}}}).inject(this.elements.container);a.onSearchChange(function(l){k.elements.input.elements.input.value=l;e.insertSuggestion(l);k._showSearchInput()});if(widget){widget.addEvent("onSearch",function(l){a.changeSearch(l,true)});widget.addEvent("onResetSearch",function(){a.clearSearch();k._hideSearchInput()})}},changeLibraryPlaceholder:function(k){var j=c.replace(c.SearchInLibrary,{libraryName:k});this._changePlaceholder(j);this._placeholder=j},_changePlaceholder:function(j){if(this.elements.input.elements.input){this.elements.input.elements.input.setAttribute("placeholder",j)}},_launchSearch:function(j){j=j.trim();a.changeSearch(j,true)},getValue:function(){return this.elements.input.elements.input.value},clearValue:function(){a.clearSearch()}});return b});define("DS/LibraryEditor/views/InformationsPanelView",["UWA/Controls/Abstract","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/utils/LibraryEditorEvents","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(h,a,e,d){var f="DS/EditPropWidget/EditPropWidget",b="DS/EditPropWidget/utils/EditPropUtils",g="DS/EditPropWidget/constants/EditPropConstants";var c=h.extend({_context:null,_propertiesWdg:null,init:function(i){this._parent(i,{});var j=this;this._propertiesWdg=null;if(i.padshell){if(j._propertiesWdg==null){require([f,g],function(m,k){if(j._propertiesWdg==null){j._propertiesWdg=new m({className:"enxpropertiestab",setEditButton:true,readOnly:false,typeOfDisplay:k.ALL,selectionType:k.RESTRICTED_SELECTION,multiselection:false,collapseTabs:false});j._propertiesWdg.addFacets([{position:1,require:"DS/ENORIPE_Relations/views/RelationsTab",facet:{name:"relations",text:d.get("relations_tab"),icon:"object-related"}}]);j._propertiesWdg.removeFacets([k.FACET_VIEWS]);var l=i.padshell.getRightPanelContent();j._propertiesWdg.inject(l);j._propertiesWdg.stopSelection(true)}})}e.onInfoExpand(function(){j.show(i.padshell);e.notifyInfoExpanded()});e.onInfoCollapse(function(){i.padshell._modelEvents.publish({event:"triptych-hide-panel",data:"right"});e.notifyInfoCollapsed()});a.onLibrarySelected(function(){if(i.padshell.getRightOpen()){j.show(i.padshell);e.notifyInfoExpanded()}})}},show:function(j){var i=this;require([b],function(k){i._selectionChange(k,j)})},_selectionChange:function(j,l){if(!j){return}var k=this;var i=a.getSelectedNodes();var m=[];if(i.length){i.forEach(function(o){var n=j.getModelFromSelectedNode(o);if(n){m.push(n)}})}k._propertiesWdg.initDatas(m);l._modelEvents.publish({event:"triptych-show-panel",data:"right"})}});return c});define("DS/LibraryEditor/commands/LibraryOrderCmd",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol"],function(f,b,a,e,d){var c=f.extend(b,a,{_name:"library_orderTools",_defaultOptions:{sortMode:"alpha",sortOrder:"asc"},init:function(g){this._parent(g);this.sortMode=widget.getValue("sortMode")||this._defaultOptions.sortMode;this.sortOrder=widget.getValue("order")||this._defaultOptions.sortOrder;this._buildSkeleton()},_buildSkeleton:function(){var g=this,h;this.elements.container=UWA.createElement("div",{id:"library_orderTools"});h="sprite_az sprite";h+=this.sortMode==="alpha"?(this.sortOrder==="desc"?" desc active":" active"):"";this._alphaElmt=UWA.createElement("span",{"class":h,title:e.alpha_sorting,events:{click:function(i){g.toggleButton(i.target)}}}).inject(this.elements.container);h="sprite_nb sprite";h+=this.sortMode!=="alpha"?(this.sortOrder==="desc"?" desc active":" active"):"";this._dateElmt=UWA.createElement("span",{"class":h,title:e.date_sorting,events:{click:function(i){g.toggleButton(i.target)}}}).inject(this.elements.container)},toggleButton:function(g){if(g.hasClassName("active")){g.toggleClassName("desc")}else{var h=this.elements.container.getElement(".active");if(h){h.removeClassName("active")}g.addClassName("active")}this.sortOrder=g.hasClassName("desc")?"desc":"asc";this.sortMode=g.hasClassName("sprite_nb")?"date":"alpha";this.sortingNodesUnsensitiveCase();widget.setValue("sortMode",this.sortMode);widget.setValue("order",this.sortOrder)},getSortMode:function(){return this.sortMode},sortingNodesUnsensitiveCase:function(){var i=this,g=d.getTreeCont();if(g&&g.getView()._libraries_TreeView){var h=g.getView()._libraries_TreeView.getManager();h.sortColumnContent("tree",{sortOrder:i.sortOrder==="asc"?"asc":"desc",sortMode:i.sortMode,sortFunction:i.mySortFunction})}},sortingChildrenNodes:function(g){var i=this,h=d.getTreeCont().getView()._libraries_TreeView.getManager();h.prepareUpdateView();g.sortChildren({isRecursive:true,sortFunction:function(l,k){var j=(i.sortOrder==="asc")?1:-1;return j*i.mySortFunction(l,k)}});h.pushUpdateView()},mySortFunction:function(l,k){var i=this.sortOrder==="asc"?-1:1;var j=l.getParent().plmType==="LibrarySection_favorite";if(j){return null}if(l.isRoot()&&k.isRoot()||j){return null}else{if(this.sortMode==="date"){var g;try{g=new Date(l.options.created)>new Date(k.options.created)?1:(new Date(l.options.created)<new Date(k.options.created))?-1:0}catch(h){g=l.options.created<k.options.created?-1:1}finally{return g}}else{return l.options.label.localeCompare(k.options.label)}}}});return c});define("DS/LibraryEditor/views/LibraryPathSeparator",["UWA/Controls/Abstract","UWA/Class/Options","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/UIKIT/DropdownMenu","DS/LibraryEditor/utils/LibraryAlert"],function(f,b,d,c,a){var e=f.extend(b,{_dropDownCreated:false,_dropdownElmt:null,_separator:null,_libraryInfo:null,_subLibraries:null,_activeIconFont:"",_unactiveIconFont:"",init:function(g){this._parent(g);this._libraryInfo=g.libraryInfo||null;this._activeIconFont=g.activeIconFont||"fonticon-down-dir";this._unactiveIconFont=g.unactiveIconFont||"fonticon-right-dir"},getSubLibrary:function(g){if(this._subLibraries===null||g>=this._subLibraries.length){return null}return this._subLibraries[g]},addSubLibrary:function(h,g){if(this._subLibraries===null){this._subLibraries=[]}if(g){this._subLibraries.splice(0,0,h)}else{this._subLibraries.push(h)}this._dropDownCreated=false},removeSubLibrary:function(g){if(this._subLibraries===null||g>=this._subLibraries.length){return false}var h=this._subLibraries.splice(g,1);this._dropDownCreated=false;if(this._dropdownElmt&&this._dropdownElmt.isVisible){this._dropdownElmt.hide()}return true},hide:function(){if(this._dropdownElmt&&this._dropdownElmt.isVisible){this._dropdownElmt.hide();this._dropDownCreated=false}if(this._separator){this._separator.hide()}},show:function(){if(this._separator){this._separator.show()}},isVisible:function(){var g=this._separator.getStyle("display");return g!=="none"},buildPathSeparatorElement:function(){var g=this;this._separator=UWA.createElement("div",{"class":"separatorIdCard fonticon "+this._unactiveIconFont,styles:{cursor:"pointer"},events:{click:function(h){if(!g._dropDownCreated){g._buildDropDownPath()}},}});return this._separator},flush:function(){this._clearDropDown;this._dropDownCreated=false;this._subLibraries=null},_clearDropDown:function(){if(this._dropdownElmt){this._dropdownElmt.destroy();this._dropdownElmt=null}},_buildDropDownPath:function(){var g=this;if(this._subLibraries===null&&this._libraryInfo===null){return null}this._clearDropDown();if(this._subLibraries){g._dropDownCreated=true;this._buildDomDropdownElmt(this._subLibraries)}else{this._libraryInfo.getChildrenInfos({onComplete:function(h){g._dropDownCreated=true;g._buildDomDropdownElmt(h)},onFailure:function(h){g._dropDownCreated=false;a.displayNotification({message:Nls.replace(Nls.get("msg_error_LibraryActivate"),{name1:name}),className:"error"})}})}},_buildDomDropdownElmt:function(h){var i=this,g=[];if(h.length>0){h.forEach(function(j){g.push({text:j.getLabel(),title:j.getLabel(),handler:function(){i._callExpandAndSelectRequest(j.getID(),j.getType(),j.getLabel())}})});this._dropdownElmt=new c({target:this._separator,className:"library_ctx_menu",items:g,position:"bottom left",events:{onShow:function(){i._separator.removeClassName(i._unactiveIconFont);i._separator.addClassName(i._activeIconFont)},onHide:function(){i._separator.removeClassName(i._activeIconFont);i._separator.addClassName(i._unactiveIconFont)},}});this._checkSizeOverflowDropdownMenu();this._dropdownElmt.show()}},resizeWidgetCallback:function(){if(this._dropdownElmt&&this._dropDownCreated){this._dropDownCreated=false;if(this.isVisible()){this._dropdownElmt.hide()}}},_checkSizeOverflowDropdownMenu:function(){var l,g,i,m,k,h,q,p,o,j,n;if(!this._dropdownElmt){return false}h=this._dropdownElmt.elements.container;q=this._dropdownElmt.options;l=q.target;i=document.documentElement.clientHeight||window.innerHeight;k=document.documentElement.clientWidth||window.innerWidth;if(!h.isInjected()){this._dropdownElmt.inject(q.renderTo?q.renderTo:document.body);h.setStyle("display","")}g=h.offsetHeight;m=h.offsetWidth;j=l.getOffsets().y+l.offsetHeight;p=(i-j-20)>0?(i-j-20):(i-j);if(g>p){h.setStyle("height",p);h.setStyle("overflow-y","auto");m+=20;h.setStyle("width",m)}n=l.getOffsets().x+l.offsetWidth;o=(k-n-20)>0?(k-n-20):(k-n);if(m>o){h.setStyle("width",o)}},_callExpandAndSelectRequest:function(j,i,h){var g=d.getTreeCont();g.expandTreeAndSelectLibrary({libraryToFindAndSelect:{id:j,type:i,name:h},onComplete:function(k){console.log(" expandTreeAndSelectLibrary:onComplete")},onGiveUp:function(k){console.log(" expandTreeAndSelectLibrary:onGiveUp")},onFailure:function(k){a.displayNotification({message:Nls.replace(Nls.get("msg_error_LibraryActivate"),{name1:h}),className:"error"})}})},});return e});define("DS/LibraryEditor/views/LibraryPathNavigator",["UWA/Controls/Abstract","UWA/Class/Options","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/views/LibraryPathSeparator"],function(f,b,a,c,d){var e=f.extend(b,{_ctxMenu:null,_ctxMenuWidth:4,_breadcrumb:null,_pathCont:null,init:function(g){this._parent(g);this._pathCont=g.pathCont;this._buildCtxMenu();this._breadcrumb=UWA.createElement("div",{"class":"containerPathIdCard"}).inject(this._pathCont);if(g.pathNodes&&g.pathNodes.length>0){this._buildPathNavigator(g.pathNodes)}},flush:function(){this._ctxMenu.hide();while(this._breadcrumb.firstChild){this._breadcrumb.removeChild(this._breadcrumb.firstChild)}this._ctxMenu.flush()},_buildPathNavigator:function(o){if(!UWA.is(o)){return}var p=this._pathCont.offsetWidth-this._ctxMenuWidth,h=false;for(var n=0;n<o.length;n++){var j=null,g=null,k=0,l=0;var m=this._createLibraryInfoPathElement(o[n]);l=m.getDimensions().outerWidth;if(n<o.length-1){g=new d({libraryInfo:o[n+1]});j=g.buildPathSeparatorElement();j.LibrarySeparator=g;j.inject(this._breadcrumb,"top");k=j.getDimensions().outerWidth}if((l+k<p)&&!h){p=p-l-k}else{h=true;if(!this._ctxMenu.isVisible()){this._ctxMenu.show()}if(j){j.destroy()}var i=m.nextSibling;if(i&&i.hasClassName("separatorIdCard")){i.destroy()}m.remove();this._ctxMenu.addSubLibrary(o[n])}}},_buildCtxMenu:function(){this._ctxMenu=new d({libraryInfo:null,activeIconFont:"fonticon-menu",unactiveIconFont:"fonticon-menu"});var g=this._ctxMenu.buildPathSeparatorElement();g.inject(this._pathCont,"top");this._ctxMenuWidth=g.getDimensions().outerWidth;this._ctxMenu.hide()},_resize:function(){var h=null,n;if(this._isOverflowed(this._pathCont)){if(!this._ctxMenu.isVisible()){this._ctxMenu.show()}while(this._isOverflowed(this._pathCont)&&this._breadcrumb.hasChildNodes()){h=this._breadcrumb.firstChild;if(!h){break}if(h.LibraryInfo){this._ctxMenu.addSubLibrary(h.LibraryInfo,true);n=h.nextSibling;if(n&&n.hasClassName("separatorIdCard")){n.destroy()}h.remove()}}}else{var o=true;var m=this._breadcrumb.getElementsByClassName("subLabelTextIdCard").length>0;while(o){if(!this._ctxMenu.isVisible()){o=false}h=this._ctxMenu.getSubLibrary(0);if(h){if(m){var g=new d({libraryInfo:h});n=g.buildPathSeparatorElement();n.LibrarySeparator=g;n.inject(this._breadcrumb,"top");var p=n.getDimensions().outerWidth}var r=this._createLibraryInfoPathElement(h);var q=r.getDimensions().outerWidth;m=true;if(this._isOverflowed(this._pathCont)){if(n){n.destroy()}r.remove();o=false}else{this._ctxMenu.removeSubLibrary(0)}}else{this._ctxMenu.hide();o=false}}}if(this._ctxMenu.isVisible()){this._ctxMenu.resizeWidgetCallback()}var j,s,l,k=this._breadcrumb.getElementsByClassName("separatorIdCard");l=k.length;for(j=0;j<l;++j){s=k[j].LibrarySeparator;if(s){s.resizeWidgetCallback()}}return true},_isOverflowed:function(g){return g.scrollHeight-1>g.clientHeight||g.scrollWidth>g.clientWidth},_createLibraryInfoPathElement:function(i){var k=null,h=this,j=i.getID()===a.getCurrentLibraryID();var g=UWA.createElement("div",{"class":"subLabelTextIdCard",styles:{cursor:"pointer"},events:{click:function(l){h._callExpandAndSelectRequest(this.LibraryInfo.getID(),this.LibraryInfo.getType(),this.LibraryInfo.getLabel())},}}).inject(this._breadcrumb,"top");g.LibraryInfo=i;g.setAttribute("current",j);g.setText(i.getLabel());return g},_callExpandAndSelectRequest:function(j,i,h){var g=c.getTreeCont();g.expandTreeAndSelectLibrary({libraryToFindAndSelect:{id:j,type:i,name:h},onComplete:function(k){console.log(" expandTreeAndSelectLibrary:onComplete")},onGiveUp:function(k){console.log(" expandTreeAndSelectLibrary:onGiveUp")},onFailure:function(k){LibraryAlert.displayNotification({message:Nls.replace(Nls.get("msg_error_LibraryActivate"),{name1:h}),className:"error"})}})},});return e});define("DS/LibraryEditor/models/LibraryInfo",["UWA/Controls/Abstract","UWA/Class/Options","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/utils/LibraryEditorDataConversion"],function(f,c,d,e,b){var a=f.extend(c,{_id:null,_type:null,_label:null,init:function(g){this._parent(g);this._id=g.id;this._type=g.type;this._label=g.label},getID:function(){return this._id},getType:function(){return this._type},getLabel:function(){return this._label},getChildrenInfos:function(h){var k=this,j,i=[],g=d.getTreeCont();j=g._getVisibleNodeById(this._id);if(!j){e.libraries({pid:k._id,onComplete:function(n){var m=null;var o=[];if(n.results){m="ExpandAPI";o=b.convertExpandToSearchFormat(k._id,n.results)}else{if(n.result){m="NavigateAPI";o=b.convertNavigateToSearchFormat(n.result)}}o.forEach(function(p){i.push(new a({id:p.id,type:p.type||"Library",label:p.label}))});h.onComplete(i)},onFailure:function(m){console.warn("WebService libraries Err : "+m);h.onFailure(m)}})}else{var l=j.getChildren();l.forEach(function(m){i.push(new a({id:m.getID(),type:m.plmType||"Library",label:m.getLabel()}))});h.onComplete(i)}},});return a});define("DS/LibraryEditor/models/LibraryIdCardModel",["UWA/Class","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/models/LibraryInfo"],function(d,b,a){var c=d.singleton({_currentPathNodes:null,getNewPathNodes:function(){this._currentPathNodes=[];var h=b.getCurrentLibraryPath();if(h&&h.length>0){var e=h.length-1;for(var g=e;g>=0;--g){var f=h[g];this._currentPathNodes.push(new a({id:f.id,mxid:f.mxid,type:f.type,label:f.label}))}}return this._currentPathNodes},getPathNodes:function(){return this._currentPathNodes}});return{getNewPathNodes:c.getNewPathNodes.bind(c),getPathNodes:c.getPathNodes.bind(c)}});define("DS/LibraryEditor/utils/LibraryPreference",["UWA/Class","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/utils/LibraryEditorUtil"],function(a,d,c){var b=a.singleton({PREFERENCES:{TREE_SELECTED_NODE:"ipcTreeSelectedNode_v1",TREE_STRUCTURE:"ipcTreeStrucure_v1",FAVORITES:"ipcFavoriteList_v1"},get:function(f,i,h){if(h===false){h=false}else{h=true}function e(j){if(j){try{j=c.jsonUnzip(j);j=JSON.parse(j)}catch(k){j={}}}else{j={}}return j}if(h){if(window.dscef){if(window.dscef.loadValue){window.dscef.loadValue(f).then(function(j){g=e(j);i(g)})["catch"](function(j){i({})})}else{i({})}}else{var g=widget.getValue(f);g=e(g);i(g)}}else{d.getUserPreferences({name:f,onComplete:function(j){g=e(j);i(g)},onFailure:function(j){throw new Error("Error while retrieving userpreferences for ",f,j)}})}},set:function(e,f,g){if(g===false){g=false}else{g=true}f=JSON.stringify(f);f=c.jsonZip(f);if(g){if(window.dscef){if(window.dscef.saveValue){window.dscef.saveValue(e,f)}}else{widget.setValue(e,f)}}else{d.saveUserPreferences({name:e,value:f,onComplete:function(){},onFailure:function(h){throw new Error("Error while saving userpreferences for ",e,h)}})}}});return b});define("DS/LibraryEditor/models/LibraryTreeModel",["UWA/Class","DS/LibraryEditor/utils/LibraryPreference","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/utils/LibraryEditorDataConversion"],function(f,e,g,a){var b=(function(){var i={};var m=function(o){var n=i[o];return(n!==null&&n!==undefined)?true:false};var k=function(){i={}};var j=function(q){var p=i[q];if(p){var n=[];for(var o in p){if(p.hasOwnProperty(o)){n.push(p[o])}}p=n}i[q]=null;return p};var l=function(y,x,r){if(!y||!x||y.length<=0){return}var w=[];for(var n=0;n<y.length;++n){var p=y[n];for(var t=1;t<p.length;++t){var v=p[t-1],o=x[p[t]],u=p[t];if(i[v]){i[v][u]=o}else{i[v]={};i[v][u]=o}if(t===(p.length-1)&&r===-1){w.push(p[t])}}}if(r===-1){r=w}for(var s=0;s<r.length;++s){var q=r[s];if(!i[q]){i[q]={}}}};return{toFetchDataFromCache:m,clean:k,children:j,updateCache:l}})();var c=(function(){var o=function(){return{e:true,c:{}}};var k=function(w){if(!w){w={root:o()}}return w};var s={_items:[],_isProcessing:false,OPERATIONS:{ADD:"add",REMOVE:"remove"},_process:function(){var w=this;if(this._items.length==0){this._isProcessing=false;return}var x=this._items[0];this._items.shift();if(x.operation==w.OPERATIONS.ADD){l(x.pathId,x.childIds,function(){w._process()})}else{if(x.operation==w.OPERATIONS.REMOVE){t(x.pathId,function(){w._process()})}}},add:function(w){this._items.push(w);if(this._isProcessing==false){this._isProcessing=true;this._process()}}};var l=function(w,y,z){function x(F){F=k(F);var E=F;var B=w.split(",");var A=B.splice(B.length-1)[0];B.forEach(function(G){if(!E[G]){E[G]=o()}E=E[G].c});if(!E[A]){E[A]=o()}E[A].e=true;if(UWA.is(y,"array")){var D=E[A].c;var C={};y.forEach(function(G){if(D[G]){C[G]=D[G]}});E[A].c=C}e.set(e.PREFERENCES.TREE_STRUCTURE,F);z()}e.get(e.PREFERENCES.TREE_STRUCTURE,x)};var t=function(w,y){function x(C){C=k(C);var B=C;var A=w.split(",");var z=A.splice(A.length-1)[0];A.forEach(function(D){if(!B[D]){B[D]=o()}B=B[D].c});if(!B[z]){B[z]=o()}B[z].e=false;if(B[z].c.length===0){delete B[z]}e.set(e.PREFERENCES.TREE_STRUCTURE,C);y()}e.get(e.PREFERENCES.TREE_STRUCTURE,x)};var u=function(w,x){s.add({pathId:w,childIds:x,operation:s.OPERATIONS.ADD})};var n=function(w){s.add({pathId:w,operation:s.OPERATIONS.REMOVE})};var m=function(w,y){if(y.length<=0){return}function x(C){C=k(C);var z=C;var D=w.split(",");var F=D.splice(D.length-1)[0];D.forEach(function(J){if(!z[J]){z[J]=o()}z=z[J].c});z[F]=o();for(var G=0;G<y.length;++G){var A=z;var I=y[G];for(var E=1;E<I.length;++E){var B=I[E],H=I[E-1];if(!A[H].c[B]){A[H].c[B]=o()}A=A[H].c}}e.set(e.PREFERENCES.TREE_STRUCTURE,C)}e.get(e.PREFERENCES.TREE_STRUCTURE,x)};var i=function(w,y){function x(D){D=k(D);var C=D;var A=w.split(",");var z=A.splice(A.length-1)[0];A.forEach(function(E){if(!C[E]){C[E]=o()}C=C[E].c});var B=false;if(C[z]&&C[z].e!==undefined){B=C[z].e}y.call(window,B)}e.get(e.PREFERENCES.TREE_STRUCTURE,x)};var r=function(w){var x={path:w};e.set(e.PREFERENCES.TREE_SELECTED_NODE,x)};var j=function(x,y){function w(A){var z=true;if(A){A=A.path}if(!A&&x==="root,LibrarySection_AllLibraries"){z=true}else{if(A!=x){z=false}}y.call(window,z)}e.get(e.PREFERENCES.TREE_SELECTED_NODE,w)};var q=function(w,y){function x(C){C=k(C);var B=[];var z=C;var D=w.split(",");var E=D.splice(D.length-1)[0];D.forEach(function(I){if(!z[I]){z[I]=o()}z=z[I].c});var A=[];A.push(z[E]);for(var F=0;F<A.length;++F){var G=A[F];if(!G){continue}for(var H in G.c){if(G.c.hasOwnProperty(H)){if(G.c[H].e===true){B.push(H);if(Object.keys(G.c[H].c).length!=0){A.push(G.c[H])}}}}}y.call(window,B)}e.get(e.PREFERENCES.TREE_STRUCTURE,x)};var p=function(w){widget.setValue("scrollToNode",w)};var v=function(w){var x=widget.getValue("scrollToNode");if(x===w){return true}return false};return{add:u,remove:n,addExpandAllPaths:m,isExpanded:i,select:r,isSelected:j,getExpandedChildren:q,scrollAfterSelect:p,doScrollAfterSelect:v}})();var h=false;var d=f.singleton({setExpandAllOperation:function(i){this._expandAllOp=false;if(i&&i===true){this._expandAllOp=true}},_isOperationExpandAll:function(){return this._expandAllOp},fetchLibraryContents:function(j){var i=this;return new Promise(function(n,m){if(b.toFetchDataFromCache(j.parentNodeID)){var l=b.children(j.parentNodeID);n(l)}else{b.clean();if(i._isOperationExpandAll()){i._expand(j).then(function o(p){n(p)},function k(p){m(p)})}else{c.getExpandedChildren(j.parentPath,function(r){i._expand(j,r).then(function q(s){n(s)},function p(s){m(s)})})}}})},_expand:function(j,k){var i=this;return new Promise(function(m,l){g.libraries({pid:j.parentNodeID,mxid:j.parentNodeMXID,children:k,isExpandAll:i._isOperationExpandAll(),onComplete:function(r){r=typeof r==="string"?JSON.parse(r):r;var o=a.getPathsAndObjectsFromExpand(r.results);if(o===null||o===undefined){m([]);return}if(i._isOperationExpandAll()){k=-1;c.addExpandAllPaths(j.parentPath,o.paths)}b.updateCache(o.paths,o.objects,k);if(o.paths&&o.paths.length<=0){var n=[];if(r.results){n=a.convertExpandToSearchFormat(j.parentNodeID,r.results)}var q=[];for(var p in o.objects){if(o.objects.hasOwnProperty(p)){if(p!==j.parentNodeID){q.push(p)}}}c.add(j.parentPath,q);m(n)}else{m(b.children(j.parentNodeID))}},onFailure:function(n){l(n)}})})},fetchAllLibraries:function(i){var j=this;return new Promise(function(l,k){g.roots({fetchAll:true,onComplete:function(p){p=typeof p==="string"?JSON.parse(p):p;var n=p.results?p.results:[];var o=[],m=[];n.forEach(function(r){var q=a.convertToExaleadDataFormatFederated(r);m.push(q);o.push(q.physicalid)});if(j._isOperationExpandAll()){c.add(i,o)}l(m)},onFailure:function(m){k(m)}})})},getFavorites:function(j){var k=this;function i(l){return l.id}e.get(e.PREFERENCES.FAVORITES,function(l){if(l.length>0){g.favourites({ids:l.map(i),onComplete:function(q){q=typeof q==="string"?JSON.parse(q):q;var n=q.results?q.results:[];var u=[];var m=[],s=false;if(n.length!==l.length){s=true}for(var r=0;r<n.length;++r){var p=a.getPlmTypeFromContentDetails(n[r].attributes);var t=a.convertToExaleadDataFormatFederated(n[r]);for(var o=0;o<l.length;++o){if(l[o].id===t.physicalid){t.label=l[o].name}}if(s){m.push({id:t.physicalid,name:t.label})}t.plmType=p;u.push(t)}if(s){e.set(e.PREFERENCES.FAVORITES,m,false)}if(j.onComplete){j.onComplete(u)}},onFailure:function(m){if(j.onFailure){j.onFailure(m)}}})}else{if(j.onComplete){j.onComplete([])}}},false)},setFavorites:function(k){var l=this;function i(p){var o=this;for(var n=0;n<o.length;++n){if(o[n].id==p.id){return false}}return true}function j(n){return n.id}var m=Array.isArray(k.favoriteLibraries)?k.favoriteLibraries:[k.favoriteLibraries];e.get(e.PREFERENCES.FAVORITES,function(p){p=Array.isArray(p)?p:[];if(p.length>0){if(k.renamed===true){for(var o=0;o<p.length;++o){for(var n=0;n<m.length;++n){if(p[o].id===m[n].id){p[o].name=m[n].name}break}}}m=m.filter(i,p)}p=p.concat(m);e.set(e.PREFERENCES.FAVORITES,p,false);if(m.length>0){g.favourites({ids:m.map(j),onComplete:function(u){u=typeof u==="string"?JSON.parse(u):u;var r=u.results?u.results:[];var q=[];for(var t=0;t<r.length;++t){var v=a.getPlmTypeFromContentDetails(r[t].attributes);var s=a.convertToExaleadDataFormatFederated(r[t]);s.plmType=v;q.push(s)}if(k.onComplete){k.onComplete(q)}},onFailure:function(q){if(k.onFailure){k.onFailure(q)}}})}else{if(k.onComplete){k.onComplete([])}}},false)},removeFromFavorites:function(j){var l=this;function i(o){var n=this;for(var m=0;m<n.length;++m){if(n[m]==o.id){return false}}return true}var k=Array.isArray(j.favoritesToRemove)?j.favoritesToRemove:[j.favoritesToRemove];e.get(e.PREFERENCES.FAVORITES,function(m){if(m.length>0){m=m.filter(i,k)}e.set(e.PREFERENCES.FAVORITES,m,false);if(j.onComplete){j.onComplete()}},false)},getLibraryPathLength:function(i){var j=this;g.getLibraryPathLength({pid:i.pid,onComplete:function(k){var l=a.getLibraryDepth(k);if(i.onComplete){i.onComplete(l)}},onFailure:function(k){j._logger.log("WebService getLibraryPathLength Err : "+k);if(i.onFailure){i.onFailure(k)}}})},getLibraryPath:function(i){var j=this;g.getLibraryPath({depth:i.depth,pid:i.pid,onComplete:function(k){var l=a.convertNavigateToFlatFormat(i.depth,k.result);if(i.onComplete){i.onComplete(l)}},onFailure:function(k){j._logger.log("WebService getLibraryPathLength Err : "+k);if(i.onFailure){i.onFailure(k)}}})},libraryStructurePreference:c});return{setExpandAllOperation:d.setExpandAllOperation.bind(d),fetchLibraryContents:d.fetchLibraryContents.bind(d),fetchAllLibraries:d.fetchAllLibraries.bind(d),getFavorites:d.getFavorites.bind(d),setFavorites:d.setFavorites.bind(d),removeFromFavorites:d.removeFromFavorites.bind(d),libraryStructurePreference:d.libraryStructurePreference,getLibraryPathLength:d.getLibraryPathLength.bind(d),getLibraryPath:d.getLibraryPath.bind(d)}});define("DS/LibraryEditor/views/LibraryContentView",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/ENOPAD_v2/PADComponent","DS/ENXNav/models/xNavNodeModel","DS/LibraryEditor/models/LibraryContentModel","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/LibrarySearch","DS/UIKIT/Mask","DS/PADUtils/PADProbes","DS/UIKIT/Native/Dropdown","DS/LibraryEditor/utils/LibraryEditorUtil","DS/LibraryEditor/service/LibraryDnDService","DS/LibraryEditor/utils/Library_Clipboard","DS/WidgetServices/WidgetServices","DS/LibraryEditor/service/LibraryCommunication","DS/LibraryEditor/utils/LibraryAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(a,g,b,j,e,r,p,s,o,t,h,v,i,q,u,f,k,n,l,c,m){var d=b.extend({name:"LibraryContentView",defaultOptions:{x3dAppId:"LibraryEditor",amd_custo:{TreeDocument:"DS/LibraryEditor/views/LibraryTreeDocumentView",TreeListView:"DS/LibraryEditor/views/LibraryTreeListView",TileGridView:"DS/LibraryEditor/views/LibraryTileGridView",ThumbnailGridView:"DS/LibraryEditor/views/LibraryThumbnailGridView"},layout:{keyboard_inputs:false,root_panel:false,action_bar:false,statusInfo:false,slidder:false,title_update:false,drop_invite:"none",triptychOpts:{borderLeft:true,left:{withClose:false,originalState:"close"},right:{withClose:false}}}},_contentDiv:null,_previousSort:null,init:function(w){var y=null;this._createdColumn=[];var x=this;this._contentDiv=w.renderTo;w.DisabledDropInvit=true;this.setOptions(w);this._parent(this.options);require(["DS/PADUtils/views/PADStatusInfos"],function(z){x.elements.padstatus=new z({renderTo:x._contentDiv,events:{onShow:function(){x.elements.padstatus.setStatus(z.buildStatus({tree_content:{nbObjectsInTree:x.options.model.getAllDescendants().length,nbObjectsSelected:x.options.model.getSelectedNodes().length}}))}}})})},createRootListSlidder2:function(){var w=t.getTreeCont().getView();return w.elements.container},_addStyleOnTreeCont:function(w){var x=this.elements.padshell._getLeftWidth();x=!!w&&w>x?w:x;n.addNewStyles("treeContResize",{".LibraryTreeView-root_container":{overflow:"hidden"},".LibraryTreeView-root_treeview_container":{width:x+"px !important"}},true)},cleanColumns:function(){var z=this.getPADTreeListView().getManager();var A=z.getColumns();for(var y=0;y<A.length;++y){var w=A[y].dataIndex;if(A[y].isDynamic){z.removeColumn(A[y].dataIndex)}}},hideColumns:function(){var y=this;if(!y._isTreeViewType()){return}var x=y.getPADTreeListView().getManager();var w=x.getColumns();y._createdColumn.forEach(function(z){x.hideColumn(z)})},showWebInWinCtxMenu:function(z,x){var y=x;if(y&&y.actions){var w=[];y.actions.forEach(function(B,A){if(B.actions){B.actions.forEach(function(C){if(C.items){var D=[];C.items.forEach(function(E){if(E.sourcejs=="DS/ResultWebInWin/ResultWebInWinAction"){D.push({text:E.title,icon:E.image,items:E.items,handler:function(F){var G=o.getSelectedNodesID();l.publish("onActionContextualMenu",{header:E.id,ids:G})}})}});if(C.sourcejs=="DS/ResultWebInWin/ResultWebInWinAction"){w.push({text:C.title,icon:C.image,items:D,handler:function(E){var F=o.getSelectedNodesID();l.publish("onActionContextualMenu",{header:C.id,ids:F})}})}}else{if(C.sourcejs=="DS/ResultWebInWin/ResultWebInWinAction"){w.push({text:C.title,icon:C.image,handler:function(E){var F=o.getSelectedNodesID();l.publish("onActionContextualMenu",{header:C.id,ids:F})}})}}})}});this._initDropDown(w)}},_initDropDown:function(w){if(!this.target){return}var z;var x=this;if(this.dropDown){this.dropDown.destroy();this.dropDown=null}var y={items:w,target:this.target,contextual:true};z=this.dropDown=new q(y);if(this.dropDown){this.dropDown.show()}},setLibraryCommunicationChannel:function(){},getOnContextualEvent:function(){return{"this":this,callback:function(x){var w=null;if(x.treeview){w=x.treeview}else{w=x.cellInfos}if(w){if(x.data){this.target=x.data.target}return this._onContextualMenuReady(w,x)}}}},_onContextualMenuReady:function(C,B){var y;var D;var A=true;var x=C.nodeModel;var z=this;if(n.isNatifEnvironnement()&&!n.isWebInWinEnvironment()){l.publish("Create_ContextMenu",{ids:x?[x.id]:[]});if(x){if(x.isSelected()===false){x.select(true)}}}else{if(C===null||C===undefined){C=o.getCurrentLibrary()}if(C.cellView){if(typeof C.cellView.getVirtualCoordinates==="function"){D=C.cellView.getVirtualCoordinates()}else{D={virtualRowID:1}}}else{D={};C.white_Click=A}if(C.white_Click&&B&&B.treeview){var w=B.treeview?B.treeview.manager.getScroller():null;if(w&&(B.data.target!=w.getContent())){return}}var x=C.nodeModel;if(x&&x.plmType==="Busy"){return y}if(C.white_Click||D.virtualRowID===-1){y=s.GetContextualMenu(C,"CONTENT")}else{if(x){if(x.isSelected()===false){x.select(true)}if(x.isSelected()===true){y=s.GetContextualMenu(C,"CONTENT")}}}if(y){y.forEach(function(E){if(E.type==="separator"||E.type==="SeparatorItem"){E.type="SeparatorItem"}else{E.title=E.label;E.action={callback:E.callback};E.type="PushItem"}})}}return y},contextCallback:function(x){var y=x;if(x===null){y=o.getCurrentLibrary();y.white_Click=true}if(x){if(x.isSelected()===false){x.select(true)}}var w={context:this,nodes:s.GetContextualMenu(y,"CONTENT")};return w},getActiveView:function(){return this._parent()},removeNodesInContent:function(){var w=this.getPADTreeDocument();if(w){var x=w.getRoots(true).slice(0);w.wrapInTransaction(function(){w.withTransactionUpdate(function(){var z,y=x.length;for(z=0;z<y;++z){x[z].filterIn(true)}w.unselectAll();for(z=0;z<y;++z){w.removeRoot(x[z],true,false)}})})}},registerOnSortColumnChange:function(x){var y=this;var w=this.getPADTreeListView()?this.getPADTreeListView().getManager():null;if(w){w.onSortColumnContent(function(){var z=w.getOrderedColumnState();if(y._previousSort==null){y._previousSort=z}else{if(z.columnID!=y._previousSort.columnID||z.sortOrder!=y._previousSort.sortOrder){y._previousSort=z;x()}}})}},getSortingOrder:function(w){return this.getPADTreeListView().getSortingOrder(w)},setSortingForComputedAttrs:function(){this.getPADTreeListView().setSortingForComputedAttrs()},displayDynamicAttributes:function(D,w,y,B){var C=this;if(!C._isTreeViewType()||!D||D.length<1||!w||w.length<1){return}var A=C.getPADTreeListView().getManager();C._createdColumn.forEach(function(E){A.hideColumn(E)});var x={};h.resetAttrNameToPredMapping();for(var z=0;z<D.length;++z){if(null==D[z]||undefined==D[z]){continue}if(!B){if(x[y[z]]){continue}else{x[y[z]]=y[z]}}if(C._createdColumn.indexOf(D[z])<0){A.prepareUpdateView();A.addColumn({column:{dataIndex:D[z],text:w[z],width:"auto",minWidth:30,isVisible:true,isDynamic:true,sortFunction:u.sortColumn,predicate:y[z]}});A.pushUpdateView();C._createdColumn.push(D[z])}A.showColumn(D[z]);h.setAttrNameToPredMapping({key:y[z],value:D[z]})}h.resetDynamicHeaderMap();C._createdColumn.forEach(function(E){h.addToDynamicHeaderMap(A.getColumnOptions(E))})},displayContentNodes:function(D,C,B,A){var z=this;if(A){z.removeNodesInContent()}var y=[],w=[];D.forEach(function(N){var K=null;if(C){C.forEach(function(Q){var R=Q.id||Q.getID();if(R===N.id){K=Q}})}if(K==null){var L=r.convertToExaleadDataFormatFederated(N);var H=new j(L);H.options.grid.thumbnail="url("+L.thumbnail+")";var J=N.attributes;H.plmType=r.getPlmTypeFromContentDetails(J);H.id=L.physicalid;H.mxid=L.mxid;H._ischeckout=N.Documentlocked;if(H._ischeckout==="TRUE"){var I=g.getWebappsAssetUrl("LibraryEditor","icons/32/I_CheckOutDocument.png");H.updateOptions({badges:{bottomRight:I}})}if(N.publishOnConnect==="TRUE"){var F=g.getWebappsAssetUrl("LibraryEditor","icons/libraryPublishBadge.png");H.setBadges({bottomRight:F})}H.options.oldLabel=L.label;if(t.isCustomizedEnv()){var M=t.getActiveLibrary(),E=M.id,O=M.disabledId;if(E===H.id){var P=g.getWebappsAssetUrl("LibraryEditorCustomization","icons/library_active.png");H.setBadges({bottomLeft:P})}else{if(O===H.id){var P=g.getWebappsAssetUrl("LibraryEditorCustomization","icons/library_active_disabled.png");H.setBadges({bottomLeft:P})}}}y.push(H)}else{y.push(K);roots_PS_toRefresh.push(K);var G=K.id||K.getID();if(UWA.is(B,"array")?B.indexOf(G)>=0:G===B){w.push(K)}}});z._endRefreshAndAddNodes(w,y);var x=null;if(w.length>0){x=w[w.length-1]}return x},displayFavouriteNodes:function(D,B){var C=i.createProbe("probeDisplayFavouriteContent");var A=this;A.removeNodesInContent();var y=D;var x=g.getWebappsAssetUrl("LibraryEditor","icons/library.png");var z=[];var w=[];y.forEach(function(F){var E=new j(F);E.plmType=F.plmType?F.plmType:"Library";E.id=F.physicalid;E.isFavorite=true;E.options.oldLabel=F.label;E.options.physicalid=F.physicalid;E.options.mxid=F.mxid;E.options.type=F.type;if(UWA.is(B,"array")?B.indexOf(F.physicalid)>=0:F.physicalid===B){w.push(E)}z.push(E)});A._endRefreshAndAddNodes(w,z);C.end()},_endRefreshAndAddNodes:function(w,z){var y=this;var x=y._isTreeViewType();if(x){y._listenEndUIRefreshEvent()}y.addRootNodes(z);if(!x){y._endRefreshView()}if(w.length>0){w.forEach(function(A){A.select()})}},_isTreeViewType:function(){return this.getActiveView()==="treelistview"&&this.getPADTreeListView()!==null},_endLoadAndSelect:function(){var w=o.getCurrentLibrary();var x=t.getIdCardCont();x.manageSearchVisibility(w)},_endContentSelect:function(){this.contentHandleRequest=null;this.infiniteScrollDone()},infiniteScrollDone:function(){var z=this.getActiveView();if(z==="treelistview"){var y=this.getPADTreeListView();var x=y?y.getManager():null;if(x){x.infiniteScrollAsyncProcessDone()}}else{var w=null;if(z==="tileview"){w=this.getPADTileGridView().options.grid}else{if(z==="thumbnailview"){w=this.getPADThumbnailGridView().options.grid}}if(w){w.infiniteScrollProcessDone()}}},_listenEndUIRefreshEvent:function(){var x=this,w=this.getPADTreeListView();if(w){w.getManager().onPostUpdateViewOnce(function(){var y=this.getOrderedColumnState();if(y){this.sortColumnContent(y.columnID,{sortOrder:y.sortOrder})}if(this.elements.columnsHeaderContainer){this.elements.columnsHeaderContainer.setStyle("left",0)}x._endRefreshView()})}},maskContentDiv:function(y){var x=this._contentDiv;var w=x;if(x){w=x.getElement(".xnav_viewmain")}if(y){v.mask(w)}else{if(v.isMasked(w)){v.unmask(w)}}},_endRefreshView:function(){this.maskContentDiv(false);this.dispatchEvent("onCompleteRefreshNodes",o.getCurrentLibrary().getID())},removeNodeInContent:function(x){var w=this.getPADTreeDocument();w.getRoots().forEach(function(y){var z=y.id||y.getID();if(z===x){w.removeRoot(y)}})},onDragStartCell:function(x,w){if(!f.shouldAcceptDrag()||!a.is(w)||true===w.isHeader){x.preventDefault();x.stopPropagation();return}f.setDragData(x,w)},onDropCell:function(z,w){if(typeof(window.dscef)!=="undefined"){c.displayNotification({message:m.msg_warning_dndnotsupported,className:"warning"})}else{var x=w.nodeModel;if(x.plmType==="RootLibrary"){c.displayNotification({message:m.msg_warning_dndnotsupported,className:"warning"})}else{var y=this;k.SetAsExternalDrop(false);var A=(x&&x.options)?x.options.type:undefined;if(p.inFamilyLibrary(A)){f.performDropOnLibraryEditorNode(x,z);z.preventDefault()}else{y.onDropBlank(z,w)}f.setDragFrom("");f.cleanDragData()}}},onDropBlank:function(y,w){if(typeof(window.dscef)!=="undefined"){c.displayNotification({message:m.msg_warning_dndnotsupported,className:"warning"})}else{var x=o.getCurrentLibrary();if(x.plmType==="RootLibrary"){c.displayNotification({message:m.msg_warning_dndnotsupported,className:"warning"})}else{k.SetAsExternalDrop(false);f.performDropOnLibraryEditorNode(x,y);y.preventDefault();f.setDragFrom("");f.cleanDragData()}}},onDropColumnHeader:function(x,w){f.cleanDragData();return true}});return d});define("DS/LibraryEditor/utils/LibraryTagger",["UWA/Class","DS/LibraryEditor/utils/LibraryEditorEvents","DS/TagNavigatorProxy/TagNavigatorProxy","DS/LibraryEditor/utils/LibraryWebInWinTaggerProxy","DS/WidgetServices/WidgetServices"],function(b,d,h,g,i){var e={},c={},a={};var f=b.extend({_initTaggerProxy:function(){var n=this;var j=null;if(i.isNatifEnvironnement()&&!i.isWebInWinEnvironment()){if(!window.widgetId){var m=Math.random();var o=m.toString(36).substr(2,9);window.widgetId="LibraryEditor"+o}var k=l(window.widgetId);k.events.addFilterChangeListener=n.onFilterChange.bind(n);k.events.addCriteriaChangeListener=n.onFilterChange.bind(n);k.contextId=localStorage.getItem("windowContext");j=n.taggerProxy=new g(k)}else{var k=l(widget.id);j=n.taggerProxy=h.createProxy(k);j.addEvent("onFilterChange",n.onFilterChange.bind(n))}function l(q){var p={widgetId:q,filteringMode:"FilteringOnServer",colorize:false,events:{addOpenTaggerListener:n.onOpenTagger.bind(n),addCloseTaggerListener:n.onCloseTagger.bind(n)}};return p}},_setSubjectTags:function(j,l,k){this.containerType=l;if(!j){return}switch(l){case"LibrarySection_favorite":this._setTagsForFavourites(j);break;default:this._setTagsForLibraries(j,k);break}},_setTagsForLibraries:function(p,q){if(!this.taggerProxy){return}var k={};for(var o in p){var j=p[o];if(k[j.sixw]){k[j.sixw][j.object]=j}else{var m={};m[j.object]=j;k[j.sixw]=m}}var r=[];for(var l in k){if(!e[l]){c[l]=k[l]}for(var n in c[l]){r.push(c[l][n])}}if(q){this.taggerProxy.setTags(null,p)}else{this.taggerProxy.setTags(null,r)}},_setTagsForFavourites:function(j){if(!taggerProxy){return}var k={};this.taggerProxy.setTags(k)},activateTaggerProxy:function(){var j=this.taggerProxy;if(!j){return}j.activate();j.toggleProxyFocus(true)},unsetTags:function(){var j=this.taggerProxy;if(!j){return}j.unsetTags()},onFilterChange:function(k){if(!k){return}e={};for(var j in k.allfilters){e[j]=[]}a=k.allfilters;d.notifyCurrentLibraryFilterChange();return true},onOpenTagger:function(){d.notifyTaggerOpen()},onCloseTagger:function(){d.notifyTaggerClose()},_getCurrentFilter:function(){return a},});return f});define("DS/LibraryEditor/controllers/LibraryContentController",["UWA/Class","DS/Logger/Logger","DS/LibraryEditor/views/LibraryContentView","DS/LibraryEditor/models/LibraryContentModel","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryCommandManager","DS/LibraryEditor/utils/LibraryTagger","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/LibraryEditorEvents","DS/LibraryEditor/utils/LibrarySearch","DS/LibraryEditor/utils/FilterUtils","DS/PADUtils/PADProbes","DS/WidgetServices/WidgetServices","DS/PADUtils/XNavSettings","DS/LibraryEditor/utils/LibraryAlert","DS/LibraryEditor/models/LibraryTreeModel","DS/LibraryEditor/utils/LibraryEditorUtil","DS/PADUtils/PADSession","DS/LibraryEditor/views/InformationsPanelView","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","i18n!DS/SNResultUX/assets/nls/SNResultUX"],function(s,t,c,d,n,o,a,m,v,k,e,p,f,j,g,b,q,w,l,u,h,r){var i=s.extend({name:"LibraryContentController",_tagNavigator:null,_libraryContentView:null,_infoPanelView:null,_refreshProductStructure:false,init:function(x){this._probeLoadElmt=f.createProbe("loadComponent");this._libraryContentView=new c(x);this._logger=t.getLogger(i);v.setContent(this)},_OnPADComponentReady:function(){var A=this;A._tagNavigator=new a();A._tagNavigator._initTaggerProxy();A._libraryContentView.cleanColumns();if(g.getAvailableColumns()){var z=A._libraryContentView.getPADTreeListView()?A._libraryContentView.getPADTreeListView().getManager():null;if(z){var y=z.getColumnOptions("ds6w:modified");if(y&&y.xnav_options&&y.xnav_options.layout){y.isHidden=false;y.xnav_options.layout.removable=false;z.setColumnOptions("ds6w:modified",y)}}e.setPredicates(g.getAvailableColumns().available_columns)}e.onSearchChange(function(G,E){var D=m.getCurrentLibrary();if(D){var F="TREE";o.ItemSelected(D,F,D)}A.loadContentAndSelect()});k.onCurrentLibraryChange(function(F){var D=v.getIdCardCont();if(D){D.switchSearch(false)}var E=e.getSearchValue();if(!E){A.loadContentAndSelect(this)}});k.onCurrentLibraryFilterChange(function(){A.loadContentAndSelect(null,null,false,true)});k.onScrollEnd(function(){if(d.isMoreDataToFetch()){if(!d.isFetchInProgress()){d.setFetchInProgress(true);A.loadContentAndSelect(null,null,true)}}else{A._libraryContentView.infiniteScrollDone()}});var x=m.getCurrentLibrary();if(x){A.loadContentAndSelect(x)}A._libraryContentView.registerOnSortColumnChange(A.loadContentAndSelect.bind(A));A.updateComputedColumns();var B=w.isIndexedMode();l.setAuthoringState(!B);A._infoPanelView=new u({padshell:A._libraryContentView.elements.padshell});var C=widget.getValue("customLeftWidth");A._libraryContentView._addStyleOnTreeCont(C);if(C!=null){A._libraryContentView.elements.padshell._modelEvents.publish({event:"triptych-set-size",data:{side:"left",size:C}})}A._libraryContentView.elements.padshell._modelEvents.subscribe({event:"triptych-panel-show-started"},function(D){if(D==="left"){A._libraryContentView._addStyleOnTreeCont()}});A._libraryContentView.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},function(D){if(D==="left"){j.clearJSStylesheet("treeContResize")}});A._libraryContentView.elements.padshell._modelEvents.subscribe({event:"triptych-resized"},function(D){if(D.side==="left"){widget.setValue("customLeftWidth",D.width)}});k.notifyPageToolBarExpand();this._probeLoadElmt.end()},webInWinCtxMenu:function(y,x){this._libraryContentView.showWebInWinCtxMenu(y,x)},onWebInWinFilterChange:function(x){this._tagNavigator.onFilterChange(x.data)},updateFilterBI:function(y){if(y){if(!this._tagNavigator){this._tagNavigator=new a();this._tagNavigator._initTaggerProxy()}}else{if(this._tagNavigator){this._tagNavigator.unsetTags()}}l.setAuthoringState(!y);var x=this._libraryContentView.getPADTreeDocument();if(x!==null){x.options.filterBIComponentProxy=this._tagNavigator}},updateComputedColumns:function(){this._libraryContentView.setSortingForComputedAttrs()},loadContentAndSelect:function(B,A,C,y){if(C!==true){C=false}if(y!==true){y=false}var z=this;var E,x,D;if(!e._predicateToHeaderMap){e.initPredicateToHeaderMap(z._libraryContentView.getPADTreeListView().getManager().getColumns())}if(C===false){z._libraryContentView.hideColumns()}if(!B){B=m.getCurrentLibrary()}if(B){if(B.getType){E=B.getType()}if(B.getID){x=B.getID()}D=B.options.mxid?B.options.mxid:""}return new Promise(function(I,H){var G=null;if(n.inFamilyLibrary(E)&&x){G=z.displayLibraryContents({containerType:E,containerId:x,containerMXID:D,idsToSelect:A,newCurrentContainer:B,isPaginationOperation:C,isFilterOperation:y})}else{if((E=="LibrarySection_AllLibraries")){G=z.displayAllLibraries({idsToSelect:A,isPaginationOperation:C,isFilterOperation:y})}else{if((E=="LibrarySection_favorite")){z.displayFavouriteLibraries(A)}else{var F=f.createProbe("unknown_container_clean");if(e.isSearchActive()){e.clearSearch()}z._libraryContentView.removeNodesInContent();z._libraryContentView.maskContentDiv(false);z._libraryContentView._endLoadAndSelect();F.end()}}}I(G)})},displayLibraryContents:function(C){var E=f.createProbe("probeDisplayLibraryContents");var B=this;B._libraryContentView.maskContentDiv(true);var I=C.containerType;var H=e.getSearchValue();var z=H?C.newCurrentContainer.options.mxid:C.containerId;var F=false;if(H&&(H.indexOf(":")!=-1||H.indexOf("=")!=-1||H.indexOf(">")!=-1||H.indexOf("<")!=-1)){F=true}var A=false;var y=p.endItemFilter;if(y&&y!=null){A=true}if(C.isPaginationOperation){D()}else{d.fetchClassificationAttributes(z).then(function G(J){D(J)},function x(){D();E.end()})}function D(L){function K(){var N=false;if(I==="Library"&&w.isIndexedMode()===false){N=true}return N}var J=K()&&(null==H||H==="");var M=[];if(L){if(J){if(L.dynamicattributesName){M=L.dynamicattributesName}}else{if(L.dynamicattributes){M=L.dynamicattributes}}B._libraryContentView.displayDynamicAttributes(L.dynamicattributesName,L.dynamicattributesForUIView,L.dynamicattributes,J)}B.getContentOfLibraryOrClass({containerId:z,containerMXID:C.containerMXID,searchQuery:H,isExactSearch:F,selectedType:I,isStartFromBeg:!C.isPaginationOperation,endItemFilterSet:A,dynamicattributes:M,libraryData:C,isAuthMode:J},K())}},getContentOfLibraryOrClass:function(y,C){var D=f.createProbe("probeDisplayLibraryContents");var B=this;var A=C===false&&B._tagNavigator?B._tagNavigator._getCurrentFilter():null;var z=B._libraryContentView.getSortingOrder(y.isAuthMode);d.fetchLibraryContents({containerId:y.containerId,containerMXID:y.containerMXID,searchQuery:y.searchQuery,isExactSearch:y.isExactSearch,selectedType:y.selectedType,filters:A,isStartFromBeg:y.isStartFromBeg,endItemFilterSet:y.endItemFilterSet,dynamicattributes:y.dynamicattributes,sortOrder:z,isAuthoringMode:y.isAuthMode}).then(function E(M){var H=M.contents,R=M.infos,O=M.facets;if(B._tagNavigator){if(C){B._tagNavigator.unsetTags()}else{if(!y.libraryData.isPaginationOperation){var U=!y.libraryData.isFilterOperation;B._tagNavigator._setSubjectTags(O,y.libraryData.containerType,U);B._tagNavigator.activateTaggerProxy()}}}var G=e.isSearchInProgress();if(y.searchQuery&&R){e.setInfoIndex(R);y.libraryData.newCurrentContainer.options.contentAvailable=true}B._libraryContentView._endContentSelect();var V=null;if(m.getCurrentLibrary()){V=m.getCurrentLibrary().getID();if(y.searchQuery){V=m.getCurrentLibrary().options.mxid}}if(V!==y.containerId){B._libraryContentView._endRefreshView();B._libraryContentView._endLoadAndSelect();return}var F=null;if(H===undefined||H===null){if(!G){B._libraryContentView.removeNodesInContent()}if(!y.searchQuery&&!endItemFilterSet){b.displayNotification({message:h.msg_error_contentnotavailable,className:"error"})}B._libraryContentView.maskContentDiv(false)}else{var L=[];if(B._refreshProductStructure){var T=B._libraryContentView.getPADTreeDocument().getRoots();var I=0;var N=T.length;for(I=0;I<N;I++){var Q=T[I];var P=Q.options.type;if(T[I].isExpanded()){L.push(Q)}}}var K=[];var J=!y.libraryData.isPaginationOperation;F=B._libraryContentView.displayContentNodes(H,L,y.libraryData.idsToSelect,J);if(B._refreshProductStructure&&L.length>0){B._refreshProductStructure=false;var S=B._libraryContentView.getPADTreeListView();B._libraryContentView.getPADTreeDocument().refresh({treelist:S,roots:K,cb:function(W){B._logger.log("Refresh PS : "+W.msg)}})}}B._libraryContentView._endLoadAndSelect();D.end();return F},function x(G){var H=G.err,F=G.serverErr;B._logger.log("WebService content, Err : "+H);B._libraryContentView.removeNodesInContent();if(B._tagNavigator&&C){B._tagNavigator.unsetTags()}var I;if(H&&H.type==="timeout"){I=h.msg_error_timeout}else{if(e.isSearchActive()&&F&&typeof F==="object"&&F.error&&F.error.errorCode){I=r.get(F.error.errorCode)}else{I=h.msg_error_contentnotavailable}}b.displayNotification({message:I,className:"error"});B._libraryContentView.maskContentDiv(false);B._libraryContentView._endLoadAndSelect();D.end()})},displayFavouriteLibraries:function(z){var y=f.createProbe("probeDisplayFavLibraries");var x=this;x._libraryContentView.maskContentDiv(true);q.getFavorites({onComplete:function(A){var B="";if(m.getCurrentLibrary()){B=m.getCurrentLibrary().getType()}if(B=="LibrarySection_favorite"){x._libraryContentView.displayFavouriteNodes(A,z);if(x._tagNavigator){x._tagNavigator._setSubjectTags(null,"LibrarySection_favorite",true);x._tagNavigator.activateTaggerProxy()}}else{x._endRefreshView()}x._libraryContentView.maskContentDiv(false);x._libraryContentView._endLoadAndSelect();y.end()},onFailure:function(A){x._logger.log("getFavorites, Err : "+A);x._libraryContentView.maskContentDiv(false);x._libraryContentView._endLoadAndSelect();y.end()}})},displayAllLibraries:function(y){var z=f.createProbe("probeDisplayAllLibraries");var C=this;var B=y.idsToSelect;var D=y.isPaginationOperation;C._libraryContentView.maskContentDiv(true);var A=C._libraryContentView.getSortingOrder();d.fetchAllLibraries({filters:C._tagNavigator?C._tagNavigator._getCurrentFilter():null,isStartFromBeg:!D,sortOrder:A}).then(function E(I){var J="";if(m.getCurrentLibrary()){J=m.getCurrentLibrary().getType()}if(J=="LibrarySection_AllLibraries"){I=typeof I==="string"?JSON.parse(I):I;var H=I.results?I.results:[];if(C._tagNavigator&&!D){var K=!y.isFilterOperation;C._tagNavigator._setSubjectTags(I.facets,"LibrarySection_AllLibraries",K);C._tagNavigator.activateTaggerProxy()}C._libraryContentView._endContentSelect();var G=!y.isPaginationOperation;var F=C._libraryContentView.displayContentNodes(H,null,B,G)}else{C._libraryContentView._endRefreshView()}C._libraryContentView._endLoadAndSelect();z.end();return F},function x(F){C._logger.log("WebService roots, Err : "+F);C._libraryContentView._endLoadAndSelect();z.end()})},refreshLibraryContent:function(){var A=this;var z=A.getView().getPADTreeDocument();if(z){z.keepExpandedState()}var x=m.getCurrentLibrary();var y=x.getType();if((!x.isVisible()&&!x.isFavorite)||y=="LibrarySection_AllLibraries"||y=="LibrarySection_favorite"){A.loadContentAndSelect(x)}},switchLibraryTreeNodeLabelToWriteView:function(x){var z=false;if(v.getTreeCont().getView().isTreeNodeModelInstance(x)&&(n.inFamilyLibrary(x.plmType))&&(this._libraryContentView.getPADTreeDocument())&&(x.getTreeDocument()===this._libraryContentView.getPADTreeDocument())){var y;if(this._libraryContentView.getActiveView()==="treelistview"){y=this._libraryContentView.getPADTreeListView()}var C=y?y.getManager():undefined;if(C){var B=C.getCell(x._getRowID(),"tree");var A=B?B.getView():undefined;if(A){A.switchToWriteView();z=true}}}return z},getView:function(){return this._libraryContentView}});return i});define("DS/LibraryEditor/views/LibraryTreeView",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/Tree/Tree","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Tree/TreeNodeView","DS/WebappsUtils/WebappsUtils","DS/LibraryEditor/models/LibraryTreeModel","DS/LibraryEditor/commands/LibraryOrderCmd","DS/LibraryEditor/utils/LibraryEditorUtil","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/LibraryEditor/commands/LibraryCommands","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADUtilsServices","DS/LibraryEditor/utils/Library_Clipboard","DS/LibraryEditor/service/LibraryDnDService","DS/LibraryEditor/utils/LibraryEditorEvents"],function(a,q,r,o,l,i,n,g,e,t,s,x,w,p,u,v,k,h,j,f,d,m){function b(y){return y._modelEvents}var c=q.extend(r,o,{name:"LibraryTreeView",_libraries_TreeDocument:null,_libraries_TreeView:null,_libraries_SortElmt:null,_rootNodeFavorite:null,_rootNodeLibraries:null,_commandProxy:null,_mode:"open",init:function(A,z){var B=this;B._parent(A);B._commandProxy=h.create();B._buildSkeleton();B._libraries_SortElmt=new s();var y=this._libraries_TreeView?this._libraries_TreeView.getDocument():undefined;this._libraries_TreeDocument=y;if(y){y.options.shouldBeEditable=x.shouldBeEditable;y.options.shouldAcceptDrag=function(){return false};y.options.shouldAcceptDrop=function(){return false};B._libraries_TreeDocument.onPreExpand(z._onPreExpandTreeNode.bind(z));B._libraries_TreeDocument.getXSO().onChange(function(F){var C=B._libraries_TreeDocument.getXSO().get();if(C&&C.length>0){var E=C[C.length-1];if(!E.getID){E.getID=function(){return this.id}}if(!E.getType){E.getType=function(){return this.plmType}}var D=p.getCurrentLibrary();if(D!==E){p.addInLibraryCSO(E,"TREE")}}})}m.onPageToolBarExpand(function(){B._mode="open";w.getContent().getView().elements.padshell.togglePanel("left");m.notifyPageToolBarExpanded()});m.onPageToolBarCollapse(function(){B._mode="close";w.getContent().getView().elements.padshell.togglePanel("left");m.notifyPageToolBarCollapse()});m.onTaggerOpen(function(){w.getContent().getView().elements.padshell._modelEvents.publish({event:"triptych-hide-panel",data:"left"});m.notifyPageToolBarCollapse()});m.onTaggerClose(function(){if(B._mode==="open"){w.getContent().getView().elements.padshell._modelEvents.publish({event:"triptych-show-panel",data:"left"});m.notifyPageToolBarExpanded()}else{w.getContent().getView().elements.padshell._modelEvents.publish({event:"triptych-hide-panel",data:"left"});m.notifyPageToolBarCollapse()}})},createLibrarySections:function(){var z=e.getWebappsAssetUrl("LibraryEditor","icons/libraryfavorites.png");var A={useAsyncPreExpand:true};A.label=k.name_Section_FavoriteLibraries;A.icons=[z];A.children=[];A.id="";A.plmType="LibrarySection_favorite";this._rootNodeFavorite=this._createTreeNodeModel(A,this._libraries_TreeDocument);var B=e.getWebappsAssetUrl("LibraryEditor","icons/librarysectionall.png");var y={useAsyncPreExpand:true};y.label=k.name_Section_AllLibraries;y.icons=[B];y.children=[];y.id="";y.plmType="LibrarySection_AllLibraries";this._rootNodeLibraries=this._createTreeNodeModel(y,this._libraries_TreeDocument);this.dispatchEvent.call(this,"onReady")},_buildSkeleton:function(){var z=this;if(!a.is(this.elements.container)){this.elements.container=UWA.createElement("div",{"class":this.getClassNames()+"_container"});if(this.getOption("css_view_class")){this.elements.container.addClassName(this.getOption("css_view_class"))}this.elements.libraryTreeView_container=UWA.createElement("div",{"class":this.getClassNames()+"_treeview_container"}).inject(this.elements.container);var y={apiVersion:2,useAsyncPreExpand:true,height:"auto",defaultCellHeight:40,onContextualMenuReady:this.onContextualMenuReady.bind(this),columns:[{dataIndex:"tree",onCellChange:this._onCellChange.bind(this)}],onDropCell:this._onDropCell.bind(this),onDropBlank:this._onDropBlank.bind(this),isEditable:true,enableScrollOnDrag:true};y.selection={toggle:false,canMultiSelect:false,unselectAllOnEmptyArea:false,};y.cellClass=g.extend({init:function(B){this._parent(B)},updateInternalParameters:function(){this._parent();var B=this.getCellInfos();if(!B.isHeader){if(B.nodeModel.options.isBeingCut){B.cellView.getContent().addClassName("library-state-is-being-cut")}else{B.cellView.getContent().removeClassName("library-state-is-being-cut")}}}});var A=new l(y).inject(this.elements.libraryTreeView_container);this._libraries_TreeView=A;A.onNodeDblClick(function(B){if(B.nodeModel._isExpanded===true){B.nodeModel.collapse()}else{B.nodeModel.expand()}})}},_onDropCell:function(B,y){if(typeof(window.dscef)!=="undefined"){LibraryAlert.displayNotification({message:k.msg_warning_dndnotsupported,className:"warning"})}else{var z=y.nodeModel;if(z.plmType==="RootLibrary"){LibraryAlert.displayNotification({message:k.msg_warning_dndnotsupported,className:"warning"})}else{var A=this;f.SetAsExternalDrop(true);if(A._timerDragEnter){clearTimeout(A._timerDragEnter);A._timerDragEnter=null}A._currentDragEnterLibrary=null;d.performDropOnLibraryEditorNode(z,B);d.setDragFrom("")}}},_onDropBlank:function(z,y){if(typeof(window.dscef)!=="undefined"){LibraryAlert.displayNotification({message:k.msg_warning_dndnotsupported,className:"warning"})}else{d.setDragFrom("")}},_populateContentSection:function(y,z){var A=this;y.forEach(function(B){var D=u.convertToExaleadDataFormatFederated(B);var C={useAsyncPreExpand:true};C.label=D.label;C.icons=[{iconName:"library-class"}];C.children=[];C.id=D.physicalid;C.mxid=D.mxid;C.plmType="Library";C.created=D.created;if(UWA.is(D.publishOnConnect)){C.publishOnConnect=D.publishOnConnect}var E=A._createTreeNodeModel(C,z)});A._libraries_SortElmt.sortingNodesUnsensitiveCase()},_populateAllLibrariesSection:function(A,y){var z=this;A.forEach(function(D){var C={useAsyncPreExpand:true};C.label=D.label;C.icons=[{iconName:"library"}];C.children=[];C.id=D.physicalid;C.mxid=D.mxid;C.plmType="RootLibrary";C.created=D.created;if(UWA.is(D.publishOnConnect)){C.publishOnConnect=D.publishOnConnect}var B=z._createTreeNodeModel(C,y)});z._libraries_SortElmt.sortingNodesUnsensitiveCase()},_populateFavoriteSection:function(C){var A=this;var y=C;var B=e.getWebappsAssetUrl("LibraryEditor","icons/library_perso.png");var z={useAsyncPreExpand:false};y.forEach(function(D){z.label=D.label;if(D.plmType==="RootLibrary"){z.icons=[{iconName:"library"}]}else{z.icons=[{iconName:"library-class"}]}z.children=null;z.id=D.physicalid;z.mxid=D.mxid;z.plmType=D.plmType?D.plmType:"Library";z.isFavorite=true;var E=A._createTreeNodeModel(z,A._rootNodeFavorite);E.setState({state:"noChildren"})});A._rootNodeFavorite._isPopulated=true},_addFavouriteNode:function(A){var z=this;var B=e.getWebappsAssetUrl("LibraryEditor","icons/library_perso.png");var y={useAsyncPreExpand:false};y.label=A.label;if(A.plmType==="RootLibrary"){y.icons=[{iconName:"library"}]}else{y.icons=[{iconName:"library-class"}]}y.mxid=A.mxid;y.children=null;y.id=A.physicalid;y.plmType=A.plmType?A.plmType:"Library";y.type=A.type;y.isFavorite=true;var C=z._createTreeNodeModel(y,z._rootNodeFavorite);C.setState({state:"noChildren"})},_createTreeNodeModel:function(B,I,D){var C=this;var A=I instanceof i;var F=B.publishOnConnect;delete B.publishOnConnect;var G=new n(B);G.id=B.id;G.mxid=B.mxid;G.plmType=B.plmType;if(B.isFavorite){G.isFavorite=true}if(B.created){G.created=B.created}G._instanceType="LibraryEditor/TreeNodeModel";G._loadingcounter=0;G.getID=function(){var M=this.id;if(!M||M===""){M=this.plmType}return M};G.getMXID=function(){var M=this.mxid;if(!M||M===""){M=this.plmType}return M};G.options.oldLabel=B.label;G.pathId=(A?"root":I.pathId)+","+G.getID();if(F==="TRUE"){var z=e.getWebappsAssetUrl("LibraryEditor","icons/libraryPublishBadge.png");G.setBadges({bottomRight:z})}if(w.isCustomizedEnv()){var E=w.getActiveLibrary(),y=E.id,J=E.disabledId;if(y===G.id&&B.isFavorite!==true){var L=e.getWebappsAssetUrl("LibraryEditorCustomization","icons/library_active.png");G.setBadges({bottomLeft:L})}else{if(J===G.id&&B.isFavorite!==true){var L=e.getWebappsAssetUrl("LibraryEditorCustomization","icons/library_active_disabled.png");G.setBadges({bottomLeft:L})}}}G.onPostExpand(function(N){if(N.data&&N.data.expandAll){return}var O=[];if(this&&this.getChildren){var M=this.getChildren();if(UWA.is(M,"array")){M.forEach(function(P){O.push(P.getID())})}}t.libraryStructurePreference.add(this.pathId,O)});G.onPostCollapse(function(M){t.libraryStructurePreference.remove(this.pathId)});b(G).subscribe({event:"removeChild",},function(M){if(G.isExpanded()&&G.isVisible()){var N=M.nodeModel;if(!N&&M.data){N=M.data.nodeModel}if(N){t.libraryStructurePreference.remove(N.pathId)}}});b(G).subscribe({event:"addChild",},function(M){if(G.isExpanded()&&G.isVisible()){var N=M.nodeModel;if(!N&&M.data){N=M.data.nodeModel}if(N&&N._isExpanded){t.libraryStructurePreference.add(N.pathId)}}});if(A){I.addRoot(G)}else{I.addChild(G,D)}var H=function(M){if(A){G[M]()}else{if(I.isExpanded()){if(G.isVisible()){if(M==="select"){C._libraries_TreeDocument.getXSO().empty()}}if(M!=="expand"||(!G.isExpanded()&&G.getState()!=="expanding")){G[M]()}}else{b(I).subscribeOnce({event:"postExpand"},function(N){if(G.getState()!=="expanding"){if(M==="select"){C._libraries_TreeDocument.getXSO().empty()}G[M]()}})}}};var K=widget?widget.defaultSelectionPathFromWin:null;t.libraryStructurePreference.isExpanded(G.pathId,function(M){if(M||(K&&-1!=K.indexOf(G.pathId))){if(G.plmType==="LibrarySection_favorite"&&!C._rootNodeFavorite){C._rootNodeFavorite=G}H("expand")}});if(K){if(K==G.pathId){H("select")}}else{t.libraryStructurePreference.isSelected(G.pathId,function(M){if(M){H("select")}else{if(G.pathId===C._TreeNodeToBeAddedtoLibraryCSOWithoutSelection_pathId){p.addInLibraryCSO(G,"TREE");C._TreeNodeToBeAddedtoLibraryCSOWithoutSelection_pathId=undefined}}})}return G},_scrollToVisibleNode:function(y){var z=this._libraries_TreeView?this._libraries_TreeView.getManager():null;if(z&&(!z.isNodeInVisibleViewport(y)||!z.isNodeInVisibleViewport(y.getParent()))){z.scrollToNode(y,"middle")}},_scrollOnPostUpdateView:function(A){var z=this;var B=this._libraries_TreeView?this._libraries_TreeView.getManager():null;var y=t.libraryStructurePreference.doScrollAfterSelect(A.getID());if(B&&y){B.onPostUpdateViewOnce(function(){if(t.libraryStructurePreference.doScrollAfterSelect(A.getID())){z._scrollToVisibleNode(A);t.libraryStructurePreference.scrollAfterSelect("")}})}},_onCellChange:function(A){var C=A.nodeModel;var z=A.event.target.value||(A.event.dsModel&&A.event.dsModel.value);var B=C?C.options.oldLabel:"";if(!B){B=""}var y=x.validateLibraryRename(C,z,B);return y},onContextualMenuReady:function(C){var B;var D=C.cellView.getVirtualCoordinates();var A=C.nodeModel;var z=p.getSelectedNodes();var y=[];if(z.length){z.forEach(function(E){y.push(E)})}if(y.length){y.forEach(function(E){E.unselect()})}if(C.cellModel._isSelected===false){C.cellModel._isSelected=true;C.nodeModel.select(true)}if(C.cellModel._isSelected===true){if(A){B=v.GetContextualMenu(C,"TREE")}}return B},onViewChange:function(y){this.elements.container.removeClassName(y.previous.type);this.elements.container.addClassName(y.type)},getSortingContainer:function(){return this._libraries_SortElmt.elements.container},setObjectOnCompass:function(y){j.setObject_on_compass({nodes_2_open:y})},render:function(){return this},isTreeNodeModelInstance:function(y){return y instanceof n}});return c});define("DS/LibraryEditor/controllers/LibraryTreeController",["UWA/Class","DS/Logger/Logger","DS/LibraryEditor/views/LibraryTreeView","DS/LibraryEditor/models/LibraryTreeModel","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/utils/LibraryAlert","DS/LibraryEditor/utils/LibraryEditorUtil","DS/LibraryEditor/utils/LibraryEditorEvents","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/PADUtils/PADProbes"],function(k,b,a,g,j,f,e,c,d,l,i,h){var m=k.extend({name:"LibraryTreeController",_libraryTreeView:null,_probeLoadElmt:null,_logger:null,_libraryContentView:null,init:function(n){this._probeLoadElmt=h.createProbe("loadTreeCont");i.setTreeCont(this);this._libraryTreeView=new a(n,this);this._libraryTreeView.createLibrarySections();this._logger=b.getLogger(m)},_OnTreeComponentReady:function(){var n=this;c.onCurrentLibraryChange(function(s){var v=h.createProbe("treeCont_updateUI");g.libraryStructurePreference.select(this.pathId);if(this.id&&this.id!==""&&l.inFamilyLibrary(this.plmType)){var t=j.getCurrentLibraryPath();var r=[];var w=Array.isArray(t)?t.length:0;for(var q=0;q<w-1;q++){r.push({resourceid:t[q].id,type:t[q].type})}var p={};if(w>=1){var u=w-1;if(t[u].id){p[t[u].id]={type:t[u].type,label:t[u].label}}}var o=[];if(s.currentNode&&!l.isSection(s.currentNode.getType())){s.currentNode.systemType=t[w-1].type;o=[s.currentNode]}n._libraryTreeView.setObjectOnCompass(o);n._libraryTreeView._commandProxy.select({paths:[[this.id]],attributes:p,libraryPath:r,doNotSetOnCompass:true})}else{if(this.plmType==="LibrarySection_AllLibraries"||this.plmType==="LibrarySection_favorite"){n._libraryTreeView._commandProxy.select({paths:[],attributes:{},libraryPath:[],doNotSetOnCompass:true})}}n._libraryTreeView._scrollOnPostUpdateView(s.currentNode);e.dipatchSecurityContextAndLibrary();v.end()});this._probeLoadElmt.end()},destroy:function(){this._logger.log("destroy");this._parent()},_onPreExpandTreeNode:function(s){var q=s.data.nodeModel;if(q.preExpandInProgress){return}q.preExpandInProgress=true;function p(){q.preExpandInProgress=false;q.preExpandDone()}var r=this;var o=q.options.id;var t=q.options.id;g.setExpandAllOperation(s.data.expandAll);if(l.inFamilyLibrary(q.plmType)&&(!q.isFavorite)){q.removeChildren();g.fetchLibraryContents({parentNodeID:o,parentNodeMXID:t,parentPath:q.pathId}).then(function u(v){if(v&&v.length>0){r._libraryTreeView._populateContentSection(v,q)}if(q.options.children===null){q.options.children=[]}p()},function n(v){p();r._logger.log("WebService libraries Err : "+v)})}else{if(q.plmType=="LibrarySection_AllLibraries"){q.removeChildren();g.fetchAllLibraries(q.pathId).then(function u(v){r._libraryTreeView._populateAllLibrariesSection(v,q);p()},function n(v){p();r._logger.log("WebService roots Err : "+v)})}else{if(q.plmType==="LibrarySection_favorite"){r._refreshFavoriteSection({onComplete:function(){p()}})}else{p()}}}},_refreshFavoriteSection:function(n){var o=this;if(!o._libraryTreeView._rootNodeFavorite){o._logger.log("LibraryTreeCont : LibrarySection_favorite node does not yet exist");if(n&&n.onFailure){n.onFailure(new Error("LibrarySection_favorite node does not yet exist"))}}else{o._libraryTreeView._rootNodeFavorite.removeChildren();o._libraryTreeView._rootNodeFavorite._isPopulated=false;g.getFavorites({onComplete:function(p){o._libraryTreeView._populateFavoriteSection(p);if(n&&n.onComplete){n.onComplete()}},onFailure:function(p){o._logger.warn("LibraryTreeCont : unable to initialize list of Favorite Libraries",p);f.displayNotification({message:d.msg_error_nopreferences,className:"error"});if(n&&n.onFailure){n.onFailure(p)}}})}},isLibraryAmongFavoriteLibraries:function(r){var n=false;if(r){var p=this._libraryTreeView._rootNodeFavorite.getChildren();if(p){for(var q=0;q<p.length;++q){var o=p[q];if(r==o.id){n=true;break}}}}return n},addFavorite:function(n){if(!n){o._logger.log("LibraryTreeCont unable to addFavorite, newFavoriteLibrary(s) is not define");return}var o=this;var p=Array.isArray(n)?n:[n];g.setFavorites({favoriteLibraries:p,onComplete:function(s){for(var q=0;q<s.length;++q){var r=s[q];o._libraryTreeView._addFavouriteNode(r);var t=r.label?r.label:"";f.displayNotification({message:d.replace(d.get("msg_info_favoriteadded"),{name1:t}),className:"primary"})}},onFailure:function(q){o._logger.warn("WebService setFavorites Err : "+q)}})},removeFavorite:function(n){var t=this;var p;var q=false;var u=t._libraryTreeView._rootNodeFavorite.getChildren();var s=Array.isArray(u)?u.length:0;for(var r=0;r<s;++r){var v=u[r];if(n.id==v.id){q=v.isSelected();p=n.name?n.name:"";t._libraryTreeView._rootNodeFavorite.removeChild(v);if(t._libraryTreeView._rootNodeFavorite.hasChildren()===false){t._libraryTreeView._rootNodeFavorite.withTransactionUpdate(function(){t._libraryTreeView._rootNodeFavorite.removeChildren();t._libraryTreeView._rootNodeFavorite.setState({state:"collapsed"})})}break}}var o="";if(j.getCurrentLibrary()){o=j.getCurrentLibrary().getType()}if(o=="LibrarySection_favorite"){i.getContent()._libraryContentView.removeNodeInContent(n.id)}g.removeFromFavorites({favoritesToRemove:n.id,onComplete:function(){f.displayNotification({message:d.replace(d.get("msg_info_favoriteremoved"),{name1:p}),className:"primary"});if(q){t._libraryTreeView._rootNodeFavorite.select()}},onFailure:function(w){t._logger.warn("WebService getFavorites Err : "+w);f.displayNotification({message:d.msg_error_nopreferences,className:"error"})}})},renameFavorite:function(s,r,o){var q=this;function p(u,t){u.prepareUpdate();u.setLabel(t);u.pushUpdate()}function n(){if(o){p(o,s.name)}f.displayNotification({message:d.replace(d.get("msg_error_rename"),{name1:s.name}),className:"error"})}g.getFavorites({onComplete:function(v){var w=v;var t=0;var x;for(var u=0;u<w.length;++u){x=w[u];if(s.id==x.physicalid){x.label=r;t=1;break}}if(t){g.setFavorites({favoriteLibraries:[{id:x.physicalid,name:x.label}],renamed:true,onComplete:function(z){if(!o||!o._instanceType||o._instanceType!="LibraryEditor/TreeNodeModel"){var y=q._libraryTreeView._rootNodeFavorite.getChildren();y.forEach(function(A){if(A&&s.id==A.id&&s.name==A.getLabel()){p(A,r)}})}f.displayNotification({message:d.replace(d.get("msg_info_favoriterenamed"),{name1:s.name,name2:r}),className:"primary"})},onFailure:function(y){q._logger.warn("WebService setFavorites Err : "+y);n()}})}else{q._logger.warn("LibraryTreeCont favorite library to rename, not found in list");n()}},onFailure:function(t){q._logger.warn("WebService getFavorites Err : "+t);f.displayNotification({message:d.msg_error_nopreferences,className:"error"});n()}})},expandTreeAndSelectLibrary:function(A){var p=(A&&A.libraryToFindAndSelect)?A.libraryToFindAndSelect.id:undefined;var z=(A&&A.libraryToFindAndSelect)?A.libraryToFindAndSelect.mxid:undefined;var t=this;if(p){var x=t._getVisibleNodeById(p,null);if(x){var q=j.getCurrentLibrary();if(!A.doNotSelectInTree){t._libraryTreeView._scrollToVisibleNode(x);x.select(true)}else{j.addInLibraryCSO(x,"TREE")}if(A.onComplete){var r={libraryToFindAndSelect:A.libraryToFindAndSelect,correspondingTreeNodeModel:x};A.onComplete(r)}}else{var o=j.getCurrentLibrary();var u=j.getCurrentLibraryPath();var y=u.length;if(y===1&&u[0].type==="LibrarySection_AllLibraries"){var v="root,LibrarySection_AllLibraries";var w=v+","+p;g.libraryStructurePreference.add(v);g.libraryStructurePreference.select(w);g.libraryStructurePreference.scrollAfterSelect(p);g.libraryStructurePreference.remove(w);var n=t._libraryTreeView._rootNodeLibraries;if(n.getState()!=="expanding"){n.expand()}}else{if(y===1&&u[0].type==="LibrarySection_favorite"){g.getLibraryPathLength({pid:p,onComplete:function(B){y=B;s()},onFailure:function(B){}})}else{s()}}}}else{t._logger.log("expandTreeAndSelectLibrary error : libraryToFindAndSelect is undefined");if(A.onFailure){A.onFailure(new Error("Tree exploration stopped, libraryToFindAndSelect is undefined"))}}function s(){var B=function(D){var F=false;var C=j.getCurrentLibrary();if(C!==o){F=true;if(D.onGiveUp){var E={libraryToFindAndSelect:D.libraryToFindAndSelect};D.onGiveUp(E)}}return F};g.getLibraryPath({depth:y,pid:p,onComplete:function(K){if(!B(A)){if(t._libraryTreeView._rootNodeLibraries){var O=null;var P=null;var R=t._libraryTreeView._rootNodeLibraries;var E=R.pathId;for(var F=0;F<K.length;++F){var G=K[F];var C=G.physicalid;var D="";var J=G.flattenedtaxonomies;if(J){if((J[0]==="types/Classification")&&(J[1]==="types/General Class")){D="Library"}else{if((J[0]==="types/Libraries")&&(J[1]==="types/General Library")){D="RootLibrary";P=C}}}var I=G.name;var L={id:C,name:I,type:D};if(C){if(!O){var N=t._getVisibleNodeById(C,R);if(N&&N.isVisible()){R=N;E=N.pathId}else{O=R}}if(O){var M=E;g.libraryStructurePreference.add(M);R=null;E=E+","+C}}else{t._logger.log("unexpected undefined parentObjectId")}}if(!P){if(A.onFailure){A.onFailure(new Error(d.msg_error_NoVisibleRootLibrary))}}else{if(O){var Q=M+","+p;if(!A.doNotSelectInTree){g.libraryStructurePreference.select(Q);g.libraryStructurePreference.scrollAfterSelect(p)}else{g.libraryStructurePreference.select("");g.libraryStructurePreference.scrollAfterSelect("");t._TreeNodeToBeAddedtoLibraryCSOWithoutSelection_pathId=Q}g.libraryStructurePreference.remove(Q);if(O.getState()!=="expanding"){O.expand()}if(A.onComplete){var H={libraryToFindAndSelect:A.libraryToFindAndSelect};A.onComplete(H)}}else{console.log("   Damnation, no firstUnexpandedTreeNodeModelParentFound");if(A.onFailure){A.onFailure(new Error(d.msg_error_TreeExpandCancelledInternalError))}}}}else{t._logger.log("  No LibrarySection_AllLibraries to start expandTreeAndSelectLibrary");if(A.onFailure){A.onFailure(new Error(d.msg_error_TreeExpandCancelledNotReady))}}}},onFailure:function(C){t._logger.log("WebService getLibraryPath Err : "+C);if(A.onFailure){A.onFailure(C)}}})}},_getVisibleNodeById:function(v,n){var u=(n)?n:this._libraryTreeView._rootNodeLibraries;var o=null;var s=this;if(u&&u.isVisible()){if(u.getID()===v){o=u}else{if(u.isExpanded()){var r=u.getChildren();if(Array.isArray(r)&&r.length>=1){for(var p=0;p<r.length;p++){var t=r[p];if(t){if(t.id==v){o=t;break}else{var q=s._getVisibleNodeById(v,t);if(q&&q.isVisible()){o=q;break}}}}}}}}return o},refreshLibraryTree:function(){var n=this;if(n._libraryTreeView._rootNodeFavorite.isExpanded()){n._libraryTreeView._rootNodeFavorite.collapse();n._libraryTreeView._rootNodeFavorite.expand()}if(n._libraryTreeView._rootNodeLibraries.isExpanded()){n._libraryTreeView._rootNodeLibraries.collapse();n._libraryTreeView._rootNodeLibraries.expand()}},switchLibraryTreeNodeLabelToWriteView:function(n){var o=false;if(this._libraryTreeView.isTreeNodeModelInstance(n)&&(l.inFamilyLibrary(n.plmType))&&(n.getTreeDocument()===this._libraryTreeView._libraries_TreeDocument)&&this._libraryTreeView._libraries_TreeView){var r=this._libraryTreeView._libraries_TreeView.getManager();if(r){var q=r.getCell(n._getRowID(),"tree");var p=q?q.getView():undefined;if(p){p.switchToWriteView();o=true}}}return o},getView:function(){return this._libraryTreeView}});return m});define("DS/LibraryEditor/views/LibraryIdCardView",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","DS/LibraryEditor/models/LibraryIdCardModel","DS/LibraryEditor/utils/LibraryEditorcontrol","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/views/LibraryPathNavigator","DS/LibraryEditor/views/LibrarySearchInContext","DS/LibraryEditor/utils/LibrarySearch","DS/ENOXPageToolBar/js/PageToolBar","DS/LibraryEditor/utils/LibraryEditorEvents"],function(f,d,h,l,g,c,j,k,e,a,i,b){var m=d.extend(h,{name:"LibraryIdCardView",_currentPathNodes:null,_pageToolBar:null,init:function(n){this._parent(n);this._buildSkeleton(n.parentDiv);this.dispatchEvent.call(this,"onReady")},_buildLibraryPath:function(n){if(!this._LibraryPathNavigator){this._LibraryPathNavigator=new k({pathCont:this.elements.titleIdCard_container,pathNodes:n})}else{this._LibraryPathNavigator.flush();this._LibraryPathNavigator._buildPathNavigator(n)}if(n.length>0){this.elements.searchInContext?this.elements.searchInContext.changeLibraryPlaceholder(n[0].getLabel()):null}},_buildSkeleton:function(s){var q=this;q.topRightSideDiv=document.getElementsByClassName("LibraryEditor_top_right_side_div");if(!f.is(this.elements.container)){this.elements.container=UWA.createElement("div",{"class":this.getClassNames()});if(this.getOption("css_view_class")){this.elements.container.addClassName(this.getOption("css_view_class"))}this.elements.titleIdCard_container=UWA.createElement("div",{"class":"LibraryEditor_title_IdCard"}).inject(this.elements.container);this.elements.searchSumIdCard_container=UWA.createElement("div",{"class":"LibraryEditor_title_IdCard LibraryEditor_sumSearch"}).hide().inject(this.elements.container);var p=UWA.createElement("span",{"class":"LibraryEditor_title_titleSearch"}).inject(this.elements.searchSumIdCard_container);var n=UWA.createElement("span",{"class":"LibraryEditor_title_DateSearch"}).inject(this.elements.searchSumIdCard_container);a.onSearchResult(function(x){if(x){var w=this.getNumberHits();q.elements.titleIdCard_container.hide();q.elements.searchSumIdCard_container.show();var v=c.replace(c.searchResultSum,{numberHits:w,s:w>1?"s":""});p.setText(v);var t=a.getDateLastIndexation();var y="";if(t){var u=new Date();var z=(u-t)/1000/3600;if(z>24||t.getDay()!=u.getDay()){y=t.toLocaleString()}else{y=t.toLocaleTimeString()}var y=c["Last index:"]+" "+y}n.setText(y)}else{q.elements.titleIdCard_container.show();q.elements.searchSumIdCard_container.hide();q.updateDisplayPath()}});this.elements.searchInContext=new e({events:{onSearch:function(v){var t=g.getContent();var u=j.getCurrentLibrary();if(u){t.loadContentAndSelect(u)}},onSearchSwitch:function(t){if(t){UWA.extendElement(document.body).addClassName("LibraryEditor_SearchActive")}else{UWA.extendElement(document.body).removeClassName("LibraryEditor_SearchActive")}}}}).show();this.elements.searchInContext.inject(this.elements.container);var r={withInformationButton:true,withWelcomePanelButton:true,parentContainer:s,modelEvents:b.getModelEvents()};this._pageToolBar=new i(r);this._pageToolBar.render().inject(s);var o=this._pageToolBar.getBodyContent();this.elements.container.inject(o);this.topRightSideDiv[0].addEventListener("contextmenu",this._rightClick)}},updateDisplayPath:function(){if(this._LibraryPathNavigator){this._LibraryPathNavigator._resize(l.getPathNodes())}},render:function(){return this},_rightClick:function(n){if(n.stopPropagation){n.stopPropagation()}if(n.preventDefault){n.preventDefault()}return false}});return m});define("DS/LibraryEditor/controllers/LibraryIdCardController",["UWA/Core","UWA/Class","DS/LibraryEditor/views/LibraryIdCardView","DS/LibraryEditor/models/LibraryIdCardModel","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryEditorEvents","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/views/LibraryPathNavigator","DS/LibraryEditor/views/LibrarySearchInContext","DS/LibraryEditor/utils/LibrarySearch","DS/PADUtils/PADProbes"],function(e,i,m,l,j,b,f,g,h,c,a,d){var k=i.extend({name:"LibraryIdCardController",_probeLoadElmt:null,_libraryIdCardView:null,init:function(n){this._probeLoadElmt=d.createProbe("loadIdCard");f.setIdCardCont(this);this._libraryIdCardView=new m(n)},_OnIdCardComponentReady:function(){var n=this;b.onCurrentLibraryChange(function(o){n.setCurrentLocation()});n._probeLoadElmt.end()},setCurrentLocation:function(){var p=d.createProbe("idcard_updateUI");var n=l.getNewPathNodes();var q=n[0];var o=g.getCurrentLibrary();if(o&&o.getID()===q.getID()&&!o.options.mxid){o.options.mxid=q.options.mxid}this.manageSearchVisibility(o);this._libraryIdCardView._buildLibraryPath(n);p.end()},switchSearch:function(n){this._libraryIdCardView.elements.searchInContext?this._libraryIdCardView.elements.searchInContext.switchSearch(n):null},manageSearchVisibility:function(n){var o=this;if(!o._isSearchAvailable(n)){o._libraryIdCardView.elements.searchInContext.hide()}else{o._libraryIdCardView.elements.searchInContext.show()}},updateDisplayPath:function(){this._libraryIdCardView.updateDisplayPath(l.getPathNodes())},_isSearchAvailable:function(o){if(!o){o=g.getCurrentLibrary()}if(!o){return false}var n=j.isSection(o.getType());return !n&&o.options.mxid&&o.options.contentAvailable!==false},getView:function(){return this._libraryIdCardView}});return k});