function showModalDialog(){console.log("Need to remove this in future FDs");return false}define("DS/ENORouteMgmt/Views/Modals/ModalNeedOwnerReview",["UWA/Controls/Abstract","UWA/Controls/Input","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/W3DXComponents/Views/Temp/TempItemView","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(c,f,i,g,a,e,d,h){var b=c.extend({init:function(j){this._parent(j);var k=j.model.get("reviewersComments");this.resetModal(k);this.model=j.model;this._alertFailure=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"});this._alertSuccess=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});this._alertWarning=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"warning"})},showModal:function(){var j=this;window.savemodelRef=this.modal;this.modal.inject(document.body);this.modal.show()},getFooter:function(){var l=this;var k=new e({value:h.accept,className:"primary",events:{onClick:function(){l.onPromoteOrDemote(l.modal.getBody().getChildren()[0].value,"promote")}}});var j=new e({value:h.reject,className:"default",events:{onClick:function(n){l.onPromoteOrDemote(l.modal.getBody().getChildren()[0].value,"demote")}}});var m=new e({value:h.cancel,className:"default",events:{onClick:function(n){l.onCancelCalled()}}});return[k,j,m]},onPromoteOrDemote:function(k,p){var q=this.model,r=q.collection,n=this._alertFailure,l=this._alertSuccess,u=this._alertWarning,m,j,t;m={taskOwnerReviewAction:p,taskOwnerReviewComments:k};j=widget.data.csrf;var s={updateAction:"REVISE",dataelements:m};var o=new Array();o.push(s);t={csrf:j,data:o,};q.promoteOrDemote(t);this.modal.destroy();window.savemodelRef=null;this.resetModal()},onCancelCalled:function(){this.modal.destroy();this.resetModal();window.savemodelRef=null},resetModal:function(j){this.modal=new g({closable:true,header:h.requiresOwnerReview,body:'<textarea name="comments" value="" placeholder="'+h.reviewCommentsPlaceHolder+'" class="form-control form-control-root" rows="4">'+j+"</textarea>",footer:this.getFooter()})},onDestroy:function(){this._alertFailure.destroy();this._alertSuccess.destroy()}});return b});define("DS/ENORouteMgmt/Views/Sets/TaskContentSet",["DS/W3DXComponents/Views/Layout/GridScrollView","DS/W3DXComponents/Views/Layout/ListView","DS/W3DXComponents/Views/Layout/TableScrollView","DS/W3DXComponents/Views/Item/SetView","DS/W3DXComponents/Views/Item/TileView","UWA/Core","i18n!DS/W3DXComponents/assets/nls/ContentSet","css!DS/W3DXComponents/W3DXComponents"],function(i,d,h,c,b,e,g){var f="content-set";var a=c.extend({name:f,defaultOptions:{actions:{},switcher:{},detail:{},contents:{defaultView:"tile",views:[{id:"tile",title:g.titleTileView,view:i,itemView:b},{id:"table",title:g.titleTableView,view:h},{id:"list",view:d,selectionMode:"oneToOne"}]}},getSwitcherViewOptions:function(){var j=e.clone(this._parent.apply(this,arguments));j.buttons.pop();return j},onPositionChange:function(j,k){switch(k){case"left":this.minimize();break;case"right":this.maximize();break;default:this.maximize();break}},onMinimized:function(){this.dispatchEvent("onSwitch",[null,"list"])},onMaximized:function(){var j=this.switcherView.getValue();this.dispatchEvent("onSwitch",[null,j])}});return a});define("DS/ENORouteMgmt/Views/Modals/ModalRemoveContent",["UWA/Controls/Abstract","UWA/Controls/Input","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/W3DXComponents/Views/Temp/TempItemView","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(c,f,i,g,b,e,d,h){var a=c.extend({init:function(j){this._parent(j);this.resetModal();this.model=j.model;this._alertFailure=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"});this._alertSuccess=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});this._alertWarning=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"warning"})},showModal:function(){var j=this;window.savemodelRef=this.modal;this.modal.inject(document.body);this.modal.show()},getFooter:function(){var k=this;var j=new e({value:h.remove,className:"primary",events:{onClick:function(){k.onRemoveCalled()}}});var l=new e({value:h.cancel,className:"default",events:{onClick:function(m){k.onCancelCalled()}}});return[j,l]},onRemoveCalled:function(){var k=this.model,n=k.collection,l=this._alertFailure,j=this._alertSuccess,m=this._alertWarning;k.removeContent();this.modal.destroy();this.resetModal();window.savemodelRef=null},onCancelCalled:function(){this.modal.destroy();this.resetModal();window.savemodelRef=null},resetModal:function(){this.modal=new g({closable:true,header:h.removeContent,body:h.removeContentDetail,footer:this.getFooter()})},onDestroy:function(){this._alertFailure.destroy();this._alertSuccess.destroy()}});return a});define("DS/ENORouteMgmt/Views/Modals/ModalStopRoute",["UWA/Controls/Abstract","UWA/Controls/Input","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/W3DXComponents/Views/Temp/TempItemView","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(c,f,i,g,b,e,d,h){var a=c.extend({init:function(j){this._parent(j);this.resetModal();this.model=j.model;this._alertFailure=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"});this._alertSuccess=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});this._alertWarning=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"warning"})},showModal:function(){var j=this;window.savemodelRef=this.modal;this.modal.inject(document.body);this.modal.show()},getFooter:function(){var k=this;var m=new e({value:h.yes,className:"primary",events:{onClick:function(){k.onStopRouteCalled(true)}}});var j=new e({value:h.no,className:"default",events:{onClick:function(n){k.onStopRouteCalled(false)}}});var l=new e({value:h.Cancel,className:"default",events:{onClick:function(n){k.onCancelCalled()}}});return[m,j,l]},onStopRouteCalled:function(j){var l=this.model,o=l.collection,m=this._alertFailure,k=this._alertSuccess,n=this._alertWarning;l.stopRoute(j);this.modal.destroy();window.savemodelRef=null;this.resetModal()},onCancelCalled:function(){this.modal.destroy();window.savemodelRef=null;this.resetModal()},resetModal:function(){this.modal=new g({closable:true,header:h.stopRoute,body:h.demoteConnectedObjects,footer:this.getFooter()})},onDestroy:function(){this._alertFailure.destroy();this._alertSuccess.destroy()}});return a});define("DS/ENORouteMgmt/Views/Inputs/SelectPreserveTaskOwner",["UWA/Core","DS/Core/Core","DS/UIKIT/Input","DS/UIKIT/Input/Toggle","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(f,d,b,e,c){var a=b.extend({defaultOptions:{placeholder:c.selectScope,fileBannedChars:["'","#","$","@","%"],multiple:false},routeTemplate:{},socket:null,init:function(g){this._parent(g)},buildInput:function(){var g=f.createElement("div",{"class":"eno-scope-search",html:this.options.text});this.mLabelElement=f.createElement("label",{html:c.PreserveTaskOwnerLabel}).inject(g);this.mLabelReqElement=f.createElement("span",{html:" *","class":"label-field-required"}).inject(this.mLabelElement);this.mCheckElementRetain=f.createElement("div",{"class":"eno-scope-input input-group"}).inject(g);this.options.preserveTaskOwner="False";new e({type:"radio",value:"False",name:"preserveTaskOwner",className:"primary",label:c.PreserveTaskOwnerSelect2,dataHolder:this,events:{onChange:function(){this.options.dataHolder.options.preserveTaskOwner="False"}}}).check().inject(this.mCheckElementRetain);this.mCheckElementReset=f.createElement("div",{"class":"eno-scope-input input-group"}).inject(g);new e({type:"radio",value:"True",name:"preserveTaskOwner",className:"primary",label:c.PreserveTaskOwnerSelect1,dataHolder:this,events:{onChange:function(){this.options.dataHolder.options.preserveTaskOwner="True"}}}).inject(this.mCheckElementReset);g.addEventListener("dragover",this.onInputDragOver.bind(this),false);g.addEventListener("dragleave",this.onInputDragLeave.bind(this),false);g.addEventListener("drop",this.onInputDrop.bind(this),false);return g},clear:function(){this.elements.container.removeClassName("error");this.elements.container.setText(this.options.placeholder)},onInputDragOver:function(g){},onInputDragLeave:function(g){},onInputDrop:function(g){},onInputChange:function(g){this.routeTemplate=g},getValue:function(){return this.routeTemplate}});return a});define("DS/ENORouteMgmt/Views/FiltersAdapter",["UWA/Core","DS/UIKIT/Mask"],function(b,c){function a(f,d){var e=d;return f.extend({setup:function(h){var g=this._externalEvents={onTaggerProxyFilterChange:function(){this.reload()},onSearch:function(i){this.reload()},onResetSearch:function(){this.reload()}};if(this.collection){this.listenTo(this.collection,g)}return this._parent.apply(this,arguments)},destroy:function(g){if(this.isDestroyed){return}if(this.collection){this.stopListening(this.collection,this._externalEvents)}return this._parent.apply(this,arguments)},reload:function(){var g=this,i,h=e?b.clone(e,false):{};c.mask(this.container);this.collection.state.totalRecords=null;i=h.onComplete;h.onComplete=function(){if(i){i(arguments)}c.unmask(g.container)};this.collection.getFirstPage(h)}})}return a});define("DS/ENORouteMgmt/Views/ModelForm",["UWA/Core","UWA/Utils","UWA/Class/Listener","DS/W3DXComponents/Views/Temp/TempItemView","DS/UIKIT/Form","DS/W3DXComponents/Views/Temp/TempAutocomplete","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/UIKIT/UIKIT.css"],function(g,b,i,c,a,f,h){var e;function d(k,m,l,j){if(typeof k[m]==="function"){return k[m].apply(l,j)}else{return g.clone(k[m],false)}}e=a.extend(i,{_disabled:false,init:function(l){var j={},k=l.model;if(!k){throw new Error("You must specify a model")}this.model=l.model;delete l.model;Object.keys(l).map(function(m){j[m]=d(l,m,this.model)},this);this._parent.call(this,j);this.disable();this.syncFields();this._modelEvent={onChange:this._onModelChange,onDestroy:this._onModelDestroy};this.listenTo(this.model,this._modelEvent)},setValues:function(j,k){var l;if(this._disabled&&!k){return}else{if(k){this.setDisabled(false,true);l=true}}this._parent.call(this,j);l&&this.setDisabled();return this},setValue:function(k,m,l){var j={};j[k]=m;return this.setValues(j,l)},getValues:function(){var k=this._parent.apply(this,arguments),n,j,m,o=this.getFields();for(n=0,j=o.length;n<j;n++){m=o[n];if(m.getAttribute("type")==="autocomplete"){k[m.name]=m.getAttribute("data-key")}}return k},clear:function(k){if(this._disabled&&!k){return}var j=this.getValues();Object.keys(j).forEach(function(l){j[l]=""});this.setValues(j);this.dispatchEvent("onClear");return this},reset:function(){this.syncFields();this.dispatchEvent("onReset");return this},syncFields:function(){var j=this;this.getFields().forEach(function(k){j.syncField(k.getAttribute("name"))});return this},syncField:function(j){var l=this.getField(j),k;if(!l){return this}k=l.getAttribute("data-attr");if(g.is(k)){k=new Function(k);k=k.call(this.model)}else{k=this.model.get(j)}this.setValue(j,k,true);return this},setDisabled:function(l,m){var o,k,j,n;this._disabled=true;if(typeof l==="undefined"){l=true}j=this.getFields(true);for(k=0;k<j.length;k++){n=j[k];o=n.getAttribute("data-editable");!g.is(o)&&(o="true");if(o!=="false"&&o!=="true"){o=new Function(o);o=o.call(this.model)}if(!l&&(o==="false"||!o)&&!m){continue}if(n.options!=undefined){if(l){n.parentElement.addClassName("select-disabled")}else{n.parentElement.removeClassName("select-disabled")}}n.disabled=l;this._disabled=l}return this},createField:function(o,n,j,q){var p=this._parent.apply(this,arguments);var l=this,k=o.getContent();var m=k.dataset?k.dataset.icon:k.getAttribute("data-icon");if(m){if(g.is(m)){m=new Function(m);m=m.call(this.model)}var r=UWA.createElement("img",{"class":"type-icon",src:m});p.insertBefore(r,k)}return p},fields:g.extend(a.prototype.fields,{autocomplete:function(m,o){var k,l,n=o,j={id:"input-"+b.getUUID().substring(0,6)};k=new f(g.extend(j,m,true));k.getContent().getElement("input").addClassName("form-control").getParent().removeClassName("temp-autocomplete-searchbox");if(UWA.is(m.label)){l=UWA.createElement("label",{"for":k.getId(),text:UWA.i18n(m.label+n.options.labelSuffix)})}return n.createField.call(n,k,l)}}),_onModelChange:function(){if(this._disabled){return}this.syncFields()},_onModelDestroy:function(){this.disable();this.clear(true)},onSubmit:function(){this.disable()},onReset:function(){this.disable()},onEdit:function(){this.enable()},destroy:function(){this.stopListening(this.model,this._modelEvent);return this._parent.apply(this,arguments)}});return e});define("DS/ENORouteMgmt/Views/RouteSelectedContent",["UWA/Core","DS/Core/Core","DS/UIKIT/Input","DS/UIKIT/Badge","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(f,e,c,b,d){var a=c.extend({defaultOptions:{placeholder:d.searchTemplate,fileBannedChars:["'","#","$","@","%"],multiple:false},routeTemplate:{},socket:null,init:function(g){this._parent(g)},buildInput:function(){var i=this;console.log(this.options);var h="";var g=f.createElement("div",{"class":"eno-rt-content-input",html:this.options.text});this.mLabelElement=f.createElement("label",{html:d.routeContent}).inject(g);this.mTextElement=f.createElement("div",{"class":"form-control",}).inject(g);if(this.options.selectedNodes&&this.options.selectedNodes.length>0){this.options.selectedNodes.forEach(function(k){var j=new b({content:k.label,className:"default",selectable:true,}).inject(i.mTextElement)})}return g},clear:function(){this.elements.container.removeClassName("error");this.elements.container.setText(this.options.placeholder)},onInputClick:function(){},onInputDragOver:function(g){},onInputDragLeave:function(g){},onInputDrop:function(g){},onInputChange:function(g){this.routeTemplate=g},getValue:function(){return this.routeTemplate}});return a});define("DS/ENORouteMgmt/Utilities/Utils",["DS/UIKIT/Alert","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(e,f){var d={};d.formatDateString=function(h){var g,i;if(!d.isValidDate(h)){i=""}else{if(!UWA.is(d.getCookie("swymlang"))||!UWA.is(window.Intl)){i=h.toDateString()}else{g={weekday:"short",year:"numeric",month:"short",day:"2-digit"};i=new Intl.DateTimeFormat(d.getCookie("swymlang"),g).format(h)}}return i};d.isValidDate=function(g){return UWA.is(g,"date")&&!isNaN(g.getTime())};d.getCookie=function(g){var h="; "+document.cookie;var i=h.split("; "+g+"=");if(i.length>=2){return i.pop().split(";").shift()}};d.reloadFacetObjects=function(j,h){if(j){for(var g=0;g<j.length;g++){if(h.indexOf(j[g].reference)>-1){if(j[g].reference==="taskgraph"){if(j[g].view){j[g].view.destroy();j[g].view=null}}else{j[g].view.reload()}}}}};d.encodeHTMLEntites=function a(g){return g.toString().replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")};d.decodeHTMLEntites=function b(g){return g.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};d.initHelpSystem=function c(g,i){require(["DS/TopBarProxy/TopBarProxy"],function h(k){if(k[widget.id]){return}k[widget.id]=new k({id:widget.id});var n=true,m,l;var o=function j(){if(n){var p=d.getCookie("swymlang")||"English";n=false;l="http://help.3ds.com/HelpDS.aspx?P=11&L="+p+"&F="+g+"&contextscope=onpremise"}if(l){window.open(l,"_blank")}else{alert("The help system is not available. Please contact your system administrator.")}};k[widget.id].setContent({help:[{label:i,onExecute:o}]})})};d.getPrecondForContentSearch=function(){var l=widget.data.routeContentSearchTypes.split(",");var j="flattenedtaxonomies:(";var g=l.length;for(var h=0;h<g;h++){var k=l[h];j+='"types/'+k+'"';if(h<g-1){j+=" OR "}if(h===g-1){j+=")"}}return j};d.getSelectedTypesForRecentSearch=function(){var l=widget.data.routeContentSearchTypes.split(",");var g=[];var h=l.length;for(var j=0;j<h;j++){var k=l[j];g[j]=k}return g};return d});define("DS/ENORouteMgmt/commands/CommandAvailableOnSelect",["UWA/Core","UWA/Class","DS/PADUtils/PADContext"],function(d,b,c){var a=b.extend({init:function(e,f){this._parent(e,f);if(c.get()){this._check_select();c.get().getPADTreeDocument().getXSO().onChange(this._check_select.bind(this))}},_check_select:function(){var e=c.get().getPADTreeDocument().getXSO().get();var h=e.length;var f=h&&(this.options.cmd_selection_single!==true||h===1)?true:false;if(this.isAvailable!=null){var g=this;g.selectedObjects=e;f=this.isAvailable(e,function(j,i){if(i==g.selectedObjects){if(j){g.enable()}else{g.disable()}}})}else{if(f===true){this.enable()}else{this.disable()}}}});return a});define("DS/ENORouteMgmt/Views/Inputs/SearchSelectScope",["UWA/Core","UWA/Utils/InterCom","DS/Core/Core","DS/UIKIT/Input","DS/UIKIT/Input/Toggle","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(g,b,e,c,f,d){var a=c.extend({defaultOptions:{placeholder:d.selectScope,fileBannedChars:["'","#","$","@","%"],multiple:false},routeTemplate:{},socket:null,init:function(h){this._parent(h)},buildInput:function(){var h=g.createElement("div",{"class":"eno-scope-search",html:this.options.text});this.mLabelElement=g.createElement("label",{html:d.routeScope}).inject(h);this.mLabelReqElement=g.createElement("span",{html:" *","class":"label-field-required"}).inject(this.mLabelElement);this.mCheckElementAll=g.createElement("div",{"class":"eno-scope-input input-group"}).inject(h);this.options.scope="All";new f({type:"radio",value:"All",name:"scope",className:"primary",label:d.scopeAll,dataHolder:this,events:{onChange:function(){this.options.dataHolder.options.scope="All";this.options.dataHolder.searchButton.hide();this.options.dataHolder.mTextElement.hide()},onload:function(){this.options.dataHolder.searchButton.hide();this.options.dataHolder.mTextElement.hide()}}}).check().inject(this.mCheckElementAll);this.mCheckElementOrg=g.createElement("div",{"class":"eno-scope-input input-group"}).inject(h);new f({type:"radio",value:"Organization",name:"scope",className:"primary",label:d.scopeOrg,dataHolder:this,events:{onChange:function(){this.options.dataHolder.options.scope="Organization";this.options.dataHolder.searchButton.hide();this.options.dataHolder.mTextElement.hide()}}}).inject(this.mCheckElementOrg);new f({type:"radio",value:"Select scope",name:"scope",className:"primary",label:d.selectScope,dataHolder:this,events:{onChange:function(){this.options.dataHolder.options.scope="";this.options.dataHolder.searchButton.show();this.options.dataHolder.mTextElement.show()}}}).inject(h);this.mInputElement=g.createElement("div",{"class":"eno-scope-input input-group"}).inject(h);this.mTextElement=g.createElement("input",{"class":"form-control",placeholder:this.options.placeholder,disabled:"true"}).inject(this.mInputElement);this.searchButton=g.createElement("span",{"class":"input-group-addon fonticon fonticon-search disabled",events:{click:this.onInputClick.bind(this)}}).inject(this.mInputElement);this.searchButton.hide();this.mTextElement.hide();h.addEventListener("dragover",this.onInputDragOver.bind(this),false);h.addEventListener("dragleave",this.onInputDragLeave.bind(this),false);h.addEventListener("drop",this.onInputDrop.bind(this),false);return h},clear:function(){this.elements.container.removeClassName("error");this.elements.container.setText(this.options.placeholder)},selected_Objects_search:function(h){console.log(h);this.options.scope=h[0]["id"];this.mTextElement.value=h[0]["ds6w:label"];this.mTextElement.id=h[0]["id"]},onInputClick:function(){console.log("input clicked");var j;var i=g.Utils.getUUID();var h=this;h.is3DSearchActive=true;if(!g.is(j)){require(["DS/SNInfraUX/SearchCom"],function(l){j=l.createSocket({socket_id:i});var m={title:d.selectScope,role:"",mode:"furtive",default_with_precond:true,precond:'flattenedtaxonomies:"types/Workspace Vault" OR flattenedtaxonomies:"types/Workspace" OR flattenedtaxonomies:"types/Personal Workspace" OR flattenedtaxonomies:"types/Project Space" AND (identifier:(__QUERY__) OR label:(__QUERY__))',show_precond:false,multiSel:false,idcard_activated:false,select_result_max_idcard:false,itemViewClickHandler:"",app_socket_id:i,widget_id:i,search_delegation:"3dsearch",default_search_criteria:""};if(widget.getPreference("collab-storage")!=undefined){m.tenant=widget.getPreference("collab-storage").value}var k=["Workspace Vault","Workspace","Personal Workspace","Project Space"];m.recent_search={types:k};m.app_socket_id=i;m.widget_id=i;m.global_actions=[{id:"incontextHelp",title:d["search.help"],icon:"fonticon fonticon-help",overflow:false}];if(g.is(j)){j.dispatchEvent("RegisterContext",m);j.addListener("Selected_Objects_search",h.selected_Objects_search.bind(h));j.dispatchEvent("InContextSearch",m)}else{throw new Error("Socket not initialized")}})}},onInputDragOver:function(h){},onInputDragLeave:function(h){},onInputDrop:function(h){},onInputChange:function(h){this.routeTemplate=h},getValue:function(){return this.routeTemplate}});return a});define("DS/ENORouteMgmt/Views/Inputs/SearchTaskAssigneeData",["UWA/Core","UWA/Utils/InterCom","DS/Core/Core","DS/UIKIT/Badge","DS/UIKIT/Input","DS/UIKIT/Input/Toggle","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(h,b,f,c,d,g,e){var a=d.extend({defaultOptions:{placeholder:e.searchTaskAssignee,UserGroupPlaceholder:e.SearchUserGroupPlaceHolder,multiple:false},routeTemplate:{},socket:null,taskModel:null,init:function(i){this.taskModel=i.options.taskModel;this.collectionInfo=i.options.collectionInfo;this._parent(i)},buildInput:function(){var j=this;var i=h.createElement("div",{"class":"eno-rt-search",html:this.options.text});this.mLabelElement=h.createElement("label",{html:e.taskAssignee}).inject(i);this.mLabelReqElement=h.createElement("span",{html:" *","class":"label-field-required"}).inject(this.mLabelElement);new g({type:"radio",value:"Select Task assignee",name:"TaskAssignee",className:"primary",label:e.Person,dataHolder:this,events:{onChange:function(){if(typeof j.taskModel!="undefined"){j.taskModel.newAssignee=""}else{if(typeof j.collectionInfo.setTaskAssigneePID!="undefined"){j.collectionInfo.setTaskAssigneePID=""}}this.options.dataHolder.options.scope="";this.options.dataHolder.mTextElement.value="";this.options.dataHolder.searchButton.show();this.options.dataHolder.mTextElement.show();this.options.dataHolder.searchButton_UG.hide();this.options.dataHolder.mTextElement_UG.hide()},onload:function(){this.options.dataHolder.searchButton_UG.hide();this.options.dataHolder.mTextElement_UG.hide()}}}).check().inject(i);this.mInputElement=h.createElement("div",{"class":"eno-rt-input input-group"}).inject(i);this.mTextElement=h.createElement("input",{"class":"form-control",placeholder:this.options.placeholder,disabled:true}).inject(this.mInputElement);this.searchButton=h.createElement("span",{"class":"input-group-addon fonticon fonticon-search",events:{click:this.onInputClick.bind(this)}}).inject(this.mInputElement);new g({type:"radio",value:"Select Task assignee",name:"TaskAssignee",className:"primary",label:e.UserGroup,dataHolder:this,events:{onChange:function(){if(typeof j.taskModel!="undefined"){j.taskModel.newAssignee=""}else{if(typeof j.collectionInfo.setTaskAssigneePID!="undefined"){j.collectionInfo.setTaskAssigneePID=""}}this.options.dataHolder.options.scope="";this.options.dataHolder.mTextElement_UG.value="";this.options.dataHolder.searchButton_UG.show();this.options.dataHolder.mTextElement_UG.show();this.options.dataHolder.searchButton.hide();this.options.dataHolder.mTextElement.hide()}}}).inject(i);this.mInputElement_UG=h.createElement("div",{"class":"eno-rt-input input-group"}).inject(i);this.mTextElement_UG=h.createElement("input",{"class":"form-control",placeholder:this.options.UserGroupPlaceholder,disabled:true}).inject(this.mInputElement_UG);this.searchButton_UG=h.createElement("span",{"class":"input-group-addon fonticon fonticon-search",events:{click:this.onInputClickUserGroupSearch.bind(this)}}).inject(this.mInputElement_UG);this.searchButton_UG.hide();this.mTextElement_UG.hide();i.addEventListener("dragover",this.onInputDragOver.bind(this),false);i.addEventListener("dragleave",this.onInputDragLeave.bind(this),false);i.addEventListener("drop",this.onInputDrop.bind(this),false);return i},clear:function(){this.elements.container.removeClassName("error");this.elements.container.setText(this.options.placeholder)},selected_Objects_search:function(i){console.log(i);this.mTextElement.value=i[0]["ds6w:label"];if(typeof this.taskModel!="undefined"){this.taskModel.newAssignee=i[0].id}else{if(typeof this.collectionInfo.setTaskAssigneePID!="undefined"){this.collectionInfo.setTaskAssigneePID=i[0].id}}},selected_usergroup_search:function(i){console.log(i);this.mTextElement_UG.value=i[0]["ds6w:label"];if(typeof this.taskModel!="undefined"){this.taskModel.newAssignee=i[0].id}else{if(typeof this.collectionInfo.setTaskAssigneePID!="undefined"){this.collectionInfo.setTaskAssigneePID=i[0].id}}},onInputClick:function(){console.log("input clicked");var k;var j=h.Utils.getUUID();var i=this;i.is3DSearchActive=true;if(!h.is(k)){require(["DS/SNInfraUX/SearchCom"],function(p){k=p.createSocket({socket_id:j});var r={title:e.searchAssignee,role:"",mode:"furtive",default_with_precond:true,precond:'flattenedtaxonomies:"types/Person" AND current:"active"',show_precond:false,multiSel:false,idcard_activated:false,select_result_max_idcard:false,itemViewClickHandler:"",app_socket_id:j,widget_id:j,search_delegation:"3dsearch",default_search_criteria:""};var l=i.collectionInfo._modelKey._attributes.attrScope[2];if(l!=""&&typeof l!="undefined"){var q=i.collectionInfo._modelKey._attributes.attrScopeMembers;var o=q.length;r.precond="";r.precond+="(";for(var n=0;n<o;n++){if(q[n].indexOf("uuid")==-1){r.precond+="mxid:"+q[n]+" OR "}}r.precond=r.precond.substring(0,r.precond.length-4);r.precond+=") ";r.precond+='AND flattenedtaxonomies:"types/Person" AND current:"active"'}else{if(i.collectionInfo._modelKey._attributes.attrScope[0]==="Organization"){r.precond+=' AND member:"'+i.collectionInfo._modelKey._attributes.organization+'"'}}var m=["Person"];r.recent_search={types:m};if(widget.getPreference("collab-storage")!=undefined){r.tenant=widget.getPreference("collab-storage").value}r.app_socket_id=j;r.widget_id=j;r.global_actions=[{id:"incontextHelp",title:e["search.help"],icon:"fonticon fonticon-help",overflow:false}];if(h.is(k)){k.dispatchEvent("RegisterContext",r);k.addListener("Selected_Objects_search",i.selected_Objects_search.bind(i));k.dispatchEvent("InContextSearch",r)}else{throw new Error("Socket not initialized")}})}},onInputClickUserGroupSearch:function(){console.log("input clicked-- User Group Search");var k;var j=h.Utils.getUUID();var i=this;i.is3DSearchActive=true;if(!h.is(k)){require(["DS/SNInfraUX/SearchCom"],function(p){k=p.createSocket({socket_id:j});var r={title:e.searchAssignee,role:"",mode:"furtive",default_with_precond:true,precond:'flattenedtaxonomies:"types/Group" AND current:"active"',show_precond:false,multiSel:false,idcard_activated:false,select_result_max_idcard:false,itemViewClickHandler:"",app_socket_id:j,widget_id:j,search_delegation:"3dsearch",default_search_criteria:""};var l=i.collectionInfo._modelKey._attributes.attrScope[2];if(widget.getPreference("collab-storage").value=="OnPremise"){if(l!=""&&typeof l!="undefined"){var q=i.collectionInfo._modelKey._attributes.attrScopeMembers;var o=q.length;if(o>=0){r.precond="";r.precond+="(";for(var n=0;n<o;n++){r.precond+="mxid:"+q[n]+" OR "}r.precond=r.precond.substring(0,r.precond.length-4);r.precond+=") ";r.precond+='AND flattenedtaxonomies:"types/Group" AND current:"active"'}else{r.precond='flattenedtaxonomies:"types/Group" AND current:"active"'}}}else{r.source="usersgroup";if(l!=""&&typeof l!="undefined"){var q=i.collectionInfo._modelKey._attributes.attrScopeMembers;var o=q.length;if(o>=0){r.precond="";r.precond+="(";for(var n=0;n<o;n++){r.precond+='uri:"'+q[n]+'" OR '}r.precond=r.precond.substring(0,r.precond.length-4);r.precond+=") ";r.precond+="AND type:foaf:Group"}else{r.precond="type:foaf:Group"}}else{r.precond="type:foaf:Group"}}var m=["User Group"];r.recent_search={types:m};if(widget.getPreference("collab-storage")!=undefined){r.tenant=widget.getPreference("collab-storage").value}r.app_socket_id=j;r.widget_id=j;r.global_actions=[{id:"incontextHelp",title:e["search.help"],icon:"fonticon fonticon-help",overflow:false}];if(h.is(k)){k.dispatchEvent("RegisterContext",r);k.addListener("Selected_Objects_search",i.selected_usergroup_search.bind(i));k.dispatchEvent("InContextSearch",r)}else{throw new Error("Socket not initialized")}})}},onInputDragOver:function(i){},onInputDragLeave:function(i){},onInputDrop:function(i){},onInputChange:function(i){this.routeTemplate=i},getValue:function(){return this.routeTemplate}});return a});define("DS/ENORouteMgmt/Utilities/ParseJSONUtil",["UWA/Class","DS/UIKIT/Alert","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(c,b,d){var a=c.extend({init:function(){this._alertFailure=new b({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"});this._alertSuccess=new b({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"})},parseResp:function(g){widget.data.csrf=g.csrf;g.result=new Array();var e=g.data.length;for(var f=0;f<e;f++){g.result[f]=g.data[f].dataelements;if(g.data[f].dataelements.assigneeType==="Group Proxy"||g.data[f].dataelements.assigneeType==="Group"){g.result[f].assigneeTitle=g.data[f].dataelements.assigneeTitle+"("+d.UserGroup+")"}if(g.result[f].id===undefined){g.result[f].id=g.data[f].id}if(g.result[f].physicalid===undefined){g.result[f].physicalid=g.data[f].id}if(g.result[f].type===undefined){g.result[f].type=g.data[f].type}if(g.result[f].relId===undefined){g.result[f].relId=g.data[f].relId}}return g.result},parseTagsJSON:function(g){var i={};var f=Object.prototype.hasOwnProperty;var j="_tag_implicit_";var h=j.length;var k="_tag__";var e=k.length;g.forEach(function(u){var w=[];try{for(var s in u.dataelements){if(f.call(u.dataelements,s)){var m;var r="";if(s.indexOf(j)===-1){m=e}else{r="implicit";m=h}var l=u.dataelements[s];var t=s.substr(m);var p=l.length;for(var o=0;o<p;o++){var v={object:l[o],dispValue:l[o],sixw:t,field:r};w.push(v)}}}}catch(n){console.error("WidgetTagNavInit: loadTagDataDone"+n)}var q="pid://"+u.id;i[q]=w});return i},createDataForRequest:function(h,g){var f={};if(g===undefined){g=widget.data.csrf}var e={dataelements:h};var i=new Array();i.push(e);f={csrf:g,data:i};console.log(f);return f}});return a});define("DS/ENORouteMgmt/Validations/ENORouteValidations",["UWA/Class","DS/UIKIT/Alert","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(c,b,d){var a=c.extend({STR_BAD_CHARS:"",STR_NAME_BAD_CHARS:'" # $ @ % * , ? \\\\ < > [ ] | :',STR_FILE_NAME_BAD_CHARS:"' # $ @ %",init:function(){this.ARR_BAD_CHARS=this.STR_BAD_CHARS.split(" ");this.ARR_NAME_BAD_CHARS=this.STR_NAME_BAD_CHARS.split(" ");this.ARR_FILE_NAME_BAD_CHARS=this.STR_FILE_NAME_BAD_CHARS.split(" ");this._alertFailure=new b({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"});this._alertSuccess=new b({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"})},checkForUnifiedNameBadChars:function(e,f){return this.checkFieldForChars(e,this.ARR_NAME_BAD_CHARS,!f)},checkFieldForChars:function(f,h,g){var e=this.checkStringForChars(f,h,g);return e},checkStringForChars:function(e,j,h){var f="";for(var g=0;g<j.length;g++){if(e.indexOf(j[g])>-1){f+=j[g]+" "}}if(f.length>0){if(h){return j.join(" ")}else{return f}}else{return""}},getAllNameBadChars:function(e){return this.ARR_NAME_BAD_CHARS},createTaskOrders:function(){var f=[];for(var e=1;e<=20;e++){f.push({label:e,value:e})}return f},createTaskAnyAllInfo:function(j){var e;var h=j.model!=undefined?j.model.collection:j.collection;if(h._modelKey&&h._modelKey._facetObjs){var k=h._modelKey._facetObjs;for(var g=0;g<k.length;g++){if(k[g].reference==="tasks"){var f=k[g].collection._models;e=this.getRouteTasksData(f);break}}}return e},getRouteTasksData:function(j){var g=[];var e=[];var h=[];for(var f=0;f<j.length;f++){if(j[f]._attributes.type=="Route Node"){h.push({physicalid:j[f]._attributes.physicalid,taskOrder:j[f]._attributes.taskOrder,taskDueDate:j[f]._attributes.taskDueDate,parallelNodeProcessionRule:j[f]._attributes.parallelNodeProcessionRule,routeNodeRelId:j[f]._attributes.relId,assigneeSetDueDate:j[f]._attributes.assigneeSetDueDate})}else{if(j[f]._attributes.type=="Inbox Task"){e.push({physicalid:j[f]._attributes.physicalid,taskOrder:j[f]._attributes.taskOrder,taskDueDate:j[f]._attributes.taskDueDate,taskCurrentStatus:j[f]._attributes.current,parallelNodeProcessionRule:j[f]._attributes.parallelNodeProcessionRule,routeNodeRelId:j[f]._attributes.relId,assigneeSetDueDate:j[f]._attributes.assigneeSetDueDate})}}}if(e.length>0){g.push({itemname:"IT",values:e})}if(h.length>0){g.push({itemname:"RN",values:h})}return g},taskValidation:function(m){var h,t;var l=m._routeTaskJSON;var x=m._form.getField("taskOrder");var I=x.value;var f=m.model.id;var j=[];for(var E in l){var y=l[E].values;for(var D in y){if(f!==y[D].physicalid&&y[D].taskOrder!==""){j.push(parseInt(y[D].taskOrder))}}}if(j.length==0){if(parseInt(I)!==1){var u=x.parentNode;if(u){u.addClassName("has-error")}x.focus();this._alertFailure.add({message:d.replace(d.errorTaskOrder1,{tag1:I})});return false}}j.push(parseInt(I));for(var E=0;E<(j.length-1);E++){for(var J=E+1;J<j.length;J++){if(j[J]<j[E]){var F=j[E];j[E]=j[J];j[J]=F}}}for(var e=0;e<(j.length-1);e++){if(e==0){if(j[e]!=1){h=1;t=j[e];break}}if((j[e]!=j[e+1])&&((j[e]+1)!=j[e+1])){h=(j[e]+1);t=j[e+1];break}}if(h>-1){x.focus();this._alertFailure.add({message:d.replace(d.errorTaskOrder2,{tag1:h,tag2:t})});return false}var g=m._form.elements.container.getElement("input.input-date.input-date-root.form-control.form-control-root");var o=m._form.options.fields[5].html.dateMsValue;var C=new Date(o);var n=g.nextSibling;var H=C.toDateString();var r=n.value;var p=m._form.getValue("assigneeSetDueDate");if(p!=="true"&&(g.value===""||r==="")){var B="";var u=g.parentNode;m._dueDateNode=u;if(u){u.addClassName("has-error")}this._alertFailure.add({message:d.errorDueDate});return false}if(p!=="true"){var v=r.match(/^([0-9]|0[0-9]|1[0-9]|2[0-3]):([0-9]|[0-5][0-9])$/);if(!v){var u=g.parentNode;if(u){u.addClassName("has-error")}this._alertFailure.add({message:d.errorDueDate});return false}var A=H+" "+r;var K=new Date();var z=new Date(A);if((Date.parse(z.toGMTString())<=Date.parse(K.toGMTString()))){var u=g.parentNode;if(u){u.addClassName("has-error")}this._alertFailure.add({message:d.errorDueDate1});return false}var j=[];var s=[];for(var E in l){var y=l[E].values;for(var D in y){if(m.model.id!==y[D].physicalid&&y[D].taskOrder!==""&&y[D].taskDueDate!==""&&y[D].assigneeSetDueDate!==true){j.push(parseInt(y[D].taskOrder));s.push(y[D].taskDueDate)}}}j.push(parseInt(I));s.push(H+" "+r);for(var D=0;D<j.length-1;D+=1){for(var w=D+1;w<j.length;w+=1){var G=this.largestdate(j[D],s[D],j[w],s[w]);if(!G){var u=g.parentNode;m._dueDateNode=u;if(u){u.addClassName("has-error")}this._alertFailure.add({message:d.errorDueDate2});return false}}}}return true},largestdate:function(h,f,g,e){var j=new Date(f);var i=new Date(e);if(((((h>g)&&(Date.parse(j.toGMTString())>=Date.parse(i.toGMTString()))))||(((h<g)&&(Date.parse(j.toGMTString())<=Date.parse(i.toGMTString()))))||(h==g))){return true}else{if(f===""||e===""){return true}else{return false}}},sortNum:function(j,h){for(var g=0;g<(h-1);g++){for(var e=g+1;e<h;e++){if(j[e]<j[g]){var f=j[g];j[g]=j[e];j[e]=f}}}}});return a});define("DS/ENORouteMgmt/ENORouteStatusInfo",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","DS/UIKIT/Tooltip","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(e,f,b,c,d){var a=f.extend(b,{name:"route_status",_logger:null,_tooltip:null,init:function(g){var h=g||{};this._parent(g);this.elements.container=UWA.createElement("span",{"class":this.getClassNames()+" fonticon fonticon-info"});this._tooltip=new c({className:this.getClassNames("_tooltip"),target:this.elements.container,position:"left top",events:g.events});if(this.getOption("status")){this._tooltip.setBody(this.getOption("status"))}if(this.getOption("renderTo")){this.inject(this.getOption("renderTo"))}},setStatus:function(g){this._tooltip.setBody(g)}});a.buildStatus=function(h){var g=UWA.createElement("div",{"class":"route_status_msg"});return g};return a});define("DS/ENORouteMgmt/jsPlumb",["DS/VENjsPumbPlugin/jquery.min-xparam"],function(jQuery){var jsPlumbObj={init:function(connections){require(["DS/VENjsPumbPlugin/jquery.jsPlumb-xparam","DS/VENjsPumbPlugin/jquery-ui.min-xparam"],function(jsPlumbModule,jQueryUIModule){jsPlumb.bind("ready",function(){jsPlumb.importDefaults({Anchors:["RightMiddle","LeftMiddle"],EndpointStyles:[{fillStyle:"#55636b"},{fillStyle:"#55636b"}],Endpoints:[["Rectangle",{width:1,height:1}],["Rectangle",{width:1,height:1}]],ConnectionOverlays:[["Arrow",{location:-2,width:15,length:15}]],Connector:["Flowchart",{stub:10,gap:10}],PaintStyle:{lineWidth:2,strokeStyle:"#55636b",joinstyle:"round"}});eval(connections)})})}};return jsPlumbObj});define("DS/ENORouteMgmt/Views/Sets/RouteContentSet",["DS/W3DXComponents/Views/Layout/GridScrollView","DS/W3DXComponents/Views/Layout/ListView","DS/W3DXComponents/Views/Layout/TableScrollView","DS/W3DXComponents/Views/Item/SetView","DS/W3DXComponents/Views/Item/TileView","UWA/Core","i18n!DS/W3DXComponents/assets/nls/ContentSet","css!DS/W3DXComponents/W3DXComponents"],function(j,c,g,b,a,d,f){var e="content-set";function i(k,m){var l;if(k){l=k[m];if(d.is(l,"function")){l=l.call(k)}}return l}var h=b.extend({name:e,defaultOptions:{actions:{},switcher:{},detail:{},contents:{defaultView:"tile",views:[{id:"tile",title:f.titleTileView,view:j,itemView:a},{id:"table",title:f.titleTableView,view:g},{id:"list",view:c,selectionMode:"oneToOne"}]}},template:function(){return'			<div class="'+this.getClassNames("-header")+'">			<div class="'+this.getClassNames("-multiselHeader")+'"></div>			<div class="'+this.getClassNames("-detail")+'"></div>			<div class="'+this.getClassNames("-actions")+'"></div>			<div class="'+this.getClassNames("-switcher")+'"></div>			</div>			<div class="'+this.getClassNames("-slidepanel")+'"></div>			<div class="'+this.getClassNames("-contents")+'"></div>			'},init:function(k){this._parent(k)},setup:function(){this._parent.apply(this,arguments);if(this.options.slidepanel){this.slidepanel=this.options.slidepanel;this._initSlidepanelView()}},_initSlidepanelView:function(){var l,k=i(this,"slidepanel");l=this.slidepanelView=new k.view(this.getSlidepanelViewOptions());return l},getSlidepanelViewOptions:function(){var k=this;return d.extend(this.getOption("slidepanel").viewOptions,{collection:this.collection,onClose:function(){k.refreshHeight()}})},togglePanel:function(){if(this.slidepanelView.container.hasClassName("expanded")){this.slidepanelView.hide()}else{this.slidepanelView.show();this.slidepanelView.getElement("tr:not(.hidden) input").focus()}this.refreshHeight()},selected_Objects_search:function(n){console.log(n);var m=this.container.getElement("td#content-td-selected");this.collection.selectedContentItems={};this.collection.selectedContentItems.id=[];this.collection.selectedContentItems.details=[];var l={};for(var k=0;k<n.length;k++){l={};l.label=n[k]["ds6w:label"];l.modified=n[k]["ds6w:modified"];l.status=n[k]["ds6w:status"];this.collection.selectedContentItems.details.push(l);this.collection.selectedContentItems.id[k]=n[k].id}n.forEach(function(p){var o=new Badge({content:p["ds6w:label"],className:"default",selectable:true,id:p.id}).inject(m)})},onSearchClick:function(){console.log("input clicked");var m;var l=UWA.Utils.getUUID();var k=this;k.is3DSearchActive=true;if(!UWA.is(m)){require(["DS/SNInfraUX/SearchCom"],function(o){m=o.createSocket({socket_id:l});var p={title:f.addContent,role:"",mode:"furtive",default_with_precond:true,precond:'flattenedtaxonomies:("types/Document" OR "types/VPMReference")',show_precond:false,multiSel:true,idcard_activated:false,select_result_max_idcard:false,itemViewClickHandler:"",app_socket_id:l,widget_id:l,search_delegation:"3dsearch",default_search_criteria:""};var n=k.collection._modelKey._attributes.attrScopeId;if(n!=""&&typeof n!="undefined"){p.precond+=' AND route_95_content_95_scope:"'+n+'"'}p.app_socket_id=l;p.widget_id=l;p.global_actions=[{id:"incontextHelp",title:f["search.help"],icon:"fonticon fonticon-help",overflow:false}];if(UWA.is(m)){m.dispatchEvent("RegisterContext",p);m.addListener("Selected_Objects_search",k.selected_Objects_search.bind(k));m.dispatchEvent("InContextSearch",p)}else{throw new Error("Socket not initialized")}})}},getSwitcherViewOptions:function(){var k=d.clone(this._parent.apply(this,arguments));k.buttons.pop();return k},onPositionChange:function(k,l){switch(l){case"left":this.minimize();break;case"right":this.maximize();break;default:this.maximize();break}},onRender:function(){this.injectSubView(this.slidepanelView,"."+e+"-slidepanel");this._parent.apply(this,arguments)},refreshHeight:function(){var l=this.container.getElement("."+e+"-slidepanel");var k=this.container.getElement("."+e+"-contents");var m=this.container;var n=m.getSize().height-l.getSize().height-50;k.setStyle("height",n+"px")},onMinimized:function(){this.dispatchEvent("onSwitch",[null,"list"])},onMaximized:function(){var k=this.switcherView.getValue();this.dispatchEvent("onSwitch",[null,k])}});return h});define("DS/ENORouteMgmt/Views/Inputs/SearchRouteTemplate",["UWA/Core","UWA/Utils/InterCom","DS/Core/Core","DS/UIKIT/Input","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(f,b,e,c,d){var a=c.extend({defaultOptions:{placeholder:d.searchTemplate,fileBannedChars:["'","#","$","@","%"],multiple:false},routeTemplate:{},socket:null,init:function(g){this._parent(g)},buildInput:function(){var g=f.createElement("div",{"class":"eno-rt-search",html:this.options.text});this.mLabelElement=f.createElement("label",{html:d.routeTemplate}).inject(g);this.mInputElement=f.createElement("div",{"class":"eno-rt-input input-group"}).inject(g);this.mTextElement=f.createElement("input",{"class":"form-control disable-input-search disable-input-search-parent",placeholder:this.options.placeholder,}).inject(this.mInputElement);this.searchButton=f.createElement("span",{"class":"input-group-addon fonticon fonticon-search",events:{click:this.onInputClick.bind(this)}}).inject(this.mInputElement);g.addEventListener("dragover",this.onInputDragOver.bind(this),false);g.addEventListener("dragleave",this.onInputDragLeave.bind(this),false);g.addEventListener("drop",this.onInputDrop.bind(this),false);return g},clear:function(){this.elements.container.removeClassName("error");this.elements.container.setText(this.options.placeholder)},selected_Objects_search:function(g){console.log(g);this.mTextElement.value=g[0]["ds6w:label"];this.mTextElement.id=g[0]["id"];this.mTextElement.description=g[0]["ds6w:description"];this.mTextElement.routeBasePurpose=g[0]["ds6w:fulfillsRationale"];this.mTextElement.scope=g[0]["ds6w:visibility"];this.mTextElement.routeAutoStopOnRejection=g[0]["ds6w:category"];this.mTextElement.preserveTaskOwner=g[0]["ds6w:fulfillsPriority"];var h=document.createEvent("Event");h.page="searchRouteTemplate";h.initEvent("keydown",true,false);this.mTextElement.dispatchEvent(h)},onInputClick:function(){console.log("input clicked");var i;var h=f.Utils.getUUID();var g=this;g.is3DSearchActive=true;if(!f.is(i)){require(["DS/SNInfraUX/SearchCom"],function(k){i=k.createSocket({socket_id:h});var l={title:d.routeTemplate,role:"",mode:"furtive",default_with_precond:true,precond:'flattenedtaxonomies:"types/Route Template" AND current:"active" AND latestrevision:"TRUE"',show_precond:false,multiSel:false,idcard_activated:false,select_result_max_idcard:false,itemViewClickHandler:"",app_socket_id:h,widget_id:h,search_delegation:"3dsearch",default_search_criteria:""};if(widget.getPreference("collab-storage")!=undefined){l.tenant=widget.getPreference("collab-storage").value}l.precond+=" AND route_95_template_95_valid:TRUE";var j=["Route Template"];l.recent_search={types:j};l.app_socket_id=h;l.widget_id=h;l.global_actions=[{id:"incontextHelp",title:d["search.help"],icon:"fonticon fonticon-help",overflow:false}];if(f.is(i)){i.dispatchEvent("RegisterContext",l);i.addListener("Selected_Objects_search",g.selected_Objects_search.bind(g));i.dispatchEvent("InContextSearch",l)}else{throw new Error("Socket not initialized")}})}},onInputDragOver:function(g){},onInputDragLeave:function(g){},onInputDrop:function(g){},onInputChange:function(g){this.routeTemplate=g},getValue:function(){return this.routeTemplate}});return a});define("DS/ENORouteMgmt/EnoviaBootstrap",["UWA/Core","UWA/Class/Collection","UWA/Class/Listener","UWA/Utils","DS/ENORouteMgmt/Utilities/Utils","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData"],function(t,n,r,i,g,f,k,b){function l(y,A){var z;if(y){z=y[A];if(t.is(z,"function")){z=z.call(y)}}return z}var o=false,u=false,d,m,q,j,s,h,a,c,w;function x(y){if(d){return d}var A="com.ds."+y.id,z="com.ds.compass";d=new i.InterCom.Socket(A);d.subscribeServer(z,window.parent);return d}function e(){var y;y=b.authenticatedRequest;b.authenticatedRequest=function(B,A){var z=m,D,C;if(z){D=z.getStorageWithUrl(B)}if(t.is(D)){if(B!==l(D,"url")){if(!A){A={}}if(!A.headers){A.headers={}}A.headers["X-DS-CSRFTOKEN"]=q||""}B=B+(B.indexOf("?")===-1?"?":"&")+"tenant="+D.id;if(widget.getPreference("collabspace")){B=B+"&SecurityContext="+widget.getPreference("collabspace").value}if(widget.debugMode){B=B+"&$debug=true"}if(g.getCookie("swymlang")){B=B+"&$language="+g.getCookie("swymlang")}}C=A.onComplete;A.onComplete=function(G,F,E){q=F["X-DS-CSRFTOKEN"];if(t.is(C,"function")){C(G,F,E)}};return y(B,A)}}function v(){if(a){return a}k.getServiceUrl({serviceName:"3DSwym",onComplete:function(z){a=z;var A;if(j){A=j.id}if(A&&a){for(var y=0;y<a.length;y++){if(A===a[y].platformId){c=a[y].url;break}}}},onFailure:function(y){a=[]}});return a}function p(){if(w){return w}var y=widget.getValue("x3dPlatformId");k.getServiceUrl({serviceName:"3DSpace",platformId:y,onComplete:function(z){if(typeof z==="string"){w=z}else{w=z[0].url}},onFailure:function(){w=""}})}h=t.merge(r,{start:function(y){if(o){return}if(y.frameENOVIA){u=true}y=(y?t.clone(y,false):{});m=y.collection;x(y);e();v();p();o=true},onStorageChange:function(C,B){var z=C.get("csrf");j=C;if(!t.is(z)){j.fetch({onComplete:B,onFailure:B})}else{if(B){B()}}var A=j.id;if(A&&a){for(var y=0;y<a.length;y++){if(A===a[y].platformId){c=a[y].url;break}}}},getLoginUser:function(){var y=f.getUser();if(y&&y.login){return y.login}},getCompassSocket:function(){if(o){return d}},getSyncOptions:function(){if(u){return{}}else{var y={ajax:b.authenticatedRequest};return y}},getStorages:function(){if(o){return m}},getStorage:function(){if(o){return j}},get3DSpaceURL:function(){if(o){return w}},getRouteServiceBaseURL:function(){if(o){return w+"/resources/v1/modeler/routes"}},getSNIconServiceBaseURL:function(){if(o){return w+"/snresources/images/icons/large"}},getDocumentServiceBaseURL:function(){if(o){return w+"/resources/v1/modeler/documents"}},getSwymUrl:function(){if(c){return c}}});return h});define("DS/ENORouteMgmt/Models/ContentModel",["UWA/Core","DS/WAFData/WAFData","UWA/Class/Model","DS/WebappsUtils/WebappsUtils","UWA/Utils","DS/ENORouteMgmt/EnoviaBootstrap","DS/UIKIT/Alert","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/ENORouteMgmt/Utilities/Utils","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(k,j,o,d,f,c,n,h,i,l){function m(p,r){var q;if(p){q=p[r];if(k.is(q,"function")){q=q.call(p)}}return q}var g=new n({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),b=new n({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});function e(q,p){var r=p.onFailure;p.onFailure=function(s){if(r){r(q,s,p)}q.dispatchEvent("onError",[q,s,p])}}var a=o.extend({defaults:{idAttribute:"physicalid"},parse:function(q,p){q.businessobj=q;return q},sync:function(r,q,p){k.extend(p,c.getSyncOptions(),true);delete p.data;return this._parent.apply(this,arguments)},createAssociatedBO:function(r){r=r?k.clone(r,false):{};if(!r.urlFCS){throw new Error('A "url" must be specified')}var u=this,q=r.urlFCS,w=r.onComplete,v,p,t;r.onComplete=function(x){u.dispatchEvent("onCreateAssociatedBO");if(w){return w(u,u.parseBOReceipt(x),r)}};v=new FormData();p=this.getBOFormAttr(r);for(var s in p){v.append(s,p[s])}this.dispatchEvent("onBeforeCreateAssociatedBO",[v]);t=new XMLHttpRequest();t.upload.onprogress=this.onProgressBOCreation.bind(this);t.open("POST",q,true);t.onreadystatechange=function(){if(t.readyState===4){if(t.status===200){r.onComplete(t.responseText)}else{if(r.onFailure){r.onFailure(u,t.responseText,r)}}}};t.send(v);return t},parseBOReceipt:function(q){var p=k.createElement("div").setHTML(q).getElement('[name="__fcs__jobReceipt"]').value;return{receipt:p}},getBOFormAttr:function(q){q=q?k.clone(q,false):{};var p={};if(q.ticket&&q.ticket.name){p[q.ticket.name]=q.ticket.value}k.extend(p,{__fcs__jobTicket:q.ticket.value,"file-name":this.get("businessobj").file,file_0:q&&q.file,"file-title":this.get("businessobj").title,"file-description":this.get("businessobj").description});return p},getPreview:function(q){if(!q){q={}}var s=this,r,p=m(this,"url")+"/preview",t=q.onComplete;q.onComplete=function(v){var u;v=s.parsePreview(v);u=s.get("businessobj");s.set("businessobj",k.merge({thumbnail:v.thumbnail},u));if(t){return t(s,v,q)}};j.authenticatedRequest(p,k.extend({type:"json"},k.extend(q,c.getSyncOptions(),true)));return r},parsePreview:function(p){return p},removeContent:function(){var r=this;var p,q={};q=k.extend(q,c.getSyncOptions(),true);p=m(this,"url");q.data=JSON.stringify(new h().createDataForRequest({}));q.method="DELETE";q.type="json";q.headers={"Content-Type":"application/ds-json",};q.onComplete=function(u){console.log(JSON.stringify(u));var s=r.collection._modelKey._facetObjs;var t=["contents"];i.reloadFacetObjects(s,t);b.add({message:l.successRemoveContent})};q.onFailure=function(t,u,s){g.add({message:l.errorRemoveContent});console.log("Remove Content failed : "+u.internalError)};j.authenticatedRequest(p,q)},downloadContent:function(q){if(!q){q={}}var s=this,r,p,t=q.onComplete;q=k.extend(q,c.getSyncOptions(),true);q.data=JSON.stringify(new h().createDataForRequest({}));q.method="PUT";q.type="json";q.headers={"Content-Type":"application/ds-json",};p=c.getDocumentServiceBaseURL()+"/"+this.id+"/files/DownloadTicket";q.onComplete=function(A){var u;var x=document;var v=f.parseUrl(A.data[0].dataelements.ticketURL);var z=v.query.length?f.parseQuery(v.query):{};z.__fcs__attachment=true;delete v.query;var y=f.composeUrl(v);var w=x.createElement("form");w.style.display="none";w.method="POST";w.action=y;Object.keys(z).map(function(C){var B=x.createElement("input");B.setAttribute("name",C);B.setAttribute("value",z[C]);w.appendChild(B)});x.body.appendChild(w);w.submit();x.body.removeChild(w)};j.authenticatedRequest(p,q);return r},parseDownload:function(p){return p},onProgressBOCreation:function(q){if(q.lengthComputable){var p=(q.loaded/q.total)*100;this.dispatchEvent("onProgress",p)}},focusTaggerProxyOnSubject:function(){var q=this.collection,p;if(!q||!(p=q.taggerProxy)){return}p.focusOnSubjects(["pid://"+this.id])},"onChange:id":function(){this.getPreview()}});return a});define("DS/ENORouteMgmt/Views/Inputs/TaskDueDate",["UWA/Core","UWA/Utils/InterCom","DS/Core/Core","DS/UIKIT/Input","DS/UIKIT/Input/Date","DS/ENORouteMgmt/Utilities/Utils","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(h,c,g,e,b,d,f){var a=e.extend({defaultOptions:{placeholder:f.setDueDate,fileBannedChars:["'","#","$","@","%"],multiple:false},routeTemplate:{},socket:null,init:function(i){this._parent(i)},buildInput:function(){var n=this;var j=h.createElement("div",{"class":"eno-duedate-container",html:this.options.text});this.mLabelElement=h.createElement("label",{html:f.dueDateAndTime}).inject(j);this.mLabelReqElement=h.createElement("span",{html:" *","class":"label-field-required"}).inject(this.mLabelElement);this.mInputElement=h.createElement("div",{"class":"eno-duedate-input"}).inject(j);var m=new Date();m.setDate(m.getDate());var o=0;if(d.getCookie("swymlang")=="fr"){o=1}this.dateInput=new b({placeholder:this.options.placeholder,min:m,firstDay:o,events:{onChange:function(p){n.dateMsValue=this.elements.picker.getDate().getTime()}}}).inject(this.mInputElement);var k=1000*60*30;var l=new Date();var i=new Date(Math.round(l.getTime()/k)*k);this.timeInput=h.createElement("input",{type:"time",value:"12:00",step:"1800","class":"form-control eno-duedatetime-input"}).inject(this.mInputElement);j.addEventListener("dragover",this.onInputDragOver.bind(this),false);j.addEventListener("dragleave",this.onInputDragLeave.bind(this),false);j.addEventListener("drop",this.onInputDrop.bind(this),false);return j},clear:function(){this.elements.container.removeClassName("error");this.elements.container.setText(this.options.placeholder)},selected_Objects_search:function(i){console.log(i);this.mTextElement.value=i[0]["ds6w:label"]},onInputClick:function(){},onInputDragOver:function(i){},onInputDragLeave:function(i){},onInputDrop:function(i){},onInputChange:function(i){this.routeTemplate=i},getValue:function(){return this.routeTemplate}});return a});define("DS/ENORouteMgmt/Commands/InitialRoute_Widget",["UWA/Class","DS/ApplicationFrame/Command","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/TransientWidget/TransientWidget","DS/ENORouteMgmt/EnoviaBootstrap"],function(e,d,h,g,b,a){var f="DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext";var c=d.extend({defaultIsTransient:false,extraNotif:false,init:function(i,j){this._parent(i,j);require([f]);this.editProp=null;a.start({id:widget.id,})},beginExecute:function(){},execute:function(i){this.routeName=i.routeName;this.routeId=i.routeId;var j=this;require(["DS/PADUtils/PADContext"],function(l){var k=l.get();if(null==k){k=j.options.context}console.log(k);j.launchCreateRoute(k)})},_launchTransientWidget:function(i,j){window.top.performance.mark("end_EP_SelectionTreatment");window.top.performance.mark("start_EP_TransientLoaded");i.showWidget("ENXROUT_AP","",j,{mode:"panel",height:800,width:750})},launchCreateRoute:function(i){var p=null;var o=this;widget.setValue("index_mode",false);var l=widget.getValue("index_mode");var q={context:i};g.getInstance(q).getSecurityContext();var j=[];var n=[];var k=i.model;if(!k||!k.objectId){j=i.getSelectedNodes()}else{}if(j.length){console.dir("selected_nodes : "+j);j.forEach(function(v){var x=v&&typeof v.getInstID==="function"?v.getInstID():null;if(x!=null&&Array.isArray(x)){x=x.length>0?x[0]:null}var t=x?"relationship":"businessobject";x=x?x:v.getID();x=x?x:v.id;var s=v.metatype?v.metatype:t;var w=v.source?v.source:null;var y=v.tenant?v.tenant:null;var u=v.type?v.type:null;if(x){var r={metatype:s,objectId:x};var y=y?y:h.getTenantID();if(y){r.tenant=y}if(w){r.source=w}if(u){r.type=u}n.push(r)}})}if(n.length>0){var m=o.defaultIsTransient;if(typeof i.isTransient==="function"){m=i.isTransient()}if(m===false){g.getSecurityContext({onSuccess:function(t){var v=window.top.document.body.getElementsByClassName("preview-container")[0];var u=false;if(v){var r=v.getElement(".moduleContent");if(r){var w=r.className;if(w.indexOf("EditPropWidget")>=0){u=true;v.show();require(["DS/WidgetServices/commandProxy/CommandProxy"],function(x){x.publishUpdate(n)})}}}if(u===false){var s={SelectedItem:n,isTransient:"true",loadData:true,asynchronousRequest:"true",index_mode:widget.getValue("index_mode"),routeName:o.routeName,routeId:o.routeId};if(t&&t.SecurityContext){s.securityContext=t.SecurityContext}if(l){s.readOnly=true}o._launchTransientWidget(b,s)}}})}else{console.log("ixk")}}else{o._setError(i,UWA.i18n("no content selected"))}o.end()},_setError:function(j,k){if(typeof j.displayNotification==="function"){var i={eventID:"error",msg:k};j.displayNotification(i)}else{alert(k)}},endExecute:function(){}});return c});define("DS/ENORouteMgmt/Models/MemberModel",["UWA/Core","DS/WAFData/WAFData","UWA/Class/Model","DS/ENORouteMgmt/EnoviaBootstrap","DS/UIKIT/Alert","DS/ENORouteMgmt/Utilities/ParseJSONUtil","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(f,e,j,b,i,d,g){function k(l,n){var m;if(l){m=l[n];if(f.is(m,"function")){m=m.call(l)}}return m}var c=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),a=new i({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});var h=j.extend({defaults:{actions:["delete","edit.role.read","edit.role.add","edit.role.addremove","edit.role.readwrite","edit.role.remove"]},idAttribute:"physicalid",parse:function(n,l){n.people={};n.people.login=n.name;n.people.fname=n["attribute[First Name]"];n.people.lname=n["attribute[Last Name]"];n.description=n.current;if(l.attrs){var m=JSON.parse(l.attrs);n.people.login=m.people.login;n.people.fname=m.people.fname;n.people.lname=m.people.lname;n.userAccess="role.read";n.userName=m.people.login;n.accessType="Person"}n.access="Read";return n},sync:function(n,m,l){f.extend(l,f.extend(b.getSyncOptions(),{attrs:JSON.stringify(m.toJSON(l))},true),true);delete l.data;return this._parent.apply(this,arguments)},changeAccess:function(l){var p=this;var o,q={};q=f.extend(q,b.getSyncOptions(),true);o=k(this,"url");var m={id:this.id,newAccess:l,};q.data=JSON.stringify(new d().createDataForRequest(m));q.method="PUT";q.type="json";q.headers={"Content-Type":"application/ds-json",};var n=q;q.onComplete=function(t){console.log(JSON.stringify(t));var r="role."+l.replace(" ","").toLowerCase();var s={userAccess:r};p.set(s,n);a.add({message:g.successChangeAccess})};q.onFailure=function(s,t,r){c.add({message:g.errorChangeAccess});console.log("Change Access failed : "+t.internalError)};e.authenticatedRequest(o,q)},});return h});define("DS/ENORouteMgmt/Collections/MemberCollection",["UWA/Core","DS/WebAppsFoundations/Collections/PageableCollection","UWA/Class/Model","DS/ENORouteMgmt/Models/MemberModel","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/ENORouteMgmt/EnoviaBootstrap"],function(e,d,h,g,c,b){var f="members";function i(j,l){var k;if(j){k=j[l];if(e.is(k,"function")){k=k.call(j)}}return k}var a=d.extend({name:f,defaultOptions:{},model:g,url:function(){return"/members"},parseResponseForStateUpdate:function(m,k,l,j){return{totalRecords:m.data.length}},parseRecords:function(k,j){k.result=new c().parseResp(k);return k.result},setup:function(n,j){var k=j._modelKey,l,m;if(k&&k instanceof h){this._modelKey=k;this.url=i(k,"url")+Object.getPrototypeOf(this).url.call(this)}},sync:function(m,l,k){var j="?";e.extend(k,b.getSyncOptions(),true);this._parent.apply(this,arguments)},getMembers:function(l){var k,j;l=l.replace(/\W+$/,"").replace(/^\W+/,"");j=l.toLowerCase().split(/\W+/);k=function(m){return j.some(function(n){return m.get("people")["fname"].toLowerCase().indexOf(n)!==-1||m.get("people")["lname"].toLowerCase().indexOf(n)!==-1})};return this.filter(k)}});return a});define("DS/ENORouteMgmt/SkeletonUtils/MemberSkeletonOptions",["UWA/Drivers/Alone","UWA/Core","DS/WAFData/WAFData","DS/UIKIT/Alert","DS/W3DXComponents/Skeleton","DS/ENORouteMgmt/Models/MemberModel","DS/W3DXComponents/Views/EmptyView","DS/ENORouteMgmt/EnoviaBootstrap","DS/WebappsUtils/WebappsUtils","DS/ENORouteMgmt/Utilities/ParseJSONUtil","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(i,q,a,c,f,p,o,g,e,s,h){var n,r=null,m=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),j=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});function l(t,v){var u;if(t){u=t[v];if(q.is(u,"function")){u=u.call(t)}}return u}function d(){var t=this,w=this.collection,v,x,u=n.getFetchOptions();v=u.onComplete;u.onComplete=function(A,z,y){if(t.container.offsetParent){t.container.removeClassName("loading");Object.keys(t.contentsViews).map(function(B){t.contentsViews[B].scrollView.endLoading()})}if(v){v(t,z,y)}};if(w.state.totalRecords===null){w.getFirstPage(u)}else{if(w.hasNextPage()){w.getNextPage(q.extend(u,{remove:false,reset:false}))}else{t.container.removeClassName("loading");Object.keys(t.contentsViews).map(function(y){t.contentsViews[y].scrollView.useInfiniteScroll(false)})}}}function k(){var t=this;if(!q.is(this.collection.getFirstPage,"function")){return this.collection.fetch(q.extend({onComplete:function(){t.scrollView.useInfiniteScroll(false);t.scrollView.endLoading()}},n.getFetchOptions()))}}function b(v,t,x,u){var w=x.model.get("id");switch(w){case"add.members":this.togglePanel();break;default:console.log(w+" is not permitted.");break}}n={getFetchOptions:function(){return{type:"json",data:{embed:"people"},reset:true,headers:{"Content-Type":"application/ds-json",},objectSelectBO:["name","current","type","attribute[First Name]","attribute[Last Name]"],onFailure:function(){m.add({message:h.errorFetchMembers})}}},getIdCardOptions:function(t){return{collapsed:t.minimizeIdCardView}},getMemberSetOptions:function(t){return{className:"loading",events:{onActionClick:b,onInfiniteScroll:d},actions:{collection:function(){var v=this.collection,u=v._modelKey;return u&&u.actions},filterer:function(v,u){return !!v.get("actionBar")&&v.id.indexOf(".members")!==-1}},contents:{selectionMode:null,headerOnEmpty:false,headers:[{property:"title",label:h.name},{property:"type",icon:"icon",label:h.type},{property:"access",label:h.access},{label:h.actions,actions:true}],itemViewOptions:{mapping:{title:function(){if(this.model.get("accessType")==="Collab Space"){return this.model.get("name")}else{if(this.model.get("accessType")==="Person"||this.model.get("accessType")==="User Group"){return this.model.get("fullname")}}},type:function(){this.accessType=this.model.get("accessType");if(this.accessType==="Collab Space"||this.accessType==="User Group"){this.accessType=this.accessType.replace(" ","_")}return h[this.accessType]},access:function(){return h[this.model.get("userAccess")]},subtitle:function(){return h.access+" : "+h[this.model.get("userAccess")]},icon:function(){if(this.model.get("accessType")=="Collab Space"){return e.getWebappsAssetUrl("ENORouteMgmt","icons/16/I_CollabSpace16.png")}else{if(this.model.get("accessType")==="User Group"){return e.getWebappsAssetUrl("ENORouteMgmt","icons/16/I_UserGroup16.png")}else{return e.getWebappsAssetUrl("ENORouteMgmt","icons/16/I_Person16.png")}}},image:function(){if(this.model.get("accessType")=="Collab Space"){return e.getWebappsAssetUrl("ENORouteMgmt","icons/144/I_CollabSpace108x144.png")}else{if(this.model.get("accessType")==="User Group"){return e.getWebappsAssetUrl("ENORouteMgmt","icons/144/default-group.png")}else{return e.getWebappsAssetUrl("ENORouteMgmt","icons/144/I_DefaultPeople108x144.png")}}},},contextualActions:function(){var A=function(C,D,B){C.set(C.previousAttributes());m.add({message:h.replace(h.errorEditRole,{tag1:C.get("people").name})})};var z=function(C,D,B){j.add({message:h.replace(h.successEditRole,{tag1:C.get("people").name})})};var y=[],w=0,u=0;y=[{access:"edit.role.read",selected:this.get("userAccess")==="role.read"},{access:"edit.role.readwrite",selected:this.get("userAccess")==="role.readwrite"},{access:"edit.role.add",selected:this.get("userAccess")==="role.add"},{access:"edit.role.remove",selected:this.get("userAccess")==="role.remove"},{access:"edit.role.addremove",selected:this.get("userAccess")==="role.addremove"}];var x=this.collection._modelKey._attributes.state;if(this.get("accessType")==="Collab Space"||this.get("isRouteOwner")==="true"||this.get("isLoggedInUserRouteOwner")!=="true"||x==="Complete"||x==="Archive"||this.get("accessType")==="User Group"){return[]}var v=this.collection._modelKey._attributes.type;return y.map(function(B){switch(B.access){case"edit.role.read":return{text:h["role.canread"],fonticon:"book-locked",selected:B.selected,handler:function(C){C.model.changeAccess("Read")}};break;case"edit.role.readwrite":return{text:h["role.canreadwrite"],fonticon:"book",selected:B.selected,handler:function(C){C.model.changeAccess("Read Write")}};break;case"edit.role.add":return{text:h["role.canadd"],fonticon:"doc-add",selected:B.selected,handler:function(C){C.model.changeAccess("Add")}};break;case"edit.role.remove":return{text:h["role.canremove"],fonticon:"doc-delete",selected:B.selected,handler:function(C){C.model.changeAccess("Remove")}};break;case"edit.role.addremove":return{text:h["role.canaddremove"],fonticon:"docs-delete",selected:B.selected,handler:function(C){C.model.changeAccess("Add Remove")}};break;default:return null}}).filter(function(B){return B})},icon:"users",title:h.emptyMemberTitle,},emptyView:o,events:{onPullToRefresh:k}}}}};return n});define("DS/ENORouteMgmt/Views/Creates/CreateTaskView",["UWA/Core","UWA/Element","DS/UIKIT/Form","DS/WAFData/WAFData","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Alert","UWA/Class/View","DS/ENORouteMgmt/Views/Inputs/SearchTaskAssigneeData","DS/ENORouteMgmt/Collections/MemberCollection","DS/ENORouteMgmt/Views/Inputs/TaskDueDate","DS/ENORouteMgmt/EnoviaBootstrap","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/ENORouteMgmt/Validations/ENORouteValidations","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(q,h,j,b,n,o,s,k,r,e,c,p,f,t,d,g){var m=new k({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),i=new k({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});function l(u,w){var v;if(u){v=u[w];if(q.is(v,"function")){v=v.call(u)}}return v}var a=r.extend({name:"createTask",tagName:"div",className:"create-cs-view",_assigneeSelectOptions:null,_taskActionRequiredDetails:null,_routeTaskJSON:null,_currentTaskOrders:null,init:function(u){var v=UWA.clone(u,false);["container","template","tagName","domEvents"].forEach(function(w){delete v[w]});this._parent(v)},setup:function(){this.container.addClassName(this.getClassNames("-container"));this._createTaskOrders();this._createTaskAnyAllInfo();this._initAlert();this._form=this._initForm();if(!Object.keys(this._taskActionRequiredDetails).length>0){this._adjustFormFields()}this._initListenKeyDown()},_adjustFormFields:function(){var u=this._form.getField("taskRequiredAction").parentElement;var v=u.parentElement;console.log("Remove field");v.style.display="none"},_createTaskAnyAllInfo:function(){this._taskActionRequiredDetails=new Object();var y=this.collection;var A;var u=true;if(y._modelKey&&y._modelKey._facetObjs){var B=y._modelKey._facetObjs;for(var x=0;x<B.length;x++){if(B[x].reference==="tasks"){var v=B[x].collection._models;A=this.getRouteTasksData(v);break}}}var z=[];for(var x in A){var C=A[x].values;for(var w in C){if(A[x].itemname==="IT"&&C[w].taskCurrentStatus==="Complete"){continue}if(this._taskActionRequiredDetails[C[w].taskOrder]){this._taskActionRequiredDetails[C[w].taskOrder]=this._taskActionRequiredDetails[C[w].taskOrder]+1;this._taskActionRequiredDetails[C[w].taskOrder+"_routeNodes"]=this._taskActionRequiredDetails[C[w].taskOrder+"_routeNodes"]+C[w].routeNodeRelId+"~"}else{this._taskActionRequiredDetails[C[w].taskOrder]=parseInt("1");this._taskActionRequiredDetails[C[w].taskOrder+"_AnyAllDefaultValue"]=C[w].parallelNodeProcessionRule;this._taskActionRequiredDetails[C[w].taskOrder+"_routeNodes"]=C[w].routeNodeRelId+"~";this._taskActionRequiredDetails[C[w].taskOrder+"_visibility"]="Yes"}}}},_createTaskOrders:function(){this._currentTaskOrders=[];var v=this.collection;for(var u=1;u<=20;u++){this._currentTaskOrders.push({label:u,value:u,selected:this.collection._modelKey.get("currentRouteNode")===u.toString()?true:false})}},_initAlert:function(){var u={className:"create-alert",closable:true,renderTo:document.body,autoHide:true,visible:true};this.elements.alertFailure=new k(q.extend({messageClassName:"error"},u));this.elements._alertFailure=new k({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,messageClassName:"error"});this.elements._alertSuccess=new k({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"})},_initForm:function(){var C=this,H=this.options,F=this.collection,B=F._storage,D=true,u=this.elements,x,v,w,z,E,G;H.collectionInfo=this.collection;H.collectionInfo.setTaskAssigneePID="";var y=new e({options:H});var A=new p({});x=[{type:"text",name:"title",required:true,disabled:false,label:g.title,placeholder:g.placeholderTitle,events:{onChange:function(){var J=this.getValue().trim();if(J!==""){var I=this.elements.input.parentNode;if(I){I.removeClassName("has-error")}}}}},{type:"textarea",name:"instructions",rows:3,label:g.instructions,required:true,placeholder:g.placeholderInstructions,events:{onChange:function(){var J=this.getValue().trim();if(J!==""){var I=this.elements.input.parentNode;if(I){I.removeClassName("has-error")}}}}},{type:"select",name:"taskOrder",label:g.taskOrder,nativeSelect:false,required:true,placeholder:false,options:this._currentTaskOrders,dataHolder:this,events:{onChange:function(){console.log(this.getValue());var aa=parseInt(this.getValue());var L;var N=this.options.dataHolder;N.errorTaskOrder="false";var R=N.collection;var J,O;var W=this.options.dataHolder.collection._modelKey.get("currentRouteNode");if(aa<parseInt(W)){var U=g.replace(g.errorTaskOrder,{tag1:W});this.setFocus();N.elements._alertFailure.add({message:U});N.errorTaskOrder="true";return}if(R._modelKey&&R._modelKey._facetObjs){var Q=R._modelKey._facetObjs;for(var X=0;X<Q.length;X++){if(Q[X].reference==="tasks"){var M=Q[X].collection._models;L=N.getRouteTasksData(M);break}}}if(L.length==0){if(aa!=1){var U=g.replace(g.errorTaskOrder1,{tag1:aa});this.setFocus();N.elements._alertFailure.add({message:U});N.errorTaskOrder="true";return}}else{var K=[];for(var X in L){var S=L[X].values;for(var V in S){K.push(parseInt(S[V].taskOrder))}}K.push(parseInt(aa));for(var X=0;X<(K.length-1);X++){for(var ab=X+1;ab<K.length;ab++){if(K[ab]<K[X]){var Y=K[X];K[X]=K[ab];K[ab]=Y}}}for(var I=0;I<(K.length-1);I++){if(I==0){if(K[I]!=1){J=1;O=K[I];break}}if((K[I]!=K[I+1])&&((K[I]+1)!=K[I+1])){J=(K[I]+1);O=K[I+1];break}}if(J>-1){var Z=g.replace(g.errorTaskOrder2,{tag1:J,tag2:O});this.setFocus();N.elements._alertFailure.add({message:Z});N.errorTaskOrder="true";return}}var T=N.elements.form.getField("taskRequiredAction").parentElement;var ac=T.parentElement;if(N._taskActionRequiredDetails[this.getValue()]){ac.style.display="block";var P=N.elements.form.getInput("taskRequiredAction");if(N._taskActionRequiredDetails[this.getValue()+"_AnyAllDefaultValue"]==="Any"){P.setSelection("Any",true);P.syncInput()}else{P.setSelection("All",true);P.syncInput()}}else{console.log("Remove field");ac.style.display="none"}}}},{type:"html",name:"TaskDueDate",html:A},{type:"checkbox",name:"assigneeSetDueDate",value:"assigneeSetDueDate",label:g.assigneeSetDueDate,events:{onChange:function(){var K=this.elements.content.form.getElementsByClassName("eno-duedate-input");var I=K[0].getChildren()[0];var J=K[0].getChildren()[1];if(this.isChecked()){I.disabled=true;I.value="";J.disabled=true;J.value="12:00"}else{I.disabled=false;J.disabled=false;J.value="12:00"}}}},{type:"html",required:true,name:"TaskAssignee",html:y},{type:"checkbox",name:"allowDelegation",value:"allowDelegation",label:g.allowDelegation},{type:"select",name:"taskAction",label:g.taskAction,nativeSelect:false,required:true,placeholder:false,options:this.collection._modelKey.get("routeBasePurpose")==="Approval"?[{value:"Approve",label:g.approve,}]:this.collection._modelKey.get("routeBasePurpose")==="Review"?[{value:"Comment",label:g.comment,}]:[{value:"Comment",label:g.comment,selected:true},{value:"Approve",label:g.approve},{value:"Notify Only",label:g.notifyOnly}]},{type:"checkbox",name:"needsOwnerReview",value:"needsOwnerReview",label:g.needsOwnerReview},{type:"select",name:"taskRequiredAction",label:g.taskRequiredAction,nativeSelect:false,placeholder:false,options:[{value:"Any",label:g.taskAnyOption},{value:"All",label:g.taskAllOption,selected:true}]}];w=new j({fields:x,events:{onSubmit:function(){C.onCreate()},onInvalid:function(I){},onValid:function(){}}});E=new n({value:g.create,className:"primary",events:{onClick:this.dispatchAsEventListener("onCreate","onMultipleClick")}});z=new n({value:g.createAndClose,events:{onClick:this.dispatchAsEventListener("onCreate")}});G=new n({value:g.cancel,events:{onClick:this.dispatchAsEventListener("onCancel")}});u.form=w;u.apply=E;u.create=z;u.cancel=G;return w},getCreateButton:function(){return this.elements.create},getApplyButton:function(){return this.elements.apply},getCancelButton:function(){return this.elements.cancel},getFormFirstInput:function(){return this.elements.form.elements.container[0]},_initListenKeyDown:function(){this.onKeyDown=this.onKeyDown.bind(this);document.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(v){if(v.keyCode===13){if(this.submitEnabled()){}}else{if(v.keyCode===27){var u=document.createEvent("Event");u.initEvent("click",true,false);this.elements.cancel.elements.content.dispatchEvent(u)}}},_validateInput:function(){var P=new Date();var D=this.elements.form.elements.container.getChildren()[3].getChildren()[0];var B=D.getElementsByClassName("eno-duedate-input")[0];var w=this.elements.form.options.fields[3].html.dateMsValue;var K=new Date(w);var O=K.toDateString();var y=B.getChildren()[1].value;var H=O+" "+y;var G=new Date(H);var A=B.getChildren()[0].parentNode;var x=this.elements.form.getValue("assigneeSetDueDate");if(x!=="true"&&(O===""||y===""||w===undefined)){var I="";I=g.errorDueDate;m.add({message:I});return false}if(x!=="true"){if((Date.parse(G.toGMTString())<=Date.parse(P.toGMTString()))){m.add({message:g.errorDueDate1});return false}var C=new d();this._routeTaskJSON=C.createTaskAnyAllInfo(this);var v=this._routeTaskJSON;var u=[];var z=[];for(var L in v){var F=v[L].values;for(var J in F){if(F[J].taskOrder!==""&&F[J].taskDueDate!==""&&F[J].assigneeSetDueDate!==true){u.push(parseInt(F[J].taskOrder));z.push(F[J].taskDueDate)}}}var N=this.elements.form.getInput("taskOrder").getValue();u.push(parseInt(N));z.push(H);var C=new d();for(var J=0;J<u.length-1;J+=1){for(var E=J+1;E<u.length;E+=1){var M=C.largestdate(u[J],z[J],u[E],z[E]);if(!M){var I="";I=g.errorDueDate2;m.add({message:I});return false}}}}return true},submitEnabled:function(){var u=this.elements.create.elements.content.getAttribute("disabled");return u===null?true:false},getRouteTasksData:function(y){var w=[];var u=[];var x=[];for(var v=0;v<y.length;v++){if(y[v]._attributes.type=="Route Node"){x.push({taskOrder:y[v]._attributes.taskOrder,taskDueDate:y[v]._attributes.taskDueDate,parallelNodeProcessionRule:y[v]._attributes.parallelNodeProcessionRule,routeNodeRelId:y[v]._attributes.relId,assigneeSetDueDate:y[v]._attributes.assigneeSetDueDate})}else{if(y[v]._attributes.type=="Inbox Task"){u.push({taskOrder:y[v]._attributes.taskOrder,taskDueDate:y[v]._attributes.taskDueDate,taskCurrentStatus:y[v]._attributes.current,parallelNodeProcessionRule:y[v]._attributes.parallelNodeProcessionRule,routeNodeRelId:y[v]._attributes.relId,assigneeSetDueDate:y[v]._attributes.assigneeSetDueDate})}}}if(u.length>0){w.push({itemname:"IT",values:u})}if(x.length>0){w.push({itemname:"RN",values:x})}return w},render:function(){var y=this.elements,x=y.form,u=y.apply,v=y.create,w=y.cancel;this.container.setContent([x,{tag:"div","class":"footer",}]);return this},resetModal:function(){this.modal=new Modal({closable:true,header:g.removeRoute,body:g.removeRouteDetail,footer:this.getFooter()})},onDestroy:function(){this._alertFailure.destroy();this._alertSuccess.destroy()},onCreate:function(){if(this._validateInput()){var V=this,M=this.options,ad=this.collection,U=ad._storage,O=ad._modelKey.id,y=true,Z=M.onComplete,ag=M.onFailure,R=this.elements.form.getValue("title").trim(),S=this.elements.form.getValue("instructions").trim(),ai=this.elements.form.getValue("taskOrder"),ac=this.elements.form.getValue("duedate"),B=this.elements.form.getValue("needsOwnerReview"),x=this.elements.form.getValue("allowDelegation"),T=this.elements.form.getValue("assigneeSetDueDate"),aa=this.elements.form.getValue("taskRequiredAction"),C=this.elements.form.getValue("taskAction"),I=M.collectionInfo.setTaskAssigneePID,ah,H="";var ae=arguments[1];var w=ae==="onMultipleClick";if(w){V.elements.apply.setDisabled()}else{V.elements.create.setDisabled()}var z=V.elements.form.getField("taskRequiredAction");var A;var W;if(typeof z!="undefined"){A=z.parentElement}if(typeof A!="undefined"){W=A.parentElement}if(typeof W!="undefined"&&W.style.display!=="none"){H=this._taskActionRequiredDetails[ai+"_routeNodes"]}var F=this.elements.form.getField("title");var E=F.parentNode;var Y=new d();if(R.length>0){var af=Y.checkForUnifiedNameBadChars(R,true);var N=Y.getAllNameBadChars(R);if(af.length!=0){if(E){E.addClassName("has-error")}F.focus();var D=g.replace(g.errorBadChar,{tag1:af,tag2:N});m.add({message:D});if(w){V.elements.apply.enable()}else{V.elements.create.enable()}return}}else{if(E){E.addClassName("has-error")}F.focus();var D=g.errorTitle;m.add({message:D});if(w){V.elements.apply.enable()}else{V.elements.create.enable()}return}if(S.length<=0){var u=this.elements.form.getField("instructions");var D=g.errorInstructions;var E=u.parentNode;if(E){E.addClassName("has-error")}u.focus();m.add({message:D});if(w){V.elements.apply.enable()}else{V.elements.create.enable()}return}var ab=V.elements.form.options.fields[3].html.mInputElement.getChildren()[1].value;var K=ab.match(/^([0-9]|0[0-9]|1[0-9]|2[0-3]):([0-9]|[0-5][0-9])$/);if(!K){m.add({message:g.errorDueDate});V.elements.create.enable();V.elements.apply.enable();return}if(V.errorTaskOrder==="true"){m.add({message:g.errorCreateTask});V.elements.apply.enable();V.elements.create.enable();return}if(I==""){var D=g.errorTaskAssignee;m.add({message:D});if(w){V.elements.apply.enable()}else{V.elements.create.enable()}return}M.onFailure=function(al,am,ak){ad.remove(al);if(q.is(ag)){ag.apply(undefined,arguments)}};var x=V.elements.form.getValue("allowDelegation");if(x=="true"){x="TRUE"}else{x="FALSE"}var J=V.elements.form.getValue("needsOwnerReview");if(J=="true"){J="Yes"}else{J="No"}var G=f.getRouteServiceBaseURL()+"/"+O+"/tasks";var P=V.elements.form.options.fields[3].html.dateMsValue;var Q=new Date(P);var X=Q.toDateString()+" "+ab;var T=V.elements.form.getValue("assigneeSetDueDate");if(T=="true"){T="Yes";X=""}else{T="No"}var L={title:V.elements.form.getValue("title"),instructions:V.elements.form.getValue("instructions"),assigneeId:I,taskOrder:V.elements.form.getValue("taskOrder"),assigneeSetDueDate:T,reviewTask:J,allowDelegation:x,taskDueDate:X,taskAction:V.elements.form.getValue("taskAction"),parallelNodeProcessionRule:V.elements.form.getValue("taskRequiredAction"),routeNodeRelIds:H};var v=V.collection._prepareModel(L,M);var aj=new t().createDataForRequest(L);var M={};M=q.extend(M,f.getSyncOptions(),true);M.method="POST";M.type="json";M.headers={"Content-Type":"application/ds-json",};M.wait=true;M.data=JSON.stringify(aj);M.onComplete=function(aq){console.log(JSON.stringify(aq));i.add({message:g.successCreateTask});v._attributes.taskAssignee=aq.data[0].dataelements.taskAssignee;v._attributes.name=aq.data[0].dataelements.name;v._attributes.idAttribute=aq.data[0].dataelements.idAttribute;v.id=aq.data[0].id;v.type=aq.data[0].type;v._attributes.id=aq.data[0].id;v._attributes.physicalid=aq.data[0].id;v.dispatchEvent("onLoad");var am=V.collection._modelKey._facetObjs;for(var ap=0;ap<am.length;ap++){if(am[ap].reference==="tasks"){am[ap].view.reload();am[ap].collection._models.push(v)}else{if(am[ap].reference==="access"){am[ap].view.reload()}else{if(am[ap].reference==="taskgraph"){if(am[ap].view){am[ap].view.destroy();am[ap].view=null}}}}}if(w){V.elements.apply.enable();V._createTaskAnyAllInfo();V._taskActionRequiredDetails[ai]=V._taskActionRequiredDetails.hasOwnProperty(ai)?V._taskActionRequiredDetails[ai]+1:1;V._taskActionRequiredDetails[ai+"_AnyAllDefaultValue"]=aa;V._taskActionRequiredDetails[ai+"_visibility"]="yes";var al=V.elements.form.getField("taskRequiredAction").parentElement;var ao=al.parentElement;if(V._taskActionRequiredDetails[ai]){ao.style.display="block";var an=V.elements.form.getInput("taskRequiredAction");if(V._taskActionRequiredDetails[ai+"_AnyAllDefaultValue"]==="Any"){an.setSelection("Any",true);an.syncInput()}else{an.setSelection("All",true);an.syncInput()}}else{console.log("Remove field");ao.style.display="none"}}else{var ak=document.createEvent("Event");ak.initEvent("click",true,false);V.elements.cancel.elements.content.dispatchEvent(ak)}};M.onFailure=function(al,am,ak){m.add({message:g.errorCreateTask});V.elements.apply.enable();V.elements.create.enable();console.log("Create Task failed : "+am.internalError)};b.authenticatedRequest(G,M)}}});return a});define("DS/ENORouteMgmt/Views/Modals/ModalRemoveTask",["UWA/Controls/Abstract","UWA/Controls/Input","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/ENORouteMgmt/Utilities/Utils","DS/W3DXComponents/Views/Temp/TempItemView","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(e,g,k,i,a,f,b,h,d,j){var c=e.extend({init:function(l){this._parent(l);this.resetModal();this.model=l.model;this._alertFailure=new k({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"});this._alertSuccess=new k({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});this._alertWarning=new k({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"warning"})},showModal:function(){var l=this;window.savemodelRef=this.modal;this.modal.inject(document.body);this.modal.show()},getFooter:function(){var m=this;var l=new f({value:j.Delete,className:"primary",events:{onClick:function(){m.onRemoveCalled()}}});var n=new f({value:j.cancel,className:"default",events:{onClick:function(o){m.onCancelCalled()}}});return[l,n]},onRemoveCalled:function(){var n=this.model,s=n.collection,p=this._alertFailure,l=this._alertSuccess,r=this._alertWarning,o;var q=this.model.collection._modelKey._facetObjs;var m={assigneeId:n.get("assigneeId")};o=JSON.stringify(new b().createDataForRequest(m));n.destroy({onFailure:function(u,v,t){if(v.timedout){r.add({message:j.warningRemoveTaskTimeout})}else{p.add({message:j.errorRemoveTask})}},onComplete:function(){var t=["access","tasks","taskgraph"];h.reloadFacetObjects(q,t);l.add({message:j.successRemoveTask})},wait:true,data:o});this.modal.destroy();window.savemodelRef=null;this.resetModal()},onCancelCalled:function(){this.modal.destroy();this.resetModal();window.savemodelRef=null},resetModal:function(){this.modal=new i({closable:true,header:j.removeTask,body:j.removeTaskDetail,footer:this.getFooter()})},onDestroy:function(){this._alertFailure.destroy();this._alertSuccess.destroy()}});return c});define("DS/ENORouteMgmt/Views/RouteSubscribeEvents",["UWA/Core","UWA/Event","DS/UIKIT/Form","UWA/Element","UWA/Utils","DS/UIKIT/Badge","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/WAFData/WAFData","UWA/Class/View","DS/ENORouteMgmt/EnoviaBootstrap","DS/ENORouteMgmt/Utilities/ParseJSONUtil","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/W3DXComponents/W3DXComponents","css!DS/ENORouteMgmt/ENORouteMgmt"],function(m,j,h,b,d,g,i,f,l,a,c,e,n){var k=a.extend({name:"createTask",tagName:"div",className:"create-cs-view",init:function(o){this._alertFailure=new f({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"});this._alertSuccess=new f({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});this.collectionInfo=o.collection;var p=UWA.clone(o,false);["container","template","tagName","domEvents"].forEach(function(q){delete p[q]});this._parent(p)},setup:function(){this.container.addClassName(this.getClassNames("-container"));this._initAlert();this._initForm();this._initListenKeyDown()},_initAlert:function(){var o={className:"create-alert",closable:true,renderTo:document.body,autoHide:true,visible:true};this.elements.alertFailure=new f(m.extend({messageClassName:"error"},o))},_initForm:function(){var u=this,y=this.options,w=this.collection,v=true,o=this.elements,s=o.alertFailure,r,p,q,t,x;y.collectionInfo=this.collectionInfo;r=[{type:"checkbox",name:"routestarted",label:n["event.routeStarted"]},{type:"checkbox",name:"routecompleted",label:n["event.routeCompleted"]},{type:"checkbox",name:"contentadded",label:n["event.routeContentAdded"]},{type:"checkbox",name:"contentremoved",label:n["event.routeContentRemoved"]}];q=new h({fields:r,events:{onSubmit:function(){u.onSubscribe()},onInvalid:function(z){},onValid:function(){}}});t=new i({value:n.done,className:"primary",events:{onClick:this.dispatchAsEventListener("onSubscribe")}});o.form=q;o.create=t},getCreateButton:function(){return this.elements.create},getFormFirstInput:function(){return this.elements.form.elements.container[0]},_initListenKeyDown:function(){this.onKeyDown=this.onKeyDown.bind(this);document.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(p){if(p.keyCode===13){if(this.submitEnabled()){this.onCreate()}}else{if(p.keyCode===27){var o=document.createEvent("Event");o.initEvent("click",true,false);this.elements.cancel.elements.content.dispatchEvent(o)}}},submitEnabled:function(){var o=this.elements.create.elements.content.getAttribute("disabled");return o===null?true:false},render:function(){var r=this.elements,q=r.form,o=r.create,p=r.cancel;this.container.setContent([q,{tag:"div","class":"footer"}]);return this},onCancel:function(){close();if(m.is(onCancel)){onCancel.apply(this,arguments)}},onSubscribe:function(){var s=this,p=this.options;var o={RouteStarted:"true",RouteCompleted:"false",ContentAdded:"true",ContentRemoved:"false"};var q=c.getRouteServiceBaseURL()+"/subscribe";var u=new e().createDataForRequest(o);var t={};t=m.extend(t,c.getSyncOptions(),true);t.method="PUT";t.type="json";t.headers={"Content-Type":"application/ds-json"};t.data=JSON.stringify(u);var r=l.authenticatedRequest(q,t);return r}});return k});define("DS/ENORouteMgmt/Models/TaskModel",["UWA/Core","DS/WAFData/WAFData","UWA/Class/Model","DS/WebappsUtils/WebappsUtils","DS/ENORouteMgmt/EnoviaBootstrap","DS/UIKIT/Alert","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/ENORouteMgmt/Utilities/Utils","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(j,i,n,c,b,m,f,h,k){function l(o,q){var p;if(o){p=o[q];if(j.is(p,"function")){p=p.call(o)}}return p}var e=new m({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),a=new m({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});function d(p,o){var q=o.onFailure;o.onFailure=function(r){if(q){q(p,r,o)}p.dispatchEvent("onError",[p,r,o])}}var g=n.extend({defaults:{idAttribute:"physicalid"},parse:function(o){if(o){o.businessobj=o;if(o.name=="Route Node"){o.businessobj.typeicon=c.getWebappsAssetUrl("ENORouteMgmt","icons/16/I_RouteNode16.png")}}return o},sync:function(q,p,o){j.extend(o,b.getSyncOptions(),true);return this._parent.apply(this,arguments)},createAssociatedBO:function(q){q=q?j.clone(q,false):{};if(!q.urlFCS){throw new Error('A "url" must be specified')}var t=this,p=q.urlFCS,v=q.onComplete,u,o,s;q.onComplete=function(w){t.dispatchEvent("onCreateAssociatedBO");if(v){return v(t,t.parseBOReceipt(w),q)}};u=new FormData();o=this.getBOFormAttr(q);for(var r in o){u.append(r,o[r])}this.dispatchEvent("onBeforeCreateAssociatedBO",[u]);s=new XMLHttpRequest();s.upload.onprogress=this.onProgressBOCreation.bind(this);s.open("POST",p,true);s.onreadystatechange=function(){if(s.readyState===4){if(s.status===200){q.onComplete(s.responseText)}else{if(q.onFailure){q.onFailure(t,s.responseText,q)}}}};s.send(u);return s},parseBOReceipt:function(p){var o=j.createElement("div").setHTML(p).getElement('[name="__fcs__jobReceipt"]').value;return{receipt:o}},getBOFormAttr:function(p){p=p?j.clone(p,false):{};var o={};if(p.ticket&&p.ticket.name){o[p.ticket.name]=p.ticket.value}j.extend(o,{__fcs__jobTicket:p.ticket.value,"file-name":this.get("businessobj").file,file_0:p&&p.file,"file-title":this.get("businessobj").title,"file-description":this.get("businessobj").description});return o},getPreview:function(p){if(!p){p={}}var r=this,q,o=l(this,"url")+"/preview",s=p.onComplete;p.onComplete=function(u){var t;u=r.parsePreview(u);t=r.get("businessobj");r.set("businessobj",j.merge({thumbnail:u.thumbnail},t));if(s){return s(r,u,p)}};i.authenticatedRequest(o,j.extend({type:"json"},j.extend(p,b.getSyncOptions(),true)));return q},parsePreview:function(o){return o},download:function(o){if(!o){o={}}var p=o.onComplete;o.onComplete=function(r,s,q){window.open(s.url,"_self");if(p){return p(r,s,q)}};d(this,o);return this.getDownloadUrl(o)},promoteOrDemote:function(s){var o,p={},q=this;var r=this.collection._modelKey._facetObjs;p=j.extend(p,b.getSyncOptions(),true);o=l(this,"url");p.method="PUT";p.type="json";p.headers={"Content-Type":"application/ds-json",};p.data=JSON.stringify(s);p.onComplete=function(z){console.log(JSON.stringify(z));var t=q.collection._modelKey;var x=z.data[0].dataelements.taskDetails;var v="";for(var u in x){if(x[u].indexOf("routeStatus")>-1){v=x[u].split("~")[1];break}}if("Finished"===v){var y=["delete"];t.set("actions",y);t.set("routeStatus","Finished");t.set("state","Complete");t.setFormFieldValue(t._facetObjs,"routeStatus",k.Finished)}else{if("Stopped"===v){t.updateModelActions(t,"stoponrejection");t.set("routeStatus","Stopped");t.setFormFieldValue(t._facetObjs,"routeStatus",k.Stopped)}}var w=["tasks","taskgraph","access","contents"];h.reloadFacetObjects(r,w);if(s.data[0].dataelements.taskOwnerReviewAction==="promote"){a.add({message:k.successCompleteTask})}else{a.add({message:k.failureCompleteTask})}};p.onFailure=function(u,v,t){console.log(JSON.stringify(v.error));if(v.timedout){_alertWarning.add({message:k.warningCompleteTaskTimeout})}else{e.add({message:k.errorOwnerReviewComments})}};if(s.data[0].dataelements.taskOwnerReviewComments!==""){i.authenticatedRequest(o,p)}else{e.add({message:k.errorOwnerReviewComments})}},save:function(q,s,p){var o;if(j.is(q)&&(j.typeOf(q))==="object"){o=q;p=s;p.method="PUT";p.type="json";p.headers={"Content-Type":"application/ds-json",}}else{o=this._attributes;p=s;p.method="POST";p.type="json";p.headers={"Content-Type":"application/ds-json",}}var r=[];var t=[{title1:"title"},{type:"type"},{instructions:"attribute[Route Instructions]"},{taskDueDate:"attribute[Scheduled Completion Date]"},{taskOrder:"attribute[Route Sequence]"}];t.forEach(function(u){for(var v in u){r.push({op:"replace",path:u[v],value:o[v]})}});if(!j.is(p.data)){p.data=JSON.stringify(r)}else{p.data=JSON.stringify(p.data)}return this._parent.call(this,o,p)},getDownloadUrl:function(p){if(!p){p={}}var r=this,q,o=l(this,"url")+"/download",s=p.onComplete;p.onComplete=function(u){var t;u=r.parseDownload(u);if(s){return s(r,u,p)}};i.authenticatedRequest(o,j.extend({type:"json"},j.extend(p,b.getSyncOptions(),true)));return q},parseDownload:function(o){return o},onProgressBOCreation:function(p){if(p.lengthComputable){var o=(p.loaded/p.total)*100;this.dispatchEvent("onProgress",o)}},focusTaggerProxyOnSubject:function(){var p=this.collection,o;if(!p||!(o=p.taggerProxy)){return}o.focusOnSubjects(["pid://"+this.id])},"onChange:id":function(){this.getPreview()}});return g});define("DS/ENORouteMgmt/Models/CollabStorageModel",["UWA/Core","UWA/Class/Model","DS/ENORouteMgmt/EnoviaBootstrap"],function(f,e,b){function a(g,i){var h;if(g){h=g[i];if(f.is(h,"function")){h=h.call(g)}}return h}var c="collabstorage";var d=e.extend({name:c,defaults:{csrf:null,isInnovation:false,displayName:"",url:""},url:function(){return this.get("url")},fetch:function(h){var g=a(this,"url");h=h?f.clone(h,false):{};f.extend(h,b.getSyncOptions(),true);return this._parent.call(this,h)},parse:function(h){var g=f.clone(h);g.csrf=h.csrftoken;delete g.csrftoken;g.isInnovation=h.isinnovation;delete g.isinnovation;return g}});return d});define("DS/ENORouteMgmt/Views/Graph/RouteGraphicalView",["UWA/Core","DS/WAFData/WAFData","UWA/Class/View","UWA/Class/Model","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/W3DXComponents/Views/EmptyView","DS/ENORouteMgmt/EnoviaBootstrap","DS/UIKIT/Scroller","DS/ENORouteMgmt/jsPlumb","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(h,g,c,l,k,f,d,a,b,j,i){var e=c.extend({name:"route-graphical",className:"route-graphical",tagName:"div",setup:function(m){var n=this},render:function(){var n,o=this;n=a.getRouteServiceBaseURL()+"/bps/"+this.model.id;n=n+"?_="+$.now();var m={};m=h.extend(m,a.getSyncOptions(),true);m.method="GET";m.type="json";m.headers={"Content-Type":"application/ds-json",};m.onComplete=function(p){o.container.setHTML(p.sbTasks);j.init(p.sbConnections)};m.onFailure=function(r,q,p){};g.authenticatedRequest(n,m);return this},destroy:function(){var m=this;this.stopListening();this._parent()}});return e});define("DS/ENORouteMgmt/Views/Properties/TaskPropertiesView",["UWA/Core","DS/UIKIT/Alert","DS/WAFData/WAFData","DS/W3DXComponents/Views/Temp/TempItemView","DS/ENORouteMgmt/Views/ModelForm","DS/W3DXComponents/Views/Layout/ScrollView","DS/W3DXComponents/Views/Layout/TableView","DS/W3DXComponents/IdCard","DS/ENORouteMgmt/Views/Inputs/TaskDueDate","DS/ENORouteMgmt/EnoviaBootstrap","DS/ENORouteMgmt/Validations/ENORouteValidations","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/ENORouteMgmt/Utilities/Utils","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(n,c,a,h,i,r,o,p,m,e,d,q,b,f){var k=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),g=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});var l="content-properties";var j=h.extend({name:l,tagName:"div",_currentTaskOrders:null,_taskActionRequiredDetails:null,_dueDateNode:null,_routeTaskJSON:null,template:function(){return'<div class="'+this.getClassNames("-subcontainer")+'"></div>'},domEvents:{},init:function(s){var t=this;["container","template","tagName","domEvents"].forEach(function(u){delete s[u]});this._parent.call(this,s)},setup:function(s){this.container.addClassName(this.getClassNames("-container"));var t=new d();this._currentTaskOrders=t.createTaskOrders();this._createTaskAnyAllInfo();this._form=this._initForm();this.alert=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"error"})},_createTaskAnyAllInfo:function(){this._taskActionRequiredDetails=new Object();var w=this.model.collection;var z;var s=true;var x=new d();if(w._modelKey&&w._modelKey._facetObjs){var A=w._modelKey._facetObjs;for(var v=0;v<A.length;v++){if(A[v].reference==="tasks"){var t=A[v].collection._models;z=x.getRouteTasksData(t);break}}}var y=[];for(var v in z){var B=z[v].values;for(var u in B){if(z[v].itemname==="IT"&&B[u].taskCurrentStatus==="Complete"){continue}if(this._taskActionRequiredDetails[B[u].taskOrder]){this._taskActionRequiredDetails[B[u].taskOrder]=this._taskActionRequiredDetails[B[u].taskOrder]+1;this._taskActionRequiredDetails[B[u].taskOrder+"_routeNodes"]=this._taskActionRequiredDetails[B[u].taskOrder+"_routeNodes"]+B[u].routeNodeRelId+"~"}else{this._taskActionRequiredDetails[B[u].taskOrder]=parseInt("1");this._taskActionRequiredDetails[B[u].taskOrder+"_AnyAllDefaultValue"]=B[u].parallelNodeProcessionRule;this._taskActionRequiredDetails[B[u].taskOrder+"_routeNodes"]=B[u].routeNodeRelId+"~";this._taskActionRequiredDetails[B[u].taskOrder+"_visibility"]="Yes"}}}},_initForm:function(){var A=this.model;var B=this;var t;var C=new m({});if(A._attributes.taskDueDate!==""){var w=new Date(A._attributes.taskDueDate);C.dateInput.setValue(b.formatDateString(w));var F=(w.getHours()<10?"0":"")+w.getHours();var z=(w.getMinutes()<10?"0":"")+w.getMinutes();C.timeInput.value=F+":"+z;C.dateMsValue=w.getTime()}var E=A.get("type");var D=A.get("current");var x=A.get("approvalStatus");var s=A.collection._modelKey.get("routeStatus");if(E==="Inbox Task"){if(D==="Complete"){if(x==="Approve"){A._approvalStatus=f.approved}else{if(x==="Reject"){A._approvalStatus=f.rejected}else{if(x==="Abstain"){A._approvalStatus=f.abstained}else{A._approvalStatus=f.completed}}}}else{if(D==="Review"){A._approvalStatus=f.needsReview}else{if(s==="Stopped"){A._approvalStatus=f.RouteStopped}else{A._approvalStatus=f.awaitingApproval}}}}A._type=f[E];var v=[];if(A.collection._modelKey.get("routeBasePurpose")=="Approval"){v.push({value:"Approve",label:f.Approve});if(A.get("taskAction")!="Approve"){v.push({value:A.get("taskAction"),label:f[A.get("taskAction")]})}}else{if(A.collection._modelKey.get("routeBasePurpose")=="Review"){v.push({value:"Comment",label:f.Comment});if(A.get("taskAction")!="Comment"){v.push({value:A.get("taskAction"),label:f[A.get("taskAction")]})}}else{v.push({value:"Comment",label:f.Comment},{value:"Approve",label:f.Approve},{value:"Notify Only",label:f.notifyOnly})}}A._taskActionArray=v;A._current=f[D];var y={className:"vertical",fields:function(){var G=[{type:"text",name:"Assignee",attributes:{"data-attr":(this.get("assigneeType")==="Group"||this.get("assigneeType")==="Group Proxy")?"return this.get('assigneeTitle')":"return this.get('taskAssignee')","data-editable":false},label:f.taskassignee,options:[{value:this.get("taskAssignee"),label:this.get("taskAssignee"),}]},{type:"checkbox",name:"allowDelegation",value:"allowDelegation",label:f.allowDelegation},{type:"text",name:"type",attributes:{"data-attr":"return this._type","data-editable":false},label:f.type},{type:"text",name:"title1",attributes:{"data-attr":"return this.get('title').trim()","data-editable":this._attributes.type==="Route Node"?true:false},label:f.title,dataHolder:this,initialLoad:true,required:this._attributes.type==="Route Node"?true:false,events:{onChange:function(){console.log("title1");if(this.options.initialLoad===true){this.options.initialLoad=false}else{var H,I;var P=this.elements.input;var O=P.value.trim();var L=P.parentNode;var N=new d();if(O.length>0){var J=N.checkForUnifiedNameBadChars(O,true);var K=N.getAllNameBadChars(O);if(J.length!=0){if(L){L.addClassName("has-error")}P.focus();var M=f.replace(f.errorBadChar,{tag1:J,tag2:K});k.add({message:M})}else{if(L&&L.hasClassName("has-error")){L.removeClassName("has-error")}}}else{if(L){L.addClassName("has-error")}P.focus();var M=f.errorTitle;k.add({message:M})}}}}},{type:"textarea",name:"instructions",attributes:{"data-attr":"return this.get('instructions').trim()","data-editable":true},rows:5,label:f.instructions,placeholder:"",required:true,events:{onChange:function(){var K=this.elements.input;var I=K.parentNode;var H=K.value.trim();if(H.length<=0){var J=f.errorInstructions;if(I){I.addClassName("has-error")}K.focus();k.add({message:J})}else{if(I&&I.hasClassName("has-error")){I.removeClassName("has-error")}}}}},{type:"html",name:"taskDueDate",html:C,label:f.taskDueDate},{type:"checkbox",name:"assigneeSetDueDate",value:"assigneeSetDueDate",label:f.assigneeSetDueDate,events:{onChange:function(){console.log("assignee");var I=this.elements.content.form.getElementsByClassName("eno-duedate-container")[0].getChildren()[1];var H=I.getChildren()[0];var J=I.getChildren()[1];if(this.elements.input.checked){H.disabled=true;H.value="";J.disabled=true;J.value="12:00";if(H.parentNode){H.parentNode.removeClassName("has-error")}}else{H.disabled=false;J.disabled=false}}}},{type:"select",name:"action",attributes:{"data-attr":"return this.get('taskAction')","data-editable":this._attributes.type==="Route Node"},label:f.taskAction,options:this._taskActionArray},{type:"checkbox",name:"needsOwnerReview",value:"needsOwnerReview",label:f.needsOwnerReview,dataHolder:this,events:{onChange:function(){var K=this.options.dataHolder._form;if(K!==undefined){var H=K.getInput("reviewersComments");var J=K.getField("reviewersComments");if(J){var I=J.parentElement;if(this.isChecked()){I.style.display="block"}else{console.log("Remove field");I.style.display="none"}}}}}},{type:"select",name:"taskOrder",options:B._currentTaskOrders,attributes:{"data-attr":this.get("taskOrder")===""?"return 1":"return this.get('taskOrder')","data-editable":this._attributes.type==="Route Node"?true:false},dataHolder:this,label:f.taskOrder,required:this._attributes.type==="Route Node"?true:false,events:{onChange:function(){var I=parseInt(this.getValue());var O=this.options.dataHolder.collection._modelKey.get("currentRouteNode");var J=this.elements.input.parentNode;if(this.options.dataHolder.get("current")!=="Complete"&&I<parseInt(O)){var K=f.replace(f.errorTaskOrder,{tag1:O});if(J){J.addClassName("has-error")}k.add({message:K});return}var H=this.options.dataHolder._form;if(H!==undefined){var M=H.getInput("parallelNodeProcessionRule");var Q=H.getField("parallelNodeProcessionRule");var P=Q.parentElement;var N=P.parentElement;var L=this.options.dataHolder._facetObjs[0].view._taskActionRequiredDetails;if(L[this.getValue()[0]]>1){N.style.display="block";if(B._taskActionRequiredDetails[this.getValue()[0]+"_AnyAllDefaultValue"]==="Any"){M.setSelection("Any",true);M.syncInput()}else{M.setSelection("All",true);M.syncInput()}}else{console.log("Remove field");N.style.display="none"}}}}},{type:"text",name:"Route Owner",attributes:{"data-attr":"return this.collection._modelKey._attributes.ownerFullName","data-editable":false},label:f.routeOwner},{type:"select",name:"parallelNodeProcessionRule",label:f.taskRequiredAction,required:true,options:[{value:"Any",label:f.taskAnyOption,},{value:"All",label:f.taskAllOption,}],dataHolder:this,events:{onChange:function(){if(this.getValue()[0]===undefined){var J=this.options.dataHolder._form;if(J===undefined){var H=this.elements.input.parentElement;var I=H.parentElement;console.log("Remove field");I.style.display="none"}}}}}];if(this._attributes.type==="Inbox Task"){G[G.length]={type:"text",name:"Approval Status",attributes:{"data-attr":"return this._approvalStatus","data-editable":false},label:f.approvalStatus};G[G.length]={type:"text",name:"State",attributes:{"data-attr":"return this._current","data-editable":false},label:f.taskCurrentState};if(this._attributes.current!=="Assigned"){G[G.length]={type:"text",name:"reviewersComments",attributes:{"data-attr":"return this.get('reviewersComments')","data-editable":this.get("current")==="Review"},label:f.reviewComments,}}}return G},buttons:[{type:"submit",value:f.save},{type:"reset",value:f.cancel}],};var u=this.formProperties=new i(n.extend({model:this.model,events:{onSubmit:this._onFormSubmit.bind(this),onReset:this._onFormReset.bind(this)}},y));B.model._form=u;return u},setOptions:function(t){var s=t.idCard;if(s){this._setIdCard(s);delete t.idCard}return this._parent.apply(this,arguments)},_setIdCard:function(s){if(!(s instanceof p)){throw new Error("You try to set idCard option with no instance of idCard")}if(this._idCard){return}this._idCard=s;this.listenTo(s,{onSwitchToEditMode:this.dispatchAsEventListener("onEdit"),});if(s._mode===1){this.dispatchEvent("onEdit")}},_resetIdCard:function(){this._idCard._refreshSection("title");this._idCard._refreshSection("date");return this._switchIdCardToViewMode()},_switchIdCardToEditMode:function(){var s=this._idCard;if(s){s.switchToEditMode()}return s},_switchIdCardToViewMode:function(){var s=this._idCard;this._idCard._refreshSection("date");if(this._dueDateNode){this._dueDateNode.removeClassName("has-error")}if(s){s.switchToViewMode()}return s},reset:function(){var s=this._form;this._resetIdCard();s.reset();return this},onRender:function(){var s=this.getElement(".content-properties-subcontainer");this.formProperties.inject(s);s.render=function(){};s.container=s;var t=new r({view:s,useInfiniteScroll:false,usePullToRefresh:false});t.render().inject(this.container)},_onTitleChange:function(t,s){this.newtitle=t},_onFormSubmit:function(z){var s=this._form.options.fields[5].html.dateMsValue;var x=new Date(s);z.type=this.model._attributes.type;if(z.hasOwnProperty("title1")){z.title=z.title1}if(z.hasOwnProperty("action")){z.taskAction=z.action}if(z.hasOwnProperty("allowDelegation")){z.allowDelegation=z.allowDelegation==="true"?"Yes":"No"}if(z.hasOwnProperty("needsOwnerReview")){z.needsOwnerReview=z.needsOwnerReview==="true"?"Yes":"No";if(z.needsOwnerReview==="Yes"){z.reviewCommentsNeeded="Yes"}}if(this._form.getValue("assigneeSetDueDate")==="true"){z.assigneeSetDueDate="Yes";z.taskDueDate=""}else{z.assigneeSetDueDate="No";z.taskDueDate=x.toDateString()+" "+this._form.options.fields[5].html.mInputElement.childNodes[1].value}z.routeNodeRelIds=this._taskActionRequiredDetails[z.taskOrder+"_routeNodes"];var u=new d();this._routeTaskJSON=u.createTaskAnyAllInfo(this);var v=this,t=this.model,w=this.alert,A={onFailure:function(C,D,B){v.reset();w.add({message:f.errorEdit})},type:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"},wait:true};if(this._validateInputs(z)){this._save(z,A);for(var y in z){if(this.model._attributes.hasOwnProperty(y)){this.model._attributes[y]=z[y]}this.model._attributes[y]=this.model._attributes[y]==="Yes"?true:this.model._attributes[y]==="No"?false:this.model._attributes[y]}this._switchIdCardToViewMode();this.dispatchEvent("onEndEdit")}else{this.dispatchEvent("onEdit")}this.dispatchEvent("onEndEdit")},_save:function(s,u){u=n.extend(u,e.getSyncOptions(),true);u.method="PUT";u.data=JSON.stringify(new q().createDataForRequest(s));var v=u;var t=this.model;var x=this.model.collection._models;var w="";if(this._taskActionRequiredDetails[this.model.get("taskOrder")+"_routeNodes"]!==undefined){w=this._taskActionRequiredDetails[this.model.get("taskOrder")+"_routeNodes"].split("~")}u.onComplete=function(A){console.log(JSON.stringify(A));var y=t.collection._modelKey._facetObjs;var C=["taskgraph"];b.reloadFacetObjects(y,C);for(var F in s){if(t._attributes.hasOwnProperty(F)){s[F]=t._attributes[F]}}var D=s.title1!==undefined?s.title1:s.title;var B=s.action!==undefined?s.action:s.taskAction;var E={title1:D,title:D,name:D,taskOrder:s.taskOrder,order:s.taskOrder,dueDate:s.taskDueDate,allowsDelegation:s.allowDelegation,requiresOwnerReview:s.needsOwnerReview,tskaction:B};t.set(E,v);var G=w.toString();for(var z in x){if(G.indexOf(x[z].id)>-1){x[z].set("parallelNodeProcessionRule",s.parallelNodeProcessionRule)}}g.add({message:f.successEditTask})};u.onFailure=function(z,A,y){console.log(JSON.stringify(A.error));k.add({message:f.errorEdit})};a.authenticatedRequest(this.model.url(),u)},_onFormReset:function(){this._resetIdCard();this.dispatchEvent("onEndEdit")},_validateInputs:function(s){var t=new d();if(t.taskValidation(this)){return true}return false},onFacetSelect:function(t){var s;s=t.getIdCardAt(2);this.setOptions({idCard:s})},onEdit:function(){var t=this.formProperties;t.dispatchEvent("onEdit");var u=t.options.fields[5].html.elements.input.getChildren()[1];var v=u.getChildren()[0];var s=u.getChildren()[1];if(t.getValue("assigneeSetDueDate")==="true"){v.disabled=true;v.value="";s.disabled=true;s.value="12:00"}},onEndEdit:function(){delete this.newtitle},onDestroy:function(){if(this.formProperties){this.formProperties.destroy();delete this.formProperties}}});return j});define("DS/ENORouteMgmt/Views/Modals/ModalCreateTask",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/ENORouteMgmt/Views/Creates/CreateTaskView","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(d,f,a,c,e){var b=f.extend({init:function(g){var k=this,i,l,j,n,h,m;g=d.clone(g||{},false);this._parent(g);i=d.clone(g.events||{},false);l=g.onComplete;j=g.onFailure;n=i.onCancel;m=function(){document.removeEventListener("keydown",h.onKeyDown);h.destroy();k.destroy();window.savemodelRef=null};i.onCancel=function(){m();if(d.is(n)){n.apply(this,arguments)}};g.events=i;g.onComplete=function(){m();if(d.is(l)){l.apply(undefined,arguments)}};g.onFailure=function(){m();if(d.is(j)){j.apply(undefined,arguments)}};h=new c(g);this.elements.modal=new a({closable:true,header:e.createTaskTitle,form:h,body:h.render(),footer:[h.getApplyButton(),h.getCreateButton(),h.getCancelButton()]})},show:function(){var h=this.elements,g=h.modal;window.savemodelRef=g;g.inject(document.body);g.show();g.options.form.getFormFirstInput().focus()}});return b});define("DS/ENORouteMgmt/Collections/CollabStorageCollection",["UWA/Core","UWA/Utils","UWA/Class/Collection","DS/PlatformAPI/PlatformAPI","DS/ENORouteMgmt/Models/CollabStorageModel","DS/i3DXCompassServices/i3DXCompassServices",],function(e,c,h,f,d,a){var g="collabstorages";function i(j,l){var k;if(j){k=j[l];if(e.is(k,"function")){k=k.call(j)}}return k}var b=h.extend({name:g,model:d,fetch:function(j){var k=this;a.getPlatformServices({serviceName:"3DSpace",onComplete:function(l){Object.keys(l).map(function(m){k.add({id:l[m].platformId,displayName:l[m].displayName,url:l[m]["3DSpace"]})});if(j&&j.onComplete){j.onComplete(k)}},onFailure:function(l){if(j&&j.onFailure){j.onFailure(l)}}})},getStorageWithUrl:function(k,j){j=e.clone(j||{},false);var m=this,o=c.parseUrl(k).domain,n=j.domainStrict,l;l=function(q){var p=c.parseUrl(i(q,"url")).domain;return p===o};if(!e.is(o)){return}return this.find(l)}});return b});define("DS/ENORouteMgmt/Views/Properties/ContentPropertiesView",["UWA/Core","DS/UIKIT/Alert","DS/W3DXComponents/Views/Temp/TempItemView","DS/ENORouteMgmt/Views/ModelForm","DS/W3DXComponents/Views/Layout/ScrollView","DS/W3DXComponents/Views/Layout/TableView","DS/W3DXComponents/IdCard","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(g,j,b,d,a,e,c,i){var h="content-properties";var f=b.extend({name:h,tagName:"div",template:function(){return'<div class="'+this.getClassNames("-subcontainer")+'"></div>'},domEvents:{},init:function(k){var l=this;["container","template","tagName","domEvents"].forEach(function(m){delete k[m]});this._parent.call(this,k)},setup:function(k){this.container.addClassName(this.getClassNames("-container"));this._form=this._initForm();this.alert=new j({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"error"})},_initForm:function(){var k=this.model;var l={className:"vertical",fields:function(){var n=[{type:"text",name:"type",attributes:{"data-attr":"return this.get('businessobj').type_nls","data-editable":false},label:i.type},{type:"textarea",name:"description",attributes:{"data-attr":"return this.get('businessobj').description","data-editable":true},rows:5,label:i.description,placeholder:""},{type:"date",name:"modified",attributes:{"data-attr":"return new Date(this.get('businessobj').modified)","data-editable":false},label:i.modified},{type:"text",name:"owner",attributes:{"data-attr":"return this.get('businessobj').owner","data-editable":false},label:i.owner},{type:"text",name:"maturity",attributes:{"data-attr":"return this.get('businessobj').stateNLS","data-editable":false},label:i.maturity}];return n},buttons:[{type:"submit",value:i.save},{type:"reset",value:i.cancel}]};var m=this.formProperties=new d(g.extend({model:this.model,events:{onSubmit:this._onFormSubmit.bind(this),onReset:this._onFormReset.bind(this)}},l));return m},setOptions:function(l){var k=l.idCard;if(k){this._setIdCard(k);delete l.idCard}return this._parent.apply(this,arguments)},_setIdCard:function(k){if(!(k instanceof c)){throw new Error("You try to set idCard option with no instance of idCard")}if(this._idCard){return}this._idCard=k;this.listenTo(k,{onSwitchToEditMode:this.dispatchAsEventListener("onEdit"),onTitleChangeRequest:this._onTitleChange});if(k._mode===1){this.dispatchEvent("onEdit")}},_resetIdCard:function(){this._idCard._refreshSection("title");this._idCard._refreshSection("date");return this._switchIdCardToViewMode()},_switchIdCardToEditMode:function(){var k=this._idCard;if(k){k.switchToEditMode()}return k},_switchIdCardToViewMode:function(){var k=this._idCard;this._idCard._refreshSection("date");if(k){k.switchToViewMode()}return k},reset:function(){var k=this._form;this._resetIdCard();k.reset();return this},onRender:function(){var k=this.getElement(".content-properties-subcontainer");this.formProperties.inject(k);k.render=function(){};k.container=k;var l=new a({view:k,useInfiniteScroll:false,usePullToRefresh:false});l.render().inject(this.container)},_onTitleChange:function(l,k){this.newtitle=l},_onFormSubmit:function(s){var n=this,o=this.model,p=this.alert,u={onFailure:function(w,x,v){n.reset();p.add({message:i.errorEdit})},type:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"},wait:true};var r=!(typeof this.newtitle=="undefined")&&this.newtitle!=null;if(r){var q=null;if(!this.newtitle||this.newtitle.length===0){q=i.errorEmptyTitle}if(this.newtitle.length>128){q=i.errorTooLong}var l=this._idCard._controls.titleInput.elements.container;if(q){l.addClassName("has-error");p.add({message:q});this.formProperties.dispatchEvent("onEdit");return}else{l.removeClassName("has-error")}}this._switchIdCardToViewMode();var k=o.get("businessobj");var m=(k.description!=s.description);k.description=s.description;if(r){k.title=this.newtitle}var t={businessobj:k};if(r||m){o.save(t,u)}this.dispatchEvent("onEndEdit")},_onFormReset:function(){this._resetIdCard();this.dispatchEvent("onEndEdit")},onFacetSelect:function(l){var k;k=l.getIdCardAt(2);this.setOptions({idCard:k})},onEdit:function(){var k=this.formProperties;k.dispatchEvent("onEdit")},onEndEdit:function(){delete this.newtitle},onDestroy:function(){if(this.formProperties){this.formProperties.destroy();delete this.formProperties}}});return f});define("DS/ENORouteMgmt/SkeletonUtils/ContentSkeletonOptions",["UWA/Drivers/Alone","UWA/Core","DS/WAFData/WAFData","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Form","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/W3DXComponents/Views/Temp/TempItemView","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/EmptyView","DS/ENORouteMgmt/Models/ContentModel","DS/ENORouteMgmt/EnoviaBootstrap","DS/ENORouteMgmt/Views/Properties/ContentPropertiesView","DS/TopBarProxy/TopBarProxy","DS/WebappsUtils/WebappsUtils","DS/ENORouteMgmt/Utilities/Utils","DS/ENORouteMgmt/Views/Modals/ModalRemoveContent","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(c,C,p,l,a,r,d,z,f,I,H,B,G,t,i,E,D,h,g){var b=widget.getValue("role")+"."+widget.getValue("organization")+"."+widget.getValue("collaborative");var F,s=null,w=new l({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),n=new l({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});function o(K,M){var L;if(K){L=K[M];if(C.is(L,"function")){L=L.call(K)}}return L}function x(O,K,R,N){var Q=R.model.get("id"),M=this.collection,P=M._modelKey.id,L;switch(Q){case"add.contents":F.onSearchClick(this);break;default:console.log(Q+" is not permitted in the action bar.");break}}function j(){var K=this,N=this.collection,M,O,L=F.getFetchOptions();M=L.onComplete;L.onComplete=function(R,Q,P){if(K.container.offsetParent){K.container.removeClassName("loading");Object.keys(K.contentsViews).map(function(S){K.contentsViews[S].scrollView.endLoading()})}if(M){M(K,Q,P)}};if(N.state.totalRecords===null){N.getFirstPage(L)}else{if(N.hasNextPage()){N.getNextPage(C.extend(L,{remove:false,reset:false}))}else{K.container.removeClassName("loading");Object.keys(K.contentsViews).map(function(P){K.contentsViews[P].scrollView.useInfiniteScroll(false)})}}}function e(){var K=this;this.collection.getFirstPage(C.extend({onComplete:function(){K.scrollView.endLoading()}},F.getFetchOptions()))}function v(L,K){}function A(K){return{envId:G.getStorage().id,serviceId:"3DSpace",contextId:b,objectId:K.get("physicalid"),objectType:K.get("businessobj").type,displayName:K.get("businessobj").title,displayType:K.get("businessobj").type,}}function m(K){}function J(){}function u(){}function k(){}function y(){var K=this.collection;if(K){K.activateTaggerProxy();if(K.isNewFilter){K.fetch(F.getFetchOptions())}}}function q(){if(this.collection){this.collection.deactivateTaggerProxy()}}F={selected_Objects_search:function(Q,O){console.log(O);var K={};var M=[];for(var P=0;P<O.length;P++){K={};K.label=O[P]["ds6w:label"];K.modified=O[P]["ds6w:modified"];K.status=O[P]["ds6w:status"];M.push(K)}var L=G.getRouteServiceBaseURL()+"/"+F.routeId+"/contents";var S=new Array();for(var P=0;P<O.length;P++){var R={id:O[P].id};S.push(R)}var N={csrf:widget.data.csrf,data:S};var T={};T=C.extend(T,G.getSyncOptions(),true);T.method="PUT";T.type="json";T.headers={"Content-Type":"application/ds-json",};T.data={csrf:widget.data.csrf};T.data=JSON.stringify(N);T.onComplete=function(W){console.log(JSON.stringify(W));var V=Q.collection._modelKey._facetObjs;var U=["contents"];D.reloadFacetObjects(V,U);n.add({message:g.successAddContent})};T.onFailure=function(V,W,U){if(W.internalError!=undefined&&W.internalError.indexOf("A relationship of this type already exists")!=-1){w.add({message:g.errorAddExistingContent})}else{w.add({message:g.ErrorAddContent});console.log("Add content failed : "+W.internalError)}};p.authenticatedRequest(L,T)},onSearchClick:function(L){console.log("input clicked");var N;var M=c.Utils.getUUID();var K=this;K.is3DSearchActive=true;if(!c.is(N)){require(["DS/SNInfraUX/SearchCom"],function(Q){N=Q.createSocket({socket_id:M});var R={title:g.addContent,role:"",mode:"furtive",default_with_precond:true,precond:D.getPrecondForContentSearch(),show_precond:false,multiSel:true,idcard_activated:false,select_result_max_idcard:false,itemViewClickHandler:"",app_socket_id:M,widget_id:M,search_delegation:"3dsearch",default_search_criteria:""};if(widget.getPreference("collab-storage")!=undefined){R.tenant=widget.getPreference("collab-storage").value}var O=L.collection._modelKey._attributes.attrScope[2];F.routeId=L.collection._modelKey.id;if(O!=""&&typeof O!="undefined"){R.precond+=' AND route_95_content_95_scope:"'+O+'"'}var P=D.getSelectedTypesForRecentSearch();R.recent_search={types:P};R.app_socket_id=M;R.widget_id=M;R.global_actions=[{id:"incontextHelp",title:g["search.help"],icon:"fonticon fonticon-help",overflow:false}];if(c.is(N)){N.dispatchEvent("RegisterContext",R);N.addListener("Selected_Objects_search",K.selected_Objects_search.bind(K,L));N.dispatchEvent("InContextSearch",R)}else{throw new Error("Socket not initialized")}})}},getFetchOptions:function(K){return{type:"json",headers:{"Content-Type":"application/ds-json",},reset:true,objectSelectBO:["name","description","current","modified","title","type"],onFailure:function(){w.add({message:g.errorFetchContents})}}},getIdCardOptions:function(K){return{collapsed:K.minimizeIdCardView,editableElements:function(){return["description"]},thumbnailUrl:function(){return this.get("businessobj").thumbnail},attributesMapping:{title:function(){return this.get("businessobj").title},image:function(){return this.get("businessobj").image},ownerName:function(){return this.get("businessobj").owner},date:function(){var L=new Date(this.get("businessobj").modified);return L.toGMTString().parseRelativeTime()}},actions:function(){var M=[],L=false;return L?[{text:g.editProperties,icon:"pencil",handler:function(P,O){var N;this.selectFacet("properties");this.switchToEditMode()}}]:[]},facets:[{name:"properties",text:g.properties,icon:"doc-text",handler:I.getRendererHandler(t)}]}},getContentSetOptions:function(K){return{className:"loading",actions:{filterer:function(M,L){return !!M.get("actionBar")&&M.id.indexOf(".contents")!==-1},collection:function(){var M=this.collection,L=M._modelKey;return L&&L.actions}},contents:{selectionMode:"oneToOne",headerOnEmpty:false,defaultView:"tile",headers:[{property:"title",icon:"icon",label:g.title},{property:"ctname",label:g.name},{property:"subtitle",label:g.maturity},{property:"owner",label:g.owner},{property:"content_modified",sortable:true,label:g.modified,},{label:g.actions,actions:true}],sort:function(Q,N,O){var P=O.split(/[\.\[\]]/).pop();P=(P==="created")?"originated":P;var L=(N==="ascending")?"a":"d";L=L+P;var M=C.extend(F.getFetchOptions(),{data:{sort:L}});Q.getFirstPage(M)},itemViewOptions:{mapping:{title:function(){return this.model.get("title")},ctname:function(){return this.model.get("name")},owner:"businessobj.owner",content:function(){var N,O=this.model.get("businessobj"),L,M;if(!O){return}L=new Date(this.model.get("businessobj").modified);M=this.model.get("businessobj").description;N=g.modified+" : "+L.toGMTString().parseRelativeTime();return N},content_modified:function(){var L=new Date(this.model.get("modified"));return D.formatDateString(L)},content_created:"businessobj.created",icon:function(){return this.model.get("typeicon")},image:function(){var L=G.getSNIconServiceBaseURL+"/iconLargeDefault.png";if(this.model.get("image")){L=this.model.get("image")}else{switch(this.model.get("type")){case"VPMReference":L=G.getSNIconServiceBaseURL+"/I_VPMNavProduct108x144.png";break}}return L},subtitle:"businessobj.current"},contextualActions:function(){var M=this.collection,L=[];if(this._attributes.type==="Document"){L.push({text:g.download,fonticon:"download",handler:function(N){N.model.downloadContent()}})}if(this._attributes.canDeleteContent==="true"){L.push({text:g.deleteContent,fonticon:"trash",handler:function(O){var N=new h({model:O.model});N.showModal()}})}return L},icon:"docs",title:g.emptyContentTitle,},emptyView:H,events:{onItemViewSelect:v,onPullToRefresh:e}},events:{onActionClick:x,onItemViewSelect:u,onUnSelectAll:k,onFacetUnselect:q,onFacetSelect:y,onDestroy:q,onInfiniteScroll:j,onItemViewDrag:J}}},getListViewOptions:function(){return{className:"loading",contents:{useInfiniteScroll:true,usePullToRefresh:true,defaultView:"tile",itemViewOptions:{mapping:{title:"name",content:function(){return this.model.get("physicalid")},icon:function(){return E.getWebappsAssetUrl("ENORouteMgmt","icons/16/I_Document16.png")},image:function(){return E.getWebappsAssetUrl("ENORouteMgmt","icons/48/I_Document48.png")},subtitle:"physicalid"},icon:"docs",title:g.emptyContentTitle,},emptyView:H,events:{onItemViewClick:function(L,K,M){},onItemViewSelect:u,onUnSelectAll:k,onPullToRefresh:e,onDestroy:q,onRender:y}},events:{onInfiniteScroll:j,onItemViewDrag:J}}}};window.ContentSkeletonOptions=F;return F});define("DS/ENORouteMgmt/Views/Creates/CreateRouteView",["UWA/Core","UWA/Element","DS/UIKIT/Form","DS/WAFData/WAFData","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Alert","UWA/Class/View","DS/ENORouteMgmt/Views/Inputs/SearchRouteTemplate","DS/ENORouteMgmt/Views/Inputs/SearchSelectScope","DS/ENORouteMgmt/Views/Inputs/SelectPreserveTaskOwner","DS/ENORouteMgmt/Utilities/ParseJSONUtil","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","DS/ENORouteMgmt/EnoviaBootstrap","css!DS/ENORouteMgmt/ENORouteMgmt.css",],function(m,d,f,a,i,j,p,g,o,n,l,k,q,c,b){var h=new g({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),e=new g({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});var r=o.extend({name:"createRoute",tagName:"div",className:"create-cs-view",init:function(s){var t=UWA.clone(s,false);["container","template","tagName","domEvents"].forEach(function(u){delete t[u]});this._parent(t)},setup:function(){this.container.addClassName(this.getClassNames("-container"));this._initForm();this._initListenKeyDown()},_initForm:function(){var A=this,D=this.options,B=this.collection,s=this.elements,u,v,t,z,C;u=function(F,E){if(F){E.addClassName("has-error");alertFailure.add({message:F})}else{s.create.setDisabled(false);E.removeClassName("has-error")}};var y=new n({});var w=new l({});var x=new k({});v=[{type:"text",name:"name",required:true,disabled:true,label:c.name,maxlength:"128",placeholder:c.placeholderTitle,pattern:"^((?!#)(?!,)(?!\\[)(?!\\$)(?!\\])(?!\\^)(?!@)(?!%)(?!:)(?!')(?!\")(?!\\\\)(?!\\.)(?!/)(?!\\*)(?!\\?)(?!<)(?!>).)*$",events:{onChange:function(){var F=this.getValue().trim();if(F!==""){var E=this.elements.input.parentNode;if(E){E.removeClassName("has-error")}}}}},{type:"checkbox",value:"true",name:"autoname",label:c.autoname,dataHolder:this,events:{onChange:function(){this.options.dataHolder.elements.form.getInput("name").setDisabled(this.isChecked());this.options.dataHolder.elements.form.setValue("name","")}}},{type:"html",name:"routeTemplate",html:y},{type:"textarea",name:"description",rows:3,label:c.description,required:true,placeholder:c.placeholderDescription,events:{onChange:function(){var F=this.getValue().trim();if(F!==""){var E=this.elements.input.parentNode;if(E){E.removeClassName("has-error")}}}}},{type:"select",name:"routeBasePurpose",label:c.routeBasePurpose,nativeSelect:false,required:true,placeholder:false,options:[{value:"Standard",label:c.Standard,selected:true},{value:"Approval",label:c.Approval},{value:"Review",label:c.Review}]},{type:"select",name:"routeCompletionAction",label:c.routeCompletionAction,nativeSelect:false,required:true,placeholder:false,options:[{value:"Notify Route Owner",label:c.notifyRouteOwner},{value:"Promote Connected Object",label:c.promoteConnectedObject,selected:true}]},{type:"select",name:"routeAutoStopOnRejection",label:c.routeAutoStopOnRejection,nativeSelect:false,required:true,placeholder:false,options:[{value:"Immediate",label:c.immediate,selected:true},{value:"Deferred",label:c.deferred}]},{type:"html",name:"selectScope",html:w},{type:"html",name:"selectPreserveTaskOwner",html:x}];t=new f({fields:v,events:{onSubmit:function(){A.onCreate()},onInvalid:function(E){},onValid:function(){}}});A._form=t;z=new i({value:c.create,className:"primary",events:{onClick:this.dispatchAsEventListener("onCreate")}});C=new i({value:c.cancel,events:{onClick:this.dispatchAsEventListener("onCancel")}});s.form=t;s.create=z;s.cancel=C},getCreateButton:function(){return this.elements.create},getCancelButton:function(){return this.elements.cancel},getFormFirstInput:function(){return this.elements.form.elements.container[0]},_initListenKeyDown:function(){this.onKeyDown=this.onKeyDown.bind(this);document.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(w){if(w.keyCode===13){if(this.submitEnabled()){}}else{if(w.keyCode===27){var s=document.createEvent("Event");s.initEvent("click",true,false);this.elements.cancel.elements.content.dispatchEvent(s)}}if(w.page=="searchRouteTemplate"){var t=this._form.getInput("description");t.setValue(this.elements.form.options.fields[2].html.mTextElement.description);var v=this._form.getInput("routeBasePurpose");v.setValue(this.elements.form.options.fields[2].html.mTextElement.routeBasePurpose);var u=this._form.getInput("routeAutoStopOnRejection");u.setValue(this.elements.form.options.fields[2].html.mTextElement.routeAutoStopOnRejection);if(this.elements.form.options.fields[2].html.mTextElement.scope=="Organization"){this.elements.form.options.fields[7].html.mCheckElementOrg.getChildren()[0].getChildren()[0].checked=true;this.elements.form.options.fields[7].html.options.scope="Organization"}if(this.elements.form.options.fields[2].html.mTextElement.preserveTaskOwner=="True"){this.elements.form.options.fields[8].html.mCheckElementReset.getChildren()[0].getChildren()[0].checked=true}this.elements.form.options.fields[8].html.options.preserveTaskOwner=this.elements.form.options.fields[2].html.mTextElement.preserveTaskOwner}},submitEnabled:function(){var s=this.elements.create.elements.content.getAttribute("disabled");return s===null?true:false},render:function(){var v=this.elements,u=v.form,s=v.create,t=v.cancel;this.container.setContent([u,{tag:"div","class":"footer",}]);return this},onCreate:function(){var y=this,C=this.options,B=this.collection,w=C.onComplete,v=C.onFailure,u,x;u={name:this.elements.form.getValue("name"),description:this.elements.form.getValue("description"),routeBasePurpose:this.elements.form.getValue("routeBasePurpose"),routeCompletionAction:this.elements.form.getValue("routeCompletionAction"),AutoStopOnRejection:this.elements.form.getValue("routeAutoStopOnRejection"),startRouteAutomatically:this.elements.form.getValue("startRouteAutomatically"),preserveTaskOwner:this.elements.form.getValue("preserveTaskOwner"),templateId:(this.elements.form.options.fields[2].html.mTextElement.id==="")?null:this.elements.form.options.fields[2].html.mTextElement.id,attrScope:this.elements.form.options.fields[7].html.options.scope};if(u.attrScope===""){h.add({message:c.ScopeSelectMessage});return}x=new q().createDataForRequest(u);var z=new RegExp("\\s$","i");var t=this.elements.form.getValue("name");while(z.test(t)){t=t.substring(0,t.length-1)}this.elements.form.setValue("description",this.elements.form.getValue("description").trim());this.elements.form.setValue("name",this.elements.form.getValue("name").trim());if((!this.elements.form.validate())){if(t.length==0&&this.elements.form.getValue("autoname")==="false"){h.add({message:c.errorEmptyTitle})}else{if(this.elements.form.getValue("description").length===0){h.add({message:c.errorEmptyDescription})}else{var A=" \\ \" # $ @ % * , ? < > [ ] | : . ^ '";h.add({message:c.replace(c.errorCharacterTitle,{tag1:A})})}}return}this.elements.create.setDisabled();C.onFailure=function(E,F,D){B.remove(E);if(m.is(v)){v.apply(undefined,arguments)}};C.method="POST";C.type="json";C.headers={"Content-Type":"application/ds-json",};C.wait=true;var s=b.getRouteServiceBaseURL();C.data=JSON.stringify(x);C.onFailure=function(E,F,D){if(F.internalError!=undefined&&F.internalError.indexOf("'type name revision' not unique")!=-1){h.add({message:c.replace(c.errorCreateRouteNotUnique,{tag1:y.elements.form.getValue("name")})})}else{if(F.error!=undefined&&F.error.indexOf("No create Access For Role")!=-1){h.add({message:c.errorCreateRouteForRole})}else{h.add({message:c.replace(c.errorCreateRoute,{tag1:y.elements.form.getValue("name")})});console.log("Route Creation failed : "+F.internalError)}}y.elements.cancel.elements.container.click()};a.authenticatedRequest(s,C)}});return r});define("DS/ENORouteMgmt/Views/Modals/ModalSuscibeRoute",["UWA/Controls/Abstract","UWA/Controls/Input","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/W3DXComponents/Views/Temp/TempItemView","DS/ENORouteMgmt/Views/RouteSubscribeEvents","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(c,f,j,h,b,e,d,g,i){var a=c.extend({init:function(k){var m=this;this._parent(k);this.resetModal();var l=new g(k);var n=new e({value:i.Cancel,className:"default",events:{onClick:function(o){m.onCancelCalled()}}});this.modal=new h({closable:true,header:i.subscribeRouteEvents,body:l.render(),footer:[l.getCreateButton(),n]});this._alertFailure=new j({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"});this._alertSuccess=new j({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});this._alertWarning=new j({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"warning"})},showModal:function(){var k=this;window.savemodelRef=this.modal;this.modal.inject(document.body);this.modal.show()},onSuscribeRouteCalled:function(){},onCancelCalled:function(){this.modal.destroy();this.resetModal();window.savemodelRef=null},resetModal:function(){},onDestroy:function(){this._alertFailure.destroy();this._alertSuccess.destroy()}});return a});define("DS/ENORouteMgmt/Models/RouteModel",["UWA/Core","DS/WAFData/WAFData","UWA/Class/Model","DS/ENORouteMgmt/EnoviaBootstrap","DS/W3DXComponents/Collections/ActionsCollection","DS/WebappsUtils/WebappsUtils","DS/UIKIT/SuperModal","DS/ENORouteMgmt/Views/Modals/ModalSuscibeRoute","DS/UIKIT/Alert","DS/ENORouteMgmt/Utilities/Utils","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(p,a,l,e,r,d,o,h,c,b,f){function i(s,u){var t;if(s){t=s[u];if(p.is(t,"function")){t=t.call(s)}}return t}var k=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),g=new c({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});function q(s){new o({closable:true,animate:true,overlay:true,}).alert(s,function(){console.log("A sample alert message callback")})}function j(s){var t=new o({renderTo:document.body});t.dialog({body:'<form>  <input type="radio" name="demote" value="Yes" checked> Yes<br> <input type="radio" name="demote" value="No"> No<br></form> ',title:s,buttons:[{className:"primary",value:"Ok",action:function(u){var v=document.querySelector('input[name="demote"]:checked').value;u.hide();return v}}],})}var m="routes";var n=l.extend({name:m,defaults:{},routeActionOptions:function(){var s={};s=p.extend(s,e.getSyncOptions(),true);s.method="PUT";s.type="json";s.headers={"Content-Type":"application/ds-json",};s.data={csrf:widget.data.csrf};s.data=JSON.stringify(s.data);return s},idAttribute:"id",actions:null,parse:function(t){var s;if(!p.is(t.title)){t.title=t.name}s=t.owner;t.owner={};t.owner.name=s;t.owner.picture=d.getWebappsAssetUrl("ENORouteMgmt","icons/144/I_Route108x144.png");t.thumbnail=d.getWebappsAssetUrl("ENORouteMgmt","icons/144/I_Route108x144.png");t.icon=d.getWebappsAssetUrl("ENORouteMgmt","icons/16/I_Route16.png");return t},sync:function(u,t,s){p.extend(s,e.getSyncOptions(),true);return this._parent.apply(this,arguments)},setup:function(s,t){if(!this.actions){(this.actions=new r([],{_modelKey:this}))}if(t&&t.actionsCtx&&t.actionsCtx instanceof r){(this.actionsCtx=t.actionsCtx)}},_mapActions:function(s,t){var w,v,u;if(p.is(this.actionsCtx)){v=this.actionsCtx}else{if(t&&t.actionsCtx&&t.actionsCtx instanceof r){v=t.actionsCtx}}if(s&&Array.isArray(s)){w=s.map(function(y){if(p.is(y,"object")){return y}else{if(v){var x=v.get(y);if(!x){throw new Error("No corresponding action in the specified actionCtx")}return new r.prototype.model(x._attributes)}else{return y}}})}return w?w:s},set:function(u,v,t){var s;if(u!=="actions"&&!u.actions){return this._parent.apply(this,arguments)}if(p.is(u,"object")||u===null){s=u;t=v||{}}else{s={};s[u]=v;t=t||{}}return this._setAttrWithActions(s,t)},_setAttrWithActions:function(s,t){var v=this._mapActions(s.actions,t),u=l.prototype.set.apply(this,arguments);if(!this.actions){(this.actions=new r([],{_modelKey:this}))}this.actions[t.reset?"reset":"set"](v,t);return u},openExternal:function(){var s=e.get3DSpaceURL()+"/common/emxNavigator.jsp?objectId="+this.id;window.open(s)},startRoute:function(){var s,t={};var u=this;s=i(this,"url")+"/start";t=this.routeActionOptions();t.onComplete=function(v){console.log(JSON.stringify(v));u.updateModelActions(u,"start");u.set("routeStatus","Started");u.setFormFieldValue(u._facetObjs,"routeStatus",f.Started);g.add({message:f.routeStarted})};t.onFailure=function(x,w,v){console.log(JSON.stringify(w.error));if(w.error.indexOf("Route cannot be started")!=-1){k.add({message:f.failureToStartRoute1})}else{k.add({message:f.failureToStartRoute})}};a.authenticatedRequest(s,t)},restartRoute:function(){var t,s={};var u=this;s=this.routeActionOptions();t=i(this,"url")+"/restart";s.onComplete=function(v){console.log(JSON.stringify(v));u.updateModelActions(u,"restart");u.set("routeStatus","Started");u.setFormFieldValue(u._facetObjs,"routeStatus",f.Started);g.add({message:f.successRouteRestart})};s.onFailure=function(x,w,v){console.log(JSON.stringify(w.error));if(w.error.indexOf("Check trigger blocked event")!=-1){k.add({message:f.FailureRouteRestart1})}else{k.add({message:f.FailureRouteRestart})}};a.authenticatedRequest(t,s)},resumeRoute:function(){var t,s={};s=this.routeActionOptions();var u=this;t=i(this,"url")+"/resume";s.onComplete=function(v){console.log(JSON.stringify(v));u.updateModelActions(u,"resume");u.set("routeStatus","Started");u.setFormFieldValue(u._facetObjs,"routeStatus",f.Started);g.add({message:f.successRouteResume})};s.onFailure=function(x,w,v){console.log(JSON.stringify(w.error));if(w.error.indexOf("Route cannot be started for future states of the associated type")!=-1){k.add({message:f.FailureRouteRestart1})}else{k.add({message:f.FailureRouteResume})}};a.authenticatedRequest(t,s)},subscribeRoute:function(){var t=this;var s=new h({model:t});s.showModal()},setFormFieldValue:function(s,w,v){for(var t in s){if(typeof s[t].reference=="function"){var u=s[t].view._form;u.setValue(w,v,true);break}}},updateModelActions:function(w,x){var u;var t=w.get("actions");if(x=="stop"){u=t.indexOf("edit.stoproute");if(u!=-1){t.splice(u,1)}t.push("edit.restartroute");t.push("edit.resumeroute")}else{if(x=="start"){u=t.indexOf("edit.startroute");if(u!=-1){t.splice(u,1)}t.push("edit.stoproute")}else{if(x=="resume"||x=="restart"){u=t.indexOf("edit.resumeroute");if(u!=-1){t.splice(u,1)}u=t.indexOf("edit.restartroute");if(u!=-1){t.splice(u,1)}t.push("edit.stoproute")}else{if(x=="stoponrejection"){u=t.indexOf("edit.stoproute");if(u!=-1){t.splice(u,1)}t.push("edit.restartroute")}}}}var s=w._facetObjs;var v=["tasks"];b.reloadFacetObjects(s,v);w.set("actions",t)},stopRoute:function(s){var t,v={};var u=this;v=this.routeActionOptions();t=i(this,"url")+"/stop?demoteConnectedObject="+s;v.onComplete=function(w){console.log(JSON.stringify(w));u.updateModelActions(u,"stop");u.set("routeStatus","Stopped");u.setFormFieldValue(u._facetObjs,"routeStatus",f.Stopped);g.add({message:f.routeStopped})};v.onFailure=function(y,x,w){if(s&&x.error.indexOf("No privilege for operation")!=-1){k.add({message:f.FailureRouteStop1})}else{k.add({message:f.FailureRouteStop})}console.log("Route stop failed : "+x.internalError)};a.authenticatedRequest(t,v)},_save:function(x,s,w){var v,u={};u=p.extend(u,e.getSyncOptions(),true);u.method="PUT";u.data=x;var t=this.collection.url()+"/"+this.id;var y=u;u.onComplete=function(A){A=JSON.parse(A);var z={title:s.name,subtitle:s.routeBasePurpose,description:s.description,modified:A.data[0].dataelements.modified};w.set(z,y);g.add({message:f.replace(f.successEditRoute,{tag1:s.name})})};u.onFailure=function(B,A,z){A=JSON.parse(A);if(A.internalError!=undefined&&A.internalError.indexOf("No changename access")!=-1){k.add({message:f.errorChangeNameAccess})}else{k.add({message:f.FailureEditRoute})}};a.authenticatedRequest(t,u)},save:function(v,x,u){var t,u={};u=p.extend(u,e.getSyncOptions(),true);u.method="PUT";u.data=v;var s=this.collection.url()+"/"+this.id;a.authenticatedRequest(s,u);if(p.is(v)&&(p.typeOf(v))==="object"){t=v;u=x;u.method="PUT";u.type="json";u.headers={"Content-Type":"application/ds-json",}}else{t=this._attributes;u=x;u.method="POST";u.type="json";u.headers={"Content-Type":"application/ds-json",}}var w=[];var y=[{name:"name"},{description:"description"},{routeBasePurpose:"attribute[Route Base Purpose]"},{routeCompletionAction:"attribute[Route Completion Action]"},{routeAutoStopOnRejection:"attribute[Auto Stop On Rejection]"}];y.forEach(function(z){for(var A in z){w.push({op:"replace",path:z[A],value:t[A]})}});if(!p.is(u.data)){u.data=JSON.stringify(w)}else{u.data=JSON.stringify(u.data)}return this._parent.call(this,t,u)},_saveWithThumbnail:function(u,t){if(!t||!t.hasOwnProperty("file")){throw new Error("You must specify a file options when you save a new thumbnail property")}t=p.clone(t||{},false);var w=this,v=t.file,s=v.name,x=t.onComplete;t.onComplete=function(y,A,z){p.extend(z,A);z.onComplete=function(B,D,C){C.onComplete=function(E,G,F){E.dispatchEvent("onThumbnailLoad");if(x){return x(E,G,F)}};l.prototype.save.call(w,u,p.merge({url:i(B,"url")+"?receipt="+encodeURIComponent(D.receipt)},C))};y.checkInThumbnailFile(z)};return this.getTicket(p.extend({model:this},t))},getTicket:function(u){var w=this,t=i(this,"url")+"/ticket?id="+Date.now(),v,s,x;u=u?p.clone(u,false):{};s=u.model;if(s){s.dispatchEvent("onBeforeGetTicket")}x=u.onComplete;u.onComplete=function(y){if(s){s.dispatchEvent("onGetTicket")}if(x){return x(w,w.parseTicket(y),u)}};v=a.authenticatedRequest(t,p.extend(p.extend({type:"json"},e.getSyncOptions()),u,true));return v},parseTicket:function(s){return{urlFCS:s.actionurl,ticket:{name:s.jobticket,value:s.ticket}}},getNominalContext:function(){var u=this.get("contexts"),t,s;for(t=0;t<u.length;t++){s=u[t];if(s.role!=="VPLMProjectAdministrator"){break}}return s.name},checkInThumbnailFile:function(u){u=u?p.clone(u,false):{};if(!u.urlFCS){throw new Error('A "url" must be specified')}var x=this,t=u.urlFCS,z=u.onComplete,y,s,w;u.onComplete=function(A){x.dispatchEvent("onCheckInThumbnailFile");if(z){return z(x,x.parseThumbnailFileReceipt(A),u)}};y=new FormData();s=this.getThumbnailFileForm(u);for(var v in s){y.append(v,s[v])}this.dispatchEvent("onBeforeCheckInThumbnailFile",[y]);w=new XMLHttpRequest();w.open("POST",t);w.onreadystatechange=function(){if(w.readyState===4){if(w.status===200){u.onComplete(w.responseText)}else{if(u.onFailure){u.onFailure(w.responseText)}}}};w.send(y);return w},parseThumbnailFileReceipt:function(t){var s=p.createElement("div").setHTML(t).getElement('[name="__fcs__jobReceipt"]').value;return{receipt:s}},getThumbnailFileForm:function(t){t=t?p.clone(t,false):{};var s={};if(t.ticket&&t.ticket.name){s[t.ticket.name]=t.ticket.value}p.extend(s,{__fcs__jobTicket:t.ticket.value,"file-name":t&&t.file.name,file_0:t&&t.file,"file-title":t&&t.file.name,"file-description":t&&t.file.name});return s},getPreview:function(t){if(!t){t={}}var v=this,u,s=i(this,"url")+"/preview",w=t.onComplete;t.onComplete=function(x){v.set("thumbnail",x.thumbnail);if(w){return w(v,x,t)}};a.authenticatedRequest(s,p.extend({type:"json"},p.extend(t,e.getSyncOptions(),true)));return u},"onChange:name":function(){this.getPreview()}});return n});define("DS/ENORouteMgmt/Views/Creates/CreateRouteViewPopup",["UWA/Core","UWA/Element","DS/UIKIT/Form","DS/WAFData/WAFData","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Alert","UWA/Class/View","DS/ENORouteMgmt/EnoviaBootstrap","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/ENORouteMgmt/Views/RouteSelectedContent","DS/ENORouteMgmt/Views/Inputs/SearchRouteTemplate","DS/ENORouteMgmt/Views/Inputs/SelectPreserveTaskOwner","DS/ENORouteMgmt/Commands/InitialRoute_Widget","DS/ENORouteMgmt/Views/Inputs/SearchSelectScope","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(q,d,f,a,k,m,t,g,s,b,u,l,r,n,p,o,c){var j,i=true;var h=new g({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),e=new g({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});var v=s.extend({name:"createCS",tagName:"div",className:"create-cs-view",init:function(w){j=widget.body;var x=UWA.clone(w,false);["container","template","tagName","domEvents"].forEach(function(y){delete x[y]});this._parent(x)},setup:function(){this.container.addClassName(this.getClassNames("-container"));this._initAlert();this._initForm();this._initListenKeyDown()},_initAlert:function(){var w={className:"create-alert",closable:true,renderTo:document.body,autoHide:true,visible:true};this.elements.alertFailure=new g(q.extend({messageClassName:"error"},w))},_initForm:function(){var H=this,J=this.options,A=this.collection,w=this.elements,E=w.alertFailure,y,z,x,G,I;var F=new r({});var B=new o({});var D=new n({});var C=new l(J);y=function(L,K){if(L){K.addClassName("has-error");E.add({message:L})}else{w.create.setDisabled(false);K.removeClassName("has-error")}};z=[{type:"text",name:"name",required:true,disabled:true,label:c.name,maxlength:"128",placeholder:c.placeholderTitle,pattern:"^((?!#)(?!,)(?!\\[)(?!\\$)(?!\\])(?!\\^)(?!@)(?!%)(?!:)(?!')(?!\")(?!\\\\)(?!\\.)(?!/)(?!\\*)(?!\\?)(?!<)(?!>).)*$",events:{onChange:function(){var L=this.getValue().trim();if(L!==""){var K=this.elements.input.parentNode;if(K){K.removeClassName("has-error")}}}}},{type:"checkbox",value:"true",label:c.autoname,name:"autoname",dataHolder:this,events:{onChange:function(){this.options.dataHolder.elements.form.getInput("name").setDisabled(this.isChecked());this.options.dataHolder.elements.form.setValue("name","")}}},{type:"html",html:F},{type:"html",html:C},{type:"textarea",name:"description",rows:3,label:c.description,required:true,placeholder:c.placeholderDescription,events:{onChange:function(){var L=this.getValue().trim();if(L!==""){var K=this.elements.input.parentNode;if(K){K.removeClassName("has-error")}}}}},{type:"select",name:"routeBasePurpose",label:c.routeBasePurpose,nativeSelect:false,required:true,placeholder:false,options:[{value:"Standard",label:c.Standard,selected:true},{value:"Approval",label:c.Approval},{value:"Review",label:c.Review}]},{type:"select",name:"routeCompletionAction",label:c.routeCompletionAction,nativeSelect:false,required:true,placeholder:false,options:[{value:"Notify Route Owner",label:c.notifyRouteOwner},{value:"Promote Connected Object",label:c.promoteConnectedObject,selected:true}]},{type:"select",name:"routeAutoStopOnRejection",label:c.routeAutoStopOnRejection,nativeSelect:false,required:true,placeholder:false,options:[{value:"Immediate",label:c.immediate,selected:true},{value:"Deferred",label:c.deferred}]},{type:"html",name:"selectScope",html:B},{type:"html",name:"selectPreserveTaskOwner",html:D}];if(H.collection!=null){z[8]={type:"text",name:"selectScope",label:c.routeScope,disabled:true,value:H.collection._options.label,placeholder:c.selectScope,}}x=new f({fields:z,events:{onSubmit:function(){H.onCreate()},onInvalid:function(K){},onValid:function(){}}});H._form=x;G=new k({value:c.create,className:"primary",events:{onClick:this.dispatchAsEventListener("onCreate")}});I=new k({value:c.cancel,events:{onClick:this.dispatchAsEventListener("onCancel")}});w.form=x;w.create=G;w.cancel=I},getCreateButton:function(){return this.elements.create},getCancelButton:function(){return this.elements.cancel},getFormFirstInput:function(){return this.elements.form.elements.container[0]},_initListenKeyDown:function(){this.onKeyDown=this.onKeyDown.bind(this);document.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(A){if(A.keyCode===13){if(this.submitEnabled()){}}else{if(A.keyCode===27){var w=document.createEvent("Event");w.initEvent("click",true,false);this.elements.cancel.elements.content.dispatchEvent(w)}}if(A.page=="searchRouteTemplate"){var x=this._form.getInput("description");x.setValue(this.elements.form.options.fields[2].html.mTextElement.description);var z=this._form.getInput("routeBasePurpose");z.setValue(this.elements.form.options.fields[2].html.mTextElement.routeBasePurpose);var y=this._form.getInput("routeAutoStopOnRejection");y.setValue(this.elements.form.options.fields[2].html.mTextElement.routeAutoStopOnRejection);if(this.elements.form.options.fields[7].html!=undefined&&this.elements.form.options.fields[2].html.mTextElement.scope=="Organization"){this.elements.form.options.fields[7].html.mCheckElementOrg.getChildren()[0].getChildren()[0].checked=true;this.elements.form.options.fields[7].html.options.scope="Organization"}}},submitEnabled:function(){var w=this.elements.create.elements.content.getAttribute("disabled");return w===null?true:false},render:function(){var z=this.elements,y=z.form,w=z.create,x=z.cancel;this.container.setContent([y,{tag:"div","class":"footer",}]);return this},onCreate:function(){var D=this,H=this.options,G=this.collection,z=H.onComplete,x=H.onFailure,y="",C={};var B=this.options.selectedNodes;for(var A=0;A<B.length;A++){y+=B[A].objectId;if(A===(B.length-1)){break}y+="~"}var E=new RegExp("\\s$","i");var w=this.elements.form.getValue("name");while(E.test(w)){w=w.substring(0,w.length-1)}this.elements.form.setValue("description",this.elements.form.getValue("description").trim());this.elements.form.setValue("name",this.elements.form.getValue("name").trim());if((!this.elements.form.validate())){if(w.length==0&&this.elements.form.getValue("autoname")==="false"){h.add({message:c.errorEmptyTitle})}else{if(this.elements.form.getValue("description").length===0){h.add({message:c.errorEmptyDescription})}else{var F=" \\ \" # $ @ % * , ? < > [ ] | : . ^ '";h.add({message:c.replace(c.errorCharacterTitle,{tag1:F})})}}return}require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(I){I.getServiceUrl({serviceName:"3DSpace",platformId:widget.getValue("x3dPlatformId"),onComplete:function(J){a.authenticatedRequest(J+"/resources/v1/application/E6WFoundation/CSRF",q.extend(H,{method:"GET",onComplete:function(M){console.log(M);console.log(J);J=J+"/resources/v1/modeler/routes";if(widget.getPreference("pad_security_ctx")){J=J+"?SecurityContext="+widget.getPreference("pad_security_ctx").value}var K={name:D.elements.form.getValue("name"),description:D.elements.form.getValue("description"),routeBasePurpose:D.elements.form.getValue("routeBasePurpose"),routeCompletionAction:D.elements.form.getValue("routeCompletionAction"),AutoStopOnRejection:D.elements.form.getValue("routeAutoStopOnRejection"),startRouteAutomatically:D.elements.form.getValue("startRouteAutomatically"),preserveTaskOwner:D.elements.form.getValue("preserveTaskOwner"),templateId:D.elements.form.options.fields[2].html.mTextElement.id,attrScope:(D.collection==null)?D.elements.form.options.fields[8].html.options.scope:D.collection._options.id,contentIds:y};if(K.attrScope===""){h.add({message:c.ScopeSelectMessage});return}var N=new u().createDataForRequest(K,JSON.parse(M).csrf);var L={};L=q.extend(L,b.getSyncOptions(),true);L.method="POST";L.type="json";L.headers={"Content-Type":"application/ds-json",};L.data=JSON.stringify(N);L.onComplete=function(Q,P,O){if(q.is(z,"function")){z(Q.data[0],P,O)}};L.onFailure=function(P,Q,O){if(Q.internalError!=undefined&&Q.internalError.indexOf("'type name revision' not unique")!=-1){h.add({message:c.replace(c.errorCreateRouteNotUnique,{tag1:K.name})})}else{if(Q.error!=undefined&&Q.error.indexOf("No create Access For Role")!=-1){h.add({message:c.errorCreateRouteForRole})}else{h.add({message:c.replace(c.errorCreateRoute,{tag1:K.name})});console.log("Route Creation failed :"+Q.internalError)}}};a.authenticatedRequest(J,L)}},true))},})})}});return v});define("DS/ENORouteMgmt/Views/Inputs/SearchTaskAssignee",["UWA/Core","UWA/Event","DS/UIKIT/Form","UWA/Element","UWA/Utils","DS/UIKIT/Badge","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/WAFData/WAFData","UWA/Class/View","DS/ENORouteMgmt/Views/Inputs/SearchTaskAssigneeData","DS/ENORouteMgmt/EnoviaBootstrap","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/ENORouteMgmt/Utilities/Utils","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/W3DXComponents/W3DXComponents","css!DS/ENORouteMgmt/ENORouteMgmt"],function(p,b,i,o,g,j,n,k,a,q,d,e,r,c,f){var l=new k({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),h=new k({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});var m=q.extend({name:"createTask",tagName:"div",className:"create-cs-view",init:function(s){this.collectionInfo=s.collection;var t=UWA.clone(s,false);["container","template","tagName","domEvents"].forEach(function(u){delete t[u]});this._parent(t)},setup:function(){this.container.addClassName(this.getClassNames("-container"));this._initAlert();this._initForm();this._initListenKeyDown()},_initAlert:function(){var s={className:"create-alert",closable:true,renderTo:document.body,autoHide:true,visible:true};this.elements.alertFailure=new k(p.extend({messageClassName:"error"},s))},_initForm:function(){var z=this,D=this.options,B=this.collection,A=true,s=this.elements,w=s.alertFailure,v,t,u,y,C;D.collectionInfo=this.collectionInfo;var x=new d({options:D});v=[{type:"html",name:"taskassignee",html:x}];if(D.taskModel.get("type")=="Inbox Task"){t={type:"textarea",name:"reassigncomments",rows:3,label:f.assigneecomments,placeholder:f.enterAssigneeComments,maxlength:"128",};v.push(t)}u=new i({fields:v,events:{onSubmit:function(){z.onCreate()},onInvalid:function(E){},onValid:function(){}}});y=new n({value:f.done,className:"primary",events:{onClick:this.dispatchAsEventListener("onCreate")}});C=new n({value:f.cancel,events:{onClick:this.dispatchAsEventListener("onCancel")}});s.form=u;s.create=y;s.cancel=C},getCreateButton:function(){return this.elements.create},getCancelButton:function(){return this.elements.cancel},getFormFirstInput:function(){return this.elements.form.elements.container[0]},_initListenKeyDown:function(){this.onKeyDown=this.onKeyDown.bind(this);document.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(t){if(t.keyCode===13){if(this.submitEnabled()){this.onCreate()}}else{if(t.keyCode===27){var s=document.createEvent("Event");s.initEvent("click",true,false);this.elements.cancel.elements.content.dispatchEvent(s)}}},submitEnabled:function(){var s=this.elements.create.elements.content.getAttribute("disabled");return s===null?true:false},render:function(){var v=this.elements,u=v.form,s=v.create,t=v.cancel;this.container.setContent([u,{tag:"div","class":"footer",}]);return this},onCreate:function(){var z=this,F=this.options,v=this.options.taskModel,x=this.options.taskModel.newAssignee,E=this.collection,B=E._modelKey.id,C=this.options.taskModel.id,t=this.elements.form.getValue("reassigncomments"),u;u=v.get("assigneePID");var s=e.get3DSpaceURL();if(u==x){l.add({message:f.taskNewAssignee});return}var s=e.getRouteServiceBaseURL()+"/"+B+"/tasks/"+C;var A=v.get("relId");var y={};if(v.get("type")=="Inbox Task"){y={reAssignComments:t,routeId:B,taskId:C,newAssigneeId:x,type:v.get("type"),isChangeAssignee:"true"}}else{y={routeId:B,taskId:C,newAssigneeId:x,type:v.get("type"),isChangeAssignee:"true"}}var D=new r().createDataForRequest(y);var F={};F=p.extend(F,e.getSyncOptions(),true);F.method="PUT";F.type="json";F.headers={"Content-Type":"application/ds-json",};F.data=JSON.stringify(D);F.onComplete=function(J){var H=z.collection._modelKey._facetObjs;var I=["tasks","access","taskgraph"];c.reloadFacetObjects(H,I);var G=document.createEvent("Event");G.initEvent("click",true,false);z.elements.cancel.elements.content.dispatchEvent(G)};var w=a.authenticatedRequest(s,F);delete this.options.taskModel.newAssignee;return w}});return m});define("DS/ENORouteMgmt/Views/Properties/RoutePropertiesView",["UWA/Core","DS/WAFData/WAFData","UWA/Class/Model","DS/ENORouteMgmt/EnoviaBootstrap","DS/UIKIT/Alert","DS/W3DXComponents/Views/Temp/TempItemView","DS/W3DXComponents/Views/Layout/ScrollView","DS/W3DXComponents/IdCard","DS/ENORouteMgmt/Views/ModelForm","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/ENORouteMgmt/Views/Inputs/SelectPreserveTaskOwner","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(o,a,l,c,b,f,r,p,e,q,k,d){var h;var n="route-properties",i={className:"vertical",fields:function(){this._routeStatus=d[this.get("routeStatus")];var t=this.get("attrScope")[0];this._scope=t==="All"||t==="Organization"?d[t]:t;this._preserveTaskOwner=this.get("preserveTaskOwner")==="True"?d.PreserveTaskOwnerSelect1:d.PreserveTaskOwnerSelect2;this._selectPreserveTaskOwner=new k({});h=new b({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"});var s=[{type:"text",name:"name",attributes:{"data-attr":"return this.get('name')","data-editable":"return true"},label:d.name,required:true,maxlength:128,events:{onChange:function(){var w=this.elements.input;var v=w.parentNode;var u=w.value.trim();if(u.length<=0){if(v){v.addClassName("has-error")}w.focus();h.add({message:d.errorEmptyTitle})}else{if(v&&v.hasClassName("has-error")){v.removeClassName("has-error")}}}}},{type:"textarea",name:"description",attributes:{"data-attr":"return this.get('description')","data-editable":"return true"},rows:5,label:d.description,required:true,events:{onChange:function(){var w=this.elements.input;var v=w.parentNode;var u=w.value.trim();if(u.length<=0){if(v){v.addClassName("has-error")}w.focus();h.add({message:d.errorEmptyDescription})}else{if(v&&v.hasClassName("has-error")){v.removeClassName("has-error")}}}}},{type:"text",name:"routeStatus",attributes:{"data-attr":"return this._routeStatus","data-editable":false},label:d.maturity},{type:"text",name:"owner",attributes:{"data-attr":"return this.get('ownerFullName')","data-editable":false},label:d.ownerRole},{type:"date",name:"modified",attributes:{"data-attr":"return this.get('modified')","data-editable":false},label:d.routeOriginated},{type:"text",name:"template",attributes:{"data-attr":"return this.get('sConnectedRTName') || ''","data-editable":false},label:d.routeTemplate},{type:"select",name:"routeBasePurpose",attributes:{"data-attr":"return this.get('routeBasePurpose')","data-editable":true},label:d.routeBasePurpose,required:true,options:[{value:"Standard",label:d.Standard,},{value:"Review",label:d.Review,},{value:"Approval",label:d.Approval,}]}];s.push({type:"select",name:"routeCompletionAction",attributes:{"data-attr":"return this.get('routeCompletionAction')","data-editable":"return true"},label:d.routeCompletionAction,required:true,options:[{value:"Notify Route Owner",label:d.notifyRouteOwner,},{value:"Promote Connected Object",label:d.promoteConnectedObject}]});s.push({type:"select",name:"AutoStopOnRejection",required:true,attributes:{},label:d.routeAutoStopOnRejection,options:[{value:"Immediate",label:d.immediate,},{value:"Deferred",label:d.deferred,selected:true}]});s.push({type:"text",name:"scope",attributes:{"data-attr":"return this._scope","data-editable":false},label:d.routeScope});s.push({type:"hidden",name:"attScopeId",attributes:{"data-attr":"return this.get('attScopeId')","data-editable":false},});if(this.get("preserveTaskOwner")==="True"){this._selectPreserveTaskOwner.mCheckElementReset.getChildren()[0].getChildren()[0].checked=true}s.push({type:"html",name:"selectPreserveTaskOwner",html:this._selectPreserveTaskOwner});s.push({type:"text",name:"preserveTaskOwnerText",attributes:{"data-attr":"return this._preserveTaskOwner","data-editable":false},label:d.PreserveTaskOwnerLabel});if(this.get("isSubRoute")===true){s.push({type:"text",name:"subRouteVisibility",attributes:{"data-attr":"return this.get('attrSubRouteVisibility')","data-editable":false},label:d.subRouteVisibility,})}return s},buttons:[{type:"submit",value:d.save},{type:"reset",value:d.cancel}]};function j(y,t,v){if(y==null){return false}var s,x=y.length!==+y.length&&Object.keys(y),w=(x||y).length,u,z;for(u=0;u<w;u++){z=x?x[u]:u;if(t.call(v,y[z],z,y)){return true}}}function m(v,t,u){var s;j(v,function(y,w,x){if(t.call(u,y,w,x)){s=y;return true}});return s}var g=f.extend({name:n,tagName:"div",template:"",domEvents:{},defaultOptions:{idCard:null},reader:null,init:function(s){var t=this;["container","template","tagName","domEvents"].forEach(function(u){delete s[u]});this._parent.call(this,s)},setup:function(s){var t;this.container.addClassName(this.getClassNames("-container"));this._initForm();this._initFileReader(s);t=this._collabSpaceEvents={"onChange:visibility":this._onChangeVisibility};this.alert=new b({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"});this.listenTo(this.model,t)},_initForm:function(){var t,s=o.clone(i);t=this._form=new e(o.extend({model:this.model,events:{onSubmit:this._onFormSubmit.bind(this),onReset:this._onFormReset.bind(this)}},s));t.render=function(){};t.container=t.elements.container;return t},_initFileReader:function(t){var u=this,s=new FileReader();this.reader=s;s.onload=function(v){u._idCard&&(u._idCard.getElement(".thumbnail").setStyle("background-image","url("+s.result+")"))}},setOptions:function(t){var s=t.idCard;if(s){this._setIdCard(s);delete t.idCard}return this._parent.apply(this,arguments)},_setIdCard:function(s){if(!(s instanceof p)){throw new Error("You try to set idCard option with no instance of idCard")}if(this._idCard){return}this._idCard=s;this.listenTo(s,{onSwitchToEditMode:this.dispatchAsEventListener("onEdit"),});if(s._mode===1){this.dispatchEvent("onEdit")}},_resetIdCard:function(){this._idCard._refreshSection("thumbnail");return this._switchIdCardToViewMode()},_switchIdCardToViewMode:function(){var s=this._idCard;if(s){s.switchToViewMode()}return s},reset:function(){var s=this._form;this._resetIdCard();s.reset();return this},_onChangeVisibility:function(u,s,t){},_onChangeThumbnail:function(s){},_onTitleChange:function(t,s){this.newtitle=t},_onFormSubmit:function(z){var u=this,w=this.model,v=this.alert,A={onFailure:function(C,D,B){u.reset();v.add({message:d.errorEdit})},type:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"},wait:true};var x=!(typeof this.newtitle=="undefined")&&this.newtitle!=null;if(x){z.title=this.newtitle}else{z.title=w.get("title")}z.visibility&&(z.visibility={value:z.visibility});if(!o.is(z.owner)){delete z.owner}else{z.owner={login:z.owner}}if(this.thumbnailFile){z.thumbnail=this.thumbnailFile.name;A.file=this.thumbnailFile}if(this._validateInputs(z)){var s=JSON.stringify(new q().createDataForRequest(z));w._save(s,z,this.model);for(var y in z){if(this.model._attributes.hasOwnProperty(y)&&y!=="routeStatus"){this.model._attributes[y]=z[y]}if(y==="preserveTaskOwner"){this.model._attributes[y]=z[y];this._form.container.getChildren()[10].hide();var t=this._form.container.getChildren()[11];t.show();t.getChildren()[1].value=z[y]==="True"?d.PreserveTaskOwnerSelect1:d.PreserveTaskOwnerSelect2}}this._switchIdCardToViewMode();this.dispatchEvent("onEndEdit")}else{this.dispatchEvent("onEdit")}},_onFormReset:function(){this._form.container.getChildren()[10].hide();this._form.container.getChildren()[11].show();this._resetIdCard();this.dispatchEvent("onEndEdit")},_validateInputs:function(s){var t=new RegExp("[\\\\\"#$@%*,?<>[\\]|/:.']","i");if(t.test(s.name)){this._form.getField("name").addClassName("has-error");h.add({message:d.replace(d.errorCharacterTitle,{tag1:" \\ \" # $ @ % * , ? < > [ ] | : . '"})});return false}else{if(!s.name||s.name.length===0){this._form.getField("name").addClassName("has-error");h.add({message:d.errorEmptyTitle})}else{if(s.description.length===0){this._form.getField("description").addClassName("has-error");h.add({message:d.errorEmptyDescription})}else{return true}}}},onRender:function(){var u,t=this._form,s=this;u=new r({view:t,useInfiniteScroll:false,usePullToRefresh:false});u.render().inject(this.container)},onFacetSelect:function(t){var s;s=t.getIdCardAt(1);this.setOptions({idCard:s});this._form.container.getChildren()[10].hide()},onEdit:function(){this._form.container.getChildren()[10].show();this._form.container.getChildren()[11].hide();this._form.dispatchEvent("onEdit")},onEndEdit:function(){delete this.thumbnailFile;delete this.newtitle},onDestroy:function(){if(this._idCard){this.stopListening(this._idCard);delete this._idCard}if(this._form){this._form.destroy();delete this._form}this.alert.destroy()}});return g});define("DS/ENORouteMgmt/Views/Modals/ModalCreateRoutePopup",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/ENORouteMgmt/Views/Creates/CreateRouteViewPopup","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(b,f,a,c,d){var e=f.extend({init:function(g){var k=this,i,l,j,n,h,m;g=b.clone(g||{},false);this._parent(g);i=b.clone(g.events||{},false);l=g.onComplete;j=g.onFailure;n=i.onCancel;m=function(){document.removeEventListener("keydown",h.onKeyDown);h.destroy();k.destroy();window.savemodelRef=null};i.onCancel=function(){m();if(b.is(n)){n.apply(this,arguments)}};g.events=i;g.onComplete=function(){m();if(b.is(l)){l.apply(undefined,arguments)}};g.onFailure=function(){m();if(b.is(j)){j.apply(undefined,arguments)}};g.modal=k;h=new c(g);this.elements.modal=new a({closable:true,header:d["title.createRoute"],form:h,body:h.render(),footer:[h.getCreateButton(),h.getCancelButton()]})},show:function(){var h=this.elements,g=h.modal;window.savemodelRef=g;g.inject(document.body);g.show();g.options.form.getFormFirstInput().focus()}});return e});define("DS/ENORouteMgmt/Commands/InitiateRoute_Popup",["UWA/Core","UWA/Class","DS/ApplicationFrame/Command","DS/Core/Core","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/UIKIT/Alert","DS/WAFData/WAFData","DS/PADUtils/PADSettingsMgt","DS/ENORouteMgmt/EnoviaBootstrap","DS/ENORouteMgmt/Views/Modals/ModalCreateRoutePopup","DS/ENORouteMgmt/commands/CommandAvailableOnSelect","DS/UIKIT/Form","DS/ENORouteMgmt/Commands/InitialRoute_Widget","DS/WidgetServices/WidgetServices","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(h,u,n,e,b,r,d,a,k,f,v,j,l,s,p,g){var o,c,q,m=new d({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),i=new d({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});var t=u.extend(n,j,{init:function(w){this._parent(w,{mode:"exclusive",isAsynchronous:true})},beginExecute:function(){this._frmWindow=this.getFrameWindow()},resumeExecute:function(){},launchCreateRouteModal:function(y){o=widget.body;q=y.getSelectedNodes();var C=[];if(q.length){q.forEach(function(E){var H=E&&typeof E.getInstID==="function"?E.getInstID():null;if(H!=null&&Array.isArray(H)){H=H.length>0?H[0]:null}var F=H?"relationship":"businessobject";H=H?H:E.getID();H=H?H:E.id;var L=E.metatype?E.metatype:F;var D=E.source?E.source:null;var J=E.getLabel()?E.getLabel():null;var K=E.tenant?E.tenant:null;var I=E.type?E.type:null;if(H){var G={label:J,metatype:L,objectId:H};var K=K?K:p.getTenantID();if(K){G.tenant=K}if(D){G.source=D}if(I){G.type=I}C.push(G)}})}var B=this.collection;var x={selectedNodes:C,onComplete:function(E,H,D){var G={};G.routeId=E.id;G.routeName=E.dataelements.name;var F=new s();F.execute(G);i.add({message:g.replace(g.successCreate,{tag1:G.routeName})})},onFailure:function(E,F,D){E=JSON.parse(E);if(F.error!=undefined&&F.error.indexOf("No create Access For Role")!=-1){m.add({message:g.errorCreateRouteForRole})}else{m.add({message:g.replace(g.errorCreateRoute,{tag1:E.name})})}}};var A=(q&&q[0])?q[0]:{};if(undefined!==A.getType&&"Content"===A.getType()){require(["DS/FolderEditor/Folder_CSO"],function(D){var F=D.getCurrentFolder();var E=new v(h.extend({collection:F},x));E.show()})}else{var w=new v(h.extend({collection:null},x));w.show()}var z=this;this.onResume(function(){});this.onPause(function(){})},execute:function(w){var x=this;require(["DS/PADUtils/PADContext"],function(C){var B=C.get();if(null==B){B=x.options.context}var D=B.getSelectedNodes();var A=(D&&D[0])?D[0]:{};var y;if(A.getType){y=A.getType()}else{if(A.options){y=A.options.type}else{if(A.object){y=A.object.type}}}if(y==="Folder"||y==="RootFolder"){var z=new r({renderTo:document.body});z.alert(g.invalidSelection,function(){})}else{x.launchCreateRouteModal(B)}})},endExecute:function(){}});return t});define("DS/ENORouteMgmt/Collections/ContentsCollection",["UWA/Core","DS/WAFData/WAFData","UWA/Class/Model","DS/WebAppsFoundations/Collections/PageableCollection","DS/ENORouteMgmt/EnoviaBootstrap","DS/ENORouteMgmt/Models/ContentModel","DS/ENORouteMgmt/Models/RouteModel","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/TagNavigatorProxy/TagNavigatorProxy"],function(g,e,l,d,b,a,i,c,f){var h="contents";function k(m,o){var n;if(m){n=m[o];if(g.is(n,"function")){n=n.call(m)}}return n}var j=d.extend({defaultOptions:{mode:"data",state:{firstPage:0,currentPage:0,pageSize:25},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"contentTotal",withroots:"true",to:"true",selectbo:"name",recurselevel:"1",relpattern:"Object Route"},taggerProxy:{filteringMode:"WithFilteringServices",events:{}}},name:h,model:a,filterTagObj:null,isNewFilter:false,url:function(){return"/contents"},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"contentTotal",withroots:"true",to:"true",selectbo:"name",recurselevel:"1"},_initTaggerProxy:function(){var o=this,m,n,p;m=this.getOption("taggerProxy");p=this._taggerProxyEvents={onFilterChange:o.onFilterChange,addUnfocusSubjectsListener:o.onUnfocusSubjects};if(widget&&b.getStorage()){m=g.extend({widgetId:widget.id,tenant:b.getStorage().id},m,true)}else{m=g.extend({contextId:"context1"},m,true)}n=this.taggerProxy=f.createProxy(m);this.listenTo(n,p);return n},parseResponseForStateUpdate:function(p,n,o,m){return{totalRecords:p.data.length}},parseRecords:function(n,m){n.result=new c().parseResp(n);return n.result},sync:function(p,o,n){var m="?";g.extend(n,b.getSyncOptions(),true);this._parent.apply(this,arguments)},fetch:function(p){var r=this,n=this.taggerProxy,o,s,m,q;p=p?g.clone(p,false):{};if(n){s=p.onComplete;o=this.filterTagObj;if(o){m={tags:JSON.stringify(o)};p.data=(p.data?g.extend(m,p.data):m)}p.onComplete=function(u,v,t){if(v.result.length<=0){if(g.is(s,"function")){s(this,v,t)}}u.isNewFilter=false;if(g.is(s,"function")){s(this,v,t)}}}if(this.currentSearchUrl){p.url=this.currentSearchUrl}return this._parent.call(this,p)},parseTags:function(m){return{tagValues:m.tagValues,subjectsTags:m.subjectsTags}},setup:function(o,m){var n=m._modelKey;if(n&&n instanceof l){this._modelKey=n;if(m.url===undefined){this.url=k(n,"url")+Object.getPrototypeOf(this).url.call(this)}}this._initTaggerProxy();if(widget){this.listenTo(widget,{onSearch:this.onSearch,onResetSearch:this.onResetSearch})}},getPreviews:function(m){},parsePreviews:function(m){return m},focusTaggerProxyOnSubject:function(n){if(!this.taggerProxy){return}var m=this.get(n);if(m){m.focusTaggerProxyOnSubject()}},unfocusTaggerProxy:function(){var m=this.taggerProxy;if(!this.taggerProxy){return}m.unfocus()},activateTaggerProxy:function(){var m=this.taggerProxy;if(!this.taggerProxy){return}m.activate()},deactivateTaggerProxy:function(){var m=this.taggerProxy;if(!this.taggerProxy){return}m.deactivate()},onReset:function(){},onFilterChange:function(m){this.filterTagObj=m;this.isNewFilter=true;this.taggerProxy.setTags({},[]);this.dispatchEvent("onTaggerProxyFilterChange")},onUnfocusSubjects:function(){this.dispatchEvent("onTaggerProxyUnfocusSubjects")},onSearch:function(o){if(o){var m=(g.is(this.url,"function"))?this.url():this.url;var n=m+"?q="+o;if(n!=this.currentSearchUrl){this.currentSearchUrl=n;this.dispatchEvent("onSearch")}}},onResetSearch:function(){this.currentSearchUrl=null;this.dispatchEvent("onResetSearch")},destroy:function(){var m=this.taggerProxy;if(m){this.stopListening(m,this._taggerProxyEvents);m.die();delete this.taggerProxy}this.stopListening(widget);return this._parent.apply(this,arguments)}});window.ContentsCollection=j;return j});define("DS/ENORouteMgmt/Views/Modals/ModalChangeAssigneeTask",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/ENORouteMgmt/Views/Inputs/SearchTaskAssignee","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(c,f,a,b,e){var d=f.extend({init:function(g){var k=this,i,l,j,n,h,m;g=c.clone(g||{},false);this._parent(g);i=c.clone(g.events||{},false);l=g.onComplete;j=g.onFailure;n=i.onCancel;m=function(){document.removeEventListener("keydown",h.onKeyDown);h.destroy();k.destroy();window.savemodelRef=null};i.onCancel=function(){m();if(c.is(n)){n.apply(this,arguments)}};g.events=i;g.onComplete=function(){m();if(c.is(l)){l.apply(undefined,arguments)}};g.onFailure=function(){m();if(c.is(j)){j.apply(undefined,arguments)}};g.categories=[{id:"member",name:e.member,isMemberField:true},{id:"assigneecomments",name:e.assigneecomments}];g.getSuggestions=function(q,o,p){};g.saveProcess=function(o){};g.onCancelCalled=function(o){console.log(o);window.savemodelRef=null};h=new b(g);this.elements.modal=new a({closable:true,header:e.changeAssignee,form:h,body:h.render(),footer:[h.getCreateButton(),h.getCancelButton()]})},show:function(){var h=this.elements,g=h.modal;window.savemodelRef=g;g.inject(document.body);g.show();g.options.form.show()}});return d});define("DS/ENORouteMgmt/Views/Modals/ModalCreateRoute",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/ENORouteMgmt/Views/Creates/CreateRouteView","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(b,f,a,d,e){var c=f.extend({init:function(g){var k=this,i,l,j,n,h,m;g=b.clone(g||{},false);this._parent(g);i=b.clone(g.events||{},false);l=g.onComplete;j=g.onFailure;n=i.onCancel;m=function(){document.removeEventListener("keydown",h.onKeyDown);h.destroy();k.destroy();window.savemodelRef=null};i.onCancel=function(){m();if(b.is(n)){n.apply(this,arguments)}};g.events=i;g.onComplete=function(){m();if(b.is(l)){l.apply(undefined,arguments)}};g.onFailure=function(){m();if(b.is(j)){j.apply(undefined,arguments)}};h=new d(g);this.elements.modal=new a({closable:true,header:e.createRouteTitle,form:h,body:h.render(),footer:[h.getCreateButton(),h.getCancelButton()]})},show:function(){var h=this.elements,g=h.modal;window.savemodelRef=g;g.inject(document.body);g.show();g.options.form.getFormFirstInput().focus()}});return c});define("DS/ENORouteMgmt/SkeletonUtils/TaskSkeletonOptions",["UWA/Drivers/Alone","UWA/Core","DS/WAFData/WAFData","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Form","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/W3DXComponents/Views/Temp/TempItemView","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/EmptyView","DS/ENORouteMgmt/Models/ContentModel","DS/ENORouteMgmt/EnoviaBootstrap","DS/ENORouteMgmt/Views/Properties/TaskPropertiesView","DS/TopBarProxy/TopBarProxy","DS/WebappsUtils/WebappsUtils","DS/ENORouteMgmt/Utilities/Utils","DS/ENORouteMgmt/Views/Modals/ModalCreateTask","DS/ENORouteMgmt/Views/Modals/ModalChangeAssigneeTask","DS/ENORouteMgmt/Views/Modals/ModalRemoveTask","DS/ENORouteMgmt/Views/Modals/ModalNeedOwnerReview","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(d,J,s,o,a,u,e,G,h,P,O,H,N,C,l,M,L,b,r,m,x,j){var c=widget.getValue("role")+"."+widget.getValue("organization")+"."+widget.getValue("collaborative");var I,B=new o({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),q=new o({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"}),z,A;function v(R){}function K(R){}function i(S,R){}function D(T,Y,V,S){var R=V.model.get("id"),U=this.collection,Z=U._modelKey.id,W;switch(R){case"add.tasks":var X=this.collection,aa=new b(J.extend({collection:X},null));aa.show();break;default:console.log(R+" is not permitted in the action bar.");break}}function n(){var R=this,U=this.collection,T,V,S=I.getFetchOptions();T=S.onComplete;S.onComplete=function(Y,X,W){if(R.container.offsetParent){R.container.removeClassName("loading");Object.keys(R.contentsViews).map(function(Z){R.contentsViews[Z].scrollView.endLoading()})}if(T){T(R,X,W)}};if(U.state.totalRecords===null){U.getFirstPage(S)}else{if(U.hasNextPage()){U.getNextPage(J.extend(S,{remove:false,reset:false}))}else{R.container.removeClassName("loading");Object.keys(R.contentsViews).map(function(W){R.contentsViews[W].scrollView.useInfiniteScroll(false)})}}}function g(){var R=this;this.collection.getFirstPage(J.extend({onComplete:function(){R.scrollView.endLoading()}},I.getFetchOptions()))}function y(S,R){}function F(R){return{envId:N.getStorage().id,serviceId:"3DSpace",contextId:c,objectId:R.get("physicalid"),objectType:R.get("businessobj").type,displayName:R.get("businessobj").title,displayType:R.get("businessobj").type}}function p(R){}function Q(){}function w(){}function k(){}function E(){var R=this.collection;if(R){R.activateTaggerProxy();if(R.isNewFilter){R.fetch(I.getFetchOptions())}}}function t(){if(this.collection){this.collection.deactivateTaggerProxy()}}function f(){var R=this;if(this.collection){var T,S=I.getFetchOptions();T=S.onComplete;S.onComplete=function(W,V,U){if(R.container.offsetParent){R.container.removeClassName("loading")}if(T){T(R,V,U)}if(R.collection&&!R.collection.isEmpty()){W.dispatchEvent("onLoad")}else{W.dispatchEvent("onLoadEmpty")}};this.collection.fetch(S)}}I={getFetchOptions:function(R){return{type:"json",headers:{"Content-Type":"application/ds-json",},reset:true,objectSelectBO:["name","description","current","modified","title","type"],onFailure:function(){B.add({message:j.errorFetchContents})}}},getIdCardOptions:function(R){return{collapsed:R.minimizeIdCardView,editableElements:function(){return["instructions"]},thumbnailUrl:function(){return this.get("businessobj").thumbnail},attributesMapping:{title:function(){return this.get("businessobj").name},image:function(){return M.getWebappsAssetUrl("ENORouteMgmt","icons/48/I_RouteTask48.png")},ownerName:function(){if(this.get("businessobj").assigneeType=="Group Proxy"||this.get("businessobj").assigneeType=="Group"){return this.get("businessobj").assigneeTitle+"("+j.UserGroup+")"}else{return this.get("businessobj").taskAssignee}},date:function(){var S=new Date(this.get("businessobj").modified);return S.toGMTString().parseRelativeTime()},description:function(){return L.decodeHTMLEntites(this.get("instructions"))}},actions:function(){var V=[],U=true,S;var W=this.get("taskDetails");if(W!==undefined){for(var T=0;T<W.length;T++){if(W[T].indexOf("showEditTask")>-1){S=W[T].split("~")[1];U=(S==="true");break}}}return U?[{text:j.editProperties,icon:"pencil",handler:function(ab,aa){var Y;var X=ab._form.elements.container;var Z=X.getChildren()[5].getChildren()[0].getChildren()[1].getChildren();this.selectFacet("properties");this.switchToEditMode();if(this.model._attributes.assigneeSetDueDate==="Yes"){Z[0].disabled=true;Z[1].disabled=true}}}]:[]},facets:[{name:"properties",text:j.properties,icon:"doc-text",handler:P.getRendererHandler(C)}]}},getRouteGraphicalViewOptions:function(R){return{className:"loading",contents:{emptyView:O},events:{onFacetSelect:f,onFacetUnselect:function(){this.collection.dispatchEvent("onUnload")}}}},getContentSetOptions:function(R){return{className:"loading",actions:{filterer:function(T,S){return !!T.get("actionBar")&&T.id.indexOf(".tasks")!==-1},collection:function(){var T=this.collection,S=T._modelKey;return S&&S.actions}},contents:{selectionMode:"oneToOne",defaultView:"tile",headerOnEmpty:false,headers:[{property:"taskOrder",label:j.taskOrder},{property:"taskName",label:j.name},{property:"title",label:j.title},{property:"type",icon:"icon",label:j.type},{property:"owner",label:j.owner},{property:"maturity",sortable:true,label:j.maturity},{property:"comments",sortable:true,label:j.comments},{property:"action",sortable:true,label:j.taskAction},{property:"dueDate",sortable:true,label:j.dueDateAndTime,},{label:j.actions,actions:true}],sort:function(X,U,V){var W=V.split(/[\.\[\]]/).pop();W=(W==="created")?"originated":W;var S=(U==="ascending")?"a":"d";S=S+W;var T=J.extend(I.getFetchOptions(),{data:{sort:S}});X.getFirstPage(T)},itemViewOptions:{mapping:{title:function(){if(this.model.get("title1")){return this.model.get("title1")}else{if(this.model.get("title")){return this.model.get("title")}else{return this.model.get("name")}}},taskName:function(){return this.model.get("name")},owner:function(){console.log("--------");console.log(this.model.get("assigneeType"));console.log(this.model.get("assigneeTitle"));console.log(this.model.get("taskAssignee"));if(this.model.get("assigneeType")==="Group Proxy"||this.model.get("assigneeType")==="Group"){console.log("if true--");return this.model.get("assigneeTitle")}else{console.log("else true--");return this.model.get("taskAssignee")}},maturity:function(){return j[this.model.get("current")]},action:function(){return j[this.model.get("taskAction")]},tskaction:function(){return j[this.model.get("taskAction")]},dueDate:function(){if(this.model.get("taskDueDate")){var S=new Date(this.model.get("taskDueDate"));return L.formatDateString(S)}else{if(this.model.get("assigneeSetDueDate")){return j.assigneeSetDueDate}else{return""}}},order:function(){return this.model.get("taskOrder")},allowsDelegation:function(){return j[this.model.get("allowDelegation")]},requiresOwnerReview:function(){return j[this.model.get("needsOwnerReview")]},content:function(){var W="";var V="";var U="";switch(this.model.get("attrTaskStatus")){case"status-late":V="alert";U="fonticon-color-error";break;case"status-complete":V="check";U="fonticon-color-success";break;case"status-due":V="attention";U="fonticon-color-warning";break;default:V="";U=""}if(this.model.get("attrTaskStatus")){W=W+'<span class="fonticon fonticon-'+V+" "+U+'"></span>&nbsp;&nbsp;'}var S="",T="";if(this.model._attributes.needsOwnerReview===true){S='<span class="fonticon fonticon-user-ok fonticon-color-dark-grey"></span>'}if(this.model._attributes.allowDelegation===true){T='<span class="fonticon fonticon-forward fonticon-color-dark-grey"></span>'}var Y='<span class="badge-primary badge badge-small">&nbsp;'+this.model.get("taskOrder")+"&nbsp;</span>&nbsp;&nbsp;"+j[this.model.get("taskAction")]+"&nbsp;&nbsp;"+S+"&nbsp;&nbsp;"+T;W=W+Y;if(this.model.get("taskDueDate")){var X=new Date(this.model.get("taskDueDate"));W=W+"<br/>"+j.dueDateAndTime+" : "+L.formatDateString(X)}else{if(this.model.get("assigneeSetDueDate")){W=W+"<br/>"+j.assigneeSetDueDate}}return W},icon:function(){if(this.model.get("type")=="Route Node"){return M.getWebappsAssetUrl("ENORouteMgmt","icons/16/I_RouteNode16.png")}else{return M.getWebappsAssetUrl("ENORouteMgmt","icons/16/I_RouteTask16.png")}},image:function(){if(this.model.get("type")=="Route Node"){return M.getWebappsAssetUrl("ENORouteMgmt","icons/48/I_RouteNode48.png")}else{return M.getWebappsAssetUrl("ENORouteMgmt","icons/48/I_RouteTask48.png")}},subtitle:function(){if(this.model.get("assigneeType")==="Group Proxy"||this.model.get("assigneeType")==="Group"){console.log("if true--");return this.model.get("assigneeTitle")}else{console.log("else true--");return this.model.get("taskAssignee")}}},contextualActions:function(){var Y=this.collection,U=this,X=[];var T="false";var Z="false";var W="false";var V=this.get("taskDetails");if(V!==undefined){for(var S=0;S<V.length;S++){if(V[S].indexOf("canChangeAssignee")>-1){T=V[S].split("~")[1]}else{if(V[S].indexOf("showTaskRemove")>-1){Z=V[S].split("~")[1]}else{if(V[S].indexOf("isRouteOwner")>-1){W=V[S].split("~")[1]}}}}}else{T="true";Z="true"}if(T==="true"){X.push({text:j.changeAssignee,fonticon:"user-change",handler:function(aa){var ab=new r(J.extend({collection:Y,taskModel:U},null));ab.show()}})}if(this._attributes.type==="Route Node"&&Z==="true"){X.push({text:j.Delete,fonticon:"trash",handler:function(aa){var ab=new m({model:aa.model});ab.showModal()}})}if(W==="true"&&this._attributes.type==="Inbox Task"&&this._attributes.needsOwnerReview===true&&this._attributes.current==="Review"){X.push({text:j.requiresOwnerReview,fonticon:"user-ok",handler:function(aa){var ab=new x({model:aa.model});ab.showModal()}})}return X},icon:"clipboard",title:j.emptyTaskTitle,},emptyView:O,events:{onItemViewSelect:y,onPullToRefresh:g}},events:{onActionClick:D,onItemViewSelect:w,onUnSelectAll:k,onFacetUnselect:t,onFacetSelect:E,onDestroy:t,onInfiniteScroll:n,onItemViewDrag:Q}}},getListViewOptions:function(){return{className:"loading",contents:{useInfiniteScroll:true,usePullToRefresh:true,itemViewOptions:{mapping:{title:"name",content:function(){return this.model.get("physicalid")},icon:M.getWebappsAssetUrl("ENORouteMgmt","icons/16/I_Document16.png"),image:M.getWebappsAssetUrl("ENORouteMgmt","icons/48/I_Route48.png"),subtitle:"physicalid"},icon:"clipboard",title:j.emptyTaskTitle,},emptyView:O,events:{onItemViewClick:function(S,R,T){},onItemViewSelect:w,onUnSelectAll:k,onPullToRefresh:g,onDestroy:t,onRender:E}},events:{onInfiniteScroll:n,onItemViewDrag:Q}}}};return I});define("DS/ENORouteMgmt/Views/Modals/ModalRemoveRoute",["UWA/Controls/Abstract","UWA/Controls/Input","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/W3DXComponents/Views/Temp/TempItemView","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(d,g,j,h,b,f,c,e,i){var a=d.extend({init:function(k){this._parent(k);this.resetModal();this.model=k.model;this._alertFailure=new j({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"});this._alertSuccess=new j({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"});this._alertWarning=new j({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"warning"})},showModal:function(){var k=this;window.savemodelRef=this.modal;this.modal.inject(document.body);this.modal.show()},getFooter:function(){var l=this;var k=new f({value:i.Delete,className:"primary",events:{onClick:function(){l.onRemoveCalled()}}});var m=new f({value:i.cancel,className:"default",events:{onClick:function(n){l.onCancelCalled()}}});return[k,m]},onRemoveCalled:function(){b.mask(widget.body);var l=this.model,p=l.collection,n=this._alertFailure,k=this._alertSuccess,o=this._alertWarning,m;m={};m=new c().createDataForRequest(m);l.destroy({onFailure:function(r,s,q){if(s.timedout){o.add({message:i.warningRemoveRouteTimeout})}else{if(s.error){n.add({message:s.error})}else{n.add({message:i.errorRemove})}}b.unmask(widget.body)},onComplete:function(){k.add({message:i.successRemoveRoute});b.unmask(widget.body)},wait:true,data:JSON.stringify(m)});this.modal.destroy();window.savemodelRef=null;this.resetModal()},onCancelCalled:function(){window.savemodelRef=null;this.modal.destroy();this.resetModal()},resetModal:function(){this.modal=new h({closable:true,header:i.removeRoute,body:i.removeRouteDetail,footer:this.getFooter()})},onDestroy:function(){this._alertFailure.destroy();this._alertSuccess.destroy()}});return a});define("DS/ENORouteMgmt/SkeletonUtils/RouteSkeletonOptions",["UWA/Drivers/Alone","UWA/Core","DS/WAFData/WAFData","DS/ENORouteMgmt/EnoviaBootstrap","DS/UIKIT/Alert","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Collections/ActionsCollection","DS/W3DXComponents/Views/EmptyView","DS/ENORouteMgmt/Views/Properties/RoutePropertiesView","DS/ENORouteMgmt/SkeletonUtils/ContentSkeletonOptions","DS/ENORouteMgmt/SkeletonUtils/MemberSkeletonOptions","DS/ENORouteMgmt/Views/Modals/ModalCreateRoute","DS/ENORouteMgmt/Views/Modals/ModalRemoveRoute","DS/ENORouteMgmt/Views/Modals/ModalStopRoute","DS/WebappsUtils/WebappsUtils","DS/ENORouteMgmt/Utilities/Utils","DS/ENORouteMgmt/Utilities/ParseJSONUtil","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt"],function(j,t,a,h,e,g,x,o,w,r,n,u,l,q,f,c,v,i){var b,m=new e({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"}),k=new e({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,messageClassName:"success"}),s=new e({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"warning"}),p=new x([{id:"edit.startroute",title:i.startRoute,icon:"play"},{id:"edit.subscriberoute",title:i.subscribeRoute,icon:"rss"},{id:"openexternal",title:i.openexternal,icon:"window"},{id:"edit.stoproute",title:i.stopRoute,icon:"block"},{id:"edit.owner",title:i.ownerRole,icon:"pencil"},{id:"edit.description",title:i.description,icon:"pencil"},{id:"edit.title",title:i.title,icon:"pencil"},{id:"edit.family",title:i.family,icon:"pencil"},{id:"add.contents",title:i.addContent,icon:"plus",overflow:false,actionBar:true},{id:"upload.contents",title:i.addContent,icon:"upload",overflow:false,actionBar:true},{id:"add.members",title:i.addMember,icon:"user-add",overflow:false,actionBar:true},{id:"add.tasks",title:i.addTask,icon:"list-add",overflow:false,actionBar:true},{id:"delete",title:i.removeRoute,icon:"close",actionBar:false},{id:"edit.restartroute",title:i.restartRoute,icon:"list-delete"},{id:"edit.resumeroute",title:i.resumeRoute,icon:"navigation-history"}]);function d(){var y=this,B=this.collection,A,C,z=b.getFetchOptions();A=z.onComplete;z.onComplete=function(H,G,F){if(G.data&&G.data.length>0){var E=widget.getTitle();var D=E.match(/\(\d+\)$/);if(!D){widget.setTitle(E+" ("+G.data.length+")")}}if(y.container.offsetParent){y.container.removeClassName("loading");Object.keys(y.contentsViews).map(function(I){y.contentsViews[I].scrollView.endLoading()})}if(A){A(y,G,F)}};if(B.state.totalRecords===null){B.getFirstPage(z)}else{if(B.hasNextPage()){B.getNextPage(t.extend(z,{remove:false,reset:false}))}else{y.container.removeClassName("loading");Object.keys(y.contentsViews).map(function(D){y.contentsViews[D].scrollView.useInfiniteScroll(false)})}}}b={getFetchOptions:function(z){var y={type:"json",headers:{"Content-Type":"application/ds-json",},data:{type:"Route",owner:h.getLoginUser(),},actionsCtx:p,reset:true,onFailure:function(B,C,A){if(C.error){widget.setBody(C.error)}else{m.add({message:i.errorFetchRoutes})}}};return y},getCreateOptions:function(){return{actionsCtx:p,onComplete:function(y){window.onRefresh();k.add({message:i.replace(i.successCreate,{tag1:y.data[0].dataelements.name})})},onFailure:function(z,A,y){if(A.internalError!=undefined&&A.internalError.indexOf("'type name revision' not unique")!=-1){m.add({message:i.replace(i.errorCreateRouteNotUnique,{tag1:z.get("name")})})}else{if(A.error!=undefined&&A.error.indexOf("No create Access For Role")!=-1){m.add({message:i.errorCreateRouteForRole})}else{m.add({message:i.replace(i.errorCreateRoute,{})});console.log("Route Creation failed : "+A.internalError)}}}}},getIdCardOptions:function(y){return{collapsed:y.minimizeIdCardView,editableElements:function(){return["name","description"]},attributesMapping:{ownerName:function(){return this.get("ownerFullName")},date:function(){var z=new Date(this.get("modified"));return i.modified+" : "+z.toGMTString().parseRelativeTime()},image:function(){return f.getWebappsAssetUrl("ENORouteMgmt","icons/144/I_Route108x144.png")},icon:function(){return f.getWebappsAssetUrl("ENORouteMgmt","icons/16/I_Route16.png")},description:function(){return c.decodeHTMLEntites(this.get("description"))}},thumbnailUrl:function(){return null},actions:function(){var C=[],F=true,G=true,D=true,E=true,A=true,z=true,B=this.get("state")==="Complete"||this.get("state")==="Archive"||this.get("modifyAccess")==="FALSE"?false:true;F=F&&this.get("actions").some(function(H){return H.indexOf(".startroute")!==-1});E=F&&this.get("actions").some(function(H){return H.indexOf(".subscriberoute")!==-1});G=G&&this.get("actions").some(function(H){return H.indexOf(".restartroute")!==-1});D=D&&this.get("actions").some(function(H){return H.indexOf(".resumeroute")!==-1});A=A&&this.get("actions").some(function(H){return H.indexOf(".stoproute")!==-1});z=z&&this.get("actions").some(function(H){return H.indexOf("delete")!==-1});if(E){C.push({text:i.subscribeRoute,icon:"rss",handler:function(I,H){this.model.subscribeRoute()}})}if(F){C.push({text:i.startRoute,icon:"play",handler:function(I,H){this.model.startRoute()}})}if(G){C.push({text:i.restartRoute,icon:"reset",handler:function(I,H){this.model.restartRoute()}})}if(D){C.push({text:i.resumeRoute,icon:"navigation-history",handler:function(I,H){this.model.resumeRoute()}})}if(A){C.push({text:i.stopRoute,icon:"stop",handler:function(L,K){var I=this.model.url();I=I+"?$fields=none,name&stopRouteCheck=true";var J=this;var H={};H=t.extend(H,h.getSyncOptions(),true);H.method="GET";H.type="json";H.headers={"Content-Type":"application/ds-json",};H.onComplete=function(N){console.log(JSON.stringify(N));N=new v().parseResp(N);if(N[0].isStateBased==="true"){var M=new q({model:J.model});M.showModal()}else{J.model.stopRoute(false)}};a.authenticatedRequest(I,H)}})}if(B){C.push({text:i.editProperties,icon:"pencil",handler:function(I,H){this.selectFacet("properties");this.switchToEditMode()}})}if(z){C.push({text:i.removeRoute,icon:"close",handler:function(K,J){var I;if(true){this.listenToOnce(this.model,{onDestroy:function(){J.slideBack()}});var H=new l({model:this.model});H.showModal()}else{m.add({message:i.errorRemoveRouteNotEmpty})}}})}return C},facets:[{name:"properties",text:i.properties,icon:"doc-text",handler:g.getRendererHandler(w)},{name:"contents",text:i.content,icon:"docs",handler:g.getRendererHandler("contents")},{name:"tasks",text:i.tasks,icon:"clipboard",handler:g.getRendererHandler("tasks")},{name:"access",text:i.members,icon:"users",handler:g.getRendererHandler("access")},{name:"taskgraph",text:i.taskGraph,icon:"flow-tree",handler:g.getRendererHandler("taskgraph")}]}},getListViewOptions:function(y){return{buttonGroup:function(){var C=this._storage,B=C.get("actions"),A,z;B&&(A=B.some(function(D){return D.indexOf("add")!==-1}));if(!t.is(B)||A){z={buttons:[{icon:"plus",value:i.createRoute,className:"primary"}]}}return z},className:"loading",contents:{useInfiniteScroll:true,usePullToRefresh:false,itemViewOptions:{mapping:{content:function(){var C="";var B="";var A="";switch(this.model.get("routeStatus")){case"Started":C="flag";B="fonticon-color-success";break;case"Stopped":C="clock";B="fonticon-color-warning";break;case"Not Started":C="info";B="fonticon-color-info";break;case"Finished":C="check";B="fonticon-color-success";break;default:C="";B=""}var z=this.model.get("attrScope")?this.model.get("attrScope")[0]:"";if(z==="All"||z==="Organization"){A=i[z]}else{A=z}return i.routeScope+" : "+A+'<br/><span class="fonticon fonticon-'+C+" "+B+'"></span>'+i[this.model.get("routeStatus")]},image:function(){return f.getWebappsAssetUrl("ENORouteMgmt","icons/144/I_Route108x144.png")},icon:function(){return this.model.get("typeicon")},subtitle:function(){return i[this.model.get("routeBasePurpose")]}},icon:"alert",title:i.emptyRouteTitle},emptyView:o,events:{onItemViewClick:function(A,z,B){widget.setTitle(z.model.get("title"))},}},events:{onInfiniteScroll:function(){Array.prototype.push.call(arguments,y);d.apply(this,arguments)},onClick:function(A,B){var C=this.collection,z=new u(t.extend({collection:C},b.getCreateOptions()));z.show()}}}}};return b});define("DS/ENORouteMgmt/Collections/TasksCollection",["UWA/Core","DS/WAFData/WAFData","UWA/Class/Model","DS/WebAppsFoundations/Collections/PageableCollection","DS/ENORouteMgmt/EnoviaBootstrap","DS/ENORouteMgmt/Models/TaskModel","DS/ENORouteMgmt/Models/RouteModel","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/TagNavigatorProxy/TagNavigatorProxy"],function(h,f,l,d,a,c,j,b,g){var i="contents";function k(m,o){var n;if(m){n=m[o];if(h.is(n,"function")){n=n.call(m)}}return n}var e=d.extend({defaultOptions:{taggerProxy:{filteringMode:"FilteringOnServer",events:{}}},name:i,model:c,filterTagObj:null,isNewFilter:false,url:function(){return"/tasks"},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"contentTotal",withroots:"true",to:"true",selectbo:"name",recurselevel:"1"},_initTaggerProxy:function(){var o=this,m,n,p;m=this.getOption("taggerProxy");p=this._taggerProxyEvents={onFilterChange:o.onFilterChange,addUnfocusSubjectsListener:o.onUnfocusSubjects};if(widget&&a.getStorage()){m=h.extend({widgetId:widget.id,tenant:a.getStorage().id},m,true)}else{m=h.extend({contextId:"context1"},m,true)}n=this.taggerProxy=g.createProxy(m);this.listenTo(n,p);return n},parseResponseForStateUpdate:function(p,n,o,m){return{totalRecords:p.data.length}},parseRecords:function(o,m){o.result=new b().parseResp(o);for(var n=0;n<o.result.length;n++){if(o.result[n].hasOwnProperty("allowDelegation")){o.result[n].allowDelegation=o.result[n].allowDelegation==="TRUE"?true:false}if(o.result[n].hasOwnProperty("assigneeSetDueDate")){o.result[n].assigneeSetDueDate=o.result[n].assigneeSetDueDate==="Yes"?true:false}if(o.result[n].hasOwnProperty("needsOwnerReview")){o.result[n].needsOwnerReview=o.result[n].needsOwnerReview==="Yes"?true:false}}return o.result},sync:function(p,o,n){var m="?";h.extend(n,a.getSyncOptions(),true);this._parent.apply(this,arguments)},fetch:function(p){var r=this,n=this.taggerProxy,o,s,m,q;p=p?h.clone(p,false):{};if(n){s=p.onComplete;o=this.filterTagObj;if(o){m={tags:JSON.stringify(o)};p.data=(p.data?h.extend(m,p.data):m)}p.onComplete=function(u,v,t){q=u.parseTags(v);if(t.reset===true){n.setTags(q.subjectsTags,q.tagValues)}else{n.addSubjects(q.subjectsTags)}u.isNewFilter=false;if(h.is(s,"function")){s(this,v,t)}}}if(this.currentSearchUrl){p.url=this.currentSearchUrl}return this._parent.call(this,p)},parseTags:function(m){return{tagValues:m.tagValues,subjectsTags:m.subjectsTags}},setup:function(o,m){var n=m._modelKey;if(n&&n instanceof l){this._modelKey=n;if(m.url===undefined){this.url=k(n,"url")+Object.getPrototypeOf(this).url.call(this)}}this._initTaggerProxy();if(widget){this.listenTo(widget,{onSearch:this.onSearch,onResetSearch:this.onResetSearch})}},create:function(n,q){if(!this._modelKey&&!this._modelKey instanceof j){throw new Error("Your contents is not associated with a route!")}var p,s,r=this,m=this._modelKey;q=q?h.clone(q,false):{};p=r._prepareModel(n,q);if(!p){return false}if(!q.wait){r.add(p,h.extend({isProgress:true},q))}q.method="PUT";q.type="json";q.headers={"Content-Type":"application/ds-json",};s=q.onComplete;q.onComplete=function(v,u,t){h.extend(t,u);t.onComplete=function(x,y,w){w.onComplete=function(A,B,z){A.dispatchEvent("onLoad");if(z.wait){r.add(A,z)}if(s){return s(A,B,z)}};x.save(null,h.extend({url:k(x,"url")+"?receipt="+encodeURIComponent(y.receipt),type:"json",headers:{"Content-type":"application/x-www-form-urlencoded"}},w))};p.createAssociatedBO(t)};var o=k(p,"url");f.authenticatedRequest(o,q);return p},getPreviews:function(m){},parsePreviews:function(m){return m},focusTaggerProxyOnSubject:function(n){if(!this.taggerProxy){return}var m=this.get(n);if(m){m.focusTaggerProxyOnSubject()}},unfocusTaggerProxy:function(){var m=this.taggerProxy;if(!this.taggerProxy){return}m.unfocus()},activateTaggerProxy:function(){var m=this.taggerProxy;if(!this.taggerProxy){return}m.activate()},deactivateTaggerProxy:function(){var m=this.taggerProxy;if(!this.taggerProxy){return}m.deactivate()},onReset:function(){},onFilterChange:function(m){this.filterTagObj=m;this.isNewFilter=true;this.taggerProxy.setTags({},[]);this.dispatchEvent("onTaggerProxyFilterChange")},onUnfocusSubjects:function(){this.dispatchEvent("onTaggerProxyUnfocusSubjects")},onSearch:function(o){if(o){var m=(h.is(this.url,"function"))?this.url():this.url;var n=m+"?q="+o;if(n!=this.currentSearchUrl){this.currentSearchUrl=n;this.dispatchEvent("onSearch")}}},onResetSearch:function(){this.currentSearchUrl=null;this.dispatchEvent("onResetSearch")},destroy:function(){var m=this.taggerProxy;if(m){this.stopListening(m,this._taggerProxyEvents);m.die();delete this.taggerProxy}this.stopListening(widget);return this._parent.apply(this,arguments)}});return e});define("DS/ENORouteMgmt/Collections/RoutesCollection",["UWA/Core","DS/WAFData/WAFData","DS/WebAppsFoundations/Collections/PageableCollection","UWA/Class/Model","UWA/Class/Collection","DS/ENORouteMgmt/EnoviaBootstrap","DS/ENORouteMgmt/Models/RouteModel","DS/ENORouteMgmt/Utilities/ParseJSONUtil","DS/TagNavigatorProxy/TagNavigatorProxy","DS/WebappsUtils/WebappsUtils","DS/ENORouteMgmt/SkeletonUtils/RouteSkeletonOptions"],function(i,g,f,n,l,b,k,d,h,c,a){var j="routes";function m(o,q){var p;if(o){p=o[q];if(i.is(p,"function")){p=p.call(o)}}return p}var e=f.extend({defaultOptions:{taggerProxy:{filteringMode:"WithFilteringServices",events:{}}},name:j,model:k,filterTagObj:null,isNewFilter:false,url:function(){return"/resources/v1/modeler/routes"},_setupEnoviaServer:function(){var r,q;if(window.widget){r=window.widget.getUrl();r=r.substring(0,r.indexOf("/webapps"));q=window.widget.lang}else{r=window.location.origin}var o=new Date();var p=o.getTimezoneOffset();window.enoviaServer={params:"",sRealURL:r,taggerContextId:"auto",language:q,timezone:p,computeUrl:function(s){return r+s}}},_initTaggerProxy:function(){var q=this,o,p,r;o=this.getOption("taggerProxy");r=this._taggerProxyEvents={onFilterChange:q.onFilterChange,addUnfocusSubjectsListener:q.onUnfocusSubjects};if(widget&&b.getStorage()){o=i.extend({widgetId:widget.id,tenant:b.getStorage().id},o,true)}else{o=i.extend({contextId:"context1"},o,true)}p=this.taggerProxy=h.createProxy(o);p.addFilterSubjectsListener(q.onFilterChange,q);this.listenTo(p,r);return p},parseResponseForStateUpdate:function(r,p,q,o){return{totalRecords:r.data.length}},parseRecords:function(p,o){p.result=new d().parseResp(p);if(p.info!=undefined){widget.data.routeContentSearchTypes=p.info}return p.result},setup:function(q,o){var p=o.storage;if(p&&p instanceof n){this._storage=p}this._initTaggerProxy();if(widget){this.listenTo(widget,{onSearch:this.onSearch,onResetSearch:this.onResetSearch})}},getTenantUrl:function(){var o=new RegExp("^(.+)/resources/enocsmrest/"+this.name+"$");return o.exec(m(this,"url"))[1]},sync:function(t,q,p){var o="";i.extend(p,b.getSyncOptions(),true);if(!p.data){p.data={}}var r=widget.getValue("routeFilter");var s=widget.getValue("routeId");if(s){p.url=p.url+"/"+s}if(r){r=r.split("_")[0];p.url=p.url+"?routeFilter="+r}if(undefined==widget.data.routeContentSearchTypes){p.url=p.url+"&routeContentSearchTypes=True"}this._parent.apply(this,arguments)},fetch:function(r){var t=this,p=this.taggerProxy,q,u,o,s;r=r?i.clone(r,false):{};return this._parent.call(this,r)},getPostData:function(o){var p="idList=";for(var q in o){p+=o[q].id+","}p=p.slice(0,-1);return p},parseTags:function(o){return{tagValues:o.tagValues,subjectsTags:o.subjectsTags}},getPreviews:function(o){},onReset:function(){},focusTaggerProxyOnSubject:function(p){if(!this.taggerProxy){return}var o=this.get(p);if(o){o.focusTaggerProxyOnSubject()}},unfocusTaggerProxy:function(){var o=this.taggerProxy;if(!this.taggerProxy){return}o.unfocus()},activateTaggerProxy:function(){var o=this.taggerProxy;if(!this.taggerProxy){return}o.activate()},deactivateTaggerProxy:function(){var o=this.taggerProxy;if(!this.taggerProxy){return}o.deactivate()},onFilterChange:function(o){this.filterTagObj=o;this.isNewFilter=true;this.fetch(a.getFetchOptions())},onUnfocusSubjects:function(){this.dispatchEvent("onTaggerProxyUnfocusSubjects")},onSearch:function(q){if(q){var o=(i.is(this.url,"function"))?this.url():this.url;var p=o+"?q="+q;if(p!=this.currentSearchUrl){this.currentSearchUrl=p;this.dispatchEvent("onSearch")}}},onResetSearch:function(){this.currentSearchUrl=null;this.dispatchEvent("onResetSearch")},destroy:function(){var o=this.taggerProxy;if(o){this.stopListening(o,this._taggerProxyEvents);o.die();delete this.taggerProxy}this.stopListening(widget);return this._parent.apply(this,arguments)}});return e});define("DS/ENORouteMgmt/SkeletonUtils/ENORouteMgmtSkeletonOptions",["UWA/Core","UWA/Class/Model","DS/ENORouteMgmt/EnoviaBootstrap","DS/W3DXComponents/Skeleton","DS/ENORouteMgmt/Views/Sets/RouteContentSet","DS/ENORouteMgmt/Views/Sets/TaskContentSet","DS/W3DXComponents/MemberSet","DS/ENORouteMgmt/Collections/RoutesCollection","DS/ENORouteMgmt/Collections/ContentsCollection","DS/ENORouteMgmt/Collections/TasksCollection","DS/ENORouteMgmt/Collections/MemberCollection","DS/ENORouteMgmt/SkeletonUtils/RouteSkeletonOptions","DS/ENORouteMgmt/SkeletonUtils/ContentSkeletonOptions","DS/ENORouteMgmt/SkeletonUtils/TaskSkeletonOptions","DS/ENORouteMgmt/SkeletonUtils/MemberSkeletonOptions","DS/ENORouteMgmt/Views/FiltersAdapter","DS/ENORouteMgmt/Views/Graph/RouteGraphicalView","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(r,n,g,f,d,q,m,c,s,j,a,b,p,t,l,i,e,h){function k(u,w){var v;if(u){v=u[w];if(r.is(v,"function")){v=v.call(u)}}return v}var o={getRootIdCardOptions:function(v){var x=this,u=widget.getValue("routeName");var w="";if(u!==""){w="/routes/"+u+"/?f=0&s=collapsed"}return{root:"routes",useRootChannelView:v.channelView,responsiveTrigger:function(){var y=widget.getView().type;return y==="maximized"||y==="fullscreen"},minimizeIdCards:true,startRoute:w,rootIdCardOptions:{model:new n({title:h.myRoutes,routes:null}),facets:[{name:"routes",text:"",icon:"",handler:f.getRendererHandler("routes")}]},events:v.events}},getRendererMap:function(u){return{routes:{collection:c,collectionOptions:{url:function(){return g.getRouteServiceBaseURL()},storage:g.getStorage()},events:{onTaggerProxyFilterChange:function(){this.collection.fetch(b.getFetchOptions())}},viewOptions:b.getListViewOptions(u),idCardOptions:b.getIdCardOptions(u),idKey:"name",fetchMode:"never",swipe:false},access:{collection:a,view:new i(m,l.getFetchOptions()),viewOptions:l.getMemberSetOptions(u),idCardOptions:l.getIdCardOptions(u),fetchMode:"never"},contents:{collection:s,view:new i(d,p.getFetchOptions()),viewOptions:p.getContentSetOptions(u),idCardOptions:p.getIdCardOptions(u),fetchMode:"never",idKey:"physicalid",},tasks:{collection:j,view:new i(q,t.getFetchOptions()),viewOptions:t.getContentSetOptions(u),idCardOptions:t.getIdCardOptions(u),fetchMode:"never",idKey:"physicalid",},taskgraph:{view:e,idKey:"physicalid",fetchMode:"never"}}}};return o});define("DS/ENORouteMgmt/ENOMyRoutesWidget",["UWA/Core","UWA/Class","UWA/Class/Collection","DS/UIKIT/Alert","DS/ENORouteMgmt/Collections/CollabStorageCollection","DS/ENORouteMgmt/Models/RouteModel","DS/ENORouteMgmt/Models/ContentModel","DS/W3DXComponents/Skeleton","DS/ENORouteMgmt/ENORouteStatusInfo","DS/ENORouteMgmt/EnoviaBootstrap","DS/ENORouteMgmt/SkeletonUtils/ENORouteMgmtSkeletonOptions","DS/WAFData/WAFData","DS/ENORouteMgmt/Utilities/Utils","i18n!DS/ENORouteMgmt/assets/nls/ENORouteMgmt","css!DS/ENORouteMgmt/ENORouteMgmt.css"],function(x,A,q,d,z,u,y,e,w,g,t,a,b,h){var o,k,l,v,r=false,n,i=false;window.onRefresh=function(){m()};function s(){var E,C,B,D;widget.setValue("nb-items",null);E=widget.getValue("collabstorage");if(E){n.forEach(function(F){if(F.get("url")===E){C=F.id}});if(C){widget.setValue("collab-storage",C)}widget.setValue("collabstorage",null);B=widget.getValue("view");if(B){if(B==="CHANNEL"){D="channel"}else{if(B==="LIST"){D="list"}}widget.setValue("main-view",D)}widget.setValue("view",null)}}function j(D){var C,F=h.myRoutes;if(!x.is(D)&&this instanceof e){C=this.getCurrentPanelIndex();D=this.getModelAt(C)}if(D instanceof u){F=D.get("title")}else{if(D instanceof y){F=D.get("businessobj").title}else{if(D&&D.get("title")==h.myRoutes){var G=D._facetObjs;if(G){for(var E=0;E<G.length;E++){if(G[E].reference==="routes"){var B=G[E].collection.length;F=h.myRoutes+" ("+B+")";break}}}}}}return widget.setTitle(F)}function m(){if(k){k.destroy();j();if(window.savemodelRef){window.savemodelRef.destroy()}}var C,D,B;B=widget.body.getElement("#widget-content");C={minimizeIdCardView:widget.getBool("id-card-view"),detailViewOptions:{skeleton:undefined}};D={channelView:widget.getValue("main-view")==="channel",events:{onSlide:function(E,F){j.call(this,F)},onItemSelect:j,onRouteChange:function(E){console.log(E)}}};k=new e(t.getRendererMap(C),t.getRootIdCardOptions(D));C.detailViewOptions.skeleton=k;k.render().inject(B);l=new w({renderTo:B,events:{onShow:function(){if(widget.getPreference("collabspace")){var F=widget.getPreference("collabspace").value;var H=widget.getPreference("collabspace").options;var E=widget.getPreference("collabspace").options.length;var G=widget.getPreference("default-collabspace-label").value;for(var I=0;I<E;I++){var J=H[I].value;if(J===F){G=H[I].label;break}}G=G==undefined?"":G;l.setStatus(h.securityContext+": "+G+"<br>"+h.currentFilter+": "+h[widget.getPreference("routeFilter").value])}}}});l.show()}function c(F,G){if(!F){return}p();var D,B={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[],onchange:"onStorageChange"},E=widget.getValue("collab-storage");if(E===""){var C=widget.getValue("x3dPlatformId");D=F.get(C);if(!D){D=F.at(0)}if(D){widget.setValue("collab-storage",D.id)}}else{D=F.get(E)}F.forEach(function(H){var J,I;I=H.get("displayName").unescapeHTML();J=H.get("id");B.options.push({label:I,value:J})});if(F.length===1&&D){B.type="hidden"}widget.addPreference(B);if(i){widget.dispatchEvent("onEdit",["refreshPrefs"]);if(!D){D=F.at(0)}}if(D){v.onStorageChange("collab-storage",D.id,G)}else{o.add({message:h.updatePreference,className:"warning"})}return D}function p(){var B=g.get3DSpaceURL()+"/resources/bps/cspaces";o=new d({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"warning"});a.authenticatedRequest(B,{type:"json",method:"GET",proxy:"passport",headers:{"Content-Type":"application/ds-json",},timeout:600000,onComplete:function(I){var H=I.cspaces,G=[],F=null,D=null;if(!H||H.length===0){H=[]}H.forEach(function(J){G.push({label:J.displayName,value:J.name});if(J.isDefault){D=J.name;F=J.displayName}});widget.addPreference({name:"default-collabspace-label",type:"hidden",defaultValue:F,options:G});widget.addPreference({name:"collabspace",type:"list",defaultValue:D,options:G,label:"collabspace",onchange:"onSpaceChange"});if(widget.getPreference("collabspace")){var E=false;var C=widget.getPreference("collabspace").options;C.forEach(function(J){if(J.value==widget.getPreference("collabspace").value){E=true}});if(!E||widget.getPreference("collabspace").value==undefined){widget.setValue("collabspace","");o.add({message:h.errorFetchCollabspaces,className:"warning",autoHide:true})}}},onFailure:function(C,D){console.log("getSecurityContext:Failure..."+C)},ontimeout:function(){console.log("getSecurityContext: A connection timeout occured.")}})}function f(){if(r){return}if(!widget){throw new Error("ENORouteMgmt must be executed in a widget environement")}n=new z();r=true}v={onLoad:function(){j();var C="RouteMgmtUserMap/route-c-ov.htm";var B=h.RoutesHelpMenuLabel;g.start({id:widget.id,collection:n});widget.setBody([{tag:"div",id:"widget-content"}]);o=new d({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:true,hideDelay:5000,messageClassName:"error"});n.fetch({onComplete:function(F,E,D){s();c.call(undefined,F,m)},onFailure:function(D){o.add({message:h.errorFetchStorages,className:"error"})}})},onViewChange:function(B){},onRefresh:function(){m()},onEdit:function(C){i=true;if(C!=="refreshPrefs"){var B={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[{label:"Loading",value:""}],onchange:"onStorageChange"};widget.addPreference(B);widget.dispatchEvent("onEdit",["refreshPrefs"]);n.fetch({onComplete:function(F,E,D){var G=c.call(undefined,F)}})}},endEdit:function(D){var B={};var C=(widget.getPreference("collabspace")==undefined)?"":widget.getPreference("collabspace").value;if(C.indexOf("ctx::")==0){C=C.split("ctx::")[1]}i=false},onStorageChange:function(B,C,E){var D=n.get(C);g.onStorageChange(D,E)},onSpaceChange:function(B){console.log("TODO : Need to implement")}};f();return v});