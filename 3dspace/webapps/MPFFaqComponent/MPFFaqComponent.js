define("DS/MPFFaqComponent/MPFFaqFeatureSuggestion",["UWA/Core","UWA/Class/View","DS/UIKIT/Form","i18n!DS/MPFFaqComponent/assets/nls/MPFFaqFeatureSuggestion"],function(b,e,a,c){var d=e.extend({setup:function(f){this.form=null},render:function(){this.form=new a({url:"https://toto.fr",className:"horizontal",fields:[{type:"text",name:"name",label:c.nameLabel,placeholder:c.namePlaceholder,required:true},{type:"text",name:"company",label:c.companyLabel,placeholder:c.companyPlaceholder,required:true},{type:"email",name:"email",label:c.emailLabel,placeholder:c.emailPlaceholder,required:true},{type:"tel",name:"phone",label:c.phoneLabel,placeholder:c.phonePlaceholder,required:true},{type:"textarea",name:"message",label:c.messageLabel,placeholder:c.messagePlaceholder,rows:10,required:true}],buttons:[{type:"submit",value:c.sendMessageButton}],events:{onSubmit:this._onFormSubmit.bind(this),}});var f=b.createElement("div",{html:[{tag:"h4",text:c.suggestFeatureTitle,styles:{padding:"10px 28px 15px 28px"}},this.form]});this.container.setContent(f)},_onFormSubmit:function(i){var g=this.form;var f="marketplace.make@3ds.com";var j=c.mailSubject;var h=g.getValue("message")+" \n\n"+c.nameLabel+" : "+g.getValue("name")+" \n"+c.companyLabel+" : "+g.getValue("company")+" \n"+c.emailLabel+" : "+g.getValue("email")+" \n"+c.phoneLabel+" : "+g.getValue("phone")+" \n";window.location.href=this._generateMailTo(f,j,h);this.container.setContent('<p class="text-center text-success"><br /><br /><br />'+c.mailSentMessage+"</p>")},_generateMailTo:function(j,k,g){var l=j;var i=this._prepareForMail(k);var f=this._prepareForMail(g);var h="mailto:"+l+"?subject="+i+"&body="+f;return h},_prepareForMail:function(h){var g="%20";var f="%0D%0A";return encodeURIComponent(h).replace(" ",g).replace("\n",f)},});return d});define("DS/MPFFaqComponent/MPFFaqHandlebarsHelpers",["UWA/Core","WebappsUtils/WebappsUtils","DS/Handlebars/Handlebars"],function(a,b,d){var c={addHandlebarsHelpers:function(e){var f=this;if(!("i18n" in d.helpers)){d.registerHelper("i18n",function(h,g){return new d.SafeString(d.i18n!=undefined?d.i18n.get(h,g.hash):h)})}if(!("ifCond" in d.helpers)){d.registerHelper("ifCond",function(i,h,g){if(i===h){return g.fn(this)}return g.inverse(this)})}if(!("userHasRole" in d.helpers)){d.registerHelper("userHasRole",function(g,h){return f.userHasRole(g,h)})}if(!("faq-image" in d.helpers)){d.registerHelper("faq-image",function(h){var g=b.getWebappsAssetUrl(e,"images/"+h);return new d.SafeString('<img src="'+g+'" />')})}if(!("faq-images" in d.helpers)){d.registerHelper("faq-images",function(){var g=new Date().valueOf();var h=arguments;require(["DS/UIKIT/Carousel"],function(n){var j="";for(var k=0;k<h.length-1;k++){var m=b.getWebappsAssetUrl(e,"images/"+h[k]);j+='<img src="'+m+'" />'}var l=new n({slides:a.createElement("div",{html:j}),slideSelector:"> img",autoPlay:true,animation:"slide",dots:true,infinite:true});var o=document.querySelector("#_"+g);if(o){l.inject(UWA.extendElement(o),"after");o.parentNode.removeChild(o)}});return new d.SafeString('<div id="_'+g+'"></div>')})}if(!("faq-columns" in d.helpers)){d.registerHelper("faq-columns",function(g){var h=g.fn(this);return new d.SafeString('<div class="row">'+h+"</div>")})}if(!("faq-column" in d.helpers)){d.registerHelper("faq-column",function(g){var h=g.fn(this);return new d.SafeString('<div class="col-md-6">'+h+"</div>")})}},userHasRole:function(h,k){var g=false;if(!k){g=true}else{if(h&&h.length){var f=k.split(">");var l=f[0];var j=f.length>1?f[1]:undefined;for(var e=0;e<h.length;e++){if(h[e].Role===l&&(!j||h[e].Project===j)){g=true;break}}}}return g}};return c});define("DS/MPFFaqComponent/MPFFaqWidget",["UWA/Core","UWA/Promise","UWA/Class/View","UWA/Utils","DS/Handlebars/Handlebars","DS/MPFFaqComponent/MPFFaqHandlebarsHelpers","text!DS/MPFFaqComponent/assets/templates/MPFFaqComponent.hbs","i18n!DS/MPFFaqComponent/assets/nls/MPFFaqComponent","css!DS/MPFUI/MPFUI"],function(i,h,b,d,c,e,f,j,a){var g=b.extend({domEvents:{"click img":"_onImageClick","click .mpf-faq-go-top":"scrollToTop"},setup:function(k){this._onScroll=this._onScroll.bind(this);this.model={pageUrlBase:this._getPageUrlBase(),categories:[],categoryToDisplay:null,roles:null};this.datasModule=null;this.i18nDatas=null;this.template=c.compile(f);this.isOnSummaryPage=true;this.pageParent=this._getPageParent(k.widget);this.isSticky=false;if(k.widget.data&&k.widget.data.datasModule){this.datasModule=k.widget.data.datasModule}e.addHandlebarsHelpers(this.datasModule);this._fetchMeRoles().then(function(){this._loadDatasModule();this._listenResize();this._listenScroll()}.bind(this))},_getPageParent:function(l){var k=document.querySelector(".wp-tabview-panel");if(window.getComputedStyle(k).getPropertyValue("overflow-y")!=="auto"){k=l.body;k.style.overflowY="auto"}return k},render:function(){if(this.model){c.i18n=i.merge(this.i18nDatas,j);var m=this.template.call(null,this.model);this.container.setContent(m);if(this.model&&this.model.categoryToDisplay){var l=this.model.categoryToDisplay.component;if(l){var k=this.container.getElement(".mpf-faq-component");if(k){l.render();l.inject(k)}}this._toggleActiveMenuCategory();this._toggleActiveMenuLink()}this._updateMetas()}},_getPageUrlBase:function(){var k=dsBaseUrl.replace(document.location.protocol+"//"+document.location.host+"/","");var l=document.location.href.replace(dsBaseUrl,"").split("/");if(l.length>1){l.pop()}l=l.join("/").split("?")[0];return"/"+k+l},_fetchMeRoles:function(){var k=h.deferred();if(dsUserLogin){var l=this;require(["DS/MPFDataProxy/MarketplaceConnector","DS/MPFModelFactory/MPFFactories"],function(m,o){var n;m.fetchPromise().then(function(p){try{o.init(p)}catch(r){}var q=o.getFactory(o.types.person);n=q.createModel("me");return n.fetchPromise()}).then(function(){l.model.roles=n.get("PersonRoles");k.resolve()})})}else{k.resolve()}return k.promise},_loadDatasModule:function(){if(this.datasModule){require(["text!DS/"+this.datasModule+"/assets/model/"+this.datasModule+"Model.json","i18n!DS/"+this.datasModule+"/assets/nls/"+this.datasModule],function(m,l){this._onDatasModuleLoaded(m,l)}.bind(this),function k(){console.error("FAQ config file not found")}.bind(this));window.addEventListener("popstate",this._onUrlChanges.bind(this))}else{console.error("FAQ no config file path set in widget parameters")}},_onDatasModuleLoaded:function(l,k){var m=null;try{m=JSON.parse(l)}catch(n){console.error("FAQ JSON Datas error")}if(m){this.model.categories=m;this.model.categoryToDisplay=null;this.i18nDatas=k;if(this._getUrlSecondPart()){this._onUrlChanges()}else{this.render()}}},_listenResize:function(){var k=this._isMobileDevice();window.addEventListener("resize",function(){var l=this._isMobileDevice();if(l!==k){k=l;this._updateElementsStick()}}.bind(this))},_listenScroll:function(){this.pageParent.addEventListener("scroll",this._onScroll,{passive:true})},_stopListeningScroll:function(){this.pageParent.removeEventListener("scroll",this._onScroll,{passive:true})},_onScroll:function(l){var k=l.currentTarget.scrollTop;if(!this._isMobileDevice()){if(k>105&&!this.isSticky){this._stickElements(true)}else{if(k<105&&this.isSticky){this._stickElements(false)}}}},_updateElementsStick:function(){var l=this.pageParent.scrollTop;var k=!this._isMobileDevice()&&(l>105);this._stickElements(k)},_stickElements:function(k){this.isSticky=k;var l=this.isSticky?"add":"remove";if(this.isOnSummaryPage){document.querySelector(".mpf-faq-subtitle").classList[l]("sticky");document.querySelector(".mpf-faq-menu-content").classList[l]("for-sticky")}else{document.querySelector(".mpf-faq-bloc .mpf-faq-category-title").classList[l]("sticky");document.querySelector(".mpf-faq-articles").classList[l]("for-sticky");document.querySelector(".mpf-faq-menu-content").classList[l]("sticky")}document.querySelector(".mpf-faq-go-top").classList[l]("on")},_isMobileDevice:function(){var l=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var k=l<768;return k},_toggleActiveMenuCategory:function(){var l=this._findCategoryFromUrl();if(l){var k=this.container.getElement(".mpf-faq-category.active");if(k){k.classList.remove("active")}var m=this.container.getElement('.mpf-faq-category[data-url="'+l.url+'"]');if(m){m.classList.add("active")}}},_toggleActiveMenuLink:function(){var m=this.container.getElement(".mpf-faq-article-link.active");if(m){m.classList.remove("active")}var k=this._findArticleFromUrl();if(k){var l=this.container.getElement('.mpf-faq-article-link[data-url="'+k.url+'"]');if(l){l.classList.add("active")}}},_scrollToArticle:function(){var k=this._findArticleFromUrl();if(k){var m='.mpf-faq-anchor[data-url="'+k.url+'"]';var l=this.pageParent.querySelector(m);if(l){this.scrollToElement(l)}}},_onUrlChanges:function(){var k=this.model.categoryToDisplay||{};this.model.categoryToDisplay=this._findCategoryFromUrl();if(this.model.categoryToDisplay&&k.title!==this.model.categoryToDisplay.title){this.isOnSummaryPage=false;var m=true;if(this.model.categoryToDisplay.role){m=e.userHasRole(this.model.roles,this.model.categoryToDisplay.role)}if(m){this._getArticlesTemplates(this.model.categoryToDisplay.articles).then(this.render.bind(this)).then(this._updateElementsStick.bind(this)).then(this._scrollToArticle.bind(this))}else{console.error("User don't have '"+this.model.categoryToDisplay.role+"' role");require(["DS/UWPClientCode/Navigation"],function(o){o.routeTo(document.location.pathname)})}}else{if(this.model.categoryToDisplay){this.isOnSummaryPage=false;var l=this._findArticleFromUrl();if(l.type==="component"){var n=this;require([l["class"]],function(o){n._setCurrentComponent(new o());n.render()})}this._toggleActiveMenuLink();this._scrollToArticle();this._updateMetas()}else{this.isOnSummaryPage=true;this.model.categoryToDisplay=null;this.render();this._updateElementsStick()}}},_getUrlSecondPart:function(){var k=document.location.href.replace(dsBaseUrl,"").split("/");return k.length>1?k[1].split("?")[0]:null},_findCategoryFromUrl:function(){var k=null;var o=this._getUrlSecondPart();for(var m=0;m<this.model.categories.length;m++){var n=this.model.categories[m];if(n.url===o){k=n;break}if(n.articles){for(var l=0;l<n.articles.length;l++){var p=n.articles[l];if(p.url===o){k=n;break}}}}return k},_findArticleFromUrl:function(){var m=null;var p=this._getUrlSecondPart();if(p){for(var l=0;l<this.model.categories.length;l++){var o=this.model.categories[l];if(o.articles){for(var k=0;k<o.articles.length;k++){var q=o.articles[k];if(q.url===p){m=q;break}}}}if(!m){var n=this._findCategoryFromUrl();if(n&&n.articles){m=n.articles[0]}}}return m},_getArticlesTemplates:function(l){var n=h.deferred();var r=this;var m=l.length;var q=0;var o=function(){q++;if(q===m){n.resolve()}};var k=this._findArticleFromUrl();for(var p=0;p<l.length;p++){(function(t){if(!t.type){require(["text!DS/"+r.datasModule+"/assets/templates/"+t.url+".hbs"],function(u){var w=c.compile(u);c.i18n=i.merge(r.i18nDatas,j);var v=w.call(null,r.model);r._setArticleContent(t,v);o()},function s(){o()})}else{if(t.type==="component"&&t.url===k.url){require([t["class"]],function(u){r._setCurrentComponent(new u());o()},function s(){o()})}else{o()}}})(l[p])}return n.promise},_setArticleContent:function(p,o){for(var l=0;l<this.model.categories.length;l++){var m=this.model.categories[l];for(var k=0;k<m.articles.length;k++){var n=m.articles[k];if(n.url===p.url){n.content=o;break}}}},_setCurrentComponent:function(k){this.model.categoryToDisplay.component=k},_onImageClick:function(l){var k=i.createElement("div",{"class":"mpf-faq-modal-mask off",html:{tag:"img",src:l.target.src},events:{click:function(){k.addClassName("off");setTimeout(function(){k.remove()},250)}}});k.inject(i.extendElement(document.body));setTimeout(function(){k.removeClassName("off")},10)},_updateMetas:function(){var k=this._findArticleFromUrl();if(k){var n=this._findCategoryFromUrl();var o=this._getUrlSecondPart();var p=null;if(o===n.url){p=this.i18nDatas.get(n.title)}else{p=this.i18nDatas.get(k.title)}var l=document.createElement("div");l.innerHTML=k.content;var m=(l.textContent||l.innerText).substring(0,160);require(["DS/PlatformAPI/PlatformAPI"],function(q){q.publish("update-metas",{title:{articleTitle:p},description:{articleDescription:m}})})}},scrollToTop:function(){this._smoothScroll(this.pageParent,0,500)},scrollToElement:function(l,k){var n=86;var m=this._isMobileDevice()?0:68;var o=this.pageParent.scrollTop+l.getBoundingClientRect().top-n-m;this._smoothScroll(this.pageParent,o,500);if(k!==false){setTimeout(function(){var p=l.getBoundingClientRect().top-n-m;if(Math.abs(p)>10){this.scrollToElement(l,false)}}.bind(this),500)}},_smoothScroll:function(o,s,n,l){var t=l?"scrollLeft":"scrollTop";s=Math.round(s);n=Math.round(n);if(n<0){return h.reject("bad duration")}if(n===0){o[t]=s;return h.resolve()}var r=Date.now();var m=r+n;var q=o[t];var k=s-q;var p=function(y,w,v){if(v<=y){return 0}if(v>=w){return 1}var u=(v-y)/(w-y);return u*u*(3-2*u)};return new h(function(w,v){var u=o[t];var x=function(){if(o[t]!=u){v("interrupted");return}var z=Date.now();var y=p(r,m,z);var A=Math.round(q+(k*y));o[t]=A;if(z>=m){w();return}if(o[t]===u&&o[t]!==A){w();return}u=o[t];requestAnimationFrame(x)};requestAnimationFrame(x)})}});return g});