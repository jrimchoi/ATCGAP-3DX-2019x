define("DS/CATSmmDraw/Vg",["require","exports"],function(c,b){Object.defineProperty(b,"__esModule",{value:true});b.OpCodes={OP_SAVE:"{",OP_RESTORE:"}",OP_TRANSFORM:"M",OP_TRANSLATE:"T",OP_SCALE:"S",OP_ROTATE:"R",OP_IMAGE_ID:"i",OP_TEXT:"t",OP_BEGIN_PATH:"b",OP_CLOSE_PATH:"c",OP_MOVE_TO:"m",OP_LINE_TO:"l",OP_ARC_TO:"a",OP_ARC:"A",OP_CUBIC_TO:"B",OP_QUAD_TO:"Q",OP_RECT:"r",OP_ROUNDED_RECT:"e",OP_CLIP:"C",OP_STROKE:"K",OP_OPACITY:"O",OP_FILL:"F",OP_FILL_LINEAR_GRADIENT:"G",OP_DEF:"d",OP_SET_OBJECT_ID:"#"};b.TypeDef={TYPE_STROKE_ATTRIBUTE:"k",TYPE_TEXT_ATTRIBUTE:"t",TYPE_IMAGE_URL:"i"};b.LINE_CAPS=["butt","round","square"];b.LINE_JOINS=["miter","round","bevel"];b.TEXT_H_ALIGNS=["left","center","right"];b.TEXT_V_ALIGNS=["top","middle","bottom","alphabetic"];b.H_ALIGN={LEFT:0,CENTER:1,RIGHT:2};b.V_ALIGN={TOP:0,CENTER:1,BOTTOM:2,BASELINE:3};b.SCALING={NONE:0,STRETCH:1,WIDTH:2,HEIGHT:3,FIT:4,SAME_AREA:5,FILL:6};function a(e){if(e===0){return"#000000"}else{if(e===16777215){return"#ffffff"}}var g=e.toString(16);for(var f=6-g.length;f>0;f--){g=0+g}return"#"+g}b.toCSSColor=a;function d(f,h){if(h===void 0){h=1}var e="";if(f.bold){e+="bold "}if(f.italic){e+="italic "}e+=Math.round(f.fontHeight)*h;e+="pt ";var j=f.fontFamily.split(",");for(var g=0;g<j.length;g++){e+="'";e+=j[g].trim();e+="'";if(g+1<j.length){e+=","}}return e}b.cssFontValue=d});define("DS/CATSmmDraw/DrawingKit",["require","exports"],function(c,b){Object.defineProperty(b,"__esModule",{value:true});var g=0.551784;function f(w,q){var r=1-g;var l=q[0];var u=q[1];var x=q[2];var n=q[3];var k=(x-l)/2;var t=(n-u)/2;var v=k*r;var m=t*r;var j=l+v;var s=u+m;var i=l+k;var p=u+t;var h=x-v;var o=n-m;w.moveTo(l,p);w.bezierCurveTo(l,s,j,u,i,u);w.bezierCurveTo(h,u,x,s,x,p);w.bezierCurveTo(x,o,h,n,i,n);w.bezierCurveTo(j,n,l,o,l,p)}b.ellipse=f;function a(k,j){if(j.length===0){return}k.moveTo(j[0],j[1]);var h=2;while(h<j.length){k.lineTo(j[h++],j[h++])}}b.polyline=a;function d(i,h){i.moveTo(h[0],h[1]);i.lineTo(h[2],h[1]);i.lineTo(h[2],h[3]);i.lineTo(h[0],h[3]);i.closePath()}b.rectangle=d;function e(v,n,q,i){if(i===undefined){i=q}var o=1-g;var t=q*o;var m=i*o;var l=n[0]+q;var u=n[1]+i;var r=n[2]-q;var s=n[3]-i;var p=l-t;var k=u-m;var j=r+t;var h=s+m;v.moveTo(l,n[1]);v.lineTo(r,n[1]);v.bezierCurveTo(j,n[1],n[2],k,n[2],u);v.lineTo(n[2],s);v.bezierCurveTo(n[2],h,j,n[3],r,n[3]);v.lineTo(l,n[3]);v.bezierCurveTo(p,n[3],n[0],h,n[0],s);v.lineTo(n[0],u);v.bezierCurveTo(n[0],k,p,n[1],l,n[1]);v.closePath()}b.roundedRectangle=e});define("DS/CATSmmDraw/Geometry",["require","exports"],function(i,u){Object.defineProperty(u,"__esModule",{value:true});u.Direction={CENTER:-1,EAST:0,SOUTH_EAST:1,SOUTH:2,SOUTH_WEST:3,WEST:4,NORTH_WEST:5,NORTH:6,NORTH_EAST:7};function n(x){x[0]=Number.POSITIVE_INFINITY;x[1]=Number.POSITIVE_INFINITY;x[2]=Number.NEGATIVE_INFINITY;x[3]=Number.NEGATIVE_INFINITY;return x}u.setNullRectangle=n;function d(y,A,x,z,B){if(B===u.Direction.WEST||B===u.Direction.NORTH_WEST||B===u.Direction.SOUTH_WEST){return y}if(B===u.Direction.EAST||B===u.Direction.NORTH_EAST||B===u.Direction.SOUTH_EAST){return x}return(y+x)/2}u.getRectanglePointX=d;function b(y,A,x,z,B){if(B===u.Direction.NORTH||B===u.Direction.NORTH_EAST||B===u.Direction.NORTH_WEST){return A}if(B===u.Direction.SOUTH||B===u.Direction.SOUTH_EAST||B===u.Direction.SOUTH_WEST){return z}return(A+z)/2}u.getRectanglePointY=b;function r(x,y){return[d(x[0],x[1],x[2],x[3],y),b(x[0],x[1],x[2],x[3],y)]}u.getRectanglePoint=r;function a(A,C,z,B){var y=A-z;var x=C-B;if(y>=x){if(y>=-x){return u.Direction.EAST}else{return u.Direction.NORTH}}else{if(y>=-x){return u.Direction.SOUTH}else{return u.Direction.WEST}}}u.positionOfPointRelativeToPoint=a;function m(A,G,D){var B=D[2]-D[0];var C=D[3]-D[1];var E=Math.min(B,C)/2;var z=a(A,G,D[0]+E,D[1]+E);var F=a(A,G,D[2]-E,D[3]-E);if(z===F){return z}if(B>C){if(G>D[1]+E){return u.Direction.SOUTH}else{return u.Direction.NORTH}}else{if(A>D[0]+E){return u.Direction.EAST}else{return u.Direction.WEST}}}u.positionOfPointRelativeToRectangle=m;function t(A,D,B){var C=m(A,D,B);var z=[0,0];switch(C){case u.Direction.EAST:z[0]=B[2];z[1]=Math.max(B[1],Math.min(D,B[3]));break;case u.Direction.SOUTH:z[0]=Math.max(B[0],Math.min(A,B[2]));z[1]=B[3];break;case u.Direction.WEST:z[0]=B[0];z[1]=Math.max(B[1],Math.min(D,B[3]));break;case u.Direction.NORTH:z[0]=Math.max(B[0],Math.min(A,B[2]));z[1]=B[1];break}return z}u.projectPointOnRectangle=t;function l(A,z,B){if(z<A[0]){A[0]=z}if(z>A[2]){A[2]=z}if(B<A[1]){A[1]=B}if(B>A[3]){A[3]=B}return A}u.rectangleMergeWithPoint=l;function p(x,y){if(y[0]<x[0]){x[0]=y[0]}if(y[2]>x[2]){x[2]=y[2]}if(y[1]<x[1]){x[1]=y[1]}if(y[3]>x[3]){x[3]=y[3]}return x}u.rectangleMergeWithRectangle=p;function w(z,y){for(var x=0;x<y.length;x+=2){l(z,y[x],y[x+1])}return z}u.rectangleMergeWithPoints=w;function f(y,x){return y[0]<=x[2]&&x[0]<=y[2]&&y[1]<=x[3]&&x[1]<=y[3]}u.rectangleIntersectsRectangle=f;function q(A,z,B){return A[0]<=z&&z<=A[2]&&A[1]<=B&&B<=A[3]}u.rectangleContainsPoint=q;function v(z,A){for(var y=0,x=A.length;y<x;y+=2){if(!q(z,A[y],A[y+1])){return false}}return true}u.rectangleContainsPoints=v;function e(y,x){return q(y,x[0],x[1])&&q(y,x[2],x[3])}u.rectangleContainsRectangle=e;function j(z,y,x){if(x===u.Direction.CENTER||x===u.Direction.WEST||x===u.Direction.NORTH_WEST||x===u.Direction.SOUTH_WEST){z[0]=z[0]+y[0]}if(x===u.Direction.CENTER||x===u.Direction.EAST||x===u.Direction.NORTH_EAST||x===u.Direction.SOUTH_EAST){z[2]=z[2]+y[0]}if(x===u.Direction.CENTER||x===u.Direction.NORTH||x===u.Direction.NORTH_EAST||x===u.Direction.NORTH_WEST){z[1]=z[1]+y[1]}if(x===u.Direction.CENTER||x===u.Direction.SOUTH||x===u.Direction.SOUTH_EAST||x===u.Direction.SOUTH_WEST){z[3]=z[3]+y[1]}return z}u.moveRectanglePointBy=j;function c(y,x){return[x[0]-y[0],x[1]-y[1]]}u.vector=c;function o(z,y,x){z[0]=z[0]-y;z[1]=z[1]-x;z[2]=z[2]+y;z[3]=z[3]+x;return z}u.expandRectangle=o;function s(x,y){var z=(x.length/2)-1;for(var A=0;A<z;A++){if(g(x,A,y)){return true}}return false}u.polylineIntersectsRectangle=s;function g(x,A,z){var y=A*2;return h(x[y],x[y+1],x[y+2],x[y+3],z)}u.CS_OUTCODE_X_LT=1;u.CS_OUTCODE_X_GT=2;u.CS_OUTCODE_Y_LT=4;u.CS_OUTCODE_Y_GT=8;function h(A,E,y,D,C){var F=k(y,D,C);if(F===0){return true}var B=0,z=0;var x=false;while(true){var G=k(A,E,C);if(G===0){return true}if((G&F)!==0){return false}if(!x){B=(D-E)/(y-A);z=E-B*A;x=true}if((G&u.CS_OUTCODE_X_LT)!==0){A=C[0];E=B*A+z}else{if((G&u.CS_OUTCODE_X_GT)!==0){A=C[2];E=B*A+z}else{if((G&u.CS_OUTCODE_Y_LT)!==0){E=C[1];A=(E-z)/B}else{if((G&u.CS_OUTCODE_Y_GT)!==0){E=C[3];A=(E-z)/B}}}}}}u.segmentIntersectsRectangle=h;function k(z,C,B){var A=0;if(z<B[0]){A|=u.CS_OUTCODE_X_LT}else{if(z>B[2]){A|=u.CS_OUTCODE_X_GT}}if(C<B[1]){A|=u.CS_OUTCODE_Y_LT}else{if(C>B[3]){A|=u.CS_OUTCODE_Y_GT}}return A}u.cohenSutherlandOutCode=k});define("DS/CATSmmDraw/Manhattan",["require","exports","DS/CATSmmDraw/Geometry"],function(d,c,e){Object.defineProperty(c,"__esModule",{value:true});function a(r){var h,q,g=0,p=0;var m=-1;var f=false,k=true;for(var n=0,l=1;l<r.length;n+=2,l+=2){h=g;q=p;g=r[n];p=r[l];if(n>0){var t=Math.abs(h-g);var s=Math.abs(q-p);var o=t+s;if(o>m){m=t+s;f=(t>=s)===k}k=!k}}return f}c.startsHorizontally=a;function b(g,f,m,h,k){var j=h*2;var l=a(g);if(h%2!==0){l=!l}e.rectangleMergeWithPoint(k,g[j],g[j+1]);g[j]=f;g[j+1]=m;e.rectangleMergeWithPoint(k,f,m);if(j-2>=0){e.rectangleMergeWithPoint(k,g[j-2],g[j-1]);if(!l){g[j-1]=m}else{g[j-2]=f}}if(j+3<g.length){e.rectangleMergeWithPoint(k,g[j+2],g[j+3]);if(l){g[j+3]=m}else{g[j+2]=f}}}c.movePointTo=b});define("DS/CATSmmDraw/ImageUtils",["require","exports","DS/CATSmmDraw/Vg"],function(c,b,a){Object.defineProperty(b,"__esModule",{value:true});function d(u,z,i,h,s,l,r,o,g){var p=0;var n=0;var q=z.width;var v=z.height;var k=i;var j=h;var m=r;var t=o;var w=m/q;var f=t/v;switch(g){case a.SCALING.STRETCH:break;case a.SCALING.WIDTH:t=w*v;break;case a.SCALING.HEIGHT:m=f*q;break;case a.SCALING.FIT:if(w>f){m=f*q}else{t=w*v}break;case a.SCALING.SAME_AREA:var e=Math.sqrt(w*f);m=q*e;t=v*e;break;case a.SCALING.FILL:if(w<f){m=f*q}else{t=w*v}break;default:case a.SCALING.NONE:m=q;t=v;break}if(s!==a.H_ALIGN.LEFT){if(s===a.H_ALIGN.CENTER){k-=m/2}else{k-=m}}if(l!==a.V_ALIGN.TOP){if(l===a.V_ALIGN.CENTER){j-=t/2}else{j-=t}}u.drawImage(z,p,n,q,v,k,j,m,t)}b.drawImage=d});define("DS/CATSmmDraw/VgInterpreter",["require","exports","DS/CATSmmDraw/Vg","DS/CATSmmDraw/ImageUtils","DS/CATSmmDraw/DrawingKit"],function(d,c,b,f,a){var e=(function(){function g(h){this.input=h;this.definitions=[];this.images={}}g.prototype.evaluate=function(h){this.readSeparators();while(this.input.peek(0)!=="\u0000"){this.readStatement(h)}};g.prototype.readStatement=function(i){var h=this.input.peek(0);this.input.skip(1);this.readSeparators();switch(h){case b.OpCodes.OP_BEGIN_PATH:i.beginPath();break;case b.OpCodes.OP_CLOSE_PATH:i.closePath();break;case b.OpCodes.OP_SAVE:i.save();break;case b.OpCodes.OP_RESTORE:i.restore();break;case b.OpCodes.OP_MOVE_TO:i.moveTo(this.readNumber(),this.readNumber());break;case b.OpCodes.OP_LINE_TO:i.lineTo(this.readNumber(),this.readNumber());break;case b.OpCodes.OP_QUAD_TO:i.quadraticCurveTo(this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber());break;case b.OpCodes.OP_CUBIC_TO:i.bezierCurveTo(this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber());break;case b.OpCodes.OP_ARC:this.arc(i);break;case b.OpCodes.OP_ARC_TO:i.arcTo(this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber());break;case b.OpCodes.OP_RECT:i.rect(this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber());break;case b.OpCodes.OP_ROUNDED_RECT:this.roundedRect(i);break;case b.OpCodes.OP_ROTATE:i.rotate(this.readNumber());break;case b.OpCodes.OP_TRANSLATE:i.translate(this.readNumber(),this.readNumber());break;case b.OpCodes.OP_SCALE:i.scale(this.readNumber(),this.readNumber());break;case b.OpCodes.OP_TRANSFORM:i.transform(this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber(),this.readNumber());break;case b.OpCodes.OP_OPACITY:this.opacity(i);break;case b.OpCodes.OP_TEXT:this.text(i);break;case b.OpCodes.OP_IMAGE_ID:this.image(i);break;case b.OpCodes.OP_SET_OBJECT_ID:this.setObjectId();break;case b.OpCodes.OP_DEF:this.def();break;case b.OpCodes.OP_STROKE:this.stroke(i);break;case b.OpCodes.OP_FILL:i.fillStyle=b.toCSSColor(this.readNumber());i.fill();break;case b.OpCodes.OP_CLIP:i.clip();break;case b.OpCodes.OP_FILL_LINEAR_GRADIENT:this.fillLinearGradient(i);break;default:console.warn("Unknown Op code: "+h+" in "+this.input.peekString(this.input.getPosition()<20?0:-20,20));break}this.readSeparators()};g.prototype.setObjectId=function(){this.readString()};g.prototype.image=function(p){var i=this.readString();var n=this.readNumber();var m=this.readNumber();var j=this.readNumber();var k=this.readNumber();var h=this.readNumber();var q=this.readNumber();var o=this.readNumber();var l=document.createElement("img");l.src=this.images[i];f.drawImage(p,l,n,m,j,k,h,q,o)};g.prototype.text=function(l){var m=this.readString();var i=this.readNumber();var j=this.definitions[this.definitions.length-i];var h=this.readNumber();var n=this.readNumber();l.font=b.cssFontValue(j);l.fillStyle=b.toCSSColor(this.readNumber());l.textAlign=b.TEXT_H_ALIGNS[this.readNumber()];l.textBaseline=b.TEXT_V_ALIGNS[this.readNumber()];var k=this.readNumber();if(k>0){l.fillText(m,h,n,k)}else{l.fillText(m,h,n)}};g.prototype.opacity=function(h){h.globalAlpha*=this.readNumber();if(h.globalAlpha<0){h.globalAlpha=0}else{if(h.globalAlpha>1){h.globalAlpha=1}}};g.prototype.roundedRect=function(l){var j=this.readNumber();var m=this.readNumber();var k=this.readNumber();var i=this.readNumber();var h=this.readNumber();a.roundedRectangle(l,[j,m,j+k,m+i],h,h)};g.prototype.arc=function(m){var j=this.readNumber();var n=this.readNumber();var l=this.readNumber();var i=this.readNumber();var k=this.readNumber();var h=this.readNumber();if(l===i){m.arc(j,n,l,k,k+h,h<0)}else{m.save();m.translate(j,n);m.scale(l,i);m.arc(0,0,1,k,k+h,h<0);m.restore()}};g.prototype.fillLinearGradient=function(n){var i=b.toCSSColor(this.readNumber());var k=this.readNumber();var m=this.readNumber();var h=b.toCSSColor(this.readNumber());var j=this.readNumber();var l=this.readNumber();var o=n.createLinearGradient(k,m,j,l);o.addColorStop(0,i);o.addColorStop(1,h);n.fillStyle=o;n.fill()};g.prototype.stroke=function(j){var h=this.readNumber();var i=this.definitions[this.definitions.length-h];j.lineWidth=i.lineWidth;j.lineJoin=i.lineJoin;j.lineCap=i.lineCap;j.strokeStyle=b.toCSSColor(this.readNumber());j.stroke()};g.prototype.def=function(){var i=this.input.peek(0);this.input.skip(1);this.readSeparators();switch(i){case b.TypeDef.TYPE_STROKE_ATTRIBUTE:var k={lineWidth:this.readNumber(),lineCap:b.LINE_CAPS[this.readNumber()],lineJoin:b.LINE_JOINS[this.readNumber()],dashList:this.readNumberArray()};this.definitions.push(k);break;case b.TypeDef.TYPE_TEXT_ATTRIBUTE:var h={fontFamily:this.readString(),fontHeight:this.readNumber(),bold:this.readBoolean(),italic:this.readBoolean()};this.definitions.push(h);break;case b.TypeDef.TYPE_IMAGE_URL:var j={id:this.readString(),url:this.readString()};this.images[j.id]=j.url;break;default:console.warn("Unknown type: "+i);break}this.readSeparators()};g.prototype.readString=function(){this.input.skip(1);var h=0;var k=this.input.peek(h);var j="";while(k!=="\u0000"){if(k==="'"){h++;k=this.input.peek(h);if(k!=="'"){break}}j+=k;h++;k=this.input.peek(h)}this.input.skip(h+1);this.readSeparators();return j};g.prototype.readBoolean=function(){this.readSeparators();var h=this.input.peek(0);this.input.skip(1);this.readSeparators();return h==="1"};g.prototype.readNumber=function(){var k=0;var h="0123456789.-";while(h.indexOf(this.input.peek(k))>=0){k++}var j=this.input.peekString(0,k);this.input.skip(k);this.readSeparators();return parseFloat(j)};g.prototype.readNumberArray=function(){var h=this.readNumber();if(h===0){return[]}var k=new Array(h);for(var j=0;j<h;j++){k[j]=this.readNumber()}return k};g.prototype.readSeparators=function(){var h=0;while(g.isSeparator(this.input.peek(h))){h++}this.input.skip(h)};g.isSeparator=function(i){var h=i.charCodeAt(0);return 1<=h&&h<=32};return g}());return e});define("DS/CATSmmDraw/ViewPoint",["require","exports","DS/CATSmmDraw/Geometry"],function(c,b,d){var a=(function(){function e(h,g,f){this.scale=h;this.tx=g;this.ty=f}e.prototype.clamp=function(i,h){var f=this.copy();if(i){var g=this.transform(i);if(g[0]>h[2]){f.tx=h[2]-i[0]*this.scale}if(g[2]<h[0]){f.tx=h[0]-i[2]*this.scale}if(g[1]>h[3]){f.ty=h[3]-i[1]*this.scale}if(g[3]<h[1]){f.ty=h[1]-i[3]*this.scale}}return f};e.prototype.copy=function(){return new e(this.scale,this.tx,this.ty)};e.prototype.transform=function(h){var f=new Array(h.length);for(var g=0;g<h.length;g+=2){f[g]=h[g]*this.scale+this.tx;f[g+1]=h[g+1]*this.scale+this.ty}return f};e.prototype.invTransform=function(h){var f=new Array(h.length);for(var g=0;g<h.length;g+=2){f[g]=(h[g]-this.tx)/this.scale;f[g+1]=(h[g+1]-this.ty)/this.scale}return f};e.prototype.compose=function(f){return new e(f.scale*this.scale,this.scale*f.tx+this.tx,this.scale*f.ty+this.ty)};e.prototype.invert=function(){return new e(1/this.scale,-this.tx/this.scale,-this.ty/this.scale)};e.prototype.linearize=function(f,g){return new e(this.scale*(1-g)+f.scale*g,this.tx*(1-g)+f.tx*g,this.ty*(1-g)+f.ty*g)};e.prototype.toCssMatrix=function(){if(this.scale>0.98&&this.scale<1.02){return"translate("+Math.round(this.tx)+"px, "+Math.round(this.ty)+"px) scale("+this.scale+")"}return"translate("+this.tx+"px, "+this.ty+"px) scale("+this.scale+")"};e.prototype.applyToElement=function(f){f.style.transformOrigin="0px 0px 0px";f.style.msTransformOrigin="0px 0px 0px";f.style.webkitTransformOrigin="0px 0px 0px";var g=this.toCssMatrix();f.style.transform=g;f.style.msTransform=g;f.style.webkitTransform=g};e.prototype.applyToGc=function(f){f.transform(this.scale,0,0,this.scale,this.tx,this.ty)};e.focusOnRectangle=function(m,p,o,l,f){if(l===void 0){l=true}if(f===void 0){f=Number.MAX_VALUE}var r=m[2]-m[0];var j=m[3]-m[1];var g=p[2]-p[0];var n=p[3]-p[1];var h=j/n;var t=r/g;var i;if(l){i=t<h?t:h}else{i=t>h?t:h}if(i>f){i=f}var k=d.getRectanglePoint(m,o);var q=d.getRectanglePoint(p,o);var s=d.vector([q[0]*i,q[1]*i],k);return new e(i,s[0],s[1])};e.focusOnRectangleWithAreaRatio=function(l,n,i,g){if(g===void 0){g=null}var p=l[2]-l[0];var j=l[3]-l[1];var f=n[2]-n[0];var m=n[3]-n[1];var h=Math.sqrt((p*j)/(i*i*f*m));if(g!==null){h=Math.max(h,g)}var k=d.getRectanglePoint(l,d.Direction.CENTER);var o=d.getRectanglePoint(n,d.Direction.CENTER);var q=d.vector([o[0]*h,o[1]*h],k);return new e(h,q[0],q[1])};e.prototype.animate=function(h,k,f){var l=this;var i=null;var j={stop:false,duration:k,targetViewPoint:h,onChange:f,cancel:function(){j.stop=true}};var g=function(o){if(j.stop){return}if(i===null){i=o}var n=o-i;var m=Math.log(Math.exp(n/j.duration));if(m<1){j.onChange(l.linearize(j.targetViewPoint,m));window.requestAnimationFrame(g)}else{j.onChange(j.targetViewPoint)}};window.requestAnimationFrame(g);return j};return e}());return a});define("DS/CATSmmDraw/ZoomManager",["require","exports","DS/CATSmmDraw/Geometry","DS/CATSmmDraw/ViewPoint"],function(d,b,h,a){var g=(function(){function i(j){this.element=j;this.viewPoint=new a(1,0,0);this.panning=false;this.pinching=false;this.touchListenerAttached=false;this.canMoveBackground=true;this.canInitiatePan=function(){return true};this.canInitiateZoom=function(){return true}}i.prototype.resetAnimation=function(){if(this.currentAnimation){this.currentAnimation.cancel();this.currentAnimation=null}};i.prototype._getPaddedVisibleBounds=function(){var k=this.visibleBounds;if(!k){k=[0,0,this.element.clientWidth,this.element.clientHeight]}var j=0.1;return h.expandRectangle(k.slice(),-(k[2]-k[0])*j,-(k[3]-k[1])*j)};i.prototype.attachListeners=function(){this._attachMouseListeners();this._attachTouchListeners()};i.prototype.detachListeners=function(){this.element.removeEventListener("wheel",this.mouseWheelHandler);this.element.removeEventListener("mousewheel",this.mouseWheelHandler);this.element.removeEventListener("mousedown",this.onMouseDown);this.element.removeEventListener("touchstart",this.onTouchStart,{passive:false});this.resetAnimation()};i.prototype._getPoint=function(k){var j=this.element.getBoundingClientRect();return[k.clientX-j.left,k.clientY-j.top]};i.prototype._attachMouseListeners=function(){var j=this;this.onMouseDown=function(l){var k=j._getPoint(l);j.canMoveBackground=j.canInitiatePan(k,l)&&!l.shiftKey&&!l.ctrlKey;if(j.canMoveBackground){l.preventDefault();document.addEventListener("mousemove",j.onMouseMove);document.addEventListener("mouseup",j.onMouseUp);j._handlePinchStop();j._handlePanStart(k[0],k[1])}};this.onMouseMove=function(l){if(j.canMoveBackground){l.preventDefault();var k=j._getPoint(l);j._handlePan(k[0],k[1])}};this.onMouseUp=function(k){document.removeEventListener("mouseup",j.onMouseUp);document.removeEventListener("mousemove",j.onMouseMove);k.preventDefault();j._handlePinchStop();j._handlePanStop()};this.mouseWheelHandler=function(o){var k=j._getPoint(o);if(j.canInitiateZoom(k,o)){var n=void 0;if(j.currentAnimation){n=j.currentAnimation.targetViewPoint;j.currentAnimation.cancel()}else{n=j.viewPoint}var l=n.invTransform(k);if(j.drawBounds&&h.rectangleContainsPoint(j.drawBounds,l[0],l[1])===false){l=h.projectPointOnRectangle(l[0],l[1],j.drawBounds)}var p=c(o);var m=new a(p*n.scale,n.tx+(l[0]-l[0]*p)*n.scale,n.ty+(l[1]-l[1]*p)*n.scale);m=m.clamp(j.drawBounds,j._getPaddedVisibleBounds());j.animate(m,k,200);o.preventDefault()}};this.element.addEventListener("wheel",this.mouseWheelHandler);this.element.addEventListener("mousewheel",this.mouseWheelHandler);this.element.addEventListener("mousedown",this.onMouseDown)};i.prototype.animate=function(j,m,l){var n=this;var k;if(this.currentAnimation){k=this.currentAnimation.targetViewPoint;this.currentAnimation.cancel()}else{k=this.viewPoint}this.currentAnimation=k.animate(j,l,function(o){var p=n.viewPoint.copy();n.viewPoint=o;e(n.element,i.EventName,{previousViewPoint:p,viewPoint:o,focusPoint:m});if(o===j){n.currentAnimation=null}})};i.prototype._attachTouchListeners=function(){var l=this;var j=function(o){if(o.cancelable){o.preventDefault()}var n=l._getPoint(o.touches[0]);if(o.touches.length===1){l._handlePan(n[0],n[1])}else{if(o.touches.length===2){var m=l._getPoint(o.touches[1]);l._handlePinch(n[0],n[1],m[0],m[1])}}};var k=function(n){if(n.touches.length===0&&l.panning){l._handlePanStop();document.body.removeEventListener("touchmove",j,{passive:false});document.body.removeEventListener("touchend",k);document.body.removeEventListener("touchcancel",k);l.touchListenerAttached=false}else{if(n.touches.length===1){l._handlePinchStop();var m=l._getPoint(n.touches[0]);l._handlePanStart(m[0],m[1])}}};this.onTouchStart=function(o){o.preventDefault();l.canMoveBackground=o.touches.length>1||l.canInitiatePan([o.touches[0].clientX,o.touches[0].clientY],o);if(!l.touchListenerAttached&&l.canMoveBackground){document.body.addEventListener("touchmove",j,{passive:false});document.body.addEventListener("touchend",k);document.body.addEventListener("touchcancel",k);l.touchListenerAttached=true}var n=l._getPoint(o.touches[0]);if(o.touches.length===1){l._handlePanStart(n[0],n[1])}else{if(o.touches.length===2){var m=l._getPoint(o.touches[1]);l._handlePinchStart(n[0],n[1],m[0],m[1],o)}}};this.element.addEventListener("touchstart",this.onTouchStart,{passive:false})};i.prototype._handlePanStart=function(j,k){this.panning=true;this.panPoint=[j,k]};i.prototype._handlePan=function(l,n){if(this.panning){var j=l-this.panPoint[0],o=n-this.panPoint[1];this.panPoint=[l,n];var m=this.viewPoint.invTransform(this.panPoint);var k=this.viewPoint.copy();this.viewPoint.tx+=j;this.viewPoint.ty+=o;this.viewPoint=this.viewPoint.clamp(this.drawBounds,this._getPaddedVisibleBounds());e(this.element,i.EventName,{previousViewPoint:k,viewPoint:this.viewPoint,focusPoint:m})}};i.prototype._handlePanStop=function(){this.panning=false};i.prototype._handlePinchStart=function(m,o,l,n,q){var p=[(m+l)/2,(o+n)/2];if(this.canInitiateZoom(p,q)){this.pinching=true;var k=l-m;var j=n-o;this.touchStartDistance=k*k+j*j;this.startScale=this.viewPoint.scale;this.startTx=this.viewPoint.tx;this.startTy=this.viewPoint.ty;this.startPoint=p}};i.prototype._handlePinch=function(m,u,l,s){if(this.pinching){var n=this.startPoint;var o=void 0,r=void 0,w=void 0;var v=s-u;if(this.touchStartDistance===0){r=this.startScale+v*0.01;o=r/this.startScale;if(this.drawBounds){var j=this.viewPoint.transform(this.drawBounds);if(!h.rectangleContainsPoint(j,n[0],n[1])){n=h.projectPointOnRectangle(n[0],n[1],j)}}w=n}else{var x=l-m;var p=x*x+v*v;o=Math.sqrt(p/this.touchStartDistance);r=this.startScale*o;w=[(l+m)/2,(s+u)/2]}if(r>0){var k=this.viewPoint.copy();this.viewPoint.tx=w[0]-(n[0]-this.startTx)*o;this.viewPoint.ty=w[1]-(n[1]-this.startTy)*o;this.viewPoint.scale=r;this.viewPoint=this.viewPoint.clamp(this.drawBounds,this._getPaddedVisibleBounds());var q=this.viewPoint.invTransform(n);e(this.element,i.EventName,{previousViewPoint:k,viewPoint:this.viewPoint,focusPoint:q})}}};i.prototype._handlePinchStop=function(){this.pinching=false};i.EventName="syc-viewpoint-change";return i}());function f(i){if(i.deltaY){switch(i.deltaMode){case WheelEvent.DOM_DELTA_LINE:return -i.deltaY*40;case WheelEvent.DOM_DELTA_PAGE:return -i.deltaY*100*40;case WheelEvent.DOM_DELTA_PIXEL:return -i.deltaY}}else{if(typeof i.detail==="number"){return -i.detail*40}else{if(i.wheelDelta){return i.wheelDelta}}}console.warn("cannot compute wheel distance");return 1}function c(j){var i=f(j);var k=Math.abs(i)/900;k=(1+k)*(1+k);k=i<0?1/k:k;return k}function e(l,j,k){var i=document.createEvent("CustomEvent");i.initCustomEvent(j,true,true,k);l.dispatchEvent(i)}return g});