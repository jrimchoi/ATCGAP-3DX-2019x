define("DS/i3DXCompassMembers/Utils/SpriteManager",["UWA/Core","UWA/Class"],function(c,a){var b="{0}/api/media/streammediasprite/idList/{1}?{2}";return a.extend({spriteParams:[],spriteCache:[],url:null,init:function(d){this.swymUrl=d.url;this.spriteParams=[];this.spriteCache=[]},addItem:function(d){this.spriteParams.push(d)},addCache:function(d){this.spriteCache.push(d)},spritifyElement:function(g,f){var e=100*this.spriteParams.length,d=(100/(this.spriteParams.length-1))*f;g.setStyles({"background-image":'url("'+this.getUrl()+'")',"background-size":"100% "+e+"%","background-position":"0px "+d+"%",height:"100%"})},getUrl:function(){if(!this.url){this.url=c.String.format(b,this.swymUrl,this.spriteParams.join("="),this.spriteCache.join(""))}return this.url}})});define("DS/i3DXCompassMembers/Views/UserView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView","DS/i3DXCompassCore/Utils","i18n!DS/i3DXCompassMembers/assets/nls/i3DXCompassMembers","UWA/Event"],function(g,b,f,e){var d="Contractor",c="-1",a="3";return b.extend({tagName:"div",name:"platform-management",extendedEvents:false,getFooterText:function(){var i=null,h=this.model;if(h.isCasual()){i=e.get("(Casual usage)").format(h.get("casual"))}return i!==null?{tag:"div","class":"contractor-text",text:i}:null},getPendingText:function(){var h=null;if(!this.model.get("active")){h={tag:"span",text:" "+e.get("(Pending)")}}return h},getRoleLabel:function(){var i;if(!this.model.isDeny()&&this.model.isContractor()){i={id:c,name:e.get(d)}}else{var h=this.model.get("role");i=g.Array.detect(this.options.roles,function(j){return j.id===h})}return(i&&i.name)||""},render:function(){var h=this.model;this._parent();this.container.getElement(".tile-content").setContent([{tag:"span","class":(!this.model.isDeny()&&this.model.isContractor())?f.getRoleColor(a,true):f.getRoleColor(h.get("role"),true),text:this.getRoleLabel()},this.getPendingText(),this.getFooterText()]);this.container.addClassName("user-box grid");this.container.setAttribute("data-id",h.get("id"));this.container.setAttribute("data-casual",h.get("casual"));this.container.setAttribute("data-type","user");this.container.setAttribute("data-cross-company",!h.get("licensed"));this.extendedEvents=this._initExtendedEvents();this._injectPresence();return this},destroy:function(){if(this.container&&this.container.getElement(".tile-sub-container")){this.container.getElement(".tile-sub-container").removeEvent("click")}return this._parent()},_injectPresence:function(){var j=this,h=this.model,i=g.createElement("div",{styles:{position:"absolute",bottom:-5,right:-3}});i.inject(this.container.getElement(".platform-management-header"));if(f.isBetaModeActivated("RTPresence")){f.getParentModule("DS/RTPresenceAPI/RTPresenceAPI",function(k){new k({login:h.get("id"),button:false,username:h.getUserFullName(),tenant:j.options.platform,content:i})})}},_initExtendedEvents:function(){var h=this;this.container.getElement(".tile-sub-container").addEvent("click",function(i){if(!h._isActionElement(i.target)&&!h.container.hasClassName("disabled")){if(h.isSelected()){h.unSelect()}else{h.select()}if(h.options.onSelect){h.options.onSelect(h.getContent(),h.model)}}});return true},_isActionElement:function(h){return h.getParent(".actions-inline-container")||h.hasClassName("actions-inline-container")}})});define("DS/i3DXCompassMembers/Views/UserRowView",["UWA/Core","UWA/Class/View","DS/i3DXCompassCore/Utils","DS/UIKIT/Input/Toggle","DS/i3DXCompassCore/Model/PreferencesModel","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","UWA/Event","i18n!DS/i3DXCompassMembers/assets/nls/i3DXCompassMembers"],function(e,b,f,i,d,h,a,k,l){var j="-1",g="3",c="Contractor";return b.extend({tagName:"tr",domEvents:{click:"_onClick"},setup:function(){this.firstRender=true;this.listenTo(this.model,{onChange:this.render});this.container.setAttribute("data-type","user");this.container.setAttribute("data-id",this.model.get("id"));this.container.setAttribute("data-cross-company",!this.model.get("licensed"));this.container.setAttribute("data-casual",this.model.get("casual"));return this._parent.apply(this,arguments)},render:function(){this.container.setContent(this.createContent());this._injectPresence();return this},getRoleLabel:function(){var n;if(!this.model.isDeny()&&this.model.isContractor()){n={id:j,name:l.get(c)}}else{var m=this.model.get("role");n=e.Array.detect(this.options.roles,function(o){return o.id===m})}return(n&&n.name)||""},createImage:function(){var m;if(this.firstRender&&this.options.getSwymUrl()!==""&&d.shouldLoadPicture()){m=f.getAsset("s.gif");this.firstRender=false}else{m=this.model.getProfile(d.shouldLoadPicture(),this.options.getSwymUrl())}return m},_onClick:function(o){var m=this.getContent(),n=!m.hasClassName("selected");k.stop(o);m.toggleClassName("selected",n);this.toggleSelect.setCheck(n);this.options.onSelect.call(this,m,this.model)},createContent:function(){var m=this.model,n=this.getFooterText();this.toggleSelect=new i({className:"primary inline",type:"checkbox",name:"users[]",value:m.get("id"),id:m.get("id"),label:""});return[{tag:"td",html:[this.toggleSelect,{"class":"img-wrapper",html:{tag:"img",styles:{height:"100%"},src:this.createImage()}},this.model.get("licensed")===false?{tag:"i","class":"fonticon fonticon-key"}:null]},{tag:"td","class":"text-ellipsis",html:this.model.get("active")&&m.get("firstname")?e.String.ucfirst(m.get("firstname")):[{tag:"span",text:l.get("Pending")},{tag:"span",html:n}]},{tag:"td","class":"text-ellipsis",html:this.model.get("active")&&m.get("lastname")?[{tag:"span",text:e.String.ucfirst(m.get("lastname"))},{tag:"span",html:n}]:""},{tag:"td",html:[{tag:"span","class":(!this.model.isDeny()&&this.model.isContractor())?f.getRoleColor(g,true):f.getRoleColor(m.get("role"),true),text:this.getRoleLabel()}]},{tag:"td","class":"text-ellipsis",text:m.get("email")},{tag:"td",html:this._buildAction()}]},_injectPresence:function(){var o=this,m=this.model,n=e.createElement("div",{"class":"presence-wrapper"});n.inject(this.container.getElement(".img-wrapper"));if(f.isBetaModeActivated("RTPresence")){f.getParentModule("DS/RTPresenceAPI/RTPresenceAPI",function(p){new p({login:m.get("id"),button:false,username:m.getUserFullName(),tenant:o.options.platform,content:n})})}},getFooterText:function(){var n=null,m=this.model;if(m.isCasual()){n=e.String.format(l.get("(Casual usage)"),m.get("casual"))}return n!==null?{tag:"span","class":"contractor-text",text:n}:null},_buildAction:function(){var o=this,m=this.model,n;if(m.actions.length===1){n=m.actions.map(function(q){var p=e.createElement("div",{tag:"div","class":"action-container single-action",html:{"class":"action-icon-wrapper",html:{tag:"i","class":q.icon}},events:{click:function(r){k.stop(r);o.options.onActionClick(q,o,r)}}});new h({position:"bottom",target:p,body:q.title});return p})}else{n=e.createElement("div",{tag:"div","class":"action-container single-action",html:{"class":"action-icon-wrapper",html:{tag:"i","class":"fonticon fonticon-down-open"}},events:{click:function(p){k.stop(p)}}});new a({target:n,items:m.actions.map(function(p){return{text:p.title,icon:p.icon,handler:function(q){o.options.onActionClick(p,o,q)}}})})}return n}})});define("DS/i3DXCompassMembers/Model/TagModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(b,a){return a.extend({url:"user/tag",parse:function(c){return c}})});define("DS/i3DXCompassMembers/Utils/TaggerManager",["UWA/Core","UWA/Class","DS/TagNavigatorProxy/TagNavigatorProxy","DS/i3DXCompassMembers/Model/TagModel","i18n!DS/i3DXCompassMembers/assets/nls/i3DXCompassMembers"],function(e,a,d,c,b){return a.singleton({model:new c(),memberList:null,setup:function(f){if(f){this.taggerProxy=d.createProxy({widgetId:f.id,filteringMode:"WithFilteringServices",proxyDisplayName:"PlatformManagement-"+f.id,events:{addFilterSubjectsListener:this._addFilterSubjectsListener.bind(this)}})}return this},fetch:function(h,g){var f=this;this.listRoles=h;this.memberList=g;if(this.taggerProxy){this.model.fetch({data:{platform:this.memberList.collection.options.data.platform},onComplete:function(){f._buildTags()}})}return this},_buildTags:function(){var g=this.taggerProxy,h=g.getCurrentFilter(),f=false;if(h&&e.is(h.allfilters,"object")){f=Object.keys(h.allfilters).length>0}if(g&&h&&!f){g.setSubjectsTags(this._getTags())}},_getTags:function(){var i=this,g=this.model,f={},h={roles:{0:g.get("admin"),1:g.get("member"),2:g.get("denied")},status:{0:g.get("active"),1:g.get("pending")},agreements:{0:g.get("employee"),1:g.get("contractor")}};this.listRoles.roles.forEach(function(j){f=e.merge(f,i._buildTag(h.roles[j.id],j.name,b.get("User rights"),"role-"+j.id))});this.listRoles.status.forEach(function(j){f=e.merge(f,i._buildTag(h.status[j.id],j.name,b.get("Status"),"status-"+j.id))});this.listRoles.agreements.forEach(function(j){if(j.id!=="0"){f=e.merge(f,i._buildTag(h.agreements[j.id],j.name,b.get("Agreement"),"agreement-"+j.id))}});return f},_buildTag:function(k,g,j,l){var h,f={};for(h=0;h<k;h++){f[l+"-"+h]=[{object:l,sixw:"ds6w:what",field:"owner",dispValue:g}]}return f},_resetCollectionFilter:function(){this.memberList.collection.setParams({access:null,status:null,agreement:null});this.memberList.collection.setOffset(null)},_convertFilterToParams:function(j){var k,g,i=[],h=[],f=[];if(e.is(j.allfilters)&&e.is(j.allfilters["ds6w:what"])&&j.allfilters["ds6w:what"].length>0){j.allfilters["ds6w:what"].forEach(function(l){g=l.object;if(l.object.contains("role")){i.push(g.replace("role-",""))}else{if(l.object.contains("status")){f.push(parseInt(g.replace("status-",""),10))}else{if(l.object.contains("agreement")){h.push(g.replace("agreement-",""))}}}});if(i.length>0||f.length>0||h.length>0){k={access:i.join(",")||null,status:f.join(",")||null,agreement:h.join(",")||null}}}return k},syncFilter:function(h){var g,f=this.taggerProxy&&this.taggerProxy.getCurrentFilter?this.taggerProxy.getCurrentFilter():"";this.memberList=h;if(f){g=this._convertFilterToParams(f);if(f.allfilters&&Object.keys(f.allfilters).length>0&&g===null){this.memberList.collection.setQuery(JSON.stringify(f.allfilters))}else{this.memberList.collection.setParams(g||{})}}},_addFilterSubjectsListener:function(f){var g;this._filter=f;this._resetCollectionFilter();g=this._convertFilterToParams(f);if(Object.keys(f.allfilters).length>0&&g===null){this.memberList.collection.setQuery(JSON.stringify(f.allfilters))}else{this.memberList.collection.setParams(g||{})}this.memberList.refresh()}})});define("DS/i3DXCompassMembers/MemberList",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Controls/Pager","DS/UIKIT/Touch","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/IconDropdown","DS/UIKIT/Iconbar","DS/W3DXComponents/Collections/ActionsCollection","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassCore/Utils","DS/i3DXCompassCore/Model/PreferencesModel","DS/i3DXCompassMembers/Views/UserView","DS/i3DXCompassCmp/Views/TileAddView","DS/i3DXCompassCore/Controls/PlatformNotify","DS/i3DXCompassCore/Collection/MemberCollection","DS/i3DXCompassMembers/Utils/SpriteManager","DS/i3DXCompassMembers/Utils/TaggerManager","DS/i3DXCompassCore/Model/UserRightModel","DS/i3DXCompassMembers/Views/UserRowView","DS/i3DXCompassCmp/Controls/Input/Text","DS/WebappsUtils/WebappsUtils","i18n!DS/i3DXCompassMembers/assets/nls/i3DXCompassMembers"],function(k,x,o,y,s,z,q,w,l,c,m,f,g,j,n,u,t,e,d,v,i,r,b,h,p){var a="member-list-wrapper";return x.extend({profileUrl:null,currentUserId:f.getUser().login,forceRefreshView:false,touchPagerEvent:null,setup:function(A){this._parent(A);this.collection=new e();this.buildContainer()},search:function(A){this.collection.setOffset(0);this.collection.setQuery(A);this.refresh()},refresh:function(A){this.setOptions(A);if(A&&A.params){this.collection.setParams(A.params)}this.buildContainer()},setTitle:function(A){if(this.getBody().getElement("h5 span")){this.getBody().getElement("h5 span").setText(k.String.format(p.get("Members | {0}"),A))}},render:function(){if(this.collection.getMaxLimit()>0){this.getBody().setContent(this.buildContent())}else{if(this.collection.getQuery()===null||this.forceRefreshView){this.getBody().setContent(this.buildContent())}else{this.collection.setQuery(null);this.setTitle(p.get("No result found"))}}this.unmask();this.forceRefreshView=false;if(this.options.onRefresh){this.options.onRefresh()}},getPersistedData:function(B){var D=this,A=0,C=function(){A++;if(A===2){v.fetch(D.listRoles,D);D.render();if(B){g.scrollToElement("."+a)}}};new i().fetch({onComplete:function(E,F){D.roles=F.roles;D.listRoles=F;C()}});v.syncFilter(D);this.collection.fetch({onComplete:function(){C()},onFailure:function(){C()}})},getSwymUrl:function(){if(this.options.platform.get("swym")!==""){this.profileUrl=this.options.platform.get("swym")}else{if(!this.profileUrl&&this.options.platform.collection){this.profileUrl=this.options.platform.collection.at(0).get("swym")}else{this.profileUrl=""}}return this.profileUrl},buildContainer:function(){var A=this;if(!this.elements.container){this.elements.container=k.createElement("div",{"class":a});A.elements.container.setContent({"class":"empty-body"})}this.mask();if(this.options.platform&&this.options.platform!==null){j.fetch({onComplete:function(){A.collection.setLimit(j.get("membersMaxPerPage"));A.collection.setSortDirection(j.get("membersSortDirection"));A.collection.setSortField(j.get("membersSortField"));A.collection.setPlatform(A.options.platform.getId());A.getPersistedData()}})}},buildTag:function(E,B,D,F){var C,A={};for(C=0;C<E;C++){A[F+"-"+C]=[{object:F,sixw:"ds6w:what",field:"owner",dispValue:B}]}return A},buildContent:function(){var A=[];A.push(this.buildRoleFilter());A.push(this.buildTitle(this.collection.getMaxLimit()));A.push({"class":"pm-grid-container "+(j.isGridLayout()?"layout-grid":"layout-table"),html:[j.isGridLayout()?this.buildTiles():this.createTableView(),this.buildPager()]});this.initTouchPager();return A},buildAddTile:function(){return new u({lazyLoading:false,model:new o({fonticon:"fonticon fonticon-user-add fix-alignement",title:p.get("Invite members"),action:function(){this.dispatchEvent("onInviteClick")}.bind(this)}),name:"platform-management",mapping:{}}).render()},createTableView:function(){var C=this,A=new d({url:C.getSwymUrl()}),B=this.collection.map(function(D){A.addItem(D.getSpriteItem());A.addCache(D.isContractor()===true?1:0);if(typeof C.options.buildTileActions==="function"){D.actions=C.options.buildTileActions()}return new r({model:D,platform:C.options.platform,roles:C.roles,getSwymUrl:C.getSwymUrl.bind(C),onSelect:C.options.onSelect,onActionClick:function(){this.dispatchEvent("onActionClick",arguments)}.bind(this)}).render()});if(C.getSwymUrl()!==""&&j.shouldLoadPicture()){B.forEach(function(E,D){A.spritifyElement(E.container.getElement("img"),D)})}return[new q({value:p.get("Invite members"),icon:"user-add",className:"primary",events:{onClick:function(){this.dispatchEvent("onInviteClick")}.bind(this)}}),{tag:"table","class":"table",html:[{tag:"thead",html:[{tag:"td"},{tag:"td",text:p.get("First Name")},{tag:"td",text:p.get("Last Name")},{tag:"td",text:p.get("User rights")},{tag:"td",text:p.get("Email")},{tag:"td",text:p.get("Details")}]},{tag:"tbody",html:B}]}]},buildTiles:function(){var B=[],C=this,A=new d({url:C.getSwymUrl()});B.push(C.buildAddTile());this.collection.forEach(function(D){B.push(C.buildTile(D));A.addItem(D.getSpriteItem());A.addCache(D.isContractor()===true?1:0)});if(C.getSwymUrl()!==""&&j.shouldLoadPicture()){B.forEach(function(E,D){if(D!==0){A.spritifyElement(E.container.getElement(".tile-header img"),D-1)}})}return B},buildTile:function(B){var C=this,A,D=true;if(typeof this.options.buildTileActions==="function"){B.actions=new m(this.options.buildTileActions())}if(typeof C.options.manageCasualActivation==="function"){this.listenTo(B,{"onChange:licensed":function(){setTimeout(function(){C.options.manageCasualActivation()},1000)}})}A=new n({lazyLoading:false,model:B,platform:C.options.platform,roles:this.roles,mapping:{title:function(){return this.model.getUserFullName()+(this.model.get("licensed")===false?'<i class="fonticon fonticon-key"></i>':"")},image:function(){var E;if(D&&C.getSwymUrl()!==""&&j.shouldLoadPicture()){E=h.getWebappsAssetUrl("i3DXCompassCore","s.gif");D=false}else{E=this.model.getProfile(j.shouldLoadPicture(),C.getSwymUrl())}return E}},onSelect:C.options.onSelect,events:{onActionClick:function(){this.dispatchEvent("onActionClick",arguments)}.bind(this)}});return A.render()},buildTitle:function(A){return{tag:"h5",html:[{tag:"i","class":"fonticon fonticon-users"},{tag:"span",text:k.String.format(p.get("Members | {0}"),A)}]}},hasMixedCasualType:function(){var B=this.getBody().getElement('.platform-management-container[data-casual]:not([data-casual="0"])'),A=this.getBody().getElement('.platform-management-container:not([data-casual="0"])');return B!==null&&A!==null},hasMixedCrossCompanyType:function(){var A=this.getBody().getElement('.platform-management-container[data-cross-company="true"]'),B=this.getBody().getElement('.platform-management-container[data-cross-company="false"]');return A!==null&&B!==null},_manageSelectionFilter:function(E,D){var C=this,A=C.elements.container.getElements('[data-type="user"] input'),B=C.elements.container.getElement('[data-action="select-mode"]');D.elements.container.removeClassName("selected");if(D.action==="select-all"){if(C.hasMixedCasualType()){new w({closable:true,renderTo:g.getDocument()}).confirm(p.get("You cannot select different types of casual member"),p.get("Information"))}else{if(C.hasMixedCrossCompanyType()){new w({closable:true,renderTo:g.getDocument()}).confirm(p.get("You cannot select different types of assigned member"),p.get("Information"))}else{B.removeClassName("fonticon-mouse-pointer-check").addClassName("fonticon-files-check").getParent("li").addClassName("item-active");C.elements.container.getElements('[data-type="user"]').invoke("addClassName","selected");if(A){A.forEach(function(F){F.checked=true})}}}}else{B.removeClassName("fonticon-files-check").addClassName("fonticon-mouse-pointer-check");C.elements.container.getElements('[data-type="user"].selected').invoke("removeClassName","selected");if(A){A.forEach(function(F){F.checked=false})}C.options.manageCasualActivation()}C.options.onSelect()},buildRoleFilter:function(){var B=this,A=new b({isCollapsable:true,minChar:3,attributes:{placeholder:p.get("Search Members"),value:this.collection.getQuery()||"",events:{keyup:function(){B.search(this.value)}}}}),C=new c({items:[{fonticon:"mouse-pointer-check",text:p.get("Manage Selection"),innerComponent:{type:"icondropdown",options:{items:[{action:"select-all",fonticon:"files-check",description:p.get("Select All"),handler:this._manageSelectionFilter.bind(this)},{action:"deselect-all",fonticon:"files-times",description:p.get("Deselect All"),handler:this._manageSelectionFilter.bind(this)}]}}},{fonticon:j.isGridLayout()?"th-list-alt fonticon-interact":"th-list fonticon-interact",text:p.get("Switch View"),handler:function(){j.setLayout(j.isGridLayout()?"table":"grid");g.getWidget().dispatchEvent("onLoad")}}]});C.elements.container.getElement(".fonticon").setAttribute("data-action","select-mode");return[{styles:{"padding-right":j.isGridLayout()?15:8,"float":"right"},html:C},{styles:{"float":"right"},html:A}]},initTouchPager:function(){var B=this,A;if(!this.touchPagerEvent&&B.pager){this.touchPagerEvent=true;A=new s(B.getBody());A.on("swipeleft",function(){if(B.collection.hasNext()){B.collection.setOffset(B.collection.getNextOffset());B.pager.setOffset(B.collection.getOffset())}});A.on("swiperight",function(){if(B.collection.hasPrevious()){B.collection.setOffset(B.collection.getPreviousOffset());B.pager.setOffset(B.collection.getOffset())}})}},buildPager:function(){var B=this,A=this.collection.getMaxLimit();if(A>B.collection.getLimit()){this.pager=new y({limit:B.collection.getLimit(),offset:B.collection.getOffset(),type:1,pageLinks:10,max:A,showPageLinks:true,length:A,events:{onOffsetChange:function(C){B.mask();B.collection.setOffset(C);B.getPersistedData(true)}}})}else{this.pager=null}return this.pager},getBody:function(){if(!this.content){this.content=this.elements.container}return this.content},mask:function(){if(!this.isMasked()){z.mask(this.getBody());this.masked=true}},unmask:function(){if(this.isMasked()){z.unmask(this.getBody());this.masked=false}},isMasked:function(){return this.masked}})});