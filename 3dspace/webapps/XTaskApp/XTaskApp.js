define("DS/XTaskApp/Models/XTaskAppTypeDictionary",["UWA/Core","DS/E6WCommonApps/Models/RDFTaskModel","DS/CollaborativeTasks/Models/RDFTasksWorkscopeModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/PersonRDFModel","DS/RDFFoundation/Models/ComponentProxyModel","DS/E6WCommonApps/Models/ConstraintModel","DS/E6WCommonApps/Models/MilestoneModel","DS/E6WCommonApps/Models/CalendarModel"],function(e,h,a,c,b,i,f,g,d){e.merge(c.typeDictionary,{mapping:[{key:"dsxplan:WorkPackageVersion",type:a},{key:"dsxplan:WorkPackage",type:a},{key:"dsplan:WorkPackage",type:a},{key:"dsplan:Task",type:h},{key:"dsxplan:Task",type:h},{key:"dsxplan:TaskVersion",type:h},{key:"foaf:Person",type:b},{key:"Person",type:b},{key:"dscom:ComponentProxy",type:i},{key:"dsplan:TemporalConstraint",type:f},{key:"dsxplan:TemporalConstraint",type:f},{key:"dsplan:Milestone",type:g},{key:"dsxplan:Milestone",type:g},{key:"dsxplan:MilestoneVersion",type:g},{key:"dsplan:Calendar",type:d}],masksStrength:{"dsplan:MVMask.Task.CollaborativeTask.siblings":2,"dsplan:MVMask.WorkPackage.Basic":15,"dsplan:MVMask.WorkPackage.CollaborativeTasks":29,"dsplan:MVMask.WorkPackage.Complex":111,"dsplan:MVMask.Task.Property":235,"dsplan:MVMask.Task.Basic":42,"dsplan:MVMask.Task.Complex":53,"dsplan:MVMask.Task.CollaborativeTasks.Complex":57}});return c.typeDictionary});define("DS/XTaskApp/Models/ScopeModelContainer",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Class/Listener","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Collections/ResultCollection","DS/Foundation2/Models/ReferenceModel","DS/Foundation2/FoundationV2Data","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/WorkscopeModel","DS/E6WCommonApps/XTaskScope","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/RDFFoundation/FederatedSearchUtil","DS/CollaborativeTasks/Models/RDFTasksWorkscopeModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/E6WCommonAppsConstants"],function(i,w,o,h,j,b,q,s,c,g,x,y,e,a,p,n,u,f){var m=function(){return s.getWidgetConstant.apply(this,arguments)};var l=["dsxplan:ProjectVersion","dsxplan:WorkPackageVersion"];var v=w.extend(o,h,{_uwaClassName:"scopeModelContainer",init:function(z){this._collection=z.collection;this.collection=this._collection;this._scope=undefined},get:function(A){var z;if(A==="scope"){z=this._scope}else{if(A==="canEdit"){z=true}}return z},add:function r(F,E,B){var C=[];var A=i.clone(B||{},false);if(this.getScope()&&this.getScope().id===E){return C}if(A.detailedObjects){A.detailedObject=A.detailedObjects[0]}var D=u.getObjectDataFromDropSearchOrTypeAhead(A)||{};var z=A.isRDF||D.serviceId===f.SERVICE_3DPLAN;if(!z){return this._addNonRDFScope(E,A)}else{return this._addRDFScope(E,B,D)}},_addNonRDFScope:function(C,B){var A={urlParam:"$fields=collabSpace"};var z=this.collection.getRelatedObject("scopes",C,undefined,undefined,A);if(B.scopeType){z.set("type",B.scopeType)}if(z.get("type")||B.dontCheckTypes){return this._onModelLoaded(z,B)}else{this.listenToOnce(z,"onChange",function(){this._onModelLoaded(z,B)})}return undefined},_addRDFScope:function(D,C,B){var A=i.clone(C||{},false);var z=c.getObjectForAdding(n,D,{mask:"dsplan:MVMask.WorkPackage.CollaborativeTasks.Basic",attrs:{"dsxplan:jsType":B.type}});A.dontCheckTypes=true;if(z.fetching){this.listenToOnce(z,"onSync",function(){this._onModelLoaded(z,A)})}else{return this._onModelLoaded(z,A)}return undefined},_onModelLoaded:function(D,C){var F=[];var B=i.clone(C||{},false);if(!B.dontCheckTypes){var G=this.collection.scopesTypes()+","+this.collection.projectTypes();var A=(G&&G.split(/,|\n/))||[];var z=A.indexOf(D.get("type"));if(z===-1){if(i.is(B.onFailure)){B.onFailure()}return F}}var E=this.getScope();B.silent=true;if(E&&E===D){return F}this.setScope(D,B);this._fireRelationshipChangeEvents("scope",C);return[D]},toJSON:function k(A){var C=this.getScope();var z=true;var B={canEdit:z};if(C){B.scope=A&&A.dataForRendering?C.dataForRendering(A):C.toJSON(A)}return B},dataForRendering:function(A){var z=i.clone(A||{},false);z.dataForRendering=true;return this.toJSON(z)},remove:function d(D,A,z){var B=this;var C=function(){var E=B.getScope();B.setScope(null);if(E){B._fireRelationshipChangeEvents(D,z)}};if(this.confirmRemoveScope){this.confirmRemoveScope(C)}else{C()}},_fireRelationshipChangeEvents:function(){return q.prototype._fireRelationshipChangeEvents.apply(this,arguments)},_use3DPlanInSearch:function(){return y.hasAccess("3dplan")&&enoviaServer.tenant.toLowerCase()!=="onpremise"},_getDropTypes:function(){var A=this.collection.scopesTypes()+","+this.collection.projectTypes();var z={"3dspace":A.split(",")};if(y.hasAccess("3dplan")){z["3dplan"]=l}return z},_getSearchSource:function(){var z=["3dspace"];if(this._use3DPlanInSearch()){z.push("3dplan")}return p.filterSearchSources(z)},_getSearchSourceTypes:function(){var z=this.collection.scopesTypesForSearch()+","+this.collection.projectTypesForSearch();var A={"3dspace":z.split(",")};if(this._use3DPlanInSearch()){A["3dplan"]=l}return A},config:function(){return[{readWrite:"true",name:"scope",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:true,searchSourceTypes:this._getSearchSourceTypes(),dropTypes:this._getDropTypes(),searchTitle:m("emxCollaborativeTasks.Label.referencesAssociatedWithTitle"),type:"object",customView:e,typeAheadCallback:c.typeAheadCallback,linkCallback:a.launchProperties,getDropDownMenuItems:a.getDropDownMenuItems,searchSource:this._getSearchSource()}]},setScope:function t(C,B){var z=B||{};var A=false;if(this._scope!==C){var E=x.getScopeId();var D=x.getScopeType();if(C){if(E!==C.id||D!==(C.get("type")||"")){x.setScopeData({id:C.id,type:C.get("type")||"",isRDF:Boolean(C.isRDF)});A=!z.noRealChange}this._scope=C}else{x.removeScopeData();A=Boolean(E);delete this._scope}this.dispatchEvent("onChange:scopeId",[A])}},getScope:function(){return this._scope}});v.RDFWorkscopeModel=g;return v});