define("DS/TagNavigator/ColorManager",["UWA/Core"],function(b){function a(){this.colors=["#FEE000","#009DDB","#FF8A2E","#9B2C98","#00AA86","#F564A3","#8DDEE4","#CC092F","#E2D5CC","#6FBC4B","#70036b","#002596","#C6C68B","#7F7F7F","#4EA8B7","#007A4C","#4D62BA","#127277","#6D2815","#000000","#ADADAD",];this.activePredicate=null;this.counter={};this.colorMap={};this.computedColorMap={};this.colorByTv={};this.shading={};this.forbiddenColors={};this.coloredTreeTagList=[]}a.prototype={isColorized:function(c){return this.activePredicate===c},toggleColorize:function(c){this.activePredicate=(this.activePredicate===c)?undefined:c},clearComputedColorMap:function(d){delete this.computedColorMap[d];delete this.counter[d];delete this.colorByTv[d];delete this.forbiddenColors[d];if(this.colorMap[d]){var c={};c[d]=this.colorMap[d];this.setColorMap(c)}},setColorMap:function(d){var e,c,f;if(d){this.colorMap=this.colorMap||{};this.colorMap=b.merge(d,this.colorMap);for(f in d){delete this.counter[f];delete this.colorByTv[f];delete this.forbiddenColors[f];this.computedColorMap[f]={};this.computedColorMap[f].tagColors=[];this.colorByTv[f]={};for(e=0;e<d[f].length;e++){c=d[f][e];c.predicate=f;this.computedColorMap[f].tagColors.push(c);this.colorByTv[f][c.object+c.type]=c.color;if(this.colors.indexOf(c.color)!==-1){this.forbiddenColors[f]=this.forbiddenColors[f]||[];this.forbiddenColors[f].push(this.colors.indexOf(c.color))}}}}},getColor:function(c,d){while(this.forbiddenColors[d]&&this.forbiddenColors[d].indexOf(c)!==-1){c=this.counter[d]++}c=c<this.colors.length?c:this.colors.length-1;return this.colors[c]||null},getColorIndex:function(c){this.counter[c]=this.counter[c]||0;return this.counter[c]},getShading:function(c){this.shading[c]=this.shading[c]||[];return this.shading[c]},getCurrentColor:function(c){return this.getColor(this.getColorIndex(c),c)},_addToMap:function(f,d){var c=JSON.parse(f.getSelectedTagId());c.color=d;var e=f.getPredicateView()._predicate.getFullPredicateID();if(!this.computedColorMap[e]){this.computedColorMap[e]={};this.computedColorMap[e].tagColors=[]}if(!this.colorByTv[e]){this.colorByTv[e]={}}this.computedColorMap[e].tagColors.push(c);this.colorByTv[e][f.id()+f.type()]=d},_addToTempTreeMap:function(f,d){var c=JSON.parse(f.getSelectedTagId());c.color=d;this.coloredTreeTagList.push(c);var e=f.getPredicateView()._predicate.getFullPredicateID();this.colorByTv[e][f.id()+f.type()]=d},_clearTempTreeMap:function(){this.coloredTreeTagList=[];this.shading={}},getNewColorForTagValue:function(f){var c=null;var e=f.getPredicateView()._predicate.getFullPredicateID();c=this.colorByTv[e]?this.colorByTv[e][f.id()+f.type()]:null;if(!c){var d=Object.getPrototypeOf(f.getMotherView())===Object.getPrototypeOf(f);if(!(d&&f.type()==="tree")){c=this.getCurrentColor(e);if(c!==null){this._addToMap(f,c);this.counter[e]++}}}return c},addToColoredTreeTagList:function(h){var e,d;var g=h.getPredicateView()._predicate.getFullPredicateID();var f=Object.getPrototypeOf(h.getMotherView())===Object.getPrototypeOf(h);if(f&&h.type()==="tree"){e=this.colorByTv[g][h.getMotherView().id()+h.getMotherView().type()];var c=this.getShading(g);if(c[e]===undefined){c[e]=0}c[e]=c[e]+0.2;if(c[e]>0.8){c[e]=0.8}d=a.shadeColor(e,c[e]);if(d!=="#e2e4e3"){this._addToTempTreeMap(h,d)}}return d},getColoredTreeTagList:function(){return this.coloredTreeTagList}};a.shadeColor=function(c,h){var i=parseInt(c.slice(1),16),d=h<0?0:255,j=h<0?h*-1:h,g=i>>16,e=i>>8&255,k=i&255;return"#"+(16777216+(Math.round((d-g)*j)+g)*65536+(Math.round((d-e)*j)+e)*256+(Math.round((d-k)*j)+k)).toString(16).slice(1)};return a});define("DS/TagNavigator/Logger",[],function(){function a(g){var f,c,h,j,e,i;if(typeof g!=="boolean"){g=false}c=g;if(window){h=window}else{if(global){h=global}else{h={}}}this.disable=function(){c=false;return this};function d(k){return function(){if(!c){return}if(h.console){if(typeof h.console[k]==="function"){return h.console[k].apply(h.console,Array.prototype.slice.call(arguments))}if(typeof h.console[k]!=="function"){if(typeof h.console[k]==="object"&&k!=="debug"){return h.console[k](Array.prototype.slice.call(arguments))}}}else{if(h.opera&&typeof h.opera.postError==="function"){return h.opera.postError.apply(null,Array.prototype.slice.call(arguments))}}}}i=["log","info","warn","error","debug","group","groupEnd"];for(j=0,e=i.length;j<e;j++){f=i[j];this[f]=d(f)}}var b=function(){if(location.search.indexOf("proxyLogs")!==-1||location.search.indexOf("debug")!==-1){return true}else{return false}};return new a(b())});define("DS/TagNavigator/Parameter",["UWA/Class/Model","UWA/Core"],function(b,a){var c=b.extend({defaults:{value:"",type:"","interface":"",unit:"",boolVal:[],stringVal:"",intType:[]},setup:function(){this.set({stringVal:"",boolVal:[],intType:[]})}});return c});define("DS/TagNavigator/NotificationManager",["UWA/Class","UWA/Class/Events"],function(b,a){var c=b.singleton(a,{init:function(){this._notificationsQueue={}},push:function(d){if(d.type){if(!this._notificationsQueue[d.type]){this._notificationsQueue[d.type]=[]}this._notificationsQueue[d.type].push(d)}return this},dispatch:function(j){var d,f,k=[],e,i,l={},g,h=this;i=Object.keys(this._notificationsQueue);if(j){i.forEach(function(m){d=h._notificationsQueue[m];e=d[0];if(e.mergeWidth){for(f=1;f<d.length;f++){e.mergeWidth(d[f])}h._notificationsQueue[m]=[e]}})}i.forEach(function(m){d=h._notificationsQueue[m];for(f=0;f<d.length;f++){g=d[f].message.format(d[f].data);d[f].message=g;d[f].data=d[f].data||{className:"error"};d[f].data.className=d[f].data.className||"error";if(!l[g]){k.push(d[f]);l[g]=true}}h.dispatchEvent("notify",k);l={};k=[]});this._notificationsQueue={};return this}});return c});define("DS/TagNavigator/TaggerSettings",["UWA/Core","UWA/Class","UWA/Class/Options","text!DS/TagNavigator/assets/TaggerSettings.json"],function(a,d,c,e){var b=d.singleton(c,{init:function(){var f;try{f=JSON.parse(e)}catch(g){console.error("FAILED to parse TaggerSettings.json, message="+g.message);f={}}this.setOptions(f)},urlSettings:function(g){if(UWA.is(g,"object")){for(var f in g){var h=g[f];if(UWA.is(h,"string")){if(h.toLowerCase()=="false"){h=false}else{if(h.toLowerCase()=="true"){h=true}}}else{if(!UWA.is(h)){h=true}}this.setOption(f,h)}}}});return b});define("DS/TagNavigator/UserSettings",["UWA/Core","UWA/Class","UWA/Utils","DS/WAFData/WAFData"],function(e,a,d,b){var c=a.singleton({init:function(f){var g,h;h={method:"GET",timeout:5000,headers:{Accept:"application/json"},cache:-1};g=d.parseUrl(f.myAppsBaseURL);this.myAppsBaseURL=g.protocol+"://"+g.authority+g.path;if(g.domain!==(window!==undefined&&window!==null?window.location.hostname:undefined)){h.proxy="passport"}this.getPreference=function(j,k){var i=e.clone(h);i.onComplete=i.onFailure=k;b.request(this.myAppsBaseURL+"/resources/AppsMngt/user/getPreferences?name="+j,i)};this.setPreference=function(i,j){b.request(this.myAppsBaseURL+"/resources/AppsMngt/user/setPreferences?name="+i+"&value="+j,h)}}});return c});define("DS/TagNavigator/Notification",["UWA/Class"],function(a){var b=a.extend({type:"Notification",init:function(c,d){this.message=c;this.data=d}});return b});define("DS/TagNavigator/TaggerNLS",["DS/TagNavigator/Logger","i18n!DS/TagNavigator/assets/nls/TagNavigator"],function(d,b){var c={en:true,fr:true,de:true,ja:true,zh:true,ko:true,it:true,es:true},e=null,a=null;c.getLang=function(){return e||"en"};c.isLanguageSupported=function(f){return this[f]};c.setCurrentLanguage=function(f){if(e===null){if(!f){e="en";d.warn("TagNavigator - Language = "+f+" is not supported... Using default language (English)")}else{if(!this.isLanguageSupported(f)){d.warn("TagNavigator - Language = "+f+" is not supported... Using default language (English)");e="en"}else{d.info("TagNavigator - Setting language to "+f);e=f}}}return e};c.getText=function(f){if(e===null){this.setCurrentLanguage()}if(b[f]){return b[f].escapeHTML().replace(/'/g,"&#39;").replace(/&#x2F;/g,"/")}else{return f}};c.getNLSMonthArray=function(){if(!a){a=[c.getText("january"),c.getText("february"),c.getText("march"),c.getText("april"),c.getText("may"),c.getText("june"),c.getText("july"),c.getText("august"),c.getText("september"),c.getText("october"),c.getText("november"),c.getText("december")]}return a};c.convertToUnity=function(f,g){if(g||this.preciseCount_global){return f}if(f<1000){return f}else{if((f>999)&&(f<1000000)){return Math.floor(f/1000)+"k"}else{if((f>999999)&&(f<1000000000)){return Math.floor(f/1000000)+"M"}else{if(f>999999999){return f.toString().substring(0,3)+"..."}}}}};return c});define("DS/TagNavigator/AdvancedSearchCriteria",["UWA/Core","DS/TagNavigator/TaggerNLS",],function(c,b){function a(){var e={},l={};this.setActiveCriteria=function(m,t){var r,s,o,u={},n,p,q;u={localfilters:{search:{},plmparam:{}}};if(!d([t.widgetId,t.proxyId])){return u}if(m.search){for(s in m.search){o=m.search[s];if(o.length===1&&(o[0].object.from||o[0].object.to)){u.localfilters.search[s]=Object.keys(o[0].object).map(function(v){if(!o[0].object[v]){return}var w={type:o[0].type||"date",displayValue:v+": "+o[0].object[v],object:{}};w.object[v]=o[0].object[v];return{text:w.displayValue,tagId:g(w,s)}}).filter(function(v){return v!==undefined})}else{u.localfilters.search[s]=o.map(function(v){return{text:v.displayValue,tagId:g(v,s)}})}}}if(m.plmparam){for(n=0;n<m.plmparam.length;n++){u.localfilters.plmparam=m.plmparam.map(function(v){p=v.get("type");if(p==="string"){q=[v.get("stringVal")]}else{if(p==="boolean"){if(v.get("boolVal").length>0){q=[v.get("boolVal")[0]==="1"?b.getText("yes"):b.getText("no")]}else{q=[]}}else{q=v.get("intType").map(function(w){return{fromVal:w.fromVal,toVal:w.toVal,rangeVal:w.rangeVal}}).filter(function(w){return(!isNaN(w.fromVal)&&isFinite(w.fromVal)&&w.fromVal!==null)||(!isNaN(w.toVal)&&isFinite(w.toVal)&&w.toVal!==null)})}}return{title:v.get("value"),type:p,cid:v.cid,value:q}}).filter(function(v){return v.value.length>0&&v.value[0]!==""})}}if(t.predicatesNLS){l=t.predicatesNLS}return u};this.criteriaToHTML=function(t,o){var n,m,s,p,r;var q=[];if(!t){return""}q.push(d([o.widgetId,o.proxyId])&&o.widgetId in t&&o.proxyId in t[o.widgetId]&&i(t[o.widgetId][o.proxyId].search));q.push(d([o.widgetId,o.proxyId])&&o.widgetId in t&&o.proxyId in t[o.widgetId]&&t[o.widgetId][o.proxyId].plmparam.length>0);if(q[0]||q[1]){n='<div id="searchCriteria-_-'+o.contextId+'" class="appCriteria">';if(q[0]){for(m in t[o.widgetId][o.proxyId].search){s=t[o.widgetId][o.proxyId].search[m];if(s.length>0){n+="<ul class=active-predicate-list>";n+=k(m)+h(s);n+="</ul>"}}}if(q[1]){for(p=0;p<t[o.widgetId][o.proxyId].plmparam.length;p++){r=t[o.widgetId][o.proxyId].plmparam[p];n+="<ul class=freeinput-predicate-list>";n+=f(r);n+="</ul>"}}n+="</div>"}else{return""}return n};function f(o){var n=0,m=c.createElement();m.grab(c.createElement("li",{"class":"predicate expanded selected ds6w_",html:{tag:"div","class":"predicate-header",html:{tag:"div","class":"predicate-label",text:o.title}}}));if(o.type==="string"||o.type==="boolean"){m.grab(c.createElement("li",{"class":"parameter selected tag",title:o.value[0],html:{tag:"div","class":"parameter tag-label",id:o.cid,text:o.value[0]}}))}else{for(n=0;n<o.value.length;n++){m.grab(c.createElement("li",{"class":"param-range-label",text:b.getText("paramIntType"+o.value[n].rangeVal)}));if(!isNaN(o.value[n].fromVal)&&isFinite(o.value[n].fromVal)&&o.value[n].fromVal!=null){m.grab(c.createElement("li",{"class":"parameter selected tag",title:o.value[n].fromVal,html:{tag:"div",id:o.cid,"class":"tag-label from",rangeVal:o.value[n].rangeVal,fromto:"from",text:b.getText("from")+":"+o.value[n].fromVal}}))}if(!isNaN(o.value[n].toVal)&&isFinite(o.value[n].toVal)&&o.value[n].toVal!=null){m.grab(c.createElement("li",{"class":"parameter selected tag",title:o.value[n].toVal,html:{tag:"div",id:o.cid,"class":"tag-label to",rangeVal:o.value[n].rangeVal,fromto:"to",text:b.getText("from")+":"+o.value[n].toVal}}))}}}return m.getHTML()}function k(m){m=m.split("/");var o=l[m.join("/")]||m[m.length-1].split(":")[1];var n='<li class="predicate expanded selected" id="atv'+j(m.join("/"))+'">';n+='<div class="predicate-header" title="'+o+'"><div class="predicate-label">';n+='<span class="fonticon fonticon-search"></span>'+o+"</div></div></li>";return n}function h(o){var n=0,m=c.createElement();for(n=0;n<o.length;n++){m.grab(c.createElement("li",{"class":"tag selected",id:o[n].tagId+"atv",title:o[n].text.replace(/(from:\s|to:\s)/,""),html:{tag:"div","class":"tag-label",text:o[n].text.replace(/(from|to)/,function(p,q){return b.getText(q)})}}))}return m.getHTML()}function d(m,o){if(m&&typeof m==="string"){if((m.length===0)||(o&&o instanceof RegExp&&!o.test(m))){return false}return true}else{if(!(m instanceof Array)){return false}else{for(var n=0;n<m.length;n++){if((!m[n]||typeof m[n]!=="string"||m[n].length===0)||(o&&o instanceof RegExp&&!o.test(m[n]))){return false}}return true}}return false}function i(n){if(Object.keys(n).length===0){return false}for(var m in n){if(n[m].length>0){return true}}return false}function j(q){var o,p,n,m;p=0;if(q.length!==0){for(n=0,m=q.length;n<m;n++){o=q[n];p=((p<<5)-p)+o.charCodeAt(0);p=p&p}}p="id_"+p;e[p]=q;return p}this.getCriterionFromDOMId=function(o){var n,m;n=o.replace("atv","");if(e.hasOwnProperty(n)){m=e[n];return JSON.parse(m)}else{return undefined}};function g(o,m){var n=JSON.stringify({predicate:m,object:o.object,dispValue:o.displayValue,type:o.type});return j(n)}}return a});define("DS/TagNavigator/TagsServer",["UWA/Core","DS/WAFData/WAFData","UWA/Utils","DS/TagNavigator/NotificationManager","DS/TagNavigator/Notification","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger"],function(e,j,f,l,k,m,g,i){var c,n,a={};c="/resources/6w";n="/resources/6WVocab/access";var b=0;var d=0;function h(y,C,z){var s,A,t,q,r,D,w,B,p,u,o,v=this;y=f.composeUrl(f.parseUrl(y));if(C&&(typeof C==="string")){s={tenant:C}}else{s={}}if(z&&typeof(z)==="string"&&z.length>0){A=z||""}else{A=null}try{w=h.validateBaseUrl(y);D=(window?window.location.protocol:null)==="file:";B=false;if(!f.matchUrl(window.location,y)){B="passport"}}catch(x){throw x}u=function(E){E=E||{};return e.Utils.toQueryString(e.merge(e.merge({},E),s))};q=function(){var E;E={type:"text",timeout:15000,headers:{Accept:"application/json","Content-Type":"application/json"},};if(f.Client.Engine.name==="firefox"){E.timestamp=Date.now()}return E};t=function(){var E={tenantId:v.getTenantName(),lang:m.getLang()};return E};p=function(E,G){if(D){setTimeout(G.onComplete,1000);return this}try{j.authenticatedRequest(E,G)}catch(F){G.onFailure(F)}return this};r=function(F,G){var E;if(typeof G==="boolean"){G=false}if(!F||(F==="")){return !G}try{E=JSON.parse(F)}catch(H){return false}return !E.error};o=function(E){return E.map(function(F){return F.uri}).join("")};this.getElementsNLS=function(J,I,G){y=v.getUrlPart("baseUrl");if(y.indexOf("/VocabularyStub")!==-1){var H,E;H=q();H.onComplete=function(K){if(!r(K)){return H.onFailure(K)}i.info("Elements NLS successfully retrieved from '"+y+"'");if(I&&K){return I(JSON.parse(K),G)}else{G()}};H.onFailure=H.onTimeout=function(K){G();i.info("Failed to retrieve Elements NLS from '"+y+"'")};H.headers["Accept-Language"]=m.getLang();H.method="POST";H.data=J;H.headers["Content-Type"]="text/uri-list";E=y+n+"/ElementsNLSNames?"+u({});var F=g.getOption("scenario");if(UWA.is(F,"string")){E=y+n+"/ElementsNLSNames/"+(++b)+"/response"}else{E=y+n+"/ElementsNLSNames"}H.method="GET";p(E,H)}else{require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(M){var K,L;K=t();K.onComplete=function(N){i.info("Elements NLS successfully retrieved from RDF API FedDictionaryAccess.getResourcesInfo(..)");i.log("FedDictionaryAccess.getResourcesInfo(..)===>responseData=",JSON.stringify(N));if(I&&N){return I(N,G)}else{G()}};K.onFailure=function(N){i.info("Failed to retrieve Elements NLS from from RDF API FedDictionaryAccess.getResourcesInfo(..)");if(UWA.is(N,"object")&&UWA.is(N.vocabularyElementNLSInfo,"array")&&I){return I(N,G)}else{G()}};i.log("TagsServer.getElementsNLS, param =",J);M.getResourcesInfo(J,K)})}return v};this.getTenantName=function(){return C};this.getTenantDisplayName=function(){return A||this.getTenantName()};this.getUrlPart=function(E){return w[E]||null};this.putTag=function(G,K,F,J){var L,M,H=G.tag[0],E=q(),I=this;y=this.getUrlPart("baseUrl");E.onComplete=function(N){if(!r(N)){return E.onFailure(N)}i.info("Tag {"+([o(H.subject),H.predicate,H.object.literal].join("/"))+"} successfully created on server '"+y+"'");if(F){return F(I.getTenantName())}};E.onFailure=E.onTimeOut=function(N){i.error("Failed to create tag {"+([o(H.subject),H.predicate,H.object.literal].join("/"))+"} on server '"+y+"'. Reason is '"+(N?N.message:undefined)+"'");l.push(new k(m.getText("tagCreationFail").format(H.object.literal)+m.getText("errorContactAdmin")));l.dispatch();if(J){return J(H.subject)}};E.method="PUT";E.data=JSON.stringify(G);M=K?{SecurityContext:"preferred"}:{SecurityContext:"preferred"};L=y+c+"/tags?"+u(M);p(L,E);return this};this.deleteTag=function(F,I,K,H){var G,E,J=q(),L=F.tag[0];y=this.getUrlPart("baseUrl");J.onComplete=function(M){if(!r(M)){return J.onFailure(M)}i.info("Tag {"+([o(L.subject),L.predicate,L.object.literal].join("/"))+"} successfully deleted on server '"+y+"'");l.push(new k(m.getText("tagDeletionSuccess"),{className:"success"}));l.dispatch();if(K){return K(L.subject)}};J.onFailure=function(M){i.error("Failed to delete tag {"+([o(L.subject),L.predicate,L.object.literal].join("/"))+"} on server '"+y+"'. Reason is '"+(M?M.message:undefined)+"'");l.push(new k(m.getText("tagDeletionFail").format(L.object.literal)+m.getText("errorContactAdmin")));l.dispatch();if(H){return H(L.subject)}};J.method="DELETE";J.data=JSON.stringify(F);E=I?{SecurityContext:"preferred"}:{};G=y+c+"/tags?"+u(E);p(G,J);return this};this.getPredicateValue=function(E,J,H){y=this.getUrlPart("baseUrl");if(y.indexOf("/VocabularyStubCustom")!==-1){var I=q(),F;I.onComplete=function(K){i.info("Success retrieving PredicateValue in ODT");if(J){return J(JSON.parse(K),H)}};I.headers["Accept-Language"]=m.getLang();I.method="GET";var G=g.getOption("scenario");if(UWA.is(G,"string")){F=y+n+"/PredicateValue/"+(++d)+"/response"}p(F,I);return}else{if(this.getUrlPart("baseUrl").indexOf("/VocabularyStub")!==-1){return J({},H)}}require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(L){var K=t();K.onComplete=function(M){i.info("Success retrieving PredicateValue");if(J){return J(UWA.is(M,"string")?JSON.parse(M):M,H)}};K.onFailure=function(M){return H()};L.getNlsOfPropertiesValues(JSON.stringify(E),K)});return this};this.getExplicitTag=function(E,I,G){var H=q(),F;y=this.getUrlPart("baseUrl");H.onComplete=function(J){if(!r(J,true)){return H.onFailure(J)}i.info("Tags successfully retrieved from server of tenant:'"+C+"'");if(I){return I(J,s.tenant,G)}};H.onFailure=function(J){i.info("Failed to get explicit tags from server of tenant:'"+C+"'. Reason is '"+(J?J.message:undefined)+"'");return I(null,null,G)};H.method="POST";F=y+c+"/tags?"+u({});H.data=JSON.stringify(E);p(F,H);return this};this.getVocabularySuggestions=function(E,F,G){i.log("Inside TagsServer.getVocabularySuggestions for predicate "+F);if(this.getUrlPart("baseUrl").indexOf("/VocabularyStub")!==-1){return G()}require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(I){var H=t();if(typeof E==="string"){H.tenantId=E}H.onComplete=function(J){i.info("Vocabulary suggestions successfully retrieved from FedDictionaryAccess.getRangeValues, responseData="+JSON.stringify(J));if(G&&J){return G(E,F,typeof J==="string"?JSON.parse(J):J)}};H.onFailure=function(){i.info("Failed to retrieve Vocabulary suggestions from FedDictionaryAccess.getRangeValues(..)");if(G){return G(E,F)}};I.getRangeValues(F,H)});return this}}h.validateBaseUrl=function(p){var o=f.parseUrl(p);o.baseUrl=o.protocol+"://"+o.authority+o.path;return o};h.isAlreadyInTagsServerList=function(o){return a[o]};h.setInTagsServerList=function(o){a[o]=true};return h});define("DS/TagNavigator/Parameters",["UWA/Class/Collection","UWA/Core","DS/TagNavigator/Parameter"],function(b,c,d){var a=b.extend({model:d,isReadyForSearch:function(){var f,e=this.size(),i=false;for(f=0;f<e&&!i;f++){var j=this._models[f]._attributes;if(j!==null){var g,h=j.intType.length;for(g=0;g<h&&!i;g++){i=j.intType[g].toVal!==null||j.intType[g].fromVal!==null?true:false}i=i||(j.boolVal.length&&j.boolVal[0]!=="")||j.stringVal.length}}return i},getFilters:function(){var e={plmparam:{}};this._models.forEach(function(g){var h=g._attributes;if(h.type==="string"){if(h.stringVal!==""){if(!e.plmparam.string){e.plmparam.string={}||e.plmparam.string}e.plmparam.string[h.value]={"interface":h["interface"],value:h.stringVal}}}else{if(h.type==="boolean"){if(h.boolVal.length&&h.boolVal[0]!==""){if(!e.plmparam["boolean"]){e.plmparam["boolean"]={}||e.plmparam["boolean"]}e.plmparam["boolean"][h.value]={"interface":h["interface"],value:h.boolVal[0]==="1"?true:false}}}else{var f=h.unit||null;h.intType.forEach(function(m){if(m.fromVal!==null||m.toVal!==null){var k="nominal";var i=m.rangeContainer&&m.rangeContainer.hasChildNodes()?m.rangeContainer.getElement(".form-control"):null;switch(i.value){case"2":k="min";break;case"3":k="max";break;case"4":k="range";break}var j,l;j=h.type==="integer"?parseInt(m.fromVal,10):parseFloat(m.fromVal);l=h.type==="integer"?parseInt(m.toVal,10):parseFloat(m.toVal);if(!e.plmparam[h.type]){e.plmparam[h.type]={}||e.plmparam[h.type]}if(!e.plmparam[h.type][h.value]){e.plmparam[h.type][h.value]={"interface":h["interface"]};if(f){e.plmparam[h.type][h.value].unit=f}}e.plmparam[h.type][h.value][k]={};if(j===l){e.plmparam[h.type][h.value][k]["equal"]=j}else{if(!isNaN(j)){e.plmparam[h.type][h.value][k].from=j}if(!isNaN(l)){e.plmparam[h.type][h.value][k].to=l}}}})}}});return e},clearValues:function(){this._models.forEach(function(e){e.set({stringVal:"",boolVal:[],intType:[]})})},appendParameter:function(j){var h,g,i,e,f;h=true,g=j.get("value"),i=j.get("interface"),e=j.get("type"),f=j.get("unit");this._models.forEach(function(k){if(h){if((g&&g===k.get("value"))&&(i&&i===k.get("interface"))&&(e&&e===k.get("type"))){if(f){if(f===k.get("unit")){h=false}}else{h=false}}}});if(h){this.add(j)}return h}});return a});define("DS/TagNavigator/TaggerUtils",["UWA/Core","UWA/Class","UWA/Promise","DS/TagNavigator/Logger"],function(e,b,c,d){var a=b.singleton({_user_granted_roles_promise:undefined,init:function(f){},getGrantedRoles:function(){if(!UWA.is(this._user_granted_roles_promise)){this._user_granted_roles_promise=new c(function(g,f){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(h){h.getGrantedRoles(function(i){d.info("i3DXCompassPlatformServices.getGrantedRoles returned roles info as:"+(i&&UWA.is(i,"array")?JSON.stringify(i):i));g(i)})})})}return this._user_granted_roles_promise}});return a});define("DS/TagNavigator/Suggestions",["UWA/Class","UWA/Core","UWA/Element","DS/UIKIT/Autocomplete","DS/TagNavigator/TaggerNLS"],function(b,f,a,d,e){var c=b.singleton({init:function(){var j={},l=null;var i=null,h=null,g=null,k=null;this.getSuggestionsFromServers=function(o){var q,n,p,m;i=o.tagsServers;g=o.pred;h=(o.tenants&&o.tenants.length)?o.tenants[0]:null;k=o.autocomplete;q=function(r,u,t){var v,s,w={};j[r+u]={};if(t&&Object.keys(t).length){w={name:r+u,items:[]};t=t.literalInfo;for(v=0,s=t.length;v<s;v++){if(t[v].value){w.items.push({value:t[v].value})}}w.items.sort(function(y,x){if((y.label||y.value).toLowerCase()<(x.label||x.value).toLowerCase()){return -1}if((y.label||y.value).toLowerCase()>(x.label||x.value).toLowerCase()){return 1}return 0});if(l){k.removeDataset(l)}j[r+u]=w;l=r+u;k.addDataset(j[r+u])}};if(h&&g&&k){if(l){k.removeDataset(l)}if(!j[h+g]){o.tagsServers[h].getVocabularySuggestions(h,g,q)}else{l=h+g;if(Object.keys(j[l]).length){k.addDataset(j[l])}}}}}});return c.init()});define("DS/TagNavigator/CacheManager",["UWA/Class","DS/TagNavigator/ColorManager"],function(c,b){var a=c.extend({init:function(){this.activePredicates={};this.activeW={allw:true};this.collapsedPredicates={};this.expandedTagTree={};this.searchId="filter-all";this.searchVisibility=false;this.searchValue="";this.addTagVisible=false;this.addTagValue="";this.openedToolBox={};this.predicatesSortingMode={};this.colorManager=new b();this.viewMode={};this.collapsedSection={};this.moreClicked=false;this.more=false;this.criteriaToResetMap={};this.criteriaToRemoveArray={};this.sort6W="sort-tag";this.cloudPredicate={};this.parameterClicked=false;this.selectedTab="tags"},isActivePredicate:function(d){return this.activePredicates[d]||false},setActivePredicate:function(d){this.activePredicates[d]=true},clearActivePredicate:function(){this.activePredicates={}},isActiveW:function(d){return this.activeW[d]||false},addActiveW:function(d){this.activeW[d]=true},removeActiveW:function(d){delete this.activeW[d]},getActiveW:function(){return this.activeW},toggleActiveW:function(d){if(this.activeW[d]){this.removeActiveW(d)}else{this.addActiveW(d)}},isPredicateCollapsed:function(d){return this.collapsedPredicates[d]!==false},collapsePredicate:function(d){delete this.collapsedPredicates[d]},expandPredicate:function(d){this.collapsedPredicates[d]=false},isTagTreeExpanded:function(d){return this.expandedTagTree[d]||false},collapseTagTree:function(d){delete this.expandedTagTree[d]},expandTagTree:function(d){this.expandedTagTree[d]=true},setSearchId:function(d){this.searchId=d},getSearchId:function(){return this.searchId},setSearchVisibility:function(d){this.searchVisibility=d},isSearchVisible:function(){return this.searchVisibility},setSearchValue:function(d){this.searchValue=d},getSearchValue:function(){return this.searchValue},toggleAddTagVisibility:function(){this.addTagVisible=!this.addTagVisible},isAddTagVisible:function(){return this.addTagVisible},setAddTagValue:function(d){this.addTagValue=d},getAddTagValue:function(){return this.addTagValue},toggleToolboxVisibility:function(e,d){if(typeof d==="boolean"){this.openedToolBox[e]=d}else{this.openedToolBox[e]=!this.openedToolBox[e]}},isToolboxVisible:function(d){return this.openedToolBox[d]||false},changeSort:function(g,f){var e=this.predicatesSortingMode[f],d;if(e.sortMode===g){e.order=!e.order}else{e.sortMode=g;d=e.order;e.order=e.secondaryorder;e.secondaryorder=d}},getCurrentSort:function(e){var f,d;if(!this.predicatesSortingMode[e]){this.predicatesSortingMode[e]={}}d=this.predicatesSortingMode[e];if(!d.sortMode){f=e.split("/").shift();if(f==="ds6w:when"){d.sortMode="alphaSort";d.order=true;d.secondaryorder=false}else{d.sortMode="nbSort";d.order=false;d.secondaryorder=true}}return d},setViewMode:function(e,d){this.viewMode[e]=d},getViewMode:function(d){return this.viewMode[d]||"tag"},setViewModeForSearch:function(){var d;for(d in this.viewMode){if(this.viewMode[d]==="freeInput"){this.viewMode[d]="tag"}}},isSectionCollapsed:function(d){return this.collapsedSection[d]},toggleSection:function(e,d){if(d!==undefined){this.collapsedSection[e]=d}else{if(!UWA.is(this.collapsedSection[e])){this.collapsedSection[e]=true}else{if(this.collapsedSection[e]!==false){this.collapsedSection[e]=false}else{this.collapsedSection[e]=true}}}},isMoreClicked:function(){return this.moreClicked},setMoreClicked:function(d){this.moreClicked=d},getMore:function(){return this.more},setMore:function(d){this.more=d},getCriteriaToResetBeforeFilterChange:function(d){if(d){if(this.criteriaToResetMap[d]){return this.criteriaToResetMap[d]}else{this.criteriaToResetMap[d]={};return this.criteriaToResetMap[d]}}else{return{}}},setCriteriaToResetBeforeFilterChange:function(d,e){if(UWA.is(d,"string")){this.criteriaToResetMap[d]=e}else{console.warn("setCriteriaToResetBeforeFilterChange called with invalid proxyId")}},resetCriteriaToResetBeforeFilterChange:function(d){if(UWA.is(d,"string")){delete this.criteriaToResetMap[d]}else{console.warn("resetCriteriaToResetBeforeFilterChange called with invalid proxyId")}},getCriteriaToRemoveBeforeFilterChange:function(d){if(d){if(this.criteriaToRemoveArray[d]){return this.criteriaToRemoveArray[d]}else{this.criteriaToRemoveArray[d]=[];return this.criteriaToRemoveArray[d]}}else{return[]}},resetCriteriaToRemoveBeforeFilterChange:function(d){if(UWA.is(d,"string")){delete this.criteriaToRemoveArray[d]}else{console.warn("resetCriteriaToRemoveBeforeFilterChange called with invalid proxyId")}},get6WSort:function(){return this.sort6W},set6WSort:function(d){this.sort6W=d},isCloud:function(d){return this.cloudPredicate[d]||false},addCloud:function(d){this.cloudPredicate[d]=true},removeCloud:function(d){delete this.cloudPredicate[d]},getParameterClicked:function(){return this.parameterClicked},setParameterClicked:function(d){this.parameterClicked=d},});return a});define("DS/TagNavigator/PredError",["DS/TagNavigator/Notification","DS/TagNavigator/TaggerNLS"],function(c,b){var a=c.extend({type:"PredError",init:function(d){this._parent(b.getText("predError")+b.getText("errorContactAdmin"),d)},mergeWidth:function(d){this.data=[this.data,d.data].join(", ")}});return a});define("DS/TagNavigator/Predicate",["UWA/Core","DS/TagNavigator/TaggerNLS","DS/TagNavigator/NotificationManager","DS/TagNavigator/PredError","DS/TagNavigator/Notification","DS/TagNavigator/Logger","UWA/Class/Promise","DS/TagNavigator/TagsServer"],function(h,q,o,c,n,l,j,k){var f={},d,i,e,b,p,g={},m={};p=function(r){l.error("Fail to create a predicate with invalid arg. Id is :'"+r+"'");throw new Error("Invalid input arg")};function a(I){var J,w,v,r,D,u;if(I){J=I.sixw;w=I.displayName;u=I.options||{};v=I.type;r=I.server}var t,y=[],C=null,G=v,H=false,E=u,z=true,F=undefined,B;var x,L,s,K;if((J?J.length:undefined)===undefined){p()}if(J.length===0){if(i){return i}i=this}else{if(typeof J==="string"){J=J.split("/")}x=J.slice(0,J.length-1);t=J[J.length-1];if(typeof t!=="string"||(t.indexOf("/"))!==-1){p(t)}if(x.indexOf(t)!==-1){p(t)}L=a.getPredicate(t);if(L){K=L.getFullPredicateID().split("/");if(K.join("/")!==J.join("/")){if(K[0]==="void"){L.set6WRootFather(J[0])}else{if(J[0]==="void"){return L}else{p(t)}}}else{return L}}if(Object.keys(a.weights).indexOf(t)!==-1){this.weight=a.weights[t]}if(Object.keys(a.defaultExpands).indexOf(t)!==-1){this.defaultExpand=a.defaultExpands[t]}if(Object.keys(a.allowFreeInput).indexOf(t)!==-1){this.allowFreeInput=a.allowFreeInput[t]}var A={sixw:x,type:v,server:r};C=new a(A);if(C===i){if((e.test(t))===false){p(t)}}else{if(C.getFullPredicateID()+"/"+t!==J.join("/")){p(t)}}C.addChild(this);f[t]=this;if(!w||t.split(":").pop()===w){a.addElementsToTranslate(t,r)}else{d[t]=w}}this.addChild=function(M){y.push(M);return this};this.removeChild=function(N){var M=y.indexOf(N);if(M!==-1){y.splice(M,1)}return this};this.id=function(){return t};this.getType=function(){return G};this.setType=function(M){G=M==="dateTime"?"date":(M?M:"string")};this.setIsEnum=function(M){H=M};this.isEnum=function(){return H};this.setSuggestSupport=function(M){F=M};this.isSuggestSupported=function(){return F};this.isTypeValidBool=function(){return z===true};this.setTypeValidBool=function(M){z=M};this.getElemOptions=function(){return E};this.setElemOptions=function(M){E=M};this.warnSelect=function(){return E&&E.onCriterionSelectEvent||false};this.getFullPredicateID=function(N){var M;M=C!==null?C.getFullPredicateID():null;if(M==="void"&&N){M=""}if(M&&M.length!==0){return M+"/"+t}return t};this.displayName=function(){if(d[t]){return d[t]}return t};this.setDisplayName=function(M){d[t]=M;return M};this.countDescendants=function(){if(y.length){return y.length+y.map(function(M){return M.countDescendants()}).reduce(function(N,M){return N+M})}return 0};this.getChildren=function(P){var O,N,M;if(!P){P=function(){return true}}M=[];for(s=0,N=y.length;s<N;s++){O=y[s];if(P(O.id())){M.push(O)}}return M};this.getFather=function(){return C};this.get6WRootFather=function(){var M=this;if(this===i){return null}while(!M.is6WRoot()){M=M.getFather()}return M};this.set6WRootFather=function(M){var P,N,O;P=a.getPredicate(M);if(!P||!P.is6WRoot()){return}if(this.get6WRootFather().getFullPredicateID()!=="void"){return}N=this;O=this;while(!N.is6WRoot()){if(N!==this){O=O.getFather()}N=N.getFather()}N.removeChild(O);P.addChild(O)};this.is6WRoot=function(){return C===i};this.isGod=function(){return this===i};return this}d={"ds6w:who":"Who","ds6w:when":"When","ds6w:what":"What","ds6w:where":"Where","ds6w:why":"Why","ds6w:how":"How"};a.weights={};a.defaultExpands={};a.allowFreeInput={};a.getElementsNLS=function(){if(Object.keys(g).length!==0){var t,s,w,r="",x;t=function(A,I){var J,B,G,E,F,C;var D;var H=[];E=A.vocabularyElementNLSInfo;if(E.length&&E[0]){for(B=0,G=E.length;B<G;B++){J=E[B];if(J.uri&&J.nlsName){d[J.uri]=J.nlsName;var z=a.getPredicate(J.uri);D=J.dataType==="dateTime"?"date":J.dataType;if(z&&D){z.setType(D)}}}if(H.length!==0){o.push(new n("WARNING R419x: tags that appear in RED, got primitive types that are inconsistant with the dictionnary, please check your data on these predicates: "+H))}}m={};I("ElementsNLS OK");return true};for(var v in g){r=[];for(var y in g[v].map){r.push(y)}r=r.join(",");x=new j(function(z){g[v].server.getElementsNLS(r,t,z)});m[v]=x}g={}}var u=[];for(var v in m){u.push(m[v])}return u};a.getElementsToTranslate=function(){return g};a.getPendingPromisesForElementsToTranslate=function(){return m};a.addElementsToTranslate=function(t,u){if(d[t]===undefined&&u){var r={},s=u.getTenantName();if(!g[s]){g[s]={}}r[t]=true;g[s].server=g[s].server||u;g[s].map=h.merge(g[s].map?g[s].map:{},r);d[t]=null}};b="(ds6w:who|ds6w:when|ds6w:what|ds6w:where|ds6w:why|ds6w:how|void)";e=new RegExp("^"+b+"$");i=null;a.getRoots=function(r){if(!r){r=function(){return true}}if(i){return i.getChildren(r)}return[]};a.getClassDispValue=function(r){return d[r]||null};a.getPredicate=function(r){return f[r]};a.count=function(){if(i){return i.countDescendants()}return 0};return a});define("DS/TagNavigator/TagValue",["UWA/Core","UWA/Class/Promise","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/NotificationManager","DS/TagNavigator/Notification"],function(f,i,a,n,j,l,k){var m=function(){j.error("Fail to create a tagvalue with unvalid arg");throw new Error("Invalid input arg")};var g=/\w+:\w+\.\w+/;var o=/\w+:\w+/;var e=0;var d={};var c={};function b(q){var p=c[q.pred.id()];if(p){return p[q.originalDisplayValue?q.originalDisplayValue:q.displayValue]}}function h(p,q,u){this.pred=p;this.count=q.count||0;this.type=q.type;this.uri=q.uri;this.explicit=(q.explicit===undefined)?this.pred.is6WRoot():q.explicit;this.displayValue=q.displayValue;this.icon=q.icon;if(!q.hasDisplayValue){var t=this.pred.id()==="ds6w:type";var v=g.test(this.displayValue);if(t||(v&&!this.explicit)){if(!b(this)&&u){var s=u.getTenantName();var r=d[s];if(!r){r={server:u,toTranslate:{}};d[s]=r}var w=r.toTranslate[this.pred.id()];if(!w){w={};r.toTranslate[this.pred.id()]=w}if(v){this.originalDisplayValue=this.displayValue.substr(this.displayValue.indexOf(".")+1,this.displayValue.length);w[this.originalDisplayValue]=true}else{if(t){w[this.displayValue]=true}}}else{this.displayValue=b(this)||this.displayName}}}this.parent=q.parent;this.fullid=q.fullid;e++}h.prototype={incrementCount:function(p){this.count=this.count+p},decrementCount:function(p){this.count=this.count-p;if(this.count<=0){delete h.tagvalues[this.fullid]}},getUri:function(){return this.uri},getDisplayValue:function(){return b(this)||a.getClassDispValue(this.displayValue)||this.displayValue},getCount:function(){return this.count},isExplicit:function(){return this.isExplicit},getParent:function(){return this.parent},toString:function(){return this.fullid}};h.tagvalues={};h.getTagValue=function(q,z,t,A,x,y){var r,D,C,s,v,u;C={};if(f.is(q)&&!f.is(q,["string","array"])&&!(q instanceof a)){s=q;C.uri=s.object;C.displayValue=s.dispValue;C.explicit=s.explicit;C.type=s.type?s.type.split("-")[0]:s.type;C.icon=s.icon;D=s.sixw||s.predicate}else{C.uri=t;C.displayValue=z;C.explicit=x;C.type=A?A.split("-")[0]:A;D=q}if(C.type&&C.type.startsWith("xsd:")){C.type=C.type.substr(4,C.type.length)}if(f.is(D,["string","array"])){var p={sixw:D,type:C.type,server:y};try{D=new a(p)}catch(w){l.push(new k("Fail to create a predicate with invalid arg. Id is :'"+p.sixw+"'"));l.dispatch()}}if(!(D instanceof a)||!((typeof C.uri==="string"||Array.isArray(C.uri))&&C.uri.length!==0)){m()}if((C.type!=="string")&&(C.type!=="integer")&&(C.type!=="float")&&(C.type!=="double")&&(C.type!=="date")&&(C.type!=="tree")&&(C.type!=="boolean")){C.type="string"}C.hasDisplayValue=(UWA.is(C.displayValue,"string")&&C.displayValue.length>0)||(UWA.is(C.displayValue,"array")&&UWA.is(C.uri,"array")&&C.displayValue.length===C.uri.length);if(!C.hasDisplayValue){C.displayValue=C.uri}var B=C.fullid=D.getFullPredicateID()+C.type+C.uri+typeof C.uri;r=h.tagvalues[B];if(!r){if(C.type==="date"){v=C.uri.split("/");if(v.length===2&&!isNaN(v[1])){C.displayValue=v[0]+"/"+n.getNLSMonthArray()[parseInt(v[1],10)-1]}}if(C.type==="tree"||Array.isArray(C.uri)||C.type==="date"){v=Array.isArray(C.uri)?C.uri.slice(0):C.uri.split("/");u=Array.isArray(C.displayValue)?C.displayValue.slice(0):C.displayValue.split("/");if(u.length!==v.length){u=v.slice(0)}C.displayValue=u[u.length-1];if(v.length>1){v.splice(v.length-1,1);u.splice(u.length-1,1);if(Array.isArray(C.uri)){C.parent=h.getTagValue(D,u,v,C.type,null,y)}else{C.parent=h.getTagValue(D,u.join("/"),v.join("/"),C.type,null,y)}}}r=new h(D,C,y);h.tagvalues[B]=r}return r};h.removeAll=function(){h.tagvalues={}};h.count=function(){return Object.keys(h.tagvalues).length};h.getTvToTranslate=function(){return d};h.getPredicateValue=function(){var u=function(w,y){var v,x;for(v in w){for(x in w[v]){if(!c[v]){c[v]={}}if(!c[v][x]){c[v][x]=w[v][x]}}}y("PredicateValue OK")};var r=[];for(var t in d){var q={};for(var p in d[t].toTranslate){q[p]=Object.keys(d[t].toTranslate[p])}var s=new i(function(w,v){d[t].server.getPredicateValue(q,u,w)});r.push(s)}d={};return r};return h});define("DS/TagNavigator/AbstractPredicateView",["UWA/Core","UWA/Class","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS","DS/TagNavigator/ColorManager","DS/UIKIT/Input/Date","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Autocomplete","DS/UIKIT/Mask","UWA/Promise"],function(j,b,a,p,d,g,c,e,o,f,l){var n,h={},m={},i={};var k=/^[\w-.\s,]*$/;var q=function(u,w,r,s){var v;var t=function(){var B=r||this,A=arguments,x;var z=function(){v=null;if(!s){x=u.apply(B,A)}};if(v){clearTimeout(v)}if(s){var y=!v;v=setTimeout(z,w);if(y){x=u.apply(this,A)}}else{v=setTimeout(z,w)}return x};t.cancel=function(){clearTimeout(v);v=null};return t};n=b.extend({init:function(r,u){if(!(r instanceof a)){throw new Error("Invalid input arg")}this.taggerView=u;this.nbDescendantTagValues=0;this._id=r.id();this._displayName=r.displayName();this._tagValueViews=[];this._tagValueViewsMap={};this._predicate=r;this._colorize=false;this.criterion={};this.colorManager=null;this.debouncedRequestSuggestions=q(this.taggerView.observedNavImpl.requestSuggestions,250,this.taggerView.observedNavImpl);var s=this.taggerView.getObservedNavigator().getCache();var t=r.getFullPredicateID().split("/");if(t.length>1&&t[0]==="ds6w:when"&&!UWA.is(s.viewMode[this._id])&&u.isDatePickerDefault()){s.setViewMode(this._id,"freeInput")}this.from_keyup_handler=null;this.to_keyup_handler=null;this.boolean_keyup_handler_handler=null},getDisplayname:function(){return this._displayName},getCompleteID:function(r){return this._predicate.getFullPredicateID(r)},getChildrenTagValueViews:function(v){var t,u,s,r;if(!v){v=function(){return true}}r=[];for(u=0,s=this._tagValueViews.length;u<s;u++){t=this._tagValueViews[u];if(v(t.id())){r.push(t)}}return r},getChildTagValueView:function(r){return this._tagValueViewsMap[r]},addTagValueView:function(r){if(this._tagValueViewsMap[r.id()]){throw new Error("Unexpected addition of already existing child TagValueView")}this._tagValueViews.push(r);this._tagValueViewsMap[r.id()]=r;this.incNbDescendantTagValues();return this},predComparator:function(s,r){if(s.getDisplayname().toLowerCase()>r.getDisplayname().toLowerCase()){return 1}if(s.getDisplayname().toLowerCase()<r.getDisplayname().toLowerCase()){return -1}return 0},findInsertionPoint:function(u,w,s){var x,v,r,t;r=0;v=u.length;t=-1;x=0;while(r<v){t=parseInt((r+v)/2,10);x=s(u[t],w);if(x<0){r=t+1}else{if(x>0){v=t}else{return t}}}return r},getComparator:function(r,t){var s=r?1:-1,u=t?1:-1;return this.sortTwoValues.bind(this,s,u)},sortTwoValues:function(u,w,t,s){function v(y,A,z){var x=0;if(A.t!==z.t){x=(A.t>z.t)?1:-1}else{if(!A.localeSort&&!z.localeSort){x=(A.value>z.value?1:(A.value===z.value?0:-1))}else{x=A.value.localeCompare(z.value)}}return x*y}var r=0;r=v(u,t[0],s[0]);if(r===0){r=v(w,t[1],s[1])}return r},getNbDescendantTagValues:function(){return this.nbDescendantTagValues},incNbDescendantTagValues:function(){this.nbDescendantTagValues++;return this},isRootPredView:function(){return this._isRootPredView},hasSuggestSupport:function(){var r=this._predicate.getElemOptions();return(r&&r.multiSelect&&r.allowFreeInput)&&(false!==this._predicate.isSuggestSupported())},updateSuggestions:function(r){if(!j.is(this.criterion,"object")||!j.is(this.criterion.string)){return}var s=this.criterion.string.getDataset("displayedSuggestions");if(!j.is(r)||!j.is(r.items,"array")||r.items.length===0){if(UWA.is(this.resolve,"function")){this.reject({type:"error",dataset:s})}return}r.items.unshift({label:this.criterion.string.elements.input.value,value:this.criterion.string.elements.input.value,isUserText:true});if(UWA.is(this.resolve,"function")){this.resolve({dataset:s,matchingItems:r.items})}},id:function(){return this._id},idForDOM:function(){return this.taggerView.getDOMId(this._predicate.getFullPredicateID())},createTempArrayForSort:function(s,r){var t;t=s.map(function(u,x){var C=null,y=null,A=[],z,w=false,v=false,B=u.type();C={value:u.nbSubjectsTagged(),t:0,localeSort:false};if(B==="date"){z=u.id().toLowerCase();w=false}else{z=u.getDisplayname();if(isNaN(z)&&j.is(z,"string")){z=z.toLowerCase();w=!k.test(z)}else{z=parseFloat(z);w=false;v=true}}y={value:z,t:v?0:(B==="date"?1:2),localeSort:w};A.index=x;if(r.sortMode==="nbSort"){A.push(C);A.push(y)}else{A.push(y);A.push(C)}return A});return t},sortTagValues:function(t){var r,s;r=this.taggerView.getObservedNavigator().getCache().getCurrentSort(this._predicate.getFullPredicateID());if(this.getChildrenTagValueViews().length!==0&&this.getChildrenTagValueViews()[0].nbSubjectsTagged()<0&&r.sortMode!=="alphaSort"){this.taggerView.getObservedNavigator().getCache().changeSort("alphaSort",this._predicate.getFullPredicateID())}r=this.taggerView.getObservedNavigator().getCache().getCurrentSort(this._predicate.getFullPredicateID());s=this.createTempArrayForSort(t,r);s.sort(this.getComparator(r.order,r.secondaryorder));s=s.map(function(u){return t[u.index]});return s},destroyUiElement:function(s){if(s){delete i[this.id()]}else{delete m[this.id()]}if(Object.keys(this.criterion).length){var r=Object.keys(this.criterion)[0];switch(r){case"graph":case"string":this.criterion[r].destroy();break;case"integer":case"float":case"double":case"date":if(this.from_keyup_handler){this.criterion[r]["from"].elements.input.removeEvent("keyup",this.from_keyup_handler)}this.from_keyup_handler=null;if(this.to_keyup_handler){this.criterion[r]["to"].elements.input.removeEvent("keyup",this.to_keyup_handler)}this.to_keyup_handler=null;this.criterion[r].from.destroy();this.criterion[r].to.destroy();break;case"boolean":if(this.boolean_keyup_handler){this.criterion[r].elements.input.removeEvent("keyup",this.boolean_keyup_handler)}this.boolean_keyup_handler=null;this.criterion[r].destroy();break}delete this.criterion[r]}if(this.resolve){this.resolve=null}if(this.reject){this.reject=null}},redrawUiElement:function(t){var I,x,O=this,s={},Q,U=["from","to"],J=this.taggerView.getObservedNavigator().getCache(),y=this.taggerView.getObservedNavigator().getFocusedProxy(),E=this._predicate.getElemOptions(),H=J.getCriteriaToResetBeforeFilterChange(y?y.id():undefined),M=J.getCriteriaToRemoveBeforeFilterChange(y?y.id():undefined),P=this.taggerView.getObservedNavigator().getCache().getViewMode(this.id()),R=this.taggerView.getDOMId(this.getCompleteID());if(t){I=this.taggerView.taggerUWAElement.getElement("#"+R+"sug")}else{I=this.taggerView.taggerUWAElement.getElement("#"+R)}if(!j.is(I)){return}if(!t&&P.indexOf("graph")===0){x="graph"}else{x=this._predicate.getType()}switch(x){case"graph":var V=P==="graphBar";var u=R.concat("_graph");I=this.taggerView.taggerUWAElement.getElement("#"+u);require(["DS/W3DXComponents/Views/GraphView"],function(v){O.criterion.graph=new v({type:V?"column":"pie",width:O.dataForGraph.widthBarChartGraph,series:[{type:V?"column":"pie",pointRange:O.dataForGraph.dateRange,data:O.dataForGraph.completeData,borderWidth:V?2:1,borderColor:V?null:"white"}],expertOpts:{chart:{zoomType:"x"},title:{text:null},plotOptions:{pie:{borderWidth:1,borderColor:"#FFFFFF",point:{events:{legendItemClick:function(){if(this.id){O.taggerView.toggleTagSelection(this.id.replace("atv",""))}else{return false}}}},dataLabels:{enabled:false},showInLegend:true},column:{states:{select:{color:null,borderWidth:2,borderColor:"#368ec4"}},colorByPoint:true},series:{allowPointSelect:false,cursor:"pointer",point:{events:{click:function(){if(this.id){O.taggerView.toggleTagSelection(this.id.replace("atv",""))}}}},turboThreshold:10000}},legend:{enabled:!V,maxHeight:"56",itemStyle:{width:"150px",textOverflow:"ellipsis",overflow:"hidden"},labelFormat:'{name} <span style="font-weight:normal">({percentage:.1f}%)</span>'},xAxis:{type:O.dataForGraph.datetime?"datetime":"category",tickInterval:O.dataForGraph.datetime?O.dataForGraph.dateRange:null,minRange:O.dataForGraph.datetime?O.dataForGraph.dateRange:null,dateTimeLabelFormats:{day:"%d",month:"%B",year:"%Y"},labels:{rotation:-45,formatter:O.dataForGraph.datetime?null:function(){var W=this.value;if((W.length>10)&&!O.dataForGraph.datetime){W=W.substring(0,9).concat("...")}return W}},reversed:O.dataForGraph.datetime?O.dataForGraph.reversed:false,crosshair:true},tooltip:{pointFormat:V?"<b>{point.y}</b>":"<b>{point.y}</b> ({point.percentage:.1f}%)",formatter:null,positioner:V?function(Z,Y,X){var W,aa;W=X.plotX+O.criterion.graph._highcharts.plotLeft-(Z/2);if(Y>X.plotY){aa=O.criterion.graph._highcharts.plotHeight+O.criterion.graph._highcharts.plotTop+10}else{aa=X.plotY+O.criterion.graph._highcharts.plotTop-Y-10}return{x:W,y:aa}}:undefined}}});O.criterion[x].setContainer(I).render();if(I&&(I.scrollWidth!==I.clientWidth)){I.setStyle("padding-bottom","15px")}});break;case"string":s.onKeyDown=function(v){if([8,46].indexOf(v.keyCode)!==-1&&!this.options.multiSelect&&v.target.value){this.options.events.onUnselect.call(this,this.selectedItems[0])}else{return false}};s.onKeyUp=function(Y){var X,v=[],W,aa,Z;if([8,46].indexOf(Y.keyCode)!==-1){return false}else{if(Y.keyCode!==13||Y.target.value){if(O._id==="fts_value"){H[O._predicate.id()]=H[O._predicate.id()]||{type:"string",value:[]};aa=H[O._predicate.id()].value||[];aa.forEach(function(ac,ab){if(ac.pending===true){W=ab;return false}else{return true}});if(Y.target.value.length>0){Z={label:Y.target.value,value:Y.target.value,selected:true,pending:true};aa.splice(W,W!==-1?1:0,Z)}else{aa.splice(W,1)}}return false}}if(t){O.taggerView.onSearchLaunch()}else{for(X=0;X<this.getSelection().length;X++){v.push({predicate:O._predicate,value:this.getSelection()[X].value,type:"string"})}O.taggerView.observedNavImpl.createFreeInputs(v)}};s.onSelect=function(Z){if(O._id=="ds6w:dataSource"){f.mask(i["ds6w:type"].criterion.string.elements.container)}var v=[],X,W,v;var Y=this.getSelection();if(typeof Y==="string"){if(Z!==undefined){Y=[Z]}else{Y=[]}}if(O._predicate.warnSelect()&&O._predicate.isEnum()){for(X=0;X<Y.length;X++){v.push(Y[X].value)}O.taggerView.warnProxyOfCriteriaChange({sixw:O._predicate.getFullPredicateID(),value:v})}if(typeof Y[Y.length-1]==="string"){Y.pop()}if(O._id==="fts_value"){v=H[O._predicate.id()]?(H[O._predicate.id()].value||[]):[];v.forEach(function(ab,aa){if(ab.pending===true){W=aa;return false}else{return true}});if(W!==-1){v.splice(W,1)}}if(Y.length>0){H[O._predicate.id()]={value:Y,type:"string"}}else{delete H[O._predicate.id()]}n.checkActiveSearch(O.taggerView)};if(!O._predicate.isEnum()){s.onBlur=function(W){if(O.hasSuggestSupport()){this.resetCache()}var v,X;if(!W.target.value||(UWA.is(O.criterion.string.datasets,"array")&&O.criterion.string.datasets.length>0)){return}X=W.target.value.replace(/\||\n/g,"\t").replace(/^\s+|\s+$/g,"").split("\t").filter(function(aa,Z,Y){return Y.indexOf(aa)===Z}).map(function(Y){return{value:Y,selected:true}});this.addItems(X,{items:[]});W.target.value="";if(O._id==="fts_value"){v=H[O._predicate.id()]?(H[O._predicate.id()].value||[]):[];for(Q=0;Q<v.length;Q++){if(v[Q].pending){delete v[Q].pending}}}this.onSelect(this.getItemFromSuggestion(W.target.value))}}s.onUnselect=function(Y){if(this.opened){return}var v=[],W;var X=this.getSelection();if(O._predicate.warnSelect()&&O._predicate.isEnum()){for(W=0;W<X.length;W++){v.push(X[W].value)}O.taggerView.warnProxyOfCriteriaChange({sixw:O._predicate.getFullPredicateID(),value:v})}if(typeof X[X.length-1]==="string"){X.pop()}if(X.length>0){H[O._predicate.id()]={value:X,type:"string"}}else{delete H[O._predicate.id()]}if(t){M.push({predicate:O._predicate,type:"string",value:Y.value})}else{O.taggerView.getObservedNavigator().getFocusedProxy().removeFreeInputs([{predicate:O._predicate,type:"string",value:Y.value}])}if(E&&E.datasets&&E.datasets.items&&E.datasets.items.length){E.datasets.items.forEach(function(Z){if(Z.predefined===true){Z.predefined=false}})}n.checkActiveSearch(O.taggerView)};if(E&&E.events){delete E.events}var S=j.merge((E||{}),{showSuggestsOnFocus:true,placeholder:p.getText("typestring"),multiSelect:true,allowFreeInput:!O._predicate.isEnum(),noResultsMessage:!O._predicate.isEnum()?false:p.getText("noRslt"),events:s});if(O.hasSuggestSupport()){S.datasets={name:"displayedSuggestions",items:[],configuration:{templateEngine:function(W,Y,v){W.addClassName("default-template");var X=UWA.createElement("span",{"class":"item-label"});X.setText(v.label);X.inject(W);if(true===v.isUserText){X.setStyle("font-style","italic")}},remoteSearchEngine:function(v,W){return new l(function(Y,X){O.resolve=Y;O.reject=X;O.debouncedRequestSuggestions(O._id,W)})}}}}else{if(O._predicate.isEnum()){if(O.taggerView._customEnumFiltering){S.datasets.configuration={searchEngine:function(Y,Z){var X=Z.trim();var v=X.toLowerCase();var W=Y.items.filter(function(ac,aa){var ab=ac.label.toLowerCase();var ad=ab.indexOf(v);if(ad!==-1){ac.matchInfo={matchFoundAt:ad};return true}});W.sort(function(ab,aa){if(ab.matchInfo.matchFoundAt===aa.matchInfo.matchFoundAt){return 0}else{if(ab.matchInfo.matchFoundAt>aa.matchInfo.matchFoundAt){return 1}else{return -1}}});return W}}}}}O.criterion[x]=new o(S);if(!O._predicate.isEnum()){O.criterion[x].elements.input.onpaste=(function(v){v.preventDefault();var W;if(v.clipboardData&&UWA.is(v.clipboardData.getData,"function")){W=v.clipboardData.getData("text/plain")}else{if(window.clipboardData&&UWA.is(window.clipboardData.getData,"function")){W=window.clipboardData.getData("text")}}if(UWA.is(W,"string")){var X=W.replace(/\||\n/g,"\t").replace(/^\s+|\s+$/g,"").split("\t").filter(function(aa,Z,Y){return Y.indexOf(aa)===Z}).map(function(Y){return{value:Y,selected:true}});this.addItems(X,{items:[]})}}).bind(O.criterion[x])}if(O._predicate.isEnum()&&E.datasets&&E.datasets.items&&E.datasets.items.length===0){if(H[O._predicate.id()]&&H[O._predicate.id()].value){var w=H[O._predicate.id()].value;for(Q=0,w.length;Q<w.length;Q++){M.push({type:"string",predicate:O._predicate,value:w[Q].value,nls:w[Q].label})}delete H[O._predicate.id()]}}else{if(H[O._predicate.id()]){var K=H[O._predicate.id()].value||[];if(!O._predicate.isEnum()&&K.length!==0){O.criterion[x].addItems(K,{items:[]});for(Q=0;Q<K.length;Q++){if(K[Q].pending){delete K[Q].pending}}}else{for(Q=0;Q<K.length;Q++){if(O.criterion[x].getItem(K[Q].value)){O.criterion[x].onSelect(O.criterion[x].getItem(K[Q].value))}}}}if(E.datasets&&E.datasets.items){E.datasets.items.filter(function(v){return v.predefined===true}).forEach(function(X,W,v){H[O._predicate.id()]=H[O._predicate.id()]||{type:"string",value:[]};W=H[O._predicate.id()].value.map(function(Y){return Y.value}).indexOf(X.value);if(O.criterion[x].getItem(X.value)&&W===-1){O.criterion[x].onSelect(O.criterion[x].getItem(X.value));H[O._predicate.id()].value.push(O.criterion[x].getItem(X.value))}if(v.length===1&&O._id==="ds6w:dataSource"){n.mask=true}})}else{if(E.defaultValue){if(!O._predicate.isEnum()){var N=null;if(UWA.is(E.defaultValue,"string")){N=[E.defaultValue]}else{if(UWA.is(E.defaultValue,"array")){N=E.defaultValue}}if(UWA.is(N,"array")){var D=[];for(var G=0;G<N.length;G++){var A=N[G];if(UWA.is(A,"string")){D.push({value:A,selected:true})}else{console.warn("default value provided is not a string, ignored...")}}if(D.length>0){O.criterion[x].addItems(D,{items:[]})}}}else{console.warn("defaultValue ignored for enum predicate"+O._predicate.id()+", plz provide datasets.items")}delete E.defaultValue}}}this.criterion[x].inject(I.getElement(".add-tag-close"),"before");break;case"integer":case"float":case"double":var B=[],F=null;var C=(x==="integer"?"int":"float");O.criterion[x]={};for(Q=0;Q<U.length;Q++){var r=U[Q];O.criterion[x][r]=new e({placeholder:E&&E.placeholder?E.placeholder:p.getText(r)+":"+p.getText("type"+C+(r==="from"?"min":"max")),className:r});var z=function(Y){var W,v={};W=Y.target.value;W=W.replace(",",".");var X=Y.target.hasClassName("from"),ac=X?"from":"to";var aa=W.length<=0?true:false;if(!aa){if(C==="int"){aa=!isNaN(parseInt(W))&&parseInt(W)+""===W}else{aa=!isNaN(parseFloat(W))&&parseFloat(W)+""===W}}if(UWA.is(Y.target.type,"string")&&Y.target.type=="text"){if(UWA.is(Y.target.parentNode)){if(true===aa){Y.target.parentNode.removeClassName("has-error")}else{return Y.target.parentNode.addClassName("has-error")&&false}}}if(Y.keyCode===13){if(!t&&W){var Z={predicate:O._predicate,type:x};v[ac]=W;Z.value=v;B.push(Z);if(H[O._predicate.id()][ac==="from"?"to":"from"]){F={predicate:O._predicate,type:x};F.value={};F.value[ac==="from"?"to":"from"]=H[O._predicate.id()][ac==="from"?"to":"from"].value}if(F){B.push(F)}O.taggerView.observedNavImpl.createFreeInputs(B);O.taggerView.setActiveCriteria(true,true)}else{if(t){O.taggerView.onSearchLaunch()}}}else{H[O._predicate.id()]=H[O._predicate.id()]||{};H[O._predicate.id()].type=x;if(!W){var ab;ab={predicate:O._predicate,type:x};if(H[O._predicate.id()][ac]&&H[O._predicate.id()][ac].value){ab.value={};ab.value[ac]=H[O._predicate.id()][ac].value;M.push(ab)}delete H[O._predicate.id()][ac]}else{H[O._predicate.id()][ac]={value:W,type:x}}if(Object.keys(H[O._predicate.id()]).length===1){delete H[O._predicate.id()]}}O.taggerView.addOrRemoveClear(Y)};if(r==="from"){if(this.from_keyup_handler){console.warn("keyup handler for 'from' field found, possibly an issue with AbstractPredicateView lifecycle...., Predicate type="+x)}this.from_keyup_handler=z}else{if(this.to_keyup_handler){console.warn("keyup handler for 'to' field found, possibly an issue with AbstractPredicateView lifecycle...., Predicate type="+x)}this.to_keyup_handler=z}O.criterion[x][r].elements.input.addEvent("keyup",z);if(H[O._predicate.id()]&&H[O._predicate.id()][r]){O.criterion[x][r].setValue(H[O._predicate.id()][r].value)}}if(UWA.is(E.defaultValue,"object")){if(UWA.is(E.defaultValue.from)){if(!O.criterion[x].from.getValue()){H[O._predicate.id()]=H[O._predicate.id()]||{type:x};O.criterion[x].from.setValue(E.defaultValue.from);H[O._predicate.id()]["from"]={value:O.criterion[x].from.getValue(),type:x};delete E.defaultValue.from}}if(UWA.is(E.defaultValue.to)){if(!O.criterion[x].to.getValue()){H[O._predicate.id()]=H[O._predicate.id()]||{type:x};O.criterion[x].to.setValue(E.defaultValue.to);H[O._predicate.id()]["to"]={value:O.criterion[x].to.getValue(),type:x};delete E.defaultValue.to}}}this.criterion[x].from.inject(I.getElement(".from.add-tag-close"),"before");this.criterion[x].to.inject(I.getElement(".to.add-tag-close"),"before");break;case"date":s.onChange=function(Y){if(!O.criterion[x]){return}var X=Y.target.tagName==="SPAN"?Y.target.getClosest(".add-tag-cont").getElement("input").hasClassName("from"):Y.target.hasClassName("from"),ab=X?"from":"to",v={},W,aa;H[O._predicate.id()]=H[O._predicate.id()]||{type:"date"};if(!this.getValue()){aa={predicate:O._predicate,type:"date"};W=H[O._predicate.id()][ab].value;W=W.getFullYear()+"/"+("0"+(W.getMonth()+1)).slice(-2)+"/"+("0"+W.getDate()).slice(-2);aa.value={};aa.value[ab]=W;delete H[O._predicate.id()][ab];if(Object.keys(H[O._predicate.id()]).length===1){delete H[O._predicate.id()]}this.setDate("");if(!t){O.taggerView.getObservedNavigator().getFocusedProxy().removeFreeInputs([aa])}else{M.push(aa)}if(X){O.criterion[x].to.setMinDate(false)}else{O.criterion[x].from.setMaxDate(false)}}else{H[O._predicate.id()][ab]={value:this.getDate(),type:"date"};if(X){O.criterion[x].to.setMinDate(this.getDate())}else{O.criterion[x].from.setMaxDate(this.getDate())}if(!t){v[ab]=this.getDate().getFullYear()+"/"+("0"+(this.getDate().getMonth()+1)).slice(-2)+"/"+("0"+this.getDate().getDate()).slice(-2);var Z={predicate:O._predicate,value:v,type:x};O.taggerView.observedNavImpl.createFreeInputs([Z])}}O.taggerView.setActiveCriteria(true,true);O.taggerView.addOrRemoveClear(Y)};O.criterion[x]=n.createDateInput({events:{onChange:s.onChange}},H[O._predicate.id()]);if(UWA.is(E.defaultValue,"object")){if(UWA.is(E.defaultValue.from,"string")){if(!O.criterion[x].from.getDate()){var T=E.defaultValue.from.split("/");if(T.length===3){H[O._predicate.id()]=H[O._predicate.id()]||{type:"date"};O.criterion[x].from.setDate(new Date(parseInt(T[0]),T[1]-1,T[2]),true);H[O._predicate.id()]["from"]={value:O.criterion[x].from.getDate(),type:"date"};delete E.defaultValue.from}}}if(UWA.is(E.defaultValue.to,"string")){if(!O.criterion[x].to.getDate()){var T=E.defaultValue.to.split("/");if(T.length===3){H[O._predicate.id()]=H[O._predicate.id()]||{type:"date"};O.criterion[x].to.setDate(new Date(parseInt(T[0]),T[1]-1,T[2]),true);H[O._predicate.id()]["to"]={value:O.criterion[x].to.getDate(),type:"date"};delete E.defaultValue.to}}}}for(Q=0;Q<U.length;Q++){var z=function(v){if(v.keyCode!==13){return false}O.taggerView.onSearchLaunch()};if(U[Q]==="from"){if(this.from_keyup_handler){console.warn("keyup handler for 'from' field found, possibly an issue with AbstractPredicateView lifecycle...., Predicate type=Date")}this.from_keyup_handler=z}else{if(this.to_keyup_handler){console.warn("keyup handler for 'to' field found, possibly an issue with AbstractPredicateView lifecycle...., Predicate type=Date")}this.to_keyup_handler=z}O.criterion[x][U[Q]].elements.input.addEvent("keyup",z)}this.criterion[x].from.inject(I.getElement(".from.add-tag-close"),"before");this.criterion[x].to.inject(I.getElement(".to.add-tag-close"),"before");break;case"boolean":s.onChange=function(v){var W=this.getValue()[0];if(W&&!t){O.taggerView.observedNavImpl.updateFreeInputs([{predicate:O._predicate,value:W,type:x}],[{predicate:O._predicate,value:W==="true"?"false":"true",type:x}])}else{if(H[O._predicate.id()]){M.push({predicate:O._predicate,value:H[O._predicate.id()].value,type:x})}if(W){H[O._predicate.id()]={value:W,type:x}}else{delete H[O._predicate.id()]}}n.checkActiveSearch(O.taggerView)};var L=H[O._predicate.id()]?H[O._predicate.id()].value:null;if(!UWA.is(L)){if(E&&UWA.is(E.defaultValue)){if(UWA.is(E.defaultValue,"string")){L=E.defaultValue.toLowerCase();H[O._predicate.id()]={type:x,value:L};delete E.defaultValue}else{console.warn("defaultValue specified for boolean type of field is not a string")}}}O.criterion[x]=new c({placeholder:p.getText("selectValue"),options:[{value:"true",label:p.getText("yes"),selected:L==="true"},{value:"false",label:p.getText("no"),selected:L==="false"}],events:s.onChange?s:{}});if(O.boolean_keyup_handler){console.warn("keyup handler for 'boolean' field found, possibly an issue with AbstractPredicateView lifecycle....")}O.boolean_keyup_handler=function(v){if(v.keyCode!==13){return false}O.taggerView.onSearchLaunch()};O.criterion[x].elements.input.addEvent("keyup",O.boolean_keyup_handler);this.criterion[x].inject(I.getElement(".boolean"));break}if(x==="integer"||x==="float"||x==="double"||x==="date"){this.taggerView.addOrRemoveClear(this.criterion[x].from.elements.input);this.taggerView.addOrRemoveClear(this.criterion[x].to.elements.input)}if(n.mask===true&&i["ds6w:type"]&&i["ds6w:type"].criterion.string&&i["ds6w:type"].criterion.string.datasets[0].items.length===0){f.mask(i["ds6w:type"].criterion.string.elements.container);n.mask=false}},getTagValueViewOfSelectedDate:function(r,z,s,v){var u,w,y=[],t,x;w=z.split("/").length;if(w===1){u=r.length>1?r.filter(function(A){return A.id()===z}).pop():r[0];if(s){t=u.getChildrenTagValueViews();for(x=0;x<t.length;x++){if(t[x].getDisplayname().toLowerCase().indexOf(v)!==-1){y.push(t[x])}}}else{y=u.getChildrenTagValueViews()}}else{if(w===2){u=r.length>1?r.filter(function(A){return A.id()===z.split("/")[0]}).pop().getChildrenTagValueViews():r[0].getChildrenTagValueViews();u=u.length>1?u.filter(function(A){return A.id()===z}).pop():u[0];if(s){t=u.getChildrenTagValueViews();for(x=0;x<t.length;x++){if(t[x].getDisplayname().toLowerCase().indexOf(v)!==-1){y.push(t[x])}}}else{y=u.getChildrenTagValueViews()}}else{if(w===3){u=r.length>1?r.filter(function(A){return A.id()===z.split("/")[0]}).pop().getChildrenTagValueViews():r[0].getChildrenTagValueViews();u=u.length>1?u.filter(function(A){return A.id()===z.split("/").slice(0,-1).join("/")}).pop().getChildrenTagValueViews():u[0].getChildrenTagValueViews();u=u.length>1?u.filter(function(A){return A.id()===z}).pop():u[0];if(s){t=r[0].getChildrenTagValueViews()[0].getChildrenTagValueViews();for(x=0;x<t.length;x++){if(t[x].getDisplayname().toLowerCase().indexOf(v)!==-1){y.push(t[x])}}}else{y=u.getMotherView().getChildrenTagValueViews()}}}}return{motherDate:u,tvv:y}},getElementTvvForGraph:function(x,N){var G,v,z,O=false,r=false,B=1,P=[],H,K,F=0,w=0,u=0,y=this,J=[],M=[],I,A=[],D=[],L=0.5,t=31,E=this.taggerView.getObservedNavigator().getCache();function C(S,R){var Q,T={name:S.getDisplayname(),id:y.taggerView.getDOMId(S.getSelectedTagId()),category:S.getDisplayname(),y:S.nbSubjectsTagged(),selected:S.isSelectedTag(),sliced:S.isSelectedTag(),color:E.colorManager.getNewColorForTagValue(S)};if(R){Q=new Date(S.id().split("/").join("-"));T.x=Date.UTC(Q.getFullYear(),Q.getMonth(),Q.getDate())}return T}function s(Q,R,S){return{name:Q,category:R,y:S,selected:false,sliced:false}}D=x.slice(0);if(x.length&&(x[0].type()==="date")){O=true;switch(x[0].getDateLevel()){case"year":B=365;break;case"month":B=30;break;case"day":B=1;break}}for(G=0;G<x.length;G++){F=F+x[G].nbSubjectsTagged()}for(G=0;G<x.length;G++){if(((x[G].nbSubjectsTagged()*100)/F)<L){J.push(x[G])}else{M.push(x[G])}}w=0;if((J.length>0)&&(typeof J!=="undefined")){for(G=0;G<J.length;G++){w=w+J[G].nbSubjectsTagged()}}z=this.taggerView.getObservedNavigator().getCache().getCurrentSort(this._predicate.getFullPredicateID());r=O&&z.sortMode==="alphaSort"&&N;if(M.length>t){if((z.sortMode==="nbSort")&&(z.order===false)){A=M.splice(t,M.length);for(G=0;G<A.length;G++){u=u+A[G].nbSubjectsTagged()}}else{A=M.splice(0,M.length-t);for(G=0;G<A.length;G++){u=u+A[G].nbSubjectsTagged()}}}if((w<F*(3/4))&&!N&&J.length>0){if(z.sortMode==="alphaSort"){for(G=0;G<M.length;G++){P.push(C(M[G],r))}P.push(s(p.getText("otherUnderThreshold"),p.getText("otherUnderThreshold"),w));if(A.length>0){P.push(s(p.getText("other"),p.getText("other"),u))}}else{if(z.order===true){P.push(s(p.getText("otherUnderThreshold"),p.getText("otherUnderThreshold"),w));if(A.length>0){P.push(s(p.getText("other"),p.getText("other"),u))}for(G=0;G<M.length;G++){P.push(C(M[G],r))}}else{if(z.order===false){for(G=0;G<M.length;G++){P.push(C(M[G],r))}if(A.length>0){P.push(s(p.getText("other"),p.getText("other"),u))}P.push(s(p.getText("otherUnderThreshold"),p.getText("otherUnderThreshold"),w))}}}}else{if(x.length>t){if(z.sortMode==="nbSort"){if(z.order===true){A=D.splice(0,x.length-t);for(G=0;G<A.length;G++){u=u+A[G].nbSubjectsTagged()}if(A.length>0){P.push(s(p.getText("other"),p.getText("other"),u))}for(G=0;G<D.length;G++){P.push(C(D[G],r))}}else{A=D.splice(t,D.length-t);for(G=0;G<A.length;G++){u=u+A[G].nbSubjectsTagged()}for(G=0;G<D.length;G++){P.push(C(D[G],r))}if(A.length>0){P.push(s(p.getText("other"),p.getText("other"),u))}}}else{A=D.splice(0,D.length-t);for(G=0;G<A.length;G++){u=u+A[G].nbSubjectsTagged()}for(G=0;G<D.length;G++){P.push(C(D[G],r))}if(A.length>0){P.push(s(p.getText("other"),p.getText("other"),u))}}}else{for(G=0;G<D.length;G++){P.push(C(D[G],r))}}}return{completeData:P,dateRange:r?B*24*3600*1000:null,datetime:r,reversed:!z.order}},tvvToHtml:function(s,R){var w=0,Q=0,D=20,N=5,ad,ab,aa,ac,Y,X,T,L,J,O="",K="",t=this._predicate.getFullPredicateID(),r=this.taggerView.getDOMId(t),ae=this._predicate.getType()?this._predicate.getType():this._tagValueViews[0]?this._tagValueViews[0].type():"string",M=this._predicate.isTypeValidBool(),z=this.taggerView.getObservedNavigator().getCache(),x=z.getViewMode(this.id()),A=this.taggerView.getObservedNavigator().getFocusedProxy(),Z=z.getCriteriaToResetBeforeFilterChange(A?A.id():undefined),W=z.getCriteriaToRemoveBeforeFilterChange(A?A.id():undefined),B=z.colorManager,v=this;this.isColorized=this.taggerView.isColorizePossible(this.id())&&B.isColorized(t);if(x==="freeInput"&&!this.taggerView.isProxyWithFilteringOnServer()){z.setViewMode(this.id(),"tag");x=z.getViewMode(this.id())}ab=z.getSearchValue().toLowerCase();aa=z.getSearchId();ad=z.isSearchVisible()&&ab!==""&&(aa==="filter-all"||aa.replace("filter-","")===this._predicate.get6WRootFather().id().replace("ds6w:",""));if(s||!ad){this._tagValueViews=this.sortTagValues(this._tagValueViews)}if(x!=="freeInput"&&this._tagValueViews.length!==0&&this._tagValueViews[0].type()==="date"){J=this.taggerView.getListOfSelectedTagValues(this.getCompleteID());if(J.length){O=J[0].uri}}if(R){X=i;x="freeInput"}else{X=m}switch(x){case"tag":if(!this.isColorized){B.clearComputedColorMap(t)}var u=this._tagValueViews[0].type()==="tree";K+="<ul class='tags-list "+(u?" treeview":"")+(ae==="date"?" date":"")+"'>";var P=this.taggerView.getMoreLimitForPredicate(this._predicate.id());if(!ad){for(ac=0;ac<this._tagValueViews.length&&ac<=P;ac++){if(ac!==P){K+=this._tagValueViews[ac].toHtml(ac<P,false,O,"",M)}else{K+=n.more(this._tagValueViews.length-P)}}}else{for(ac=0;ac<this._tagValueViews.length;ac++){T=this._tagValueViews[ac].getNbTagMatch(ab);if(T>0&&w<P){K+=this._tagValueViews[ac].toHtml(w<P,false,O,ab,M);w+=T}else{if(T>0){Q+=T}}}if(Q!==0){K+=n.more(Q)}if(w>0){z.expandPredicate(this.idForDOM())}else{if((!this._isRootPredView&&this.taggerView.isW)||!this.taggerView.isW){z.collapsePredicate(this.idForDOM())}else{if(this.getDisplayname().toLowerCase().indexOf(ab)===-1){this._hiddenPredicate=true}}}}K+="</ul>";break;case"freeInput":var E={},G=this._predicate.getElemOptions();ae=(ae==="tree")?"string":ae;switch(ae){case"dateTime":case"date":case"integer":case"float":case"double":K+="<div class='add-tag-cont fromto'>";K+=n.freeInputToHtml(ae,this);break;case"boolean":case"string":K+="<div class='add-tag-cont'>";K+=n.freeInputToHtml(ae,this);break}X[this.id()]=this;K+="</div>";break;case"graphBar":case"graphPie":r=this.taggerView.getDOMId(t);var H,y=x==="graphBar",S=r.concat("_graph");H=ad?this._tagValueViews.filter(function(af){return af.getNbTagMatch(ab)>0}):this._tagValueViews;if(H.length!==0){if(ad){z.expandPredicate(this.idForDOM())}if(H[0].type()==="date"&&O!==""){var V=this.getTagValueViewOfSelectedDate(H,O,ad,ab),U=V.motherDate;if(U){this._tagValueMarkup="<ul class='date-filters'>"+U.toHtml(true,true)+"</ul>"}H=this.sortTagValues(V.tvv)}this.dataForGraph=this.getElementTvvForGraph(H,y);var C=this.dataForGraph.completeData.length;if(this.dataForGraph.datetime){C=Math.abs(this.dataForGraph.completeData[C-1].x-this.dataForGraph.completeData[0].x)/this.dataForGraph.dateRange}L=C*(D+2*N)+80;L=(L>310&&y)?L:null;this.dataForGraph.widthBarChartGraph=L;m[this.id()]=this;K+="<div class='graph' id='"+S+"'></div>"}else{if(this.getDisplayname().toLowerCase().indexOf(ab)===-1){z.collapsePredicate(this.idForDOM());this._hiddenPredicate=true}}break}if(z.colorManager.isColorized(t)){var I=[],F=O?((O.split("/").length)===3?3:(O.split("/").length+1)):1;if(this._predicate.getType()==="date"){for(ac=0;ac<B.computedColorMap[t].tagColors.length;ac++){if(B.computedColorMap[t].tagColors[ac].object.split("/").length==F){I.push(B.computedColorMap[t].tagColors[ac])}}this.taggerView.warnForColorize({}[t]={tagColors:I})}else{if(u){this.taggerView.warnForColorize({}[t]={tagColors:B.computedColorMap[t].tagColors.concat(B.getColoredTreeTagList())});B._clearTempTreeMap()}else{this.taggerView.warnForColorize(B.computedColorMap[t])}}}return K},toHtml:function(w,A,B,x){var z,t,u=n.isInFavorites(this.id())||false,y=this.taggerView.getObservedNavigator().getCache().isMoreClicked(),s=this.taggerView.getObservedNavigator().getCache(),x=s.getSearchValue().toLowerCase(),r=s.isSearchVisible()&&x!==""&&(s.getSearchId()==="filter-all"||s.getSearchId().replace("filter-","")===this._predicate.get6WRootFather().id().replace("ds6w:","")),C=this._predicate.getElemOptions(),v=function(D){if(D.getDisplayname().toLowerCase().indexOf(x)!==-1){return true}else{return D.getChildrenTagValueViews().some(v)}};A=A||false;B=B||false;if(A===u){this._hiddenPredicate=r&&!this._tagValueViews.some(v);if(r&&!this._hiddenPredicate){s.collapsePredicate(this.idForDOM())}this._tagValueMarkup="";this.destroyUiElement(B);z="";if((this._tagValueViews.length&&!B)||(B&&((C&&(C.showByDefault===true||C.showByDefault===undefined))||y))){z=this.tvvToHtml(w,B)+"</div></div></li>";t=this.headerToHtml(this._tagValueMarkup,this._hiddenPredicate,B);z=t+z}return z}},headerToHtml:function(u,v,s){var r="",t=this.taggerView.isColorizePossible(this.id());u=u||"";r+=n.predHeader(this,this.taggerView,u,v,null,false,t,this.isColorized,s);r+=n.openingPredContent(this,false,u,s);return r}});n.openingPredContent=function(v,u,t,s){var r="",w;w=!v.taggerView.getObservedNavigator().getCache().isPredicateCollapsed(v.idForDOM())||(v.taggerView.observedNavImpl.hasProxiesInEdition()&&v._predicate.is6WRoot())||s;if(v.taggerView.observedNavImpl.hasFocusedProxyWithRelevantPredicate()){w=v._predicate.defaultExpand||w}if(v.taggerView.isW){if(v._predicate.is6WRoot()){w=u&&v._predicate.is6WRoot()}}t=t||"";r+="<div class='predicate-content expandable'";if(v.taggerView.isW){r+=(w?'style="height: auto; position: relative;"':'style="height: 0px; overflow: hidden;position: absolute;"')}else{r+=(w?'style="opacity: 1; height: auto; position: relative;"':'style="opacity: 0; height: 0px; overflow: hidden;position: absolute;"')}r+="><div class='innerForTransition'>";return r};n.getArrayDayOfMonth=function(u,v,r){var t=["04","06","09","11"],y,x=[],w,s;if(v==="02"){y=((u%4===0)&&(u%100!==0||u%400===0))?29:28}else{y=(t.indexOf(v)>=0)?30:31}if(r){for(s=1;s<=y;s++){w=(s>9)?String()+s:"0"+s;x.push(w)}}else{for(s=y;s>0;s--){w=(s>9)?String()+s:"0"+s;x.push(w)}}return x};n.isInFavorites=function(r){return h[r]};n.more=function(s){var r="";r+="<li class='tag more' title='"+s+" "+p.getText("moreHidden")+"'>";r+="<div class='tag-elem'><div class='tag-label'><span class='fonticon fonticon-dot-3'></span><span class='fonticon fonticon-right-dir'></span></div>";r+="<div class='tag-tail'><div class='tag-count'>"+p.convertToUnity(s)+"</div></div></div>";r+="</li>";return r};n.predHeader=function(R,z,P,y,x,E,r,W,U){var F,t,D,G=z.getObservedNavigator().getCache(),K=(E?"atv":"")+R.idForDOM(),s=!G.isPredicateCollapsed(R.idForDOM())||(z.observedNavImpl.hasProxiesInEdition()&&R._predicate.is6WRoot()),C=G.isCloud(R.idForDOM()),H=G.isToolboxVisible(R.idForDOM()),w=R.getDisplayname(),V=R&&R._predicate&&R._predicate.getType()==="date",M=x||R.getNbDescendantTagValues(),B=G.getCurrentSort(R._predicate.getFullPredicateID()),u=G.getViewMode(R._predicate.id()),X=z.isProxyWithFilteringOnServer(),A=z.hasFreeInputSupport(R._predicate),S=z.isForbiddenFreeDates(),v=R._predicate.get6WRootFather().id().replace("ds6w:",""),L=z.observedNavImpl.hasProxiesInEdition(),Q=G.isActivePredicate(R.getCompleteID()),I=R.getChildrenTagValueViews().length!==0&&R.getChildrenTagValueViews()[0].nbSubjectsTagged()<0,O=z.getObservedNavigator().isPreciseCount(),J=z.getObservedNavigator().isRelevantPredicate(R.id()),N=J&&!y,T=function(){if(R.taggerView.observedNavImpl.hasFocusedProxyWithRelevantPredicate()){return R._predicate.defaultExpand||s}else{return s||U}};P=P||"";t=(B.sortMode==="nbSort")?(B.order?"asc ":"desc ")+"selected":(B.secondaryorder?"asc ":"desc ");D=(B.sortMode==="nbSort")?(B.secondaryorder?"asc ":"desc "):(B.order?"asc ":"desc ")+"selected";F="<li class='predicate "+(N?"more-relevant ":"")+(T()?"expanded ":"")+(C?"":"list-view ")+v+(y?" searchexcluded ":"")+(W?" colorize ":"")+(Q?" selected ":"")+"' id='"+K+(U?"sug":"")+"' data-rec-id='"+K+"' predicate='"+R.id()+"'><div class='predicate-header' title='"+w+"'>";F+=E?"":"<div class='arrow'><span class='fonticon fonticon-down-dir'></span><span class='fonticon fonticon-right-dir'></span></div>";F+="<div class='predicate-label'><span class='fonticon fonticon-3ds-"+v+"'></span>"+w+"</div>";F+="<div class='predicate-count' title='"+M+"'>"+p.convertToUnity(M,O)+"</div>";if(K.substring(0,6)!=="atvid_"&&!U){F+="<div class='toolbox "+(H?"expanded":"")+"' title='"+p.getText("toolbox")+"'><span class='fonticon fonticon-menu-dot'></span>";F+="<span class='tool-icon toolboxView fonticon tags-view "+(u==="tag"?"selected ":"")+(C?"fonticon-th-tag":"fonticon-list")+"' title='"+p.getText("tagsView")+"'></span>";F+="<span class='tool-icon sort fonticon fonticon-sort-alpha-"+D+"' title='"+p.getText("alphabeticalOrder")+"'></span>";if(!I){F+="<span class='tool-icon sort fonticon fonticon-sort-num-"+t+"' title='"+p.getText("occurenceOrder")+"'></span>";F+="<span class='tool-icon toolboxView bar fonticon fonticon-chart-bar "+(u==="graphBar"?"selected ":"")+"' title='"+p.getText("barChart")+"'></span>";F+="<span class='tool-icon toolboxView pie fonticon fonticon-chart-pie "+(u==="graphPie"?"selected ":"")+"' title='"+p.getText("pieChart")+"'></span>"}if(r){F+="<span class='tool-icon toolboxView fonticon fonticon-palette "+(W?"selected ":"")+"' title='"+p.getText("colorize")+"'></span>"}if(X&&(A||(V&&!S))&&!L){F+="<span class='tool-icon toolboxView fonticon fonticon-text "+(u==="freeInput"?"selected ":"")+"' title='"+p.getText("inputText")+"'></span>"}F+="</div>"}F+="</div>";return F};n.freeInputToHtml=function(t,r){var s="";switch(t){case"string":s+="<span class='add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>";break;case"date":s+="<span class='from add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>";s+="</div><div class='add-tag-cont fromto'>";s+="<span class='to add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>";break;case"integer":case"float":case"double":t=(t==="integer"?"int":"float");s+="<span class='from add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>";s+="</div><div class='add-tag-cont fromto'>";s+="<span class='to add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>";break;case"boolean":s+="<span class='boolean'></span>";break}return s};n.createDateInput=function(t,u){var x,r,s={},v,y,w=["from","to"];for(v=0;v<w.length;v++){y=w[v];s[y]=new g(j.merge({max:u&&u[y]&&u[y]&&(y==="from")?new Date(u[y].value):null,min:u&&u[y]&&u[y]&&(y==="to")?new Date(u[y].value):null,placeholder:p.getText(y),className:"date freeinput tagger-input "+y},t));if(u&&u[y]){s[y].setDate(u[y].value,true)}}return s};n.destroyUiElements=function(){var r;for(r in m){m[r].destroyUiElement()}m={};for(r in i){i[r].destroyUiElement(true)}};n.redrawUiElements=function(r){var s;if(r){for(s in i){i[s].redrawUiElement(true)}}else{for(s in m){m[s].redrawUiElement()}}};n.getPvWithUiElemInSuggested=function(){return i};n.getPvWithUiElemInPage=function(){return m};n.checkActiveSearch=function(r){var u=r.getObservedNavigator().getFocusedProxy();if(!u){throw new Error("ERROR : AbstractPredicateView.checkActiveSearch is called when there is no focused proxy !!!")}var t=r.getObservedNavigator().getCache().getCriteriaToResetBeforeFilterChange(u?u.id():undefined);var s=r.getObservedNavigator().getCache().getCriteriaToRemoveBeforeFilterChange(u?u.id():undefined);if(Object.keys(t).length>=2||(Object.keys(t).length===1?Object.keys(t)[0]!=="ds6w:dataSource":false)||(Object.keys(s).length!==0)&&(Object.keys(t).length===1?Object.keys(t)[0]!=="ds6w:dataSource":Object.keys(t).length>=2)){r.getSearchButton().enable();return true}else{r.getSearchButton().disable();return false}};n.onSearchLaunch=function(s,z){var r,B,D=[],w,E,u=false,v,x,t,y=["from","to"];var C=s.getObservedNavigator().getFocusedProxy();if(!C){throw new Error("ERROR : AbstractPredicateView.onSearchLaunch is called when there is no focused proxy !!!")}var G=s.getObservedNavigator().getCache().getCriteriaToResetBeforeFilterChange(C?C.id():undefined),F=s.getObservedNavigator().getCache().getCriteriaToRemoveBeforeFilterChange(C?C.id():undefined);if(!n.checkActiveSearch(s)){return}for(r in z){E=a.getPredicate(r);if(G[r]){var A=G[r].type;switch(A){case"string":B=G[r].value;if(B.length){for(w=0,B.length;w<B.length;w++){D.push({type:"string",predicate:E,value:B[w].value,nls:B[w].label})}}break;case"boolean":B=G[r].value;if(B){D.push({predicate:E,value:B,type:A})}break;case"integer":case"float":case"double":case"date":x={};for(w=0;w<y.length;w++){v=y[w];B=G[r][v]?G[r][v].value:null;if(B){if(A!=="date"){t=z[r].criterion;x[v]=B.replace(",",".");if(!isNaN(parseFloat(x[v]))){t[A][v].elements.input.removeClassName("has-error")}else{t[A][v].elements.input.addClassName("has-error");u=true}}else{x[v]=B.getFullYear()+"/"+("0"+(B.getMonth()+1)).slice(-2)+"/"+("0"+B.getDate()).slice(-2)}D.push({predicate:E,value:x,type:A})}}break}}}if(u===false){s.observedNavImpl.updateFreeInputs(D,F)}};return n});define("DS/TagNavigator/Filter",["UWA/Core","DS/TagNavigator/Predicate","DS/TagNavigator/TagValue"],function(f,b,a){var e,d=[].slice;e=function(l){var g,i,m,h,j,k;h=2<=arguments.length?d.call(arguments,1):[];m=h[0];j=2<=h.length?d.call(h,1):[];i=l?l[m]:undefined;if(!i){return false}k=j?j.length:null;if(k){g=[i];g=g.concat(j);if(!e.apply(null,g)){return false}if(Object.keys(i).length>0){return true}}return delete l[m]};function c(){var m,j,i,h,l,g,k;g={};k={};i=function(n,o,p){return e(g,n,o,p)};h=function(p,o,r){var s=false,q,n;if(!(p&&o&&r)){throw new Error("Unexpected Error")}p="sixw:"+p;q=k[p];if(q&&q[o]){switch(o){case"string":case"boolean":for(n in q[o]){if(n===r){delete q[o][n]}}s=(Object.keys(q[o]).length===0)?true:false;break;default:if(r.from&&q[o].object.from){q[o].object.from=null;s=q[o].object.to?false:true}else{if(r.to&&q[o].object.to){q[o].object.to=null;s=q[o].object.from?false:true}}break}}if(s){return delete k[p]}return s};m=function(n,q,r,s){var p,o,t;if(!(n&&q&&r&&s)){throw new Error("Unexpected Error")}t={};o=t[n]={};q=q+"-"+typeof r;o=o[q]={};o[r]={disp:s,uri:r};f.extend(g,t,true);p=g[n]?g[n][q]?g[n][q][r]:false:false;if(p){return true}return false};j=function(r,q,t,n){var u,p,o,s=false;n=n||t;if(!(r&&q&&t)){throw new Error("Unexpected Error")}r="sixw:"+r;u={};p=u[r]={};p=p[q]={};switch(q){case"boolean":case"string":if(k[r]&&k[r][q]&&k[r][q]){for(o in k[r][q]){if(k[r][q][o]===t){s=true}}}if(!s){p=p[t]=n}break;p=p.object=t;break;default:p=p.object=t;break}f.extend(k,u,true);return true};l=(function(){var s,o,q,n,r,p;o={};r=["filterPredicates","filterTypes","filterValues"];p=function(){return true};for(q=0,n=r.length;q<n;q++){s=r[q];o[s]=p}return function(x,v){var A,t,w,u,z,y,B;t=f.clone(o);f.extend(t,v);for(u in g){if(t.filterPredicates(u)){y=g[u];for(z in y){if(t.filterTypes(z)){w=y[z];for(B in w){A=w[B].disp;if(t.filterValues(w[B].uri)){x(u,w[B].uri,A,z)}}}}}}return this}}());return{each:function(p,o){var n;n=function(q,s,t,r){return p(a.getTagValue(q,t,s,r))};l(n,o);return this},isEmpty:function(){return Object.keys(g).length===0&&Object.keys(k).length===0},isSelected:function(p){var n,q,r,s,o;n=p.pred.getFullPredicateID();q=p.type+"-"+typeof p.uri;r=p.uri;s=g[n];o=s?s[q]?s[q][r]:null:null;if(o){return true}return false},isSelectedAttribute:function(p,u,s,o){var n,r=false,q,t;n=k[p];if(n&&n[u]){switch(u){case"string":r=f.is(n[u][s]);break;case"boolean":if(s==="any"||n[u][s]===s){r=true}break;default:q=n[u].object.from;t=n[u].object.to;r=(q===s&&!o)||(t===o&&!s)||(q===s&&t===o);break}}return r},getSelectedAttributes:function(){var p,o,s,r,t,n,q;if(Object.keys(k).length===0){return null}q={};for(o in k){p=q[o]=[];s=k[o];for(r in s){if(r==="string"||r==="boolean"){for(t in s[r]){n={object:t,displayValue:s[r][t],type:r};p.push(n)}}else{n={object:{from:s[r].object.from,to:s[r].object.to},type:r};p.push(n)}}}return q},getSelectedTagValues:function(n){var p,q,o=[];p={filterPredicates:function(r){return r===n}};q=function(r){o.push(r)};this.each(q,p);return o},clear:function(){g={};k={};return this},computeDates:function(p,o){var q,n;q=a.getTagValue({object:o.uri,sixw:p,type:"date"});n={disptext:q.displayValue};if(q.parent){n.parent={disptext:q.parent.displayValue,object:q.parent.uri,type:"date"};if(q.parent.parent){n.parent.parent={disptext:q.parent.parent.displayValue,object:q.parent.parent.uri,type:"date"}}}return n},computeFilterObj:function(p,q,t){var F,y,E,u,H,G,x,o,A,B,n,D,v,s,w,C,z,r;u={};F=u.allfilters={};q=q||{};if(t!==false){for(H in g){x=F[H]=[];A=g[H];for(o in A){E=A[o];for(B in E){y=E[B].disp;if(o=="date-string"&&t){r=this.computeDates(H,E[B])}G={disptext:r?r.disptext:y,object:E[B].uri,type:o.split("-")[0],field:q[H+(o.split("-")[0])+B+o.split("-")[1]]?Object.keys(q[H+(o.split("-")[0])+B+o.split("-")[1]]):[],parent:r?r.parent:undefined};x.push(G);r=null}}}}if(!t){for(s in k){w=k[s];s=s.replace("sixw:void/","sixw:");v=F[s]=[];for(C in w){if(C==="string"||C==="boolean"){for(E in w[C]){z={object:E,type:C,displayValue:w[C][E]};v.push(z)}}else{z={object:{from:w[C].object.from,to:w[C].object.to},type:C};v.push(z)}}}}if(p){for(H in u.allfilters){if(!p.allfilters[H]){p.allfilters[H]=u.allfilters[H]}else{for(n=0,D=u.allfilters[H].length;n<D;n++){if(u.allfilters[H][n].type==="date"){if(u.allfilters[H][n].object.length>p.allfilters[H][n].object.length){p.allfilters[H]=u.allfilters[H]}}else{p.allfilters[H].push(u.allfilters[H][n])}}}}return p}return u},removeFreeInput:function(o,n,p){return h(o,n,p)},createFreeInput:function(p,o,q,n){return j(p,o,q,n)},toggle:function(q){var w,s,r,o,t,v,u,p,n;o=q.pred.getFullPredicateID();t=q.type;u=t==="date";v=q.uri;r=false;w={filterPredicates:function(x){return x===o},filterTypes:function(x){return x===t+"-"+typeof v},filterValues:function(y){var x;x=Array.isArray(y)?y.equals(v):y===v;if(u&&y.indexOf(v)===0){x=true}r=r||x;return x||u}};n=false;p=function(x,z,A,y){if(n){throw new Error("Unexpected error")}n=i(x,y,z);return n};l(p,w);if(r&&u&&q.parent){v=q.parent.uri;r=false}else{if(!r&&n&&u&&!q.parent){r=true}}s=(!r)&&m(o,t,v,q.displayValue);return s}}}return c});define("DS/TagNavigator/RootPredicateView",["UWA/Class","DS/TagNavigator/AbstractPredicateView"],function(b,e){var a,d={},c=["ds6w:who","ds6w:when","ds6w:what","ds6w:where","ds6w:why","ds6w:how"];a=b.extend(e,{init:function(f,g){this._isRootPredView=true;this._predicateViews=[];this.weight=f.weight||0;this._parent(f,g)},getChildrenPredicateViews:function(j){var h,i,g,f;if(!j){j=function(){return true}}f=[];for(i=0,g=this._predicateViews.length;i<g;i++){h=this._predicateViews[i];if(j(h.id())){f.push(h)}}return f},addPredicateView:function(g){var f;if(this.getChildrenPredicateViews(function(h){return h===g.id()}).length>0){throw new Error("Unexpected addition of already existing child PredicateView ")}if(g.isRootPredView()){this._predicateViews.push(g)}else{f=this.findInsertionPoint(this._predicateViews,g,this.predComparator);this._predicateViews.splice(f,0,g)}return this},clearContent:function(){var g,h,f;for(h=0,f=this._predicateViews.length;h<f;h++){g=this._predicateViews[h];g.clearContent()}this._predicateViews=[];this._parent();return this},headerToHtml:function(g,i){var h=0,f;if(!this.taggerView.isW){return this._parent(g,i)}if(!g){g=""}f=function(k,n){var m,j,l;l=this._predicateViews;for(m=0,j=l.length;m<j;m++){k=l[m];n+=k._tagValueViews.length}return n}.bind(this);h=f(this,this._tagValueViews.length);return this.rootpredHeader(this.idForDOM(),this.id(),!this.taggerView.observedNavImpl.getCache().isSectionCollapsed(this.id().replace("ds6w:","")),this._displayName,h)+e.openingPredContent(this,!this.taggerView.observedNavImpl.getCache().isSectionCollapsed(this.id().replace("ds6w:","")),this.taggerView.isW?this.id().replace("ds6w:",""):false,g)},rootpredHeader:function(j,i,h,f,g){return"<div class='section ds6w-root-predicate "+(i.replace(":","_"))+(h?" expanded-section":"")+"' id='"+j+"'>"+this.taggerView.sectionHeaderToHtml(f.toLowerCase(),{count:g,isw:true})},toHtml:function(g,i,l,f,j){var h;h="";this._tagValueMarkup="";this._hiddenPredicate=false;if(this.taggerView.isW){h=this.headerToHtml();if(this._tagValueViews.length){h+=this.tvvToHtml(g)}if(this._predicateViews.length){this._predicateViews.sort(this.predComparator);h+="<ul class='predicates-list'>"+this._predicateViews.map(function(m){return m.toHtml()}).join("")+"</ul>"}h+="</div></div></div>"}else{if(!j){j=this.taggerView.observedNavImpl.getCache().get6WSort()}if(j==="sort-tag"){if((this._predicateViews.length||this._tagValueViews.length)){var k=this.id().replace("ds6w:","");h+="<div class='separator "+k+"'><span class='fonticon fonticon-3ds-"+k+"'></span>"+k[0].toUpperCase()+k.substring(1)+" :</div>";if(this._tagValueViews.length){h+=this._parent(g,e.isInFavorites(this.id()))}if(this._predicateViews.length){this._predicateViews.sort(this.predComparator);h+=this._predicateViews.map(function(m){return m.toHtml()}).join("")}}}else{if(this._tagValueViews.length){h+=this._parent(g,e.isInFavorites(this.id()))}}}return h},toHtmlForSeach:function(){var f="";if(this._tagValueViews.length){f+=this.tvvToHtml()}if(this._predicateViews.length){this._predicateViews.sort(this.predComparator);f+="<ul class='predicates-list'>"+this._predicateViews.map(function(g){return g.toHtml()}).join("")+"</ul>"}return f}});a.getRoots=function(i){var h,j,g,f;if(typeof i!=="boolean"){i=false}f=[];for(j=0,g=c.length;j<g;j++){h=d[c[j]];if(!i||h.getNbDescendantTagValues()>0){f.push(h)}}return f};a.clear=function(){var g,h,f;if(Object.keys(d).length){for(h=0,f=c.length;h<f;h++){g=d[c[h]];g.clearContent()}d={}}return this};a.getRootPredicateView=function(f,g){var h=f.id();if(!d[h]){d[h]=new a(f,g)}return d[h]};return a});define("DS/TagNavigator/PredicateView",["UWA/Class","DS/TagNavigator/TaggerNLS","DS/UIKIT/Input/Date","DS/TagNavigator/AbstractPredicateView","DS/TagNavigator/RootPredicateView"],function(b,i,c,f,h){var a,d={};var e=/^[\w-.\s,]*$/;a=b.extend(f,{init:function(j,k){this._parent(j,k);this._rootPredicateView=a.getPredicateView(j.get6WRootFather(),this.taggerView);this._rootPredicateView.addPredicateView(this);this.weight=j.weight||0},clearContent:function(){var k,l,j;this.destroyUiElement();this.destroyUiElement(true);for(l=0,j=this._tagValueViews.length;l<j;l++){k=this._tagValueViews[l];k.clearContent()}this._tagValueViews=[];this._tagValueViewsMap={};this.taggerView=null;return this}});a.clear=function(){var j;d={};f.destroyUiElements();return this};a.getPredicates=function(n){var m,o,k=[],l={},j=[],p=g();for(o in d){if(d.hasOwnProperty(o)){if(d[o]._isRootPredView){l[d[o]._id]=d[o]}else{k.push(d[o])}}}["ds6w:who","ds6w:when","ds6w:what","ds6w:where","ds6w:why","ds6w:how"].forEach(function(q){if(l[q]){j.push(l[q])}});if(n==="sort-weight"||(!n&&p)){return j.concat(k).sort(function(r,q){var s=(q.weight||0)-(r.weight||0);return s===0?r._displayName.localeCompare(q._displayName):s})}else{if(n==="sort-alpha-asc"||!n){return j.concat(k).sort(function(r,q){return r._displayName.localeCompare(q._displayName)})}else{if(n==="sort-alpha-desc"){return j.concat(k).sort(function(r,q){return r._displayName.localeCompare(q._displayName)}).reverse()}else{if(n==="sort-num-asc"){return j.concat(k).sort(function(r,q){if(r.nbDescendantTagValues-q.nbDescendantTagValues===0){return r._displayName.localeCompare(q._displayName)}else{return r.nbDescendantTagValues-q.nbDescendantTagValues}})}else{if(n==="sort-num-desc"){return j.concat(k).sort(function(r,q){if(q.nbDescendantTagValues-r.nbDescendantTagValues===0){return r._displayName.localeCompare(q._displayName)}else{return q.nbDescendantTagValues-r.nbDescendantTagValues}})}}}}}};a.getExistingPredicateViewById=function(j){return d[j]||null};a.getPredicateView=function(j,k){var l=j.id();if(!d[l]){if(j.is6WRoot()){d[l]=h.getRootPredicateView(j,k)}else{d[l]=new a(j,k)}}return d[l]};a.redrawUiElements=function(j){f.redrawUiElements(j)};function g(){var j,k=d[Object.keys(d)[0]];j=k&&k.taggerView&&k.taggerView.getObservedNavigator().hasWidgetMaximized();j=j&&k.taggerView.getObservedNavigator().getFocusedProxy();return j&&k.taggerView.getObservedNavigator().getFocusedProxy().relevantPredicates.length}return a});define("DS/TagNavigator/TaggerProxy",["UWA/Core","UWA/Class/Events","DS/TagNavigator/TagValue","DS/TagNavigator/Predicate","DS/TagNavigator/Filter","DS/TagNavigator/Logger","DS/TagNavigator/Parameters","DS/TagNavigator/NotificationManager","DS/TagNavigator/Notification","DS/TagNavigator/TaggerUtils","DS/TagNavigator/TaggerSettings"],function(e,l,g,a,b,h,i,k,j,d,f){var c=l.extend({init:function(m,o){var n;if(!m||(typeof m.id!=="string")){throw new Error("Invalid input arg")}this._alive=true;this._navimpl=o;this._listenerOf={};this._tagValuesMap={};this._explicitValues={};this._selectedValues=new b();this._tagValuesIdxForSubject={};this._nbSubjects={};this._subjectsInEdition=[];this._persistTags=true;this._tagsInCreation=[];this.subjectsMapByPredValue={};this._fields={};this._id=m.id;this._widgetId=m.widgetId;this._isActive=true;this._isReady=true;for(n in m.cStorages){if(!e.is(m.cStorages[n],"object")){delete m.cStorages[n]}}for(n in m.tagsServers){if(!e.is(m.tagsServers[n],"object")){delete m.tagsServers[n]}}this._cStorages=m.cStorages||{};this._tagsServers=e.is(m.tagsServers,"object")&&Object.keys(m.tagsServers).length?m.tagsServers:null;this._tenant=m.tenant||null;this._filteringMode=m.filteringMode;this._hasPlatformData=m.hasPlatformData;this.colorizeSupport=m.colorize||false;this.freeInputSupport=m.freeInput||false;this.forbidFreeDates=m.forbidFreeDates||false;this.preciseCount=m.preciseCount||false;this.defaultDatePicker=m.defaultDatePicker||false;this.predicateSortOrder=m.predicateSortOrder||undefined;this.relevantPredicates={};this.enablePLM=m.enablePLM||false;this.parameters=null;if(this.enablePLM){this.parameters=new i()}this._criteriaIdsMap={};this._tagsWithInternalName=f.getOption("tagsWithInternalName")},getNavImpl:function(){return this._navimpl},isTagInEdition:function(m){return this._tagsInCreation[m.fullid]},widgetId:function(){return this._widgetId},isActive:function(){return this._isActive},isReady:function(){return this._isReady},isFilteringOnServer:function(){return this._filteringMode==="FilteringOnServer"},getFilters:function(n){var m={};m.localfilters=(n&&!this.isActive())?{}:this._selectedValues.computeFilterObj(null,this._fields,n).allfilters;m.allfilters=this._selectedValues.computeFilterObj(this._navimpl.getFilters(this._fields),this._fields,n).allfilters;return m},hasFreeInputSupport:function(m){if(this._filteringMode==="WithFilteringServices"){return true}return this.freeInputSupport||m.allowFreeInput},isDatePickerDefault:function(){return this.defaultDatePicker||false},isForbiddenFreeDates:function(){return this.forbidFreeDates},isPreciseCount:function(){return this.preciseCount},isAdvancedSearch:function(){return Object.keys(this._criteriaIdsMap).length>0},getTagsServers:function(){return this._tagsServers},getCStorages:function(){return this._cStorages},hasPlatformData:function(){return this._hasPlatformData},getSortOrder:function(){return this.predicateSortOrder},setSortOrder:function(m){this.predicateSortOrder=m;this.triggerCallbackOfEvent(c.SortChange,m)},_alivePreCond:function(){if(!this._alive){throw new Error("TaggerProxy '"+this._id+"' is a zombie")}},_sanitizeTags:function(o){if(!e.is(o,["object","array"])){return o}var m=Array.isArray(o)?o:[].concat.apply([],Object.keys(o).map(function(p){return o[p]})),n=[];if(!m.some(function(p){return Array.isArray(p.object)})){return o}m.forEach(function(p){if(!p.sixw||~n.indexOf(p.sixw)||Array.isArray(p.object)){return}n.push(p.sixw);var q=m.filter(function(r){return r.sixw===p.sixw});if(q.some(function(r){return Array.isArray(r.object)&&r.object.indexOf(p.object)===0})){p.object=[p.object];p.dispValue=e.is(p.dispValue)?[p.dispValue]:p.dispValue}});return o},addNbSubjectsForTagValue:function(n,m){if(this._tagValuesMap[n]){this._nbSubjects[n]+=m}else{this._tagValuesMap[n]=n;this._nbSubjects[n]=m}},_addFieldsForTagValue:function(n,m){if(!m||m===""){return}this._fields[n]=this._fields[n]||{};this._fields[n][m]=true;if(n.parent){this._addFieldsForTagValue(n.parent,m)}},addTagValueForSubject:function(m,n){this.addNbSubjectsForTagValue(n,1);this.indexSubjectsTagsForFiltering(n,m);this._tagValuesIdxForSubject[m].push(n.fullid)},removeTagValueForSubject:function(m,n){this._nbSubjects[n]--;if(this._nbSubjects[n]<=0){delete this._tagValuesMap[n]}n.decrementCount(1);this.removeFromIndexTagForFiltering(n,m);this._tagValuesIdxForSubject[m].splice(this._tagValuesIdxForSubject[m].indexOf(n.fullid),1)},_computeTagsValues:function(x){var r,C,u,s,B,o,m,n,q,A,z,p,w,y,v,t;z={};u=[];for(r in x){if(x.hasOwnProperty(r)){s=x[r];for(p=0,w=s.length;p<w;p++){C=s[p];y=C.sixw;if(z[y]){o=z[y]}else{o=z[y]={}}v=C.field;if(o[v]){q=o[v]}else{q=o[v]={}}t=C.object;if(!(typeof t==="string"&&t.length!==0)&&!(Array.isArray(t)&&t.length!==0)){throw new Error("Invalid input arg")}if(!q[t]){q[t]={count:0,type:C.type,uri:C.object};if(C.dispValue!==undefined){q[t].dispValue=C.dispValue}}q[t].count+=1}}}for(A in z){if(z.hasOwnProperty(A)){o=z[A];for(B in o){if(o.hasOwnProperty(B)){q=o[B];for(m in q){if(q.hasOwnProperty(m)){n=q[m];C={count:n.count,type:n.type,object:n.uri,sixw:A};if(n.dispValue!==undefined){C.dispValue=n.dispValue}if(B&&B!=="undefined"){C.field=B}u.push(C)}}}}}}return u},getLocalFilter:function(){return this._selectedValues},id:function(){this._alivePreCond();return this._id},addListener:function(n,m,o){this._alivePreCond();this._listenerOf[n]={cb:m,scope:o};return this},onBeforeRefine:function(){this._isReady=false},onRefine:function(o){var m,q,s;if(UWA.is(o,"object")){m=o.isSearch;q=o.isInternal;s=o.triggerProxyCB}var r;var n=this._isReady;this._isReady=false;r=this.getFilters();if(m){r.search=true}if(UWA.is(s,"boolean")){r.triggerProxyCB=s;this._isReady=n}if(this.getParameters()){var p=this.getParameters().getFilters();if(p){r.PLMParameters=p}}if(q===true){this.triggerCallbackOfEvent(c.InternalFilterChange,r)}else{this.triggerCallbackOfEvent(c.FilterChange,r)}},onSearch:function(){var m;this._isReady=false;this.onRefine({isSearch:true});this._navimpl.dispatchEvent("SEARCH_LAUNCH")},warnForCriteriaChange:function(m){this.triggerCallbackOfEvent(c.CriteriaChange,m)},getGrantedRoles:function(n){var m=this;if(window.richClient===true||(Object.keys(this._cStorages).length>0&&this._cStorages[Object.keys(this._cStorages)[0]].getUrlPart("path").indexOf("/VocabularyStub")!==-1)){this._isBIOnly=false;return n()}d.getGrantedRoles().then(function(o){if(UWA.is(o,"array")){m._isBIOnly=false;if(m._tenant){o=o.filter(function(p){return p.platforms.indexOf(m._tenant)!==-1})}o=o.map(function(p){return p.id});if((o.length>0&&o.indexOf("MPU")!==-1)||(o.length===1&&o[0]==="IFW")||(o.length===1&&o[0]==="UAU")){m._isBIOnly=true}else{if(o.length===2){if(o.indexOf("Operator")!==-1&&o.indexOf("IFW")!==-1){m._isBIOnly=true}}}n()}})},setTags:function(u,t){var p=this;var q,m,o,n,v,s;if(this._isBIOnly===undefined){return this.getGrantedRoles(function(){p.setTags(u,t)})}u=this._sanitizeTags(u);t=this._sanitizeTags(t);if(this._isBIOnly&&e.is(this._tagsServers,"object")){s=this._tagsServers[Object.keys(this._tagsServers)[0]]}else{if(this._isBIOnly===false&&e.is(this._cStorages,"object")){s=this._cStorages[Object.keys(this._cStorages)[0]]}}if(!t){t=null}this._alivePreCond();this.unloadAllTags();if((t===null)||(t.length===0)){t=this._computeTagsValues(u)}for(n=0,v=t.length;n<v;n++){o=t[n];if(o.type==="date"){o.object=o.object.split("-").join("/").substr(0,10)}try{m=g.getTagValue(o,null,null,null,null,s)}catch(r){h.error("Error in setTags")}if(m){q=o.count;if(typeof q==="string"){q=parseInt(q,10)}if(typeof q!=="number"||isNaN(q)){h.warn("Invalid count '"+o.count+"' passed to setTags API for tag '"+o.dispValue+"'")}else{m.incrementCount(q);this.addNbSubjectsForTagValue(m,q);this._addFieldsForTagValue(m,o.field)}}}this.addSubjects(u);this._isReady=true;this._navimpl.dispatchEvent("REDRAW_TAGS");return this},_addInternalNameToEnumDisplay:function(m){if(UWA.is(m.datasets)&&UWA.is(m.datasets.items,"array")){m.datasets.items.forEach(function(n){if(n.label&&n.value){n.label+=" ("+n.value+")"}})}},setCriteria:function(p){var r=this;var q,v,o,t,u,n=this._navimpl.getCache();if(this._isBIOnly===undefined){return this.getGrantedRoles(function(){r.setCriteria(p)})}if(this._isBIOnly&&e.is(this._tagsServers,"object")){t=this._tagsServers[Object.keys(this._tagsServers)[0]]}else{if(this._isBIOnly===false&&e.is(this._cStorages,"object")){t=this._cStorages[Object.keys(this._cStorages)[0]]}}this._criteriaIdsMap={};if(p){for(q=0,v=p.length;q<v;q++){this._criteriaIdsMap[p[q].sixw]=true;o=a.getPredicate(p[q].sixw.split("/").pop());if(!o){if(p[q].sixw.indexOf("/")===-1){p[q].sixw="void/"+p[q].sixw}u=p[q].type==="enum"?"string":p[q].type;var m={sixw:p[q].sixw,type:u,server:t,options:p[q].options};if(p[q].forceDispValue||m.sixw==="void/vpmextension"){h.warn("considering the input display name for predicate "+m.sixw+"="+p[q].dispValue);m.displayName=p[q].dispValue}try{o=new a(m)}catch(s){k.push(new j("Fail to create a predicate with invalid arg. Id is :'"+m.sixw+"'"));k.dispatch()}}if(p[q].type==="enum"){o.setIsEnum(true)}o.setSuggestSupport(p[q].allowSuggestions);if(p[q].options){if(this._tagsWithInternalName&&o.isEnum()){this._addInternalNameToEnumDisplay(p[q].options)}o.setElemOptions(p[q].options)}}}this.countMore();this._navimpl.dispatchEvent("REDRAW_CRITERIA")},updateCriteria:function(p){var r=this;var q,w,o,u,v,t=[],n=this._navimpl.getCache();if(this._isBIOnly===undefined){return this.getGrantedRoles(function(){r.updateCriteria(p)})}if(this._isBIOnly&&e.is(this._tagsServers,"object")){u=this._tagsServers[Object.keys(this._tagsServers)[0]]}else{if(this._isBIOnly===false&&e.is(this._cStorages,"object")){u=this._cStorages[Object.keys(this._cStorages)[0]]}}if(p&&p.length){for(q=0,w=p.length;q<w;q++){this._criteriaIdsMap[p[q].sixw]=true;o=a.getPredicate(p[q].sixw.split("/").pop());if(o){if(p[q].options){if(this._tagsWithInternalName&&o.isEnum()){this._addInternalNameToEnumDisplay(p[q].options)}o.setElemOptions(p[q].options)}}else{if(p[q].sixw.indexOf("/")===-1){p[q].sixw="void/"+p[q].sixw}var m={sixw:p[q].sixw,type:p[q].type,server:u,options:p[q].options};if(p[q].forceDispValue||m.sixw==="void/vpmextension"){h.warn("considering the input display name for predicate "+m.sixw+"="+p[q].dispValue);m.displayName=p[q].dispValue}try{o=new a(m)}catch(s){k.push(new j("Fail to create a predicate with invalid arg. Id is :'"+m.sixw+"'"));k.dispatch()}if(p[q].dispValue&&o.displayName()!==p[q].dispValue){o.setDisplayName(p[q].dispValue)}if(this._tagsWithInternalName&&o.isEnum()){if(p[q].options){this._addInternalNameToEnumDisplay(p[q].options)}}o.setElemOptions(p[q].options)}o.setSuggestSupport(p[q].allowSuggestions)}this.countMore();this._navimpl.dispatchEvent("REDRAW_CRITERIA")}},removeCriteria:function(n){var q,m,p,o;p=this._cStorages[Object.keys(this._cStorages)[0]];if(n&&n.length){for(q=0,m=n.length;q<m;q++){o=a.getPredicate(n[q].sixw.split("/").pop());if(o){delete this._criteriaIdsMap[n[q].sixw]}}this.countMore();this._navimpl.dispatchEvent("REDRAW_CRITERIA")}},countMore:function(){var n=0;for(var m in this._criteriaIdsMap){if(a.getPredicate(m.split("/").pop()).getElemOptions()&&(a.getPredicate(m.split("/").pop()).getElemOptions().showByDefault===false)){n++}}this._navimpl.getCache().setMore(n)},setRelevantPredicates:function(n){if(Array.isArray(n)&&n.length){var m={};n.forEach(function(o){m[o]={weight:1,expanded:false,relevant:true}});this.setPredicates(m)}else{h.error("the setRelevantPredicates API take an Array as first arg.")}return},setPredicates:function(o){var n,m;if(e.is(o,"object")){this.relevantPredicates=Object.keys(o).filter(function(q){return o[q].relevant});for(n in o){m=a.getPredicate(n);if(m){m.weight=o[n].weight||1;m.defaultExpand=o[n].expanded||false;m.allowFreeInput=o[n].allowFreeInput||this.freeInputSupport}else{a.weights[n]=o[n.split("/").pop()].weight||1;a.defaultExpands[n]=o[n.split("/").pop()].expanded||false;a.allowFreeInput[n]=o[n.split("/").pop()].allowFreeInput||this.freeInputSupport}}}else{h.error("the setPredicates API take an Object as first arg.")}if(!UWA.is(this.predicateSortOrder)){this.predicateSortOrder="sort-weight"}return},hasRelevantPredicates:function(){return this.relevantPredicates&&this.relevantPredicates.length},addSubjects:function(n){var s,o,t,p,q,m;for(s in n){if(n.hasOwnProperty(s)){o=n[s];this._tagValuesIdxForSubject[s]=[];for(q=0,m=o.length;q<m;q++){t=o[q];if(t.type==="date"){t.object=t.object.split("-").join("/").substr(0,10)}try{p=g.getTagValue(t.sixw,t.dispValue,t.object,t.type)}catch(r){h.error("Error in addSubjects")}if(p){this.indexSubjectsTagsForFiltering(p,s);this._tagValuesIdxForSubject[s].push(p.fullid)}}}}},indexSubjectsTagsForFiltering:function(m,o){var n=m.fullid;this.subjectsMapByPredValue[n]=this.subjectsMapByPredValue[n]||{};this.subjectsMapByPredValue[n][o]=true;if(m.parent){this.indexSubjectsTagsForFiltering(m.parent,o)}return this},removeFromIndexTagForFiltering:function(m,o){var n=m.fullid;delete this.subjectsMapByPredValue[n][o];return this},getSubjectsFromTag:function(m){return Object.keys(this.subjectsMapByPredValue[m.fullid]||{})||[]},die:function(m){if(!m){m=true}this._alivePreCond();this.unloadAllTags();this.clearLocalFilter();this._isActive=false;if(this._navimpl.getFocusedProxy()===this){this._navimpl.removeFocusedProxy(true)}if(this.hasSubjectsInEdition()){this.unfocus()}else{if(m){this._navimpl.dispatchEvent("REDRAW_TAGS")}}this._navimpl.removeProxy(this);this._navimpl.updateFocusedProxy();this._navimpl=null;this._alive=false;return this},isAlive:function(){return this._alive},hasSubjectsInEdition:function(){return this._subjectsInEdition.length!==0},focusOnSubjects:function(m,n,o){if(typeof n!=="boolean"){n=true}if(o){this._dataSources=o}this._alivePreCond();this._persistTags=n;this._subjectsInEdition=m.slice(0);if(!this.hasSubjectsInEdition()){this.unfocus();return false}this._navimpl.dispatchEvent("REDRAW_TAGS");this._navimpl.setIconVisibleBool(this._widgetId,false);this._navimpl.dispatchEvent("UPDATE_ICON");return this},activate:function(){this._alivePreCond();if(this._isActive===true){return}this._isActive=true;this._navimpl.updateFocusedProxy();this._navimpl.dispatchEvent("REDRAW_TAGS")},deactivate:function(){this._alivePreCond();if(this._isActive===false){return}this._isActive=false;this._navimpl.updateFocusedProxy();this._navimpl.dispatchEvent("REDRAW_TAGS")},unfocus:function(){this._alivePreCond();this._subjectsInEdition=[];this._navimpl.dispatchEvent("REDRAW_TAGS");if(this._navimpl.getIconVisibleBool(this._widgetId)!==(Object.keys(this.getFilters().localfilters).length!==0)){this._navimpl.setIconVisibleBool(this._widgetId,Object.keys(this.getFilters().localfilters).length!==0);this._navimpl.dispatchEvent("UPDATE_ICON")}},unsetTags:function(){this._alivePreCond();this.unloadAllTags();this._isReady=true;this.unfocus();return this},unloadAllTags:function(){this._alivePreCond();Object.keys(this._tagValuesMap).forEach(function(n){var m=this._tagValuesMap[n];m.decrementCount(this._nbSubjects[n])}.bind(this));this.subjectsMapByPredValue={};this._tagValuesIdxForSubject={};this._nbSubjects={};this._tagValuesMap={};return this},updateLocalFilterStatus:function(m){return this.triggerCallbackOfEvent(c.UpdateLocalFilterStatus,m)},toggleProxyFocus:function(m){this._alivePreCond();if(!this._isActive){h.error("Proxy is deactivate: Cannot focus on an inactive proxy");return this}this._navimpl.toggleProxyFocus(this,m);return this},clearLocalFilter:function(o){this._alivePreCond();var q,m,n,r,s,p=this._navimpl.getCache().getCriteriaToResetBeforeFilterChange(this.id());var t=this._selectedValues.isEmpty();this._selectedValues.clear();for(n in p){m=a.getPredicate(n);if(p[n].value){for(r=0;r<p[n].value.length;r++){s=m.getElemOptions();q=(s&&s.datasets&&s.datasets.items)?s.datasets.items.map(function(u){return u.value}).indexOf(p[n].value[r].value):-1;if(q!==-1&&s.datasets.items[q].predefined===true){delete s.datasets.items[q].predefined}}}}this._navimpl.getCache().resetCriteriaToResetBeforeFilterChange(this.id());this._navimpl.getCache().resetCriteriaToRemoveBeforeFilterChange(this.id());if(this.getParameters()){this.getParameters().clearValues()}this.updateProxyView(t);if(o===true){this.onRefine()}return this},setLocalFilter:function(B,t){var u=this;var x=["ds6w:who","ds6w:when","ds6w:what","ds6w:where","ds6w:why","ds6w:how"];var H,p,y,w,o,F,z,s,C;var E=this._navimpl.getCache().getCriteriaToResetBeforeFilterChange(this.id());var D={},q,r,m,G,n;if(this._isBIOnly===undefined){return this.getGrantedRoles(function(){u.setLocalFilter(B,t)})}if(this._isBIOnly&&e.is(this._tagsServers,"object")){n=this._tagsServers[Object.keys(this._tagsServers)[0]]}else{if(this._isBIOnly===false&&e.is(this._cStorages,"object")){n=this._cStorages[Object.keys(this._cStorages)[0]]}}p=B.localFilter;C=B.warn;this._alivePreCond();z=this._selectedValues.isEmpty();for(y in p){if(p.hasOwnProperty(y)){r=p[y][0].type;if(y.indexOf("sixw:")===0){w=p[y];y=y.replace("sixw:","");q=y.split("/").pop();if(r==="string"){for(o=0,F=w.length;o<F;o++){this._selectedValues.createFreeInput(y,r,w[o].object,w[o].displayValue);w[o].value=w[o].object;w[o].selected=true}D[q]=E[q]||{};D[q].type=E[q]&&E[q].type?E[q].type:w[0].type;D[q].value=E[q]&&E[q].value?E[q].value.concat(w):w;E=e.merge(D,E)}else{if(r==="boolean"){this._selectedValues.createFreeInput(y,r,w[0].object);D[q]={};D[q].value=w[0].object;D[q].type=r}else{if((r==="integer")||(r==="double")||(r==="float")||(r==="date")){this._selectedValues.createFreeInput(y,r,w[0].object);D[q]={};D[q].type=r;for(m in w[0].object){if(m!=="type"){D[q][m]={value:r==="date"?new Date(w[0].object[m]):w[0].object[m],type:r}}}}}}G=a.getPredicate(q);if(!G){if(x.indexOf(y.split("/")[0])===-1){y="void/"+y}var v={sixw:y,type:r,server:n};try{G=new a(v)}catch(A){k.push(new j("Fail to create a predicate with invalid arg. Id is :'"+v.sixw+"'"));k.dispatch()}}}else{w=p[y];for(o=0,F=w.length;o<F;o++){try{H=g.getTagValue(y,w[o].disptext,w[o].object,w[o].type,null,n)}catch(A){h.error("Error in setLocalFilter")}this._selectedValues.toggle(H)}}}}this._navimpl.getCache().setCriteriaToResetBeforeFilterChange(this.id(),E);this.updateProxyView(z);if(true===B.warn){this.onRefine()}else{if(window.richClient){this.onRefine({isInternal:true})}else{this.onRefine({triggerProxyCB:false})}}if(e.is(t,"function")){t()}},updateTenantInfo:function(m){},eachTagValue:function(o){var n,r,t,s,q,p,m;this._alivePreCond();if(this.hasSubjectsInEdition()){for(t=0,q=this._subjectsInEdition.length;t<q;t++){r=this._subjectsInEdition[t];if(this._tagValuesIdxForSubject[r]){m=this._tagValuesIdxForSubject[r];for(s=0,p=m.length;s<p;s++){n=m[s];if(this._tagValuesMap[n]){o.call(this,this._tagValuesMap[n],1)}}}}}else{Object.keys(this._tagValuesMap).forEach(function(u){if(this._nbSubjects[u]!==0){o.call(this,this._tagValuesMap[u],this._nbSubjects[u])}}.bind(this))}return this},updateSelectedTVLocalFilter:function(o,n,q){var m,p;p=this._selectedValues.isEmpty();m=this._selectedValues.toggle(n);this.updateProxyView(p,null,q);return m},updateFreeInputs:function(m,n){var o,p,q=this._selectedValues.isEmpty();for(p=0,n.length;p<n.length;p++){o=n[p];this._selectedValues.removeFreeInput(o.predicate.getFullPredicateID(true),o.type,o.value,o.nls)}this._navimpl.getCache().resetCriteriaToRemoveBeforeFilterChange(this.id());for(p=0,m.length;p<m.length;p++){o=m[p];this._selectedValues.createFreeInput(o.predicate.getFullPredicateID(true),o.type,o.value,o.nls)}this.updateProxyView(q,null,false);this.onSearch();return},createFreeInputs:function(m){var n,o,p=this._selectedValues.isEmpty();for(o=0,m.length;o<m.length;o++){n=m[o];this._selectedValues.createFreeInput(n.predicate.getFullPredicateID(true),n.type,n.value,n.nls)}this.updateProxyView(p,null,false);this.onRefine();return},removeFreeInputs:function(w){var v,p,n,u,o,s,x=false,r,t,q=this._navimpl.getCache().getCriteriaToResetBeforeFilterChange(this.id()),m=this._selectedValues.isEmpty();for(p=0,w.length;p<w.length;p++){v=w[p];this._selectedValues.removeFreeInput(v.predicate.getFullPredicateID(true),v.type,v.value,v.nls);n=v.predicate.getFullPredicateID().split("/").pop();s=v.type;if(n&&q[n]){if(s==="boolean"){delete q[n]}else{if(s==="string"){for(u=0,q[n].value.length;u<q[n].value.length;u++){if(q[n].value[u].value===v.value){x=true;break}}if(x){q[n].value.splice(u,1);if(q[n].value.length===0){delete q[n]}}t=v.predicate.getElemOptions();r=(t&&t.datasets&&t.datasets.items)?t.datasets.items.map(function(y){return y.value}).indexOf(v.value):-1;if(r!==-1&&t.datasets.items[r].predefined===true){delete t.datasets.items[r].predefined}}else{for(o in v.value){if(q[n][o]){delete q[n][o]}}if(Object.keys(q[n]).length===1){delete q[n]}}}}}this.updateProxyView(m,null,false);this.onRefine();return},updateProxyView:function(p,m,o){var n=this._selectedValues.isEmpty();if(n!==p||m){this.updateLocalFilterStatus({hasFilter:!n,isFocused:this._navimpl.getFocusedProxy()===this})}if(this._navimpl.getIconVisibleBool(this._widgetId)!==(Object.keys(this.getFilters().localfilters).length!==0)){this._navimpl.setIconVisibleBool(this._widgetId,Object.keys(this.getFilters().localfilters).length!==0);this._navimpl.dispatchEvent("UPDATE_ICON")}if(o!==false){this._navimpl.dispatchEvent("REDRAW_TAGS")}},getCriteriaIdsMap:function(){return this._criteriaIdsMap},hasCriteria:function(){return Object.keys(this._criteriaIdsMap).length!==0},colorize:function(m){var n=this;if(this.colorizeSupport&&m){m=e.extend({coloredSubjects:{}},m);m.tagColors.forEach(function(p){try{var o=g.getTagValue(p)}catch(q){h.error("Error in colorize")}n.getSubjectsFromTag(o).forEach(function(r){m.coloredSubjects[r]=p.color})});this.triggerCallbackOfEvent(c.colorize,m)}},unColorize:function(){if(this.colorizeSupport){this.triggerCallbackOfEvent(c.unColorize)}},setColorMap:function(m){this._navimpl.setColorMap(m)},triggerCallbackOfEvent:function(m,o){var n;this._alivePreCond();n=this._listenerOf[m];return n?n.cb?n.cb.call(n.scope||undefined,o):undefined:undefined},createTagValue:function(o,m,A,s){var z,w,F,v,u,D,t,B=0,x,r,p,C,E,q,n;this._alivePreCond();if(!(m instanceof a&&typeof o==="string")){throw new Error("Invalid input arg")}F={subjects:[],predicate:m.getFullPredicateID(),object:o};z={tag:[{subject:[],predicate:m.getFullPredicateID(),object:{literal:o}}]};w={tag:[{subject:[],predicate:m.getFullPredicateID(),object:{literal:o}}]};try{D=g.getTagValue(m,o,o)}catch(y){h.error("Error in createTagValue")}for(r=0,C=this._subjectsInEdition.length;r<C;r++){v=this._subjectsInEdition[r];if(this._tagValuesIdxForSubject[v].indexOf(D.fullid)===-1){if(this.createTagOn3DSpace(v)){w.tag[0].subject.push({uri:v})}else{z.tag[0].subject.push({uri:v})}F.subjects.push(v)}}this.addNbSubjectsForTagValue(D,0);this._tagsInCreation[D.fullid]=w.tag[0].subject.length+z.tag[0].subject.length;x=function(G){this._explicitValues[m.getFullPredicateID()+o]=G;this._tagsInCreation[D.fullid]=0;B--;if(B===0){A();return this.triggerCallbackOfEvent(c.AddTag,F)}}.bind(this);t=function(G){for(p=0,E=G.length;p<E;p++){v=G[p].uri;this.removeTagValueForSubject(v,D)}B--;if(B===0){A();return this.triggerCallbackOfEvent(c.AddTag,F)}}.bind(this);q=w.tag[0].subject;n=z.tag[0].subject;for(p=0,E=q.length;p<E;p++){u=q[p].uri;this.addTagValueForSubject(u,D);D.incrementCount(1)}for(p=0,E=n.length;p<E;p++){u=n[p].uri;this.addTagValueForSubject(u,D);D.incrementCount(1)}B=0;if(this._persistTags===true){if(n.length>0){B+=s.length;for(p=0,E=s.length;p<E;p++){this._tagsServers[s[p]].putTag(z,this._hasPlatformData,x,t)}}if(q.length>0){B+=s.length;for(p=0,E=s.length;p<E;p++){this._cStorages[s[p]].putTag(w,this._hasPlatformData,x,t)}}}else{B=1;setTimeout(x,200)}A(D);return this},createTagOn3DSpace:function(m){if(this._dataSources&&this._dataSources[m]){return this._dataSources[m]=="3DSpace"}else{return this._hasPlatformData}return true},deleteTagValue:function(o,m,x){var w,u,D,r,B,z,s,q,p,A,C,n,y=0,t=false;this._alivePreCond();if(!(m instanceof a&&typeof o==="string")){throw new Error("Invalid input arg")}D={subjects:[],predicate:m.getFullPredicateID(),object:o};w={tag:[{subject:[],predicate:m.getFullPredicateID(),object:{literal:o}}]};u={tag:[{subject:[],predicate:m.getFullPredicateID(),object:{literal:o}}]};try{B=g.getTagValue(m,o,o)}catch(v){h.error("Error in deleteTagValue")}if(!this._tagValuesMap[B.fullid]){return false}for(q=0,A=this._subjectsInEdition.length;q<A;q++){r=this._subjectsInEdition[q];if((this._tagValuesIdxForSubject[r].indexOf(B.fullid))!==-1){if(this.createTagOn3DSpace(r)){u.tag[0].subject.push({uri:r})}else{w.tag[0].subject.push({uri:r})}D.subjects.push(r)}}z=function(E){if(this._explicitValues[m.getFullPredicateID()+o]){delete this._explicitValues[m.getFullPredicateID()+o]}y--;if(y===0){for(p=0,C=E.length;p<C;p++){r=E[p].uri;this.removeTagValueForSubject(r,B)}x();this.triggerCallbackOfEvent(c.RemoveTag,D)}return}.bind(this);s=function(){y--;if(y===0){x();this.triggerCallbackOfEvent(c.RemoveTag,D)}return}.bind(this);if(this._persistTags===true){if(w.tag[0].subject.length>0){for(q in this._tagsServers){this._tagsServers[q].deleteTag(w,this._hasPlatformData,z,s);y+=1}}if(u.tag[0].subject.length>0){for(q in this._cStorages){this._cStorages[q].deleteTag(u,this._hasPlatformData,z,s);y+=1}}}else{if(w.tag[0].subject.length>0){y+=1;z(w.tag[0].subject)}if(u.tag[0].subject.length>0){y+=1;z(u.tag[0].subject)}}return this},addPLMUpdateListener:function(m,n){return this.addListener(c.PLMUpdate,m,n)},addRequestSuggestionsListener:function(m,n){return this.addListener(c.RequestSuggestions,m,n)},addFilterChangeListener:function(m,n){return this.addListener(c.FilterChange,m,n)},addCriteriaChangeListener:function(m,n){return this.addListener(c.CriteriaChange,m,n)},addTagCreationListener:function(m,n){return this.addListener(c.AddTag,m,n)},addTagDeletionListener:function(m,n){return this.addListener(c.RemoveTag,m,n)},addLocalFilterStatusListener:function(m,n){return this.addListener(c.UpdateLocalFilterStatus,m,n)},addInternalFilterChangeListener:function(m,n){return this.addListener(c.InternalFilterChange,m,n)},addUnfocusSubjectsListener:function(m,n){return this.addListener(c.UnfocusSubjects,m,n)},addColorizeListener:function(m,n){return this.addListener(c.colorize,m,n)},addOpenTaggerListener:function(m,n){return this.addListener(c.openTagger,m,n)},addCloseTaggerListener:function(m,n){return this.addListener(c.closeTagger,m,n)},addUpdateDisplayStatusListener:function(m,n){return this.addListener(c.updateDisplayStatus,m,n)},addUnColorizeListener:function(m,n){return this.addListener(c.unColorize,m,n)},addSortChangeListener:function(m,n){return this.addListener(c.SortChange,m,n)},isPLMParameterEnabled:function(){return this.enablePLM},sendStringTypedForPLM:function(m){var n=this.getFilters();n.PLMTitle=m;return this.triggerCallbackOfEvent(c.PLMUpdate,n)},getParameters:function(){return this.parameters}});c.FilterChange=1;c.AddTag=2;c.RemoveTag=3;c.CriteriaChange=4;c.UpdateLocalFilterStatus=5;c.colorize=7;c.unColorize=8;c.PLMUpdate=9;c.openTagger=10;c.closeTagger=11;c.RequestSuggestions=12;c.SortChange=14;c.updateDisplayStatus=21;c.InternalFilterChange=100;return c});define("DS/TagNavigator/TaggerProxyWithFilteringServices",["DS/TagNavigator/TaggerProxy","UWA/Class/Promise","UWA/Core"],function(d,e,f){var c={};var b=[];function a(B){var w,o,E,x,l,p,C,t,s,A,u,h,n,g,D,k,y,r,v,q,m,z=this;if(!(B instanceof d)){throw new Error("Invalid input arg")}m=B;s={};C={};p=[];q={};A={};u={};h={};n={};t=function(F,K){var J,I,G,H;if(!q[G=F.sixw]){q[G]={}}if(!q[F.sixw][typeof F.object]){q[F.sixw][typeof F.object]={}}if(!(I=q[F.sixw][typeof F.object])[H=F.object]){I[H]={}}J=F.type;if((J!=="string")&&(J!=="integer")&&(J!=="date")&&(J!=="tree")){J="string"}q[F.sixw][typeof F.object][H][K]={field:F.field,dispValue:F.dispValue,type:J,uri:F.object};return this};v=function(F,G){delete q[F.sixw][typeof F.object][F.object][G];return this};this.getTaggerProxy=function(){return m};this.id=function(){return m.id()};this.widgetId=function(){return m.widgetId()};this.addFilterSubjectsListener=function(F,G){s={cb:F,scope:G}};this.addTagCreationListener=function(F,G){A={cb:F,scope:G}};this.addTagDeletionListener=function(F,G){u={cb:F,scope:G}};this.addLocalFilterStatusListener=function(F,G){h={cb:F,scope:G}};this.addUnfocusSubjectsListener=function(F,G){n={cb:F,scope:G}};this.addColorizeListener=function(F,G){g={cb:F,scope:G}};this.addUnColorizeListener=function(F,G){D={cb:F,scope:G}};this.setColorMap=function(F){m.setColorMap(F)};this.setSubjectsTags=function(F,G){if(!m.hasPlatformData()&&G!==false){k(F)}return r(F)};this.addSubjectsTags=function(F,G){if(!m.hasPlatformData()&&G!==false){k(F)}return y(F)};y=function(F){for(var G in F){C[G]=C[G]||[];C[G]=C[G].concat(F[G])}r(f.clone(C));return this};r=function(H){var J,M,L,F,I,K,G;z.unloadAllTags();J=m.getFilters();M=Object.keys(J.allfilters).length===0;if(M){m.setTags(H)}C=H;for(L in H){I=H[L];p.push(L);for(K=0,G=I.length;K<G;K++){F=I[K];t(F,L)}}if(!M){o(J)}return this};this.die=function(){this.unloadAllTags();m.die(true);return this};this.isAlive=function(){return m.isAlive()};this.focusOnSubjects=function(F,G,H){if(typeof G!=="boolean"){G=true}m.focusOnSubjects(F,G,H);return this};this.unfocus=function(){m.unfocus();return this};this.activate=function(){m.activate()};this.deactivate=function(){m.deactivate()};this.activate=function(){m.activate()};this.toggleProxyFocus=function(F){m.toggleProxyFocus(F)};this.clearLocalFilter=function(F){m.clearLocalFilter(F)};this.setLocalFilter=function(F){m.setLocalFilter(F)};this.updateLocalFilterStatus=function(F){m.updateLocalFilterStatus(F)};this.unloadAllTags=function(){m.unloadAllTags();C={};p=[];q={};return this};this.unsetTags=function(){this.unloadAllTags();m.unsetTags()};this.notifyListenerOfFilterSubjects=function(F){if(s){if(s.cb){s.cb.call(s?s.scope:undefined,{filteredSubjectList:F,hasFiltersTEMP:Object.keys(m.getNavImpl().getFilters().allfilters).length!==0})}}return this};this.getFilters=function(){return m.getFilters()};this.hasCriteria=function(){return m.hasCriteria()};k=function(N){var F,K,L,J=[],O=0,I,M={},H,G;if(!m.hasPlatformData()){for(L in N){J.push({uri:L})}if(J.length!==0){c[z.id()]={proxy:m,subjects:J,proxyWF:z}}b=b.concat(J)}return};w=function(L){var J,G,I,H,F,K;G={sixw:L.predicate,object:L.object};F=L.subjects;for(I=0,H=F.length;I<H;I++){J=F[I];C[J].push(G);t(G,J)}if(A){K=A.cb;if(K){K.call(A?A.scope:undefined,L)}}return z};E=function(L){var K,H,G,F,J,I;H={sixw:L.predicate,object:L.object};G=L.subjects;for(J=0,I=G.length;J<I;J++){K=G[J];F=C[K].indexOf(H);C[K].splice(F,1);v(H,K)}if(u){G=u.cb;if(G){G.call(u?u.scope:undefined,L)}}return z};x=function(G){var F;if(h){F=h.cb;if(F){F.call(h?h.scope:undefined,G)}}return z};l=function(G){var F;if(n){F=n.cb;if(F){F.call(n?n.scope:undefined,G)}}return z};var j=function(F){if(g&&g.cb){g.cb.call(g.scope,F)}};var i=function(){if(D&&D.cb){D.cb.call(D.scope)}};o=function(Y){var U,H,K,ac,Z,af,P,V,S,am,T,ae,ag,G,ab,X,an,M,aa,R,F,W,al,Q,ad,L,J,I,ai,ak,aj,O,N,ah;H=Y.allfilters;ac=[];T=0;ab={};ag={};S={};for(af in H){ae=H[af];if(!S[af]){S[af]={}}for(L=0,ai=ae.length;L<ai;L++){M=ae[L];R=M.object;if(q[af]){if(M.type==="date"||M.type==="tree"||Array.isArray(R)){O=q[af][typeof R];for(ad in O){al=O[ad];ah=M.object.toString();if(ad.substring(0,ah.length)===ah){f.extend(ab,al)}}}else{ab=q[af][typeof M.object][R]||{}}for(G in ab){S[af][G]=1;if(!ag[G]){ag[G]=0}ag[G]+=1}ab={}}}T++}if(T===0){ac=p}else{for(G in ag){U=ag[G];if(U>=T){ac.push(G)}}}am={};Z={};for(J=0,ak=ac.length;J<ak;J++){G=ac[J];F=C[G];Z[G]=F;for(I=0,aj=F.length;I<aj;I++){M=F[I];V=M.sixw+M.field+M.object+typeof M.object;Q=M.type;if((Q!=="string")&&(Q!=="integer")&&(Q!=="date")&&(Q!=="tree")){Q="string"}if(!am[V]){am[V]={object:M.object,sixw:M.sixw,field:M.field,dispValue:M.dispValue,count:0,type:Q}}am[V].count+=1}}N=function(ao){return ao.object===ad};for(af in H){ae=H[af];if(ae[0].type!=="date"){for(Q in q[af]){for(ad in q[af][Q]){ab=q[af][Q][ad];if(!(ae.detect(N))){for(G in ab){if((ac.indexOf(G))===-1){W=!Object.keys(H).some(function(ao){return(ao!==af)&&!S[ao][G]});if(W){aa=ab[G].uri;K=ab[G].field;V=af+K+aa;if(!am[V]){am[V]={object:aa,sixw:af,field:K,dispValue:ab[G].dispValue,count:0,type:ab[G].type}}am[V].count+=1;if(!Z[G]){Z[G]=[]}Z[G].push(am[V])}}}}}}}}X=[];for(V in am){an=am[V];X.push(an)}z.notifyListenerOfFilterSubjects(ac);m.setTags(Z,X);return false};m.addListener(d.FilterChange,o,this);m.addListener(d.AddTag,w,this);m.addListener(d.RemoveTag,E,this);m.addListener(d.UpdateLocalFilterStatus,x,this);m.addListener(d.UnfocusSubjects,l,this);m.addListener(d.colorize,j,this);m.addListener(d.unColorize,i,this);return this}a.getSubjectsForExplicitTags=function(){return b};a.clearProxiesTemp=function(){b=[];c={}};a.getExplicitTags=function(){var l,h,k,i,g,n,m,j=[];if(Object.keys(c).length){i=c[Object.keys(c)[0]].proxy.getTagsServers();g={tag:[{subject:b}]};n=function(D,u,y){if(D){var A,z,x,B,r,o,F,t,s,G={},C,E={},w,p,q,v;D=JSON.parse(D);if(D.data.length){for(A=0,B=D.data.length;A<B;A++){for(z=0,r=D.data[A].tag.length;z<r;z++){o=D.data[A].subject.uri;E[o]=E[o]||[];F=D.data[A].tag[z].object.literal;t=D.data[A].tag[z].predicate;s=true;for(x=0;x<E[o].length;x++){G=E[o][x];s=s?G.object!==F||G.sixw!==t:false}if(s){E[o].push({object:F,sixw:t,dispValue:F})}}}for(C in c){w=c[C].subjects;p={};for(z=0;z<w.length;z++){if(E[w[z].uri]){p[w[z].uri]=E[w[z].uri];for(A=0;A<E[w[z].uri].length;A++){v=E[w[z].uri][A].sixw;q=E[w[z].uri][A].object;c[C].proxyWF.getTaggerProxy()._explicitValues[v+q]=u}}}if(Object.keys(p).length){c[C].proxyWF.addSubjectsTags(p,false)}}}}y("ExplicitTags OK")};for(k in i){m=new e(function(o){i[k].getExplicitTag(g,n,o)});j.push(m)}}return j};return a});define("DS/TagNavigator/TagValueView",["DS/TagNavigator/PredicateView","DS/TagNavigator/Predicate","DS/TagNavigator/TagValue","DS/TagNavigator/TaggerNLS"],function(d,b,a,e){function c(i,p,q){var o,s,f,k,h,j,x,y,g,n,r,m,l,v,u,w;if(typeof q!=="number"){q=1}if(!(i instanceof a)){throw new Error("Invalid input arg")}l=p;g=q;f=i.getDisplayValue();h=i.uri;v=Array.isArray(i.uri)?"tree":i.type;j=false;x=i.explicit;n=i.pred.getFullPredicateID();r=i.icon;m=JSON.stringify({predicate:n,object:h,dispValue:i.getDisplayValue(),type:i.type});w=[];this.getSelectedTagId=function(){return m};this.incNbSubjects=function(z){g+=z;if(y&&y.incNbSubjects){y.incNbSubjects(z)}return g};this.id=function(){return h};this.isADateFilter=function(){return j};this.getDateLevel=function(){return(v==="date")?[0,"year","month","day"][h.split("/").length]:0};this.type=function(){return v};this.nbSubjectsTagged=function(){return g};this.getDisplayname=function(){return Array.isArray(f)?f[f.length-1]:f};this.clearContent=function(){var B,A,z;l=null;for(A=0,z=w.length;A<z;A++){B=w[A];B.clearContent()}w=[];return l};this.getMotherView=function(){return y};this.getPredicateView=function(){if(y instanceof c){return y.getPredicateView()}return y};this.getTagsInCreation=function(){return l.getTagsInCreation()};this.isSelectedTag=function(){return l.isSelected(i)};this.addTagValueView=function(z){if(this.getChildrenTagValueViews(function(A){return A===z.id()}).length>0){throw new Error("Unexpected addition of already existing child TagValueView")}w.push(z);this.incNbSubjects(z.nbSubjectsTagged());return this};this.getChildrenTagValueViews=function(C){var A,B,z;if(!C){C=function(){return true}}return w.filter(function(D){return C(D.id())})};this.getChildTagValueView=function(A){var z=this.getChildrenTagValueViews(function(B){return B===A});return z.length?z[0]:undefined};this.getNbTagMatch=function(A){var C=0,B,z=this.getChildrenTagValueViews();if(this.getDisplayname().toLowerCase().indexOf(A)!==-1){C++}if(this.type()!=="date"||(this.type()==="date"&&this.isSelectedDate())){for(B=0;B<z.length;B++){if(z[B].getChildrenTagValueViews().length>0){C+=z[B].getNbTagMatch(A)}else{if(z[B].getDisplayname().toLowerCase().indexOf(A)!==-1){C++}}}}return C};this.isSelectedDate=function(){var z=false,B,A;return this.isSelectedTag()||this.getChildrenTagValueViews().some(function(C){return C.isSelectedTag()||C.isSelectedDate()})};this.toHtml=function(G,S,J,R,M){var N,T,K,F=l.isSelected(i),Q=x&&l.isTagInEdition(i),A=x&&!S&&!Q,L=l.getObservedNavigator().isPreciseCount(),P,I,O,E=R&&R!=="",z,H=l.getObservedNavigator().getCache();if(typeof S!=="boolean"){S=false}K=String()+(l.getDOMId(m))+(S?"atv":"");switch(v){case"date":var B=["year","month","day"][h.split("/").length-1];if(S){T="";if(y instanceof c){T=y.toHtml(G,S,J,undefined,M)}T+=c.toHtml({id:K,displayName:this.getDisplayname(),count:g,isPreciseCount:L,isSelected:true,isDisplayed:true,isExplicit:x,additionalClassName:B+(M?"":" wrongType"),icon:r});return T}if(J&&J!==""){F=J.indexOf(h)===0;if(!F&&h.indexOf(J)!==0){return""}}P=c.toHtml({id:K,displayName:this.getDisplayname(),count:g,isPreciseCount:L,isSelected:F,isDeletable:A,isDisplayed:G,isExplicit:x,isUnderCreation:Q,isExpanded:true,icon:r,additionalClassName:(F?B:"")+(M?"":" wrongType"),color:H.colorManager.isColorized(n)&&(!F||B==="day")?H.colorManager.getNewColorForTagValue(this):undefined});if(!S&&F){w=this.getPredicateView().sortTagValues(w);if(l.isSelected(m)){P+="<li class='treeTags'><ul class='tags-list'>"}for(N=0;N<w.length;N++){if(!E||(E&&w[N].getNbTagMatch(R)>0)){P+=w[N].toHtml(G,false,J,R,M)}}if(l.isSelected(m)){P+="</ul></li>"}}return P;case"tree":I=(!S)&&w.length>0;P="";O="";var D=null,C;if(H.colorManager.isColorized(n)){if(this.getMotherView()===this.getPredicateView()){H.colorManager.addToColoredTreeTagList(this)}else{if(Object.getPrototypeOf(this.getMotherView())===Object.getPrototypeOf(this)){if(H.isTagTreeExpanded(l.getDOMId(this.getMotherView().getSelectedTagId()))){D=H.colorManager.addToColoredTreeTagList(this)}}}}if(!E){O=c.toHtml({id:K,displayName:this.getDisplayname(),count:g,isPreciseCount:L,isSelected:F,isDeletable:A,isDisplayed:G,isExplicit:x,icon:r,isUnderCreation:Q,isExpanded:H.isTagTreeExpanded(K),isTree:I,additionalClassName:(M?"":" wrongType"),color:H.colorManager.isColorized(n)?H.colorManager.getNewColorForTagValue(this)||D:undefined})}else{if(this.getNbTagMatch(R)>0){H.expandTagTree(K);O=c.toHtml({id:K,displayName:this.getDisplayname(),count:g,isPreciseCount:L,isSelected:F,isDeletable:A,isDisplayed:G,isExplicit:x,icon:r,isUnderCreation:Q,isExpanded:H.isTagTreeExpanded(K),isTree:I,additionalClassName:(M?"":" wrongType"),color:H.colorManager.isColorized(n)?H.colorManager.getNewColorForTagValue(this)||D:undefined})}}if(!S){w=this.getPredicateView().sortTagValues(w);z=Array.isArray(this.id())?this.id().length:this.id().split("/").length;if(w.length){C=H.isTagTreeExpanded(K)?"position: relative; overflow: hidden; height: auto;":"position: absolute; overflow: hidden; height: 0px;";P+="<ul class='treeTags"+(z>3?" maxLevel":"")+"'>"+O+"<li class='childrenTags' style='"+C+"'><ul class='tags-list'>"+w.map(function(U){return U.toHtml(G,null,null,R,M)}).join("")+"</li></ul></ul>";return P}else{O=O.replace("<li class='tag ","<li class='tag first ")}}return O;default:return c.toHtml({id:K,displayName:this.getDisplayname()||this.id(),count:g,isPreciseCount:L,isSelected:F,isDeletable:A,isDisplayed:G,isExplicit:x,icon:r,isUnderCreation:Q,additionalClassName:(M?"":" wrongType"),color:H.colorManager.isColorized(n)?H.colorManager.getNewColorForTagValue(this)||D:undefined})}};s=i.pred;var t=i.parent;if(t){y=new c(t,l,0)}else{y=d.getPredicateView(s,l)}u=function(z){return z===h};o=y.getChildTagValueView(h);if(!o){y.addTagValueView(this);return this}o.incNbSubjects(q);return o}c.toHtml=function(p){var i;var f=p.isExplicit&&p.isExplicit===true,k=p.isUnderCreation&&p.isUnderCreation===true,r=p.isTree&&p.isTree===true,l=p.isExpanded&&p.isExpanded===true,g=p.additionalClassName?" "+p.additionalClassName:"",h=p.color||false,o=p.isPreciseCount||false,j=/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/,q=["gif","tiff","jpg","jpeg","bmp","png","ico"],n=p.icon,m="";if(n&&n.match(/fonticon-*/)){m='<span class="fonticon '+n+'"></span>'}else{if(n&&n.match(j)&&q.indexOf(n.split(".").pop())!==-1){m='<img src="'+n+'" style="width:20px;height:20px;">'}}i="<li class='tag "+g+(p.isSelected?" selected":"")+(p.isDeletable?" deletable":"")+(l?" expanded":"")+(h?" colorize":"")+((!h&&p.count<0)?" no-count":"")+(!p.isDisplayed?" morelimit":"")+(f?" explicit":"")+(k?" creating":"")+"' title='"+(p.displayName.replace(/'/g,"&#39;"))+"' id='"+p.id+"' data-rec-id='"+p.id+"'>";if(!f){i+=""}i+=r?"<div class='arrow tree'><span class='fonticon fonticon-down-dir'></span><span class='fonticon fonticon-right-dir'></span></div>":"";i+="<div class='tag-elem'>"+m+"<div class='tag-label'>"+p.displayName.escapeHTML();if(k){i+='<div class="spinner spinner-sm spinning fade in" style="height: 12px; padding: 6px; -webkit-transform: translate3d(0px, 0px, 0px); display: inline-block;"><span class="spinner-bar"></span><span class="spinner-bar spinner-bar1"></span><span class="spinner-bar spinner-bar2"></span><span class="spinner-bar spinner-bar3"></span></div>'}i+="</div>";i+="<div class='tag-tail'>";if(p.count>=0){i+="<div class='tag-count' title='"+p.count+"'>"+e.convertToUnity(p.count,o)+"</div>"}if(h){i+="<div class='tag-color' style='background-color:"+h+";'></div>"}i+="</div></div>";if(p.isDeletable){i+="<div class='tag-delete' title='"+(e.getText("deleteTag"))+"'><span class='fonticon fonticon-cancel'></span></div>"}i+="</li>";return i};return c});define("DS/TagNavigator/ActiveCriteria",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/UIKIT/DropdownMenu"],function(k,f,o,e,n,d){var h,g;var c;var j=o.extend(function(r,p,q){this.setActiveCriteria=function(t,s){s=s||{};s.contextId=p;s.widgetId=s.widgetId||q;l.setActiveCriteria(t,r,s)};this.redrawCriteria=function(s){s=s||{};s.contextId=p;s.widgetId=s.widgetId||q;try{l.redrawCriteria(r,s,r==="NGFilter")}catch(t){throw t}};this.getDisplayStatus=function(){return l.getDisplayStatus(p)};return this});var l=f.singleton({init:function(p){h=h||{};g=g||{};p=p||{};this.setupActiveCriteria=function(r){var q,s;if(!k.is(r,"object")){console.error("Invalid input arg");return null}if(!a(r.id)){console.error("Id is not a valid string");return null}if(!a(r.container)){console.error("Invalid container id");return null}if(!a(r.contextId)){if(!a(r.widgetId)){console.error("contextId and widgetId are not valid strings");return null}else{if(k.is(c,"function")){r.contextId=c(r.widgetId)}else{console.warn("Sorry, I don't have the function to recover contextId from widgetId yet. Opening tagger may resolve this issue");r.contextId="orphan_-_"+r.widgetId}}}if(!a(r.module,/^DS(\/\w+)+$/ig)){console.error(r.module+" : is not a valid module path");return null}if(k.is(r.widgetId2contextId,"function")){c=r.widgetId2contextId;i()}q=new j(r.id,r.contextId,r.widgetId);require([r.module],function(x){var v=new x();var u,w,t;if(!v||typeof v.setActiveCriteria!=="function"||typeof v.criteriaToHTML!=="function"){console.error("class provided is not valid")}h[r.contextId]=h[r.contextId]||{};s=k.extendElement(document.getElementById(r.container));u=h[r.contextId][r.id]?(h[r.contextId][r.id].view||[]):[];w=h[r.contextId][r.id]?(h[r.contextId][r.id].container||[]):[];t=h[r.contextId][r.id]?(h[r.contextId][r.id].proxy||[]):[];u.push(s?m(s):null);w.push(s||r.container);t.push(q);h[r.contextId][r.id]={container:w,view:u,setActiveCriteria:v.setActiveCriteria,criteriaToHTML:v.criteriaToHTML,getCriterionFromDOMId:typeof v.getCriterionFromDOMId==="function"?v.getCriterionFromDOMId:undefined,proxy:t}});return q};this.setActiveCriteria=function(q,t,r){var s;if(!a(r.contextId)||!h.hasOwnProperty(r.contextId)){return}else{if(!a(t)||!h[r.contextId].hasOwnProperty(t)){return}else{s=h[r.contextId][t].setActiveCriteria(q,r);g[r.contextId]=g[r.contextId]||{};g[r.contextId][t]=g[r.contextId][t]||{};if(s.allproxies){g[r.contextId][t].allproxies=s.allproxies}if(s.localfilters&&a([r.widgetId,r.proxyId])){g[r.contextId][t][r.widgetId]=g[r.contextId][t][r.widgetId]||{};g[r.contextId][t][r.widgetId][r.proxyId]=s.localfilters}}}};this.redrawCriteria=function(r,C,x){var u,B,s,v;C.getProxyFilters=function(D,E){if(!E||!a([E.widgetId,E.proxyId])){return}return D&&D[E.widgetId]?D[E.widgetId][E.proxyId]:undefined};if(!a(C.contextId)||!h.hasOwnProperty(C.contextId)){}else{if(!a(r)||!h[C.contextId].hasOwnProperty(r)){}else{v=true;u=b("activeFilters",C.contextId);u+='<div id="active-tags-list" class="expandable" style="overflow:inherit;height: auto;"><div class="innerForTransition">';if(h[C.contextId]&&g[C.contextId]){if(h[C.contextId]["NGFilter"]&&g[C.contextId]["NGFilter"]){s=h[C.contextId]["NGFilter"].criteriaToHTML(g[C.contextId]["NGFilter"],UWA.clone(C));v=v&&!a(s);u+=s}if(h[C.contextId]["searchCriteria"]&&g[C.contextId]["searchCriteria"]){s=h[C.contextId]["searchCriteria"].criteriaToHTML(g[C.contextId]["searchCriteria"],UWA.clone(C));v=v&&!a(s);u+=s}if(h[C.contextId]["taggerCriteria"]&&g[C.contextId]["taggerCriteria"]){var q=UWA.clone(C);if(x){var w=false;var y=g[C.contextId]["taggerCriteria"];if(UWA.is(y,"object")){var A=y[C.widgetId];if(UWA.is(A,"object")){var t=Object.keys(A);if(t.length===1){var z=p[t[0]];if(z&&z.isActive()&&z._navimpl.getFocusedProxy()===z){q.proxyId=t[0]}}}}}s=h[C.contextId]["taggerCriteria"].criteriaToHTML(g[C.contextId]["taggerCriteria"],q);v=v&&!a(s);u+=s}}u+="</div></div>";for(B in h[C.contextId]){h[C.contextId][B].container.forEach(function(D,E){if(!(D instanceof HTMLElement)){D=k.extendElement(document.getElementById(D))||D;h[C.contextId][B].view[E]=(D instanceof HTMLElement)?m(D):undefined;h[C.contextId][B].container[E]=D}if(!(D instanceof HTMLElement)){return}if(!v){try{if(!D.hasClassName("expanded-section")){D.addClassName("expanded-section")}D.setContent(u);D.setStyle("display","block")}catch(F){throw F}}else{try{D.setContent("");D.setStyle("display","none")}catch(F){throw F}}})}}}};this.getDisplayStatus=function(q){if(!k.is(h[q],"object")||Object.keys(h[q]).length===0){return false}return Object.keys(h[q]).some(function(r){if(h[q][r].container.length===0){return false}return h[q][r].container.some(function(s){return s instanceof HTMLElement&&s.getStyle("display")!=="none"})})}}});function m(p){var q;if(!p.hasClassName("section")){p.addClassName("section")}if(!p.hasClassName("active-tags")){p.addClassName("active-tags")}var r=e.extend({container:p,domEvents:{"click .tag":"clickCriteriaEvent","click .local-tag":"clickCriteriaEvent","click .global-tag":"clickGlobalCriteriaEvent","click .tag-dropdown":"clickGlobalCriteriaEvent","click .active-tags-close":"clickTrashEvent",},clickGlobalCriteriaEvent:function(w){q&&q.destroy();var x=w.target.parentElement;if(x.nodeName==="SPAN"){x=x.parentElement}var v,u,t,s,y;v=w.target.getClosest(".appCriteria").id.split("-_-");u=w.target.getClosest(".tag").id;t=w.target.getClosest(".tag").className.indexOf("pinned")!==-1;s=w.target.getClosest(".tag").className.indexOf("disable")!==-1;y=[{text:n.getText("removeTag"),name:"remove",fonticon:"trash"}];if(t){y.unshift({text:n.getText("unPinTag"),name:"unpin",fonticon:"pin-off"})}else{y.unshift({text:n.getText("pinTag"),name:"pin",fonticon:"pin"})}if(!s){q=new d({target:x,items:y,events:{onClick:function(A,z){if(z.name==="pin"){if(h.hasOwnProperty(v[1])){if(h[v[1]].hasOwnProperty(v[0])){h[v[1]][v[0]].proxy.forEach(function(B){if(h[v[1]][v[0]].getCriterionFromDOMId){u=h[v[1]][v[0]].getCriterionFromDOMId(u)}B.dispatchEvent("onCriteriaPin",[u,w])})}}}if(z.name==="unpin"){if(h.hasOwnProperty(v[1])){if(h[v[1]].hasOwnProperty(v[0])){h[v[1]][v[0]].proxy.forEach(function(B){if(h[v[1]][v[0]].getCriterionFromDOMId){u=h[v[1]][v[0]].getCriterionFromDOMId(u)}B.dispatchEvent("onCriteriaUnpin",[u,w])})}}}if(z.name==="remove"){if(h.hasOwnProperty(v[1])){if(h[v[1]].hasOwnProperty(v[0])){h[v[1]][v[0]].proxy.forEach(function(B){if(h[v[1]][v[0]].getCriterionFromDOMId){u=h[v[1]][v[0]].getCriterionFromDOMId(u)}B.dispatchEvent("onCriteriaRemove",[u,w])})}}}}}});q.show()}w.stopPropagation();w.preventDefault()},clickCriteriaEvent:function(u){var t,s;if(u.target.getClosest(".global-tag") instanceof HTMLElement){return}t=u.target.getClosest(".appCriteria").id.split("-_-");s=u.target.getClosest(".tag").id;if(h.hasOwnProperty(t[1])){if(h[t[1]].hasOwnProperty(t[0])){h[t[1]][t[0]].proxy.forEach(function(v){if(h[t[1]][t[0]].getCriterionFromDOMId){s=h[t[1]][t[0]].getCriterionFromDOMId(s)}v.dispatchEvent("onCriteriaClick",[s,u])})}}return false},clickTrashEvent:function(t){var s,u,v=[];s=t.target.getClosest(".active-tags-close").id.split("-_-")[1];if(h.hasOwnProperty(s)){for(u in h[s]){h[s][u].container.forEach(function(w){if(v.indexOf(w.id)===-1){h[s][u].proxy.forEach(function(x){x.dispatchEvent("onTrashClick",t)});v.push(w.id)}})}}}});return new r()}function b(r,p){var q="";r=r||"";q+='<div class="section-header" data-rec-id="active-tags-header">';q+='<span class="section-header-left active-tags-close fonticon fonticon-trash" title="'+(n.getText("clearActiveTags"))+'" id="trash-_-'+p+'" data-rec-id="active-tags-close"></span>';q+='<div class="header-title" id="'+r+'">';q+='<div class="arrow"><span class="fonticon fonticon-down-dir"></span><span class="fonticon fonticon-right-dir"></span></div>';q+=n.getText("activeFilters")+"</div></div>";return q}function a(p,r){if(p&&typeof p==="string"){if((p.length===0)||(r&&r instanceof RegExp&&!r.test(p))){return false}return true}else{if(!(p instanceof Array)){return false}else{for(var q=0;q<p.length;q++){if((!p[q]||typeof p[q]!=="string"||p[q].length===0)||(r&&r instanceof RegExp&&!r.test(p[q]))){return false}}return true}}return false}function i(){var q,r,p,t;var s=Object.keys(h).filter(function(u){return u.split("_-_")[0]==="orphan"});for(q=0;q<s;q++){r=s[q].split("_-_").shift().join("_-_");p=c(r);if(a(p)){for(t in h[s[q]]){h[p][t]=k.clone(h[s[q]][t]);delete h[s[q]][t]}}}}return l});define("DS/TagNavigator/TagNavigatorManagerImpl",["UWA/Core","UWA/Class","DS/TagNavigator/TaggerProxy","DS/TagNavigator/TaggerProxyWithFilteringServices","DS/TagNavigator/Predicate","DS/TagNavigator/PredicateView","DS/TagNavigator/TagValue","DS/TagNavigator/Filter","DS/TagNavigator/TagsServer","DS/TagNavigator/Logger","DS/TagNavigator/CacheManager","DS/TagNavigator/ActiveCriteria","DS/TagNavigator/TaggerSettings"],function(k,d,g,r,c,b,m,f,o,p,i,n,l){var q,h;function a(C,I,w){var e,A,H,u,t,s,B,v,D,x,G,z,E,y,F=this;if(typeof C!=="string"){throw new Error("Invalid input arg")}if(h.some(function(J){e=J;return e.id()===C})){return e}if(k.is(w,"function")){y=w}t=new i();A=true;u=C;B=[];v={};x=I;G=!x?"IsNotInWidget":null;z=null;D=new f();if(!q){q=this}s={};H=function(){if(!A){throw new Error("TagNavigator #{_id} is a zombie")}};this.createActiveCriteria=function(){if(document.getElementById("active-tags")!==null){if(!this.activeCriteriaProxy){this.activeCriteriaProxy=n.setupActiveCriteria({id:"taggerCriteria",contextId:u,container:"active-tags",module:"DS/TagNavigator/TaggerActiveCriteria",widgetId2contextId:y});this.activeCriteriaProxy.addEvent("onCriteriaClick",function(J){this.dispatchEvent(a.events.CRITERIA_CLICK,J)},this);this.activeCriteriaProxy.addEvent("onTrashClick",function(J){this.dispatchEvent(a.events.TRASH_CLICK,J)},this)}this.activeCriteriaProxy.addEvent("onCriteriaPin",function(J){this.dispatchEvent(a.events.CRITERIA_PIN,J)},this);this.activeCriteriaProxy.addEvent("onCriteriaUnpin",function(J){this.dispatchEvent(a.events.CRITERIA_UNPIN,J)},this);this.activeCriteriaProxy.addEvent("onCriteriaRemove",function(J){this.dispatchEvent(a.events.CRITERIA_UNPIN,J);this.dispatchEvent(a.events.CRITERIA_CLICK,J)},this);if(!this.activeSearchProxy){this.activeSearchProxy=n.setupActiveCriteria({id:"searchCriteria",contextId:u,container:"active-tags",module:"DS/TagNavigator/AdvancedSearchCriteria"});this.activeSearchProxy.addEvent("onCriteriaClick",function(K,J){this.dispatchEvent(a.events.CRITERIA_CLICK2,[K,J])},this);this.activeSearchProxy.addEvent("onTrashClick",function(J){this.dispatchEvent(a.events.TRASH_CLICK,J)},this)}}};this.createActiveCriteria();this.getIconVisibleBool=function(J){if(v[J]){return v[J].localFilterIcon!==undefined?v[J].localFilterIcon:false}return false};this.setIconVisibleBool=function(K,J){if(v[K]){v[K].localFilterIcon=J}};this.getCache=function(){return t};this.setFavoritesStatus=function(J){E=J};this.isFavoritesExpanded=function(){return E};this.isAlive=function(){return A};this.isTagInEdition=function(J){var K=B;if(F.hasProxiesInEdition()){K=this.getProxiesInEdition()}return K.some(function(L){return L.isTagInEdition(J)})};this.isReadyForDisplay=function(){if(!this.isAlive()){return false}return F.getProxiesToDisplay().every(function(J){return J.isReady()})};this.id=function(){return u};this.getProxy=function(L){var J=null;H();try{J=new g(L,this);B.push(J);if(L.filteringMode!=="FilteringOnServer"){J=new r(J)}}catch(K){throw new Error(K.message)}if(L.widgetId&&!v[L.widgetId]){v[L.widgetId]={lastFocusedProxyId:null}}a.allProxiesMap[J.id()]=J;this.updateFocusedProxy();return J};this.hasFreeInputSupport=function(L){var N=true,M,K,J=this.getProxiesToDisplay();for(M=0,K=J.length;M<K;M++){if(J[M].hasFreeInputSupport(L)!==true){N=false;break}}return N};this.isForbiddenFreeDates=function(){return this.getProxiesToDisplay().every(function(J){return J.isForbiddenFreeDates()===true})};this.isPreciseCount=function(){return this.getProxiesToDisplay().every(function(J){return J.isPreciseCount()})};this.isAdvancedSearch=function(){return this.getFocusedProxy()&&this.getFocusedProxy().isAdvancedSearch()};this.getStoredTags=function(K){var J={"ds6w:when/ds6w:starts":{"date-string":{"2016/02":{disp:"February",uri:"2016/02"}}}};var L={contextId1:J};for(one in L.contextId1){L.contextId1[one].forEach(function(M){var N=new m(M);if(!D.isSelected(N)){D.toggle(N)}})}};this.setAsCurrent=function(){var J;H();if(this===q){return this}J=q;q=this;J.dispatchEvent(a.events.CHANGE_OF_CURRENT_TN,u);var K=this;if(!a._userId&&l.getOption("allowUserPreferredTags")){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(L){L.getUser({onComplete:function(M){K.setUserId(M.id);(K.getBrand()==="3DDashboard")&&K.updatePinnedTag()},onFailure:function(){(K.getBrand()==="3DDashboard")&&K.updatePinnedTag()}})})}return this};this.updatePinnedTag=function(M){var L=JSON.parse(localStorage.getItem("taggerPinned"))||{};L=L[a._userId]||{};var K="";var J=a._brand==="3DDashboard";if(J){K=this.id()}else{K=window.location.hostname}var O=L[K]||{keep:[]};var N=this;var P=false;O.keep.forEach(function(Q){if(Q&&!N.isSelected(Q.predicate)){N.toggleTagSelection(Q.predicate);P=true}});if(this.getBrand()!=="3DDashboard"&&!M){this.clearFilters()}setTimeout(function(){P&&N.dispatchEvent(a.events.UPDATE_ACTIVECRITERIA)},1000)};this.die=function(){var L,M,J,N,K;H();N=B.slice(0);for(M=0,J=N.length;M<J;M++){L=N[M];L.die(false)}B=[];z=null;t=null;K=h.indexOf(this);if(K!==-1){h.splice(h.indexOf(this),1)}this.dispatchEvent("REDRAW_TAGS");A=false;return this};this.removeProxy=function(K){var J;J=B.indexOf(K);if(J!==-1){B.splice(J,1)}delete a.allProxiesMap[K.id()];return this};this.removeProxiesOfCC=function(K){var J;J=B.slice(0);J.forEach(function(L){if(L.widgetId()===K){try{L.die()}catch(M){p.log("removeAllProxies error: trying to remove an already removed proxy...")}}})};this.removeProxyAfterSwitch=function(K){p.log("Enter removeProxyAfterSwitch, current navImpl id: "+this.id());var J=B.indexOf(K);if(J!==-1){p.log("proxyToRemove successfully located at index:"+J);B.splice(J,1)}};this.addProxyAfterSwitch=function(J){p.log("Enter addProxyAfterSwitch, current navImpl id: "+this.id());B.push(J)};this.switchProxiesOnCC=function(M){p.log("Enter switchProxiesOnCC, current navImpl id: "+this.id());if(M){p.log("proxies of widgetId id to swicth: "+M);var J=false;B.forEach(function(N){if(N.widgetId()===M){console.error("switchProxiesOnCC: proxy with the given widget id already exist");J=true}});if(!J){var L=this;var K=false;h.forEach(function(P){if(P){if(P.isAlive()){if(P.id()!==L.id()){p.log("finding the proxy on navImpl: "+P.id());var N=P.getProxiesArray();if(N){var O=N.slice(0);O.forEach(function(Q){if(Q.isAlive()){if(Q.widgetId()===M){p.log("adding proxy to this navImpl, proxy id="+Q.id());L.addProxyAfterSwitch(Q);P.removeProxyAfterSwitch(Q);K=true}}else{p.log("TaggerProxy '"+Q.id()+"' is a zombie")}})}}}else{p.log("navImpl is dead: "+P.id())}}});if(K){this.dispatchEvent(a.events.REDRAW_TAGS)}}}};this.removeAllProxies=function(){var J=B.slice(0);J.forEach(function(K){try{K.die()}catch(L){p.log("removeAllProxies error: trying to remove an already removed proxy...")}})};this.getProxiesToDisplay=function(J){var L=[],K=false;H();if(!J){J=function(M){if(!M.isActive()){return false}if(z&&z!==M){return false}if(G&&G!==M.widgetId()){return false}if(!K){K=G!==null&&M.hasSubjectsInEdition()}return true}}L=B.filter(J);if(K){L=L.filter(function(M){return M.hasSubjectsInEdition()})}L.editionMode=K;return L};this.eachTagValue=function(J){var K;H();K=F.getProxiesToDisplay();K.forEach(function(L){L.eachTagValue(J)});return this};this.isColorizePossible=function(){var J=F.getProxiesToDisplay();return J.some(function(K){return K.colorizeSupport})};this.colorize=function(J){B.forEach(function(K){K.colorize(J)})};this.unColorize=function(){B.forEach(function(J){J.unColorize()})};this.isRelevantPredicate=function(L){H();var K,J;if(!x||window.richClient){K=this.getProxiesToDisplay();K=(K&&K.length===1)?K[0]:undefined}else{K=this.hasWidgetMaximized()?this.getFocusedProxy():undefined}return K&&K.relevantPredicates&&K.relevantPredicates.length&&K.relevantPredicates.indexOf(L)!==-1};this.hasProxiesInEdition=function(){H();return this.getProxiesToDisplay().editionMode};this.getProxiesInEdition=function(){var J=[];H();J=this.getProxiesToDisplay();if(J.editionMode){return J}return[]};this.hasWidgetMaximized=function(){H();return(x&&G!==null)};this.getWidgetIds=function(){return Object.keys(v)};this.getActiveTags=function(){var J=[];H();D.each(function(K){return J.push(K)});return J};this.getLocalActiveTags=function(){var J=[];H();if(this.getFocusedProxy()!==null){this.getFocusedProxy().getLocalFilter().each(function(K){return J.push(K)})}return J};this.getActiveAttributes=function(){if(this.getFocusedProxy()!==null){return this.getFocusedProxy().getLocalFilter().getSelectedAttributes()}return null};this.hasActiveTags=function(){H();var J=this.getFocusedProxy()?this.getFocusedProxy().getParameters():null;return !D.isEmpty()||(J&&J.isReadyForSearch())};this.hasLocalActiveTags=function(){var J;H();if(this.getFocusedProxy()!==null){J=this.getFocusedProxy();return !J.getLocalFilter().isEmpty()}return false};this.isSelected=function(L){var J,K;H();if(L instanceof m){K=L}else{J=JSON.parse(L);K=m.getTagValue(J.predicate,J.dispValue,J.object,J.type)}return D.isSelected(K)||(this.getFocusedProxy()!==null?this.getFocusedProxy().getLocalFilter().isSelected(K):false)};this.getListOfSelectedTagValues=function(J){var K=this.getFocusedProxy()!==null?this.getFocusedProxy().getLocalFilter().getSelectedTagValues(J):[];return K.concat(D.getSelectedTagValues(J))};this.onRefine=function(J){var L,K;H();L=D.computeFilterObj();this.dispatchEvent("FILTER_CHANGE",L);if(!J){K=function(M){return M.isActive()}}this.getProxiesToDisplay(K).forEach(function(M){M.onBeforeRefine()});this.getProxiesToDisplay(K).forEach(function(M){M.onRefine()});return this};this.clearFilters=function(){H();var L=this.getActiveTags();var N=this;var M=this.getTagPinnedFromCurrentContext();var K=this.getFocusedProxy();var J=a._brand==="3DDashboard";if(L.length>0&&M.length>0&&(!K||!J)){L.forEach(function(P){var O=false;M.forEach(function(Q){Q=JSON.parse(Q.predicate);O=O||N.isTheSameTag(P,Q)});if(!O){D.toggle(P)}})}else{if(!K||!J){D.clear()}}if(this.getFocusedProxy()!==null){this.getFocusedProxy().clearLocalFilter()}this.onRefine();return this};this.isTheSameTag=function(R,Q){var K=false;if(R.type===Q.type){var P=R.object||R.uri;var O=Q.object||Q.uri;var N=R.predicate||R.pred.getFullPredicateID();var M=Q.predicate;if(P===O&&N===M){K=true}else{if(P instanceof Array&&P.length===O.length){var J=true;for(var L=0;L<P.length;L++){J=J&&(P[L]===O[L])}K=J}}}return K};this.setUserId=function(J){console.log("this.setUserId");a._userId=J};this.getUserInfo=function(){return a._userId};this.getBrand=function(){return a._brand};this.getTagPinnedFromCurrentContext=function(){var L=JSON.parse(localStorage.getItem("taggerPinned"))||{};L=L[a._userId]||{};var J=a._brand==="3DDashboard";var K="";if(J){K=this.id()}else{K=window.location.hostname}var M=L[K]||{keep:[]};return M.keep};this.saveTagPinToLocal=function(K,Q){var N=JSON.parse(localStorage.getItem("taggerPinned"))||{};var M=N[a._userId]||{};var J=a._brand==="3DDashboard";var L="";if(J){L=this.id()}else{L=window.location.hostname}var P=M[L]||{keep:[]};var O=false;P.keep.forEach(function(R){if(R.predicate===K){O=true}});!O&&P.keep.push({predicate:K,DOMId:Q});N[a._userId]=N[a._userId]||{};N[a._userId][L]=P;localStorage.setItem("taggerPinned",JSON.stringify(N));this.dispatchEvent(a.events.UPDATE_ACTIVECRITERIA)};this.clearTagPinInLocal=function(Q,K){var P=JSON.parse(localStorage.getItem("taggerPinned"))||{};var M=P[a._userId]||{};var R=a._brand==="3DDashboard";var N="";if(R){N=this.id()}else{N=window.location.hostname}var J=M[N]||{keep:[]};var L=-1;var O=this;J.keep.forEach(function(T,S){if(O.isTheSameTag(JSON.parse(T.predicate),JSON.parse(Q))){L=S}});if(L!==-1){J.keep.splice(L,1)}P[a._userId]=P[a._userId]||{};P[a._userId][N]=J;localStorage.setItem("taggerPinned",JSON.stringify(P));this.dispatchEvent(a.events.UPDATE_ACTIVECRITERIA)};this.getFilters=function(J,K){return D.computeFilterObj(null,J,K)};this.toggleTagSelection=function(O,N){var K,J,L,P;H();J=JSON.parse(O);L=m.getTagValue(J.predicate,J.dispValue,J.object,J.type);var R=a._brand==="3DDashboard";var Q=window.location.href.indexOf("allowUserPreferredTags")!==-1;if(!Q){if(this.getFocusedProxy()!==null){if(!D.isSelected(L)){P="local_selectedFilters"}else{if(this.getFocusedProxy().getLocalFilter().isSelected(L)){P="local"}}}}else{if(this.getFocusedProxy()!==null&&R){P="local"}}var M=false;if(P==="local"||P==="local_selectedFilters"){K=this.getFocusedProxy().updateSelectedTVLocalFilter(P,L,N)}else{if(D.isSelected(L)){this.getTagPinnedFromCurrentContext().forEach(function(S){if(S.predicate===O){M=true}})}if(!M){K=D.toggle(L)}}if(J.type==="date"){this.getCache().colorManager.clearComputedColorMap(J.predicate)}if(N!==false){if(B.length){this.onRefine()}else{this.dispatchEvent("REDRAW_TAGS")}}return K};this.updateFreeInputs=function(J,K){var L;H();L=this.getFocusedProxy();if(L!==null){this.getFocusedProxy().updateFreeInputs(J,K)}};this.createFreeInputs=function(J){var K;H();K=this.getFocusedProxy();if(K!==null){this.getFocusedProxy().createFreeInputs(J)}};this.removeFreeInputs=function(J){var K;H();K=this.getFocusedProxy();if(K!==null){this.getFocusedProxy().removeFreeInputs(J)}};this.requestSuggestions=function(K,L){var M=this.getFocusedProxy(),J;if(M===null){return}J={suggestField:K,suggestTitle:L,allfilters:M.getFilters().allfilters,localfilters:M.getFilters().localfilters};M.triggerCallbackOfEvent(g.RequestSuggestions,J)};this.clickOnMoreButton=function(J){H();if(!s[J]){s[J]=100;return}s[J]+=100};this.getMoreLimitForPredicate=function(J){H();return s[J]||7};this.createTagValue=function(K,J,N){var L,O,M=this;H();if(!this.hasProxiesInEdition()){throw new Error("Unexpected creation of tag without a proxy in edition")}if(!(J instanceof c&&typeof K==="string")){throw new Error("Invalid input arg")}L=function(){M.modifiedPredicate=J;M.dispatchEvent(a.events.REDRAW_TAGS)};O=this.getProxiesInEdition();O.forEach(function(P){P.createTagValue(K,J,L,N)});return this};this.deleteTagValue=function(K,J){var N,M,L=this;H();if(!this.hasProxiesInEdition()){throw new Error("Unexpected delete of tag without a proxy in edition")}if(!(J instanceof c&&typeof K==="string")){throw new Error("Invalid input arg")}N=function(){return L.dispatchEvent(a.events.REDRAW_TAGS)};M=this.getProxiesInEdition();M.forEach(function(O){O.deleteTagValue(K,J,N)});return this};this.getCriteriaIdsMap=function(){return this.getFocusedProxy()?this.getFocusedProxy().getCriteriaIdsMap():{}};this.updateFocusedProxy=function(){var K,N;if(G){N=this.getFocusedProxy();if(!N||N._widgetId!==G||!N.isActive()){K=this.getProxyToFocusFromWidgetId(G);this.toggleProxyFocus(K,true)}else{K=N}}this.dispatchEvent("UPDATE_ICON");var M=window.location.href.indexOf("allowUserPreferredTags")!==-1;if(M){var L=this;var J=a._brand==="3DDashboard";J&&L.dispatchEvent(a.events.UPDATE_ACTIVECRITERIA);if(!J){L.updatePinnedTag(K)}}};this.focusOnCC=function(J){if(window.proxyLogs){p.group("Focus on widget");p.info("Widget id : ",J);p.groupEnd("Focus on widget")}H();if(!x||J==="IsNotInWidget"){p.error("Request to focus on widget, but not a widget");return this}G=J;this.updateFocusedProxy();return this};this.unfocusCC=function(){if(window.proxyLogs){p.group("Unfocus widget");p.info("Widget id : ",G);p.groupEnd("Unfocus widget")}H();G=null;this.removeFocusedProxy(true);return this};this.getWidgetMaximized=function(){return G};this.getFocusedProxy=function(){return z};this.getProxyToFocusFromWidgetId=function(K){var L,J=v[K]?v[K].lastFocusedProxyId:undefined;B.some(function(M){if(M._widgetId===K&&M._isActive){if(!L){L=M;if(!J){return true}}if(M._id===J){L=M;return true}}return false});return L};this.removeFocusedProxy=function(J){this.toggleProxyFocus(z,false);this.dispatchEvent("UNFOCUS",J);this.dispatchEvent("UPDATE_ICON")};this.toggleProxyFocus=function(M,L){var J=null;var K;if(!M){this.dispatchEvent("REDRAW_TAGS");return}if(M!==z&&z!==null){J=z}z=L?M:null;if(z){v[z._widgetId].lastFocusedProxyId=z._id}if(J){J.updateProxyView(J._selectedValues.isEmpty(),true,false)}M.updateProxyView(M._selectedValues.isEmpty(),true);K={widgetId:M._widgetId,proxyId:M._id};if(!this.activeCriteriaProxy){this.createActiveCriteria()}this.activeCriteriaProxy.redrawCriteria(K)};this.hasFocusedProxyWithRelevantPredicate=function(){var J=this.getProxiesToDisplay();if(UWA.is(J,"array")){if(J.length===1){if(J[0]&&J[0].hasRelevantPredicates()){if(J[0]===this.getFocusedProxy()){return J[0]}}}}};this.getProxyPreferredSortOrder=function(){var J=this.getFocusedProxy();if(J){return J.getSortOrder()}};this.updateDisplayStatus=function(J){B.forEach(function(K){K.triggerCallbackOfEvent(g.updateDisplayStatus,J)})};this.getProxiesArray=function(){return B};this.setColorMap=function(J){t.colorManager.setColorMap(J);this.dispatchEvent("REDRAW_TAGS")};h.push(this);return this}k.extend(a.prototype,d.Events.prototype);a.count=function(){return h.length};a.events={CHANGE_OF_CURRENT_TN:"CHANGE_OF_CURRENT_TN",UNFOCUS:"UNFOCUS",UPDATE_ICON:"UPDATE_ICON",REDRAW_TAGS:"REDRAW_TAGS",REDRAW_CRITERIA:"REDRAW_CRITERIA",FILTER_CHANGE:"FILTER_CHANGE",OPEN_TAGGER:"OPEN_TAGGER",CLOSE_TAGGER:"CLOSE_TAGGER",SEARCH_LAUNCH:"SEARCH_LAUNCH",CRITERIA_CLICK:"CRITERIA_CLICK",CRITERIA_CLICK2:"CRITERIA_CLICK2",TRASH_CLICK:"TRASH_CLICK",CRITERIA_PIN:"CRITERIA_PIN",CRITERIA_UNPIN:"CRITERIA_UNPIN",UPDATE_ACTIVECRITERIA:"UPDATE_ACTIVECRITERIA"};a.allProxiesMap={};h=[];q=null;try{n.init(a.allProxiesMap)}catch(j){console.log("Issue in ActiveCriteria.init, message="+j.message)}return a});define("DS/TagNavigator/TaggerActiveCriteria",["UWA/Core","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TagNavigatorManagerImpl",],function(c,b,a){function d(){var n={},f={},m={};this.setActiveCriteria=function(o,w){var t,u,p,s,q,r,v={};v={allproxies:{},localfilters:{}};for(u in o.allfilters){p=o.allfilters[u];if(p.length===1&&p[0].type==="date"){s=[p[0].disptext];r=[g(p[0],u)];if(p[0].parent){s.push(p[0].parent.disptext);r.push(g(p[0].parent,u));if(p[0].parent.parent){s.push(p[0].parent.parent.disptext);r.push(g(p[0].parent.parent,u))}}v.allproxies[u]=[{text:s.reverse(),tagId:r.reverse(),isPinned:l(w.contextId,u,p[0])}]}else{v.allproxies[u]=p.map(function(x){return{text:x.disptext,tagId:g(x,u),isPinned:l(w.contextId,u,x)}})}}if(e([w.widgetId,w.proxyId])&&o.localfilters){for(u in o.localfilters){p=o.localfilters[u];if(p.length===1&&p[0].type==="date"){s=[p[0].disptext];r=[g(p[0],u)];if(p[0].parent){s.push(p[0].parent.disptext);r.push(g(p[0].parent,u));if(p[0].parent.parent){s.push(p[0].parent.parent.disptext);r.push(g(p[0].parent.parent,u))}}v.localfilters[u]=[{text:s.reverse(),tagId:r.reverse()}]}else{v.localfilters[u]=p.map(function(x){return{text:x.disptext,tagId:g(x,u),isPinned:l(w.contextId,u,x)}})}}}if(w.predicatesNLS){m=w.predicatesNLS}return v};this.criteriaToHTML=function(t,q){var p,o,s;var r=[];if(!t){return""}q.proxyId=q.proxyId||n[q.widgetId];n[q.widgetId]=q.proxyId;r.push(i(t.allproxies));r.push(e([q.widgetId,q.proxyId])&&q.widgetId in t&&q.proxyId in t[q.widgetId]&&i(t[q.widgetId][q.proxyId]));if(r[0]||r[1]){p='<div id="taggerCriteria-_-'+q.contextId+'" class="appCriteria">';if(r[0]){if(r[1]){p+='<span class="title-active-criteria"> '+b.getText("tab")+" </span>"}for(o in t.allproxies){s=t.allproxies[o];if(s.length>0){p+="<ul class=active-predicate-list>";p+=j(o)+k(s,true,q.proxyId);p+="</ul>"}}}if(r[1]){if(r[0]){p+='<span class="title-active-criteria">Current Widget: </span>'}for(o in t[q.widgetId][q.proxyId]){s=t[q.widgetId][q.proxyId][o];if(s.length>0){p+="<ul class=active-predicate-list>";p+=j(o)+k(s);p+="</ul>"}}}p+="</div>"}else{return""}return p};function l(s,p,v){var o=a._brand==="3DDashboard";if(!o){s=window.location.hostname}var r=JSON.parse(localStorage.getItem("taggerPinned"))||{};r=r[a._userId]||{};var t=r[s]||{keep:[]};var q=false;var u=t.keep;u.forEach(function(y){var x=JSON.parse(y.predicate);if(x.predicate===p){if(v.object===x.object){q=true}else{if(v.object instanceof Array&&v.object.length===x.object.length){var z=true;for(var w=0;w<v.object.length;w++){z=z&&(v.object[w]===x.object[w])}q=z}}}});return q}function j(o){o=o.split("/");var q=o[0].split(":")[1];var r=m[o.join("/")]||o[o.length-1].split(":")[1];var p='<li class="predicate expanded list-view selected '+q+'" id="atv'+h(o.join("/"))+'">';p+='<div class="predicate-header" title="'+r+'"><div class="predicate-label">';p+='<span class="fonticon fonticon-3ds-'+q+'"></span>'+r+"</div></div></li>";return p}function k(q,u,p){var s=0,r=0,o=["year","month","day"],t=c.createElement(),v;var x=a._brand==="3DDashboard";u=u||!x;p=p&&x;var w=window.location.href.indexOf("allowUserPreferredTags")!==-1;for(s=0;s<q.length;s++){v=w&&u?"global-tag tag selected ":"local-tag tag selected ";v+=p?" disable ":"";if(q[s].text instanceof Array){for(r=0;r<q[s].text.length;r++){v+=q[s].isPinned?" pinned ":"";t.grab(c.createElement("li",{"class":v+o[r%o.length],id:q[s].tagId[r]+"atv",title:q[s].text[r],"data-rec-id":q[s].tagId[r],html:{tag:"div","class":"tag-elem",html:[{tag:"div","class":"tag-label",html:[{text:q[s].text[r],},{tag:"span","class":"fonticon fonticon-pin pinned"}]},{tag:"span","class":w&&u?"tag-dropdown fonticon fonticon-down-open":""}]}}))}}else{v+=q[s].isPinned?" pinned ":"";t.grab(c.createElement("li",{"class":v,id:q[s].tagId+"atv",title:q[s].text,"data-rec-id":q[s].tagId,html:{tag:"div","class":"tag-elem",html:[{tag:"div","class":"tag-label",html:[{tag:"span",text:q[s].text,},{tag:"span","class":"fonticon fonticon-pin pinned"}]},{tag:"span","class":w&&u?"tag-dropdown fonticon fonticon-down-open":""}]}}))}}return t.getHTML()}function e(o,q){if(o&&typeof o==="string"){if((o.length===0)||(q&&q instanceof RegExp&&!q.test(o))){return false}return true}else{if(!(o instanceof Array)){return false}else{for(var p=0;p<o.length;p++){if((!o[p]||typeof o[p]!=="string"||o[p].length===0)||(q&&q instanceof RegExp&&!q.test(o[p]))){return false}}return true}}return false}function i(p){if(Object.keys(p).length===0){return false}for(var o in p){if(p[o].length>0){return true}}return false}function h(s){var q,r,p,o;r=0;if(s.length!==0){for(p=0,o=s.length;p<o;p++){q=s[p];r=((r<<5)-r)+q.charCodeAt(0);r=r&r}}r="id_"+r;f[r]=s;return r}function g(q,p){var o=JSON.stringify({predicate:p,object:q.object,dispValue:q.disptext,type:q.type});return h(o)}}return d});define("DS/TagNavigator/TagNavigatorManager",["DS/TagNavigator/TagNavigatorManagerImpl","DS/TagNavigator/TagsServer"],function(b,c){function a(e){var d;if(!(e instanceof b)){throw new Error("Invalid input arg")}d=e;this.isAlive=function(){return d.isAlive()};this.setAsCurrent=function(){d.setAsCurrent();return this};this.focusOnCC=function(f){d.focusOnCC(f);return this};this.unfocusCC=function(){d.unfocusCC();return this};this.getProxy=function(g){var i,f,h;if(!arguments.length){throw new Error("Invalid Input arguments")}if((arguments.length===1)&&(typeof g==="object")&&(g!==null)){if((!g.widgetId)||(typeof g.widgetId!=="string")){g.widgetId="IsNotInWidget"}if(!g.cStorages&&(g.tagsServicesURL||g.tagsServerUrl)){g.cStorages={};i=(g.tagsServicesURLQueryParams?g.tagsServicesURLQueryParams.tenant:(g.tagsServerUrlParams?g.tagsServerUrlParams.tenant:null));f=g.tagsServicesURL||g.tagsServerUrl;h=new c(f,i);g.cStorages._default=h;if(i){g.cStorages[i]=h}}if(!g.filteringMode){g.filteringMode="FilteringOnServer"}if(typeof g.hasPlatformData!=="boolean"){g.hasPlatformData=true}return d.getProxy(g)}throw new Error("Invalid Input arguments")};this.removeProxiesOfCC=function(f){d.removeProxiesOfCC(f);return this};this.switchProxiesOnCC=function(f){d.switchProxiesOnCC(f);return this};this.removeAllProxies=function(){d.removeAllProxies();return this};this.getProxyWithFilteringServices=function(g,f){return this.getProxy({proxyDisplayName:g,tagsServerUrl:f,filteringMode:"WithFilteringServices"})};this.getFilters=function(){return d.getFilters()};this.clearFilters=function(){return d.clearFilters(true)};this.id=function(){return d.id()};this.die=function(){d.die();return this}}return a});define("DS/TagNavigator/TaggerView",["UWA/Core","UWA/Class/View","UWA/Class/Promise","UWA/Storage","UWA/Storage/Adapter/Dom","DS/TagNavigator/TagNavigatorManagerImpl","DS/TagNavigator/AbstractPredicateView","DS/TagNavigator/TagValue","DS/TagNavigator/Predicate","DS/TagNavigator/PredicateView","DS/TagNavigator/RootPredicateView","DS/TagNavigator/TagValueView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Parameter","DS/TagNavigator/Parameters","DS/TagNavigator/ParameterView","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/TagNavigator/NotificationManager","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/DropdownMenu","DS/UIKIT/IconDropdown","DS/UIKIT/Autocomplete","DS/UIKIT/Tooltip","UWA/Controls/TabView","DS/TagNavigator/Logger","DS/TagNavigator/Suggestions","DS/UIKIT/Scroller","DS/TagNavigator/TaggerProxyWithFilteringServices","DS/TagNavigator/TaggerSettings"],function(l,O,C,x,G,y,u,s,B,h,c,e,i,b,g,H,p,F,K,v,J,a,I,n,j,k,M,L,z,m,N,t,f,o,D){var d=false;var q=600,r=600,A=true,w=true,E={"ds6w:who":"Who","ds6w:when":"When","ds6w:what":"What","ds6w:where":"Where","ds6w:why":"Why","ds6w:how":"How"};var P=O.extend({_customEnumFiltering:undefined,init:function(R,W,Q,V,U,T,S){this._parent({tnManagerImpl:R,domId:W,tn:Q,userSettings:V,setLocalFilterIcon:U,taggerIconId:T,visibility:S===true});this._customEnumFiltering=D.getOption("customFilteringAdvSearch")},setup:function(T){var R;if(!(T.tnManagerImpl instanceof y)){throw new Error("Invalid input arg")}if(typeof T.domId==="string"){this.taggerUWAElement=document.getElementById(T.domId)}if(!this.taggerUWAElement){throw new Error("Unexisting target DOM element")}this.taggerUWAElement=l.extendElement(this.taggerUWAElement);this.taggerIcon=l.extendElement(document.getElementById(T.taggerIconId));if(this.taggerIcon){this.taggerIcon.addEvent("click",this.mainTaggerIconClicked.bind(this))}this.storage=new x({adapter:"Dom",database:"TagNavigator"});this.isW=this.storage&&(this.storage.get("isW")==="true")?true:false;this.container=this.taggerUWAElement;this.tagnavigator=T.tn;this.taggerScroller=null;this.criteriaScroller=null;this.timer=null;this.callServerInProgress=false;this.timerOnSearch=null;this.internalRedrawTimer=null;this.DOMIdToId={};this.selectedTags=[];this.fx=function(W,X){var Y=this;return new l.Fx(W,{duration:300,transition:"quadInOut",events:{onComplete:function(){if(X){W.setStyles({position:"relative",overflow:"hidden",height:"auto"})}else{W.setStyles({position:"absolute",height:"0px"})}Y.updateScroller()},onStart:function(){W.setStyle("position","relative");W.setStyle("overflow","hidden")}}})};this.setLocalFilterIcon=T.setLocalFilterIcon;this.visibility=T.visibility;this.myNotificationControl=new p({closable:true,visible:true,maximumVisibleMessages:2,autoHide:false,messageClassName:"error"});this.selectedTenant=null;this.selectedPredicate="ds6w:what";var U={};U[y.events.FILTER_CHANGE]=function(W){if(this.tagnavigator.hasEvent("onFilterChange")){this.tagnavigator.dispatchEvent("onFilterChange",W)}this.setActiveCriteria(true,true)};U[y.events.CHANGE_OF_CURRENT_TN]=function(X){var Y,W=new y(X);if(!this.observedNavImpl){throw new Error("Unexpected change of current TN while the TaggerView is not already observing a Tagger?!")}if(this.observedNavImpl===W){return false}for(Y in y.events){this.observedNavImpl.removeEvent(Y,U[Y])}l.log("The view now ignores the TagNavigator '"+(this.observedNavImpl.id())+"'");this.observedNavImpl=W;for(Y in y.events){this.observedNavImpl.addEvent(Y,U[Y],this)}l.log("The view now observes the TagNavigator '"+X+"'");if(this.tagnavigator.hasEvent("onFilterChange")){this.tagnavigator.dispatchEvent("onFilterChange",this.observedNavImpl.getFilters())}this.redraw();return this};U[y.events.REDRAW_TAGS]=function(){this.redraw()};U[y.events.REDRAW_CRITERIA]=function(){this.internalRedrawTimer=setTimeout(this.redrawCriteria.bind(this),50)};U.SEARCH_LAUNCH=function(){if(this.visibility){this.redrawActiveCriteria(false)}};U[y.events.UPDATE_ICON]=function(){var Y;if(this.setLocalFilterIcon){for(var X in y.allProxiesMap){Y=y.allProxiesMap[X].widgetId();if(this.observedNavImpl.getProxyToFocusFromWidgetId(Y)&&X===this.observedNavImpl.getProxyToFocusFromWidgetId(Y).id()){var W=(Object.keys(y.allProxiesMap[X].getFilters().localfilters).length!==0);this.setLocalFilterIcon(Y,W)}}}};U[y.events.UNFOCUS]=function(W){W?this.displayTags(false):this.displayTags();return this.redraw()};U[y.events.OPEN_TAGGER]=function(){return this.openTagger()};U[y.events.CLOSE_TAGGER]=function(){return this.closeTagger()};U[y.events.CRITERIA_CLICK]=function(W){this.toggleTagSelection(W.replace("atv",""))};U[y.events.CRITERIA_CLICK2]=function(X,W){X?this.deleteFreeInput(X):this.onToggleParamTagSelection(W)};U[y.events.TRASH_CLICK]=function(W){this.closeSection(W)};U[y.events.CRITERIA_PIN]=function(X){X=X.replace("atv","");var W=this.getIdFromDOMId(X);this.observedNavImpl.saveTagPinToLocal(W,X)};U[y.events.CRITERIA_UNPIN]=function(X){X=X.replace("atv","");var W=this.getIdFromDOMId(X);this.observedNavImpl.clearTagPinInLocal(W,X)};U[y.events.UPDATE_ACTIVECRITERIA]=function(){this.setActiveCriteria(true,true);this.redraw()};this.observedNavImpl=T.tnManagerImpl;for(R in y.events){this.observedNavImpl.addEvent(R,U[R],this)}this.observedNavImpl.setAsCurrent();this.taggerRoot=l.createElement("div",{id:"tagnavigator","class":this.isW?"isw":"no-w","data-rec-id":"tagnavigator",html:this.tagnavigator.hasEvent("onClose")?"<span class='tagger-close fonticon fonticon-cancel' data-rec-id='tagger-close'></span>":""});this.taggerActiveCriteria=l.createElement("div",{id:"active-tags","class":"active-tags section "+(this.observedNavImpl.getCache().isSectionCollapsed("activeFilters")?"":"expanded-section"),"data-rec-id":"active-tags",styles:{display:((this.observedNavImpl.hasActiveTags()||this.observedNavImpl.hasLocalActiveTags())&&!this.observedNavImpl.hasProxiesInEdition())!==false?"block":"none"}});this.taggerHeader=l.createElement("div",{id:"header-container","class":"allw"});this.taggerRoot.addContent([this.taggerActiveCriteria,this.taggerHeader]);this.taggerUWAElement.addContent(this.taggerRoot);this.tagsContainer=l.createElement("div",{style:{height:q},id:"all-tags-container","data-rec-id":"all-tags-container",tabindex:0});this.tagsContainer.grab(l.createElement("div",{id:"all-tags"}).grab(l.createElement("div",{id:"tags-var-height"})));this.criteriaContainer=l.createElement("div",{style:{height:r},id:"all-criteria-container"});this.globalSearchInput=l.createElement("div",{id:"filter-all","class":"add-tag-cont search-cont",styles:{overflow:"hidden",height:"0px"},html:"<span class='add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span><input id='taginput' class='tagger-input searchbox' title='"+(i.getText("searchTag"))+"' placeholder='"+(i.getText("searchTag"))+"'/>"});this.criteriaContainer.setContent("<div id='all-criteria'></div>");this.searchButton=new J({value:i.getText("search"),className:"primary search-button"});this.searchButton.disable();K.addEvent("notify",function(W){if(this.taggerRoot){if(w){this.myNotificationControl=new p({closable:true,visible:true,maximumVisibleMessages:2,autoHide:true,hideDelay:8000,messageClassName:W.data.className||"error"});this.myNotificationControl.add(W.message)}}}.bind(this));var S=this.observedNavImpl.getCache();q=600;r=600;var V=this;this.createHeaderElemNoW();this.taggerHeader.innerHTML=this.tnHeaderToHtml();this.menu6wIcon.inject(this.taggerHeader.getElement(".tn-header-title"));var Q=this.taggerHeader.getElement(".sort-6w");this.menuSort6WIcon.inject(Q,"bottom");new z({position:"bottom",target:Q,body:i.getText("sort6w"),className:"sort6w-tooltip"});new z({position:"bottom",target:this.taggerHeader.getElement(".tagger-filter"),body:i.getText("searchTag"),className:"tagger-filter-tooltip"});new z({position:"bottom",target:this.taggerRoot.getElement(".tagger-close"),body:i.getText("closeTagger"),className:"tagger-close-tooltip"});this.tabView=new m({tabs:[new m.Tab({id:"tags-tab",name:"tags",text:"6WTags"}),new m.Tab({id:"criteria-tab",name:"criteria",text:i.getText("suggestedTags")})],events:{onSelectTab:function(Y,X,W){if(V.tabView){V.taggerHeader.getElement(".tagnavheader").toggleClassName("criteria",Y.options.name==="criteria");if(Y.getName()==="criteria"){V.displayCriteria()}else{if(Y.getName()==="tags"){V.displayTags()}}if(V.observedNavImpl&&V.observedNavImpl.getCache()){V.observedNavImpl.getCache().selectedTab=Y.getName()}V.redraw()}}}}).inject(this.taggerRoot);if(!this.observedNavImpl.activeCriteriaProxy||!this.observedNavImpl.activeSearchProxy){this.observedNavImpl.createActiveCriteria()}this.tabView.getTab("tags").setContent(this.tagsContainer);this.tabView.getTab("criteria").setContent(this.criteriaContainer);this.globalSearchInput.inject(this.tabView.elements.contentNode.getElement("#tags-tab"),"top");if(!d){if(!this.taggerScroller){this.taggerScroller=new f({element:this.tagsContainer.getElement("#all-tags")}).inject(this.tagsContainer)}if(!this.criteriaScroller){this.criteriaScroller=new f({element:this.criteriaContainer}).inject(this.taggerRoot.getElement("#criteria-tab"))}if(window.addEventListener){window.addEventListener("resize",this.updateScroller.bind(this))}}this.tagsContainer.grab(l.createElement("div",{id:"tagger-footer"}));this.criteriaContainer.grab(l.createElement("div",{id:"criteria-footer"}));this.criteriaContainer.getElement("#criteria-footer").innerHTML+="<hr/><div id='criteria-toggle-container'></div><div id='search-button-container'></div>";this.redraw()},domEvents:{"click .tagger-filter":"toggleSearchInput","click .section-header":"toggleSection","click .parameter":"onToggleParamTagSelection","click .attribute":"onFreeInputDeletion","click .tag-delete":"onTagDeletion","click .more":"moreClicked","click .tree":"toggleTagExpand","click #all-tags .tag":"triggerToggleTagSelection","click .fonticon-menu-dot":"toggleToolBoxVisibility","click .tool-icon.sort":"changeSort","click .toolboxView":"changeView","click #all-tags .predicate-header":"clickedPredicateEvent","click .add-tag-close":"clearInput","keyup #taginput":"onSearchInput","input .tagger-input":"addOrRemoveClear","click .tagger-close":"closeTagger","click .criteria-toggle":"toggleCriteriaExpand","click .show-all-toggle":"toggleMore","click .search-button":"onSearchLaunch","keyup #all-tags-container":"onRefineLaunch","keydown #tagnavigator":"toggleIsW","click .parameters-toggle":"toggleParametersExpand","click .add-tag-magnifier-param":"clickParameterMagnifier","keydown #parameter-input-field":"clickParameterMagnifier",},onRefineLaunch:function(Q){if(Q.keyCode===17&&this.selectedTags.length){for(var R=0;R<this.selectedTags.length;++R){this.toggleTagSelection(this.selectedTags[R],false)}this.selectedTags=[];this.observedNavImpl.onRefine()}},moreClicked:function(S){var R=S.target.getClosest(".predicate")||S.target.getClosest(".section.ds6w-root-predicate"),Q=this.getIdFromDOMId(R.id).split("/").pop();this.observedNavImpl.clickOnMoreButton(Q);this.redrawPredicate(R.id)},toggleCriteriaExpand:function(R){var Q=this.observedNavImpl.getCache();if(UWA.is(R,"boolean")){Q.setMoreClicked(R)}else{Q.setMoreClicked(!Q.isMoreClicked())}this.redraw()},toggleTagExpand:function(S){var U,aa,X,V,W=S.target.getClosest(".tag"),T=S.target.getClosest(".tag").id,Q=this.observedNavImpl.getCache(),Y=S.target.getClosest(".predicate"),Z=this.getIdFromDOMId(Y.id),R=Z.split("/").pop();V=!Q.isTagTreeExpanded(T);V?Q.expandTagTree(T):Q.collapseTagTree(T);if(Q.colorManager.isColorized(Z)){this.redrawPredicate(Y.id)}else{W.toggleClassName("expanded",V);U=W.getParent().getElement(".childrenTags");aa=l.extendElement(U.getChildren()[0]);this.fx(U,V).start({height:V?[0,aa.getSize().height]:[aa.getSize().height,0]})}return false},triggerToggleTagSelection:function(V){var S,X,U,T,W,R;if(this.taggerUWAElement.getElement("#tagnavigator").hasClassName("edition_mode")){return false}S=V.target.getClosest(".tag");if(V.ctrlKey&&V.altKey){return false}if(V.ctrlKey){if(S.id.indexOf("atv")!==-1){return false}if(S.hasClassName("picked")){S.removeClassName("picked");this.selectedTags.splice(this.selectedTags.indexOf(S.id),1)}else{X=S.getParent();if(S.getParents(".date").length){T=X.getElement(".picked");if(T){T.removeClassName("picked");this.selectedTags.splice(this.selectedTags.indexOf(T.id),1)}}S.addClassName("picked");this.selectedTags.push(S.id)}return false}if(V.altKey){if(S.id.indexOf("atv")!==-1){return false}var Q=l.extendElement(S.parentElement).getElements("li.selected");for(W=0,R=Q.length;W<R;++W){this.toggleTagSelection(Q[W].id,false)}}U=S.id.replace("atv","");this.toggleTagSelection(U);return false},toggleTagSelection:function(Q,S){var R;R=this.getIdFromDOMId(Q);this.setSpinner();if(S!==false){this.selectedTags=[]}this.observedNavImpl.toggleTagSelection(R,S)},toggleToolBoxVisibility:function(S){var T,R,U,Q=this.observedNavImpl.getCache(),R=S.target,T=R.getClosest(".predicate-header"),U=T.getParent().id;R.getParent().toggleClassName("expanded",!Q.isToolboxVisible(U));Q.toggleToolboxVisibility(U);return false},changeSort:function(S){if(S.ctrlKey){return false}var R=S.target.hasClassName("fonticon-sort-num-desc")||S.target.hasClassName("fonticon-sort-num-asc"),T=S.target.getClosest(".predicate"),Q=this.observedNavImpl.getCache(),U=this.getIdFromDOMId(T.id);if(R){Q.changeSort("nbSort",U)}else{Q.changeSort("alphaSort",U)}if(T){this.redrawPredicate(T.id,true)}return false},toggleSection:function(R){var X,U,S,T,Y,Q=this.observedNavImpl.getCache(),W=R.target.getClosest(".section");if(R.target.classList.contains("active-tags-close")){return}if(W){X=W.getElement(".header-title").id;U=W.getElement(".expandable");S=UWA.is(Q.isSectionCollapsed(X),"boolean")?Q.isSectionCollapsed(X):(W.hasClassName("expanded-section")?false:true);Y=l.extendElement(U.getChildren()[0]);this.fx(U,S).start({height:S?[0,Y.getSize().height]:[Y.getSize().height,0]});if(S){R.target.getClosest(".section-header").getParent().addClassName("expanded-section")}else{R.target.getClosest(".section-header").getParent().removeClassName("expanded-section")}Q.toggleSection(X);if(Q.isSearchVisible()&&Q.getSearchId()==="filter-"+X){Q.setSearchVisibility(S);if(!S){var V=U.getParent().getElement("input");this.resetSearch(V,true)}this.toggleSearchInput(null,false,true)}}return false},getSearchButton:function(){return this.searchButton},changeView:function(T){if(T.ctrlKey){return false}var W=T.target,S=this.observedNavImpl.getCache(),R=W.getClosest(".predicate"),V=this.getIdFromDOMId(R.id),Q=V.split("/").pop(),U=false,X=[];U=W.hasClassName("bar")?"bar":(W.hasClassName("pie")?"pie":U);U=!U&&W.hasClassName("fonticon-palette")?"colorize":U;U=(!U&&(W.hasClassName("fonticon-th-tag")||W.hasClassName("fonticon-list")))?"tag":U;U=(!U&&W.hasClassName("fonticon-text"))?"input":U;switch(U){case"bar":if(S.getViewMode(Q)==="graphBar"){S.setViewMode(Q,"tag")}else{S.setViewMode(Q,"graphBar")}break;case"pie":if(S.getViewMode(Q)==="graphPie"){S.setViewMode(Q,"tag")}else{S.setViewMode(Q,"graphPie")}break;case"input":if(S.getViewMode(Q)==="freeInput"){S.setViewMode(Q,"tag")}else{S.setViewMode(Q,"freeInput")}break;case"tag":if(S.getViewMode(Q)!=="tag"){S.setViewMode(Q,"tag")}else{if(T.target.hasClassName("fonticon-th-tag")){S.removeCloud(R.id)}else{if(T.target.hasClassName("fonticon-list")){S.addCloud(R.id)}}}break;case"colorize":if(this.taggerUWAElement.getElement(".predicate.colorize")){X.push(this.taggerUWAElement.getElement(".predicate.colorize"))}S.colorManager.toggleColorize(V);this.taggerUWAElement.getElements(".graph").forEach(function(Y){X.push(Y.getClosest(".predicate"))}.bind(this));X.forEach(function(Y){if(Y!==R){this.redrawPredicate(Y.id)}}.bind(this));if(!S.colorManager.isColorized(V)){this.observedNavImpl.unColorize()}break}if(R){this.redrawPredicate(R.id);if(U==="input"&&S.getViewMode(Q)==="freeInput"){this.container.getElement("#"+R.id+" input").focus()}}return false},clickedPredicateEvent:function(R){var S,Q=R.target.getClosest(".predicate-header");if(Q.getClosest(".active-predicate-list")){return false}S=Q.getParent().id;this.togglePredicateExpand(S,Q)},togglePredicateExpand:function(S,X){var Z=this;var U,T,Y,aa,W,ac,Q=this.observedNavImpl.getCache(),R=B.getPredicate(this.getIdFromDOMId(S).split("/").pop()),ab=h.getPredicateView(R),V=(X.getParent().hasClassName("expanded"))?false:true;if(V){Q.expandPredicate(S)}else{Q.collapsePredicate(S)}if(X){X.getParent().toggleClassName("expanded",V);U=X.getParent().getChildren();for(Y=0,aa=U.length;Y<aa;++Y){T=l.extendElement(U[Y]);if(T.match(".predicate-content")){ac=l.extendElement(T.getChildren()[0]);new l.Fx(T,{duration:300,transition:"quadInOut",events:{onComplete:function(){if(V){T.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto"})}else{T.setStyles({position:"absolute",opacity:0,height:"auto"})}Z.updateScroller()},onStart:function(){T.setStyle("position","relative");T.setStyle("overflow","hidden")}}}).start({height:V?[0,ac.getSize().height]:[ac.getSize().height,0]})}}if(V&&Q.getViewMode(R.id()).indexOf("graph")!==-1){ab.redrawUiElement()}}},toggleSearchInput:function(T,Z,W){var ac,Y,V,ab,ae,af,X,ad,S=34,R,aa,U,Q=this.observedNavImpl?this.observedNavImpl.getCache():null;if(!Q){return false}ae=function(ag){var ah=ag.getElement("#taginput");if(ah!==null){ah.value=Q.getSearchValue();this.addOrRemoveClear(ah,false)}this.fx(ag,true).start({height:[0,S]});if(Z||T){ah.focus()}}.bind(this);af=function(ag){var ah=ag.getElement("#taginput");if(ah){this.fx(ag,false).start({height:[ag.getSize().height,0]});ah.blur();if(Q.getSearchValue()&&!W){this.resetSearch(ah,ag.id!=="filter-all")}}}.bind(this);aa=Q.getSearchId();if(T&&T.target.getClosest(".section")){ac=T.target.getClosest(".section").getElement(".add-tag-cont")}else{if(T&&T.target.getClosest("#header-container")){ac=this.globalSearchInput}else{ac=this.taggerUWAElement.getElement("#"+aa)}}R=ac.id;if(W){if(Q.isSearchVisible()&&ac){ae(ac);if(ac.id!=="filter-all"){af(this.globalSearchInput)}}else{af(ac)}}else{if(((R!==aa)&&Q.isSearchVisible())||!Q.isSearchVisible()){X=this.taggerUWAElement.getElement("#"+aa);af(X);Q.setSearchVisibility(true)}else{Q.setSearchVisibility(false)}Q.setSearchId(R);if(Q.isSearchVisible()){ae(this.taggerUWAElement.getElement("#"+R))}else{af(this.taggerUWAElement.getElement("#"+R))}}this.taggerRoot.getElement(".tagger-filter").toggleClassName("selected",R==="filter-all"&&Q.isSearchVisible());return(Q.isSearchVisible()&&Q.isSectionCollapsed(R.replace("filter-","")))||false},clearInput:function(V){var R=V.target.getParent(".add-tag-cont").getElement("input");R.getClosest(".addClear").removeClassName("addClear");if(R){if(R.hasClassName("searchbox")){this.resetSearch(R,V.target.getParent(".add-tag-cont").id!=="filter-all")}else{var S=this.getIdFromDOMId(V.target.getClosest(".predicate").id);var Q=B.getPredicate(S.split("/").pop());if(Q){var W=R.hasClassName("from")?"from":"to";var U=h.getPredicateView(Q,this);var T=Q.getType();switch(T){case"integer":case"float":case"double":V.target.value="";U.criterion[T][W].elements.input.value="";U.criterion[T][W].elements.input.triggerEvent("keyup",V);break;case"date":V.target.value="";U.criterion[T][W].elements.input.value="";U.criterion[T][W].events.input.change(V);break}}}R.value="";R.focus()}},resetSearch:function(U,R){var Y=(document.activeElement&&document.activeElement.id==="taginput"),T,S,X,Q=this.observedNavImpl.getCache();U.value="";Q.setSearchValue("");Q.setViewModeForSearch();if(R){X=this.taggerUWAElement.getElement(".ds6w-root-predicate."+U.getParent().id.replace("filter-","ds6w_"))||undefined;this.redrawPredicateForSearch(X)}else{T=this.tagsContainer.getElements(".predicate");this.tagsContainer.getElement("#tags-var-height").innerHTML=this.availableTagsToHtml()}var W=this.observedNavImpl.getFocusedProxy();if(W){var V=UWA.is(W.relevantPredicates,"array")&&W.relevantPredicates.length>0;if(V){if(W.showAllBool===false||W.showAllBool===undefined){if(!this.isW){this.tagsContainer.getElement(".predicates").toggleClassName("relevant-only",true)}else{this.tagsContainer.getElement("#all-tags").toggleClassName("relevant-only",true)}}}}h.redrawUiElements();this.updateScroller()},onSearchInput:function(R){var Y,T,S,Z,U,X,W=l.Event.getElement(R),Q=this.observedNavImpl.getCache(),V=this;if(this.timerOnSearch){clearTimeout(this.timerOnSearch)}this.timerOnSearch=setTimeout(function(){if(W===undefined){W=R}if(!W){return false}Q.setSearchValue(W.value);X=l.Event.getElement(R);Q.setViewModeForSearch();if(X.getParent().id==="filter-all"){["who","when","what","where","why","how"].forEach(function(aa){Q.toggleSection(aa,false)});this.tagsContainer.getElement("#tags-var-height").innerHTML=this.availableTagsToHtml();h.redrawUiElements();this.redrawShowAll();if(!this.isW){this.displayNoTags(true)}}else{Y=this.taggerUWAElement.getElement(".ds6w-root-predicate."+R.target.getParent().id.replace("filter-","ds6w_"))||undefined;this.redrawPredicateForSearch(Y)}this.updateScroller()}.bind(V),200);return false},addOrRemoveClear:function(R,Q){if(R.target){R=R.target}if(R.value===""){R.getClosest(".add-tag-cont").removeClassName("addClear")}else{R.getClosest(".add-tag-cont").addClassName("addClear")}if(!UWA.is(Q)||true===Q){u.checkActiveSearch(this)}},toggleActiveW:function(S){var U,R,T=S.target.getClosest(".item").getElement(".toggle-root"),Q=this.observedNavImpl?this.observedNavImpl.getCache():null;if(!Q){return false}U=T?T.className.split(" ")[1]:S.target.getParent().className.split(" ")[1];if(U==="allw"){["who","what","where","when","how","why"].forEach(function(V){Q.removeActiveW(V)});Q.addActiveW(U)}else{Q.toggleActiveW(U);Q.removeActiveW("allw");R=Q.getActiveW();if(Object.keys(R).length===0){Q.addActiveW("allw")}}this.updateHeaderForActiveW();this.displayNoTags();return false},displayNoTags:function(S,R){var Q=this.tagsContainer.getElement("#all-tags ul");if(this.tagsContainer.getElement(".no-tags")){this.taggerUWAElement.getElement(".no-tags").destroy()}if(this.visibility&&Q&&Q.getSize().height===0){l.createElement("div",{html:{text:S?i.getText("noRslt"):(R?i.getText("noRelevantTags"):i.getText("noTags")),"class":"no-tags"}}).inject(Q,"after")}},toggleIsW:function(R){if(R.ctrlKey&&R.altKey&&R.keyCode==="D".charCodeAt(0)){window.proxyLogs=true}if(R.ctrlKey&&R.keyCode==="Q".charCodeAt(0)){var Q=this.observedNavImpl?this.observedNavImpl.getCache():null;this.isW=!this.isW;R.preventDefault();if(this.taggerUWAElement){if(this.isW){this.taggerUWAElement.getElement("#tagnavigator").addClassName("isw",this.isW);this.taggerUWAElement.getElement("#tagnavigator").removeClassName("no-w",this.isW);this.taggerRoot.getElement("#header-container").className="allw"}else{this.taggerUWAElement.getElement("#tagnavigator").addClassName("no-w",!this.isW);this.taggerUWAElement.getElement("#tagnavigator").removeClassName("isw",!this.isW);if(Q){Q.setSearchId("filter-all")}this.updateHeaderForActiveW()}if(this.storage){this.storage.set("isW",this.isW===true?"true":"false")}this.redraw()}}},createHeaderElemNoW:function(){var U=0,Q,T,V="";var W=this;var S;var R=this.observedNavImpl.getCache();this.menu6wIcon=l.createElement("span",{"class":"fonticon fonticon-down-open"});this.menu6w=new k({className:"menu-6w",items:[{name:"allw"},{className:"divider"},{name:"who"},{name:"when"},{name:"what"},{name:"where"},{name:"why"},{name:"how"}],position:"bottom right",closeOnClick:false,target:this.menu6wIcon,renderTo:this.taggerRoot,events:{onClick:function(Y,X){W[X.name].dispatchEvent("onChange",Y)},onShow:function(){W.menu6wIcon.addClassName("active")},onHide:function(){W.menu6wIcon.removeClassName("active")}}});for(U=0,Q=this.menu6w.items.length;U<Q;++U){if(U===1){continue}T=this.menu6w.items[U].name;V=i.getText(T)!==T?i.getText(T):T.replace(/^\w/,function(X){return X.toUpperCase()});S={type:"checkbox",events:{onChange:this.toggleActiveW.bind(this)},className:"primary "+T,value:(T==="allw")?i.getText("allw"):V,checked:U===0,label:""};this[T]=new a(S);this[T].inject(this.menu6w.items[U].elements.container);this.menu6w.items[U].elements.container.getElement("label").setContent("<span class='fonticon fonticon-"+(T==="allw"?"tag":"3ds-"+T)+"'></span>"+(T==="allw"?i.getText("allw"):V))}this.menuSort6WIcon=l.createElement("span",{"class":"fonticon fonticon-sort-tag selected",id:"sort-6w-menu"});this.menuSort6W=new M({title:i.getText("changePredicateSort"),className:"sort-6w-menu",items:[{fonticon:"sorting",name:"sort-weight",description:i.getText("sort_by_weight")},{fonticon:"sort-tag",name:"sort-tag",description:i.getText("sortbyw"),selected:true},{fonticon:"sort-alpha-asc",name:"sort-alpha-asc",description:i.getText("alphabeticalOrder")},{fonticon:"sort-alpha-desc",name:"sort-alpha-desc",description:i.getText("reverseAlphabeticalOrder")},{fonticon:"sort-num-asc",name:"sort-num-asc",description:i.getText("occurenceOrder")},{fonticon:"sort-num-desc",name:"sort-num-desc",description:i.getText("reverseOccurenceOrder")}],position:"bottom right",target:this.menuSort6WIcon,renderTo:this.taggerRoot,events:{onClick:function(Y,X){var Z=W.observedNavImpl.getFocusedProxy();if(Z){Z.setSortOrder(X.name)}else{W.observedNavImpl.getCache().set6WSort(X.name)}W.updateSortPred(X.name);W.redraw()}}})},toggleMore:function(){this.toggleDisplayAll()},toggleDisplayAll:function(R){var S=this.observedNavImpl.getFocusedProxy();var Q;if(l.is(R)){if(this.isW){this.tagsContainer.getElement("#all-tags").toggleClassName("relevant-only",!R)}else{this.tagsContainer.getElement(".predicates").toggleClassName("relevant-only",!R)}S.showAllBool=R}else{Q=S&&S.relevantPredicates.length?S.showAllBool:false;if(this.isW){this.tagsContainer.getElement("#all-tags").toggleClassName("relevant-only",Q)}else{this.tagsContainer.getElement(".predicates").toggleClassName("relevant-only",Q)}S.showAllBool=!Q}this.tagsContainer.getElement(".show-all-toggle").innerHTML=i.getText(S.showAllBool?"showLess":"showAll");if(!this.isW){this.displayNoTags(false,true)}},toggleDisplayAllCriteria:function(Q){this.toggleCriteriaExpand(Q)},updateSortPred:function(Q){var R=Q||this.observedNavImpl.getCache().get6WSort();this.menuSort6WIcon.className="fonticon selected fonticon-"+(R==="sort-weight"?"sorting":R);if(this.menuSort6W._activeItem.name!==R){this.menuSort6W.setActiveItem(R)}},manageSortByPreference:function(){var Q=this.observedNavImpl.hasFocusedProxyWithRelevantPredicate()?true:false;if(this.menuSort6W){var R=this.menuSort6W.getItem("sort-weight");if(R){if(Q){R.elements.container.removeClassName("hidden")}else{R.elements.container.addClassName("hidden")}}}},updateHeaderForActiveW:function(){var T,Q,S,U,R=this.observedNavImpl?this.observedNavImpl.getCache():null;if(!this.isW&&R){this.taggerHeader.className=Object.keys(R.getActiveW()).join(" ");for(T=0,Q=this.menu6w.items.length;T<Q;++T){if(T===1){continue}S=this.menu6w.items[T].name;U=S.slice(4,S.length);this[S].setCheck(R.isActiveW(S))}}this.updateScroller();return false},mainTaggerIconClicked:function(){var Q=this.getObservedNavigator();if(this.taggerIcon){if(this.visibility){if(this.tabView.selectedTab.getName()==="criteria"){this.displayTags();this.redrawTopBarTagIcon()}else{if(!Q.hasWidgetMaximized()&&Q.getFocusedProxy()!==null){this.closeTagger();this.redrawTopBarTagIcon()}else{this.closeTagger()}}}else{if(Q.getWidgetMaximized()!==null&&Q.getWidgetMaximized()!=="IsNotInWidget"){Q.updateFocusedProxy()}this.displayTags();this.openTagger()}}},closeTagger:function(){if(this.tagnavigator.hasEvent("onClose")){this.tagnavigator.dispatchEvent("onClose");this.toggleVisibility(false);if(this.observedNavImpl.getFocusedProxy()){this.observedNavImpl.getFocusedProxy().triggerCallbackOfEvent(11,null)}}},openTagger:function(){var Q=this.getObservedNavigator();if(this.tagnavigator.hasEvent("onOpen")){this.tagnavigator.dispatchEvent("onOpen");this.toggleVisibility(true);if(this.observedNavImpl.getFocusedProxy()){this.observedNavImpl.getFocusedProxy().triggerCallbackOfEvent(10,null)}}},setTaggerMode:function(R){var Q=this.getObservedNavigator();if(Q&&R){if(this.observedNavImpl.getFocusedProxy()&&R==="criteria"){this.tabView.selectTab("criteria-tab")}else{if(R==="tags"){this.tabView.selectTab("tags-tab")}else{N.info("cannot set mode = "+R)}}}},closeSection:function(S){var R,Q=false;this.setSpinner();if(this.observedNavImpl.getFocusedProxy()){R=this.observedNavImpl.getFocusedProxy().getFilters();if(R.allfilters&&R.allfilters["sixw:ds6w:where/ds6w:source/ds6w:dataSource"]){Q=R.allfilters["sixw:ds6w:where/ds6w:source/ds6w:dataSource"].length>0}else{if(R.localfilters&&R.localfilters["sixw:ds6w:where/ds6w:source/ds6w:dataSource"]){Q=R.localfilters["sixw:ds6w:where/ds6w:source/ds6w:dataSource"].length>0}}}this.observedNavImpl.clearFilters();if(this.observedNavImpl.isReadyForDisplay()){this.redraw()}if(Q){this.warnProxyOfCriteriaChange({sixw:"sixw:ds6w:where/ds6w:source/ds6w:dataSource",value:[]})}return false},getObservedNavigator:function(){return this.observedNavImpl},isColorizePossible:function(){return this.observedNavImpl.isColorizePossible()},warnForColorize:function(Q){this.observedNavImpl.colorize(Q)},toggleVisibility:function(Q){if(this.visibility===Q){return}this.visibility=(Q===undefined)?!this.visibility:Q;setTimeout(this.updateScroller.bind(this),500);this.redrawTopBarTagIcon();this.redraw();this.observedNavImpl.updateDisplayStatus(this.visibility)},isTagInEdition:function(Q){return this.observedNavImpl.isTagInEdition(Q)},setSpinner:function(){var Q;Q=this.taggerRoot;if(!Q){return}F.mask(this.taggerRoot)},redrawPredicate:function(S,T,U){var R,Y,W,V,X,Q=this.observedNavImpl.getCache();if(!S){return}R=B.getPredicate(this.getIdFromDOMId(S).split("/").pop());if(R.is6WRoot()){Y=c.getRootPredicateView(R,this)}else{Y=h.getPredicateView(R,this)}W=Y.toHtml(T,u.isInFavorites(Y.id()),S.indexOf("sug")!==-1);V=this.taggerUWAElement.getElement("#"+S);X=l.createElement("div").addContent(W).getElement("#"+S).inject(V,"before");V.destroy();if(Q.getViewMode(R.id())!=="tag"){Y.redrawUiElement(S.indexOf("sug")!==-1)}this.updateScroller()},redrawPredicateForSearch:function(W){var V,U,Q,S=this.observedNavImpl.getCache(),R=B.getPredicate(this.getIdFromDOMId(W.id).split("/").pop()),T=this.taggerUWAElement.getElement("#"+W.id).getElement(".predicate-content.expandable");if(!W||!W.parentElement){return}V=c.getRootPredicateView(R,this);U=V.toHtmlForSeach();T.getChildren().forEach(function(X){X.destroy()});l.createElement("div").addContent(U).getChildren().forEach(function(X){X.inject(T,"bottom")});T.getElements(".predicate").forEach(function(X){var Z=B.getPredicate(this.getIdFromDOMId(X.id).split("/").pop()),Y=h.getPredicateView(Z);if(S.getViewMode(Z.id()).contains("graph")&&!Y._hiddenPredicate){Y.redrawUiElement()}}.bind(this));if(T.getElements(".tag").length===0&&(T.getElements(".predicate").length===T.getElements(".predicate.searchexcluded").length)){l.createElement("div",{html:{text:i.getText("noRslt"),"class":"no-tags"}}).inject(T,"bottom")}this.updateScroller()},redrawTopBarTagIcon:function(){var U=this.getObservedNavigator(),T=U.hasWidgetMaximized(),S=this.observedNavImpl.getFilters(null,true).allfilters,R=U.getFocusedProxy()?U.getFocusedProxy().getFilters(true).localfilters:undefined,Q=0;Q+=Object.keys(S).reduce(function(W,V){return W+S[V].length},0);if(R){Q+=Object.keys(R).reduce(function(W,V){return W+R[V].length},0)}if(this.taggerIcon){this.taggerIcon.toggleClassName("tagger-filter",Q!==0);if(this.visibility&&this.tabView.selectedTab.getName()!=="criteria"){this.taggerIcon.toggleClassName("tagger-icon-active",true)}else{this.taggerIcon.toggleClassName("tagger-icon-active",false)}}else{if(window.richClient&&this.tagnavigator.hasEvent("changeTaggerIcon")){this.tagnavigator.dispatchEvent("changeTaggerIcon",[{"tagger-filter":Q!==0}])}}},setActiveCriteria:function(af,ae,T){var ac=T?T instanceof o:false;var S={},V={},U,ab,R,aa,ad,W,Y=0,Z=T||this.observedNavImpl.getFocusedProxy(),Q=T?(ac?T.getTaggerProxy()._navimpl:T._navimpl):this.observedNavImpl;ad={widgetId:T?T.widgetId():(Z?(Q.getWidgetMaximized()||Z):null),proxyId:Z?Z.id():undefined};if(!Q.activeCriteriaProxy||!Q.activeSearchProxy){Q.createActiveCriteria()}if(af){W={};U=Q.getFilters(null,true).allfilters;for(R in U){aa=B.getPredicate(R.split("/").pop());if(aa&&!W[R]){W[R]=aa.displayName()}U[R]=U[R].map(function(ag){Y++;this.getDOMId(JSON.stringify({predicate:R,object:ag.object,dispValue:ag.disptext,type:ag.type}));if(ag.disptext!==ag.object||ag.type!=="string"){return ag}var ah=s.getTagValue(R,null,ag.object,ag.type);ag.disptext=ah?ah.getDisplayValue():ag.disptext;return ag},this)}V.allfilters=U;if(Z){ab=Z.getFilters(true).localfilters;for(R in ab){aa=B.getPredicate(R.split("/").pop());if(aa&&!W[R]){W[R]=aa.displayName()}ab[R]=ab[R].map(function(ag){Y++;this.getDOMId(JSON.stringify({predicate:R,object:ag.object,dispValue:ag.disptext,type:ag.type}));if(ag.disptext!==ag.object||ag.type!=="string"){return ag}var ah=s.getTagValue(R,null,ag.object,ag.type);ag.disptext=ah?ah.getDisplayValue():ag.disptext;return ag},this)}V.localfilters=ab}ad.predicatesNLS=W;if(this.taggerIcon){this.taggerIcon.toggleClassName("tagger-filter",Y!==0)}else{if(window.richClient&&this.tagnavigator.hasEvent("changeTaggerIcon")){this.tagnavigator.dispatchEvent("changeTaggerIcon",[{"tagger-filter":Y!==0}])}}Q.activeCriteriaProxy.setActiveCriteria(V,ad)}if(ae&&!ac){var X=function(){ad.predicatesNLS={};if(Z){S.search=Z.getFilters(false).localfilters;if(Z.getParameters()){S.plmparam=Z.getParameters()._models}Object.keys(S.search).forEach(function(ah){var ag=ah.split("/").slice(-1)[0].replace("sixw:","");ad.predicatesNLS[ah]=B.getPredicate(ag).displayName()})}Q.activeSearchProxy.setActiveCriteria(S,ad)};C.all(B.getElementsNLS()).then(function(ag){X()})}},redrawActiveCriteria:function(V){var Q=0,T,S,U=this.observedNavImpl.getFocusedProxy(),R={widgetId:this.observedNavImpl.getWidgetMaximized(),proxyId:U?U._id:undefined};if(!this.observedNavImpl.activeCriteriaProxy||!this.observedNavImpl.activeSearchProxy){this.observedNavImpl.createActiveCriteria()}if(V){this.observedNavImpl.activeCriteriaProxy.redrawCriteria(R)}else{this.observedNavImpl.activeSearchProxy.redrawCriteria(R)}if(this.taggerIcon||(window.richClient&&this.tagnavigator.hasEvent("changeTaggerIcon"))){T=this.observedNavImpl.getFilters(null,true).allfilters;Q+=Object.keys(T).reduce(function(X,W){return X+T[W].length},0);if(U){S=U.getFilters(true).localfilters;Q+=Object.keys(S).reduce(function(X,W){return X+S[W].length},0)}if(this.taggerIcon){this.taggerIcon.toggleClassName("tagger-filter",Q!==0)}else{if(window.richClient&&this.tagnavigator.hasEvent("changeTaggerIcon")){this.tagnavigator.dispatchEvent("changeTaggerIcon",[{"tagger-filter":Q!==0}])}}}},redraw:function(){var Q=this.observedNavImpl.getCache();var R,T,S;if(this.visibility){var W,V,U,X,ab,Y=this;if(this.internalRedrawTimer){clearTimeout(this.internalRedrawTimer);this.internalRedrawTimer=null}if((Object.keys(B.getElementsToTranslate()).length!==0||Object.keys(B.getPendingPromisesForElementsToTranslate()).length!==0||Object.keys(s.getTvToTranslate()).length!==0||o.getSubjectsForExplicitTags().length!==0)&&this.callServerInProgress===false){W=B.getElementsNLS();V=s.getPredicateValue();U=o.getExplicitTags();this.callServerInProgress=true;C.all(W.concat(V).concat(U)).then(function(ac){o.clearProxiesTemp();Y.callServerInProgress=false;Y.redraw()})}c.clear();h.clear();for(S in E){R={sixw:[S],type:"string"};try{T=c.getRootPredicateView(new B(R),this)}catch(Z){K.push(new Notification("Fail to create a predicate with invalid arg. Id is :'"+R.sixw[0]+"'"));K.dispatch()}}this.selectedTags=[];if(Q&&Q.selectedTab==="criteria"){if(this.tabView.selectedTab.getName()!=="criteria"){this.displayCriteria()}this.internalRedrawTimer=setTimeout(this.redrawCriteria.bind(this),50)}else{if(this.tabView.selectedTab.getName()!=="tags"){this.displayTags()}this.internalRedrawTimer=setTimeout(this.redrawTags.bind(this),50)}}else{if(this.isColorizePossible()&&Q.colorManager.activePredicate){c.clear();h.clear();for(S in E){R={sixw:[S],type:"string"};try{T=c.getRootPredicateView(new B(R),this)}catch(Z){K.push(new Notification("Fail to create a predicate with invalid arg. Id is :'"+R.sixw[0]+"'"));K.dispatch()}}this.observedNavImpl.eachTagValue(function(ad,ac){return new e(ad,this,ac)}.bind(this));this.availableTagsToHtml();this.redrawActiveCriteria(true)}else{var aa=document.getElementById("data-filter-panel-ct");if(aa&&UWA.is(aa.isHidden,"function")&&false===aa.isHidden()){if(l.extendElement(document.body).getElements(".column.left.shown").length>0){console.warn("tagger is hidden but filters panel is visible, so forcing the active criteria redraw");this.redrawActiveCriteria(true,true)}}}}},redrawParameters:function(){var Y,W=this,R=this.observedNavImpl.getCache(),X=this.observedNavImpl.getFocusedProxy();if(X!==null&&X.isPLMParameterEnabled()){Y=X.getParameters();if(Y!==null){if(!Y.hasEvent("onAdd")){Y.addEvent("onAdd",function(aa){W.parameterView.render(aa)})}if(!Y.hasEvent("onRemove")){Y.addEvent("onRemove",function(aa){u.checkActiveSearch(W)})}}if(!this.paramWarning){this.paramWarning=l.createElement("div",{id:"paramWarning"})}if(!this.parametersText){this.parametersText=new n({id:"parameter-input-field",placeholder:i.getText("paramAutocomplete")})}}if(this.parametersText){this.parametersText.remove();var U,V;U=this.criteriaContainer.getElement("#parameters-parent-container");V=this.criteriaContainer.getElement("#parameters-input-container");if(l.is(U)&&l.is(V)){this.parametersText.inject(V);var T=l.createElement("span",{"class":"add-tag-magnifier-param fonticon fonticon-search"}).inject(V);this.parameterView=new H({model:b,container:U,taggerView:W});if(X!==null){Y=X.getParameters();if(Y!==null){var Z=this.criteriaContainer.getElement("#parameter-list");if(Z&&R.getCriteriaToResetBeforeFilterChange(X.id())){var S=false,Q=R.getCriteriaToResetBeforeFilterChange(X.id())["ds6w:dataSource"];if(Q&&Q.value&&Q.value.length>0){S=Q&&Q.value&&Q.value.some(function(aa){return aa.value==="3dspace"})}if(S){W.parametersText.enable();W.parameterView.disabled=false}else{W.parametersText.disable();W.parameterView.disabled=true}}Y.forEach(function(aa){W.parameterView.render(aa)})}}}}},redrawCriteria:function(){if(this.visibility&&this.tabView.selectedTab.getName()==="criteria"){var R=this;var S=function(){F.unmask(this.taggerRoot);this.redrawActiveCriteria(false);this.taggerRoot.toggleClassName("edition_mode",false);this.searchButton.remove();this.criteriaContainer.getElement("#all-criteria").innerHTML=this.getCriteriaToHtml();this.criteriaContainer.getElement("#criteria-footer").setStyle("width",this.criteriaContainer.getElement("#all-criteria").getDimensions().width);this.searchButton.inject(this.criteriaContainer.getElement("#search-button-container"));h.redrawUiElements(true);this.redrawParameters();setTimeout(this.updateScroller.bind(this,true),50)};if((Object.keys(B.getElementsToTranslate()).length!==0||Object.keys(B.getPendingPromisesForElementsToTranslate()).length!==0)){N.info("found some predicates to be translated, redraw adv criteria only after nls is retrieved");var Q=B.getElementsNLS();C.all(Q).then(function(T){N.info("redraw the Criteria as nls is now retrieved");S.call(R)})}else{S.call(this)}}},redrawTags:function(){var R=(document.activeElement&&document.activeElement.id==="taginput"),Q=this.observedNavImpl.getCache();if(this.visibility){F.unmask(this.taggerRoot);if(this.observedNavImpl===undefined){throw new Error("Unexpected rendering of TaggerView without an observed Tagger?!")}if(!this.observedNavImpl.isReadyForDisplay()){this.setSpinner(0);return this}this.observedNavImpl.eachTagValue(function(U,T){return new e(U,this,T)}.bind(this));this.redrawActiveCriteria(true);this.globalSearchInput.inject(this.tabView.elements.contentNode.getElement("#tags-tab"),"top");this.tagsContainer.getElement("#tags-var-height").innerHTML=this.availableTagsToHtml();if(!this.isW){this.displayNoTags()}this.taggerHeader.getElement(".tagger-filter").toggleClassName("selected",Q&&Q.isSearchVisible());this.taggerRoot.toggleClassName("edition_mode",this.observedNavImpl.hasProxiesInEdition());if(this.form){this.form.destroy();this.form=null}if(this.observedNavImpl.hasProxiesInEdition()){this.editionAreaToHtml()}this.redrawShowAll();this.manageSortByPreference();h.redrawUiElements();try{this.myNotificationControl.inject(this.taggerUWAElement.getElement(".tagnavheader"),"after")}catch(S){}try{K.dispatch(A)}catch(S){}this.toggleSearchInput(null,R,true);setTimeout(this.updateScroller.bind(this,true),50)}return this},redrawShowAll:function(){var S=this.observedNavImpl.getFocusedProxy();if(S&&S.relevantPredicates.length&&Object.keys(S._tagValuesMap).length){var Q=S&&S.relevantPredicates.length?S.showAllBool:false;var R='<hr/><div class="show-all-toggle">'+i.getText(Q?"showLess":"showAll")+"</div>";if(this.tagsContainer.getElement("#tagger-footer")){this.tagsContainer.getElement("#tagger-footer").setStyle("display","").innerHTML=R}if(this.isW){this.tagsContainer.getElement("#all-tags").toggleClassName("relevant-only",!S.showAllBool)}else{this.tagsContainer.getElement(".predicates").toggleClassName("relevant-only",!S.showAllBool)}this.tagsContainer.getElement("#tagger-footer").setStyle("width",this.tagsContainer.getElement("#all-tags").getDimensions().width);if(!this.isW&&!S.showAllBool){this.displayNoTags(false,true)}}else{if(this.tagsContainer.getElement("#tagger-footer")){this.tagsContainer.getElement("#tagger-footer").setStyle("display","none")}}},updateScroller:function(X){var T,Q,U,aa,R,Z=this.observedNavImpl.getFocusedProxy(),V=42,W,S;if(!X){X=false}if(!X&&!this.visibility){return}T=this.taggerRoot.getDimensions().innerHeight-V+(this.observedNavImpl.getCache()&&this.observedNavImpl.getCache().isSearchVisible()?0:30);T-=this.taggerUWAElement.getElement("#active-tags").getDimensions().outerHeight;T-=this.taggerHeader.getDimensions().outerHeight;S=Z&&Z.relevantPredicates.length&&Object.keys(Z._tagValuesMap).length;if(S){W=T-this.tagsContainer.getElement("#tagger-footer").getDimensions().outerHeight}else{W=Math.min(this.tagsContainer.getElement("#tags-var-height").getDimensions().height+5,T)}if(this.tabView.selectedTab.getName()==="criteria"&&!this.observedNavImpl.hasProxiesInEdition()){Q=this.criteriaContainer;U=this.criteriaScroller;aa=r}else{Q=this.tagsContainer;U=this.taggerScroller;aa=q}if(U&&(T!==aa||X)){Q.setStyle("height",T);aa=T}if(this.tabView.selectedTab.getName()==="tags"){var Y=this.getObservedNavigator().modifiedPredicate;if(Y){U.scrollToElement("#"+this.getDOMId(Y.getFullPredicateID()));this.getObservedNavigator().modifiedPredicate=null}}else{if(Q.getElement(".no-native-scrollbars")){Q.getElement(".no-native-scrollbars").setStyle("height",aa-40)}else{if(Q.getElement(".native-scrollbars")){Q.getElement(".native-scrollbars").setStyle("height",aa-40)}}R=Math.max(aa-40,Q.getElement(".criteria-list")?Q.getElement(".criteria-list").getDimensions().height+20:0);this.container.getElement("#all-criteria").setStyle("height",R)}this.tagsContainer.getElement(".scroller-content").setStyle("height",S?W:"");this.tagsContainer.getElement("#all-tags").setStyle("height",W);return this},onSearchLaunch:function(){var Q={},S,R,T=this.observedNavImpl.getCriteriaIdsMap();for(R in T){S=R.split("/").pop();Q[S]=h.getPredicateView(B.getPredicate(S),this)}u.onSearchLaunch(this,Q);this.setActiveCriteria(false,true)},onFreeInputDeletion:function(Q){var U,X={},R,W,Y,T,V,aa,ab,S=Q.target.getClosest(".tag");if(S.id.indexOf("atv")!==-1){this.observedNavImpl.activeSearchProxy.clickCriteriaEvent(Q);return false}if(Q.target.getClosest(".freeinput-predicate-list")){W=Q.target.getClosest(".freeinput-predicate-list").getElement(".predicate").id;R=this.getIdFromDOMId(W);aa=B.getPredicate(R.split("/").pop().replace("sixw:",""));T=this.getIdFromDOMId(Q.target.getParent().id)}else{return}U=aa.getType();if(U!=="string"&&U!=="boolean"){V=Q.target.hasClassName("from")===true?"from":"to";X[V]=T;T=X}var Z=this.observedNavImpl.getFocusedProxy();if(!Z){throw new Error("ERROR : TaggerView.onFreeInputDeletion is called when there is no focused proxy !!!")}ab=this.observedNavImpl.getCache().getCriteriaToResetBeforeFilterChange(Z?Z.id():undefined);if(l.is(V)){Y=ab[aa.id()][V].value}else{if(U==="boolean"){Y=ab[aa.id()].value}else{Y=ab[aa.id()].value.filter(function(ac){return ac.value!==T}).map(function(ac){return ac.value})}}this.warnProxyOfCriteriaChange({sixw:aa.getFullPredicateID(),value:Y});this.observedNavImpl.removeFreeInputs([{predicate:aa,type:U,value:T}]);u.redrawUiElements(true);return false},deleteFreeInput:function(U){var R={},V,Q,S=U.predicate,T=U.type;Q=B.getPredicate(S.split("/").pop().replace("sixw:",""));if(T!=="string"&&T!=="boolean"){U.dispValue=U.object}this.observedNavImpl.removeFreeInputs([{predicate:Q,type:T,value:U.object}]);u.checkActiveSearch(this);this.onSearchLaunch();return false},warnProxyOfCriteriaChange:function(Q){if(this.observedNavImpl.getFocusedProxy()){this.observedNavImpl.getFocusedProxy().warnForCriteriaChange(Q)}},onTagDeletion:function(T){var U,S,R,Q,Q=JSON.parse(this.getIdFromDOMId(T.target.getClosest(".tag").id));U=Q.predicate;S=Q.object;R=B.getPredicate(U.split("/").pop());if(!(S.length&&S.length>0)){return false}this.observedNavImpl.deleteTagValue(S,R);return false},onTagCreation:function(S,Q,U){var R={sixw:[Q],type:"string"};try{this.observedNavImpl.createTagValue(S,new B(R),U)}catch(T){K.push(new Notification("Fail to create a predicate with invalid arg. Id is :'"+R.sixw[0]+"'"));K.dispatch()}},isSelected:function(Q){return this.observedNavImpl.isSelected(Q)},getListOfSelectedTagValues:function(Q){return this.observedNavImpl.getListOfSelectedTagValues(Q)},getMoreLimitForPredicate:function(Q){return this.observedNavImpl.getMoreLimitForPredicate(Q)},getDOMId:function(U){var S,R,Q,T=0;for(R=0,Q=U.length;R<Q;R++){S=U[R];T=((T<<5)-T)+S.charCodeAt(0);T=T&T}T="id_"+T;this.DOMIdToId[T]=U;return T},getIdFromDOMId:function(Q){return this.DOMIdToId[Q.replace("sug","")]},isProxyWithFilteringOnServer:function(){return(this.observedNavImpl&&this.observedNavImpl.getFocusedProxy()!==null)?this.observedNavImpl.getFocusedProxy().isFilteringOnServer():false},hasFreeInputSupport:function(Q){return(this.observedNavImpl&&this.observedNavImpl.getFocusedProxy()!==null)?this.observedNavImpl.hasFreeInputSupport(Q):false},isDatePickerDefault:function(){return(this.observedNavImpl&&this.observedNavImpl.getFocusedProxy()!==null)?this.observedNavImpl.getFocusedProxy().isDatePickerDefault():false},isForbiddenFreeDates:function(){return(this.observedNavImpl&&this.observedNavImpl.getFocusedProxy()!==null)?this.observedNavImpl.isForbiddenFreeDates():false},toggleParametersExpand:function(){var Q=this.observedNavImpl.getCache();Q.setParameterClicked(!Q.getParameterClicked());var R=this.criteriaContainer.getElement("#parameters-parent-container");if(Q.getParameterClicked()){R.setStyle("visibility","inherit");R.setStyle("height","auto")}else{R.setStyle("visibility","hidden");R.setStyle("height","0px")}},clickParameterMagnifier:function(Q){if(this.parametersText&&this.parametersText.isDisabled()){return}if(Q.type==="keydown"&&Q.keyCode!==13){return}this.validateParameterTitle()},validateParameterTitle:function(R){var Q=this.parametersText.getValue(),S=this.criteriaContainer.getElement("#parameters-input-container"),U=this.observedNavImpl.getFocusedProxy();var T=function(V){var W=/[A-Za-z0-9]{2,}/;return W.test(V)};if(S&&U){this.paramWarning.remove();if(Q.length<2){this.paramWarning.innerHTML=i.getText("paramWarning1");this.paramWarning.inject(S,"before");if(this.parametersAutocomplete){this.parametersAutocomplete.remove()}}else{if(!Q.split(" ").every(T)){this.paramWarning.innerHTML=i.getText("wildcardWarning");this.paramWarning.inject(S,"before");if(this.parametersAutocomplete){this.parametersAutocomplete.remove()}}else{F.mask(S);U.sendStringTypedForPLM(Q)}}}},editionAreaToHtml:function(){var ac,R,U,S=[],ab=[],aa,Y=[],X=this.observedNavImpl.getProxiesInEdition(),V=[],Z=this.taggerUWAElement.getElement(".edit-section"),T,Q,W=this;if(X.length){ac=X[0].getCStorages();R=X[0].getTagsServers();U={};if(R){for(T in R){Q=R[T];U[Q.getTenantDisplayName()]=T}}else{for(T in ac){Q=ac[T];U[Q.getTenantDisplayName()]=T}}for(aa in E){Y.push(new J({value:E[aa],icon:"3ds-"+aa.replace("ds6w:",""),className:"predicate-button",name:aa,active:W.selectedPredicate===aa}))}ab=new I({type:"radio",buttons:Y,events:{onClick:function(ae,ad){W.selectedPredicate=ad.options.name;t.getSuggestionsFromServers({tagsServers:R,tenants:W.selectedTenant,pred:W.selectedPredicate,autocomplete:W.form?W.form.getAutocompleteInput("autocomplete"):null})}}});if(!X[0].hasPlatformData()&&R&&Object.keys(U).length>1){S=[{id:"tenant-list",type:"select",name:"platform",label:i.getText("platformName"),value:this.selectedTenantName||null,placeholder:i.getText("enterPlatformName"),options:Object.keys(U),required:true,events:{onChange:function(){W.selectedTenantName=this.getValue();W.selectedTenant=[U[this.getValue()[0]]];t.getSuggestionsFromServers({tagsServers:R,tenants:W.selectedTenant,pred:W.selectedPredicate,autocomplete:W.form?W.form.getAutocompleteInput("autocomplete"):null})}}}]}else{if(Object.keys(U).length===1){this.selectedTenant=[U[Object.keys(U)[0]]]}}}V=[{type:"text",className:"predicate-buttons"},{type:"autocomplete",name:"autocomplete",allowFreeInput:true,showSuggestsOnFocus:true,label:i.getText("tagName"),placeholder:i.getText("enterTagName"),noResultsMessage:false,typeDelayBeforeSearch:300,className:"tagger-autocomplete nv-autocomplete",required:true}];if(S.length){V=S.concat(V)}this.form=new v({className:"edit-tags-form expandable",fields:V,buttons:[{type:"submit",className:"create-tag-button primary",value:i.getText("createTag")}],events:{onSubmit:function(){var ad=W.form.getAutocompleteInput("autocomplete").getSelection().value||W.form.getAutocompleteInput("autocomplete").getSelection();if(ad){if(ad!==l.String.unescapeHTML(ad)){ad=l.String.unescapeHTML(ad);K.push(new Notification("For security reasons, your tag has been changed to "+ad,{className:"warning"}));K.dispatch()}W.onTagCreation(ad,W.selectedPredicate,W.selectedTenant)}},onReset:function(){}}});this.form.inject(Z);this.form.elements.container[S.length?1:0].getParent().setContent(ab);if(this.selectedPredicate&&this.selectedTenant){t.getSuggestionsFromServers({tagsServers:R,tenants:this.selectedTenant,pred:this.selectedPredicate,autocomplete:this.form?this.form.getAutocompleteInput("autocomplete"):null})}},tnHeaderToHtml:function(){var Q;Q="<div id='edit-tags' data-rec-id='edit-tags'>";Q+="<div class='edit-section'>";Q+=this.sectionHeaderToHtml("createTag");Q+="</div></div>";Q+="<div class='tagnavheader'>";Q+="<div class='tn-header-title'>6WTags</span></div>";Q+="<div class='search-header-title'>"+i.getText("suggestedTags")+"</span></div>";Q+="<div class='show-all'></div>";Q+="<div class='ds6w-button sort-6w'></div>";Q+="<div class='ds6w-button tagger-filter'><span class='fonticon fonticon-search'></span></div>";Q+="</div>";return Q},availableTagsToHtml:function(){var S="",V="",Q=this.observedNavImpl.getCache();if(this.isW){S+=c.getRoots().map(function(W){return W.toHtml()}).join("")}else{var U=this.observedNavImpl.getProxyPreferredSortOrder();var R=Q.get6WSort();var T=U?U:R;if(T==="sort-tag"){V+=c.getRoots().map(function(W){return W.toHtml(undefined,undefined,undefined,undefined,T)}).join("")}else{V+=h.getPredicates(T).map(function(W){return W.toHtml(null,null,null,Q.getSearchValue,T)}).join("")}S+="<ul class='predicates allw'>";S+=V||("<div class='no-tags'>"+i.getText("noTags")+"</div>");S+="</ul>";this.updateSortPred(T)}return S},sectionHeaderToHtml:function(S,Q){var R="";S=S||"";R+="<div class='section-header'>";R+="<div class='header-title' id='"+S+"'>";R+=(S==="createTag")?"":"<div class='arrow'><span class='fonticon fonticon-down-dir'></span><span class='fonticon fonticon-right-dir'></span></div>";R+=(Q&&Q.isw)?"<span class='fonticon fonticon-3ds-"+S+"'></span>":"";R+=((Q&&Q.isw)?S.replace(/^\w/,function(T){return T.toUpperCase()}):(i.getText(S)))+"</div>";if(Q&&Q.isw&&(Q.count>=0)){R+="<span class='tagger-filter fonticon fonticon-search section-header-left'></span>";R+="<span class='root-count section-header-left'>"+Q.count+"</span>"}R+="</div>";if(Q&&Q.isw){R+="<div id='filter-"+S+"' class='add-tag-cont' style='overflow: hidden; height: 0px;'>";R+="<span class='add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span><input id='taginput' class='tagger-input searchbox' title='";R+=(i.getText("searchTag"))+"' placeholder='"+(i.getText("searchTag"))+"'/>";R+="</div>"}return R},getActiveParametersToHtml:function(){var Q="",R=this.observedNavImpl.getFocusedProxy().getParameters();if(R){R.forEach(function(X){var T=function(aa){var ab="<ul class='freeinput-predicate-list'>";ab+="<li class='predicate expanded selected  ds6w_'>";ab+="<div class='predicate-header'>";ab+="<div class='predicate-label'>"+aa+"</div>";ab+="</div>";return ab};var W=function(ab,ad,ac){var aa="";if(ab==="string"||ab==="boolean"){aa+="<li class='parameter selected tag' title='"+ac+"'>";aa+="<div class='parameter tag-label' id='"+ad+"'>"+ac+"</div>";aa+="</li>"}else{ac.forEach(function(ai){var af=ai.fromVal,ah=ai.toVal;if(af!==null||ah!==null){var ae,ag,aj;ae=ai.rangeContainer&&ai.rangeContainer.hasChildNodes()?ai.rangeContainer.getElement(".form-control"):null;ag=ae?ae.value:"";aj=i.getText("paramIntType"+ag);aa+="<li class='param-range-label'>"+aj+"</li>";if(af!==null){aa+="<li class='parameter selected tag' title='"+af+"'>";aa+="<div class='tag-label from' id='"+ad+"' rangeval='"+ag+"' fromto='from'>"+(i.getText("from"))+":"+af+"</div>";aa+="</li>"}if(ah!==null){aa+="<li class='parameter selected tag' title='"+ah+"'>";aa+="<div class='tag-label to' id='"+ad+"' rangeval='"+ag+"' fromto='to'>"+(i.getText("to"))+":"+ah+"</div>";aa+="</li>"}}})}if(aa.length>0){aa+="</ul></li>"}return aa};var V=X.get("type");if(V==="string"){var S=X.get("stringVal");if(S.length>0){Q+=T(X.get("value"));Q+=W(V,X.cid,S)}}else{if(V==="boolean"){var Z=X.get("boolVal");if(Z.length>0&&Z[0]!==""){Z=Z[0]==="1"?i.getText("yes"):i.getText("no");Q+=T(X.get("value"));Q+=W(V,X.cid,Z)}}else{var U=X.get("intType");if(U!==null){var Y=W(V,X.cid,U);if(Y.length>0){Q+=T(X.get("value"));Q+=Y}}}}Q+="</ul></li>"})}return Q},onToggleParamTagSelection:function(S){var R=this,T=S.target.getAttribute("id");var Q=this.observedNavImpl.getFocusedProxy().getParameters();Q.forEach(function(X){if(T!==X.cid){return}var V=X.get("type");if(V==="string"){X.set({stringVal:""})}else{if(V==="boolean"){X.set({boolVal:[]})}else{var W=X.get("intType"),U=S.target.getAttribute("rangeval");W.forEach(function(Z){var Y=Z.rangeContainer&&Z.rangeContainer.hasChildNodes()?Z.rangeContainer.getElement(".form-control"):null;if(Y.value===U){if(S.target.getAttribute("fromto")==="from"){Z.fromVal=null}else{Z.toVal=null}}})}}R.observedNavImpl.getFocusedProxy().onRefine()});this.setActiveCriteria(false,true);return false},getCriteriaToHtml:function(){var X,S,U,Y,R,Z,Q=this.observedNavImpl.getCache(),T=this.observedNavImpl.getCriteriaIdsMap(),W="<ul class='criteria-list'>",V=this.observedNavImpl.getActiveAttributes(),aa=this.observedNavImpl.getFocusedProxy();if(Object.keys(T).length){for(X in T){R=B.getPredicate(X.split("/").pop());h.getPredicateView(R,this);W+=h.getPredicateView(R,this).toHtml(null,false,true)}if(Q.getMore()>0){this.criteriaContainer.getElement("#criteria-toggle-container").innerHTML="<div class='criteria-toggle' nb-more="+Q.getMore()+">"+(Q.isMoreClicked()?i.getText("lessCriteria"):i.getText("moreCriteria"))+" ["+Q.getMore()+"]</div>"}if(aa!==null&&aa.isPLMParameterEnabled()&&(Q.getMore()===0||Q.isMoreClicked())){Q.setParameterClicked(true);W+="<hr/> <li id='parameter-list'><div class='parameters-toggle'>"+i.getText("paramTitle")+"</div>";W+="<div id='parameters-parent-container' style='visibility:inherit; height:auto'>";W+="<div id='parameters-input-container' style='display:inline-block; width:100%; position:relative;'></div></div>"}}W+="</ul>";return W},displayCriteria:function(Q){if(this.observedNavImpl.getFocusedProxy()&&(this.tabView.selectedTab.getName()!=="criteria"&&this.tabView.selectedTab!=="criteria")){this.tabView.selectTab("criteria-tab");this.redrawTopBarTagIcon()}else{N.info("Cannot display adv search, the widget is not maximized")}if(!this.visibility&&Q!==false){this.openTagger()}},displayTags:function(Q){if(!this.visibility&&Q===false){return}if(this.tabView.selectedTab!=="tags"){this.tabView.selectTab("tags-tab");this.redrawTopBarTagIcon()}if(!this.visibility&&Q!==false){this.openTagger()}return},updatePLMSuggestions:function(S){var R=this,Q,T=this.criteriaContainer.getElement("#parameters-input-container"),V=this.observedNavImpl.getFocusedProxy();Q=V.getParameters();if(T&&this.paramWarning){if(this.parametersAutocomplete){this.parametersAutocomplete.destroy()}this.parametersAutocomplete=new L({showSuggestsOnFocus:true,events:{onSelect:function(W){if(W!==null&&W.selected&&R.paramWarning){this.reset();R.paramWarning.remove();if(Q.appendParameter(new b({value:W.title||W.value,"interface":W.subLabel,unit:W.unit,type:W.type,displayValue:W.value||W.title}))){this.dispatchEvent("onClickOutside")}else{var X=R.criteriaContainer.getElement("#parameters-input-container");if(X){R.paramWarning.innerHTML=i.getText("paramWarning3");R.paramWarning.inject(X,"before")}}}}}});this.paramWarning.remove();if(S.items.length<1){this.paramWarning.innerHTML=i.getText("paramWarning2")+" '"+S.name+"'";this.paramWarning.inject(T,"before")}else{this.parametersAutocomplete.inject(T);this.parametersAutocomplete.addDataset(S);this.parametersAutocomplete.showAll();var U=S.hasMore?i.getText("paramPlaceholder1"):S.items.length+" "+i.getText("paramPlaceholder2");this.parametersAutocomplete.options.placeholder=U;this.parametersAutocomplete.defaultOptions.placeholder=U;this.parametersAutocomplete.elements.input.placeholder=U;this.parametersAutocomplete.elements.input.setAttribute("placeholder",U)}F.unmask(T)}},updateSuggestions:function(S){var Q=l.is(S.suggestField,"string")?B.getPredicate(S.suggestField.split("/").pop()):null,R=Q?h.getPredicateView(Q,this):null;if(R){R.updateSuggestions(S.datasets)}}});return P});define("DS/TagNavigator/ParameterView",["UWA/Class/View","UWA/Core","DS/TagNavigator/Parameter","DS/TagNavigator/Parameters","DS/TagNavigator/TaggerView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/AbstractPredicateView","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button",],function(b,g,k,i,c,j,h,d,a,f){var e=b.extend({domEvents:{"click .add-tag-close-param":"clearInput"},setup:function(l){this.focusOn=true;this.taggerView=l.taggerView;this.disabled=true},clearInput:function(m){if(this.disabled){return}var l=m.target.getParent(".add-tag-cont").getElement("input");if(l){l.getClosest(".addClear").removeClassName("addClear");var n=l.getClosest(".form-control-root");if(n){n.value="";n.triggerEvent("keyup",m)}}},render:function(o){var q=this;var s=function(){q.taggerView.onSearchLaunch()};var z=function(I){var H=I.get("displayValue"),G=I.get("unit");if(G){H=H+" ("+G+")"}return g.createElement("div",{"class":"predicate-label",html:H})};var C=function(G,I){var H=g.createElement("span",{"class":I}).inject(G);H.setStyle("cursor","pointer");H.setStyle("vertical-align","top");H.setStyle("line-height","34px");H.setStyle("display","inline-block");if(I==="fonticon fonticon-fonticon fonticon-minus"){H.addClassName("param-remove-button")}return H};var B,A;var l,F=o,m=F.get("type");if(m==="string"){B=g.createElement("div",{id:"paramString-container"}).inject(this.container);z(F).inject(B);A=g.createElement("div",{id:"paramString-innerContainer"}).inject(B);l=new d({placeholder:j.getText("typestring"),className:"param-inline-container"}).inject(A);if(this.disabled){l.disable()}l.elements.input.addEvent("keyup",function(G){if(this.value.length&&(this.value.split("*").length-1===this.value.length)){G.target.addClassName("has-error")}else{G.target.removeClassName("has-error");F.set({stringVal:this.value})}h.checkActiveSearch(q.taggerView);if(G.keyCode===13){s()}});C(A,"fonticon fonticon-fonticon fonticon-minus").addEvent("click",function(G){if(q.disabled){return}B.remove();F.collection.remove(F)}).setAttributes({title:j.getText("paramRemove")});var y=F.get("stringVal");if(y!==""){l.elements.input.value=y;l.dispatchEvent("onKeyUp")}}else{if(m==="boolean"){B=g.createElement("div",{id:"paramBoolean-container"}).inject(this.container);z(F).inject(B);A=g.createElement("div",{id:"paramBoolean-innerContainer"}).inject(B);l=new a({placeholder:j.getText("selectValue"),className:"param-inline-container",options:[{value:"1",label:j.getText("yes")},{value:"2",label:j.getText("no")}],events:{onChange:function(G){F.set({boolVal:this.getValue()});h.checkActiveSearch(q.taggerView)}}}).inject(A);if(this.disabled){l.disable()}l.elements.input.addEvent("keyup",function(G){if(G.keyCode===13){s()}});C(A,"fonticon fonticon-fonticon fonticon-minus").addEvent("click",function(G){if(q.disabled){return}B.remove();F.collection.remove(F)}).setAttributes({title:j.getText("paramRemove")});var w=F.get("boolVal");if(w.length>0&&w[0]!==""){l.setValue(w);l.dispatchEvent("onChange")}}else{if(m==="integer"||m==="double"){var p=F.get("intType"),E=[];var v=function(){var G=[];p.forEach(function(H){if(H.rangeVal.length>0){G.push(H.rangeVal)}});return G};var r=function(){var G={};G.fromVal=null;G.toVal=null;G.rangeContainer=null;G.rangeVal="1";p.push(G);return G};var D=function(){p.forEach(function(M){var K=M.rangeContainer!==null&&M.rangeContainer.hasChildNodes()?M.rangeContainer.getChildren():null;var H=K?K[0]:null;if(H){H.remove();H.destroy()}var J=[],G=[];E.forEach(function(O){if(M.rangeVal!==O){G.push(O)}});var L;for(L=0;L<4;L++){var N,I;switch(L){case 0:N="1";I=j.getText("paramIntType1");break;case 1:N="2";I=j.getText("paramIntType2");break;case 2:N="3";I=j.getText("paramIntType3");break;case 3:N="4";I=j.getText("paramIntType4");break}if(G.indexOf(N)===-1){J.push({value:N,label:I});if(N===M.rangeVal){J[J.length-1].selected=true;J[J.length-1].disabled=true}}}var H=new a({placeholder:false,options:J,events:{onChange:function(O){M.rangeVal=O.target.value;E=v();D()}}}).inject(M.rangeContainer);if(q.disabled){H.disable()}})};var n=function(I,M,H){if(!M){z(F).inject(I)}var J=H?H:r();if(!J.rangeContainer){if(E.length>0){var O=0;for(O=0;O<4;O++){var T=O+1+"";if(E.indexOf(T)===-1){J.rangeVal=T;break}}}E=v()}var N=g.createElement("div",{"class":"paramInteger-innerContainer"}).inject(I);J.rangeContainer=g.createElement("div",{"class":"add-tag-cont fromtoSelect"}).inject(N);var R=function(X,Z,V){var W=X.target.value,Y=Z?parseInt(W,10):parseFloat(W);if(W.length&&(isNaN(Y))){X.target.addClassName("has-error")}else{if((V==="from"&&J.toVal!==null&&Y>J.toVal)||(V==="to"&&J.fromVal!==null&&J.fromVal>Y)){X.target.addClassName("has-error");return null}else{X.target.removeClassName("has-error")}}return isNaN(Y)?null:Y};var G=g.createElement("div",{"class":"add-tag-cont fromto from"}).inject(N);var L=new d({placeholder:j.getText("from")}).inject(G);var Q=g.createElement("span",{"class":"add-tag-close-param"}).inject(G);g.createElement("span",{"class":"fonticon fonticon-cancel-circled"}).inject(Q);if(q.disabled){L.disable()}var U=function(V){if(V.target){V=V.target}if(V.value===""){V.getClosest(".add-tag-cont").removeClassName("addClear")}else{V.getClosest(".add-tag-cont").addClassName("addClear")}h.checkActiveSearch(q.taggerView)};L.elements.input.addEvent("keyup",function(V){J.fromVal=R(V,m==="integer","from");U(V);if(V.keyCode===13){s()}});if(J.fromVal!==""){L.setValue(J.fromVal);U(L.elements.input)}var P=g.createElement("div",{"class":"add-tag-cont fromto to"}).inject(N);var K=new d({placeholder:j.getText("to")}).inject(P);if(q.disabled){K.disable()}var S=g.createElement("span",{"class":"add-tag-close-param"}).inject(P);g.createElement("span",{"class":"fonticon fonticon-cancel-circled"}).inject(S);K.elements.input.addEvent("keyup",function(V){J.toVal=R(V,m==="integer","to");U(V);if(V.keyCode===13){s()}});if(J.toVal!==""){K.setValue(J.toVal);U(K.elements.input)}C(N,"fonticon fonticon-fonticon fonticon-plus").addEvent("click",function(V){if(q.disabled){return}if(p.length<4){n(I,true).inject(I);D()}}).setAttributes({title:j.getText("paramAdd")});C(N,"fonticon fonticon-fonticon fonticon-minus").addEvent("click",function(W){if(q.disabled){return}if(p.length===1){I.remove()}else{N.remove()}var V=p.indexOf(J);if(V>-1){p.splice(V,1)}if(p.length<1){F.collection.remove(F)}E=v();D()}).setAttributes({title:j.getText("paramRemove")});return N};l=g.createElement("div",{id:"paramInteger-container"}).inject(this.container);var t,u=p.length;if(u>0){for(t=0;t<u;t++){n(l,t===0?false:true,p[t])}E=v()}else{n(l,false)}D()}}}if(l&&this.focusOn){if(m==="string"||m==="boolean"){l.focus()}else{var x=F.get("intType");if(x&&x.length>0&&x[0].rangeContainer){x[0].rangeContainer.focus()}}}return this}});return e});define("DS/TagNavigator/TagNavigator",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Utils/InterCom","DS/TagNavigator/TagNavigatorManager","DS/TagNavigator/TagNavigatorManagerImpl","DS/TagNavigator/TaggerView","DS/TagNavigator/Logger","DS/TagNavigator/TagsServer","DS/TagNavigator/TaggerNLS","DS/TagNavigator/UserSettings","DS/TagNavigator/TaggerSettings"],function(a,z,q,k,g,y,v,c,f,i,w,B){var s,b,e,n="com.ds.tagger6w",r=y.allProxiesMap,p={},h={},A=null,x=null,u=null,j="_default",d=false,t,l;s=z.extend(q,{init:function(){var I=this;I.view=null;var C={};var E=window.location.search.substring(1);if(E){var G=E.split("&");for(var D=0;D<G.length;D++){var H=G[D].split("=");if(H.length==1){C[H[0]]=true}else{if(H.length==2){if(H[0].length>0){C[H[0]]=H[1]}}}}B.urlSettings(C)}var F=B.getOption("preciseTagsCount");if(UWA.is(F,"boolean")){i.preciseCount_global=F}this.create6WTaggerView=function(J,N,L,K){a.log("inside TagNavigator::create6WTaggerView");var M;M=I.view===null;if(M){if(a.is(L,"object")){this.addEvents(L)}I.view=new v(new y(J!==null?J.id():false),N,I,b,x,u,K)}return M};this.addEvents=function(K){for(var J in K){I.addEvent(J,K[J])}};this.toggle6WTaggerViewVisibility=function(J){if(I.view){I.view.toggleVisibility(J)}};this.get6WTaggerViewVisibility=function(){return I.view&&I.view.visibility?I.view.tabView.selectedTab.getName():false};this.get6WTagger=function(L){var K;K=null;try{K=new g(new y(L,d,A))}catch(J){c.error(J.message)}return K};this.setDefault6WTagsServicesURL=function(K,J){c.log("depreacted: please use set6WTaggerOptions");if(!J){J={}}return this.set6WTaggerOptions({tagsServerUrl:K,tagsServerUrlParams:J})};this.set6WTaggerOptions=function(R){a.log("inside TagNavigator::set6WTaggerOptions");var L=0,K,M,O,Q,J,P,N;if(!a.is(R,"object")){throw new Error("Invalid Input arguments")}if(R.lang){i.setCurrentLanguage(R.lang.substr(0,2))}else{if(window.dsLang){i.setCurrentLanguage(window.dsLang.substr(0,2))}else{if((window.App?window.App.lang:null)!==null){i.setCurrentLanguage(window.App.lang.substr(0,2))}}}if(R.brand==="3DDashboard"){d=true}else{if(R.brand===undefined){window.richClient=true}}y._brand=R.brand;1;if(R.startupParams){K=R.startupParams;R.startupParams.cstorage=R.startupParams.cstorage.filter(function(S){return(S.url&&S.url!=="")});R.startupParams.tagger=R.startupParams.tagger.filter(function(S){return(S.url&&S.url!=="")});if(!d&&R.tenant){for(L=0;L<K.cstorage.length;L++){if(K.cstorage[L].id===R.tenant){Q=K.cstorage[L].url;P=K.cstorage[L].id;N=K.cstorage[L].displayName;M=new f(Q,P,N);h[P]=M;h[j]=M;break}}for(L=0;L<K.tagger.length;L++){if(K.tagger[L].id===R.tenant){J=K.tagger[L].url;P=K.tagger[L].id;N=K.tagger[L].displayName;O=new f(J,P,N);p[P]=O;p[j]=O;break}}}else{if(!d&&!R.tenant){throw new Error("Error: standalone env, a tenant should be given to the Tagnavigator")}else{for(L=0;L<K.cstorage.length;L++){Q=K.cstorage[L].url;P=K.cstorage[L].id;N=K.cstorage[L].displayName;M=new f(Q,P,N);h[P]=M}if(!K.tagger||K.tagger.length===0){K.tagger=K.cstorage}for(L=0;L<K.tagger.length;L++){J=K.tagger[L].url;P=K.tagger[L].id;N=K.tagger[L].displayName;O=new f(J,P,N);p[P]=O}if(R.myAppsBaseURL){b=w.init(R)}}}}else{if(R.cStorageService){P=R.tenant||null;M=new f(R.cStorageService,P);h[j]=M;if(P){h[P]=M}}else{if(R.tagsServicesURL||R.tagsServerUrl){J=R.tagsServicesURL||R.tagsServerUrl;P=R.tenant||(R.tagsServicesURLQueryParams?R.tagsServicesURLQueryParams.tenant:null)||(R.tagsServerUrlParams?R.tagsServerUrlParams.tenant:null);O=new f(J,P);h[j]=O;if(P){h[P]=O}}}}if(R&&R.getContextIdFromWidgetId&&typeof R.getContextIdFromWidgetId==="function"){A=R.getContextIdFromWidgetId}if(R&&R.displayFilteredState&&typeof R.displayFilteredState==="function"){x=R.displayFilteredState}if(R.taggerIconId){u=R.taggerIconId}}}});e=new s();a.log("TagNavigator - init of intercom server");t=new k.Server(n,{isPublic:false});function m(D){var C=D.origin.socket;return C}t.addListener("setTags",function(C,D){r[m(D)].setTags(C.tagsdata,C.summaryData)});t.addListener("setRelevantPredicates",function(C,D){r[m(D)].setRelevantPredicates(C.predicates);e.view.observedNavImpl.getCache().set6WSort("sort-weight")});t.addListener("addSubjects",function(C,D){r[m(D)].addSubjects(C.tagsdata)});t.addListener("setCriteria",function(C,D){r[m(D)].setCriteria(C.criteria)});t.addListener("updateCriteria",function(C,D){r[m(D)].updateCriteria(C.criteria)});t.addListener("removeCriteria",function(C,D){r[m(D)].removeCriteria(C.criteria)});t.addListener("setSubjectsTags",function(C,D){r[m(D)].setSubjectsTags(C)});t.addListener("addSubjectsTags",function(C,D){r[m(D)].addSubjectsTags(C)});t.addListener("die",function(D,E){var F=m(E),C=r[F];if(C){if(C.isAlive()){C.die()}}t.dispatchEvent("isDead",null,null,[F])});t.addListener("activate",function(C,D){r[m(D)].activate(C,D);e.view.setActiveCriteria(true,true)});t.addListener("deactivate",function(C,D){r[m(D)].deactivate(C,D);e.view.setActiveCriteria(true,true)});t.addListener("focusOnSubjects",function(C,D){r[m(D)].focusOnSubjects(C.subjectsURI,C.persistTags,C.dataSources)});t.addListener("unfocus",function(C,D){r[m(D)].unfocus()});t.addListener("unsetTags",function(C,D){r[m(D)].unsetTags()});t.addListener("toggleProxyFocus",function(C,D){r[m(D)].toggleProxyFocus(C.focusStatus)});t.addListener("clearLocalFilter",function(C,D){r[m(D)].clearLocalFilter(C?C.refine:false);e.view.setActiveCriteria(true,true,r[m(D)])});t.addListener("setLocalFilter",function(C,D){r[m(D)].setLocalFilter(C,function(){e.view.setActiveCriteria(true,true,r[m(D)])})});t.addListener("setColorMap",function(C,D){r[m(D)].setColorMap(C)});t.addListener("setPredicates",function(C,D){r[m(D)].setPredicates(C)});t.addListener("updateProxyOptions",function(C,F){var E=r[m(F)],D;if(E){for(D in C){switch(D){case"tenant":var G=C.tenant;E.updateTenantInfo({tenant:G,cStorage:h[G],tagsServer:p[G]});break}}}});t.addListener("toggleDisplayAll",function(C,D){e.view.toggleDisplayAll(C)});t.addListener("displayCriteria",function(C,D){if(C===false||(C&&C.param&&C.param.checkIsACriteria===false)){e.view.displayTags()}else{e.view.displayCriteria(C)}});t.addListener("toggleDisplayAllCriteria",function(C,D){e.view.toggleDisplayAllCriteria(C)});t.addListener("updatePLMSuggestions",function(C,D){e.view.updatePLMSuggestions(C)});t.addListener("updateSuggestions",function(C,D){e.view.updateSuggestions(C)});function o(C,D){var E={filters:r[C].getFilters(),forceFilterChangeEvent:D};E.lang=i.getLang();t.dispatchEvent("proxyIsReady",E,null,[C])}t.addListener("getProxy",function(G,H){var E,C,F,I,D;a.log("TagNavigator - received a getProxy event!");E=m(H);F=G.filteringMode;if(G.filteringMode==="FilteringOnServer"){G.getExplicitTagsByTagger=false}I=G.tenant||(G.tagsServerUrlParams?G.tagsServerUrlParams.tenant:null);if((!G.contextId)&&(typeof A==="function")){C=A(G.widgetId);if(!C){if(UWA.is(a.Widgets)&&UWA.is(a.Widgets.instances,"array")&&a.Widgets.instances.length>0){C=a.Widgets.instances.filter(function(J){return(a.is(J,"object")&&J.getView().type==="sidepanel")&&J.id===G.widgetId}).map(function(J){return J.context}).pop()}if(!C){throw new Error("The widget id is unknown by 3DDashboard.")}}}else{if(G.contextId&&(typeof G.contextId==="string")){C=G.contextId}else{throw new Error("The context identifier can not be defined.")}}G.tagsServers={};G.cStorages={};if(I&&(I==="onpremise")){I="OnPremise"}if(d){if(G.widgetId==="IsNotInWidget"){c.error("Error: please set a widgetId for the proxy")}if(I){if((!G.pod||(G.pod==="3DSpace"))&&h[I]){G.hasPlatformData=true;G.cStorages[I]=h[I];G.tagsServers[I]=p[I]||h[I]}else{if((!G.pod||(G.pod==="6WTags"))&&p[I]){G.hasPlatformData=false;G.cStorages[I]=h[I];G.tagsServers[I]=p[I]}else{throw new Error("The given tenant name is unknown by the TagNavigator.")}}}else{G.hasPlatformData=false;G.tagsServers=p;G.cStorages=h}}else{if(G.widgetId!=="IsNotInWidget"){G.widgetId="IsNotInWidget";c.error("Error Not in 3DD: the widgetId will be ignored, please do not set the widgetId parameter")}if(I){if((!G.pod||(G.pod==="3DSpace"))&&h[I]){G.hasPlatformData=true;G.cStorages[I]=h[I];G.tagsServers[I]=p[I]||h[I]}else{if((!G.pod||(G.pod==="6WTags"))&&p[I]){G.hasPlatformData=false;G.cStorages[I]=h[I];G.tagsServers[I]=p[I]}else{throw new Error("The given tenant name is unknown by the TagNavigator.")}}}else{if(h[j]){G.hasPlatformData=true;G.cStorages[j]=h[j]}}}D=e.get6WTagger(C).getProxy(G);if(F==="FilteringOnServer"){D.addFilterChangeListener.apply(D,[function(J){t.dispatchEvent("onFilterChange",J,null,[E])},this]);D.addCriteriaChangeListener.apply(D,[function(J){t.dispatchEvent("onCriteriaChange",J,null,[E])},this]);D.addPLMUpdateListener.apply(D,[function(J){t.dispatchEvent("plmUpdate",J,null,[E])},this]);D.addRequestSuggestionsListener.apply(D,[function(J){t.dispatchEvent("requestSuggestions",J,null,[E])},this]);D.addOpenTaggerListener.apply(D,[function(){t.dispatchEvent("onOpenTagger",null,null,[E])},this]);D.addCloseTaggerListener.apply(D,[function(){t.dispatchEvent("onCloseTagger",null,null,[E])},this]);D.addUpdateDisplayStatusListener.apply(D,[function(J){t.dispatchEvent("updateDisplayStatus",J,null,[E])},this]);D.triggerCallbackOfEvent(21,e.view.visibility)}else{if(F==="WithFilteringServices"){D.addFilterSubjectsListener.apply(D,[function(J){J=a.merge(J,D.getFilters());t.dispatchEvent("onFilterSubjectsChange",J,null,[E])},this])}}D.addTagCreationListener.apply(D,[function(J){t.dispatchEvent("addTagCreationListener",J,null,[E])},this]);D.addTagCreationListener.apply(D,[function(J){t.dispatchEvent("addTagCreationListener",J,null,[E])},this]);D.addTagDeletionListener.apply(D,[function(J){t.dispatchEvent("addTagDeletionListener",J,null,[E])},this]);D.addLocalFilterStatusListener.apply(D,[function(J){t.dispatchEvent("addLocalFilterStatusListener",J,null,[E])},this]);D.addUnfocusSubjectsListener.apply(D,[function(J){t.dispatchEvent("addUnfocusSubjectsListener",J,null,[E])},this]);D.addColorizeListener.apply(D,[function(J){t.dispatchEvent("colorize",J,null,[E])},this]);D.addUnColorizeListener.apply(D,[function(J){t.dispatchEvent("unColorize",J,null,[E])},this]);if(UWA.is(D.addSortChangeListener,"function")){D.addSortChangeListener.apply(D,[function(J){t.dispatchEvent("onSortChange",J,null,[E])},this])}if(window.richClient===true&&a.is(window.myTaggerWebinWin)){D.addInternalFilterChangeListener.apply(D,[function(J){t.dispatchEvent("_internalFilterChangeListener",J,null,[E])},this])}o(E,G.forceFilterChangeEvent===true)});return e});define("TagNavigator",["TagNavigator/TagNavigator"],function(a){return a});define("TagNavigator/TagNavigator",["DS/TagNavigator/TagNavigator"],function(a){return a});