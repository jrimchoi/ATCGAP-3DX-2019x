<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:widget="http://www.netvibes.com/ns/">
<head>
<!-- @fullReview  ZUR 14/10/11 2015x HL Param Widgetization-->
<!-- @quickReview ZUR 15/11/12 IR-409614-3DEXPERIENCER2016x/3DEXPERIENCER2017x-->
<title>Content Naming Rules</title>

<meta name="description" content="Identifications Handling widget" />
<meta name="author" content="ZUR" />
<meta name="apiVersion" content="1.3" />
<meta name="debugMode" content="false" />
<meta name="strictMode" content="false" />

<!-- UWA Environment -->
<script type="text/javascript" src="../AmdLoader/AmdLoader.js"></script>
<script type="text/javascript" src="../UIKIT/UIKIT.js"></script>
<script type="text/javascript" src="../PlatformAPI/PlatformAPI.js"></script>
<script type="text/javascript" src="../ParameterizationWidget/ParameterizationWidget.js"></script>
              
<link rel="stylesheet" type="text/css" href="../UIKIT/UIKIT.css" ></link>
<link rel="stylesheet" type="text/css" href="../ParameterizationWidget/ParameterizationWidget.css" ></link>

<widget:preferences>
</widget:preferences>

<!-- Application Styles -->
<style type="text/css">
</style>

	<script type="text/javascript">
	
  		require([
                 'UWA/Core',
            	 'UWA/Data',
            	 'UWA/Fx',
            	 'UWA/Controls/Input',
            	 'UWA/Controls/Accordion', 
            	 'UWA/Utils/InterCom',
            	 'DS/UIKIT/Core',
            	 'DS/UIKIT/Input/Text',
            	 'DS/UIKIT/Input/Select',
            	 'DS/UIKIT/Input/Button',
            	 'DS/UIKIT/Alert',
            	 'DS/UIKIT/Spinner',
            	 'DS/UIKIT/Popover',
            	 'DS/UIKIT/Scroller',
            	 'DS/UIKIT/Mask',
                 'DS/Param/CommonUtilities',
                 'DS/Param/UIUtilities',
            	 'DS/PlatformAPI/PlatformAPI',
            	 'i18n!DS/ParameterizationWidget/assets/nls/ParamWdgNLS'
            	  ],
            	 function (UWA, Data, Fx, Input, Accordion, 
            			   InterCom, Core, 
            			   Text, Select, Button, Alert, Spinner, Popover, Scroller, Mask,
            			   CommonUtilities, UIUtilities, PlatformAPI, ParamWdgNLS) 
			 	 {
					var namingElement		= CommonUtilities.paramStructBuilder("namingID,initialValue,defaultValue,currentValue");	
					var custoNamingElement  = CommonUtilities.paramStructBuilder("objTypeID,prefix,suffix,defprefix,defsuffix,appType,deploySts");
					var warningLabel		= CommonUtilities.paramStructBuilder("warnID","warnRaised");
	
					var affixContainer, separatorContainer; 	 	
		
					var custoNamingsArray 	= new Array(); 
					var warnArrays 			= new Array();
					var forbiddenNamings	= new Array();	
					
					warnArrays[0] = new warningLabel("sitenameinput",false);
					warnArrays[1] = new warningLabel("prefixInput",false);
					warnArrays[2] = new warningLabel("suffixInput",false);   
                    	
    				var domainName = "ObjectIdentification";    	     
    		   	
    				var timerconn, globalDiv, subDiv, controlDiv, deployAlert; //loadingSpinner, DeployLightBox, controlTable
    				var sepControler, wdgAccordion,
    					paramScroller = null,
    					firsttime = true;     	
    	
    				function UpdateCommonParamsOnServer(notify)
        			{           	
        				var url = paramWidget.env_url+"/resources/ParamWS/access/postparams?tenant="+paramWidget.tenantID;
                     	
 	     				var AffixValue = document.getElementById('sitenameinput').value;		
 	     				if (AffixValue=="")
 							AffixValue="TBD";	
 			
 						var separatorVal = document.getElementById('selectSeparator').options[document.getElementById('selectSeparator').options.selectedIndex].value;
 		  				var jsonArr = [];	
 		  				var ArgArr = [];          	               	   
           				
 		  				ArgArr.push({id:"AffixArg",value:AffixValue});          	   
           				ArgArr.push({id:"SeparatorArg",value:separatorVal});
           	   
           				var iParam = {
           			   		domain:domainName,        				
       				   		id:"IdentifierAffix",
      	   					argument : ArgArr
      	    			};
           	   
            			jsonArr.push(iParam);
  			  	
            			var datatoSend = {
	           	   			domain : domainName,
	           	   			parameter:jsonArr
            			};
 		  		                                         	
            			UWA.Data.request(url, {
	                		timeout: 100000,
	                		method: 'POST',             
	                		data: JSON.stringify(datatoSend),
	                		type: 'json',
	                		proxy: 'passport',                        
	                		headers: {
	                        		'Content-Type':'application/ds-json',
	                        		'Accept': 'application/ds-json'
	                		},
	             			onFailure : function (json) {
	               				console.log(json);               	
		              			if (notify)  
		              			{
		            	  			var failuremsg =  ParamWdgNLS.deployFailureMsg;// + ' - ' + new Date();
		            	  			deployAlert.add({ className: "error", message: failuremessage });  		
		              			} 	
		              			return "E_Error";               		 	
	             			},             
	             			onComplete: function(json){
	                 			console.log(json);
	                 			if (notify)
	             				{
	             					var successmsg = ParamWdgNLS.deploySuccessMsg;//  + ' - ' + new Date();
	             					deployAlert.add({ className: "success", message: successmsg });              	
	             				}        	
	               				return "S_OK";             	
	                 		}    
             			});        
         			}//of function UpdateCommonParamsOnServer   
          	         	              	
         			function ApplyNamingModificationsOnServer()
         			{            
        	 			Mask.mask(widget.body);//DeployLightBox.open();
   	  	 
         	 			var url = paramWidget.env_url+"/resources/ParamWS/access/postparams?tenant="+paramWidget.tenantID;
             			var jsonArr = [];
                               
             			for (var i=0; i<custoNamingsArray.length; i++)
    					{            	  
             	   			var ArgArr = [];             	               	   		
             	   			ArgArr.push({id:"PrefixArg",value:custoNamingsArray[i].prefix});             	   
             	   			ArgArr.push({id:"SuffixArg",value:custoNamingsArray[i].suffix});
             	   
             	   			var iParam = {
             			   		domain:domainName,        				
         				   		id:custoNamingsArray[i].objTypeID,
        	   				   	argument : ArgArr
        	   				};            	   
             	   			jsonArr.push(iParam);
    			 		}             	   
             	
              			var datatoSend = {
             	   			domain : domainName,
             	   			parameter:jsonArr
              			};
                                         	
              			UWA.Data.request(url, {
              				timeout: 100000,
              				method: 'POST',             
              				data: JSON.stringify(datatoSend),
              				type: 'json',
              				proxy: 'passport',                      
              				headers: {
                      			'Content-Type':'application/ds-json',
                      			'Accept': 'application/ds-json'
              				},
              				onFailure : function (json) {
                   				console.log(json);
                   				onDeployFailure();          	
              				},                  
              				onComplete: function(json){              					
              					console.log(json);
                      			onDeploySuccess(); 
              				}//.bind(this),                     
              			});            			
         			}//of function ApplyNamingModificationsOnServer
                  
        			function onDeploySuccess() {
						var imgCell = document.getElementById("nameDeployIndicator");
						UIUtilities.updateIcon(true,imgCell);

        				var successdeploy = ParamWdgNLS.deploySuccessMsg;// + ' - ' + new Date();
        				deployAlert.add({ className: "success", message: successdeploy });
        				Mask.unmask(widget.body);//DeployLightBox.close();
        			}
        
        			function onDeployFailure() {    
        				Mask.unmask(widget.body); //DeployLightBox.close();
           				var deployfail = ParamWdgNLS.deployFailureMsg;// + ' - ' + new Date();
            			deployAlert.add({ className: "error", message: deployfail});     	
       				}     	
    				          	 
     				function requestDataFromServer (iDomain) 
     				{	           	          	
           				var url = paramWidget.env_url+'/resources/ParamWS/access/DomainInfo';
 						var myGetRequest = UWA.Data.request(url, {
 						//parameters: params,							
 						data: {
 							domainid: iDomain,
 							familyid: "ObjectIdentifier",
 							tenant : paramWidget.tenantID
 						},
 						headers: {
                 			'Accept': 'application/ds-json',
                 			'Content-Type':'application/ds-json'
             			},
 						method: 'get', 
 						type: 'json',// application/ds-json
 						proxy: 'passport',					
 						//cache: 0,
 						onComplete: function(json){
 							onCompleteRequestData(json);
 							Mask.unmask(widget.body);//loadingSpinner.hide();
 							}
 						}); 		
     				}//of Function requestDataFromServer    	
     	
     				function onCompleteRequestData (responseObjectJson)
 					{      
        				var nbofFamilies = responseObjectJson.family.length; 			
						paramWidget.isAccordionadded = false;
			
						if (nbofFamilies >1) {
							wdgAccordion = UIUtilities.createParamAccordion();
							wdgAccordion.inject(globalDiv);
							paramWidget.isAccordionadded = true;	
						}	    					
 			
 						for (var i = 0; i < nbofFamilies; i++)
 						{            					
 							var  currFamilyID =  responseObjectJson.family[i].id;
 							if (currFamilyID != "VersionNaming")//ObjectIdentifier						
 								processIDFamily(currFamilyID,responseObjectJson.family[i]);
 						}
 					}
     	
     				function processIDFamily(iFamilyID, iFamilyObject) {
     					var iFamilyNLS = iFamilyObject.nlsKey;
     					var iFamilyToolTip = iFamilyObject.tooltipNlsKey;
     					var wdgDeployIndicator = true;
     	
     					var familyDiv =  UWA.createElement('div');//.inject(myAccordion);//myContent   		
 
     					var previewTable= UWA.createElement('table',{
     						'class': '', 'width':'100%', 
							'id': iFamilyID+'ParamTable'}).inject(familyDiv);                         	
             
          				//1st line : preview line        		
          				lineParam = UWA.createElement('tr', {title: ''}).inject(previewTable);
          	
          				var cellLabel = UWA.createElement('td', {'width':'30%', 'title':''}).inject(lineParam);
            			UWA.createElement('p', {text: ParamWdgNLS.Preview, 'class': ''}).inject(cellLabel);
          	
          				var controlObjectCellPreview = UWA.createElement('td',{
          					'width':'40%', 'title':'', 
          					'align':'left','id':''}).inject(lineParam);
          	        	
        				var spancontainer = UWA.createElement('td', {
        					'width':'30%', 
          					'title':'', 
          					'id' : 'nameDeployIndicator',
          					align : 'left'          		
          				}).inject(lineParam);       	
        	        	
        				var imgTitle = 'Deployed';
        				var imgClass = 'fonticon fonticon-2x fonticon-check';
        				var iconColor = 'green'; 
  			
        				var imgSpan = UWA.createElement('span', {
        					'class' :  imgClass   	  
        				}).inject(spancontainer);
        	
        				imgSpan.setStyle("color", iconColor); 	
        				spancontainer.set("Title",imgTitle);
      	        	     	   	        	
         				//1st line bis : Formula Line          	
          				var lineParam = UWA.createElement('tr', {title: ''}).inject(previewTable);
          				UWA.createElement('td',{
          					'width':'30%', 
          			 		'title': ParamWdgNLS.Formula,
          			  		'html' : ParamWdgNLS.Formula
          				}).inject(lineParam);
          	
          				cellLabel = UWA.createElement('td', 
          					{'width':'70%', 'colspan':'2', 'align':'left', 'title':''}).inject(lineParam);
          				          	         
          				var FormulaDetail = '{'+ParamWdgNLS.Prefix+'}-{'+ParamWdgNLS.Interfix+'}-<'+ParamWdgNLS.Counter+'>-{'+ParamWdgNLS.Suffix+'}';          				
          				UWA.createElement('p',{
          					text: FormulaDetail, 
            				'class': 'lead'//'uwa-input'//'width':'100%'	
            			}).inject(cellLabel);
          	
          				//Intermediary Lines after previewTable     	
          				UWA.createElement('tr',{
          				html:  [{  
                               tag: 'th',
                               colspan: 3,
                               html:"<br/><br/>"
                          	 	}]   			
          				}).inject(previewTable);        
             
            			var	nbofParamofNamings = iFamilyObject.parameter.length;             
            			var nbofValuesForArg;		
            			var sepElt = CommonUtilities.paramStructBuilder("id,nlsKey,value");
            			var cteElt = CommonUtilities.paramStructBuilder("id,value");     
 						var optionsSepArray = new Array();   
 						var constantArray = new Array();
 						var separatorValue ="-";
 						var isCommonParamsDeployed = "true";
             
            			for (var j = 0; j < nbofParamofNamings; j++)
 						{								
 							var iParam = iFamilyObject.parameter[j];		
 				
 							if (iParam.id == "IdentifierAffix")
 							{	
 								isCommonParamsDeployed = iParam.isDeployed;
 								//getconstants
 								var nbofctes = iParam.constant.length;					
 								for (l=0; l<nbofctes; l++) 								
 									constantArray[l] = new cteElt(iParam.constant[l].id, iParam.constant[l].value);						
 								 									
 								var nbofArgs = iParam.argument.length;	
 								for (k=0; k<nbofArgs; k++)
 								{ 						
 									if ("AffixArg" == iParam.argument[k].id)
 									{
 										var iArg = iParam.argument[k];						
 						
 										affixContainer = new namingElement("IdentifierAffix",
 												iArg.argValue,iArg.defaultValue,
 												iArg.argValue); 						
 									}
 									else if ("SeparatorArg" == iParam.argument[k].id)
 									{
 										var iArg = iParam.argument[k];	
 										separatorValue = iArg.argValue;						
 					        			nbofValuesForArg = iArg.value.length;				        
 					              
 					        			for (var i = 0; i < nbofValuesForArg; i++)
 					        			{   	
 					        				var iVal = iParam.argument[k].value[i];	
 					        				var trsfVal = iVal.id;
 					        	
 					        				for (l=0; l<nbofctes; l++)								
 					        					if ( constantArray[l].id == iVal.id)
 					        					{				        			
 					        						trsfVal = 	constantArray[l].value;
 					        						break;
 					        					}   
 	 					        	
 					        				optionsSepArray[i] = new sepElt(trsfVal,
 					        						iVal.nlsKey,
 					        						iVal.tooltipNlsKey);
 					        	 					        	 					        	
 					        				separatorContainer = new namingElement("SeparatorArg",
 					        						separatorValue,
 					        						iArg.defaultValue,
 					        						separatorValue); 					   		
 										}//of for loop on the args
 									}//on the if else : iParam.argument[k].id
 								}//of the for loop on the number of args
 								break;				
 							}//if (iParam.id == "IdentifierAffix") 				
 						}//of the first loop on the naming params  
 						
 						if (isCommonParamsDeployed == "false")
 							wdgDeployIndicator = false;
                    
             			var affixvaluetoshow = affixContainer.initialValue;
             
             			if (affixvaluetoshow == "TBD")
             				affixvaluetoshow="";
           	
             			//2nd line Select Object Type Line 
             			lineParam = UWA.createElement('tr', {title: ''}).inject(previewTable); // tableParameters           
             
             			var cellLabel = UWA.createElement('td', {'width':'30%', 'title':''}).inject(lineParam);			
             			UWA.createElement('p', {text: ParamWdgNLS.ObjectType, 'class': ''}).inject(cellLabel);
                         
             			var controlObjectCell = UWA.createElement('td', {'width':'70%', 'colspan':'2', 'title':''}).inject(lineParam);  
 			                   
             			var selectControler = new Select({
  							placeholder: false,
  							nativeSelect: true,                
             				attributes: {
           	  		 			id 		: 'iTypeSelect',
           	  	     			disabled	: false, 
                 			}                           
             			});
  	          	
						selectControler.getContent().setStyle("width", 270) ;  
             		
 						var icount = 0;
 						var initPreftoShow,initSufftoShow;  
 						var isNamingParamDeployed = "true";
 			
 						for (var j = 0; j < nbofParamofNamings; j++)
 						{								
 							var iParam = iFamilyObject.parameter[j];
 							var iType = iParam.id; 					
 				
 							if (iParam.id != "IdentifierAffix")
 							{				
 								isNamingParamDeployed = iParam.isDeployed;
 								var iTypeNLS = iParam.nlsKey;
 				
 								selectControler.add([{
 									label: iTypeNLS,	
 		     						value: iType,
 		     						selected: true
 		     					}],false);	
 				
 								var nbarg = iParam.argument.length;
 								var iPrefixVal, iSuffixVal, iPrefixDefVal, iSuffixDefVal;
 					
 								if (nbarg == 2)
 								{						
 									for (var l = 0; l<nbarg; l++)
 									{
 										var iArg = iParam.argument[l];
 							
 										if ("PrefixArg"==iArg.id)
 										{
 											iPrefixVal = iArg.argValue;
 											iPrefixDefVal = iArg.defaultValue;
 										}
 										else if ("SuffixArg"==iArg.id)
 										{
 											iSuffixVal = iArg.argValue;
 											iSuffixDefVal = iArg.defaultValue;
 										}
 									}//of for loop	 				
 								}//of if nbarg == 2
 								else 				
 									console.log("Houston, we have a problem!"); 		
 					
								var nbofctes = iParam.constant.length;	
								var internalType,
									currAppType = "VPM";
					
 								for (l=0; l<nbofctes; l++) { 					
 									if (iParam.constant[l].id == "appType") {
 										currAppType = iParam.constant[l].value;							
 									} else if (iParam.constant[l].id == "type") {
 		                                internalType = iParam.constant[l].value; 
 		                            }
 		                        }
 							
 								//iArgument.nlsKey,iParamObj.id,iArgument.tooltipNlsKey	
 								addCustomNamingElement(iType,iTypeNLS,
 											iPrefixVal,iSuffixVal,
 											iPrefixDefVal,iSuffixDefVal,
 											internalType,currAppType,isNamingParamDeployed,icount);
 							 				
 								icount++; 				
 								initPreftoShow = iPrefixVal;
 								initSufftoShow = iSuffixVal;
 								
 								if (isNamingParamDeployed == "false")
 		 							wdgDeployIndicator = false;								
 								
 							}//of if (iParam.id != "IdentifierAffix") 					
 						} //of the 2nd loop on the naming params
 						
 						selectControler.addEvent("onChange", function () {
 							selectedTypeChanged();
 		                });//IR-409614-3DEXPERIENCER2016x/3DEXPERIENCER2017x
             
             			selectControler.inject(controlObjectCell);            
                         
 						//3rd line : Prefix Line
			            lineParam = UWA.createElement('tr', {title: ''}).inject(previewTable); // tableParameters
         
             			cellLabel = UWA.createElement('td', {'width':'30%', 'title':''}).inject(lineParam);
             			UWA.createElement('p', {text: ParamWdgNLS.Prefix, 'class': ''}).inject(cellLabel);
             
             			controlObjectCell = UWA.createElement('td', {'width':'70%', 'colspan':'2', 'title':'','class': '', 'id':''}).inject(lineParam);
                         
         	 			var prefixField = new Text({
           	 				placeholder: "...",
           	  				attributes: {
           	  		 			id : 'prefixInput',
                     			value: initPreftoShow,
                     			multiline: false,
                     			disabled: false
                     		},
                     		events: {
								onKeyDown: function () {							
									if (timerconn) 
										clearTimeout(timerconn);
									
									timerconn = setTimeout(function() {
										updateNamingElement('prefixInput');}, 20);
									}
                     		}		
                     	}).inject(controlObjectCell);  
                         
         	 			prefixField.getContent().setStyle("width", 270) ;   
         	 			prefixField.getContent().set("maxLength",170);
             
             			//4th line             
             			lineParam = UWA.createElement('tr', {title: ''}).inject(previewTable);//tableParameters
             
             			cellLabel = UWA.createElement('td', {'width':'30%', 'title':''}).inject(lineParam);
             			UWA.createElement('p', {text: ParamWdgNLS.Suffix, 'class': ''}).inject(cellLabel);
             
             			controlObjectCell = UWA.createElement('td', {'width':'70%', 'colspan':'2', 'title':'','class': '', 'id':''}).inject(lineParam);
                    	 
          	 			var suffixField = new Text({
            	 			placeholder: "...",
            	  			attributes: {
            	  		 		id : 'suffixInput',
                      			value: initSufftoShow,
                      			multiline: false,
                      			disabled: false
                      		},
                      		events: {
 								onKeyDown: function () { 							
 									if (timerconn) 
 										clearTimeout(timerconn);
 									
 									timerconn = setTimeout(function() {
 										updateNamingElement('suffixInput');}, 20); 
 								}
                      		}		
                      	}).inject(controlObjectCell);  
                                   
          				suffixField.getContent().setStyle("width", 270) ;   
          				suffixField.getContent().set("maxLength",170);
          	
 						//Intermediary Line after 4th Line         	
          				UWA.createElement('tr',{
          					html:  [{  
                               		tag: 'th',
                               		colspan: 3,
                               		html:"<br/>"
                           			}]   			
          				}).inject(previewTable); // tableParameters          			
          			
          				//first line : Affix Line
                  		var lineParam = UWA.createElement('tr', {title: iFamilyToolTip}).inject(previewTable); //tableParameters    	
                  	
         				var labelAffixcell = UWA.createElement('td', {'width':'30%', 'title':''}).inject(lineParam);//'class':'',         	
         				UWA.createElement('p', {text: ParamWdgNLS.Interfix + ' ('+ParamWdgNLS.CommonParam+') ', 'class': ''}).inject(labelAffixcell);
         			        	
                  		var controlObjectCell = UWA.createElement('td', {'width':'70%', 'colspan' :'2', 'title':''}).inject(lineParam);    
             
                  		var affixField = new Text({
                  			placeholder: "...",
                  			attributes: {
                  				id : 'sitenameinput',
                  				value: affixvaluetoshow,
                  				multiline: false,
                  				disabled: false
                  			},
                  			events: {
                  				onKeyDown: function () {
                         							
                         		if (timerconn)
                         			clearTimeout(timerconn);
                         			
                         		timerconn = setTimeout(function() {
                         			testonlineinputname();}, 20);
                         		}
                  			}		
                        }).inject(controlObjectCell);  
                                                           
                    	affixField.getContent().setStyle("width",270);   
                    	affixField.getContent().set("maxLength",200);   

                    	//first line bis : character selector        	
                  		var lineParam = UWA.createElement('tr', {title: ''}).inject(previewTable);   //  	 tableParameters
                  
                 		var labelSepcell = UWA.createElement('td', {'width':'30%', 'title':''}).inject(lineParam);//'class':'',         	
         				UWA.createElement('p', {text: ParamWdgNLS.Separator +' ('+ParamWdgNLS.CommonParam+') ', 'class': ''}).inject(labelSepcell);
         		
         				var controlObjectCell = UWA.createElement('td', {'width':'70%', 'colspan':'2', 'title':''}).inject(lineParam);
         			 			
         				sepControler = new Select({
         					placeholder: false,
         					nativeSelect: true,                
                    		attributes: {
                    			id : 'selectSeparator',
                  	  	    	disabled: false, 
                        	}        
                    	});
         	          	
         	        	sepControler.getContent().setStyle("width", 270) ;  
         			 	//sepControler.addEvent('resetparams', whenIframeLoadedCB, this);
         					  
         	         	for (var i = 0; i < nbofValuesForArg; i++)
         	          	{       							
         	            	var isSelected = false;  
         	            	
         	        		if  (optionsSepArray[i].id == separatorValue)
         	        			isSelected = true;         	        
         	    		
         	    			sepControler.add([{
         						label: optionsSepArray[i].nlsKey,//iArgument.value[i].nlsKey,	
         	     				value: optionsSepArray[i].id ,//iArgument.value[i].id,     
         	     				selected: isSelected
         	     			}],false);  
         	          	}                    				 				
         	                			                    				
         	        	//selectControler.setSelection(3);  
         	        	sepControler.addEvent("onChange", function () {
         	        		testonlineinputname();
		                });//IR-409614-3DEXPERIENCER2016x/3DEXPERIENCER2017x
         				sepControler.inject(controlObjectCell);       	
                  	
                  		//firstIntermediary Line after Affix Line                  	
                  		UWA.createElement('tr',{
                  			html:  [{  
                                       tag: 'th',
                                       colspan: 3,
                                       html:"<br/><br/>"
                                   }]   			
                  		}).inject(previewTable);// tableParameters  				
          	   	   	
          				//Injecting the preview Line
           				var initialPreview = initPreftoShow+'-'+affixvaluetoshow+'-<'+ParamWdgNLS.Counter+'>-'+initSufftoShow;    
          
            			var finalformatinput = new Text({
            				placeholder: "...",
                           	attributes: {
                           		id : 'finalformat',
                                value: initialPreview,
                                multiline: false,
                                disabled: false,
                                readonly:true
                            }
            			}).inject(controlObjectCellPreview);  
                                          
           				finalformatinput.getContent().setStyle("width", 350) ;   
          	
         				//styles: {background-color: #E6E6E6} //styles: background-color: #E6E6E6
        				//finalformatinput.setStyle('background-color', '#E6E6E6');                   			
             			/* 'green iconr next medium uwa-icon glossy uwa-button uwa-input',
             			controlObjectCell = UWA.createElement('td', 
             			{'width':'10%', 'title':'','class': '', 'id':'',
             			html:'<input type="text" id="prefixInput" value="" size="30" Maxlength="60" />'             		
             			//onkeyup="javascript:updateNamingElement('prefixInput')" oninput="...
             			}).inject(lineParam);*/	 
             			
          				dataConfig = {};
            			dataConfig.pinned = true;
            			dataConfig.text = iFamilyNLS;                 	                                  
                      	
            			if (paramWidget.isAccordionadded)
						{
							wdgAccordion.addItem('option'+iFamilyID,dataConfig );                   
							wdgAccordion.updateContent('option'+iFamilyID, familyDiv, true);
						}
           				else
           				{	
							subDiv = UIUtilities.createSubParamDiv(ParamWdgNLS.Naming_Intro);				
							subDiv.inject(globalDiv);
							familyDiv.inject(subDiv);//globalDiv
           				}
            
          				//ZUR IR-203385V6R2014 			
 						if (wdgDeployIndicator == false)
 						{ 
 							var imgCell = document.getElementById("nameDeployIndicator");
 							UIUtilities.updateIconId(imgCell);
 							CommonUtilities.dispatchNeedDeployEvt(paramWidget);
 						}
          				
 						paramScroller = new Scroller({
   						   element: globalDiv
   						}).inject(widget.body); 
          				
          				AddControlLine();
 					}
     	
     				function testonlineinputname()
 					{
 						var tSiteName=document.getElementById("sitenameinput").value; 		
 						var imgCell = document.getElementById("nameDeployIndicator");
 						UIUtilities.beingModified(imgCell, ParamWdgNLS.Being_Modified);
 			 						
 						if (UIUtilities.testSpecialCharacters(tSiteName)==true)
 						{	
 							document.getElementById("sitenameinput").style.color="red";
 							UIUtilities.inputError(imgCell,ParamWdgNLS.SpecialCharMsg);
 							imgCell.focus();
 				 													
 							var applyBtn = widget.getElement('.btn-primary');//'green medium iconl play' 
 							applyBtn.disabled = true;
 				
 							document.getElementById("iTypeSelect").disabled=true;			
 							warnArrays[0].warnRaised = true; 				
 						}
 						else
 						{
 							warnArrays[0].warnRaised = false;				
 							document.getElementById(warnArrays[0].warnID).style.color="#555555";//070E14 color: #555;
 							affixContainer.currentValue = tSiteName;	
 				
 							var cSeparator = document.getElementById('selectSeparator').options[document.getElementById('selectSeparator').options.selectedIndex].value;
 								
 							var selectedType = document.getElementById("iTypeSelect").options[document.getElementById("iTypeSelect").options.selectedIndex].value;			
 							var iI = getIndexInNamingArray(selectedType);
 				
 							UpdateFinalFormatOverView(custoNamingsArray[iI].prefix,tSiteName,custoNamingsArray[iI].suffix, cSeparator, custoNamingsArray[iI].appType );
 				
 							if (CheckforRaisedWarnings() == "OK")
 							{
 								UIUtilities.beingModified(imgCell, ParamWdgNLS.Being_Modified);
 		 			
 								//document.getElementById("labelwarning").innerHTML="";
 								//document.getElementById("sitenameinput").style.color="#070E14";					
 					
 								for (var i=0; i<warnArrays.length;i++)					
 									document.getElementById(warnArrays[i].warnID).style.color="#555555";//070E14
 										
 								document.getElementById("iTypeSelect").disabled=false;	 					
 								var applyBtn = widget.getElement('.btn-primary');
 	 							applyBtn.disabled = false;
 								 								
 								/*+ //IR-207199V6R2014
 								if (tSiteName == "")
 								{
 									//document.getElementById("labelwarning").innerHTML="<affixDefineTooltip>";
 									//document.getElementById("labelwarning").style.color="#157196";
 								}
 								else 								
 									//document.getElementById("labelwarning").innerHTML="";+*/	 					
			 				} 							
 						}
 					}//of function testonlineinputname  	
     	   	  	
     				function addCustomNamingElement(iType,iTypeNLS,iPrefix,iSuffix,idefPrefix,idefSuffix,iObjType,iAppType,deploystatus,icount)
 					{		
 						custoNamingsArray[icount]= new custoNamingElement(iType,iPrefix,iSuffix,idefPrefix,idefSuffix,iAppType,deploystatus);
 			
 						if (iAppType == "VPM")			
 							forbiddenNamings[forbiddenNamings.length] = iObjType;
 					}
 				
 					function selectedTypeChanged()
 					{					
 						var selectedType = document.getElementById("iTypeSelect").options[document.getElementById("iTypeSelect").options.selectedIndex].value;			
 						var iI = getIndexInNamingArray(selectedType);	
 			
 						document.getElementById("prefixInput").value=custoNamingsArray[iI].prefix;
 						document.getElementById("suffixInput").value=custoNamingsArray[iI].suffix;	
 			
 						var currAffValue = document.getElementById('sitenameinput').value;//affixContainer.initialValue 									
 						var curSepValue = document.getElementById('selectSeparator').options[document.getElementById('selectSeparator').options.selectedIndex].value; 					
 						UpdateFinalFormatOverView(custoNamingsArray[iI].prefix,currAffValue,custoNamingsArray[iI].suffix, curSepValue, custoNamingsArray[iI].appType); 				
 						document.getElementById("iTypeSelect").title = document.getElementById("iTypeSelect").options[document.getElementById("iTypeSelect").options.selectedIndex].innerHTML;	
 					}
 					
 					function getIndexInNamingArray(iType)
 					{
 						var i;
 						for (i = 0; i<custoNamingsArray.length; i++)				
 							if (custoNamingsArray[i].objTypeID == iType)	
 								return i;
 						
 						return 0;
 					}
 		
 					function updateNamingElement(elt)
 					{								
 						var errorMsg,
 							typeNamingTest = false;
 							imgCell = document.getElementById("nameDeployIndicator");
 						UIUtilities.beingModified(imgCell, ParamWdgNLS.Being_Modified);
 			
 						var eltName=document.getElementById(elt).value;
 						
 						typeNamingTest = testTypeNamings(eltName);
 					
 						if ( (UIUtilities.testSpecialCharacters(eltName)==true)||
 							(typeNamingTest == true) )
 						{			
 							document.getElementById(elt).style.color="red"; 							
 							errorMsg = ParamWdgNLS.SpecialCharMsg;
 							
 							if (typeNamingTest == true) {
 								errorMsg = ParamWdgNLS.typesForbiddenMessage;
 							} 								
 							
 							UIUtilities.inputError(imgCell, errorMsg);
 							document.getElementById("iTypeSelect").disabled=true;
 				
 							var applyBtn = widget.getElement('.btn-primary');//.green
 							applyBtn.disabled = true;
 								
 							for (var i=0; i<warnArrays.length;i++)				
 								if (warnArrays[i].warnID == elt)
 								warnArrays[i].warnRaised = true;
 						}
 						else
 						{								
 							for (var i=0; i<warnArrays.length;i++)				
 								if (warnArrays[i].warnID == elt)
 								{
 									warnArrays[i].warnRaised = false;
 									document.getElementById(warnArrays[i].warnID).style.color="#555555";//070E14
 						
 									var selectedType = document.getElementById("iTypeSelect").options[document.getElementById("iTypeSelect").options.selectedIndex].value;			
 									var iI = getIndexInNamingArray(selectedType);	
 												
 									if (elt == "prefixInput")
 										custoNamingsArray[iI].prefix = document.getElementById("prefixInput").value;
 									else if (elt == "suffixInput")
 										custoNamingsArray[iI].suffix = document.getElementById("suffixInput").value;
 						
	 								//custoNamingsArray[iI].deploySts = "saved";						
	 								//var currAffVal = document.getElementById('sitenameinput').value;
	 								//document.getElementById("buttonAddSite").innerHTML='<img src=\"images/iconSavedParameter.gif\" title="<=NotYetDeployedParameter%>">';
	 						
 									var curSepValue = document.getElementById('selectSeparator').options[document.getElementById('selectSeparator').options.selectedIndex].value;
 								
 									UpdateFinalFormatOverView(custoNamingsArray[iI].prefix,affixContainer.currentValue,custoNamingsArray[iI].suffix,curSepValue, custoNamingsArray[iI].appType);		
 								}//of if (warnArrays[i].warnID == elt)					
 					
 							if (CheckforRaisedWarnings() == "OK")
 							{	
 								UIUtilities.beingModified(imgCell, ParamWdgNLS.Being_Modified);

 								//x document.getElementById("labelwarning").innerHTML="";
 								//document.getElementById(elt).style.color="#070E14";
 								document.getElementById("iTypeSelect").disabled=false; 					
 								var applyBtn = widget.getElement('.btn-primary');
 								applyBtn.disabled = false;
 					
 								/*x //IR-207199V6R2014 								
 								var tSiteName=document.getElementById("sitenameinput").value; 					
 							 	if (tSiteName == "")
 								{
			 						document.getElementById("labelwarning").style.color="#157196";
			 						document.getElementById("labelwarning").innerHTML="affixDefineTooltip";
			 					}
			 					else
			 						document.getElementById("labelwarning").innerHTML="";
			 					x*/
 							}				
 						}//of else
 					}//of function updateNamingElement()
 		
 					function confirmNamingElement()
 					{			
 						var imgCell = document.getElementById("nameDeployIndicator");
 						UIUtilities.beingModified(imgCell, ParamWdgNLS.Being_Modified);
 									
 						var selectedType = document.getElementById("iTypeSelect").options[document.getElementById("iTypeSelect").options.selectedIndex].value;			
 						var iI = getIndexInNamingArray(selectedType);	
 						
 						custoNamingsArray[iI].prefix = document.getElementById("prefixInput").value;
 						custoNamingsArray[iI].suffix = document.getElementById("suffixInput").value;
 						custoNamingsArray[iI].deploySts = "saved";			
 			
 						var currAffVal = document.getElementById('sitenameinput').value;
 						var curSepValue = document.getElementById('selectSeparator').options[document.getElementById('selectSeparator').options.selectedIndex].innerHTML;
 		
 						UpdateFinalFormatOverView(custoNamingsArray[iI].prefix,currAffVal,custoNamingsArray[iI].suffix, custoNamingsArray[iI].appType);
 					}						

			 		function testTypeNamings(iString)
			 		{ 			
			 			var selectedType = document.getElementById("iTypeSelect").options[document.getElementById("iTypeSelect").options.selectedIndex].value;			
			 			var iI = getIndexInNamingArray(selectedType);				
			 			var currAppType = custoNamingsArray[iI].appType;
			 			
			 			if (currAppType == "VPM")
			 			{
			 				for (var i = 0; i < forbiddenNamings.length; i++)
			 					if (iString.indexOf(forbiddenNamings[i]) != -1)
			 						return true;
			 			} 			
			 			return false; 			
			 		}
 	
					// IR-260338V6R2014x
			 		function UpdateFinalFormatOverView(iPrefix,iAffix,iSuffix,iSeparator,iAppType)
			 		{					
			 			var cSep = iSeparator;
			 			
			 			if (iAffix != "")
			 			{
			 				iAffix  = iAffix+cSep;				
			 				if (iPrefix != "")	
			 					iPrefix = iPrefix+cSep;				
			 			}
			 			else if ( (iAppType == "CBP") && (iPrefix != "") )	
			 				iPrefix = iPrefix+cSep;			
			 						
			 			if (iSuffix != "") iSuffix = cSep+iSuffix;
			 			
			 			document.getElementById("finalformat").value=iPrefix+iAffix+'<'+ParamWdgNLS.Counter+'>'+iSuffix;
			 		}
 		
			 		function CheckforRaisedWarnings()
			 		{
			 			for (var i=0; i<warnArrays.length;i++)				
			 				if (warnArrays[i].warnRaised == true)
			 					return "WARN";
			 			
			 			return "OK";			
			 		}
			 		
			 		//IR-207199V6R2014
			 		function CheckAffixValue()
			 		{			
			 			var tSiteName=document.getElementById("sitenameinput").value; 			
			 			/*x if (tSiteName == "")
			 			{
			 				document.getElementById("labelwarning").style.color="#157196";
			 				document.getElementById("labelwarning").innerHTML="<affixDefineTooltip>";
			 			}x*/
			 		}
 		
			 		function handleSepatorIssues(separatorVal)
			 		{						
			 			var selectSepObj = document.getElementById("selectSeparator");			
			 						
			 			selectSepObj.title="";
			 			selectSepObj.options.length = 0;	
			 			
			 			for ( var i=0; i<sepSequence.length; i++)
			 			{
			 				selectSepObj.options[i] = new Option(sepSequence[i].sequenceNLS,sepSequence[i].sequenceID);
			 				selectSepObj.options[i].title = sepSequence[i].sequenceTootip;
			 				
			 				if (sepSequence[i].sequenceID==separatorVal)			 				
			 					selectSepObj.options[i].selected="selected";
			 			}						
			 			
			 			selectSepObj.onchange = function() { onSeparatorChange();}; 						
			 			//selectedTypeChanged()
			 		}
 		
			 		function onSeparatorChange()
			 		{
			 			testonlineinputname();
			 		}		
 		
					function AddControlLine()
					{ 			
						controlDiv = UWA.createElement('div', {'id': 'applyresetNamingDiv'});
						
						var controlTable =  UWA.createElement('table',	
								{'class': '', 'id':'', 'width':'100%'}).inject(controlDiv);//globalDiv  
									
				        var controlLine = UWA.createElement('tr', {title: ''}).inject(controlTable);
				        	
				        UWA.createElement('td',{
				        	'width':'60%', 
				        	'title':'',
				        	'html': ''
				        }).inject(controlLine);   
				        
            			var buttonApplyCell = UWA.createElement('td', {
			                'width' : '10%'
				        }).inject(controlLine);
            			
            			var appplyBtn = new Button({
	                     	className: 'primary',
	                     	id : 'buttonApply',
	                     	icon:'forward',//value: 'Button',                    
	                     	attributes: {
	                        	disabled: false,
	                         	title: ParamWdgNLS.ApplyNamingtooltip,
                        		text : ParamWdgNLS.Apply 
                    		},                 
         					events: {
         						onClick: function () {                 		
         						var retAffix = UpdateCommonParamsOnServer(false);
         						ApplyNamingModificationsOnServer();        			
         						},
		                 	}
		                }).inject(buttonApplyCell);
            			appplyBtn.getContent().setStyle("width", 120);		
            			        
             			var buttonResetCell = UWA.createElement('td', {
                     		'width' : '10%'
             			}).inject(controlLine);
             			
             			var resetButton = new Button({
                         	className: 'warning',
                         	icon: 'arrows-ccw',//loop              
                         	attributes: {
                             	disabled: false,
                             	title: ParamWdgNLS.Resettooltip,
                             	text : ParamWdgNLS.Reset
                         	},                         
                     		events: {
                     			onClick: function () {                        		
                     			ResetInSession();                 			
                     			},    
                     		}
                 		}).inject(buttonResetCell);
             			resetButton.getContent().setStyle("width", 120);
             			
             			controlDiv.inject(widget.body);//globalDiv
 					}//of AddControlLine
 					 			 		 		
			 		function ResetInSession() {					
						var i, j, optionValue;
 						//Affix
						affixContainer.currentValue = affixContainer.defaultValue;//ZUR : Check this please
						document.getElementById("sitenameinput").value=paramWidget.tenantID; //affixContainer.defaultValue;	
							
						//CheckAffixValue();	
						/*sepControler.setSelection(1);				
						sepControler.elements.input.selectedIndex = 0;			
						sepControler.elements.input[0].selected = true;*/			
						//UWA.Event.dispatchEvent(sepControler, 'resetparams');
						 for (j = 0; j < sepControler.elements.input.length; j++) {
							 optionValue = sepControler.elements.input[j].value;

                              if  (optionValue == "-") {
                            	sepControler.select(j, true, false);
                              	break;
                              }
                        }//of for elements
						
						separatorContainer.currentValue = separatorContainer.defaultValue;
						
						/*var slistlen=document.getElementById("selectSeparator").options.length;			
						for (var j=0;j<slistlen;j++)							
							if (separatorContainer.defaultValue==document.getElementById("selectSeparator")[j].value)
							{
								alert("Found "+document.getElementById("selectSeparator")[j].value);
								document.getElementById("selectSeparator").selectedIndex = j;
								break;
						}*/	
							
						//Prefixes and Suffixes
						for (i = 0; i < custoNamingsArray.length; i++) {
							custoNamingsArray[i].prefix = custoNamingsArray[i].defprefix;
							custoNamingsArray[i].suffix = custoNamingsArray[i].defsuffix;
						}		
													
						selectedTypeChanged();//Updating View
									
						//Deploy Indicators
						var imgCell = document.getElementById("nameDeployIndicator");
						UIUtilities.beingModified(imgCell, ParamWdgNLS.Being_Modified);
					} 	
 					
			 		function platformChanged() {       
			          	UWA.log("Naming::"+paramWidget.tenantID+" url = "+paramWidget.env_url+" - "+new Date());			    		
			    		Mask.mask(widget.body);//loadingSpinner.show();
			    		    	  	
			           	if (subDiv)           	
			           		UIUtilities.clearDivContent(subDiv);
			           	
			           	if (controlDiv)
			           		UIUtilities.clearDivContent(controlDiv);//controlTable
			           		
			           	if (paramScroller)
							paramScroller.destroy();
			                   	      
			       		requestDataFromServer(domainName);   	
			        } 		
 	 		
			 		function dispatchNeedTenantEvt()
			        {        	
			 			console.log("Do i Need a tenant ?::"+paramWidget.socketID);  
			 			firsttime=false;
			         	
			         	if (!paramWidget.tenantID)
			         	{
			         		console.log("No Tenant has been received, calling back::"+paramWidget.socketID);
			         		paramWidget.socket.dispatchEvent('needTenant', {callerSocketID:paramWidget.socketID});
			         	}
			         }   
 		
			 		/*whenIframeLoadedCB = function () {          
			 			alert("insider whenIframeLoadedCB");
			 			this.setselection(0);
			 			sepControler.removeEvent("load", whenIframeLoadedCB);
			        }*/	
			        //var language = window.navigator.userLanguage || window.navigator.language;   
 		 		
     				var paramWidget = {           
		
						onLoad: function () {
							
					        widget.body.empty();					          
					        //create event listener	
					        paramWidget.socketID = 'identificationListenSocket';
							paramWidget.socket = new InterCom.Socket(paramWidget.socketID);     
							paramWidget.socket.subscribeServer('uwa.embedded'); ////tenant-server//, window'tenant-server'
							UWA.log("identification Defining listening Socket::"+paramWidget.socketID);  
				
							globalDiv =  UWA.createElement('div', {'id' : 'mainParamWdgsDiv'}).inject(widget.body); 				        
					        Mask.mask(widget.body);						
		
					    	deployAlert = UIUtilities.createWdgAlert();
							deployAlert.inject(widget.body);//globalDiv
		
							var initDate =  new Date();
						 	paramWidget.refreshDate =  initDate.getTime();	
							 
					        paramWidget.socket.addListener('onPlatformChange', function (data) {					           
					        	UWA.log("onPlatformChange Event Received, launching ...!");
					        	UWA.log(data);      	
					        	paramWidget.tenantID = data.selectedTenant;
					        	paramWidget.env_url	 = data.url3DSpace;
					        	
					        	if (data.selectedTenant == "OnPremise") {//Rb0afx
					        		paramWidget.env_url = PlatformAPI.getApplicationConfiguration('app.urls.myapps');
		        				}
					        	
					        	platformChanged();					
					        }); 
                        
					        if (firsttime)
					    	{      	
					        	setTimeout(function() {
									dispatchNeedTenantEvt();}, 11000);
					    	}
    	
         				},//End of Onload	
         
				        onRefresh: function () {         	
				         	console.log("onRefresh, Object Naming Rules ... ");				       
				         	var currDate = new Date();
				    	 	var currTime = currDate.getTime();    	 	
				    	 	var diffDate = currTime - paramWidget.refreshDate;    	 	
				    	 	paramWidget.refreshDate = currTime;
				    	 	
				    	 	if (diffDate >= 1500)    	 	
								platformChanged();    
				    	 	else    	
								console.log("the last refresh was less than 1.5 seconds ... (Obj Naming Rules) no action");
				         }	
                          		
        		};//endof Paramwidget               
  
        		widget.addEvents({
            		'onLoad': paramWidget.onLoad,
            		'onRefresh': paramWidget.onRefresh});         
       
			});//of require
			       			       
        </script>
</head>
<body>
	<p>Loading ...</p>
</body>
</html>
