define("DS/CfgEvolutionUX/CfgUnitMilestoneLayout",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Modal","DS/UIKIT/Input","DS/UIKIT/Input/Button","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","DS/UIKIT/Input/Text","DS/Tree/TreeListView","DS/CfgBaseUX/scripts/CfgData","DS/UIKIT/Input/Toggle","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","DS/CfgFilterUX/CfgFilterSlideInComponent","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgContainerView","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(d,j,l,k,i,g,b,h,f,o,a,m,q,e,c,p){var n={create:function(D,w,v,r){var x=this;this.fields=w;this.event1;this.ExpressionMode=false;this.selectedNodes=[];this.currentModel=v;this.MainContainer=new UWA.Element("div",{"class":" maincontainer-class"});this.ChildContainer1=new UWA.Element("div",{"class":" ChildContainer1-class"});this.ChildContainer1.setAttribute("id","childContainer1");this.ChildContainer2=new UWA.Element("div",{"class":" ChildContainer2-class"});this.ChildContainer2.setAttribute("id","childContainer2");this.opts=r;var y=UWA.createElement("div",{html:'<div id="selectiondivID", style="float:left;margin-right:13px;padding-top:6px;font-weight:bold;white-space: nowrap;text-overflow: ellipsis;width: 141px;overflow: hidden">'+g.Filter_InfinitySelectionMode+'</div><div style="display:flex ;padding-top:10px;"><div class="toggleParent"></div>'}).inject(this.ChildContainer2);y.addClassName("infoicon1");var z=UWA.createElement("span",{"class":" fonticon fonticon-info-circled",}).inject(this.ChildContainer2);this.inputContainer=new UWA.Element("div",{styles:{border:"1px solid #d1d4d4","padding-right":"30px",width:"51%","border-radius":"4px","margin-bottom":"10px"}}).inject(this.ChildContainer1);this.ChildContainer1.appendChild(this.ChildContainer2);this.inputContainer.setAttribute("id","inputContainer1");this.MainContainer.appendChild(this.ChildContainer1);var C=new m({className:"mytooltip",target:this.ChildContainer2,body:g.Filter_InfinitySelectionMode,position:"bottom",});var C=new m({className:"mytooltip",target:z,body:g.Infinitytooltip,position:"bottom",});var s=new m({className:"mytooltip",target:this.inputContainer,body:g.TypeFilter_Number,position:"left",});z.addClassName("infoicon");this.toggle=new o({className:"my-toggle",type:"switch",value:"option2",label:""}).inject(this.MainContainer.getElements(".toggleParent")[0]);if(r.rangeEnable){this.toggle.check(true)}y.setStyle("margin-top","1px");this.textBox=new b({id:"textbox1",placeholder:g.TypeFilter_Number,}).inject(this.inputContainer);this.textBox.elements.input.setStyles({height:"27px",padding:"6px",border:"transparent","box-shadow":"none"});this.clearButton=UWA.createElement("span",{"class":"clearButton",styles:{"float":"left","margin-left":"254px","margin-top":"-27px",cursor:"pointer",color:"lightgrey"}}).inject(this.inputContainer);this.clearButton.set({events:{click:function(F){x.textBox.setValue("");var E=x.textBox.getValue().split(",");x.unitsFilterFromTable(E);x.clearButton.hide()}}});this.clearButton.addClassName("fonticon");this.clearButton.addClassName("clearicon");this.clearButton.addClassName("fonticon-clear");this.MainContainer.addClassName("mainContainerFilterUnit");y.addClassName("infoIconFilter");this.inputContainer.addClassName("searchFilterUnit");this.clearButton.addClassName("clearFilterButton");y.setStyle("display","content");if(r.invokeFrom=="Filter"){}else{this.ChildContainer2.setStyle("display","flex");if(r.invokeFrom!=""){this.ChildContainer2.setStyle("width","100%")}this.ChildContainer2.setStyle("margin-left","18%");this.inputContainer.setStyle("width","60%")}new m({target:this.clearButton,body:g.clear,position:"bottom"});this.clearButton.hide();var u=[];this.selectedRow=[];this.textboxinput=this.fields.split(",");var A=D.builds;this.rootBuildsData(u,A);var t={apiVersion:2,margin:"2px",padding:"2px",defaultCellHeight:38,changeColorOnFocus:false,selection:{canMultiSelect:true,isDraggable:false,unselectAllOnEmptyArea:false},resize:{rows:false,columns:true},columns:[{text:"",dataIndex:"tree",isHidden:true,enableDragAndDrop:false,isSortable:false,isDraggable:false,},{text:g.Filter_Name,dataIndex:"label",enableDragAndDrop:false,isSortable:false,isDraggable:false,width:120,},{text:g.Filter_Number,dataIndex:"buidnumber",enableDragAndDrop:false,isSortable:false,isDraggable:false,},{text:g.Filter_Status,dataIndex:"status",enableDragAndDrop:false,isSortable:false,isDraggable:false,width:"auto",}],roots:u,alternateRowColor:true};t.columns.splice(0,0,{text:"",dataIndex:"selection",type:"selection",width:45,isDraggable:false,});var B=new h(t);B.getManager().forceMultiSelection(true);B.getDocument().options.shouldAcceptDrag=function(){return false};B.getDocument().options.shouldAcceptDrop=function(){return false};B.inject(this.MainContainer);B.elements.container.addClassName("unitalternaterow");B.elements.container.addClassName("unitheader");B.elements.container.addClassName("unithighlighted");B.getNthRoot(0).hide();this.label=UWA.createElement("Label",{html:g.Filter_UnitExpression,}).inject(this.MainContainer);x.tree=B;UWA.Element.addEvent.call(document,"keyup",function(E){x.event1=E.shiftKey;x.tree.getManager().forceMultiSelection(true)});UWA.Element.addEvent.call(document,"keydown",function(E){x.event1=E.shiftKey;x.tree.getManager().forceMultiSelection(true)});x.tree.onNodeClick(function(E){if((E.dataIndex=="label"||E.dataIndex=="buidnumber"||E.dataIndex=="status")&&E.nodeModel==""){return}if(E.dataIndex=="selection"&&E.nodeModel==""){x.selectionNodeData(E)}else{if(x.event1==true&&x.toggle.isChecked()==false&&x.tree.getManager().getDocument().getXSO().get().length>=1){x.selectionNodewithShiftKey(E)}else{x.selectionNodeData(E)}}});this.buildOrderSequence(this.textboxinput);if((this.opts.mode=="UNIT")&&(this.opts.invokeFrom!="Filter"&&this.opts.invokeFrom!="")){this.getModal()}else{if(this.opts.invokeFrom==""){this.getLayout()}else{this.getPanel()}}this.textBox.elements.input.addEvent("keyup",function(){if(x.textBox.getValue().length>0){x.clearButton.show()}else{x.clearButton.hide()}x.buildSequenceInsideTable()});require(["DS/CfgEvolutionUX/CfgUnit"],function(E){x.CfgUnit=new E({parentElement:x.MainContainer});x.CfgUnit.ExpressionMode=true;x.CfgUnit.allRoots=x.tree.getRoots();x.CfgUnit.selectedNodes=x.selectedNodes;x.CfgUnit.currentDictionary=D;x.CfgUnit.currentModel=x.currentModel;x.CfgUnit.fields=x.fields;x.CfgUnit.render();x.CfgUnit.editButton.hide();x.CfgUnit.textBox.setValue(x.CfgUnit.fields);if(x.opts.invokeFrom=="Filter"){c.unmask(x.opts.filterParent)}})},selectionNodewithShiftKey:function(y){var z=this;var t=this.tree.getManager().getDocument().getAllDescendants();t.splice(0,1);var r=z.tree.getManager().getDocument().getXSO().get().length;if(y.dataIndex=="selection"){this.lastselectedNode=z.tree.getManager().getDocument().getXSO().get()[r-1]}else{this.lastselectedNode=z.tree.getManager().getDocument().getXSO().get()[r-2]}var v=t.length;var s;if(parseInt(this.lastselectedNode.options.buildnumber)>parseInt(y.nodeModel.options.buildnumber)){for(var x=0;x<v;x++){var u=t[x];if(u.options.buildnumber==this.lastselectedNode.options.buildnumber){s=0}if(s==0){u.select();if(this.selectedNodes.indexOf(u.options.buildnumber)==-1){this.selectedNodes.push(u.options.buildnumber)}}if(y.nodeModel.options.buildnumber==u.options.buildnumber){s=1}}}else{for(var x=0;x<v;x++){var u=t[x];var s;if(u.options.buildnumber==y.nodeModel.options.buildnumber){s=0}if(s==0){u.select();if(this.selectedNodes.indexOf(u.options.buildnumber)==-1){this.selectedNodes.push(u.options.buildnumber)}}if(u.options.buildnumber==this.lastselectedNode.options.buildnumber){s=1}}}var w={model:z.selectedNodes,};var A=z.CfgUnit.selectionBuilds(w)},selectionNodeData:function(y){var z=this;if(y.nodeModel==""){var C=z.tree.getManager().getDocument().getXSO().get();if(C.length==0){z.tree.getRoots().forEach(function(D){D.select()});var B=z.tree.getManager().getDocument().getSelectedNodes();z.selectedNodes=[];B.forEach(function(D){z.selectedNodes.push(D.options.buildnumber)})}else{z.tree.getRoots().forEach(function(D){D.unselect();z.selectedNodes=[]})}var x={model:z.selectedNodes,};var A=z.CfgUnit.selectionBuilds(x);z.CfgUnit.textBox.setValue(A);return}else{if(this.toggle.isChecked()==true&&(!y.isHeader)){this.selectionCheck=y.nodeModel.isSelected();if(y.dataIndex=="selection"){this.selectionCheck=!this.selectionCheck}if(this.selectionCheck){var s=this.tree.getManager().getDocument().getAllDescendants();var v=s.length;var r=0;for(var w=0;w<v;w++){var t=s[w];var u=t.isRoot();if(r==0&&u==true){t.select();if(this.selectedNodes.indexOf(t.options.buildnumber)==-1){this.selectedNodes.push(t.options.buildnumber)}}if(y.nodeModel.options.buildnumber==t.options.buildnumber){r=1}}}else{var s=this.tree.getManager().getDocument().getAllDescendants();var v=s.length;var r=0;for(var w=0;w<v;w++){var t=s[w];var u=t.isRoot();if(r==0&&u==true){t.unselect();if(this.selectedNodes.indexOf(t.options.buildnumber)>-1){this.selectedNodes.erase(t.options.buildnumber)}}if(y.nodeModel.options.buildnumber==t.options.buildnumber){r=1}}}}else{this.selectionCheck=y.nodeModel.isSelected();if(y.dataIndex=="selection"){this.selectionCheck=!z.selectionCheck}if(this.selectionCheck){if(z.selectedNodes.indexOf(y.nodeModel.options.buildnumber)==-1){z.selectedNodes.push(y.nodeModel.options.buildnumber)}}else{if(z.selectedNodes.indexOf(y.nodeModel.options.buildnumber)>-1){z.selectedNodes.erase(y.nodeModel.options.buildnumber);y.nodeModel.unselect()}if(z.selectedNodes.indexOf(z.tree.getNthRoot(1).options.buildnumber)==-1){if(z.selectedNodes.indexOf(g.unitInfinity)>-1){z.selectedNodes.erase(g.unitInfinity);z.tree.getNthRoot(0).unselect()}}}}}var x={model:z.selectedNodes,};var A=z.CfgUnit.selectionBuilds(x);z.CfgUnit.textBox.setValue(A)},rootBuildsData:function(r,s){var u={label:" ",buildnumber:g.unitInfinity,status:" ",grid:{label:" ",buidnumber:g.unitInfinity,status:" ",},};r.push(u);if(s==undefined||Object.keys(s).length===0&&s.constructor===Object){return}for(var t=0;t<s.length;t++){var v={label:s[t].name,buildnumber:s[t].buildOrder,id:s[t].id,status:s[t].current,grid:{label:s[t].name,buidnumber:s[t].buildOrder,status:s[t].current_NLS,},};r.push(v)}r.sort(function(x,w){return parseInt(w.buildnumber)-parseInt(x.buildnumber)})},getModal:function(){var r=this;r.dialog=new l({className:"site-reset",closable:false,header:"<h4>"+g.Filter_Dialog_Unit_Header+"</h4>",body:this.MainContainer,footer:this.createActionsPresenter(),events:{onHide:function(){f.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}});r.dialog.destroy()}}}).inject(f.renderTo=document.body);r.dialog.elements.body.addClassName("unitbody-modal-body");r.dialog.elements.content.addClassName("unit-modal-content");r.dialog.show();r.dialog.getContent().getElements(".btn-primary").forEach(function(s){s.addEvent("click",function(){f.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:r.selectedNodes,}});r.dialog.destroy()})});r.dialog.getContent().getElements(".btn-default").forEach(function(s){s.addEvent("click",function(){r.selectedNodes=[],f.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}});r.dialog.destroy()})})},getLayout:function(){var t=this;var s=function(u){if(u.buttonId=="firstButton"){f.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:t.selectedNodes,}})}else{if(u.buttonId=="secondButton"){f.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}})}}t.containerView.destroy()};var r={isHeader:true,isFooter:true,firstButtonText:g.CFG_Apply,secondButtonText:g.CFG_Back,headerText:g.Filter_Dialog_Unit_Header,onButtonClickCB:s,};this.containerView=new p(r).render();this.containerView.inject(f.renderTo);this.MainContainer.inject(this.containerView._body)},getPanel:function(){var u=this;var v=function(){u.selectedNodes=[],f.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}});require(["DS/CfgFilterUX/CfgFilterFactory"],function(w){document.querySelector(".operations-main-container").destroy();w.showFilter()})};var r=function(w){f.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:u.selectedNodes,}});require(["DS/CfgFilterUX/CfgFilterFactory"],function(x){document.querySelector(".operations-main-container").destroy();x.showFilter()})};var t=[{label:g.Filter_Cancel,handler:v,className:"default"},{label:g.Filter_Apply,handler:r,className:"primary"}];var s={dialogue:{buttonArray:t,showHeader:true,showButton:true},HeaderLabel:g.Filter_Dialog_Unit_Header};q.init(f.renderToApp,this.MainContainer,s,e)},createActionsPresenter:function(){var r=UWA.createElement("div",{});var t=new i({value:g.Filter_Apply,className:"primary btn btn-primary okBtn"}).inject(r);var s=new i({value:g.Filter_Cancel}).inject(r);return r},selectNodesByBuildNumber:function(u){var t=this;t.selectedNodes=[];var s=this.tree.getManager().getDocument().getAllDescendants();for(var r=0;r<u.length;r++){if(u[r].indexOf("+")!=-1){var w=u[r].split("+");var v=w.slice(0,-1);s.forEach(function(x){if(parseInt(x.options.buildnumber)>=parseInt(v)||(x.options.buildnumber==g.unitInfinity)){x.select();if(t.selectedNodes.indexOf(x.options.buildnumber)==-1){t.selectedNodes.push(x.options.buildnumber)}}})}else{s.forEach(function(x){if(x.options.buildnumber==u[r]){x.select();if(t.selectedNodes.indexOf(x.options.buildnumber)==-1){t.selectedNodes.push(x.options.buildnumber)}}})}}},unitsFilterFromTable:function(t){var s=this;this.selectedRow=[];this.filterStatus=false;if(!(typeof this.selectedNodes=="undefined")){for(var r=0;r<this.selectedNodes.length;r++){this.selectedRow.push(this.selectedNodes[r])}}this.roots=this.tree.getRoots();if(this.roots.length>0){this.roots[0].prepareUpdate()}for(var r=0;r<t.length;r++){s.buildorder=t[r];this.roots.forEach(function(u){if((u.options.buildnumber.indexOf(s.buildorder)>-1)||(u.options.label.toUpperCase().indexOf(s.buildorder.toUpperCase())>-1)){for(var v=0;v<s.selectedRow.length;v++){if(u.options.buildnumber==s.selectedRow[v]){u.select()}}if(u.options.buildnumber==g.unitInfinity){u.hide()}else{u.show()}}else{u.hide()}})}this.roots[0].pushUpdate()},buildOrderSequence:function(r){this.sequenceNumber=[];for(var s=0;s<r.length;s++){var v=r[s].indexOf("-");if(v!==-1){var t=r[s].split("-");while(parseInt(t[0])<=parseInt(t[1])){this.sequenceNumber.push(t[0]);var u=t[0];u++;t[0]=u.toString()}}else{this.sequenceNumber.push(r[s])}}this.selectNodesByBuildNumber(this.sequenceNumber)},buildSequenceInsideTable:function(){var r=this;this.sequenceNumber=[];var s=this.textBox.getValue().split(",");for(var t=0;t<s.length;t++){this.sequenceNumber.push(s[t])}this.unitsFilterFromTable(this.sequenceNumber)}};return n});define("DS/CfgEvolutionUX/CfgEvolutionLayoutFactory",["DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgController","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgModelSelector","DS/UIKIT/Iconbar","DS/CfgBaseUX/scripts/CfgCollection","DS/CfgBaseUX/scripts/CfgModel","DS/CfgBaseUX/scripts/CfgModelView","DS/UIKIT/Input/Button","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","DS/UIKIT/Spinner","DS/UIKIT/Mask","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(b,n,h,k,j,m,d,c,a,f,i,l,e,g){var o={modelListView:null,empty_models:null,showimportCOButton:false,enableImportButton:false,applicabilityCO:"",descriptionMap:{},processexpressionJsonForGetConfiguredObjectsId:function(){var s=this;var r=s.options.expressionJson.length;for(var p=0;p<r;p++){var t=s.options.expressionJson[p];for(var q=0;q<j.Models.length;q++){if(s.getAttributeValue(j.Models[q].basicData,"name")==t.expression.name){t.expression.modelId=t.modelId=j.Models[q].physicalID;t.id=j.Models[q].physicalID;t.expression.marketingName=t.marketingName=s.getAttributeValue(j.Models[q].data,"Marketing Name");t.name=s.getAttributeValue(j.Models[q].basicData,"name");t.state=s.getAttributeValue(j.Models[q].basicData,"current");t.owner=s.getAttributeValue(j.Models[q].basicData,"owner");t.image=j.Models[q].preview_url;t.icon="";break}}s.options.expressionJson[p]=t}},getAttributeValue:function(p,r){var s="";for(var q=0;q<p.length;q++){if(p[q].name==r){s=p[q].value;if(s==null||s=="undefined"){s=""}break}}return s},initModelsWithNoEffectivity:function(){var x=this;x.expressionXml="";x.options.expressionArray=[];this.empty_models=new Array();for(var u=0;u<x.options.modelList.length;u++){var s=x.options.modelList[u];var v={marketingName:x.getAttributeValue(s.data,"Marketing Name"),name:x.getAttributeValue(s.basicData,"name"),image:s.preview_url,icon:"",id:s.physicalID,state:x.getAttributeValue(s.basicData,"current"),owner:x.getAttributeValue(s.basicData,"owner"),expression:"",displayexpression:""};var r=[];var q=[];var w=[];var t=[];var z="";var A="";var D="";var p="";var B=[];var C="";q=JSON.stringify({builds:q});var y={modelId:v.id,psJson:w,mpJson:t,viewJson:null,iDateJson:{DateRanges:r},iUnitJson:q,xmlExpression:z,iDateXml:D,iUnitXml:p,impXml:A,productstatecheckbox:true,unitcheckbox:true,datestatecheckbox:true,manufacturingplanstatecheckbox:true,milestoneJson:B,milestoneXml:C,milestoneCheckbox:true,name:v.name,marketingName:v.marketingName};v.expression=y;x.empty_models.push(v)}if(x.collection==undefined){x.collection=new c(x.options);x.collection.reset()}for(var u=0;u<x.empty_models.length;u++){x.collection.addModel(x.empty_models[u])}if(x.collection.length==1){x.options.editActionCallback(x.collection.at(0))}else{x.modelListView=new f(x.options);x.modelListView.render(x.collection)}},initEditEvolution:function(){enoviaServerFilterWidget.mode=this.options.environment;enoviaServerFilterWidget.tenant=this.options.tenant;var p=this;n.populateDisplayExpressionXSLT().then(function(q){j.Models=p.options.modelList;p.options.Models=j.Models;p.options.noModelsErrorMessage="";p.options.editActionLabel=l.Edit_Evo_Effectivity;p.options.emptyContextText=l.emptyContextText_Evo_Effectivity;p.options.editActionCallback=function(r){p.options.expression=r.get("expression");p.options.selectedmodel=r;p.options.selectedcollection=p.collection;var s=new Promise(function(x,w){var u="/resources/modeler/browsing/model/getcriteria";var v={version:"1.0.0",modelIds:[{id:"pid:"+p.options.expression.modelId}]};v=JSON.stringify(v);var y=function(z){x(z)};var t=function(z){console.log("fail to get last product evolution")};n.makeWSCall(u,"POST","enovia","application/json",v,y,t,true)});s.then(function(t){require(["DS/CfgEvolutionUX/CfgEvolutionCriteriasDialog"],function(u){p.options.criteriasAvailable=t.criteria[0];var u=new u(p.options);u.render()})})};if(p.options.dialogue.hasEffectivity==true){p.options.expressionJson=k.EvolutionXMLtoJSONConvertor(p.options.dialogue.effExpressionXml);p.options.expressionArray=p.options.expressionJson;p.processexpressionJsonForGetConfiguredObjectsId();p.collection=new c(p.options);p.collection.reset();p.collection.initialisingForEvolution(p.options);p.initModelsWithNoEffectivity()}else{p.collection=new c(p.options);p.collection.reset();p.initModelsWithNoEffectivity()}p.evolutionSpinner.hide()})},create:function(q){this.options=q;var r=this;j.clear();j.ModelEvents=new b();r.evolutionSpinner=new e({className:"evolutionSpinner"}).inject(r.options.parent);r.evolutionSpinner.spin();r.evolutionSpinner.show();if(this.options.mode=="EditEvolution"){var p=r;n.checkDecouplingActivation().then(function(s){console.log(s);j.configurationCriteria=s;p.initEditEvolution()});return}h.init();enoviaServerFilterWidget.mode=this.options.environment;enoviaServerFilterWidget.tenant=this.options.tenant;n.populate3DSpaceURL().then(function(){var v=n.populateSecurityContext();var w=function t(A){if(r.options.mode=="Applicability"){if(enoviaServerFilterWidget.mode=="3DSpace"){var z=["Change Action","Decision","Change Order"];var x=[];for(var y=0;y<z.length;y++){var B=new Promise(function(G,F){var D="/resources/v0/model/bus/"+r.options.objectid+"?select=type.kindof"+encodeURIComponent("[")+z[y]+encodeURIComponent("]");var E="";var C=function(H){G(H)};n.makeWSCall(D,"GET","enovia","application/json",E,C,F,true)});x.push(B)}Promise.all(x).then(function(D){for(var C=0;C<D.length;C++){if(D[C]["type.kindof[Change Action]"]!=undefined&&D[C]["type.kindof[Change Action]"]=="TRUE"){j.type="Change Action"}if(D[C]["type.kindof[Decision]"]!=undefined&&D[C]["type.kindof[Decision]"]=="TRUE"){j.type="Decision"}if(D[C]["type.kindof[Change Order]"]!=undefined&&D[C]["type.kindof[Change Order]"]=="TRUE"){j.type="Change Order"}if(C==2){if(j.type=="Change Action"){n.populateChangeActionAccess(r.options.objectid)}r.onSecurityContext(A,r)}}},function(C){})}else{j.type="Change Action";n.populateChangeActionAccess(r.options.objectid);r.onSecurityContext(A,r)}}else{if(r.options.mode=="SessionEffectivity"){r.onSecurityContext(A,r)}}};var u=function s(x){};v.then(function(){n.populateDisplayExpressionXSLT();n.checkDecouplingActivation().then(function(x){console.log(x);j.configurationCriteria=x;w()})})})},onSecurityContext:function(p,q){if(q.options.mode=="Applicability"){var r=new Promise(function(v,u){var t=function(x){u(x)};var s=n.getChangeUrl(q.options.objectid,"GET");var w=function(x){v(x)};n.makeWSCall(s,"GET","enovia","application/json","",w,t,true)});r.then(function(t){if(j.type=="Change Action"){q.expressionXml=t.changeaction.applicability.xml;q.showimportCOButton=false;if(t.changeaction.changeorder!=undefined&&t.changeaction.changeorder.id!=undefined&&t.changeaction.changeorder.id!=null){q.showimportCOButton=true;var w=j.type;j.type="Change Order";var s=t.changeaction.changeorder.id.replace("pid:","");var v=n.getChangeUrl(s,"GET");j.type=w;var x=function(y){q.applicabilityCO=y.applicability.xml;if(q.applicabilityCO!=""){q.enableImportButton=true}else{q.enableImportButton=false}q.options.expressionJson=k.EvolutionXMLtoJSONConvertor(q.expressionXml);q.populateModels(q)};var u=function(y){reject(y);q.enableImportButton=true};n.makeWSCall(v,"GET","enovia","application/json","",x,u,true)}else{q.options.expressionJson=k.EvolutionXMLtoJSONConvertor(q.expressionXml);q.populateModels(q)}}else{q.expressionXml=t.applicability.xml;j.ChangeAccessDetails={};j.ChangeAccessDetails.SetApplicability=t.hasEditAccess;q.options.expressionJson=k.EvolutionXMLtoJSONConvertor(q.expressionXml);q.populateModels(q)}},function(s){q.evolutionSpinner.hide();n.showwarning(l.Get_Applicability_Failed,"error")})}else{if(q.options.mode=="SessionEffectivity"){q.options.expressionJson=k.EvolutionXMLtoJSONConvertor(q.options.iXml);q.populateModels(q)}}},populateModels:function(p){var q=new Promise(function(w,v){var t="/search?xrequestedwith=xmlhttprequest";var x=function(y){w(y)};var u={with_indexing_date:true,with_nls:false,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:'(flattenedtaxonomies:"types/Model")',order_by:"desc",order_field:"relevance",nresults:1000,start:"0",source:[],tenant:enoviaServerFilterWidget.tenant};var u=JSON.stringify(u);var s=function(){v()};var r={isfederated:"true"};n.makeWSCall(t,"POST","enovia","application/json",u,x,s,true,r)});q.then(function(r){j.Models=r.results;p.processexpressionJsonForIds(p);if(p.options.mode=="Applicability"){p.options.noModelsErrorMessage=l.Empty_Applicability;p.options.editActionLabel=l.Edit_Applicability;p.options.clearActionLabel=l.Clear_Expression;p.options.removeActionLabel=l.Remove_Model;p.options.emptyContextText=l.emptyContextText_Applicability;p.options.parentElement=p.options.parent;p.options.expressionArray=p.options.expressionJson;p.options.Models=j.Models;p.options.Access=j.ChangeAccessDetails}else{if(p.options.mode=="SessionEffectivity"){p.options.noModelsErrorMessage=l.Empty_SessionEffectivity;p.options.editActionLabel=l.Edit_SessionEffectivity;p.options.clearActionLabel=l.Clear_SessionEffectivity;p.options.removeActionLabel=l.Remove_Model;p.options.emptyContextText=l.emptyContextText_SessionEffectivity;p.options.parentElement=p.options.parent;p.options.expressionArray=p.options.expressionJson;p.options.Models=j.Models}}p.options.editActionCallback=function(t){if(p.options.mode=="Applicability"||p.options.mode=="SessionEffectivity"){p.options.expression=t.get("expression");p.options.selectedmodel=t;p.options.selectedcollection=p.collection;if(p.options.dialogue!=null&&p.options.dialogue!="undefined"&&p.options.dialogue.object!=null&&p.options.dialogue.object!="undefined"){p.options.dialogue.object.resizeDialog()}var u=new Promise(function(z,y){var w="/resources/modeler/browsing/model/getcriteria";var x={version:"1.0.0",modelIds:[{id:"pid:"+p.options.expression.modelId}]};x=JSON.stringify(x);var A=function(B){z(B)};var v=function(B){console.log("fail to get last product evolution")};n.makeWSCall(w,"POST","enovia","application/json",x,A,v,true)});u.then(function(v){require(["DS/CfgEvolutionUX/CfgEvolutionCriteriasDialog"],function(w){p.options.criteriasAvailable=v.criteria[0];var w=new w(p.options);w.render()})})}};p.options.removeModelCallback=function(t){p.collection.removeModel(t);if(p.options.mode=="Applicability"){var v=p.collection.getselectedModelsIDs();p.cfgmodelselector.disableSelection(v);var w=p.collection.getGlobalChangeExpression();w=w.replace(/&(?!amp;)/g,"&amp;");var u=new Promise(function(B,A){var y=function(D){A(D)};var x=n.getChangeUrl(p.options.objectid,"PUT");var C=function(D){B(D)};var z={};if(j.type=="Change Action"){z={version:"v0",changeaction:{modify:{applicability:{xml:w}}}}}else{z={version:"1.0",applicability:{xml:w}}}var z=JSON.stringify(z);n.makeWSCall(x,"PUT","enovia","application/json",z,C,y,true)});u.then(function(x){n.showwarning(l.Save_Successful_Applicability,"success")},function(x){n.showwarning(l.Save_Fail_Applicability,"error")})}else{if(p.options.mode=="SessionEffectivity"){var v=p.collection.getselectedModelsIDs();p.cfgmodelselector.disableSelection(v)}}};p.cfgmodelselector=new m(p.options);p.cfgmodelselector.layout=p;p.cfgmodelselector.render().inject(p.options.parent);p.cfgmodelselector.enableDisableIcons();if(p.options.Access.SetApplicability=="false"){p.cfgmodelselector.hide();p.options.noModelsErrorMessage=l.Empty_Applicability_beyond_active_state}if(p.options.mode=="Applicability"){p.processexpressionsForDescriptionForApplicability();return}p.collection=new c(p.options);p.collection.reset();p.collection.initialising(p.options);p.modelListView=new f(p.options);p.modelListView.render(p.collection);var s=p.collection.getselectedModelsIDs();p.cfgmodelselector.disableSelection(s);j.ModelEvents.subscribe({event:"ModelSelected"},function(t){p.addModel(t)});p.evolutionSpinner.hide()},function(){})},addModel:function(J){var w=this;var z=[];var r=[];var C=[];var G=[];var y="";var q="";var D="";var t="";var H=[];var p="";r=JSON.stringify({builds:r});var B={modelId:J.value,psJson:C,mpJson:G,viewJson:null,iDateJson:{DateRanges:z},iUnitJson:r,xmlExpression:y,iDateXml:D,iUnitXml:t,impXml:q,productstatecheckbox:true,unitcheckbox:true,datestatecheckbox:true,manufacturingplanstatecheckbox:true,milestoneJson:H,milestoneXml:p,milestoneCheckbox:true};var s={};s.expression=B;for(var v=0;v<j.Models.length;v++){var u="";var E=j.Models[v].attributes.length;if(j.Models[v].attributes[0].value==J.value){s.expression.modelId=s.modelId=j.Models[v].attributes[0].value;s.expression.id=s.id=j.Models[v].attributes[0].value;break}}for(var v=0;v<j.Models.length;v++){var E=j.Models[v].attributes.length;for(var F=0;F<E;F++){if(j.Models[v].attributes[0].value==s.expression.id&&j.Models[v].attributes[F].name=="ds6w:label"){s.marketingName=s.expression.marketingName=j.Models[v].attributes[F].value}if(j.Models[v].attributes[0].value==s.expression.id&&j.Models[v].attributes[F].name=="ds6w:identifier"){s.expression.name=s.name=j.Models[v].attributes[F].value}if(j.Models[v].attributes[0].value==s.expression.id&&j.Models[v].attributes[F].name=="ds6w:who/ds6w:responsible/ds6w:originator"){s.expression.owner=s.owner=j.Models[v].attributes[F].value}if(j.Models[v].attributes[0].value==s.expression.id&&j.Models[v].attributes[F].name=="ds6w:what/ds6w:status"){s.expression.state=s.state=j.Models[v].attributes[F].value.replace("Model.","")}}}w.collection.addModel(s);w.modelListView.adjustTileFlexStyles();var I=w.collection.getselectedModelsIDs();w.cfgmodelselector.disableSelection(I);var x=w.collection.getGlobalChangeExpression();x=x.replace(/&(?!amp;)/g,"&amp;");var A=new Promise(function(O,N){var L=function(Q){N(Q)};var K=n.getChangeUrl(w.options.objectid,"PUT");var P=function(Q){O(Q)};var M={};if(j.type=="Change Action"){M={version:"v0",changeaction:{modify:{applicability:{xml:x}}}}}else{M={version:"1.0",applicability:{xml:x}}}var M=JSON.stringify(M);n.makeWSCall(K,"PUT","enovia","application/json",M,P,L,true)})},oniconbar:function(q,p){},processexpressionJsonForIds:function(t){var q=t.options.expressionJson.length;for(var r=0;r<q;r++){var p=t.options.expressionJson[r];for(var u=0;u<j.Models.length;u++){var x="";var v=j.Models[u].attributes.length;for(var s=0;s<v;s++){if(j.Models[u].attributes[s].name=="ds6w:identifier"&&j.Models[u].attributes[s].value==p.expression.name){p.expression.modelId=p.modelId=j.Models[u].attributes[0].value;p.id=j.Models[u].attributes[0].value}}}}for(var w=0;w<q;w++){var p=t.options.expressionJson[w];for(var u=0;u<j.Models.length;u++){var v=j.Models[u].attributes.length;for(var s=0;s<v;s++){if(j.Models[u].attributes[0].value==p.id&&j.Models[u].attributes[s].name=="ds6w:label"){p.expression.marketingName=p.marketingName=j.Models[u].attributes[s].value}if(j.Models[u].attributes[0].value==p.id&&j.Models[u].attributes[s].name=="ds6w:identifier"){p.name=j.Models[u].attributes[s].value}if(j.Models[u].attributes[0].value==p.id&&j.Models[u].attributes[s].name=="ds6w:who/ds6w:responsible/ds6w:originator"){p.owner=j.Models[u].attributes[s].value}if(j.Models[u].attributes[0].value==p.id&&j.Models[u].attributes[s].name=="ds6w:what/ds6w:status"){p.state=j.Models[u].attributes[s].value.replace("Model.","")}}}}},AddModelsFromNative:function(q){var r=q.split(",");for(var p=0;p<r.length;p++){this.addModel({value:r[p],Label:""})}},getGlobalSessiondata:function(){return this.collection.getGlobalSessiondata()},importCOApplicability:function(){var p=this;var q=new Promise(function(v,u){var s=function(x){console.log("import failed");n.showwarning(l.Import_Applicability_FromCO_Failed,"error");u(x)};var r=n.getChangeUrl(p.options.objectid,"PUT");var w=function(x){console.log("import successfull");var y=document.querySelector("#FacetDivForApplicabilityContext");if(enoviaServerFilterWidget.mode=="3DSpace"){y=document.querySelector("#contentAppdiv")}while(y&&y.hasChildNodes()){y.removeChild(y.lastChild)}p.create(p.options);n.showwarning(l.Import_Applicability_FromCO_Successful,"success");v(x)};var t={};if(j.type=="Change Action"){t={version:"v0",changeaction:{modify:{applicability:{xml:p.applicabilityCO}}}}}var t=JSON.stringify(t);n.makeWSCall(r,"PUT","enovia","application/json",t,w,s,true)})},processexpressionsForDescriptionForApplicability:function(){var s=this;console.log(s.options.expressionJson);var s=this;var q=[];for(var r=0;r<s.options.expressionJson.length;r++){var v="products";var u=j.getDictionaryByCriteria(s.options.expressionJson[r].id,v);if(u[v]==null){v="products=1&manufacturingPlans";q.push(n.getDictionaryFromServer(s.options.expressionJson[r].id,v))}}if(s.options.expressionJson.length==0){s.collection=new c(s.options);s.collection.reset();s.collection.initialising(s.options);s.modelListView=new f(s.options);s.modelListView.render(s.collection);var t=s.collection.getselectedModelsIDs();s.cfgmodelselector.disableSelection(t);j.ModelEvents.subscribe({event:"ModelSelected"},function(w){s.addModel(w)});s.evolutionSpinner.hide();return}var p=0;Promise.all(q).then(function(w){w.forEach(function(C){var H="products";j.addDictionaryByCriteria(C.id,C,H);var H="manufacturingPlans";j.addDictionaryByCriteria(C.id,C,H);p++;s.populateDisplayNames(C);for(var B=0;B<s.options.expressionJson.length;B++){var E=s.options.expressionJson[B].expression;if(s.options.expressionJson[B].id!=C.id.replace("pid:","")){continue}var F=E.psJson;var J=[];var z=[];if(F.length!=0){for(var D=0;D<F.length;D++){var I="products"+F[D].start.name+"_"+F[D].start.revision;F[D].start.displayname=s.descriptionMap[C.id][I];z.push('<TreeSeries DescId = "'+I+'" DisplayName="'+F[D].start.displayname+'"></TreeSeries>');for(var A=0;A<F[D].end.length;A++){I="products"+F[D].end[A].name+"_"+F[D].end[A].revision;F[D].end[A].displayname=s.descriptionMap[C.id][I];z.push('<TreeSeries DescId = "'+I+'" DisplayName="'+F[D].end[A].displayname+'"></TreeSeries>')}}}var K=E.mpJson;if(K.length!=0){for(var y=0;y<K.length;y++){var I="manufacturingPlans"+K[y].start.name+"_"+K[y].start.revision;K[y].start.displayname=s.descriptionMap[C.id][I];J.push('<TreeSeries DescId = "'+I+'" DisplayName="'+K[y].start.displayname+'"></TreeSeries>');for(var G=0;G<K[y].end.length;G++){I="manufacturingPlans"+K[y].end[G].name+"_"+K[y].end[G].revision;K[y].end[G].displayname=s.descriptionMap[C.id][I];J.push('<TreeSeries DescId = "'+I+'" DisplayName="'+K[y].end[G].displayname+'"></TreeSeries>')}}}E.psXmlDesc=z;E.mpXmlDesc=J}});s.collection=new c(s.options);s.collection.reset();s.collection.initialising(s.options);s.collection.updatedisplayExpressionsAsPerDisplayNames();s.modelListView=new f(s.options);s.modelListView.render(s.collection);var x=s.collection.getselectedModelsIDs();s.cfgmodelselector.disableSelection(x);j.ModelEvents.subscribe({event:"ModelSelected"},function(y){s.addModel(y)});s.evolutionSpinner.hide()})},populateDisplayNames:function(q){this.tnrArray={};this.tnrArray.type="products";this.rootrevisionarray=[];var p=q.products;this.mainderived(this.rootrevisionarray,p);this.descriptionMap[q.id]={};this.tnrArray.type="manufacturingPlans";this.rootrevisionarray=[];var p=q.manufacturingPlans;this.mainderived(this.rootrevisionarray,p);this.descriptionMap[q.id]=this.tnrArray},mainderived:function(r,p){if(p==undefined||Object.keys(p).length===0&&p.constructor===Object){return}var q={name:p.name,displayname:p.displayValue,revision:p.revision};this.tnrArray[this.tnrArray.type+p.name+"_"+p.revision]=p.displayValue;r.push(q);this.addChildren(q,p.Derived);this.mainderived(r,p["Main Derived"])},addChildren:function(r,q){if(q==""||q==undefined){return}if(r.children==undefined||r.children.length==0){r.children=[]}for(var s=0;s<q.length;s++){var t={name:q[s].name,displayname:q[s].displayValue,revision:q[s].revision};this.tnrArray[this.tnrArray.type+t.name+"_"+t.revision]=t.displayname;r.children.push(t);this.lastrevision=t;this.addChildren(t,q[s].Derived);var p=q[s]["Main Derived"];if(Object.keys(p).length!=0&&p.constructor===Object){this.addChildren(r.children[r.children.length-1],[p])}}}};return o});define("DS/CfgEvolutionUX/CfgModelSelection",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Input/Select","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","UWA/Class/Promise","DS/CfgBaseUX/scripts/CfgUtility"],function(h,e,g,f,d,c,a){var b=f.extend({combobox:null,setup:function(i){this._parent(i)},render:function(){var i=this;if(this.options.Data.length>1){this.combobox=new g({placeholder:false,options:this.options.Data,events:{onChange:function(){var k=i.getcriteriasAvailable(i);k.then(function(l){d.criteriasAvailable=l.criteria[0];console.log(d.criteriasAvailable);var m={value:i.combobox.getValue(),label:i.combobox.getSelection(false),name:i.getSelectedModelName(),criteriasAvailable:d.criteriasAvailable,};d.CurrentFilterModel={model:m};d.ModelEvents.publish({event:"modelUpdated",data:{model:m}})})}}}).inject(this.options.parentElement)}else{var j=new UWA.Element("div",{"class":"wux-control-inline-container",text:this.options.Data[0].label,styles:{"margin-top":"10px"}});j.inject(this.options.parentElement)}},getcriteriasAvailable:function(i){var j=i;var k=new c(function(p,o){var m="/resources/modeler/browsing/model/getcriteria";var r=j.get();var n={version:"1.0.0",modelIds:[{id:"pid:"+r}]};n=JSON.stringify(n);var q=function(s){p(s)};var l=function(s){console.log("fail to get last product evolution")};a.makeWSCall(m,"POST","enovia","application/json",n,q,l,true)});return k},get:function(){if(this.options.Data.length>1){return this.combobox.getValue()}else{return[this.options.Data[0].value]}},getSelectedModelName:function(){var k=this.get();for(var j=0;j<this.options.Data.length;j++){if(this.options.Data[j].value==k){return this.options.Data[j].name}}}});return b});define("DS/CfgEvolutionUX/CfgFilterView",["DS/CfgBaseUX/scripts/CfgUtility","UWA/Drivers/Alone","DS/Core/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CfgBaseUX/scripts/CfgXMLServices","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/UIKIT/UIKIT.css"],function(h,d,e,a,f,b,g,i){var c=a.extend({isLicenseValid:false,toggle:[],init:function(j){this._parent(j);var k=this;h.rolesAvailable(function(l){k.userGrantedRoles=l;if(l.isCFGRoleAvail){k.isLicenseValid=true;k.render();return}if(l.isCSVRoleAvail){k.isLicenseValid=false;return}})},setup:function(j){},render:function(){if(this.isLicenseValid==true){var l=UWA.createElement("div",{});var k=UWA.createElement("div");k.setStyles({width:"auto","float":"left",marginLeft:"0px"});var j=UWA.createElement("div");j.setStyles({width:"auto","float":"left",marginLeft:"10px"});this.toggle[0]=new f({checked:true,name:"ViewOptions",id:"ofcView",value:i.Filter_official_view,className:"primary"}).inject(k);this.toggle[1]=new f({name:"ViewOptions",id:"prjView",value:i.Filter_projected_view,className:"primary"}).inject(j);k.inject(l);j.inject(l);l.inject(this.options.parentElement);if(this.options.viewJson!=null){this.setSelectedView(this.options.viewJson.view)}}},getJSON:function(){return{view:this.getSelectedView()}},getSelectedView:function(){if(this.toggle[0].isChecked()){return"Current"}else{if(this.toggle[1].isChecked()){return"Projected"}}},setSelectedView:function(j){if(j=="Current"){this.toggle[0].check()}else{if(j=="Projected"){this.toggle[1].check()}}}});return c});define("DS/CfgEvolutionUX/CfgEvolutionController",["DS/CfgBaseUX/scripts/CfgModelView","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgBaseUX/scripts/CfgData","DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","css!DS/CfgBaseUX/styles/CfgDialog.css"],function(c,b,e,d,a,f){var g={render:function(h){this.options=h;this.parent=this.options.parent;e.clear();e.ModelEvents=new d();if(this.options.collection.length==1){this.createCriteriasView(this.options.collection.at(0))}else{this.createModelListView()}this.subscribeModelEvents()},createModelListView:function(){this.options.editActionCallback=this.onEditActionCallback;this.createModelViewContainer();this.modelListView=new c(this.options);this.modelListView.render(this.options.collection)},createCriteriasView:function(h){g.options.expression=h.get("expression");var i=this;var j=new Promise(function(o,n){var l="/resources/modeler/browsing/model/getcriteria";var m={version:"1.0.0",modelIds:[{id:"pid:"+i.options.expression.modelId}]};m=JSON.stringify(m);var p=function(q){o(q)};var k=function(q){console.log("fail to get criterias")};a.makeWSCall(l,"POST","enovia","application/json",m,p,k,true)});j.then(function(k){require(["DS/CfgEvolutionUX/CfgEvolutionCriteriaView"],function(o){g.options.criteriasAvailable=k.criteria[0];g.options.selectedmodel=h;g.options.selectedcollection=g.options.collection;i.options.parentElement=g.options.parent;i.options.parentElement.innerHTML="";var q="";var m=f.CFG_Apply;var p=f.CFG_Back;if(i.options.collection.length==1){q=i.onSaveEffectivity;m=f.CFG_Ok;p=f.CFG_Cancel}else{q=i.onUpdateEffectivity}var l=h.get("marketingName")?h.get("marketingName"):h.get("name");var n={isHeader:true,isFooter:true,firstButtonText:m,secondButtonText:p,headerText:l,onButtonClickCB:q,};g.criteriaViewContainer=new b(n).render();g.options.parent=g.criteriaViewContainer._body;g.CfgEvolutionCriteriaView=new o(g.options);g.CfgEvolutionCriteriaView.render();g.criteriaViewContainer.inject(i.options.parentElement)})})},onEditActionCallback:function(h){g.createCriteriasView(h)},onSaveEffectivity:function(h){if(window.enoviaServerFilterWidget.mode=="Native"){if(g.options.collection.length==1){if(g.CfgEvolutionCriteriaView!=undefined){g.CfgEvolutionCriteriaView.onOKHandler("Native")}}var i={modelIdsWithEffectivity:g.options.collection.getEffectivityModelsIDs(),globalEffectivityExpression:g.options.collection.getGlobalEvolutionExpression(),};i=JSON.stringify(i);if(window.enoviaServerFilterWidget.mode=="Native"){if(h.buttonId=="firstButton"){sendNotificationWebInWin("OK",i)}else{sendNotificationWebInWin("Cancel",i)}}}else{if(h.buttonId=="firstButton"){if(g.CfgEvolutionCriteriaView!=undefined){g.CfgEvolutionCriteriaView.onOKHandler()}else{a.showwarning(CfgEvolutionNLS.Save_Successful_Evo_Effectivity,"success")}}g.options.dialogue.object.CfgFloatingPanel.destroy()}},onUpdateEffectivity:function(h){if(h.buttonId=="firstButton"){g.CfgEvolutionCriteriaView.onOKHandler(window.enoviaServerFilterWidget.mode)}g.createModelListView();g.criteriaViewContainer.hide()},subscribeModelEvents:function(){e.ModelEvents.subscribe({event:"LaunchingDictionarySelection"},function(h){g.criteriaViewContainer.hide()});e.ModelEvents.subscribe({event:"ProductStateDialogClosed"},function(h){g.criteriaViewContainer.show()});e.ModelEvents.subscribe({event:"UnitsDialogClosed"},function(h){g.criteriaViewContainer.show()})},createModelViewContainer:function(){var i=this;i.options.parent=i.parent;var h={isHeader:false,isFooter:true,firstButtonText:f.CFG_Ok,secondButtonText:f.CFG_Cancel,headerText:"",onButtonClickCB:i.onSaveEffectivity,};if(g.modelListViewContainer){g.modelListViewContainer.destroy()}g.modelListViewContainer=new b(h).render();g.modelListViewContainer.inject(this.parent);g.options.parentElement=g.modelListViewContainer._body},};return g});define("DS/CfgEvolutionUX/CfgDatePickerUtilities",["UWA/Core","DS/UIKIT/Input/Date","DS/UIKIT/Input/Button","DS/UIKIT/Alert","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(f,e,a,b,c){var d={mainDiv:null,superMainDiv:null,addRange:null,prepareDefaultRange:function(j,h){var g=false;var i=this.superMainDiv;this.mainDiv=f.createElement("div");this.mainDiv.setAttribute("id","MainDiv");this.mainDiv.inject(this.superMainDiv);this.addRange=f.createElement("div");this.addRange.addClassName("addRangeStyles");this.addRange.setAttribute("id","adRange");var l=f.createElement("Label",{html:c.Filter_Date_AddDateRange});l.style.fontWeight="normal";l.inject(this.addRange);this.addRange.inject(this.mainDiv);l.addEventListener("click",function(){d.onAddRange(null,h)});l.addEventListener("mouseover",d.onHyperLink);var k=null;k=d.onAddRange(j,h);if(k==null){g=false}else{g=true}return g},onSingleDate:function(){var k=(this.parentElement).parentElement;var l=k.getElements(".hideOnSingle");var h=k.getElements(".myDateInput");var j;for(j=0;j<l.length;j++){if(l[j].classList.contains("fromDiv")){l[j].style.visibility="hidden";if(document.querySelector("#operations-container")){}l[j].getChildren()[0].setStyle("margin-top","0px")}else{l[j].style.display="none"}}var g=k.getElements(".hideOnDouble");var j;for(j=0;j<g.length;j++){g[j].style.display="inline-block"}d.validate(h[0],h[1],k);if(h[0].value==""){d.styleUtility(h[0],{borderColor:""});d.styleUtility(h[1],{borderColor:""})}},onDoubleDate:function(g,m){var k=m.parentElement;var h=k.getElements(".hideOnSingle");var j;for(j=0;j<h.length;j++){if(h[j].classList.contains("fromDiv")){h[j].style.visibility="visible";if(document.querySelector("#operations-container")){}h[j].getChildren()[0].setStyle("margin-top","20px")}else{if(document.querySelector("#operations-container")){if(h[j].classList.contains("singleDateStyles")){h[j].style.display="inline"}else{h[j].style.display="block"}}else{h[j].style.display="inline-block"}}}var l=k.getElements(".hideOnDouble");for(j=0;j<l.length;j++){l[j].style.display="none"}var o=k.getElements(".myDateInput");var n=o[0].getAttribute("millisec");if(o[0].value.toUpperCase()=="-INF"){o[1].setAttribute("millisec",null);o[1].value=o[0].value.substring(1)}else{if(n!=null&&n!=""&&n!="null"&&n!="undefined"){o[1].setAttribute("millisec",n);o[1].value=o[0].value;g.setDate(new Date(parseInt(n,10)),false)}}d.validate(o[0],o[1],k);if(o[1].value==""&&o[0].value==""){d.styleUtility(o[0],{borderColor:""});d.styleUtility(o[1],{borderColor:""})}},onAddRange:function(q,m){var z=this.addRange;var l=f.createElement("div");l.className="localDiv";l.setStyles=({position:"relative"});var k=f.createElement("div",{"class":"fromDiv"});k.addClassName("hideOnSingle");var o=f.createElement("Label",{html:c.Filter_Date_From});o.setAttribute("id","fromLabelId");if(document.querySelector("#operations-container")){k.setStyles({marginTop:"-20px"})}else{k.setStyles({display:"inline-block",marginRight:"5px"})}o.inject(k);k.inject(l);var F=f.createElement("div",{"class":"datePick1div"});F.addClassName("datePickerContainerStyles");var t=new e({className:"myDateInput",allowTextEdition:"true"});t.elements.input.addEvent("focus",d.focusInOnDatePicker);t.elements.input.addEvent("blur",function(){d.focusOutFromdatePicker(t,this.parentElement,"FROM")});if(q!=null&&q!=undefined){var p=q.millisecStart;t.setDate(new Date(parseInt(p,10)),false)}F.style.display="inline-block";t.inject(F);F.inject(l);var y=f.createElement("span",{"class":"fonticon fonticon-2x fonticon-calendar  "});y.addClassName("calendarIconSpanStyles");var D=f.createElement("div",{"class":"imgCalContainer1"});D.addEventListener("click",d.onCalendarClick);D.addClassName("calendarImgContainerDefaultStyles");D.addClassName("imgFocusIdenty");D.addContent(y);y.inject(D);D.inject(F);var j=f.createElement("div");j.className="hideOnSingle";var v=f.createElement("Label",{html:c.Filter_Date_To});j.setStyles({display:"inline-block",marginRight:"5px"});v.inject(j);j.inject(l);var E=f.createElement("div");E.className="hideOnSingle";E.addClassName("datePickerContainerStyles");var s=new e({placeholder:c.unitInfinity,className:"myDateInput",allowTextEdition:"true"});s.elements.input.addEvent("focus",d.focusInOnDatePicker);s.elements.input.addEvent("blur",function(){d.focusOutFromdatePicker(s,this.parentElement,"TO")});if(q!=null&&q!=undefined){var p=q.millisecEnd;s.setDate(new Date(parseInt(p,10)),false)}E.style.display="inline-block";s.inject(E);E.inject(l);var x=f.createElement("span",{"class":"fonticon fonticon-2x fonticon-calendar  "});x.addClassName("calendarIconSpanStyles");var B=f.createElement("div",{"class":"imgCalContainer2"});B.addEventListener("click",d.onCalendarClick);B.addClassName("calendarImgContainerDefaultStyles");B.addClassName("imgFocusIdenty");B.addContent(x);x.inject(B);B.inject(E);var i=f.createElement("p");var r=f.createElement("Label",{html:c.Filter_Date_SingleDate,"class":"singleDateLbl"});r.style.fontWeight="normal";i.className="hideOnSingle";i.addClassName("singleDateStyles");r.inject(i);i.inject(l);r.addEventListener("click",d.onSingleDate);r.addEventListener("mouseover",d.onHyperLink);var g=f.createElement("p");g.className="hideOnDouble";g.addClassName("dateRangeStyles");var u=f.createElement("Label",{html:c.Filter_Date_DateRange});u.style.fontWeight="normal";u.addEventListener("click",function(){d.onDoubleDate(s,this.parentElement)});u.addEventListener("mouseover",d.onHyperLink);u.inject(g);g.inject(l);g.style.display="none";var h=f.createElement("span",{"class":"fonticon fonticon-2x fonticon-cancel-circled "});h.addClassName("cfgcancel");h.addClassName("cfgcancelhover");h.setStyles({display:"inline-block"});var w=f.createElement("div",{"class":"imgContainer",id:"removeRangeIcon"});var n=this;w.addEventListener("click",function(){var G=n.mainDiv;var I=G.getElements(".localDiv");var H=this.parentElement;G.removeChild(H);var I=G.getElements(".localDiv");if(I.length==1){I[0].getElements(".imgContainer")[0].style.display="none"}});w.addEventListener("mouseover",d.onHyperLink);w.addClassName("removeIconImgContainerStyles");w.addContent(h);h.inject(w);w.inject(l);l.inject(z,"before");var C=this.mainDiv.getElements(".localDiv");if(C.length==1){w.style.display="none"}else{var A=C[0].getElements(".imgContainer")[0];A.style.display="inline-block"}if(q==null&&m=="SingleDate"){r.click()}return l},SetDateByJSON:function(w,s){var u=false;var p=w.DateRanges;var n=null;if(p.length>0){n=p[0]}var k=this.superMainDiv;this.prepareDefaultRange(n,s);var h=this.mainDiv;var q;for(q=0;q<p.length;q++){u=false;var v=null;if(q!=0){n=p[q];v=d.onAddRange(n,s)}else{v=h.getElement(".localDiv")}if(v==null){return u}else{u=true}var m=v.getElements(".myDateInput");var o;for(o=0;o<m.length;o++){if(o==0){var g=p[q].Start;var t=p[q].millisecStart;m[o].value=g;m[o].setAttribute("millisec",t)}if(o==1){var r=p[q].End;var t=p[q].millisecEnd;if(r=="null"){var l=v.getElement(".singleDateLbl");l.click()}else{m[o].value=r;m[o].setAttribute("millisec",t)}}}}n=null;return u},focusOutFromdatePicker:function(l,n,h){var o=n;var p=o.parentElement;var m=p.getElements(".myDateInput");var g=p.getElements(".imgFocusIdenty");var r;var j=null;var q=l.getDate();if(q!=null&&q!="undefined"){j=q.getTime()}if(h=="FROM"){m[0].setAttribute("millisec",j)}else{if(h=="TO"){m[1].setAttribute("millisec",j)}}r=d.validate(m[0],m[1],p);var k;for(k=0;k<g.length;k++){if(g[k].hasClassName("calendarImgContainerClickStyles")){g[k].toggleClassName("calendarImgContainerClickStyles")}}if(p.getElements(".hideOnSingle")[1].style.display=="none"&&m[0].value==""){d.styleUtility(m[0],{borderColor:""})}else{if(m[0].value==""&&m[1].value==""){d.styleUtility(m[0],{borderColor:""});d.styleUtility(m[1],{borderColor:""})}}},onHyperLink:function(){this.style.cursor="pointer"},focusInOnDatePicker:function(){var i=this.parentElement;var h=i.parentElement;var g;if(i.hasClassName("hideOnSingle")){g=h.getElements(".imgFocusIdenty")[1]}else{g=h.getElements(".imgFocusIdenty")[0]}g.toggleClassName("calendarImgContainerClickStyles")},onCalendarClick:function(){var g=this.parentElement;var h=f.extendElement(g).getElement(".myDateInput");h.click()},validate:function(k,i,p){var j=k.getAttribute("millisec");var h=i.getAttribute("millisec");if(j==null||j==""){j=NaN}if(h==null||h==""){h=NaN}var o=k.value;var n=i.value;var g=p.getElements(".imgFocusIdenty");var l=p.getElements(".myDateInput");var m=p.getElements(".fonticon-cancel-circled");this.styleUtility(l[0],{borderColor:""});this.styleUtility(l[1],{borderColor:""});this.styleUtility(m[0],{color:""});if(p.getElements(".hideOnSingle")[1].style.display=="none"){if(!isNaN(j)){this.styleUtility(l[0],{borderColor:""});return true}else{if(o!=""){this.styleUtility(l[0],{borderColor:"red"});this.styleUtility(m[0],{color:"red"});this.showAlert(p,c.Filter_Date_Alert_OnlyDateIsAllowed);this.styleUtility(l[0],{borderColor:"red"});return false}}}if(isNaN(j)){if(!(o==""||o.toUpperCase()=="-INF")){this.showAlert(p,c.Filter_Date_Alert_OnlyNegativeINFIsAllowed);this.styleUtility(l[0],{borderColor:"red"});this.styleUtility(m[0],{color:"red"});this.styleUtility(l[1],{borderColor:""});return false}}if(isNaN(h)){if(!(n==""||n.toUpperCase()=="INF")){this.showAlert(p,c.Filter_Date_Alert_OnlyINFIsAllowed);this.styleUtility(l[0],{borderColor:""});this.styleUtility(l[1],{borderColor:"red"});this.styleUtility(m[0],{color:"red"});return false}}if((o.toUpperCase()=="-INF")&&(n.toUpperCase()=="INF")){return true}if((o==""||o.toUpperCase()=="-INF")&&(n==""||n.toUpperCase()=="INF")){if(o==""){if(n==""){this.styleUtility(l[0],{borderColor:""});this.styleUtility(l[1],{borderColor:""})}else{if(n.toUpperCase()=="INF"){this.styleUtility(l[0],{borderColor:"red"});this.styleUtility(m[0],{color:"red"});this.styleUtility(l[1],{borderColor:""})}}}if(o.toUpperCase()=="-INF"){if(n==""){this.styleUtility(l[0],{borderColor:""});this.styleUtility(l[1],{borderColor:"red"});this.styleUtility(m[0],{color:"red"})}else{if(n.toUpperCase()=="INF"){this.styleUtility(l[0],{borderColor:"red"});this.styleUtility(l[1],{borderColor:"red"});this.styleUtility(m[0],{color:"red"})}}}return false}if(isNaN(j)){if(!isNaN(h)){this.styleUtility(l[0],{borderColor:""});this.styleUtility(l[1],{borderColor:""});return true}else{}}else{if(!isNaN(h)){var q=h-j;if(q>0||q==0){this.styleUtility(l[0],{borderColor:""});this.styleUtility(l[1],{borderColor:""});return true}else{this.styleUtility(l[0],{borderColor:"red"});this.styleUtility(l[1],{borderColor:"red"});this.styleUtility(m[0],{color:"red"});this.showAlert(p,c.Filter_Date_Alert_From_Is_Greater_Than_To);return false}}else{if(n==""||n.toUpperCase()=="INF"){this.styleUtility(l[0],{borderColor:""});this.styleUtility(l[1],{borderColor:""});return true}}}},showAlert:function(j,l){j.style.position="relative";var m=new b({visible:true,autoHide:true,hideDelay:2000}).inject(j);try{var k=j.getElements(".alert");for(var h=0;h<k.length;h++){this.styleUtility(k[h],{position:"absolute",top:"35px",left:"10%",})}m.add({className:"error",message:l})}catch(g){console.log(g)}},styleUtility:function(g,h){g.setStyles(h)}};return d});define("DS/CfgEvolutionUX/CfgEvolutionUtils",["UWA/Core","DS/CfgBaseUX/scripts/CfgEvolutionRange","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgUtility"],function(e,d,c,a,b){return{getEvolutionDisplayExpression:function(h,l,k){var j=this.GetEvolutionExpressionAndJson(h);var i=j.xml;var g="";if(i.search("TreeSeries")==-1&&i.search("MilestonesTrack")==-1){if(k=="PRODUCTS"){g=a.buildTreeSeries("ProductState",l,i)}else{if(k=="MANUFACTURINGPLAN"){g=a.buildTreeSeries("ManufPlan",l,i)}}}else{g=i}var f="";if(j.description){f=a.startEvolutionXML()+g+"</Expression><Description>"+j.description+"</Description></CfgEffectivityExpression>"}else{f=a.startFilterXML()+g+a.endFilterXML()}return b.getDisplayExpressionUsingXSLT(f)},GetEvolutionExpressionAndJson:function(l){var n={xml:"",json:[]};if(l){var f=l.getRoots()[0];if(f){var i=[];if(f.isSelected()==true&&(f.__LISTVIEWCOPY__.options.grid.range=="")){var o=f.options.name;var k=f.options.revision;var m=f.options.displayname?f.options.displayname:f.options.label;var h=d.getRange(o,k,m);i.push(h)}var g=null;this.parseEffectivity(g,f,i,l);var j=this.buildFilterXML(i);n.xml=j.xml;n.json=i;n.description=j.descTag}}return n},buildFilterXML:function(g){var h="";if(window.DescriptionCount==undefined){window.DescriptionCount=1}var f={iCount:window.DescriptionCount,iDescriptionTag:[]};for(var i=0;i<g.length;i++){h=h+g[i].buildXML(f);f.iCount++;window.DescriptionCount++}return{xml:h,descTag:f.iDescriptionTag}},parseEffectivity:function(u,q,j,f){if(!q){return}if(q.isSelected()==true&&(q.__LISTVIEWCOPY__.options.grid.range!="")&&u==null){var l=q.options.name;var A=q.options.revision;var n=q.options.displayname?q.options.displayname:q.options.label;u=d.getRange(l,A,n,true);j.push(u)}var m=q.getChildren();if(m===null||m===undefined){m=[]}var g=q;var v=q.isRoot();var B=null;if(v==true){var t=f.getAllDescendants();var z=t.length;var h=0;for(var x=0;x<z;x++){var o=t[x];var v=o.isRoot();if(h==1&&v==true){B=o;break}if(v==true&&q.options.name==o.options.name&&q.options.revision==o.options.revision){h=1}}}var z=m.length;for(var x=0;x<=z;x++){var s=null;if(x==z){if(B!=null){s=B}else{continue}}if(s==null){s=m[x]}if(s.options.label==""&&s.options.isEmpty==true){continue}var k="";if(s.isSelected()==true&&(s.__LISTVIEWCOPY__.options.grid.range!="")){k="infinity"}else{if(s.isSelected()==false){k="unselected"}else{if(s.isSelected()==true&&(s.__LISTVIEWCOPY__.options.grid.range=="")){k="selected"}}}if((k=="unselected"||k=="selected")&&u!=null){var w=true;if(k=="selected"){w=false}var C=s.options.name;var p=s.options.revision;var n=s.options.displayname?s.options.displayname:s.options.label;u.addLeaves(C,p,n,w);var y=null;this.parseEffectivity(y,s,j,f)}else{if(k=="infinity"&&u!=null){this.parseEffectivity(u,s,j,f)}else{if(k=="unselected"&&u==null){var y=null;this.parseEffectivity(y,s,j,f)}else{if(k=="infinity"&&u==null){var y=null;this.parseEffectivity(y,s,j,f)}else{if((k=="selected")&&u==null){var C=s.options.name;var p=s.options.revision;var n=s.options.displayname?s.options.displayname:s.options.label;var r=d.getRange(C,p,n,false);j.push(r);var r=null;this.parseEffectivity(r,s,j,f)}}}}}}},mainderived:function(l,f,j,h,g){if(f==undefined||Object.keys(f).length===0&&f.constructor===Object){return}var i=false;if((f.current=="Obsolete"||f.current=="Release"||f.current=="Review")&&g!="FILTER"){i=true}var m=f.displayValue;if(m==undefined||m==null||m.length==0){m=f.name}var k={label:m,image:f.image,name:f.name,displayname:m,originated:f.originated,data:{frozen:i},icons:[],revision:f.revision,current:f.current_NLS,grid:{revision:f.revision},id:f.id,parentid:j,input:h};l.push(k);this.addChildren(k,f.Derived,f.id,"Derivation",g);this.mainderived(l,f["Main Derived"],f.id,"Revision",g)},addChildren:function(k,o,g,l,i){if(o==""||o==undefined){return}if(k.children==undefined||k.children.length==0){k.children=[]}for(var j=0;j<o.length;j++){var f=false;if((o[j].current=="Obsolete"||o[j].current=="Release"||o[j].current=="Review")&&i!="FILTER"){f=true}var n=o[j].displayValue;if(n==undefined||n==null||n.length==0){n=o[j].name}var h={label:n,image:o[j].image,name:o[j].name,displayname:n,originated:o[j].originated,data:{frozen:f},revision:o[j].revision,current:o[j].current_NLS,grid:{revision:o[j].revision},id:o[j].id,parentid:g,input:l};k.children.push(h);this.addChildren(h,o[j].Derived,h.id,"Derivation",i);var m=o[j]["Main Derived"];if(Object.keys(m).length!=0&&m.constructor===Object){this.addChildren(k.children[k.children.length-1],[m],k.children[k.children.length-1].id,"Revision",i)}}},createMapData:function(f){var k=[];var h=this;this.parentForMapData=null;function j(p,m){if(m){if(e.typeOf(m)==="object"){if(Object.keys(m).length!==0){var o={};o.versionType=m.versionType;o.label=m.name;o.revision=m.revision;o.parent=h.parentForMapData;h.parentForMapData=m.revision;o.children=[];p.push(o);if(m.Derived.length>0){for(var n=0;n<m.Derived.length;n++){var l={};l.versionType=m.Derived[n].versionType;l.label=m.Derived[n].name;l.revision=m.Derived[n].revision;h.parentForDerived=h.parentForDerived?h.parentForDerived:h.parentForMapData;if(m.Derived[n].versionType==="Revision"){h.prevDerivedVersion=h.prevDerivedVersion?h.prevDerivedVersion:h.parentForMapData;l.parent=h.prevDerivedVersion}else{l.parent=h.parentForDerived}h.prevDerivedVersion=m.Derived[n].revision;l.children=[];p[p.length-1].children.push(l);j(l.children,m.Derived[n]["Main Derived"])}}j(o.children,m["Main Derived"])}}}}j(k,f);var i=g(k,null);function g(n,m){var o=n;for(var l=0;l<o.length;l++){o[l]["parent"]=m;g(o[l].children,o[l].revision)}return n}return i}}});define("DS/CfgEvolutionUX/CfgUnit",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Input/Text","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","UWA/Class/View","UWA/Controls/Input","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","DS/UIKIT/Alert","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgEvolutionUX/CfgUnitMilestoneLayout","DS/UIKIT/Mask","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(f,k,b,d,a,l,h,j,g,e,i,c){var m=a.extend({textBox:null,textdiv:null,currentDictionary:null,currentModel:null,setup:function(n){this._parent(n)},render:function(){var n=this;this.textdiv=UWA.createElement("div",{id:"textDiv",styles:{width:"100%","font-weight":"normal"}}).inject(this.options.parentElement);this.textBox=new b({id:"textbox",placeholder:false,attributes:{events:{keyup:function(r){var q=r.keyCode;var p=false;p=(r.keyCode==8||r.keyCode==46)?false:true;if(p){if(n.textBox.getValue().endsWith(",")){n.textBox.setValue(n.textBox.getValue()+" ")}}var o=n.validate();if(n.ExpressionMode&&o==true){n.fields=n.textBox.getValue().replace(/\s*,\s*/g,",").split(",");n.allRoots.forEach(function(s){s.unselect()});i.buildOrderSequence(n.fields)}},}}}).inject(this.textdiv);this.label=UWA.createElement("Label",{html:d.Filter_UnitLabel,styles:{"font-weight":"normal"}}).inject(this.textdiv);this.editButton=UWA.createElement("span",{"class":"fonticon fonticon-search ",styles:{position:"relative",right:"0px",bottom:"62px","float":"right"}}).inject(this.options.parentElement);this.editButton.set({events:{click:function(o){if(n.editButton.hasClassName("disableButton")==true){return}if(n.validate()){if(n.options.invokeFrom=="Filter"){c.mask(n.options.filterParent)}n.onUnitSelectionDialogLaunched(o,n)}}}});this.editButton.addClassName("fonticon");this.editButton.addClassName("fonticon-1.5x");this.editButton.addClassName("fonticon-search");this.editButton.addClassName("searchbutton");h.ModelEvents.subscribe({event:"UnitsDialogClosed"},function(o){n.selectionBuilds(o)});h.ModelEvents.subscribe({event:"modelUpdated"},function(o){if(o.noEvolutionUpdate==undefined){n.updateDictionary(o)}});return this},updateDictionary:function(s){c.mask(h.renderTo);var p=s;this.currentModel=p;var o="";if(p.model.value.constructor==Array){o=p.model.value[0]}else{o=p.model.value}var r=h.getDictionaryByCriteria(o,"builds");if(r.builds==null){var q=j.getDictionaryFromServer(o,"builds");var n=this;q.then(function(t){h.addDictionaryByCriteria(o,t,"builds");n.currentDictionary=h.getDictionaryByCriteria(o,"builds");n.checkingcurrentDictionary();c.unmask(h.renderTo)})}else{this.currentDictionary=r;this.checkingcurrentDictionary();c.unmask(h.renderTo)}},checkingcurrentDictionary:function(){var o=[];var n=this.currentDictionary.builds;i.rootBuildsData(o,n);if(n==null||n.length==0){this.textBox.setValue("");this.editButton.addClassName("disableButton");this.textBox.setDisabled(true)}else{this.editButton.removeClassName("disableButton");this.textBox.setDisabled(false)}return},selectionBuilds:function(q){if(q.model===null){return}var p=this;this.arr=[];this.Final="";var n=false;var r=false;q.model.forEach(function(t){var s=parseInt(t);p.arr.push(s);p.arr.sort(function(v,u){if(!isFinite(v-u)){return !isFinite(v)?1:-1}else{return v-u}})});for(var o=0;o<this.arr.length;o++){if((isFinite(this.arr[o])==false)||(n&&isFinite(this.arr[o+1])==false)&&(o+1<this.arr.length)){var r=true;break}if(!n){this.Final=this.Final+this.arr[o]}if(((parseInt(this.arr[o]))+1)==parseInt(this.arr[o+1])){if(!n){this.Final=this.Final+"-";n=true}}else{if(n){this.Final=this.Final+this.arr[o]+",";n=false}else{this.Final=this.Final+","}}}this.Final=this.Final.slice(0,-1);if(r){this.Final=this.Final+"+"}this.textBox.setValue(this.Final.replace(/\s*,\s*/g,", "));return this.Final.replace(/\s*,\s*/g,", ")},onUnitSelectionDialogLaunched:function(t,o){var p={};var q=this;q.fields=o.textBox.getValue().replace(/\s*,\s*/g,",");var r="";if(o.currentModel.model.value.constructor==Array){r=o.currentModel.model.value[0]}else{r=o.currentModel.model.value}var n;var s=h.renderTo.getElements(".cfgEvoCritModalVariableHeight");if(s!==undefined&&s.length>0){n=s[0].parentElement}else{if(h.renderTo!==undefined&&h.renderTo!=null){n=h.renderTo}else{n=h.renderTo.getElements(".modal-content")[0]}}c.mask(n);o.currentDictionary=h.getDictionaryByCriteria(r,"builds");p.mode=o.options.mode;p.invokeFrom=o.options.invokeFrom;p.filterParent=o.options.filterParent;p.rangeEnable="";c.unmask(n);if(o.options.parentElement.className.indexOf("filter")!=0){p.rangeEnable=true}h.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}});i.create(this.currentDictionary,q.fields,this.currentModel,p)},show:function(){this.textBox.show();this.label.show();this.editButton.show()},hide:function(){this.textBox.hide();this.label.hide();this.editButton.hide()},getJson:function(){if(this.textBox.getValue()==""){var o={builds:[]};var s=JSON.stringify(o);return s}if(this.validate()==false){return}var t=this.textBox.getValue().replace(/\s*,\s*/g,",").split(",");var o={builds:[]};for(var r=0,u=t.length;r<u;r++){var q=t[r].indexOf("-");var v=t[r].indexOf("+");if(q!==-1||v!==-1){if(q!==-1){var w=t[r].split("-")}if(v!==-1){var w=t[r].split("+")}if(w[1]==""){var p={start:{buildOrder:w[0]},end:{buildOrder:"INF"}};o.builds.push(p)}else{var p={start:{buildOrder:w[0]},end:{buildOrder:w[1]}};o.builds.push(p)}}else{var n={start:{buildOrder:t[r]},end:null};o.builds.push(n)}}var s=JSON.stringify(o);return s},SetJson:function(o){if(o===undefined||o==null){return}var v=JSON.parse(o);var t=v.builds;var p=[];for(var q=0;q<t.length;q++){var n=t[q].start.buildOrder;var s=t[q].end;if(s!=null){var r=s.buildOrder}if(s==null){p.push(n)}else{if(r=="INF"){p.push(n+"+")}else{p.push(n+"-"+r)}}}var u="";for(var q=0;q<p.length;q++){if(q==0){u=p[0]}else{u=u+","+p[q]}}this.textBox.setValue(u);return u},buildUnitXML:function(r){if(this.validate()==false){return}var v=this.textBox.getValue().replace(/\s*,\s*/g,",").split(",");if(v==""){return""}var s=[];var p="";for(var t=0,w=v.length;t<w;t++){var o=v[t].indexOf("-");var x=v[t].indexOf("+");if(o!==-1||x!==-1){if(o!==-1){var y=v[t].split("-")}if(x!==-1){var y=v[t].split("+")}var n=y[0];var B=y[1];var A=e.buildFrom(n);var D=e.buildTo(B);var q=e.buildRange(A,D);if(t==0){p=q}else{p=p+q}}else{var z=v[t];var C=e.buildSingleValue(z);if(t==0){p=C}else{p=p+C}}}var u=e.buildSeries("Unit",r,p);return u},validate:function(){var w="";if(this.currentModel==null){return}if(this.currentModel.model.value.constructor==Array){w=this.currentModel.model.value[0]}else{w=this.currentModel.model.value}this.currentDictionary=h.getDictionaryByCriteria(w,"builds");this.checkingcurrentDictionary();var p=true;if(this.textBox.getValue()==""){this.alertStatus(p);return p}if(this.textBox.getValue()==", "){var p=false;this.alertStatus(p);return p}var r=this.textBox.getValue().replace(/\s*,\s*/g,",").split(",");if((this.textBox.getValue()).indexOf(".")!=-1){p=false}else{var r=this.textBox.getValue().replace(/\s*,\s*/g,",").split(",");for(var q=0,o=r.length;q<o;q++){if(p==false){break}var n=r[q].indexOf("-");if(n!==-1&&r[q]!="-"){var v=r[q].split("-");var s=v.length;var u=parseInt(v[0]);var t=parseInt(v[1]);if(t!=v[1]){p=false;break}if(r[q].indexOf("-")&&isNaN(t)||isNaN(u)){p=false;break}if((!isNaN(u))&&(!isNaN(t))&&(u<t)&&t!=null&&s==2){if(this.isPresent(u,this.currentDictionary)==true){p=this.isPresent(t,this.currentDictionary)}else{p=false}}else{if((!isNaN(u))&&(!isNaN(t))){if(u==t||u>t){p=false;break}}else{if(!isFinite(u)&&isFinite(u)){var x=v[1];if(x==""){p=true}else{p=false}}}}}else{var n=r[q].indexOf("+");if(n!==-1&&r[q]!="+"){var v=r[q].split("+");var s=v.length;var u=parseInt(v[0]);var t=parseInt(v[1]);if(!isNaN(u)&&isNaN(t)){if(this.isPresent(u,this.currentDictionary)==true){p=true}else{p=false;break}}else{p=false;break}}else{p=this.isPresent(r[q],this.currentDictionary);if(p==false){break}}}}}this.alertStatus(p);return p},alertStatus:function(n){if(!n){if(this.alert!=null){this.alert.hide()}this.alert=new g({visible:true,autoHide:true,hideDelay:3500}).inject(this.options.parentElement,"top");this.textBox.elements.input.addClassName("AlertStyles");this.alert.elements.container.addClassName("CfgAlert");this.alert.add({className:"error",style:{position:"absolute"},message:d.Filter_UnitAlert+this.buildUnitNumbers()})}else{if(n){this.textBox.elements.input.removeClassName("AlertStyles")}}return},buildUnitNumbers:function(){var r=new Array(this.currentDictionary.builds.length);for(var o=0;o<this.currentDictionary.builds.length;o++){r[o]=parseInt(this.currentDictionary.builds[o].buildOrder,10)}r.sort(function(v,u){return v-u});var p="";var t=null;var q=null;var s=null;var n=null;for(var o=0;o<r.length;o++){t=r[o];if(o==0){s=t;continue}else{q=r[o-1]}if((t-q)>1){n=q;if(s==n){p=s+","}else{p+=s+"-"+n+","}s=t}else{n=t}}if(s!=null){p+=s}if(n!=null){p+="-"+n}return p},initialiseComponent:function(){this.currentModel={model:{label:[this.options.expression.name],value:this.options.expression.modelId}};var o="";if(this.currentModel.model.value.constructor==Array){o=this.currentModel.model.value[0]}else{o=this.currentModel.model.value}var q=h.getDictionaryByCriteria(o,"builds");if(q.builds==null){var p=j.getDictionaryFromServer(o,"builds");var n=this;p.then(function(r){h.addDictionaryByCriteria(o,r,"builds");n.currentDictionary=h.getDictionaryByCriteria(o,"builds");n.checkingcurrentDictionary()})}else{this.currentDictionary=q;this.checkingcurrentDictionary()}},isPresent:function(q,n){var o=false;for(var p=0;p<this.currentDictionary.builds.length;p++){var r=this.currentDictionary.builds[p];if(r.buildOrder==q||q==""){o=true}}return o}});return m});define("DS/CfgEvolutionUX/CfgEditEvolutionLayout",["DS/CoreEvents/ModelEvents","DS/CfgEvolutionUX/CfgEvolutionController","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgCollection","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","DS/UIKIT/Spinner","DS/UIKIT/Mask","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(a,f,j,h,e,b,i,c,d){var g={modelListView:null,empty_models:null,updateModelEffectivity:function(){var m=this;m.options.expressionJson=h.EvolutionXMLtoJSONConvertor(m.options.dialogue.effExpressionXml);var l=m.options.expressionJson.length;for(var k=0;k<l;k++){var n=m.options.expressionJson[k];m.collection.forEach(function(p){if(p.get("name")==n.expression.name){n.expression.modelId=n.modelId=p.get("id");var o=m.options.emptyContextText;if(n.displayexpression==null||n.displayexpression==undefined||n.displayexpression==""){o=m.options.emptyContextText}else{o=n.displayexpression}p.set("displayexpression",o);p.set("expression",n.expression)}})}},getAttributeValue:function(k,m){var n="";for(var l=0;l<k.length;l++){if(k[l].name==m){n=k[l].value;if(n==null||n=="undefined"){n=""}break}}return n},initModelsWithNoEffectivity:function(){var s=this;s.expressionXml="";s.options.expressionArray=[];this.empty_models=new Array();for(var p=0;p<s.options.modelList.length;p++){var n=s.options.modelList[p];var q={marketingName:s.getAttributeValue(n.data,"Marketing Name"),name:s.getAttributeValue(n.basicData,"name"),image:n.preview_url,icon:"",id:n.physicalID,state:s.getAttributeValue(n.basicData,"current"),owner:s.getAttributeValue(n.basicData,"owner"),expression:"",displayexpression:""};var m=[];var l=[];var r=[];var o=[];var u="";var v="";var y="";var k="";var w=[];var x="";l=JSON.stringify({builds:l});var t={modelId:q.id,psJson:r,mpJson:o,viewJson:null,iDateJson:{DateRanges:m},iUnitJson:l,xmlExpression:u,iDateXml:y,iUnitXml:k,impXml:v,productstatecheckbox:true,unitcheckbox:true,datestatecheckbox:true,manufacturingplanstatecheckbox:true,milestoneJson:w,milestoneXml:x,milestoneCheckbox:true,name:q.name,marketingName:q.marketingName};q.expression=t;s.empty_models.push(q)}s.collection=new b(s.options);s.collection.reset();for(var p=0;p<s.empty_models.length;p++){s.collection.addModel(s.empty_models[p])}},initEditEvolution:function(){enoviaServerFilterWidget.mode=this.options.environment;enoviaServerFilterWidget.tenant=this.options.tenant;var k=this;j.populateDisplayExpressionXSLT().then(function(l){e.Models=k.options.modelList;k.options.Models=e.Models;k.options.noModelsErrorMessage="";k.options.editActionLabel=i.Edit_Evo_Effectivity;k.options.emptyContextText=i.emptyContextText_Evo_Effectivity;k.initModelsWithNoEffectivity();if(k.options.dialogue.hasEffectivity==true){k.updateModelEffectivity()}k.options.collection=k.collection;f.render(k.options);k.evolutionSpinner.hide()})},create:function(k){this.options=k;var l=this;e.clear();e.ModelEvents=new a();l.evolutionSpinner=new c({className:"evolutionSpinner"}).inject(l.options.parent);l.evolutionSpinner.spin();l.evolutionSpinner.show();j.checkDecouplingActivation().then(function(m){console.log(m);e.configurationCriteria=m;l.initEditEvolution()})},};return g});define("DS/CfgEvolutionUX/CfgProductManufacturingPlanLayout",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Modal","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","DS/Tree/TreeListView","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgBaseUX/scripts/CfgData","DS/UIKIT/Input/Toggle","DS/WebappsUtils/WebappsUtils","DS/CfgBaseUX/scripts/CfgEvolutionRange","DS/CfgFilterUX/CfgFilterSlideInComponent","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","DS/UIKIT/Tooltip","DS/CfgEvolutionUX/CfgEvolutionUtils","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(c,i,j,e,g,o,f,l,b,h,p,d,k,m,n){var a={iAmSelecting:false,create:function(s){var t=this;this.frozenrowids=[];t.rootrevisionarray=[];var r=null;t.opts=s;var q=JSON.parse(n);if(s.mode=="PRODUCTS"){if(q.isVersionGraphAvailable&&q.isVersionGraphAvailable===true){t.opts.root=s.data.products;t.buildVersionGraph()}else{r=s.data.products;t.mainderived(t.rootrevisionarray,r);t.build(s)}}else{if(s.mode=="MANUFACTURINGPLAN"){if(q.isVersionGraphAvailable&&q.isVersionGraphAvailable===true){t.opts.root=s.data.manufacturingPlans;t.buildVersionGraph()}else{r=s.data.manufacturingPlans;t.mainderived(t.rootrevisionarray,r);t.build(s)}}else{if(s.mode=="MILESTONES"){r=s.data.milestones;t.mainderivedMilestones(t.rootrevisionarray,r);t.build(s)}}}},buildVersionGraph:function(){this.opts.rootrevisionarray=[];m.mainderived(this.opts.rootrevisionarray,this.opts.root,this.opts.root.id,"Revision",this.opts.use);this.MainContainer=new UWA.Element("div",{styles:{height:"100%",width:"100%"}});this.MainContainer.setAttribute("id","MainPrdContainer");var q=this;require(["DS/CfgVersionGraphUX/scripts/CfgVersionGraph"],function(r){q.versionGraph=new r(q.opts);q.versionGraph.render();q.versionGraph.getCfgToolbarContainer().inject(q.MainContainer);q.versionGraph.getVersionGraphContainer().inject(q.MainContainer);q.versionGraph.getCfgExpressionContainer().inject(q.MainContainer);q.buildContainers();if(q.opts.appEnv!="3DSpace"&&q.opts.appUse=="Applicability"){document.getElementsByClassName("cfgToggleHolder")[0].setAttribute("style","margin-top:5px")}document.querySelector(".CfgExpressionContainer").getElementsByClassName("fonticon-resize-full")[0].setAttribute("style","font-size:20px !important;color:#b4b6ba;")})},buildContainers:function(){var v=this;var t="";if(v.opts.mode=="PRODUCTS"){t=e.Filter_Dialog_Product}else{if(v.opts.mode=="MANUFACTURINGPLAN"){t=e.Filter_Dialog_ManufacturingPlan}}if(v.opts.use==""){var s=function(y){if(y.buttonId=="firstButton"){var x=v.versionGraph.getEvolutionExpressionAndJson();f.ModelEvents.publish({event:"ProductStateDialogClosed",data:{model:null,xml:x.xml,json:x.json,xmlDesc:x.description,mode:v.opts.mode}})}else{if(y.buttonId=="secondButton"){f.ModelEvents.publish({event:"ProductStateDialogClosed",data:{mode:""}})}}v.containerView.destroy()};var r={isHeader:true,isFooter:true,firstButtonText:e.CFG_Apply,secondButtonText:e.CFG_Back,headerText:t,onButtonClickCB:s,};v.containerView=new o(r).render();v.containerView.inject(f.renderTo);v.MainContainer.inject(v.containerView._body)}else{if(v.opts.use=="EFFECTIVITY"){v.dialog=new j({className:"cfg-site-reset",closable:true,header:"<h4>"+t+"</h4>",body:v.MainContainer,footer:'<button type="button" class="btn btn-primary">'+e.Filter_Apply+'</button> <button type="button" class="btn btn-default">'+e.Filter_Cancel+"</button>",events:{onHide:function(){v.dialog.destroy()}}}).inject(f.renderTo);v.dialog.show();v.dialog.getContent().getElements(".btn-primary").forEach(function(x){x.addEvent("click",function(){var y=v.versionGraph.getEvolutionExpressionAndJson();f.ModelEvents.publish({event:"ProductStateDialogClosed",data:{model:null,xml:y.xml,json:y.json,xmlDesc:y.description,mode:v.opts.mode}});v.dialog.destroy()});v.dialog.getContent().getElements(".btn-default").forEach(function(y){y.addEvent("click",function(){v.dialog.destroy()})})})}else{if(v.opts.use=="FILTER"){var w=function(){document.querySelector(".operations-main-container").destroy();require(["DS/CfgFilterUX/CfgFilterFactory"],function(x){x.showFilter()})};var q=function(y){var x=v.versionGraph.getEvolutionExpressionAndJson();f.ModelEvents.publish({event:"ProductStateDialogClosed",data:{model:null,xml:x.xml,json:x.json,xmlDesc:x.description,mode:v.opts.mode}});require(["DS/CfgFilterUX/CfgFilterFactory"],function(z){document.querySelector(".operations-main-container").destroy();z.showFilter()})};var u=[{label:e.Filter_Cancel,handler:w,className:"default"},{label:e.Filter_Apply,handler:q,className:"primary"}];var r={dialogue:{buttonArray:u,showHeader:true,showButton:true},HeaderLabel:t};p.init(f.renderToApp,v.MainContainer,r,d)}}}},build:function(E){var w=this;var r=new UWA.Element("div");r.setAttribute("id","MainPrdContainer");this.wrapperDiv=UWA.createElement("div",{id:"wrapperDivId",styles:{width:"100%",display:"flex"}}).inject(r);var x=UWA.createElement("div",{html:'<div id="selectiondivID", style="float:left;margin-right:13px;padding-top:16px;font-weight:bold;white-space: nowrap;text-overflow: ellipsis;width: 141px;overflow: hidden">'+e.Filter_InfinitySelectionMode+'</div><div style="display:flex ;padding-top:6px;"><div class="toggleParent"></div>'}).inject(this.wrapperDiv);x.setStyle("height","50px");x.setStyle("width","400px");x.setStyle("margin-left","calc(100% - 237px)");this.toggle={};this.toggle=new l({className:"productState-toggle",type:"switch",value:"option2",label:""}).inject(r.getElements(".toggleParent")[0]);if(E.use!="FILTER"){this.toggle.check(true)}var D=new k({className:"mytooltip",target:x,body:e.Filter_InfinitySelectionMode,position:"bottom",});var u=this.infinityicon={iconName:"infinity",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"2x"};var y=UWA.createElement("span",{"class":" fonticon fonticon-info-circled",styles:{"padding-top":"10px"}}).inject(this.wrapperDiv);y.addClassName("infoicon");var D=new k({className:"mytooltip",target:y,body:e.Infinitytooltip,position:"bottom",});var t="";if(E.mode=="PRODUCTS"){t=e.Filter_Revision}else{if(E.mode=="MANUFACTURINGPLAN"){t=e.Filter_Revision}else{if(E.mode=="MILESTONES"){t=e.Filter_Milestone_Date}}}var v=[];v.push({text:t,dataIndex:"revision",width:170});v.push({text:e.Filter_Status,dataIndex:"current",width:170});var C=new g({shouldDisplayTooltip:function(){return""},apiVersion:2,changeColorOnFocus:false,defaultCellHeight:38,selection:{canMultiSelect:true,isDraggable:false,unselectAllOnEmptyArea:false},columns:v,resize:{rows:false,columns:true},roots:w.rootrevisionarray});C.inject(r);C._shouldAcceptDrag=false;C.getManager().getDocument().expandAll();C.getManager().getDocument().getAllDescendants().forEach(function(J){if(E.psJson==null){return}J.prepareUpdate();if(E.psJson!=null){var M=E.psJson;var T=M.length;for(var Q=0;Q<T;Q++){var P=M[Q];var K=P.start.isRoot;if(J.options.name==P.start.name&&J.options.revision==P.start.revision){if(K==true){J.select();J.updateOptions({icons:[u]});J.getAllDescendants().forEach(function(U){U.updateOptions({icons:[u]});U.select()});var F=J.isRoot();var O=null;if(F==true){var H=C.getManager().getDocument().getAllDescendants();var L=H.length;var G=0;for(var N=0;N<L;N++){var I=H[N];var K=I.isRoot();if(G==1&&K==true){I.select();I.updateOptions({icons:[u]});I.getAllDescendants().forEach(function(U){U.updateOptions({icons:[u]});U.select()})}if(K==true&&J.options.name==I.options.name&&J.options.revision==I.options.revision){G=1}}}if(P.end.length!=0){var T=P.end.length;for(var Q=0;Q<T;Q++){var R=P.end[Q];C.getManager().getDocument().getAllDescendants().forEach(function(Y){if(Y.options.name==R.name&&Y.options.revision==R.revision){Y.unselect();Y.updateOptions({icons:[]});Y.getAllDescendants().forEach(function(ad){ad.updateOptions({icons:[]});ad.unselect()});var U=Y.isRoot();var ac=null;if(U==true){var W=C.getManager().getDocument().getAllDescendants();var aa=W.length;var V=0;for(var ab=0;ab<aa;ab++){var X=W[ab];var Z=X.isRoot();if(V==1&&Z==true){X.unselect();X.updateOptions({icons:[]});X.getAllDescendants().forEach(function(ad){ad.updateOptions({icons:[]});ad.unselect()})}if(Z==true&&Y.options.name==X.options.name&&Y.options.revision==X.options.revision){V=1}}}if(R.IsExcluded=="false"){Y.select()}else{Y.unselect()}}})}}}else{J.select()}}}J.pushUpdate()}else{var S=C.getManager().getDocument().getAllDescendants();if(S.length>0){S[S.length-1].select()}}});w.tree=C;w.tree.getManager().forceMultiSelection(true);w.RangeList=[];var q="";if(E.mode=="PRODUCTS"){q=e.Filter_Dialog_Product}else{if(E.mode=="MANUFACTURINGPLAN"){q=e.Filter_Dialog_ManufacturingPlan}else{if(E.mode=="MILESTONES"){q=e.Filter_Dialog_Milestone}}}if(E.use==""){var B=function(G){if(G.buttonId=="firstButton"){var F=w.GetExpressionForFilter(w);f.ModelEvents.publish({event:"ProductStateDialogClosed",data:{model:null,xml:F,json:w.RangeList,xmlDesc:w.opts.description,mode:w.opts.mode}})}else{if(G.buttonId=="secondButton"){f.ModelEvents.publish({event:"ProductStateDialogClosed",data:{mode:""}})}}w.containerView.destroy()};var E={isHeader:true,isFooter:true,firstButtonText:e.CFG_Apply,secondButtonText:e.CFG_Back,headerText:q,onButtonClickCB:B,};w.containerView=new o(E).render();w.containerView.inject(f.renderTo);r.inject(w.containerView._body)}else{if(E.use=="EFFECTIVITY"){w.dialog=new j({className:"site-reset",closable:true,header:"<h4>"+q+"</h4>",body:r,footer:'<button type="button" class="btn btn-primary">'+e.Filter_Apply+'</button> <button type="button" class="btn btn-default">'+e.Filter_Cancel+"</button>",events:{onHide:function(){w.dialog.destroy()}}}).inject(f.renderTo);w.dialog.show();w.dialog.getContent().getElements(".btn-primary").forEach(function(F){F.addEvent("click",function(){var K=w.GetExpressionForFilter(w);var H=w.tree.getManager().getDocument().getAllDescendants();var G=H.length;var J=0;f.singleProductId="";if(w.RangeList.length==1&&(w.RangeList[0].start.isRoot==false||w.RangeList[0].start.isRoot==undefined)){for(var I=0;I<G;I++){var L=H[I];if(L.isSelected()==true){f.singleProductId=L.options.id.replace("pid:","")}}}f.ModelEvents.publish({event:"ProductStateDialogClosed",data:{model:null,xml:K,xmlDesc:w.opts.description,json:w.RangeList,mode:w.opts.mode}});w.dialog.destroy()});w.dialog.getContent().getElements(".btn-default").forEach(function(G){G.addEvent("click",function(){w.dialog.destroy()})})})}else{if(E.use=="FILTER"){var z=function(){document.querySelector(".operations-main-container").destroy();require(["DS/CfgFilterUX/CfgFilterFactory"],function(F){F.showFilter()})};var A=function(K){var J=w.GetExpressionForFilter(w);var G=w.tree.getManager().getDocument().getAllDescendants();var F=G.length;var I=0;f.singleProductId="";if(w.RangeList.length==1&&(w.RangeList[0].start.isRoot==false||w.RangeList[0].start.isRoot==undefined)){for(var H=0;H<F;H++){var L=G[H];if(L.isSelected()==true){f.singleProductId=L.options.id.replace("pid:","")}}}f.ModelEvents.publish({event:"ProductStateDialogClosed",data:{model:null,xml:J,xmlDesc:w.opts.description,json:w.RangeList,mode:w.opts.mode}});require(["DS/CfgFilterUX/CfgFilterFactory"],function(M){document.querySelector(".operations-main-container").destroy();M.showFilter()})};var s=[{label:e.Filter_Cancel,handler:z,className:"default"},{label:e.Filter_Apply,handler:A,className:"primary"}];var E={dialogue:{buttonArray:s,showHeader:true,showButton:true},HeaderLabel:q};p.init(f.renderToApp,r,E,d)}}}C.options.columns[0].text=e.Column_Label_Title;w.tree.getManager().getNodesXSO().onChange(function(N){if(w.iAmSelecting!=true){w.XSO=w.tree.getManager().getNodesXSO();if(w.toggle.isChecked()==true){var K=w.infinityicon;N.prepareUpdate();if(N.isSelected()==false){K="";w.iAmSelecting=true;w.XSO.remove([N]);w.iAmSelecting=false;N.updateOptions({icons:[]});N.getAllDescendants().forEach(function(O){if(O.options.data.frozen==false){O.updateOptions({icons:[]});w.iAmSelecting=true;w.XSO.remove([O]);w.iAmSelecting=false}});var I=N.isRoot();var M=null;if(I==true){var G=w.tree.getManager().getDocument().getAllDescendants();var J=G.length;var F=0;for(var L=0;L<J;L++){var H=G[L];var I=H.isRoot();if(F==1&&I==true){if(H.options.data.frozen==false){w.iAmSelecting=true;w.XSO.remove([H]);w.iAmSelecting=false;H.updateOptions({icons:[]});H.getAllDescendants().forEach(function(O){if(O.options.data.frozen==false){O.updateOptions({icons:[]});w.iAmSelecting=true;w.XSO.remove([O]);w.iAmSelecting=false}})}}if(I==true&&N.options.name==H.options.name&&N.options.revision==H.options.revision){F=1}}}}else{N.updateOptions({icons:[K]});N.getAllDescendants().forEach(function(O){if(O.options.data.frozen==false){O.updateOptions({icons:[K]});w.iAmSelecting=true;w.XSO.add([O]);w.iAmSelecting=false}});var I=N.isRoot();var M=null;if(I==true){var G=w.tree.getManager().getDocument().getAllDescendants();var J=G.length;var F=0;for(var L=0;L<J;L++){var H=G[L];var I=H.isRoot();if(F==1&&I==true){if(H.options.data.frozen==false){w.iAmSelecting=true;w.XSO.add([H]);w.iAmSelecting=false;H.updateOptions({icons:[K]});H.getAllDescendants().forEach(function(O){if(O.options.data.frozen==false){O.updateOptions({icons:[K]});w.iAmSelecting=true;w.XSO.add([O]);w.iAmSelecting=false}})}}if(I==true&&N.options.name==H.options.name&&N.options.revision==H.options.revision){F=1}}}}N.pushUpdate()}else{N.updateOptions({icons:[]})}}});w.tree.onExpand(function(){console.log("in expand")});w.tree.onCollapse(function(){console.log("in collapse")});w.tree.getManager().onCellRequest(function(F){if(F.nodeModel._options.data.frozen==true){F.view.addClassName("disablerow")}else{F.view.removeClassName("disablerow")}var G=F.view.getElement(".wux-layouts-treeview-expander");if(G!=undefined||G!=null){G.setStyle("pointer-events","all")}if(F.dataIndex=="revision"){F.cellView.getContent().setContent(F.cellModel.getCellContent())}if(F.dataIndex=="current"){F.cellView.getContent().setContent(F.cellModel.getCellContent())}})},mainderivedMilestones:function(q,s){if(s==undefined||Object.keys(s).length===0&&s.constructor===Object){return}var v=s[0].sequence;for(var r=0;r<v.length;r++){var t="";var t=v[r].current_NLS;var u={label:v[r].name,image:"",name:v[r].name,current:t,data:{frozen:false},icons:[],revision:v[r].attributes.TaskEstimatedFinishDate,grid:{revision:v[r].attributes.TaskEstimatedFinishDate,current:t},id:""};q.push(u)}},mainderived:function(u,q){if(q==undefined||Object.keys(q).length===0&&q.constructor===Object){return}var s=false;if((q.current=="Obsolete"||q.current=="Release"||q.current=="Review")&&this.opts.use!="FILTER"){s=true}var r="";var r=q.current_NLS;var v=q.displayValue;if(v==undefined||v==null||v.length==0){v=q.name}var t={label:v+"{"+q.revision+"}",name:q.name,displayname:v,image:q.image,current:r,data:{frozen:s},icons:[],revision:q.revision,grid:{revision:q.revision,current:r},id:q.id};u.push(t);this.addChildren(t,q.Derived);this.mainderived(u,q["Main Derived"])},addChildren:function(s,r){if(r==""||r==undefined){return}if(s.children==undefined||s.children.length==0){s.children=[]}for(var t=0;t<r.length;t++){var w=false;if((r[t].current=="Obsolete"||r[t].current=="Release"||r[t].current=="Review")&&this.opts.use!="FILTER"){w=true}var v="";var v=r[t].current;var x=r[t].displayValue;if(x==undefined||x==null||x.length==0){x=r[t].name}var u={label:x+"{"+r[t].revision+"}",name:r[t].name,displayname:x,image:r[t].image,current:v,data:{frozen:w},revision:r[t].revision,grid:{revision:r[t].revision,current:v,},id:r[t].id};s.children.push(u);this.lastrevision=u;this.addChildren(u,r[t].Derived);var q=r[t]["Main Derived"];if(Object.keys(q).length!=0&&q.constructor===Object){this.addChildren(s.children[s.children.length-1],[q])}}},buildFilterXML:function(r){var s="";if(window.DescriptionCount==undefined){window.DescriptionCount=1}var q={iCount:window.DescriptionCount,iDescriptionTag:[]};for(var t=0;t<r.length;t++){if(this.opts.mode=="MILESTONES"){s=s+r[t].buildMilestoneXML()}else{s=s+r[t].buildXML(q)}q.iCount++;window.DescriptionCount++}this.opts.description=q.iDescriptionTag;return s},GetExpressionForFilter:function(w){var v=[];var r=w.tree.getRoots()[0];if(r==undefined){return""}if(r.isSelected()==true&&(r.options.icons.length==0)){var z=r.options.name;var x=r.options.revision;var y=r.options.displayname;var u=h.getRange(z,x,y);v.push(u)}var t=null;var q=this.tree.getManager().getDocument().getAllDescendants();w.parseEffectivity(t,r,v,q);var s=w.buildFilterXML(v);w.RangeList=v;return s},parseEffectivity:function(D,z,s,C){if(!z){return}if(z.isSelected()==true&&(z.options.icons.length==1)&&D==null){var t=z.options.name;var J=z.options.revision;var v=z.options.displayname;D=h.getRange(t,J,v,true);s.push(D)}var u=z.getChildren();if(u===undefined){u=[]}var q=z;var E=z.isRoot();var K=null;if(E==true){var I=C.length;var r=0;for(var G=0;G<I;G++){var x=C[G];var E=x.isRoot();if(r==1&&E==true){K=x;break}if(E==true&&z.options.name==x.options.name&&z.options.revision==x.options.revision){r=1}}}var I=u.length;for(var G=0;G<=I;G++){var B=null;if(G==I){if(K!=null){B=K}else{continue}}if(B==null){B=u[G]}var w="";if(B.isSelected()==true&&(B.options.icons.length==1)){w="infinity"}else{if(B.isSelected()==false){w="unselected"}else{if(B.isSelected()==true&&(B.options.icons.length==0)){w="selected"}}}if((w=="unselected"||w=="selected")&&D!=null){var F=true;if(w=="selected"){F=false}var L=B.options.name;var y=B.options.revision;var v=B.options.displayname;D.addLeaves(L,y,v,F);var H=null;this.parseEffectivity(H,B,s,C)}else{if(w=="infinity"&&D!=null){this.parseEffectivity(D,B,s,C)}else{if(w=="unselected"&&D==null){var H=null;this.parseEffectivity(H,B,s,C)}else{if(w=="infinity"&&D==null){var H=null;this.parseEffectivity(H,B,s,C)}else{if((w=="selected")&&D==null){var L=B.options.name;var y=B.options.revision;var v=B.options.displayname;var A=h.getRange(L,y,v,false);s.push(A);var A=null;this.parseEffectivity(A,B,s,C)}}}}}}}};return a});define("DS/CfgEvolutionUX/CfgVariants",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Promise","DS/CfgEvolutionUX/CfgProductManufacturingPlanLayout","DS/CfgBaseUX/scripts/CfgXMLServices","DS/UIKIT/Tooltip","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/CfgFilterUX/CfgVariantEditor","DS/UIKIT/Alert","DS/CfgFilterUX/CfgPCChooser","DS/CfgBaseUX/scripts/CfgData","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Iconbar","DS/CfgBaseUX/scripts/CfgSearchConfiguration","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(b,f,v,r,t,u,k,e,j,i,w,n,y,q,o,p,x,a,m,h,d,c,s,g){var l=t.extend({textBox:null,editButton:null,textdiv:null,buttondiv:null,xml:null,json:null,displayExpression:"",currentModel:null,xmlExpression:"",xmlDisplayExpression:"",configuratorButton:null,binaryExpression:"",selectedPCPID:"",setup:function(z){this._parent(z)},render:function(){var z=this;this.rootrevisionarray=[];this.options.parentElement.addClassName("variant-decidesActionButtonPosition");this.wrapperContainer=UWA.createElement("div",{styles:{}}).inject(this.options.parentElement);this.imgContainer=UWA.createElement("div",{styles:{}}).inject(this.wrapperContainer);this.pcwrapperDiv=UWA.createElement("div",{id:"pcwrapperDivId",styles:{visibility:"hidden"}}).inject(this.wrapperContainer);this.textdiv=UWA.createElement("div",{styles:{"float":"left",width:"100%","margin-bottom":"10px"}}).inject(this.options.parentElement);this.textBox=UWA.createElement("div",{styles:{}}).inject(this.textdiv);this.textBox.addClassName("CfgEditorVariants");this.textBox.innerHTML=this.options.iUnitJson.displayExpression;this.displayExpression=this.options.iUnitJson.displayExpression;this.xmlExpression=this.options.iUnitJson.xmlExpression;if(this.options.iUnitJson.binaryExpression==undefined){this.binaryExpression=""}else{this.binaryExpression=this.options.iUnitJson.binaryExpression}this.variant=this.options.iUnitJson.variant;this.status=this.options.status;this.getDefaultIcon();this.pcIconButton=UWA.createElement("img",{src:this.iconProductConfiguration22,id:"pcIconButton",}).inject(this.pcwrapperDiv);this.labelPCIcon=UWA.createElement("Label",{html:"Demo Product Configuration",id:"pciconLabelId",}).inject(this.pcwrapperDiv);this.editButton=UWA.createElement("img",{src:this.iconProductConfiguration22,id:"editbuttonid",}).inject(this.imgContainer);this.editButton.addClassName("editButtoncss");this.editButton.set({events:{click:function(A){if(z.editButton.hasClassName("disableButton")==true){return}z.onVariantsDialogLaunched(A,z)}}});new w({target:this.editButton,className:"editButtontooltip",body:g.Filter_Variant__ProductConfiguration_Button});this.divider=UWA.createElement("div",{id:"dividerid"}).inject(this.imgContainer);this.divider.addClassName("cfgdivider");if(this.options.userGrantedRoles.isCFGRoleAvail==true){this.configuratorButton=UWA.createElement("img",{id:"edit",src:this.iconActionConfigurator}).inject(this.imgContainer);this.configuratorButton.addClassName("configuratorButton");new w({target:this.configuratorButton,className:"configuratorbuttontooltip",body:g.Filter_Variant_Configurator_Button});if(z.options.status){z.configuratorButton.addClassName("disableButton")}else{z.configuratorButton.removeClassName("disableButton")}this.configuratorButton.set({events:{click:function(B){if(z.configuratorButton.hasClassName("disableButton")==true){return}if(z.options.invokeFrom=="Filter"){y.mask(z.options.filterParentContainer);y.mask(z.options.filterParent)}z.currentDictionary=u.getDictionary(z.currentDictionaryId.replace("pid:",""));console.log(x.singleProductId);if(z.displayExpression!=""){z.selectedOptionsforConfigurator=x.selectedOptionsforConfigurator}else{z.selectedOptionsforConfigurator=""}if(x.singleProductId==""){z.options.status=false}else{z.options.status=true}z.options={parentContainer:document.body,model_id:z.currentModel.model.value,tenant:z.options.tenant,invokeFrom:z.options.invokeFrom,status:z.options.status,filterParent:z.options.filterParent,filterParentContainer:z.options.filterParentContainer,variantEditorOnOK:function(C){z.data=C;console.log(C);console.log(C.xml);z.variantSpinner=new n({className:"variantSpinner"}).inject(z.textBox);z.variantSpinner.spin();z.calculateVariantSpinnerPosition();z.clearButton.addClassName("disableButton");z.editButton.addClassName("disableButton");z.divider.addClassName("disableButton");if(C.xml==""){z.editButton.addClassName("editButton");z.configuratorButton.addClassName("configuratorButton")}else{z.editButton.addClassName("editButtonresize");z.configuratorButton.addClassName("configuratorButtonresize")}z.clearProductConfLabelInfo();y.mask(z.textBox);if(C.xml!==""){z.variant={};z.variant.pcid=C.PCId;z.variant.configuration=C.configuration;z.processProductConfiguration(C,z)}else{if(!z.variant){z.variant={};z.variant.pcid=C.PCId;z.variant.configuration=[]}z.getNoConfAlert()}},variantEditorOnCancel:function(C){console.log("cancelled")}};if(z.selectedPCPID==""){var A=new q({parentContainer:document.body,productId:x.singleProductId,modelId:z.currentModel.model.value,configuration:z.selectedOptionsforConfigurator,tenant:z.options.tenant,invokeFrom:z.options.invokeFrom,status:z.options.status,filterParent:z.options.filterParent,filterParentContainer:z.options.filterParentContainer,onOK:function(C){console.log("On OK Data : "+C.xml);z.options.variantEditorOnOK(C)},onCancel:function(C){console.log("On Cancel Data : "+C.xml);z.options.variantEditorOnCancel(C)}});setTimeout(function(){A.render()},1000)}else{z.launchVariantEditorfrompcId()}}}})}x.ModelEvents.subscribe({event:"ProductStateDialogClosed"},function(A){if(A.xml==""||A.xml==null){return}z.xml=A.xml;z.options.psJson=A.json;z.xml=A.xml;z.textBox.innerHTML="";z.displayExpression="";z.xmlExpression="";z.binaryExpression="";z.variant={};z.clearButton.hide();z.divider.hide();if(z.configuratorButton==null){z.editButton.removeClassName("configuratorButtonresize")}else{z.editButton.removeClassName("editButtonresize");z.configuratorButton.removeClassName("configuratorButtonresize")}if(x.singleProductId==""){z.options.status=false}else{z.options.status=true}z.enableDisableEditVariantfromProductEvolution();z.clearProductConfLabelInfo()});if(this.configuratorButton==null){this.editButton.addClassName("configuratorButton")}else{this.editButton.addClassName("editButtoncss")}this.clearButton=UWA.createElement("img",{styles:{position:"absolute",right:"5px",bottom:"5px",height:"27px"},id:"clearbuttonid",src:this.iconTrash}).inject(this.imgContainer);this.clearButton.set({events:{click:function(A){if(z.clearButton.hasClassName("disableButton")==true){return}z.textBox.innerHTML="";z.displayExpression="";z.xmlExpression="";z.binaryExpression="";z.variant={};z.clearButton.hide();z.divider.hide();if(z.configuratorButton==null){z.editButton.removeClassName("configuratorButtonresize")}else{z.editButton.removeClassName("editButtonresize");z.configuratorButton.removeClassName("configuratorButtonresize")}z.pcwrapperDiv.removeClassName("enablePCLabel");z.clearProductConfLabelInfo()}}});new w({target:this.clearButton,body:g.Filter_Variant_ClearButton});if(this.textBox&&(this.textBox.innerText&&this.textBox.innerText!=="undefined")){this.clearButton.show();this.divider.show();if(this.configuratorButton==null){this.editButton.addClassName("configuratorButtonresize")}else{this.editButton.addClassName("editButtonresize");this.configuratorButton.addClassName("configuratorButtonresize")}}else{this.clearButton.hide();this.divider.hide()}x.ModelEvents.subscribe({event:"ProductStatecheckbox"},function(A){z.checkboxStatus=A.model;if((A.isRoot==false||A.isRoot==undefined)&&A.psJsonLength==1){if(z.checkboxStatus==true){if(z.configuratorButton!=null){z.configuratorButton.removeClassName("disableButton")}z.options.status=true}else{if(z.configuratorButton!=null){z.configuratorButton.addClassName("disableButton")}z.options.status=false;z.clearProductConfLabelInfo()}}else{if(z.configuratorButton!=null){z.configuratorButton.addClassName("disableButton")}z.options.status=false;z.clearProductConfLabelInfo()}});x.ModelEvents.subscribe({event:"modelUpdated"},function(B){z.currentModel=B;var A="";if(B.model.value.constructor==Array){A=B.model.value[0]}else{A=B.model.value}z.currentDictionaryId=A;if(z.options.iUnitJson!=""&&z.options.iUnitJson!=undefined){z.options.iUnitJson=""}else{z.textBox.innerHTML="";z.xmlExpression="";z.displayExpression="";z.clearButton.hide();z.divider.hide();if(z.configuratorButton==null){z.editButton.removeClassName("configuratorButtonresize")}else{z.editButton.removeClassName("editButtonresize");z.configuratorButton.removeClassName("configuratorButtonresize")}}if(B.noEvolutionUpdate!=undefined&&B.noEvolutionUpdate==true){return}else{z.options.status=false}z.enableDisableEditVariantfromProductEvolution();z.clearProductConfLabelInfo()})},launchVariantEditorfrompcId:function(){var A=this;var z=new q({parentContainer:document.body,modelId:this.options.model_id,PCId:this.selectedPCPID,tenant:A.options.tenant,invokeFrom:this.options.invokeFrom,status:this.options.status,filterParent:this.options.filterParent,filterParentContainer:this.options.filterParentContainer,onOK:function(B){console.log("On OK Data : "+B.xml);A.options.variantEditorOnOK(B)},onCancel:function(B){console.log("On Cancel Data : "+B.xml);A.options.variantEditorOnCancel(B)},});this.modelView=z;setTimeout(function(){z.render()},1000)},getDefaultIcon:function(){this.iconProductConfiguration22=enoviaServerFilterWidget.baseURL+"/snresources/images/icons/small/ProductConfiguration22.png";this.iconActionConfigurator=h.getWebappsAssetUrl("CfgBaseUX","icons/32/iconActionConfigurator.png");this.iconTrash=h.getWebappsAssetUrl("CfgBaseUX","icons/32/SWXMbUiDeleteObjects.png")},enableDisableEditVariantfromProductEvolution:function(){if(this.configuratorButton==null){return}if(this.options.status==true){this.configuratorButton.removeClassName("disableButton")}else{this.configuratorButton.addClassName("disableButton")}},show:function(){this.textBox.show();this.editButton.show();this.clearButton.show();this.divider.show()},hide:function(){this.textBox.hide();this.editButton.hide();this.clearButton.hide();this.divider.hide()},getBinaryExpression:function(z){if(z.results[0]!=undefined){if(z.results[0].attributes.length>0){for(var A=0;A<z.results[0].attributes.length;A++){if(z.results[0].attributes[A].name=="FILTER_COMPILED_FORM"){this.binaryExpression=z.results[0].attributes[A].value}}}}return this.binaryExpression},getDisplayXMLExpression:function(z){var D={};var A="";z.seletedoptionsexist=false;if(z.results[0]!=undefined){if(z.results[0].attributes.length>0){for(var B=0;B<z.results[0].attributes.length;B++){if(z.results[0].attributes[B].name=="CONFIGURATION_FEATURE"){var C=z.results[0].attributes[B].value;var F=C.split(":");if(D[F[0]]==undefined){if(F[0]===this.currentModel.model.name[0]){continue}D[F[0]]=[F[1]];var E=[];E.push(F[1]);D[F[0]]=E;z.seletedoptionsexist=true}else{var E=D[F[0]];E.push(F[1]);D[F[0]]=E}}}Object.keys(D).forEach(function(J,G){var H="";for(var I=0;I<D[J].length;I++){H=H+i.buildOption(D[J][I])}if(D[J].length.length!=0){A=A+i.buildFeature(J,H)}})}}return A},isDisplayNameFetched:function(A){var z=false;if(A.results[0]){for(var B=0;B<A.results[0].attributes.length;B++){if(A.results[0].attributes[B].name=="CONFIGURATION_FEATURE"){z=true;break}}}return z},getXMLExpression:function(z){var D={};var A="";z.seletedoptionsexist=false;if(z.results[0]!=undefined){if(z.results[0].attributes.length>0){for(var B=0;B<z.results[0].attributes.length;B++){if(z.results[0].attributes[B].name=="PC_FEATURE_OPTIONS"){var C=z.results[0].attributes[B].value;var F=C.split(":");if(D[F[0]]==undefined){if(F[0]===this.currentModel.model.name[0]){continue}D[F[0]]=[F[1]];var E=[];E.push(F[1]);D[F[0]]=E;z.seletedoptionsexist=true}else{var E=D[F[0]];E.push(F[1]);D[F[0]]=E}}}Object.keys(D).forEach(function(J,G){var H="";for(var I=0;I<D[J].length;I++){H=H+i.buildOption(D[J][I])}if(D[J].length.length!=0){A=A+i.buildFeature(J,H)}})}}return A},getNoConfAlert:function(){var z=this;y.unmask(z.textBox);z.textBox.innerText="";z.editButton.removeClassName("disableButton");if(z.textBox.innerText!==""){if(!z.clearButton.isHidden()){z.clearButton.removeClassName("disableButton");z.divider.removeClassName("disableButton")}else{z.clearButton.show()}}else{if(!z.clearButton.isHidden()){z.clearButton.hide()}z.divider.hide();if(z.configuratorButton==null){z.editButton.removeClassName("configuratorButtonresize")}else{z.editButton.removeClassName("editButtonresize");z.configuratorButton.removeClassName("configuratorButtonresize")}}if(z.data!=undefined&&z.data.selectionmode==="selectionMode_Refine"){x.filter150Checkbox.check()}else{if(z.data!=undefined&&z.data.selectionmode==="selectionMode_Build"){x.filter150Checkbox.uncheck()}}},replaceAmp:function(A){var B=A.indexOf("&");var z=A.indexOf("</CfgFilterExpression>");if(A.indexOf("&")!==-1){var C=A.slice(0,B+1);C=C.replace("&","&amp;");this.formattedXML=this.formattedXML+C;A=A.slice(B+1,z+22);this.replaceAmp(A)}else{this.formattedXML=this.formattedXML+A}},processProductConfiguration:function(A,z){window.notifs=a;m.setNotificationManager(window.notifs);if(A.selectionmode==="selectionMode_Refine"){x.filter150Checkbox.check()}else{if(A.selectionmode==="selectionMode_Build"){x.filter150Checkbox.uncheck()}else{if(A.selectionmode==undefined&&x.filter150Checkbox.isChecked()){x.filter150Checkbox.uncheck()}}}var B=new e(function(H,G){if(A.xml){H()}else{var I=JSON.parse(A.displayExpression);var E="/search?xrequestedwith=xmlhttprequest";var J=function(K){H(K)};var F={with_indexing_date:true,with_nls:false,label:"yus-1515078503005",locale:"en",select_predicate:["PC_FEATURE_OPTIONS","BASED_ON_PRODUCT_NAME","FILTER_COMPILED_FORM","ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name","CONFIGURATION_FEATURE"],select_file:["icon","thumbnail_2d"],query:"flattenedtaxonomies:(types/Product Configuration) AND ( physicalid:("+I.id+") ) ",order_by:"desc",order_field:"relevance",nresults:1000,start:"0",source:[],tenant:enoviaServerFilterWidget.tenant};var F=JSON.stringify(F);var D=function(){G()};var C={isfederated:"true"};var J=function(L){if(L.results==undefined){z.getNoConfAlert();return}var K=z.getXMLExpression(L);if(L.seletedoptionsexist==true){H(L)}else{z.getNoConfAlert();return}};var D=function(K){z.variant.pcid=z.previousPC;y.unmask(z.textBox);z.variantSpinner.hide();z.textBox.innerText="";z.editButton.removeClassName("disableButton");if(z.textBox.innerText!==""){if(!z.clearButton.isHidden()){z.clearButton.removeClassName("disableButton");z.divider.removeClassName("disableButton")}else{z.clearButton.show();z.divider.show()}}else{if(!z.clearButton.isHidden()){z.clearButton.hide()}z.divider.hide();if(z.configuratorButton==null){z.editButton.addClassName("configuratorButtonresize")}else{z.editButton.addClassName("editButtonresize");z.configuratorButton.addClassName("configuratorButtonresize")}}};k.makeWSCall(E,"POST","enovia","application/json",F,J,D,true,C)}});B.then(function(E){z.xmlExpression=A.xml?A.xml:z.getXMLExpression(E);z.xmlExpression=z.xmlExpression.replace(/&(?!amp;)/g,"&amp;");z.binaryExpression=A.xml?"":z.getBinaryExpression(E);var D=i.startFilterXML()+z.xmlExpression+i.endFilterXML();if(z.currentModel.model.value.constructor==Array){z.currentModel.model.value=z.currentModel.model.value[0]}if(A.xml||(!z.isDisplayNameFetched(E))){z.xmlDisplayExpression=(A&&A.displayXml)?A.displayXml:z.xmlExpression;var C=i.startFilterXML()+z.xmlDisplayExpression+i.endFilterXML();z.displayExpression=k.getDisplayExpressionUsingXSLT(C)}else{z.xmlDisplayExpression=z.getDisplayXMLExpression(E);z.xmlDisplayExpression=z.xmlDisplayExpression.replace(/&(?!amp;)/g,"&amp;");var C=i.startFilterXML()+z.xmlDisplayExpression+i.endFilterXML();z.displayExpression=k.getDisplayExpressionUsingXSLT(C)}z.clearButton.removeClassName("disableButton");z.editButton.removeClassName("disableButton");z.divider.removeClassName("disableButton");y.unmask(z.textBox);z.textBox.innerHTML=z.displayExpression;if(z.textBox.innerHTML!==""){z.clearButton.show();z.divider.show()}})},calculateVariantSpinnerPosition:function(){var z=this;var C=z.textBox.getPosition();var B=z.textBox.getDimensions().width;var A=z.textBox.getDimensions().height;var E=C.x+(B/2);var D=C.y+(A/2);z.variantSpinner.elements.container.setStyles({top:D+"px",left:E+"px"})},getJson:function(){return this.displayExpression},getXml:function(){return this.xmlExpression},getDisplayExpression:function(){return this.displayExpression},getSelectedVariant:function(){return this.variant},clearProductConfLabelInfo:function(){var z=this;z.pcwrapperDiv.removeClassName("enablePCLabel");z.selectedPCPID="";if(z.options.status==true){if(z.configuratorButton!=null){z.configuratorButton.removeClassName("disableButton")}}else{if(z.configuratorButton!=null){z.configuratorButton.addClassName("disableButton")}}},onVariantsDialogLaunched:function(C,I){var F="";var D="Product Configuration";var A=enoviaServerFilterWidget.myRole;var G="";var E=x.singleProductId;if(x.productstateCheckbox.isChecked()==false){var E=""}var B=I.currentModel.model.value;if((I.checkboxStatus)||(I.checkboxStatus==undefined)){if(E){G="(based_95_on_95_model_95_version_95_pid:"+E+")"}else{G="(based_95_on_95_model_95_pid:"+B+")"}}else{G="(based_95_on_95_model_95_pid:"+B+")"}var z="";var H=function(M){var L={};var K=["id","ds6w:label"];var P="";var O="";Object.keys(M[0]._attributes).forEach(function(Q){if(K.indexOf(Q)!==-1){if(Q=="ds6w:label"){L.label=M[0].get(Q);P=M[0].get(Q)}else{L[Q]=M[0].get(Q);O=M[0].get(Q)}}});I.labelPCIcon.innerHTML=P;I.selectedPCPID=O;if(I.configuratorButton!=null){I.configuratorButton.removeClassName("disableButton")}I.pcwrapperDiv.addClassName("enablePCLabel");I.clearButton.addClassName("disableButton");I.editButton.addClassName("disableButton");if(I.configuratorButton==null){I.editButton.addClassName("configuratorButtonresize")}else{I.editButton.addClassName("editButtonresize");I.configuratorButton.addClassName("configuratorButtonresize")}var N={displayExpression:JSON.stringify(L),xmlExpression:""};I.processProductConfiguration(N,I)};var J=new s(false);J.activate(F,D,A,H,G,z)}});return l});define("DS/CfgEvolutionUX/CfgProductState",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Promise","DS/CfgEvolutionUX/CfgProductManufacturingPlanLayout","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgEvolutionRange","DS/UIKIT/Mask","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(g,l,d,k,a,h,j,m,b,f,i,e){var c=a.extend({textBox:null,editButton:null,textdiv:null,xml:null,xmlDesc:[],json:null,displayExpression:"",setup:function(n){this._parent(n)},render:function(){var n=this;this.textdiv=UWA.createElement("div",{styles:{}}).inject(this.options.parentElement);this.textBox=UWA.createElement("div",{styles:{}}).inject(this.textdiv);this.textBox.addClassName("CfgEditor");this.textBox.set({events:{click:function(q){if(n.editButton.hasClassName("disableButton")==true){return}n.editButton.addClassName("disableButton");n.textBox.addClassName("disableButton");var t="";if(n.options.mode=="PRODUCTS"){t="products"}else{if(n.options.mode=="MANUFACTURINGPLAN"){t="manufacturingPlans"}else{if(n.options.mode=="MILESTONES"){t="milestones"}}}var s=h.getDictionaryByCriteria(n.ModalId,t);if(s[t]==null){var o;var p=h.renderTo.getElements(".cfgEvoCritModalVariableHeight");if(p!==undefined&&p.length>0){o=p[0].parentElement}else{o=h.renderTo.getElements(".modal-content")[0]}if(o){e.mask(o)}var r=j.getDictionaryFromServer(n.ModalId,t);r.then(function(u){h.addDictionaryByCriteria(n.ModalId,u,t);if(o){e.unmask(o)}n.onProductStateSelectionDialogLaunched(q);n.editButton.removeClassName("disableButton");n.textBox.removeClassName("disableButton")})}else{n.onProductStateSelectionDialogLaunched(q);n.editButton.removeClassName("disableButton");n.textBox.removeClassName("disableButton")}}}});this.editButton=UWA.createElement("span",{styles:{position:"relative",right:"0px",bottom:"48px","float":"right"}}).inject(this.options.parentElement);this.editButton.set({events:{click:function(q){if(n.editButton.hasClassName("disableButton")==true){return}n.editButton.addClassName("disableButton");n.textBox.addClassName("disableButton");var t="";if(n.options.mode=="PRODUCTS"){t="products"}else{if(n.options.mode=="MANUFACTURINGPLAN"){t="manufacturingPlans"}else{if(n.options.mode=="MILESTONES"){t="milestones"}}}var s=h.getDictionaryByCriteria(n.ModalId,t);if(s[t]==null){var o;var p=h.renderTo.getElements(".cfgEvoCritModalVariableHeight");if(p!==undefined&&p.length>0){o=p[0].parentElement}else{o=h.renderTo.getElements(".modal-content")[0]}if(o){e.mask(o)}var r=j.getDictionaryFromServer(n.ModalId,t);r.then(function(u){h.addDictionaryByCriteria(n.ModalId,u,t);if(o){e.unmask(o)}n.onProductStateSelectionDialogLaunched(q);n.editButton.removeClassName("disableButton");n.textBox.removeClassName("disableButton")})}else{n.onProductStateSelectionDialogLaunched(q);n.editButton.removeClassName("disableButton");n.textBox.removeClassName("disableButton")}}}});this.editButton.addClassName("fonticon");this.editButton.addClassName("fonticon-1.5x");this.editButton.addClassName("fonticon-search");this.editButton.addClassName("searchbutton");h.ModelEvents.subscribe({event:"modelUpdated"},function(o){n.setLastMainEvolution(o);n.editButton.removeClassName("disableButton");n.textBox.removeClassName("disableButton")});h.ModelEvents.subscribe({event:"ProductStateDialogClosed"},function(o){n.editButton.removeClassName("disableButton");n.textBox.removeClassName("disableButton");if(o.mode!=n.options.mode){return}if((o.xml==""||o.xml==null)&&(n.options.use!="EFFECTIVITY"&&n.options.use!="")){return}n.xml=o.xml;n.xmlDesc=o.xmlDesc;n.options.psJson=o.json;n.updateDisplayExpression()})},updateDisplayExpression:function(){var q=this.buildFilterXML();if(q==null){return}var p="";var o=this.buildDescription();if(q.search("TreeSeries")==-1&&q.search("MilestonesTrack")==-1){if(this.options.mode=="PRODUCTS"){p=f.buildTreeSeries("ProductState",this.ModalLabel,q)}else{if(this.options.mode=="MANUFACTURINGPLAN"){p=f.buildTreeSeries("ManufPlan",this.ModalLabel,q)}else{if(this.options.mode=="MILESTONES"){p=f.buildmilestonetrack(q)}}}}else{p=q}var n="";if(o==undefined||o.length==0){n=f.startFilterXML()+p+f.endFilterXML()}else{n=f.startEvolutionXML()+p+"</Expression><Description>"+o+"</Description></CfgEffectivityExpression>"}this.displayExpression=j.getDisplayExpressionUsingXSLT(n);this.textBox.innerHTML=this.displayExpression},buildDisplayExpression:function(){return this.displayExpression},buildFilterJson:function(){return this.options.psJson},buildFilterXML:function(){return this.xml},buildDescription:function(){return this.xmlDesc},setLastMainEvolution:function(o){var n=this;n.criteriasAvailable=h.CurrentFilterModel.model.criteriasAvailable;if(n.criteriasAvailable!=undefined){if(n.criteriasAvailable!=undefined&&n.criteriasAvailable.manufacturingPlans=="False"&&h.manufacturingplanComponent!=undefined){h.manufacturingplanCheckbox.hide();h.manufacturingplanComponent.hide();h.manufacturingplanComponent.textBox.setText("")}else{if(h.manufacturingplanCheckbox.isChecked()==true){h.manufacturingplanComponent.show();h.manufacturingplanCheckbox.show();h.manufacturingplanCheckbox.uncheck()}else{h.manufacturingplanComponent.hide();h.manufacturingplanComponent.textBox.setText("");h.manufacturingplanCheckbox.show()}}if(n.criteriasAvailable!=undefined&&n.criteriasAvailable.products=="FALSE"&&h.ProductStateComponent!=undefined){h.productstateCheckbox.hide();h.ProductStateComponent.hide();h.ProductStateComponent.textBox.setText("")}else{h.ProductStateComponent.show();h.productstateCheckbox.show();h.productstateCheckbox.check();h.ProductStateComponent.textBox.setText("")}if(h.UnitComponent!=undefined){if(n.criteriasAvailable!=undefined&&n.criteriasAvailable.builds=="FALSE"){h.UnitCheckbox.hide();h.UnitComponent.hide();h.UnitComponent.textBox.setValue("")}else{if(h.UnitCheckbox.isChecked()==true){h.UnitComponent.show();h.UnitCheckbox.show();h.UnitCheckbox.uncheck()}else{h.UnitComponent.hide();h.UnitComponent.textBox.setValue("");h.UnitCheckbox.show()}}}if(h.DateCheckbox!=undefined&&h.DateCheckbox.isChecked()==true){h.DateCheckbox.uncheck();h.DatePicker.hide()}}if(o.model.value.constructor==Array){this.ModalId=o.model.value[0];this.ModalLabel=o.model.label[0].label}else{this.ModalId=o.model.value;this.ModalLabel=o.model.label}if(o.noEvolutionUpdate!=undefined&&o.noEvolutionUpdate==true){return}var p=new m(function(u,t){var s="/resources/modeler/browsing/browseservice/pid:"+o.model.value+"/configurationdictionary?latestMainProductNode=1";var q=function(v){u(v)};var r=function(v){console.log("fail to get last product evolution")};j.makeWSCall(s,"POST","enovia","application/ds-json","productstates",q,r,true)});this.iData=o;var n=this;p.then(function(u){var s=u;if(Object.keys(s.products).length==0){n.displayExpression="";n.xml="";n.options.psJson=null;n.editButton.addClassName("disableButton");if(document.getElementById("edit")!=null){document.getElementById("edit").addClassName("disableButton")}h.singleProductId=""}else{if(window.DescriptionCount==undefined){window.DescriptionCount=1}n.xml='<Single Name = "'+s.products.name+'" Revision = "'+s.products.revision+'" DescId = "'+window.DescriptionCount+'"/>';n.modelName=n.iData.model.name[0];var t="";var r="";var v=f.buildTreeSeries("ProductState",n.modelName,n.xml);var q=s.products.displayValue;if(q==undefined||q==" "){q=s.products.name}n.xmlDesc='<TreeSeries DescId = "'+window.DescriptionCount+'" Revision = "'+s.products.revision+'" DisplayName="'+q+'"/>';v=f.startEvolutionXML()+v+"</Expression><Description>"+n.xmlDesc+"</Description></CfgEffectivityExpression>";n.displayExpression=j.getDisplayExpressionUsingXSLT(v);n.options.psJson=[i.getRange(s.products.name,s.products.revision,q)];n.editButton.removeClassName("disableButton");h.singleProductId=s.products.id.replace("pid:","");if(n.textBox.isHidden()!=true&&n.options.psJson!=null&&n.options.psJson.length==1&&n.options.psJson[0].start.isRoot!=true){if(document.getElementById("edit")!=null){document.getElementById("edit").removeClassName("disableButton")}}}h.ProductStateComponent.textBox.innerHTML=n.displayExpression})},setExpression:function(n){if(n.model.value.constructor==Array){this.ModalId=n.model.value[0];this.ModalLabel=n.model.label[0].label}else{this.ModalId=n.model.value;this.ModalLabel=n.model.label}if(this.options.mode=="PRODUCTS"){this.xml=this.options.expression.xmlExpression;this.xmlDesc=this.options.expression.psXmlDesc}if(this.options.mode=="MANUFACTURINGPLAN"){if(Object.keys(this.options.expression).length!=0){this.xml=this.options.expression.impXml;this.xmlDesc=this.options.expression.mpXmlDesc}}this.updateDisplayExpression()},show:function(){this.textBox.show();this.editButton.show();this.textdiv.addClassName("textDivStyleAdd");this.textdiv.removeClassName("textDivStyleRemove")},hide:function(){this.textBox.hide();this.editButton.hide();this.textdiv.removeClassName("textDivStyleAdd");this.textdiv.addClassName("textDivStyleRemove")},onProductStateSelectionDialogLaunched:function(o){var p="";if(this.options.mode=="PRODUCTS"){p="products"}else{if(this.options.mode=="MANUFACTURINGPLAN"){p="manufacturingPlans"}else{if(this.options.mode=="MILESTONES"){p="milestones"}}}h.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}});var n={};n.psJson=this.options.psJson;n.data=h.getDictionaryByCriteria(this.ModalId,p);n.mode=this.options.mode;n.use=this.options.use;n.appUse=this.options.appUse;n.appEnv=this.options.appEnv;n.ModelLabel=(this.ModalLabel.constructor==Array)?this.ModalLabel[0]:this.ModalLabel;b.create(n)},getSelectedModelId:function(){return this.ModalId},initialiseComponent:function(){if(this.ModalId==undefined&&this.ModalLabel==undefined){this.ModalId=this.options.expression.modelId;this.ModalLabel=this.options.expression.name}if(this.options.mode=="PRODUCTS"){this.xml=this.options.expression.xmlExpression;this.psJson=this.options.expression.psJson;this.xmlDesc=this.options.expression.psXmlDesc}else{if(this.options.mode=="MANUFACTURINGPLAN"){this.xml=this.options.expression.impXml;this.psJson=this.options.expression.mpJson;this.xmlDesc=this.options.expression.mpXmlDesc}else{if(this.options.mode=="MILESTONES"){this.xml=this.options.expression.milestoneXml;this.psJson=this.options.expression.milestoneJson;this.options.psJson=this.options.expression.milestoneJson}}}this.updateDisplayExpression(this)},});return c});define("DS/CfgEvolutionUX/CfgDatePicker",["UWA/Core","UWA/Date","DS/UIKIT/Input/Toggle","DS/CfgEvolutionUX/CfgDatePickerUtilities","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgData","css!DS/UIKIT/UIKIT.css"],function(g,d,f,a,b,e){var c={superMainDiv:null,broadcastCallback:null,create:function(i,j,k,l){var m=false;var h=this;this.superMainDiv=g.createElement("div");this.superMainDiv.style.marginTop="0px";this.superMainDiv.setAttribute("id","superMainDiv");a.superMainDiv=this.superMainDiv;if(i!=null){this.superMainDiv.inject(i)}else{return null}m=this._build(j,k);e.ModelEvents.subscribe({event:"modelUpdated"},function(n){h.update(n)});this.broadcastCallback=l;return h},_optimize:function(h){h.DateRanges.forEach(function(i){if(i.millisecStart!=null&&i.millisecStart!="null"&&i.millisecStart!=""&&i.millisecStart==i.millisecEnd){i.millisecEnd=null;i.End="null"}});return h},_build:function(i,k){var h=false;var j="SingleDate";if(k!=null&&"defaultDateBehavior" in k){j=k.defaultDateBehavior}if(i!=null&&i.DateRanges.length>0){i=this._optimize(i);h=a.SetDateByJSON(i,j)}else{h=a.prepareDefaultRange(null,j)}if(k!=null&&k.view=="show"){this.show()}else{this.hide()}return h},getJSON:function(){var m=document.getElementById("MainDiv");var q=m.getElementsByClassName("localDiv");var u="";var t={DateRanges:[]};var p;for(p=0;p<q.length;p++){var h={};currentDiv=q[p];var r=currentDiv.getElementsByClassName("myDateInput");var n=a.validate(r[0],r[1],currentDiv);if(!n){if((currentDiv.getElementsByClassName("hideOnSingle")[1].style.display=="none")&&r[0].value==""){continue}else{if((!(currentDiv.getElementsByClassName("hideOnSingle")[1].style.display=="none"))&&r[0].value==""&&r[1].value==""){continue}}return null}var o;var k=false;for(o=0;o<r.length;o++){var l=r[o].value;if(o==0){if(l==""||l.toUpperCase()=="-INF"){l="-INF"}h.Start=l;h.millisecStart=r[o].getAttribute("millisec")}if(o==1){if(currentDiv.getElementsByClassName("hideOnSingle")[1].style.display=="none"){l="null"}else{if(l==""||l.toUpperCase()=="INF"){l="INF"}}h.End=l;h.millisecEnd=r[o].getAttribute("millisec")}}if(k){continue}t.DateRanges.push(h)}var s=JSON.stringify(t.DateRanges);if(s=="[]"||s=="{}"){return null}else{return t}},getXML:function(){var k=document.getElementById("MainDiv");var n=k.getElementsByClassName("localDiv");var m;var q="";var p=null;var j=0;for(m=0;m<n.length;m++){currentDiv=n[m];var o=currentDiv.getElementsByClassName("myDateInput");var l=a.validate(o[0],o[1],currentDiv);if(!l){if((currentDiv.getElementsByClassName("hideOnSingle")[1].style.display=="none")&&o[0].value==""){j++;continue}else{if((!(currentDiv.getElementsByClassName("hideOnSingle")[1].style.display=="none"))&&o[0].value==""&&o[1].value==""){j++;continue}}return null}if((currentDiv.getElementsByClassName("hideOnSingle")[1].style.display=="none")||o[0].value==o[1].value){var r=this.ConvertToISODate(o[0].getAttribute("millisec"));q=q+b.buildSingleDateValue(r)}else{var s="";if(o[0].value==""||o[0].value.toUpperCase()=="-INF"){s="-INF"}else{var r=this.ConvertToISODate(o[0].getAttribute("millisec"));s=b.buildFromDate(r)}var h="";if(o[1].value==""||o[1].value.toUpperCase()=="INF"){h="INF"}else{var r=this.ConvertToISODate(o[1].getAttribute("millisec"));h=b.buildToDate(r)}if(s=="-INF"){inputForInterval=h}else{if(h=="INF"){inputForInterval=s}else{inputForInterval=s+h}}q=q+b.buildInterval(inputForInterval)}p=b.buildDate(q)}if(j===n.length){p=""}return p},update:function(i){var h=false;return h},show:function(){this.superMainDiv.show()},hide:function(){this.superMainDiv.hide()},ConvertToISODate:function(k){var i=parseInt(k);var j=new Date(i);var h="%Y-%m-%d";return d.strftime(j,h)}};return c});define("DS/CfgEvolutionUX/CfgEvolutionCriteriasDialog",["DS/UIKIT/Spinner","UWA/Drivers/Alone","DS/CfgBaseUX/scripts/CfgUtility","DS/Core/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/Handlebars/Handlebars","text!DS/CfgEvolutionUX/CfgEvolutionCriteriasDialogTemplate.html","DS/CfgEvolutionUX/CfgProductState","DS/CfgEvolutionUX/CfgDatePicker","DS/CfgEvolutionUX/CfgUnit","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgXMLServices","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(l,b,n,g,p,d,o,k,j,h,a,i,r,f,q){var m=k.compile(j);var e="";var c=p.extend({name:"evolution-criteria-dialog-view",tagName:"div",init:function(s){this._parent(s);e=s},setup:function(s){},render:function(){var w=this;if((w.options.environment!="3DSpace"&&w.options.mode=="Applicability")||w.options.mode=="EditEvolution"||w.options.mode=="SessionEffectivity"){r.renderTo=document.body}else{r.renderTo=w.options.parent}this.container.setHTML(m(this.options));var z=null;if(w.options.mode=="Applicability"){z=q.Header_Applicability+" : "}else{if(w.options.mode=="EditEvolution"){z=q.Header_EditEvolution+" - "}else{if(w.options.mode=="SessionEffectivity"){z=q.Header_SessionEffectivity+" : "}}}var x=x="<h4>"+z+w.options.expression.marketingName+"</h4>";if(w.options.mode=="EditEvolution"&&w.options.modelList.length==1){x=w.options.dialogue.header;var A=UWA.createElement("span",{text:n.getAttributeValue(w.options.modelList[0].data,"Marketing Name")[0]});A.setStyles({color:"rgb(119, 121, 124)","font-family":"Arial","font-size":"20px","font-weight":"700"});A.inject(this.container.getElement(".single-model-label"))}this.modal=new d({className:"cfgmodal-site-reset",closable:true,header:x,body:this,footer:'<button type="button" class="btn btn-primary">'+q.Apply+'</button> <button type="button" class="btn btn-default">'+q.Cancel+"</button>"}).inject(r.renderTo);var v="";var Q=null;var K=null;var y="";var P="";var F=true;var U=false;var B=false;var D=false;var T=null;var s="";var L=true;var R=0;if(Object.keys(w.options.expression).length!=0){v=w.options.expression.modelId;Q=w.options.expression.psJson;K=w.options.expression.mpJson;F=w.options.expression.productstatecheckbox;U=w.options.expression.unitcheckbox;B=w.options.expression.datestatecheckbox;D=w.options.expression.manufacturingplanstatecheckbox;T=w.options.expression.milestoneJson;s=w.options.expression.milestoneXml;L=w.options.expression.milestoneCheckbox}var J=w.options.criteriasAvailable;var N={};N.parentElement=this.container.getElement(".evolution-dialog-productstates");N.psJson=Q;N.expression=w.options.expression;N.mode="PRODUCTS";N.appUse=w.options.mode;N.appEnv=w.options.environment;N.use="EFFECTIVITY";this.productstateCheckbox=new o({type:"checkbox",value:"PSComponent",className:"primary",label:q.Product_State,events:{onChange:function(){if(this.isChecked()===true){w.ProductStateComponent.show()}else{w.ProductStateComponent.hide()}}}}).inject(this.container.getElement(".evolution-dialog-productstates-checkbox"));this.ProductStateComponent=new h(N);this.ProductStateComponent.render();if(F==true){this.productstateCheckbox.check();this.ProductStateComponent.show()}else{this.ProductStateComponent.hide()}this.ProductStateComponent.initialiseComponent();if(J.products=="False"||(w.options.enabledCritData!=null&&w.options.enabledCritData!="undefined"&&w.options.enabledCritData.productState=="false")){this.productstateCheckbox.uncheck();this.productstateCheckbox.hide();this.ProductStateComponent.hide()}var t={};t.parentElement=this.container.getElement(".evolution-dialog-manufacturingplans");t.psJson=K;t.expression=w.options.expression;t.mode="MANUFACTURINGPLAN";t.appUse=w.options.mode;t.appEnv=w.options.environment;t.use="EFFECTIVITY";this.manufacturingplanCheckbox=new o({type:"checkbox",value:"PSComponent",className:"primary",label:q.Manufacturing_Plan,events:{onChange:function(){if(this.isChecked()===true){w.manufacturingplanComponent.show()}else{w.manufacturingplanComponent.hide()}}}}).inject(this.container.getElement(".evolution-dialog-manufacturingplans-checkbox"));this.manufacturingplanComponent=new h(t);this.manufacturingplanComponent.render();if(D==true){this.manufacturingplanCheckbox.check();this.manufacturingplanComponent.show()}else{this.manufacturingplanComponent.hide()}this.manufacturingplanComponent.initialiseComponent();if(J.manufacturingPlans=="False"||(w.options.enabledCritData!=null&&w.options.enabledCritData!="undefined"&&w.options.enabledCritData.manufacturingPlan=="false")){this.manufacturingplanCheckbox.uncheck();this.manufacturingplanCheckbox.hide();this.manufacturingplanComponent.hide()}this.UnitCheckbox=new o({type:"checkbox",value:"UnitComponent",className:"primary",label:q.Unit,events:{onChange:function(){if(this.isChecked()===true){w.UnitComponent.show()}else{w.UnitComponent.hide()}}}}).inject(this.container.getElement(".evolution-dialog-unit-checkbox"));this.UnitCheckbox.elements.container.getElement(".control-label").addClassName("unitlabel");var E=null;var u=false;if(Object.keys(w.options.expression).length!=0){E=w.options.expression.iUnitJson;if(JSON.parse(w.options.expression.iUnitJson).builds.length){u=true}}var G=this.container.getElement(".evolution-dialog-unit");this.UnitComponent=new i({parentElement:G,mode:"UNIT",expression:w.options.expression});this.UnitComponent.render();this.UnitComponent.SetJson(E);if(U==true){this.UnitComponent.show();this.UnitCheckbox.check()}else{this.UnitComponent.hide()}if((r.configurationCriteria!=undefined&&r.configurationCriteria.unit==false)||J.builds=="FALSE"||(w.options.enabledCritData!=null&&w.options.enabledCritData!="undefined"&&w.options.enabledCritData.unit=="false")){this.UnitCheckbox.uncheck();this.UnitCheckbox.hide();this.UnitComponent.hide()}else{this.UnitComponent.initialiseComponent()}if(w.options.enabledCritData==undefined){w.options.enabledCritData={milestone:"true"}}if(J.milestones!="False"){var H=n.checkMilestoneActivation();H.then(function(V){w.milestoneActivationStatus=V;if(V=="Enabled"&&(w.options.enabledCritData!=undefined&&w.options.enabledCritData!=null&&w.options.enabledCritData.milestone=="true")){w.milestoneCheckbox=new o({type:"checkbox",value:"MSComponent",className:"primary",label:q.Milestone,events:{onChange:function(){if(this.isChecked()===true){w.milestoneComponent.show()}else{w.milestoneComponent.hide()}}}}).inject(w.container.getElement(".evolution-dialog-milestones-checkbox"));w.milestoneCheckbox.check();w.DateCheckbox.hide();w.DatePicker.hide();w.evolutionSpinner=new l({className:"evolutionSpinner"}).inject(w.container.getElement(".evolution-dialog-milestones"));w.evolutionSpinner.spin();w.evolutionSpinner.show();var X=r.getDictionaryByCriteria(w.options.expression.modelId,"milestones");if(X.milestones==null){var W=n.getDictionaryFromServer(w.options.expression.modelId,"milestones=1&attributes");W.then(function(Y){r.addDictionaryByCriteria(w.options.expression.modelId,Y,"milestones");w.processmilestones()})}else{w.processmilestones()}}},function(V){})}this.DateCheckbox=new o({type:"checkbox",value:"DateComponent",className:"primary",label:q.Date,checked:false,events:{onChange:function(){if(this.isChecked()===true){w.DatePicker.show()}else{w.DatePicker.hide()}}}}).inject(this.container.getElement(".evolution-dialog-date-checkbox"));var S=null;if(Object.keys(w.options.expression).length!=0){S=w.options.expression.iDateJson}var I=this.container.getElement(".evolution-dialog-date");this.DatePicker=a.create(I,S,{view:"show",defaultDateBehavior:"SingleDate"},null);if(B==true){w.DatePicker.show();this.DateCheckbox.check()}else{this.DatePicker.hide()}if((r.configurationCriteria!=undefined&&r.configurationCriteria.contextualDate==false)||w.options.enabledCritData!=undefined&&w.options.enabledCritData!=null&&w.options.enabledCritData.contextualDate=="false"||w.milestoneActivationStatus=="Enabled"){this.DatePicker.hide();this.DateCheckbox.hide()}var C=this.modal.getContent().getElements(".modal-body")[0];C.addClassName("cfgEvoCritModalVariableHeight");C.setStyle("overflowY","auto");var O=this.modal.getContent().getElements(".modal-content")[0];O.setStyle("width","99%");this.toggles=this.modal.getContent().getElements(".toggle-primary");this.modal.getContent().getElements(".btn-primary").forEach(function(V){V.addEvent("click",function(ae){if(w.UnitComponent.validate()==false){return}var ab=w.buildData();console.log(ab);if(ab==null){return}w.options.selectedmodel.set("expression",ab);var Y="";var af="";if(w.options.mode=="Applicability"){Y=w.options.selectedcollection.getGlobalChangeExpression();af=w.options.selectedmodel.getContextEvolutionExpression()}else{if(w.options.mode=="EditEvolution"){Y=w.options.selectedcollection.getGlobalEvolutionExpression();af=w.options.selectedmodel.getContextEvolutionExpression()}else{if(w.options.mode=="SessionEffectivity"){Y=w.options.selectedcollection.getGlobalSessionExpression();af=w.options.selectedmodel.getContextSessionExpression()}}}Y=Y.replace(/&(?!amp;)/g,"&amp;");w.globalexpression=Y;console.log(Y);var aa=n.getDisplayExpressionUsingXSLT(af);if(aa==null||aa==undefined||aa==""){aa=w.options.emptyContextText}w.options.selectedmodel.set("displayexpression",aa);var Z=null;if(w.options.mode=="Applicability"){if(Y==""){w.modal.destroy();return}Z=new Promise(function(ak,aj){var ah=function(am,an){aj(an)};var ag=n.getChangeUrl(w.options.objectid,"PUT");var al=function(am){ak(am)};var ai={};if(r.type=="Change Action"){ai={version:"v0",changeaction:{modify:{applicability:{xml:w.globalexpression}}}}}else{ai={version:"1.0",applicability:{xml:w.globalexpression}}}var ai=JSON.stringify(ai);n.makeWSCall(ag,"PUT","enovia","application/json",ai,al,ah,true)});Z.then(function(ag){w.modal.destroy();n.showwarning(q.Save_Successful_Applicability,"success")},function(ag){w.modal.destroy();n.showwarning(ag.errorMessage,"error")})}else{if(w.options.mode=="SessionEffectivity"){if(w.UnitComponent.validate()==false){return}var ab=w.buildData();console.log(ab);if(ab==null){return}w.modal.destroy()}else{if(w.options.mode=="EditEvolution"){var X=function(ai){for(var aj in ai.expressions){if(ai.expressions.hasOwnProperty(aj)){if(ai.expressions[aj].content!=undefined&&ai.expressions[aj].content.Evolution!=undefined){if(ai.expressions[aj].content.Evolution.Current!=undefined){var ah=ai.expressions[aj].content.Evolution.Current;ai.expressions[aj].content.Evolution.currentDisplayExpression=n.getDisplayExpressionUsingXSLT(ah)}if(ai.expressions[aj].content.Evolution.Projected!=undefined){var ag=ai.expressions[aj].content.Evolution.Projected;ai.expressions[aj].content.Evolution.projectedDisplayExpression=n.getDisplayExpressionUsingXSLT(ag)}}}}if(e.postCloseHandler){e.postCloseHandler(ai)}if(e.PADContext){e.PADContext.get().getPADTreeDocument().withTransactionUpdate(function(){n.refreshEffectvity(e.selectedNodes,"Evolution","All")})}w.modal.destroy();if((ai.expressions!==undefined&&ai.expressions[w.options.objectid].status.toUpperCase()==="SUCCESS"&&ai.expressions[w.options.objectid].hasEffectivity.toUpperCase()!=="ERROR")||(ai.unset!==undefined&&(ai.unset.Evolution.status.toUpperCase()==="SUCCESS"||ai.unset.Evolution.status.toUpperCase()==="WARNING"))){n.showwarning(q.Save_Successful_Evo_Effectivity,"success")}else{n.showwarning(q.Save_Fail_Evo_Effectivity,"error")}};var W=function(ag){w.modal.destroy();n.showwarning(q.Save_Fail_Evo_Effectivity,"error")};var ad=null;if(w.options.dialogue.ca.headers.length>0){ad={operationheader:{key:w.options.dialogue.ca.headers[0].key,value:w.options.dialogue.ca.headers[0].value}}}var ac;if(w.globalexpression==""){ac={wsOptions:ad,instanceID:w.options.objectid,domain:"Evolution"};n.unsetEffectivity(ac).then(function(ag){X(ag)},function(ag){W(ag)})}else{ac={version:"1.1",domain:"Evolution",view:"All",expressionList:[{pid:w.options.objectid,expressions:[{domain:"Evolution",content:w.globalexpression}]}],wsOptions:ad};n.setMultipleFilterableObjectInfo(ac).then(function(ag){X(ag)},function(ag){W(ag)})}}}}})});var M=this.modal.getContent().getElements(".modal-footer")[0];M.getElements(".btn-default").forEach(function(V){V.addEvent("click",function(W){w.modal.destroy()})});this.modal.getContent().getElements(".modal-content")[0].setStyle("text-align","left");this.modal.show()},processmilestones:function(){var t=r.getDictionaryByCriteria(this.options.expression.modelId,"milestones");var s={};s.parentElement=this.container.getElement(".evolution-dialog-milestones");if(Object.keys(t.milestones).length!=0&&Object.keys(this.options.expression.milestoneJson).length){var u=this.options.expression.milestoneJson;var A=u.length;for(var v=0;v<A;v++){var x=t.milestones[0].sequence;for(var y=0;y<x.length;y++){if(x[y].name==u[v].start.name){u[v].start.revision=x[y].date}}var z=u[v];for(var w=0;w<=z.length;w++){for(var y=0;y<x.length;y++){if(x[y].name==z[w].name){z[w].revision=x[y].date}}}}}s.milestoneJson=this.options.expression.milestoneJson;s.milestoneXml=this.options.expression.xmlExpression;s.modelId=this.options.expression.modelId;s.mode="MILESTONES";s.expression=this.options.expression;s.use="EFFECTIVITY";this.milestoneComponent=new h(s);this.milestoneComponent.render();if(this.options.expression.milestoneCheckbox==true){this.milestoneCheckbox.check();this.milestoneComponent.show()}else{this.milestoneComponent.hide()}this.milestoneComponent.initialiseComponent();this.evolutionSpinner.hide()},buildData:function(){var w=this.ProductStateComponent.buildFilterXML();var t=this.ProductStateComponent.buildDescription();if(this.productstateCheckbox.isChecked()==false){w="";t=[]}var s=this.UnitComponent.buildUnitXML(this.options.expression.name);if(this.UnitCheckbox.isChecked()==false){s=""}var D=this.DatePicker.getXML();if(this.DateCheckbox.isChecked()==false){D=""}if(D==null){return null}var x=this.manufacturingplanComponent.buildFilterXML();var z=this.manufacturingplanComponent.buildDescription();if(this.manufacturingplanCheckbox.isChecked()==false){x="";z=[]}var C="";if(this.milestoneComponent!=undefined){C=this.milestoneComponent.buildFilterXML();if(this.milestoneCheckbox.isChecked()==false){C=""}}var u=this.ProductStateComponent.buildFilterJson();if(this.productstateCheckbox.isChecked()==false){u=[]}var v=this.DatePicker.getJSON();if(D==null||this.DateCheckbox.isChecked()==false){v={DateRanges:[]}}var B=this.UnitComponent.getJson();if(this.UnitCheckbox.isChecked()==false){B=JSON.stringify({builds:[]})}var A=this.manufacturingplanComponent.buildFilterJson();if(this.manufacturingplanCheckbox.isChecked()==false){A=[]}var y=y=[];if(this.milestoneComponent!=undefined){this.milestoneComponent.buildFilterJson();if(this.milestoneCheckbox.isChecked()==false){y=[]}}this.options.expression.psJson=u;this.options.expression.viewJson=null;this.options.expression.iDateJson=v;this.options.expression.mpJson=A;this.options.expression.iUnitJson=B;this.options.expression.milestoneJson=y;this.options.expression.xmlExpression=w;this.options.expression.psXmlDesc=t;this.options.expression.iDateXml=D;this.options.expression.iUnitXml=s;this.options.expression.impXml=x;this.options.expression.mpXmlDesc=z;this.options.expression.milestoneXml=C;this.options.expression.productstatecheckbox=this.productstateCheckbox.isChecked();this.options.expression.unitcheckbox=this.UnitCheckbox.isChecked();this.options.expression.datestatecheckbox=this.DateCheckbox.isChecked();this.options.expression.manufacturingplanstatecheckbox=this.manufacturingplanCheckbox.isChecked();return this.options.expression}});return c});define("DS/CfgEvolutionUX/CfgEvolutionCriteriaView",["DS/UIKIT/Spinner","UWA/Drivers/Alone","DS/CfgBaseUX/scripts/CfgUtility","DS/Core/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/Handlebars/Handlebars","text!DS/CfgEvolutionUX/CfgEvolutionCriteriasDialogTemplate.html","DS/CfgEvolutionUX/CfgProductState","DS/CfgEvolutionUX/CfgDatePicker","DS/CfgEvolutionUX/CfgUnit","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgXMLServices","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(l,b,n,g,p,d,o,k,j,h,a,i,r,f,q){var m=k.compile(j);var e="";var c=p.extend({name:"evolution-criteria-dialog-view",tagName:"div",init:function(s){this._parent(s);e=s},setup:function(s){},render:function(){var w=this;r.renderTo=w.options.parentElement;this.container.setHTML(m(this.options));var y=null;if(w.options.mode=="EditEvolution"){y=q.Header_EditEvolution+" - "}var v="";var L=null;var H=null;var x="";var K="";var C=true;var P=false;var z=false;var A=false;var O=null;var s="";var I=true;var M=0;if(Object.keys(w.options.expression).length!=0){v=w.options.expression.modelId;L=w.options.expression.psJson;H=w.options.expression.mpJson;C=w.options.expression.productstatecheckbox;P=w.options.expression.unitcheckbox;z=w.options.expression.datestatecheckbox;A=w.options.expression.manufacturingplanstatecheckbox;O=w.options.expression.milestoneJson;s=w.options.expression.milestoneXml;I=w.options.expression.milestoneCheckbox}var G=w.options.criteriasAvailable;var J={};J.parentElement=this.container.getElement(".evolution-dialog-productstates");J.psJson=L;J.expression=w.options.expression;J.mode="PRODUCTS";J.use="";this.productstateCheckbox=new o({type:"checkbox",value:"PSComponent",className:"primary",label:q.Product_State,events:{onChange:function(){if(this.isChecked()===true){w.ProductStateComponent.show()}else{w.ProductStateComponent.hide()}}}}).inject(this.container.getElement(".evolution-dialog-productstates-checkbox"));this.ProductStateComponent=new h(J);this.ProductStateComponent.render();if(C==true){this.productstateCheckbox.check();this.ProductStateComponent.show()}else{this.ProductStateComponent.hide()}this.ProductStateComponent.initialiseComponent();if(G.products=="False"||(w.options.enabledCritData!=null&&w.options.enabledCritData!="undefined"&&w.options.enabledCritData.productState=="false")){this.productstateCheckbox.uncheck();this.productstateCheckbox.hide();this.ProductStateComponent.hide()}var t={};t.parentElement=this.container.getElement(".evolution-dialog-manufacturingplans");t.psJson=H;t.expression=w.options.expression;t.mode="MANUFACTURINGPLAN";t.use="";this.manufacturingplanCheckbox=new o({type:"checkbox",value:"PSComponent",className:"primary",label:q.Manufacturing_Plan,events:{onChange:function(){if(this.isChecked()===true){w.manufacturingplanComponent.show()}else{w.manufacturingplanComponent.hide()}}}}).inject(this.container.getElement(".evolution-dialog-manufacturingplans-checkbox"));this.manufacturingplanComponent=new h(t);this.manufacturingplanComponent.render();if(A==true){this.manufacturingplanCheckbox.check();this.manufacturingplanComponent.show()}else{this.manufacturingplanComponent.hide()}this.manufacturingplanComponent.initialiseComponent();if(G.manufacturingPlans=="False"||(w.options.enabledCritData!=null&&w.options.enabledCritData!="undefined"&&w.options.enabledCritData.manufacturingPlan=="false")){this.manufacturingplanCheckbox.uncheck();this.manufacturingplanCheckbox.hide();this.manufacturingplanComponent.hide()}this.UnitCheckbox=new o({type:"checkbox",value:"UnitComponent",className:"primary",label:q.Unit,events:{onChange:function(){if(this.isChecked()===true){w.UnitComponent.show()}else{w.UnitComponent.hide()}}}}).inject(this.container.getElement(".evolution-dialog-unit-checkbox"));this.UnitCheckbox.elements.container.getElement(".control-label").addClassName("unitlabel");var B=null;var u=false;if(Object.keys(w.options.expression).length!=0){B=w.options.expression.iUnitJson;if(JSON.parse(w.options.expression.iUnitJson).builds.length){u=true}}var D=this.container.getElement(".evolution-dialog-unit");this.UnitComponent=new i({parentElement:D,mode:"UNIT",expression:w.options.expression,invokeFrom:""});this.UnitComponent.render();this.UnitComponent.SetJson(B);if(P==true){this.UnitComponent.show();this.UnitCheckbox.check()}else{this.UnitComponent.hide()}if((r.configurationCriteria!=undefined&&r.configurationCriteria.unit==false)||G.builds=="FALSE"||(w.options.enabledCritData!=null&&w.options.enabledCritData!="undefined"&&w.options.enabledCritData.unit=="false")){this.UnitCheckbox.uncheck();this.UnitCheckbox.hide();this.UnitComponent.hide()}else{this.UnitComponent.initialiseComponent()}if(w.options.enabledCritData==undefined){w.options.enabledCritData={milestone:"true"}}if(G.milestones!="False"){var E=n.checkMilestoneActivation();E.then(function(Q){w.milestoneActivationStatus=Q;if(Q=="Enabled"&&(w.options.enabledCritData!=undefined&&w.options.enabledCritData!=null&&w.options.enabledCritData.milestone=="true")){w.milestoneCheckbox=new o({type:"checkbox",value:"MSComponent",className:"primary",label:q.Milestone,events:{onChange:function(){if(this.isChecked()===true){w.milestoneComponent.show()}else{w.milestoneComponent.hide()}}}}).inject(w.container.getElement(".evolution-dialog-milestones-checkbox"));w.milestoneCheckbox.check();w.DateCheckbox.hide();w.DatePicker.hide();w.evolutionSpinner=new l({className:"evolutionSpinner"}).inject(w.container.getElement(".evolution-dialog-milestones"));w.evolutionSpinner.spin();w.evolutionSpinner.show();var S=r.getDictionaryByCriteria(w.options.expression.modelId,"milestones");if(S.milestones==null){var R=n.getDictionaryFromServer(w.options.expression.modelId,"milestones=1&attributes");R.then(function(T){r.addDictionaryByCriteria(w.options.expression.modelId,T,"milestones");w.processmilestones()})}else{w.processmilestones()}}},function(Q){})}this.DateCheckbox=new o({type:"checkbox",value:"DateComponent",className:"primary",label:q.Date,checked:false,events:{onChange:function(){if(this.isChecked()===true){w.DatePicker.show()}else{w.DatePicker.hide()}}}}).inject(this.container.getElement(".evolution-dialog-date-checkbox"));var N=null;if(Object.keys(w.options.expression).length!=0){N=w.options.expression.iDateJson}var F=this.container.getElement(".evolution-dialog-date");this.DatePicker=a.create(F,N,{view:"show",defaultDateBehavior:"SingleDate"},null);if(z==true){w.DatePicker.show();this.DateCheckbox.check()}else{this.DatePicker.hide()}if((r.configurationCriteria!=undefined&&r.configurationCriteria.contextualDate==false)||w.options.enabledCritData!=undefined&&w.options.enabledCritData!=null&&w.options.enabledCritData.contextualDate=="false"||w.milestoneActivationStatus=="Enabled"){this.DatePicker.hide();this.DateCheckbox.hide()}this.toggles=this.container.getElements(".toggle-primary");this.inject(this.options.parent)},onOKHandler:function(C){var A=this;if(this.UnitComponent.validate()==false){return}var x=this.buildData();console.log(x);if(x==null){return}this.options.selectedmodel.set("expression",x);var u="";var B="";u=this.options.selectedcollection.getGlobalEvolutionExpression();B=this.options.selectedmodel.getContextEvolutionExpression();u=u.replace(/&(?!amp;)/g,"&amp;");this.globalexpression=u;console.log(u);var w=n.getDisplayExpressionUsingXSLT(B);if(w==null||w==undefined||w==""){w=this.options.emptyContextText}this.options.selectedmodel.set("displayexpression",w);if(C!=undefined){return}var v=null;var t=function(F){for(var G in F.expressions){if(F.expressions.hasOwnProperty(G)){if(F.expressions[G].content!=undefined&&F.expressions[G].content.Evolution!=undefined){if(F.expressions[G].content.Evolution.Current!=undefined){var E=F.expressions[G].content.Evolution.Current;F.expressions[G].content.Evolution.currentDisplayExpression=n.getDisplayExpressionUsingXSLT(E)}if(F.expressions[G].content.Evolution.Projected!=undefined){var D=F.expressions[G].content.Evolution.Projected;F.expressions[G].content.Evolution.projectedDisplayExpression=n.getDisplayExpressionUsingXSLT(D)}}}}if(e.postCloseHandler){e.postCloseHandler(F)}if(e.PADContext){e.PADContext.get().getPADTreeDocument().withTransactionUpdate(function(){n.refreshEffectvity(e.selectedNodes,"Evolution","All")})}if((F.expressions!==undefined&&F.expressions[A.options.objectid].status.toUpperCase()==="SUCCESS"&&F.expressions[A.options.objectid].hasEffectivity.toUpperCase()!=="ERROR")||(F.unset!==undefined&&(F.unset.Evolution.status.toUpperCase()==="SUCCESS"||F.unset.Evolution.status.toUpperCase()==="WARNING"))){n.showwarning(q.Save_Successful_Evo_Effectivity,"success")}else{n.showwarning(q.Save_Fail_Evo_Effectivity,"error")}};var s=function(D){n.showwarning(q.Save_Fail_Evo_Effectivity,"error")};var z=null;if(this.options.dialogue.ca.headers.length>0){z={operationheader:{key:this.options.dialogue.ca.headers[0].key,value:this.options.dialogue.ca.headers[0].value}}}var y;if(this.globalexpression==""){y={wsOptions:z,instanceID:this.options.objectid,domain:"Evolution"};n.unsetEffectivity(y).then(function(D){t(D)},function(D){s(D)})}else{y={version:"1.1",domain:"Evolution",view:"All",expressionList:[{pid:this.options.objectid,expressions:[{domain:"Evolution",content:this.globalexpression}]}],wsOptions:z};n.setMultipleFilterableObjectInfo(y).then(function(D){t(D)},function(D){s(D)})}},processmilestones:function(){var t=r.getDictionaryByCriteria(this.options.expression.modelId,"milestones");var s={};s.parentElement=this.container.getElement(".evolution-dialog-milestones");if(Object.keys(t.milestones).length!=0&&Object.keys(this.options.expression.milestoneJson).length){var u=this.options.expression.milestoneJson;var A=u.length;for(var v=0;v<A;v++){var x=t.milestones[0].sequence;for(var y=0;y<x.length;y++){if(x[y].name==u[v].start.name){u[v].start.revision=x[y].date}}var z=u[v];for(var w=0;w<=z.length;w++){for(var y=0;y<x.length;y++){if(x[y].name==z[w].name){z[w].revision=x[y].date}}}}}s.milestoneJson=this.options.expression.milestoneJson;s.milestoneXml=this.options.expression.xmlExpression;s.modelId=this.options.expression.modelId;s.mode="MILESTONES";s.expression=this.options.expression;s.use="";this.milestoneComponent=new h(s);this.milestoneComponent.render();if(this.options.expression.milestoneCheckbox==true){this.milestoneCheckbox.check();this.milestoneComponent.show()}else{this.milestoneComponent.hide()}this.milestoneComponent.initialiseComponent();this.evolutionSpinner.hide()},buildData:function(){var w=this.ProductStateComponent.buildFilterXML();var t=this.ProductStateComponent.buildDescription();if(this.productstateCheckbox.isChecked()==false){w="";t=[]}var s=this.UnitComponent.buildUnitXML(this.options.expression.name);if(this.UnitCheckbox.isChecked()==false){s=""}var D=this.DatePicker.getXML();if(this.DateCheckbox.isChecked()==false){D=""}if(D==null){return null}var x=this.manufacturingplanComponent.buildFilterXML();var z=this.manufacturingplanComponent.buildDescription();if(this.manufacturingplanCheckbox.isChecked()==false){x="";z=[]}var C="";if(this.milestoneComponent!=undefined){C=this.milestoneComponent.buildFilterXML();if(this.milestoneCheckbox.isChecked()==false){C=""}}var u=this.ProductStateComponent.buildFilterJson();if(this.productstateCheckbox.isChecked()==false){u=[]}var v=this.DatePicker.getJSON();if(D==null||this.DateCheckbox.isChecked()==false){v={DateRanges:[]}}var B=this.UnitComponent.getJson();if(this.UnitCheckbox.isChecked()==false){B=JSON.stringify({builds:[]})}var A=this.manufacturingplanComponent.buildFilterJson();if(this.manufacturingplanCheckbox.isChecked()==false){A=[]}var y=y=[];if(this.milestoneComponent!=undefined){this.milestoneComponent.buildFilterJson();if(this.milestoneCheckbox.isChecked()==false){y=[]}}this.options.expression.psJson=u;this.options.expression.viewJson=null;this.options.expression.iDateJson=v;this.options.expression.mpJson=A;this.options.expression.iUnitJson=B;this.options.expression.milestoneJson=y;this.options.expression.xmlExpression=w;this.options.expression.psXmlDesc=t;this.options.expression.iDateXml=D;this.options.expression.iUnitXml=s;this.options.expression.impXml=x;this.options.expression.mpXmlDesc=z;this.options.expression.milestoneXml=C;this.options.expression.productstatecheckbox=this.productstateCheckbox.isChecked();this.options.expression.unitcheckbox=this.UnitCheckbox.isChecked();this.options.expression.datestatecheckbox=this.DateCheckbox.isChecked();this.options.expression.manufacturingplanstatecheckbox=this.manufacturingplanCheckbox.isChecked();return this.options.expression}});return c});