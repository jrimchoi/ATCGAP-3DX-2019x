define("DS/MPFPurchaseOrderComponent/PurchaseOrderUploadForm",["UWA/Core","UWA/Promise","UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Input/File","DS/PlatformAPI/PlatformAPI","DS/MPFView/FieldTextInputV2","DS/MPFPurchaseOrderModel/PurchaseOrderModel","DS/MPFPurchaseOrderModel/PurchaseOrderDocumentModel","DS/MPFCartModel/CartModel","DS/MPFError/ValidationError","DS/MPFServices/ObjectService","i18n!DS/MPFPurchaseOrderComponent/assets/nls/PurchaseOrderComponent","css!DS/MPFUI/MPFUI","css!DS/MPFPurchaseOrderComponent/MPFPurchaseOrderComponent"],function(o,k,a,m,b,h,l,c,d,e,g,n,j,f){var i;i=a.extend({className:"mpf-purchase-order-upload-form",setup:function(p){j.requiredOfPrototype(this.model,d,"options.model must be a PurchaseOrderModel");j.requiredOfPrototype(p.purchaseOrderDocument,e,"options.purchaseOrderDocument must be a purchaseOrderDocument");j.requiredOfPrototype(p.cart,g,"options.cart must be a CartModel");this.purchaseOrder=this.model;this.purchaseOrderDocument=p.purchaseOrderDocument;this.cart=p.cart;this.warningMessage=this._createWarningMessage();this.purchaseOrderNumberField=this._createPurchaseOrderNumberField();this.purchaseOrderLabelField=this._createPurchaseOrderLabelField();this.financialExpenseLineField=this._createBankCardExpenseFinancialLineField();this.purchaseOrderFileField=this._createPurchaseOrderFileField()},render:function(){this.container.setContent([this.warningMessage,this.purchaseOrderNumberField.render(),this.purchaseOrderLabelField.render(),this.financialExpenseLineField.render(),this.purchaseOrderFileField]);return this},validate:function(){var r;var q;var p;r=this.purchaseOrderNumberField.validate().isValid;q=this.purchaseOrderLabelField.validate().isValid;p=this._validatePurchaseOrderFileField();return r&&q&&p},save:function(){var p;if(this.validate()){p=this._savePurchaseOrderFile().then(this._updatePurchaseOrderWithDocumentId.bind(this)).then(this._savePurchaseOrder.bind(this)).then(this._updateCart.bind(this)).then(this._onSaveSuccess.bind(this))["catch"](this._onSaveFailure.bind(this))}else{p=k.reject(new n())}return k.cast(p)},setPurchaseOrderNumber:function(p){this.purchaseOrderNumberField.setValue(p)},setPurchaseOrderLabel:function(p){this.purchaseOrderLabelField.setValue(p)},setFinancialExpenseLine:function(p){this.financialExpenseLineField.setValue(p)},reset:function(){this.purchaseOrderNumberField.resetValue();this.purchaseOrderLabelField.resetValue();this.financialExpenseLineField.resetValue();this.fileInput.clear();this._removeRedBorders()},_savePurchaseOrderFile:function(){var p;p=this.fileInput.getContent().getElement("input").files[0];return this.purchaseOrderDocument.saveFile(p)},_updatePurchaseOrderWithDocumentId:function(){this.purchaseOrder.setDocumentId(this.purchaseOrderDocument.id)},_savePurchaseOrder:function(){return this.purchaseOrder.savePromise()},_onSaveSuccess:function(){this.dispatchEvent("purchaseOrderUploaded");l.publish("MPCartTimeline",{event:"refresh",cartId:this.cart.id})},_onSaveFailure:function(){new m({messageClassName:"error",closable:true,visible:true,messages:f.get("anErrorOccured")}).inject(this.container,"top")},_createWarningMessage:function(){return o.createElement("div",{"class":"alert-message alert-warning alert-has-icon",html:[{tag:"span","class":"icon fonticon"},{tag:"span",text:f.get("uploadWarning")}]})},_createPurchaseOrderNumberField:function(){return new c({model:this.model,fieldName:"number",fieldLabel:f.get("purchaseOrderNumber"),required:true,readOnly:false,dynamicValidation:true})},_createBankCardExpenseFinancialLineField:function(){return new c({model:this.cart,fieldName:g.Fields.EXPENSE_FINANCIAL_LINE,fieldLabel:f.get("expenseFinancialLine")})},_createPurchaseOrderLabelField:function(){return new c({model:this.model,fieldName:"label",fieldLabel:f.get("purchaseOrderLabel"),required:false,readOnly:false,dynamicValidation:false})},_createPurchaseOrderFileField:function(){this.fileInput=new h({name:"document",buttonText:f.get("purchaseOrderFile"),events:{onChange:this._validatePurchaseOrderFileField.bind(this)}});return o.createElement("div",{"class":"mpf-entry",html:[{tag:"label",html:[{tag:"span","class":"mpf-label",html:[f.get("purchaseOrderDocument"),'&nbsp;<span class="mpf-required">*</span>']},this.fileInput]}]})},_validatePurchaseOrderFileField:function(){var p;var q;p=!!(this.fileInput.getValue());q=this.fileInput.getContent().getElement(".form-control");if(p){q.removeClassName("mpf-invalidField")}else{q.addClassName("mpf-invalidField")}return p},_updateCart:function(){var q;var p={};q=this.financialExpenseLineField.getValue();if(q){p[g.Fields.EXPENSE_FINANCIAL_LINE]=q}p[g.Fields.STATE]=g.STATUS.paymentAccepted;return this.cart.savePromise(p,{patch:true})},_removeRedBorders:function(){this.fileInput.elements.textfield.removeClassName("mpf-invalidField")}});return i});define("DS/MPFPurchaseOrderComponent/PurchaseOrderUploadModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFPurchaseOrderComponent/PurchaseOrderUploadForm","DS/MPFPurchaseOrderModel/PurchaseOrderModel","DS/MPFPurchaseOrderModel/PurchaseOrderDocumentModel","DS/MPFCartModel/CartModel","DS/MPFServices/ObjectService","i18n!DS/MPFPurchaseOrderComponent/assets/nls/PurchaseOrderComponent"],function(i,b,a,c,d,k,e,f,h,l,g){var j=b.extend({className:"mpf-purchase-order-upload-modal",setup:function(m){l.requiredOfPrototype(this.model,e,"options.model must be a PurchaseOrderModel");l.requiredOfPrototype(m.purchaseOrderDocument,f,"options.purchaseOrderDocument must be a purchaseOrderDocument");l.requiredOfPrototype(m.cart,h,"options.cart must be a CartModel");this.purchaseOrder=this.model;this.purchaseOrderDocument=m.purchaseOrderDocument;this.cart=m.cart;this.purchaseOrderUploadForm=this._createPurchaseOrderUploadForm();this.saveButton=this._createSaveButton();this.modal=this._createUploadModal(this.saveButton)},render:function(){this.modal.setBody([this.purchaseOrderUploadForm.render()]);return this},save:function(){var m=this;d.mask(this.modal.getBody());return this.purchaseOrderUploadForm.save().then(function(){m.modal.hide()})["finally"](function(){d.unmask(m.modal.getBody())})},show:function(){this.modal.show()},onHide:function(){this.purchaseOrderUploadForm.reset()},destroy:function(){this.purchaseOrderUploadForm.destroy();this.saveButton.destroy();this.modal.destroy();this.purchaseOrderUploadForm=null;this.saveButton=null;this.modal=null;this.purchaseOrder=null;this.purchaseOrderDocument=null;this.cart=null;this._parent();this.container=null},_createPurchaseOrderUploadForm:function(){return new k({model:this.purchaseOrder,purchaseOrderDocument:this.purchaseOrderDocument,cart:this.cart})},_createSaveButton:function(){return new c({value:g.get("save"),className:"primary",events:{onClick:this.save.bind(this)}})},_createUploadModal:function(m){return new a({className:"mpf-purchase-upload-modal",header:g.get("purchaseOrder"),footer:m,renderTo:document.body,events:{onHide:this.onHide.bind(this)}})}});return j});define("DS/MPFPurchaseOrderComponent/PurchaseOrderUploadNoticeBodyComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFPurchaseOrderModel/PurchaseOrderModel","DS/MPFPurchaseOrderModel/PurchaseOrderDocumentModel","DS/MPFPurchaseOrderComponent/PurchaseOrderUploadModal","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","DS/MPFServices/ObjectService","i18n!DS/MPFPurchaseOrderComponent/assets/nls/PurchaseOrderComponent","css!DS/UIKIT/UIKIT"],function(e,a,g,b,c,h,f,l,k,j,d){var i=a.extend({className:"clearfix",setup:function(m){m||(m={});j.requiredOfPrototype(this.model,b,"options.model must be a PurchaseOrderModel");j.requiredOfPrototype(m.purchaseOrderDocument,c,"options.purchaseOrderDocument must be a purchaseOrderDocument");j.requiredOfPrototype(m.cart,f,"options.cart must be a CartModel");this.purchaseOrder=this.model;this.purchaseOrderDocument=m.purchaseOrderDocument;this.cart=m.cart;this.message=this._createMessage();this.learnMoreLink=this._createLearnMoreLink();this.uploadPOButton=this._createUploadButton();this.uploadModal=this._createUploadModal()},render:function(){var m;m=[this.message,this.learnMoreLink,this.uploadPOButton,this.uploadModal.render()];this.container.setContent(m);return this},destroy:function(){this.stopListening();this.uploadPOButton.destroy();this.uploadPOButton=null;this.purchaseOrder=null;this.purchaseOrderDocument=null;this.cart=null;this._parent();this.container=null},_createMessage:function(){return e.createElement("p",{"class":"mpf-message",text:d.get("purchaseOrderNoticeMessage")})},_createLearnMoreLink:function(){return e.createElement("a",{"class":"mpf-link",href:"/faq/proceed-to-deferred-payment",text:d.get("learnMoreAboutDifferedPayment"),target:"_blank"})},_createUploadButton:function(){return new g({className:"primary",value:d.get("uploadPurchaseOrder"),events:{onClick:this._showModal.bind(this)}})},_createUploadModal:function(){return new h({model:this.purchaseOrder,purchaseOrderDocument:this.purchaseOrderDocument,cart:this.cart})},_showModal:function(){this.uploadModal.show()},_destroyModal:function(m){this.stopListening(m);this.uploadModal.destroy()}});return i});define("DS/MPFPurchaseOrderComponent/PurchaseOrderUploadNoticeComponent",["UWA/Class/View","DS/MPFNoticeComponent/ImportantNoticeComponent","DS/MPFPurchaseOrderComponent/PurchaseOrderUploadNoticeBodyComponent","DS/MPFPurchaseOrderModel/PurchaseOrderModel","DS/MPFPurchaseOrderModel/PurchaseOrderDocumentModel","DS/MPFCartModel/CartModel","DS/MPFServices/ObjectService"],function(h,g,d,a,e,c,b){var f;f=h.extend({setup:function(i){b.requiredOfPrototype(this.model,a,"options.model must be a PurchaseOrderModel");b.requiredOfPrototype(i.purchaseOrderDocument,e,"options.purchaseOrderDocument must be a purchaseOrderDocument");b.requiredOfPrototype(i.cart,c,"options.cart must be a CartModel");this.purchaseOrder=this.model;this.purchaseOrderDocument=i.purchaseOrderDocument;this.cart=i.cart;this.body=new d({model:this.purchaseOrder,purchaseOrderDocument:i.purchaseOrderDocument,cart:this.cart});this.notice=new g({body:this.body})},render:function(){this.container=this.notice.render();return this}});return f});