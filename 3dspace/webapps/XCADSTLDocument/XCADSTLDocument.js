define("DS/XCADSTLDocument/STLTessellatedRepresentation",["DS/XCADInputDocuments/XCADTessellatedRepresentation","DS/XCADInputDocuments/XCADRepresentation","DS/XCADInputDocuments/XCADFaceData"],function(d,f,b){var a={TESSELLATED_SOLID:d.KindOfNode.NOD_SolidNode,TRIANGULATED_FACE:d.KindOfNode.NOD_GP};var c={TRIANGULATED_FACE:d.KindOfGP.GP_Face};var e=d.extend(function e(g,h){this._associatedDocument=g;this._representationType=f.XCAD_TESSELLATED_REPRESENTATION;this._stlRepresentationIndex=h;this._rootNodes=[];this._rootNodes.push("root0")},{getChild:function(h,g){return"child0"},getChildCount:function(g){return 1},getCircleData:function(g){throw"Error: not implemented method"},getConeData:function(g){throw"Error: not implemented method"},getCoordinateSystem:function(g){throw"Error: not implemented method"},getCylinderData:function(g){throw"Error: not implemented method"},getEdgeData:function(g){throw"Error: not implemented method"},getFaceData:function(h){var g=new b();g.vertices=this._associatedDocument.vertices;g.normals=this._associatedDocument.normals;return g},getGPType:function(g){return c.TRIANGULATED_FACE},getNodeBoundingSphere:function(g){throw"Error: not implemented method"},getNodeColor:function(g){return[0.825,0.825,1]},getNodeOrientationMatrix:function(g){throw"Error: not implemented method"},getNodeType:function(h){var g=null;if(h==="root0"){g=a.TESSELLATED_SOLID}else{g=a.TRIANGULATED_FACE}return g},getNodeUID:function(g){throw"Error: not implemented method"},getPlaneData:function(g){throw"Error: not implemented method"},getPointData:function(g){throw"Error: not implemented method"},getPolyLineData:function(g){throw"Error: not implemented method"},getRootNode:function(g){return this._rootNodes[g]},getRootNodesCount:function(){return this._rootNodes.length},getSAG:function(g){throw"Error: not implemented method"},getSphereData:function(g){throw"Error: not implemented method"},isIndexed:function(){return false},});return e});define("DS/XCADSTLDocument/STLInputDocument",["DS/XCADInputDocuments/XCADInputDocument","DS/XCADInputDocuments/XCADRepresentation","DS/XCADSTLDocument/STLTessellatedRepresentation"],function(a,e,d){var b={TESSELLATED_SHAPE_REPRESENTATION:e.XCAD_TESSELLATED_REPRESENTATION,"AUTRES REPRESENTATIONS":"A REMPLACER PAR LA CONSTANTE XCAD ADEQUATE"};var c=a.extend(function c(){this.vertices=[];this.normals=[];this.singleTrianglesIndices=[];this.percentBetweenEachProgressCB=20},{zipped:false,requestResponseType:"arraybuffer",close:function(){},getRepresentation:function(g){var f;if(g===e.XCAD_TESSELLATED_REPRESENTATION){f=new d(this,"ascii")}return f},initialize:function(q){if(q===""){return}var s=0;var l=new Date().getTime();var k=this._ensureArrayBuffer(q);var o=new Date().getTime(),s=o-l;var j=new Date().getTime();if(this._isStlBinary(k)){var m=new Date().getTime();s=m-j;var r=new Date().getTime();this._parseBinary(k);var f=new Date().getTime();s=f-r}else{var m=new Date().getTime();s=m-j;var p=new Date().getTime();var i=this._ensureString(q);var g=new Date().getTime();s=g-p;var h=new Date().getTime();this._parseASCII(i);var n=new Date().getTime();s=n-h}},_isStlBinary:function(o){var q,h,s,l;l=new DataView(o);var j=o.slice(0,123);var r=new Uint8Array(j);var p="";var n=/solid/i;var g=/facet/i;for(var k=0;k<r.length;k++){p+=String.fromCharCode(r[k])}var f=p.match(n);var m=p.match(g);if(f&&f!==-1){if(m&&m!==-1){return false}}return true},_ensureString:function(m){if(typeof m!=="string"){var l=new Map();var g=new WeakMap();var i=65536;var f=m.byteLength;if(f<i){return String.fromCharCode.apply(null,new Uint8Array(m))}else{var h=0,j="";while(h<f){j+=String.fromCharCode.apply(null,new Uint8Array(m.slice(h,h+i)));h+=i}return j}}else{return m}},_ensureArrayBuffer:function(h){if(typeof h==="string"){var g=new Uint8Array(h.length);for(var f=0;f<h.length;f++){g[f]=h.charCodeAt(f)&255}return g.buffer||g}else{return h}},_parseASCII:function(g){var m=0;if(g===""){return}var x=g.split("endfacet").length-1;console.log("STLReader stl file content : ASCII ("+x+" faces)");var k=Math.round(x/(100/this.percentBetweenEachProgressCB));var B=0+k;var l=/vertex/;var w=/vertex\s+([^\s]+)\s+([^\s]+)\s+([^\s]+)/i;var z=/facet\s+normal\s+([^\s]+)\s+([^\s]+)\s+([^\s]+)/i;var f=g.split("\n");g="";var A=[];var h=0;var i=0;for(var q=0;q<f.length;q++){var n="";var o=null;n=f[q].trim();if((o=w.exec(n))!==null){var v=parseFloat(o[1].replace(",","."));var u=parseFloat(o[2].replace(",","."));var t=parseFloat(o[3].replace(",","."));if(i===1){A.push(v);A.push(u);A.push(t);h++;if(h===3){m+=this._ComputeNormal(A);h=0;i=0;A=null;A=[]}}this.vertices.push(parseFloat(o[1].replace(",",".")));this.vertices.push(parseFloat(o[2].replace(",",".")));this.vertices.push(parseFloat(o[3].replace(",",".")))}else{if((o=z.exec(n))!==null){var s=parseFloat(o[1].replace(",","."));var r=parseFloat(o[2].replace(",","."));var p=parseFloat(o[3].replace(",","."));if(s===0&&r===0&&p===0){i=1}if(i===0){for(var y=0;y<3;y++){this.normals.push(s);this.normals.push(r);this.normals.push(p)}}}}}f.length=0;f=null},_parseBinary:function(i){var g=new DataView(i);i=null;var h=g.getUint32(80,false);var f=g.getUint32(80,true);var j=g.byteLength;j=(j-84)*0.02;if(f>0&&h<0){this._ReadLittleEndian(g,f)}else{if(h>0&&f<0){if(nbSwat>j){this._ReadBigEndian(g,j)}else{this._ReadBigEndian(g,h)}}else{if(f<=j&&j<h){this._ReadLittleEndian(g,f)}else{if(h<=j&&j<=f){this._ReadBigEndian(g,h)}else{if(f<=j&&j<=h){if(h<f){this._ReadLittleEndian(g,f)}else{this._ReadBigEndian(g,h)}}else{if(j<f&&j<h){if(f<h){this._ReadLittleEndian(g,j)}else{this._ReadBigEndian(g,j)}}else{console.log("Error !!!!!!!!")}}}}}}},_ReadLittleEndian:function(f,x){console.log("STLReader stl file content : BINARY ("+x+" faces)");var q=0;var l=0;var s=84;var B=50;var o=0;var w=0;x=Math.round(x);var p=Math.round(x/(100/this.percentBetweenEachProgressCB));var A=0+p;for(var r=0;r<x;r++){var n=s+r*B;var k=f.getFloat32(n,true);var j=f.getFloat32(n+4,true);var h=f.getFloat32(n+8,true);var m=0;var z=[];if(k===0&&j===0&&h===0){m=1}for(var y=1;y<=3;y++){var g=n+y*12;var v=f.getFloat32(g,true);var u=f.getFloat32(g+4,true);var t=f.getFloat32(g+8,true);this.vertices.push(v);this.vertices.push(u);this.vertices.push(t);if(m===0){this.normals.push(k);this.normals.push(j);this.normals.push(h)}else{z.push(v);z.push(u);z.push(t)}o+=3;w+=4}if(m===1){q+=this._ComputeNormal(z);m=0;z=null}if((this.normals.length/9)===A){A+=p}}},_ReadBigEndian:function(f,t){console.log("STLReader stl file content : BINARY ("+t+" faces)");var p=0;var r=84;var x=50;var n=0;var s=0;t=Math.round(t);var o=Math.round(t/(100/this.percentBetweenEachProgressCB));var w=0+o;for(var q=0;q<t;q++){var m=r+q*x;var k=f.getFloat32(m,false);var j=f.getFloat32(m+4,false);var h=f.getFloat32(m+8,false);var l=0;var v=[];if(k===0&&j===0&&h===0){l=1}for(var u=1;u<=3;u++){var g=m+u*12;this.vertices.push(f.getFloat32(g,false));this.vertices.push(f.getFloat32(g+4,false));this.vertices.push(f.getFloat32(g+8,false));if(l===0){this.normals.push(k);this.normals.push(j);this.normals.push(h)}else{v.push(f.getFloat32(g,false));v.push(f.getFloat32(g+4,false));v.push(f.getFloat32(g+8,false))}n+=3;s+=4}if(l===1){p+=this._ComputeNormal(v);l=0;v=null}if((this.normals.length/9)===w){w+=o}}},_ComputeNormal:function(f){var i=new Date().getTime();var l=[],k=[];l[0]=f[3]-f[0];l[1]=f[4]-f[1];l[2]=f[5]-f[2];k[0]=f[6]-f[0];k[1]=f[7]-f[1];k[2]=f[8]-f[2];var q=l[1]*k[2]-l[2]*k[1];var p=l[2]*k[0]-l[0]*k[2];var n=l[0]*k[1]-l[1]*k[0];var h=q*q+p*p+n*n;var o=0;if(h!==0){o=1/Math.sqrt(h)}q*=o;p*=o;n*=o;for(var g=0;g<3;g++){this.normals.push(q);this.normals.push(p);this.normals.push(n)}l=null;k=null;var m=new Date().getTime();return(m-i)},_IsComputeNormal:function(f){var k=[],i=[];k[0]=f[3]-f[0];k[1]=f[4]-f[1];k[2]=f[5]-f[2];i[0]=f[6]-f[0];i[1]=f[7]-f[1];i[2]=f[8]-f[2];var o=k[1]*i[2]-k[2]*i[1];var m=k[2]*i[0]-k[0]*i[2];var l=k[0]*i[1]-k[1]*i[0];var h=o*o+m*m+l*l;if(h){return false}var n=1/Math.sqrt(h);if(n){return false}o*=n;m*=n;l*=n;for(var g=0;g<3;g++){this.normals.push(o);this.normals.push(m);this.normals.push(l)}k=null;i=null;return true},_MergeVertices:function(){var G=new Date().getTime();var g={};var f=[],H=[],v=[];var x,w,t,I;var r=4;var C=Math.pow(10,r);var A,o,m;var h,y,z,B,q;var l=this.vertices.length/3;for(A=0,o=0;A<l;A++,o+=3){x=this.vertices[o];w=this.vertices[o+1];t=this.vertices[o+2];I=Math.round(x*C)+"_"+Math.round(w*C)+"_"+Math.round(t*C);if(g[I]===undefined){g[I]=A;f.push(this.vertices[o]);f.push(this.vertices[o+1]);f.push(this.vertices[o+2]);v.push(this.normals[o]);v.push(this.normals[o+1]);v.push(this.normals[o+2]);H[A]=(f.length)/3-1}else{H[A]=H[g[I]];v[3*H[A]]+=this.normals[o];v[3*H[A]+1]+=this.normals[o+1];v[3*H[A]+2]+=this.normals[o+2]}}function F(i){for(o=0;o<i.length;o+=3){var k=i[o]*i[o]+i[o+1]*i[o+1]+i[o+2]*i[o+2];if(k===0){continue}var j=1/Math.sqrt(k);if(j===0){continue}i[o]*=j;i[o+1]*=j;i[o+2]*=j}}F(v);var s=this.vertices.length-f.length;var E=[],n=[];for(A=0;A<H.length;A++){var o=3*H[A];E.push(f[o]);E.push(f[o+1]);E.push(f[o+2]);n.push(v[o]);n.push(v[o+1]);n.push(v[o+2])}this.vertices=E;this.normals=n;var D=new Date().getTime();var p=D-G;return s}});return c});