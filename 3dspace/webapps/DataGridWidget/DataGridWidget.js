define("DS/DataGridWidget/Collab_Scroller",["UWA/Controls/Abstract","DS/UIKIT/Scroller"],function(c,b){var a=c.extend({defaultOptions:{displayScrollers:true,setExternalHorizontalScrollbar:false,setExternalVerticalScrollbar:false,synchronizationHorizontal:false,synchronizationVertical:false},init:function(e,d){var g=this;this._parent(d);this._childElement=e;this._alreadyDimensioned=false;var f=e.getParent();this.parentElement=UWA.createElement("div",{"class":"collab_Scroller","data-rec-id":"dataRecCollabScroller"}).inject(f);e.inject(this.parentElement);this.scrollContent=this.parentElement;if(this.options.displayScrollers===false){this.parentElement.setStyle("overflow","hidden");this._childElement.setStyle("position","relative")}else{this.UIKitScroller=new b({element:this.parentElement}).inject(f);this.parentElement.setStyle("overflow","auto");this.scrollContent=this.UIKitScroller.elements.content;this.scrollContent.setAttribute("data-rec-id","dataRecscrollContent");this.scrollContent.addEventListener("scroll",function(){g.dispatchEvent("onScrollMove")})}},getPosition:function(){var d=this.scrollContent.getScrolls();return{x:d.left,y:d.top}},setPosition:function(e,d){if(this.options.displayScrollers===true){this.scrollContent.scrollLeft=e;this.scrollContent.scrollTop=d}else{this._childElement.setStyle("left",-e);this._childElement.setStyle("top",-d)}},setSize:function(e){var f=e.width;var d=e.height;if((this.options.setExternalVerticalScrollbar===true&&this.options.displayScrollers===true)||this.options.synchronizationHorizontal===true){if(!isNaN(f)){f=parseInt(f)}}if((this.options.setExternalHorizontalScrollbar===true&&this.options.displayScrollers===true)||this.options.synchronizationVertical===true){if(!isNaN(d)){d=parseInt(d)}}this.parentElement.setStyle("width",f);this.parentElement.setStyle("height",d)},});return a});define("DS/DataGridWidget/models/SheetLine",["UWA/Class"],function(c){var b=["authorizedInitialization","rollbackOnCell"];var a=c.extend({_id:null,_properties:null,_initValues:null,_changedValues:null,_rollbackOnCell:true,_eventChangeCallback:null,_color:null,_created:false,_authorizedInitialization:false,init:function(h,g,d){this._parent(d);this._properties={};this._id=h;this._initValues=null;this._changedValues=[];this._eventChangeCallback={};this._authorizedInitialization=d&&d.authorizedInitialization===true;this._rollbackOnCell=!d||d.rollbackOnCell!==false;for(var e in g){this._properties[e]=g[e]}if(d&&d.events){for(var e in d.events){var f=d.events[e];this.addEvent(e,f)}}this.saveValues()},getAvailableOptions:function(){return b},setInitializationAuthorization:function(d){this._authorizedInitialization=d},canInitialize:function(){return this._authorizedInitialization},_propertyCanChange:function(d){return true},addEvent:function(e,f){if(typeof f==="function"){var d=this._eventChangeCallback[e];if(d==null){d=[];this._eventChangeCallback[e]=d}d.push(f)}},_raiseChangeEvent:function(d){this._raiseEvent("onPropChanged:"+d,d);this._raiseEvent("onChange",d)},_raiseEvent:function(d,g){var e=this;var f=this._eventChangeCallback[d];if(f){f.forEach(function(h){h.call(e,g)})}},raiseEventsForChanges:function(d){var e=this;this.getChangedValue().forEach(function(f){if(d==null||d===f){e._raiseChangeEvent(f)}})},setRollbackOnCells:function(d){this._rollbackOnCell=d===true},isRollbackOnCells:function(){return this._rollbackOnCell},setColor:function(d){this._color=d;this._raiseEvent("onColorChanged",this._color)},getColor:function(){return this._color},getProperties:function(){return this._properties},getID:function(){return this._id},getInitialValue:function(d){return this._initValues?this._initValues[d]:undefined},getValue:function(d){return this._properties[d]},setValue:function(e,d){this._properties[e]=d},setValues:function(d){this._properties=d},changeValue:function(e,d){this.setValue(e,d);this.addChangedValue(e)},removeValue:function(d){delete this._properties[d];this.removeChangedValue(d)},getChangedValue:function(){return this._changedValues},hasChanged:function(d){return this._changedValues.indexOf(d)>=0},initIsDefined:function(){return this._initValues!==null},addChangedValues:function(d,f){var e=this;d.forEach(function(g){e.addChangedValue(g,f)})},addChangedValue:function(e,d){if((this._propertyCanChange(e)||d===true)){if(!this.hasChanged(e)){this._changedValues.push(e)}this._raiseChangeEvent(e)}},removeChangedValue:function(e){var d=this._changedValues.indexOf(e);if(d>=0){this._changedValues.splice(d,1);this._raiseChangeEvent(e)}},resetValue:function(d){this.removeChangedValue(d);delete this._properties[d];this._raiseChangeEvent(d)},saveValues:function(e){for(var d in this.getProperties()){if(!this._initValues){this._initValues={}}if(e!==false||this._initValues[d]===undefined){this._initValues[d]=this.getValue(d)}}}});return a});define("DS/DataGridWidget/DataGridWidget",["UWA/Controls/Input","UWA/Controls/Abstract","UWA/Controls/Scroller","DS/DataGridWidget/Collab_Scroller","DS/WidgetServices/WidgetServices","DS/WidgetServices/moveHelper/MoveHelper","css!DS/DataGridWidget/DataGridWidget.css"],function(f,e,b,c,j,g){var k="DGWI_";var l=j.isNatifEnvironnement()?"table-condensed":"";var a=0;var h=20;function d(r){var n=r.getElement(".HeaderArea");var q=0;var m=n.getParent();var p=m.getDimensions();var o=p.width-p.innerWidth;if(n){q=n.getSize()}return q.width+o}var i=e.extend({defaultOptions:{setHeaderColumn:true,setScroller:true,activeSelection:false,setMultiSelection:false,maxHeightScroller:"300",className:"",resizeClass:"",contextMenu:[],restrict:false,UIKitClasses:"table-striped table-hover "+l},init:function(n,m){this._parent(m);this.classResize=this.options.resizeClass?this.options.resizeClass:"DGW_DataGrid";var o=this._dispatchOnResize();if(o){j.addNewStyles(this.classResize+"_style",o,true)}this.saveElementObj={listId:[]};this.data=[];this.Column=[];this.CurrentSortColumn=-1;this.sort=true;this.container=UWA.createElement("div",{"class":"datagrid_MainContainer"});this.createMyTable().inject(this.container);if(n&&n.length>0){this.addHeader(n)}},_dispatchOnResize:function(){var m=localStorage.getItem(this.classResize+"_style");var o=null;try{o=JSON.parse(m);if(o.width<h){o.width=h}}catch(n){}if(o){this.dispatchEvent("onResizeCells",o)}return o?o.style:null},resetDisplay:function(){localStorage.removeItem(this.classResize+"_style");j.clearJSStylesheet(this.classResize+"_style");this.dispatchEvent("onResizeCells",null)},addHeader:function(o){var p=this;var m=p.MainTableHeader.getElement("thead");var n=m.getElement("tr");o.forEach(function(v,s){var t="";if(!v.hasOwnProperty("html")){v.html=""}if(v.hasOwnProperty("text")){t=UWA.createElement("div",{"class":"HeaderAreaText "+k+v.dataIndex,text:v.text,"data-rec-id":"dataRecheadertext"+v.text+s})}var u=v.fixed;if(!u){u="false"}var r=v.hidden===true?" hidden":"";var q=UWA.createElement("th",{isFixed:u,"class":v.dataIndex+r+(v.hasOwnProperty("sortable")?" DGW_Sortable":""),dataIndex:v.dataIndex,html:[{tag:"table","class":"HeaderArea "+k+v.dataIndex,html:[t,{tag:"div","class":"HeaderAreaHtml",html:v.html}]}]});if(v.hasOwnProperty("sortable")&&v.sortable===true){if(p.CurrentSortColumn===-1||(v.hasOwnProperty("defaultSort")&&v.defaultSort===true)){p.CurrentSortColumn=s}if(t!==""){t.addEvents({click:function(){p.CurrentSortColumn=p.getColumnHeaderIndex(v.dataIndex);p.applySort(true)}})}}n.addContent(q);p.Column.push(v)});this.applySort(null,null)},getOptimalSize:function(){var m=this.container.getElement("tbody").getSize();var n=this.container.getElement("thead").getSize();return{width:m.width,height:m.height+n.height}},_clearAllLines:function(){var m=this.MainTableDiv.getElement("tbody");if(m){m.empty()}},clearAllLine:function(){this._clearAllLines();this.saveElementObj={listId:[]}},getAllLine:function(){var m=[];var n=this.MainTableDiv.getElement("tbody");if(n){m=n.getElements("tr")}return m},allIsHidden:function(){var m=this.getAllLine();var n=true;m.every(function(o){var p=o.getStyle("display");if(p!=="none"){n=false;return false}return true});return n},applySort:function(s){var p=this;if(p.CurrentSortColumn===null||p.CurrentSortColumn===undefined){UWA.log("issue with sort column");return}if(p.CurrentSortColumn<0){return}var m=this.Column[p.CurrentSortColumn];var n=m.dataIndex;var q=null;var r=this.MainTableHeader.getElements(".HeaderAreaText");r.forEach(function(t){if(t.hasClassName(k+n)){q=t;if(!t.hasClassName("asc")&&!t.hasClassName("desc")){t.toggleClassName("asc")}}else{if(t.hasClassName("asc")){t.toggleClassName("asc")}if(t.hasClassName("desc")){t.toggleClassName("desc")}}});if(!q){return}if(s===true){q.toggleClassName("asc");q.toggleClassName("desc")}var o=q.hasClassName("asc");this._sortAndUpdateTable(m,o)},_sortAndUpdateTable:function(q,p){var o=this;var m=this.getAllLine();var n=q.dataIndex;m.sort(function(s,r){var y=s.getElement("."+n);var x=r.getElement("."+n);var t=0;if(!y){t=-1}else{if(!x){t=1}else{var w=null;if(q.hasOwnProperty("sortKey")){w=q.sortKey}var v=o._getElementValue(y,w);var u=o._getElementValue(x,w);t=j.compareValue(v,u);if(p===false){t=t===-1?-1:1}else{t=t===1?-1:1}}}return t});this.MainTableDiv.getElement("tbody").setContent(m);this._putHiddenLineAtEnd(m)},_putHiddenLineAtEnd:function(n){if(!n){n=this.getAllLine()}var m=this.MainTableDiv.getElement("tbody");var p=[];var o=[];n.forEach(function(q){var r=q.getStyle("display");if(r==="none"){o.push(q)}else{p.push(q)}});p=p.concat(o);m.setContent(p)},_getElementValue:function(n,r){var q="";var m=n.getData("idElement");var p=null;if(m&&m.hasOwnProperty("idProp")){p=this.saveElementObj[m.idProp]}var q=n.firstChild?n.firstChild:n.getText();if(r){var o=q;if(p){o=p}q=r(o)}if(typeof q==="object"){q=n.getText()}return q},_getInsideElement:function(n){var p="";var m=n.getData("idElement");var o=null;if(m&&m.hasOwnProperty("idProp")){o=this.saveElementObj[m.idProp]}if(!o){p=n.getText()}else{p=o}return p},createMyTable:function(){var s=this;var o=this.options.restrict===true?" DGW_Restrict":"";var q=s.MainTable=UWA.createElement("div",{"class":"DGW_DataGrid "+this.options.className+" "+this.options.resizeClass+o,"data-rec-id":"dataRecTable"});this.DivSSTable1=UWA.createElement("div",{"class":"DivSSTableHeader "+this.options.className+"Header","data-rec-id":"dataRecSSTable1"});this.DivSSTable2=UWA.createElement("div",{"class":"DivSSTableBody "+this.options.className+"Body","data-rec-id":"dataRecSSTable2"});var p=this.options.UIKitClasses;var n="";if(p.indexOf("table-striped")>=0){n+="striped"}s.MainTableHeader=UWA.createElement("table",{name:this.options.className+"Header","class":"theadTable table "+p,"data-rec-id":"dataRecMainTableHeader",html:[{tag:"thead","class":"theadHeader",html:{tag:"tr"}}]});s.MainTableDiv=UWA.createElement("table",{name:this.options.className+"Body","class":"tbodyTable table "+p,"data-rec-id":"dataRecMainTableDiv",html:[{tag:"tbody",name:this.options.className+"Body_Body","class":"tbodyMain "+n}]});s.MainTableHeader.inject(this.DivSSTable1);s.MainTableDiv.inject(this.DivSSTable2);this.DivSSTable1.inject(q);this.DivSSTable2.inject(q);s.MainTableDiv.addEvent("resize",function(){s.resizeTable()});this.DivSSTable1.addEvent("resize",function(){if(s.allIsHidden()){s.resizeTable()}});this.DivSSTable2.setPosition(this.DivSSTable1.getPosition());s.tbodyScroll=null;s.tHeadScroll=null;s.userStopMove=false;if(s.options.setScroller===true){var m=true;var r=false;if(s.options.useNativeScroller===false){m=false;r=true}var t=function(){var u={x:0,y:0};if(s.tbodyScroll){u=s.tbodyScroll.getPosition()}s.dispatchEvent("onScroll",{scrollPosition:u,containerSize:s.DivSSTable2.getSize(),contentSize:s.MainTableDiv.getSize()});s.tHeadScroll.setPosition(u.x,0,0,true)};s.tbodyScroll=new c(s.MainTableDiv,{setExternalHorizontalScrollbar:true,events:{onScrollMove:function(){t()}}});s.tHeadScroll=new c(s.MainTableHeader,{displayScrollers:false,synchronizationHorizontal:true,events:{onScrollMove:function(){t()}}})}if(s.options.setHeaderColumn===false){this.DivSSTable1.hide()}return q},updateScroller:function(s,m){if(this.options.restrict!==true){var t=this;this.DivSSTable2.show();if(!s){var x=t.MainTable.getSize();s=x.width}var y=t.MainTableDiv.getSize();if(m){t.MainTableDiv.setStyle("height",m)}else{m=y.height}if(isNaN(s)){var A=s.match(/[0-9]*/);if(A){s=A}}s=parseInt(s);if(this.tHeadScroll){this.tHeadScroll.setSize({width:s,height:"auto"})}if(t.options.maxHeightScroller!==""&&m>t.options.maxHeightScroller){m=t.options.maxHeightScroller}var o=this.DivSSTable2.getOffsetParent();var z=null;var v=null;if(o){var w=o.getDimensions();z=w.innerHeight}var p=0;if(this.options.setHeaderColumn===true){var q=this.MainTableHeader.getSize();p=q.height}if((z===0||o)&&m>z-p){m=z-p}else{if(isNaN(m)){var A=m.match(/[0-9]*/);if(A){m=A}}}m=parseInt(m);if(this.tbodyScroll){this.tbodyScroll.setSize({width:s,height:m});if(this.allIsHidden()){this.DivSSTable2.hide()}}else{if(this.options.useNativeScroller===true){this.DivSSTable2.setStyle({width:s,height:m})}}if(this.options.setHeaderColumn===true){var n=t.MainTableHeader.getSize()}if(this.tHeadScroll&&this.tbodyScroll){var r=this.tbodyScroll.getPosition();var u=r;if(this.options.setHeaderColumn===true){this.tHeadScroll.getPosition()}this.tbodyScroll.setPosition(u.x,r.y,0,true)}}},fixeColumns:function(){var o=this;var n=o.MainTable.getElement(".theadTable").getElement("thead").getElement("tr").getElements("th");var m=o.MainTable.getElement(".tbodyTable").getElement("tbody").getElements("tr.standardLine");n.forEach(function(v,p){var u=v.getAttribute("isfixed");if(u==="true"){var t=-1;var r=v.getStyle("min-width");r=r.match(/[0-9]*/,"");r=parseInt(r);var s=v.getStyle("max-width");s=s.match(/[0-9]*/,"");s=parseInt(s);var q=v.attributes.dataIndex.value;m.every(function(y){var z=y.getElement("."+q);var B=z.getStyle("padding");B=B.match(/[0-9]*/,"");var A=z.firstChild;if(A){var x=A.getSize();var w=x.width+2*B;if(t<w){if(s&&s<w){t=s;return false}else{if(r&&r>w){t=r}else{t=w}}}}return true});if(t){n[p].setStyle("width",t)}}})},resizeInProgress:false,resizeWaitingNb:0,resizeTable:function(){var m=this;m.resizeWaitingNb++;if(m.resizeInProgress===false){m.resizeWaitingNb=0;m.resizeInProgress=true;this.updateScroller();this._resizeTable();this.updateScroller();setTimeout(function(){m.resizeInProgress=false;if(m.resizeWaitingNb>2){m.resizeTable()}},100)}},_resizeTable:function(){var v=this;var I=false;var r=v.MainTable.getElement(".theadTable").getElement("thead").getElement("tr").getElements("th");var q=v.MainTable.getElement(".tbodyTable").getElement("tbody").getElements("tr.standardLine");var M=r.length;if(q.length>0){var o=null;q.every(function(P){var Q=P.getStyle("display");if(Q!=="none"){o=P;return false}return true});if(o){var O=o.getElements("td");I=true;var p=O.length;var s=M;if(M>p){s=p}var K=[];for(var G=0;G<s;G++){var t=r[G].getAttribute("isfixed");if(t==="true"){var E=r[G].getStyle("width");E=E.match(/[0-9]*/,"");E=parseInt(E);if(E!==0){var A=r[G].attributes.dataIndex.value;q.forEach(function(P){var Q=P.getElement("."+A);Q.setStyle("width",E)})}}else{r[G].setStyle("width","");var C=O[G].getSize();var B=d(r[G]);if(B>C.width){var A=r[G].attributes.dataIndex.value;q.forEach(function(P){var Q=P.getElement("."+A);Q.setStyle("min-width",B)});K.push(G)}else{r[G].setStyle("width",C.width)}}}for(var F=0;F<s;F++){var C=O[F].getSize();r[F].setStyle("width",C.width)}}}if(I===false){var J=0;var w=0;var m=0;for(var G=0;G<M;G++){var H=r[G].getStyle("display");if(H!=="none"){w++;var z=r[G].getStyle("min-width");var B=d(r[G]);if(z&&z!==""){J++}var D=parseInt(z.match(/[0-9]*/));if(D>B){B=D}else{r[G].setStyle("width",B)}m+=B}}var L=v.MainTable.getSize().width;var u=L-m;var N=w-J;var x=N<=0;if(x){N=w}var n=u/N;for(var G=0;G<M;G++){var H=r[G].getStyle("display");if(H!=="none"&&(x||(!r[G].getStyle("min-width")))){var y=n;if(x){var z=r[G].getStyle("min-width");var B=d(r[G]);var D=parseInt(z.match(/[0-9]*/));if(D>B){B=D}y+=B}r[G].setStyle("width",y)}}}},getAllHeadersIndex:function(){var n=this.MainTableHeader.getElements("th");var m=[];n.forEach(function(p){var o=p.attributes.dataIndex.value;m.push(o)});return m},getCurrentSelectedLine:function(){return this.MainTableDiv.getElement("tbody").getElements("tr.selected")},selectFirstLines:function(m,p){var n=[];var o=this;m.forEach(function(s){var r=o.findLines(s);var q=r.goodLines;var t=null;if(q.length>0){t=q[0];n.push(t)}});this._selectLines(n,p,true)},selectFirstLine:function(m,n){this.selectFirstLines([m],n)},_selectLines:function(n,o,m){if(o!=false&&!o){o=true}if(this.options.setMultiSelection===false||m){this._unSelectAllLine(n)}if(n){n.forEach(function(p){p.toggleClassName("selected",m)})}if(o){this.dispatchEvent("onSelection")}},_unSelectAllLine:function(m){var n=this.getCurrentSelectedLine();n.forEach(function(o){var p=false;m.every(function(q){if(q===o){p=true;return false}return true});if(p===false){o.toggleClassName("selected",false)}})},createNewLine:function(m){var n=this;var o=UWA.createElement("tr",m);if(n.options.contextMenu.length>0){require(["DS/UIBehaviors/ContextualMenuManager"],function(p){p.onReady({target:o,nodes:n.options.contextMenu})})}return o},_getNewElementStoreId:function(){var o=true;var m=this.saveElementObj.listId;var n=m.length;while(o===true){n++;o=false;m.forEach(function(p){if(n===p){o=true}})}return n},_addNewElementStoreInTable:function(o){var m=this._getNewElementStoreId();var p="element"+m;this.saveElementObj.listId.push(m);this.saveElementObj[p]=o;var n={id:m,idProp:p};return n},_removeStoredElement:function(n){if(n.hasOwnProperty("id")&&n.hasOwnProperty("idProp")){var m=this.saveElementObj.listId.indexOf(n.id);this.saveElementObj.listId.splice(m,1);delete this.saveElementObj[n.idProp]}},_dispatchNotification:function(m){this.dispatchEvent("onNotification",m)},_onPointingEvent:function(o,n,m){this.dispatchEvent("onPointingEvent",{type:o,evt:n,cellPosition:m})},_generateNewCellForLine:function(m,n){var o=this;var p=this.getAllHeadersIndex();p.forEach(function(v){var y="";if(m.hasOwnProperty(v)){y=m[v]}var x=o.getColumnHeader(v);var B=x.hidden===true?" hidden":"";var w=UWA.createElement("td",{"class":v+B});w.setAttribute("data-rec-id","dataRecCell"+v+m.Id);var z={line:m,headerIndex:v};o._addEventsOnLine(w,n,z);var t=false;var u=null;if(y!==null&&typeof y==="object"){t=true;var s=o._addNewElementStoreInTable(y);w.setData("idElement",s);if(typeof y.inject==="function"){y.inject(w)}else{if(y instanceof Date){u=y.toLocaleString(j.getLanguage())}else{u=y.toString()}}}else{(y===null)?u="":u=y}var x=o.getColumnHeader(v);if(u){if(x&&x.fixed===true){if(t===false){var s=o._addNewElementStoreInTable(u);w.setData("idElement",s)}u=UWA.createElement("span",{text:u});u.inject(w)}else{w.setText(u)}}if(x&&x.resizable){var A=o.classResize;var C="."+A+" ."+v;var r=UWA.createElement("div",{"class":"resizeHandler"});var q=null;r.inject(w);o.elements["moveHelpers"+a]=new g({element:r,events:{startMove:function(){q=w.getSize()},move:function(E){var F={};var D=(q.width-E.diff.x);if(D<h){D=h}F[C]={width:D+"px"};j.addNewStyles(A+"_style",F,true);localStorage.setItem(A+"_style",JSON.stringify({style:F,width:D}))},endMove:function(){o.dispatchEvent("onCellResize",w);o._dispatchOnResize()}}})}w.inject(n)})},_addEventsOnLine:function(m,p,n){var o=this;m.addEvents({dblclick:function(q){o._onPointingEvent("dblclick",q,n)},click:function(q){o._onPointingEvent("click",q,n);if(o.options.activeSelection===true){o._selectLines([p])}},contextmenu:function(q){o._onPointingEvent("contextmenu",q,n)},touchstart:function(q){var s=null;var r=new Date();if(o.firstTouch){s=r-o.firstTouch}o.firstTouch=r;if(s&&s<500){o._onPointingEvent("dblclick",q,n)}else{o._onPointingEvent("touchstart",q,n)}},})},AddDatasInTable:function(n,r){var q=this;var m=this.getAllLine();var o=null;var p=this._getBodyTable();n.forEach(function(s){var t=s.datagridOptions;var v="";if(t){var u=t.customClass;if(u){v=u}}var w=q.createNewLine({"class":"standardLine "+v,"data-rec-id":"dataRecNewLine"});if(!o){o=w}w.inject(p);q._generateNewCellForLine(s,w)});if(m.length<=0){q.updateScroller();q.fixeColumns()}q.resizeTable();if(r!==false){q.applySort()}},AddDataInTable:function(m){this.AddDatasInTable([m])},_getBodyTable:function(){return this.MainTableDiv.getElement("tbody")},AddMultiColumnLineInTable:function(w){var t=this;var v="";if(w.hasOwnProperty("className")){v=w.className}var n=0;if(w.hasOwnProperty("span")){n=w.span}else{var r=this.getAllHeadersIndex();n=r.length}if(n===0){n=1}var m=t.MainTableDiv.getElement("tbody");var s=this.createNewLine({}).inject(m);var u={line:w,headerIndex:null};var p=UWA.createElement("td",{"class":"DG_spanElement "+v,colspan:n});this._addEventsOnLine(p,s,u);var q=w.insideElement;if(typeof q==="object"){var o=t._addNewElementStoreInTable(q);p.setData("idElement",o);q.inject(p)}else{p.setText(q)}p.inject(s);t.resizeTable()},removeLine:function(q){var p=this;var o=this.findLines(q);var n=o.goodLines;n.forEach(function(s){var r=s.getElements("td");r.forEach(function(t){var u=t.getData("idElement");if(u){p._removeStoredElement(u)}})});var m=o.badLines;this.MainTableDiv.getElement("tbody").setContent(m)},HideLine:function(p,n){var o=this;var m=this.findLines(p);m=m.goodLines;m.forEach(function(q){if(n===true){q.hide();q.inject(o.MainTableDiv.getElement("tbody"))}else{q.show()}});this.applySort()},hideAllLines:function(n){var m=this.getAllLine();m.forEach(function(o){if(n===true){o.hide()}else{o.show()}})},getCellFromPosition:function(n,o){var p=this.findLines(n);p=p.goodLines;var m=null;if(p&&p.length>0){m=p[0].getElement("."+o)}return m},getCellsContent:function(m,o){var p=this;var n=[];var q=this.findLines(m);q=q.goodLines;q.forEach(function(r){var s=p.getCellContent(r,o);if(!s){s=""}n.push(s)});return n},getCellContent:function(q,n){var p=this;var o=null;var m=q.getElement("."+n);if(m){o=p._getInsideElement(m)}return o},getCellsValue:function(m,o){var p=this;var n=[];var q=this.findLines(m);q=q.goodLines;q.forEach(function(r){var s=p.getCellValue(r,o);if(!s){s=""}n.push(s)});return n},getCellValue:function(o,n){var q=this.getColumnHeader(n);var m=o.getElement("."+n);var p=null;if(q.hasOwnProperty("sortKey")){p=q.sortKey}return this._getElementValue(m,p)},clearCell:function(m,n){var o=this;var p=this.findLines(m);p=p.goodLines;p.forEach(function(r){var q=r.getElement("."+n);var s=q.getData("idElement");if(s){o._removeStoredElement(s);q.setData("idElement",{})}if(q){q.setHTML("")}})},findLines:function(s,t,q){var r=this;var u=this.getAllLine();var m=[];var n=[];if(!Array.isArray(s)){s=[s]}var p=0;u.every(function(v){var x=true;var w=q===true?p:v;s.every(function(D){x=true;for(var z in D){var B=r.getColumnHeader(z);if(!B){x=false;break}var y=v.getElement("."+z);if(!y){x=false;break}var C=null;if(B.hasOwnProperty("sortKey")){C=B.sortKey}var A=r._getElementValue(y,C);if(A!==D[z]+""){x=false;break}}if(x===true){return false}else{return true}});if(x===true){m.push(w)}else{n.push(w)}return !t||!x});var o={goodLines:m,badLines:n};return o},getColumnHeader:function(m){var n=null;var o=this;this.Column.every(function(q,p){if(q.dataIndex===m){n=o.Column[p];return false}return true});return n},getColumnHeaderIndex:function(n){var m=null;this.Column.every(function(p,o){if(p.dataIndex===n){m=o;return false}return true});return m}});return i});define("DS/DataGridWidget/Datasheet",["DS/DataGridWidget/DataGridWidget","DS/DataGridWidget/models/SheetLine","DS/WidgetServicesUI/helpers/Helpers","DS/WidgetServices/WidgetServices","DS/Controls/Button"],function(f,a,g,i,d){var e="_Id";var c="_Color";var h="DGW_defaultColor";var b=f.extend({mapLines:{},lines:[],_tweakerCallback:{},defaultOptions:{rollback:true,colorization:false},init:function(l,k){this.mapLines={};this.lines=[];this._tweakerCallback={};k=k?k:{};var j=k.className;j=j?j:"";k.className="DGW_Sheet "+j;l=l?l:[];l.unshift({text:UWA.i18n("Id"),dataIndex:e,hidden:true});if(k.colorization===true){l.unshift({text:"",dataIndex:c})}this._parent(l,k)},removeAll:function(){this.clearAllLine();this.mapLines={};this.lines=[]},clearAllLine:function(){this._parent()},moveLine:function(k,m){var j=this._getLineFromId(k);if(j!==null){var n=this._getBodyTable();if(m===undefined){j.inject(n)}else{if(m===null){j.inject(n,"top")}else{var l=this._getLineFromId(m);if(l!==null){j.inject(l,"after")}}}}},_getLineFromId:function(j){var l={};l[e]=j;var k=this.findLines(l,true,false);var m=null;if(k.goodLines.length>0){m=k.goodLines[0]}return m},addHeader:function(j){this._parent(j)},getAllLinesId:function(){return Object.keys(this.mapLines)},getAllLines:function(){return this.lines},changeColorOnLine:function(j,l){var k=this._getLineFromId(j);if(k){if(l==true){k.addClassName(h)}else{k.removeClassName(h)}}},_changeValue:function(o,j,k,n){var l=this.mapLines[j].getData();var m=this.getColumnHeader(k);l.setValue(k,n);l.addChangedValue(k);if(m.events&&m.events.onChange){m.events.onChange.call(this,l,k)}},getTweaker:function(n,o,q){var p=n;if(typeof n==="object"){p=n.getID()}var k=null;var r=this.mapLines[p];if(r){var l=r._tweakers;if(l&&l[o]){k=l[o]}q.call(this,k)}else{var m=this._getOrCreateProp(this._tweakerCallback,p,false);var j=this._getOrCreateProp(m,o,true);j.push(q)}},_getOrCreateProp:function(l,m,j){var k=l[m];if(!k){k=j?[]:{};l[m]=k}return k},_getValue:function(k,m){var l=k.getValue(m);var j=l===undefined;var n=this.getColumnHeader(m);l=j&&n.defaultValue!==undefined?n.defaultValue:l;if(l!==undefined&&j&&k.canInitialize()){k.setValue(m,l)}return l},_sortAndUpdateTable:function(l,k){var j=l.dataIndex;this.lines.sort(function(n,m){var r=n.getData().getValue(j);var p=m.getData().getValue(j);var o=0;if(!r){o=-1}else{if(!p){o=1}else{var q=null;if(l.hasOwnProperty("sortKey")){q=l.sortKey}var r=q!=null?q(r):r;var p=q!=null?q(p):p;o=i.compareValue(r,p);if(k===false){o=o===-1?-1:1}else{o=o===1?-1:1}}}return o});this.clearAllLine();this.AddDatasInTable(this.lines,false)},addLinesSheet:function(j){var l=this;var k=[];var m=this.getAllHeadersIndex();j.forEach(function(o){if(o instanceof a){var n=o.getID();o.addEvent("onColorChanged",function(r){l.changeColorOnLine(n,r===true?true:false)});var q={};var p={};m.forEach(function(r){p[r]=null;var v=l._getValue(o,r);if(v===undefined){v=null}q[r]=typeof v==="string"?v:"";var w=l.getColumnHeader(r);if(v!==undefined){var t={events:{change:function(x){l._changeValue(this,n,r,x)},liveChange:function(x){l._changeValue(this,n,r,x)},notification:function(x){l._dispatchNotification(x)}}};if(w.inputOptions){for(var u in w.inputOptions){t[u]=w.inputOptions[u]}}var s=UWA.createElement("div",{"class":"datasheet_ui_container"});if(typeof q!=="object"){q={}}q[r]=s;t.value=v;t.editable=w.editable===true;g.getTweaker(w.type,t,function(z){o.addEvent("onPropChanged:"+r,function(C){if(l.options.rollback===true&&this.isRollbackOnCells()){var D=o;var B=z.getHTMLElement().getParent("td");if(B){if(this.hasChanged(C)){B.addClassName("datasheet_cell_changed")}else{B.removeClassName("datasheet_cell_changed")}}}z.setValue(o.getValue(C))});z.inject(s);p[r]=z;if(l._tweakerCallback){var A=l._tweakerCallback[n];if(A){var y=A[r];if(y){y.forEach(function(B){B.call(l,z)});delete A[r];if(Object.keys(A).length===0){delete l._tweakerCallback[n]}}}}var x=UWA.createElement("div",{"class":"datasheet_forgetButton"}).inject(s);if(l.options.rollback===true){(new d({icon:"undo",displayStyle:"lite",onClick:function(){o.resetValue(r);var B=o.getInitialValue(r);var C=B!==undefined?B:l._getValue(o,r);z.setValue(C)}})).inject(x)}o.raiseEventsForChanges(r)})}});q[e]=n;q._data=o;q._tweakers=p;q.getData=function(){return this._data};q.getID=function(){return this[e]};if(o.getColor()===true){q.datagridOptions={customClass:h}}l.mapLines[n]=q;l.lines.push(q)}});this.clearAllLine();this.AddDatasInTable(this.lines);this._raiseChangeEventForLines(j)},sortFromList:function(l){var p=this;var k=this.getAllLine();var m={};k.forEach(function(q){var r=p.getCellValue(q,e);m[r]=q});var o=this._getBodyTable();this._clearAllLines();l.forEach(function(r){var q=m[r];if(q){q.inject(o)}delete m[r]});for(var n in m){var j=m[n];if(j){j.inject(o)}}p.updateScroller();p.fixeColumns();p.resizeTable();p.applySort()},_raiseChangeEventForLines:function(j){j.forEach(function(k){k.raiseEventsForChanges()})}});return b});