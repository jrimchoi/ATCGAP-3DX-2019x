define("DS/E6WCommonApps/Collections/ConstraintsPseudoCollection",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Class/Listener","UWA/Class/Collection"],function(g,b,a,f,d){"use strict";var e=b.extend(a,f,{_iterateOverWorkscopes:function c(n,k){var h;var j=this;if(n instanceof d){return n.some(function(p){return j._iterateOverWorkscopes(p,k)})}h=k.call(this,n);if(h){return h}var m=n.getWorkscopes();var o=m.length;for(var l=0;l<o&&!h;l++){var i=m.at(l);h=this._iterateOverWorkscopes(i,k)}return h},_onCollectionEvent:function(k,i,l,h){if(!this.requestReset){switch(k){case"onReset":var j=this;this.requestReset=window.requestAnimationFrame(function(){delete j.requestReset;j.dispatchEvent(k,[i,j,h])});this._handleConstraintResetForWorkscope(i,l);break;case"onAdd":this._constraintMap.set(i.id,i);break;case"onRemove":this._constraintMap["delete"](i.id);break;default:break}this.dispatchEvent(k,[i,this,h])}},_handleConstraintResetForWorkscope:function(m,j){var n=[];var k,h;var l=g.is(j.previousModels,"array")?j.previousModels.slice():[];m.forEach(function(o){var i=l.indexOf(o);if(i===-1){n.push(o)}else{l.splice(i,1)}});for(k=0;k<n.length;k++){h=n[k];this._constraintMap.set(h.id,h);this.dispatchEvent("onAdd",[h,this,j])}for(k=0;k<l.length;k++){h=l[k];this._constraintMap["delete"](h.id);this.dispatchEvent("onRemove",[h,this,j])}},_listenToWorkscopeConstraints:function(i){var h=i.getOwnConstraints();this.listenTo(h,"onAnyEvent",this._onCollectionEvent);this._addConstraintsFromWorkscope(i)},_startListeningToWorkscope:function(j){this._listenToWorkscopeConstraints(j);var i=j.getWorkscopes();var h={onAdd:this._onAddWorkscope,onReset:this._onResetWorkscope,onRemove:this._onRemoveWorkscope};this.listenTo(i,h)},_stopListeningToWorkscope:function(i){var h=i.getWorkscopes();this.stopListening(h);this.stopListening(i.getOwnConstraints())},_onAddWorkscope:function(h){this._iterateOverWorkscopes(h,this._startListeningToWorkscope,false);this._iterateOverWorkscopes(h,function(i){this._addConstraintsFromWorkscope(i)})},_addConstraintsFromWorkscope:function(i){var j=i.getOwnConstraints();var h=this;j.forEach(function(k){k.dispatchEvent("onAdd",[k,h]);h.dispatchEvent("onAdd",[k,h]);h._constraintMap.set(k.id,k)})},_listenToWorkscopeAndAddConstraintsToMap:function(i){if(i instanceof b.Model){this._startListeningToWorkscope(i);var h=this;i.getOwnConstraints().forEach(function(j){h._constraintMap.set(j.id,j)})}},_onResetWorkscope:function(j,h){if(j.length===0&&h.previousModels.length===0){return}this._constraintMap.clear();this.stopListening();var i=this;this._iterateOverWorkscopes(this.model,function(k){i._listenToWorkscopeAndAddConstraintsToMap(k)});this.dispatchEvent("onReset",[this])},_onRemoveWorkscope:function(j){var i=this;this._iterateOverWorkscopes(j,this._stopListeningToWorkscope,false);this._iterateOverWorkscopes(j,function(k){var l=k.getOwnConstraints();l.forEach(function(m){m.dispatchEvent("onRemove",[m,i]);i.dispatchEvent("onRemove",[m,i]);i._constraintMap["delete"](m.id)})});var h=j.getParent();if(h){h.getOwnConstraints().forEach(function(k){i._constraintMap.set(k.id,k)})}},init:function(j){this.model=j;this._constraintMap=new Map();Object.defineProperty(this,"id",{get:function(){return(this.model.id||this.model.getUri())+":allConstraints"}});Object.defineProperty(this,"length",{get:function(){return this._constraintMap.size}});var i=this;this._iterateOverWorkscopes(this.model,function(k){i._listenToWorkscopeAndAddConstraintsToMap(k)});if(this.model instanceof d){var h={onAdd:this._onAddWorkscope,onRemove:this._onRemoveWorkscope,onReset:this._onResetWorkscope};this.listenTo(this.model,h)}},first:function(){return this.at(0)},get:function(h){return this._constraintMap.get(h)},at:function(j){var i;var k=0;if(j>this._constraintMap.size-1){return undefined}if(this._constraintMap.values){var h=this._constraintMap.values();var l=h.next();while(!l.done&&k<j){l=h.next();k++}return l.value}this._constraintMap.forEach(function(m){if(k===j){i=m}k++});return i},forEach:function(j,i){var h=0;this._constraintMap.forEach(function(k){j.call(i,k,h);h++})},destroy:function(){window.cancelAnimationFrame(this.requestReset);this.stopListening();delete this.model;delete this.requestReset;this._constraintMap.clear();delete this._constraintMap}});return e});define("DS/E6WCommonApps/Models/CalendarModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Collections/ResultCollection","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(f,b,h,k){var j="dsplan:MVMask.Calendar.Basic";var a="/classes/dsplan:Calendar";var i="dsplan:timezoneOffset";var g="dsplan:representativeCities";var l=function(m){return k.get(m)};var d=b.extend({_uwaClassName:"CalendarModel",timeOffsetToUTCString:function(){var n;var m=this.get(i);var o=m/60;if(!isNaN(o)||Math.abs(o)>24){n=o>=0?"UTC+":"UTC";n+=o}else{n="Invalid Calendar timeOffset: "+o;console.error("Invalid time offset: "+o)}return n},getDropdownDisplayValue:function(){var m=this.get(g).replace(/ /g,"").replace(/,/g,"_");return this.timeOffsetToUTCString()+" "+l("E6WCommonApps.Calendar."+m)}});var c=h.extend({_uwaClassName:"CalendarCollection",comparator:function(p,o){var n=parseInt(p.get(i));var m=parseInt(o.get(i));return n-m},getUri:function(){return a},getMask:function(){return j}});d.calendarCollection=new c(undefined,{detailsMask:j,defaultModel:d});d.fetchCalendars=function(n){var m=f.clone(n||{},false);var o=m.onComplete;m.onComplete=function(){d._calendarsFetched=true;f.is(o,"function")&&o()};m.reset=true;d.calendarCollection.fetch(m)};d.haveCalendarsBeenFetched=function(){return Boolean(d._calendarsFetched)};d.getCalendarsForDropdown=function(){var m=[];d.calendarCollection.forEach(function(n){m.push({actualValue:n.id,displayValue:n.getDropdownDisplayValue()})});return m};function e(){var o=new Date(2018,0,1,0,0,0,0);var m=o.toUTCString();var n=new Date(m.substring(0,m.lastIndexOf(" ")-1));return(o-n)/(1000*60*60)}d.getCalendarClosestToUserTimeZone=function(){if(!d._closestCalendar){var m=e();var n=25;d.calendarCollection.forEach(function(p){var o=(parseInt(p.get(i))/60)-m;if(!isNaN(o)&&Math.abs(o)<n){n=Math.abs(o);d._closestCalendar=p}})}return d._closestCalendar};d.OFFSET_ATTR=i;d.CITIES_ATTR=g;d.LOAD_ALL_CALENDARS_URL=a;return d});define("DS/E6WCommonApps/Views/RichTextEditorConfig",[],function(){var a={toolbarGroups:[{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"styles",groups:["styles"]},{name:"links",groups:["links"]}],title:false,contentsLangDirection:"ltr",removeDialogTabs:"link:advanced;link:target",removeButtons:"Source,Save,Cut,Undo,Find,SelectAll,NewPage,Preview,Print,PasteFromWord,PasteText,Paste,Copy,Redo,Templates,Replace,Checkbox,Form,Scayt,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,CopyFormatting,Subscript,Superscript,NumberedList,BulletedList,Indent,Outdent,Blockquote,CreateDiv,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,Language,BidiRtl,BidiLtr,Anchor,Image,Flash,Table,HorizontalRule,Smiley,SpecialChar,PageBreak,Iframe,FontSize,Font,Format,Styles,Maximize,ShowBlocks,BGColor,TextColor,About"};return a});define("DS/E6WCommonApps/Models/TaskModelMixin",["UWA/Core","DS/E6WCommonUI/UIHelper","DS/Foundation2/FoundationV2Data"],function(e,j,c){var a="DUE_TOMORROW";var b="DUE_TODAY";var f="NO_DATE";var d="PAST_DUE";var g="DUE_THIS_WEEK";var k="DUE_FUTURE";var l=function(){return c.getWidgetConstant.apply(this,arguments)};var i=function(p,n,o){var m=new Date(o);if(p<n){m.setHours((m.getHours()+1))}else{m.setHours(24)}return m};var h={OWNERATTR:"ownerInfo",DPMPROJECTATTR:"DPMProject",ASSIGNEESATTR:"assignees",REFERENCEATTR:"references",SCOPESATTR:"scopes",DUEDATECATEGORY:"dueDateCategory",DUEDATEATTR:"dueDate",ACTUALSTARTDATEATTR:"actualStartDate",_categories:["PAST_DUE","NO_DATE","DUE_TODAY","DUE_TOMORROW","DUE_THIS_WEEK","DUE_FUTURE"],isComplete:function(){var m=this.get("state");return m==="Complete"},_onRequest:function(m){this.nbInFlightRequests++;if(this.nbInFlightRequests===1){this.dispatchEvent("onChange:nbInFlightRequests",[this,m])}},_onCompleteRequest:function(m){this.nbInFlightRequests--;this.nbInFlightRequests=this.nbInFlightRequests<0?0:this.nbInFlightRequests;if(this.nbInFlightRequests===0){this.dispatchEvent("onChange:nbInFlightRequests",[this,m])}},add:function(t,r,u){var p=e.clone(u||{});var n=p.onFailure;var o=p.onComplete;var q=this;p.onComplete=function(){q._onCompleteRequest();if(o){o.apply(this,arguments)}};p.onFailure=function(){q._onCompleteRequest();if(n){n.apply(this,arguments)}};var s=r.split(",").map(function(v){return v.trim()});var m;m=this.addObjects(s,t);if(m&&m.length){this._onRequest();m[0].save(undefined,p)}return m},remove:function(m,p,o){var n=this.removeObject(m,p);var s=e.clone(o||{});var q=s.onFailure;var t=s.onComplete;var r=this;s.onComplete=function(v,u,w){r._onCompleteRequest(w);if(t){t.apply(this,arguments)}};s.onFailure=function(v,u,w){r._onCompleteRequest(w);if(q){q.apply(this,arguments)}};if(n){this._onRequest();n.save(undefined,s)}return n},getMappedAttribute:function(m){if(this.rdfCollabTaskInverseMapping){return this.rdfCollabTaskInverseMapping[m]||m}return m},removeAssigneeByIndex:function(m){return this.removeObject(this.ASSIGNEESATTR,m)},addReferencesById:function(m){return this.addObjects(m,this.REFERENCEATTR)},sync:function(s,p,o){var n=Array.prototype.slice.call(arguments,0);var m=o.onFailure;var r=o.onComplete;var q=this;o.onFailure=function(v,t,u){q._onCompleteRequest(u);if(u){u.response=t}if(m){m.apply(this,arguments)}};o.onComplete=function(v,t,u){q._onCompleteRequest(u);if(r){r.apply(this,arguments)}};q._onRequest(o);this._parent.apply(this,n)},dueDateCategory:function(p){var o=typeof p==="undefined"?this.get("dueDate"):p;var s="NO_DATE";o=e.is(o,"string")?parseInt(o,10):o;o=e.is(o,"number")||o instanceof Date?new Date(o):o;if(o instanceof Date){if(isNaN(o)){s=f}else{o.setHours(0,0,0,0);var n=new Date();n.setHours(0,0,0,0);var r=o-n;if(r<0){s=d}else{if(r===0){s=b}else{var m=new Date(n);m.setDate(m.getDate()+1);if(o.getTime()===m.getTime()){s=a}else{var q=this.dateHelper.getLastDayofThisWeek();r=o-q;if(r<0){s=g}else{s=k}}}}}}return s},dueDateCategory2DueDate:function(n){var o;var m=this.dateHelper;switch(n){case a:o=m.getTomorrow();break;case b:o=m.getToday();break;case f:o=new Date(NaN);break;case d:o=m.getPast();break;case g:o=m.getLastDayofThisWeek();break;case k:o=m.getFuture();break;default:}return o},dateHelper:{ONE_DAY:60*60*24*1000,THIRTY_DAYS:60*60*24*1000*30,getLocaleDate:function(m){return m.toLocaleDateString(window.enoviaServer.language)},getToday:function(){var m=new Date();m.setHours(23,59,59,999);return m},getTomorrow:function(){var m=new Date(new Date().getTime()+this.ONE_DAY);m.setHours(23,59,59,999);return m},getFuture:function(){var m=new Date(new Date().getTime()+this.THIRTY_DAYS);m.setHours(23,59,59,999);return m},getPast:function(){var m=new Date(new Date().getTime()-this.ONE_DAY);m.setHours(23,59,59,999);return m},getLastDayofThisWeek:function(){var n=new Date();n.setHours(23,59,59,999);var m=(n.getDay()+6)%7;n.setDate(n.getDate()-m+4);return n}},isAtRisk:function(){var s=this.isComplete();var o=this.get(this.DUEDATEATTR);if(s||!o){return false}var r=false;var m=this.getStartDate();var q=m instanceof Date?m.getTime():Date.parse(m);var n=this.getPercentComplete();if(q&&n>=0){var p=new Date((q+(o.getTime()-q)*(n/100)));r=new Date()>i(this.getDuration(),this.getWorkingHoursInMilliseconds(),p)}return r},isLate:function(){var o=this.isComplete();var n=this.get(this.DUEDATEATTR);if(o||!n){return false}var m=i(this.getDuration(),this.getWorkingHoursInMilliseconds(),n);return new Date()>m},getDuration:function(){var n=this.getDefinedDuration();var m=this.getWorkDayLength()+2;return(isNaN(n)?m:n)*this.getWorkingHoursInMilliseconds()},canAssignToSelf:function(){var m=!this.isComplete()&&this.get("canEdit");return m&&!this.isAssignedToCurrentUser()},isAssignedToCurrentUser:function(){var o=false;var p=this.get(this.ASSIGNEESATTR);if(p){for(var n=0;n<p.length;n++){var q=p.at?p.at(n):p[n];var r=q&&q.get("name")&&q.get("name",{noMapping:true}).toLowerCase();var m=window.enoviaServer.user&&window.enoviaServer.user.toLowerCase();if(r===m){o=true;break}}}return o},assignToSelf:function(){var m=this;this.addAssigneesByName([window.enoviaServer.user]);this.save(null,{patch:true,onComplete:function(){m.dispatchEvent("onChange:"+m.ASSIGNEESATTR);var n=l("emxCollaborativeTasks.Label.SuccessfullyAssignedToSelf");j.displaySuccess(n)},onFailure:function(){var n=l("emxCollaborativeTasks.Error.FailAssignToSelf");j.displayError(n)}})}};return h});define("DS/E6WCommonApps/Models/InvokeSolver",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper"],function(e,a,b){var d={};var c="dsmf:xplan.Scheduler.JSONScheduleObjects?$mask=dsplan:MVMask.ScheduleElements.Complex";d.solve=function(g,j){var f=(g&&g.additionalElementsToSolve)||[];f.unshift(j);var i={IsWhatIf:false};var h=(g&&g.listName)||"ScheduleElementList";i[h]=f;i=[i];a.request(a.expandUrl("invoke/"+c),{method:"POST",onComplete:g&&g.onComplete,onFailure:function(){if(window.widget.alerter){b.displayWarning(b.i18n("SolverFailed"))}else{console.log("Solver failed. Likely no solution found")}return g&&e.is(g.onFailure,"function")&&g.onFailure.apply(this,arguments)},onTimeout:g&&g.onFailure,data:JSON.stringify(i),type:"json"})};return d});define("DS/E6WCommonApps/Models/TeamMemberResponsibilityModel",["UWA/Core","UWA/Class/Model","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/PersonRDFModel","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(h,g,b,c,d){var f=d.get.bind(d);var a={"dsplan:Viewer":0,"dsplan:Author":1,"dsplan:Leader":2};var e=g.extend({_uwaClassName:"TeamMemberResponsibilityModel",idAttribute:"@id",setup:function(i){this._parent.apply(this,arguments);this.listenTo(i.memberPersonModel,"onAnyEvent",function(k){var j=Array.prototype.slice.call(arguments,1);this.dispatchEvent(k,j)})},parse:function(k,i){var j=h.clone(k||{},false);return this._parent(j,i)},get:function(j){var i=this._parent.apply(this,arguments);switch(j){case"title":return this.get("memberPersonModel").fullName;case"image":return this.get("memberPersonModel").get("image");case"personRDFId":return this.get("memberPersonModel").id;case"responsibility":return this.getHighestResponsibility();case"responsibilityNLS":i=this.get("responsibility");return f(b.splitUri(i)[1]);default:}return i},toJSON:function(){var i=this._parent.apply(this,arguments);i.responsibilityNLS=this.get("responsibilityNLS");i.title=this.get("title");i.image=this.get("image");return i},getHighestResponsibility:function(){var k=this.get("allResponsibilitiesArray");var m=k[0];var n=a[m];for(var i=1;i<k.length;i++){var j=k[i];var l=a[j];if(l>n){n=l;m=j}}return m}});e.processRawData=function(r,l){var m=[];var s=Object.keys(r);var k=s.length;for(var o=0;o<k;o++){var i=s[o];var p=r[i];var n=p.member;if(n){var q=e.getAllResponsibilitiesArray(p.member);var j=e.getMemberObj(i,q,l);m.push(j)}}return m};e.getAllResponsibilitiesArray=function(l){var k=[];for(var i=0;i<l.length;i++){var j=l[i].responsibility;k.push(j)}return k};e.getMemberObj=function(i,j,m){var l=b.getObjectForAdding(c,i,{mask:"dskern:MVMask.Person.Complex"});var k={"@id":e.getInstanceId(i,m.id),allResponsibilitiesArray:j,memberPersonModel:l,parentWorkscopeModel:m};return k};e.getInstanceId=function(i,j){return i+"_"+j};Object.defineProperty(e.prototype,"fetching",{get:function(){return this.get("memberPersonModel").fetching}});return e});define("DS/E6WCommonApps/Models/RepositoryModelMixin",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/DriveRepositoryProxyModel","DS/RDFFoundation/Models/CollabspaceRepositoryModel"],function(f,a,d,c){var e="dsxplan:hasContentRepository";var b={_normalizedRepo:function(g){var h=this.getRepositoryModelConstructor(g);return a.getObjectForAdding(h,g)},getRepositoryModelConstructor:function(g){return g.startsWith(d.ID_PREFIX)?d:c},parse:function(){var i=this._parent.apply(this,arguments);var g=i[e]||this.get(e);if(g&&f.is(g,"string")){var h=this._normalizedRepo(g);this._models[e]=h;i[e]=h}return i}};return b});define("DS/E6WCommonApps/Views/PropertyPanel",["UWA/Core","DS/SocialToolbar/SocialToolbar","DS/Handlebars/Handlebars","DS/UIKIT/SuperModal","DS/E6WCommonUI/Views/FoundationBaseView","DS/UIKIT/Scroller","DS/E6WCommonUI/Views/DetailsDisplayView","text!DS/E6WCommonApps/assets/templates/propertypanel.html.handlebars","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/PlatformManager","DS/RDFFoundation/FederatedSearchUtil"],function(c,g,d,m,f,o,k,q,i,e,b,l,p,j){var n="commentsTab";var h="detailsTab";var r=d.compile(q);var a=f.extend({i18n:function(s){return i.get(s)},propertyComponentFields:{},_uwaClassName:"E6WCommonUIPropertyPanel",tagName:"div",className:"property-panel",name:"E6WCommonUI.PropertyPanel",domEvents:{"click #cancelButton":"cancel","click #commentsTab":"onCommentsTabClicked","click #detailsTab":"onDetailsTabClicked","click #closeButton":"close","click #saveButton":"save"},id:function(){return"e6WCommonUIPropertyPanel"+this.cid},setup:function(u){var t=c.clone(u||{},false);var v=t.alertMessageContainer||this.container;this._parent.apply(this,arguments);this.modal=new m({renderTo:v,okButtonText:this.i18n("E6WCommonApps.Command.Yes"),koButtonText:this.i18n("E6WCommonApps.Command.No")});var s=this.cloneModelForDetailDisplayView();if(s){s.validationError=c.is(s.validate,"function")&&s.validate(s.toJSON())}var w=c.clone(u.detailsViewParameters||{},false);w.model=s;w.context=u.context;w.i18n=this.i18n;w.tenant=window.enoviaServer.tenant;w.isPropertyPanel=true;this._detailsView=new k(w);this.addChildView(this._detailsView);this.buttonConfig=t.buttons||[];this._selectedTab=h;if(this.model){this.resetModel(this.model,{force:true,onDelete:t.onDelete,noRender:t.noRender});this.listenTo(this._detailsView.model,"onChange:modificationsPending",this.setSaveState)}this.listenTo(this._detailsView,"scrollToElement",this.scrollToElement)},render:function(){if(!this.model){return this}this.container.setHTML(this.template());this._initButtons(this.buttonConfig);this._renderBodyContent();return this},_renderBodyContent:function(){this._detailsView.remove();this._commentsView&&this._commentsView.remove();this.container.getElement("#detailsPanelFrame").empty();this._scrollerElement&&this._scrollerElement.destroy();this._scrollerElement=c.createElement("div",{id:"detailsPanelScroller",styles:{"-webkit-user-select":"text"}});this._scrollerElement.inject(this.container.getElement("#detailsPanelFrame"));this._setSelectedTab(this._selectedTab);var s=this._detailsView.render({boundingElement:this._scrollerElement}).container;s.inject(this._scrollerElement);if(this._selectedTab===n){s.remove();this._commentsView.inject(this._scrollerElement)}var t=this;var u=function(){t._scrollerTimeout&&clearTimeout(t._scrollerTimeout);delete t._scrollerTimeout;if(t._selectedTab===h&&t._detailsView){if(t._detailsView.container.offsetWidth){t._setScrollerContent(t._detailsView)}else{t._scrollerTimeout=setTimeout(u,500)}}else{if(t._selectedTab===n){!t._commentsView&&t._initCommentsView();t._setScrollerContent(t._commentsView)}}};u()},cancel:function(t){var s=c.clone(t||{},false);var v=this;var u=function(){if(!s.keepPanelOpen){v.close()}if(c.is(s.onCancel,"function")){s.onCancel()}v.dispatchEvent("onCancel")};if(this._detailsView&&this._detailsView.model&&this._detailsView.model.modificationsPending){if(this.model.destroying){l.displayInfo(this.model.get("title")+" "+this.i18n("E6WCommonApps.Error.HasBeenDeleted"));this._detailsView.model.cancel();u()}else{this.modal.confirm(this.i18n("E6WCommonApps.Warning.PendingChanges"),this.i18n("E6WCommonApps.Command.CancelChanges"),function(w){if(w){v._detailsView.model.cancel();u()}else{if(c.is(s.onAbortCancel,"function")){s.onAbortCancel()}}})}}else{u()}},save:function(){this._detailsView.model.save()},resetModel:function(v,u){var t=c.clone(u||{},false);var y=t.force;var x=this;if(v&&v.fetchForProperty){v.fetchForProperty()}if(y||v!==this.model){if(this._detailsView.model){this.stopListening(this._detailsView.model)}if(y||this._detailsView){var w=this._detailsView.model;if(this.model&&v.constructor!==this.model.constructor){this._detailsView.setConfig([])}this.model=v;var s=this.cloneModelForDetailDisplayView();s.validationError=c.is(s.validate,"function")&&s.validate(s.toJSON());this._detailsView.resetModel(s,undefined,{noRender:true});this._detailsView.setConfig(this.getConfig(u));if(w){w.destroy()}}this._initCommentsView();this.listenTo(this._detailsView.model,"onChange:modificationsPending",this.setSaveState);this.listenTo(this._detailsView.model,"onValidationFailure",this.disableSaveButton);this.listenTo(this._detailsView.model,"onValidationSuccess",this.enableSaveButton);this.listenTo(this.model,"onModifyAccessChanged",function(){x._detailsView.render()});this.setSaveState();!t.noRender&&this._smartRender();v.isValid()?this.enableSaveButton():this.disableSaveButton()}},_smartRender:function(){if(this.container.childElementCount!==0){this._renderBodyContent()}else{this.render()}},disableSaveButton:function(){var s=this.container.getElement("#saveButton");s&&s.setAttribute("disabled","disabled")},enableSaveButton:function(){var s=this.container.getElement("#saveButton");s&&s.removeAttribute("disabled")},template:function(t){var s=c.clone(t||{},false);var v=s.data;v={};var w=e.i18n;e.i18n=this.i18n;var u=r(v);e.i18n=w;return u},selectTab:function(s){if(s===n){this.onCommentsTabClicked()}},onCommentsTabClicked:function(){if(this._selectedTab===n){return}this._setSelectedTab(n);this._setScrollerContent(this._commentsView)},onDetailsTabClicked:function(){if(this._selectedTab===h){return}this._setSelectedTab(h);this._setScrollerContent(this._detailsView.render().container)},close:function(){throw new Error("In PropertyPanel clone, this should be implemented in subclass.")},getConfig:function(){throw new Error("In PropertyPanel getConfig, this should be implemented in subclass.")},setSaveState:function(){this.container.toggleClassName("save-needed",this.saveNeeded())},saveNeeded:function(){return Boolean(this._detailsView.model.modificationsPending)},cloneModelForDetailDisplayView:function(){throw new Error("In PropertyPanel cloneModelForDetailDisplayView, this should be implemented in subclass.")},destroy:function(){this._parent();delete this._detailsView;this._commentsView&&this._commentsView.destroy();delete this._commentsView;this.modal.destroy();delete this.modal;var s=this._detailsView&&this._detailsView.model;s&&s.destroy();this._scrollerElement&&this._scrollerElement.destroy();delete this._scrollerElement;this._scroller&&this._scroller.destroy();delete this._scroller;delete this.buttonConfig;this._scrollerTimeout&&clearTimeout(this._scrollerTimeout);delete this._scrollerTimeout},_setSelectedTab:function(t){this._selectedTab=t;var s=this.container.getElements(".panel-tab");s.forEach(function(u){u.toggleClassName("selected",u.id===t)})},_initCommentsView:function(){this._commentsView&&this._commentsView.destroy();var s,t;if(this.model.isRDF){s=this.model.id;t=p.getServiceUrl("3dplan")+"/dsplan"}else{s="pid:"+this.model.id;t=window.enoviaServer.computeUrl("/resources/")}this._commentsView=new g({subjectURI:s,tenantId:enoviaServer.tenant,serviceURL:t,enableShare:false,"3DSwymUrl":window.enoviaServer.swym,commentsNumberAtInit:8})},_setScrollerContent:function(s){if(this._scroller){this._scroller.destroy();this._scrollerElement.empty()}s.inject(this._scrollerElement);this._scroller=new o({element:this._scrollerElement}).inject(this.getElement("#detailsPanelFrame"))},_initButtons:function(v){if(!v){return}var u=this;var t=this.container.getElement(".panel-actions");var s=0;var w="info";v.forEach(function(x){var y=c.createElement("div",{"class":"panel-action",html:{tag:"button",id:x.id||u.cid+"Button"+s,"class":"btn",title:x.title||"",html:{tag:"span","class":"fonticon fonticon-"+(x.fonticon||w)}}});y.inject(t);s+=1})},getCloneModel:function(){return this._detailsView.model},getFieldViewByName:function(s){return this._detailsView.getFieldViewByName(s)},scrollToElement:function(s){this._scroller.scrollToElement(s)}});a.COMMENTS_TAB=n;return a});define("DS/E6WCommonApps/Models/NoAccessModel",["UWA/Core","UWA/Class/Model","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(d,c,a){var b=c.extend({init:function(g,f){var e=d.extend(g||{},{"dsxplan:label":a.get("E6WCommonApps.Label.NoAccess"),image:"E6WCommonApps/assets/img/NoAccess.png",physicalId:"noAccessModelId"+this.cid});this._parent(e,f)},sync:Function.prototype,hasViewAccess:function(){return false}});return b});define("DS/E6WCommonApps/XTaskScope",["UWA/Core","DS/RDFFoundation/RDFUtils"],function(d,a){var b="scopeId_18x";var c={isScopeRDF:function(){!this._initialized&&this.initialize();return this._scopeIsRDF},getScopeId:function(){!this._initialized&&this.initialize();return this._scopeId},getScope:function(){return a.getObjectById(this.getScopeId())},getScopeType:function(){!this._initialized&&this.initialize();return this._scopeType},initialize:function(){var f=widget.getValue(b);if(f===undefined){var e=widget.getValue("scopeId");var g={};if(e){var h="~~";if(e.indexOf("~~")===-1){h=":"}var i=e.split(h);g={id:i[1],type:i[0],isRDF:Boolean(widget.getValue("scopeIsRDF"))};this.setScopeData(g);widget.deleteValue("scopeIsRDF");widget.deleteValue("scopeId")}else{this.removeScopeData()}return}f=JSON.parse(f);if(f&&f.id){f.localOnly=true;this.setScopeData(f)}else{this.removeScopeData()}},setScopeData:function(g){var f=d.clone(g||{});if(!f.id||!f.type||f.isRDF===undefined){throw new Error("id, type, and isRDF must be passed in an options object to setScopeData")}var e={id:f.id,type:f.type,isRDF:Boolean(f.isRDF)};if(!f.localOnly){widget.setValue(b,JSON.stringify(e))}window.enoviaServer.preferences.scopeId=e.id;window.enoviaServer.preferences.scopeType=e.type;this._scopeId=e.id;this._scopeType=e.type;this._scopeIsRDF=e.isRDF;this._initialized=true},removeScopeData:function(){widget.setValue(b,JSON.stringify({id:undefined,type:undefined,isRDF:undefined}));if(window.enoviaServer.preferences){delete window.enoviaServer.preferences.scopeId;delete window.enoviaServer.preferences.scopeType;delete window.enoviaServer.preferences.scopeIsRDF}this._scopeId=undefined;this._scopeType=undefined;this._scopeIsRDF=undefined;this._initialized=true},resetLocalScopeData:function(){delete this._scopeId;delete this._scopeType;delete this._scopeIsRDF;delete this._initialized},getFilter:function(){return window.widget.getValue("currentTaskFilter")||"all"},setFilter:function(e){window.widget.setValue("currentTaskFilter",e)}};return c});define("DS/E6WCommonApps/Models/E6WCommonAppsConstants",[],function(){var a={TASK:"Task",TASK_RDF_TYPE:"dsplan:Task",ENDDATE_ATTR:"dsplan:estimatedEndDate",STARTDATE_ATTR:"dsplan:estimatedStartDate",ESTIMATED_DATE_ATTR:"dsplan:estimatedDate",SUGGESTED_DATE_ATTR:"dsplan:suggestedDate",TASK_VOCABULARY_ATTR:"dsplan:hasTaskVocabulary",START_DATE_MIN_ATTR:"dsplan:startDateIntervalMin",START_DATE_MAX_ATTR:"dsplan:startDateIntervalMax",END_DATE_MIN_ATTR:"dsplan:endDateIntervalMin",END_DATE_MAX_ATTR:"dsplan:endDateIntervalMax",DURATION_SUGGESTED:"dsplan:suggestedDuration",DURATION_ESTIMATED:"dsplan:estimatedDuration",ACTUAL_START_DATE:"dsplan:actualStartDate",ACTUAL_END_DATE:"dsplan:actualEndDate",ACTUAL_DELIVERABLE_ATTR:"dsplan:actualDeliverable",ATTACHMENT_ATTR:"dsplan:hasAttachment",ASSIGNEE_ATTR:"dsplan:hasAssignee",USER_DEFINED_DATES_ATTR:"dsplan:userDefinedDates",USER_DEFINED_START_DATE_ATTR:"dsplan:userDefinedStart",USER_DEFINED_END_DATE_ATTR:"dsxplan:userDefinedEnd",CHILDREN_ATTR:"dsplan:hasWorkDecomposition",OBJECT:"Object",COMPLETE_PERCENT_ATTR:"dsplan:percentageCompletion",SEQUENCE_ORDER_ATTR:"dsplan:sequenceOrder",SEQUENCE_ORDER_ATTR_DSLC:"dsxplan:sequenceOrder",DURATION:"dsplan:duration",DURATION_RANGE:"dsplan:durationRange",DURATION_MIN:"dsplan:durationIntervalMin",DURATION_MAX:"dsplan:durationIntervalMax",TITLE_ATTR:"title",DSLC_TITLE_ATTR:"dsxplan:label",PARENT_ATTR:"dsxplan:workscopeParent",PARENT_HAS_SWYM_COMMUNITY:"dsxplan:parentCommunity",LASTUPDATED_ATTR:"dspol:modificationDate",CREATION_DATE_ATTR:"dspol:creationDate",WORKSCOPE_PARENT_ATTR:"dsxplan:workDecompositionParent",STATE_OPEN:"dsxplan:Open",STATE_IN_PROGRESS:"dsxplan:InProgress",STATE_DONE:"dsxplan:Done",STATE_ATTR:"dscom:hasMaturity",dslcMapping:{title:"dsxplan:label","dsplan:durationIntervalMin":"dsxplan:durationIntervalMin","dsplan:estimatedStartDate":"dsxplan:estimatedStartDate","dsplan:estimatedEndDate":"dsxplan:estimatedEndDate","dskern:comment":"dsxplan:comment","dsplan:sequenceOrder":"dsxplan:sequenceOrder","dsplan:durationIntervalMax":"dsxplan:durationIntervalMax","dsplan:estimatedDuration":"dsxplan:estimatedDuration","dsplan:endDateIntervalMin":"dsxplan:endDateIntervalMin","dsplan:endDateIntervalMax":"dsxplan:endDateIntervalMax","dsplan:startDateIntervalMax":"dsxplan:startDateIntervalMax","dsplan:startDateIntervalMin":"dsxplan:startDateIntervalMin","dsplan:solveStart":"dsxplan:solveStart","dsplan:solveEnd":"dsxplan:solveEnd","dsplan:percentageCompletion":"dsxplan:percentageCompletion","dsplan:actualStartDate":"dsxplan:actualStartDate","dsplan:actualEndDate":"dsxplan:actualEndDate","dsplan:actualDeliverable":"dsxplan:actualDeliverable","dscom:hasMaturity":"dsxplan:hasMaturity","dsplan:userDefinedDates":"dsxplan:userDefinedDates","dsplan:userDefinedStart":"dsxplan:userDefinedStart","dsplan:userDefinedEnd":"dsxplan:userDefinedEnd","dskern:owner":"dsxplan:owner","dsplan:hasAssignee":"dsxplan:hasAssignee","dsplan:requiresSkill":"dsxplan:requiresSkill","rdf:type":"dsxplan:type",subtitle:"dsxplan:comment","dsplan:hasAttachment":"dsxplan:hasAttachment"},attributeImpactingSolve:{"dsplan:durationIntervalMin":true,"dsplan:durationIntervalMax":true,"dsplan:startDateIntervalMin":true,"dsplan:startDateIntervalMax":true,"dsplan:estimatedStartDate":true,"dsplan:endDateIntervalMin":true,"dsplan:endDateIntervalMax":true,"dsplan:estimatedEndDate":true,"dsplan:hasAssignee":true,"dsplan:actualStartDate":true,"dsplan:actualEndDate":true,"dscom:hasMaturity":true,"dsplan:userDefinedDates":true,"dsplan:userDefinedStart":true,"dsplan:userDefinedEnd":true},PROGRAM:"Program",PROGRAM_RDF_TYPE:"dsplan:Program",PROJECT:"Project",PROJECT_RDF_TYPE:"dsplan:Project",WORKPACKAGE:"WorkPackage",WORKPACKAGE_RDF_TYPE:"dsplan:WorkPackage",CONSTRAINT_RELATION_ATTR:"dsplan:hasConstraint",AUTOSOLVE_OFF:1,AUTOSOLVE_ON:2,ACTUAL_TYPE_ATTR:"dsplan:actualType",JS_TYPE_ATTR:"dsxplan:jsType",TYPE_ATTR:"@type",DESCRIPTION_ATTR:"subtitle",KPI_RELATION_ATTR:"dsplan:hasSpecification",MILESTONE_VOCABULARY_ATTR:"dsplan:hasMilestoneVocabulary",MILESTONE_RDF_TYPE:"dsplan:Milestone",OWNER_ATTR:"dskern:owner",CONTENT_REPOSITORY:"dsxplan:hasContentRepository",REQUEST_TYPE_ADD:"add",REQUEST_TYPE_REPLACE:"reset",REQUEST_TYPE_REMOVE:"remove",NO_SOLVER_ERROR:"dsxplan:NoSolverError",RESPONSIBILITY_LEADER:"dsplan:Leader",RESPONSIBILITY_VIEWER:"dsplan:Viewer",RESPONSIBILITY_AUTHOR:"dsplan:Author",WORKING_HOURS_IN_A_DAY:8,SERVICE_3DPLAN:"3dplan",APP_3DPLAN:"ENXPLAN_AP",APP_TSK:"ENOTASK_AP"};return a});define("DS/E6WCommonApps/Models/SolverModelMixin",[],function(){var a={setup:function(){this._previous.apply(this,arguments);this.listenTo(this,"onChange:solveCounter",function(){var b=this.getParent&&this.getParent();if(b){b.solveCounter+=this.solveCounter-this.prevSolveCounter}})},prevSolveCounterDef:{get:function(){return this.previousAttributes().solveCounter||0}},solveCounterDef:{get:function(){return this.get("solveCounter")||0},set:function(b){this.set("solveCounter",b)}}};return a});define("DS/E6WCommonApps/Models/AccessModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils"],function(g,c,b){var a="invoke/dsaccess:sharing.checkOperationOnResourceClone";var k="dsaccess:Operation.Shareable.Modify";var j="dsaccess:Operation.Shareable.Delete";var e="dsaccess:Operation.Shareable.Share";var h;var f=c.extend({_uwaClassName:"AccessModel",get:function(l){if(l==="canEdit"){return this.canModify()}else{if(l==="deleteAccess"){return this.canDelete()}else{return this._parent.apply(this,arguments)}}},canModify:function(){if(!this.hasFetchedAccessData()){h.requestFetch(this)}return Boolean(this._accessModify)},canDelete:function(){if(!this.hasFetchedAccessData()){h.requestFetch(this)}return Boolean(this._accessDelete)},canShare:function(){if(!this.hasFetchedAccessData()){h.requestFetch(this)}return Boolean(this._accessShare)},fetchAccess:function(l){if(!this.hasFetchedAccessData()){h.requestFetch(this,l)}},refreshAccessData:function(l){if(this.hasFetchedAccessData()){h.requestFetch(this,l)}},getAccessBatch:function(l){var m=this;var n=b.getBatchGenerator();n.ajax(b.expandUrl(a),{method:"POST",onComplete:function(o){m.setModifyAccess(o.value);return l&&g.is(l.onComplete,"function")&&l.onComplete.apply(this,arguments)},onFailure:function(){return l&&g.is(l.onFailure,"function")&&l.onFailure.apply(this,arguments)},onTimeout:l&&l.onFailure,headers:{"Content-Type":"application/json"},data:JSON.stringify([this.id,k]),type:"json"});n.ajax(b.expandUrl(a),{method:"POST",onComplete:function(o){m.setShareAccess(o.value);return l&&g.is(l.onComplete,"function")&&l.onComplete.apply(this,arguments)},onFailure:function(){return l&&g.is(l.onFailure,"function")&&l.onFailure.apply(this,arguments)},onTimeout:l&&l.onFailure,headers:{"Content-Type":"application/json"},data:JSON.stringify([this.id,e]),type:"json"});n.ajax(b.expandUrl(a),{method:"POST",onComplete:function(o){m.setDeleteAccess(o.value);return l&&g.is(l.onComplete,"function")&&l.onComplete.apply(this,arguments)},onFailure:function(){return l&&g.is(l.onFailure,"function")&&l.onFailure.apply(this,arguments)},onTimeout:l&&l.onFailure,headers:{"Content-Type":"application/json"},data:JSON.stringify([this.id,j]),type:"json"});return n},hasFetchedAccessData:function(){return Boolean(this._accessModify!==undefined&&this._accessDelete!==undefined&&this._accessShare!==undefined)},setAccess:function(l,n){var m=g.clone(n||{},false);var r=m.silent;m.silent=true;var q=this._accessModify;var o=this._accessDelete;var p=this._accessShare;this.setModifyAccess(l,m);this.setDeleteAccess(l,m);this.setShareAccess(l,m);if(!r){o!==l&&this.dispatchEvent("onDeleteAccessChanged");q!==l&&this.dispatchEvent("onModifyAccessChanged");p!==l&&this.dispatchEvent("onShareAccessChanged")}},setModifyAccess:function(l,n){var m=g.clone(n||{},false);if(this._accessModify!==l){this._accessModify=l;!m.silent&&this.dispatchEvent("onModifyAccessChanged")}},setDeleteAccess:function(l,n){var m=g.clone(n||{},false);if(this._accessDelete!==l){this._accessDelete=l;!m.silent&&this.dispatchEvent("onDeleteAccessChanged")}},setShareAccess:function(l,n){var m=g.clone(n||{},false);if(this._accessShare!==l){this._accessShare=l;!m.silent&&this.dispatchEvent("onShareAccessChanged")}},clearAccess:function(l){this.setDeleteAccess(undefined,l);this.setModifyAccess(undefined,l);this.setShareAccess(undefined,l)},onShareNotification:function(l){this.refreshAccessData();this.fetch({mask:"dsplan:MVMask.ScheduleElements.Basic",ajax:l.ajax,onComplete:function(n,m){if(!m["dsxplan:jsType"]){n.dispatchEvent("liveUpdateAccessRevoked");n.destroy({noServer:true,fromNotification:true})}},onFailure:function(m){m.dispatchEvent("liveUpdateAccessRevoked");m.destroy({noServer:true,fromNotification:true})}})}});var d={cancel:function(){if(this.fetching){delete this._onComplete;delete this.queue.fetching[this.model.id]}else{delete this.queue.toBeFetched[this.model.id]}},onComplete:function(){this._onComplete&&this._onComplete.apply(this,arguments);delete this.queue.fetching[this.model.id]},onFailure:function(){this._onFailure&&this._onFailure.apply(this,arguments);delete this.queue.fetching[this.model.id]}};var i=function(){this.onComplete=d.onComplete.bind(this);this.onFailure=d.onFailure.bind(this);this.cancel=d.cancel.bind(this)};i.prototype=i.prototype;h={fetchAccess:function(){delete this.fetchTimeout;var r=this.toBeFetched;this.toBeFetched={};var l=Object.keys(r);var q=l.length;if(!q){return{cancel:function(){}}}var n=b.getBatchGenerator();for(var s=0;s<q;s++){var p=l[s];var o=r[p];o.fetching=true;this.fetching[p]=o;var m=o.model;n.addRequestsFromBatch(m.getAccessBatch(o))}return n.sendBatch()},requestFetch:function(n,m){if(!n.id){n.setAccess(true);return{cancel:function(){}}}var l=g.clone(m||{},false);var p=this;var o=p.toBeFetched[n.id]||p.fetching[n.id];if(o){return o}o=new i;o.model=n;o._onComplete=l.onComplete;o._onFailure=l.onFailure;o.queue=p;p.toBeFetched[n.id]=o;if(!p.fetchTimeout){p.fetchTimeout=setTimeout(p.fetchAccess.bind(p),p.TIMEOUT_LENGTH)}return o},resetQueue:function(){this.toBeFetched={};this.fetching={};clearTimeout(this.fetchTimeout);delete this.fetchTimeout}};h.toBeFetched={};h.fetching={};h.TIMEOUT_LENGTH=97;f.AccessModelQueue=h;f.DELETE_DATA=j;f.MODIFY_DATA=k;f.ACCESS_URL=a;return f});define("DS/E6WCommonApps/Views/LinkLauncherUtils",["UWA/Core","DS/LifecycleControls/EditPropDialog","DS/E6WCommonUI/Views/ObjectCardView","DS/PlatformAPI/PlatformAPI","UWA/Class/Collection","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(c,e,f,h,d,g){var b=["VPMReference","Drawing","XCADModelRepReference","SLDPRT",".SLDPRT","SLDASM",".SLDASM","SLDDRW",".SLDDRW"];var j=["VPMReference","VPMRepReference","Drawing","XCADNonPSBaseRepReference","CATPart",".CATPart","CATProduct",".CATProduct","CATShape",".CATShape","CATDrawing",".CATDrawing","CATAnalysis",".CATAnalysis","CATAnalysisResults",".CATAnalysisResults","CATAnalysisComputation",".CATAnalysisComputation","CATProcess",".CATProcess","CATMaterial",".CATMaterial"];var i=function(k){var l=g.get(k);return l};var a={launchProperties:function(r,m){var l=m&&m.model;var q=l&&l.serviceHosting;var p=l&&l.tenant;var o=(l&&l.physicalId)||r;var n={model:{objectId:o,tenant:p,source:q}};switch(q){case"3DSwym":case"3dplan":case"geoservice":case"fedsearch":n.model.source="fedsearch";n.model.objectId=l.fedSearchIdQuery;break;case"3DDrive":n.model.sourceName="drive";break;default:}var k=new e();k.launchProperties(n);return true},getDropDownMenuItems:function(q,m){var p=function(s){f.prototype.selectModelInCompass(s.model)};var o=a._isSolidWorksFile(m.model);var n=m.model.hasViewAccess?m.model.hasViewAccess():true;var l=f.prototype.getDropDownMenuItems.apply(this,[q&&!o,m]);if(n){var r=a.polymorphicLinkLauncher(m,"openAppInCompass",p,this);r&&l.push(r)}for(var k=l.length;k--;){l[k].className=l[k].className||"";if(!n&&l[k].name!=="remove-button"&&l[k].className.indexOf("disabled")===-1){l[k].className+=" disabled"}}return l},polymorphicLinkLauncher:function(u,m,p,v){var r=this;var n=c.clone(u||{},false);var q=this._getAddInMode();var t=v.normalizedGet(v.model,v._config.name);if(c.is(t,"array")){t=t[n.index||0]}else{t=t instanceof d?t.at(n.index||0):t}var k=false;var o=false;var s=false;k=v.normalizedGet(t,"type")==="Project Space";if(!k&&t.getObjectType){o=t.getObjectType()==="Project";s=t.getObjectType()==="WorkPackage"}n.isProjectOrPlan=o||s||k;n.model=t;n.isProject=o;n.isWorkPackage=s;n.isURL=v.normalizedGet(t,"type")==="URL";var l=t.get("physicalId")||t.id;if(n.isProjectOrPlan){n.handler=function(){r.openInApp(o,s,l)}}if(n.isURL){n.handler=function(){window.open(t.get("linkURL"),"_blank")}}if(q==="solidworks"||q==="catiav5"){return this.getAddInOpenMenuItem(n,m,p,v)}else{return this.getWebAppOpenMenuItem(n,m,p,v)}},openInApp:function(l,r,q){var p="ENOPRPR_AP";var k=window.enoviaServer["3DSpace"];var n=window.enoviaServer["3DDashboard"];var o="projectWindow";var m=k+"/emxLogin.jsp?appName="+p+"&physicalId="+encodeURIComponent(q);if(l||r){p=l?"ENXPLAN_AP":"ENXPLAW_AP";m=n+"#app:"+p+"/content:ids="+encodeURIComponent(q);o="top"}m+="&x3dPlatformId="+encodeURIComponent(window.enoviaServer.tenant);window.open(m,o)},getAddInOpenMenuItem:function(q,k,l){var n=this._getAddInMode();var m=(n==="solidworks"&&this._isSolidWorksFile(q.model))||(n==="catiav5"&&this._isCatiaFile(q.model));var o=k+(m?"":" disabled");var s=function(){if(m){h.publish("webinwin:web:notification",JSON.stringify({operation:"open/setObject",operationVersion:"1.0",content:[{phid:q.model.get("physicalId")}]}))}return l.apply(this,arguments)};var r=i("E6WCommonUI.Label.Open");var p="open";return{className:o,text:r,fonticon:p,handler:s}},getWebAppOpenMenuItem:function(l){var k;if(l.isProjectOrPlan||l.isURL){k={text:i("E6WCommonUI.Label.Open"),fonticon:"open",handler:l.handler}}return k},_isSolidWorksFile:function(k){var l=k.get("type");var m=k.get("busType");return b.indexOf(l)!==-1||b.indexOf(m)!==-1},_isCatiaFile:function(k){var l=k.get("type");var m=k.get("busType");return j.indexOf(l)!==-1||j.indexOf(m)!==-1},_getAddInMode:function(){return window.widget.getValue("addinmode")}};return a});define("DS/E6WCommonApps/Collections/TasksSplitCollection",["UWA/Core","UWA/Class/Collection"],function(e,f){var i=function(j){return(j&&j.actualValue)||j};var h="state";var g="dueDateCategory";var b=f.extend({_uwaClassName:"XTaskSplitCollection",model:{},fetch:function(){},complete:function(){this._parentCollection.complete.apply(this._parentCollection,arguments)},setup:function a(n,m){var l=Array.prototype.slice.call(arguments,0);this._filterAttr=m.filterAttr;this._valueForFiltering=m.valueForFiltering;this._parentCollection=m.parentCollection;var k="onChange:"+this._filterAttr;var j={onAdd:this._onParentAdd,onRemove:this._onParentRemove,onReset:this._onParentReset};j[k]=this._onAttrChange;if(this._filterAttr===g){j["onChange:state"]=this._onAttrChange}this.listenTo(this._parentCollection,j);this._parent.apply(this,l)},_onParentAdd:function d(l,o,k){if(o!==this._parentCollection){this.stopListening(o,"onAdd");return}var n=i(l.get(this._filterAttr));var m=i(this._valueForFiltering);var j=e.clone(k||{},false);j.at=0;j.parse=false;if(n===m&&this._canIncludeModel(l)){this.add(l,j)}},_onParentRemove:function(j,k){if(k!==this._parentCollection){this.stopListening(k,"onRemove");return}this.remove(j)},_onParentReset:function(k){if(k!==this._parentCollection){this.stopListening(k,"onReset");return}var j=k.tasksWithAttrValue(this._valueForFiltering,this._filterAttr);this.reset(j)},_onAttrChange:function(k,n,j){var l=i(k.get(this._filterAttr));var m=i(this._valueForFiltering);if(l===m&&this._canIncludeModel(k)){this.add(k,{at:0});j.at=0}else{this.remove(k)}},_canIncludeModel:function(k){var j=i(k.get(h));return !(this._filterAttr==="dueDateCategory"&&j==="Complete")},dataForRendering:function c(){var k={};if(this._filterAttr===h){if(e.typeOf(this._valueForFiltering)==="string"){var l={actualValue:this._valueForFiltering,displayValue:this._valueForFiltering};k.state=l}else{k.state=this._valueForFiltering}}if(this._filterAttr===g){var j=this._valueForFiltering;if(!j.displayValue){j.displayValue=j.actualValue}k.dueDate=j}k.collabSpace=this.collabSpace;k.extid=this.extid;k.filteredByAttr=this._filterAttr;k.filteredByValue=this._valueForFiltering;k.filteredCount=this.size();return k},getSaveAttributes:function(){var k={};var j=i(this._valueForFiltering);k[this._filterAttr]=j;return k}});return b});define("DS/E6WCommonApps/LiveUpdateUtils",["UWA/Core","UWA/Class/Events","DS/RDFFoundation/RDFUtils"],function(c,i,b){var a=2000;var g=new i();function e(l){var p=false;var k=b.getObjectById(l["@id"]);if(k&&k.get("@etag")!==l.ceStamp){var o=k.id;var n=this.uniqueMap[o];if(!n){this.uniqueMap[o]=o;p=true;var j=k.getMasks();var m=this;j.forEach(function(r){var q=m.masksToFetch[r]||[];q.push(k.id);m.masksToFetch[r]=q})}}return p}function f(k,l){var j=b.getObjectById(l["@id"]);j&&j.onShareNotification(k);g.dispatchEvent("onShareNotification",l)}function d(k){var j=b.getObjectById(k["@id"]);if(j){j.dispatchEvent("onDeleteNotification");j.destroy({onFailure:Function.prototype,noServer:true,fromNotification:true})}}function h(k){if(!b.getObjectById(k["@id"])){var j=b.getModelConstructor(k);var l=c.clone(k,false);delete l["@parentId"];var m=b.getObjectForAdding(j,k["@id"],{attrs:l});m.processLiveUpdateCreation(k);g.dispatchEvent("onCreateNotification",k)}}g.onNotification=function(j){this._notifQueue.push(j);if(!this._notifTimeout){this._notifTimeout=setTimeout(function(k){delete k._notifTimeout;g.handlenotifications(k._notifQueue)},a,this)}};g.handlenotifications=function(v){var s=Object.create(null);var n=Object.create(null);var u=[];var l=b.getBatchGenerator();var k=f.bind(undefined,l);for(;v.length;){var m=v.shift();try{m&&m.deleted&&m.deleted.forEach(d);m&&m.shared&&m.shared.forEach(k);if(m&&m.updated){u.splice.apply(u,[1,0].concat(m.updated.filter(e,{masksToFetch:s,uniqueMap:n})))}m&&m.created&&m.created.forEach(h,this)}catch(o){console.error(o)}}if(u.length){var t=Object.keys(s);var r=t.length;for(var p=0;p<r;p++){var j=t[p];var q=s[j];b.complete(undefined,q,{batchGenerator:l,mask:j,animate:true})}}l.sendBatch({waitOnInFlightRequests:true})};g.NOTIFICATION_PROCESSING_DELAY=a;return g});define("DS/E6WCommonApps/Models/ConstraintModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/E6WCommonAppsConstants"],function(f,c,b,j){var a="dsxplan:constraintType";var m="dsxplan:from";var l="dsxplan:to";var i="dsxplan:lag";var h="dsplan:TemporalConstraint";var n="Constraint";var d="dsxplan:deleteTemporalConstraint";var e="dsxplan:createTemporalConstraint";var k="dsxplan:modifyTemporalConstraint";var g=c.extend({_uwaClassName:"ConstraintModel",liveUpdateCreateMask:"dsplan:MVMask.Constraint.Complex",setup:function(q,p){var o=f.clone(p||{},false);this._parent.apply(this,arguments);if(!o.dontUpdateConstrainedScheduleElements){this.updateBackpointers();this.updateParentWorkscopes({silent:o.parse||o.silent})}},save:function(q,p){var o=f.clone(p||{},false);var s=Array.prototype.slice.call(arguments,0);s[1]=o;var r=this.getPredecessor();var u=this.getSuccessor();if(r&&r.shouldWeSolve({assumeChanges:true})){var t=o.onComplete;o.onComplete=function(){var v={};if(u){v.additionalElementsToSolve=[u.id]}r.solve(v);f.is(t,"function")&&t.apply(this,arguments)}}return this._parent.apply(this,s)},destroy:function(p){var r=this;var q=this.getPredecessor();var u=this.getSuccessor();var o=f.clone(p||{},false);var s=Array.prototype.slice.call(arguments,0);s[0]=o;if(!o.fromNotification&&q&&q.shouldWeSolve({assumeChanges:true})){var t=o.onComplete;o.onComplete=function(){var v=u&&{additionalElementsToSolve:[u.id]};q.solve(v);r.removeFromScheduleElements();f.is(t,"function")&&t.apply(this,arguments)}}this._parent.apply(this,s)},get:function(o){var p=(o==="canEdit")?this.canModify():this._parent.apply(this,arguments);return(p)},getObjectType:function(){return n},toJSON:function(q){var p=f.clone(q||{},false);var o=this._parent.apply(this,arguments);if(p.dataForRendering){o=f.merge(o,this.dataForRendering())}return o},dataForRendering:function(){var p=this.get(m);var o=this.get(l);var q={type:this.get(a),subtitle:this.get("subtitle"),canEdit:this.get("canEdit"),physicalId:this.get("physicalId")||this.cid};if(p instanceof g.ScheduleElementModel){q=f.extend(q,{predecessor:{id:p.get("@href"),ref:p.get("@id"),title:p.get("title")},predecessorTitle:p.get("title"),predecessorImage:p.getIconURL()})}if(o instanceof g.ScheduleElementModel){q=f.extend(q,{successor:{id:o.get("@href"),ref:o.get("@id"),title:o.get("title")},successorTitle:o.get("title"),successorImage:o.getIconURL()})}else{q=f.extend(q,{successorTitle:"[No Access]",successorImage:window.enoviaServer.computeUrl("/common/images/iconStatusAbstain.gif")})}return q},_getFullEndPoint:function(q){var p;var o=this.get(q);if(o instanceof g.ScheduleElementModel){p=o}return p},getSuccessor:function(){return this._getFullEndPoint(l)},getPredecessor:function(){return this._getFullEndPoint(m)},getType:function(){return this.get(a)},updateBackpointers:function(p){var r=this;var q=this.getPredecessor();if(!q){console.error("invalid predecessor for constraint: "+this.id)}else{if(!q.addPredecessorConstraint){}else{q.addPredecessorConstraint(this,p);this.stopListening(q);this.listenTo(q,"onModifyAccessChanged",function(){r.dispatchEvent("onModifyAccessChanged")});this.listenTo(q,"onDeleteAccessChanged",function(){r.dispatchEvent("onDeleteAccessChanged")})}}var o=this.getSuccessor();if(!o||!o.addSuccessorConstraint){}else{o.addSuccessorConstraint(this,p)}},removeFromScheduleElements:function(){var p=this.getPredecessor();var o=this.getSuccessor();p&&p.removePredecessorConstraint&&p.removePredecessorConstraint(this);o&&o.removeSuccessorConstraint&&o.removeSuccessorConstraint(this)},syncDelete:function(o){this._parent.apply(this,arguments);o.url=b.expandUrl("invoke/"+d);o.data=JSON.stringify([this.id]);o.method="POST"},syncCreate:function(o,p){p.noStringify=true;this._parent(o,p);p.url=b.expandUrl("invoke/"+e);p.data=JSON.stringify([p.attrs]);p.method="POST"},syncPatch:function(p,o){o.noStringify=true;this._parent(p,o);o.url=b.expandUrl("invoke/"+k);o.data=JSON.stringify([o.attrs,this.id]);o.method="POST"},canModify:function(){return this.getPredecessor()&&this.getPredecessor().canModify()},canDelete:function(){return this.getPredecessor()&&this.getPredecessor().canModify()},updateParentWorkscopes:function(r){var q=f.clone(r||{},false);var p=q.fromParent||(this.getPredecessor()&&this.getPredecessor().getParent());var o=q.toParent||(this.getSuccessor()&&this.getSuccessor().getParent());if(p&&p.hasViewAccess()){p&&p.addModelToAttributeWithCollection(j.CONSTRAINT_RELATION_ATTR,this,r)}if(o&&o.hasViewAccess()&&(!p||p.id!==o.id)){o.addModelToAttributeWithCollection(j.CONSTRAINT_RELATION_ATTR,this,r)}},getParentPath:function(){return""},getWorkDayLength:function(){return 8},processLiveUpdateCreation:function(r){var q=b.getObjectById(r["@parentFromId"]);var p=b.getObjectById(r["@fromId"]);var o=b.getObjectById(r["@parentToId"]);var s=b.getObjectById(r["@toId"]);if(!q&&!p&&!o&&!s){this.destroy({noServer:true});return}if((q&&q.hasFetchedAttribute(j.CONSTRAINT_RELATION_ATTR))||(o&&o.hasFetchedAttribute(j.CONSTRAINT_RELATION_ATTR))||(s&&s.hasFetchedAttribute("dsplan:taskHasConstraint"))||(p&&p.hasFetchedAttribute("dsplan:taskHasConstraint"))){this.fetch({mask:this.liveUpdateCreateMask,onComplete:function(t){t.updateBackpointers();t.updateParentWorkscopes({fromParent:q,toParent:o})}})}}});g.PREDECESSOR_ATTR=m;g.SUCCESSOR_ATTR=l;g.TYPE_ATTR=a;g.LAG_ATTR=i;g.TYPE_FINISH_TO_START="Before";g.TYPE_START_TO_START="SS";g.TYPE_FINISH_TO_FINISH="FF";g.CONSTRAINT_RDF_TYPE=h;g.DELETE_URL=d;g.CREATE_URL=e;g.MODIFY_URL=k;return g});define("DS/E6WCommonApps/Models/FileManagementMixin",["UWA/Core","DS/DocumentManagement/DocumentManagement","DS/DocumentManagement/DriveDocumentManagement","DS/RDFFoundation/SecurityContextUtils","DS/Foundation/FoundationAjax","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/DriveRepositoryProxyModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/PlatformManager","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(h,l,p,a,f,m,b,g,k,j,n){var o=function(q){return n.get(q)};var e={uploadFiles:function i(t,r,s){if(t.length>0){for(var q=t.length-1;q>=0;q--){this.uploadFile(t[q],r,s)}}},imageExtensions:[".gif",".jpg",".png",".gif",".jpeg",".3dxml",".cgr",".pdf",".bpm",".psd",".ai"],uploadFile:function d(v,u,w){var t=h.clone(w||{},false);var x=this;this._validateBeforeUpload();var s=this._validateFileUploadRepositoryAccess(t);if(s){t.onFailure&&t.onFailure(s);return}this._fileUploadCount=this._fileUploadCount?this._fileUploadCount+1:1;t.isImage=this._isImageFile(v);t.onComplete=function(y){x._onFileUploadComplete(y,v,t.isImage,w)};t.onFailure=this._onFileUploadFailure.bind(this,v,w.onFailure);t.csrf=this.csrf;t.onProgress=this._onFileUploadProgress.bind(this,v);t.securityContext=a.getDefaultSecurityContext();t.tenant=k.getTenant();var q=this.getDriveRepositoryId(t);q?t.tenantUrl=k.getServiceUrl("3DDrive"):t.tenantUrl=k.getServiceUrl("3DSpace");var r={fileInfo:{file:v},collabspace:!q&&(t.collabspaceId||this.get(j.CONTENT_REPOSITORY).id),driveFolderId:q};e.events.dispatchEvent("onFileUploadBegin",v);l.createDocument(r,t)},_validateBeforeUpload:function(){if(!a.getDefaultSecurityContext()){throw new Error("No security context set")}if(!this.id){throw new Error("Invalid object, cannot upload file on a model not saved yet")}},_isImageFile:function(r){var u;var q=r.name;if(r.FileName){q=r.FileName}var s=q.lastIndexOf(".");if(s!==-1){var t=q.substring(s);u=this.imageExtensions.indexOf(t)!==-1}return u},_validateFileUploadRepositoryAccess:function(t){var s;var r=this.get(j.CONTENT_REPOSITORY);var q=t.driveFolderProxyId||t.collabspaceId;if(!q&&r){q=r.id}if(!q){if(a.getUsersContentRepositories().length>0){s=o("E6WCommonApps.Error.NoContentRepository")}else{s=o("E6WCommonApps.Error.NoContentRepositoryAndNoneAvailable")}}else{if(q&&q.startsWith(b.ID_PREFIX)){r=g.getObjectById(q);if(r&&!r.hasViewAccess()){s=o("E6WCommonApps.Error.NoContentRepositoryAccess")}}else{if(!a.hasAccessToContentRepository(q)){s=o("E6WCommonApps.Error.NoContentRepositoryAccess")}}}return s},getDriveRepositoryId:function(t){var s;var q=t.driveFolderProxyId;var r=this.get(j.CONTENT_REPOSITORY);if(!q){q=r&&r.id}if(q&&q.startsWith(b.ID_PREFIX)){r=g.getObjectById(q);s=r&&r.get("physicalId")}return s},_onFileUploadComplete:function(u,s,v,q){this._fileUploadCount--;var r=u;if(u&&u.data){r=u.data[0];r.dataelements.hasfiles="TRUE"}if(v&&!s.FileName){var t=window.URL.createObjectURL(s);r.dataelements?(r.dataelements.image=t):(r.image=t)}if(r.type&&r.type==="DriveFile"){r.serviceId="3DDrive";if(!r.image){r.image=r.icon}}if(h.is(q.onComplete,"function")){q.onComplete(r)}e.events.dispatchEvent("onFileUploadComplete",s)},_onFileUploadProgress:function(s,r){var q={file:s,loaded:r.loaded,total:r.total};e.events.dispatchEvent("onFileUploadProgress",q)},_onFileUploadFailure:function(q,r){this._fileUploadCount--;if(h.is(r,"function")){r()}e.events.dispatchEvent("onFileUploadFailure",q)},isUploadingFiles:function c(){return Boolean(this._fileUploadCount)},updateDocument:function(r,v){var u=v.get("dscom:ServiceHosting");var t=v.get("physicalId");var w=v.get("dscom:Tenant");var q=l;if(u==="3DDrive"){q=p;r=q.getNewBlobFileWithOldName(r,v)}var s={id:t,fileInfo:{file:r}};e.events.dispatchEvent("onFileUploadBegin",{file:r,update:true});q.modifyDocument(s,{tenant:w,serviceId:u,tenantUrl:window.enoviaServer[u],onComplete:function(){e.events.dispatchEvent("onFileUploadComplete",r);m.displaySuccess(o("E6WCommonApps.Alert.UpdateSucess"))},onFailure:function(){e.events.dispatchEvent("onFileUploadFailure",r);m.displayError(o("E6WCommonApps.Alert.UpdateFail"))},onProgress:e._onFileUploadProgress.bind(this,r)})}};e.events=new h.Class.Events();return e});define("DS/E6WCommonApps/Views/ProgressBarPopupView",["UWA/Core","DS/Handlebars/Handlebars","DS/E6WCommonUI/Views/FoundationBaseView","DS/E6WCommonApps/Models/FileManagementMixin","text!DS/E6WCommonApps/assets/templates/popover.html.handlebars","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(d,a,f,b,g,h){var i=function(j){return h.get(j)};var e=a.compile(g);var c=f.extend({_uwaClassName:"ProgressBarPopupView",id:function(){return"progressBar_"+this.cid},domEvents:{"click .minimize-btn":"toggleMinimizedMaximized"},setup:function(){this._taskElementObj={};this._isHidden=true;var j=b.events;this.listenTo(j,{onFileUploadBegin:this.addTaskView,onFileUploadProgress:this.updateTaskView,onFileUploadComplete:this.removeTaskView,onFileUploadFailure:this.removeTaskView});this._fileCount=0},render:function(){this.container.setHTML(e({title:i("E6WCommonApps.ProgressBar.Title")}));this._parent.apply(this,arguments);this.container.toggleClassName("hidden",this._isHidden);return this},toggleMinimizedMaximized:function(){var j=this.getPopupOver();var l=j.getElement(".minimize-btn");var k=l.hasClassName("fonticon-down-open");l.toggleClassName("fonticon-down-open",!k);l.toggleClassName("fonticon-up-open",k);j.toggleClassName("minimized")},getPopupOver:function(){return this.getElement(".popover")},getPopupOverBody:function(){return this.getElement(".popover-body")},updateTaskView:function(n){var j=n&&n.file;var l=this._taskElementObj[j.name+"_"+j.currentModified];var k=l.getElement(".status");k.setText(i("E6WCommonApps.ProgressBar.Processing"));l.addClassName("processing");var o=l.querySelector("progress");var m=Math.ceil(n.loaded*100/n.total);if(isNaN(m)){l.removeClassName("processing");k.setText(i("E6WCommonApps.ProgressBar.Failure"))}else{o.value=m/100}if(m===100){l.removeClassName("processing");k.setText(i("E6WCommonApps.ProgressBar.Completed"))}},removeTaskView:function(l){var j=l.name+"_"+l.currentModified;var n=this.getPopupOverBody();var k=this._taskElementObj[j];var m=this;this._fileCount--;if(this._fileCount===0){this._hideTimeout=setTimeout(function(){m.hide();n.removeChild(k)},1000)}else{n.removeChild(k)}delete this._taskElementObj[j]},addTaskView:function(l){var k=l.file?l.file:l;var j=d.clone(l||{},false);this.show();this._fileCount++;k.currentModified=new Date().getTime();var m=this.createFileDiv(k,j);this.getPopupOverBody().appendChild(m);this._taskElementObj[k.name+"_"+k.currentModified]=m},createFileDiv:function(k,j){var l=j.update?i("E6WCommonApps.ProgressBar.Updating"):i("E6WCommonApps.ProgressBar.Pending");return d.createElement("div",{id:k.name+"_"+k.currentModified,"class":"task-view",html:[{tag:"div","class":"title",text:k.name||""},{tag:"progress",value:0},{tag:"div","class":"status",text:l}]})},destroy:function(){this._parent();this._hideTimeout&&clearTimeout(this._hideTimeout)},show:function(){this._isHidden=false;this.container.toggleClassName("hidden",this._isHidden)},hide:function(){this._isHidden=true;this.container.toggleClassName("hidden",this._isHidden)}});return c});define("DS/E6WCommonApps/Models/ScheduleElementModel",["UWA/Core","DS/RDFFoundation/Collections/ResultCollection","DS/E6WCommonApps/Models/AccessModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/ConstraintModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/InvokeSolver","DS/E6WCommonApps/Models/SolverModelMixin","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Models/RepositoryModelMixin","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(g,k,e,i,h,b,j,n,f,a,d,l){var m=l.get.bind(l);var c={parentMask:"dsplan:MVMask.Schedule.Complex",_uwaClassName:"ScheduleElementModel",_propertyDictionary:{solveCounter:{volatility:true},toConstraints:{volatility:true},fromConstraints:{volatility:true}},addPredecessorConstraint:function(q,p){var o=g.clone(p||{});this.addModelToAttributeWithCollection("fromConstraints",q);if(!this._changing){this._changed={}}!o.silent&&this._fireRelationshipChangeEvents("fromConstraints")},addSuccessorConstraint:function(q,p){var o=g.clone(p||{});this.addModelToAttributeWithCollection("toConstraints",q);if(!this._changing){this._changed={}}!o.silent&&this._fireRelationshipChangeEvents("toConstraints")},removePredecessorConstraint:function(o){this.get("fromConstraints").remove(o);this._fireRelationshipChangeEvents("fromConstraints")},removeSuccessorConstraint:function(o){this.get("toConstraints").remove(o);this._fireRelationshipChangeEvents("toConstraints")},getParent:function(){return b.getObjectById(this.parentId)},getValidTypes:function(t){var v=[];var s=this.getParent();if(s){var u=s.get(t);if(u){var p=u.get("dsxplan:vocabularyTerms")||u.get("dsplan:vocabularyTerms");if(p){for(var o=0;o<p.length;o++){var q=p.at(o);var r="E6WCommonApps.Type."+q.id.substring(q.id.indexOf(":")+1);v.push({actualValue:q.id,displayValue:m(r)})}return v}}}return v},dataForRendering:function(){var o=this._parent.apply(this,arguments);o.canEdit=this.get("canEdit");return o},setup:function(){this.setCollection("toConstraints",new k());this.setCollection("fromConstraints",new k());return this._parent.apply(this,arguments)},sync:function(t,q,p){if(t==="update"||t==="patch"){var o=g.clone(p||{},false);if(!o.hasOwnProperty("solve")){o.solve=this.shouldWeSolve(o)}if(o.solve){var r=this;o.onComplete=function(){var u=p&&g.is(p.onComplete,"function")&&p.onComplete.apply(this,arguments);r.solve();return u};var s=Array.prototype.slice.call(arguments,0);s[2]=o;return this._parent.apply(this,s)}}return this._parent.apply(this,arguments)},isAttributeImpactingSolve:function(o){var p=o;if(this.isDSLC()&&this.inverseDslcMapping){p=this.inverseDslcMapping[p]||p}return(this.attributeImpactingSolve&&this.attributeImpactingSolve[p])},shouldWeSolve:function(o){var q=this.getChangedAttributesSinceLastSave();if(q.some(this.isAttributeImpactingSolve.bind(this))||o.assumeChanges){for(var p=this.getParent();p&&p.hasViewAccess();p=p.getParent()){if(p.autosolve===i.AUTOSOLVE_OFF){c.dispatcher.dispatchEvent("solveNeeded",[this]);return false}else{if(p.autosolve===i.AUTOSOLVE_ON){return true}}}return true}return false},solve:function(p){var q=this;this.solveCounter++;var o=g.clone(p||{});var s=o.onComplete;o.onComplete=function(v){q.solveCounter--;var t=v&&v.member||[];for(var u=0;u<t.length;u++){b.getExistingAndMerge(t[u],{animate:true})}return s&&s.apply(this,arguments)};var r=o.onFailure;o.onFailure=function(){q.solveCounter--;return r&&r.apply(this,arguments)};n.solve(o,this.id)},getDurationAttributeAsDays:Function.prototype,getFromConstraints:function(){return this.get("fromConstraints")},getToConstraints:function(){return this.get("toConstraints")},removeObject:function(q,p,o){if(p instanceof h){p.destroy(o)}else{this._parent.apply(this,arguments)}},getIconURL:function(){return""},hasConstraintWith:function(o){var p=this.getFromConstraints().some(function(q){return q.getSuccessor().id===o.id});return p||this.getToConstraints().some(function(q){return q.getPredecessor().id===o.id})},isVersion:function(){return true},get:function(o){var p=this._parent.apply(this,arguments);if(o===i.PARENT_ATTR&&!p&&this.hasFetchedAttribute(o)){p=new a()}return p}};c._propertyDictionary["dsplan:actualType"]={volatility:true};c=e.extend(c,f,d);c.dispatcher=new g.Class.Events();Object.defineProperty(c.prototype,"solveCounter",f.solveCounterDef);Object.defineProperty(c.prototype,"prevSolveCounter",f.prevSolveCounterDef);c.SOLVER_URI="dsmf:xplan.Scheduler.JSONScheduleObjects?$mask=dsplan:MVMask.ScheduleElements.Complex";h.ScheduleElementModel=c;return c});define("DS/E6WCommonApps/Models/RDFTaskModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/Collections/PersonCollection","DS/RDFFoundation/Models/PersonRDFModel","DS/RDFFoundation/MaskUtils","DS/E6WCommonApps/Models/ScheduleElementModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/TaskModelMixin","DS/E6WCommonApps/Models/FileManagementMixin","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Models/E6WCommonAppsConstants"],function(b,N,q,m,i,G,P,v,C,J,R,E,t){var I=t.dslcMapping;var M=v.inverseMapping(I);var L=function(U){U.setMinutes(0);U.setSeconds(0);U.setMilliseconds(0)};var k="deliverables";var j="state";var l="dscom:hasMaturity";var c="dsplan:estimatedEndDate";var p="dsplan:estimatedStartDate";var z="stateForDisplay";var s="modified";var Q="actualStartDate";var y="dsplan:MVMask.Task.Property";var g=128;var r={"dsxplan:Open":"To Do","dsxplan:InProgress":"In Progress","dsxplan:Done":"Done"};var d={"To Do":"dsxplan:Open","In Progress":"dsxplan:InProgress",Done:"dsxplan:Done"};var h={"dsxplan:Open":"Assign","dsxplan:InProgress":"Active","dsxplan:Done":"Complete"};var w={Create:"dsxplan:Open",Assign:"dsxplan:Open",Active:"dsxplan:InProgress",Review:"dsxplan:InProgress",Complete:"dsxplan:Done"};var F={Open:"To Do","In Progress":"In Progress",Done:"Done"};var n={"To Do":"Open","In Progress":"In Progress",Done:"Done"};var O={Open:"Assign","In Progress":"Active",Done:"Complete"};var e={Create:"Open",Assign:"Open",Active:"In Progress",Review:"In Progress",Complete:"Done"};var A={"dsplan:hasAssignee":J.ASSIGNEESATTR,"dskern:owner":J.OWNERATTR,"dsplan:actualStartDate":"actualStartDate","dspol:modificationDate":"modified","dsplan:hasAttachment":"references","dsplan:actualDeliverable":"deliverables"};A[c]=J.DUEDATEATTR;var a={};var u=Object.keys(A);var o=u.length;for(var K=0;K<o;K++){var H=u[K];a[A[H]]=H}var T="@id";var x="dsplan:percentageCompletion";var B=1;var S={"dsxplan:estimatedEndDate":{format:"UTC",itemType:"field",name:"dsxplan:estimatedEndDate"},"dsxplan:modificationDate":{format:"UTC",itemType:"field",name:"dsxplan:modificationDate"}};var f=P.extend({writeMask:"dsplan:MVMask.Task.Complex",liveUpdateCreateMask:"dsplan:MVMask.Task.CollaborativeTasks.Complex",_propertyDictionary:{solveCounter:{volatility:true},toConstraints:{volatility:true},fromConstraints:{volatility:true},dueDateCategory:{volatility:true},dueDate:{date:true},modified:{date:true},actualStartDate:{date:true},"dsxplan:workscopeParent":{inverseProperty:"dsxplan:hasTask",inversePropertyIsCollection:true},"dsxplan:hasScheduleError":{volatility:true}},idAttribute:T,_uwaClassName:"RDFTaskModel",_relations:[{key:"rdf:type",relatedCollection:q},{key:"dsxplan:hasAssignee",relatedCollection:m}],_collectionConstructor:q,getObjectType:function(){return t.TASK},getParent:function(){return this.get(t.PARENT_ATTR)},setup:function(){var W=this;this.nbInFlightRequests=0;this._parent.apply(this,arguments);var U={};U["onChange:"+t.ACTUAL_START_DATE]=this._clearStartDateCachedValue;U["onChange:"+t.STARTDATE_ATTR]=this._clearStartDateCachedValue;U["onChange:"+t.STATE_ATTR]=this._clearStartDateCachedValue;this.listenTo(this,U);this.listenTo(this,"onReset",this._filterDatabyScope);this.listenTo(this,"onChange:"+this.ASSIGNEESATTR,function(){this._filterDatabyScope()});this.listenTo(this,"onChange:"+l,function(Z,ac,Y){var ab,aa;if(enoviaServer.useFD01CodeFor3DPlan){ab=F[ac];aa=O[ac]}else{ab=ac&&r[ac["@id"]||ac.id];aa=h[ac]}var X=l;if(Z.isDSLC()){X=Z.dslcMapping[l]}var ad=r[Z.previousAttributes()[X]];if(ad!==ab&&!Y.silent){Z.dispatchEvent("onChange:"+z,[Z,ab,Y]);Z.dispatchEvent("onChange:"+j,[Z,aa,Y])}});var V=Object.keys(A);V.forEach(function(X){W.listenTo(W,"onChange:"+X,function(Z,aa,Y){if(!Y||!Y.silent){Z.dispatchEvent("onChange:"+A[X],arguments)}})});this.listenTo(this,"onChange:"+this.DUEDATEATTR,function(Z,aa,Y){var ab=new Date(this.previousAttributes()["dsxplan:estimatedEndDate"]);var ac=this.dueDateCategory(ab);var X=this.dueDateCategory(aa);if(!Y.silent&&ac!==X){Z.dispatchEvent("onChange:"+this.DUEDATECATEGORY,arguments)}})},isProjectTask:function(){return false},isRouteTask:function(){return false},isRDFTask:function(){return true},subscriptionsEnabled:function(){return false},getCustomFields:function(){},isInCurrentScope:function(){var U=E.getScope();if(E.isScopeRDF()&&!U.ownsOrContainsTask(this)){return false}if(E.getFilter()==="all"&&E.isScopeRDF()){return true}var V=this._isInCurrentUserScope();if(!E.getScopeId()&&V){return true}if(E.isScopeRDF()&&V){return true}else{return false}},_isInCurrentUserScope:function(){if(this.hasFetchedAttribute("dsxplan:hasAssignee")){var V=window.enoviaServer.user;var W=this.getAssignees();var X=W.toArray();var U=this.get(t.OWNER_ATTR);if((!U||!U.length)&&this.isNew()){U={get:function(Z){var Y;if(Z==="name"){Y=V}return Y}}}if(U){X=X.concat(U)}return this._checkUserInAssigneeList(X,V)}return true},_checkUserInAssigneeList:function(Z,W){var X=function(aa){return aa.get("name",{noMapping:true})};var U,V;for(var Y=0;Y<Z.length;Y++){V=Z[Y];U=X(V);if(U&&W&&U.toUpperCase()===W.toUpperCase()){return true}}return false},_filterDatabyScope:function D(V){var U=this;if(this.collection&&!E.isScopeRDF()){b.Utils.setImmediate(function(){if(U.collection&&!U.isInCurrentScope()){U.collection.remove(U)}if(typeof V==="function"){V()}})}},getValidTypes:function(){var U=this.isDSLC()?"dsxplan:hasTaskVocabulary":t.TASK_VOCABULARY_ATTR;return this._parent(U)},get:function(Z){var W=Array.prototype.slice.call(arguments,0);var X=a[Z]||Z;W[0]=X;var V=this._parent.apply(this,W);var U=this._propertyDictionary[Z];if(U&&U.date){var Y=V;if(Y){return new Date(Y)}else{return undefined}}if(X===Z){V=this._getAttributeValue(Z,V)}return V},_getAttributeValue:function(U,Z){switch(U){case"dsplan:actualType":case"dsxplan:actualType":var V=Z;var W=V?{actualValue:Z.id,displayValue:V.get("title")}:null;return W;case"dsxplan:vocabularyType":if(!Z){Z="dsxplan:Task"}break;case j:var X=this.get(l);if(X){if(enoviaServer.useFD01CodeFor3DPlan){Z=O[X]}else{Z=h[X["@id"]||X.id]}}return Z;case z:var Y=this.get(l);if(Y){if(enoviaServer.useFD01CodeFor3DPlan){Z=F[Y]}else{Z=r[Y["@id"]||Y.id]}}return Z;case this.DUEDATECATEGORY:return this.dueDateCategory(this.get(this.DUEDATEATTR));case this.REFERENCEATTR:case k:return[];case t.PARENT_ATTR:return Z||P.prototype.getParent.call(this);default:}return Z},getFieldDef:function(U){return S[U]},addObjects:function(V,U){var W=Array.prototype.slice.call(arguments,0);W[1]=this.rdfCollabTaskInverseMapping[U]||U;return this._parent.apply(this,W)},set:function(){var W=C.setHelper.apply(this,arguments);var V=b.clone(W.attrs||{},false);var U=b.clone(W.options||{},false);if(V){if(V.hasOwnProperty(j)){V[l]=enoviaServer.useFD01CodeFor3DPlan?e[V[j]]:v.getObjectForAdding(N,w[V[j]]);delete V[j]}if(V.hasOwnProperty(z)){V[l]=enoviaServer.useFD01CodeFor3DPlan?n[V[z]]:v.getObjectForAdding(N,d[V[z]]);delete V[z]}if(V.hasOwnProperty(this.DUEDATECATEGORY)){V[this.DUEDATEATTR]=this.dueDateCategory2DueDate(V[this.DUEDATECATEGORY]);delete V[this.DUEDATECATEGORY]}if(V.hasOwnProperty(this.DUEDATEATTR)){this._processDueDate(V)}if(!U.parse&&!U.dontAdjustDates){this._adjustStartAndEndDates(V)}if(V.hasOwnProperty(t.DSLC_TITLE_ATTR)&&V[t.DSLC_TITLE_ATTR]!==undefined){V[t.DSLC_TITLE_ATTR]=V[t.DSLC_TITLE_ATTR].substring(0,g)}return this._parent(V,U)}return this._parent.apply(this,arguments)},_processDueDate:function(X){var V=X[this.DUEDATEATTR];delete X[this.DUEDATEATTR];V=b.is(V,"string")?parseInt(V,10):V;V=V instanceof Date?V:new Date(V);X[c]=V;if(!this.isStarted()){var aa=new Date(this._attributes["dsxplan:estimatedEndDate"]).getTime();var U=new Date(this._attributes["dsxplan:estimatedStartDate"]).getTime();var Z=aa-U;var W=new Date(V).getTime()-Z;X[p]=new Date(W)}var Y=!isNaN(V);X[t.USER_DEFINED_START_DATE_ATTR]=Y;X[t.USER_DEFINED_END_DATE_ATTR]=Y},_adjustStartAndEndDates:function(Z){var Y=Z[t.STARTDATE_ATTR];var U=Z[t.ENDDATE_ATTR];if(Y||U){var V=Y?Y:this.getStartDate();var W=U?U:this.getEndDate();if(V&&W){var X={start:new Date(V),end:new Date(W)};this.adjustDatesBasedOnDuration(X);if(Y||(X.end<new Date(V))){Z[t.STARTDATE_ATTR]=X.start.toISOString()}if(U||(X.start>new Date(W))){Z[t.ENDDATE_ATTR]=X.end.toISOString()}}}},addAssigneesByName:function(V){var U=V.map(function(W){return v.getObjectForAdding(i,"iam:"+W,{mask:"dskern:MVMask.Person.Complex"})});return this.addObjects(U,"dsxplan:hasAssignee")},toJSON:function(X){var Y=b.clone(X||{},false);var al;if(Y.attributes&&Y.dataForRendering){al=Object.create(null);var U=b.clone(Y.attributes,false);var an=U.length;for(var af=0;af<an;af++){var aj=U[af];var W=a[aj];al[aj]=true;if(W){al[W]=true;U.push(W)}}Y.attributes=U}var ae=this._parent(Y);if(!Y.dataForRendering){delete ae.dueDateCategory}if(Y.dataForRendering){var aa=!al;var ac=this;var am=function(ao){if(aa||al[ao]){var ap=ac.get(ao);if(ap){ae[ao]=ap}}};if(aa||al[t.PARENT_ATTR]){var ab=this.get(t.PARENT_ATTR);if(ab){var ad=Y.ancestors;if(!ad){Y.ancestors=ad={}}ad[ab.id]=true;ae[t.PARENT_ATTR]=ab.toJSON(Y)}}am(j);am(this.DUEDATEATTR);am(this.DUEDATECATEGORY);am(s);am(Q);am("canEdit");ae.id=this.id;if(aa||al.assignees){var V=ae["dsplan:hasAssignee"]||ae["dsplan:hasAssignee"];if(V){ae.assignees=V}}am(z);ae.date=new Date(this.getEndDate())}var ag=Object.keys(ae);var ak=ag.length;for(var Z=0;Z<ak;Z++){var ai=ag[Z];var ah=ae[ai];if(ah instanceof Date){ae[ai]=ah=C.dateForJSON(ah,"UTC",this.dateHelper,X)}}return ae},getCreationDate:function(){return(this.get(t.CREATION_DATE_ATTR))},getStartAndFinishDates:function(){return{start:new Date(this.getStartDate()),finish:new Date(this.getEndDate())}},getStartDate:function(){var U=this.isStarted()?"dsplan:actualStartDate":"dsplan:estimatedStartDate";if(this._changing&&this.hasChanged(U)){this._clearStartDateCachedValue()}if(!this._startDate){this._startDate=this.get(U)}return this._startDate},_clearStartDateCachedValue:function(){delete this._startDate},getEndDate:function(){return(this.isComplete()?this.get(t.ACTUAL_END_DATE):this.get(f.ENDDATE_ATTR))},setStartDate:function(U,V){this._setDateAttribute(f.STARTDATE_ATTR,U,V)},setEndDate:function(V,U){this._setDateAttribute(f.ENDDATE_ATTR,V,U)},getPercentComplete:function(){return this.get(x)||0},getDurationMinAsDays:function(){return this.getDurationAttributeAsDays(t.DURATION_MIN)},getDurationMaxAsDays:function(){return this.getDurationAttributeAsDays(t.DURATION_MAX)},getDurationAttributeAsDays:function(U){var V=this.get(U)||B;V=V&&this.getDaysString(V);return V},getSuggestedDuration:function(){var V=this.getDurationMinAsDays();var U=this.getDurationMaxAsDays();if(V===undefined){return U}if(U===undefined){return V}return(V+U)/2},getSuggestedOffset:function(){var V=this.getDurationMinAsDays();var U=this.getDurationMaxAsDays();if(V===undefined||U===undefined){return 0}return(U-V)/2},getEstimatedDuration:function(){var U=this.get(t.DURATION_ESTIMATED);if(U){U=this.getDaysString(U)}return(U)},getAssignees:function(){return this.getCollectionAttribute(t.ASSIGNEE_ATTR,{detailsMask:"dskern:MVMask.Person.Complex"})},isComplete:function(){var V=this.get(t.STATE_ATTR);if(enoviaServer.useFD01CodeFor3DPlan){return V==="Done"}else{var U=V&&(V.id||V["@id"]);return U===t.STATE_DONE}},isStarted:function(){var V=this.get(t.STATE_ATTR);if(enoviaServer.useFD01CodeFor3DPlan){return V==="Done"||V==="In Progress"}else{var U=V&&(V.id||V["@id"]);return U===t.STATE_DONE||U===t.STATE_IN_PROGRESS}},isFixed:function(){var U=this.isStartDateFixed()||this.isEndDateFixed();return(U)},isStartDateFixed:function(){return this.get(t.USER_DEFINED_START_DATE_ATTR)},isEndDateFixed:function(){return this.get(t.USER_DEFINED_END_DATE_ATTR)},fetchForProperty:function(){var V=this;var U=function(X){V.fetch({ajax:X,mask:y,onlyIfNeeded:true,onComplete:function(){V._getTitlesForConnectedScheduleElements()}})};if(!this.hasFetchedAccessData()){var W=this.getAccessBatch();U(W.ajax);W.sendBatch()}else{U()}},_getTitlesForConnectedScheduleElements:function(){var U=[];var V=function(W){if(!W.get(t.DSLC_TITLE_ATTR)&&U.indexOf(W.id)===-1){U.push(W.id)}};this.getToConstraints().forEach(function(W){if(W.getPredecessor()){V(W.getPredecessor())}});this.getFromConstraints().forEach(function(W){if(W.getSuccessor()){V(W.getSuccessor())}});if(U.length>0){v.complete(undefined,U,{mask:"dsplan:MVMask.Task.Basic"})}},getCompressionLevel:function(){var W=0;if(!this.isComplete()){var U=this.getSuggestedDuration();var V=this.getEstimatedDuration();var X=this.getSuggestedOffset();if(V&&U<V){if(V>=(U+X)){W=-1}}else{if(V&&V<U){if(V<=(U-X)){W=2}else{W=1}}}}return W},getIconURL:function(){return window.enoviaServer.computeUrl("/common/images/iconSmallTask.png")},getWorkDayLength:function(){return t.WORKING_HOURS_IN_A_DAY},_getStartOfWorkDay:function(){return 8},_getEndOfWorkDay:function(){return 17},getWorkingHoursInMilliseconds:function(){return this.getWorkDayLength()*60*60*1000},getErrorAssigneeIds:function(){var V=this.get("dsxplan:hasScheduleError");var U=[];if(V){var W=V.at(0);if(W){if(W.get("@id")!==t.NO_SOLVER_ERROR){var X=W.get("dsplan:errorObject");if(X&&X.get){U.push(X.get("@id"))}}}}return U},syncDelete:function(V){var U=this.getParent();this._parent.apply(this,arguments);var W=V.onComplete;V.onComplete=function(){if(W){W.apply(this,arguments)}U.solve()}},getDaysString:function(U){return v.xsDateTimeDurationToMilliseconds(U)/this.getWorkingHoursInMilliseconds()},getDefinedDuration:function(){var U=this.getSuggestedDuration();return U?U:this.getEstimatedDuration()},save:function(V){var U=this.isDSLC()?"dsxplan:hasMaturity":"dscom:hasMaturity";var W=V&&V[z]==="To Do";W=W||(V&&V[U]||this.changedAttributes()[U])==="To Do";if(W&&this.get(t.ACTUAL_START_DATE)){this.unset(t.ACTUAL_START_DATE,{silent:true})}this._parent.apply(this,arguments)},isAttributeImpactingSolve:function(W){var U=this._parent.apply(this,arguments);if(!U&&W==="dsxplan:percentageCompletion"){var X=this.get(t.STATE_ATTR);var V=this.get(t.COMPLETE_PERCENT_ATTR);if(X&&((X.id===t.STATE_OPEN&&V>0)||(X.id===t.STATE_IN_PROGRESS&&V===0))){return true}}return U},parse:function(W){if(W&&W["@context"]){enoviaServer.useFD01CodeFor3DPlan=!W["@context"]["dsxplan:jsType"]}var Y=this.getParent();var X=this._parent.apply(this,arguments);if(W&&b.is(W,"object")){var V=W["@mask"];var U=G.getMask(V)||{};if(Y===undefined&&U[t.PARENT_ATTR]&&!W[t.PARENT_ATTR]){this.dispatchEvent("onChange:"+t.PARENT_ATTR)}}return X},adjustDatesBasedOnDuration:function(U){L(U.start);L(U.end);var W=this.getDefinedDuration()||1;var V=W-1;if(this.isStartDateFixed()&&!this.isEndDateFixed()){U.end=new Date(U.start);U.end.setDate(U.start.getDate()+V)}else{if(this.isEndDateFixed()&&!this.isStartDateFixed()){U.start=new Date(U.end);U.start.setDate(U.end.getDate()-V)}}U.start.setHours(this._getStartOfWorkDay());U.end.setHours(this._getEndOfWorkDay())}});f.implement(J,R);f.PersonRDFModel=i;f.STARTDATE_ATTR="dsplan:estimatedStartDate";f.ENDDATE_ATTR="dsplan:estimatedEndDate";f.STATE_ATTR=t.STATE_ATTR;f.prototype.dslcMapping=I;f.prototype.inverseDslcMapping=M;f.prototype.attributeImpactingSolve=t.attributeImpactingSolve;f.prototype.rdfCollabTaskMapping=A;f.prototype.rdfCollabTaskInverseMapping=a;Object.defineProperty(f.prototype,"completed",{get:function(){var U=this.collection&&this.collection.getDetailsMask()||"dsplan:MVMask.Task.CollaborativeTasks.Complex";return(this.hasDataForMask(U))&&!this.fetching}});Object.defineProperty(f.prototype,"extid",{get:function(){return this.cid}});Object.defineProperty(f.prototype,"fixed",{get:function(){return this.isFixed()}});return f});define("DS/E6WCommonApps/SmartSchedulerUtils",["DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Views/LinkLauncherUtils","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(a,c,e){var d="fromCompletionDate";var g="completedTasksDisplayPref";var f=function(h){return e.get(h)};var b={};b.getCompletedTaskFilter=function(){var j="all";var i=widget.getValue(b.COMPLETED_TASK_PREF_NAME);if(i&&i!=="all"){var h=new Date();h.setDate(h.getDate()-i);j=h.toISOString()}return{fromCompletionDate:j}};b.setCompletedTaskFilter=function(h){widget.setValue(b.COMPLETED_TASK_PREF_NAME,h)};b.getCompletedTasksFilterPref=function(){return{name:b.COMPLETED_TASK_PREF_NAME,type:"list",defaultValue:"all",options:[{label:f("E6WCommonApps.Label.CompletedTasksAllDays"),value:"all"},{label:f("E6WCommonApps.Label.CompletedTasksLast10Days"),value:10},{label:f("E6WCommonApps.Label.CompletedTasksLast30Days"),value:30},{label:f("E6WCommonApps.Label.CompletedTasksLast60Days"),value:60}],label:f("E6WCommonApps.Label.CompletedTasksDisplayPref")}};b.getDropDownMenuItems=function(k,q){var n=this;var m=Boolean(this._config.readWrite);var l=n.normalizedGet(this.model,this._config.name);var p=n.normalizedGet(l,"type");var j=p==="Project";var o=p==="WorkPackage";var i=l.get("physicalId")||l.id;var h=[{text:f("E6WCommonApps.Label.Open"),fonticon:"open",className:l.hasViewAccess&&!l.hasViewAccess()?"disabled":null,handler:function(){c.openInApp(j,o,i)}},{text:f("E6WCommonApps.Label.Detach"),fonticon:"link-off",className:!n.normalizedGet(n.model,"canEdit")||!m?"disabled":null,handler:function(){var r=n.container.getAttribute("data-field-name");n.model.remove(r,q.index,q.options)}}];return h};b.COMPLETION_DATE_TASK_FILTER_ATTR=d;b.COMPLETED_TASK_PREF_NAME=g;return b});define("DS/E6WCommonApps/Models/MilestoneModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/FileManagementMixin","DS/E6WCommonApps/Models/ScheduleElementModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper"],function(e,c,h,a,d,b,k){var f="Milestone";var l="dsplan:actualDate";var j={title:"dsxplan:label","dsplan:estimatedDate":"dsxplan:estimatedDate","dskern:comment":"dsxplan:comment","dsplan:sequenceOrder":"dsxplan:sequenceOrder","dsplan:dateIntervalMax":"dsxplan:dateIntervalMax","dsplan:dateIntervalMin":"dsxplan:dateIntervalMin","dsplan:actualDate":"dsxplan:actualDate","dscom:hasMaturity":"dsxplan:hasMaturity","dskern:owner":"dsxplan:owner","dsplan:hasAssignee":"dsxplan:hasAssignee","dsplan:requiresSkill":"dsxplan:requiresSkill","dspol:modificationDate":"dsxplan:modificationDate","rdf:type":"dsxplan:type",subtitle:"dsxplan:comment","dsplan:suggestedDate":"dsxplan:suggestedDate","dsplan:userDefinedDates":"dsxplan:userDefinedDates","dsplan:hasAttachment":"dsxplan:hasAttachment"};var i=b.inverseMapping(j);var g=d.extend({attributeImpactingSolve:{"dsplan:dateIntervalMin":true,"dsplan:dateIntervalMax":true,"dsplan:estimatedDate":true,"dsplan:suggestedDate":true,"dscom:hasMaturity":true,"dsplan:userDefinedDates":true},_uwaClassName:"MilestoneModel",writeMask:"dsplan:MVMask.Milestone.Writing",liveUpdateCreateMask:"dsplan:MVMask.Milestone.Complex",save:function(){var n=k.setHelper.apply(this,arguments);var m=n.options;if(this.isGhost()){m&&m.onFailure&&m.onFailure(this,{msg:"Error: xPlan.Error.NoModifyDPMMilestone","@code":401});this.rollbackChanges();return false}else{return this._parent.apply(this,arguments)}},validate_:function(p){var t={fields:[]};var q;var r=this;var m=true;var u=function(w){var x;if(p){x=p[w]}return x||r.get(w)};var n=Date(u.call(this,g.STARTDATE_ATTR));var s=Date(u.call(this,g.DATE_MIN_ATTR));var o=Date(u.call(this,g.DATE_MAX_ATTR));if(s>o){t.fields.push(g.DATE_MIN_ATTR);t.fields.push(g.DATE_MAX_ATTR);m=false}if(n>o||n<s){t.fields.push(g.STARTDATE_ATTR);if(n>o&&t.fields.indexOf(g.DATE_MAX_ATTR)===-1){t.fields.push(g.DATE_MAX_ATTR)}if(n<s&&t.fields.indexOf(g.DATE_MIN_ATTR)===-1){t.fields.push(g.DATE_MIN_ATTR)}m=false}var v=u(h.TITLE_ATTR);if(v===undefined||v===null){v=u(h.DSLC_TITLE_ATTR)}if(!(v&&v.trim().length)){t.fields.push(h.TITLE_ATTR);m=false}if(!m){q=t}return q},getObjectType:function(){return f},getValidTypes:function(){var m=this.isDSLC()?"dsxplan:hasMilestoneVocabulary":h.MILESTONE_VOCABULARY_ATTR;return this._parent(m)},get:function(n,m){var o=this._parent.apply(this,arguments);switch(n){case"dsplan:estimatedDate":case"dsplan:suggestedDate":case l:case"dsplan:dateIntervalMin":case"dsplan:dateIntervalMax":if(!m||!m.rawValue){if(typeof o!=="undefined"){o=new Date(o)}}break;case"dsplan:actualType":case"dsxplan:actualType":if(!m||!m.rawValue){o=o?{actualValue:o.id,displayValue:o.get("title")}:null}break;case"dsxplan:vocabularyType":if(!o){o="dsxplan:Milestone"}break;case"title":o=o?o:this.get("dsxplan:label");break;case"canEdit":o=!this.isGhost()&&o;break;default:}return o},getStartDate:function(){return(this.isComplete()?this.get(l):this.get(g.STARTDATE_ATTR))},setStartDate:function(o,v){var n=new Date(this.getStartDate()),p,m,s,q,t,r,u;this._setDateAttribute(g.STARTDATE_ATTR,o,v);this._setDateAttribute(g.SUGGESTEDDATE_ATTR,o,v);if(v){if(v.updateRestrictionWithStartDate){p=o-n;m=[];q=this.get(g.DATE_MIN_ATTR);t=this.get(g.DATE_MAX_ATTR);if(q){q=q.getTime();q+=p;this.setDateIntervalMin(new Date(q),{silent:true});m.push("onChange:"+g.DATE_MIN_ATTR);s=true}if(t){t=t.getTime();t+=p;this.setDateIntervalMax(new Date(t),{silent:true});m.push("onChange:"+g.DATE_MAX_ATTR);s=true}s&&this.dispatchEvent("onChange:minAndMax",[m])}if(v.updateRestrictionIfExceeded){q=this.get(g.DATE_MIN_ATTR);m=[];if(q){r=q-o>0&&q-n<=0;if(r){this.setDateIntervalMin(o,{silent:true});m.push("onChange:"+g.DATE_MIN_ATTR);s=true}}t=this.get(g.DATE_MAX_ATTR);if(t){u=o-t>0&&n-t<=0;if(u){this.setDateIntervalMax(o,{silent:true});m.push(g.DATE_MAX_ATTR);s=true}}s&&this.dispatchEvent("onChange:minAndMax",m)}}},setDateInterval:c.prototype._setDateAttribute,setDateIntervalMin:function(p,o){var n=e.clone(o||{},false);var m=this.getDateIntervalMin();var q=this.getDateIntervalMax();this.setDateInterval(g.DATE_MIN_ATTR,p,n);var r=new Date(this.getStartDate());if(p-r>0&&m-r<=0){n.updateRestrictionIfExceeded=true;this.setStartDate(p,n)}if(p-q>0){delete n.updateRestrictionIfExceeded;this.setDateIntervalMax(p,n)}},setDateIntervalMax:function(p,o){var n=e.clone(o||{},false);var m=this.getDateIntervalMax();var r=this.getDateIntervalMin();this.setDateInterval(g.DATE_MAX_ATTR,p,n);var q=new Date(this.getStartDate());if(q-p>0&&q-m<=0){n.updateRestrictionIfExceeded=true;this.setStartDate(p,n)}if(r-p>0){delete n.updateRestrictionIfExceeded;this.setDateIntervalMin(p,n)}},getDateIntervalMin:function(){return this.get(g.DATE_MIN_ATTR)},getDateIntervalMax:function(){return this.get(g.DATE_MAX_ATTR)},isFixed:function(){return this.get(g.FIXED_DATE)},isComplete:function(){var n=this.get(h.STATE_ATTR);var m=n&&(n.id||n["@id"]);return(m===h.STATE_DONE)},canModify:function(){var m=this.getParent();return m?m.canModify():false},canDelete:function(){if(this.isGhost()){return false}else{return this.getParent().canDelete()}},getIconURL:function(){return window.enoviaServer.computeUrl("/common/images/iconSmallGate.png")},fetchForProperty:function(){var m={mask:"dsplan:MVMask.Milestone.Property",dontUpdateMask:true,onlyIfNeeded:true};this.fetch(m)},isGhost:function(){return(this.get("dsxplan:vocabularyType")==="dsxnpi:MilestoneExternal")}});g.STARTDATE_ATTR="dsplan:estimatedDate";g.SUGGESTEDDATE_ATTR="dsplan:suggestedDate";g.DATE_MIN_ATTR="dsplan:dateIntervalMin";g.DATE_MAX_ATTR="dsplan:dateIntervalMax";g.FIXED_DATE="dsplan:userDefinedDates";g.STATE_ATTR="dscom:hasMaturity";g.ACTUAL_DATE=l;g.prototype.dslcMapping=j;g.prototype.inverseDslcMapping=i;g.implement(a);return g});define("DS/E6WCommonApps/Collections/RDFTasksCollection",["UWA/Core","UWA/Class/Events","UWA/Class/Listener","UWA/Class","UWA/Class/Collection","DS/RDFFoundation/Collections/ResultCollection","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/RDFTaskModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ResultModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/XTaskScope","DS/RDFFoundation/Models/PersonRDFModel","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Collections/TasksSplitCollection","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(h,k,g,t,z,b,r,s,c,i,e,x,y,m,n,l,o){var f=Function.prototype;var p="state";var j=function(A){var B=o.get(A);B===A&&(B=l.get(A));return B};var a=function(A){return(A&&A.actualValue)||A};var w=b.extend({_uwaClassName:"RDFWorkscopeCollection"});var d=b.extend({model:s,_relations:{key:"scopes",relatedCollection:w},_uwaClassName:"RDFTasksCollection",comparator:function(B,A){var H=B.get("dsxplan:sequenceOrder");var G=A.get("dsxplan:sequenceOrder");if(H!==undefined&&G!==undefined&&H!==G){return H-G}var F=B.newThisSession?1:0;var E=A.newThisSession?1:0;var D;var C;if(!B.newThisSession&&!A.newThisSession){D=new Date(B.getStartDate());C=new Date(A.getStartDate());F=D.getTime();E=C.getTime()}if(F===E){D=new Date(B.get("dspol:creationDate"));C=new Date(A.get("dspol:creationDate"));F=D.getTime();E=C.getTime()}return F-E},_doneCompleting:function(){this.completing=false;if(this.toComplete&&this.toComplete.length){var A=this.toComplete;delete this.toComplete;this.complete(A)}},complete:function(D,C){var B=h.clone(C||{},false);var A=D.filter(function(G){return G instanceof i||h.is(G,"string")});var F=A.map(function(G){return G.id||G});if(F.length){if(!this.completing){var E=this._doneCompleting.bind(this);this.completing=true;c.complete(this.model,F,{mask:this.getDetailsMask(),onComplete:E,onFailure:E,onlyIfNeeded:B.onlyIfNeeded,attrs:{forceDslc:true}})}else{if(!this.toComplete){this.toComplete=[]}Array.prototype.push.apply(this.toComplete,F)}}},setAttrToSplitBy:function(A){this._attrToSplitBy=A},setIdForCreateChild:function(A){this._createChildId=A},getIdForCreateChildDSLC:function(){if(this._createChildId){return this._createChildId}return this._parent.apply(this,arguments)},addNewTask:function v(A,F,C){var E;if(window.widget){var B={title:A,"dsxplan:durationIntervalMin":"PT86400S","dsxplan:durationIntervalMax":"PT86400S"};var D=F||this.parentModel;E=D.addTask(B);var G=this.getUri()==="/invoke/dsxplan:getTasks"?this.currentScopeCollection:this;if(G&&G!==D.getTasks()){this.add(E);E.keepWhenUpdating=true}E.save(null,{onFailure:function(){r.displayError(j("E6WCommonApps.Error.FailedToCreateTask"));C&&C.onFailure&&C.onFailure.apply(this,arguments)},onComplete:function(H){H.solve();C&&C.onComplete&&C.onComplete.apply(this,arguments)},at:0})}return E},setup:function q(D,C){var B=Array.prototype.slice.call(arguments,0);this._TasksByAttr={};this._attrToSplitBy=p;this.extid="allTasks";var A=h.clone(C,false);this.parentModel=A.parentModel;B[1]=A;this._parent.apply(this,B)},setSearch:function(A){this._search=A.toLowerCase();this._cleanupSubCollections()},resetSearch:function(){delete this._search;this._cleanupSubCollections()},getSearch:function(){return(this._search)},tasksWithAttrValue:function(E,A){var D=this;var C=A?A:this._attrToSplitBy;var B=a(E);return this.filter(function(J){var H=a(J.get(p));var G=a(J.get(C));var I=a(J.get("dsxplan:label"));I=I?I.toLowerCase():"";var F=D._search?r.match(D._search,I):true;return(C==="dueDateCategory"&&H==="Complete")?false:(G===B&&F)})},tasksWithAttrValueCollection:function u(H,C){if(typeof H==="undefined"){throw new Error("Invalid attribute value passed.")}var F=C?C:this._attrToSplitBy;var E=a(H);var B=this._TasksByAttr[F];if(!B||!B[E]){var G=this.tasksWithAttrValue(H,F);var A={filterAttr:F,valueForFiltering:H,parentCollection:this};var D=new d.TasksSplitCollection(G,A);D.extid="tasks-"+F+"-"+E;if(!B){this._TasksByAttr[F]=B={}}B[E]=D}return B[E]},_cleanupSubCollections:function(){var A=Object.prototype.hasOwnProperty;for(var B in this._TasksByAttr){if(A.call(this._TasksByAttr,B)){this._cleanupSubCollectionForAttr(B)}}},_cleanupSubCollectionForAttr:function(C){var B=Object.prototype.hasOwnProperty;var E=this._TasksByAttr[C];for(var D in E){if(B.call(E,D)){var A=E[D];A.stopListening();delete E[D]}}},scopesTypesForSearch:function(){return[]},scopesTypes:function(){return[]},projectTypesForSearch:function(){if(c.typeDictionary&&c.typeDictionary.typeHierarchy){return c.typeDictionary.typeHierarchy["dsplan:WorkPackage"]}return undefined},projectTypes:function(){if(c.typeDictionary&&c.typeDictionary.typeHierarchy){return c.typeDictionary.typeHierarchy["dsplan:WorkPackage"]}return undefined},reset:function(E,A){if(E&&E["@context"]){enoviaServer.useFD01CodeFor3DPlan=!E["@context"]["dsxplan:jsType"]}var C=Array.prototype.slice.call(arguments,0);if(x.isScopeRDF()&&A&&A.parse){var B={};try{B.member=E["dsxplan:hasTask"].member;B["@href"]="/classes/dsplan:Task";B["@id"]="dsplan:Task";B["@mask"]="dsplan:MVMask.Task.CollaborativeTask.Basic";B["@type"]="Collection";B.totalItems=B.member.length;C[0]=B}catch(D){}}this._parent.apply(this,C)},_scopeCollectionAdd:function(C,D,B){var A=h.clone(B||{},false);A.parse=false;this.add(C,A)},_scopeCollectionRemove:function(C,D,B){var A=h.clone(B||{},false);A.parse=false;this.remove(C,B)},_scopeCollectionReset:function(B){var A=B.toArray();this.reset(A)},fetch:function(L){var G=this;var I={cancel:f};var A=h.clone(L||{},false);if(A.dontFetch){return I}var F={cancel:function(){}};var K=function(M){if(M){A.ajax=M.ajax;A.batchGenerator=M;A.newTransaction=true}if(A.url){return z.prototype.fetch.call(this,A)}else{return this._parent(A)}};if(x.getScopeId()&&!x.isScopeRDF()){this.reset(undefined,A);return F}var B;if(!c.typeDictionary||!c.typeDictionary.typeHierarchy){B=c.getDictionaryBatch()}var E={onAdd:this._scopeCollectionAdd,onRemove:this._scopeCollectionRemove,onReset:this._scopeCollectionReset};this.stopListening(undefined,E);if(x.isScopeRDF()&&A.reset){var C=B?{ajax:B.ajax,newTransaction:true,onFailure:function(){G.dispatchEvent("onFailToFindScope")},attrs:{forceDslc:true}}:undefined;var J=c.getObjectForAdding(d.RDFWorkscopeModel,x.getScopeId(),C);var D=J.getTaskCollectionForFilter(x.getFilter(),C);if(this!==D){this.listenTo(D,E);this.currentScopeCollection=D;this.reset(D.toArray())}K=function(){}}else{if(A.reset){h.merge(A,{method:"POST",data:JSON.stringify([x.getFilter(),m.getCompletedTaskFilter()]),headers:{"Content-Type":"application/json"}})}}if(B){K.call(this,B);var H=function(M){r.displayError(j("E6WCommonUI.Alert.3DPlanServiceFail"));return L&&M&&M.apply(this,arguments)};return B.sendBatch({onTimeout:H.bind(this,L&&(L.onTimeout||L.onFailure))})}else{return K.call(this)}},getRelatedObject:function(B,C){var A=new y(c.createPlaceholder(C));A.fetch({mask:"dskern:MVMask.Person.Complex"});return A},add:function(){var E=this;var A=this._parent.apply(this,arguments);if(A){var D=A;if(A instanceof s){D=[A]}for(var C=0;C<D.length;C++){var B=D[C];E.stopListening(B,"onChange:"+e.SEQUENCE_ORDER_ATTR);E.listenTo(B,"onChange:"+e.SEQUENCE_ORDER_ATTR,E.sort)}}return A}});d.TasksSplitCollection=n.extend({model:s,_uwaClassName:"RDFTasksSplitCollection",add:function(B){var A=Array.prototype.slice.call(arguments,0);if(h.is(B,"array")){A[0]=B.filter(function(C){return C.isInCurrentScope&&C.isInCurrentScope()})}else{if(B.isInCurrentScope&&!B.isInCurrentScope()){return false}}return this._parent.apply(this,A)},comparator:function(B,A){var F=B.get("dsplan:sequenceOrder");var E=A.get("dsplan:sequenceOrder");if(F!==undefined&&E!==undefined){return F-E}var D=new Date(B.getStartDate());var C=new Date(A.getStartDate());return D.getTime()-C.getTime()}});return d});define("DS/E6WCommonApps/Collections/ProjectTeamCollection",["UWA/Core","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/PersonRDFModel","DS/E6WCommonApps/Models/TeamMemberResponsibilityModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/LiveUpdateUtils","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(c,k,b,h,a,d,f,g,l){"use strict";var n=function(o){return l.get(o)};var j=function(o){var p=o.data[o.action].detect(function(q){return q.responsibility===o.role});if(!p){p=p||{responsibility:o.role,persons:[]};o.data[o.action].push(p)}return p};var e=function(o){o.data[o.action]=o.data[o.action]||[];var p=j(o);if(p.persons.indexOf(o.id)===-1){p.persons.push(o.id)}};var m=function(p){var o={};p.forEach(function(q){o[q.requestType]=o[q.requestType]||[];var s=q.memberModel.get("personRDFId");var r={data:o,id:s,action:q.requestType};switch(q.requestType){case f.REQUEST_TYPE_REMOVE:q.memberModel.get("allResponsibilitiesArray").forEach(function(t){e(c.extend(r,{role:t}))});break;default:e(c.extend(r,{role:q.memberModel.get("responsibility")}));break}});Object.keys(o).forEach(function(q){o[q].forEach(function(r){r.persons=JSON.stringify(r.persons)})});return o};var i=k.extend({_uwaClassName:"ProjectTeamCollection",model:d,setup:function(p,o){this._workscope=o&&o.workscope;this._addCollectionListeners();this._parent.apply(this,arguments)},_addCollectionListeners:function(){var o=this._workscope.getCollectionAttribute(f.ASSIGNEE_ATTR);this.listenTo(o,"onAdd",this._onAssigneeAddedToParentWorkscopeCollection);this.listenTo(this,"onRemove",function(){this._removeMemberFromParentWorkscope.apply(this,arguments)})},_onAssigneeAddedToParentWorkscopeCollection:function(o){var p=this.get(d.getInstanceId(o.id,this._workscope.id));if(!p){this.addMember(o.id,f.RESPONSIBILITY_LEADER)}},_removeMemberFromParentWorkscope:function(r,p,q){if(q&&!q.dontRemoveParentWorkscope){var o=this._workscope.getCollectionAttribute(f.ASSIGNEE_ATTR);var s=o.get(r.get("memberPersonModel"));if(s){o.remove(s,q)}}},fetch:function(p){var o=c.clone(p||{},false);if(!o.forceFetch&&this.initialized){o.dontFetch=true}else{o.data=JSON.stringify([this._workscope.id]);this.initialized=true}return this._parent(o)},getUri:function(){return"/invoke/dsaccess:sharing.getResourceSharing"},parse:function(o){return d.processRawData(o,this._workscope)},onSaveComplete:function(o){o.forEach(function(r){var s=r.memberModel;if(s){var q;var p=r.requestType;if(p===f.REQUEST_TYPE_ADD){q=n("E6WCommonApps.Label.AddMember")}else{if(p===f.REQUEST_TYPE_REMOVE){q=n("E6WCommonApps.Label.RemoveMember")}else{if(p===f.REQUEST_TYPE_REPLACE){q=n("E6WCommonApps.Label.ReplaceMember")}}}h.displaySuccess(l.replace(q,{MEMBER_NAME:s.get("title"),ROLE:s.get("responsibilityNLS")}));s.dispatchEvent("removeProgress")}})},onSaveFailure:function(r,p,o){var q=this;r.forEach(function(s){q.rollbackMemberChanges(s);var u=o&&o.msg;if(u){var t;t=b.splitUri(u)[1].trim();if(!o.error){t=b.splitUri(JSON.parse(u).msg)[1].trim()}if(t==="E6WCommonApps.Error.ownerRefused"){t=l.replace(n(t),{MEMBER_NAME:s.memberModel.get("title")})}h.displayError(n(t))}else{h.displayError(n("E6WCommonApps.Error.SaveFailed"))}s.memberModel.dispatchEvent("removeProgress")})},onSaveTimeout:function(o){o.forEach(function(p){p.memberModel.dispatchEvent("removeProgress")})},save:function(p){var o=m(p);b.request(b.expandUrl("/invoke/dsxplan:shareResources"),{method:"POST",type:"json",data:JSON.stringify([o,this._workscope.id]),headers:{"Content-Type":"application/json"},onComplete:this.onSaveComplete.bind(this,p),onFailure:this.onSaveFailure.bind(this,p),onTimeout:this.onSaveTimeout.bind(this,p)})},addMember:function(t,r,p){var o=c.clone(p||{},false);if(c.is(r,"string")){r=[r]}o.dontRegisterChange=true;var s=f.REQUEST_TYPE_ADD;var u=d.getMemberObj(t,r,this._workscope);var q=this.add(u,o);!o.rollBackFlag&&q.dispatchEvent("addProgress");return{memberModel:q,requestType:s}},resetMember:function(t,s,p){var o=c.clone(p||{},false);if(c.is(s,"string")){s=[s]}var q=f.REQUEST_TYPE_REPLACE;var r=t.get("allResponsibilitiesArray");t.set("allResponsibilitiesArray",s);!o.rollBackFlag&&t.dispatchEvent("addProgress");return{memberModel:t,requestType:q,oldResponsibilitiesArray:r}},removeMember:function(s,p){var o=c.clone(p||{},false);o.dontRegisterChange=true;var q=f.REQUEST_TYPE_REMOVE;var r=s.get("allResponsibilitiesArray");this.remove(s,o);return{memberModel:s,requestType:q,oldResponsibilitiesArray:r}},rollbackMemberChanges:function(o){var p=o.memberModel.get("personRDFId");var q=o.requestType;if(q===f.REQUEST_TYPE_ADD){this.removeMember(o.memberModel)}else{if(q===f.REQUEST_TYPE_REMOVE){this.addMember(p,o.oldResponsibilitiesArray,{rollBackFlag:true})}else{this.resetMember(o.memberModel,o.oldResponsibilitiesArray,{rollBackFlag:true})}}}});return i});define("DS/E6WCommonApps/Collections/HasConstraintsCollection",["UWA/Core","DS/RDFFoundation/Collections/ResultCollection","DS/E6WCommonApps/Models/ConstraintModel"],function(d,b,a){"use strict";var c=b.extend({_uwaClassName:"HasConstraintCollection",setup:function(){this._parent.apply(this,arguments);this.setDetailsMask("dsplan:MVMask.Constraint.Complex")},getUri:function(e){if(e&&e.forNewObject&&c.computedProperty){return"/classes/"+a.CONSTRAINT_RDF_TYPE}else{return this._parent.apply(this,arguments)}}});c.computedProperty=true;return c});define("DS/E6WCommonApps/Models/WorkscopeModel",["UWA/Core","DS/E6WCommonApps/Collections/ProjectTeamCollection","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/ScheduleElementModel","DS/E6WCommonApps/Collections/ConstraintsPseudoCollection","DS/E6WCommonApps/Models/ConstraintModel","DS/E6WCommonApps/Collections/RDFTasksCollection","DS/E6WCommonApps/Collections/HasConstraintsCollection","DS/E6WCommonApps/Models/SolverModelMixin","DS/E6WCommonApps/Models/CalendarModel","DS/E6WCommonApps/Models/AccessModel","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Models/FileManagementMixin","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/PlatformManager","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Models/MilestoneModel","DS/E6WCommonApps/Models/RepositoryModelMixin","DS/RDFFoundation/Collections/ResultCollection","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(a,v,C,q,s,I,k,G,r,B,e,M,t,A,K,x,b,E,y,j,L,m,u,p){"use strict";var N=function(O){var P=p.get(O);P===O&&(P=u.get(O));return P};var J="dsplan:hasTask";var H="dsplan:hasMilestone";var c=q.CONSTRAINT_RELATION_ATTR;var h="dsxplan:usesCalendar";var o=1;var l="team_members";var i="dsplan:hasThumbnail";var w=1000*60*60*24*1;var f={"dsplan:schedulingStrategy":true,"dsxplan:schedulingStrategy":true,"dsplan:startDateIntervalMin":true,"dsxplan:startDateIntervalMin":true,"dsplan:endDateIntervalMax":true,"dsxplan:endDateIntervalMax":true,"dsxplan:usesCalendar":true};var g={all:"dsxplan:hasTask",owned:"dsplan:ownedTasks",assigned:"dsplan:assignedTasks"};var n=t.extend({liveUpdateCreateMask:"dsplan:MVMask.WorkPackage.Collapsed",dslcMapping:{title:"dsxplan:label","dsplan:estimatedEndDate":"dsxplan:estimatedEndDate","dskern:comment":"dsxplan:comment","dsplan:sequenceOrder":"dsxplan:sequenceOrder","dscom:hasMaturity":"dsxplan:hasMaturity","dskern:owner":"dsxplan:owner","dsplan:hasAssignee":"dsxplan:hasAssignee","dsplan:requiresSkill":"dsxplan:requiresSkill","dspol:modificationDate":"dsxplan:modificationDate","rdf:type":"dsxplan:type",subtitle:"dsxplan:comment","dsplan:ScheduleUpdateStatus":"dsxplan:ScheduleUpdateStatus","dsplan:schedulingStrategy":"dsxplan:schedulingStrategy","dsplan:startDateIntervalMin":"dsxplan:startDateIntervalMin","dsplan:endDateIntervalMax":"dsxplan:endDateIntervalMax","dskern:image":"dxplan:image","dsplan:hasThumbnail":"dsxplan:hasThumbnail","dsplan:hasWorkContext":"dsxplan:hasWorkContext","dsplan:hasWorkDecomposition":"dsxplan:hasWorkDecomposition","dsplan:hasTask":"dsxplan:hasTask","dsplan:hasMilestone":"dsxplan:hasMilestone","dsplan:hasAttachment":"dsxplan:hasAttachment","dsplan:actualDeliverable":"dsxplan:actualDeliverable"},_propertyDictionary:{team_members:{volatility:true},thumbnail:{volatility:true},solveCounter:{volatility:true},"dsxplan:hasConstraint":{volatility:true},"dsplan:hasConstraint":{volatility:true},"dsxplan:workDecompositionParent":{inverseProperty:"dsxplan:hasWorkDecomposition",inversePropertyIsCollection:true},"dsxplan:hasWorkDecomposition":{inverseProperty:q.WORKSCOPE_PARENT_ATTR},"dsxplan:hasTask":{inverseProperty:"dsxplan:workscopeParent"}},_relations:[{key:q.CHILDREN_ATTR},{key:"dsxplan:hasWorkDecomposition"},{key:J,relatedCollection:r},{key:"dsxplan:hasTask",relatedCollection:r},{key:"dsplan:assignedTasks",relatedCollection:r},{key:"dsplan:ownedTasks",relatedCollection:r},{key:c,relatedCollection:B},{key:"dsxplan:hasConstraint",relatedCollection:B},{key:"dsxplan:hasMilestone",relatedCollection:m}],_modelProperties:{"dsplan:hasWorkContext":true,"dsxplan:hasWorkContext":true},_uwaClassName:"WorkscopeModel",parentMask:"dsplan:MVMask.WorkPackage.Complex",mask:"dsplan:MVMask.WorkPackage.Basic",writeMask:"dsplan:MVMask.WorkPackage.Complex",syncWithDPMIfNeeded:function(){s.request(s.expandUrl("invoke/dsplan:syncWithDPMIfNeeded"),{method:"POST",type:"json",data:JSON.stringify([this.compactJson()]),headers:{"Content-Type":"application/json"},onComplete:function(){}})},_getImage:function(O){if(!O){O=require.toUrl("E6WCommonApps/assets/img/XPlan-Placeholder-Concept-128.png");if(O){return O}}if(O&&O.indexOf("http://")===-1&&O.indexOf("https://")===-1){return require.toUrl("XPlanApp/assets/img/"+O)}return O},solve:function(P){var O=a.clone(P||{},false);O.listName="ProjectList";return I.prototype.solve.call(this,O)},sync:function(T,Q,P){var O=a.clone(P||{},false);if(T==="update"){if(!O.solve){O.solve=this.shouldWeSolve(O)}if(O.solve){var R=this;O.onComplete=function(){var U=P&&a.is(P.onComplete,"function")&&P.onComplete.apply(this,arguments);R.solve();return U};var S=Array.prototype.slice.call(arguments,0);S[2]=O;return this._parent.apply(this,S)}}return this._parent.apply(this,arguments)},syncCreate:function(S,R){var Q=Array.prototype.slice.call(arguments,0);var P=Q[1];var T=this;T.beingCreatedOnServer=true;var O=R.onFailure;var U=R.onComplete;P.onComplete=function(){T.beingCreatedOnServer=false;if(U){U.apply(this,arguments)}};P.onFailure=function(X,V,W){T.beingCreatedOnServer=false;if(W){W.response=V}if(O){O.apply(this,arguments)}};this._parent.apply(this,Q)},shouldWeSolve:function(O){var P;var Q=this.getChangedAttributesSinceLastSave();if(Q.some(this.isAttributeImpactingSolve.bind(this))||O.assumeChanges){P=this.getParent();for(;P;P=P.getParent()){if(P.autosolve===q.AUTOSOLVE_OFF){I.dispatcher.dispatchEvent("solveNeeded",[this]);return false}else{if(P.autosolve===q.AUTOSOLVE_ON){return true}}}if(!P){if(this.autosolve===q.AUTOSOLVE_OFF){I.dispatcher.dispatchEvent("solveNeeded",[this]);return false}else{if(this.autosolve===q.AUTOSOLVE_ON){return true}}}return true}return false},_registerAsElementParent:function(O){O.parentId=this.id||this.cid;O.parentConstructor=this.constructor},onAtIdChange:function(){this._parent.apply(this,arguments);var P=this.getCollectionAttribute(q.CHILDREN_ATTR);P.forEach(this._registerAsElementParent,this);var Q=this.getTasks();Q.forEach(this._registerAsElementParent,this);var O=this.getMilestones();O.forEach(this._registerAsElementParent,this)},updateThumbnailImage:function(O){var P=O||this.get(i);if(P){this.thumbnail=P}},setup:function(){this._beingCreatedOnServer=false;this._listenToModel();this._listenToChildrenCollections();this._registerAsParentOfAllChildrenModels();this._parent.apply(this,arguments);this.updateThumbnailImage();if(this.isNew()){this.mask="dsplan:MVMask.WorkPackage.Complex"}this._fetchCount=0;this.getCollectionAttribute(q.CONSTRAINT_RELATION_ATTR,undefined,{})},_listenToModel:function(){var O={};O["onChange:title"]=function(){this.dispatchEvent("onChange:name",arguments)};O["onChange:"+q.WORKSCOPE_PARENT_ATTR]=function(Q,P){if(this===Q){if(!P){delete this.parentId;delete this.parentConstructor}}else{console.error("invalid onChange parent to be checked")}};O.onSync=function(){this._setAndSaveSequenceOrders(this.getTasks());this._setAndSaveSequenceOrders(this.getWorkscopes())};this.listenTo(this,O)},_listenToChildrenCollections:function(){var P=[this.getWorkscopes(),this.getTasks(),this.getMilestones()];for(var O=0;O<P.length;O++){var Q=P[O];this.listenTo(Q,{onAdd:this._registerAsElementParent,onReset:this._registerAsParentOfEachElement})}this.listenTo(this.getTasks(),"onSync",function(){this._setAndSaveSequenceOrders(this.getTasks())});this.listenTo(this.getWorkscopes(),"onSync",function(){this._setAndSaveSequenceOrders(this.getWorkscopes())})},_registerAsParentOfEachElement:function(O){O.forEach(this._registerAsElementParent,this)},_registerAsParentOfAllChildrenModels:function(){this.getWorkscopes().forEach(this._registerAsElementParent,this);this.getTasks().forEach(this._registerAsElementParent,this);this.getMilestones().forEach(this._registerAsElementParent,this)},getParent:function(){if(this.parentId){return s.getObjectById(this.parentId)}return this.get(q.WORKSCOPE_PARENT_ATTR)},getObjectTypeLabel:function(O){if(O===q.PROGRAM_RDF_TYPE||O==="dsxplan:Program"||O==="dsxplan:ProgramVersion"){return q.PROGRAM}else{if(O===q.PROJECT_RDF_TYPE||O==="dsxplan:Project"||O==="dsxplan:ProjectVersion"){return q.PROJECT}else{if(O===q.WORKPACKAGE_RDF_TYPE||O==="dsxplan:WorkPackage"||O==="dsxplan:WorkPackageVersion"){return q.WORKPACKAGE}}}return q.OBJECT},getObjectType:function(){var P=this.get("dsxplan:jsType")||this.get("dsxplan:actualType")||this.get(q.ACTUAL_TYPE_ATTR)||this.get(q.TYPE_ATTR);if(P){var O=P.id||P;return this.getObjectTypeLabel(O)}return q.OBJECT},get:function(P){var Q=this._parent.apply(this,arguments);switch(P){case"image":var R=this.get(i);if(R){return R}return this._getImage(this._parent.apply(this,arguments));case"type":return this.getObjectType();case"name":return this._parent("title");case"description":var O=this.get(q.DESCRIPTION_ATTR);return O;default:return Q}},getTeamMembers:function(){var O=this.get(l);if(!O){O=new v(undefined,{workscope:this,"@mask":"dsplan:MVMask.WorkPackage.Property"});this.setCollection(l,O)}return O},dataForRendering:function(X){var O=a.clone(X||{},false);var P;if(O.attributes){P=Object.create(null);var Y=O.attributes;var T=Y.length;for(var Q=0;Q<T;Q++){var R=Y[Q];P[R]=true}O.attributes=Y}var V=!P;var S=this._parent.apply(this,arguments);var U=this;var W=function(Z){if(V||P[Z]){var aa=U.get(Z);if(aa){if(a.is(aa.dataForRendering,"function")){aa=aa.dataForRendering(X)}S[Z]=aa}}};S.autosolve=this.autosolve!==q.AUTOSOLVE_OFF;S.name=this.get(q.DSLC_TITLE_ATTR);S.image=this.get("dsplan:hasThumbnail")||this.get("image");S.physicalId=this.get("physicalId");W(this.get(q.WORKSCOPE_PARENT_ATTR));return S},getWorkscopes:function(){return this.getCollectionAttribute(q.CHILDREN_ATTR)},getConstraints:function(){this._allConstraints=this._allConstraints||new k(this);return this._allConstraints},fetchForProperty:function(){var P={};if(!M.haveCalendarsBeenFetched()){P=s.getBatchGenerator();M.fetchCalendars({ajax:P.ajax})}var O={mask:"dsplan:MVMask.WorkPackage.Property",dontUpdateMask:true,ajax:P.ajax,onlyIfNeeded:true};this.fetch(O);if(!M.haveCalendarsBeenFetched()){P.sendBatch()}},fetch:function(P){var O=a.clone(P||{},false);var Q=this;Q.fetchCount++;O.onComplete=function(){Q.fetchCount--;if(P&&a.is(P.onComplete,"function")){P.onComplete.apply(this,arguments)}};O.onFailure=function(){Q.fetchCount--;if(P&&a.is(P.onFailure,"function")){P.onFailure.apply(this,arguments)}};return this._parent(O)},getMilestoneTypes:function(){return(this._getTypes(q.MILESTONE_VOCABULARY_ATTR))},getTaskTypes:function(){return(this._getTypes(q.TASK_VOCABULARY_ATTR))},getDSLCTaskTypes:function(){return(this._getTypes("dsxplan:hasTaskVocabulary"))},getDSLCMilestoneTypes:function(){return(this._getTypes("dsxplan:hasMilestoneVocabulary"))},_getTypes:function(V){var Q=[];var O=this;var P=function(){var X=O.get(V);while(!X&&O){O=O.getParent();O&&(X=O.get(V))}return(X)};var T=P();if(T){var R=T.get("dsplan:vocabularyTerms");if(R){for(var U=0;U<R.length;U++){var S=R.at(U);var W="E6WCommonApps.Type."+S.id.substring(S.id.indexOf(":")+1);Q.push({actualValue:S.id,displayValue:N(W)})}}}return(Q)},createChildWorkscope:function(P,S){var T=this._getDefaultChildWorkscopeAttributes();a.extend(T,P);var R=this._getChildWorkscopeType(T[q.TYPE_ATTR]);var O=q.CHILDREN_ATTR;if(s.serverHasDSLC()){R=R.replace("dsplan","dsxplan");O=O.replace("dsplan","dsxplan")}T[q.TYPE_ATTR]=R;var Q=a.clone(S||{},false);Q._defaultModel=n;var U=this.addModelToAttributeWithCollection(O,T,Q);this._registerAsElementParent(U);return U},_getChildWorkscopeType:function(O){if(!O){if(this.getObjectType()==="Program"){O=q.PROJECT_RDF_TYPE}else{O=q.WORKPACKAGE_RDF_TYPE}}return O},getStartAndFinishDates:function(){var P={};var O=function(Q){if(!isNaN(Q.start)&&(!P.start||Q.start<P.start)){P.start=Q.start}if(!isNaN(Q.finish)&&(!P.finish||Q.finish>P.finish)){P.finish=Q.finish}};this.getMilestones().forEach(function(R){var Q=new Date(R.getStartDate());O({start:Q,finish:Q})});return P},isAttributeImpactingSolve:function(O){return f[O]},getAssignees:function(){return this.getCollectionAttribute(q.ASSIGNEE_ATTR,{detailsMask:"dskern:MVMask.Person.Complex"})},save:function(){var S=x.setHelper.apply(this,arguments);var R=S.attrs||{};var Q=S.options;var P=a.clone(Q||{},false);var T=this.getChangedAttributesSinceLastSave();var O=Object.keys(R).concat(T);P.onComplete=this._getCallbackThatWillFetchTeamMembersOnCompleteIfNeeded(O,Q);if(!P.forceSequenceOrder&&this._hasNewWorkscopeParentAttributeWithoutNewSequenceOrderAttribute(O)){return this._calculateNewSequenceOrderFromParentThenSave(R,Q)}else{return this._parent(R,P)}},_hasNewWorkscopeParentAttributeWithoutNewSequenceOrderAttribute:function(O){var P=O.indexOf(q.WORKSCOPE_PARENT_ATTR)!==-1;var Q=this.isDSLC()?this.dslcMapping[q.SEQUENCE_ORDER_ATTR]:q.SEQUENCE_ORDER_ATTR;var R=O.indexOf(Q)!==-1;return P&&!R},_calculateNewSequenceOrderFromParentThenSave:function(P,O){var Q=P[q.WORKSCOPE_PARENT_ATTR]||this._changedAttributesSinceLastSave[q.WORKSCOPE_PARENT_ATTR];var R=this;return Q.fetch({onlyIfNeeded:true,mask:"dsplan:MVMask.WorkPackage.Collapsed",onComplete:function(){var S=a.clone(P||{},false);var T=R.isDSLC()?R.dslcMapping[q.SEQUENCE_ORDER_ATTR]:q.SEQUENCE_ORDER_ATTR;S[T]=Q.getWorkscopes().getTotalRecords();R.save(S,O)}})},_getCallbackThatWillFetchTeamMembersOnCompleteIfNeeded:function(P,O){var R=O&&O.onComplete;if(P.some(function(S){return q.dslcMapping[q.ASSIGNEE_ATTR]===S})){var Q=this;R=function(){var S=Q.get(l);S&&S.fetch();O&&O.onComplete&&O.onComplete.apply(this,arguments)}}return R},getMilestoneById:function(P){var O;this.getMilestones().some(function(Q){if(Q.id===P){O=Q;return true}return false});return O},getMilestones:function(){return this.getCollectionAttribute(H,{mask:"dsplan:MVMask.Milestone.Complex"})},getTaskById:function(O){return this.getTasks().get(O)},getTasks:function(){return this.getCollectionAttribute(J,{mask:"dsplan:MVMask.Task.Complex",detailsMask:"dsplan:MVMask.Task.Complex"})},getTaskCollectionForFilter:function(P,R){var Q=this.getCollectionAttribute(g[P],{mask:"dsplan:MVMask.Task.Complex",detailsMask:"dsplan:MVMask.Task.Complex"});var O="dsplan:MVMask.WorkPackage.CollaborativeTasks.";O+=P;var S=a.clone(R||{},false);S.mask=O;this.fetch(S);return Q},getOwnConstraints:function(){return this.getCollectionAttribute(c,{mask:"dsplan:MVMask.Constraint.Complex"})},addConstraint:function(Q,P){var R;var O=a.clone(P||{},false);O._defaultModel=G;if(Q[G.PREDECESSOR_ATTR].id!==Q[G.SUCCESSOR_ATTR].id){R=this.addModelToAttributeWithCollection(c,Q,O)}return R},addTask:function(T,R){var V=a.clone(T||{},false);var U=this._getDefaultTaskAttributes();var S=V[q.DURATION_MIN];if(a.is(S,"number")){V[q.DURATION_MIN]=this.getDurationString(S)}var O=V[q.DURATION_MAX];if(a.is(O,"number")){V[q.DURATION_MAX]=this.getDurationString(O)}a.extend(U,V);var Q=a.clone(R||{},false);Q._defaultModel=C;var P=this._addScheduleElement(J,U,Q);P.newThisSession=true;return P},addMilestone:function(Q){var P=a.clone(Q||{},false);var O=P[q.SUGGESTED_DATE_ATTR]||new Date();var R=P[q.ESTIMATED_DATE_ATTR]||new Date(O);P["@type"]=P["@type"]||q.MILESTONE_RDF_TYPE;P[q.TITLE_ATTR]=P[q.TITLE_ATTR]||"Milestone";P[q.SUGGESTED_DATE_ATTR]=O;P[q.ESTIMATED_DATE_ATTR]=R;return this._addScheduleElement(H,P)},_addScheduleElement:function z(T,P,R){var Q=a.clone(P||{},false);var O=enoviaServer.useFD01CodeFor3DPlan?"Open":{"@id":"dsxplan:Open"};Q[q.DESCRIPTION_ATTR]=Q[q.DESCRIPTION_ATTR]||"";Q[q.STATE_ATTR]=Q[q.STATE_ATTR]||O;Q[q.CONTENT_REPOSITORY]=Q[q.CONTENT_REPOSITORY]||this.get(q.CONTENT_REPOSITORY);Q[h]=this.get(h);if(this.isDSLC()){Q["@type"]=P["@type"].replace("dsplan","dsxplan");T=this.dslcMapping[T]}var S=this.addModelToAttributeWithCollection(T,Q,R);this._registerAsElementParent(S);return S},addChildWorkscopeAndSave:function(R,P){var Q=this;var O=a.clone(P||{},false);a.extend(O,{parentId:this.id,childId:R.id,onComplete:function(U){var S=U.value;if(S){var T=u.replace(x.i18n("E6WCommonUI.Alert.ChildIsAlreadyInParentStructure"),{PARENT_NAME:Q.get("title"),CHILD_NAME:R.get("title")});x.displayError(T);P&&P.onFailure&&P.onFailure()}else{Q.addValidatedChildWorkscopeAndSave(s.getObjectById(R.id),P)}}});n.checkParentHierarchyForId(O)},addValidatedChildWorkscopeAndSave:function(T,Q){var P=a.clone(Q||{},false);var S=P.sequenceOrder||this._getDefaultSequenceOrderForAttribute(q.CHILDREN_ATTR);var R=this.isDSLC()?"dsxplan:sequenceOrder":q.SEQUENCE_ORDER_ATTR;var O={};O[R]=S;O[q.WORKSCOPE_PARENT_ATTR]=this;T.save(O,{onComplete:Q.onComplete,onFailure:Q.onFailure})},add:function(P,R,O){if(P===q.CHILDREN_ATTR){throw new Error("Use addChildWorkscopeAndSave method instead")}var Q=this.addModelToAttributeWithCollection(P,R,O);return[Q]},isVersion:function(){return true},getDurationString:function(P){var O=8;return s.millisecondsToXsDateTimeDuration(parseFloat(P)*O*60*60*1000)},_onRequest:function(){this.fetchCount++},_onCompleteRequest:function(){this.fetchCount--},_getDefaultChildWorkscopeAttributes:function(){var O={};O[q.TITLE_ATTR]="Child WS";O[q.DESCRIPTION_ATTR]="";O[q.STATE_ATTR]={"@id":"dsxplan:Open"};O[q.SEQUENCE_ORDER_ATTR]=this._getDefaultSequenceOrderForAttribute(q.CHILDREN_ATTR);return O},_getDefaultTaskAttributes:function(){var P=new Date();var O={};O["@type"]=q.TASK_RDF_TYPE;O[q.TITLE_ATTR]="Task";O[q.DURATION_MIN]=this.getDurationString(o);O[q.DURATION_MAX]=this.getDurationString(o);O[q.STARTDATE_ATTR]=P;O[q.ENDDATE_ATTR]=new Date(P.getTime()+w);O[q.COMPLETE_PERCENT_ATTR]=0;O[q.SEQUENCE_ORDER_ATTR]=this._getDefaultSequenceOrderForAttribute("dsxplan:hasTask");return O},insertChildWorkscopeAtTop:function(Q,O){var P=this.getSequenceOrderForNewFirstChild("dsxplan:hasWorkDecomposition");this._insertChildWorkscopeWithSequenceOrder(Q,P,O)},insertChildWorkscopeBefore:function(Q,O){var P=this.getSequenceOrderForObject({model:Q,collection:this.getWorkscopes(),referenceModel:O.referenceModel,placement:"before"});this._insertChildWorkscopeWithSequenceOrder(Q,P,O)},insertChildWorkscopeAfter:function(Q,O){var P=this.getSequenceOrderForObject({model:Q,collection:this.getWorkscopes(),referenceModel:O.referenceModel,placement:"after"});this._insertChildWorkscopeWithSequenceOrder(Q,P,O)},_insertChildWorkscopeWithSequenceOrder:function(R,Q,P){var O=a.clone(P,false);if(this.getWorkscopes().contains(R)){R.set(q.SEQUENCE_ORDER_ATTR,Q);R.save(undefined,{onComplete:O&&O.onComplete,onFailure:O&&O.onFailure})}else{this.addChildWorkscopeAndSave(R,{sequenceOrder:Q,onComplete:O&&O.onComplete,onFailure:O&&O.onFailure})}},getSequenceOrderForObject:function(P){var Q=P.placement||"after";var T=P.collection.indexOf(P.referenceModel);var R=P.referenceModel.get(q.SEQUENCE_ORDER_ATTR);if(T===0&&Q!=="after"){return R-1}else{if(T===P.collection.length-1&&Q==="after"){return R+1}}var O=Q==="after"?T+1:T-1;var S=P.collection.at(O).get(q.SEQUENCE_ORDER_ATTR);return((R+S)/2)},getSequenceOrderForNewFirstChild:function(O){var P=this.get(O);if(P.length===0){return Math.random()}else{return P.first().get(q.SEQUENCE_ORDER_ATTR)-1-Math.random()}},getSequenceOrderForLastChild:function(O){var P=this.get(O);if(P.length===0){return Math.random()}else{return P.last().get(q.SEQUENCE_ORDER_ATTR)+1+Math.random()}},_getDefaultSequenceOrderForAttribute:function(O){var Q=Math.random();if(this.hasFetchedAttribute(O)){var P=this.get(O).last();if(P){Q=P.get(q.SEQUENCE_ORDER_ATTR_DSLC);if(Q===undefined){Q=0}Q+=Math.random()}}return Q},_setAndSaveSequenceOrders:function(){},getCollectionAttributeBasedOnModel:function(O){if(O instanceof G){return"dsxplan:hasConstraint"}else{if(O instanceof j){return"dsxplan:hasMilestone"}else{if(O instanceof C){return"dsxplan:hasTask"}else{if(O instanceof n){return"dsxplan:hasWorkDecomposition"}}}}return undefined},onShareNotification:function(O){this._parent.apply(this,arguments);this.getTeamMembers().fetch({ajax:O.ajax,reset:true,forceFetch:true,onFailure:function(){this.destroy({noServer:true})}.bind(this)})},hasChildWorkscopes:function(){var O=this.getWorkscopes();return Boolean(O.length||O.hasMoreItems())},hasTasks:function(){var O=this.getTasks();return Boolean(O.length||O.hasMoreItems())},hasViewAccess:function d(){return E.hasRole("XPP")},ownsOrContainsTask:function(O){var Q=this.get("dsplan:ownedTasks");if(Q&&Q.indexOf(O)!==-1){return true}var P=this.get("dsplan:assignedTasks");if(P&&P.indexOf(O)!==-1){return true}return this.getTasks().indexOf(O)!==-1}},e,L);n.SEQUENCE_ORDER_ATTR="dsplan:sequenceOrder";Object.defineProperty(n.prototype,"fetchCount",{get:function(){return this._fetchCount},set:function(P){var O=this._fetchCount;this._fetchCount=P;if((O===0)!==(this._fetchCount===0)){this.dispatchEvent("onChange:FetchCount")}}});Object.defineProperty(n.prototype,"beingCreatedOnServer",{get:function(){return this._beingCreatedOnServer},set:function(P){var O=this._beingCreatedOnServer;this._beingCreatedOnServer=P;if(O!==this._beingCreatedOnServer){this.dispatchEvent("onChange:beingCreatedOnServer")}}});Object.defineProperty(n.prototype,"solveCounter",e.solveCounterDef);Object.defineProperty(n.prototype,"prevSolveCounter",e.prevSolveCounterDef);n.KPI_URI="dsmf:xplan.xPlanKPI.getKPIsForUpcomingMilestone?$mask=dsplan:MVMask.KeyPerformanceIndicator.Complex";var D=n.prototype.dslcMapping;var F=s.inverseMapping(D);n.prototype.inverseDslcMapping=F;n.CALENDAR_ATTR=h;n.implement(K);n.parentPlanTypeAhead=function(S,R,V,Q){var O=Q.model.get("type");var P=false;var T="/invoke/dsxplan:getFilteredVersions";R=n.sanitizeTermForSearch(R);O=(O==="Project")?q.PROJECT_RDF_TYPE:q.WORKPACKAGE_RDF_TYPE;O=O.replace("dsplan","dsxplan");var U=JSON.stringify([O,P,R,[],["dsplan:Leader","dsplan:Author"],10]);return s.request(s.expandUrl(T+"?$mask=dsplan:MVMask.WorkPackage.Basic"),{method:"POST",type:"json",data:U,headers:{"Content-Type":"application/json"},onComplete:function(Z){var aa=[];if(Z){var Y=Z.member;if(Y){var W=function(ab){var ac={};var ad=ab[q.THUMBNAIL_ATTR]||ab["dsxplan:hasThumbnail"];ac.value=ab["@id"];ac.label=ab["dsxplan:label"];ac.image=ad||require.toUrl("E6WCommonApps/assets/img/XPlan-Placeholder-Concept-128.png");ac.model=ab;return ac};for(var X=0;X<Y.length&&X<10;X++){if(Q.model&&Q.model.id===Y[X]["@id"]){}else{aa.push(W(Y[X]))}}}}V(aa,Q)},onFailure:function(){x.displayError(N("E6WCommonApps.Alert.NoResultFound"))},onDestroy:function(){this._allConstraints.destroy();delete this._allConstraints;this._parent.apply(this,arguments)}})};n.processDropData=function(R,O){var S=this&&this.id;var Q=x.getDataTransferJSON(R);var P=false;if(Q.data){Q.data.items.forEach(function(U){var T=b.validateDroppedObject(U,O);if(!T&&S===U.objectId){T=x.i18n("E6WCommonUI.Alert.PlanOwnChild")}if(T){x.displayError(T);P=true}})}return P};n.checkParentHierarchyForId=function(S){var P,V;var R=s.getBatchGenerator();var T="/invoke/dsxplan:checkIfChildIsAlreadyInAncestor";var U=JSON.stringify([S.parentId,S.childId]);R.ajax(s.expandUrl(T),{method:"POST",type:"json",data:U,headers:{"Content-Type":"application/json"},onComplete:function(W){P=W.value}});var Q=s.getObjectForAdding(n,S.childId,undefined);var O=Q.getParent&&Q.getParent();if(!O){Q.fetch({mask:"dsplan:MVMask.WorkPackage.Drop",ajax:R.ajax,onlyIfNeeded:true,onComplete:function(X){var W=X&&X.getParent();V=Boolean(W&&W.id===S.parentId)}})}else{V=O.id===S.parentId}R.sendBatch({onComplete:function(){S.onComplete({value:P||V})}})};n.sanitizeTermForSearch=function(O){return O.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};n.MILESTONE_RELATION_ATTR=H;n.TASK_RELATION_ATTR=J;n.TEAM_MEMBERS=l;return n});define("DS/E6WCommonApps/E6WCommonAppsTypeDictionary",["UWA/Core","DS/E6WCommonApps/Models/ConstraintModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/MilestoneModel","DS/RDFFoundation/Models/PersonRDFModel","DS/E6WCommonApps/Models/WorkscopeModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ComponentProxyModel","DS/E6WCommonApps/Models/CalendarModel"],function(d,e,f,g,a,h,b,i,c){d.merge(b.typeDictionary,{mapping:[{key:"dsxplan:WorkPackageVersion",type:h},{key:"dsplan:WorkPackage",type:h},{key:"dsxplan:WorkPackage",type:h},{key:"dsplan:Task",type:f},{key:"dsxplan:Task",type:f},{key:"dsxplan:TaskVersion",type:f},{key:"dsplan:Milestone",type:g},{key:"dsxplan:Milestone",type:g},{key:"dsxplan:MilestoneVersion",type:g},{key:"dsplan:TemporalConstraint",type:e},{key:"dsxplan:TemporalConstraint",type:e},{key:"foaf:Person",type:a},{key:"dscom:ComponentProxy",type:i},{key:"Person",type:a},{key:"dsplan:Calendar",type:c}],masksStrength:{"dsplan:MVMask.Task.CollaborativeTask.siblings":2,"dsplan:MVMask.WorkPackage.Basic":15,"dsplan:MVMask.WorkPackage.Collapsed":27,"dsplan:MVMask.WorkPackage.Expanded":32,"dsplan:MVMask.WorkPackage.Complex":111,"dsplan:MVMask.Task.Property":235,"dsplan:MVMask.Task.Basic":42,"dsplan:MVMask.Task.Complex":53,"dsplan:MVMask.Task.CollaborativeTasks.Complex":57}});return b.typeDictionary});define("DS/E6WCommonApps/Models/TaskValidator",["UWA/Core","UWA/Class","DS/E6WCommonApps/Models/E6WCommonAppsConstants"],function(d,a,c){var b=a.extend({_uwaClassName:"TaskValidator",_attributesGet:function(e,f){var g;if(e){g=e[f]}return g||this.get(f)},_validateDuration:function(e,g){var h=true;var i=this._attributesGet(e,c.DURATION);var j=this._attributesGet(e,c.DURATION_RANGE);var k=(i===undefined||j===undefined);var f=(i<0||j<0);if(f||k||i-j<0||isNaN(i)||isNaN(j)){g.fields.push(c.DURATION);g.fields.push(c.DURATION_RANGE);g.fields.push(c.DURATION_MIN);g.fields.push(c.DURATION_MAX);h=false}return h},_validateActualDates:function(f,h){var i=true;var j=this._attributesGet(f,c.STATE_ATTR);var g=this.get(c.ACTUAL_START_DATE);var e=new Date();if(g&&g.actualValue>e&&(j!==c.STATE_OPEN)){h.fields.push(c.ACTUAL_START_DATE);i=false}g=this.get(c.ACTUAL_END_DATE);if(g&&g.actualValue>e&&(j===c.STATE_DONE)){h.fields.push(c.ACTUAL_END_DATE);i=false}return i},_validateEstimatedDates:function(f,g){var h=true;var i,e;e=this.getStartDate(f);e=(e&&e.actualValue)||e;if(this.isStartDateFixed(f)&&!(e&&!isNaN(e.getTime()))){g.fields.push(this.isStarted(f)?c.ACTUAL_START_DATE:c.STARTDATE_ATTR);h=false}i=this.getEndDate(f);i=(i&&i.actualValue)||i;if(this.isEndDateFixed(f)&&!(i&&!isNaN(i.getTime()))){g.fields.push(this.isComplete(f)?c.ACTUAL_END_DATE:c.ENDDATE_ATTR);h=false}if(e>i&&!this.isStartOrEndDateAutomatic(f)){g.fields.push(this.isStarted(f)?c.ACTUAL_START_DATE:c.STARTDATE_ATTR);g.fields.push(this.isComplete(f)?c.ACTUAL_END_DATE:c.ENDDATE_ATTR);h=false}return h},validate:function(e){var g={fields:[]};var h=true;h=this._validateDuration(e,g);var f=this._validateActualDates(e,g);h=h&&f;f=this._validateEstimatedDates(e,g);h=h&&f;var i=this._attributesGet(e,c.TITLE_ATTR);if(i===undefined||i===null){i=this._attributesGet(e,c.DSLC_TITLE_ATTR)}if(!(i&&i.trim().length)){g.fields.push(c.TITLE_ATTR);h=false}if(!h){return g}return undefined},getStartDate:function(e){var f;if(this.isStarted(e)){f=this._attributesGet(e,c.ACTUAL_START_DATE)||this._attributesGet(e,c.STARTDATE_ATTR)}else{f=this._attributesGet(e,c.STARTDATE_ATTR)}f=f&&d.is(f,"string")?new Date(f):f;return f},getEndDate:function(e){var f;if(this.isComplete(e)){f=this._attributesGet(e,c.ACTUAL_END_DATE)||this._attributesGet(e,c.ENDDATE_ATTR)}else{f=this._attributesGet(e,c.ENDDATE_ATTR)}f=f&&d.is(f,"string")?new Date(f):f;return f},isComplete:function(e){return(this._attributesGet(e,c.STATE_ATTR)===c.STATE_DONE)},isStarted:function(e){return(this.isComplete(e)||this._attributesGet(e,c.STATE_ATTR)===c.STATE_IN_PROGRESS)},isFixed:function(f){var e=this._attributesGet(f,c.USER_DEFINED_DATES_ATTR)||this.isStartDateFixed(f)||this.isEndDateFixed(f);return(e)},isStartDateFixed:function(e){return this._attributesGet(e,c.USER_DEFINED_START_DATE_ATTR)},isEndDateFixed:function(e){return this._attributesGet(e,c.USER_DEFINED_END_DATE_ATTR)},isStartDateAutomatic:function(e){return !this.isStartDateFixed(e)&&!this.isStarted(e)},isEndDateAutomatic:function(e){return !this.isEndDateFixed(e)&&!this.isComplete(e)},isStartOrEndDateAutomatic:function(e){return this.isStartDateAutomatic(e)||this.isEndDateAutomatic(e)}});return b});define("DS/E6WCommonApps/Models/AssigneeTypeAhead",["UWA/Core","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/Foundation2/Models/ReferenceModel","UWA/Class/Listener","DS/E6WCommonApps/Models/WorkscopeModel","DS/RDFFoundation/RDFUtils"],function(b,d,c,i,g,a){function f(j){if(j instanceof g){return j}else{return j.getParent()}}function e(l,m,o){var n=l instanceof g;var j=o.get("memberPersonModel");var k=m.indexOf(j)===-1&&j.physicalId;if(n){k=k&&o.get("responsibility")===d.RESPONSIBILITY_LEADER}return k}var h={callback:function(o,n,p,m){var l=b.clone(m||{},false);var k=l.model;var j=f(k.model);return h._callback(j,k,o,n,p)},_callback:function(k,o,n,m,p){var j=function(q){return q.fetching};var l=k.getTeamMembers();if(!l.initialized){l.fetch({onlyIfNeeded:true,onComplete:function(q){if(!q.some(j)){h._buildTypeAhead(k,o,n,m,p)}else{var r=new i();r.listenTo(q,"onFetchDone",function(){if(!q.some(j)){h._buildTypeAhead(k,o,n,m,p);r.stopListening()}})}}})}if(l.fetching){return{cancel:function(){}}}else{return h._buildTypeAhead(k,o,n,m,p)}},_buildTypeAhead:function(l,n,m,o,u){var s={cancel:function(){}};var k=function(v){var w=[];v.forEach(function(x){if(x.get("responsibility")!==d.RESPONSIBILITY_VIEWER){w.push(x)}});return w};var p=l.getTeamMembers();p=k(p);if(o.length<2){var q=n.get("dsxplan:hasAssignee");var t=[];q=q||[];p.forEach(function(w){var v=w.get("memberPersonModel");if(e(n.model,q,w)){t.push({value:v.physicalId,label:v.fullName,image:v.get("image"),login:v.get("ds6w:identifier"),sourceid:a.sourceFromService(v.serviceHosting)})}});u(t)}else{var j={};p.forEach(function(v){j[v.physicalId]=true});var r=function(z,x){var w=[];var v=[];z.forEach(function(A){if(j[A.value]){w.push(A)}else{v.push(A)}});var y=w.concat(v);u(y,x)};s=a.typeAheadCallback.call(this,m,o,r)}return s}};return h});define("DS/E6WCommonApps/Models/ScheduleElementCloneModel",["DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/CloneModelForRepository","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(a,b,g,f,c){var e=c.get.bind(c);var d=g.extend({i18n:e,buildBatchWithPreprocessedObjects:function(){var h=this._parent.apply(this,arguments);if(this.localRelatedData.toConstraints||this.localRelatedData.fromConstraints){h=h||a.getBatchGenerator();this._processAddedConstraints(h);this._processRemovedConstraints(h)}delete this.localRelatedData.toConstraints;delete this.localRelatedData.fromConstraints;return h},_processAddedConstraints:function(k){var i=this;var h=function(l){return l.operation==="add"};var j=function(m,l){m.updateBackpointers({silent:true});m.updateParentWorkscopes();m.save(undefined,{ajax:k.ajax,onFailure:function(){i._onConstraintFailure(l,"E6WCommonApps.Error.ConstraintNotCreated",m);m.destroy({noServer:true})}})};if(this.localRelatedData.toConstraints){this.localRelatedData.toConstraints.filter(h).forEach(function(l){j(l.value,"toConstraints")})}if(this.localRelatedData.fromConstraints){this.localRelatedData.fromConstraints.filter(h).forEach(function(l){j(l.value,"fromConstraints")})}},_processRemovedConstraints:function(i){var h=this;if(this.localRelatedData.toConstraints){this.localRelatedData.toConstraints.forEach(function(j){if(j.operation==="remove"){h.model.removeObject("toConstraints",j.value,{silentOnChange:true,ajax:i.ajax,onFailure:h._onConstraintFailure.bind(h,"toConstraints","E6WCommonApps.Error.ConstraintNotRemoved")})}})}if(this.localRelatedData.fromConstraints){this.localRelatedData.fromConstraints.forEach(function(j){if(j.operation==="remove"){h.model.removeObject("fromConstraints",j.value,{silentOnChange:true,ajax:i.ajax,onFailure:h._onConstraintFailure.bind(h,"fromConstraints","E6WCommonApps.Error.ConstraintNotRemoved")})}})}},_onConstraintFailure:function(i,l,m){var j;if(i==="toConstraints"){j=m.getPredecessor()}else{j=m.getSuccessor()}var h=j.get("dsxplan:label");var k=c.replace(c.get(l),{OBJECT_NAME:h});b.displayError(k);this._fireRelationshipChangeEvents(i,{})},dataForRendering:function(){var i=this._parent.apply(this,arguments);var h=this.get(f.PARENT_ATTR);i[f.PARENT_ATTR]=[{title:h&&h.get(f.DSLC_TITLE_ATTR),image:h&&h.get("image"),physicalId:h&&h.get("physicalId")}];return i}});return d});define("DS/E6WCommonApps/Models/RDFTaskCloneModel",["UWA/Core","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/ScheduleElementCloneModel","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/TaskValidator"],function(e,f,g,d,c,b,a){function h(j){return j===f.ENDDATE_ATTR||j===f.STARTDATE_ATTR||j===f.ACTUAL_START_DATE||j===f.ACTUAL_END_DATE}var i=d.extend(a,{_uwaClassName:"RDFTaskCloneModel",getWorkDayLength:function(){return this.model.getWorkDayLength()},_updateRanges:function(o,j,n){var l=this.get(f.DURATION);var k=this.get(f.DURATION_RANGE);var p=(n&&n.settingDuration);var m=(n&&n.settingRange);!p&&(l!==o)&&this.dispatchEvent("onChange:"+f.DURATION,[this,l]);!m&&(k!==j)&&this.dispatchEvent("onChange:"+f.DURATION_RANGE,[this,k]);this.validationError=this.validate(this.toJSON());if(this.validationError){this.dispatchEvent("onValidationFailure")}else{this.dispatchEvent("onValidationSuccess")}},init:function(){this._parent.apply(this,arguments);var j={};j["onChange:"+f.DURATION_MAX]=j["onChange:"+f.DURATION_MIN]=function(l,m,k){this._updateRanges(undefined,undefined,k)};this.listenTo(this,j)},toJSON:function(){var j=this._parent.apply(this,arguments);j[f.DURATION]=this.get(f.DURATION);j[f.DURATION_RANGE]=this.get(f.DURATION_RANGE);j[f.DURATION_ESTIMATED]=this.get(f.DURATION_ESTIMATED);return j},dataForRendering:function(){var j=this._parent.apply(this,arguments);j[f.DURATION]=this.get(f.DURATION);j[f.DURATION_RANGE]=this.get(f.DURATION_RANGE);j[f.DURATION_ESTIMATED]=this.get(f.DURATION_ESTIMATED);j[f.ESTIMATED_DATE_ATTR]=this.get(f.ESTIMATED_DATE_ATTR);j[f.STARTDATE_ATTR]=this.get(f.STARTDATE_ATTR);j[f.ENDDATE_ATTR]=this.get(f.ENDDATE_ATTR);j[f.ACTUAL_START_DATE]=this.get(f.ACTUAL_START_DATE);j[f.ACTUAL_END_DATE]=this.get(f.ACTUAL_END_DATE);j[f.LASTUPDATED_ATTR]=this.get(f.LASTUPDATED_ATTR);return j},get:function(k){switch(k){case f.DURATION:return this.getDuration();case f.DURATION_RANGE:return this.getDurationOffset();default:break}var j=this._parent.apply(this,arguments);if(j){switch(k){case f.ESTIMATED_DATE_ATTR:case f.ENDDATE_ATTR:case f.STARTDATE_ATTR:case f.ACTUAL_START_DATE:case f.ACTUAL_END_DATE:case f.LASTUPDATED_ATTR:j=g.getIntlDateFormat(j);break;case f.DURATION_ESTIMATED:case f.DURATION_MIN:case f.DURATION_MAX:j=(b.xsDateTimeDurationToMilliseconds(j)/(this.getWorkDayLength()*60*60*1000));break;case f.STATE_ATTR:if(e.is(j,"object")&&!enoviaServer.useFD01CodeFor3DPlan){return j.id}return j;default:break}}return j},getDurationOffset:function(){var j=d.prototype.get.call(this,f.DURATION_RANGE);if(typeof j==="undefined"){var l=this.get(f.DURATION_MIN);var k=this.get(f.DURATION_MAX);if(l===undefined||k===undefined){j=0}j=(k-l)/2}return j},getDuration:function(){var j=d.prototype.get.call(this,f.DURATION);if(typeof j==="undefined"){var l=this.get(f.DURATION_MIN);var k=this.get(f.DURATION_MAX);if(l===undefined){j=k}else{if(k===undefined){j=l}else{j=(l+k)/2}}}return j},_setDuration:function(v,u,x){var o,m,p;o=false;var t=u;var j=e.clone(x||{},false);var q=j&&j.whisper;if(q){delete j.silent}var r=j&&j.silent;var w;if((v===f.DURATION_MIN||v===f.DURATION_MAX)){var n=this.get(f.DURATION);var s=this.get(f.DURATION_RANGE);t=this.getDurationString(u);this.resetDurationAndDurationTolerance();o=j.parent.call(this,v,t,j);var k=j.settingDuration;var l=j.settingRange;!(l||k)&&this._updateRanges(n,s,j);o={handled:true,returnValue:o}}else{if(v===f.DURATION){e.is(u,"string")&&(t=parseFloat(u,10));p=this.get(f.DURATION_RANGE);m=t;j.settingDuration=true;w=j.validate;j.validate=false;o=this._setComputedMinAndMaxVal(m,p,j);j.validate=w;j.parent.call(this,v,t,j);r||q||this.dispatchEvent("onChange:"+f.DURATION,[this,t,j]);o={handled:true,returnValue:o}}else{if(v===f.DURATION_RANGE){e.is(u,"string")&&(t=parseFloat(u,10));m=this.get(f.DURATION);p=t;j.settingRange=true;w=j.validate;j.validate=false;o=this._setComputedMinAndMaxVal(m,p,j);j.validate=w;j.parent.call(this,v,t,j);r||q||this.dispatchEvent("onChange:"+f.DURATION_RANGE,[this,t,j]);o={handled:true,returnValue:o}}}}return o},set:function(p,o,l){var n=o;var k=e.clone(l||{},false);k.parent=this._parent;var j=this._setDuration(p,o,k);delete k.parent;if(j.handled){return j.returnValue}if(h(p)){if(n&&n.actualValue){n=new Date(n.actualValue)}}if(p===f.STATE_ATTR&&!enoviaServer.useFD01CodeFor3DPlan){if(n.actualValue){n=b.getObjectForAdding(c,n.actualValue)}}if(p===f.STATE_ATTR&&(o&&o.actualValue&&o.actualValue===f.STATE_IN_PROGRESS)&&this.get(f.ACTUAL_START_DATE)===undefined){this.set(f.ACTUAL_START_DATE,new Date(),k)}var m=this._parent(p,n,l);if(p===f.USER_DEFINED_START_DATE_ATTR||p===f.USER_DEFINED_END_DATE_ATTR){this.dispatchEvent("onChange:"+p,[this,n,k])}return m},_setComputedMinAndMaxVal:function(q,s,y){var p=y&&y.silent;var l=e.clone(y||{},false);var v=q-s;var x=q+s;var j=this.modificationsPending;this.modificationsPending=true;if(!p&&j!==this.modificationsPending){this.dispatchEvent("onChange:modificationsPending",[this])}var w=l.validate;l.validate=false;var u=this.set(f.DURATION_MIN,v,l);var t=this.set(f.DURATION_MAX,x,l);l.validate=w;var m=new Date(this.getStartDate()&&(this.getStartDate().actualValue||this.getStartDate()));var n;var k;if(this.isEndDateFixed()){if(!this.isStarted()&&!this.isStartDateFixed()){var o=this.get(f.ENDDATE_ATTR);o=o&&(o.actualValue||o);m=new Date(o);m.setDate(m.getDate()-(x+v)/2);n=m;k=f.STARTDATE_ATTR}}else{var r=new Date(m);r.setDate(m.getDate()+(x+v)/2);n=r;k=f.ENDDATE_ATTR}this.set(k,n,l);if(l.whisper){delete l.detailsDisplayViewDebounce;this.dispatchEvent("onChange:"+k,[this,n,l])}this.set(f.DURATION_ESTIMATED,this.getDurationString(q),l);return u&&t},resetDurationAndDurationTolerance:function(){delete this.localAttributes[f.DURATION];delete this.localAttributes[f.DURATION_RANGE]},save:function(k){this.resetDurationAndDurationTolerance();var l=Array.prototype.slice.call(arguments,0);var j=e.clone(k||{},false);l[0]=j;j.animate=true;return this._parent.apply(this,l)},getDurationString:function(k){var j=this.model.getWorkDayLength();return b.millisecondsToXsDateTimeDuration(k*(j*60*60*1000))}});return i});define("DS/E6WCommonApps/FileUploadRepositoryUtil",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/DocumentManagement/DriveDocumentManagement","DS/RDFFoundation/SecurityContextUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/CollabspaceRepositoryModel","DS/RDFFoundation/Models/DriveRepositoryProxyModel","DS/E6WCommonUI/Views/ObjectCardView","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(f,c,m,a,j,e,b,i,d,h,k){var l=k.get.bind(k);var g={fileUploadRepositoryTypeAheadCallback:function(p,q,s,o){var r=[];var n=f.clone(o||{},false);if(q.length>1&&p.searchSource.length>0){r=g.getFiltered3DSpaceFileUploadRepository(q,n);c.typeAheadCallback(p,q,function(v,t){if(v&&v.length>0){for(var u=0;u<v.length;u++){var w=b.ID_PREFIX+v[u].value;v[u].value=w;c.getObjectForAdding(b,w);r.push(v[u])}}s(r,t)},o)}else{s(g.getFiltered3DSpaceFileUploadRepository(q,n))}},getFiltered3DSpaceFileUploadRepository:function(q,v){var u=new RegExp(q,"i");var r=[];var t=a.getContentRepositoryValuesForDetailDisplay(v.model.model,v);var p=t();for(var s=0;s<p.length;s++){var o=p[s].actualValue;var n=c.getObjectForAdding(e,o);if(n.get("title").match(u)){r.push({id:n.id,label:n.get("title"),image:n.get("image"),model:n})}}return r},repositoryDropHandler:function(s,p,o){if(o.objectView.validateDroppedObjects(s)){return false}var q=j.getDataTransferJSON(s);if(q&&q.data.items){var r=q.data.items[0];if(r.serviceId==="3DDrive"){var n=b.ID_PREFIX+r.objectId;q.data.items[0].objectId=n;c.getObjectForAdding(b,n);o.objectView.processDropData(q);return true}}return false},getRepositoryFieldConfig:function(){return{readWrite:"true",name:h.CONTENT_REPOSITORY,label:l("E6WCommonApps.Label.CollaborativeSpace"),attributeToDisplay:"title",imageAttribute:"image",searchTitle:l("E6WCommonApps.Label.SearchForUploadRepository"),type:"object",customView:i,minLengthBeforeAutocomplete:0,singleObjectOnly:true,typeAheadCallback:g.fileUploadRepositoryTypeAheadCallback,dropHandler:g.repositoryDropHandler,placeHolder:l("E6WCommonApps.Label.ObjectPlaceHolder"),validateSameTenant:true,searchSource:d.filterSearchSources(["drive"]),excludeSearchTypes:{drive:["DriveFile"]}}}};return g});define("DS/E6WCommonApps/Views/FixedStartStopView",["UWA/Core","DS/Controls/Toggle","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonUI/Views/StartStopView","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","text!DS/E6WCommonApps/assets/templates/fixedstartstop.html.handlebars"],function(h,g,f,e,d,b){var a=Handlebars.compile(b);var c=e.extend({setup:function(){this._parent.apply(this,arguments);if(this.model){this.listenTo(this.model,"onValidationSuccess",function(){var k=this.container.getElements(".has-error");for(var j=0;j<k.length;j++){k[j].toggleClassName("has-error",false)}});this.listenTo(this.model,"onChange:"+this._config.isEndDateManualAttribute,this.render);this.listenTo(this.model,"onChange:"+this._config.isStartDateManualAttribute,this.render)}},domEvents:{'change input.data-entry[type="checkbox"]':"_toggleDataEntry"},setFixed:function(l,k){var j=h.clone(this._config,false);var i=k?f.USER_DEFINED_START_DATE_ATTR:f.USER_DEFINED_END_DATE_ATTR;j.name=i;this.normalizedSet(this.model,j,l)},render:function(){this._parent.apply(this,arguments);var j;var i=this.normalizedGet(this.model,"canEdit");j=this.container.getElement(".start");j.addContent(a({id:"start"+new Date().getTime(),label:d.get("E6WCommonApps.Label.Fixed"),checked:this.model.isStartDateFixed()===true,disabled:!i||this.model.isStarted()}));j=this.container.getElement(".stop");j.addContent(a({id:"stop"+new Date().getTime(),label:d.get("E6WCommonApps.Label.Fixed"),checked:this.model.isEndDateFixed()===true,disabled:!i||this.model.isComplete()}));j=this.container.getElement(".input-group.start");j.grab(this.container.getElement(".start label"),"top");j=this.container.getElement(".input-group.stop");j.grab(this.container.getElement(".stop label"),"top");return this},_toggleDataEntry:function(j){var i=h.Event.getElement(j);this.setFixed(i.checked,i.id.startsWith("start"))}});return c});var ckeditor="DS/CKEditor/CKEditor";define("DS/E6WCommonApps/Views/RichTextEditorView",["DS/E6WCommonUI/Views/TextAreaView",ckeditor,"DS/E6WCommonApps/Views/RichTextEditorConfig","UWA/Core","DS/E6WCommonUI/UIHelper","UWA/Utils","DS/Handlebars/Handlebars","text!DS/E6WCommonApps/assets/templates/richtexteditor.html.handlebars"],function(c,e,i,d,h,g,b,j){var f=10;var a=c.extend({_uwaClassName:"RichTextEditorView",className:"RTEditor-container details-display-shared-view ddv-field form-group",domEvents:{"mouseup .ck-editor":"displayContextualToolbarWRTTextSelection","keyup .ck-editor":"_onKeyup"},compiledTemplate:b.compile(j),render:function(){this._parent.apply(this,arguments);this.setConfiguredTemplate();this.destroyCKEditor();if(this.normalizedGet(this.model,"canEdit")&&this.options.config.readWrite){e.disableAutoInline=true;this.ckInstance=e.inline(this.container.getElement(".content"),i);this.ckInstance.setActiveFilter(false);this._registerEvents();this.ckInstance.setData(this.normalizedGet(this.model,this._config.name));this._postTreatmentTextArea(this._config)}return this},_registerEvents:function(){var k=this;this.ckInstance.on("change",function(n){k.onCKEInputDataEvent(n);if(g.Client.Features.touchEvents){var m=k.getToolbarElement();if(m){var l=getSelection();var o=l.toString();if(o.length>0&&l.rangeCount>0){l.removeAllRanges();m.removeClassName("shown");m.addClassName("hidden")}}}});this.ckInstance.on("blur",function(l){if(e.env.iOS||e.env.mobile){k.onCKEInputDataEvent(l)}else{k.displayContextualToolbarWRTTextSelection()}});this.ckInstance.on("focus",function(){var l=k.getToolbarElement();l.removeClassName("shown");l.addClassName("hidden")})},getToolbarElement:function(){return this.ckInstance&&d.extendElement(document.body.getElement("."+this.ckInstance.id))},_onKeyup:function(m){var n=m.ctrlKey||m.metaKey,l=16,k=17;if((m.keyCode===l)||(m.keyCode===k)||(m.shiftKey)||(n)){this.displayContextualToolbarWRTTextSelection()}},displayContextualToolbarWRTTextSelection:function(){var l,k;var n=this.getToolbarElement();if(n){var m=getSelection();var o=m.toString();if(o.length>0&&m.rangeCount>0){this.positionToolbar(m);l="hidden";k="shown"}else{l="shown";k="hidden"}n.removeClassName(l);n.addClassName(k)}},positionToolbar:function(l){var k,n,o;k=l.getRangeAt(0);n=k.getBoundingClientRect();o=n.top;var m=this.getToolbarElement();m.setStyle("top",o-50+"px","important")},onCKEInputDataEvent:function(k){if(this.container!==null){this.normalizedSet(this.model,this._config,k.editor.getData());this._postTreatmentTextArea(this._config)}},_postTreatmentTextArea:function(){var k=this._parent;var l=this.ckInstance;if(l){switch(l.status){case"destroyed":break;case"ready":this.container&&k.apply(this,arguments);break;default:var m=this;var n=Array.prototype.slice.call(arguments,0);l.once("instanceReady",function(){m.container&&k.apply(m,n)})}}},destroy:function(){this.destroyCKEditor();this._parent.apply(this,arguments)},destroyCKEditor:function(){var k=this.ckInstance;if(k){switch(k.status){case"destroyed":break;case"ready":k.destroy();delete k.mode;break;default:k.once("instanceReady",function(){k.destroy()})}}delete this.ckInstance},getTextValue:function(){var k=this.ckInstance&&this.ckInstance.getData();k=k&&k.replace(/^(?=\n)$|^\s*|\s*$|\n\n+/gm,"");return k},getViewAllHeight:function(){return this._parent()+f},getDesiredHeight:function(){return this._parent()+f},getFocusDesiredHeight:function(){return this._parent()+f}});e.on("dialogDefinition",function(l){var m=l.data.name;var n=l.data.definition;if(m==="link"){var k=n.getContents("info");k.get("linkType").items.splice(1,1)}});return a});define("DS/E6WCommonApps/Models/ConstraintCloneModel",["UWA/Core","DS/E6WCommonUI/Models/CloneModel","DS/E6WCommonApps/Models/ConstraintModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/E6WCommonAppsConstants"],function(f,d,c,b,e){var a=d.extend({init:function(){this._parent.apply(this,arguments)},dataForRendering:function(){var i=this._parent();i[c.TYPE_ATTR]=this.get(c.TYPE_ATTR);var h=this.get(c.PREDECESSOR_ATTR);i[c.PREDECESSOR_ATTR]={title:h.get(e.TITLE_ATTR)};var g=this.get(c.SUCCESSOR_ATTR);i[c.SUCCESSOR_ATTR]={title:g.get(e.TITLE_ATTR)};i[c.LAG_ATTR]=this.get(c.LAG_ATTR);return i},get:function(h){var g=this._parent.apply(this,arguments);if(h===c.PREDECESSOR_ATTR||h===c.SUCCESSOR_ATTR){return g}else{if(h===c.LAG_ATTR){if(g!==undefined){g=b.xsDateTimeDurationToMilliseconds(g)/(this.getWorkDayLength()*60*60*1000)}else{g=0}}}return(g)},set:function(j,i){var h=i;if(j===c.LAG_ATTR){h=this.getDurationString(i)}else{if(j===c.TYPE_ATTR){h=i.actualValue?i.actualValue:h;if(h!=="Before"){this.set(c.LAG_ATTR,0)}}}var g=this._parent(j,h,{whisper:true});if(j===c.TYPE_ATTR){this.dispatchEvent("onChange:"+j)}return g},getWorkDayLength:function(){return this.model.getWorkDayLength()},getDurationString:function(h){var g=this.model.getWorkDayLength();return b.millisecondsToXsDateTimeDuration(h*(g*60*60*1000))}});c.prototype.getClone=function(i,h){var g=new a(i,h);return(g)};return a});define("DS/E6WCommonApps/Views/ConstraintFieldView",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Collections/ResultCollection","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonUI/Views/DetailsDisplayView","DS/E6WCommonApps/Models/ConstraintModel","DS/E6WCommonApps/Models/ConstraintCloneModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/UIKIT/DropdownMenu","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/ScheduleElementModel"],function(g,d,k,i,n,h,q,o,a,p,j,f){var m=10;var b=[{name:h.TYPE_ATTR,label:p.get("E6WCommonApps.Label.Type"),type:"select",values:[{actualValue:h.TYPE_START_TO_START,displayValue:p.get("E6WCommonApps.Label.StartToStart")},{actualValue:h.TYPE_FINISH_TO_START,displayValue:p.get("E6WCommonApps.Label.FinishToStart")},{actualValue:h.TYPE_FINISH_TO_FINISH,displayValue:p.get("E6WCommonApps.Label.FinishToFinish")}]},{name:h.LAG_ATTR,label:p.get("E6WCommonApps.Label.LeadLag"),type:"uom",uomValues:[p.get("E6WCommonApps.Label.Days"),p.get("E6WCommonApps.Label.Hours")],minimumValue:"0",conversionTable:[1,24]}];var l=i.extend({_uwaClassName:"ConstraintFieldView",setup:function(){this._parent.apply(this,arguments);this._config.dropHandler=this.onDrop.bind(this)},getDataOptions:function(){var r=this._parent.apply(this,arguments);r.level=2;r.attributes.push(h.PREDECESSOR_ATTR,h.SUCCESSOR_ATTR);return r},createMenuButtons:function(r){if(this.dropdownMenu){this.dropdownMenu.destroy();delete this.dropdownMenu}this.dropdownMenu=new a({target:r.target,items:this.getDropDownMenuItems(r.model.get("type"),r)})},getDropDownMenuItems:function(s,r){var t=this;return[g.merge(this.getPropertiesButton(r),{disabled:true}),{text:p.get("E6WCommonApps.Label.ToggleConstraintProperties"),fonticon:"doc-text",handler:function(){t._onConstraintDropdownSelected(r.event.target.getParent("li"))},disabled:!r.model.id},this.getRemoveItemButton(r)]},_onConstraintDropdownSelected:function(s){var r=d.getObjectById(s.getAttribute("data-id"));if(this._selectedConstraint===r){this._hideDetailsDisplay();delete this._selectedConstraint}else{this._setupDetailsDisplay(r);this._detailsDisplayContainer.inject(s,"after");this._selectedConstraint=r}},_hideDetailsDisplay:function(){if(this._detailsDisplayContainer){this._detailsDisplayContainer.remove()}},_setupDetailsDisplay:function(r){if(!this._detailsDisplayView){this._detailsDisplayView=new n();this.addChildView(this._detailsDisplayView);this._detailsDisplayView.setConfig(b);this._detailsDisplayContainer=g.createElement("li",{"class":"nested-properties",styles:{height:"152px","background-color":"rgb(240, 240, 240)",border:"1px solid rgb(161, 161, 161)"}});this._detailsDisplayView.inject(this._detailsDisplayContainer)}this._detailsDisplayView.resetModel(new q(r));this._detailsDisplayView.render()},getExistingObjs:function(){var r=[];this.normalizedGet(this.model,"toConstraints").forEach(function(s){r.push({id:s.getPredecessor().id})});this.normalizedGet(this.model,"fromConstraints").forEach(function(s){if(s.getSuccessor()){r.push({id:s.getSuccessor().id})}});return r},getModelFromFullTextSearch:function(u){var t=d.getObjectById(u.id);var v=this;if(!t){var s=u["ds6w:type_value"]||u["ds6w:type"];var r=d.getModelConstructor({"@type":s});t=new r(d.createPlaceholder(u.id,"",s,{forceDslc:true}));t.addEventOnce("onSync",function(){v.model.dispatchEvent("onChange:"+v._config.name)});t.fetch({mask:"dsplan:MVMask.Task.Basic"})}return t},_modelCanBeUsedAsDependency:function(t){var r;if(!(t instanceof f)){r=p.get("E6WCommonUI.Alert.CanOnlyConstrainTasksAndMilestones")}else{if(t.id===this.model.model.id){r=p.replace(p.get("E6WCommonUI.Alert.CantBeConstrainedToItself"),{OBJECT_NAME:t.get("title")})}else{var s=this.normalizedGet(this.model,"toConstraints").some(function(u){return u.getPredecessor()&&u.getPredecessor().id===t.id});s=s||this.normalizedGet(this.model,"fromConstraints").some(function(u){return u.getSuccessor()&&u.getSuccessor().id===t.id});if(s){r=p.replace(p.get("E6WCommonUI.Alert.AlreadyHasConstraint"),{OBJECT_THIS:this.model.get("title"),OBJECT_THAT:t.get("title")})}}}if(r){j.displayWarning(r)}return r===undefined},addToModelFromSearch:function(v,t,r){var s=this;var u=[];r.detailedObjects.forEach(function(y){if(!y.model&&y["ds6w:type"]){y.model=s.getModelFromFullTextSearch(y)}if(!s._modelCanBeUsedAsDependency(y.model)){return}var x=y.model;var w={};w[h.TYPE_ATTR]=h.TYPE_FINISH_TO_START;w[h.PREDECESSOR_ATTR]=v==="fromConstraints"?s.model.model:x;w[h.SUCCESSOR_ATTR]=v==="fromConstraints"?x:s.model.model;u.push(new h(w,{mask:"dsplan:MVMask.TempConstraint.Complex",dontUpdateConstrainedScheduleElements:true}))});if(u.length>0){this.model.add(this._config.name,u,r)}},getModelFromCard:function(){var r=this._parent.apply(this,arguments);if(this._config.name==="fromConstraints"){return r.getSuccessor()}else{return r.getPredecessor()}},onDrop:function(v){if(this.validateDroppedObjects(v)){return true}var t=j.getDataTransferJSON(v);if(t){var w=[];for(var s=0;s<t.data.items.length;s++){var u=t.data.items[s];var r=u.objectType;w.push({id:u.objectId,"ds6w:type":r})}this.addToModelFromSearch(this._config.name,[],{detailedObjects:w})}return true},getActiveModel:function(t){var r=this._parent.apply(this,arguments);if(!r){var s=this.normalizedGet(this.model,this._config.name);s.some(function(u){if(u.cid===t){r=u}return u.cid===t})}return r}});var c=function(s,x,z,y){var v=new RegExp(s,"i");var w=this.model.model;var u=function(){var C=[];if(s.length<2&&x){C=x()}else{var B=[];if(z){B=z()}else{var A=w.getParent();if(A){B=A.getTasks()}}B.forEach(function(D){if(D.get("title")&&D.get("title").match(v)){C.push(D)}})}y(C)};if(z&&s.length>=2){u();return}var t=w.getParent();if(t&&t.hasViewAccess()){var r=t.getTasks();if(r.length){u();return}}w.fetch({mask:"dsplan:MVMask.Task.CollaborativeTask.siblings",onComplete:u,onFailure:u})};var e=function(s){var r={};r.value=s.id;r.label=s.get("dsxplan:label");r.model=s;r.image=s.getIconURL();return r};l.typeAheadCallback=function(w,t,s,y){var x=w.modelId;var v=w.getVisibleModels;var u=w.getModelsToFilter;function r(E){var z=d.getBatchGenerator();var C=[];var A=[];function B(F){var H=F.isComplete&&F.isComplete();var G=x!==F.id;return G&&F.isRDF&&F.canModify()&&!H}function D(H){for(var G=0;G<H.length&&C.length<m;G++){var F=H[G];if(!F.hasFetchedAccessData()){A.push(F);z.addRequestsFromBatch(F.getAccessBatch());continue}if(B(F)){C.push(e(F))}}}D(E);if(C.length<m&&z.requests.length){z.sendBatch({onComplete:function(){D(A);y(C)}})}else{y(C)}}c.call(this,s,v,u,r)};return l});define("DS/E6WCommonApps/Views/DependencyGroupView",["UWA/Core","DS/E6WCommonUI/Views/DetailsDisplaySharedView","DS/E6WCommonApps/Views/ConstraintFieldView","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,a,d,c){var b=a.extend({_uwaClassName:"DependencyGroupView",tagName:"div",className:"form-section accordion details-display-shared-view ddv-field form-group",domEvents:{"click .form-section-title":"_onGroupLabelClicked"},id:function(){return"DependencyGroup_"+this.cid},setup:function(f){this._parent.apply(this,arguments);this._dependencyi18n=c.get("E6WCommonApps.Label.Dependencies");this._labelElem=e.createElement("label",{"class":"top-label"});this.container.setAttribute("data-field-index",1);this._setupGroupElements();this._updateGroupTitle();this._getVisibleModels=f.config.getVisibleModels;this._getModelsToFilter=f.config.getModelsToFilter;this.model&&this._listenToConstraints()},render:function(){if(this._toConstraintView){this._toConstraintView.removeAutoCompleteFromDOM();this._fromConstraintView.removeAutoCompleteFromDOM()}this.container.empty(true);this._titleElem.inject(this.container);this._fieldContainer.inject(this.container);this._updateGroupTitle();if(this._expanded){this._drawConstraints()}return this},resetModel:function(f){this._parent.apply(this,arguments);this._updateGroupTitle();this._listenToConstraints();if(this._fromConstraintView){this._fromConstraintView.resetModel(f);this._toConstraintView.resetModel(f)}},toggleExpanded:function(f){this._expanded=f!==undefined?f:!this._expanded;this.render()},_getGroupTitle:function(){var g=this._dependencyi18n;if(this.model){var h=this.model.get("toConstraints");var f=h?h.length:0;var i=this.model.get("fromConstraints");var k=i?i.length:0;var j=k+f;g+=" ("+j+")"}return g},_updateGroupTitle:function(){this._titleElem.setText(this._getGroupTitle())},_drawConstraints:function(){if(!this._fromConstraintView){this._setupConstraintViews()}this._fieldContainer.empty(true);this._toConstraintView.render().inject(this._fieldContainer);this._fromConstraintView.render().inject(this._fieldContainer)},_listenToConstraints:function(){var g=this._updateGroupTitle.bind(this);var f={"onChange:toConstraints":g,"onChange:fromConstraints":g};this.listenTo(this.model,f)},_onGroupLabelClicked:function(){this.toggleExpanded();if(this._expanded){var f=this;this._animationFrameForScroll=requestAnimationFrame(function(){f._parentView.dispatchScrollToElementEvent(f.container);delete f._animationFrameForScroll})}},_setupGroupElements:function(){this._titleElem=e.createElement("div",{"class":"form-section-title",html:this._getGroupTitle()});this._fieldContainer=e.createElement("div",{"class":"form-section-body"})},_setupConstraintViews:function(){var g=this;var h=d.typeAheadCallback.bind(this,{modelId:g.model.id,getVisibleModels:g._getVisibleModels,getModelsToFilter:g._getModelsToFilter});var f=function(j){var i=e.merge(b.getConstraintFieldBasicConfig(),j);return{i18n:c,isPropertyPanel:true,model:g.model,config:e.merge(i,{typeAheadCallback:h})}};this._fromConstraintView=new d(f({name:"fromConstraints",label:c.get("E6WCommonApps.Label.Impacts"),searchTitle:c.get("E6WCommonApps.Label.Impacts"),attributeToDisplay:"successorTitle",imageAttribute:"successorImage"}));this._toConstraintView=new d(f({name:"toConstraints",label:c.get("E6WCommonApps.Label.DependsOn"),searchTitle:c.get("E6WCommonApps.Label.DependsOn"),attributeToDisplay:"predecessorTitle",imageAttribute:"predecessorImage"}));this.addChildView(this._fromConstraintView);this.addChildView(this._toConstraintView)},destroy:function(){if(this._animationFrameForScroll!==undefined){cancelAnimationFrame(this._animationFrameForScroll);delete this._animationFrameForScroll}this._parent.apply(this,arguments)}});b.getConstraintFieldBasicConfig=function(){return{type:"object",readWrite:true,minLengthBeforeAutocomplete:0,validateSameTenant:true,searchSourceTypes:{"3dplan":["dsxplan:TaskVersion","dsxplan:MilestoneVersion"]},searchSource:"3dplan"}};return b});define("DS/E6WCommonApps/Views/RDFTaskDetailsPanelConfig",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/SecurityContextUtils","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Views/DependencyGroupView","DS/E6WCommonApps/Models/AssigneeTypeAhead","DS/E6WCommonApps/Views/FixedStartStopView","DS/E6WCommonApps/Views/RichTextEditorView","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/Views/ObjectCardView","DS/RDFFoundation/Models/RDFCloneModel","DS/E6WCommonApps/FileUploadRepositoryUtil","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(i,c,o,g,l,b,n,p,a,q,j,d,e,h,f,m){var k=m.get.bind(m);var r={};r.config=function(w,y){var v=w.isComplete();var s=w.isStarted();var u=w.isStartDateFixed();var t=w.isEndDateFixed();var x=[{readWrite:"true",name:g.TITLE_ATTR,label:y?k("E6WCommonApps.Label.Title"):"",type:"text",maxLength:128,required:true,removeCarriageReturns:true,validate:true},{readWrite:"true",name:g.DESCRIPTION_ATTR,label:k("E6WCommonApps.Label.Description"),type:"RichText",customView:j,numberOfDisplayLines:3,numberOfEditableLines:3},{name:g.PARENT_ATTR,attributeToDisplay:"title",imageAttribute:"image",singleObjectOnly:true,label:k("E6WCommonApps.Label.ParentPlan"),type:"object",customView:e,linkCallback:b.launchProperties,getDropDownMenuItems:n.getDropDownMenuItems,validateSameTenant:true},{readWrite:"true",name:g.STATE_ATTR,label:k("E6WCommonApps.Label.State"),type:"select",validate:true},{readWrite:"true",name:g.COMPLETE_PERCENT_ATTR,label:k("E6WCommonApps.Label.Percent"),type:"range",step:10,percents:true},{readWrite:"true",name:s||v?g.ACTUAL_START_DATE:g.STARTDATE_ATTR,startDateLabel:s||v?k("E6WCommonApps.Label.ActualStart"):k("E6WCommonApps.Label.PlannedStart"),canEditStartDate:function(B){var z=B.isStarted();var A=B.isStartDateFixed();return A||z},endDateAttribute:v?g.ACTUAL_END_DATE:g.ENDDATE_ATTR,endDateLabel:v?k("E6WCommonApps.Label.ActualEnd"):k("E6WCommonApps.Label.PlannedEnd"),isStartDateManualAttribute:g.USER_DEFINED_START_DATE_ATTR,isEndDateManualAttribute:g.USER_DEFINED_END_DATE_ATTR,canEditEndDate:function(B){var A=B.isComplete();var z=B.isEndDateFixed();return z||A},type:"startStop",customView:q,validate:true},{readWrite:!v,name:g.DURATION,fieldLabel:k("E6WCommonApps.Label.Duration"),type:"uom",uomValues:[k("E6WCommonApps.Label.Days"),k("E6WCommonApps.Label.Hours")],minimumValue:"0",toleranceName:g.DURATION_RANGE,toleranceLabel:k("E6WCommonApps.Label.PlusMinusOffset"),conversionTable:[1,8],validate:true},r.assigneeFieldConfig,r.attachmentFieldConfig,{readWrite:"true",name:g.ACTUAL_DELIVERABLE_ATTR,attributeToDisplay:"title",imageAttribute:"image",label:k("E6WCommonApps.Label.Deliverables"),searchTitle:k("E6WCommonApps.Label.SearchForDeliverables"),type:"object",customView:e,typeAheadCallback:c.typeAheadCallback,linkCallback:b.launchProperties,getDropDownMenuItems:b.getDropDownMenuItems,allowFileManagement:true,placeHolder:k("E6WCommonApps.Label.ObjectPlaceHolder"),searchSource:o.filterSearchSources(["swym","3dspace","drive","geovia"]),excludeSearchTypes:{"3dspace":["Person","Security Context"],swym:["pno:Person"]},validateSameTenant:true},{name:g.OWNER_ATTR,attributeToDisplay:"fullName",imageAttribute:"image",label:k("E6WCommonApps.Label.Owner"),type:"person",customView:e,searchSource:["swym"],linkCallback:b.launchProperties,validateSameTenant:true},{name:g.LASTUPDATED_ATTR,label:k("E6WCommonApps.Label.LastUpdated"),type:"date"},f.getRepositoryFieldConfig(),{name:"dependencies",customView:p}];return x};r.options={};Object.defineProperty(r,"assigneeFieldConfig",{get:function(){return{readWrite:"true",name:g.ASSIGNEE_ATTR,attributeToDisplay:"fullName",imageAttribute:"image",label:k("E6WCommonApps.Label.Assignee"),dropTypes:d.PERSON_DROP_TYPES,searchSourceTypes:{swym:["pno:Person"]},mask:"dskern:MVMask.Person.Complex",typeAheadCallback:a.callback,type:"person",customView:e,searchSource:o.filterSearchSources(["swym"]),dropHandler:d.hasInvalidDroppedObject,linkCallback:b.launchProperties,minLengthBeforeAutocomplete:0,placeHolder:k("E6WCommonApps.Label.ObjectPlaceHolder"),validateSameTenant:true}}});Object.defineProperty(r,"attachmentFieldConfig",{get:function(){return{readWrite:"true",name:g.ATTACHMENT_ATTR,attributeToDisplay:"title",imageAttribute:"image",label:k("E6WCommonApps.Label.Attachments"),searchTitle:k("E6WCommonApps.Label.SearchForAttachments"),type:"object",customView:e,typeAheadCallback:c.typeAheadCallback,linkCallback:b.launchProperties,getDropDownMenuItems:b.getDropDownMenuItems,allowFileManagement:true,placeHolder:k("E6WCommonApps.Label.ObjectPlaceHolder"),searchSource:o.filterSearchSources(["swym","3dspace","drive","geovia"]),excludeSearchTypes:{"3dspace":["Person","Security Context"],swym:["pno:Person"]},validateSameTenant:true}}});return r});