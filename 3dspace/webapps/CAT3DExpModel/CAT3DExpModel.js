define("DS/CAT3DExpModel/interfaces/CATI3DXJSONProcessor",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(c,a){var b=a.singleton({interfaceName:"CATI3DXJSONProcessor",required:{Process:function(){}},optional:{}});return b});define("DS/CAT3DExpModel/interfaces/CATIAlias",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(c,a){var b=a.singleton({interfaceName:"CATIAlias",required:{GetAlias:function(){return undefined},SetAlias:function(){}},optional:{}});return b});define("DS/CAT3DExpModel/XCTVariable",["UWA/Core"],function(b){var a={_value:null,_description:null,SetDescription:function(c,f,e,d,g,h){this._description={_name:c,_type:f,_maxNumberOfValues:e,_valuationMode:d,_restrictiveTypes:g,_ID:h?h:"ID"+c}},GetType:function(){return this._description._type},GetValuationMode:function(){return this._description._valuationMode},GetRestrictiveTypes:function(){return this._description._restrictiveTypes},GetMaxNumberOfValues:function(){return this._description._maxNumberOfValues},GetID:function(){return this._description._ID},SetValue:function(c){this._value=c},GetValue:function(){if(b.is(this._value)){return this._value}else{return undefined}}};a.VarType={Integer:0,Double:1,String:2,Object:3,Boolean:4,Color:5,All:6};a.ValuationMode={AggregatingValue:0,ReferencingValue:1,PointingVariable:2,Undef:3};return a});define("DS/CAT3DExpModel/interfaces/CATI3DXVolatileEO",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(c,b){var a=b.singleton({interfaceName:"CATI3DXVolatileEO",required:{setVolatile:function(){},restorePersistent:function(){}},optional:{}});return a});define("DS/CAT3DExpModel/managers/CAT3DXUIManager",["UWA/Core","UWA/Element","DS/Core/Events","DS/WebApplicationBase/W3AAManager","UWA/Class/Listener","DS/WebComponentModeler/CATWebInterface","DS/CATCXPCIDModel/CXPUIRepFactory"],function(h,b,a,g,e,d,f){var c=h.Class.extend(g,e,{initialize:function(){this._objectsToRefresh=[];this._repFactory=new f()},getUpdatePriority:function(){return 2},getFactory:function(){return this._repFactory},postInitialize:function(){var i=this;this.eventUIManager=a.subscribe({event:"STU_UI_CHANGED"},function(j){if(j){i._objectsToRefresh.push(j.CATI3DXUIRep)}})},unInitialize:function(){this.removeContent();a.unsubscribe(this.eventUIManager);this._objectsToRefresh.length=0;this.stopListening()},_createUIRepHolder:function(){if(!this._UIRepHolder){this._UIRepHolder=h.createElement("div").inject(this._experienceBase.webApplication.frmWindow.get3DUIFrame());this._UIRepHolder.style.position="absolute";this._UIRepHolder.style.left="0px";this._UIRepHolder.style.right="0px";this._UIRepHolder.style.top="0px";this._UIRepHolder.style.bottom="0px";this._UIRepHolder.style.pointerEvents="none"}},getUIRepHolder:function(){if(!this._UIRepHolder){this._createUIRepHolder()}return this._UIRepHolder},setContent:function(j){if(j===this._uiRep){return}this.removeContent();this._uiRep=j;var k=j.Get();k.inject(this.getUIRepHolder());var i=this;this._uiRep.frameUIChanges.push(function(){i._uiRep.Show()});this._uiRep.RequestUIRefresh()},removeContent:function(){if(this._uiRep){var i=this._uiRep.Get();i.remove();this._uiRep.Hide();this._uiRep=undefined}},update:function(){for(var j=0;j<this._objectsToRefresh.length;j++){this._objectsToRefresh[j].Refresh()}},postUpdate:function(){this._objectsToRefresh.length=0},GetType:function(){return"CAT3DXUIManager"}});return c});define("DS/CAT3DExpModel/managers/CAT3DXAssetHolderManager",["UWA/Core","DS/WebApplicationBase/W3AAManager","UWA/Class/Events"],function(d,c,a){var b=d.Class.extend(c,a,{init:function(){this._assetHolders=[]},registerAssetHolder:function(e){this._assetHolders.push(e)},assetHolderResolved:function(f){for(var e=0;e<this._assetHolders.length;e++){if(f===this._assetHolders[e]){this._assetHolders.splice(e,1);if(this._assetHolders.length===0){this.dispatchEvent("assetHoldersLoaded")}return}}console.warn("CAT3DXAssetHolderManager.assetHolderResolved() : unable to find asset holder in internal list "+f.getID())},hasRegisteredAssets:function(){if(this._assetHolders.length>0){return true}else{return false}},GetType:function(){return"CAT3DXAssetHolderManager"}});return b});define("DS/CAT3DExpModel/managers/CAT3DXVisuManager",["UWA/Core","UWA/Class/Events","UWA/Element","DS/WebApplicationBase/W3AAManager","UWA/Class/Listener","DS/Visualization/ThreeJS_DS","MathematicsES/MathsDef","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Controls/ProgressBar"],function(c,d,a,f,j,i,g,e,b){var h=c.Class.extend(f,j,d,{getUpdatePriority:function(){return 1},initialize:function(){this._objectsToRefresh=[];this._requireRefresh=false;this._visuRefreshCB=[];this._root=null;this._content=null;this._overrideSet=null},postInitialize:function(){var k=this;this._viewer=this._experienceBase.webApplication.frmWindow.getViewer();this.pushVisuRefreshCB(function(){k._viewer.render()})},unInitialize:function(){this._parent();this.removeContent();this._objectsToRefresh.length=0;this.stopListening()},update:function(){for(var k=0;k<this._objectsToRefresh.length;k++){this._objectsToRefresh[k].Refresh()}if((this._objectsToRefresh.length>0)||(this._requireRefresh)){for(var l=0;l<this._visuRefreshCB.length;l++){this._visuRefreshCB[l]()}}this._objectsToRefresh.length=0;this._requireRefresh=false},getViewer:function(){return this._viewer},setRoot:function(k){this._root=k;this._viewer.getSceneGraphOverrideSetManager().clear();if(this._root){this._overrideSet=new e(k.GetNode())}},getRoot:function(){return this._root},getOverrideSet:function(){return this._overrideSet},setContent:function(l){if(l===this._content){return}if(!this._root){return}this.removeContent();this._content=l;this._viewer.addNode(this._content.GetNode());this._listenContentReady(l);var k=this._content.GetPathElement();if(k.getElement(0)!==this._root.GetNode()){console.warn("Content path should start with root node")}this._viewer.getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(this.getOverrideSet(),{substractivePath:k.getLength()>1?k:undefined})},getContent:function(){return this._content},removeContent:function(){if(this._content){this._viewer.getSceneGraphOverrideSetManager().clear();this.stopListening(this._content);this._viewer.removeNode(this._content.GetNode());this._content=null}},setViewpointControl:function(k){this._viewer.currentViewpoint.setDefaultController(false);this._viewer.currentViewpoint.control=k;this._viewer.currentViewpoint.resetCameraOrientation();this._viewer.currentViewpoint.onMove(this._viewer.render)},getViewpointControl:function(){return this._viewer.currentViewpoint.control},forceViewerRefresh:function(){this._requireRefresh=true},refreshGeoVisu:function(k){this._objectsToRefresh.push(k)},_listenContentReady:function(l){var k=this;if(!l.isReady()){this._showLoadingNotification()}this.listenTo(l,"readyChanged",function(m){if(m){this.forceViewerRefresh();k._hideLoadingNotification()}else{k._showLoadingNotification()}})},_showLoadingNotification:function(){var m=document.createElement("div");var l=new b({shape:"circular",infiniteFlag:true}).inject(m);l.elements.container.style.zoom="0.5";var k=document.createElement("span");k.innerHTML="Loading...";k.style.marginTop="auto";k.style.marginBottom="auto";k.style.marginLeft="20px";k.style.fontSize="17px";m.style.display="flex";m.appendChild(k);this._loadingNotification=this._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"info",title:m})},_hideLoadingNotification:function(){this._experienceBase.getManager("CAT3DXNotificationsManager").removeNotification(this._loadingNotification)},pushVisuRefreshCB:function(k){this._visuRefreshCB.push(k)},removeVisuRefreshCB:function(l){var k=this._visuRefreshCB.indexOf(l);if(k>=0){this._visuRefreshCB.splice(k,1)}},GetType:function(){return"CAT3DXVisuManager"}});return h});define("DS/CAT3DExpModel/managers/CAT3DXNotificationsManager",["UWA/Core","UWA/Class/Events","DS/WebApplicationBase/W3AAManager"],function(d,b,c){var a=d.Class.extend(c,b,{initialize:function(){},GetType:function(){return"CAT3DXNotificationsManager"},_logNotif:function(f){var h=f.title&&f.title.toString?f.title.toString().toUpperCase():null;var e=f.subtitle&&f.subtitle.toString?f.subtitle.toString():null;var g=f.message&&f.message.toString?f.message.toString():null;if(f.level==="info"||f.level==="success"){if(h){console.log(h)}if(e){console.log(e)}if(g){console.log(g)}}else{if(f.level==="warning"){if(h){console.warn(h)}if(e){console.warn(e)}if(g){console.warn(g)}}else{if(f.level==="error"){if(h){console.error(h)}if(e){console.error(e)}if(g){console.error(g)}}}}},addNotification:function(e){e.level=e.level?e.level:"info";this._logNotif(e)},addPromisedNotification:function(g){g.level=g.level?g.level:"info";this._logNotif(g);var f=d.Promise.deferred();var e=this;f.promise.then(function(h){h.level=h.level?h.level:"success";e._logNotif(h)})["catch"](function(h){h.level=h.level?h.level:"error";e._logNotif(h)});return f},removeNotification:function(){}});return a});define("DS/CAT3DExpModel/CAT3DXModelExtensionImpl",["UWA/Core","UWA/Class"],function(b){var a=b.Class.extend({GetComponents:function(){return[]},GetInterfaces:function(){return[]},GetExtensions:function(){return[]},GetManagers:function(){return[]}});return a});define("DS/CAT3DExpModel/interfaces/CATI3DGeoVisu",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(c,a){var b=a.singleton({interfaceName:"CATI3DGeoVisu",required:{GetNode:function(){return undefined},GetPathElement:function(){return undefined},GetOverride:function(){return undefined},GetLocalNodes:function(){return undefined},Refresh:function(){},RequestVisuRefresh:function(){},isReady:function(){return false},setReady:function(){},GetBoundingBox:function(){return undefined},GetBoundingSphere:function(){return undefined}},optional:{}});return b});define("DS/CAT3DExpModel/CAT3DXInterfaceImpl",["UWA/Core","UWA/Class"],function(b){var a=b.Class.extend({init:function(){},destroy:function(){}});return a});define("DS/CAT3DExpModel/CAT3DXModel",["UWA/Core","UWA/Promise","DS/WebExtensionServers/WebExtensionServer"],function(d,b,c){var a=d.Class.singleton({init:function(){this._extensions=[];this._interfacesData={};this._extensionsData={};this._managersData={};this._managersSymbols={};this._factory=null},clean:function(){this._extensions=[];this._componentsData={};this._interfacesData={};this._extensionsData={};this._managersData={};this._managersSymbols={};var e=this;this._extensionServer=null;return this._cleanFactory().done(function(){e._experienceBase=null})},_cleanFactory:function(){if(this._factory){var e=this;return this._factory.clean().done(function(){e._factory=null})}else{return d.Promise.resolve()}},addExtension:function(e){if(d.is(e)){this._extensions.push(e)}},setExperienceBase:function(e){this._experienceBase=e},setFactory:function(e){this._factory=e;this._factory._cat3dxModel=this},getFactory:function(){return this._factory},GetComponentByPathOfIds:function(e){return this._factory.GetComponentByPathOfIds(e)},start:function(){var e=this;return this._loadExtensions().done(function(){return e._factory.start()})},_loadExtensions:function(){var e=this;for(var f=0;f<this._extensions.length;f++){if(this._extensions[f].GetComponents().length>0){this._factory.addComponentsData(this._extensions[f].GetComponents())}if(this._extensions[f].GetInterfaces().length>0){this._addInterfacesData(this._extensions[f].GetInterfaces())}if(this._extensions[f].GetExtensions().length>0){this._addeExtensionsData(this._extensions[f].GetExtensions())}if(this._extensions[f].GetManagers().length>0){this._addManagersData(this._extensions[f].GetManagers())}}return this._loadManagers().done(function(){e._experienceBase.AddDictionaryApp(e);e._buildManagers();return d.Promise.resolve()})},_addManagersData:function(e){for(var g=0;g<e.length;g++){for(var f in e[g]){this._managersData[f]=e[g][f]}}},_addInterfacesData:function(g){for(var e=0;e<g.length;e++){for(var f in g[e]){this._interfacesData[f]=g[e][f]}}},_addeExtensionsData:function(g){for(var f=0;f<g.length;f++){for(var e in g[f]){var j=g[f][e];if(this._extensionsData[e]){for(var h in j){this._extensionsData[e][h]=j[h]}}else{this._extensionsData[e]=j}}}},_loadManagers:function(){var e=this;var g=[];for(var f in this._managersData){g.push(this._managersData[f])}return this._loadDependencies(g).done(function(j){var h=0;for(var i in e._managersData){e._managersSymbols[i]={origin:e._managersData[i],symbol:j[h++]}}})},_loadDependencies:function(f){var e=d.Promise.deferred();require(f,function(){e.resolve(arguments)});return e.promise},_getExtensionServer:function(){if(this._extensionServer){return this._extensionServer}this._extensionServer=new c();return this._extensionServer},fillServer:function(){var f=this._getExtensionServer();var e=this;Object.keys(this._managersSymbols).forEach(function(h){var g=e._managersSymbols[h].origin;var i=e._managersSymbols[h].symbol;i.GetOrigin=function(){return g};f.AddExtension(h,"W3AIManager",i);f.AddComponent(h,i)});return f},_buildManagers:function(){for(var e in this._managersSymbols){var f=this._experienceBase.Factory.BuildComponent(e);f.SetID(e);f.SetPersistency(1);f.initialize();f.postInitialize();this._experienceBase._ManagerSet.addManager(e,f)}},_addPrototypeExtensions:function(f){var j={};var l=this.GetPrototypalChain(f);var h;for(var g=l.length-1;g>=0;--g){if(this._extensionsData.hasOwnProperty(l[g])){for(h in this._extensionsData[l[g]]){j[h]=this._extensionsData[l[g]][h]}}}var k=[];for(h in j){k.push(j[h])}var e=this;return this._loadDependencies(k).done(function(n){var i=0;var m=[];for(h in j){m.push(e._addPrototypeExtension(l[0],h,n[i++],j[h]))}return d.Promise.all(m)})},_addPrototypeExtension:function(f,h,g,e){g.GetOrigin=function(){return e};var i=this._getExtensionServer();i.AddExtension(f,h,g);if(!i.GetInterface(h)){return this._addInterfaces(h)}return d.Promise.resolve()},_addInterfaces:function(f){var e=this;return this._loadDependencies([this._interfacesData[f]]).done(function(g){var h=e._getExtensionServer();h.AddInterface(f,g[0])})},CreateExperience:function(h,g){var f=this;if(this._factory){var e=this._experienceBase.getManager("CAT3DXNotificationsManager").addPromisedNotification({title:"Create Experience",subtitle:"Start creating experience"});return this._factory.CreateExperience(h,g).then(function(i){f._factory.SetExperience(i);e.resolve({title:"Create Experience",subtitle:"Experience has been created"});return i})["catch"](function(i){e.reject({title:"Create Experience",subtitle:"Fail to create experience",message:i});return b.reject(i)})}else{return b.reject(new Error("No Factory instantiated"))}},LoadExperience:function(i,h,g){var f=this;if(this._factory){var e=this._experienceBase.getManager("CAT3DXNotificationsManager").addPromisedNotification({title:"Load Experience",subtitle:"Start loading experience"});return this._factory.LoadExperience(i,h,g).then(function(j){f._factory.SetExperience(j);e.resolve({title:"Load Experience",subtitle:"Experience has been loaded"});return j})["catch"](function(j){e.reject({title:"Load Experience",subtitle:"Fail to load experience",message:j});return b.reject(j)})}else{return b.reject(new Error("No Factory instantiated"))}},IsExperienceStarted:function(){if(this._factory){return this._factory.IsExperienceStarted()}else{return b.reject(new Error("No Factory instantiated"))}},CloseExperienceServer:function(){if(this._factory){return this._factory.CloseExperienceServer()}else{return b.reject(new Error("No Factory instantiated"))}},RetrieveExperienceServer:function(){var f=this;if(this._factory){var e=this._experienceBase.getManager("CAT3DXNotificationsManager").addPromisedNotification({title:"Load Experience",subtitle:"Start loading experience"});return this._factory.RetrieveExperienceServer().then(function(g){f._factory.SetExperience(g);e.resolve({title:"Load Experience",subtitle:"Experience has been loaded"});return g})["catch"](function(g){e.reject({title:"Load Experience",subtitle:"Fail to load experience",message:g});return b.reject(g)})}else{return b.reject(new Error("No Factory instantiated"))}},SaveExperience:function(){if(this._factory){var e=this._experienceBase.getManager("CAT3DXNotificationsManager").addPromisedNotification({title:"Save Experience",subtitle:"Start saving experience"});return this._factory.SaveExperience().then(function(){e.resolve({title:"Save Experience",subtitle:"Experience has been saved"});return b.resolve()})["catch"](function(f){e.reject({title:"Save Experience",subtitle:"Fail to save experience",message:f});return b.reject(f)})}return b.reject(new Error("No Factory instantiated"))},CloseExperience:function(){var f=this;if(this._factory){var e=this._experienceBase.getManager("CAT3DXNotificationsManager").addPromisedNotification({title:"Close Experience",subtitle:"Start closing experience"});return this._factory.CloseExperience().then(function(){f._factory.SetExperience(null);e.resolve({title:"Close Experience",subtitle:"Experience has been closed"});return b.resolve()})["catch"](function(g){e.reject({title:"Close Experience",subtitle:"Fail to close experience",message:g});return b.reject(g)})}else{return b.reject(new Error("No Factory instantiated"))}},GetExperience:function(){return this._factory.GetExperience()},SetVariableValues:function(g,f,e){if(this._factory){var h=this;return this._factory.SetVariableValues(g,f,e)["catch"](function(i){h._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:i.toString()},2000);return b.reject(i)})}return b.reject(new Error("No Factory instantiated"))},CreateActor:function(h,g,e){if(this._factory){var f=this;return this._factory.CreateActor(h,g,e)["catch"](function(i){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:i.toString()},2000);return b.reject(i)})}return b.reject(new Error("No Factory instantiated"))},CreateState:function(i,h,g,e){if(this._factory){var f=this;return this._factory.CreateState(i,h,g,e)["catch"](function(j){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:j.toString()},2000);return b.reject(new Error("Unable to CreateState"))})}return b.reject(new Error("No Factory instantiated"))},CreateStateCollection:function(g,e){if(this._factory){var f=this;return this._factory.CreateStateCollection(g,e)["catch"](function(h){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:h.toString()},2000);return b.reject(new Error("Unable to CreateStateCollection"))})}return b.reject(new Error("No Factory instantiated"))},DeleteState:function(g,e){if(this._factory){var f=this;return this._factory.DeleteState(g,e)["catch"](function(h){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:h.toString()},2000);return b.reject(new Error("Unable to DeleteState"))})}return b.reject(new Error("No Factory instantiated"))},DeleteStateCollection:function(e){if(this._factory){var f=this;return this._factory.DeleteStateCollection(e)["catch"](function(g){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(new Error("Unable to DeleteStateCollection"))})}return b.reject(new Error("No Factory instantiated"))},UpdateState:function(i,e,h,f){if(this._factory){var g=this;return this._factory.UpdateState(i,e,h,f)["catch"](function(j){g._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:j.toString()},2000);return b.reject(new Error("Unable to UpdateState"))})}return b.reject(new Error("No Factory instantiated"))},UpdateStateCollection:function(e,g,h){if(this._factory){var f=this;return this._factory.UpdateStateCollection(e,g,h)["catch"](function(i){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:i.toString()},2000);return b.reject(new Error("Unable to UpdateStateCollection"))})}return b.reject(new Error("No Factory instantiated"))},CreateCityActorExternal:function(g,i,f,h){if(this._factory){var e=this;return this._factory.CreateCityActorExternal(g,i,f,h)["catch"](function(j){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:j.toString()},2000);return b.reject(new Error("Unable to CreateCityActorExternal"))})}return b.reject(new Error("No Factory instantiated"))},CreateCityActorInternal:function(f,h,i,g){if(this._factory){var e=this;return this._factory.CreateCityActorInternal(f,h,i,g)["catch"](function(j){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:j.toString()},2000);return b.reject(new Error("Unable to CreateCityActorInternal"))})}return b.reject(new Error("No Factory instantiated"))},DeleteActor:function(f){if(this._factory){var e=this;return this._factory.DeleteActor(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},InsertProduct:function(g,f,h,i){if(this._factory){var e=this._experienceBase.getManager("CAT3DXNotificationsManager").addPromisedNotification({title:"Add Product",subtitle:"Start adding product"});return this._factory.InsertProduct(g,f,h,i).then(function(j){e.resolve({title:"Add Product",subtitle:"Product has been added"});return j})["catch"](function(j){e.reject({title:"Add Product",subtitle:"Fail to add product",message:j});return b.reject(j)})}return b.reject(new Error("No Factory instantiated"))},CreateBulkOverrides:function(f,g){if(this._factory){var e=this._experienceBase.getManager("CAT3DXNotificationsManager").addPromisedNotification({title:"Add Product",subtitle:"Start adding product"});return this._factory.CreateBulkOverrides(f,g).then(function(h){e.resolve({title:"Add Product",subtitle:"Product has been added"});return h})["catch"](function(h){e.reject({title:"Add Product",subtitle:"Fail to add product",message:h});return b.reject(h)})}return b.reject(new Error("No Factory instantiated"))},CreateActorFromAsset:function(j,g,e,h,i){console.warn("DEPRECATED");if(this._factory){var f=this;return this._factory.CreateActorFromAsset(j,g,e,h,i)["catch"](function(k){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:k.toString()},2000);return b.reject(k)})}return b.reject(new Error("No Factory instantiated"))},CreateOverrideProduct:function(h,f,e){if(this._factory){var g=this;return this._factory.CreateOverrideProduct(h,f,e)["catch"](function(i){g._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:i.toString()},2000);return b.reject(i)})}return b.reject(new Error("No Factory instantiated"))},DeleteOverride:function(f){if(this._factory){var e=this;return this._factory.DeleteOverride(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateBehavior:function(h,g,e){if(this._factory){var f=this;return this._factory.CreateBehavior(h,g,e)["catch"](function(i){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:i.toString()},2000);return b.reject(i)})}return b.reject(new Error("No Factory instantiated"))},DeleteBehavior:function(f){if(this._factory){var e=this;return this._factory.DeleteBehavior(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateScenario:function(e){if(this._factory){var f=this;return this._factory.CreateScenario(e)["catch"](function(g){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},GetScenarioTypes:function(f){if(this._factory){var e=this;return this._factory.GetScenarioTypes(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},SetScenarioTypes:function(f){if(this._factory){var e=this;return this._factory.SetScenarioTypes(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateAct:function(g,e){if(this._factory){var f=this;return this._factory.CreateAct(g,e)["catch"](function(h){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:h.toString()},2000);return b.reject(h)})}return b.reject(new Error("No Factory instantiated"))},CreateParagraph:function(g,e){if(this._factory){var f=this;return this._factory.CreateParagraph(g,e)["catch"](function(h){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:h.toString()},2000);return b.reject(h)})}return b.reject(new Error("No Factory instantiated"))},CreateSentence:function(g,e){if(this._factory){var f=this;return this._factory.CreateSentence(g,e)["catch"](function(h){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:h.toString()},2000);return b.reject(h)})}return b.reject(new Error("No Factory instantiated"))},CreateBlock:function(e,f,h){if(this._factory){var g=this;return this._factory.CreateBlock(e,f,h)["catch"](function(i){g._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:i.toString()},2000);return b.reject(i)})}return b.reject(new Error("No Factory instantiated"))},CreateResource:function(g,f){if(this._factory){var e=this;return this._factory.CreateResource(g,f)["catch"](function(h){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:h.toString()},2000);return b.reject(h)})}return b.reject(new Error("No Factory instantiated"))},CreateResourceFromAsset:function(i,f,g,h){if(this._factory){var e=this;return this._factory.CreateResourceFromAsset(i,f,g,h)["catch"](function(j){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:j.toString()},2000);return b.reject(j)})}return b.reject(new Error("No Factory instantiated"))},InsertAmbience:function(f,h,g){if(this._factory){var e=this;return this._factory.InsertAmbience(f,h,g)["catch"](function(i){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:i.toString()},2000);return b.reject(i)})}return b.reject(new Error("No Factory instantiated"))},DeleteAmbience:function(f){if(this._factory){var e=this;return this._factory.DeleteAmbience(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},InsertMaterial:function(e,h,g){if(this._factory){var f=this;return this._factory.InsertMaterial(e,h,g)["catch"](function(i){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:i.toString()},2000);return b.reject(i)})}return b.reject(new Error("No Factory instantiated"))},ApplyMaterial:function(f,g){if(this._factory){var e=this;return this._factory.ApplyMaterial(f,g)["catch"](function(h){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:h.toString()},2000);return b.reject(h)})}return b.reject(new Error("No Factory instantiated"))},CreateUIButton:function(f){if(this._factory){var e=this;return this._factory.CreateUIButton(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateUIText:function(f){if(this._factory){var e=this;return this._factory.CreateUIText(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateUIImage:function(f){if(this._factory){var e=this;return this._factory.CreateUIImage(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateUITextField:function(f){if(this._factory){var e=this;return this._factory.CreateUITextField(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateUIColorPicker:function(f){if(this._factory){var e=this;return this._factory.CreateUIColorPicker(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateUISlider:function(f){if(this._factory){var e=this;return this._factory.CreateUISlider(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateUICameraViewer:function(f){if(this._factory){var e=this;return this._factory.CreateUICameraViewer(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateUIWebViewer:function(f){if(this._factory){var e=this;return this._factory.CreateUIWebViewer(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateUIGalleryMenu:function(f){if(this._factory){var e=this;return this._factory.CreateUIGalleryMenu(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateUIGalleryImage:function(f){if(this._factory){var e=this;return this._factory.CreateUIGalleryImage(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateUIGalleryProduct:function(f){if(this._factory){var e=this;return this._factory.CreateUIGalleryProduct(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateUIGalleryViewpoint:function(f){if(this._factory){var e=this;return this._factory.CreateUIGalleryViewpoint(f)["catch"](function(g){e._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:g.toString()},2000);return b.reject(g)})}return b.reject(new Error("No Factory instantiated"))},CreateGalleryItem:function(g,e){if(this._factory){var f=this;return this._factory.CreateGalleryItem(g,e)["catch"](function(h){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:h.toString()},2000);return b.reject(h)})}return b.reject(new Error("No Factory instantiated"))},CopyActor:function(g,e){if(this._factory){var f=this;return this._factory.CopyActor(g,e)["catch"](function(h){f._experienceBase.getManager("CAT3DXNotificationsManager").addNotification({level:"error",message:h.toString()},2000);return b.reject(h)})}return b.reject(new Error("No Factory instantiated"))},BuildComponent:function(e,f){if(this._factory){console.warn("3DXModel.BuildComponent() deprecated, use CreateActor() instead !");return this._factory.BuildComponent(e,f)}else{return d.Promise.reject(new Error("No Factory instantiated"))}},RemoveComponentFromComponentMap:function(e){if(this._factory){this._factory.RemoveComponentFromComponentMap(e)}else{console.error("No Factory instantiated")}},GetPrototypalChain:function(e){return this._factory.GetPrototypalChain(e)}});return a});define("DS/CAT3DExpModel/interfaces/CATIMovable",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(c,a){var b=a.singleton({interfaceName:"CATIMovable",required:{GetLocalPosition:function(){},SetLocalPosition:function(){},GetAbsPosition:function(){},SetAbsPosition:function(){}},optional:{}});return b});define("DS/CAT3DExpModel/interfaces/CATIPreviewable",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(c,b){var a=b.singleton({interfaceName:"CATIPreviewable",required:{GetPreview:function(){},DirtyPreview:function(){}},optional:{}});return a});define("DS/CAT3DExpModel/managers/CAT3DXPreviewManager",["UWA/Core","UWA/Class/Events","UWA/Class/Listener","DS/WebApplicationBase/W3AAManager","DS/Visualization/WebGLV6Viewer","DS/Visualization/Viewpoint","DS/CATCXPModel/CATCXPRenderUtils"],function(h,d,e,g,f,b,c){var a=h.Class.extend(g,e,{initialize:function(){this._nodesToPreview=[]},getUpdatePriority:function(){return 1},postInitialize:function(){this._createPreviewViewer()},unInitialize:function(){if(this._objectsToRefresh){this._objectsToRefresh.length=0}this.stopListening();this._divPreview.remove();this._previewViewer=null;this._divPreview=null},getPreview:function(l,k,j){var i=this;l.GetNode();if(l.isReady()){this._addNodeToPreview(l,k,j)}else{this.listenTo(l,"readyChanged",function(m){if(m){i.stopListening(l,"readyChanged");i._addNodeToPreview(l,k,j)}})}},_addNodeToPreview:function(m,l,j){for(var k=0;k<this._nodesToPreview.length;k++){if((this._nodesToPreview[k].GeoVisu===m)&&(String(this._nodesToPreview[k].Callback.toString())===String(l))&&(this._nodesToPreview[k].Camera===j)){return}}this._nodesToPreview.push({GeoVisu:m,Callback:l,Camera:j});if(this._nodesToPreview.length===1){this._preview(this._nodesToPreview[0])}},_preview:function(j){var i=this;this._setViewerPreviewContent(j.GeoVisu);this._getPreview(j.GeoVisu,j.Callback,j.Camera,function(){i._nodesToPreview.splice(0,1);if(i._nodesToPreview.length>0){i._preview(i._nodesToPreview[0])}})},_setViewerPreviewContent:function(k){if(this.currentNodeViewerPreview){this._previewViewer.removeNode(this.currentNodeViewerPreview);this._previewViewer.getSceneGraphOverrideSetManager().clear()}this.currentNodeViewerPreview=k.GetNode();this._previewViewer.addNode(this.currentNodeViewerPreview);var j=this._experienceBase.getManager("CAT3DXVisuManager");var i=k.GetPathElement();this._previewViewer.getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(j.getOverrideSet(),{substractivePath:i.getLength()>1?i:undefined})},_getPreview:function(l,m,j,k){var i=this;if(j){c.setViewpointFromCamera(i._previewViewer.currentViewpoint,j)}else{i._previewViewer.currentViewpoint.reframe(null,0)}i._previewViewer.setRenderFrameCB(function(){i._previewViewer.setRenderFrameCB(function(){i._previewViewer.setRenderFrameCB(null);var n=i._previewViewer.canvas.toDataURL("image/jpeg",0.1);if(m){m(n)}if(i.currentNodeViewerPreview){i._previewViewer.removeNode(i.currentNodeViewerPreview);i._previewViewer.getSceneGraphOverrideSetManager().clear();i.currentNodeViewerPreview=null}if(k){k()}});i._previewViewer.render()});i._previewViewer.render()},_createPreviewViewer:function(){if(!this._divPreview){this._divPreview=h.createElement("div");widget.body.appendChild(this._divPreview);this._divPreview.style.position="absolute";this._divPreview.style.background="#D0D0D0";this._divPreview.style.width="100%";this._divPreview.style.height="100%"}var i;var l=this._experienceBase.webApplication.app;if(l&&l.getOptions){i=l.getOptions()}var k=(i&&i.viewerOptions)?i.viewerOptions:{};k.div=this._divPreview;k.defaultLights=false;k.multiViewer=true;k.multiViewerFix=true;this._previewViewer=new f(k);this._previewViewer.setVisuEnv("None");var j=new b({viewer:this._previewViewer});this._previewViewer.addViewpoint(j);this._previewViewer.viewerID="PreviewViewer"},GetType:function(){return"CAT3DXPreviewManager"}});return a});define("DS/CAT3DExpModel/managers/CAT3DXLinkManager",["UWA/Core","DS/CAT3DExpLinkContext/CAT3DExpLinkContextFactory","DS/WebApplicationBase/W3AAManager"],function(d,a,c){var b=d.Class.extend(c,{init:function(){this._lcFactory=null},initialize:function(){this._lcFactory=new a(this._experienceBase)},registerLinkContextForDatatransfer:function(f,e){this._lcFactory.registerLinkContextForDatatransfer(f,e)},registerLinkContextForJSONDescription:function(f,e){this._lcFactory.registerLinkContextForJSONDescription(f,e)},getLinkContextFromDataTransfer:function(e){return this._lcFactory.getLinkContextFromDataTransfer(e)},getLinkContextFromJSONDescription:function(e){return this._lcFactory.getLinkContextFromJSONDescription(e)},GetType:function(){return"CAT3DXLinkManager"}});return b});define("DS/CAT3DExpModel/interfaces/CATI3DXUIRep",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(c,b){var a=b.singleton({Attachment:{ESide:{eTopLeft:0,eTop:1,eTopRight:2,eLeft:3,eCenter:4,eRight:5,eBottomLeft:6,eBottom:7,eBottomRight:8,e3DActor:9}},interfaceName:"CATI3DXUIRep",required:{Get:function(){return undefined},Refresh:function(){},Show:function(){},Hide:function(){}},optional:{}});return a});define("DS/CAT3DExpModel/loaders/CAT3DXLoader",["UWA/Core","UWA/Class/Promise"],function(c,a){var b=c.Class.extend({init:function(d){this._experienceBase=d},loadLink:function(d,e){return a.reject(new Error("not yet implemented"+d+e))}});return b});define("DS/CAT3DExpModel/interfaces/CATI3DXVisuHierarchy",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(c,b){var a=b.singleton({interfaceName:"CATI3DXVisuHierarchy",required:{GetVisuParent:function(){return undefined}},optional:{}});return a});define("DS/CAT3DExpModel/CAT3DXVariable",["UWA/Core","UWA/Class"],function(b){var a=b.Class.extend({_holder:null,_name:"NONAME",_type:null,_restrictiveTypes:undefined,_maxNumberOfValues:0,_valuationMode:undefined,_persistentValue:undefined,_volatileValue:undefined,_id:undefined,init:function(c,d,f,e,h,g){this._holder=c.QueryInterface("CATI3DExperienceObject");this._name=d;this._type=f;this._maxNumberOfValues=e;this._valuationMode=h;if(e!==1){this._persistentValue=[];this._volatileValue=[]}this._restrictiveTypes=g}});return a});define("DS/CAT3DExpModel/interfaces/CATI3DXGraphicalProperties",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(c,a){var b=a.singleton({interfaceName:"CATI3DXGraphicalProperties",required:{GetPickMode:function(){return undefined},SetPickMode:function(){},GetShowMode:function(){return undefined},SetShowMode:function(){},GetOpacity:function(){return undefined},SetOpacity:function(){},GetRed:function(){return undefined},GetGreen:function(){return undefined},GetBlue:function(){return undefined},SetColor:function(){}},optional:{}});return b});define("DS/CAT3DExpModel/managers/CAT3DXDragAndDropManager",["UWA/Core","DS/WebApplicationBase/W3AAManager","DS/DataDragAndDrop/DataDragAndDrop"],function(d,c,a){var b=c.extend({initialize:function(){this._dropZones=[]},register:function(h,g,f){if(this.isRegistered(h)){console.error("DropZone can only be set droppable once");return}this._dropZones.push(h);var e=this;var i={enter:function(j,k){if(g.enter){g.enter.call(f,j,k)}},leave:function(j,k){if(g.leave){g.leave.call(f,j,k)}},over:function(j,k){if(g.over){g.over.call(f,j,k)}},drop:function(m,k,l){if(g.expectedTypes){var j=e._experienceBase.getManager("CAT3DXLinkManager").getLinkContextFromDataTransfer(l.dataTransfer);e._experienceBase.getManager("CAT3DXLoaderManager").loadLink(j,g.expectedTypes).then(function(n){if(g.drop){g.drop.call(f,n,m,k,l)}})["catch"](function(n){if(g.fail){g.fail.call(f,n,m,k,l)}else{console.error(n)}})}}};a.droppable(h,i)},unRegister:function(f){a.clean(f);var e=this._dropZones.indexOf(f);this._dropZones.splice(e,1)},isRegistered:function(e){return(this._dropZones.indexOf(e)!==-1)},GetType:function(){return"CAT3DXDragAndDropManager"}});return b});define("DS/CAT3DExpModel/interfaces/CATI3DXAssetHolder",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(c,b){var a=b.singleton({interfaceName:"CATI3DXAssetHolder",required:{setLinkContext:function(){},getLinkContext:function(){return undefined},setLinkDescription:function(){},getLinkDescription:function(){return undefined},setCache:function(){},getCache:function(){return undefined},resolveAsset:function(){},isResolved:function(){return undefined}},optional:{}});return a});define("DS/CAT3DExpModel/commands/CAT3DXCloseExperienceCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var e=this;b.CloseExperience().done(function(){e.end()})},execute:function(){}});return c});define("DS/CAT3DExpModel/commands/VCXUpdateStateCollectionCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var f=this;var e,g,h;if(this.appOptions){e=this.appOptions.stateCollectionId;g=this.appOptions.stateCollectionNewName;h=this.appOptions.stateCollectionNewOrder}if(!e){d.log("ERROR on command VCXUpdateStateCollectionCmd, no stateCollectionId");return}if(!g){d.log("ERROR on command VCXUpdateStateCollectionCmd, no stateCollectionNewName");return}if(!h){d.log("ERROR on command VCXUpdateStateCollectionCmd, no stateCollectionNewOrder");return}b.UpdateStateCollection(e,g,h).done(function(i){f.iStateCollection=i;f.end()})},execute:function(){}});return c});define("DS/CAT3DExpModel/commands/VCXCreateStateCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,c){var b=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var f=this;var i,h,g,e;if(this.appOptions){i=this.appOptions.neutrals;h=this.appOptions.sequenceId;g=this.appOptions.stateName;e=this.appOptions.stateDescription}if(!i){d.log("ERROR on command VCXCreateStateCmd, no neutrals");return}if(!h){d.log("ERROR on command VCXCreateStateCmd, no sequenceId");return}if(!g){d.log("ERROR on command VCXCreateStateCmd, no state name");return}if(!e){d.log("ERROR on command VCXCreateStateCmd, no description");return}c.CreateState(i,h,g,e).done(function(j){f.iState=j;f.end()})},execute:function(){}});return b});define("DS/CAT3DExpModel/commands/VCXCreateCityActorInternalCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var f=this;var e,h,i,g;if(this.appOptions){e=this.appOptions.typeName;h=this.appOptions.actorName;i=this.appOptions.fatherPath;g=this.appOptions.link}if(!e){d.log("ERROR on command VCXCreateCityActorInternalCmd, no typeName");return}if(!h){d.log("ERROR on command VCXCreateCityActorInternalCmd, no actorName");return}if(!i){d.log("ERROR on command VCXCreateCityActorInternalCmd, no state name");return}if(!g){d.log("ERROR on command VCXCreateCityActorInternalCmd, no description");return}b.CreateCityActorInternal(e,h,i,g).done(function(j){f.iStateId=j;f.end()})},execute:function(){}});return c});define("DS/CAT3DExpModel/commands/CAT3DXCreateActorCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var f=this;var e,h,g;if(this.appOptions){e=this.appOptions.typeName;h=this.appOptions.actorName;g=this.appOptions.parent}if(!e){d.log("ERROR on command CAT3DXCreateActorCmd, no type of actor");return}if(!h){h=""}if(!g){d.log("ERROR on command CAT3DXCreateActorCmd, no parent");return}b.CreateActor(e,h,g).done(function(i){f.actor=i;f.end()})},execute:function(){}});return c});define("DS/CAT3DExpModel/commands/CAT3DXDeleteBehaviorCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var e=this;var f;if(this.appOptions){f=this.appOptions.behavior}if(!f){d.log("ERROR on command CAT3DXDeleteActorCmd, no behavior to delete");return}b.DeleteBehavior(f).done(function(){e.end()})},execute:function(){}});return c});define("DS/CAT3DExpModel/commands/CAT3DXDeleteActorCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var e=this;var f;if(this.appOptions){f=this.appOptions.actor}if(!f){d.log("ERROR on command CAT3DXDeleteActorCmd, no actor to delete");return}b.DeleteActor(f).done(function(){e.end()})},execute:function(){}});return c});define("DS/CAT3DExpModel/commands/CAT3DXSaveCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,b,c){var a=b.extend({init:function(e){this._parent(e,{isAsynchronous:false});d.log("Command : init ExportJSON")},beginExecute:function(){var e=this.getFrameWindow()._experienceBase;var f=c.GetExperience();e.getManager("CAT3DXLoaderManager").write3DX(f)},execute:function(){}});return a});define("DS/CAT3DExpModel/commands/CAT3DXSetValueCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){if(this.appOptions){var e=this;var f=this.appOptions.component;var h=this.appOptions.variableName;var g=this.appOptions.value;b.SetVariableValues(f,h,g).done(function(){return e.end()})}else{this.end()}},execute:function(){}});return c});define("DS/CAT3DExpModel/extensions/CATE3DXVisuHierarchy",["UWA/Core","DS/CAT3DExpModel/CAT3DXInterfaceImpl"],function(c,a){var b=a.extend({init:function(){this._parent();this._visuParent=null},destroy:function(){this._parent();this._visuParent=null},GetVisuParent:function(){if(!this._visuParent){var d=this.QueryInterface("CATICXPObject").GetFatherObject();this._visuParent=this._findVisuParent(d);this._visuParent=this._visuParent?this._visuParent:d}return this._visuParent},ClearVisuParent:function(){this._visuParent=null},_findVisuParent:function(d){var e=d.QueryInterface("CATI3DXAssetHolder").getCache();if(e&&e.OverrideChildren){for(var f=0;f<e.OverrideChildren.length;f++){if(this.GetObject()===e.OverrideChildren[f]){return d}else{var g=this._findVisuParent(e.OverrideChildren[f]);if(g){return g}}}}return undefined}});return b});define("DS/CAT3DExpModel/commands/VCXCreateStateCollectionCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var f=this;var g,e;if(this.appOptions){g=this.appOptions.stateCollectionName;e=this.appOptions.stateCollectionId}if(!g){d.log("ERROR on command VCXCreateStateCollectionCmd, no stateCollectionName");return}if(!e){d.log("ERROR on command VCXCreateStateCollectionCmd, no stateCollectionId");return}b.CreateStateCollection(g,e).done(function(h){f.iStateCollection=h;f.end()})},execute:function(){}});return c});define("DS/CAT3DExpModel/commands/VCXDeleteStateCollectionCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var f=this;if(this.appOptions){var e=this.appOptions.stateCollectionId;if(e){b.DeleteStateCollection(e).done(function(g){f.iHResult=g;f.end()})}else{d.log("ERROR on command VCXDeleteStateCollectionCmd, no stateCollectionId");this.end()}}else{this.end()}},execute:function(){}});return c});define("DS/CAT3DExpModel/commands/CAT3DXCreateBehaviorCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var g=this;var f,e,h;if(this.appOptions){f=this.appOptions.typeName;e=this.appOptions.behaviorName;h=this.appOptions.parent}if(!f){d.log("ERROR on command CAT3DXCreateBehaviorCmd, no type of behavior");return}if(!e){e=""}if(!h){h=null}b.CreateBehavior(f,e,h).done(function(i){g.behavior=i;g.end()})},execute:function(){}});return c});define("DS/CAT3DExpModel/commands/CAT3DXSaveExperienceCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,b,c){var a=b.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var e=this;c.SaveExperience().done(function(){e.end()})},execute:function(){}});return a});define("DS/CAT3DExpModel/extensions/CATEAlias",["UWA/Core","DS/CAT3DExpModel/CAT3DXInterfaceImpl","UWA/Class/Events","UWA/Class/Listener"],function(e,c,b,d){var a=e.Class.extend(c,b,d,{Build:function(){var f=this;this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"_varName.CHANGED",function(g){f.dispatchEvent("NAME_CHANGED",[g])})},destroy:function(){this._parent();this.stopListening()},SetAlias:function(f){this.QueryInterface("CATI3DExperienceObject").SetValueByName("_varName",f)},GetAlias:function(){return this.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")}});return a});define("DS/CAT3DExpModel/commands/CAT3DXLoadExperienceCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,c){var b=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var f=this;if(this.appOptions){var e=this.appOptions.linkContext;var g=this.appOptions.link;if(g){c.LoadExperience(e,g).done(function(){f.end()})}else{this.end()}}else{this.end()}},execute:function(){}});return b});define("DS/CAT3DExpModel/commands/VCXUpdateStateCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var g=this;var i,e,h,f;if(this.appOptions){i=this.appOptions.stateId;e=this.appOptions.stateCollectionId;h=this.appOptions.neutrals;f=this.appOptions.stateDescription}if(!e){d.log("ERROR on command VCXUpdateStateCmd, no stateCollectionId");return}if(!i){d.log("ERROR on command VCXUpdateStateCmd, no state name");return}if(!h){d.log("ERROR on command VCXUpdateStateCmd, no neutrals");return}if(!f){d.log("ERROR on command VCXUpdateStateCmd, no description");return}b.VCXUpdateState(i,e,h,f).done(function(j){g.iState=j;g.end()})},execute:function(){}});return c});define("DS/CAT3DExpModel/commands/VCXCreateCityActorExternalCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,b,c){var a=b.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var g=this;var f,h,i,e;if(this.appOptions){f=this.appOptions.typeName;h=this.appOptions.actorName;i=this.appOptions.fatherPath;e=this.appOptions.stateDescription}if(!f){d.log("ERROR on command VCXCreateCityActorExternalCmd, no typeName");return}if(!h){d.log("ERROR on command VCXCreateCityActorExternalCmd, no actorName");return}if(!i){d.log("ERROR on command VCXCreateCityActorExternalCmd, no state name");return}if(!e){d.log("ERROR on command VCXCreateCityActorExternalCmd, no description");return}c.CreateCityActorExternal(f,h,i,e).done(function(j){g.iStateId=j;g.end()})},execute:function(){}});return a});define("DS/CAT3DExpModel/commands/VCXDeleteStateCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,b,c){var a=b.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var f=this;var g,e;if(this.appOptions){g=this.appOptions.stateId;e=this.appOptions.stateCollectionId}if(!g){d.log("ERROR on command VCXDeleteStateCmd, no stateId");return}if(!e){d.log("ERROR on command VCXDeleteStateCmd, no stateCollectionId");return}c.DeleteState(g,e).done(function(h){f.iHResult=h;f.end()})},execute:function(){}});return a});define("DS/CAT3DExpModel/commands/CAT3DXCreateExperienceCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpModel/CAT3DXModel"],function(d,a,b){var c=a.extend({init:function(e){this._parent(e,{isAsynchronous:true})},beginExecute:function(){var e=this;var f;if(this.appOptions&&d.is(this.appOptions.experienceName)){f=this.appOptions.experienceName}else{f="New Experience"}b.CreateExperience(f).done(function(){e.end()})},execute:function(){}});return c});define("DS/CAT3DExpModel/interfaces/CATI3DExperienceObject",["UWA/Class","DS/WebComponentModeler/CATWebInterface","DS/CAT3DExpModel/XCTVariable"],function(d,a,b){var c=a.singleton({interfaceName:"CATI3DExperienceObject",required:{ListVariables:function(){},HasVariable:function(){return false},AddVariable:function(){},GetValueByName:function(){return undefined},SetValueByName:function(){},GetVariableInfo:function(){return undefined},GetVariableType:function(){return undefined},GetVariableValuationMode:function(){return undefined},GetVariableID:function(){return undefined},SetVolatile:function(){},RestorePersistent:function(){},RestorePersistentValueByName:function(){},setXCTComponent:function(){},getXCTComponent:function(){return undefined}},optional:{}});c.VarType=b.VarType;c.ValuationMode=b.ValuationMode;c.SetValueMode={OnlyVolatile:0,NoCheck:1};return c});define("DS/CAT3DExpModel/extensions/CATE3DXVolatileEO",["UWA/Core","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/CAT3DExpModel/CAT3DXInterfaceImpl"],function(d,c,b){var a=d.Class.extend(b,{init:function(){},setVolatile:function(){var f=this.QueryInterface("CATI3DExperienceObject");f.SetVolatile();var g=[];f.ListVariables(g,c.VarType.Object);for(var j=0;j<g.length;j++){var h=f.GetVariableInfo(g[j]);if(h.valuationMode===c.ValuationMode.AggregatingValue){var k=f.GetValueByName(g[j]);if(k){if(Array.isArray(k)){for(var e=0;e<k.length;e++){if((k[e].QueryInterface)&&(k[e].QueryInterface("CATI3DXVolatileEO"))){k[e].QueryInterface("CATI3DXVolatileEO").setVolatile()}}}else{if((k.QueryInterface)&&(k.QueryInterface("CATI3DXVolatileEO"))){k.QueryInterface("CATI3DXVolatileEO").setVolatile()}}}}}},restorePersistent:function(){var f=this.QueryInterface("CATI3DExperienceObject");f.RestorePersistent();var g=[];f.ListVariables(g,c.VarType.Object);for(var j=0;j<g.length;j++){var h=f.GetVariableInfo(g[j]);if(h.valuationMode===c.ValuationMode.AggregatingValue){var k=f.GetValueByName(g[j]);if(k){if(Array.isArray(k)){for(var e=0;e<k.length;e++){if((k[e].QueryInterface)&&(k[e].QueryInterface("CATI3DXVolatileEO"))){k[e].QueryInterface("CATI3DXVolatileEO").restorePersistent()}}}else{if((k.QueryInterface)&&(k.QueryInterface("CATI3DXVolatileEO"))){k.QueryInterface("CATI3DXVolatileEO").restorePersistent()}}}}}}});return a});define("DS/CAT3DExpModel/extensions/CATE3DExperienceObject",["UWA/Core","DS/CAT3DExpModel/CAT3DXInterfaceImpl","DS/CAT3DExpModel/CAT3DXModel","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","UWA/Class/Events","DS/CAT3DExpModel/XCTVariable"],function(g,b,c,f,a,d){var e=g.Class.extend(b,a,{init:function(){this._onlyVolatile=false},Build:function(){this._volatileValues={}},destroy:function(){var m=[];this.ListVariables(m,f.VarType.Object);for(var k=0;k<m.length;k++){if(this.GetVariableValuationMode(m[k])===f.ValuationMode.AggregatingValue){var l=this.GetValueByName(m[k]);if(Array.isArray(l)){for(var h=0;h<l.length;h++){if(l[h].destroy){l[h].destroy()}}}else{if(g.is(l)&&l.destroy){l.destroy()}}}}if(this._xctComponent){this._xctComponent.destroy();this._xctComponent=null}this._volatileValues={}},ListVariables:function(i,h){if(!(i instanceof Array)){i=[]}if(!g.is(h)){h=f.VarType.All}i.length=0;this._xctComponent.ListVariables(i,h)},HasVariable:function(h){return this._xctComponent.HasVariable(h)},AddVariable:function(h,j,i,m,k,l){this._xctComponent.AddVariable(h,j,i,m,k,l)},GetValueByName:function(i){if(this._volatileValues.hasOwnProperty(i)){return this._volatileValues[i]}var j=this._xctComponent.GetValueByName(i);if(j){if(this._xctComponent.GetVariableType(i)===d.VarType.Object){if(Array.isArray(j)){var h=j.map(function(k){return k._omComponent});return h}else{return j._omComponent}}}return j},SetValueByName:function(i,l,k){this._volatileValues[i]=l;if(this._onlyVolatile){k=f.SetValueMode.OnlyVolatile}if(f.SetValueMode.OnlyVolatile!==k){if(f.SetValueMode.NoCheck===k){var j=l;if(j&&this._xctComponent.GetVariableType(i)===d.VarType.Object){if(Array.isArray(j)){j=j.map(function(m){return m.QueryInterface("CATI3DExperienceObject").getXCTComponent()})}else{if(g.is(j)){j=j.QueryInterface("CATI3DExperienceObject").getXCTComponent()}}}this._xctComponent.SetValueByName(i,j);delete this._volatileValues[i]}else{var h=this;c.SetVariableValues(this.GetObject(),i,l).then(function(){delete h._volatileValues[i]})}}this._dispatchEvent(i,l)},_dispatchEvent:function(h,i){this.dispatchEvent("VARIABLE_CHANGED",[h,i]);this.dispatchEvent(h+".CHANGED",[i])},GetVariableInfo:function(h){return{name:h,type:this._xctComponent.GetVariableType(h),valuationMode:this._xctComponent.GetVariableValuationMode(h),maxNumberOfValues:this._xctComponent.GetVariableMaxNumberOfValues(h),restrictiveTypes:this._xctComponent.GetVariableRestrictiveTypes(h),id:this._xctComponent.GetVariableID(h)}},GetVariableType:function(h){return this._xctComponent.GetVariableType(h)},GetVariableValuationMode:function(h){return this._xctComponent.GetVariableValuationMode(h)},GetVariableID:function(h){return this._xctComponent.GetVariableID(h)},SetVolatile:function(){this._onlyVolatile=true;var j=[];this.ListVariables(j);for(var h=0;h<j.length;h++){this._volatileValues[j[h]]=this.GetValueByName(j[h])}},RestorePersistent:function(){this._onlyVolatile=false;for(var h in this._volatileValues){this.RestorePersistentValueByName(h)}},RestorePersistentValueByName:function(h){delete this._volatileValues[h];this._dispatchEvent(h,this.GetValueByName(h))},setXCTComponent:function(h){this._xctComponent=h;h._omComponent=this.GetObject()},getXCTComponent:function(){return this._xctComponent}});return e});define("DS/CAT3DExpModel/extensions/CATEModifiable",["UWA/Core","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValue","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXColor","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/Visualization/ThreeJS_DS"],function(e,l,h,i,f,n,m,o,a,p,k,g,c,q,b,j){var d=c.extend({init:function(){this._parent();this.VCXProperties={}},GetType:function(){return this._type},GetProperties:function(){var s=new h();var v=this.QueryInterface("CATI3DExperienceObject");var r=[];v.ListVariables(r);for(var t=0;t<r.length;++t){var u=this.GetProperty(r[t]);if(u&&u._propertyValue){s.AddOrModifyProperty(u)}}return s},GetProperty:function(s){var v=this.QueryInterface("CATI3DExperienceObject");if(e.is(v)){var r=v.GetVariableInfo(s);if(r.valuationMode!==b.ValuationMode.AggregatingValue){return null}var u=this._getVCXPropertyValue(s);if(!e.is(this.VCXProperties[s])){var t=new i(s,0,true,"VCXWebModifiables/VCXWebModifiables");this.VCXProperties[s]=new l(t,u)}else{this.VCXProperties[s].SetPropertyValue(u)}}return this.VCXProperties[s]},OnChangeProperty:function(t,r){var u=this.QueryInterface("CATI3DExperienceObject").GetValueByName(t);var s=this._getVariableValue(t,r);if(e.is(s)){if(u!==s){this.QueryInterface("CATI3DExperienceObject").SetValueByName(t,s)}}},_getVCXPropertyValue:function(r){switch(r){case"_varName":return this._toVCXString(r);default:return undefined}},_getVariableValue:function(s,r){switch(s){case"_varName":return r.GetValue();default:return undefined}},_toVCXInt:function(r){return new m(this.QueryInterface("CATI3DExperienceObject").GetValueByName(r))},_toVCXFloat:function(r){return new n(this.QueryInterface("CATI3DExperienceObject").GetValueByName(r))},_toVCXString:function(r){return new o(this.QueryInterface("CATI3DExperienceObject").GetValueByName(r))},_toVCXBool:function(r){return new a(this.QueryInterface("CATI3DExperienceObject").GetValueByName(r))},_toVCXLocation:function(r){var t=this.QueryInterface("CATI3DExperienceObject").GetValueByName(r);var s=new j.Matrix4(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1);var u=new g();u.SetFrame(new k(s));u.SetPivot(new k(s));return u},_fromVCXLocation:function(r){var t=r.GetValue();var s=t[0]._value.elements;return[s[0],s[1],s[2],s[4],s[5],s[6],s[8],s[9],s[10],s[12],s[13],s[14]]},_toVCXColor:function(r){var s=this.QueryInterface("CATI3DExperienceObject").GetValueByName(r);var t=new q();t.SetRGB((s.GetRed()?s.GetRed():0)/255,(s.GetGreen()?s.GetGreen():0)/255,(s.GetBlue()?s.GetBlue():0)/255);return new p(t)},_fromVCXColor:function(r){var t=r.GetValue();var u=t.GetThreeColor();var s={};s.r=Math.floor(u.r*255);s.g=Math.floor(u.g*255);s.b=Math.floor(u.b*255);return s}});return d});define("DS/CAT3DExpModel/extensions/CATE3DXAssetHolder",["UWA/Core","DS/CAT3DExpModel/CAT3DXInterfaceImpl"],function(c,b){var a=b.extend({init:function(){this._parent();this._linkContext=null;this._linkDescription=null;this._cache=null;this._isResolved=false},destroy:function(){this._parent();this._linkContext=null;this._linkDescription=null;this._cache=null;this._isResolved=false},setLinkContext:function(d){this._linkContext=d;this._isResolved=false},getLinkContext:function(){return this._linkContext},setLinkDescription:function(d){this._linkDescription=d;this._isResolved=false},getLinkDescription:function(){return this._linkDescription},setCache:function(d){this._cache=d},getCache:function(){return this._cache},copyFrom:function(d){this._linkContext=d._linkContext;this._linkDescription=d._linkDescription;this._cache=d._cache},resolveAsset:function(){this._isResolved=true},isResolved:function(){return this._isResolved}});return a});define("DS/CAT3DExpModel/extensions/CATE3DXNode3DAssetHolder",["UWA/Core","UWA/Class/Promise","DS/CAT3DExpModel/extensions/CATE3DXAssetHolder","DS/Visualization/ModelLoader","DS/Visualization/Node3D"],function(h,g,d,c,f){var e=h.Class.singleton({init:function(){this.modelLoaderVisu=new c();this.models=[]},pushModel:function(i){this.models.push(i);if(this.models.length===1){this.loadModel(i)}},loadModel:function(j){var i=this;this.modelLoaderVisu.setRenderCallback(j.renderCB);this.modelLoaderVisu.setOnProgressCallback(j.onProgressCB);this.modelLoaderVisu.setSceneGraph(j.targetNode);this.modelLoaderVisu.setOnLoadedCallback(function(){j.onLoadedCB();i.models.splice(0,1);if(i.models.length>0){i.loadModel(i.models[0])}});if(j.format){this.modelLoaderVisu.setFileType(j.format)}this.modelLoaderVisu.loadModel(j.url)}});var b=h.Class.extend({init:function(){this.renderCB=null;this.onProgressCB=null;this.targetNode=null;this.onLoadedCB=null;this.format=null;this.url=null},destroy:function(){this.renderCB=null;this.onProgressCB=null;this.targetNode=null;this.onLoadedCB=null;this.format=null;this.url=null},setRenderCallback:function(i){this.renderCB=i},setOnProgressCallback:function(i){this.onProgressCB=i},setSceneGraph:function(i){this.targetNode=i},setOnLoadedCallback:function(i){this.onLoadedCB=i},setFileType:function(i){this.format=i},loadModel:function(i){this.url=i;e.pushModel(this)}});var a=d.extend({init:function(){this._parent();this._node3D=null},destroy:function(){this._parent();this._node3D=null;this._node3DDeferred=null},Build:function(){this.GetObject()._experienceBase.getManager("CAT3DXAssetHolderManager").registerAssetHolder(this)},resolveAsset:function(){if(this._node3D){return h.Promise.resolve(this._node3D)}if(this._node3DDeferred){return this._node3DDeferred.promise}var i=this;this._node3DDeferred=h.Promise.deferred();this.getLinkContext().resolveLinkAsStream(this.getLinkDescription()).then(function(j){return i._loadStream(j)}).then(function(j){i._node3D=j;i._node3DDeferred.resolve(j);i._node3DDeferred=null})["catch"](function(j){i._node3DDeferred.reject(j);i._node3DDeferred=null});return this._node3DDeferred.promise},_loadStream:function(m){var j;if(localStorage.getItem("Heavy_Experience")==="true"){j=new b()}else{j=new c()}var l=this.GetObject()._experienceBase.getManager("CAT3DXVisuManager");if(l){j.setRenderCallback(l._viewer.render)}j.setOnProgressCallback(function(o){console.log(o)});j.setFileType(m.format);var n=new f();var i=h.Promise.deferred();j.setOnLoadedCallback(function(){i.resolve(n)});var k=URL.createObjectURL(m);j.loadModel(k,n);return i.promise}});return a});define("DS/CAT3DExpModel/extensions/CATE3DXImageAssetHolder",["UWA/Core","UWA/Class/Promise","DS/CAT3DExpModel/extensions/CATE3DXAssetHolder"],function(d,c,b){var a=b.extend({init:function(){this._parent();this._image=null},destroy:function(){this._parent();this._image=null},setLinkDescription:function(e){this._parent(e)},resolveAsset:function(){if(this._image){return d.Promise.resolve(this._image)}if(this._imageDeferred){return this._imageDeferred.promise}var f=this.getLinkDescription();if(f){this._imageDeferred=d.Promise.deferred();var e=this;this.getLinkContext().resolveLinkAsStream(f).done(function(h){var g=new FileReader();g.onloadend=function(i){e._image=new Image();e._image.src=i.target.result;e._isResolved=true;e._imageDeferred.resolve(e._image)};g.readAsDataURL(h)});return this._imageDeferred.promise}else{console.warn("unable to resolve image asset");return d.Promise.resolve(null)}}});return a});define("DS/CAT3DExpModel/extensions/CATE3DXExperienceAssetHolder",["UWA/Core","UWA/Class/Promise","DS/CAT3DExpModel/extensions/CATE3DXAssetHolder"],function(d,c,b){var a=b.extend({init:function(){this._parent();this._isResolved=true}});return a});define("DS/CAT3DExpModel/extensions/CATE3DXAmbienceModelAssetHolder",["UWA/Core","DS/CAT3DExpModel/extensions/CATE3DXAssetHolder","DS/Visualization/ModelLoader","DS/Visualization/Node3D"],function(e,b,a,d){var c=b.extend({init:function(){this._parent()},destroy:function(){this._parent();this._ambience=null;this._ambienceDeferred=null},resolveAsset:function(){if(this._ambience){return e.Promise.resolve(this._ambience)}if(this._ambienceDeferred){return this._ambienceDeferred.promise}this._ambienceDeferred=e.Promise.deferred();var f=this;this.getLinkContext().resolveLinkAsStream(this.getLinkDescription()).done(function(g){return f._loadStreamAndRetreiveAmbience(g)}).done(function(g){f._ambience=g;f._ambienceDeferred.resolve(g)});return this._ambienceDeferred.promise},_loadStreamAndRetreiveAmbience:function(j){var g=e.Promise.deferred();var f=new a();var l=this.GetObject()._experienceBase.webApplication.frmWindow.getViewer();var i=l.ambience;var k=new d();l.addNode(k);f.setOnLoadedCallback(function(){var m=l.ambience;if(i){l.setAmbience(i)}else{l.removeAmbience()}l.removeNode(k);g.resolve(m)});f.setFileType(j.format);var h=URL.createObjectURL(j);f.loadModel(h,k);return g.promise}});return c});define("DS/CAT3DExpModel/extensions/CATE3DXMaterialAssetHolder",["UWA/Core","DS/CAT3DExpModel/extensions/CATE3DXAssetHolder","DS/Visualization/ModelLoader","DS/Visualization/Node3D"],function(e,b,a,d){var c=b.extend({init:function(){this._parent()},destroy:function(){this._parent();this._material=null;this._materialDeferred=null},resolveAsset:function(){if(this._material){return e.Promise.resolve(this._material)}if(this._materialDeferred){return this._materialDeferred.promise}this._materialDeferred=e.Promise.deferred();var f=this;this.getLinkContext().resolveLinkAsStream(this.getLinkDescription()).done(function(g){return f._loadStreamMaterial(g)}).done(function(g){if(!g){console.error("material is not loaded")}f._material=g;f._materialDeferred.resolve(g)});return this._materialDeferred.promise},_loadStreamMaterial:function(i){var g=e.Promise.deferred();var f=new a();f.setOnLoadedCallback(function(j){g.resolve(j.material)});f.setFileType(i.format);var h=URL.createObjectURL(i);f.loadModel(h,new d());return g.promise}});return c});define("DS/CAT3DExpModel/loaders/CAT3DXCoveringMaterialLoader",["UWA/Core","DS/CAT3DExpModel/loaders/CAT3DXLoader","DS/CAT3DExpModel/CAT3DXModel"],function(d,c,b){var a=c.extend({loadLink:function(e,f){return b.InsertMaterial(null,f,e)}});return a});define("DS/CAT3DExpModel/CAT3DXBaseImpl",["UWA/Core","DS/CAT3DExpModel/CAT3DXModel"],function(c,a){var b=c.Class.extend({init:function(){},destroy:function(){for(var d in this._instanciatedExtensions){if(this._instanciatedExtensions.hasOwnProperty(d)&&this._instanciatedExtensions[d].destroy){this._instanciatedExtensions[d].destroy()}}a.RemoveComponentFromComponentMap(this)},GetObject:function(){return this}});return b});define("DS/CAT3DExpModel/XCTComponent",["UWA/Core","DS/CAT3DExpModel/XCTVariable"],function(c,b){var a={destroy:function(){for(var d in this){if(this.hasOwnProperty(d)&&b.isPrototypeOf(this[d])){delete this[d]}}delete this._parent;delete this._omComponent;delete this._assetHolder;delete this._id;delete this._type},SetValueByName:function(e,f){var d;if(this.hasOwnProperty(e)){d=this[e]}else{if(!this[e]){console.error("variable "+e+" doesnt exist");return}if((Array.isArray(f)||this.GetVariableValuationMode(e)===b.VarType.Object)&&this[e].GetValue()===f){console.warn("WARNING : YOU MUST CLONE SESSION OBJECT TO OVERRIDE VALUE!")}d=Object.create(this[e]);this[e]=d}if(f&&this.GetVariableType(e)===b.VarType.Object&&this.GetVariableValuationMode(e)===b.ValuationMode.AggregatingValue){this._setChildrenParent(f)}d.SetValue(f)},_setChildrenParent:function(e){if(Array.isArray(e)){for(var d=0;d<e.length;d++){e[d].SetParent(this)}}else{e.SetParent(this)}},GetValueByName:function(d){if(!this[d]){console.error("variable "+d+" doesnt exist");return undefined}return this[d].GetValue()},AddVariable:function(d,h,g,f,i,j,e){this[d]=Object.create(b);this[d].SetDescription(d,h,g,f,i,j);if(c.is(e)){this.SetValueByName(d,e)}else{if(h===b.VarType.Object&&g!==1){this.SetValueByName(d,[])}}return this[d]},HasVariable:function(d){if(this[d]){return true}return false},ListVariables:function(d,e){var g=d?d:[];for(var f in this){if(b.isPrototypeOf(this[f])){if(!e||e===b.VarType.All||e===this[f].GetType()){g.push(this[f]._description._name)}}}return g},HoldVariableValue:function(d){if(this.hasOwnProperty(d)){return true}return false},GetVariableType:function(d){if(!this[d]){console.error("variable "+d+" doesnt exist");return undefined}return this[d].GetType()},GetVariableValuationMode:function(d){if(!this[d]){console.error("variable "+d+" doesnt exist");return undefined}return this[d].GetValuationMode()},GetVariableRestrictiveTypes:function(d){if(!this[d]){console.error("variable "+d+" doesnt exist");return undefined}return this[d].GetRestrictiveTypes()},GetVariableMaxNumberOfValues:function(d){if(!this[d]){console.error("variable "+d+" doesnt exist");return undefined}return this[d].GetMaxNumberOfValues()},GetVariableID:function(d){if(!this[d]){console.error("variable "+d+" doesnt exist");return undefined}return this._id+","+this[d].GetID()},SetType:function(d){this._type=d},GetType:function(){return this._type},SetID:function(d){this._id=d},GetID:function(){return this._id},SetParent:function(d){this._parent=d},GetParent:function(){return this._parent}};return a});define("DS/CAT3DExpModel/CAT3DXModelFactory",["UWA/Core","UWA/Promise","DS/CAT3DExpModel/CAT3DXBaseImpl","DS/CAT3DExpModel/XCTComponent","DS/CAT3DExpModel/XCTVariable"],function(f,d,e,c,b){var a=f.Class.extend({init:function(g){this._factory=g.factory;this._componentsData={};this._componentsSymbols={};this._componentsSymbolsDeferred={};this._addObjectModelerPrototypeDeferred={};this._xctPrototypes={};this._xctPrototypesDeferred={};if(f.is(g.componentMap)){this._componentMap=g.componentMap}else{this._componentMap=this._factory._experienceBase.ComponentsMap}},start:function(){},clean:function(){this._factory=null;this._experience=null;this._componentsData={};this._componentsSymbols={};this._componentsSymbolsDeferred={};this._addObjectModelerPrototypeDeferred={};this._xctPrototypes={};this._xctPrototypesDeferred={};return f.Promise.resolve()},CreateExperience:function(h,g){return d.reject(new Error("CAT3DXModelFactory.CreateExperience: Must be implemented by derived class."+h+g))},LoadExperience:function(i,h,g){return d.reject(new Error("CAT3DXModelFactory.LoadExperience: Must be implemented by derived class."+i+h+g))},IsExperienceStarted:function(){return d.reject(new Error("CAT3DXModelFactory.IsExperienceStarted: Must be implemented by derived class."))},CloseExperienceServer:function(){return d.reject(new Error("CAT3DXModelFactory.CloseExperienceServer: Must be implemented by derived class."))},RetrieveExperienceServer:function(){return d.reject(new Error("CAT3DXModelFactory.RetrieveExperienceServer: Must be implemented by derived class."))},SaveExperience:function(){return d.reject(new Error("CAT3DXModelFactory.SaveExperience: Must be implemented by derived class."))},CloseExperience:function(){return d.reject(new Error("CAT3DXModelFactory.CloseExperience: Must be implemented by derived class."))},SetExperience:function(g){this._experience=g},GetExperience:function(){return this._experience},CreateActor:function(i,h,g){return d.reject(new Error("CAT3DXModelFactory.CreateActor: Must be implemented by derived class."+i+h+g))},DeleteActor:function(g){return d.reject(new Error("CAT3DXModelFactory.DeleteActor: Must be implemented by derived class."+g))},CreateActorFromAsset:function(k,h,g,i,j){console.warn("DEPRECATED");return d.reject(new Error("CAT3DXModelFactory.CreateActorFromAsset: Must be implemented by derived class."+k+h+g+i+j))},InsertProduct:function(h,g,i,j){return d.reject(new Error("CAT3DXModelFactory.InsertProduct: Must be implemented by derived class."+h+g+i+j))},CreateBulkOverrides:function(g,h){return d.reject(new Error("CAT3DXModelFactory.InsertProduct: Must be implemented by derived class."+g+h))},CreateOverrideProduct:function(i,h,g){return d.reject(new Error("CAT3DXModelFactory.CreateOverrideProduct: Must be implemented by derived class."+i+h+g))},DeleteOverride:function(g){return d.reject(new Error("CAT3DXModelFactory.DeleteOverride: Must be implemented by derived class."+g))},CreateBehavior:function(i,h,g){return d.reject(new Error("CAT3DXModelFactory.CreateBehavior: Must be implemented by derived class."+i+h+g))},DeleteBehavior:function(g){return d.reject(new Error("CAT3DXModelFactory.DeleteBehavior: Must be implemented by derived class."+g))},CreateScenario:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateScenario: Must be implemented by derived class."+g))},GetScenarioTypes:function(g){return d.reject(new Error("CAT3DXModelFactory.GetScenarioTypes: Must be implemented by derived class."+g))},SetScenarioTypes:function(g){return d.reject(new Error("CAT3DXModelFactory.SetScenarioTypes: Must be implemented by derived class."+g))},CreateAct:function(h,g){return d.reject(new Error("CAT3DXModelFactory.CreateAct: Must be implemented by derived class."+h+g))},CreateParagraph:function(h,g){return d.reject(new Error("CAT3DXModelFactory.CreateParagraph: Must be implemented by derived class."+h+g))},CreateSentence:function(h,g){return d.reject(new Error("CAT3DXModelFactory.CreateSentence: Must be implemented by derived class."+h+g))},CreateBlock:function(g,h,i){return d.reject(new Error("CAT3DXModelFactory.CreateBlock: Must be implemented by derived class."+g+h+i))},CreateResource:function(h,g){return d.reject(new Error("CAT3DXModelFactory.CreateResource: Must be implemented by derived class."+h+g))},CreateResourceFromAsset:function(j,g,h,i){return d.reject(new Error("CAT3DXModelFactory.CreateResourceFromAsset: Must be implemented by derived class."+j+g+h+i))},InsertAmbience:function(g,i,h){return d.reject(new Error("CAT3DXModelFactory.InsertAmbience: Must be implemented by derived class."+g+i+h))},DeleteAmbience:function(g){return d.reject(new Error("CAT3DXModelFactory.DeleteAmbience: Must be implemented by derived class."+g))},InsertMaterial:function(g,i,h){return d.reject(new Error("CAT3DXModelFactory.InsertMaterial: Must be implemented by derived class."+g+i+h))},ApplyMaterial:function(g,h){return d.reject(new Error("CAT3DXModelFactory.ApplyMaterial: Must be implemented by derived class."+g+h))},CreateUIButton:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateUIButton: Must be implemented by derived class."+g))},CreateUIText:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateUIText: Must be implemented by derived class."+g))},CreateUIImage:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateUIImage: Must be implemented by derived class."+g))},CreateUITextField:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateUITextField: Must be implemented by derived class."+g))},CreateUIColorPicker:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateUIColorPicker: Must be implemented by derived class."+g))},CreateUISlider:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateUISlider: Must be implemented by derived class."+g))},CreateUICameraViewer:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateUICameraViewer: Must be implemented by derived class."+g))},CreateUIWebViewer:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateUIWebViewer: Must be implemented by derived class."+g))},CreateUIGalleryMenu:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateUIGalleryMenu: Must be implemented by derived class."+g))},CreateUIGalleryImage:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateUIGalleryImage: Must be implemented by derived class."+g))},CreateUIGalleryProduct:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateUIGalleryProduct: Must be implemented by derived class."+g))},CreateUIGalleryViewpoint:function(g){return d.reject(new Error("CAT3DXModelFactory.CreateUIGalleryViewpoint: Must be implemented by derived class."+g))},CreateGalleryItem:function(h,g){return d.reject(new Error("CAT3DXModelFactory.CreateGalleryItem: Must be implemented by derived class."+h+g))},CopyActor:function(h,g){return d.reject(new Error("CAT3DXModelFactory.CopyActor: Must be implemented by derived class."+h+g))},buildXCTComponent:function(g,i){if(!i){console.warn("Component must have an ID")}var h;return this._getXCTPrototype(g).then(function(j){h=Object.create(j);h.SetID(i);h.SetType(g);return h})},_getXCTPrototype:function(h){if(this._xctPrototypes[h]){return f.Promise.resolve(this._xctPrototypes[h])}if(this._xctPrototypesDeferred[h]){return this._xctPrototypesDeferred[h].promise}this._xctPrototypesDeferred[h]=f.Promise.deferred();var g=this;this._buildXCTPrototype(h).then(function(i){g._xctPrototypes[h]=i;g._xctPrototypesDeferred[h].resolve(i);delete g._xctPrototypesDeferred[h]})["catch"](function(i){g._xctPrototypesDeferred[h].reject(i);delete g._xctPrototypesDeferred[h]});return this._xctPrototypesDeferred[h].promise},_buildXCTPrototype:function(h){var g=this;var i;return this.getPrototypeDefinition(h).then(function(j){i=j;if(j.Prototype){return g._getXCTPrototype(j.Prototype)}else{return f.Promise.resolve(c)}}).then(function(j){var k=Object.create(j);k.SetID(h);var l=i.Variables;if(l){g._addVariablesToPrototype(k,l)}return k})},_addVariablesToPrototype:function(g,m){for(var o=0;o<m.length;o++){var k=m[o];var l=k.VariableType;if(!g.HasVariable(k.Name)){g.AddVariable(k.Name,l,k.MaxSize,k.ValuationMode,k.RestrictiveTypes,k.ID)}var p;if(k.MaxSize!==1){p=[];if(Array.isArray(k.Value)){for(var n=0;n<k.Value.length;n++){var q=k.Value[n];if(l===b.VarType.String){p.push(q)}else{if(l===b.VarType.Integer){p.push(parseInt(q))}else{if(l===b.VarType.Double){p.push(parseFloat(q))}else{if(l===b.VarType.Boolean){if(q==="true"){p.push(true)}else{p.push(false)}}else{if(l===b.VarType.Object){console.log("not implemented")}}}}}}}}else{if(f.is(k.Value)){p=k.Value[0]}}var h=g.GetValueByName(k.Name);if(f.is(p)){if(p===h||(Array.isArray(p)&&Array.isArray(h)&&p.length===0&&h.length===0)){console.log("description can be deleted : "+g.GetID()+" "+k.Name)}else{g.SetValueByName(k.Name,p)}}p=null}},getPrototypeDefinition:function(g){var h=this._componentsData[g];if(h){return f.Promise.resolve(h)}h=this._getPrototypeDefinitionById(g);if(h){return f.Promise.resolve(h)}return f.Promise.reject("Cant retrieve definition for : "+g)},BuildComponent:function(i,k){var h=this;var j;var g=f.Promise.deferred();this._buildComponentAsync(i).then(function(l){j=l;if(k){if(h._componentMap.GetComponentFromID(k)){console.error("2 components share the same path IDs : "+k)}j.SetID(k);h._componentMap.AddComponent(j)}else{console.error("BuildComponent must be call with ID")}return h.buildXCTComponent(i,k)}).then(function(l){j.QueryInterface("CATI3DExperienceObject").setXCTComponent(l);g.resolve(j)})["catch"](function(l){if(j){var m=Object.create(c);j.QueryInterface("CATI3DExperienceObject").setXCTComponent(m);g.resolve(j)}else{g.reject(l)}});return g.promise},_buildComponentAsync:function(h){var i=this._factory.BuildComponent(h);if(!i){var g=this;return this._addObjectModelerPrototype(h).then(function(){var j=g._factory.BuildComponent(h);return j})}else{return f.Promise.resolve(i)}},_addObjectModelerPrototype:function(h){if(this._addObjectModelerPrototypeDeferred[h]){return this._addObjectModelerPrototypeDeferred[h].promise}this._addObjectModelerPrototypeDeferred[h]=f.Promise.deferred();var g=this;var i;this._getComponentSymbol(h).then(function(j){i=j;return g._cat3dxModel._addPrototypeExtensions(h)}).then(function(){var j=g._cat3dxModel._getExtensionServer();j.AddComponent(h,i);g._addObjectModelerPrototypeDeferred[h].resolve();delete g._addObjectModelerPrototypeDeferred[h]})["catch"](function(j){g._addObjectModelerPrototypeDeferred[h].reject(j);delete g._addObjectModelerPrototypeDeferred[h]});return this._addObjectModelerPrototypeDeferred[h].promise},_getComponentSymbol:function(h){if(this._componentsSymbols[h]){return f.Promise.resolve(this._componentsSymbols[h])}if(this._componentsSymbolsDeferred[h]){return this._componentsSymbolsDeferred[h].promise}this._componentsSymbolsDeferred[h]=f.Promise.deferred();var g=this;this.getPrototypeDefinition(h).then(function(i){if(i.Prototype){return g._getComponentSymbol(i.Prototype)}else{return f.Promise.resolve(e)}}).then(function(i){g._componentsSymbols[h]=i.extend({GetType:function(){return h}});g._componentsSymbolsDeferred[h].resolve(g._componentsSymbols[h]);delete g._componentsSymbolsDeferred[h]})["catch"](function(i){g._componentsSymbolsDeferred[h].reject(i);delete g._componentsSymbolsDeferred[h]});return this._componentsSymbolsDeferred[h].promise},GetComponentByPathOfIds:function(h){var i=Array.isArray(h)?h.toString():h;var g=this._componentMap.GetComponentFromID(i);if(g){return f.Promise.resolve(g)}else{return f.Promise.reject(new Error("Cant find component pathOfIds : "+i))}},RemoveComponentFromComponentMap:function(g){this._componentMap.RemoveComponent(g.GetID())},CreateVariable:function(j,h,i,k,g){return d.reject(new Error("CAT3DXModelFactory.CreateVariable: Must be implemented by derived class."+j+h+i+k+g))},SetVariableValues:function(i,h,g){return d.reject(new Error("CAT3DXModelFactory.SetVariableValues: Not implemented."+i+h+g))},addComponentsData:function(k){for(var h=0;h<k.length;h++){if(k[h].Types){k[h]=this._convertOldDictionnary(k[h])}for(var l in k[h]){var g=k[h][l].Name;var j=k[h][l];j.ID=l;if(this._componentsData[g]){this._componentsData[g]=this._mergeComponent(this._componentsData[g],j)}else{this._componentsData[g]=j}}}},_convertOldDictionnary:function(o){var p={};var q=o.Types;for(var n=0;n<q.length;n++){var m;var r=q[n];var h=r.prototypalChain.split(",");for(m=0;m<h.length;m++){if(!p[h[m]]){p[h[m]]={Name:h[m]};if(m<h.length-1){p[h[m]].Prototype=h[m+1]}}}p[r.name]={Name:r.name,Prototype:h[0]};var g=[];var s=r.localVariables;if(s){for(m=0;m<s.length;m++){var k=s[m];var l={ID:k.name,MaxSize:parseInt(k.maxNumberOfValues),Name:k.name,ValuationMode:parseInt(k.valuationMode),VariableType:parseInt(k.type)};if(k.value){if(Array.isArray(k.value)){l.Value=k.value}else{if(parseInt(k.type)===0){l.Value=[parseInt(k.value)]}else{if(parseInt(k.type)===1){l.Value=[parseFloat(k.value)]}else{if(parseInt(k.type)===4){if(k.value==="true"){l.Value=[true]}else{l.Value=[false]}}else{l.Value=[k.value]}}}}}g.push(l)}p[r.name].Variables=g}}return p},_mergeComponent:function(l,k){var j=k.Variables;if(j){var m=l.Variables?l.Variables:[];for(var h=0;h<j.length;++h){var g=m.indexOf(j[h].name);if(g>=0){m[g]=f.extend(m[g],j[h],true)}else{m.push(j[h])}}l.Variables=m}return l},GetPrototypalChain:function(h){var j=this._componentsData[h];if(!j){j=this._getPrototypeDefinitionById(h)}if(j.prototypalChain){return j.prototypalChain}var k=[h];var g=h;while(g){var i=this._componentsData[g];if(!i){i=this._getPrototypeDefinitionById(g)}if(!i){console.warn("use this function on loaded component only");return undefined}g=i.Prototype;if(g){k.push(g)}}j.prototypalChain=k;return k},_getPrototypeDefinitionById:function(g){for(var h in this._componentsData){if(this._componentsData[h].ID===g){return this._componentsData[h]}}return undefined}});return a});define("DS/CAT3DExpModel/loaders/CAT3DXAmbienceModelLoader",["UWA/Core","DS/CAT3DExpModel/loaders/CAT3DXLoader","DS/CAT3DExpModel/CAT3DXModel"],function(d,c,b){var a=c.extend({loadLink:function(e,f){return b.InsertAmbience(null,f,e)}});return a});define("DS/CAT3DExpModel/loaders/CAT3DXVPMReferenceLoader",["UWA/Core","UWA/Class/Promise","DS/CAT3DExpModel/loaders/CAT3DXLoader","DS/CAT3DExpModel/CAT3DXModel"],function(e,c,d,a){var b=d.extend({loadLink:function(g,h){var f=a.GetExperience();return a.InsertProduct(null,f,h,g)}});return b});define("DS/CAT3DExpModel/loaders/CAT3DXExperienceLoader",["UWA/Core","UWA/Class/Promise","DS/CAT3DExpModel/loaders/CAT3DXLoader","DS/CAT3DExpModel/CAT3DXModel"],function(e,c,d,a){var b=d.extend({loadLink:function(f,g){return a.LoadExperience(g,f)}});return b});define("DS/CAT3DExpModel/CAT3DXModelExtension",["UWA/Core","DS/CAT3DExpModel/CAT3DXModelExtensionImpl","text!DS/CAT3DExpModel/assets/CAT3DExpModelInterfaces.json","text!DS/CAT3DExpModel/assets/CAT3DExpManagers.json"],function(e,b,d,c){var a=b.extend({GetInterfaces:function(){return[JSON.parse(d)]},GetManagers:function(){return[JSON.parse(c)]}});return a});define("DS/CAT3DExpModel/CAT3DXModelApplication",["UWA/Core","UWA/Class/Listener","DS/Core/Core","DS/CAT3DExpModel/CAT3DXModel","DS/CAT3DExpModel/CAT3DXModelExtension","DS/CATCXPModel/CATCXPModelExtension"],function(g,e,d,b,a,f){var c=g.Class.extend(e,{init:function(j){this._parent();this._modelExtensions=[];this._modelExtensions.push(new a());this._modelExtensions.push(new f());this._options=j;if(this._options.modelExtensions){for(var h=0;h<this._options.modelExtensions.length;h++){this._modelExtensions.push(this._options.modelExtensions[h])}}this._frameWindowOptions=j.frameWindowOptions},onPostCreate:function(i,h){this._experienceBase=i;h(0);var j=this;this._initCAT3DXModel().done(function(){j.onAppReady();if(j._resetPromise){j._resetPromise.resolve()}})},_initCAT3DXModel:function(){b.setExperienceBase(this._experienceBase);for(var h=0;h<this._modelExtensions.length;h++){b.addExtension(this._modelExtensions[h])}return this._getFactory().done(function(i){b.setFactory(i);return b.start()})},_getFactory:function(){var i=g.Promise.deferred();var j=this._options.modelFactory?this._options.modelFactory:"DS/CAT3DExpModelLocal/CAT3DXModelFactoryLocal";var h=this._options.modelFactoryOptions?this._options.modelFactoryOptions:{};h.factory=this._experienceBase.Factory;h.componentMap=this._experienceBase.ComponentsMap;require([j],function(k){i.resolve(new k(h))});return i.promise},reset:function(){this._resetPromise=g.Promise.deferred();var h=this;b.clean().done(function(){h._experienceBase.webApplication.requestNewExperienceBase()});return this._resetPromise.promise},onAppReady:function(){d.setFullscreen();if(this._options.onAppReady){this._options.onAppReady()}},getOptions:function(k){var h=g.extend({viewerOptions:{picking:true,prePicking:true,multiViewer:true,multiViewerFix:true,mobile:false},uiOptions:{displayTree:false}},k,true);h=g.extend(h,this._frameWindowOptions,true);var l={};var j={force:true};var m=false;for(var i in h.viewerOptions){if(g.is(this._ODTAmbiencesInitOptionsMap[i])){j[this._ODTAmbiencesInitOptionsMap[i]]=typeof h.viewerOptions[i]==="object"?h.viewerOptions[i]:h.viewerOptions[i].toString();m=true}else{l[i]=h.viewerOptions[i]}}if(m){l.ODTMode=true;l.ODTAmbiences=JSON.stringify({effects:j})}h.viewerOptions=l;return h},_ODTAmbiencesInitOptionsMap:{infinitePlane:"Plane",displayGrid:"Grid",mirror:"Mirror",useShadowMap:"Shadow",ssao:"SSAO",backgroundColor:"BackgroundColor"}});return c});define("DS/CAT3DExpModel/CAT3DXJSONWriter",["UWA/Core","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/VCXWebExperienceLoader/VCXExperienceSaverBase"],function(d,c,b){var a=d.Class.extend({init:function(){this._expSaverBase=new b()},writeJSON:function(e,h,g){var f=this;return new d.Promise(function(k,i){var j=[];var l=f._getObjectExposition(e,h,j,g);d.Promise.all(j).then(function(){if(!l){console.error("error serialization");i();return}k(JSON.stringify(l))})["catch"](function(m){console.error(m.stack)})})},_getObjectExposition:function(v,q,w,h){var B={};if(!v){return v}if(!v.QueryInterface){return v}B.IDs={PathOfIds:v.GetID().split(",")};B.Prototype=v.GetType();var n=v.QueryInterface("CATI3DExperienceObject");if(!n){return B}if(n.HasVariable("_varName")){B.Name=n.GetValueByName("_varName")}else{B.Name=v.GetType()}var o=[];var u=[];n.ListVariables(o,c.VarType.All);for(var y=0;y<o.length;y++){var z=n.GetVariableInfo(o[y]);var x=n.GetValueByName(o[y]);var p={};p.IDs={PathOfIds:z.id.split(",")};p.Name=z.name;p.MaxSize=z.maxNumberOfValues;p.ValuationMode=z.valuationMode;p.VariableType=z.type;if(z.type===c.VarType.Object&&Boolean(x)){if(z.valuationMode===c.ValuationMode.AggregatingValue){if(z.maxNumberOfValues===1){p.Value=[this._getObjectExposition(x,q,w,h)]}else{var l=[];for(var r=0;r<x.length;r++){l[r]=this._getObjectExposition(x[r],q,w,h)}p.Value=l}}else{if(z.valuationMode===c.ValuationMode.ReferencingValue){if(z.maxNumberOfValues===1){p.Value=[{PathOfIds:x.GetID().split(",")}]}else{var C=[];for(var k=0;k<x.length;k++){C[k]={PathOfIds:x[k].GetID().split(",")}}p.Value=C}}else{console.warn("not exposed object variable :"+z.name)}}}else{if(z.type===c.VarType.Color&&Boolean(x)){if(z.maxNumberOfValues===1){var j=this._expSaverBase._PropertyToJson(x);p.Value=j}}else{if(p.ValuationMode===c.ValuationMode.AggregatingValue){if(z.maxNumberOfValues===1){p.Value=[x]}else{p.Value=x}}else{console.warn("not exposed litteral variable :"+z.name)}}}u[y]=p}B.Variables=u;var g=[];var t=n.QueryInterface("CATI3DXAssetHolder");if(t&&d.is(t.getLinkContext())&&!n.GetObject().IsKindOf("CXPExperience_Spec")){var f={};var e=t.getLinkContext();var A=e.getJSONDescription();var m=t.getLinkDescription();if((!A)||(h)){if(q){w.push(new d.Promise(function(i){e.resolveLinkAsStream(m).then(function(D){return q.pushStream(D)}).then(function(D){f.LinkDescription=D;i()})["catch"](function(D){console.error(D.stack)})}))}else{console.warn("unable to write "+n.GetValueByName("_varName"))}}else{f.LinkContextDescription=A;f.LinkDescription=m}var s=t.getCache();if(s){this._serializeCache(s);f.Cache=s}g.push(f)}B.AssetHolders=g;return B},_serializeCache:function(f){for(var e in f){if(f.hasOwnProperty(e)){if(typeof f[e]==="object"){if(f[e].GetID){f[e]={PathOfIds:f[e].GetID().split(",")}}else{this._serializeCache(f[e])}}}}}});return a});define("DS/CAT3DExpModel/commands/CAT3DXSaveLSCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DExpLinkContext/CAT3DExpLocalStorageLinkContext","DS/Core/Events","DS/CAT3DExpModel/CAT3DXJSONWriter","DS/CAT3DExpModel/CAT3DXModel"],function(g,c,b,a,e,d){var f=c.extend({init:function(h){this._parent(h,{isAsynchronous:true})},beginExecute:function(){var i=this;var k=d.GetExperience();if(!k){return}var j=k.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName");if(g.is(j)&&j!==""){var h=new b({databaseName:j});var l=new e();l.writeJSON(k,h).done(function(n){var m=new Blob([n],{type:"application/json"});return h.pushStream(m)}).done(function(){a.publish({event:"Refresh_localStorage_Assets"});i.end()})}},execute:function(){}});return f});define("DS/CAT3DExpModel/loaders/CAT3DXImageLoader",["UWA/Core","UWA/Class/Promise","DS/CAT3DExpModel/loaders/CAT3DXLoader","DS/CAT3DExpModel/CAT3DXModel"],function(e,c,d,b){var a=d.extend({loadLink:function(g,h){var f;return b.CreateResourceFromAsset("CXPPictureResource_Spec",h.getNameForLinkDescription(g),h,g).done(function(i){f=i;return b.CreateUIImage(h.getNameForLinkDescription(g))}).done(function(i){i.QueryInterface("CATI3DExperienceObject").GetValueByName("data").QueryInterface("CATI3DExperienceObject").SetValueByName("image",f);return i})}});return a});define("DS/CAT3DExpModel/managers/CAT3DXLoaderManager",["UWA/Core","UWA/Class/Promise","DS/WebApplicationBase/W3AAManager","DS/CAT3DExpModel/loaders/CAT3DXExperienceLoader","DS/CAT3DExpModel/loaders/CAT3DXVPMReferenceLoader","DS/CAT3DExpModel/loaders/CAT3DXImageLoader","DS/CAT3DExpModel/loaders/CAT3DXAmbienceModelLoader","DS/CAT3DExpModel/loaders/CAT3DXCoveringMaterialLoader"],function(e,h,f,d,g,b,c,i){var a=f.extend({init:function(){this._loaders={}},postInitialize:function(){this._loaders.CXPExperience_Spec=new d(this._experienceBase);this._loaders.Model_VPMReference_Spec=new g(this._experienceBase);this._loaders.CXPPictureResource_Spec=new b(this._experienceBase);this._loaders.AmbienceModel_Spec=new c(this._experienceBase);this._loaders.CXPCoveringMaterial_Spec=new i(this._experienceBase)},registerLoader:function(k,j){this._loaders[k]=new j(this._experienceBase)},_getLoader:function(j){return this._loaders[j]},loadLink:function(k,j){return this._loadLinkAsync(k,j,0)},_loadLinkAsync:function(p,o,n){if(n>=o.length){return e.Promise.reject("No match between loader and links")}var m=o[n];var j=this._getLoader(m);if(j){var l=e.Promise.deferred();var k=this;p.getLinkDescriptionByType(m).then(function(q){l.resolve(j.loadLink(q,p))})["catch"](function(){l.resolve(k._loadLinkAsync(p,o,n+1))});return l.promise}console.error("No loader for : "+m);return this._loadLinkAsync(p,o,n+1)},readLink:function(k,j){return e.Promise.reject("DEPRECATED! use loadLink(iLinkContext, iTypesArray"+k+j)},GetType:function(){return"CAT3DXLoaderManager"}});return a});define("DS/CAT3DExpModel/CAT3DXJSONReader",["UWA/Core","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/VCXWebExperienceLoader/VCXExperienceLoaderBase"],function(d,c,b){var a=d.Class.extend({init:function(e,f){this._factory=e;this._linkManager=f;this._refToSolve=[];this._expLoaderBase=new b()},read:function(e,k){var f=this;var h=d.Promise.deferred();var i={buildPromises:[],endBuildPromise:h.promise,processPromises:[],JSONContext:e};i.processPromises.push(i.endBuildPromise.then(function(){return f.solveReferences()}));var j=d.Promise.deferred();var g;this._readComponent(e,i,k).done(function(l){g=l;return d.Promise.all(i.buildPromises)}).done(function(){h.resolve();return d.Promise.all(i.processPromises)}).done(function(){j.resolve(g)});return j.promise},_readComponent:function(e,i,j){if(e&&e.Prototype){var g=d.Promise.deferred();var f=this;var h;this._buildComponent(e,i).then(function(k){h=k;if(h.QueryInterface("CATI3DXJSONProcessor")){i.processPromises.push(i.endBuildPromise.then(function(){return h.QueryInterface("CATI3DXJSONProcessor").Process(e)}))}return f.deserializeComponent(k,e,i,j)}).then(function(){g.resolve(h)})["catch"](function(k){console.error(k);g.resolve()});i.buildPromises.push(g.promise);return g.promise}return d.Promise.resolve()},_buildComponent:function(e,h){var g=this;var f=d.Promise.deferred();this._factory.BuildComponent(e.Prototype,e.IDs.PathOfIds.toString()).then(function(i){f.resolve(i)})["catch"](function(){g.findPrototypeInLocalTemplate(e,h);g._factory.BuildComponent(e.Prototype,e.IDs.PathOfIds.toString()).then(function(i){f.resolve(i)})["catch"](function(){g.findPrototypeInUserTypes(e,h);g._factory.BuildComponent(e.Prototype,e.IDs.PathOfIds.toString()).then(function(i){f.resolve(i)})["catch"](function(i){f.reject(i)})})});return f.promise},solveReferences:function(){var g=[];for(var f=0;f<this._refToSolve.length;f++){var e=this._refToSolve[f].object;var j=this._refToSolve[f].variableName;var k=this._refToSolve[f].callback;var h=this._refToSolve[f].value;if(e&&j){g.push(this._solveReferenceVariable(h,e,j))}else{if(k){g.push(this._solveReferenceCallback(h,k))}}}return d.Promise.all(g)},_solveReferenceVariable:function(g,f,e){return this._getComponentsByRefs(g).done(function(h){f.QueryInterface("CATI3DExperienceObject").SetValueByName(e,h,c.SetValueMode.NoCheck)})},_solveReferenceCallback:function(e,f){return this._getComponentsByRefs(e).done(function(g){f(g)})},_getComponentsByRefs:function(f){var e=d.Promise.deferred();var h=[];var j=[];for(var g=0;g<f.length;g++){h.push(this._getComponentByRef(f[g]).done(function(i){j.push(i)}))}d.Promise.all(h).done(function(){if(j.length===1){e.resolve(j[0])}else{e.resolve(j)}});return e.promise},_getComponentByRef:function(f){if(!f.PathOfIds){return this._solveOverrideChildren(f)}var e=d.Promise.deferred();this._factory.GetComponentByPathOfIds(f.PathOfIds).then(function(g){e.resolve(g)})["catch"](function(g){console.error(g.toString());e.resolve()});return e.promise},_solveOverrideChildren:function(g){var e=this._factory._componentMap.GetComponentTable();for(var h in e){var f=h.split(",");var i=f[f.length-1];if(i===g){return d.Promise.resolve(e[h])}}return undefined},deserializeComponent:function(m,p,s,h){var o;var k=p.AssetHolders;var l;if(k){var j=m.QueryInterface("CATI3DXAssetHolder");if(j){for(l=0;l<k.length;l++){if(k[l].LinkContextDescription){o=this._linkManager.getLinkContextFromJSONDescription(k[l].LinkContextDescription);j.setLinkContext(o)}else{j.setLinkContext(h)}j.setLinkDescription(k[l].LinkDescription);if(k[l].Cache){this._deserializeCache(k[l].Cache);j.setCache(k[l].Cache)}}}else{if(k.length>0){console.error(m.GetObject().GetType()+" should have an asset holder")}}}var q=[];var e=p.Variables;if(e){var g=m.QueryInterface("CATI3DExperienceObject");if(g){for(l=0;l<e.length;l++){if(!g.HasVariable(e[l].Name)){var f=e[l].IDs.PathOfIds[e[l].IDs.PathOfIds.length-1];g.AddVariable(e[l].Name,e[l].VariableType,e[l].MaxSize,e[l].ValuationMode,f)}if(!e[l].Value){continue}if(e[l].VariableType===c.VarType.Integer||e[l].VariableType===c.VarType.Double||e[l].VariableType===c.VarType.String||e[l].VariableType===c.VarType.Boolean){if(e[l].MaxSize===1){g.SetValueByName(e[l].Name,e[l].Value[0],c.SetValueMode.NoCheck)}else{g.SetValueByName(e[l].Name,e[l].Value,c.SetValueMode.NoCheck)}}else{if(e[l].VariableType===c.VarType.Color){var n=e[l].Value;var r=this._expLoaderBase.BuildVCXPropertyValue("VCXPropertyValueColor",n);g.SetValueByName(e[l].Name,r,c.SetValueMode.NoCheck)}else{if(e[l].VariableType===c.VarType.Object){q.push(this.deserializeObjectVariable(e[l],m,e[l].Name,s,o?o:h))}}}}}else{if(e.length>0){console.error(m.GetObject().GetType()+" is not a CATI3DExperienceObject")}}}return d.Promise.all(q)},_deserializeCache:function(g){if(g.OverrideChildren){for(var f=0;f<g.OverrideChildren.length;f++){this._addCacheRefToSolve(g.OverrideChildren,f)}}for(var e in g){if(g.hasOwnProperty(e)){if(typeof g[e]==="object"){if(g[e].hasOwnProperty("PathOfIds")){this._addCacheRefToSolve(g,e)}else{this._deserializeCache(g[e])}}}}},_addCacheRefToSolve:function(e,g){var f={};f.callback=function(h){e[g]=h};f.value=[e[g]];this._refToSolve.push(f)},deserializeObjectVariable:function(e,g,p,m,f){var j=e.Value;if(!j){return d.Promise.resolve()}var n=this;if(e.ValuationMode===c.ValuationMode.AggregatingValue){var o;if(e.MaxSize!==1){var i=[];var l=[];for(var k=0;k<j.length;k++){i.push(n._readComponent(j[k],m,f).done(function(q){if(d.is(q)){l.push(q)}}))}o=d.Promise.all(i).done(function(){g.QueryInterface("CATI3DExperienceObject").SetValueByName(p,l,c.SetValueMode.NoCheck)});m.buildPromises.push(o)}else{o=n._readComponent(j[0],m,f).done(function(q){g.QueryInterface("CATI3DExperienceObject").SetValueByName(p,q,c.SetValueMode.NoCheck)});m.buildPromises.push(o)}return o}else{if(e.ValuationMode===c.ValuationMode.ReferencingValue){var h={};h.object=g;h.variableName=p;h.value=e.Value;this._refToSolve.push(h)}else{if(e.ValuationMode===c.ValuationMode.PointingVariable){}}}return d.Promise.resolve()},findPrototypeInLocalTemplate:function(j,m){var i=m.JSONContext;if(i.Prototype!=="CXPExperience_Spec"){return}var g=i.Variables.map(function(n){return n.Name}).indexOf("localTemplates");if(g<0){return}var k=i.Variables[g].Value;if(!d.is(k)){return}var e=k.map(function(n){return n.Name}).indexOf(j.Prototype);if(e<0){return}var l=k[e];j.Prototype=l.Prototype;var h=j.Variables.map(function(n){return n.Name}).indexOf("_varName");var f=l.Variables.map(function(n){return n.Name}).indexOf("_varName");if(h<0||f<0){return}j.Variables[h].Value=l.Variables[f].Value},findPrototypeInUserTypes:function(g,i){var f=i.JSONContext;if(f.Prototype!=="CXPExperience_Spec"){return}var e=f.Variables.map(function(l){return l.Name}).indexOf("userTypes");if(e<0){return}var h=f.Variables[e].Value;if(!d.is(h)){return}var j=h.map(function(l){return l.Name}).indexOf(g.Prototype);if(j<0){return}var k=h[j];g.Prototype=k.Prototype}});return a});define("DS/CAT3DExpModel/loaders/CAT3DXExperienceModelLoader",["UWA/Core","UWA/Class/Promise","DS/CAT3DExpModel/loaders/CAT3DXLoader","DS/CAT3DExpModel/CAT3DXJSONReader","DS/CAT3DExpModel/CAT3DXModel"],function(f,d,e,b,a){var c=e.extend({loadLink:function(h,i){var g=this;return i.resolveLinkAsStream(h).done(function(j){return g._resolveStreamAsExperienceObject(j,i)})},_resolveStreamAsExperienceObject:function(i,h){var g=this;return new f.Promise(function(l,k){var j=new FileReader();j.onloadend=function(o){var m=new b(a.getFactory(),g._experienceBase.getManager("CAT3DXLinkManager"));var n=JSON.parse(o.target.result);if(!f.is(n)){k("invalid string")}m.read(n,h).done(function(p){if(f.is(p)){l(p)}else{k("Invalid JSON")}})};j.readAsText(i)})}});return c});