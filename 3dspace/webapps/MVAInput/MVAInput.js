define("DS/MVAInput/MVAInput",["DS/UIKIT/Input/Text","UWA/Controls/Abstract","UWA/Json","DS/UIKIT/Dropdown","DS/UIKIT/Tooltip","DS/WidgetServices/WidgetServices","DS/DataDragAndDrop/DataDragAndDrop","i18n!DS/MVAInput/assets/nls/MVAInput","css!DS/MVAInput/MVAInput.css"],function(b,d,i,g,f,h,e,c){var a=d.extend({listValue:[],internalOption:{min_width:"200",useDropDown:false,MVAClassName:"",suffixe:""},defaultOptions:{className:"",id:"",uniqueValue:false,reorder:true,suffixe:"",type:"object"},init:function(j){var k=this;this._parent(j);this.options.suffixe=this.options.suffixe?this.options.suffixe:"";this.listValue=[];this.container=UWA.createElement("div",{id:this.options.id,"class":"form-control form-control-root MVA_input "+this.internalOption.MVAClassName+" "+this.options.className,events:{click:function(){k._focus()},resize:function(){k._resizeInput()}}});this.elements={};this.elements.container=this.container;this.listOfValue=UWA.createElement("span",{"class":"listOfValue"}).inject(this.container);this.textField=UWA.createElement("span",{"class":"MVAInput_textArea"}).inject(this.container);if(this.textInput){this.textInput.inject(this.textField);e.droppable(this.textField,{drop:function(l){k._drop(l,null)}})}if(this.internalOption.useDropDown){this.dropDown=new g({className:"mva_dropdown",body:"",target:k.textInput.getContent(),events:{onClick:function(m,l){k._onValidValue()},onShow:function(){var l=this;setTimeout(function(){k._updateDropDown();if(k._getDisplayInputValue()===""){l.hide()}})}}})}if(j&&j.value){this.addItems(j.value,false)}this._resizeInput()},destroy:function(){this.elements={}},_updateDropDown:function(j){var k=this._getDisplayInputValue();var l=this.dropDown.getBody();l.empty();this.dropDown.setBody(k);if(j===true){this._onValidValue()}if(k===""){this.dropDown.hide()}else{this.dropDown.show()}},_getDisplayInputValue:function(){return this.textInput.getValue()},_focus:function(){this.textInput.focus()},_isEqual:function(k,j){return k===j},_checkValue:function(l){var j=null;var k=this;if(this.options.uniqueValue){this.getListOfValue().every(function(n){var m=n;if(typeof n==="object"&&n.value){m=n.value}if(k._isEqual(m,l.value)){j={message:c.get("The item already exists")};return false}return true})}return j},_actionOnValid:function(){},_getItemOfInput:function(){},_formatItem:function(j){return j.displayValue?j.displayValue:j.value},_setError:function(j){this.dispatchEvent("onError",j)},_onValidValue:function(){var j=this._getItemOfInput();this._actionOnValid();if(this.dropDown){this.dropDown.hide()}if(j!==""&&j.value!==""){this.addItem(j)}},_clear:function(){this.listOfValue.empty();this.listValue=[]},setValue:function(k){var m=this;var l=false;if(k&&k.length===this.listValue.length){l=true;var j=true;if(k.length>0){var n=k[0];if(typeof n!=="object"||n===null||k[0].value===undefined){j=false}}k.every(function(q,p){var o=m.listValue[p];var r=null;if(o){r=m.listValue[p].info}if(r!=null){if(j===false&&!m._isEqual(k[p],r.value)||j===true&&!m._isEqual(k[p].value,r.value)){l=false;return false}}return true})}if(false===l){this._clear();this.addItems(k)}},addItems:function(j,m){var l=this;if(Array.isArray(j)){var k=j.length;j.forEach(function(n){k--;l.addItem(n,null,k>0?false:m)})}},addItem:function(t,m,s){if(t===null||t===undefined){return}var l=t;if(typeof t!=="object"||t.value===undefined){l={value:t}}var r=this._checkValue(l);if(r){this._setError(r);return}l.displayValue=this._formatItem(l)+this.options.suffixe;var q=this;var k=this._genenateUniqueId();l.mva_id=k;var p=UWA.createElement("span",{mva_id:l.mva_id,html:[{tag:"div","class":"formatted-label",html:l.displayValue}]});var u=this._getTooltipForItem(l);if(u){new f({delay:{show:400},target:p,body:u,position:"bottom"})}UWA.createElement("div",{"class":"supp-icon fonticon fonticon-cancel",events:{click:function(v){q._removeValueInList(k);p.remove()}}}).inject(p);var n=i.encode({value:l.value,displayValue:l.displayValue,id:l.mva_id});e.draggable(p,{data:n,start:function(){q._dragStart(p,k)},stop:function(){q._dragStop(p)},});e.droppable(p,{drop:function(v){q._drop(v,k)}});if(m){var o=null;if(m){o=this._getElementFromId(m)}var j=this.listValue[o].UI;this.listOfValue.insertBefore(p,j);this._setValueInList(p,l,o)}else{p.inject(this.listOfValue);this._setValueInList(p,l)}this._resizeInput();if(s!==false){this.dispatchEvent("onChange")}},_getTooltipForItem:function(j){return null},_resizeInput:function(){var q=this.container.getDimensions();var p=0;var s=0;var k=this.listValue.length;var l=0;var o=0;for(l=k-1;l>=0;l--){var t=this.listValue[l];var j=t.UI;var m=j.getOffsets();var n=m.y;if(l===k-1){o=n}if(n===o){var r=j.getDimensions();var u=r.outerWidth;p+=u}else{break}}s=q.innerWidth-p-20;if(s<this.internalOption.min_width){s="100%"}else{s=((s*100)/q.innerWidth)+"%"}this.textField.setStyle("width",s)},_dragStart:function(j,k){this.movingItem=k;j.addClassName("movingAttribute");console.log("Event:","start")},_dragStop:function(k){var j=this;k.removeClassName("movingAttribute");console.log("Event:","stop");setTimeout(function(){j.movingItem=null},0)},_drop:function(k,l){if(k){var j=i.decode(k);if(j.value){if(this.movingItem&&l){if(this.options.reorder!==false){this._insertElementAfterOrBefore(this.movingItem,l)}}else{this.addItem({value:j.value},l)}}}},_genenateUniqueId:function(){var m={info:{mva_id:0}};var l=true;var k=this.listValue.length+1;var n=0;while(l===true&&n<k){n++;m.info.mva_id++;var j=h.arrayContains(this.listValue,m,function(o){return o.info.mva_id});l=!(j<0)}return m.info.mva_id},_insertElementAfterOrBefore:function(o,j){var m=this._getElementFromId(j);var n=this._getElementFromId(o);var l=null;if(n>=0){l=this.listValue[n]}var k=null;if(m>=0){k=this.listValue[m]}if(k&&l){if(n<m){this.listValue.splice(m+1,0,l);this.listValue.splice(n,1);if(this.listValue.length===m){l.UI.inject(this.listOfValue)}else{this.listOfValue.insertBefore(l.UI,k.UI.nextSibling)}}else{this.listValue.splice(n,1);this.listValue.splice(m,0,l);this.listOfValue.insertBefore(l.UI,k.UI)}}this._resizeInput();this.dispatchEvent("onChange")},_getElementFromId:function(k){var j=null;this.listValue.every(function(m,l){if(m.info.mva_id===k){j=l;return false}return true});return j},_setValueInList:function(l,k,j){if(j){this.listValue.splice(j,0,{UI:l,info:k})}else{this.listValue.push({UI:l,info:k})}},_removeValueInList:function(k){var j=this._getElementFromId(k);this.listValue.splice(j,1);this._resizeInput();this.dispatchEvent("onChange")},getItems:function(){return this.listValue},getValue:function(){return this.getListOfValue()},getListOfValue:function(){var j=this;var k=[];this.listValue.forEach(function(l){var m=l.info;if(j.options.type==="table"){k.push(l.info.value)}else{k.push(l.info)}});return k}});return a});define("DS/MVAInput/searchPeopleInput/MVASearchPeopleInput",["DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant","DS/MVAInput/MVAInput","i18n!DS/MVAInput/assets/nls/MVAInput"],function(d,a,c){var b=c.extend({internalOption:{useDropDown:false,MVAClassName:"MVA_searchPeopleMaster"},init:function(e){var g=this;var f=a.TYPE_FULL;this.textInput=d.getSearchWidget(d.FULL,{className:"searchPeople_mva",MaxNumber:"5",MaxSize:"300",showEmptyCategory:false,type:f,events:{onValid:function(){g._onValidValue();this.clearTextArea()},onError:function(h){g._setError(h)}}});this._parent(e)},_isEqual:function(f,e){return this._parent(f,e)||JSON.stringify(f)===JSON.stringify(e)},_focus:function(){},_actionOnValid:function(){},_formatItem:function(e){return e.displayValue?e.displayValue:e.value},_getValueOfInput:function(){var e=this.textInput.getNewOwner();e.displayedValue=this.textInput.getDisplayedResult();return e},_getItemOfInput:function(){var e=this._getValueOfInput();return{value:e.person.personID,displayValue:e.displayedValue,content:e}}});return b});define("DS/MVAInput/selectInput/MVASelectInput",["DS/UIKIT/Input/Select","DS/MVAInput/MVAInput","DS/WidgetServices/WidgetServices","i18n!DS/MVAInput/assets/nls/MVAInput"],function(e,b,d,c){var a=b.extend({internalOption:{useDropDown:false},defaultOptions:{options:[]},init:function(f){var g=this;if(!f.options){f.options=[]}var h=false;if(d.isReplayedODT()){h=true}this.textInput=new e({custom:h,className:"MVAInput_select",placeholder:c.get("MVA_input_Placeholder"),options:f.options,events:{onChange:function(){g._onValidValue()}}});this._parent(f)},_actionOnValid:function(){},_getValueOfInput:function(){var f="";var g=this.textInput.getValue();if(g.length>0){f=g[0]}return f},_getItemOfInput:function(){var g=this._getValueOfInput();var f=this.textInput.getOption(g).textContent;return g===""?g:{value:g,displayValue:f}}});return a});define("DS/MVAInput/textInput/MVATextInput",["DS/UIKIT/Input/Text","DS/MVAInput/MVAInput","i18n!DS/MVAInput/assets/nls/MVAInput"],function(c,b,d){var a=b.extend({internalOption:{useDropDown:true},init:function(e){var f=this;this.textInput=new c({className:"MVAInput_input",placeholder:d.get("MVA_input_Placeholder"),events:{onKeyDown:function(h){var g=this;setTimeout(function(){var i=false;if(h.keyCode===13){i=true}f._updateDropDown(i)},0)}}});this._parent(e)},_isEqual:function(f,e){return this._parent(f,e)||parseFloat(f)===parseFloat(e)},_actionOnValid:function(){this.textInput.setValue("")},_getValueOfInput:function(){return this.textInput.getValue()},_getItemOfInput:function(){var e=this._getValueOfInput();return{value:e,displayValue:e}}});return a});define("DS/MVAInput/dateInput/MVADateInput",["DS/UIKIT/Input/Date","DS/MVAInput/MVAInput","i18n!DS/MVAInput/assets/nls/MVAInput"],function(b,a,d){var c=a.extend({internalOption:{useDropDown:false},defaultOptions:{options:[]},init:function(e){var f=this;if(!e.options){e.options=[]}this.textInput=new b({className:"MVAInput_input",placeholder:d.get("MVA_input_Placeholder"),events:{onChange:function(){f._onValidValue()}}});this.hiddenTextInput=new b({className:"MVAInput_hidden_input hidden"});this._parent(e)},_actionOnValid:function(){this.textInput.setValue("")},_formatItem:function(e){this.hiddenTextInput.setDate(e.value);return this.hiddenTextInput.getValue()},_getValueOfInput:function(){var f="";var e=this.textInput.getDate();return e},_getItemOfInput:function(){var e=this._getValueOfInput();return{value:e}},_isEqual:function(f,e){return this._parent(f,e)||f.toDateString()===e.toDateString()}});return c});define("DS/MVAInput/MVAInputDispatcher",["DS/MVAInput/dateInput/MVADateInput","DS/MVAInput/searchPeopleInput/MVASearchPeopleInput","DS/MVAInput/selectInput/MVASelectInput","DS/MVAInput/textInput/MVATextInput"],function(e,c,b,d){var a={generateMVAInput:function(g,f){var h=null;switch(g){case"timestamp":h=e;break;case"person":h=c;break;case"enum":h=b;break;default:h=d}return new h(f)}};return a});