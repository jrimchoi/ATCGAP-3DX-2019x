define("DS/AccessRightWidget/AccessRightModel",["UWA/Controls/Abstract",],function(b){var a=b.extend({init:function(c){this._RightList=[];this._DataList=[];this._ObjectId=c;this._ownerId="";this._projId="";this._orgId="";this._userGrpId="";this._objectType=""},setPOV:function(c,d,f,e){this._ownerId=c;this._projId=d;this._orgId=f;this._userGrpId=e},getOwnerId:function(){return this._ownerId},getProjId:function(){return this._projId},getOrgId:function(){return this._orgId},getUserGrpId:function(){return this._userGrpId},getObjectType:function(){return this._objectType},setRightList:function(c){this._RightList=c},setDataList:function(c){this._DataList=c},setObjectId:function(c){this._ObjectId=c},setObjectType:function(c){this._objectType=c},getRightList:function(){return this._RightList},getDataList:function(){return this._DataList},getObjectId:function(){return this._ObjectId}});return a});define("DS/AccessRightWidget/Map",["UWA/Class"],function(a){return a.extend({init:function(){this.data={}},add:function(b,c){this.data[b]=c},find:function(b){return this.data[b]},remove:function(b){delete this.data[b]},contains:function(b){return this.data[b]==null?false:true},count:function(){var b=0;Object.keys(this.data).map(function(c){++b});return b},clear:function(){this.data={}},each:function(b){var c=this.data;Object.keys(this.data).map(function(d){b(d,c[d])})}})});define("DS/AccessRightWidget/AccessRightController",["UWA/Controls/Abstract","UWA/Json","DS/AccessRightWidget/AccessRightModel","DS/WidgetServices/WidgetServices","DS/WAFData/WAFData","DS/WidgetServices/securityContextServices/SecurityContextServices","i18n!DS/AccessRightWidget/assets/nls/langAR"],function(f,i,d,c,g,b){var h=c.getProdLevel();var a="AccessRightWidget";var e=f.extend({defaultOptions:{uniqueRightList:false,wintop:false,serverName:"",serverUri:"",isReadOnly:false,odtMode:false,parent:null,},init:function(k,j){h=c.getProdLevel();this.widget=k;this.AccessRightModelList=[];this.ECToParentMap=JSON.parse("[]");this.IdToECMap=JSON.parse("[]");this.SelectedItemsMap=JSON.parse("[]");this.ExistingECItemsMap=JSON.parse("[]");this.AggrItemsMap=JSON.parse("[]");this.ErrorExistingECAndAggrItemsMap=JSON.parse("[]");this.SelectedItems=[];this.SelectedItemsTypeMap=JSON.parse("[]");this.NonEmbeddedComponentList=[];this._bInitDatas=false;this._options=j;this._parent(j)},getRightList:function(j){var k=[];if(this.options.uniqueRightList==true){if(this.AccessRightModelList.length>0){k=this.AccessRightModelList[0].getRightList()}}else{this.AccessRightModelList.every(function(l){if(l.getObjectId()==j){k=l.getRightList();return false}return true})}return k},getFormattedRightList:function(j){var l=this.getRightList(j);var k=[];l.forEach(function(n,m){var o={label:n.nls,value:n.logical};k.push(o)});return k},RemoveItem:function(j){var k=this;var l=false;this.AccessRightModelList.every(function(n,m){if(n.getObjectId()==j){k.AccessRightModelList.splice(m,1);l=true;return false}return true});return l},getOwnership:function(k){var j=[];this.AccessRightModelList.every(function(l){if(l.getObjectId()==k){j=l.getDataList();return false}return true});return j},isInherited:function(k,j){var l=this.getOwnershipFromOwner(k,j);var m=false;if(l!=null&&l.hasOwnProperty("inheritedPath")){if(l.inheritedPath.length>0){m=true}}return m},getOwner:function(k,j){var l=this.getOwnershipFromOwner(k,j);if(l==null){return null}else{return l.owner}},getOwnershipFromOwner:function(k,j){var l=this.getOwnership(k);var n=null;var m=this;l.every(function(o){var p=m.ownerAreSame(o.owner,j);if(p.same==true){n=o;return false}return true});return n},getFusionOwnership:function(){var k=this;var j=[];this.AccessRightModelList.forEach(function(n,m){var l=n.getDataList();if(m==0){l.forEach(function(p){j.push({ownership:p,isTrueComment:true,inheritedPath:true})})}else{var o=[];j.forEach(function(p){element=p.ownership;l.every(function(s){if(element.access.logical==s.access.logical){var t=k.ownerAreSame(element.owner,s.owner);if(t.same==true){if(p.hasOwnProperty("isTrueComment")==false){p.isTrueComment=true}if(t.sameComment==false){element.owner.comment=UWA.i18n("DifferentFromItem");p.isTrueComment=false}if(p.hasOwnProperty("isTrueInheritedPath")==false){p.isTrueInheritedPath=true}if(p.isTrueInheritedPath==true){var r=true;if(element.hasOwnProperty("inheritedPath")==true||s.hasOwnProperty("inheritedPath")==true){if(element.hasOwnProperty("inheritedPath")==true&&s.hasOwnProperty("inheritedPath")==true){if(element.inheritedPath.length<=0||s.inheritedPath.length<=0){p.isAllInherit=false}r=k.inheritedPathAreSame(element.inheritedPath,s.inheritedPath)}else{r=false}}else{element.isAllInherit=false}if(r==false){var q=[{inheritedFrom:{objectID:"undefined",objectTNR:UWA.i18n("DifferentFromItem")},inheritedAccess:{logical:UWA.i18n("DifferentFromItem")}}];element.inheritedPath=q}}o.push(p);return false}}return true})});j=o}});return j},inheritedPathAreSame:function(m,k){var l=true;if(m.length==k.length){var j=k.slice();m.every(function(o){var n=false;j.every(function(q,p){if(o.inheritedFrom.objectID==q.inheritedFrom.objectID){j.splice(p,1);n=true;return false}return true});if(n==false){l=false;return false}return true})}else{l=false}return l},ownerAreSame:function(l,j){var n=true;var m=false;if(l.hasOwnProperty("person")||j.hasOwnProperty("person")){if(l.hasOwnProperty("person")&&j.hasOwnProperty("person")){if(l.person.personID!=j.person.personID){n=false}}else{n=false}}if(n==true&&l.hasOwnProperty("collabSpace")||j.hasOwnProperty("collabSpace")){if(l.hasOwnProperty("collabSpace")&&j.hasOwnProperty("collabSpace")){if(l.collabSpace.collabSpaceID!=j.collabSpace.collabSpaceID){n=false}}else{n=false}}if(n==true&&l.hasOwnProperty("organization")||j.hasOwnProperty("organization")){if(l.hasOwnProperty("organization")&&j.hasOwnProperty("organization")){if(l.organization.orgID!=j.organization.orgID){n=false}}else{n=false}}if(n==true&&l.hasOwnProperty("userGrp")||j.hasOwnProperty("userGrp")){if(l.hasOwnProperty("userGrp")&&j.hasOwnProperty("userGrp")){if(l.userGrp.userGrpID!=j.userGrp.userGrpID){n=false}}else{n=false}}if(l.hasOwnProperty("comment")||j.hasOwnProperty("comment")){if(l.hasOwnProperty("comment")&&j.hasOwnProperty("comment")){if(l.comment==j.comment){m=true}}}var k={same:n,sameComment:m};return k},_accessListSame:function(m,k){returnedValue=true;if(m.length!=k.length){returnedValue=false}else{var j=k.slice();var l=true;m.every(function(o){var n=false;j.every(function(q,p){if(o.logical==q.logical){n=true;j.splice(p,1);return false}return true});if(n==false){l=false;return false}return true});if(l==false){returnedValue=false}}return returnedValue},onLoad:function(){this.AccessRightModelList=[];this.widget=widget;this.AccessRightModelList=[];this.ECToParentMap=JSON.parse("[]");this.IdToECMap=JSON.parse("[]");this.SelectedItemsMap=JSON.parse("[]");this.ExistingECItemsMap=JSON.parse("[]");this.AggrItemsMap=JSON.parse("[]");this.ErrorExistingECAndAggrItemsMap=JSON.parse("[]");this.SelectedItems=[];this.SelectedItemsTypeMap=JSON.parse("[]");this.NonEmbeddedComponentList=[];this._bInitDatas=false},onRefresh:function(){var j=[];this.AccessRightModelList.forEach(function(k){j.push({objectID:k.getObjectId(),})});this.AccessRightModelList=[];this._addSelectedIdInList(j)},getCurrentSelectedItems:function(){var j=[];this.AccessRightModelList.forEach(function(k){j.push({objectID:k.getObjectId(),})});return j},addSelectItem:function(j){if(j==null||j.length<=0){this.onRefresh();return}var l=this;var k=[];var m=[];j=c.removeDuplicate(j,function(n){return n.physicalId});j.forEach(function(o){var n=false;l.AccessRightModelList.every(function(p){if(o.physicalId==p.getObjectId()){n=true;return false}return true});if(n==false){k.push({objectID:o.physicalId,})}});if(k.length>0){l._loadPOV(k,function(n){l._addSelectedIdInList(n)},function(n){l._onFailure(null,n,null)})}else{this.onRefresh()}},_loadPOV:function(n,j,k){if(n.length==0){j(n);return}var m=this;var o=[];for(var l=0;l<n.length;l++){o.push(n[l].objectID)}m._listAttributes(o,["owner","project","organization","title","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","type"],function(p){for(var r=0;r<p.results.length;r++){var s=p.results[r];var q=m._getModel(s.physicalid);if(q==null){continue}q.setPOV(s.owner+"_PRJ",s.project,s.organization);q.setObjectType(object.type)}j(n)},function(p){k(p)})},isPovOwner:function(l,j){var k=this._getModel(l);if(k==null){return false}if(k.getOwnerId()==j){return true}return false},isPovCollabSpace:function(l,k,m){var j=this._getModel(l);if(j==null){return false}if(j.getProjId()==k&&j.getOrgId()==m){return true}return false},isPovUserGroup:function(k,l){var j=this._getModel(k);if(j==null){return false}if(j.getUserGrpId()==l){return true}return false},_getModel:function(k){for(var m=0;m<this.AccessRightModelList.length;m++){var j=this.AccessRightModelList[m];if(j.getObjectId()==k){return j}}var l=new d(k);this.AccessRightModelList.push(l);return l},_listAttributes:function(j,l,o,r){var s=this;var v=[];var m=j.length;for(var q=0;q<m;q++){var u=j[q];v.push({physicalid:u})}var p={data:v,attributes:l};var w="/resources/lifecycle/product/attributeList";this._post(w,p,function t(n){o(n)},function k(n){r(n)})},_fillAttributesOfSelectedItems:function(q,o,s){var t=this;var x=[];var l=["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","owner","project","organization","physicalid","type"];var z=q.length;var j=[];for(var w=0;w<z;w++){j.push(q[w]["physicalId"])}var m=j.length;for(var r=0;r<m;r++){var v=j[r];x.push(v)}var y="/resources/accessRightServices/ar/getAttributesForAccessRights";var p=x;this._post2(y,p,function u(n){o(n)},function k(n){s(n)})},_fillModels:function(m){var o=this;var l=m.length;for(var j=0;j<l;j++){var n=m[j];if(n===null){continue}var k=o._getModel(n.physicalId);if(k==null){continue}o.IdToECMap[n.physicalId]=n.v_IsEmbeddedComponent;o.SelectedItemsMap[n.physicalId]=n;o.SelectedItemsTypeMap[n.type]=n;k.setPOV(n.owner+"_PRJ",n.project,n.organization);k.setObjectType(n.type)}o.SelectedItems=m.splice(0);if(false==o._bInitDatas){o._getEmbeddedComponentList(o.SelectedItems)}},_getSecurityContext:function(k,j){b.getInstance().getSecurityContext({onSuccess:function(m){var l="";if(m!=null&&m.SecurityContext!=null){l=m.SecurityContext;if(l.indexOf("ctx::")!=0){l="ctx::"+l}}k(l)},onFailure:function(l){j(l)}})},_post2:function(m,o,n,k){var j=this;datasString=i.encode({requests:o});this._getSecurityContext(function l(q){c.get3DSpaceUrlAsync({onComplete:function(u){var r=u+m;var s={Accept:"application/json"};s["Content-Type"]="application/json";s.SecurityContext=encodeURIComponent(q);var t=c.getTenantID();if(t&&t.length!=0){r+="?tenant="+t}else{r+="?tenant=OnPremise"}g.authenticatedRequest(r,{method:"POST",headers:s,timeout:1000*60*60*24,data:datasString,type:"json",onComplete:function(v){n(v)},onFailure:function(v){k(v)},onTimeout:function(){k("timeout")},})},serverUrl:j.options.serverUrl,wintop:j.options.wintop})},function p(q){k(q)})},_post:function(m,o,n,k){var j=this;this._getSecurityContext(function l(q){c.get3DSpaceUrlAsync({onComplete:function(u){var r=u+m;var s={Accept:"application/json"};s["Content-Type"]="application/json";s.SecurityContext=encodeURIComponent(q);var t=c.getTenantID();if(t&&t.length!=0){r+="?tenant="+t}else{r+="?tenant=OnPremise"}g.authenticatedRequest(r,{method:"POST",headers:s,timeout:1000*60*60*24,data:UWA.Json.encode(o),type:"json",onComplete:function(v){n(v)},onFailure:function(v){k(v)},onTimeout:function(){k("timeout")},})},serverUrl:j.options.serverUrl,wintop:j.options.wintop})},function p(q){k(q)})},_addSelectedIdInList:function(m){var l=this;var j=this.options.serverName;var k=this.options.serverUri;c.get3DSpaceUrlAsync({onComplete:function(s){var q="";var p=c.getRealPath("assets/dataRightList.json",l.widget);var o="GET";var n="";if(h==2){n="passport"}if(h==2){q='{ "businessObject": '+i.encode(m)+"}";p=s+"/resources/pno/ownership/logicalaccess";o="POST"}headers={Accept:"application/json",};headers["Content-Type"]="application/json";headers["Accept-Language"]=widget.lang;l.RightList=[];var r=c.getTenantID();if(r&&r.length!=0){p+="?tenant="+r}else{p+="?tenant=OnPremise"}g.authenticatedRequest(p,{type:"json",method:o,headers:headers,proxy:n,timeout:1000*60*60*24,data:q,onComplete:function(t){l._onCompleteRightList(t,m)},onFailure:function(t,u,v){l._onFailure(t,u,v)},onTimeout:function(){l._onTimeout()}})},serverUrl:l.options.serverUrl,wintop:l.options.wintop})},_onFailure:function(j,k,m){var l=this;var n={};if(k!=null&&k.hasOwnProperty("error")){n=k.error}else{n={message:UWA.i18n("UnknownError"),code:"ERROR"}}l.dispatchEvent("onError",n)},_onTimeout:function(){var j=this;var k={message:UWA.i18n("ErrorTimeOut"),code:"TO"};j.dispatchEvent("onError",k)},_onCompleteRightList:function(n,m){var l=this;if(n.success==true){var q={Accept:"application/json",};q["Content-Type"]="application/json";l.RightList=[];var o=c.getRealPath("assets/dataUserStandAlone.json",l.widget);var k="GET";var j="";var p="";if(h==2){j="passport"}c.get3DSpaceUrlAsync({onComplete:function(s){if(h==2){var r=l.options.serverName;var t=l.options.serverUri;p='{ "businessObject": '+i.encode(m)+"}";o=s+"/resources/pno/ownership";k="POST"}var y=n.accessList;var w=null;var u=[];m.forEach(function(A){var B=l._getModel(A.objectID);u.push(B)});var z=-1;var x=-1;y.every(function(C,A){var D=false;u.every(function(F,E){x=E;if(F.getObjectId()==C.objectID){F.setRightList(C.access);D=true;return false}return true});if(D==true&&l.options.uniqueRightList==true){var B=true;if(l.AccessRightModelList.length==0&&A>0&&z>=0){B=l._accessListSame(u[z].getRightList(),C.access)}else{if(l.AccessRightModelList.length>0){B=l._accessListSame(l.AccessRightModelList[0].getRightList(),C.access)}}if(B==false){w={message:UWA.i18n("ErrorDismatchAccessList"),code:""};l.dispatchEvent("onError",w);l.dispatchEvent("onDataLoaded");return false}z=x}return true});if(w==null){q["Accept-Language"]=widget.lang;var v=c.getTenantID();if(v&&v.length!=0){o+="?tenant="+v}else{o+="?tenant=OnPremise"}g.authenticatedRequest(o,{type:"json",method:k,headers:q,proxy:j,data:p,timeout:1000*60*60*24,onComplete:function(A){l._onCompleteDataList(A)},onFailure:function(A,B,C){l._onFailure(A,B,C)},onTimeout:function(){l._onTimeout()}})}},serverUrl:l.options.serverUrl,wintop:l.options.wintop})}else{if(n.hasOwnProperty("error")){l.dispatchEvent("onError",n.error)}}},_getAccessListForIds:function(n){var m=this;var o=[];if(null!=m.SelectedItemsTypeMap){var k=[];k=Object.keys(m.SelectedItemsTypeMap).map(function(p){return m.SelectedItemsTypeMap[p]});k.forEach(function(p){if(null!=p){o.push({objectID:p.physicalId})}})}var j=this.options.serverName;var l=this.options.serverUri;c.get3DSpaceUrlAsync({onComplete:function(u){var s="";var r=c.getRealPath("assets/dataRightList.json",m.widget);var q="GET";var p="";if(h==2){p="passport"}if(h==2){s='{ "businessObject": '+i.encode(o)+"}";r=u+"/resources/pno/ownership/logicalaccess";q="POST"}headers={Accept:"application/json",};headers["Content-Type"]="application/json";headers["Accept-Language"]=widget.lang;m.RightList=[];var t=c.getTenantID();if(t&&t.length!=0){r+="?tenant="+t}else{r+="?tenant=OnPremise"}g.authenticatedRequest(r,{type:"json",method:q,headers:headers,proxy:p,data:s,timeout:1000*60*60*24,onComplete:function(v){m._onCompleteGetAccessListForIds(v,n)},onFailure:function(v,w,x){m._onFailure(v,w,x)},onTimeout:function(){m._onTimeout()}})},serverUrl:m.options.serverUrl,wintop:m.options.wintop})},_onCompleteGetAccessListForIds:function(n,m){var l=this;if(n.success==true){var q={Accept:"application/json",};q["Content-Type"]="application/json";l.RightList=[];var o=c.getRealPath("assets/dataUserStandAlone.json",l.widget);var k="GET";var j="";var p="";if(h==2){j="passport"}c.get3DSpaceUrlAsync({onComplete:function(s){if(h==2){var r=l.options.serverName;var t=l.options.serverUri;p='{ "businessObject": '+i.encode(m)+"}";o=s+"/resources/pno/ownership";k="POST"}var y=n.accessList;var w=null;var u=[];var z=-1;var x=-1;y.every(function(D,A){var B=D.objectID;var E=l.SelectedItemsMap[B];var F=null;if(null!=E){F=E.type}l.AccessRightModelList.every(function(H,G){x=G;if(H.getObjectType()==F){H.setRightList(D.access);itemFound=true;return false}return true});if(itemFound==true&&l.options.uniqueRightList==true){var C=true;if(l.AccessRightModelList.length==0&&A>0&&z>=0){C=l._accessListSame(u[z].getRightList(),D.access)}else{if(l.AccessRightModelList.length>0){C=l._accessListSame(l.AccessRightModelList[0].getRightList(),D.access)}}if(C==false){w={message:UWA.i18n("ErrorDismatchAccessList"),code:""};l.dispatchEvent("onError",w);l.dispatchEvent("onDataLoaded");return false}z=x}return true});if(w==null){q["Accept-Language"]=widget.lang;var v=c.getTenantID();if(v&&v.length!=0){o+="?tenant="+v}else{o+="?tenant=OnPremise"}g.authenticatedRequest(o,{type:"json",method:k,headers:q,proxy:j,data:p,timeout:1000*60*60*24,onComplete:function(A){l._onCompleteDataList(A)},onFailure:function(A,B,C){l._onFailure(A,B,C)},onTimeout:function(){l._onTimeout()}})}},serverUrl:l.options.serverUrl,wintop:l.options.wintop})}else{if(n.hasOwnProperty("error")){l.dispatchEvent("onError",n.error)}}},_getEmbeddedComponentList:function(m){var n=this;var p="";var j=this.options.serverName;var l=this.options.serverUri;var o=this.options.launchTransfer;var k=this.caHeader;c.get3DSpaceUrlAsync({onComplete:function(s){var u="/resources/accessRightServices/ar/getEmbeddedAndAggregatedComponentDataList";var t={Accept:"application/json",};t["content-type"]="application/json";t.SecurityContext=n.securityContext;var x=n.parseDataForRequest(n.SelectedItems);p=c.getRealPath("assets/transferOwnership.json",widget);var y="";var v="GET";var z="";var r="admin=true";if(h==2){p=s+u+"?"+r;z="passport";v="PUT";y=i.encode({requests:x})}var q={requests:x};t["Accept-Language"]=widget.lang;var w=c.getTenantID();if(w){p+="&tenant="+w}g.authenticatedRequest(p,{type:"json",method:v,proxy:z,headers:t,data:y,timeout:3600000,onComplete:function(A){n._listEmbeddedComponent(A)},onFailure:function(A,B,C){n._onFailure(A,B,C)},onTimeout:function(A){n._onTimeout()}})}})},parseDataForRequest:function(k){var m=[];for(var j=0;j<k.length;j++){if(k[j].physicalId!=undefined){var l={id:k[j].physicalId,category:k[j].category};m.push(k[j].physicalId)}}return m},_listEmbeddedComponent:function(j){var o=this;var n=[];if(j.results.length>0){for(var l=0;l<j.results.length;l++){var k=j.results[l];if(false===j.results[l]["EmbeddedComponent"]){o.NonEmbeddedComponentList.push(j.results[l]["physicalId"])}else{if(true===j.results[l]["EmbeddedComponent"]){if(j.results[l]["ECDataNotToTransfer"]==true){var m={physicalId:j.results[l]["physicalId"],project:j.results[l]["project"],organization:j.results[l]["organization"]};o.ErrorExistingECAndAggrItemsMap[j.results[l]["physicalId"]]=m}else{if(j.results[l]["ECDataNotToTransfer"]==false){var m={physicalId:j.results[l]["physicalId"],project:j.results[l]["project"],organization:j.results[l]["organization"]};o.ExistingECItemsMap[j.results[l]["physicalId"]]=m}}}}}}o._bInitDatas=true;o.AccessRightModelList.forEach(function(p){n.push({objectID:p.getObjectId(),})});o._getAccessListForIds(n)},_onCompleteDataList:function(k){var j=this;if(k.success==true){k.ownershipVector.forEach(function(l){j.AccessRightModelList.every(function(m){if(m.getObjectId()==l.objectID){m.setDataList(l.ownership);return false}return true})});j.dispatchEvent("onDataLoaded")}else{if(k.hasOwnProperty("error")){j.dispatchEvent("onError",k.error)}}},modifyDataWithSC:function(v,r,j){var t=this;var l={Accept:"application/json"};l["Content-Type"]="application/json";if(j!=null&&j!=""&&j.hasOwnProperty("SecurityContext")){var s="";if(j.SecurityContext.indexOf("ctx::")!=0){s="ctx::"}l.SecurityContext=encodeURIComponent(j.SecurityContext)}else{var p={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};t.dispatchEvent("onError",p);return}var w=t.getAggrItemList();if(v.length>0&&w!=null){var q=[];var u=Object.keys(w);if(v.length>0){u.forEach(function(x){var y={objectID:x,ownership:v[0].ownership};q.push(y);v.push(y)})}}var k=this.options.serverName;var m=this.options.serverUri;var o=[];for(var n=0;n<r.length;n++){if(o.indexOf(r[n])<0){o.push(r[n])}}c.get3DSpaceUrlAsync({onComplete:function(E){var D="POST";var y="";var B=c.getRealPath("assets/validModification.json",t.widget);var A=i.encode({requests:o});if(h==2){y="passport"}var z="";var x="/resources/accessRightServices/ar/getCompletedData";if(h==2){B=E+x;D="POST"}l["Accept-Language"]=widget.lang;var C=c.getTenantID();if(C&&C.length!=0){B+="?tenant="+C}else{B+="?tenant=OnPremise"}g.authenticatedRequest(B,{type:"json",method:D,proxy:y,headers:l,data:A,timeout:1000*60*60*24,onComplete:function(H){if(null!=H.results[0].invalidList&&H.results[0].invalidList.length>0){var F=[];F=H.results[0].invalidList;F.forEach(function(J){if(undefined!==t.SelectedItemsMap[J]&&null!==t.SelectedItemsMap[J]){t.ErrorExistingECAndAggrItemsMap[J]=t.SelectedItemsMap[J]}for(var I=0;I<v.length;I++){if(v[I].objectID===J){v.splice(I,1)}}})}else{if(null!=H.results[0].validList&&H.results[0].validList.length>0){var G=[];G=H.results[0].validList;expandedOwnershipItems=[];G.forEach(function(I){if((undefined==t.SelectedItemsMap[I]||null===t.SelectedItemsMap[I])&&(undefined==t.AggrItemsMap[I]||null===t.AggrItemsMap[I])){if(v.length>0){expandedOwnershipItems.push({objectId:I,ownership:v[0].ownership})}}});expandedOwnershipItems.forEach(function(I){v.push(I)})}}t.getAndAddAggregatedItemsForUpdate(v,j)},onFailure:function(F,G,H){t._onFailure(F,G,H)},onTimeout:function(){t._onTimeout()},})},serverUrl:t.options.serverUrl,wintop:t.options.wintop})},getAndAddAggregatedItemsForUpdate:function(s,j){var r=this;var p=[];for(var n=0;n<r.NonEmbeddedComponentList.length;n++){if(p.indexOf(r.NonEmbeddedComponentList[n])<0){p.push(r.NonEmbeddedComponentList[n])}}var l={Accept:"application/json"};l["Content-Type"]="application/json";if(j!=null&&j!=""&&j.hasOwnProperty("SecurityContext")){var q="";if(j.SecurityContext.indexOf("ctx::")!=0){q="ctx::"}l.SecurityContext=encodeURIComponent(j.SecurityContext)}else{var o={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(o);return}var k=this.options.serverName;var m=this.options.serverUri;c.get3DSpaceUrlAsync({onComplete:function(z){var y="GET";var u="";var w=c.getRealPath("assets/validModification.json",r.widget);if(h==2){u="passport"}var t="/resources/accessRightServices/ar/getAggrList";if(h==2){w=z+t;y="PUT"}var v=i.encode({requests:p});l["Accept-Language"]=widget.lang;var x=c.getTenantID();if(x&&x.length!=0){w+="?tenant="+x}else{w+="?tenant=OnPremise"}g.authenticatedRequest(w,{type:"json",method:y,proxy:u,headers:l,data:v,timeout:1000*60*60*24,onComplete:function(B){if(null!==B.results.aggrItems&&B.results.aggrItems.length>0){var A=[];A=B.results.aggrItems;expandedOwnershipItems=[];A.forEach(function(C){if(undefined==r.SelectedItemsMap[C.physicalId]||null===r.SelectedItemsMap[C.physicalId]){if(s.length>0){expandedOwnershipItems.push({objectID:C.physicalId,ownership:s[0].ownership})}}});expandedOwnershipItems.forEach(function(C){s.push(C)})}r.commitWithSCPCS(s,j)},onFailure:function(A,B,C){r._onFailure(A,B,C)},onTimeout:function(){r._onTimeout()},})},serverUrl:r.options.serverUrl,wintop:r.options.wintop})},commitWithSCPCS:function(q,m){var l=this;var p={Accept:"application/json"};p["Content-Type"]="application/json";if(m!=null&&m!=""&&m.hasOwnProperty("SecurityContext")){var n="";if(m.SecurityContext.indexOf("ctx::")!=0){n="ctx::"}p.SecurityContext=encodeURIComponent(m.SecurityContext)}else{var o={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(o);return}var j=this.options.serverName;var k=this.options.serverUri;c.get3DSpaceUrlAsync({onComplete:function(x){var w="GET";var r="";var t=c.getRealPath("assets/validModification.json",l.widget);if(h==2){r="passport"}if(h==2){t=x+"/resources/pno/ownership/update"}w="POST";var u='{ "ownershipVector": '+i.encode(q)+"}";console.log("<<<<<<<<<<< Data to send = "+u);var s={ov:q};l.dispatchEvent("fireWintopNotif",s);p["Accept-Language"]=widget.lang;var v=c.getTenantID();if(v&&v.length!=0){t+="?tenant="+v}else{t+="?tenant=OnPremise"}g.authenticatedRequest(t,{type:"json",method:w,proxy:r,headers:p,data:u,timeout:1000*60*60*24,onComplete:function(y){if(true===l._options.odtMode){if(null!==l.options.parent){l.options.parent.ODTModificationComplete(y)}}else{l.dispatchEvent("onModificationComplete",y)}},onFailure:function(y,z,A){l._onFailure(y,z,A)},onTimeout:function(){l._onTimeout()},})},serverUrl:l.options.serverUrl,wintop:l.options.wintop})},getSelectedItemList:function(){return this.SelectedItems},getErrorSelectedItemList:function(){return this.ErrorExistingECAndAggrItemsMap},getAggrItemList:function(){return this.AggrItemsMap}});return e});define("DS/AccessRightWidget/AccessRightWidget",["UWA/Core","UWA/Controls/Input","UWA/Controls/Abstract","UWA/Json","DS/WAFData/WAFData","DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant","DS/ErrorWidget/ErrorWidget","DS/DataGridWidget/DataGridWidget","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WarningWidget/WarningWidget","DS/AccessRightWidget/AccessRightController","DS/AccessRightWidget/Map","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Spinner","DS/UIKIT/Input/ButtonGroup","DS/Logger/Logger","DS/WebToWinInfra/WebToWinCom","css!DS/AccessRightWidget/AccessRightWidget.css","i18n!DS/AccessRightWidget/assets/nls/langAR"],function(a,y,x,q,d,f,w,A,D,b,n,B,p,g,o,r,l,u,C,m,c,z){UWA.debug=true;var e=b.getProdLevel();var t="AR_MasterContain";var j="AccessRightWidget";var s="/resources/accessRightServices/ar/completeInput";var v="/resources/accessRightServices/ar/completeInputPCS";var k=false;var i=true;var h=x.extend({defaultOptions:{className:"",ForbiddenChar:'"#$@%*,?\\<>[]|:',setRefreshButton:false,setValidButton:true,setCloseButton:true,showTopBar:true,wintop:false,topClassHeight:t,readOnly:"auto",displayWarningForAutoRO:false,serverName:"",serverUri:"",activeMultisel:i,activeComment:k,serverUrl:""},init:function(G,E,F){this._parent(F);if(this.options.wintop==true){this.webToWinCom_Socket=m.createSocket({socket_id:"webinwinAccessRights_socket_"+Math.floor((Math.random()*100000)+1)});if(typeof this.options.serverUrl!=="undefined"&&this.options.serverUrl.length>0){if(typeof this.options.serverUrl[0].platformId!=="undefined"){var H=this.options.serverUrl[0].platformId;b.setTenantID(H)}}}this.isODT=false;if(typeof this.options!==undefined&&this.options!==null){if(this.options.hasOwnProperty("odtmode")){this.isODT=this.options.odtmode}}e=b.getProdLevel();this.options.activeMultisel=this.options.activeMultisel||b.isMultiSelODT();this.options.activeComment=this.options.activeComment||b.isCommentODT();this._initDataStructures();this.isReadOnly=false;this.listID=[];this.listOfIds=[];this.arDone=false;if(this.options.readOnly===true){this.isReadOnly=true}this.widget=G;this.parentWidget=E;this.initUI()},_initDataStructures:function(){this.objectIds={};this.listOfError=[];this.SelectedItemsWithEC=[];this.ctxObjectIds=[];this.SelectedItems=[];this.dumpSection=null;this.firstInit=true;this.addUserMultipleSelection=false;this.arDone=false;this._bAddUserError=false;this.listInputErrors=[];this.listInvalidPovOwnerErrorMsg=[];this.listInvalidPovCollabSpaceErrorMsg=[];this.containsInheritedAccess=false;this.csoTableLines=[]},createWebInWinSocket:function(F){var E=m.createSocket({socket_id:F+Math.floor((Math.random()*100000)+1)});return E},fireWintopCommand:function(F,H,E){var M=this;var G=E+"\n";var L="";if("onModificationAccessRights"===E){var J=null;if(H.hasOwnProperty("ov")){J=H.ov}J.forEach(function(Q,P){if(Q.hasOwnProperty("ownership")){var N=Q.objectID;L=N;var O=Q.ownership;O.forEach(function(T,U){var S=T.operation;var R=T.access.logical;var V;if(T.owner.hasOwnProperty("person")){V=T.owner.person.personID}else{if(T.owner.hasOwnProperty("collabSpace")){V=T.owner.collabSpace.collabSpaceID}}G=G+" "+S+" "+R+" "+V+"\n"})}})}else{if("onModificationAccessRightsSuccess"===E){}}var K={severity:"warning",ID:L,message:G};var I=m.createJSONArrayMessage(E,K);if(I.length>0){F.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayMessageODT",notif_parameters:I},"lf_web_in_win")}else{}},onResize:function(){this.resizeSearchLine();this.csoTable.resizeTable();this.table.resizeTable()},postResize:function(H){var G=this.globalDiv.getSize();var E=this.tableSearch.getSize();var F={height:H-E.height};this.tableContainer.setStyle("height",F.height+"px");if(this.table!=null){this.table.updateScroller(G.width)}if(this.csoTable!=null){this.csoTable.updateScroller(G.width)}},initData:function(F){var G=this;var E={wintop:G.options.wintop,serverUrl:G.options.serverUrl};n.getInstance(E).getSecurityContext();this.SelectedItems=[];this._initDataStructures();this.AccessRightController.onLoad();this.addDataPCS(F)},initDatafromWin:function(E){var F=this;F.initData(E)},getBottomBar:function(){return this.getTopBar()},isPovOwner:function(E,H){if(H.hasOwnProperty("person")){var G=H.person.personID;var F=this.AccessRightController.isPovOwner(E,G);console.log("IsPovOwner.... of "+E+"---- Selected Person "+G+"/n");return F}return false},isPovCollabSpace:function(E,G){if(G.hasOwnProperty("collabSpace")&&G.hasOwnProperty("organization")){var I=G.collabSpace.collabSpaceID;var H=G.organization.orgID;var F=this.AccessRightController.isPovCollabSpace(E,I,H);return F}return false},isPovUserGrp:function(F,H){if(H.hasOwnProperty("group")){var E=H.group.groupURI;var G=this.AccessRightController.isPovUserGroup(F,E);return G}else{if(H!==null&&H.hasOwnProperty("userGrp")){var E=H.userGrp.id;var G=this.AccessRightController.isPovUserGroup(F,E)}return G}return false},validateNotPovOwner:function(E,G,H,I){if(this.isPovOwner(E,G)){var F=G.person.personFullName;var J=UWA.i18n("povOwner").format(F);I(J)}else{H()}},validateNotPovCollabSpace:function(E,F,G,H){if(this.isPovCollabSpace(E,F)){var J=F.organization.orgID+" / "+F.collabSpace.collabSpaceID;var I=UWA.i18n("povCollabSpace").format(J);H(I)}else{if(this.isPovUserGrp(E,F)){var I=UWA.i18n("povCollabSpace").format(J);H(I)}else{G()}}},validateNotPovUserGrp:function(E,F,G,H){if(F.hasOwnProperty("userGrp")){F.group={groupURI:F.userGrp.id,groupTitle:F.userGrp.label};delete F.userGrp}if(this.isPovUserGrp(E,F.group.groupURI)){var I=UWA.i18n("povCollabSpace").format(selectedCollabSpace);H(I)}else{G()}},validateInput:function(K,L){var J=this;J._bAddUserError=false;J.listInputErrors=[];J.listInvalidPovOwnerErrorMsg=[];J.listInvalidPovCollabSpaceErrorMsg=[];var I=J.searchWidget.getNewOwner();var F=J.AccessRightController.getSelectedItemList();var H=F.length;for(var G=0;G<H&&J._bAddUserError===false;G++){var E=F[G].physicalId;J.validateNotPovOwner(E,I,function(){J.validateNotPovCollabSpace(E,I,function(){K()},L)},L)}if(J.listInputErrors!=null&&J.listInputErrors.length>0){if(J.listInputErrors.length>0&&J.listInputErrors.length===H){J.setError(J.listInputErrors[0])}}},onRefresh:function(){this.addData()},addData:function(G){var F=this;if(G==null){G=this.SelectedItems}if(this.options.readOnly=="auto"){var E={wintop:F.options.wintop,serverUrl:F.options.serverUrl};n.getInstance(E).getSecurityContext({onSuccess:function(H){F._testAvailability(G,H)},onFailure:function(H){F.setError(H)}})}else{this._addData(G)}},addDataPCS:function(G){var F=this;if(G==null){G=this.SelectedItems}if(this.options.readOnly=="auto"){var E={wintop:F.options.wintop,serverUrl:F.options.serverUrl};n.getInstance(E).getSecurityContext({onSuccess:function(H){F._testAvailability(G,H)},onFailure:function(H){F.setError(H)}})}else{this._addDataPCS(G)}},_addDataPCS:function(K){this._ManageValidButton(false);this.hideMainErrorArea();var I=[];var J=this;if(this.options.activeMultisel==true){if(K!=null){I=K.slice()}b.removeDuplicate(I,function(M){return M.physicalId});I.forEach(function(N){var M=b.arrayContains(J.SelectedItems,N,function(O){return O.physicalId});if(M<0){J.SelectedItems.push(N)}})}else{if(K!=null&&K.length>0){J.SelectedItems=[];J.SelectedItems.push(K[0]);I.push(K[0])}}if(J.SelectedItems.length<=0){J.table.clearAllLine();if(this.options.wintop==true){this.showMainErrorArea(UWA.i18n("NoItemToDisplay"))}else{this.showMainErrorArea(UWA.i18n("NoItemSelected"))}this.hideMainLoadingArea();this.hideMainComponent();J.dispatchEvent("onChangeSize");return}this.displayLoadingArea();this.displayLoadingArea();this.csoTable.clearAllLine();var L=[];var G=J.SelectedItems.length;if(G>0){var F=J.SelectedItems[0];var H=false;var E=F.hasOwnProperty("organization")&&F.hasOwnProperty("project")&&F.hasOwnProperty("owner")&&F.hasOwnProperty("v_IsEmbeddedComponent");if(null!=F&&true==E&&null!=F.organization&&null!=F.owner&&null!=F.project){H=true;this.AccessRightController._fillModels(J.SelectedItems)}else{this.AccessRightController._fillAttributesOfSelectedItems(J.SelectedItems,function(P){for(var O=0;O<P.results.length;O++){var M=P.results[O];for(var N=0;N<J.SelectedItems.length;N++){if(M.physicalId===J.SelectedItems[N]["physicalId"]){J.SelectedItems[N]["owner"]=M.owner;J.SelectedItems[N]["responsibleName"]=M.responsibleName;J.SelectedItems[N]["Revision"]=M.Revision;J.SelectedItems[N]["project"]=M.project;J.SelectedItems[N]["organization"]=M.organization;J.SelectedItems[N]["type"]=M.type;J.SelectedItems[N]["v_IsEmbeddedComponent"]=M["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]}}}J.AccessRightController._fillModels(J.SelectedItems)},function(M){})}}J.csoTable.clearAllLine()},_getSecurityContext:function(F,E){n.getInstance().getSecurityContext({onSuccess:function(H){var G="";if(H!=null&&H.SecurityContext!=null){G=H.SecurityContext;if(G.indexOf("ctx::")!=0){G="ctx::"+G}}F(G)},onFailure:function(G){E(G)}})},TryDeleteItem:function(E){var G=this.createJSONArrayModif();var F=this;if(G.length>0){new B(F.widget,F.container,{className:"warningComponent_AccessRight",message:UWA.i18n("moficationsInProgress"),events:{OnContinue:function(){F.DeleteItem(E)}}})}else{this.DeleteItem(E)}},DeleteItem:function(E){var G=false;var F=this;this.SelectedItems.every(function(I,H){if(I.index==E){G=true;var J=F.AccessRightController.RemoveItem(F.SelectedItems[H].physicalId);F.SelectedItems.splice(H,1);if(J==false){F.addData(F.SelectedItems)}return false}return true});if(G==true){}this.addData();this._manageAccessList()},hideElements:function(H,E){var G=H.getElements(E);var J=G.length;for(var F=0;F<J;F++){var I=G[F];I.hide()}},showElements:function(H,E){var G=H.getElements(E);var J=G.length;for(var F=0;F<J;F++){var I=G[F];I.show()}},OnChangeComboBoxValue:function(F,G,E){},destroy:function(){if(this.searchWidget){this.searchWidget.destroy()}this._parent()},initUI:function(){var J=this;var F=this.container=UWA.createElement("div",{name:t,"data-rec-id":t,"class":t+" "+J.options.className});this.globalDiv=UWA.createElement("div",{"class":"AR_GlobalContain","data-rec-id":"datarecGlobalContain",}).inject(F);var Q="AR_ManageButtonDiv";if(this.options.wintop){Q="AR_ManageButtonDivWintop"}this.ManageButtonDiv=UWA.createElement("table",{"class":Q,"data-rec-id":"datarecManageButtonDiv",html:{}});J.ManageButtonRight=UWA.createElement("td",{"class":"AR_ManageButtonRight","data-rec-id":"datarecManageButtonRight"});J.ManageButtonLeft=UWA.createElement("td",{"class":"AR_ManageButtonLeft","data-rec-id":"datarecManageButtonLeft"});J.loadingArea=new l({visible:false});var E=null;var O=null;J.boutonValid=new o({attributes:{title:UWA.i18n("")},name:"TopButtonValid",value:UWA.i18n("AR_Valid"),className:"default medium AR_buttonTop primary",disabled:true});var K=J.boutonValid.getContent();if(null!=K){K.setAttribute("data-rec-id","boutonValid")}E=new o({attributes:{title:UWA.i18n("AR_Reload"),"data-rec-id":"datarecButtonRefresh"},name:"TopButtonRefresh",value:"",className:"default medium AR_buttonTop",icon:"ccw"});O=new o({attributes:{title:UWA.i18n(""),"data-rec-id":"datarecButtonCancel"},name:"TopButtonCancel",value:UWA.i18n("AR_CloseOverlay"),className:"default medium AR_buttonTop"});J.boutonValid.addEvents({onClick:function(){J._ManageValidButton(false);J.displayLoadingArea();J.modifyDataPCS()}});E.addEvents({onClick:function(){J.onRefresh()}});O.addEvents({onClick:function(){J.table.clearAllLine();J._ManageValidButton(false);J.dispatchEvent("onCancel")}});J.loadingArea.inject(J.ManageButtonRight);if(J.options.setRefreshButton==true){E.inject(J.ManageButtonRight)}if(this.isReadOnly==false&&J.options.setValidButton==true){J.boutonValid.inject(J.ManageButtonRight)}if(J.options.setCloseButton==true){O.inject(J.ManageButtonRight)}J.ManageButtonLeft.inject(this.ManageButtonDiv);J.ManageButtonRight.inject(this.ManageButtonDiv);if(J.options.showTopBar){this.ManageButtonDiv.inject(J.globalDiv)}J.mainInterface=UWA.createElement("div",{"class":"AR_MainInterface","data-rec-id":"datarecMainInterface",}).inject(this.globalDiv).hide();UWA.createElement("div",{"class":"AR_marginCorrector1","data-rec-id":"datarecMarginCorrector",}).inject(this.globalDiv);J.mainLoading=UWA.createElement("div",{"class":"AR_MainLoading","data-rec-id":"datarecMainLoading"}).inject(this.globalDiv);J.mainError=UWA.createElement("div",{"class":"AR_MainError","data-rec-id":"datarecMainError"}).inject(this.globalDiv).hide();J.csoTableContainer=UWA.createElement("div",{"class":"AR_CSOTableContainer","data-rec-id":"datarecinitialItemsList",});J.csoTableContainer.inject(J.mainInterface);J.csoTable=this.createInitialSelectedTable();J.csoTable.inject(this.csoTableContainer);UWA.createElement("div",{"class":"AR_marginCorrector2","data-rec-id":"datarecmarginCorrector2",}).inject(this.mainInterface);J.loadingArea32=new l({visible:true,className:"large"});J.loadingArea32.inject(J.mainLoading);var N=null;N=new o({attributes:{title:UWA.i18n("AR_AddUser")},value:"",name:"addUserButton",className:"default medium AR_addUser",icon:"user-add"});N.getContent().setAttribute("data-rec-id","dataRecAddUser");N.elements.icon.setAttribute("data-rec-id","dataRecAddUserIcon");N.addEvents({onClick:function(){J.validateInput(function S(){J.AddUser();J._bAddUserError=false;J.dispatchEvent("onChangeSize");J._ManageValidButton(true)},function T(V){J.searchWidget.clearInput();if(false===J._bAddUserError){var U={code:"",message:V};J.setError(U)}if(false===J._bAddUserError){J._bAddUserError=true}});J.searchWidget.clearInput()}});var H="auto";J.selectRightNewUser=new r({nativeSelect:true,placeholder:false});J.selectRightNewUser.elements.container.setAttribute("data-rec-id","dataRecselectRightNewUserContainer");J.selectRightNewUser.elements.content.setAttribute("data-rec-id","dataRecselectRightNewUser");J.TextComment=new y.Text({text:"",className:"AR_commentText",attributes:{placeholder:UWA.i18n("PutComments"),}});J.TextComment.elements.container.setAttribute("data-rec-id","dataRecComments");var G=J.options.ForbiddenChar;var I="";var M=this.options.wintop;if(M){J.searchWidget=f.getSearchWidget(f.FULL,{className:"searchPeople_AccessRights",ForbiddenChar:G,MaxNumber:"5",MaxSize:"300",topClassHeight:J.options.topClassHeight,position:H,serverName:this.options.serverName,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,exttype:w.EXTTYPE_USERGRP,showEmptyCategory:false,events:{onValid:function(){J.searchRight.show();J.searchAdd.show();if(J.options.activeComment==true){J.searchComment.show()}J.dispatchEvent("onChangeSize");J.resizeSearchLine()},onUnvalid:function(){J.searchRight.hide();J.searchAdd.hide();if(J.options.activeComment==true){J.searchComment.hide()}J.dispatchEvent("onChangeSize");J.resizeSearchLine()},onError:function(S){J.setError(S)}}})}else{J.searchWidget=f.getSearchWidget(f.RESTRICTED,{className:"searchPeople_AccessRights",ForbiddenChar:G,MaxNumber:"5",MaxSize:"300",wintop:this.options.wintop,topClassHeight:J.options.topClassHeight,position:H,serverName:this.options.serverName,serverUri:this.options.serverUri,exttype:w.EXTTYPE_USERGRP,events:{onValid:function(){J.searchRight.show();J.searchAdd.show();if(J.options.activeComment==true){J.searchComment.show()}J.dispatchEvent("onChangeSize");J.resizeSearchLine()},onUnvalid:function(){J.searchRight.hide();J.searchAdd.hide();if(J.options.activeComment==true){J.searchComment.hide()}J.dispatchEvent("onChangeSize");J.resizeSearchLine()},onError:function(S){J.setError(S)}}})}J.tableSearch=UWA.createElement("table",{name:"AR_TableSearch","class":"AR_TableSearch table","data-rec-id":"datarecTableSearch",html:""});var L=new UWA.createElement("tbody").inject(J.tableSearch);var P=UWA.createElement("tr",{"class":"AR_DivSearch","data-rec-id":"datarecDivSearch"});var R=UWA.createElement("td",{name:"SearchInputCell","class":"AR_SearchInputColumn AR_SpanNew","data-rec-id":"datarecSearchInputCell",html:""});J.searchWidget.inject(R);J.searchRight=UWA.createElement("td",{"class":"AR_NewSelectRightColumn AR_SpanNew","data-rec-id":"datarecSelectRightColumnSpanNew",html:""}).hide();J.selectRightNewUser.inject(J.searchRight);J.searchAdd=UWA.createElement("td",{"class":"AR_AddUserColumn AR_SpanNew","data-rec-id":"datarecAddUserColumnSpanNew",html:""}).hide();N.inject(J.searchAdd);if(J.options.activeComment==true){J.searchComment=UWA.createElement("td",{"class":"AR_NewComment AR_SpanNew","data-rec-id":"datarecNewCommentColumnSpanNew",html:""}).hide();J.TextComment.inject(J.searchComment)}R.inject(P);J.searchRight.inject(P);if(J.options.activeComment==true){J.searchComment.inject(P)}J.searchAdd.inject(P);P.inject(L);this.moreButton=new UWA.createElement("a",{html:UWA.i18n("More")+"&rsaquo;","class":"AR_advancedSwitch","data-rec-id":"datarecMoreAdvancedSwitchSpanNew",name:"AR_AdvButton",events:{click:function(S){J.moreButton.hide();J.lessButton.show();J.currentMode=J.lessButton;J.manageAdvancedMode();J.dispatchEvent("onAdvancedMode")}}});this.lessButton=new UWA.createElement("a",{html:"&lsaquo;"+UWA.i18n("Less"),"class":"AR_advancedSwitch","data-rec-id":"datarecLessAdvancedSwitchSpanNew",name:"AR_SimpleButton",events:{click:function(S){J.lessButton.hide();J.moreButton.show();J.currentMode=J.moreButton;J.manageAdvancedMode();J.dispatchEvent("onSimpleMode")}}}).hide();if(this.isReadOnly==false){J.tableSearch.inject(J.mainInterface)}this.tableContainer=UWA.createElement("div",{"class":"AR_tableContainer","data-rec-id":"datarectableContainer",});J.table=J.createTable();J.table.inject(this.tableContainer);this.tableContainer.inject(J.mainInterface);J.errorOverlay=new A(J.widget,J.container,{className:"errorComponent_AccessRight","data-rec-id":"datarecErrorComponentAccessRight",});this.AccessRightController=new p(J.widget,{uniqueRightList:!this.isReadOnly,serverName:this.options.serverName,wintop:this.options.wintop,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,isReadOnly:this.isReadOnly,odtMode:this.isODT,parent:this,events:{onError:function(S){J.hideFailMainLoadingArea();J.addError(S)},onDataLoaded:function(){if(J.container.getParent()!=null){J.hideMainLoadingArea();var T=J.AccessRightController.getFormattedRightList();J.selectRightNewUser.add(T,true);if(T.length>0){J.selectRightNewUser.setValue(T[0])}var W=J.selectRightNewUser.elements.container.childNodes;var U=W[0].childNodes;if(!U.forEach){var S=Array.prototype.slice.call(U);S.forEach(function(Y,X){Y.setAttribute("data-rec-id","dataRecComboRightsValue"+X)})}else{U.forEach(function(Y,X){Y.setAttribute("data-rec-id","dataRecComboRightsValue"+X)})}var V=J.AccessRightController.getFusionOwnership();J.AddDataInTable(V);J.AddSelectedItemsInTable();J.searchWidget.setSelectedItemList(J.AccessRightController.getCurrentSelectedItems());if(J.firstInit===true){J.dispatchEvent("onFirstBuild");J.firstInit=false}}},onModificationComplete:function(U){var T=J.table.getAllLine();for(var V=0;V<T.length;V++){var S=T[V];var X=J.table.getCellContent(S,"Id");if(X==null||X==""){continue}var W=J.table.getCellValue(S,"ComboRights");J.getOwnerElementFromID(X).InitRights=W}J.hideLoadingArea();J.showNotificationInTable(U);J.dispatchEvent("onModification");J.addErrorAfterOperation(J,U);J._ManageValidButton(false)},fireWintopNotif:function(S){if(J.options.wintop===true){J.fireWintopCommand(J.webToWinCom_Socket,S,"onModificationAccessRights")}}}});this._ManageValidButton()},_updateReadOnlyDisplay:function(){if(this.isReadOnly==true){if(this.tableSearch!=null){this.tableSearch.hide()}if(this.boutonValid!=null){this.boutonValid.hide()}}else{if(this.tableSearch!=null){this.tableSearch.show()}if(this.boutonValid!=null){this.boutonValid.show()}}},_ManageValidButton:function(E){var G=this.createJSONArrayModif();var F=E;if(E==null||typeof E===undefined){if(G.length>0){F=true}else{F=false}}if(F){this.boutonValid.setDisabled(false)}else{this.boutonValid.setDisabled(true)}},getTopBar:function(){return this.ManageButtonDiv},resizeSearchLine:function(){if(this.tableSearch!=null){var G=this.tableSearch.getElements("td");G.forEach(function(H){var I=H.getStyle("display");if(I!="none"){H.setStyle("display","table-cell")}});var F=this.tableSearch.getSize();var E=this.globalDiv.getSize();if(F.width>E.width){G.forEach(function(H){var I=H.getStyle("display");if(I!="none"){H.setStyle("display","inline-block")}})}}},getNewIDLine:function(){var F=true;var E=this.listID.length;while(F==true){E++;F=false;this.listID.forEach(function(G){if(E==G.Id){F=true}})}return E},getNewIDItem:function(){var F=true;var E=this.SelectedItems.length;while(F==true){E++;F=false;this.SelectedItems.forEach(function(G){if(E==G.index){F=true}})}return E},getOwnershipContainerFromID:function(F){var E=null;this.listID.forEach(function(G){if(F==G.Id){E=G.OwnershipContainer}});return E},getOwnerElementFromID:function(G){for(var E=0;E<this.listID.length;E++){var F=this.listID[E];if(F.Id==G){return F}}return null},getPositionFromId:function(F){var E=null;this.listID.forEach(function(H,G){if(F==H.Id){E=G}});return E},showNotification:function(E){this.errorOverlay.addSuccess(E)},showNotificationInTable:function(O){var K=this;var G=JSON.parse("[]");var I=this.csoTable.getAllLine();var U=I.length;for(var S=0;S<U;S++){if(I[S]!=undefined){G[I[S].getElementsByClassName("Id")[0].innerHTML]=I[S]}}var W=K.AccessRightController.getErrorSelectedItemList();var E=JSON.parse("[]");if(O){if(O.ownershipVector){var N=O.ownershipVector.length;for(var V=0;V<N;V++){var Q=O.ownershipVector[V];if(Q){var H=Q.ownership;var J="access right success";var R=false;if(K.isODT==false){J=z.get("accessRightSuccess")}for(var T=0;T<H.length;T++){var L=H[T];if(L.hasOwnProperty("result")){J="access right failure";if(K.isODT==false){J=L.result.message}R=true;break}}if(!R){if(W[O.ownershipVector[V]["objectID"]]!=null&&G[O.ownershipVector[V]["objectID"]]!=null){J="access right failure";if(K.isODT==false){J=z.get("accessRightFailure")}}}var M="syc-green-circle-symbol";if(R){M="syc-red-circle-symbol"}var F=UWA.createElement("div",{"class":M});var P=G[O.ownershipVector[V]["objectID"]];if(undefined!==P&&null!==P){P.getElementsByClassName("Symbol")[0].appendChild(F);P.getElementsByClassName("Result")[0].innerHTML=J}}}}}},setError:function(E){if(typeof E==="object"){if(E.code==="1500028"){E.message=UWA.i18n("ErrorNotAccessRight")}}this.addError(E)},addError:function(E){this.errorOverlay.displayJSONError(q.encode(E))},hideAllAreas:function(){this.hideLoadingArea();this.hideMainComponent()},displayLoadingArea:function(){this.loadingArea.show()},hideLoadingArea:function(){this.loadingArea.hide()},displayMainInterfaceArea:function(){this.hideAllAreas();if(this.mainInterface!=null){this.mainInterface.show()}if(this.boutonValid!=null){this.boutonValid.show()}},hideMainComponent:function(){this.hideLoadingArea();this.mainInterface.hide();this.boutonValid.hide()},hideMainLoadingArea:function(){this.mainInterface.show();this.boutonValid.show();this.mainLoading.hide();this._updateReadOnlyDisplay()},hideFailMainLoadingArea:function(){this.loadingArea32.hide();this.mainLoading.hide()},hideMainErrorArea:function(){this.mainError.hide()},showMainErrorArea:function(E){if(E!=null&&E!=""){this.clearAllMainError();this.addMainError(E)}this.mainError.show()},addMainError:function(E){new UWA.createElement("div",{text:E}).inject(this.mainError)},clearAllMainError:function(){this.mainError.setContent("")},manageAdvancedMode:function(F){var E=this;if(E.currentMode==E.lessButton){E.showElements(E.mainInterface,".inherit_From");E.showElements(E.mainInterface,".inherit_Access");if(E.options.activeComment==true){E.showElements(E.mainInterface,".Comments")}}else{E.hideElements(E.mainInterface,".inherit_From");E.hideElements(E.mainInterface,".inherit_Access");if(E.options.activeComment==true){E.hideElements(E.mainInterface,".Comments")}}E.resizeTable()},addErrorAfterOperation:function(F,E){if(E.hasOwnProperty("error")){F.setError(E.error)}var G=E.ownershipVector;G.forEach(function(J,I){if(J.hasOwnProperty("ownership")){var H=J.ownership;H.forEach(function(K,L){if(K.hasOwnProperty("result")){F.setError(K.result)}})}})},ownerAlreadyExist:function(E){var F=this;var G=[];var H=false;F.listID.every(function(K,I){var J=K.OwnershipContainer.ownership.owner;var L=K.Id;if(J.hasOwnProperty("person")||E.hasOwnProperty("person")){if(J.hasOwnProperty("person")&&E.hasOwnProperty("person")){if(J.person.personID!=E.person.personID){return true}}else{return true}}if(J.hasOwnProperty("collabSpace")||E.hasOwnProperty("collabSpace")){if(J.hasOwnProperty("collabSpace")&&E.hasOwnProperty("collabSpace")){if(J.collabSpace.collabSpaceID!=E.collabSpace.collabSpaceID){return true}}else{return true}}if(J.hasOwnProperty("organization")||E.hasOwnProperty("organization")){if(J.hasOwnProperty("organization")&&E.hasOwnProperty("organization")){if(J.organization.orgID!=E.organization.orgID){return true}}else{return true}}if(J.hasOwnProperty("group")||E.hasOwnProperty("group")){if(J.hasOwnProperty("group")&&E.hasOwnProperty("group")){if(J.group.groupURI!=E.group.groupURI){return true}}else{return true}}if(J.hasOwnProperty("comment")||E.hasOwnProperty("comment")){if(J.hasOwnProperty("comment")&&E.hasOwnProperty("comment")){if(J.comment==E.comment){H=true}}}G.push({Index:I,Id:L,IsSame:H});return true});return G},modifyDataPCS:function(){var K=this;var J=K.createJSONArrayModif();var L=[];var E=new Array();var H=K.AccessRightController.getSelectedItemList();var G=K.AccessRightController.getErrorSelectedItemList();if(G.length===H.length){return}var F=[];H.forEach(function(M){if(G[M]!=null){return}F.push(M)});F.forEach(function(N,M){var O=new Array();if(N.hasOwnProperty("embeddedComp")){if(N.embeddedComp===true){return}}J.forEach(function(S){var U=S.operation;var T=true;var R=K.AccessRightController.getOwner(N.physicalId,U.owner);var Q=K.AccessRightController.isInherited(N.physicalId,U.owner);var P=K.isPovOwner(N.physicalId,U.owner);if(Q||P){return}if(R!=null){if(S.action=="MODIFY"){if(S.isTrueComment==false){U.owner=R}}else{if(S.action=="ADD"){if(U.owner.comment!=R.comment){O.push({operation:"REMOVE",owner:R,access:{logical:"empty"}})}}else{if(S.action=="REMOVE"){if(S.action=="REMOVE"){if(S.isTrueComment==false){U.owner=R}}}}}}if(T==true){O.push(U)}});E.push(N.physicalId);L.push({objectID:N.physicalId,ownership:O,})});var I={wintop:K.options.wintop,serverUrl:K.options.serverUrl};n.getInstance(I).getSecurityContext({onSuccess:function(M){K.AccessRightController.modifyDataWithSC(L,E,M)},onFailure:function(M){K.setError(M)}})},modifyDataWithSC:function(M,J,E){var L=this;var G={Accept:"application/json"};G["Content-Type"]="application/json";if(E!=null&&E!=""&&E.hasOwnProperty("SecurityContext")){var K="";if(E.SecurityContext.indexOf("ctx::")!=0){K="ctx::"}G.SecurityContext=encodeURIComponent(E.SecurityContext)}else{var I={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(I);return}var F=this.options.serverName;var H=this.options.serverUri;b.get3DSpaceUrlAsync({onComplete:function(P){var N="POST";var V="";var U=b.getRealPath("assets/validModification.json",L.widget);var Q={ownershipVector:M};var S=JSON.stringify(Q);var O=z.get("AR_");var T=q.encode({requests:S});if(e==2){V="passport"}var Q="";if(e==2){U=P+s;N="POST"}L.displayLoadingArea();G["Accept-Language"]=widget.lang;var R=b.getTenantID();if(R&&R.length!=0){U+="?tenant="+R}else{U+="?tenant=OnPremise"}d.authenticatedRequest(U,{type:"json",method:N,proxy:V,headers:G,data:S,onComplete:function(W){L._getCompletedData(W,M,J,E)},onFailure:function(W,X,Y){L._onFailure(W,X,Y)},onTimeout:function(){L._onTimeout()},})},serverUrl:L.options.serverUrl,wintop:L.options.wintop})},_onFailure:function(E,G,J,I,F,K){var H=this;H.hideLoadingArea();if(q.isJson(G)){G=q.decode(G)}var L={};if(G!=null&&G.hasOwnProperty("error")){L=G.error}else{L={message:UWA.i18n("AR_ErrorModification"),code:"ERROR"}}H.setError(L)},_onTimeout:function(){this.hideLoadingArea();var E={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(E)},_testAvailability:function(O,E){var L=this;var G={Accept:"application/json",};G["Content-Type"]="application/json";if(E!=null&&E!=""&&E.hasOwnProperty("SecurityContext")){var K="";if(E.SecurityContext.indexOf("ctx::")!=0){K="ctx::"}G.SecurityContext=encodeURIComponent(E.SecurityContext)}else{var J={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(J);this.isReadOnly=true;this._updateReadOnlyDisplay();this._addDataPCS(O);return}var N=[];var M=O.length;if(M>10){M=10}for(var I=0;I<M;I++){var P=O[I];N.push({objectID:P.physicalId,accessRight:[{access:{physical:"changesov"}}],})}var F=this.options.serverName;var H=this.options.serverUri;b.get3DSpaceUrlAsync({onComplete:function(W){var U="";var T="GET";var R="";var S=b.getRealPath("assets/availability.json",L.widget);if(e==2){R="passport"}if(e==2){S=W+"/resources/pno/ownership/checkaccess";T="POST";U='{ "boAccessRights": '+q.encode(N)+"}"}G["Accept-Language"]=widget.lang;var V=b.getTenantID();if(V&&V.length!=0){S+="?tenant="+V}else{S+="?tenant=OnPremise"}var Q=d.authenticatedRequest(S,{type:"json",method:T,proxy:R,data:U,headers:G,onComplete:function(X){L._onCompleteAvailability(X,O)},onFailure:function(X,Y,Z){L._onFailureAvailability(X,Y,Z,O)},onTimeout:function(){L._onTimeoutAvailability(O)}})},serverUrl:L.options.serverUrl,wintop:L.options.wintop})},_onTimeoutAvailability:function(E){this.isReadOnly=true;this.hideLoadingArea();var F={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(F);this._updateReadOnlyDisplay();this._addDataPCS(E)},_onFailureAvailability:function(E,G,H,F){this.isReadOnly=true;this.hideLoadingArea();var I={};if(q.isJson(G)){G=q.decode(G)}if(G!=null&&G.hasOwnProperty("error")){I=G.error}else{I={message:UWA.i18n("UnknownError"),code:"ERROR"}}this.setError(I);this._updateReadOnlyDisplay();this._addDataPCS(F)},_onCompleteAvailability:function(J,E){var I=this;if(J.success==true){this.isReadOnly=false;var H=0;if(J.hasOwnProperty("boAccessRights")){var G=J.boAccessRights;G.forEach(function(L){if(L.hasOwnProperty("accessRight")){var M=L.accessRight;M.forEach(function(N){if(N.hasOwnProperty("error")){H++;var P=N.error;P.type="warning";var O=UWA.i18n("an object");E.every(function(Q){if(Q.physicalId==L.objectID){if(Q.hasOwnProperty("name")){O=Q.name}}});switch(P.code+""){case"1501603":P.message=UWA.i18n("Bad credential for {0}").format(O);break;case"1501601":P.message=UWA.i18n("Not the owner of {0}").format(O);break;case"1501602":P.message=UWA.i18n("No right on {0}").format(O);break}if(I.options.displayWarningForAutoRO===true){I.addError(P)}C.warn("Access right : "+P.message)}})}});var F=G.length;if(F==H){I.isReadOnly=true;if(E.length>F){I.isReadOnly=false;I.addError(UWA.i18n("ErrorNoAccessToAtLeast10"))}}}I._updateReadOnlyDisplay();I._addDataPCS(E)}else{this.isReadOnly=true;if(J.hasOwnProperty("error")){var K=J.error;I.addError(K)}this.hideMainLoadingArea()}},_manageTableHeader:function(){var E=this.tableContainer.getElement(".AR_mainTableHeader");if(E!==null){if(this.table.allIsHidden()){E.hide()}else{E.show()}}},AddUser:function(){var R=this;var F=R.searchWidget.getNewOwner();if(F===null||F===""){return}var P="";if(F.hasOwnProperty("userGrp")){F.group={groupURI:F.userGrp.id,groupTitle:F.userGrp.label};delete F.userGrp}var W=R.SelectedItems.length;var N=R.selectRightNewUser.getValue();var T="";if(N.length>0){T=N[0]}else{return}var H=R.TextComment.getValue();if(H!=null&&H!=""){F.comment=H}var G=this.ownerAlreadyExist(F);var K="";if(G.length>0){var E=true;var O=false;var Q=G[0];var I=false;G.forEach(function(Y){var X=R.table.getCellsContent({Id:Y.Id},"ComboRights");if(X.length!=0&&X[0]!=null&&X[0]!=""){I=true}if(Y.IsSame==true){Q=Y}});if(I==false){O=true;var S=this.getOwnerElementFromID(Q.Id).InitRights;if(Q.IsSame==false){O=false;if(S.length==0||S[0]==null||S[0]==""){O=true}E=false}else{if(S.length!=0&&S[0]!=null&&S[0]!=""){K=S[0]}}}if(O==true){this.table.removeLine({Id:Q.Id});this.listID.splice(Q.Index,1);E=false}if(E==true){var L=R.getNameUserFromOwner(F);var U={code:"",message:L.name+" "+UWA.i18n("alreadyExists")};this.listInputErrors.push(U);return}}var M={InitRights:K,operation:"ADD",owner:F,access:{logical:T}};var J={ownership:M,isTrueComment:true,isTrueInheritedPath:true};var V=R.AddOwnershipInTable(J);if(V!=null){R.table.AddDataInTable(V);R.manageAdvancedMode()}this._manageTableHeader();this._ManageValidButton();this.onResize();this.addUserMultipleSelection=true},DeleteUser:function(F){var H=parseInt(F);var G=this.getOwnerElementFromID(H).InitRights;if(G.length==0||G[0]==null||G[0]==""){this.table.removeLine({Id:H});var E=this.getPositionFromId(H);this.listID.splice(E,1)}else{this.table.HideLine({Id:H},true);this.table.clearCell({Id:H},"ComboRights")}this._manageTableHeader();this._ManageValidButton(true)},getNameUserFromOwner:function(E){var H=null;var F="";var G=-1;if(E.hasOwnProperty("person")){F=E.person.personLastName+" "+E.person.personFirstName;G=1}else{var I=false;if(E.hasOwnProperty("organization")){I=true;F=E.organization.orgID}if(E.hasOwnProperty("collabSpace")){if(I==true){F+=" / "}F+=E.collabSpace.collabSpaceID}if(E.hasOwnProperty("group")){F=E.group.groupTitle}G=2}if(G>0){H={name:F,type:G}}return H},createInitialSelectedTable:function(){var H=this;var K,G,L,F,J,E;if(H.isODT==true){K="Title";G="Revision";L="Organization";F="Collaborative Space";J="Responsible";E="Result";var I=new D([{text:"PhysicalID",dataIndex:"Id",sortKey:function(M){return M},sortable:true},{text:"",dataIndex:"Symbol",sortKey:function(M){return M},sortable:true},{text:K,dataIndex:"Title",sortKey:function(M){return M},sortable:true},{text:G,dataIndex:"Revision",sortKey:function(M){return M},sortable:true},{text:L,dataIndex:"Organization",sortKey:function(M){return M},defaultSort:true,sortable:true},{text:F,dataIndex:"CollaborativeSpace",sortKey:function(M){return M},defaultSort:true,sortable:true},{text:J,dataIndex:"Responsible",sortKey:function(M){return M},defaultSort:true,sortable:true},{text:E,dataIndex:"Result",sortKey:function(M){return M},sortable:true}],{className:"AR_csoTable",activeSelection:false,setScroller:true,useNativeScroller:true,maxHeightScroller:""});I.getContent().setAttribute("data-rec-id","dataRecInitialSelectedGridAccess");return I}else{var I=new D([{text:"PhysicalID",dataIndex:"Id",sortKey:function(M){return M},sortable:true},{text:"",dataIndex:"Symbol",sortKey:function(M){return M},sortable:true},{text:UWA.i18n(z.get("AR_Title")),dataIndex:"Title",sortKey:function(M){return M},sortable:true},{text:UWA.i18n(z.get("AR_Revision")),dataIndex:"Revision",sortKey:function(M){return M},sortable:true},{text:UWA.i18n(z.get("AR_Sum_Org")),dataIndex:"Organization",sortKey:function(M){return M},defaultSort:true,sortable:true},{text:UWA.i18n(z.get("AR_Sum_Collab")),dataIndex:"CollaborativeSpace",sortKey:function(M){return M},defaultSort:true,sortable:true},{text:UWA.i18n(z.get("AR_Sum_Resp")),dataIndex:"Responsible",sortKey:function(M){return M},defaultSort:true,sortable:true},{text:UWA.i18n(z.get("AR_Result")),dataIndex:"Result",sortKey:function(M){return M},sortable:true}],{className:"AR_csoTable",activeSelection:false,setScroller:true,useNativeScroller:true,maxHeightScroller:""});I.getContent().setAttribute("data-rec-id","dataRecInitialSelectedGridAccess");return I}return I},createSelectedTable:function(){var E=new D([{text:UWA.i18n("Id"),dataIndex:"Id",sortKey:function(F){return F}},{text:"",dataIndex:"AR_IconItem"},{text:"",dataIndex:"AR_SelectedName",sortKey:function(F){return F.getText()},defaultSort:true,sortable:true}],{name:"AR_tableSelected",className:"AR_tableSelected",setHeaderColumn:false,setScroller:false});E.getContent().setAttribute("data-rec-id","dataRecGridAccess");return E},AddInitialSelectedItem:function(G){var E=[];var F=this;G.forEach(function(I,H){E.push(F.createInitialSelNewLineItem(I,H))});F.csoTable.AddDatasInTable(E)},createInitialSelNewLineItem:function(H,F){var G=this;var E=G.getNewIDItem();G.SelectedItemsWithEC[F].index=E;return{Id:E,Symbol:"",Title:H.title,Revision:H.revision,Organization:H.org,CollaborativeSpace:H.project,Responsible:H.owner,Result:"",}},AddSelectedItem:function(G){var E=[];var F=this;G.forEach(function(I,H){E.push(F.createNewLineItem(I,H))});this._manageAccessList()},AddSelectedItemPCS:function(G){var E=[];var F=this;G.forEach(function(I,H){E.push(F.createNewLineItemPCS(I,H))});this._manageAccessList()},createNewLineItem:function(I,F){var H=this;var E=H.getNewIDItem();H.SelectedItemsWithEC[F].index=E;var J="";if(H.SelectedItemsWithEC[F].hasOwnProperty("urlIcon")){J=UWA.createElement("img",{"class":"AR_iconSelectItem",src:H.SelectedItemsWithEC[F].urlIcon,height:15,text:""})}var K="";K=new o({attributes:{title:UWA.i18n("RemoveSelected")},value:"",className:"default xsmall AR_DeleteSelected",icon:"cancel"});K.addEvents({onClick:function(){H.TryDeleteItem(E)}});var G=UWA.createElement("h5",{html:H.SelectedItemsWithEC[F].name});return{Id:E,AR_IconItem:J,AR_SelectedName:G,DeleteItem:K}},createNewLineItemPCS:function(I,F){var H=this;var E=H.getNewIDItem();H.SelectedItems[F].index=E;var J="";if(H.SelectedItems[F].hasOwnProperty("urlIcon")){J=UWA.createElement("img",{"class":"AR_iconSelectItem",src:H.SelectedItems[F].urlIcon,height:15,text:""})}var K="";K=new o({attributes:{title:UWA.i18n("RemoveSelected")},value:"",className:"default xsmall AR_DeleteSelected",icon:"cancel"});K.addEvents({onClick:function(){H.TryDeleteItem(E)}});var G=UWA.createElement("h5",{html:H.SelectedItems[F].name});return{Id:E,AR_IconItem:J,AR_SelectedName:G,DeleteItem:K}},createTable:function(){var H=this;var F="";var E="";if(this.isReadOnly==true){F=this.moreButton;E=this.lessButton}var G="User_CS";if(this.options.wintop){G="User_only"}var I=new D([{text:UWA.i18n("Id"),dataIndex:"Id",sortKey:function(K){return K}},{text:UWA.i18n(G),dataIndex:"UserName",sortKey:function(K){return K.getElement(".AR_UserName").getText()},defaultSort:true,sortable:true},{text:UWA.i18n("AR_Rights"),html:F,dataIndex:"ComboRights",sortKey:function(L){if(H.isReadOnly==true){return L}else{var K="";if(typeof L=="object"){if(L.nodeType===3){K=L.textContent}else{var M=L.getSelection(false);if(M.length>0){K=M[0].attributes[0].value;if(K=="Can Edit"){K="Author"}else{if(K=="Can Read"){K="Reader"}else{if(K=="Can Manage"){K="Owner"}}}}}}return K}},sortable:true},{text:UWA.i18n("InheritedFrom"),dataIndex:"inherit_From",sortKey:function(K){return K},sortable:true},{text:UWA.i18n("InheritedAccess"),html:E,dataIndex:"inherit_Access",sortKey:function(K){return K},sortable:true}],{className:"AR_mainTable",maxHeightScroller:"",setScroller:true});if(H.options.activeComment==true){I.addHeader([{text:UWA.i18n("Comments"),dataIndex:"Comments",sortKey:function(K){if(H.isReadOnly==true){return K}else{return K.getValue()}},sortable:true}])}if(H.isReadOnly==false){var J=new UWA.createElement("span");this.moreButton.inject(J);this.lessButton.inject(J);I.addHeader([{html:J,dataIndex:"Delete",sortKey:function(K){return K}}])}return I},resizeTable:function(){this.table.resizeTable()},createJSONArrayModif:function(){var V=[];if(this.isReadOnly==true){return V}var L=this;var F=L.table.getAllLine();var N=F.length;for(var Q=0;Q<N;Q++){var E=null;var K=null;var G=L.table.getCellContent(F[Q],"Id");if(G==null||G==""){continue}var M=L.getOwnershipContainerFromID(G);E=M.ownership.owner;var O=true;var I=true;if(M.hasOwnProperty("isTrueComment")){O=M.isTrueComment}if(M.hasOwnProperty("isTrueInheritedPath")){I=M.isTrueInheritedPath}var H="";if(L.options.activeComment==true){H=L.table.getCellValue(F[Q],"Comments")}var S=L.getOwnerElementFromID(G).InitRights;var P=L.table.getCellValue(F[Q],"ComboRights");var U=false;if(P==null||P==""){U=true}var J=false;if(S==null||S==""){J=true}var R=false;if(H!=""&&H!=E.comment){R=true}if(J==true&&U==false){if(R==true){E.comment=H}V.push({operation:{operation:"ADD",owner:E,access:{logical:P}},isTrueComment:true,isTrueInheritedPath:true,action:"ADD"})}if(J==false&&U==true){V.push({operation:{operation:"REMOVE",owner:E,access:{logical:"Empty"}},isTrueComment:O,isTrueInheritedPath:I,action:"REMOVE"})}if(J==false&&U==false){if(R==true){var T=q.decode(q.encode(E));T.comment=H;V.push({operation:{operation:"ADD",owner:T,access:{logical:P}},isTrueComment:true,isTrueInheritedPath:true,action:"ADD"})}else{if(P!=S){V.push({operation:{operation:"ADD",owner:E,access:{logical:P}},isTrueComment:O,isTrueInheritedPath:I,action:"MODIFY"})}}}}return V},AddDataInTable:function(G){var F=this;F.table.clearAllLine();F.listID=[];var E=[];G.forEach(function(H,I){var J=F.AddOwnershipInTable(H);if(J!=null){E.push(J)}});F.table.AddDatasInTable(E);if(this.containsInheritedAccess){this.moreButton.click();this.currentMode=F.lessButton}F._manageTableHeader();F.manageAdvancedMode()},AddOwnershipInTable:function(W){var P=q.decode(q.encode(W));var Z=P.ownership;var O=this;var af="";var T=this.getNewIDLine();var Y=null;var G=O.getNameUserFromOwner(Z.owner);if(G!=null){Y=b.getImageUser(G.type,"medium",O.widget);af=G.name}var H=UWA.createElement("div",{html:[Y,{tag:"span","class":"AR_UserName",text:af}]});var V=UWA.createElement("div");var K=UWA.createElement("div");if(Z.hasOwnProperty("inheritedPath")){var J=Z.inheritedPath;if(null!==J&&typeof J!==undefined&&J.length>0){this.containsInheritedAccess=true}J.forEach(function(ah,ag){UWA.createElement("div",{html:" -&nbsp;"+ah.inheritedFrom.objectTNR}).inject(V);if(ah.inheritedAccess.hasOwnProperty("logical")){UWA.createElement("div",{html:" -&nbsp;"+ah.inheritedAccess.logical}).inject(K)}else{if(ah.inheritedAccess.hasOwnProperty("physical")){UWA.createElement("div",{html:" -&nbsp;"+ah.inheritedAccess.physical}).inject(K)}}})}var F="";if(Z.owner.hasOwnProperty("comment")){F=Z.owner.comment}var M=F;if(this.isReadOnly==false){M=new y.Text({value:F,className:"input-tree-label"})}var aa=true;if(P.hasOwnProperty("isAllInherit")){aa=P.isAllInherit}else{if(V.getText()==""){aa=false}}var Q=false;var ae=O.AccessRightController.getSelectedItemList();var ab=ae.length;for(var X=0;X<ab;X++){if(this.isPovOwner(ae[X].physicalId,Z.owner)){Q=true;break}}var ad="";if(!aa&&this.isReadOnly==false&&!Q){ad=new o({attributes:{title:UWA.i18n("RemoveAccess")},value:"",className:"default medium AR_DeleteUser",icon:"cancel"});ad.getContent().setAttribute("data-rec-id","DeleteButton"+T);ad.elements.icon.setAttribute("data-rec-id","DeleteButtonicon"+T);ad.addEvents({onClick:function(){O.DeleteUser(T);O.onResize();O.dispatchEvent("onChangeSize")}})}var L=Z.access.logical;var R=Z.access.logical;var U=L;var S=this.AccessRightController.getFormattedRightList();if(this.isReadOnly==false&&!aa&&!Q){var E=0;S.forEach(function(ah,ag){if(ah.label==L){E=ag}});U=new r({nativeSelect:true,placeholder:false,options:S,events:{onChange:function(){O._ManageValidButton()}}});U.elements.container.setAttribute("data-rec-id","dataRecComboRightsContainer"+T);U.elements.content.setAttribute("data-rec-id","dataRecComboRights"+T);U.select(L);if(Z.hasOwnProperty("InitRights")){R=Z.InitRights}}var N=null;if(aa){var I=z.get("AR_Inherited_Message");U=I}else{if(Q){var I=UWA.i18n("povOwner").format(af);U=I}}var ac={OwnershipContainer:P,InitRights:R,Id:T};O.listID.push(ac);return{Id:T,InitRights:R,UserName:H,ComboRights:U,inherit_From:V.getText(),inherit_Access:K.getText(),Comments:M,Delete:ad}},AddSelectedItemsInTable:function(){var H=this;var E=[];var I=[];E=H.AccessRightController.getSelectedItemList();var F=H.AccessRightController.getErrorSelectedItemList();var G=JSON.parse("[]");E.forEach(function(L){var K=false;if(null!=L&&null!=L.physicalId){if(F[L.physicalId]!=null){K=true}var N="";var J=null;var M="";if(H.isODT==false&&K){N=z.get("accessRightFailure")}if(H.isODT===true&&K){N="access right failure"}if(H.isODT==false&&K){J="syc-red-circle-symbol";M=UWA.createElement("div",{"class":J})}var O={Id:L.physicalId,Title:L.name,Symbol:M,Revision:L.Revision,Organization:L.organization,CollaborativeSpace:L.project,Responsible:L.responsibleName,Result:N};I.push(O)}});H.csoTable.AddDatasInTable(I);H.hideLoadingArea()},ODTModificationComplete:function(E){var F=this;F.hideLoadingArea();if(E.success==true){F.showNotificationInTable(E);F.dispatchEvent("onModification")}else{F.addErrorAfterOperation(F,E)}F._ManageValidButton(false)},ODTGetListOfItemsInTable:function(){var E=this;return E.AccessRightController.getSelectedItemList().length},ODTGetListOfUserItemsInTable:function(){var E=this;return E.table.getAllLine().length}});return h});