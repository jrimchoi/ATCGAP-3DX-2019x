/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/3DPlayUtils/ContextualBar",["DS/WebInfraUI/ContextualBar"],function(a){console.log("WARNING!!! ContextualBar class has been migrated to new module. Please use 'DS/WebInfraUI/ContextualBar' to access it.");return a});define("DS/3DPlayUtils/NavigationArrows",["DS/WebInfraUI/NavigationArrows"],function(a){console.log("WARNING!!! NavigationArrows class has been migrated to new module. Please use 'DS/WebInfraUI/NavigationArrows' to access it.");return a});define("DS/3DPlayUtils/PublishToSwym",["DS/3DPlay/3DPlay","UWA/Class","DS/WebSystem/Environment","DS/WebSystem/Nls","css!3DPlayUtils/PublishToSwym.css"],function(c,a,d,e){var b=a.extend({init:function(g,i){var f;var h=["DS/UIKIT/Modal","DS/SwymPublishForm/script/publish-form-view"];require(h,function(j,l){var k=c.getExperience(g.ctx);if(k){k.getScreenShot({onSuccess:function(o){if(d.isSet("ODT_3DPlay_PanelManager")){require(["DS/CoreEvents/Events"],function(p){p.publish({event:d.get("ODT_3DPlay_PanelManager")})})}else{var m=function(){e.nls("3DPlay/Core",["ShareSwymTitle"],function(r){var t;var s;var v=function(){if(s){s.destroy()}if(t){t.destroy()}};var q={title:"title",description:"description",mode:"base64",base64image:o,onCancel:v,onContentCreated:v};if(f){q.platformId=f}if(window.localStorage["3DPlayHybridApp"]&&window.HybridAppArgs){var u=window.HybridAppArgs.platformServices[0]["3DSwym"];var p=window.HybridAppArgs.tenant;q.platforms=[{id:p,label:"DS - "+p,url:u}]}s=new l(q);t=new j({closable:true,header:r[0],body:s.render("publish_to_sywm_wrapper_id"),className:"publishSwymPanel_3DPlay"});t.inject(document.body);t.show()})};var n=k.args.input.tenantID||k.args.input.asset.tenant;if(n){f=n}m()}},onFail:function(){e.nls("3DPlay/3DPlay","UnableToCreateScreenshot",function(m){c.sendEvent(g.ctx,eventType.notif,notification.error,{msg:m})})}})}},function(k){if(k.requireType=="scripterror"){var j=k.requireModules.join(",");console.error("3DPlay ScripNotFoundError: ",j)}else{console.error(k)}e.nls("3DPlay/Core","ScripNotFoundError",function(l){c.sendEvent(g.ctx,eventType.notif,notification.error,{msg:l})})})},});return b});define("DS/3DPlayUtils/ContextualBarManager",["DS/WebInfraUI/ContextualBarManager"],function(a){console.log("WARNING!!! ContextualBarManager class has been migrated to new module. Please use 'DS/WebInfraUI/ContextualBarManager' to access it.");return a});define("DS/3DPlayUtils/EventDisposer",["DS/WebUtils/EventDisposer"],function(a){console.error("DS/3DPlayUtils/EventDisposer has been moved to DS/WebUtils/EventDisposer of FW WebInfra");console.error("DS/3DPlayUtils/EventDisposer has been moved to DS/WebUtils/EventDisposer of FW WebInfra");return a});define("DS/3DPlayUtils/ConvertService",["UWA/Class","DS/WebSystem/Nls"],function(a,b){return a.extend({init:function(){this.supportedFormats={};var c=0;this.getConversionFormat=function(d){return this.supportedFormats[d]||null};this.clearQueue=function(){c++};this.convert=function(l,n,g,e,s){var r=n.progress;this.subProgressID=r.registerSubProgress();var m=this.subProgressID;var o=n.notifTimeoutID;var k=l;if(Array.isArray(k)===false){k=[k]}var j=function(i){g(i)};var q=0,p=0;var f=function(i){if(i.queueIdx===c){clearTimeout(o);r.advanceToMax(m);q++;delete i.queueIdx;if(q+p===k.length){e(i)}else{s(i)}}};var d=function(t,i){clearTimeout(o);r.advanceToMax(m);p++;g(t,i)};for(var h=0;h<k.length;h++){k[h].queueIdx=c;this._convert(k[h],f,d,n.profiler)}};this._convert=function(d,f,e){console.error("PlayWeb - Something is wrong, _convert is not defined.")}}})});define("DS/3DPlayUtils/FullScreen",["UWA/Class","DS/CoreEvents/Events"],function(b,a){return b.extend({init:function(c,k,s,y){this._parent();var h="none";var r,d;try{var o=window;while(!o.mycontainertoUse&&o.parent&&o!==o.parent){o=o.parent}if(o.mycontainertoUse){c=o.mycontainertoUse}if(o.swyWidgettoUse){y=o.swyWidgettoUse}if(o.mySwymCallBack){k=k||{};o=o.mySwymCallBack;k.onActivate=o.onActivate;k.onDeactivate=o.onDeactivate}}catch(x){}if(k&&k.mode==="HTML5"){var f=true;var n=window;var l=document;var z=n.parent;while(n!==z&&f){var m=z.document;var p=m.getElementsByTagName("iframe");var t,j;for(t=0;t<p.length;t++){j=m.getElementsByTagName("iframe")[t];if(j&&j.contentWindow.document===l){if(!j.getAttribute("allowfullscreen")){f=false}break}}l=m;n=z;z=n.parent}f=f&&(c.requestFullscreen||c.mozRequestFullScreen||c.webkitRequestFullscreen||c.msRequestFullscreen);f=f&&(document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msCancelFullScreen||document.msFullscreenEnabled);if(f){h="html5";d=function(){if(c.requestFullscreen){c.requestFullscreen()}else{if(c.mozRequestFullScreen){c.mozRequestFullScreen()}else{if(c.webkitRequestFullscreen){c.webkitRequestFullscreen()}else{if(c.msRequestFullscreen){c.msRequestFullscreen()}}}}};r=function(){if(document.cancelFullScreen){document.cancelFullScreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else{if(document.msCancelFullScreen){document.msCancelFullScreen()}}}}};var u=function(e){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement&&(s.classList.contains("active")||c.classList.contains("PlayWeb-FullScreen"))){s.removeClassName("active");c.classList.remove("PlayWeb-FullScreen")}else{s.addClassName("active");c.classList.add("PlayWeb-FullScreen")}};document.onfullscreenchange=u;document.onmozfullscreenchange=u;document.onwebkitfullscreenchange=u;document.onmsfullscreenchange=u}}else{if(k&&k.mode==="CUSTOM"&&k.onActivate&&k.onDeactivate&&y&&y.getView){h="custom";d=function(){setTimeout(function(){a.publish({event:"3DPLAY/3DPLAYPREVIEW/ENABLE",data:{}})},500)};r=function(){a.publish({event:"3DPLAY/3DPLAYPREVIEW/DISABLE",data:{}})};var g=function(e){if(y.fullscreen){a.publish({event:"3DPLAY/PLAYFROMCOMPASS/DISABLE",data:{}})}};var q=function(e){if(y.fullscreen){setTimeout(function(){a.publish({event:"3DPLAY/PLAYFROMCOMPASS/ENABLE",data:{}})},500)}};y.addEvent("onHide",g);y.addEvent("onShow",q);y.onViewChange=function(e){if(e.type==="maximized"||e.type==="fullscreen"){a.publish({event:"3DPLAY/FULLSCREEN/ENABLE",data:{}})}else{if(e.type==="windowed"){a.publish({event:"3DPLAY/FULLSCREEN/DISABLE",data:{}})}}};if(k.onViewChange){k.onViewChange(function(e){if(e===true){s.addClassName("active");c.classList.add("PlayWeb-FullScreen")}else{s.removeClassName("active");c.classList.remove("PlayWeb-FullScreen")}})}}else{if(k&&k.mode==="PLATFORM"&&y&&y.getView&&y.requestView){h="platform";var v="none";d=function(){v=y.getView().type;if(v!=="fullscreen"){y.requestView({type:"fullscreen"})}};r=function(){if(v!=="fullscreen"){y.requestView({type:v})}};var g=function(e){if(y.fullscreen){a.publish({event:"3DPLAY/PLAYFROMCOMPASS/DISABLE",data:{}})}};var q=function(e){if(y.fullscreen){setTimeout(function(){a.publish({event:"3DPLAY/PLAYFROMCOMPASS/ENABLE",data:{}})},500)}};y.addEvent("onHide",g);y.addEvent("onShow",q);y.onViewChange=function(e){if(e.type==="maximized"||e.type==="fullscreen"){a.publish({event:"3DPLAY/FULLSCREEN/ENABLE",data:{}})}else{if(e.type==="windowed"){a.publish({event:"3DPLAY/FULLSCREEN/DISABLE",data:{}})}}if(e.type!=="fullscreen"&&s.classList.contains("active")){c.classList.remove("PlayWeb-FullScreen");s.removeClassName("active");if(v!=="fullscreen"){y.requestView({type:v})}if(k.onDeactivate){k.onDeactivate()}}}}}}this.getMode=function(){return h};this.toggle=function(){if(c.classList.contains("PlayWeb-FullScreen")){r();s.removeClassName("active");if(k&&k.onDeactivate){k.onDeactivate()}c.classList.remove("PlayWeb-FullScreen")}else{d();c.classList.add("PlayWeb-FullScreen");if(k&&k.onActivate){k.onActivate()}s.addClassName("active")}}}})});define("DS/3DPlayUtils/UIManager",["UWA/Class","DS/WebUtils/EventDisposer"],function(b,a){return b.extend({init:function(c){this.ActionBarEventArray=new Array();this.ResizeEventArray=new Array();this.PanelEventArray=new Array();this.registerEvents(c)},registerEvents:function(d){var h=d.frameWindow;var c=d.ctx;var e=this;var g=h.getActionBar();if(g){g.onActionBarClose(function(l){if(e&&e.ActionBarEventArray){for(var m=0,k=e.ActionBarEventArray.length;m<k;m++){var n=e.ActionBarEventArray[m];n.addClassName("wux-ui-state-close")}}});g.onActionBarOpen(function(l){if(e&&e.ActionBarEventArray){for(var m=0,k=e.ActionBarEventArray.length;m<k;m++){var n=e.ActionBarEventArray[m];n.removeClassName("wux-ui-state-close");if(n.style.display==="none"){n.style.display="block"}}}})}var f=function(m,k){if(e&&e.PanelEventArray){for(var n=0,l=e.PanelEventArray.length;n<l;n++){var o=e.PanelEventArray[n];if((typeof o)==="object"&&o.customCB){var p=UWA.extend({},m);p.visible=k;o.customCB(p)}else{o.style.display=(k==true)?"none":""}}}};this.EventDisposer=new a();if(h&&h.experience){this.EventDisposer.add(h.experience.subscribe("3DPLAY/RIGHTPANEL/OPEN",function(i){f(i,true)}));this.EventDisposer.add(h.experience.subscribe("3DPLAY/RIGHTPANEL/CLOSE",function(i){f(i,true)}));this.EventDisposer.add(h.experience.subscribe("3DPLAY/RIGHTPANEL/SHOW",function(i){f(i,true)}));this.EventDisposer.add(h.experience.subscribe("3DPLAY/RIGHTPANEL/HIDE",function(i){f(i,false)}))}else{this.EventDisposer.add(WUX.Events.subscribe({event:"/"+c+"3DPLAY/RIGHTPANEL/OPEN"},function(i){f(i,true)}),WUX.Events);this.EventDisposer.add(WUX.Events.subscribe({event:"/"+c+"3DPLAY/RIGHTPANEL/CLOSE"},function(i){f(i,true)}),WUX.Events);this.EventDisposer.add(WUX.Events.subscribe({event:"/"+c+"3DPLAY/RIGHTPANEL/SHOW"},function(i){f(i,true)}),WUX.Events);this.EventDisposer.add(WUX.Events.subscribe({event:"/"+c+"3DPLAY/RIGHTPANEL/HIDE"},function(i){f(i,false)}),WUX.Events)}},dispose:function(){this.ActionBarEventArray=null;this.ResizeEventArray=null;this.PanelEventArray=null;this.EventDisposer.dispose();this.EventDisposer=null},addToActionBarEvent:function(c){c.addClassName("wux-afr-actionbar");this.ActionBarEventArray.push(c)},addToResizeEvent:function(c){this.ResizeEventArray.push(c)},addToPanelEvent:function(e,d){var c=d!==undefined?{div:e,customCB:d}:e;this.PanelEventArray.push(c)}})});define("DS/3DPlayUtils/VisibilityUtils",["DS/WebSystem/Settings","DS/CoreEvents/Events","DS/WebViewer/SceneGraphHelper"],function(b,a,c){var d={applyVisibilityToAll:function(f,g,e){if(g){for(var h=0;h<g.length;h++){this.applyVisibilityToPath(f,g[h],e)}}},reallyApplyVisibilityToAll:function(g,f,e){if(f){if(!Array.isArray(f)){f=[f]}for(var i=0;i<f.length;i++){var h=f[i].getChildrenPathes();if(h.length!=0){this.reallyApplyVisibilityToAll(g,h,e)}else{this.applyVisibilityToPath(g,f[0],e)}}}},applyVisibilityToPath:function(f,h,e,g){if(g==undefined){g=true}f.setVisibility(h,e,g)},getTransparencyPercentage:function(){var f=11;var e=Math.round(b.get("VisibilitySettings.TransparencySetting",f));if(e<0||e>100){e=f}return e},setTransparencyPercentage:function(e){if(e>=0&&e<=100){b.set("VisibilitySettings.TransparencySetting",e)}else{console.error("Error: Visibility Utilities - Transparency settings value out of range")}},updateTransparencyofObjects:function(e,f,g){if(g==1){this.removeTransparencyFromObjects(e,f)}else{var h=function(i){if(i.length>0){i.forEach(function(l){var k=e.getOpacity(l);if(k!=null&&k<1){e.setOpacity(l,g)}else{var j=l.getChildrenOccurrencePathes();if(j!=undefined&&j!=null){h(j)}}})}};h(f)}},removeTransparencyFromObjects:function(e,f){for(var g=0;g<f.length;g++){var h=f[g];e.setOpacity(h,1,true);e.setPickability(h,"PICKABLE",true)}},applyTransparencyToObjects:function(e,g,j,f,k){if(j==1){this.removeTransparencyFromObjects(e,g)}else{if(k==undefined){k=true}for(var h=0;h<g.length;h++){e.setOpacity(g[h],j,k);if(f!=true){e.setPickability(g[h],"IGNORED",k)}}}},getCurrentSceneGraphState:function(g,f,e){if(!g.sgState){g.sgState=this.createNewSceneGraphStateHelper(g,f,"VisibilitySG")}return g.sgState},createNewSceneGraphStateHelper:function(g,f,e){return g.createSceneGraph(e)},resetCurrentSceneGraphState:function(e){e.sgState=null},setCurrentSceneGraphState:function(f,e){f.sgState=e;f.setCurrentSceneGraphState(f.sgState)},setVisibilityOfAnnotations:function(h,e,g){var f=g||h.getRootNode();f.children.forEach(function(i){if(i.name=="annotGroupNode"){i.setVisibility(e)}})},setVisibilityOfSectionsAndMeasures:function(h,e,g){var f=g||h.getRootNode();if(e){a.publish({event:"3DPLAY/EXPLODE/END"})}else{a.publish({event:"3DPLAY/EXPLODE/START"})}}};return d});define("DS/3DPlayUtils/LeftPanel",["UWA/Core","UWA/Class","DS/Panels/SidePanel","css!DS/3DPlayUtils/LeftPanel"],function(e,a,d,c){var b=a.extend({init:function(o){this.leftPanel=new d({side:"left"}).inject(o.container);var f=new e.Element("div",{id:"MAIN_CONTAINER",styles:{height:this.leftPanel.elements.panel.clientHeight+"px","overflow-y":"scroll"}}).inject(this.leftPanel);var n=new e.Element("div",{id:"SHEET_LIST_CONTAINER"}).inject(f);var j=[];var m=function(q){for(var p=0;p<j.length;p++){var r=j[p];if(r.className.indexOf("selected")>0){r.removeClassName("selected")}}var i=q.target?q.target:q.srcElement;i.addClassName("selected")};for(var h=0;h<o.items.length;h++){var l=o.items[h];var g="Sheet_"+(h+1);var k=new e.Element("div",{id:g,"class":"leftpanel-item",events:{click:l.onClickCB}}).inject(n);k.addEvent("click",m);k.appendText(g);j.push(k)}},dispose:function(){}});return b});define("DS/3DPlayUtils/SpreadGesture",["DS/Visualization/ThreeJS_DS","DS/VisuEvents/ScreenEvent","DS/Gestures/BasicGesture"],function(c,a,d){var b=d.extend({init:function(){this._parent("Spread");this.touches=[];this.fingersVector0_1=new c.Vector2();this.fingersVector1_2=new c.Vector2();this.fingersVector2_0=new c.Vector2();this.latencyTime=30;this.initTime=0;this.distance=null;this.lastDistance=0;this.initDistance=0;this.distanceMin=0;return this},detect:function(e){this.touches=THREEDS.VisuEventsManager.getTouchEventsByStates([a.State.BEGIN,a.State.MOVE,a.State.IDLE],this.view);if(this.touches.length===3){this.fingersVector0_1.subVectors(this.touches[1].currentPosition,this.touches[0].currentPosition);this.fingersVector1_2.subVectors(this.touches[2].currentPosition,this.touches[1].currentPosition);this.fingersVector2_0.subVectors(this.touches[0].currentPosition,this.touches[2].currentPosition);if(this.distance===null){this.distance=this.fingersVector0_1.length()+this.fingersVector1_2.length()+this.fingersVector2_0.length()}this.lastDistance=this.distance;this.distance=this.fingersVector0_1.length()+this.fingersVector1_2.length()+this.fingersVector2_0.length()}switch(this.state){case d.State.INIT:this.distance=null;if(this.touches.length===3){this.preventDefault(this.touches);this.initTime=new Date().getTime();this.initDistance=this.distance;this.changeState(d.State.BEGIN)}break;case d.State.BEGIN:if(this.touches.length===3){this.events=this.touches;this.preventDefault(this.events);this.changeState(d.State.CHANGE)}else{this.changeState(d.State.KO)}break;case d.State.CHANGE:if(this.touches.length===3){this.events=this.touches;this.preventDefault(this.events);this.changeState(d.State.CHANGE)}else{this.changeState(d.State.KO)}break;case d.State.KO:case d.State.OK:case d.State.CANCEL:this.changeState(d.State.INIT);this.touches=[];this.distance=null;break;default:break}},preventDefault:function(h){for(var g=0;g<h.length;g++){var e=h[g];var f=e.getJSEvent();if(f.preventDefault){f.preventDefault()}}}});return UWA.namespace("3DPlayModelViewer/SpreadGesture",b)});define("DS/3DPlayUtils/BrowserSupportList",[],function(){return{winphone:{"8.1":{ie:{isSupported:function(a){return BrowserSupport.ok}}}},win:{"default":{version:{isSupported:function(a){try{var b=parseFloat(a);return b===7||b===8||b>=10}catch(c){return false}}},chrome:{isSupported:function(a){if(a<18){return BrowserSupport.partial}return BrowserSupport.ok}},firefox:{isSupported:function(a){if(a<18){return BrowserSupport.partial}return BrowserSupport.ok}},opera:{isSupported:function(a){if(a<18){return BrowserSupport.partial}return BrowserSupport.ok}},ie:{isSupported:function(a){return BrowserSupport.ok}}}},android:{"default":{version:{isSupported:function(a){var b=parseFloat(a);return b>=5}},chrome:{isSupported:function(a){return BrowserSupport.ok}},firefox:{isSupported:function(a){return BrowserSupport.ok}}},"4":{chrome:{isSupported:function(a){if(a<25){return BrowserSupport.partial}return BrowserSupport.ok}},firefox:{isSupported:function(a){if(a<25){return BrowserSupport.partial}return BrowserSupport.ok}}}},macosx:{"default":{version:{isSupported:function(a){try{var b=parseFloat(a);return b>=10.1}catch(c){return false}}},safari:{isSupported:function(a){return BrowserSupport.ok}},chrome:{isSupported:function(a){return BrowserSupport.ok}},firefox:{isSupported:function(a){if(a<18){return BrowserSupport.partial}return BrowserSupport.ok}}},"10.9":{safari:{isSupported:function(a){if(a<600){return BrowserSupport.partial}return BrowserSupport.ok}}}},ios:{"default":{version:{isSupported:function(a){if(a<8){return BrowserSupport.partial}return BrowserSupport.ok}},safari:{isSupported:function(a){if(a<600){return BrowserSupport.partial}return BrowserSupport.ok}},netscape:{isSupported:function(a){return BrowserSupport.ok}}}}}});define("DS/3DPlayUtils/ServiceURL",["UWA/Core"],function(b){var a=function(d){var e=d.logger?d.logger:console;if(!d.onError){e.error("onError required");return}if(!d.onSuccess){e.error("onSuccess required");d.onError();return}if(!d.serviceName){e.error("serviceName required");d.onError();return}if(window.localStorage["3DPlayHybridApp"]){if(!d.myAppsUrl){e.error("myAppsUrl required in hybrid context");d.onError();return}require(["DS/WAFData/WAFData"],function(f){var g=d.myAppsUrl+"/api/v1/services";var h={};h.type="json";h.timeout=25000;h.proxy="none";h.onComplete=function(m){var l,k;for(var o=0;o<m.platforms.length;o++){l=m.platforms[o];if(d.platformId===l.id){for(var n=0;n<l.services.length;n++){k=l.services[n];if(d.serviceName===k.name&&k.url){console.log(k.url);d.onSuccess({url:k.url,platformId:d.platformId});break}}}}};h.onFailure=function(i){d.onError({serviceName:d.serviceName,error:"'/api/v1/services' service error"})};h.onTimeout=function(i){d.onError({serviceName:d.serviceName,error:"'/api/v1/services' service timeout"})};f.authenticatedRequest(g,h)})}else{var c=["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"];require(c,function(f){f.getPlatformServices({platformId:d.platformId,onComplete:function(l){if(l){var m;if(Array.isArray(l)){var k={url:undefined};for(var j=0;j<l.length;j++){var h=l[j];m=h[d.serviceName];if(m){k.url=m;k.platformId=h.platformId;break}}if(k.url){d.onSuccess(k)}else{d.onError({serviceName:d.serviceName})}}else{m=l[d.serviceName];if(m){d.onSuccess({url:m,platformId:d.platformId})}else{if(d.platformId){var g=b.extend({},d);delete g.platformId;d=g}a(d)}}}else{d.onError({serviceName:d.serviceName,error:"Compass Error"})}},onFailure:function(g){e.error(g);d.onError({serviceName:d.serviceName,error:"Compass Error"})}})},function(f){e.error("Unable to Load Module : ",c);e.error(f);d.onError()})}};return a});define("DS/3DPlayUtils/TestBrowser",["DS/3DPlayUtils/BrowserSupportList","DS/WebSystem/DetectBrowser"],function(a,b){return function(){var g=false;var d=document.createElement("canvas");var j;try{j=d.getContext("webgl");if(j){g=true}}catch(h){}if(!j){try{j=d.getContext("experimental-webgl");if(j){console.warn("experimental-webgl");g=true}}catch(h){}}if(g==false){return BrowserSupport.none}if(typeof(Worker)==="undefined"){return BrowserSupport.none}var i=b();var f=a[i.os.name];if(f!==undefined){var k=f[i.os.version];if(k===undefined){k=f["default"];if(k!==undefined&&(k.version===undefined||k.version.isSupported===undefined||k.version.isSupported(i.os.version)===false)){k=undefined}}if(k!==undefined){var c=k[i.browser.name];if(c!==undefined&&c.isSupported!==undefined){return c.isSupported(i.browser.version)}}}return BrowserSupport.partial}});define("DS/3DPlayUtils/XCADSpatialSupport",["UWA/Core","DS/3DPlayUtils/ConvertService","DS/WebSystem/Environment","DS/CSICommandBinder/CSICommandBinder","DS/WebInfraUI/Notification","DS/Logger/Logger","DS/3DPlayUtils/ServiceURL","DS/WAFData/WAFData","DS/WebUtils/ProbesManager"],function(c,b,i,f,j,a,k,g,e){var d="SPAContentOptimizer";var h=undefined;return b.extend({init:function(o){this._parent();this.logger=a.getLogger("DS/3DPlay/XCADSpatialSupport");this._exp=o;var n,l;c.extend(this.supportedFormats,{asat:"3dxml",asab:"3dxml",catdrawing:"svg",catpart:"3dxml",catproduct:"asm",cgm:"svg",dwg:"svg",dxf:"svg",exp:"3dxml",gml:"3dxml",ifc:"3dxml",ifczip:"3dxml",iges:"3dxml",igs:"3dxml",ipt:"3dxml",jt:"3dxml",model:"3dxml",p_b:"3dxml",p_t:"3dxml",par:"3dxml",prt:"3dxml",rfa:"3dxml",rvt:"3dxml",sab:"3dxml",sat:"3dxml",sldasm:"3dxml",slddrw:"svg",sldprt:"3dxml",step:"3dxml",stp:"3dxml",tif:"svg",tiff:"svg",x_b:"3dxml",x_t:"3dxml",xmp_bin:"3dxml",xmp_txt:"3dxml",xmt_bin:"3dxml",xmt_txt:"3dxml",vda:"3dxml",xcgm:"3dxml"},true);if(o.extendedXCADSupport){c.extend(this.supportedFormats,o.extendedXCADSupport,true)}if(i.isSet("3DPlay.eDrawingSupport")){c.extend(this.supportedFormats,{dwg:undefined,dxf:undefined,slddrw:undefined,sldprt:undefined,sldasm:undefined},true)}if(i.isSet("3DPlay.ProtoConvertSpatial")){c.extend(this.supportedFormats,{asm:"3dxml",catshape:"3dxml",cgm3d:"3dxml",iam:"3dxml",session:"3dxml"},true)}this._convert=function(q,s,r){if(q._3DPlayDatas&&q._3DPlayDatas.SPAContentOptimizerURL){h=q._3DPlayDatas.SPAContentOptimizerURL;this.logger.debug("XCADSpatialSupport (using host configuration) URL found > ",h);this._startConvert(q,s,r)}else{if(i.isSet("3DPlay.ProtoConvertSpatial")&&i.get("3DPlay.ProtoConvertSpatial")!=="true"){h=i.get("3DPlay.ProtoConvertSpatial");this.logger.debug("XCADSpatialSupport (using envar value) : URL found > ",h);this._startConvert(q,s,r)}else{var t=e.createProbe("getServiceURL");t.begin();if(h===undefined){var p=this;k({serviceName:d,logger:p.logger,platformId:q.tenant,onSuccess:function(u){h=p._returnSpaConvertUri(u.url);p.logger.debug("XCADSpatialSupport : URL found > ",h);t.end();p._startConvert(q,s,r);p=null},onError:function(u){t.end();p.logger.error("Ooops, missing Service : ",u.serviceName);p.logger.error("Reason : ",u.error);var v={rsc:"3DPlay/Core",type:"Convert_SERVICE_NOT_FOUND",level:j.warning};if(p._exp&&p._exp.onModelLoadingError){p._exp.onModelLoadingError(v)}r(v,q);p=null},myAppsUrl:(q._3DPlayDatas&&q._3DPlayDatas.myAppsUrl)?q._3DPlayDatas.myAppsUrl:undefined})}else{t.end();this.logger.debug("XCADSpatialSupport : URL found > ",h);this._startConvert(q,s,r)}}}};this._returnSpaConvertUri=function(q){var p=c.Utils.parseUrl(q);return p.authority+p.directoryPath};var m="Not initialized";this.getServiceUrlAndTicket=function(s,r,p){var q=encodeURIComponent(m).replace(/'/g,"%27").replace(/"/g,"%22");g.authenticatedRequest(s.passportURL+"/login?service="+q,{method:"GET",headers:{Accept:"application/json"},onComplete:function(u){try{var t=JSON.parse(u).access_token;r(m,t)}catch(v){p("Failed to parse ticket");a.error("Failed to parse ticket : "+u)}},onFailure:function(u,t){p("Failed to retrieve ticket");a.error("Failed to retrieve ticket: "+t)}})};this._startConvert=function(u,q,s){var x=this;x.connected=false;this.logger.debug(" XCADSpatialSupport : Starting Convert");var v=e.createProbe("CSI");v.begin();var w=e.createProbe("CSI_Init");w.begin();var z={onHypervisorDisconnect:function(){x.logger.debug("CSIServer Hypervisor Disconnected");if(x.connected){x.connected=false}else{x.logger.error("Unable to connect");s({rsc:"3DPlay/Core",type:"Convert_FILE_NOT_LOADED"},u)}},onHypervisorConnect:function(){x.connected=true;x.logger.debug("CSIServer Connected")},onDisconnect:function(){x.logger.debug("CSIServer Node Disconnected")},authentication:this.getServiceUrlAndTicket.bind(this)};var t=h;if(t===""||t===undefined){z.hypervisorIp=n;z.webSocketPort=l;x.logger.debug("Trying to Connect via IP> "+n);m="https://"+z.hypervisorIp+":"+z.hypervisorPort}else{z.hypervisorUrl=t;z.ssl=true;x.logger.debug("Trying to Connect via hypervisorUrl : "+t);m="https://"+z.hypervisorUrl}var y=f.getPool("application.webWidget");var r=y.createNode(z);var p=null;if(i.get("3DPlay.ProtoConvertSpatialOutsidePlatform")){p=r.select("ContentOptimizer_SPADebug")}else{p=r.select("ContentOptimizer")}if(u.type==="prt"){this._execOpenCmd(u,q,s,r,p)}else{this._execConvertCmd(u,q,s,r,p)}};if(window.localStorage["3DPlayWinApp.3DXML_STP_Only"]){this.supportedFormats={}}},_execOpenCmd:function(q,l,m,r,v){var t,s=this,w=false;var u=function(y){var z=y.readUint8("DocumentType");w=z===2||z===3};var p=function(){setTimeout(function(){if(w&&q.type==="prt"){m({rsc:"3DPlay/Core",type:"Convert_FILE_NOT_LOADED"},q)}else{s._execConvertCmd(q,l,m,r,v)}t.end()},100)};var n=new f.Response();n.onAnswerDomain("OpenResult",p);n.onAnswerDomain("Info",u);var o=r.createRequest({destinationNodeId:v,command:"Open",version:1,onComplete:n});var x=new f.Parameters();x.writeString("InputFileName","DummyName."+(q.format||q.mimetype));x.writeString("InputFileUrl",q.filename);t=e.createProbe("open");t.begin();o.send(null,x,null);iProfilerCSIInit.end()},_execConvertCmd:function(r,m,p,s,v){var t=this;var n=function(B){var C=B.readString("Result");if(C==="Success"){t.logger.debug("Conversion succes");var z=B.readBuffer("File");if(z){var A=new Blob([z]);if(i.isSet("3DPlay.downloadConvertResult")){var y=document.createElement("a");y.download="XCAD-Converted-File."+r.dataFormat;y.innerHTML="Download File";y.href=window.webkitURL.createObjectURL(A);y.click()}m(c.extend(r,{provider:"FILE",filename:window.URL.createObjectURL(A),proxyurl:"none",requiredAuth:null,serverurl:"",originalType:r.type,mimetype:r.dataFormat||r.mimetype,format:r.dataFormat||r.mimetype,type:r.dataFormat||r.mimetype}))}}else{if(!t.onErrorsVisited){t.logger.error("Conversion error");t.logger.error(B);p({rsc:"3DPlay/Core",type:"Convert_ERROR",level:j.fatal},r)}}t.cleaneNode(s);return true};var l=function(C){t.logger.error("Missing Files domain");var z=C.readStringArray("FilePaths");if(z&&("sldasm"!==r.type||"sldasm"!==r.format||"sldasm"!==r.mimetype)){t.logger.error(z);for(var B=0;B<z.length;B++){var D=z[B];var y=Math.max(D.lastIndexOf("/"),D.lastIndexOf("\\"));if(y!==-1){D=D.substring(y+1,y.length)}var A={rsc:"3DPlay/Core",type:"Convert_MISSING_FILES",level:j.error,text:" "+D};if(t._exp&&t._exp.onModelLoadingError){t._exp.onModelLoadingError(A)}}p&&p({rsc:"3DPlay/Core",type:"Convert_MISSING_FILES",level:j.error})}t._exp.getPhaseProgress().setAbsoluteProgress(t.subProgressID,100);t.cleaneNode(s);return true};var o=function(z){var y=z.readDouble("Progress");if(this._exp&&this._exp.getPhaseProgress()&&this.subProgressID&&y){this._exp.getPhaseProgress().setAbsoluteProgress(this.subProgressID,(y/1)*100)}};var x=function(y){t.logger.error("Conversion error");if(y.readStringArray("Errors")&&y.readStringArray("Errors")[0]&&y.readStringArray("Errors")[0].split("\n")){if(y.readStringArray("Errors")[0].split("\n")[2]=="Please check the documentation for supported file versions and resave the file in one of supported versions if possible"){t.logger.error(y);p({rsc:"3DPlay/Core",type:"Convert_NOTSUPPORTED_SOLIDWORKS",level:j.fatal},r);t.onErrorsVisited=true}else{if(y.readStringArray("Errors")[0].split("\n")[1]=="InterOp Diagnostic: The input Parasolid file is Bare binary file which is an unsupported format."){t.logger.error(y);p({rsc:"3DPlay/Core",type:"Convert_NOTSUPPORTED_BIN",level:j.fatal},r);t.onErrorsVisited=true}}}};var q=new f.Response();t.responseCallback=function(y){q.callDomains(y)};q.onAnswerDomain("ResultFile",n);q.onAnswerDomain("MissingFiles",l);s.subscribe(v,"Progress",q);q.onAnswerDomain("Progress",o.bind(this));q.onAnswerDomain("Errors",x.bind(this));var u=function(A){var z=s.createRequest({destinationNodeId:v,command:"Convert",version:1,onComplete:t.responseCallback.bind(t)});var y=new f.Parameters();if(r.dataFormat==="asm"){r.dataFormat="3dxml";y.writeString("InputFileName",r.filename);y.writeString("InputFileUrl",r.url);y.writeString("OutputType",r.dataFormat)}else{y.writeString("InputFileName","DummyName."+(r.format||r.mimetype));if(A){y.writeBuffer("InputFile",A)}else{y.writeString("InputFileUrl",r.filename)}y.writeString("OutputType",r.dataFormat)}z.send(null,y,null)};if(r._3DPlayDatas===null||r._3DPlayDatas===undefined||r._3DPlayDatas.externalDrive===null||r._3DPlayDatas.externalDrive===undefined||r._3DPlayDatas.externalDrive===false){u()}else{if(r.dataFormat==="asm"){p({rsc:"3DPlay/Core",type:"Convert_FILE_NOT_LOADED"},r);return}var w=r.requestsOptions||{};w.type="arraybuffer";w.timeout=25000;w.onComplete=function(z){var y=new Uint8Array(z);u(y)};w.onFailure=function(y){t.logger.error(y);p({rsc:"3DPlay/Core",type:"Convert_FILE_NOT_LOADED"},r)};w.onTimeout=function(y){t.logger.error(y);p({rsc:"3DPlay/Core",type:"Convert_FILE_NOT_LOADED"},r)};g.handleRequest(r.filename,w)}},cleaneNode:function(l){setTimeout(function(){l.stop()},1000)},dispose:function(){this._exp=null}})});define("DS/3DPlayUtils/PanelManager",["DS/3DPlay/3DPlay","UWA/Core","UWA/Class","UWA/Controls/TabView","DS/TopBarProxy/TopBarProxy","DS/WebSystem/Environment","DS/3DPlayUtils/UIManager","DS/UIKIT/Spinner","DS/WebSystem/DataUrlTools","DS/WebSystem/DetectBrowser","DS/3DPlayUtils/PublishToSwym","DS/WebSystem/Nls","DS/3DPlayUtils/FullScreen","DS/WebUtils/ContextedSingleton","DS/WebSystem/Settings"],function(l,g,b,p,e,n,j,f,i,m,h,o,k,c,a){var d=b.extend({init:function(q){this.showVersion=true;this.UIManager=new j(q);var r=new Date();this.lastClickTime=r.getTime();this.panelContent={};this.panelContent.wait=this._generateWaitingUI()},setTopBarId:function(r){if(this.generated===undefined){this.generated=true;if(r.topBarId){r.topBar={id:r.topBarId};console.error("API Migration : please don t use options.topBarId");console.error("API Migration : use instead options.topBar.id")}if(e){var t={};if(r.topBar&&r.topBar.id){t=r.topBar}else{if(window.widget&&window.widget.id){t.id=window.widget.id}}if(t.id){var q=window;while(!q.mycontainertoUse&&q.parent&&q!==q.parent){q=q.parent}if(q.mycontainertoUse){try{t.options={rightParentWindow:q.parent}}catch(s){}}this.topBarProxy=new e(t);if(r.activeState===false||r.activeState==="false"){this.topBarProxy.deactivate()}}}}},setVisibility:function(q){if(this.isTopBarAvailable()){if(this.topBarProxy){if(q===false){this.topBarProxy.deactivate()}else{this.topBarProxy.activate()}}}else{if(this.topMenuContainer){if(q){this.topMenuContainer.style.display=""}else{this.topMenuContainer.style.display="none"}}}},dispose:function(){if(this.UIManager){this.UIManager.dispose()}this.UIManager=null;this.panel=null;this.currentPanel=null;this.panelContainer=null;this.topMenuContainer=null;this.experience=null;this.panelClose=null;if(this.isTopBarAvailable()){this.topBarProxy.die();this.topBarProxy=undefined}},isTopBarAvailable:function(){return this.topBarProxy!==undefined},createTopMenu:function(y){var w=y.container;var u=this;this.experience=y.experience;this.ctx=y.ctx;this.panel=new g.Element("div",{attributes:{id:"PlayWeb-Panel","class":"SHAREPluginless_noSelect"}});this.panelClose=new g.Element("span",{"class":"CloseBtn"}).addEvent("click",function(){u.panelContainer.style.display="none"}).addEvent("touchstart",function(){u.panelContainer.style.display="none"});new g.Element("span",{"class":"fonticon fonticon-cancel"}).inject(u.panelClose);new g.Element("span",{"class":"fonticon fonticon-cancel-circled"}).inject(u.panelClose);this.panel.appendChild(u.panelClose);this.panelContainer=WUX.Utilities.Css.verticalAlign(this.panel);this.panelContainer.id="PlayWeb-Panel-CSSV";this.panelContainer.setStyles({position:"absolute","text-align":"center","pointer-events":"none",display:"none","z-index":"10",top:"0px"});this.panelContainer.addEventListener("contextmenu",function(B){B.preventDefault()},false);this.panelContainer.inject(w);if(this.isTopBarAvailable()){o.nls("3DPlay/Core",["Publish_Print","Publish_Save","Menu_Help","Publish_ShareAs","Publish_Swym"],function(F){var E;var B=[];var I=false;var G=false;var H=["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"];require(H,function(J){J.getPlatformServices({onComplete:function(K){for(var L=0;L<K.length;L++){if(K[L]["3DSwym"]&&K[L]["3DSwym"]!==""){G=true}if(G===true){break}}I=true},onFailure:function(){l.nls("3DPlay/Core","PlatformNotFound",function(K){console.error(K)});I=true}})},function(K){if(K.requireType==="scripterror"){var J=K.requireModules.join(",");console.error("3DPlay ScripNotFoundError: ",J)}else{console.error(K)}l.nls("3DPlay/Core","ScripNotFoundError",function(L){console.error(L)});I=true});var D=0;var C=setInterval(function(){D++;if(D===11||I===true){clearInterval(C);C=undefined;I=false;if(G===true||n.isSet("ODT_3DPlay_PanelManager")){G=false;B.push({label:F[4],onExecute:function(){u._publishToSwYm()}})}B.push({label:F[0],onExecute:function(){setTimeout(function(){u._printScreenshot()},100)}});if(!y.skipSave){B.push({label:F[1],onExecute:function(){setTimeout(function(){u._saveScreenshot()},100)}})}E={share:[{label:F[3],submenu:B}],};if(n.isSet("3DPlay.DumpPCS")){E.share.push({label:"DumpPCS",onExecute:function(){require("DS/WebUtils/ProbesManager").dump()}})}if(u.topBarProxy){u.topBarProxy.setContent(E)}}},100)})}else{if(y.showBubbleMenu===true||n.isSet("3DPlay.ShowBubbleMenu")){this.topMenuContainer=new g.Element("div",{id:"PlayWeb-TopMenu","class":"SHAREPluginless_noSelect"}).inject(y.container);var t=new g.Element("span",{id:"PlayWeb-Save-Annotations","class":"PlayWeb-button",events:{click:function(){if(a.get("3DPlay.PersistedAnnotationsEnabled")){var B=c.get(u.ctx,"ANNOTATION_MANAGER");if(B){var C=B.saveAnnotationsToJSON();a.set("3DPlay.AnnotJson",C);alert("Annotations saved !!!")}}}}}).inject(this.topMenuContainer);var v=new g.Element("span",{id:"PlayWeb-Create-Saved-Annotations","class":"PlayWeb-button"}).inject(this.topMenuContainer);var x=a.get("3DPlay.AnnotJson");var r=function(){if(a.get("3DPlay.PersistedAnnotationsEnabled")){var B=[];if(u.experience._name==="DS/3DPlayDocumentViewer/3DPlayDocumentViewer"){B.push("DS/3DPlayAnnotation2D/AnnotationManager")}else{if(a.get("3DPlay.UseExplodeCompatibleAnnotationManager")){B.push("DS/3DPlayAnnotation3D/AnnotationExplodeManager")}else{B.push("DS/3DPlayAnnotation3D/AnnotationManager")}}require(B,function(D){var C=c.get(u.ctx,"ANNOTATION_MANAGER");if(!C){C=new D({frameWindow:u.experience.frmWindow,context:u.ctx});c.add(u.ctx,"ANNOTATION_MANAGER",C)}C.drawAnnotationsFromJSON(x)})}};if(x){v.addEvent("click",r)}else{v.style.display="none"}this.panelContent.publish=this._generatePublishUI();var z=new g.Element("span",{id:"PlayWeb-Publish","class":"PlayWeb-button"}).inject(this.topMenuContainer);z.addEvent("click",function(){u._togglePanel(u.panelContent.publish)});z.addEvent("touchend",function(){u._togglePanel(u.panelContent.publish)});this.helpBtn=new g.Element("span",{id:"PlayWeb-Help","class":"PlayWeb-button"}).inject(this.topMenuContainer);o.nls("3DPlay/Core",["Publish_Title","Help_Title","SaveAnnotation_Title","CreateSavedAnnotation_Title"],function(B){z.setAttribute("title",B[0]);u.helpBtn.setAttribute("title",B[1]);t.setAttribute("title",B[2]);v.setAttribute("title",B[3])});this.openHelpPanel=function(B){if(B!==undefined){u.Tab.selectTab(B)}u._togglePanel(u.panelContent.help)};if(this.UIManager){this.UIManager.addToPanelEvent(this.topMenuContainer,function(B){if(this.topMenuContainer){if(B.visible){this.topMenuContainer.style.right="35px"}else{this.topMenuContainer.style.right="0px"}}})}}}var A=(this.experience&&this.experience.args)?this.experience.args:{};if(A.commandFullscreen||A.options.fullscreen){var s=new g.Element("span",{id:"PlayWeb-Fullscreen","class":"PlayWeb-button"});var q=new k(A.container,A.options.fullscreen,s,A.widget||window.widget);if(q.getMode()!=="none"){if(!this.topMenuContainer){this.topMenuContainer=new g.Element("div",{id:"PlayWeb-TopMenu","class":"SHAREPluginless_noSelect"}).inject(y.container);if(this.UIManager){this.UIManager.addToPanelEvent(this.topMenuContainer,function(B){if(this.topMenuContainer){if(B.visible){this.topMenuContainer.style.right="35px"}else{this.topMenuContainer.style.right="0px"}}})}}s.inject(this.topMenuContainer);s.addEvent("click",function(){q.toggle(s)});if(A.options&&A.options.fullscreen&&A.options.fullscreen.activateOnStart){s.click()}}}},_togglePanel:function(q){if(q!==this.currentPanel){if(this.currentPanel){this.panel.removeChild(this.currentPanel)}this.panel.appendChild(q);this.currentPanel=q;this.panelContainer.style.display="table";if(this.currentPanel===this.panelContent.wait){this.panelClose.style.display="none"}else{this.panelClose.style.display=""}}else{if(this.panelContainer.style.display==="none"){this.panelContainer.style.display="table"}else{this.panelContainer.style.display="none"}}},_generatePublishUI:function(){var q=new g.Element("ul",{"class":"PlayWeb-Menu"});var r=this;o.nls("3DPlay/Core",["Publish_Print","Publish_Save"],function(s){var t=function(){setTimeout(function(){r._printScreenshot()},100)};new g.Element("li",{id:"Print_Menu_Item",html:s[0],"class":"PlayWeb-MenuItem"}).inject(q).addEvent("click",t).addEvent("touchstart",t);var u=function(){setTimeout(function(){r._saveScreenshot()},100)};new g.Element("li",{id:"Save_Menu_Item",html:s[1],"class":"PlayWeb-MenuItem"}).inject(q).addEvent("click",u).addEvent("touchstart",u)});return q},_generateWaitingUI:function(){var q=new g.Element("ul",{"class":"PlayWeb-Menu"});o.nls("3DPlay/Core",["GeneratingScreenshot"],function(r){var s=new f({className:"large",visible:"true"});s.inject(q);q.appendChild(document.createElement("br"));new g.Element("span",{html:r[0]}).inject(q)});return q},createDefaultHelp:function(){var s=[];if(this.experience.args.touch===true){var r={nlsFile:"3DPlay/Core",id:"Menu.Touch",event:"touchend",array:[["icTouchPan","HelpTouchPan"],["icTouchZoom","HelpTouchZoom"],["icTouchRotate","HelpTouchRotate"],["icTouchReframe","HelpTouchReframe"]]};s.push(r)}var q={nlsFile:"3DPlay/Core",id:"Menu.Mouse",event:"click",array:[["icMouseLeft","HelpRotateBtn"],["icMouseMiddle","HelpZoomBtn"],["icMouseRight","HelpZoomAltBtn"],["icMouseMiddle","HelpDragBtn"]]};s.push(q);this.setHelpContent(s)},setHelpContent:function(q){this.panelContent.help=this._generateHelphUI(q)},_generateHelphUI:function(u){var w=this;var s=[];var r=[];var y=[];this.maxHeight=0;var x=u;for(var v=0;v<x.length;v++){y[v]={file:x[v].nlsFile,id:x[v].id}}if(this.showVersion){y.push({file:"3DPlay/Core",id:"Menu.About"})}var q=new g.Element("div");var t=function(C,G,F){if(G===C.length){var z=function(J){return function(){var K=new Date();w.currentClickTime=K.getTime();if(w.currentClickTime-w.lastClickTime>500){w.openHelpPanel(J);w.lastClickTime=w.currentClickTime}}};var D=false;var I=false;for(var E=0;E<F.length;E++){if(E<x.length){var A=x[E].event;if(A!==undefined){if(A==="click"){D=true}else{if(A==="touchend"){I=true}}var H=C[E].id;if(w.helpBtn){w.helpBtn.addEvent(A,z(H))}}s.push(new p.Tab({id:C[E].id,text:F[E]}));r.push(document.createElement("table"));w._fillPanel(q,r[E],x[E].array,C[E].file)}else{if(C[E].id==="Menu.About"){if(w.helpBtn){if(D===false){w.helpBtn.addEvent("click",z("Menu.About"))}else{if(I===false){w.helpBtn.addEvent("touchend",z("Menu.About"))}}}s.push(new p.Tab({id:C[E].id,text:F[E]}));r.push(document.createElement("table"));w._fillVersionPanel(r[E])}}}w.Tab=new p({className:"help",tabs:s,events:{onSelectTab:function(){}}}).inject(q);for(var B=0;B<s.length;B++){s[B].setContent(r[B])}}else{o.nls(C[G].file,C[G].id,function(J){F.push(J);G++;t(C,G,F)})}};t(y,0,[]);return q},_fillPanel:function(q,t,v,s){if(this.maxHeight<v.length){this.maxHeight=v.length}q.setStyles({height:""+(this.maxHeight*66+60)+"px"});var u=[];for(var r=0;r<v.length;r++){u[r]=v[r][1]}o.nls(s,u,function(w){for(var y=0;y<v.length;y++){var A=document.createElement("tr");var x=document.createElement("td");x.setAttribute("class","ic "+v[y][0]);var z=document.createElement("td");z.appendChild(document.createTextNode(w[y]));z.setAttribute("class","desc");A.appendChild(x);A.appendChild(z);t.appendChild(A)}})},_fillVersionPanel:function(r){var t=document.createElement("tr");var s=document.createElement("td");s.setAttribute("class","logoDS");var q=document.createElement("td");o.nls("3DPlay/Core",["Menu.AppName","Menu.Version","Menu.Documentation"],function(u){q.appendChild(document.createTextNode(u[0]));q.appendChild(document.createElement("br"));q.appendChild(document.createElement("br"));var v=new g.Element("div",{styles:{"pointer-events":"all"}}).inject(q);new g.Element("a",{html:u[2],href:"http://www.3ds.com/support/3dplay-app/",target:"_blank",styles:{"pointer-events":"all",color:"#456077"}}).inject(v)});q.setAttribute("style","font-size: initial;vertical-align: middle;");t.appendChild(s);t.appendChild(q);r.appendChild(t);if(this.maxHeight>0){r.style.minHeight=(this.maxHeight*66)+"px"}},_publishToSwYm:function(){var r=this;r._pictureFlash();var q={ctx:r.ctx};setTimeout(function(){new h(q)},1000)},_printScreenshotAfterFlash:function(){var u=this;var q=new g.Element("iframe",{styles:{position:"fixed",top:"0",left:"100%",width:"100%",height:"100%"}}).inject(document.body);var s;if(m&&m().browser.name==="ie"&&this.experience.frmWindow._3dViewer!==undefined&&this.experience.frmWindow._3dViewer!==null&&this.experience.frmWindow._3dViewer.getCurrentSheet!==undefined&&this.experience.frmWindow.getCurrentSheet!==null){s=this.experience.frmWindow._3dViewer.getCurrentSheet()}if(s&&s.svg!==undefined&&s.svg!==null){if(s.getSVGCloneNode!==undefined&&s.getSVGCloneNode!==null){var t=s.getSVGCloneNode();q.contentWindow.document.body.appendChild(t);try{if(false===q.contentWindow.document.execCommand("print",false,null)){q.contentWindow.print()}}catch(r){q.contentWindow.print()}t=null;setTimeout(function(){document.body.removeChild(q);q=null},60000)}}else{this.experience.getScreenShot({onSuccess:function(x){var w=new g.Element("img",{src:x,styles:{"max-width":"100%","max-height":"100%"}}).inject(q.contentWindow.document.body);var v;v=setInterval(function(){if(w.offsetHeight||w.height){clearInterval(v);if(n.isSet("ODT_3DPlay_PanelManager")){require(["DS/CoreEvents/Events"],function(z){z.publish({event:n.get("ODT_3DPlay_PanelManager")})})}else{try{if(false===q.contentWindow.document.execCommand("print",false,null)){q.contentWindow.print()}}catch(y){q.contentWindow.print()}}setTimeout(function(){document.body.removeChild(q);q=null},60000)}},100)},onFail:function(){o.nls("3DPlay/3DPlay","UnableToCreateScreenshot",function(v){l.sendEvent(u.ctx,eventType.notif,notification.error,{msg:v})})}})}s=null},_printScreenshot:function(){var q=this;this._pictureFlash(function(){q._printScreenshotAfterFlash();q=undefined})},_saveScreenshotAfterFlash:function(){var q=this;this.experience.getScreenShot({onSuccess:function(y){if(undefined!==window.Windows&&undefined!==window.Windows.Security&&undefined!==window.Windows.Storage){var s=y.replace("data:image/png;base64,","");var r=Windows.Security.Cryptography.CryptographicBuffer.decodeFromBase64String(s);var v=new Windows.Storage.Pickers.FileSavePicker();v.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.documentsLibrary;v.fileTypeChoices.insert("Picture",[".png"]);v.suggestedFileName="myScreenshot";v.pickSaveFileAsync().then(function(z){if(z){return Windows.Storage.FileIO.writeBufferAsync(z,r)}})}else{if("download" in document.createElement("a")){var u,t;if(a.get("3DPlay.PersistedAnnotationsEnabled")){u=y;t="3DPlay_Screenshot.svg"}else{u=i.toBlob(y);t="3DPlay_Screenshot.png"}var w=new g.Element("a",{href:u,download:t,styles:{visibility:"hidden"}}).inject(document.body);if(n.isSet("ODT_3DPlay_PanelManager")){require(["DS/CoreEvents/Events"],function(z){z.publish({event:n.get("ODT_3DPlay_PanelManager")})})}else{w.click()}document.body.removeChild(w)}else{var x=window.open("about:blank","3DPlay web","width=1024,height=860");x.document.body.innerHTML='<img style="max-width:100%;max-height:100%" src="'+y+'" />'}}},onFail:function(){o.nls("3DPlay/3DPlay","UnableToCreateScreenshot",function(r){l.sendEvent(q.ctx,eventType.notif,notification.error,{msg:r})})}})},_saveScreenshot:function(){var q=this;this._pictureFlash(function(){q._saveScreenshotAfterFlash();q=undefined})},_pictureFlash:function(u){this.panelContainer.style.display="none";var t=this.experience.frmWindow.getViewerFrame();var q=this.experience.frmWindow.getUIFrame();var s=new g.Element("div",{id:"_3DPlay-Flash",styles:{position:"absolute",top:0,left:0,width:t.clientWidth+"px",height:t.clientHeight+"px","background-color":"white"}}).inject(q);var r=1;var v=function(){r-=0.02;s.setStyle("opacity",r);if(r<0){q.removeChild(s);if(typeof u==="function"){u()}}else{requestAnimationFrame(v)}};v()},_shareTo3DComment:function(){var u=this.experience;var r=c.get(this.ctx,"ANNOTATION_MANAGER");if(u&&r){var s=r.saveAnnotationsToJSON();var q=new Blob([s],{type:"application/json"});var t=u.getScreenShot({width:240,height:180,type:"jpeg",onSuccess:function(v){var w={screenshot:v,annotation:q};if(u.onAnnotationShared){console.log("Social: onAnnotationShared found");u.onAnnotationShared(w)}else{console.log("3DPlay: Launching 3DPlay's social panel");if(!u.createComment(w)){console.log("Social: Panel failed");o.nls("3DPlay/3DPlay","3DCOMMENT_NOT_AVAILABLE",function(x){l.sendEvent(u.ctx,eventType.notif,notification.error,{msg:x})})}}}})}},_downloadSourceDocument:function(){var q=(this.experience&&this.experience.args&&this.experience.args.input&&this.experience.args.input.asset&&this.experience.args.input.asset.provider==="FILE"&&this.experience.args.input.asset.type==="pdf")?true:false;if(q){window.open(this.experience.args.input.asset.filename,"_blank")}}});return d});