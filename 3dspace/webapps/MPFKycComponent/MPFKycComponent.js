define("DS/MPFKycComponent/KycCompanyUboPersonalInfoForm",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyUboModel/CompanyUboModel","DS/MPFAddressModel/AddressModel","DS/MPFAddressConstraintsModel/AddressConstraintsCollection","DS/MPFCountryModel/CountryCollection","DS/MPFView/FieldSelectInputV2","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldDateInput","DS/MPFAddressFormComponent/AddressFormComponentV2","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(a,k,j,i,b,g,d,c,h,l,e){var f=a.extend({tagName:"form",className:"mpf-kyc-ubo-form-personal mpf-horizontal clearfix",setup:function(m){m||(m={});k.requiredOfPrototype(m.companyUbo,j,"options.companyUbo must be a CompanyUboModel");k.requiredOfPrototype(m.address,i,"options.companyUbo must be a CompanyUboModel");k.requiredOfPrototype(m.addressConstraints,b,"options.companyUbo must be a CompanyUboModel");k.requiredOfPrototype(m.countries,g,"options.countries must be an CountryCollection");this.companyUbo=m.companyUbo;this.address=m.address;this.addressConstraints=m.addressConstraints;this.countries=m.countries;this.titleField=this._createTitleField();this.firstNameField=this._createFirstNameField();this.lastNameField=this._createLastNameField();this.nationalityField=this._createNationalityField();this.dateOfBirthField=this._createDateOfBirthField();this.placeOfBirthField=this._createPlaceOfBirthField();this.countryOfBirthField=this._createCountryOfBirthField();this.addressForm=this._createAddressForm()},render:function(){this.container.setContent([this.titleField.render(),this.firstNameField.render(),this.lastNameField.render(),this.nationalityField.render(),this.dateOfBirthField.render(),this.placeOfBirthField.render(),this.countryOfBirthField.render(),this.addressForm.render()]);return this},validate:function(){var t;var n=this.titleField.validate().isValid;var u=this.firstNameField.validate().isValid;var p=this.lastNameField.validate().isValid;var m=this.dateOfBirthField.validate().isValid;var s=this.placeOfBirthField.validate().isValid;var q=this.nationalityField.validate().isValid;var r=this.countryOfBirthField.validate().isValid;var o=this.addressForm.validate();t=n&&u&&p&&m&&s&&q&&r&&o;return t},canGoNext:function(){var o;var n=this.titleField.validate().isValid;var m=this.firstNameField.validate().isValid;var p=this.lastNameField.validate().isValid;o=n&&m&&p;return o},_createTitleField:function(){var m;m=new d({model:this.companyUbo,fieldName:j.Fields.TITLE,fieldLabel:e.get("title"),selectableOptions:[{value:"Mr",label:e.get("Mr")},{value:"Mrs",label:e.get("Mrs")}],placeholder:e.get("selectTitle"),required:true,dynamicValidation:true});m.setValue(this.companyUbo.getTitle(),{silent:true});return m},_createFirstNameField:function(){return new c({model:this.companyUbo,fieldName:j.Fields.FIRST_NAME,fieldLabel:e.get("firstName"),required:true,dynamicValidation:true})},_createLastNameField:function(){return new c({model:this.companyUbo,fieldName:j.Fields.LAST_NAME,fieldLabel:e.get("lastName"),required:true,dynamicValidation:true})},_createNationalityField:function(){var m;m=new d({model:this.companyUbo,fieldName:j.Fields.NATIONALITY,fieldLabel:e.get("nationality"),placeholder:e.get("selectNationality"),required:true,dynamicValidation:true,selectableOptions:this.countries.map(function(n){return{value:n.getIso3(),label:n.getName()}})});m.setValue(this.companyUbo.getNationality(),{silent:true});return m},_createDateOfBirthField:function(){return new h({className:"mpf-entry-v2",model:this.companyUbo,fieldName:j.Fields.DATE_OF_BIRTH,fieldLabel:e.get("dateOfBirth"),required:true,max:new Date()})},_createPlaceOfBirthField:function(){return new c({model:this.companyUbo,fieldName:j.Fields.PLACE_OF_BIRTH,fieldLabel:e.get("placeOfBirth"),required:true,dynamicValidation:true})},_createCountryOfBirthField:function(){var m;m=new d({model:this.companyUbo,fieldName:j.Fields.COUNTRY_OF_BIRTH,fieldLabel:e.get("countryOfBirth"),required:true,dynamicValidation:true,placeholder:e.get("selectCountry"),selectableOptions:this.countries.map(function(n){return{value:n.getIso3(),label:n.getName()}})});m.setValue(this.companyUbo.getCountryOfBirth(),{silent:true});return m},_createAddressForm:function(){return new l({addressModel:this.address,addressConstraints:this.addressConstraints,countries:this.countries,keepErrorMessages:true})}});return f});define("DS/MPFKycComponent/KycSection",["UWA/Core","UWA/Class/View","DS/MPFTooltip/Tooltip"],function(d,c,b){var a;a=c.extend({tagName:"section",className:"mpf-kyc-section",setup:function(e){if(!(d.is(e))){throw new Error("options is ")}if(!(c.prototype.isPrototypeOf(e.body))){throw new Error("options.body must be a View")}var f=[e.title];if(e.tooltip){this.tooltip=new b({body:e.tooltip});f.push(this.tooltip)}this.body=e.body;this.title=d.createElement("h3",{"class":"mpf-title",html:f})},render:function(){var e=[];e.push(this.title);e.push(this.body.render());this.container.setContent(e);return this},getBody:function(){return this.body},setReadOnly:function(e){this.body.setReadOnly(e)}});return a});define("DS/MPFKycComponent/KycPageCompletion",["UWA/Core","UWA/Class","DS/MPFCompanyModel/CompanyModel","DS/MPFKYCDocumentModel/KycDocumentCollection","DS/MPFKYCDocumentModel/KycDocumentModel","DS/MPFBankAccountModel/BankAccountModel","DS/MPFPspModel/PspModel","DS/MPFCompanyUboModel/CompanyUboCollection","DS/MPFServices/ObjectService","DS/MPFDataProxy/NoDataProxy"],function(k,b,a,f,i,h,g,c,j,d){var e={};e.isCompleted=function(m){var r;var q;var l;var o;var p;var n;j.requiredOfPrototype(m.psp,g,"options.psp must be a PspModel");j.requiredOfPrototype(m.company,a,"options.company must be a CompanyModel");j.requiredOfPrototype(m.kycDocuments,f,"options.kycDocuments must be a KycDocumentCollection");j.requiredOfPrototype(m.bankAccount,h,"options.bankAccount must be a BankAccountModel");q=m.psp;l=m.company;o=m.kycDocuments;p=m.bankAccount;n=m.companyUbos;if(q.getPsp()===g.Psp.STRIPE){if(q.getCountryPlatform()===g.Platform.STRIPE_EU){r=e._isCompletedStripeEU(l,o,p,n)}else{r=e._isCompletedStripe(l,o,p)}}else{r=e._isCompletedHiPay(l,o,p,n)}return r};e._areUboComplete=function(n,o){var m;var l;o=o||n.getUboPersons();m=c.prototype.isPrototypeOf(o)?o:new c(o,{dataProxy:d.getInstance()});l=m&&!(m.isEmpty())&&m.isComplete();return n.getNoShareHolder()||l};e._isCompletedHiPay=function(r,p,s,l){var n;var m;var t;var q;var o;if(!(a.prototype.isPrototypeOf(r))){throw new Error("company parameter must be a CompanyModel")}if(!(f.prototype.isPrototypeOf(p))){throw new Error("kycDocuments parameter must be a KycDocumentCollection")}if(!(h.prototype.isPrototypeOf(s))){throw new Error("bankAccount parameter must be a BankAccountModel")}m=r&&!(r.isNew())&&k.is(r.getRegistrationId())&&k.is(r.getTaxRegistrationId());t=s&&!(s.isNew());q=p&&!(p.isEmpty())&&k.is(p.get(i.DocumentTypes.statutes))&&k.is(p.get(i.DocumentTypes.kbis))&&k.is(p.get(i.DocumentTypes.idPro))&&k.is(p.get(i.DocumentTypes.bank));o=e._areUboComplete(r,l);n=m&&t&&q&&o;return n};e._isCompletedStripe=function(l,n,q){var p;var o;var m;var r;if(!(a.prototype.isPrototypeOf(l))){throw new Error("company parameter must be a CompanyModel")}if(!(f.prototype.isPrototypeOf(n))){throw new Error("kycDocuments parameter must be a KycDocumentCollection")}if(!(h.prototype.isPrototypeOf(q))){throw new Error("bankAccount parameter must be a BankAccountModel")}r=q&&!(q.isNew());o=l&&!(l.isNew())&&!!l.getCeoFirstName()&&!!l.getCeoLastName()&&!!l.getCeoDateOfBirth()&&!!l.getCeoPersonalIdNumber()&&!!l.getRegistrationId();m=n&&!(n.isEmpty())&&k.is(n.get(i.DocumentTypes.idPro));p=r&&o&&m;return p};e._isCompletedStripeEU=function(r,p,s,l){var n;var m;var q;var t;var o;if(!(a.prototype.isPrototypeOf(r))){throw new Error("company parameter must be a CompanyModel")}if(!(f.prototype.isPrototypeOf(p))){throw new Error("kycDocuments parameter must be a KycDocumentCollection")}if(!(h.prototype.isPrototypeOf(s))){throw new Error("bankAccount parameter must be a BankAccountModel")}t=s&&!(s.isNew());m=r&&!(r.isNew())&&!!r.getCeoFirstName()&&!!r.getCeoLastName()&&!!r.getCeoDateOfBirth()&&!!r.getRegistrationId();q=p&&!(p.isEmpty())&&k.is(p.get(i.DocumentTypes.idPro));o=e._areUboComplete(r,l);n=t&&m&&q&&o;return n};Object.freeze(e);return e});define("DS/MPFKycComponent/KycCompanyRegistrationInformationStripe",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFKYCDocumentModel/KycDocumentCollection","DS/MPFCompanyComponent/CompanyRegistrationIdInput","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(h,g,c,e,a,b,d){var f;f=g.extend({className:"mpf-kyc-company-registration mpf-stripe mpf-horizontal",setup:function(i){c.requiredOfPrototype(i.company,e,"options.company must be a CompanyModel");c.requiredOfPrototype(i.kycDocuments,a,"options.kycDocuments must be a KycDocumentCollection");this.company=i.company;this.kycDocuments=i.kycDocuments;this.taxRegistrationIdField=this._createRegistrationIdField();this.listenTo(this.taxRegistrationIdField,"update",this.onRegistrationIdChange.bind(this));this.listenTo(this.kycDocuments,"onAdd",this.onRegistrationIdChange.bind(this))},render:function(i){this.container.setContent(this.taxRegistrationIdField.render());return this},destroy:function(){this.stopListening(this.taxRegistrationIdField);this.stopListening(this.kycDocuments);this.company=null;this.kycDocuments=null;this.taxRegistrationIdField.destroy();this._parent()},onRegistrationIdChange:function(){if(this._isCompanyFieldsReadOnly()){this.taxRegistrationIdField.setDisabled(true)}},setReadOnly:function(i){this.taxRegistrationIdField.setDisabled(i)},_createRegistrationIdField:function(){return new b({model:this.company,fieldLabel:d.get("businessTaxId"),required:true,saveOnChange:true,maxlength:30,readOnly:this._isCompanyFieldsReadOnly()})},_isCompanyFieldsReadOnly:function(){var j;var i;j=h.is(this.taxRegistrationIdField)?this.taxRegistrationIdField.getRegistrationId().length>0&&this.taxRegistrationIdField.validate().isValid:h.is(this.company.getRegistrationId())&&this.company.getRegistrationId().length>0;i=!(this.kycDocuments.isEmpty());return j&&i}});return f});define("DS/MPFKycComponent/KycPageInformation",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFPspModel/PspModel","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(g,f,b,e,d,c){var a=f.extend({className:"mpf-kyc-section mpf-kyc-info-section",setup:function(h){h||(h={});b.requiredOfPrototype(h.company,e,"options.company must be a CompanyModel");b.requiredOfPrototype(h.psp,d,"options.psp must be a PspModel");this.company=h.company;this.psp=h.psp;this.informationIcon=this._createKycInformationIcon();this.information=this._createKycInformation();this.supportedDocumentFormat=this._createSupportedDocumentFormat()},render:function(){this.container.setContent([this.informationIcon,this.information,this.supportedDocumentFormat]);return this},_createKycInformationIcon:function(){return g.createElement("span",{"class":"fonticon fonticon-info"})},_createKycInformation:function(){return g.createElement("p",{"class":"mpf-kyc-info",text:c.get("kycInformation")})},_createSupportedDocumentFormat:function(){var h;h=(this.psp.getPsp()===d.Psp.STRIPE)?c.get("kycSupportedFilesStripe"):c.get("kycSupportedFilesHiPay");return g.createElement("p",{"class":"mpf-kyc-info",text:h})}});return a});define("DS/MPFKycComponent/KycStatus",[],function(c){function b(d){this.status=d}b.prototype.toString=function(){return this.status};b.EMPTY=new b("empty");b.PENDING=new b("pending");b.VALIDATED=new b("validated");b.REJECTED=new b("rejected");b.fromBackendStatus=function(d){var e;e=b.EMPTY;if(d==="created"){e=b.PENDING}else{if(d==="uploaded"){e=b.PENDING}else{if(d==="validated"){e=b.VALIDATED}else{if(d==="nok"){e=b.REJECTED}}}}return e};b.fromHipayStatus=b.fromBackendStatus;var a={EMPTY:"empty",PENDING:"pending",VALIDATED:"validated",REJECTED:"rejected"};a.fromHipayStatus=function(e){var d;d=a.EMPTY;if(e==="created"){d=a.PENDING}else{if(e==="uploaded"){d=a.PENDING}else{if(e==="validated"){d=a.VALIDATED}else{if(e==="nok"){d=a.REJECTED}}}}return d};return Object.freeze(b)});define("DS/MPFKycComponent/KycModalButton",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button"],function(b,d,a){var c=d.extend({className:"mpf-entry",setup:function(e){var f=this;e||(e={});this._parent(e);this.modal=e.modal;this.icon=e.icon||null;this.label=e.label||"";this.button=new a({className:"mpf-kyc-button default",icon:this.icon,value:this.label,events:{onClick:function(g){f.modal.show()}}})},render:function(){this.container.setContent([this.button,this.modal]);return this},setLabel:function(e){this.button.setValue(e)}});return c});define("DS/MPFKycComponent/KycCompanyUboListEntry",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyUboModel/CompanyUboModel","DS/MPFShopModel/ShopModel","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(g,f,c,b,e,d){var a=f.extend({tagName:"tr",className:"mpf-kyc-ubo-list-entry",setup:function(h){h||(h={});c.requiredOfPrototype(h.companyUbo,b,"options.companyUboModel must be a CompanyUboCollection");c.requiredOfPrototype(h.shop,e,"options.shop must be a ShopModel");this.companyUbo=h.companyUbo;this.shop=h.shop},render:function(){this.container.setContent([this._createStateCell(),this._createNameCell(),this._createShareCell()]);if(!(this.shop.getState()===e.States.SUBMITTED||this.shop.getState()===e.States.ACTIVE)){this.container.addContent(this._createEditCommandCell())}return this},onEdit:function(){this.dispatchEvent("editCompanyUbo",{id:this.companyUbo.id})},_createStateCell:function(){var h;h=g.createElement("td",{"class":"mpf-kyc-ubo-status",html:[{tag:"div","class":"mpf-kyc-validation-icon"}]});if(this.companyUbo.getState()===b.States.COMPLETE){h.addClassName("validated")}return h},_createNameCell:function(){var j;var h;var k;var i;j=this.companyUbo.getFirstName()+" "+this.companyUbo.getLastName();h=g.createElement("td",{text:j});if(this.companyUbo.getState()===b.States.DRAFT){k=" ("+d.get("toCompleteWarning")+")";i=g.createElement("span",{"class":"mpf-kyc-ubo-warning",text:k});h.addContent(i)}return h},_createShareCell:function(){return g.createElement("td",{text:this.companyUbo.getSharePercentage()+"%"})},_createEditCommandCell:function(){var h;var i;i=g.createElement("span",{"class":"fonticon fonticon-pencil",events:{click:this.onEdit.bind(this)}});i.setData("id",this.companyUbo.id);h=g.createElement("td",{html:i});return h}});return a});define("DS/MPFKycComponent/KycBankAccountInformationStripe",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFBankAccountModel/BankAccountModel","DS/MPFBankAccountConstraintsModel/BankAccountConstraintsCollection","DS/MPFBankAccountFormComponent/BankAccountFormComponentV2"],function(f,b,e,d,c){var a;a=f.extend({className:"mpf-kyc-bank-account-information mpf-kyc-stripe",setup:function(g){b.requiredOfPrototype(g.bankAccount,e,"options.bankAccount must be an BankAccountModel");this.bankAccount=g.bankAccount;this.bankAccountNumberComponent=this._initBankAccountNumberComponent()},render:function(g){this.container.setContent(this.bankAccountNumberComponent.render());return this},setReadOnly:function(g){this.bankAccountNumberComponent.setReadOnly(g)},_initBankAccountNumberComponent:function(g){return new c({bankAccount:this.bankAccount,readOnly:!(this.bankAccount.isNew())})}});return a});define("DS/MPFKycComponent/KycCompanyNameAndAddress",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFAddressModel/AddressCollection","DS/MPFCountryModel/CountryCollection","DS/MPFView/FieldTextInput","DS/MPFAddressFormComponent/AddressFormComponentV2","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(b,h,a,d,f,g,i,e){var c=b.extend({className:"mpf-kyc-company-name-address",setup:function(j){j||(j={});h.requiredOfPrototype(j.company,a,"options.company must be a CompanyModel");h.requiredOfPrototype(j.companyAddresses,d,"options.companyAddresses must be an AddressCollection");h.requiredOfPrototype(j.countries,f,"options.countries must be a CountryCollection");this.company=j.company;this.companyAddresses=j.companyAddresses;this.countries=j.countries;this.companyNameField=this._createCompanyNameField();this.companyAddressForm=this._createAddressForm()},render:function(){this.container.setContent([this.companyNameField.render(),this.companyAddressForm.render()]);return this},destroy:function(){this.company=null;this.companyAddresses=null;this.companyNameField.destroy();this.companyAddressForm.destroy();this._parent()},_createCompanyNameField:function(){return new g({model:this.company,fieldName:a.Fields.NAME,fieldLabel:e.get("companyName"),readOnly:true,required:true})},_createAddressForm:function(){return new i({addressModel:this.companyAddresses.first(),addressConstraints:this.companyAddresses.constraints,countries:this.countries,horizontalLayout:true,countryReadOnly:true,readOnly:true})}});return c});define("DS/MPFKycComponent/KycUploadButton",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Input/File","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/MPFKycComponent/KycStatus","DS/MPFKYCDocumentModel/KycDocumentModel","DS/MPFKYCDocumentModel/KycDocumentService","i18n!DS/MPFKycComponent/assets/nls/KycComponent","css!DS/MPFUI/MPFUI"],function(m,d,a,h,j,f,b,k,c,e){var l=["image/jpeg","image/png","application/pdf"];var o=["image/jpeg","image/png"];var i=2000000;var n=8000000;var g=a.extend({className:"mpf-entry",setup:function(p){if(!(p)){p={}}this._parent(p);this.kycId=p.kycId;this.label=p.label||e.get("uploadDocument");this.isReadOnly=p.isReadOnly===true;this.input=this._createInput();this.modal=this._createModal(this.kycId);this.isStripe=p.isStripe===true;this.doBeforeUpload=p.doBeforeUpload},render:function(){var q;var p;q=this.model.get(this.kycId);p=q?c.isEditable(q):true;(p&&!(this.isReadOnly))?this.input.enable():this.input.disable();this.container.setContent([this.input,this.modal]);return this},setButtonText:function(p){this.label=p;this.input=this._createInput()},setReadOnly:function(p){this.isReadOnly=p;this.input.setDisabled(this.isReadOnly)},_createInput:function(){var p;p=new h({input:false,buttonClassName:"btn-default mpf-kyc-button mpf-kyc-upload",buttonText:this.label,events:{onChange:this._onFileChange.bind(this)}});return p},_createModal:function(p){var q;var r;var s;r=e.get("uploadDocumentTitle");s=d.format(r,this._getDocumentName(p));q=new j({className:"mpf-kyc-document-modal",header:m.createElement("h4",{text:s}),body:[m.createElement("p",{"class":"mpf-kyc-document-message"})],footer:[new f({className:"primary",value:e.get("continue"),events:{onClick:this._onSave.bind(this)}}),new f({value:e.get("cancel"),events:{onClick:this._cancel.bind(this)}})]});return q},_getDocumentName:function(p){var q;if(p===k.DocumentTypes.id){q=e.get("identificationDocument")}else{if(p===k.DocumentTypes.idPro){q=e.get("legalRepresentativeIdDocument")}else{if(p===k.DocumentTypes.address){q=e.get("addressProofDocument")}else{if(p===k.DocumentTypes.statutes){q=e.get("statutesDocument")}else{if(p===k.DocumentTypes.bank){q=e.get("bankAccountDocument")}else{if(p===k.DocumentTypes.kbis){q=e.get("companyRegistrationDocument")}else{if(p===k.DocumentTypes.tax){q=e.get("taxDocument")}else{if(p===k.DocumentTypes.kyc_ubo1_id||(p===k.DocumentTypes.kyc_ubo2_id)||(p===k.DocumentTypes.kyc_ubo3_id)||(p===k.DocumentTypes.kyc_ubo4_id)){q=e.get("passportOrIdCard")}else{if((p===k.DocumentTypes.kyc_ubo1_address)||(p===k.DocumentTypes.kyc_ubo2_address)||(p===k.DocumentTypes.kyc_ubo3_address)||(p===k.DocumentTypes.kyc_ubo4_address)){q=e.get("proofOfAddress")}}}}}}}}}return q},_onFileChange:function(r){var s;var q="";var p;p=r.currentTarget.files;if(p.length>0){if(this._validateFile(p[0])){s=e.get("youAreAboutToUploadFile");q=d.format(s,this.input.getValue());this.modal.getBody().getElement(".mpf-kyc-document-message").setText(q);this.modal.show()}else{q=this.isStripe?e.get("kycSupportedFilesStripe"):e.get("kycSupportedFilesHiPay");this.dispatchEvent("onError",q)}}},_validateFile:function(p){var q;var r;if(this.isStripe){q=o.indexOf(p.type)!==-1;r=p.size<=n}else{q=l.indexOf(p.type)!==-1;r=p.size<=i}return q&&r},_cancel:function(){this.input.setValue("");this.modal.hide()},_onSave:function(){var p;if(typeof this.doBeforeUpload==="function"){p=this.doBeforeUpload().then(this._uploadFile.bind(this))}else{p=this._uploadFile()}return p},_uploadFile:function(){var r=this;var q;var p;this.dispatchEvent("onLoading");p=this.model.get(this.kycId);if(!(p)||b.fromHipayStatus(p.getStatus())===b.REJECTED){q=this.input.getContent().getElement("input").files[0];this.model.uploadDocument(this.kycId,q).then(function(s){r.dispatchEvent("onSave",s);r.render()})["catch"](function(){r.model.remove(r.kycId);r.dispatchEvent("onError");console.error(arguments)});this.modal.hide()}else{r.dispatchEvent("onError")}}});return g});define("DS/MPFKycComponent/KycItem",["UWA/Core","UWA/Class/View","DS/MPFKycComponent/KycStatus","DS/UIKIT/Spinner","DS/MPFKycComponent/KycUploadButton","DS/MPFTooltip/Tooltip","i18n!DS/MPFKycComponent/assets/nls/KycComponent","css!DS/MPFUI/MPFUI"],function(h,a,b,c,f,g,i){var d={};d[b.EMPTY]=[b.PENDING,b.VALIDATED,b.REJECTED];d[b.PENDING]=[b.VALIDATED,b.REJECTED];d[b.VALIDATED]=[];d[b.REJECTED]=[b.PENDING];var e=a.extend({className:"mpf-kyc-item",setup:function(j){var k=this;j||(j={});this.status=j.status||b.EMPTY;this.label=j.label;this.subLabel=j.subLabel||"";this.spinner=new c();this.kycComponent=j.kycComponent;if(j.tooltip){this.tooltip=new g({body:j.tooltip})}this.listenTo(this.kycComponent,"onLoading",function(){k.setLoading(true)});this.listenTo(this.kycComponent,"onSave",this._onSave.bind(this));this.listenTo(this.kycComponent,"onError",this._onError.bind(this))},render:function(){var l;var m;var k;var j;l=this._createStatusIcon();k=[];k.push(this.label);if(this.tooltip){k.push(this.tooltip.render())}m=h.createElement("div",{"class":"mpf-kyc-validation-label",html:[{tag:"p","class":"mpf-label",html:k},{tag:"p","class":"mpf-sub-label",text:this.subLabel},this.spinner]});j=this.kycComponent&&this.kycComponent.render();this.container.setContent([l,m,j]);this.container.removeClassName();this.container.addClassName(this.className);this.container.addClassName(this.status);return this},updateStatus:function(j){var k;k=d[this.status];if(k.indexOf(j)!==-1){this.container.removeClassName(this.status);this.container.addClassName(j);this.status=j}},setLoading:function(j){var k;k=this.container.getElement(".mpf-sub-label");if(j){k.hide();this.spinner.show()}else{this.spinner.hide();k.show()}},setReadOnly:function(j){this.kycComponent.setReadOnly(j)},_createStatusIcon:function(){var j;j=h.createElement("div",{"class":"mpf-kyc-validation-icon"});return j},_onSave:function(k){var m;var l;var j;m=k.get("kycType")!==undefined;if(m){this.subLabel=i.get("pendingValidation");l=this.container.getElement(".mpf-sub-label");l.setText(this.subLabel)}this.setLoading(false);j=k.get("kycStatus");if(j){j=b.fromHipayStatus(j);this.updateStatus(j)}},_onError:function(k){var j;this.subLabel=k||i.get("uploadNewDocument");j=this.container.getElement(".mpf-sub-label");j.setText(this.subLabel);this.setLoading(false);this.updateStatus(b.REJECTED)}});e.create=function(m){var l;var n;var j;var k;n=m.kycDocuments.get(m.kycId);if(n){j=b.fromHipayStatus(n.get("kycStatus"))}else{j=b.EMPTY}if(j===b.EMPTY){k=i.get("noDocument")}else{if(j===b.PENDING){k=i.get("pendingValidation")}}l=new e({label:m.label,subLabel:k,status:j,tooltip:m.tooltip,kycComponent:new f({kycId:m.kycId,model:m.kycDocuments,isStripe:m.isStripe,doBeforeUpload:m.doBeforeUpload})});if(m.className){l.className+=" "+m.className}return l};return e});define("DS/MPFKycComponent/KycCompanyLegalRepresentativeStripe",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFKYCDocumentModel/KycDocumentCollection","DS/MPFView/FieldTextInput","DS/MPFView/FieldDateInput","DS/MPFKycComponent/KycItem","DS/MPFKYCDocumentModel/KycDocumentModel","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(i,a,k,b,d,j,g,e,h,c){var f;f=a.extend({className:"mpf-kyc-legal-representative mpf-stripe",setup:function(l){k.requiredOfPrototype(l.company,b,"options.company must be a CompanyModel");k.requiredOfPrototype(l.kycDocuments,d,"options.kycDocuments must be a KycDocumentCollection");this.company=l.company;this.kycDocuments=l.kycDocuments;this.firstNameField=this._createFirstNameField();this.lastNameField=this._createLastNameField();this.dateOfBirthField=this._createDateOfBirthField();this.personalIdNumberField=this._createPersonalIdNumberField();this.verificationDocument=this._createVerificationDocument();this.listenTo(this.firstNameField,"update",this.onFirstNameChange.bind(this));this.listenTo(this.lastNameField,"update",this.onFirstNameChange.bind(this));this.listenTo(this.dateOfBirthField,"update",this.onDateOfBirthChange.bind(this));this.listenTo(this.personalIdNumberField,"update",this.onPersonalIdNumberChange.bind(this));this.listenTo(this.kycDocuments,"onAdd",this.onKycDocumentAdded.bind(this))},render:function(){this.container.setContent([this.firstNameField.render(),this.lastNameField.render(),this.dateOfBirthField.render(),this.personalIdNumberField.render(),this.verificationDocument.render()]);return this},destroy:function(){this.stopListening(this.firstNameField);this.stopListening(this.lastNameField);this.stopListening(this.dateOfBirthField);this.stopListening(this.personalIdNumberField);this.stopListening(this.kycDocuments);this.company=null;this.kycDocuments=null;this.firstNameField.destroy();this.lastNameField.destroy();this.dateOfBirthField.destroy();this.personalIdNumberField.destroy();this.verificationDocument.destroy();this._parent()},onFirstNameChange:function(){var l;l=this._isCompanyFieldReadOnly(b.Fields.CEO_FIRST_NAME);this.firstNameField.setDisabled(l)},onLastNameChange:function(){var l;l=this._isCompanyFieldReadOnly(b.Fields.CEO_LAST_NAME);this.lastNameField.setDisabled(l)},onDateOfBirthChange:function(){var l;l=this._isCompanyFieldReadOnly(b.Fields.CEO_DATE_OF_BIRTH);this.dateOfBirthField.setReadOnly(l)},onPersonalIdNumberChange:function(){var l;l=this._isCompanyFieldReadOnly(b.Fields.CEO_PERSONAL_ID_NUMBER);this.personalIdNumberField.setDisabled(l)},onKycDocumentAdded:function(){this.onLastNameChange();this.onFirstNameChange();this.onDateOfBirthChange();this.onPersonalIdNumberChange()},setReadOnly:function(l){this.firstNameField.setDisabled(l);this.lastNameField.setDisabled(l);this.dateOfBirthField.setReadOnly(l);this.personalIdNumberField.setDisabled(l);this.verificationDocument.setReadOnly(l)},_createFirstNameField:function(){return new j({model:this.company,fieldName:b.Fields.CEO_FIRST_NAME,fieldLabel:c.get("legalRepresentativeFirstName"),required:true,dynamicValidation:true,saveOnChange:true,readOnly:this._isCompanyFieldReadOnly(b.Fields.CEO_FIRST_NAME)})},_createLastNameField:function(){return new j({model:this.company,fieldName:b.Fields.CEO_LAST_NAME,fieldLabel:c.get("legalRepresentativeLastName"),required:true,dynamicValidation:true,saveOnChange:true,readOnly:this._isCompanyFieldReadOnly(b.Fields.CEO_LAST_NAME)})},_createDateOfBirthField:function(){var l;l=new Date();l.setFullYear(l.getFullYear()-13);return new g({model:this.company,fieldName:b.Fields.CEO_DATE_OF_BIRTH,fieldLabel:c.get("legalRepresentativeDateOfBirth"),max:l,required:true,dynamicValidation:true,saveOnChange:true,readOnly:this._isCompanyFieldReadOnly(b.Fields.CEO_DATE_OF_BIRTH)})},_createPersonalIdNumberField:function(){return new j({model:this.company,fieldName:b.Fields.CEO_PERSONAL_ID_NUMBER,fieldLabel:c.get("legalRepresentativePersonalIdNumber"),required:true,dynamicValidation:true,saveOnChange:true,readOnly:this._isCompanyFieldReadOnly(b.Fields.CEO_PERSONAL_ID_NUMBER),tooltip:c.get("stripePersonalIdNumberTooltip")})},_createVerificationDocument:function(){return e.create({kycDocuments:this.kycDocuments,kycId:h.DocumentTypes.idPro,label:c.get("legalRepresentativeIdDocument")+' <em class="mpf-required">*</em>',tooltip:c.get("passportOrIdCardOrDrivingLicence"),isStripe:true})},_isCompanyFieldReadOnly:function(o){var n;var m;var l;n=this.company.get(o);m=i.is(n)&&(n.length>0);l=!(this.kycDocuments.isEmpty());return m&&l}});return f});define("DS/MPFKycComponent/KycOperatorEditButton",["UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/MPFKycComponent/KycSection","DS/MPFServices/ObjectService","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(f,d,g,c,b,e){var a;a=f.extend({className:"mpf-kyc-operator-edit-button",setup:function(h){b.requiredOfPrototype(h.bankAccountDetailsSection,c,"options.bankAccountDetailsSection must be a KycSection");b.requiredOfPrototype(h.legalRepresentativeSection,c,"options.legalRepresentativeSection must be a KycSection");b.requiredOfPrototype(h.companyRegistrationInformationSection,c,"options.companyRegistrationInformationSection must be a KycSection");b.requiredOfPrototype(h.companyUboSection,c,"options.companyUboSection must be a KycSection");this.bankAccountDetailsSection=h.bankAccountDetailsSection;this.legalRepresentativeSection=h.legalRepresentativeSection;this.companyRegistrationInformationSection=h.companyRegistrationInformationSection;this.companyUboSection=h.companyUboSection;this.setReadOnly(h.isReadOnly===true);this.editButton=this._createOperatorEditButton()},render:function(){this.container.setContent(this.editButton);return this},setReadOnly:function(h){this.isReadOnly=h;this.bankAccountDetailsSection.setReadOnly(this.isReadOnly);this.legalRepresentativeSection.setReadOnly(this.isReadOnly);this.companyRegistrationInformationSection.setReadOnly(this.isReadOnly);this.companyUboSection.setReadOnly(this.isReadOnly)},toggleEdit:function(){this.setReadOnly(!(this.editButton.isChecked()))},_createOperatorEditButton:function(){return new g({type:"switch",value:e.get("editAsASeller"),events:{onChange:this.toggleEdit.bind(this)}})}});return a});define("DS/MPFKycComponent/KycCompanyLegalRepresentativeHiPay",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFKYCDocumentModel/KycDocumentCollection","DS/MPFView/FieldTextInput","DS/MPFKycComponent/KycItem","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(h,b,g,a,f,e,c){var d=h.extend({className:"mpf-kyc-legal-representative",setup:function(i){i||(i={});b.requiredOfPrototype(i.company,g,"options.company must be a CompanyModel");b.requiredOfPrototype(i.kycDocuments,a,"options.kycDocuments must be a KycDocumentCollection");this.company=i.company;this.kycDocuments=i.kycDocuments;this.legalRepresentativeFirstName=this._createLegalRepresentativeFirstName();this.legalRepresentativeLastName=this._createLegalRepresentativeLastName();this.legalRepresentativeIdDocument=e.create({kycDocuments:this.kycDocuments,kycId:"kyc_id_pro",label:c.get("legalRepresentativeIdDocument")+' <em class="mpf-required">*</em>',tooltip:c.get("passportOrIdCardOrDrivingLicence")})},render:function(){this.container.setContent([this.legalRepresentativeFirstName.render(),this.legalRepresentativeLastName.render(),this.legalRepresentativeIdDocument.render()]);return this},destroy:function(){this.stopListening();this.company=null;this.kycDocuments=null;this.legalRepresentativeFirstName.destroy();this.legalRepresentativeLastName.destroy();this.legalRepresentativeIdDocument.destroy();this._parent()},setReadOnly:function(i){this.legalRepresentativeFirstName.setDisabled(i);this.legalRepresentativeLastName.setDisabled(i);this.legalRepresentativeIdDocument.setReadOnly(i)},_createLegalRepresentativeFirstName:function(){return new f({model:this.company,fieldName:g.Fields.CEO_FIRST_NAME,fieldLabel:c.get("legalRepresentativeFirstName"),required:true,dynamicValidation:true,saveOnChange:true,readOnly:true})},_createLegalRepresentativeLastName:function(){return new f({model:this.company,fieldName:g.Fields.CEO_LAST_NAME,fieldLabel:c.get("legalRepresentativeLastName"),required:true,dynamicValidation:true,saveOnChange:true,readOnly:true})}});return d});define("DS/MPFKycComponent/KycCompanyLegalRepresentativeStripeEU",["DS/MPFKycComponent/KycCompanyLegalRepresentativeStripe","DS/MPFView/EmptyView"],function(c,b){var a=c.extend({setup:function(d){this._parent(d);this.stopListening(this.personalIdNumberField);this.personalIdNumberField=new b()}});return a});define("DS/MPFKycComponent/KycCompanyRegistrationInformationHiPay",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFAddressModel/AddressModel","DS/MPFShopModel/ShopModel","DS/MPFKYCDocumentModel/KycDocumentCollection","DS/MPFKYCDocumentModel/KycDocumentModel","DS/MPFView/FieldTextInput","DS/MPFKycComponent/KycItem","DS/MPFCompanyComponent/CompanyIsDueToOnlineTaxInput","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(a,l,b,i,m,e,j,k,f,g,d){var h=["AUT","BEL","BGR","HRV","CYP","CZE","DNK","EST","FIN","FRA","DEU","GRC","HUN","IRL","ITA","LVA","LTU","LUX","MLT","NLD","POL","PRT","ROU","SVK","SVN","ESP","SWE","GBR"];var c=a.extend({className:"mpf-kyc-company-registration",setup:function(n){n||(n={});l.requiredOfPrototype(n.company,b,"options.company must be a CompanyModel");l.requiredOfPrototype(n.companyAddress,i,"options.companyAddress must be a AddressModel");l.requiredOfPrototype(n.kycDocuments,e,"options.kycDocuments must be a KycDocumentCollection");l.requiredOfPrototype(n.shop,m,"options.shop must be a ShopModel");this.company=n.company;this.companyAddress=n.companyAddress;this.kycDocuments=n.kycDocuments;this.shop=n.shop;this.registrationId=this._createRegistartionIdField();this.taxRegistrationId=this._createTaxRegistrationId();this.dueToOnlineTaxes=this._createCompanyIsDueToOnlineTax();this.companyRegistrationDocument=this._createCompanyRegistrationDocument();this.companyStatutesDocument=this._createCompanyStatutesDocument();this.listenTo(this.taxRegistrationId,"update",this._saveTaxId.bind(this))},render:function(){this.container.setContent([this.registrationId.render(),this.taxRegistrationId.render()]);if(this._isCompanyInEurope()){this.container.addContent(this.dueToOnlineTaxes.render())}this.container.addContent([this.companyRegistrationDocument.render(),this.companyStatutesDocument.render()]);return this},destroy:function(){this.stopListening(this.taxRegistrationId);this.company=null;this.companyAddress=null;this.kycDocuments=null;this.shop=null;this.registrationId.destroy();this.taxRegistrationId.destroy();this.dueToOnlineTaxes.destroy();this.companyRegistrationDocument.destroy();this.companyStatutesDocument.destroy();this._parent()},setReadOnly:function(n){this.registrationId.setDisabled(n);this.taxRegistrationId.setDisabled(n);this.dueToOnlineTaxes.setReadOnly(n);this.companyRegistrationDocument.setReadOnly(n);this.companyStatutesDocument.setReadOnly(n)},_createRegistartionIdField:function(){return new k({model:this.company,fieldName:b.Fields.REGISTRATION_ID,fieldLabel:d.get("registrationId"),required:true,dynamicValidation:true,saveOnChange:true,readOnly:this.shop.getState()===m.States.SUBMITTED||this.shop.getState()===m.States.ACTIVE})},_createTaxRegistrationId:function(){return new k({model:this.company,fieldName:b.Fields.TAX_REGISTRATION_ID,fieldLabel:d.get("taxRegistrationId"),required:true,dynamicValidation:true,readOnly:this.shop.getState()===m.States.SUBMITTED||this.shop.getState()===m.States.ACTIVE})},_saveTaxId:function(){this.company.save("taxId",this.company.getTaxRegistrationId(),{patch:true})},_createCompanyIsDueToOnlineTax:function(){return new g({model:this.company,saveOnChange:true})},_createCompanyStatutesDocument:function(){return f.create({className:"mpf-statutes",kycDocuments:this.kycDocuments,kycId:j.DocumentTypes.statutes,label:d.get("statutesDocument")+'<em class="mpf-required">*</em>'})},_createCompanyRegistrationDocument:function(){return f.create({className:"mpf-registration",kycDocuments:this.kycDocuments,kycId:j.DocumentTypes.kbis,label:d.get("companyRegistrationDocuments")+'<em class="mpf-required">*</em>'})},_isCompanyInEurope:function(){var n;n=this.companyAddress.getCountry();return h.indexOf(n)!==-1}});return c});define("DS/MPFKycComponent/KycCompanyUboList",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyUboModel/CompanyUboCollection","DS/MPFShopModel/ShopModel","DS/MPFKycComponent/KycCompanyUboListEntry","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(h,g,b,f,e,a,c){var d=g.extend({className:"mpf-kyc-ubo-list-container",setup:function(i){i||(i={});b.requiredOfPrototype(i.companyUbos,f,"options.companyUbos must be a CompanyUboCollection");b.requiredOfPrototype(i.shop,e,"options.shop must be a ShopModel");this.companyUbos=i.companyUbos;this.shop=i.shop;this.entries=this.companyUbos.map(this._toRenderedUboListEntry.bind(this));this.entries.forEach(this._listenToEditCompanyUboEvent.bind(this))},render:function(){var i;if(this.companyUbos.isEmpty()){i=h.createElement("p",{text:c.get("noBeneficiary")})}else{i=h.createElement("table",{"class":"mpf-kyc-ubo-list",html:this.entries.map(function(j){return j.render()})})}this.container.setContent(i);return this},onCompanyUboEdit:function(i){this.dispatchEvent("editCompanyUbo",i)},addUbo:function(i){var j;j=this._toRenderedUboListEntry(i);this.entries.push(j);this._listenToEditCompanyUboEvent(j)},_toRenderedUboListEntry:function(i){return new a({companyUbo:i,shop:this.shop})},_listenToEditCompanyUboEvent:function(i){this.listenTo(i,"editCompanyUbo",this.onCompanyUboEdit)}});return d});define("DS/MPFKycComponent/KycBankAccountInformationHiPay",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/MPFKycComponent/KycItem","DS/MPFKycComponent/KycUploadButton","DS/MPFKycComponent/KycStatus","DS/MPFKycComponent/KycModalButton","DS/MPFBankAccountFormComponent/BankAccountFormComponentV2","i18n!DS/MPFKycComponent/assets/nls/KycComponent","css!DS/MPFUI/MPFUI"],function(j,b,h,i,f,g,c,k,a,e){var d=b.extend({className:"mpf-kyc-bank-account-information mpf-kyc-hipay",setup:function(l){this._checkRequiredOptions(l);this.bankAccount=l.bankAccount;this.kycDocuments=l.kycDocuments;this._initBankAccountNumbersComponents(l);this._initBankAccountDocumentsComponents()},render:function(){this.container.setContent([this.bankAccountDocument.render(),this.bankAccountNumbers.render()]);return this},setReadOnly:function(l){this.bankAccountNumbers.setReadOnly(l);this.bankAccountDocument.setReadOnly(l)},_checkRequiredOptions:function(l){if(!(l.bankAccount)){throw new Error("bankAccount parameter is required")}if(!(l.bankAccount.constraints)){throw new Error("bankAccount.constraints parameter is required")}if(!(l.bankAccount.get("country"))){throw new Error("bankAccount.country parameter is required")}},_initBankAccountNumbersComponents:function(l){this.bankAccountNumbers=new a({bankAccount:this.bankAccount,readOnly:!(this.bankAccount.isNew())})},_initBankAccountDocumentsComponents:function(){var n;var l;var m;n=this.kycDocuments.get("kyc_bank");if(n){l=c.fromHipayStatus(n.get("kycStatus"))}else{l=c.EMPTY}if(l===c.EMPTY){m=e.get("noDocument")}else{if(l===c.PENDING){m=e.get("pendingValidation")}}this.bankAccountDocument=new f({label:e.get("bankAccountDocument")+"<em class='mpf-required'>*",subLabel:m,status:l,tooltip:e.get("companyBankingInformationDocument"),kycComponent:new g({kycId:"kyc_bank",model:this.kycDocuments})})}});return d});define("DS/MPFKycComponent/KycCompanyUboDocumentsForm",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyUboModel/CompanyUboModel","DS/MPFKYCDocumentModel/KycDocumentCollection","DS/MPFKYCDocumentModel/KycDocumentModel","DS/MPFView/FieldTextInput","DS/MPFKycComponent/KycItem","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(j,a,i,g,d,f,h,e,c){var b=a.extend({tagName:"form",className:"mpf-kyc-ubo-form-document",setup:function(k){k||(k={});i.requiredOfPrototype(k.companyUbo,g,"options.companyUbo must be a CompanyUboModel");i.requiredOfPrototype(k.kycDocuments,d,"options.kycDocuments must be a KycDocumentCollection");this.companyUbo=k.companyUbo;this.kycDocuments=k.kycDocuments;this.title=this._createTitle();this.indentityDocumentIdentificationNumberField=this._createIdentityDocumentIdentificationNumber()},render:function(){this.identityDocumentItem=this._createIdentityDocumentItem();this.proofOdAddressDocumentItem=this._createProofOfAddressDocumentItem();this.container.setContent([this.title,this.indentityDocumentIdentificationNumberField.render()]);if(this.identityDocumentItem){this.container.addContent(this.identityDocumentItem.render())}if(this.proofOdAddressDocumentItem){this.container.addContent(this.proofOdAddressDocumentItem.render())}return this},_createTitle:function(){return j.createElement("h3",{"class":"mpf-title",text:c.get("documents")})},_createIdentityDocumentIdentificationNumber:function(){return new h({model:this.companyUbo,fieldName:g.Fields.IDENTITY_DOCUMENT_IDENTIFICATION_NUMBER,fieldLabel:c.get("indentityDocumentIdentificationNumber"),required:true})},_createIdentityDocumentItem:function(){var l;var k;l=this.companyUbo.getUboNumber();if(l){k="kyc_ubo"+l+"_id";return e.create({kycDocuments:this.kycDocuments,kycId:f.DocumentTypes[k],label:c.get("passportOrIdCard")+'<em class="mpf-required">*</em>',doBeforeUpload:this.companyUbo.saveOrUpdate.bind(this.companyUbo)})}},_createProofOfAddressDocumentItem:function(){var l;var k;l=this.companyUbo.getUboNumber();if(l){k="kyc_ubo"+l+"_address";return e.create({kycDocuments:this.kycDocuments,kycId:f.DocumentTypes[k],label:c.get("proofOfAddress")+'<em class="mpf-required">*</em>',doBeforeUpload:this.companyUbo.saveOrUpdate.bind(this.companyUbo)})}}});return b});define("DS/MPFKycComponent/KycCompanyRegistrationInformationStripeEU",["UWA/Class/View","DS/MPFKycComponent/KycCompanyRegistrationInformationStripe","DS/MPFCompanyComponent/CompanyIsDueToOnlineTaxInput"],function(d,c,b){var a;a=c.extend({className:"mpf-kyc-company-registration mpf-stripe mpf-stripe-eu mpf-horizontal",setup:function(e){this._parent(e);this.isDueToOnlineTax=this._createIsDueToOnlineTax()},render:function(){this._parent();this.container.addContent(this.isDueToOnlineTax.render());return this},destroy:function(){this.isDueToOnlineTax.destroy();this.parent()},_createIsDueToOnlineTax:function(){return new b({model:this.company,saveOnChange:true})}});return a});define("DS/MPFKycComponent/KycCompanyUboShareInformationForm",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyUboModel/CompanyUboModel","DS/MPFKYCDocumentModel/KycDocumentCollection","DS/MPFView/FieldSelectInput","DS/MPFView/FieldNumberInput","DS/MPFView/FieldToggleInput","DS/MPFKycComponent/KycCompanyUboDocumentsForm","DS/MPFError/BadArgumentError","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(i,a,j,h,e,g,l,d,b,k,c){var f=a.extend({tagName:"form",className:"mpf-kyc-ubo-form-share mpf-horizontal clearfix",setup:function(m){m||(m={});j.requiredOfPrototype(m.companyUbo,h,"options.companyUbo must be a CompanyUboModel");j.requiredOfPrototype(m.kycDocuments,e,"options.kycDocuments must be a KycDocumentCollection");if(!i.is(m.totalShareholderPercentage,"number")){throw new k("options.totalShareholderPercentage must be a number")}this.companyUbo=m.companyUbo;this.kycDocuments=m.kycDocuments;this.totalShareholderPercentage=m.totalShareholderPercentage;this.jobTitleField=this._createJobTitleField();this.sharpercentageField=this._createSharePercentageField();this.isDecisionMakerField=this._createIsDecisionMakerField();this.isPoliticallyExposed=this._createIsPoliticallyExposed();this.uboDocumentsForm=this._createUboDocumentsForm()},render:function(){this.container.setContent([this.jobTitleField.render(),this.sharpercentageField.render(),this.isDecisionMakerField.render(),this.isPoliticallyExposed.render(),this.uboDocumentsForm.render()]);return this},validate:function(){var m;var n;n=this.jobTitleField.validate()===undefined;m=n;return m},_createJobTitleField:function(){return new g({model:this.companyUbo,fieldName:h.Fields.JOB_TITLE,fieldLabel:c.get("jobTitle"),placeholder:c.get("selectJobTitle"),required:true,selectableOptions:[{value:"ceo",label:c.get("ceo")},{value:"cfo",label:c.get("cfo")},{value:"coo",label:c.get("coo")},{value:"shareholder",label:c.get("shareholder")},{value:"administrator",label:c.get("administrator")},{value:"companyManager",label:c.get("companyManager")},{value:"other",label:c.get("other")}]})},_createSharePercentageField:function(){var o;var n;var m;if(this.companyUbo.isNew()){o=this.totalShareholderPercentage}else{o=this.totalShareholderPercentage-this.companyUbo.getSharePercentage()}n=100-o;m=Math.max(25,n);return new l({model:this.companyUbo,fieldName:h.Fields.SHARE_PERCENTAGE,fieldLabel:c.get("sharePercentage"),min:25,max:m,step:1,required:true})},_createIsDecisionMakerField:function(){return new d({model:this.companyUbo,fieldName:h.Fields.IS_DECISION_MAKER,fieldLabel:c.get("isDecisionMaker"),useStringValue:true})},_createIsPoliticallyExposed:function(){return new d({model:this.companyUbo,fieldName:h.Fields.IS_POLITICALLY_EXPOSED,fieldLabel:c.get("isPoliticallyExposed"),useStringValue:true})},_createUboDocumentsForm:function(){return new b({companyUbo:this.companyUbo,kycDocuments:this.kycDocuments})}});return f});define("DS/MPFKycComponent/KycBankAccountInformationStripeEU",["DS/MPFKycComponent/KycBankAccountInformationStripe"],function(a){return a});define("DS/MPFKycComponent/KycCompanyUboFormModal",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFServices/ObjectService","DS/MPFAddressModel/AddressModel","DS/MPFAddressConstraintsModel/AddressConstraintsCollection","DS/MPFCompanyUboModel/CompanyUboModel","DS/MPFKYCDocumentModel/KycDocumentCollection","DS/MPFCountryModel/CountryCollection","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFKycComponent/KycCompanyUboPersonalInfoForm","DS/MPFKycComponent/KycCompanyUboShareInformationForm","DS/MPFError/ValidationError","DS/MPFError/BadArgumentError","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Alert","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(j,t,c,n,i,p,e,u,s,a,b,o,h,l,f,k,g,m,q){var d={};d.PAGE_1="page1";d.PAGE_2="page_2";var r=t.extend({className:"mpf-kyc-ubo-form",setup:function(v){v||(v={});n.requiredOfPrototype(v.companyUbo,e,"options.companyUbo must be a CompanyUboModel");n.requiredOfPrototype(v.kycDocuments,u,"options.kycDocuments must be a KycDocumentCollection");n.requiredOfPrototype(v.address,i,"options.addressFactory must be an AddressFactory");n.requiredOfPrototype(v.addressConstraints,p,"options.addressConstraints must be an AddressConstraintsCollection");n.requiredOfPrototype(v.countries,s,"options.countries must be an CountryCollection");if(!j.is(v.totalShareholderPercentage,"number")){throw new l("options.totalShareholderPercentage must be a number")}this.companyUbo=v.companyUbo;this.kycDocuments=v.kycDocuments;this.address=v.address;this.addressConstraints=v.addressConstraints;this.countries=v.countries;this.totalShareholderPercentage=v.totalShareholderPercentage;this.stateMachine=this._createStateMachine();this.pages=this._createPages();this.modal=this._createModal()},render:function(){var w;var v;w=this.stateMachine.getState();v=this.pages[w];this.modal.setBody(v.render());this.container.setContent(this.modal);return this},show:function(){this.modal.show()},hide:function(){this.modal.hide()},next:function(){var v;this.pages[d.PAGE_1].validate();if(this.pages[d.PAGE_1].canGoNext()){v=c.resolve(this._goToPage(d.PAGE_2))}else{v=c.reject(new h("validation failed to go to next page"))}return v},previous:function(){this._goToPage(d.PAGE_1)},save:function(){if(this.pages[d.PAGE_2].validate()){this._saveUbo().then(this._saveAddress.bind(this)).then(this._dispatchUboUpdate.bind(this)).then(this.hide.bind(this))["catch"](this._onSaveUboError.bind(this))}},cancel:function(){this._dispatchUboUpdate();this.hide()},_saveUbo:function(){var v;if(this.companyUbo.isNew()){v=this.companyUbo.savePromise()}else{if(this.companyUbo.hasPendingChanges()){v=this.companyUbo.savePromise(this.companyUbo.getPendingChanges(),{patch:true})}else{v=c.resolve(this.companyUbo)}}return v},destroy:function(){this.pages[d.PAGE_1].destroy();this.pages[d.PAGE_1]=null;this.pages[d.PAGE_2].destroy();this.pages[d.PAGE_2]=null;this.pages=null;this.modal=null;this.companyUbo=null;this.kycDocuments=null;this.address=null;this.addressConstraints=null;this.countries=null;this.stateMachine=null;this._parent()},_dispatchUboUpdate:function(){this.dispatchEvent("uboUpdate",this.companyUbo.id)},_goToPage:function(v){v=(v===d.PAGE_2)?d.PAGE_2:d.PAGE_1;this.stateMachine.changeState(v);this._updateAvailableCommands();this.render()},_onSaveUboError:function(){new m({messageClassName:"error",closable:true,visible:true,messages:q.get("errorSaveUBO")}).inject(this.modal.getBody(),"top")},_createStateMachine:function(){return new a({states:[d.PAGE_1,d.PAGE_2],state:d.PAGE_1,transitions:[{from:d.PAGE_1,to:d.PAGE_2},{from:d.PAGE_2,to:d.PAGE_1}]})},_createPages:function(){var v={};v[d.PAGE_1]=new b({companyUbo:this.companyUbo,address:this.address,addressConstraints:this.addressConstraints,countries:this.countries});v[d.PAGE_2]=new o({companyUbo:this.companyUbo,kycDocuments:this.kycDocuments,totalShareholderPercentage:this.totalShareholderPercentage});return v},_createModal:function(){var w;var v;w=j.createElement("h4",{text:q.get("addUbo")});v=this._createModalCommands();return new f({header:w,footer:v})},_createModalCommands:function(){var v;this.previousButton=this._createPreviousButton();this.nextButton=this._createNextButton();this.saveButton=this._createSaveButton();this.cancelButton=this._createCancelButton();this._updateAvailableCommands();v=j.createElement("div",{"class":"mpf-commands",html:[this.previousButton,this.nextButton,this.saveButton,this.cancelButton]});return v},_updateAvailableCommands:function(){var v;v=this.stateMachine.getState();if(v===d.PAGE_1){this.previousButton.hide();this.nextButton.show();this.saveButton.hide()}else{if(v===d.PAGE_2){this.previousButton.show();this.nextButton.hide();this.saveButton.show()}}},_createPreviousButton:function(){return new k({value:q.get("previous"),className:"default previous",events:{onClick:this.previous.bind(this)}})},_createNextButton:function(){return new k({value:q.get("next"),className:"primary next",events:{onClick:this.next.bind(this)}})},_createSaveButton:function(){return new k({value:q.get("save"),className:"primary save",events:{onClick:this.save.bind(this)}})},_createCancelButton:function(){return new k({value:q.get("cancel"),className:"default cancel",events:{onClick:this.cancel.bind(this)}})},_saveAddress:function(){var w;var v;v=this.address.validate()===undefined;if(v){this.address.setParentResourceId(this.companyUbo.id);w=this.address.savePromise()}else{w=Promise.resolve()}return w}});r.States=Object.freeze(d);return r});define("DS/MPFKycComponent/KycEmptySection",["DS/MPFKycComponent/KycSection","DS/MPFUtils/MPFUtils","DS/MPFView/EmptyView"],function(e,d,c){var b;var a;b=e.extend({className:"mpf-kyc-section mpf-empty",setup:d.doNothing,render:function(){return this},getBody:c.getInstance,setReadOnly:d.doNothing});b.getInstance=function(){a||(a=new b());return a};Object.freeze(b);return b});define("DS/MPFKycComponent/KycCompanyUbo",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFShopModel/ShopModel","DS/MPFCountryModel/CountryCollection","DS/MPFKYCDocumentModel/KycDocumentCollection","DS/MPFCompanyUboModel/CompanyUboCollection","DS/MPFModelFactory/CompanyUboFactory","DS/MPFModelFactory/AddressFactory","DS/MPFKycComponent/KycCompanyUboList","DS/MPFKycComponent/KycCompanyUboFormModal","DS/MPFView/FieldToggleInput","DS/UIKIT/Input/Button","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(b,n,c,o,l,h,e,k,j,m,i,g,a,f){var d=b.extend({className:"mpf-kyc-ubo",setup:function(p){p||(p={});n.requiredOfPrototype(p.company,c,"options.company must be a CompanyModel");n.requiredOfPrototype(p.kycDocuments,h,"options.kycDocuments must be a KycDocumentCollection");n.requiredOfPrototype(p.companyUbos,e,"options.companyUbos must be a CompanyUboCollection");n.requiredOfPrototype(p.companyUboFactory,k,"options.companyUboFactory must be a CompanyUboFactory");n.requiredOfPrototype(p.addressFactory,j,"options.addressFactory must be an AddressFactory");n.requiredOfPrototype(p.countries,l,"options.countries must be an CountryCollection");n.requiredOfPrototype(p.shop,o,"options.shop must be a ShopModel");this.company=p.company;this.shop=p.shop;this.kycDocuments=p.kycDocuments;this.companyUbos=p.companyUbos;this.companyUboFactory=p.companyUboFactory;this.addressFactory=p.addressFactory;this.countries=p.countries;this.isDSOperator=p.isDSOperator;this.companyUboList=this._createUboList();this.addCompanyUboButton=this._createAddCompanyUboButton();this.noShareHolderCheckbox=this._createNoShareHolderCheckbox();this._getTotalShareholderPercentage();this.listenTo(this.companyUboList,"editCompanyUbo",this.onEditCompanyUbo);this.listenTo(this.company,"onChange:"+c.Fields.NO_SHAREHOLDER,this.render.bind(this))},render:function(){this.container.setContent(this.companyUboList.render());if(this.company.getNoShareHolder()){this.container.addContent(this.noShareHolderCheckbox.render())}else{if(this.companyUbos.isEmpty()){this.container.addContent(this.addCompanyUboButton);this.container.addContent(this.noShareHolderCheckbox.render())}else{if(this.companyUbos.size()<4){this.container.addContent(this.addCompanyUboButton)}}}if(this.companyUboForm){this.container.addContent(this.companyUboForm.render())}return this},destroy:function(){this.stopListening(this.companyUboList);this.stopListening(this.company);this.company=null;this.shop=null;this.kycDocuments=null;this.companyUbos=null;this.companyUboFactory=null;this.addressFactory=null;this.countries=null;this.companyUboList.destroy();this.addCompanyUboButton.destroy();this.noShareHolderCheckbox.destroy();this._parent()},setReadOnly:function(p){this.addCompanyUboButton.setDisabled(p);this.noShareHolderCheckbox.setReadOnly(p)},onEditCompanyUbo:function(r){var s=this;var q;var p;q=this.companyUboFactory.createModel(k.Types.COMPANY_UBO,{id:r.id});return q.fetchPromise().then(function(){var t;t=q.getPostalAddressId();if(t){p=s.addressFactory.createModel(j.Types.address,{id:t});return p.fetchPromise()}else{p=s.addressFactory.createModel(j.Types.person)}}).then(function(){s._createCompanyUboForm(q,p);s.render();s.companyUboForm.show()})},onCreateCompanyUbo:function(){this._createNewCompanyUboForm();this.render();this.companyUboForm.show()},_createCompanyUboForm:function(p,q){this._destroyUboFormModalIfExists();this.companyUboForm=new i({companyUbo:p,address:q,addressConstraints:this.addressFactory.getConstraints(),kycDocuments:this.kycDocuments,countries:this.countries,totalShareholderPercentage:this._getTotalShareholderPercentage()});this.listenTo(this.companyUboForm,"uboUpdate",this._refreshUboList.bind(this))},_destroyUboFormModalIfExists:function(){if(this.companyUboForm){this.stopListening(this.companyUboForm);this.companyUboForm.destroy()}},_refreshUboList:function(r){var q;var p;p=this.companyUbos.get(r);if(p){q=p.fetchPromise().then(this.companyUboList.render.bind(this.companyUboList)).then(this._getTotalShareholderPercentage.bind(this)).then(this._hideNoShareHolderCheckbox.bind(this))}else{p=this.companyUboFactory.createModel(k.Types.COMPANY_UBO,{id:r});q=p.fetchPromise().then(this.companyUbos.add.bind(this.companyUbos,p)).then(this.companyUboList.addUbo.bind(this.companyUboList,p)).then(this.companyUboList.render.bind(this.companyUboList)).then(this._getTotalShareholderPercentage.bind(this)).then(this._hideNoShareHolderCheckbox.bind(this))}return q},_createUboList:function(){return new m({companyUbos:this.companyUbos,shop:this.shop})},_createAddCompanyUboButton:function(){return new a({className:"default mpf-kyc-ubo-add-button",value:f.get("addUbo"),icon:"user-add",events:{onClick:this.onCreateCompanyUbo.bind(this)}})},_createNewCompanyUboForm:function(){var q;var p;q=this.companyUboFactory.createModel(k.Types.COMPANY_COMPANY_UBO);q.setTitle("mr");q.setSharePercentage(25);q.setParentResourceId(this.company.id);q.setUboNumber(this.companyUbos.size()+1);p=this.addressFactory.createModel(j.Types.person);this._createCompanyUboForm(q,p)},_createEditCompanyUboForm:function(q){var p;p=this.companyUboFactory.createModel(k.Types.COMPANY_UBO,{id:q});return p.fetchPromise().then(function(){return new i({companyUbo:p,address:this.addressFactory.createModel(j.Types.person),addressConstraints:this.addressFactory.getConstraints(),kycDocuments:this.kycDocuments})})},_createNoShareHolderCheckbox:function(){return new g({model:this.company,fieldName:c.Fields.NO_SHAREHOLDER,fieldLabel:f.get("noShareHolder"),saveOnChange:true,readOnly:this.shop.getState()===o.States.SUBMITTED||this.shop.getState()===o.States.ACTIVE})},_getTotalShareholderPercentage:function(){var p=0;this.companyUbos.forEach(function(q){p+=parseInt(q.getSharePercentage(),10)});if(p>75||this.shop.getState()===o.States.SUBMITTED||this.shop.getState()===o.States.ACTIVE){this.addCompanyUboButton.disable()}else{this.addCompanyUboButton.enable()}return p},_hideNoShareHolderCheckbox:function(){this.noShareHolderCheckbox.container.setStyle("display","none")}});return d});define("DS/MPFKycComponent/KycSectionFactory",["UWA/Class","DS/MPFModelFactory/AddressFactory","DS/MPFAddressModel/AddressCollection","DS/MPFCompanyModel/CompanyModel","DS/MPFShopModel/ShopModel","DS/MPFKYCDocumentModel/KycDocumentCollection","DS/MPFKYCDocumentModel/KycDocumentModel","DS/MPFBankAccountModel/BankAccountModel","DS/MPFCompanyUboModel/CompanyUboCollection","DS/MPFModelFactory/CompanyUboFactory","DS/MPFCountryModel/CountryCollection","DS/MPFPspModel/PspModel","DS/MPFServices/ObjectService","DS/MPFUtils/MPFUtils","DS/MPFKycComponent/KycSection","DS/MPFKycComponent/KycCompanyLegalRepresentativeHiPay","DS/MPFKycComponent/KycCompanyLegalRepresentativeStripe","DS/MPFKycComponent/KycCompanyLegalRepresentativeStripeEU","DS/MPFKycComponent/KycBankAccountInformationHiPay","DS/MPFKycComponent/KycBankAccountInformationStripe","DS/MPFKycComponent/KycBankAccountInformationStripeEU","DS/MPFKycComponent/KycCompanyRegistrationInformationHiPay","DS/MPFKycComponent/KycCompanyRegistrationInformationStripe","DS/MPFKycComponent/KycCompanyRegistrationInformationStripeEU","DS/MPFKycComponent/KycCompanyNameAndAddress","DS/MPFKycComponent/KycCompanyUbo","DS/MPFKycComponent/KycEmptySection","i18n!DS/MPFKycComponent/assets/nls/KycComponent"],function(z,g,B,d,l,A,q,u,y,j,v,w,r,x,e,i,b,C,f,m,c,p,h,n,a,k,o,t){var s;s=z.extend({init:function(D){D||(D={});this._checkRequiredParameters(D);this.company=D.company;this.companyAddresses=D.companyAddresses;this.shop=D.shop;this.bankAccount=D.bankAccount;this.kycDocuments=D.kycDocuments;this.companyUbos=D.companyUbos;this.companyUboFactory=D.companyUboFactory;this.addressFactory=D.addressFactory;this.countries=D.countries;this.psp=D.psp;this.mpEventTopic=D.mpEventTopic;this.companyCountry=this.company.getAddresses().first().getCountry()},createCompanyLegalRepresentativeSection:function(){var F;var D;var E;if(this.psp.getPsp()===w.Psp.STRIPE){if(this.psp.getCountryPlatform()===w.Platform.STRIPE_EU){D=new C({company:this.company,kycDocuments:this.kycDocuments})}else{D=new b({company:this.company,kycDocuments:this.kycDocuments})}}else{D=new i({company:this.company,kycDocuments:this.kycDocuments});E=t.get("companyRegistrationInformationTooltip")}F=new e({title:t.get("companyLegalRepresentative"),body:D,tooltip:E});return F},createBankAccountDetailsSection:function(){var E;var D;this.bankAccount.set({country:this.companyCountry});if(this.psp.getPsp()===w.Psp.STRIPE){if(this.psp.getCountryPlatform()===w.Platform.STRIPE_EU){D=new c({bankAccount:this.bankAccount})}else{D=new m({bankAccount:this.bankAccount})}}else{D=new f({bankAccount:this.bankAccount,kycDocuments:this.kycDocuments})}E=new e({title:t.get("bankAccountDetails"),body:D});return E},createCompanyRegistrationInformation:function(){var E;var D;if(this.psp.getPsp()===w.Psp.STRIPE){if(this.psp.getCountryPlatform()===w.Platform.STRIPE_EU){D=new n({company:this.company,kycDocuments:this.kycDocuments})}else{D=new h({company:this.company,kycDocuments:this.kycDocuments})}}else{D=new p({company:this.company,companyAddress:this.companyAddresses.first(),kycDocuments:this.kycDocuments,shop:this.shop})}E=new e({title:t.get("companyRegistrationInformation"),body:D});return E},createCompanyNameAndAddressSection:function(){var E;var D;D=new a({company:this.company,companyAddresses:this.companyAddresses,countries:this.countries});E=new e({title:t.get("companyNameAndAddress"),body:D});return E},createCompanyUboSection:function(){var E;var D;if(this.psp.getPsp()===w.Psp.STRIPE){if(this.psp.getCountryPlatform()===w.Platform.STRIPE_EU){D=new k({company:this.company,kycDocuments:this.kycDocuments,companyUbos:this.companyUbos,companyUboFactory:this.companyUboFactory,addressFactory:this.addressFactory,countries:this.countries,isDSOperator:this.isDSOperator,shop:this.shop});E=new e({title:t.get("companyUbo"),body:D})}else{E=o.getInstance()}}else{D=new k({company:this.company,kycDocuments:this.kycDocuments,companyUbos:this.companyUbos,companyUboFactory:this.companyUboFactory,addressFactory:this.addressFactory,countries:this.countries,isDSOperator:this.isDSOperator,shop:this.shop});E=new e({title:t.get("companyUbo"),body:D})}return E},_checkRequiredParameters:function(D){r.requiredOfPrototype(D.company,d,"options.company must be a ComapnyModel");r.requiredOfPrototype(D.companyAddresses,B,"options.companyAddresses must be an AddressCollection");r.requiredOfPrototype(D.shop,l,"options.shop must be a ShopModel");r.requiredOfPrototype(D.bankAccount,u,"options.bankAccount must be an BankAccountModel");r.requiredOfPrototype(D.kycDocuments,A,"options.kycDocuments must be a KycDocumentCollection");r.requiredOfPrototype(D.companyUbos,y,"options.companyUbos must be a CompanyUboCollection");r.requiredOfPrototype(D.companyUboFactory,j,"options.companyUboFactory must be a CompanyUboFactory");r.requiredOfPrototype(D.addressFactory,g,"options.addressFactory must be an AddressFactory");r.requiredOfPrototype(D.countries,v,"options.countries must be a CountryCollection");r.requiredOfPrototype(D.psp,w,"options.psp must be a PspModel")}});return s});define("DS/MPFKycComponent/KycPage",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/PlatformAPI/PlatformAPI","DS/MPFKycComponent/KycPageCompletion","DS/MPFModelFactory/AddressFactory","DS/MPFAddressModel/AddressCollection","DS/MPFCompanyModel/CompanyModel","DS/MPFShopModel/ShopModel","DS/MPFKYCDocumentModel/KycDocumentCollection","DS/MPFBankAccountModel/BankAccountModel","DS/MPFCompanyUboModel/CompanyUboCollection","DS/MPFModelFactory/CompanyUboFactory","DS/MPFCountryModel/CountryCollection","DS/MPFPspModel/PspModel","DS/MPFServices/ObjectService","DS/MPFKycComponent/KycSection","DS/MPFKycComponent/KycSectionFactory","DS/MPFKycComponent/KycPageInformation","DS/MPFKycComponent/KycOperatorEditButton","i18n!DS/MPFKycComponent/assets/nls/KycComponent","css!DS/MPFUI/MPFUI","css!DS/MPFKycComponent/MPFKycComponent"],function(g,s,k,b,e,h,v,c,j,u,p,t,i,q,r,m,d,o,l,f,n){var a;a=s.extend({className:"mpf-kyc-page",setup:function(w){w||(w={});this._checkRequiredParameters(w);this.company=w.company;this.companyAddresses=w.companyAddresses;this.bankAccount=w.bankAccount;this.kycDocuments=w.kycDocuments;this.companyUbos=w.companyUbos;this.companyUboFactory=w.companyUboFactory;this.addressFactory=w.addressFactory;this.countries=w.countries;this.mpEventTopic=w.mpEventTopic;this.isDSOperator=w.isDSOperator;this.shop=w.shop;this.psp=w.psp;this.sectionFactory=this._createKycSectionFactory();this.informationSection=this._createPageInformationSection();this.companyNameAndAddressSection=this.sectionFactory.createCompanyNameAndAddressSection();this.bankAccountDetailsSection=this.sectionFactory.createBankAccountDetailsSection();this.legalRepresentativeSection=this.sectionFactory.createCompanyLegalRepresentativeSection();this.companyRegistrationInformationSection=this.sectionFactory.createCompanyRegistrationInformation();this.companyUboSection=this.sectionFactory.createCompanyUboSection();this.listenTo(this.company,"onChange",this.checkCompleted.bind(this));this.listenTo(this.bankAccount,"onChange",this.checkCompleted.bind(this));this.listenTo(this.kycDocuments,"onChange",this.checkCompleted.bind(this));this.listenTo(this.companyUbos,"onChange",this.checkCompleted.bind(this));this.checkCompleted();if(this.isDSOperator){this.operatorEditButton=new f({bankAccountDetailsSection:this.bankAccountDetailsSection,legalRepresentativeSection:this.legalRepresentativeSection,companyRegistrationInformationSection:this.companyRegistrationInformationSection,companyUboSection:this.companyUboSection,isReadOnly:true})}},render:function(){this.container.setContent([this.informationSection.render(),this.companyNameAndAddressSection.render(),this.bankAccountDetailsSection.render(),this.legalRepresentativeSection.render(),this.companyRegistrationInformationSection.render(),this.companyUboSection.render()]);if(this.isDSOperator){this.operatorEditButton.render().inject(this.container,"top")}return this},checkCompleted:function(){var x;var w;x=e.isCompleted({psp:this.psp,company:this.company,kycDocuments:this.kycDocuments,bankAccount:this.bankAccount,companyUbos:this.companyUbos});if(this.mpEventTopic){w=x?"complete":"inactive";b.publish(this.mpEventTopic,{event:"updateMenu",id:"kyc",status:w})}return x},destroy:function(){this.stopListening(this.company);this.stopListening(this.bankAccount);this.stopListening(this.kycDocuments);this.stopListening(this.companyUbos);this.company=null;this.bankAccount=null;this.kycDocuments=null;this.companyUbos=null;this.informationSection.destroy();this.companyNameAndAddressSection.destroy();this.bankAccountDetailsSection.destroy();this.legalRepresentativeSection.destroy();this.companyRegistrationInformationSection.destroy();this.companyUboSection.destroy();this._parent()},_checkRequiredParameters:function(w){m.requiredOfPrototype(w.company,c,"options.company must be a ComapnyModel");m.requiredOfPrototype(w.companyAddresses,v,"options.companyAddresses must be an AddressCollection");m.requiredOfPrototype(w.bankAccount,p,"options.bankAccount must be an BankAccountModel");m.requiredOfPrototype(w.kycDocuments,u,"options.kycDocuments must be a KycDocumentCollection");m.requiredOfPrototype(w.companyUbos,t,"options.companyUbos must be a CompanyUboCollection");m.requiredOfPrototype(w.companyUboFactory,i,"options.companyUboFactory must be a CompanyUboFactory");m.requiredOfPrototype(w.addressFactory,h,"options.addressFactory must be an AddressFactory");m.requiredOfPrototype(w.countries,q,"options.countries must be a CountryCollection");m.requiredOfPrototype(w.shop,j,"options.shop must be a ShopModel");m.requiredOfPrototype(w.psp,r,"options.psp must be a PspModel")},_createKycSectionFactory:function(){return new o({company:this.company,companyAddresses:this.companyAddresses,shop:this.shop,bankAccount:this.bankAccount,kycDocuments:this.kycDocuments,companyUbos:this.companyUbos,companyUboFactory:this.companyUboFactory,addressFactory:this.addressFactory,countries:this.countries,psp:this.psp})},_createPageInformationSection:function(){return new l({company:this.company,psp:this.psp})}});a.isCompleted=e.isCompleted;return a});define("DS/MPFKycComponent/KycPageFactory",["UWA/Core","UWA/Promise","DS/MPFKycComponent/KycPage","DS/MPFDataProxy/Connector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFModelFactory/PersonFactory","DS/MPFModelFactory/ShopFactory","DS/MPFModelFactory/AddressFactory","DS/MPFModelFactory/CompanyUboFactory","DS/MPFModelFactory/PspFactory","DS/MPFServices/ObjectService"],function(i,j,a,b,l,e,k,d,c,g,h){var f;f=i.Class.extend({init:function(m){h.requiredOfPrototype(m.connector,b,"options.connector must be a Connector");this.connector=m.connector;this.mpEventTopic=m.mpEventTopic;this.factories=l.getInstance(this.connector)},fromMe:function(){var m=this;return this._initFactories().then(function(){return j.all([m._fetchMeThenCompanyThenUbos(),m._fetchShopsThenPspAndKycDocs(),m._fetchCountries()])}).then(function(){return j.all([m._getCompanyAddressesAsCollection(),m._assignCountrytoBankAccount()])}).then(this._buildKycPage.bind(this))},fromShopId:function(n){var m=this;return this._initFactories().then(function(){return j.all([m._fetchPsp(n),m._fetchShopThenCompanyThenUbos(n),m._fetchShopDocuments(n),m._fetchMe(),m._fetchCountries()])}).then(function(){return j.all([m._getCompanyAddressesAsCollection(),m._assignCountrytoBankAccount()])}).then(this._buildKycPage.bind(this))},_fetchMeThenCompanyThenUbos:function(){return this._fetchMe().then(this._fetchMyCompany.bind(this)).then(this._fetchCompanyUbos.bind(this))},_fetchShopsThenPspAndKycDocs:function(){var m=this;return this._fetchMyShops().then(this._fetchMyShop.bind(this)).then(function(){return j.all([m._fetchPsp(),m._fetchShopDocuments()])})},_fetchShopThenCompanyThenUbos:function(n){var m=this;return this._fetchShop(n).then(this._fetchCompanyFromShop.bind(this)).then(m._fetchCompanyUbos.bind(this))},_initFactories:function(){var m=this;return j.all([this.factories.getFactory(l.Types.PERSON),this.factories.getFactory(l.Types.COMPANY),this.factories.getFactory(l.Types.SHOP),this.factories.getFactory(l.Types.KYC_DOCUMENT),this.factories.getFactory(l.Types.BANK_ACCOUNT),this.factories.getFactory(l.Types.ADDRESS),this.factories.getFactory(l.Types.COMPANY_UBO),this.factories.getFactory(l.Types.COUNTRY),this.factories.getFactory(l.Types.PSP)]).then(function(n){m.personFactory=n[0];m.companyFactory=n[1];m.shopFactory=n[2];m.kycDocumentFactory=n[3];m.bankAccountFactory=n[4];m.addressFactory=n[5];m.companyUboFactory=n[6];m.countryFactory=n[7];m.pspFactory=n[8]})},_fetchMe:function(){this.me=this.personFactory.createModel(e.Types.ME);return this.me.fetchPromise()},_fetchMyCompany:function(){var m;m=this.me.getCompany();return this._fetchCompanyFromRef(m)},_fetchCompanyFromRef:function(m){var o;var n;o=m.match(/[A-Z0-9]{32}$/)||[];n=o.pop();this.company=this.companyFactory.createModel(null,{id:n},{addressFactory:this.addressFactory});return this.company.fetchPromise({expand:["addresses","registrations","uboPersons"]})},_fetchMyShops:function(){this.shops=this.shopFactory.createCollection(k.Types.ME);return this.shops.fetchPromise({expand:[]})},_fetchMyShop:function(){this.shop=this.shops.first();return j.resolve(this.shop)},_fetchCountries:function(){this.countries=this.countryFactory.createCollection("buyer");return this.countries.fetchPromise()},_fetchShopDocuments:function(n){var m=i.is(n,"string")?n:this.shop.id;this.kycDocuments=this.kycDocumentFactory.createCollection("shop");this.kycDocuments.parentResourceId=m;this.bankAccount=this.bankAccountFactory.createModel();this.bankAccount.parentResourceId=m;this.bankAccountConstraints=this.bankAccountFactory.getConstraints();return j.all([this.kycDocuments.fetchPromise(),this.bankAccount.fetchPromise()])},_getCompanyAddressesAsCollection:function(){this.companyAddresses=this.addressFactory.createCollection(d.Types.COMPANY,this.company.addresses.toArray());this.companyAddresses.parentResourceId=this.company.id},_assignCountrytoBankAccount:function(){var m;m=this.company.addresses.first();this.bankAccount.set("country",m.get("country"))},_fetchShop:function(m){this.shop=this.shopFactory.createModel(k.Types.SHOP,{id:m});return this.shop.fetchPromise({expand:[]})},_fetchCompanyFromShop:function(){var m;m=this.shop.getOwner();return this._fetchCompanyFromRef(m)},_fetchCompanyUbos:function(m){this.companyUbos=this.companyUboFactory.createCollection(c.Types.COMPANY_COMPANY_UBO,this.company.getUboPersons());this.companyUbos.setParentResourceId(this.company.id);return this.companyUbos},_fetchPsp:function(n){this.psp=this.pspFactory.createModel(g.Types.SHOP_PSP);var m=i.is(n,"string")?n:this.shop.id;this.psp.setParentResourceId(m);return this.psp.fetchPromise()},_buildKycPage:function(){return new a({mpEventTopic:this.mpEventTopic,company:this.company,companyAddresses:this.companyAddresses,kycDocuments:this.kycDocuments,bankAccount:this.bankAccount,bankAccountConstraints:this.bankAccountConstraints,companyUbos:this.companyUbos,companyUboFactory:this.companyUboFactory,addressFactory:this.addressFactory,countries:this.countries,shop:this.shop,isDSOperator:this.me.isDSOperator(),psp:this.psp})}});return f});