define("DS/Usage/Events",function(){return{counter:{increment:"counter:increment"},timer:{start:"timer:start",stop:"timer:stop"},tracker:{creation:"tracker:creation",update:"tracker:update",getContent:"tracker:get-content",gotContent:"tracker:got-content"},page:{view:"page:view",event:"page:event"},data:{register:"data:register"}}});define("DS/Usage/UsageManager",["UWA/Utils","DS/WebappsUtils/Inherit","DS/WebappsUtils/Utils","DS/Usage/Events"],function(e,f,c,k){var r="_dsut";var y="_dsus";var l="_dsu";var j="_dss";var b=(function(){var A=window.location;return A.protocol+"//"+A.hostname+(A.port?":"+A.port:"")}());var n=30;var q=5000;var d=5000;var m=1000;var v=500;var p={themKey:"webapp",user:null,newVisitor:null};var u=(function(){var A=document.createElement("a");return function(B){A.href=B;return A.href}}());function w(){var D=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/g,B=e.parseUrl(window.location).domain,C,A="";if(!D.test(B)&&B!=="localhost"){C=B.split(".");if(C.length>2){C.shift()}A=C.join(".")}return A}function o(){var D=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/g,B=e.parseUrl(window.location).domain,C,A="";if(!D.test(B)&&B!=="localhost"){C=B.split(".");while(C.length>2){C.shift()}A=C.join(".")}return A}function h(){return{version:"1.27",r_schemaName:"WAPUsage",r_schemaVersion:"1.27",r_service:p.service,r_timestamp:Date.now(),them:p.themKey,sessionID:p.sessionID,user:p.user,casUser:p.authUser?c.sha256(p.authUser):"",newVisitor:p.newVisitor,service:p.service,referrer:p.referrer,serverhostname:window.location.hostname,context:{engine:c.clientEngine,platform:c.clientPlatform,navigation:{type:c.navigationType,startTime:p.navigationStart,browseTime:Date.now()-p.navigationStart},locale:navigator.language||"en-US"}}}function t(){var E,B=false,F=c.getCookie(y),A=c.getCookie(r),C=o(),D=w();if(F){c.setCookie(j,F,C,p.sessionDuration)}if(A){c.setPersistantCookie(l,A,C)}E=c.getCookie(j);if(!E){E=c.uuid();this.clearHeaderData();this.clearData()}c.setCookie(j,E,C,p.sessionDuration);p.sessionID=E;p.user=c.getCookie(l);if(!p.user){p.user=c.uuid();p.newVisitor=true}else{p.newVisitor=false}c.setPersistantCookie(l,p.user,C)}function s(D,B){var A,C;if(B.findIndex){A=B.findIndex(function(E){return E.name===D.name})}else{A=-1;for(C=0;C<B.length;C++){if(B[C].name===D.name){A=C;break}}}return A}function g(D,A,B,C){var E=s(D.data,C),F=D.origin,G=f.clone(D);G.topic=B;G.data=C[E];G.origin=b;G.forAPI=true;A.source.postMessage(JSON.stringify(G),F)}function a(){var A=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"],C={},B=e.parseQuery(window.location.search);if(!B){return C}A.forEach(function(D){if(B.hasOwnProperty(D)){C[D]=B[D]}});return C}function x(J,C){var E=[],A,B,D,G,F,I,H;J.forEach(function(K){G=K.name&&K.name.split(":");B="legacy_category";D="legacy_action";if(G&&G.length>=2){B=G.shift();D=G.join(":")}if(G&&G.length==1){D=G[0]}K.timestamps&&K.timestamps.forEach(function(L){A={id:c.uuid(),category:B,action:D,timestamp:L,persDimPageEvents:[{pd1:"Legacy",}]};if(K.appID){A.appID=K.appID}if(K.tenant){A.tenant=K.tenant}E.push(A)})});if(E.length){if(C.length==1){C[0].events=C[0].events&&C[0].events.concat&&C[0].events.concat(E)}else{E.forEach(function(K){for(H=0;H<C.length;H++){F=C[H];I=(H==C.length-1)?{timestamp:K.timestamp+1}:C[H+1];if(F.timestamp-K.timestamp<=0&&I.timestamp-K.timestamp>0){F.events.push(K);F.events.sort(function(M,L){return M.timestamp-L.timestamp})}}})}}}var i={scrollable:function(A){return A.clientWidth<A.offsetWidth||A.style.overflowY=="scroll"||A.style.overflowY=="auto"},getAppScrollableContainer:function(B){var A=B,C;while(A){if(A.clientHeight<A.scrollHeight&&this.scrollable(A)){C=A}A=A.parentNode}return C?C:document.body},containerHeight:function(B){var C=Math.max(B.scrollHeight,B.offsetHeight,B.clientHeight);var A=B.getBoundingClientRect().top;return A+C},containerWidth:function(A){var C=Math.max(A.scrollWidth,A.offsetWidth,A.clientWidth);var B=A.getBoundingClientRect().left;return B+C},viewportTop:function(A){return A.scrollTop},viewportBottom:function(A){return this.viewportTop(A)+(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)},viewportLeft:function(A){return A.scrollLeft},viewportRight:function(A){return this.viewportLeft(A)+(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)}};var z={pages:[],interactions:[],data:{},trackers:[],getTrackers:function(A){return this.trackers.filter(function(B){return B.type===A})},clearData:function(){this.interactions=[];if(this.pages.length){this.pages=this.pages.slice(-1);this.pages[this.pages.length-1].events=[]}this.trackers=this.trackers.filter(function(A){return A.type!=="counter"})},clearHeaderData:function(){this.setConfiguration({navigationStart:Date.now(),newVisitor:null,sessionID:null,})},send:function(){var C=this,D=h(),E=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"xhr";if(D.context.navigation.browseTime<0){return}x(this.getTrackers("counter"),this.pages);D.context.navigation.pages=this.pages&&this.pages.map(function(G){var F={};["id","url","title","timestamp","tenant","appID","events","persDimPages","persValPages","pagelg"].forEach(function(H){if(G[H]){F[H]=G[H]}});F.events=F.events&&F.events.map(function(H){var I={};["id","category","action","timestamp","label","value","tenant","appID","persDimPageEvents","persValPageEvents"].forEach(function(J){if(H[J]){I[J]=H[J]}});return I});return F});var A={};["authUser","campaignId","utm_campaign","utm_content","utm_medium","utm_source","utm_term","pd1","pd2","pd3","pd4","pd5","pd6","pd7","pd8","pd9","pd10","pd11","pd12","pd13","pd14","pd15","pd16","pd17","pd18","pd19","pd20"].forEach(function(F){if(C.data[F]){A[F]=C.data[F]}});D.data=A;D.stats={};D.stats.counters=[];D.stats.timers=this.getTrackers("timer")&&this.getTrackers("timer").map(function(F){return f.extend({id:F.name,value:F.duration?F.duration:-1},F)}).filter(function(F){return F.value>-1});D.stats.interactions=this.interactions&&this.interactions.map(function(F){var G={};["id","className","tagName","clientX","clientY","action","timestamp","tenant","appID","viewportTop","viewportBottom","viewportLeft","viewportRight","pageWitdh","pageHeight","pageid"].forEach(function(H){if(typeof F[H]!=="undefined"){G[H]=F[H]}});return G});D=JSON.stringify(D);this.clearData();if(E==="beacon"){if(!navigator.sendBeacon){return c.beaconPolyfill(p.uploadPath,D)}else{return navigator.sendBeacon(p.uploadPath,D)}}else{var B=new XMLHttpRequest();B.open("POST",p.uploadPath);B.setRequestHeader("Content-Type","application/json");return B.send(D)}},updateTracker:function(B,D){var A=s(D,this.trackers),C=this.trackers[A];switch(B){case k.tracker.update:f.extend(C,D);break;case k.counter.increment:if(!C.timestamps){C.timestamps=[]}C.timestamps.push(Date.now());break;case k.timer.start:C.start<0&&(C.start=D.start);break;case k.timer.stop:if((C.start>=0&&C.stop<0)){C.stop=D.stop;C.duration=C.stop-C.start}break;default:break}},setUserInteraction:function(B){var D=B&&B.target,A,C;if(!D){return}C=i.getAppScrollableContainer(D);if(B.type==="scroll"&&C!==D){return}A={action:B.type,timestamp:Date.now(),pageid:this.pages[this.pages.length-1].id,viewportTop:i.viewportTop(C),viewportBottom:i.viewportBottom(C),viewportLeft:i.viewportLeft(C),viewportRight:i.viewportRight(C),pageWitdh:i.containerWidth(C),pageHeight:i.containerHeight(C)};["id","className","tagName"].forEach(function(F){var E=D[F];if(E&&(typeof E==="string"||E instanceof String)){A[F]=D[F]}});["clientX","clientY"].forEach(function(E){if(B[E]){A[E]=B[E]}if(B.touches&&B.touches[0]&&B.touches[0][E]){A[E]=B.touches[0][E]}});this.interactions.push(A);this.interactions=this.interactions.slice(0,100);this.sendDebounced()},readMessage:function(A){var G={},F,B,E=true,C;try{G=JSON.parse(A.data)}catch(D){}if(G.forAPI||!G.topic){return}A.stopPropagation();B=G.topic.split(":");B=B.length>2?B.slice(0,2):B;B=B.join(":");switch(B){case k.tracker.creation:(s(G.data,this.trackers)===-1)&&this.trackers.push(G.data);break;case k.page.view:G.data.events=[];G.data.id=c.uuid();this.pages.push(G.data);this.pages=this.pages.slice(0,100);this.pages.sort(function(H,I){return H.timestamp-I.timestamp});break;case k.page.event:C=this.pages[this.pages.length-1];G.data.id=c.uuid();C?C.events.push(G.data):console.log("UsageManager > You need to track page view before tracking a page event.");C.events=C.events.slice(0,100);break;case k.data.register:f.extend(this.data,G.data);break;case k.tracker.getContent:E=false;F=G.topic.split(k.tracker.getContent+":")[1];F&&g(G,A,k.tracker.gotContent+":"+F,this.trackers);break;default:this.updateTracker(G.topic,G.data,this.trackers);break}E&&this.sendDebounced()},setConfiguration:function(B){var A=f.clone(B||{});if(A.uploadPath){A.uploadPath=u(A.uploadPath)}if(A.sendDebounceRate){this.sendDebounced=c.debounce(this.send.bind(this),A.sendDebounceRate)}f.extend(p,A)},init:function(){var A,B=this,D=false;if(typeof arguments[0]==="string"){A={uploadPath:arguments[0],service:arguments[1],user:arguments[2]}}else{A=arguments[0]||{}}try{window.top.location.protocol}catch(C){D=true}if(D){return}p.uploadPath=u(A.uploadPath);p.service=A.service;p.authUser=A.user&&A.user.login||"";p.sessionDuration=A.sessionDuration||n;p.sendDebounceRate=A.sendDebounceRate||q;p.userActivityThrottleRate=A.userActivityThrottleRate||d;p.userInteractionThrottleRate=A.userInteractionThrottleRate||m;p.userInteractionDebounceRate=A.userInteractionDebounceRate||v;p.navigationStart=(!window.performance||(window.performance&&!window.performance.timing))?Date.now():window.performance.timing.navigationStart;window.addEventListener("beforeunload",B.send.bind(B,"beacon"));window.addEventListener("message",B.readMessage.bind(B));window.addEventListener("mousemove",c.throttle(t.bind(B),p.userActivityThrottleRate,false,true));["click","dblclick","contextmenu","touchstart","touchend"].forEach(function(E){window.addEventListener(E,c.throttle(B.setUserInteraction.bind(B),p.userInteractionThrottleRate,true),true)});["scroll","mousemove","touchmove"].forEach(function(E){window.addEventListener(E,c.debounce(B.setUserInteraction.bind(B),p.userInteractionDebounceRate),true)});B.sendDebounced=c.debounce(B.send.bind(B),p.sendDebounceRate);setTimeout(function(){t.call(B);f.extend(B.data,a());p.referrer=document.referrer;B.send();p.referrer=""},0)}};return z});define("DS/Usage/AbstractTracker",["DS/WebappsUtils/Inherit","DS/WebappsUtils/Promise","DS/WebappsUtils/Emitter","DS/Usage/Events"],function(b,e,d,a){function c(f){this.name=f}b.inherit(c,{set:function(f,h){var g;if(typeof f==="object"){g=f;h=undefined}else{g={};g[f]=h}if(Object.keys(g).length>0){g.name=this.name;g.type=this.type;d.trigger(a.tracker.update,g)}},get:function(){var f=this;return new e(function(i){var h=a.tracker.gotContent+":"+f.name;var g=a.tracker.getContent+":"+f.name;d.on(h,function(j){d.off(h);if(j&&j.data){if(j.data.name===f.name){i(j.data)}}});d.trigger(g,{name:f.name})})}});return c});define("DS/Usage/CounterTracker",["DS/WebappsUtils/Inherit","DS/WebappsUtils/Emitter","DS/Usage/AbstractTracker","DS/Usage/Events","DS/WebappsUtils/Promise","DS/WebappsUtils/Console"],function(c,e,d,b,f,a){function g(h){a.warn("Module DS/Usage/CounterTracker is deprecated. Use DS/Usage/TrackerAPI#trackPageEvent instead");d.call(this,h);this.type="counter"}c.inherit(g,d,{inc:function(){e.trigger(b.counter.increment,{name:this.name,type:this.type})},getCounter:function(){return this.get().then(function(h){if(typeof h.counter==="number"){return f.resolve(h.counter)}throw new Error("no counter")})}});return g});define("DS/Usage/ActionTracker",["DS/WebappsUtils/Inherit","DS/Usage/AbstractTracker","DS/WebappsUtils/Console"],function(b,d,a){function c(e){a.warn("Module DS/Usage/ActionTracker is deprecated. Use DS/Usage/TrackerAPI#trackPageEvent instead");d.call(this,e);this.type="action"}b.inherit(c,d);return c});define("DS/Usage/TimerTracker",["DS/WebappsUtils/Inherit","DS/WebappsUtils/Promise","DS/WebappsUtils/Console","DS/WebappsUtils/Emitter","DS/WebappsUtils/Performance","DS/Usage/AbstractTracker","DS/Usage/Events"],function(c,h,a,f,d,e,b){function g(i){a.warn("Module DS/Usage/TimerTracker is deprecated. Use DS/Usage/TrackerAPI#trackPageEvent instead");e.call(this,i);this.type="timer"}c.inherit(g,e,{start:function(){f.trigger(b.timer.start,{name:this.name,type:this.type,start:d.now()})},stop:function(){f.trigger(b.timer.stop,{name:this.name,type:this.type,stop:d.now()})},getStart:function(){return this.get().then(function(i){if(typeof i.start==="number"&&i.start>=0){return i.start}else{throw new Error("timer not started")}})},getStop:function(){return this.get().then(function(i){if(typeof i.stop==="number"&&i.stop>=0){return i.stop}else{throw new Error("timer not stopped")}})},getDuration:function(){return this.get().then(function(i){if(typeof i.duration==="number"&&i.duration>=0){return i.duration}else{throw new Error("timer neither started nor stopped")}})}});return g});define("DS/Usage/TrackerAPI",["DS/WebappsUtils/Inherit","DS/WebappsUtils/Emitter","DS/Usage/CounterTracker","DS/Usage/TimerTracker","DS/Usage/ActionTracker","DS/Usage/Events"],function(c,l,h,e,m,p){var a=false,i=(function(){var q=window.location,r=window.top.location;try{r.protocol}catch(s){a=true}if(a){return{}}return{current:q.protocol+"//"+q.hostname+(q.port?":"+q.port:""),parent:r.protocol+"//"+r.hostname+(r.port?":"+r.port:"")}}()),g=window.top;function j(r,q){var s;if(typeof r==="object"){s=r}else{if(typeof r==="string"&&!q){s={name:r}}else{if(typeof r==="string"&&typeof q==="object"){s=q;s.name=r}else{throw new TypeError("Invalid Tracker paramaters")}}}return s}function b(q){return typeof q==="string"||q instanceof String}function o(q){return typeof q==="number"&&isFinite(q)}function d(q){return typeof q==="boolean"}function n(q){return q&&typeof q==="object"&&q.constructor===Object}function k(r){var q=true,s;if(!n(r)){return false}if(Object.keys(r).length==0){return false}if(Object.keys(r).length>=20){return false}for(var t in r){if(!r.hasOwnProperty(t)){continue}if(!/^(pd|pv)[0-9]+$/.test(t)){q=false}s=r[t];if(!b(s)){q=false}}return q}var f={getCounter:function(r,q){q=j(r,q);q.type="counter";this.notify(q,p.tracker.creation);return new h(r)},getTimer:function(r,q){q=j(r,q);q.type="timer";q.start=-1;q.stop=-1;this.notify(q,p.tracker.creation);return new e(r)},getTracker:function(){var s=arguments,t=s[0],r=s[1],q=s[2],u,w;if(q===undefined&&typeof r==="object"){q=r;r=t;t="action"}else{if(q===undefined&&typeof r==="string"){q={}}else{if(r===undefined&&q===undefined){if(typeof t==="string"){r=t;t="action";q={}}else{w=c.clone(t);r=w.name;t=w.type;q=w.options||{}}}}}if(r===undefined){throw new TypeError("No tracker name specified")}switch(t){case"counter":u=this.getCounter(r,q);break;case"timer":u=this.getTimer(r,q);break;case"action":var v=q;v.name=r;this.notify(v,p.tracker.creation);u=new m(r);break;default:break}return u},trackPageView:function(u,r,w,s,q){var v=arguments[0];if(n(v)){u=v.pageURL;r=v.pageTitle;w=v.persDim;s=v.pageLanguage;q={persVal:v.persVal,appID:v.appID,tenant:v.tenant}}if(a||!u||!b(u)){return}var t={origin:i.current,topic:p.page.view,data:{url:u,timestamp:Date.now(),persDimPages:[],pagelg:(s)?s:(window.dsLang)?window.dsLang:""}};if(r&&b(r)){t.data.title=r}if(w&&k(w)){t.data.persDimPages=[w]}if(q&&n(q)&&k(q.persVal)){t.data.persValPages=[q.persVal]}if(q&&n(q)&&q.appID){t.data.appID=q.appID}if(q&&n(q)&&q.tenant){t.data.tenant=q.tenant}g.postMessage&&g.postMessage(JSON.stringify(t),i.parent)},trackPageEvent:function(q,t,s,w,x,r){var v=arguments[0];if(n(v)){q=v.eventCategory;t=v.eventAction;s=v.eventLabel;w=v.eventValue;x=v.persDim;r={persVal:v.persVal,appID:v.appID,tenant:v.tenant}}if(a||!q||!b(q)||!t||!b(t)){return}var u={origin:i.current,topic:p.page.event,data:{category:q,action:t,timestamp:Date.now(),persDimPageEvents:[]}};if(s&&b(s)){u.data.label=s}if(w&&o(w)){u.data.value=w}if(x&&k(x)){u.data.persDimPageEvents=[x]}if(r&&n(r)&&k(r.persVal)){u.data.persValPageEvents=[r.persVal]}if(r&&n(r)&&r.appID){u.data.appID=r.appID}if(r&&n(r)&&r.tenant){u.data.tenant=r.tenant}g.postMessage&&g.postMessage(JSON.stringify(u),i.parent)},registerData:function(){var q=arguments,r,s;if(a||!q.length){return}if(q.length===1&&typeof q[0]==="object"){r=q[0]}else{if(q.length>1){r={};r[q[0]]=q[1]}}if(!r){return}s={origin:i.current,topic:p.data.register,data:r};g.postMessage&&g.postMessage(JSON.stringify(s),i.parent)},notify:function(r,q){if(a){return}var s={origin:i.current,topic:q,data:r};g.postMessage&&g.postMessage(JSON.stringify(s),i.parent)},init:function(){if(a){return}var q=this;if(!this._initiated){this._initiated=true;l.on("*",function(r,s){if(!s.forAPI){q.notify(c.clone(s),r)}});window.addEventListener("message",function(r){var t={};try{t=JSON.parse(r.data)}catch(s){}if(!t.forAPI){return}r.stopPropagation();l.trigger(t.topic,t)})}}};f.init();return f});