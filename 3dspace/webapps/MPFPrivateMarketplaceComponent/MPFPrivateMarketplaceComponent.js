define("DS/MPFPrivateMarketplaceComponent/EnterpriseMarketplaceCreationComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFView/FieldTextInputV2","DS/MPFView/InformationTooltip","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFPrivateMarketplaceComponent/MPFPrivateMarketplaceComponent","css!DS/MPFUI/MPFUI"],function(f,c,i,d,g,a,b,e,j){var h=c.extend({className:"mpf-enterprise-marketplace-creation-widget",setup:function(l){var m;var k;l||(l={});this._parent(l);g.requiredOfPrototype(this.model,a,"this.model must be a CompanyModel");this.urlPrefix=l.urlPrefix||window.location.origin+"/my-company?esid=";m=this.model.getName();k=(typeof m==="string")&&(m.length>0);this.companyNameInput=this._createCompanyNameInput(k);if(this.model.getName()){this.model.setName(this.model.getName())}this.empNameInput=this._createEMPNameInput();this.createButton=this._createCreateButton();this.banner=this._createBanner();this.body=this._createBody()},render:function(){this.container.setContent([this.banner,this.body]);return this},validate:function(){var m=this.model.getEmpUrl();var l;var k;l=this.companyNameInput.validate().isValid;k=this.empNameInput.validate().isValid;return l&&k&&(m&&m.length>0)},save:function(){var l=this;var k;this.generatePrivateMpUrl();if(this.validate()&&this.model.hasPendingChanges()){d.mask(this.container);this.model.set(a.Fields.EMP_PROJECT_NAME,this.model.getEmpUrl().split("?esid=").pop());k=this.model.isNew()?null:this.model.getPendingChanges();return this.model.savePromise(k,{patch:!this.model.isNew()}).then(function(){window.location.href="/my-company?esid="+l.model.getEmpProjectName()})["catch"](function(){d.unmask(l.container)})}},generatePrivateMpUrl:function(){var l;var k;l=this.model.getName();if(l&&l.length>0){k=this.urlPrefix+this._createPathFromName(l);this.model.set(a.Fields.EMP_URL,k,{silent:true})}},_createPathFromName:function(k){var l;k||(k="");l=k.replace(/[^\w.-]/,"");l=l.toLowerCase();l=l.replace(/\s+/g,"-");return l},_createCreateButton:function(){return new i({className:"primary",value:j.get("createEnterpriseService"),events:{onClick:this.save.bind(this)}})},_createEMPNameInput:function(){return new b({required:true,model:this.model,fieldName:a.Fields.EMP_NAME,fieldLabel:j.get("enterpriseServiceNameLabel"),dynamicValidation:true,tooltip:j.get("enterpriseServiceNameDesc")})},_createCompanyNameInput:function(k){return new b({required:true,readOnly:k,model:this.model,fieldName:a.Fields.NAME,fieldLabel:j.get("companyName"),dynamicValidation:true})},_createBanner:function(){var n;var m;var l;var k;m=f.createElement("h3",{"class":"mpf-title",text:j.get("enterpriseMarketplaceCreationTitle")});l=f.createElement("h4",{"class":"mpf-sub-title",text:j.get("enterpriseMarketplaceCreationSubTitle")});k=f.createElement("form",{"class":"mpf-horizontal",html:[this.companyNameInput.render(),this.empNameInput.render(),this.createButton]});n=f.createElement("div",{"class":"mpf-header",html:[m,l,k]});return f.createElement("div",{"class":"mpf-banner",html:n})},_createBody:function(){var k;k=f.createElement("div",{"class":"row mpf-body",html:[this._createImageBox("mpf-enterprise-marketplace-img-1",j.get("defineEcosystem")),this._createImageBox("mpf-enterprise-marketplace-img-3",j.get("shareIt"))]});return k},_createImageBox:function(k,l){return f.createElement("div",{"class":"mpf-img-box",html:f.createElement("div",{"class":"mpf-img-placeholder "+k,text:l})})}});return h});define("DS/MPFPrivateMarketplaceComponent/EnterpriseMarketplaceSelectModal",["UWA/Core","UWA/Class","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Input/Select","DS/UIKIT/SuperModal","DS/MPFUrl/UrlUtils","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFUI/MPFUI"],function(e,h,b,f,g,d,c){var a=h.extend({init:function(i){var j=this;i=i||{};this.modal=null;this.container=i.container;this.onSelectionCB=i.onSelection;this.empCollection=i.collection;this.selectedEnterpriseMarketplaceID=this._getCurrentEnterpriseMarketplaceID();this.modal=new g({className:"enterprise-choice-modal",renderTo:this.container});this._createWebElements();b.subscribe("EMNameChange",function(k){j.empCollection.get(j.selectedEnterpriseMarketplaceID).setName(k.name)})},showModal:function(){var k;var i;var j;i=window.location.pathname;j=(i.indexOf("enterprise-marketplace-creation")!==-1);if(!j&&this.modal){this.modal.dialog({className:"mpf-textAlignCenter",title:c.get("enterpriseAccess"),buttons:this.modalButtons,body:e.createElement("div",{"class":"mpf-emModal mpf-textAlignCenter",html:[{tag:"div","class":"mpf-textAlignCenter",text:c.get("continueUsingEnterprise")},this.enterpriseMarketplaceSelect.elements.container]})});k=this.container.getElementsByClassName("mpf-emModal")[0].getParent().getParent();if(k){k.addClassName("mpf-emModalContent")}}},_createWebElements:function(){var j=this;var i=[];this.modalButtons=[{className:"primary",value:c.get("accessEnterpriseEco"),action:function(k){j.onSelectionCB(j.empCollection.get(j.selectedEnterpriseMarketplaceID));k.hide()}},{className:"default",value:c.get("accessPublicEco"),action:function(k){j.onSelectionCB("public");k.hide()}}];this.empCollection.forEach(function(k){i.push({label:k.getName(),value:k.getID(),selected:k.getID()===j.selectedEnterpriseMarketplaceID})});this.enterpriseMarketplaceSelect=new f({className:"mpf-emModalSelect",options:i,placeholder:false,events:{onChange:function(k){j.selectedEnterpriseMarketplaceID=k.target.value}}})},_getCurrentEnterpriseMarketplaceID:function(){var k;var j;var i=this.empCollection.first().getID();k=(new d(window.location.href)).getValueParameter("esid","");if(k!==""){j=this.empCollection.find(function(l){return l.getProjectName()===k});if(e.is(j)){i=j.getID()}}return i}});return a});define("DS/MPFPrivateMarketplaceComponent/EnterpriseInternalLabServiceInformationComponent",["UWA/Core","UWA/Promise","UWA/Class/View","DS/PlatformAPI/PlatformAPI","DS/UWPClientCode/Navigation","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFView/FieldTextInputV2","DS/MPFCurrencySelectComponent/CurrencySelectComponent","DS/MPFAddressFormComponent/AddressFormComponentV2","DS/MPFAddressModel/AddressSaveError","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFUI/MPFUI"],function(j,k,g,l,a,e,c,f,b,m,d,h){var i=g.extend({className:"mpf-espInternalLabBody mpf-horizontal",setup:function(n){this._parent(n);this.company=n.company;this.addressModel=n.addressModel;this.countries=n.countries;this.shopServiceFactory=n.shopServiceFactory;this.topic=n.topic;this.labNameInput=this._creatNameInput();this.currencySelectComponent=this._createCurrencyInput();this.addressFormComponent=this._createAddressForm();this.alert=this._createAlert();this.topicSubscription=l.subscribe(this.topic,this._onTopicMessage.bind(this));this.listenTo(this.labNameInput,"update",this.onLabNameChange.bind(this))},_onTopicMessage:function(n){if(n.target===this.id||n.target==="service-information"){if(n.event==="labChanged"){if(this.onSaveCB){this.onSaveCB()}l.publish(this.topic,{event:"saveComplete",id:"service-information",next:this.next})}else{if(n.event==="save"){if(this.validate()){this.save({next:n.next})}else{this._publishValidationFailure()}}}}},onLabNameChange:function(n){l.publish(this.topic,{event:"titleSet",title:n.escape("shopName")})},render:function(){l.publish(this.topic,{complete:!this.model.isNew(),event:"updateMenu",id:this.id,newModel:this.newModel});this.container.empty();this.alert.inject(this.container);this.container.addContent([this.labNameInput.render(),this.currencySelectComponent.render(),this.addressFormComponent.render()]);return this},validate:function(){var n=this.addressFormComponent.validate();var p=true;var o=true;this.labNameInput.validate();p=this.currencySelectComponent.validate().isValid;if(this.model.get("shopName")===""){o=false}return n&&p&&o},save:function(o){var p=this;var n=this.model.isNew();var q=this.model.getPendingChanges().shopName;this.next=o.next;this.onSaveCB=o&&o.onComplete?o.onComplete:null;this.model.set("IsInternal","TRUE");delete this.model._attributes.isCompany;this.alert.hide();this.model.savePromise().then(this._createShopService.bind(this,n)).then(this._saveAddress.bind(this)).then(function(){var r;r=p.id==="service-information-creation";if(r){l.publish(p.topic,{event:"idChange",newID:"service-information",oldID:"service-information-creation"})}if(q){p._publishNewLabCreated()}else{p._publishSaveComplete(o.next)}})["catch"](this._onSaveError.bind(this))},destroy:function(){this.stopListening();l.unsubscribe(this.topicSubscription);this.currencySelectComponent.destroy();this.labNameInput.destroy();this.addressFormComponent.destroy();this.addressModel=null;this.countries=null;this.model=null;this._parent();this.container=null;this.topic=null},_saveAddress:function(){this.addressModel.setParentResourceId(this.model.get("id"));return this.addressFormComponent.savePromise()["catch"](function(n){if(!(Error.prototype.isPrototypeOf(n))){n=new d(h.get("errorOnSaveAddress"))}return k.reject(n)})},_onSaveError:function(n){var o;if(Error.prototype.isPrototypeOf(n)){o=n.message}else{o=h.get("errorOnSave")}this.alert.show();this.alert.add({className:"error",message:o});this._publishValidationFailure()},_publishValidationFailure:function(){l.publish(this.topic,{event:"validationFailure",id:"service-information"})},_publishNewLabCreated:function(){l.publish("newLabCreated",{id:this.model.id,topic:this.topic})},_publishSaveComplete:function(n){l.publish(this.topic,{event:"saveComplete",id:this.id,next:n})},_creatNameInput:function(){return new f({model:this.model,fieldName:"shopName",fieldLabel:h.get("serviceName"),required:true,readOnly:this.model.get("currentState")==="SUBMITTED",dynamicValidation:true})},_createCurrencyInput:function(){return new b({className:"mpf-select-v2 mpf-currencySelect",model:this.model})},_createAddressForm:function(){return new m({addressConstraints:this.addressModel.constraints,addressModel:this.addressModel,countries:this.countries})},_createAlert:function(){return new c({autoHide:true,hideDelay:3000})},_createShopService:function(n){var p;var o;if(n){o=this.shopServiceFactory.createModel("shop");o.setParentResourceId(this.model.id);p=o.savePromise()}return k.cast(p)}});return i});define("DS/MPFPrivateMarketplaceComponent/ServiceProvidersCommunityComponent",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFShopModel/ShopCollection","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/MPFUrl/UrlUtils","DS/UWPClientCode/Navigation","DS/MPFLabMap/LabMap","DS/PlatformAPI/PlatformAPI","DS/MPFShopCardComponent/SmallShopCardComponent","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFPrivateMarketplaceComponent/MPFPrivateMarketplaceComponent"],function(k,e,l,b,d,o,c,g,f,a,h,m,i,j){var n=e.extend({className:"mpf-esp-container",domEvents:{"click .fonticon-map":"_toggleMapVisibility"},setup:function(p){p=(p||{});this._parent(p);this._checkPrototypes(p);this.shopsPublic=p.shopsPublic;this.shopsPrivate=p.shopsPrivate;this.labMap=new h({className:"mpf-esp-map",defaultZoom:2,model:this.shopsPrivate,onCenterChangedCB:this._onCenterChangedCB.bind(this)});this.selectedLabsIDs=this._getInternLabID();this.displayedLabList=null;this.isMapActive=true;m.subscribe("SearchBar/search",this._onTopBarSearch.bind(this));m.subscribe("SearchBar/clear",this._onTopBarClear.bind(this))},render:function(){var r;var p;var s;var q=[];this.shopsPrivate.forEach(function(t){q.push(t.get("id"))});this.displayedLabList=this._displayLabList(this.shopsPublic.toArray(),q);p=k.createElement("div",{"class":"mpf-esp-container"});this.container.setContent(p);g.mask(p);s=k.createElement("div",{"class":"mpf-esp-labs-container",html:[this.displayedLabList,this.labMap.render()]});r=k.createElement("div",{"class":"mpf-esp-content",html:[this._initHeader(),s]});this.container.setContent(r);return this},_displayLabList:function(s,q){var p;var r;r=this._createMapToggle();p=k.createElement("div",{"class":"mpf-esp-labs",html:[k.createElement("div",{"class":"mpf-esp-labs-header",html:[k.createElement("div",{"class":"nbResult",html:s.length.toString()+"&nbsp;"+j.get("results")}),r]}),k.createElement("div",{"class":"scroller-container",html:this._displayLabs(s,q)})]});return p},_createMapToggle:function(){var p;p=k.createElement("div",{"class":"fonticon fonticon-map"});if(this.isMapActive){p.addClassName("map-active")}return p},_toggleMapVisibility:function(){if(this.isMapActive){this._hideMap()}else{this._showMap()}},_showMap:function(){var r;var q;var p;r=this.container.getElement(".mpf-esp-labs");q=this.container.getElement(".mpf-esp-map");p=this.container.getElement(".fonticon-map");r&&r.removeClassName("full-width");q&&q.removeClassName("hidden");p&&p.addClassName("map-active");this.isMapActive=true},_hideMap:function(){var r;var q;var p;r=this.container.getElement(".mpf-esp-labs");q=this.container.getElement(".mpf-esp-map");p=this.container.getElement(".fonticon-map");r&&r.addClassName("full-width");q&&q.addClassName("hidden");p&&p.removeClassName("map-active");this.isMapActive=false},_displayLabs:function(s,q){var r=this;var p=[];s.forEach(function(v){var w;var t;var u={};t=q.indexOf(v.get("id"))!==-1;u.shop=v;u.displayEMPIcon=false;u.isSelected=t;u.button={label:t?j.get("unselect"):j.get("select")};w=new i(u);p.push(w.render());r.listenTo(w.container,"click",r._onSelect.bind(r,w));r.listenTo(w,"moreInformationClicked",r._displayMap.bind(r));if(t&&r.selectedLabsIDs.indexOf(v.id)===-1){r.selectedLabsIDs.push(v.id)}});this.labMap.setShopList(s);return p},_onSelect:function(q){var p;q.setSelected(!q.isSelected);q.button.setValue(q.isSelected?j.get("unselect"):j.get("select"));p=q.shop.get("id");if(q.isSelected){this.selectedLabsIDs.push(p)}else{this.selectedLabsIDs.splice(this.selectedLabsIDs.indexOf(p),1)}},_displayMap:function(){var p;p=k.extendElement(this.container.querySelector(".fonticon-map"));if(!p.hasClassName("map-active")){this._toggleMapVisibility()}},_initHeader:function(){var q=this;var p;this.save=new o({className:"primary",value:j.get("save"),events:{onClick:this._saveSelectedLabsIDs.bind(this)}});p=k.createElement("span",{"class":"fonticon fonticon-left-open",events:{click:function(){q.dispatchEvent("onBack")}}});return k.createElement("div",{"class":"mpf-esp-header",html:[p,j.get("selectMyESP"),this.save]})},_saveSelectedLabsIDs:function(){var p=this;return this.model.savePromise({PrivateMPFilter:this.selectedLabsIDs.join(",")},{patch:true}).then(function(){p.dispatchEvent("save")})},_getInternLabID:function(){var p=[];var q=this.shopsPrivate.filter(function(r){return r.isInternal()});if(q){q.forEach(function(r){p.push(r.get("id"))})}return p},_onCenterChangedCB:function(s){var p;var r=[];var q=k.extendElement(this.container.querySelector(".fonticon-map"));if(q.hasClassName("map-active")){this.shopsPublic.forEach(function(t){if(t.getLatitude()<s._northEast.lat&&t.getLatitude()>s._southWest.lat&&t.getLongitude()<s._northEast.lng&&t.getLongitude()>s._southWest.lng){r.push(t)}});p=this.displayedLabList.getParent();this.displayedLabList.remove();this.displayedLabList=this._displayLabList(r,this.selectedLabsIDs);this.displayedLabList.inject(p,"top")}},_refreshLabsList:function(q){var p=this.displayedLabList.getParent();this.displayedLabList.remove();this.displayedLabList=this._displayLabList(q,this.selectedLabsIDs);this.displayedLabList.inject(p,"top");if(this.isMapActive){this._showMap()}else{this._hideMap()}},_onTopBarSearch:function(q){q=q.toLowerCase();if(q){var t=[];var p=[];for(var s=0;s<this.shopsPublic.size();s++){var u=this.shopsPublic.at(s);if(u.getName().toLowerCase().indexOf(q)>-1){t.push(u);p.push([u.getLatitude(),u.getLongitude()])}}if(t.length){this._refreshLabsList(t)}var r=this.container.getElement(".mpf-esp-labs-container");if(r){if(!this._mapAlert){this._mapAlert=new c({visible:true,autoHide:true,maximumVisibleMessages:1}).inject(r,"before")}this._mapAlert.add({className:"primary",message:j.get(t.length>1?"numberLabsFoundPlural":"numberLabsFound",{numberFound:"<b>"+t.length+"</b>",searchString:"&laquo; <b>"+q+"</b> &raquo;"})})}this.labMap.updateMapWithNewListLab(t)}else{this._onTopBarClear()}},_onTopBarClear:function(){this.labMap.setToDefaultPosition()},_checkPrototypes:function(p){l.requiredOfPrototype(this.model,b,"this.model must be a CompanyModel");l.requiredOfPrototype(p.shopsPrivate,d,"options.shopsPrivate must be a ShopCollection");l.requiredOfPrototype(p.shopsPublic,d,"options.shopsPublic must be a ShopCollection")},destroy:function(){this.model=null;this._parent();this.container=null;m.unsubscribe("SearchBar/search");m.unsubscribe("SearchBar/clear")}});return n});define("DS/MPFPrivateMarketplaceComponent/EnterpriseInternalLabHeaderComponent",["UWA/Core","UWA/Class/View","DS/PlatformAPI/PlatformAPI","DS/UWPClientCode/Navigation","DS/MPFUrl/UrlUtils","DS/PubSub/PubSub","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFPrivateMarketplaceComponent/MPFPrivateMarketplaceComponent"],function(h,g,b,e,d,a,c){var f=g.extend({setup:function(i){var j=this;this._parent(i);this.topic=i.topic;this.isUserAnAdmin=i.isUserAnAdmin===true;this.titleSpan=h.createElement("span",{"class":"mpf-espInternalLabHeaderSpan",text:c.get("internalServiceProvider")});this.stepSpan=h.createElement("span",{"class":"mpf-espInternalLabHeaderStepSpan",text:c.get("service-information")});b.subscribe(this.topic,function(k){if(k.event==="titleSet"){j.titleSpan.setContent(c.get(k.title||"internalServiceProvider"))}else{if(k.event==="stepSet"){j.stepSpan.setContent(c.get(k.step))}}})},render:function(){var i;var j;var m;var o;var k;var n;var l;j=new d(window.location.href);m=j.getPath();o=j.getValueParameter("intlabid");k=(m.indexOf("/internal-lab")!==-1)&&h.is(o);if(this.isUserAnAdmin){i=h.createElement("span",{"class":"fonticon fonticon-left-open",events:{click:this._onBack.bind(this)}})}n=k?this.titleSpan:[this.titleSpan," | ",this.stepSpan];l=h.createElement("div",{"class":"mpf-lab-header",html:h.is(i)?[i,n]:n});this.container.setContent(l);return this},setIsUserAdmin:function(i){this.isUserAnAdmin=i===true},_onBack:function(){var l=new d(window.location.href);var n=l.getPath();var m=l.getValueParameter("esid","");var o=l.getValueParameter("intlabid");var i=o&&((n.indexOf("/my-private-lab")!==-1)||(n.indexOf("/internal-lab")!==1));var k=e.previousAddress&&e.previousAddress[0]&&e.previousAddress[0].name==="internal-lab";var j;var p=/my-private-lab\/printer(\/\w{32})?$/;if(n.indexOf("/my-private-lab/service-information-creation")!==-1){e.routeTo("/my-enterprise-service-providers?esid="+m)}else{if(p.test(n)){a.dispatch(a.events.cardNavigation+"8mdBSNWA20HaTcQkaG05",["8mdBSNWA20HaTcQkaG06"]);j="/my-private-lab/printers?esid="+m;if(o){j+="&intlabid="+o}e.routeTo(j)}else{if(n.indexOf("/internal-lab/overview")!==-1){e.routeTo("/my-enterprise-service-providers?esid="+m);b.publish("newLabSelectedRequest",{from:"CompanyEcosystem",id:o,backToPreviousLab:true})}else{if(i||k){e.routeTo("/internal-lab/overview?esid="+m+"&intlabid="+o)}else{e.routeTo("/lab-overview?esid="+m)}}}}},destroy:function(){this.model=null;this._parent();this.container=null;this.stepSpan=null;this.titleSpan=null;this.topic=null}});return f});define("DS/MPFPrivateMarketplaceComponent/EnterpriseInternalLabHeaderWidget",["UWA/Class","UWA/Promise","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCompanyModel/CompanyHelper","DS/PlatformAPI/PlatformAPI","DS/MPFPrivateMarketplaceComponent/EnterpriseInternalLabHeaderComponent"],function(c,e,a,d,g,b,h){var f=c.extend({init:function(i){var j=this;this._parent(i);this.topic=i.topic;this.container=i.container;this.deferred=e.deferred();this.promise=this.deferred.promise;this.headerComponent=this._createHeaderComponent();a.fetchPromise().then(this._getFactories.bind(this)).then(this._fetchMe.bind(this)).then(this._fetchCompany.bind(this)).then(function(){j.headerComponent.setIsUserAdmin(j.me.isAdminOfThisEMP(j.company.getEmpProjectName()));j.deferred.resolve()})},onShow:function(){var i=this;this.promise.then(function(){i.headerComponent.render()})},_createHeaderComponent:function(){return new h({container:this.container,topic:this.topic})},_fetchCompany:function(){this.company=g.getCompanyFromPerson(this.me,this.companyFactory);return this.company.fetchPromise()},_fetchMe:function(){this.me=this.personFactory.createModel("me");return this.me.fetchPromise()},_getFactories:function(i){var j=this;this.factories=d.getInstance(i);return e.all([this.factories.getFactory(d.Types.PERSON),this.factories.getFactory(d.Types.COMPANY)]).then(function(k){j.personFactory=k[0];j.companyFactory=k[1]})}});return f});define("DS/MPFPrivateMarketplaceComponent/EnterpriseInternalLabServiceInformationWidget",["UWA/Core","UWA/Class","UWA/Promise","DS/UIKIT/Spinner","DS/PlatformAPI/PlatformAPI","DS/MPFDataProxy/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFShopModel/ShopModel","DS/MPFPrivateMarketplaceComponent/EnterpriseInternalLabServiceInformationComponent","DS/MPFMenuComponent/StepNavigationButtonsComponent","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFUI/MPFUI"],function(h,j,g,b,i,c,l,k,d,f,e){var a=j.extend({init:function(m){this._parent(m);this.topic=m.topic;this.creation=m.creation;this.container=m.container;this.subscribed=false;document.body.style.backgroundColor="#f9f9f9";var n=this;this._getFirstPromise().then(function(){n.company=n.companyFactory.createModel("company");n.company.set("id",n.meModel.get("company").split("/")[n.meModel.get("company").split("/").length-1]);n._createNewShop();return n.company.fetchPromise()}).then(function(){n._createComponent();n.buttonsComponent=new f({container:h.createElement("div",{"class":"mpf-companyFooterContainer"}),checkSave:true,displayBack:m.displayBack,displayFinish:m.displayFinish,displayNext:m.displayNext,stepName:n.creation?"service-information-creation":"service-information",topic:n.topic});if((n.creation&&window.location.pathname.indexOf("service-information-creation")!==-1)||(!n.creation&&window.location.pathname.indexOf("service-information-creation")===-1)){n.onShow()}})["catch"](function(){})},onShow:function(){var n=this;var m;var o;if(!this.creation&&!this.subscribed){i.subscribe("newLabSelected",function(p){if(n.model.get("id")!==p.id){n._changeSelectedLab({newLab:p,that:n})}});i.publish("newLabSelectedRequest");i.subscribe("topBarMultiShopsReady",function(){i.publish("newLabSelectedRequest")});this.subscribed=true}if(this.creation){if(!(this.model.isNew())){this._createNewShop()}this._createComponent();this._setContent();m="service-information-creation";o="service-information";i.publish(this.topic,{event:"resetMenu",id:"service-information"})}else{m="service-information";o="service-information-creation";i.publish("newLabSelectedRequest");i.publish(n.topic,{complete:true,event:"updateMenu",id:"service-information",status:"complete"});this._changeSelectedLab({newLab:this.model,that:n})}i.publish(this.topic,{event:"idChange",newID:m,oldID:o})},_changeSelectedLab:function(m){var n=m.that;this.creation=false;this.model=this.shopFactory.createModel("shop");this.model.set("id",m.newLab.id);return this.model.fetchPromise({expand:[],uc2:true}).then(function(){i.publish(n.topic,{event:"titleSet",id:"service-information",title:n.model.escape("shopName")});n._initAddressModel();if(!(n.addressModel.isNew())){return n.addressModel.fetchPromise()}}).then(function(){n._createComponent();n._setContent()})},_getFirstPromise:function(){var m=this;return c.fetchPromise().then(function(n){var o=l.getInstance(n);return g.all([o.getFactory(l.Types.ADDRESS),o.getFactory(l.Types.COMPANY),o.getFactory(l.Types.PERSON),o.getFactory(l.Types.SHOP),o.getFactory(l.Types.SHOP_SERVICE),o.getFactory(l.Types.COUNTRY)])}).then(function(n){m.addressFactory=n[0];m.companyFactory=n[1];var o=n[2];m.shopFactory=n[3];m.shopServiceFactory=n[4];m.countryFactory=n[5];m.meModel=o.createModel("me");m.countries=m.countryFactory.createCollection("seller");return g.all([m.meModel.fetchPromise(),m.countries.fetchPromise()])})},_createNewShop:function(){this.model=this.shopFactory.createModel("me");this.model.setOwner(this.company.id);this.model.set(k.Fields.IS_INTERNAL,"TRUE");this.addressModel=this.addressFactory.createModel("shop")},_createComponent:function(){var m;m=this.component;this.component=new d({addressModel:this.addressModel,countries:this.countries,company:this.company,id:this.creation?"service-information-creation":"service-information",model:this.model,shopServiceFactory:this.shopServiceFactory,topic:this.topic});if(m){m.destroy()}},_setContent:function(){this.container.setContent([this.component.render(),this.buttonsComponent.render()])},_initAddressModel:function(){var m;m=this.model.getAddress();if(m&&m.length>0){this.addressModel=this.addressFactory.createModel("address");this.addressModel.set("id",m.substring(m.lastIndexOf("/")+1));return this.addressModel.fetchPromise()}else{this.addressModel=this.addressFactory.createModel("shop");this.addressModel.setParentResourceId(this.model.id)}}});return a});define("DS/MPFPrivateMarketplaceComponent/EnterpriseMarketplaceCreationWidget",["UWA/Core","UWA/Class","UWA/Promise","UWA/Utils","DS/UWPClientCode/Navigation","DS/UIKIT/Spinner","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCompanyModel/CompanyHelper","DS/MPFUrl/UrlUtils","DS/MPFPrivateMarketplaceComponent/EnterpriseMarketplaceCreationComponent","DS/MPFError/BadArgumentError"],function(h,b,i,g,a,j,d,m,e,c,l,k){var f=b.extend({init:function(n){this.widget=n},load:function(){var n=this;this.widget.body.addClassName("mpf-page");new j().inject(this.widget.body).show();d.fetchPromise().then(this._getFactories.bind(this)).then(this._fetchMe.bind(this)).then(this._fetchCompany.bind(this)).then(function(){var o;o=n.company.getEmpProjectName();if(h.is(o)&&o!==""){a.routeTo("/welcome?esid="+o)}else{n.empCreationComponent=n._getEMPCreationComponent();n.widget.setBody(n.empCreationComponent.render())}})["catch"](function(o){a.routeTo("/welcome")})},_getEMPCreationComponent:function(){return new l({model:this.company})},_fetchMe:function(){var n;this.me=this.personFactory.createModel("me");n=g.getQueryString(window.location,"platform","");if(n){return this.me.fetchPromise({cache:false,platform:n})}else{return i.reject(new k("platform parameter should always be there for an EMP creation"))}},_getFactories:function(n){var o=this;this.factories=m.getInstance(n);return i.all([this.factories.getFactory(m.Types.PERSON),this.factories.getFactory(m.Types.COMPANY)]).then(function(p){o.personFactory=p[0];o.companyFactory=p[1]})},_fetchCompany:function(){var n=(new c(window.location.href)).getValueParameter("esid","");if(n!==""){a.routeTo("/welcome?esid="+n)}this.company=e.getCompanyFromPerson(this.me,this.companyFactory);if(this.company){return this.company.fetchPromise()}else{return i.reject(new k("User should always have a company when creating an EMP"))}}});return f});define("DS/MPFPrivateMarketplaceComponent/EnterpriseServiceProviderComponent",["UWA/Core","UWA/Utils","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyModel","DS/MPFShopModel/ShopCollection","DS/MPFModelFactory/TCDocumentFactory","DS/MPFModelFactory/ShopServiceFactory","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","DS/MPFPrivateMarketplaceComponent/ServiceProvidersCommunityComponent","DS/MPFUrl/UrlUtils","DS/UWPClientCode/Navigation","DS/MPFShopCardComponent/SmallShopCardComponent","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent","css!DS/MPFPrivateMarketplaceComponent/MPFPrivateMarketplaceComponent"],function(l,e,g,p,d,n,b,j,i,a,m,r,c,q,s,k,f,h){var o=g.extend({className:"mpf-sp-container",setup:function(t){t||(t={});this._parent(t);this._checkPrototypes(t);this.shopsPrivate=t.shopsPrivate;this.shopsPublic=t.shopsPublic;this.shopsPublicPromise=t.shopsPublicPromise;this.shopServiceFactory=t.shopServiceFactory;this.tcDocumentFactory=t.tcDocumentFactory;this._initMyCompanyEcosystemButtonListener();this.termsFiles={};this.existingServiceProvidersComponent=this._createExistingServiceProvidersComponent();this.newServiceProviderComponent=this._createNewServiceProviderComponent();this.checkbox=new a({className:"mpf-sp-checkbox primary",type:"checkbox",value:h.get("allowAllSP"),checked:this.model.getEMPAllowPublicSellers(),events:{onClick:this._allowPublicSellers.bind(this)}})},render:function(){var v;var u;var t;this._updateLabCountsInHeaderBoxes();v=l.createElement("div",{"class":"mpf-choice-sp-container",html:[this.existingServiceProvidersComponent,this.newServiceProviderComponent]});t=l.createElement("div",{"class":"mpf-sp-lab-container",html:this._displayLabs(this.shopsPrivate)});u=l.createElement("div",{"class":"mpf-sp-content",html:[v,this.checkbox,t]});this.container.setContent(u);this.displayAlert();return this},displayAlert:function(){if(this.shopsPrivate.size()===0){new m({visible:true,closeOnClick:false,maximumVisibleMessages:1,messageClassName:"primary",messages:h.get("noLabsSelected")}).inject(this.container.getElement(".mpf-sp-lab-container"))}},_displayLabs:function(w){var v=this;var u=[];var x;var t;w.forEach(function(y){t={};t.shop=y;t.displayEMPIcon=true;t.isSelected=false;if(y.isInternal()){t.button={label:h.get("edit"),onClickCallback:v._onEdit.bind(v,y)}}x=new f(t);u.push(x.render())});return u},_onEdit:function(v){var t;var u;var w;u=window.location.search;w=e.parseQuery(u);w.intlabid=v.id;t="/internal-lab/overview?"+e.toQueryString(w);c.publish("newLabSelectedRequest",{from:"CompanyEcosystem",id:v.id});k.routeTo(t)},_allowPublicSellers:function(){return this.model.savePromise({PrivateMPAllowPublicSellers:this.checkbox.isChecked()},{patch:true})},_createNewServiceProviderComponent:function(){var v;var x;var u;var y;var t;var w;t=l.createElement("span",{text:[h.get("myCompanyServiceProviders")+" | "+this.shopsPrivate.filter(function(z){return z.isInternal()}).length.toString()]});y=l.createElement("div",{"class":"mpf-sp-count",html:t});v=l.createElement("div",{"class":"mpf-sp-image-container mpf-new-sp"});w=l.createElement("div",{"class":"mpf-sp-topHalf-container",html:[y,v]});x=l.createElement("div",{"class":"mpf-choice-sp-container-label",html:l.createElement("span",{"class":"mpf-choice-sp-label",text:h.get("newProviderLabel")})});u=new i({className:"primary",value:h.get("newESPButton"),events:{onClick:function(){k.routeTo("/my-private-lab/service-information-creation"+window.location.search)}}});return l.createElement("div",{"class":"mpf-choice-sp mpf-declareNewInternalLab",html:[w,x,u]})},_createExistingServiceProvidersComponent:function(){var y;var v;var x;var u;var t;var w;t=l.createElement("span",{text:[h.get("communityServiceProviders")+" | "+this.shopsPrivate.filter(function(z){return !(z.isInternal())}).length.toString()]});u=l.createElement("div",{"class":"mpf-sp-count",html:t});y=l.createElement("div",{"class":"mpf-sp-image-container mpf-existing-sp"});w=l.createElement("div",{"class":"mpf-sp-topHalf-container",html:[u,y]});v=l.createElement("div",{"class":"mpf-choice-sp-container-label",html:l.createElement("span",{"class":"mpf-choice-sp-label",text:h.get("existingProviderLabel")})});x=new i({className:"primary",value:h.get("selectESPButton"),events:{onClick:this._displayServiceProvidersCommunityComponent.bind(this)}});return l.createElement("div",{"class":"mpf-choice-sp  mpf-selectPublicLabsDiv",html:[w,v,x]})},_displayServiceProvidersCommunityComponent:function(){var t=this;r.mask(this.container);return this.shopsPublicPromise.then(function(){t.espComponent=new q({model:t.model,shopsPublic:t.shopsPublic,shopsPrivate:t.shopsPrivate});t.container.setContent(t.espComponent.render());r.unmask(t.container);t.communityServiceProvidersDisplayed=true;t.listenTo(t.espComponent,"onBack",function(){t.render();t.communityServiceProvidersDisplayed=false});t.listenTo(t.espComponent,"save",t._onSaveCommunityLabs.bind(t))})},_onSaveCommunityLabs:function(){var t=this;this.shopsPrivate.fetchPromise().then(function(){t.render();t.communityServiceProvidersDisplayed=false})},_updateLabCountsInHeaderBoxes:function(){var t;var u;t=l.createElement("span",{text:[h.get("communityServiceProviders")+" | "+this.shopsPrivate.filter(function(v){return !(v.isInternal())}).length.toString()]});this.existingServiceProvidersComponent.getElement(".mpf-sp-count").setContent(t);u=l.createElement("span",{text:[h.get("myCompanyServiceProviders")+" | "+this.shopsPrivate.filter(function(v){return v.isInternal()}).length.toString()]});this.newServiceProviderComponent.getElement(".mpf-sp-count").setContent(u)},_initMyCompanyEcosystemButtonListener:function(){var u=this;var t=document.body.getElement(".mp-nav-bar li.active");this.communityServiceProvidersDisplayed=false;this.listenTo(t,"click",function(){if(u.communityServiceProvidersDisplayed){u.render();u.communityServiceProvidersDisplayed=false}})},_checkPrototypes:function(t){p.requiredOfPrototype(this.model,d,"this.model must be a CompanyModel");p.requiredOfPrototype(t.shopsPrivate,n,"options.shopsPrivate must be a ShopCollection");p.requiredOfPrototype(t.shopsPublic,n,"options.shopsPublic must be a ShopCollection");p.requiredOfPrototype(t.tcDocumentFactory,b,"options.tcDocumentFactory must be a TCDocumentFactory");p.requiredOfPrototype(t.shopServiceFactory,j,"options.shopServiceFactory must be a ShopServiceFactory")},destroy:function(){this.model=null;this._parent();this.container=null}});return o});define("DS/MPFPrivateMarketplaceComponent/EnterpriseServiceProviderManagementComponent",["UWA/Core","UWA/Class","UWA/Promise","DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCompanyModel/CompanyHelper","DS/UWPClientCode/Navigation","DS/MPFUrl/UrlUtils","DS/MPFPrivateMarketplaceComponent/EnterpriseServiceProviderComponent","i18n!DS/MPFPrivateMarketplaceComponent/assets/nls/PrivateMarketplaceComponent"],function(l,c,m,d,n,i,b,g,o,j,a,e,f,k){var h=c.extend({init:function(p){this.widget=p;d.setEnabled(true);this.logger=d.getLogger(h)},load:function(){var q=this;var p;this.widget.body.addClassName("mpf-page");this._displayMask();g.fetchPromise().then(this._getFactories.bind(this)).then(this._fetchMeAndShops.bind(this)).then(this._fetchCompany.bind(this)).then(function(){q.isUserAnAdmin=q.me.isAdminOfThisEMP(q.company.getEmpProjectName());if(q.isUserAnAdmin){q.enterpriseServiceProvidersComponent=q._getEnterpriseServiceProvidersComponent();q.widget.setBody(q.enterpriseServiceProvidersComponent.render());q.enterpriseServiceProvidersComponent.displayAlert();n.subscribe("newLabCreated",function(){q.shopsPrivate.fetchPromise().then(q.enterpriseServiceProvidersComponent.render.bind(q.enterpriseServiceProvidersComponent))})}else{new b({className:"error",messageClassName:"error",messages:k.get("unauthorizedMessage"),closable:true,visible:true,autoHide:true,hideDelay:5000,closeOnClick:true}).inject(q.widget.body,"top");p=(new e(window.location.href)).getValueParameter("esid");a.routeTo(l.is(p)?"/welcome?esid="+p:"/welcome")}})["catch"](function(r){var s;q.logger.error(r);s=l.createElement("span",{text:k.get("errorLoadingWidget")});q.widget.setBody(s)})},_getEnterpriseServiceProvidersComponent:function(){return new f({shopsPrivate:this.shopsPrivate,shopsPublic:this.shopsPublic,shopsPublicPromise:this.shopsPublicPromise,model:this.company,shopServiceFactory:this.shopServiceFactory,tcDocumentFactory:this.tcDocumentFactory})},_fetchCompany:function(){var p;p=this.me.getCompanyId();this.company=this.companyFactory.createModel("company",{id:p});return this.company.fetchPromise()},_fetchMeAndShops:function(){this.shopsPrivate=this.shopFactory.createCollection("publicPMP");this.shopsPublic=this.shopFactory.createCollection("publicNoESID");this.me=this.personFactory.createModel("me");this.shopsPublicPromise=this.shopsPublic.fetchPromise();return m.all([this.me.fetchPromise(),this.shopsPrivate.fetchPromise()])},_getFactories:function(p){var q=this;this.factories=o.getInstance(p);return m.all([this.factories.getFactory(o.Types.PERSON),this.factories.getFactory(o.Types.COMPANY),this.factories.getFactory(o.Types.SHOP),this.factories.getFactory(o.Types.SHOP_SERVICE),this.factories.getFactory(o.Types.TC_DOCUMENT)]).then(function(r){q.personFactory=r[0];q.companyFactory=r[1];q.shopFactory=r[2];q.shopServiceFactory=r[3];q.tcDocumentFactory=r[4]})},_displayMask:function(){var p;p=l.createElement("div",{styles:{height:"30px",margin:"30px 100px",width:"90%"}});p.inject(this.widget.body);i.mask(p)}});return h});