/*! Copyright 2014 Dassault Syst√®mes */
define("DS/PlatformAPI/PlatformAPI",["UWA/Core","DS/MessageBus/MessageBus"],function(i,h){function c(){var j;try{j=parent&&parent.document}catch(k){j=false}return j}var g=(function(){var e={};return function(j){if(!e[j]){if(c()){try{e[j]=parent.require(j)}catch(k){}}else{try{e[j]=require(j)}catch(k){}}}return e[j]}}());function f(){var e={};return new Promise(function(k,j){require([["DS","UWPClientCode","PublicAPI"].join("/"),["DS","UWPClientCode","I18n"].join("/")],function(l,m){e.myAppsBaseUrl=l.getApplicationConfiguration("app.urls.myapps");if(!e.myAppsBaseUrl){l.getAllApplicationConfigurations(true);e.myAppsBaseUrl=l.getApplicationConfiguration("app.urls.myapps");if(!e.myAppsBaseUrl){j()}}e.lang=m.getCurrentLanguage();l.getUserAsync({success:function(n){e.userId=n.login;k(e)},failure:j})},j)})}function b(){if(typeof window.dsDefaultWebappsBaseUrl!=="string"){throw new Error("Cannot query available services")}h.setTrustedOrigins((c()?Promise.resolve():f()).then(function(e){if(e){window.COMPASS_CONFIG=e}else{var j=g("DS/PlatformAPI/PlatformAPI");if(j&&j._trustedServices){return j._trustedServices}}return new Promise(function(l,k){require([["DS","i3DXCompassPlatformServices","i3DXCompassPlatformServices"].join("/")],function(m){m.getPlatformServices({onComplete:function(o){var n=[].concat.apply([],o.map(function(p){return Object.keys(p).map(function(q){return p[q]})})).filter(function(p){return p.indexOf("http")===0});a._trustedServices=n;l(n)},onFailure:k})},k)})}))}var a={_trustedServices:null,getUser:function(){var e=g("DS/UWPClientCode/PublicAPI");if(e){return i.clone(e.getUser())}},getUserProperty:function(j){var e=g("DS/UWPClientCode/PublicAPI");if(e){return i.clone(e.getUserProperty(j))}},getApplicationConfiguration:function(j){var e=g("DS/UWPClientCode/PublicAPI");if(e){return i.clone(e.getApplicationConfiguration(j))}},getAllApplicationConfigurations:function(){var e=g("DS/UWPClientCode/PublicAPI");if(e){return i.clone(e.getAllApplicationConfigurations())}},getContextRoles:function(j){var e=g("DS/UWPClientCode/PublicAPI");if(e){return i.clone(e.getContextRoles(j))}},setContextRoles:function(j){var e=g("DS/UWPClientCode/PublicAPI");if(e){return i.clone(e.setContextRoles(j))}},publish:function(e,j){h.publish({channel:"Widgets",topic:e,data:j,crossFrame:true})},subscribe:function(e,j){return h.subscribe({channel:"Widgets",topic:e,callback:j,crossFrame:true})},unsubscribe:function(e){if(e instanceof h.Subscription){h.unsubscribe(e)}h.unsubscribe({channel:"Widgets",topic:e})},setTrustedMessageOrigins:function(e){if(e==="services"){b()}else{h.setTrustedOrigins(e)}}};try{a.setTrustedMessageOrigins("services")}catch(d){}return a});